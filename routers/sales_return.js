var a0_0x238882=a0_0x471b;(function(_0x5b7e16,_0x2c0e78){var _0x47240d=a0_0x471b,_0x1b71cb=_0x5b7e16();while(!![]){try{var _0x17388c=parseInt(_0x47240d(0xa7))/0x1+-parseInt(_0x47240d(0xaa))/0x2+parseInt(_0x47240d(0xfd))/0x3*(parseInt(_0x47240d(0x108))/0x4)+-parseInt(_0x47240d(0xd0))/0x5*(parseInt(_0x47240d(0xeb))/0x6)+parseInt(_0x47240d(0xfa))/0x7*(-parseInt(_0x47240d(0xc0))/0x8)+-parseInt(_0x47240d(0xa0))/0x9*(parseInt(_0x47240d(0xba))/0xa)+parseInt(_0x47240d(0xb6))/0xb;if(_0x17388c===_0x2c0e78)break;else _0x1b71cb['push'](_0x1b71cb['shift']());}catch(_0x35abbf){_0x1b71cb['push'](_0x1b71cb['shift']());}}}(a0_0x456f,0x730a7));const express=require('express'),app=express(),router=express[a0_0x238882(0xff)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,customer_payment,c_payment_data}=require(a0_0x238882(0xc8)),auth=require(a0_0x238882(0xd3)),users=require(a0_0x238882(0xe0));function a0_0x471b(_0x5adfc2,_0x547533){var _0x456f7e=a0_0x456f();return a0_0x471b=function(_0x471bda,_0x32c403){_0x471bda=_0x471bda-0x9c;var _0x3df3c7=_0x456f7e[_0x471bda];return _0x3df3c7;},a0_0x471b(_0x5adfc2,_0x547533);}router[a0_0x238882(0xac)](a0_0x238882(0xc7),auth,async(_0x1ee2ae,_0x711a85)=>{var _0x21b9af=a0_0x238882;try{const {username:_0x5d4088,email:_0x3cccfc,role:_0x138f45}=_0x1ee2ae[_0x21b9af(0xe8)],_0x4a1178=_0x1ee2ae[_0x21b9af(0xe8)],_0x47bb98=await profile[_0x21b9af(0x9c)]({'email':_0x4a1178['email']}),_0x33e02e=await master_shop[_0x21b9af(0x100)]();console[_0x21b9af(0x102)]('master',_0x33e02e);const _0x17b7a6=await sales_return[_0x21b9af(0xe5)]([{'$lookup':{'from':_0x21b9af(0x101),'localField':_0x21b9af(0xcc),'foreignField':_0x21b9af(0xf6),'as':_0x21b9af(0xc6)}},{'$unwind':'$customer_docs'}]);console['log'](_0x21b9af(0xf5),_0x17b7a6);if(_0x33e02e[0x0][_0x21b9af(0xc3)]==_0x21b9af(0xf1)){var _0x3fae00=users[_0x21b9af(0xf0)];console['log'](_0x3fae00);}else{if(_0x33e02e[0x0][_0x21b9af(0xc3)]==_0x21b9af(0xca))var _0x3fae00=users[_0x21b9af(0xca)];else{if(_0x33e02e[0x0][_0x21b9af(0xc3)]=='German')var _0x3fae00=users[_0x21b9af(0xc9)];else{if(_0x33e02e[0x0]['language']==_0x21b9af(0xf7))var _0x3fae00=users['Spanish'];else{if(_0x33e02e[0x0][_0x21b9af(0xc3)]==_0x21b9af(0x10c))var _0x3fae00=users[_0x21b9af(0x10c)];else{if(_0x33e02e[0x0]['language']==_0x21b9af(0xcf))var _0x3fae00=users[_0x21b9af(0xa1)];else{if(_0x33e02e[0x0]['language']==_0x21b9af(0x9e))var _0x3fae00=users[_0x21b9af(0x9e)];else{if(_0x33e02e[0x0]['language']==_0x21b9af(0xfb))var _0x3fae00=users['Arabic'];}}}}}}}_0x711a85[_0x21b9af(0xdf)](_0x21b9af(0xe2),{'success':_0x1ee2ae[_0x21b9af(0xb4)]('success'),'errors':_0x1ee2ae['flash'](_0x21b9af(0xf2)),'role':_0x4a1178,'profile':_0x47bb98,'master_shop':_0x33e02e,'user':_0x17b7a6,'language':_0x3fae00});}catch(_0x3bc0c8){console['log'](_0x3bc0c8);}}),router[a0_0x238882(0xac)](a0_0x238882(0xa3),auth,async(_0x48b07f,_0x4fb9bb)=>{var _0x2af809=a0_0x238882;try{const {username:_0x10a94f,email:_0x5455fc,role:_0x56fa7c}=_0x48b07f[_0x2af809(0xe8)],_0x1f115b=_0x48b07f[_0x2af809(0xe8)],_0x566a23=await profile[_0x2af809(0x9c)]({'email':_0x1f115b[_0x2af809(0xf4)]}),_0x431e8f=await master_shop[_0x2af809(0x100)]();console[_0x2af809(0x102)]('master',_0x431e8f);const _0x9a3c20=_0x48b07f[_0x2af809(0xc5)]['id'];console['log'](_0x9a3c20);var _0x141064=[_0x2af809(0xe6)];const _0x54dea3=await sales_return[_0x2af809(0x104)](_0x9a3c20),_0x570a17=await warehouse[_0x2af809(0xe5)]([{'$match':{'name':_0x54dea3[_0x2af809(0xa4)],'room':_0x54dea3[_0x2af809(0x10b)]}},{'$unwind':_0x2af809(0xda)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2af809(0xa6)},'product_stock':{'$first':_0x2af809(0xea)},'bay':{'$first':_0x2af809(0xc4)},'bin':{'$first':_0x2af809(0xa2)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2af809(0xae)},'primary_code':{'$first':_0x2af809(0x9d)},'secondary_code':{'$first':_0x2af809(0xd8)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);console[_0x2af809(0x102)](_0x570a17);const _0x24b053=await warehouse[_0x2af809(0xe5)]([{'$match':{'status':_0x2af809(0x107),'name':_0x2af809(0xde),'warehouse_category':_0x2af809(0xc2)}},{'$group':{'_id':'$name','name':{'$first':_0x2af809(0xee)}}},{'$sort':{'name':0x1}}]),_0x53e797=await product[_0x2af809(0x100)]({});if(_0x431e8f[0x0][_0x2af809(0xc3)]==_0x2af809(0xf1)){var _0x11889e=users[_0x2af809(0xf0)];console[_0x2af809(0x102)](_0x11889e);}else{if(_0x431e8f[0x0]['language']==_0x2af809(0xca))var _0x11889e=users[_0x2af809(0xca)];else{if(_0x431e8f[0x0][_0x2af809(0xc3)]==_0x2af809(0xc9))var _0x11889e=users[_0x2af809(0xc9)];else{if(_0x431e8f[0x0][_0x2af809(0xc3)]=='Spanish')var _0x11889e=users[_0x2af809(0xf7)];else{if(_0x431e8f[0x0][_0x2af809(0xc3)]==_0x2af809(0x10c))var _0x11889e=users['French'];else{if(_0x431e8f[0x0][_0x2af809(0xc3)]==_0x2af809(0xcf))var _0x11889e=users['Portuguese'];else{if(_0x431e8f[0x0][_0x2af809(0xc3)]==_0x2af809(0x9e))var _0x11889e=users[_0x2af809(0x9e)];else{if(_0x431e8f[0x0][_0x2af809(0xc3)]==_0x2af809(0xfb))var _0x11889e=users[_0x2af809(0xbe)];}}}}}}}_0x4fb9bb['render'](_0x2af809(0xdc),{'success':_0x48b07f['flash'](_0x2af809(0xce)),'errors':_0x48b07f[_0x2af809(0xb4)](_0x2af809(0xf2)),'role':_0x1f115b,'profile':_0x566a23,'master_shop':_0x431e8f,'user':_0x54dea3,'stock':_0x570a17,'unit':_0x53e797,'language':_0x11889e,'warehouses':_0x24b053,'rooms':_0x141064});}catch(_0x46cc86){console[_0x2af809(0x102)](_0x46cc86);}}),router[a0_0x238882(0x9f)](a0_0x238882(0xa3),auth,async(_0xf09272,_0x242681)=>{var _0x385c8f=a0_0x238882;try{const _0xa99692=_0xf09272[_0x385c8f(0xc5)]['id'];console['log'](_0xa99692);const _0x567413=await sales_return['findOne']({'invoice':_0xf09272[_0x385c8f(0xf8)]['invoice']});console[_0x385c8f(0x102)](_0x385c8f(0xb0),_0x567413);const _0x4181cd=await warehouse[_0x385c8f(0x9c)]({'name':_0x567413['ToWarehouse'],'room':_0x567413[_0x385c8f(0x10b)]});console['log'](_0x385c8f(0xb5),_0x4181cd);const {invoice:_0x1d04a6,customer:_0x247ba3,date:_0x3c665a,warehouse_name:_0x5eb7d6,product_name:_0xac7d99,primary_code:_0x3666cc,secondary_code:_0x26eeb0,product_code:_0x4f8ded,sales_quantity:_0x587e39,stocks:_0x451353,return_qty:_0x105dd7,note:_0x5b8823,to_warehouse_name:_0x2f9eb8,to_Room_name:_0x1d5bd9}=_0xf09272[_0x385c8f(0xf8)];console[_0x385c8f(0x102)](_0xf09272['body']);if(typeof _0xac7d99==_0x385c8f(0x10a))var _0x18cac8=[_0xf09272[_0x385c8f(0xf8)]['product_name']],_0x204664=[_0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xe4)]],_0x545f8d=[_0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xb3)]],_0x57fefe=[_0xf09272['body'][_0x385c8f(0xe9)]],_0x375982=[_0xf09272['body'][_0x385c8f(0xbb)]],_0x4932b2=[_0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xb1)]],_0x33bb03=[_0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xa9)]],_0x28a850=[_0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xc1)]],_0xe94e08=[_0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xa8)]],_0x3fbf6d=[_0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xd6)]],_0x1a4712=[_0xf09272[_0x385c8f(0xf8)]['floorlevel']];else var _0x18cac8=[..._0xf09272['body'][_0x385c8f(0xb7)]],_0x204664=[..._0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xe4)]],_0x545f8d=[..._0xf09272['body'][_0x385c8f(0xb3)]],_0x57fefe=[..._0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xe9)]],_0x375982=[..._0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xbb)]],_0x4932b2=[..._0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xb1)]],_0x33bb03=[..._0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xa9)]],_0x28a850=[..._0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xc1)]],_0xe94e08=[..._0xf09272[_0x385c8f(0xf8)]['bin']],_0x3fbf6d=[..._0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xd6)]],_0x1a4712=[..._0xf09272['body'][_0x385c8f(0x10d)]];const _0x20ff58=_0x18cac8['map'](_0x235482=>{return _0x235482={'product_name':_0x235482};});_0x204664['forEach']((_0x47626c,_0x2d4475)=>{var _0x4f5c10=_0x385c8f;_0x20ff58[_0x2d4475][_0x4f5c10(0xe4)]=_0x47626c;}),_0x545f8d[_0x385c8f(0xfc)]((_0x83ae4f,_0x14d23d)=>{var _0x311023=_0x385c8f;_0x20ff58[_0x14d23d][_0x311023(0xb3)]=_0x83ae4f;}),_0x57fefe[_0x385c8f(0xfc)]((_0x43d798,_0x1250ee)=>{var _0x52ea5c=_0x385c8f;_0x20ff58[_0x1250ee][_0x52ea5c(0xe9)]=_0x43d798;}),_0x375982['forEach']((_0x52d633,_0x3f5016)=>{_0x20ff58[_0x3f5016]['sale_qty']=_0x52d633;}),_0x4932b2['forEach']((_0x1133a1,_0x501fb7)=>{var _0x246656=_0x385c8f;_0x20ff58[_0x501fb7][_0x246656(0xa5)]=_0x1133a1;}),_0x33bb03[_0x385c8f(0xfc)]((_0x6e2e8c,_0x1cc1c2)=>{var _0x28b255=_0x385c8f;_0x20ff58[_0x1cc1c2][_0x28b255(0xa9)]=_0x6e2e8c;}),_0x28a850[_0x385c8f(0xfc)]((_0x150414,_0x4d3120)=>{_0x20ff58[_0x4d3120]['bay']=_0x150414;}),_0xe94e08[_0x385c8f(0xfc)]((_0x5def3b,_0x387fa8)=>{var _0x984475=_0x385c8f;_0x20ff58[_0x387fa8][_0x984475(0xa8)]=_0x5def3b;}),_0x3fbf6d[_0x385c8f(0xfc)]((_0x38aadc,_0xb14892)=>{var _0x217315=_0x385c8f;_0x20ff58[_0xb14892][_0x217315(0xaf)]=_0x38aadc;}),_0x1a4712[_0x385c8f(0xfc)]((_0x1438ed,_0x30715b)=>{var _0x529d1c=_0x385c8f;_0x20ff58[_0x30715b][_0x529d1c(0x10d)]=_0x1438ed;});var _0xc13b9c=0x0;_0x20ff58[_0x385c8f(0xfc)](_0x485794=>{var _0xa00456=_0x385c8f;console[_0xa00456(0x102)](_0xa00456(0xb8),_0x485794),(parseInt(_0x485794['sale_qty'])<parseInt(_0x485794[_0xa00456(0xa9)])||parseInt(_0x485794[_0xa00456(0xa5)])<parseInt(_0x485794['return_qty'])&&parseInt(_0x485794[_0xa00456(0xb2)])>parseInt(_0x485794[_0xa00456(0xa9)])||parseInt(_0x485794['return_qty'])==0x0)&&_0xc13b9c++;});if(_0xc13b9c!=0x0)return _0xf09272[_0x385c8f(0xb4)](_0x385c8f(0xf2),_0x385c8f(0xd5)),_0x242681['redirect'](_0x385c8f(0xdb));_0x567413[_0x385c8f(0xad)]['forEach'](_0x2cdd5f=>{var _0x34cf7c=_0x385c8f;const _0x2fa967=_0x4181cd[_0x34cf7c(0xd2)][_0x34cf7c(0xd7)](_0x43eb6a=>{var _0x1fccb9=_0x34cf7c;_0x43eb6a[_0x1fccb9(0xb7)]==_0x2cdd5f[_0x1fccb9(0xb7)]&&_0x43eb6a[_0x1fccb9(0x10d)]==_0x2cdd5f[_0x1fccb9(0x10d)]&&_0x43eb6a[_0x1fccb9(0xaf)]==_0x2cdd5f[_0x1fccb9(0xaf)]&&_0x43eb6a[_0x1fccb9(0xa8)]==_0x2cdd5f[_0x1fccb9(0xa8)]&&_0x43eb6a['bay']==_0x2cdd5f['bay']&&(_0x43eb6a[_0x1fccb9(0xe7)]=parseInt(_0x43eb6a[_0x1fccb9(0xe7)])+parseInt(_0x2cdd5f[_0x1fccb9(0xa9)]));});}),console['log'](_0x385c8f(0xb5),_0x4181cd),await _0x4181cd[_0x385c8f(0x105)](),_0x567413[_0x385c8f(0xcb)]=_0x1d04a6,_0x567413['customer']=_0x247ba3,_0x567413[_0x385c8f(0xb9)]=_0x3c665a,_0x567413[_0x385c8f(0xfe)]=_0x5eb7d6,_0x567413['return_sale']=_0x20ff58,_0x567413[_0x385c8f(0xd1)]=_0x5b8823,_0x567413[_0x385c8f(0xa4)]=_0x2f9eb8,_0x567413['ToRoom']=_0x1d5bd9;const _0xbd8d5=await _0x567413['save']();console[_0x385c8f(0x102)](_0x385c8f(0xbf),_0xbd8d5);const _0x534d17=await c_payment_data[_0x385c8f(0x9c)]({'invoice':_0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xcb)],'reason':_0x385c8f(0xbc)});_0x534d17[_0x385c8f(0xef)]=_0xf09272[_0x385c8f(0xf8)][_0x385c8f(0xef)],_0x534d17['date']=_0xf09272['body']['date'],await _0x534d17[_0x385c8f(0x105)](),_0xf09272[_0x385c8f(0xb4)](_0x385c8f(0xce),'purchase\x20return\x20successfully'),_0x242681[_0x385c8f(0x109)](_0x385c8f(0x106));}catch(_0x53cf07){console[_0x385c8f(0x102)](_0x53cf07),_0x242681[_0x385c8f(0xf3)](0xc8)[_0x385c8f(0xd9)]({'message':_0x53cf07['message']});}}),router['post'](a0_0x238882(0xd4),auth,async(_0x433f81,_0x138eb8)=>{var _0x32096=a0_0x238882;try{const _0x1f632d=_0x433f81[_0x32096(0xc5)]['id'],{invoice:_0x313c3d,customer:_0x52ddbf,payable_to_customer:_0x465f1b,paid_amount:_0x18bae2}=_0x433f81[_0x32096(0xf8)],_0x437de2=await sales_return[_0x32096(0x104)](_0x1f632d);console[_0x32096(0x102)](_0x32096(0xf9),_0x437de2),console[_0x32096(0x102)](_0x465f1b),console[_0x32096(0x102)](_0x18bae2);var _0x2359bb=_0x465f1b-_0x18bae2;console[_0x32096(0x102)]('subtract',_0x2359bb),_0x437de2[_0x32096(0xec)]=parseFloat(_0x18bae2)+parseFloat(_0x437de2[_0x32096(0xec)]),_0x437de2[_0x32096(0xed)]=_0x2359bb,console['log'](_0x437de2);const _0xdbc022=await _0x437de2['save']();console['log'](0x1b207);const _0x2bee13=await c_payment_data[_0x32096(0x9c)]({'invoice':_0x433f81[_0x32096(0xf8)][_0x32096(0xcb)],'reason':_0x32096(0xbc)});console[_0x32096(0x102)](_0x32096(0xab),_0x2bee13),_0x2bee13[_0x32096(0xdd)]=_0x2359bb,await _0x2bee13[_0x32096(0x105)]();let _0x3c712b=new Date(),_0x2eba48=('0'+_0x3c712b[_0x32096(0xe1)]())[_0x32096(0xcd)](-0x2),_0x481c44=('0'+(_0x3c712b['getMonth']()+0x1))[_0x32096(0xcd)](-0x2),_0x12226f=_0x3c712b['getFullYear'](),_0x47c5b3=_0x12226f+'-'+_0x481c44+'-'+_0x2eba48;const _0x2808e6=new customer_payment({'invoice':_0x313c3d,'date':_0x12226f+'-'+_0x481c44+'-'+_0x2eba48,'customer':_0x52ddbf,'reason':'Returned\x20Payment\x20For\x20Sale\x20Return','amount':_0x18bae2}),_0x1bce7b=await _0x2808e6[_0x32096(0x105)]();_0x433f81[_0x32096(0xb4)](_0x32096(0xce),_0x32096(0x103)),_0x138eb8['redirect'](_0x32096(0x106));}catch(_0x5c0e9a){console[_0x32096(0x102)](_0x5c0e9a);}}),router[a0_0x238882(0xac)](a0_0x238882(0xe3),auth,async(_0x2af712,_0x9631f5)=>{var _0x486280=a0_0x238882;try{const {username:_0x57e970,email:_0x433cfb,role:_0x4556d3}=_0x2af712[_0x486280(0xe8)],_0x403c10=_0x2af712[_0x486280(0xe8)],_0x4edce5=await profile[_0x486280(0x9c)]({'email':_0x403c10[_0x486280(0xf4)]}),_0x43418a=await master_shop[_0x486280(0x100)]();console[_0x486280(0x102)]('master',_0x43418a);const _0x52887d=_0x2af712['params']['id'],_0x5abe90=await sales_return[_0x486280(0x104)](_0x52887d);console['log'](_0x5abe90);const _0x2c0ff9=await customer[_0x486280(0x9c)]({'name':_0x5abe90['customer']});console[_0x486280(0x102)](_0x2c0ff9);if(_0x43418a[0x0][_0x486280(0xc3)]==_0x486280(0xf1)){var _0x30b421=users[_0x486280(0xf0)];console[_0x486280(0x102)](_0x30b421);}else{if(_0x43418a[0x0][_0x486280(0xc3)]==_0x486280(0xca))var _0x30b421=users[_0x486280(0xca)];else{if(_0x43418a[0x0][_0x486280(0xc3)]==_0x486280(0xc9))var _0x30b421=users[_0x486280(0xc9)];else{if(_0x43418a[0x0][_0x486280(0xc3)]==_0x486280(0xf7))var _0x30b421=users[_0x486280(0xf7)];else{if(_0x43418a[0x0]['language']==_0x486280(0x10c))var _0x30b421=users['French'];else{if(_0x43418a[0x0][_0x486280(0xc3)]==_0x486280(0xcf))var _0x30b421=users['Portuguese'];else{if(_0x43418a[0x0][_0x486280(0xc3)]==_0x486280(0x9e))var _0x30b421=users[_0x486280(0x9e)];else{if(_0x43418a[0x0][_0x486280(0xc3)]=='Arabic\x20(ae)')var _0x30b421=users[_0x486280(0xbe)];}}}}}}}_0x9631f5[_0x486280(0xdf)](_0x486280(0xbd),{'success':_0x2af712['flash']('success'),'errors':_0x2af712[_0x486280(0xb4)](_0x486280(0xf2)),'role':_0x403c10,'profile':_0x4edce5,'master_shop':_0x43418a,'customers':_0x2c0ff9,'sales':_0x5abe90,'language':_0x30b421});}catch(_0x3c4baf){console['log'](_0x3c4baf);}}),module['exports']=router;function a0_0x456f(){var _0x2ce517=['280696AHVBTY','bin','return_qty','181422svcmsu','c_payment','get','return_sale','$product_details.floorlevel','type','old_data','stocks','sale_qty','secondary_code','flash','old_warehouse_data','11104093VhDKgY','product_name','foreach\x20newproduct','date','50mnomfW','sales_quantity','Sale\x20Return','sales_return_invoice','Arabic','new\x20new_data','112yEaLrW','bay','Raw\x20Materials','language','$product_details.bay','params','customer_docs','/view','../models/all_models','German','Hindi','invoice','customer','slice','success','Portuguese\x20(BR)','5WACwiK','note','product_details','../middleware/auth','/give_payment/:id','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','types','map','$product_details.secondary_code','json','$product_details','back','return_sale_edit','amount','Return\x20Goods','render','../public/language/languages.json','getDate','sales_return','/invoice/:id','primary_code','aggregate','Return\x20Rooms','product_stock','user','product_code','$product_details.product_stock','1194126irVzgB','paid_amount','due_amount','$name','suppliers','English','English\x20(US)','errors','status','email','all_data','name','Spanish','body','data','199318vZDsVE','Arabic\x20(ae)','forEach','2634cPgMtL','warehouse_name','Router','find','customers','log','payment\x20successfull','findById','save','/sales_return/view','Enabled','1468UUCVAO','redirect','string','ToRoom','French','floorlevel','findOne','$product_details.primary_code','Chinese','post','815058GGrYrN','Portuguese','$product_details.bin','/view/:id','ToWarehouse','stock','$product_details.product_name'];a0_0x456f=function(){return _0x2ce517;};return a0_0x456f();}