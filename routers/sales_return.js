var a0_0x451b77=a0_0x5a4a;(function(_0x53f9c3,_0x522d31){var _0x32fbae=a0_0x5a4a,_0x3796dc=_0x53f9c3();while(!![]){try{var _0xfa2ad5=parseInt(_0x32fbae(0x14c))/0x1*(parseInt(_0x32fbae(0x118))/0x2)+-parseInt(_0x32fbae(0x152))/0x3+parseInt(_0x32fbae(0x150))/0x4+parseInt(_0x32fbae(0x13c))/0x5*(-parseInt(_0x32fbae(0x178))/0x6)+-parseInt(_0x32fbae(0x154))/0x7*(-parseInt(_0x32fbae(0x139))/0x8)+-parseInt(_0x32fbae(0x157))/0x9*(parseInt(_0x32fbae(0x174))/0xa)+-parseInt(_0x32fbae(0x16a))/0xb;if(_0xfa2ad5===_0x522d31)break;else _0x3796dc['push'](_0x3796dc['shift']());}catch(_0x2f3e87){_0x3796dc['push'](_0x3796dc['shift']());}}}(a0_0x47c3,0x54a0d));function a0_0x5a4a(_0x3a9966,_0x421d1d){var _0x47c3d2=a0_0x47c3();return a0_0x5a4a=function(_0x5a4af0,_0x418f62){_0x5a4af0=_0x5a4af0-0x111;var _0x48fb75=_0x47c3d2[_0x5a4af0];return _0x48fb75;},a0_0x5a4a(_0x3a9966,_0x421d1d);}function a0_0x47c3(){var _0x48c448=['789921rnnFGN','paid_amount','331870RdqUfG','$product_details.primary_code','Arabic','9NIAHSm','due_amount','$product_details','stocks','map','../models/all_models','/invoice/:id','purchase\x20return\x20successfully','$product_details.secondary_code','render','customer','back','message','body','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Arabic\x20(ae)','errors','Raw\x20Materials','note','1796938RAbGWZ','find','Hindi','language','getDate','date','$product_details.rack','findById','data','log','885130GcAiQY','Return\x20Rooms','customers','old_warehouse_data','102pVAKYU','bay','../public/language/languages.json','forEach','getMonth','French','exports','slice','type','old_data','$product_details.type','sale_qty','post','product_name','580264hPaOFz','success','ToRoom','product_stock','name','save','express','findOne','invoice','$customer_docs','German','foreach\x20newproduct','email','return_sale','user','Spanish','$product_details.storage','/view/:id','subtract','$name','/view','status','payment\x20successfull','English','product_code','English\x20(US)','aggregate','get','suppliers','Portuguese','sales_quantity','flash','stock','40smOvOP','Portuguese\x20(BR)','sales_return_invoice','138925agkpTo','$product_details.bin','secondary_code','Chinese','primary_code','c_payment','ToWarehouse','redirect','return_qty','master','floorlevel','bin','warehouse_name','product_details','$product_details.floorlevel','all_data','2YoeEcf','$product_details.product_code','params','$product_details.product_stock','2067384PMkOCZ','string'];a0_0x47c3=function(){return _0x48c448;};return a0_0x47c3();}const express=require(a0_0x451b77(0x11e)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,customer_payment,c_payment_data}=require(a0_0x451b77(0x15c)),auth=require('../middleware/auth'),users=require(a0_0x451b77(0x17a));router['get'](a0_0x451b77(0x12c),auth,async(_0x550f9c,_0x4704ea)=>{var _0x3788e2=a0_0x451b77;try{const {username:_0x450076,email:_0xcf49b3,role:_0x5bac26}=_0x550f9c['user'],_0x591eaa=_0x550f9c[_0x3788e2(0x126)],_0x598f2e=await profile['findOne']({'email':_0x591eaa[_0x3788e2(0x124)]}),_0x1d1631=await master_shop[_0x3788e2(0x16b)]();console[_0x3788e2(0x173)]('master',_0x1d1631);const _0x4e20fe=await sales_return['aggregate']([{'$lookup':{'from':_0x3788e2(0x176),'localField':_0x3788e2(0x161),'foreignField':_0x3788e2(0x11c),'as':'customer_docs'}},{'$unwind':_0x3788e2(0x121)}]);console[_0x3788e2(0x173)](_0x3788e2(0x14b),_0x4e20fe);if(_0x1d1631[0x0][_0x3788e2(0x16d)]=='English\x20(US)'){var _0x26b30b=users['English'];console[_0x3788e2(0x173)](_0x26b30b);}else{if(_0x1d1631[0x0][_0x3788e2(0x16d)]==_0x3788e2(0x16c))var _0x26b30b=users['Hindi'];else{if(_0x1d1631[0x0]['language']==_0x3788e2(0x122))var _0x26b30b=users[_0x3788e2(0x122)];else{if(_0x1d1631[0x0][_0x3788e2(0x16d)]=='Spanish')var _0x26b30b=users[_0x3788e2(0x127)];else{if(_0x1d1631[0x0]['language']==_0x3788e2(0x17d))var _0x26b30b=users[_0x3788e2(0x17d)];else{if(_0x1d1631[0x0][_0x3788e2(0x16d)]==_0x3788e2(0x13a))var _0x26b30b=users[_0x3788e2(0x135)];else{if(_0x1d1631[0x0][_0x3788e2(0x16d)]==_0x3788e2(0x13f))var _0x26b30b=users[_0x3788e2(0x13f)];else{if(_0x1d1631[0x0][_0x3788e2(0x16d)]=='Arabic\x20(ae)')var _0x26b30b=users[_0x3788e2(0x156)];}}}}}}}_0x4704ea[_0x3788e2(0x160)]('sales_return',{'success':_0x550f9c[_0x3788e2(0x137)]('success'),'errors':_0x550f9c['flash'](_0x3788e2(0x167)),'role':_0x591eaa,'profile':_0x598f2e,'master_shop':_0x1d1631,'user':_0x4e20fe,'language':_0x26b30b});}catch(_0x272d39){console[_0x3788e2(0x173)](_0x272d39);}}),router[a0_0x451b77(0x133)](a0_0x451b77(0x129),auth,async(_0x40fd73,_0x43a661)=>{var _0x176f5f=a0_0x451b77;try{const {username:_0x509e08,email:_0x4418db,role:_0x2a3689}=_0x40fd73[_0x176f5f(0x126)],_0x42ae54=_0x40fd73[_0x176f5f(0x126)],_0x5b427e=await profile[_0x176f5f(0x11f)]({'email':_0x42ae54[_0x176f5f(0x124)]}),_0x3d5972=await master_shop['find']();console['log'](_0x176f5f(0x145),_0x3d5972);const _0x5d3d55=_0x40fd73[_0x176f5f(0x14e)]['id'];console['log'](_0x5d3d55);var _0x2dda48=[_0x176f5f(0x175)];const _0x336d96=await sales_return[_0x176f5f(0x171)](_0x5d3d55),_0x303b7f=await warehouse[_0x176f5f(0x132)]([{'$match':{'name':_0x336d96[_0x176f5f(0x142)],'room':_0x336d96[_0x176f5f(0x11a)]}},{'$unwind':_0x176f5f(0x159)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x176f5f(0x14f)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x176f5f(0x13d)},'type':{'$first':_0x176f5f(0x114)},'floorlevel':{'$first':_0x176f5f(0x14a)},'primary_code':{'$first':_0x176f5f(0x155)},'secondary_code':{'$first':_0x176f5f(0x15f)},'product_code':{'$first':_0x176f5f(0x14d)},'storage':{'$first':_0x176f5f(0x128)},'rack':{'$first':_0x176f5f(0x170)}}}]);console['log'](_0x303b7f);const _0xeb2e5=await warehouse[_0x176f5f(0x132)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x176f5f(0x168)}},{'$group':{'_id':'$name','name':{'$first':_0x176f5f(0x12b)}}},{'$sort':{'name':0x1}}]),_0x37c8e2=await product[_0x176f5f(0x16b)]({});if(_0x3d5972[0x0][_0x176f5f(0x16d)]=='English\x20(US)'){var _0x4dcf9a=users['English'];console[_0x176f5f(0x173)](_0x4dcf9a);}else{if(_0x3d5972[0x0][_0x176f5f(0x16d)]==_0x176f5f(0x16c))var _0x4dcf9a=users[_0x176f5f(0x16c)];else{if(_0x3d5972[0x0][_0x176f5f(0x16d)]=='German')var _0x4dcf9a=users['German'];else{if(_0x3d5972[0x0][_0x176f5f(0x16d)]==_0x176f5f(0x127))var _0x4dcf9a=users[_0x176f5f(0x127)];else{if(_0x3d5972[0x0][_0x176f5f(0x16d)]==_0x176f5f(0x17d))var _0x4dcf9a=users[_0x176f5f(0x17d)];else{if(_0x3d5972[0x0][_0x176f5f(0x16d)]==_0x176f5f(0x13a))var _0x4dcf9a=users['Portuguese'];else{if(_0x3d5972[0x0]['language']=='Chinese')var _0x4dcf9a=users[_0x176f5f(0x13f)];else{if(_0x3d5972[0x0][_0x176f5f(0x16d)]==_0x176f5f(0x166))var _0x4dcf9a=users['Arabic'];}}}}}}}_0x43a661[_0x176f5f(0x160)]('return_sale_edit',{'success':_0x40fd73['flash'](_0x176f5f(0x119)),'errors':_0x40fd73['flash'](_0x176f5f(0x167)),'role':_0x42ae54,'profile':_0x5b427e,'master_shop':_0x3d5972,'user':_0x336d96,'stock':_0x303b7f,'unit':_0x37c8e2,'language':_0x4dcf9a,'warehouses':_0xeb2e5,'rooms':_0x2dda48});}catch(_0x137af1){console['log'](_0x137af1);}}),router['post'](a0_0x451b77(0x129),auth,async(_0x15f965,_0x3842e9)=>{var _0x70540e=a0_0x451b77;try{const _0x4aca8f=_0x15f965[_0x70540e(0x14e)]['id'];console[_0x70540e(0x173)](_0x4aca8f);const _0x490908=await sales_return[_0x70540e(0x11f)]({'invoice':_0x15f965['body']['invoice']});console[_0x70540e(0x173)](_0x70540e(0x113),_0x490908);const _0x4e99d5=await warehouse[_0x70540e(0x11f)]({'name':_0x490908[_0x70540e(0x142)],'room':_0x490908['ToRoom']});console[_0x70540e(0x173)](_0x70540e(0x177),_0x4e99d5);const {invoice:_0x404387,customer:_0x17f9de,date:_0x3d5775,warehouse_name:_0x1aaf5b,product_name:_0x564517,primary_code:_0xd24e94,secondary_code:_0xd3ccd1,product_code:_0x33a1d6,sales_quantity:_0x10d106,stocks:_0x4c74aa,return_qty:_0x3a266d,note:_0xf2e365,to_warehouse_name:_0x8ccf3d,to_Room_name:_0xf5fa18}=_0x15f965[_0x70540e(0x164)];console[_0x70540e(0x173)](_0x15f965['body']);if(typeof _0x564517==_0x70540e(0x151))var _0x1c44fc=[_0x15f965[_0x70540e(0x164)]['product_name']],_0xe88457=[_0x15f965[_0x70540e(0x164)][_0x70540e(0x140)]],_0x49af74=[_0x15f965[_0x70540e(0x164)][_0x70540e(0x13e)]],_0x2401a9=[_0x15f965['body'][_0x70540e(0x130)]],_0x2d8ff2=[_0x15f965['body']['sales_quantity']],_0x19dbe4=[_0x15f965[_0x70540e(0x164)][_0x70540e(0x15a)]],_0x3b9a1a=[_0x15f965[_0x70540e(0x164)][_0x70540e(0x144)]],_0x4738d4=[_0x15f965[_0x70540e(0x164)][_0x70540e(0x179)]],_0x530e7a=[_0x15f965[_0x70540e(0x164)][_0x70540e(0x147)]],_0x445c07=[_0x15f965[_0x70540e(0x164)]['types']],_0x148a4b=[_0x15f965[_0x70540e(0x164)]['floorlevel']];else var _0x1c44fc=[..._0x15f965['body'][_0x70540e(0x117)]],_0xe88457=[..._0x15f965['body'][_0x70540e(0x140)]],_0x49af74=[..._0x15f965[_0x70540e(0x164)][_0x70540e(0x13e)]],_0x2401a9=[..._0x15f965[_0x70540e(0x164)][_0x70540e(0x130)]],_0x2d8ff2=[..._0x15f965[_0x70540e(0x164)][_0x70540e(0x136)]],_0x19dbe4=[..._0x15f965['body'][_0x70540e(0x15a)]],_0x3b9a1a=[..._0x15f965[_0x70540e(0x164)][_0x70540e(0x144)]],_0x4738d4=[..._0x15f965[_0x70540e(0x164)]['bay']],_0x530e7a=[..._0x15f965[_0x70540e(0x164)]['bin']],_0x445c07=[..._0x15f965['body']['types']],_0x148a4b=[..._0x15f965[_0x70540e(0x164)][_0x70540e(0x146)]];const _0x436131=_0x1c44fc[_0x70540e(0x15b)](_0x58c606=>{return _0x58c606={'product_name':_0x58c606};});_0xe88457[_0x70540e(0x17b)]((_0x202e22,_0x5b2960)=>{var _0x9ba44a=_0x70540e;_0x436131[_0x5b2960][_0x9ba44a(0x140)]=_0x202e22;}),_0x49af74[_0x70540e(0x17b)]((_0x1ac10f,_0x573e4b)=>{var _0x380e5a=_0x70540e;_0x436131[_0x573e4b][_0x380e5a(0x13e)]=_0x1ac10f;}),_0x2401a9[_0x70540e(0x17b)]((_0x12db7a,_0x3fb5be)=>{var _0x20f4f4=_0x70540e;_0x436131[_0x3fb5be][_0x20f4f4(0x130)]=_0x12db7a;}),_0x2d8ff2['forEach']((_0x282a04,_0x42558f)=>{var _0x21bb9c=_0x70540e;_0x436131[_0x42558f][_0x21bb9c(0x115)]=_0x282a04;}),_0x19dbe4[_0x70540e(0x17b)]((_0x57db16,_0x52b368)=>{var _0xdcad97=_0x70540e;_0x436131[_0x52b368][_0xdcad97(0x138)]=_0x57db16;}),_0x3b9a1a[_0x70540e(0x17b)]((_0x2ac204,_0x59abea)=>{var _0x17cf9d=_0x70540e;_0x436131[_0x59abea][_0x17cf9d(0x144)]=_0x2ac204;}),_0x4738d4['forEach']((_0x2821a5,_0x4816e0)=>{var _0x392fbf=_0x70540e;_0x436131[_0x4816e0][_0x392fbf(0x179)]=_0x2821a5;}),_0x530e7a[_0x70540e(0x17b)]((_0xaac856,_0x2b3cfd)=>{_0x436131[_0x2b3cfd]['bin']=_0xaac856;}),_0x445c07[_0x70540e(0x17b)]((_0x4da72b,_0x1987ce)=>{var _0x4aabb7=_0x70540e;_0x436131[_0x1987ce][_0x4aabb7(0x112)]=_0x4da72b;}),_0x148a4b[_0x70540e(0x17b)]((_0x36b1cb,_0x5c6db2)=>{_0x436131[_0x5c6db2]['floorlevel']=_0x36b1cb;});var _0xfdf954=0x0;_0x436131[_0x70540e(0x17b)](_0x22c247=>{var _0x26d29d=_0x70540e;console['log'](_0x26d29d(0x123),_0x22c247),(parseInt(_0x22c247[_0x26d29d(0x115)])<parseInt(_0x22c247['return_qty'])||parseInt(_0x22c247[_0x26d29d(0x138)])<parseInt(_0x22c247[_0x26d29d(0x144)])&&parseInt(_0x22c247[_0x26d29d(0x115)])>parseInt(_0x22c247['return_qty'])||parseInt(_0x22c247[_0x26d29d(0x144)])==0x0)&&_0xfdf954++;});if(_0xfdf954!=0x0)return _0x15f965[_0x70540e(0x137)](_0x70540e(0x167),_0x70540e(0x165)),_0x3842e9[_0x70540e(0x143)](_0x70540e(0x162));_0x490908['return_sale']['forEach'](_0x1f07cf=>{var _0x5934cd=_0x70540e;const _0x403f6a=_0x4e99d5[_0x5934cd(0x149)][_0x5934cd(0x15b)](_0x343f57=>{var _0x416b1d=_0x5934cd;_0x343f57['product_name']==_0x1f07cf[_0x416b1d(0x117)]&&_0x343f57[_0x416b1d(0x146)]==_0x1f07cf[_0x416b1d(0x146)]&&_0x343f57[_0x416b1d(0x112)]==_0x1f07cf[_0x416b1d(0x112)]&&_0x343f57[_0x416b1d(0x147)]==_0x1f07cf['bin']&&_0x343f57[_0x416b1d(0x179)]==_0x1f07cf[_0x416b1d(0x179)]&&(_0x343f57['product_stock']=parseInt(_0x343f57[_0x416b1d(0x11b)])+parseInt(_0x1f07cf[_0x416b1d(0x144)]));});}),console[_0x70540e(0x173)](_0x70540e(0x177),_0x4e99d5),await _0x4e99d5[_0x70540e(0x11d)](),_0x490908['invoice']=_0x404387,_0x490908['customer']=_0x17f9de,_0x490908[_0x70540e(0x16f)]=_0x3d5775,_0x490908[_0x70540e(0x148)]=_0x1aaf5b,_0x490908[_0x70540e(0x125)]=_0x436131,_0x490908[_0x70540e(0x169)]=_0xf2e365,_0x490908[_0x70540e(0x142)]=_0x8ccf3d,_0x490908[_0x70540e(0x11a)]=_0xf5fa18;const _0x5b4082=await _0x490908[_0x70540e(0x11d)]();console[_0x70540e(0x173)]('new\x20new_data',_0x5b4082);const _0x498cc1=await c_payment_data[_0x70540e(0x11f)]({'invoice':_0x15f965[_0x70540e(0x164)][_0x70540e(0x120)],'reason':'Sale\x20Return'});_0x498cc1[_0x70540e(0x134)]=_0x15f965[_0x70540e(0x164)][_0x70540e(0x134)],_0x498cc1[_0x70540e(0x16f)]=_0x15f965[_0x70540e(0x164)][_0x70540e(0x16f)],await _0x498cc1[_0x70540e(0x11d)](),_0x15f965['flash'](_0x70540e(0x119),_0x70540e(0x15e)),_0x3842e9[_0x70540e(0x143)]('/sales_return/view');}catch(_0x1c2864){console[_0x70540e(0x173)](_0x1c2864),_0x3842e9[_0x70540e(0x12d)](0xc8)['json']({'message':_0x1c2864[_0x70540e(0x163)]});}}),router[a0_0x451b77(0x116)]('/give_payment/:id',auth,async(_0x3d7fc3,_0x174fa0)=>{var _0x42eaec=a0_0x451b77;try{const _0x2a162c=_0x3d7fc3[_0x42eaec(0x14e)]['id'],{invoice:_0x370377,customer:_0x1ef6e6,payable_to_customer:_0x59986c,paid_amount:_0x241897}=_0x3d7fc3[_0x42eaec(0x164)],_0x49d181=await sales_return[_0x42eaec(0x171)](_0x2a162c);console[_0x42eaec(0x173)](_0x42eaec(0x172),_0x49d181),console[_0x42eaec(0x173)](_0x59986c),console['log'](_0x241897);var _0x5ae86b=_0x59986c-_0x241897;console[_0x42eaec(0x173)](_0x42eaec(0x12a),_0x5ae86b),_0x49d181[_0x42eaec(0x153)]=parseFloat(_0x241897)+parseFloat(_0x49d181[_0x42eaec(0x153)]),_0x49d181[_0x42eaec(0x158)]=_0x5ae86b,console[_0x42eaec(0x173)](_0x49d181);const _0x4e01c5=await _0x49d181[_0x42eaec(0x11d)]();console[_0x42eaec(0x173)](0x1b207);const _0x276a7c=await c_payment_data[_0x42eaec(0x11f)]({'invoice':_0x3d7fc3[_0x42eaec(0x164)][_0x42eaec(0x120)],'reason':'Sale\x20Return'});console[_0x42eaec(0x173)](_0x42eaec(0x141),_0x276a7c),_0x276a7c['amount']=_0x5ae86b,await _0x276a7c[_0x42eaec(0x11d)]();let _0x545835=new Date(),_0x3d79df=('0'+_0x545835[_0x42eaec(0x16e)]())['slice'](-0x2),_0x5b2abb=('0'+(_0x545835[_0x42eaec(0x17c)]()+0x1))[_0x42eaec(0x111)](-0x2),_0x19b58f=_0x545835['getFullYear'](),_0x4df68b=_0x19b58f+'-'+_0x5b2abb+'-'+_0x3d79df;const _0x45a548=new customer_payment({'invoice':_0x370377,'date':_0x19b58f+'-'+_0x5b2abb+'-'+_0x3d79df,'customer':_0x1ef6e6,'reason':'Returned\x20Payment\x20For\x20Sale\x20Return','amount':_0x241897}),_0x53c633=await _0x45a548[_0x42eaec(0x11d)]();_0x3d7fc3[_0x42eaec(0x137)](_0x42eaec(0x119),_0x42eaec(0x12e)),_0x174fa0[_0x42eaec(0x143)]('/sales_return/view');}catch(_0x584935){console['log'](_0x584935);}}),router[a0_0x451b77(0x133)](a0_0x451b77(0x15d),auth,async(_0x27b106,_0x16f470)=>{var _0x319c16=a0_0x451b77;try{const {username:_0x471feb,email:_0x3dd0a3,role:_0x4b2b6f}=_0x27b106['user'],_0x1e1ae0=_0x27b106[_0x319c16(0x126)],_0x31d587=await profile[_0x319c16(0x11f)]({'email':_0x1e1ae0[_0x319c16(0x124)]}),_0x1aea93=await master_shop[_0x319c16(0x16b)]();console['log']('master',_0x1aea93);const _0x381c21=_0x27b106[_0x319c16(0x14e)]['id'],_0x140a23=await sales_return[_0x319c16(0x171)](_0x381c21);console['log'](_0x140a23);const _0x2d5e6d=await customer[_0x319c16(0x11f)]({'name':_0x140a23[_0x319c16(0x161)]});console[_0x319c16(0x173)](_0x2d5e6d);if(_0x1aea93[0x0][_0x319c16(0x16d)]==_0x319c16(0x131)){var _0xd8fbd7=users[_0x319c16(0x12f)];console[_0x319c16(0x173)](_0xd8fbd7);}else{if(_0x1aea93[0x0][_0x319c16(0x16d)]=='Hindi')var _0xd8fbd7=users['Hindi'];else{if(_0x1aea93[0x0][_0x319c16(0x16d)]==_0x319c16(0x122))var _0xd8fbd7=users[_0x319c16(0x122)];else{if(_0x1aea93[0x0][_0x319c16(0x16d)]==_0x319c16(0x127))var _0xd8fbd7=users[_0x319c16(0x127)];else{if(_0x1aea93[0x0][_0x319c16(0x16d)]==_0x319c16(0x17d))var _0xd8fbd7=users[_0x319c16(0x17d)];else{if(_0x1aea93[0x0]['language']==_0x319c16(0x13a))var _0xd8fbd7=users[_0x319c16(0x135)];else{if(_0x1aea93[0x0][_0x319c16(0x16d)]=='Chinese')var _0xd8fbd7=users['Chinese'];else{if(_0x1aea93[0x0][_0x319c16(0x16d)]==_0x319c16(0x166))var _0xd8fbd7=users[_0x319c16(0x156)];}}}}}}}_0x16f470[_0x319c16(0x160)](_0x319c16(0x13b),{'success':_0x27b106[_0x319c16(0x137)](_0x319c16(0x119)),'errors':_0x27b106[_0x319c16(0x137)]('errors'),'role':_0x1e1ae0,'profile':_0x31d587,'master_shop':_0x1aea93,'customers':_0x2d5e6d,'sales':_0x140a23,'language':_0xd8fbd7});}catch(_0x51cc21){console[_0x319c16(0x173)](_0x51cc21);}}),module[a0_0x451b77(0x17e)]=router;