function a0_0x2bf2(_0x57c8bb,_0x5f0536){var _0x570b9d=a0_0x570b();return a0_0x2bf2=function(_0x2bf290,_0xaecc4f){_0x2bf290=_0x2bf290-0x131;var _0x41b11a=_0x570b9d[_0x2bf290];return _0x41b11a;},a0_0x2bf2(_0x57c8bb,_0x5f0536);}var a0_0x2c43b0=a0_0x2bf2;(function(_0x3d954b,_0x5952f8){var _0x5016d0=a0_0x2bf2,_0x13b573=_0x3d954b();while(!![]){try{var _0x365d65=parseInt(_0x5016d0(0x15b))/0x1+-parseInt(_0x5016d0(0x149))/0x2*(parseInt(_0x5016d0(0x167))/0x3)+parseInt(_0x5016d0(0x165))/0x4+-parseInt(_0x5016d0(0x135))/0x5+-parseInt(_0x5016d0(0x131))/0x6+parseInt(_0x5016d0(0x15f))/0x7+-parseInt(_0x5016d0(0x137))/0x8*(-parseInt(_0x5016d0(0x15d))/0x9);if(_0x365d65===_0x5952f8)break;else _0x13b573['push'](_0x13b573['shift']());}catch(_0x27e754){_0x13b573['push'](_0x13b573['shift']());}}}(a0_0x570b,0x1b9b8));const express=require(a0_0x2c43b0(0x16a)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,customer_payment,c_payment_data}=require(a0_0x2c43b0(0x14f)),auth=require('../middleware/auth'),users=require('../public/language/languages.json');router['get'](a0_0x2c43b0(0x146),auth,async(_0xf2ca1e,_0x345f7c)=>{var _0x11d6e1=a0_0x2c43b0;try{const {username:_0x5f2e29,email:_0x285f8f,role:_0xe32f7b}=_0xf2ca1e[_0x11d6e1(0x196)],_0x181e2a=_0xf2ca1e[_0x11d6e1(0x196)],_0x90fcec=await profile[_0x11d6e1(0x14c)]({'email':_0x181e2a[_0x11d6e1(0x186)]}),_0x118650=await master_shop['find']();console['log']('master',_0x118650);const _0x5632b9=await sales_return['aggregate']([{'$lookup':{'from':'customers','localField':_0x11d6e1(0x162),'foreignField':_0x11d6e1(0x153),'as':_0x11d6e1(0x193)}},{'$unwind':'$customer_docs'}]);console['log']('all_data',_0x5632b9);if(_0x118650[0x0][_0x11d6e1(0x180)]==_0x11d6e1(0x166)){var _0x3e08b9=users[_0x11d6e1(0x181)];console[_0x11d6e1(0x16b)](_0x3e08b9);}else{if(_0x118650[0x0]['language']==_0x11d6e1(0x197))var _0x3e08b9=users[_0x11d6e1(0x197)];else{if(_0x118650[0x0][_0x11d6e1(0x180)]==_0x11d6e1(0x152))var _0x3e08b9=users[_0x11d6e1(0x152)];else{if(_0x118650[0x0][_0x11d6e1(0x180)]==_0x11d6e1(0x188))var _0x3e08b9=users['Spanish'];else{if(_0x118650[0x0][_0x11d6e1(0x180)]==_0x11d6e1(0x17b))var _0x3e08b9=users[_0x11d6e1(0x17b)];else{if(_0x118650[0x0][_0x11d6e1(0x180)]=='Portuguese\x20(BR)')var _0x3e08b9=users['Portuguese'];else{if(_0x118650[0x0][_0x11d6e1(0x180)]==_0x11d6e1(0x134))var _0x3e08b9=users[_0x11d6e1(0x134)];else{if(_0x118650[0x0]['language']==_0x11d6e1(0x13a))var _0x3e08b9=users[_0x11d6e1(0x187)];}}}}}}}_0x345f7c[_0x11d6e1(0x138)](_0x11d6e1(0x170),{'success':_0xf2ca1e[_0x11d6e1(0x157)](_0x11d6e1(0x184)),'errors':_0xf2ca1e[_0x11d6e1(0x157)]('errors'),'role':_0x181e2a,'profile':_0x90fcec,'master_shop':_0x118650,'user':_0x5632b9,'language':_0x3e08b9});}catch(_0x1ecb5d){console[_0x11d6e1(0x16b)](_0x1ecb5d);}}),router[a0_0x2c43b0(0x18c)]('/view/:id',auth,async(_0x47cc6,_0x389a67)=>{var _0x57cf1a=a0_0x2c43b0;try{const {username:_0xac173a,email:_0x20320c,role:_0xc8331}=_0x47cc6[_0x57cf1a(0x196)],_0x340b49=_0x47cc6['user'],_0x140108=await profile[_0x57cf1a(0x14c)]({'email':_0x340b49['email']}),_0x3fea4c=await master_shop[_0x57cf1a(0x13b)]();console['log'](_0x57cf1a(0x194),_0x3fea4c);const _0x1976cc=_0x47cc6[_0x57cf1a(0x141)]['id'];console[_0x57cf1a(0x16b)](_0x1976cc);var _0x2d0d92=['Return\x20Rooms'];const _0x5b3508=await sales_return[_0x57cf1a(0x18a)](_0x1976cc),_0x511522=await warehouse[_0x57cf1a(0x17f)]([{'$match':{'name':_0x5b3508[_0x57cf1a(0x185)],'room':_0x5b3508[_0x57cf1a(0x140)]}},{'$unwind':_0x57cf1a(0x159)},{'$group':{'_id':_0x57cf1a(0x190),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x57cf1a(0x155)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x57cf1a(0x17c)},'floorlevel':{'$first':_0x57cf1a(0x132)},'primary_code':{'$first':_0x57cf1a(0x163)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x57cf1a(0x144)},'rack':{'$first':_0x57cf1a(0x182)}}}]);console[_0x57cf1a(0x16b)](_0x511522);const _0xcf1f0e=await warehouse[_0x57cf1a(0x17f)]([{'$match':{'status':_0x57cf1a(0x192),'name':_0x57cf1a(0x154),'warehouse_category':_0x57cf1a(0x18b)}},{'$group':{'_id':_0x57cf1a(0x145),'name':{'$first':_0x57cf1a(0x145)}}},{'$sort':{'name':0x1}}]),_0x107536=await product[_0x57cf1a(0x13b)]({});if(_0x3fea4c[0x0]['language']==_0x57cf1a(0x166)){var _0x4991e3=users[_0x57cf1a(0x181)];console[_0x57cf1a(0x16b)](_0x4991e3);}else{if(_0x3fea4c[0x0][_0x57cf1a(0x180)]==_0x57cf1a(0x197))var _0x4991e3=users['Hindi'];else{if(_0x3fea4c[0x0][_0x57cf1a(0x180)]==_0x57cf1a(0x152))var _0x4991e3=users[_0x57cf1a(0x152)];else{if(_0x3fea4c[0x0][_0x57cf1a(0x180)]=='Spanish')var _0x4991e3=users[_0x57cf1a(0x188)];else{if(_0x3fea4c[0x0][_0x57cf1a(0x180)]==_0x57cf1a(0x17b))var _0x4991e3=users[_0x57cf1a(0x17b)];else{if(_0x3fea4c[0x0][_0x57cf1a(0x180)]==_0x57cf1a(0x133))var _0x4991e3=users[_0x57cf1a(0x176)];else{if(_0x3fea4c[0x0][_0x57cf1a(0x180)]==_0x57cf1a(0x134))var _0x4991e3=users[_0x57cf1a(0x134)];else{if(_0x3fea4c[0x0][_0x57cf1a(0x180)]=='Arabic\x20(ae)')var _0x4991e3=users[_0x57cf1a(0x187)];}}}}}}}_0x389a67[_0x57cf1a(0x138)]('return_sale_edit',{'success':_0x47cc6[_0x57cf1a(0x157)](_0x57cf1a(0x184)),'errors':_0x47cc6['flash'](_0x57cf1a(0x177)),'role':_0x340b49,'profile':_0x140108,'master_shop':_0x3fea4c,'user':_0x5b3508,'stock':_0x511522,'unit':_0x107536,'language':_0x4991e3,'warehouses':_0xcf1f0e,'rooms':_0x2d0d92});}catch(_0x31b575){console['log'](_0x31b575);}}),router[a0_0x2c43b0(0x178)](a0_0x2c43b0(0x18e),auth,async(_0x398476,_0xf9d3e8)=>{var _0x34a026=a0_0x2c43b0;try{const _0x133e97=_0x398476[_0x34a026(0x141)]['id'];console[_0x34a026(0x16b)](_0x133e97);const _0x200b39=await sales_return[_0x34a026(0x14c)]({'invoice':_0x398476[_0x34a026(0x189)][_0x34a026(0x174)]});console[_0x34a026(0x16b)](_0x34a026(0x164),_0x200b39);const _0x153db2=await warehouse[_0x34a026(0x14c)]({'name':_0x200b39[_0x34a026(0x185)],'room':_0x200b39[_0x34a026(0x140)]});console[_0x34a026(0x16b)](_0x34a026(0x16d),_0x153db2);const {invoice:_0x210b66,customer:_0x53c3fa,date:_0x30befc,warehouse_name:_0x387ed6,product_name:_0x2642ec,primary_code:_0x2d1bf6,secondary_code:_0x3cce38,product_code:_0x501794,sales_quantity:_0x45f285,stocks:_0x38efa8,return_qty:_0x4a8987,note:_0x39c25a,to_warehouse_name:_0x4b77b9,to_Room_name:_0x339ebd}=_0x398476['body'];console[_0x34a026(0x16b)](_0x398476[_0x34a026(0x189)]);if(typeof _0x2642ec==_0x34a026(0x161))var _0x3597a3=[_0x398476[_0x34a026(0x189)][_0x34a026(0x150)]],_0x453cfc=[_0x398476[_0x34a026(0x189)][_0x34a026(0x16e)]],_0x45e1a3=[_0x398476[_0x34a026(0x189)]['secondary_code']],_0x59e8ef=[_0x398476[_0x34a026(0x189)]['product_code']],_0x54351e=[_0x398476['body'][_0x34a026(0x15a)]],_0x104c7e=[_0x398476[_0x34a026(0x189)][_0x34a026(0x160)]],_0x4e454d=[_0x398476[_0x34a026(0x189)][_0x34a026(0x16f)]],_0x144257=[_0x398476[_0x34a026(0x189)]['bay']],_0x2478cb=[_0x398476['body']['bin']],_0x8e0316=[_0x398476['body'][_0x34a026(0x17d)]],_0x27fdca=[_0x398476['body'][_0x34a026(0x13c)]];else var _0x3597a3=[..._0x398476[_0x34a026(0x189)][_0x34a026(0x150)]],_0x453cfc=[..._0x398476[_0x34a026(0x189)][_0x34a026(0x16e)]],_0x45e1a3=[..._0x398476['body'][_0x34a026(0x148)]],_0x59e8ef=[..._0x398476[_0x34a026(0x189)]['product_code']],_0x54351e=[..._0x398476[_0x34a026(0x189)][_0x34a026(0x15a)]],_0x104c7e=[..._0x398476[_0x34a026(0x189)]['stocks']],_0x4e454d=[..._0x398476[_0x34a026(0x189)][_0x34a026(0x16f)]],_0x144257=[..._0x398476[_0x34a026(0x189)]['bay']],_0x2478cb=[..._0x398476[_0x34a026(0x189)]['bin']],_0x8e0316=[..._0x398476[_0x34a026(0x189)][_0x34a026(0x17d)]],_0x27fdca=[..._0x398476[_0x34a026(0x189)][_0x34a026(0x13c)]];const _0x21e633=_0x3597a3['map'](_0x115a6d=>{return _0x115a6d={'product_name':_0x115a6d};});_0x453cfc[_0x34a026(0x13e)]((_0x28f348,_0x53992d)=>{var _0x265409=_0x34a026;_0x21e633[_0x53992d][_0x265409(0x16e)]=_0x28f348;}),_0x45e1a3['forEach']((_0x420acc,_0x44e19a)=>{_0x21e633[_0x44e19a]['secondary_code']=_0x420acc;}),_0x59e8ef[_0x34a026(0x13e)]((_0x5d6243,_0xc8d68e)=>{_0x21e633[_0xc8d68e]['product_code']=_0x5d6243;}),_0x54351e['forEach']((_0x4eb115,_0x18d348)=>{var _0x50065b=_0x34a026;_0x21e633[_0x18d348][_0x50065b(0x195)]=_0x4eb115;}),_0x104c7e[_0x34a026(0x13e)]((_0x2cd2e1,_0x153cf8)=>{var _0x5bdb97=_0x34a026;_0x21e633[_0x153cf8][_0x5bdb97(0x14d)]=_0x2cd2e1;}),_0x4e454d[_0x34a026(0x13e)]((_0x1cc8bb,_0x11f3d5)=>{var _0x3b770c=_0x34a026;_0x21e633[_0x11f3d5][_0x3b770c(0x16f)]=_0x1cc8bb;}),_0x144257[_0x34a026(0x13e)]((_0x988090,_0x60a6d2)=>{var _0x41d065=_0x34a026;_0x21e633[_0x60a6d2][_0x41d065(0x198)]=_0x988090;}),_0x2478cb[_0x34a026(0x13e)]((_0x1d44d0,_0x5afe31)=>{_0x21e633[_0x5afe31]['bin']=_0x1d44d0;}),_0x8e0316[_0x34a026(0x13e)]((_0x1139da,_0x11c37f)=>{_0x21e633[_0x11c37f]['type']=_0x1139da;}),_0x27fdca[_0x34a026(0x13e)]((_0x33b41a,_0x334f05)=>{var _0x3e81fb=_0x34a026;_0x21e633[_0x334f05][_0x3e81fb(0x13c)]=_0x33b41a;});var _0x8e153e=0x0;_0x21e633['forEach'](_0x2d0ce4=>{var _0x68a617=_0x34a026;console['log'](_0x68a617(0x169),_0x2d0ce4),(parseInt(_0x2d0ce4[_0x68a617(0x195)])<parseInt(_0x2d0ce4['return_qty'])||parseInt(_0x2d0ce4['stock'])<parseInt(_0x2d0ce4[_0x68a617(0x16f)])&&parseInt(_0x2d0ce4[_0x68a617(0x195)])>parseInt(_0x2d0ce4[_0x68a617(0x16f)])||parseInt(_0x2d0ce4[_0x68a617(0x16f)])==0x0)&&_0x8e153e++;});if(_0x8e153e!=0x0)return _0x398476['flash'](_0x34a026(0x177),_0x34a026(0x14e)),_0xf9d3e8['redirect']('back');_0x200b39[_0x34a026(0x14a)][_0x34a026(0x13e)](_0x233506=>{var _0x4399d3=_0x34a026;const _0x570281=_0x153db2[_0x4399d3(0x15e)][_0x4399d3(0x16c)](_0x5ba6b9=>{var _0x196419=_0x4399d3;_0x5ba6b9[_0x196419(0x150)]==_0x233506[_0x196419(0x150)]&&_0x5ba6b9[_0x196419(0x13c)]==_0x233506[_0x196419(0x13c)]&&_0x5ba6b9['type']==_0x233506[_0x196419(0x171)]&&_0x5ba6b9[_0x196419(0x13f)]==_0x233506['bin']&&_0x5ba6b9[_0x196419(0x198)]==_0x233506[_0x196419(0x198)]&&(_0x5ba6b9[_0x196419(0x173)]=parseInt(_0x5ba6b9[_0x196419(0x173)])+parseInt(_0x233506['return_qty']));});}),console[_0x34a026(0x16b)]('old_warehouse_data',_0x153db2),await _0x153db2[_0x34a026(0x14b)](),_0x200b39['invoice']=_0x210b66,_0x200b39[_0x34a026(0x162)]=_0x53c3fa,_0x200b39[_0x34a026(0x158)]=_0x30befc,_0x200b39[_0x34a026(0x17e)]=_0x387ed6,_0x200b39[_0x34a026(0x14a)]=_0x21e633,_0x200b39[_0x34a026(0x17a)]=_0x39c25a,_0x200b39['ToWarehouse']=_0x4b77b9,_0x200b39[_0x34a026(0x140)]=_0x339ebd;const _0x249ebf=await _0x200b39[_0x34a026(0x14b)]();console[_0x34a026(0x16b)](_0x34a026(0x175),_0x249ebf);const _0x5cc327=await c_payment_data['findOne']({'invoice':_0x398476[_0x34a026(0x189)]['invoice'],'reason':_0x34a026(0x191)});_0x5cc327['suppliers']=_0x398476[_0x34a026(0x189)]['suppliers'],_0x5cc327[_0x34a026(0x158)]=_0x398476[_0x34a026(0x189)][_0x34a026(0x158)],await _0x5cc327[_0x34a026(0x14b)](),_0x398476[_0x34a026(0x157)](_0x34a026(0x184),'purchase\x20return\x20successfully'),_0xf9d3e8['redirect']('/sales_return/view');}catch(_0x1b79af){console['log'](_0x1b79af),_0xf9d3e8[_0x34a026(0x139)](0xc8)['json']({'message':_0x1b79af[_0x34a026(0x168)]});}}),router[a0_0x2c43b0(0x178)](a0_0x2c43b0(0x13d),auth,async(_0x4e7a23,_0x3b6157)=>{var _0x1b74e0=a0_0x2c43b0;try{const _0x43ae56=_0x4e7a23['params']['id'],{invoice:_0x12b876,customer:_0x3b9e33,payable_to_customer:_0xc1785b,paid_amount:_0x34626d}=_0x4e7a23['body'],_0x557c27=await sales_return[_0x1b74e0(0x18a)](_0x43ae56);console[_0x1b74e0(0x16b)](_0x1b74e0(0x151),_0x557c27),console[_0x1b74e0(0x16b)](_0xc1785b),console['log'](_0x34626d);var _0x38f363=_0xc1785b-_0x34626d;console[_0x1b74e0(0x16b)](_0x1b74e0(0x183),_0x38f363),_0x557c27[_0x1b74e0(0x179)]=parseFloat(_0x34626d)+parseFloat(_0x557c27[_0x1b74e0(0x179)]),_0x557c27[_0x1b74e0(0x143)]=_0x38f363,console[_0x1b74e0(0x16b)](_0x557c27);const _0x4cd06b=await _0x557c27[_0x1b74e0(0x14b)]();console['log'](0x1b207);const _0x303bb0=await c_payment_data['findOne']({'invoice':_0x4e7a23[_0x1b74e0(0x189)]['invoice'],'reason':_0x1b74e0(0x191)});console[_0x1b74e0(0x16b)](_0x1b74e0(0x156),_0x303bb0),_0x303bb0[_0x1b74e0(0x136)]=_0x38f363,await _0x303bb0[_0x1b74e0(0x14b)]();let _0x305320=new Date(),_0x22b790=('0'+_0x305320['getDate']())[_0x1b74e0(0x147)](-0x2),_0x1f76a1=('0'+(_0x305320['getMonth']()+0x1))[_0x1b74e0(0x147)](-0x2),_0x5b9fd8=_0x305320[_0x1b74e0(0x142)](),_0x55f352=_0x5b9fd8+'-'+_0x1f76a1+'-'+_0x22b790;const _0x40dc48=new customer_payment({'invoice':_0x12b876,'date':_0x5b9fd8+'-'+_0x1f76a1+'-'+_0x22b790,'customer':_0x3b9e33,'reason':_0x1b74e0(0x18f),'amount':_0x34626d}),_0x471634=await _0x40dc48['save']();_0x4e7a23['flash'](_0x1b74e0(0x184),'payment\x20successfull'),_0x3b6157['redirect'](_0x1b74e0(0x172));}catch(_0x3f4f42){console[_0x1b74e0(0x16b)](_0x3f4f42);}}),router[a0_0x2c43b0(0x18c)]('/invoice/:id',auth,async(_0x29ec66,_0x1bd17e)=>{var _0x1c763d=a0_0x2c43b0;try{const {username:_0x9e3a63,email:_0x197fdf,role:_0x345714}=_0x29ec66[_0x1c763d(0x196)],_0x531747=_0x29ec66[_0x1c763d(0x196)],_0x17ec06=await profile['findOne']({'email':_0x531747['email']}),_0x5c8c3c=await master_shop['find']();console[_0x1c763d(0x16b)](_0x1c763d(0x194),_0x5c8c3c);const _0x290407=_0x29ec66[_0x1c763d(0x141)]['id'],_0x25c153=await sales_return[_0x1c763d(0x18a)](_0x290407);console[_0x1c763d(0x16b)](_0x25c153);const _0x22085a=await customer[_0x1c763d(0x14c)]({'name':_0x25c153[_0x1c763d(0x162)]});console['log'](_0x22085a);if(_0x5c8c3c[0x0][_0x1c763d(0x180)]==_0x1c763d(0x166)){var _0x171bed=users['English'];console[_0x1c763d(0x16b)](_0x171bed);}else{if(_0x5c8c3c[0x0][_0x1c763d(0x180)]==_0x1c763d(0x197))var _0x171bed=users[_0x1c763d(0x197)];else{if(_0x5c8c3c[0x0]['language']==_0x1c763d(0x152))var _0x171bed=users[_0x1c763d(0x152)];else{if(_0x5c8c3c[0x0][_0x1c763d(0x180)]==_0x1c763d(0x188))var _0x171bed=users[_0x1c763d(0x188)];else{if(_0x5c8c3c[0x0]['language']==_0x1c763d(0x17b))var _0x171bed=users[_0x1c763d(0x17b)];else{if(_0x5c8c3c[0x0]['language']==_0x1c763d(0x133))var _0x171bed=users[_0x1c763d(0x176)];else{if(_0x5c8c3c[0x0]['language']=='Chinese')var _0x171bed=users['Chinese'];else{if(_0x5c8c3c[0x0][_0x1c763d(0x180)]=='Arabic\x20(ae)')var _0x171bed=users[_0x1c763d(0x187)];}}}}}}}_0x1bd17e[_0x1c763d(0x138)](_0x1c763d(0x15c),{'success':_0x29ec66['flash']('success'),'errors':_0x29ec66['flash'](_0x1c763d(0x177)),'role':_0x531747,'profile':_0x17ec06,'master_shop':_0x5c8c3c,'customers':_0x22085a,'sales':_0x25c153,'language':_0x171bed});}catch(_0x419731){console['log'](_0x419731);}}),module[a0_0x2c43b0(0x18d)]=router;function a0_0x570b(){var _0x569caa=['floorlevel','/give_payment/:id','forEach','bin','ToRoom','params','getFullYear','due_amount','$product_details.storage','$name','/view','slice','secondary_code','4114RGcoGD','return_sale','save','findOne','stock','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','../models/all_models','product_name','data','German','name','Return\x20Goods','$product_details.product_stock','c_payment','flash','date','$product_details','sales_quantity','61633AllnFd','sales_return_invoice','86580uaqxsM','product_details','673197RQcuXy','stocks','string','customer','$product_details.primary_code','old_data','477260DSsVaB','English\x20(US)','18qvLCEw','message','foreach\x20newproduct','express','log','map','old_warehouse_data','primary_code','return_qty','sales_return','type','/sales_return/view','product_stock','invoice','new\x20new_data','Portuguese','errors','post','paid_amount','note','French','$product_details.type','types','warehouse_name','aggregate','language','English','$product_details.rack','subtract','success','ToWarehouse','email','Arabic','Spanish','body','findById','Raw\x20Materials','get','exports','/view/:id','Returned\x20Payment\x20For\x20Sale\x20Return','$product_details._id','Sale\x20Return','Enabled','customer_docs','master','sale_qty','user','Hindi','bay','926970jQjhLa','$product_details.floorlevel','Portuguese\x20(BR)','Chinese','851810zhpnRO','amount','144UMOSez','render','status','Arabic\x20(ae)','find'];a0_0x570b=function(){return _0x569caa;};return a0_0x570b();}