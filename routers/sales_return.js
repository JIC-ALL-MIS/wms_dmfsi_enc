var a0_0x478983=a0_0x3427;(function(_0x3946fb,_0x5200ef){var _0x2f1273=a0_0x3427,_0xb65061=_0x3946fb();while(!![]){try{var _0x5ee146=-parseInt(_0x2f1273(0x17e))/0x1+-parseInt(_0x2f1273(0x15f))/0x2+parseInt(_0x2f1273(0x193))/0x3*(parseInt(_0x2f1273(0x17d))/0x4)+-parseInt(_0x2f1273(0x192))/0x5*(-parseInt(_0x2f1273(0x172))/0x6)+parseInt(_0x2f1273(0x180))/0x7+-parseInt(_0x2f1273(0x17c))/0x8+-parseInt(_0x2f1273(0x1ac))/0x9*(-parseInt(_0x2f1273(0x1b9))/0xa);if(_0x5ee146===_0x5200ef)break;else _0xb65061['push'](_0xb65061['shift']());}catch(_0x5687c6){_0xb65061['push'](_0xb65061['shift']());}}}(a0_0x5d6f,0x52ff8));function a0_0x3427(_0x312846,_0x172d87){var _0x5d6f61=a0_0x5d6f();return a0_0x3427=function(_0x3427ad,_0x4e8207){_0x3427ad=_0x3427ad-0x14f;var _0x21292f=_0x5d6f61[_0x3427ad];return _0x21292f;},a0_0x3427(_0x312846,_0x172d87);}const express=require(a0_0x478983(0x15e)),app=express(),router=express[a0_0x478983(0x151)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,customer_payment,c_payment_data}=require(a0_0x478983(0x14f)),auth=require('../middleware/auth'),users=require(a0_0x478983(0x199));function a0_0x5d6f(){var _0x1a0373=['Router','map','$product_details.bay','Portuguese\x20(BR)','data','customer_docs','email','post','$name','secondary_code','French','$product_details','flash','express','812028unTwmx','get','params','sale_qty','Raw\x20Materials','$product_details.storage','subtract','/view','exports','Sale\x20Return','findOne','return_sale_edit','ToRoom','/view/:id','invoice','$product_details.product_code','master','types','Portuguese','1685028wXNxAR','Arabic\x20(ae)','due_amount','forEach','German','findById','warehouse_name','product_code','c_payment','$product_details.bin','2642496jxpyTu','64flvMCb','157945MiGjgM','return_qty','668052HKbQoB','ToWarehouse','payment\x20successfull','/give_payment/:id','return_sale','back','success','log','errors','sales_return_invoice','language','message','render','stock','/sales_return/view','user','$product_details._id','/invoice/:id','5Xuuctx','103023SYcMVE','bay','suppliers','name','Return\x20Goods','primary_code','../public/language/languages.json','bin','old_warehouse_data','Hindi','English','getFullYear','customer','redirect','old_data','stocks','$product_details.product_name','$customer_docs','$product_details.type','body','foreach\x20newproduct','find','customers','type','date','9RfaqOu','Spanish','Arabic','product_name','$product_details.primary_code','floorlevel','all_data','getDate','$product_details.floorlevel','save','slice','paid_amount','English\x20(US)','3085010whhtLb','Chinese','aggregate','json','../models/all_models','$product_details.secondary_code'];a0_0x5d6f=function(){return _0x1a0373;};return a0_0x5d6f();}router[a0_0x478983(0x160)](a0_0x478983(0x166),auth,async(_0x56e390,_0x1d10a0)=>{var _0x14f630=a0_0x478983;try{const {username:_0x414fa7,email:_0x519c2e,role:_0x21120d}=_0x56e390[_0x14f630(0x18f)],_0x47b0f7=_0x56e390[_0x14f630(0x18f)],_0x293818=await profile[_0x14f630(0x169)]({'email':_0x47b0f7[_0x14f630(0x157)]}),_0x49b878=await master_shop[_0x14f630(0x1a8)]();console[_0x14f630(0x187)](_0x14f630(0x16f),_0x49b878);const _0x1e8465=await sales_return[_0x14f630(0x1bb)]([{'$lookup':{'from':_0x14f630(0x1a9),'localField':_0x14f630(0x19f),'foreignField':_0x14f630(0x196),'as':_0x14f630(0x156)}},{'$unwind':_0x14f630(0x1a4)}]);console[_0x14f630(0x187)](_0x14f630(0x1b2),_0x1e8465);if(_0x49b878[0x0]['language']=='English\x20(US)'){var _0x4b85d9=users[_0x14f630(0x19d)];console[_0x14f630(0x187)](_0x4b85d9);}else{if(_0x49b878[0x0]['language']==_0x14f630(0x19c))var _0x4b85d9=users['Hindi'];else{if(_0x49b878[0x0][_0x14f630(0x18a)]==_0x14f630(0x176))var _0x4b85d9=users[_0x14f630(0x176)];else{if(_0x49b878[0x0][_0x14f630(0x18a)]==_0x14f630(0x1ad))var _0x4b85d9=users[_0x14f630(0x1ad)];else{if(_0x49b878[0x0][_0x14f630(0x18a)]==_0x14f630(0x15b))var _0x4b85d9=users[_0x14f630(0x15b)];else{if(_0x49b878[0x0]['language']==_0x14f630(0x154))var _0x4b85d9=users['Portuguese'];else{if(_0x49b878[0x0][_0x14f630(0x18a)]==_0x14f630(0x1ba))var _0x4b85d9=users['Chinese'];else{if(_0x49b878[0x0][_0x14f630(0x18a)]==_0x14f630(0x173))var _0x4b85d9=users[_0x14f630(0x1ae)];}}}}}}}_0x1d10a0[_0x14f630(0x18c)]('sales_return',{'success':_0x56e390[_0x14f630(0x15d)]('success'),'errors':_0x56e390[_0x14f630(0x15d)](_0x14f630(0x188)),'role':_0x47b0f7,'profile':_0x293818,'master_shop':_0x49b878,'user':_0x1e8465,'language':_0x4b85d9});}catch(_0x1409ec){console['log'](_0x1409ec);}}),router[a0_0x478983(0x160)]('/view/:id',auth,async(_0x393392,_0x562491)=>{var _0x186411=a0_0x478983;try{const {username:_0x16efc2,email:_0x4f2100,role:_0x3703f5}=_0x393392['user'],_0x54a5e1=_0x393392['user'],_0x24796a=await profile[_0x186411(0x169)]({'email':_0x54a5e1['email']}),_0x3ae03e=await master_shop['find']();console[_0x186411(0x187)](_0x186411(0x16f),_0x3ae03e);const _0x42156f=_0x393392[_0x186411(0x161)]['id'];console['log'](_0x42156f);var _0x25dc05=['Return\x20Rooms'];const _0x552d70=await sales_return[_0x186411(0x177)](_0x42156f),_0x5220f4=await warehouse[_0x186411(0x1bb)]([{'$match':{'name':_0x552d70[_0x186411(0x181)],'room':_0x552d70[_0x186411(0x16b)]}},{'$unwind':_0x186411(0x15c)},{'$group':{'_id':_0x186411(0x190),'name':{'$first':_0x186411(0x1a3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x186411(0x153)},'bin':{'$first':_0x186411(0x17b)},'type':{'$first':_0x186411(0x1a5)},'floorlevel':{'$first':_0x186411(0x1b4)},'primary_code':{'$first':_0x186411(0x1b0)},'secondary_code':{'$first':_0x186411(0x150)},'product_code':{'$first':_0x186411(0x16e)},'storage':{'$first':_0x186411(0x164)},'rack':{'$first':'$product_details.rack'}}}]);console['log'](_0x5220f4);const _0x60d4db=await warehouse[_0x186411(0x1bb)]([{'$match':{'status':'Enabled','name':_0x186411(0x197),'warehouse_category':_0x186411(0x163)}},{'$group':{'_id':_0x186411(0x159),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),_0x14a28f=await product[_0x186411(0x1a8)]({});if(_0x3ae03e[0x0][_0x186411(0x18a)]==_0x186411(0x1b8)){var _0x264531=users[_0x186411(0x19d)];console[_0x186411(0x187)](_0x264531);}else{if(_0x3ae03e[0x0][_0x186411(0x18a)]==_0x186411(0x19c))var _0x264531=users['Hindi'];else{if(_0x3ae03e[0x0]['language']=='German')var _0x264531=users['German'];else{if(_0x3ae03e[0x0]['language']==_0x186411(0x1ad))var _0x264531=users[_0x186411(0x1ad)];else{if(_0x3ae03e[0x0][_0x186411(0x18a)]=='French')var _0x264531=users[_0x186411(0x15b)];else{if(_0x3ae03e[0x0][_0x186411(0x18a)]==_0x186411(0x154))var _0x264531=users[_0x186411(0x171)];else{if(_0x3ae03e[0x0][_0x186411(0x18a)]==_0x186411(0x1ba))var _0x264531=users[_0x186411(0x1ba)];else{if(_0x3ae03e[0x0][_0x186411(0x18a)]==_0x186411(0x173))var _0x264531=users[_0x186411(0x1ae)];}}}}}}}_0x562491[_0x186411(0x18c)](_0x186411(0x16a),{'success':_0x393392[_0x186411(0x15d)](_0x186411(0x186)),'errors':_0x393392[_0x186411(0x15d)](_0x186411(0x188)),'role':_0x54a5e1,'profile':_0x24796a,'master_shop':_0x3ae03e,'user':_0x552d70,'stock':_0x5220f4,'unit':_0x14a28f,'language':_0x264531,'warehouses':_0x60d4db,'rooms':_0x25dc05});}catch(_0x4d27b7){console[_0x186411(0x187)](_0x4d27b7);}}),router[a0_0x478983(0x158)](a0_0x478983(0x16c),auth,async(_0x422817,_0x266220)=>{var _0x108b46=a0_0x478983;try{const _0x58cadb=_0x422817[_0x108b46(0x161)]['id'];console[_0x108b46(0x187)](_0x58cadb);const _0x19f971=await sales_return['findOne']({'invoice':_0x422817['body'][_0x108b46(0x16d)]});console['log'](_0x108b46(0x1a1),_0x19f971);const _0x24bbcc=await warehouse[_0x108b46(0x169)]({'name':_0x19f971['ToWarehouse'],'room':_0x19f971['ToRoom']});console[_0x108b46(0x187)](_0x108b46(0x19b),_0x24bbcc);const {invoice:_0x5efb33,customer:_0x3cf57f,date:_0x1be8c2,warehouse_name:_0x88c758,product_name:_0x221066,primary_code:_0x194f59,secondary_code:_0x14522a,product_code:_0x3a41f8,sales_quantity:_0x44ebbb,stocks:_0x3dc174,return_qty:_0x5c8163,note:_0x45f9ea,to_warehouse_name:_0x41fc75,to_Room_name:_0x4fa4e7}=_0x422817[_0x108b46(0x1a6)];console['log'](_0x422817[_0x108b46(0x1a6)]);if(typeof _0x221066=='string')var _0x48f9c6=[_0x422817[_0x108b46(0x1a6)][_0x108b46(0x1af)]],_0x5733b4=[_0x422817[_0x108b46(0x1a6)][_0x108b46(0x198)]],_0x32902c=[_0x422817[_0x108b46(0x1a6)][_0x108b46(0x15a)]],_0x244ed8=[_0x422817[_0x108b46(0x1a6)]['product_code']],_0x4658f5=[_0x422817['body']['sales_quantity']],_0x46f601=[_0x422817[_0x108b46(0x1a6)][_0x108b46(0x1a2)]],_0x545078=[_0x422817['body'][_0x108b46(0x17f)]],_0x505a51=[_0x422817['body'][_0x108b46(0x194)]],_0x34ae99=[_0x422817['body']['bin']],_0x3273d5=[_0x422817['body']['types']],_0x510d0e=[_0x422817[_0x108b46(0x1a6)][_0x108b46(0x1b1)]];else var _0x48f9c6=[..._0x422817[_0x108b46(0x1a6)][_0x108b46(0x1af)]],_0x5733b4=[..._0x422817[_0x108b46(0x1a6)][_0x108b46(0x198)]],_0x32902c=[..._0x422817['body'][_0x108b46(0x15a)]],_0x244ed8=[..._0x422817['body'][_0x108b46(0x179)]],_0x4658f5=[..._0x422817[_0x108b46(0x1a6)]['sales_quantity']],_0x46f601=[..._0x422817['body'][_0x108b46(0x1a2)]],_0x545078=[..._0x422817['body']['return_qty']],_0x505a51=[..._0x422817[_0x108b46(0x1a6)][_0x108b46(0x194)]],_0x34ae99=[..._0x422817[_0x108b46(0x1a6)][_0x108b46(0x19a)]],_0x3273d5=[..._0x422817[_0x108b46(0x1a6)][_0x108b46(0x170)]],_0x510d0e=[..._0x422817[_0x108b46(0x1a6)][_0x108b46(0x1b1)]];const _0x13ba90=_0x48f9c6[_0x108b46(0x152)](_0x342af8=>{return _0x342af8={'product_name':_0x342af8};});_0x5733b4['forEach']((_0x126aa2,_0x38e3b4)=>{var _0x1f0132=_0x108b46;_0x13ba90[_0x38e3b4][_0x1f0132(0x198)]=_0x126aa2;}),_0x32902c[_0x108b46(0x175)]((_0x56fa86,_0x5d44f4)=>{var _0x4802e3=_0x108b46;_0x13ba90[_0x5d44f4][_0x4802e3(0x15a)]=_0x56fa86;}),_0x244ed8[_0x108b46(0x175)]((_0x5d8f04,_0x12cc9f)=>{_0x13ba90[_0x12cc9f]['product_code']=_0x5d8f04;}),_0x4658f5[_0x108b46(0x175)]((_0x39bca6,_0xf5489a)=>{var _0x42341a=_0x108b46;_0x13ba90[_0xf5489a][_0x42341a(0x162)]=_0x39bca6;}),_0x46f601[_0x108b46(0x175)]((_0x172305,_0x176bcd)=>{var _0x4fb6da=_0x108b46;_0x13ba90[_0x176bcd][_0x4fb6da(0x18d)]=_0x172305;}),_0x545078[_0x108b46(0x175)]((_0x54ab4b,_0x2f2a86)=>{_0x13ba90[_0x2f2a86]['return_qty']=_0x54ab4b;}),_0x505a51['forEach']((_0x23d06d,_0x20a71c)=>{_0x13ba90[_0x20a71c]['bay']=_0x23d06d;}),_0x34ae99[_0x108b46(0x175)]((_0x4d3ad5,_0x4aff96)=>{var _0xc1eb7b=_0x108b46;_0x13ba90[_0x4aff96][_0xc1eb7b(0x19a)]=_0x4d3ad5;}),_0x3273d5[_0x108b46(0x175)]((_0x6f7792,_0x47a277)=>{_0x13ba90[_0x47a277]['type']=_0x6f7792;}),_0x510d0e[_0x108b46(0x175)]((_0x52fb6c,_0x3a8b4a)=>{_0x13ba90[_0x3a8b4a]['floorlevel']=_0x52fb6c;});var _0x4f96d9=0x0;_0x13ba90['forEach'](_0x4a9d94=>{var _0xfbd26e=_0x108b46;console['log'](_0xfbd26e(0x1a7),_0x4a9d94),(parseInt(_0x4a9d94[_0xfbd26e(0x162)])<parseInt(_0x4a9d94[_0xfbd26e(0x17f)])||parseInt(_0x4a9d94[_0xfbd26e(0x18d)])<parseInt(_0x4a9d94[_0xfbd26e(0x17f)])&&parseInt(_0x4a9d94[_0xfbd26e(0x162)])>parseInt(_0x4a9d94[_0xfbd26e(0x17f)])||parseInt(_0x4a9d94[_0xfbd26e(0x17f)])==0x0)&&_0x4f96d9++;});if(_0x4f96d9!=0x0)return _0x422817[_0x108b46(0x15d)](_0x108b46(0x188),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x266220[_0x108b46(0x1a0)](_0x108b46(0x185));_0x19f971[_0x108b46(0x184)][_0x108b46(0x175)](_0x570e24=>{var _0x3caf5d=_0x108b46;const _0x292d7=_0x24bbcc['product_details'][_0x3caf5d(0x152)](_0x5db5f9=>{var _0x227a77=_0x3caf5d;_0x5db5f9[_0x227a77(0x1af)]==_0x570e24[_0x227a77(0x1af)]&&_0x5db5f9[_0x227a77(0x1b1)]==_0x570e24[_0x227a77(0x1b1)]&&_0x5db5f9[_0x227a77(0x1aa)]==_0x570e24['type']&&_0x5db5f9[_0x227a77(0x19a)]==_0x570e24[_0x227a77(0x19a)]&&_0x5db5f9['bay']==_0x570e24[_0x227a77(0x194)]&&(_0x5db5f9['product_stock']=parseInt(_0x5db5f9['product_stock'])+parseInt(_0x570e24['return_qty']));});}),console[_0x108b46(0x187)](_0x108b46(0x19b),_0x24bbcc),await _0x24bbcc['save'](),_0x19f971['invoice']=_0x5efb33,_0x19f971[_0x108b46(0x19f)]=_0x3cf57f,_0x19f971['date']=_0x1be8c2,_0x19f971[_0x108b46(0x178)]=_0x88c758,_0x19f971[_0x108b46(0x184)]=_0x13ba90,_0x19f971['note']=_0x45f9ea,_0x19f971['ToWarehouse']=_0x41fc75,_0x19f971[_0x108b46(0x16b)]=_0x4fa4e7;const _0x184c99=await _0x19f971[_0x108b46(0x1b5)]();console[_0x108b46(0x187)]('new\x20new_data',_0x184c99);const _0x308258=await c_payment_data[_0x108b46(0x169)]({'invoice':_0x422817[_0x108b46(0x1a6)][_0x108b46(0x16d)],'reason':_0x108b46(0x168)});_0x308258[_0x108b46(0x195)]=_0x422817[_0x108b46(0x1a6)][_0x108b46(0x195)],_0x308258['date']=_0x422817[_0x108b46(0x1a6)][_0x108b46(0x1ab)],await _0x308258[_0x108b46(0x1b5)](),_0x422817[_0x108b46(0x15d)](_0x108b46(0x186),'purchase\x20return\x20successfully'),_0x266220[_0x108b46(0x1a0)]('/sales_return/view');}catch(_0x1db9d7){console[_0x108b46(0x187)](_0x1db9d7),_0x266220['status'](0xc8)[_0x108b46(0x1bc)]({'message':_0x1db9d7[_0x108b46(0x18b)]});}}),router[a0_0x478983(0x158)](a0_0x478983(0x183),auth,async(_0x5efd01,_0x391d59)=>{var _0x20b9ae=a0_0x478983;try{const _0x36636c=_0x5efd01[_0x20b9ae(0x161)]['id'],{invoice:_0x4552d6,customer:_0x560092,payable_to_customer:_0x206198,paid_amount:_0x4c07b5}=_0x5efd01[_0x20b9ae(0x1a6)],_0x5d6579=await sales_return[_0x20b9ae(0x177)](_0x36636c);console['log'](_0x20b9ae(0x155),_0x5d6579),console['log'](_0x206198),console['log'](_0x4c07b5);var _0x37c397=_0x206198-_0x4c07b5;console[_0x20b9ae(0x187)](_0x20b9ae(0x165),_0x37c397),_0x5d6579[_0x20b9ae(0x1b7)]=parseFloat(_0x4c07b5)+parseFloat(_0x5d6579[_0x20b9ae(0x1b7)]),_0x5d6579[_0x20b9ae(0x174)]=_0x37c397,console['log'](_0x5d6579);const _0x142e28=await _0x5d6579[_0x20b9ae(0x1b5)]();console[_0x20b9ae(0x187)](0x1b207);const _0x13d8f0=await c_payment_data[_0x20b9ae(0x169)]({'invoice':_0x5efd01[_0x20b9ae(0x1a6)][_0x20b9ae(0x16d)],'reason':'Sale\x20Return'});console[_0x20b9ae(0x187)](_0x20b9ae(0x17a),_0x13d8f0),_0x13d8f0['amount']=_0x37c397,await _0x13d8f0[_0x20b9ae(0x1b5)]();let _0x308fc8=new Date(),_0x4adf73=('0'+_0x308fc8[_0x20b9ae(0x1b3)]())[_0x20b9ae(0x1b6)](-0x2),_0x3bb171=('0'+(_0x308fc8['getMonth']()+0x1))[_0x20b9ae(0x1b6)](-0x2),_0x16e8e2=_0x308fc8[_0x20b9ae(0x19e)](),_0x54977b=_0x16e8e2+'-'+_0x3bb171+'-'+_0x4adf73;const _0x3e7e11=new customer_payment({'invoice':_0x4552d6,'date':_0x16e8e2+'-'+_0x3bb171+'-'+_0x4adf73,'customer':_0x560092,'reason':'Returned\x20Payment\x20For\x20Sale\x20Return','amount':_0x4c07b5}),_0x51bdc7=await _0x3e7e11[_0x20b9ae(0x1b5)]();_0x5efd01['flash']('success',_0x20b9ae(0x182)),_0x391d59[_0x20b9ae(0x1a0)](_0x20b9ae(0x18e));}catch(_0x119a2b){console[_0x20b9ae(0x187)](_0x119a2b);}}),router[a0_0x478983(0x160)](a0_0x478983(0x191),auth,async(_0x126ce8,_0x4d73dd)=>{var _0x4cac09=a0_0x478983;try{const {username:_0x468b60,email:_0x5dc453,role:_0x41ec09}=_0x126ce8[_0x4cac09(0x18f)],_0x1af5db=_0x126ce8['user'],_0x448101=await profile[_0x4cac09(0x169)]({'email':_0x1af5db[_0x4cac09(0x157)]}),_0x30e90c=await master_shop[_0x4cac09(0x1a8)]();console[_0x4cac09(0x187)](_0x4cac09(0x16f),_0x30e90c);const _0x3e6f3c=_0x126ce8[_0x4cac09(0x161)]['id'],_0x3024bd=await sales_return['findById'](_0x3e6f3c);console[_0x4cac09(0x187)](_0x3024bd);const _0x365c64=await customer[_0x4cac09(0x169)]({'name':_0x3024bd['customer']});console['log'](_0x365c64);if(_0x30e90c[0x0][_0x4cac09(0x18a)]==_0x4cac09(0x1b8)){var _0x1a0dcc=users[_0x4cac09(0x19d)];console['log'](_0x1a0dcc);}else{if(_0x30e90c[0x0][_0x4cac09(0x18a)]=='Hindi')var _0x1a0dcc=users[_0x4cac09(0x19c)];else{if(_0x30e90c[0x0]['language']==_0x4cac09(0x176))var _0x1a0dcc=users[_0x4cac09(0x176)];else{if(_0x30e90c[0x0][_0x4cac09(0x18a)]==_0x4cac09(0x1ad))var _0x1a0dcc=users[_0x4cac09(0x1ad)];else{if(_0x30e90c[0x0][_0x4cac09(0x18a)]=='French')var _0x1a0dcc=users[_0x4cac09(0x15b)];else{if(_0x30e90c[0x0][_0x4cac09(0x18a)]==_0x4cac09(0x154))var _0x1a0dcc=users[_0x4cac09(0x171)];else{if(_0x30e90c[0x0]['language']==_0x4cac09(0x1ba))var _0x1a0dcc=users[_0x4cac09(0x1ba)];else{if(_0x30e90c[0x0][_0x4cac09(0x18a)]==_0x4cac09(0x173))var _0x1a0dcc=users[_0x4cac09(0x1ae)];}}}}}}}_0x4d73dd[_0x4cac09(0x18c)](_0x4cac09(0x189),{'success':_0x126ce8[_0x4cac09(0x15d)]('success'),'errors':_0x126ce8[_0x4cac09(0x15d)]('errors'),'role':_0x1af5db,'profile':_0x448101,'master_shop':_0x30e90c,'customers':_0x365c64,'sales':_0x3024bd,'language':_0x1a0dcc});}catch(_0x36ca4b){console['log'](_0x36ca4b);}}),module[a0_0x478983(0x167)]=router;