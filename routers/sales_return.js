function a0_0x3276(){var _0x1bfae5=['flash','1908WVJZwZ','errors','old_data','status','$name','log','find','back','312tZFaqj','/view','customer','product_stock','/sales_return/view','11AVmgSZ','customers','Returned\x20Payment\x20For\x20Sale\x20Return','sales_quantity','payment\x20successfull','English','ToWarehouse','English\x20(US)','suppliers','findOne','991430VfbJFu','/view/:id','post','master','getFullYear','slice','invoice','4OqpUuP','aggregate','return_sale_edit','53287ohBSPK','../public/language/languages.json','Hindi','sale_qty','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','272142wsalBs','due_amount','stocks','1389168fobyGn','language','secondary_code','note','customer_docs','Router','$product_details','1vUGzxm','sales_return_invoice','$product_details.floorlevel','forEach','bin','render','$product_details.storage','body','product_code','params','success','$product_details.product_code','getMonth','product_details','../models/all_models','Chinese','Portuguese','subtract','redirect','1043690OVqtNL','Enabled','amount','6EEoNle','$product_details.type','foreach\x20newproduct','product_name','return_sale','bay','../middleware/auth','French','c_payment','warehouse_name','email','German','string','floorlevel','data','paid_amount','$product_details._id','type','Raw\x20Materials','37380YtQfTA','save','Arabic\x20(ae)','776775jIWGQb','$product_details.bin','date','exports','old_warehouse_data','findById','sales_return','map','$customer_docs','$product_details.bay','Portuguese\x20(BR)','Spanish','user','types','Arabic','$product_details.primary_code','message','ToRoom','return_qty','primary_code'];a0_0x3276=function(){return _0x1bfae5;};return a0_0x3276();}var a0_0xba9db1=a0_0x4971;(function(_0xce4061,_0x561bf4){var _0x350836=a0_0x4971,_0x3911df=_0xce4061();while(!![]){try{var _0x148027=-parseInt(_0x350836(0x18a))/0x1*(parseInt(_0x350836(0x180))/0x2)+parseInt(_0x350836(0x145))/0x3*(parseInt(_0x350836(0x178))/0x4)+parseInt(_0x350836(0x19d))/0x5*(parseInt(_0x350836(0x1a0))/0x6)+-parseInt(_0x350836(0x142))/0x7*(-parseInt(_0x350836(0x162))/0x8)+parseInt(_0x350836(0x183))/0x9+-parseInt(_0x350836(0x171))/0xa*(-parseInt(_0x350836(0x167))/0xb)+-parseInt(_0x350836(0x15a))/0xc*(parseInt(_0x350836(0x17b))/0xd);if(_0x148027===_0x561bf4)break;else _0x3911df['push'](_0x3911df['shift']());}catch(_0x216c99){_0x3911df['push'](_0x3911df['shift']());}}}(a0_0x3276,0x22926));const express=require('express'),app=express(),router=express[a0_0xba9db1(0x188)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,customer_payment,c_payment_data}=require(a0_0xba9db1(0x198)),auth=require(a0_0xba9db1(0x1a6)),users=require(a0_0xba9db1(0x17c));function a0_0x4971(_0x5c52ea,_0x1c28c3){var _0x3276fc=a0_0x3276();return a0_0x4971=function(_0x49711c,_0x1c3937){_0x49711c=_0x49711c-0x137;var _0xbf22bf=_0x3276fc[_0x49711c];return _0xbf22bf;},a0_0x4971(_0x5c52ea,_0x1c28c3);}router['get'](a0_0xba9db1(0x163),auth,async(_0x5efbbe,_0x3b9ee4)=>{var _0x398214=a0_0xba9db1;try{const {username:_0x37927e,email:_0x2a14c2,role:_0x290b58}=_0x5efbbe[_0x398214(0x151)],_0x30eae2=_0x5efbbe[_0x398214(0x151)],_0x5c1a2c=await profile[_0x398214(0x170)]({'email':_0x30eae2[_0x398214(0x139)]}),_0x590594=await master_shop[_0x398214(0x160)]();console[_0x398214(0x15f)](_0x398214(0x174),_0x590594);const _0x1100f6=await sales_return[_0x398214(0x179)]([{'$lookup':{'from':_0x398214(0x168),'localField':_0x398214(0x164),'foreignField':'name','as':_0x398214(0x187)}},{'$unwind':_0x398214(0x14d)}]);console['log']('all_data',_0x1100f6);if(_0x590594[0x0][_0x398214(0x184)]==_0x398214(0x16e)){var _0x36d0a9=users['English'];console[_0x398214(0x15f)](_0x36d0a9);}else{if(_0x590594[0x0][_0x398214(0x184)]==_0x398214(0x17d))var _0x36d0a9=users[_0x398214(0x17d)];else{if(_0x590594[0x0][_0x398214(0x184)]==_0x398214(0x13a))var _0x36d0a9=users[_0x398214(0x13a)];else{if(_0x590594[0x0][_0x398214(0x184)]==_0x398214(0x150))var _0x36d0a9=users[_0x398214(0x150)];else{if(_0x590594[0x0]['language']==_0x398214(0x1a7))var _0x36d0a9=users['French'];else{if(_0x590594[0x0]['language']=='Portuguese\x20(BR)')var _0x36d0a9=users['Portuguese'];else{if(_0x590594[0x0][_0x398214(0x184)]=='Chinese')var _0x36d0a9=users[_0x398214(0x199)];else{if(_0x590594[0x0][_0x398214(0x184)]==_0x398214(0x144))var _0x36d0a9=users[_0x398214(0x153)];}}}}}}}_0x3b9ee4[_0x398214(0x18f)](_0x398214(0x14b),{'success':_0x5efbbe[_0x398214(0x159)](_0x398214(0x194)),'errors':_0x5efbbe[_0x398214(0x159)](_0x398214(0x15b)),'role':_0x30eae2,'profile':_0x5c1a2c,'master_shop':_0x590594,'user':_0x1100f6,'language':_0x36d0a9});}catch(_0x378eab){console['log'](_0x378eab);}}),router['get'](a0_0xba9db1(0x172),auth,async(_0x2109b4,_0x3d7578)=>{var _0x5abec7=a0_0xba9db1;try{const {username:_0xe4d3c8,email:_0x51827c,role:_0x2ebdcb}=_0x2109b4[_0x5abec7(0x151)],_0x62595b=_0x2109b4[_0x5abec7(0x151)],_0x5677a5=await profile[_0x5abec7(0x170)]({'email':_0x62595b['email']}),_0x4485a3=await master_shop[_0x5abec7(0x160)]();console[_0x5abec7(0x15f)]('master',_0x4485a3);const _0x52d3c5=_0x2109b4['params']['id'];console['log'](_0x52d3c5);var _0x1a03ae=['Return\x20Rooms'];const _0x78e398=await sales_return[_0x5abec7(0x14a)](_0x52d3c5),_0x408321=await warehouse[_0x5abec7(0x179)]([{'$match':{'name':_0x78e398[_0x5abec7(0x16d)],'room':_0x78e398[_0x5abec7(0x156)]}},{'$unwind':_0x5abec7(0x189)},{'$group':{'_id':_0x5abec7(0x13f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5abec7(0x14e)},'bin':{'$first':_0x5abec7(0x146)},'type':{'$first':_0x5abec7(0x1a1)},'floorlevel':{'$first':_0x5abec7(0x18c)},'primary_code':{'$first':_0x5abec7(0x154)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5abec7(0x195)},'storage':{'$first':_0x5abec7(0x190)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x5abec7(0x15f)](_0x408321);const _0x18d00d=await warehouse[_0x5abec7(0x179)]([{'$match':{'status':_0x5abec7(0x19e),'name':'Return\x20Goods','warehouse_category':_0x5abec7(0x141)}},{'$group':{'_id':_0x5abec7(0x15e),'name':{'$first':_0x5abec7(0x15e)}}},{'$sort':{'name':0x1}}]),_0x316066=await product['find']({});if(_0x4485a3[0x0]['language']==_0x5abec7(0x16e)){var _0x5dd0fc=users[_0x5abec7(0x16c)];console[_0x5abec7(0x15f)](_0x5dd0fc);}else{if(_0x4485a3[0x0]['language']==_0x5abec7(0x17d))var _0x5dd0fc=users['Hindi'];else{if(_0x4485a3[0x0][_0x5abec7(0x184)]==_0x5abec7(0x13a))var _0x5dd0fc=users[_0x5abec7(0x13a)];else{if(_0x4485a3[0x0][_0x5abec7(0x184)]==_0x5abec7(0x150))var _0x5dd0fc=users[_0x5abec7(0x150)];else{if(_0x4485a3[0x0][_0x5abec7(0x184)]==_0x5abec7(0x1a7))var _0x5dd0fc=users['French'];else{if(_0x4485a3[0x0][_0x5abec7(0x184)]==_0x5abec7(0x14f))var _0x5dd0fc=users['Portuguese'];else{if(_0x4485a3[0x0][_0x5abec7(0x184)]==_0x5abec7(0x199))var _0x5dd0fc=users[_0x5abec7(0x199)];else{if(_0x4485a3[0x0][_0x5abec7(0x184)]==_0x5abec7(0x144))var _0x5dd0fc=users[_0x5abec7(0x153)];}}}}}}}_0x3d7578[_0x5abec7(0x18f)](_0x5abec7(0x17a),{'success':_0x2109b4[_0x5abec7(0x159)](_0x5abec7(0x194)),'errors':_0x2109b4[_0x5abec7(0x159)]('errors'),'role':_0x62595b,'profile':_0x5677a5,'master_shop':_0x4485a3,'user':_0x78e398,'stock':_0x408321,'unit':_0x316066,'language':_0x5dd0fc,'warehouses':_0x18d00d,'rooms':_0x1a03ae});}catch(_0x32c123){console['log'](_0x32c123);}}),router[a0_0xba9db1(0x173)](a0_0xba9db1(0x172),auth,async(_0x597496,_0x588057)=>{var _0x2f74f5=a0_0xba9db1;try{const _0x535466=_0x597496[_0x2f74f5(0x193)]['id'];console[_0x2f74f5(0x15f)](_0x535466);const _0x15a87f=await sales_return[_0x2f74f5(0x170)]({'invoice':_0x597496['body'][_0x2f74f5(0x177)]});console[_0x2f74f5(0x15f)](_0x2f74f5(0x15c),_0x15a87f);const _0x1f3c31=await warehouse[_0x2f74f5(0x170)]({'name':_0x15a87f[_0x2f74f5(0x16d)],'room':_0x15a87f[_0x2f74f5(0x156)]});console['log'](_0x2f74f5(0x149),_0x1f3c31);const {invoice:_0x1356b5,customer:_0xfc2bf2,date:_0x1bccc4,warehouse_name:_0xfd3d06,product_name:_0x57b4a4,primary_code:_0x27ff7b,secondary_code:_0x3392f1,product_code:_0x405a01,sales_quantity:_0x23d382,stocks:_0x5ba293,return_qty:_0x3b0f41,note:_0x29534f,to_warehouse_name:_0x21fc30,to_Room_name:_0x1849a6}=_0x597496['body'];console['log'](_0x597496[_0x2f74f5(0x191)]);if(typeof _0x57b4a4==_0x2f74f5(0x13b))var _0x4b4358=[_0x597496['body']['product_name']],_0x292f4c=[_0x597496['body']['primary_code']],_0x3ffb4b=[_0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x185)]],_0x18913f=[_0x597496[_0x2f74f5(0x191)]['product_code']],_0xbdfe21=[_0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x16a)]],_0x35fcfb=[_0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x182)]],_0x57fb78=[_0x597496['body'][_0x2f74f5(0x157)]],_0xf90ef0=[_0x597496['body'][_0x2f74f5(0x1a5)]],_0x33b6b8=[_0x597496['body'][_0x2f74f5(0x18e)]],_0x3f14dc=[_0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x152)]],_0x17b48b=[_0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x13c)]];else var _0x4b4358=[..._0x597496[_0x2f74f5(0x191)]['product_name']],_0x292f4c=[..._0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x158)]],_0x3ffb4b=[..._0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x185)]],_0x18913f=[..._0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x192)]],_0xbdfe21=[..._0x597496[_0x2f74f5(0x191)]['sales_quantity']],_0x35fcfb=[..._0x597496[_0x2f74f5(0x191)]['stocks']],_0x57fb78=[..._0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x157)]],_0xf90ef0=[..._0x597496['body'][_0x2f74f5(0x1a5)]],_0x33b6b8=[..._0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x18e)]],_0x3f14dc=[..._0x597496['body']['types']],_0x17b48b=[..._0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x13c)]];const _0x586606=_0x4b4358[_0x2f74f5(0x14c)](_0x45f05a=>{return _0x45f05a={'product_name':_0x45f05a};});_0x292f4c['forEach']((_0x140461,_0x1ef81d)=>{var _0x2339fe=_0x2f74f5;_0x586606[_0x1ef81d][_0x2339fe(0x158)]=_0x140461;}),_0x3ffb4b[_0x2f74f5(0x18d)]((_0x61bffc,_0x11a708)=>{_0x586606[_0x11a708]['secondary_code']=_0x61bffc;}),_0x18913f['forEach']((_0xc83003,_0x1ed849)=>{_0x586606[_0x1ed849]['product_code']=_0xc83003;}),_0xbdfe21['forEach']((_0x47553c,_0x2ff435)=>{_0x586606[_0x2ff435]['sale_qty']=_0x47553c;}),_0x35fcfb['forEach']((_0x50fa43,_0x3b758e)=>{_0x586606[_0x3b758e]['stock']=_0x50fa43;}),_0x57fb78[_0x2f74f5(0x18d)]((_0x68ffb3,_0x102a97)=>{_0x586606[_0x102a97]['return_qty']=_0x68ffb3;}),_0xf90ef0['forEach']((_0x37765c,_0x3d6823)=>{var _0x338aaa=_0x2f74f5;_0x586606[_0x3d6823][_0x338aaa(0x1a5)]=_0x37765c;}),_0x33b6b8['forEach']((_0xdb9f8b,_0x1344d4)=>{_0x586606[_0x1344d4]['bin']=_0xdb9f8b;}),_0x3f14dc['forEach']((_0x120292,_0x45e67c)=>{var _0x1391ee=_0x2f74f5;_0x586606[_0x45e67c][_0x1391ee(0x140)]=_0x120292;}),_0x17b48b['forEach']((_0x545310,_0x3bc966)=>{_0x586606[_0x3bc966]['floorlevel']=_0x545310;});var _0xb4ed73=0x0;_0x586606[_0x2f74f5(0x18d)](_0x519658=>{var _0x3446ba=_0x2f74f5;console['log'](_0x3446ba(0x1a2),_0x519658),(parseInt(_0x519658[_0x3446ba(0x17e)])<parseInt(_0x519658['return_qty'])||parseInt(_0x519658['stock'])<parseInt(_0x519658[_0x3446ba(0x157)])&&parseInt(_0x519658[_0x3446ba(0x17e)])>parseInt(_0x519658[_0x3446ba(0x157)])||parseInt(_0x519658[_0x3446ba(0x157)])==0x0)&&_0xb4ed73++;});if(_0xb4ed73!=0x0)return _0x597496[_0x2f74f5(0x159)](_0x2f74f5(0x15b),_0x2f74f5(0x17f)),_0x588057[_0x2f74f5(0x19c)](_0x2f74f5(0x161));_0x15a87f[_0x2f74f5(0x1a4)]['forEach'](_0x58ffc9=>{var _0x47c15c=_0x2f74f5;const _0x248139=_0x1f3c31[_0x47c15c(0x197)][_0x47c15c(0x14c)](_0xd65619=>{var _0x3eaa7c=_0x47c15c;_0xd65619[_0x3eaa7c(0x1a3)]==_0x58ffc9[_0x3eaa7c(0x1a3)]&&_0xd65619['floorlevel']==_0x58ffc9[_0x3eaa7c(0x13c)]&&_0xd65619[_0x3eaa7c(0x140)]==_0x58ffc9['type']&&_0xd65619[_0x3eaa7c(0x18e)]==_0x58ffc9[_0x3eaa7c(0x18e)]&&_0xd65619['bay']==_0x58ffc9[_0x3eaa7c(0x1a5)]&&(_0xd65619[_0x3eaa7c(0x165)]=parseInt(_0xd65619[_0x3eaa7c(0x165)])+parseInt(_0x58ffc9[_0x3eaa7c(0x157)]));});}),console['log']('old_warehouse_data',_0x1f3c31),await _0x1f3c31['save'](),_0x15a87f[_0x2f74f5(0x177)]=_0x1356b5,_0x15a87f['customer']=_0xfc2bf2,_0x15a87f['date']=_0x1bccc4,_0x15a87f[_0x2f74f5(0x138)]=_0xfd3d06,_0x15a87f[_0x2f74f5(0x1a4)]=_0x586606,_0x15a87f[_0x2f74f5(0x186)]=_0x29534f,_0x15a87f['ToWarehouse']=_0x21fc30,_0x15a87f[_0x2f74f5(0x156)]=_0x1849a6;const _0x1253ee=await _0x15a87f[_0x2f74f5(0x143)]();console['log']('new\x20new_data',_0x1253ee);const _0x382bc6=await c_payment_data[_0x2f74f5(0x170)]({'invoice':_0x597496['body'][_0x2f74f5(0x177)],'reason':'Sale\x20Return'});_0x382bc6[_0x2f74f5(0x16f)]=_0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x16f)],_0x382bc6[_0x2f74f5(0x147)]=_0x597496[_0x2f74f5(0x191)][_0x2f74f5(0x147)],await _0x382bc6['save'](),_0x597496[_0x2f74f5(0x159)]('success','purchase\x20return\x20successfully'),_0x588057[_0x2f74f5(0x19c)](_0x2f74f5(0x166));}catch(_0xd4ddb6){console[_0x2f74f5(0x15f)](_0xd4ddb6),_0x588057[_0x2f74f5(0x15d)](0xc8)['json']({'message':_0xd4ddb6[_0x2f74f5(0x155)]});}}),router[a0_0xba9db1(0x173)]('/give_payment/:id',auth,async(_0x4cb21b,_0x3789c7)=>{var _0x5ce517=a0_0xba9db1;try{const _0x1ab5a5=_0x4cb21b[_0x5ce517(0x193)]['id'],{invoice:_0x25f252,customer:_0x51819f,payable_to_customer:_0x3f0eb3,paid_amount:_0x33fb1b}=_0x4cb21b[_0x5ce517(0x191)],_0x1180c2=await sales_return[_0x5ce517(0x14a)](_0x1ab5a5);console[_0x5ce517(0x15f)](_0x5ce517(0x13d),_0x1180c2),console[_0x5ce517(0x15f)](_0x3f0eb3),console[_0x5ce517(0x15f)](_0x33fb1b);var _0xcd372e=_0x3f0eb3-_0x33fb1b;console[_0x5ce517(0x15f)](_0x5ce517(0x19b),_0xcd372e),_0x1180c2['paid_amount']=parseFloat(_0x33fb1b)+parseFloat(_0x1180c2[_0x5ce517(0x13e)]),_0x1180c2[_0x5ce517(0x181)]=_0xcd372e,console[_0x5ce517(0x15f)](_0x1180c2);const _0x2160e1=await _0x1180c2[_0x5ce517(0x143)]();console[_0x5ce517(0x15f)](0x1b207);const _0x45c373=await c_payment_data['findOne']({'invoice':_0x4cb21b[_0x5ce517(0x191)][_0x5ce517(0x177)],'reason':'Sale\x20Return'});console[_0x5ce517(0x15f)](_0x5ce517(0x137),_0x45c373),_0x45c373[_0x5ce517(0x19f)]=_0xcd372e,await _0x45c373[_0x5ce517(0x143)]();let _0x14bb27=new Date(),_0x1875dd=('0'+_0x14bb27['getDate']())[_0x5ce517(0x176)](-0x2),_0x52e4e3=('0'+(_0x14bb27[_0x5ce517(0x196)]()+0x1))['slice'](-0x2),_0x3ba356=_0x14bb27[_0x5ce517(0x175)](),_0x3227fb=_0x3ba356+'-'+_0x52e4e3+'-'+_0x1875dd;const _0x2fe5eb=new customer_payment({'invoice':_0x25f252,'date':_0x3ba356+'-'+_0x52e4e3+'-'+_0x1875dd,'customer':_0x51819f,'reason':_0x5ce517(0x169),'amount':_0x33fb1b}),_0x2d171b=await _0x2fe5eb[_0x5ce517(0x143)]();_0x4cb21b['flash']('success',_0x5ce517(0x16b)),_0x3789c7[_0x5ce517(0x19c)](_0x5ce517(0x166));}catch(_0x590b70){console[_0x5ce517(0x15f)](_0x590b70);}}),router['get']('/invoice/:id',auth,async(_0x100459,_0x35f515)=>{var _0x29e203=a0_0xba9db1;try{const {username:_0x59c7d6,email:_0x3f2edf,role:_0x4517cb}=_0x100459[_0x29e203(0x151)],_0x5974f5=_0x100459[_0x29e203(0x151)],_0xef1e4f=await profile[_0x29e203(0x170)]({'email':_0x5974f5['email']}),_0x734e76=await master_shop[_0x29e203(0x160)]();console[_0x29e203(0x15f)](_0x29e203(0x174),_0x734e76);const _0x1e188d=_0x100459[_0x29e203(0x193)]['id'],_0x9273d2=await sales_return[_0x29e203(0x14a)](_0x1e188d);console[_0x29e203(0x15f)](_0x9273d2);const _0x2465b9=await customer['findOne']({'name':_0x9273d2['customer']});console[_0x29e203(0x15f)](_0x2465b9);if(_0x734e76[0x0][_0x29e203(0x184)]==_0x29e203(0x16e)){var _0x2b14e9=users[_0x29e203(0x16c)];console[_0x29e203(0x15f)](_0x2b14e9);}else{if(_0x734e76[0x0][_0x29e203(0x184)]==_0x29e203(0x17d))var _0x2b14e9=users['Hindi'];else{if(_0x734e76[0x0]['language']==_0x29e203(0x13a))var _0x2b14e9=users[_0x29e203(0x13a)];else{if(_0x734e76[0x0][_0x29e203(0x184)]==_0x29e203(0x150))var _0x2b14e9=users['Spanish'];else{if(_0x734e76[0x0][_0x29e203(0x184)]=='French')var _0x2b14e9=users['French'];else{if(_0x734e76[0x0]['language']==_0x29e203(0x14f))var _0x2b14e9=users[_0x29e203(0x19a)];else{if(_0x734e76[0x0][_0x29e203(0x184)]==_0x29e203(0x199))var _0x2b14e9=users[_0x29e203(0x199)];else{if(_0x734e76[0x0]['language']==_0x29e203(0x144))var _0x2b14e9=users[_0x29e203(0x153)];}}}}}}}_0x35f515[_0x29e203(0x18f)](_0x29e203(0x18b),{'success':_0x100459[_0x29e203(0x159)]('success'),'errors':_0x100459[_0x29e203(0x159)](_0x29e203(0x15b)),'role':_0x5974f5,'profile':_0xef1e4f,'master_shop':_0x734e76,'customers':_0x2465b9,'sales':_0x9273d2,'language':_0x2b14e9});}catch(_0x3eb457){console[_0x29e203(0x15f)](_0x3eb457);}}),module[a0_0xba9db1(0x148)]=router;