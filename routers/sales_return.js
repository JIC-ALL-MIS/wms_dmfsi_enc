var a0_0x2c9dab=a0_0x5e12;(function(_0x2db162,_0x9dd075){var _0x1b6497=a0_0x5e12,_0x1c1b3e=_0x2db162();while(!![]){try{var _0x55cc62=parseInt(_0x1b6497(0xe4))/0x1*(-parseInt(_0x1b6497(0x9e))/0x2)+parseInt(_0x1b6497(0xe0))/0x3+-parseInt(_0x1b6497(0xc8))/0x4+-parseInt(_0x1b6497(0xa8))/0x5+parseInt(_0x1b6497(0x9f))/0x6*(parseInt(_0x1b6497(0xb5))/0x7)+parseInt(_0x1b6497(0xea))/0x8+-parseInt(_0x1b6497(0xba))/0x9*(parseInt(_0x1b6497(0xcd))/0xa);if(_0x55cc62===_0x9dd075)break;else _0x1c1b3e['push'](_0x1c1b3e['shift']());}catch(_0x25a425){_0x1c1b3e['push'](_0x1c1b3e['shift']());}}}(a0_0x406f,0x8ba9a));const express=require('express'),app=express(),router=express[a0_0x2c9dab(0xd3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,customer_payment,c_payment_data}=require(a0_0x2c9dab(0xcf)),auth=require(a0_0x2c9dab(0xc1)),users=require(a0_0x2c9dab(0xac));function a0_0x5e12(_0x5e32d5,_0x5b0b44){var _0x406f4d=a0_0x406f();return a0_0x5e12=function(_0x5e12c7,_0x4a79e4){_0x5e12c7=_0x5e12c7-0x8c;var _0x5263ee=_0x406f4d[_0x5e12c7];return _0x5263ee;},a0_0x5e12(_0x5e32d5,_0x5b0b44);}router[a0_0x2c9dab(0xbc)](a0_0x2c9dab(0xce),auth,async(_0x188e12,_0x161496)=>{var _0x55fa3c=a0_0x2c9dab;try{const {username:_0x5e1d59,email:_0x2d9412,role:_0x4d2c22}=_0x188e12[_0x55fa3c(0xf5)],_0x4a2f8a=_0x188e12[_0x55fa3c(0xf5)],_0x18e360=await profile[_0x55fa3c(0xc3)]({'email':_0x4a2f8a['email']}),_0x1e01e2=await master_shop[_0x55fa3c(0xb9)]();console['log']('master',_0x1e01e2);const _0x49d5cc=await sales_return['aggregate']([{'$lookup':{'from':'customers','localField':_0x55fa3c(0xec),'foreignField':_0x55fa3c(0xbf),'as':_0x55fa3c(0xae)}},{'$unwind':_0x55fa3c(0x9d)}]);console['log']('all_data',_0x49d5cc);if(_0x1e01e2[0x0]['language']=='English\x20(US)'){var _0x5962eb=users['English'];console[_0x55fa3c(0x98)](_0x5962eb);}else{if(_0x1e01e2[0x0]['language']==_0x55fa3c(0xe1))var _0x5962eb=users['Hindi'];else{if(_0x1e01e2[0x0][_0x55fa3c(0xd9)]==_0x55fa3c(0xaa))var _0x5962eb=users[_0x55fa3c(0xaa)];else{if(_0x1e01e2[0x0][_0x55fa3c(0xd9)]==_0x55fa3c(0xd6))var _0x5962eb=users[_0x55fa3c(0xd6)];else{if(_0x1e01e2[0x0][_0x55fa3c(0xd9)]==_0x55fa3c(0x96))var _0x5962eb=users[_0x55fa3c(0x96)];else{if(_0x1e01e2[0x0][_0x55fa3c(0xd9)]==_0x55fa3c(0xe8))var _0x5962eb=users[_0x55fa3c(0x8e)];else{if(_0x1e01e2[0x0][_0x55fa3c(0xd9)]==_0x55fa3c(0xad))var _0x5962eb=users[_0x55fa3c(0xad)];else{if(_0x1e01e2[0x0][_0x55fa3c(0xd9)]==_0x55fa3c(0x90))var _0x5962eb=users[_0x55fa3c(0xd7)];}}}}}}}_0x161496[_0x55fa3c(0x8f)](_0x55fa3c(0xa4),{'success':_0x188e12[_0x55fa3c(0xcb)]('success'),'errors':_0x188e12[_0x55fa3c(0xcb)](_0x55fa3c(0xe9)),'role':_0x4a2f8a,'profile':_0x18e360,'master_shop':_0x1e01e2,'user':_0x49d5cc,'language':_0x5962eb});}catch(_0x51ec7e){console[_0x55fa3c(0x98)](_0x51ec7e);}}),router[a0_0x2c9dab(0xbc)](a0_0x2c9dab(0xf7),auth,async(_0xdcf88e,_0x1fdbd8)=>{var _0x550126=a0_0x2c9dab;try{const {username:_0x3075d7,email:_0x184de5,role:_0x45a3de}=_0xdcf88e[_0x550126(0xf5)],_0x3431ca=_0xdcf88e['user'],_0x18def0=await profile[_0x550126(0xc3)]({'email':_0x3431ca[_0x550126(0x92)]}),_0x3c3866=await master_shop[_0x550126(0xb9)]();console[_0x550126(0x98)](_0x550126(0xbd),_0x3c3866);const _0x182f19=_0xdcf88e[_0x550126(0xca)]['id'];console[_0x550126(0x98)](_0x182f19);var _0x57d481=[_0x550126(0xb2)];const _0x31f46c=await sales_return[_0x550126(0xe6)](_0x182f19),_0x2ac15d=await warehouse['aggregate']([{'$match':{'name':_0x31f46c['ToWarehouse'],'room':_0x31f46c[_0x550126(0xbe)]}},{'$unwind':_0x550126(0xe7)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x550126(0xa6)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x550126(0xf6)},'bin':{'$first':_0x550126(0xa2)},'type':{'$first':_0x550126(0xc2)},'floorlevel':{'$first':_0x550126(0x94)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x550126(0x95)},'storage':{'$first':_0x550126(0xa5)},'rack':{'$first':_0x550126(0xbb)}}}]);console[_0x550126(0x98)](_0x2ac15d);const _0x168973=await warehouse[_0x550126(0xde)]([{'$match':{'status':_0x550126(0x93),'name':'Return\x20Goods','warehouse_category':_0x550126(0x8d)}},{'$group':{'_id':_0x550126(0xb8),'name':{'$first':_0x550126(0xb8)}}},{'$sort':{'name':0x1}}]),_0x230d28=await product[_0x550126(0xb9)]({});if(_0x3c3866[0x0][_0x550126(0xd9)]==_0x550126(0xd2)){var _0x141b01=users['English'];console['log'](_0x141b01);}else{if(_0x3c3866[0x0][_0x550126(0xd9)]==_0x550126(0xe1))var _0x141b01=users[_0x550126(0xe1)];else{if(_0x3c3866[0x0][_0x550126(0xd9)]=='German')var _0x141b01=users['German'];else{if(_0x3c3866[0x0][_0x550126(0xd9)]=='Spanish')var _0x141b01=users[_0x550126(0xd6)];else{if(_0x3c3866[0x0][_0x550126(0xd9)]=='French')var _0x141b01=users[_0x550126(0x96)];else{if(_0x3c3866[0x0][_0x550126(0xd9)]==_0x550126(0xe8))var _0x141b01=users[_0x550126(0x8e)];else{if(_0x3c3866[0x0][_0x550126(0xd9)]=='Chinese')var _0x141b01=users[_0x550126(0xad)];else{if(_0x3c3866[0x0][_0x550126(0xd9)]=='Arabic\x20(ae)')var _0x141b01=users[_0x550126(0xd7)];}}}}}}}_0x1fdbd8['render'](_0x550126(0xb1),{'success':_0xdcf88e[_0x550126(0xcb)](_0x550126(0x99)),'errors':_0xdcf88e[_0x550126(0xcb)](_0x550126(0xe9)),'role':_0x3431ca,'profile':_0x18def0,'master_shop':_0x3c3866,'user':_0x31f46c,'stock':_0x2ac15d,'unit':_0x230d28,'language':_0x141b01,'warehouses':_0x168973,'rooms':_0x57d481});}catch(_0x3cc179){console[_0x550126(0x98)](_0x3cc179);}}),router[a0_0x2c9dab(0x9c)](a0_0x2c9dab(0xf7),auth,async(_0x971008,_0x44aea8)=>{var _0x21c266=a0_0x2c9dab;try{const _0x432060=_0x971008[_0x21c266(0xca)]['id'];console['log'](_0x432060);const _0x19be23=await sales_return[_0x21c266(0xc3)]({'invoice':_0x971008['body'][_0x21c266(0xd0)]});console[_0x21c266(0x98)](_0x21c266(0xdd),_0x19be23);const _0x2e0d18=await warehouse[_0x21c266(0xc3)]({'name':_0x19be23[_0x21c266(0x9b)],'room':_0x19be23[_0x21c266(0xbe)]});console[_0x21c266(0x98)](_0x21c266(0xeb),_0x2e0d18);const {invoice:_0x53fbb0,customer:_0x121366,date:_0x350fe2,warehouse_name:_0x32b603,product_name:_0x3d4fe8,primary_code:_0x27fd1a,secondary_code:_0xcb391d,product_code:_0x269991,sales_quantity:_0x400be9,stocks:_0x3094a2,return_qty:_0x39e354,note:_0x41836a,to_warehouse_name:_0x26131,to_Room_name:_0x212d4f}=_0x971008[_0x21c266(0x97)];console[_0x21c266(0x98)](_0x971008['body']);if(typeof _0x3d4fe8=='string')var _0x4ebb16=[_0x971008[_0x21c266(0x97)][_0x21c266(0x9a)]],_0x29d2be=[_0x971008[_0x21c266(0x97)][_0x21c266(0xef)]],_0x5a582c=[_0x971008[_0x21c266(0x97)][_0x21c266(0xc5)]],_0x1f9548=[_0x971008[_0x21c266(0x97)][_0x21c266(0xd5)]],_0x1f7cab=[_0x971008['body'][_0x21c266(0xf1)]],_0x264ad5=[_0x971008[_0x21c266(0x97)][_0x21c266(0xee)]],_0x2134ce=[_0x971008['body']['return_qty']],_0x42d855=[_0x971008[_0x21c266(0x97)][_0x21c266(0xf4)]],_0x3b0178=[_0x971008[_0x21c266(0x97)]['bin']],_0x40d1d6=[_0x971008[_0x21c266(0x97)][_0x21c266(0xd8)]],_0x12fb40=[_0x971008[_0x21c266(0x97)][_0x21c266(0xf0)]];else var _0x4ebb16=[..._0x971008[_0x21c266(0x97)][_0x21c266(0x9a)]],_0x29d2be=[..._0x971008['body']['primary_code']],_0x5a582c=[..._0x971008[_0x21c266(0x97)]['secondary_code']],_0x1f9548=[..._0x971008[_0x21c266(0x97)][_0x21c266(0xd5)]],_0x1f7cab=[..._0x971008[_0x21c266(0x97)][_0x21c266(0xf1)]],_0x264ad5=[..._0x971008[_0x21c266(0x97)][_0x21c266(0xee)]],_0x2134ce=[..._0x971008[_0x21c266(0x97)][_0x21c266(0xf2)]],_0x42d855=[..._0x971008['body'][_0x21c266(0xf4)]],_0x3b0178=[..._0x971008[_0x21c266(0x97)][_0x21c266(0xc4)]],_0x40d1d6=[..._0x971008['body']['types']],_0x12fb40=[..._0x971008[_0x21c266(0x97)]['floorlevel']];const _0x3de959=_0x4ebb16[_0x21c266(0xd1)](_0x2b934a=>{return _0x2b934a={'product_name':_0x2b934a};});_0x29d2be[_0x21c266(0xa9)]((_0x1a673c,_0x3283cf)=>{var _0x27a044=_0x21c266;_0x3de959[_0x3283cf][_0x27a044(0xef)]=_0x1a673c;}),_0x5a582c[_0x21c266(0xa9)]((_0x3d2bb1,_0x42bf5c)=>{var _0x515bc7=_0x21c266;_0x3de959[_0x42bf5c][_0x515bc7(0xc5)]=_0x3d2bb1;}),_0x1f9548[_0x21c266(0xa9)]((_0x401186,_0x7a3116)=>{var _0x4c3f54=_0x21c266;_0x3de959[_0x7a3116][_0x4c3f54(0xd5)]=_0x401186;}),_0x1f7cab[_0x21c266(0xa9)]((_0x3037f5,_0x41e6c7)=>{_0x3de959[_0x41e6c7]['sale_qty']=_0x3037f5;}),_0x264ad5['forEach']((_0x29359f,_0x38043b)=>{_0x3de959[_0x38043b]['stock']=_0x29359f;}),_0x2134ce['forEach']((_0x9c9b1c,_0x5847d8)=>{var _0x554fe8=_0x21c266;_0x3de959[_0x5847d8][_0x554fe8(0xf2)]=_0x9c9b1c;}),_0x42d855[_0x21c266(0xa9)]((_0x5947f0,_0x19de14)=>{var _0x1b6d8f=_0x21c266;_0x3de959[_0x19de14][_0x1b6d8f(0xf4)]=_0x5947f0;}),_0x3b0178[_0x21c266(0xa9)]((_0x46cc81,_0x1149d5)=>{var _0x271263=_0x21c266;_0x3de959[_0x1149d5][_0x271263(0xc4)]=_0x46cc81;}),_0x40d1d6[_0x21c266(0xa9)]((_0x1d0117,_0x2a362c)=>{var _0x2a82aa=_0x21c266;_0x3de959[_0x2a362c][_0x2a82aa(0xda)]=_0x1d0117;}),_0x12fb40[_0x21c266(0xa9)]((_0x20317f,_0x5bdfcf)=>{var _0x48e94a=_0x21c266;_0x3de959[_0x5bdfcf][_0x48e94a(0xf0)]=_0x20317f;});var _0x24611a=0x0;_0x3de959[_0x21c266(0xa9)](_0x18844f=>{var _0x305984=_0x21c266;console[_0x305984(0x98)](_0x305984(0xdc),_0x18844f),(parseInt(_0x18844f['sale_qty'])<parseInt(_0x18844f[_0x305984(0xf2)])||parseInt(_0x18844f[_0x305984(0xa0)])<parseInt(_0x18844f['return_qty'])&&parseInt(_0x18844f['sale_qty'])>parseInt(_0x18844f[_0x305984(0xf2)])||parseInt(_0x18844f[_0x305984(0xf2)])==0x0)&&_0x24611a++;});if(_0x24611a!=0x0)return _0x971008[_0x21c266(0xcb)](_0x21c266(0xe9),_0x21c266(0xdb)),_0x44aea8[_0x21c266(0xf3)]('back');_0x19be23['return_sale']['forEach'](_0x71f448=>{var _0x129a4a=_0x21c266;const _0xbd7a9e=_0x2e0d18[_0x129a4a(0x8c)][_0x129a4a(0xd1)](_0x27c7a4=>{var _0x235751=_0x129a4a;_0x27c7a4['product_name']==_0x71f448[_0x235751(0x9a)]&&_0x27c7a4[_0x235751(0xf0)]==_0x71f448[_0x235751(0xf0)]&&_0x27c7a4[_0x235751(0xda)]==_0x71f448[_0x235751(0xda)]&&_0x27c7a4[_0x235751(0xc4)]==_0x71f448[_0x235751(0xc4)]&&_0x27c7a4[_0x235751(0xf4)]==_0x71f448[_0x235751(0xf4)]&&(_0x27c7a4['product_stock']=parseInt(_0x27c7a4[_0x235751(0xc0)])+parseInt(_0x71f448['return_qty']));});}),console[_0x21c266(0x98)](_0x21c266(0xeb),_0x2e0d18),await _0x2e0d18[_0x21c266(0xa3)](),_0x19be23[_0x21c266(0xd0)]=_0x53fbb0,_0x19be23[_0x21c266(0xec)]=_0x121366,_0x19be23[_0x21c266(0xe2)]=_0x350fe2,_0x19be23['warehouse_name']=_0x32b603,_0x19be23[_0x21c266(0xcc)]=_0x3de959,_0x19be23['note']=_0x41836a,_0x19be23['ToWarehouse']=_0x26131,_0x19be23[_0x21c266(0xbe)]=_0x212d4f;const _0x1dc5a3=await _0x19be23[_0x21c266(0xa3)]();console[_0x21c266(0x98)]('new\x20new_data',_0x1dc5a3);const _0x1e2497=await c_payment_data[_0x21c266(0xc3)]({'invoice':_0x971008[_0x21c266(0x97)][_0x21c266(0xd0)],'reason':'Sale\x20Return'});_0x1e2497['suppliers']=_0x971008[_0x21c266(0x97)][_0x21c266(0x91)],_0x1e2497[_0x21c266(0xe2)]=_0x971008[_0x21c266(0x97)][_0x21c266(0xe2)],await _0x1e2497['save'](),_0x971008[_0x21c266(0xcb)](_0x21c266(0x99),'purchase\x20return\x20successfully'),_0x44aea8[_0x21c266(0xf3)](_0x21c266(0xb7));}catch(_0x15b67f){console[_0x21c266(0x98)](_0x15b67f),_0x44aea8[_0x21c266(0xf9)](0xc8)[_0x21c266(0xb0)]({'message':_0x15b67f[_0x21c266(0xd4)]});}}),router['post'](a0_0x2c9dab(0xc7),auth,async(_0x5c9296,_0x583fc7)=>{var _0x657c57=a0_0x2c9dab;try{const _0x4cfe59=_0x5c9296['params']['id'],{invoice:_0x59865b,customer:_0x50408b,payable_to_customer:_0x892195,paid_amount:_0x264b56}=_0x5c9296[_0x657c57(0x97)],_0xf54c9=await sales_return[_0x657c57(0xe6)](_0x4cfe59);console[_0x657c57(0x98)]('data',_0xf54c9),console[_0x657c57(0x98)](_0x892195),console[_0x657c57(0x98)](_0x264b56);var _0x4af067=_0x892195-_0x264b56;console[_0x657c57(0x98)](_0x657c57(0xc9),_0x4af067),_0xf54c9[_0x657c57(0xed)]=parseFloat(_0x264b56)+parseFloat(_0xf54c9[_0x657c57(0xed)]),_0xf54c9[_0x657c57(0xe5)]=_0x4af067,console['log'](_0xf54c9);const _0x3bc662=await _0xf54c9[_0x657c57(0xa3)]();console[_0x657c57(0x98)](0x1b207);const _0x4e30cb=await c_payment_data['findOne']({'invoice':_0x5c9296[_0x657c57(0x97)][_0x657c57(0xd0)],'reason':_0x657c57(0xe3)});console[_0x657c57(0x98)]('c_payment',_0x4e30cb),_0x4e30cb[_0x657c57(0xc6)]=_0x4af067,await _0x4e30cb[_0x657c57(0xa3)]();let _0x28a0f9=new Date(),_0x38e056=('0'+_0x28a0f9[_0x657c57(0xaf)]())[_0x657c57(0xa1)](-0x2),_0x3d883f=('0'+(_0x28a0f9[_0x657c57(0xab)]()+0x1))[_0x657c57(0xa1)](-0x2),_0x417356=_0x28a0f9[_0x657c57(0xb6)](),_0x34a242=_0x417356+'-'+_0x3d883f+'-'+_0x38e056;const _0x194d15=new customer_payment({'invoice':_0x59865b,'date':_0x417356+'-'+_0x3d883f+'-'+_0x38e056,'customer':_0x50408b,'reason':_0x657c57(0xb3),'amount':_0x264b56}),_0x5a0dbe=await _0x194d15['save']();_0x5c9296[_0x657c57(0xcb)]('success',_0x657c57(0xdf)),_0x583fc7[_0x657c57(0xf3)]('/sales_return/view');}catch(_0x1c26c2){console[_0x657c57(0x98)](_0x1c26c2);}}),router['get'](a0_0x2c9dab(0xa7),auth,async(_0x3d4777,_0x2836ad)=>{var _0x293170=a0_0x2c9dab;try{const {username:_0x23f6a6,email:_0xf28be0,role:_0x473867}=_0x3d4777[_0x293170(0xf5)],_0x10ce5d=_0x3d4777[_0x293170(0xf5)],_0x30b82b=await profile['findOne']({'email':_0x10ce5d[_0x293170(0x92)]}),_0xb4489b=await master_shop[_0x293170(0xb9)]();console[_0x293170(0x98)](_0x293170(0xbd),_0xb4489b);const _0x4ff505=_0x3d4777[_0x293170(0xca)]['id'],_0x2dfa6b=await sales_return[_0x293170(0xe6)](_0x4ff505);console[_0x293170(0x98)](_0x2dfa6b);const _0x3c0886=await customer[_0x293170(0xc3)]({'name':_0x2dfa6b[_0x293170(0xec)]});console[_0x293170(0x98)](_0x3c0886);if(_0xb4489b[0x0][_0x293170(0xd9)]==_0x293170(0xd2)){var _0x304cbb=users['English'];console['log'](_0x304cbb);}else{if(_0xb4489b[0x0][_0x293170(0xd9)]==_0x293170(0xe1))var _0x304cbb=users[_0x293170(0xe1)];else{if(_0xb4489b[0x0]['language']==_0x293170(0xaa))var _0x304cbb=users[_0x293170(0xaa)];else{if(_0xb4489b[0x0][_0x293170(0xd9)]==_0x293170(0xd6))var _0x304cbb=users[_0x293170(0xd6)];else{if(_0xb4489b[0x0][_0x293170(0xd9)]==_0x293170(0x96))var _0x304cbb=users[_0x293170(0x96)];else{if(_0xb4489b[0x0][_0x293170(0xd9)]==_0x293170(0xe8))var _0x304cbb=users[_0x293170(0x8e)];else{if(_0xb4489b[0x0]['language']==_0x293170(0xad))var _0x304cbb=users['Chinese'];else{if(_0xb4489b[0x0]['language']==_0x293170(0x90))var _0x304cbb=users[_0x293170(0xd7)];}}}}}}}_0x2836ad[_0x293170(0x8f)](_0x293170(0xf8),{'success':_0x3d4777[_0x293170(0xcb)](_0x293170(0x99)),'errors':_0x3d4777[_0x293170(0xcb)]('errors'),'role':_0x10ce5d,'profile':_0x30b82b,'master_shop':_0xb4489b,'customers':_0x3c0886,'sales':_0x2dfa6b,'language':_0x304cbb});}catch(_0x392e87){console[_0x293170(0x98)](_0x392e87);}}),module[a0_0x2c9dab(0xb4)]=router;function a0_0x406f(){var _0x2de029=['status','product_details','Raw\x20Materials','Portuguese','render','Arabic\x20(ae)','suppliers','email','Enabled','$product_details.floorlevel','$product_details.product_code','French','body','log','success','product_name','ToWarehouse','post','$customer_docs','70TDlKCW','12DwWQez','stock','slice','$product_details.bin','save','sales_return','$product_details.storage','$product_details.product_name','/invoice/:id','3490205OoLfty','forEach','German','getMonth','../public/language/languages.json','Chinese','customer_docs','getDate','json','return_sale_edit','Return\x20Rooms','Returned\x20Payment\x20For\x20Sale\x20Return','exports','3868956jwavsq','getFullYear','/sales_return/view','$name','find','9iLxZUc','$product_details.rack','get','master','ToRoom','name','product_stock','../middleware/auth','$product_details.type','findOne','bin','secondary_code','amount','/give_payment/:id','1128400zFHmqg','subtract','params','flash','return_sale','8929450cbuZCn','/view','../models/all_models','invoice','map','English\x20(US)','Router','message','product_code','Spanish','Arabic','types','language','type','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','foreach\x20newproduct','old_data','aggregate','payment\x20successfull','1842849GNMQlf','Hindi','date','Sale\x20Return','3063tafszZ','due_amount','findById','$product_details','Portuguese\x20(BR)','errors','6661200eFIZgb','old_warehouse_data','customer','paid_amount','stocks','primary_code','floorlevel','sales_quantity','return_qty','redirect','bay','user','$product_details.bay','/view/:id','sales_return_invoice'];a0_0x406f=function(){return _0x2de029;};return a0_0x406f();}