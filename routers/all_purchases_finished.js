var a0_0x47546a=a0_0x3097;(function(_0x480c8f,_0x5582c1){var _0x2d142b=a0_0x3097,_0x183a88=_0x480c8f();while(!![]){try{var _0x523f12=-parseInt(_0x2d142b(0xf3))/0x1+parseInt(_0x2d142b(0x11c))/0x2*(-parseInt(_0x2d142b(0x137))/0x3)+-parseInt(_0x2d142b(0x136))/0x4*(parseInt(_0x2d142b(0xc4))/0x5)+parseInt(_0x2d142b(0xbf))/0x6*(parseInt(_0x2d142b(0x127))/0x7)+parseInt(_0x2d142b(0xac))/0x8+-parseInt(_0x2d142b(0x153))/0x9+parseInt(_0x2d142b(0xa3))/0xa;if(_0x523f12===_0x5582c1)break;else _0x183a88['push'](_0x183a88['shift']());}catch(_0x44da79){_0x183a88['push'](_0x183a88['shift']());}}}(a0_0xad67,0x8a50e));const express=require(a0_0x47546a(0x18a)),app=express(),router=express[a0_0x47546a(0x157)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x47546a(0xbe)),auth=require('../middleware/auth'),nodemailer=require(a0_0x47546a(0x139));function a0_0xad67(){var _0x1de60c=['<h5>','secondary_code','FGSEmail','secondary_unit','purchase_invoice','all_purchases_barcode','$return_data','invoice','body','path','MaxStocks_data','get','name','add_purchases\x20error','standard_unit','updateOne','redirect','prod_cat','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','status','stock_quantity','batch_code','note','$maxProdPerUnit','German','English\x20(US)','266697pJUrmy','_id','</td>','stocks','Email\x20sent\x20successfully','$product.type','$date','Return\x20Goods','save','user','$product_code','prod_code','</span>','$secondary_unit','$product_details.product_stock','aggregate','$expiry_date','json','return_product','padStart','findById','return_qty','$warehouse_name','$batch_code','getDate','role','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Rack\x202','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','table\x20page','<html><head><title></title>','image','password','$primary_code','slice','product_cat','floor','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</h5>','246306RpQCdV','createTransport','$product_details.rack','params','Finished\x20Goods','$product.bin','currency_placement','return_purchase_finished','DRY\x20GOODS','prod_name','INCF-','14182ZtavCy','</head><body>','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product.room_name','Enabled','True','add_purchases_finished','$product_details.type','/../public','Paid\x20For\x20Purchase','return_data','purchases\x20item\x20return\x20successfull','Chinese','maxperunit','84IygLGO','3PnyNHv','<div>','nodemailer','max_product_unit','edit_purchases_finished','/preview/:id','success','gmail','warehouse_name','$category','English','ejs','There\x27s\x20a\x20error\x20in\x20this\x20transaction','concat','\x20Order\x20Date\x20:\x20','user_id','$due_amount','exports','/view/:id','email','product_code','$name','suppliers_docs','$paid_amount','Purchase\x20Return\x20Mail','Spanish','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','level','4328163npyUzK','Error\x20occurred\x20while\x20processing\x20product:','room','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Router','string','all','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','\x20Order\x20Number\x20:\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$unit','abs','bay','$invoice','render','prod_invoice','post','RoomAssign','$product_details.primary_code','</thead>','paid_amount','QA\x20Warehouse','find','staff','../public/language/languages.json','back','filter','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/barcode/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','Arabic\x20(ae)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Rack\x201','message','/upload/','/view/add_purchases','flash','master','prod_secondunit','Portuguese','prod_level','suppliers','Error\x20Occurs','$note','prod_primunit','edit_purchases_finished_view','logo','findOne','purchase\x20data\x20add\x20successfully','$product.floorlevel','\x20<>\x20','$product_details.storage','errors','express','$product_details.product_name','due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Purchase\x20Return','$product.bay','sendMail','$alertquantity','catch','forEach','\x20</h2>','/invoice/:id','$suppliers_docs','$product_details.product_code','An\x20error\x20occurred\x20while\x20saving\x20data.','getFullYear','</body></html>','error','</tr>','language','Ambient','</div>','$room','quantity','prod_Qty','$secondary_code','$product','stock_data','</tbody>','Arabic','Logo.png','map','8548250mfSRlv','purchase_quantity','FROZEN\x20GOODS','expiry_date','product_code_hide','getMonth','site_title','prod_qty','/barcode_scanner','4301760lZQrlW','primary_code_hide','<strong>\x20Regards\x20</strong>','random','product_details','length','<span\x20style=\x22float:\x20right;\x22>','/all_purchases_finished/view','Portuguese\x20(BR)','$product_details.floorlevel','JO_number','/view/return_purchase/:id','product_name','warehouse','prod_unit','payment\x20successfull','/CheckingWarehouse','room_name','../models/all_models','720XFuOtN','Purchase\x20Mail','$_id','product_stock','product_date','47230HYpHuL','$product_details.maxProducts','French','$product_details.secondary_code','<tr>','/all_purchases/view','$product.quantity','<!DOCTYPE\x20html>','Hindi','Enclosed','port','production_date','$product_details.bay','log','$maxStocks','purchase\x20data\x20update\x20successfully','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','secondary_code_hide','then','maxStocks'];a0_0xad67=function(){return _0x1de60c;};return a0_0xad67();}var ejs=require(a0_0x47546a(0x142));const path=require(a0_0x47546a(0xe2)),users=require(a0_0x47546a(0x16d));router[a0_0x47546a(0xe4)]('/view',auth,async(_0x13607b,_0x38a4d8)=>{var _0x3185aa=a0_0x47546a;try{const {username:_0xe5c24c,email:_0x3fa0ff,role:_0x51c7b9}=_0x13607b[_0x3185aa(0xfc)],_0x1a6398=_0x13607b[_0x3185aa(0xfc)],_0x3e03d2=await profile[_0x3185aa(0x184)]({'email':_0x1a6398['email']}),_0x28dc62=await staff['findOne']({'email':_0x1a6398[_0x3185aa(0x14a)]});if(_0x1a6398[_0x3185aa(0x10c)]==_0x3185aa(0x16c)){const _0x47da19=await staff[_0x3185aa(0x184)]({'email':_0x1a6398[_0x3185aa(0x14a)]});}const _0x4b17bc=await master_shop[_0x3185aa(0x16b)]();let _0x4fb412;if(_0x1a6398[_0x3185aa(0x10c)]=='staff'){const _0x474087=await staff[_0x3185aa(0x184)]({'email':_0x1a6398[_0x3185aa(0x14a)]});_0x4fb412=await purchases_finished[_0x3185aa(0x102)]([{'$match':{'warehouse_name':_0x474087[_0x3185aa(0xb9)]}},{'$lookup':{'from':_0x3185aa(0x17e),'localField':'suppliers','foreignField':_0x3185aa(0xe5),'as':_0x3185aa(0x14d)}},{'$unwind':_0x3185aa(0x196)},{'$unwind':_0x3185aa(0x9d)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3185aa(0x162)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3185aa(0x109)},'room':{'$first':_0x3185aa(0x1a0)},'product':{'$push':_0x3185aa(0x9d)},'note':{'$first':_0x3185aa(0x180)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3185aa(0xdf)},'batch_code':{'$first':_0x3185aa(0x10a)},'expiry_date':{'$first':_0x3185aa(0x103)},'suppliers_docs':{'$first':_0x3185aa(0x196)},'total_product_quantity':{'$sum':_0x3185aa(0xca)},'level':{'$addToSet':_0x3185aa(0x18f)},'isle':{'$addToSet':_0x3185aa(0x121)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x3185aa(0x186)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4fb412=await purchases_finished['aggregate']([{'$unwind':_0x3185aa(0x9d)},{'$group':{'_id':_0x3185aa(0xc1),'invoice':{'$first':_0x3185aa(0x162)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x3185aa(0xf9)},'warehouse_name':{'$first':_0x3185aa(0x109)},'room':{'$addToSet':_0x3185aa(0x12b)},'product':{'$push':_0x3185aa(0x9d)},'note':{'$first':_0x3185aa(0x180)},'paid_amount':{'$first':_0x3185aa(0x14e)},'due_amount':{'$first':_0x3185aa(0x147)},'return_data':{'$first':_0x3185aa(0xdf)},'batch_code':{'$first':_0x3185aa(0x10a)},'expiry_date':{'$first':_0x3185aa(0x103)},'suppliers_docs':{'$first':_0x3185aa(0x196)},'total_product_quantity':{'$sum':_0x3185aa(0xca)},'level':{'$addToSet':_0x3185aa(0x18f)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x3185aa(0xf8)},'floorlevel':{'$addToSet':_0x3185aa(0x186)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x4b17bc[0x0]['language']==_0x3185aa(0xf2))var _0x3331e8=users[_0x3185aa(0x141)];else{if(_0x4b17bc[0x0]['language']==_0x3185aa(0xcc))var _0x3331e8=users['Hindi'];else{if(_0x4b17bc[0x0][_0x3185aa(0x19d)]==_0x3185aa(0xf1))var _0x3331e8=users[_0x3185aa(0xf1)];else{if(_0x4b17bc[0x0][_0x3185aa(0x19d)]==_0x3185aa(0x150))var _0x3331e8=users['Spanish'];else{if(_0x4b17bc[0x0]['language']==_0x3185aa(0xc6))var _0x3331e8=users['French'];else{if(_0x4b17bc[0x0][_0x3185aa(0x19d)]=='Portuguese\x20(BR)')var _0x3331e8=users[_0x3185aa(0x17c)];else{if(_0x4b17bc[0x0]['language']=='Chinese')var _0x3331e8=users[_0x3185aa(0x134)];else{if(_0x4b17bc[0x0]['language']=='Arabic\x20(ae)')var _0x3331e8=users[_0x3185aa(0xa0)];}}}}}}}_0x38a4d8[_0x3185aa(0x163)]('all_purchases_finished',{'success':_0x13607b['flash'](_0x3185aa(0x13d)),'errors':_0x13607b['flash']('errors'),'purchases':_0x4fb412,'role':_0x1a6398,'profile':_0x3e03d2,'master_shop':_0x4b17bc,'language':_0x3331e8});}catch(_0x3aa122){console['log'](_0x3185aa(0x111),_0x3aa122),_0x38a4d8[_0x3185aa(0xec)](0xc8)[_0x3185aa(0x104)]({'message':_0x3aa122[_0x3185aa(0x176)]});}});function a0_0x3097(_0x1edf2b,_0x5110e0){var _0xad67de=a0_0xad67();return a0_0x3097=function(_0x309785,_0xcca14f){_0x309785=_0x309785-0x9a;var _0x46b2db=_0xad67de[_0x309785];return _0x46b2db;},a0_0x3097(_0x1edf2b,_0x5110e0);}function BayBinSelected(_0x3ed1a0,_0x9db9cd){var _0x300d46=a0_0x47546a,_0x32599f=[],_0x32d18e=[];if(_0x3ed1a0==_0x300d46(0x124)){switch(_0x9db9cd){case _0x300d46(0x175):_0x32599f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x300d46(0x10f):_0x32599f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x32d18e=['DG'];}else{if(_0x3ed1a0==_0x300d46(0xa5)){switch(_0x9db9cd){case'Rack\x201':_0x32599f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x300d46(0x10f):_0x32599f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x32d18e=['FG'];}}return{'levels':_0x32599f,'identify':_0x32d18e};}async function getRandom8DigitNumber(){var _0x1187b1=a0_0x47546a;const _0xd0af72=0x989680,_0x449e04=0x5f5e0ff,_0x50afea=Math[_0x1187b1(0x118)](Math[_0x1187b1(0xaf)]()*(_0x449e04-_0xd0af72+0x1))+_0xd0af72;var _0xb2283e;const _0x577986=await purchases_finished['findOne']({'invoice':_0x1187b1(0x126)+_0x50afea});return _0x577986&&_0x577986[_0x1187b1(0xb1)]>0x0?_0xb2283e=_0x1187b1(0x126)+_0x50afea:_0xb2283e=_0x1187b1(0x126)+_0x50afea,_0xb2283e;}router[a0_0x47546a(0xe4)](a0_0x47546a(0x178),auth,async(_0xc72113,_0x50ae62)=>{var _0x102edf=a0_0x47546a;try{const {username:_0xf6fe94,email:_0x5b7e1e,role:_0xf4bfe3}=_0xc72113[_0x102edf(0xfc)],_0x111639=_0xc72113[_0x102edf(0xfc)],_0x456810=await profile[_0x102edf(0x184)]({'email':_0x111639[_0x102edf(0x14a)]}),_0x1fd91a=await master_shop[_0x102edf(0x16b)](),_0x2ca109=await staff['findOne']({'email':_0x111639[_0x102edf(0x14a)]}),_0x45af5a=await suppliers['find']({});let _0x5891e6;if(_0x111639[_0x102edf(0x10c)]=='staff'){const _0x240ce6=await staff[_0x102edf(0x184)]({'email':_0x111639['email']});_0x5891e6=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x240ce6[_0x102edf(0xb9)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x102edf(0x14c)}}}]);}else _0x5891e6=await warehouse[_0x102edf(0x102)]([{'$match':{'status':'Enabled','warehouse_category':_0x102edf(0x120),'name':{'$ne':_0x102edf(0x16a)}}},{'$group':{'_id':'$name','name':{'$first':_0x102edf(0x14c)}}}]);const _0x308a4d=await product[_0x102edf(0x16b)]({}),_0x43b83c=await warehouse[_0x102edf(0x16b)]({'status':_0x102edf(0x12c)}),_0x2207f8=await purchases_finished[_0x102edf(0x16b)]({}),_0x147181=_0x2207f8[_0x102edf(0xb1)]+0x1,_0xdf9d6a='INCF-'+_0x147181['toString']()[_0x102edf(0x106)](0x5,'0');var _0x3d8c4e=[_0x102edf(0x19e),_0x102edf(0xcd)];if(_0x1fd91a[0x0][_0x102edf(0x19d)]==_0x102edf(0xf2))var _0x5df352=users[_0x102edf(0x141)];else{if(_0x1fd91a[0x0][_0x102edf(0x19d)]==_0x102edf(0xcc))var _0x5df352=users[_0x102edf(0xcc)];else{if(_0x1fd91a[0x0][_0x102edf(0x19d)]=='German')var _0x5df352=users['German'];else{if(_0x1fd91a[0x0][_0x102edf(0x19d)]=='Spanish')var _0x5df352=users[_0x102edf(0x150)];else{if(_0x1fd91a[0x0][_0x102edf(0x19d)]=='French')var _0x5df352=users['French'];else{if(_0x1fd91a[0x0][_0x102edf(0x19d)]==_0x102edf(0xb4))var _0x5df352=users[_0x102edf(0x17c)];else{if(_0x1fd91a[0x0]['language']==_0x102edf(0x134))var _0x5df352=users[_0x102edf(0x134)];else{if(_0x1fd91a[0x0][_0x102edf(0x19d)]==_0x102edf(0x173))var _0x5df352=users[_0x102edf(0xa0)];}}}}}}}const _0x4ebbaf=getRandom8DigitNumber();_0x4ebbaf[_0x102edf(0xd7)](_0x20fac4=>{var _0x5e1a97=_0x102edf;_0x50ae62[_0x5e1a97(0x163)](_0x5e1a97(0x12e),{'success':_0xc72113['flash'](_0x5e1a97(0x13d)),'errors':_0xc72113[_0x5e1a97(0x179)](_0x5e1a97(0x189)),'role':_0x111639,'profile':_0x456810,'suppliers':_0x45af5a,'warehouse':_0x5891e6,'product':_0x308a4d,'invoice':_0x20fac4,'master_shop':_0x1fd91a,'language':_0x5df352,'find_data':_0x43b83c,'rooms_data':_0x3d8c4e});})[_0x102edf(0x192)](_0x10a5c2=>{var _0x57299a=_0x102edf;_0xc72113[_0x57299a(0x179)](_0x57299a(0x189),_0x57299a(0x143)),_0x50ae62[_0x57299a(0xe9)]('/all_purchases_finished/view');});}catch(_0x396ea4){console[_0x102edf(0xd1)](_0x396ea4);}}),router[a0_0x47546a(0xe4)]('/view/add_purchases/:id',auth,async(_0xd34464,_0x2455f5)=>{var _0x3dd265=a0_0x47546a;try{const _0x23b422=_0xd34464[_0x3dd265(0x11f)]['id'];console[_0x3dd265(0xd1)](_0x23b422);const _0xc20ef9=await master_shop['find']();console['log']('master',_0xc20ef9);const _0x5479b2=await product['findOne']({'name':_0x23b422});console[_0x3dd265(0xd1)](_0x3dd265(0x129),_0x5479b2),_0x2455f5[_0x3dd265(0xec)](0xc8)[_0x3dd265(0x104)]({'product_data':_0x5479b2,'master':_0xc20ef9});}catch(_0x5e6ea5){console[_0x3dd265(0xd1)](_0x3dd265(0xe6),_0x5e6ea5);}}),router[a0_0x47546a(0x165)](a0_0x47546a(0x178),auth,async(_0x19cad9,_0x4aefc8)=>{var _0x22af1c=a0_0x47546a;try{const {invoice:_0x23572f,date:_0x4ab549,warehouse_name:_0x5dc39f,prod_name:_0x55bbd0,prod_code:_0x2699fe,prod_qty:_0x533619,prod_unit:_0x23f7b5,prod_secondunit:_0x46f85f,prod_level:_0x4a26b1,prod_isle:_0x55e9e7,prod_pallet:_0x132913,note:_0x4c62f3,expiry_date:_0x3673d8,batch_code:_0x5c92de,payable:_0x37aef9,due_amount:_0xcd9f61,Room_name:_0x22111e,primary_code:_0x30e8fd,secondary_code:_0x2b88b6,MaxStocks_data:_0x13fa68,PO_number:_0x3966e6,SCRN:_0x14dc57,JO_number:_0x1077b2}=_0x19cad9[_0x22af1c(0xe1)];if(typeof _0x55bbd0==_0x22af1c(0x158))var _0x58a6f4=[_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x125)]],_0x4ee1f3=[_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xfe)]],_0x5b4de6=[_0x19cad9[_0x22af1c(0xe1)]['prod_Qty']],_0x1d54dc=[_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x181)]],_0x45d36a=[_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x17b)]],_0x45f032=[_0x19cad9[_0x22af1c(0xe1)]['prod_level']],_0x3751b5=[_0x19cad9[_0x22af1c(0xe1)]['primary_code']],_0x19bc75=[_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xda)]],_0xa2aab8=[_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xe3)]],_0x202994=[_0x19cad9['body'][_0x22af1c(0xee)]],_0xb7a1a2=[_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xa6)]],_0x41a97d=[_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xc3)]],_0x291a4f=[_0x19cad9[_0x22af1c(0xe1)]['max_product_unit']],_0x58029a=[_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xea)]],_0x361a5a=[_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x166)]],_0x5f4071=[_0x19cad9['body']['prod_invoice']];else var _0x58a6f4=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x125)]],_0x4ee1f3=[..._0x19cad9['body'][_0x22af1c(0xfe)]],_0x5b4de6=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x9b)]],_0x1d54dc=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x181)]],_0x45d36a=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x17b)]],_0x45f032=[..._0x19cad9['body']['prod_level']],_0x3751b5=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x119)]],_0x19bc75=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xda)]],_0xa2aab8=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xe3)]],_0x202994=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xee)]],_0xb7a1a2=[..._0x19cad9['body'][_0x22af1c(0xa6)]],_0x41a97d=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xc3)]],_0x291a4f=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x13a)]],_0x58029a=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0xea)]],_0x361a5a=[..._0x19cad9[_0x22af1c(0xe1)]['RoomAssign']],_0x5f4071=[..._0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x164)]];const _0x2a1a2f=_0x58a6f4['map'](_0x37f36e=>{return _0x37f36e={'product_name':_0x37f36e};});_0x4ee1f3[_0x22af1c(0x193)]((_0xd0de4b,_0x4cfa52)=>{var _0x36249d=_0x22af1c;_0x2a1a2f[_0x4cfa52][_0x36249d(0x14b)]=_0xd0de4b;}),_0x5b4de6['forEach']((_0x1d3b13,_0x30e9b4)=>{var _0xe936ce=_0x22af1c;_0x2a1a2f[_0x30e9b4]['quantity']=Math[_0xe936ce(0x160)](_0x1d3b13);}),_0x1d54dc[_0x22af1c(0x193)]((_0x170767,_0x2b6f09)=>{var _0x56ee63=_0x22af1c;_0x2a1a2f[_0x2b6f09][_0x56ee63(0xe7)]=_0x170767;}),_0x45d36a[_0x22af1c(0x193)]((_0x57e0f9,_0x5982d0)=>{var _0x4f4120=_0x22af1c;_0x2a1a2f[_0x5982d0][_0x4f4120(0xdc)]=_0x57e0f9;}),_0x45f032[_0x22af1c(0x193)]((_0x387ad4,_0x3af3c3)=>{var _0x252cac=_0x22af1c;_0x2a1a2f[_0x3af3c3][_0x252cac(0x161)]=_0x387ad4;}),_0x3751b5['forEach']((_0x4935dd,_0x168c28)=>{var _0x186b63=_0x22af1c;_0x2a1a2f[_0x168c28][_0x186b63(0x119)]=_0x4935dd;}),_0x19bc75['forEach']((_0x5c3c69,_0x2296c9)=>{var _0x533c5d=_0x22af1c;_0x2a1a2f[_0x2296c9][_0x533c5d(0xda)]=_0x5c3c69;}),_0xa2aab8[_0x22af1c(0x193)]((_0x2dcfa9,_0x5b0f0a)=>{var _0x430a09=_0x22af1c;_0x2a1a2f[_0x5b0f0a][_0x430a09(0xd8)]=_0x2dcfa9;}),_0x202994[_0x22af1c(0x193)]((_0x107bdf,_0x176534)=>{var _0x2dfe40=_0x22af1c;_0x2a1a2f[_0x176534][_0x2dfe40(0xee)]=_0x107bdf;}),_0xb7a1a2[_0x22af1c(0x193)]((_0x4a7bbf,_0x4b140a)=>{var _0x127ce1=_0x22af1c;_0x2a1a2f[_0x4b140a][_0x127ce1(0xa6)]=_0x4a7bbf;}),_0x41a97d[_0x22af1c(0x193)]((_0x221341,_0x4ed0ce)=>{var _0x9bf15c=_0x22af1c;_0x2a1a2f[_0x4ed0ce][_0x9bf15c(0xcf)]=_0x221341;}),_0x291a4f[_0x22af1c(0x193)]((_0x45f294,_0x3f4737)=>{var _0x205a7f=_0x22af1c;_0x2a1a2f[_0x3f4737][_0x205a7f(0x135)]=_0x45f294;}),_0x58029a[_0x22af1c(0x193)]((_0x176e8e,_0x23b657)=>{var _0x3ea7dd=_0x22af1c;_0x2a1a2f[_0x23b657][_0x3ea7dd(0x117)]=_0x176e8e;}),_0x361a5a[_0x22af1c(0x193)]((_0x17ec4c,_0x187051)=>{var _0x501467=_0x22af1c;_0x2a1a2f[_0x187051][_0x501467(0xbd)]=_0x17ec4c;}),_0x5f4071[_0x22af1c(0x193)]((_0x3feda7,_0x1b8dfd)=>{var _0x43a54d=_0x22af1c;_0x2a1a2f[_0x1b8dfd][_0x43a54d(0xe0)]=_0x3feda7;});const _0x24d8de=_0x2a1a2f[_0x22af1c(0x16f)](_0x5cc5e0=>_0x5cc5e0[_0x22af1c(0x9a)]!=='0'&&_0x5cc5e0[_0x22af1c(0x9a)]!==''),_0x57bb7a=new purchases_finished({'invoice':_0x23572f,'suppliers':_0x19cad9[_0x22af1c(0xe1)][_0x22af1c(0x17e)],'date':_0x4ab549,'warehouse_name':_0x5dc39f,'product':_0x24d8de,'note':_0x4c62f3,'due_amount':_0xcd9f61,'room':_0x22111e,'POnumber':_0x3966e6,'SCRN':_0x14dc57,'JO_number':_0x1077b2}),_0x5d60dc=await _0x57bb7a[_0x22af1c(0xfb)](),_0x1a0be9=await purchases_finished[_0x22af1c(0x184)]({'invoice':_0x23572f}),_0x482261=_0x1a0be9[_0x22af1c(0x129)][_0x22af1c(0xa2)](async _0x449b8f=>{var _0x23ce36=_0x22af1c;try{var _0xb5902a=await warehouse[_0x23ce36(0x184)]({'name':_0x5dc39f,'room':_0x449b8f['room_name']}),_0x3a8909=0x0;const _0x1dda86=_0xb5902a[_0x23ce36(0xb0)]['map'](_0x4001cc=>{var _0x181d95=_0x23ce36;console[_0x181d95(0xd1)](_0x4001cc['product_name']+'=='+_0x449b8f[_0x181d95(0xb8)]+'&&'+_0x4001cc[_0x181d95(0x161)]+'=='+_0x449b8f[_0x181d95(0x161)]+'&&'+_0x4001cc[_0x181d95(0xa6)]+'=='+_0x449b8f[_0x181d95(0xa6)]+'&&'+_0x4001cc[_0x181d95(0xcf)]+'=='+_0x449b8f[_0x181d95(0xcf)]+'&&'+_0x4001cc['batch_code']+'=='+_0x449b8f[_0x181d95(0xee)]+'&&'+_0x4001cc[_0x181d95(0xe0)]+'=='+_0x1a0be9[_0x181d95(0xe0)]),_0x4001cc[_0x181d95(0xb8)]==_0x449b8f[_0x181d95(0xb8)]&&_0x4001cc[_0x181d95(0x161)]==_0x449b8f[_0x181d95(0x161)]&&_0x4001cc['expiry_date']==_0x449b8f[_0x181d95(0xa6)]&&_0x4001cc[_0x181d95(0xcf)]==_0x449b8f[_0x181d95(0xcf)]&&_0x4001cc[_0x181d95(0xee)]==_0x449b8f[_0x181d95(0xee)]&&_0x4001cc['invoice']==_0x1a0be9[_0x181d95(0xe0)]&&(_0x4001cc[_0x181d95(0xc2)]=Math[_0x181d95(0x160)](_0x4001cc[_0x181d95(0xc2)])+Math[_0x181d95(0x160)](_0x449b8f[_0x181d95(0x9a)]),_0x3a8909++);});return _0x3a8909==0x0&&(_0xb5902a['product_details']=_0xb5902a[_0x23ce36(0xb0)]['concat']({'product_name':_0x449b8f[_0x23ce36(0xb8)],'product_stock':Math['abs'](_0x449b8f[_0x23ce36(0x9a)]),'primary_code':_0x449b8f[_0x23ce36(0x119)],'secondary_code':_0x449b8f['secondary_code'],'product_code':_0x449b8f[_0x23ce36(0x14b)],'bay':_0x449b8f[_0x23ce36(0x161)],'maxProducts':_0x449b8f[_0x23ce36(0xd8)],'unit':_0x449b8f[_0x23ce36(0xe7)],'secondary_unit':_0x449b8f[_0x23ce36(0xdc)],'expiry_date':_0x449b8f[_0x23ce36(0xa6)],'production_date':_0x449b8f['production_date'],'maxProducts':_0x449b8f[_0x23ce36(0xd8)],'maxPerUnit':_0x449b8f[_0x23ce36(0x135)],'batch_code':_0x449b8f[_0x23ce36(0xee)],'product_cat':_0x449b8f[_0x23ce36(0x117)],'invoice':_0x449b8f['invoice'],'id_incoming':_0x449b8f[_0x23ce36(0xf4)]})),_0xb5902a;}catch(_0x18f5fd){return console['error'](_0x23ce36(0x154),_0x18f5fd),null;}});Promise[_0x22af1c(0x159)](_0x482261)[_0x22af1c(0xd7)](async _0x10a669=>{var _0x14412b=_0x22af1c;try{for(const _0xe06593 of _0x10a669){await warehouse[_0x14412b(0xe8)]({'_id':_0xe06593[_0x14412b(0xf4)]},{'$addToSet':{'product_details':{'$each':_0xe06593[_0x14412b(0xb0)]}}});}const _0x36e9f2=await master_shop[_0x14412b(0x16b)](),_0x3520a9=await email_settings[_0x14412b(0x184)](),_0x9de478=await supervisor_settings[_0x14412b(0x16b)]();var _0x4c1bbb=_0x1a0be9[_0x14412b(0x129)],_0xc2f7ab='',_0xc25779;for(_0xc25779 in _0x4c1bbb){var _0x4314db='FG';_0x1a0be9[_0x14412b(0x13f)]=='DRY\x20GOODS'&&(_0x4314db='DG'),_0xc2f7ab+='<tr>'+_0x14412b(0x170)+_0x4c1bbb[_0xc25779][_0x14412b(0xb8)]+_0x14412b(0xf5)+_0x14412b(0x170)+_0x4c1bbb[_0xc25779][_0x14412b(0x14b)]+_0x14412b(0xf5)+_0x14412b(0x170)+_0x4c1bbb[_0xc25779][_0x14412b(0x9a)]+_0x14412b(0xf5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c1bbb[_0xc25779]['standard_unit']+_0x14412b(0xf5)+_0x14412b(0x170)+_0x4c1bbb[_0xc25779]['secondary_unit']+_0x14412b(0xf5)+_0x14412b(0x170)+_0x1a0be9[_0x14412b(0x13f)]+_0x14412b(0xf5)+_0x14412b(0x170)+_0x4c1bbb[_0xc25779][_0x14412b(0xbd)]+_0x14412b(0xf5)+_0x14412b(0x170)+_0x4314db+_0x4c1bbb[_0xc25779][_0x14412b(0x161)]+_0x14412b(0xf5),_0x14412b(0x19c);}let _0x5ef17a=nodemailer[_0x14412b(0x11d)]({'host':_0x3520a9['host'],'port':Number(_0x3520a9[_0x14412b(0xce)]),'secure':![],'auth':{'user':_0x3520a9[_0x14412b(0x14a)],'pass':_0x3520a9[_0x14412b(0x114)]}}),_0x77a962={'from':_0x3520a9[_0x14412b(0x14a)],'to':_0x9de478[0x0][_0x14412b(0xdb)],'subject':_0x14412b(0xc0),'attachments':[{'filename':_0x14412b(0xa1),'path':__dirname+_0x14412b(0x130)+_0x14412b(0x177)+_0x36e9f2[0x0][_0x14412b(0x113)],'cid':_0x14412b(0x183)}],'html':_0x14412b(0xcb)+'<html><head><title></title>'+_0x14412b(0x128)+'<div>'+_0x14412b(0xeb)+'<div>'+_0x14412b(0x15e)+_0x14412b(0x19f)+_0x14412b(0x138)+'<h2>\x20'+_0x36e9f2[0x0][_0x14412b(0xa9)]+_0x14412b(0x194)+_0x14412b(0x19f)+_0x14412b(0x19f)+'<hr\x20class=\x22my-3\x22>'+_0x14412b(0x138)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x14412b(0x15d)+_0x1a0be9[_0x14412b(0xe0)]+'\x20'+_0x14412b(0xb2)+_0x14412b(0x145)+_0x1a0be9['date']+'\x20'+_0x14412b(0xff)+_0x14412b(0x11b)+'</div>'+_0x14412b(0x15b)+_0x14412b(0x151)+_0x14412b(0xc8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x14412b(0x11a)+_0x14412b(0x110)+_0x14412b(0x12a)+_0x14412b(0x15a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x14412b(0xd5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xc2f7ab+'\x20'+_0x14412b(0x9f)+'</table>'+_0x14412b(0x138)+'<strong>\x20Regards\x20</strong>'+_0x14412b(0xd9)+_0x36e9f2[0x0][_0x14412b(0xa9)]+_0x14412b(0x11b)+_0x14412b(0x19f)+_0x14412b(0x19f)+_0x14412b(0x19a)};_0x5ef17a[_0x14412b(0x190)](_0x77a962,function(_0x826a79,_0x20e40d){var _0xbd74b0=_0x14412b;_0x826a79?(console[_0xbd74b0(0xd1)](_0x826a79),console[_0xbd74b0(0xd1)](_0xbd74b0(0x17f))):console[_0xbd74b0(0xd1)](_0xbd74b0(0xf7));});}catch(_0x646cee){console[_0x14412b(0x19b)](_0x646cee),_0x4aefc8['status'](0x1f4)[_0x14412b(0x104)]({'error':_0x14412b(0x198),'message':_0x646cee[_0x14412b(0x176)]});}})[_0x22af1c(0x192)](_0x2b1514=>{var _0xbb66a2=_0x22af1c;console[_0xbb66a2(0x19b)](_0x2b1514);}),_0x19cad9[_0x22af1c(0x179)](_0x22af1c(0x13d),_0x22af1c(0x185)),_0x4aefc8['redirect'](_0x22af1c(0xb3));}catch(_0x4f5b90){console['log'](_0x4f5b90);}}),router['get'](a0_0x47546a(0x13c),auth,async(_0x1b3368,_0x39dfbe)=>{var _0x16acb0=a0_0x47546a;try{const {username:_0x28f02a,email:_0xc8d8eb,role:_0x5a97d1}=_0x1b3368['user'],_0x5fa9bb=_0x1b3368[_0x16acb0(0xfc)],_0x3813b8=await profile[_0x16acb0(0x184)]({'email':_0x5fa9bb['email']}),_0xd46af5=await master_shop[_0x16acb0(0x16b)](),_0x12a413=_0x1b3368[_0x16acb0(0x11f)]['id'],_0x44c787=await purchases_finished['findById'](_0x12a413),_0x2a522e=await suppliers[_0x16acb0(0x16b)]({});let _0x38c49c;if(_0x5fa9bb['role']==_0x16acb0(0x16c)){const _0x4221a5=await staff[_0x16acb0(0x184)]({'email':_0x5fa9bb[_0x16acb0(0x14a)]});_0x38c49c=await warehouse[_0x16acb0(0x16b)]({'status':_0x16acb0(0x12c),'name':_0x4221a5[_0x16acb0(0xb9)],'warehouse_category':_0x16acb0(0x120)});}else _0x38c49c=await warehouse['aggregate']([{'$match':{'status':_0x16acb0(0x12c),'warehouse_category':_0x16acb0(0x120)}},{'$group':{'_id':_0x16acb0(0x14c),'name':{'$first':_0x16acb0(0x14c)}}}]);const _0x56b528=await product[_0x16acb0(0x16b)]({}),_0x511a33=BayBinSelected(_0x44c787[_0x16acb0(0x13f)],_0x44c787[_0x16acb0(0x155)]);let _0x2e3f7b=new Date(_0x44c787['expiry_date']),_0x38d664=('0'+_0x2e3f7b[_0x16acb0(0x10b)]())[_0x16acb0(0x116)](-0x2),_0x358247=('0'+(_0x2e3f7b[_0x16acb0(0xa8)]()+0x1))[_0x16acb0(0x116)](-0x2),_0x2a5a6f=_0x2e3f7b[_0x16acb0(0x199)](),_0x1b6a60=_0x2a5a6f+'-'+_0x358247+'-'+_0x38d664;if(_0xd46af5[0x0][_0x16acb0(0x19d)]==_0x16acb0(0xf2)){var _0x14953a=users[_0x16acb0(0x141)];console['log'](_0x14953a);}else{if(_0xd46af5[0x0]['language']==_0x16acb0(0xcc))var _0x14953a=users[_0x16acb0(0xcc)];else{if(_0xd46af5[0x0][_0x16acb0(0x19d)]==_0x16acb0(0xf1))var _0x14953a=users[_0x16acb0(0xf1)];else{if(_0xd46af5[0x0][_0x16acb0(0x19d)]=='Spanish')var _0x14953a=users[_0x16acb0(0x150)];else{if(_0xd46af5[0x0][_0x16acb0(0x19d)]==_0x16acb0(0xc6))var _0x14953a=users[_0x16acb0(0xc6)];else{if(_0xd46af5[0x0][_0x16acb0(0x19d)]==_0x16acb0(0xb4))var _0x14953a=users[_0x16acb0(0x17c)];else{if(_0xd46af5[0x0][_0x16acb0(0x19d)]==_0x16acb0(0x134))var _0x14953a=users[_0x16acb0(0x134)];else{if(_0xd46af5[0x0][_0x16acb0(0x19d)]==_0x16acb0(0x173))var _0x14953a=users[_0x16acb0(0xa0)];}}}}}}}_0x39dfbe[_0x16acb0(0x163)](_0x16acb0(0x182),{'success':_0x1b3368[_0x16acb0(0x179)](_0x16acb0(0x13d)),'errors':_0x1b3368[_0x16acb0(0x179)](_0x16acb0(0x189)),'role':_0x5fa9bb,'profile':_0x3813b8,'purchases':_0x44c787,'suppliers':_0x2a522e,'warehouse':_0x38c49c,'product':_0x56b528,'master_shop':_0xd46af5,'language':_0x14953a,'ed_fullDate':_0x1b6a60,'dataSelected':_0x511a33});}catch(_0x58fa5d){console[_0x16acb0(0xd1)](_0x58fa5d);}}),router[a0_0x47546a(0xe4)](a0_0x47546a(0x149),auth,async(_0x978727,_0x43b577)=>{var _0x1117ad=a0_0x47546a;try{const {username:_0x5cf496,email:_0x446b76,role:_0x243e95}=_0x978727[_0x1117ad(0xfc)],_0x1d56cf=_0x978727[_0x1117ad(0xfc)],_0x5f5a9b=await profile['findOne']({'email':_0x1d56cf['email']}),_0x80b821=await master_shop['find'](),_0x595ae5=_0x978727[_0x1117ad(0x11f)]['id'],_0x59cd18=await purchases_finished['findById'](_0x595ae5),_0x17a402=await suppliers[_0x1117ad(0x16b)]({});let _0x402aa0;if(_0x1d56cf[_0x1117ad(0x10c)]==_0x1117ad(0x16c)){const _0x36556e=await staff[_0x1117ad(0x184)]({'email':_0x1d56cf[_0x1117ad(0x14a)]});_0x402aa0=await warehouse[_0x1117ad(0x16b)]({'status':'Enabled','name':_0x36556e['warehouse'],'warehouse_category':_0x1117ad(0x120)});}else _0x402aa0=await warehouse[_0x1117ad(0x102)]([{'$match':{'status':_0x1117ad(0x12c),'warehouse_category':_0x1117ad(0x120)}},{'$group':{'_id':_0x1117ad(0x14c),'name':{'$first':_0x1117ad(0x14c)}}}]);const _0x47d27d=await product[_0x1117ad(0x16b)]({}),_0x3cac06=BayBinSelected(_0x59cd18[_0x1117ad(0x13f)],_0x59cd18[_0x1117ad(0x155)]);let _0x238d61=new Date(_0x59cd18[_0x1117ad(0xa6)]),_0x1f3741=('0'+_0x238d61[_0x1117ad(0x10b)]())[_0x1117ad(0x116)](-0x2),_0x5b4ff9=('0'+(_0x238d61['getMonth']()+0x1))[_0x1117ad(0x116)](-0x2),_0x93b6c1=_0x238d61['getFullYear'](),_0x88c22b=_0x93b6c1+'-'+_0x5b4ff9+'-'+_0x1f3741;if(_0x80b821[0x0]['language']==_0x1117ad(0xf2)){var _0x43d41e=users['English'];console[_0x1117ad(0xd1)](_0x43d41e);}else{if(_0x80b821[0x0]['language']==_0x1117ad(0xcc))var _0x43d41e=users[_0x1117ad(0xcc)];else{if(_0x80b821[0x0][_0x1117ad(0x19d)]==_0x1117ad(0xf1))var _0x43d41e=users[_0x1117ad(0xf1)];else{if(_0x80b821[0x0][_0x1117ad(0x19d)]=='Spanish')var _0x43d41e=users[_0x1117ad(0x150)];else{if(_0x80b821[0x0][_0x1117ad(0x19d)]==_0x1117ad(0xc6))var _0x43d41e=users[_0x1117ad(0xc6)];else{if(_0x80b821[0x0][_0x1117ad(0x19d)]==_0x1117ad(0xb4))var _0x43d41e=users['Portuguese'];else{if(_0x80b821[0x0][_0x1117ad(0x19d)]==_0x1117ad(0x134))var _0x43d41e=users['Chinese'];else{if(_0x80b821[0x0][_0x1117ad(0x19d)]==_0x1117ad(0x173))var _0x43d41e=users[_0x1117ad(0xa0)];}}}}}}}_0x43b577['render'](_0x1117ad(0x13b),{'success':_0x978727[_0x1117ad(0x179)](_0x1117ad(0x13d)),'errors':_0x978727['flash'](_0x1117ad(0x189)),'role':_0x1d56cf,'profile':_0x5f5a9b,'purchases':_0x59cd18,'suppliers':_0x17a402,'warehouse':_0x402aa0,'product':_0x47d27d,'master_shop':_0x80b821,'language':_0x43d41e,'ed_fullDate':_0x88c22b,'dataSelected':_0x3cac06});}catch(_0x69d1c4){console[_0x1117ad(0xd1)](_0x69d1c4);}}),router[a0_0x47546a(0x165)]('/view/:id',auth,async(_0x99472f,_0x5dd62e)=>{var _0x1db70c=a0_0x47546a;try{const _0x541d71=_0x99472f[_0x1db70c(0x11f)]['id'],_0x333915=await purchases_finished[_0x1db70c(0x184)]({'_id':_0x99472f[_0x1db70c(0x11f)]['id']}),_0x287159=await warehouse[_0x1db70c(0x184)]({'name':_0x333915[_0x1db70c(0x13f)],'room':_0x333915[_0x1db70c(0x155)]});_0x333915[_0x1db70c(0x129)]['forEach'](_0x1ab83b=>{const _0x325024=_0x287159['product_details']['map'](_0xada2c6=>{var _0x749aa1=a0_0x3097;_0xada2c6[_0x749aa1(0xb8)]==_0x1ab83b[_0x749aa1(0xb8)]&&_0xada2c6[_0x749aa1(0x161)]==_0x1ab83b[_0x749aa1(0x161)]&&(_0xada2c6[_0x749aa1(0xc2)]=parseInt(_0xada2c6[_0x749aa1(0xc2)])-parseInt(_0x1ab83b[_0x749aa1(0x9a)]));});}),await _0x287159['save']();const {invoice:_0x5ab0bd,suppliers:_0x519a9f,date:_0x16f7f7,warehouse_name:_0x30d4f9,prod_name:_0x499920,prod_code:_0x39a17d,prod_qty:_0x467d02,prod_unit:_0x184111,prod_secondunit:_0x1bd528,prod_level:_0x2d65bb,prod_isle:_0x1e1f89,prod_pallet:_0x485d79,note:_0x5dd487,expiry_date:_0x36a893,batch_code:_0x27f457,paid_amount:_0x56a2d4,due_amount:_0x5e97d5,Room_name:_0x40ffcd,primary_code:_0x5a4697,secondary_code:_0x1057a8,PO_number:_0x3947e6,JO_number:_0xac513}=_0x99472f['body'];if(typeof _0x499920==_0x1db70c(0x158))var _0x523fa6=[_0x99472f[_0x1db70c(0xe1)]['prod_name']],_0x2f2df0=[_0x99472f[_0x1db70c(0xe1)]['prod_code']],_0x262ef1=[_0x99472f['body'][_0x1db70c(0xaa)]],_0x5ee580=[_0x99472f[_0x1db70c(0xe1)][_0x1db70c(0xba)]],_0x33dcc8=[_0x99472f[_0x1db70c(0xe1)][_0x1db70c(0x17b)]],_0x1977ca=[_0x99472f[_0x1db70c(0xe1)][_0x1db70c(0x17d)]],_0x37498a=[_0x99472f[_0x1db70c(0xe1)]['primary_code']],_0x5f04e3=[_0x99472f[_0x1db70c(0xe1)]['secondary_code']],_0x16644e=[_0x99472f[_0x1db70c(0xe1)][_0x1db70c(0xe3)]],_0x8bf4ed=[_0x99472f[_0x1db70c(0xe1)]['batch_code']],_0x27be4f=[_0x99472f[_0x1db70c(0xe1)][_0x1db70c(0xa6)]];else var _0x523fa6=[..._0x99472f['body'][_0x1db70c(0x125)]],_0x2f2df0=[..._0x99472f[_0x1db70c(0xe1)][_0x1db70c(0xfe)]],_0x262ef1=[..._0x99472f['body'][_0x1db70c(0xaa)]],_0x5ee580=[..._0x99472f[_0x1db70c(0xe1)][_0x1db70c(0xba)]],_0x33dcc8=[..._0x99472f[_0x1db70c(0xe1)][_0x1db70c(0x17b)]],_0x1977ca=[..._0x99472f[_0x1db70c(0xe1)][_0x1db70c(0x17d)]],_0x37498a=[..._0x99472f['body'][_0x1db70c(0x119)]],_0x5f04e3=[..._0x99472f[_0x1db70c(0xe1)][_0x1db70c(0xda)]],_0x16644e=[..._0x99472f[_0x1db70c(0xe1)]['MaxStocks_data']],_0x8bf4ed=[..._0x99472f[_0x1db70c(0xe1)][_0x1db70c(0xee)]],_0x27be4f=[..._0x99472f['body'][_0x1db70c(0xa6)]];const _0x8dc8f2=_0x523fa6[_0x1db70c(0xa2)](_0x547995=>{return _0x547995={'product_name':_0x547995};});_0x2f2df0[_0x1db70c(0x193)]((_0x1d1eca,_0x10ed14)=>{var _0x3fd4e5=_0x1db70c;_0x8dc8f2[_0x10ed14][_0x3fd4e5(0x14b)]=_0x1d1eca;}),_0x262ef1[_0x1db70c(0x193)]((_0x3f72d3,_0x53f65e)=>{var _0x23d53e=_0x1db70c;_0x8dc8f2[_0x53f65e][_0x23d53e(0x9a)]=_0x3f72d3;}),_0x5ee580[_0x1db70c(0x193)]((_0x4e6c95,_0x2d7284)=>{var _0x1a6cf9=_0x1db70c;_0x8dc8f2[_0x2d7284][_0x1a6cf9(0xe7)]=_0x4e6c95;}),_0x33dcc8[_0x1db70c(0x193)]((_0x9f4705,_0x4913ee)=>{var _0x1d5478=_0x1db70c;_0x8dc8f2[_0x4913ee][_0x1d5478(0xdc)]=_0x9f4705;}),_0x1977ca[_0x1db70c(0x193)]((_0x337a09,_0x4bf795)=>{var _0x3b0faf=_0x1db70c;_0x8dc8f2[_0x4bf795][_0x3b0faf(0x161)]=_0x337a09;}),_0x37498a[_0x1db70c(0x193)]((_0xe6e932,_0x4e39d5)=>{var _0x1a176b=_0x1db70c;_0x8dc8f2[_0x4e39d5][_0x1a176b(0x119)]=_0xe6e932;}),_0x5f04e3['forEach']((_0x3faea3,_0xcae578)=>{_0x8dc8f2[_0xcae578]['secondary_code']=_0x3faea3;}),_0x16644e['forEach']((_0x18d102,_0x200a9b)=>{var _0x57142c=_0x1db70c;_0x8dc8f2[_0x200a9b][_0x57142c(0xd8)]=_0x18d102;}),_0x8bf4ed[_0x1db70c(0x193)]((_0x10fa04,_0xb158a6)=>{var _0x3b53e3=_0x1db70c;_0x8dc8f2[_0xb158a6][_0x3b53e3(0xee)]=_0x10fa04;}),_0x27be4f[_0x1db70c(0x193)]((_0x3d1444,_0x3e4e5a)=>{_0x8dc8f2[_0x3e4e5a]['expiry_date']=_0x3d1444;});const _0x54073a=_0x8dc8f2['filter'](_0x1512d7=>_0x1512d7[_0x1db70c(0x9a)]!=='0'&&_0x1512d7[_0x1db70c(0x9a)]!=='');_0x333915['invoice']=_0x5ab0bd,_0x333915['suppliers']=_0x519a9f,_0x333915['date']=_0x16f7f7,_0x333915[_0x1db70c(0x13f)]=_0x30d4f9,_0x333915[_0x1db70c(0x129)]=_0x54073a,_0x333915[_0x1db70c(0xef)]=_0x5dd487,_0x333915[_0x1db70c(0x169)]=_0x56a2d4,_0x333915[_0x1db70c(0x18c)]=_0x5e97d5,_0x333915[_0x1db70c(0x155)]=_0x40ffcd,_0x333915['POnumber']=_0x3947e6,_0x333915[_0x1db70c(0xb6)]=_0xac513;const _0x222d5f=await _0x333915[_0x1db70c(0xfb)](),_0x584800=await warehouse['findOne']({'name':_0x99472f[_0x1db70c(0xe1)]['warehouse_name'],'room':_0x99472f[_0x1db70c(0xe1)]['Room_name']});_0x333915[_0x1db70c(0x129)][_0x1db70c(0x193)](_0x2a92a5=>{var _0x2c9427=_0x1db70c,_0x3cd928=0x0;const _0x2ae041=_0x584800[_0x2c9427(0xb0)][_0x2c9427(0xa2)](_0x2c1e9b=>{var _0xe86a6a=_0x2c9427;_0x2c1e9b[_0xe86a6a(0xb8)]==_0x2a92a5[_0xe86a6a(0xb8)]&&_0x2c1e9b[_0xe86a6a(0x161)]==_0x2a92a5[_0xe86a6a(0x161)]&&(_0x2c1e9b[_0xe86a6a(0xc2)]=parseInt(_0x2c1e9b[_0xe86a6a(0xc2)])+parseInt(_0x2a92a5[_0xe86a6a(0x9a)]),_0x3cd928++);});_0x3cd928=='0'&&(_0x584800['product_details']=_0x584800[_0x2c9427(0xb0)]['concat']({'product_name':_0x2a92a5['product_name'],'product_stock':_0x2a92a5[_0x2c9427(0x9a)],'primary_code':_0x2a92a5[_0x2c9427(0x119)],'secondary_code':_0x2a92a5[_0x2c9427(0xda)],'product_code':_0x2a92a5[_0x2c9427(0x14b)],'bay':_0x2a92a5[_0x2c9427(0x161)],'maxProducts':_0x2a92a5['maxStocks'],'unit':_0x2a92a5['standard_unit'],'secondary_unit':_0x2a92a5['secondary_unit'],'expiry_date':_0x2a92a5[_0x2c9427(0xa6)]}));}),await _0x584800[_0x1db70c(0xfb)]();const _0x11b6fc=await s_payment_data[_0x1db70c(0x184)]({'invoice':_0x99472f[_0x1db70c(0xe1)][_0x1db70c(0xe0)]});if(_0x11b6fc===null){}else console[_0x1db70c(0xd1)](_0x1db70c(0x17e),_0x11b6fc,_0x99472f['body'][_0x1db70c(0xe0)]),_0x11b6fc[_0x1db70c(0x17e)]=_0x99472f[_0x1db70c(0xe1)][_0x1db70c(0x17e)],await _0x11b6fc['save']();_0x99472f[_0x1db70c(0x179)](_0x1db70c(0x13d),_0x1db70c(0xd3)),_0x5dd62e['redirect']('/all_purchases_finished/view');}catch(_0x7a2c3b){console[_0x1db70c(0xd1)](_0x7a2c3b);}}),router[a0_0x47546a(0x165)]('/give_payment/:id',auth,async(_0x4269d1,_0x4a6089)=>{var _0x9401d2=a0_0x47546a;try{const _0x10dd25=_0x4269d1[_0x9401d2(0x11f)]['id'],{invoice:_0x1dc2cb,suppliers:_0x393d8c,payable:_0x3ad15a,due_amount:_0x5ee345}=_0x4269d1[_0x9401d2(0xe1)],_0x1c808c=await purchases['findById'](_0x10dd25);var _0x30be4d=_0x3ad15a-_0x5ee345;_0x1c808c['paid_amount']=parseFloat(_0x1c808c[_0x9401d2(0x169)])+parseFloat(_0x5ee345),_0x1c808c[_0x9401d2(0x18c)]=_0x30be4d;const _0x21a101=await _0x1c808c[_0x9401d2(0xfb)]();console[_0x9401d2(0xd1)](_0x21a101);const _0x530175=await s_payment_data['findOne']({'invoice':_0x1dc2cb});_0x530175[_0x9401d2(0xd4)]=_0x30be4d,await _0x530175[_0x9401d2(0xfb)]();let _0x231f69=new Date(),_0x37cd15=('0'+_0x231f69['getDate']())['slice'](-0x2),_0x5c8d00=('0'+(_0x231f69[_0x9401d2(0xa8)]()+0x1))[_0x9401d2(0x116)](-0x2),_0x4724fb=_0x231f69[_0x9401d2(0x199)](),_0x468b8f=_0x4724fb+'-'+_0x5c8d00+'-'+_0x37cd15;const _0x2ebc73=new suppliers_payment({'invoice':_0x1dc2cb,'date':_0x4724fb+'-'+_0x5c8d00+'-'+_0x37cd15,'suppliers':_0x393d8c,'reason':_0x9401d2(0x131),'amount':_0x5ee345}),_0x2afb7b=await _0x2ebc73[_0x9401d2(0xfb)]();_0x4269d1[_0x9401d2(0x179)](_0x9401d2(0x13d),_0x9401d2(0xbb)),_0x4a6089['redirect'](_0x9401d2(0xc9));}catch(_0x17d4ed){console['log'](_0x17d4ed);}}),router[a0_0x47546a(0xe4)](a0_0x47546a(0x195),auth,async(_0x18e1f3,_0x27448e)=>{var _0x2591f2=a0_0x47546a;try{const {username:_0x5aaac1,email:_0x1067c1,role:_0x5614b2}=_0x18e1f3['user'],_0x49adfb=_0x18e1f3[_0x2591f2(0xfc)],_0x5a3a6f=await profile[_0x2591f2(0x184)]({'email':_0x49adfb[_0x2591f2(0x14a)]}),_0x3e715d=await master_shop['find']();console[_0x2591f2(0xd1)](_0x2591f2(0x17a),_0x3e715d);const _0x568f0a=_0x18e1f3[_0x2591f2(0x11f)]['id'],_0xcb1298=await purchases[_0x2591f2(0x107)](_0x568f0a);console[_0x2591f2(0xd1)](_0xcb1298);const _0x325b41=await suppliers[_0x2591f2(0x184)]({'name':_0xcb1298[_0x2591f2(0x17e)]});console[_0x2591f2(0xd1)](_0x325b41);if(_0x3e715d[0x0][_0x2591f2(0x19d)]==_0x2591f2(0xf2)){var _0x3cbb66=users['English'];console[_0x2591f2(0xd1)](_0x3cbb66);}else{if(_0x3e715d[0x0][_0x2591f2(0x19d)]==_0x2591f2(0xcc))var _0x3cbb66=users[_0x2591f2(0xcc)];else{if(_0x3e715d[0x0][_0x2591f2(0x19d)]=='German')var _0x3cbb66=users[_0x2591f2(0xf1)];else{if(_0x3e715d[0x0][_0x2591f2(0x19d)]==_0x2591f2(0x150))var _0x3cbb66=users['Spanish'];else{if(_0x3e715d[0x0][_0x2591f2(0x19d)]=='French')var _0x3cbb66=users[_0x2591f2(0xc6)];else{if(_0x3e715d[0x0]['language']==_0x2591f2(0xb4))var _0x3cbb66=users[_0x2591f2(0x17c)];else{if(_0x3e715d[0x0][_0x2591f2(0x19d)]==_0x2591f2(0x134))var _0x3cbb66=users[_0x2591f2(0x134)];else{if(_0x3e715d[0x0][_0x2591f2(0x19d)]=='Arabic\x20(ae)')var _0x3cbb66=users['Arabic'];}}}}}}}_0x27448e['render'](_0x2591f2(0xdd),{'success':_0x18e1f3['flash'](_0x2591f2(0x13d)),'errors':_0x18e1f3[_0x2591f2(0x179)](_0x2591f2(0x189)),'role':_0x49adfb,'profile':_0x5a3a6f,'master_shop':_0x3e715d,'supplier':_0x325b41,'purchase':_0xcb1298,'language':_0x3cbb66});}catch(_0x2babf4){console['log'](_0x2babf4);}}),router['get'](a0_0x47546a(0xb7),auth,async(_0x1fdf3c,_0x454f74)=>{var _0x3c0d16=a0_0x47546a;try{const {username:_0x1a3e13,email:_0x17359c,role:_0x3d8dd1}=_0x1fdf3c[_0x3c0d16(0xfc)],_0xc135bd=_0x1fdf3c['user'],_0x176d67=await profile[_0x3c0d16(0x184)]({'email':_0xc135bd[_0x3c0d16(0x14a)]}),_0x2a5328=await master_shop[_0x3c0d16(0x16b)]();console['log']('master',_0x2a5328);const _0x56ec4=_0x1fdf3c[_0x3c0d16(0x11f)]['id'];console['log'](_0x56ec4);const _0x432ad7=await purchases_finished[_0x3c0d16(0x107)](_0x56ec4);console[_0x3c0d16(0xd1)](_0x3c0d16(0x146),_0x432ad7);const _0x201459=await product[_0x3c0d16(0x16b)]({}),_0x364068=await warehouse[_0x3c0d16(0x102)]([{'$match':{'name':_0x432ad7['warehouse_name'],'room':_0x432ad7[_0x3c0d16(0x155)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3c0d16(0x101)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3c0d16(0x12f)},'floorlevel':{'$first':_0x3c0d16(0xb5)},'primary_code':{'$first':_0x3c0d16(0x167)},'secondary_code':{'$first':_0x3c0d16(0xc7)},'product_code':{'$first':_0x3c0d16(0x197)},'storage':{'$first':_0x3c0d16(0x188)},'rack':{'$first':_0x3c0d16(0x11e)}}}]);console[_0x3c0d16(0xd1)](_0x3c0d16(0x9e),_0x364068);let _0x575b62;if(_0xc135bd['role']=='staff'){const _0xc848fd=await staff[_0x3c0d16(0x184)]({'email':_0xc135bd['email']});_0x575b62=await warehouse[_0x3c0d16(0x16b)]({'status':_0x3c0d16(0x12c),'name':_0xc848fd[_0x3c0d16(0xb9)],'warehouse_category':_0x3c0d16(0x120),'name':_0x3c0d16(0xfa)});}else _0x575b62=await warehouse[_0x3c0d16(0x102)]([{'$match':{'status':'Enabled','warehouse_category':_0x3c0d16(0x120),'name':_0x3c0d16(0xfa)}},{'$group':{'_id':_0x3c0d16(0x14c),'name':{'$first':'$name'}}}]);if(_0x2a5328[0x0][_0x3c0d16(0x19d)]==_0x3c0d16(0xf2)){var _0x5d19dc=users['English'];console[_0x3c0d16(0xd1)](_0x5d19dc);}else{if(_0x2a5328[0x0][_0x3c0d16(0x19d)]==_0x3c0d16(0xcc))var _0x5d19dc=users[_0x3c0d16(0xcc)];else{if(_0x2a5328[0x0][_0x3c0d16(0x19d)]==_0x3c0d16(0xf1))var _0x5d19dc=users['German'];else{if(_0x2a5328[0x0][_0x3c0d16(0x19d)]==_0x3c0d16(0x150))var _0x5d19dc=users[_0x3c0d16(0x150)];else{if(_0x2a5328[0x0][_0x3c0d16(0x19d)]==_0x3c0d16(0xc6))var _0x5d19dc=users['French'];else{if(_0x2a5328[0x0][_0x3c0d16(0x19d)]==_0x3c0d16(0xb4))var _0x5d19dc=users[_0x3c0d16(0x17c)];else{if(_0x2a5328[0x0][_0x3c0d16(0x19d)]==_0x3c0d16(0x134))var _0x5d19dc=users[_0x3c0d16(0x134)];else{if(_0x2a5328[0x0]['language']=='Arabic\x20(ae)')var _0x5d19dc=users[_0x3c0d16(0xa0)];}}}}}}}_0x454f74[_0x3c0d16(0x163)](_0x3c0d16(0x123),{'success':_0x1fdf3c[_0x3c0d16(0x179)]('success'),'errors':_0x1fdf3c[_0x3c0d16(0x179)](_0x3c0d16(0x189)),'role':_0xc135bd,'profile':_0x176d67,'user':_0x432ad7,'stock':_0x364068,'master_shop':_0x2a5328,'product':_0x201459,'language':_0x5d19dc,'warehouse':_0x575b62});}catch(_0x5a9301){console['log'](_0x5a9301);}}),router[a0_0x47546a(0x165)]('/view/return_purchase/:id',auth,async(_0x14489f,_0x3a3308)=>{var _0x4a459a=a0_0x47546a;try{const {invoice:_0x43908f,date:_0x48bfa4,warehouse_name:_0x597dd5,Room_name:_0x1fa213,product_name:_0x596535,purchase_quantity:_0x3d5065,stocks:_0x1aa0cf,return_qty:_0x27d4ef,note:_0x1c7ea4,level:_0x133c91,isle:_0x286272,pallet:_0x1f4876,to_warehouse_name:_0x20816a,to_Room_name:_0x1bf850}=_0x14489f['body'],_0x48e6b9=await purchases_finished[_0x4a459a(0x184)]({'_id':_0x14489f[_0x4a459a(0x11f)]['id']}),_0xdb5ee3=await warehouse[_0x4a459a(0x184)]({'name':_0x597dd5,'room':_0x1fa213,'warehouse_category':_0x4a459a(0x120)});if(typeof _0x596535==_0x4a459a(0x158))var _0x45a2e2=[_0x14489f[_0x4a459a(0xe1)]['product_name']],_0x1740af=[_0x14489f[_0x4a459a(0xe1)]['purchase_quantity']],_0x41182d=[_0x14489f[_0x4a459a(0xe1)][_0x4a459a(0xf6)]],_0x365faf=[_0x14489f[_0x4a459a(0xe1)]['return_qty']],_0x2544b7=[_0x14489f[_0x4a459a(0xe1)][_0x4a459a(0x152)]],_0x2d5d21=[_0x14489f[_0x4a459a(0xe1)][_0x4a459a(0xa7)]],_0xaed3f9=[_0x14489f[_0x4a459a(0xe1)][_0x4a459a(0xad)]],_0x8263d7=[_0x14489f[_0x4a459a(0xe1)][_0x4a459a(0xd6)]];else var _0x45a2e2=[..._0x14489f[_0x4a459a(0xe1)]['product_name']],_0x1740af=[..._0x14489f[_0x4a459a(0xe1)][_0x4a459a(0xa4)]],_0x41182d=[..._0x14489f[_0x4a459a(0xe1)][_0x4a459a(0xf6)]],_0x365faf=[..._0x14489f[_0x4a459a(0xe1)][_0x4a459a(0x108)]],_0x2544b7=[..._0x14489f['body']['level']],_0x2d5d21=[..._0x14489f[_0x4a459a(0xe1)]['product_code_hide']],_0xaed3f9=[..._0x14489f[_0x4a459a(0xe1)][_0x4a459a(0xad)]],_0x8263d7=[..._0x14489f[_0x4a459a(0xe1)][_0x4a459a(0xd6)]];const _0x5cc46e=_0x45a2e2[_0x4a459a(0xa2)](_0x5b514a=>{return _0x5b514a={'product_name':_0x5b514a};});_0x1740af[_0x4a459a(0x193)]((_0x1287eb,_0x518563)=>{var _0x27e411=_0x4a459a;_0x5cc46e[_0x518563][_0x27e411(0xa4)]=_0x1287eb;}),_0x41182d[_0x4a459a(0x193)]((_0x1b7756,_0x524071)=>{var _0x2c68ba=_0x4a459a;_0x5cc46e[_0x524071][_0x2c68ba(0xed)]=_0x1b7756;}),_0x365faf[_0x4a459a(0x193)]((_0x318ffb,_0xe794c8)=>{var _0x2af7b8=_0x4a459a;_0x5cc46e[_0xe794c8][_0x2af7b8(0x108)]=_0x318ffb;}),_0x2544b7[_0x4a459a(0x193)]((_0x3bc69a,_0xd02dc4)=>{var _0x5e2e3f=_0x4a459a;_0x5cc46e[_0xd02dc4][_0x5e2e3f(0x161)]=_0x3bc69a;}),_0x2d5d21[_0x4a459a(0x193)]((_0x5b6fcf,_0x4f53d1)=>{var _0x210e4b=_0x4a459a;_0x5cc46e[_0x4f53d1][_0x210e4b(0x14b)]=_0x5b6fcf;}),_0xaed3f9[_0x4a459a(0x193)]((_0x23d0d2,_0x14e24a)=>{var _0x4dfa1a=_0x4a459a;_0x5cc46e[_0x14e24a][_0x4dfa1a(0x119)]=_0x23d0d2;}),_0x8263d7['forEach']((_0x44fddc,_0x3a07fa)=>{var _0x388cc5=_0x4a459a;_0x5cc46e[_0x3a07fa][_0x388cc5(0xda)]=_0x44fddc;}),_0x5cc46e['forEach'](_0x256498=>{var _0x463572=_0x4a459a;console[_0x463572(0xd1)](_0x256498);const _0x1713b9=_0xdb5ee3[_0x463572(0xb0)][_0x463572(0xa2)](_0x2a3ef7=>{var _0x4a65e0=_0x463572;_0x2a3ef7[_0x4a65e0(0xb8)]==_0x256498[_0x4a65e0(0xb8)]&&_0x2a3ef7[_0x4a65e0(0x161)]==_0x256498[_0x4a65e0(0x161)]&&(console[_0x4a65e0(0xd1)](parseInt(_0x2a3ef7[_0x4a65e0(0xc2)])+_0x4a65e0(0x187)+parseInt(_0x256498['return_qty'])),_0x2a3ef7[_0x4a65e0(0xc2)]=parseInt(_0x2a3ef7[_0x4a65e0(0xc2)])-parseInt(_0x256498[_0x4a65e0(0x108)]));});}),await _0xdb5ee3[_0x4a459a(0xfb)]();var _0x943d39=0x0;_0x5cc46e[_0x4a459a(0x193)](_0x13dec7=>{var _0x5c2459=_0x4a459a;(parseInt(_0x13dec7[_0x5c2459(0xa4)])<parseInt(_0x13dec7[_0x5c2459(0x108)])||parseInt(_0x13dec7[_0x5c2459(0xed)])<parseInt(_0x13dec7['return_qty']))&&_0x943d39++;});if(_0x943d39!=0x0)return _0x14489f[_0x4a459a(0x179)](_0x4a459a(0x189),_0x4a459a(0x156)),_0x3a3308[_0x4a459a(0xe9)](_0x4a459a(0x16e));const _0x42eb85=new purchases_return_finished({'invoice':_0x43908f,'suppliers':_0x14489f[_0x4a459a(0xe1)][_0x4a459a(0x17e)],'date':_0x48bfa4,'warehouse_name':_0x597dd5,'return_product':_0x5cc46e,'note':_0x1c7ea4,'room':_0x1fa213,'to_warehouse_name':_0x20816a,'to_room':_0x1bf850}),_0x3362b9=await _0x42eb85[_0x4a459a(0xfb)](),_0x51c8a4=await purchases_return_finished[_0x4a459a(0x184)]({'invoice':_0x43908f}),_0x1312a9=await warehouse[_0x4a459a(0x184)]({'name':_0x20816a,'room':_0x1bf850,'warehouse_category':_0x4a459a(0x120)});_0x51c8a4[_0x4a459a(0x105)][_0x4a459a(0x193)](_0x6d1f38=>{var _0xa97894=_0x4a459a,_0x353389=0x0;const _0x3b5372=_0x1312a9[_0xa97894(0xb0)][_0xa97894(0xa2)](_0x12ec91=>{var _0x57a74f=_0xa97894;console[_0x57a74f(0xd1)](_0x12ec91[_0x57a74f(0xb8)]+'=='+_0x6d1f38[_0x57a74f(0xb8)]+'&&'+_0x12ec91[_0x57a74f(0x161)]+'=='+_0x6d1f38['bay']),_0x12ec91[_0x57a74f(0xb8)]==_0x6d1f38[_0x57a74f(0xb8)]&&_0x12ec91[_0x57a74f(0x161)]==_0x6d1f38[_0x57a74f(0x161)]&&(_0x12ec91[_0x57a74f(0xc2)]=parseInt(_0x12ec91[_0x57a74f(0xc2)])-parseInt(_0x6d1f38[_0x57a74f(0x108)]),_0x353389++);});_0x353389=='0'&&(_0x1312a9[_0xa97894(0xb0)]=_0x1312a9[_0xa97894(0xb0)][_0xa97894(0x144)]({'product_name':_0x6d1f38[_0xa97894(0xb8)],'product_stock':_0x6d1f38[_0xa97894(0x108)],'primary_code':_0x6d1f38[_0xa97894(0x119)],'secondary_code':_0x6d1f38['secondary_code'],'product_code':_0x6d1f38[_0xa97894(0x14b)],'bay':_0x6d1f38['bay'],'maxProducts':0xf423f}));}),await _0x1312a9[_0x4a459a(0xfb)]();const _0xa8cf5a=await purchases_finished[_0x4a459a(0x184)]({'invoice':_0x43908f});_0xa8cf5a[_0x4a459a(0x132)]=_0x4a459a(0x12d);const _0x199889=await _0xa8cf5a['save'](),_0x11af12=new s_payment_data({'invoice':_0x43908f,'suppliers':_0x14489f[_0x4a459a(0xe1)][_0x4a459a(0x17e)],'reason':_0x4a459a(0x18e)});await _0x11af12['save']();const _0xa677c3=await master_shop['find'](),_0x47108d=await email_settings[_0x4a459a(0x184)](),_0x3df29c=await suppliers['findOne']({'name':_0x14489f['body']['suppliers']});_0xa677c3[0x0][_0x4a459a(0x122)]==0x1?(right_currency=_0xa677c3[0x0][_0x4a459a(0x10d)],left_currency=''):(right_currency='',left_currency=_0xa677c3[0x0][_0x4a459a(0x10d)]);var _0x5acce4=_0x45a2e2,_0x182ffb=_0x365faf,_0x309fd4='',_0x3f1df1;for(_0x3f1df1 in _0x5acce4){_0x309fd4+=_0x4a459a(0xc8)+_0x4a459a(0x170)+_0x5acce4[_0x3f1df1]+_0x4a459a(0xf5)+_0x4a459a(0x170)+_0x182ffb[_0x3f1df1]+_0x4a459a(0xf5)+_0x4a459a(0x19c);}let _0x1ee667=nodemailer[_0x4a459a(0x11d)]({'service':_0x4a459a(0x13e),'auth':{'user':_0x47108d[_0x4a459a(0x14a)],'pass':_0x47108d[_0x4a459a(0x114)]}}),_0x396cef={'from':_0x47108d[_0x4a459a(0x14a)],'to':_0x3df29c[_0x4a459a(0x14a)],'subject':_0x4a459a(0x14f),'attachments':[{'filename':'Logo.png','path':__dirname+_0x4a459a(0x130)+'/upload/'+_0xa677c3[0x0][_0x4a459a(0x113)],'cid':_0x4a459a(0x183)}],'html':'<!DOCTYPE\x20html>'+_0x4a459a(0x112)+_0x4a459a(0x128)+_0x4a459a(0x138)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4a459a(0x138)+_0x4a459a(0x15e)+_0x4a459a(0x19f)+'<div>'+'<h2>\x20'+_0xa677c3[0x0]['site_title']+'\x20</h2>'+_0x4a459a(0x19f)+_0x4a459a(0x19f)+'<hr\x20class=\x22my-3\x22>'+_0x4a459a(0x138)+_0x4a459a(0x15c)+_0x4a459a(0x15d)+_0x43908f+'\x20'+_0x4a459a(0xb2)+_0x4a459a(0x145)+_0x48bfa4+'\x20'+_0x4a459a(0xff)+_0x4a459a(0x11b)+_0x4a459a(0x19f)+_0x4a459a(0x15b)+_0x4a459a(0x151)+_0x4a459a(0xc8)+_0x4a459a(0x18d)+_0x4a459a(0x10e)+_0x4a459a(0x174)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x4a459a(0x19c)+_0x4a459a(0x168)+_0x4a459a(0x172)+'\x20'+_0x309fd4+'\x20'+_0x4a459a(0x9f)+'</table>'+_0x4a459a(0x138)+_0x4a459a(0xae)+_0x4a459a(0xd9)+_0xa677c3[0x0][_0x4a459a(0xa9)]+_0x4a459a(0x11b)+'</div>'+_0x4a459a(0x19f)+_0x4a459a(0x19a)};_0x1ee667[_0x4a459a(0x190)](_0x396cef,function(_0x178bce,_0x4e0705){var _0x491cd5=_0x4a459a;_0x178bce?console[_0x491cd5(0xd1)](_0x491cd5(0x17f)):console[_0x491cd5(0xd1)](_0x491cd5(0xf7));}),_0x14489f[_0x4a459a(0x179)](_0x4a459a(0x13d),_0x4a459a(0x133)),_0x3a3308[_0x4a459a(0xe9)](_0x4a459a(0xb3));}catch(_0x4b2d59){_0x3a3308[_0x4a459a(0xec)](0xc8)[_0x4a459a(0x104)]({'message':_0x4b2d59[_0x4a459a(0x176)]});}}),router[a0_0x47546a(0xe4)](a0_0x47546a(0x171),auth,async(_0x3a821d,_0x269a43)=>{var _0x21a12a=a0_0x47546a;try{const {username:_0x4d585b,email:_0xa9704c,role:_0x301972}=_0x3a821d['user'],_0xc3c2dd=_0x3a821d[_0x21a12a(0xfc)],_0x4ac2f2=await profile[_0x21a12a(0x184)]({'email':_0xc3c2dd[_0x21a12a(0x14a)]}),_0x1cce84=await master_shop[_0x21a12a(0x16b)](),_0x556082=_0x3a821d[_0x21a12a(0x11f)]['id'],_0x240117=await purchases_finished[_0x21a12a(0x107)](_0x556082);if(_0x1cce84[0x0][_0x21a12a(0x19d)]=='English\x20(US)')var _0x2ddf44=users[_0x21a12a(0x141)];else{if(_0x1cce84[0x0][_0x21a12a(0x19d)]==_0x21a12a(0xcc))var _0x2ddf44=users['Hindi'];else{if(_0x1cce84[0x0]['language']=='German')var _0x2ddf44=users[_0x21a12a(0xf1)];else{if(_0x1cce84[0x0]['language']==_0x21a12a(0x150))var _0x2ddf44=users[_0x21a12a(0x150)];else{if(_0x1cce84[0x0]['language']==_0x21a12a(0xc6))var _0x2ddf44=users['French'];else{if(_0x1cce84[0x0][_0x21a12a(0x19d)]==_0x21a12a(0xb4))var _0x2ddf44=users['Portuguese'];else{if(_0x1cce84[0x0][_0x21a12a(0x19d)]=='Chinese')var _0x2ddf44=users[_0x21a12a(0x134)];else{if(_0x1cce84[0x0][_0x21a12a(0x19d)]==_0x21a12a(0x173))var _0x2ddf44=users[_0x21a12a(0xa0)];}}}}}}}_0x269a43[_0x21a12a(0x163)](_0x21a12a(0xde),{'success':_0x3a821d['flash'](_0x21a12a(0x13d)),'errors':_0x3a821d[_0x21a12a(0x179)](_0x21a12a(0x189)),'role':_0xc3c2dd,'profile':_0x4ac2f2,'alldata':_0x240117,'master_shop':_0x1cce84,'language':_0x2ddf44}),console['log'](alldata);}catch(_0x23af6e){console[_0x21a12a(0xd1)](_0x23af6e);}}),router[a0_0x47546a(0x165)](a0_0x47546a(0xab),async(_0xcb6d55,_0x16bd70)=>{var _0x174814=a0_0x47546a;const {product_code:_0x303c15}=_0xcb6d55[_0x174814(0xe1)];var _0x25acd1;const _0x4248aa=await product[_0x174814(0x102)]([{'$match':{'primary_code':_0x303c15,'product_category':_0x174814(0x120)}},{'$group':{'_id':'$_id','name':{'$first':_0x174814(0x14c)},'category':{'$first':_0x174814(0x140)},'brand':{'$first':'$brand'},'unit':{'$first':_0x174814(0x15f)},'alertquantity':{'$first':_0x174814(0x191)},'product_code':{'$first':_0x174814(0xfd)},'primary_code':{'$first':_0x174814(0x115)},'secondary_code':{'$first':_0x174814(0x9c)},'maxStocks':{'$first':_0x174814(0xd2)},'maxProdPerUnit':{'$first':_0x174814(0xf0)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x174814(0x100)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x525ee3=await product[_0x174814(0x102)]([{'$match':{'secondary_code':_0x303c15}},{'$group':{'_id':_0x174814(0xc1),'name':{'$first':_0x174814(0x14c)},'category':{'$first':_0x174814(0x140)},'brand':{'$first':'$brand'},'unit':{'$first':_0x174814(0x15f)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x174814(0xfd)},'primary_code':{'$first':_0x174814(0x115)},'secondary_code':{'$first':_0x174814(0x9c)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x174814(0xf0)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x174814(0x100)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x4248aa[_0x174814(0xb1)]>0x0)_0x25acd1=_0x4248aa;else _0x525ee3[_0x174814(0xb1)]>0x0&&(_0x25acd1=_0x525ee3);_0x16bd70[_0x174814(0x104)](_0x25acd1);}),router[a0_0x47546a(0x165)](a0_0x47546a(0xbc),async(_0x189f2a,_0x41c40e)=>{var _0x339b3e=a0_0x47546a;const {productCode:_0x2bf76f,bay:_0x4b9a36,warehouses:_0x185e92,room:_0x488492}=_0x189f2a[_0x339b3e(0xe1)];console[_0x339b3e(0xd1)](_0x189f2a[_0x339b3e(0xe1)]);try{const _0x4bf51c=await warehouse['aggregate']([{'$match':{'name':_0x185e92,'room':_0x488492}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x4b9a36)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x339b3e(0x18b)},'product_stock':{'$first':_0x339b3e(0x101)},'bay':{'$first':_0x339b3e(0xd0)},'maxProducts':{'$first':_0x339b3e(0xc5)}}}]);_0x41c40e['status'](0xc8)[_0x339b3e(0x104)](_0x4bf51c);}catch(_0x56d1d3){_0x41c40e[_0x339b3e(0xec)](0x194)[_0x339b3e(0x104)]({'message':_0x56d1d3[_0x339b3e(0x176)]});}}),module[a0_0x47546a(0x148)]=router;