var a0_0x5c5cc7=a0_0x3d7e;(function(_0x6b1c1e,_0x43d500){var _0x4c2884=a0_0x3d7e,_0x595334=_0x6b1c1e();while(!![]){try{var _0x3538fd=parseInt(_0x4c2884(0xee))/0x1*(parseInt(_0x4c2884(0x118))/0x2)+parseInt(_0x4c2884(0x114))/0x3*(parseInt(_0x4c2884(0x120))/0x4)+parseInt(_0x4c2884(0x1ae))/0x5*(parseInt(_0x4c2884(0x19f))/0x6)+parseInt(_0x4c2884(0x1b8))/0x7+parseInt(_0x4c2884(0x19b))/0x8+parseInt(_0x4c2884(0x1aa))/0x9+-parseInt(_0x4c2884(0x123))/0xa;if(_0x3538fd===_0x43d500)break;else _0x595334['push'](_0x595334['shift']());}catch(_0x50b835){_0x595334['push'](_0x595334['shift']());}}}(a0_0x3ef3,0x902b2));function a0_0x3d7e(_0x51c868,_0x59c07c){var _0x3ef330=a0_0x3ef3();return a0_0x3d7e=function(_0x3d7e26,_0x544824){_0x3d7e26=_0x3d7e26-0xdc;var _0x4fc7c2=_0x3ef330[_0x3d7e26];return _0x4fc7c2;},a0_0x3d7e(_0x51c868,_0x59c07c);}const express=require(a0_0x5c5cc7(0x1c4)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x5c5cc7(0x12f)),auth=require(a0_0x5c5cc7(0x1d1)),nodemailer=require(a0_0x5c5cc7(0xde));function a0_0x3ef3(){var _0x157f74=['Arabic','all','Hindi','$invoice','master','<div>','</h5>','maxStocks','True','\x20</h2>','/give_payment/:id','/view','German','_id','then','$secondary_unit','</div>','date','all_purchases_finished','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','find','batch_code','$product_details.bay','MaxStocks_data','<span\x20style=\x22float:\x20right;\x22>','concat','prod_cat','Return\x20Goods','log','Finished\x20Goods','FROZEN\x20GOODS','product_date','map','Ambient','$product.type','staff','invoice','/upload/','$product_code','RoomAssign','$product.quantity','</head><body>','params','room','bay','/view/add_purchases/:id','user','$paid_amount','body','</span>','$batch_code','stock_quantity','Portuguese','/preview/:id','English','purchase\x20data\x20update\x20successfully','expiry_date','status','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</thead>','currency_placement','redirect','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$suppliers','Rack\x202','$product_details._id','json','$product','</tbody>','Chinese','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','email','/invoice/:id','$product_details.product_name','Error\x20Occurs','/view/return_purchase/:id','primary_code_hide','There\x27s\x20a\x20error\x20in\x20this\x20transaction','level','primary_code','logo','back','Error\x20occurred\x20while\x20processing\x20product:','<h5>','$product_details.bin','return_product','$product_details.storage','Email\x20sent\x20successfully','/barcode/:id','$date','JO_number','8209256avnGri','secondary_unit','suppliers','purchase_quantity','12QhegFz','</tr>','product','POnumber','Enclosed','product_details','floor','English\x20(US)','production_date','<html><head><title></title>','prod_invoice','7332696AUyjSl','abs','getFullYear','secondary_code','833410qMDiIV','/all_purchases/view','padStart','$product_details.rack','prod_code','table\x20page','due_amount','/all_purchases_finished/view','findOne','$secondary_code','6792107wYmYyZ','return_purchase_finished','catch','add_purchases_finished','INCF-','quantity','role','amount','product_code','$unit','$category','gmail','express','post','createTransport','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','prod_unit','get','sendMail','<strong>\x20Regards\x20</strong>','prod_primunit','render','return_qty','slice','getMonth','../middleware/auth','Rack\x201','$due_amount','$maxStocks','length','purchase_invoice','getDate','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','standard_unit','success','product_name','findById','port','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','toString','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','room_name','product_cat','$suppliers_docs','save','</td>','1BUVCUJ','$_id','site_title','product_stock','$primary_code','Portuguese\x20(BR)','Enabled','$room','prod_name','French','Arabic\x20(ae)','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_qty','warehouse','maxperunit','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</table>','flash','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','\x20Order\x20Number\x20:\x20','<!DOCTYPE\x20html>','path','</body></html>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$note','An\x20error\x20occurred\x20while\x20saving\x20data.','/view/add_purchases','message','purchase\x20data\x20add\x20successfully','Room_name','$product_details','<hr\x20class=\x22my-3\x22>','/view/:id','Spanish','$product.bay','58962FiGscw','$maxProdPerUnit','stocks','$product_details.primary_code','689942AkapWg','<tr>','string','image','$product_details.product_code','suppliers_docs','name','<tbody\x20style=\x22text-align:\x20center;\x22>','32JHEvva','DRY\x20GOODS','$product.floorlevel','30562550uxvdEs','secondary_code_hide','add_purchases\x20error','language','password','currency','<h5\x20style=\x22text-align:\x20left;\x22>','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','return_data','ejs','prod_level','../models/all_models','host','/CheckingWarehouse','$product_details.maxProducts','$expiry_date','paid_amount','max_product_unit','$warehouse_name','prod_Qty','$return_data','error','prod_secondunit','Purchase\x20Return\x20Mail','updateOne','aggregate','errors'];a0_0x3ef3=function(){return _0x157f74;};return a0_0x3ef3();}var ejs=require(a0_0x5c5cc7(0x12d));const path=require(a0_0x5c5cc7(0x106)),users=require('../public/language/languages.json');router['get'](a0_0x5c5cc7(0x14a),auth,async(_0x2d6bc6,_0x4e1b0b)=>{var _0x2f1ec8=a0_0x5c5cc7;try{const {username:_0x16ef7f,email:_0x3f4cca,role:_0x26d8e7}=_0x2d6bc6[_0x2f1ec8(0x16d)],_0x3ef919=_0x2d6bc6[_0x2f1ec8(0x16d)],_0x2bd85d=await profile['findOne']({'email':_0x3ef919[_0x2f1ec8(0x187)]}),_0x30d56b=await staff[_0x2f1ec8(0x1b6)]({'email':_0x3ef919[_0x2f1ec8(0x187)]});if(_0x3ef919[_0x2f1ec8(0x1be)]=='staff'){const _0x36554c=await staff[_0x2f1ec8(0x1b6)]({'email':_0x3ef919[_0x2f1ec8(0x187)]});}const _0x36f906=await master_shop['find']();let _0x2d2018;if(_0x3ef919[_0x2f1ec8(0x1be)]==_0x2f1ec8(0x162)){const _0x31ffc4=await staff['findOne']({'email':_0x3ef919[_0x2f1ec8(0x187)]});_0x2d2018=await purchases_finished[_0x2f1ec8(0x13d)]([{'$match':{'warehouse_name':_0x31ffc4[_0x2f1ec8(0xfc)]}},{'$lookup':{'from':_0x2f1ec8(0x19d),'localField':_0x2f1ec8(0x19d),'foreignField':_0x2f1ec8(0x11e),'as':_0x2f1ec8(0x11d)}},{'$unwind':_0x2f1ec8(0xeb)},{'$unwind':_0x2f1ec8(0x183)},{'$group':{'_id':_0x2f1ec8(0xef),'invoice':{'$first':_0x2f1ec8(0x142)},'suppliers':{'$first':_0x2f1ec8(0x17f)},'date':{'$first':_0x2f1ec8(0x199)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x2f1ec8(0xf5)},'product':{'$push':'$product'},'note':{'$first':_0x2f1ec8(0x109)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x2f1ec8(0x1d3)},'return_data':{'$first':_0x2f1ec8(0x138)},'batch_code':{'$first':_0x2f1ec8(0x171)},'expiry_date':{'$first':_0x2f1ec8(0x133)},'suppliers_docs':{'$first':_0x2f1ec8(0xeb)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2f1ec8(0x113)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x2f1ec8(0x161)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2d2018=await purchases_finished['aggregate']([{'$unwind':_0x2f1ec8(0x183)},{'$group':{'_id':_0x2f1ec8(0xef),'invoice':{'$first':_0x2f1ec8(0x142)},'suppliers':{'$first':_0x2f1ec8(0x17f)},'date':{'$first':_0x2f1ec8(0x199)},'warehouse_name':{'$first':_0x2f1ec8(0x136)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x2f1ec8(0x183)},'note':{'$first':_0x2f1ec8(0x109)},'paid_amount':{'$first':_0x2f1ec8(0x16e)},'due_amount':{'$first':_0x2f1ec8(0x1d3)},'return_data':{'$first':_0x2f1ec8(0x138)},'batch_code':{'$first':_0x2f1ec8(0x171)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2f1ec8(0xeb)},'total_product_quantity':{'$sum':_0x2f1ec8(0x167)},'level':{'$addToSet':_0x2f1ec8(0x113)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2f1ec8(0x122)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x36f906[0x0][_0x2f1ec8(0x126)]==_0x2f1ec8(0x1a6))var _0x20e828=users[_0x2f1ec8(0x175)];else{if(_0x36f906[0x0][_0x2f1ec8(0x126)]==_0x2f1ec8(0x141))var _0x20e828=users[_0x2f1ec8(0x141)];else{if(_0x36f906[0x0]['language']=='German')var _0x20e828=users['German'];else{if(_0x36f906[0x0][_0x2f1ec8(0x126)]==_0x2f1ec8(0x112))var _0x20e828=users[_0x2f1ec8(0x112)];else{if(_0x36f906[0x0][_0x2f1ec8(0x126)]==_0x2f1ec8(0xf7))var _0x20e828=users[_0x2f1ec8(0xf7)];else{if(_0x36f906[0x0][_0x2f1ec8(0x126)]=='Portuguese\x20(BR)')var _0x20e828=users[_0x2f1ec8(0x173)];else{if(_0x36f906[0x0][_0x2f1ec8(0x126)]=='Chinese')var _0x20e828=users['Chinese'];else{if(_0x36f906[0x0]['language']==_0x2f1ec8(0xf8))var _0x20e828=users[_0x2f1ec8(0x13f)];}}}}}}}_0x4e1b0b['render'](_0x2f1ec8(0x151),{'success':_0x2d6bc6[_0x2f1ec8(0x101)](_0x2f1ec8(0xe1)),'errors':_0x2d6bc6[_0x2f1ec8(0x101)]('errors'),'purchases':_0x2d2018,'role':_0x3ef919,'profile':_0x2bd85d,'master_shop':_0x36f906,'language':_0x20e828});}catch(_0x243608){console[_0x2f1ec8(0x15b)](_0x2f1ec8(0x1b3),_0x243608),_0x4e1b0b[_0x2f1ec8(0x178)](0xc8)[_0x2f1ec8(0x182)]({'message':_0x243608[_0x2f1ec8(0x10c)]});}});function BayBinSelected(_0x280f4c,_0x32c6a1){var _0x57aff8=a0_0x5c5cc7,_0x35a206=[],_0x1c9461=[];if(_0x280f4c==_0x57aff8(0x121)){switch(_0x32c6a1){case _0x57aff8(0x1d2):_0x35a206=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x35a206=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1c9461=['DG'];}else{if(_0x280f4c==_0x57aff8(0x15d)){switch(_0x32c6a1){case _0x57aff8(0x1d2):_0x35a206=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x57aff8(0x180):_0x35a206=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1c9461=['FG'];}}return{'levels':_0x35a206,'identify':_0x1c9461};}async function getRandom8DigitNumber(){var _0x2c131f=a0_0x5c5cc7;const _0x5eb4ae=0x989680,_0x5b1e53=0x5f5e0ff,_0x1229e2=Math[_0x2c131f(0x1a5)](Math['random']()*(_0x5b1e53-_0x5eb4ae+0x1))+_0x5eb4ae;var _0x12a05b;const _0x1307c7=await purchases_finished[_0x2c131f(0x1b6)]({'invoice':'INCF-'+_0x1229e2});return _0x1307c7&&_0x1307c7[_0x2c131f(0x1d5)]>0x0?_0x12a05b=_0x2c131f(0x1bc)+_0x1229e2:_0x12a05b=_0x2c131f(0x1bc)+_0x1229e2,_0x12a05b;}router['get'](a0_0x5c5cc7(0x10b),auth,async(_0x1b4571,_0x22af24)=>{var _0x3f3024=a0_0x5c5cc7;try{const {username:_0x16baa8,email:_0x12c74a,role:_0x193c70}=_0x1b4571[_0x3f3024(0x16d)],_0x1581b1=_0x1b4571[_0x3f3024(0x16d)],_0x3176fd=await profile[_0x3f3024(0x1b6)]({'email':_0x1581b1[_0x3f3024(0x187)]}),_0x45f39e=await master_shop['find'](),_0x4af926=await staff['findOne']({'email':_0x1581b1[_0x3f3024(0x187)]}),_0x5622cb=await suppliers['find']({});let _0x511c59;if(_0x1581b1['role']==_0x3f3024(0x162)){const _0x421e55=await staff[_0x3f3024(0x1b6)]({'email':_0x1581b1[_0x3f3024(0x187)]});_0x511c59=await warehouse[_0x3f3024(0x13d)]([{'$match':{'status':_0x3f3024(0xf4),'name':_0x421e55['warehouse'],'warehouse_category':_0x3f3024(0x15c)}},{'$group':{'_id':_0x3f3024(0xfe),'name':{'$first':_0x3f3024(0xfe)}}}]);}else _0x511c59=await warehouse[_0x3f3024(0x13d)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x3f3024(0xfe)}}}]);const _0x52edca=await product[_0x3f3024(0x153)]({}),_0x33596a=await warehouse[_0x3f3024(0x153)]({'status':'Enabled'}),_0x152bbe=await purchases_finished[_0x3f3024(0x153)]({}),_0xf1aa10=_0x152bbe[_0x3f3024(0x1d5)]+0x1,_0x15a5b8='INCF-'+_0xf1aa10[_0x3f3024(0xe6)]()[_0x3f3024(0x1b0)](0x5,'0');var _0x49505a=[_0x3f3024(0x160),_0x3f3024(0x1a3)];if(_0x45f39e[0x0][_0x3f3024(0x126)]==_0x3f3024(0x1a6))var _0x3ff2a7=users['English'];else{if(_0x45f39e[0x0]['language']==_0x3f3024(0x141))var _0x3ff2a7=users[_0x3f3024(0x141)];else{if(_0x45f39e[0x0][_0x3f3024(0x126)]==_0x3f3024(0x14b))var _0x3ff2a7=users[_0x3f3024(0x14b)];else{if(_0x45f39e[0x0][_0x3f3024(0x126)]==_0x3f3024(0x112))var _0x3ff2a7=users[_0x3f3024(0x112)];else{if(_0x45f39e[0x0][_0x3f3024(0x126)]=='French')var _0x3ff2a7=users[_0x3f3024(0xf7)];else{if(_0x45f39e[0x0][_0x3f3024(0x126)]==_0x3f3024(0xf3))var _0x3ff2a7=users[_0x3f3024(0x173)];else{if(_0x45f39e[0x0][_0x3f3024(0x126)]==_0x3f3024(0x185))var _0x3ff2a7=users[_0x3f3024(0x185)];else{if(_0x45f39e[0x0][_0x3f3024(0x126)]==_0x3f3024(0xf8))var _0x3ff2a7=users['Arabic'];}}}}}}}const _0x16f74d=getRandom8DigitNumber();_0x16f74d[_0x3f3024(0x14d)](_0x271176=>{var _0x1b7e19=_0x3f3024;_0x22af24[_0x1b7e19(0x1cd)](_0x1b7e19(0x1bb),{'success':_0x1b4571['flash'](_0x1b7e19(0xe1)),'errors':_0x1b4571[_0x1b7e19(0x101)]('errors'),'role':_0x1581b1,'profile':_0x3176fd,'suppliers':_0x5622cb,'warehouse':_0x511c59,'product':_0x52edca,'invoice':_0x271176,'master_shop':_0x45f39e,'language':_0x3ff2a7,'find_data':_0x33596a,'rooms_data':_0x49505a});})[_0x3f3024(0x1ba)](_0x4b7ca3=>{var _0x2feca4=_0x3f3024;_0x1b4571[_0x2feca4(0x101)](_0x2feca4(0x13e),_0x2feca4(0x18d)),_0x22af24['redirect'](_0x2feca4(0x1b5));});}catch(_0x579c6e){console[_0x3f3024(0x15b)](_0x579c6e);}}),router['get'](a0_0x5c5cc7(0x16c),auth,async(_0x268188,_0x5aada5)=>{var _0x80f140=a0_0x5c5cc7;try{const _0x23a29d=_0x268188['params']['id'];console[_0x80f140(0x15b)](_0x23a29d);const _0x34f1f2=await master_shop[_0x80f140(0x153)]();console[_0x80f140(0x15b)](_0x80f140(0x143),_0x34f1f2);const _0x4bdfe3=await product[_0x80f140(0x1b6)]({'name':_0x23a29d});console['log'](_0x80f140(0x1a1),_0x4bdfe3),_0x5aada5[_0x80f140(0x178)](0xc8)[_0x80f140(0x182)]({'product_data':_0x4bdfe3,'master':_0x34f1f2});}catch(_0x4784cf){console[_0x80f140(0x15b)](_0x80f140(0x125),_0x4784cf);}}),router[a0_0x5c5cc7(0x1c5)](a0_0x5c5cc7(0x10b),auth,async(_0x20f836,_0x5d4849)=>{var _0x4342cf=a0_0x5c5cc7;try{const {invoice:_0x581a72,date:_0x376f12,warehouse_name:_0x249141,prod_name:_0x5ca2c6,prod_code:_0x57c68a,prod_qty:_0x25c288,prod_unit:_0x5da904,prod_secondunit:_0x56fffc,prod_level:_0x136020,prod_isle:_0x2a78bc,prod_pallet:_0x3015e9,note:_0x295b8f,expiry_date:_0x320281,batch_code:_0x124f04,payable:_0x8f0092,due_amount:_0x51c56a,Room_name:_0x5a5d28,primary_code:_0x4bde57,secondary_code:_0x453391,MaxStocks_data:_0x51f1df,PO_number:_0x510fde,SCRN:_0xae3c73,JO_number:_0x17cac5}=_0x20f836[_0x4342cf(0x16f)];if(typeof _0x5ca2c6==_0x4342cf(0x11a))var _0x392da9=[_0x20f836[_0x4342cf(0x16f)]['prod_name']],_0xae18ab=[_0x20f836['body'][_0x4342cf(0x1b2)]],_0xb77d2d=[_0x20f836['body']['prod_Qty']],_0x33f0d8=[_0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x1cc)]],_0x57dcc4=[_0x20f836[_0x4342cf(0x16f)]['prod_secondunit']],_0x1838c9=[_0x20f836[_0x4342cf(0x16f)]['prod_level']],_0x385ef0=[_0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x18f)]],_0x4758f6=[_0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x1ad)]],_0x4c2bb2=[_0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x156)]],_0x4e16bf=[_0x20f836[_0x4342cf(0x16f)]['batch_code']],_0x238315=[_0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x177)]],_0x3ffa83=[_0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x15e)]],_0x1d7d0f=[_0x20f836[_0x4342cf(0x16f)]['max_product_unit']],_0x5b3ddd=[_0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x159)]],_0x539186=[_0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x166)]],_0x2eba74=[_0x20f836[_0x4342cf(0x16f)]['prod_invoice']];else var _0x392da9=[..._0x20f836[_0x4342cf(0x16f)]['prod_name']],_0xae18ab=[..._0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x1b2)]],_0xb77d2d=[..._0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x137)]],_0x33f0d8=[..._0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x1cc)]],_0x57dcc4=[..._0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x13a)]],_0x1838c9=[..._0x20f836[_0x4342cf(0x16f)]['prod_level']],_0x385ef0=[..._0x20f836[_0x4342cf(0x16f)]['primary_code']],_0x4758f6=[..._0x20f836['body'][_0x4342cf(0x1ad)]],_0x4c2bb2=[..._0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x156)]],_0x4e16bf=[..._0x20f836['body'][_0x4342cf(0x154)]],_0x238315=[..._0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x177)]],_0x3ffa83=[..._0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x15e)]],_0x1d7d0f=[..._0x20f836['body'][_0x4342cf(0x135)]],_0x5b3ddd=[..._0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x159)]],_0x539186=[..._0x20f836['body'][_0x4342cf(0x166)]],_0x2eba74=[..._0x20f836[_0x4342cf(0x16f)][_0x4342cf(0x1a9)]];const _0x34192b=_0x392da9[_0x4342cf(0x15f)](_0x93a41f=>{return _0x93a41f={'product_name':_0x93a41f};});_0xae18ab[_0x4342cf(0xf9)]((_0x58f888,_0x4bcf2c)=>{var _0x414eff=_0x4342cf;_0x34192b[_0x4bcf2c][_0x414eff(0x1c0)]=_0x58f888;}),_0xb77d2d['forEach']((_0x466390,_0x1c2138)=>{var _0x4d5bea=_0x4342cf;_0x34192b[_0x1c2138][_0x4d5bea(0x1bd)]=Math[_0x4d5bea(0x1ab)](_0x466390);}),_0x33f0d8[_0x4342cf(0xf9)]((_0x2bd0f2,_0x263a5d)=>{_0x34192b[_0x263a5d]['standard_unit']=_0x2bd0f2;}),_0x57dcc4[_0x4342cf(0xf9)]((_0x450c85,_0x5566e7)=>{_0x34192b[_0x5566e7]['secondary_unit']=_0x450c85;}),_0x1838c9['forEach']((_0x1f7dbd,_0x3e77a7)=>{var _0x58bf86=_0x4342cf;_0x34192b[_0x3e77a7][_0x58bf86(0x16b)]=_0x1f7dbd;}),_0x385ef0[_0x4342cf(0xf9)]((_0x35da66,_0x139d54)=>{var _0x491848=_0x4342cf;_0x34192b[_0x139d54][_0x491848(0x18f)]=_0x35da66;}),_0x4758f6[_0x4342cf(0xf9)]((_0x1fb57a,_0x390612)=>{var _0x3bda23=_0x4342cf;_0x34192b[_0x390612][_0x3bda23(0x1ad)]=_0x1fb57a;}),_0x4c2bb2[_0x4342cf(0xf9)]((_0x34bc07,_0x40dc24)=>{var _0x421186=_0x4342cf;_0x34192b[_0x40dc24][_0x421186(0x146)]=_0x34bc07;}),_0x4e16bf['forEach']((_0xd61e5b,_0x186f24)=>{var _0xe61664=_0x4342cf;_0x34192b[_0x186f24][_0xe61664(0x154)]=_0xd61e5b;}),_0x238315[_0x4342cf(0xf9)]((_0x594628,_0x14f2b4)=>{_0x34192b[_0x14f2b4]['expiry_date']=_0x594628;}),_0x3ffa83[_0x4342cf(0xf9)]((_0x536fa2,_0x55363a)=>{var _0x10f08b=_0x4342cf;_0x34192b[_0x55363a][_0x10f08b(0x1a7)]=_0x536fa2;}),_0x1d7d0f[_0x4342cf(0xf9)]((_0x46b12c,_0x25b651)=>{var _0x55c0f0=_0x4342cf;_0x34192b[_0x25b651][_0x55c0f0(0xfd)]=_0x46b12c;}),_0x5b3ddd[_0x4342cf(0xf9)]((_0x451c2e,_0x3eabd9)=>{var _0x3ec267=_0x4342cf;_0x34192b[_0x3eabd9][_0x3ec267(0xea)]=_0x451c2e;}),_0x539186[_0x4342cf(0xf9)]((_0x2ae8f0,_0x5cc484)=>{var _0xfdb03a=_0x4342cf;_0x34192b[_0x5cc484][_0xfdb03a(0xe9)]=_0x2ae8f0;}),_0x2eba74[_0x4342cf(0xf9)]((_0xb175a8,_0x19aedf)=>{var _0xff0a97=_0x4342cf;_0x34192b[_0x19aedf][_0xff0a97(0x163)]=_0xb175a8;});const _0xe08f08=_0x34192b['filter'](_0x4226fe=>_0x4226fe[_0x4342cf(0x1bd)]!=='0'&&_0x4226fe['quantity']!==''),_0x1e44b2=new purchases_finished({'invoice':_0x581a72,'suppliers':_0x20f836['body']['suppliers'],'date':_0x376f12,'warehouse_name':_0x249141,'product':_0xe08f08,'note':_0x295b8f,'due_amount':_0x51c56a,'room':_0x5a5d28,'POnumber':_0x510fde,'SCRN':_0xae3c73,'JO_number':_0x17cac5}),_0x5b9d4=await _0x1e44b2[_0x4342cf(0xec)](),_0xfce72=await purchases_finished['findOne']({'invoice':_0x581a72}),_0x2bee30=_0xfce72[_0x4342cf(0x1a1)][_0x4342cf(0x15f)](async _0x32ffda=>{var _0x21d308=_0x4342cf;try{var _0x464400=await warehouse[_0x21d308(0x1b6)]({'name':_0x249141,'room':_0x32ffda[_0x21d308(0xe9)]}),_0x2c7513=0x0;const _0x20e1d9=_0x464400[_0x21d308(0x1a4)][_0x21d308(0x15f)](_0x75e364=>{var _0xf8cba7=_0x21d308;console[_0xf8cba7(0x15b)](_0x75e364['product_name']+'=='+_0x32ffda[_0xf8cba7(0xe2)]+'&&'+_0x75e364[_0xf8cba7(0x16b)]+'=='+_0x32ffda['bay']+'&&'+_0x75e364[_0xf8cba7(0x177)]+'=='+_0x32ffda[_0xf8cba7(0x177)]+'&&'+_0x75e364['production_date']+'=='+_0x32ffda['production_date']+'&&'+_0x75e364['batch_code']+'=='+_0x32ffda[_0xf8cba7(0x154)]+'&&'+_0x75e364[_0xf8cba7(0x163)]+'=='+_0xfce72[_0xf8cba7(0x163)]),_0x75e364[_0xf8cba7(0xe2)]==_0x32ffda['product_name']&&_0x75e364[_0xf8cba7(0x16b)]==_0x32ffda[_0xf8cba7(0x16b)]&&_0x75e364[_0xf8cba7(0x177)]==_0x32ffda[_0xf8cba7(0x177)]&&_0x75e364[_0xf8cba7(0x1a7)]==_0x32ffda[_0xf8cba7(0x1a7)]&&_0x75e364[_0xf8cba7(0x154)]==_0x32ffda[_0xf8cba7(0x154)]&&_0x75e364[_0xf8cba7(0x163)]==_0xfce72[_0xf8cba7(0x163)]&&(_0x75e364[_0xf8cba7(0xf1)]=Math['abs'](_0x75e364['product_stock'])+Math[_0xf8cba7(0x1ab)](_0x32ffda[_0xf8cba7(0x1bd)]),_0x2c7513++);});return _0x2c7513==0x0&&(_0x464400[_0x21d308(0x1a4)]=_0x464400[_0x21d308(0x1a4)][_0x21d308(0x158)]({'product_name':_0x32ffda['product_name'],'product_stock':Math[_0x21d308(0x1ab)](_0x32ffda['quantity']),'primary_code':_0x32ffda[_0x21d308(0x18f)],'secondary_code':_0x32ffda[_0x21d308(0x1ad)],'product_code':_0x32ffda[_0x21d308(0x1c0)],'bay':_0x32ffda['bay'],'maxProducts':_0x32ffda['maxStocks'],'unit':_0x32ffda[_0x21d308(0xe0)],'secondary_unit':_0x32ffda['secondary_unit'],'expiry_date':_0x32ffda[_0x21d308(0x177)],'production_date':_0x32ffda[_0x21d308(0x1a7)],'maxProducts':_0x32ffda[_0x21d308(0x146)],'maxPerUnit':_0x32ffda[_0x21d308(0xfd)],'batch_code':_0x32ffda['batch_code'],'product_cat':_0x32ffda['product_cat'],'invoice':_0x32ffda[_0x21d308(0x163)],'id_incoming':_0x32ffda[_0x21d308(0x14c)]})),_0x464400;}catch(_0x103d77){return console[_0x21d308(0x139)](_0x21d308(0x192),_0x103d77),null;}});Promise[_0x4342cf(0x140)](_0x2bee30)[_0x4342cf(0x14d)](async _0x17f6c8=>{var _0x4e524f=_0x4342cf;try{for(const _0x5cec05 of _0x17f6c8){await warehouse[_0x4e524f(0x13c)]({'_id':_0x5cec05[_0x4e524f(0x14c)]},{'$addToSet':{'product_details':{'$each':_0x5cec05[_0x4e524f(0x1a4)]}}});}const _0x3f6379=await master_shop[_0x4e524f(0x153)](),_0x39ee4a=await email_settings[_0x4e524f(0x1b6)](),_0x20db7c=await supervisor_settings['find']();var _0x4b81cf=_0xfce72['product'],_0x3860a3='',_0x29a313;for(_0x29a313 in _0x4b81cf){var _0x246d62='FG';_0xfce72['warehouse_name']==_0x4e524f(0x121)&&(_0x246d62='DG'),_0x3860a3+=_0x4e524f(0x119)+_0x4e524f(0x152)+_0x4b81cf[_0x29a313][_0x4e524f(0xe2)]+_0x4e524f(0xed)+_0x4e524f(0x152)+_0x4b81cf[_0x29a313][_0x4e524f(0x1c0)]+'</td>'+_0x4e524f(0x152)+_0x4b81cf[_0x29a313][_0x4e524f(0x1bd)]+_0x4e524f(0xed)+_0x4e524f(0x152)+_0x4b81cf[_0x29a313][_0x4e524f(0xe0)]+_0x4e524f(0xed)+_0x4e524f(0x152)+_0x4b81cf[_0x29a313][_0x4e524f(0x19c)]+_0x4e524f(0xed)+_0x4e524f(0x152)+_0xfce72[_0x4e524f(0x12a)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b81cf[_0x29a313]['room_name']+_0x4e524f(0xed)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x246d62+_0x4b81cf[_0x29a313]['bay']+'</td>',_0x4e524f(0x1a0);}let _0x51c07a=nodemailer[_0x4e524f(0x1c6)]({'host':_0x39ee4a[_0x4e524f(0x130)],'port':Number(_0x39ee4a[_0x4e524f(0xe4)]),'secure':![],'auth':{'user':_0x39ee4a[_0x4e524f(0x187)],'pass':_0x39ee4a[_0x4e524f(0x127)]}}),_0x3799e4={'from':_0x39ee4a['email'],'to':_0x20db7c[0x0]['FGSEmail'],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x4e524f(0x164)+_0x3f6379[0x0][_0x4e524f(0x11b)],'cid':'logo'}],'html':_0x4e524f(0x105)+_0x4e524f(0x1a8)+_0x4e524f(0x168)+_0x4e524f(0x144)+_0x4e524f(0xe7)+'<div>'+_0x4e524f(0x186)+_0x4e524f(0x14f)+_0x4e524f(0x144)+'<h2>\x20'+_0x3f6379[0x0][_0x4e524f(0xf0)]+_0x4e524f(0x148)+_0x4e524f(0x14f)+_0x4e524f(0x14f)+_0x4e524f(0x110)+_0x4e524f(0x144)+_0x4e524f(0x129)+_0x4e524f(0x104)+_0xfce72['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0xfce72[_0x4e524f(0x150)]+'\x20'+_0x4e524f(0x170)+_0x4e524f(0x145)+_0x4e524f(0x14f)+_0x4e524f(0x17e)+_0x4e524f(0x108)+_0x4e524f(0x119)+_0x4e524f(0xfa)+_0x4e524f(0xff)+_0x4e524f(0x17a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x4e524f(0xe8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x4e524f(0x1c7)+_0x4e524f(0xdf)+_0x4e524f(0x1a0)+_0x4e524f(0x17b)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3860a3+'\x20'+'</tbody>'+_0x4e524f(0x100)+_0x4e524f(0x144)+_0x4e524f(0x1cb)+_0x4e524f(0x193)+_0x3f6379[0x0][_0x4e524f(0xf0)]+_0x4e524f(0x145)+_0x4e524f(0x14f)+_0x4e524f(0x14f)+_0x4e524f(0x107)};_0x51c07a[_0x4e524f(0x1ca)](_0x3799e4,function(_0x1a260c,_0x45fce7){var _0x1dc55f=_0x4e524f;_0x1a260c?(console[_0x1dc55f(0x15b)](_0x1a260c),console[_0x1dc55f(0x15b)](_0x1dc55f(0x18a))):console['log']('Email\x20sent\x20successfully');});}catch(_0x2c6aad){console[_0x4e524f(0x139)](_0x2c6aad),_0x5d4849[_0x4e524f(0x178)](0x1f4)[_0x4e524f(0x182)]({'error':_0x4e524f(0x10a),'message':_0x2c6aad['message']});}})[_0x4342cf(0x1ba)](_0x2e6288=>{var _0x36ee06=_0x4342cf;console[_0x36ee06(0x139)](_0x2e6288);}),_0x20f836[_0x4342cf(0x101)]('success',_0x4342cf(0x10d)),_0x5d4849['redirect'](_0x4342cf(0x1b5));}catch(_0x34edde){console['log'](_0x34edde);}}),router[a0_0x5c5cc7(0x1c9)](a0_0x5c5cc7(0x174),auth,async(_0x55ab3c,_0x720fda)=>{var _0x2aafe3=a0_0x5c5cc7;try{const {username:_0x5eb46e,email:_0x494c54,role:_0x392988}=_0x55ab3c[_0x2aafe3(0x16d)],_0x565356=_0x55ab3c[_0x2aafe3(0x16d)],_0x4ebf58=await profile[_0x2aafe3(0x1b6)]({'email':_0x565356['email']}),_0x307eb6=await master_shop[_0x2aafe3(0x153)](),_0x1d81bd=_0x55ab3c[_0x2aafe3(0x169)]['id'],_0x31db77=await purchases_finished[_0x2aafe3(0xe3)](_0x1d81bd),_0x1638ba=await suppliers['find']({});let _0x498778;if(_0x565356[_0x2aafe3(0x1be)]==_0x2aafe3(0x162)){const _0x2a3d9c=await staff[_0x2aafe3(0x1b6)]({'email':_0x565356['email']});_0x498778=await warehouse[_0x2aafe3(0x153)]({'status':_0x2aafe3(0xf4),'name':_0x2a3d9c['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x498778=await warehouse['aggregate']([{'$match':{'status':_0x2aafe3(0xf4),'warehouse_category':_0x2aafe3(0x15c)}},{'$group':{'_id':_0x2aafe3(0xfe),'name':{'$first':_0x2aafe3(0xfe)}}}]);const _0x1b7edf=await product[_0x2aafe3(0x153)]({}),_0x50f608=BayBinSelected(_0x31db77['warehouse_name'],_0x31db77['room']);let _0x5eb86b=new Date(_0x31db77['expiry_date']),_0x49c467=('0'+_0x5eb86b[_0x2aafe3(0xdd)]())[_0x2aafe3(0x1cf)](-0x2),_0x2ac720=('0'+(_0x5eb86b[_0x2aafe3(0x1d0)]()+0x1))[_0x2aafe3(0x1cf)](-0x2),_0x278fc0=_0x5eb86b[_0x2aafe3(0x1ac)](),_0x319db1=_0x278fc0+'-'+_0x2ac720+'-'+_0x49c467;if(_0x307eb6[0x0][_0x2aafe3(0x126)]=='English\x20(US)'){var _0x4512ab=users[_0x2aafe3(0x175)];console[_0x2aafe3(0x15b)](_0x4512ab);}else{if(_0x307eb6[0x0][_0x2aafe3(0x126)]==_0x2aafe3(0x141))var _0x4512ab=users[_0x2aafe3(0x141)];else{if(_0x307eb6[0x0][_0x2aafe3(0x126)]==_0x2aafe3(0x14b))var _0x4512ab=users['German'];else{if(_0x307eb6[0x0][_0x2aafe3(0x126)]==_0x2aafe3(0x112))var _0x4512ab=users[_0x2aafe3(0x112)];else{if(_0x307eb6[0x0][_0x2aafe3(0x126)]==_0x2aafe3(0xf7))var _0x4512ab=users[_0x2aafe3(0xf7)];else{if(_0x307eb6[0x0][_0x2aafe3(0x126)]==_0x2aafe3(0xf3))var _0x4512ab=users[_0x2aafe3(0x173)];else{if(_0x307eb6[0x0][_0x2aafe3(0x126)]=='Chinese')var _0x4512ab=users[_0x2aafe3(0x185)];else{if(_0x307eb6[0x0][_0x2aafe3(0x126)]==_0x2aafe3(0xf8))var _0x4512ab=users[_0x2aafe3(0x13f)];}}}}}}}_0x720fda[_0x2aafe3(0x1cd)]('edit_purchases_finished_view',{'success':_0x55ab3c[_0x2aafe3(0x101)](_0x2aafe3(0xe1)),'errors':_0x55ab3c[_0x2aafe3(0x101)](_0x2aafe3(0x13e)),'role':_0x565356,'profile':_0x4ebf58,'purchases':_0x31db77,'suppliers':_0x1638ba,'warehouse':_0x498778,'product':_0x1b7edf,'master_shop':_0x307eb6,'language':_0x4512ab,'ed_fullDate':_0x319db1,'dataSelected':_0x50f608});}catch(_0x3deed9){console[_0x2aafe3(0x15b)](_0x3deed9);}}),router['get'](a0_0x5c5cc7(0x111),auth,async(_0x77fae0,_0x383dc4)=>{var _0x103910=a0_0x5c5cc7;try{const {username:_0x4bb954,email:_0x3c2154,role:_0x36a3c6}=_0x77fae0[_0x103910(0x16d)],_0x5aa118=_0x77fae0['user'],_0x26a834=await profile['findOne']({'email':_0x5aa118['email']}),_0x101d53=await master_shop['find'](),_0x107e94=_0x77fae0[_0x103910(0x169)]['id'],_0x6f4101=await purchases_finished['findById'](_0x107e94),_0x3f88b5=await suppliers[_0x103910(0x153)]({});let _0x3a2939;if(_0x5aa118['role']=='staff'){const _0x5dbc97=await staff[_0x103910(0x1b6)]({'email':_0x5aa118[_0x103910(0x187)]});_0x3a2939=await warehouse['find']({'status':_0x103910(0xf4),'name':_0x5dbc97[_0x103910(0xfc)],'warehouse_category':'Finished\x20Goods'});}else _0x3a2939=await warehouse[_0x103910(0x13d)]([{'$match':{'status':_0x103910(0xf4),'warehouse_category':_0x103910(0x15c)}},{'$group':{'_id':_0x103910(0xfe),'name':{'$first':'$name'}}}]);const _0x5b8ff4=await product[_0x103910(0x153)]({}),_0x1ad973=BayBinSelected(_0x6f4101['warehouse_name'],_0x6f4101['room']);let _0x112c19=new Date(_0x6f4101[_0x103910(0x177)]),_0x523a67=('0'+_0x112c19[_0x103910(0xdd)]())[_0x103910(0x1cf)](-0x2),_0xc549a2=('0'+(_0x112c19[_0x103910(0x1d0)]()+0x1))[_0x103910(0x1cf)](-0x2),_0x5c0e9f=_0x112c19[_0x103910(0x1ac)](),_0xf9f3e9=_0x5c0e9f+'-'+_0xc549a2+'-'+_0x523a67;if(_0x101d53[0x0][_0x103910(0x126)]==_0x103910(0x1a6)){var _0x35483f=users[_0x103910(0x175)];console[_0x103910(0x15b)](_0x35483f);}else{if(_0x101d53[0x0]['language']==_0x103910(0x141))var _0x35483f=users['Hindi'];else{if(_0x101d53[0x0][_0x103910(0x126)]==_0x103910(0x14b))var _0x35483f=users['German'];else{if(_0x101d53[0x0][_0x103910(0x126)]==_0x103910(0x112))var _0x35483f=users['Spanish'];else{if(_0x101d53[0x0][_0x103910(0x126)]==_0x103910(0xf7))var _0x35483f=users[_0x103910(0xf7)];else{if(_0x101d53[0x0][_0x103910(0x126)]==_0x103910(0xf3))var _0x35483f=users[_0x103910(0x173)];else{if(_0x101d53[0x0]['language']==_0x103910(0x185))var _0x35483f=users[_0x103910(0x185)];else{if(_0x101d53[0x0][_0x103910(0x126)]=='Arabic\x20(ae)')var _0x35483f=users[_0x103910(0x13f)];}}}}}}}_0x383dc4['render']('edit_purchases_finished',{'success':_0x77fae0['flash'](_0x103910(0xe1)),'errors':_0x77fae0[_0x103910(0x101)]('errors'),'role':_0x5aa118,'profile':_0x26a834,'purchases':_0x6f4101,'suppliers':_0x3f88b5,'warehouse':_0x3a2939,'product':_0x5b8ff4,'master_shop':_0x101d53,'language':_0x35483f,'ed_fullDate':_0xf9f3e9,'dataSelected':_0x1ad973});}catch(_0x4f3727){console[_0x103910(0x15b)](_0x4f3727);}}),router[a0_0x5c5cc7(0x1c5)](a0_0x5c5cc7(0x111),auth,async(_0x1e1392,_0xfb6ba9)=>{var _0x4c3613=a0_0x5c5cc7;try{const _0x576b61=_0x1e1392[_0x4c3613(0x169)]['id'],_0x1b835a=await purchases_finished[_0x4c3613(0x1b6)]({'_id':_0x1e1392[_0x4c3613(0x169)]['id']}),_0x18c934=await warehouse[_0x4c3613(0x1b6)]({'name':_0x1b835a[_0x4c3613(0x12a)],'room':_0x1b835a[_0x4c3613(0x16a)]});_0x1b835a['product'][_0x4c3613(0xf9)](_0x21fa73=>{var _0x592ee6=_0x4c3613;const _0x316929=_0x18c934['product_details'][_0x592ee6(0x15f)](_0x38277a=>{var _0x4ae28e=_0x592ee6;_0x38277a[_0x4ae28e(0xe2)]==_0x21fa73['product_name']&&_0x38277a[_0x4ae28e(0x16b)]==_0x21fa73[_0x4ae28e(0x16b)]&&(_0x38277a[_0x4ae28e(0xf1)]=parseInt(_0x38277a[_0x4ae28e(0xf1)])-parseInt(_0x21fa73[_0x4ae28e(0x1bd)]));});}),await _0x18c934[_0x4c3613(0xec)]();const {invoice:_0x4487d8,suppliers:_0x54f5b4,date:_0x546432,warehouse_name:_0x35637a,prod_name:_0x11bef0,prod_code:_0x27a340,prod_qty:_0x28e7de,prod_unit:_0x1351c4,prod_secondunit:_0x1ca51e,prod_level:_0x5eb790,prod_isle:_0xc07c5f,prod_pallet:_0x31a107,note:_0x169988,expiry_date:_0x59732d,batch_code:_0xad0063,paid_amount:_0x374926,due_amount:_0x23bd6b,Room_name:_0x5317c3,primary_code:_0x27d76a,secondary_code:_0x919bb0,PO_number:_0x124ea3,JO_number:_0x53101e}=_0x1e1392[_0x4c3613(0x16f)];if(typeof _0x11bef0==_0x4c3613(0x11a))var _0x4108ae=[_0x1e1392[_0x4c3613(0x16f)]['prod_name']],_0x1761b6=[_0x1e1392[_0x4c3613(0x16f)]['prod_code']],_0x4a99cc=[_0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0xfb)]],_0xf0ba06=[_0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x1c8)]],_0x4703a9=[_0x1e1392['body'][_0x4c3613(0x13a)]],_0x591d24=[_0x1e1392['body'][_0x4c3613(0x12e)]],_0x54c1ac=[_0x1e1392[_0x4c3613(0x16f)]['primary_code']],_0x504d4f=[_0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x1ad)]],_0x4f59a5=[_0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x156)]],_0x50cc88=[_0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x154)]],_0x3fbd9b=[_0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x177)]];else var _0x4108ae=[..._0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0xf6)]],_0x1761b6=[..._0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x1b2)]],_0x4a99cc=[..._0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0xfb)]],_0xf0ba06=[..._0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x1c8)]],_0x4703a9=[..._0x1e1392['body'][_0x4c3613(0x13a)]],_0x591d24=[..._0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x12e)]],_0x54c1ac=[..._0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x18f)]],_0x504d4f=[..._0x1e1392['body']['secondary_code']],_0x4f59a5=[..._0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x156)]],_0x50cc88=[..._0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x154)]],_0x3fbd9b=[..._0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x177)]];const _0x2ea351=_0x4108ae[_0x4c3613(0x15f)](_0x2bb9f0=>{return _0x2bb9f0={'product_name':_0x2bb9f0};});_0x1761b6[_0x4c3613(0xf9)]((_0x456496,_0x4f808e)=>{_0x2ea351[_0x4f808e]['product_code']=_0x456496;}),_0x4a99cc[_0x4c3613(0xf9)]((_0x415bcd,_0x1027ac)=>{var _0x589cd2=_0x4c3613;_0x2ea351[_0x1027ac][_0x589cd2(0x1bd)]=_0x415bcd;}),_0xf0ba06[_0x4c3613(0xf9)]((_0x1b9f6e,_0x4d093d)=>{var _0x46062b=_0x4c3613;_0x2ea351[_0x4d093d][_0x46062b(0xe0)]=_0x1b9f6e;}),_0x4703a9['forEach']((_0x4c9cc9,_0x5a375b)=>{_0x2ea351[_0x5a375b]['secondary_unit']=_0x4c9cc9;}),_0x591d24[_0x4c3613(0xf9)]((_0x4a9afb,_0x1adb3b)=>{_0x2ea351[_0x1adb3b]['bay']=_0x4a9afb;}),_0x54c1ac[_0x4c3613(0xf9)]((_0x4dd5f3,_0x1f0ec8)=>{var _0x1e69d9=_0x4c3613;_0x2ea351[_0x1f0ec8][_0x1e69d9(0x18f)]=_0x4dd5f3;}),_0x504d4f[_0x4c3613(0xf9)]((_0x5648af,_0x478f26)=>{var _0x226d08=_0x4c3613;_0x2ea351[_0x478f26][_0x226d08(0x1ad)]=_0x5648af;}),_0x4f59a5['forEach']((_0x1af3ce,_0x39c7d9)=>{var _0x5634b3=_0x4c3613;_0x2ea351[_0x39c7d9][_0x5634b3(0x146)]=_0x1af3ce;}),_0x50cc88[_0x4c3613(0xf9)]((_0x518baf,_0x3d4ff0)=>{_0x2ea351[_0x3d4ff0]['batch_code']=_0x518baf;}),_0x3fbd9b[_0x4c3613(0xf9)]((_0x58e3a0,_0xac5742)=>{_0x2ea351[_0xac5742]['expiry_date']=_0x58e3a0;});const _0x2e0f5a=_0x2ea351['filter'](_0x305b86=>_0x305b86[_0x4c3613(0x1bd)]!=='0'&&_0x305b86[_0x4c3613(0x1bd)]!=='');_0x1b835a[_0x4c3613(0x163)]=_0x4487d8,_0x1b835a['suppliers']=_0x54f5b4,_0x1b835a['date']=_0x546432,_0x1b835a[_0x4c3613(0x12a)]=_0x35637a,_0x1b835a[_0x4c3613(0x1a1)]=_0x2e0f5a,_0x1b835a['note']=_0x169988,_0x1b835a[_0x4c3613(0x134)]=_0x374926,_0x1b835a[_0x4c3613(0x1b4)]=_0x23bd6b,_0x1b835a['room']=_0x5317c3,_0x1b835a[_0x4c3613(0x1a2)]=_0x124ea3,_0x1b835a[_0x4c3613(0x19a)]=_0x53101e;const _0x2c015e=await _0x1b835a[_0x4c3613(0xec)](),_0x4b7942=await warehouse['findOne']({'name':_0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x12a)],'room':_0x1e1392['body'][_0x4c3613(0x10e)]});_0x1b835a[_0x4c3613(0x1a1)][_0x4c3613(0xf9)](_0x45d6c3=>{var _0x1fbf2a=_0x4c3613,_0x24f8ab=0x0;const _0x529200=_0x4b7942[_0x1fbf2a(0x1a4)]['map'](_0x148457=>{var _0x1bacd1=_0x1fbf2a;_0x148457['product_name']==_0x45d6c3[_0x1bacd1(0xe2)]&&_0x148457[_0x1bacd1(0x16b)]==_0x45d6c3[_0x1bacd1(0x16b)]&&(_0x148457[_0x1bacd1(0xf1)]=parseInt(_0x148457[_0x1bacd1(0xf1)])+parseInt(_0x45d6c3[_0x1bacd1(0x1bd)]),_0x24f8ab++);});_0x24f8ab=='0'&&(_0x4b7942[_0x1fbf2a(0x1a4)]=_0x4b7942['product_details'][_0x1fbf2a(0x158)]({'product_name':_0x45d6c3[_0x1fbf2a(0xe2)],'product_stock':_0x45d6c3[_0x1fbf2a(0x1bd)],'primary_code':_0x45d6c3['primary_code'],'secondary_code':_0x45d6c3['secondary_code'],'product_code':_0x45d6c3[_0x1fbf2a(0x1c0)],'bay':_0x45d6c3['bay'],'maxProducts':_0x45d6c3[_0x1fbf2a(0x146)],'unit':_0x45d6c3['standard_unit'],'secondary_unit':_0x45d6c3['secondary_unit'],'expiry_date':_0x45d6c3[_0x1fbf2a(0x177)]}));}),await _0x4b7942['save']();const _0x4967d5=await s_payment_data['findOne']({'invoice':_0x1e1392['body']['invoice']});if(_0x4967d5===null){}else console[_0x4c3613(0x15b)]('suppliers',_0x4967d5,_0x1e1392[_0x4c3613(0x16f)]['invoice']),_0x4967d5[_0x4c3613(0x19d)]=_0x1e1392[_0x4c3613(0x16f)][_0x4c3613(0x19d)],await _0x4967d5[_0x4c3613(0xec)]();_0x1e1392[_0x4c3613(0x101)](_0x4c3613(0xe1),_0x4c3613(0x176)),_0xfb6ba9['redirect'](_0x4c3613(0x1b5));}catch(_0x4730bf){console['log'](_0x4730bf);}}),router[a0_0x5c5cc7(0x1c5)](a0_0x5c5cc7(0x149),auth,async(_0x1b2c9d,_0x2da11c)=>{var _0x1f861c=a0_0x5c5cc7;try{const _0xe6df04=_0x1b2c9d[_0x1f861c(0x169)]['id'],{invoice:_0x3b6dbc,suppliers:_0x5c8b66,payable:_0xe5fef1,due_amount:_0xe0bf6b}=_0x1b2c9d['body'],_0x5616ee=await purchases[_0x1f861c(0xe3)](_0xe6df04);var _0x2edadd=_0xe5fef1-_0xe0bf6b;_0x5616ee[_0x1f861c(0x134)]=parseFloat(_0x5616ee[_0x1f861c(0x134)])+parseFloat(_0xe0bf6b),_0x5616ee[_0x1f861c(0x1b4)]=_0x2edadd;const _0x1ba696=await _0x5616ee['save']();console[_0x1f861c(0x15b)](_0x1ba696);const _0x570119=await s_payment_data[_0x1f861c(0x1b6)]({'invoice':_0x3b6dbc});_0x570119[_0x1f861c(0x1bf)]=_0x2edadd,await _0x570119[_0x1f861c(0xec)]();let _0x525971=new Date(),_0x412b09=('0'+_0x525971[_0x1f861c(0xdd)]())[_0x1f861c(0x1cf)](-0x2),_0x270d61=('0'+(_0x525971[_0x1f861c(0x1d0)]()+0x1))[_0x1f861c(0x1cf)](-0x2),_0x5e0cdc=_0x525971[_0x1f861c(0x1ac)](),_0x5a87a1=_0x5e0cdc+'-'+_0x270d61+'-'+_0x412b09;const _0x405ee4=new suppliers_payment({'invoice':_0x3b6dbc,'date':_0x5e0cdc+'-'+_0x270d61+'-'+_0x412b09,'suppliers':_0x5c8b66,'reason':'Paid\x20For\x20Purchase','amount':_0xe0bf6b}),_0x5d458b=await _0x405ee4['save']();_0x1b2c9d[_0x1f861c(0x101)](_0x1f861c(0xe1),'payment\x20successfull'),_0x2da11c[_0x1f861c(0x17d)](_0x1f861c(0x1af));}catch(_0x4cd64a){console[_0x1f861c(0x15b)](_0x4cd64a);}}),router[a0_0x5c5cc7(0x1c9)](a0_0x5c5cc7(0x188),auth,async(_0x17789f,_0x560eff)=>{var _0x2c83dc=a0_0x5c5cc7;try{const {username:_0x5da196,email:_0x5051d9,role:_0x3f17f9}=_0x17789f['user'],_0x295309=_0x17789f[_0x2c83dc(0x16d)],_0x5d9873=await profile[_0x2c83dc(0x1b6)]({'email':_0x295309[_0x2c83dc(0x187)]}),_0x4d7696=await master_shop[_0x2c83dc(0x153)]();console[_0x2c83dc(0x15b)](_0x2c83dc(0x143),_0x4d7696);const _0x173b0a=_0x17789f[_0x2c83dc(0x169)]['id'],_0x34d7b4=await purchases[_0x2c83dc(0xe3)](_0x173b0a);console[_0x2c83dc(0x15b)](_0x34d7b4);const _0x4c61a5=await suppliers[_0x2c83dc(0x1b6)]({'name':_0x34d7b4[_0x2c83dc(0x19d)]});console[_0x2c83dc(0x15b)](_0x4c61a5);if(_0x4d7696[0x0][_0x2c83dc(0x126)]==_0x2c83dc(0x1a6)){var _0x30a00b=users[_0x2c83dc(0x175)];console['log'](_0x30a00b);}else{if(_0x4d7696[0x0][_0x2c83dc(0x126)]=='Hindi')var _0x30a00b=users['Hindi'];else{if(_0x4d7696[0x0][_0x2c83dc(0x126)]==_0x2c83dc(0x14b))var _0x30a00b=users[_0x2c83dc(0x14b)];else{if(_0x4d7696[0x0][_0x2c83dc(0x126)]==_0x2c83dc(0x112))var _0x30a00b=users['Spanish'];else{if(_0x4d7696[0x0][_0x2c83dc(0x126)]==_0x2c83dc(0xf7))var _0x30a00b=users['French'];else{if(_0x4d7696[0x0][_0x2c83dc(0x126)]==_0x2c83dc(0xf3))var _0x30a00b=users['Portuguese'];else{if(_0x4d7696[0x0]['language']=='Chinese')var _0x30a00b=users[_0x2c83dc(0x185)];else{if(_0x4d7696[0x0][_0x2c83dc(0x126)]=='Arabic\x20(ae)')var _0x30a00b=users[_0x2c83dc(0x13f)];}}}}}}}_0x560eff[_0x2c83dc(0x1cd)](_0x2c83dc(0xdc),{'success':_0x17789f[_0x2c83dc(0x101)]('success'),'errors':_0x17789f['flash'](_0x2c83dc(0x13e)),'role':_0x295309,'profile':_0x5d9873,'master_shop':_0x4d7696,'supplier':_0x4c61a5,'purchase':_0x34d7b4,'language':_0x30a00b});}catch(_0x2261b0){console[_0x2c83dc(0x15b)](_0x2261b0);}}),router[a0_0x5c5cc7(0x1c9)](a0_0x5c5cc7(0x18b),auth,async(_0x5c2223,_0x28a40e)=>{var _0xaf41d9=a0_0x5c5cc7;try{const {username:_0x29a2d1,email:_0x57aaae,role:_0x456480}=_0x5c2223[_0xaf41d9(0x16d)],_0x10efca=_0x5c2223[_0xaf41d9(0x16d)],_0x588e9e=await profile['findOne']({'email':_0x10efca[_0xaf41d9(0x187)]}),_0x547759=await master_shop[_0xaf41d9(0x153)]();console[_0xaf41d9(0x15b)](_0xaf41d9(0x143),_0x547759);const _0x4e18c2=_0x5c2223['params']['id'];console[_0xaf41d9(0x15b)](_0x4e18c2);const _0x45a9be=await purchases_finished[_0xaf41d9(0xe3)](_0x4e18c2);console['log']('user_id',_0x45a9be);const _0x2bb832=await product['find']({}),_0x435b32=await warehouse['aggregate']([{'$match':{'name':_0x45a9be[_0xaf41d9(0x12a)],'room':_0x45a9be[_0xaf41d9(0x16a)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0xaf41d9(0x181),'name':{'$first':_0xaf41d9(0x189)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xaf41d9(0x155)},'bin':{'$first':_0xaf41d9(0x194)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xaf41d9(0x117)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xaf41d9(0x11c)},'storage':{'$first':_0xaf41d9(0x196)},'rack':{'$first':_0xaf41d9(0x1b1)}}}]);console[_0xaf41d9(0x15b)]('stock_data',_0x435b32);let _0x3cde27;if(_0x10efca[_0xaf41d9(0x1be)]==_0xaf41d9(0x162)){const _0x27e879=await staff[_0xaf41d9(0x1b6)]({'email':_0x10efca[_0xaf41d9(0x187)]});_0x3cde27=await warehouse[_0xaf41d9(0x153)]({'status':_0xaf41d9(0xf4),'name':_0x27e879[_0xaf41d9(0xfc)],'warehouse_category':_0xaf41d9(0x15c),'name':_0xaf41d9(0x15a)});}else _0x3cde27=await warehouse[_0xaf41d9(0x13d)]([{'$match':{'status':_0xaf41d9(0xf4),'warehouse_category':_0xaf41d9(0x15c),'name':_0xaf41d9(0x15a)}},{'$group':{'_id':_0xaf41d9(0xfe),'name':{'$first':'$name'}}}]);if(_0x547759[0x0][_0xaf41d9(0x126)]==_0xaf41d9(0x1a6)){var _0x550be5=users[_0xaf41d9(0x175)];console[_0xaf41d9(0x15b)](_0x550be5);}else{if(_0x547759[0x0]['language']==_0xaf41d9(0x141))var _0x550be5=users[_0xaf41d9(0x141)];else{if(_0x547759[0x0][_0xaf41d9(0x126)]=='German')var _0x550be5=users['German'];else{if(_0x547759[0x0][_0xaf41d9(0x126)]==_0xaf41d9(0x112))var _0x550be5=users[_0xaf41d9(0x112)];else{if(_0x547759[0x0][_0xaf41d9(0x126)]=='French')var _0x550be5=users['French'];else{if(_0x547759[0x0][_0xaf41d9(0x126)]==_0xaf41d9(0xf3))var _0x550be5=users[_0xaf41d9(0x173)];else{if(_0x547759[0x0][_0xaf41d9(0x126)]==_0xaf41d9(0x185))var _0x550be5=users[_0xaf41d9(0x185)];else{if(_0x547759[0x0][_0xaf41d9(0x126)]==_0xaf41d9(0xf8))var _0x550be5=users['Arabic'];}}}}}}}_0x28a40e[_0xaf41d9(0x1cd)](_0xaf41d9(0x1b9),{'success':_0x5c2223[_0xaf41d9(0x101)](_0xaf41d9(0xe1)),'errors':_0x5c2223[_0xaf41d9(0x101)](_0xaf41d9(0x13e)),'role':_0x10efca,'profile':_0x588e9e,'user':_0x45a9be,'stock':_0x435b32,'master_shop':_0x547759,'product':_0x2bb832,'language':_0x550be5,'warehouse':_0x3cde27});}catch(_0x549605){console['log'](_0x549605);}}),router[a0_0x5c5cc7(0x1c5)](a0_0x5c5cc7(0x18b),auth,async(_0x3648fc,_0x124603)=>{var _0x7287eb=a0_0x5c5cc7;try{const {invoice:_0x7ef19a,date:_0x5c9e03,warehouse_name:_0x3c61b0,Room_name:_0x114184,product_name:_0x2f3206,purchase_quantity:_0x4cc0da,stocks:_0x1b3ee1,return_qty:_0x190c41,note:_0x45dc86,level:_0x1d9f56,isle:_0x5528a6,pallet:_0x57789f,to_warehouse_name:_0x134503,to_Room_name:_0xdc571d}=_0x3648fc[_0x7287eb(0x16f)],_0x19d396=await purchases_finished['findOne']({'_id':_0x3648fc[_0x7287eb(0x169)]['id']}),_0x521d36=await warehouse[_0x7287eb(0x1b6)]({'name':_0x3c61b0,'room':_0x114184,'warehouse_category':_0x7287eb(0x15c)});if(typeof _0x2f3206==_0x7287eb(0x11a))var _0x1c24a1=[_0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0xe2)]],_0x501b73=[_0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x19e)]],_0x48e757=[_0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x116)]],_0x2664ee=[_0x3648fc[_0x7287eb(0x16f)]['return_qty']],_0x56e944=[_0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x18e)]],_0x258742=[_0x3648fc['body']['product_code_hide']],_0x127969=[_0x3648fc['body'][_0x7287eb(0x18c)]],_0x70ebf2=[_0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x124)]];else var _0x1c24a1=[..._0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0xe2)]],_0x501b73=[..._0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x19e)]],_0x48e757=[..._0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x116)]],_0x2664ee=[..._0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x1ce)]],_0x56e944=[..._0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x18e)]],_0x258742=[..._0x3648fc[_0x7287eb(0x16f)]['product_code_hide']],_0x127969=[..._0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x18c)]],_0x70ebf2=[..._0x3648fc[_0x7287eb(0x16f)]['secondary_code_hide']];const _0x5a10b0=_0x1c24a1[_0x7287eb(0x15f)](_0x4d6624=>{return _0x4d6624={'product_name':_0x4d6624};});_0x501b73[_0x7287eb(0xf9)]((_0x8be6c4,_0x100637)=>{var _0x7a5162=_0x7287eb;_0x5a10b0[_0x100637][_0x7a5162(0x19e)]=_0x8be6c4;}),_0x48e757['forEach']((_0x2b16de,_0x20764f)=>{var _0x29f179=_0x7287eb;_0x5a10b0[_0x20764f][_0x29f179(0x172)]=_0x2b16de;}),_0x2664ee[_0x7287eb(0xf9)]((_0xb074fd,_0x264fc1)=>{var _0x4df620=_0x7287eb;_0x5a10b0[_0x264fc1][_0x4df620(0x1ce)]=_0xb074fd;}),_0x56e944[_0x7287eb(0xf9)]((_0x3bb406,_0x409c92)=>{var _0x322f0f=_0x7287eb;_0x5a10b0[_0x409c92][_0x322f0f(0x16b)]=_0x3bb406;}),_0x258742['forEach']((_0x347550,_0x442a66)=>{var _0xe52a99=_0x7287eb;_0x5a10b0[_0x442a66][_0xe52a99(0x1c0)]=_0x347550;}),_0x127969[_0x7287eb(0xf9)]((_0xcc506f,_0x2923bf)=>{var _0x171745=_0x7287eb;_0x5a10b0[_0x2923bf][_0x171745(0x18f)]=_0xcc506f;}),_0x70ebf2[_0x7287eb(0xf9)]((_0x194409,_0x4d385f)=>{var _0x15c700=_0x7287eb;_0x5a10b0[_0x4d385f][_0x15c700(0x1ad)]=_0x194409;}),_0x5a10b0['forEach'](_0x58cb28=>{var _0x2e9455=_0x7287eb;console[_0x2e9455(0x15b)](_0x58cb28);const _0x37a1b7=_0x521d36['product_details'][_0x2e9455(0x15f)](_0x2314b9=>{var _0x2d2a5a=_0x2e9455;_0x2314b9[_0x2d2a5a(0xe2)]==_0x58cb28['product_name']&&_0x2314b9[_0x2d2a5a(0x16b)]==_0x58cb28[_0x2d2a5a(0x16b)]&&(console['log'](parseInt(_0x2314b9[_0x2d2a5a(0xf1)])+'\x20<>\x20'+parseInt(_0x58cb28['return_qty'])),_0x2314b9[_0x2d2a5a(0xf1)]=parseInt(_0x2314b9[_0x2d2a5a(0xf1)])-parseInt(_0x58cb28[_0x2d2a5a(0x1ce)]));});}),await _0x521d36[_0x7287eb(0xec)]();var _0x3b9c28=0x0;_0x5a10b0[_0x7287eb(0xf9)](_0x87f41e=>{var _0x3036aa=_0x7287eb;(parseInt(_0x87f41e[_0x3036aa(0x19e)])<parseInt(_0x87f41e[_0x3036aa(0x1ce)])||parseInt(_0x87f41e[_0x3036aa(0x172)])<parseInt(_0x87f41e[_0x3036aa(0x1ce)]))&&_0x3b9c28++;});if(_0x3b9c28!=0x0)return _0x3648fc[_0x7287eb(0x101)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x124603['redirect'](_0x7287eb(0x191));const _0x15b37e=new purchases_return_finished({'invoice':_0x7ef19a,'suppliers':_0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x19d)],'date':_0x5c9e03,'warehouse_name':_0x3c61b0,'return_product':_0x5a10b0,'note':_0x45dc86,'room':_0x114184,'to_warehouse_name':_0x134503,'to_room':_0xdc571d}),_0x2f1075=await _0x15b37e[_0x7287eb(0xec)](),_0x30b289=await purchases_return_finished[_0x7287eb(0x1b6)]({'invoice':_0x7ef19a}),_0x5cb207=await warehouse[_0x7287eb(0x1b6)]({'name':_0x134503,'room':_0xdc571d,'warehouse_category':_0x7287eb(0x15c)});_0x30b289[_0x7287eb(0x195)][_0x7287eb(0xf9)](_0x52fb38=>{var _0x352967=_0x7287eb,_0x334d9e=0x0;const _0x1ddfe4=_0x5cb207[_0x352967(0x1a4)][_0x352967(0x15f)](_0x1efcb1=>{var _0x3593ab=_0x352967;console[_0x3593ab(0x15b)](_0x1efcb1[_0x3593ab(0xe2)]+'=='+_0x52fb38[_0x3593ab(0xe2)]+'&&'+_0x1efcb1[_0x3593ab(0x16b)]+'=='+_0x52fb38[_0x3593ab(0x16b)]),_0x1efcb1[_0x3593ab(0xe2)]==_0x52fb38[_0x3593ab(0xe2)]&&_0x1efcb1[_0x3593ab(0x16b)]==_0x52fb38[_0x3593ab(0x16b)]&&(_0x1efcb1['product_stock']=parseInt(_0x1efcb1[_0x3593ab(0xf1)])-parseInt(_0x52fb38['return_qty']),_0x334d9e++);});_0x334d9e=='0'&&(_0x5cb207['product_details']=_0x5cb207[_0x352967(0x1a4)]['concat']({'product_name':_0x52fb38[_0x352967(0xe2)],'product_stock':_0x52fb38[_0x352967(0x1ce)],'primary_code':_0x52fb38[_0x352967(0x18f)],'secondary_code':_0x52fb38[_0x352967(0x1ad)],'product_code':_0x52fb38['product_code'],'bay':_0x52fb38['bay'],'maxProducts':0xf423f}));}),await _0x5cb207[_0x7287eb(0xec)]();const _0x3885e3=await purchases_finished[_0x7287eb(0x1b6)]({'invoice':_0x7ef19a});_0x3885e3[_0x7287eb(0x12c)]=_0x7287eb(0x147);const _0x21c87f=await _0x3885e3['save'](),_0xc776fc=new s_payment_data({'invoice':_0x7ef19a,'suppliers':_0x3648fc['body'][_0x7287eb(0x19d)],'reason':'Purchase\x20Return'});await _0xc776fc['save']();const _0x3eb449=await master_shop[_0x7287eb(0x153)](),_0x4cab96=await email_settings[_0x7287eb(0x1b6)](),_0x1532ad=await suppliers['findOne']({'name':_0x3648fc[_0x7287eb(0x16f)][_0x7287eb(0x19d)]});_0x3eb449[0x0][_0x7287eb(0x17c)]==0x1?(right_currency=_0x3eb449[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x3eb449[0x0][_0x7287eb(0x128)]);var _0x40870e=_0x1c24a1,_0x105782=_0x2664ee,_0x5b6836='',_0x1e90fd;for(_0x1e90fd in _0x40870e){_0x5b6836+='<tr>'+_0x7287eb(0x152)+_0x40870e[_0x1e90fd]+_0x7287eb(0xed)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x105782[_0x1e90fd]+_0x7287eb(0xed)+_0x7287eb(0x1a0);}let _0x11b49b=nodemailer[_0x7287eb(0x1c6)]({'service':_0x7287eb(0x1c3),'auth':{'user':_0x4cab96[_0x7287eb(0x187)],'pass':_0x4cab96[_0x7287eb(0x127)]}}),_0x3b52e3={'from':_0x4cab96[_0x7287eb(0x187)],'to':_0x1532ad[_0x7287eb(0x187)],'subject':_0x7287eb(0x13b),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x3eb449[0x0]['image'],'cid':_0x7287eb(0x190)}],'html':'<!DOCTYPE\x20html>'+_0x7287eb(0x1a8)+_0x7287eb(0x168)+_0x7287eb(0x144)+_0x7287eb(0xe7)+_0x7287eb(0x144)+_0x7287eb(0x186)+_0x7287eb(0x14f)+_0x7287eb(0x144)+'<h2>\x20'+_0x3eb449[0x0][_0x7287eb(0xf0)]+_0x7287eb(0x148)+_0x7287eb(0x14f)+_0x7287eb(0x14f)+_0x7287eb(0x110)+_0x7287eb(0x144)+_0x7287eb(0x129)+_0x7287eb(0x104)+_0x7ef19a+'\x20'+_0x7287eb(0x157)+'\x20Order\x20Date\x20:\x20'+_0x5c9e03+'\x20'+_0x7287eb(0x170)+_0x7287eb(0x145)+_0x7287eb(0x14f)+_0x7287eb(0x17e)+_0x7287eb(0x108)+'<tr>'+_0x7287eb(0xfa)+_0x7287eb(0x103)+_0x7287eb(0xe5)+_0x7287eb(0x12b)+_0x7287eb(0x1a0)+_0x7287eb(0x17b)+_0x7287eb(0x11f)+'\x20'+_0x5b6836+'\x20'+_0x7287eb(0x184)+'</table>'+'<div>'+_0x7287eb(0x1cb)+_0x7287eb(0x193)+_0x3eb449[0x0][_0x7287eb(0xf0)]+_0x7287eb(0x145)+'</div>'+_0x7287eb(0x14f)+_0x7287eb(0x107)};_0x11b49b['sendMail'](_0x3b52e3,function(_0x5bb288,_0x24a072){var _0x8a4aea=_0x7287eb;_0x5bb288?console['log'](_0x8a4aea(0x18a)):console[_0x8a4aea(0x15b)](_0x8a4aea(0x197));}),_0x3648fc[_0x7287eb(0x101)](_0x7287eb(0xe1),'purchases\x20item\x20return\x20successfull'),_0x124603['redirect'](_0x7287eb(0x1b5));}catch(_0x27f4c7){_0x124603['status'](0xc8)[_0x7287eb(0x182)]({'message':_0x27f4c7[_0x7287eb(0x10c)]});}}),router['get'](a0_0x5c5cc7(0x198),auth,async(_0x214de3,_0x188f16)=>{var _0x358345=a0_0x5c5cc7;try{const {username:_0x2de801,email:_0x9c665e,role:_0x5e5f5f}=_0x214de3[_0x358345(0x16d)],_0x156643=_0x214de3[_0x358345(0x16d)],_0x7298ee=await profile[_0x358345(0x1b6)]({'email':_0x156643['email']}),_0x369f62=await master_shop[_0x358345(0x153)](),_0x2cf3a6=_0x214de3[_0x358345(0x169)]['id'],_0x40fa9e=await purchases_finished[_0x358345(0xe3)](_0x2cf3a6);if(_0x369f62[0x0][_0x358345(0x126)]==_0x358345(0x1a6))var _0x1f8307=users['English'];else{if(_0x369f62[0x0][_0x358345(0x126)]==_0x358345(0x141))var _0x1f8307=users[_0x358345(0x141)];else{if(_0x369f62[0x0][_0x358345(0x126)]==_0x358345(0x14b))var _0x1f8307=users['German'];else{if(_0x369f62[0x0][_0x358345(0x126)]=='Spanish')var _0x1f8307=users[_0x358345(0x112)];else{if(_0x369f62[0x0][_0x358345(0x126)]==_0x358345(0xf7))var _0x1f8307=users[_0x358345(0xf7)];else{if(_0x369f62[0x0][_0x358345(0x126)]==_0x358345(0xf3))var _0x1f8307=users[_0x358345(0x173)];else{if(_0x369f62[0x0][_0x358345(0x126)]=='Chinese')var _0x1f8307=users['Chinese'];else{if(_0x369f62[0x0][_0x358345(0x126)]==_0x358345(0xf8))var _0x1f8307=users['Arabic'];}}}}}}}_0x188f16[_0x358345(0x1cd)]('all_purchases_barcode',{'success':_0x214de3['flash']('success'),'errors':_0x214de3[_0x358345(0x101)](_0x358345(0x13e)),'role':_0x156643,'profile':_0x7298ee,'alldata':_0x40fa9e,'master_shop':_0x369f62,'language':_0x1f8307}),console[_0x358345(0x15b)](alldata);}catch(_0x5b3394){console[_0x358345(0x15b)](_0x5b3394);}}),router[a0_0x5c5cc7(0x1c5)](a0_0x5c5cc7(0x102),async(_0xa6c853,_0x3213ec)=>{var _0x3d8fab=a0_0x5c5cc7;const {product_code:_0x6ce6ab}=_0xa6c853[_0x3d8fab(0x16f)];var _0x3f452e;const _0x1e7134=await product[_0x3d8fab(0x13d)]([{'$match':{'primary_code':_0x6ce6ab,'product_category':_0x3d8fab(0x15c)}},{'$group':{'_id':_0x3d8fab(0xef),'name':{'$first':_0x3d8fab(0xfe)},'category':{'$first':_0x3d8fab(0x1c2)},'brand':{'$first':'$brand'},'unit':{'$first':_0x3d8fab(0x1c1)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3d8fab(0x165)},'primary_code':{'$first':_0x3d8fab(0xf2)},'secondary_code':{'$first':_0x3d8fab(0x1b7)},'maxStocks':{'$first':_0x3d8fab(0x1d4)},'maxProdPerUnit':{'$first':_0x3d8fab(0x115)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3d8fab(0x14e)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x505d04=await product[_0x3d8fab(0x13d)]([{'$match':{'secondary_code':_0x6ce6ab}},{'$group':{'_id':_0x3d8fab(0xef),'name':{'$first':_0x3d8fab(0xfe)},'category':{'$first':_0x3d8fab(0x1c2)},'brand':{'$first':'$brand'},'unit':{'$first':_0x3d8fab(0x1c1)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3d8fab(0x165)},'primary_code':{'$first':_0x3d8fab(0xf2)},'secondary_code':{'$first':_0x3d8fab(0x1b7)},'maxStocks':{'$first':_0x3d8fab(0x1d4)},'maxProdPerUnit':{'$first':_0x3d8fab(0x115)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3d8fab(0x14e)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1e7134[_0x3d8fab(0x1d5)]>0x0)_0x3f452e=_0x1e7134;else _0x505d04['length']>0x0&&(_0x3f452e=_0x505d04);_0x3213ec[_0x3d8fab(0x182)](_0x3f452e);}),router[a0_0x5c5cc7(0x1c5)](a0_0x5c5cc7(0x131),async(_0x31951b,_0x31b9d8)=>{var _0x21c962=a0_0x5c5cc7;const {productCode:_0x3b70a1,bay:_0x8c8824,warehouses:_0x44083a,room:_0x231395}=_0x31951b[_0x21c962(0x16f)];console[_0x21c962(0x15b)](_0x31951b[_0x21c962(0x16f)]);try{const _0xa68e5=await warehouse[_0x21c962(0x13d)]([{'$match':{'name':_0x44083a,'room':_0x231395}},{'$unwind':_0x21c962(0x10f)},{'$match':{'product_details.bay':parseInt(_0x8c8824)}},{'$group':{'_id':_0x21c962(0x181),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x21c962(0x179)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x21c962(0x132)}}}]);_0x31b9d8[_0x21c962(0x178)](0xc8)[_0x21c962(0x182)](_0xa68e5);}catch(_0x509ea3){_0x31b9d8['status'](0x194)['json']({'message':_0x509ea3[_0x21c962(0x10c)]});}}),module['exports']=router;