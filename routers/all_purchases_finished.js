function a0_0x57be(){var _0x4b4266=['purchases\x20item\x20return\x20successfull','email','<div>','$return_data','exports','paid_amount','1754728ZYTKDI','JO_number','797510adUvbN','$suppliers_docs','prod_primunit','product_cat','toString','redirect','forEach','secondary_code','currency','<tr>','\x20Order\x20Date\x20:\x20','edit_purchases_finished','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product','stock_quantity','$product_details','prod_secondunit','<html><head><title></title>','3FKiWkk','<hr\x20class=\x22my-3\x22>','$product_code','$invoice','primary_code','../middleware/auth','$product','/view/:id','success','warehouse','<span\x20style=\x22float:\x20right;\x22>','user','An\x20error\x20occurred\x20while\x20saving\x20data.','/view/add_purchases/:id','string','get','error','standard_unit','/view/return_purchase/:id','prod_level','product_code_hide','all','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<!DOCTYPE\x20html>','catch','../public/language/languages.json','Enclosed','findById','</h5>','4887KxlhVI','$product.floorlevel','$note','batch_code','$paid_amount','$date','return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Error\x20occurred\x20while\x20processing\x20product:','$product_details.rack','express','/all_purchases_finished/view','due_amount','../models/all_models','$brand','</tr>','331593kRnczo','getDate','$product.bay','product_details','There\x27s\x20a\x20error\x20in\x20this\x20transaction','language','63bPayjp','abs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Spanish','filter','warehouse_name','$_id','\x20<>\x20','</tbody>','staff','/invoice/:id','$unit','prod_Qty','FGSEmail','image','True','expiry_date','</thead>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','concat','map','prod_name','German','secondary_unit','room_name','production_date','flash','$alertquantity','stocks','role','suppliers','prod_qty','length','$product.bin','quantity','prod_unit','$product_details.storage','French','$product_details.bay','$expiry_date','$secondary_code','find','ejs','$warehouse_name','post','$primary_code','/view/add_purchases','/../public','sendMail','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','POnumber','$suppliers','suppliers_docs','Enabled','452972MQaiis','date','prod_cat','_id','purchase\x20data\x20update\x20successfully','getMonth','</div>','/view','</body></html>','primary_code_hide','stock_data','\x20</h2>','/upload/','Purchase\x20Return','maxperunit','add_purchases_finished','site_title','product_date','body','$secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Return\x20Goods','status','return_product','Logo.png','Purchase\x20Return\x20Mail','</head><body>','amount','padStart','return_qty','random','$product.room_name','$product_details.type','max_product_unit','</table>','/barcode/:id','product_name','\x20Order\x20Number\x20:\x20','log','/give_payment/:id','logo','maxStocks','Finished\x20Goods','then','edit_purchases_finished_view','$product.quantity','return_purchase_finished','purchase\x20data\x20add\x20successfully','product_stock','<h5>','Chinese','payment\x20successfull','json','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','aggregate','product_code','$product_details.secondary_code','back','$product_details._id','save','level','createTransport','520384whJdAI','port','room','Paid\x20For\x20Purchase','DRY\x20GOODS','password','Ambient','$product_details.product_stock','<strong>\x20Regards\x20</strong>','note','10210LsOreC','/CheckingWarehouse','Arabic\x20(ae)','/preview/:id','INCF-','prod_invoice','$product.type','Portuguese','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','findOne','FROZEN\x20GOODS','MaxStocks_data','$product_details.product_name','</span>','params','$name','English\x20(US)','$due_amount','English','all_purchases_barcode','message','Email\x20sent\x20successfully','Router','add_purchases\x20error','$product_details.maxProducts','Hindi','781098KxPhuk','Rack\x201','$batch_code','master','<h2>\x20','$maxStocks','</td>','/all_purchases/view','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','errors','all_purchases_finished','<h5\x20style=\x22text-align:\x20left;\x22>','slice','$maxProdPerUnit','floor','<tbody\x20style=\x22text-align:\x20center;\x22>','user_id','Error\x20Occurs','bay','purchase_quantity','render','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'];a0_0x57be=function(){return _0x4b4266;};return a0_0x57be();}var a0_0x2e1a48=a0_0x4b02;(function(_0x25fba8,_0x4e012d){var _0x5ec22b=a0_0x4b02,_0x4611d7=_0x25fba8();while(!![]){try{var _0x431e9f=-parseInt(_0x5ec22b(0x147))/0x1+-parseInt(_0x5ec22b(0x184))/0x2*(-parseInt(_0x5ec22b(0x119))/0x3)+-parseInt(_0x5ec22b(0x105))/0x4+-parseInt(_0x5ec22b(0x107))/0x5+-parseInt(_0x5ec22b(0xe8))/0x6+-parseInt(_0x5ec22b(0x14d))/0x7*(-parseInt(_0x5ec22b(0x1c3))/0x8)+parseInt(_0x5ec22b(0x137))/0x9*(parseInt(_0x5ec22b(0x1cd))/0xa);if(_0x431e9f===_0x4e012d)break;else _0x4611d7['push'](_0x4611d7['shift']());}catch(_0x533ea0){_0x4611d7['push'](_0x4611d7['shift']());}}}(a0_0x57be,0x4acb9));function a0_0x4b02(_0x293141,_0xada7c6){var _0x57be53=a0_0x57be();return a0_0x4b02=function(_0x4b0246,_0x5c455e){_0x4b0246=_0x4b0246-0xd9;var _0x6a407e=_0x57be53[_0x4b0246];return _0x6a407e;},a0_0x4b02(_0x293141,_0xada7c6);}const express=require(a0_0x2e1a48(0x141)),app=express(),router=express[a0_0x2e1a48(0xe4)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x2e1a48(0x144)),auth=require(a0_0x2e1a48(0x11e)),nodemailer=require('nodemailer');var ejs=require(a0_0x2e1a48(0x177));const path=require('path'),users=require(a0_0x2e1a48(0x133));router['get'](a0_0x2e1a48(0x18b),auth,async(_0x4da0a8,_0x53921c)=>{var _0x5b617e=a0_0x2e1a48;try{const {username:_0x5b9f68,email:_0x109796,role:_0x1b5fde}=_0x4da0a8[_0x5b617e(0x124)],_0x436861=_0x4da0a8[_0x5b617e(0x124)],_0x10ba32=await profile[_0x5b617e(0x1d7)]({'email':_0x436861[_0x5b617e(0x100)]}),_0x3507b2=await staff[_0x5b617e(0x1d7)]({'email':_0x436861['email']});if(_0x436861['role']==_0x5b617e(0x156)){const _0x47d43f=await staff[_0x5b617e(0x1d7)]({'email':_0x436861[_0x5b617e(0x100)]});}const _0x1dc869=await master_shop[_0x5b617e(0x176)]();let _0x44ec6a;if(_0x436861[_0x5b617e(0x16a)]==_0x5b617e(0x156)){const _0x509bdf=await staff[_0x5b617e(0x1d7)]({'email':_0x436861[_0x5b617e(0x100)]});_0x44ec6a=await purchases_finished[_0x5b617e(0x1bb)]([{'$match':{'warehouse_name':_0x509bdf[_0x5b617e(0x122)]}},{'$lookup':{'from':_0x5b617e(0x16b),'localField':_0x5b617e(0x16b),'foreignField':'name','as':_0x5b617e(0x182)}},{'$unwind':_0x5b617e(0x108)},{'$unwind':_0x5b617e(0x11f)},{'$group':{'_id':_0x5b617e(0x153),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x5b617e(0x181)},'date':{'$first':_0x5b617e(0x13c)},'warehouse_name':{'$first':_0x5b617e(0x178)},'room':{'$first':'$room'},'product':{'$push':_0x5b617e(0x11f)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x5b617e(0x13b)},'due_amount':{'$first':_0x5b617e(0xdf)},'return_data':{'$first':_0x5b617e(0x102)},'batch_code':{'$first':_0x5b617e(0xea)},'expiry_date':{'$first':_0x5b617e(0x174)},'suppliers_docs':{'$first':_0x5b617e(0x108)},'total_product_quantity':{'$sum':_0x5b617e(0x1b1)},'level':{'$addToSet':_0x5b617e(0x149)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x44ec6a=await purchases_finished[_0x5b617e(0x1bb)]([{'$unwind':'$product'},{'$group':{'_id':_0x5b617e(0x153),'invoice':{'$first':_0x5b617e(0x11c)},'suppliers':{'$first':_0x5b617e(0x181)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x5b617e(0x1a3)},'product':{'$push':_0x5b617e(0x11f)},'note':{'$first':_0x5b617e(0x139)},'paid_amount':{'$first':_0x5b617e(0x13b)},'due_amount':{'$first':_0x5b617e(0xdf)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x5b617e(0x174)},'suppliers_docs':{'$first':_0x5b617e(0x108)},'total_product_quantity':{'$sum':_0x5b617e(0x1b1)},'level':{'$addToSet':_0x5b617e(0x149)},'isle':{'$addToSet':_0x5b617e(0x16e)},'type':{'$addToSet':_0x5b617e(0x1d3)},'floorlevel':{'$addToSet':_0x5b617e(0x138)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x1dc869[0x0][_0x5b617e(0x14c)]==_0x5b617e(0xde))var _0x2085b9=users[_0x5b617e(0xe0)];else{if(_0x1dc869[0x0]['language']=='Hindi')var _0x2085b9=users[_0x5b617e(0xe7)];else{if(_0x1dc869[0x0][_0x5b617e(0x14c)]==_0x5b617e(0x163))var _0x2085b9=users[_0x5b617e(0x163)];else{if(_0x1dc869[0x0][_0x5b617e(0x14c)]==_0x5b617e(0x150))var _0x2085b9=users['Spanish'];else{if(_0x1dc869[0x0][_0x5b617e(0x14c)]=='French')var _0x2085b9=users[_0x5b617e(0x172)];else{if(_0x1dc869[0x0][_0x5b617e(0x14c)]==_0x5b617e(0xf0))var _0x2085b9=users[_0x5b617e(0x1d4)];else{if(_0x1dc869[0x0][_0x5b617e(0x14c)]==_0x5b617e(0x1b6))var _0x2085b9=users[_0x5b617e(0x1b6)];else{if(_0x1dc869[0x0][_0x5b617e(0x14c)]==_0x5b617e(0x1cf))var _0x2085b9=users[_0x5b617e(0x1d5)];}}}}}}}_0x53921c[_0x5b617e(0xfd)](_0x5b617e(0xf3),{'success':_0x4da0a8[_0x5b617e(0x167)](_0x5b617e(0x121)),'errors':_0x4da0a8[_0x5b617e(0x167)](_0x5b617e(0xf2)),'purchases':_0x44ec6a,'role':_0x436861,'profile':_0x10ba32,'master_shop':_0x1dc869,'language':_0x2085b9});}catch(_0x36791b){console[_0x5b617e(0x1aa)]('table\x20page',_0x36791b),_0x53921c[_0x5b617e(0x19a)](0xc8)['json']({'message':_0x36791b[_0x5b617e(0xe2)]});}});function BayBinSelected(_0x34b291,_0x27f7ba){var _0x2fdb9c=a0_0x2e1a48,_0x53eb9f=[],_0x182d66=[];if(_0x34b291==_0x2fdb9c(0x1c7)){switch(_0x27f7ba){case'Rack\x201':_0x53eb9f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x53eb9f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x182d66=['DG'];}else{if(_0x34b291==_0x2fdb9c(0x1d8)){switch(_0x27f7ba){case _0x2fdb9c(0xe9):_0x53eb9f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x53eb9f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x182d66=['FG'];}}return{'levels':_0x53eb9f,'identify':_0x182d66};}async function getRandom8DigitNumber(){var _0x5e5c57=a0_0x2e1a48;const _0x57d58b=0x989680,_0x118111=0x5f5e0ff,_0x5d2295=Math[_0x5e5c57(0xf7)](Math[_0x5e5c57(0x1a2)]()*(_0x118111-_0x57d58b+0x1))+_0x57d58b;var _0x27e047;const _0x30344f=await purchases_finished[_0x5e5c57(0x1d7)]({'invoice':'INCF-'+_0x5d2295});return _0x30344f&&_0x30344f[_0x5e5c57(0x16d)]>0x0?_0x27e047='INCF-'+_0x5d2295:_0x27e047=_0x5e5c57(0x1d1)+_0x5d2295,_0x27e047;}router[a0_0x2e1a48(0x128)](a0_0x2e1a48(0x17b),auth,async(_0x5800cc,_0x10b363)=>{var _0xc2ac0e=a0_0x2e1a48;try{const {username:_0xac0ee4,email:_0x49de5b,role:_0x11ca52}=_0x5800cc['user'],_0x565846=_0x5800cc[_0xc2ac0e(0x124)],_0xfb5c33=await profile['findOne']({'email':_0x565846[_0xc2ac0e(0x100)]}),_0x3420cd=await master_shop[_0xc2ac0e(0x176)](),_0x1d2164=await staff['findOne']({'email':_0x565846[_0xc2ac0e(0x100)]}),_0x27b825=await suppliers[_0xc2ac0e(0x176)]({});let _0x277141;if(_0x565846['role']==_0xc2ac0e(0x156)){const _0x44d7f9=await staff[_0xc2ac0e(0x1d7)]({'email':_0x565846[_0xc2ac0e(0x100)]});_0x277141=await warehouse[_0xc2ac0e(0x1bb)]([{'$match':{'status':'Enabled','name':_0x44d7f9[_0xc2ac0e(0x122)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0xc2ac0e(0xdd),'name':{'$first':'$name'}}}]);}else _0x277141=await warehouse[_0xc2ac0e(0x1bb)]([{'$match':{'status':_0xc2ac0e(0x183),'warehouse_category':_0xc2ac0e(0x1ae),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0xc2ac0e(0xdd),'name':{'$first':_0xc2ac0e(0xdd)}}}]);const _0x42153d=await product['find']({}),_0x487772=await warehouse['find']({'status':_0xc2ac0e(0x183)}),_0x29de12=await purchases_finished['find']({}),_0x197dc8=_0x29de12['length']+0x1,_0x495cca=_0xc2ac0e(0x1d1)+_0x197dc8[_0xc2ac0e(0x10b)]()[_0xc2ac0e(0x1a0)](0x5,'0');var _0x252f69=[_0xc2ac0e(0x1c9),_0xc2ac0e(0x134)];if(_0x3420cd[0x0][_0xc2ac0e(0x14c)]=='English\x20(US)')var _0x287238=users['English'];else{if(_0x3420cd[0x0]['language']==_0xc2ac0e(0xe7))var _0x287238=users[_0xc2ac0e(0xe7)];else{if(_0x3420cd[0x0][_0xc2ac0e(0x14c)]==_0xc2ac0e(0x163))var _0x287238=users[_0xc2ac0e(0x163)];else{if(_0x3420cd[0x0][_0xc2ac0e(0x14c)]==_0xc2ac0e(0x150))var _0x287238=users[_0xc2ac0e(0x150)];else{if(_0x3420cd[0x0][_0xc2ac0e(0x14c)]==_0xc2ac0e(0x172))var _0x287238=users[_0xc2ac0e(0x172)];else{if(_0x3420cd[0x0][_0xc2ac0e(0x14c)]==_0xc2ac0e(0xf0))var _0x287238=users[_0xc2ac0e(0x1d4)];else{if(_0x3420cd[0x0][_0xc2ac0e(0x14c)]=='Chinese')var _0x287238=users[_0xc2ac0e(0x1b6)];else{if(_0x3420cd[0x0]['language']==_0xc2ac0e(0x1cf))var _0x287238=users[_0xc2ac0e(0x1d5)];}}}}}}}const _0x4d5c3f=getRandom8DigitNumber();_0x4d5c3f[_0xc2ac0e(0x1af)](_0x51f14b=>{var _0x56a615=_0xc2ac0e;_0x10b363[_0x56a615(0xfd)](_0x56a615(0x193),{'success':_0x5800cc[_0x56a615(0x167)](_0x56a615(0x121)),'errors':_0x5800cc[_0x56a615(0x167)](_0x56a615(0xf2)),'role':_0x565846,'profile':_0xfb5c33,'suppliers':_0x27b825,'warehouse':_0x277141,'product':_0x42153d,'invoice':_0x51f14b,'master_shop':_0x3420cd,'language':_0x287238,'find_data':_0x487772,'rooms_data':_0x252f69});})['catch'](_0x128e5f=>{var _0x2f16f3=_0xc2ac0e;_0x5800cc[_0x2f16f3(0x167)](_0x2f16f3(0xf2),_0x2f16f3(0x14b)),_0x10b363[_0x2f16f3(0x10c)](_0x2f16f3(0x142));});}catch(_0x4abb3b){console[_0xc2ac0e(0x1aa)](_0x4abb3b);}}),router[a0_0x2e1a48(0x128)](a0_0x2e1a48(0x126),auth,async(_0x23353c,_0x3bf1ef)=>{var _0x5ed8be=a0_0x2e1a48;try{const _0x50ffae=_0x23353c[_0x5ed8be(0xdc)]['id'];console[_0x5ed8be(0x1aa)](_0x50ffae);const _0x2d0f1a=await master_shop['find']();console[_0x5ed8be(0x1aa)](_0x5ed8be(0xeb),_0x2d0f1a);const _0x5c0a67=await product['findOne']({'name':_0x50ffae});console[_0x5ed8be(0x1aa)](_0x5ed8be(0x114),_0x5c0a67),_0x3bf1ef['status'](0xc8)[_0x5ed8be(0x1b8)]({'product_data':_0x5c0a67,'master':_0x2d0f1a});}catch(_0x52c7ea){console[_0x5ed8be(0x1aa)](_0x5ed8be(0xe5),_0x52c7ea);}}),router['post'](a0_0x2e1a48(0x17b),auth,async(_0x1d2bef,_0xb63962)=>{var _0x1cfecc=a0_0x2e1a48;try{const {invoice:_0x38d592,date:_0xd3ee48,warehouse_name:_0x576d18,prod_name:_0x32e7ea,prod_code:_0x282cb4,prod_qty:_0x2b794c,prod_unit:_0x3e7b09,prod_secondunit:_0x22391d,prod_level:_0xc4175e,prod_isle:_0x1bea71,prod_pallet:_0x490153,note:_0x5db9e8,expiry_date:_0x479432,batch_code:_0x36afde,payable:_0x420b91,due_amount:_0x10223e,Room_name:_0x483446,primary_code:_0x481091,secondary_code:_0x544a43,MaxStocks_data:_0xdfbf00,PO_number:_0x1105ce,SCRN:_0x182dd9,JO_number:_0x158dfc}=_0x1d2bef[_0x1cfecc(0x196)];if(typeof _0x32e7ea==_0x1cfecc(0x127))var _0x17d70c=[_0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x162)]],_0x40d99a=[_0x1d2bef[_0x1cfecc(0x196)]['prod_code']],_0x58b715=[_0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x159)]],_0x462dd7=[_0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x109)]],_0x15d580=[_0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x117)]],_0x1428e3=[_0x1d2bef[_0x1cfecc(0x196)]['prod_level']],_0x331bda=[_0x1d2bef[_0x1cfecc(0x196)]['primary_code']],_0x5d7f2f=[_0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x10e)]],_0xb45ce6=[_0x1d2bef['body'][_0x1cfecc(0xd9)]],_0x5c5db0=[_0x1d2bef['body'][_0x1cfecc(0x13a)]],_0x1d1080=[_0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x15d)]],_0x32c01f=[_0x1d2bef[_0x1cfecc(0x196)]['product_date']],_0x2f6b4c=[_0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x1a5)]],_0x4b77c5=[_0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x186)]],_0x574ad2=[_0x1d2bef[_0x1cfecc(0x196)]['RoomAssign']],_0x187a48=[_0x1d2bef[_0x1cfecc(0x196)]['prod_invoice']];else var _0x17d70c=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x162)]],_0x40d99a=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x12f)]],_0x58b715=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x159)]],_0x462dd7=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x109)]],_0x15d580=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x117)]],_0x1428e3=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x12c)]],_0x331bda=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x11d)]],_0x5d7f2f=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x10e)]],_0xb45ce6=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0xd9)]],_0x5c5db0=[..._0x1d2bef['body'][_0x1cfecc(0x13a)]],_0x1d1080=[..._0x1d2bef[_0x1cfecc(0x196)]['expiry_date']],_0x32c01f=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x195)]],_0x2f6b4c=[..._0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x1a5)]],_0x4b77c5=[..._0x1d2bef['body']['prod_cat']],_0x574ad2=[..._0x1d2bef[_0x1cfecc(0x196)]['RoomAssign']],_0x187a48=[..._0x1d2bef['body'][_0x1cfecc(0x1d2)]];const _0x491cea=_0x17d70c['map'](_0x5b6188=>{return _0x5b6188={'product_name':_0x5b6188};});_0x40d99a[_0x1cfecc(0x10d)]((_0x3c1513,_0x5f4a26)=>{var _0x3a231c=_0x1cfecc;_0x491cea[_0x5f4a26][_0x3a231c(0x1bc)]=_0x3c1513;}),_0x58b715['forEach']((_0xa4204f,_0x9db455)=>{var _0x1bd0ab=_0x1cfecc;_0x491cea[_0x9db455][_0x1bd0ab(0x16f)]=Math[_0x1bd0ab(0x14e)](_0xa4204f);}),_0x462dd7['forEach']((_0x340a5e,_0xc3f4ee)=>{_0x491cea[_0xc3f4ee]['standard_unit']=_0x340a5e;}),_0x15d580[_0x1cfecc(0x10d)]((_0x49134d,_0x12cf10)=>{var _0x20e7a0=_0x1cfecc;_0x491cea[_0x12cf10][_0x20e7a0(0x164)]=_0x49134d;}),_0x1428e3[_0x1cfecc(0x10d)]((_0xfe7c0d,_0x14bb33)=>{_0x491cea[_0x14bb33]['bay']=_0xfe7c0d;}),_0x331bda[_0x1cfecc(0x10d)]((_0x520f40,_0x13c19b)=>{_0x491cea[_0x13c19b]['primary_code']=_0x520f40;}),_0x5d7f2f[_0x1cfecc(0x10d)]((_0x5e2ee,_0x23746f)=>{var _0x256143=_0x1cfecc;_0x491cea[_0x23746f][_0x256143(0x10e)]=_0x5e2ee;}),_0xb45ce6[_0x1cfecc(0x10d)]((_0x4fda5f,_0x342913)=>{var _0x5c09e0=_0x1cfecc;_0x491cea[_0x342913][_0x5c09e0(0x1ad)]=_0x4fda5f;}),_0x5c5db0[_0x1cfecc(0x10d)]((_0x41ab21,_0x42963e)=>{var _0x51070a=_0x1cfecc;_0x491cea[_0x42963e][_0x51070a(0x13a)]=_0x41ab21;}),_0x1d1080[_0x1cfecc(0x10d)]((_0x60e5a2,_0x485838)=>{_0x491cea[_0x485838]['expiry_date']=_0x60e5a2;}),_0x32c01f[_0x1cfecc(0x10d)]((_0x1fade0,_0x2a230f)=>{var _0x162a0a=_0x1cfecc;_0x491cea[_0x2a230f][_0x162a0a(0x166)]=_0x1fade0;}),_0x2f6b4c[_0x1cfecc(0x10d)]((_0x3f4882,_0x554ce3)=>{_0x491cea[_0x554ce3]['maxperunit']=_0x3f4882;}),_0x4b77c5[_0x1cfecc(0x10d)]((_0x1a843b,_0x5a72de)=>{_0x491cea[_0x5a72de]['product_cat']=_0x1a843b;}),_0x574ad2[_0x1cfecc(0x10d)]((_0x16e114,_0x37478b)=>{var _0x2546c4=_0x1cfecc;_0x491cea[_0x37478b][_0x2546c4(0x165)]=_0x16e114;}),_0x187a48['forEach']((_0x13ba67,_0xee4c61)=>{var _0xe02e17=_0x1cfecc;_0x491cea[_0xee4c61][_0xe02e17(0x1b9)]=_0x13ba67;});const _0x22f4b8=_0x491cea[_0x1cfecc(0x151)](_0x3da94f=>_0x3da94f[_0x1cfecc(0x16f)]!=='0'&&_0x3da94f['quantity']!==''),_0x31f615=new purchases_finished({'invoice':_0x38d592,'suppliers':_0x1d2bef[_0x1cfecc(0x196)][_0x1cfecc(0x16b)],'date':_0xd3ee48,'warehouse_name':_0x576d18,'product':_0x22f4b8,'note':_0x5db9e8,'due_amount':_0x10223e,'room':_0x483446,'POnumber':_0x1105ce,'SCRN':_0x182dd9,'JO_number':_0x158dfc}),_0xbd6100=await _0x31f615[_0x1cfecc(0x1c0)](),_0x302ed5=await purchases_finished['findOne']({'invoice':_0x38d592}),_0x38ffdb=_0x302ed5['product'][_0x1cfecc(0x161)](async _0x10bc89=>{var _0x5e4934=_0x1cfecc;try{var _0x230b18=await warehouse[_0x5e4934(0x1d7)]({'name':_0x576d18,'room':_0x10bc89[_0x5e4934(0x165)]}),_0x4a24af=0x0;const _0x3a4537=_0x230b18[_0x5e4934(0x14a)][_0x5e4934(0x161)](_0x291be0=>{var _0x480779=_0x5e4934;console[_0x480779(0x1aa)](_0x291be0['product_name']+'=='+_0x10bc89[_0x480779(0x1a8)]+'&&'+_0x291be0[_0x480779(0xfb)]+'=='+_0x10bc89[_0x480779(0xfb)]+'&&'+_0x291be0[_0x480779(0x15d)]+'=='+_0x10bc89[_0x480779(0x15d)]+'&&'+_0x291be0[_0x480779(0x166)]+'=='+_0x10bc89[_0x480779(0x166)]+'&&'+_0x291be0[_0x480779(0x13a)]+'=='+_0x10bc89[_0x480779(0x13a)]+'&&'+_0x291be0['invoice']+'=='+_0x302ed5[_0x480779(0x1b9)]),_0x291be0['product_name']==_0x10bc89[_0x480779(0x1a8)]&&_0x291be0[_0x480779(0xfb)]==_0x10bc89[_0x480779(0xfb)]&&_0x291be0[_0x480779(0x15d)]==_0x10bc89[_0x480779(0x15d)]&&_0x291be0[_0x480779(0x166)]==_0x10bc89[_0x480779(0x166)]&&_0x291be0[_0x480779(0x13a)]==_0x10bc89[_0x480779(0x13a)]&&_0x291be0[_0x480779(0x1b9)]==_0x302ed5['invoice']&&(_0x291be0[_0x480779(0x1b4)]=Math['abs'](_0x291be0[_0x480779(0x1b4)])+Math[_0x480779(0x14e)](_0x10bc89[_0x480779(0x16f)]),_0x4a24af++);});return _0x4a24af==0x0&&(_0x230b18['product_details']=_0x230b18['product_details'][_0x5e4934(0x160)]({'product_name':_0x10bc89[_0x5e4934(0x1a8)],'product_stock':Math['abs'](_0x10bc89[_0x5e4934(0x16f)]),'primary_code':_0x10bc89[_0x5e4934(0x11d)],'secondary_code':_0x10bc89[_0x5e4934(0x10e)],'product_code':_0x10bc89[_0x5e4934(0x1bc)],'bay':_0x10bc89[_0x5e4934(0xfb)],'maxProducts':_0x10bc89[_0x5e4934(0x1ad)],'unit':_0x10bc89[_0x5e4934(0x12a)],'secondary_unit':_0x10bc89[_0x5e4934(0x164)],'expiry_date':_0x10bc89[_0x5e4934(0x15d)],'production_date':_0x10bc89[_0x5e4934(0x166)],'maxProducts':_0x10bc89['maxStocks'],'maxPerUnit':_0x10bc89[_0x5e4934(0x192)],'batch_code':_0x10bc89[_0x5e4934(0x13a)],'product_cat':_0x10bc89[_0x5e4934(0x10a)],'invoice':_0x10bc89['invoice'],'id_incoming':_0x10bc89[_0x5e4934(0x187)]})),_0x230b18;}catch(_0x1f8448){return console[_0x5e4934(0x129)](_0x5e4934(0x13f),_0x1f8448),null;}});Promise[_0x1cfecc(0x12e)](_0x38ffdb)[_0x1cfecc(0x1af)](async _0x35bcab=>{var _0x2d18ec=_0x1cfecc;try{for(const _0x54aa32 of _0x35bcab){await warehouse['updateOne']({'_id':_0x54aa32[_0x2d18ec(0x187)]},{'$addToSet':{'product_details':{'$each':_0x54aa32[_0x2d18ec(0x14a)]}}});}const _0x4560e3=await master_shop['find'](),_0x3dba85=await email_settings[_0x2d18ec(0x1d7)](),_0x448347=await supervisor_settings[_0x2d18ec(0x176)]();var _0x1b9ed4=_0x302ed5['product'],_0x2c4b96='',_0x4020c8;for(_0x4020c8 in _0x1b9ed4){var _0xd7f5eb='FG';_0x302ed5[_0x2d18ec(0x152)]==_0x2d18ec(0x1c7)&&(_0xd7f5eb='DG'),_0x2c4b96+=_0x2d18ec(0x110)+_0x2d18ec(0xfe)+_0x1b9ed4[_0x4020c8][_0x2d18ec(0x1a8)]+_0x2d18ec(0xee)+_0x2d18ec(0xfe)+_0x1b9ed4[_0x4020c8][_0x2d18ec(0x1bc)]+'</td>'+_0x2d18ec(0xfe)+_0x1b9ed4[_0x4020c8][_0x2d18ec(0x16f)]+_0x2d18ec(0xee)+_0x2d18ec(0xfe)+_0x1b9ed4[_0x4020c8][_0x2d18ec(0x12a)]+_0x2d18ec(0xee)+_0x2d18ec(0xfe)+_0x1b9ed4[_0x4020c8][_0x2d18ec(0x164)]+_0x2d18ec(0xee)+_0x2d18ec(0xfe)+_0x302ed5[_0x2d18ec(0x152)]+_0x2d18ec(0xee)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b9ed4[_0x4020c8][_0x2d18ec(0x165)]+'</td>'+_0x2d18ec(0xfe)+_0xd7f5eb+_0x1b9ed4[_0x4020c8][_0x2d18ec(0xfb)]+'</td>',_0x2d18ec(0x146);}let _0x535145=nodemailer[_0x2d18ec(0x1c2)]({'host':_0x3dba85['host'],'port':Number(_0x3dba85[_0x2d18ec(0x1c4)]),'secure':![],'auth':{'user':_0x3dba85['email'],'pass':_0x3dba85['password']}}),_0x384ef7={'from':_0x3dba85['email'],'to':_0x448347[0x0][_0x2d18ec(0x15a)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x2d18ec(0x19c),'path':__dirname+'/../public'+_0x2d18ec(0x190)+_0x4560e3[0x0][_0x2d18ec(0x15b)],'cid':_0x2d18ec(0x1ac)}],'html':_0x2d18ec(0x131)+'<html><head><title></title>'+_0x2d18ec(0x19e)+'<div>'+_0x2d18ec(0x17f)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2d18ec(0x18a)+_0x2d18ec(0x101)+_0x2d18ec(0xec)+_0x4560e3[0x0][_0x2d18ec(0x194)]+_0x2d18ec(0x18f)+_0x2d18ec(0x18a)+_0x2d18ec(0x18a)+_0x2d18ec(0x11a)+_0x2d18ec(0x101)+_0x2d18ec(0xf4)+_0x2d18ec(0x1a9)+_0x302ed5['invoice']+'\x20'+_0x2d18ec(0x123)+_0x2d18ec(0x111)+_0x302ed5[_0x2d18ec(0x185)]+'\x20'+_0x2d18ec(0xdb)+_0x2d18ec(0x136)+_0x2d18ec(0x18a)+_0x2d18ec(0x113)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2d18ec(0x110)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2d18ec(0x198)+_0x2d18ec(0x130)+_0x2d18ec(0x13e)+_0x2d18ec(0x1d6)+_0x2d18ec(0xf1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x2d18ec(0x1ba)+_0x2d18ec(0x146)+_0x2d18ec(0x15e)+_0x2d18ec(0xf8)+'\x20'+_0x2c4b96+'\x20'+_0x2d18ec(0x155)+_0x2d18ec(0x1a6)+_0x2d18ec(0x101)+_0x2d18ec(0x1cb)+_0x2d18ec(0x1b5)+_0x4560e3[0x0][_0x2d18ec(0x194)]+_0x2d18ec(0x136)+'</div>'+_0x2d18ec(0x18a)+_0x2d18ec(0x18c)};_0x535145[_0x2d18ec(0x17d)](_0x384ef7,function(_0x3abf58,_0x10d52b){var _0x5c600b=_0x2d18ec;_0x3abf58?(console[_0x5c600b(0x1aa)](_0x3abf58),console[_0x5c600b(0x1aa)]('Error\x20Occurs')):console[_0x5c600b(0x1aa)]('Email\x20sent\x20successfully');});}catch(_0x46d267){console[_0x2d18ec(0x129)](_0x46d267),_0xb63962['status'](0x1f4)[_0x2d18ec(0x1b8)]({'error':_0x2d18ec(0x125),'message':_0x46d267[_0x2d18ec(0xe2)]});}})[_0x1cfecc(0x132)](_0x57fea1=>{console['error'](_0x57fea1);}),_0x1d2bef[_0x1cfecc(0x167)](_0x1cfecc(0x121),_0x1cfecc(0x1b3)),_0xb63962[_0x1cfecc(0x10c)]('/all_purchases_finished/view');}catch(_0x280374){console['log'](_0x280374);}}),router[a0_0x2e1a48(0x128)](a0_0x2e1a48(0x1d0),auth,async(_0x1feb55,_0x58e45f)=>{var _0x5ce9ea=a0_0x2e1a48;try{const {username:_0x4c43c8,email:_0x10b5af,role:_0x3483f4}=_0x1feb55[_0x5ce9ea(0x124)],_0x413855=_0x1feb55['user'],_0x52b519=await profile[_0x5ce9ea(0x1d7)]({'email':_0x413855[_0x5ce9ea(0x100)]}),_0x401bbc=await master_shop[_0x5ce9ea(0x176)](),_0x5b9966=_0x1feb55[_0x5ce9ea(0xdc)]['id'],_0x286ce5=await purchases_finished[_0x5ce9ea(0x135)](_0x5b9966),_0x40c8f=await suppliers[_0x5ce9ea(0x176)]({});let _0x442f5b;if(_0x413855[_0x5ce9ea(0x16a)]==_0x5ce9ea(0x156)){const _0x4fd09a=await staff[_0x5ce9ea(0x1d7)]({'email':_0x413855[_0x5ce9ea(0x100)]});_0x442f5b=await warehouse[_0x5ce9ea(0x176)]({'status':_0x5ce9ea(0x183),'name':_0x4fd09a['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x442f5b=await warehouse[_0x5ce9ea(0x1bb)]([{'$match':{'status':'Enabled','warehouse_category':_0x5ce9ea(0x1ae)}},{'$group':{'_id':_0x5ce9ea(0xdd),'name':{'$first':'$name'}}}]);const _0x2eed5a=await product[_0x5ce9ea(0x176)]({}),_0x48bef9=BayBinSelected(_0x286ce5[_0x5ce9ea(0x152)],_0x286ce5[_0x5ce9ea(0x1c5)]);let _0x3e388b=new Date(_0x286ce5[_0x5ce9ea(0x15d)]),_0x435ed2=('0'+_0x3e388b[_0x5ce9ea(0x148)]())[_0x5ce9ea(0xf5)](-0x2),_0x3a1fa2=('0'+(_0x3e388b[_0x5ce9ea(0x189)]()+0x1))[_0x5ce9ea(0xf5)](-0x2),_0x1ce309=_0x3e388b['getFullYear'](),_0x3c10b7=_0x1ce309+'-'+_0x3a1fa2+'-'+_0x435ed2;if(_0x401bbc[0x0]['language']==_0x5ce9ea(0xde)){var _0x3afef8=users['English'];console[_0x5ce9ea(0x1aa)](_0x3afef8);}else{if(_0x401bbc[0x0]['language']==_0x5ce9ea(0xe7))var _0x3afef8=users[_0x5ce9ea(0xe7)];else{if(_0x401bbc[0x0][_0x5ce9ea(0x14c)]=='German')var _0x3afef8=users[_0x5ce9ea(0x163)];else{if(_0x401bbc[0x0]['language']==_0x5ce9ea(0x150))var _0x3afef8=users[_0x5ce9ea(0x150)];else{if(_0x401bbc[0x0][_0x5ce9ea(0x14c)]==_0x5ce9ea(0x172))var _0x3afef8=users[_0x5ce9ea(0x172)];else{if(_0x401bbc[0x0][_0x5ce9ea(0x14c)]=='Portuguese\x20(BR)')var _0x3afef8=users['Portuguese'];else{if(_0x401bbc[0x0][_0x5ce9ea(0x14c)]==_0x5ce9ea(0x1b6))var _0x3afef8=users[_0x5ce9ea(0x1b6)];else{if(_0x401bbc[0x0][_0x5ce9ea(0x14c)]==_0x5ce9ea(0x1cf))var _0x3afef8=users[_0x5ce9ea(0x1d5)];}}}}}}}_0x58e45f[_0x5ce9ea(0xfd)](_0x5ce9ea(0x1b0),{'success':_0x1feb55[_0x5ce9ea(0x167)]('success'),'errors':_0x1feb55[_0x5ce9ea(0x167)]('errors'),'role':_0x413855,'profile':_0x52b519,'purchases':_0x286ce5,'suppliers':_0x40c8f,'warehouse':_0x442f5b,'product':_0x2eed5a,'master_shop':_0x401bbc,'language':_0x3afef8,'ed_fullDate':_0x3c10b7,'dataSelected':_0x48bef9});}catch(_0x4365c8){console['log'](_0x4365c8);}}),router['get'](a0_0x2e1a48(0x120),auth,async(_0x4392dd,_0x1ef534)=>{var _0x425f1b=a0_0x2e1a48;try{const {username:_0x5203da,email:_0x2a701e,role:_0x3cff9b}=_0x4392dd[_0x425f1b(0x124)],_0x1acbb6=_0x4392dd[_0x425f1b(0x124)],_0x21fc43=await profile[_0x425f1b(0x1d7)]({'email':_0x1acbb6[_0x425f1b(0x100)]}),_0x48050d=await master_shop[_0x425f1b(0x176)](),_0x27e428=_0x4392dd['params']['id'],_0x2ac9bf=await purchases_finished[_0x425f1b(0x135)](_0x27e428),_0x42485e=await suppliers[_0x425f1b(0x176)]({});let _0x4a3eac;if(_0x1acbb6[_0x425f1b(0x16a)]==_0x425f1b(0x156)){const _0xa4c74f=await staff['findOne']({'email':_0x1acbb6[_0x425f1b(0x100)]});_0x4a3eac=await warehouse[_0x425f1b(0x176)]({'status':_0x425f1b(0x183),'name':_0xa4c74f['warehouse'],'warehouse_category':_0x425f1b(0x1ae)});}else _0x4a3eac=await warehouse[_0x425f1b(0x1bb)]([{'$match':{'status':_0x425f1b(0x183),'warehouse_category':_0x425f1b(0x1ae)}},{'$group':{'_id':_0x425f1b(0xdd),'name':{'$first':_0x425f1b(0xdd)}}}]);const _0x245994=await product[_0x425f1b(0x176)]({}),_0x5b4f01=BayBinSelected(_0x2ac9bf[_0x425f1b(0x152)],_0x2ac9bf[_0x425f1b(0x1c5)]);let _0x26f361=new Date(_0x2ac9bf['expiry_date']),_0x5c1248=('0'+_0x26f361[_0x425f1b(0x148)]())[_0x425f1b(0xf5)](-0x2),_0x55f255=('0'+(_0x26f361[_0x425f1b(0x189)]()+0x1))[_0x425f1b(0xf5)](-0x2),_0x47797b=_0x26f361['getFullYear'](),_0x368af0=_0x47797b+'-'+_0x55f255+'-'+_0x5c1248;if(_0x48050d[0x0][_0x425f1b(0x14c)]==_0x425f1b(0xde)){var _0x339529=users[_0x425f1b(0xe0)];console[_0x425f1b(0x1aa)](_0x339529);}else{if(_0x48050d[0x0][_0x425f1b(0x14c)]==_0x425f1b(0xe7))var _0x339529=users[_0x425f1b(0xe7)];else{if(_0x48050d[0x0][_0x425f1b(0x14c)]==_0x425f1b(0x163))var _0x339529=users[_0x425f1b(0x163)];else{if(_0x48050d[0x0][_0x425f1b(0x14c)]==_0x425f1b(0x150))var _0x339529=users[_0x425f1b(0x150)];else{if(_0x48050d[0x0][_0x425f1b(0x14c)]=='French')var _0x339529=users[_0x425f1b(0x172)];else{if(_0x48050d[0x0][_0x425f1b(0x14c)]==_0x425f1b(0xf0))var _0x339529=users[_0x425f1b(0x1d4)];else{if(_0x48050d[0x0]['language']==_0x425f1b(0x1b6))var _0x339529=users[_0x425f1b(0x1b6)];else{if(_0x48050d[0x0][_0x425f1b(0x14c)]==_0x425f1b(0x1cf))var _0x339529=users['Arabic'];}}}}}}}_0x1ef534[_0x425f1b(0xfd)](_0x425f1b(0x112),{'success':_0x4392dd[_0x425f1b(0x167)](_0x425f1b(0x121)),'errors':_0x4392dd[_0x425f1b(0x167)](_0x425f1b(0xf2)),'role':_0x1acbb6,'profile':_0x21fc43,'purchases':_0x2ac9bf,'suppliers':_0x42485e,'warehouse':_0x4a3eac,'product':_0x245994,'master_shop':_0x48050d,'language':_0x339529,'ed_fullDate':_0x368af0,'dataSelected':_0x5b4f01});}catch(_0x4c89f3){console['log'](_0x4c89f3);}}),router[a0_0x2e1a48(0x179)](a0_0x2e1a48(0x120),auth,async(_0x12ef8f,_0x37bec5)=>{var _0x1cee73=a0_0x2e1a48;try{const _0x530ba6=_0x12ef8f[_0x1cee73(0xdc)]['id'],_0x1dd676=await purchases_finished[_0x1cee73(0x1d7)]({'_id':_0x12ef8f['params']['id']}),_0x1e1181=await warehouse[_0x1cee73(0x1d7)]({'name':_0x1dd676[_0x1cee73(0x152)],'room':_0x1dd676['room']});_0x1dd676[_0x1cee73(0x114)]['forEach'](_0x49c742=>{var _0x587c7c=_0x1cee73;const _0x151873=_0x1e1181[_0x587c7c(0x14a)][_0x587c7c(0x161)](_0x136b7b=>{var _0x36cdb1=_0x587c7c;_0x136b7b[_0x36cdb1(0x1a8)]==_0x49c742[_0x36cdb1(0x1a8)]&&_0x136b7b[_0x36cdb1(0xfb)]==_0x49c742[_0x36cdb1(0xfb)]&&(_0x136b7b[_0x36cdb1(0x1b4)]=parseInt(_0x136b7b[_0x36cdb1(0x1b4)])-parseInt(_0x49c742[_0x36cdb1(0x16f)]));});}),await _0x1e1181[_0x1cee73(0x1c0)]();const {invoice:_0x2f3f97,suppliers:_0x2c0971,date:_0x52d7a9,warehouse_name:_0x1de935,prod_name:_0x367ca3,prod_code:_0x2aefe6,prod_qty:_0x381805,prod_unit:_0x2179da,prod_secondunit:_0x5d8167,prod_level:_0x1dad9b,prod_isle:_0x2c4d8a,prod_pallet:_0x4aafc3,note:_0x3a149f,expiry_date:_0x3fe309,batch_code:_0x21ad1a,paid_amount:_0x14a2ee,due_amount:_0x14159c,Room_name:_0x712487,primary_code:_0xd104ca,secondary_code:_0x2a8635,PO_number:_0x5ee436,JO_number:_0x2a4334}=_0x12ef8f[_0x1cee73(0x196)];if(typeof _0x367ca3==_0x1cee73(0x127))var _0x438746=[_0x12ef8f[_0x1cee73(0x196)]['prod_name']],_0x322b9a=[_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x12f)]],_0x2f5d1e=[_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x16c)]],_0x2af058=[_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x170)]],_0x578665=[_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x117)]],_0x338fa9=[_0x12ef8f['body'][_0x1cee73(0x12c)]],_0x10ce8f=[_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x11d)]],_0x95c57b=[_0x12ef8f['body'][_0x1cee73(0x10e)]],_0x18da52=[_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0xd9)]],_0x55adc5=[_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x13a)]],_0x476589=[_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x15d)]];else var _0x438746=[..._0x12ef8f['body'][_0x1cee73(0x162)]],_0x322b9a=[..._0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x12f)]],_0x2f5d1e=[..._0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x16c)]],_0x2af058=[..._0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x170)]],_0x578665=[..._0x12ef8f['body'][_0x1cee73(0x117)]],_0x338fa9=[..._0x12ef8f[_0x1cee73(0x196)]['prod_level']],_0x10ce8f=[..._0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x11d)]],_0x95c57b=[..._0x12ef8f['body']['secondary_code']],_0x18da52=[..._0x12ef8f['body'][_0x1cee73(0xd9)]],_0x55adc5=[..._0x12ef8f[_0x1cee73(0x196)]['batch_code']],_0x476589=[..._0x12ef8f['body'][_0x1cee73(0x15d)]];const _0x1a406c=_0x438746[_0x1cee73(0x161)](_0x499864=>{return _0x499864={'product_name':_0x499864};});_0x322b9a[_0x1cee73(0x10d)]((_0x54e10f,_0x2973e4)=>{var _0x38760a=_0x1cee73;_0x1a406c[_0x2973e4][_0x38760a(0x1bc)]=_0x54e10f;}),_0x2f5d1e['forEach']((_0x1b3335,_0x50bca5)=>{var _0x41785d=_0x1cee73;_0x1a406c[_0x50bca5][_0x41785d(0x16f)]=_0x1b3335;}),_0x2af058[_0x1cee73(0x10d)]((_0x167566,_0xddceb1)=>{var _0x345958=_0x1cee73;_0x1a406c[_0xddceb1][_0x345958(0x12a)]=_0x167566;}),_0x578665['forEach']((_0x1d7fdb,_0x172d4f)=>{var _0x380dd7=_0x1cee73;_0x1a406c[_0x172d4f][_0x380dd7(0x164)]=_0x1d7fdb;}),_0x338fa9[_0x1cee73(0x10d)]((_0x408215,_0x1c432f)=>{var _0x49c84d=_0x1cee73;_0x1a406c[_0x1c432f][_0x49c84d(0xfb)]=_0x408215;}),_0x10ce8f[_0x1cee73(0x10d)]((_0x310b47,_0x81ded6)=>{var _0x45b0e8=_0x1cee73;_0x1a406c[_0x81ded6][_0x45b0e8(0x11d)]=_0x310b47;}),_0x95c57b[_0x1cee73(0x10d)]((_0x59521e,_0x12eb2e)=>{var _0x109f01=_0x1cee73;_0x1a406c[_0x12eb2e][_0x109f01(0x10e)]=_0x59521e;}),_0x18da52[_0x1cee73(0x10d)]((_0x41e7f0,_0xe179ee)=>{var _0x2d949d=_0x1cee73;_0x1a406c[_0xe179ee][_0x2d949d(0x1ad)]=_0x41e7f0;}),_0x55adc5[_0x1cee73(0x10d)]((_0x51ba46,_0x50b132)=>{var _0x33bcbf=_0x1cee73;_0x1a406c[_0x50b132][_0x33bcbf(0x13a)]=_0x51ba46;}),_0x476589[_0x1cee73(0x10d)]((_0xf60e44,_0x857a7)=>{var _0x278d65=_0x1cee73;_0x1a406c[_0x857a7][_0x278d65(0x15d)]=_0xf60e44;});const _0x3850d0=_0x1a406c['filter'](_0x216ad5=>_0x216ad5[_0x1cee73(0x16f)]!=='0'&&_0x216ad5['quantity']!=='');_0x1dd676[_0x1cee73(0x1b9)]=_0x2f3f97,_0x1dd676[_0x1cee73(0x16b)]=_0x2c0971,_0x1dd676[_0x1cee73(0x185)]=_0x52d7a9,_0x1dd676[_0x1cee73(0x152)]=_0x1de935,_0x1dd676[_0x1cee73(0x114)]=_0x3850d0,_0x1dd676[_0x1cee73(0x1cc)]=_0x3a149f,_0x1dd676[_0x1cee73(0x104)]=_0x14a2ee,_0x1dd676[_0x1cee73(0x143)]=_0x14159c,_0x1dd676['room']=_0x712487,_0x1dd676[_0x1cee73(0x180)]=_0x5ee436,_0x1dd676[_0x1cee73(0x106)]=_0x2a4334;const _0x153e29=await _0x1dd676[_0x1cee73(0x1c0)](),_0x3df7a5=await warehouse[_0x1cee73(0x1d7)]({'name':_0x12ef8f['body'][_0x1cee73(0x152)],'room':_0x12ef8f['body']['Room_name']});_0x1dd676[_0x1cee73(0x114)][_0x1cee73(0x10d)](_0x2521ff=>{var _0x298c2c=_0x1cee73,_0x12b22f=0x0;const _0x3b6d45=_0x3df7a5['product_details'][_0x298c2c(0x161)](_0x567381=>{var _0x21af7d=_0x298c2c;_0x567381[_0x21af7d(0x1a8)]==_0x2521ff[_0x21af7d(0x1a8)]&&_0x567381[_0x21af7d(0xfb)]==_0x2521ff['bay']&&(_0x567381[_0x21af7d(0x1b4)]=parseInt(_0x567381[_0x21af7d(0x1b4)])+parseInt(_0x2521ff[_0x21af7d(0x16f)]),_0x12b22f++);});_0x12b22f=='0'&&(_0x3df7a5[_0x298c2c(0x14a)]=_0x3df7a5[_0x298c2c(0x14a)][_0x298c2c(0x160)]({'product_name':_0x2521ff[_0x298c2c(0x1a8)],'product_stock':_0x2521ff['quantity'],'primary_code':_0x2521ff['primary_code'],'secondary_code':_0x2521ff['secondary_code'],'product_code':_0x2521ff[_0x298c2c(0x1bc)],'bay':_0x2521ff[_0x298c2c(0xfb)],'maxProducts':_0x2521ff[_0x298c2c(0x1ad)],'unit':_0x2521ff[_0x298c2c(0x12a)],'secondary_unit':_0x2521ff[_0x298c2c(0x164)],'expiry_date':_0x2521ff[_0x298c2c(0x15d)]}));}),await _0x3df7a5['save']();const _0x3a1dd3=await s_payment_data[_0x1cee73(0x1d7)]({'invoice':_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x1b9)]});if(_0x3a1dd3===null){}else console[_0x1cee73(0x1aa)](_0x1cee73(0x16b),_0x3a1dd3,_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x1b9)]),_0x3a1dd3[_0x1cee73(0x16b)]=_0x12ef8f[_0x1cee73(0x196)][_0x1cee73(0x16b)],await _0x3a1dd3[_0x1cee73(0x1c0)]();_0x12ef8f[_0x1cee73(0x167)](_0x1cee73(0x121),_0x1cee73(0x188)),_0x37bec5[_0x1cee73(0x10c)](_0x1cee73(0x142));}catch(_0x117a8e){console['log'](_0x117a8e);}}),router[a0_0x2e1a48(0x179)](a0_0x2e1a48(0x1ab),auth,async(_0x3937fd,_0x96d78f)=>{var _0x213482=a0_0x2e1a48;try{const _0x427a20=_0x3937fd[_0x213482(0xdc)]['id'],{invoice:_0x2039f8,suppliers:_0x4562e1,payable:_0x46973e,due_amount:_0x2c02e0}=_0x3937fd['body'],_0x4f1b3c=await purchases[_0x213482(0x135)](_0x427a20);var _0x5e26bf=_0x46973e-_0x2c02e0;_0x4f1b3c[_0x213482(0x104)]=parseFloat(_0x4f1b3c['paid_amount'])+parseFloat(_0x2c02e0),_0x4f1b3c[_0x213482(0x143)]=_0x5e26bf;const _0x3e4eef=await _0x4f1b3c[_0x213482(0x1c0)]();console[_0x213482(0x1aa)](_0x3e4eef);const _0x2b4c75=await s_payment_data[_0x213482(0x1d7)]({'invoice':_0x2039f8});_0x2b4c75[_0x213482(0x19f)]=_0x5e26bf,await _0x2b4c75[_0x213482(0x1c0)]();let _0x4358b6=new Date(),_0x35c95a=('0'+_0x4358b6['getDate']())[_0x213482(0xf5)](-0x2),_0x51996f=('0'+(_0x4358b6[_0x213482(0x189)]()+0x1))[_0x213482(0xf5)](-0x2),_0x1c11b5=_0x4358b6['getFullYear'](),_0xacd42c=_0x1c11b5+'-'+_0x51996f+'-'+_0x35c95a;const _0x292a94=new suppliers_payment({'invoice':_0x2039f8,'date':_0x1c11b5+'-'+_0x51996f+'-'+_0x35c95a,'suppliers':_0x4562e1,'reason':_0x213482(0x1c6),'amount':_0x2c02e0}),_0x37c1d2=await _0x292a94[_0x213482(0x1c0)]();_0x3937fd['flash']('success',_0x213482(0x1b7)),_0x96d78f[_0x213482(0x10c)](_0x213482(0xef));}catch(_0x4a2372){console[_0x213482(0x1aa)](_0x4a2372);}}),router[a0_0x2e1a48(0x128)](a0_0x2e1a48(0x157),auth,async(_0xa77d8f,_0x22cb49)=>{var _0x32ed97=a0_0x2e1a48;try{const {username:_0xdf8e4f,email:_0xa78339,role:_0x1f1cfb}=_0xa77d8f[_0x32ed97(0x124)],_0x54ac44=_0xa77d8f['user'],_0xa4542c=await profile[_0x32ed97(0x1d7)]({'email':_0x54ac44['email']}),_0x5c4d82=await master_shop[_0x32ed97(0x176)]();console[_0x32ed97(0x1aa)]('master',_0x5c4d82);const _0x4e2cf9=_0xa77d8f[_0x32ed97(0xdc)]['id'],_0x7f529a=await purchases[_0x32ed97(0x135)](_0x4e2cf9);console['log'](_0x7f529a);const _0x45652c=await suppliers['findOne']({'name':_0x7f529a['suppliers']});console[_0x32ed97(0x1aa)](_0x45652c);if(_0x5c4d82[0x0]['language']=='English\x20(US)'){var _0x186905=users[_0x32ed97(0xe0)];console[_0x32ed97(0x1aa)](_0x186905);}else{if(_0x5c4d82[0x0][_0x32ed97(0x14c)]=='Hindi')var _0x186905=users[_0x32ed97(0xe7)];else{if(_0x5c4d82[0x0][_0x32ed97(0x14c)]==_0x32ed97(0x163))var _0x186905=users['German'];else{if(_0x5c4d82[0x0][_0x32ed97(0x14c)]==_0x32ed97(0x150))var _0x186905=users[_0x32ed97(0x150)];else{if(_0x5c4d82[0x0]['language']==_0x32ed97(0x172))var _0x186905=users[_0x32ed97(0x172)];else{if(_0x5c4d82[0x0][_0x32ed97(0x14c)]==_0x32ed97(0xf0))var _0x186905=users['Portuguese'];else{if(_0x5c4d82[0x0][_0x32ed97(0x14c)]==_0x32ed97(0x1b6))var _0x186905=users[_0x32ed97(0x1b6)];else{if(_0x5c4d82[0x0][_0x32ed97(0x14c)]==_0x32ed97(0x1cf))var _0x186905=users[_0x32ed97(0x1d5)];}}}}}}}_0x22cb49[_0x32ed97(0xfd)]('purchase_invoice',{'success':_0xa77d8f['flash']('success'),'errors':_0xa77d8f[_0x32ed97(0x167)](_0x32ed97(0xf2)),'role':_0x54ac44,'profile':_0xa4542c,'master_shop':_0x5c4d82,'supplier':_0x45652c,'purchase':_0x7f529a,'language':_0x186905});}catch(_0xc8e1bc){console[_0x32ed97(0x1aa)](_0xc8e1bc);}}),router[a0_0x2e1a48(0x128)](a0_0x2e1a48(0x12b),auth,async(_0x22ebc8,_0x1e4b17)=>{var _0x5d21a4=a0_0x2e1a48;try{const {username:_0x485b51,email:_0x483283,role:_0x5f6feb}=_0x22ebc8[_0x5d21a4(0x124)],_0x19bf9d=_0x22ebc8[_0x5d21a4(0x124)],_0x5370ea=await profile['findOne']({'email':_0x19bf9d['email']}),_0x87eed7=await master_shop[_0x5d21a4(0x176)]();console[_0x5d21a4(0x1aa)](_0x5d21a4(0xeb),_0x87eed7);const _0x932925=_0x22ebc8['params']['id'];console[_0x5d21a4(0x1aa)](_0x932925);const _0x515f96=await purchases_finished[_0x5d21a4(0x135)](_0x932925);console['log'](_0x5d21a4(0xf9),_0x515f96);const _0x4149e0=await product[_0x5d21a4(0x176)]({}),_0x464913=await warehouse[_0x5d21a4(0x1bb)]([{'$match':{'name':_0x515f96[_0x5d21a4(0x152)],'room':_0x515f96[_0x5d21a4(0x1c5)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5d21a4(0x1bf),'name':{'$first':_0x5d21a4(0xda)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5d21a4(0x173)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5d21a4(0x1a4)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5d21a4(0x1bd)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5d21a4(0x171)},'rack':{'$first':_0x5d21a4(0x140)}}}]);console[_0x5d21a4(0x1aa)](_0x5d21a4(0x18e),_0x464913);let _0x4277e0;if(_0x19bf9d[_0x5d21a4(0x16a)]==_0x5d21a4(0x156)){const _0x21fd5f=await staff[_0x5d21a4(0x1d7)]({'email':_0x19bf9d[_0x5d21a4(0x100)]});_0x4277e0=await warehouse[_0x5d21a4(0x176)]({'status':_0x5d21a4(0x183),'name':_0x21fd5f[_0x5d21a4(0x122)],'warehouse_category':_0x5d21a4(0x1ae),'name':_0x5d21a4(0x199)});}else _0x4277e0=await warehouse[_0x5d21a4(0x1bb)]([{'$match':{'status':_0x5d21a4(0x183),'warehouse_category':_0x5d21a4(0x1ae),'name':_0x5d21a4(0x199)}},{'$group':{'_id':_0x5d21a4(0xdd),'name':{'$first':_0x5d21a4(0xdd)}}}]);if(_0x87eed7[0x0][_0x5d21a4(0x14c)]==_0x5d21a4(0xde)){var _0x3397f7=users['English'];console[_0x5d21a4(0x1aa)](_0x3397f7);}else{if(_0x87eed7[0x0][_0x5d21a4(0x14c)]==_0x5d21a4(0xe7))var _0x3397f7=users[_0x5d21a4(0xe7)];else{if(_0x87eed7[0x0]['language']=='German')var _0x3397f7=users[_0x5d21a4(0x163)];else{if(_0x87eed7[0x0][_0x5d21a4(0x14c)]=='Spanish')var _0x3397f7=users[_0x5d21a4(0x150)];else{if(_0x87eed7[0x0][_0x5d21a4(0x14c)]==_0x5d21a4(0x172))var _0x3397f7=users[_0x5d21a4(0x172)];else{if(_0x87eed7[0x0][_0x5d21a4(0x14c)]==_0x5d21a4(0xf0))var _0x3397f7=users['Portuguese'];else{if(_0x87eed7[0x0][_0x5d21a4(0x14c)]==_0x5d21a4(0x1b6))var _0x3397f7=users[_0x5d21a4(0x1b6)];else{if(_0x87eed7[0x0][_0x5d21a4(0x14c)]==_0x5d21a4(0x1cf))var _0x3397f7=users['Arabic'];}}}}}}}_0x1e4b17[_0x5d21a4(0xfd)](_0x5d21a4(0x1b2),{'success':_0x22ebc8[_0x5d21a4(0x167)](_0x5d21a4(0x121)),'errors':_0x22ebc8[_0x5d21a4(0x167)](_0x5d21a4(0xf2)),'role':_0x19bf9d,'profile':_0x5370ea,'user':_0x515f96,'stock':_0x464913,'master_shop':_0x87eed7,'product':_0x4149e0,'language':_0x3397f7,'warehouse':_0x4277e0});}catch(_0x1dcdfb){console[_0x5d21a4(0x1aa)](_0x1dcdfb);}}),router[a0_0x2e1a48(0x179)]('/view/return_purchase/:id',auth,async(_0x525501,_0x774752)=>{var _0x12cce4=a0_0x2e1a48;try{const {invoice:_0x97a5a,date:_0x3b262a,warehouse_name:_0xe33452,Room_name:_0x5eae62,product_name:_0x55c639,purchase_quantity:_0x794eef,stocks:_0x260a29,return_qty:_0x21c266,note:_0x437206,level:_0x18e966,isle:_0x3d1471,pallet:_0x27674f,to_warehouse_name:_0x4e741a,to_Room_name:_0x1907ab}=_0x525501[_0x12cce4(0x196)],_0x3232bd=await purchases_finished[_0x12cce4(0x1d7)]({'_id':_0x525501['params']['id']}),_0x11c960=await warehouse['findOne']({'name':_0xe33452,'room':_0x5eae62,'warehouse_category':_0x12cce4(0x1ae)});if(typeof _0x55c639==_0x12cce4(0x127))var _0x2a4f98=[_0x525501[_0x12cce4(0x196)]['product_name']],_0x21f18a=[_0x525501[_0x12cce4(0x196)][_0x12cce4(0xfc)]],_0x3a614c=[_0x525501['body'][_0x12cce4(0x169)]],_0x56534d=[_0x525501[_0x12cce4(0x196)][_0x12cce4(0x1a1)]],_0xf13f11=[_0x525501[_0x12cce4(0x196)][_0x12cce4(0x1c1)]],_0x1aeb9c=[_0x525501[_0x12cce4(0x196)]['product_code_hide']],_0x106114=[_0x525501[_0x12cce4(0x196)][_0x12cce4(0x18d)]],_0x301eb6=[_0x525501[_0x12cce4(0x196)]['secondary_code_hide']];else var _0x2a4f98=[..._0x525501['body'][_0x12cce4(0x1a8)]],_0x21f18a=[..._0x525501['body'][_0x12cce4(0xfc)]],_0x3a614c=[..._0x525501['body'][_0x12cce4(0x169)]],_0x56534d=[..._0x525501[_0x12cce4(0x196)][_0x12cce4(0x1a1)]],_0xf13f11=[..._0x525501[_0x12cce4(0x196)][_0x12cce4(0x1c1)]],_0x1aeb9c=[..._0x525501[_0x12cce4(0x196)][_0x12cce4(0x12d)]],_0x106114=[..._0x525501[_0x12cce4(0x196)][_0x12cce4(0x18d)]],_0x301eb6=[..._0x525501[_0x12cce4(0x196)]['secondary_code_hide']];const _0x49be4f=_0x2a4f98[_0x12cce4(0x161)](_0x5a29a3=>{return _0x5a29a3={'product_name':_0x5a29a3};});_0x21f18a[_0x12cce4(0x10d)]((_0x41bc40,_0x199ff5)=>{var _0x240060=_0x12cce4;_0x49be4f[_0x199ff5][_0x240060(0xfc)]=_0x41bc40;}),_0x3a614c[_0x12cce4(0x10d)]((_0x3d74b9,_0x26d1cd)=>{var _0x5e36ba=_0x12cce4;_0x49be4f[_0x26d1cd][_0x5e36ba(0x115)]=_0x3d74b9;}),_0x56534d['forEach']((_0x17f2e2,_0x55c911)=>{var _0x59ba99=_0x12cce4;_0x49be4f[_0x55c911][_0x59ba99(0x1a1)]=_0x17f2e2;}),_0xf13f11[_0x12cce4(0x10d)]((_0x9f941c,_0x589782)=>{var _0x231a68=_0x12cce4;_0x49be4f[_0x589782][_0x231a68(0xfb)]=_0x9f941c;}),_0x1aeb9c[_0x12cce4(0x10d)]((_0x518189,_0x51a5dd)=>{var _0x3bf21c=_0x12cce4;_0x49be4f[_0x51a5dd][_0x3bf21c(0x1bc)]=_0x518189;}),_0x106114[_0x12cce4(0x10d)]((_0x371a1e,_0x26192f)=>{var _0x5e9455=_0x12cce4;_0x49be4f[_0x26192f][_0x5e9455(0x11d)]=_0x371a1e;}),_0x301eb6[_0x12cce4(0x10d)]((_0x34c34b,_0x45ef67)=>{_0x49be4f[_0x45ef67]['secondary_code']=_0x34c34b;}),_0x49be4f[_0x12cce4(0x10d)](_0x2c465c=>{var _0x502f3c=_0x12cce4;console[_0x502f3c(0x1aa)](_0x2c465c);const _0x3b62e3=_0x11c960[_0x502f3c(0x14a)][_0x502f3c(0x161)](_0x463e72=>{var _0x407939=_0x502f3c;_0x463e72[_0x407939(0x1a8)]==_0x2c465c[_0x407939(0x1a8)]&&_0x463e72['bay']==_0x2c465c[_0x407939(0xfb)]&&(console[_0x407939(0x1aa)](parseInt(_0x463e72[_0x407939(0x1b4)])+_0x407939(0x154)+parseInt(_0x2c465c[_0x407939(0x1a1)])),_0x463e72[_0x407939(0x1b4)]=parseInt(_0x463e72[_0x407939(0x1b4)])-parseInt(_0x2c465c[_0x407939(0x1a1)]));});}),await _0x11c960[_0x12cce4(0x1c0)]();var _0x232a76=0x0;_0x49be4f[_0x12cce4(0x10d)](_0x5c8c11=>{var _0x2d37bd=_0x12cce4;(parseInt(_0x5c8c11[_0x2d37bd(0xfc)])<parseInt(_0x5c8c11[_0x2d37bd(0x1a1)])||parseInt(_0x5c8c11['stock_quantity'])<parseInt(_0x5c8c11[_0x2d37bd(0x1a1)]))&&_0x232a76++;});if(_0x232a76!=0x0)return _0x525501[_0x12cce4(0x167)](_0x12cce4(0xf2),_0x12cce4(0x17e)),_0x774752[_0x12cce4(0x10c)](_0x12cce4(0x1be));const _0x780ff4=new purchases_return_finished({'invoice':_0x97a5a,'suppliers':_0x525501['body'][_0x12cce4(0x16b)],'date':_0x3b262a,'warehouse_name':_0xe33452,'return_product':_0x49be4f,'note':_0x437206,'room':_0x5eae62,'to_warehouse_name':_0x4e741a,'to_room':_0x1907ab}),_0x15a28f=await _0x780ff4[_0x12cce4(0x1c0)](),_0x274018=await purchases_return_finished['findOne']({'invoice':_0x97a5a}),_0x36c773=await warehouse[_0x12cce4(0x1d7)]({'name':_0x4e741a,'room':_0x1907ab,'warehouse_category':'Finished\x20Goods'});_0x274018[_0x12cce4(0x19b)][_0x12cce4(0x10d)](_0xf513f=>{var _0x3ecc4a=_0x12cce4,_0x5ec6a0=0x0;const _0x5ece74=_0x36c773[_0x3ecc4a(0x14a)][_0x3ecc4a(0x161)](_0x2ef15c=>{var _0xcfbd47=_0x3ecc4a;console[_0xcfbd47(0x1aa)](_0x2ef15c[_0xcfbd47(0x1a8)]+'=='+_0xf513f[_0xcfbd47(0x1a8)]+'&&'+_0x2ef15c[_0xcfbd47(0xfb)]+'=='+_0xf513f[_0xcfbd47(0xfb)]),_0x2ef15c[_0xcfbd47(0x1a8)]==_0xf513f[_0xcfbd47(0x1a8)]&&_0x2ef15c[_0xcfbd47(0xfb)]==_0xf513f[_0xcfbd47(0xfb)]&&(_0x2ef15c['product_stock']=parseInt(_0x2ef15c[_0xcfbd47(0x1b4)])-parseInt(_0xf513f[_0xcfbd47(0x1a1)]),_0x5ec6a0++);});_0x5ec6a0=='0'&&(_0x36c773[_0x3ecc4a(0x14a)]=_0x36c773[_0x3ecc4a(0x14a)][_0x3ecc4a(0x160)]({'product_name':_0xf513f[_0x3ecc4a(0x1a8)],'product_stock':_0xf513f[_0x3ecc4a(0x1a1)],'primary_code':_0xf513f[_0x3ecc4a(0x11d)],'secondary_code':_0xf513f[_0x3ecc4a(0x10e)],'product_code':_0xf513f['product_code'],'bay':_0xf513f['bay'],'maxProducts':0xf423f}));}),await _0x36c773[_0x12cce4(0x1c0)]();const _0x390c86=await purchases_finished[_0x12cce4(0x1d7)]({'invoice':_0x97a5a});_0x390c86[_0x12cce4(0x13d)]=_0x12cce4(0x15c);const _0x5c93d3=await _0x390c86['save'](),_0x1612f2=new s_payment_data({'invoice':_0x97a5a,'suppliers':_0x525501['body'][_0x12cce4(0x16b)],'reason':_0x12cce4(0x191)});await _0x1612f2[_0x12cce4(0x1c0)]();const _0x33c861=await master_shop[_0x12cce4(0x176)](),_0x4ebccc=await email_settings[_0x12cce4(0x1d7)](),_0x5f1d11=await suppliers[_0x12cce4(0x1d7)]({'name':_0x525501['body'][_0x12cce4(0x16b)]});_0x33c861[0x0]['currency_placement']==0x1?(right_currency=_0x33c861[0x0][_0x12cce4(0x10f)],left_currency=''):(right_currency='',left_currency=_0x33c861[0x0]['currency']);var _0x59c8be=_0x2a4f98,_0x9684fd=_0x56534d,_0x2791f8='',_0x47c330;for(_0x47c330 in _0x59c8be){_0x2791f8+='<tr>'+_0x12cce4(0xfe)+_0x59c8be[_0x47c330]+_0x12cce4(0xee)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x9684fd[_0x47c330]+_0x12cce4(0xee)+_0x12cce4(0x146);}let _0x1c6a73=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x4ebccc['email'],'pass':_0x4ebccc[_0x12cce4(0x1c8)]}}),_0x483e9a={'from':_0x4ebccc['email'],'to':_0x5f1d11[_0x12cce4(0x100)],'subject':_0x12cce4(0x19d),'attachments':[{'filename':_0x12cce4(0x19c),'path':__dirname+_0x12cce4(0x17c)+'/upload/'+_0x33c861[0x0][_0x12cce4(0x15b)],'cid':_0x12cce4(0x1ac)}],'html':_0x12cce4(0x131)+_0x12cce4(0x118)+_0x12cce4(0x19e)+'<div>'+_0x12cce4(0x17f)+_0x12cce4(0x101)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x12cce4(0x18a)+'<div>'+_0x12cce4(0xec)+_0x33c861[0x0][_0x12cce4(0x194)]+_0x12cce4(0x18f)+_0x12cce4(0x18a)+_0x12cce4(0x18a)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x12cce4(0xf4)+'\x20Order\x20Number\x20:\x20'+_0x97a5a+'\x20'+_0x12cce4(0x123)+'\x20Order\x20Date\x20:\x20'+_0x3b262a+'\x20'+_0x12cce4(0xdb)+_0x12cce4(0x136)+'</div>'+_0x12cce4(0x113)+_0x12cce4(0x15f)+_0x12cce4(0x110)+_0x12cce4(0x14f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x12cce4(0x146)+_0x12cce4(0x15e)+_0x12cce4(0xf8)+'\x20'+_0x2791f8+'\x20'+'</tbody>'+_0x12cce4(0x1a6)+'<div>'+_0x12cce4(0x1cb)+_0x12cce4(0x1b5)+_0x33c861[0x0][_0x12cce4(0x194)]+_0x12cce4(0x136)+_0x12cce4(0x18a)+_0x12cce4(0x18a)+_0x12cce4(0x18c)};_0x1c6a73[_0x12cce4(0x17d)](_0x483e9a,function(_0x341528,_0x4084a0){var _0x453963=_0x12cce4;_0x341528?console['log'](_0x453963(0xfa)):console[_0x453963(0x1aa)](_0x453963(0xe3));}),_0x525501[_0x12cce4(0x167)](_0x12cce4(0x121),_0x12cce4(0xff)),_0x774752[_0x12cce4(0x10c)]('/all_purchases_finished/view');}catch(_0x2d3563){_0x774752[_0x12cce4(0x19a)](0xc8)['json']({'message':_0x2d3563['message']});}}),router[a0_0x2e1a48(0x128)](a0_0x2e1a48(0x1a7),auth,async(_0x46f043,_0x49a73c)=>{var _0x1eaca4=a0_0x2e1a48;try{const {username:_0x3b66eb,email:_0x4277ea,role:_0xd66bc2}=_0x46f043[_0x1eaca4(0x124)],_0x50324b=_0x46f043[_0x1eaca4(0x124)],_0x368eab=await profile['findOne']({'email':_0x50324b[_0x1eaca4(0x100)]}),_0x1d9943=await master_shop['find'](),_0x2f1dfd=_0x46f043[_0x1eaca4(0xdc)]['id'],_0x15f464=await purchases_finished['findById'](_0x2f1dfd);if(_0x1d9943[0x0][_0x1eaca4(0x14c)]==_0x1eaca4(0xde))var _0x4b1e4e=users['English'];else{if(_0x1d9943[0x0][_0x1eaca4(0x14c)]==_0x1eaca4(0xe7))var _0x4b1e4e=users[_0x1eaca4(0xe7)];else{if(_0x1d9943[0x0]['language']==_0x1eaca4(0x163))var _0x4b1e4e=users[_0x1eaca4(0x163)];else{if(_0x1d9943[0x0][_0x1eaca4(0x14c)]==_0x1eaca4(0x150))var _0x4b1e4e=users[_0x1eaca4(0x150)];else{if(_0x1d9943[0x0][_0x1eaca4(0x14c)]==_0x1eaca4(0x172))var _0x4b1e4e=users['French'];else{if(_0x1d9943[0x0]['language']==_0x1eaca4(0xf0))var _0x4b1e4e=users[_0x1eaca4(0x1d4)];else{if(_0x1d9943[0x0]['language']=='Chinese')var _0x4b1e4e=users['Chinese'];else{if(_0x1d9943[0x0][_0x1eaca4(0x14c)]==_0x1eaca4(0x1cf))var _0x4b1e4e=users['Arabic'];}}}}}}}_0x49a73c[_0x1eaca4(0xfd)](_0x1eaca4(0xe1),{'success':_0x46f043[_0x1eaca4(0x167)](_0x1eaca4(0x121)),'errors':_0x46f043[_0x1eaca4(0x167)]('errors'),'role':_0x50324b,'profile':_0x368eab,'alldata':_0x15f464,'master_shop':_0x1d9943,'language':_0x4b1e4e}),console[_0x1eaca4(0x1aa)](alldata);}catch(_0x24d1a4){console[_0x1eaca4(0x1aa)](_0x24d1a4);}}),router[a0_0x2e1a48(0x179)]('/barcode_scanner',async(_0x27d30b,_0x21280e)=>{var _0x498a1e=a0_0x2e1a48;const {product_code:_0x47bb58}=_0x27d30b[_0x498a1e(0x196)];var _0x1e761e;const _0x2e5bd7=await product[_0x498a1e(0x1bb)]([{'$match':{'primary_code':_0x47bb58,'product_category':_0x498a1e(0x1ae)}},{'$group':{'_id':_0x498a1e(0x153),'name':{'$first':_0x498a1e(0xdd)},'category':{'$first':'$category'},'brand':{'$first':_0x498a1e(0x145)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x498a1e(0x168)},'product_code':{'$first':_0x498a1e(0x11b)},'primary_code':{'$first':_0x498a1e(0x17a)},'secondary_code':{'$first':_0x498a1e(0x175)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x498a1e(0xf6)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x498a1e(0x197)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1107f6=await product[_0x498a1e(0x1bb)]([{'$match':{'secondary_code':_0x47bb58}},{'$group':{'_id':_0x498a1e(0x153),'name':{'$first':_0x498a1e(0xdd)},'category':{'$first':'$category'},'brand':{'$first':_0x498a1e(0x145)},'unit':{'$first':_0x498a1e(0x158)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x498a1e(0x17a)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x498a1e(0xed)},'maxProdPerUnit':{'$first':_0x498a1e(0xf6)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x498a1e(0x197)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2e5bd7['length']>0x0)_0x1e761e=_0x2e5bd7;else _0x1107f6[_0x498a1e(0x16d)]>0x0&&(_0x1e761e=_0x1107f6);_0x21280e[_0x498a1e(0x1b8)](_0x1e761e);}),router[a0_0x2e1a48(0x179)](a0_0x2e1a48(0x1ce),async(_0x59c678,_0x337801)=>{var _0x21f097=a0_0x2e1a48;const {productCode:_0x5f5ca2,bay:_0x424afa,warehouses:_0x480135,room:_0x3c7893}=_0x59c678[_0x21f097(0x196)];console[_0x21f097(0x1aa)](_0x59c678[_0x21f097(0x196)]);try{const _0x53f1ba=await warehouse[_0x21f097(0x1bb)]([{'$match':{'name':_0x480135,'room':_0x3c7893}},{'$unwind':_0x21f097(0x116)},{'$match':{'product_details.bay':parseInt(_0x424afa)}},{'$group':{'_id':_0x21f097(0x1bf),'name':{'$first':_0x21f097(0xda)},'product_stock':{'$first':_0x21f097(0x1ca)},'bay':{'$first':_0x21f097(0x173)},'maxProducts':{'$first':_0x21f097(0xe6)}}}]);_0x337801['status'](0xc8)[_0x21f097(0x1b8)](_0x53f1ba);}catch(_0x299d1e){_0x337801[_0x21f097(0x19a)](0x194)[_0x21f097(0x1b8)]({'message':_0x299d1e[_0x21f097(0xe2)]});}}),module[a0_0x2e1a48(0x103)]=router;