var a0_0x55ffb0=a0_0x79a3;function a0_0x58df(){var _0x28e373=['$product_details.product_name','stocks','render','<!DOCTYPE\x20html>','product_details','$batch_code','/preview/:id','Arabic\x20(ae)','prod_Qty','$product_code','$secondary_unit','amount','$product_details.storage','maxStocks','/give_payment/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','table\x20page','purchase_quantity','product_cat','return_qty','prod_cat','/upload/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','English','slice','68013KUcDVj','forEach','$product.type','Purchase\x20Return\x20Mail','$maxProdPerUnit','batch_code','random','MaxStocks_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Ambient','<div>','add_purchases_finished','English\x20(US)','currency','product_name','spicemix_spmx_qty','Return\x20Goods','room_spmx','Error\x20occurred\x20while\x20processing\x20product:','1524BLOrCn','flash','</span>','site_title','body','SPMX','purchase_invoice','save','catch','add_purchases_finished_spmx','\x20Order\x20Date\x20:\x20','stock_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','express','production_date','../middleware/auth','$product_details.primary_code','<html><head><title></title>','params','602238rvoTrC','1266RNLVmQ','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','createTransport','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</div>','edit_purchases_finished','Rack\x201','1395935VyEsbs','secondary_code_hide','<span\x20style=\x22float:\x20right;\x22>','padStart','exports','length','$_id','QA\x20Warehouse','$return_data','$note','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<strong>\x20Regards\x20</strong>','purchase\x20data\x20add\x20successfully','json','success','$product_details.maxProducts','$primary_code','</h5>','Spanish','abs','Hindi','filter','10PHZlVK','$name','$room','all_purchases_barcode','extender_spmx_qty','extender_spmx','all_purchases_finished_spmx','room_name','</thead>','Portuguese\x20(BR)','36BAeJDu','$product_details.product_code','prod_unit','due_amount','post','category_spmx','curing_spmx_qty','expiry_date','DRY\x20GOODS','map','</td>','log','\x20<>\x20','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_date','message','paid_amount','then','prod_level','</tbody>','prod_primunit','Router','status','$product_details.bin','$product.quantity','room','<h5\x20style=\x22text-align:\x20left;\x22>','$maxStocks','<tr>','Logo.png','$brand','return_product','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Chinese','True','findById','getFullYear','role','Enabled','redirect','INC-','Enclosed','<h5>','$product.curing_spmx','<hr\x20class=\x22my-3\x22>','/view/:id','floor','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','\x20Order\x20Number\x20:\x20','findOne','prod_code','POnumber','logo','warehouse_name','</head><body>','unit_spmx','\x20</h2>','return_data','Paid\x20For\x20Purchase','$product.spicemix_spmx','$product.product_code','$product_details.bay','prod_qty','password','purchase\x20data\x20update\x20successfully','master','/all_purchases/view','$category','2560293bSoqOV','INCF-','product_stock','toString','$product.bay','/../public','extenders_spmx','curing_spmx','view_purchases_finished_spmx','Arabic','error','connect-flash','$product_details.product_stock','purchases\x20item\x20return\x20successfull','level','bay','$suppliers','spicemix_spmx','image','</tr>','path','$product_details.rack','$product.room_name','max_product_unit','secondary_unit','string','concat','suppliers','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','sendMail','$invoice','/all_purchases_finished/view','email','../models/all_models','$product_details','/view/add_purchases_spmx','prod_secondunit','/barcode_scanner','payment\x20successfull','Finished\x20Goods','</table>','secondary_code','French','Purchase\x20Return','/view/return_purchase/:id','date','$product.extenders_spmx','An\x20error\x20occurred\x20while\x20saving\x20data.','updateOne','standard_unit','/CheckingWarehouse','Room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','primary_code_hide','German','quantity','JO_number','errors','$product.extenders_spmx_qty','$product.bin','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product','warehouse','$product_details._id','stock_quantity','../public/language/languages.json','/view','/view_spmx','Email\x20sent\x20successfully','$date','user','_id','231034yiFuTO','$warehouse_name','$product','prod_invoice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','8vTMTaC','$due_amount','primary_code','staff','$product_details.floorlevel','FROZEN\x20GOODS','Error\x20Occurs','user_id','aggregate','2208QYwonE','maxperunit','host','/invoice/:id','$suppliers_docs','RoomAssign','extenders_spmx_qty','date_data','get','prod_name','Portuguese','/view/add_purchases','all_purchases_finished','getDate','getMonth','back','FGSEmail','$unit','</body></html>','return_purchase_finished','port','invoice_init','brand_spmx','$product.spicemix_spmx_qty','/view_purchases_spmx/:id','$expiry_date','product_code','note','3018432KuOAsn','language'];a0_0x58df=function(){return _0x28e373;};return a0_0x58df();}(function(_0x4ae984,_0x3e329c){var _0xac2cbb=a0_0x79a3,_0x5a4fd1=_0x4ae984();while(!![]){try{var _0x296d67=parseInt(_0xac2cbb(0x184))/0x1+parseInt(_0xac2cbb(0xb9))/0x2*(-parseInt(_0xac2cbb(0xcd))/0x3)+parseInt(_0xac2cbb(0x189))/0x4*(-parseInt(_0xac2cbb(0xd5))/0x5)+-parseInt(_0xac2cbb(0xf5))/0x6*(-parseInt(_0xac2cbb(0xcc))/0x7)+-parseInt(_0xac2cbb(0x8b))/0x8+-parseInt(_0xac2cbb(0x13c))/0x9*(parseInt(_0xac2cbb(0xeb))/0xa)+parseInt(_0xac2cbb(0xa6))/0xb*(parseInt(_0xac2cbb(0x192))/0xc);if(_0x296d67===_0x3e329c)break;else _0x5a4fd1['push'](_0x5a4fd1['shift']());}catch(_0x2437de){_0x5a4fd1['push'](_0x5a4fd1['shift']());}}}(a0_0x58df,0x53c97));function a0_0x79a3(_0x2e7eea,_0x1b4ed6){var _0x58dfd7=a0_0x58df();return a0_0x79a3=function(_0x79a393,_0x3b3416){_0x79a393=_0x79a393-0x88;var _0x2808c7=_0x58dfd7[_0x79a393];return _0x2808c7;},a0_0x79a3(_0x2e7eea,_0x1b4ed6);}const express=require(a0_0x55ffb0(0xc6)),app=express(),router=express[a0_0x55ffb0(0x10a)](),{profile,master_shop,purchases_spmx,invoice_for_incoming,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x55ffb0(0x15d)),auth=require(a0_0x55ffb0(0xc8)),nodemailer=require('nodemailer');var ejs=require('ejs');const path=require(a0_0x55ffb0(0x150)),users=require(a0_0x55ffb0(0x17d)),e=require(a0_0x55ffb0(0x147));router[a0_0x55ffb0(0x19a)](a0_0x55ffb0(0x17f),auth,async(_0xc6a74b,_0x3ebc5a)=>{var _0x4e0e21=a0_0x55ffb0;try{const {username:_0x1460fc,email:_0x56e395,role:_0x5d20f2}=_0xc6a74b[_0x4e0e21(0x182)],_0x11d318=_0xc6a74b[_0x4e0e21(0x182)],_0x4cb578=await profile['findOne']({'email':_0x11d318[_0x4e0e21(0x15c)]}),_0x1a93fa=await staff[_0x4e0e21(0x129)]({'email':_0x11d318['email']});if(_0x11d318[_0x4e0e21(0x11c)]=='staff'){const _0x1e49ea=await staff[_0x4e0e21(0x129)]({'email':_0x11d318[_0x4e0e21(0x15c)]});}const _0x19340f=await master_shop[_0x4e0e21(0x126)](),_0x1160a8=await purchases_spmx[_0x4e0e21(0x191)]([{'$unwind':'$product'},{'$group':{'_id':_0x4e0e21(0xdb),'invoice':{'$first':_0x4e0e21(0x15a)},'date':{'$first':_0x4e0e21(0x181)},'warehouse_name':{'$first':_0x4e0e21(0x185)},'room_spmx':{'$addToSet':'$product.room_spmx'},'product':{'$push':_0x4e0e21(0x186)},'note':{'$first':_0x4e0e21(0xde)},'spicemix_spmx_qty':{'$sum':_0x4e0e21(0x1a9)},'extenders_spmx_qty':{'$sum':_0x4e0e21(0x176)},'curing_spmx_qty':{'$sum':'$product.curing_spmx_qty'},'spicemix_spmx':{'$addToSet':_0x4e0e21(0x133)},'extenders_spmx':{'$addToSet':_0x4e0e21(0x16a)},'curing_spmx':{'$addToSet':_0x4e0e21(0x122)},'product_code':{'$addToSet':_0x4e0e21(0x134)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'warehouse_name':0x1,'room_spmx':0x1,'product':0x1,'note':0x1,'spicemix_spmx_qty':0x1,'extenders_spmx_qty':0x1,'curing_spmx_qty':0x1,'spicemix_spmx':0x1,'extenders_spmx':0x1,'curing_spmx':0x1,'product_code':0x1}}]);if(_0x19340f[0x0][_0x4e0e21(0x8c)]==_0x4e0e21(0xb2))var _0x37a42c=users[_0x4e0e21(0xa4)];else{if(_0x19340f[0x0][_0x4e0e21(0x8c)]==_0x4e0e21(0xe9))var _0x37a42c=users[_0x4e0e21(0xe9)];else{if(_0x19340f[0x0]['language']=='German')var _0x37a42c=users[_0x4e0e21(0x172)];else{if(_0x19340f[0x0][_0x4e0e21(0x8c)]==_0x4e0e21(0xe7))var _0x37a42c=users[_0x4e0e21(0xe7)];else{if(_0x19340f[0x0][_0x4e0e21(0x8c)]==_0x4e0e21(0x166))var _0x37a42c=users[_0x4e0e21(0x166)];else{if(_0x19340f[0x0][_0x4e0e21(0x8c)]==_0x4e0e21(0xf4))var _0x37a42c=users[_0x4e0e21(0x19c)];else{if(_0x19340f[0x0][_0x4e0e21(0x8c)]=='Chinese')var _0x37a42c=users['Chinese'];else{if(_0x19340f[0x0]['language']=='Arabic\x20(ae)')var _0x37a42c=users[_0x4e0e21(0x145)];}}}}}}}_0x3ebc5a[_0x4e0e21(0x8f)](_0x4e0e21(0xf1),{'success':_0xc6a74b[_0x4e0e21(0xba)]('success'),'errors':_0xc6a74b[_0x4e0e21(0xba)](_0x4e0e21(0x175)),'purchases':_0x1160a8,'role':_0x11d318,'profile':_0x4cb578,'master_shop':_0x19340f,'language':_0x37a42c});}catch(_0x20edd5){console[_0x4e0e21(0x100)](_0x4e0e21(0x9d),_0x20edd5),_0x3ebc5a[_0x4e0e21(0x10b)](0xc8)[_0x4e0e21(0xe2)]({'message':_0x20edd5['message']});}}),router['get'](a0_0x55ffb0(0x15f),auth,async(_0x1916aa,_0x2bcfc9)=>{var _0x33de1e=a0_0x55ffb0;try{const {username:_0x48477a,email:_0x54856b,role:_0x7a166a}=_0x1916aa[_0x33de1e(0x182)],_0x9247ae=_0x1916aa['user'],_0x27f55d=await profile[_0x33de1e(0x129)]({'email':_0x9247ae['email']}),_0x11dfb6=await master_shop[_0x33de1e(0x126)](),_0x7c787a=await staff['findOne']({'email':_0x9247ae[_0x33de1e(0x15c)]}),_0x434f56=await suppliers[_0x33de1e(0x126)]({}),_0x472611=await warehouse['aggregate']([{'$match':{'status':_0x33de1e(0x11d),'warehouse_category':'SPMX','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x33de1e(0xec)}}}]),_0x37da6b=await product['find']({}),_0x3f8235=await warehouse[_0x33de1e(0x126)]({'status':'Enabled'}),_0x5aa59a=await purchases_finished[_0x33de1e(0x126)]({}),_0x486567=_0x5aa59a[_0x33de1e(0xda)]+0x1,_0x15c704=_0x33de1e(0x13d)+_0x486567[_0x33de1e(0x13f)]()[_0x33de1e(0xd8)](0x5,'0');var _0xc89e2d=[_0x33de1e(0xaf),_0x33de1e(0x120)];if(_0x11dfb6[0x0][_0x33de1e(0x8c)]==_0x33de1e(0xb2))var _0x224e40=users[_0x33de1e(0xa4)];else{if(_0x11dfb6[0x0]['language']==_0x33de1e(0xe9))var _0x224e40=users[_0x33de1e(0xe9)];else{if(_0x11dfb6[0x0][_0x33de1e(0x8c)]=='German')var _0x224e40=users[_0x33de1e(0x172)];else{if(_0x11dfb6[0x0]['language']==_0x33de1e(0xe7))var _0x224e40=users[_0x33de1e(0xe7)];else{if(_0x11dfb6[0x0][_0x33de1e(0x8c)]==_0x33de1e(0x166))var _0x224e40=users[_0x33de1e(0x166)];else{if(_0x11dfb6[0x0][_0x33de1e(0x8c)]=='Portuguese\x20(BR)')var _0x224e40=users[_0x33de1e(0x19c)];else{if(_0x11dfb6[0x0][_0x33de1e(0x8c)]=='Chinese')var _0x224e40=users[_0x33de1e(0x118)];else{if(_0x11dfb6[0x0]['language']==_0x33de1e(0x94))var _0x224e40=users[_0x33de1e(0x145)];}}}}}}}const _0x42bff2=getRandom8DigitNumber();_0x42bff2[_0x33de1e(0x106)](_0x1b9edc=>{var _0x10a188=_0x33de1e;_0x2bcfc9[_0x10a188(0x8f)](_0x10a188(0xc2),{'success':_0x1916aa['flash'](_0x10a188(0xe3)),'errors':_0x1916aa[_0x10a188(0xba)]('errors'),'role':_0x9247ae,'profile':_0x27f55d,'suppliers':_0x434f56,'warehouse':_0x472611,'product':_0x37da6b,'invoice':_0x1b9edc,'master_shop':_0x11dfb6,'language':_0x224e40,'find_data':_0x3f8235,'rooms_data':_0xc89e2d});})[_0x33de1e(0xc1)](_0x54a3e9=>{var _0x2f5b87=_0x33de1e;_0x1916aa['flash'](_0x2f5b87(0x175),_0x2f5b87(0x188)),_0x2bcfc9[_0x2f5b87(0x11e)](_0x2f5b87(0x15b));});}catch(_0x209885){console['log'](_0x209885);}}),router[a0_0x55ffb0(0xf9)]('/view/add_purchases_spmx',auth,async(_0x50f7d7,_0x373a08)=>{var _0x2e06bc=a0_0x55ffb0;try{const {date:_0x51051a,warehouse_name:_0xdceecf,room_name:_0x447461,SCRN:_0x3c9ec6,PO_number:_0x5ec114,prod_code:_0x4d83a0,note:_0x5d9bf3}=_0x50f7d7[_0x2e06bc(0xbd)];if(typeof _0x4d83a0==_0x2e06bc(0x155))var _0xc5bb30=[_0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0x12a)]],_0xc5c658=[_0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0x14d)]],_0x362ca8=[_0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0xb5)]],_0x307ed5=[_0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0xf0)]],_0x383404=[_0x50f7d7['body'][_0x2e06bc(0xef)]],_0xe722b0=[_0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0x143)]],_0x5914a9=[_0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0xfb)]],_0x4ed7b2=[_0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0x12f)]],_0x490779=[_0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0x1a8)]],_0x1e11ec=[_0x50f7d7[_0x2e06bc(0xbd)]['category_spmx']],_0x13741a=[_0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0xb7)]];else var _0xc5bb30=[..._0x50f7d7['body'][_0x2e06bc(0x12a)]],_0xc5c658=[..._0x50f7d7['body']['spicemix_spmx']],_0x362ca8=[..._0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0xb5)]],_0x307ed5=[..._0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0x142)]],_0x383404=[..._0x50f7d7['body'][_0x2e06bc(0x198)]],_0xe722b0=[..._0x50f7d7[_0x2e06bc(0xbd)][_0x2e06bc(0x143)]],_0x5914a9=[..._0x50f7d7[_0x2e06bc(0xbd)]['curing_spmx_qty']],_0x4ed7b2=[..._0x50f7d7[_0x2e06bc(0xbd)]['unit_spmx']],_0x490779=[..._0x50f7d7[_0x2e06bc(0xbd)]['brand_spmx']],_0x1e11ec=[..._0x50f7d7['body'][_0x2e06bc(0xfa)]],_0x13741a=[..._0x50f7d7['body'][_0x2e06bc(0xb7)]];const _0x17eb11=_0xc5bb30[_0x2e06bc(0xfe)](_0x3d42f3=>{return _0x3d42f3={'product_code':_0x3d42f3};});_0xc5c658[_0x2e06bc(0xa7)]((_0x58daa2,_0x3fbb5)=>{var _0x38ae55=_0x2e06bc;_0x17eb11[_0x3fbb5][_0x38ae55(0x14d)]=_0x58daa2;}),_0x362ca8[_0x2e06bc(0xa7)]((_0x562bc9,_0x48481d)=>{_0x17eb11[_0x48481d]['spicemix_spmx_qty']=_0x562bc9;}),_0x307ed5['forEach']((_0x40de44,_0x2ad10a)=>{var _0x5c7010=_0x2e06bc;_0x17eb11[_0x2ad10a][_0x5c7010(0x142)]=_0x40de44;}),_0x383404[_0x2e06bc(0xa7)]((_0xd8c26,_0x128c42)=>{var _0x18920a=_0x2e06bc;_0x17eb11[_0x128c42][_0x18920a(0x198)]=_0xd8c26;}),_0xe722b0[_0x2e06bc(0xa7)]((_0x203666,_0x4f4ea6)=>{var _0x5057a3=_0x2e06bc;_0x17eb11[_0x4f4ea6][_0x5057a3(0x143)]=_0x203666;}),_0x5914a9[_0x2e06bc(0xa7)]((_0x2df3e2,_0x22e901)=>{var _0x5d62aa=_0x2e06bc;_0x17eb11[_0x22e901][_0x5d62aa(0xfb)]=_0x2df3e2;}),_0x4ed7b2[_0x2e06bc(0xa7)]((_0x202845,_0x3133bf)=>{_0x17eb11[_0x3133bf]['unit_spmx']=_0x202845;}),_0x490779['forEach']((_0x4e4977,_0x34d39e)=>{var _0x44b56b=_0x2e06bc;_0x17eb11[_0x34d39e][_0x44b56b(0x1a8)]=_0x4e4977;}),_0x1e11ec['forEach']((_0x2cea3b,_0x5e76c0)=>{var _0xe32ba9=_0x2e06bc;_0x17eb11[_0x5e76c0][_0xe32ba9(0xfa)]=_0x2cea3b;}),_0x13741a['forEach']((_0x1172fc,_0x2ecb1b)=>{var _0x498242=_0x2e06bc;_0x17eb11[_0x2ecb1b][_0x498242(0xb7)]=_0x1172fc;});const _0x396d0a=new invoice_for_incoming();await _0x396d0a['save']();const _0x42f893=new purchases_spmx({'invoice':_0x2e06bc(0x11f)+_0x396d0a[_0x2e06bc(0x1a7)][_0x2e06bc(0x13f)]()[_0x2e06bc(0xd8)](0x8,'0'),'date':_0x51051a,'warehouse_name':_0xdceecf,'product':_0x17eb11,'note':_0x5d9bf3,'room':_0x447461,'POnumber':_0x5ec114,'SCRN':_0x3c9ec6}),_0x16e46a=await _0x42f893[_0x2e06bc(0xc0)](),_0x5ecf31=await purchases_spmx[_0x2e06bc(0x11a)](_0x16e46a['_id']);_0x5ecf31[_0x2e06bc(0x179)]['forEach'](async _0x169f93=>{var _0x5b3934=_0x2e06bc;const _0x26391e=_0x169f93[_0x5b3934(0x89)],_0x4dfc8f=_0x169f93[_0x5b3934(0x14d)],_0x161067=_0x169f93[_0x5b3934(0xb5)],_0x490a7e=_0x169f93[_0x5b3934(0x142)],_0x33bf12=_0x169f93[_0x5b3934(0x198)],_0xf29a98=_0x169f93['curing_spmx'],_0x221107=_0x169f93[_0x5b3934(0xfb)],_0x1d8ab2=_0x169f93[_0x5b3934(0x12f)],_0x743988=_0x169f93[_0x5b3934(0x1a8)],_0x50f2b8=_0x169f93[_0x5b3934(0xfa)],_0x74181c=_0x169f93[_0x5b3934(0xb7)],_0x24379a=_0x5ecf31[_0x5b3934(0x116)],_0x23d92d=_0x5ecf31[_0x5b3934(0x183)]['toString']()+'~'+_0x169f93[_0x5b3934(0x183)][_0x5b3934(0x13f)]();await warehouse[_0x5b3934(0x16c)]({'name':_0xdceecf,'room':_0x74181c},{'$push':{'product_details_spmx':{'product_code':_0x26391e,'spicemix_spmx':_0x4dfc8f,'spicemix_spmx_qty':_0x161067,'extenders_spmx':_0x490a7e,'extenders_spmx_qty':_0x33bf12,'curing_spmx':_0xf29a98,'curing_spmx_qty':_0x221107,'unit_spmx':_0x1d8ab2,'brand_spmx':_0x743988,'category_spmx':_0x50f2b8,'inv_incoming':_0x24379a,'id_incoming':_0x23d92d}}});}),_0x50f7d7[_0x2e06bc(0xba)]('success','Incoming\x20Successfully\x20Added'),_0x373a08['redirect']('/all_purchases_finished/view_purchases_spmx/'+_0x16e46a['_id']);}catch(_0x54106e){console['log'](_0x54106e);}}),router[a0_0x55ffb0(0x19a)](a0_0x55ffb0(0x1aa),auth,async(_0x484f23,_0xc7ea38)=>{var _0x534eb7=a0_0x55ffb0;try{const _0x5b9e1f=_0x484f23['params']['id'],_0x20e424=await purchases_spmx['findById'](_0x5b9e1f),_0x2796d7=await master_shop[_0x534eb7(0x126)](),_0x449657=_0x484f23[_0x534eb7(0x182)],_0x1982f4=await profile[_0x534eb7(0x129)]({'email':_0x449657[_0x534eb7(0x15c)]}),_0x25f186=await staff[_0x534eb7(0x129)]({'email':_0x449657['email']});if(_0x2796d7[0x0][_0x534eb7(0x8c)]==_0x534eb7(0xb2))var _0x2e5f52=users[_0x534eb7(0xa4)];else{if(_0x2796d7[0x0][_0x534eb7(0x8c)]=='Hindi')var _0x2e5f52=users[_0x534eb7(0xe9)];else{if(_0x2796d7[0x0]['language']==_0x534eb7(0x172))var _0x2e5f52=users['German'];else{if(_0x2796d7[0x0][_0x534eb7(0x8c)]==_0x534eb7(0xe7))var _0x2e5f52=users[_0x534eb7(0xe7)];else{if(_0x2796d7[0x0][_0x534eb7(0x8c)]==_0x534eb7(0x166))var _0x2e5f52=users['French'];else{if(_0x2796d7[0x0]['language']=='Portuguese\x20(BR)')var _0x2e5f52=users[_0x534eb7(0x19c)];else{if(_0x2796d7[0x0][_0x534eb7(0x8c)]=='Chinese')var _0x2e5f52=users['Chinese'];else{if(_0x2796d7[0x0]['language']=='Arabic\x20(ae)')var _0x2e5f52=users[_0x534eb7(0x145)];}}}}}}}_0xc7ea38[_0x534eb7(0x8f)](_0x534eb7(0x144),{'success':_0x484f23[_0x534eb7(0xba)]('success'),'errors':_0x484f23[_0x534eb7(0xba)](_0x534eb7(0x175)),'role':_0x449657,'profile':_0x1982f4,'master_shop':_0x2796d7,'language':_0x2e5f52,'data':_0x20e424});}catch(_0x311903){console['log'](_0x311903);}}),router[a0_0x55ffb0(0x19a)](a0_0x55ffb0(0x17e),auth,async(_0x3f9e99,_0x584f85)=>{var _0x139b2e=a0_0x55ffb0;try{const {username:_0x917390,email:_0x377099,role:_0xe00dae}=_0x3f9e99[_0x139b2e(0x182)],_0x687554=_0x3f9e99[_0x139b2e(0x182)],_0x6ccbb=await profile[_0x139b2e(0x129)]({'email':_0x687554[_0x139b2e(0x15c)]}),_0x841d=await staff[_0x139b2e(0x129)]({'email':_0x687554[_0x139b2e(0x15c)]});if(_0x687554[_0x139b2e(0x11c)]=='staff'){const _0x7d837e=await staff[_0x139b2e(0x129)]({'email':_0x687554[_0x139b2e(0x15c)]});}const _0x10fab3=await master_shop[_0x139b2e(0x126)]();let _0x2cac32;if(_0x687554['role']=='staff'){const _0x1cf9f9=await staff[_0x139b2e(0x129)]({'email':_0x687554['email']});_0x2cac32=await purchases_finished['aggregate']([{'$unwind':_0x139b2e(0x186)},{'$group':{'_id':_0x139b2e(0xdb),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x139b2e(0x14c)},'date':{'$first':_0x139b2e(0x181)},'warehouse_name':{'$first':_0x139b2e(0x185)},'room':{'$first':_0x139b2e(0xed)},'product':{'$push':_0x139b2e(0x186)},'note':{'$first':_0x139b2e(0xde)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x139b2e(0x18a)},'return_data':{'$first':_0x139b2e(0xdd)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x139b2e(0x88)},'suppliers_docs':{'$first':_0x139b2e(0x196)},'total_product_quantity':{'$sum':_0x139b2e(0x10d)},'level':{'$addToSet':_0x139b2e(0x140)},'isle':{'$addToSet':_0x139b2e(0x177)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2cac32=await purchases_finished[_0x139b2e(0x191)]([{'$unwind':_0x139b2e(0x186)},{'$group':{'_id':_0x139b2e(0xdb),'invoice':{'$first':_0x139b2e(0x15a)},'suppliers':{'$first':_0x139b2e(0x14c)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x139b2e(0x185)},'room':{'$addToSet':_0x139b2e(0x152)},'product':{'$push':'$product'},'note':{'$first':_0x139b2e(0xde)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x139b2e(0xdd)},'batch_code':{'$first':_0x139b2e(0x92)},'expiry_date':{'$first':_0x139b2e(0x88)},'suppliers_docs':{'$first':_0x139b2e(0x196)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x139b2e(0x140)},'isle':{'$addToSet':_0x139b2e(0x177)},'type':{'$addToSet':_0x139b2e(0xa8)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x10fab3[0x0][_0x139b2e(0x8c)]=='English\x20(US)')var _0x2855d4=users[_0x139b2e(0xa4)];else{if(_0x10fab3[0x0][_0x139b2e(0x8c)]==_0x139b2e(0xe9))var _0x2855d4=users[_0x139b2e(0xe9)];else{if(_0x10fab3[0x0][_0x139b2e(0x8c)]==_0x139b2e(0x172))var _0x2855d4=users[_0x139b2e(0x172)];else{if(_0x10fab3[0x0]['language']==_0x139b2e(0xe7))var _0x2855d4=users[_0x139b2e(0xe7)];else{if(_0x10fab3[0x0][_0x139b2e(0x8c)]==_0x139b2e(0x166))var _0x2855d4=users[_0x139b2e(0x166)];else{if(_0x10fab3[0x0][_0x139b2e(0x8c)]==_0x139b2e(0xf4))var _0x2855d4=users[_0x139b2e(0x19c)];else{if(_0x10fab3[0x0][_0x139b2e(0x8c)]==_0x139b2e(0x118))var _0x2855d4=users[_0x139b2e(0x118)];else{if(_0x10fab3[0x0]['language']==_0x139b2e(0x94))var _0x2855d4=users[_0x139b2e(0x145)];}}}}}}}_0x584f85['render'](_0x139b2e(0x19e),{'success':_0x3f9e99['flash']('success'),'errors':_0x3f9e99[_0x139b2e(0xba)](_0x139b2e(0x175)),'purchases':_0x2cac32,'role':_0x687554,'profile':_0x6ccbb,'master_shop':_0x10fab3,'language':_0x2855d4});}catch(_0x570406){console[_0x139b2e(0x100)]('table\x20page',_0x570406),_0x584f85[_0x139b2e(0x10b)](0xc8)['json']({'message':_0x570406['message']});}});function BayBinSelected(_0x2e0aa4,_0x34ff55){var _0x23403b=a0_0x55ffb0,_0x4e79ef=[],_0x450954=[];if(_0x2e0aa4=='DRY\x20GOODS'){switch(_0x34ff55){case _0x23403b(0xd4):_0x4e79ef=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x4e79ef=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x450954=['DG'];}else{if(_0x2e0aa4==_0x23403b(0x18e)){switch(_0x34ff55){case'Rack\x201':_0x4e79ef=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x4e79ef=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x450954=['FG'];}}return{'levels':_0x4e79ef,'identify':_0x450954};}async function getRandom8DigitNumber(){var _0x3e9a7f=a0_0x55ffb0;const _0x3f7c9b=0x989680,_0x583bf8=0x5f5e0ff,_0x3836e6=Math[_0x3e9a7f(0x125)](Math[_0x3e9a7f(0xac)]()*(_0x583bf8-_0x3f7c9b+0x1))+_0x3f7c9b;var _0x5b88c1;const _0x1f4391=await purchases_finished[_0x3e9a7f(0x129)]({'invoice':_0x3e9a7f(0x13d)+_0x3836e6});return _0x1f4391&&_0x1f4391[_0x3e9a7f(0xda)]>0x0?_0x5b88c1=_0x3e9a7f(0x13d)+_0x3836e6:_0x5b88c1=_0x3e9a7f(0x13d)+_0x3836e6,_0x5b88c1;}router['get'](a0_0x55ffb0(0x19d),auth,async(_0x390569,_0x13c56b)=>{var _0x400fb1=a0_0x55ffb0;try{const {username:_0x4a167c,email:_0x58d286,role:_0x44284b}=_0x390569[_0x400fb1(0x182)],_0x194c75=_0x390569[_0x400fb1(0x182)],_0x3ec929=await profile[_0x400fb1(0x129)]({'email':_0x194c75[_0x400fb1(0x15c)]}),_0x43f693=await master_shop[_0x400fb1(0x126)](),_0x424254=await staff[_0x400fb1(0x129)]({'email':_0x194c75['email']}),_0x198a83=await suppliers['find']({});let _0x2ccbd5;if(_0x194c75['role']==_0x400fb1(0x18c)){const _0xc4d2fc=await staff[_0x400fb1(0x129)]({'email':_0x194c75[_0x400fb1(0x15c)]});_0x2ccbd5=await warehouse[_0x400fb1(0x191)]([{'$match':{'status':'Enabled','name':_0xc4d2fc[_0x400fb1(0x17a)],'warehouse_category':_0x400fb1(0x163)}},{'$group':{'_id':'$name','name':{'$first':_0x400fb1(0xec)}}}]);}else _0x2ccbd5=await warehouse[_0x400fb1(0x191)]([{'$match':{'status':_0x400fb1(0x11d),'warehouse_category':_0x400fb1(0x163),'name':{'$ne':_0x400fb1(0xdc)}}},{'$group':{'_id':'$name','name':{'$first':_0x400fb1(0xec)}}}]);const _0x39d761=await product[_0x400fb1(0x126)]({}),_0x4c02ef=await warehouse[_0x400fb1(0x126)]({'status':_0x400fb1(0x11d)}),_0x2ed5d0=await purchases_finished[_0x400fb1(0x126)]({}),_0x4187ee=_0x2ed5d0[_0x400fb1(0xda)]+0x1,_0x4ca765=_0x400fb1(0x13d)+_0x4187ee[_0x400fb1(0x13f)]()[_0x400fb1(0xd8)](0x5,'0');var _0x27fae8=[_0x400fb1(0xaf),'Enclosed'];if(_0x43f693[0x0][_0x400fb1(0x8c)]==_0x400fb1(0xb2))var _0x427519=users[_0x400fb1(0xa4)];else{if(_0x43f693[0x0][_0x400fb1(0x8c)]==_0x400fb1(0xe9))var _0x427519=users[_0x400fb1(0xe9)];else{if(_0x43f693[0x0]['language']==_0x400fb1(0x172))var _0x427519=users[_0x400fb1(0x172)];else{if(_0x43f693[0x0]['language']==_0x400fb1(0xe7))var _0x427519=users[_0x400fb1(0xe7)];else{if(_0x43f693[0x0][_0x400fb1(0x8c)]==_0x400fb1(0x166))var _0x427519=users[_0x400fb1(0x166)];else{if(_0x43f693[0x0]['language']=='Portuguese\x20(BR)')var _0x427519=users[_0x400fb1(0x19c)];else{if(_0x43f693[0x0]['language']==_0x400fb1(0x118))var _0x427519=users[_0x400fb1(0x118)];else{if(_0x43f693[0x0][_0x400fb1(0x8c)]==_0x400fb1(0x94))var _0x427519=users[_0x400fb1(0x145)];}}}}}}}const _0x6dc4c6=getRandom8DigitNumber();_0x6dc4c6['then'](_0x2b8b46=>{var _0x4bd44d=_0x400fb1;_0x13c56b[_0x4bd44d(0x8f)](_0x4bd44d(0xb1),{'success':_0x390569[_0x4bd44d(0xba)]('success'),'errors':_0x390569[_0x4bd44d(0xba)](_0x4bd44d(0x175)),'role':_0x194c75,'profile':_0x3ec929,'suppliers':_0x198a83,'warehouse':_0x2ccbd5,'product':_0x39d761,'invoice':_0x2b8b46,'master_shop':_0x43f693,'language':_0x427519,'find_data':_0x4c02ef,'rooms_data':_0x27fae8});})[_0x400fb1(0xc1)](_0x33a84c=>{var _0x1a5ca5=_0x400fb1;_0x390569['flash'](_0x1a5ca5(0x175),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x13c56b['redirect'](_0x1a5ca5(0x15b));});}catch(_0x5dd6ce){console[_0x400fb1(0x100)](_0x5dd6ce);}}),router[a0_0x55ffb0(0x19a)]('/view/add_purchases/:id',auth,async(_0x45da04,_0x65c827)=>{var _0x13e29c=a0_0x55ffb0;try{const _0x189104=_0x45da04[_0x13e29c(0xcb)]['id'];console[_0x13e29c(0x100)](_0x189104);const _0x2b0822=await master_shop[_0x13e29c(0x126)]();console[_0x13e29c(0x100)](_0x13e29c(0x139),_0x2b0822);const _0x36ff9f=await product[_0x13e29c(0x129)]({'name':_0x189104});console['log'](_0x13e29c(0x179),_0x36ff9f),_0x65c827[_0x13e29c(0x10b)](0xc8)[_0x13e29c(0xe2)]({'product_data':_0x36ff9f,'master':_0x2b0822});}catch(_0x35915d){console['log']('add_purchases\x20error',_0x35915d);}}),router[a0_0x55ffb0(0xf9)](a0_0x55ffb0(0x19d),auth,async(_0x122569,_0x64f479)=>{var _0xea0691=a0_0x55ffb0;try{const {invoice:_0x42b4d7,date:_0x5d7270,warehouse_name:_0x31f25b,prod_name:_0x31ba47,prod_code:_0x220ecc,prod_qty:_0x5bbc7c,prod_unit:_0x2c781f,prod_secondunit:_0x2347e0,prod_level:_0x306b9f,prod_isle:_0x2fcd1c,prod_pallet:_0x156f85,note:_0x51e64e,expiry_date:_0xc79138,batch_code:_0x3d2ee1,payable:_0x32e291,due_amount:_0x1a10de,Room_name:_0x166d74,primary_code:_0x3154ee,secondary_code:_0x36f02f,MaxStocks_data:_0x2957db,PO_number:_0x3d7468,SCRN:_0x4b4b61,JO_number:_0x50bbb7}=_0x122569[_0xea0691(0xbd)];if(typeof _0x31ba47==_0xea0691(0x155))var _0x208d7e=[_0x122569[_0xea0691(0xbd)]['prod_name']],_0x403191=[_0x122569[_0xea0691(0xbd)][_0xea0691(0x12a)]],_0x3521a8=[_0x122569[_0xea0691(0xbd)][_0xea0691(0x95)]],_0x1057ce=[_0x122569[_0xea0691(0xbd)][_0xea0691(0x109)]],_0x23a43e=[_0x122569[_0xea0691(0xbd)][_0xea0691(0x160)]],_0x3e5e5f=[_0x122569[_0xea0691(0xbd)][_0xea0691(0x107)]],_0x4818d2=[_0x122569[_0xea0691(0xbd)]['primary_code']],_0x4f37d8=[_0x122569[_0xea0691(0xbd)]['secondary_code']],_0x22666c=[_0x122569[_0xea0691(0xbd)][_0xea0691(0xad)]],_0x6aa488=[_0x122569[_0xea0691(0xbd)][_0xea0691(0xab)]],_0x5db48d=[_0x122569['body'][_0xea0691(0xfc)]],_0x3af19b=[_0x122569[_0xea0691(0xbd)][_0xea0691(0x103)]],_0x5b4bf0=[_0x122569[_0xea0691(0xbd)][_0xea0691(0x153)]],_0x5991eb=[_0x122569[_0xea0691(0xbd)][_0xea0691(0xa1)]],_0x4c1505=[_0x122569[_0xea0691(0xbd)][_0xea0691(0x197)]],_0x1d96c5=[_0x122569[_0xea0691(0xbd)][_0xea0691(0x187)]];else var _0x208d7e=[..._0x122569[_0xea0691(0xbd)]['prod_name']],_0x403191=[..._0x122569[_0xea0691(0xbd)][_0xea0691(0x12a)]],_0x3521a8=[..._0x122569[_0xea0691(0xbd)]['prod_Qty']],_0x1057ce=[..._0x122569[_0xea0691(0xbd)][_0xea0691(0x109)]],_0x23a43e=[..._0x122569[_0xea0691(0xbd)][_0xea0691(0x160)]],_0x3e5e5f=[..._0x122569[_0xea0691(0xbd)]['prod_level']],_0x4818d2=[..._0x122569[_0xea0691(0xbd)][_0xea0691(0x18b)]],_0x4f37d8=[..._0x122569['body'][_0xea0691(0x165)]],_0x22666c=[..._0x122569['body']['MaxStocks_data']],_0x6aa488=[..._0x122569['body']['batch_code']],_0x5db48d=[..._0x122569[_0xea0691(0xbd)]['expiry_date']],_0x3af19b=[..._0x122569[_0xea0691(0xbd)][_0xea0691(0x103)]],_0x5b4bf0=[..._0x122569['body'][_0xea0691(0x153)]],_0x5991eb=[..._0x122569[_0xea0691(0xbd)]['prod_cat']],_0x4c1505=[..._0x122569[_0xea0691(0xbd)]['RoomAssign']],_0x1d96c5=[..._0x122569[_0xea0691(0xbd)]['prod_invoice']];const _0x5a005e=_0x208d7e[_0xea0691(0xfe)](_0x22900d=>{return _0x22900d={'product_name':_0x22900d};});_0x403191['forEach']((_0x9f1b6a,_0x3ebf26)=>{var _0x37c220=_0xea0691;_0x5a005e[_0x3ebf26][_0x37c220(0x89)]=_0x9f1b6a,_0x5a005e[_0x3ebf26][_0x37c220(0x199)]=_0x5d7270;}),_0x3521a8[_0xea0691(0xa7)]((_0x479e44,_0x4a2a0c)=>{var _0x530d30=_0xea0691;_0x5a005e[_0x4a2a0c][_0x530d30(0x173)]=Math[_0x530d30(0xe8)](_0x479e44);}),_0x1057ce[_0xea0691(0xa7)]((_0x49ed62,_0x28f11c)=>{_0x5a005e[_0x28f11c]['standard_unit']=_0x49ed62;}),_0x23a43e['forEach']((_0x2d3e22,_0x1c74a1)=>{_0x5a005e[_0x1c74a1]['secondary_unit']=_0x2d3e22;}),_0x3e5e5f['forEach']((_0x44cb92,_0x495881)=>{var _0x214027=_0xea0691;_0x5a005e[_0x495881][_0x214027(0x14b)]=_0x44cb92;}),_0x4818d2[_0xea0691(0xa7)]((_0xc93fc6,_0x2f6985)=>{var _0x3d1c9f=_0xea0691;_0x5a005e[_0x2f6985][_0x3d1c9f(0x18b)]=_0xc93fc6;}),_0x4f37d8['forEach']((_0x178f2b,_0x187183)=>{var _0x2e0803=_0xea0691;_0x5a005e[_0x187183][_0x2e0803(0x165)]=_0x178f2b;}),_0x22666c[_0xea0691(0xa7)]((_0x821525,_0x128bea)=>{var _0x8ed92b=_0xea0691;_0x5a005e[_0x128bea][_0x8ed92b(0x9a)]=_0x821525;}),_0x6aa488[_0xea0691(0xa7)]((_0x58e253,_0x197fc8)=>{var _0x3413de=_0xea0691;_0x5a005e[_0x197fc8][_0x3413de(0xab)]=_0x58e253;}),_0x5db48d[_0xea0691(0xa7)]((_0x2d6639,_0x159cbb)=>{var _0x5797a0=_0xea0691;_0x5a005e[_0x159cbb][_0x5797a0(0xfc)]=_0x2d6639;}),_0x3af19b[_0xea0691(0xa7)]((_0x1422da,_0x283df8)=>{_0x5a005e[_0x283df8]['production_date']=_0x1422da;}),_0x5b4bf0['forEach']((_0x4ec2fe,_0x36bbe8)=>{var _0x3131a0=_0xea0691;_0x5a005e[_0x36bbe8][_0x3131a0(0x193)]=_0x4ec2fe;}),_0x5991eb[_0xea0691(0xa7)]((_0x146abb,_0x4dac8c)=>{var _0x5e8f6d=_0xea0691;_0x5a005e[_0x4dac8c][_0x5e8f6d(0x9f)]=_0x146abb;}),_0x4c1505[_0xea0691(0xa7)]((_0x31cae4,_0x3297ff)=>{var _0x3fa791=_0xea0691;_0x5a005e[_0x3297ff][_0x3fa791(0xf2)]=_0x31cae4;}),_0x1d96c5['forEach']((_0x14447a,_0x11100a)=>{var _0x328f70=_0xea0691;_0x5a005e[_0x11100a][_0x328f70(0x116)]=_0x14447a;});const _0x56baa1=_0x5a005e['filter'](_0x3fd7d2=>_0x3fd7d2[_0xea0691(0x173)]!=='0'&&_0x3fd7d2[_0xea0691(0x173)]!==''),_0x3e08ff=new purchases_finished({'invoice':_0x42b4d7,'suppliers':_0x122569[_0xea0691(0xbd)]['suppliers'],'date':_0x5d7270,'warehouse_name':_0x31f25b,'product':_0x56baa1,'note':_0x51e64e,'due_amount':_0x1a10de,'room':_0x166d74,'POnumber':_0x3d7468,'SCRN':_0x4b4b61,'JO_number':_0x50bbb7}),_0x5473ad=await _0x3e08ff[_0xea0691(0xc0)](),_0x48805d=await purchases_finished[_0xea0691(0x129)]({'invoice':_0x42b4d7}),_0x1ec42e=_0x48805d[_0xea0691(0x179)][_0xea0691(0xfe)](async _0x343929=>{var _0x74613c=_0xea0691;try{var _0xdaaea2=await warehouse[_0x74613c(0x129)]({'name':_0x31f25b,'room':_0x343929['room_name']}),_0x35af55=0x0;const _0x416854=_0xdaaea2[_0x74613c(0x91)]['map'](_0x39ba9e=>{var _0x366fcd=_0x74613c;console[_0x366fcd(0x100)](_0x39ba9e['product_name']+'=='+_0x343929['product_name']+'&&'+_0x39ba9e[_0x366fcd(0x14b)]+'=='+_0x343929[_0x366fcd(0x14b)]+'&&'+_0x39ba9e[_0x366fcd(0xfc)]+'=='+_0x343929['expiry_date']+'&&'+_0x39ba9e['production_date']+'=='+_0x343929[_0x366fcd(0xc7)]+'&&'+_0x39ba9e[_0x366fcd(0xab)]+'=='+_0x343929[_0x366fcd(0xab)]+'&&'+_0x39ba9e[_0x366fcd(0x116)]+'=='+_0x48805d[_0x366fcd(0x116)]),_0x39ba9e[_0x366fcd(0xb4)]==_0x343929['product_name']&&_0x39ba9e[_0x366fcd(0x14b)]==_0x343929[_0x366fcd(0x14b)]&&_0x39ba9e['expiry_date']==_0x343929[_0x366fcd(0xfc)]&&_0x39ba9e[_0x366fcd(0xc7)]==_0x343929[_0x366fcd(0xc7)]&&_0x39ba9e[_0x366fcd(0xab)]==_0x343929[_0x366fcd(0xab)]&&_0x39ba9e[_0x366fcd(0x116)]==_0x48805d['invoice']&&(_0x39ba9e[_0x366fcd(0x13e)]=Math['abs'](_0x39ba9e[_0x366fcd(0x13e)])+Math[_0x366fcd(0xe8)](_0x343929['quantity']),_0x35af55++);});return _0x35af55==0x0&&(_0xdaaea2[_0x74613c(0x91)]=_0xdaaea2[_0x74613c(0x91)][_0x74613c(0x156)]({'product_name':_0x343929[_0x74613c(0xb4)],'product_stock':Math[_0x74613c(0xe8)](_0x343929['quantity']),'primary_code':_0x343929[_0x74613c(0x18b)],'secondary_code':_0x343929[_0x74613c(0x165)],'product_code':_0x343929[_0x74613c(0x89)],'bay':_0x343929['bay'],'maxProducts':_0x343929[_0x74613c(0x9a)],'unit':_0x343929['standard_unit'],'secondary_unit':_0x343929['secondary_unit'],'expiry_date':_0x343929[_0x74613c(0xfc)],'production_date':_0x343929[_0x74613c(0xc7)],'maxProducts':_0x343929[_0x74613c(0x9a)],'maxPerUnit':_0x343929['maxperunit'],'batch_code':_0x343929['batch_code'],'product_cat':_0x343929[_0x74613c(0x9f)],'invoice':_0x343929[_0x74613c(0x116)],'id_incoming':_0x343929['_id'],'date_data':_0x343929[_0x74613c(0x199)]})),_0xdaaea2;}catch(_0x83e46e){return console[_0x74613c(0x146)](_0x74613c(0xb8),_0x83e46e),null;}});Promise['all'](_0x1ec42e)['then'](async _0x1cc158=>{var _0x39f880=_0xea0691;try{for(const _0x22864f of _0x1cc158){await warehouse[_0x39f880(0x16c)]({'_id':_0x22864f[_0x39f880(0x183)]},{'$addToSet':{'product_details':{'$each':_0x22864f[_0x39f880(0x91)]}}});}const _0x224f0c=await master_shop[_0x39f880(0x126)](),_0x23febd=await email_settings[_0x39f880(0x129)](),_0x5241a3=await supervisor_settings[_0x39f880(0x126)]();var _0x17a390=_0x48805d[_0x39f880(0x179)],_0x45edaa='',_0x146f2b;for(_0x146f2b in _0x17a390){var _0x3f9789='FG';_0x48805d[_0x39f880(0x12d)]==_0x39f880(0xfd)&&(_0x3f9789='DG'),_0x45edaa+=_0x39f880(0x111)+_0x39f880(0x115)+_0x17a390[_0x146f2b]['product_name']+_0x39f880(0xff)+_0x39f880(0x115)+_0x17a390[_0x146f2b][_0x39f880(0x89)]+_0x39f880(0xff)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x17a390[_0x146f2b][_0x39f880(0x173)]+_0x39f880(0xff)+_0x39f880(0x115)+_0x17a390[_0x146f2b][_0x39f880(0x16d)]+_0x39f880(0xff)+_0x39f880(0x115)+_0x17a390[_0x146f2b]['secondary_unit']+_0x39f880(0xff)+_0x39f880(0x115)+_0x48805d[_0x39f880(0x12d)]+'</td>'+_0x39f880(0x115)+_0x17a390[_0x146f2b][_0x39f880(0xf2)]+_0x39f880(0xff)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3f9789+_0x17a390[_0x146f2b][_0x39f880(0x14b)]+'</td>','</tr>';}let _0x6b53ae=nodemailer[_0x39f880(0xcf)]({'host':_0x23febd[_0x39f880(0x194)],'port':Number(_0x23febd[_0x39f880(0x1a6)]),'secure':![],'auth':{'user':_0x23febd['email'],'pass':_0x23febd[_0x39f880(0x137)]}}),_0x2e9bb7={'from':_0x23febd['email'],'to':_0x5241a3[0x0][_0x39f880(0x1a2)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x39f880(0x112),'path':__dirname+_0x39f880(0x141)+_0x39f880(0xa2)+_0x224f0c[0x0][_0x39f880(0x14e)],'cid':_0x39f880(0x12c)}],'html':_0x39f880(0x90)+_0x39f880(0xca)+_0x39f880(0x12e)+_0x39f880(0xb0)+_0x39f880(0xdf)+'<div>'+_0x39f880(0x158)+_0x39f880(0xd2)+_0x39f880(0xb0)+'<h2>\x20'+_0x224f0c[0x0][_0x39f880(0xbc)]+_0x39f880(0x130)+'</div>'+_0x39f880(0xd2)+_0x39f880(0x123)+_0x39f880(0xb0)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x39f880(0x128)+_0x48805d['invoice']+'\x20'+_0x39f880(0xd7)+_0x39f880(0xc3)+_0x48805d[_0x39f880(0x169)]+'\x20'+_0x39f880(0xbb)+_0x39f880(0xe6)+'</div>'+_0x39f880(0x178)+_0x39f880(0x102)+_0x39f880(0x111)+_0x39f880(0x117)+_0x39f880(0xd0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x39f880(0x127)+_0x39f880(0xa3)+_0x39f880(0xae)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x39f880(0xc5)+_0x39f880(0x14f)+_0x39f880(0xf3)+_0x39f880(0x9c)+'\x20'+_0x45edaa+'\x20'+_0x39f880(0x108)+_0x39f880(0x164)+'<div>'+_0x39f880(0xe0)+_0x39f880(0x121)+_0x224f0c[0x0]['site_title']+'</h5>'+_0x39f880(0xd2)+_0x39f880(0xd2)+_0x39f880(0x1a4)};_0x6b53ae[_0x39f880(0x159)](_0x2e9bb7,function(_0x1e040b,_0x26737a){var _0x5b7887=_0x39f880;_0x1e040b?(console[_0x5b7887(0x100)](_0x1e040b),console[_0x5b7887(0x100)]('Error\x20Occurs')):console[_0x5b7887(0x100)](_0x5b7887(0x180));});}catch(_0x366325){console[_0x39f880(0x146)](_0x366325),_0x64f479['status'](0x1f4)[_0x39f880(0xe2)]({'error':_0x39f880(0x16b),'message':_0x366325[_0x39f880(0x104)]});}})[_0xea0691(0xc1)](_0x358975=>{console['error'](_0x358975);}),_0x122569[_0xea0691(0xba)]('success',_0xea0691(0xe1)),_0x64f479[_0xea0691(0x11e)]('/all_purchases_finished/view');}catch(_0x5d5deb){console[_0xea0691(0x100)](_0x5d5deb);}}),router[a0_0x55ffb0(0x19a)](a0_0x55ffb0(0x93),auth,async(_0x382a0c,_0x471e0e)=>{var _0x87d209=a0_0x55ffb0;try{const {username:_0x1e146e,email:_0x493ce6,role:_0x3c0e52}=_0x382a0c['user'],_0x3cd748=_0x382a0c['user'],_0x13a8a8=await profile[_0x87d209(0x129)]({'email':_0x3cd748[_0x87d209(0x15c)]}),_0x165756=await master_shop[_0x87d209(0x126)](),_0x2f3939=_0x382a0c[_0x87d209(0xcb)]['id'],_0x3e19d4=await purchases_finished[_0x87d209(0x11a)](_0x2f3939),_0x68b090=await suppliers[_0x87d209(0x126)]({});let _0x2b4a8c;if(_0x3cd748[_0x87d209(0x11c)]==_0x87d209(0x18c)){const _0x59479f=await staff[_0x87d209(0x129)]({'email':_0x3cd748[_0x87d209(0x15c)]});_0x2b4a8c=await warehouse[_0x87d209(0x126)]({'status':_0x87d209(0x11d),'name':_0x59479f['warehouse'],'warehouse_category':_0x87d209(0x163)});}else _0x2b4a8c=await warehouse[_0x87d209(0x191)]([{'$match':{'status':_0x87d209(0x11d),'warehouse_category':_0x87d209(0x163)}},{'$group':{'_id':_0x87d209(0xec),'name':{'$first':'$name'}}}]);const _0x48d479=await product[_0x87d209(0x126)]({}),_0x22d43c=BayBinSelected(_0x3e19d4[_0x87d209(0x12d)],_0x3e19d4[_0x87d209(0x10e)]);let _0x3c5cf2=new Date(_0x3e19d4[_0x87d209(0xfc)]),_0x154233=('0'+_0x3c5cf2[_0x87d209(0x19f)]())[_0x87d209(0xa5)](-0x2),_0x42ec6e=('0'+(_0x3c5cf2[_0x87d209(0x1a0)]()+0x1))['slice'](-0x2),_0x3a4b02=_0x3c5cf2[_0x87d209(0x11b)](),_0x4df3be=_0x3a4b02+'-'+_0x42ec6e+'-'+_0x154233;if(_0x165756[0x0]['language']==_0x87d209(0xb2)){var _0x4b4359=users['English'];console[_0x87d209(0x100)](_0x4b4359);}else{if(_0x165756[0x0]['language']=='Hindi')var _0x4b4359=users['Hindi'];else{if(_0x165756[0x0]['language']==_0x87d209(0x172))var _0x4b4359=users[_0x87d209(0x172)];else{if(_0x165756[0x0][_0x87d209(0x8c)]==_0x87d209(0xe7))var _0x4b4359=users['Spanish'];else{if(_0x165756[0x0][_0x87d209(0x8c)]==_0x87d209(0x166))var _0x4b4359=users[_0x87d209(0x166)];else{if(_0x165756[0x0][_0x87d209(0x8c)]=='Portuguese\x20(BR)')var _0x4b4359=users['Portuguese'];else{if(_0x165756[0x0][_0x87d209(0x8c)]==_0x87d209(0x118))var _0x4b4359=users['Chinese'];else{if(_0x165756[0x0][_0x87d209(0x8c)]=='Arabic\x20(ae)')var _0x4b4359=users[_0x87d209(0x145)];}}}}}}}_0x471e0e[_0x87d209(0x8f)]('edit_purchases_finished_view',{'success':_0x382a0c[_0x87d209(0xba)]('success'),'errors':_0x382a0c[_0x87d209(0xba)]('errors'),'role':_0x3cd748,'profile':_0x13a8a8,'purchases':_0x3e19d4,'suppliers':_0x68b090,'warehouse':_0x2b4a8c,'product':_0x48d479,'master_shop':_0x165756,'language':_0x4b4359,'ed_fullDate':_0x4df3be,'dataSelected':_0x22d43c});}catch(_0x255222){console['log'](_0x255222);}}),router[a0_0x55ffb0(0x19a)](a0_0x55ffb0(0x124),auth,async(_0x1e4b4f,_0x1294a7)=>{var _0x2ff1ab=a0_0x55ffb0;try{const {username:_0x30b1d0,email:_0x2099d9,role:_0x3ac2c5}=_0x1e4b4f[_0x2ff1ab(0x182)],_0x48700c=_0x1e4b4f['user'],_0x2ccfeb=await profile['findOne']({'email':_0x48700c[_0x2ff1ab(0x15c)]}),_0x6cf78b=await master_shop[_0x2ff1ab(0x126)](),_0x4c37b5=_0x1e4b4f['params']['id'],_0x34dec9=await purchases_finished['findById'](_0x4c37b5),_0x4c7a0a=await suppliers[_0x2ff1ab(0x126)]({});let _0xe92037;if(_0x48700c['role']==_0x2ff1ab(0x18c)){const _0x394eff=await staff[_0x2ff1ab(0x129)]({'email':_0x48700c[_0x2ff1ab(0x15c)]});_0xe92037=await warehouse[_0x2ff1ab(0x126)]({'status':'Enabled','name':_0x394eff[_0x2ff1ab(0x17a)],'warehouse_category':_0x2ff1ab(0x163)});}else _0xe92037=await warehouse['aggregate']([{'$match':{'status':_0x2ff1ab(0x11d),'warehouse_category':_0x2ff1ab(0x163)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x1a9fd5=await product[_0x2ff1ab(0x126)]({}),_0x1f2312=BayBinSelected(_0x34dec9[_0x2ff1ab(0x12d)],_0x34dec9['room']);let _0x2dd70d=new Date(_0x34dec9['expiry_date']),_0x11ed11=('0'+_0x2dd70d[_0x2ff1ab(0x19f)]())['slice'](-0x2),_0x40125a=('0'+(_0x2dd70d['getMonth']()+0x1))['slice'](-0x2),_0x494227=_0x2dd70d['getFullYear'](),_0x5a01bb=_0x494227+'-'+_0x40125a+'-'+_0x11ed11;if(_0x6cf78b[0x0][_0x2ff1ab(0x8c)]==_0x2ff1ab(0xb2)){var _0x2d6494=users[_0x2ff1ab(0xa4)];console[_0x2ff1ab(0x100)](_0x2d6494);}else{if(_0x6cf78b[0x0]['language']==_0x2ff1ab(0xe9))var _0x2d6494=users['Hindi'];else{if(_0x6cf78b[0x0][_0x2ff1ab(0x8c)]==_0x2ff1ab(0x172))var _0x2d6494=users[_0x2ff1ab(0x172)];else{if(_0x6cf78b[0x0][_0x2ff1ab(0x8c)]==_0x2ff1ab(0xe7))var _0x2d6494=users['Spanish'];else{if(_0x6cf78b[0x0][_0x2ff1ab(0x8c)]=='French')var _0x2d6494=users['French'];else{if(_0x6cf78b[0x0][_0x2ff1ab(0x8c)]==_0x2ff1ab(0xf4))var _0x2d6494=users['Portuguese'];else{if(_0x6cf78b[0x0][_0x2ff1ab(0x8c)]==_0x2ff1ab(0x118))var _0x2d6494=users['Chinese'];else{if(_0x6cf78b[0x0][_0x2ff1ab(0x8c)]==_0x2ff1ab(0x94))var _0x2d6494=users[_0x2ff1ab(0x145)];}}}}}}}_0x1294a7[_0x2ff1ab(0x8f)](_0x2ff1ab(0xd3),{'success':_0x1e4b4f[_0x2ff1ab(0xba)](_0x2ff1ab(0xe3)),'errors':_0x1e4b4f['flash'](_0x2ff1ab(0x175)),'role':_0x48700c,'profile':_0x2ccfeb,'purchases':_0x34dec9,'suppliers':_0x4c7a0a,'warehouse':_0xe92037,'product':_0x1a9fd5,'master_shop':_0x6cf78b,'language':_0x2d6494,'ed_fullDate':_0x5a01bb,'dataSelected':_0x1f2312});}catch(_0x4b7209){console[_0x2ff1ab(0x100)](_0x4b7209);}}),router[a0_0x55ffb0(0xf9)]('/view/:id',auth,async(_0x50a881,_0x1ef984)=>{var _0x5010a6=a0_0x55ffb0;try{const _0x4e2f06=_0x50a881['params']['id'],_0x1db1d6=await purchases_finished['findOne']({'_id':_0x50a881[_0x5010a6(0xcb)]['id']}),_0x1f096f=await warehouse[_0x5010a6(0x129)]({'name':_0x1db1d6[_0x5010a6(0x12d)],'room':_0x1db1d6['room']});_0x1db1d6[_0x5010a6(0x179)][_0x5010a6(0xa7)](_0x129cc3=>{var _0x1544cf=_0x5010a6;const _0x1e16bb=_0x1f096f[_0x1544cf(0x91)][_0x1544cf(0xfe)](_0x285bde=>{var _0x39dd4f=_0x1544cf;_0x285bde[_0x39dd4f(0xb4)]==_0x129cc3[_0x39dd4f(0xb4)]&&_0x285bde[_0x39dd4f(0x14b)]==_0x129cc3[_0x39dd4f(0x14b)]&&(_0x285bde[_0x39dd4f(0x13e)]=parseInt(_0x285bde['product_stock'])-parseInt(_0x129cc3['quantity']));});}),await _0x1f096f[_0x5010a6(0xc0)]();const {invoice:_0x5a2198,suppliers:_0x5cca10,date:_0x52e600,warehouse_name:_0x1926e4,prod_name:_0x500461,prod_code:_0x16c56c,prod_qty:_0x4082cd,prod_unit:_0x38e022,prod_secondunit:_0x3807b2,prod_level:_0x3a4d69,prod_isle:_0x5ef857,prod_pallet:_0x572546,note:_0x47b310,expiry_date:_0x377bf7,batch_code:_0x4cbaff,paid_amount:_0x1d62d6,due_amount:_0x284ccc,Room_name:_0xe656ce,primary_code:_0x3ef507,secondary_code:_0x5ed43f,PO_number:_0x2ece64,JO_number:_0x1b8375}=_0x50a881[_0x5010a6(0xbd)];if(typeof _0x500461=='string')var _0x2a34c4=[_0x50a881[_0x5010a6(0xbd)]['prod_name']],_0x3b65a7=[_0x50a881[_0x5010a6(0xbd)]['prod_code']],_0x4fe96f=[_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x136)]],_0x13bb3e=[_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0xf7)]],_0x39b4a0=[_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x160)]],_0x17d71b=[_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x107)]],_0xcd2c19=[_0x50a881['body'][_0x5010a6(0x18b)]],_0x7ee332=[_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x165)]],_0xe88d7b=[_0x50a881['body'][_0x5010a6(0xad)]],_0x3ee2e1=[_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0xab)]],_0x4a20fb=[_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0xfc)]];else var _0x2a34c4=[..._0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x19b)]],_0x3b65a7=[..._0x50a881[_0x5010a6(0xbd)]['prod_code']],_0x4fe96f=[..._0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x136)]],_0x13bb3e=[..._0x50a881[_0x5010a6(0xbd)][_0x5010a6(0xf7)]],_0x39b4a0=[..._0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x160)]],_0x17d71b=[..._0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x107)]],_0xcd2c19=[..._0x50a881['body']['primary_code']],_0x7ee332=[..._0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x165)]],_0xe88d7b=[..._0x50a881['body'][_0x5010a6(0xad)]],_0x3ee2e1=[..._0x50a881['body'][_0x5010a6(0xab)]],_0x4a20fb=[..._0x50a881[_0x5010a6(0xbd)][_0x5010a6(0xfc)]];const _0x29ec43=_0x2a34c4[_0x5010a6(0xfe)](_0x2957aa=>{return _0x2957aa={'product_name':_0x2957aa};});_0x3b65a7[_0x5010a6(0xa7)]((_0x42cddc,_0x34b0d0)=>{_0x29ec43[_0x34b0d0]['product_code']=_0x42cddc;}),_0x4fe96f[_0x5010a6(0xa7)]((_0x25bb45,_0x3ddbe1)=>{var _0x1153cd=_0x5010a6;_0x29ec43[_0x3ddbe1][_0x1153cd(0x173)]=_0x25bb45;}),_0x13bb3e['forEach']((_0x27aef6,_0x1a7558)=>{var _0x2c7b1c=_0x5010a6;_0x29ec43[_0x1a7558][_0x2c7b1c(0x16d)]=_0x27aef6;}),_0x39b4a0['forEach']((_0x398379,_0x5840a1)=>{_0x29ec43[_0x5840a1]['secondary_unit']=_0x398379;}),_0x17d71b[_0x5010a6(0xa7)]((_0x272335,_0x5cb380)=>{var _0xdd141f=_0x5010a6;_0x29ec43[_0x5cb380][_0xdd141f(0x14b)]=_0x272335;}),_0xcd2c19[_0x5010a6(0xa7)]((_0x2997d6,_0x5a1b68)=>{_0x29ec43[_0x5a1b68]['primary_code']=_0x2997d6;}),_0x7ee332[_0x5010a6(0xa7)]((_0xd5ea8b,_0x4ff935)=>{var _0x44c55b=_0x5010a6;_0x29ec43[_0x4ff935][_0x44c55b(0x165)]=_0xd5ea8b;}),_0xe88d7b['forEach']((_0x355bb6,_0x16ef52)=>{_0x29ec43[_0x16ef52]['maxStocks']=_0x355bb6;}),_0x3ee2e1[_0x5010a6(0xa7)]((_0x4083c8,_0x43a3cf)=>{_0x29ec43[_0x43a3cf]['batch_code']=_0x4083c8;}),_0x4a20fb['forEach']((_0x59412e,_0x6473f7)=>{_0x29ec43[_0x6473f7]['expiry_date']=_0x59412e;});const _0x187d41=_0x29ec43[_0x5010a6(0xea)](_0x385460=>_0x385460['quantity']!=='0'&&_0x385460[_0x5010a6(0x173)]!=='');_0x1db1d6[_0x5010a6(0x116)]=_0x5a2198,_0x1db1d6[_0x5010a6(0x157)]=_0x5cca10,_0x1db1d6[_0x5010a6(0x169)]=_0x52e600,_0x1db1d6[_0x5010a6(0x12d)]=_0x1926e4,_0x1db1d6[_0x5010a6(0x179)]=_0x187d41,_0x1db1d6[_0x5010a6(0x8a)]=_0x47b310,_0x1db1d6[_0x5010a6(0x105)]=_0x1d62d6,_0x1db1d6[_0x5010a6(0xf8)]=_0x284ccc,_0x1db1d6[_0x5010a6(0x10e)]=_0xe656ce,_0x1db1d6[_0x5010a6(0x12b)]=_0x2ece64,_0x1db1d6[_0x5010a6(0x174)]=_0x1b8375;const _0x49f3ec=await _0x1db1d6[_0x5010a6(0xc0)](),_0x30cb9=await warehouse[_0x5010a6(0x129)]({'name':_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x12d)],'room':_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x16f)]});_0x1db1d6[_0x5010a6(0x179)][_0x5010a6(0xa7)](_0x5c4c17=>{var _0x43f377=_0x5010a6,_0x55798e=0x0;const _0x3730ba=_0x30cb9['product_details'][_0x43f377(0xfe)](_0x39091d=>{var _0x8c4943=_0x43f377;_0x39091d[_0x8c4943(0xb4)]==_0x5c4c17['product_name']&&_0x39091d[_0x8c4943(0x14b)]==_0x5c4c17['bay']&&(_0x39091d['product_stock']=parseInt(_0x39091d['product_stock'])+parseInt(_0x5c4c17[_0x8c4943(0x173)]),_0x55798e++);});_0x55798e=='0'&&(_0x30cb9[_0x43f377(0x91)]=_0x30cb9[_0x43f377(0x91)][_0x43f377(0x156)]({'product_name':_0x5c4c17[_0x43f377(0xb4)],'product_stock':_0x5c4c17[_0x43f377(0x173)],'primary_code':_0x5c4c17[_0x43f377(0x18b)],'secondary_code':_0x5c4c17[_0x43f377(0x165)],'product_code':_0x5c4c17['product_code'],'bay':_0x5c4c17[_0x43f377(0x14b)],'maxProducts':_0x5c4c17[_0x43f377(0x9a)],'unit':_0x5c4c17[_0x43f377(0x16d)],'secondary_unit':_0x5c4c17[_0x43f377(0x154)],'expiry_date':_0x5c4c17[_0x43f377(0xfc)]}));}),await _0x30cb9[_0x5010a6(0xc0)]();const _0x2c641b=await s_payment_data[_0x5010a6(0x129)]({'invoice':_0x50a881[_0x5010a6(0xbd)]['invoice']});if(_0x2c641b===null){}else console[_0x5010a6(0x100)]('suppliers',_0x2c641b,_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x116)]),_0x2c641b[_0x5010a6(0x157)]=_0x50a881[_0x5010a6(0xbd)][_0x5010a6(0x157)],await _0x2c641b[_0x5010a6(0xc0)]();_0x50a881['flash'](_0x5010a6(0xe3),_0x5010a6(0x138)),_0x1ef984['redirect'](_0x5010a6(0x15b));}catch(_0xd00f5a){console[_0x5010a6(0x100)](_0xd00f5a);}}),router[a0_0x55ffb0(0xf9)](a0_0x55ffb0(0x9b),auth,async(_0xbd2dfa,_0x2257f8)=>{var _0x1e2d32=a0_0x55ffb0;try{const _0x5f130a=_0xbd2dfa[_0x1e2d32(0xcb)]['id'],{invoice:_0x21349c,suppliers:_0x41d3f9,payable:_0x1f66ac,due_amount:_0x4c2391}=_0xbd2dfa[_0x1e2d32(0xbd)],_0x3137fe=await purchases['findById'](_0x5f130a);var _0x1c89ec=_0x1f66ac-_0x4c2391;_0x3137fe[_0x1e2d32(0x105)]=parseFloat(_0x3137fe[_0x1e2d32(0x105)])+parseFloat(_0x4c2391),_0x3137fe[_0x1e2d32(0xf8)]=_0x1c89ec;const _0x182e87=await _0x3137fe[_0x1e2d32(0xc0)]();console[_0x1e2d32(0x100)](_0x182e87);const _0x8dd408=await s_payment_data[_0x1e2d32(0x129)]({'invoice':_0x21349c});_0x8dd408[_0x1e2d32(0x98)]=_0x1c89ec,await _0x8dd408[_0x1e2d32(0xc0)]();let _0x577c2a=new Date(),_0x1e67d2=('0'+_0x577c2a[_0x1e2d32(0x19f)]())[_0x1e2d32(0xa5)](-0x2),_0x4dcd1d=('0'+(_0x577c2a[_0x1e2d32(0x1a0)]()+0x1))[_0x1e2d32(0xa5)](-0x2),_0x5125d7=_0x577c2a['getFullYear'](),_0x1e9b78=_0x5125d7+'-'+_0x4dcd1d+'-'+_0x1e67d2;const _0x312699=new suppliers_payment({'invoice':_0x21349c,'date':_0x5125d7+'-'+_0x4dcd1d+'-'+_0x1e67d2,'suppliers':_0x41d3f9,'reason':_0x1e2d32(0x132),'amount':_0x4c2391}),_0x1ec879=await _0x312699[_0x1e2d32(0xc0)]();_0xbd2dfa[_0x1e2d32(0xba)]('success',_0x1e2d32(0x162)),_0x2257f8[_0x1e2d32(0x11e)](_0x1e2d32(0x13a));}catch(_0x1f4f04){console[_0x1e2d32(0x100)](_0x1f4f04);}}),router[a0_0x55ffb0(0x19a)](a0_0x55ffb0(0x195),auth,async(_0x2ff094,_0xd2ca04)=>{var _0x21c149=a0_0x55ffb0;try{const {username:_0xa8f626,email:_0x1e5b05,role:_0x58a4ed}=_0x2ff094[_0x21c149(0x182)],_0x45027c=_0x2ff094[_0x21c149(0x182)],_0x4024b9=await profile['findOne']({'email':_0x45027c[_0x21c149(0x15c)]}),_0x3a0db8=await master_shop[_0x21c149(0x126)]();console['log'](_0x21c149(0x139),_0x3a0db8);const _0x5092a1=_0x2ff094['params']['id'],_0x3b0b90=await purchases[_0x21c149(0x11a)](_0x5092a1);console[_0x21c149(0x100)](_0x3b0b90);const _0x108cdd=await suppliers[_0x21c149(0x129)]({'name':_0x3b0b90[_0x21c149(0x157)]});console['log'](_0x108cdd);if(_0x3a0db8[0x0]['language']==_0x21c149(0xb2)){var _0x4c71f1=users[_0x21c149(0xa4)];console[_0x21c149(0x100)](_0x4c71f1);}else{if(_0x3a0db8[0x0]['language']=='Hindi')var _0x4c71f1=users['Hindi'];else{if(_0x3a0db8[0x0][_0x21c149(0x8c)]=='German')var _0x4c71f1=users['German'];else{if(_0x3a0db8[0x0][_0x21c149(0x8c)]=='Spanish')var _0x4c71f1=users[_0x21c149(0xe7)];else{if(_0x3a0db8[0x0]['language']==_0x21c149(0x166))var _0x4c71f1=users['French'];else{if(_0x3a0db8[0x0][_0x21c149(0x8c)]==_0x21c149(0xf4))var _0x4c71f1=users[_0x21c149(0x19c)];else{if(_0x3a0db8[0x0][_0x21c149(0x8c)]==_0x21c149(0x118))var _0x4c71f1=users['Chinese'];else{if(_0x3a0db8[0x0][_0x21c149(0x8c)]==_0x21c149(0x94))var _0x4c71f1=users['Arabic'];}}}}}}}_0xd2ca04[_0x21c149(0x8f)](_0x21c149(0xbf),{'success':_0x2ff094[_0x21c149(0xba)]('success'),'errors':_0x2ff094[_0x21c149(0xba)](_0x21c149(0x175)),'role':_0x45027c,'profile':_0x4024b9,'master_shop':_0x3a0db8,'supplier':_0x108cdd,'purchase':_0x3b0b90,'language':_0x4c71f1});}catch(_0x1142fb){console['log'](_0x1142fb);}}),router[a0_0x55ffb0(0x19a)]('/view/return_purchase/:id',auth,async(_0x295659,_0x38c958)=>{var _0x15cdc1=a0_0x55ffb0;try{const {username:_0x21f2ee,email:_0x3bd12c,role:_0x3b4182}=_0x295659[_0x15cdc1(0x182)],_0x142800=_0x295659['user'],_0x2f92d4=await profile['findOne']({'email':_0x142800[_0x15cdc1(0x15c)]}),_0x1aa836=await master_shop[_0x15cdc1(0x126)]();console[_0x15cdc1(0x100)](_0x15cdc1(0x139),_0x1aa836);const _0x559e46=_0x295659[_0x15cdc1(0xcb)]['id'];console[_0x15cdc1(0x100)](_0x559e46);const _0x1a956d=await purchases_finished[_0x15cdc1(0x11a)](_0x559e46);console[_0x15cdc1(0x100)](_0x15cdc1(0x190),_0x1a956d);const _0x4769d0=await product[_0x15cdc1(0x126)]({}),_0x5136b1=await warehouse['aggregate']([{'$match':{'name':_0x1a956d[_0x15cdc1(0x12d)],'room':_0x1a956d[_0x15cdc1(0x10e)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x15cdc1(0x17b),'name':{'$first':_0x15cdc1(0x8d)},'product_stock':{'$first':_0x15cdc1(0x148)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x15cdc1(0x10c)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x15cdc1(0x18d)},'primary_code':{'$first':_0x15cdc1(0xc9)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x15cdc1(0xf6)},'storage':{'$first':_0x15cdc1(0x99)},'rack':{'$first':_0x15cdc1(0x151)}}}]);console['log'](_0x15cdc1(0xc4),_0x5136b1);let _0x32520a;if(_0x142800[_0x15cdc1(0x11c)]==_0x15cdc1(0x18c)){const _0x269f95=await staff[_0x15cdc1(0x129)]({'email':_0x142800[_0x15cdc1(0x15c)]});_0x32520a=await warehouse[_0x15cdc1(0x126)]({'status':'Enabled','name':_0x269f95[_0x15cdc1(0x17a)],'warehouse_category':_0x15cdc1(0x163),'name':_0x15cdc1(0xb6)});}else _0x32520a=await warehouse[_0x15cdc1(0x191)]([{'$match':{'status':_0x15cdc1(0x11d),'warehouse_category':_0x15cdc1(0x163),'name':'Return\x20Goods'}},{'$group':{'_id':_0x15cdc1(0xec),'name':{'$first':_0x15cdc1(0xec)}}}]);if(_0x1aa836[0x0][_0x15cdc1(0x8c)]==_0x15cdc1(0xb2)){var _0x2e86e8=users[_0x15cdc1(0xa4)];console[_0x15cdc1(0x100)](_0x2e86e8);}else{if(_0x1aa836[0x0][_0x15cdc1(0x8c)]=='Hindi')var _0x2e86e8=users[_0x15cdc1(0xe9)];else{if(_0x1aa836[0x0][_0x15cdc1(0x8c)]==_0x15cdc1(0x172))var _0x2e86e8=users[_0x15cdc1(0x172)];else{if(_0x1aa836[0x0][_0x15cdc1(0x8c)]==_0x15cdc1(0xe7))var _0x2e86e8=users[_0x15cdc1(0xe7)];else{if(_0x1aa836[0x0][_0x15cdc1(0x8c)]=='French')var _0x2e86e8=users[_0x15cdc1(0x166)];else{if(_0x1aa836[0x0][_0x15cdc1(0x8c)]==_0x15cdc1(0xf4))var _0x2e86e8=users[_0x15cdc1(0x19c)];else{if(_0x1aa836[0x0][_0x15cdc1(0x8c)]==_0x15cdc1(0x118))var _0x2e86e8=users['Chinese'];else{if(_0x1aa836[0x0][_0x15cdc1(0x8c)]==_0x15cdc1(0x94))var _0x2e86e8=users[_0x15cdc1(0x145)];}}}}}}}_0x38c958[_0x15cdc1(0x8f)](_0x15cdc1(0x1a5),{'success':_0x295659[_0x15cdc1(0xba)](_0x15cdc1(0xe3)),'errors':_0x295659[_0x15cdc1(0xba)](_0x15cdc1(0x175)),'role':_0x142800,'profile':_0x2f92d4,'user':_0x1a956d,'stock':_0x5136b1,'master_shop':_0x1aa836,'product':_0x4769d0,'language':_0x2e86e8,'warehouse':_0x32520a});}catch(_0x45bfa1){console[_0x15cdc1(0x100)](_0x45bfa1);}}),router[a0_0x55ffb0(0xf9)](a0_0x55ffb0(0x168),auth,async(_0x2b2d70,_0x51b1ab)=>{var _0x5d3d44=a0_0x55ffb0;try{const {invoice:_0x445e85,date:_0x199e4f,warehouse_name:_0x57c6c6,Room_name:_0x3ae903,product_name:_0x58e6d2,purchase_quantity:_0x27bb82,stocks:_0x248c76,return_qty:_0x27f1e5,note:_0x5e2d63,level:_0x102e9f,isle:_0x1b97f2,pallet:_0x5a2d74,to_warehouse_name:_0x3455b6,to_Room_name:_0xee7954}=_0x2b2d70[_0x5d3d44(0xbd)],_0x241190=await purchases_finished['findOne']({'_id':_0x2b2d70[_0x5d3d44(0xcb)]['id']}),_0x541728=await warehouse[_0x5d3d44(0x129)]({'name':_0x57c6c6,'room':_0x3ae903,'warehouse_category':'Finished\x20Goods'});if(typeof _0x58e6d2==_0x5d3d44(0x155))var _0x51682e=[_0x2b2d70['body'][_0x5d3d44(0xb4)]],_0x3afb83=[_0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x9e)]],_0x72ceb5=[_0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x8e)]],_0x288ab3=[_0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0xa0)]],_0x3d351c=[_0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x14a)]],_0x1bb251=[_0x2b2d70[_0x5d3d44(0xbd)]['product_code_hide']],_0x3913f7=[_0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x171)]],_0xaaebba=[_0x2b2d70['body']['secondary_code_hide']];else var _0x51682e=[..._0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0xb4)]],_0x3afb83=[..._0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x9e)]],_0x72ceb5=[..._0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x8e)]],_0x288ab3=[..._0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0xa0)]],_0x3d351c=[..._0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x14a)]],_0x1bb251=[..._0x2b2d70[_0x5d3d44(0xbd)]['product_code_hide']],_0x3913f7=[..._0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x171)]],_0xaaebba=[..._0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0xd6)]];const _0x4e16de=_0x51682e[_0x5d3d44(0xfe)](_0x4f8c83=>{return _0x4f8c83={'product_name':_0x4f8c83};});_0x3afb83['forEach']((_0x3a8631,_0x3776cf)=>{var _0x1d0560=_0x5d3d44;_0x4e16de[_0x3776cf][_0x1d0560(0x9e)]=_0x3a8631;}),_0x72ceb5[_0x5d3d44(0xa7)]((_0xea2c66,_0x3ba459)=>{var _0x41374e=_0x5d3d44;_0x4e16de[_0x3ba459][_0x41374e(0x17c)]=_0xea2c66;}),_0x288ab3[_0x5d3d44(0xa7)]((_0x38173b,_0x106149)=>{var _0x5d0f5f=_0x5d3d44;_0x4e16de[_0x106149][_0x5d0f5f(0xa0)]=_0x38173b;}),_0x3d351c[_0x5d3d44(0xa7)]((_0x50e75a,_0x34fe10)=>{var _0x37f2e6=_0x5d3d44;_0x4e16de[_0x34fe10][_0x37f2e6(0x14b)]=_0x50e75a;}),_0x1bb251[_0x5d3d44(0xa7)]((_0x2a726b,_0x24cb2f)=>{var _0x329b30=_0x5d3d44;_0x4e16de[_0x24cb2f][_0x329b30(0x89)]=_0x2a726b;}),_0x3913f7['forEach']((_0x3893cf,_0x4bf8a2)=>{var _0x1e8891=_0x5d3d44;_0x4e16de[_0x4bf8a2][_0x1e8891(0x18b)]=_0x3893cf;}),_0xaaebba['forEach']((_0x4763f4,_0x335980)=>{_0x4e16de[_0x335980]['secondary_code']=_0x4763f4;}),_0x4e16de['forEach'](_0x1cb391=>{var _0x5d1539=_0x5d3d44;console[_0x5d1539(0x100)](_0x1cb391);const _0x12eafc=_0x541728['product_details'][_0x5d1539(0xfe)](_0x27dbb5=>{var _0x59743f=_0x5d1539;_0x27dbb5['product_name']==_0x1cb391[_0x59743f(0xb4)]&&_0x27dbb5[_0x59743f(0x14b)]==_0x1cb391[_0x59743f(0x14b)]&&(console[_0x59743f(0x100)](parseInt(_0x27dbb5['product_stock'])+_0x59743f(0x101)+parseInt(_0x1cb391['return_qty'])),_0x27dbb5['product_stock']=parseInt(_0x27dbb5[_0x59743f(0x13e)])-parseInt(_0x1cb391[_0x59743f(0xa0)]));});}),await _0x541728['save']();var _0x2b21ad=0x0;_0x4e16de[_0x5d3d44(0xa7)](_0x1f799e=>{var _0x41815b=_0x5d3d44;(parseInt(_0x1f799e['purchase_quantity'])<parseInt(_0x1f799e[_0x41815b(0xa0)])||parseInt(_0x1f799e[_0x41815b(0x17c)])<parseInt(_0x1f799e['return_qty']))&&_0x2b21ad++;});if(_0x2b21ad!=0x0)return _0x2b2d70[_0x5d3d44(0xba)](_0x5d3d44(0x175),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x51b1ab[_0x5d3d44(0x11e)](_0x5d3d44(0x1a1));const _0x5b2b45=new purchases_return_finished({'invoice':_0x445e85,'suppliers':_0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x157)],'date':_0x199e4f,'warehouse_name':_0x57c6c6,'return_product':_0x4e16de,'note':_0x5e2d63,'room':_0x3ae903,'to_warehouse_name':_0x3455b6,'to_room':_0xee7954}),_0x22d9f0=await _0x5b2b45[_0x5d3d44(0xc0)](),_0x35910d=await purchases_return_finished[_0x5d3d44(0x129)]({'invoice':_0x445e85}),_0x3c473e=await warehouse[_0x5d3d44(0x129)]({'name':_0x3455b6,'room':_0xee7954,'warehouse_category':_0x5d3d44(0x163)});_0x35910d[_0x5d3d44(0x114)]['forEach'](_0x4d27a6=>{var _0x3ee078=_0x5d3d44,_0x38b275=0x0;const _0x31fb2b=_0x3c473e['product_details']['map'](_0x1602e5=>{var _0x4aec7c=a0_0x79a3;console[_0x4aec7c(0x100)](_0x1602e5[_0x4aec7c(0xb4)]+'=='+_0x4d27a6[_0x4aec7c(0xb4)]+'&&'+_0x1602e5[_0x4aec7c(0x14b)]+'=='+_0x4d27a6[_0x4aec7c(0x14b)]),_0x1602e5[_0x4aec7c(0xb4)]==_0x4d27a6[_0x4aec7c(0xb4)]&&_0x1602e5[_0x4aec7c(0x14b)]==_0x4d27a6[_0x4aec7c(0x14b)]&&(_0x1602e5['product_stock']=parseInt(_0x1602e5[_0x4aec7c(0x13e)])-parseInt(_0x4d27a6[_0x4aec7c(0xa0)]),_0x38b275++);});_0x38b275=='0'&&(_0x3c473e[_0x3ee078(0x91)]=_0x3c473e[_0x3ee078(0x91)]['concat']({'product_name':_0x4d27a6[_0x3ee078(0xb4)],'product_stock':_0x4d27a6['return_qty'],'primary_code':_0x4d27a6['primary_code'],'secondary_code':_0x4d27a6[_0x3ee078(0x165)],'product_code':_0x4d27a6[_0x3ee078(0x89)],'bay':_0x4d27a6[_0x3ee078(0x14b)],'maxProducts':0xf423f}));}),await _0x3c473e['save']();const _0x429bee=await purchases_finished['findOne']({'invoice':_0x445e85});_0x429bee[_0x5d3d44(0x131)]=_0x5d3d44(0x119);const _0x1c1b66=await _0x429bee[_0x5d3d44(0xc0)](),_0x3bdcd9=new s_payment_data({'invoice':_0x445e85,'suppliers':_0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x157)],'reason':_0x5d3d44(0x167)});await _0x3bdcd9[_0x5d3d44(0xc0)]();const _0x114c14=await master_shop[_0x5d3d44(0x126)](),_0x7c0da3=await email_settings[_0x5d3d44(0x129)](),_0xc08f5b=await suppliers[_0x5d3d44(0x129)]({'name':_0x2b2d70[_0x5d3d44(0xbd)][_0x5d3d44(0x157)]});_0x114c14[0x0]['currency_placement']==0x1?(right_currency=_0x114c14[0x0][_0x5d3d44(0xb3)],left_currency=''):(right_currency='',left_currency=_0x114c14[0x0][_0x5d3d44(0xb3)]);var _0x66dfd4=_0x51682e,_0x4a1fa=_0x288ab3,_0x3f674a='',_0x31e155;for(_0x31e155 in _0x66dfd4){_0x3f674a+=_0x5d3d44(0x111)+_0x5d3d44(0x115)+_0x66dfd4[_0x31e155]+'</td>'+_0x5d3d44(0x115)+_0x4a1fa[_0x31e155]+_0x5d3d44(0xff)+'</tr>';}let _0x4d3872=nodemailer[_0x5d3d44(0xcf)]({'service':'gmail','auth':{'user':_0x7c0da3[_0x5d3d44(0x15c)],'pass':_0x7c0da3['password']}}),_0x429dd1={'from':_0x7c0da3[_0x5d3d44(0x15c)],'to':_0xc08f5b[_0x5d3d44(0x15c)],'subject':_0x5d3d44(0xa9),'attachments':[{'filename':_0x5d3d44(0x112),'path':__dirname+_0x5d3d44(0x141)+'/upload/'+_0x114c14[0x0]['image'],'cid':_0x5d3d44(0x12c)}],'html':'<!DOCTYPE\x20html>'+_0x5d3d44(0xca)+_0x5d3d44(0x12e)+'<div>'+_0x5d3d44(0xdf)+_0x5d3d44(0xb0)+_0x5d3d44(0x158)+_0x5d3d44(0xd2)+_0x5d3d44(0xb0)+'<h2>\x20'+_0x114c14[0x0][_0x5d3d44(0xbc)]+_0x5d3d44(0x130)+'</div>'+_0x5d3d44(0xd2)+_0x5d3d44(0x123)+_0x5d3d44(0xb0)+_0x5d3d44(0x10f)+_0x5d3d44(0x128)+_0x445e85+'\x20'+_0x5d3d44(0xd7)+_0x5d3d44(0xc3)+_0x199e4f+'\x20'+_0x5d3d44(0xbb)+'</h5>'+_0x5d3d44(0xd2)+_0x5d3d44(0x178)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5d3d44(0x111)+_0x5d3d44(0x117)+_0x5d3d44(0xd1)+_0x5d3d44(0x170)+_0x5d3d44(0xce)+_0x5d3d44(0x14f)+'</thead>'+_0x5d3d44(0x9c)+'\x20'+_0x3f674a+'\x20'+'</tbody>'+_0x5d3d44(0x164)+_0x5d3d44(0xb0)+'<strong>\x20Regards\x20</strong>'+_0x5d3d44(0x121)+_0x114c14[0x0]['site_title']+_0x5d3d44(0xe6)+_0x5d3d44(0xd2)+_0x5d3d44(0xd2)+_0x5d3d44(0x1a4)};_0x4d3872[_0x5d3d44(0x159)](_0x429dd1,function(_0x4f429c,_0x5b7d0b){var _0x5e4fd2=_0x5d3d44;_0x4f429c?console[_0x5e4fd2(0x100)](_0x5e4fd2(0x18f)):console[_0x5e4fd2(0x100)](_0x5e4fd2(0x180));}),_0x2b2d70[_0x5d3d44(0xba)]('success',_0x5d3d44(0x149)),_0x51b1ab[_0x5d3d44(0x11e)](_0x5d3d44(0x15b));}catch(_0x45b72c){_0x51b1ab[_0x5d3d44(0x10b)](0xc8)[_0x5d3d44(0xe2)]({'message':_0x45b72c[_0x5d3d44(0x104)]});}}),router[a0_0x55ffb0(0x19a)]('/barcode/:id',auth,async(_0x23c8fc,_0x1247c9)=>{var _0x267219=a0_0x55ffb0;try{const {username:_0x456611,email:_0x40fba9,role:_0xd14042}=_0x23c8fc['user'],_0x3242f9=_0x23c8fc[_0x267219(0x182)],_0x6e9628=await profile[_0x267219(0x129)]({'email':_0x3242f9[_0x267219(0x15c)]}),_0x21a9f1=await master_shop['find'](),_0x33940d=_0x23c8fc[_0x267219(0xcb)]['id'],_0x68c533=await purchases_finished[_0x267219(0x11a)](_0x33940d);if(_0x21a9f1[0x0][_0x267219(0x8c)]==_0x267219(0xb2))var _0x270f41=users[_0x267219(0xa4)];else{if(_0x21a9f1[0x0][_0x267219(0x8c)]==_0x267219(0xe9))var _0x270f41=users['Hindi'];else{if(_0x21a9f1[0x0][_0x267219(0x8c)]=='German')var _0x270f41=users[_0x267219(0x172)];else{if(_0x21a9f1[0x0][_0x267219(0x8c)]=='Spanish')var _0x270f41=users[_0x267219(0xe7)];else{if(_0x21a9f1[0x0][_0x267219(0x8c)]=='French')var _0x270f41=users[_0x267219(0x166)];else{if(_0x21a9f1[0x0][_0x267219(0x8c)]==_0x267219(0xf4))var _0x270f41=users[_0x267219(0x19c)];else{if(_0x21a9f1[0x0][_0x267219(0x8c)]==_0x267219(0x118))var _0x270f41=users[_0x267219(0x118)];else{if(_0x21a9f1[0x0][_0x267219(0x8c)]=='Arabic\x20(ae)')var _0x270f41=users['Arabic'];}}}}}}}_0x1247c9['render'](_0x267219(0xee),{'success':_0x23c8fc[_0x267219(0xba)](_0x267219(0xe3)),'errors':_0x23c8fc[_0x267219(0xba)]('errors'),'role':_0x3242f9,'profile':_0x6e9628,'alldata':_0x68c533,'master_shop':_0x21a9f1,'language':_0x270f41}),console[_0x267219(0x100)](alldata);}catch(_0x5a2994){console[_0x267219(0x100)](_0x5a2994);}}),router['post'](a0_0x55ffb0(0x161),async(_0x7b42ec,_0x3e7a5d)=>{var _0x429c9a=a0_0x55ffb0;const {product_code:_0x1340db}=_0x7b42ec[_0x429c9a(0xbd)];var _0x52e259;const _0x332999=await product[_0x429c9a(0x191)]([{'$match':{'primary_code':_0x1340db,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x429c9a(0xdb),'name':{'$first':'$name'},'category':{'$first':_0x429c9a(0x13b)},'brand':{'$first':_0x429c9a(0x113)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x429c9a(0x96)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x429c9a(0x110)},'maxProdPerUnit':{'$first':_0x429c9a(0xaa)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x429c9a(0x97)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x104a05=await product[_0x429c9a(0x191)]([{'$match':{'secondary_code':_0x1340db}},{'$group':{'_id':'$_id','name':{'$first':_0x429c9a(0xec)},'category':{'$first':_0x429c9a(0x13b)},'brand':{'$first':_0x429c9a(0x113)},'unit':{'$first':_0x429c9a(0x1a3)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x429c9a(0x96)},'primary_code':{'$first':_0x429c9a(0xe5)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x429c9a(0x110)},'maxProdPerUnit':{'$first':_0x429c9a(0xaa)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x429c9a(0x97)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x332999[_0x429c9a(0xda)]>0x0)_0x52e259=_0x332999;else _0x104a05[_0x429c9a(0xda)]>0x0&&(_0x52e259=_0x104a05);_0x3e7a5d[_0x429c9a(0xe2)](_0x52e259);}),router[a0_0x55ffb0(0xf9)]('/barcode_scanner_spmx',async(_0x11d950,_0x5ee1f3)=>{var _0x34fc18=a0_0x55ffb0;const {product_code:_0x175a88}=_0x11d950[_0x34fc18(0xbd)];var _0x352236;const _0x9237d2=await product['aggregate']([{'$match':{'product_code_spmx':_0x175a88,'product_category':'SPMX'}},{'$group':{'_id':_0x34fc18(0xdb),'category':{'$first':'$category'},'brand':{'$first':_0x34fc18(0x113)},'unit':{'$first':_0x34fc18(0x1a3)},'product_code_spmx':{'$first':'$product_code_spmx'},'product_code':{'$first':_0x34fc18(0x96)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'product_cat':{'$first':_0x34fc18(0xbe)}}},{'$project':{'_id':0x1,'category':0x1,'brand':0x1,'unit':0x1,'product_code_spmx':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'product_cat':0x1}}]);_0x352236=_0x9237d2,_0x5ee1f3[_0x34fc18(0xe2)](_0x352236);}),router['post'](a0_0x55ffb0(0x16e),async(_0x5df31d,_0x548702)=>{var _0x27be65=a0_0x55ffb0;const {productCode:_0x3f3442,bay:_0xab3a28,warehouses:_0x2387fa,room:_0x1cdd90}=_0x5df31d[_0x27be65(0xbd)];console[_0x27be65(0x100)](_0x5df31d[_0x27be65(0xbd)]);try{const _0x1bfb16=await warehouse[_0x27be65(0x191)]([{'$match':{'name':_0x2387fa,'room':_0x1cdd90}},{'$unwind':_0x27be65(0x15e)},{'$match':{'product_details.bay':parseInt(_0xab3a28)}},{'$group':{'_id':_0x27be65(0x17b),'name':{'$first':_0x27be65(0x8d)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x27be65(0x135)},'maxProducts':{'$first':_0x27be65(0xe4)}}}]);_0x548702[_0x27be65(0x10b)](0xc8)[_0x27be65(0xe2)](_0x1bfb16);}catch(_0xe3f15f){_0x548702[_0x27be65(0x10b)](0x194)[_0x27be65(0xe2)]({'message':_0xe3f15f[_0x27be65(0x104)]});}}),module[a0_0x55ffb0(0xd9)]=router;