var a0_0x553e1d=a0_0x33a1;(function(_0x618e51,_0x1fc0f3){var _0x530927=a0_0x33a1,_0x5c0bd9=_0x618e51();while(!![]){try{var _0x23fc94=-parseInt(_0x530927(0x169))/0x1*(-parseInt(_0x530927(0x1c0))/0x2)+parseInt(_0x530927(0x20c))/0x3+-parseInt(_0x530927(0x1a2))/0x4*(parseInt(_0x530927(0x1d5))/0x5)+-parseInt(_0x530927(0x237))/0x6*(-parseInt(_0x530927(0x1d9))/0x7)+-parseInt(_0x530927(0x185))/0x8+-parseInt(_0x530927(0x178))/0x9+parseInt(_0x530927(0x25c))/0xa*(parseInt(_0x530927(0x15f))/0xb);if(_0x23fc94===_0x1fc0f3)break;else _0x5c0bd9['push'](_0x5c0bd9['shift']());}catch(_0x5ab4d0){_0x5c0bd9['push'](_0x5c0bd9['shift']());}}}(a0_0x3df5,0x8a14c));function a0_0x33a1(_0x58d9fb,_0xfa2f87){var _0x3df5a6=a0_0x3df5();return a0_0x33a1=function(_0x33a1bd,_0x19e5cb){_0x33a1bd=_0x33a1bd-0x148;var _0x351c1b=_0x3df5a6[_0x33a1bd];return _0x351c1b;},a0_0x33a1(_0x58d9fb,_0xfa2f87);}function a0_0x3df5(){var _0x2460b5=['$product.product_code','$product_details.type','path','/barcode_scanner_spmx','$name','return_qty','room_spmx','purchase\x20data\x20add\x20successfully','$primary_code','aggregate','purchase_invoice','primary_code_hide','</h5>','</td>','exports','purchase\x20data\x20update\x20successfully','22NmBjmG','purchases\x20item\x20return\x20successfull','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','INC-','$product.floorlevel','language','$product_details.floorlevel','$room','email','/view_spmx','5eVRhHn','$product_details._id','Return\x20Goods','<table\x20style=\x22width:\x20100%\x20!important;\x22>','length','$product.type','</tbody>','<tbody\x20style=\x22text-align:\x20center;\x22>','English','site_title','$warehouse_name','$suppliers','return_purchase_finished','<tr>','paid_amount','716589hlFowR','Purchase\x20Return','createTransport','Portuguese\x20(BR)','True','maxStocks','error','$secondary_unit','getFullYear','$product.bay','host','stocks','bay','1665768NbThdF','view_purchases_finished_spmx','</thead>','</div>','master','password','slice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','\x20</h2>','extenders_spmx','../middleware/auth','MaxStocks_data','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','edit_purchases_finished','product_code','findById','all_purchases_finished_spmx','purchase_quantity','warehouse','$product_details.product_stock','params','$product.extenders_spmx','Incoming\x20Successfully\x20Added','<h5>','<h2>\x20','FGSEmail','concat','4tqEjIz','$product.spicemix_spmx','quantity','product_name','</head><body>','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','all_purchases_finished','add_purchases_finished','</span>','Logo.png','<strong>\x20Regards\x20</strong>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','RoomAssign','invoice_init','success','Hindi','curing_spmx','$unit','<!DOCTYPE\x20html>','production_date','$maxStocks','Portuguese','then','Chinese','product_cat','filter','\x20<>\x20','$product_code_spmx','logo','274446qyXxsr','note','/CheckingWarehouse','warehouse_name','all','$product_details.maxProducts','Email\x20sent\x20successfully','product_stock','$alertquantity','return_product','product','/barcode/:id','$product.room_name','edit_purchases_finished_view','payment\x20successfull','prod_unit','Room_name','French','errors','body','message','1556185obkVzi','<html><head><title></title>','add_purchases_finished_spmx','get','1526630rRgfoA','$product_code','<span\x20style=\x22float:\x20right;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</table>','extenders_spmx_qty','/../public','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','spicemix_spmx_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Arabic','Rack\x202','/give_payment/:id','$product.quantity','$category','product_date','log','image','getMonth','floor','extender_spmx','prod_primunit','/upload/','map','forEach','json','batch_code','curing_spmx_qty','$product_details','product_details','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','secondary_code_hide','random','$product_details.product_name','catch','FROZEN\x20GOODS','room','German','INCF-','Enclosed','\x20Order\x20Number\x20:\x20','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/view/add_purchases_spmx','/preview/:id','due_amount','English\x20(US)','role','$expiry_date','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','753264MWIlHv','find','product_code_hide','staff','/view/:id','<div>','$paid_amount','\x20Order\x20Date\x20:\x20','prod_name','Error\x20Occurs','abs','prod_invoice','padStart','/all_purchases_finished/view','unit_spmx','$note','$product_details.bin','$product.bin','flash','currency_placement','gmail','port','/view','prod_secondunit','max_product_unit','maxperunit','/view/return_purchase/:id','user','invoice','post','connect-flash','prod_level','spicemix_spmx','table\x20page','extender_spmx_qty','secondary_code','Error\x20occurred\x20while\x20processing\x20product:','Router','$date','<hr\x20class=\x22my-3\x22>','date','_id','prod_qty','6CsDOGf','Rack\x201','getDate','$suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','</tr>','render','return_data','$product.room_spmx','Enabled','$invoice','../public/language/languages.json','sendMail','Spanish','$secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','/invoice/:id','toString','express','date_data','Arabic\x20(ae)','category_spmx','DRY\x20GOODS','level','<h5\x20style=\x22text-align:\x20left;\x22>','amount','secondary_unit','/all_purchases/view','Purchase\x20Return\x20Mail','primary_code','/view_purchases_spmx/:id','$batch_code','/view/add_purchases','$product','suppliers','$product_details.secondary_code','stock_quantity','46830jDjyJY','status','nodemailer','SPMX','findOne','redirect','$product.extenders_spmx_qty','brand_spmx','/all_purchases_finished/view_purchases_spmx/','save','/barcode_scanner','standard_unit','room_name','prod_Qty','$_id','string','QA\x20Warehouse','POnumber'];a0_0x3df5=function(){return _0x2460b5;};return a0_0x3df5();}const express=require(a0_0x553e1d(0x249)),app=express(),router=express[a0_0x553e1d(0x231)](),{profile,master_shop,purchases_spmx,invoice_for_incoming,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x553e1d(0x18f)),nodemailer=require(a0_0x553e1d(0x25e));var ejs=require('ejs');const path=require(a0_0x553e1d(0x151)),users=require(a0_0x553e1d(0x242)),e=require(a0_0x553e1d(0x22a));router['get'](a0_0x553e1d(0x168),auth,async(_0x5127b9,_0x5a3995)=>{var _0x3990a6=a0_0x553e1d;try{const {username:_0x10b37e,email:_0x4a3f1c,role:_0x154c30}=_0x5127b9[_0x3990a6(0x227)],_0x1abb71=_0x5127b9[_0x3990a6(0x227)],_0xbf6840=await profile[_0x3990a6(0x260)]({'email':_0x1abb71[_0x3990a6(0x167)]}),_0x18c271=await staff[_0x3990a6(0x260)]({'email':_0x1abb71[_0x3990a6(0x167)]});if(_0x1abb71[_0x3990a6(0x209)]=='staff'){const _0x9a3fdb=await staff['findOne']({'email':_0x1abb71[_0x3990a6(0x167)]});}const _0x5775c5=await master_shop['find'](),_0x136873=await purchases_spmx[_0x3990a6(0x158)]([{'$unwind':_0x3990a6(0x258)},{'$group':{'_id':_0x3990a6(0x14b),'invoice':{'$first':_0x3990a6(0x241)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room_spmx':{'$addToSet':_0x3990a6(0x23f)},'product':{'$push':_0x3990a6(0x258)},'note':{'$first':_0x3990a6(0x21b)},'spicemix_spmx_qty':{'$sum':'$product.spicemix_spmx_qty'},'extenders_spmx_qty':{'$sum':_0x3990a6(0x262)},'curing_spmx_qty':{'$sum':'$product.curing_spmx_qty'},'spicemix_spmx':{'$addToSet':_0x3990a6(0x1a3)},'extenders_spmx':{'$addToSet':_0x3990a6(0x19c)},'curing_spmx':{'$addToSet':'$product.curing_spmx'},'product_code':{'$addToSet':_0x3990a6(0x14f)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'warehouse_name':0x1,'room_spmx':0x1,'product':0x1,'note':0x1,'spicemix_spmx_qty':0x1,'extenders_spmx_qty':0x1,'curing_spmx_qty':0x1,'spicemix_spmx':0x1,'extenders_spmx':0x1,'curing_spmx':0x1,'product_code':0x1}}]);if(_0x5775c5[0x0][_0x3990a6(0x164)]==_0x3990a6(0x208))var _0x3accb7=users['English'];else{if(_0x5775c5[0x0][_0x3990a6(0x164)]=='Hindi')var _0x3accb7=users[_0x3990a6(0x1b2)];else{if(_0x5775c5[0x0]['language']==_0x3990a6(0x200))var _0x3accb7=users[_0x3990a6(0x200)];else{if(_0x5775c5[0x0][_0x3990a6(0x164)]==_0x3990a6(0x244))var _0x3accb7=users[_0x3990a6(0x244)];else{if(_0x5775c5[0x0][_0x3990a6(0x164)]=='French')var _0x3accb7=users[_0x3990a6(0x1d1)];else{if(_0x5775c5[0x0][_0x3990a6(0x164)]=='Portuguese\x20(BR)')var _0x3accb7=users[_0x3990a6(0x1b8)];else{if(_0x5775c5[0x0][_0x3990a6(0x164)]==_0x3990a6(0x1ba))var _0x3accb7=users[_0x3990a6(0x1ba)];else{if(_0x5775c5[0x0][_0x3990a6(0x164)]=='Arabic\x20(ae)')var _0x3accb7=users[_0x3990a6(0x1e4)];}}}}}}}_0x5a3995['render'](_0x3990a6(0x197),{'success':_0x5127b9['flash'](_0x3990a6(0x1b1)),'errors':_0x5127b9[_0x3990a6(0x21e)]('errors'),'purchases':_0x136873,'role':_0x1abb71,'profile':_0xbf6840,'master_shop':_0x5775c5,'language':_0x3accb7});}catch(_0x36b5b7){console[_0x3990a6(0x1ea)](_0x3990a6(0x22d),_0x36b5b7),_0x5a3995[_0x3990a6(0x25d)](0xc8)[_0x3990a6(0x1f3)]({'message':_0x36b5b7[_0x3990a6(0x1d4)]});}}),router[a0_0x553e1d(0x1d8)](a0_0x553e1d(0x205),auth,async(_0x54feef,_0x2daa84)=>{var _0x4c300f=a0_0x553e1d;try{const {username:_0x1a9ac1,email:_0xee3771,role:_0xc96efc}=_0x54feef['user'],_0xfa194e=_0x54feef[_0x4c300f(0x227)],_0x2f7579=await profile[_0x4c300f(0x260)]({'email':_0xfa194e[_0x4c300f(0x167)]}),_0x18f6fa=await master_shop['find'](),_0x37112=await staff[_0x4c300f(0x260)]({'email':_0xfa194e[_0x4c300f(0x167)]}),_0x3226f4=await suppliers[_0x4c300f(0x20d)]({}),_0xa5ff63=await warehouse['aggregate']([{'$match':{'status':_0x4c300f(0x240),'warehouse_category':'SPMX','name':{'$ne':_0x4c300f(0x14d)}}},{'$group':{'_id':_0x4c300f(0x153),'name':{'$first':_0x4c300f(0x153)}}}]),_0x20df5b=await product[_0x4c300f(0x20d)]({}),_0x1966b8=await warehouse[_0x4c300f(0x20d)]({'status':_0x4c300f(0x240)}),_0x3660f7=await purchases_finished[_0x4c300f(0x20d)]({}),_0x126e03=_0x3660f7[_0x4c300f(0x16d)]+0x1,_0xed37e8=_0x4c300f(0x201)+_0x126e03[_0x4c300f(0x248)]()[_0x4c300f(0x218)](0x5,'0');var _0x2aac81=['Ambient',_0x4c300f(0x202)];if(_0x18f6fa[0x0][_0x4c300f(0x164)]=='English\x20(US)')var _0x220590=users[_0x4c300f(0x171)];else{if(_0x18f6fa[0x0][_0x4c300f(0x164)]==_0x4c300f(0x1b2))var _0x220590=users[_0x4c300f(0x1b2)];else{if(_0x18f6fa[0x0][_0x4c300f(0x164)]=='German')var _0x220590=users[_0x4c300f(0x200)];else{if(_0x18f6fa[0x0][_0x4c300f(0x164)]==_0x4c300f(0x244))var _0x220590=users['Spanish'];else{if(_0x18f6fa[0x0][_0x4c300f(0x164)]==_0x4c300f(0x1d1))var _0x220590=users[_0x4c300f(0x1d1)];else{if(_0x18f6fa[0x0][_0x4c300f(0x164)]==_0x4c300f(0x17b))var _0x220590=users['Portuguese'];else{if(_0x18f6fa[0x0][_0x4c300f(0x164)]=='Chinese')var _0x220590=users[_0x4c300f(0x1ba)];else{if(_0x18f6fa[0x0][_0x4c300f(0x164)]==_0x4c300f(0x24b))var _0x220590=users['Arabic'];}}}}}}}const _0x601eff=getRandom8DigitNumber();_0x601eff['then'](_0x374c2f=>{var _0x5a2636=_0x4c300f;_0x2daa84[_0x5a2636(0x23d)](_0x5a2636(0x1d7),{'success':_0x54feef[_0x5a2636(0x21e)](_0x5a2636(0x1b1)),'errors':_0x54feef[_0x5a2636(0x21e)](_0x5a2636(0x1d2)),'role':_0xfa194e,'profile':_0x2f7579,'suppliers':_0x3226f4,'warehouse':_0xa5ff63,'product':_0x20df5b,'invoice':_0x374c2f,'master_shop':_0x18f6fa,'language':_0x220590,'find_data':_0x1966b8,'rooms_data':_0x2aac81});})['catch'](_0x37782e=>{var _0x23eecc=_0x4c300f;_0x54feef[_0x23eecc(0x21e)](_0x23eecc(0x1d2),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x2daa84[_0x23eecc(0x261)](_0x23eecc(0x219));});}catch(_0x1a6828){console[_0x4c300f(0x1ea)](_0x1a6828);}}),router[a0_0x553e1d(0x229)](a0_0x553e1d(0x205),auth,async(_0x4c3102,_0x4ea6ca)=>{var _0x98d0d3=a0_0x553e1d;try{const {date:_0x24bb24,warehouse_name:_0x5aeab2,room_name:_0x36ec70,SCRN:_0x475523,PO_number:_0x2cbd4d,prod_code:_0x13af08,note:_0x363218}=_0x4c3102[_0x98d0d3(0x1d3)];if(typeof _0x13af08==_0x98d0d3(0x14c))var _0x16a449=[_0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x191)]],_0x5744a2=[_0x4c3102[_0x98d0d3(0x1d3)]['spicemix_spmx']],_0x1b8c35=[_0x4c3102['body']['spicemix_spmx_qty']],_0x56b940=[_0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x1ee)]],_0x240ab1=[_0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x22e)]],_0x31699b=[_0x4c3102['body']['curing_spmx']],_0x55c059=[_0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x1f5)]],_0xace6ba=[_0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x21a)]],_0x578e64=[_0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x263)]],_0x4e3b0f=[_0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x24c)]],_0x4db5ea=[_0x4c3102['body'][_0x98d0d3(0x155)]];else var _0x16a449=[..._0x4c3102['body'][_0x98d0d3(0x191)]],_0x5744a2=[..._0x4c3102[_0x98d0d3(0x1d3)]['spicemix_spmx']],_0x1b8c35=[..._0x4c3102['body'][_0x98d0d3(0x1e2)]],_0x56b940=[..._0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x18e)]],_0x240ab1=[..._0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x1de)]],_0x31699b=[..._0x4c3102[_0x98d0d3(0x1d3)]['curing_spmx']],_0x55c059=[..._0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x1f5)]],_0xace6ba=[..._0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x21a)]],_0x578e64=[..._0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x263)]],_0x4e3b0f=[..._0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x24c)]],_0x4db5ea=[..._0x4c3102[_0x98d0d3(0x1d3)][_0x98d0d3(0x155)]];const _0x21a914=_0x16a449[_0x98d0d3(0x1f1)](_0x1e9732=>{return _0x1e9732={'product_code':_0x1e9732};});_0x5744a2[_0x98d0d3(0x1f2)]((_0x8bee65,_0x4a468c)=>{var _0x3712d5=_0x98d0d3;_0x21a914[_0x4a468c][_0x3712d5(0x22c)]=_0x8bee65;}),_0x1b8c35[_0x98d0d3(0x1f2)]((_0x5555ad,_0x484b97)=>{var _0x37b46e=_0x98d0d3;_0x21a914[_0x484b97][_0x37b46e(0x1e2)]=_0x5555ad;}),_0x56b940[_0x98d0d3(0x1f2)]((_0x28fba9,_0x162507)=>{var _0xf2b267=_0x98d0d3;_0x21a914[_0x162507][_0xf2b267(0x18e)]=_0x28fba9;}),_0x240ab1[_0x98d0d3(0x1f2)]((_0x35f46d,_0x1bec9d)=>{var _0x453061=_0x98d0d3;_0x21a914[_0x1bec9d][_0x453061(0x1de)]=_0x35f46d;}),_0x31699b[_0x98d0d3(0x1f2)]((_0x2e0134,_0x9a6373)=>{var _0x32662f=_0x98d0d3;_0x21a914[_0x9a6373][_0x32662f(0x1b3)]=_0x2e0134;}),_0x55c059[_0x98d0d3(0x1f2)]((_0x4e5ad2,_0x2cac33)=>{_0x21a914[_0x2cac33]['curing_spmx_qty']=_0x4e5ad2;}),_0xace6ba[_0x98d0d3(0x1f2)]((_0x1f0445,_0x1056d8)=>{var _0x4adab5=_0x98d0d3;_0x21a914[_0x1056d8][_0x4adab5(0x21a)]=_0x1f0445;}),_0x578e64[_0x98d0d3(0x1f2)]((_0xba9b25,_0x5e4a6a)=>{var _0x36b20d=_0x98d0d3;_0x21a914[_0x5e4a6a][_0x36b20d(0x263)]=_0xba9b25;}),_0x4e3b0f['forEach']((_0x5a42cd,_0x48160c)=>{_0x21a914[_0x48160c]['category_spmx']=_0x5a42cd;}),_0x4db5ea['forEach']((_0x4051f6,_0x471770)=>{var _0xf638fb=_0x98d0d3;_0x21a914[_0x471770][_0xf638fb(0x155)]=_0x4051f6;});const _0x2ffc46=new invoice_for_incoming();await _0x2ffc46['save']();const _0x39708b=new purchases_spmx({'invoice':_0x98d0d3(0x162)+_0x2ffc46[_0x98d0d3(0x1b0)][_0x98d0d3(0x248)]()[_0x98d0d3(0x218)](0x8,'0'),'date':_0x24bb24,'warehouse_name':_0x5aeab2,'product':_0x21a914,'note':_0x363218,'room':_0x36ec70,'POnumber':_0x2cbd4d,'SCRN':_0x475523}),_0x5e991b=await _0x39708b[_0x98d0d3(0x265)](),_0x4e3823=await purchases_spmx[_0x98d0d3(0x196)](_0x5e991b[_0x98d0d3(0x235)]);_0x4e3823[_0x98d0d3(0x1ca)][_0x98d0d3(0x1f2)](async _0x393798=>{var _0x45b89e=_0x98d0d3;const _0x509966=_0x393798[_0x45b89e(0x195)],_0x510df9=_0x393798[_0x45b89e(0x22c)],_0x290a6c=_0x393798[_0x45b89e(0x1e2)],_0x23f7d8=_0x393798[_0x45b89e(0x18e)],_0x5bbaab=_0x393798[_0x45b89e(0x1de)],_0xf15b83=_0x393798[_0x45b89e(0x1b3)],_0x240bc5=_0x393798[_0x45b89e(0x1f5)],_0x27a27d=_0x393798[_0x45b89e(0x21a)],_0x4b3f7b=_0x393798[_0x45b89e(0x263)],_0xcbd6ab=_0x393798[_0x45b89e(0x24c)],_0xf6761e=_0x393798['room_spmx'],_0x132229=_0x4e3823[_0x45b89e(0x228)],_0x476948=_0x4e3823['_id']['toString']()+'~'+_0x393798['_id'][_0x45b89e(0x248)]();await warehouse['updateOne']({'name':_0x5aeab2,'room':_0xf6761e},{'$push':{'product_details_spmx':{'product_code':_0x509966,'spicemix_spmx':_0x510df9,'spicemix_spmx_qty':_0x290a6c,'extenders_spmx':_0x23f7d8,'extenders_spmx_qty':_0x5bbaab,'curing_spmx':_0xf15b83,'curing_spmx_qty':_0x240bc5,'unit_spmx':_0x27a27d,'brand_spmx':_0x4b3f7b,'category_spmx':_0xcbd6ab,'inv_incoming':_0x132229,'id_incoming':_0x476948}}});}),_0x4c3102['flash'](_0x98d0d3(0x1b1),_0x98d0d3(0x19d)),_0x4ea6ca['redirect'](_0x98d0d3(0x264)+_0x5e991b[_0x98d0d3(0x235)]);}catch(_0x1bccc7){console[_0x98d0d3(0x1ea)](_0x1bccc7);}}),router['get'](a0_0x553e1d(0x255),auth,async(_0x5ca409,_0x5c6334)=>{var _0x561225=a0_0x553e1d;try{const _0x565cbc=_0x5ca409[_0x561225(0x19b)]['id'],_0x32779f=await purchases_spmx[_0x561225(0x196)](_0x565cbc),_0x154c53=await master_shop[_0x561225(0x20d)](),_0x900746=_0x5ca409[_0x561225(0x227)],_0x1af5e1=await profile['findOne']({'email':_0x900746[_0x561225(0x167)]}),_0x19f5ca=await staff[_0x561225(0x260)]({'email':_0x900746[_0x561225(0x167)]});if(_0x154c53[0x0]['language']=='English\x20(US)')var _0x152182=users[_0x561225(0x171)];else{if(_0x154c53[0x0][_0x561225(0x164)]==_0x561225(0x1b2))var _0x152182=users[_0x561225(0x1b2)];else{if(_0x154c53[0x0][_0x561225(0x164)]==_0x561225(0x200))var _0x152182=users[_0x561225(0x200)];else{if(_0x154c53[0x0]['language']==_0x561225(0x244))var _0x152182=users[_0x561225(0x244)];else{if(_0x154c53[0x0][_0x561225(0x164)]=='French')var _0x152182=users['French'];else{if(_0x154c53[0x0][_0x561225(0x164)]==_0x561225(0x17b))var _0x152182=users[_0x561225(0x1b8)];else{if(_0x154c53[0x0][_0x561225(0x164)]==_0x561225(0x1ba))var _0x152182=users[_0x561225(0x1ba)];else{if(_0x154c53[0x0][_0x561225(0x164)]==_0x561225(0x24b))var _0x152182=users[_0x561225(0x1e4)];}}}}}}}_0x5c6334[_0x561225(0x23d)](_0x561225(0x186),{'success':_0x5ca409[_0x561225(0x21e)](_0x561225(0x1b1)),'errors':_0x5ca409[_0x561225(0x21e)]('errors'),'role':_0x900746,'profile':_0x1af5e1,'master_shop':_0x154c53,'language':_0x152182,'data':_0x32779f});}catch(_0x3c10d6){console[_0x561225(0x1ea)](_0x3c10d6);}}),router[a0_0x553e1d(0x1d8)](a0_0x553e1d(0x222),auth,async(_0x1bfcc9,_0x2724ca)=>{var _0x10a426=a0_0x553e1d;try{const {username:_0x2816ae,email:_0x270ee9,role:_0xf702ae}=_0x1bfcc9[_0x10a426(0x227)],_0x32f76a=_0x1bfcc9[_0x10a426(0x227)],_0x324dc3=await profile['findOne']({'email':_0x32f76a['email']}),_0x2f95ef=await staff[_0x10a426(0x260)]({'email':_0x32f76a[_0x10a426(0x167)]});if(_0x32f76a[_0x10a426(0x209)]==_0x10a426(0x20f)){const _0x2ea00a=await staff[_0x10a426(0x260)]({'email':_0x32f76a[_0x10a426(0x167)]});}const _0x9c769c=await master_shop[_0x10a426(0x20d)]();let _0x32830c;if(_0x32f76a[_0x10a426(0x209)]=='staff'){const _0x121253=await staff[_0x10a426(0x260)]({'email':_0x32f76a['email']});_0x32830c=await purchases_finished['aggregate']([{'$unwind':_0x10a426(0x258)},{'$group':{'_id':_0x10a426(0x14b),'invoice':{'$first':_0x10a426(0x241)},'suppliers':{'$first':_0x10a426(0x174)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x10a426(0x166)},'product':{'$push':_0x10a426(0x258)},'note':{'$first':_0x10a426(0x21b)},'paid_amount':{'$first':_0x10a426(0x212)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x10a426(0x256)},'expiry_date':{'$first':_0x10a426(0x20a)},'suppliers_docs':{'$first':_0x10a426(0x23a)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x10a426(0x21d)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x32830c=await purchases_finished[_0x10a426(0x158)]([{'$unwind':_0x10a426(0x258)},{'$group':{'_id':'$_id','invoice':{'$first':_0x10a426(0x241)},'suppliers':{'$first':_0x10a426(0x174)},'date':{'$first':_0x10a426(0x232)},'warehouse_name':{'$first':_0x10a426(0x173)},'room':{'$addToSet':_0x10a426(0x1cc)},'product':{'$push':'$product'},'note':{'$first':_0x10a426(0x21b)},'paid_amount':{'$first':_0x10a426(0x212)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x10a426(0x256)},'expiry_date':{'$first':_0x10a426(0x20a)},'suppliers_docs':{'$first':_0x10a426(0x23a)},'total_product_quantity':{'$sum':_0x10a426(0x1e7)},'level':{'$addToSet':_0x10a426(0x181)},'isle':{'$addToSet':_0x10a426(0x21d)},'type':{'$addToSet':_0x10a426(0x16e)},'floorlevel':{'$addToSet':_0x10a426(0x163)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x9c769c[0x0][_0x10a426(0x164)]==_0x10a426(0x208))var _0x49c83e=users['English'];else{if(_0x9c769c[0x0][_0x10a426(0x164)]==_0x10a426(0x1b2))var _0x49c83e=users[_0x10a426(0x1b2)];else{if(_0x9c769c[0x0][_0x10a426(0x164)]==_0x10a426(0x200))var _0x49c83e=users[_0x10a426(0x200)];else{if(_0x9c769c[0x0][_0x10a426(0x164)]==_0x10a426(0x244))var _0x49c83e=users['Spanish'];else{if(_0x9c769c[0x0][_0x10a426(0x164)]==_0x10a426(0x1d1))var _0x49c83e=users['French'];else{if(_0x9c769c[0x0]['language']==_0x10a426(0x17b))var _0x49c83e=users['Portuguese'];else{if(_0x9c769c[0x0]['language']==_0x10a426(0x1ba))var _0x49c83e=users[_0x10a426(0x1ba)];else{if(_0x9c769c[0x0]['language']==_0x10a426(0x24b))var _0x49c83e=users[_0x10a426(0x1e4)];}}}}}}}_0x2724ca[_0x10a426(0x23d)](_0x10a426(0x1a9),{'success':_0x1bfcc9[_0x10a426(0x21e)](_0x10a426(0x1b1)),'errors':_0x1bfcc9[_0x10a426(0x21e)](_0x10a426(0x1d2)),'purchases':_0x32830c,'role':_0x32f76a,'profile':_0x324dc3,'master_shop':_0x9c769c,'language':_0x49c83e});}catch(_0x5e61dc){console['log'](_0x10a426(0x22d),_0x5e61dc),_0x2724ca[_0x10a426(0x25d)](0xc8)[_0x10a426(0x1f3)]({'message':_0x5e61dc[_0x10a426(0x1d4)]});}});function BayBinSelected(_0x1f4895,_0x2191c6){var _0x441d2c=a0_0x553e1d,_0x2cacf6=[],_0x321d7e=[];if(_0x1f4895=='DRY\x20GOODS'){switch(_0x2191c6){case _0x441d2c(0x238):_0x2cacf6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x441d2c(0x1e5):_0x2cacf6=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x321d7e=['DG'];}else{if(_0x1f4895==_0x441d2c(0x1fe)){switch(_0x2191c6){case _0x441d2c(0x238):_0x2cacf6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x441d2c(0x1e5):_0x2cacf6=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x321d7e=['FG'];}}return{'levels':_0x2cacf6,'identify':_0x321d7e};}async function getRandom8DigitNumber(){var _0x258591=a0_0x553e1d;const _0x160c6b=0x989680,_0x33a97d=0x5f5e0ff,_0x35245b=Math[_0x258591(0x1ed)](Math[_0x258591(0x1fb)]()*(_0x33a97d-_0x160c6b+0x1))+_0x160c6b;var _0x265c25;const _0x7d7d9=await purchases_finished[_0x258591(0x260)]({'invoice':_0x258591(0x201)+_0x35245b});return _0x7d7d9&&_0x7d7d9[_0x258591(0x16d)]>0x0?_0x265c25=_0x258591(0x201)+_0x35245b:_0x265c25=_0x258591(0x201)+_0x35245b,_0x265c25;}router[a0_0x553e1d(0x1d8)]('/view/add_purchases',auth,async(_0x41f5ad,_0x4c7bc4)=>{var _0x6b609d=a0_0x553e1d;try{const {username:_0x338391,email:_0x43d8d0,role:_0x3179b3}=_0x41f5ad[_0x6b609d(0x227)],_0x4d9b6e=_0x41f5ad['user'],_0x52cee0=await profile[_0x6b609d(0x260)]({'email':_0x4d9b6e[_0x6b609d(0x167)]}),_0x204bac=await master_shop[_0x6b609d(0x20d)](),_0x3282b3=await staff[_0x6b609d(0x260)]({'email':_0x4d9b6e['email']}),_0x145507=await suppliers[_0x6b609d(0x20d)]({});let _0x3e5d9d;if(_0x4d9b6e[_0x6b609d(0x209)]==_0x6b609d(0x20f)){const _0x124816=await staff[_0x6b609d(0x260)]({'email':_0x4d9b6e[_0x6b609d(0x167)]});_0x3e5d9d=await warehouse[_0x6b609d(0x158)]([{'$match':{'status':_0x6b609d(0x240),'name':_0x124816[_0x6b609d(0x199)],'warehouse_category':_0x6b609d(0x1a7)}},{'$group':{'_id':_0x6b609d(0x153),'name':{'$first':_0x6b609d(0x153)}}}]);}else _0x3e5d9d=await warehouse[_0x6b609d(0x158)]([{'$match':{'status':_0x6b609d(0x240),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x6b609d(0x14d)}}},{'$group':{'_id':_0x6b609d(0x153),'name':{'$first':_0x6b609d(0x153)}}}]);const _0x461caa=await product[_0x6b609d(0x20d)]({}),_0x582790=await warehouse[_0x6b609d(0x20d)]({'status':_0x6b609d(0x240)}),_0x197e75=await purchases_finished[_0x6b609d(0x20d)]({}),_0x54548e=_0x197e75[_0x6b609d(0x16d)]+0x1,_0x41eaac=_0x6b609d(0x201)+_0x54548e[_0x6b609d(0x248)]()[_0x6b609d(0x218)](0x5,'0');var _0x59e0be=['Ambient',_0x6b609d(0x202)];if(_0x204bac[0x0][_0x6b609d(0x164)]==_0x6b609d(0x208))var _0x4af75e=users[_0x6b609d(0x171)];else{if(_0x204bac[0x0]['language']==_0x6b609d(0x1b2))var _0x4af75e=users[_0x6b609d(0x1b2)];else{if(_0x204bac[0x0][_0x6b609d(0x164)]=='German')var _0x4af75e=users[_0x6b609d(0x200)];else{if(_0x204bac[0x0][_0x6b609d(0x164)]==_0x6b609d(0x244))var _0x4af75e=users[_0x6b609d(0x244)];else{if(_0x204bac[0x0][_0x6b609d(0x164)]==_0x6b609d(0x1d1))var _0x4af75e=users[_0x6b609d(0x1d1)];else{if(_0x204bac[0x0]['language']=='Portuguese\x20(BR)')var _0x4af75e=users[_0x6b609d(0x1b8)];else{if(_0x204bac[0x0]['language']=='Chinese')var _0x4af75e=users['Chinese'];else{if(_0x204bac[0x0]['language']==_0x6b609d(0x24b))var _0x4af75e=users['Arabic'];}}}}}}}const _0x5d279f=getRandom8DigitNumber();_0x5d279f[_0x6b609d(0x1b9)](_0x95a728=>{var _0x35b90d=_0x6b609d;_0x4c7bc4[_0x35b90d(0x23d)](_0x35b90d(0x1aa),{'success':_0x41f5ad[_0x35b90d(0x21e)](_0x35b90d(0x1b1)),'errors':_0x41f5ad[_0x35b90d(0x21e)](_0x35b90d(0x1d2)),'role':_0x4d9b6e,'profile':_0x52cee0,'suppliers':_0x145507,'warehouse':_0x3e5d9d,'product':_0x461caa,'invoice':_0x95a728,'master_shop':_0x204bac,'language':_0x4af75e,'find_data':_0x582790,'rooms_data':_0x59e0be});})[_0x6b609d(0x1fd)](_0x36809d=>{var _0x54a2c7=_0x6b609d;_0x41f5ad[_0x54a2c7(0x21e)]('errors',_0x54a2c7(0x18c)),_0x4c7bc4['redirect'](_0x54a2c7(0x219));});}catch(_0x31196d){console[_0x6b609d(0x1ea)](_0x31196d);}}),router[a0_0x553e1d(0x1d8)]('/view/add_purchases/:id',auth,async(_0x2432f6,_0x1c01ea)=>{var _0x50031c=a0_0x553e1d;try{const _0x54a635=_0x2432f6[_0x50031c(0x19b)]['id'];console[_0x50031c(0x1ea)](_0x54a635);const _0x1095f1=await master_shop[_0x50031c(0x20d)]();console[_0x50031c(0x1ea)]('master',_0x1095f1);const _0xafbf94=await product[_0x50031c(0x260)]({'name':_0x54a635});console['log']('product',_0xafbf94),_0x1c01ea[_0x50031c(0x25d)](0xc8)['json']({'product_data':_0xafbf94,'master':_0x1095f1});}catch(_0x4a92fc){console[_0x50031c(0x1ea)]('add_purchases\x20error',_0x4a92fc);}}),router[a0_0x553e1d(0x229)](a0_0x553e1d(0x257),auth,async(_0x541d56,_0x40219e)=>{var _0x26d8c2=a0_0x553e1d;try{const {invoice:_0x308d0a,date:_0x4ec45c,warehouse_name:_0x5abc46,prod_name:_0x30753f,prod_code:_0x116a7f,prod_qty:_0x46eb8f,prod_unit:_0x472a61,prod_secondunit:_0x244623,prod_level:_0x5ae006,prod_isle:_0x4865eb,prod_pallet:_0x3afd85,note:_0x46b421,expiry_date:_0x2d6413,batch_code:_0x5393fc,payable:_0x3e8c08,due_amount:_0x567674,Room_name:_0x57bdb9,primary_code:_0xe76c15,secondary_code:_0x9693e8,MaxStocks_data:_0x616c5d,PO_number:_0x3a970d,SCRN:_0x5bde64,JO_number:_0x5547f5}=_0x541d56['body'];if(typeof _0x30753f==_0x26d8c2(0x14c))var _0x16cf6d=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x214)]],_0x2a914b=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x191)]],_0x1247f0=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x14a)]],_0x87da10=[_0x541d56['body']['prod_primunit']],_0x44ba6e=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x223)]],_0x1abf2a=[_0x541d56['body'][_0x26d8c2(0x22b)]],_0x52e2b1=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x254)]],_0x217831=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x22f)]],_0xbc0d2d=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x190)]],_0x544e2a=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x1f4)]],_0x371601=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x1e0)]],_0x251c72=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x1e9)]],_0x1707d9=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x224)]],_0x483216=[_0x541d56['body']['prod_cat']],_0x59f223=[_0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x1af)]],_0x3ec42c=[_0x541d56[_0x26d8c2(0x1d3)]['prod_invoice']];else var _0x16cf6d=[..._0x541d56['body']['prod_name']],_0x2a914b=[..._0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x191)]],_0x1247f0=[..._0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x14a)]],_0x87da10=[..._0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x1ef)]],_0x44ba6e=[..._0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x223)]],_0x1abf2a=[..._0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x22b)]],_0x52e2b1=[..._0x541d56[_0x26d8c2(0x1d3)]['primary_code']],_0x217831=[..._0x541d56[_0x26d8c2(0x1d3)]['secondary_code']],_0xbc0d2d=[..._0x541d56[_0x26d8c2(0x1d3)]['MaxStocks_data']],_0x544e2a=[..._0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x1f4)]],_0x371601=[..._0x541d56['body'][_0x26d8c2(0x1e0)]],_0x251c72=[..._0x541d56['body'][_0x26d8c2(0x1e9)]],_0x1707d9=[..._0x541d56[_0x26d8c2(0x1d3)]['max_product_unit']],_0x483216=[..._0x541d56['body']['prod_cat']],_0x59f223=[..._0x541d56[_0x26d8c2(0x1d3)]['RoomAssign']],_0x3ec42c=[..._0x541d56[_0x26d8c2(0x1d3)][_0x26d8c2(0x217)]];const _0x289f2f=_0x16cf6d['map'](_0x5089c0=>{return _0x5089c0={'product_name':_0x5089c0};});_0x2a914b[_0x26d8c2(0x1f2)]((_0x5cb73,_0x456b62)=>{var _0x2605d0=_0x26d8c2;_0x289f2f[_0x456b62][_0x2605d0(0x195)]=_0x5cb73,_0x289f2f[_0x456b62][_0x2605d0(0x24a)]=_0x4ec45c;}),_0x1247f0[_0x26d8c2(0x1f2)]((_0x114394,_0xba1b8)=>{var _0x453fb4=_0x26d8c2;_0x289f2f[_0xba1b8]['quantity']=Math[_0x453fb4(0x216)](_0x114394);}),_0x87da10['forEach']((_0x3b169f,_0x428218)=>{var _0x9fb714=_0x26d8c2;_0x289f2f[_0x428218][_0x9fb714(0x148)]=_0x3b169f;}),_0x44ba6e[_0x26d8c2(0x1f2)]((_0x374df5,_0x3f5210)=>{var _0x23caa7=_0x26d8c2;_0x289f2f[_0x3f5210][_0x23caa7(0x251)]=_0x374df5;}),_0x1abf2a[_0x26d8c2(0x1f2)]((_0x1db024,_0x5a1756)=>{var _0x5107f3=_0x26d8c2;_0x289f2f[_0x5a1756][_0x5107f3(0x184)]=_0x1db024;}),_0x52e2b1['forEach']((_0x453092,_0x3493e9)=>{_0x289f2f[_0x3493e9]['primary_code']=_0x453092;}),_0x217831['forEach']((_0x1a46f6,_0x23d125)=>{_0x289f2f[_0x23d125]['secondary_code']=_0x1a46f6;}),_0xbc0d2d['forEach']((_0x216af0,_0xc704ea)=>{var _0x59c7e5=_0x26d8c2;_0x289f2f[_0xc704ea][_0x59c7e5(0x17d)]=_0x216af0;}),_0x544e2a[_0x26d8c2(0x1f2)]((_0x5b58a2,_0x435f99)=>{_0x289f2f[_0x435f99]['batch_code']=_0x5b58a2;}),_0x371601['forEach']((_0x3fb61d,_0x3d2bde)=>{var _0x3b243e=_0x26d8c2;_0x289f2f[_0x3d2bde][_0x3b243e(0x1e0)]=_0x3fb61d;}),_0x251c72[_0x26d8c2(0x1f2)]((_0x2c4f3c,_0x269b9d)=>{var _0x1258eb=_0x26d8c2;_0x289f2f[_0x269b9d][_0x1258eb(0x1b6)]=_0x2c4f3c;}),_0x1707d9[_0x26d8c2(0x1f2)]((_0x2d5f25,_0x58b44f)=>{_0x289f2f[_0x58b44f]['maxperunit']=_0x2d5f25;}),_0x483216[_0x26d8c2(0x1f2)]((_0x540967,_0x37c355)=>{_0x289f2f[_0x37c355]['product_cat']=_0x540967;}),_0x59f223['forEach']((_0x4734a6,_0x2a5c88)=>{_0x289f2f[_0x2a5c88]['room_name']=_0x4734a6;}),_0x3ec42c[_0x26d8c2(0x1f2)]((_0x4da87d,_0x4f1610)=>{_0x289f2f[_0x4f1610]['invoice']=_0x4da87d;});const _0x4a7185=_0x289f2f[_0x26d8c2(0x1bc)](_0x47287e=>_0x47287e[_0x26d8c2(0x1a4)]!=='0'&&_0x47287e[_0x26d8c2(0x1a4)]!==''),_0xfa5dc5=new purchases_finished({'invoice':_0x308d0a,'suppliers':_0x541d56[_0x26d8c2(0x1d3)]['suppliers'],'date':_0x4ec45c,'warehouse_name':_0x5abc46,'product':_0x4a7185,'note':_0x46b421,'due_amount':_0x567674,'room':_0x57bdb9,'POnumber':_0x3a970d,'SCRN':_0x5bde64,'JO_number':_0x5547f5}),_0x28ae73=await _0xfa5dc5['save'](),_0x285498=await purchases_finished['findOne']({'invoice':_0x308d0a}),_0x4e16f7=_0x285498[_0x26d8c2(0x1ca)]['map'](async _0x2e5610=>{var _0x1ff335=_0x26d8c2;try{var _0x174c81=await warehouse[_0x1ff335(0x260)]({'name':_0x5abc46,'room':_0x2e5610[_0x1ff335(0x149)]}),_0x4b647c=0x0;const _0x129f14=_0x174c81['product_details'][_0x1ff335(0x1f1)](_0x3f6758=>{var _0x547ef2=_0x1ff335;console['log'](_0x3f6758[_0x547ef2(0x1a5)]+'=='+_0x2e5610['product_name']+'&&'+_0x3f6758[_0x547ef2(0x184)]+'=='+_0x2e5610[_0x547ef2(0x184)]+'&&'+_0x3f6758[_0x547ef2(0x1e0)]+'=='+_0x2e5610['expiry_date']+'&&'+_0x3f6758[_0x547ef2(0x1b6)]+'=='+_0x2e5610['production_date']+'&&'+_0x3f6758[_0x547ef2(0x1f4)]+'=='+_0x2e5610['batch_code']+'&&'+_0x3f6758[_0x547ef2(0x228)]+'=='+_0x285498['invoice']),_0x3f6758[_0x547ef2(0x1a5)]==_0x2e5610['product_name']&&_0x3f6758[_0x547ef2(0x184)]==_0x2e5610[_0x547ef2(0x184)]&&_0x3f6758[_0x547ef2(0x1e0)]==_0x2e5610[_0x547ef2(0x1e0)]&&_0x3f6758[_0x547ef2(0x1b6)]==_0x2e5610[_0x547ef2(0x1b6)]&&_0x3f6758[_0x547ef2(0x1f4)]==_0x2e5610['batch_code']&&_0x3f6758[_0x547ef2(0x228)]==_0x285498[_0x547ef2(0x228)]&&(_0x3f6758[_0x547ef2(0x1c7)]=Math[_0x547ef2(0x216)](_0x3f6758[_0x547ef2(0x1c7)])+Math['abs'](_0x2e5610[_0x547ef2(0x1a4)]),_0x4b647c++);});return _0x4b647c==0x0&&(_0x174c81[_0x1ff335(0x1f7)]=_0x174c81['product_details'][_0x1ff335(0x1a1)]({'product_name':_0x2e5610[_0x1ff335(0x1a5)],'product_stock':Math[_0x1ff335(0x216)](_0x2e5610[_0x1ff335(0x1a4)]),'primary_code':_0x2e5610['primary_code'],'secondary_code':_0x2e5610['secondary_code'],'product_code':_0x2e5610[_0x1ff335(0x195)],'bay':_0x2e5610['bay'],'maxProducts':_0x2e5610['maxStocks'],'unit':_0x2e5610[_0x1ff335(0x148)],'secondary_unit':_0x2e5610[_0x1ff335(0x251)],'expiry_date':_0x2e5610[_0x1ff335(0x1e0)],'production_date':_0x2e5610[_0x1ff335(0x1b6)],'maxProducts':_0x2e5610[_0x1ff335(0x17d)],'maxPerUnit':_0x2e5610[_0x1ff335(0x225)],'batch_code':_0x2e5610[_0x1ff335(0x1f4)],'product_cat':_0x2e5610[_0x1ff335(0x1bb)],'invoice':_0x2e5610['invoice'],'id_incoming':_0x2e5610[_0x1ff335(0x235)],'date_data':_0x2e5610[_0x1ff335(0x24a)]})),_0x174c81;}catch(_0xc793b3){return console[_0x1ff335(0x17e)](_0x1ff335(0x230),_0xc793b3),null;}});Promise[_0x26d8c2(0x1c4)](_0x4e16f7)[_0x26d8c2(0x1b9)](async _0x1e5ffb=>{var _0x3f96b5=_0x26d8c2;try{for(const _0x3fdd44 of _0x1e5ffb){await warehouse['updateOne']({'_id':_0x3fdd44[_0x3f96b5(0x235)]},{'$addToSet':{'product_details':{'$each':_0x3fdd44[_0x3f96b5(0x1f7)]}}});}const _0x113ee7=await master_shop[_0x3f96b5(0x20d)](),_0x106bf7=await email_settings['findOne'](),_0x25aa2d=await supervisor_settings[_0x3f96b5(0x20d)]();var _0x89975a=_0x285498[_0x3f96b5(0x1ca)],_0x1673ef='',_0x597c53;for(_0x597c53 in _0x89975a){var _0x1e9022='FG';_0x285498['warehouse_name']==_0x3f96b5(0x24d)&&(_0x1e9022='DG'),_0x1673ef+=_0x3f96b5(0x176)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x89975a[_0x597c53]['product_name']+_0x3f96b5(0x15c)+_0x3f96b5(0x1ae)+_0x89975a[_0x597c53][_0x3f96b5(0x195)]+_0x3f96b5(0x15c)+_0x3f96b5(0x1ae)+_0x89975a[_0x597c53][_0x3f96b5(0x1a4)]+_0x3f96b5(0x15c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x89975a[_0x597c53][_0x3f96b5(0x148)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x89975a[_0x597c53][_0x3f96b5(0x251)]+_0x3f96b5(0x15c)+_0x3f96b5(0x1ae)+_0x285498['warehouse_name']+_0x3f96b5(0x15c)+_0x3f96b5(0x1ae)+_0x89975a[_0x597c53][_0x3f96b5(0x149)]+_0x3f96b5(0x15c)+_0x3f96b5(0x1ae)+_0x1e9022+_0x89975a[_0x597c53][_0x3f96b5(0x184)]+_0x3f96b5(0x15c),'</tr>';}let _0xe45192=nodemailer[_0x3f96b5(0x17a)]({'host':_0x106bf7[_0x3f96b5(0x182)],'port':Number(_0x106bf7[_0x3f96b5(0x221)]),'secure':![],'auth':{'user':_0x106bf7[_0x3f96b5(0x167)],'pass':_0x106bf7[_0x3f96b5(0x18a)]}}),_0x22f97e={'from':_0x106bf7[_0x3f96b5(0x167)],'to':_0x25aa2d[0x0][_0x3f96b5(0x1a0)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x3f96b5(0x1ac),'path':__dirname+'/../public'+_0x3f96b5(0x1f0)+_0x113ee7[0x0]['image'],'cid':_0x3f96b5(0x1bf)}],'html':_0x3f96b5(0x1b5)+_0x3f96b5(0x1d6)+_0x3f96b5(0x1a6)+'<div>'+_0x3f96b5(0x204)+_0x3f96b5(0x211)+_0x3f96b5(0x20b)+'</div>'+'<div>'+'<h2>\x20'+_0x113ee7[0x0][_0x3f96b5(0x172)]+_0x3f96b5(0x18d)+'</div>'+_0x3f96b5(0x188)+_0x3f96b5(0x233)+_0x3f96b5(0x211)+_0x3f96b5(0x24f)+_0x3f96b5(0x203)+_0x285498['invoice']+'\x20'+_0x3f96b5(0x1db)+'\x20Order\x20Date\x20:\x20'+_0x285498['date']+'\x20'+_0x3f96b5(0x1ab)+_0x3f96b5(0x15b)+_0x3f96b5(0x188)+_0x3f96b5(0x16c)+_0x3f96b5(0x161)+_0x3f96b5(0x176)+_0x3f96b5(0x1e1)+_0x3f96b5(0x1a8)+_0x3f96b5(0x1e3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x3f96b5(0x1f9)+_0x3f96b5(0x192)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x3f96b5(0x23b)+_0x3f96b5(0x23c)+'</thead>'+_0x3f96b5(0x170)+'\x20'+_0x1673ef+'\x20'+_0x3f96b5(0x16f)+_0x3f96b5(0x1dd)+_0x3f96b5(0x211)+_0x3f96b5(0x1ad)+'<h5>'+_0x113ee7[0x0][_0x3f96b5(0x172)]+_0x3f96b5(0x15b)+_0x3f96b5(0x188)+'</div>'+'</body></html>'};_0xe45192['sendMail'](_0x22f97e,function(_0x48dcbe,_0x86dc1e){var _0x40673b=_0x3f96b5;_0x48dcbe?(console[_0x40673b(0x1ea)](_0x48dcbe),console[_0x40673b(0x1ea)](_0x40673b(0x215))):console[_0x40673b(0x1ea)]('Email\x20sent\x20successfully');});}catch(_0x4cceda){console[_0x3f96b5(0x17e)](_0x4cceda),_0x40219e['status'](0x1f4)[_0x3f96b5(0x1f3)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x4cceda['message']});}})['catch'](_0x5af69b=>{var _0x1a0c23=_0x26d8c2;console[_0x1a0c23(0x17e)](_0x5af69b);}),_0x541d56[_0x26d8c2(0x21e)](_0x26d8c2(0x1b1),_0x26d8c2(0x156)),_0x40219e[_0x26d8c2(0x261)](_0x26d8c2(0x219));}catch(_0x4051ef){console[_0x26d8c2(0x1ea)](_0x4051ef);}}),router[a0_0x553e1d(0x1d8)](a0_0x553e1d(0x206),auth,async(_0xb66e67,_0x4d1630)=>{var _0x165471=a0_0x553e1d;try{const {username:_0x1bfd71,email:_0x3cf519,role:_0x3c352c}=_0xb66e67[_0x165471(0x227)],_0x4f285f=_0xb66e67[_0x165471(0x227)],_0x59a35a=await profile[_0x165471(0x260)]({'email':_0x4f285f[_0x165471(0x167)]}),_0x365abd=await master_shop[_0x165471(0x20d)](),_0x437cef=_0xb66e67['params']['id'],_0x39cc88=await purchases_finished['findById'](_0x437cef),_0x5cbfad=await suppliers[_0x165471(0x20d)]({});let _0x56f142;if(_0x4f285f[_0x165471(0x209)]==_0x165471(0x20f)){const _0x1cff27=await staff['findOne']({'email':_0x4f285f[_0x165471(0x167)]});_0x56f142=await warehouse[_0x165471(0x20d)]({'status':'Enabled','name':_0x1cff27[_0x165471(0x199)],'warehouse_category':_0x165471(0x1a7)});}else _0x56f142=await warehouse[_0x165471(0x158)]([{'$match':{'status':_0x165471(0x240),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x165471(0x153),'name':{'$first':_0x165471(0x153)}}}]);const _0x112818=await product[_0x165471(0x20d)]({}),_0x2237ed=BayBinSelected(_0x39cc88[_0x165471(0x1c3)],_0x39cc88['room']);let _0x1cc21b=new Date(_0x39cc88[_0x165471(0x1e0)]),_0x4cb522=('0'+_0x1cc21b[_0x165471(0x239)]())[_0x165471(0x18b)](-0x2),_0x57fade=('0'+(_0x1cc21b['getMonth']()+0x1))['slice'](-0x2),_0x247c10=_0x1cc21b[_0x165471(0x180)](),_0x3dca84=_0x247c10+'-'+_0x57fade+'-'+_0x4cb522;if(_0x365abd[0x0][_0x165471(0x164)]==_0x165471(0x208)){var _0x2c57bb=users['English'];console['log'](_0x2c57bb);}else{if(_0x365abd[0x0][_0x165471(0x164)]==_0x165471(0x1b2))var _0x2c57bb=users[_0x165471(0x1b2)];else{if(_0x365abd[0x0]['language']=='German')var _0x2c57bb=users[_0x165471(0x200)];else{if(_0x365abd[0x0][_0x165471(0x164)]==_0x165471(0x244))var _0x2c57bb=users[_0x165471(0x244)];else{if(_0x365abd[0x0]['language']==_0x165471(0x1d1))var _0x2c57bb=users[_0x165471(0x1d1)];else{if(_0x365abd[0x0][_0x165471(0x164)]==_0x165471(0x17b))var _0x2c57bb=users['Portuguese'];else{if(_0x365abd[0x0][_0x165471(0x164)]==_0x165471(0x1ba))var _0x2c57bb=users[_0x165471(0x1ba)];else{if(_0x365abd[0x0][_0x165471(0x164)]==_0x165471(0x24b))var _0x2c57bb=users[_0x165471(0x1e4)];}}}}}}}_0x4d1630[_0x165471(0x23d)](_0x165471(0x1cd),{'success':_0xb66e67['flash']('success'),'errors':_0xb66e67[_0x165471(0x21e)](_0x165471(0x1d2)),'role':_0x4f285f,'profile':_0x59a35a,'purchases':_0x39cc88,'suppliers':_0x5cbfad,'warehouse':_0x56f142,'product':_0x112818,'master_shop':_0x365abd,'language':_0x2c57bb,'ed_fullDate':_0x3dca84,'dataSelected':_0x2237ed});}catch(_0x2016fe){console[_0x165471(0x1ea)](_0x2016fe);}}),router[a0_0x553e1d(0x1d8)]('/view/:id',auth,async(_0x2970a2,_0x57a710)=>{var _0x182542=a0_0x553e1d;try{const {username:_0x253113,email:_0x4e87f2,role:_0x434d89}=_0x2970a2[_0x182542(0x227)],_0x10d107=_0x2970a2['user'],_0x27bca5=await profile[_0x182542(0x260)]({'email':_0x10d107[_0x182542(0x167)]}),_0x1b700b=await master_shop[_0x182542(0x20d)](),_0x46b39f=_0x2970a2[_0x182542(0x19b)]['id'],_0x4048a1=await purchases_finished[_0x182542(0x196)](_0x46b39f),_0x303d3a=await suppliers[_0x182542(0x20d)]({});let _0x5839ec;if(_0x10d107[_0x182542(0x209)]==_0x182542(0x20f)){const _0x1cf9f6=await staff['findOne']({'email':_0x10d107['email']});_0x5839ec=await warehouse[_0x182542(0x20d)]({'status':'Enabled','name':_0x1cf9f6['warehouse'],'warehouse_category':_0x182542(0x1a7)});}else _0x5839ec=await warehouse[_0x182542(0x158)]([{'$match':{'status':_0x182542(0x240),'warehouse_category':_0x182542(0x1a7)}},{'$group':{'_id':_0x182542(0x153),'name':{'$first':_0x182542(0x153)}}}]);const _0x3a67f1=await product[_0x182542(0x20d)]({}),_0x161476=BayBinSelected(_0x4048a1['warehouse_name'],_0x4048a1[_0x182542(0x1ff)]);let _0x45f12b=new Date(_0x4048a1[_0x182542(0x1e0)]),_0x29a450=('0'+_0x45f12b['getDate']())['slice'](-0x2),_0x1b8bea=('0'+(_0x45f12b[_0x182542(0x1ec)]()+0x1))[_0x182542(0x18b)](-0x2),_0x89e552=_0x45f12b['getFullYear'](),_0x4ee463=_0x89e552+'-'+_0x1b8bea+'-'+_0x29a450;if(_0x1b700b[0x0]['language']==_0x182542(0x208)){var _0x553ef2=users['English'];console[_0x182542(0x1ea)](_0x553ef2);}else{if(_0x1b700b[0x0][_0x182542(0x164)]==_0x182542(0x1b2))var _0x553ef2=users['Hindi'];else{if(_0x1b700b[0x0]['language']==_0x182542(0x200))var _0x553ef2=users[_0x182542(0x200)];else{if(_0x1b700b[0x0][_0x182542(0x164)]=='Spanish')var _0x553ef2=users[_0x182542(0x244)];else{if(_0x1b700b[0x0]['language']==_0x182542(0x1d1))var _0x553ef2=users['French'];else{if(_0x1b700b[0x0]['language']==_0x182542(0x17b))var _0x553ef2=users[_0x182542(0x1b8)];else{if(_0x1b700b[0x0][_0x182542(0x164)]==_0x182542(0x1ba))var _0x553ef2=users[_0x182542(0x1ba)];else{if(_0x1b700b[0x0]['language']==_0x182542(0x24b))var _0x553ef2=users[_0x182542(0x1e4)];}}}}}}}_0x57a710[_0x182542(0x23d)](_0x182542(0x194),{'success':_0x2970a2['flash']('success'),'errors':_0x2970a2[_0x182542(0x21e)](_0x182542(0x1d2)),'role':_0x10d107,'profile':_0x27bca5,'purchases':_0x4048a1,'suppliers':_0x303d3a,'warehouse':_0x5839ec,'product':_0x3a67f1,'master_shop':_0x1b700b,'language':_0x553ef2,'ed_fullDate':_0x4ee463,'dataSelected':_0x161476});}catch(_0x11b916){console['log'](_0x11b916);}}),router[a0_0x553e1d(0x229)](a0_0x553e1d(0x210),auth,async(_0x59760a,_0x15f075)=>{var _0x329d84=a0_0x553e1d;try{const _0x42692b=_0x59760a[_0x329d84(0x19b)]['id'],_0x5a80be=await purchases_finished['findOne']({'_id':_0x59760a[_0x329d84(0x19b)]['id']}),_0xb27438=await warehouse[_0x329d84(0x260)]({'name':_0x5a80be[_0x329d84(0x1c3)],'room':_0x5a80be['room']});_0x5a80be['product'][_0x329d84(0x1f2)](_0x1f8f41=>{var _0x54cb3f=_0x329d84;const _0x5cdfbd=_0xb27438[_0x54cb3f(0x1f7)]['map'](_0x1c5852=>{var _0xeea849=_0x54cb3f;_0x1c5852[_0xeea849(0x1a5)]==_0x1f8f41[_0xeea849(0x1a5)]&&_0x1c5852[_0xeea849(0x184)]==_0x1f8f41['bay']&&(_0x1c5852[_0xeea849(0x1c7)]=parseInt(_0x1c5852['product_stock'])-parseInt(_0x1f8f41[_0xeea849(0x1a4)]));});}),await _0xb27438['save']();const {invoice:_0x59ed0f,suppliers:_0x5d68ab,date:_0x16edf0,warehouse_name:_0x597a98,prod_name:_0x297fc5,prod_code:_0x29b3b7,prod_qty:_0x21bdb8,prod_unit:_0x2dd1b1,prod_secondunit:_0x186d73,prod_level:_0xc0e2fc,prod_isle:_0x272987,prod_pallet:_0x1d0a5e,note:_0xb73e0b,expiry_date:_0x4029a0,batch_code:_0x1e9546,paid_amount:_0x36288b,due_amount:_0x4e1eec,Room_name:_0x42d5fd,primary_code:_0x1d47a7,secondary_code:_0x1b0e01,PO_number:_0x39ed77,JO_number:_0x58f1f3}=_0x59760a[_0x329d84(0x1d3)];if(typeof _0x297fc5==_0x329d84(0x14c))var _0x42e28a=[_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x214)]],_0x7a27bb=[_0x59760a['body'][_0x329d84(0x191)]],_0x310952=[_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x236)]],_0x1752b3=[_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x1cf)]],_0xd57cf8=[_0x59760a['body'][_0x329d84(0x223)]],_0x3da2ad=[_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x22b)]],_0xb4e0c0=[_0x59760a['body'][_0x329d84(0x254)]],_0x172574=[_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x22f)]],_0x371eb2=[_0x59760a['body']['MaxStocks_data']],_0x245bf4=[_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x1f4)]],_0x1fa5a4=[_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x1e0)]];else var _0x42e28a=[..._0x59760a[_0x329d84(0x1d3)][_0x329d84(0x214)]],_0x7a27bb=[..._0x59760a[_0x329d84(0x1d3)][_0x329d84(0x191)]],_0x310952=[..._0x59760a[_0x329d84(0x1d3)][_0x329d84(0x236)]],_0x1752b3=[..._0x59760a[_0x329d84(0x1d3)]['prod_unit']],_0xd57cf8=[..._0x59760a[_0x329d84(0x1d3)][_0x329d84(0x223)]],_0x3da2ad=[..._0x59760a['body'][_0x329d84(0x22b)]],_0xb4e0c0=[..._0x59760a[_0x329d84(0x1d3)][_0x329d84(0x254)]],_0x172574=[..._0x59760a[_0x329d84(0x1d3)]['secondary_code']],_0x371eb2=[..._0x59760a[_0x329d84(0x1d3)][_0x329d84(0x190)]],_0x245bf4=[..._0x59760a[_0x329d84(0x1d3)][_0x329d84(0x1f4)]],_0x1fa5a4=[..._0x59760a[_0x329d84(0x1d3)][_0x329d84(0x1e0)]];const _0x56bba0=_0x42e28a[_0x329d84(0x1f1)](_0x5337f9=>{return _0x5337f9={'product_name':_0x5337f9};});_0x7a27bb['forEach']((_0x1a6b3e,_0x1f19c5)=>{_0x56bba0[_0x1f19c5]['product_code']=_0x1a6b3e;}),_0x310952[_0x329d84(0x1f2)]((_0x885c8,_0x34eea0)=>{var _0x14b3f9=_0x329d84;_0x56bba0[_0x34eea0][_0x14b3f9(0x1a4)]=_0x885c8;}),_0x1752b3[_0x329d84(0x1f2)]((_0x214c1e,_0xb2049)=>{var _0xc0c696=_0x329d84;_0x56bba0[_0xb2049][_0xc0c696(0x148)]=_0x214c1e;}),_0xd57cf8[_0x329d84(0x1f2)]((_0x2252f9,_0x348c5f)=>{_0x56bba0[_0x348c5f]['secondary_unit']=_0x2252f9;}),_0x3da2ad[_0x329d84(0x1f2)]((_0x1762d7,_0x7fe8c2)=>{var _0x18781f=_0x329d84;_0x56bba0[_0x7fe8c2][_0x18781f(0x184)]=_0x1762d7;}),_0xb4e0c0[_0x329d84(0x1f2)]((_0x445950,_0x129244)=>{var _0x40cb1d=_0x329d84;_0x56bba0[_0x129244][_0x40cb1d(0x254)]=_0x445950;}),_0x172574[_0x329d84(0x1f2)]((_0x5f2314,_0x3c7a75)=>{_0x56bba0[_0x3c7a75]['secondary_code']=_0x5f2314;}),_0x371eb2[_0x329d84(0x1f2)]((_0x5d61ca,_0x326a98)=>{var _0x506d05=_0x329d84;_0x56bba0[_0x326a98][_0x506d05(0x17d)]=_0x5d61ca;}),_0x245bf4[_0x329d84(0x1f2)]((_0x3d0844,_0x59f41b)=>{var _0x40e696=_0x329d84;_0x56bba0[_0x59f41b][_0x40e696(0x1f4)]=_0x3d0844;}),_0x1fa5a4[_0x329d84(0x1f2)]((_0x1db97e,_0x43a9c9)=>{var _0xdc1a6e=_0x329d84;_0x56bba0[_0x43a9c9][_0xdc1a6e(0x1e0)]=_0x1db97e;});const _0x2b9d00=_0x56bba0[_0x329d84(0x1bc)](_0xa5d6d1=>_0xa5d6d1[_0x329d84(0x1a4)]!=='0'&&_0xa5d6d1[_0x329d84(0x1a4)]!=='');_0x5a80be[_0x329d84(0x228)]=_0x59ed0f,_0x5a80be['suppliers']=_0x5d68ab,_0x5a80be[_0x329d84(0x234)]=_0x16edf0,_0x5a80be['warehouse_name']=_0x597a98,_0x5a80be['product']=_0x2b9d00,_0x5a80be[_0x329d84(0x1c1)]=_0xb73e0b,_0x5a80be['paid_amount']=_0x36288b,_0x5a80be[_0x329d84(0x207)]=_0x4e1eec,_0x5a80be[_0x329d84(0x1ff)]=_0x42d5fd,_0x5a80be[_0x329d84(0x14e)]=_0x39ed77,_0x5a80be['JO_number']=_0x58f1f3;const _0x32b1f1=await _0x5a80be[_0x329d84(0x265)](),_0x2df21d=await warehouse[_0x329d84(0x260)]({'name':_0x59760a['body'][_0x329d84(0x1c3)],'room':_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x1d0)]});_0x5a80be[_0x329d84(0x1ca)][_0x329d84(0x1f2)](_0x371aa9=>{var _0x4a2404=_0x329d84,_0xef4608=0x0;const _0x3cd0a4=_0x2df21d[_0x4a2404(0x1f7)][_0x4a2404(0x1f1)](_0x2765d8=>{var _0x1c92bd=_0x4a2404;_0x2765d8[_0x1c92bd(0x1a5)]==_0x371aa9[_0x1c92bd(0x1a5)]&&_0x2765d8['bay']==_0x371aa9[_0x1c92bd(0x184)]&&(_0x2765d8['product_stock']=parseInt(_0x2765d8[_0x1c92bd(0x1c7)])+parseInt(_0x371aa9['quantity']),_0xef4608++);});_0xef4608=='0'&&(_0x2df21d['product_details']=_0x2df21d['product_details'][_0x4a2404(0x1a1)]({'product_name':_0x371aa9['product_name'],'product_stock':_0x371aa9[_0x4a2404(0x1a4)],'primary_code':_0x371aa9[_0x4a2404(0x254)],'secondary_code':_0x371aa9[_0x4a2404(0x22f)],'product_code':_0x371aa9[_0x4a2404(0x195)],'bay':_0x371aa9[_0x4a2404(0x184)],'maxProducts':_0x371aa9['maxStocks'],'unit':_0x371aa9[_0x4a2404(0x148)],'secondary_unit':_0x371aa9[_0x4a2404(0x251)],'expiry_date':_0x371aa9[_0x4a2404(0x1e0)]}));}),await _0x2df21d[_0x329d84(0x265)]();const _0x1cda2f=await s_payment_data[_0x329d84(0x260)]({'invoice':_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x228)]});if(_0x1cda2f===null){}else console[_0x329d84(0x1ea)](_0x329d84(0x259),_0x1cda2f,_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x228)]),_0x1cda2f['suppliers']=_0x59760a[_0x329d84(0x1d3)][_0x329d84(0x259)],await _0x1cda2f[_0x329d84(0x265)]();_0x59760a[_0x329d84(0x21e)](_0x329d84(0x1b1),_0x329d84(0x15e)),_0x15f075[_0x329d84(0x261)]('/all_purchases_finished/view');}catch(_0x26d647){console[_0x329d84(0x1ea)](_0x26d647);}}),router[a0_0x553e1d(0x229)](a0_0x553e1d(0x1e6),auth,async(_0x24c1c0,_0x37b2e7)=>{var _0x89fd5c=a0_0x553e1d;try{const _0x381eba=_0x24c1c0['params']['id'],{invoice:_0x4d4555,suppliers:_0x3a92af,payable:_0x53f67a,due_amount:_0xbb7318}=_0x24c1c0[_0x89fd5c(0x1d3)],_0x45b591=await purchases[_0x89fd5c(0x196)](_0x381eba);var _0x3a38a4=_0x53f67a-_0xbb7318;_0x45b591[_0x89fd5c(0x177)]=parseFloat(_0x45b591['paid_amount'])+parseFloat(_0xbb7318),_0x45b591[_0x89fd5c(0x207)]=_0x3a38a4;const _0x44d595=await _0x45b591['save']();console[_0x89fd5c(0x1ea)](_0x44d595);const _0x4d2626=await s_payment_data[_0x89fd5c(0x260)]({'invoice':_0x4d4555});_0x4d2626[_0x89fd5c(0x250)]=_0x3a38a4,await _0x4d2626[_0x89fd5c(0x265)]();let _0x247046=new Date(),_0x58a3b0=('0'+_0x247046[_0x89fd5c(0x239)]())[_0x89fd5c(0x18b)](-0x2),_0x53f9e7=('0'+(_0x247046[_0x89fd5c(0x1ec)]()+0x1))[_0x89fd5c(0x18b)](-0x2),_0x4e5b54=_0x247046[_0x89fd5c(0x180)](),_0x5c396b=_0x4e5b54+'-'+_0x53f9e7+'-'+_0x58a3b0;const _0x347eff=new suppliers_payment({'invoice':_0x4d4555,'date':_0x4e5b54+'-'+_0x53f9e7+'-'+_0x58a3b0,'suppliers':_0x3a92af,'reason':'Paid\x20For\x20Purchase','amount':_0xbb7318}),_0x3fb1f8=await _0x347eff[_0x89fd5c(0x265)]();_0x24c1c0[_0x89fd5c(0x21e)]('success',_0x89fd5c(0x1ce)),_0x37b2e7['redirect'](_0x89fd5c(0x252));}catch(_0x1664b4){console['log'](_0x1664b4);}}),router[a0_0x553e1d(0x1d8)](a0_0x553e1d(0x247),auth,async(_0x414407,_0x391959)=>{var _0x27dd19=a0_0x553e1d;try{const {username:_0x58884b,email:_0x1c6a19,role:_0x269917}=_0x414407['user'],_0x34f441=_0x414407[_0x27dd19(0x227)],_0x4678c0=await profile[_0x27dd19(0x260)]({'email':_0x34f441[_0x27dd19(0x167)]}),_0x3fb6ca=await master_shop['find']();console[_0x27dd19(0x1ea)](_0x27dd19(0x189),_0x3fb6ca);const _0x82a663=_0x414407['params']['id'],_0x38b02f=await purchases[_0x27dd19(0x196)](_0x82a663);console[_0x27dd19(0x1ea)](_0x38b02f);const _0x2947a9=await suppliers[_0x27dd19(0x260)]({'name':_0x38b02f[_0x27dd19(0x259)]});console[_0x27dd19(0x1ea)](_0x2947a9);if(_0x3fb6ca[0x0][_0x27dd19(0x164)]==_0x27dd19(0x208)){var _0x2c344e=users['English'];console['log'](_0x2c344e);}else{if(_0x3fb6ca[0x0][_0x27dd19(0x164)]==_0x27dd19(0x1b2))var _0x2c344e=users[_0x27dd19(0x1b2)];else{if(_0x3fb6ca[0x0][_0x27dd19(0x164)]==_0x27dd19(0x200))var _0x2c344e=users[_0x27dd19(0x200)];else{if(_0x3fb6ca[0x0][_0x27dd19(0x164)]=='Spanish')var _0x2c344e=users[_0x27dd19(0x244)];else{if(_0x3fb6ca[0x0]['language']==_0x27dd19(0x1d1))var _0x2c344e=users[_0x27dd19(0x1d1)];else{if(_0x3fb6ca[0x0][_0x27dd19(0x164)]==_0x27dd19(0x17b))var _0x2c344e=users[_0x27dd19(0x1b8)];else{if(_0x3fb6ca[0x0]['language']==_0x27dd19(0x1ba))var _0x2c344e=users[_0x27dd19(0x1ba)];else{if(_0x3fb6ca[0x0][_0x27dd19(0x164)]=='Arabic\x20(ae)')var _0x2c344e=users['Arabic'];}}}}}}}_0x391959[_0x27dd19(0x23d)](_0x27dd19(0x159),{'success':_0x414407['flash'](_0x27dd19(0x1b1)),'errors':_0x414407[_0x27dd19(0x21e)](_0x27dd19(0x1d2)),'role':_0x34f441,'profile':_0x4678c0,'master_shop':_0x3fb6ca,'supplier':_0x2947a9,'purchase':_0x38b02f,'language':_0x2c344e});}catch(_0x4209ad){console[_0x27dd19(0x1ea)](_0x4209ad);}}),router[a0_0x553e1d(0x1d8)](a0_0x553e1d(0x226),auth,async(_0xf5ac1b,_0x416df3)=>{var _0x274c4f=a0_0x553e1d;try{const {username:_0x42c776,email:_0x44548d,role:_0x1e43ec}=_0xf5ac1b[_0x274c4f(0x227)],_0x23f138=_0xf5ac1b[_0x274c4f(0x227)],_0x25e90e=await profile[_0x274c4f(0x260)]({'email':_0x23f138[_0x274c4f(0x167)]}),_0x1342d4=await master_shop[_0x274c4f(0x20d)]();console[_0x274c4f(0x1ea)](_0x274c4f(0x189),_0x1342d4);const _0x264f9b=_0xf5ac1b[_0x274c4f(0x19b)]['id'];console['log'](_0x264f9b);const _0x36cd77=await purchases_finished[_0x274c4f(0x196)](_0x264f9b);console[_0x274c4f(0x1ea)]('user_id',_0x36cd77);const _0x112d9e=await product[_0x274c4f(0x20d)]({}),_0x379382=await warehouse[_0x274c4f(0x158)]([{'$match':{'name':_0x36cd77[_0x274c4f(0x1c3)],'room':_0x36cd77[_0x274c4f(0x1ff)]}},{'$unwind':_0x274c4f(0x1f6)},{'$group':{'_id':_0x274c4f(0x16a),'name':{'$first':_0x274c4f(0x1fc)},'product_stock':{'$first':_0x274c4f(0x19a)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x274c4f(0x21c)},'type':{'$first':_0x274c4f(0x150)},'floorlevel':{'$first':_0x274c4f(0x165)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x274c4f(0x25a)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);console['log']('stock_data',_0x379382);let _0x48223c;if(_0x23f138['role']==_0x274c4f(0x20f)){const _0x55458c=await staff[_0x274c4f(0x260)]({'email':_0x23f138[_0x274c4f(0x167)]});_0x48223c=await warehouse['find']({'status':_0x274c4f(0x240),'name':_0x55458c['warehouse'],'warehouse_category':_0x274c4f(0x1a7),'name':_0x274c4f(0x16b)});}else _0x48223c=await warehouse[_0x274c4f(0x158)]([{'$match':{'status':_0x274c4f(0x240),'warehouse_category':'Finished\x20Goods','name':_0x274c4f(0x16b)}},{'$group':{'_id':_0x274c4f(0x153),'name':{'$first':_0x274c4f(0x153)}}}]);if(_0x1342d4[0x0][_0x274c4f(0x164)]==_0x274c4f(0x208)){var _0x13cd58=users[_0x274c4f(0x171)];console[_0x274c4f(0x1ea)](_0x13cd58);}else{if(_0x1342d4[0x0][_0x274c4f(0x164)]==_0x274c4f(0x1b2))var _0x13cd58=users['Hindi'];else{if(_0x1342d4[0x0][_0x274c4f(0x164)]==_0x274c4f(0x200))var _0x13cd58=users[_0x274c4f(0x200)];else{if(_0x1342d4[0x0][_0x274c4f(0x164)]==_0x274c4f(0x244))var _0x13cd58=users[_0x274c4f(0x244)];else{if(_0x1342d4[0x0][_0x274c4f(0x164)]==_0x274c4f(0x1d1))var _0x13cd58=users['French'];else{if(_0x1342d4[0x0][_0x274c4f(0x164)]==_0x274c4f(0x17b))var _0x13cd58=users[_0x274c4f(0x1b8)];else{if(_0x1342d4[0x0][_0x274c4f(0x164)]==_0x274c4f(0x1ba))var _0x13cd58=users[_0x274c4f(0x1ba)];else{if(_0x1342d4[0x0][_0x274c4f(0x164)]==_0x274c4f(0x24b))var _0x13cd58=users[_0x274c4f(0x1e4)];}}}}}}}_0x416df3[_0x274c4f(0x23d)](_0x274c4f(0x175),{'success':_0xf5ac1b[_0x274c4f(0x21e)]('success'),'errors':_0xf5ac1b['flash'](_0x274c4f(0x1d2)),'role':_0x23f138,'profile':_0x25e90e,'user':_0x36cd77,'stock':_0x379382,'master_shop':_0x1342d4,'product':_0x112d9e,'language':_0x13cd58,'warehouse':_0x48223c});}catch(_0x3c924c){console['log'](_0x3c924c);}}),router[a0_0x553e1d(0x229)](a0_0x553e1d(0x226),auth,async(_0x50ebbf,_0x316293)=>{var _0x5a3baa=a0_0x553e1d;try{const {invoice:_0xd804b5,date:_0x5e342a,warehouse_name:_0x3527dd,Room_name:_0x396cc5,product_name:_0x3a4c76,purchase_quantity:_0x519528,stocks:_0x476768,return_qty:_0x4d12de,note:_0x56ab89,level:_0x4a812c,isle:_0x2b1a93,pallet:_0x265316,to_warehouse_name:_0x2e71f8,to_Room_name:_0x4e72e7}=_0x50ebbf[_0x5a3baa(0x1d3)],_0x2ec9ae=await purchases_finished[_0x5a3baa(0x260)]({'_id':_0x50ebbf['params']['id']}),_0x5401e0=await warehouse[_0x5a3baa(0x260)]({'name':_0x3527dd,'room':_0x396cc5,'warehouse_category':'Finished\x20Goods'});if(typeof _0x3a4c76=='string')var _0x2c76c8=[_0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x1a5)]],_0x341fc3=[_0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x198)]],_0x379d2f=[_0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x183)]],_0x314c1f=[_0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x154)]],_0x3be695=[_0x50ebbf['body']['level']],_0x4ab978=[_0x50ebbf['body'][_0x5a3baa(0x20e)]],_0x1e504b=[_0x50ebbf['body'][_0x5a3baa(0x15a)]],_0x4051a0=[_0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x1fa)]];else var _0x2c76c8=[..._0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x1a5)]],_0x341fc3=[..._0x50ebbf['body']['purchase_quantity']],_0x379d2f=[..._0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x183)]],_0x314c1f=[..._0x50ebbf['body'][_0x5a3baa(0x154)]],_0x3be695=[..._0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x24e)]],_0x4ab978=[..._0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x20e)]],_0x1e504b=[..._0x50ebbf[_0x5a3baa(0x1d3)]['primary_code_hide']],_0x4051a0=[..._0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x1fa)]];const _0x2de2a9=_0x2c76c8[_0x5a3baa(0x1f1)](_0x18624a=>{return _0x18624a={'product_name':_0x18624a};});_0x341fc3['forEach']((_0x5648bf,_0x42819c)=>{var _0x143b0a=_0x5a3baa;_0x2de2a9[_0x42819c][_0x143b0a(0x198)]=_0x5648bf;}),_0x379d2f[_0x5a3baa(0x1f2)]((_0x27fb3c,_0x357ca4)=>{var _0x1bf6cb=_0x5a3baa;_0x2de2a9[_0x357ca4][_0x1bf6cb(0x25b)]=_0x27fb3c;}),_0x314c1f[_0x5a3baa(0x1f2)]((_0x4118b3,_0x2848e5)=>{var _0x52a6f6=_0x5a3baa;_0x2de2a9[_0x2848e5][_0x52a6f6(0x154)]=_0x4118b3;}),_0x3be695[_0x5a3baa(0x1f2)]((_0x460859,_0x772ce7)=>{var _0x2236c1=_0x5a3baa;_0x2de2a9[_0x772ce7][_0x2236c1(0x184)]=_0x460859;}),_0x4ab978['forEach']((_0x1ca37e,_0x1aeee3)=>{_0x2de2a9[_0x1aeee3]['product_code']=_0x1ca37e;}),_0x1e504b[_0x5a3baa(0x1f2)]((_0x5d438f,_0x179003)=>{_0x2de2a9[_0x179003]['primary_code']=_0x5d438f;}),_0x4051a0[_0x5a3baa(0x1f2)]((_0x5df00d,_0x50a04b)=>{var _0x222c70=_0x5a3baa;_0x2de2a9[_0x50a04b][_0x222c70(0x22f)]=_0x5df00d;}),_0x2de2a9[_0x5a3baa(0x1f2)](_0x25b31e=>{var _0x26d879=_0x5a3baa;console[_0x26d879(0x1ea)](_0x25b31e);const _0x33033d=_0x5401e0['product_details'][_0x26d879(0x1f1)](_0x20c7a5=>{var _0x966c81=_0x26d879;_0x20c7a5[_0x966c81(0x1a5)]==_0x25b31e[_0x966c81(0x1a5)]&&_0x20c7a5[_0x966c81(0x184)]==_0x25b31e['bay']&&(console[_0x966c81(0x1ea)](parseInt(_0x20c7a5['product_stock'])+_0x966c81(0x1bd)+parseInt(_0x25b31e[_0x966c81(0x154)])),_0x20c7a5['product_stock']=parseInt(_0x20c7a5[_0x966c81(0x1c7)])-parseInt(_0x25b31e[_0x966c81(0x154)]));});}),await _0x5401e0[_0x5a3baa(0x265)]();var _0x404b93=0x0;_0x2de2a9[_0x5a3baa(0x1f2)](_0x23b21a=>{var _0x5a6258=_0x5a3baa;(parseInt(_0x23b21a['purchase_quantity'])<parseInt(_0x23b21a['return_qty'])||parseInt(_0x23b21a[_0x5a6258(0x25b)])<parseInt(_0x23b21a[_0x5a6258(0x154)]))&&_0x404b93++;});if(_0x404b93!=0x0)return _0x50ebbf['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x316293[_0x5a3baa(0x261)]('back');const _0x59e071=new purchases_return_finished({'invoice':_0xd804b5,'suppliers':_0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x259)],'date':_0x5e342a,'warehouse_name':_0x3527dd,'return_product':_0x2de2a9,'note':_0x56ab89,'room':_0x396cc5,'to_warehouse_name':_0x2e71f8,'to_room':_0x4e72e7}),_0x2e62de=await _0x59e071['save'](),_0x45bde0=await purchases_return_finished['findOne']({'invoice':_0xd804b5}),_0x30ba0f=await warehouse[_0x5a3baa(0x260)]({'name':_0x2e71f8,'room':_0x4e72e7,'warehouse_category':_0x5a3baa(0x1a7)});_0x45bde0[_0x5a3baa(0x1c9)][_0x5a3baa(0x1f2)](_0x1dfd15=>{var _0x2de89a=_0x5a3baa,_0x2fba1f=0x0;const _0x158234=_0x30ba0f[_0x2de89a(0x1f7)][_0x2de89a(0x1f1)](_0x210b73=>{var _0x345727=_0x2de89a;console[_0x345727(0x1ea)](_0x210b73['product_name']+'=='+_0x1dfd15[_0x345727(0x1a5)]+'&&'+_0x210b73[_0x345727(0x184)]+'=='+_0x1dfd15[_0x345727(0x184)]),_0x210b73['product_name']==_0x1dfd15[_0x345727(0x1a5)]&&_0x210b73[_0x345727(0x184)]==_0x1dfd15[_0x345727(0x184)]&&(_0x210b73[_0x345727(0x1c7)]=parseInt(_0x210b73['product_stock'])-parseInt(_0x1dfd15[_0x345727(0x154)]),_0x2fba1f++);});_0x2fba1f=='0'&&(_0x30ba0f[_0x2de89a(0x1f7)]=_0x30ba0f['product_details'][_0x2de89a(0x1a1)]({'product_name':_0x1dfd15[_0x2de89a(0x1a5)],'product_stock':_0x1dfd15[_0x2de89a(0x154)],'primary_code':_0x1dfd15[_0x2de89a(0x254)],'secondary_code':_0x1dfd15['secondary_code'],'product_code':_0x1dfd15[_0x2de89a(0x195)],'bay':_0x1dfd15[_0x2de89a(0x184)],'maxProducts':0xf423f}));}),await _0x30ba0f[_0x5a3baa(0x265)]();const _0xf1e163=await purchases_finished['findOne']({'invoice':_0xd804b5});_0xf1e163[_0x5a3baa(0x23e)]=_0x5a3baa(0x17c);const _0x4f1b50=await _0xf1e163[_0x5a3baa(0x265)](),_0x1c2103=new s_payment_data({'invoice':_0xd804b5,'suppliers':_0x50ebbf[_0x5a3baa(0x1d3)][_0x5a3baa(0x259)],'reason':_0x5a3baa(0x179)});await _0x1c2103[_0x5a3baa(0x265)]();const _0x433886=await master_shop['find'](),_0x353c9e=await email_settings[_0x5a3baa(0x260)](),_0x3fe7ca=await suppliers[_0x5a3baa(0x260)]({'name':_0x50ebbf[_0x5a3baa(0x1d3)]['suppliers']});_0x433886[0x0][_0x5a3baa(0x21f)]==0x1?(right_currency=_0x433886[0x0][_0x5a3baa(0x1f8)],left_currency=''):(right_currency='',left_currency=_0x433886[0x0][_0x5a3baa(0x1f8)]);var _0x57b4cb=_0x2c76c8,_0x508e68=_0x314c1f,_0x13b371='',_0x88f857;for(_0x88f857 in _0x57b4cb){_0x13b371+=_0x5a3baa(0x176)+_0x5a3baa(0x1ae)+_0x57b4cb[_0x88f857]+_0x5a3baa(0x15c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x508e68[_0x88f857]+_0x5a3baa(0x15c)+_0x5a3baa(0x23c);}let _0x5d3346=nodemailer['createTransport']({'service':_0x5a3baa(0x220),'auth':{'user':_0x353c9e[_0x5a3baa(0x167)],'pass':_0x353c9e[_0x5a3baa(0x18a)]}}),_0x100d96={'from':_0x353c9e['email'],'to':_0x3fe7ca[_0x5a3baa(0x167)],'subject':_0x5a3baa(0x253),'attachments':[{'filename':_0x5a3baa(0x1ac),'path':__dirname+_0x5a3baa(0x1df)+_0x5a3baa(0x1f0)+_0x433886[0x0][_0x5a3baa(0x1eb)],'cid':_0x5a3baa(0x1bf)}],'html':_0x5a3baa(0x1b5)+_0x5a3baa(0x1d6)+'</head><body>'+_0x5a3baa(0x211)+_0x5a3baa(0x204)+_0x5a3baa(0x211)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5a3baa(0x188)+_0x5a3baa(0x211)+_0x5a3baa(0x19f)+_0x433886[0x0][_0x5a3baa(0x172)]+_0x5a3baa(0x18d)+'</div>'+_0x5a3baa(0x188)+_0x5a3baa(0x233)+_0x5a3baa(0x211)+_0x5a3baa(0x24f)+_0x5a3baa(0x203)+_0xd804b5+'\x20'+_0x5a3baa(0x1db)+_0x5a3baa(0x213)+_0x5e342a+'\x20'+_0x5a3baa(0x1ab)+_0x5a3baa(0x15b)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5a3baa(0x161)+_0x5a3baa(0x176)+_0x5a3baa(0x1e1)+_0x5a3baa(0x1dc)+_0x5a3baa(0x246)+_0x5a3baa(0x193)+_0x5a3baa(0x23c)+_0x5a3baa(0x187)+_0x5a3baa(0x170)+'\x20'+_0x13b371+'\x20'+_0x5a3baa(0x16f)+_0x5a3baa(0x1dd)+_0x5a3baa(0x211)+_0x5a3baa(0x1ad)+_0x5a3baa(0x19e)+_0x433886[0x0]['site_title']+_0x5a3baa(0x15b)+_0x5a3baa(0x188)+_0x5a3baa(0x188)+'</body></html>'};_0x5d3346[_0x5a3baa(0x243)](_0x100d96,function(_0x41b8f1,_0x29ef90){var _0x1c881e=_0x5a3baa;_0x41b8f1?console['log'](_0x1c881e(0x215)):console[_0x1c881e(0x1ea)](_0x1c881e(0x1c6));}),_0x50ebbf['flash']('success',_0x5a3baa(0x160)),_0x316293[_0x5a3baa(0x261)]('/all_purchases_finished/view');}catch(_0x28c326){_0x316293[_0x5a3baa(0x25d)](0xc8)[_0x5a3baa(0x1f3)]({'message':_0x28c326[_0x5a3baa(0x1d4)]});}}),router['get'](a0_0x553e1d(0x1cb),auth,async(_0xb754a6,_0x76d0d8)=>{var _0x12ca43=a0_0x553e1d;try{const {username:_0x5a633c,email:_0x3b2bf7,role:_0x4a058e}=_0xb754a6[_0x12ca43(0x227)],_0xc620fe=_0xb754a6[_0x12ca43(0x227)],_0x24afef=await profile[_0x12ca43(0x260)]({'email':_0xc620fe[_0x12ca43(0x167)]}),_0x4838d0=await master_shop[_0x12ca43(0x20d)](),_0x1b1204=_0xb754a6[_0x12ca43(0x19b)]['id'],_0x1b9ad9=await purchases_finished[_0x12ca43(0x196)](_0x1b1204);if(_0x4838d0[0x0][_0x12ca43(0x164)]==_0x12ca43(0x208))var _0x2e5a21=users[_0x12ca43(0x171)];else{if(_0x4838d0[0x0]['language']==_0x12ca43(0x1b2))var _0x2e5a21=users[_0x12ca43(0x1b2)];else{if(_0x4838d0[0x0][_0x12ca43(0x164)]==_0x12ca43(0x200))var _0x2e5a21=users['German'];else{if(_0x4838d0[0x0][_0x12ca43(0x164)]==_0x12ca43(0x244))var _0x2e5a21=users[_0x12ca43(0x244)];else{if(_0x4838d0[0x0][_0x12ca43(0x164)]==_0x12ca43(0x1d1))var _0x2e5a21=users[_0x12ca43(0x1d1)];else{if(_0x4838d0[0x0]['language']==_0x12ca43(0x17b))var _0x2e5a21=users[_0x12ca43(0x1b8)];else{if(_0x4838d0[0x0][_0x12ca43(0x164)]==_0x12ca43(0x1ba))var _0x2e5a21=users[_0x12ca43(0x1ba)];else{if(_0x4838d0[0x0]['language']=='Arabic\x20(ae)')var _0x2e5a21=users[_0x12ca43(0x1e4)];}}}}}}}_0x76d0d8[_0x12ca43(0x23d)]('all_purchases_barcode',{'success':_0xb754a6[_0x12ca43(0x21e)](_0x12ca43(0x1b1)),'errors':_0xb754a6[_0x12ca43(0x21e)]('errors'),'role':_0xc620fe,'profile':_0x24afef,'alldata':_0x1b9ad9,'master_shop':_0x4838d0,'language':_0x2e5a21}),console[_0x12ca43(0x1ea)](alldata);}catch(_0x3e7fb3){console['log'](_0x3e7fb3);}}),router['post'](a0_0x553e1d(0x266),async(_0x4feba0,_0x42fe9b)=>{var _0x49784d=a0_0x553e1d;const {product_code:_0x27444b}=_0x4feba0[_0x49784d(0x1d3)];var _0xccd665;const _0x11144d=await product['aggregate']([{'$match':{'primary_code':_0x27444b,'product_category':_0x49784d(0x1a7)}},{'$group':{'_id':'$_id','name':{'$first':_0x49784d(0x153)},'category':{'$first':_0x49784d(0x1e8)},'brand':{'$first':'$brand'},'unit':{'$first':_0x49784d(0x1b4)},'alertquantity':{'$first':_0x49784d(0x1c8)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x49784d(0x157)},'secondary_code':{'$first':_0x49784d(0x245)},'maxStocks':{'$first':_0x49784d(0x1b7)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x49784d(0x17f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x157616=await product[_0x49784d(0x158)]([{'$match':{'secondary_code':_0x27444b}},{'$group':{'_id':_0x49784d(0x14b),'name':{'$first':_0x49784d(0x153)},'category':{'$first':_0x49784d(0x1e8)},'brand':{'$first':'$brand'},'unit':{'$first':_0x49784d(0x1b4)},'alertquantity':{'$first':_0x49784d(0x1c8)},'product_code':{'$first':_0x49784d(0x1da)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x49784d(0x17f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x11144d[_0x49784d(0x16d)]>0x0)_0xccd665=_0x11144d;else _0x157616[_0x49784d(0x16d)]>0x0&&(_0xccd665=_0x157616);_0x42fe9b['json'](_0xccd665);}),router[a0_0x553e1d(0x229)](a0_0x553e1d(0x152),async(_0x51433e,_0x23e04a)=>{var _0x2011d6=a0_0x553e1d;const {product_code:_0x108861}=_0x51433e[_0x2011d6(0x1d3)];var _0x1b295f;const _0x5a338a=await product['aggregate']([{'$match':{'product_code_spmx':_0x108861,'product_category':_0x2011d6(0x25f)}},{'$group':{'_id':_0x2011d6(0x14b),'category':{'$first':_0x2011d6(0x1e8)},'brand':{'$first':'$brand'},'unit':{'$first':_0x2011d6(0x1b4)},'product_code_spmx':{'$first':_0x2011d6(0x1be)},'product_code':{'$first':_0x2011d6(0x1da)},'primary_code':{'$first':_0x2011d6(0x157)},'secondary_code':{'$first':'$secondary_code'},'product_cat':{'$first':_0x2011d6(0x25f)}}},{'$project':{'_id':0x1,'category':0x1,'brand':0x1,'unit':0x1,'product_code_spmx':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'product_cat':0x1}}]);_0x1b295f=_0x5a338a,_0x23e04a[_0x2011d6(0x1f3)](_0x1b295f);}),router['post'](a0_0x553e1d(0x1c2),async(_0x23c982,_0x39b03e)=>{var _0x426dea=a0_0x553e1d;const {productCode:_0x1342c8,bay:_0x25251a,warehouses:_0x403c8d,room:_0x55b6fa}=_0x23c982[_0x426dea(0x1d3)];console[_0x426dea(0x1ea)](_0x23c982['body']);try{const _0x81185e=await warehouse[_0x426dea(0x158)]([{'$match':{'name':_0x403c8d,'room':_0x55b6fa}},{'$unwind':_0x426dea(0x1f6)},{'$match':{'product_details.bay':parseInt(_0x25251a)}},{'$group':{'_id':_0x426dea(0x16a),'name':{'$first':_0x426dea(0x1fc)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x426dea(0x1c5)}}}]);_0x39b03e[_0x426dea(0x25d)](0xc8)[_0x426dea(0x1f3)](_0x81185e);}catch(_0x21bc03){_0x39b03e[_0x426dea(0x25d)](0x194)[_0x426dea(0x1f3)]({'message':_0x21bc03['message']});}}),module[a0_0x553e1d(0x15d)]=router;