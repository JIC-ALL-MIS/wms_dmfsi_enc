var a0_0x894d=a0_0x58dc;(function(_0x347621,_0x58cfeb){var _0x4e04c2=a0_0x58dc,_0x1b59be=_0x347621();while(!![]){try{var _0x34d84f=parseInt(_0x4e04c2(0x288))/0x1*(parseInt(_0x4e04c2(0x2a8))/0x2)+parseInt(_0x4e04c2(0x28c))/0x3+parseInt(_0x4e04c2(0x26f))/0x4*(-parseInt(_0x4e04c2(0x1ec))/0x5)+-parseInt(_0x4e04c2(0x278))/0x6+-parseInt(_0x4e04c2(0x292))/0x7*(-parseInt(_0x4e04c2(0x1fc))/0x8)+parseInt(_0x4e04c2(0x239))/0x9*(-parseInt(_0x4e04c2(0x2eb))/0xa)+parseInt(_0x4e04c2(0x241))/0xb;if(_0x34d84f===_0x58cfeb)break;else _0x1b59be['push'](_0x1b59be['shift']());}catch(_0x16c1c6){_0x1b59be['push'](_0x1b59be['shift']());}}}(a0_0x1029,0x9a6a7));const express=require('express'),app=express(),router=express[a0_0x894d(0x201)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x894d(0x217)),auth=require(a0_0x894d(0x2b2)),nodemailer=require('nodemailer');function a0_0x1029(){var _0x55ddf2=['body','map','product_code','English\x20(US)','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','abs','concat','$batch_code','language','12ZCjfSu','date','/barcode/:id','prod_level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/barcode_scanner','password','updateOne','</body></html>','6933408eVkYaz','exports','purchase_invoice','table\x20page','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','FGSEmail','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.primary_code','<h5\x20style=\x22text-align:\x20left;\x22>','ejs','prod_unit','$product.floorlevel','prod_name','prod_cat','Arabic','$unit','21432iNyixG','$invoice','$_id','/invoice/:id','2187894KcCftP','<table\x20style=\x22width:\x20100%\x20!important;\x22>','due_amount','Logo.png','purchase_quantity','product_name','868mFGuOX','<!DOCTYPE\x20html>','all_purchases_finished','role','save','expiry_date','logo','$product_details.product_stock','MaxStocks_data','$product_code','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product','$product_details','English','$product_details.secondary_code','secondary_code','POnumber','secondary_code_hide','post','$secondary_code','amount','64yJpXJY','stocks','getMonth','product_date','stock_data','maxperunit','$paid_amount','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','get','../middleware/auth','currency_placement','standard_unit','findOne','prod_secondunit','quantity','$expiry_date','errors','/upload/','$product.bin','</head><body>','JO_number','</h5>','master','find','findById','port','params','string','prod_code','$secondary_unit','$product.type','German','createTransport','error','currency','$due_amount','Rack\x202','staff','Portuguese\x20(BR)','stock_quantity','True','$suppliers_docs','$alertquantity','render','product','/view/add_purchases','<div>','Room_name','prod_primunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$warehouse_name','secondary_unit','$product.bay','Email\x20sent\x20successfully','Rack\x201','$room','$maxStocks','json','all_purchases_barcode','email','$name','<html><head><title></title>','Enabled','batch_code','max_product_unit','back','1810KNdTZD','prod_invoice','maxStocks','1639975hmNYSI','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','return_qty','/view','<span\x20style=\x22float:\x20right;\x22>','edit_purchases_finished','$product_details.product_name','add_purchases_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','prod_qty','user_id','message','../public/language/languages.json','primary_code_hide','add_purchases\x20error','<strong>\x20Regards\x20</strong>','57536ezEqPO','Purchase\x20Mail','$product.quantity','invoice','toString','Router','primary_code','getFullYear','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</td>','room_name','status','<hr\x20class=\x22my-3\x22>','$suppliers','floor','product_cat','getDate','Portuguese','note','$maxProdPerUnit','</table>','</span>','product_stock','/all_purchases_finished/view','$return_data','<tbody\x20style=\x22text-align:\x20center;\x22>','warehouse_name','../models/all_models','/view/return_purchase/:id','redirect','QA\x20Warehouse','RoomAssign','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','DRY\x20GOODS','random','Spanish','\x20<>\x20','$product_details._id','Error\x20occurred\x20while\x20processing\x20product:','/view/add_purchases/:id','sendMail','Hindi','edit_purchases_finished_view','aggregate','_id','site_title','$product.room_name','purchases\x20item\x20return\x20successfull','/../public','French','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','all','\x20</h2>','user','$category','room','/view/:id','suppliers_docs','length','</div>','59418KhtbZX','</thead>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','paid_amount','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','then','padStart','INCF-','18260792fSxjDX','$brand','product_details','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Purchase\x20Return','prod_Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','return_product','suppliers','slice','product_code_hide','image','filter','production_date','purchase\x20data\x20update\x20successfully','level','bay','flash','catch','log','$note','<h2>\x20','warehouse','forEach','<tr>','</tr>','name','Arabic\x20(ae)','\x20Order\x20Number\x20:\x20','FROZEN\x20GOODS','$primary_code','Purchase\x20Return\x20Mail','$product_details.bin','$product_details.storage','Ambient','<h5>','Error\x20Occurs'];a0_0x1029=function(){return _0x55ddf2;};return a0_0x1029();}var ejs=require(a0_0x894d(0x281));const path=require('path'),users=require(a0_0x894d(0x1f8));router[a0_0x894d(0x2b1)](a0_0x894d(0x1ef),auth,async(_0x3f9e7e,_0x11a014)=>{var _0x3cafee=a0_0x894d;try{const {username:_0x22c8fb,email:_0xd7e5aa,role:_0x5552b8}=_0x3f9e7e['user'],_0x3e3916=_0x3f9e7e[_0x3cafee(0x232)],_0x153ad8=await profile[_0x3cafee(0x2b5)]({'email':_0x3e3916[_0x3cafee(0x2e4)]}),_0x56b547=await staff[_0x3cafee(0x2b5)]({'email':_0x3e3916[_0x3cafee(0x2e4)]});if(_0x3e3916['role']=='staff'){const _0x336def=await staff['findOne']({'email':_0x3e3916[_0x3cafee(0x2e4)]});}const _0x39e76b=await master_shop[_0x3cafee(0x2c0)]();let _0x42dc7f;if(_0x3e3916[_0x3cafee(0x295)]==_0x3cafee(0x2ce)){const _0x10d8d0=await staff[_0x3cafee(0x2b5)]({'email':_0x3e3916[_0x3cafee(0x2e4)]});_0x42dc7f=await purchases_finished[_0x3cafee(0x227)]([{'$match':{'warehouse_name':_0x10d8d0[_0x3cafee(0x257)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x3cafee(0x25b),'as':_0x3cafee(0x236)}},{'$unwind':_0x3cafee(0x2d2)},{'$unwind':_0x3cafee(0x29e)},{'$group':{'_id':_0x3cafee(0x28a),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x3cafee(0x209)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x3cafee(0x2e0)},'product':{'$push':_0x3cafee(0x29e)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3cafee(0x2ae)},'due_amount':{'$first':_0x3cafee(0x2cc)},'return_data':{'$first':_0x3cafee(0x214)},'batch_code':{'$first':_0x3cafee(0x26d)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x3cafee(0x2d2)},'total_product_quantity':{'$sum':_0x3cafee(0x1fe)},'level':{'$addToSet':_0x3cafee(0x2dd)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x3cafee(0x283)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x42dc7f=await purchases_finished['aggregate']([{'$unwind':_0x3cafee(0x29e)},{'$group':{'_id':_0x3cafee(0x28a),'invoice':{'$first':_0x3cafee(0x289)},'suppliers':{'$first':_0x3cafee(0x209)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3cafee(0x2db)},'room':{'$addToSet':_0x3cafee(0x22a)},'product':{'$push':_0x3cafee(0x29e)},'note':{'$first':_0x3cafee(0x255)},'paid_amount':{'$first':_0x3cafee(0x2ae)},'due_amount':{'$first':_0x3cafee(0x2cc)},'return_data':{'$first':_0x3cafee(0x214)},'batch_code':{'$first':_0x3cafee(0x26d)},'expiry_date':{'$first':_0x3cafee(0x2b8)},'suppliers_docs':{'$first':_0x3cafee(0x2d2)},'total_product_quantity':{'$sum':_0x3cafee(0x1fe)},'level':{'$addToSet':_0x3cafee(0x2dd)},'isle':{'$addToSet':_0x3cafee(0x2bb)},'type':{'$addToSet':_0x3cafee(0x2c7)},'floorlevel':{'$addToSet':_0x3cafee(0x283)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x39e76b[0x0]['language']==_0x3cafee(0x269))var _0x158011=users[_0x3cafee(0x2a0)];else{if(_0x39e76b[0x0][_0x3cafee(0x26e)]==_0x3cafee(0x225))var _0x158011=users['Hindi'];else{if(_0x39e76b[0x0][_0x3cafee(0x26e)]==_0x3cafee(0x2c8))var _0x158011=users[_0x3cafee(0x2c8)];else{if(_0x39e76b[0x0]['language']==_0x3cafee(0x21f))var _0x158011=users[_0x3cafee(0x21f)];else{if(_0x39e76b[0x0][_0x3cafee(0x26e)]==_0x3cafee(0x22d))var _0x158011=users['French'];else{if(_0x39e76b[0x0][_0x3cafee(0x26e)]==_0x3cafee(0x2cf))var _0x158011=users[_0x3cafee(0x20d)];else{if(_0x39e76b[0x0]['language']==_0x3cafee(0x29c))var _0x158011=users['Chinese'];else{if(_0x39e76b[0x0][_0x3cafee(0x26e)]==_0x3cafee(0x25c))var _0x158011=users[_0x3cafee(0x286)];}}}}}}}_0x11a014[_0x3cafee(0x2d4)](_0x3cafee(0x294),{'success':_0x3f9e7e['flash'](_0x3cafee(0x22e)),'errors':_0x3f9e7e[_0x3cafee(0x252)](_0x3cafee(0x2b9)),'purchases':_0x42dc7f,'role':_0x3e3916,'profile':_0x153ad8,'master_shop':_0x39e76b,'language':_0x158011});}catch(_0x2c9f5f){console['log'](_0x3cafee(0x27b),_0x2c9f5f),_0x11a014[_0x3cafee(0x207)](0xc8)[_0x3cafee(0x2e2)]({'message':_0x2c9f5f[_0x3cafee(0x1f7)]});}});function BayBinSelected(_0xd4a3fb,_0x3002ec){var _0xf21d19=a0_0x894d,_0x5706f7=[],_0xc20fc2=[];if(_0xd4a3fb=='DRY\x20GOODS'){switch(_0x3002ec){case _0xf21d19(0x2df):_0x5706f7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x5706f7=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0xc20fc2=['DG'];}else{if(_0xd4a3fb==_0xf21d19(0x25e)){switch(_0x3002ec){case _0xf21d19(0x2df):_0x5706f7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0xf21d19(0x2cd):_0x5706f7=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0xc20fc2=['FG'];}}return{'levels':_0x5706f7,'identify':_0xc20fc2};}async function getRandom8DigitNumber(){var _0x45a0a9=a0_0x894d;const _0x2f3bbb=0x989680,_0x2a838b=0x5f5e0ff,_0x2dbb24=Math[_0x45a0a9(0x20a)](Math[_0x45a0a9(0x21e)]()*(_0x2a838b-_0x2f3bbb+0x1))+_0x2f3bbb;var _0x15e225;const _0x4cbbdc=await purchases_finished['findOne']({'invoice':_0x45a0a9(0x240)+_0x2dbb24});return _0x4cbbdc&&_0x4cbbdc[_0x45a0a9(0x237)]>0x0?_0x15e225=_0x45a0a9(0x240)+_0x2dbb24:_0x15e225='INCF-'+_0x2dbb24,_0x15e225;}function a0_0x58dc(_0x4f5b32,_0x150002){var _0x102995=a0_0x1029();return a0_0x58dc=function(_0x58dcdc,_0x55836e){_0x58dcdc=_0x58dcdc-0x1eb;var _0x4bee28=_0x102995[_0x58dcdc];return _0x4bee28;},a0_0x58dc(_0x4f5b32,_0x150002);}router[a0_0x894d(0x2b1)](a0_0x894d(0x2d6),auth,async(_0x50a0b6,_0x5445f4)=>{var _0x2df5f2=a0_0x894d;try{const {username:_0x500360,email:_0x41f8a3,role:_0x37fe01}=_0x50a0b6[_0x2df5f2(0x232)],_0x3d30d3=_0x50a0b6[_0x2df5f2(0x232)],_0x525c7d=await profile['findOne']({'email':_0x3d30d3[_0x2df5f2(0x2e4)]}),_0x28507e=await master_shop[_0x2df5f2(0x2c0)](),_0x37475c=await staff[_0x2df5f2(0x2b5)]({'email':_0x3d30d3['email']}),_0x29dc09=await suppliers[_0x2df5f2(0x2c0)]({});let _0x12caca;if(_0x3d30d3['role']==_0x2df5f2(0x2ce)){const _0xc6b9c6=await staff[_0x2df5f2(0x2b5)]({'email':_0x3d30d3[_0x2df5f2(0x2e4)]});_0x12caca=await warehouse[_0x2df5f2(0x227)]([{'$match':{'status':_0x2df5f2(0x2e7),'name':_0xc6b9c6[_0x2df5f2(0x257)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x2df5f2(0x2e5),'name':{'$first':'$name'}}}]);}else _0x12caca=await warehouse[_0x2df5f2(0x227)]([{'$match':{'status':'Enabled','warehouse_category':_0x2df5f2(0x2af),'name':{'$ne':_0x2df5f2(0x21a)}}},{'$group':{'_id':'$name','name':{'$first':_0x2df5f2(0x2e5)}}}]);const _0x533880=await product['find']({}),_0x3a084f=await warehouse[_0x2df5f2(0x2c0)]({'status':'Enabled'}),_0x1f9520=await purchases_finished[_0x2df5f2(0x2c0)]({}),_0x10d528=_0x1f9520[_0x2df5f2(0x237)]+0x1,_0x5a63e2=_0x2df5f2(0x240)+_0x10d528[_0x2df5f2(0x200)]()[_0x2df5f2(0x23f)](0x5,'0');var _0x1f6573=[_0x2df5f2(0x263),'Enclosed'];if(_0x28507e[0x0][_0x2df5f2(0x26e)]=='English\x20(US)')var _0x18446e=users['English'];else{if(_0x28507e[0x0]['language']==_0x2df5f2(0x225))var _0x18446e=users['Hindi'];else{if(_0x28507e[0x0][_0x2df5f2(0x26e)]==_0x2df5f2(0x2c8))var _0x18446e=users['German'];else{if(_0x28507e[0x0][_0x2df5f2(0x26e)]==_0x2df5f2(0x21f))var _0x18446e=users['Spanish'];else{if(_0x28507e[0x0]['language']==_0x2df5f2(0x22d))var _0x18446e=users['French'];else{if(_0x28507e[0x0][_0x2df5f2(0x26e)]==_0x2df5f2(0x2cf))var _0x18446e=users['Portuguese'];else{if(_0x28507e[0x0]['language']==_0x2df5f2(0x29c))var _0x18446e=users[_0x2df5f2(0x29c)];else{if(_0x28507e[0x0][_0x2df5f2(0x26e)]==_0x2df5f2(0x25c))var _0x18446e=users[_0x2df5f2(0x286)];}}}}}}}const _0x656f23=getRandom8DigitNumber();_0x656f23[_0x2df5f2(0x23e)](_0x196aa3=>{var _0x177edf=_0x2df5f2;_0x5445f4[_0x177edf(0x2d4)](_0x177edf(0x1f3),{'success':_0x50a0b6['flash'](_0x177edf(0x22e)),'errors':_0x50a0b6[_0x177edf(0x252)](_0x177edf(0x2b9)),'role':_0x3d30d3,'profile':_0x525c7d,'suppliers':_0x29dc09,'warehouse':_0x12caca,'product':_0x533880,'invoice':_0x196aa3,'master_shop':_0x28507e,'language':_0x18446e,'find_data':_0x3a084f,'rooms_data':_0x1f6573});})[_0x2df5f2(0x253)](_0x36f288=>{var _0x2df4ed=_0x2df5f2;_0x50a0b6['flash'](_0x2df4ed(0x2b9),_0x2df4ed(0x204)),_0x5445f4[_0x2df4ed(0x219)](_0x2df4ed(0x213));});}catch(_0xa8cd52){console['log'](_0xa8cd52);}}),router[a0_0x894d(0x2b1)](a0_0x894d(0x223),auth,async(_0x237a57,_0x132f28)=>{var _0x3bdee7=a0_0x894d;try{const _0x181ea7=_0x237a57[_0x3bdee7(0x2c3)]['id'];console[_0x3bdee7(0x254)](_0x181ea7);const _0x573e59=await master_shop['find']();console['log'](_0x3bdee7(0x2bf),_0x573e59);const _0x5468df=await product[_0x3bdee7(0x2b5)]({'name':_0x181ea7});console['log'](_0x3bdee7(0x2d5),_0x5468df),_0x132f28['status'](0xc8)[_0x3bdee7(0x2e2)]({'product_data':_0x5468df,'master':_0x573e59});}catch(_0x5265f1){console['log'](_0x3bdee7(0x1fa),_0x5265f1);}}),router[a0_0x894d(0x2a5)](a0_0x894d(0x2d6),auth,async(_0xd75ff8,_0x2d981e)=>{var _0x4f43d6=a0_0x894d;try{const {invoice:_0xbbbfcd,date:_0x130b4d,warehouse_name:_0x28ea90,prod_name:_0x4b7d7a,prod_code:_0x2495b0,prod_qty:_0x398480,prod_unit:_0x2deb7a,prod_secondunit:_0x8761b2,prod_level:_0x348e58,prod_isle:_0xffb86a,prod_pallet:_0x339328,note:_0x1d40d3,expiry_date:_0xa111ac,batch_code:_0x19d046,payable:_0x262c11,due_amount:_0x114f28,Room_name:_0x4fff3b,primary_code:_0x5946ae,secondary_code:_0x30a5f5,MaxStocks_data:_0x37b956,PO_number:_0xe76cff,SCRN:_0x51e155,JO_number:_0x4c1917}=_0xd75ff8['body'];if(typeof _0x4b7d7a==_0x4f43d6(0x2c4))var _0x908eb6=[_0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x284)]],_0x386a62=[_0xd75ff8['body']['prod_code']],_0x1f79af=[_0xd75ff8[_0x4f43d6(0x266)]['prod_Qty']],_0x257d74=[_0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x2d9)]],_0x5c9c0d=[_0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x2b6)]],_0x4d5b0b=[_0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x272)]],_0x5dd34a=[_0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x202)]],_0x214af6=[_0xd75ff8[_0x4f43d6(0x266)]['secondary_code']],_0x169e7a=[_0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x29a)]],_0x36c0cc=[_0xd75ff8['body']['batch_code']],_0x4388d3=[_0xd75ff8[_0x4f43d6(0x266)]['expiry_date']],_0x54845e=[_0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x2ab)]],_0x583e40=[_0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x2e9)]],_0x121bdb=[_0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x285)]],_0x189003=[_0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x21b)]],_0x56aea4=[_0xd75ff8['body'][_0x4f43d6(0x2ec)]];else var _0x908eb6=[..._0xd75ff8[_0x4f43d6(0x266)]['prod_name']],_0x386a62=[..._0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x2c5)]],_0x1f79af=[..._0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x246)]],_0x257d74=[..._0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x2d9)]],_0x5c9c0d=[..._0xd75ff8[_0x4f43d6(0x266)]['prod_secondunit']],_0x4d5b0b=[..._0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x272)]],_0x5dd34a=[..._0xd75ff8['body']['primary_code']],_0x214af6=[..._0xd75ff8[_0x4f43d6(0x266)]['secondary_code']],_0x169e7a=[..._0xd75ff8['body'][_0x4f43d6(0x29a)]],_0x36c0cc=[..._0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x2e8)]],_0x4388d3=[..._0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x297)]],_0x54845e=[..._0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x2ab)]],_0x583e40=[..._0xd75ff8[_0x4f43d6(0x266)]['max_product_unit']],_0x121bdb=[..._0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x285)]],_0x189003=[..._0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x21b)]],_0x56aea4=[..._0xd75ff8[_0x4f43d6(0x266)][_0x4f43d6(0x2ec)]];const _0x2d37a9=_0x908eb6[_0x4f43d6(0x267)](_0x3fd3a3=>{return _0x3fd3a3={'product_name':_0x3fd3a3};});_0x386a62[_0x4f43d6(0x258)]((_0x3cf6d5,_0x4f9e60)=>{var _0x159e09=_0x4f43d6;_0x2d37a9[_0x4f9e60][_0x159e09(0x268)]=_0x3cf6d5;}),_0x1f79af[_0x4f43d6(0x258)]((_0x52a6ad,_0x2f372a)=>{var _0x3c56af=_0x4f43d6;_0x2d37a9[_0x2f372a][_0x3c56af(0x2b7)]=Math['abs'](_0x52a6ad);}),_0x257d74[_0x4f43d6(0x258)]((_0x21645c,_0x58d244)=>{_0x2d37a9[_0x58d244]['standard_unit']=_0x21645c;}),_0x5c9c0d[_0x4f43d6(0x258)]((_0x3ee009,_0x137b6f)=>{var _0x5864ad=_0x4f43d6;_0x2d37a9[_0x137b6f][_0x5864ad(0x2dc)]=_0x3ee009;}),_0x4d5b0b[_0x4f43d6(0x258)]((_0x5ca19e,_0x297419)=>{_0x2d37a9[_0x297419]['bay']=_0x5ca19e;}),_0x5dd34a[_0x4f43d6(0x258)]((_0x12b702,_0x484df5)=>{var _0x117189=_0x4f43d6;_0x2d37a9[_0x484df5][_0x117189(0x202)]=_0x12b702;}),_0x214af6[_0x4f43d6(0x258)]((_0x2508fd,_0x23cd98)=>{var _0x58b1c9=_0x4f43d6;_0x2d37a9[_0x23cd98][_0x58b1c9(0x2a2)]=_0x2508fd;}),_0x169e7a[_0x4f43d6(0x258)]((_0x1e9ed1,_0x3443f3)=>{var _0x3efa95=_0x4f43d6;_0x2d37a9[_0x3443f3][_0x3efa95(0x1eb)]=_0x1e9ed1;}),_0x36c0cc[_0x4f43d6(0x258)]((_0x39aa35,_0x3e0d50)=>{var _0x338e18=_0x4f43d6;_0x2d37a9[_0x3e0d50][_0x338e18(0x2e8)]=_0x39aa35;}),_0x4388d3['forEach']((_0x536788,_0x440bca)=>{var _0x4f79b7=_0x4f43d6;_0x2d37a9[_0x440bca][_0x4f79b7(0x297)]=_0x536788;}),_0x54845e[_0x4f43d6(0x258)]((_0x27e531,_0x4c59eb)=>{var _0x2eadde=_0x4f43d6;_0x2d37a9[_0x4c59eb][_0x2eadde(0x24e)]=_0x27e531;}),_0x583e40['forEach']((_0x5553a7,_0x5ecd7b)=>{var _0x345a37=_0x4f43d6;_0x2d37a9[_0x5ecd7b][_0x345a37(0x2ad)]=_0x5553a7;}),_0x121bdb[_0x4f43d6(0x258)]((_0x497531,_0x45d0d8)=>{_0x2d37a9[_0x45d0d8]['product_cat']=_0x497531;}),_0x189003['forEach']((_0x1da91a,_0x2034bc)=>{var _0x505797=_0x4f43d6;_0x2d37a9[_0x2034bc][_0x505797(0x206)]=_0x1da91a;}),_0x56aea4['forEach']((_0x655087,_0x53e88c)=>{var _0x305819=_0x4f43d6;_0x2d37a9[_0x53e88c][_0x305819(0x1ff)]=_0x655087;});const _0x331648=_0x2d37a9[_0x4f43d6(0x24d)](_0x4fddf8=>_0x4fddf8[_0x4f43d6(0x2b7)]!=='0'&&_0x4fddf8[_0x4f43d6(0x2b7)]!==''),_0x4c5068=new purchases_finished({'invoice':_0xbbbfcd,'suppliers':_0xd75ff8[_0x4f43d6(0x266)]['suppliers'],'date':_0x130b4d,'warehouse_name':_0x28ea90,'product':_0x331648,'note':_0x1d40d3,'due_amount':_0x114f28,'room':_0x4fff3b,'POnumber':_0xe76cff,'SCRN':_0x51e155,'JO_number':_0x4c1917}),_0x3f3bbc=await _0x4c5068[_0x4f43d6(0x296)](),_0x5eedc8=await purchases_finished[_0x4f43d6(0x2b5)]({'invoice':_0xbbbfcd}),_0x5be6a6=_0x5eedc8[_0x4f43d6(0x2d5)][_0x4f43d6(0x267)](async _0x5088ff=>{var _0x3cf947=_0x4f43d6;try{var _0x3c2af9=await warehouse[_0x3cf947(0x2b5)]({'name':_0x28ea90,'room':_0x5088ff['room_name']}),_0x14efb0=0x0;const _0x2c5a94=_0x3c2af9[_0x3cf947(0x243)]['map'](_0x26702e=>{var _0x10a801=_0x3cf947;console[_0x10a801(0x254)](_0x26702e['product_name']+'=='+_0x5088ff[_0x10a801(0x291)]+'&&'+_0x26702e[_0x10a801(0x251)]+'=='+_0x5088ff[_0x10a801(0x251)]+'&&'+_0x26702e['expiry_date']+'=='+_0x5088ff[_0x10a801(0x297)]+'&&'+_0x26702e[_0x10a801(0x24e)]+'=='+_0x5088ff[_0x10a801(0x24e)]+'&&'+_0x26702e[_0x10a801(0x2e8)]+'=='+_0x5088ff[_0x10a801(0x2e8)]+'&&'+_0x26702e[_0x10a801(0x1ff)]+'=='+_0x5eedc8['invoice']),_0x26702e[_0x10a801(0x291)]==_0x5088ff['product_name']&&_0x26702e['bay']==_0x5088ff[_0x10a801(0x251)]&&_0x26702e[_0x10a801(0x297)]==_0x5088ff[_0x10a801(0x297)]&&_0x26702e['production_date']==_0x5088ff[_0x10a801(0x24e)]&&_0x26702e[_0x10a801(0x2e8)]==_0x5088ff[_0x10a801(0x2e8)]&&_0x26702e[_0x10a801(0x1ff)]==_0x5eedc8[_0x10a801(0x1ff)]&&(_0x26702e[_0x10a801(0x212)]=Math[_0x10a801(0x26b)](_0x26702e['product_stock'])+Math[_0x10a801(0x26b)](_0x5088ff['quantity']),_0x14efb0++);});return _0x14efb0==0x0&&(_0x3c2af9[_0x3cf947(0x243)]=_0x3c2af9['product_details'][_0x3cf947(0x26c)]({'product_name':_0x5088ff[_0x3cf947(0x291)],'product_stock':Math['abs'](_0x5088ff[_0x3cf947(0x2b7)]),'primary_code':_0x5088ff[_0x3cf947(0x202)],'secondary_code':_0x5088ff[_0x3cf947(0x2a2)],'product_code':_0x5088ff[_0x3cf947(0x268)],'bay':_0x5088ff[_0x3cf947(0x251)],'maxProducts':_0x5088ff[_0x3cf947(0x1eb)],'unit':_0x5088ff['standard_unit'],'secondary_unit':_0x5088ff[_0x3cf947(0x2dc)],'expiry_date':_0x5088ff[_0x3cf947(0x297)],'production_date':_0x5088ff[_0x3cf947(0x24e)],'maxProducts':_0x5088ff[_0x3cf947(0x1eb)],'maxPerUnit':_0x5088ff[_0x3cf947(0x2ad)],'batch_code':_0x5088ff[_0x3cf947(0x2e8)],'product_cat':_0x5088ff[_0x3cf947(0x20b)],'invoice':_0x5088ff[_0x3cf947(0x1ff)],'id_incoming':_0x5088ff[_0x3cf947(0x228)]})),_0x3c2af9;}catch(_0x439d53){return console[_0x3cf947(0x2ca)](_0x3cf947(0x222),_0x439d53),null;}});Promise[_0x4f43d6(0x230)](_0x5be6a6)[_0x4f43d6(0x23e)](async _0xe146d5=>{var _0x3abe68=_0x4f43d6;try{for(const _0x51f72f of _0xe146d5){await warehouse[_0x3abe68(0x276)]({'_id':_0x51f72f[_0x3abe68(0x228)]},{'$addToSet':{'product_details':{'$each':_0x51f72f[_0x3abe68(0x243)]}}});}const _0x3888d3=await master_shop[_0x3abe68(0x2c0)](),_0x315626=await email_settings[_0x3abe68(0x2b5)](),_0x320237=await supervisor_settings[_0x3abe68(0x2c0)]();var _0x2153ce=_0x5eedc8[_0x3abe68(0x2d5)],_0x21d667='',_0x5248f6;for(_0x5248f6 in _0x2153ce){var _0x40bed1='FG';_0x5eedc8[_0x3abe68(0x216)]==_0x3abe68(0x21d)&&(_0x40bed1='DG'),_0x21d667+=_0x3abe68(0x259)+_0x3abe68(0x23d)+_0x2153ce[_0x5248f6][_0x3abe68(0x291)]+_0x3abe68(0x205)+_0x3abe68(0x23d)+_0x2153ce[_0x5248f6]['product_code']+_0x3abe68(0x205)+_0x3abe68(0x23d)+_0x2153ce[_0x5248f6][_0x3abe68(0x2b7)]+_0x3abe68(0x205)+_0x3abe68(0x23d)+_0x2153ce[_0x5248f6][_0x3abe68(0x2b4)]+_0x3abe68(0x205)+_0x3abe68(0x23d)+_0x2153ce[_0x5248f6]['secondary_unit']+_0x3abe68(0x205)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5eedc8['warehouse_name']+'</td>'+_0x3abe68(0x23d)+_0x2153ce[_0x5248f6][_0x3abe68(0x206)]+_0x3abe68(0x205)+_0x3abe68(0x23d)+_0x40bed1+_0x2153ce[_0x5248f6][_0x3abe68(0x251)]+_0x3abe68(0x205),'</tr>';}let _0x125ed9=nodemailer[_0x3abe68(0x2c9)]({'host':_0x315626['host'],'port':Number(_0x315626[_0x3abe68(0x2c2)]),'secure':![],'auth':{'user':_0x315626[_0x3abe68(0x2e4)],'pass':_0x315626[_0x3abe68(0x275)]}}),_0x354626={'from':_0x315626[_0x3abe68(0x2e4)],'to':_0x320237[0x0][_0x3abe68(0x27d)],'subject':_0x3abe68(0x1fd),'attachments':[{'filename':_0x3abe68(0x28f),'path':__dirname+_0x3abe68(0x22c)+_0x3abe68(0x2ba)+_0x3888d3[0x0][_0x3abe68(0x24c)],'cid':_0x3abe68(0x298)}],'html':_0x3abe68(0x293)+_0x3abe68(0x2e6)+'</head><body>'+_0x3abe68(0x2d7)+_0x3abe68(0x26a)+_0x3abe68(0x2d7)+_0x3abe68(0x244)+_0x3abe68(0x238)+_0x3abe68(0x2d7)+'<h2>\x20'+_0x3888d3[0x0][_0x3abe68(0x229)]+_0x3abe68(0x231)+_0x3abe68(0x238)+_0x3abe68(0x238)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x5eedc8[_0x3abe68(0x1ff)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x5eedc8[_0x3abe68(0x270)]+'\x20'+_0x3abe68(0x211)+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3abe68(0x23b)+_0x3abe68(0x259)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x3abe68(0x1ed)+_0x3abe68(0x273)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x3abe68(0x2b0)+_0x3abe68(0x22f)+_0x3abe68(0x27c)+_0x3abe68(0x1f4)+_0x3abe68(0x25a)+'</thead>'+_0x3abe68(0x215)+'\x20'+_0x21d667+'\x20'+'</tbody>'+'</table>'+_0x3abe68(0x2d7)+_0x3abe68(0x1fb)+_0x3abe68(0x264)+_0x3888d3[0x0][_0x3abe68(0x229)]+'</h5>'+_0x3abe68(0x238)+_0x3abe68(0x238)+_0x3abe68(0x277)};_0x125ed9[_0x3abe68(0x224)](_0x354626,function(_0xb87968,_0x1a0391){var _0x57544b=_0x3abe68;_0xb87968?(console[_0x57544b(0x254)](_0xb87968),console[_0x57544b(0x254)](_0x57544b(0x265))):console[_0x57544b(0x254)]('Email\x20sent\x20successfully');});}catch(_0x1f8bba){console[_0x3abe68(0x2ca)](_0x1f8bba),_0x2d981e[_0x3abe68(0x207)](0x1f4)[_0x3abe68(0x2e2)]({'error':_0x3abe68(0x27e),'message':_0x1f8bba[_0x3abe68(0x1f7)]});}})['catch'](_0x136574=>{var _0x330316=_0x4f43d6;console[_0x330316(0x2ca)](_0x136574);}),_0xd75ff8[_0x4f43d6(0x252)](_0x4f43d6(0x22e),'purchase\x20data\x20add\x20successfully'),_0x2d981e[_0x4f43d6(0x219)]('/all_purchases_finished/view');}catch(_0x1cbae2){console[_0x4f43d6(0x254)](_0x1cbae2);}}),router[a0_0x894d(0x2b1)]('/preview/:id',auth,async(_0x77f637,_0x165e8b)=>{var _0x33556b=a0_0x894d;try{const {username:_0x4016e0,email:_0x2be1cc,role:_0x543f0d}=_0x77f637[_0x33556b(0x232)],_0xb6f33f=_0x77f637[_0x33556b(0x232)],_0xec01c1=await profile['findOne']({'email':_0xb6f33f['email']}),_0x3e9084=await master_shop[_0x33556b(0x2c0)](),_0x416a35=_0x77f637[_0x33556b(0x2c3)]['id'],_0x157d19=await purchases_finished[_0x33556b(0x2c1)](_0x416a35),_0x43ef25=await suppliers[_0x33556b(0x2c0)]({});let _0x97fbc9;if(_0xb6f33f[_0x33556b(0x295)]==_0x33556b(0x2ce)){const _0x2ff03a=await staff[_0x33556b(0x2b5)]({'email':_0xb6f33f[_0x33556b(0x2e4)]});_0x97fbc9=await warehouse[_0x33556b(0x2c0)]({'status':_0x33556b(0x2e7),'name':_0x2ff03a[_0x33556b(0x257)],'warehouse_category':'Finished\x20Goods'});}else _0x97fbc9=await warehouse[_0x33556b(0x227)]([{'$match':{'status':_0x33556b(0x2e7),'warehouse_category':_0x33556b(0x2af)}},{'$group':{'_id':_0x33556b(0x2e5),'name':{'$first':'$name'}}}]);const _0x18b2b2=await product[_0x33556b(0x2c0)]({}),_0x39dd16=BayBinSelected(_0x157d19[_0x33556b(0x216)],_0x157d19[_0x33556b(0x234)]);let _0x7265dc=new Date(_0x157d19[_0x33556b(0x297)]),_0x2c3d32=('0'+_0x7265dc[_0x33556b(0x20c)]())[_0x33556b(0x24a)](-0x2),_0x1c1fb8=('0'+(_0x7265dc[_0x33556b(0x2aa)]()+0x1))[_0x33556b(0x24a)](-0x2),_0x1c7d96=_0x7265dc[_0x33556b(0x203)](),_0x4f9f4f=_0x1c7d96+'-'+_0x1c1fb8+'-'+_0x2c3d32;if(_0x3e9084[0x0][_0x33556b(0x26e)]=='English\x20(US)'){var _0x153920=users[_0x33556b(0x2a0)];console[_0x33556b(0x254)](_0x153920);}else{if(_0x3e9084[0x0]['language']==_0x33556b(0x225))var _0x153920=users[_0x33556b(0x225)];else{if(_0x3e9084[0x0][_0x33556b(0x26e)]=='German')var _0x153920=users[_0x33556b(0x2c8)];else{if(_0x3e9084[0x0][_0x33556b(0x26e)]==_0x33556b(0x21f))var _0x153920=users[_0x33556b(0x21f)];else{if(_0x3e9084[0x0][_0x33556b(0x26e)]==_0x33556b(0x22d))var _0x153920=users['French'];else{if(_0x3e9084[0x0][_0x33556b(0x26e)]==_0x33556b(0x2cf))var _0x153920=users['Portuguese'];else{if(_0x3e9084[0x0]['language']==_0x33556b(0x29c))var _0x153920=users[_0x33556b(0x29c)];else{if(_0x3e9084[0x0][_0x33556b(0x26e)]==_0x33556b(0x25c))var _0x153920=users[_0x33556b(0x286)];}}}}}}}_0x165e8b[_0x33556b(0x2d4)](_0x33556b(0x226),{'success':_0x77f637[_0x33556b(0x252)](_0x33556b(0x22e)),'errors':_0x77f637['flash']('errors'),'role':_0xb6f33f,'profile':_0xec01c1,'purchases':_0x157d19,'suppliers':_0x43ef25,'warehouse':_0x97fbc9,'product':_0x18b2b2,'master_shop':_0x3e9084,'language':_0x153920,'ed_fullDate':_0x4f9f4f,'dataSelected':_0x39dd16});}catch(_0x23f688){console['log'](_0x23f688);}}),router[a0_0x894d(0x2b1)](a0_0x894d(0x235),auth,async(_0x388534,_0x108803)=>{var _0x565dfc=a0_0x894d;try{const {username:_0xbab11a,email:_0x443afa,role:_0x5e6bd7}=_0x388534[_0x565dfc(0x232)],_0x59b6c1=_0x388534[_0x565dfc(0x232)],_0x57daa7=await profile[_0x565dfc(0x2b5)]({'email':_0x59b6c1[_0x565dfc(0x2e4)]}),_0x12a401=await master_shop[_0x565dfc(0x2c0)](),_0x32e093=_0x388534[_0x565dfc(0x2c3)]['id'],_0x5e155a=await purchases_finished[_0x565dfc(0x2c1)](_0x32e093),_0x60b31d=await suppliers[_0x565dfc(0x2c0)]({});let _0x3c6c4b;if(_0x59b6c1[_0x565dfc(0x295)]==_0x565dfc(0x2ce)){const _0x416b74=await staff[_0x565dfc(0x2b5)]({'email':_0x59b6c1[_0x565dfc(0x2e4)]});_0x3c6c4b=await warehouse[_0x565dfc(0x2c0)]({'status':_0x565dfc(0x2e7),'name':_0x416b74['warehouse'],'warehouse_category':_0x565dfc(0x2af)});}else _0x3c6c4b=await warehouse[_0x565dfc(0x227)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x565dfc(0x2e5),'name':{'$first':_0x565dfc(0x2e5)}}}]);const _0x4bb8d2=await product[_0x565dfc(0x2c0)]({}),_0x520b2a=BayBinSelected(_0x5e155a[_0x565dfc(0x216)],_0x5e155a[_0x565dfc(0x234)]);let _0x4c75cf=new Date(_0x5e155a[_0x565dfc(0x297)]),_0x52220d=('0'+_0x4c75cf['getDate']())[_0x565dfc(0x24a)](-0x2),_0x2f4386=('0'+(_0x4c75cf['getMonth']()+0x1))[_0x565dfc(0x24a)](-0x2),_0x13f02b=_0x4c75cf['getFullYear'](),_0x5089ef=_0x13f02b+'-'+_0x2f4386+'-'+_0x52220d;if(_0x12a401[0x0][_0x565dfc(0x26e)]==_0x565dfc(0x269)){var _0x12fdae=users[_0x565dfc(0x2a0)];console[_0x565dfc(0x254)](_0x12fdae);}else{if(_0x12a401[0x0][_0x565dfc(0x26e)]==_0x565dfc(0x225))var _0x12fdae=users[_0x565dfc(0x225)];else{if(_0x12a401[0x0][_0x565dfc(0x26e)]==_0x565dfc(0x2c8))var _0x12fdae=users['German'];else{if(_0x12a401[0x0][_0x565dfc(0x26e)]==_0x565dfc(0x21f))var _0x12fdae=users[_0x565dfc(0x21f)];else{if(_0x12a401[0x0][_0x565dfc(0x26e)]==_0x565dfc(0x22d))var _0x12fdae=users['French'];else{if(_0x12a401[0x0][_0x565dfc(0x26e)]==_0x565dfc(0x2cf))var _0x12fdae=users[_0x565dfc(0x20d)];else{if(_0x12a401[0x0]['language']==_0x565dfc(0x29c))var _0x12fdae=users[_0x565dfc(0x29c)];else{if(_0x12a401[0x0][_0x565dfc(0x26e)]=='Arabic\x20(ae)')var _0x12fdae=users[_0x565dfc(0x286)];}}}}}}}_0x108803[_0x565dfc(0x2d4)](_0x565dfc(0x1f1),{'success':_0x388534['flash'](_0x565dfc(0x22e)),'errors':_0x388534[_0x565dfc(0x252)](_0x565dfc(0x2b9)),'role':_0x59b6c1,'profile':_0x57daa7,'purchases':_0x5e155a,'suppliers':_0x60b31d,'warehouse':_0x3c6c4b,'product':_0x4bb8d2,'master_shop':_0x12a401,'language':_0x12fdae,'ed_fullDate':_0x5089ef,'dataSelected':_0x520b2a});}catch(_0x3bd8f6){console[_0x565dfc(0x254)](_0x3bd8f6);}}),router[a0_0x894d(0x2a5)](a0_0x894d(0x235),auth,async(_0x1e03db,_0x399d9f)=>{var _0x4e0b33=a0_0x894d;try{const _0x30e1c4=_0x1e03db[_0x4e0b33(0x2c3)]['id'],_0x33e905=await purchases_finished[_0x4e0b33(0x2b5)]({'_id':_0x1e03db[_0x4e0b33(0x2c3)]['id']}),_0x3cdbcb=await warehouse[_0x4e0b33(0x2b5)]({'name':_0x33e905[_0x4e0b33(0x216)],'room':_0x33e905[_0x4e0b33(0x234)]});_0x33e905[_0x4e0b33(0x2d5)][_0x4e0b33(0x258)](_0x3543c3=>{var _0x47ba6b=_0x4e0b33;const _0x416a5f=_0x3cdbcb[_0x47ba6b(0x243)][_0x47ba6b(0x267)](_0x17793d=>{var _0x4b1374=_0x47ba6b;_0x17793d[_0x4b1374(0x291)]==_0x3543c3[_0x4b1374(0x291)]&&_0x17793d[_0x4b1374(0x251)]==_0x3543c3[_0x4b1374(0x251)]&&(_0x17793d[_0x4b1374(0x212)]=parseInt(_0x17793d['product_stock'])-parseInt(_0x3543c3[_0x4b1374(0x2b7)]));});}),await _0x3cdbcb[_0x4e0b33(0x296)]();const {invoice:_0x5aa6b8,suppliers:_0x1c99f4,date:_0x54d386,warehouse_name:_0x4b236a,prod_name:_0x1f11ee,prod_code:_0x5096cf,prod_qty:_0x35203f,prod_unit:_0x59641e,prod_secondunit:_0x483eb2,prod_level:_0x538af5,prod_isle:_0x1abc00,prod_pallet:_0x133cd6,note:_0x1f1a6a,expiry_date:_0x4cd2dc,batch_code:_0x1be9a7,paid_amount:_0x863765,due_amount:_0x580c99,Room_name:_0x514f0b,primary_code:_0x2f8162,secondary_code:_0xf6a37,PO_number:_0x379c15,JO_number:_0x10026b}=_0x1e03db[_0x4e0b33(0x266)];if(typeof _0x1f11ee==_0x4e0b33(0x2c4))var _0xc95666=[_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x284)]],_0x53d900=[_0x1e03db['body'][_0x4e0b33(0x2c5)]],_0x2a3d1f=[_0x1e03db['body']['prod_qty']],_0x2cb59a=[_0x1e03db['body']['prod_unit']],_0x3975e5=[_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x2b6)]],_0x1c8485=[_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x272)]],_0x4ce74f=[_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x202)]],_0x370295=[_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x2a2)]],_0x5006a9=[_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x29a)]],_0x3c1d50=[_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x2e8)]],_0x1a7de9=[_0x1e03db[_0x4e0b33(0x266)]['expiry_date']];else var _0xc95666=[..._0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x284)]],_0x53d900=[..._0x1e03db['body'][_0x4e0b33(0x2c5)]],_0x2a3d1f=[..._0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x1f5)]],_0x2cb59a=[..._0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x282)]],_0x3975e5=[..._0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x2b6)]],_0x1c8485=[..._0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x272)]],_0x4ce74f=[..._0x1e03db['body'][_0x4e0b33(0x202)]],_0x370295=[..._0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x2a2)]],_0x5006a9=[..._0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x29a)]],_0x3c1d50=[..._0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x2e8)]],_0x1a7de9=[..._0x1e03db['body'][_0x4e0b33(0x297)]];const _0x4164d8=_0xc95666[_0x4e0b33(0x267)](_0x3318fe=>{return _0x3318fe={'product_name':_0x3318fe};});_0x53d900['forEach']((_0x28c098,_0x1cb3bf)=>{var _0x2bfd93=_0x4e0b33;_0x4164d8[_0x1cb3bf][_0x2bfd93(0x268)]=_0x28c098;}),_0x2a3d1f[_0x4e0b33(0x258)]((_0x5ac6ce,_0xf1c9f8)=>{var _0x50edc3=_0x4e0b33;_0x4164d8[_0xf1c9f8][_0x50edc3(0x2b7)]=_0x5ac6ce;}),_0x2cb59a[_0x4e0b33(0x258)]((_0x57dd3b,_0x26f91e)=>{_0x4164d8[_0x26f91e]['standard_unit']=_0x57dd3b;}),_0x3975e5[_0x4e0b33(0x258)]((_0x2a0a9a,_0x544315)=>{var _0x183900=_0x4e0b33;_0x4164d8[_0x544315][_0x183900(0x2dc)]=_0x2a0a9a;}),_0x1c8485[_0x4e0b33(0x258)]((_0x3d08c6,_0x539543)=>{var _0x1001cf=_0x4e0b33;_0x4164d8[_0x539543][_0x1001cf(0x251)]=_0x3d08c6;}),_0x4ce74f[_0x4e0b33(0x258)]((_0x1f1740,_0x51bf75)=>{var _0x4b6c61=_0x4e0b33;_0x4164d8[_0x51bf75][_0x4b6c61(0x202)]=_0x1f1740;}),_0x370295[_0x4e0b33(0x258)]((_0x499f6b,_0x2f5ee6)=>{var _0x3c8a49=_0x4e0b33;_0x4164d8[_0x2f5ee6][_0x3c8a49(0x2a2)]=_0x499f6b;}),_0x5006a9[_0x4e0b33(0x258)]((_0x561a11,_0x52fe31)=>{var _0x350cf6=_0x4e0b33;_0x4164d8[_0x52fe31][_0x350cf6(0x1eb)]=_0x561a11;}),_0x3c1d50[_0x4e0b33(0x258)]((_0x13b4b4,_0x224f74)=>{var _0x32fbec=_0x4e0b33;_0x4164d8[_0x224f74][_0x32fbec(0x2e8)]=_0x13b4b4;}),_0x1a7de9['forEach']((_0x54f60b,_0x46f49c)=>{var _0x2cda6e=_0x4e0b33;_0x4164d8[_0x46f49c][_0x2cda6e(0x297)]=_0x54f60b;});const _0x2fa537=_0x4164d8[_0x4e0b33(0x24d)](_0x5d4d4d=>_0x5d4d4d[_0x4e0b33(0x2b7)]!=='0'&&_0x5d4d4d[_0x4e0b33(0x2b7)]!=='');_0x33e905[_0x4e0b33(0x1ff)]=_0x5aa6b8,_0x33e905['suppliers']=_0x1c99f4,_0x33e905[_0x4e0b33(0x270)]=_0x54d386,_0x33e905[_0x4e0b33(0x216)]=_0x4b236a,_0x33e905[_0x4e0b33(0x2d5)]=_0x2fa537,_0x33e905[_0x4e0b33(0x20e)]=_0x1f1a6a,_0x33e905[_0x4e0b33(0x23c)]=_0x863765,_0x33e905[_0x4e0b33(0x28e)]=_0x580c99,_0x33e905['room']=_0x514f0b,_0x33e905[_0x4e0b33(0x2a3)]=_0x379c15,_0x33e905[_0x4e0b33(0x2bd)]=_0x10026b;const _0x2b1af0=await _0x33e905[_0x4e0b33(0x296)](),_0x475677=await warehouse[_0x4e0b33(0x2b5)]({'name':_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x216)],'room':_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x2d8)]});_0x33e905[_0x4e0b33(0x2d5)][_0x4e0b33(0x258)](_0x2b5144=>{var _0x3ae3c7=_0x4e0b33,_0x1e5003=0x0;const _0x250b92=_0x475677[_0x3ae3c7(0x243)]['map'](_0x19782c=>{var _0x59f26f=_0x3ae3c7;_0x19782c[_0x59f26f(0x291)]==_0x2b5144['product_name']&&_0x19782c['bay']==_0x2b5144[_0x59f26f(0x251)]&&(_0x19782c[_0x59f26f(0x212)]=parseInt(_0x19782c[_0x59f26f(0x212)])+parseInt(_0x2b5144[_0x59f26f(0x2b7)]),_0x1e5003++);});_0x1e5003=='0'&&(_0x475677[_0x3ae3c7(0x243)]=_0x475677[_0x3ae3c7(0x243)]['concat']({'product_name':_0x2b5144[_0x3ae3c7(0x291)],'product_stock':_0x2b5144[_0x3ae3c7(0x2b7)],'primary_code':_0x2b5144[_0x3ae3c7(0x202)],'secondary_code':_0x2b5144[_0x3ae3c7(0x2a2)],'product_code':_0x2b5144['product_code'],'bay':_0x2b5144[_0x3ae3c7(0x251)],'maxProducts':_0x2b5144[_0x3ae3c7(0x1eb)],'unit':_0x2b5144[_0x3ae3c7(0x2b4)],'secondary_unit':_0x2b5144[_0x3ae3c7(0x2dc)],'expiry_date':_0x2b5144[_0x3ae3c7(0x297)]}));}),await _0x475677['save']();const _0x2a1840=await s_payment_data[_0x4e0b33(0x2b5)]({'invoice':_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x1ff)]});if(_0x2a1840===null){}else console[_0x4e0b33(0x254)](_0x4e0b33(0x249),_0x2a1840,_0x1e03db[_0x4e0b33(0x266)][_0x4e0b33(0x1ff)]),_0x2a1840[_0x4e0b33(0x249)]=_0x1e03db['body']['suppliers'],await _0x2a1840[_0x4e0b33(0x296)]();_0x1e03db['flash']('success',_0x4e0b33(0x24f)),_0x399d9f[_0x4e0b33(0x219)](_0x4e0b33(0x213));}catch(_0x2a8289){console[_0x4e0b33(0x254)](_0x2a8289);}}),router[a0_0x894d(0x2a5)]('/give_payment/:id',auth,async(_0x47e153,_0x5d9fd4)=>{var _0x4ffebb=a0_0x894d;try{const _0x373634=_0x47e153[_0x4ffebb(0x2c3)]['id'],{invoice:_0x170f52,suppliers:_0x8c5c3b,payable:_0xbd6079,due_amount:_0x941d99}=_0x47e153[_0x4ffebb(0x266)],_0x94e0ba=await purchases[_0x4ffebb(0x2c1)](_0x373634);var _0x39efd4=_0xbd6079-_0x941d99;_0x94e0ba[_0x4ffebb(0x23c)]=parseFloat(_0x94e0ba[_0x4ffebb(0x23c)])+parseFloat(_0x941d99),_0x94e0ba['due_amount']=_0x39efd4;const _0x36ddc1=await _0x94e0ba[_0x4ffebb(0x296)]();console[_0x4ffebb(0x254)](_0x36ddc1);const _0xa57b7f=await s_payment_data[_0x4ffebb(0x2b5)]({'invoice':_0x170f52});_0xa57b7f[_0x4ffebb(0x2a7)]=_0x39efd4,await _0xa57b7f[_0x4ffebb(0x296)]();let _0x14497c=new Date(),_0x2be9f1=('0'+_0x14497c[_0x4ffebb(0x20c)]())['slice'](-0x2),_0x42e8d4=('0'+(_0x14497c[_0x4ffebb(0x2aa)]()+0x1))['slice'](-0x2),_0x44536e=_0x14497c['getFullYear'](),_0x5f2fac=_0x44536e+'-'+_0x42e8d4+'-'+_0x2be9f1;const _0x9413c7=new suppliers_payment({'invoice':_0x170f52,'date':_0x44536e+'-'+_0x42e8d4+'-'+_0x2be9f1,'suppliers':_0x8c5c3b,'reason':'Paid\x20For\x20Purchase','amount':_0x941d99}),_0xcd72d4=await _0x9413c7[_0x4ffebb(0x296)]();_0x47e153[_0x4ffebb(0x252)](_0x4ffebb(0x22e),'payment\x20successfull'),_0x5d9fd4[_0x4ffebb(0x219)]('/all_purchases/view');}catch(_0x4adccc){console[_0x4ffebb(0x254)](_0x4adccc);}}),router[a0_0x894d(0x2b1)](a0_0x894d(0x28b),auth,async(_0x43682d,_0x257825)=>{var _0xb95ade=a0_0x894d;try{const {username:_0x2b61aa,email:_0x3022a0,role:_0x34341b}=_0x43682d[_0xb95ade(0x232)],_0x4cf109=_0x43682d[_0xb95ade(0x232)],_0x3b21bc=await profile['findOne']({'email':_0x4cf109[_0xb95ade(0x2e4)]}),_0x2935f0=await master_shop['find']();console[_0xb95ade(0x254)](_0xb95ade(0x2bf),_0x2935f0);const _0x11c110=_0x43682d[_0xb95ade(0x2c3)]['id'],_0x374735=await purchases[_0xb95ade(0x2c1)](_0x11c110);console['log'](_0x374735);const _0xc22a1a=await suppliers[_0xb95ade(0x2b5)]({'name':_0x374735[_0xb95ade(0x249)]});console['log'](_0xc22a1a);if(_0x2935f0[0x0][_0xb95ade(0x26e)]==_0xb95ade(0x269)){var _0x54e222=users[_0xb95ade(0x2a0)];console[_0xb95ade(0x254)](_0x54e222);}else{if(_0x2935f0[0x0][_0xb95ade(0x26e)]=='Hindi')var _0x54e222=users['Hindi'];else{if(_0x2935f0[0x0]['language']==_0xb95ade(0x2c8))var _0x54e222=users[_0xb95ade(0x2c8)];else{if(_0x2935f0[0x0][_0xb95ade(0x26e)]==_0xb95ade(0x21f))var _0x54e222=users[_0xb95ade(0x21f)];else{if(_0x2935f0[0x0][_0xb95ade(0x26e)]=='French')var _0x54e222=users[_0xb95ade(0x22d)];else{if(_0x2935f0[0x0][_0xb95ade(0x26e)]=='Portuguese\x20(BR)')var _0x54e222=users['Portuguese'];else{if(_0x2935f0[0x0]['language']=='Chinese')var _0x54e222=users[_0xb95ade(0x29c)];else{if(_0x2935f0[0x0]['language']==_0xb95ade(0x25c))var _0x54e222=users[_0xb95ade(0x286)];}}}}}}}_0x257825[_0xb95ade(0x2d4)](_0xb95ade(0x27a),{'success':_0x43682d['flash'](_0xb95ade(0x22e)),'errors':_0x43682d[_0xb95ade(0x252)]('errors'),'role':_0x4cf109,'profile':_0x3b21bc,'master_shop':_0x2935f0,'supplier':_0xc22a1a,'purchase':_0x374735,'language':_0x54e222});}catch(_0x5bfd46){console[_0xb95ade(0x254)](_0x5bfd46);}}),router[a0_0x894d(0x2b1)](a0_0x894d(0x218),auth,async(_0x36b1e8,_0x34aeac)=>{var _0x2a29aa=a0_0x894d;try{const {username:_0x188e30,email:_0x3f371f,role:_0x549c57}=_0x36b1e8[_0x2a29aa(0x232)],_0x844863=_0x36b1e8[_0x2a29aa(0x232)],_0x5f2a2a=await profile[_0x2a29aa(0x2b5)]({'email':_0x844863[_0x2a29aa(0x2e4)]}),_0x11cf4c=await master_shop[_0x2a29aa(0x2c0)]();console['log'](_0x2a29aa(0x2bf),_0x11cf4c);const _0xf01c86=_0x36b1e8['params']['id'];console[_0x2a29aa(0x254)](_0xf01c86);const _0x69a7e4=await purchases_finished[_0x2a29aa(0x2c1)](_0xf01c86);console['log'](_0x2a29aa(0x1f6),_0x69a7e4);const _0x4a7854=await product[_0x2a29aa(0x2c0)]({}),_0x3a0703=await warehouse[_0x2a29aa(0x227)]([{'$match':{'name':_0x69a7e4['warehouse_name'],'room':_0x69a7e4[_0x2a29aa(0x234)]}},{'$unwind':_0x2a29aa(0x29f)},{'$group':{'_id':_0x2a29aa(0x221),'name':{'$first':_0x2a29aa(0x1f2)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2a29aa(0x261)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x2a29aa(0x27f)},'secondary_code':{'$first':_0x2a29aa(0x2a1)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2a29aa(0x262)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x2a29aa(0x254)](_0x2a29aa(0x2ac),_0x3a0703);let _0x1a0d7f;if(_0x844863[_0x2a29aa(0x295)]=='staff'){const _0x4f652a=await staff[_0x2a29aa(0x2b5)]({'email':_0x844863[_0x2a29aa(0x2e4)]});_0x1a0d7f=await warehouse['find']({'status':'Enabled','name':_0x4f652a[_0x2a29aa(0x257)],'warehouse_category':_0x2a29aa(0x2af),'name':'Return\x20Goods'});}else _0x1a0d7f=await warehouse[_0x2a29aa(0x227)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);if(_0x11cf4c[0x0]['language']=='English\x20(US)'){var _0x2ca587=users['English'];console['log'](_0x2ca587);}else{if(_0x11cf4c[0x0]['language']==_0x2a29aa(0x225))var _0x2ca587=users['Hindi'];else{if(_0x11cf4c[0x0]['language']=='German')var _0x2ca587=users[_0x2a29aa(0x2c8)];else{if(_0x11cf4c[0x0][_0x2a29aa(0x26e)]==_0x2a29aa(0x21f))var _0x2ca587=users['Spanish'];else{if(_0x11cf4c[0x0][_0x2a29aa(0x26e)]==_0x2a29aa(0x22d))var _0x2ca587=users[_0x2a29aa(0x22d)];else{if(_0x11cf4c[0x0][_0x2a29aa(0x26e)]=='Portuguese\x20(BR)')var _0x2ca587=users[_0x2a29aa(0x20d)];else{if(_0x11cf4c[0x0][_0x2a29aa(0x26e)]==_0x2a29aa(0x29c))var _0x2ca587=users[_0x2a29aa(0x29c)];else{if(_0x11cf4c[0x0]['language']==_0x2a29aa(0x25c))var _0x2ca587=users[_0x2a29aa(0x286)];}}}}}}}_0x34aeac['render']('return_purchase_finished',{'success':_0x36b1e8[_0x2a29aa(0x252)]('success'),'errors':_0x36b1e8[_0x2a29aa(0x252)](_0x2a29aa(0x2b9)),'role':_0x844863,'profile':_0x5f2a2a,'user':_0x69a7e4,'stock':_0x3a0703,'master_shop':_0x11cf4c,'product':_0x4a7854,'language':_0x2ca587,'warehouse':_0x1a0d7f});}catch(_0x2ce159){console[_0x2a29aa(0x254)](_0x2ce159);}}),router[a0_0x894d(0x2a5)](a0_0x894d(0x218),auth,async(_0x476bb7,_0x3f8e7f)=>{var _0x2a0258=a0_0x894d;try{const {invoice:_0x460362,date:_0x45b3ae,warehouse_name:_0x8209db,Room_name:_0x586ff8,product_name:_0x5d6515,purchase_quantity:_0xe9e27e,stocks:_0x1f8256,return_qty:_0x2338ee,note:_0x497406,level:_0x46c2e2,isle:_0x1095e3,pallet:_0x40680e,to_warehouse_name:_0x500af7,to_Room_name:_0x35339f}=_0x476bb7[_0x2a0258(0x266)],_0x421481=await purchases_finished[_0x2a0258(0x2b5)]({'_id':_0x476bb7[_0x2a0258(0x2c3)]['id']}),_0x6eb4d9=await warehouse[_0x2a0258(0x2b5)]({'name':_0x8209db,'room':_0x586ff8,'warehouse_category':'Finished\x20Goods'});if(typeof _0x5d6515==_0x2a0258(0x2c4))var _0xc45afc=[_0x476bb7['body'][_0x2a0258(0x291)]],_0x2d0217=[_0x476bb7[_0x2a0258(0x266)]['purchase_quantity']],_0x3a5c8e=[_0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x2a9)]],_0x231761=[_0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x1ee)]],_0xb15932=[_0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x250)]],_0x31fe2a=[_0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x24b)]],_0x183b16=[_0x476bb7['body'][_0x2a0258(0x1f9)]],_0x194f0f=[_0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x2a4)]];else var _0xc45afc=[..._0x476bb7['body'][_0x2a0258(0x291)]],_0x2d0217=[..._0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x290)]],_0x3a5c8e=[..._0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x2a9)]],_0x231761=[..._0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x1ee)]],_0xb15932=[..._0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x250)]],_0x31fe2a=[..._0x476bb7[_0x2a0258(0x266)]['product_code_hide']],_0x183b16=[..._0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x1f9)]],_0x194f0f=[..._0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x2a4)]];const _0x4e8256=_0xc45afc[_0x2a0258(0x267)](_0x4e3d16=>{return _0x4e3d16={'product_name':_0x4e3d16};});_0x2d0217[_0x2a0258(0x258)]((_0x4faf57,_0x3a5e7c)=>{var _0x131021=_0x2a0258;_0x4e8256[_0x3a5e7c][_0x131021(0x290)]=_0x4faf57;}),_0x3a5c8e['forEach']((_0x47b2b8,_0xa63303)=>{_0x4e8256[_0xa63303]['stock_quantity']=_0x47b2b8;}),_0x231761['forEach']((_0x37237c,_0x1a9600)=>{var _0x2ca1bd=_0x2a0258;_0x4e8256[_0x1a9600][_0x2ca1bd(0x1ee)]=_0x37237c;}),_0xb15932[_0x2a0258(0x258)]((_0x26330e,_0x294819)=>{_0x4e8256[_0x294819]['bay']=_0x26330e;}),_0x31fe2a[_0x2a0258(0x258)]((_0x2871ef,_0xc685dd)=>{var _0x10ce79=_0x2a0258;_0x4e8256[_0xc685dd][_0x10ce79(0x268)]=_0x2871ef;}),_0x183b16[_0x2a0258(0x258)]((_0x44d720,_0x35a90e)=>{_0x4e8256[_0x35a90e]['primary_code']=_0x44d720;}),_0x194f0f[_0x2a0258(0x258)]((_0x240829,_0x238db0)=>{var _0x160862=_0x2a0258;_0x4e8256[_0x238db0][_0x160862(0x2a2)]=_0x240829;}),_0x4e8256[_0x2a0258(0x258)](_0x2e5cdd=>{var _0x2ac317=_0x2a0258;console[_0x2ac317(0x254)](_0x2e5cdd);const _0x2c6f87=_0x6eb4d9[_0x2ac317(0x243)][_0x2ac317(0x267)](_0x1b6f7b=>{var _0x3c0dd0=_0x2ac317;_0x1b6f7b[_0x3c0dd0(0x291)]==_0x2e5cdd['product_name']&&_0x1b6f7b[_0x3c0dd0(0x251)]==_0x2e5cdd['bay']&&(console[_0x3c0dd0(0x254)](parseInt(_0x1b6f7b[_0x3c0dd0(0x212)])+_0x3c0dd0(0x220)+parseInt(_0x2e5cdd[_0x3c0dd0(0x1ee)])),_0x1b6f7b[_0x3c0dd0(0x212)]=parseInt(_0x1b6f7b[_0x3c0dd0(0x212)])-parseInt(_0x2e5cdd[_0x3c0dd0(0x1ee)]));});}),await _0x6eb4d9['save']();var _0x118a68=0x0;_0x4e8256[_0x2a0258(0x258)](_0x4b6ab0=>{var _0x116bab=_0x2a0258;(parseInt(_0x4b6ab0[_0x116bab(0x290)])<parseInt(_0x4b6ab0[_0x116bab(0x1ee)])||parseInt(_0x4b6ab0[_0x116bab(0x2d0)])<parseInt(_0x4b6ab0[_0x116bab(0x1ee)]))&&_0x118a68++;});if(_0x118a68!=0x0)return _0x476bb7['flash'](_0x2a0258(0x2b9),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3f8e7f[_0x2a0258(0x219)](_0x2a0258(0x2ea));const _0x589b99=new purchases_return_finished({'invoice':_0x460362,'suppliers':_0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x249)],'date':_0x45b3ae,'warehouse_name':_0x8209db,'return_product':_0x4e8256,'note':_0x497406,'room':_0x586ff8,'to_warehouse_name':_0x500af7,'to_room':_0x35339f}),_0x417093=await _0x589b99[_0x2a0258(0x296)](),_0x208bf3=await purchases_return_finished[_0x2a0258(0x2b5)]({'invoice':_0x460362}),_0x1801af=await warehouse[_0x2a0258(0x2b5)]({'name':_0x500af7,'room':_0x35339f,'warehouse_category':_0x2a0258(0x2af)});_0x208bf3[_0x2a0258(0x248)][_0x2a0258(0x258)](_0x4e120f=>{var _0x387006=_0x2a0258,_0x4a1bdb=0x0;const _0x44afbc=_0x1801af[_0x387006(0x243)][_0x387006(0x267)](_0x3eaa1f=>{var _0x169cea=_0x387006;console[_0x169cea(0x254)](_0x3eaa1f[_0x169cea(0x291)]+'=='+_0x4e120f[_0x169cea(0x291)]+'&&'+_0x3eaa1f['bay']+'=='+_0x4e120f[_0x169cea(0x251)]),_0x3eaa1f[_0x169cea(0x291)]==_0x4e120f[_0x169cea(0x291)]&&_0x3eaa1f[_0x169cea(0x251)]==_0x4e120f[_0x169cea(0x251)]&&(_0x3eaa1f[_0x169cea(0x212)]=parseInt(_0x3eaa1f['product_stock'])-parseInt(_0x4e120f[_0x169cea(0x1ee)]),_0x4a1bdb++);});_0x4a1bdb=='0'&&(_0x1801af[_0x387006(0x243)]=_0x1801af['product_details'][_0x387006(0x26c)]({'product_name':_0x4e120f[_0x387006(0x291)],'product_stock':_0x4e120f[_0x387006(0x1ee)],'primary_code':_0x4e120f[_0x387006(0x202)],'secondary_code':_0x4e120f[_0x387006(0x2a2)],'product_code':_0x4e120f[_0x387006(0x268)],'bay':_0x4e120f[_0x387006(0x251)],'maxProducts':0xf423f}));}),await _0x1801af[_0x2a0258(0x296)]();const _0x56479=await purchases_finished['findOne']({'invoice':_0x460362});_0x56479['return_data']=_0x2a0258(0x2d1);const _0x4fcf1e=await _0x56479[_0x2a0258(0x296)](),_0x37643e=new s_payment_data({'invoice':_0x460362,'suppliers':_0x476bb7['body'][_0x2a0258(0x249)],'reason':_0x2a0258(0x245)});await _0x37643e['save']();const _0x48b5f9=await master_shop[_0x2a0258(0x2c0)](),_0x358d21=await email_settings[_0x2a0258(0x2b5)](),_0x3b15f6=await suppliers['findOne']({'name':_0x476bb7[_0x2a0258(0x266)][_0x2a0258(0x249)]});_0x48b5f9[0x0][_0x2a0258(0x2b3)]==0x1?(right_currency=_0x48b5f9[0x0][_0x2a0258(0x2cb)],left_currency=''):(right_currency='',left_currency=_0x48b5f9[0x0]['currency']);var _0x245bae=_0xc45afc,_0x48d925=_0x231761,_0x2552e6='',_0x6fc09c;for(_0x6fc09c in _0x245bae){_0x2552e6+=_0x2a0258(0x259)+_0x2a0258(0x23d)+_0x245bae[_0x6fc09c]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x48d925[_0x6fc09c]+_0x2a0258(0x205)+_0x2a0258(0x25a);}let _0x1c15b7=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x358d21[_0x2a0258(0x2e4)],'pass':_0x358d21['password']}}),_0x1c1127={'from':_0x358d21['email'],'to':_0x3b15f6['email'],'subject':_0x2a0258(0x260),'attachments':[{'filename':_0x2a0258(0x28f),'path':__dirname+_0x2a0258(0x22c)+_0x2a0258(0x2ba)+_0x48b5f9[0x0][_0x2a0258(0x24c)],'cid':_0x2a0258(0x298)}],'html':_0x2a0258(0x293)+_0x2a0258(0x2e6)+_0x2a0258(0x2bc)+_0x2a0258(0x2d7)+_0x2a0258(0x26a)+_0x2a0258(0x2d7)+_0x2a0258(0x244)+_0x2a0258(0x238)+_0x2a0258(0x2d7)+_0x2a0258(0x256)+_0x48b5f9[0x0][_0x2a0258(0x229)]+_0x2a0258(0x231)+_0x2a0258(0x238)+_0x2a0258(0x238)+_0x2a0258(0x208)+_0x2a0258(0x2d7)+_0x2a0258(0x280)+_0x2a0258(0x25d)+_0x460362+'\x20'+_0x2a0258(0x1f0)+'\x20Order\x20Date\x20:\x20'+_0x45b3ae+'\x20'+_0x2a0258(0x211)+_0x2a0258(0x2be)+'</div>'+_0x2a0258(0x28d)+_0x2a0258(0x23b)+_0x2a0258(0x259)+_0x2a0258(0x247)+_0x2a0258(0x29d)+_0x2a0258(0x2da)+_0x2a0258(0x21c)+_0x2a0258(0x25a)+_0x2a0258(0x23a)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2552e6+'\x20'+'</tbody>'+_0x2a0258(0x210)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x2a0258(0x264)+_0x48b5f9[0x0][_0x2a0258(0x229)]+'</h5>'+'</div>'+_0x2a0258(0x238)+_0x2a0258(0x277)};_0x1c15b7[_0x2a0258(0x224)](_0x1c1127,function(_0x1d232a,_0x18c6d5){var _0x2a16fe=_0x2a0258;_0x1d232a?console[_0x2a16fe(0x254)]('Error\x20Occurs'):console[_0x2a16fe(0x254)](_0x2a16fe(0x2de));}),_0x476bb7['flash'](_0x2a0258(0x22e),_0x2a0258(0x22b)),_0x3f8e7f[_0x2a0258(0x219)](_0x2a0258(0x213));}catch(_0x443e4b){_0x3f8e7f[_0x2a0258(0x207)](0xc8)['json']({'message':_0x443e4b[_0x2a0258(0x1f7)]});}}),router[a0_0x894d(0x2b1)](a0_0x894d(0x271),auth,async(_0x3ed50c,_0x4c18e9)=>{var _0x9aa45a=a0_0x894d;try{const {username:_0x5e6e80,email:_0x2db8ae,role:_0x244adb}=_0x3ed50c[_0x9aa45a(0x232)],_0x528bea=_0x3ed50c[_0x9aa45a(0x232)],_0xe4a830=await profile['findOne']({'email':_0x528bea[_0x9aa45a(0x2e4)]}),_0x2f5500=await master_shop[_0x9aa45a(0x2c0)](),_0x68b17f=_0x3ed50c[_0x9aa45a(0x2c3)]['id'],_0x33e501=await purchases_finished[_0x9aa45a(0x2c1)](_0x68b17f);if(_0x2f5500[0x0][_0x9aa45a(0x26e)]==_0x9aa45a(0x269))var _0x93afd6=users['English'];else{if(_0x2f5500[0x0]['language']==_0x9aa45a(0x225))var _0x93afd6=users[_0x9aa45a(0x225)];else{if(_0x2f5500[0x0]['language']==_0x9aa45a(0x2c8))var _0x93afd6=users['German'];else{if(_0x2f5500[0x0][_0x9aa45a(0x26e)]=='Spanish')var _0x93afd6=users[_0x9aa45a(0x21f)];else{if(_0x2f5500[0x0][_0x9aa45a(0x26e)]==_0x9aa45a(0x22d))var _0x93afd6=users[_0x9aa45a(0x22d)];else{if(_0x2f5500[0x0][_0x9aa45a(0x26e)]==_0x9aa45a(0x2cf))var _0x93afd6=users[_0x9aa45a(0x20d)];else{if(_0x2f5500[0x0]['language']==_0x9aa45a(0x29c))var _0x93afd6=users['Chinese'];else{if(_0x2f5500[0x0][_0x9aa45a(0x26e)]=='Arabic\x20(ae)')var _0x93afd6=users[_0x9aa45a(0x286)];}}}}}}}_0x4c18e9[_0x9aa45a(0x2d4)](_0x9aa45a(0x2e3),{'success':_0x3ed50c[_0x9aa45a(0x252)](_0x9aa45a(0x22e)),'errors':_0x3ed50c[_0x9aa45a(0x252)](_0x9aa45a(0x2b9)),'role':_0x528bea,'profile':_0xe4a830,'alldata':_0x33e501,'master_shop':_0x2f5500,'language':_0x93afd6}),console[_0x9aa45a(0x254)](alldata);}catch(_0x171f47){console[_0x9aa45a(0x254)](_0x171f47);}}),router['post'](a0_0x894d(0x274),async(_0x47e52e,_0x57fa3e)=>{var _0x209116=a0_0x894d;const {product_code:_0x159220}=_0x47e52e[_0x209116(0x266)];var _0x38aaf4;const _0x54133a=await product[_0x209116(0x227)]([{'$match':{'primary_code':_0x159220,'product_category':_0x209116(0x2af)}},{'$group':{'_id':_0x209116(0x28a),'name':{'$first':_0x209116(0x2e5)},'category':{'$first':_0x209116(0x233)},'brand':{'$first':_0x209116(0x242)},'unit':{'$first':_0x209116(0x287)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x209116(0x29b)},'primary_code':{'$first':_0x209116(0x25f)},'secondary_code':{'$first':_0x209116(0x2a6)},'maxStocks':{'$first':_0x209116(0x2e1)},'maxProdPerUnit':{'$first':_0x209116(0x20f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x209116(0x2c6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2c4778=await product['aggregate']([{'$match':{'secondary_code':_0x159220}},{'$group':{'_id':_0x209116(0x28a),'name':{'$first':'$name'},'category':{'$first':_0x209116(0x233)},'brand':{'$first':'$brand'},'unit':{'$first':_0x209116(0x287)},'alertquantity':{'$first':_0x209116(0x2d3)},'product_code':{'$first':_0x209116(0x29b)},'primary_code':{'$first':_0x209116(0x25f)},'secondary_code':{'$first':_0x209116(0x2a6)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x209116(0x20f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x209116(0x2c6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x54133a[_0x209116(0x237)]>0x0)_0x38aaf4=_0x54133a;else _0x2c4778[_0x209116(0x237)]>0x0&&(_0x38aaf4=_0x2c4778);_0x57fa3e[_0x209116(0x2e2)](_0x38aaf4);}),router['post']('/CheckingWarehouse',async(_0x1aef56,_0x186033)=>{var _0x3bcc2d=a0_0x894d;const {productCode:_0x5b859f,bay:_0x10b280,warehouses:_0x5ad199,room:_0x1b95d5}=_0x1aef56[_0x3bcc2d(0x266)];console[_0x3bcc2d(0x254)](_0x1aef56[_0x3bcc2d(0x266)]);try{const _0x4fb21f=await warehouse[_0x3bcc2d(0x227)]([{'$match':{'name':_0x5ad199,'room':_0x1b95d5}},{'$unwind':_0x3bcc2d(0x29f)},{'$match':{'product_details.bay':parseInt(_0x10b280)}},{'$group':{'_id':_0x3bcc2d(0x221),'name':{'$first':_0x3bcc2d(0x1f2)},'product_stock':{'$first':_0x3bcc2d(0x299)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x186033['status'](0xc8)[_0x3bcc2d(0x2e2)](_0x4fb21f);}catch(_0x54078e){_0x186033[_0x3bcc2d(0x207)](0x194)[_0x3bcc2d(0x2e2)]({'message':_0x54078e[_0x3bcc2d(0x1f7)]});}}),module[a0_0x894d(0x279)]=router;