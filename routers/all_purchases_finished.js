var a0_0x5e0557=a0_0x3f9c;function a0_0x3f9c(_0x594117,_0xece851){var _0x123f39=a0_0x123f();return a0_0x3f9c=function(_0x3f9c92,_0x1ef3c2){_0x3f9c92=_0x3f9c92-0x83;var _0x2a8376=_0x123f39[_0x3f9c92];return _0x2a8376;},a0_0x3f9c(_0x594117,_0xece851);}(function(_0x5b2d58,_0xda7fdb){var _0x4ecf42=a0_0x3f9c,_0x1f2496=_0x5b2d58();while(!![]){try{var _0x46dfaf=-parseInt(_0x4ecf42(0xc8))/0x1+parseInt(_0x4ecf42(0xab))/0x2*(parseInt(_0x4ecf42(0x117))/0x3)+parseInt(_0x4ecf42(0x9f))/0x4+-parseInt(_0x4ecf42(0xa7))/0x5+parseInt(_0x4ecf42(0xcc))/0x6+parseInt(_0x4ecf42(0x174))/0x7+parseInt(_0x4ecf42(0xff))/0x8*(-parseInt(_0x4ecf42(0x14b))/0x9);if(_0x46dfaf===_0xda7fdb)break;else _0x1f2496['push'](_0x1f2496['shift']());}catch(_0x20c9a1){_0x1f2496['push'](_0x1f2496['shift']());}}}(a0_0x123f,0xc847d));const express=require(a0_0x5e0557(0x83)),app=express(),router=express[a0_0x5e0557(0x14c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x5e0557(0xbb)),auth=require(a0_0x5e0557(0xd9)),nodemailer=require(a0_0x5e0557(0x12b));var ejs=require(a0_0x5e0557(0xad));const path=require(a0_0x5e0557(0x10f)),users=require('../public/language/languages.json');router[a0_0x5e0557(0x86)](a0_0x5e0557(0x116),auth,async(_0x159efe,_0x4aea7e)=>{var _0x379584=a0_0x5e0557;try{const {username:_0x4c64c0,email:_0x34bb72,role:_0x155ab5}=_0x159efe['user'],_0x1fb27f=_0x159efe[_0x379584(0x168)],_0x3cf417=await profile[_0x379584(0xa9)]({'email':_0x1fb27f[_0x379584(0x88)]}),_0x5f388c=await staff[_0x379584(0xa9)]({'email':_0x1fb27f['email']});if(_0x1fb27f[_0x379584(0x97)]==_0x379584(0xd3)){const _0x26dcae=await staff[_0x379584(0xa9)]({'email':_0x1fb27f[_0x379584(0x88)]});}const _0xcd9a99=await master_shop[_0x379584(0x101)]();let _0x5a627d;if(_0x1fb27f[_0x379584(0x97)]=='staff'){const _0x2541c3=await staff[_0x379584(0xa9)]({'email':_0x1fb27f[_0x379584(0x88)]});_0x5a627d=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x2541c3[_0x379584(0x125)]}},{'$lookup':{'from':'suppliers','localField':_0x379584(0xb0),'foreignField':_0x379584(0xc7),'as':_0x379584(0x16f)}},{'$unwind':_0x379584(0x16d)},{'$unwind':_0x379584(0x140)},{'$group':{'_id':_0x379584(0x14e),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x379584(0x93)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x379584(0x84)},'room':{'$first':_0x379584(0x92)},'product':{'$push':'$product'},'note':{'$first':_0x379584(0x9b)},'paid_amount':{'$first':_0x379584(0x100)},'due_amount':{'$first':_0x379584(0x127)},'return_data':{'$first':_0x379584(0x91)},'batch_code':{'$first':_0x379584(0x10a)},'expiry_date':{'$first':_0x379584(0xcd)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x379584(0x15e)},'type':{'$addToSet':_0x379584(0x11e)},'floorlevel':{'$addToSet':_0x379584(0x14d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5a627d=await purchases_finished[_0x379584(0x9d)]([{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x379584(0xf0)},'suppliers':{'$first':_0x379584(0x93)},'date':{'$first':_0x379584(0x15f)},'warehouse_name':{'$first':_0x379584(0x84)},'room':{'$addToSet':_0x379584(0x15a)},'product':{'$push':_0x379584(0x140)},'note':{'$first':_0x379584(0x9b)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x379584(0x127)},'return_data':{'$first':_0x379584(0x91)},'batch_code':{'$first':_0x379584(0x10a)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x379584(0x16d)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x379584(0xe5)},'isle':{'$addToSet':_0x379584(0x15e)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x379584(0x14d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xcd9a99[0x0][_0x379584(0xbd)]=='English\x20(US)')var _0x61909f=users['English'];else{if(_0xcd9a99[0x0][_0x379584(0xbd)]==_0x379584(0xf7))var _0x61909f=users[_0x379584(0xf7)];else{if(_0xcd9a99[0x0][_0x379584(0xbd)]==_0x379584(0x15b))var _0x61909f=users[_0x379584(0x15b)];else{if(_0xcd9a99[0x0][_0x379584(0xbd)]==_0x379584(0x95))var _0x61909f=users[_0x379584(0x95)];else{if(_0xcd9a99[0x0]['language']==_0x379584(0xc6))var _0x61909f=users[_0x379584(0xc6)];else{if(_0xcd9a99[0x0][_0x379584(0xbd)]==_0x379584(0xb9))var _0x61909f=users['Portuguese'];else{if(_0xcd9a99[0x0]['language']==_0x379584(0xf6))var _0x61909f=users[_0x379584(0xf6)];else{if(_0xcd9a99[0x0][_0x379584(0xbd)]==_0x379584(0x8a))var _0x61909f=users[_0x379584(0x108)];}}}}}}}_0x4aea7e[_0x379584(0xc2)](_0x379584(0x146),{'success':_0x159efe[_0x379584(0x12e)](_0x379584(0x107)),'errors':_0x159efe[_0x379584(0x12e)](_0x379584(0x169)),'purchases':_0x5a627d,'role':_0x1fb27f,'profile':_0x3cf417,'master_shop':_0xcd9a99,'language':_0x61909f});}catch(_0xacdfdc){console[_0x379584(0x154)](_0x379584(0x141),_0xacdfdc),_0x4aea7e[_0x379584(0xfa)](0xc8)[_0x379584(0x16b)]({'message':_0xacdfdc[_0x379584(0x148)]});}});function BayBinSelected(_0x5d9d41,_0x29e5b9){var _0x23fe27=a0_0x5e0557,_0x7f97b7=[],_0x423c2f=[];if(_0x5d9d41==_0x23fe27(0x13a)){switch(_0x29e5b9){case'Rack\x201':_0x7f97b7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x7f97b7=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x423c2f=['DG'];}else{if(_0x5d9d41=='FROZEN\x20GOODS'){switch(_0x29e5b9){case _0x23fe27(0x11b):_0x7f97b7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x23fe27(0xd7):_0x7f97b7=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x423c2f=['FG'];}}return{'levels':_0x7f97b7,'identify':_0x423c2f};}function a0_0x123f(){var _0x4bdd42=['prod_name','secondary_unit','due_amount','product_stock','product_code_hide','<span\x20style=\x22float:\x20right;\x22>','return_product','post','note','product','secondary_code','$product.bay','$unit','stock_quantity','Enabled','<h5\x20style=\x22text-align:\x20left;\x22>','/give_payment/:id','product_date','purchase\x20data\x20add\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.bay','redirect','$invoice','room','password','$product_details.product_stock','</td>','RoomAssign','Chinese','Hindi','toString','</head><body>','status','quantity','/invoice/:id','$secondary_unit','product_cat','187336YDSTAD','$paid_amount','find','prod_level','<tr>','map','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','params','success','Arabic','edit_purchases_finished','$batch_code','English\x20(US)','<h2>\x20','</body></html>','save','path','add_purchases_finished','createTransport','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/view','162267SOrJFL','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','gmail','<html><head><title></title>','Rack\x201','$product_details.type','invoice','$product.type','prod_unit','$product_details.bin','updateOne','return_data','prod_Qty','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','warehouse','/all_purchases_finished/view','$due_amount','$alertquantity','floor','$product_details','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','exports','flash','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','getFullYear','level','$product_code','forEach','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/view/:id','currency_placement','Error\x20Occurs','product_name','DRY\x20GOODS','prod_cat','getMonth','POnumber','return_purchase_finished','batch_code','$product','table\x20page','date','all_purchases_barcode','/view/add_purchases/:id','/preview/:id','all_purchases_finished','/CheckingWarehouse','message','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<!DOCTYPE\x20html>','576AnNOEq','Router','$product.floorlevel','$_id','slice','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Email\x20sent\x20successfully','$category','Return\x20Goods','log','</table>','INCF-','image','sendMail','</tr>','$product.room_name','German','prod_code','</div>','$product.bin','$date','$maxProdPerUnit','<div>','$primary_code','MaxStocks_data','</span>','site_title','product_code','error','user','errors','stocks','json','filter','$suppliers_docs','/all_purchases/view','suppliers_docs','primary_code_hide','maxStocks','prod_primunit','string','11175381tenZCG','then','/barcode/:id','express','$warehouse_name','padStart','get','max_product_unit','email','Purchase\x20Return','Arabic\x20(ae)','FGSEmail','findById','user_id','Finished\x20Goods','production_date','edit_purchases_finished_view','$return_data','$room','$suppliers','prod_invoice','Spanish','$product_details._id','role','/../public','body','Ambient','$note','$product_details.maxProducts','aggregate','</thead>','4417512BxkbdT','port','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','currency','primary_code','warehouse_name','</tbody>','random','5388660VpCLAM','maxperunit','findOne','prod_qty','42WQcANB','payment\x20successfull','ejs','English','concat','suppliers','$maxStocks','</h5>','room_name','master','\x20Order\x20Date\x20:\x20','purchase_invoice','bay','Logo.png','Portuguese\x20(BR)','add_purchases\x20error','../models/all_models','$name','language','$product_details.floorlevel','secondary_code_hide','logo','expiry_date','render','length','return_qty','product_details','French','name','750365WOxLyn','Portuguese','/view/return_purchase/:id','standard_unit','1862424kLVTYA','$expiry_date','$product_details.product_name','getDate','/upload/','stock_data','<h5>','staff','catch','purchase_quantity','prod_secondunit','Rack\x202','<tbody\x20style=\x22text-align:\x20center;\x22>','../middleware/auth'];a0_0x123f=function(){return _0x4bdd42;};return a0_0x123f();}async function getRandom8DigitNumber(){var _0x120779=a0_0x5e0557;const _0x1b22af=0x989680,_0x15d424=0x5f5e0ff,_0x481da3=Math[_0x120779(0x129)](Math[_0x120779(0xa6)]()*(_0x15d424-_0x1b22af+0x1))+_0x1b22af;var _0x49a314;const _0x93ba1d=await purchases_finished[_0x120779(0xa9)]({'invoice':_0x120779(0x156)+_0x481da3});return _0x93ba1d&&_0x93ba1d[_0x120779(0xc3)]>0x0?_0x49a314=_0x120779(0x156)+_0x481da3:_0x49a314=_0x120779(0x156)+_0x481da3,_0x49a314;}router[a0_0x5e0557(0x86)]('/view/add_purchases',auth,async(_0x41f54c,_0x19e102)=>{var _0x5ec58d=a0_0x5e0557;try{const {username:_0x41e4bd,email:_0x17b686,role:_0x415fc5}=_0x41f54c['user'],_0x593c38=_0x41f54c['user'],_0x1abed8=await profile[_0x5ec58d(0xa9)]({'email':_0x593c38[_0x5ec58d(0x88)]}),_0x4bb3ae=await master_shop[_0x5ec58d(0x101)](),_0x29e353=await staff[_0x5ec58d(0xa9)]({'email':_0x593c38[_0x5ec58d(0x88)]}),_0x1c6f1c=await suppliers[_0x5ec58d(0x101)]({});let _0x3cecb7;if(_0x593c38[_0x5ec58d(0x97)]==_0x5ec58d(0xd3)){const _0x222d41=await staff[_0x5ec58d(0xa9)]({'email':_0x593c38[_0x5ec58d(0x88)]});_0x3cecb7=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x222d41[_0x5ec58d(0x125)],'warehouse_category':_0x5ec58d(0x8e)}},{'$group':{'_id':'$name','name':{'$first':_0x5ec58d(0xbc)}}}]);}else _0x3cecb7=await warehouse[_0x5ec58d(0x9d)]([{'$match':{'status':_0x5ec58d(0xe8),'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x5ec58d(0xbc),'name':{'$first':_0x5ec58d(0xbc)}}}]);const _0x2c5cc6=await product[_0x5ec58d(0x101)]({}),_0x51a872=await warehouse[_0x5ec58d(0x101)]({'status':_0x5ec58d(0xe8)}),_0x389031=await purchases_finished[_0x5ec58d(0x101)]({}),_0x5de4b4=_0x389031['length']+0x1,_0x55a09e=_0x5ec58d(0x156)+_0x5de4b4[_0x5ec58d(0xf8)]()[_0x5ec58d(0x85)](0x5,'0');var _0x1d708a=[_0x5ec58d(0x9a),'Enclosed'];if(_0x4bb3ae[0x0][_0x5ec58d(0xbd)]==_0x5ec58d(0x10b))var _0x2299a3=users[_0x5ec58d(0xae)];else{if(_0x4bb3ae[0x0][_0x5ec58d(0xbd)]=='Hindi')var _0x2299a3=users['Hindi'];else{if(_0x4bb3ae[0x0][_0x5ec58d(0xbd)]==_0x5ec58d(0x15b))var _0x2299a3=users[_0x5ec58d(0x15b)];else{if(_0x4bb3ae[0x0]['language']==_0x5ec58d(0x95))var _0x2299a3=users['Spanish'];else{if(_0x4bb3ae[0x0]['language']==_0x5ec58d(0xc6))var _0x2299a3=users[_0x5ec58d(0xc6)];else{if(_0x4bb3ae[0x0][_0x5ec58d(0xbd)]==_0x5ec58d(0xb9))var _0x2299a3=users['Portuguese'];else{if(_0x4bb3ae[0x0][_0x5ec58d(0xbd)]==_0x5ec58d(0xf6))var _0x2299a3=users[_0x5ec58d(0xf6)];else{if(_0x4bb3ae[0x0][_0x5ec58d(0xbd)]==_0x5ec58d(0x8a))var _0x2299a3=users[_0x5ec58d(0x108)];}}}}}}}const _0x160c71=getRandom8DigitNumber();_0x160c71[_0x5ec58d(0x175)](_0x24c550=>{var _0x2c3e20=_0x5ec58d;_0x19e102['render'](_0x2c3e20(0x110),{'success':_0x41f54c[_0x2c3e20(0x12e)](_0x2c3e20(0x107)),'errors':_0x41f54c['flash']('errors'),'role':_0x593c38,'profile':_0x1abed8,'suppliers':_0x1c6f1c,'warehouse':_0x3cecb7,'product':_0x2c5cc6,'invoice':_0x24c550,'master_shop':_0x4bb3ae,'language':_0x2299a3,'find_data':_0x51a872,'rooms_data':_0x1d708a});})['catch'](_0x3e0d4e=>{var _0x446edd=_0x5ec58d;_0x41f54c[_0x446edd(0x12e)](_0x446edd(0x169),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x19e102[_0x446edd(0xef)](_0x446edd(0x126));});}catch(_0x400a29){console[_0x5ec58d(0x154)](_0x400a29);}}),router['get'](a0_0x5e0557(0x144),auth,async(_0x4b4916,_0x1aac3d)=>{var _0x254a0e=a0_0x5e0557;try{const _0x4db001=_0x4b4916[_0x254a0e(0x106)]['id'];console[_0x254a0e(0x154)](_0x4db001);const _0x1d2cf1=await master_shop[_0x254a0e(0x101)]();console[_0x254a0e(0x154)](_0x254a0e(0xb4),_0x1d2cf1);const _0x1e0719=await product[_0x254a0e(0xa9)]({'name':_0x4db001});console[_0x254a0e(0x154)]('product',_0x1e0719),_0x1aac3d['status'](0xc8)['json']({'product_data':_0x1e0719,'master':_0x1d2cf1});}catch(_0x45c68f){console[_0x254a0e(0x154)](_0x254a0e(0xba),_0x45c68f);}}),router[a0_0x5e0557(0xe1)]('/view/add_purchases',auth,async(_0x21f572,_0x3cd234)=>{var _0x439659=a0_0x5e0557;try{const {invoice:_0x55bfd9,date:_0x47adc2,warehouse_name:_0x4706de,prod_name:_0x4fec31,prod_code:_0x328225,prod_qty:_0x5a0be9,prod_unit:_0x50e00f,prod_secondunit:_0x3d1eb9,prod_level:_0x324260,prod_isle:_0x50f849,prod_pallet:_0x5e1da4,note:_0x74c8d9,expiry_date:_0x38a3a6,batch_code:_0x39418e,payable:_0x276a59,due_amount:_0x3f25c8,Room_name:_0x53ddac,primary_code:_0x1209be,secondary_code:_0x423995,MaxStocks_data:_0x262f02,PO_number:_0xcea4a0,SCRN:_0x2549d0,JO_number:_0x307de7}=_0x21f572[_0x439659(0x99)];if(typeof _0x4fec31==_0x439659(0x173))var _0x5544e7=[_0x21f572[_0x439659(0x99)]['prod_name']],_0x575a4c=[_0x21f572[_0x439659(0x99)][_0x439659(0x15c)]],_0x112c6d=[_0x21f572[_0x439659(0x99)][_0x439659(0x123)]],_0x3ced12=[_0x21f572['body'][_0x439659(0x172)]],_0x2c06f9=[_0x21f572[_0x439659(0x99)][_0x439659(0xd6)]],_0x4b0d01=[_0x21f572[_0x439659(0x99)][_0x439659(0x102)]],_0x4d44c5=[_0x21f572[_0x439659(0x99)]['primary_code']],_0x5a688d=[_0x21f572[_0x439659(0x99)][_0x439659(0xe4)]],_0x3bc947=[_0x21f572[_0x439659(0x99)][_0x439659(0x163)]],_0x5f0187=[_0x21f572[_0x439659(0x99)][_0x439659(0x13f)]],_0x3c6c8e=[_0x21f572['body'][_0x439659(0xc1)]],_0x1d8e70=[_0x21f572[_0x439659(0x99)][_0x439659(0xeb)]],_0x2e7596=[_0x21f572['body'][_0x439659(0x87)]],_0x49e977=[_0x21f572['body']['prod_cat']],_0xb05d4e=[_0x21f572[_0x439659(0x99)][_0x439659(0xf5)]],_0x4c026e=[_0x21f572[_0x439659(0x99)][_0x439659(0x94)]];else var _0x5544e7=[..._0x21f572[_0x439659(0x99)][_0x439659(0xda)]],_0x575a4c=[..._0x21f572[_0x439659(0x99)][_0x439659(0x15c)]],_0x112c6d=[..._0x21f572[_0x439659(0x99)][_0x439659(0x123)]],_0x3ced12=[..._0x21f572[_0x439659(0x99)]['prod_primunit']],_0x2c06f9=[..._0x21f572[_0x439659(0x99)][_0x439659(0xd6)]],_0x4b0d01=[..._0x21f572[_0x439659(0x99)][_0x439659(0x102)]],_0x4d44c5=[..._0x21f572[_0x439659(0x99)][_0x439659(0xa3)]],_0x5a688d=[..._0x21f572['body'][_0x439659(0xe4)]],_0x3bc947=[..._0x21f572[_0x439659(0x99)]['MaxStocks_data']],_0x5f0187=[..._0x21f572[_0x439659(0x99)]['batch_code']],_0x3c6c8e=[..._0x21f572[_0x439659(0x99)][_0x439659(0xc1)]],_0x1d8e70=[..._0x21f572[_0x439659(0x99)]['product_date']],_0x2e7596=[..._0x21f572[_0x439659(0x99)][_0x439659(0x87)]],_0x49e977=[..._0x21f572[_0x439659(0x99)][_0x439659(0x13b)]],_0xb05d4e=[..._0x21f572[_0x439659(0x99)][_0x439659(0xf5)]],_0x4c026e=[..._0x21f572[_0x439659(0x99)]['prod_invoice']];const _0x182317=_0x5544e7[_0x439659(0x104)](_0x28cd8d=>{return _0x28cd8d={'product_name':_0x28cd8d};});_0x575a4c[_0x439659(0x133)]((_0x5597e8,_0x2600e5)=>{_0x182317[_0x2600e5]['product_code']=_0x5597e8;}),_0x112c6d[_0x439659(0x133)]((_0x3323f3,_0x24b10f)=>{var _0x43a107=_0x439659;_0x182317[_0x24b10f][_0x43a107(0xfb)]=_0x3323f3;}),_0x3ced12[_0x439659(0x133)]((_0x580a3d,_0x1abc63)=>{var _0x528185=_0x439659;_0x182317[_0x1abc63][_0x528185(0xcb)]=_0x580a3d;}),_0x2c06f9[_0x439659(0x133)]((_0x4fb055,_0x45ea04)=>{var _0x2767c6=_0x439659;_0x182317[_0x45ea04][_0x2767c6(0xdb)]=_0x4fb055;}),_0x4b0d01[_0x439659(0x133)]((_0x5d2a29,_0x51f782)=>{var _0x4f7034=_0x439659;_0x182317[_0x51f782][_0x4f7034(0xb7)]=_0x5d2a29;}),_0x4d44c5[_0x439659(0x133)]((_0xd95aeb,_0x1be573)=>{var _0x238032=_0x439659;_0x182317[_0x1be573][_0x238032(0xa3)]=_0xd95aeb;}),_0x5a688d[_0x439659(0x133)]((_0x5859c5,_0x5f0e8e)=>{var _0x65a6a2=_0x439659;_0x182317[_0x5f0e8e][_0x65a6a2(0xe4)]=_0x5859c5;}),_0x3bc947[_0x439659(0x133)]((_0x3f7a2b,_0x560abb)=>{var _0x5d0e56=_0x439659;_0x182317[_0x560abb][_0x5d0e56(0x171)]=_0x3f7a2b;}),_0x5f0187['forEach']((_0x37146f,_0x20c226)=>{var _0x187685=_0x439659;_0x182317[_0x20c226][_0x187685(0x13f)]=_0x37146f;}),_0x3c6c8e[_0x439659(0x133)]((_0x48e69f,_0x5b49ad)=>{var _0x3f954c=_0x439659;_0x182317[_0x5b49ad][_0x3f954c(0xc1)]=_0x48e69f;}),_0x1d8e70[_0x439659(0x133)]((_0x4ccb7a,_0x6ce4b0)=>{var _0x3e64ac=_0x439659;_0x182317[_0x6ce4b0][_0x3e64ac(0x8f)]=_0x4ccb7a;}),_0x2e7596[_0x439659(0x133)]((_0x3fd111,_0x105efe)=>{_0x182317[_0x105efe]['maxperunit']=_0x3fd111;}),_0x49e977[_0x439659(0x133)]((_0xdb5282,_0x11a8f2)=>{var _0x3ca231=_0x439659;_0x182317[_0x11a8f2][_0x3ca231(0xfe)]=_0xdb5282;}),_0xb05d4e['forEach']((_0x1f24da,_0x4fe00b)=>{var _0x2e1307=_0x439659;_0x182317[_0x4fe00b][_0x2e1307(0xb3)]=_0x1f24da;}),_0x4c026e[_0x439659(0x133)]((_0x25fb8a,_0x6756b7)=>{_0x182317[_0x6756b7]['invoice']=_0x25fb8a;});const _0x310ebc=_0x182317[_0x439659(0x16c)](_0x53675d=>_0x53675d[_0x439659(0xfb)]!=='0'&&_0x53675d[_0x439659(0xfb)]!==''),_0x5a0622=new purchases_finished({'invoice':_0x55bfd9,'suppliers':_0x21f572[_0x439659(0x99)]['suppliers'],'date':_0x47adc2,'warehouse_name':_0x4706de,'product':_0x310ebc,'note':_0x74c8d9,'due_amount':_0x3f25c8,'room':_0x53ddac,'POnumber':_0xcea4a0,'SCRN':_0x2549d0,'JO_number':_0x307de7}),_0x2ae939=await _0x5a0622[_0x439659(0x10e)](),_0x5a2a55=await purchases_finished['findOne']({'invoice':_0x55bfd9}),_0xf32fe=_0x5a2a55[_0x439659(0xe3)]['map'](async _0x1d2a49=>{var _0x5f0ac4=_0x439659,_0x4f8d3d=await warehouse[_0x5f0ac4(0xa9)]({'name':_0x4706de,'room':_0x1d2a49[_0x5f0ac4(0xb3)]}),_0xe63f3d=0x0;const _0x540543=_0x4f8d3d['product_details'][_0x5f0ac4(0x104)](_0x4ff329=>{var _0x8e8bc8=_0x5f0ac4;console[_0x8e8bc8(0x154)](_0x4ff329[_0x8e8bc8(0x139)]+'=='+_0x1d2a49[_0x8e8bc8(0x139)]+'&&'+_0x4ff329[_0x8e8bc8(0xb7)]+'=='+_0x1d2a49[_0x8e8bc8(0xb7)]+'&&'+_0x4ff329[_0x8e8bc8(0xc1)]+'=='+_0x1d2a49[_0x8e8bc8(0xc1)]+'&&'+_0x4ff329['production_date']+'=='+_0x1d2a49['production_date']+'&&'+_0x4ff329[_0x8e8bc8(0x13f)]+'=='+_0x1d2a49['batch_code']+'&&'+_0x4ff329[_0x8e8bc8(0x11d)]+'=='+_0x5a2a55[_0x8e8bc8(0x11d)]),_0x4ff329[_0x8e8bc8(0x139)]==_0x1d2a49['product_name']&&_0x4ff329[_0x8e8bc8(0xb7)]==_0x1d2a49[_0x8e8bc8(0xb7)]&&_0x4ff329[_0x8e8bc8(0xc1)]==_0x1d2a49[_0x8e8bc8(0xc1)]&&_0x4ff329['production_date']==_0x1d2a49[_0x8e8bc8(0x8f)]&&_0x4ff329[_0x8e8bc8(0x13f)]==_0x1d2a49['batch_code']&&_0x4ff329[_0x8e8bc8(0x11d)]==_0x5a2a55[_0x8e8bc8(0x11d)]&&(_0x4ff329[_0x8e8bc8(0xdd)]=_0x4ff329['product_stock']+_0x1d2a49['quantity'],_0xe63f3d++);});return _0xe63f3d=='0'&&(_0x4f8d3d[_0x5f0ac4(0xc5)]=_0x4f8d3d[_0x5f0ac4(0xc5)]['concat']({'product_name':_0x1d2a49[_0x5f0ac4(0x139)],'product_stock':_0x1d2a49[_0x5f0ac4(0xfb)],'primary_code':_0x1d2a49[_0x5f0ac4(0xa3)],'secondary_code':_0x1d2a49[_0x5f0ac4(0xe4)],'product_code':_0x1d2a49[_0x5f0ac4(0x166)],'bay':_0x1d2a49[_0x5f0ac4(0xb7)],'maxProducts':_0x1d2a49[_0x5f0ac4(0x171)],'unit':_0x1d2a49[_0x5f0ac4(0xcb)],'secondary_unit':_0x1d2a49['secondary_unit'],'expiry_date':_0x1d2a49['expiry_date'],'production_date':_0x1d2a49[_0x5f0ac4(0x8f)],'maxProducts':_0x1d2a49[_0x5f0ac4(0x171)],'maxPerUnit':_0x1d2a49[_0x5f0ac4(0xa8)],'batch_code':_0x1d2a49['batch_code'],'product_cat':_0x1d2a49[_0x5f0ac4(0xfe)],'invoice':_0x1d2a49['invoice']})),_0x4f8d3d;});Promise['all'](_0xf32fe)[_0x439659(0x175)](async _0x19354c=>{var _0x254c9d=_0x439659;try{for(const _0x26ae9e of _0x19354c){await warehouse[_0x254c9d(0x121)]({'_id':_0x26ae9e['_id']},{'$addToSet':{'product_details':{'$each':_0x26ae9e[_0x254c9d(0xc5)]}}});}const _0x39d251=await master_shop[_0x254c9d(0x101)](),_0x2bff6b=await email_settings[_0x254c9d(0xa9)](),_0x331971=await supervisor_settings[_0x254c9d(0x101)]();var _0x376752=_0x5a2a55[_0x254c9d(0xe3)],_0x1dfae8='',_0x57efbe;for(_0x57efbe in _0x376752){var _0x4ecfc8='FG';_0x5a2a55['warehouse_name']==_0x254c9d(0x13a)&&(_0x4ecfc8='DG'),_0x1dfae8+='<tr>'+_0x254c9d(0x105)+_0x376752[_0x57efbe][_0x254c9d(0x139)]+_0x254c9d(0xf4)+_0x254c9d(0x105)+_0x376752[_0x57efbe]['product_code']+'</td>'+_0x254c9d(0x105)+_0x376752[_0x57efbe]['quantity']+'</td>'+_0x254c9d(0x105)+_0x376752[_0x57efbe][_0x254c9d(0xcb)]+_0x254c9d(0xf4)+_0x254c9d(0x105)+_0x376752[_0x57efbe]['secondary_unit']+_0x254c9d(0xf4)+_0x254c9d(0x105)+_0x5a2a55[_0x254c9d(0xa4)]+_0x254c9d(0xf4)+_0x254c9d(0x105)+_0x376752[_0x57efbe][_0x254c9d(0xb3)]+_0x254c9d(0xf4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4ecfc8+_0x376752[_0x57efbe][_0x254c9d(0xb7)]+_0x254c9d(0xf4),_0x254c9d(0x159);}let _0x451619=nodemailer[_0x254c9d(0x111)]({'host':_0x2bff6b['host'],'port':Number(_0x2bff6b[_0x254c9d(0xa0)]),'secure':![],'auth':{'user':_0x2bff6b[_0x254c9d(0x88)],'pass':_0x2bff6b[_0x254c9d(0xf2)]}}),_0x4d8377={'from':_0x2bff6b[_0x254c9d(0x88)],'to':_0x331971[0x0][_0x254c9d(0x8b)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x254c9d(0xb8),'path':__dirname+_0x254c9d(0x98)+_0x254c9d(0xd0)+_0x39d251[0x0]['image'],'cid':_0x254c9d(0xc0)}],'html':_0x254c9d(0x14a)+_0x254c9d(0x11a)+_0x254c9d(0xf9)+_0x254c9d(0x161)+_0x254c9d(0x124)+_0x254c9d(0x161)+_0x254c9d(0xa1)+_0x254c9d(0x15d)+_0x254c9d(0x161)+'<h2>\x20'+_0x39d251[0x0]['site_title']+'\x20</h2>'+_0x254c9d(0x15d)+_0x254c9d(0x15d)+'<hr\x20class=\x22my-3\x22>'+_0x254c9d(0x161)+_0x254c9d(0xe9)+'\x20Order\x20Number\x20:\x20'+_0x5a2a55[_0x254c9d(0x11d)]+'\x20'+_0x254c9d(0xdf)+_0x254c9d(0xb5)+_0x5a2a55[_0x254c9d(0x142)]+'\x20'+_0x254c9d(0x164)+'</h5>'+'</div>'+_0x254c9d(0x150)+_0x254c9d(0x149)+_0x254c9d(0x103)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x254c9d(0x115)+_0x254c9d(0x118)+_0x254c9d(0x12c)+_0x254c9d(0x113)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x254c9d(0xed)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x254c9d(0x159)+_0x254c9d(0x9e)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1dfae8+'\x20'+_0x254c9d(0xa5)+'</table>'+_0x254c9d(0x161)+'<strong>\x20Regards\x20</strong>'+_0x254c9d(0xd2)+_0x39d251[0x0][_0x254c9d(0x165)]+_0x254c9d(0xb2)+'</div>'+'</div>'+_0x254c9d(0x10d)};_0x451619[_0x254c9d(0x158)](_0x4d8377,function(_0x43a13c,_0x6d0a3c){var _0x14cfcf=_0x254c9d;_0x43a13c?(console[_0x14cfcf(0x154)](_0x43a13c),console['log'](_0x14cfcf(0x138))):console[_0x14cfcf(0x154)](_0x14cfcf(0x151));});}catch(_0xca279e){console['error'](_0xca279e),_0x3cd234[_0x254c9d(0xfa)](0x1f4)[_0x254c9d(0x16b)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0xca279e[_0x254c9d(0x148)]});}})[_0x439659(0xd4)](_0x3c6809=>{var _0x2c6234=_0x439659;console[_0x2c6234(0x167)](_0x3c6809),_0x3cd234['status'](0x1f4)['json']({'error':'An\x20error\x20occurred.'});}),_0x21f572[_0x439659(0x12e)]('success',_0x439659(0xec)),_0x3cd234['redirect'](_0x439659(0x126));}catch(_0x3f9930){console[_0x439659(0x154)](_0x3f9930);}}),router['get'](a0_0x5e0557(0x145),auth,async(_0x3725a0,_0x14b058)=>{var _0x5e1753=a0_0x5e0557;try{const {username:_0x469c04,email:_0x211373,role:_0x114f4d}=_0x3725a0[_0x5e1753(0x168)],_0x42fa4f=_0x3725a0[_0x5e1753(0x168)],_0xab152e=await profile[_0x5e1753(0xa9)]({'email':_0x42fa4f[_0x5e1753(0x88)]}),_0xf66f21=await master_shop[_0x5e1753(0x101)](),_0x4109bb=_0x3725a0[_0x5e1753(0x106)]['id'],_0x527975=await purchases_finished['findById'](_0x4109bb),_0x57ccc1=await suppliers[_0x5e1753(0x101)]({});let _0x13b9b2;if(_0x42fa4f[_0x5e1753(0x97)]==_0x5e1753(0xd3)){const _0x270b16=await staff[_0x5e1753(0xa9)]({'email':_0x42fa4f[_0x5e1753(0x88)]});_0x13b9b2=await warehouse[_0x5e1753(0x101)]({'status':_0x5e1753(0xe8),'name':_0x270b16['warehouse'],'warehouse_category':_0x5e1753(0x8e)});}else _0x13b9b2=await warehouse[_0x5e1753(0x9d)]([{'$match':{'status':_0x5e1753(0xe8),'warehouse_category':_0x5e1753(0x8e)}},{'$group':{'_id':_0x5e1753(0xbc),'name':{'$first':_0x5e1753(0xbc)}}}]);const _0x47c649=await product[_0x5e1753(0x101)]({}),_0x396ac9=BayBinSelected(_0x527975[_0x5e1753(0xa4)],_0x527975[_0x5e1753(0xf1)]);let _0x56fa89=new Date(_0x527975['expiry_date']),_0x422a17=('0'+_0x56fa89[_0x5e1753(0xcf)]())['slice'](-0x2),_0x521cdf=('0'+(_0x56fa89[_0x5e1753(0x13c)]()+0x1))[_0x5e1753(0x14f)](-0x2),_0x4a8d41=_0x56fa89[_0x5e1753(0x130)](),_0xfd588c=_0x4a8d41+'-'+_0x521cdf+'-'+_0x422a17;if(_0xf66f21[0x0]['language']==_0x5e1753(0x10b)){var _0x69b256=users[_0x5e1753(0xae)];console[_0x5e1753(0x154)](_0x69b256);}else{if(_0xf66f21[0x0]['language']=='Hindi')var _0x69b256=users['Hindi'];else{if(_0xf66f21[0x0][_0x5e1753(0xbd)]==_0x5e1753(0x15b))var _0x69b256=users['German'];else{if(_0xf66f21[0x0][_0x5e1753(0xbd)]=='Spanish')var _0x69b256=users['Spanish'];else{if(_0xf66f21[0x0]['language']==_0x5e1753(0xc6))var _0x69b256=users[_0x5e1753(0xc6)];else{if(_0xf66f21[0x0][_0x5e1753(0xbd)]==_0x5e1753(0xb9))var _0x69b256=users[_0x5e1753(0xc9)];else{if(_0xf66f21[0x0][_0x5e1753(0xbd)]==_0x5e1753(0xf6))var _0x69b256=users[_0x5e1753(0xf6)];else{if(_0xf66f21[0x0][_0x5e1753(0xbd)]==_0x5e1753(0x8a))var _0x69b256=users[_0x5e1753(0x108)];}}}}}}}_0x14b058['render'](_0x5e1753(0x90),{'success':_0x3725a0['flash'](_0x5e1753(0x107)),'errors':_0x3725a0[_0x5e1753(0x12e)](_0x5e1753(0x169)),'role':_0x42fa4f,'profile':_0xab152e,'purchases':_0x527975,'suppliers':_0x57ccc1,'warehouse':_0x13b9b2,'product':_0x47c649,'master_shop':_0xf66f21,'language':_0x69b256,'ed_fullDate':_0xfd588c,'dataSelected':_0x396ac9});}catch(_0x3a07ad){console[_0x5e1753(0x154)](_0x3a07ad);}}),router[a0_0x5e0557(0x86)](a0_0x5e0557(0x136),auth,async(_0x55410c,_0xfc1d59)=>{var _0x2fe68d=a0_0x5e0557;try{const {username:_0x5d51fa,email:_0x213a3e,role:_0x17035b}=_0x55410c[_0x2fe68d(0x168)],_0x57f900=_0x55410c[_0x2fe68d(0x168)],_0x2f06bf=await profile['findOne']({'email':_0x57f900[_0x2fe68d(0x88)]}),_0x4ba4f3=await master_shop[_0x2fe68d(0x101)](),_0x368aec=_0x55410c[_0x2fe68d(0x106)]['id'],_0xf335f2=await purchases_finished['findById'](_0x368aec),_0x4d618c=await suppliers[_0x2fe68d(0x101)]({});let _0x435399;if(_0x57f900[_0x2fe68d(0x97)]=='staff'){const _0x361649=await staff[_0x2fe68d(0xa9)]({'email':_0x57f900[_0x2fe68d(0x88)]});_0x435399=await warehouse[_0x2fe68d(0x101)]({'status':_0x2fe68d(0xe8),'name':_0x361649[_0x2fe68d(0x125)],'warehouse_category':'Finished\x20Goods'});}else _0x435399=await warehouse[_0x2fe68d(0x9d)]([{'$match':{'status':'Enabled','warehouse_category':_0x2fe68d(0x8e)}},{'$group':{'_id':_0x2fe68d(0xbc),'name':{'$first':_0x2fe68d(0xbc)}}}]);const _0x7e2160=await product[_0x2fe68d(0x101)]({}),_0x288bb2=BayBinSelected(_0xf335f2[_0x2fe68d(0xa4)],_0xf335f2['room']);let _0x37fd43=new Date(_0xf335f2[_0x2fe68d(0xc1)]),_0x40f56f=('0'+_0x37fd43[_0x2fe68d(0xcf)]())[_0x2fe68d(0x14f)](-0x2),_0x294ed2=('0'+(_0x37fd43[_0x2fe68d(0x13c)]()+0x1))[_0x2fe68d(0x14f)](-0x2),_0x153132=_0x37fd43[_0x2fe68d(0x130)](),_0x298a00=_0x153132+'-'+_0x294ed2+'-'+_0x40f56f;if(_0x4ba4f3[0x0][_0x2fe68d(0xbd)]==_0x2fe68d(0x10b)){var _0x3dc4d6=users[_0x2fe68d(0xae)];console[_0x2fe68d(0x154)](_0x3dc4d6);}else{if(_0x4ba4f3[0x0]['language']=='Hindi')var _0x3dc4d6=users[_0x2fe68d(0xf7)];else{if(_0x4ba4f3[0x0][_0x2fe68d(0xbd)]==_0x2fe68d(0x15b))var _0x3dc4d6=users[_0x2fe68d(0x15b)];else{if(_0x4ba4f3[0x0]['language']==_0x2fe68d(0x95))var _0x3dc4d6=users[_0x2fe68d(0x95)];else{if(_0x4ba4f3[0x0][_0x2fe68d(0xbd)]==_0x2fe68d(0xc6))var _0x3dc4d6=users[_0x2fe68d(0xc6)];else{if(_0x4ba4f3[0x0]['language']==_0x2fe68d(0xb9))var _0x3dc4d6=users[_0x2fe68d(0xc9)];else{if(_0x4ba4f3[0x0][_0x2fe68d(0xbd)]==_0x2fe68d(0xf6))var _0x3dc4d6=users[_0x2fe68d(0xf6)];else{if(_0x4ba4f3[0x0][_0x2fe68d(0xbd)]==_0x2fe68d(0x8a))var _0x3dc4d6=users['Arabic'];}}}}}}}_0xfc1d59[_0x2fe68d(0xc2)](_0x2fe68d(0x109),{'success':_0x55410c[_0x2fe68d(0x12e)](_0x2fe68d(0x107)),'errors':_0x55410c[_0x2fe68d(0x12e)](_0x2fe68d(0x169)),'role':_0x57f900,'profile':_0x2f06bf,'purchases':_0xf335f2,'suppliers':_0x4d618c,'warehouse':_0x435399,'product':_0x7e2160,'master_shop':_0x4ba4f3,'language':_0x3dc4d6,'ed_fullDate':_0x298a00,'dataSelected':_0x288bb2});}catch(_0x3e9784){console[_0x2fe68d(0x154)](_0x3e9784);}}),router['post']('/view/:id',auth,async(_0x2d3791,_0x8e622d)=>{var _0x163a85=a0_0x5e0557;try{const _0x30fae1=_0x2d3791['params']['id'],_0x308414=await purchases_finished[_0x163a85(0xa9)]({'_id':_0x2d3791['params']['id']}),_0x40aecd=await warehouse['findOne']({'name':_0x308414['warehouse_name'],'room':_0x308414[_0x163a85(0xf1)]});_0x308414[_0x163a85(0xe3)][_0x163a85(0x133)](_0x1ea393=>{var _0x429fd3=_0x163a85;const _0x117a73=_0x40aecd[_0x429fd3(0xc5)]['map'](_0x19df1c=>{var _0x36f333=_0x429fd3;_0x19df1c[_0x36f333(0x139)]==_0x1ea393[_0x36f333(0x139)]&&_0x19df1c[_0x36f333(0xb7)]==_0x1ea393[_0x36f333(0xb7)]&&(_0x19df1c['product_stock']=parseInt(_0x19df1c[_0x36f333(0xdd)])-parseInt(_0x1ea393[_0x36f333(0xfb)]));});}),await _0x40aecd[_0x163a85(0x10e)]();const {invoice:_0x362ba6,suppliers:_0x3a93fc,date:_0x8f2740,warehouse_name:_0x4af9f1,prod_name:_0x2acb8f,prod_code:_0x275722,prod_qty:_0x28b3b2,prod_unit:_0x1099c6,prod_secondunit:_0x10bd5f,prod_level:_0x5b06a7,prod_isle:_0x373462,prod_pallet:_0x5b4014,note:_0x4c3ce8,expiry_date:_0x45d369,batch_code:_0x41c871,paid_amount:_0x403052,due_amount:_0x3439f2,Room_name:_0x4508c6,primary_code:_0x4ea073,secondary_code:_0x2b2751,PO_number:_0x27bb5e,JO_number:_0x3c18cc}=_0x2d3791['body'];if(typeof _0x2acb8f==_0x163a85(0x173))var _0x4bca4a=[_0x2d3791[_0x163a85(0x99)][_0x163a85(0xda)]],_0x45e239=[_0x2d3791[_0x163a85(0x99)][_0x163a85(0x15c)]],_0x4bdb8a=[_0x2d3791['body'][_0x163a85(0xaa)]],_0x36b974=[_0x2d3791['body'][_0x163a85(0x11f)]],_0x107670=[_0x2d3791[_0x163a85(0x99)]['prod_secondunit']],_0x1d18c3=[_0x2d3791[_0x163a85(0x99)][_0x163a85(0x102)]],_0xc1cb1c=[_0x2d3791[_0x163a85(0x99)][_0x163a85(0xa3)]],_0x265ff8=[_0x2d3791[_0x163a85(0x99)][_0x163a85(0xe4)]],_0x5ecb6c=[_0x2d3791[_0x163a85(0x99)][_0x163a85(0x163)]],_0x3aec43=[_0x2d3791['body'][_0x163a85(0x13f)]],_0x2c5122=[_0x2d3791[_0x163a85(0x99)][_0x163a85(0xc1)]];else var _0x4bca4a=[..._0x2d3791['body'][_0x163a85(0xda)]],_0x45e239=[..._0x2d3791[_0x163a85(0x99)][_0x163a85(0x15c)]],_0x4bdb8a=[..._0x2d3791[_0x163a85(0x99)][_0x163a85(0xaa)]],_0x36b974=[..._0x2d3791[_0x163a85(0x99)]['prod_unit']],_0x107670=[..._0x2d3791[_0x163a85(0x99)]['prod_secondunit']],_0x1d18c3=[..._0x2d3791[_0x163a85(0x99)][_0x163a85(0x102)]],_0xc1cb1c=[..._0x2d3791[_0x163a85(0x99)][_0x163a85(0xa3)]],_0x265ff8=[..._0x2d3791['body'][_0x163a85(0xe4)]],_0x5ecb6c=[..._0x2d3791[_0x163a85(0x99)][_0x163a85(0x163)]],_0x3aec43=[..._0x2d3791[_0x163a85(0x99)][_0x163a85(0x13f)]],_0x2c5122=[..._0x2d3791[_0x163a85(0x99)]['expiry_date']];const _0x2b1613=_0x4bca4a[_0x163a85(0x104)](_0x395cf4=>{return _0x395cf4={'product_name':_0x395cf4};});_0x45e239[_0x163a85(0x133)]((_0x273798,_0x1b2e38)=>{_0x2b1613[_0x1b2e38]['product_code']=_0x273798;}),_0x4bdb8a[_0x163a85(0x133)]((_0x190f0b,_0x1c25fb)=>{var _0x38d2f9=_0x163a85;_0x2b1613[_0x1c25fb][_0x38d2f9(0xfb)]=_0x190f0b;}),_0x36b974[_0x163a85(0x133)]((_0xb2078,_0x296245)=>{var _0x4b3854=_0x163a85;_0x2b1613[_0x296245][_0x4b3854(0xcb)]=_0xb2078;}),_0x107670[_0x163a85(0x133)]((_0x45bbf2,_0x172120)=>{var _0x5ad78f=_0x163a85;_0x2b1613[_0x172120][_0x5ad78f(0xdb)]=_0x45bbf2;}),_0x1d18c3['forEach']((_0x255249,_0x5812da)=>{var _0x42073e=_0x163a85;_0x2b1613[_0x5812da][_0x42073e(0xb7)]=_0x255249;}),_0xc1cb1c[_0x163a85(0x133)]((_0x22b102,_0x3b56f7)=>{var _0x3b5d99=_0x163a85;_0x2b1613[_0x3b56f7][_0x3b5d99(0xa3)]=_0x22b102;}),_0x265ff8[_0x163a85(0x133)]((_0x33b3e9,_0x33bb2e)=>{var _0x50878a=_0x163a85;_0x2b1613[_0x33bb2e][_0x50878a(0xe4)]=_0x33b3e9;}),_0x5ecb6c[_0x163a85(0x133)]((_0x1db0d8,_0xec244b)=>{var _0x38e21e=_0x163a85;_0x2b1613[_0xec244b][_0x38e21e(0x171)]=_0x1db0d8;}),_0x3aec43[_0x163a85(0x133)]((_0x8040ff,_0x3f1e99)=>{var _0x103e5d=_0x163a85;_0x2b1613[_0x3f1e99][_0x103e5d(0x13f)]=_0x8040ff;}),_0x2c5122[_0x163a85(0x133)]((_0x346cc1,_0x108b3e)=>{var _0x56d355=_0x163a85;_0x2b1613[_0x108b3e][_0x56d355(0xc1)]=_0x346cc1;});const _0x8cf794=_0x2b1613[_0x163a85(0x16c)](_0x304127=>_0x304127[_0x163a85(0xfb)]!=='0'&&_0x304127[_0x163a85(0xfb)]!=='');_0x308414['invoice']=_0x362ba6,_0x308414[_0x163a85(0xb0)]=_0x3a93fc,_0x308414[_0x163a85(0x142)]=_0x8f2740,_0x308414[_0x163a85(0xa4)]=_0x4af9f1,_0x308414[_0x163a85(0xe3)]=_0x8cf794,_0x308414[_0x163a85(0xe2)]=_0x4c3ce8,_0x308414[_0x163a85(0x114)]=_0x403052,_0x308414[_0x163a85(0xdc)]=_0x3439f2,_0x308414['room']=_0x4508c6,_0x308414[_0x163a85(0x13d)]=_0x27bb5e,_0x308414['JO_number']=_0x3c18cc;const _0x39d438=await _0x308414[_0x163a85(0x10e)](),_0x4f4234=await warehouse[_0x163a85(0xa9)]({'name':_0x2d3791['body'][_0x163a85(0xa4)],'room':_0x2d3791[_0x163a85(0x99)]['Room_name']});_0x308414[_0x163a85(0xe3)]['forEach'](_0x36f336=>{var _0xc6bfd2=_0x163a85,_0x1c20fc=0x0;const _0x436349=_0x4f4234[_0xc6bfd2(0xc5)][_0xc6bfd2(0x104)](_0x23bcca=>{var _0x284692=_0xc6bfd2;_0x23bcca[_0x284692(0x139)]==_0x36f336['product_name']&&_0x23bcca['bay']==_0x36f336[_0x284692(0xb7)]&&(_0x23bcca[_0x284692(0xdd)]=parseInt(_0x23bcca[_0x284692(0xdd)])+parseInt(_0x36f336[_0x284692(0xfb)]),_0x1c20fc++);});_0x1c20fc=='0'&&(_0x4f4234[_0xc6bfd2(0xc5)]=_0x4f4234[_0xc6bfd2(0xc5)][_0xc6bfd2(0xaf)]({'product_name':_0x36f336[_0xc6bfd2(0x139)],'product_stock':_0x36f336[_0xc6bfd2(0xfb)],'primary_code':_0x36f336[_0xc6bfd2(0xa3)],'secondary_code':_0x36f336[_0xc6bfd2(0xe4)],'product_code':_0x36f336[_0xc6bfd2(0x166)],'bay':_0x36f336[_0xc6bfd2(0xb7)],'maxProducts':_0x36f336[_0xc6bfd2(0x171)],'unit':_0x36f336[_0xc6bfd2(0xcb)],'secondary_unit':_0x36f336[_0xc6bfd2(0xdb)],'expiry_date':_0x36f336['expiry_date']}));}),await _0x4f4234['save']();const _0x1b1bee=await s_payment_data[_0x163a85(0xa9)]({'invoice':_0x2d3791[_0x163a85(0x99)][_0x163a85(0x11d)]});if(_0x1b1bee===null){}else console['log'](_0x163a85(0xb0),_0x1b1bee,_0x2d3791[_0x163a85(0x99)]['invoice']),_0x1b1bee[_0x163a85(0xb0)]=_0x2d3791['body'][_0x163a85(0xb0)],await _0x1b1bee['save']();_0x2d3791['flash']('success','purchase\x20data\x20update\x20successfully'),_0x8e622d[_0x163a85(0xef)](_0x163a85(0x126));}catch(_0x3811df){console['log'](_0x3811df);}}),router[a0_0x5e0557(0xe1)](a0_0x5e0557(0xea),auth,async(_0x1d9a90,_0x560d27)=>{var _0x2dda69=a0_0x5e0557;try{const _0x3e5b65=_0x1d9a90[_0x2dda69(0x106)]['id'],{invoice:_0x7a2846,suppliers:_0x13eb7c,payable:_0x2efd5d,due_amount:_0x2ca996}=_0x1d9a90[_0x2dda69(0x99)],_0x309f27=await purchases[_0x2dda69(0x8c)](_0x3e5b65);var _0x4a17eb=_0x2efd5d-_0x2ca996;_0x309f27[_0x2dda69(0x114)]=parseFloat(_0x309f27[_0x2dda69(0x114)])+parseFloat(_0x2ca996),_0x309f27[_0x2dda69(0xdc)]=_0x4a17eb;const _0x440a86=await _0x309f27[_0x2dda69(0x10e)]();console[_0x2dda69(0x154)](_0x440a86);const _0x1c7b9a=await s_payment_data[_0x2dda69(0xa9)]({'invoice':_0x7a2846});_0x1c7b9a['amount']=_0x4a17eb,await _0x1c7b9a[_0x2dda69(0x10e)]();let _0x4640b5=new Date(),_0x3a601f=('0'+_0x4640b5[_0x2dda69(0xcf)]())['slice'](-0x2),_0x22b1ba=('0'+(_0x4640b5[_0x2dda69(0x13c)]()+0x1))[_0x2dda69(0x14f)](-0x2),_0x4e1459=_0x4640b5[_0x2dda69(0x130)](),_0x3d64f6=_0x4e1459+'-'+_0x22b1ba+'-'+_0x3a601f;const _0x31801a=new suppliers_payment({'invoice':_0x7a2846,'date':_0x4e1459+'-'+_0x22b1ba+'-'+_0x3a601f,'suppliers':_0x13eb7c,'reason':'Paid\x20For\x20Purchase','amount':_0x2ca996}),_0x5f60dd=await _0x31801a[_0x2dda69(0x10e)]();_0x1d9a90[_0x2dda69(0x12e)](_0x2dda69(0x107),_0x2dda69(0xac)),_0x560d27[_0x2dda69(0xef)](_0x2dda69(0x16e));}catch(_0xc5b7d6){console['log'](_0xc5b7d6);}}),router[a0_0x5e0557(0x86)](a0_0x5e0557(0xfc),auth,async(_0x141807,_0x39fc7d)=>{var _0x35eded=a0_0x5e0557;try{const {username:_0x24b920,email:_0x4735fa,role:_0x510f34}=_0x141807[_0x35eded(0x168)],_0x1a727b=_0x141807[_0x35eded(0x168)],_0x109536=await profile[_0x35eded(0xa9)]({'email':_0x1a727b['email']}),_0x489f5a=await master_shop[_0x35eded(0x101)]();console[_0x35eded(0x154)](_0x35eded(0xb4),_0x489f5a);const _0x296983=_0x141807[_0x35eded(0x106)]['id'],_0x1a2e97=await purchases['findById'](_0x296983);console[_0x35eded(0x154)](_0x1a2e97);const _0xcbad0d=await suppliers[_0x35eded(0xa9)]({'name':_0x1a2e97[_0x35eded(0xb0)]});console[_0x35eded(0x154)](_0xcbad0d);if(_0x489f5a[0x0][_0x35eded(0xbd)]==_0x35eded(0x10b)){var _0x49a5b4=users[_0x35eded(0xae)];console['log'](_0x49a5b4);}else{if(_0x489f5a[0x0][_0x35eded(0xbd)]==_0x35eded(0xf7))var _0x49a5b4=users[_0x35eded(0xf7)];else{if(_0x489f5a[0x0][_0x35eded(0xbd)]==_0x35eded(0x15b))var _0x49a5b4=users[_0x35eded(0x15b)];else{if(_0x489f5a[0x0][_0x35eded(0xbd)]==_0x35eded(0x95))var _0x49a5b4=users[_0x35eded(0x95)];else{if(_0x489f5a[0x0]['language']==_0x35eded(0xc6))var _0x49a5b4=users[_0x35eded(0xc6)];else{if(_0x489f5a[0x0]['language']==_0x35eded(0xb9))var _0x49a5b4=users['Portuguese'];else{if(_0x489f5a[0x0][_0x35eded(0xbd)]==_0x35eded(0xf6))var _0x49a5b4=users[_0x35eded(0xf6)];else{if(_0x489f5a[0x0]['language']==_0x35eded(0x8a))var _0x49a5b4=users[_0x35eded(0x108)];}}}}}}}_0x39fc7d[_0x35eded(0xc2)](_0x35eded(0xb6),{'success':_0x141807['flash'](_0x35eded(0x107)),'errors':_0x141807['flash'](_0x35eded(0x169)),'role':_0x1a727b,'profile':_0x109536,'master_shop':_0x489f5a,'supplier':_0xcbad0d,'purchase':_0x1a2e97,'language':_0x49a5b4});}catch(_0x9c2803){console[_0x35eded(0x154)](_0x9c2803);}}),router[a0_0x5e0557(0x86)]('/view/return_purchase/:id',auth,async(_0x1bd143,_0x5cde73)=>{var _0x26595e=a0_0x5e0557;try{const {username:_0x3604c8,email:_0x5ce6d6,role:_0x2c077f}=_0x1bd143['user'],_0x1e18ef=_0x1bd143[_0x26595e(0x168)],_0xa04b70=await profile[_0x26595e(0xa9)]({'email':_0x1e18ef[_0x26595e(0x88)]}),_0x871826=await master_shop[_0x26595e(0x101)]();console[_0x26595e(0x154)](_0x26595e(0xb4),_0x871826);const _0x12fe12=_0x1bd143['params']['id'];console[_0x26595e(0x154)](_0x12fe12);const _0x2d6d30=await purchases_finished[_0x26595e(0x8c)](_0x12fe12);console[_0x26595e(0x154)](_0x26595e(0x8d),_0x2d6d30);const _0xbd4ff8=await product[_0x26595e(0x101)]({}),_0x185d07=await warehouse['aggregate']([{'$match':{'name':_0x2d6d30['warehouse_name'],'room':_0x2d6d30[_0x26595e(0xf1)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x26595e(0x96),'name':{'$first':_0x26595e(0xce)},'product_stock':{'$first':_0x26595e(0xf3)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x26595e(0x120)},'type':{'$first':_0x26595e(0x11c)},'floorlevel':{'$first':_0x26595e(0xbe)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);console[_0x26595e(0x154)](_0x26595e(0xd1),_0x185d07);let _0x2d7dd7;if(_0x1e18ef['role']=='staff'){const _0x49a8f6=await staff[_0x26595e(0xa9)]({'email':_0x1e18ef[_0x26595e(0x88)]});_0x2d7dd7=await warehouse[_0x26595e(0x101)]({'status':'Enabled','name':_0x49a8f6[_0x26595e(0x125)],'warehouse_category':_0x26595e(0x8e),'name':_0x26595e(0x153)});}else _0x2d7dd7=await warehouse[_0x26595e(0x9d)]([{'$match':{'status':'Enabled','warehouse_category':_0x26595e(0x8e),'name':_0x26595e(0x153)}},{'$group':{'_id':'$name','name':{'$first':_0x26595e(0xbc)}}}]);if(_0x871826[0x0][_0x26595e(0xbd)]==_0x26595e(0x10b)){var _0x2e5146=users[_0x26595e(0xae)];console[_0x26595e(0x154)](_0x2e5146);}else{if(_0x871826[0x0][_0x26595e(0xbd)]=='Hindi')var _0x2e5146=users[_0x26595e(0xf7)];else{if(_0x871826[0x0][_0x26595e(0xbd)]==_0x26595e(0x15b))var _0x2e5146=users[_0x26595e(0x15b)];else{if(_0x871826[0x0]['language']==_0x26595e(0x95))var _0x2e5146=users[_0x26595e(0x95)];else{if(_0x871826[0x0]['language']==_0x26595e(0xc6))var _0x2e5146=users['French'];else{if(_0x871826[0x0][_0x26595e(0xbd)]=='Portuguese\x20(BR)')var _0x2e5146=users[_0x26595e(0xc9)];else{if(_0x871826[0x0]['language']==_0x26595e(0xf6))var _0x2e5146=users[_0x26595e(0xf6)];else{if(_0x871826[0x0]['language']==_0x26595e(0x8a))var _0x2e5146=users[_0x26595e(0x108)];}}}}}}}_0x5cde73['render'](_0x26595e(0x13e),{'success':_0x1bd143[_0x26595e(0x12e)](_0x26595e(0x107)),'errors':_0x1bd143[_0x26595e(0x12e)]('errors'),'role':_0x1e18ef,'profile':_0xa04b70,'user':_0x2d6d30,'stock':_0x185d07,'master_shop':_0x871826,'product':_0xbd4ff8,'language':_0x2e5146,'warehouse':_0x2d7dd7});}catch(_0x13edf8){console[_0x26595e(0x154)](_0x13edf8);}}),router['post'](a0_0x5e0557(0xca),auth,async(_0x1a5cf1,_0x206586)=>{var _0x1aff2a=a0_0x5e0557;try{const {invoice:_0xa5952b,date:_0x5bb6ee,warehouse_name:_0x492c43,Room_name:_0xc5d2a3,product_name:_0x48cd90,purchase_quantity:_0x12ea15,stocks:_0x450323,return_qty:_0x26a620,note:_0x1cea48,level:_0x3e7555,isle:_0x487824,pallet:_0x5b7c1c,to_warehouse_name:_0x144e9e,to_Room_name:_0x34ea24}=_0x1a5cf1[_0x1aff2a(0x99)],_0x7292e=await purchases_finished[_0x1aff2a(0xa9)]({'_id':_0x1a5cf1[_0x1aff2a(0x106)]['id']}),_0x5b02cc=await warehouse[_0x1aff2a(0xa9)]({'name':_0x492c43,'room':_0xc5d2a3,'warehouse_category':'Finished\x20Goods'});if(typeof _0x48cd90==_0x1aff2a(0x173))var _0x5ce063=[_0x1a5cf1[_0x1aff2a(0x99)]['product_name']],_0x5ab852=[_0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0xd5)]],_0x58dc6d=[_0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0x16a)]],_0x1072db=[_0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0xc4)]],_0x33d832=[_0x1a5cf1['body'][_0x1aff2a(0x131)]],_0x2edff0=[_0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0xde)]],_0x7d7ebe=[_0x1a5cf1['body'][_0x1aff2a(0x170)]],_0x54de2b=[_0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0xbf)]];else var _0x5ce063=[..._0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0x139)]],_0x5ab852=[..._0x1a5cf1[_0x1aff2a(0x99)]['purchase_quantity']],_0x58dc6d=[..._0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0x16a)]],_0x1072db=[..._0x1a5cf1['body'][_0x1aff2a(0xc4)]],_0x33d832=[..._0x1a5cf1[_0x1aff2a(0x99)]['level']],_0x2edff0=[..._0x1a5cf1[_0x1aff2a(0x99)]['product_code_hide']],_0x7d7ebe=[..._0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0x170)]],_0x54de2b=[..._0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0xbf)]];const _0x5c3f14=_0x5ce063[_0x1aff2a(0x104)](_0x2f8ce4=>{return _0x2f8ce4={'product_name':_0x2f8ce4};});_0x5ab852[_0x1aff2a(0x133)]((_0x72e162,_0x1ecb72)=>{var _0x1272ba=_0x1aff2a;_0x5c3f14[_0x1ecb72][_0x1272ba(0xd5)]=_0x72e162;}),_0x58dc6d['forEach']((_0x213f10,_0x23888e)=>{_0x5c3f14[_0x23888e]['stock_quantity']=_0x213f10;}),_0x1072db[_0x1aff2a(0x133)]((_0x23e396,_0x220934)=>{var _0xe78b64=_0x1aff2a;_0x5c3f14[_0x220934][_0xe78b64(0xc4)]=_0x23e396;}),_0x33d832[_0x1aff2a(0x133)]((_0x2ecc4b,_0x9abcd3)=>{var _0x1baa5f=_0x1aff2a;_0x5c3f14[_0x9abcd3][_0x1baa5f(0xb7)]=_0x2ecc4b;}),_0x2edff0[_0x1aff2a(0x133)]((_0x232d15,_0x33cce1)=>{var _0x5da450=_0x1aff2a;_0x5c3f14[_0x33cce1][_0x5da450(0x166)]=_0x232d15;}),_0x7d7ebe['forEach']((_0x3be078,_0xe3e213)=>{var _0x41f4ff=_0x1aff2a;_0x5c3f14[_0xe3e213][_0x41f4ff(0xa3)]=_0x3be078;}),_0x54de2b[_0x1aff2a(0x133)]((_0x16adc2,_0xcbb249)=>{var _0x4e4c00=_0x1aff2a;_0x5c3f14[_0xcbb249][_0x4e4c00(0xe4)]=_0x16adc2;}),_0x5c3f14['forEach'](_0x41540d=>{var _0x4b73ec=_0x1aff2a;console[_0x4b73ec(0x154)](_0x41540d);const _0x429078=_0x5b02cc['product_details']['map'](_0x26b09b=>{var _0x19417a=_0x4b73ec;_0x26b09b['product_name']==_0x41540d[_0x19417a(0x139)]&&_0x26b09b[_0x19417a(0xb7)]==_0x41540d[_0x19417a(0xb7)]&&(console[_0x19417a(0x154)](parseInt(_0x26b09b['product_stock'])+'\x20<>\x20'+parseInt(_0x41540d[_0x19417a(0xc4)])),_0x26b09b[_0x19417a(0xdd)]=parseInt(_0x26b09b['product_stock'])-parseInt(_0x41540d[_0x19417a(0xc4)]));});}),await _0x5b02cc[_0x1aff2a(0x10e)]();var _0x22c58a=0x0;_0x5c3f14['forEach'](_0x59b0e6=>{var _0x1c5470=_0x1aff2a;(parseInt(_0x59b0e6[_0x1c5470(0xd5)])<parseInt(_0x59b0e6[_0x1c5470(0xc4)])||parseInt(_0x59b0e6[_0x1c5470(0xe7)])<parseInt(_0x59b0e6[_0x1c5470(0xc4)]))&&_0x22c58a++;});if(_0x22c58a!=0x0)return _0x1a5cf1[_0x1aff2a(0x12e)](_0x1aff2a(0x169),_0x1aff2a(0x12f)),_0x206586['redirect']('back');const _0x595e03=new purchases_return_finished({'invoice':_0xa5952b,'suppliers':_0x1a5cf1[_0x1aff2a(0x99)]['suppliers'],'date':_0x5bb6ee,'warehouse_name':_0x492c43,'return_product':_0x5c3f14,'note':_0x1cea48,'room':_0xc5d2a3,'to_warehouse_name':_0x144e9e,'to_room':_0x34ea24}),_0x2ed18c=await _0x595e03[_0x1aff2a(0x10e)](),_0x3c6a91=await purchases_return_finished[_0x1aff2a(0xa9)]({'invoice':_0xa5952b}),_0x5ccd14=await warehouse[_0x1aff2a(0xa9)]({'name':_0x144e9e,'room':_0x34ea24,'warehouse_category':_0x1aff2a(0x8e)});_0x3c6a91[_0x1aff2a(0xe0)][_0x1aff2a(0x133)](_0x51e52d=>{var _0x21d17a=_0x1aff2a,_0x2a6cc5=0x0;const _0xc895b7=_0x5ccd14['product_details'][_0x21d17a(0x104)](_0x53ab8b=>{var _0x29ef2a=_0x21d17a;console[_0x29ef2a(0x154)](_0x53ab8b[_0x29ef2a(0x139)]+'=='+_0x51e52d[_0x29ef2a(0x139)]+'&&'+_0x53ab8b[_0x29ef2a(0xb7)]+'=='+_0x51e52d[_0x29ef2a(0xb7)]),_0x53ab8b[_0x29ef2a(0x139)]==_0x51e52d[_0x29ef2a(0x139)]&&_0x53ab8b[_0x29ef2a(0xb7)]==_0x51e52d[_0x29ef2a(0xb7)]&&(_0x53ab8b[_0x29ef2a(0xdd)]=parseInt(_0x53ab8b[_0x29ef2a(0xdd)])-parseInt(_0x51e52d['return_qty']),_0x2a6cc5++);});_0x2a6cc5=='0'&&(_0x5ccd14[_0x21d17a(0xc5)]=_0x5ccd14[_0x21d17a(0xc5)][_0x21d17a(0xaf)]({'product_name':_0x51e52d[_0x21d17a(0x139)],'product_stock':_0x51e52d[_0x21d17a(0xc4)],'primary_code':_0x51e52d[_0x21d17a(0xa3)],'secondary_code':_0x51e52d[_0x21d17a(0xe4)],'product_code':_0x51e52d[_0x21d17a(0x166)],'bay':_0x51e52d['bay'],'maxProducts':0xf423f}));}),await _0x5ccd14[_0x1aff2a(0x10e)]();const _0x58db9d=await purchases_finished[_0x1aff2a(0xa9)]({'invoice':_0xa5952b});_0x58db9d[_0x1aff2a(0x122)]='True';const _0x1925b1=await _0x58db9d[_0x1aff2a(0x10e)](),_0x3e5448=new s_payment_data({'invoice':_0xa5952b,'suppliers':_0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0xb0)],'reason':_0x1aff2a(0x89)});await _0x3e5448[_0x1aff2a(0x10e)]();const _0x521937=await master_shop[_0x1aff2a(0x101)](),_0x345e31=await email_settings[_0x1aff2a(0xa9)](),_0x58f568=await suppliers[_0x1aff2a(0xa9)]({'name':_0x1a5cf1[_0x1aff2a(0x99)][_0x1aff2a(0xb0)]});_0x521937[0x0][_0x1aff2a(0x137)]==0x1?(right_currency=_0x521937[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x521937[0x0][_0x1aff2a(0xa2)]);var _0x571739=_0x5ce063,_0x47f5f8=_0x1072db,_0x510764='',_0x55eb18;for(_0x55eb18 in _0x571739){_0x510764+=_0x1aff2a(0x103)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x571739[_0x55eb18]+_0x1aff2a(0xf4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x47f5f8[_0x55eb18]+_0x1aff2a(0xf4)+_0x1aff2a(0x159);}let _0x134652=nodemailer[_0x1aff2a(0x111)]({'service':_0x1aff2a(0x119),'auth':{'user':_0x345e31[_0x1aff2a(0x88)],'pass':_0x345e31[_0x1aff2a(0xf2)]}}),_0x4c6d61={'from':_0x345e31[_0x1aff2a(0x88)],'to':_0x58f568[_0x1aff2a(0x88)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x1aff2a(0xb8),'path':__dirname+_0x1aff2a(0x98)+_0x1aff2a(0xd0)+_0x521937[0x0][_0x1aff2a(0x157)],'cid':_0x1aff2a(0xc0)}],'html':_0x1aff2a(0x14a)+_0x1aff2a(0x11a)+'</head><body>'+_0x1aff2a(0x161)+_0x1aff2a(0x124)+_0x1aff2a(0x161)+_0x1aff2a(0xa1)+_0x1aff2a(0x15d)+'<div>'+_0x1aff2a(0x10c)+_0x521937[0x0]['site_title']+'\x20</h2>'+'</div>'+_0x1aff2a(0x15d)+'<hr\x20class=\x22my-3\x22>'+_0x1aff2a(0x161)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1aff2a(0x134)+_0xa5952b+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x5bb6ee+'\x20'+_0x1aff2a(0x164)+_0x1aff2a(0xb2)+_0x1aff2a(0x15d)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1aff2a(0x149)+_0x1aff2a(0x103)+_0x1aff2a(0x135)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x1aff2a(0x9e)+_0x1aff2a(0xd8)+'\x20'+_0x510764+'\x20'+'</tbody>'+_0x1aff2a(0x155)+_0x1aff2a(0x161)+_0x1aff2a(0x112)+_0x1aff2a(0xd2)+_0x521937[0x0]['site_title']+_0x1aff2a(0xb2)+_0x1aff2a(0x15d)+_0x1aff2a(0x15d)+'</body></html>'};_0x134652[_0x1aff2a(0x158)](_0x4c6d61,function(_0x1c8853,_0x19a176){var _0x16e0a8=_0x1aff2a;_0x1c8853?console[_0x16e0a8(0x154)](_0x16e0a8(0x138)):console[_0x16e0a8(0x154)](_0x16e0a8(0x151));}),_0x1a5cf1[_0x1aff2a(0x12e)](_0x1aff2a(0x107),'purchases\x20item\x20return\x20successfull'),_0x206586[_0x1aff2a(0xef)](_0x1aff2a(0x126));}catch(_0x2ac511){_0x206586[_0x1aff2a(0xfa)](0xc8)[_0x1aff2a(0x16b)]({'message':_0x2ac511['message']});}}),router[a0_0x5e0557(0x86)](a0_0x5e0557(0x176),auth,async(_0x370a39,_0x531a65)=>{var _0x3a04fa=a0_0x5e0557;try{const {username:_0x2c535a,email:_0x3dbac2,role:_0x4aaea6}=_0x370a39['user'],_0x386cd1=_0x370a39[_0x3a04fa(0x168)],_0x3be3f9=await profile['findOne']({'email':_0x386cd1['email']}),_0x245b10=await master_shop['find'](),_0x5b911c=_0x370a39['params']['id'],_0x47b34c=await purchases_finished['findById'](_0x5b911c);if(_0x245b10[0x0][_0x3a04fa(0xbd)]==_0x3a04fa(0x10b))var _0x163ade=users[_0x3a04fa(0xae)];else{if(_0x245b10[0x0][_0x3a04fa(0xbd)]=='Hindi')var _0x163ade=users[_0x3a04fa(0xf7)];else{if(_0x245b10[0x0][_0x3a04fa(0xbd)]==_0x3a04fa(0x15b))var _0x163ade=users[_0x3a04fa(0x15b)];else{if(_0x245b10[0x0][_0x3a04fa(0xbd)]==_0x3a04fa(0x95))var _0x163ade=users[_0x3a04fa(0x95)];else{if(_0x245b10[0x0][_0x3a04fa(0xbd)]==_0x3a04fa(0xc6))var _0x163ade=users[_0x3a04fa(0xc6)];else{if(_0x245b10[0x0]['language']==_0x3a04fa(0xb9))var _0x163ade=users[_0x3a04fa(0xc9)];else{if(_0x245b10[0x0][_0x3a04fa(0xbd)]==_0x3a04fa(0xf6))var _0x163ade=users['Chinese'];else{if(_0x245b10[0x0][_0x3a04fa(0xbd)]=='Arabic\x20(ae)')var _0x163ade=users[_0x3a04fa(0x108)];}}}}}}}_0x531a65[_0x3a04fa(0xc2)](_0x3a04fa(0x143),{'success':_0x370a39[_0x3a04fa(0x12e)]('success'),'errors':_0x370a39['flash'](_0x3a04fa(0x169)),'role':_0x386cd1,'profile':_0x3be3f9,'alldata':_0x47b34c,'master_shop':_0x245b10,'language':_0x163ade}),console[_0x3a04fa(0x154)](alldata);}catch(_0x510727){console[_0x3a04fa(0x154)](_0x510727);}}),router[a0_0x5e0557(0xe1)]('/barcode_scanner',async(_0x3b6592,_0xfb1145)=>{var _0x1da6af=a0_0x5e0557;const {product_code:_0x10077d}=_0x3b6592[_0x1da6af(0x99)];var _0x2d97e4;const _0x4139a3=await product[_0x1da6af(0x9d)]([{'$match':{'primary_code':_0x10077d,'product_category':_0x1da6af(0x8e)}},{'$group':{'_id':_0x1da6af(0x14e),'name':{'$first':_0x1da6af(0xbc)},'category':{'$first':_0x1da6af(0x152)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x1da6af(0x128)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x1da6af(0x162)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1da6af(0xb1)},'maxProdPerUnit':{'$first':_0x1da6af(0x160)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1da6af(0xfd)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x34cf11=await product[_0x1da6af(0x9d)]([{'$match':{'secondary_code':_0x10077d}},{'$group':{'_id':_0x1da6af(0x14e),'name':{'$first':_0x1da6af(0xbc)},'category':{'$first':_0x1da6af(0x152)},'brand':{'$first':'$brand'},'unit':{'$first':_0x1da6af(0xe6)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x1da6af(0x132)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1da6af(0xb1)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x4139a3[_0x1da6af(0xc3)]>0x0)_0x2d97e4=_0x4139a3;else _0x34cf11[_0x1da6af(0xc3)]>0x0&&(_0x2d97e4=_0x34cf11);_0xfb1145[_0x1da6af(0x16b)](_0x2d97e4);}),router[a0_0x5e0557(0xe1)](a0_0x5e0557(0x147),async(_0x4739fa,_0x18c0fb)=>{var _0x5e080e=a0_0x5e0557;const {productCode:_0x51f0a6,bay:_0x5c236e,warehouses:_0x105ca3,room:_0x201beb}=_0x4739fa[_0x5e080e(0x99)];console[_0x5e080e(0x154)](_0x4739fa[_0x5e080e(0x99)]);try{const _0x227476=await warehouse[_0x5e080e(0x9d)]([{'$match':{'name':_0x105ca3,'room':_0x201beb}},{'$unwind':_0x5e080e(0x12a)},{'$match':{'product_details.bay':parseInt(_0x5c236e)}},{'$group':{'_id':_0x5e080e(0x96),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5e080e(0xf3)},'bay':{'$first':_0x5e080e(0xee)},'maxProducts':{'$first':_0x5e080e(0x9c)}}}]);_0x18c0fb['status'](0xc8)[_0x5e080e(0x16b)](_0x227476);}catch(_0x36f22f){_0x18c0fb[_0x5e080e(0xfa)](0x194)[_0x5e080e(0x16b)]({'message':_0x36f22f['message']});}}),module[a0_0x5e0557(0x12d)]=router;