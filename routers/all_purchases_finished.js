var a0_0x3e3a3c=a0_0x20c4;(function(_0x39aebd,_0x199ecc){var _0x28d8a9=a0_0x20c4,_0x25a3cf=_0x39aebd();while(!![]){try{var _0x3e0c2c=parseInt(_0x28d8a9(0x127))/0x1*(-parseInt(_0x28d8a9(0x156))/0x2)+parseInt(_0x28d8a9(0x117))/0x3*(-parseInt(_0x28d8a9(0x150))/0x4)+-parseInt(_0x28d8a9(0xde))/0x5+parseInt(_0x28d8a9(0x146))/0x6*(parseInt(_0x28d8a9(0xd0))/0x7)+-parseInt(_0x28d8a9(0x177))/0x8*(-parseInt(_0x28d8a9(0x1b6))/0x9)+-parseInt(_0x28d8a9(0x193))/0xa*(parseInt(_0x28d8a9(0x125))/0xb)+parseInt(_0x28d8a9(0x19a))/0xc;if(_0x3e0c2c===_0x199ecc)break;else _0x25a3cf['push'](_0x25a3cf['shift']());}catch(_0x24ac73){_0x25a3cf['push'](_0x25a3cf['shift']());}}}(a0_0x3ae5,0x80675));const express=require('express'),app=express(),router=express[a0_0x3e3a3c(0x17a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x3e3a3c(0x167)),nodemailer=require(a0_0x3e3a3c(0x1a9));var ejs=require(a0_0x3e3a3c(0x19b));const path=require(a0_0x3e3a3c(0x15c)),users=require('../public/language/languages.json');function a0_0x3ae5(){var _0x368204=['Hindi','QA\x20Warehouse','<tbody\x20style=\x22text-align:\x20center;\x22>','True','1947024pnPOTW','<h5\x20style=\x22text-align:\x20left;\x22>','JO_number','Router','toString','$product_details.primary_code','production_date','RoomAssign','return_data','/../public','$product_details.product_stock','prod_Qty','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product_code','table\x20page','error','return_qty','findById','edit_purchases_finished','prod_qty','log','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','stock_quantity','$invoice','prod_secondunit','params','</div>','10EYszpP','user','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','max_product_unit','<div>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','25956648vGssjz','ejs','$product.bin','product_cat','$product_details.secondary_code','room','$maxProdPerUnit','invoice','getDate','\x20Order\x20Date\x20:\x20','paid_amount','FGSEmail','</head><body>','Error\x20Occurs','/CheckingWarehouse','nodemailer','createTransport','suppliers','$suppliers_docs','Arabic','prod_invoice','$_id','map','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product.type','currency','secondary_unit','bay','27KiPqLO','Chinese','Room_name','primary_code','/view','French','\x20<>\x20','\x20</h2>','product_name','errors','$date','render','getFullYear','quantity','$paid_amount','role','Purchase\x20Return\x20Mail','payment\x20successfull','master','$product_details.bay','MaxStocks_data','$secondary_unit','amount','product_code_hide','$name','gmail','</table>','4303957WLzXSA','$product_details._id','string','aggregate','$product_code','Enabled','$note','$unit','Purchase\x20Mail','Arabic\x20(ae)','maxStocks','standard_unit','room_name','Rack\x201','5099150bPkaZi','DRY\x20GOODS','secondary_code','<!DOCTYPE\x20html>','/all_purchases/view','English','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Enclosed','message','success','$product_details.type','concat','language','purchase\x20data\x20update\x20successfully','due_amount','Return\x20Goods','</tr>','<strong>\x20Regards\x20</strong>','</tbody>','FROZEN\x20GOODS','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','exports','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details','floor','/view/:id','<tr>','purchases\x20item\x20return\x20successfull','An\x20error\x20occurred\x20while\x20saving\x20data.','INCF-','date','$product_details.storage','getMonth','$suppliers','level','/give_payment/:id','Rack\x202','<h2>\x20','status','purchase\x20data\x20add\x20successfully','/invoice/:id','prod_primunit','$product.quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','password','prod_level','stock_data','/barcode/:id','purchase_quantity','/view/add_purchases','Ambient','</td>','$product.bay','726267fTFksg','$secondary_code','\x20Order\x20Number\x20:\x20','warehouse_name','<span\x20style=\x22float:\x20right;\x22>','<html><head><title></title>','back','name','$maxStocks','Error\x20occurred\x20while\x20processing\x20product:','German','/view/add_purchases/:id','find','user_id','8019649LBZzPf','_id','260DgpTme','$room','/all_purchases_finished/view','expiry_date','primary_code_hide','product','product_stock','post','all','image','prod_unit','warehouse','flash','filter','redirect','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','catch','email','batch_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Portuguese\x20(BR)','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','save','product_date','Portuguese','/upload/','$product.room_name','</span>','then','updateOne','6PxuDZv','currency_placement','get','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','prod_name','sendMail','prod_code','site_title','add_purchases_finished','maxperunit','4nyBbLb','$product.floorlevel','length','random','Logo.png','return_purchase_finished','7624MKiCLm','body','Spanish','slice','host','/barcode_scanner','path','Finished\x20Goods','findOne','stocks','add_purchases\x20error','$product','staff','forEach','$expiry_date','port','<hr\x20class=\x22my-3\x22>','../middleware/auth','POnumber','logo','prod_cat','abs','product_details','$category','$due_amount','</body></html>','json','$product_details.product_name','$brand'];a0_0x3ae5=function(){return _0x368204;};return a0_0x3ae5();}router['get'](a0_0x3e3a3c(0x1ba),auth,async(_0x5b211d,_0x485137)=>{var _0x293507=a0_0x3e3a3c;try{const {username:_0xbd6928,email:_0x100574,role:_0x7b897}=_0x5b211d['user'],_0x3c645e=_0x5b211d[_0x293507(0x194)],_0x335392=await profile[_0x293507(0x15e)]({'email':_0x3c645e['email']}),_0x39763=await staff['findOne']({'email':_0x3c645e['email']});if(_0x3c645e[_0x293507(0x1c5)]==_0x293507(0x162)){const _0x3c60cd=await staff['findOne']({'email':_0x3c645e['email']});}const _0xe05f26=await master_shop['find']();let _0x47a031;if(_0x3c645e[_0x293507(0x1c5)]==_0x293507(0x162)){const _0x2ee735=await staff['findOne']({'email':_0x3c645e[_0x293507(0x139)]});_0x47a031=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x2ee735[_0x293507(0x132)]}},{'$lookup':{'from':_0x293507(0x1ab),'localField':_0x293507(0x1ab),'foreignField':_0x293507(0x11e),'as':'suppliers_docs'}},{'$unwind':_0x293507(0x1ac)},{'$unwind':_0x293507(0x161)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x293507(0x101)},'date':{'$first':_0x293507(0x1c0)},'warehouse_name':{'$first':_0x293507(0xf3)},'room':{'$first':_0x293507(0x128)},'product':{'$push':_0x293507(0x161)},'note':{'$first':_0x293507(0xd6)},'paid_amount':{'$first':_0x293507(0x1c4)},'due_amount':{'$first':_0x293507(0x16e)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x293507(0x164)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x293507(0x10a)},'level':{'$addToSet':_0x293507(0x116)},'isle':{'$addToSet':_0x293507(0x19c)},'type':{'$addToSet':_0x293507(0x1b2)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x47a031=await purchases_finished[_0x293507(0xd3)]([{'$unwind':_0x293507(0x161)},{'$group':{'_id':'$_id','invoice':{'$first':_0x293507(0x18f)},'suppliers':{'$first':_0x293507(0x101)},'date':{'$first':_0x293507(0x1c0)},'warehouse_name':{'$first':_0x293507(0xf3)},'room':{'$addToSet':_0x293507(0x142)},'product':{'$push':_0x293507(0x161)},'note':{'$first':_0x293507(0xd6)},'paid_amount':{'$first':_0x293507(0x1c4)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x293507(0x164)},'suppliers_docs':{'$first':_0x293507(0x1ac)},'total_product_quantity':{'$sum':_0x293507(0x10a)},'level':{'$addToSet':_0x293507(0x116)},'isle':{'$addToSet':_0x293507(0x19c)},'type':{'$addToSet':_0x293507(0x1b2)},'floorlevel':{'$addToSet':_0x293507(0x151)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xe05f26[0x0][_0x293507(0xeb)]==_0x293507(0x10c))var _0x261f3e=users[_0x293507(0xe3)];else{if(_0xe05f26[0x0]['language']==_0x293507(0x173))var _0x261f3e=users['Hindi'];else{if(_0xe05f26[0x0][_0x293507(0xeb)]==_0x293507(0x121))var _0x261f3e=users[_0x293507(0x121)];else{if(_0xe05f26[0x0][_0x293507(0xeb)]==_0x293507(0x158))var _0x261f3e=users['Spanish'];else{if(_0xe05f26[0x0][_0x293507(0xeb)]==_0x293507(0x1bb))var _0x261f3e=users[_0x293507(0x1bb)];else{if(_0xe05f26[0x0][_0x293507(0xeb)]==_0x293507(0x13c))var _0x261f3e=users[_0x293507(0x140)];else{if(_0xe05f26[0x0][_0x293507(0xeb)]==_0x293507(0x1b7))var _0x261f3e=users[_0x293507(0x1b7)];else{if(_0xe05f26[0x0][_0x293507(0xeb)]==_0x293507(0xd9))var _0x261f3e=users['Arabic'];}}}}}}}_0x485137[_0x293507(0x1c1)]('all_purchases_finished',{'success':_0x5b211d[_0x293507(0x133)](_0x293507(0xe8)),'errors':_0x5b211d[_0x293507(0x133)]('errors'),'purchases':_0x47a031,'role':_0x3c645e,'profile':_0x335392,'master_shop':_0xe05f26,'language':_0x261f3e});}catch(_0x30b4be){console[_0x293507(0x18c)](_0x293507(0x186),_0x30b4be),_0x485137['status'](0xc8)[_0x293507(0x170)]({'message':_0x30b4be['message']});}});function a0_0x20c4(_0x7a2814,_0x253c70){var _0x3ae5d5=a0_0x3ae5();return a0_0x20c4=function(_0x20c4b0,_0x2cb1d1){_0x20c4b0=_0x20c4b0-0xcb;var _0x33d45e=_0x3ae5d5[_0x20c4b0];return _0x33d45e;},a0_0x20c4(_0x7a2814,_0x253c70);}function BayBinSelected(_0x410848,_0x29bf64){var _0x175ddc=a0_0x3e3a3c,_0x59931c=[],_0x2eb4bf=[];if(_0x410848==_0x175ddc(0xdf)){switch(_0x29bf64){case _0x175ddc(0xdd):_0x59931c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x175ddc(0x104):_0x59931c=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2eb4bf=['DG'];}else{if(_0x410848==_0x175ddc(0xf2)){switch(_0x29bf64){case _0x175ddc(0xdd):_0x59931c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x175ddc(0x104):_0x59931c=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2eb4bf=['FG'];}}return{'levels':_0x59931c,'identify':_0x2eb4bf};}async function getRandom8DigitNumber(){var _0x5aa3f6=a0_0x3e3a3c;const _0x1520ba=0x989680,_0x568346=0x5f5e0ff,_0x58f018=Math[_0x5aa3f6(0xf8)](Math[_0x5aa3f6(0x153)]()*(_0x568346-_0x1520ba+0x1))+_0x1520ba;var _0x7025b6;const _0x125d82=await purchases_finished[_0x5aa3f6(0x15e)]({'invoice':'INCF-'+_0x58f018});return _0x125d82&&_0x125d82[_0x5aa3f6(0x152)]>0x0?_0x7025b6=_0x5aa3f6(0xfd)+_0x58f018:_0x7025b6='INCF-'+_0x58f018,_0x7025b6;}router[a0_0x3e3a3c(0x148)](a0_0x3e3a3c(0x113),auth,async(_0x57d157,_0x45ecc0)=>{var _0x26d17b=a0_0x3e3a3c;try{const {username:_0xc34e9f,email:_0x4f70e2,role:_0x3ee796}=_0x57d157[_0x26d17b(0x194)],_0xb0324c=_0x57d157[_0x26d17b(0x194)],_0x980721=await profile['findOne']({'email':_0xb0324c[_0x26d17b(0x139)]}),_0x3dbbea=await master_shop['find'](),_0x594049=await staff[_0x26d17b(0x15e)]({'email':_0xb0324c[_0x26d17b(0x139)]}),_0x2ebb39=await suppliers[_0x26d17b(0x123)]({});let _0x591a1e;if(_0xb0324c[_0x26d17b(0x1c5)]==_0x26d17b(0x162)){const _0x2f97e1=await staff[_0x26d17b(0x15e)]({'email':_0xb0324c[_0x26d17b(0x139)]});_0x591a1e=await warehouse[_0x26d17b(0xd3)]([{'$match':{'status':_0x26d17b(0xd5),'name':_0x2f97e1['warehouse'],'warehouse_category':_0x26d17b(0x15d)}},{'$group':{'_id':_0x26d17b(0xcd),'name':{'$first':_0x26d17b(0xcd)}}}]);}else _0x591a1e=await warehouse[_0x26d17b(0xd3)]([{'$match':{'status':_0x26d17b(0xd5),'warehouse_category':_0x26d17b(0x15d),'name':{'$ne':_0x26d17b(0x174)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x115bf6=await product[_0x26d17b(0x123)]({}),_0x248563=await warehouse[_0x26d17b(0x123)]({'status':_0x26d17b(0xd5)}),_0x703dec=await purchases_finished[_0x26d17b(0x123)]({}),_0x2ab533=_0x703dec[_0x26d17b(0x152)]+0x1,_0x4ad704=_0x26d17b(0xfd)+_0x2ab533[_0x26d17b(0x17b)]()['padStart'](0x5,'0');var _0x5cb013=[_0x26d17b(0x114),_0x26d17b(0xe6)];if(_0x3dbbea[0x0][_0x26d17b(0xeb)]=='English\x20(US)')var _0x504b1e=users[_0x26d17b(0xe3)];else{if(_0x3dbbea[0x0][_0x26d17b(0xeb)]==_0x26d17b(0x173))var _0x504b1e=users['Hindi'];else{if(_0x3dbbea[0x0][_0x26d17b(0xeb)]==_0x26d17b(0x121))var _0x504b1e=users[_0x26d17b(0x121)];else{if(_0x3dbbea[0x0][_0x26d17b(0xeb)]==_0x26d17b(0x158))var _0x504b1e=users[_0x26d17b(0x158)];else{if(_0x3dbbea[0x0][_0x26d17b(0xeb)]==_0x26d17b(0x1bb))var _0x504b1e=users[_0x26d17b(0x1bb)];else{if(_0x3dbbea[0x0][_0x26d17b(0xeb)]==_0x26d17b(0x13c))var _0x504b1e=users[_0x26d17b(0x140)];else{if(_0x3dbbea[0x0][_0x26d17b(0xeb)]==_0x26d17b(0x1b7))var _0x504b1e=users['Chinese'];else{if(_0x3dbbea[0x0]['language']=='Arabic\x20(ae)')var _0x504b1e=users[_0x26d17b(0x1ad)];}}}}}}}const _0x575af6=getRandom8DigitNumber();_0x575af6['then'](_0x584d83=>{var _0x26300e=_0x26d17b;_0x45ecc0[_0x26300e(0x1c1)](_0x26300e(0x14e),{'success':_0x57d157[_0x26300e(0x133)]('success'),'errors':_0x57d157[_0x26300e(0x133)](_0x26300e(0x1bf)),'role':_0xb0324c,'profile':_0x980721,'suppliers':_0x2ebb39,'warehouse':_0x591a1e,'product':_0x115bf6,'invoice':_0x584d83,'master_shop':_0x3dbbea,'language':_0x504b1e,'find_data':_0x248563,'rooms_data':_0x5cb013});})[_0x26d17b(0x138)](_0x413e75=>{var _0x4d248e=_0x26d17b;_0x57d157[_0x4d248e(0x133)](_0x4d248e(0x1bf),_0x4d248e(0x183)),_0x45ecc0[_0x4d248e(0x135)](_0x4d248e(0x129));});}catch(_0x53d73e){console['log'](_0x53d73e);}}),router[a0_0x3e3a3c(0x148)](a0_0x3e3a3c(0x122),auth,async(_0x62a82a,_0x177ffa)=>{var _0x5702e5=a0_0x3e3a3c;try{const _0xd942f0=_0x62a82a[_0x5702e5(0x191)]['id'];console[_0x5702e5(0x18c)](_0xd942f0);const _0x35b095=await master_shop[_0x5702e5(0x123)]();console[_0x5702e5(0x18c)]('master',_0x35b095);const _0x3d4e40=await product[_0x5702e5(0x15e)]({'name':_0xd942f0});console['log'](_0x5702e5(0x12c),_0x3d4e40),_0x177ffa[_0x5702e5(0x106)](0xc8)[_0x5702e5(0x170)]({'product_data':_0x3d4e40,'master':_0x35b095});}catch(_0x733697){console[_0x5702e5(0x18c)](_0x5702e5(0x160),_0x733697);}}),router['post']('/view/add_purchases',auth,async(_0x2a5a1e,_0x20542c)=>{var _0x327dfa=a0_0x3e3a3c;try{const {invoice:_0x284436,date:_0x4a5269,warehouse_name:_0xfca37,prod_name:_0x5b1ea9,prod_code:_0x1f2f84,prod_qty:_0x5ad8ea,prod_unit:_0x1e9a0e,prod_secondunit:_0x4e588a,prod_level:_0x37c98a,prod_isle:_0x1f0f56,prod_pallet:_0x32baf5,note:_0x15f35d,expiry_date:_0x5c1078,batch_code:_0x2a6a8f,payable:_0x221149,due_amount:_0x532087,Room_name:_0x2c82af,primary_code:_0x1c51bd,secondary_code:_0x3adb68,MaxStocks_data:_0x44c006,PO_number:_0x347b27,SCRN:_0x2c7ddd,JO_number:_0x551f09}=_0x2a5a1e['body'];if(typeof _0x5b1ea9==_0x327dfa(0xd2))var _0x91ef8c=[_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x14a)]],_0x1dfe9d=[_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x14c)]],_0x9c738b=[_0x2a5a1e['body']['prod_Qty']],_0x4dee44=[_0x2a5a1e['body'][_0x327dfa(0x109)]],_0x24a684=[_0x2a5a1e[_0x327dfa(0x157)]['prod_secondunit']],_0x3b4fee=[_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x10f)]],_0x59d38c=[_0x2a5a1e[_0x327dfa(0x157)]['primary_code']],_0xb623db=[_0x2a5a1e['body'][_0x327dfa(0xe0)]],_0x559838=[_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x1ca)]],_0x1a3b16=[_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x13a)]],_0x478e14=[_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x12a)]],_0x16eafa=[_0x2a5a1e['body'][_0x327dfa(0x13f)]],_0x2e6bd7=[_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x197)]],_0x17cff4=[_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x16a)]],_0x12ea85=[_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x17e)]],_0x5ef73c=[_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x1ae)]];else var _0x91ef8c=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x14a)]],_0x1dfe9d=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x14c)]],_0x9c738b=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x182)]],_0x4dee44=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x109)]],_0x24a684=[..._0x2a5a1e['body'][_0x327dfa(0x190)]],_0x3b4fee=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x10f)]],_0x59d38c=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x1b9)]],_0xb623db=[..._0x2a5a1e[_0x327dfa(0x157)]['secondary_code']],_0x559838=[..._0x2a5a1e['body'][_0x327dfa(0x1ca)]],_0x1a3b16=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x13a)]],_0x478e14=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x12a)]],_0x16eafa=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x13f)]],_0x2e6bd7=[..._0x2a5a1e['body'][_0x327dfa(0x197)]],_0x17cff4=[..._0x2a5a1e[_0x327dfa(0x157)]['prod_cat']],_0x12ea85=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x17e)]],_0x5ef73c=[..._0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x1ae)]];const _0xbb7623=_0x91ef8c[_0x327dfa(0x1b0)](_0x165ac6=>{return _0x165ac6={'product_name':_0x165ac6};});_0x1dfe9d[_0x327dfa(0x163)]((_0x4b5bc0,_0x1400bc)=>{_0xbb7623[_0x1400bc]['product_code']=_0x4b5bc0;}),_0x9c738b[_0x327dfa(0x163)]((_0x4397ca,_0x2510f3)=>{var _0x2ad086=_0x327dfa;_0xbb7623[_0x2510f3][_0x2ad086(0x1c3)]=Math['abs'](_0x4397ca);}),_0x4dee44['forEach']((_0x2b6081,_0x52e73b)=>{var _0x48849c=_0x327dfa;_0xbb7623[_0x52e73b][_0x48849c(0xdb)]=_0x2b6081;}),_0x24a684[_0x327dfa(0x163)]((_0x3add95,_0x101dd6)=>{var _0x202677=_0x327dfa;_0xbb7623[_0x101dd6][_0x202677(0x1b4)]=_0x3add95;}),_0x3b4fee[_0x327dfa(0x163)]((_0x5a2ed0,_0x25bd2c)=>{_0xbb7623[_0x25bd2c]['bay']=_0x5a2ed0;}),_0x59d38c['forEach']((_0x50617c,_0x269865)=>{_0xbb7623[_0x269865]['primary_code']=_0x50617c;}),_0xb623db[_0x327dfa(0x163)]((_0x4fb970,_0x32caf3)=>{var _0x5335bf=_0x327dfa;_0xbb7623[_0x32caf3][_0x5335bf(0xe0)]=_0x4fb970;}),_0x559838[_0x327dfa(0x163)]((_0x232ba0,_0x59b9ef)=>{var _0x29190d=_0x327dfa;_0xbb7623[_0x59b9ef][_0x29190d(0xda)]=_0x232ba0;}),_0x1a3b16[_0x327dfa(0x163)]((_0x59bf53,_0x3af927)=>{var _0x7c40d8=_0x327dfa;_0xbb7623[_0x3af927][_0x7c40d8(0x13a)]=_0x59bf53;}),_0x478e14[_0x327dfa(0x163)]((_0x4bddab,_0x3a72cb)=>{var _0x4f7e4b=_0x327dfa;_0xbb7623[_0x3a72cb][_0x4f7e4b(0x12a)]=_0x4bddab;}),_0x16eafa[_0x327dfa(0x163)]((_0x492104,_0x10ae72)=>{var _0x2a50bf=_0x327dfa;_0xbb7623[_0x10ae72][_0x2a50bf(0x17d)]=_0x492104;}),_0x2e6bd7['forEach']((_0x3ce446,_0x565a72)=>{_0xbb7623[_0x565a72]['maxperunit']=_0x3ce446;}),_0x17cff4[_0x327dfa(0x163)]((_0xd778ab,_0x5d0d1b)=>{var _0x1b3f15=_0x327dfa;_0xbb7623[_0x5d0d1b][_0x1b3f15(0x19d)]=_0xd778ab;}),_0x12ea85[_0x327dfa(0x163)]((_0x5ddf3c,_0x1f7af6)=>{var _0x4c5265=_0x327dfa;_0xbb7623[_0x1f7af6][_0x4c5265(0xdc)]=_0x5ddf3c;}),_0x5ef73c[_0x327dfa(0x163)]((_0x192fe0,_0x37e256)=>{var _0x45cfbc=_0x327dfa;_0xbb7623[_0x37e256][_0x45cfbc(0x1a1)]=_0x192fe0;});const _0x55e6f2=_0xbb7623[_0x327dfa(0x134)](_0x51fc16=>_0x51fc16['quantity']!=='0'&&_0x51fc16[_0x327dfa(0x1c3)]!==''),_0x1c00cc=new purchases_finished({'invoice':_0x284436,'suppliers':_0x2a5a1e[_0x327dfa(0x157)][_0x327dfa(0x1ab)],'date':_0x4a5269,'warehouse_name':_0xfca37,'product':_0x55e6f2,'note':_0x15f35d,'due_amount':_0x532087,'room':_0x2c82af,'POnumber':_0x347b27,'SCRN':_0x2c7ddd,'JO_number':_0x551f09}),_0x4246ec=await _0x1c00cc[_0x327dfa(0x13e)](),_0x101af3=await purchases_finished[_0x327dfa(0x15e)]({'invoice':_0x284436}),_0x3640ba=_0x101af3[_0x327dfa(0x12c)][_0x327dfa(0x1b0)](async _0x42b4d8=>{var _0x2f2db1=_0x327dfa;try{var _0x3e6564=await warehouse['findOne']({'name':_0xfca37,'room':_0x42b4d8[_0x2f2db1(0xdc)]}),_0x4724f5=0x0;const _0x367019=_0x3e6564['product_details']['map'](_0x4af0d1=>{var _0x14c6f7=_0x2f2db1;console[_0x14c6f7(0x18c)](_0x4af0d1['product_name']+'=='+_0x42b4d8['product_name']+'&&'+_0x4af0d1[_0x14c6f7(0x1b5)]+'=='+_0x42b4d8['bay']+'&&'+_0x4af0d1['expiry_date']+'=='+_0x42b4d8[_0x14c6f7(0x12a)]+'&&'+_0x4af0d1[_0x14c6f7(0x17d)]+'=='+_0x42b4d8['production_date']+'&&'+_0x4af0d1[_0x14c6f7(0x13a)]+'=='+_0x42b4d8[_0x14c6f7(0x13a)]+'&&'+_0x4af0d1[_0x14c6f7(0x1a1)]+'=='+_0x101af3[_0x14c6f7(0x1a1)]),_0x4af0d1[_0x14c6f7(0x1be)]==_0x42b4d8[_0x14c6f7(0x1be)]&&_0x4af0d1[_0x14c6f7(0x1b5)]==_0x42b4d8[_0x14c6f7(0x1b5)]&&_0x4af0d1['expiry_date']==_0x42b4d8[_0x14c6f7(0x12a)]&&_0x4af0d1[_0x14c6f7(0x17d)]==_0x42b4d8[_0x14c6f7(0x17d)]&&_0x4af0d1[_0x14c6f7(0x13a)]==_0x42b4d8['batch_code']&&_0x4af0d1['invoice']==_0x101af3[_0x14c6f7(0x1a1)]&&(_0x4af0d1[_0x14c6f7(0x12d)]=Math[_0x14c6f7(0x16b)](_0x4af0d1['product_stock'])+Math[_0x14c6f7(0x16b)](_0x42b4d8['quantity']),_0x4724f5++);});return _0x4724f5==0x0&&(_0x3e6564[_0x2f2db1(0x16c)]=_0x3e6564['product_details'][_0x2f2db1(0xea)]({'product_name':_0x42b4d8[_0x2f2db1(0x1be)],'product_stock':Math['abs'](_0x42b4d8[_0x2f2db1(0x1c3)]),'primary_code':_0x42b4d8[_0x2f2db1(0x1b9)],'secondary_code':_0x42b4d8[_0x2f2db1(0xe0)],'product_code':_0x42b4d8['product_code'],'bay':_0x42b4d8[_0x2f2db1(0x1b5)],'maxProducts':_0x42b4d8['maxStocks'],'unit':_0x42b4d8[_0x2f2db1(0xdb)],'secondary_unit':_0x42b4d8['secondary_unit'],'expiry_date':_0x42b4d8['expiry_date'],'production_date':_0x42b4d8[_0x2f2db1(0x17d)],'maxProducts':_0x42b4d8[_0x2f2db1(0xda)],'maxPerUnit':_0x42b4d8[_0x2f2db1(0x14f)],'batch_code':_0x42b4d8[_0x2f2db1(0x13a)],'product_cat':_0x42b4d8[_0x2f2db1(0x19d)],'invoice':_0x42b4d8[_0x2f2db1(0x1a1)],'id_incoming':_0x42b4d8[_0x2f2db1(0x126)]})),_0x3e6564;}catch(_0x18c142){return console[_0x2f2db1(0x187)](_0x2f2db1(0x120),_0x18c142),null;}});Promise[_0x327dfa(0x12f)](_0x3640ba)[_0x327dfa(0x144)](async _0x2d638d=>{var _0x54d1f9=_0x327dfa;try{for(const _0x4e98a5 of _0x2d638d){await warehouse[_0x54d1f9(0x145)]({'_id':_0x4e98a5[_0x54d1f9(0x126)]},{'$addToSet':{'product_details':{'$each':_0x4e98a5['product_details']}}});}const _0x45d259=await master_shop[_0x54d1f9(0x123)](),_0x2c5274=await email_settings[_0x54d1f9(0x15e)](),_0x5d4ff1=await supervisor_settings[_0x54d1f9(0x123)]();var _0x57dbbb=_0x101af3['product'],_0x4e4fd4='',_0x1c9487;for(_0x1c9487 in _0x57dbbb){var _0x34b2fb='FG';_0x101af3[_0x54d1f9(0x11a)]==_0x54d1f9(0xdf)&&(_0x34b2fb='DG'),_0x4e4fd4+=_0x54d1f9(0xfa)+_0x54d1f9(0x1b1)+_0x57dbbb[_0x1c9487][_0x54d1f9(0x1be)]+_0x54d1f9(0x115)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57dbbb[_0x1c9487][_0x54d1f9(0x185)]+'</td>'+_0x54d1f9(0x1b1)+_0x57dbbb[_0x1c9487][_0x54d1f9(0x1c3)]+_0x54d1f9(0x115)+_0x54d1f9(0x1b1)+_0x57dbbb[_0x1c9487][_0x54d1f9(0xdb)]+_0x54d1f9(0x115)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57dbbb[_0x1c9487][_0x54d1f9(0x1b4)]+_0x54d1f9(0x115)+_0x54d1f9(0x1b1)+_0x101af3['warehouse_name']+_0x54d1f9(0x115)+_0x54d1f9(0x1b1)+_0x57dbbb[_0x1c9487]['room_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34b2fb+_0x57dbbb[_0x1c9487][_0x54d1f9(0x1b5)]+_0x54d1f9(0x115),_0x54d1f9(0xef);}let _0x1757e6=nodemailer[_0x54d1f9(0x1aa)]({'host':_0x2c5274[_0x54d1f9(0x15a)],'port':Number(_0x2c5274[_0x54d1f9(0x165)]),'secure':![],'auth':{'user':_0x2c5274[_0x54d1f9(0x139)],'pass':_0x2c5274[_0x54d1f9(0x10e)]}}),_0x6ae50a={'from':_0x2c5274[_0x54d1f9(0x139)],'to':_0x5d4ff1[0x0][_0x54d1f9(0x1a5)],'subject':_0x54d1f9(0xd8),'attachments':[{'filename':_0x54d1f9(0x154),'path':__dirname+_0x54d1f9(0x180)+_0x54d1f9(0x141)+_0x45d259[0x0]['image'],'cid':_0x54d1f9(0x169)}],'html':_0x54d1f9(0xe1)+'<html><head><title></title>'+'</head><body>'+_0x54d1f9(0x198)+_0x54d1f9(0x13b)+'<div>'+_0x54d1f9(0x18d)+_0x54d1f9(0x192)+_0x54d1f9(0x198)+_0x54d1f9(0x105)+_0x45d259[0x0][_0x54d1f9(0x14d)]+_0x54d1f9(0x1bd)+_0x54d1f9(0x192)+_0x54d1f9(0x192)+_0x54d1f9(0x166)+_0x54d1f9(0x198)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x54d1f9(0x119)+_0x101af3['invoice']+'\x20'+_0x54d1f9(0x11b)+_0x54d1f9(0x1a3)+_0x101af3[_0x54d1f9(0xfe)]+'\x20'+_0x54d1f9(0x143)+_0x54d1f9(0xe4)+_0x54d1f9(0x192)+_0x54d1f9(0x199)+_0x54d1f9(0x13d)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x54d1f9(0x10b)+_0x54d1f9(0x184)+_0x54d1f9(0xf4)+_0x54d1f9(0xe5)+_0x54d1f9(0xf6)+_0x54d1f9(0x10d)+_0x54d1f9(0x137)+_0x54d1f9(0xef)+'</thead>'+_0x54d1f9(0x175)+'\x20'+_0x4e4fd4+'\x20'+'</tbody>'+_0x54d1f9(0xcf)+_0x54d1f9(0x198)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x45d259[0x0]['site_title']+_0x54d1f9(0xe4)+'</div>'+_0x54d1f9(0x192)+_0x54d1f9(0x16f)};_0x1757e6[_0x54d1f9(0x14b)](_0x6ae50a,function(_0x5d4303,_0x1fbffc){var _0x484050=_0x54d1f9;_0x5d4303?(console['log'](_0x5d4303),console[_0x484050(0x18c)](_0x484050(0x1a7))):console[_0x484050(0x18c)]('Email\x20sent\x20successfully');});}catch(_0x5a2945){console['error'](_0x5a2945),_0x20542c[_0x54d1f9(0x106)](0x1f4)[_0x54d1f9(0x170)]({'error':_0x54d1f9(0xfc),'message':_0x5a2945['message']});}})[_0x327dfa(0x138)](_0x43bc2d=>{var _0x346bbf=_0x327dfa;console[_0x346bbf(0x187)](_0x43bc2d);}),_0x2a5a1e['flash'](_0x327dfa(0xe8),_0x327dfa(0x107)),_0x20542c[_0x327dfa(0x135)](_0x327dfa(0x129));}catch(_0x262e85){console[_0x327dfa(0x18c)](_0x262e85);}}),router[a0_0x3e3a3c(0x148)]('/preview/:id',auth,async(_0x307d65,_0x2ea808)=>{var _0x5d99aa=a0_0x3e3a3c;try{const {username:_0x30d44c,email:_0x346bf7,role:_0x59e5fe}=_0x307d65[_0x5d99aa(0x194)],_0x240b6d=_0x307d65[_0x5d99aa(0x194)],_0xacf1b2=await profile[_0x5d99aa(0x15e)]({'email':_0x240b6d[_0x5d99aa(0x139)]}),_0x19c59d=await master_shop[_0x5d99aa(0x123)](),_0x36913e=_0x307d65['params']['id'],_0x1ce556=await purchases_finished[_0x5d99aa(0x189)](_0x36913e),_0x4b2d4e=await suppliers['find']({});let _0x512a4a;if(_0x240b6d[_0x5d99aa(0x1c5)]==_0x5d99aa(0x162)){const _0x390562=await staff[_0x5d99aa(0x15e)]({'email':_0x240b6d[_0x5d99aa(0x139)]});_0x512a4a=await warehouse[_0x5d99aa(0x123)]({'status':_0x5d99aa(0xd5),'name':_0x390562[_0x5d99aa(0x132)],'warehouse_category':_0x5d99aa(0x15d)});}else _0x512a4a=await warehouse['aggregate']([{'$match':{'status':_0x5d99aa(0xd5),'warehouse_category':_0x5d99aa(0x15d)}},{'$group':{'_id':'$name','name':{'$first':_0x5d99aa(0xcd)}}}]);const _0x29bf67=await product[_0x5d99aa(0x123)]({}),_0x4b7376=BayBinSelected(_0x1ce556[_0x5d99aa(0x11a)],_0x1ce556['room']);let _0x163895=new Date(_0x1ce556['expiry_date']),_0x525777=('0'+_0x163895[_0x5d99aa(0x1a2)]())[_0x5d99aa(0x159)](-0x2),_0x4936be=('0'+(_0x163895[_0x5d99aa(0x100)]()+0x1))[_0x5d99aa(0x159)](-0x2),_0x244fd9=_0x163895['getFullYear'](),_0x2eb8ad=_0x244fd9+'-'+_0x4936be+'-'+_0x525777;if(_0x19c59d[0x0][_0x5d99aa(0xeb)]==_0x5d99aa(0x10c)){var _0x599ca2=users[_0x5d99aa(0xe3)];console[_0x5d99aa(0x18c)](_0x599ca2);}else{if(_0x19c59d[0x0][_0x5d99aa(0xeb)]=='Hindi')var _0x599ca2=users[_0x5d99aa(0x173)];else{if(_0x19c59d[0x0]['language']==_0x5d99aa(0x121))var _0x599ca2=users['German'];else{if(_0x19c59d[0x0][_0x5d99aa(0xeb)]==_0x5d99aa(0x158))var _0x599ca2=users['Spanish'];else{if(_0x19c59d[0x0][_0x5d99aa(0xeb)]=='French')var _0x599ca2=users[_0x5d99aa(0x1bb)];else{if(_0x19c59d[0x0][_0x5d99aa(0xeb)]==_0x5d99aa(0x13c))var _0x599ca2=users[_0x5d99aa(0x140)];else{if(_0x19c59d[0x0][_0x5d99aa(0xeb)]==_0x5d99aa(0x1b7))var _0x599ca2=users['Chinese'];else{if(_0x19c59d[0x0][_0x5d99aa(0xeb)]=='Arabic\x20(ae)')var _0x599ca2=users[_0x5d99aa(0x1ad)];}}}}}}}_0x2ea808[_0x5d99aa(0x1c1)]('edit_purchases_finished_view',{'success':_0x307d65[_0x5d99aa(0x133)](_0x5d99aa(0xe8)),'errors':_0x307d65[_0x5d99aa(0x133)](_0x5d99aa(0x1bf)),'role':_0x240b6d,'profile':_0xacf1b2,'purchases':_0x1ce556,'suppliers':_0x4b2d4e,'warehouse':_0x512a4a,'product':_0x29bf67,'master_shop':_0x19c59d,'language':_0x599ca2,'ed_fullDate':_0x2eb8ad,'dataSelected':_0x4b7376});}catch(_0x29f9be){console[_0x5d99aa(0x18c)](_0x29f9be);}}),router[a0_0x3e3a3c(0x148)](a0_0x3e3a3c(0xf9),auth,async(_0x43fc77,_0x227fd4)=>{var _0x91037d=a0_0x3e3a3c;try{const {username:_0x25f2be,email:_0x2a8815,role:_0x5ac880}=_0x43fc77[_0x91037d(0x194)],_0x15a25a=_0x43fc77[_0x91037d(0x194)],_0x3b4e22=await profile['findOne']({'email':_0x15a25a[_0x91037d(0x139)]}),_0x3722af=await master_shop[_0x91037d(0x123)](),_0x2c6f45=_0x43fc77['params']['id'],_0x234f52=await purchases_finished[_0x91037d(0x189)](_0x2c6f45),_0x51c32b=await suppliers[_0x91037d(0x123)]({});let _0x431679;if(_0x15a25a[_0x91037d(0x1c5)]==_0x91037d(0x162)){const _0x35583d=await staff[_0x91037d(0x15e)]({'email':_0x15a25a[_0x91037d(0x139)]});_0x431679=await warehouse[_0x91037d(0x123)]({'status':'Enabled','name':_0x35583d[_0x91037d(0x132)],'warehouse_category':_0x91037d(0x15d)});}else _0x431679=await warehouse[_0x91037d(0xd3)]([{'$match':{'status':_0x91037d(0xd5),'warehouse_category':_0x91037d(0x15d)}},{'$group':{'_id':_0x91037d(0xcd),'name':{'$first':'$name'}}}]);const _0x19eb96=await product[_0x91037d(0x123)]({}),_0x172d5a=BayBinSelected(_0x234f52[_0x91037d(0x11a)],_0x234f52[_0x91037d(0x19f)]);let _0x199945=new Date(_0x234f52[_0x91037d(0x12a)]),_0x867417=('0'+_0x199945[_0x91037d(0x1a2)]())[_0x91037d(0x159)](-0x2),_0x11c510=('0'+(_0x199945['getMonth']()+0x1))[_0x91037d(0x159)](-0x2),_0x505f87=_0x199945[_0x91037d(0x1c2)](),_0x3c1d4f=_0x505f87+'-'+_0x11c510+'-'+_0x867417;if(_0x3722af[0x0][_0x91037d(0xeb)]=='English\x20(US)'){var _0x1c64a5=users[_0x91037d(0xe3)];console[_0x91037d(0x18c)](_0x1c64a5);}else{if(_0x3722af[0x0][_0x91037d(0xeb)]==_0x91037d(0x173))var _0x1c64a5=users[_0x91037d(0x173)];else{if(_0x3722af[0x0][_0x91037d(0xeb)]==_0x91037d(0x121))var _0x1c64a5=users['German'];else{if(_0x3722af[0x0][_0x91037d(0xeb)]==_0x91037d(0x158))var _0x1c64a5=users[_0x91037d(0x158)];else{if(_0x3722af[0x0]['language']=='French')var _0x1c64a5=users[_0x91037d(0x1bb)];else{if(_0x3722af[0x0]['language']==_0x91037d(0x13c))var _0x1c64a5=users[_0x91037d(0x140)];else{if(_0x3722af[0x0][_0x91037d(0xeb)]=='Chinese')var _0x1c64a5=users[_0x91037d(0x1b7)];else{if(_0x3722af[0x0][_0x91037d(0xeb)]=='Arabic\x20(ae)')var _0x1c64a5=users[_0x91037d(0x1ad)];}}}}}}}_0x227fd4[_0x91037d(0x1c1)](_0x91037d(0x18a),{'success':_0x43fc77['flash'](_0x91037d(0xe8)),'errors':_0x43fc77[_0x91037d(0x133)](_0x91037d(0x1bf)),'role':_0x15a25a,'profile':_0x3b4e22,'purchases':_0x234f52,'suppliers':_0x51c32b,'warehouse':_0x431679,'product':_0x19eb96,'master_shop':_0x3722af,'language':_0x1c64a5,'ed_fullDate':_0x3c1d4f,'dataSelected':_0x172d5a});}catch(_0x30aca6){console[_0x91037d(0x18c)](_0x30aca6);}}),router['post']('/view/:id',auth,async(_0x2efe1b,_0x74ec5)=>{var _0x502c31=a0_0x3e3a3c;try{const _0x5dd6df=_0x2efe1b['params']['id'],_0x264c98=await purchases_finished[_0x502c31(0x15e)]({'_id':_0x2efe1b['params']['id']}),_0x56e592=await warehouse[_0x502c31(0x15e)]({'name':_0x264c98['warehouse_name'],'room':_0x264c98['room']});_0x264c98['product'][_0x502c31(0x163)](_0x5d6652=>{var _0x2eafcb=_0x502c31;const _0x1f3b58=_0x56e592[_0x2eafcb(0x16c)][_0x2eafcb(0x1b0)](_0x4c2578=>{var _0x2094ed=_0x2eafcb;_0x4c2578[_0x2094ed(0x1be)]==_0x5d6652[_0x2094ed(0x1be)]&&_0x4c2578[_0x2094ed(0x1b5)]==_0x5d6652[_0x2094ed(0x1b5)]&&(_0x4c2578[_0x2094ed(0x12d)]=parseInt(_0x4c2578[_0x2094ed(0x12d)])-parseInt(_0x5d6652[_0x2094ed(0x1c3)]));});}),await _0x56e592['save']();const {invoice:_0x4f431e,suppliers:_0x17d548,date:_0x5523ac,warehouse_name:_0x7892a4,prod_name:_0x5b85bf,prod_code:_0x2c3065,prod_qty:_0x46feb7,prod_unit:_0x62df0c,prod_secondunit:_0x2c267c,prod_level:_0x2c3c46,prod_isle:_0x1701af,prod_pallet:_0x30c868,note:_0xf8946b,expiry_date:_0x4cb987,batch_code:_0x1e6075,paid_amount:_0x48c6bf,due_amount:_0x58b786,Room_name:_0x3df435,primary_code:_0x3bdf93,secondary_code:_0x17095d,PO_number:_0x525cbc,JO_number:_0x52ba96}=_0x2efe1b[_0x502c31(0x157)];if(typeof _0x5b85bf=='string')var _0x497e2d=[_0x2efe1b[_0x502c31(0x157)][_0x502c31(0x14a)]],_0x497cbe=[_0x2efe1b['body']['prod_code']],_0x2b2950=[_0x2efe1b['body'][_0x502c31(0x18b)]],_0x496d5e=[_0x2efe1b[_0x502c31(0x157)][_0x502c31(0x131)]],_0xb568c6=[_0x2efe1b['body'][_0x502c31(0x190)]],_0x2dca09=[_0x2efe1b[_0x502c31(0x157)][_0x502c31(0x10f)]],_0x428d2b=[_0x2efe1b[_0x502c31(0x157)][_0x502c31(0x1b9)]],_0x49da6d=[_0x2efe1b[_0x502c31(0x157)][_0x502c31(0xe0)]],_0x1f20ae=[_0x2efe1b[_0x502c31(0x157)][_0x502c31(0x1ca)]],_0x23401b=[_0x2efe1b[_0x502c31(0x157)]['batch_code']],_0x1650ac=[_0x2efe1b[_0x502c31(0x157)][_0x502c31(0x12a)]];else var _0x497e2d=[..._0x2efe1b[_0x502c31(0x157)][_0x502c31(0x14a)]],_0x497cbe=[..._0x2efe1b[_0x502c31(0x157)][_0x502c31(0x14c)]],_0x2b2950=[..._0x2efe1b[_0x502c31(0x157)][_0x502c31(0x18b)]],_0x496d5e=[..._0x2efe1b['body']['prod_unit']],_0xb568c6=[..._0x2efe1b['body']['prod_secondunit']],_0x2dca09=[..._0x2efe1b[_0x502c31(0x157)][_0x502c31(0x10f)]],_0x428d2b=[..._0x2efe1b[_0x502c31(0x157)][_0x502c31(0x1b9)]],_0x49da6d=[..._0x2efe1b[_0x502c31(0x157)][_0x502c31(0xe0)]],_0x1f20ae=[..._0x2efe1b[_0x502c31(0x157)][_0x502c31(0x1ca)]],_0x23401b=[..._0x2efe1b[_0x502c31(0x157)][_0x502c31(0x13a)]],_0x1650ac=[..._0x2efe1b['body'][_0x502c31(0x12a)]];const _0x108983=_0x497e2d[_0x502c31(0x1b0)](_0x5b0dab=>{return _0x5b0dab={'product_name':_0x5b0dab};});_0x497cbe[_0x502c31(0x163)]((_0x37d55f,_0x56c34d)=>{var _0x8e5903=_0x502c31;_0x108983[_0x56c34d][_0x8e5903(0x185)]=_0x37d55f;}),_0x2b2950[_0x502c31(0x163)]((_0x44581d,_0x44fd5d)=>{var _0x1fceda=_0x502c31;_0x108983[_0x44fd5d][_0x1fceda(0x1c3)]=_0x44581d;}),_0x496d5e[_0x502c31(0x163)]((_0x3546ca,_0x4d781f)=>{var _0x5ea008=_0x502c31;_0x108983[_0x4d781f][_0x5ea008(0xdb)]=_0x3546ca;}),_0xb568c6[_0x502c31(0x163)]((_0x4f7315,_0x5c689d)=>{var _0x5d0000=_0x502c31;_0x108983[_0x5c689d][_0x5d0000(0x1b4)]=_0x4f7315;}),_0x2dca09['forEach']((_0x432f39,_0x5b5037)=>{var _0xf5fe58=_0x502c31;_0x108983[_0x5b5037][_0xf5fe58(0x1b5)]=_0x432f39;}),_0x428d2b['forEach']((_0x417ca1,_0x57aa38)=>{_0x108983[_0x57aa38]['primary_code']=_0x417ca1;}),_0x49da6d[_0x502c31(0x163)]((_0x30cbf3,_0x21e548)=>{_0x108983[_0x21e548]['secondary_code']=_0x30cbf3;}),_0x1f20ae[_0x502c31(0x163)]((_0x396784,_0x4efce7)=>{_0x108983[_0x4efce7]['maxStocks']=_0x396784;}),_0x23401b[_0x502c31(0x163)]((_0x218491,_0x13e75e)=>{var _0x590430=_0x502c31;_0x108983[_0x13e75e][_0x590430(0x13a)]=_0x218491;}),_0x1650ac[_0x502c31(0x163)]((_0xa0e025,_0x4f0d6c)=>{var _0x77fd66=_0x502c31;_0x108983[_0x4f0d6c][_0x77fd66(0x12a)]=_0xa0e025;});const _0x54de45=_0x108983[_0x502c31(0x134)](_0x25a3b6=>_0x25a3b6[_0x502c31(0x1c3)]!=='0'&&_0x25a3b6[_0x502c31(0x1c3)]!=='');_0x264c98['invoice']=_0x4f431e,_0x264c98[_0x502c31(0x1ab)]=_0x17d548,_0x264c98[_0x502c31(0xfe)]=_0x5523ac,_0x264c98[_0x502c31(0x11a)]=_0x7892a4,_0x264c98[_0x502c31(0x12c)]=_0x54de45,_0x264c98['note']=_0xf8946b,_0x264c98[_0x502c31(0x1a4)]=_0x48c6bf,_0x264c98[_0x502c31(0xed)]=_0x58b786,_0x264c98[_0x502c31(0x19f)]=_0x3df435,_0x264c98[_0x502c31(0x168)]=_0x525cbc,_0x264c98[_0x502c31(0x179)]=_0x52ba96;const _0x296769=await _0x264c98[_0x502c31(0x13e)](),_0x1598e9=await warehouse[_0x502c31(0x15e)]({'name':_0x2efe1b['body'][_0x502c31(0x11a)],'room':_0x2efe1b[_0x502c31(0x157)][_0x502c31(0x1b8)]});_0x264c98[_0x502c31(0x12c)][_0x502c31(0x163)](_0xbe36de=>{var _0x2507f1=_0x502c31,_0xaaebf=0x0;const _0x1f5bff=_0x1598e9['product_details'][_0x2507f1(0x1b0)](_0x193d93=>{var _0x3bb633=_0x2507f1;_0x193d93['product_name']==_0xbe36de[_0x3bb633(0x1be)]&&_0x193d93[_0x3bb633(0x1b5)]==_0xbe36de[_0x3bb633(0x1b5)]&&(_0x193d93[_0x3bb633(0x12d)]=parseInt(_0x193d93['product_stock'])+parseInt(_0xbe36de['quantity']),_0xaaebf++);});_0xaaebf=='0'&&(_0x1598e9[_0x2507f1(0x16c)]=_0x1598e9[_0x2507f1(0x16c)]['concat']({'product_name':_0xbe36de[_0x2507f1(0x1be)],'product_stock':_0xbe36de[_0x2507f1(0x1c3)],'primary_code':_0xbe36de[_0x2507f1(0x1b9)],'secondary_code':_0xbe36de[_0x2507f1(0xe0)],'product_code':_0xbe36de[_0x2507f1(0x185)],'bay':_0xbe36de[_0x2507f1(0x1b5)],'maxProducts':_0xbe36de[_0x2507f1(0xda)],'unit':_0xbe36de[_0x2507f1(0xdb)],'secondary_unit':_0xbe36de[_0x2507f1(0x1b4)],'expiry_date':_0xbe36de[_0x2507f1(0x12a)]}));}),await _0x1598e9[_0x502c31(0x13e)]();const _0x16eaca=await s_payment_data[_0x502c31(0x15e)]({'invoice':_0x2efe1b[_0x502c31(0x157)][_0x502c31(0x1a1)]});if(_0x16eaca===null){}else console[_0x502c31(0x18c)](_0x502c31(0x1ab),_0x16eaca,_0x2efe1b[_0x502c31(0x157)][_0x502c31(0x1a1)]),_0x16eaca[_0x502c31(0x1ab)]=_0x2efe1b['body']['suppliers'],await _0x16eaca['save']();_0x2efe1b['flash']('success',_0x502c31(0xec)),_0x74ec5[_0x502c31(0x135)](_0x502c31(0x129));}catch(_0x2eb9ad){console[_0x502c31(0x18c)](_0x2eb9ad);}}),router[a0_0x3e3a3c(0x12e)](a0_0x3e3a3c(0x103),auth,async(_0x470b67,_0x5213de)=>{var _0x9ed211=a0_0x3e3a3c;try{const _0x1d6424=_0x470b67['params']['id'],{invoice:_0x5aa753,suppliers:_0x2594aa,payable:_0x1fc44b,due_amount:_0x3c68be}=_0x470b67[_0x9ed211(0x157)],_0x47a341=await purchases[_0x9ed211(0x189)](_0x1d6424);var _0x14a019=_0x1fc44b-_0x3c68be;_0x47a341[_0x9ed211(0x1a4)]=parseFloat(_0x47a341[_0x9ed211(0x1a4)])+parseFloat(_0x3c68be),_0x47a341[_0x9ed211(0xed)]=_0x14a019;const _0x4c67d7=await _0x47a341[_0x9ed211(0x13e)]();console[_0x9ed211(0x18c)](_0x4c67d7);const _0x1d3985=await s_payment_data[_0x9ed211(0x15e)]({'invoice':_0x5aa753});_0x1d3985[_0x9ed211(0xcb)]=_0x14a019,await _0x1d3985['save']();let _0x359c6a=new Date(),_0x33d607=('0'+_0x359c6a[_0x9ed211(0x1a2)]())[_0x9ed211(0x159)](-0x2),_0xe84998=('0'+(_0x359c6a['getMonth']()+0x1))['slice'](-0x2),_0x24c438=_0x359c6a[_0x9ed211(0x1c2)](),_0x4c08ac=_0x24c438+'-'+_0xe84998+'-'+_0x33d607;const _0x5e2cab=new suppliers_payment({'invoice':_0x5aa753,'date':_0x24c438+'-'+_0xe84998+'-'+_0x33d607,'suppliers':_0x2594aa,'reason':'Paid\x20For\x20Purchase','amount':_0x3c68be}),_0x5285f7=await _0x5e2cab[_0x9ed211(0x13e)]();_0x470b67['flash'](_0x9ed211(0xe8),_0x9ed211(0x1c7)),_0x5213de[_0x9ed211(0x135)](_0x9ed211(0xe2));}catch(_0x1f3765){console[_0x9ed211(0x18c)](_0x1f3765);}}),router[a0_0x3e3a3c(0x148)](a0_0x3e3a3c(0x108),auth,async(_0x4fae2c,_0x114636)=>{var _0x5ae06c=a0_0x3e3a3c;try{const {username:_0x45abad,email:_0x23717c,role:_0xd29ef9}=_0x4fae2c[_0x5ae06c(0x194)],_0x578ea2=_0x4fae2c[_0x5ae06c(0x194)],_0x5df372=await profile[_0x5ae06c(0x15e)]({'email':_0x578ea2[_0x5ae06c(0x139)]}),_0x152326=await master_shop[_0x5ae06c(0x123)]();console[_0x5ae06c(0x18c)](_0x5ae06c(0x1c8),_0x152326);const _0x5a98d8=_0x4fae2c[_0x5ae06c(0x191)]['id'],_0x45b03f=await purchases['findById'](_0x5a98d8);console['log'](_0x45b03f);const _0x4de017=await suppliers[_0x5ae06c(0x15e)]({'name':_0x45b03f[_0x5ae06c(0x1ab)]});console['log'](_0x4de017);if(_0x152326[0x0][_0x5ae06c(0xeb)]==_0x5ae06c(0x10c)){var _0x35c444=users[_0x5ae06c(0xe3)];console['log'](_0x35c444);}else{if(_0x152326[0x0][_0x5ae06c(0xeb)]==_0x5ae06c(0x173))var _0x35c444=users[_0x5ae06c(0x173)];else{if(_0x152326[0x0][_0x5ae06c(0xeb)]==_0x5ae06c(0x121))var _0x35c444=users['German'];else{if(_0x152326[0x0][_0x5ae06c(0xeb)]=='Spanish')var _0x35c444=users[_0x5ae06c(0x158)];else{if(_0x152326[0x0][_0x5ae06c(0xeb)]==_0x5ae06c(0x1bb))var _0x35c444=users[_0x5ae06c(0x1bb)];else{if(_0x152326[0x0][_0x5ae06c(0xeb)]==_0x5ae06c(0x13c))var _0x35c444=users[_0x5ae06c(0x140)];else{if(_0x152326[0x0]['language']==_0x5ae06c(0x1b7))var _0x35c444=users[_0x5ae06c(0x1b7)];else{if(_0x152326[0x0][_0x5ae06c(0xeb)]==_0x5ae06c(0xd9))var _0x35c444=users[_0x5ae06c(0x1ad)];}}}}}}}_0x114636[_0x5ae06c(0x1c1)]('purchase_invoice',{'success':_0x4fae2c[_0x5ae06c(0x133)](_0x5ae06c(0xe8)),'errors':_0x4fae2c[_0x5ae06c(0x133)](_0x5ae06c(0x1bf)),'role':_0x578ea2,'profile':_0x5df372,'master_shop':_0x152326,'supplier':_0x4de017,'purchase':_0x45b03f,'language':_0x35c444});}catch(_0x220d65){console[_0x5ae06c(0x18c)](_0x220d65);}}),router[a0_0x3e3a3c(0x148)]('/view/return_purchase/:id',auth,async(_0x5176a6,_0x21775f)=>{var _0x5e1899=a0_0x3e3a3c;try{const {username:_0x391599,email:_0x543d99,role:_0x56b6b5}=_0x5176a6[_0x5e1899(0x194)],_0x407203=_0x5176a6[_0x5e1899(0x194)],_0x535984=await profile[_0x5e1899(0x15e)]({'email':_0x407203['email']}),_0x477abd=await master_shop[_0x5e1899(0x123)]();console[_0x5e1899(0x18c)](_0x5e1899(0x1c8),_0x477abd);const _0x23cad7=_0x5176a6[_0x5e1899(0x191)]['id'];console[_0x5e1899(0x18c)](_0x23cad7);const _0x3eb947=await purchases_finished['findById'](_0x23cad7);console[_0x5e1899(0x18c)](_0x5e1899(0x124),_0x3eb947);const _0x2dfb83=await product['find']({}),_0x459090=await warehouse[_0x5e1899(0xd3)]([{'$match':{'name':_0x3eb947[_0x5e1899(0x11a)],'room':_0x3eb947[_0x5e1899(0x19f)]}},{'$unwind':_0x5e1899(0xf7)},{'$group':{'_id':_0x5e1899(0xd1),'name':{'$first':_0x5e1899(0x171)},'product_stock':{'$first':_0x5e1899(0x181)},'bay':{'$first':_0x5e1899(0x1c9)},'bin':{'$first':_0x5e1899(0x195)},'type':{'$first':_0x5e1899(0xe9)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5e1899(0x17c)},'secondary_code':{'$first':_0x5e1899(0x19e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5e1899(0xff)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x5e1899(0x18c)](_0x5e1899(0x110),_0x459090);let _0x5cf8f5;if(_0x407203['role']=='staff'){const _0x302e95=await staff[_0x5e1899(0x15e)]({'email':_0x407203[_0x5e1899(0x139)]});_0x5cf8f5=await warehouse['find']({'status':_0x5e1899(0xd5),'name':_0x302e95[_0x5e1899(0x132)],'warehouse_category':_0x5e1899(0x15d),'name':_0x5e1899(0xee)});}else _0x5cf8f5=await warehouse[_0x5e1899(0xd3)]([{'$match':{'status':_0x5e1899(0xd5),'warehouse_category':_0x5e1899(0x15d),'name':_0x5e1899(0xee)}},{'$group':{'_id':_0x5e1899(0xcd),'name':{'$first':'$name'}}}]);if(_0x477abd[0x0][_0x5e1899(0xeb)]==_0x5e1899(0x10c)){var _0xc3e3d5=users[_0x5e1899(0xe3)];console[_0x5e1899(0x18c)](_0xc3e3d5);}else{if(_0x477abd[0x0][_0x5e1899(0xeb)]==_0x5e1899(0x173))var _0xc3e3d5=users['Hindi'];else{if(_0x477abd[0x0][_0x5e1899(0xeb)]==_0x5e1899(0x121))var _0xc3e3d5=users['German'];else{if(_0x477abd[0x0][_0x5e1899(0xeb)]=='Spanish')var _0xc3e3d5=users[_0x5e1899(0x158)];else{if(_0x477abd[0x0]['language']==_0x5e1899(0x1bb))var _0xc3e3d5=users[_0x5e1899(0x1bb)];else{if(_0x477abd[0x0][_0x5e1899(0xeb)]=='Portuguese\x20(BR)')var _0xc3e3d5=users['Portuguese'];else{if(_0x477abd[0x0][_0x5e1899(0xeb)]==_0x5e1899(0x1b7))var _0xc3e3d5=users[_0x5e1899(0x1b7)];else{if(_0x477abd[0x0]['language']==_0x5e1899(0xd9))var _0xc3e3d5=users[_0x5e1899(0x1ad)];}}}}}}}_0x21775f[_0x5e1899(0x1c1)](_0x5e1899(0x155),{'success':_0x5176a6[_0x5e1899(0x133)](_0x5e1899(0xe8)),'errors':_0x5176a6['flash'](_0x5e1899(0x1bf)),'role':_0x407203,'profile':_0x535984,'user':_0x3eb947,'stock':_0x459090,'master_shop':_0x477abd,'product':_0x2dfb83,'language':_0xc3e3d5,'warehouse':_0x5cf8f5});}catch(_0x37cdf6){console[_0x5e1899(0x18c)](_0x37cdf6);}}),router['post']('/view/return_purchase/:id',auth,async(_0x2497f2,_0x3bf4fb)=>{var _0xc17021=a0_0x3e3a3c;try{const {invoice:_0x249fab,date:_0x5556f2,warehouse_name:_0x587c26,Room_name:_0x20c30b,product_name:_0x2c31da,purchase_quantity:_0x5e7f73,stocks:_0x4f1f23,return_qty:_0x2cdec4,note:_0x214d04,level:_0x2d154a,isle:_0x49be15,pallet:_0x30bf8f,to_warehouse_name:_0x279315,to_Room_name:_0x5c8767}=_0x2497f2[_0xc17021(0x157)],_0x19740d=await purchases_finished[_0xc17021(0x15e)]({'_id':_0x2497f2['params']['id']}),_0x406e50=await warehouse[_0xc17021(0x15e)]({'name':_0x587c26,'room':_0x20c30b,'warehouse_category':_0xc17021(0x15d)});if(typeof _0x2c31da==_0xc17021(0xd2))var _0x4f70b3=[_0x2497f2['body'][_0xc17021(0x1be)]],_0x1a87bf=[_0x2497f2[_0xc17021(0x157)]['purchase_quantity']],_0x53f005=[_0x2497f2['body'][_0xc17021(0x15f)]],_0x1e75d6=[_0x2497f2[_0xc17021(0x157)]['return_qty']],_0xb9d269=[_0x2497f2['body'][_0xc17021(0x102)]],_0x24b8a7=[_0x2497f2[_0xc17021(0x157)]['product_code_hide']],_0x11f837=[_0x2497f2[_0xc17021(0x157)][_0xc17021(0x12b)]],_0x557d8a=[_0x2497f2['body']['secondary_code_hide']];else var _0x4f70b3=[..._0x2497f2[_0xc17021(0x157)][_0xc17021(0x1be)]],_0x1a87bf=[..._0x2497f2[_0xc17021(0x157)][_0xc17021(0x112)]],_0x53f005=[..._0x2497f2[_0xc17021(0x157)][_0xc17021(0x15f)]],_0x1e75d6=[..._0x2497f2[_0xc17021(0x157)][_0xc17021(0x188)]],_0xb9d269=[..._0x2497f2[_0xc17021(0x157)][_0xc17021(0x102)]],_0x24b8a7=[..._0x2497f2[_0xc17021(0x157)][_0xc17021(0xcc)]],_0x11f837=[..._0x2497f2[_0xc17021(0x157)][_0xc17021(0x12b)]],_0x557d8a=[..._0x2497f2[_0xc17021(0x157)]['secondary_code_hide']];const _0x21de23=_0x4f70b3[_0xc17021(0x1b0)](_0x1ce1c1=>{return _0x1ce1c1={'product_name':_0x1ce1c1};});_0x1a87bf[_0xc17021(0x163)]((_0xcc5bbe,_0xb19911)=>{var _0x4d8eb8=_0xc17021;_0x21de23[_0xb19911][_0x4d8eb8(0x112)]=_0xcc5bbe;}),_0x53f005[_0xc17021(0x163)]((_0x1e0b8e,_0x13d6d6)=>{var _0x5dc566=_0xc17021;_0x21de23[_0x13d6d6][_0x5dc566(0x18e)]=_0x1e0b8e;}),_0x1e75d6[_0xc17021(0x163)]((_0x578c40,_0x1b8bbf)=>{var _0x534731=_0xc17021;_0x21de23[_0x1b8bbf][_0x534731(0x188)]=_0x578c40;}),_0xb9d269[_0xc17021(0x163)]((_0x48c886,_0xc2823f)=>{var _0x265b17=_0xc17021;_0x21de23[_0xc2823f][_0x265b17(0x1b5)]=_0x48c886;}),_0x24b8a7[_0xc17021(0x163)]((_0x1515cf,_0x279345)=>{var _0x24b1a5=_0xc17021;_0x21de23[_0x279345][_0x24b1a5(0x185)]=_0x1515cf;}),_0x11f837['forEach']((_0x502281,_0x20b7a3)=>{var _0x3956f1=_0xc17021;_0x21de23[_0x20b7a3][_0x3956f1(0x1b9)]=_0x502281;}),_0x557d8a[_0xc17021(0x163)]((_0x303a9a,_0x1fd15d)=>{var _0x1613af=_0xc17021;_0x21de23[_0x1fd15d][_0x1613af(0xe0)]=_0x303a9a;}),_0x21de23[_0xc17021(0x163)](_0x44e744=>{var _0x1ad1af=_0xc17021;console['log'](_0x44e744);const _0x186012=_0x406e50[_0x1ad1af(0x16c)][_0x1ad1af(0x1b0)](_0x21dae3=>{var _0x385deb=_0x1ad1af;_0x21dae3[_0x385deb(0x1be)]==_0x44e744[_0x385deb(0x1be)]&&_0x21dae3[_0x385deb(0x1b5)]==_0x44e744[_0x385deb(0x1b5)]&&(console['log'](parseInt(_0x21dae3[_0x385deb(0x12d)])+_0x385deb(0x1bc)+parseInt(_0x44e744['return_qty'])),_0x21dae3[_0x385deb(0x12d)]=parseInt(_0x21dae3[_0x385deb(0x12d)])-parseInt(_0x44e744[_0x385deb(0x188)]));});}),await _0x406e50[_0xc17021(0x13e)]();var _0x25c534=0x0;_0x21de23['forEach'](_0x2abf79=>{var _0xa92c48=_0xc17021;(parseInt(_0x2abf79[_0xa92c48(0x112)])<parseInt(_0x2abf79[_0xa92c48(0x188)])||parseInt(_0x2abf79[_0xa92c48(0x18e)])<parseInt(_0x2abf79[_0xa92c48(0x188)]))&&_0x25c534++;});if(_0x25c534!=0x0)return _0x2497f2[_0xc17021(0x133)](_0xc17021(0x1bf),_0xc17021(0x149)),_0x3bf4fb[_0xc17021(0x135)](_0xc17021(0x11d));const _0x292e12=new purchases_return_finished({'invoice':_0x249fab,'suppliers':_0x2497f2['body'][_0xc17021(0x1ab)],'date':_0x5556f2,'warehouse_name':_0x587c26,'return_product':_0x21de23,'note':_0x214d04,'room':_0x20c30b,'to_warehouse_name':_0x279315,'to_room':_0x5c8767}),_0x47bd7d=await _0x292e12[_0xc17021(0x13e)](),_0x41631a=await purchases_return_finished['findOne']({'invoice':_0x249fab}),_0x41b2e5=await warehouse[_0xc17021(0x15e)]({'name':_0x279315,'room':_0x5c8767,'warehouse_category':_0xc17021(0x15d)});_0x41631a['return_product'][_0xc17021(0x163)](_0x2ad1a3=>{var _0x24c14d=_0xc17021,_0xb64351=0x0;const _0xaaaf11=_0x41b2e5[_0x24c14d(0x16c)][_0x24c14d(0x1b0)](_0x32998a=>{var _0x3d8cff=_0x24c14d;console['log'](_0x32998a[_0x3d8cff(0x1be)]+'=='+_0x2ad1a3[_0x3d8cff(0x1be)]+'&&'+_0x32998a[_0x3d8cff(0x1b5)]+'=='+_0x2ad1a3[_0x3d8cff(0x1b5)]),_0x32998a[_0x3d8cff(0x1be)]==_0x2ad1a3[_0x3d8cff(0x1be)]&&_0x32998a[_0x3d8cff(0x1b5)]==_0x2ad1a3[_0x3d8cff(0x1b5)]&&(_0x32998a['product_stock']=parseInt(_0x32998a[_0x3d8cff(0x12d)])-parseInt(_0x2ad1a3['return_qty']),_0xb64351++);});_0xb64351=='0'&&(_0x41b2e5[_0x24c14d(0x16c)]=_0x41b2e5[_0x24c14d(0x16c)]['concat']({'product_name':_0x2ad1a3[_0x24c14d(0x1be)],'product_stock':_0x2ad1a3[_0x24c14d(0x188)],'primary_code':_0x2ad1a3['primary_code'],'secondary_code':_0x2ad1a3['secondary_code'],'product_code':_0x2ad1a3[_0x24c14d(0x185)],'bay':_0x2ad1a3[_0x24c14d(0x1b5)],'maxProducts':0xf423f}));}),await _0x41b2e5['save']();const _0x6a0d64=await purchases_finished[_0xc17021(0x15e)]({'invoice':_0x249fab});_0x6a0d64[_0xc17021(0x17f)]=_0xc17021(0x176);const _0x3965d4=await _0x6a0d64['save'](),_0x3ffbcd=new s_payment_data({'invoice':_0x249fab,'suppliers':_0x2497f2[_0xc17021(0x157)]['suppliers'],'reason':'Purchase\x20Return'});await _0x3ffbcd['save']();const _0x3c7e10=await master_shop[_0xc17021(0x123)](),_0x513176=await email_settings[_0xc17021(0x15e)](),_0x33f402=await suppliers[_0xc17021(0x15e)]({'name':_0x2497f2[_0xc17021(0x157)][_0xc17021(0x1ab)]});_0x3c7e10[0x0][_0xc17021(0x147)]==0x1?(right_currency=_0x3c7e10[0x0][_0xc17021(0x1b3)],left_currency=''):(right_currency='',left_currency=_0x3c7e10[0x0][_0xc17021(0x1b3)]);var _0x13ff02=_0x4f70b3,_0x408534=_0x1e75d6,_0xcf8096='',_0x1e4bb0;for(_0x1e4bb0 in _0x13ff02){_0xcf8096+='<tr>'+_0xc17021(0x1b1)+_0x13ff02[_0x1e4bb0]+_0xc17021(0x115)+_0xc17021(0x1b1)+_0x408534[_0x1e4bb0]+_0xc17021(0x115)+_0xc17021(0xef);}let _0x55fce3=nodemailer[_0xc17021(0x1aa)]({'service':_0xc17021(0xce),'auth':{'user':_0x513176['email'],'pass':_0x513176[_0xc17021(0x10e)]}}),_0x1dba7d={'from':_0x513176[_0xc17021(0x139)],'to':_0x33f402[_0xc17021(0x139)],'subject':_0xc17021(0x1c6),'attachments':[{'filename':_0xc17021(0x154),'path':__dirname+_0xc17021(0x180)+'/upload/'+_0x3c7e10[0x0][_0xc17021(0x130)],'cid':_0xc17021(0x169)}],'html':_0xc17021(0xe1)+_0xc17021(0x11c)+_0xc17021(0x1a6)+_0xc17021(0x198)+_0xc17021(0x13b)+_0xc17021(0x198)+_0xc17021(0x18d)+_0xc17021(0x192)+_0xc17021(0x198)+_0xc17021(0x105)+_0x3c7e10[0x0][_0xc17021(0x14d)]+'\x20</h2>'+_0xc17021(0x192)+'</div>'+_0xc17021(0x166)+_0xc17021(0x198)+_0xc17021(0x178)+_0xc17021(0x119)+_0x249fab+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0xc17021(0x1a3)+_0x5556f2+'\x20'+_0xc17021(0x143)+_0xc17021(0xe4)+_0xc17021(0x192)+_0xc17021(0x199)+_0xc17021(0x13d)+_0xc17021(0xfa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xc17021(0x196)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xcf8096+'\x20'+_0xc17021(0xf1)+_0xc17021(0xcf)+_0xc17021(0x198)+_0xc17021(0xf0)+'<h5>'+_0x3c7e10[0x0][_0xc17021(0x14d)]+_0xc17021(0xe4)+'</div>'+'</div>'+'</body></html>'};_0x55fce3[_0xc17021(0x14b)](_0x1dba7d,function(_0x3e847c,_0x4868f2){var _0x2e8048=_0xc17021;_0x3e847c?console['log'](_0x2e8048(0x1a7)):console[_0x2e8048(0x18c)]('Email\x20sent\x20successfully');}),_0x2497f2[_0xc17021(0x133)]('success',_0xc17021(0xfb)),_0x3bf4fb[_0xc17021(0x135)](_0xc17021(0x129));}catch(_0x59412a){_0x3bf4fb[_0xc17021(0x106)](0xc8)[_0xc17021(0x170)]({'message':_0x59412a[_0xc17021(0xe7)]});}}),router[a0_0x3e3a3c(0x148)](a0_0x3e3a3c(0x111),auth,async(_0x43d336,_0x55723c)=>{var _0x323b39=a0_0x3e3a3c;try{const {username:_0x7c285f,email:_0x313b63,role:_0x237b31}=_0x43d336[_0x323b39(0x194)],_0x21b4b2=_0x43d336[_0x323b39(0x194)],_0x1c3389=await profile[_0x323b39(0x15e)]({'email':_0x21b4b2[_0x323b39(0x139)]}),_0x19d957=await master_shop['find'](),_0x2dfcc1=_0x43d336[_0x323b39(0x191)]['id'],_0x55438f=await purchases_finished[_0x323b39(0x189)](_0x2dfcc1);if(_0x19d957[0x0][_0x323b39(0xeb)]=='English\x20(US)')var _0x5e93a6=users[_0x323b39(0xe3)];else{if(_0x19d957[0x0][_0x323b39(0xeb)]==_0x323b39(0x173))var _0x5e93a6=users[_0x323b39(0x173)];else{if(_0x19d957[0x0][_0x323b39(0xeb)]=='German')var _0x5e93a6=users[_0x323b39(0x121)];else{if(_0x19d957[0x0][_0x323b39(0xeb)]==_0x323b39(0x158))var _0x5e93a6=users[_0x323b39(0x158)];else{if(_0x19d957[0x0][_0x323b39(0xeb)]==_0x323b39(0x1bb))var _0x5e93a6=users['French'];else{if(_0x19d957[0x0][_0x323b39(0xeb)]==_0x323b39(0x13c))var _0x5e93a6=users[_0x323b39(0x140)];else{if(_0x19d957[0x0]['language']==_0x323b39(0x1b7))var _0x5e93a6=users['Chinese'];else{if(_0x19d957[0x0][_0x323b39(0xeb)]==_0x323b39(0xd9))var _0x5e93a6=users['Arabic'];}}}}}}}_0x55723c['render']('all_purchases_barcode',{'success':_0x43d336[_0x323b39(0x133)](_0x323b39(0xe8)),'errors':_0x43d336[_0x323b39(0x133)](_0x323b39(0x1bf)),'role':_0x21b4b2,'profile':_0x1c3389,'alldata':_0x55438f,'master_shop':_0x19d957,'language':_0x5e93a6}),console[_0x323b39(0x18c)](alldata);}catch(_0xd5a85b){console['log'](_0xd5a85b);}}),router['post'](a0_0x3e3a3c(0x15b),async(_0x4fb1b6,_0x6a46cb)=>{var _0x3e255f=a0_0x3e3a3c;const {product_code:_0x2d8d8b}=_0x4fb1b6[_0x3e255f(0x157)];var _0x443c07;const _0x1fb368=await product['aggregate']([{'$match':{'primary_code':_0x2d8d8b,'product_category':_0x3e255f(0x15d)}},{'$group':{'_id':_0x3e255f(0x1af),'name':{'$first':'$name'},'category':{'$first':_0x3e255f(0x16d)},'brand':{'$first':_0x3e255f(0x172)},'unit':{'$first':_0x3e255f(0xd7)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x3e255f(0x11f)},'maxProdPerUnit':{'$first':_0x3e255f(0x1a0)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3e255f(0x1cb)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x585cc9=await product[_0x3e255f(0xd3)]([{'$match':{'secondary_code':_0x2d8d8b}},{'$group':{'_id':_0x3e255f(0x1af),'name':{'$first':_0x3e255f(0xcd)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x3e255f(0xd7)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3e255f(0xd4)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x3e255f(0x118)},'maxStocks':{'$first':_0x3e255f(0x11f)},'maxProdPerUnit':{'$first':_0x3e255f(0x1a0)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3e255f(0x1cb)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1fb368[_0x3e255f(0x152)]>0x0)_0x443c07=_0x1fb368;else _0x585cc9['length']>0x0&&(_0x443c07=_0x585cc9);_0x6a46cb[_0x3e255f(0x170)](_0x443c07);}),router['post'](a0_0x3e3a3c(0x1a8),async(_0x5154cd,_0x5add41)=>{var _0xd20001=a0_0x3e3a3c;const {productCode:_0x45bc70,bay:_0x4dea63,warehouses:_0x1119e1,room:_0x12d32e}=_0x5154cd['body'];console['log'](_0x5154cd[_0xd20001(0x157)]);try{const _0x12b248=await warehouse[_0xd20001(0xd3)]([{'$match':{'name':_0x1119e1,'room':_0x12d32e}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x4dea63)}},{'$group':{'_id':_0xd20001(0xd1),'name':{'$first':_0xd20001(0x171)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xd20001(0x1c9)},'maxProducts':{'$first':_0xd20001(0x136)}}}]);_0x5add41[_0xd20001(0x106)](0xc8)[_0xd20001(0x170)](_0x12b248);}catch(_0x522d5d){_0x5add41[_0xd20001(0x106)](0x194)[_0xd20001(0x170)]({'message':_0x522d5d['message']});}}),module[a0_0x3e3a3c(0xf5)]=router;