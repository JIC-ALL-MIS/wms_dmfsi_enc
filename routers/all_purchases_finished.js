var a0_0x410a36=a0_0x4a4b;(function(_0x417456,_0x27b41d){var _0x534f5f=a0_0x4a4b,_0x29a892=_0x417456();while(!![]){try{var _0x739c94=parseInt(_0x534f5f(0x112))/0x1*(parseInt(_0x534f5f(0x110))/0x2)+-parseInt(_0x534f5f(0x1c6))/0x3+parseInt(_0x534f5f(0x134))/0x4*(-parseInt(_0x534f5f(0x12e))/0x5)+parseInt(_0x534f5f(0x141))/0x6+-parseInt(_0x534f5f(0x1ad))/0x7*(-parseInt(_0x534f5f(0x1ea))/0x8)+parseInt(_0x534f5f(0x1b1))/0x9*(-parseInt(_0x534f5f(0x1b7))/0xa)+parseInt(_0x534f5f(0x1ce))/0xb;if(_0x739c94===_0x27b41d)break;else _0x29a892['push'](_0x29a892['shift']());}catch(_0x554046){_0x29a892['push'](_0x29a892['shift']());}}}(a0_0x505e,0x1a4ed));const express=require(a0_0x410a36(0x1ba)),app=express(),router=express[a0_0x410a36(0x1a7)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x410a36(0x124)),auth=require(a0_0x410a36(0x173)),nodemailer=require(a0_0x410a36(0x165));function a0_0x4a4b(_0x2b95d0,_0x4d9413){var _0x505ea2=a0_0x505e();return a0_0x4a4b=function(_0x4a4b91,_0x51ced7){_0x4a4b91=_0x4a4b91-0x107;var _0x407583=_0x505ea2[_0x4a4b91];return _0x407583;},a0_0x4a4b(_0x2b95d0,_0x4d9413);}var ejs=require(a0_0x410a36(0x111));function a0_0x505e(){var _0x4f92dc=['warehouse_name','358659MAVzfr','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','flash','logo','$maxProdPerUnit','exports','currency','all_purchases_barcode','2713667yLiwUZ','port','Rack\x201','/give_payment/:id','product','True','prod_level','$name','Purchase\x20Mail','password','return_purchase_finished','$product','post','quantity','$product.quantity','Chinese','currency_placement','Finished\x20Goods','prod_secondunit','$note','$product_details.secondary_code','$category','getDate','stock_quantity','maxStocks','An\x20error\x20occurred.','$maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','968XYqeBe','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','primary_code_hide','forEach','Purchase\x20Return','language','English\x20(US)','$secondary_code','FGSEmail','$product.floorlevel','warehouse','Return\x20Goods','$product_details._id','Paid\x20For\x20Purchase','errors','product_date','product_cat','body','prod_unit','filter','date','prod_qty','$product_code','$return_data','/barcode_scanner','Arabic','prod_code','$product_details.bin','due_amount','Enabled','/all_purchases_finished/view','136CLhPhY','ejs','214GgfXMk','POnumber','RoomAssign','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','product_details','product_code_hide','/CheckingWarehouse','</tr>','all_purchases_finished','$suppliers','French','Arabic\x20(ae)','primary_code','slice','return_data','product_code','batch_code','../models/all_models','$product.type','Email\x20sent\x20successfully','<tbody\x20style=\x22text-align:\x20center;\x22>','catch','<strong>\x20Regards\x20</strong>','map','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</thead>','secondary_code','862985fuuKzj','\x20</h2>','German','$secondary_unit','$product_details','Hindi','4wfFMjz','message','Error\x20Occurs','$primary_code','stock_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/preview/:id','image','Portuguese\x20(BR)','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','success','sendMail','$expiry_date','778752XjdGpN','_id','secondary_unit','find','return_qty','production_date','path','gmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$unit','user','concat','<hr\x20class=\x22my-3\x22>','paid_amount','$batch_code','note','padStart','json','\x20<>\x20','render','product_stock','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/upload/','<h2>\x20','payment\x20successfull','Portuguese','<h5>','$product.bay','/all_purchases/view','then','standard_unit','INCF-','purchase\x20data\x20update\x20successfully','prod_Qty','room_name','secondary_code_hide','nodemailer','getFullYear','toString','level','prod_primunit','$suppliers_docs','$_id','FROZEN\x20GOODS','<div>','</body></html>','findById','master','room','add_purchases\x20error','../middleware/auth','/view/add_purchases','MaxStocks_data','English','$product_details.product_name','edit_purchases_finished','purchase_quantity','host','stocks','<tr>','$due_amount','role','$alertquantity','product_name','suppliers','table\x20page','$product_details.product_stock','$product_details.product_code','all','$product.bin','aggregate','<!DOCTYPE\x20html>','Rack\x202','save','</tbody>','$invoice','prod_cat','\x20Order\x20Date\x20:\x20','length','</span>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/view/return_purchase/:id','</td>','redirect','string','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','site_title','</table>','purchase_invoice','<html><head><title></title>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','log','$paid_amount','params','QA\x20Warehouse','max_product_unit','$product.room_name','$product_details.bay','$date','get','Router','getMonth','Room_name','bay','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','11039GvlsMH','$product_details.rack','add_purchases_finished','invoice','233937VUNDng','Enclosed','email','purchases\x20item\x20return\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</h5>','70iHrhJW','Logo.png','suppliers_docs','express','$product_details.storage','\x20Order\x20Number\x20:\x20','error','expiry_date','<h5\x20style=\x22text-align:\x20left;\x22>','</div>','prod_name','findOne','$brand','Spanish'];a0_0x505e=function(){return _0x4f92dc;};return a0_0x505e();}const path=require(a0_0x410a36(0x147)),users=require('../public/language/languages.json');router[a0_0x410a36(0x1a6)]('/view',auth,async(_0x579b43,_0x4387c7)=>{var _0x521a89=a0_0x410a36;try{const {username:_0x470145,email:_0x1e0a75,role:_0x565282}=_0x579b43[_0x521a89(0x14b)],_0x22e984=_0x579b43[_0x521a89(0x14b)],_0x5ecff3=await profile[_0x521a89(0x1c2)]({'email':_0x22e984[_0x521a89(0x1b3)]}),_0x2229a7=await staff['findOne']({'email':_0x22e984[_0x521a89(0x1b3)]});if(_0x22e984['role']==_0x521a89(0x197)){const _0x2445e5=await staff[_0x521a89(0x1c2)]({'email':_0x22e984[_0x521a89(0x1b3)]});}const _0x1c964e=await master_shop[_0x521a89(0x144)]();let _0x40ab7d;if(_0x22e984[_0x521a89(0x17e)]==_0x521a89(0x197)){const _0x378e02=await staff[_0x521a89(0x1c2)]({'email':_0x22e984[_0x521a89(0x1b3)]});_0x40ab7d=await purchases_finished[_0x521a89(0x187)]([{'$match':{'warehouse_name':_0x378e02[_0x521a89(0x1f6)]}},{'$lookup':{'from':_0x521a89(0x181),'localField':'suppliers','foreignField':'name','as':_0x521a89(0x1b9)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x521a89(0x16b),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x521a89(0x11c)},'date':{'$first':_0x521a89(0x1a5)},'warehouse_name':{'$first':_0x521a89(0x115)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x521a89(0x19f)},'due_amount':{'$first':_0x521a89(0x17d)},'return_data':{'$first':_0x521a89(0x108)},'batch_code':{'$first':_0x521a89(0x14f)},'expiry_date':{'$first':_0x521a89(0x140)},'suppliers_docs':{'$first':_0x521a89(0x16a)},'total_product_quantity':{'$sum':_0x521a89(0x1dc)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x521a89(0x186)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x40ab7d=await purchases_finished[_0x521a89(0x187)]([{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x521a89(0x18c)},'suppliers':{'$first':_0x521a89(0x11c)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x521a89(0x1a3)},'product':{'$push':_0x521a89(0x1d9)},'note':{'$first':_0x521a89(0x1e1)},'paid_amount':{'$first':_0x521a89(0x19f)},'due_amount':{'$first':_0x521a89(0x17d)},'return_data':{'$first':_0x521a89(0x108)},'batch_code':{'$first':_0x521a89(0x14f)},'expiry_date':{'$first':_0x521a89(0x140)},'suppliers_docs':{'$first':_0x521a89(0x16a)},'total_product_quantity':{'$sum':_0x521a89(0x1dc)},'level':{'$addToSet':_0x521a89(0x15c)},'isle':{'$addToSet':_0x521a89(0x186)},'type':{'$addToSet':_0x521a89(0x125)},'floorlevel':{'$addToSet':_0x521a89(0x1f5)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x1c964e[0x0][_0x521a89(0x1f1)]==_0x521a89(0x1f2))var _0x1f3db9=users[_0x521a89(0x176)];else{if(_0x1c964e[0x0]['language']=='Hindi')var _0x1f3db9=users[_0x521a89(0x133)];else{if(_0x1c964e[0x0]['language']==_0x521a89(0x130))var _0x1f3db9=users[_0x521a89(0x130)];else{if(_0x1c964e[0x0][_0x521a89(0x1f1)]==_0x521a89(0x1c4))var _0x1f3db9=users[_0x521a89(0x1c4)];else{if(_0x1c964e[0x0]['language']=='French')var _0x1f3db9=users[_0x521a89(0x11d)];else{if(_0x1c964e[0x0][_0x521a89(0x1f1)]==_0x521a89(0x13c))var _0x1f3db9=users[_0x521a89(0x15a)];else{if(_0x1c964e[0x0][_0x521a89(0x1f1)]==_0x521a89(0x1dd))var _0x1f3db9=users[_0x521a89(0x1dd)];else{if(_0x1c964e[0x0]['language']==_0x521a89(0x11e))var _0x1f3db9=users[_0x521a89(0x10a)];}}}}}}}_0x4387c7['render'](_0x521a89(0x11b),{'success':_0x579b43[_0x521a89(0x1c8)](_0x521a89(0x13e)),'errors':_0x579b43[_0x521a89(0x1c8)](_0x521a89(0x1fa)),'purchases':_0x40ab7d,'role':_0x22e984,'profile':_0x5ecff3,'master_shop':_0x1c964e,'language':_0x1f3db9});}catch(_0x12840c){console[_0x521a89(0x19e)](_0x521a89(0x182),_0x12840c),_0x4387c7[_0x521a89(0x1ab)](0xc8)[_0x521a89(0x152)]({'message':_0x12840c[_0x521a89(0x135)]});}});function BayBinSelected(_0x35ef8c,_0x17105b){var _0x128ad0=a0_0x410a36,_0x28d73c=[],_0x384728=[];if(_0x35ef8c=='DRY\x20GOODS'){switch(_0x17105b){case _0x128ad0(0x1d0):_0x28d73c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x128ad0(0x189):_0x28d73c=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x384728=['DG'];}else{if(_0x35ef8c==_0x128ad0(0x16c)){switch(_0x17105b){case _0x128ad0(0x1d0):_0x28d73c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x128ad0(0x189):_0x28d73c=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x384728=['FG'];}}return{'levels':_0x28d73c,'identify':_0x384728};}async function getRandom8DigitNumber(){var _0x544624=a0_0x410a36;const _0x177a0e=0x989680,_0x2d1a5a=0x5f5e0ff,_0x356d4a=Math[_0x544624(0x1eb)](Math['random']()*(_0x2d1a5a-_0x177a0e+0x1))+_0x177a0e;var _0x1d78c0;const _0x443ec3=await purchases_finished[_0x544624(0x1c2)]({'invoice':_0x544624(0x160)+_0x356d4a});return _0x443ec3&&_0x443ec3['length']>0x0?_0x1d78c0=_0x544624(0x160)+_0x356d4a:_0x1d78c0='INCF-'+_0x356d4a,_0x1d78c0;}router['get'](a0_0x410a36(0x174),auth,async(_0x497cb0,_0xef25b0)=>{var _0x3f0ca5=a0_0x410a36;try{const {username:_0x15ca39,email:_0x2acedd,role:_0x305182}=_0x497cb0[_0x3f0ca5(0x14b)],_0x3f2f2a=_0x497cb0[_0x3f0ca5(0x14b)],_0x140046=await profile[_0x3f0ca5(0x1c2)]({'email':_0x3f2f2a['email']}),_0x1b1850=await master_shop[_0x3f0ca5(0x144)](),_0x34ffd8=await staff[_0x3f0ca5(0x1c2)]({'email':_0x3f2f2a[_0x3f0ca5(0x1b3)]}),_0x673692=await suppliers['find']({});let _0x24679d;if(_0x3f2f2a[_0x3f0ca5(0x17e)]==_0x3f0ca5(0x197)){const _0x44c26b=await staff['findOne']({'email':_0x3f2f2a['email']});_0x24679d=await warehouse[_0x3f0ca5(0x187)]([{'$match':{'status':_0x3f0ca5(0x10e),'name':_0x44c26b[_0x3f0ca5(0x1f6)],'warehouse_category':_0x3f0ca5(0x1df)}},{'$group':{'_id':_0x3f0ca5(0x1d5),'name':{'$first':_0x3f0ca5(0x1d5)}}}]);}else _0x24679d=await warehouse[_0x3f0ca5(0x187)]([{'$match':{'status':_0x3f0ca5(0x10e),'warehouse_category':_0x3f0ca5(0x1df),'name':{'$ne':_0x3f0ca5(0x1a1)}}},{'$group':{'_id':'$name','name':{'$first':_0x3f0ca5(0x1d5)}}}]);const _0x5b1053=await product[_0x3f0ca5(0x144)]({}),_0xdebacc=await warehouse[_0x3f0ca5(0x144)]({'status':_0x3f0ca5(0x10e)}),_0x476e95=await purchases_finished[_0x3f0ca5(0x144)]({}),_0x401f00=_0x476e95[_0x3f0ca5(0x18f)]+0x1,_0x21da9f='INCF-'+_0x401f00[_0x3f0ca5(0x167)]()[_0x3f0ca5(0x151)](0x5,'0');var _0xdacb1c=['Ambient',_0x3f0ca5(0x1b2)];if(_0x1b1850[0x0][_0x3f0ca5(0x1f1)]=='English\x20(US)')var _0x36120a=users['English'];else{if(_0x1b1850[0x0][_0x3f0ca5(0x1f1)]==_0x3f0ca5(0x133))var _0x36120a=users[_0x3f0ca5(0x133)];else{if(_0x1b1850[0x0]['language']==_0x3f0ca5(0x130))var _0x36120a=users[_0x3f0ca5(0x130)];else{if(_0x1b1850[0x0][_0x3f0ca5(0x1f1)]=='Spanish')var _0x36120a=users['Spanish'];else{if(_0x1b1850[0x0][_0x3f0ca5(0x1f1)]=='French')var _0x36120a=users['French'];else{if(_0x1b1850[0x0][_0x3f0ca5(0x1f1)]==_0x3f0ca5(0x13c))var _0x36120a=users[_0x3f0ca5(0x15a)];else{if(_0x1b1850[0x0][_0x3f0ca5(0x1f1)]==_0x3f0ca5(0x1dd))var _0x36120a=users[_0x3f0ca5(0x1dd)];else{if(_0x1b1850[0x0][_0x3f0ca5(0x1f1)]==_0x3f0ca5(0x11e))var _0x36120a=users[_0x3f0ca5(0x10a)];}}}}}}}const _0x327a3e=getRandom8DigitNumber();_0x327a3e[_0x3f0ca5(0x15e)](_0x4290a4=>{var _0x41e43c=_0x3f0ca5;_0xef25b0[_0x41e43c(0x154)](_0x41e43c(0x1af),{'success':_0x497cb0[_0x41e43c(0x1c8)]('success'),'errors':_0x497cb0[_0x41e43c(0x1c8)](_0x41e43c(0x1fa)),'role':_0x3f2f2a,'profile':_0x140046,'suppliers':_0x673692,'warehouse':_0x24679d,'product':_0x5b1053,'invoice':_0x4290a4,'master_shop':_0x1b1850,'language':_0x36120a,'find_data':_0xdebacc,'rooms_data':_0xdacb1c});})[_0x3f0ca5(0x128)](_0x3f71d6=>{var _0x2fe0c5=_0x3f0ca5;_0x497cb0[_0x2fe0c5(0x1c8)](_0x2fe0c5(0x1fa),_0x2fe0c5(0x192)),_0xef25b0[_0x2fe0c5(0x195)](_0x2fe0c5(0x10f));});}catch(_0x3dfa0e){console[_0x3f0ca5(0x19e)](_0x3dfa0e);}}),router['get']('/view/add_purchases/:id',auth,async(_0x42575c,_0x560627)=>{var _0x4a7c66=a0_0x410a36;try{const _0x56e092=_0x42575c['params']['id'];console[_0x4a7c66(0x19e)](_0x56e092);const _0x2e2c09=await master_shop[_0x4a7c66(0x144)]();console[_0x4a7c66(0x19e)](_0x4a7c66(0x170),_0x2e2c09);const _0x33e0b4=await product[_0x4a7c66(0x1c2)]({'name':_0x56e092});console['log']('product',_0x33e0b4),_0x560627[_0x4a7c66(0x1ab)](0xc8)[_0x4a7c66(0x152)]({'product_data':_0x33e0b4,'master':_0x2e2c09});}catch(_0x479b40){console[_0x4a7c66(0x19e)](_0x4a7c66(0x172),_0x479b40);}}),router['post'](a0_0x410a36(0x174),auth,async(_0x3ab844,_0x27fe98)=>{var _0x3b14f4=a0_0x410a36;try{const {invoice:_0x27d980,date:_0x493ecf,warehouse_name:_0x4537f0,prod_name:_0x29cc1a,prod_code:_0x56d2c3,prod_qty:_0x4468e0,prod_unit:_0x485967,prod_secondunit:_0x4a9d57,prod_level:_0x5de046,prod_isle:_0x43c26c,prod_pallet:_0x22dc67,note:_0x190c2d,expiry_date:_0x1f270f,batch_code:_0x40fdc9,payable:_0x52c898,due_amount:_0x434af8,Room_name:_0x22c987,primary_code:_0x3be034,secondary_code:_0x533c27,MaxStocks_data:_0x192db2,PO_number:_0x4464bc,SCRN:_0x2ed0f6,JO_number:_0x177539}=_0x3ab844[_0x3b14f4(0x1fd)];if(typeof _0x29cc1a==_0x3b14f4(0x196))var _0x386826=[_0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x1c1)]],_0x2b6812=[_0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x10b)]],_0x407360=[_0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x162)]],_0x348aec=[_0x3ab844['body'][_0x3b14f4(0x169)]],_0x113783=[_0x3ab844[_0x3b14f4(0x1fd)]['prod_secondunit']],_0x265edc=[_0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x1d4)]],_0x722c3c=[_0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x11f)]],_0x50e98b=[_0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x12d)]],_0x981b66=[_0x3ab844['body'][_0x3b14f4(0x175)]],_0x50ab4e=[_0x3ab844['body'][_0x3b14f4(0x123)]],_0x3571ab=[_0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x1be)]],_0x5687ae=[_0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x1fb)]],_0x4928af=[_0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x1a2)]],_0x11290a=[_0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x18d)]],_0x48e65b=[_0x3ab844['body'][_0x3b14f4(0x114)]],_0xf7171b=[_0x3ab844[_0x3b14f4(0x1fd)]['prod_invoice']];else var _0x386826=[..._0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x1c1)]],_0x2b6812=[..._0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x10b)]],_0x407360=[..._0x3ab844['body'][_0x3b14f4(0x162)]],_0x348aec=[..._0x3ab844[_0x3b14f4(0x1fd)]['prod_primunit']],_0x113783=[..._0x3ab844['body'][_0x3b14f4(0x1e0)]],_0x265edc=[..._0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x1d4)]],_0x722c3c=[..._0x3ab844[_0x3b14f4(0x1fd)]['primary_code']],_0x50e98b=[..._0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x12d)]],_0x981b66=[..._0x3ab844['body'][_0x3b14f4(0x175)]],_0x50ab4e=[..._0x3ab844[_0x3b14f4(0x1fd)]['batch_code']],_0x3571ab=[..._0x3ab844[_0x3b14f4(0x1fd)]['expiry_date']],_0x5687ae=[..._0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x1fb)]],_0x4928af=[..._0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x1a2)]],_0x11290a=[..._0x3ab844[_0x3b14f4(0x1fd)][_0x3b14f4(0x18d)]],_0x48e65b=[..._0x3ab844['body']['RoomAssign']],_0xf7171b=[..._0x3ab844['body']['prod_invoice']];const _0x346615=_0x386826['map'](_0x18816d=>{return _0x18816d={'product_name':_0x18816d};});_0x2b6812[_0x3b14f4(0x1ef)]((_0x19de43,_0x3f4fca)=>{_0x346615[_0x3f4fca]['product_code']=_0x19de43;}),_0x407360[_0x3b14f4(0x1ef)]((_0x80e73a,_0x114dc8)=>{var _0x8ed720=_0x3b14f4;_0x346615[_0x114dc8][_0x8ed720(0x1db)]=_0x80e73a;}),_0x348aec['forEach']((_0x368054,_0x155a1a)=>{_0x346615[_0x155a1a]['standard_unit']=_0x368054;}),_0x113783[_0x3b14f4(0x1ef)]((_0x1aaa8e,_0xcc3db2)=>{var _0x21c8a9=_0x3b14f4;_0x346615[_0xcc3db2][_0x21c8a9(0x143)]=_0x1aaa8e;}),_0x265edc[_0x3b14f4(0x1ef)]((_0x15b78c,_0x2efcc7)=>{_0x346615[_0x2efcc7]['bay']=_0x15b78c;}),_0x722c3c[_0x3b14f4(0x1ef)]((_0x3b13b6,_0x47d5d6)=>{var _0x30834a=_0x3b14f4;_0x346615[_0x47d5d6][_0x30834a(0x11f)]=_0x3b13b6;}),_0x50e98b[_0x3b14f4(0x1ef)]((_0x1a5e8d,_0x4b872d)=>{var _0x4568b0=_0x3b14f4;_0x346615[_0x4b872d][_0x4568b0(0x12d)]=_0x1a5e8d;}),_0x981b66['forEach']((_0x2c9a12,_0x521300)=>{_0x346615[_0x521300]['maxStocks']=_0x2c9a12;}),_0x50ab4e[_0x3b14f4(0x1ef)]((_0x3e6d75,_0x49778e)=>{var _0x5e8b2d=_0x3b14f4;_0x346615[_0x49778e][_0x5e8b2d(0x123)]=_0x3e6d75;}),_0x3571ab['forEach']((_0x5f3e0b,_0x4b46af)=>{var _0x38eedd=_0x3b14f4;_0x346615[_0x4b46af][_0x38eedd(0x1be)]=_0x5f3e0b;}),_0x5687ae[_0x3b14f4(0x1ef)]((_0x8bb48a,_0x1bb3a9)=>{var _0x77f77b=_0x3b14f4;_0x346615[_0x1bb3a9][_0x77f77b(0x146)]=_0x8bb48a;}),_0x4928af['forEach']((_0x500515,_0x5ad0c3)=>{_0x346615[_0x5ad0c3]['maxperunit']=_0x500515;}),_0x11290a[_0x3b14f4(0x1ef)]((_0x21fd06,_0x561220)=>{var _0x17895f=_0x3b14f4;_0x346615[_0x561220][_0x17895f(0x1fc)]=_0x21fd06;}),_0x48e65b[_0x3b14f4(0x1ef)]((_0x37078a,_0x52fbcf)=>{var _0x256865=_0x3b14f4;_0x346615[_0x52fbcf][_0x256865(0x163)]=_0x37078a;}),_0xf7171b[_0x3b14f4(0x1ef)]((_0x19c1c0,_0x58f5e6)=>{var _0x5377db=_0x3b14f4;_0x346615[_0x58f5e6][_0x5377db(0x1b0)]=_0x19c1c0;});const _0x2bbd07=_0x346615[_0x3b14f4(0x1ff)](_0x1e2005=>_0x1e2005['quantity']!=='0'&&_0x1e2005[_0x3b14f4(0x1db)]!==''),_0x52c626=new purchases_finished({'invoice':_0x27d980,'suppliers':_0x3ab844[_0x3b14f4(0x1fd)]['suppliers'],'date':_0x493ecf,'warehouse_name':_0x4537f0,'product':_0x2bbd07,'note':_0x190c2d,'due_amount':_0x434af8,'room':_0x22c987,'POnumber':_0x4464bc,'SCRN':_0x2ed0f6,'JO_number':_0x177539}),_0x34afd8=await _0x52c626[_0x3b14f4(0x18a)](),_0x413481=await purchases_finished['findOne']({'invoice':_0x27d980}),_0x1252c2=_0x413481[_0x3b14f4(0x1d2)][_0x3b14f4(0x12a)](async _0x25b504=>{var _0x41ab34=_0x3b14f4,_0x4e6fc0=await warehouse[_0x41ab34(0x1c2)]({'name':_0x4537f0,'room':_0x25b504[_0x41ab34(0x163)]}),_0x2955d0=0x0;const _0x24f403=_0x4e6fc0[_0x41ab34(0x117)][_0x41ab34(0x12a)](_0x1ab723=>{var _0xf971b4=_0x41ab34;console[_0xf971b4(0x19e)](_0x1ab723[_0xf971b4(0x180)]+'=='+_0x25b504['product_name']+'&&'+_0x1ab723[_0xf971b4(0x1aa)]+'=='+_0x25b504[_0xf971b4(0x1aa)]+'&&'+_0x1ab723[_0xf971b4(0x1be)]+'=='+_0x25b504[_0xf971b4(0x1be)]+'&&'+_0x1ab723[_0xf971b4(0x146)]+'=='+_0x25b504['production_date']+'&&'+_0x1ab723['batch_code']+'=='+_0x25b504[_0xf971b4(0x123)]+'&&'+_0x1ab723[_0xf971b4(0x1b0)]+'=='+_0x413481[_0xf971b4(0x1b0)]),_0x1ab723[_0xf971b4(0x180)]==_0x25b504[_0xf971b4(0x180)]&&_0x1ab723[_0xf971b4(0x1aa)]==_0x25b504[_0xf971b4(0x1aa)]&&_0x1ab723['expiry_date']==_0x25b504[_0xf971b4(0x1be)]&&_0x1ab723[_0xf971b4(0x146)]==_0x25b504['production_date']&&_0x1ab723[_0xf971b4(0x123)]==_0x25b504['batch_code']&&_0x1ab723[_0xf971b4(0x1b0)]==_0x413481[_0xf971b4(0x1b0)]&&(_0x1ab723['product_stock']=_0x1ab723[_0xf971b4(0x155)]+_0x25b504['quantity'],_0x2955d0++);});return _0x2955d0=='0'&&(_0x4e6fc0['product_details']=_0x4e6fc0[_0x41ab34(0x117)][_0x41ab34(0x14c)]({'product_name':_0x25b504[_0x41ab34(0x180)],'product_stock':_0x25b504['quantity'],'primary_code':_0x25b504[_0x41ab34(0x11f)],'secondary_code':_0x25b504[_0x41ab34(0x12d)],'product_code':_0x25b504[_0x41ab34(0x122)],'bay':_0x25b504[_0x41ab34(0x1aa)],'maxProducts':_0x25b504[_0x41ab34(0x1e6)],'unit':_0x25b504[_0x41ab34(0x15f)],'secondary_unit':_0x25b504[_0x41ab34(0x143)],'expiry_date':_0x25b504[_0x41ab34(0x1be)],'production_date':_0x25b504[_0x41ab34(0x146)],'maxProducts':_0x25b504[_0x41ab34(0x1e6)],'maxPerUnit':_0x25b504['maxperunit'],'batch_code':_0x25b504[_0x41ab34(0x123)],'product_cat':_0x25b504[_0x41ab34(0x1fc)],'invoice':_0x25b504['invoice']})),_0x4e6fc0;});Promise[_0x3b14f4(0x185)](_0x1252c2)[_0x3b14f4(0x15e)](async _0x398aac=>{var _0xf65924=_0x3b14f4;try{for(const _0x25c2a5 of _0x398aac){await warehouse['updateOne']({'_id':_0x25c2a5[_0xf65924(0x142)]},{'$addToSet':{'product_details':{'$each':_0x25c2a5[_0xf65924(0x117)]}}});}const _0x347a72=await master_shop[_0xf65924(0x144)](),_0x46261a=await email_settings[_0xf65924(0x1c2)](),_0x38651f=await supervisor_settings['find']();var _0xb27d7e=_0x413481[_0xf65924(0x1d2)],_0x1722a1='',_0x21c79d;for(_0x21c79d in _0xb27d7e){var _0x2a4034='FG';_0x413481[_0xf65924(0x1c5)]=='DRY\x20GOODS'&&(_0x2a4034='DG'),_0x1722a1+='<tr>'+_0xf65924(0x19d)+_0xb27d7e[_0x21c79d][_0xf65924(0x180)]+_0xf65924(0x194)+_0xf65924(0x19d)+_0xb27d7e[_0x21c79d][_0xf65924(0x122)]+'</td>'+_0xf65924(0x19d)+_0xb27d7e[_0x21c79d][_0xf65924(0x1db)]+_0xf65924(0x194)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xb27d7e[_0x21c79d][_0xf65924(0x15f)]+_0xf65924(0x194)+_0xf65924(0x19d)+_0xb27d7e[_0x21c79d]['secondary_unit']+_0xf65924(0x194)+_0xf65924(0x19d)+_0x413481[_0xf65924(0x1c5)]+_0xf65924(0x194)+_0xf65924(0x19d)+_0xb27d7e[_0x21c79d]['room_name']+_0xf65924(0x194)+_0xf65924(0x19d)+_0x2a4034+_0xb27d7e[_0x21c79d]['bay']+'</td>','</tr>';}let _0x11c8bc=nodemailer['createTransport']({'host':_0x46261a[_0xf65924(0x17a)],'port':Number(_0x46261a[_0xf65924(0x1cf)]),'secure':![],'auth':{'user':_0x46261a[_0xf65924(0x1b3)],'pass':_0x46261a[_0xf65924(0x1d7)]}}),_0x16361c={'from':_0x46261a[_0xf65924(0x1b3)],'to':_0x38651f[0x0][_0xf65924(0x1f4)],'subject':_0xf65924(0x1d6),'attachments':[{'filename':_0xf65924(0x1b8),'path':__dirname+'/../public'+_0xf65924(0x157)+_0x347a72[0x0][_0xf65924(0x13b)],'cid':'logo'}],'html':_0xf65924(0x188)+_0xf65924(0x19c)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xf65924(0x16d)+_0xf65924(0x1c7)+_0xf65924(0x1c0)+_0xf65924(0x16d)+'<h2>\x20'+_0x347a72[0x0][_0xf65924(0x199)]+_0xf65924(0x12f)+_0xf65924(0x1c0)+_0xf65924(0x1c0)+'<hr\x20class=\x22my-3\x22>'+_0xf65924(0x16d)+_0xf65924(0x1bf)+'\x20Order\x20Number\x20:\x20'+_0x413481['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0xf65924(0x18e)+_0x413481[_0xf65924(0x200)]+'\x20'+_0xf65924(0x190)+_0xf65924(0x1b6)+_0xf65924(0x1c0)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xf65924(0x13d)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xf65924(0x1ac)+_0xf65924(0x198)+_0xf65924(0x1b5)+_0xf65924(0x1e9)+_0xf65924(0x116)+_0xf65924(0x139)+_0xf65924(0x191)+_0xf65924(0x11a)+_0xf65924(0x12c)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1722a1+'\x20'+_0xf65924(0x18b)+'</table>'+_0xf65924(0x16d)+_0xf65924(0x129)+'<h5>'+_0x347a72[0x0]['site_title']+_0xf65924(0x1b6)+'</div>'+_0xf65924(0x1c0)+_0xf65924(0x16e)};_0x11c8bc['sendMail'](_0x16361c,function(_0x590560,_0x373fc7){var _0x40fee3=_0xf65924;_0x590560?(console[_0x40fee3(0x19e)](_0x590560),console[_0x40fee3(0x19e)](_0x40fee3(0x136))):console[_0x40fee3(0x19e)](_0x40fee3(0x126));});}catch(_0x59574b){console[_0xf65924(0x1bd)](_0x59574b),_0x27fe98[_0xf65924(0x1ab)](0x1f4)[_0xf65924(0x152)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x59574b[_0xf65924(0x135)]});}})[_0x3b14f4(0x128)](_0x1f5359=>{var _0x4abdc0=_0x3b14f4;console[_0x4abdc0(0x1bd)](_0x1f5359),_0x27fe98[_0x4abdc0(0x1ab)](0x1f4)[_0x4abdc0(0x152)]({'error':_0x4abdc0(0x1e7)});}),_0x3ab844[_0x3b14f4(0x1c8)](_0x3b14f4(0x13e),'purchase\x20data\x20add\x20successfully'),_0x27fe98[_0x3b14f4(0x195)](_0x3b14f4(0x10f));}catch(_0x7f6f6){console[_0x3b14f4(0x19e)](_0x7f6f6);}}),router[a0_0x410a36(0x1a6)](a0_0x410a36(0x13a),auth,async(_0x5975d4,_0x4538a4)=>{var _0x53511e=a0_0x410a36;try{const {username:_0xcedad9,email:_0x391c0b,role:_0x1bc9ca}=_0x5975d4['user'],_0x116a94=_0x5975d4[_0x53511e(0x14b)],_0x22863f=await profile['findOne']({'email':_0x116a94[_0x53511e(0x1b3)]}),_0x12536b=await master_shop[_0x53511e(0x144)](),_0x171ede=_0x5975d4['params']['id'],_0x3a2ed2=await purchases_finished[_0x53511e(0x16f)](_0x171ede),_0x2123f3=await suppliers[_0x53511e(0x144)]({});let _0x48b4ad;if(_0x116a94[_0x53511e(0x17e)]=='staff'){const _0x485c92=await staff[_0x53511e(0x1c2)]({'email':_0x116a94[_0x53511e(0x1b3)]});_0x48b4ad=await warehouse[_0x53511e(0x144)]({'status':_0x53511e(0x10e),'name':_0x485c92[_0x53511e(0x1f6)],'warehouse_category':'Finished\x20Goods'});}else _0x48b4ad=await warehouse[_0x53511e(0x187)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x53511e(0x1d5),'name':{'$first':_0x53511e(0x1d5)}}}]);const _0x4199fb=await product[_0x53511e(0x144)]({}),_0x22f266=BayBinSelected(_0x3a2ed2[_0x53511e(0x1c5)],_0x3a2ed2[_0x53511e(0x171)]);let _0x229727=new Date(_0x3a2ed2[_0x53511e(0x1be)]),_0x4f2a23=('0'+_0x229727[_0x53511e(0x1e4)]())[_0x53511e(0x120)](-0x2),_0x1f172e=('0'+(_0x229727[_0x53511e(0x1a8)]()+0x1))[_0x53511e(0x120)](-0x2),_0x4d8d2c=_0x229727[_0x53511e(0x166)](),_0x30bc33=_0x4d8d2c+'-'+_0x1f172e+'-'+_0x4f2a23;if(_0x12536b[0x0][_0x53511e(0x1f1)]==_0x53511e(0x1f2)){var _0x2e1ed7=users[_0x53511e(0x176)];console[_0x53511e(0x19e)](_0x2e1ed7);}else{if(_0x12536b[0x0][_0x53511e(0x1f1)]==_0x53511e(0x133))var _0x2e1ed7=users[_0x53511e(0x133)];else{if(_0x12536b[0x0][_0x53511e(0x1f1)]==_0x53511e(0x130))var _0x2e1ed7=users['German'];else{if(_0x12536b[0x0]['language']=='Spanish')var _0x2e1ed7=users['Spanish'];else{if(_0x12536b[0x0]['language']==_0x53511e(0x11d))var _0x2e1ed7=users[_0x53511e(0x11d)];else{if(_0x12536b[0x0]['language']==_0x53511e(0x13c))var _0x2e1ed7=users[_0x53511e(0x15a)];else{if(_0x12536b[0x0][_0x53511e(0x1f1)]==_0x53511e(0x1dd))var _0x2e1ed7=users['Chinese'];else{if(_0x12536b[0x0]['language']==_0x53511e(0x11e))var _0x2e1ed7=users['Arabic'];}}}}}}}_0x4538a4[_0x53511e(0x154)]('edit_purchases_finished_view',{'success':_0x5975d4[_0x53511e(0x1c8)](_0x53511e(0x13e)),'errors':_0x5975d4[_0x53511e(0x1c8)](_0x53511e(0x1fa)),'role':_0x116a94,'profile':_0x22863f,'purchases':_0x3a2ed2,'suppliers':_0x2123f3,'warehouse':_0x48b4ad,'product':_0x4199fb,'master_shop':_0x12536b,'language':_0x2e1ed7,'ed_fullDate':_0x30bc33,'dataSelected':_0x22f266});}catch(_0x317240){console[_0x53511e(0x19e)](_0x317240);}}),router[a0_0x410a36(0x1a6)]('/view/:id',auth,async(_0x2adc81,_0x87d621)=>{var _0x59917c=a0_0x410a36;try{const {username:_0x33afea,email:_0x2b2e99,role:_0x22a5a5}=_0x2adc81['user'],_0x54969e=_0x2adc81[_0x59917c(0x14b)],_0x1d1673=await profile['findOne']({'email':_0x54969e[_0x59917c(0x1b3)]}),_0x3a2846=await master_shop[_0x59917c(0x144)](),_0xc44848=_0x2adc81[_0x59917c(0x1a0)]['id'],_0x1cb1e3=await purchases_finished[_0x59917c(0x16f)](_0xc44848),_0x2cdee3=await suppliers[_0x59917c(0x144)]({});let _0xf5b8aa;if(_0x54969e[_0x59917c(0x17e)]==_0x59917c(0x197)){const _0x1f17b5=await staff['findOne']({'email':_0x54969e[_0x59917c(0x1b3)]});_0xf5b8aa=await warehouse[_0x59917c(0x144)]({'status':'Enabled','name':_0x1f17b5[_0x59917c(0x1f6)],'warehouse_category':'Finished\x20Goods'});}else _0xf5b8aa=await warehouse['aggregate']([{'$match':{'status':_0x59917c(0x10e),'warehouse_category':_0x59917c(0x1df)}},{'$group':{'_id':'$name','name':{'$first':_0x59917c(0x1d5)}}}]);const _0x403db2=await product[_0x59917c(0x144)]({}),_0x17cbe4=BayBinSelected(_0x1cb1e3[_0x59917c(0x1c5)],_0x1cb1e3['room']);let _0x1028e5=new Date(_0x1cb1e3[_0x59917c(0x1be)]),_0xc65b4=('0'+_0x1028e5[_0x59917c(0x1e4)]())[_0x59917c(0x120)](-0x2),_0x55d4d9=('0'+(_0x1028e5[_0x59917c(0x1a8)]()+0x1))[_0x59917c(0x120)](-0x2),_0x24af89=_0x1028e5[_0x59917c(0x166)](),_0x29a851=_0x24af89+'-'+_0x55d4d9+'-'+_0xc65b4;if(_0x3a2846[0x0][_0x59917c(0x1f1)]==_0x59917c(0x1f2)){var _0x3c45a8=users['English'];console['log'](_0x3c45a8);}else{if(_0x3a2846[0x0][_0x59917c(0x1f1)]=='Hindi')var _0x3c45a8=users['Hindi'];else{if(_0x3a2846[0x0]['language']=='German')var _0x3c45a8=users[_0x59917c(0x130)];else{if(_0x3a2846[0x0][_0x59917c(0x1f1)]=='Spanish')var _0x3c45a8=users[_0x59917c(0x1c4)];else{if(_0x3a2846[0x0]['language']==_0x59917c(0x11d))var _0x3c45a8=users['French'];else{if(_0x3a2846[0x0]['language']=='Portuguese\x20(BR)')var _0x3c45a8=users[_0x59917c(0x15a)];else{if(_0x3a2846[0x0][_0x59917c(0x1f1)]==_0x59917c(0x1dd))var _0x3c45a8=users[_0x59917c(0x1dd)];else{if(_0x3a2846[0x0][_0x59917c(0x1f1)]=='Arabic\x20(ae)')var _0x3c45a8=users['Arabic'];}}}}}}}_0x87d621[_0x59917c(0x154)](_0x59917c(0x178),{'success':_0x2adc81[_0x59917c(0x1c8)](_0x59917c(0x13e)),'errors':_0x2adc81['flash']('errors'),'role':_0x54969e,'profile':_0x1d1673,'purchases':_0x1cb1e3,'suppliers':_0x2cdee3,'warehouse':_0xf5b8aa,'product':_0x403db2,'master_shop':_0x3a2846,'language':_0x3c45a8,'ed_fullDate':_0x29a851,'dataSelected':_0x17cbe4});}catch(_0x56f147){console[_0x59917c(0x19e)](_0x56f147);}}),router['post']('/view/:id',auth,async(_0xfe7801,_0x2db958)=>{var _0xda9443=a0_0x410a36;try{const _0x465d9c=_0xfe7801['params']['id'],_0x4e07e2=await purchases_finished[_0xda9443(0x1c2)]({'_id':_0xfe7801['params']['id']}),_0x12750f=await warehouse[_0xda9443(0x1c2)]({'name':_0x4e07e2[_0xda9443(0x1c5)],'room':_0x4e07e2[_0xda9443(0x171)]});_0x4e07e2[_0xda9443(0x1d2)][_0xda9443(0x1ef)](_0x164e5d=>{var _0x14bbd0=_0xda9443;const _0x1570f6=_0x12750f[_0x14bbd0(0x117)][_0x14bbd0(0x12a)](_0x391723=>{var _0x2cf392=_0x14bbd0;_0x391723[_0x2cf392(0x180)]==_0x164e5d['product_name']&&_0x391723['bay']==_0x164e5d[_0x2cf392(0x1aa)]&&(_0x391723[_0x2cf392(0x155)]=parseInt(_0x391723['product_stock'])-parseInt(_0x164e5d['quantity']));});}),await _0x12750f[_0xda9443(0x18a)]();const {invoice:_0x2abeb6,suppliers:_0x2e12a1,date:_0x53ef38,warehouse_name:_0x2e6700,prod_name:_0x422c7d,prod_code:_0x523119,prod_qty:_0x4c0fd9,prod_unit:_0x5e32fc,prod_secondunit:_0x1dd6ad,prod_level:_0x4a7b14,prod_isle:_0xb38a83,prod_pallet:_0x596321,note:_0x3c75e6,expiry_date:_0x174c78,batch_code:_0x50c4d7,paid_amount:_0xbb0750,due_amount:_0x146c33,Room_name:_0x3757f4,primary_code:_0x14f52f,secondary_code:_0x519b8d,PO_number:_0x270e1d,JO_number:_0x56490f}=_0xfe7801[_0xda9443(0x1fd)];if(typeof _0x422c7d==_0xda9443(0x196))var _0xfd6b48=[_0xfe7801['body'][_0xda9443(0x1c1)]],_0x2a4152=[_0xfe7801['body'][_0xda9443(0x10b)]],_0x433e7a=[_0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x201)]],_0x50a521=[_0xfe7801['body'][_0xda9443(0x1fe)]],_0x3b6141=[_0xfe7801['body']['prod_secondunit']],_0x583264=[_0xfe7801['body'][_0xda9443(0x1d4)]],_0x409a9b=[_0xfe7801[_0xda9443(0x1fd)]['primary_code']],_0x5c55ba=[_0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x12d)]],_0x37b7f8=[_0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x175)]],_0x119d36=[_0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x123)]],_0x45aea8=[_0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x1be)]];else var _0xfd6b48=[..._0xfe7801[_0xda9443(0x1fd)]['prod_name']],_0x2a4152=[..._0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x10b)]],_0x433e7a=[..._0xfe7801['body'][_0xda9443(0x201)]],_0x50a521=[..._0xfe7801[_0xda9443(0x1fd)]['prod_unit']],_0x3b6141=[..._0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x1e0)]],_0x583264=[..._0xfe7801[_0xda9443(0x1fd)]['prod_level']],_0x409a9b=[..._0xfe7801['body'][_0xda9443(0x11f)]],_0x5c55ba=[..._0xfe7801[_0xda9443(0x1fd)]['secondary_code']],_0x37b7f8=[..._0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x175)]],_0x119d36=[..._0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x123)]],_0x45aea8=[..._0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x1be)]];const _0x4fa96f=_0xfd6b48[_0xda9443(0x12a)](_0x135cdd=>{return _0x135cdd={'product_name':_0x135cdd};});_0x2a4152[_0xda9443(0x1ef)]((_0x19f459,_0x289c58)=>{var _0x1b49a1=_0xda9443;_0x4fa96f[_0x289c58][_0x1b49a1(0x122)]=_0x19f459;}),_0x433e7a['forEach']((_0x46be31,_0x2abf77)=>{_0x4fa96f[_0x2abf77]['quantity']=_0x46be31;}),_0x50a521[_0xda9443(0x1ef)]((_0x2eef60,_0x4d4a63)=>{var _0x1434a0=_0xda9443;_0x4fa96f[_0x4d4a63][_0x1434a0(0x15f)]=_0x2eef60;}),_0x3b6141[_0xda9443(0x1ef)]((_0x1bb305,_0x83b56b)=>{_0x4fa96f[_0x83b56b]['secondary_unit']=_0x1bb305;}),_0x583264[_0xda9443(0x1ef)]((_0x99fd14,_0x4c79f7)=>{_0x4fa96f[_0x4c79f7]['bay']=_0x99fd14;}),_0x409a9b[_0xda9443(0x1ef)]((_0xb563fe,_0xc6c78f)=>{var _0x29cdfc=_0xda9443;_0x4fa96f[_0xc6c78f][_0x29cdfc(0x11f)]=_0xb563fe;}),_0x5c55ba[_0xda9443(0x1ef)]((_0x4c496c,_0x324d87)=>{var _0x3052a1=_0xda9443;_0x4fa96f[_0x324d87][_0x3052a1(0x12d)]=_0x4c496c;}),_0x37b7f8[_0xda9443(0x1ef)]((_0x1b7b58,_0x35d032)=>{var _0x181418=_0xda9443;_0x4fa96f[_0x35d032][_0x181418(0x1e6)]=_0x1b7b58;}),_0x119d36['forEach']((_0xdb12e0,_0x3b4446)=>{var _0x496590=_0xda9443;_0x4fa96f[_0x3b4446][_0x496590(0x123)]=_0xdb12e0;}),_0x45aea8['forEach']((_0x15c958,_0x20db14)=>{var _0x2b3538=_0xda9443;_0x4fa96f[_0x20db14][_0x2b3538(0x1be)]=_0x15c958;});const _0x4156f7=_0x4fa96f[_0xda9443(0x1ff)](_0x420b55=>_0x420b55['quantity']!=='0'&&_0x420b55[_0xda9443(0x1db)]!=='');_0x4e07e2['invoice']=_0x2abeb6,_0x4e07e2[_0xda9443(0x181)]=_0x2e12a1,_0x4e07e2[_0xda9443(0x200)]=_0x53ef38,_0x4e07e2['warehouse_name']=_0x2e6700,_0x4e07e2[_0xda9443(0x1d2)]=_0x4156f7,_0x4e07e2[_0xda9443(0x150)]=_0x3c75e6,_0x4e07e2[_0xda9443(0x14e)]=_0xbb0750,_0x4e07e2['due_amount']=_0x146c33,_0x4e07e2[_0xda9443(0x171)]=_0x3757f4,_0x4e07e2[_0xda9443(0x113)]=_0x270e1d,_0x4e07e2['JO_number']=_0x56490f;const _0x21fcc6=await _0x4e07e2[_0xda9443(0x18a)](),_0x61bbc5=await warehouse[_0xda9443(0x1c2)]({'name':_0xfe7801['body'][_0xda9443(0x1c5)],'room':_0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x1a9)]});_0x4e07e2['product'][_0xda9443(0x1ef)](_0x34dc93=>{var _0x3f970f=_0xda9443,_0x20f54d=0x0;const _0xa4f925=_0x61bbc5['product_details'][_0x3f970f(0x12a)](_0x4b7462=>{var _0x332a4c=_0x3f970f;_0x4b7462[_0x332a4c(0x180)]==_0x34dc93[_0x332a4c(0x180)]&&_0x4b7462[_0x332a4c(0x1aa)]==_0x34dc93[_0x332a4c(0x1aa)]&&(_0x4b7462[_0x332a4c(0x155)]=parseInt(_0x4b7462[_0x332a4c(0x155)])+parseInt(_0x34dc93[_0x332a4c(0x1db)]),_0x20f54d++);});_0x20f54d=='0'&&(_0x61bbc5[_0x3f970f(0x117)]=_0x61bbc5['product_details']['concat']({'product_name':_0x34dc93[_0x3f970f(0x180)],'product_stock':_0x34dc93['quantity'],'primary_code':_0x34dc93['primary_code'],'secondary_code':_0x34dc93['secondary_code'],'product_code':_0x34dc93[_0x3f970f(0x122)],'bay':_0x34dc93[_0x3f970f(0x1aa)],'maxProducts':_0x34dc93[_0x3f970f(0x1e6)],'unit':_0x34dc93[_0x3f970f(0x15f)],'secondary_unit':_0x34dc93[_0x3f970f(0x143)],'expiry_date':_0x34dc93['expiry_date']}));}),await _0x61bbc5['save']();const _0x749e60=await s_payment_data['findOne']({'invoice':_0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x1b0)]});if(_0x749e60===null){}else console[_0xda9443(0x19e)]('suppliers',_0x749e60,_0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x1b0)]),_0x749e60[_0xda9443(0x181)]=_0xfe7801[_0xda9443(0x1fd)][_0xda9443(0x181)],await _0x749e60[_0xda9443(0x18a)]();_0xfe7801[_0xda9443(0x1c8)]('success',_0xda9443(0x161)),_0x2db958[_0xda9443(0x195)]('/all_purchases_finished/view');}catch(_0x499477){console[_0xda9443(0x19e)](_0x499477);}}),router[a0_0x410a36(0x1da)](a0_0x410a36(0x1d1),auth,async(_0x1af91a,_0x3e009d)=>{var _0x2af40e=a0_0x410a36;try{const _0x163953=_0x1af91a[_0x2af40e(0x1a0)]['id'],{invoice:_0x3f02eb,suppliers:_0x3296c4,payable:_0x4f95ca,due_amount:_0xe51e65}=_0x1af91a[_0x2af40e(0x1fd)],_0x4bdf97=await purchases[_0x2af40e(0x16f)](_0x163953);var _0x3bf197=_0x4f95ca-_0xe51e65;_0x4bdf97[_0x2af40e(0x14e)]=parseFloat(_0x4bdf97['paid_amount'])+parseFloat(_0xe51e65),_0x4bdf97[_0x2af40e(0x10d)]=_0x3bf197;const _0x5ab86f=await _0x4bdf97[_0x2af40e(0x18a)]();console[_0x2af40e(0x19e)](_0x5ab86f);const _0x597c47=await s_payment_data['findOne']({'invoice':_0x3f02eb});_0x597c47['amount']=_0x3bf197,await _0x597c47[_0x2af40e(0x18a)]();let _0x129214=new Date(),_0x2f98e2=('0'+_0x129214[_0x2af40e(0x1e4)]())['slice'](-0x2),_0x1035bc=('0'+(_0x129214[_0x2af40e(0x1a8)]()+0x1))[_0x2af40e(0x120)](-0x2),_0x3f6980=_0x129214[_0x2af40e(0x166)](),_0xec1022=_0x3f6980+'-'+_0x1035bc+'-'+_0x2f98e2;const _0x29470b=new suppliers_payment({'invoice':_0x3f02eb,'date':_0x3f6980+'-'+_0x1035bc+'-'+_0x2f98e2,'suppliers':_0x3296c4,'reason':_0x2af40e(0x1f9),'amount':_0xe51e65}),_0x537be3=await _0x29470b['save']();_0x1af91a[_0x2af40e(0x1c8)](_0x2af40e(0x13e),_0x2af40e(0x159)),_0x3e009d[_0x2af40e(0x195)](_0x2af40e(0x15d));}catch(_0x532ebd){console['log'](_0x532ebd);}}),router[a0_0x410a36(0x1a6)]('/invoice/:id',auth,async(_0x211b35,_0x1b98f0)=>{var _0x5c1031=a0_0x410a36;try{const {username:_0x33c8c5,email:_0x5efaed,role:_0xa07176}=_0x211b35[_0x5c1031(0x14b)],_0x1e7574=_0x211b35[_0x5c1031(0x14b)],_0x3c256f=await profile[_0x5c1031(0x1c2)]({'email':_0x1e7574[_0x5c1031(0x1b3)]}),_0x1cc724=await master_shop['find']();console[_0x5c1031(0x19e)](_0x5c1031(0x170),_0x1cc724);const _0x2a067a=_0x211b35[_0x5c1031(0x1a0)]['id'],_0x12d739=await purchases['findById'](_0x2a067a);console[_0x5c1031(0x19e)](_0x12d739);const _0x5f4251=await suppliers[_0x5c1031(0x1c2)]({'name':_0x12d739[_0x5c1031(0x181)]});console[_0x5c1031(0x19e)](_0x5f4251);if(_0x1cc724[0x0]['language']==_0x5c1031(0x1f2)){var _0x1cf276=users['English'];console[_0x5c1031(0x19e)](_0x1cf276);}else{if(_0x1cc724[0x0]['language']==_0x5c1031(0x133))var _0x1cf276=users[_0x5c1031(0x133)];else{if(_0x1cc724[0x0][_0x5c1031(0x1f1)]==_0x5c1031(0x130))var _0x1cf276=users[_0x5c1031(0x130)];else{if(_0x1cc724[0x0][_0x5c1031(0x1f1)]==_0x5c1031(0x1c4))var _0x1cf276=users['Spanish'];else{if(_0x1cc724[0x0]['language']=='French')var _0x1cf276=users[_0x5c1031(0x11d)];else{if(_0x1cc724[0x0][_0x5c1031(0x1f1)]==_0x5c1031(0x13c))var _0x1cf276=users[_0x5c1031(0x15a)];else{if(_0x1cc724[0x0][_0x5c1031(0x1f1)]==_0x5c1031(0x1dd))var _0x1cf276=users[_0x5c1031(0x1dd)];else{if(_0x1cc724[0x0]['language']=='Arabic\x20(ae)')var _0x1cf276=users[_0x5c1031(0x10a)];}}}}}}}_0x1b98f0[_0x5c1031(0x154)](_0x5c1031(0x19b),{'success':_0x211b35[_0x5c1031(0x1c8)](_0x5c1031(0x13e)),'errors':_0x211b35[_0x5c1031(0x1c8)](_0x5c1031(0x1fa)),'role':_0x1e7574,'profile':_0x3c256f,'master_shop':_0x1cc724,'supplier':_0x5f4251,'purchase':_0x12d739,'language':_0x1cf276});}catch(_0x343d32){console['log'](_0x343d32);}}),router[a0_0x410a36(0x1a6)]('/view/return_purchase/:id',auth,async(_0x285b29,_0x39faf9)=>{var _0x5283fd=a0_0x410a36;try{const {username:_0x11c937,email:_0x2aea5a,role:_0x56fad1}=_0x285b29[_0x5283fd(0x14b)],_0x5044fe=_0x285b29[_0x5283fd(0x14b)],_0x4b045a=await profile['findOne']({'email':_0x5044fe[_0x5283fd(0x1b3)]}),_0x153f2f=await master_shop[_0x5283fd(0x144)]();console['log'](_0x5283fd(0x170),_0x153f2f);const _0x2e65ca=_0x285b29[_0x5283fd(0x1a0)]['id'];console[_0x5283fd(0x19e)](_0x2e65ca);const _0x2daf6d=await purchases_finished[_0x5283fd(0x16f)](_0x2e65ca);console['log']('user_id',_0x2daf6d);const _0x49d3fd=await product['find']({}),_0x3f1980=await warehouse[_0x5283fd(0x187)]([{'$match':{'name':_0x2daf6d[_0x5283fd(0x1c5)],'room':_0x2daf6d[_0x5283fd(0x171)]}},{'$unwind':_0x5283fd(0x132)},{'$group':{'_id':_0x5283fd(0x1f8),'name':{'$first':_0x5283fd(0x177)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5283fd(0x1a4)},'bin':{'$first':_0x5283fd(0x10c)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5283fd(0x1e2)},'product_code':{'$first':_0x5283fd(0x184)},'storage':{'$first':_0x5283fd(0x1bb)},'rack':{'$first':_0x5283fd(0x1ae)}}}]);console[_0x5283fd(0x19e)](_0x5283fd(0x138),_0x3f1980);let _0x2d1f79;if(_0x5044fe[_0x5283fd(0x17e)]==_0x5283fd(0x197)){const _0x736ce0=await staff[_0x5283fd(0x1c2)]({'email':_0x5044fe['email']});_0x2d1f79=await warehouse['find']({'status':_0x5283fd(0x10e),'name':_0x736ce0[_0x5283fd(0x1f6)],'warehouse_category':_0x5283fd(0x1df),'name':'Return\x20Goods'});}else _0x2d1f79=await warehouse[_0x5283fd(0x187)]([{'$match':{'status':_0x5283fd(0x10e),'warehouse_category':_0x5283fd(0x1df),'name':_0x5283fd(0x1f7)}},{'$group':{'_id':_0x5283fd(0x1d5),'name':{'$first':_0x5283fd(0x1d5)}}}]);if(_0x153f2f[0x0][_0x5283fd(0x1f1)]==_0x5283fd(0x1f2)){var _0x40b260=users[_0x5283fd(0x176)];console[_0x5283fd(0x19e)](_0x40b260);}else{if(_0x153f2f[0x0]['language']==_0x5283fd(0x133))var _0x40b260=users[_0x5283fd(0x133)];else{if(_0x153f2f[0x0][_0x5283fd(0x1f1)]=='German')var _0x40b260=users['German'];else{if(_0x153f2f[0x0][_0x5283fd(0x1f1)]==_0x5283fd(0x1c4))var _0x40b260=users[_0x5283fd(0x1c4)];else{if(_0x153f2f[0x0][_0x5283fd(0x1f1)]==_0x5283fd(0x11d))var _0x40b260=users[_0x5283fd(0x11d)];else{if(_0x153f2f[0x0][_0x5283fd(0x1f1)]==_0x5283fd(0x13c))var _0x40b260=users['Portuguese'];else{if(_0x153f2f[0x0][_0x5283fd(0x1f1)]=='Chinese')var _0x40b260=users['Chinese'];else{if(_0x153f2f[0x0][_0x5283fd(0x1f1)]==_0x5283fd(0x11e))var _0x40b260=users['Arabic'];}}}}}}}_0x39faf9[_0x5283fd(0x154)](_0x5283fd(0x1d8),{'success':_0x285b29[_0x5283fd(0x1c8)]('success'),'errors':_0x285b29['flash'](_0x5283fd(0x1fa)),'role':_0x5044fe,'profile':_0x4b045a,'user':_0x2daf6d,'stock':_0x3f1980,'master_shop':_0x153f2f,'product':_0x49d3fd,'language':_0x40b260,'warehouse':_0x2d1f79});}catch(_0x3e0e06){console[_0x5283fd(0x19e)](_0x3e0e06);}}),router['post'](a0_0x410a36(0x193),auth,async(_0x32257b,_0x3e3a90)=>{var _0x25a9d9=a0_0x410a36;try{const {invoice:_0x159ec0,date:_0x983f0c,warehouse_name:_0x2d8fb4,Room_name:_0x44148d,product_name:_0x1ab78c,purchase_quantity:_0x5927dc,stocks:_0x215105,return_qty:_0x222c7d,note:_0x387330,level:_0x56f05c,isle:_0x438514,pallet:_0x3364b4,to_warehouse_name:_0xa1a539,to_Room_name:_0xd955ea}=_0x32257b['body'],_0x1c234c=await purchases_finished[_0x25a9d9(0x1c2)]({'_id':_0x32257b[_0x25a9d9(0x1a0)]['id']}),_0xd98559=await warehouse['findOne']({'name':_0x2d8fb4,'room':_0x44148d,'warehouse_category':'Finished\x20Goods'});if(typeof _0x1ab78c==_0x25a9d9(0x196))var _0x5178b9=[_0x32257b[_0x25a9d9(0x1fd)]['product_name']],_0x363833=[_0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x179)]],_0x750f91=[_0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x17b)]],_0x26b729=[_0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x145)]],_0x1dd56d=[_0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x168)]],_0x36bb40=[_0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x118)]],_0x148b06=[_0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x1ee)]],_0x5e5c9a=[_0x32257b['body'][_0x25a9d9(0x164)]];else var _0x5178b9=[..._0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x180)]],_0x363833=[..._0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x179)]],_0x750f91=[..._0x32257b['body']['stocks']],_0x26b729=[..._0x32257b[_0x25a9d9(0x1fd)]['return_qty']],_0x1dd56d=[..._0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x168)]],_0x36bb40=[..._0x32257b[_0x25a9d9(0x1fd)]['product_code_hide']],_0x148b06=[..._0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x1ee)]],_0x5e5c9a=[..._0x32257b['body']['secondary_code_hide']];const _0x1b9d4c=_0x5178b9[_0x25a9d9(0x12a)](_0x4d1606=>{return _0x4d1606={'product_name':_0x4d1606};});_0x363833[_0x25a9d9(0x1ef)]((_0x302e31,_0x46debe)=>{var _0x30c203=_0x25a9d9;_0x1b9d4c[_0x46debe][_0x30c203(0x179)]=_0x302e31;}),_0x750f91[_0x25a9d9(0x1ef)]((_0xfc26da,_0x7bc0c9)=>{_0x1b9d4c[_0x7bc0c9]['stock_quantity']=_0xfc26da;}),_0x26b729[_0x25a9d9(0x1ef)]((_0x21a754,_0x4f0353)=>{var _0x25a42f=_0x25a9d9;_0x1b9d4c[_0x4f0353][_0x25a42f(0x145)]=_0x21a754;}),_0x1dd56d[_0x25a9d9(0x1ef)]((_0x334e44,_0x2eddb5)=>{var _0x17eb62=_0x25a9d9;_0x1b9d4c[_0x2eddb5][_0x17eb62(0x1aa)]=_0x334e44;}),_0x36bb40[_0x25a9d9(0x1ef)]((_0x3f03ef,_0x2a23e5)=>{var _0x4e5df1=_0x25a9d9;_0x1b9d4c[_0x2a23e5][_0x4e5df1(0x122)]=_0x3f03ef;}),_0x148b06[_0x25a9d9(0x1ef)]((_0x2ee9d5,_0x2b7692)=>{var _0x3ec81e=_0x25a9d9;_0x1b9d4c[_0x2b7692][_0x3ec81e(0x11f)]=_0x2ee9d5;}),_0x5e5c9a[_0x25a9d9(0x1ef)]((_0x207315,_0x2f16fa)=>{_0x1b9d4c[_0x2f16fa]['secondary_code']=_0x207315;}),_0x1b9d4c[_0x25a9d9(0x1ef)](_0x58edf6=>{var _0x532be6=_0x25a9d9;console[_0x532be6(0x19e)](_0x58edf6);const _0x9b046d=_0xd98559[_0x532be6(0x117)]['map'](_0xcdc567=>{var _0x175350=_0x532be6;_0xcdc567[_0x175350(0x180)]==_0x58edf6[_0x175350(0x180)]&&_0xcdc567[_0x175350(0x1aa)]==_0x58edf6[_0x175350(0x1aa)]&&(console[_0x175350(0x19e)](parseInt(_0xcdc567[_0x175350(0x155)])+_0x175350(0x153)+parseInt(_0x58edf6[_0x175350(0x145)])),_0xcdc567[_0x175350(0x155)]=parseInt(_0xcdc567['product_stock'])-parseInt(_0x58edf6['return_qty']));});}),await _0xd98559[_0x25a9d9(0x18a)]();var _0x1ac1a4=0x0;_0x1b9d4c[_0x25a9d9(0x1ef)](_0x49f77a=>{var _0x2c94bb=_0x25a9d9;(parseInt(_0x49f77a[_0x2c94bb(0x179)])<parseInt(_0x49f77a['return_qty'])||parseInt(_0x49f77a[_0x2c94bb(0x1e5)])<parseInt(_0x49f77a[_0x2c94bb(0x145)]))&&_0x1ac1a4++;});if(_0x1ac1a4!=0x0)return _0x32257b['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3e3a90['redirect']('back');const _0x485318=new purchases_return_finished({'invoice':_0x159ec0,'suppliers':_0x32257b[_0x25a9d9(0x1fd)][_0x25a9d9(0x181)],'date':_0x983f0c,'warehouse_name':_0x2d8fb4,'return_product':_0x1b9d4c,'note':_0x387330,'room':_0x44148d,'to_warehouse_name':_0xa1a539,'to_room':_0xd955ea}),_0x383381=await _0x485318[_0x25a9d9(0x18a)](),_0x2d4617=await purchases_return_finished['findOne']({'invoice':_0x159ec0}),_0x216d57=await warehouse[_0x25a9d9(0x1c2)]({'name':_0xa1a539,'room':_0xd955ea,'warehouse_category':_0x25a9d9(0x1df)});_0x2d4617['return_product']['forEach'](_0x1b0d52=>{var _0x549c29=_0x25a9d9,_0x361d11=0x0;const _0xfaa0cb=_0x216d57[_0x549c29(0x117)][_0x549c29(0x12a)](_0x3acc3c=>{var _0x9bcebe=_0x549c29;console[_0x9bcebe(0x19e)](_0x3acc3c['product_name']+'=='+_0x1b0d52['product_name']+'&&'+_0x3acc3c[_0x9bcebe(0x1aa)]+'=='+_0x1b0d52[_0x9bcebe(0x1aa)]),_0x3acc3c['product_name']==_0x1b0d52[_0x9bcebe(0x180)]&&_0x3acc3c[_0x9bcebe(0x1aa)]==_0x1b0d52[_0x9bcebe(0x1aa)]&&(_0x3acc3c[_0x9bcebe(0x155)]=parseInt(_0x3acc3c['product_stock'])-parseInt(_0x1b0d52[_0x9bcebe(0x145)]),_0x361d11++);});_0x361d11=='0'&&(_0x216d57[_0x549c29(0x117)]=_0x216d57[_0x549c29(0x117)][_0x549c29(0x14c)]({'product_name':_0x1b0d52[_0x549c29(0x180)],'product_stock':_0x1b0d52[_0x549c29(0x145)],'primary_code':_0x1b0d52['primary_code'],'secondary_code':_0x1b0d52[_0x549c29(0x12d)],'product_code':_0x1b0d52[_0x549c29(0x122)],'bay':_0x1b0d52[_0x549c29(0x1aa)],'maxProducts':0xf423f}));}),await _0x216d57[_0x25a9d9(0x18a)]();const _0x2e7080=await purchases_finished['findOne']({'invoice':_0x159ec0});_0x2e7080[_0x25a9d9(0x121)]=_0x25a9d9(0x1d3);const _0x12b2b5=await _0x2e7080['save'](),_0x302b8f=new s_payment_data({'invoice':_0x159ec0,'suppliers':_0x32257b[_0x25a9d9(0x1fd)]['suppliers'],'reason':_0x25a9d9(0x1f0)});await _0x302b8f['save']();const _0x2a2658=await master_shop[_0x25a9d9(0x144)](),_0x14bbe9=await email_settings[_0x25a9d9(0x1c2)](),_0x28bcba=await suppliers[_0x25a9d9(0x1c2)]({'name':_0x32257b['body'][_0x25a9d9(0x181)]});_0x2a2658[0x0][_0x25a9d9(0x1de)]==0x1?(right_currency=_0x2a2658[0x0][_0x25a9d9(0x1cc)],left_currency=''):(right_currency='',left_currency=_0x2a2658[0x0][_0x25a9d9(0x1cc)]);var _0x34bb49=_0x5178b9,_0x4e03d0=_0x26b729,_0x5d7e49='',_0x1fca72;for(_0x1fca72 in _0x34bb49){_0x5d7e49+=_0x25a9d9(0x17c)+_0x25a9d9(0x19d)+_0x34bb49[_0x1fca72]+_0x25a9d9(0x194)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4e03d0[_0x1fca72]+_0x25a9d9(0x194)+'</tr>';}let _0x4d747a=nodemailer['createTransport']({'service':_0x25a9d9(0x148),'auth':{'user':_0x14bbe9[_0x25a9d9(0x1b3)],'pass':_0x14bbe9[_0x25a9d9(0x1d7)]}}),_0x5606a1={'from':_0x14bbe9[_0x25a9d9(0x1b3)],'to':_0x28bcba[_0x25a9d9(0x1b3)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x25a9d9(0x1b8),'path':__dirname+'/../public'+_0x25a9d9(0x157)+_0x2a2658[0x0][_0x25a9d9(0x13b)],'cid':_0x25a9d9(0x1c9)}],'html':_0x25a9d9(0x188)+_0x25a9d9(0x19c)+'</head><body>'+_0x25a9d9(0x16d)+_0x25a9d9(0x156)+_0x25a9d9(0x16d)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x25a9d9(0x1c0)+_0x25a9d9(0x16d)+_0x25a9d9(0x158)+_0x2a2658[0x0]['site_title']+_0x25a9d9(0x12f)+_0x25a9d9(0x1c0)+'</div>'+_0x25a9d9(0x14d)+_0x25a9d9(0x16d)+_0x25a9d9(0x1bf)+_0x25a9d9(0x1bc)+_0x159ec0+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x25a9d9(0x18e)+_0x983f0c+'\x20'+_0x25a9d9(0x190)+'</h5>'+_0x25a9d9(0x1c0)+_0x25a9d9(0x12b)+_0x25a9d9(0x13d)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x25a9d9(0x1ed)+_0x25a9d9(0x1ec)+_0x25a9d9(0x149)+_0x25a9d9(0x11a)+'</thead>'+_0x25a9d9(0x127)+'\x20'+_0x5d7e49+'\x20'+_0x25a9d9(0x18b)+_0x25a9d9(0x19a)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x25a9d9(0x15b)+_0x2a2658[0x0][_0x25a9d9(0x199)]+_0x25a9d9(0x1b6)+_0x25a9d9(0x1c0)+_0x25a9d9(0x1c0)+'</body></html>'};_0x4d747a[_0x25a9d9(0x13f)](_0x5606a1,function(_0x506edb,_0x285d29){var _0x3cbcb5=_0x25a9d9;_0x506edb?console[_0x3cbcb5(0x19e)](_0x3cbcb5(0x136)):console[_0x3cbcb5(0x19e)]('Email\x20sent\x20successfully');}),_0x32257b[_0x25a9d9(0x1c8)](_0x25a9d9(0x13e),_0x25a9d9(0x1b4)),_0x3e3a90['redirect']('/all_purchases_finished/view');}catch(_0x436fd3){_0x3e3a90[_0x25a9d9(0x1ab)](0xc8)['json']({'message':_0x436fd3[_0x25a9d9(0x135)]});}}),router[a0_0x410a36(0x1a6)]('/barcode/:id',auth,async(_0x3c1b25,_0x591e88)=>{var _0x55402e=a0_0x410a36;try{const {username:_0x4b1ec1,email:_0x4a37c1,role:_0x14eee3}=_0x3c1b25[_0x55402e(0x14b)],_0x3d4c32=_0x3c1b25[_0x55402e(0x14b)],_0x1e273c=await profile['findOne']({'email':_0x3d4c32[_0x55402e(0x1b3)]}),_0x3650f1=await master_shop[_0x55402e(0x144)](),_0x2756d0=_0x3c1b25['params']['id'],_0x59f2b0=await purchases_finished[_0x55402e(0x16f)](_0x2756d0);if(_0x3650f1[0x0]['language']==_0x55402e(0x1f2))var _0x560d39=users[_0x55402e(0x176)];else{if(_0x3650f1[0x0][_0x55402e(0x1f1)]=='Hindi')var _0x560d39=users[_0x55402e(0x133)];else{if(_0x3650f1[0x0]['language']==_0x55402e(0x130))var _0x560d39=users[_0x55402e(0x130)];else{if(_0x3650f1[0x0]['language']==_0x55402e(0x1c4))var _0x560d39=users[_0x55402e(0x1c4)];else{if(_0x3650f1[0x0][_0x55402e(0x1f1)]==_0x55402e(0x11d))var _0x560d39=users[_0x55402e(0x11d)];else{if(_0x3650f1[0x0]['language']==_0x55402e(0x13c))var _0x560d39=users[_0x55402e(0x15a)];else{if(_0x3650f1[0x0][_0x55402e(0x1f1)]==_0x55402e(0x1dd))var _0x560d39=users['Chinese'];else{if(_0x3650f1[0x0][_0x55402e(0x1f1)]==_0x55402e(0x11e))var _0x560d39=users[_0x55402e(0x10a)];}}}}}}}_0x591e88[_0x55402e(0x154)](_0x55402e(0x1cd),{'success':_0x3c1b25[_0x55402e(0x1c8)](_0x55402e(0x13e)),'errors':_0x3c1b25[_0x55402e(0x1c8)](_0x55402e(0x1fa)),'role':_0x3d4c32,'profile':_0x1e273c,'alldata':_0x59f2b0,'master_shop':_0x3650f1,'language':_0x560d39}),console[_0x55402e(0x19e)](alldata);}catch(_0x18d7d3){console[_0x55402e(0x19e)](_0x18d7d3);}}),router[a0_0x410a36(0x1da)](a0_0x410a36(0x109),async(_0x25cfac,_0x18873b)=>{var _0x1cdedb=a0_0x410a36;const {product_code:_0x1a9a5b}=_0x25cfac[_0x1cdedb(0x1fd)];var _0x1bcdc1;const _0x1ab9da=await product[_0x1cdedb(0x187)]([{'$match':{'primary_code':_0x1a9a5b,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x1cdedb(0x16b),'name':{'$first':'$name'},'category':{'$first':_0x1cdedb(0x1e3)},'brand':{'$first':_0x1cdedb(0x1c3)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x1cdedb(0x107)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x1cdedb(0x1f3)},'maxStocks':{'$first':_0x1cdedb(0x1e8)},'maxProdPerUnit':{'$first':_0x1cdedb(0x1ca)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x179ef3=await product[_0x1cdedb(0x187)]([{'$match':{'secondary_code':_0x1a9a5b}},{'$group':{'_id':_0x1cdedb(0x16b),'name':{'$first':_0x1cdedb(0x1d5)},'category':{'$first':_0x1cdedb(0x1e3)},'brand':{'$first':_0x1cdedb(0x1c3)},'unit':{'$first':_0x1cdedb(0x14a)},'alertquantity':{'$first':_0x1cdedb(0x17f)},'product_code':{'$first':_0x1cdedb(0x107)},'primary_code':{'$first':_0x1cdedb(0x137)},'secondary_code':{'$first':_0x1cdedb(0x1f3)},'maxStocks':{'$first':_0x1cdedb(0x1e8)},'maxProdPerUnit':{'$first':_0x1cdedb(0x1ca)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1cdedb(0x131)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1ab9da[_0x1cdedb(0x18f)]>0x0)_0x1bcdc1=_0x1ab9da;else _0x179ef3[_0x1cdedb(0x18f)]>0x0&&(_0x1bcdc1=_0x179ef3);_0x18873b[_0x1cdedb(0x152)](_0x1bcdc1);}),router[a0_0x410a36(0x1da)](a0_0x410a36(0x119),async(_0x203663,_0x56629a)=>{var _0xecebf=a0_0x410a36;const {productCode:_0x992dcd,bay:_0x5b7127,warehouses:_0x1fe522,room:_0x5970a2}=_0x203663['body'];console[_0xecebf(0x19e)](_0x203663[_0xecebf(0x1fd)]);try{const _0x1ce828=await warehouse[_0xecebf(0x187)]([{'$match':{'name':_0x1fe522,'room':_0x5970a2}},{'$unwind':_0xecebf(0x132)},{'$match':{'product_details.bay':parseInt(_0x5b7127)}},{'$group':{'_id':_0xecebf(0x1f8),'name':{'$first':_0xecebf(0x177)},'product_stock':{'$first':_0xecebf(0x183)},'bay':{'$first':_0xecebf(0x1a4)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x56629a['status'](0xc8)['json'](_0x1ce828);}catch(_0x45a3a2){_0x56629a[_0xecebf(0x1ab)](0x194)[_0xecebf(0x152)]({'message':_0x45a3a2[_0xecebf(0x135)]});}}),module[a0_0x410a36(0x1cb)]=router;