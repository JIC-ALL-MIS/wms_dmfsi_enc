var a0_0x24dc2d=a0_0x2dc9;(function(_0x2bd7aa,_0x2d10f6){var _0x3a8e9d=a0_0x2dc9,_0x4204ac=_0x2bd7aa();while(!![]){try{var _0x2c0830=parseInt(_0x3a8e9d(0x1d9))/0x1+parseInt(_0x3a8e9d(0x28d))/0x2+parseInt(_0x3a8e9d(0x231))/0x3*(-parseInt(_0x3a8e9d(0x2a4))/0x4)+-parseInt(_0x3a8e9d(0x23d))/0x5+-parseInt(_0x3a8e9d(0x220))/0x6+-parseInt(_0x3a8e9d(0x269))/0x7+parseInt(_0x3a8e9d(0x1fb))/0x8;if(_0x2c0830===_0x2d10f6)break;else _0x4204ac['push'](_0x4204ac['shift']());}catch(_0x456dd7){_0x4204ac['push'](_0x4204ac['shift']());}}}(a0_0x2e3a,0xca0a3));function a0_0x2e3a(){var _0x39ba4c=['There\x27s\x20a\x20error\x20in\x20this\x20transaction','user','date','errors','/give_payment/:id','$_id','Arabic','$secondary_unit','$unit','$suppliers_docs','aggregate','$product.quantity','$product','max_product_unit','An\x20error\x20occurred\x20while\x20saving\x20data.','POnumber','prod_Qty','paid_amount','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$suppliers','edit_purchases_finished','production_date','</h5>','bay','INCF-','$maxProdPerUnit','stock_data','<!DOCTYPE\x20html>','6343512BhuKwF','warehouse_name','$name','$product_details.storage','currency','$product.floorlevel','$product_details.product_code','$invoice','success','logo','slice','<div>','</thead>','German','<html><head><title></title>','prod_invoice','amount','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','port','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','redirect','/preview/:id','prod_level','$product.bay','password','language','$product_code','master','status','../public/language/languages.json','edit_purchases_finished_view','/upload/','product_date','_id','prod_name','$alertquantity','4183470RJUvPv','product','\x20</h2>','/view/add_purchases/:id','Hindi','primary_code_hide','</tr>','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','then','/../public','$note','Rack\x202','table\x20page','save','suppliers_docs','room','152733xpDqSl','Purchase\x20Mail','standard_unit','padStart','/all_purchases_finished/view','</span>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','render','<h2>\x20','payment\x20successfull','stocks','6124605FHyYXc','$product_details.maxProducts','body','post','$warehouse_name','currency_placement','</head><body>','prod_unit','get','product_code_hide','$brand','Return\x20Goods','concat','site_title','product_cat','length','warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','name','string','product_details','stock_quantity','$return_data','DRY\x20GOODS','Rack\x201','add_purchases\x20error','invoice','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','purchase_quantity','expiry_date','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','secondary_unit','<h5>','ejs','$product_details.primary_code','/view/add_purchases','$product_details','</table>','$product_details._id','image','/CheckingWarehouse','$secondary_code','batch_code','495243QGMZbU','$product.bin','log','FGSEmail','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','error','return_data','RoomAssign','/view/return_purchase/:id','Chinese','<span\x20style=\x22float:\x20right;\x22>','$product_details.bin','product_name','$product_details.product_stock','level','purchase\x20data\x20add\x20successfully','flash','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','email','Logo.png','</body></html>','prod_primunit','Finished\x20Goods','../models/all_models','</tbody>','JO_number','$due_amount','gmail','Room_name','$product_details.product_name','getFullYear','Arabic\x20(ae)','\x20Order\x20Number\x20:\x20','message','<tr>','2329454RSGYRJ','prod_secondunit','$category','due_amount','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','note','English','<strong>\x20Regards\x20</strong>','secondary_code_hide','nodemailer','all_purchases_finished','json','primary_code','$product_details.bay','Enabled','secondary_code','../middleware/auth','product_stock','purchase\x20data\x20update\x20successfully','findOne','floor','Portuguese','24LACwLU','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','staff','Purchase\x20Return','map','add_purchases_finished','$product.type','\x20Order\x20Date\x20:\x20','French','</td>','Email\x20sent\x20successfully','$product.room_name','Spanish','createTransport','params','$paid_amount','findById','Paid\x20For\x20Purchase','<hr\x20class=\x22my-3\x22>','return_product','express','$date','product_code','catch','suppliers','QA\x20Warehouse','MaxStocks_data','<tbody\x20style=\x22text-align:\x20center;\x22>','room_name','updateOne','return_qty','prod_cat','/view/:id','path','Router','Purchase\x20Return\x20Mail','getMonth','</div>','/barcode_scanner','Error\x20Occurs','$product_details.rack','find','quantity','$batch_code','prod_code','English\x20(US)','$primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','1168270xPjGbu','<table\x20style=\x22width:\x20100%\x20!important;\x22>','getDate','maxStocks','host','maxperunit'];a0_0x2e3a=function(){return _0x39ba4c;};return a0_0x2e3a();}const express=require(a0_0x24dc2d(0x2b9)),app=express(),router=express[a0_0x24dc2d(0x1cb)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x24dc2d(0x281)),auth=require(a0_0x24dc2d(0x29e)),nodemailer=require(a0_0x24dc2d(0x297));var ejs=require(a0_0x24dc2d(0x25f));const path=require(a0_0x24dc2d(0x1ca)),users=require(a0_0x24dc2d(0x219));router[a0_0x24dc2d(0x245)]('/view',auth,async(_0x22aae1,_0x534230)=>{var _0x5c3c15=a0_0x24dc2d;try{const {username:_0x399ce5,email:_0x4475a6,role:_0x3976e2}=_0x22aae1['user'],_0x554a42=_0x22aae1[_0x5c3c15(0x1e0)],_0x57841e=await profile[_0x5c3c15(0x2a1)]({'email':_0x554a42['email']}),_0xe80042=await staff[_0x5c3c15(0x2a1)]({'email':_0x554a42['email']});if(_0x554a42[_0x5c3c15(0x291)]=='staff'){const _0xdfe7ab=await staff['findOne']({'email':_0x554a42[_0x5c3c15(0x27c)]});}const _0x4d9399=await master_shop['find']();let _0x107a5c;if(_0x554a42[_0x5c3c15(0x291)]==_0x5c3c15(0x2a7)){const _0x25aca7=await staff[_0x5c3c15(0x2a1)]({'email':_0x554a42[_0x5c3c15(0x27c)]});_0x107a5c=await purchases_finished[_0x5c3c15(0x1e9)]([{'$match':{'warehouse_name':_0x25aca7['warehouse']}},{'$lookup':{'from':'suppliers','localField':_0x5c3c15(0x2bd),'foreignField':_0x5c3c15(0x24f),'as':_0x5c3c15(0x22f)}},{'$unwind':_0x5c3c15(0x1e8)},{'$unwind':'$product'},{'$group':{'_id':_0x5c3c15(0x1e4),'invoice':{'$first':_0x5c3c15(0x202)},'suppliers':{'$first':_0x5c3c15(0x1f2)},'date':{'$first':_0x5c3c15(0x2ba)},'warehouse_name':{'$first':_0x5c3c15(0x241)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':_0x5c3c15(0x22b)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x5c3c15(0x284)},'return_data':{'$first':_0x5c3c15(0x253)},'batch_code':{'$first':_0x5c3c15(0x1d4)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x5c3c15(0x1e8)},'total_product_quantity':{'$sum':_0x5c3c15(0x1ea)},'level':{'$addToSet':_0x5c3c15(0x213)},'isle':{'$addToSet':_0x5c3c15(0x26a)},'type':{'$addToSet':_0x5c3c15(0x2ab)},'floorlevel':{'$addToSet':_0x5c3c15(0x200)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x107a5c=await purchases_finished[_0x5c3c15(0x1e9)]([{'$unwind':_0x5c3c15(0x1eb)},{'$group':{'_id':_0x5c3c15(0x1e4),'invoice':{'$first':_0x5c3c15(0x202)},'suppliers':{'$first':_0x5c3c15(0x1f2)},'date':{'$first':_0x5c3c15(0x2ba)},'warehouse_name':{'$first':_0x5c3c15(0x241)},'room':{'$addToSet':_0x5c3c15(0x2b0)},'product':{'$push':'$product'},'note':{'$first':_0x5c3c15(0x22b)},'paid_amount':{'$first':_0x5c3c15(0x2b4)},'due_amount':{'$first':_0x5c3c15(0x284)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x5c3c15(0x1d4)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x5c3c15(0x1ea)},'level':{'$addToSet':_0x5c3c15(0x213)},'isle':{'$addToSet':_0x5c3c15(0x26a)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x5c3c15(0x200)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x4d9399[0x0][_0x5c3c15(0x215)]==_0x5c3c15(0x1d6))var _0xc6a954=users[_0x5c3c15(0x294)];else{if(_0x4d9399[0x0][_0x5c3c15(0x215)]==_0x5c3c15(0x224))var _0xc6a954=users[_0x5c3c15(0x224)];else{if(_0x4d9399[0x0][_0x5c3c15(0x215)]=='German')var _0xc6a954=users[_0x5c3c15(0x208)];else{if(_0x4d9399[0x0]['language']=='Spanish')var _0xc6a954=users[_0x5c3c15(0x2b1)];else{if(_0x4d9399[0x0]['language']==_0x5c3c15(0x2ad))var _0xc6a954=users[_0x5c3c15(0x2ad)];else{if(_0x4d9399[0x0][_0x5c3c15(0x215)]==_0x5c3c15(0x2a5))var _0xc6a954=users[_0x5c3c15(0x2a3)];else{if(_0x4d9399[0x0][_0x5c3c15(0x215)]==_0x5c3c15(0x272))var _0xc6a954=users['Chinese'];else{if(_0x4d9399[0x0]['language']==_0x5c3c15(0x289))var _0xc6a954=users[_0x5c3c15(0x1e5)];}}}}}}}_0x534230['render'](_0x5c3c15(0x298),{'success':_0x22aae1[_0x5c3c15(0x279)](_0x5c3c15(0x203)),'errors':_0x22aae1['flash']('errors'),'purchases':_0x107a5c,'role':_0x554a42,'profile':_0x57841e,'master_shop':_0x4d9399,'language':_0xc6a954});}catch(_0x27942e){console['log'](_0x5c3c15(0x22d),_0x27942e),_0x534230[_0x5c3c15(0x218)](0xc8)[_0x5c3c15(0x299)]({'message':_0x27942e[_0x5c3c15(0x28b)]});}});function BayBinSelected(_0x504185,_0x55eaac){var _0x20c104=a0_0x24dc2d,_0x1e2cde=[],_0xfe6c86=[];if(_0x504185==_0x20c104(0x254)){switch(_0x55eaac){case _0x20c104(0x255):_0x1e2cde=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x20c104(0x22c):_0x1e2cde=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0xfe6c86=['DG'];}else{if(_0x504185=='FROZEN\x20GOODS'){switch(_0x55eaac){case'Rack\x201':_0x1e2cde=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x1e2cde=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0xfe6c86=['FG'];}}return{'levels':_0x1e2cde,'identify':_0xfe6c86};}async function getRandom8DigitNumber(){var _0x1b80bd=a0_0x24dc2d;const _0x11b267=0x989680,_0xd1b4ee=0x5f5e0ff,_0x423474=Math[_0x1b80bd(0x2a2)](Math['random']()*(_0xd1b4ee-_0x11b267+0x1))+_0x11b267;var _0xce2971;const _0x27de53=await purchases_finished[_0x1b80bd(0x2a1)]({'invoice':_0x1b80bd(0x1f7)+_0x423474});return _0x27de53&&_0x27de53[_0x1b80bd(0x24c)]>0x0?_0xce2971=_0x1b80bd(0x1f7)+_0x423474:_0xce2971=_0x1b80bd(0x1f7)+_0x423474,_0xce2971;}function a0_0x2dc9(_0xe91ae1,_0x1ee242){var _0x2e3a09=a0_0x2e3a();return a0_0x2dc9=function(_0x2dc983,_0x38b817){_0x2dc983=_0x2dc983-0x1c5;var _0x5b4d0b=_0x2e3a09[_0x2dc983];return _0x5b4d0b;},a0_0x2dc9(_0xe91ae1,_0x1ee242);}router[a0_0x24dc2d(0x245)](a0_0x24dc2d(0x261),auth,async(_0x5aba6a,_0x10bad0)=>{var _0x3c102c=a0_0x24dc2d;try{const {username:_0x3f6807,email:_0x13287d,role:_0x178339}=_0x5aba6a[_0x3c102c(0x1e0)],_0x2c1dda=_0x5aba6a[_0x3c102c(0x1e0)],_0x56cb07=await profile['findOne']({'email':_0x2c1dda[_0x3c102c(0x27c)]}),_0x22c6bc=await master_shop['find'](),_0x5dd9eb=await staff['findOne']({'email':_0x2c1dda[_0x3c102c(0x27c)]}),_0x269042=await suppliers[_0x3c102c(0x1d2)]({});let _0x18c119;if(_0x2c1dda[_0x3c102c(0x291)]==_0x3c102c(0x2a7)){const _0x436baf=await staff[_0x3c102c(0x2a1)]({'email':_0x2c1dda[_0x3c102c(0x27c)]});_0x18c119=await warehouse[_0x3c102c(0x1e9)]([{'$match':{'status':'Enabled','name':_0x436baf[_0x3c102c(0x24d)],'warehouse_category':_0x3c102c(0x280)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x18c119=await warehouse[_0x3c102c(0x1e9)]([{'$match':{'status':_0x3c102c(0x29c),'warehouse_category':_0x3c102c(0x280),'name':{'$ne':_0x3c102c(0x2be)}}},{'$group':{'_id':_0x3c102c(0x1fd),'name':{'$first':_0x3c102c(0x1fd)}}}]);const _0x17066a=await product[_0x3c102c(0x1d2)]({}),_0x41aae7=await warehouse[_0x3c102c(0x1d2)]({'status':_0x3c102c(0x29c)}),_0x38a91a=await purchases_finished[_0x3c102c(0x1d2)]({}),_0x69375a=_0x38a91a[_0x3c102c(0x24c)]+0x1,_0x430919=_0x3c102c(0x1f7)+_0x69375a['toString']()[_0x3c102c(0x234)](0x5,'0');var _0x1dfa17=['Ambient',_0x3c102c(0x20c)];if(_0x22c6bc[0x0][_0x3c102c(0x215)]==_0x3c102c(0x1d6))var _0x39687b=users[_0x3c102c(0x294)];else{if(_0x22c6bc[0x0][_0x3c102c(0x215)]==_0x3c102c(0x224))var _0x39687b=users[_0x3c102c(0x224)];else{if(_0x22c6bc[0x0][_0x3c102c(0x215)]==_0x3c102c(0x208))var _0x39687b=users['German'];else{if(_0x22c6bc[0x0]['language']==_0x3c102c(0x2b1))var _0x39687b=users[_0x3c102c(0x2b1)];else{if(_0x22c6bc[0x0]['language']==_0x3c102c(0x2ad))var _0x39687b=users['French'];else{if(_0x22c6bc[0x0][_0x3c102c(0x215)]==_0x3c102c(0x2a5))var _0x39687b=users['Portuguese'];else{if(_0x22c6bc[0x0][_0x3c102c(0x215)]==_0x3c102c(0x272))var _0x39687b=users[_0x3c102c(0x272)];else{if(_0x22c6bc[0x0][_0x3c102c(0x215)]==_0x3c102c(0x289))var _0x39687b=users[_0x3c102c(0x1e5)];}}}}}}}const _0x5cecbd=getRandom8DigitNumber();_0x5cecbd[_0x3c102c(0x229)](_0x37b487=>{var _0x3fc33c=_0x3c102c;_0x10bad0[_0x3fc33c(0x239)](_0x3fc33c(0x2aa),{'success':_0x5aba6a[_0x3fc33c(0x279)](_0x3fc33c(0x203)),'errors':_0x5aba6a[_0x3fc33c(0x279)]('errors'),'role':_0x2c1dda,'profile':_0x56cb07,'suppliers':_0x269042,'warehouse':_0x18c119,'product':_0x17066a,'invoice':_0x37b487,'master_shop':_0x22c6bc,'language':_0x39687b,'find_data':_0x41aae7,'rooms_data':_0x1dfa17});})[_0x3c102c(0x2bc)](_0x2bd338=>{var _0x132170=_0x3c102c;_0x5aba6a['flash'](_0x132170(0x1e2),_0x132170(0x1df)),_0x10bad0['redirect'](_0x132170(0x235));});}catch(_0x3547d4){console[_0x3c102c(0x26b)](_0x3547d4);}}),router['get'](a0_0x24dc2d(0x223),auth,async(_0x22c7df,_0x3a8f59)=>{var _0x5f0f62=a0_0x24dc2d;try{const _0x2e90ac=_0x22c7df['params']['id'];console[_0x5f0f62(0x26b)](_0x2e90ac);const _0x38e33d=await master_shop[_0x5f0f62(0x1d2)]();console[_0x5f0f62(0x26b)](_0x5f0f62(0x217),_0x38e33d);const _0x11aebc=await product['findOne']({'name':_0x2e90ac});console['log'](_0x5f0f62(0x221),_0x11aebc),_0x3a8f59['status'](0xc8)['json']({'product_data':_0x11aebc,'master':_0x38e33d});}catch(_0x593350){console[_0x5f0f62(0x26b)](_0x5f0f62(0x256),_0x593350);}}),router[a0_0x24dc2d(0x240)](a0_0x24dc2d(0x261),auth,async(_0x237f3e,_0x4983c4)=>{var _0x30ef54=a0_0x24dc2d;try{const {invoice:_0x32e591,date:_0x2ff8a9,warehouse_name:_0x4571a3,prod_name:_0x5ef24b,prod_code:_0x529cb8,prod_qty:_0x3d549d,prod_unit:_0x24bcd2,prod_secondunit:_0x310141,prod_level:_0xaf70f4,prod_isle:_0xfd7606,prod_pallet:_0x3642ff,note:_0x3c277a,expiry_date:_0x36a50b,batch_code:_0x4217e8,payable:_0x442548,due_amount:_0x39d27c,Room_name:_0x12cee3,primary_code:_0x5621f4,secondary_code:_0x20e86a,MaxStocks_data:_0x566c8c,PO_number:_0x4d7c57,SCRN:_0x167a27,JO_number:_0x1b7b01}=_0x237f3e[_0x30ef54(0x23f)];if(typeof _0x5ef24b=='string')var _0x24f2b3=[_0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x21e)]],_0x1ec5bc=[_0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x1d5)]],_0x159134=[_0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x1ef)]],_0x2592b0=[_0x237f3e['body']['prod_primunit']],_0x4051a7=[_0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x28e)]],_0x48a256=[_0x237f3e[_0x30ef54(0x23f)]['prod_level']],_0x1d34b9=[_0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x29a)]],_0x124dc2=[_0x237f3e['body'][_0x30ef54(0x29d)]],_0x4711db=[_0x237f3e['body'][_0x30ef54(0x2bf)]],_0x8fa7fa=[_0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x268)]],_0x2f7cb6=[_0x237f3e[_0x30ef54(0x23f)]['expiry_date']],_0x16e508=[_0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x21c)]],_0x554865=[_0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x1ec)]],_0x343e6c=[_0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x1c8)]],_0x5f2909=[_0x237f3e['body']['RoomAssign']],_0x1dda81=[_0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x20a)]];else var _0x24f2b3=[..._0x237f3e[_0x30ef54(0x23f)]['prod_name']],_0x1ec5bc=[..._0x237f3e['body'][_0x30ef54(0x1d5)]],_0x159134=[..._0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x1ef)]],_0x2592b0=[..._0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x27f)]],_0x4051a7=[..._0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x28e)]],_0x48a256=[..._0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x212)]],_0x1d34b9=[..._0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x29a)]],_0x124dc2=[..._0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x29d)]],_0x4711db=[..._0x237f3e['body'][_0x30ef54(0x2bf)]],_0x8fa7fa=[..._0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x268)]],_0x2f7cb6=[..._0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x25a)]],_0x16e508=[..._0x237f3e[_0x30ef54(0x23f)]['product_date']],_0x554865=[..._0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x1ec)]],_0x343e6c=[..._0x237f3e['body'][_0x30ef54(0x1c8)]],_0x5f2909=[..._0x237f3e[_0x30ef54(0x23f)][_0x30ef54(0x270)]],_0x1dda81=[..._0x237f3e['body'][_0x30ef54(0x20a)]];const _0x4d3fe4=_0x24f2b3[_0x30ef54(0x2a9)](_0x1cab04=>{return _0x1cab04={'product_name':_0x1cab04};});_0x1ec5bc[_0x30ef54(0x227)]((_0x50850d,_0x55e1f0)=>{var _0x34707d=_0x30ef54;_0x4d3fe4[_0x55e1f0][_0x34707d(0x2bb)]=_0x50850d;}),_0x159134[_0x30ef54(0x227)]((_0x36668a,_0x173d8a)=>{var _0x4506a1=_0x30ef54;_0x4d3fe4[_0x173d8a][_0x4506a1(0x1d3)]=_0x36668a;}),_0x2592b0[_0x30ef54(0x227)]((_0x19c544,_0x32b67c)=>{var _0x2fe92f=_0x30ef54;_0x4d3fe4[_0x32b67c][_0x2fe92f(0x233)]=_0x19c544;}),_0x4051a7[_0x30ef54(0x227)]((_0x38bec6,_0x26df5a)=>{var _0x3f13b8=_0x30ef54;_0x4d3fe4[_0x26df5a][_0x3f13b8(0x25d)]=_0x38bec6;}),_0x48a256[_0x30ef54(0x227)]((_0x11021f,_0x46de49)=>{var _0x1517db=_0x30ef54;_0x4d3fe4[_0x46de49][_0x1517db(0x1f6)]=_0x11021f;}),_0x1d34b9[_0x30ef54(0x227)]((_0x71410,_0x185f3c)=>{_0x4d3fe4[_0x185f3c]['primary_code']=_0x71410;}),_0x124dc2[_0x30ef54(0x227)]((_0x33729d,_0x2d5b78)=>{var _0x12a4f4=_0x30ef54;_0x4d3fe4[_0x2d5b78][_0x12a4f4(0x29d)]=_0x33729d;}),_0x4711db['forEach']((_0x5b948f,_0x5b24a1)=>{var _0x1f6e50=_0x30ef54;_0x4d3fe4[_0x5b24a1][_0x1f6e50(0x1dc)]=_0x5b948f;}),_0x8fa7fa[_0x30ef54(0x227)]((_0x41cf92,_0x4311e9)=>{var _0x153448=_0x30ef54;_0x4d3fe4[_0x4311e9][_0x153448(0x268)]=_0x41cf92;}),_0x2f7cb6[_0x30ef54(0x227)]((_0x435c1a,_0x5dc83b)=>{var _0x2616c9=_0x30ef54;_0x4d3fe4[_0x5dc83b][_0x2616c9(0x25a)]=_0x435c1a;}),_0x16e508[_0x30ef54(0x227)]((_0x28abbd,_0x16ae95)=>{var _0x4de8ef=_0x30ef54;_0x4d3fe4[_0x16ae95][_0x4de8ef(0x1f4)]=_0x28abbd;}),_0x554865[_0x30ef54(0x227)]((_0x47f149,_0x33be42)=>{_0x4d3fe4[_0x33be42]['maxperunit']=_0x47f149;}),_0x343e6c[_0x30ef54(0x227)]((_0x2b1afc,_0x3843fe)=>{var _0x2d16cf=_0x30ef54;_0x4d3fe4[_0x3843fe][_0x2d16cf(0x24b)]=_0x2b1afc;}),_0x5f2909[_0x30ef54(0x227)]((_0x4c7758,_0x4b7649)=>{var _0x32c090=_0x30ef54;_0x4d3fe4[_0x4b7649][_0x32c090(0x1c5)]=_0x4c7758;}),_0x1dda81['forEach']((_0x3841e4,_0x349a5e)=>{_0x4d3fe4[_0x349a5e]['invoice']=_0x3841e4;});const _0x2c7893=_0x4d3fe4['filter'](_0x568bc5=>_0x568bc5[_0x30ef54(0x1d3)]!=='0'&&_0x568bc5['quantity']!==''),_0x28edab=new purchases_finished({'invoice':_0x32e591,'suppliers':_0x237f3e['body']['suppliers'],'date':_0x2ff8a9,'warehouse_name':_0x4571a3,'product':_0x2c7893,'note':_0x3c277a,'due_amount':_0x39d27c,'room':_0x12cee3,'POnumber':_0x4d7c57,'SCRN':_0x167a27,'JO_number':_0x1b7b01}),_0x4bea6b=await _0x28edab['save'](),_0x521bf7=await purchases_finished[_0x30ef54(0x2a1)]({'invoice':_0x32e591}),_0x105de3=_0x521bf7['product'][_0x30ef54(0x2a9)](async _0x5a4000=>{var _0x512772=_0x30ef54,_0x550b22=await warehouse['findOne']({'name':_0x4571a3,'room':_0x5a4000[_0x512772(0x1c5)]}),_0x432250=0x0;const _0x23416b=_0x550b22['product_details'][_0x512772(0x2a9)](_0x3a2a94=>{var _0x224823=_0x512772;console[_0x224823(0x26b)](_0x3a2a94[_0x224823(0x275)]+'=='+_0x5a4000['product_name']+'&&'+_0x3a2a94[_0x224823(0x1f6)]+'=='+_0x5a4000['bay']+'&&'+_0x3a2a94[_0x224823(0x25a)]+'=='+_0x5a4000[_0x224823(0x25a)]+'&&'+_0x3a2a94[_0x224823(0x1f4)]+'=='+_0x5a4000[_0x224823(0x1f4)]+'&&'+_0x3a2a94[_0x224823(0x268)]+'=='+_0x5a4000[_0x224823(0x268)]+'&&'+_0x3a2a94[_0x224823(0x257)]+'=='+_0x521bf7[_0x224823(0x257)]),_0x3a2a94[_0x224823(0x275)]==_0x5a4000[_0x224823(0x275)]&&_0x3a2a94['bay']==_0x5a4000[_0x224823(0x1f6)]&&_0x3a2a94['expiry_date']==_0x5a4000[_0x224823(0x25a)]&&_0x3a2a94[_0x224823(0x1f4)]==_0x5a4000[_0x224823(0x1f4)]&&_0x3a2a94[_0x224823(0x268)]==_0x5a4000[_0x224823(0x268)]&&_0x3a2a94[_0x224823(0x257)]==_0x521bf7[_0x224823(0x257)]&&(_0x3a2a94[_0x224823(0x29f)]=_0x3a2a94[_0x224823(0x29f)]+_0x5a4000[_0x224823(0x1d3)],_0x432250++);});return _0x432250=='0'&&(_0x550b22['product_details']=_0x550b22[_0x512772(0x251)][_0x512772(0x249)]({'product_name':_0x5a4000['product_name'],'product_stock':_0x5a4000[_0x512772(0x1d3)],'primary_code':_0x5a4000['primary_code'],'secondary_code':_0x5a4000[_0x512772(0x29d)],'product_code':_0x5a4000['product_code'],'bay':_0x5a4000[_0x512772(0x1f6)],'maxProducts':_0x5a4000[_0x512772(0x1dc)],'unit':_0x5a4000[_0x512772(0x233)],'secondary_unit':_0x5a4000['secondary_unit'],'expiry_date':_0x5a4000[_0x512772(0x25a)],'production_date':_0x5a4000[_0x512772(0x1f4)],'maxProducts':_0x5a4000[_0x512772(0x1dc)],'maxPerUnit':_0x5a4000[_0x512772(0x1de)],'batch_code':_0x5a4000[_0x512772(0x268)],'product_cat':_0x5a4000[_0x512772(0x24b)],'invoice':_0x5a4000['invoice']})),_0x550b22;});Promise['all'](_0x105de3)[_0x30ef54(0x229)](async _0xf88d8f=>{var _0x1fa4de=_0x30ef54;try{for(const _0x52aa6b of _0xf88d8f){await warehouse[_0x1fa4de(0x1c6)]({'_id':_0x52aa6b[_0x1fa4de(0x21d)]},{'$addToSet':{'product_details':{'$each':_0x52aa6b[_0x1fa4de(0x251)]}}});}const _0x4f10f9=await master_shop[_0x1fa4de(0x1d2)](),_0x3e06ee=await email_settings['findOne'](),_0x1cf2ee=await supervisor_settings[_0x1fa4de(0x1d2)]();var _0x41416a=_0x521bf7['product'],_0x47c269='',_0x3e3284;for(_0x3e3284 in _0x41416a){var _0x51ec9c='FG';_0x521bf7[_0x1fa4de(0x1fc)]=='DRY\x20GOODS'&&(_0x51ec9c='DG'),_0x47c269+=_0x1fa4de(0x28c)+_0x1fa4de(0x1f1)+_0x41416a[_0x3e3284][_0x1fa4de(0x275)]+_0x1fa4de(0x2ae)+_0x1fa4de(0x1f1)+_0x41416a[_0x3e3284][_0x1fa4de(0x2bb)]+_0x1fa4de(0x2ae)+_0x1fa4de(0x1f1)+_0x41416a[_0x3e3284][_0x1fa4de(0x1d3)]+_0x1fa4de(0x2ae)+_0x1fa4de(0x1f1)+_0x41416a[_0x3e3284]['standard_unit']+_0x1fa4de(0x2ae)+_0x1fa4de(0x1f1)+_0x41416a[_0x3e3284][_0x1fa4de(0x25d)]+_0x1fa4de(0x2ae)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x521bf7[_0x1fa4de(0x1fc)]+_0x1fa4de(0x2ae)+_0x1fa4de(0x1f1)+_0x41416a[_0x3e3284][_0x1fa4de(0x1c5)]+'</td>'+_0x1fa4de(0x1f1)+_0x51ec9c+_0x41416a[_0x3e3284][_0x1fa4de(0x1f6)]+_0x1fa4de(0x2ae),_0x1fa4de(0x226);}let _0x568845=nodemailer[_0x1fa4de(0x2b2)]({'host':_0x3e06ee[_0x1fa4de(0x1dd)],'port':Number(_0x3e06ee[_0x1fa4de(0x20e)]),'secure':![],'auth':{'user':_0x3e06ee[_0x1fa4de(0x27c)],'pass':_0x3e06ee[_0x1fa4de(0x214)]}}),_0x192242={'from':_0x3e06ee[_0x1fa4de(0x27c)],'to':_0x1cf2ee[0x0][_0x1fa4de(0x26c)],'subject':_0x1fa4de(0x232),'attachments':[{'filename':_0x1fa4de(0x27d),'path':__dirname+_0x1fa4de(0x22a)+'/upload/'+_0x4f10f9[0x0][_0x1fa4de(0x265)],'cid':_0x1fa4de(0x204)}],'html':_0x1fa4de(0x1fa)+_0x1fa4de(0x209)+_0x1fa4de(0x243)+_0x1fa4de(0x206)+_0x1fa4de(0x237)+_0x1fa4de(0x206)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1fa4de(0x1ce)+_0x1fa4de(0x206)+_0x1fa4de(0x23a)+_0x4f10f9[0x0][_0x1fa4de(0x24a)]+_0x1fa4de(0x222)+_0x1fa4de(0x1ce)+_0x1fa4de(0x1ce)+_0x1fa4de(0x2b7)+_0x1fa4de(0x206)+_0x1fa4de(0x238)+_0x1fa4de(0x28a)+_0x521bf7['invoice']+'\x20'+_0x1fa4de(0x273)+_0x1fa4de(0x2ac)+_0x521bf7[_0x1fa4de(0x1e1)]+'\x20'+_0x1fa4de(0x236)+_0x1fa4de(0x1f5)+'</div>'+_0x1fa4de(0x1da)+_0x1fa4de(0x26d)+_0x1fa4de(0x28c)+_0x1fa4de(0x25c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x1fa4de(0x20d)+_0x1fa4de(0x24e)+_0x1fa4de(0x27b)+_0x1fa4de(0x228)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x1fa4de(0x292)+_0x1fa4de(0x226)+_0x1fa4de(0x207)+_0x1fa4de(0x2c0)+'\x20'+_0x47c269+'\x20'+'</tbody>'+_0x1fa4de(0x263)+'<div>'+_0x1fa4de(0x295)+_0x1fa4de(0x25e)+_0x4f10f9[0x0][_0x1fa4de(0x24a)]+_0x1fa4de(0x1f5)+'</div>'+_0x1fa4de(0x1ce)+_0x1fa4de(0x27e)};_0x568845[_0x1fa4de(0x27a)](_0x192242,function(_0x18418c,_0x9171a0){var _0x3ef97f=_0x1fa4de;_0x18418c?(console[_0x3ef97f(0x26b)](_0x18418c),console[_0x3ef97f(0x26b)](_0x3ef97f(0x1d0))):console[_0x3ef97f(0x26b)](_0x3ef97f(0x2af));});}catch(_0x3678ce){console[_0x1fa4de(0x26e)](_0x3678ce),_0x4983c4['status'](0x1f4)[_0x1fa4de(0x299)]({'error':_0x1fa4de(0x1ed),'message':_0x3678ce[_0x1fa4de(0x28b)]});}})[_0x30ef54(0x2bc)](_0x1d5853=>{var _0x1546a6=_0x30ef54;console[_0x1546a6(0x26e)](_0x1d5853),_0x4983c4[_0x1546a6(0x218)](0x1f4)[_0x1546a6(0x299)]({'error':'An\x20error\x20occurred.'});}),_0x237f3e[_0x30ef54(0x279)](_0x30ef54(0x203),_0x30ef54(0x278)),_0x4983c4[_0x30ef54(0x210)](_0x30ef54(0x235));}catch(_0x2e000f){console[_0x30ef54(0x26b)](_0x2e000f);}}),router[a0_0x24dc2d(0x245)](a0_0x24dc2d(0x211),auth,async(_0x344af4,_0x25c728)=>{var _0x175dd0=a0_0x24dc2d;try{const {username:_0x5cf471,email:_0x2d133c,role:_0x3a851e}=_0x344af4[_0x175dd0(0x1e0)],_0x282b8f=_0x344af4[_0x175dd0(0x1e0)],_0x1469f2=await profile['findOne']({'email':_0x282b8f['email']}),_0x443b42=await master_shop[_0x175dd0(0x1d2)](),_0x13d37d=_0x344af4[_0x175dd0(0x2b3)]['id'],_0x4783e9=await purchases_finished[_0x175dd0(0x2b5)](_0x13d37d),_0x26f9e3=await suppliers['find']({});let _0x3dd25c;if(_0x282b8f[_0x175dd0(0x291)]==_0x175dd0(0x2a7)){const _0x2e3211=await staff['findOne']({'email':_0x282b8f[_0x175dd0(0x27c)]});_0x3dd25c=await warehouse[_0x175dd0(0x1d2)]({'status':'Enabled','name':_0x2e3211['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x3dd25c=await warehouse[_0x175dd0(0x1e9)]([{'$match':{'status':_0x175dd0(0x29c),'warehouse_category':_0x175dd0(0x280)}},{'$group':{'_id':_0x175dd0(0x1fd),'name':{'$first':_0x175dd0(0x1fd)}}}]);const _0x493ef2=await product[_0x175dd0(0x1d2)]({}),_0xd3528b=BayBinSelected(_0x4783e9['warehouse_name'],_0x4783e9[_0x175dd0(0x230)]);let _0x65d80=new Date(_0x4783e9[_0x175dd0(0x25a)]),_0x44c230=('0'+_0x65d80[_0x175dd0(0x1db)]())['slice'](-0x2),_0x28e5b6=('0'+(_0x65d80[_0x175dd0(0x1cd)]()+0x1))[_0x175dd0(0x205)](-0x2),_0x2a0e71=_0x65d80['getFullYear'](),_0xdf564=_0x2a0e71+'-'+_0x28e5b6+'-'+_0x44c230;if(_0x443b42[0x0][_0x175dd0(0x215)]==_0x175dd0(0x1d6)){var _0x3ee849=users[_0x175dd0(0x294)];console[_0x175dd0(0x26b)](_0x3ee849);}else{if(_0x443b42[0x0][_0x175dd0(0x215)]==_0x175dd0(0x224))var _0x3ee849=users['Hindi'];else{if(_0x443b42[0x0][_0x175dd0(0x215)]==_0x175dd0(0x208))var _0x3ee849=users[_0x175dd0(0x208)];else{if(_0x443b42[0x0][_0x175dd0(0x215)]==_0x175dd0(0x2b1))var _0x3ee849=users['Spanish'];else{if(_0x443b42[0x0][_0x175dd0(0x215)]==_0x175dd0(0x2ad))var _0x3ee849=users['French'];else{if(_0x443b42[0x0][_0x175dd0(0x215)]==_0x175dd0(0x2a5))var _0x3ee849=users['Portuguese'];else{if(_0x443b42[0x0][_0x175dd0(0x215)]=='Chinese')var _0x3ee849=users[_0x175dd0(0x272)];else{if(_0x443b42[0x0][_0x175dd0(0x215)]=='Arabic\x20(ae)')var _0x3ee849=users[_0x175dd0(0x1e5)];}}}}}}}_0x25c728[_0x175dd0(0x239)](_0x175dd0(0x21a),{'success':_0x344af4[_0x175dd0(0x279)]('success'),'errors':_0x344af4['flash'](_0x175dd0(0x1e2)),'role':_0x282b8f,'profile':_0x1469f2,'purchases':_0x4783e9,'suppliers':_0x26f9e3,'warehouse':_0x3dd25c,'product':_0x493ef2,'master_shop':_0x443b42,'language':_0x3ee849,'ed_fullDate':_0xdf564,'dataSelected':_0xd3528b});}catch(_0x21c435){console['log'](_0x21c435);}}),router['get']('/view/:id',auth,async(_0x1a563f,_0x263005)=>{var _0x533b5e=a0_0x24dc2d;try{const {username:_0xeddd44,email:_0x557394,role:_0x5b9308}=_0x1a563f[_0x533b5e(0x1e0)],_0x47921c=_0x1a563f[_0x533b5e(0x1e0)],_0x58a7c7=await profile[_0x533b5e(0x2a1)]({'email':_0x47921c[_0x533b5e(0x27c)]}),_0x9e8ef4=await master_shop[_0x533b5e(0x1d2)](),_0x2baf9a=_0x1a563f[_0x533b5e(0x2b3)]['id'],_0x4da72c=await purchases_finished[_0x533b5e(0x2b5)](_0x2baf9a),_0x2590bb=await suppliers[_0x533b5e(0x1d2)]({});let _0x45d8c1;if(_0x47921c[_0x533b5e(0x291)]=='staff'){const _0x1e6fa3=await staff['findOne']({'email':_0x47921c[_0x533b5e(0x27c)]});_0x45d8c1=await warehouse[_0x533b5e(0x1d2)]({'status':_0x533b5e(0x29c),'name':_0x1e6fa3[_0x533b5e(0x24d)],'warehouse_category':_0x533b5e(0x280)});}else _0x45d8c1=await warehouse[_0x533b5e(0x1e9)]([{'$match':{'status':_0x533b5e(0x29c),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x533b5e(0x1fd),'name':{'$first':'$name'}}}]);const _0x3b79f2=await product[_0x533b5e(0x1d2)]({}),_0x305109=BayBinSelected(_0x4da72c[_0x533b5e(0x1fc)],_0x4da72c['room']);let _0x593dc5=new Date(_0x4da72c[_0x533b5e(0x25a)]),_0x45c4a9=('0'+_0x593dc5[_0x533b5e(0x1db)]())[_0x533b5e(0x205)](-0x2),_0x2f2b9f=('0'+(_0x593dc5[_0x533b5e(0x1cd)]()+0x1))['slice'](-0x2),_0x5dc098=_0x593dc5[_0x533b5e(0x288)](),_0x101283=_0x5dc098+'-'+_0x2f2b9f+'-'+_0x45c4a9;if(_0x9e8ef4[0x0][_0x533b5e(0x215)]==_0x533b5e(0x1d6)){var _0x466cf0=users[_0x533b5e(0x294)];console[_0x533b5e(0x26b)](_0x466cf0);}else{if(_0x9e8ef4[0x0]['language']==_0x533b5e(0x224))var _0x466cf0=users[_0x533b5e(0x224)];else{if(_0x9e8ef4[0x0][_0x533b5e(0x215)]==_0x533b5e(0x208))var _0x466cf0=users[_0x533b5e(0x208)];else{if(_0x9e8ef4[0x0][_0x533b5e(0x215)]==_0x533b5e(0x2b1))var _0x466cf0=users[_0x533b5e(0x2b1)];else{if(_0x9e8ef4[0x0]['language']=='French')var _0x466cf0=users[_0x533b5e(0x2ad)];else{if(_0x9e8ef4[0x0][_0x533b5e(0x215)]==_0x533b5e(0x2a5))var _0x466cf0=users[_0x533b5e(0x2a3)];else{if(_0x9e8ef4[0x0][_0x533b5e(0x215)]==_0x533b5e(0x272))var _0x466cf0=users[_0x533b5e(0x272)];else{if(_0x9e8ef4[0x0][_0x533b5e(0x215)]==_0x533b5e(0x289))var _0x466cf0=users[_0x533b5e(0x1e5)];}}}}}}}_0x263005[_0x533b5e(0x239)](_0x533b5e(0x1f3),{'success':_0x1a563f[_0x533b5e(0x279)](_0x533b5e(0x203)),'errors':_0x1a563f[_0x533b5e(0x279)](_0x533b5e(0x1e2)),'role':_0x47921c,'profile':_0x58a7c7,'purchases':_0x4da72c,'suppliers':_0x2590bb,'warehouse':_0x45d8c1,'product':_0x3b79f2,'master_shop':_0x9e8ef4,'language':_0x466cf0,'ed_fullDate':_0x101283,'dataSelected':_0x305109});}catch(_0x272c34){console[_0x533b5e(0x26b)](_0x272c34);}}),router['post'](a0_0x24dc2d(0x1c9),auth,async(_0x4113bd,_0x27b805)=>{var _0x21ba63=a0_0x24dc2d;try{const _0x4a7736=_0x4113bd['params']['id'],_0x3b7faf=await purchases_finished[_0x21ba63(0x2a1)]({'_id':_0x4113bd[_0x21ba63(0x2b3)]['id']}),_0x3849c5=await warehouse['findOne']({'name':_0x3b7faf['warehouse_name'],'room':_0x3b7faf[_0x21ba63(0x230)]});_0x3b7faf[_0x21ba63(0x221)]['forEach'](_0x2c08e6=>{var _0x5253b9=_0x21ba63;const _0x31e902=_0x3849c5[_0x5253b9(0x251)]['map'](_0x5f4a59=>{var _0x23aba9=_0x5253b9;_0x5f4a59['product_name']==_0x2c08e6[_0x23aba9(0x275)]&&_0x5f4a59['bay']==_0x2c08e6['bay']&&(_0x5f4a59['product_stock']=parseInt(_0x5f4a59[_0x23aba9(0x29f)])-parseInt(_0x2c08e6[_0x23aba9(0x1d3)]));});}),await _0x3849c5[_0x21ba63(0x22e)]();const {invoice:_0x209f64,suppliers:_0x170dbc,date:_0x461337,warehouse_name:_0x249805,prod_name:_0x48b6bc,prod_code:_0x153416,prod_qty:_0x564035,prod_unit:_0x1db249,prod_secondunit:_0x1ab84a,prod_level:_0x4bb1e6,prod_isle:_0x77f4a5,prod_pallet:_0x519207,note:_0x6e1146,expiry_date:_0x13a043,batch_code:_0x160b24,paid_amount:_0x106db0,due_amount:_0x2bda28,Room_name:_0x39fde6,primary_code:_0x3b9405,secondary_code:_0x19e3e1,PO_number:_0x1423b3,JO_number:_0x1d2c06}=_0x4113bd['body'];if(typeof _0x48b6bc==_0x21ba63(0x250))var _0x2cf974=[_0x4113bd[_0x21ba63(0x23f)]['prod_name']],_0xf58b1=[_0x4113bd['body'][_0x21ba63(0x1d5)]],_0x14d48f=[_0x4113bd[_0x21ba63(0x23f)]['prod_qty']],_0x4f3698=[_0x4113bd[_0x21ba63(0x23f)]['prod_unit']],_0x46da0a=[_0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x28e)]],_0x5c11ba=[_0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x212)]],_0x5be384=[_0x4113bd[_0x21ba63(0x23f)]['primary_code']],_0x492942=[_0x4113bd['body'][_0x21ba63(0x29d)]],_0x5425b0=[_0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x2bf)]],_0x43b631=[_0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x268)]],_0x6874f=[_0x4113bd['body'][_0x21ba63(0x25a)]];else var _0x2cf974=[..._0x4113bd[_0x21ba63(0x23f)]['prod_name']],_0xf58b1=[..._0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x1d5)]],_0x14d48f=[..._0x4113bd[_0x21ba63(0x23f)]['prod_qty']],_0x4f3698=[..._0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x244)]],_0x46da0a=[..._0x4113bd['body'][_0x21ba63(0x28e)]],_0x5c11ba=[..._0x4113bd[_0x21ba63(0x23f)]['prod_level']],_0x5be384=[..._0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x29a)]],_0x492942=[..._0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x29d)]],_0x5425b0=[..._0x4113bd[_0x21ba63(0x23f)]['MaxStocks_data']],_0x43b631=[..._0x4113bd['body']['batch_code']],_0x6874f=[..._0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x25a)]];const _0x2dac5f=_0x2cf974['map'](_0x59149c=>{return _0x59149c={'product_name':_0x59149c};});_0xf58b1[_0x21ba63(0x227)]((_0x181755,_0x2c7603)=>{var _0x1ff6eb=_0x21ba63;_0x2dac5f[_0x2c7603][_0x1ff6eb(0x2bb)]=_0x181755;}),_0x14d48f[_0x21ba63(0x227)]((_0x36f058,_0x4a8db7)=>{_0x2dac5f[_0x4a8db7]['quantity']=_0x36f058;}),_0x4f3698[_0x21ba63(0x227)]((_0x26dc19,_0x2e61a3)=>{_0x2dac5f[_0x2e61a3]['standard_unit']=_0x26dc19;}),_0x46da0a[_0x21ba63(0x227)]((_0x4f201b,_0x543ed9)=>{var _0x1d18f2=_0x21ba63;_0x2dac5f[_0x543ed9][_0x1d18f2(0x25d)]=_0x4f201b;}),_0x5c11ba['forEach']((_0x4ff556,_0x3501b7)=>{var _0x5c0dfc=_0x21ba63;_0x2dac5f[_0x3501b7][_0x5c0dfc(0x1f6)]=_0x4ff556;}),_0x5be384[_0x21ba63(0x227)]((_0x12076d,_0x29f22a)=>{_0x2dac5f[_0x29f22a]['primary_code']=_0x12076d;}),_0x492942['forEach']((_0x4c0b32,_0x2dd5e1)=>{var _0x2c4e96=_0x21ba63;_0x2dac5f[_0x2dd5e1][_0x2c4e96(0x29d)]=_0x4c0b32;}),_0x5425b0[_0x21ba63(0x227)]((_0x54b658,_0x4f2a57)=>{var _0x2ce3d6=_0x21ba63;_0x2dac5f[_0x4f2a57][_0x2ce3d6(0x1dc)]=_0x54b658;}),_0x43b631[_0x21ba63(0x227)]((_0x176ff6,_0x34b280)=>{var _0x1075b7=_0x21ba63;_0x2dac5f[_0x34b280][_0x1075b7(0x268)]=_0x176ff6;}),_0x6874f['forEach']((_0x495e28,_0x332849)=>{var _0x1e28fd=_0x21ba63;_0x2dac5f[_0x332849][_0x1e28fd(0x25a)]=_0x495e28;});const _0x1a29a7=_0x2dac5f[_0x21ba63(0x25b)](_0xf18dd2=>_0xf18dd2[_0x21ba63(0x1d3)]!=='0'&&_0xf18dd2[_0x21ba63(0x1d3)]!=='');_0x3b7faf[_0x21ba63(0x257)]=_0x209f64,_0x3b7faf[_0x21ba63(0x2bd)]=_0x170dbc,_0x3b7faf['date']=_0x461337,_0x3b7faf[_0x21ba63(0x1fc)]=_0x249805,_0x3b7faf[_0x21ba63(0x221)]=_0x1a29a7,_0x3b7faf[_0x21ba63(0x293)]=_0x6e1146,_0x3b7faf[_0x21ba63(0x1f0)]=_0x106db0,_0x3b7faf[_0x21ba63(0x290)]=_0x2bda28,_0x3b7faf[_0x21ba63(0x230)]=_0x39fde6,_0x3b7faf[_0x21ba63(0x1ee)]=_0x1423b3,_0x3b7faf[_0x21ba63(0x283)]=_0x1d2c06;const _0x26cbd9=await _0x3b7faf[_0x21ba63(0x22e)](),_0x238e85=await warehouse['findOne']({'name':_0x4113bd[_0x21ba63(0x23f)]['warehouse_name'],'room':_0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x286)]});_0x3b7faf['product'][_0x21ba63(0x227)](_0x1f6b9d=>{var _0x358d07=_0x21ba63,_0x9f29e4=0x0;const _0x51b2c3=_0x238e85[_0x358d07(0x251)][_0x358d07(0x2a9)](_0x47df4f=>{var _0x5d89ef=_0x358d07;_0x47df4f[_0x5d89ef(0x275)]==_0x1f6b9d[_0x5d89ef(0x275)]&&_0x47df4f[_0x5d89ef(0x1f6)]==_0x1f6b9d[_0x5d89ef(0x1f6)]&&(_0x47df4f['product_stock']=parseInt(_0x47df4f[_0x5d89ef(0x29f)])+parseInt(_0x1f6b9d[_0x5d89ef(0x1d3)]),_0x9f29e4++);});_0x9f29e4=='0'&&(_0x238e85['product_details']=_0x238e85[_0x358d07(0x251)][_0x358d07(0x249)]({'product_name':_0x1f6b9d[_0x358d07(0x275)],'product_stock':_0x1f6b9d[_0x358d07(0x1d3)],'primary_code':_0x1f6b9d[_0x358d07(0x29a)],'secondary_code':_0x1f6b9d[_0x358d07(0x29d)],'product_code':_0x1f6b9d[_0x358d07(0x2bb)],'bay':_0x1f6b9d[_0x358d07(0x1f6)],'maxProducts':_0x1f6b9d[_0x358d07(0x1dc)],'unit':_0x1f6b9d[_0x358d07(0x233)],'secondary_unit':_0x1f6b9d[_0x358d07(0x25d)],'expiry_date':_0x1f6b9d[_0x358d07(0x25a)]}));}),await _0x238e85[_0x21ba63(0x22e)]();const _0x224f6c=await s_payment_data[_0x21ba63(0x2a1)]({'invoice':_0x4113bd['body'][_0x21ba63(0x257)]});if(_0x224f6c===null){}else console[_0x21ba63(0x26b)]('suppliers',_0x224f6c,_0x4113bd['body'][_0x21ba63(0x257)]),_0x224f6c['suppliers']=_0x4113bd[_0x21ba63(0x23f)][_0x21ba63(0x2bd)],await _0x224f6c[_0x21ba63(0x22e)]();_0x4113bd[_0x21ba63(0x279)](_0x21ba63(0x203),_0x21ba63(0x2a0)),_0x27b805['redirect'](_0x21ba63(0x235));}catch(_0x3f6892){console[_0x21ba63(0x26b)](_0x3f6892);}}),router[a0_0x24dc2d(0x240)](a0_0x24dc2d(0x1e3),auth,async(_0x2d144e,_0x5bd0c5)=>{var _0x11eb68=a0_0x24dc2d;try{const _0x3a6096=_0x2d144e[_0x11eb68(0x2b3)]['id'],{invoice:_0x40ca28,suppliers:_0x54c4ab,payable:_0x15b195,due_amount:_0x2efd27}=_0x2d144e['body'],_0x12fa4c=await purchases[_0x11eb68(0x2b5)](_0x3a6096);var _0x510950=_0x15b195-_0x2efd27;_0x12fa4c['paid_amount']=parseFloat(_0x12fa4c[_0x11eb68(0x1f0)])+parseFloat(_0x2efd27),_0x12fa4c[_0x11eb68(0x290)]=_0x510950;const _0x5c9aa8=await _0x12fa4c[_0x11eb68(0x22e)]();console[_0x11eb68(0x26b)](_0x5c9aa8);const _0x505666=await s_payment_data[_0x11eb68(0x2a1)]({'invoice':_0x40ca28});_0x505666[_0x11eb68(0x20b)]=_0x510950,await _0x505666[_0x11eb68(0x22e)]();let _0x47a52f=new Date(),_0x51b34c=('0'+_0x47a52f[_0x11eb68(0x1db)]())[_0x11eb68(0x205)](-0x2),_0x3869ca=('0'+(_0x47a52f[_0x11eb68(0x1cd)]()+0x1))[_0x11eb68(0x205)](-0x2),_0x320a21=_0x47a52f[_0x11eb68(0x288)](),_0xcff4fa=_0x320a21+'-'+_0x3869ca+'-'+_0x51b34c;const _0x4821d0=new suppliers_payment({'invoice':_0x40ca28,'date':_0x320a21+'-'+_0x3869ca+'-'+_0x51b34c,'suppliers':_0x54c4ab,'reason':_0x11eb68(0x2b6),'amount':_0x2efd27}),_0x4896c7=await _0x4821d0[_0x11eb68(0x22e)]();_0x2d144e[_0x11eb68(0x279)](_0x11eb68(0x203),_0x11eb68(0x23b)),_0x5bd0c5[_0x11eb68(0x210)]('/all_purchases/view');}catch(_0x4168c7){console[_0x11eb68(0x26b)](_0x4168c7);}}),router['get']('/invoice/:id',auth,async(_0x27c95b,_0x2423c2)=>{var _0x41b477=a0_0x24dc2d;try{const {username:_0x171544,email:_0x867e79,role:_0x7ab7a2}=_0x27c95b['user'],_0xb5dcd8=_0x27c95b['user'],_0x52e1b9=await profile[_0x41b477(0x2a1)]({'email':_0xb5dcd8[_0x41b477(0x27c)]}),_0x262667=await master_shop['find']();console[_0x41b477(0x26b)](_0x41b477(0x217),_0x262667);const _0x365da4=_0x27c95b[_0x41b477(0x2b3)]['id'],_0x5d46c4=await purchases[_0x41b477(0x2b5)](_0x365da4);console[_0x41b477(0x26b)](_0x5d46c4);const _0x4cb9c2=await suppliers['findOne']({'name':_0x5d46c4[_0x41b477(0x2bd)]});console[_0x41b477(0x26b)](_0x4cb9c2);if(_0x262667[0x0][_0x41b477(0x215)]==_0x41b477(0x1d6)){var _0x175fbd=users[_0x41b477(0x294)];console[_0x41b477(0x26b)](_0x175fbd);}else{if(_0x262667[0x0][_0x41b477(0x215)]==_0x41b477(0x224))var _0x175fbd=users[_0x41b477(0x224)];else{if(_0x262667[0x0][_0x41b477(0x215)]==_0x41b477(0x208))var _0x175fbd=users[_0x41b477(0x208)];else{if(_0x262667[0x0][_0x41b477(0x215)]=='Spanish')var _0x175fbd=users[_0x41b477(0x2b1)];else{if(_0x262667[0x0]['language']==_0x41b477(0x2ad))var _0x175fbd=users[_0x41b477(0x2ad)];else{if(_0x262667[0x0][_0x41b477(0x215)]==_0x41b477(0x2a5))var _0x175fbd=users[_0x41b477(0x2a3)];else{if(_0x262667[0x0][_0x41b477(0x215)]==_0x41b477(0x272))var _0x175fbd=users[_0x41b477(0x272)];else{if(_0x262667[0x0]['language']=='Arabic\x20(ae)')var _0x175fbd=users[_0x41b477(0x1e5)];}}}}}}}_0x2423c2[_0x41b477(0x239)]('purchase_invoice',{'success':_0x27c95b[_0x41b477(0x279)](_0x41b477(0x203)),'errors':_0x27c95b[_0x41b477(0x279)](_0x41b477(0x1e2)),'role':_0xb5dcd8,'profile':_0x52e1b9,'master_shop':_0x262667,'supplier':_0x4cb9c2,'purchase':_0x5d46c4,'language':_0x175fbd});}catch(_0x442cd2){console[_0x41b477(0x26b)](_0x442cd2);}}),router['get'](a0_0x24dc2d(0x271),auth,async(_0x5acff4,_0x22553b)=>{var _0x24bff5=a0_0x24dc2d;try{const {username:_0x178751,email:_0x24a0ef,role:_0x434b13}=_0x5acff4[_0x24bff5(0x1e0)],_0x6d0f80=_0x5acff4[_0x24bff5(0x1e0)],_0x3f5a49=await profile[_0x24bff5(0x2a1)]({'email':_0x6d0f80[_0x24bff5(0x27c)]}),_0x293f9e=await master_shop['find']();console[_0x24bff5(0x26b)](_0x24bff5(0x217),_0x293f9e);const _0x3b4780=_0x5acff4[_0x24bff5(0x2b3)]['id'];console['log'](_0x3b4780);const _0x4d6653=await purchases_finished['findById'](_0x3b4780);console[_0x24bff5(0x26b)]('user_id',_0x4d6653);const _0x39cdcf=await product[_0x24bff5(0x1d2)]({}),_0xe609a7=await warehouse[_0x24bff5(0x1e9)]([{'$match':{'name':_0x4d6653[_0x24bff5(0x1fc)],'room':_0x4d6653[_0x24bff5(0x230)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x24bff5(0x287)},'product_stock':{'$first':_0x24bff5(0x276)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x24bff5(0x274)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x24bff5(0x260)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x24bff5(0x201)},'storage':{'$first':_0x24bff5(0x1fe)},'rack':{'$first':_0x24bff5(0x1d1)}}}]);console[_0x24bff5(0x26b)](_0x24bff5(0x1f9),_0xe609a7);let _0x526477;if(_0x6d0f80['role']==_0x24bff5(0x2a7)){const _0x92178d=await staff[_0x24bff5(0x2a1)]({'email':_0x6d0f80['email']});_0x526477=await warehouse['find']({'status':_0x24bff5(0x29c),'name':_0x92178d[_0x24bff5(0x24d)],'warehouse_category':_0x24bff5(0x280),'name':_0x24bff5(0x248)});}else _0x526477=await warehouse[_0x24bff5(0x1e9)]([{'$match':{'status':_0x24bff5(0x29c),'warehouse_category':_0x24bff5(0x280),'name':_0x24bff5(0x248)}},{'$group':{'_id':_0x24bff5(0x1fd),'name':{'$first':_0x24bff5(0x1fd)}}}]);if(_0x293f9e[0x0][_0x24bff5(0x215)]==_0x24bff5(0x1d6)){var _0x12aa80=users[_0x24bff5(0x294)];console[_0x24bff5(0x26b)](_0x12aa80);}else{if(_0x293f9e[0x0]['language']==_0x24bff5(0x224))var _0x12aa80=users[_0x24bff5(0x224)];else{if(_0x293f9e[0x0][_0x24bff5(0x215)]==_0x24bff5(0x208))var _0x12aa80=users[_0x24bff5(0x208)];else{if(_0x293f9e[0x0][_0x24bff5(0x215)]=='Spanish')var _0x12aa80=users[_0x24bff5(0x2b1)];else{if(_0x293f9e[0x0][_0x24bff5(0x215)]==_0x24bff5(0x2ad))var _0x12aa80=users[_0x24bff5(0x2ad)];else{if(_0x293f9e[0x0][_0x24bff5(0x215)]=='Portuguese\x20(BR)')var _0x12aa80=users['Portuguese'];else{if(_0x293f9e[0x0][_0x24bff5(0x215)]==_0x24bff5(0x272))var _0x12aa80=users[_0x24bff5(0x272)];else{if(_0x293f9e[0x0]['language']==_0x24bff5(0x289))var _0x12aa80=users['Arabic'];}}}}}}}_0x22553b[_0x24bff5(0x239)]('return_purchase_finished',{'success':_0x5acff4['flash']('success'),'errors':_0x5acff4[_0x24bff5(0x279)]('errors'),'role':_0x6d0f80,'profile':_0x3f5a49,'user':_0x4d6653,'stock':_0xe609a7,'master_shop':_0x293f9e,'product':_0x39cdcf,'language':_0x12aa80,'warehouse':_0x526477});}catch(_0x121cd1){console['log'](_0x121cd1);}}),router[a0_0x24dc2d(0x240)](a0_0x24dc2d(0x271),auth,async(_0x2c0622,_0xdb7bc1)=>{var _0x295b16=a0_0x24dc2d;try{const {invoice:_0x46f918,date:_0x117d96,warehouse_name:_0xbfb4c8,Room_name:_0x122906,product_name:_0x3a3785,purchase_quantity:_0x202525,stocks:_0x23a6dd,return_qty:_0x2343bf,note:_0x5540d0,level:_0x596fee,isle:_0x2ba285,pallet:_0x337d07,to_warehouse_name:_0x385c24,to_Room_name:_0x21ec1f}=_0x2c0622[_0x295b16(0x23f)],_0x177e8e=await purchases_finished[_0x295b16(0x2a1)]({'_id':_0x2c0622[_0x295b16(0x2b3)]['id']}),_0x48c4b4=await warehouse[_0x295b16(0x2a1)]({'name':_0xbfb4c8,'room':_0x122906,'warehouse_category':_0x295b16(0x280)});if(typeof _0x3a3785==_0x295b16(0x250))var _0x142fda=[_0x2c0622[_0x295b16(0x23f)]['product_name']],_0x421dad=[_0x2c0622['body'][_0x295b16(0x259)]],_0x58ee12=[_0x2c0622[_0x295b16(0x23f)]['stocks']],_0x29399a=[_0x2c0622['body'][_0x295b16(0x1c7)]],_0x327609=[_0x2c0622[_0x295b16(0x23f)][_0x295b16(0x277)]],_0x3e3b96=[_0x2c0622['body'][_0x295b16(0x246)]],_0x5d8aa4=[_0x2c0622[_0x295b16(0x23f)][_0x295b16(0x225)]],_0x2546b3=[_0x2c0622['body']['secondary_code_hide']];else var _0x142fda=[..._0x2c0622[_0x295b16(0x23f)][_0x295b16(0x275)]],_0x421dad=[..._0x2c0622[_0x295b16(0x23f)][_0x295b16(0x259)]],_0x58ee12=[..._0x2c0622[_0x295b16(0x23f)][_0x295b16(0x23c)]],_0x29399a=[..._0x2c0622['body'][_0x295b16(0x1c7)]],_0x327609=[..._0x2c0622[_0x295b16(0x23f)]['level']],_0x3e3b96=[..._0x2c0622['body'][_0x295b16(0x246)]],_0x5d8aa4=[..._0x2c0622[_0x295b16(0x23f)]['primary_code_hide']],_0x2546b3=[..._0x2c0622[_0x295b16(0x23f)][_0x295b16(0x296)]];const _0x3cb1f4=_0x142fda[_0x295b16(0x2a9)](_0x561276=>{return _0x561276={'product_name':_0x561276};});_0x421dad[_0x295b16(0x227)]((_0x538063,_0x2a363b)=>{_0x3cb1f4[_0x2a363b]['purchase_quantity']=_0x538063;}),_0x58ee12[_0x295b16(0x227)]((_0x31f140,_0x115c58)=>{_0x3cb1f4[_0x115c58]['stock_quantity']=_0x31f140;}),_0x29399a[_0x295b16(0x227)]((_0x3d8ab5,_0x42ac37)=>{_0x3cb1f4[_0x42ac37]['return_qty']=_0x3d8ab5;}),_0x327609[_0x295b16(0x227)]((_0x51f310,_0x31ba3d)=>{_0x3cb1f4[_0x31ba3d]['bay']=_0x51f310;}),_0x3e3b96[_0x295b16(0x227)]((_0x46a1d2,_0x294703)=>{var _0x34c3a2=_0x295b16;_0x3cb1f4[_0x294703][_0x34c3a2(0x2bb)]=_0x46a1d2;}),_0x5d8aa4[_0x295b16(0x227)]((_0x59a566,_0x5226ed)=>{var _0x75dfd0=_0x295b16;_0x3cb1f4[_0x5226ed][_0x75dfd0(0x29a)]=_0x59a566;}),_0x2546b3[_0x295b16(0x227)]((_0x420876,_0x127546)=>{var _0x2ce9d1=_0x295b16;_0x3cb1f4[_0x127546][_0x2ce9d1(0x29d)]=_0x420876;}),_0x3cb1f4[_0x295b16(0x227)](_0x145e1b=>{var _0x9dc87f=_0x295b16;console[_0x9dc87f(0x26b)](_0x145e1b);const _0x434c66=_0x48c4b4[_0x9dc87f(0x251)][_0x9dc87f(0x2a9)](_0x47e542=>{var _0x3a2b35=_0x9dc87f;_0x47e542[_0x3a2b35(0x275)]==_0x145e1b[_0x3a2b35(0x275)]&&_0x47e542[_0x3a2b35(0x1f6)]==_0x145e1b['bay']&&(console[_0x3a2b35(0x26b)](parseInt(_0x47e542[_0x3a2b35(0x29f)])+'\x20<>\x20'+parseInt(_0x145e1b['return_qty'])),_0x47e542[_0x3a2b35(0x29f)]=parseInt(_0x47e542['product_stock'])-parseInt(_0x145e1b[_0x3a2b35(0x1c7)]));});}),await _0x48c4b4[_0x295b16(0x22e)]();var _0x5969ad=0x0;_0x3cb1f4[_0x295b16(0x227)](_0x37c7c5=>{var _0x1c0a3e=_0x295b16;(parseInt(_0x37c7c5[_0x1c0a3e(0x259)])<parseInt(_0x37c7c5['return_qty'])||parseInt(_0x37c7c5[_0x1c0a3e(0x252)])<parseInt(_0x37c7c5['return_qty']))&&_0x5969ad++;});if(_0x5969ad!=0x0)return _0x2c0622[_0x295b16(0x279)](_0x295b16(0x1e2),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0xdb7bc1[_0x295b16(0x210)]('back');const _0x1b2828=new purchases_return_finished({'invoice':_0x46f918,'suppliers':_0x2c0622[_0x295b16(0x23f)][_0x295b16(0x2bd)],'date':_0x117d96,'warehouse_name':_0xbfb4c8,'return_product':_0x3cb1f4,'note':_0x5540d0,'room':_0x122906,'to_warehouse_name':_0x385c24,'to_room':_0x21ec1f}),_0x2c9345=await _0x1b2828['save'](),_0x13adb8=await purchases_return_finished[_0x295b16(0x2a1)]({'invoice':_0x46f918}),_0x376484=await warehouse[_0x295b16(0x2a1)]({'name':_0x385c24,'room':_0x21ec1f,'warehouse_category':_0x295b16(0x280)});_0x13adb8[_0x295b16(0x2b8)][_0x295b16(0x227)](_0x5cfa78=>{var _0x54b75b=_0x295b16,_0x22100c=0x0;const _0x19aaae=_0x376484[_0x54b75b(0x251)]['map'](_0x1ec361=>{var _0x3984ca=_0x54b75b;console['log'](_0x1ec361[_0x3984ca(0x275)]+'=='+_0x5cfa78['product_name']+'&&'+_0x1ec361['bay']+'=='+_0x5cfa78[_0x3984ca(0x1f6)]),_0x1ec361['product_name']==_0x5cfa78[_0x3984ca(0x275)]&&_0x1ec361['bay']==_0x5cfa78[_0x3984ca(0x1f6)]&&(_0x1ec361[_0x3984ca(0x29f)]=parseInt(_0x1ec361[_0x3984ca(0x29f)])-parseInt(_0x5cfa78[_0x3984ca(0x1c7)]),_0x22100c++);});_0x22100c=='0'&&(_0x376484['product_details']=_0x376484[_0x54b75b(0x251)][_0x54b75b(0x249)]({'product_name':_0x5cfa78[_0x54b75b(0x275)],'product_stock':_0x5cfa78['return_qty'],'primary_code':_0x5cfa78[_0x54b75b(0x29a)],'secondary_code':_0x5cfa78[_0x54b75b(0x29d)],'product_code':_0x5cfa78[_0x54b75b(0x2bb)],'bay':_0x5cfa78['bay'],'maxProducts':0xf423f}));}),await _0x376484[_0x295b16(0x22e)]();const _0x459904=await purchases_finished[_0x295b16(0x2a1)]({'invoice':_0x46f918});_0x459904[_0x295b16(0x26f)]='True';const _0x1962a6=await _0x459904[_0x295b16(0x22e)](),_0x552463=new s_payment_data({'invoice':_0x46f918,'suppliers':_0x2c0622['body']['suppliers'],'reason':_0x295b16(0x2a8)});await _0x552463[_0x295b16(0x22e)]();const _0x49d05b=await master_shop[_0x295b16(0x1d2)](),_0x146c04=await email_settings['findOne'](),_0x5f0e41=await suppliers[_0x295b16(0x2a1)]({'name':_0x2c0622['body'][_0x295b16(0x2bd)]});_0x49d05b[0x0][_0x295b16(0x242)]==0x1?(right_currency=_0x49d05b[0x0][_0x295b16(0x1ff)],left_currency=''):(right_currency='',left_currency=_0x49d05b[0x0]['currency']);var _0x3dc13c=_0x142fda,_0x13a40b=_0x29399a,_0x436e29='',_0x584d5f;for(_0x584d5f in _0x3dc13c){_0x436e29+=_0x295b16(0x28c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3dc13c[_0x584d5f]+_0x295b16(0x2ae)+_0x295b16(0x1f1)+_0x13a40b[_0x584d5f]+_0x295b16(0x2ae)+_0x295b16(0x226);}let _0x5b1982=nodemailer['createTransport']({'service':_0x295b16(0x285),'auth':{'user':_0x146c04['email'],'pass':_0x146c04[_0x295b16(0x214)]}}),_0x49914f={'from':_0x146c04[_0x295b16(0x27c)],'to':_0x5f0e41['email'],'subject':_0x295b16(0x1cc),'attachments':[{'filename':_0x295b16(0x27d),'path':__dirname+_0x295b16(0x22a)+_0x295b16(0x21b)+_0x49d05b[0x0][_0x295b16(0x265)],'cid':_0x295b16(0x204)}],'html':_0x295b16(0x1fa)+_0x295b16(0x209)+_0x295b16(0x243)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x295b16(0x206)+_0x295b16(0x258)+_0x295b16(0x1ce)+'<div>'+'<h2>\x20'+_0x49d05b[0x0]['site_title']+_0x295b16(0x222)+_0x295b16(0x1ce)+'</div>'+_0x295b16(0x2b7)+_0x295b16(0x206)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x295b16(0x28a)+_0x46f918+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x295b16(0x2ac)+_0x117d96+'\x20'+_0x295b16(0x236)+_0x295b16(0x1f5)+_0x295b16(0x1ce)+_0x295b16(0x1da)+_0x295b16(0x26d)+_0x295b16(0x28c)+_0x295b16(0x25c)+_0x295b16(0x1d8)+_0x295b16(0x20f)+_0x295b16(0x2a6)+'</tr>'+_0x295b16(0x207)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x436e29+'\x20'+_0x295b16(0x282)+'</table>'+_0x295b16(0x206)+_0x295b16(0x295)+_0x295b16(0x25e)+_0x49d05b[0x0][_0x295b16(0x24a)]+'</h5>'+_0x295b16(0x1ce)+_0x295b16(0x1ce)+_0x295b16(0x27e)};_0x5b1982[_0x295b16(0x27a)](_0x49914f,function(_0x40254e,_0x3b3d91){var _0x598d45=_0x295b16;_0x40254e?console[_0x598d45(0x26b)]('Error\x20Occurs'):console[_0x598d45(0x26b)](_0x598d45(0x2af));}),_0x2c0622[_0x295b16(0x279)](_0x295b16(0x203),'purchases\x20item\x20return\x20successfull'),_0xdb7bc1[_0x295b16(0x210)](_0x295b16(0x235));}catch(_0x4e852b){_0xdb7bc1['status'](0xc8)[_0x295b16(0x299)]({'message':_0x4e852b[_0x295b16(0x28b)]});}}),router[a0_0x24dc2d(0x245)]('/barcode/:id',auth,async(_0x307789,_0x391fc8)=>{var _0x368056=a0_0x24dc2d;try{const {username:_0x31d8b4,email:_0x2599f2,role:_0x16c0cd}=_0x307789[_0x368056(0x1e0)],_0x751dcf=_0x307789[_0x368056(0x1e0)],_0x188313=await profile['findOne']({'email':_0x751dcf[_0x368056(0x27c)]}),_0x32245c=await master_shop[_0x368056(0x1d2)](),_0x1852b4=_0x307789[_0x368056(0x2b3)]['id'],_0x13a3a5=await purchases_finished[_0x368056(0x2b5)](_0x1852b4);if(_0x32245c[0x0][_0x368056(0x215)]==_0x368056(0x1d6))var _0x577e6f=users[_0x368056(0x294)];else{if(_0x32245c[0x0][_0x368056(0x215)]==_0x368056(0x224))var _0x577e6f=users['Hindi'];else{if(_0x32245c[0x0][_0x368056(0x215)]=='German')var _0x577e6f=users[_0x368056(0x208)];else{if(_0x32245c[0x0][_0x368056(0x215)]==_0x368056(0x2b1))var _0x577e6f=users[_0x368056(0x2b1)];else{if(_0x32245c[0x0][_0x368056(0x215)]==_0x368056(0x2ad))var _0x577e6f=users[_0x368056(0x2ad)];else{if(_0x32245c[0x0]['language']==_0x368056(0x2a5))var _0x577e6f=users[_0x368056(0x2a3)];else{if(_0x32245c[0x0][_0x368056(0x215)]==_0x368056(0x272))var _0x577e6f=users[_0x368056(0x272)];else{if(_0x32245c[0x0][_0x368056(0x215)]==_0x368056(0x289))var _0x577e6f=users[_0x368056(0x1e5)];}}}}}}}_0x391fc8[_0x368056(0x239)]('all_purchases_barcode',{'success':_0x307789[_0x368056(0x279)](_0x368056(0x203)),'errors':_0x307789['flash'](_0x368056(0x1e2)),'role':_0x751dcf,'profile':_0x188313,'alldata':_0x13a3a5,'master_shop':_0x32245c,'language':_0x577e6f}),console[_0x368056(0x26b)](alldata);}catch(_0x59caf4){console['log'](_0x59caf4);}}),router[a0_0x24dc2d(0x240)](a0_0x24dc2d(0x1cf),async(_0x3164e1,_0x5cdd61)=>{var _0x4d7db1=a0_0x24dc2d;const {product_code:_0x5d8825}=_0x3164e1[_0x4d7db1(0x23f)];var _0x2c5479;const _0x1db9ea=await product['aggregate']([{'$match':{'primary_code':_0x5d8825,'product_category':_0x4d7db1(0x280)}},{'$group':{'_id':'$_id','name':{'$first':_0x4d7db1(0x1fd)},'category':{'$first':'$category'},'brand':{'$first':_0x4d7db1(0x247)},'unit':{'$first':_0x4d7db1(0x1e7)},'alertquantity':{'$first':_0x4d7db1(0x21f)},'product_code':{'$first':_0x4d7db1(0x216)},'primary_code':{'$first':_0x4d7db1(0x1d7)},'secondary_code':{'$first':_0x4d7db1(0x267)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x4d7db1(0x1f8)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4d7db1(0x1e6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x349559=await product[_0x4d7db1(0x1e9)]([{'$match':{'secondary_code':_0x5d8825}},{'$group':{'_id':_0x4d7db1(0x1e4),'name':{'$first':'$name'},'category':{'$first':_0x4d7db1(0x28f)},'brand':{'$first':_0x4d7db1(0x247)},'unit':{'$first':_0x4d7db1(0x1e7)},'alertquantity':{'$first':_0x4d7db1(0x21f)},'product_code':{'$first':_0x4d7db1(0x216)},'primary_code':{'$first':_0x4d7db1(0x1d7)},'secondary_code':{'$first':_0x4d7db1(0x267)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x4d7db1(0x1f8)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4d7db1(0x1e6)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1db9ea[_0x4d7db1(0x24c)]>0x0)_0x2c5479=_0x1db9ea;else _0x349559[_0x4d7db1(0x24c)]>0x0&&(_0x2c5479=_0x349559);_0x5cdd61[_0x4d7db1(0x299)](_0x2c5479);}),router[a0_0x24dc2d(0x240)](a0_0x24dc2d(0x266),async(_0x1db2a5,_0x14544a)=>{var _0x2e2b07=a0_0x24dc2d;const {productCode:_0x3d03f6,bay:_0x2291aa,warehouses:_0x3f6401,room:_0x45672f}=_0x1db2a5[_0x2e2b07(0x23f)];console[_0x2e2b07(0x26b)](_0x1db2a5[_0x2e2b07(0x23f)]);try{const _0xbd8353=await warehouse[_0x2e2b07(0x1e9)]([{'$match':{'name':_0x3f6401,'room':_0x45672f}},{'$unwind':_0x2e2b07(0x262)},{'$match':{'product_details.bay':parseInt(_0x2291aa)}},{'$group':{'_id':_0x2e2b07(0x264),'name':{'$first':_0x2e2b07(0x287)},'product_stock':{'$first':_0x2e2b07(0x276)},'bay':{'$first':_0x2e2b07(0x29b)},'maxProducts':{'$first':_0x2e2b07(0x23e)}}}]);_0x14544a['status'](0xc8)[_0x2e2b07(0x299)](_0xbd8353);}catch(_0x2b3920){_0x14544a[_0x2e2b07(0x218)](0x194)['json']({'message':_0x2b3920[_0x2e2b07(0x28b)]});}}),module['exports']=router;