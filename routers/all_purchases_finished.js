var a0_0x38e3e5=a0_0x53c0;(function(_0x4ec782,_0x1abab5){var _0x3d4061=a0_0x53c0,_0x19f5ce=_0x4ec782();while(!![]){try{var _0x37c201=-parseInt(_0x3d4061(0x280))/0x1+parseInt(_0x3d4061(0x255))/0x2*(parseInt(_0x3d4061(0x21c))/0x3)+parseInt(_0x3d4061(0x1ca))/0x4*(-parseInt(_0x3d4061(0x26d))/0x5)+parseInt(_0x3d4061(0x24c))/0x6+-parseInt(_0x3d4061(0x241))/0x7*(parseInt(_0x3d4061(0x23f))/0x8)+-parseInt(_0x3d4061(0x24f))/0x9*(-parseInt(_0x3d4061(0x264))/0xa)+-parseInt(_0x3d4061(0x20d))/0xb;if(_0x37c201===_0x1abab5)break;else _0x19f5ce['push'](_0x19f5ce['shift']());}catch(_0x13dd71){_0x19f5ce['push'](_0x19f5ce['shift']());}}}(a0_0x29d7,0x3aba4));function a0_0x53c0(_0x4e8fc2,_0x5d37f3){var _0x29d7be=a0_0x29d7();return a0_0x53c0=function(_0x53c0cd,_0x3c6471){_0x53c0cd=_0x53c0cd-0x192;var _0x33986f=_0x29d7be[_0x53c0cd];return _0x33986f;},a0_0x53c0(_0x4e8fc2,_0x5d37f3);}const express=require(a0_0x38e3e5(0x24d)),app=express(),router=express[a0_0x38e3e5(0x1fc)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x38e3e5(0x212)),auth=require(a0_0x38e3e5(0x206)),nodemailer=require('nodemailer');var ejs=require(a0_0x38e3e5(0x1de));const path=require(a0_0x38e3e5(0x1bc)),users=require(a0_0x38e3e5(0x27d));router[a0_0x38e3e5(0x199)](a0_0x38e3e5(0x1e7),auth,async(_0x343467,_0x255ef9)=>{var _0x330e0b=a0_0x38e3e5;try{const {username:_0x3199bd,email:_0x4a19fd,role:_0x3f191a}=_0x343467[_0x330e0b(0x22d)],_0x40dfac=_0x343467['user'],_0x4dfb69=await profile[_0x330e0b(0x23e)]({'email':_0x40dfac[_0x330e0b(0x1d3)]}),_0x11dbe3=await staff[_0x330e0b(0x23e)]({'email':_0x40dfac['email']});if(_0x40dfac[_0x330e0b(0x207)]==_0x330e0b(0x291)){const _0x552487=await staff['findOne']({'email':_0x40dfac[_0x330e0b(0x1d3)]});}const _0x1ecc00=await master_shop[_0x330e0b(0x227)]();let _0x43ebba;if(_0x40dfac[_0x330e0b(0x207)]==_0x330e0b(0x291)){const _0x5b9f3a=await staff[_0x330e0b(0x23e)]({'email':_0x40dfac['email']});_0x43ebba=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x5b9f3a['warehouse']}},{'$lookup':{'from':_0x330e0b(0x1e2),'localField':_0x330e0b(0x1e2),'foreignField':_0x330e0b(0x1f2),'as':'suppliers_docs'}},{'$unwind':_0x330e0b(0x27b)},{'$unwind':'$product'},{'$group':{'_id':_0x330e0b(0x230),'invoice':{'$first':_0x330e0b(0x25f)},'suppliers':{'$first':_0x330e0b(0x274)},'date':{'$first':_0x330e0b(0x224)},'warehouse_name':{'$first':_0x330e0b(0x1b5)},'room':{'$first':_0x330e0b(0x1be)},'product':{'$push':_0x330e0b(0x1b7)},'note':{'$first':_0x330e0b(0x1c7)},'paid_amount':{'$first':_0x330e0b(0x220)},'due_amount':{'$first':_0x330e0b(0x203)},'return_data':{'$first':_0x330e0b(0x1a9)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x330e0b(0x27b)},'total_product_quantity':{'$sum':_0x330e0b(0x210)},'level':{'$addToSet':_0x330e0b(0x294)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x330e0b(0x259)},'floorlevel':{'$addToSet':_0x330e0b(0x288)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x43ebba=await purchases_finished[_0x330e0b(0x1cb)]([{'$unwind':_0x330e0b(0x1b7)},{'$group':{'_id':_0x330e0b(0x230),'invoice':{'$first':_0x330e0b(0x25f)},'suppliers':{'$first':_0x330e0b(0x274)},'date':{'$first':_0x330e0b(0x224)},'warehouse_name':{'$first':_0x330e0b(0x1b5)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x330e0b(0x1b7)},'note':{'$first':_0x330e0b(0x1c7)},'paid_amount':{'$first':_0x330e0b(0x220)},'due_amount':{'$first':_0x330e0b(0x203)},'return_data':{'$first':_0x330e0b(0x1a9)},'batch_code':{'$first':_0x330e0b(0x1f1)},'expiry_date':{'$first':_0x330e0b(0x233)},'suppliers_docs':{'$first':_0x330e0b(0x27b)},'total_product_quantity':{'$sum':_0x330e0b(0x210)},'level':{'$addToSet':_0x330e0b(0x294)},'isle':{'$addToSet':_0x330e0b(0x216)},'type':{'$addToSet':_0x330e0b(0x259)},'floorlevel':{'$addToSet':_0x330e0b(0x288)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x1ecc00[0x0][_0x330e0b(0x263)]==_0x330e0b(0x252))var _0x5bcd87=users['English'];else{if(_0x1ecc00[0x0]['language']==_0x330e0b(0x223))var _0x5bcd87=users[_0x330e0b(0x223)];else{if(_0x1ecc00[0x0][_0x330e0b(0x263)]==_0x330e0b(0x1d2))var _0x5bcd87=users[_0x330e0b(0x1d2)];else{if(_0x1ecc00[0x0][_0x330e0b(0x263)]==_0x330e0b(0x1d7))var _0x5bcd87=users[_0x330e0b(0x1d7)];else{if(_0x1ecc00[0x0][_0x330e0b(0x263)]==_0x330e0b(0x243))var _0x5bcd87=users[_0x330e0b(0x243)];else{if(_0x1ecc00[0x0]['language']==_0x330e0b(0x27f))var _0x5bcd87=users[_0x330e0b(0x296)];else{if(_0x1ecc00[0x0][_0x330e0b(0x263)]==_0x330e0b(0x28d))var _0x5bcd87=users[_0x330e0b(0x28d)];else{if(_0x1ecc00[0x0]['language']=='Arabic\x20(ae)')var _0x5bcd87=users['Arabic'];}}}}}}}_0x255ef9[_0x330e0b(0x293)](_0x330e0b(0x20e),{'success':_0x343467[_0x330e0b(0x28a)](_0x330e0b(0x23a)),'errors':_0x343467[_0x330e0b(0x28a)](_0x330e0b(0x24e)),'purchases':_0x43ebba,'role':_0x40dfac,'profile':_0x4dfb69,'master_shop':_0x1ecc00,'language':_0x5bcd87});}catch(_0x9f36b9){console[_0x330e0b(0x1a4)]('table\x20page',_0x9f36b9),_0x255ef9[_0x330e0b(0x1ee)](0xc8)[_0x330e0b(0x21a)]({'message':_0x9f36b9[_0x330e0b(0x1ef)]});}});function a0_0x29d7(){var _0x384fe1=['Spanish','$product_details.primary_code','/view/add_purchases/:id','prod_secondunit','Enabled','site_title','map','ejs','product','stock_quantity','Ambient','suppliers','Arabic\x20(ae)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','slice','catch','/view','batch_code','</td>','Rack\x202','<table\x20style=\x22width:\x20100%\x20!important;\x22>','findById','$product_details.maxProducts','status','message','product_code_hide','$batch_code','name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','English','add_purchases_finished','product_stock','edit_purchases_finished','master','prod_invoice','\x20<>\x20','</span>','Router','\x20Order\x20Number\x20:\x20','getDate','Return\x20Goods','return_data','image','maxStocks','$due_amount','warehouse_name','purchase_invoice','../middleware/auth','role','$alertquantity','_id','string','$maxStocks','<span\x20style=\x22float:\x20right;\x22>','2404149AFsvzY','all_purchases_finished','prod_code','$product.quantity','Rack\x201','../models/all_models','INCF-','DRY\x20GOODS','primary_code','$product.bin','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','getMonth','Room_name','json','quantity','652791pXDvZa','<strong>\x20Regards\x20</strong>','$product_code','</tr>','$paid_amount','FGSEmail','secondary_unit','Hindi','$date','paid_amount','prod_name','find','<h5\x20style=\x22text-align:\x20left;\x22>','error','QA\x20Warehouse','/invoice/:id','/all_purchases_finished/view','user','standard_unit','back','$_id','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$expiry_date','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','payment\x20successfull','There\x27s\x20a\x20error\x20in\x20this\x20transaction','prod_qty','filter','toString','success','stock_data','all','/give_payment/:id','findOne','3352xuMDgK','padStart','5999XdBSHg','$product_details.storage','French','invoice','secondary_code_hide','</head><body>','all_purchases_barcode','createTransport','$secondary_code','Finished\x20Goods','Email\x20sent\x20successfully','2537736BxgfAj','express','errors','454131nanGMP','product_code','/view/return_purchase/:id','English\x20(US)','</thead>','logo','4eSQkZF','$brand','$name','/preview/:id','$product.type','purchase_quantity','$maxProdPerUnit','prod_cat','then','length','$invoice','$secondary_unit','getFullYear','prod_primunit','language','70kzopjd','port','due_amount','warehouse','$product_details.bin','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','return_product','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','345DhFQBj','FROZEN\x20GOODS','/all_purchases/view','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','currency_placement','/CheckingWarehouse','Paid\x20For\x20Purchase','$suppliers','Error\x20occurred\x20while\x20processing\x20product:','</body></html>','Purchase\x20Mail','primary_code_hide','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$suppliers_docs','maxperunit','../public/language/languages.json','prod_Qty','Portuguese\x20(BR)','129524BCpqdZ','updateOne','An\x20error\x20occurred\x20while\x20saving\x20data.','</h5>','<div>','max_product_unit','save','params','$product.floorlevel','$product_details.floorlevel','flash','$unit','expiry_date','Chinese','post','</tbody>','sendMail','staff','/barcode_scanner','render','$product.bay','purchase\x20data\x20add\x20successfully','Portuguese','<!DOCTYPE\x20html>','\x20Order\x20Date\x20:\x20','$product_details.product_stock','currency','prod_level','$product_details.secondary_code','Purchase\x20Return\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','get','room','\x20</h2>','<h5>','date','</div>','$product_details.type','room_name','abs','Logo.png','product_name','log','<tbody\x20style=\x22text-align:\x20center;\x22>','$primary_code','product_date','return_qty','$return_data','gmail','amount','stocks','<h2>\x20','JO_number','/upload/','production_date','bay','concat','POnumber','prod_unit','$warehouse_name','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product','floor','body','secondary_code','True','path','forEach','$room','/../public','$product_details.product_code','/view/add_purchases','edit_purchases_finished_view','RoomAssign','<tr>','Purchase\x20Return','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$note','purchase\x20data\x20update\x20successfully','level','15284TqsNdG','aggregate','Enclosed','$product_details.bay','product_cat','/view/:id','Arabic','Error\x20Occurs','German','email','<html><head><title></title>','product_details','MaxStocks_data'];a0_0x29d7=function(){return _0x384fe1;};return a0_0x29d7();}function BayBinSelected(_0x165040,_0x3c9992){var _0x3e1533=a0_0x38e3e5,_0x42f8ff=[],_0x28a5ec=[];if(_0x165040==_0x3e1533(0x214)){switch(_0x3c9992){case _0x3e1533(0x211):_0x42f8ff=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x42f8ff=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x28a5ec=['DG'];}else{if(_0x165040==_0x3e1533(0x26e)){switch(_0x3c9992){case _0x3e1533(0x211):_0x42f8ff=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x3e1533(0x1ea):_0x42f8ff=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x28a5ec=['FG'];}}return{'levels':_0x42f8ff,'identify':_0x28a5ec};}async function getRandom8DigitNumber(){var _0x2a07f8=a0_0x38e3e5;const _0x309315=0x989680,_0x3dedaa=0x5f5e0ff,_0x43a956=Math[_0x2a07f8(0x1b8)](Math['random']()*(_0x3dedaa-_0x309315+0x1))+_0x309315;var _0x26df7c;const _0x17cd6c=await purchases_finished['findOne']({'invoice':_0x2a07f8(0x213)+_0x43a956});return _0x17cd6c&&_0x17cd6c['length']>0x0?_0x26df7c=_0x2a07f8(0x213)+_0x43a956:_0x26df7c='INCF-'+_0x43a956,_0x26df7c;}router[a0_0x38e3e5(0x199)](a0_0x38e3e5(0x1c1),auth,async(_0x35b4ac,_0x4b8776)=>{var _0x17fb49=a0_0x38e3e5;try{const {username:_0x2463f1,email:_0x23950f,role:_0x5c4e45}=_0x35b4ac['user'],_0x23bee0=_0x35b4ac[_0x17fb49(0x22d)],_0x2ab69d=await profile['findOne']({'email':_0x23bee0['email']}),_0x52e7e3=await master_shop['find'](),_0x1d28fa=await staff['findOne']({'email':_0x23bee0[_0x17fb49(0x1d3)]}),_0x36822e=await suppliers['find']({});let _0x2f3325;if(_0x23bee0['role']==_0x17fb49(0x291)){const _0x5de2cf=await staff['findOne']({'email':_0x23bee0['email']});_0x2f3325=await warehouse[_0x17fb49(0x1cb)]([{'$match':{'status':_0x17fb49(0x1db),'name':_0x5de2cf[_0x17fb49(0x267)],'warehouse_category':_0x17fb49(0x24a)}},{'$group':{'_id':_0x17fb49(0x257),'name':{'$first':'$name'}}}]);}else _0x2f3325=await warehouse[_0x17fb49(0x1cb)]([{'$match':{'status':_0x17fb49(0x1db),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x17fb49(0x22a)}}},{'$group':{'_id':_0x17fb49(0x257),'name':{'$first':_0x17fb49(0x257)}}}]);const _0x2b8346=await product[_0x17fb49(0x227)]({}),_0x33b010=await warehouse['find']({'status':_0x17fb49(0x1db)}),_0x6affcc=await purchases_finished[_0x17fb49(0x227)]({}),_0x440248=_0x6affcc[_0x17fb49(0x25e)]+0x1,_0x3974d6=_0x17fb49(0x213)+_0x440248[_0x17fb49(0x239)]()[_0x17fb49(0x240)](0x5,'0');var _0x2db884=[_0x17fb49(0x1e1),_0x17fb49(0x1cc)];if(_0x52e7e3[0x0][_0x17fb49(0x263)]=='English\x20(US)')var _0x1b92f2=users[_0x17fb49(0x1f4)];else{if(_0x52e7e3[0x0][_0x17fb49(0x263)]==_0x17fb49(0x223))var _0x1b92f2=users[_0x17fb49(0x223)];else{if(_0x52e7e3[0x0]['language']==_0x17fb49(0x1d2))var _0x1b92f2=users[_0x17fb49(0x1d2)];else{if(_0x52e7e3[0x0][_0x17fb49(0x263)]==_0x17fb49(0x1d7))var _0x1b92f2=users[_0x17fb49(0x1d7)];else{if(_0x52e7e3[0x0][_0x17fb49(0x263)]==_0x17fb49(0x243))var _0x1b92f2=users[_0x17fb49(0x243)];else{if(_0x52e7e3[0x0][_0x17fb49(0x263)]=='Portuguese\x20(BR)')var _0x1b92f2=users[_0x17fb49(0x296)];else{if(_0x52e7e3[0x0][_0x17fb49(0x263)]=='Chinese')var _0x1b92f2=users[_0x17fb49(0x28d)];else{if(_0x52e7e3[0x0][_0x17fb49(0x263)]==_0x17fb49(0x1e3))var _0x1b92f2=users[_0x17fb49(0x1d0)];}}}}}}}const _0x3a110c=getRandom8DigitNumber();_0x3a110c[_0x17fb49(0x25d)](_0x4d9f5a=>{var _0x14c61f=_0x17fb49;_0x4b8776['render'](_0x14c61f(0x1f5),{'success':_0x35b4ac[_0x14c61f(0x28a)](_0x14c61f(0x23a)),'errors':_0x35b4ac[_0x14c61f(0x28a)](_0x14c61f(0x24e)),'role':_0x23bee0,'profile':_0x2ab69d,'suppliers':_0x36822e,'warehouse':_0x2f3325,'product':_0x2b8346,'invoice':_0x4d9f5a,'master_shop':_0x52e7e3,'language':_0x1b92f2,'find_data':_0x33b010,'rooms_data':_0x2db884});})[_0x17fb49(0x1e6)](_0x2d37b8=>{var _0xa85e2=_0x17fb49;_0x35b4ac[_0xa85e2(0x28a)](_0xa85e2(0x24e),_0xa85e2(0x236)),_0x4b8776[_0xa85e2(0x279)](_0xa85e2(0x22c));});}catch(_0x2a59a2){console[_0x17fb49(0x1a4)](_0x2a59a2);}}),router[a0_0x38e3e5(0x199)](a0_0x38e3e5(0x1d9),auth,async(_0x18b4b3,_0x50e5bc)=>{var _0x262d63=a0_0x38e3e5;try{const _0x1d6c63=_0x18b4b3[_0x262d63(0x287)]['id'];console[_0x262d63(0x1a4)](_0x1d6c63);const _0x4b2153=await master_shop['find']();console[_0x262d63(0x1a4)]('master',_0x4b2153);const _0x360265=await product[_0x262d63(0x23e)]({'name':_0x1d6c63});console['log'](_0x262d63(0x1df),_0x360265),_0x50e5bc[_0x262d63(0x1ee)](0xc8)[_0x262d63(0x21a)]({'product_data':_0x360265,'master':_0x4b2153});}catch(_0x3881d3){console['log']('add_purchases\x20error',_0x3881d3);}}),router['post'](a0_0x38e3e5(0x1c1),auth,async(_0x4d5098,_0x32d393)=>{var _0x3edb82=a0_0x38e3e5;try{const {invoice:_0x2e5d66,date:_0x410323,warehouse_name:_0x189867,prod_name:_0x37ce07,prod_code:_0x358f0f,prod_qty:_0x4501ce,prod_unit:_0x2cd26e,prod_secondunit:_0x14e8c8,prod_level:_0x20d6fe,prod_isle:_0x3d21b6,prod_pallet:_0x1bdc41,note:_0x5963bb,expiry_date:_0x46e6bd,batch_code:_0x35910,payable:_0x445afc,due_amount:_0x53378d,Room_name:_0x49ceb5,primary_code:_0x205f16,secondary_code:_0x54f56f,MaxStocks_data:_0x112b2b,PO_number:_0x52e15f,SCRN:_0x563278,JO_number:_0x5e1992}=_0x4d5098[_0x3edb82(0x1b9)];if(typeof _0x37ce07==_0x3edb82(0x20a))var _0x1a80a2=[_0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x226)]],_0x1627d9=[_0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x20f)]],_0x42a14a=[_0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x27e)]],_0x51b302=[_0x4d5098['body'][_0x3edb82(0x262)]],_0x40db05=[_0x4d5098['body'][_0x3edb82(0x1da)]],_0x16e1f8=[_0x4d5098['body'][_0x3edb82(0x195)]],_0x42c9ba=[_0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x215)]],_0x8009bf=[_0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x1ba)]],_0x5ded8e=[_0x4d5098['body']['MaxStocks_data']],_0x550881=[_0x4d5098[_0x3edb82(0x1b9)]['batch_code']],_0x174992=[_0x4d5098[_0x3edb82(0x1b9)]['expiry_date']],_0x1f83be=[_0x4d5098['body']['product_date']],_0x415b98=[_0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x285)]],_0x274fe8=[_0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x25c)]],_0x9d8bb7=[_0x4d5098[_0x3edb82(0x1b9)]['RoomAssign']],_0x32384c=[_0x4d5098['body'][_0x3edb82(0x1f9)]];else var _0x1a80a2=[..._0x4d5098['body'][_0x3edb82(0x226)]],_0x1627d9=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x20f)]],_0x42a14a=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x27e)]],_0x51b302=[..._0x4d5098[_0x3edb82(0x1b9)]['prod_primunit']],_0x40db05=[..._0x4d5098[_0x3edb82(0x1b9)]['prod_secondunit']],_0x16e1f8=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x195)]],_0x42c9ba=[..._0x4d5098['body']['primary_code']],_0x8009bf=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x1ba)]],_0x5ded8e=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x1d6)]],_0x550881=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x1e8)]],_0x174992=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x28c)]],_0x1f83be=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x1a7)]],_0x415b98=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x285)]],_0x274fe8=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x25c)]],_0x9d8bb7=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x1c3)]],_0x32384c=[..._0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x1f9)]];const _0x556647=_0x1a80a2['map'](_0x18560c=>{return _0x18560c={'product_name':_0x18560c};});_0x1627d9[_0x3edb82(0x1bd)]((_0x2c66bf,_0x5bf205)=>{_0x556647[_0x5bf205]['product_code']=_0x2c66bf;}),_0x42a14a[_0x3edb82(0x1bd)]((_0x5b6374,_0x2d9983)=>{var _0x598fe3=_0x3edb82;_0x556647[_0x2d9983][_0x598fe3(0x21b)]=Math[_0x598fe3(0x1a1)](_0x5b6374);}),_0x51b302[_0x3edb82(0x1bd)]((_0x3c04ff,_0x7ee859)=>{var _0x399df1=_0x3edb82;_0x556647[_0x7ee859][_0x399df1(0x22e)]=_0x3c04ff;}),_0x40db05[_0x3edb82(0x1bd)]((_0x24c755,_0x109be4)=>{_0x556647[_0x109be4]['secondary_unit']=_0x24c755;}),_0x16e1f8[_0x3edb82(0x1bd)]((_0x33bf80,_0x315d45)=>{var _0x4ef612=_0x3edb82;_0x556647[_0x315d45][_0x4ef612(0x1b1)]=_0x33bf80;}),_0x42c9ba[_0x3edb82(0x1bd)]((_0x35b564,_0x1724a7)=>{_0x556647[_0x1724a7]['primary_code']=_0x35b564;}),_0x8009bf[_0x3edb82(0x1bd)]((_0x2e181a,_0x234d8c)=>{var _0x562d13=_0x3edb82;_0x556647[_0x234d8c][_0x562d13(0x1ba)]=_0x2e181a;}),_0x5ded8e[_0x3edb82(0x1bd)]((_0xae397a,_0xba040e)=>{_0x556647[_0xba040e]['maxStocks']=_0xae397a;}),_0x550881[_0x3edb82(0x1bd)]((_0x45012e,_0x5cbaf1)=>{var _0x4a6301=_0x3edb82;_0x556647[_0x5cbaf1][_0x4a6301(0x1e8)]=_0x45012e;}),_0x174992[_0x3edb82(0x1bd)]((_0x16786f,_0xd0befd)=>{var _0x436717=_0x3edb82;_0x556647[_0xd0befd][_0x436717(0x28c)]=_0x16786f;}),_0x1f83be['forEach']((_0x27179d,_0x50271b)=>{var _0xa77c00=_0x3edb82;_0x556647[_0x50271b][_0xa77c00(0x1b0)]=_0x27179d;}),_0x415b98['forEach']((_0x49e50d,_0x15a5b4)=>{var _0x2ac9d3=_0x3edb82;_0x556647[_0x15a5b4][_0x2ac9d3(0x27c)]=_0x49e50d;}),_0x274fe8[_0x3edb82(0x1bd)]((_0x2d5d17,_0x229c26)=>{var _0x2b8846=_0x3edb82;_0x556647[_0x229c26][_0x2b8846(0x1ce)]=_0x2d5d17;}),_0x9d8bb7['forEach']((_0x4ae66d,_0x4b959d)=>{_0x556647[_0x4b959d]['room_name']=_0x4ae66d;}),_0x32384c[_0x3edb82(0x1bd)]((_0x34c839,_0x3c48c5)=>{var _0x892ca9=_0x3edb82;_0x556647[_0x3c48c5][_0x892ca9(0x244)]=_0x34c839;});const _0x7aff8f=_0x556647['filter'](_0x1e77b3=>_0x1e77b3[_0x3edb82(0x21b)]!=='0'&&_0x1e77b3[_0x3edb82(0x21b)]!==''),_0x56c52e=new purchases_finished({'invoice':_0x2e5d66,'suppliers':_0x4d5098[_0x3edb82(0x1b9)][_0x3edb82(0x1e2)],'date':_0x410323,'warehouse_name':_0x189867,'product':_0x7aff8f,'note':_0x5963bb,'due_amount':_0x53378d,'room':_0x49ceb5,'POnumber':_0x52e15f,'SCRN':_0x563278,'JO_number':_0x5e1992}),_0x22a1e6=await _0x56c52e[_0x3edb82(0x286)](),_0x2e4378=await purchases_finished['findOne']({'invoice':_0x2e5d66}),_0x237510=_0x2e4378[_0x3edb82(0x1df)][_0x3edb82(0x1dd)](async _0x339d5d=>{var _0xc27f0e=_0x3edb82;try{var _0x55ea29=await warehouse['findOne']({'name':_0x189867,'room':_0x339d5d[_0xc27f0e(0x1a0)]}),_0x259149=0x0;const _0x52a5b6=_0x55ea29[_0xc27f0e(0x1d5)][_0xc27f0e(0x1dd)](_0x4d2e91=>{var _0x24375e=_0xc27f0e;console['log'](_0x4d2e91[_0x24375e(0x1a3)]+'=='+_0x339d5d[_0x24375e(0x1a3)]+'&&'+_0x4d2e91[_0x24375e(0x1b1)]+'=='+_0x339d5d[_0x24375e(0x1b1)]+'&&'+_0x4d2e91[_0x24375e(0x28c)]+'=='+_0x339d5d[_0x24375e(0x28c)]+'&&'+_0x4d2e91[_0x24375e(0x1b0)]+'=='+_0x339d5d[_0x24375e(0x1b0)]+'&&'+_0x4d2e91[_0x24375e(0x1e8)]+'=='+_0x339d5d['batch_code']+'&&'+_0x4d2e91[_0x24375e(0x244)]+'=='+_0x2e4378[_0x24375e(0x244)]),_0x4d2e91[_0x24375e(0x1a3)]==_0x339d5d[_0x24375e(0x1a3)]&&_0x4d2e91[_0x24375e(0x1b1)]==_0x339d5d[_0x24375e(0x1b1)]&&_0x4d2e91[_0x24375e(0x28c)]==_0x339d5d[_0x24375e(0x28c)]&&_0x4d2e91[_0x24375e(0x1b0)]==_0x339d5d[_0x24375e(0x1b0)]&&_0x4d2e91[_0x24375e(0x1e8)]==_0x339d5d[_0x24375e(0x1e8)]&&_0x4d2e91[_0x24375e(0x244)]==_0x2e4378[_0x24375e(0x244)]&&(_0x4d2e91[_0x24375e(0x1f6)]=Math[_0x24375e(0x1a1)](_0x4d2e91['product_stock'])+Math[_0x24375e(0x1a1)](_0x339d5d[_0x24375e(0x21b)]),_0x259149++);});return _0x259149==0x0&&(_0x55ea29[_0xc27f0e(0x1d5)]=_0x55ea29[_0xc27f0e(0x1d5)][_0xc27f0e(0x1b2)]({'product_name':_0x339d5d[_0xc27f0e(0x1a3)],'product_stock':Math[_0xc27f0e(0x1a1)](_0x339d5d[_0xc27f0e(0x21b)]),'primary_code':_0x339d5d['primary_code'],'secondary_code':_0x339d5d[_0xc27f0e(0x1ba)],'product_code':_0x339d5d[_0xc27f0e(0x250)],'bay':_0x339d5d[_0xc27f0e(0x1b1)],'maxProducts':_0x339d5d[_0xc27f0e(0x202)],'unit':_0x339d5d[_0xc27f0e(0x22e)],'secondary_unit':_0x339d5d[_0xc27f0e(0x222)],'expiry_date':_0x339d5d[_0xc27f0e(0x28c)],'production_date':_0x339d5d[_0xc27f0e(0x1b0)],'maxProducts':_0x339d5d['maxStocks'],'maxPerUnit':_0x339d5d['maxperunit'],'batch_code':_0x339d5d['batch_code'],'product_cat':_0x339d5d[_0xc27f0e(0x1ce)],'invoice':_0x339d5d[_0xc27f0e(0x244)],'id_incoming':_0x339d5d[_0xc27f0e(0x209)]})),_0x55ea29;}catch(_0x1c471c){return console['error'](_0xc27f0e(0x275),_0x1c471c),null;}});Promise[_0x3edb82(0x23c)](_0x237510)[_0x3edb82(0x25d)](async _0x14b351=>{var _0x57c1f6=_0x3edb82;try{for(const _0x3454bd of _0x14b351){await warehouse[_0x57c1f6(0x281)]({'_id':_0x3454bd[_0x57c1f6(0x209)]},{'$addToSet':{'product_details':{'$each':_0x3454bd[_0x57c1f6(0x1d5)]}}});}const _0x4112b2=await master_shop[_0x57c1f6(0x227)](),_0x35bb6f=await email_settings[_0x57c1f6(0x23e)](),_0x2f44cf=await supervisor_settings['find']();var _0x377ebb=_0x2e4378['product'],_0xe747cd='',_0x447f5a;for(_0x447f5a in _0x377ebb){var _0x33bf74='FG';_0x2e4378[_0x57c1f6(0x204)]==_0x57c1f6(0x214)&&(_0x33bf74='DG'),_0xe747cd+=_0x57c1f6(0x1c4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x377ebb[_0x447f5a][_0x57c1f6(0x1a3)]+_0x57c1f6(0x1e9)+_0x57c1f6(0x217)+_0x377ebb[_0x447f5a][_0x57c1f6(0x250)]+_0x57c1f6(0x1e9)+_0x57c1f6(0x217)+_0x377ebb[_0x447f5a][_0x57c1f6(0x21b)]+'</td>'+_0x57c1f6(0x217)+_0x377ebb[_0x447f5a][_0x57c1f6(0x22e)]+_0x57c1f6(0x1e9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x377ebb[_0x447f5a]['secondary_unit']+_0x57c1f6(0x1e9)+_0x57c1f6(0x217)+_0x2e4378[_0x57c1f6(0x204)]+_0x57c1f6(0x1e9)+_0x57c1f6(0x217)+_0x377ebb[_0x447f5a][_0x57c1f6(0x1a0)]+_0x57c1f6(0x1e9)+_0x57c1f6(0x217)+_0x33bf74+_0x377ebb[_0x447f5a][_0x57c1f6(0x1b1)]+_0x57c1f6(0x1e9),_0x57c1f6(0x21f);}let _0x2e3dc5=nodemailer[_0x57c1f6(0x248)]({'host':_0x35bb6f['host'],'port':Number(_0x35bb6f[_0x57c1f6(0x265)]),'secure':![],'auth':{'user':_0x35bb6f['email'],'pass':_0x35bb6f['password']}}),_0x544f5b={'from':_0x35bb6f['email'],'to':_0x2f44cf[0x0][_0x57c1f6(0x221)],'subject':_0x57c1f6(0x277),'attachments':[{'filename':_0x57c1f6(0x1a2),'path':__dirname+_0x57c1f6(0x1bf)+_0x57c1f6(0x1af)+_0x4112b2[0x0][_0x57c1f6(0x201)],'cid':_0x57c1f6(0x254)}],'html':_0x57c1f6(0x297)+'<html><head><title></title>'+'</head><body>'+_0x57c1f6(0x284)+_0x57c1f6(0x270)+_0x57c1f6(0x284)+_0x57c1f6(0x1b6)+_0x57c1f6(0x19e)+_0x57c1f6(0x284)+'<h2>\x20'+_0x4112b2[0x0]['site_title']+_0x57c1f6(0x19b)+'</div>'+_0x57c1f6(0x19e)+_0x57c1f6(0x231)+_0x57c1f6(0x284)+_0x57c1f6(0x228)+_0x57c1f6(0x1fd)+_0x2e4378[_0x57c1f6(0x244)]+'\x20'+_0x57c1f6(0x20c)+'\x20Order\x20Date\x20:\x20'+_0x2e4378[_0x57c1f6(0x19d)]+'\x20'+_0x57c1f6(0x1fb)+_0x57c1f6(0x283)+_0x57c1f6(0x19e)+_0x57c1f6(0x1eb)+_0x57c1f6(0x269)+_0x57c1f6(0x1c4)+_0x57c1f6(0x198)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x57c1f6(0x1e4)+_0x57c1f6(0x26c)+_0x57c1f6(0x1c6)+_0x57c1f6(0x232)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x57c1f6(0x21f)+_0x57c1f6(0x253)+_0x57c1f6(0x1a5)+'\x20'+_0xe747cd+'\x20'+_0x57c1f6(0x28f)+'</table>'+'<div>'+_0x57c1f6(0x21d)+'<h5>'+_0x4112b2[0x0][_0x57c1f6(0x1dc)]+_0x57c1f6(0x283)+_0x57c1f6(0x19e)+_0x57c1f6(0x19e)+'</body></html>'};_0x2e3dc5['sendMail'](_0x544f5b,function(_0x135033,_0x30a6dd){var _0x29ec58=_0x57c1f6;_0x135033?(console[_0x29ec58(0x1a4)](_0x135033),console[_0x29ec58(0x1a4)](_0x29ec58(0x1d1))):console['log'](_0x29ec58(0x24b));});}catch(_0x397192){console['error'](_0x397192),_0x32d393['status'](0x1f4)[_0x57c1f6(0x21a)]({'error':_0x57c1f6(0x282),'message':_0x397192['message']});}})[_0x3edb82(0x1e6)](_0x4d3298=>{var _0x54263a=_0x3edb82;console[_0x54263a(0x229)](_0x4d3298);}),_0x4d5098[_0x3edb82(0x28a)](_0x3edb82(0x23a),_0x3edb82(0x295)),_0x32d393[_0x3edb82(0x279)](_0x3edb82(0x22c));}catch(_0x1132e9){console[_0x3edb82(0x1a4)](_0x1132e9);}}),router[a0_0x38e3e5(0x199)](a0_0x38e3e5(0x258),auth,async(_0x1a3923,_0x473fd4)=>{var _0x433073=a0_0x38e3e5;try{const {username:_0x3928b8,email:_0xa8065e,role:_0x7e1681}=_0x1a3923['user'],_0x3574a0=_0x1a3923[_0x433073(0x22d)],_0xe568f=await profile['findOne']({'email':_0x3574a0[_0x433073(0x1d3)]}),_0x1fea87=await master_shop[_0x433073(0x227)](),_0x506055=_0x1a3923[_0x433073(0x287)]['id'],_0x25ab90=await purchases_finished[_0x433073(0x1ec)](_0x506055),_0x2fab3d=await suppliers[_0x433073(0x227)]({});let _0x11c99d;if(_0x3574a0[_0x433073(0x207)]==_0x433073(0x291)){const _0x2e4624=await staff[_0x433073(0x23e)]({'email':_0x3574a0[_0x433073(0x1d3)]});_0x11c99d=await warehouse[_0x433073(0x227)]({'status':'Enabled','name':_0x2e4624[_0x433073(0x267)],'warehouse_category':_0x433073(0x24a)});}else _0x11c99d=await warehouse[_0x433073(0x1cb)]([{'$match':{'status':_0x433073(0x1db),'warehouse_category':_0x433073(0x24a)}},{'$group':{'_id':_0x433073(0x257),'name':{'$first':'$name'}}}]);const _0x3c8db8=await product[_0x433073(0x227)]({}),_0x40504c=BayBinSelected(_0x25ab90[_0x433073(0x204)],_0x25ab90[_0x433073(0x19a)]);let _0x2dbd98=new Date(_0x25ab90[_0x433073(0x28c)]),_0x2a24e4=('0'+_0x2dbd98[_0x433073(0x1fe)]())[_0x433073(0x1e5)](-0x2),_0xaa944e=('0'+(_0x2dbd98['getMonth']()+0x1))[_0x433073(0x1e5)](-0x2),_0x27a40f=_0x2dbd98['getFullYear'](),_0x345f29=_0x27a40f+'-'+_0xaa944e+'-'+_0x2a24e4;if(_0x1fea87[0x0]['language']==_0x433073(0x252)){var _0x1768d6=users[_0x433073(0x1f4)];console['log'](_0x1768d6);}else{if(_0x1fea87[0x0][_0x433073(0x263)]=='Hindi')var _0x1768d6=users[_0x433073(0x223)];else{if(_0x1fea87[0x0][_0x433073(0x263)]==_0x433073(0x1d2))var _0x1768d6=users[_0x433073(0x1d2)];else{if(_0x1fea87[0x0][_0x433073(0x263)]==_0x433073(0x1d7))var _0x1768d6=users['Spanish'];else{if(_0x1fea87[0x0][_0x433073(0x263)]==_0x433073(0x243))var _0x1768d6=users[_0x433073(0x243)];else{if(_0x1fea87[0x0][_0x433073(0x263)]==_0x433073(0x27f))var _0x1768d6=users[_0x433073(0x296)];else{if(_0x1fea87[0x0][_0x433073(0x263)]==_0x433073(0x28d))var _0x1768d6=users[_0x433073(0x28d)];else{if(_0x1fea87[0x0]['language']==_0x433073(0x1e3))var _0x1768d6=users[_0x433073(0x1d0)];}}}}}}}_0x473fd4[_0x433073(0x293)](_0x433073(0x1c2),{'success':_0x1a3923['flash'](_0x433073(0x23a)),'errors':_0x1a3923[_0x433073(0x28a)]('errors'),'role':_0x3574a0,'profile':_0xe568f,'purchases':_0x25ab90,'suppliers':_0x2fab3d,'warehouse':_0x11c99d,'product':_0x3c8db8,'master_shop':_0x1fea87,'language':_0x1768d6,'ed_fullDate':_0x345f29,'dataSelected':_0x40504c});}catch(_0x5122a9){console[_0x433073(0x1a4)](_0x5122a9);}}),router[a0_0x38e3e5(0x199)](a0_0x38e3e5(0x1cf),auth,async(_0x11ee67,_0x5e58be)=>{var _0x3eca27=a0_0x38e3e5;try{const {username:_0x23c518,email:_0x4fb568,role:_0x8eaf5d}=_0x11ee67['user'],_0x4e4be9=_0x11ee67[_0x3eca27(0x22d)],_0x31ec46=await profile[_0x3eca27(0x23e)]({'email':_0x4e4be9[_0x3eca27(0x1d3)]}),_0x2f9ed9=await master_shop[_0x3eca27(0x227)](),_0x250bb1=_0x11ee67['params']['id'],_0x310537=await purchases_finished[_0x3eca27(0x1ec)](_0x250bb1),_0x1f8d85=await suppliers[_0x3eca27(0x227)]({});let _0x3e9421;if(_0x4e4be9[_0x3eca27(0x207)]=='staff'){const _0x387065=await staff[_0x3eca27(0x23e)]({'email':_0x4e4be9[_0x3eca27(0x1d3)]});_0x3e9421=await warehouse[_0x3eca27(0x227)]({'status':_0x3eca27(0x1db),'name':_0x387065[_0x3eca27(0x267)],'warehouse_category':_0x3eca27(0x24a)});}else _0x3e9421=await warehouse[_0x3eca27(0x1cb)]([{'$match':{'status':_0x3eca27(0x1db),'warehouse_category':_0x3eca27(0x24a)}},{'$group':{'_id':_0x3eca27(0x257),'name':{'$first':_0x3eca27(0x257)}}}]);const _0x50a43a=await product[_0x3eca27(0x227)]({}),_0x529ca9=BayBinSelected(_0x310537['warehouse_name'],_0x310537[_0x3eca27(0x19a)]);let _0x5d7d50=new Date(_0x310537[_0x3eca27(0x28c)]),_0x58bd14=('0'+_0x5d7d50['getDate']())[_0x3eca27(0x1e5)](-0x2),_0x5dbccc=('0'+(_0x5d7d50[_0x3eca27(0x218)]()+0x1))[_0x3eca27(0x1e5)](-0x2),_0x46e1f4=_0x5d7d50[_0x3eca27(0x261)](),_0x2c2f2a=_0x46e1f4+'-'+_0x5dbccc+'-'+_0x58bd14;if(_0x2f9ed9[0x0]['language']==_0x3eca27(0x252)){var _0x2d82c8=users[_0x3eca27(0x1f4)];console[_0x3eca27(0x1a4)](_0x2d82c8);}else{if(_0x2f9ed9[0x0][_0x3eca27(0x263)]==_0x3eca27(0x223))var _0x2d82c8=users[_0x3eca27(0x223)];else{if(_0x2f9ed9[0x0]['language']==_0x3eca27(0x1d2))var _0x2d82c8=users[_0x3eca27(0x1d2)];else{if(_0x2f9ed9[0x0][_0x3eca27(0x263)]=='Spanish')var _0x2d82c8=users[_0x3eca27(0x1d7)];else{if(_0x2f9ed9[0x0][_0x3eca27(0x263)]=='French')var _0x2d82c8=users[_0x3eca27(0x243)];else{if(_0x2f9ed9[0x0][_0x3eca27(0x263)]==_0x3eca27(0x27f))var _0x2d82c8=users['Portuguese'];else{if(_0x2f9ed9[0x0][_0x3eca27(0x263)]==_0x3eca27(0x28d))var _0x2d82c8=users[_0x3eca27(0x28d)];else{if(_0x2f9ed9[0x0][_0x3eca27(0x263)]==_0x3eca27(0x1e3))var _0x2d82c8=users[_0x3eca27(0x1d0)];}}}}}}}_0x5e58be[_0x3eca27(0x293)](_0x3eca27(0x1f7),{'success':_0x11ee67[_0x3eca27(0x28a)](_0x3eca27(0x23a)),'errors':_0x11ee67[_0x3eca27(0x28a)]('errors'),'role':_0x4e4be9,'profile':_0x31ec46,'purchases':_0x310537,'suppliers':_0x1f8d85,'warehouse':_0x3e9421,'product':_0x50a43a,'master_shop':_0x2f9ed9,'language':_0x2d82c8,'ed_fullDate':_0x2c2f2a,'dataSelected':_0x529ca9});}catch(_0x9e90e){console[_0x3eca27(0x1a4)](_0x9e90e);}}),router[a0_0x38e3e5(0x28e)](a0_0x38e3e5(0x1cf),auth,async(_0x3004d8,_0x3604d5)=>{var _0x31be6d=a0_0x38e3e5;try{const _0x1d870a=_0x3004d8[_0x31be6d(0x287)]['id'],_0x53b8b1=await purchases_finished[_0x31be6d(0x23e)]({'_id':_0x3004d8[_0x31be6d(0x287)]['id']}),_0x369961=await warehouse['findOne']({'name':_0x53b8b1[_0x31be6d(0x204)],'room':_0x53b8b1[_0x31be6d(0x19a)]});_0x53b8b1['product'][_0x31be6d(0x1bd)](_0x3ed8ed=>{var _0x113497=_0x31be6d;const _0x55f724=_0x369961[_0x113497(0x1d5)]['map'](_0x5b37ee=>{var _0x2b4391=_0x113497;_0x5b37ee[_0x2b4391(0x1a3)]==_0x3ed8ed[_0x2b4391(0x1a3)]&&_0x5b37ee['bay']==_0x3ed8ed[_0x2b4391(0x1b1)]&&(_0x5b37ee[_0x2b4391(0x1f6)]=parseInt(_0x5b37ee['product_stock'])-parseInt(_0x3ed8ed[_0x2b4391(0x21b)]));});}),await _0x369961[_0x31be6d(0x286)]();const {invoice:_0x1eaac3,suppliers:_0x1bd3d2,date:_0x587506,warehouse_name:_0x3bd3c3,prod_name:_0x3ee933,prod_code:_0x1a12cc,prod_qty:_0x4b1c44,prod_unit:_0x507756,prod_secondunit:_0x532f99,prod_level:_0x3fa51d,prod_isle:_0x3fba2e,prod_pallet:_0x5ace2e,note:_0x48af6d,expiry_date:_0x37effb,batch_code:_0x892d3d,paid_amount:_0x2262b2,due_amount:_0x50cc95,Room_name:_0x47addf,primary_code:_0x3070f9,secondary_code:_0xdcb61b,PO_number:_0xcf24e5,JO_number:_0x232f1a}=_0x3004d8['body'];if(typeof _0x3ee933==_0x31be6d(0x20a))var _0x5daa7f=[_0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x226)]],_0x2bf20f=[_0x3004d8['body']['prod_code']],_0x505c3f=[_0x3004d8[_0x31be6d(0x1b9)]['prod_qty']],_0x8c7341=[_0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x1b4)]],_0x5a4ae3=[_0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x1da)]],_0x425d45=[_0x3004d8[_0x31be6d(0x1b9)]['prod_level']],_0x943d35=[_0x3004d8[_0x31be6d(0x1b9)]['primary_code']],_0x3844ca=[_0x3004d8['body'][_0x31be6d(0x1ba)]],_0x2d224d=[_0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x1d6)]],_0x3bd26f=[_0x3004d8['body'][_0x31be6d(0x1e8)]],_0x3c2311=[_0x3004d8['body'][_0x31be6d(0x28c)]];else var _0x5daa7f=[..._0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x226)]],_0x2bf20f=[..._0x3004d8['body'][_0x31be6d(0x20f)]],_0x505c3f=[..._0x3004d8['body'][_0x31be6d(0x237)]],_0x8c7341=[..._0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x1b4)]],_0x5a4ae3=[..._0x3004d8['body'][_0x31be6d(0x1da)]],_0x425d45=[..._0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x195)]],_0x943d35=[..._0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x215)]],_0x3844ca=[..._0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x1ba)]],_0x2d224d=[..._0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x1d6)]],_0x3bd26f=[..._0x3004d8[_0x31be6d(0x1b9)]['batch_code']],_0x3c2311=[..._0x3004d8['body']['expiry_date']];const _0x19fbff=_0x5daa7f[_0x31be6d(0x1dd)](_0x153a7c=>{return _0x153a7c={'product_name':_0x153a7c};});_0x2bf20f[_0x31be6d(0x1bd)]((_0x29dfaf,_0x3e4932)=>{var _0x5a9a1f=_0x31be6d;_0x19fbff[_0x3e4932][_0x5a9a1f(0x250)]=_0x29dfaf;}),_0x505c3f[_0x31be6d(0x1bd)]((_0x18c5d8,_0x48a251)=>{_0x19fbff[_0x48a251]['quantity']=_0x18c5d8;}),_0x8c7341[_0x31be6d(0x1bd)]((_0x5224ba,_0x4cd3df)=>{_0x19fbff[_0x4cd3df]['standard_unit']=_0x5224ba;}),_0x5a4ae3[_0x31be6d(0x1bd)]((_0x4486e6,_0x3923e4)=>{_0x19fbff[_0x3923e4]['secondary_unit']=_0x4486e6;}),_0x425d45[_0x31be6d(0x1bd)]((_0x300214,_0x5d1d0b)=>{var _0x124dc3=_0x31be6d;_0x19fbff[_0x5d1d0b][_0x124dc3(0x1b1)]=_0x300214;}),_0x943d35[_0x31be6d(0x1bd)]((_0x203a25,_0x38f95c)=>{var _0x5555da=_0x31be6d;_0x19fbff[_0x38f95c][_0x5555da(0x215)]=_0x203a25;}),_0x3844ca[_0x31be6d(0x1bd)]((_0x14342b,_0x15a044)=>{var _0x58d640=_0x31be6d;_0x19fbff[_0x15a044][_0x58d640(0x1ba)]=_0x14342b;}),_0x2d224d['forEach']((_0x9009b6,_0x3e13cf)=>{var _0x2334bd=_0x31be6d;_0x19fbff[_0x3e13cf][_0x2334bd(0x202)]=_0x9009b6;}),_0x3bd26f['forEach']((_0x3b3f25,_0x8157a9)=>{var _0x2ea594=_0x31be6d;_0x19fbff[_0x8157a9][_0x2ea594(0x1e8)]=_0x3b3f25;}),_0x3c2311['forEach']((_0x351752,_0x1d07f2)=>{var _0xfc0275=_0x31be6d;_0x19fbff[_0x1d07f2][_0xfc0275(0x28c)]=_0x351752;});const _0x393ce3=_0x19fbff[_0x31be6d(0x238)](_0x4a9bee=>_0x4a9bee[_0x31be6d(0x21b)]!=='0'&&_0x4a9bee[_0x31be6d(0x21b)]!=='');_0x53b8b1[_0x31be6d(0x244)]=_0x1eaac3,_0x53b8b1[_0x31be6d(0x1e2)]=_0x1bd3d2,_0x53b8b1[_0x31be6d(0x19d)]=_0x587506,_0x53b8b1['warehouse_name']=_0x3bd3c3,_0x53b8b1['product']=_0x393ce3,_0x53b8b1['note']=_0x48af6d,_0x53b8b1[_0x31be6d(0x225)]=_0x2262b2,_0x53b8b1['due_amount']=_0x50cc95,_0x53b8b1[_0x31be6d(0x19a)]=_0x47addf,_0x53b8b1[_0x31be6d(0x1b3)]=_0xcf24e5,_0x53b8b1[_0x31be6d(0x1ae)]=_0x232f1a;const _0x54bc1=await _0x53b8b1['save'](),_0x384c0f=await warehouse[_0x31be6d(0x23e)]({'name':_0x3004d8[_0x31be6d(0x1b9)]['warehouse_name'],'room':_0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x219)]});_0x53b8b1[_0x31be6d(0x1df)][_0x31be6d(0x1bd)](_0x3f8877=>{var _0x1f2734=_0x31be6d,_0x214793=0x0;const _0x339160=_0x384c0f[_0x1f2734(0x1d5)]['map'](_0x138323=>{var _0x13e38b=_0x1f2734;_0x138323[_0x13e38b(0x1a3)]==_0x3f8877['product_name']&&_0x138323[_0x13e38b(0x1b1)]==_0x3f8877[_0x13e38b(0x1b1)]&&(_0x138323[_0x13e38b(0x1f6)]=parseInt(_0x138323[_0x13e38b(0x1f6)])+parseInt(_0x3f8877[_0x13e38b(0x21b)]),_0x214793++);});_0x214793=='0'&&(_0x384c0f['product_details']=_0x384c0f['product_details'][_0x1f2734(0x1b2)]({'product_name':_0x3f8877[_0x1f2734(0x1a3)],'product_stock':_0x3f8877[_0x1f2734(0x21b)],'primary_code':_0x3f8877['primary_code'],'secondary_code':_0x3f8877[_0x1f2734(0x1ba)],'product_code':_0x3f8877[_0x1f2734(0x250)],'bay':_0x3f8877['bay'],'maxProducts':_0x3f8877[_0x1f2734(0x202)],'unit':_0x3f8877[_0x1f2734(0x22e)],'secondary_unit':_0x3f8877[_0x1f2734(0x222)],'expiry_date':_0x3f8877[_0x1f2734(0x28c)]}));}),await _0x384c0f[_0x31be6d(0x286)]();const _0xc1d486=await s_payment_data[_0x31be6d(0x23e)]({'invoice':_0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x244)]});if(_0xc1d486===null){}else console[_0x31be6d(0x1a4)](_0x31be6d(0x1e2),_0xc1d486,_0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x244)]),_0xc1d486[_0x31be6d(0x1e2)]=_0x3004d8[_0x31be6d(0x1b9)][_0x31be6d(0x1e2)],await _0xc1d486['save']();_0x3004d8[_0x31be6d(0x28a)](_0x31be6d(0x23a),_0x31be6d(0x1c8)),_0x3604d5[_0x31be6d(0x279)](_0x31be6d(0x22c));}catch(_0x5ad731){console['log'](_0x5ad731);}}),router[a0_0x38e3e5(0x28e)](a0_0x38e3e5(0x23d),auth,async(_0x3d164b,_0x5c6fb6)=>{var _0x215927=a0_0x38e3e5;try{const _0x12b338=_0x3d164b['params']['id'],{invoice:_0xaec9ca,suppliers:_0x4d18d1,payable:_0x2ca801,due_amount:_0x427262}=_0x3d164b[_0x215927(0x1b9)],_0x83ded3=await purchases['findById'](_0x12b338);var _0x5d55f6=_0x2ca801-_0x427262;_0x83ded3['paid_amount']=parseFloat(_0x83ded3['paid_amount'])+parseFloat(_0x427262),_0x83ded3[_0x215927(0x266)]=_0x5d55f6;const _0x48d1b6=await _0x83ded3[_0x215927(0x286)]();console['log'](_0x48d1b6);const _0x251ca5=await s_payment_data['findOne']({'invoice':_0xaec9ca});_0x251ca5[_0x215927(0x1ab)]=_0x5d55f6,await _0x251ca5[_0x215927(0x286)]();let _0x44097b=new Date(),_0x3747ff=('0'+_0x44097b[_0x215927(0x1fe)]())[_0x215927(0x1e5)](-0x2),_0x5a8712=('0'+(_0x44097b[_0x215927(0x218)]()+0x1))[_0x215927(0x1e5)](-0x2),_0x52d71e=_0x44097b[_0x215927(0x261)](),_0x2bc8c7=_0x52d71e+'-'+_0x5a8712+'-'+_0x3747ff;const _0x22c1af=new suppliers_payment({'invoice':_0xaec9ca,'date':_0x52d71e+'-'+_0x5a8712+'-'+_0x3747ff,'suppliers':_0x4d18d1,'reason':_0x215927(0x273),'amount':_0x427262}),_0x337a4b=await _0x22c1af[_0x215927(0x286)]();_0x3d164b['flash'](_0x215927(0x23a),_0x215927(0x235)),_0x5c6fb6[_0x215927(0x279)](_0x215927(0x26f));}catch(_0x322531){console['log'](_0x322531);}}),router[a0_0x38e3e5(0x199)](a0_0x38e3e5(0x22b),auth,async(_0x394009,_0x5ff8eb)=>{var _0x184160=a0_0x38e3e5;try{const {username:_0x309379,email:_0x47a358,role:_0x5d3af8}=_0x394009[_0x184160(0x22d)],_0xaa429b=_0x394009[_0x184160(0x22d)],_0x138e62=await profile[_0x184160(0x23e)]({'email':_0xaa429b[_0x184160(0x1d3)]}),_0x5ec5b9=await master_shop[_0x184160(0x227)]();console[_0x184160(0x1a4)]('master',_0x5ec5b9);const _0x2f1b75=_0x394009[_0x184160(0x287)]['id'],_0x2e1844=await purchases[_0x184160(0x1ec)](_0x2f1b75);console[_0x184160(0x1a4)](_0x2e1844);const _0x44d211=await suppliers[_0x184160(0x23e)]({'name':_0x2e1844['suppliers']});console[_0x184160(0x1a4)](_0x44d211);if(_0x5ec5b9[0x0][_0x184160(0x263)]=='English\x20(US)'){var _0x2f174e=users['English'];console[_0x184160(0x1a4)](_0x2f174e);}else{if(_0x5ec5b9[0x0][_0x184160(0x263)]==_0x184160(0x223))var _0x2f174e=users['Hindi'];else{if(_0x5ec5b9[0x0][_0x184160(0x263)]==_0x184160(0x1d2))var _0x2f174e=users[_0x184160(0x1d2)];else{if(_0x5ec5b9[0x0][_0x184160(0x263)]==_0x184160(0x1d7))var _0x2f174e=users['Spanish'];else{if(_0x5ec5b9[0x0][_0x184160(0x263)]==_0x184160(0x243))var _0x2f174e=users['French'];else{if(_0x5ec5b9[0x0][_0x184160(0x263)]==_0x184160(0x27f))var _0x2f174e=users['Portuguese'];else{if(_0x5ec5b9[0x0][_0x184160(0x263)]==_0x184160(0x28d))var _0x2f174e=users[_0x184160(0x28d)];else{if(_0x5ec5b9[0x0][_0x184160(0x263)]==_0x184160(0x1e3))var _0x2f174e=users[_0x184160(0x1d0)];}}}}}}}_0x5ff8eb[_0x184160(0x293)](_0x184160(0x205),{'success':_0x394009['flash'](_0x184160(0x23a)),'errors':_0x394009['flash'](_0x184160(0x24e)),'role':_0xaa429b,'profile':_0x138e62,'master_shop':_0x5ec5b9,'supplier':_0x44d211,'purchase':_0x2e1844,'language':_0x2f174e});}catch(_0x23fdc1){console['log'](_0x23fdc1);}}),router[a0_0x38e3e5(0x199)](a0_0x38e3e5(0x251),auth,async(_0x4767a4,_0x4ecf0a)=>{var _0x259764=a0_0x38e3e5;try{const {username:_0x27defe,email:_0x4fc9d0,role:_0x460b2b}=_0x4767a4[_0x259764(0x22d)],_0x3d4842=_0x4767a4[_0x259764(0x22d)],_0x1aa1c3=await profile[_0x259764(0x23e)]({'email':_0x3d4842[_0x259764(0x1d3)]}),_0x298d1f=await master_shop['find']();console[_0x259764(0x1a4)](_0x259764(0x1f8),_0x298d1f);const _0xc0d106=_0x4767a4[_0x259764(0x287)]['id'];console[_0x259764(0x1a4)](_0xc0d106);const _0x9dc7a9=await purchases_finished[_0x259764(0x1ec)](_0xc0d106);console[_0x259764(0x1a4)]('user_id',_0x9dc7a9);const _0x2dd59a=await product[_0x259764(0x227)]({}),_0x452856=await warehouse[_0x259764(0x1cb)]([{'$match':{'name':_0x9dc7a9[_0x259764(0x204)],'room':_0x9dc7a9['room']}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x259764(0x193)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x259764(0x268)},'type':{'$first':_0x259764(0x19f)},'floorlevel':{'$first':_0x259764(0x289)},'primary_code':{'$first':_0x259764(0x1d8)},'secondary_code':{'$first':_0x259764(0x196)},'product_code':{'$first':_0x259764(0x1c0)},'storage':{'$first':_0x259764(0x242)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x259764(0x1a4)](_0x259764(0x23b),_0x452856);let _0x115fac;if(_0x3d4842[_0x259764(0x207)]==_0x259764(0x291)){const _0x141328=await staff[_0x259764(0x23e)]({'email':_0x3d4842['email']});_0x115fac=await warehouse[_0x259764(0x227)]({'status':_0x259764(0x1db),'name':_0x141328[_0x259764(0x267)],'warehouse_category':_0x259764(0x24a),'name':_0x259764(0x1ff)});}else _0x115fac=await warehouse[_0x259764(0x1cb)]([{'$match':{'status':'Enabled','warehouse_category':_0x259764(0x24a),'name':_0x259764(0x1ff)}},{'$group':{'_id':'$name','name':{'$first':_0x259764(0x257)}}}]);if(_0x298d1f[0x0]['language']=='English\x20(US)'){var _0x3f5c28=users[_0x259764(0x1f4)];console['log'](_0x3f5c28);}else{if(_0x298d1f[0x0][_0x259764(0x263)]==_0x259764(0x223))var _0x3f5c28=users[_0x259764(0x223)];else{if(_0x298d1f[0x0][_0x259764(0x263)]==_0x259764(0x1d2))var _0x3f5c28=users[_0x259764(0x1d2)];else{if(_0x298d1f[0x0][_0x259764(0x263)]==_0x259764(0x1d7))var _0x3f5c28=users['Spanish'];else{if(_0x298d1f[0x0]['language']==_0x259764(0x243))var _0x3f5c28=users['French'];else{if(_0x298d1f[0x0][_0x259764(0x263)]==_0x259764(0x27f))var _0x3f5c28=users[_0x259764(0x296)];else{if(_0x298d1f[0x0][_0x259764(0x263)]=='Chinese')var _0x3f5c28=users[_0x259764(0x28d)];else{if(_0x298d1f[0x0]['language']=='Arabic\x20(ae)')var _0x3f5c28=users[_0x259764(0x1d0)];}}}}}}}_0x4ecf0a['render']('return_purchase_finished',{'success':_0x4767a4[_0x259764(0x28a)]('success'),'errors':_0x4767a4[_0x259764(0x28a)]('errors'),'role':_0x3d4842,'profile':_0x1aa1c3,'user':_0x9dc7a9,'stock':_0x452856,'master_shop':_0x298d1f,'product':_0x2dd59a,'language':_0x3f5c28,'warehouse':_0x115fac});}catch(_0x3bcb24){console[_0x259764(0x1a4)](_0x3bcb24);}}),router[a0_0x38e3e5(0x28e)](a0_0x38e3e5(0x251),auth,async(_0x19973b,_0x3760e0)=>{var _0x564326=a0_0x38e3e5;try{const {invoice:_0x3e5dac,date:_0x1e6bca,warehouse_name:_0x4fbed0,Room_name:_0x3e09a9,product_name:_0x57a0b2,purchase_quantity:_0x21fcf2,stocks:_0x265fbc,return_qty:_0x518c7e,note:_0x5f3fc6,level:_0x3e1d42,isle:_0x4d8b07,pallet:_0x546e78,to_warehouse_name:_0x1b787d,to_Room_name:_0x36c5c6}=_0x19973b[_0x564326(0x1b9)],_0x51e13b=await purchases_finished['findOne']({'_id':_0x19973b[_0x564326(0x287)]['id']}),_0x177723=await warehouse[_0x564326(0x23e)]({'name':_0x4fbed0,'room':_0x3e09a9,'warehouse_category':_0x564326(0x24a)});if(typeof _0x57a0b2==_0x564326(0x20a))var _0x2990a6=[_0x19973b['body'][_0x564326(0x1a3)]],_0xcbc056=[_0x19973b['body'][_0x564326(0x25a)]],_0x272bcc=[_0x19973b[_0x564326(0x1b9)][_0x564326(0x1ac)]],_0x13c8f9=[_0x19973b[_0x564326(0x1b9)]['return_qty']],_0x45575d=[_0x19973b[_0x564326(0x1b9)][_0x564326(0x1c9)]],_0x4cc887=[_0x19973b['body']['product_code_hide']],_0x450dd8=[_0x19973b[_0x564326(0x1b9)]['primary_code_hide']],_0x2aa987=[_0x19973b[_0x564326(0x1b9)][_0x564326(0x245)]];else var _0x2990a6=[..._0x19973b[_0x564326(0x1b9)][_0x564326(0x1a3)]],_0xcbc056=[..._0x19973b[_0x564326(0x1b9)]['purchase_quantity']],_0x272bcc=[..._0x19973b['body'][_0x564326(0x1ac)]],_0x13c8f9=[..._0x19973b['body'][_0x564326(0x1a8)]],_0x45575d=[..._0x19973b[_0x564326(0x1b9)]['level']],_0x4cc887=[..._0x19973b[_0x564326(0x1b9)][_0x564326(0x1f0)]],_0x450dd8=[..._0x19973b[_0x564326(0x1b9)][_0x564326(0x278)]],_0x2aa987=[..._0x19973b[_0x564326(0x1b9)]['secondary_code_hide']];const _0x235f69=_0x2990a6[_0x564326(0x1dd)](_0x2dee31=>{return _0x2dee31={'product_name':_0x2dee31};});_0xcbc056[_0x564326(0x1bd)]((_0x82c1b4,_0x410264)=>{var _0x17a137=_0x564326;_0x235f69[_0x410264][_0x17a137(0x25a)]=_0x82c1b4;}),_0x272bcc[_0x564326(0x1bd)]((_0x1810f1,_0x40d5bd)=>{_0x235f69[_0x40d5bd]['stock_quantity']=_0x1810f1;}),_0x13c8f9['forEach']((_0x1606fe,_0x527c9d)=>{var _0x2012ea=_0x564326;_0x235f69[_0x527c9d][_0x2012ea(0x1a8)]=_0x1606fe;}),_0x45575d['forEach']((_0xb40554,_0x29cc8b)=>{var _0x178f0b=_0x564326;_0x235f69[_0x29cc8b][_0x178f0b(0x1b1)]=_0xb40554;}),_0x4cc887[_0x564326(0x1bd)]((_0x11f4a3,_0x3750a9)=>{var _0x844432=_0x564326;_0x235f69[_0x3750a9][_0x844432(0x250)]=_0x11f4a3;}),_0x450dd8[_0x564326(0x1bd)]((_0x3563f9,_0x461537)=>{_0x235f69[_0x461537]['primary_code']=_0x3563f9;}),_0x2aa987[_0x564326(0x1bd)]((_0x12ad85,_0x306d78)=>{var _0x5e51b2=_0x564326;_0x235f69[_0x306d78][_0x5e51b2(0x1ba)]=_0x12ad85;}),_0x235f69[_0x564326(0x1bd)](_0x5470ec=>{var _0x544859=_0x564326;console[_0x544859(0x1a4)](_0x5470ec);const _0x365775=_0x177723[_0x544859(0x1d5)][_0x544859(0x1dd)](_0x5174c5=>{var _0x1afd05=_0x544859;_0x5174c5[_0x1afd05(0x1a3)]==_0x5470ec['product_name']&&_0x5174c5[_0x1afd05(0x1b1)]==_0x5470ec[_0x1afd05(0x1b1)]&&(console['log'](parseInt(_0x5174c5['product_stock'])+_0x1afd05(0x1fa)+parseInt(_0x5470ec[_0x1afd05(0x1a8)])),_0x5174c5[_0x1afd05(0x1f6)]=parseInt(_0x5174c5['product_stock'])-parseInt(_0x5470ec[_0x1afd05(0x1a8)]));});}),await _0x177723['save']();var _0x316d84=0x0;_0x235f69[_0x564326(0x1bd)](_0x507927=>{var _0x349c32=_0x564326;(parseInt(_0x507927[_0x349c32(0x25a)])<parseInt(_0x507927['return_qty'])||parseInt(_0x507927[_0x349c32(0x1e0)])<parseInt(_0x507927[_0x349c32(0x1a8)]))&&_0x316d84++;});if(_0x316d84!=0x0)return _0x19973b['flash']('errors',_0x564326(0x234)),_0x3760e0[_0x564326(0x279)](_0x564326(0x22f));const _0x1e15d1=new purchases_return_finished({'invoice':_0x3e5dac,'suppliers':_0x19973b[_0x564326(0x1b9)][_0x564326(0x1e2)],'date':_0x1e6bca,'warehouse_name':_0x4fbed0,'return_product':_0x235f69,'note':_0x5f3fc6,'room':_0x3e09a9,'to_warehouse_name':_0x1b787d,'to_room':_0x36c5c6}),_0x180138=await _0x1e15d1['save'](),_0x2afbcb=await purchases_return_finished[_0x564326(0x23e)]({'invoice':_0x3e5dac}),_0x34093c=await warehouse[_0x564326(0x23e)]({'name':_0x1b787d,'room':_0x36c5c6,'warehouse_category':_0x564326(0x24a)});_0x2afbcb[_0x564326(0x26a)]['forEach'](_0x5dc9f1=>{var _0x1cdfcd=_0x564326,_0x4c32fe=0x0;const _0x411098=_0x34093c[_0x1cdfcd(0x1d5)][_0x1cdfcd(0x1dd)](_0x59596a=>{var _0x35dcb7=_0x1cdfcd;console[_0x35dcb7(0x1a4)](_0x59596a[_0x35dcb7(0x1a3)]+'=='+_0x5dc9f1[_0x35dcb7(0x1a3)]+'&&'+_0x59596a['bay']+'=='+_0x5dc9f1[_0x35dcb7(0x1b1)]),_0x59596a[_0x35dcb7(0x1a3)]==_0x5dc9f1['product_name']&&_0x59596a[_0x35dcb7(0x1b1)]==_0x5dc9f1[_0x35dcb7(0x1b1)]&&(_0x59596a[_0x35dcb7(0x1f6)]=parseInt(_0x59596a['product_stock'])-parseInt(_0x5dc9f1[_0x35dcb7(0x1a8)]),_0x4c32fe++);});_0x4c32fe=='0'&&(_0x34093c[_0x1cdfcd(0x1d5)]=_0x34093c['product_details'][_0x1cdfcd(0x1b2)]({'product_name':_0x5dc9f1[_0x1cdfcd(0x1a3)],'product_stock':_0x5dc9f1[_0x1cdfcd(0x1a8)],'primary_code':_0x5dc9f1['primary_code'],'secondary_code':_0x5dc9f1[_0x1cdfcd(0x1ba)],'product_code':_0x5dc9f1['product_code'],'bay':_0x5dc9f1[_0x1cdfcd(0x1b1)],'maxProducts':0xf423f}));}),await _0x34093c[_0x564326(0x286)]();const _0x43575e=await purchases_finished[_0x564326(0x23e)]({'invoice':_0x3e5dac});_0x43575e[_0x564326(0x200)]=_0x564326(0x1bb);const _0x1654b4=await _0x43575e[_0x564326(0x286)](),_0x24bcfa=new s_payment_data({'invoice':_0x3e5dac,'suppliers':_0x19973b[_0x564326(0x1b9)][_0x564326(0x1e2)],'reason':_0x564326(0x1c5)});await _0x24bcfa[_0x564326(0x286)]();const _0x39bbef=await master_shop['find'](),_0x2f4899=await email_settings[_0x564326(0x23e)](),_0x2d5c69=await suppliers[_0x564326(0x23e)]({'name':_0x19973b[_0x564326(0x1b9)][_0x564326(0x1e2)]});_0x39bbef[0x0][_0x564326(0x271)]==0x1?(right_currency=_0x39bbef[0x0][_0x564326(0x194)],left_currency=''):(right_currency='',left_currency=_0x39bbef[0x0]['currency']);var _0x364384=_0x2990a6,_0x3097ec=_0x13c8f9,_0x20131f='',_0x9af0fd;for(_0x9af0fd in _0x364384){_0x20131f+=_0x564326(0x1c4)+_0x564326(0x217)+_0x364384[_0x9af0fd]+_0x564326(0x1e9)+_0x564326(0x217)+_0x3097ec[_0x9af0fd]+_0x564326(0x1e9)+'</tr>';}let _0x44ec3a=nodemailer['createTransport']({'service':_0x564326(0x1aa),'auth':{'user':_0x2f4899[_0x564326(0x1d3)],'pass':_0x2f4899['password']}}),_0x230685={'from':_0x2f4899[_0x564326(0x1d3)],'to':_0x2d5c69[_0x564326(0x1d3)],'subject':_0x564326(0x197),'attachments':[{'filename':_0x564326(0x1a2),'path':__dirname+'/../public'+_0x564326(0x1af)+_0x39bbef[0x0][_0x564326(0x201)],'cid':'logo'}],'html':_0x564326(0x297)+_0x564326(0x1d4)+_0x564326(0x246)+'<div>'+_0x564326(0x270)+'<div>'+_0x564326(0x1b6)+_0x564326(0x19e)+_0x564326(0x284)+_0x564326(0x1ad)+_0x39bbef[0x0]['site_title']+_0x564326(0x19b)+_0x564326(0x19e)+'</div>'+_0x564326(0x231)+_0x564326(0x284)+_0x564326(0x228)+_0x564326(0x1fd)+_0x3e5dac+'\x20'+_0x564326(0x20c)+_0x564326(0x192)+_0x1e6bca+'\x20'+_0x564326(0x1fb)+'</h5>'+_0x564326(0x19e)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x564326(0x269)+_0x564326(0x1c4)+_0x564326(0x198)+_0x564326(0x1f3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x564326(0x27a)+_0x564326(0x21f)+_0x564326(0x253)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x20131f+'\x20'+_0x564326(0x28f)+_0x564326(0x26b)+_0x564326(0x284)+_0x564326(0x21d)+_0x564326(0x19c)+_0x39bbef[0x0]['site_title']+_0x564326(0x283)+_0x564326(0x19e)+_0x564326(0x19e)+_0x564326(0x276)};_0x44ec3a[_0x564326(0x290)](_0x230685,function(_0xfe8ca7,_0x73f291){var _0x1bd627=_0x564326;_0xfe8ca7?console[_0x1bd627(0x1a4)]('Error\x20Occurs'):console[_0x1bd627(0x1a4)](_0x1bd627(0x24b));}),_0x19973b[_0x564326(0x28a)](_0x564326(0x23a),'purchases\x20item\x20return\x20successfull'),_0x3760e0[_0x564326(0x279)](_0x564326(0x22c));}catch(_0xc08d81){_0x3760e0['status'](0xc8)[_0x564326(0x21a)]({'message':_0xc08d81['message']});}}),router['get']('/barcode/:id',auth,async(_0x4d7943,_0x359108)=>{var _0x4af079=a0_0x38e3e5;try{const {username:_0x1bef98,email:_0x5173e1,role:_0x3ab35a}=_0x4d7943[_0x4af079(0x22d)],_0x3c71d6=_0x4d7943[_0x4af079(0x22d)],_0x1581b9=await profile['findOne']({'email':_0x3c71d6['email']}),_0x2ef21b=await master_shop[_0x4af079(0x227)](),_0x391071=_0x4d7943['params']['id'],_0x5db6be=await purchases_finished[_0x4af079(0x1ec)](_0x391071);if(_0x2ef21b[0x0][_0x4af079(0x263)]==_0x4af079(0x252))var _0x621a02=users[_0x4af079(0x1f4)];else{if(_0x2ef21b[0x0][_0x4af079(0x263)]==_0x4af079(0x223))var _0x621a02=users['Hindi'];else{if(_0x2ef21b[0x0][_0x4af079(0x263)]==_0x4af079(0x1d2))var _0x621a02=users['German'];else{if(_0x2ef21b[0x0][_0x4af079(0x263)]=='Spanish')var _0x621a02=users['Spanish'];else{if(_0x2ef21b[0x0][_0x4af079(0x263)]==_0x4af079(0x243))var _0x621a02=users[_0x4af079(0x243)];else{if(_0x2ef21b[0x0][_0x4af079(0x263)]==_0x4af079(0x27f))var _0x621a02=users[_0x4af079(0x296)];else{if(_0x2ef21b[0x0][_0x4af079(0x263)]==_0x4af079(0x28d))var _0x621a02=users[_0x4af079(0x28d)];else{if(_0x2ef21b[0x0][_0x4af079(0x263)]==_0x4af079(0x1e3))var _0x621a02=users['Arabic'];}}}}}}}_0x359108['render'](_0x4af079(0x247),{'success':_0x4d7943[_0x4af079(0x28a)](_0x4af079(0x23a)),'errors':_0x4d7943[_0x4af079(0x28a)]('errors'),'role':_0x3c71d6,'profile':_0x1581b9,'alldata':_0x5db6be,'master_shop':_0x2ef21b,'language':_0x621a02}),console[_0x4af079(0x1a4)](alldata);}catch(_0xb6f102){console[_0x4af079(0x1a4)](_0xb6f102);}}),router['post'](a0_0x38e3e5(0x292),async(_0x42a975,_0x444da1)=>{var _0x34d645=a0_0x38e3e5;const {product_code:_0x240c43}=_0x42a975[_0x34d645(0x1b9)];var _0x482d43;const _0x35fffb=await product['aggregate']([{'$match':{'primary_code':_0x240c43,'product_category':_0x34d645(0x24a)}},{'$group':{'_id':_0x34d645(0x230),'name':{'$first':_0x34d645(0x257)},'category':{'$first':'$category'},'brand':{'$first':_0x34d645(0x256)},'unit':{'$first':_0x34d645(0x28b)},'alertquantity':{'$first':_0x34d645(0x208)},'product_code':{'$first':_0x34d645(0x21e)},'primary_code':{'$first':_0x34d645(0x1a6)},'secondary_code':{'$first':_0x34d645(0x249)},'maxStocks':{'$first':_0x34d645(0x20b)},'maxProdPerUnit':{'$first':_0x34d645(0x25b)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x34d645(0x260)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x138115=await product[_0x34d645(0x1cb)]([{'$match':{'secondary_code':_0x240c43}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x34d645(0x256)},'unit':{'$first':_0x34d645(0x28b)},'alertquantity':{'$first':_0x34d645(0x208)},'product_code':{'$first':_0x34d645(0x21e)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x34d645(0x20b)},'maxProdPerUnit':{'$first':_0x34d645(0x25b)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x35fffb['length']>0x0)_0x482d43=_0x35fffb;else _0x138115[_0x34d645(0x25e)]>0x0&&(_0x482d43=_0x138115);_0x444da1[_0x34d645(0x21a)](_0x482d43);}),router[a0_0x38e3e5(0x28e)](a0_0x38e3e5(0x272),async(_0x9ff932,_0x3dcc17)=>{var _0x1a5455=a0_0x38e3e5;const {productCode:_0x31bce,bay:_0x24cab6,warehouses:_0x225e1d,room:_0x17d6b7}=_0x9ff932[_0x1a5455(0x1b9)];console[_0x1a5455(0x1a4)](_0x9ff932[_0x1a5455(0x1b9)]);try{const _0x8df943=await warehouse[_0x1a5455(0x1cb)]([{'$match':{'name':_0x225e1d,'room':_0x17d6b7}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x24cab6)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1a5455(0x193)},'bay':{'$first':_0x1a5455(0x1cd)},'maxProducts':{'$first':_0x1a5455(0x1ed)}}}]);_0x3dcc17[_0x1a5455(0x1ee)](0xc8)[_0x1a5455(0x21a)](_0x8df943);}catch(_0x5d2df0){_0x3dcc17[_0x1a5455(0x1ee)](0x194)[_0x1a5455(0x21a)]({'message':_0x5d2df0['message']});}}),module['exports']=router;