var a0_0x25fe79=a0_0x350b;(function(_0x584322,_0x316186){var _0x277e1a=a0_0x350b,_0x544308=_0x584322();while(!![]){try{var _0x24326d=parseInt(_0x277e1a(0x213))/0x1*(parseInt(_0x277e1a(0x226))/0x2)+-parseInt(_0x277e1a(0x1e6))/0x3*(parseInt(_0x277e1a(0x156))/0x4)+parseInt(_0x277e1a(0x16f))/0x5+-parseInt(_0x277e1a(0x1ff))/0x6+parseInt(_0x277e1a(0x1f5))/0x7*(-parseInt(_0x277e1a(0x14f))/0x8)+parseInt(_0x277e1a(0x1d2))/0x9*(-parseInt(_0x277e1a(0x1e2))/0xa)+parseInt(_0x277e1a(0x1e4))/0xb*(parseInt(_0x277e1a(0x239))/0xc);if(_0x24326d===_0x316186)break;else _0x544308['push'](_0x544308['shift']());}catch(_0xe9ee7e){_0x544308['push'](_0x544308['shift']());}}}(a0_0x4faa,0xe1416));const express=require(a0_0x25fe79(0x23a)),app=express(),router=express[a0_0x25fe79(0x1a3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x25fe79(0x1cb)),auth=require('../middleware/auth'),nodemailer=require(a0_0x25fe79(0x22a));var ejs=require(a0_0x25fe79(0x1d7));const path=require('path'),users=require('../public/language/languages.json');router['get'](a0_0x25fe79(0x225),auth,async(_0x2bd2fa,_0x2904db)=>{var _0x2e0e18=a0_0x25fe79;try{const {username:_0x31469f,email:_0x45ea31,role:_0x418ae6}=_0x2bd2fa[_0x2e0e18(0x23c)],_0x3632da=_0x2bd2fa[_0x2e0e18(0x23c)],_0x4a3250=await profile['findOne']({'email':_0x3632da[_0x2e0e18(0x1ef)]}),_0x4d3ff2=await staff['findOne']({'email':_0x3632da[_0x2e0e18(0x1ef)]});if(_0x3632da[_0x2e0e18(0x186)]==_0x2e0e18(0x205)){const _0x17cd04=await staff[_0x2e0e18(0x221)]({'email':_0x3632da[_0x2e0e18(0x1ef)]});}const _0x535817=await master_shop[_0x2e0e18(0x157)]();let _0x26b331;if(_0x3632da[_0x2e0e18(0x186)]==_0x2e0e18(0x205)){const _0x338b16=await staff[_0x2e0e18(0x221)]({'email':_0x3632da[_0x2e0e18(0x1ef)]});_0x26b331=await purchases_finished[_0x2e0e18(0x192)]([{'$match':{'warehouse_name':_0x338b16[_0x2e0e18(0x170)]}},{'$lookup':{'from':'suppliers','localField':_0x2e0e18(0x1a9),'foreignField':_0x2e0e18(0x1dc),'as':_0x2e0e18(0x1fc)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x2e0e18(0x1a2)},{'$group':{'_id':_0x2e0e18(0x196),'invoice':{'$first':_0x2e0e18(0x211)},'suppliers':{'$first':_0x2e0e18(0x218)},'date':{'$first':_0x2e0e18(0x1a5)},'warehouse_name':{'$first':_0x2e0e18(0x19a)},'room':{'$first':_0x2e0e18(0x212)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2e0e18(0x247)},'due_amount':{'$first':_0x2e0e18(0x1c6)},'return_data':{'$first':_0x2e0e18(0x1d9)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2e0e18(0x241)},'suppliers_docs':{'$first':_0x2e0e18(0x22f)},'total_product_quantity':{'$sum':_0x2e0e18(0x1da)},'level':{'$addToSet':_0x2e0e18(0x1bb)},'isle':{'$addToSet':_0x2e0e18(0x17c)},'type':{'$addToSet':_0x2e0e18(0x16b)},'floorlevel':{'$addToSet':_0x2e0e18(0x222)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x26b331=await purchases_finished[_0x2e0e18(0x192)]([{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x2e0e18(0x211)},'suppliers':{'$first':_0x2e0e18(0x218)},'date':{'$first':_0x2e0e18(0x1a5)},'warehouse_name':{'$first':_0x2e0e18(0x19a)},'room':{'$addToSet':_0x2e0e18(0x181)},'product':{'$push':_0x2e0e18(0x1a2)},'note':{'$first':_0x2e0e18(0x20a)},'paid_amount':{'$first':_0x2e0e18(0x247)},'due_amount':{'$first':_0x2e0e18(0x1c6)},'return_data':{'$first':_0x2e0e18(0x1d9)},'batch_code':{'$first':_0x2e0e18(0x227)},'expiry_date':{'$first':_0x2e0e18(0x241)},'suppliers_docs':{'$first':_0x2e0e18(0x22f)},'total_product_quantity':{'$sum':_0x2e0e18(0x1da)},'level':{'$addToSet':_0x2e0e18(0x1bb)},'isle':{'$addToSet':_0x2e0e18(0x17c)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2e0e18(0x222)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x535817[0x0][_0x2e0e18(0x1d5)]==_0x2e0e18(0x149))var _0x476575=users[_0x2e0e18(0x182)];else{if(_0x535817[0x0][_0x2e0e18(0x1d5)]==_0x2e0e18(0x21c))var _0x476575=users[_0x2e0e18(0x21c)];else{if(_0x535817[0x0][_0x2e0e18(0x1d5)]==_0x2e0e18(0x184))var _0x476575=users[_0x2e0e18(0x184)];else{if(_0x535817[0x0][_0x2e0e18(0x1d5)]==_0x2e0e18(0x200))var _0x476575=users[_0x2e0e18(0x200)];else{if(_0x535817[0x0][_0x2e0e18(0x1d5)]==_0x2e0e18(0x246))var _0x476575=users[_0x2e0e18(0x246)];else{if(_0x535817[0x0][_0x2e0e18(0x1d5)]==_0x2e0e18(0x153))var _0x476575=users[_0x2e0e18(0x158)];else{if(_0x535817[0x0]['language']==_0x2e0e18(0x17d))var _0x476575=users[_0x2e0e18(0x17d)];else{if(_0x535817[0x0][_0x2e0e18(0x1d5)]==_0x2e0e18(0x1af))var _0x476575=users[_0x2e0e18(0x1c1)];}}}}}}}_0x2904db[_0x2e0e18(0x1a0)](_0x2e0e18(0x150),{'success':_0x2bd2fa['flash']('success'),'errors':_0x2bd2fa[_0x2e0e18(0x1d6)](_0x2e0e18(0x1e5)),'purchases':_0x26b331,'role':_0x3632da,'profile':_0x4a3250,'master_shop':_0x535817,'language':_0x476575});}catch(_0x2c89aa){console['log'](_0x2e0e18(0x202),_0x2c89aa),_0x2904db[_0x2e0e18(0x167)](0xc8)[_0x2e0e18(0x1f0)]({'message':_0x2c89aa['message']});}});function BayBinSelected(_0x17bb00,_0x2c50d5){var _0x47aa7e=a0_0x25fe79,_0x1f5ac6=[],_0x2b6e08=[];if(_0x17bb00==_0x47aa7e(0x210)){switch(_0x2c50d5){case _0x47aa7e(0x204):_0x1f5ac6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x47aa7e(0x1eb):_0x1f5ac6=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2b6e08=['DG'];}else{if(_0x17bb00==_0x47aa7e(0x230)){switch(_0x2c50d5){case _0x47aa7e(0x204):_0x1f5ac6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x47aa7e(0x1eb):_0x1f5ac6=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2b6e08=['FG'];}}return{'levels':_0x1f5ac6,'identify':_0x2b6e08};}async function getRandom8DigitNumber(){var _0x319d95=a0_0x25fe79;const _0x5b0381=0x989680,_0x35fcb8=0x5f5e0ff,_0x2be221=Math[_0x319d95(0x1f3)](Math['random']()*(_0x35fcb8-_0x5b0381+0x1))+_0x5b0381;var _0x54c716;const _0x11d419=await purchases_finished[_0x319d95(0x221)]({'invoice':_0x319d95(0x14c)+_0x2be221});return _0x11d419&&_0x11d419[_0x319d95(0x1dd)]>0x0?_0x54c716=_0x319d95(0x14c)+_0x2be221:_0x54c716='INCF-'+_0x2be221,_0x54c716;}router[a0_0x25fe79(0x207)](a0_0x25fe79(0x19e),auth,async(_0x3daacb,_0x1308a7)=>{var _0x562f5b=a0_0x25fe79;try{const {username:_0x47177b,email:_0x1492d4,role:_0x432472}=_0x3daacb['user'],_0x29fdef=_0x3daacb[_0x562f5b(0x23c)],_0x239fdd=await profile[_0x562f5b(0x221)]({'email':_0x29fdef[_0x562f5b(0x1ef)]}),_0x345576=await master_shop[_0x562f5b(0x157)](),_0x48a9b2=await staff[_0x562f5b(0x221)]({'email':_0x29fdef[_0x562f5b(0x1ef)]}),_0x3c42d3=await suppliers[_0x562f5b(0x157)]({});let _0x5080cc;if(_0x29fdef['role']==_0x562f5b(0x205)){const _0x184a37=await staff[_0x562f5b(0x221)]({'email':_0x29fdef['email']});_0x5080cc=await warehouse[_0x562f5b(0x192)]([{'$match':{'status':'Enabled','name':_0x184a37[_0x562f5b(0x170)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x562f5b(0x1cc),'name':{'$first':'$name'}}}]);}else _0x5080cc=await warehouse['aggregate']([{'$match':{'status':_0x562f5b(0x1ba),'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x562f5b(0x1cc)}}}]);const _0x269bb4=await product[_0x562f5b(0x157)]({}),_0x4c547e=await warehouse[_0x562f5b(0x157)]({'status':_0x562f5b(0x1ba)}),_0x12f28f=await purchases_finished[_0x562f5b(0x157)]({}),_0x2d24d8=_0x12f28f['length']+0x1,_0x3350c3=_0x562f5b(0x14c)+_0x2d24d8['toString']()[_0x562f5b(0x1ed)](0x5,'0');var _0x1610ef=[_0x562f5b(0x1f7),_0x562f5b(0x1bd)];if(_0x345576[0x0]['language']=='English\x20(US)')var _0x54e47e=users[_0x562f5b(0x182)];else{if(_0x345576[0x0][_0x562f5b(0x1d5)]=='Hindi')var _0x54e47e=users[_0x562f5b(0x21c)];else{if(_0x345576[0x0]['language']==_0x562f5b(0x184))var _0x54e47e=users[_0x562f5b(0x184)];else{if(_0x345576[0x0][_0x562f5b(0x1d5)]==_0x562f5b(0x200))var _0x54e47e=users['Spanish'];else{if(_0x345576[0x0]['language']==_0x562f5b(0x246))var _0x54e47e=users['French'];else{if(_0x345576[0x0][_0x562f5b(0x1d5)]==_0x562f5b(0x153))var _0x54e47e=users['Portuguese'];else{if(_0x345576[0x0][_0x562f5b(0x1d5)]==_0x562f5b(0x17d))var _0x54e47e=users[_0x562f5b(0x17d)];else{if(_0x345576[0x0][_0x562f5b(0x1d5)]==_0x562f5b(0x1af))var _0x54e47e=users[_0x562f5b(0x1c1)];}}}}}}}const _0x5dec63=getRandom8DigitNumber();_0x5dec63[_0x562f5b(0x154)](_0x56d077=>{var _0x2041c1=_0x562f5b;_0x1308a7[_0x2041c1(0x1a0)](_0x2041c1(0x1ca),{'success':_0x3daacb[_0x2041c1(0x1d6)](_0x2041c1(0x1a4)),'errors':_0x3daacb[_0x2041c1(0x1d6)](_0x2041c1(0x1e5)),'role':_0x29fdef,'profile':_0x239fdd,'suppliers':_0x3c42d3,'warehouse':_0x5080cc,'product':_0x269bb4,'invoice':_0x56d077,'master_shop':_0x345576,'language':_0x54e47e,'find_data':_0x4c547e,'rooms_data':_0x1610ef});})[_0x562f5b(0x155)](_0x555a63=>{var _0x30f5a8=_0x562f5b;_0x3daacb['flash'](_0x30f5a8(0x1e5),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1308a7[_0x30f5a8(0x18a)]('/all_purchases_finished/view');});}catch(_0x5238fd){console[_0x562f5b(0x220)](_0x5238fd);}}),router['get'](a0_0x25fe79(0x1ae),auth,async(_0x452bd2,_0x390acb)=>{var _0x27c912=a0_0x25fe79;try{const _0x165e35=_0x452bd2[_0x27c912(0x1aa)]['id'];console[_0x27c912(0x220)](_0x165e35);const _0x1b4f15=await master_shop[_0x27c912(0x157)]();console[_0x27c912(0x220)]('master',_0x1b4f15);const _0x1ff4d3=await product[_0x27c912(0x221)]({'name':_0x165e35});console[_0x27c912(0x220)](_0x27c912(0x172),_0x1ff4d3),_0x390acb['status'](0xc8)[_0x27c912(0x1f0)]({'product_data':_0x1ff4d3,'master':_0x1b4f15});}catch(_0x36075f){console[_0x27c912(0x220)]('add_purchases\x20error',_0x36075f);}}),router[a0_0x25fe79(0x1c2)]('/view/add_purchases',auth,async(_0x4e2d2e,_0x25c4cd)=>{var _0x2d88a0=a0_0x25fe79;try{const {invoice:_0x2deed3,date:_0x13e325,warehouse_name:_0xd26155,prod_name:_0x4e86d2,prod_code:_0x13e3b9,prod_qty:_0x2c812f,prod_unit:_0x590f0c,prod_secondunit:_0x3df6bb,prod_level:_0x51629c,prod_isle:_0x1b9927,prod_pallet:_0x5824dd,note:_0x794f2b,expiry_date:_0x45f1a1,batch_code:_0x4d80b5,payable:_0x39545a,due_amount:_0x59c4f2,Room_name:_0x5f4c73,primary_code:_0x2de709,secondary_code:_0xd1a55e,MaxStocks_data:_0x4e6bf7,PO_number:_0x164941,SCRN:_0x149dc0,JO_number:_0x4972b3}=_0x4e2d2e[_0x2d88a0(0x1ad)];if(typeof _0x4e86d2=='string')var _0x2ee7d5=[_0x4e2d2e[_0x2d88a0(0x1ad)]['prod_name']],_0x28bfcf=[_0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x1c8)]],_0x478280=[_0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x19f)]],_0x9c71c9=[_0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x21a)]],_0x2ce803=[_0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x1e9)]],_0x297ce3=[_0x4e2d2e[_0x2d88a0(0x1ad)]['prod_level']],_0x44c4d2=[_0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x203)]],_0x1343ea=[_0x4e2d2e['body']['secondary_code']],_0x5f5727=[_0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x1fe)]],_0x1582c6=[_0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x232)]],_0x551432=[_0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x238)]],_0x175596=[_0x4e2d2e[_0x2d88a0(0x1ad)]['product_date']],_0xc3019e=[_0x4e2d2e[_0x2d88a0(0x1ad)]['max_product_unit']],_0x4f705c=[_0x4e2d2e[_0x2d88a0(0x1ad)]['prod_cat']],_0x4f9256=[_0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x1b4)]],_0x4b3c6e=[_0x4e2d2e[_0x2d88a0(0x1ad)]['prod_invoice']];else var _0x2ee7d5=[..._0x4e2d2e['body'][_0x2d88a0(0x197)]],_0x28bfcf=[..._0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x1c8)]],_0x478280=[..._0x4e2d2e[_0x2d88a0(0x1ad)]['prod_Qty']],_0x9c71c9=[..._0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x21a)]],_0x2ce803=[..._0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x1e9)]],_0x297ce3=[..._0x4e2d2e[_0x2d88a0(0x1ad)]['prod_level']],_0x44c4d2=[..._0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x203)]],_0x1343ea=[..._0x4e2d2e[_0x2d88a0(0x1ad)]['secondary_code']],_0x5f5727=[..._0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x1fe)]],_0x1582c6=[..._0x4e2d2e['body'][_0x2d88a0(0x232)]],_0x551432=[..._0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x238)]],_0x175596=[..._0x4e2d2e['body'][_0x2d88a0(0x178)]],_0xc3019e=[..._0x4e2d2e['body'][_0x2d88a0(0x1f9)]],_0x4f705c=[..._0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x1ac)]],_0x4f9256=[..._0x4e2d2e[_0x2d88a0(0x1ad)]['RoomAssign']],_0x4b3c6e=[..._0x4e2d2e[_0x2d88a0(0x1ad)]['prod_invoice']];const _0x52e426=_0x2ee7d5[_0x2d88a0(0x248)](_0x2b7d9a=>{return _0x2b7d9a={'product_name':_0x2b7d9a};});_0x28bfcf['forEach']((_0x1ba0dd,_0x2fd21b)=>{var _0x476f94=_0x2d88a0;_0x52e426[_0x2fd21b][_0x476f94(0x1de)]=_0x1ba0dd;}),_0x478280[_0x2d88a0(0x206)]((_0xe384bb,_0x53ea69)=>{var _0x4e0be8=_0x2d88a0;_0x52e426[_0x53ea69][_0x4e0be8(0x1f8)]=Math[_0x4e0be8(0x1ce)](_0xe384bb);}),_0x9c71c9[_0x2d88a0(0x206)]((_0x3e67a9,_0x325133)=>{var _0x46f993=_0x2d88a0;_0x52e426[_0x325133][_0x46f993(0x219)]=_0x3e67a9;}),_0x2ce803[_0x2d88a0(0x206)]((_0x50c0bb,_0x10b881)=>{var _0x54f7=_0x2d88a0;_0x52e426[_0x10b881][_0x54f7(0x19c)]=_0x50c0bb;}),_0x297ce3['forEach']((_0x2b763b,_0xbcccdb)=>{var _0x298659=_0x2d88a0;_0x52e426[_0xbcccdb][_0x298659(0x1c4)]=_0x2b763b;}),_0x44c4d2['forEach']((_0x901b7b,_0x589722)=>{var _0x204f37=_0x2d88a0;_0x52e426[_0x589722][_0x204f37(0x203)]=_0x901b7b;}),_0x1343ea[_0x2d88a0(0x206)]((_0x5df1e5,_0x361286)=>{var _0x3a64ef=_0x2d88a0;_0x52e426[_0x361286][_0x3a64ef(0x1d1)]=_0x5df1e5;}),_0x5f5727[_0x2d88a0(0x206)]((_0xb35688,_0x12229a)=>{var _0x27de7c=_0x2d88a0;_0x52e426[_0x12229a][_0x27de7c(0x163)]=_0xb35688;}),_0x1582c6[_0x2d88a0(0x206)]((_0x4cd34b,_0x129cd2)=>{_0x52e426[_0x129cd2]['batch_code']=_0x4cd34b;}),_0x551432[_0x2d88a0(0x206)]((_0x5347bc,_0x2c2db6)=>{_0x52e426[_0x2c2db6]['expiry_date']=_0x5347bc;}),_0x175596[_0x2d88a0(0x206)]((_0x118661,_0x4c2467)=>{var _0x3561ed=_0x2d88a0;_0x52e426[_0x4c2467][_0x3561ed(0x1c0)]=_0x118661;}),_0xc3019e[_0x2d88a0(0x206)]((_0x2729a7,_0x272941)=>{_0x52e426[_0x272941]['maxperunit']=_0x2729a7;}),_0x4f705c[_0x2d88a0(0x206)]((_0x432d4a,_0x574ce7)=>{var _0x21196b=_0x2d88a0;_0x52e426[_0x574ce7][_0x21196b(0x164)]=_0x432d4a;}),_0x4f9256[_0x2d88a0(0x206)]((_0x38f88b,_0x48804f)=>{var _0x1b212d=_0x2d88a0;_0x52e426[_0x48804f][_0x1b212d(0x168)]=_0x38f88b;}),_0x4b3c6e[_0x2d88a0(0x206)]((_0x5b93e9,_0x4bace1)=>{var _0x567a6d=_0x2d88a0;_0x52e426[_0x4bace1][_0x567a6d(0x21e)]=_0x5b93e9;});const _0x5c3296=_0x52e426[_0x2d88a0(0x1e7)](_0x6b71cb=>_0x6b71cb[_0x2d88a0(0x1f8)]!=='0'&&_0x6b71cb[_0x2d88a0(0x1f8)]!==''),_0x4db3c0=new purchases_finished({'invoice':_0x2deed3,'suppliers':_0x4e2d2e[_0x2d88a0(0x1ad)][_0x2d88a0(0x1a9)],'date':_0x13e325,'warehouse_name':_0xd26155,'product':_0x5c3296,'note':_0x794f2b,'due_amount':_0x59c4f2,'room':_0x5f4c73,'POnumber':_0x164941,'SCRN':_0x149dc0,'JO_number':_0x4972b3}),_0x2344a0=await _0x4db3c0[_0x2d88a0(0x231)](),_0x127207=await purchases_finished[_0x2d88a0(0x221)]({'invoice':_0x2deed3}),_0x58cb29=_0x127207[_0x2d88a0(0x172)][_0x2d88a0(0x248)](async _0x2dd645=>{var _0xa00ebc=_0x2d88a0;try{var _0x11d375=await warehouse[_0xa00ebc(0x221)]({'name':_0xd26155,'room':_0x2dd645[_0xa00ebc(0x168)]}),_0x2a769b=0x0;const _0x1a1627=_0x11d375[_0xa00ebc(0x1c3)][_0xa00ebc(0x248)](_0x2d1a40=>{var _0x403804=_0xa00ebc;console[_0x403804(0x220)](_0x2d1a40[_0x403804(0x199)]+'=='+_0x2dd645['product_name']+'&&'+_0x2d1a40[_0x403804(0x1c4)]+'=='+_0x2dd645['bay']+'&&'+_0x2d1a40['expiry_date']+'=='+_0x2dd645[_0x403804(0x238)]+'&&'+_0x2d1a40[_0x403804(0x1c0)]+'=='+_0x2dd645['production_date']+'&&'+_0x2d1a40[_0x403804(0x232)]+'=='+_0x2dd645[_0x403804(0x232)]+'&&'+_0x2d1a40[_0x403804(0x21e)]+'=='+_0x127207[_0x403804(0x21e)]),_0x2d1a40['product_name']==_0x2dd645[_0x403804(0x199)]&&_0x2d1a40[_0x403804(0x1c4)]==_0x2dd645[_0x403804(0x1c4)]&&_0x2d1a40[_0x403804(0x238)]==_0x2dd645[_0x403804(0x238)]&&_0x2d1a40[_0x403804(0x1c0)]==_0x2dd645[_0x403804(0x1c0)]&&_0x2d1a40['batch_code']==_0x2dd645['batch_code']&&_0x2d1a40[_0x403804(0x21e)]==_0x127207[_0x403804(0x21e)]&&(_0x2d1a40[_0x403804(0x17a)]=Math['abs'](_0x2d1a40[_0x403804(0x17a)])+Math[_0x403804(0x1ce)](_0x2dd645[_0x403804(0x1f8)]),_0x2a769b++);});return _0x2a769b==0x0&&(_0x11d375[_0xa00ebc(0x1c3)]=_0x11d375[_0xa00ebc(0x1c3)]['concat']({'product_name':_0x2dd645[_0xa00ebc(0x199)],'product_stock':Math[_0xa00ebc(0x1ce)](_0x2dd645[_0xa00ebc(0x1f8)]),'primary_code':_0x2dd645['primary_code'],'secondary_code':_0x2dd645[_0xa00ebc(0x1d1)],'product_code':_0x2dd645[_0xa00ebc(0x1de)],'bay':_0x2dd645[_0xa00ebc(0x1c4)],'maxProducts':_0x2dd645[_0xa00ebc(0x163)],'unit':_0x2dd645[_0xa00ebc(0x219)],'secondary_unit':_0x2dd645[_0xa00ebc(0x19c)],'expiry_date':_0x2dd645[_0xa00ebc(0x238)],'production_date':_0x2dd645[_0xa00ebc(0x1c0)],'maxProducts':_0x2dd645['maxStocks'],'maxPerUnit':_0x2dd645[_0xa00ebc(0x19b)],'batch_code':_0x2dd645['batch_code'],'product_cat':_0x2dd645['product_cat'],'invoice':_0x2dd645[_0xa00ebc(0x21e)],'id_incoming':_0x2dd645[_0xa00ebc(0x1a6)]})),_0x11d375;}catch(_0x499263){return console[_0xa00ebc(0x23d)]('Error\x20occurred\x20while\x20processing\x20product:',_0x499263),null;}});Promise[_0x2d88a0(0x14b)](_0x58cb29)['then'](async _0x636394=>{var _0x4e5944=_0x2d88a0;try{for(const _0x374a63 of _0x636394){await warehouse['updateOne']({'_id':_0x374a63[_0x4e5944(0x1a6)]},{'$addToSet':{'product_details':{'$each':_0x374a63[_0x4e5944(0x1c3)]}}});}const _0x558206=await master_shop[_0x4e5944(0x157)](),_0x2dfee2=await email_settings[_0x4e5944(0x221)](),_0x11f91b=await supervisor_settings[_0x4e5944(0x157)]();var _0x3624aa=_0x127207[_0x4e5944(0x172)],_0x277cf0='',_0x49d705;for(_0x49d705 in _0x3624aa){var _0x2e8091='FG';_0x127207[_0x4e5944(0x1bc)]==_0x4e5944(0x210)&&(_0x2e8091='DG'),_0x277cf0+=_0x4e5944(0x1b6)+_0x4e5944(0x195)+_0x3624aa[_0x49d705][_0x4e5944(0x199)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3624aa[_0x49d705][_0x4e5944(0x1de)]+_0x4e5944(0x1d8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3624aa[_0x49d705][_0x4e5944(0x1f8)]+'</td>'+_0x4e5944(0x195)+_0x3624aa[_0x49d705][_0x4e5944(0x219)]+_0x4e5944(0x1d8)+_0x4e5944(0x195)+_0x3624aa[_0x49d705][_0x4e5944(0x19c)]+_0x4e5944(0x1d8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x127207['warehouse_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3624aa[_0x49d705][_0x4e5944(0x168)]+'</td>'+_0x4e5944(0x195)+_0x2e8091+_0x3624aa[_0x49d705][_0x4e5944(0x1c4)]+_0x4e5944(0x1d8),_0x4e5944(0x1ee);}let _0x5ba5fe=nodemailer[_0x4e5944(0x165)]({'host':_0x2dfee2[_0x4e5944(0x235)],'port':Number(_0x2dfee2[_0x4e5944(0x15d)]),'secure':![],'auth':{'user':_0x2dfee2[_0x4e5944(0x1ef)],'pass':_0x2dfee2[_0x4e5944(0x187)]}}),_0x528291={'from':_0x2dfee2['email'],'to':_0x11f91b[0x0][_0x4e5944(0x18d)],'subject':_0x4e5944(0x1b2),'attachments':[{'filename':_0x4e5944(0x244),'path':__dirname+_0x4e5944(0x175)+_0x4e5944(0x159)+_0x558206[0x0][_0x4e5944(0x15c)],'cid':_0x4e5944(0x177)}],'html':'<!DOCTYPE\x20html>'+_0x4e5944(0x14d)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4e5944(0x236)+_0x4e5944(0x1b5)+_0x4e5944(0x16c)+_0x4e5944(0x236)+'<h2>\x20'+_0x558206[0x0][_0x4e5944(0x179)]+'\x20</h2>'+_0x4e5944(0x16c)+_0x4e5944(0x16c)+_0x4e5944(0x20c)+_0x4e5944(0x236)+_0x4e5944(0x242)+_0x4e5944(0x1db)+_0x127207[_0x4e5944(0x21e)]+'\x20'+_0x4e5944(0x21d)+_0x4e5944(0x23e)+_0x127207['date']+'\x20'+_0x4e5944(0x15e)+'</h5>'+_0x4e5944(0x16c)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x4e5944(0x1fd)+_0x4e5944(0x240)+_0x4e5944(0x1fa)+_0x4e5944(0x180)+_0x4e5944(0x151)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x4e5944(0x1e0)+_0x4e5944(0x1b7)+'</tr>'+_0x4e5944(0x1c7)+_0x4e5944(0x19d)+'\x20'+_0x277cf0+'\x20'+_0x4e5944(0x1c9)+_0x4e5944(0x1b0)+_0x4e5944(0x236)+_0x4e5944(0x1ec)+_0x4e5944(0x18c)+_0x558206[0x0][_0x4e5944(0x179)]+_0x4e5944(0x166)+_0x4e5944(0x16c)+_0x4e5944(0x16c)+'</body></html>'};_0x5ba5fe[_0x4e5944(0x1f4)](_0x528291,function(_0x25d2cd,_0x4f4647){var _0x43c38f=_0x4e5944;_0x25d2cd?(console['log'](_0x25d2cd),console[_0x43c38f(0x220)](_0x43c38f(0x161))):console[_0x43c38f(0x220)](_0x43c38f(0x22c));});}catch(_0xf57f6e){console[_0x4e5944(0x23d)](_0xf57f6e),_0x25c4cd['status'](0x1f4)[_0x4e5944(0x1f0)]({'error':_0x4e5944(0x190),'message':_0xf57f6e['message']});}})[_0x2d88a0(0x155)](_0x176e0f=>{var _0x37fda6=_0x2d88a0;console[_0x37fda6(0x23d)](_0x176e0f);}),_0x4e2d2e[_0x2d88a0(0x1d6)]('success',_0x2d88a0(0x23f)),_0x25c4cd[_0x2d88a0(0x18a)](_0x2d88a0(0x18f));}catch(_0x50701f){console[_0x2d88a0(0x220)](_0x50701f);}}),router[a0_0x25fe79(0x207)](a0_0x25fe79(0x1f6),auth,async(_0x2127c9,_0x467cf6)=>{var _0xa452e8=a0_0x25fe79;try{const {username:_0x496609,email:_0x23ec31,role:_0x75f107}=_0x2127c9[_0xa452e8(0x23c)],_0x18859f=_0x2127c9['user'],_0x4aa118=await profile['findOne']({'email':_0x18859f[_0xa452e8(0x1ef)]}),_0xd1d4e2=await master_shop[_0xa452e8(0x157)](),_0x3c8406=_0x2127c9[_0xa452e8(0x1aa)]['id'],_0x5ee450=await purchases_finished[_0xa452e8(0x20f)](_0x3c8406),_0x349c87=await suppliers['find']({});let _0x2561a5;if(_0x18859f[_0xa452e8(0x186)]=='staff'){const _0x4589c6=await staff[_0xa452e8(0x221)]({'email':_0x18859f['email']});_0x2561a5=await warehouse[_0xa452e8(0x157)]({'status':_0xa452e8(0x1ba),'name':_0x4589c6[_0xa452e8(0x170)],'warehouse_category':_0xa452e8(0x1d3)});}else _0x2561a5=await warehouse[_0xa452e8(0x192)]([{'$match':{'status':_0xa452e8(0x1ba),'warehouse_category':_0xa452e8(0x1d3)}},{'$group':{'_id':_0xa452e8(0x1cc),'name':{'$first':'$name'}}}]);const _0x319422=await product[_0xa452e8(0x157)]({}),_0x207e16=BayBinSelected(_0x5ee450[_0xa452e8(0x1bc)],_0x5ee450[_0xa452e8(0x209)]);let _0x202358=new Date(_0x5ee450['expiry_date']),_0x265d0a=('0'+_0x202358[_0xa452e8(0x16a)]())[_0xa452e8(0x198)](-0x2),_0xf20040=('0'+(_0x202358['getMonth']()+0x1))[_0xa452e8(0x198)](-0x2),_0x3afc9d=_0x202358[_0xa452e8(0x245)](),_0x58cd17=_0x3afc9d+'-'+_0xf20040+'-'+_0x265d0a;if(_0xd1d4e2[0x0][_0xa452e8(0x1d5)]==_0xa452e8(0x149)){var _0x10b7db=users[_0xa452e8(0x182)];console[_0xa452e8(0x220)](_0x10b7db);}else{if(_0xd1d4e2[0x0][_0xa452e8(0x1d5)]==_0xa452e8(0x21c))var _0x10b7db=users['Hindi'];else{if(_0xd1d4e2[0x0][_0xa452e8(0x1d5)]==_0xa452e8(0x184))var _0x10b7db=users[_0xa452e8(0x184)];else{if(_0xd1d4e2[0x0][_0xa452e8(0x1d5)]==_0xa452e8(0x200))var _0x10b7db=users['Spanish'];else{if(_0xd1d4e2[0x0][_0xa452e8(0x1d5)]==_0xa452e8(0x246))var _0x10b7db=users[_0xa452e8(0x246)];else{if(_0xd1d4e2[0x0][_0xa452e8(0x1d5)]=='Portuguese\x20(BR)')var _0x10b7db=users[_0xa452e8(0x158)];else{if(_0xd1d4e2[0x0]['language']==_0xa452e8(0x17d))var _0x10b7db=users[_0xa452e8(0x17d)];else{if(_0xd1d4e2[0x0][_0xa452e8(0x1d5)]=='Arabic\x20(ae)')var _0x10b7db=users[_0xa452e8(0x1c1)];}}}}}}}_0x467cf6[_0xa452e8(0x1a0)](_0xa452e8(0x1b3),{'success':_0x2127c9[_0xa452e8(0x1d6)]('success'),'errors':_0x2127c9[_0xa452e8(0x1d6)](_0xa452e8(0x1e5)),'role':_0x18859f,'profile':_0x4aa118,'purchases':_0x5ee450,'suppliers':_0x349c87,'warehouse':_0x2561a5,'product':_0x319422,'master_shop':_0xd1d4e2,'language':_0x10b7db,'ed_fullDate':_0x58cd17,'dataSelected':_0x207e16});}catch(_0x464921){console[_0xa452e8(0x220)](_0x464921);}}),router[a0_0x25fe79(0x207)](a0_0x25fe79(0x237),auth,async(_0x401b6e,_0x3ac717)=>{var _0x16e926=a0_0x25fe79;try{const {username:_0x10c9a3,email:_0x43d604,role:_0x131734}=_0x401b6e[_0x16e926(0x23c)],_0x2770cd=_0x401b6e[_0x16e926(0x23c)],_0x172d62=await profile[_0x16e926(0x221)]({'email':_0x2770cd[_0x16e926(0x1ef)]}),_0x489e8a=await master_shop[_0x16e926(0x157)](),_0xb2ed45=_0x401b6e[_0x16e926(0x1aa)]['id'],_0x21412f=await purchases_finished[_0x16e926(0x20f)](_0xb2ed45),_0x174c92=await suppliers[_0x16e926(0x157)]({});let _0x42244f;if(_0x2770cd['role']==_0x16e926(0x205)){const _0x291311=await staff[_0x16e926(0x221)]({'email':_0x2770cd[_0x16e926(0x1ef)]});_0x42244f=await warehouse['find']({'status':_0x16e926(0x1ba),'name':_0x291311['warehouse'],'warehouse_category':_0x16e926(0x1d3)});}else _0x42244f=await warehouse[_0x16e926(0x192)]([{'$match':{'status':_0x16e926(0x1ba),'warehouse_category':_0x16e926(0x1d3)}},{'$group':{'_id':'$name','name':{'$first':_0x16e926(0x1cc)}}}]);const _0x4acc95=await product[_0x16e926(0x157)]({}),_0x61bc87=BayBinSelected(_0x21412f['warehouse_name'],_0x21412f[_0x16e926(0x209)]);let _0x3c46b2=new Date(_0x21412f[_0x16e926(0x238)]),_0x1cee57=('0'+_0x3c46b2[_0x16e926(0x16a)]())[_0x16e926(0x198)](-0x2),_0x1c462f=('0'+(_0x3c46b2[_0x16e926(0x234)]()+0x1))[_0x16e926(0x198)](-0x2),_0x18f921=_0x3c46b2[_0x16e926(0x245)](),_0x4cedd4=_0x18f921+'-'+_0x1c462f+'-'+_0x1cee57;if(_0x489e8a[0x0]['language']=='English\x20(US)'){var _0xbea12f=users[_0x16e926(0x182)];console[_0x16e926(0x220)](_0xbea12f);}else{if(_0x489e8a[0x0]['language']==_0x16e926(0x21c))var _0xbea12f=users[_0x16e926(0x21c)];else{if(_0x489e8a[0x0][_0x16e926(0x1d5)]=='German')var _0xbea12f=users[_0x16e926(0x184)];else{if(_0x489e8a[0x0][_0x16e926(0x1d5)]=='Spanish')var _0xbea12f=users[_0x16e926(0x200)];else{if(_0x489e8a[0x0][_0x16e926(0x1d5)]==_0x16e926(0x246))var _0xbea12f=users['French'];else{if(_0x489e8a[0x0][_0x16e926(0x1d5)]==_0x16e926(0x153))var _0xbea12f=users[_0x16e926(0x158)];else{if(_0x489e8a[0x0][_0x16e926(0x1d5)]=='Chinese')var _0xbea12f=users['Chinese'];else{if(_0x489e8a[0x0][_0x16e926(0x1d5)]=='Arabic\x20(ae)')var _0xbea12f=users[_0x16e926(0x1c1)];}}}}}}}_0x3ac717[_0x16e926(0x1a0)](_0x16e926(0x208),{'success':_0x401b6e[_0x16e926(0x1d6)]('success'),'errors':_0x401b6e[_0x16e926(0x1d6)](_0x16e926(0x1e5)),'role':_0x2770cd,'profile':_0x172d62,'purchases':_0x21412f,'suppliers':_0x174c92,'warehouse':_0x42244f,'product':_0x4acc95,'master_shop':_0x489e8a,'language':_0xbea12f,'ed_fullDate':_0x4cedd4,'dataSelected':_0x61bc87});}catch(_0x4e7ccb){console[_0x16e926(0x220)](_0x4e7ccb);}}),router['post'](a0_0x25fe79(0x237),auth,async(_0x15918a,_0x15b4aa)=>{var _0x44d2e2=a0_0x25fe79;try{const _0x3877a6=_0x15918a['params']['id'],_0x4a754f=await purchases_finished[_0x44d2e2(0x221)]({'_id':_0x15918a[_0x44d2e2(0x1aa)]['id']}),_0xb52e87=await warehouse[_0x44d2e2(0x221)]({'name':_0x4a754f['warehouse_name'],'room':_0x4a754f['room']});_0x4a754f[_0x44d2e2(0x172)][_0x44d2e2(0x206)](_0x178f02=>{var _0x1871ac=_0x44d2e2;const _0x11f207=_0xb52e87['product_details'][_0x1871ac(0x248)](_0x50ce85=>{var _0x551233=_0x1871ac;_0x50ce85[_0x551233(0x199)]==_0x178f02['product_name']&&_0x50ce85['bay']==_0x178f02[_0x551233(0x1c4)]&&(_0x50ce85[_0x551233(0x17a)]=parseInt(_0x50ce85[_0x551233(0x17a)])-parseInt(_0x178f02['quantity']));});}),await _0xb52e87[_0x44d2e2(0x231)]();const {invoice:_0x3a4d0b,suppliers:_0x5d781c,date:_0xcc6b33,warehouse_name:_0x492749,prod_name:_0x355199,prod_code:_0xca91fd,prod_qty:_0x2f885c,prod_unit:_0x3426a9,prod_secondunit:_0x517367,prod_level:_0x263085,prod_isle:_0x2ea9e2,prod_pallet:_0x3d332e,note:_0x2e1a15,expiry_date:_0x39bf62,batch_code:_0x6b280f,paid_amount:_0x17f243,due_amount:_0x4ad7df,Room_name:_0x1fcaf3,primary_code:_0x1d187a,secondary_code:_0x34aca6,PO_number:_0x581e6c,JO_number:_0x31aa0a}=_0x15918a[_0x44d2e2(0x1ad)];if(typeof _0x355199==_0x44d2e2(0x1be))var _0x611e37=[_0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x197)]],_0x151965=[_0x15918a['body'][_0x44d2e2(0x1c8)]],_0x507664=[_0x15918a[_0x44d2e2(0x1ad)]['prod_qty']],_0xf309fc=[_0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x162)]],_0x3a111e=[_0x15918a['body'][_0x44d2e2(0x1e9)]],_0x1efa74=[_0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x1cd)]],_0x492fd4=[_0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x203)]],_0x13ed16=[_0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x1d1)]],_0x1ee340=[_0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x1fe)]],_0x24ea63=[_0x15918a['body'][_0x44d2e2(0x232)]],_0x4b26ea=[_0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x238)]];else var _0x611e37=[..._0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x197)]],_0x151965=[..._0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x1c8)]],_0x507664=[..._0x15918a['body'][_0x44d2e2(0x1a7)]],_0xf309fc=[..._0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x162)]],_0x3a111e=[..._0x15918a[_0x44d2e2(0x1ad)]['prod_secondunit']],_0x1efa74=[..._0x15918a[_0x44d2e2(0x1ad)]['prod_level']],_0x492fd4=[..._0x15918a['body'][_0x44d2e2(0x203)]],_0x13ed16=[..._0x15918a[_0x44d2e2(0x1ad)]['secondary_code']],_0x1ee340=[..._0x15918a['body'][_0x44d2e2(0x1fe)]],_0x24ea63=[..._0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x232)]],_0x4b26ea=[..._0x15918a['body'][_0x44d2e2(0x238)]];const _0x2cc43c=_0x611e37[_0x44d2e2(0x248)](_0x7e9324=>{return _0x7e9324={'product_name':_0x7e9324};});_0x151965[_0x44d2e2(0x206)]((_0x9009b9,_0x2f6362)=>{var _0x148c81=_0x44d2e2;_0x2cc43c[_0x2f6362][_0x148c81(0x1de)]=_0x9009b9;}),_0x507664[_0x44d2e2(0x206)]((_0x5d93aa,_0x1ab4cf)=>{var _0x23587f=_0x44d2e2;_0x2cc43c[_0x1ab4cf][_0x23587f(0x1f8)]=_0x5d93aa;}),_0xf309fc[_0x44d2e2(0x206)]((_0x161099,_0x5d137c)=>{var _0x5ab0bc=_0x44d2e2;_0x2cc43c[_0x5d137c][_0x5ab0bc(0x219)]=_0x161099;}),_0x3a111e['forEach']((_0x35b310,_0x2e1ae8)=>{_0x2cc43c[_0x2e1ae8]['secondary_unit']=_0x35b310;}),_0x1efa74['forEach']((_0x213ac0,_0x5151de)=>{var _0x38ff5f=_0x44d2e2;_0x2cc43c[_0x5151de][_0x38ff5f(0x1c4)]=_0x213ac0;}),_0x492fd4['forEach']((_0xbe77aa,_0x20d049)=>{var _0x4051ae=_0x44d2e2;_0x2cc43c[_0x20d049][_0x4051ae(0x203)]=_0xbe77aa;}),_0x13ed16[_0x44d2e2(0x206)]((_0x62e2fd,_0x2ce00b)=>{var _0x57efe3=_0x44d2e2;_0x2cc43c[_0x2ce00b][_0x57efe3(0x1d1)]=_0x62e2fd;}),_0x1ee340[_0x44d2e2(0x206)]((_0x503947,_0x1bddc7)=>{var _0x411ca3=_0x44d2e2;_0x2cc43c[_0x1bddc7][_0x411ca3(0x163)]=_0x503947;}),_0x24ea63[_0x44d2e2(0x206)]((_0xa96069,_0x3938ff)=>{var _0x3db47e=_0x44d2e2;_0x2cc43c[_0x3938ff][_0x3db47e(0x232)]=_0xa96069;}),_0x4b26ea['forEach']((_0x5a06c5,_0x4a8fd6)=>{var _0x8b49d2=_0x44d2e2;_0x2cc43c[_0x4a8fd6][_0x8b49d2(0x238)]=_0x5a06c5;});const _0x91a4ac=_0x2cc43c[_0x44d2e2(0x1e7)](_0xb95fc1=>_0xb95fc1[_0x44d2e2(0x1f8)]!=='0'&&_0xb95fc1[_0x44d2e2(0x1f8)]!=='');_0x4a754f[_0x44d2e2(0x21e)]=_0x3a4d0b,_0x4a754f[_0x44d2e2(0x1a9)]=_0x5d781c,_0x4a754f['date']=_0xcc6b33,_0x4a754f[_0x44d2e2(0x1bc)]=_0x492749,_0x4a754f[_0x44d2e2(0x172)]=_0x91a4ac,_0x4a754f[_0x44d2e2(0x1b1)]=_0x2e1a15,_0x4a754f[_0x44d2e2(0x20d)]=_0x17f243,_0x4a754f[_0x44d2e2(0x20e)]=_0x4ad7df,_0x4a754f['room']=_0x1fcaf3,_0x4a754f[_0x44d2e2(0x188)]=_0x581e6c,_0x4a754f['JO_number']=_0x31aa0a;const _0x2220c1=await _0x4a754f[_0x44d2e2(0x231)](),_0x384f2b=await warehouse[_0x44d2e2(0x221)]({'name':_0x15918a['body']['warehouse_name'],'room':_0x15918a[_0x44d2e2(0x1ad)]['Room_name']});_0x4a754f[_0x44d2e2(0x172)][_0x44d2e2(0x206)](_0x305eb8=>{var _0x30c057=_0x44d2e2,_0x380961=0x0;const _0x3a6e08=_0x384f2b[_0x30c057(0x1c3)][_0x30c057(0x248)](_0x18f94b=>{var _0x208a74=_0x30c057;_0x18f94b['product_name']==_0x305eb8[_0x208a74(0x199)]&&_0x18f94b[_0x208a74(0x1c4)]==_0x305eb8[_0x208a74(0x1c4)]&&(_0x18f94b['product_stock']=parseInt(_0x18f94b['product_stock'])+parseInt(_0x305eb8[_0x208a74(0x1f8)]),_0x380961++);});_0x380961=='0'&&(_0x384f2b[_0x30c057(0x1c3)]=_0x384f2b[_0x30c057(0x1c3)][_0x30c057(0x1ab)]({'product_name':_0x305eb8[_0x30c057(0x199)],'product_stock':_0x305eb8[_0x30c057(0x1f8)],'primary_code':_0x305eb8[_0x30c057(0x203)],'secondary_code':_0x305eb8[_0x30c057(0x1d1)],'product_code':_0x305eb8[_0x30c057(0x1de)],'bay':_0x305eb8[_0x30c057(0x1c4)],'maxProducts':_0x305eb8[_0x30c057(0x163)],'unit':_0x305eb8['standard_unit'],'secondary_unit':_0x305eb8[_0x30c057(0x19c)],'expiry_date':_0x305eb8[_0x30c057(0x238)]}));}),await _0x384f2b[_0x44d2e2(0x231)]();const _0xe8d70c=await s_payment_data[_0x44d2e2(0x221)]({'invoice':_0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x21e)]});if(_0xe8d70c===null){}else console[_0x44d2e2(0x220)](_0x44d2e2(0x1a9),_0xe8d70c,_0x15918a[_0x44d2e2(0x1ad)][_0x44d2e2(0x21e)]),_0xe8d70c[_0x44d2e2(0x1a9)]=_0x15918a['body'][_0x44d2e2(0x1a9)],await _0xe8d70c[_0x44d2e2(0x231)]();_0x15918a['flash'](_0x44d2e2(0x1a4),_0x44d2e2(0x185)),_0x15b4aa[_0x44d2e2(0x18a)]('/all_purchases_finished/view');}catch(_0x4e2cbb){console[_0x44d2e2(0x220)](_0x4e2cbb);}}),router['post'](a0_0x25fe79(0x223),auth,async(_0x27077f,_0x450dc0)=>{var _0x4b4683=a0_0x25fe79;try{const _0x2bab6d=_0x27077f[_0x4b4683(0x1aa)]['id'],{invoice:_0x428c06,suppliers:_0x17b89c,payable:_0x4eace5,due_amount:_0x1502c3}=_0x27077f[_0x4b4683(0x1ad)],_0x6511b3=await purchases['findById'](_0x2bab6d);var _0x139cc1=_0x4eace5-_0x1502c3;_0x6511b3[_0x4b4683(0x20d)]=parseFloat(_0x6511b3['paid_amount'])+parseFloat(_0x1502c3),_0x6511b3[_0x4b4683(0x20e)]=_0x139cc1;const _0x364b93=await _0x6511b3[_0x4b4683(0x231)]();console[_0x4b4683(0x220)](_0x364b93);const _0x5ba5f7=await s_payment_data['findOne']({'invoice':_0x428c06});_0x5ba5f7['amount']=_0x139cc1,await _0x5ba5f7[_0x4b4683(0x231)]();let _0x5f0d37=new Date(),_0x3ed5d5=('0'+_0x5f0d37['getDate']())[_0x4b4683(0x198)](-0x2),_0x22a142=('0'+(_0x5f0d37[_0x4b4683(0x234)]()+0x1))['slice'](-0x2),_0xe97826=_0x5f0d37[_0x4b4683(0x245)](),_0x49297e=_0xe97826+'-'+_0x22a142+'-'+_0x3ed5d5;const _0x38b119=new suppliers_payment({'invoice':_0x428c06,'date':_0xe97826+'-'+_0x22a142+'-'+_0x3ed5d5,'suppliers':_0x17b89c,'reason':'Paid\x20For\x20Purchase','amount':_0x1502c3}),_0x4f9d11=await _0x38b119[_0x4b4683(0x231)]();_0x27077f[_0x4b4683(0x1d6)](_0x4b4683(0x1a4),_0x4b4683(0x214)),_0x450dc0[_0x4b4683(0x18a)]('/all_purchases/view');}catch(_0x2030d8){console[_0x4b4683(0x220)](_0x2030d8);}}),router[a0_0x25fe79(0x207)]('/invoice/:id',auth,async(_0x416a13,_0x42c675)=>{var _0x3c0e0d=a0_0x25fe79;try{const {username:_0x31d136,email:_0x2fd6fc,role:_0x528eb5}=_0x416a13[_0x3c0e0d(0x23c)],_0x41410a=_0x416a13['user'],_0x5324c8=await profile['findOne']({'email':_0x41410a[_0x3c0e0d(0x1ef)]}),_0x3a0a35=await master_shop[_0x3c0e0d(0x157)]();console[_0x3c0e0d(0x220)](_0x3c0e0d(0x173),_0x3a0a35);const _0x3a418c=_0x416a13['params']['id'],_0x13358a=await purchases[_0x3c0e0d(0x20f)](_0x3a418c);console[_0x3c0e0d(0x220)](_0x13358a);const _0x53e0c5=await suppliers['findOne']({'name':_0x13358a['suppliers']});console['log'](_0x53e0c5);if(_0x3a0a35[0x0][_0x3c0e0d(0x1d5)]==_0x3c0e0d(0x149)){var _0x190e7a=users['English'];console[_0x3c0e0d(0x220)](_0x190e7a);}else{if(_0x3a0a35[0x0][_0x3c0e0d(0x1d5)]==_0x3c0e0d(0x21c))var _0x190e7a=users[_0x3c0e0d(0x21c)];else{if(_0x3a0a35[0x0][_0x3c0e0d(0x1d5)]=='German')var _0x190e7a=users[_0x3c0e0d(0x184)];else{if(_0x3a0a35[0x0][_0x3c0e0d(0x1d5)]==_0x3c0e0d(0x200))var _0x190e7a=users['Spanish'];else{if(_0x3a0a35[0x0][_0x3c0e0d(0x1d5)]==_0x3c0e0d(0x246))var _0x190e7a=users['French'];else{if(_0x3a0a35[0x0][_0x3c0e0d(0x1d5)]==_0x3c0e0d(0x153))var _0x190e7a=users['Portuguese'];else{if(_0x3a0a35[0x0][_0x3c0e0d(0x1d5)]==_0x3c0e0d(0x17d))var _0x190e7a=users['Chinese'];else{if(_0x3a0a35[0x0][_0x3c0e0d(0x1d5)]==_0x3c0e0d(0x1af))var _0x190e7a=users[_0x3c0e0d(0x1c1)];}}}}}}}_0x42c675[_0x3c0e0d(0x1a0)](_0x3c0e0d(0x1d4),{'success':_0x416a13[_0x3c0e0d(0x1d6)](_0x3c0e0d(0x1a4)),'errors':_0x416a13[_0x3c0e0d(0x1d6)]('errors'),'role':_0x41410a,'profile':_0x5324c8,'master_shop':_0x3a0a35,'supplier':_0x53e0c5,'purchase':_0x13358a,'language':_0x190e7a});}catch(_0x25727c){console['log'](_0x25727c);}}),router[a0_0x25fe79(0x207)](a0_0x25fe79(0x17e),auth,async(_0x1bdd82,_0x3523d0)=>{var _0x58ffb6=a0_0x25fe79;try{const {username:_0x1af449,email:_0x1f3fdb,role:_0x4b4456}=_0x1bdd82['user'],_0x425adb=_0x1bdd82[_0x58ffb6(0x23c)],_0x4d18a6=await profile[_0x58ffb6(0x221)]({'email':_0x425adb['email']}),_0x26a938=await master_shop['find']();console['log'](_0x58ffb6(0x173),_0x26a938);const _0x4b35d8=_0x1bdd82[_0x58ffb6(0x1aa)]['id'];console[_0x58ffb6(0x220)](_0x4b35d8);const _0x2a9cce=await purchases_finished[_0x58ffb6(0x20f)](_0x4b35d8);console[_0x58ffb6(0x220)](_0x58ffb6(0x16d),_0x2a9cce);const _0x4ceb4a=await product[_0x58ffb6(0x157)]({}),_0x30dbf3=await warehouse[_0x58ffb6(0x192)]([{'$match':{'name':_0x2a9cce['warehouse_name'],'room':_0x2a9cce[_0x58ffb6(0x209)]}},{'$unwind':_0x58ffb6(0x1e8)},{'$group':{'_id':_0x58ffb6(0x1d0),'name':{'$first':_0x58ffb6(0x18e)},'product_stock':{'$first':_0x58ffb6(0x176)},'bay':{'$first':_0x58ffb6(0x174)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x58ffb6(0x169)},'floorlevel':{'$first':_0x58ffb6(0x18b)},'primary_code':{'$first':_0x58ffb6(0x183)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x58ffb6(0x17f)},'storage':{'$first':_0x58ffb6(0x171)},'rack':{'$first':_0x58ffb6(0x1fb)}}}]);console[_0x58ffb6(0x220)]('stock_data',_0x30dbf3);let _0x3e75ae;if(_0x425adb[_0x58ffb6(0x186)]==_0x58ffb6(0x205)){const _0x534b69=await staff['findOne']({'email':_0x425adb[_0x58ffb6(0x1ef)]});_0x3e75ae=await warehouse[_0x58ffb6(0x157)]({'status':_0x58ffb6(0x1ba),'name':_0x534b69['warehouse'],'warehouse_category':_0x58ffb6(0x1d3),'name':_0x58ffb6(0x229)});}else _0x3e75ae=await warehouse[_0x58ffb6(0x192)]([{'$match':{'status':'Enabled','warehouse_category':_0x58ffb6(0x1d3),'name':_0x58ffb6(0x229)}},{'$group':{'_id':_0x58ffb6(0x1cc),'name':{'$first':_0x58ffb6(0x1cc)}}}]);if(_0x26a938[0x0][_0x58ffb6(0x1d5)]==_0x58ffb6(0x149)){var _0x1b084e=users[_0x58ffb6(0x182)];console[_0x58ffb6(0x220)](_0x1b084e);}else{if(_0x26a938[0x0][_0x58ffb6(0x1d5)]==_0x58ffb6(0x21c))var _0x1b084e=users[_0x58ffb6(0x21c)];else{if(_0x26a938[0x0][_0x58ffb6(0x1d5)]==_0x58ffb6(0x184))var _0x1b084e=users[_0x58ffb6(0x184)];else{if(_0x26a938[0x0][_0x58ffb6(0x1d5)]==_0x58ffb6(0x200))var _0x1b084e=users[_0x58ffb6(0x200)];else{if(_0x26a938[0x0][_0x58ffb6(0x1d5)]==_0x58ffb6(0x246))var _0x1b084e=users['French'];else{if(_0x26a938[0x0][_0x58ffb6(0x1d5)]==_0x58ffb6(0x153))var _0x1b084e=users[_0x58ffb6(0x158)];else{if(_0x26a938[0x0][_0x58ffb6(0x1d5)]==_0x58ffb6(0x17d))var _0x1b084e=users[_0x58ffb6(0x17d)];else{if(_0x26a938[0x0][_0x58ffb6(0x1d5)]==_0x58ffb6(0x1af))var _0x1b084e=users[_0x58ffb6(0x1c1)];}}}}}}}_0x3523d0[_0x58ffb6(0x1a0)](_0x58ffb6(0x15f),{'success':_0x1bdd82[_0x58ffb6(0x1d6)](_0x58ffb6(0x1a4)),'errors':_0x1bdd82[_0x58ffb6(0x1d6)](_0x58ffb6(0x1e5)),'role':_0x425adb,'profile':_0x4d18a6,'user':_0x2a9cce,'stock':_0x30dbf3,'master_shop':_0x26a938,'product':_0x4ceb4a,'language':_0x1b084e,'warehouse':_0x3e75ae});}catch(_0x310e1c){console[_0x58ffb6(0x220)](_0x310e1c);}}),router['post'](a0_0x25fe79(0x17e),auth,async(_0xa25dad,_0x4f4ec9)=>{var _0x5a3394=a0_0x25fe79;try{const {invoice:_0xc84c4a,date:_0x407d91,warehouse_name:_0x1c3f5d,Room_name:_0x3ae6e4,product_name:_0x1fca38,purchase_quantity:_0x5653ac,stocks:_0x5b1fb4,return_qty:_0x551b69,note:_0x21331f,level:_0xc77ad3,isle:_0xe86b2,pallet:_0x2ef2f4,to_warehouse_name:_0x187c18,to_Room_name:_0x4535e3}=_0xa25dad[_0x5a3394(0x1ad)],_0x332eb0=await purchases_finished[_0x5a3394(0x221)]({'_id':_0xa25dad[_0x5a3394(0x1aa)]['id']}),_0x5daa36=await warehouse[_0x5a3394(0x221)]({'name':_0x1c3f5d,'room':_0x3ae6e4,'warehouse_category':_0x5a3394(0x1d3)});if(typeof _0x1fca38==_0x5a3394(0x1be))var _0x14eafb=[_0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x199)]],_0x5c304d=[_0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x160)]],_0x2fd617=[_0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x193)]],_0x21604b=[_0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x1df)]],_0x5798e9=[_0xa25dad['body'][_0x5a3394(0x228)]],_0x23ee5d=[_0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x16e)]],_0x8de71d=[_0xa25dad[_0x5a3394(0x1ad)]['primary_code_hide']],_0xf29444=[_0xa25dad[_0x5a3394(0x1ad)]['secondary_code_hide']];else var _0x14eafb=[..._0xa25dad['body'][_0x5a3394(0x199)]],_0x5c304d=[..._0xa25dad[_0x5a3394(0x1ad)]['purchase_quantity']],_0x2fd617=[..._0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x193)]],_0x21604b=[..._0xa25dad[_0x5a3394(0x1ad)]['return_qty']],_0x5798e9=[..._0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x228)]],_0x23ee5d=[..._0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x16e)]],_0x8de71d=[..._0xa25dad[_0x5a3394(0x1ad)]['primary_code_hide']],_0xf29444=[..._0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x20b)]];const _0x414d42=_0x14eafb['map'](_0x430418=>{return _0x430418={'product_name':_0x430418};});_0x5c304d[_0x5a3394(0x206)]((_0x423a88,_0x285469)=>{var _0x22a7ed=_0x5a3394;_0x414d42[_0x285469][_0x22a7ed(0x160)]=_0x423a88;}),_0x2fd617[_0x5a3394(0x206)]((_0x3026b1,_0x160074)=>{var _0x41f855=_0x5a3394;_0x414d42[_0x160074][_0x41f855(0x243)]=_0x3026b1;}),_0x21604b[_0x5a3394(0x206)]((_0x42f813,_0x58ad50)=>{var _0xd5d615=_0x5a3394;_0x414d42[_0x58ad50][_0xd5d615(0x1df)]=_0x42f813;}),_0x5798e9['forEach']((_0x30cfaf,_0x2f36f5)=>{var _0x1394cf=_0x5a3394;_0x414d42[_0x2f36f5][_0x1394cf(0x1c4)]=_0x30cfaf;}),_0x23ee5d[_0x5a3394(0x206)]((_0x3a7254,_0x44d9c1)=>{var _0x5d6e58=_0x5a3394;_0x414d42[_0x44d9c1][_0x5d6e58(0x1de)]=_0x3a7254;}),_0x8de71d[_0x5a3394(0x206)]((_0x24aaaf,_0x398c57)=>{var _0x45cde4=_0x5a3394;_0x414d42[_0x398c57][_0x45cde4(0x203)]=_0x24aaaf;}),_0xf29444[_0x5a3394(0x206)]((_0x350901,_0xc754f2)=>{var _0x4b34a7=_0x5a3394;_0x414d42[_0xc754f2][_0x4b34a7(0x1d1)]=_0x350901;}),_0x414d42[_0x5a3394(0x206)](_0xad7206=>{var _0x509de3=_0x5a3394;console[_0x509de3(0x220)](_0xad7206);const _0x3debb1=_0x5daa36[_0x509de3(0x1c3)][_0x509de3(0x248)](_0x5c77ab=>{var _0x207a06=_0x509de3;_0x5c77ab[_0x207a06(0x199)]==_0xad7206[_0x207a06(0x199)]&&_0x5c77ab[_0x207a06(0x1c4)]==_0xad7206[_0x207a06(0x1c4)]&&(console[_0x207a06(0x220)](parseInt(_0x5c77ab[_0x207a06(0x17a)])+_0x207a06(0x1b8)+parseInt(_0xad7206[_0x207a06(0x1df)])),_0x5c77ab[_0x207a06(0x17a)]=parseInt(_0x5c77ab['product_stock'])-parseInt(_0xad7206['return_qty']));});}),await _0x5daa36[_0x5a3394(0x231)]();var _0xf3e73a=0x0;_0x414d42[_0x5a3394(0x206)](_0x144160=>{var _0x60f25d=_0x5a3394;(parseInt(_0x144160[_0x60f25d(0x160)])<parseInt(_0x144160[_0x60f25d(0x1df)])||parseInt(_0x144160['stock_quantity'])<parseInt(_0x144160['return_qty']))&&_0xf3e73a++;});if(_0xf3e73a!=0x0)return _0xa25dad[_0x5a3394(0x1d6)](_0x5a3394(0x1e5),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x4f4ec9[_0x5a3394(0x18a)]('back');const _0x5d231d=new purchases_return_finished({'invoice':_0xc84c4a,'suppliers':_0xa25dad['body'][_0x5a3394(0x1a9)],'date':_0x407d91,'warehouse_name':_0x1c3f5d,'return_product':_0x414d42,'note':_0x21331f,'room':_0x3ae6e4,'to_warehouse_name':_0x187c18,'to_room':_0x4535e3}),_0x3a9670=await _0x5d231d[_0x5a3394(0x231)](),_0xf0f178=await purchases_return_finished['findOne']({'invoice':_0xc84c4a}),_0x999df9=await warehouse['findOne']({'name':_0x187c18,'room':_0x4535e3,'warehouse_category':_0x5a3394(0x1d3)});_0xf0f178[_0x5a3394(0x15a)][_0x5a3394(0x206)](_0x245774=>{var _0x59f8a6=_0x5a3394,_0x23de87=0x0;const _0x402202=_0x999df9['product_details'][_0x59f8a6(0x248)](_0x1d600b=>{var _0xf28588=_0x59f8a6;console[_0xf28588(0x220)](_0x1d600b['product_name']+'=='+_0x245774[_0xf28588(0x199)]+'&&'+_0x1d600b['bay']+'=='+_0x245774[_0xf28588(0x1c4)]),_0x1d600b[_0xf28588(0x199)]==_0x245774[_0xf28588(0x199)]&&_0x1d600b[_0xf28588(0x1c4)]==_0x245774[_0xf28588(0x1c4)]&&(_0x1d600b['product_stock']=parseInt(_0x1d600b[_0xf28588(0x17a)])-parseInt(_0x245774[_0xf28588(0x1df)]),_0x23de87++);});_0x23de87=='0'&&(_0x999df9[_0x59f8a6(0x1c3)]=_0x999df9[_0x59f8a6(0x1c3)][_0x59f8a6(0x1ab)]({'product_name':_0x245774['product_name'],'product_stock':_0x245774[_0x59f8a6(0x1df)],'primary_code':_0x245774['primary_code'],'secondary_code':_0x245774[_0x59f8a6(0x1d1)],'product_code':_0x245774[_0x59f8a6(0x1de)],'bay':_0x245774['bay'],'maxProducts':0xf423f}));}),await _0x999df9['save']();const _0x2625c3=await purchases_finished[_0x5a3394(0x221)]({'invoice':_0xc84c4a});_0x2625c3[_0x5a3394(0x21b)]=_0x5a3394(0x22d);const _0x59741b=await _0x2625c3[_0x5a3394(0x231)](),_0x5b7e97=new s_payment_data({'invoice':_0xc84c4a,'suppliers':_0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x1a9)],'reason':'Purchase\x20Return'});await _0x5b7e97[_0x5a3394(0x231)]();const _0x2b9462=await master_shop['find'](),_0x4e02bf=await email_settings['findOne'](),_0x5b9fb8=await suppliers[_0x5a3394(0x221)]({'name':_0xa25dad[_0x5a3394(0x1ad)][_0x5a3394(0x1a9)]});_0x2b9462[0x0][_0x5a3394(0x15b)]==0x1?(right_currency=_0x2b9462[0x0][_0x5a3394(0x1ea)],left_currency=''):(right_currency='',left_currency=_0x2b9462[0x0]['currency']);var _0x39f867=_0x14eafb,_0xc833ae=_0x21604b,_0x16b7bb='',_0x4e5616;for(_0x4e5616 in _0x39f867){_0x16b7bb+=_0x5a3394(0x1b6)+_0x5a3394(0x195)+_0x39f867[_0x4e5616]+_0x5a3394(0x1d8)+_0x5a3394(0x195)+_0xc833ae[_0x4e5616]+_0x5a3394(0x1d8)+_0x5a3394(0x1ee);}let _0x554e24=nodemailer[_0x5a3394(0x165)]({'service':_0x5a3394(0x1a8),'auth':{'user':_0x4e02bf['email'],'pass':_0x4e02bf[_0x5a3394(0x187)]}}),_0x53a503={'from':_0x4e02bf['email'],'to':_0x5b9fb8[_0x5a3394(0x1ef)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x5a3394(0x244),'path':__dirname+_0x5a3394(0x175)+'/upload/'+_0x2b9462[0x0]['image'],'cid':'logo'}],'html':_0x5a3394(0x216)+'<html><head><title></title>'+_0x5a3394(0x1b9)+_0x5a3394(0x236)+_0x5a3394(0x17b)+_0x5a3394(0x236)+_0x5a3394(0x1b5)+_0x5a3394(0x16c)+_0x5a3394(0x236)+_0x5a3394(0x23b)+_0x2b9462[0x0][_0x5a3394(0x179)]+_0x5a3394(0x215)+_0x5a3394(0x16c)+'</div>'+_0x5a3394(0x20c)+_0x5a3394(0x236)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5a3394(0x1db)+_0xc84c4a+'\x20'+_0x5a3394(0x21d)+_0x5a3394(0x23e)+_0x407d91+'\x20'+_0x5a3394(0x15e)+_0x5a3394(0x166)+_0x5a3394(0x16c)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5a3394(0x1bf)+_0x5a3394(0x1b6)+_0x5a3394(0x1fd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x5a3394(0x201)+_0x5a3394(0x191)+_0x5a3394(0x1ee)+'</thead>'+_0x5a3394(0x19d)+'\x20'+_0x16b7bb+'\x20'+_0x5a3394(0x1c9)+'</table>'+_0x5a3394(0x236)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x2b9462[0x0][_0x5a3394(0x179)]+_0x5a3394(0x166)+_0x5a3394(0x16c)+_0x5a3394(0x16c)+_0x5a3394(0x14e)};_0x554e24['sendMail'](_0x53a503,function(_0x3a90ff,_0x5e6028){var _0x26e05e=_0x5a3394;_0x3a90ff?console[_0x26e05e(0x220)]('Error\x20Occurs'):console[_0x26e05e(0x220)](_0x26e05e(0x22c));}),_0xa25dad['flash'](_0x5a3394(0x1a4),_0x5a3394(0x14a)),_0x4f4ec9[_0x5a3394(0x18a)](_0x5a3394(0x18f));}catch(_0x213d85){_0x4f4ec9[_0x5a3394(0x167)](0xc8)['json']({'message':_0x213d85['message']});}}),router['get'](a0_0x25fe79(0x1a1),auth,async(_0xa85b44,_0x1694c4)=>{var _0x1e7a90=a0_0x25fe79;try{const {username:_0x4e9e76,email:_0x4270ec,role:_0x38a6fe}=_0xa85b44['user'],_0x3bff61=_0xa85b44[_0x1e7a90(0x23c)],_0x2b9c5d=await profile[_0x1e7a90(0x221)]({'email':_0x3bff61[_0x1e7a90(0x1ef)]}),_0x337128=await master_shop[_0x1e7a90(0x157)](),_0x535b59=_0xa85b44[_0x1e7a90(0x1aa)]['id'],_0x41529b=await purchases_finished[_0x1e7a90(0x20f)](_0x535b59);if(_0x337128[0x0][_0x1e7a90(0x1d5)]=='English\x20(US)')var _0x4a4815=users['English'];else{if(_0x337128[0x0][_0x1e7a90(0x1d5)]==_0x1e7a90(0x21c))var _0x4a4815=users[_0x1e7a90(0x21c)];else{if(_0x337128[0x0][_0x1e7a90(0x1d5)]==_0x1e7a90(0x184))var _0x4a4815=users[_0x1e7a90(0x184)];else{if(_0x337128[0x0]['language']==_0x1e7a90(0x200))var _0x4a4815=users[_0x1e7a90(0x200)];else{if(_0x337128[0x0][_0x1e7a90(0x1d5)]==_0x1e7a90(0x246))var _0x4a4815=users[_0x1e7a90(0x246)];else{if(_0x337128[0x0][_0x1e7a90(0x1d5)]==_0x1e7a90(0x153))var _0x4a4815=users[_0x1e7a90(0x158)];else{if(_0x337128[0x0][_0x1e7a90(0x1d5)]==_0x1e7a90(0x17d))var _0x4a4815=users[_0x1e7a90(0x17d)];else{if(_0x337128[0x0][_0x1e7a90(0x1d5)]==_0x1e7a90(0x1af))var _0x4a4815=users[_0x1e7a90(0x1c1)];}}}}}}}_0x1694c4['render'](_0x1e7a90(0x224),{'success':_0xa85b44['flash'](_0x1e7a90(0x1a4)),'errors':_0xa85b44[_0x1e7a90(0x1d6)](_0x1e7a90(0x1e5)),'role':_0x3bff61,'profile':_0x2b9c5d,'alldata':_0x41529b,'master_shop':_0x337128,'language':_0x4a4815}),console['log'](alldata);}catch(_0x19581d){console[_0x1e7a90(0x220)](_0x19581d);}}),router['post']('/barcode_scanner',async(_0x15ca96,_0x46f88f)=>{var _0x12f33f=a0_0x25fe79;const {product_code:_0x557576}=_0x15ca96['body'];var _0x5ab37c;const _0x484ce6=await product[_0x12f33f(0x192)]([{'$match':{'primary_code':_0x557576,'product_category':_0x12f33f(0x1d3)}},{'$group':{'_id':_0x12f33f(0x196),'name':{'$first':_0x12f33f(0x1cc)},'category':{'$first':'$category'},'brand':{'$first':_0x12f33f(0x1f1)},'unit':{'$first':_0x12f33f(0x217)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x12f33f(0x22e)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x12f33f(0x189)},'maxStocks':{'$first':_0x12f33f(0x1e1)},'maxProdPerUnit':{'$first':_0x12f33f(0x21f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x12f33f(0x1e3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x55f948=await product[_0x12f33f(0x192)]([{'$match':{'secondary_code':_0x557576}},{'$group':{'_id':'$_id','name':{'$first':_0x12f33f(0x1cc)},'category':{'$first':_0x12f33f(0x1cf)},'brand':{'$first':'$brand'},'unit':{'$first':_0x12f33f(0x217)},'alertquantity':{'$first':_0x12f33f(0x152)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x12f33f(0x1f2)},'secondary_code':{'$first':_0x12f33f(0x189)},'maxStocks':{'$first':_0x12f33f(0x1e1)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x12f33f(0x1e3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x484ce6[_0x12f33f(0x1dd)]>0x0)_0x5ab37c=_0x484ce6;else _0x55f948[_0x12f33f(0x1dd)]>0x0&&(_0x5ab37c=_0x55f948);_0x46f88f[_0x12f33f(0x1f0)](_0x5ab37c);}),router[a0_0x25fe79(0x1c2)](a0_0x25fe79(0x194),async(_0x13996e,_0x38183c)=>{var _0x303250=a0_0x25fe79;const {productCode:_0x2d459e,bay:_0xb6264,warehouses:_0x23e8f0,room:_0x127e0f}=_0x13996e['body'];console[_0x303250(0x220)](_0x13996e[_0x303250(0x1ad)]);try{const _0x7f3ed=await warehouse[_0x303250(0x192)]([{'$match':{'name':_0x23e8f0,'room':_0x127e0f}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0xb6264)}},{'$group':{'_id':_0x303250(0x1d0),'name':{'$first':_0x303250(0x18e)},'product_stock':{'$first':_0x303250(0x176)},'bay':{'$first':_0x303250(0x174)},'maxProducts':{'$first':_0x303250(0x1c5)}}}]);_0x38183c[_0x303250(0x167)](0xc8)[_0x303250(0x1f0)](_0x7f3ed);}catch(_0x2c0bc2){_0x38183c[_0x303250(0x167)](0x194)[_0x303250(0x1f0)]({'message':_0x2c0bc2[_0x303250(0x22b)]});}}),module[a0_0x25fe79(0x233)]=router;function a0_0x350b(_0x41411e,_0x9e749f){var _0x4faae0=a0_0x4faa();return a0_0x350b=function(_0x350b04,_0x1a431a){_0x350b04=_0x350b04-0x149;var _0x5e46c7=_0x4faae0[_0x350b04];return _0x5e46c7;},a0_0x350b(_0x41411e,_0x9e749f);}function a0_0x4faa(){var _0x5e45b8=['product_cat','createTransport','</h5>','status','room_name','$product_details.type','getDate','$product.type','</div>','user_id','product_code_hide','5178880ZJraHs','warehouse','$product_details.storage','product','master','$product_details.bay','/../public','$product_details.product_stock','logo','product_date','site_title','product_stock','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product.bin','Chinese','/view/return_purchase/:id','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product.room_name','English','$product_details.primary_code','German','purchase\x20data\x20update\x20successfully','role','password','POnumber','$secondary_code','redirect','$product_details.floorlevel','<h5>','FGSEmail','$product_details.product_name','/all_purchases_finished/view','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','aggregate','stocks','/CheckingWarehouse','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$_id','prod_name','slice','product_name','$warehouse_name','maxperunit','secondary_unit','<tbody\x20style=\x22text-align:\x20center;\x22>','/view/add_purchases','prod_Qty','render','/barcode/:id','$product','Router','success','$date','_id','prod_qty','gmail','suppliers','params','concat','prod_cat','body','/view/add_purchases/:id','Arabic\x20(ae)','</table>','note','Purchase\x20Mail','edit_purchases_finished_view','RoomAssign','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','\x20<>\x20','</head><body>','Enabled','$product.bay','warehouse_name','Enclosed','string','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','production_date','Arabic','post','product_details','bay','$product_details.maxProducts','$due_amount','</thead>','prod_code','</tbody>','add_purchases_finished','../models/all_models','$name','prod_level','abs','$category','$product_details._id','secondary_code','81Pqowyo','Finished\x20Goods','purchase_invoice','language','flash','ejs','</td>','$return_data','$product.quantity','\x20Order\x20Number\x20:\x20','name','length','product_code','return_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$maxStocks','709460DqHwzF','$secondary_unit','103510DzgGFM','errors','11493xFpGBr','filter','$product_details','prod_secondunit','currency','Rack\x202','<strong>\x20Regards\x20</strong>','padStart','</tr>','email','json','$brand','$primary_code','floor','sendMail','49GkDJQt','/preview/:id','Ambient','quantity','max_product_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.rack','suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','MaxStocks_data','5106276TLoVha','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','table\x20page','primary_code','Rack\x201','staff','forEach','get','edit_purchases_finished','room','$note','secondary_code_hide','<hr\x20class=\x22my-3\x22>','paid_amount','due_amount','findById','DRY\x20GOODS','$invoice','$room','320219UUkKSn','payment\x20successfull','\x20</h2>','<!DOCTYPE\x20html>','$unit','$suppliers','standard_unit','prod_primunit','return_data','Hindi','<span\x20style=\x22float:\x20right;\x22>','invoice','$maxProdPerUnit','log','findOne','$product.floorlevel','/give_payment/:id','all_purchases_barcode','/view','10APZnoV','$batch_code','level','Return\x20Goods','nodemailer','message','Email\x20sent\x20successfully','True','$product_code','$suppliers_docs','FROZEN\x20GOODS','save','batch_code','exports','getMonth','host','<div>','/view/:id','expiry_date','1320ovxeac','express','<h2>\x20','user','error','\x20Order\x20Date\x20:\x20','purchase\x20data\x20add\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$expiry_date','<h5\x20style=\x22text-align:\x20left;\x22>','stock_quantity','Logo.png','getFullYear','French','$paid_amount','map','English\x20(US)','purchases\x20item\x20return\x20successfull','all','INCF-','<html><head><title></title>','</body></html>','222568yQFfwY','all_purchases_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$alertquantity','Portuguese\x20(BR)','then','catch','1112yuUMID','find','Portuguese','/upload/','return_product','currency_placement','image','port','</span>','return_purchase_finished','purchase_quantity','Error\x20Occurs','prod_unit','maxStocks'];a0_0x4faa=function(){return _0x5e45b8;};return a0_0x4faa();}