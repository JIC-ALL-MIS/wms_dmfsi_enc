var a0_0x315f87=a0_0x55a3;(function(_0x3a903b,_0x47a0dd){var _0x2a97ba=a0_0x55a3,_0x3a8e3a=_0x3a903b();while(!![]){try{var _0xac9ad9=-parseInt(_0x2a97ba(0x125))/0x1+parseInt(_0x2a97ba(0xf1))/0x2*(-parseInt(_0x2a97ba(0x106))/0x3)+parseInt(_0x2a97ba(0x112))/0x4+-parseInt(_0x2a97ba(0xe7))/0x5*(-parseInt(_0x2a97ba(0x130))/0x6)+parseInt(_0x2a97ba(0x1a9))/0x7*(-parseInt(_0x2a97ba(0xdb))/0x8)+parseInt(_0x2a97ba(0x15d))/0x9+parseInt(_0x2a97ba(0x1b0))/0xa;if(_0xac9ad9===_0x47a0dd)break;else _0x3a8e3a['push'](_0x3a8e3a['shift']());}catch(_0x150c18){_0x3a8e3a['push'](_0x3a8e3a['shift']());}}}(a0_0x1083,0x513a8));const express=require(a0_0x315f87(0x166)),app=express(),router=express[a0_0x315f87(0x15b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x315f87(0x167)),auth=require(a0_0x315f87(0x164)),nodemailer=require(a0_0x315f87(0x1a3));function a0_0x55a3(_0x3c5898,_0x2ae712){var _0x10831b=a0_0x1083();return a0_0x55a3=function(_0x55a32b,_0x4bb6de){_0x55a32b=_0x55a32b-0xc1;var _0x42322d=_0x10831b[_0x55a32b];return _0x42322d;},a0_0x55a3(_0x3c5898,_0x2ae712);}var ejs=require(a0_0x315f87(0x19c));const path=require(a0_0x315f87(0x10d)),users=require(a0_0x315f87(0x151));router[a0_0x315f87(0xcd)](a0_0x315f87(0x189),auth,async(_0x409026,_0x5a4405)=>{var _0x127d03=a0_0x315f87;try{const {username:_0x144a4c,email:_0x14d73f,role:_0x34e0f8}=_0x409026[_0x127d03(0x185)],_0x5144e8=_0x409026[_0x127d03(0x185)],_0x257e0e=await profile[_0x127d03(0x1a0)]({'email':_0x5144e8['email']}),_0x2c34e9=await staff[_0x127d03(0x1a0)]({'email':_0x5144e8[_0x127d03(0x103)]});if(_0x5144e8[_0x127d03(0x1a6)]==_0x127d03(0x1b7)){const _0x359496=await staff[_0x127d03(0x1a0)]({'email':_0x5144e8[_0x127d03(0x103)]});}const _0x5d974a=await master_shop[_0x127d03(0x109)]();let _0x1e6c77;if(_0x5144e8[_0x127d03(0x1a6)]==_0x127d03(0x1b7)){const _0x371b0f=await staff[_0x127d03(0x1a0)]({'email':_0x5144e8[_0x127d03(0x103)]});_0x1e6c77=await purchases_finished[_0x127d03(0xd4)]([{'$match':{'warehouse_name':_0x371b0f[_0x127d03(0x173)]}},{'$lookup':{'from':_0x127d03(0x100),'localField':_0x127d03(0x100),'foreignField':_0x127d03(0x19f),'as':_0x127d03(0x1b6)}},{'$unwind':_0x127d03(0xe5)},{'$unwind':_0x127d03(0x17a)},{'$group':{'_id':_0x127d03(0x158),'invoice':{'$first':_0x127d03(0x18f)},'suppliers':{'$first':_0x127d03(0x142)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x127d03(0x159)},'product':{'$push':_0x127d03(0x17a)},'note':{'$first':_0x127d03(0x148)},'paid_amount':{'$first':_0x127d03(0x1ae)},'due_amount':{'$first':_0x127d03(0x18d)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x127d03(0x101)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x127d03(0xe5)},'total_product_quantity':{'$sum':_0x127d03(0x12b)},'level':{'$addToSet':_0x127d03(0x1a8)},'isle':{'$addToSet':_0x127d03(0x11f)},'type':{'$addToSet':_0x127d03(0x14d)},'floorlevel':{'$addToSet':_0x127d03(0xcf)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1e6c77=await purchases_finished[_0x127d03(0xd4)]([{'$unwind':_0x127d03(0x17a)},{'$group':{'_id':_0x127d03(0x158),'invoice':{'$first':_0x127d03(0x18f)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x127d03(0x181)},'warehouse_name':{'$first':_0x127d03(0x140)},'room':{'$addToSet':_0x127d03(0x187)},'product':{'$push':'$product'},'note':{'$first':_0x127d03(0x148)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x127d03(0x18d)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x127d03(0x101)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x127d03(0xe5)},'total_product_quantity':{'$sum':_0x127d03(0x12b)},'level':{'$addToSet':_0x127d03(0x1a8)},'isle':{'$addToSet':_0x127d03(0x11f)},'type':{'$addToSet':_0x127d03(0x14d)},'floorlevel':{'$addToSet':_0x127d03(0xcf)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x5d974a[0x0][_0x127d03(0x124)]==_0x127d03(0xf6))var _0xad098=users[_0x127d03(0x15a)];else{if(_0x5d974a[0x0]['language']==_0x127d03(0x16c))var _0xad098=users[_0x127d03(0x16c)];else{if(_0x5d974a[0x0][_0x127d03(0x124)]=='German')var _0xad098=users[_0x127d03(0xe6)];else{if(_0x5d974a[0x0][_0x127d03(0x124)]==_0x127d03(0x190))var _0xad098=users[_0x127d03(0x190)];else{if(_0x5d974a[0x0][_0x127d03(0x124)]=='French')var _0xad098=users[_0x127d03(0x18a)];else{if(_0x5d974a[0x0]['language']==_0x127d03(0x160))var _0xad098=users[_0x127d03(0x102)];else{if(_0x5d974a[0x0][_0x127d03(0x124)]=='Chinese')var _0xad098=users[_0x127d03(0x16e)];else{if(_0x5d974a[0x0][_0x127d03(0x124)]=='Arabic\x20(ae)')var _0xad098=users[_0x127d03(0x1aa)];}}}}}}}_0x5a4405[_0x127d03(0xfb)](_0x127d03(0xed),{'success':_0x409026[_0x127d03(0x135)](_0x127d03(0x195)),'errors':_0x409026[_0x127d03(0x135)](_0x127d03(0x15c)),'purchases':_0x1e6c77,'role':_0x5144e8,'profile':_0x257e0e,'master_shop':_0x5d974a,'language':_0xad098});}catch(_0x28c34a){console[_0x127d03(0xf9)]('table\x20page',_0x28c34a),_0x5a4405[_0x127d03(0x163)](0xc8)[_0x127d03(0x1a5)]({'message':_0x28c34a['message']});}});function BayBinSelected(_0xd2b73,_0x5767f2){var _0x32a048=a0_0x315f87,_0x14bfaf=[],_0x2d497a=[];if(_0xd2b73==_0x32a048(0x12c)){switch(_0x5767f2){case _0x32a048(0xe0):_0x14bfaf=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x32a048(0x144):_0x14bfaf=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2d497a=['DG'];}else{if(_0xd2b73=='FROZEN\x20GOODS'){switch(_0x5767f2){case'Rack\x201':_0x14bfaf=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x14bfaf=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2d497a=['FG'];}}return{'levels':_0x14bfaf,'identify':_0x2d497a};}function a0_0x1083(){var _0x6a78d1=['Portuguese','email','</head><body>','paid_amount','573myfWbT','findById','secondary_code','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<h2>\x20','expiry_date','path','maxStocks','</div>','prod_name','Enabled','1743232eMueit','forEach','stocks','<span\x20style=\x22float:\x20right;\x22>','stock_quantity','\x20Order\x20Date\x20:\x20','getMonth','\x20Order\x20Number\x20:\x20','map','/all_purchases_finished/view','_id','<html><head><title></title>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product.bin','post','$brand','stock_data','prod_primunit','language','556445PtzxJg','secondary_code_hide','Arabic\x20(ae)','product_name','<div>','product_date','$product.quantity','DRY\x20GOODS','edit_purchases_finished_view','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','image','24nWwJzW','INCF-','error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</body></html>','flash','redirect','slice','add_purchases_finished','FGSEmail','batch_code','port','/invoice/:id','then','currency','back','$warehouse_name','return_qty','$suppliers','sendMail','Rack\x202','$product_details.storage','/all_purchases/view','Finished\x20Goods','$note','bay','RoomAssign','Logo.png','warehouse_name','$product.type','logo','prod_level','primary_code_hide','../public/language/languages.json','updateOne','secondary_unit','purchase_invoice','product_code_hide','prod_secondunit','level','$_id','$room','English','Router','errors','4897143DHAuje','product_code','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Portuguese\x20(BR)','True','return_data','status','../middleware/auth','length','express','../models/all_models','prod_cat','prod_Qty','standard_unit','$primary_code','Hindi','/../public','Chinese','save','\x20<>\x20','padStart','$product_details.rack','warehouse','Error\x20occurred\x20while\x20processing\x20product:','Email\x20sent\x20successfully','body','Ambient','site_title','$category','$product','</span>','params','/view/add_purchases/:id','$secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$unit','$date','Paid\x20For\x20Purchase','$maxStocks','message','user','MaxStocks_data','$product.room_name','</tr>','/view','French','$product_code','string','$due_amount','$product_details._id','$invoice','Spanish','product_cat','</table>','<tr>','catch','success','$product_details.maxProducts','$name','getDate','QA\x20Warehouse','$product_details.product_name','<hr\x20class=\x22my-3\x22>','ejs','prod_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','name','findOne','/view/return_purchase/:id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','nodemailer','amount','json','role','createTransport','$product.bay','26425llpouq','Arabic','floor','</h5>','<h5\x20style=\x22text-align:\x20left;\x22>','$paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','6458820HssIKM','$secondary_code','primary_code','filter','return_purchase_finished','$product_details.product_code','suppliers_docs','staff','getFullYear','$product_details.product_stock','date','\x20</h2>','random','quantity','user_id','</tbody>','$product_details.secondary_code','/view/:id','/give_payment/:id','An\x20error\x20occurred\x20while\x20saving\x20data.','Error\x20Occurs','production_date','get','$maxProdPerUnit','$product.floorlevel','$product_details.floorlevel','$alertquantity','room','/barcode_scanner','aggregate','invoice','product_details','<tbody\x20style=\x22text-align:\x20center;\x22>','note','concat','<strong>\x20Regards\x20</strong>','984YXGQiN','prod_unit','Purchase\x20Return\x20Mail','/barcode/:id','prod_qty','Rack\x201','purchase\x20data\x20add\x20successfully','$product_details.bay','Room_name','/upload/','$suppliers_docs','German','43730BgiyBZ','room_name','product','purchase_quantity','</thead>','purchases\x20item\x20return\x20successfull','all_purchases_finished','all_purchases_barcode','gmail','product_stock','3218jSoNPc','return_product','$product_details','</td>','prod_invoice','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','due_amount','log','abs','render','<h5>','password','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','payment\x20successfull','suppliers','$batch_code'];a0_0x1083=function(){return _0x6a78d1;};return a0_0x1083();}async function getRandom8DigitNumber(){var _0x48dea0=a0_0x315f87;const _0x1f77da=0x989680,_0x420b92=0x5f5e0ff,_0x5772d8=Math[_0x48dea0(0x1ab)](Math[_0x48dea0(0xc3)]()*(_0x420b92-_0x1f77da+0x1))+_0x1f77da;var _0x1e2599;const _0x5f2ff2=await purchases_finished[_0x48dea0(0x1a0)]({'invoice':_0x48dea0(0x131)+_0x5772d8});return _0x5f2ff2&&_0x5f2ff2[_0x48dea0(0x165)]>0x0?_0x1e2599=_0x48dea0(0x131)+_0x5772d8:_0x1e2599=_0x48dea0(0x131)+_0x5772d8,_0x1e2599;}router[a0_0x315f87(0xcd)]('/view/add_purchases',auth,async(_0x4ae77a,_0x4dfacd)=>{var _0x28ccac=a0_0x315f87;try{const {username:_0x2584b4,email:_0x5d522b,role:_0x4e432e}=_0x4ae77a['user'],_0x2209bc=_0x4ae77a[_0x28ccac(0x185)],_0x48fdd3=await profile[_0x28ccac(0x1a0)]({'email':_0x2209bc['email']}),_0x20976f=await master_shop[_0x28ccac(0x109)](),_0x494bf0=await staff['findOne']({'email':_0x2209bc[_0x28ccac(0x103)]}),_0x23985a=await suppliers[_0x28ccac(0x109)]({});let _0x3c9933;if(_0x2209bc['role']=='staff'){const _0x1ead22=await staff[_0x28ccac(0x1a0)]({'email':_0x2209bc['email']});_0x3c9933=await warehouse[_0x28ccac(0xd4)]([{'$match':{'status':_0x28ccac(0x111),'name':_0x1ead22[_0x28ccac(0x173)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x28ccac(0x197),'name':{'$first':'$name'}}}]);}else _0x3c9933=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x28ccac(0x147),'name':{'$ne':_0x28ccac(0x199)}}},{'$group':{'_id':'$name','name':{'$first':_0x28ccac(0x197)}}}]);const _0x5cdb3d=await product[_0x28ccac(0x109)]({}),_0x3f8d8c=await warehouse['find']({'status':_0x28ccac(0x111)}),_0x2582d1=await purchases_finished['find']({}),_0x15d512=_0x2582d1['length']+0x1,_0x367147='INCF-'+_0x15d512['toString']()[_0x28ccac(0x171)](0x5,'0');var _0x497e57=[_0x28ccac(0x177),'Enclosed'];if(_0x20976f[0x0]['language']==_0x28ccac(0xf6))var _0x419ca9=users[_0x28ccac(0x15a)];else{if(_0x20976f[0x0][_0x28ccac(0x124)]==_0x28ccac(0x16c))var _0x419ca9=users[_0x28ccac(0x16c)];else{if(_0x20976f[0x0][_0x28ccac(0x124)]==_0x28ccac(0xe6))var _0x419ca9=users[_0x28ccac(0xe6)];else{if(_0x20976f[0x0][_0x28ccac(0x124)]==_0x28ccac(0x190))var _0x419ca9=users[_0x28ccac(0x190)];else{if(_0x20976f[0x0]['language']==_0x28ccac(0x18a))var _0x419ca9=users[_0x28ccac(0x18a)];else{if(_0x20976f[0x0][_0x28ccac(0x124)]==_0x28ccac(0x160))var _0x419ca9=users['Portuguese'];else{if(_0x20976f[0x0][_0x28ccac(0x124)]==_0x28ccac(0x16e))var _0x419ca9=users[_0x28ccac(0x16e)];else{if(_0x20976f[0x0][_0x28ccac(0x124)]=='Arabic\x20(ae)')var _0x419ca9=users[_0x28ccac(0x1aa)];}}}}}}}const _0x2fc629=getRandom8DigitNumber();_0x2fc629[_0x28ccac(0x13d)](_0x287f4e=>{var _0x3731a5=_0x28ccac;_0x4dfacd[_0x3731a5(0xfb)](_0x3731a5(0x138),{'success':_0x4ae77a[_0x3731a5(0x135)](_0x3731a5(0x195)),'errors':_0x4ae77a['flash'](_0x3731a5(0x15c)),'role':_0x2209bc,'profile':_0x48fdd3,'suppliers':_0x23985a,'warehouse':_0x3c9933,'product':_0x5cdb3d,'invoice':_0x287f4e,'master_shop':_0x20976f,'language':_0x419ca9,'find_data':_0x3f8d8c,'rooms_data':_0x497e57});})[_0x28ccac(0x194)](_0x5ae7a2=>{var _0x23402e=_0x28ccac;_0x4ae77a[_0x23402e(0x135)](_0x23402e(0x15c),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x4dfacd['redirect'](_0x23402e(0x11b));});}catch(_0x5586f7){console[_0x28ccac(0xf9)](_0x5586f7);}}),router['get'](a0_0x315f87(0x17d),auth,async(_0x3dd603,_0x5d29e8)=>{var _0x1eea89=a0_0x315f87;try{const _0x1b9a82=_0x3dd603[_0x1eea89(0x17c)]['id'];console[_0x1eea89(0xf9)](_0x1b9a82);const _0x31855b=await master_shop['find']();console[_0x1eea89(0xf9)]('master',_0x31855b);const _0x2d954e=await product[_0x1eea89(0x1a0)]({'name':_0x1b9a82});console[_0x1eea89(0xf9)](_0x1eea89(0xe9),_0x2d954e),_0x5d29e8[_0x1eea89(0x163)](0xc8)[_0x1eea89(0x1a5)]({'product_data':_0x2d954e,'master':_0x31855b});}catch(_0x2d9e87){console[_0x1eea89(0xf9)]('add_purchases\x20error',_0x2d9e87);}}),router[a0_0x315f87(0x120)]('/view/add_purchases',auth,async(_0x545967,_0x27f961)=>{var _0x436139=a0_0x315f87;try{const {invoice:_0x10d0cd,date:_0x3c383a,warehouse_name:_0xd66907,prod_name:_0x12b989,prod_code:_0xc67ef3,prod_qty:_0x19ff8d,prod_unit:_0x4b7890,prod_secondunit:_0x3c0fd0,prod_level:_0x20f3e7,prod_isle:_0xac4eb1,prod_pallet:_0x5bddc2,note:_0x1e3aff,expiry_date:_0xf1a68d,batch_code:_0x4752f6,payable:_0xb412e3,due_amount:_0x11549b,Room_name:_0x2b5ef1,primary_code:_0x1eaeb7,secondary_code:_0x1de723,MaxStocks_data:_0x4fd345,PO_number:_0x16d97c,SCRN:_0x1286f9,JO_number:_0x174eb8}=_0x545967[_0x436139(0x176)];if(typeof _0x12b989==_0x436139(0x18c))var _0x4e32a1=[_0x545967[_0x436139(0x176)]['prod_name']],_0x364dcd=[_0x545967[_0x436139(0x176)][_0x436139(0x19d)]],_0x3e4ba2=[_0x545967[_0x436139(0x176)][_0x436139(0x169)]],_0x5d3760=[_0x545967['body'][_0x436139(0x123)]],_0x4532d9=[_0x545967['body'][_0x436139(0x156)]],_0x14428c=[_0x545967[_0x436139(0x176)]['prod_level']],_0x118d6d=[_0x545967[_0x436139(0x176)][_0x436139(0x1b2)]],_0x14f5f2=[_0x545967[_0x436139(0x176)][_0x436139(0x108)]],_0x47b37c=[_0x545967[_0x436139(0x176)][_0x436139(0x186)]],_0x4e53b2=[_0x545967[_0x436139(0x176)][_0x436139(0x13a)]],_0x32a54b=[_0x545967[_0x436139(0x176)]['expiry_date']],_0x112048=[_0x545967[_0x436139(0x176)]['product_date']],_0x219d58=[_0x545967[_0x436139(0x176)]['max_product_unit']],_0x1b68f6=[_0x545967[_0x436139(0x176)][_0x436139(0x168)]],_0x23609e=[_0x545967[_0x436139(0x176)]['RoomAssign']],_0x5e0671=[_0x545967[_0x436139(0x176)][_0x436139(0xf5)]];else var _0x4e32a1=[..._0x545967[_0x436139(0x176)][_0x436139(0x110)]],_0x364dcd=[..._0x545967[_0x436139(0x176)][_0x436139(0x19d)]],_0x3e4ba2=[..._0x545967[_0x436139(0x176)][_0x436139(0x169)]],_0x5d3760=[..._0x545967[_0x436139(0x176)][_0x436139(0x123)]],_0x4532d9=[..._0x545967[_0x436139(0x176)][_0x436139(0x156)]],_0x14428c=[..._0x545967['body'][_0x436139(0x14f)]],_0x118d6d=[..._0x545967[_0x436139(0x176)][_0x436139(0x1b2)]],_0x14f5f2=[..._0x545967[_0x436139(0x176)][_0x436139(0x108)]],_0x47b37c=[..._0x545967['body'][_0x436139(0x186)]],_0x4e53b2=[..._0x545967['body']['batch_code']],_0x32a54b=[..._0x545967[_0x436139(0x176)][_0x436139(0x10c)]],_0x112048=[..._0x545967['body'][_0x436139(0x12a)]],_0x219d58=[..._0x545967['body']['max_product_unit']],_0x1b68f6=[..._0x545967[_0x436139(0x176)][_0x436139(0x168)]],_0x23609e=[..._0x545967[_0x436139(0x176)][_0x436139(0x14a)]],_0x5e0671=[..._0x545967[_0x436139(0x176)][_0x436139(0xf5)]];const _0x3d97bd=_0x4e32a1[_0x436139(0x11a)](_0x329a97=>{return _0x329a97={'product_name':_0x329a97};});_0x364dcd[_0x436139(0x113)]((_0x4bf7ee,_0x101070)=>{var _0x518cf1=_0x436139;_0x3d97bd[_0x101070][_0x518cf1(0x15e)]=_0x4bf7ee;}),_0x3e4ba2['forEach']((_0x512527,_0x2317d1)=>{var _0x5cfeba=_0x436139;_0x3d97bd[_0x2317d1][_0x5cfeba(0xc4)]=Math[_0x5cfeba(0xfa)](_0x512527);}),_0x5d3760[_0x436139(0x113)]((_0x3f2f39,_0x12c4ff)=>{var _0x17b5cf=_0x436139;_0x3d97bd[_0x12c4ff][_0x17b5cf(0x16a)]=_0x3f2f39;}),_0x4532d9[_0x436139(0x113)]((_0x681cf7,_0x34d321)=>{var _0x2dada6=_0x436139;_0x3d97bd[_0x34d321][_0x2dada6(0x153)]=_0x681cf7;}),_0x14428c['forEach']((_0x47ebd9,_0x3ecb9f)=>{var _0xfe4cde=_0x436139;_0x3d97bd[_0x3ecb9f][_0xfe4cde(0x149)]=_0x47ebd9;}),_0x118d6d['forEach']((_0x56c549,_0x149c2a)=>{_0x3d97bd[_0x149c2a]['primary_code']=_0x56c549;}),_0x14f5f2[_0x436139(0x113)]((_0x4d0da8,_0x1835e1)=>{var _0x4ca88a=_0x436139;_0x3d97bd[_0x1835e1][_0x4ca88a(0x108)]=_0x4d0da8;}),_0x47b37c[_0x436139(0x113)]((_0x310892,_0x587c7a)=>{var _0x3879fc=_0x436139;_0x3d97bd[_0x587c7a][_0x3879fc(0x10e)]=_0x310892;}),_0x4e53b2[_0x436139(0x113)]((_0x18b865,_0x1395f5)=>{var _0x1da9c4=_0x436139;_0x3d97bd[_0x1395f5][_0x1da9c4(0x13a)]=_0x18b865;}),_0x32a54b[_0x436139(0x113)]((_0x34f074,_0xe40df7)=>{var _0x79ccc6=_0x436139;_0x3d97bd[_0xe40df7][_0x79ccc6(0x10c)]=_0x34f074;}),_0x112048[_0x436139(0x113)]((_0x1b0a90,_0x6ecf83)=>{var _0x35e7e3=_0x436139;_0x3d97bd[_0x6ecf83][_0x35e7e3(0xcc)]=_0x1b0a90;}),_0x219d58[_0x436139(0x113)]((_0x57784b,_0x2fccfe)=>{_0x3d97bd[_0x2fccfe]['maxperunit']=_0x57784b;}),_0x1b68f6['forEach']((_0x2c3dc3,_0x107218)=>{var _0x59b6b8=_0x436139;_0x3d97bd[_0x107218][_0x59b6b8(0x191)]=_0x2c3dc3;}),_0x23609e[_0x436139(0x113)]((_0x521d08,_0x4f050a)=>{var _0x33e322=_0x436139;_0x3d97bd[_0x4f050a][_0x33e322(0xe8)]=_0x521d08;}),_0x5e0671[_0x436139(0x113)]((_0x1e45ba,_0x3814a5)=>{_0x3d97bd[_0x3814a5]['invoice']=_0x1e45ba;});const _0x169b3e=_0x3d97bd['filter'](_0x3d5689=>_0x3d5689['quantity']!=='0'&&_0x3d5689['quantity']!==''),_0x3a44e0=new purchases_finished({'invoice':_0x10d0cd,'suppliers':_0x545967['body'][_0x436139(0x100)],'date':_0x3c383a,'warehouse_name':_0xd66907,'product':_0x169b3e,'note':_0x1e3aff,'due_amount':_0x11549b,'room':_0x2b5ef1,'POnumber':_0x16d97c,'SCRN':_0x1286f9,'JO_number':_0x174eb8}),_0x194a8b=await _0x3a44e0[_0x436139(0x16f)](),_0xe2a13=await purchases_finished[_0x436139(0x1a0)]({'invoice':_0x10d0cd}),_0xf67d32=_0xe2a13[_0x436139(0xe9)][_0x436139(0x11a)](async _0x338653=>{var _0x3a73da=_0x436139;try{var _0x1e0ebf=await warehouse[_0x3a73da(0x1a0)]({'name':_0xd66907,'room':_0x338653['room_name']}),_0x257f6b=0x0;const _0x2e86ec=_0x1e0ebf[_0x3a73da(0xd6)][_0x3a73da(0x11a)](_0x1b364d=>{var _0x5c728e=_0x3a73da;console[_0x5c728e(0xf9)](_0x1b364d[_0x5c728e(0x128)]+'=='+_0x338653[_0x5c728e(0x128)]+'&&'+_0x1b364d[_0x5c728e(0x149)]+'=='+_0x338653[_0x5c728e(0x149)]+'&&'+_0x1b364d[_0x5c728e(0x10c)]+'=='+_0x338653['expiry_date']+'&&'+_0x1b364d['production_date']+'=='+_0x338653[_0x5c728e(0xcc)]+'&&'+_0x1b364d['batch_code']+'=='+_0x338653[_0x5c728e(0x13a)]+'&&'+_0x1b364d[_0x5c728e(0xd5)]+'=='+_0xe2a13[_0x5c728e(0xd5)]),_0x1b364d[_0x5c728e(0x128)]==_0x338653['product_name']&&_0x1b364d[_0x5c728e(0x149)]==_0x338653[_0x5c728e(0x149)]&&_0x1b364d[_0x5c728e(0x10c)]==_0x338653[_0x5c728e(0x10c)]&&_0x1b364d[_0x5c728e(0xcc)]==_0x338653[_0x5c728e(0xcc)]&&_0x1b364d['batch_code']==_0x338653['batch_code']&&_0x1b364d[_0x5c728e(0xd5)]==_0xe2a13[_0x5c728e(0xd5)]&&(_0x1b364d[_0x5c728e(0xf0)]=Math['abs'](_0x1b364d[_0x5c728e(0xf0)])+Math[_0x5c728e(0xfa)](_0x338653[_0x5c728e(0xc4)]),_0x257f6b++);});return _0x257f6b==0x0&&(_0x1e0ebf[_0x3a73da(0xd6)]=_0x1e0ebf[_0x3a73da(0xd6)][_0x3a73da(0xd9)]({'product_name':_0x338653['product_name'],'product_stock':Math[_0x3a73da(0xfa)](_0x338653[_0x3a73da(0xc4)]),'primary_code':_0x338653[_0x3a73da(0x1b2)],'secondary_code':_0x338653[_0x3a73da(0x108)],'product_code':_0x338653[_0x3a73da(0x15e)],'bay':_0x338653[_0x3a73da(0x149)],'maxProducts':_0x338653[_0x3a73da(0x10e)],'unit':_0x338653[_0x3a73da(0x16a)],'secondary_unit':_0x338653[_0x3a73da(0x153)],'expiry_date':_0x338653[_0x3a73da(0x10c)],'production_date':_0x338653['production_date'],'maxProducts':_0x338653['maxStocks'],'maxPerUnit':_0x338653['maxperunit'],'batch_code':_0x338653[_0x3a73da(0x13a)],'product_cat':_0x338653[_0x3a73da(0x191)],'invoice':_0x338653[_0x3a73da(0xd5)],'id_incoming':_0x338653[_0x3a73da(0x11c)]})),_0x1e0ebf;}catch(_0x2e901c){return console['error'](_0x3a73da(0x174),_0x2e901c),null;}});Promise['all'](_0xf67d32)[_0x436139(0x13d)](async _0x5c351a=>{var _0x20e883=_0x436139;try{for(const _0x59f75e of _0x5c351a){await warehouse[_0x20e883(0x152)]({'_id':_0x59f75e['_id']},{'$addToSet':{'product_details':{'$each':_0x59f75e[_0x20e883(0xd6)]}}});}const _0x11ab1f=await master_shop[_0x20e883(0x109)](),_0x20e63d=await email_settings[_0x20e883(0x1a0)](),_0x1a062d=await supervisor_settings[_0x20e883(0x109)]();var _0x1ad839=_0xe2a13[_0x20e883(0xe9)],_0x2e408b='',_0x2c6ce9;for(_0x2c6ce9 in _0x1ad839){var _0x32423c='FG';_0xe2a13[_0x20e883(0x14c)]==_0x20e883(0x12c)&&(_0x32423c='DG'),_0x2e408b+=_0x20e883(0x193)+_0x20e883(0xfe)+_0x1ad839[_0x2c6ce9][_0x20e883(0x128)]+_0x20e883(0xf4)+_0x20e883(0xfe)+_0x1ad839[_0x2c6ce9][_0x20e883(0x15e)]+_0x20e883(0xf4)+_0x20e883(0xfe)+_0x1ad839[_0x2c6ce9][_0x20e883(0xc4)]+_0x20e883(0xf4)+_0x20e883(0xfe)+_0x1ad839[_0x2c6ce9]['standard_unit']+'</td>'+_0x20e883(0xfe)+_0x1ad839[_0x2c6ce9][_0x20e883(0x153)]+'</td>'+_0x20e883(0xfe)+_0xe2a13[_0x20e883(0x14c)]+_0x20e883(0xf4)+_0x20e883(0xfe)+_0x1ad839[_0x2c6ce9]['room_name']+_0x20e883(0xf4)+_0x20e883(0xfe)+_0x32423c+_0x1ad839[_0x2c6ce9]['bay']+_0x20e883(0xf4),_0x20e883(0x188);}let _0x5a9802=nodemailer[_0x20e883(0x1a7)]({'host':_0x20e63d['host'],'port':Number(_0x20e63d[_0x20e883(0x13b)]),'secure':![],'auth':{'user':_0x20e63d['email'],'pass':_0x20e63d[_0x20e883(0xfd)]}}),_0x41fedc={'from':_0x20e63d[_0x20e883(0x103)],'to':_0x1a062d[0x0][_0x20e883(0x139)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x20e883(0x14b),'path':__dirname+_0x20e883(0x16d)+_0x20e883(0xe4)+_0x11ab1f[0x0][_0x20e883(0x12f)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x20e883(0x104)+_0x20e883(0x129)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x20e883(0x129)+_0x20e883(0x1a2)+_0x20e883(0x10f)+_0x20e883(0x129)+_0x20e883(0x10b)+_0x11ab1f[0x0][_0x20e883(0x178)]+_0x20e883(0xc2)+_0x20e883(0x10f)+_0x20e883(0x10f)+_0x20e883(0x19b)+_0x20e883(0x129)+_0x20e883(0x1ad)+_0x20e883(0x119)+_0xe2a13[_0x20e883(0xd5)]+'\x20'+_0x20e883(0x115)+_0x20e883(0x117)+_0xe2a13[_0x20e883(0xc1)]+'\x20'+'</span>'+_0x20e883(0x1ac)+_0x20e883(0x10f)+_0x20e883(0x15f)+_0x20e883(0x19e)+_0x20e883(0x193)+_0x20e883(0xf7)+_0x20e883(0x10a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x20e883(0x133)+_0x20e883(0x1af)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x20e883(0x11e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x20e883(0x188)+_0x20e883(0xeb)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2e408b+'\x20'+_0x20e883(0xc6)+_0x20e883(0x192)+_0x20e883(0x129)+_0x20e883(0xda)+_0x20e883(0xfc)+_0x11ab1f[0x0][_0x20e883(0x178)]+'</h5>'+_0x20e883(0x10f)+_0x20e883(0x10f)+'</body></html>'};_0x5a9802[_0x20e883(0x143)](_0x41fedc,function(_0x5492fe,_0x4166ab){var _0x11ff30=_0x20e883;_0x5492fe?(console[_0x11ff30(0xf9)](_0x5492fe),console['log'](_0x11ff30(0xcb))):console[_0x11ff30(0xf9)](_0x11ff30(0x175));});}catch(_0x4b8a53){console[_0x20e883(0x132)](_0x4b8a53),_0x27f961['status'](0x1f4)[_0x20e883(0x1a5)]({'error':_0x20e883(0xca),'message':_0x4b8a53['message']});}})[_0x436139(0x194)](_0x51246f=>{console['error'](_0x51246f);}),_0x545967[_0x436139(0x135)](_0x436139(0x195),_0x436139(0xe1)),_0x27f961['redirect'](_0x436139(0x11b));}catch(_0x4ad6d9){console[_0x436139(0xf9)](_0x4ad6d9);}}),router[a0_0x315f87(0xcd)]('/preview/:id',auth,async(_0x380522,_0x2cc70f)=>{var _0x3cf1ed=a0_0x315f87;try{const {username:_0x5b9fd1,email:_0xfe8189,role:_0x4634cc}=_0x380522[_0x3cf1ed(0x185)],_0x33b768=_0x380522[_0x3cf1ed(0x185)],_0x3416e5=await profile[_0x3cf1ed(0x1a0)]({'email':_0x33b768[_0x3cf1ed(0x103)]}),_0x150668=await master_shop[_0x3cf1ed(0x109)](),_0x97fa1c=_0x380522[_0x3cf1ed(0x17c)]['id'],_0x497fa9=await purchases_finished['findById'](_0x97fa1c),_0x12a2dc=await suppliers[_0x3cf1ed(0x109)]({});let _0xe2d04f;if(_0x33b768[_0x3cf1ed(0x1a6)]==_0x3cf1ed(0x1b7)){const _0x263b4e=await staff[_0x3cf1ed(0x1a0)]({'email':_0x33b768[_0x3cf1ed(0x103)]});_0xe2d04f=await warehouse[_0x3cf1ed(0x109)]({'status':_0x3cf1ed(0x111),'name':_0x263b4e[_0x3cf1ed(0x173)],'warehouse_category':_0x3cf1ed(0x147)});}else _0xe2d04f=await warehouse['aggregate']([{'$match':{'status':_0x3cf1ed(0x111),'warehouse_category':_0x3cf1ed(0x147)}},{'$group':{'_id':_0x3cf1ed(0x197),'name':{'$first':_0x3cf1ed(0x197)}}}]);const _0x146781=await product[_0x3cf1ed(0x109)]({}),_0x577d26=BayBinSelected(_0x497fa9[_0x3cf1ed(0x14c)],_0x497fa9['room']);let _0xe8451f=new Date(_0x497fa9[_0x3cf1ed(0x10c)]),_0x1af1c0=('0'+_0xe8451f[_0x3cf1ed(0x198)]())[_0x3cf1ed(0x137)](-0x2),_0x125e7d=('0'+(_0xe8451f[_0x3cf1ed(0x118)]()+0x1))[_0x3cf1ed(0x137)](-0x2),_0x44695a=_0xe8451f[_0x3cf1ed(0x1b8)](),_0x2cdb49=_0x44695a+'-'+_0x125e7d+'-'+_0x1af1c0;if(_0x150668[0x0][_0x3cf1ed(0x124)]==_0x3cf1ed(0xf6)){var _0x2b59e0=users[_0x3cf1ed(0x15a)];console[_0x3cf1ed(0xf9)](_0x2b59e0);}else{if(_0x150668[0x0]['language']==_0x3cf1ed(0x16c))var _0x2b59e0=users[_0x3cf1ed(0x16c)];else{if(_0x150668[0x0][_0x3cf1ed(0x124)]==_0x3cf1ed(0xe6))var _0x2b59e0=users[_0x3cf1ed(0xe6)];else{if(_0x150668[0x0]['language']=='Spanish')var _0x2b59e0=users[_0x3cf1ed(0x190)];else{if(_0x150668[0x0][_0x3cf1ed(0x124)]==_0x3cf1ed(0x18a))var _0x2b59e0=users[_0x3cf1ed(0x18a)];else{if(_0x150668[0x0][_0x3cf1ed(0x124)]==_0x3cf1ed(0x160))var _0x2b59e0=users[_0x3cf1ed(0x102)];else{if(_0x150668[0x0][_0x3cf1ed(0x124)]=='Chinese')var _0x2b59e0=users['Chinese'];else{if(_0x150668[0x0]['language']==_0x3cf1ed(0x127))var _0x2b59e0=users[_0x3cf1ed(0x1aa)];}}}}}}}_0x2cc70f['render'](_0x3cf1ed(0x12d),{'success':_0x380522[_0x3cf1ed(0x135)]('success'),'errors':_0x380522[_0x3cf1ed(0x135)](_0x3cf1ed(0x15c)),'role':_0x33b768,'profile':_0x3416e5,'purchases':_0x497fa9,'suppliers':_0x12a2dc,'warehouse':_0xe2d04f,'product':_0x146781,'master_shop':_0x150668,'language':_0x2b59e0,'ed_fullDate':_0x2cdb49,'dataSelected':_0x577d26});}catch(_0x4c983e){console[_0x3cf1ed(0xf9)](_0x4c983e);}}),router[a0_0x315f87(0xcd)](a0_0x315f87(0xc8),auth,async(_0x33ed21,_0x2cb424)=>{var _0x54944a=a0_0x315f87;try{const {username:_0x3cb7a6,email:_0x3b3944,role:_0x2cb7f1}=_0x33ed21[_0x54944a(0x185)],_0x40526b=_0x33ed21[_0x54944a(0x185)],_0x5b7142=await profile[_0x54944a(0x1a0)]({'email':_0x40526b[_0x54944a(0x103)]}),_0x816e8b=await master_shop[_0x54944a(0x109)](),_0x182d02=_0x33ed21[_0x54944a(0x17c)]['id'],_0x58407a=await purchases_finished[_0x54944a(0x107)](_0x182d02),_0x55c3db=await suppliers[_0x54944a(0x109)]({});let _0x218622;if(_0x40526b[_0x54944a(0x1a6)]=='staff'){const _0xf8b7e6=await staff[_0x54944a(0x1a0)]({'email':_0x40526b[_0x54944a(0x103)]});_0x218622=await warehouse[_0x54944a(0x109)]({'status':_0x54944a(0x111),'name':_0xf8b7e6['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x218622=await warehouse[_0x54944a(0xd4)]([{'$match':{'status':_0x54944a(0x111),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x54944a(0x197),'name':{'$first':'$name'}}}]);const _0x532cbf=await product[_0x54944a(0x109)]({}),_0x6527fc=BayBinSelected(_0x58407a['warehouse_name'],_0x58407a[_0x54944a(0xd2)]);let _0x52c361=new Date(_0x58407a[_0x54944a(0x10c)]),_0x7f65cf=('0'+_0x52c361['getDate']())['slice'](-0x2),_0x4834b7=('0'+(_0x52c361[_0x54944a(0x118)]()+0x1))[_0x54944a(0x137)](-0x2),_0x1b8d16=_0x52c361['getFullYear'](),_0x484619=_0x1b8d16+'-'+_0x4834b7+'-'+_0x7f65cf;if(_0x816e8b[0x0]['language']=='English\x20(US)'){var _0x48b2e4=users[_0x54944a(0x15a)];console[_0x54944a(0xf9)](_0x48b2e4);}else{if(_0x816e8b[0x0][_0x54944a(0x124)]=='Hindi')var _0x48b2e4=users['Hindi'];else{if(_0x816e8b[0x0]['language']=='German')var _0x48b2e4=users['German'];else{if(_0x816e8b[0x0][_0x54944a(0x124)]==_0x54944a(0x190))var _0x48b2e4=users[_0x54944a(0x190)];else{if(_0x816e8b[0x0][_0x54944a(0x124)]==_0x54944a(0x18a))var _0x48b2e4=users['French'];else{if(_0x816e8b[0x0]['language']==_0x54944a(0x160))var _0x48b2e4=users[_0x54944a(0x102)];else{if(_0x816e8b[0x0][_0x54944a(0x124)]=='Chinese')var _0x48b2e4=users['Chinese'];else{if(_0x816e8b[0x0][_0x54944a(0x124)]==_0x54944a(0x127))var _0x48b2e4=users[_0x54944a(0x1aa)];}}}}}}}_0x2cb424[_0x54944a(0xfb)]('edit_purchases_finished',{'success':_0x33ed21['flash']('success'),'errors':_0x33ed21[_0x54944a(0x135)](_0x54944a(0x15c)),'role':_0x40526b,'profile':_0x5b7142,'purchases':_0x58407a,'suppliers':_0x55c3db,'warehouse':_0x218622,'product':_0x532cbf,'master_shop':_0x816e8b,'language':_0x48b2e4,'ed_fullDate':_0x484619,'dataSelected':_0x6527fc});}catch(_0x1301f3){console['log'](_0x1301f3);}}),router[a0_0x315f87(0x120)](a0_0x315f87(0xc8),auth,async(_0x362fa5,_0x1964ad)=>{var _0x43e5ba=a0_0x315f87;try{const _0x3b2606=_0x362fa5['params']['id'],_0x24132a=await purchases_finished[_0x43e5ba(0x1a0)]({'_id':_0x362fa5['params']['id']}),_0x115435=await warehouse[_0x43e5ba(0x1a0)]({'name':_0x24132a[_0x43e5ba(0x14c)],'room':_0x24132a[_0x43e5ba(0xd2)]});_0x24132a[_0x43e5ba(0xe9)][_0x43e5ba(0x113)](_0x97828a=>{var _0x274052=_0x43e5ba;const _0x55766c=_0x115435[_0x274052(0xd6)][_0x274052(0x11a)](_0x2d8fe3=>{var _0x4dc2be=_0x274052;_0x2d8fe3[_0x4dc2be(0x128)]==_0x97828a[_0x4dc2be(0x128)]&&_0x2d8fe3[_0x4dc2be(0x149)]==_0x97828a[_0x4dc2be(0x149)]&&(_0x2d8fe3[_0x4dc2be(0xf0)]=parseInt(_0x2d8fe3[_0x4dc2be(0xf0)])-parseInt(_0x97828a[_0x4dc2be(0xc4)]));});}),await _0x115435[_0x43e5ba(0x16f)]();const {invoice:_0x1eff69,suppliers:_0x1001ec,date:_0x2d6b71,warehouse_name:_0x4fca38,prod_name:_0xd3ac65,prod_code:_0x2af0a4,prod_qty:_0x2d44dd,prod_unit:_0x1d7cca,prod_secondunit:_0x536af2,prod_level:_0x46cdc6,prod_isle:_0x59b356,prod_pallet:_0x5aff1a,note:_0x162e6d,expiry_date:_0x578fe1,batch_code:_0x7c2dc,paid_amount:_0x15c329,due_amount:_0x418985,Room_name:_0x2a60f4,primary_code:_0xe0b5ab,secondary_code:_0x49f50c,PO_number:_0x4dcec9,JO_number:_0x345b7e}=_0x362fa5[_0x43e5ba(0x176)];if(typeof _0xd3ac65=='string')var _0x4b6169=[_0x362fa5['body'][_0x43e5ba(0x110)]],_0x276450=[_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x19d)]],_0x111cd2=[_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0xdf)]],_0x13a0e3=[_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0xdc)]],_0x32dda2=[_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x156)]],_0x437cc4=[_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x14f)]],_0x110999=[_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x1b2)]],_0x4f979d=[_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x108)]],_0x32e399=[_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x186)]],_0x49d945=[_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x13a)]],_0x5d4817=[_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x10c)]];else var _0x4b6169=[..._0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x110)]],_0x276450=[..._0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x19d)]],_0x111cd2=[..._0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0xdf)]],_0x13a0e3=[..._0x362fa5[_0x43e5ba(0x176)]['prod_unit']],_0x32dda2=[..._0x362fa5[_0x43e5ba(0x176)]['prod_secondunit']],_0x437cc4=[..._0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x14f)]],_0x110999=[..._0x362fa5['body'][_0x43e5ba(0x1b2)]],_0x4f979d=[..._0x362fa5['body'][_0x43e5ba(0x108)]],_0x32e399=[..._0x362fa5[_0x43e5ba(0x176)]['MaxStocks_data']],_0x49d945=[..._0x362fa5[_0x43e5ba(0x176)]['batch_code']],_0x5d4817=[..._0x362fa5['body'][_0x43e5ba(0x10c)]];const _0x5067c1=_0x4b6169[_0x43e5ba(0x11a)](_0x3dfbd6=>{return _0x3dfbd6={'product_name':_0x3dfbd6};});_0x276450[_0x43e5ba(0x113)]((_0x4d52fa,_0x1002e8)=>{var _0x2d7326=_0x43e5ba;_0x5067c1[_0x1002e8][_0x2d7326(0x15e)]=_0x4d52fa;}),_0x111cd2[_0x43e5ba(0x113)]((_0x2b7db4,_0x6c7c82)=>{var _0x31e8e9=_0x43e5ba;_0x5067c1[_0x6c7c82][_0x31e8e9(0xc4)]=_0x2b7db4;}),_0x13a0e3[_0x43e5ba(0x113)]((_0x187acf,_0x3aee25)=>{_0x5067c1[_0x3aee25]['standard_unit']=_0x187acf;}),_0x32dda2[_0x43e5ba(0x113)]((_0x46f4f0,_0xa7acee)=>{var _0x1075d9=_0x43e5ba;_0x5067c1[_0xa7acee][_0x1075d9(0x153)]=_0x46f4f0;}),_0x437cc4[_0x43e5ba(0x113)]((_0x7c5014,_0x549c73)=>{_0x5067c1[_0x549c73]['bay']=_0x7c5014;}),_0x110999[_0x43e5ba(0x113)]((_0x1108e2,_0x5cc998)=>{var _0x4fce27=_0x43e5ba;_0x5067c1[_0x5cc998][_0x4fce27(0x1b2)]=_0x1108e2;}),_0x4f979d['forEach']((_0x4f2b75,_0x40a50f)=>{var _0xedd16e=_0x43e5ba;_0x5067c1[_0x40a50f][_0xedd16e(0x108)]=_0x4f2b75;}),_0x32e399[_0x43e5ba(0x113)]((_0xbeda0d,_0xaa0baf)=>{var _0x5e8d14=_0x43e5ba;_0x5067c1[_0xaa0baf][_0x5e8d14(0x10e)]=_0xbeda0d;}),_0x49d945['forEach']((_0x54ee77,_0x981298)=>{var _0x1b46bd=_0x43e5ba;_0x5067c1[_0x981298][_0x1b46bd(0x13a)]=_0x54ee77;}),_0x5d4817[_0x43e5ba(0x113)]((_0x35e0fc,_0x559bb0)=>{var _0x1d25e1=_0x43e5ba;_0x5067c1[_0x559bb0][_0x1d25e1(0x10c)]=_0x35e0fc;});const _0x446a33=_0x5067c1[_0x43e5ba(0x1b3)](_0x1787ae=>_0x1787ae[_0x43e5ba(0xc4)]!=='0'&&_0x1787ae[_0x43e5ba(0xc4)]!=='');_0x24132a['invoice']=_0x1eff69,_0x24132a[_0x43e5ba(0x100)]=_0x1001ec,_0x24132a[_0x43e5ba(0xc1)]=_0x2d6b71,_0x24132a['warehouse_name']=_0x4fca38,_0x24132a['product']=_0x446a33,_0x24132a[_0x43e5ba(0xd8)]=_0x162e6d,_0x24132a[_0x43e5ba(0x105)]=_0x15c329,_0x24132a[_0x43e5ba(0xf8)]=_0x418985,_0x24132a['room']=_0x2a60f4,_0x24132a['POnumber']=_0x4dcec9,_0x24132a['JO_number']=_0x345b7e;const _0x350c38=await _0x24132a[_0x43e5ba(0x16f)](),_0x2fc7fc=await warehouse[_0x43e5ba(0x1a0)]({'name':_0x362fa5['body'][_0x43e5ba(0x14c)],'room':_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0xe3)]});_0x24132a['product'][_0x43e5ba(0x113)](_0xe9f765=>{var _0x285e6c=_0x43e5ba,_0x3673ff=0x0;const _0x2aba3c=_0x2fc7fc['product_details'][_0x285e6c(0x11a)](_0x491fbc=>{var _0x4da099=_0x285e6c;_0x491fbc['product_name']==_0xe9f765['product_name']&&_0x491fbc[_0x4da099(0x149)]==_0xe9f765[_0x4da099(0x149)]&&(_0x491fbc[_0x4da099(0xf0)]=parseInt(_0x491fbc[_0x4da099(0xf0)])+parseInt(_0xe9f765['quantity']),_0x3673ff++);});_0x3673ff=='0'&&(_0x2fc7fc['product_details']=_0x2fc7fc['product_details'][_0x285e6c(0xd9)]({'product_name':_0xe9f765[_0x285e6c(0x128)],'product_stock':_0xe9f765[_0x285e6c(0xc4)],'primary_code':_0xe9f765[_0x285e6c(0x1b2)],'secondary_code':_0xe9f765[_0x285e6c(0x108)],'product_code':_0xe9f765[_0x285e6c(0x15e)],'bay':_0xe9f765[_0x285e6c(0x149)],'maxProducts':_0xe9f765[_0x285e6c(0x10e)],'unit':_0xe9f765[_0x285e6c(0x16a)],'secondary_unit':_0xe9f765[_0x285e6c(0x153)],'expiry_date':_0xe9f765['expiry_date']}));}),await _0x2fc7fc['save']();const _0x52959f=await s_payment_data[_0x43e5ba(0x1a0)]({'invoice':_0x362fa5[_0x43e5ba(0x176)]['invoice']});if(_0x52959f===null){}else console[_0x43e5ba(0xf9)](_0x43e5ba(0x100),_0x52959f,_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0xd5)]),_0x52959f[_0x43e5ba(0x100)]=_0x362fa5[_0x43e5ba(0x176)][_0x43e5ba(0x100)],await _0x52959f[_0x43e5ba(0x16f)]();_0x362fa5[_0x43e5ba(0x135)]('success','purchase\x20data\x20update\x20successfully'),_0x1964ad[_0x43e5ba(0x136)](_0x43e5ba(0x11b));}catch(_0x2d674e){console[_0x43e5ba(0xf9)](_0x2d674e);}}),router[a0_0x315f87(0x120)](a0_0x315f87(0xc9),auth,async(_0x2298fa,_0x17f6b1)=>{var _0x554512=a0_0x315f87;try{const _0x32f48f=_0x2298fa[_0x554512(0x17c)]['id'],{invoice:_0xb8ccbc,suppliers:_0x3793ed,payable:_0x2d1924,due_amount:_0x1fa491}=_0x2298fa[_0x554512(0x176)],_0x5b4a6d=await purchases[_0x554512(0x107)](_0x32f48f);var _0xbaffcd=_0x2d1924-_0x1fa491;_0x5b4a6d['paid_amount']=parseFloat(_0x5b4a6d[_0x554512(0x105)])+parseFloat(_0x1fa491),_0x5b4a6d[_0x554512(0xf8)]=_0xbaffcd;const _0x420575=await _0x5b4a6d[_0x554512(0x16f)]();console[_0x554512(0xf9)](_0x420575);const _0x16042b=await s_payment_data['findOne']({'invoice':_0xb8ccbc});_0x16042b[_0x554512(0x1a4)]=_0xbaffcd,await _0x16042b['save']();let _0x240f7b=new Date(),_0x1903c6=('0'+_0x240f7b['getDate']())[_0x554512(0x137)](-0x2),_0x1fc4ae=('0'+(_0x240f7b[_0x554512(0x118)]()+0x1))['slice'](-0x2),_0x44071a=_0x240f7b['getFullYear'](),_0x4ebf32=_0x44071a+'-'+_0x1fc4ae+'-'+_0x1903c6;const _0x47a845=new suppliers_payment({'invoice':_0xb8ccbc,'date':_0x44071a+'-'+_0x1fc4ae+'-'+_0x1903c6,'suppliers':_0x3793ed,'reason':_0x554512(0x182),'amount':_0x1fa491}),_0x539167=await _0x47a845[_0x554512(0x16f)]();_0x2298fa[_0x554512(0x135)](_0x554512(0x195),_0x554512(0xff)),_0x17f6b1['redirect'](_0x554512(0x146));}catch(_0x4db3af){console[_0x554512(0xf9)](_0x4db3af);}}),router['get'](a0_0x315f87(0x13c),auth,async(_0x5287f4,_0x38f687)=>{var _0x344825=a0_0x315f87;try{const {username:_0x45e530,email:_0x2d0c7d,role:_0x2d81a8}=_0x5287f4[_0x344825(0x185)],_0x245678=_0x5287f4[_0x344825(0x185)],_0x4c2115=await profile[_0x344825(0x1a0)]({'email':_0x245678[_0x344825(0x103)]}),_0x58494f=await master_shop[_0x344825(0x109)]();console[_0x344825(0xf9)]('master',_0x58494f);const _0x2b889f=_0x5287f4[_0x344825(0x17c)]['id'],_0xd885e8=await purchases[_0x344825(0x107)](_0x2b889f);console[_0x344825(0xf9)](_0xd885e8);const _0x1c489d=await suppliers[_0x344825(0x1a0)]({'name':_0xd885e8['suppliers']});console['log'](_0x1c489d);if(_0x58494f[0x0][_0x344825(0x124)]==_0x344825(0xf6)){var _0x52b457=users[_0x344825(0x15a)];console[_0x344825(0xf9)](_0x52b457);}else{if(_0x58494f[0x0][_0x344825(0x124)]==_0x344825(0x16c))var _0x52b457=users[_0x344825(0x16c)];else{if(_0x58494f[0x0][_0x344825(0x124)]==_0x344825(0xe6))var _0x52b457=users[_0x344825(0xe6)];else{if(_0x58494f[0x0][_0x344825(0x124)]=='Spanish')var _0x52b457=users[_0x344825(0x190)];else{if(_0x58494f[0x0][_0x344825(0x124)]=='French')var _0x52b457=users['French'];else{if(_0x58494f[0x0]['language']==_0x344825(0x160))var _0x52b457=users['Portuguese'];else{if(_0x58494f[0x0][_0x344825(0x124)]==_0x344825(0x16e))var _0x52b457=users[_0x344825(0x16e)];else{if(_0x58494f[0x0][_0x344825(0x124)]==_0x344825(0x127))var _0x52b457=users[_0x344825(0x1aa)];}}}}}}}_0x38f687[_0x344825(0xfb)](_0x344825(0x154),{'success':_0x5287f4[_0x344825(0x135)](_0x344825(0x195)),'errors':_0x5287f4[_0x344825(0x135)](_0x344825(0x15c)),'role':_0x245678,'profile':_0x4c2115,'master_shop':_0x58494f,'supplier':_0x1c489d,'purchase':_0xd885e8,'language':_0x52b457});}catch(_0x4259c7){console['log'](_0x4259c7);}}),router[a0_0x315f87(0xcd)]('/view/return_purchase/:id',auth,async(_0xb143bd,_0x22afe4)=>{var _0x148f0f=a0_0x315f87;try{const {username:_0x583430,email:_0x36d964,role:_0x480cdc}=_0xb143bd[_0x148f0f(0x185)],_0x5ded5d=_0xb143bd[_0x148f0f(0x185)],_0x4a09c1=await profile[_0x148f0f(0x1a0)]({'email':_0x5ded5d['email']}),_0x8e2765=await master_shop[_0x148f0f(0x109)]();console[_0x148f0f(0xf9)]('master',_0x8e2765);const _0x364722=_0xb143bd[_0x148f0f(0x17c)]['id'];console[_0x148f0f(0xf9)](_0x364722);const _0x38eabf=await purchases_finished[_0x148f0f(0x107)](_0x364722);console['log'](_0x148f0f(0xc5),_0x38eabf);const _0x15db8f=await product['find']({}),_0x5b98d2=await warehouse[_0x148f0f(0xd4)]([{'$match':{'name':_0x38eabf['warehouse_name'],'room':_0x38eabf['room']}},{'$unwind':_0x148f0f(0xf3)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x148f0f(0x19a)},'product_stock':{'$first':_0x148f0f(0x1b9)},'bay':{'$first':_0x148f0f(0xe2)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x148f0f(0xd0)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x148f0f(0xc7)},'product_code':{'$first':_0x148f0f(0x1b5)},'storage':{'$first':_0x148f0f(0x145)},'rack':{'$first':_0x148f0f(0x172)}}}]);console[_0x148f0f(0xf9)](_0x148f0f(0x122),_0x5b98d2);let _0x191235;if(_0x5ded5d[_0x148f0f(0x1a6)]==_0x148f0f(0x1b7)){const _0xde51c7=await staff['findOne']({'email':_0x5ded5d['email']});_0x191235=await warehouse['find']({'status':_0x148f0f(0x111),'name':_0xde51c7['warehouse'],'warehouse_category':_0x148f0f(0x147),'name':'Return\x20Goods'});}else _0x191235=await warehouse[_0x148f0f(0xd4)]([{'$match':{'status':_0x148f0f(0x111),'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'}},{'$group':{'_id':_0x148f0f(0x197),'name':{'$first':_0x148f0f(0x197)}}}]);if(_0x8e2765[0x0][_0x148f0f(0x124)]=='English\x20(US)'){var _0x1088a0=users['English'];console[_0x148f0f(0xf9)](_0x1088a0);}else{if(_0x8e2765[0x0][_0x148f0f(0x124)]==_0x148f0f(0x16c))var _0x1088a0=users[_0x148f0f(0x16c)];else{if(_0x8e2765[0x0][_0x148f0f(0x124)]=='German')var _0x1088a0=users[_0x148f0f(0xe6)];else{if(_0x8e2765[0x0][_0x148f0f(0x124)]=='Spanish')var _0x1088a0=users[_0x148f0f(0x190)];else{if(_0x8e2765[0x0][_0x148f0f(0x124)]==_0x148f0f(0x18a))var _0x1088a0=users[_0x148f0f(0x18a)];else{if(_0x8e2765[0x0]['language']=='Portuguese\x20(BR)')var _0x1088a0=users[_0x148f0f(0x102)];else{if(_0x8e2765[0x0][_0x148f0f(0x124)]==_0x148f0f(0x16e))var _0x1088a0=users[_0x148f0f(0x16e)];else{if(_0x8e2765[0x0][_0x148f0f(0x124)]==_0x148f0f(0x127))var _0x1088a0=users['Arabic'];}}}}}}}_0x22afe4[_0x148f0f(0xfb)](_0x148f0f(0x1b4),{'success':_0xb143bd['flash']('success'),'errors':_0xb143bd[_0x148f0f(0x135)](_0x148f0f(0x15c)),'role':_0x5ded5d,'profile':_0x4a09c1,'user':_0x38eabf,'stock':_0x5b98d2,'master_shop':_0x8e2765,'product':_0x15db8f,'language':_0x1088a0,'warehouse':_0x191235});}catch(_0x986670){console[_0x148f0f(0xf9)](_0x986670);}}),router[a0_0x315f87(0x120)](a0_0x315f87(0x1a1),auth,async(_0x55281e,_0x1931a5)=>{var _0x5c91ba=a0_0x315f87;try{const {invoice:_0x453e54,date:_0x37d09c,warehouse_name:_0x346fee,Room_name:_0x286e9c,product_name:_0x8275ba,purchase_quantity:_0x919f1,stocks:_0x19e903,return_qty:_0xbb229e,note:_0x16cbdf,level:_0x473463,isle:_0x381d9c,pallet:_0x658624,to_warehouse_name:_0x730902,to_Room_name:_0x242dc8}=_0x55281e[_0x5c91ba(0x176)],_0xae1eee=await purchases_finished[_0x5c91ba(0x1a0)]({'_id':_0x55281e[_0x5c91ba(0x17c)]['id']}),_0x5398b9=await warehouse[_0x5c91ba(0x1a0)]({'name':_0x346fee,'room':_0x286e9c,'warehouse_category':_0x5c91ba(0x147)});if(typeof _0x8275ba=='string')var _0x25ce3f=[_0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0x128)]],_0x21cfe0=[_0x55281e[_0x5c91ba(0x176)]['purchase_quantity']],_0xe3f3be=[_0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0x114)]],_0xc72e0c=[_0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0x141)]],_0x5e74ba=[_0x55281e[_0x5c91ba(0x176)]['level']],_0x1f2dbe=[_0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0x155)]],_0x21df6f=[_0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0x150)]],_0x20ce74=[_0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0x126)]];else var _0x25ce3f=[..._0x55281e['body'][_0x5c91ba(0x128)]],_0x21cfe0=[..._0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0xea)]],_0xe3f3be=[..._0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0x114)]],_0xc72e0c=[..._0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0x141)]],_0x5e74ba=[..._0x55281e['body'][_0x5c91ba(0x157)]],_0x1f2dbe=[..._0x55281e[_0x5c91ba(0x176)]['product_code_hide']],_0x21df6f=[..._0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0x150)]],_0x20ce74=[..._0x55281e[_0x5c91ba(0x176)][_0x5c91ba(0x126)]];const _0x35f576=_0x25ce3f['map'](_0x6069b5=>{return _0x6069b5={'product_name':_0x6069b5};});_0x21cfe0['forEach']((_0x393ec2,_0x7fe189)=>{_0x35f576[_0x7fe189]['purchase_quantity']=_0x393ec2;}),_0xe3f3be['forEach']((_0x20b635,_0x39109e)=>{var _0x419093=_0x5c91ba;_0x35f576[_0x39109e][_0x419093(0x116)]=_0x20b635;}),_0xc72e0c[_0x5c91ba(0x113)]((_0x1ebeb5,_0x4970aa)=>{var _0x4beda0=_0x5c91ba;_0x35f576[_0x4970aa][_0x4beda0(0x141)]=_0x1ebeb5;}),_0x5e74ba[_0x5c91ba(0x113)]((_0x13cc0a,_0x14bf47)=>{var _0x3f0e78=_0x5c91ba;_0x35f576[_0x14bf47][_0x3f0e78(0x149)]=_0x13cc0a;}),_0x1f2dbe[_0x5c91ba(0x113)]((_0x2790f5,_0x10741b)=>{var _0x1096ea=_0x5c91ba;_0x35f576[_0x10741b][_0x1096ea(0x15e)]=_0x2790f5;}),_0x21df6f[_0x5c91ba(0x113)]((_0x4e6490,_0x28bd1b)=>{_0x35f576[_0x28bd1b]['primary_code']=_0x4e6490;}),_0x20ce74[_0x5c91ba(0x113)]((_0x404eea,_0x2c4c2e)=>{var _0x50d93b=_0x5c91ba;_0x35f576[_0x2c4c2e][_0x50d93b(0x108)]=_0x404eea;}),_0x35f576['forEach'](_0x301614=>{var _0x304a6b=_0x5c91ba;console[_0x304a6b(0xf9)](_0x301614);const _0x2881a9=_0x5398b9[_0x304a6b(0xd6)][_0x304a6b(0x11a)](_0x207c79=>{var _0x375399=_0x304a6b;_0x207c79[_0x375399(0x128)]==_0x301614['product_name']&&_0x207c79[_0x375399(0x149)]==_0x301614['bay']&&(console[_0x375399(0xf9)](parseInt(_0x207c79[_0x375399(0xf0)])+_0x375399(0x170)+parseInt(_0x301614['return_qty'])),_0x207c79[_0x375399(0xf0)]=parseInt(_0x207c79['product_stock'])-parseInt(_0x301614[_0x375399(0x141)]));});}),await _0x5398b9['save']();var _0x433104=0x0;_0x35f576[_0x5c91ba(0x113)](_0x173e76=>{var _0x1fcd92=_0x5c91ba;(parseInt(_0x173e76[_0x1fcd92(0xea)])<parseInt(_0x173e76['return_qty'])||parseInt(_0x173e76[_0x1fcd92(0x116)])<parseInt(_0x173e76['return_qty']))&&_0x433104++;});if(_0x433104!=0x0)return _0x55281e[_0x5c91ba(0x135)](_0x5c91ba(0x15c),_0x5c91ba(0x12e)),_0x1931a5[_0x5c91ba(0x136)](_0x5c91ba(0x13f));const _0x34236f=new purchases_return_finished({'invoice':_0x453e54,'suppliers':_0x55281e[_0x5c91ba(0x176)]['suppliers'],'date':_0x37d09c,'warehouse_name':_0x346fee,'return_product':_0x35f576,'note':_0x16cbdf,'room':_0x286e9c,'to_warehouse_name':_0x730902,'to_room':_0x242dc8}),_0x3b7724=await _0x34236f[_0x5c91ba(0x16f)](),_0x5e941c=await purchases_return_finished[_0x5c91ba(0x1a0)]({'invoice':_0x453e54}),_0x5c000d=await warehouse[_0x5c91ba(0x1a0)]({'name':_0x730902,'room':_0x242dc8,'warehouse_category':'Finished\x20Goods'});_0x5e941c[_0x5c91ba(0xf2)][_0x5c91ba(0x113)](_0x27a48c=>{var _0x1ab196=_0x5c91ba,_0x3cb752=0x0;const _0xba2165=_0x5c000d['product_details']['map'](_0x470f4d=>{var _0x577ac7=a0_0x55a3;console[_0x577ac7(0xf9)](_0x470f4d[_0x577ac7(0x128)]+'=='+_0x27a48c['product_name']+'&&'+_0x470f4d[_0x577ac7(0x149)]+'=='+_0x27a48c[_0x577ac7(0x149)]),_0x470f4d['product_name']==_0x27a48c[_0x577ac7(0x128)]&&_0x470f4d[_0x577ac7(0x149)]==_0x27a48c['bay']&&(_0x470f4d[_0x577ac7(0xf0)]=parseInt(_0x470f4d[_0x577ac7(0xf0)])-parseInt(_0x27a48c[_0x577ac7(0x141)]),_0x3cb752++);});_0x3cb752=='0'&&(_0x5c000d[_0x1ab196(0xd6)]=_0x5c000d[_0x1ab196(0xd6)]['concat']({'product_name':_0x27a48c[_0x1ab196(0x128)],'product_stock':_0x27a48c[_0x1ab196(0x141)],'primary_code':_0x27a48c[_0x1ab196(0x1b2)],'secondary_code':_0x27a48c[_0x1ab196(0x108)],'product_code':_0x27a48c['product_code'],'bay':_0x27a48c[_0x1ab196(0x149)],'maxProducts':0xf423f}));}),await _0x5c000d[_0x5c91ba(0x16f)]();const _0x446cd9=await purchases_finished[_0x5c91ba(0x1a0)]({'invoice':_0x453e54});_0x446cd9[_0x5c91ba(0x162)]=_0x5c91ba(0x161);const _0x128f55=await _0x446cd9[_0x5c91ba(0x16f)](),_0x253e3e=new s_payment_data({'invoice':_0x453e54,'suppliers':_0x55281e[_0x5c91ba(0x176)]['suppliers'],'reason':'Purchase\x20Return'});await _0x253e3e[_0x5c91ba(0x16f)]();const _0x188211=await master_shop[_0x5c91ba(0x109)](),_0x50b0e9=await email_settings[_0x5c91ba(0x1a0)](),_0x58489e=await suppliers[_0x5c91ba(0x1a0)]({'name':_0x55281e['body'][_0x5c91ba(0x100)]});_0x188211[0x0]['currency_placement']==0x1?(right_currency=_0x188211[0x0][_0x5c91ba(0x13e)],left_currency=''):(right_currency='',left_currency=_0x188211[0x0]['currency']);var _0x348708=_0x25ce3f,_0x37fe2d=_0xc72e0c,_0x51e23d='',_0x1f8337;for(_0x1f8337 in _0x348708){_0x51e23d+=_0x5c91ba(0x193)+_0x5c91ba(0xfe)+_0x348708[_0x1f8337]+_0x5c91ba(0xf4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x37fe2d[_0x1f8337]+_0x5c91ba(0xf4)+_0x5c91ba(0x188);}let _0x2defec=nodemailer[_0x5c91ba(0x1a7)]({'service':_0x5c91ba(0xef),'auth':{'user':_0x50b0e9[_0x5c91ba(0x103)],'pass':_0x50b0e9[_0x5c91ba(0xfd)]}}),_0x1407c5={'from':_0x50b0e9[_0x5c91ba(0x103)],'to':_0x58489e[_0x5c91ba(0x103)],'subject':_0x5c91ba(0xdd),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x5c91ba(0xe4)+_0x188211[0x0][_0x5c91ba(0x12f)],'cid':_0x5c91ba(0x14e)}],'html':'<!DOCTYPE\x20html>'+_0x5c91ba(0x11d)+_0x5c91ba(0x104)+_0x5c91ba(0x129)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x5c91ba(0x129)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5c91ba(0x10f)+_0x5c91ba(0x129)+'<h2>\x20'+_0x188211[0x0][_0x5c91ba(0x178)]+_0x5c91ba(0xc2)+_0x5c91ba(0x10f)+_0x5c91ba(0x10f)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5c91ba(0x119)+_0x453e54+'\x20'+_0x5c91ba(0x115)+_0x5c91ba(0x117)+_0x37d09c+'\x20'+_0x5c91ba(0x17b)+_0x5c91ba(0x1ac)+_0x5c91ba(0x10f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5c91ba(0x19e)+_0x5c91ba(0x193)+_0x5c91ba(0xf7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x5c91ba(0x17f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+_0x5c91ba(0xd7)+'\x20'+_0x51e23d+'\x20'+_0x5c91ba(0xc6)+'</table>'+_0x5c91ba(0x129)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x188211[0x0][_0x5c91ba(0x178)]+_0x5c91ba(0x1ac)+_0x5c91ba(0x10f)+_0x5c91ba(0x10f)+_0x5c91ba(0x134)};_0x2defec[_0x5c91ba(0x143)](_0x1407c5,function(_0x3f4e40,_0x1e370c){var _0x1eee17=_0x5c91ba;_0x3f4e40?console[_0x1eee17(0xf9)]('Error\x20Occurs'):console[_0x1eee17(0xf9)](_0x1eee17(0x175));}),_0x55281e[_0x5c91ba(0x135)]('success',_0x5c91ba(0xec)),_0x1931a5[_0x5c91ba(0x136)](_0x5c91ba(0x11b));}catch(_0x2521e3){_0x1931a5[_0x5c91ba(0x163)](0xc8)['json']({'message':_0x2521e3[_0x5c91ba(0x184)]});}}),router['get'](a0_0x315f87(0xde),auth,async(_0x17f8d8,_0x2c5aef)=>{var _0x1d059b=a0_0x315f87;try{const {username:_0x22c714,email:_0x13390a,role:_0xb869bc}=_0x17f8d8[_0x1d059b(0x185)],_0x1d5996=_0x17f8d8['user'],_0xc5f181=await profile[_0x1d059b(0x1a0)]({'email':_0x1d5996[_0x1d059b(0x103)]}),_0x1ba1ba=await master_shop[_0x1d059b(0x109)](),_0x5733a7=_0x17f8d8[_0x1d059b(0x17c)]['id'],_0x2f84d6=await purchases_finished[_0x1d059b(0x107)](_0x5733a7);if(_0x1ba1ba[0x0][_0x1d059b(0x124)]==_0x1d059b(0xf6))var _0x3f590d=users[_0x1d059b(0x15a)];else{if(_0x1ba1ba[0x0]['language']=='Hindi')var _0x3f590d=users[_0x1d059b(0x16c)];else{if(_0x1ba1ba[0x0][_0x1d059b(0x124)]==_0x1d059b(0xe6))var _0x3f590d=users[_0x1d059b(0xe6)];else{if(_0x1ba1ba[0x0][_0x1d059b(0x124)]==_0x1d059b(0x190))var _0x3f590d=users['Spanish'];else{if(_0x1ba1ba[0x0][_0x1d059b(0x124)]==_0x1d059b(0x18a))var _0x3f590d=users[_0x1d059b(0x18a)];else{if(_0x1ba1ba[0x0]['language']==_0x1d059b(0x160))var _0x3f590d=users[_0x1d059b(0x102)];else{if(_0x1ba1ba[0x0][_0x1d059b(0x124)]==_0x1d059b(0x16e))var _0x3f590d=users[_0x1d059b(0x16e)];else{if(_0x1ba1ba[0x0][_0x1d059b(0x124)]=='Arabic\x20(ae)')var _0x3f590d=users[_0x1d059b(0x1aa)];}}}}}}}_0x2c5aef[_0x1d059b(0xfb)](_0x1d059b(0xee),{'success':_0x17f8d8[_0x1d059b(0x135)](_0x1d059b(0x195)),'errors':_0x17f8d8[_0x1d059b(0x135)]('errors'),'role':_0x1d5996,'profile':_0xc5f181,'alldata':_0x2f84d6,'master_shop':_0x1ba1ba,'language':_0x3f590d}),console['log'](alldata);}catch(_0x1348f4){console[_0x1d059b(0xf9)](_0x1348f4);}}),router[a0_0x315f87(0x120)](a0_0x315f87(0xd3),async(_0xd9c734,_0x251344)=>{var _0x5eb0ad=a0_0x315f87;const {product_code:_0x1b3d2d}=_0xd9c734[_0x5eb0ad(0x176)];var _0x9b5373;const _0x3bcbcd=await product[_0x5eb0ad(0xd4)]([{'$match':{'primary_code':_0x1b3d2d,'product_category':_0x5eb0ad(0x147)}},{'$group':{'_id':_0x5eb0ad(0x158),'name':{'$first':_0x5eb0ad(0x197)},'category':{'$first':_0x5eb0ad(0x179)},'brand':{'$first':_0x5eb0ad(0x121)},'unit':{'$first':_0x5eb0ad(0x180)},'alertquantity':{'$first':_0x5eb0ad(0xd1)},'product_code':{'$first':_0x5eb0ad(0x18b)},'primary_code':{'$first':_0x5eb0ad(0x16b)},'secondary_code':{'$first':_0x5eb0ad(0x1b1)},'maxStocks':{'$first':_0x5eb0ad(0x183)},'maxProdPerUnit':{'$first':_0x5eb0ad(0xce)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5eb0ad(0x17e)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x38bbae=await product[_0x5eb0ad(0xd4)]([{'$match':{'secondary_code':_0x1b3d2d}},{'$group':{'_id':_0x5eb0ad(0x158),'name':{'$first':_0x5eb0ad(0x197)},'category':{'$first':_0x5eb0ad(0x179)},'brand':{'$first':_0x5eb0ad(0x121)},'unit':{'$first':_0x5eb0ad(0x180)},'alertquantity':{'$first':_0x5eb0ad(0xd1)},'product_code':{'$first':_0x5eb0ad(0x18b)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x5eb0ad(0x1b1)},'maxStocks':{'$first':_0x5eb0ad(0x183)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3bcbcd[_0x5eb0ad(0x165)]>0x0)_0x9b5373=_0x3bcbcd;else _0x38bbae[_0x5eb0ad(0x165)]>0x0&&(_0x9b5373=_0x38bbae);_0x251344[_0x5eb0ad(0x1a5)](_0x9b5373);}),router[a0_0x315f87(0x120)]('/CheckingWarehouse',async(_0x5e4dd8,_0x29d6a6)=>{var _0xb3a947=a0_0x315f87;const {productCode:_0x215af5,bay:_0x16b221,warehouses:_0x4db85c,room:_0x4ba0c1}=_0x5e4dd8['body'];console[_0xb3a947(0xf9)](_0x5e4dd8[_0xb3a947(0x176)]);try{const _0x184131=await warehouse[_0xb3a947(0xd4)]([{'$match':{'name':_0x4db85c,'room':_0x4ba0c1}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x16b221)}},{'$group':{'_id':_0xb3a947(0x18e),'name':{'$first':_0xb3a947(0x19a)},'product_stock':{'$first':_0xb3a947(0x1b9)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0xb3a947(0x196)}}}]);_0x29d6a6[_0xb3a947(0x163)](0xc8)[_0xb3a947(0x1a5)](_0x184131);}catch(_0x53f0d2){_0x29d6a6[_0xb3a947(0x163)](0x194)[_0xb3a947(0x1a5)]({'message':_0x53f0d2['message']});}}),module['exports']=router;