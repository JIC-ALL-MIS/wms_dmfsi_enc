function a0_0x29be(){var _0x3b0759=['$product_details.bin','purchase_invoice','email','slice','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$invoice','$product_details.product_name','nodemailer','$note','room_name','<hr\x20class=\x22my-3\x22>','\x20Order\x20Number\x20:\x20','$product_details.type','maxStocks','warehouse','table\x20page','product_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','product_stock','edit_purchases_finished','purchase_quantity','$product_details.rack','purchase\x20data\x20add\x20successfully','English\x20(US)','</tr>','$name','<tr>','27kfACuv','Purchase\x20Return\x20Mail','$maxStocks','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.primary_code','prod_Qty','749gKdqou','get','Email\x20sent\x20successfully','image','language','invoice','</div>','<h2>\x20','$brand','$product_details.storage','<tbody\x20style=\x22text-align:\x20center;\x22>','date','/all_purchases/view','primary_code','prod_code','/invoice/:id','user_id','18296cLHwWB','INCF-','padStart','165855nMnzuZ','$product.type','errors','</td>','$warehouse_name','Paid\x20For\x20Purchase','/../public','user','string','then','prod_name','logo','forEach','<h5\x20style=\x22text-align:\x20left;\x22>','Portuguese','$product_details.product_stock','maxperunit','amount','DRY\x20GOODS','secondary_code','quantity','product_date','add_purchases\x20error','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Enabled','/give_payment/:id','$batch_code','error','master','$maxProdPerUnit','Rack\x201','$product.bin','/CheckingWarehouse','</thead>','$_id','/view/:id','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$secondary_code','JO_number','Arabic\x20(ae)','return_product','$product_details.bay','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','redirect','$product.floorlevel','/view/add_purchases/:id','currency','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$due_amount','Finished\x20Goods','all','due_amount','/upload/','getMonth','True','prod_unit','warehouse_name','\x20</h2>','$product_details.secondary_code','POnumber','all_purchases_barcode','</head><body>','</body></html>','MaxStocks_data','return_qty','\x20Order\x20Date\x20:\x20','$product_code','../models/all_models','$primary_code','$date','$unit','German','flash','<strong>\x20Regards\x20</strong>','Logo.png','random','batch_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','max_product_unit','currency_placement','</span>','FGSEmail','createTransport','Purchase\x20Mail','stocks','toString','<html><head><title></title>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','concat','Arabic','exports','stock_quantity','host','product_name','771492gTafrf','password','suppliers','$paid_amount','prod_qty','bay','status','success','log','Return\x20Goods','$product','purchase\x20data\x20update\x20successfully','287988XKbtXB','<!DOCTYPE\x20html>','standard_unit','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','paid_amount','Chinese','getFullYear','save','<h5>','Hindi','floor','staff','<span\x20style=\x22float:\x20right;\x22>','$alertquantity','message','json','</table>','payment\x20successfull','name','suppliers_docs','$product.quantity','$product.room_name','site_title','$expiry_date','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','updateOne','$product.bay','path','room','Enclosed','$product_details._id','return_purchase_finished','aggregate','back','product_code','add_purchases_finished','filter','Spanish','$suppliers_docs','product_cat','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','primary_code_hide','findById','render','RoomAssign','/all_purchases_finished/view','760MpmTQh','secondary_unit','getDate','prod_primunit','params','44970sYPruD','</tbody>','French','Purchase\x20Return','product','product_details','/view/return_purchase/:id','Rack\x202','post','<div>','22636180kBHLeZ','Portuguese\x20(BR)','English','346616QoArZx','prod_secondunit','prod_level','/view/add_purchases','body','$category','edit_purchases_finished_view','$product_details','sendMail','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','port','map','findOne','secondary_code_hide','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','length','$return_data','$secondary_unit','role','production_date'];a0_0x29be=function(){return _0x3b0759;};return a0_0x29be();}var a0_0x3afcee=a0_0x892d;(function(_0x165179,_0x292904){var _0x2c4e3c=a0_0x892d,_0xfeaf09=_0x165179();while(!![]){try{var _0x317adc=-parseInt(_0x2c4e3c(0x112))/0x1+-parseInt(_0x2c4e3c(0x171))/0x2+parseInt(_0x2c4e3c(0x17d))/0x3+-parseInt(_0x2c4e3c(0x10f))/0x4*(parseInt(_0x2c4e3c(0xb2))/0x5)+parseInt(_0x2c4e3c(0xb7))/0x6*(-parseInt(_0x2c4e3c(0xfe))/0x7)+parseInt(_0x2c4e3c(0xc4))/0x8*(parseInt(_0x2c4e3c(0xf7))/0x9)+parseInt(_0x2c4e3c(0xc1))/0xa;if(_0x317adc===_0x292904)break;else _0xfeaf09['push'](_0xfeaf09['shift']());}catch(_0x274617){_0xfeaf09['push'](_0xfeaf09['shift']());}}}(a0_0x29be,0x6b9cd));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x3afcee(0x156)),auth=require('../middleware/auth'),nodemailer=require(a0_0x3afcee(0xe3));var ejs=require('ejs');const path=require(a0_0x3afcee(0x9e)),users=require('../public/language/languages.json');router[a0_0x3afcee(0xff)]('/view',auth,async(_0x9a2e1b,_0x12217e)=>{var _0x53bae6=a0_0x3afcee;try{const {username:_0x49ecf9,email:_0x57da54,role:_0x4fd101}=_0x9a2e1b[_0x53bae6(0x119)],_0x2b8779=_0x9a2e1b[_0x53bae6(0x119)],_0x5c1a73=await profile[_0x53bae6(0xd2)]({'email':_0x2b8779[_0x53bae6(0xdd)]}),_0x40ef64=await staff[_0x53bae6(0xd2)]({'email':_0x2b8779['email']});if(_0x2b8779[_0x53bae6(0xd9)]==_0x53bae6(0x8e)){const _0x5a9354=await staff[_0x53bae6(0xd2)]({'email':_0x2b8779[_0x53bae6(0xdd)]});}const _0xc25cf0=await master_shop[_0x53bae6(0xd4)]();let _0x25f747;if(_0x2b8779[_0x53bae6(0xd9)]==_0x53bae6(0x8e)){const _0x168cfe=await staff[_0x53bae6(0xd2)]({'email':_0x2b8779[_0x53bae6(0xdd)]});_0x25f747=await purchases_finished[_0x53bae6(0xa3)]([{'$match':{'warehouse_name':_0x168cfe[_0x53bae6(0xea)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x53bae6(0x95),'as':_0x53bae6(0x96)}},{'$unwind':_0x53bae6(0xa9)},{'$unwind':_0x53bae6(0x17b)},{'$group':{'_id':_0x53bae6(0x134),'invoice':{'$first':_0x53bae6(0xe1)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x53bae6(0x158)},'warehouse_name':{'$first':_0x53bae6(0x116)},'room':{'$first':'$room'},'product':{'$push':_0x53bae6(0x17b)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x53bae6(0x174)},'due_amount':{'$first':_0x53bae6(0x143)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x53bae6(0x12c)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x53bae6(0xa9)},'total_product_quantity':{'$sum':_0x53bae6(0x97)},'level':{'$addToSet':_0x53bae6(0x9d)},'isle':{'$addToSet':_0x53bae6(0x131)},'type':{'$addToSet':_0x53bae6(0x113)},'floorlevel':{'$addToSet':_0x53bae6(0x13f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x25f747=await purchases_finished[_0x53bae6(0xa3)]([{'$unwind':_0x53bae6(0x17b)},{'$group':{'_id':_0x53bae6(0x134),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x53bae6(0x116)},'room':{'$addToSet':_0x53bae6(0x98)},'product':{'$push':'$product'},'note':{'$first':_0x53bae6(0xe4)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x53bae6(0x143)},'return_data':{'$first':_0x53bae6(0xd7)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x53bae6(0x9a)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x53bae6(0x97)},'level':{'$addToSet':_0x53bae6(0x9d)},'isle':{'$addToSet':_0x53bae6(0x131)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x53bae6(0x13f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xc25cf0[0x0]['language']==_0x53bae6(0xf3))var _0x37c1b1=users['English'];else{if(_0xc25cf0[0x0][_0x53bae6(0x102)]==_0x53bae6(0x8c))var _0x37c1b1=users['Hindi'];else{if(_0xc25cf0[0x0][_0x53bae6(0x102)]==_0x53bae6(0x15a))var _0x37c1b1=users['German'];else{if(_0xc25cf0[0x0][_0x53bae6(0x102)]==_0x53bae6(0xa8))var _0x37c1b1=users[_0x53bae6(0xa8)];else{if(_0xc25cf0[0x0][_0x53bae6(0x102)]=='French')var _0x37c1b1=users['French'];else{if(_0xc25cf0[0x0]['language']==_0x53bae6(0xc2))var _0x37c1b1=users[_0x53bae6(0x120)];else{if(_0xc25cf0[0x0][_0x53bae6(0x102)]=='Chinese')var _0x37c1b1=users[_0x53bae6(0x183)];else{if(_0xc25cf0[0x0][_0x53bae6(0x102)]==_0x53bae6(0x13a))var _0x37c1b1=users[_0x53bae6(0x16c)];}}}}}}}_0x12217e[_0x53bae6(0xaf)]('all_purchases_finished',{'success':_0x9a2e1b['flash'](_0x53bae6(0x178)),'errors':_0x9a2e1b[_0x53bae6(0x15b)](_0x53bae6(0x114)),'purchases':_0x25f747,'role':_0x2b8779,'profile':_0x5c1a73,'master_shop':_0xc25cf0,'language':_0x37c1b1});}catch(_0x305c1f){console[_0x53bae6(0x179)](_0x53bae6(0xeb),_0x305c1f),_0x12217e['status'](0xc8)[_0x53bae6(0x92)]({'message':_0x305c1f[_0x53bae6(0x91)]});}});function BayBinSelected(_0x165466,_0x44a459){var _0x5f3cec=a0_0x3afcee,_0x3f1af6=[],_0x1770c2=[];if(_0x165466==_0x5f3cec(0x124)){switch(_0x44a459){case _0x5f3cec(0x130):_0x3f1af6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x5f3cec(0xbe):_0x3f1af6=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1770c2=['DG'];}else{if(_0x165466=='FROZEN\x20GOODS'){switch(_0x44a459){case'Rack\x201':_0x3f1af6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x5f3cec(0xbe):_0x3f1af6=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1770c2=['FG'];}}return{'levels':_0x3f1af6,'identify':_0x1770c2};}function a0_0x892d(_0x42938d,_0x53c69b){var _0x29beed=a0_0x29be();return a0_0x892d=function(_0x892d61,_0x854e23){_0x892d61=_0x892d61-0x8b;var _0x2150f5=_0x29beed[_0x892d61];return _0x2150f5;},a0_0x892d(_0x42938d,_0x53c69b);}async function getRandom8DigitNumber(){var _0xdbbbb0=a0_0x3afcee;const _0x55e5a5=0x989680,_0x5adc33=0x5f5e0ff,_0x5d3c78=Math[_0xdbbbb0(0x8d)](Math[_0xdbbbb0(0x15e)]()*(_0x5adc33-_0x55e5a5+0x1))+_0x55e5a5;var _0x1395ed;const _0x679f1d=await purchases_finished[_0xdbbbb0(0xd2)]({'invoice':'INCF-'+_0x5d3c78});return _0x679f1d&&_0x679f1d[_0xdbbbb0(0xd6)]>0x0?_0x1395ed=_0xdbbbb0(0x110)+_0x5d3c78:_0x1395ed=_0xdbbbb0(0x110)+_0x5d3c78,_0x1395ed;}router[a0_0x3afcee(0xff)](a0_0x3afcee(0xc7),auth,async(_0xeacf0a,_0x43fae9)=>{var _0x21f78a=a0_0x3afcee;try{const {username:_0x4f0171,email:_0x22bd6e,role:_0x4f7886}=_0xeacf0a[_0x21f78a(0x119)],_0x4f2287=_0xeacf0a[_0x21f78a(0x119)],_0x56e784=await profile[_0x21f78a(0xd2)]({'email':_0x4f2287[_0x21f78a(0xdd)]}),_0x52f29c=await master_shop[_0x21f78a(0xd4)](),_0x350774=await staff[_0x21f78a(0xd2)]({'email':_0x4f2287[_0x21f78a(0xdd)]}),_0x44d3c7=await suppliers['find']({});let _0x2418aa;if(_0x4f2287['role']=='staff'){const _0xef60ab=await staff[_0x21f78a(0xd2)]({'email':_0x4f2287[_0x21f78a(0xdd)]});_0x2418aa=await warehouse[_0x21f78a(0xa3)]([{'$match':{'status':_0x21f78a(0x12a),'name':_0xef60ab[_0x21f78a(0xea)],'warehouse_category':_0x21f78a(0x144)}},{'$group':{'_id':'$name','name':{'$first':_0x21f78a(0xf5)}}}]);}else _0x2418aa=await warehouse[_0x21f78a(0xa3)]([{'$match':{'status':_0x21f78a(0x12a),'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x21f78a(0xf5),'name':{'$first':_0x21f78a(0xf5)}}}]);const _0x2a5b2d=await product[_0x21f78a(0xd4)]({}),_0x1a7d33=await warehouse[_0x21f78a(0xd4)]({'status':'Enabled'}),_0x2715b3=await purchases_finished[_0x21f78a(0xd4)]({}),_0xda0c1b=_0x2715b3[_0x21f78a(0xd6)]+0x1,_0x482527='INCF-'+_0xda0c1b[_0x21f78a(0x168)]()[_0x21f78a(0x111)](0x5,'0');var _0x1adde9=['Ambient',_0x21f78a(0xa0)];if(_0x52f29c[0x0][_0x21f78a(0x102)]==_0x21f78a(0xf3))var _0x479a14=users[_0x21f78a(0xc3)];else{if(_0x52f29c[0x0][_0x21f78a(0x102)]==_0x21f78a(0x8c))var _0x479a14=users['Hindi'];else{if(_0x52f29c[0x0]['language']==_0x21f78a(0x15a))var _0x479a14=users[_0x21f78a(0x15a)];else{if(_0x52f29c[0x0][_0x21f78a(0x102)]==_0x21f78a(0xa8))var _0x479a14=users[_0x21f78a(0xa8)];else{if(_0x52f29c[0x0][_0x21f78a(0x102)]==_0x21f78a(0xb9))var _0x479a14=users[_0x21f78a(0xb9)];else{if(_0x52f29c[0x0]['language']=='Portuguese\x20(BR)')var _0x479a14=users[_0x21f78a(0x120)];else{if(_0x52f29c[0x0]['language']==_0x21f78a(0x183))var _0x479a14=users[_0x21f78a(0x183)];else{if(_0x52f29c[0x0][_0x21f78a(0x102)]==_0x21f78a(0x13a))var _0x479a14=users[_0x21f78a(0x16c)];}}}}}}}const _0x54e67f=getRandom8DigitNumber();_0x54e67f[_0x21f78a(0x11b)](_0x1cf01c=>{var _0x3722cc=_0x21f78a;_0x43fae9[_0x3722cc(0xaf)](_0x3722cc(0xa6),{'success':_0xeacf0a[_0x3722cc(0x15b)](_0x3722cc(0x178)),'errors':_0xeacf0a['flash']('errors'),'role':_0x4f2287,'profile':_0x56e784,'suppliers':_0x44d3c7,'warehouse':_0x2418aa,'product':_0x2a5b2d,'invoice':_0x1cf01c,'master_shop':_0x52f29c,'language':_0x479a14,'find_data':_0x1a7d33,'rooms_data':_0x1adde9});})['catch'](_0x55f807=>{var _0x2fb4d6=_0x21f78a;_0xeacf0a[_0x2fb4d6(0x15b)](_0x2fb4d6(0x114),_0x2fb4d6(0x142)),_0x43fae9[_0x2fb4d6(0x13e)]('/all_purchases_finished/view');});}catch(_0x115a9a){console[_0x21f78a(0x179)](_0x115a9a);}}),router['get'](a0_0x3afcee(0x140),auth,async(_0x2bebaf,_0x231b9e)=>{var _0x5d7643=a0_0x3afcee;try{const _0x11f5f6=_0x2bebaf[_0x5d7643(0xb6)]['id'];console[_0x5d7643(0x179)](_0x11f5f6);const _0x31dbe9=await master_shop['find']();console['log'](_0x5d7643(0x12e),_0x31dbe9);const _0x300bf9=await product[_0x5d7643(0xd2)]({'name':_0x11f5f6});console['log'](_0x5d7643(0xbb),_0x300bf9),_0x231b9e['status'](0xc8)[_0x5d7643(0x92)]({'product_data':_0x300bf9,'master':_0x31dbe9});}catch(_0x562aa3){console[_0x5d7643(0x179)](_0x5d7643(0x128),_0x562aa3);}}),router[a0_0x3afcee(0xbf)](a0_0x3afcee(0xc7),auth,async(_0x59241b,_0x5d15b5)=>{var _0x318fd1=a0_0x3afcee;try{const {invoice:_0x2350d1,date:_0xa6b754,warehouse_name:_0x14e87b,prod_name:_0xb79fd2,prod_code:_0x28c199,prod_qty:_0x455fd4,prod_unit:_0x7d9e3d,prod_secondunit:_0x4ba169,prod_level:_0x3b5f49,prod_isle:_0x20600f,prod_pallet:_0x2080cd,note:_0x9bc91f,expiry_date:_0x5028db,batch_code:_0xa094b9,payable:_0x4645d5,due_amount:_0x465d08,Room_name:_0x2bdc1a,primary_code:_0x13495e,secondary_code:_0x4b2b86,MaxStocks_data:_0x40e229,PO_number:_0x36a0a0,SCRN:_0x292733,JO_number:_0x265194}=_0x59241b['body'];if(typeof _0xb79fd2==_0x318fd1(0x11a))var _0x17a531=[_0x59241b[_0x318fd1(0xc8)][_0x318fd1(0x11c)]],_0x18d918=[_0x59241b[_0x318fd1(0xc8)][_0x318fd1(0x10c)]],_0x28715a=[_0x59241b[_0x318fd1(0xc8)][_0x318fd1(0xfd)]],_0xb5a275=[_0x59241b[_0x318fd1(0xc8)][_0x318fd1(0xb5)]],_0x103bc2=[_0x59241b[_0x318fd1(0xc8)][_0x318fd1(0xc5)]],_0x12ff63=[_0x59241b[_0x318fd1(0xc8)][_0x318fd1(0xc6)]],_0xce69fd=[_0x59241b[_0x318fd1(0xc8)]['primary_code']],_0x154207=[_0x59241b[_0x318fd1(0xc8)][_0x318fd1(0x125)]],_0x1f96a4=[_0x59241b[_0x318fd1(0xc8)]['MaxStocks_data']],_0x2352fe=[_0x59241b[_0x318fd1(0xc8)][_0x318fd1(0x15f)]],_0x2b79e8=[_0x59241b[_0x318fd1(0xc8)][_0x318fd1(0x180)]],_0x98ca7=[_0x59241b[_0x318fd1(0xc8)]['product_date']],_0x39b925=[_0x59241b['body']['max_product_unit']],_0x2b3ba7=[_0x59241b[_0x318fd1(0xc8)]['prod_cat']],_0x3868b2=[_0x59241b['body'][_0x318fd1(0xb0)]],_0x18274a=[_0x59241b[_0x318fd1(0xc8)][_0x318fd1(0xfa)]];else var _0x17a531=[..._0x59241b['body'][_0x318fd1(0x11c)]],_0x18d918=[..._0x59241b[_0x318fd1(0xc8)][_0x318fd1(0x10c)]],_0x28715a=[..._0x59241b[_0x318fd1(0xc8)][_0x318fd1(0xfd)]],_0xb5a275=[..._0x59241b['body'][_0x318fd1(0xb5)]],_0x103bc2=[..._0x59241b[_0x318fd1(0xc8)][_0x318fd1(0xc5)]],_0x12ff63=[..._0x59241b[_0x318fd1(0xc8)][_0x318fd1(0xc6)]],_0xce69fd=[..._0x59241b[_0x318fd1(0xc8)][_0x318fd1(0x10b)]],_0x154207=[..._0x59241b['body'][_0x318fd1(0x125)]],_0x1f96a4=[..._0x59241b['body']['MaxStocks_data']],_0x2352fe=[..._0x59241b[_0x318fd1(0xc8)]['batch_code']],_0x2b79e8=[..._0x59241b[_0x318fd1(0xc8)]['expiry_date']],_0x98ca7=[..._0x59241b['body'][_0x318fd1(0x127)]],_0x39b925=[..._0x59241b[_0x318fd1(0xc8)][_0x318fd1(0x161)]],_0x2b3ba7=[..._0x59241b['body']['prod_cat']],_0x3868b2=[..._0x59241b[_0x318fd1(0xc8)][_0x318fd1(0xb0)]],_0x18274a=[..._0x59241b[_0x318fd1(0xc8)]['prod_invoice']];const _0x491db5=_0x17a531['map'](_0x2efc39=>{return _0x2efc39={'product_name':_0x2efc39};});_0x18d918[_0x318fd1(0x11e)]((_0x2f123b,_0x41430c)=>{var _0x2b20fd=_0x318fd1;_0x491db5[_0x41430c][_0x2b20fd(0xa5)]=_0x2f123b;}),_0x28715a['forEach']((_0x434f45,_0x1b4d44)=>{_0x491db5[_0x1b4d44]['quantity']=_0x434f45;}),_0xb5a275[_0x318fd1(0x11e)]((_0x4c7d5e,_0x425fb1)=>{_0x491db5[_0x425fb1]['standard_unit']=_0x4c7d5e;}),_0x103bc2[_0x318fd1(0x11e)]((_0x43f359,_0x3d673f)=>{_0x491db5[_0x3d673f]['secondary_unit']=_0x43f359;}),_0x12ff63['forEach']((_0x28b442,_0xade892)=>{var _0x187ef2=_0x318fd1;_0x491db5[_0xade892][_0x187ef2(0x176)]=_0x28b442;}),_0xce69fd[_0x318fd1(0x11e)]((_0x39f78a,_0x7702b)=>{var _0x3188de=_0x318fd1;_0x491db5[_0x7702b][_0x3188de(0x10b)]=_0x39f78a;}),_0x154207[_0x318fd1(0x11e)]((_0x3c0a58,_0x19df93)=>{var _0x48a78e=_0x318fd1;_0x491db5[_0x19df93][_0x48a78e(0x125)]=_0x3c0a58;}),_0x1f96a4[_0x318fd1(0x11e)]((_0x27e8b5,_0x28ec15)=>{var _0x4768a8=_0x318fd1;_0x491db5[_0x28ec15][_0x4768a8(0xe9)]=_0x27e8b5;}),_0x2352fe[_0x318fd1(0x11e)]((_0x31e419,_0x5ea4bc)=>{var _0x4cfc1d=_0x318fd1;_0x491db5[_0x5ea4bc][_0x4cfc1d(0x15f)]=_0x31e419;}),_0x2b79e8[_0x318fd1(0x11e)]((_0x2fff09,_0x21c2be)=>{var _0x21a810=_0x318fd1;_0x491db5[_0x21c2be][_0x21a810(0x180)]=_0x2fff09;}),_0x98ca7[_0x318fd1(0x11e)]((_0x26f64c,_0x1b8e9b)=>{var _0x407e89=_0x318fd1;_0x491db5[_0x1b8e9b][_0x407e89(0xda)]=_0x26f64c;}),_0x39b925[_0x318fd1(0x11e)]((_0x39ea77,_0xb40a1a)=>{_0x491db5[_0xb40a1a]['maxperunit']=_0x39ea77;}),_0x2b3ba7[_0x318fd1(0x11e)]((_0xc32cac,_0x54b787)=>{_0x491db5[_0x54b787]['product_cat']=_0xc32cac;}),_0x3868b2['forEach']((_0x4a6194,_0x3209d8)=>{_0x491db5[_0x3209d8]['room_name']=_0x4a6194;}),_0x18274a[_0x318fd1(0x11e)]((_0x52ed6e,_0x362e8d)=>{_0x491db5[_0x362e8d]['invoice']=_0x52ed6e;});const _0x336f25=_0x491db5['filter'](_0x1cf65d=>_0x1cf65d[_0x318fd1(0x126)]!=='0'&&_0x1cf65d[_0x318fd1(0x126)]!==''),_0x367fcb=new purchases_finished({'invoice':_0x2350d1,'suppliers':_0x59241b[_0x318fd1(0xc8)]['suppliers'],'date':_0xa6b754,'warehouse_name':_0x14e87b,'product':_0x336f25,'note':_0x9bc91f,'due_amount':_0x465d08,'room':_0x2bdc1a,'POnumber':_0x36a0a0,'SCRN':_0x292733,'JO_number':_0x265194}),_0x35b50b=await _0x367fcb['save'](),_0x11604a=await purchases_finished[_0x318fd1(0xd2)]({'invoice':_0x2350d1}),_0x124fec=_0x11604a['product'][_0x318fd1(0xd1)](async _0x363740=>{var _0x2d638f=_0x318fd1,_0x422173=await warehouse[_0x2d638f(0xd2)]({'name':_0x14e87b,'room':_0x363740[_0x2d638f(0xe5)]}),_0x1d6d67=0x0;const _0x33515c=_0x422173['product_details'][_0x2d638f(0xd1)](_0x2ad018=>{var _0x1da861=_0x2d638f;console[_0x1da861(0x179)](_0x2ad018[_0x1da861(0x170)]+'=='+_0x363740['product_name']+'&&'+_0x2ad018[_0x1da861(0x176)]+'=='+_0x363740['bay']+'&&'+_0x2ad018[_0x1da861(0x180)]+'=='+_0x363740['expiry_date']+'&&'+_0x2ad018[_0x1da861(0xda)]+'=='+_0x363740[_0x1da861(0xda)]+'&&'+_0x2ad018[_0x1da861(0x15f)]+'=='+_0x363740[_0x1da861(0x15f)]+'&&'+_0x2ad018['invoice']+'=='+_0x11604a['invoice']),_0x2ad018[_0x1da861(0x170)]==_0x363740[_0x1da861(0x170)]&&_0x2ad018[_0x1da861(0x176)]==_0x363740['bay']&&_0x2ad018['expiry_date']==_0x363740['expiry_date']&&_0x2ad018['production_date']==_0x363740[_0x1da861(0xda)]&&_0x2ad018[_0x1da861(0x15f)]==_0x363740[_0x1da861(0x15f)]&&_0x2ad018['invoice']==_0x11604a[_0x1da861(0x103)]&&(_0x2ad018['product_stock']=_0x2ad018[_0x1da861(0xee)]+_0x363740[_0x1da861(0x126)],_0x1d6d67++);});return _0x1d6d67=='0'&&(_0x422173[_0x2d638f(0xbc)]=_0x422173[_0x2d638f(0xbc)]['concat']({'product_name':_0x363740[_0x2d638f(0x170)],'product_stock':_0x363740[_0x2d638f(0x126)],'primary_code':_0x363740[_0x2d638f(0x10b)],'secondary_code':_0x363740[_0x2d638f(0x125)],'product_code':_0x363740['product_code'],'bay':_0x363740[_0x2d638f(0x176)],'maxProducts':_0x363740['maxStocks'],'unit':_0x363740[_0x2d638f(0x17f)],'secondary_unit':_0x363740[_0x2d638f(0xb3)],'expiry_date':_0x363740[_0x2d638f(0x180)],'production_date':_0x363740[_0x2d638f(0xda)],'maxProducts':_0x363740[_0x2d638f(0xe9)],'maxPerUnit':_0x363740[_0x2d638f(0x122)],'batch_code':_0x363740[_0x2d638f(0x15f)],'product_cat':_0x363740[_0x2d638f(0xaa)],'invoice':_0x363740['invoice']})),_0x422173;});Promise[_0x318fd1(0x145)](_0x124fec)[_0x318fd1(0x11b)](async _0x52809c=>{var _0x455f66=_0x318fd1;try{for(const _0x528032 of _0x52809c){await warehouse[_0x455f66(0x9c)]({'_id':_0x528032['_id']},{'$addToSet':{'product_details':{'$each':_0x528032[_0x455f66(0xbc)]}}});}const _0x5c1861=await master_shop[_0x455f66(0xd4)](),_0x5a3e3f=await email_settings[_0x455f66(0xd2)](),_0x269295=await supervisor_settings[_0x455f66(0xd4)]();var _0x5a0604=_0x11604a[_0x455f66(0xbb)],_0x177fd2='',_0x230173;for(_0x230173 in _0x5a0604){var _0x2de7bc='FG';_0x11604a[_0x455f66(0x14b)]==_0x455f66(0x124)&&(_0x2de7bc='DG'),_0x177fd2+=_0x455f66(0xf6)+_0x455f66(0x160)+_0x5a0604[_0x230173][_0x455f66(0x170)]+_0x455f66(0x115)+_0x455f66(0x160)+_0x5a0604[_0x230173][_0x455f66(0xa5)]+_0x455f66(0x115)+_0x455f66(0x160)+_0x5a0604[_0x230173][_0x455f66(0x126)]+_0x455f66(0x115)+_0x455f66(0x160)+_0x5a0604[_0x230173][_0x455f66(0x17f)]+_0x455f66(0x115)+_0x455f66(0x160)+_0x5a0604[_0x230173][_0x455f66(0xb3)]+_0x455f66(0x115)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x11604a[_0x455f66(0x14b)]+'</td>'+_0x455f66(0x160)+_0x5a0604[_0x230173][_0x455f66(0xe5)]+_0x455f66(0x115)+_0x455f66(0x160)+_0x2de7bc+_0x5a0604[_0x230173][_0x455f66(0x176)]+'</td>','</tr>';}let _0x21ada3=nodemailer['createTransport']({'host':_0x5a3e3f[_0x455f66(0x16f)],'port':Number(_0x5a3e3f[_0x455f66(0xd0)]),'secure':![],'auth':{'user':_0x5a3e3f['email'],'pass':_0x5a3e3f[_0x455f66(0x172)]}}),_0x126539={'from':_0x5a3e3f['email'],'to':_0x269295[0x0][_0x455f66(0x164)],'subject':_0x455f66(0x166),'attachments':[{'filename':'Logo.png','path':__dirname+_0x455f66(0x118)+_0x455f66(0x147)+_0x5c1861[0x0][_0x455f66(0x101)],'cid':_0x455f66(0x11d)}],'html':_0x455f66(0x17e)+_0x455f66(0x169)+'</head><body>'+_0x455f66(0xc0)+_0x455f66(0x9b)+'<div>'+_0x455f66(0xcd)+_0x455f66(0x104)+'<div>'+_0x455f66(0x105)+_0x5c1861[0x0][_0x455f66(0x99)]+'\x20</h2>'+'</div>'+_0x455f66(0x104)+'<hr\x20class=\x22my-3\x22>'+_0x455f66(0xc0)+_0x455f66(0x11f)+'\x20Order\x20Number\x20:\x20'+_0x11604a['invoice']+'\x20'+_0x455f66(0x8f)+_0x455f66(0x154)+_0x11604a[_0x455f66(0x109)]+'\x20'+'</span>'+'</h5>'+_0x455f66(0x104)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x455f66(0xf6)+_0x455f66(0xfb)+_0x455f66(0x181)+_0x455f66(0xe0)+_0x455f66(0x137)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x455f66(0x16a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x455f66(0xd5)+_0x455f66(0xf4)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x177fd2+'\x20'+_0x455f66(0xb8)+_0x455f66(0x93)+_0x455f66(0xc0)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x5c1861[0x0][_0x455f66(0x99)]+_0x455f66(0xdf)+_0x455f66(0x104)+'</div>'+_0x455f66(0x151)};_0x21ada3[_0x455f66(0xcc)](_0x126539,function(_0x3f344e,_0x5e07b4){var _0x457f46=_0x455f66;_0x3f344e?(console[_0x457f46(0x179)](_0x3f344e),console[_0x457f46(0x179)](_0x457f46(0x136))):console[_0x457f46(0x179)](_0x457f46(0x100));});}catch(_0x3c2a40){console[_0x455f66(0x12d)](_0x3c2a40),_0x5d15b5[_0x455f66(0x177)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x3c2a40['message']});}})[_0x318fd1(0xab)](_0x51e39c=>{var _0x331857=_0x318fd1;console[_0x331857(0x12d)](_0x51e39c),_0x5d15b5[_0x331857(0x177)](0x1f4)[_0x331857(0x92)]({'error':'An\x20error\x20occurred.'});}),_0x59241b[_0x318fd1(0x15b)]('success',_0x318fd1(0xf2)),_0x5d15b5[_0x318fd1(0x13e)]('/all_purchases_finished/view');}catch(_0x2a4987){console['log'](_0x2a4987);}}),router[a0_0x3afcee(0xff)]('/preview/:id',auth,async(_0x58f8e3,_0x16152e)=>{var _0x42951b=a0_0x3afcee;try{const {username:_0x2bc6ea,email:_0x559d7d,role:_0x397f9f}=_0x58f8e3['user'],_0x1f72dd=_0x58f8e3[_0x42951b(0x119)],_0x200d15=await profile[_0x42951b(0xd2)]({'email':_0x1f72dd[_0x42951b(0xdd)]}),_0x333429=await master_shop[_0x42951b(0xd4)](),_0x7c63d5=_0x58f8e3[_0x42951b(0xb6)]['id'],_0x5d5390=await purchases_finished['findById'](_0x7c63d5),_0x4af975=await suppliers['find']({});let _0x41617c;if(_0x1f72dd[_0x42951b(0xd9)]==_0x42951b(0x8e)){const _0x2ac220=await staff['findOne']({'email':_0x1f72dd[_0x42951b(0xdd)]});_0x41617c=await warehouse[_0x42951b(0xd4)]({'status':_0x42951b(0x12a),'name':_0x2ac220[_0x42951b(0xea)],'warehouse_category':_0x42951b(0x144)});}else _0x41617c=await warehouse[_0x42951b(0xa3)]([{'$match':{'status':'Enabled','warehouse_category':_0x42951b(0x144)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x34a257=await product[_0x42951b(0xd4)]({}),_0x49c4f8=BayBinSelected(_0x5d5390[_0x42951b(0x14b)],_0x5d5390[_0x42951b(0x9f)]);let _0x372d7f=new Date(_0x5d5390[_0x42951b(0x180)]),_0x4d5b8a=('0'+_0x372d7f[_0x42951b(0xb4)]())[_0x42951b(0xde)](-0x2),_0x1b6c59=('0'+(_0x372d7f[_0x42951b(0x148)]()+0x1))[_0x42951b(0xde)](-0x2),_0xd13a09=_0x372d7f['getFullYear'](),_0x389f54=_0xd13a09+'-'+_0x1b6c59+'-'+_0x4d5b8a;if(_0x333429[0x0][_0x42951b(0x102)]==_0x42951b(0xf3)){var _0x55d530=users[_0x42951b(0xc3)];console[_0x42951b(0x179)](_0x55d530);}else{if(_0x333429[0x0][_0x42951b(0x102)]==_0x42951b(0x8c))var _0x55d530=users[_0x42951b(0x8c)];else{if(_0x333429[0x0][_0x42951b(0x102)]=='German')var _0x55d530=users[_0x42951b(0x15a)];else{if(_0x333429[0x0][_0x42951b(0x102)]==_0x42951b(0xa8))var _0x55d530=users[_0x42951b(0xa8)];else{if(_0x333429[0x0][_0x42951b(0x102)]==_0x42951b(0xb9))var _0x55d530=users[_0x42951b(0xb9)];else{if(_0x333429[0x0]['language']=='Portuguese\x20(BR)')var _0x55d530=users[_0x42951b(0x120)];else{if(_0x333429[0x0][_0x42951b(0x102)]==_0x42951b(0x183))var _0x55d530=users[_0x42951b(0x183)];else{if(_0x333429[0x0][_0x42951b(0x102)]==_0x42951b(0x13a))var _0x55d530=users[_0x42951b(0x16c)];}}}}}}}_0x16152e[_0x42951b(0xaf)](_0x42951b(0xca),{'success':_0x58f8e3[_0x42951b(0x15b)]('success'),'errors':_0x58f8e3[_0x42951b(0x15b)](_0x42951b(0x114)),'role':_0x1f72dd,'profile':_0x200d15,'purchases':_0x5d5390,'suppliers':_0x4af975,'warehouse':_0x41617c,'product':_0x34a257,'master_shop':_0x333429,'language':_0x55d530,'ed_fullDate':_0x389f54,'dataSelected':_0x49c4f8});}catch(_0x36dabf){console[_0x42951b(0x179)](_0x36dabf);}}),router['get'](a0_0x3afcee(0x135),auth,async(_0x702d7a,_0x2b6c3d)=>{var _0x38cbe6=a0_0x3afcee;try{const {username:_0x53b4be,email:_0x2bbf28,role:_0x16098c}=_0x702d7a[_0x38cbe6(0x119)],_0xdef722=_0x702d7a[_0x38cbe6(0x119)],_0x32fc2d=await profile[_0x38cbe6(0xd2)]({'email':_0xdef722[_0x38cbe6(0xdd)]}),_0x587fd8=await master_shop[_0x38cbe6(0xd4)](),_0x5191b7=_0x702d7a[_0x38cbe6(0xb6)]['id'],_0x5ee115=await purchases_finished[_0x38cbe6(0xae)](_0x5191b7),_0x56d8c8=await suppliers[_0x38cbe6(0xd4)]({});let _0x15a9be;if(_0xdef722['role']==_0x38cbe6(0x8e)){const _0x12470f=await staff[_0x38cbe6(0xd2)]({'email':_0xdef722[_0x38cbe6(0xdd)]});_0x15a9be=await warehouse[_0x38cbe6(0xd4)]({'status':'Enabled','name':_0x12470f[_0x38cbe6(0xea)],'warehouse_category':_0x38cbe6(0x144)});}else _0x15a9be=await warehouse[_0x38cbe6(0xa3)]([{'$match':{'status':_0x38cbe6(0x12a),'warehouse_category':_0x38cbe6(0x144)}},{'$group':{'_id':'$name','name':{'$first':_0x38cbe6(0xf5)}}}]);const _0x3aea8=await product['find']({}),_0x20e12f=BayBinSelected(_0x5ee115[_0x38cbe6(0x14b)],_0x5ee115['room']);let _0x35f91a=new Date(_0x5ee115['expiry_date']),_0x22aa86=('0'+_0x35f91a[_0x38cbe6(0xb4)]())[_0x38cbe6(0xde)](-0x2),_0x4917e3=('0'+(_0x35f91a[_0x38cbe6(0x148)]()+0x1))[_0x38cbe6(0xde)](-0x2),_0x2167c3=_0x35f91a[_0x38cbe6(0x184)](),_0x459520=_0x2167c3+'-'+_0x4917e3+'-'+_0x22aa86;if(_0x587fd8[0x0][_0x38cbe6(0x102)]=='English\x20(US)'){var _0x565b29=users[_0x38cbe6(0xc3)];console[_0x38cbe6(0x179)](_0x565b29);}else{if(_0x587fd8[0x0][_0x38cbe6(0x102)]==_0x38cbe6(0x8c))var _0x565b29=users[_0x38cbe6(0x8c)];else{if(_0x587fd8[0x0][_0x38cbe6(0x102)]==_0x38cbe6(0x15a))var _0x565b29=users[_0x38cbe6(0x15a)];else{if(_0x587fd8[0x0][_0x38cbe6(0x102)]==_0x38cbe6(0xa8))var _0x565b29=users[_0x38cbe6(0xa8)];else{if(_0x587fd8[0x0][_0x38cbe6(0x102)]=='French')var _0x565b29=users[_0x38cbe6(0xb9)];else{if(_0x587fd8[0x0]['language']==_0x38cbe6(0xc2))var _0x565b29=users[_0x38cbe6(0x120)];else{if(_0x587fd8[0x0][_0x38cbe6(0x102)]==_0x38cbe6(0x183))var _0x565b29=users[_0x38cbe6(0x183)];else{if(_0x587fd8[0x0][_0x38cbe6(0x102)]==_0x38cbe6(0x13a))var _0x565b29=users[_0x38cbe6(0x16c)];}}}}}}}_0x2b6c3d[_0x38cbe6(0xaf)](_0x38cbe6(0xef),{'success':_0x702d7a[_0x38cbe6(0x15b)](_0x38cbe6(0x178)),'errors':_0x702d7a[_0x38cbe6(0x15b)](_0x38cbe6(0x114)),'role':_0xdef722,'profile':_0x32fc2d,'purchases':_0x5ee115,'suppliers':_0x56d8c8,'warehouse':_0x15a9be,'product':_0x3aea8,'master_shop':_0x587fd8,'language':_0x565b29,'ed_fullDate':_0x459520,'dataSelected':_0x20e12f});}catch(_0x29990b){console[_0x38cbe6(0x179)](_0x29990b);}}),router[a0_0x3afcee(0xbf)](a0_0x3afcee(0x135),auth,async(_0x53c223,_0x3a45d3)=>{var _0x36ffb5=a0_0x3afcee;try{const _0x256cb1=_0x53c223[_0x36ffb5(0xb6)]['id'],_0x161bb6=await purchases_finished['findOne']({'_id':_0x53c223[_0x36ffb5(0xb6)]['id']}),_0x32fa31=await warehouse[_0x36ffb5(0xd2)]({'name':_0x161bb6[_0x36ffb5(0x14b)],'room':_0x161bb6[_0x36ffb5(0x9f)]});_0x161bb6[_0x36ffb5(0xbb)]['forEach'](_0x5a92a4=>{var _0x171d3c=_0x36ffb5;const _0x262441=_0x32fa31[_0x171d3c(0xbc)][_0x171d3c(0xd1)](_0x3bec5c=>{var _0x1dede2=_0x171d3c;_0x3bec5c['product_name']==_0x5a92a4[_0x1dede2(0x170)]&&_0x3bec5c[_0x1dede2(0x176)]==_0x5a92a4[_0x1dede2(0x176)]&&(_0x3bec5c[_0x1dede2(0xee)]=parseInt(_0x3bec5c[_0x1dede2(0xee)])-parseInt(_0x5a92a4[_0x1dede2(0x126)]));});}),await _0x32fa31[_0x36ffb5(0x185)]();const {invoice:_0x2da7d7,suppliers:_0x5cd59d,date:_0x581999,warehouse_name:_0x46f966,prod_name:_0x57f6d9,prod_code:_0x26b10c,prod_qty:_0x5bf87f,prod_unit:_0x3bb983,prod_secondunit:_0x13267d,prod_level:_0x3a4ed8,prod_isle:_0x3cd312,prod_pallet:_0x4f2582,note:_0x1c73b4,expiry_date:_0x11ff0f,batch_code:_0x4b089c,paid_amount:_0x50f65d,due_amount:_0x2708de,Room_name:_0x2aac69,primary_code:_0x49275b,secondary_code:_0x321f7f,PO_number:_0x7e79b5,JO_number:_0x5867f5}=_0x53c223[_0x36ffb5(0xc8)];if(typeof _0x57f6d9=='string')var _0x2342f3=[_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x11c)]],_0xa88f6a=[_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x10c)]],_0x48ac19=[_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x175)]],_0x43006d=[_0x53c223['body'][_0x36ffb5(0x14a)]],_0x4a083e=[_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0xc5)]],_0x251212=[_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0xc6)]],_0xdcbbd2=[_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x10b)]],_0x6353bd=[_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x125)]],_0x1c4b5e=[_0x53c223[_0x36ffb5(0xc8)]['MaxStocks_data']],_0x247b12=[_0x53c223[_0x36ffb5(0xc8)]['batch_code']],_0x380471=[_0x53c223[_0x36ffb5(0xc8)]['expiry_date']];else var _0x2342f3=[..._0x53c223[_0x36ffb5(0xc8)]['prod_name']],_0xa88f6a=[..._0x53c223[_0x36ffb5(0xc8)]['prod_code']],_0x48ac19=[..._0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x175)]],_0x43006d=[..._0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x14a)]],_0x4a083e=[..._0x53c223['body'][_0x36ffb5(0xc5)]],_0x251212=[..._0x53c223[_0x36ffb5(0xc8)]['prod_level']],_0xdcbbd2=[..._0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x10b)]],_0x6353bd=[..._0x53c223[_0x36ffb5(0xc8)]['secondary_code']],_0x1c4b5e=[..._0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x152)]],_0x247b12=[..._0x53c223['body'][_0x36ffb5(0x15f)]],_0x380471=[..._0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x180)]];const _0x38db42=_0x2342f3[_0x36ffb5(0xd1)](_0x6ae7ae=>{return _0x6ae7ae={'product_name':_0x6ae7ae};});_0xa88f6a[_0x36ffb5(0x11e)]((_0x277dc4,_0xb1e6cd)=>{var _0x4c724f=_0x36ffb5;_0x38db42[_0xb1e6cd][_0x4c724f(0xa5)]=_0x277dc4;}),_0x48ac19['forEach']((_0x79b288,_0x6fba96)=>{var _0x3701ec=_0x36ffb5;_0x38db42[_0x6fba96][_0x3701ec(0x126)]=_0x79b288;}),_0x43006d[_0x36ffb5(0x11e)]((_0x32df64,_0x14f8b6)=>{var _0x40f207=_0x36ffb5;_0x38db42[_0x14f8b6][_0x40f207(0x17f)]=_0x32df64;}),_0x4a083e[_0x36ffb5(0x11e)]((_0x14840b,_0x377d5a)=>{var _0x133f43=_0x36ffb5;_0x38db42[_0x377d5a][_0x133f43(0xb3)]=_0x14840b;}),_0x251212[_0x36ffb5(0x11e)]((_0x44f01d,_0x432b08)=>{var _0x8699eb=_0x36ffb5;_0x38db42[_0x432b08][_0x8699eb(0x176)]=_0x44f01d;}),_0xdcbbd2[_0x36ffb5(0x11e)]((_0xa7c9fc,_0xa296d4)=>{var _0xcdf869=_0x36ffb5;_0x38db42[_0xa296d4][_0xcdf869(0x10b)]=_0xa7c9fc;}),_0x6353bd[_0x36ffb5(0x11e)]((_0x42985e,_0x5a9fee)=>{_0x38db42[_0x5a9fee]['secondary_code']=_0x42985e;}),_0x1c4b5e[_0x36ffb5(0x11e)]((_0x745bd6,_0x5d81dc)=>{var _0xc492a8=_0x36ffb5;_0x38db42[_0x5d81dc][_0xc492a8(0xe9)]=_0x745bd6;}),_0x247b12['forEach']((_0x3dda48,_0x4efb05)=>{_0x38db42[_0x4efb05]['batch_code']=_0x3dda48;}),_0x380471[_0x36ffb5(0x11e)]((_0xca3ce7,_0x25f442)=>{var _0x4f3a1f=_0x36ffb5;_0x38db42[_0x25f442][_0x4f3a1f(0x180)]=_0xca3ce7;});const _0x1770ce=_0x38db42[_0x36ffb5(0xa7)](_0x3c42be=>_0x3c42be[_0x36ffb5(0x126)]!=='0'&&_0x3c42be[_0x36ffb5(0x126)]!=='');_0x161bb6['invoice']=_0x2da7d7,_0x161bb6[_0x36ffb5(0x173)]=_0x5cd59d,_0x161bb6['date']=_0x581999,_0x161bb6[_0x36ffb5(0x14b)]=_0x46f966,_0x161bb6[_0x36ffb5(0xbb)]=_0x1770ce,_0x161bb6['note']=_0x1c73b4,_0x161bb6[_0x36ffb5(0x182)]=_0x50f65d,_0x161bb6[_0x36ffb5(0x146)]=_0x2708de,_0x161bb6['room']=_0x2aac69,_0x161bb6[_0x36ffb5(0x14e)]=_0x7e79b5,_0x161bb6[_0x36ffb5(0x139)]=_0x5867f5;const _0x5981fd=await _0x161bb6[_0x36ffb5(0x185)](),_0x5ce58d=await warehouse[_0x36ffb5(0xd2)]({'name':_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x14b)],'room':_0x53c223['body']['Room_name']});_0x161bb6['product'][_0x36ffb5(0x11e)](_0x3d3867=>{var _0x27abf3=_0x36ffb5,_0x5addda=0x0;const _0x110dea=_0x5ce58d[_0x27abf3(0xbc)]['map'](_0x1b504e=>{var _0x1420e3=_0x27abf3;_0x1b504e['product_name']==_0x3d3867['product_name']&&_0x1b504e['bay']==_0x3d3867['bay']&&(_0x1b504e[_0x1420e3(0xee)]=parseInt(_0x1b504e['product_stock'])+parseInt(_0x3d3867[_0x1420e3(0x126)]),_0x5addda++);});_0x5addda=='0'&&(_0x5ce58d[_0x27abf3(0xbc)]=_0x5ce58d[_0x27abf3(0xbc)][_0x27abf3(0x16b)]({'product_name':_0x3d3867['product_name'],'product_stock':_0x3d3867[_0x27abf3(0x126)],'primary_code':_0x3d3867[_0x27abf3(0x10b)],'secondary_code':_0x3d3867[_0x27abf3(0x125)],'product_code':_0x3d3867[_0x27abf3(0xa5)],'bay':_0x3d3867[_0x27abf3(0x176)],'maxProducts':_0x3d3867['maxStocks'],'unit':_0x3d3867[_0x27abf3(0x17f)],'secondary_unit':_0x3d3867['secondary_unit'],'expiry_date':_0x3d3867['expiry_date']}));}),await _0x5ce58d[_0x36ffb5(0x185)]();const _0x5b1c26=await s_payment_data[_0x36ffb5(0xd2)]({'invoice':_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x103)]});if(_0x5b1c26===null){}else console[_0x36ffb5(0x179)](_0x36ffb5(0x173),_0x5b1c26,_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x103)]),_0x5b1c26[_0x36ffb5(0x173)]=_0x53c223[_0x36ffb5(0xc8)][_0x36ffb5(0x173)],await _0x5b1c26[_0x36ffb5(0x185)]();_0x53c223[_0x36ffb5(0x15b)](_0x36ffb5(0x178),_0x36ffb5(0x17c)),_0x3a45d3[_0x36ffb5(0x13e)]('/all_purchases_finished/view');}catch(_0xd72b67){console[_0x36ffb5(0x179)](_0xd72b67);}}),router[a0_0x3afcee(0xbf)](a0_0x3afcee(0x12b),auth,async(_0x20378b,_0x13e73a)=>{var _0x1b7263=a0_0x3afcee;try{const _0x5d696d=_0x20378b[_0x1b7263(0xb6)]['id'],{invoice:_0x424b8b,suppliers:_0x4e3558,payable:_0x251050,due_amount:_0x134f64}=_0x20378b[_0x1b7263(0xc8)],_0x11e4d3=await purchases[_0x1b7263(0xae)](_0x5d696d);var _0x244eac=_0x251050-_0x134f64;_0x11e4d3[_0x1b7263(0x182)]=parseFloat(_0x11e4d3[_0x1b7263(0x182)])+parseFloat(_0x134f64),_0x11e4d3[_0x1b7263(0x146)]=_0x244eac;const _0x26326c=await _0x11e4d3[_0x1b7263(0x185)]();console[_0x1b7263(0x179)](_0x26326c);const _0x4ec09a=await s_payment_data[_0x1b7263(0xd2)]({'invoice':_0x424b8b});_0x4ec09a[_0x1b7263(0x123)]=_0x244eac,await _0x4ec09a[_0x1b7263(0x185)]();let _0x12a22c=new Date(),_0x4f59ff=('0'+_0x12a22c[_0x1b7263(0xb4)]())[_0x1b7263(0xde)](-0x2),_0x2c6d82=('0'+(_0x12a22c[_0x1b7263(0x148)]()+0x1))[_0x1b7263(0xde)](-0x2),_0x189b31=_0x12a22c[_0x1b7263(0x184)](),_0xcd6c59=_0x189b31+'-'+_0x2c6d82+'-'+_0x4f59ff;const _0x2598ad=new suppliers_payment({'invoice':_0x424b8b,'date':_0x189b31+'-'+_0x2c6d82+'-'+_0x4f59ff,'suppliers':_0x4e3558,'reason':_0x1b7263(0x117),'amount':_0x134f64}),_0x441b06=await _0x2598ad['save']();_0x20378b['flash'](_0x1b7263(0x178),_0x1b7263(0x94)),_0x13e73a[_0x1b7263(0x13e)](_0x1b7263(0x10a));}catch(_0x4b3f68){console[_0x1b7263(0x179)](_0x4b3f68);}}),router[a0_0x3afcee(0xff)](a0_0x3afcee(0x10d),auth,async(_0x599c25,_0x58a732)=>{var _0x48d697=a0_0x3afcee;try{const {username:_0xe266e6,email:_0x57b916,role:_0x2b8efc}=_0x599c25['user'],_0x39c2d3=_0x599c25['user'],_0x462e9a=await profile[_0x48d697(0xd2)]({'email':_0x39c2d3[_0x48d697(0xdd)]}),_0x59338b=await master_shop[_0x48d697(0xd4)]();console[_0x48d697(0x179)](_0x48d697(0x12e),_0x59338b);const _0x4f07d5=_0x599c25['params']['id'],_0x3b6350=await purchases['findById'](_0x4f07d5);console[_0x48d697(0x179)](_0x3b6350);const _0x59edc6=await suppliers[_0x48d697(0xd2)]({'name':_0x3b6350[_0x48d697(0x173)]});console[_0x48d697(0x179)](_0x59edc6);if(_0x59338b[0x0][_0x48d697(0x102)]==_0x48d697(0xf3)){var _0x399fab=users[_0x48d697(0xc3)];console[_0x48d697(0x179)](_0x399fab);}else{if(_0x59338b[0x0][_0x48d697(0x102)]==_0x48d697(0x8c))var _0x399fab=users[_0x48d697(0x8c)];else{if(_0x59338b[0x0][_0x48d697(0x102)]==_0x48d697(0x15a))var _0x399fab=users['German'];else{if(_0x59338b[0x0]['language']==_0x48d697(0xa8))var _0x399fab=users[_0x48d697(0xa8)];else{if(_0x59338b[0x0][_0x48d697(0x102)]=='French')var _0x399fab=users[_0x48d697(0xb9)];else{if(_0x59338b[0x0]['language']==_0x48d697(0xc2))var _0x399fab=users[_0x48d697(0x120)];else{if(_0x59338b[0x0][_0x48d697(0x102)]==_0x48d697(0x183))var _0x399fab=users['Chinese'];else{if(_0x59338b[0x0][_0x48d697(0x102)]=='Arabic\x20(ae)')var _0x399fab=users['Arabic'];}}}}}}}_0x58a732['render'](_0x48d697(0xdc),{'success':_0x599c25[_0x48d697(0x15b)](_0x48d697(0x178)),'errors':_0x599c25[_0x48d697(0x15b)]('errors'),'role':_0x39c2d3,'profile':_0x462e9a,'master_shop':_0x59338b,'supplier':_0x59edc6,'purchase':_0x3b6350,'language':_0x399fab});}catch(_0x34340c){console[_0x48d697(0x179)](_0x34340c);}}),router['get'](a0_0x3afcee(0xbd),auth,async(_0x6139e0,_0x2b1ffc)=>{var _0x203d8b=a0_0x3afcee;try{const {username:_0x51a0d6,email:_0x36057a,role:_0x3cc72e}=_0x6139e0[_0x203d8b(0x119)],_0x47415b=_0x6139e0['user'],_0x3b8d9f=await profile[_0x203d8b(0xd2)]({'email':_0x47415b[_0x203d8b(0xdd)]}),_0x27df1a=await master_shop[_0x203d8b(0xd4)]();console[_0x203d8b(0x179)](_0x203d8b(0x12e),_0x27df1a);const _0x24a14a=_0x6139e0[_0x203d8b(0xb6)]['id'];console[_0x203d8b(0x179)](_0x24a14a);const _0x545c70=await purchases_finished['findById'](_0x24a14a);console[_0x203d8b(0x179)](_0x203d8b(0x10e),_0x545c70);const _0x166636=await product[_0x203d8b(0xd4)]({}),_0x2e584b=await warehouse[_0x203d8b(0xa3)]([{'$match':{'name':_0x545c70[_0x203d8b(0x14b)],'room':_0x545c70[_0x203d8b(0x9f)]}},{'$unwind':_0x203d8b(0xcb)},{'$group':{'_id':_0x203d8b(0xa1),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x203d8b(0x121)},'bay':{'$first':_0x203d8b(0x13c)},'bin':{'$first':_0x203d8b(0xdb)},'type':{'$first':_0x203d8b(0xe8)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x203d8b(0xfc)},'secondary_code':{'$first':_0x203d8b(0x14d)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x203d8b(0x107)},'rack':{'$first':_0x203d8b(0xf1)}}}]);console[_0x203d8b(0x179)]('stock_data',_0x2e584b);let _0x3583fc;if(_0x47415b[_0x203d8b(0xd9)]==_0x203d8b(0x8e)){const _0x3178f6=await staff[_0x203d8b(0xd2)]({'email':_0x47415b['email']});_0x3583fc=await warehouse[_0x203d8b(0xd4)]({'status':'Enabled','name':_0x3178f6['warehouse'],'warehouse_category':_0x203d8b(0x144),'name':_0x203d8b(0x17a)});}else _0x3583fc=await warehouse[_0x203d8b(0xa3)]([{'$match':{'status':'Enabled','warehouse_category':_0x203d8b(0x144),'name':_0x203d8b(0x17a)}},{'$group':{'_id':_0x203d8b(0xf5),'name':{'$first':_0x203d8b(0xf5)}}}]);if(_0x27df1a[0x0][_0x203d8b(0x102)]=='English\x20(US)'){var _0x26ad86=users[_0x203d8b(0xc3)];console[_0x203d8b(0x179)](_0x26ad86);}else{if(_0x27df1a[0x0][_0x203d8b(0x102)]=='Hindi')var _0x26ad86=users[_0x203d8b(0x8c)];else{if(_0x27df1a[0x0]['language']==_0x203d8b(0x15a))var _0x26ad86=users[_0x203d8b(0x15a)];else{if(_0x27df1a[0x0]['language']=='Spanish')var _0x26ad86=users[_0x203d8b(0xa8)];else{if(_0x27df1a[0x0][_0x203d8b(0x102)]=='French')var _0x26ad86=users[_0x203d8b(0xb9)];else{if(_0x27df1a[0x0]['language']==_0x203d8b(0xc2))var _0x26ad86=users[_0x203d8b(0x120)];else{if(_0x27df1a[0x0][_0x203d8b(0x102)]=='Chinese')var _0x26ad86=users[_0x203d8b(0x183)];else{if(_0x27df1a[0x0]['language']==_0x203d8b(0x13a))var _0x26ad86=users[_0x203d8b(0x16c)];}}}}}}}_0x2b1ffc['render'](_0x203d8b(0xa2),{'success':_0x6139e0[_0x203d8b(0x15b)]('success'),'errors':_0x6139e0[_0x203d8b(0x15b)](_0x203d8b(0x114)),'role':_0x47415b,'profile':_0x3b8d9f,'user':_0x545c70,'stock':_0x2e584b,'master_shop':_0x27df1a,'product':_0x166636,'language':_0x26ad86,'warehouse':_0x3583fc});}catch(_0x165b71){console[_0x203d8b(0x179)](_0x165b71);}}),router[a0_0x3afcee(0xbf)]('/view/return_purchase/:id',auth,async(_0x2d9e82,_0x54ab44)=>{var _0x1482b5=a0_0x3afcee;try{const {invoice:_0xecd12,date:_0x16280a,warehouse_name:_0x5a4af8,Room_name:_0x439dd1,product_name:_0x3222ff,purchase_quantity:_0x5b7199,stocks:_0x4358b2,return_qty:_0x1c9077,note:_0x37a7b2,level:_0x574a96,isle:_0x2e89ac,pallet:_0x11298a,to_warehouse_name:_0x3a1ddf,to_Room_name:_0x2c96ec}=_0x2d9e82['body'],_0xa490c6=await purchases_finished[_0x1482b5(0xd2)]({'_id':_0x2d9e82[_0x1482b5(0xb6)]['id']}),_0x8eab08=await warehouse[_0x1482b5(0xd2)]({'name':_0x5a4af8,'room':_0x439dd1,'warehouse_category':_0x1482b5(0x144)});if(typeof _0x3222ff==_0x1482b5(0x11a))var _0xa13392=[_0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0x170)]],_0x43f3d7=[_0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0xf0)]],_0xc7fdf7=[_0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0x167)]],_0x35d72f=[_0x2d9e82[_0x1482b5(0xc8)]['return_qty']],_0x138177=[_0x2d9e82[_0x1482b5(0xc8)]['level']],_0x424d5d=[_0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0xec)]],_0x149fc4=[_0x2d9e82['body'][_0x1482b5(0xad)]],_0x5c40f5=[_0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0xd3)]];else var _0xa13392=[..._0x2d9e82['body'][_0x1482b5(0x170)]],_0x43f3d7=[..._0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0xf0)]],_0xc7fdf7=[..._0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0x167)]],_0x35d72f=[..._0x2d9e82[_0x1482b5(0xc8)]['return_qty']],_0x138177=[..._0x2d9e82[_0x1482b5(0xc8)]['level']],_0x424d5d=[..._0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0xec)]],_0x149fc4=[..._0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0xad)]],_0x5c40f5=[..._0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0xd3)]];const _0x5c29fa=_0xa13392[_0x1482b5(0xd1)](_0x3e8a8a=>{return _0x3e8a8a={'product_name':_0x3e8a8a};});_0x43f3d7[_0x1482b5(0x11e)]((_0x5767be,_0x26495e)=>{var _0x1127f3=_0x1482b5;_0x5c29fa[_0x26495e][_0x1127f3(0xf0)]=_0x5767be;}),_0xc7fdf7[_0x1482b5(0x11e)]((_0x2162a9,_0x530a62)=>{_0x5c29fa[_0x530a62]['stock_quantity']=_0x2162a9;}),_0x35d72f[_0x1482b5(0x11e)]((_0x18f198,_0x4eb743)=>{_0x5c29fa[_0x4eb743]['return_qty']=_0x18f198;}),_0x138177[_0x1482b5(0x11e)]((_0x564796,_0x2c1ecb)=>{var _0x12589=_0x1482b5;_0x5c29fa[_0x2c1ecb][_0x12589(0x176)]=_0x564796;}),_0x424d5d[_0x1482b5(0x11e)]((_0x27c5a7,_0x54933a)=>{var _0x341f5c=_0x1482b5;_0x5c29fa[_0x54933a][_0x341f5c(0xa5)]=_0x27c5a7;}),_0x149fc4[_0x1482b5(0x11e)]((_0x282885,_0x159a2d)=>{var _0x446a87=_0x1482b5;_0x5c29fa[_0x159a2d][_0x446a87(0x10b)]=_0x282885;}),_0x5c40f5['forEach']((_0x54512d,_0x393ddd)=>{_0x5c29fa[_0x393ddd]['secondary_code']=_0x54512d;}),_0x5c29fa[_0x1482b5(0x11e)](_0x228337=>{var _0x3c493e=_0x1482b5;console[_0x3c493e(0x179)](_0x228337);const _0x30b644=_0x8eab08['product_details'][_0x3c493e(0xd1)](_0x234ce=>{var _0x262f22=_0x3c493e;_0x234ce[_0x262f22(0x170)]==_0x228337[_0x262f22(0x170)]&&_0x234ce[_0x262f22(0x176)]==_0x228337[_0x262f22(0x176)]&&(console[_0x262f22(0x179)](parseInt(_0x234ce[_0x262f22(0xee)])+'\x20<>\x20'+parseInt(_0x228337['return_qty'])),_0x234ce[_0x262f22(0xee)]=parseInt(_0x234ce[_0x262f22(0xee)])-parseInt(_0x228337[_0x262f22(0x153)]));});}),await _0x8eab08['save']();var _0x5035f6=0x0;_0x5c29fa['forEach'](_0x27d841=>{var _0x22935b=_0x1482b5;(parseInt(_0x27d841[_0x22935b(0xf0)])<parseInt(_0x27d841[_0x22935b(0x153)])||parseInt(_0x27d841[_0x22935b(0x16e)])<parseInt(_0x27d841[_0x22935b(0x153)]))&&_0x5035f6++;});if(_0x5035f6!=0x0)return _0x2d9e82[_0x1482b5(0x15b)](_0x1482b5(0x114),_0x1482b5(0x13d)),_0x54ab44['redirect'](_0x1482b5(0xa4));const _0x547451=new purchases_return_finished({'invoice':_0xecd12,'suppliers':_0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0x173)],'date':_0x16280a,'warehouse_name':_0x5a4af8,'return_product':_0x5c29fa,'note':_0x37a7b2,'room':_0x439dd1,'to_warehouse_name':_0x3a1ddf,'to_room':_0x2c96ec}),_0x3703ab=await _0x547451[_0x1482b5(0x185)](),_0x2f8676=await purchases_return_finished[_0x1482b5(0xd2)]({'invoice':_0xecd12}),_0x5e58e7=await warehouse[_0x1482b5(0xd2)]({'name':_0x3a1ddf,'room':_0x2c96ec,'warehouse_category':_0x1482b5(0x144)});_0x2f8676[_0x1482b5(0x13b)]['forEach'](_0x3f3edf=>{var _0x6b34b=_0x1482b5,_0x5457d5=0x0;const _0x45f82b=_0x5e58e7[_0x6b34b(0xbc)][_0x6b34b(0xd1)](_0x240824=>{var _0x2c3d6c=_0x6b34b;console['log'](_0x240824['product_name']+'=='+_0x3f3edf[_0x2c3d6c(0x170)]+'&&'+_0x240824[_0x2c3d6c(0x176)]+'=='+_0x3f3edf[_0x2c3d6c(0x176)]),_0x240824[_0x2c3d6c(0x170)]==_0x3f3edf[_0x2c3d6c(0x170)]&&_0x240824[_0x2c3d6c(0x176)]==_0x3f3edf['bay']&&(_0x240824[_0x2c3d6c(0xee)]=parseInt(_0x240824[_0x2c3d6c(0xee)])-parseInt(_0x3f3edf[_0x2c3d6c(0x153)]),_0x5457d5++);});_0x5457d5=='0'&&(_0x5e58e7['product_details']=_0x5e58e7[_0x6b34b(0xbc)][_0x6b34b(0x16b)]({'product_name':_0x3f3edf[_0x6b34b(0x170)],'product_stock':_0x3f3edf[_0x6b34b(0x153)],'primary_code':_0x3f3edf['primary_code'],'secondary_code':_0x3f3edf[_0x6b34b(0x125)],'product_code':_0x3f3edf[_0x6b34b(0xa5)],'bay':_0x3f3edf[_0x6b34b(0x176)],'maxProducts':0xf423f}));}),await _0x5e58e7[_0x1482b5(0x185)]();const _0x4ec088=await purchases_finished['findOne']({'invoice':_0xecd12});_0x4ec088['return_data']=_0x1482b5(0x149);const _0x3386ae=await _0x4ec088[_0x1482b5(0x185)](),_0x18c565=new s_payment_data({'invoice':_0xecd12,'suppliers':_0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0x173)],'reason':_0x1482b5(0xba)});await _0x18c565[_0x1482b5(0x185)]();const _0x5f3fdb=await master_shop[_0x1482b5(0xd4)](),_0x43941d=await email_settings[_0x1482b5(0xd2)](),_0x3566ef=await suppliers['findOne']({'name':_0x2d9e82[_0x1482b5(0xc8)][_0x1482b5(0x173)]});_0x5f3fdb[0x0][_0x1482b5(0x162)]==0x1?(right_currency=_0x5f3fdb[0x0][_0x1482b5(0x141)],left_currency=''):(right_currency='',left_currency=_0x5f3fdb[0x0][_0x1482b5(0x141)]);var _0x3b2003=_0xa13392,_0x2969a8=_0x35d72f,_0x4de1d2='',_0x387663;for(_0x387663 in _0x3b2003){_0x4de1d2+='<tr>'+_0x1482b5(0x160)+_0x3b2003[_0x387663]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2969a8[_0x387663]+_0x1482b5(0x115)+_0x1482b5(0xf4);}let _0x482790=nodemailer[_0x1482b5(0x165)]({'service':'gmail','auth':{'user':_0x43941d[_0x1482b5(0xdd)],'pass':_0x43941d[_0x1482b5(0x172)]}}),_0x7cf0fb={'from':_0x43941d[_0x1482b5(0xdd)],'to':_0x3566ef[_0x1482b5(0xdd)],'subject':_0x1482b5(0xf8),'attachments':[{'filename':_0x1482b5(0x15d),'path':__dirname+_0x1482b5(0x118)+'/upload/'+_0x5f3fdb[0x0]['image'],'cid':'logo'}],'html':_0x1482b5(0x17e)+_0x1482b5(0x169)+_0x1482b5(0x150)+_0x1482b5(0xc0)+_0x1482b5(0x9b)+_0x1482b5(0xc0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x1482b5(0xc0)+'<h2>\x20'+_0x5f3fdb[0x0]['site_title']+_0x1482b5(0x14c)+_0x1482b5(0x104)+'</div>'+_0x1482b5(0xe6)+_0x1482b5(0xc0)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1482b5(0xe7)+_0xecd12+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1482b5(0x154)+_0x16280a+'\x20'+_0x1482b5(0x163)+'</h5>'+_0x1482b5(0x104)+_0x1482b5(0x129)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1482b5(0xf6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1482b5(0xed)+_0x1482b5(0xcf)+_0x1482b5(0xac)+_0x1482b5(0xf4)+_0x1482b5(0x133)+_0x1482b5(0x108)+'\x20'+_0x4de1d2+'\x20'+_0x1482b5(0xb8)+_0x1482b5(0x93)+_0x1482b5(0xc0)+_0x1482b5(0x15c)+_0x1482b5(0x8b)+_0x5f3fdb[0x0][_0x1482b5(0x99)]+'</h5>'+'</div>'+_0x1482b5(0x104)+_0x1482b5(0x151)};_0x482790['sendMail'](_0x7cf0fb,function(_0x3e37e3,_0x539b44){var _0xdbdc96=_0x1482b5;_0x3e37e3?console['log'](_0xdbdc96(0x136)):console['log']('Email\x20sent\x20successfully');}),_0x2d9e82['flash'](_0x1482b5(0x178),'purchases\x20item\x20return\x20successfull'),_0x54ab44[_0x1482b5(0x13e)](_0x1482b5(0xb1));}catch(_0x16b057){_0x54ab44[_0x1482b5(0x177)](0xc8)[_0x1482b5(0x92)]({'message':_0x16b057['message']});}}),router['get']('/barcode/:id',auth,async(_0x238f52,_0x2471ef)=>{var _0x2a040a=a0_0x3afcee;try{const {username:_0x4df9fe,email:_0x52340c,role:_0x5661b4}=_0x238f52['user'],_0x1367c5=_0x238f52['user'],_0x126f8c=await profile['findOne']({'email':_0x1367c5[_0x2a040a(0xdd)]}),_0x138492=await master_shop[_0x2a040a(0xd4)](),_0xca2057=_0x238f52['params']['id'],_0x22c90f=await purchases_finished[_0x2a040a(0xae)](_0xca2057);if(_0x138492[0x0][_0x2a040a(0x102)]=='English\x20(US)')var _0x180f71=users[_0x2a040a(0xc3)];else{if(_0x138492[0x0][_0x2a040a(0x102)]==_0x2a040a(0x8c))var _0x180f71=users['Hindi'];else{if(_0x138492[0x0][_0x2a040a(0x102)]=='German')var _0x180f71=users['German'];else{if(_0x138492[0x0][_0x2a040a(0x102)]==_0x2a040a(0xa8))var _0x180f71=users[_0x2a040a(0xa8)];else{if(_0x138492[0x0]['language']=='French')var _0x180f71=users[_0x2a040a(0xb9)];else{if(_0x138492[0x0][_0x2a040a(0x102)]=='Portuguese\x20(BR)')var _0x180f71=users[_0x2a040a(0x120)];else{if(_0x138492[0x0][_0x2a040a(0x102)]==_0x2a040a(0x183))var _0x180f71=users[_0x2a040a(0x183)];else{if(_0x138492[0x0][_0x2a040a(0x102)]==_0x2a040a(0x13a))var _0x180f71=users['Arabic'];}}}}}}}_0x2471ef[_0x2a040a(0xaf)](_0x2a040a(0x14f),{'success':_0x238f52[_0x2a040a(0x15b)](_0x2a040a(0x178)),'errors':_0x238f52[_0x2a040a(0x15b)]('errors'),'role':_0x1367c5,'profile':_0x126f8c,'alldata':_0x22c90f,'master_shop':_0x138492,'language':_0x180f71}),console[_0x2a040a(0x179)](alldata);}catch(_0x4272d9){console[_0x2a040a(0x179)](_0x4272d9);}}),router[a0_0x3afcee(0xbf)]('/barcode_scanner',async(_0x336fe1,_0x5906be)=>{var _0x18edd7=a0_0x3afcee;const {product_code:_0x43f55f}=_0x336fe1[_0x18edd7(0xc8)];var _0x55eb39;const _0x3e3b75=await product['aggregate']([{'$match':{'primary_code':_0x43f55f,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x18edd7(0x134),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x18edd7(0x106)},'unit':{'$first':_0x18edd7(0x159)},'alertquantity':{'$first':_0x18edd7(0x90)},'product_code':{'$first':_0x18edd7(0x155)},'primary_code':{'$first':_0x18edd7(0x157)},'secondary_code':{'$first':_0x18edd7(0x138)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x18edd7(0x12f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x18edd7(0xd8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1ba04c=await product['aggregate']([{'$match':{'secondary_code':_0x43f55f}},{'$group':{'_id':_0x18edd7(0x134),'name':{'$first':_0x18edd7(0xf5)},'category':{'$first':_0x18edd7(0xc9)},'brand':{'$first':_0x18edd7(0x106)},'unit':{'$first':_0x18edd7(0x159)},'alertquantity':{'$first':_0x18edd7(0x90)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x18edd7(0x157)},'secondary_code':{'$first':_0x18edd7(0x138)},'maxStocks':{'$first':_0x18edd7(0xf9)},'maxProdPerUnit':{'$first':_0x18edd7(0x12f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x18edd7(0xd8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3e3b75[_0x18edd7(0xd6)]>0x0)_0x55eb39=_0x3e3b75;else _0x1ba04c[_0x18edd7(0xd6)]>0x0&&(_0x55eb39=_0x1ba04c);_0x5906be['json'](_0x55eb39);}),router[a0_0x3afcee(0xbf)](a0_0x3afcee(0x132),async(_0x2cea0,_0x1e12b3)=>{var _0x4571ad=a0_0x3afcee;const {productCode:_0x158129,bay:_0xb45ce0,warehouses:_0x44bf0d,room:_0x544bf8}=_0x2cea0['body'];console['log'](_0x2cea0[_0x4571ad(0xc8)]);try{const _0x5175ae=await warehouse[_0x4571ad(0xa3)]([{'$match':{'name':_0x44bf0d,'room':_0x544bf8}},{'$unwind':_0x4571ad(0xcb)},{'$match':{'product_details.bay':parseInt(_0xb45ce0)}},{'$group':{'_id':_0x4571ad(0xa1),'name':{'$first':_0x4571ad(0xe2)},'product_stock':{'$first':_0x4571ad(0x121)},'bay':{'$first':_0x4571ad(0x13c)},'maxProducts':{'$first':_0x4571ad(0xce)}}}]);_0x1e12b3[_0x4571ad(0x177)](0xc8)[_0x4571ad(0x92)](_0x5175ae);}catch(_0x4e2335){_0x1e12b3[_0x4571ad(0x177)](0x194)[_0x4571ad(0x92)]({'message':_0x4e2335[_0x4571ad(0x91)]});}}),module[a0_0x3afcee(0x16d)]=router;