function a0_0x3c1a(){var _0xc0039b=['back','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$alertquantity','$invoice','date','host','3352xFeDkt','image','log','$suppliers_docs','stocks','user','$batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/view/:id','$brand','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','random','product_code_hide','FROZEN\x20GOODS','Purchase\x20Mail','$paid_amount','getDate','/upload/','<table\x20style=\x22width:\x20100%\x20!important;\x22>','INCF-','product_stock','level','Logo.png','payment\x20successfull','message','/give_payment/:id','6771429waRvgj','$expiry_date','expiry_date','quantity','product_date','$product_details.product_code','<h5\x20style=\x22text-align:\x20left;\x22>','staff','Hindi','findOne','<tr>','params','getFullYear','warehouse_name','site_title','Arabic','$maxStocks','/all_purchases_finished/view','slice','$date','Room_name','path','concat','$product_details.floorlevel','</div>','email','user_id','return_qty','Portuguese\x20(BR)','password','</thead>','$product_details.primary_code','prod_primunit','Rack\x201','\x20</h2>','max_product_unit','$product_details.product_stock','logo','<div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','nodemailer','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','note','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$due_amount','POnumber','</tbody>','An\x20error\x20occurred\x20while\x20saving\x20data.','French','$product_details._id','Rack\x202','$primary_code','Purchase\x20Return\x20Mail','stock_quantity','$product.room_name','$product.quantity','purchase\x20data\x20update\x20successfully','post','return_product','product_details','<!DOCTYPE\x20html>','$unit','name','suppliers','German','English','Spanish','$return_data','$warehouse_name','express','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','table\x20page','prod_secondunit','18116810oRWzJL','True','Finished\x20Goods','Purchase\x20Return','$product_details.product_name','<tbody\x20style=\x22text-align:\x20center;\x22>','length','sendMail','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','</h5>','15696tymynM','ejs','gmail','padStart','$product','$product.type','room','return_data','all_purchases_finished','findById','/../public','Portuguese','bay','$product.floorlevel','redirect','string','/barcode_scanner','map','648jSnnFv','Email\x20sent\x20successfully','$product_details.maxProducts','language','stock_data','$product_details.bay','updateOne','<span\x20style=\x22float:\x20right;\x22>','$suppliers','currency','prod_Qty','add_purchases_finished','$room','\x20Order\x20Date\x20:\x20','Arabic\x20(ae)','59146XeEMte','/CheckingWarehouse','maxStocks','forEach','master','$product_details','prod_name','<html><head><title></title>','$product_details.storage','</body></html>','/invoice/:id','/all_purchases/view','amount','Enabled','prod_code','secondary_unit','/view/add_purchases','MaxStocks_data','/view/return_purchase/:id','$name','all','$_id','toString','standard_unit','role','success','error','$product_code','English\x20(US)','$product_details.secondary_code','</tr>','production_date','$secondary_unit','catch','secondary_code','suppliers_docs','secondary_code_hide','status','Ambient','$maxProdPerUnit','Error\x20occurred\x20while\x20processing\x20product:','abs','$product.bin','createTransport','6328404lVaQjj','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','_id','prod_invoice','\x20<>\x20','/preview/:id','5IQFZdp','<h5>','invoice','filter','../middleware/auth','purchases\x20item\x20return\x20successfull','paid_amount','maxperunit','product_code','then','\x20Order\x20Number\x20:\x20','purchase_quantity','product_name','get','RoomAssign','primary_code','render','</span>','body','QA\x20Warehouse','$note','errors','../public/language/languages.json','</td>','$product.bay','add_purchases\x20error','due_amount','room_name','exports','aggregate','212415jtCKUv','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','12627xDRUql','find','../models/all_models','Router','product','$product_details.bin','getMonth','flash','save','prod_cat','Return\x20Goods','<strong>\x20Regards\x20</strong>','prod_level','Chinese','prod_unit','Error\x20Occurs','json','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$category','prod_qty','/view','warehouse','return_purchase_finished','product_cat','currency_placement'];a0_0x3c1a=function(){return _0xc0039b;};return a0_0x3c1a();}var a0_0x1030b8=a0_0x3cd1;function a0_0x3cd1(_0x5ec3e3,_0x1cd689){var _0x3c1ab4=a0_0x3c1a();return a0_0x3cd1=function(_0x3cd14e,_0x414102){_0x3cd14e=_0x3cd14e-0x1f4;var _0x1fda8f=_0x3c1ab4[_0x3cd14e];return _0x1fda8f;},a0_0x3cd1(_0x5ec3e3,_0x1cd689);}(function(_0x35038a,_0x4350ff){var _0xa27797=a0_0x3cd1,_0x8c0993=_0x35038a();while(!![]){try{var _0x2d8730=-parseInt(_0xa27797(0x293))/0x1*(-parseInt(_0xa27797(0x261))/0x2)+parseInt(_0xa27797(0x240))/0x3*(parseInt(_0xa27797(0x252))/0x4)+-parseInt(_0xa27797(0x2b1))/0x5+parseInt(_0xa27797(0x28d))/0x6+parseInt(_0xa27797(0x2ee))/0x7+parseInt(_0xa27797(0x2d4))/0x8*(-parseInt(_0xa27797(0x2b3))/0x9)+-parseInt(_0xa27797(0x236))/0xa;if(_0x2d8730===_0x4350ff)break;else _0x8c0993['push'](_0x8c0993['shift']());}catch(_0x4b2257){_0x8c0993['push'](_0x8c0993['shift']());}}}(a0_0x3c1a,0x8c815));const express=require(a0_0x1030b8(0x232)),app=express(),router=express[a0_0x1030b8(0x2b6)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x1030b8(0x2b5)),auth=require(a0_0x1030b8(0x297)),nodemailer=require(a0_0x1030b8(0x213));var ejs=require(a0_0x1030b8(0x241));const path=require(a0_0x1030b8(0x200)),users=require(a0_0x1030b8(0x2a9));router[a0_0x1030b8(0x2a0)](a0_0x1030b8(0x2c8),auth,async(_0x244715,_0x31a65e)=>{var _0x50b3a4=a0_0x1030b8;try{const {username:_0x286786,email:_0x41a797,role:_0x319d92}=_0x244715['user'],_0x6d7595=_0x244715['user'],_0x577444=await profile['findOne']({'email':_0x6d7595[_0x50b3a4(0x204)]}),_0x543177=await staff[_0x50b3a4(0x1f4)]({'email':_0x6d7595['email']});if(_0x6d7595['role']==_0x50b3a4(0x2f5)){const _0x25fe5d=await staff['findOne']({'email':_0x6d7595[_0x50b3a4(0x204)]});}const _0x554baf=await master_shop[_0x50b3a4(0x2b4)]();let _0x572ef0;if(_0x6d7595[_0x50b3a4(0x279)]=='staff'){const _0xc404e6=await staff[_0x50b3a4(0x1f4)]({'email':_0x6d7595[_0x50b3a4(0x204)]});_0x572ef0=await purchases_finished[_0x50b3a4(0x2b0)]([{'$match':{'warehouse_name':_0xc404e6[_0x50b3a4(0x2c9)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x50b3a4(0x22b),'as':_0x50b3a4(0x284)}},{'$unwind':_0x50b3a4(0x2d7)},{'$unwind':'$product'},{'$group':{'_id':_0x50b3a4(0x276),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x50b3a4(0x25a)},'date':{'$first':_0x50b3a4(0x1fe)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x50b3a4(0x25e)},'product':{'$push':_0x50b3a4(0x244)},'note':{'$first':_0x50b3a4(0x2a7)},'paid_amount':{'$first':_0x50b3a4(0x2e3)},'due_amount':{'$first':_0x50b3a4(0x219)},'return_data':{'$first':_0x50b3a4(0x230)},'batch_code':{'$first':_0x50b3a4(0x2da)},'expiry_date':{'$first':_0x50b3a4(0x2ef)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x50b3a4(0x224)},'level':{'$addToSet':_0x50b3a4(0x2ab)},'isle':{'$addToSet':_0x50b3a4(0x28b)},'type':{'$addToSet':_0x50b3a4(0x245)},'floorlevel':{'$addToSet':_0x50b3a4(0x24d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x572ef0=await purchases_finished[_0x50b3a4(0x2b0)]([{'$unwind':_0x50b3a4(0x244)},{'$group':{'_id':_0x50b3a4(0x276),'invoice':{'$first':_0x50b3a4(0x2d1)},'suppliers':{'$first':_0x50b3a4(0x25a)},'date':{'$first':_0x50b3a4(0x1fe)},'warehouse_name':{'$first':_0x50b3a4(0x231)},'room':{'$addToSet':_0x50b3a4(0x223)},'product':{'$push':_0x50b3a4(0x244)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x50b3a4(0x2e3)},'due_amount':{'$first':_0x50b3a4(0x219)},'return_data':{'$first':_0x50b3a4(0x230)},'batch_code':{'$first':_0x50b3a4(0x2da)},'expiry_date':{'$first':_0x50b3a4(0x2ef)},'suppliers_docs':{'$first':_0x50b3a4(0x2d7)},'total_product_quantity':{'$sum':_0x50b3a4(0x224)},'level':{'$addToSet':_0x50b3a4(0x2ab)},'isle':{'$addToSet':_0x50b3a4(0x28b)},'type':{'$addToSet':_0x50b3a4(0x245)},'floorlevel':{'$addToSet':_0x50b3a4(0x24d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x554baf[0x0]['language']=='English\x20(US)')var _0x25e6dc=users[_0x50b3a4(0x22e)];else{if(_0x554baf[0x0][_0x50b3a4(0x255)]=='Hindi')var _0x25e6dc=users[_0x50b3a4(0x2f6)];else{if(_0x554baf[0x0]['language']==_0x50b3a4(0x22d))var _0x25e6dc=users['German'];else{if(_0x554baf[0x0][_0x50b3a4(0x255)]==_0x50b3a4(0x22f))var _0x25e6dc=users[_0x50b3a4(0x22f)];else{if(_0x554baf[0x0]['language']==_0x50b3a4(0x21d))var _0x25e6dc=users[_0x50b3a4(0x21d)];else{if(_0x554baf[0x0]['language']==_0x50b3a4(0x207))var _0x25e6dc=users['Portuguese'];else{if(_0x554baf[0x0]['language']==_0x50b3a4(0x2c0))var _0x25e6dc=users[_0x50b3a4(0x2c0)];else{if(_0x554baf[0x0]['language']==_0x50b3a4(0x260))var _0x25e6dc=users[_0x50b3a4(0x1fa)];}}}}}}}_0x31a65e[_0x50b3a4(0x2a3)](_0x50b3a4(0x248),{'success':_0x244715[_0x50b3a4(0x2ba)](_0x50b3a4(0x27a)),'errors':_0x244715[_0x50b3a4(0x2ba)](_0x50b3a4(0x2a8)),'purchases':_0x572ef0,'role':_0x6d7595,'profile':_0x577444,'master_shop':_0x554baf,'language':_0x25e6dc});}catch(_0x1512ea){console[_0x50b3a4(0x2d6)](_0x50b3a4(0x234),_0x1512ea),_0x31a65e[_0x50b3a4(0x286)](0xc8)[_0x50b3a4(0x2c3)]({'message':_0x1512ea[_0x50b3a4(0x2ec)]});}});function BayBinSelected(_0x2ca14e,_0x1d87a9){var _0x2c968f=a0_0x1030b8,_0x541d97=[],_0x430863=[];if(_0x2ca14e=='DRY\x20GOODS'){switch(_0x1d87a9){case'Rack\x201':_0x541d97=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x2c968f(0x21f):_0x541d97=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x430863=['DG'];}else{if(_0x2ca14e==_0x2c968f(0x2e1)){switch(_0x1d87a9){case _0x2c968f(0x20c):_0x541d97=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x2c968f(0x21f):_0x541d97=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x430863=['FG'];}}return{'levels':_0x541d97,'identify':_0x430863};}async function getRandom8DigitNumber(){var _0x3962f8=a0_0x1030b8;const _0x55d07d=0x989680,_0x3b00ee=0x5f5e0ff,_0x475a6a=Math['floor'](Math[_0x3962f8(0x2df)]()*(_0x3b00ee-_0x55d07d+0x1))+_0x55d07d;var _0x4cb662;const _0x7367c4=await purchases_finished[_0x3962f8(0x1f4)]({'invoice':_0x3962f8(0x2e7)+_0x475a6a});return _0x7367c4&&_0x7367c4[_0x3962f8(0x23c)]>0x0?_0x4cb662=_0x3962f8(0x2e7)+_0x475a6a:_0x4cb662='INCF-'+_0x475a6a,_0x4cb662;}router[a0_0x1030b8(0x2a0)](a0_0x1030b8(0x271),auth,async(_0x59549b,_0xc53b55)=>{var _0x145d78=a0_0x1030b8;try{const {username:_0x164e72,email:_0x1cbe02,role:_0x3fbfdc}=_0x59549b[_0x145d78(0x2d9)],_0x2f2b2d=_0x59549b[_0x145d78(0x2d9)],_0x34bd8f=await profile[_0x145d78(0x1f4)]({'email':_0x2f2b2d['email']}),_0x500108=await master_shop['find'](),_0x22df41=await staff[_0x145d78(0x1f4)]({'email':_0x2f2b2d['email']}),_0x460e4a=await suppliers['find']({});let _0x142fd4;if(_0x2f2b2d[_0x145d78(0x279)]==_0x145d78(0x2f5)){const _0x3c545e=await staff[_0x145d78(0x1f4)]({'email':_0x2f2b2d[_0x145d78(0x204)]});_0x142fd4=await warehouse[_0x145d78(0x2b0)]([{'$match':{'status':_0x145d78(0x26e),'name':_0x3c545e['warehouse'],'warehouse_category':_0x145d78(0x238)}},{'$group':{'_id':_0x145d78(0x274),'name':{'$first':_0x145d78(0x274)}}}]);}else _0x142fd4=await warehouse[_0x145d78(0x2b0)]([{'$match':{'status':_0x145d78(0x26e),'warehouse_category':_0x145d78(0x238),'name':{'$ne':_0x145d78(0x2a6)}}},{'$group':{'_id':_0x145d78(0x274),'name':{'$first':'$name'}}}]);const _0x1096ae=await product['find']({}),_0x453cdb=await warehouse[_0x145d78(0x2b4)]({'status':'Enabled'}),_0x4d9461=await purchases_finished[_0x145d78(0x2b4)]({}),_0x378ced=_0x4d9461[_0x145d78(0x23c)]+0x1,_0x572281=_0x145d78(0x2e7)+_0x378ced[_0x145d78(0x277)]()[_0x145d78(0x243)](0x5,'0');var _0x65d3b3=[_0x145d78(0x287),'Enclosed'];if(_0x500108[0x0][_0x145d78(0x255)]==_0x145d78(0x27d))var _0x1a88f9=users[_0x145d78(0x22e)];else{if(_0x500108[0x0]['language']==_0x145d78(0x2f6))var _0x1a88f9=users[_0x145d78(0x2f6)];else{if(_0x500108[0x0][_0x145d78(0x255)]==_0x145d78(0x22d))var _0x1a88f9=users['German'];else{if(_0x500108[0x0][_0x145d78(0x255)]==_0x145d78(0x22f))var _0x1a88f9=users[_0x145d78(0x22f)];else{if(_0x500108[0x0][_0x145d78(0x255)]==_0x145d78(0x21d))var _0x1a88f9=users[_0x145d78(0x21d)];else{if(_0x500108[0x0]['language']=='Portuguese\x20(BR)')var _0x1a88f9=users[_0x145d78(0x24b)];else{if(_0x500108[0x0][_0x145d78(0x255)]==_0x145d78(0x2c0))var _0x1a88f9=users[_0x145d78(0x2c0)];else{if(_0x500108[0x0][_0x145d78(0x255)]==_0x145d78(0x260))var _0x1a88f9=users['Arabic'];}}}}}}}const _0x47b74b=getRandom8DigitNumber();_0x47b74b['then'](_0x59c23e=>{var _0x1ff4a5=_0x145d78;_0xc53b55[_0x1ff4a5(0x2a3)](_0x1ff4a5(0x25d),{'success':_0x59549b[_0x1ff4a5(0x2ba)](_0x1ff4a5(0x27a)),'errors':_0x59549b[_0x1ff4a5(0x2ba)](_0x1ff4a5(0x2a8)),'role':_0x2f2b2d,'profile':_0x34bd8f,'suppliers':_0x460e4a,'warehouse':_0x142fd4,'product':_0x1096ae,'invoice':_0x59c23e,'master_shop':_0x500108,'language':_0x1a88f9,'find_data':_0x453cdb,'rooms_data':_0x65d3b3});})[_0x145d78(0x282)](_0x49ff4d=>{var _0x29c8cc=_0x145d78;_0x59549b[_0x29c8cc(0x2ba)](_0x29c8cc(0x2a8),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0xc53b55[_0x29c8cc(0x24e)](_0x29c8cc(0x1fc));});}catch(_0xbb9e57){console[_0x145d78(0x2d6)](_0xbb9e57);}}),router[a0_0x1030b8(0x2a0)]('/view/add_purchases/:id',auth,async(_0x13f0f8,_0x1a7ad0)=>{var _0x228ff0=a0_0x1030b8;try{const _0x3020e5=_0x13f0f8['params']['id'];console[_0x228ff0(0x2d6)](_0x3020e5);const _0x4e2472=await master_shop[_0x228ff0(0x2b4)]();console[_0x228ff0(0x2d6)](_0x228ff0(0x265),_0x4e2472);const _0x1cc2c7=await product[_0x228ff0(0x1f4)]({'name':_0x3020e5});console[_0x228ff0(0x2d6)](_0x228ff0(0x2b7),_0x1cc2c7),_0x1a7ad0[_0x228ff0(0x286)](0xc8)[_0x228ff0(0x2c3)]({'product_data':_0x1cc2c7,'master':_0x4e2472});}catch(_0x17e9ad){console['log'](_0x228ff0(0x2ac),_0x17e9ad);}}),router[a0_0x1030b8(0x226)](a0_0x1030b8(0x271),auth,async(_0x5918e2,_0x327ca6)=>{var _0x3db2c4=a0_0x1030b8;try{const {invoice:_0x16c3d4,date:_0x5d9d95,warehouse_name:_0x20ee5f,prod_name:_0x487812,prod_code:_0x2aaeb1,prod_qty:_0x1da26c,prod_unit:_0x5d6e61,prod_secondunit:_0x56be81,prod_level:_0xb22a1f,prod_isle:_0x7f2e8f,prod_pallet:_0x57bff4,note:_0x201ecd,expiry_date:_0x4b5dd2,batch_code:_0x2fdf93,payable:_0x2f1334,due_amount:_0x1d9dd7,Room_name:_0x1769de,primary_code:_0x4c4ac3,secondary_code:_0x48a6e7,MaxStocks_data:_0x53b295,PO_number:_0x4c36a0,SCRN:_0x3a6a14,JO_number:_0x199d41}=_0x5918e2[_0x3db2c4(0x2a5)];if(typeof _0x487812==_0x3db2c4(0x24f))var _0x5f48a2=[_0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x267)]],_0x1bb941=[_0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x26f)]],_0x56d9b9=[_0x5918e2[_0x3db2c4(0x2a5)]['prod_Qty']],_0x28b177=[_0x5918e2[_0x3db2c4(0x2a5)]['prod_primunit']],_0x4b796c=[_0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x235)]],_0x5a00ef=[_0x5918e2[_0x3db2c4(0x2a5)]['prod_level']],_0x54db90=[_0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x2a2)]],_0x4a6476=[_0x5918e2['body'][_0x3db2c4(0x283)]],_0x5f4bc8=[_0x5918e2[_0x3db2c4(0x2a5)]['MaxStocks_data']],_0x277e1c=[_0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x214)]],_0x40f243=[_0x5918e2['body']['expiry_date']],_0x13b9a1=[_0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x2f2)]],_0x271fdd=[_0x5918e2['body'][_0x3db2c4(0x20e)]],_0x4eaf21=[_0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x2bc)]],_0x10c6f9=[_0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x2a1)]],_0x4dd4e3=[_0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x290)]];else var _0x5f48a2=[..._0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x267)]],_0x1bb941=[..._0x5918e2[_0x3db2c4(0x2a5)]['prod_code']],_0x56d9b9=[..._0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x25c)]],_0x28b177=[..._0x5918e2['body'][_0x3db2c4(0x20b)]],_0x4b796c=[..._0x5918e2[_0x3db2c4(0x2a5)]['prod_secondunit']],_0x5a00ef=[..._0x5918e2['body'][_0x3db2c4(0x2bf)]],_0x54db90=[..._0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x2a2)]],_0x4a6476=[..._0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x283)]],_0x5f4bc8=[..._0x5918e2[_0x3db2c4(0x2a5)]['MaxStocks_data']],_0x277e1c=[..._0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x214)]],_0x40f243=[..._0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x2f0)]],_0x13b9a1=[..._0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x2f2)]],_0x271fdd=[..._0x5918e2[_0x3db2c4(0x2a5)]['max_product_unit']],_0x4eaf21=[..._0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x2bc)]],_0x10c6f9=[..._0x5918e2['body']['RoomAssign']],_0x4dd4e3=[..._0x5918e2[_0x3db2c4(0x2a5)][_0x3db2c4(0x290)]];const _0xe44b67=_0x5f48a2[_0x3db2c4(0x251)](_0x28f929=>{return _0x28f929={'product_name':_0x28f929};});_0x1bb941[_0x3db2c4(0x264)]((_0x484aea,_0x114e65)=>{var _0x8924cc=_0x3db2c4;_0xe44b67[_0x114e65][_0x8924cc(0x29b)]=_0x484aea;}),_0x56d9b9[_0x3db2c4(0x264)]((_0x1a12d3,_0x507f4a)=>{_0xe44b67[_0x507f4a]['quantity']=Math['abs'](_0x1a12d3);}),_0x28b177[_0x3db2c4(0x264)]((_0xbc8e7f,_0x239f3d)=>{var _0x3d29a6=_0x3db2c4;_0xe44b67[_0x239f3d][_0x3d29a6(0x278)]=_0xbc8e7f;}),_0x4b796c[_0x3db2c4(0x264)]((_0x43ff5d,_0x313db6)=>{_0xe44b67[_0x313db6]['secondary_unit']=_0x43ff5d;}),_0x5a00ef['forEach']((_0x292cde,_0x532777)=>{_0xe44b67[_0x532777]['bay']=_0x292cde;}),_0x54db90['forEach']((_0x1a6703,_0x332b06)=>{var _0x47d8d6=_0x3db2c4;_0xe44b67[_0x332b06][_0x47d8d6(0x2a2)]=_0x1a6703;}),_0x4a6476[_0x3db2c4(0x264)]((_0x44422a,_0x18fb86)=>{var _0x3d8468=_0x3db2c4;_0xe44b67[_0x18fb86][_0x3d8468(0x283)]=_0x44422a;}),_0x5f4bc8['forEach']((_0x5cebc5,_0x15564f)=>{var _0x5408ab=_0x3db2c4;_0xe44b67[_0x15564f][_0x5408ab(0x263)]=_0x5cebc5;}),_0x277e1c[_0x3db2c4(0x264)]((_0x21bb0f,_0x3af5e3)=>{var _0x455336=_0x3db2c4;_0xe44b67[_0x3af5e3][_0x455336(0x214)]=_0x21bb0f;}),_0x40f243[_0x3db2c4(0x264)]((_0x4d38b4,_0x3f6172)=>{var _0x1a5864=_0x3db2c4;_0xe44b67[_0x3f6172][_0x1a5864(0x2f0)]=_0x4d38b4;}),_0x13b9a1[_0x3db2c4(0x264)]((_0x4c3f01,_0x4550ca)=>{_0xe44b67[_0x4550ca]['production_date']=_0x4c3f01;}),_0x271fdd['forEach']((_0x5f3901,_0x295fd0)=>{var _0x2c8e35=_0x3db2c4;_0xe44b67[_0x295fd0][_0x2c8e35(0x29a)]=_0x5f3901;}),_0x4eaf21[_0x3db2c4(0x264)]((_0x5ac507,_0x3012dd)=>{var _0x42a82d=_0x3db2c4;_0xe44b67[_0x3012dd][_0x42a82d(0x2cb)]=_0x5ac507;}),_0x10c6f9[_0x3db2c4(0x264)]((_0x4c75e1,_0x5e9315)=>{var _0x5c411d=_0x3db2c4;_0xe44b67[_0x5e9315][_0x5c411d(0x2ae)]=_0x4c75e1;}),_0x4dd4e3[_0x3db2c4(0x264)]((_0x48afbd,_0xfb09e5)=>{var _0x54a4b0=_0x3db2c4;_0xe44b67[_0xfb09e5][_0x54a4b0(0x295)]=_0x48afbd;});const _0x3d8a4c=_0xe44b67[_0x3db2c4(0x296)](_0x17691f=>_0x17691f[_0x3db2c4(0x2f1)]!=='0'&&_0x17691f[_0x3db2c4(0x2f1)]!==''),_0x59b33e=new purchases_finished({'invoice':_0x16c3d4,'suppliers':_0x5918e2['body'][_0x3db2c4(0x22c)],'date':_0x5d9d95,'warehouse_name':_0x20ee5f,'product':_0x3d8a4c,'note':_0x201ecd,'due_amount':_0x1d9dd7,'room':_0x1769de,'POnumber':_0x4c36a0,'SCRN':_0x3a6a14,'JO_number':_0x199d41}),_0x4dab7c=await _0x59b33e[_0x3db2c4(0x2bb)](),_0x525ffe=await purchases_finished['findOne']({'invoice':_0x16c3d4}),_0x408e76=_0x525ffe[_0x3db2c4(0x2b7)]['map'](async _0x4b5594=>{var _0x52806b=_0x3db2c4;try{var _0x19c578=await warehouse['findOne']({'name':_0x20ee5f,'room':_0x4b5594['room_name']}),_0x244fb3=0x0;const _0x403933=_0x19c578[_0x52806b(0x228)][_0x52806b(0x251)](_0x4fcfc7=>{var _0x29cf99=_0x52806b;console[_0x29cf99(0x2d6)](_0x4fcfc7[_0x29cf99(0x29f)]+'=='+_0x4b5594[_0x29cf99(0x29f)]+'&&'+_0x4fcfc7[_0x29cf99(0x24c)]+'=='+_0x4b5594[_0x29cf99(0x24c)]+'&&'+_0x4fcfc7['expiry_date']+'=='+_0x4b5594[_0x29cf99(0x2f0)]+'&&'+_0x4fcfc7[_0x29cf99(0x280)]+'=='+_0x4b5594[_0x29cf99(0x280)]+'&&'+_0x4fcfc7[_0x29cf99(0x214)]+'=='+_0x4b5594[_0x29cf99(0x214)]+'&&'+_0x4fcfc7['invoice']+'=='+_0x525ffe[_0x29cf99(0x295)]),_0x4fcfc7[_0x29cf99(0x29f)]==_0x4b5594[_0x29cf99(0x29f)]&&_0x4fcfc7['bay']==_0x4b5594['bay']&&_0x4fcfc7[_0x29cf99(0x2f0)]==_0x4b5594['expiry_date']&&_0x4fcfc7[_0x29cf99(0x280)]==_0x4b5594[_0x29cf99(0x280)]&&_0x4fcfc7[_0x29cf99(0x214)]==_0x4b5594[_0x29cf99(0x214)]&&_0x4fcfc7[_0x29cf99(0x295)]==_0x525ffe[_0x29cf99(0x295)]&&(_0x4fcfc7['product_stock']=Math[_0x29cf99(0x28a)](_0x4fcfc7[_0x29cf99(0x2e8)])+Math[_0x29cf99(0x28a)](_0x4b5594[_0x29cf99(0x2f1)]),_0x244fb3++);});return _0x244fb3==0x0&&(_0x19c578[_0x52806b(0x228)]=_0x19c578['product_details'][_0x52806b(0x201)]({'product_name':_0x4b5594[_0x52806b(0x29f)],'product_stock':Math[_0x52806b(0x28a)](_0x4b5594[_0x52806b(0x2f1)]),'primary_code':_0x4b5594[_0x52806b(0x2a2)],'secondary_code':_0x4b5594[_0x52806b(0x283)],'product_code':_0x4b5594[_0x52806b(0x29b)],'bay':_0x4b5594[_0x52806b(0x24c)],'maxProducts':_0x4b5594['maxStocks'],'unit':_0x4b5594[_0x52806b(0x278)],'secondary_unit':_0x4b5594[_0x52806b(0x270)],'expiry_date':_0x4b5594[_0x52806b(0x2f0)],'production_date':_0x4b5594[_0x52806b(0x280)],'maxProducts':_0x4b5594['maxStocks'],'maxPerUnit':_0x4b5594[_0x52806b(0x29a)],'batch_code':_0x4b5594['batch_code'],'product_cat':_0x4b5594[_0x52806b(0x2cb)],'invoice':_0x4b5594[_0x52806b(0x295)],'id_incoming':_0x4b5594[_0x52806b(0x28f)]})),_0x19c578;}catch(_0x447654){return console[_0x52806b(0x27b)](_0x52806b(0x289),_0x447654),null;}});Promise[_0x3db2c4(0x275)](_0x408e76)[_0x3db2c4(0x29c)](async _0x1127c2=>{var _0x31b41b=_0x3db2c4;try{for(const _0x1f2949 of _0x1127c2){await warehouse[_0x31b41b(0x258)]({'_id':_0x1f2949[_0x31b41b(0x28f)]},{'$addToSet':{'product_details':{'$each':_0x1f2949['product_details']}}});}const _0x4cab7c=await master_shop['find'](),_0x32cadc=await email_settings[_0x31b41b(0x1f4)](),_0x34f12e=await supervisor_settings['find']();var _0x57ef21=_0x525ffe[_0x31b41b(0x2b7)],_0x43f420='',_0x338e48;for(_0x338e48 in _0x57ef21){var _0x1431a4='FG';_0x525ffe[_0x31b41b(0x1f8)]=='DRY\x20GOODS'&&(_0x1431a4='DG'),_0x43f420+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57ef21[_0x338e48]['product_name']+_0x31b41b(0x2aa)+_0x31b41b(0x2ce)+_0x57ef21[_0x338e48][_0x31b41b(0x29b)]+'</td>'+_0x31b41b(0x2ce)+_0x57ef21[_0x338e48][_0x31b41b(0x2f1)]+_0x31b41b(0x2aa)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57ef21[_0x338e48][_0x31b41b(0x278)]+_0x31b41b(0x2aa)+_0x31b41b(0x2ce)+_0x57ef21[_0x338e48]['secondary_unit']+_0x31b41b(0x2aa)+_0x31b41b(0x2ce)+_0x525ffe[_0x31b41b(0x1f8)]+_0x31b41b(0x2aa)+_0x31b41b(0x2ce)+_0x57ef21[_0x338e48][_0x31b41b(0x2ae)]+_0x31b41b(0x2aa)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1431a4+_0x57ef21[_0x338e48][_0x31b41b(0x24c)]+_0x31b41b(0x2aa),_0x31b41b(0x27f);}let _0x222abb=nodemailer['createTransport']({'host':_0x32cadc[_0x31b41b(0x2d3)],'port':Number(_0x32cadc['port']),'secure':![],'auth':{'user':_0x32cadc['email'],'pass':_0x32cadc[_0x31b41b(0x208)]}}),_0xf8bc45={'from':_0x32cadc[_0x31b41b(0x204)],'to':_0x34f12e[0x0]['FGSEmail'],'subject':_0x31b41b(0x2e2),'attachments':[{'filename':_0x31b41b(0x2ea),'path':__dirname+_0x31b41b(0x24a)+'/upload/'+_0x4cab7c[0x0][_0x31b41b(0x2d5)],'cid':_0x31b41b(0x210)}],'html':'<!DOCTYPE\x20html>'+_0x31b41b(0x268)+_0x31b41b(0x2c4)+_0x31b41b(0x211)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x31b41b(0x211)+_0x31b41b(0x2b2)+_0x31b41b(0x203)+_0x31b41b(0x211)+'<h2>\x20'+_0x4cab7c[0x0][_0x31b41b(0x1f9)]+_0x31b41b(0x20d)+_0x31b41b(0x203)+_0x31b41b(0x203)+'<hr\x20class=\x22my-3\x22>'+_0x31b41b(0x211)+_0x31b41b(0x2f4)+_0x31b41b(0x29d)+_0x525ffe['invoice']+'\x20'+_0x31b41b(0x259)+_0x31b41b(0x25f)+_0x525ffe[_0x31b41b(0x2d2)]+'\x20'+_0x31b41b(0x2a4)+_0x31b41b(0x23f)+_0x31b41b(0x203)+_0x31b41b(0x2e6)+_0x31b41b(0x233)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x31b41b(0x2db)+_0x31b41b(0x2c5)+_0x31b41b(0x2de)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x31b41b(0x218)+_0x31b41b(0x2cf)+_0x31b41b(0x28e)+_0x31b41b(0x27f)+_0x31b41b(0x209)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x43f420+'\x20'+_0x31b41b(0x21b)+'</table>'+'<div>'+_0x31b41b(0x2be)+_0x31b41b(0x294)+_0x4cab7c[0x0]['site_title']+'</h5>'+_0x31b41b(0x203)+_0x31b41b(0x203)+_0x31b41b(0x26a)};_0x222abb[_0x31b41b(0x23d)](_0xf8bc45,function(_0x11cbc9,_0x413eef){var _0xdd7bdc=_0x31b41b;_0x11cbc9?(console[_0xdd7bdc(0x2d6)](_0x11cbc9),console[_0xdd7bdc(0x2d6)]('Error\x20Occurs')):console[_0xdd7bdc(0x2d6)](_0xdd7bdc(0x253));});}catch(_0x4e1c32){console['error'](_0x4e1c32),_0x327ca6[_0x31b41b(0x286)](0x1f4)[_0x31b41b(0x2c3)]({'error':_0x31b41b(0x21c),'message':_0x4e1c32[_0x31b41b(0x2ec)]});}})['catch'](_0x195f26=>{var _0x31a40e=_0x3db2c4;console[_0x31a40e(0x27b)](_0x195f26);}),_0x5918e2[_0x3db2c4(0x2ba)]('success','purchase\x20data\x20add\x20successfully'),_0x327ca6[_0x3db2c4(0x24e)](_0x3db2c4(0x1fc));}catch(_0x69fd9d){console[_0x3db2c4(0x2d6)](_0x69fd9d);}}),router[a0_0x1030b8(0x2a0)](a0_0x1030b8(0x292),auth,async(_0x3e3906,_0x37288b)=>{var _0x1b615a=a0_0x1030b8;try{const {username:_0x1c8769,email:_0x45c24e,role:_0x4a9bc6}=_0x3e3906[_0x1b615a(0x2d9)],_0xa4a146=_0x3e3906[_0x1b615a(0x2d9)],_0x3e0f8b=await profile[_0x1b615a(0x1f4)]({'email':_0xa4a146[_0x1b615a(0x204)]}),_0x2464d1=await master_shop[_0x1b615a(0x2b4)](),_0x295112=_0x3e3906['params']['id'],_0x5416f3=await purchases_finished[_0x1b615a(0x249)](_0x295112),_0x2e5c22=await suppliers[_0x1b615a(0x2b4)]({});let _0x40b575;if(_0xa4a146[_0x1b615a(0x279)]==_0x1b615a(0x2f5)){const _0x12fd6b=await staff['findOne']({'email':_0xa4a146[_0x1b615a(0x204)]});_0x40b575=await warehouse['find']({'status':_0x1b615a(0x26e),'name':_0x12fd6b[_0x1b615a(0x2c9)],'warehouse_category':_0x1b615a(0x238)});}else _0x40b575=await warehouse[_0x1b615a(0x2b0)]([{'$match':{'status':_0x1b615a(0x26e),'warehouse_category':_0x1b615a(0x238)}},{'$group':{'_id':_0x1b615a(0x274),'name':{'$first':_0x1b615a(0x274)}}}]);const _0x324cfe=await product['find']({}),_0x2e1765=BayBinSelected(_0x5416f3[_0x1b615a(0x1f8)],_0x5416f3['room']);let _0x472fa8=new Date(_0x5416f3['expiry_date']),_0x69864e=('0'+_0x472fa8['getDate']())[_0x1b615a(0x1fd)](-0x2),_0x4b8703=('0'+(_0x472fa8[_0x1b615a(0x2b9)]()+0x1))['slice'](-0x2),_0x576633=_0x472fa8[_0x1b615a(0x1f7)](),_0x4e3425=_0x576633+'-'+_0x4b8703+'-'+_0x69864e;if(_0x2464d1[0x0]['language']==_0x1b615a(0x27d)){var _0x59512c=users[_0x1b615a(0x22e)];console[_0x1b615a(0x2d6)](_0x59512c);}else{if(_0x2464d1[0x0]['language']==_0x1b615a(0x2f6))var _0x59512c=users[_0x1b615a(0x2f6)];else{if(_0x2464d1[0x0]['language']==_0x1b615a(0x22d))var _0x59512c=users['German'];else{if(_0x2464d1[0x0][_0x1b615a(0x255)]==_0x1b615a(0x22f))var _0x59512c=users[_0x1b615a(0x22f)];else{if(_0x2464d1[0x0]['language']=='French')var _0x59512c=users[_0x1b615a(0x21d)];else{if(_0x2464d1[0x0][_0x1b615a(0x255)]==_0x1b615a(0x207))var _0x59512c=users['Portuguese'];else{if(_0x2464d1[0x0][_0x1b615a(0x255)]==_0x1b615a(0x2c0))var _0x59512c=users[_0x1b615a(0x2c0)];else{if(_0x2464d1[0x0][_0x1b615a(0x255)]=='Arabic\x20(ae)')var _0x59512c=users[_0x1b615a(0x1fa)];}}}}}}}_0x37288b[_0x1b615a(0x2a3)]('edit_purchases_finished_view',{'success':_0x3e3906[_0x1b615a(0x2ba)](_0x1b615a(0x27a)),'errors':_0x3e3906['flash'](_0x1b615a(0x2a8)),'role':_0xa4a146,'profile':_0x3e0f8b,'purchases':_0x5416f3,'suppliers':_0x2e5c22,'warehouse':_0x40b575,'product':_0x324cfe,'master_shop':_0x2464d1,'language':_0x59512c,'ed_fullDate':_0x4e3425,'dataSelected':_0x2e1765});}catch(_0x709ca4){console['log'](_0x709ca4);}}),router[a0_0x1030b8(0x2a0)]('/view/:id',auth,async(_0x11b2da,_0x54bfc7)=>{var _0x48cef9=a0_0x1030b8;try{const {username:_0x2b4460,email:_0x3e134d,role:_0x3b2b25}=_0x11b2da[_0x48cef9(0x2d9)],_0x271e58=_0x11b2da[_0x48cef9(0x2d9)],_0x515c37=await profile[_0x48cef9(0x1f4)]({'email':_0x271e58[_0x48cef9(0x204)]}),_0x33bfb6=await master_shop[_0x48cef9(0x2b4)](),_0x2386a4=_0x11b2da[_0x48cef9(0x1f6)]['id'],_0x1a7ee8=await purchases_finished['findById'](_0x2386a4),_0x5dedfb=await suppliers['find']({});let _0x286d1e;if(_0x271e58['role']==_0x48cef9(0x2f5)){const _0x2c19fd=await staff[_0x48cef9(0x1f4)]({'email':_0x271e58[_0x48cef9(0x204)]});_0x286d1e=await warehouse['find']({'status':'Enabled','name':_0x2c19fd[_0x48cef9(0x2c9)],'warehouse_category':_0x48cef9(0x238)});}else _0x286d1e=await warehouse['aggregate']([{'$match':{'status':_0x48cef9(0x26e),'warehouse_category':_0x48cef9(0x238)}},{'$group':{'_id':_0x48cef9(0x274),'name':{'$first':_0x48cef9(0x274)}}}]);const _0x30d00e=await product[_0x48cef9(0x2b4)]({}),_0x13bb29=BayBinSelected(_0x1a7ee8[_0x48cef9(0x1f8)],_0x1a7ee8[_0x48cef9(0x246)]);let _0x579bc2=new Date(_0x1a7ee8[_0x48cef9(0x2f0)]),_0x583eb6=('0'+_0x579bc2[_0x48cef9(0x2e4)]())[_0x48cef9(0x1fd)](-0x2),_0x514f32=('0'+(_0x579bc2[_0x48cef9(0x2b9)]()+0x1))[_0x48cef9(0x1fd)](-0x2),_0x585f0e=_0x579bc2[_0x48cef9(0x1f7)](),_0x21807d=_0x585f0e+'-'+_0x514f32+'-'+_0x583eb6;if(_0x33bfb6[0x0][_0x48cef9(0x255)]==_0x48cef9(0x27d)){var _0xa48e3d=users[_0x48cef9(0x22e)];console[_0x48cef9(0x2d6)](_0xa48e3d);}else{if(_0x33bfb6[0x0]['language']==_0x48cef9(0x2f6))var _0xa48e3d=users[_0x48cef9(0x2f6)];else{if(_0x33bfb6[0x0][_0x48cef9(0x255)]==_0x48cef9(0x22d))var _0xa48e3d=users[_0x48cef9(0x22d)];else{if(_0x33bfb6[0x0][_0x48cef9(0x255)]==_0x48cef9(0x22f))var _0xa48e3d=users['Spanish'];else{if(_0x33bfb6[0x0][_0x48cef9(0x255)]=='French')var _0xa48e3d=users['French'];else{if(_0x33bfb6[0x0][_0x48cef9(0x255)]==_0x48cef9(0x207))var _0xa48e3d=users[_0x48cef9(0x24b)];else{if(_0x33bfb6[0x0][_0x48cef9(0x255)]==_0x48cef9(0x2c0))var _0xa48e3d=users[_0x48cef9(0x2c0)];else{if(_0x33bfb6[0x0][_0x48cef9(0x255)]==_0x48cef9(0x260))var _0xa48e3d=users[_0x48cef9(0x1fa)];}}}}}}}_0x54bfc7[_0x48cef9(0x2a3)]('edit_purchases_finished',{'success':_0x11b2da[_0x48cef9(0x2ba)](_0x48cef9(0x27a)),'errors':_0x11b2da[_0x48cef9(0x2ba)](_0x48cef9(0x2a8)),'role':_0x271e58,'profile':_0x515c37,'purchases':_0x1a7ee8,'suppliers':_0x5dedfb,'warehouse':_0x286d1e,'product':_0x30d00e,'master_shop':_0x33bfb6,'language':_0xa48e3d,'ed_fullDate':_0x21807d,'dataSelected':_0x13bb29});}catch(_0x12f9e){console[_0x48cef9(0x2d6)](_0x12f9e);}}),router['post'](a0_0x1030b8(0x2dc),auth,async(_0x202da8,_0xb560d5)=>{var _0x2d43cb=a0_0x1030b8;try{const _0x1480f8=_0x202da8[_0x2d43cb(0x1f6)]['id'],_0x33f5d5=await purchases_finished[_0x2d43cb(0x1f4)]({'_id':_0x202da8[_0x2d43cb(0x1f6)]['id']}),_0xc99963=await warehouse['findOne']({'name':_0x33f5d5[_0x2d43cb(0x1f8)],'room':_0x33f5d5[_0x2d43cb(0x246)]});_0x33f5d5['product'][_0x2d43cb(0x264)](_0x58e57c=>{var _0xaf1c6f=_0x2d43cb;const _0x12b073=_0xc99963[_0xaf1c6f(0x228)][_0xaf1c6f(0x251)](_0x5da55e=>{var _0x3dcc65=_0xaf1c6f;_0x5da55e[_0x3dcc65(0x29f)]==_0x58e57c['product_name']&&_0x5da55e[_0x3dcc65(0x24c)]==_0x58e57c[_0x3dcc65(0x24c)]&&(_0x5da55e['product_stock']=parseInt(_0x5da55e[_0x3dcc65(0x2e8)])-parseInt(_0x58e57c['quantity']));});}),await _0xc99963[_0x2d43cb(0x2bb)]();const {invoice:_0x59875e,suppliers:_0x3dbe28,date:_0x48f277,warehouse_name:_0xd40cb1,prod_name:_0x590e42,prod_code:_0x7a3b84,prod_qty:_0x580743,prod_unit:_0x534872,prod_secondunit:_0x2643d5,prod_level:_0x39de8c,prod_isle:_0x582091,prod_pallet:_0x2f1433,note:_0xa542a8,expiry_date:_0x797fa3,batch_code:_0x5141a5,paid_amount:_0x37df30,due_amount:_0x24bf22,Room_name:_0x41c8d3,primary_code:_0x3adc2e,secondary_code:_0x540d7c,PO_number:_0x5927d2,JO_number:_0x4f5f00}=_0x202da8[_0x2d43cb(0x2a5)];if(typeof _0x590e42==_0x2d43cb(0x24f))var _0xf9adee=[_0x202da8[_0x2d43cb(0x2a5)]['prod_name']],_0x5c1cff=[_0x202da8['body'][_0x2d43cb(0x26f)]],_0x405001=[_0x202da8['body']['prod_qty']],_0x3fa713=[_0x202da8[_0x2d43cb(0x2a5)]['prod_unit']],_0x5f39e6=[_0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x235)]],_0x5874e0=[_0x202da8[_0x2d43cb(0x2a5)]['prod_level']],_0x298e99=[_0x202da8[_0x2d43cb(0x2a5)]['primary_code']],_0x36d2f7=[_0x202da8['body'][_0x2d43cb(0x283)]],_0x4d2807=[_0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x272)]],_0x206aec=[_0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x214)]],_0x96b7dc=[_0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x2f0)]];else var _0xf9adee=[..._0x202da8['body']['prod_name']],_0x5c1cff=[..._0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x26f)]],_0x405001=[..._0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x2c7)]],_0x3fa713=[..._0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x2c1)]],_0x5f39e6=[..._0x202da8[_0x2d43cb(0x2a5)]['prod_secondunit']],_0x5874e0=[..._0x202da8[_0x2d43cb(0x2a5)]['prod_level']],_0x298e99=[..._0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x2a2)]],_0x36d2f7=[..._0x202da8['body']['secondary_code']],_0x4d2807=[..._0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x272)]],_0x206aec=[..._0x202da8[_0x2d43cb(0x2a5)]['batch_code']],_0x96b7dc=[..._0x202da8['body'][_0x2d43cb(0x2f0)]];const _0x129e7f=_0xf9adee[_0x2d43cb(0x251)](_0x50e598=>{return _0x50e598={'product_name':_0x50e598};});_0x5c1cff[_0x2d43cb(0x264)]((_0x2f86fa,_0x131256)=>{var _0x1ec57c=_0x2d43cb;_0x129e7f[_0x131256][_0x1ec57c(0x29b)]=_0x2f86fa;}),_0x405001[_0x2d43cb(0x264)]((_0x3d9774,_0x147bc8)=>{_0x129e7f[_0x147bc8]['quantity']=_0x3d9774;}),_0x3fa713[_0x2d43cb(0x264)]((_0x2c35cf,_0x5e6d1d)=>{var _0x27cd47=_0x2d43cb;_0x129e7f[_0x5e6d1d][_0x27cd47(0x278)]=_0x2c35cf;}),_0x5f39e6[_0x2d43cb(0x264)]((_0xbcd74a,_0x358f62)=>{var _0x39213d=_0x2d43cb;_0x129e7f[_0x358f62][_0x39213d(0x270)]=_0xbcd74a;}),_0x5874e0[_0x2d43cb(0x264)]((_0x330c8d,_0x4d8cb9)=>{var _0xdccbf6=_0x2d43cb;_0x129e7f[_0x4d8cb9][_0xdccbf6(0x24c)]=_0x330c8d;}),_0x298e99[_0x2d43cb(0x264)]((_0x3787a5,_0x2480e1)=>{var _0x54a490=_0x2d43cb;_0x129e7f[_0x2480e1][_0x54a490(0x2a2)]=_0x3787a5;}),_0x36d2f7[_0x2d43cb(0x264)]((_0x3199c2,_0x104906)=>{var _0x5cb5be=_0x2d43cb;_0x129e7f[_0x104906][_0x5cb5be(0x283)]=_0x3199c2;}),_0x4d2807[_0x2d43cb(0x264)]((_0x591de4,_0x401a7d)=>{var _0x9d95c8=_0x2d43cb;_0x129e7f[_0x401a7d][_0x9d95c8(0x263)]=_0x591de4;}),_0x206aec[_0x2d43cb(0x264)]((_0x2a31cd,_0x5a4096)=>{var _0x103f00=_0x2d43cb;_0x129e7f[_0x5a4096][_0x103f00(0x214)]=_0x2a31cd;}),_0x96b7dc['forEach']((_0x46aaaa,_0x1b423d)=>{_0x129e7f[_0x1b423d]['expiry_date']=_0x46aaaa;});const _0x1d8f9c=_0x129e7f[_0x2d43cb(0x296)](_0x52c8b1=>_0x52c8b1[_0x2d43cb(0x2f1)]!=='0'&&_0x52c8b1[_0x2d43cb(0x2f1)]!=='');_0x33f5d5[_0x2d43cb(0x295)]=_0x59875e,_0x33f5d5[_0x2d43cb(0x22c)]=_0x3dbe28,_0x33f5d5[_0x2d43cb(0x2d2)]=_0x48f277,_0x33f5d5[_0x2d43cb(0x1f8)]=_0xd40cb1,_0x33f5d5[_0x2d43cb(0x2b7)]=_0x1d8f9c,_0x33f5d5[_0x2d43cb(0x216)]=_0xa542a8,_0x33f5d5[_0x2d43cb(0x299)]=_0x37df30,_0x33f5d5[_0x2d43cb(0x2ad)]=_0x24bf22,_0x33f5d5[_0x2d43cb(0x246)]=_0x41c8d3,_0x33f5d5[_0x2d43cb(0x21a)]=_0x5927d2,_0x33f5d5['JO_number']=_0x4f5f00;const _0x22463e=await _0x33f5d5['save'](),_0x32bb4a=await warehouse[_0x2d43cb(0x1f4)]({'name':_0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x1f8)],'room':_0x202da8['body'][_0x2d43cb(0x1ff)]});_0x33f5d5[_0x2d43cb(0x2b7)][_0x2d43cb(0x264)](_0x25c678=>{var _0x48a3b9=_0x2d43cb,_0x12dbf8=0x0;const _0x3f28e3=_0x32bb4a[_0x48a3b9(0x228)]['map'](_0x5cc416=>{var _0x39138f=_0x48a3b9;_0x5cc416[_0x39138f(0x29f)]==_0x25c678[_0x39138f(0x29f)]&&_0x5cc416[_0x39138f(0x24c)]==_0x25c678[_0x39138f(0x24c)]&&(_0x5cc416[_0x39138f(0x2e8)]=parseInt(_0x5cc416['product_stock'])+parseInt(_0x25c678['quantity']),_0x12dbf8++);});_0x12dbf8=='0'&&(_0x32bb4a[_0x48a3b9(0x228)]=_0x32bb4a['product_details'][_0x48a3b9(0x201)]({'product_name':_0x25c678['product_name'],'product_stock':_0x25c678[_0x48a3b9(0x2f1)],'primary_code':_0x25c678[_0x48a3b9(0x2a2)],'secondary_code':_0x25c678[_0x48a3b9(0x283)],'product_code':_0x25c678['product_code'],'bay':_0x25c678['bay'],'maxProducts':_0x25c678[_0x48a3b9(0x263)],'unit':_0x25c678[_0x48a3b9(0x278)],'secondary_unit':_0x25c678['secondary_unit'],'expiry_date':_0x25c678['expiry_date']}));}),await _0x32bb4a[_0x2d43cb(0x2bb)]();const _0x514ffb=await s_payment_data['findOne']({'invoice':_0x202da8[_0x2d43cb(0x2a5)]['invoice']});if(_0x514ffb===null){}else console[_0x2d43cb(0x2d6)](_0x2d43cb(0x22c),_0x514ffb,_0x202da8['body']['invoice']),_0x514ffb[_0x2d43cb(0x22c)]=_0x202da8[_0x2d43cb(0x2a5)][_0x2d43cb(0x22c)],await _0x514ffb['save']();_0x202da8['flash'](_0x2d43cb(0x27a),_0x2d43cb(0x225)),_0xb560d5['redirect'](_0x2d43cb(0x1fc));}catch(_0x50b266){console[_0x2d43cb(0x2d6)](_0x50b266);}}),router[a0_0x1030b8(0x226)](a0_0x1030b8(0x2ed),auth,async(_0x321bc3,_0xbd8220)=>{var _0x53152c=a0_0x1030b8;try{const _0xca9feb=_0x321bc3[_0x53152c(0x1f6)]['id'],{invoice:_0x4d0840,suppliers:_0x39b33e,payable:_0x1a7d0c,due_amount:_0x49a012}=_0x321bc3[_0x53152c(0x2a5)],_0x501c4f=await purchases[_0x53152c(0x249)](_0xca9feb);var _0x3c59de=_0x1a7d0c-_0x49a012;_0x501c4f[_0x53152c(0x299)]=parseFloat(_0x501c4f[_0x53152c(0x299)])+parseFloat(_0x49a012),_0x501c4f['due_amount']=_0x3c59de;const _0x1383f4=await _0x501c4f[_0x53152c(0x2bb)]();console[_0x53152c(0x2d6)](_0x1383f4);const _0x42ad47=await s_payment_data[_0x53152c(0x1f4)]({'invoice':_0x4d0840});_0x42ad47[_0x53152c(0x26d)]=_0x3c59de,await _0x42ad47[_0x53152c(0x2bb)]();let _0x1cd036=new Date(),_0x4cc0d6=('0'+_0x1cd036[_0x53152c(0x2e4)]())[_0x53152c(0x1fd)](-0x2),_0x376bdd=('0'+(_0x1cd036[_0x53152c(0x2b9)]()+0x1))[_0x53152c(0x1fd)](-0x2),_0x3720ff=_0x1cd036[_0x53152c(0x1f7)](),_0x201877=_0x3720ff+'-'+_0x376bdd+'-'+_0x4cc0d6;const _0x125105=new suppliers_payment({'invoice':_0x4d0840,'date':_0x3720ff+'-'+_0x376bdd+'-'+_0x4cc0d6,'suppliers':_0x39b33e,'reason':'Paid\x20For\x20Purchase','amount':_0x49a012}),_0x536b89=await _0x125105[_0x53152c(0x2bb)]();_0x321bc3[_0x53152c(0x2ba)]('success',_0x53152c(0x2eb)),_0xbd8220[_0x53152c(0x24e)](_0x53152c(0x26c));}catch(_0x33de49){console[_0x53152c(0x2d6)](_0x33de49);}}),router[a0_0x1030b8(0x2a0)](a0_0x1030b8(0x26b),auth,async(_0x43d24c,_0x20e7d4)=>{var _0x2b62e4=a0_0x1030b8;try{const {username:_0x24456e,email:_0x4c3cb8,role:_0xd70603}=_0x43d24c[_0x2b62e4(0x2d9)],_0x366f63=_0x43d24c['user'],_0x16a14b=await profile[_0x2b62e4(0x1f4)]({'email':_0x366f63[_0x2b62e4(0x204)]}),_0x48139e=await master_shop['find']();console[_0x2b62e4(0x2d6)](_0x2b62e4(0x265),_0x48139e);const _0x15de5b=_0x43d24c['params']['id'],_0x76be1b=await purchases[_0x2b62e4(0x249)](_0x15de5b);console['log'](_0x76be1b);const _0x321a61=await suppliers[_0x2b62e4(0x1f4)]({'name':_0x76be1b[_0x2b62e4(0x22c)]});console['log'](_0x321a61);if(_0x48139e[0x0]['language']==_0x2b62e4(0x27d)){var _0x54da45=users[_0x2b62e4(0x22e)];console[_0x2b62e4(0x2d6)](_0x54da45);}else{if(_0x48139e[0x0][_0x2b62e4(0x255)]==_0x2b62e4(0x2f6))var _0x54da45=users[_0x2b62e4(0x2f6)];else{if(_0x48139e[0x0]['language']=='German')var _0x54da45=users['German'];else{if(_0x48139e[0x0]['language']==_0x2b62e4(0x22f))var _0x54da45=users['Spanish'];else{if(_0x48139e[0x0][_0x2b62e4(0x255)]=='French')var _0x54da45=users[_0x2b62e4(0x21d)];else{if(_0x48139e[0x0][_0x2b62e4(0x255)]==_0x2b62e4(0x207))var _0x54da45=users[_0x2b62e4(0x24b)];else{if(_0x48139e[0x0][_0x2b62e4(0x255)]==_0x2b62e4(0x2c0))var _0x54da45=users[_0x2b62e4(0x2c0)];else{if(_0x48139e[0x0]['language']=='Arabic\x20(ae)')var _0x54da45=users[_0x2b62e4(0x1fa)];}}}}}}}_0x20e7d4[_0x2b62e4(0x2a3)]('purchase_invoice',{'success':_0x43d24c[_0x2b62e4(0x2ba)]('success'),'errors':_0x43d24c[_0x2b62e4(0x2ba)](_0x2b62e4(0x2a8)),'role':_0x366f63,'profile':_0x16a14b,'master_shop':_0x48139e,'supplier':_0x321a61,'purchase':_0x76be1b,'language':_0x54da45});}catch(_0x1ec04f){console['log'](_0x1ec04f);}}),router[a0_0x1030b8(0x2a0)](a0_0x1030b8(0x273),auth,async(_0x42b491,_0x46d116)=>{var _0x49717d=a0_0x1030b8;try{const {username:_0x87e6c9,email:_0x38cf1f,role:_0x57f875}=_0x42b491[_0x49717d(0x2d9)],_0x4e9b01=_0x42b491[_0x49717d(0x2d9)],_0x4cb4ea=await profile['findOne']({'email':_0x4e9b01[_0x49717d(0x204)]}),_0x14dec4=await master_shop[_0x49717d(0x2b4)]();console['log'](_0x49717d(0x265),_0x14dec4);const _0x348994=_0x42b491[_0x49717d(0x1f6)]['id'];console[_0x49717d(0x2d6)](_0x348994);const _0x4620d5=await purchases_finished['findById'](_0x348994);console[_0x49717d(0x2d6)](_0x49717d(0x205),_0x4620d5);const _0x52449a=await product[_0x49717d(0x2b4)]({}),_0x2f437f=await warehouse[_0x49717d(0x2b0)]([{'$match':{'name':_0x4620d5['warehouse_name'],'room':_0x4620d5['room']}},{'$unwind':_0x49717d(0x266)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x49717d(0x23a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x49717d(0x257)},'bin':{'$first':_0x49717d(0x2b8)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x49717d(0x202)},'primary_code':{'$first':_0x49717d(0x20a)},'secondary_code':{'$first':_0x49717d(0x27e)},'product_code':{'$first':_0x49717d(0x2f3)},'storage':{'$first':_0x49717d(0x269)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x49717d(0x2d6)](_0x49717d(0x256),_0x2f437f);let _0xbf57a7;if(_0x4e9b01[_0x49717d(0x279)]==_0x49717d(0x2f5)){const _0x189ee1=await staff['findOne']({'email':_0x4e9b01['email']});_0xbf57a7=await warehouse[_0x49717d(0x2b4)]({'status':_0x49717d(0x26e),'name':_0x189ee1[_0x49717d(0x2c9)],'warehouse_category':'Finished\x20Goods','name':_0x49717d(0x2bd)});}else _0xbf57a7=await warehouse[_0x49717d(0x2b0)]([{'$match':{'status':'Enabled','warehouse_category':_0x49717d(0x238),'name':'Return\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);if(_0x14dec4[0x0][_0x49717d(0x255)]==_0x49717d(0x27d)){var _0x39e80e=users[_0x49717d(0x22e)];console['log'](_0x39e80e);}else{if(_0x14dec4[0x0][_0x49717d(0x255)]==_0x49717d(0x2f6))var _0x39e80e=users[_0x49717d(0x2f6)];else{if(_0x14dec4[0x0][_0x49717d(0x255)]==_0x49717d(0x22d))var _0x39e80e=users[_0x49717d(0x22d)];else{if(_0x14dec4[0x0][_0x49717d(0x255)]==_0x49717d(0x22f))var _0x39e80e=users[_0x49717d(0x22f)];else{if(_0x14dec4[0x0][_0x49717d(0x255)]==_0x49717d(0x21d))var _0x39e80e=users[_0x49717d(0x21d)];else{if(_0x14dec4[0x0][_0x49717d(0x255)]=='Portuguese\x20(BR)')var _0x39e80e=users['Portuguese'];else{if(_0x14dec4[0x0][_0x49717d(0x255)]==_0x49717d(0x2c0))var _0x39e80e=users[_0x49717d(0x2c0)];else{if(_0x14dec4[0x0]['language']=='Arabic\x20(ae)')var _0x39e80e=users['Arabic'];}}}}}}}_0x46d116['render'](_0x49717d(0x2ca),{'success':_0x42b491[_0x49717d(0x2ba)](_0x49717d(0x27a)),'errors':_0x42b491['flash'](_0x49717d(0x2a8)),'role':_0x4e9b01,'profile':_0x4cb4ea,'user':_0x4620d5,'stock':_0x2f437f,'master_shop':_0x14dec4,'product':_0x52449a,'language':_0x39e80e,'warehouse':_0xbf57a7});}catch(_0x549148){console[_0x49717d(0x2d6)](_0x549148);}}),router[a0_0x1030b8(0x226)]('/view/return_purchase/:id',auth,async(_0x383e20,_0x24a601)=>{var _0x4715a4=a0_0x1030b8;try{const {invoice:_0x32c27d,date:_0x446553,warehouse_name:_0x4c5841,Room_name:_0x275c74,product_name:_0x1ab66b,purchase_quantity:_0x44d5da,stocks:_0x4374b9,return_qty:_0x452e85,note:_0x1a6666,level:_0x4228bf,isle:_0x1cf227,pallet:_0x1cc2ad,to_warehouse_name:_0x3d31f2,to_Room_name:_0x4a8223}=_0x383e20['body'],_0x496d4e=await purchases_finished['findOne']({'_id':_0x383e20[_0x4715a4(0x1f6)]['id']}),_0xe1a8e1=await warehouse['findOne']({'name':_0x4c5841,'room':_0x275c74,'warehouse_category':_0x4715a4(0x238)});if(typeof _0x1ab66b==_0x4715a4(0x24f))var _0x589fbb=[_0x383e20[_0x4715a4(0x2a5)]['product_name']],_0x4f0f9e=[_0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x29e)]],_0x1ada39=[_0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x2d8)]],_0x4e663c=[_0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x206)]],_0x2b5f4f=[_0x383e20['body'][_0x4715a4(0x2e9)]],_0x1713a1=[_0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x2e0)]],_0x55fe7f=[_0x383e20[_0x4715a4(0x2a5)]['primary_code_hide']],_0xbee13f=[_0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x285)]];else var _0x589fbb=[..._0x383e20['body']['product_name']],_0x4f0f9e=[..._0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x29e)]],_0x1ada39=[..._0x383e20['body'][_0x4715a4(0x2d8)]],_0x4e663c=[..._0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x206)]],_0x2b5f4f=[..._0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x2e9)]],_0x1713a1=[..._0x383e20['body']['product_code_hide']],_0x55fe7f=[..._0x383e20[_0x4715a4(0x2a5)]['primary_code_hide']],_0xbee13f=[..._0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x285)]];const _0x356fce=_0x589fbb[_0x4715a4(0x251)](_0x43412e=>{return _0x43412e={'product_name':_0x43412e};});_0x4f0f9e[_0x4715a4(0x264)]((_0x51dab6,_0x57fb0c)=>{var _0x221322=_0x4715a4;_0x356fce[_0x57fb0c][_0x221322(0x29e)]=_0x51dab6;}),_0x1ada39[_0x4715a4(0x264)]((_0x2e768a,_0x2378b7)=>{var _0x5f2f72=_0x4715a4;_0x356fce[_0x2378b7][_0x5f2f72(0x222)]=_0x2e768a;}),_0x4e663c[_0x4715a4(0x264)]((_0x3d5959,_0x51bfb2)=>{var _0x332533=_0x4715a4;_0x356fce[_0x51bfb2][_0x332533(0x206)]=_0x3d5959;}),_0x2b5f4f[_0x4715a4(0x264)]((_0x5ca830,_0x535814)=>{var _0x75f52d=_0x4715a4;_0x356fce[_0x535814][_0x75f52d(0x24c)]=_0x5ca830;}),_0x1713a1['forEach']((_0x4a7fb6,_0xc7da94)=>{_0x356fce[_0xc7da94]['product_code']=_0x4a7fb6;}),_0x55fe7f['forEach']((_0x56430e,_0x5659c1)=>{var _0x4a4cd8=_0x4715a4;_0x356fce[_0x5659c1][_0x4a4cd8(0x2a2)]=_0x56430e;}),_0xbee13f[_0x4715a4(0x264)]((_0x46271a,_0x5e30b8)=>{var _0x29d993=_0x4715a4;_0x356fce[_0x5e30b8][_0x29d993(0x283)]=_0x46271a;}),_0x356fce[_0x4715a4(0x264)](_0x291a26=>{var _0x32c2d2=_0x4715a4;console[_0x32c2d2(0x2d6)](_0x291a26);const _0xfc5853=_0xe1a8e1[_0x32c2d2(0x228)][_0x32c2d2(0x251)](_0x16c0d1=>{var _0x2154d4=_0x32c2d2;_0x16c0d1[_0x2154d4(0x29f)]==_0x291a26[_0x2154d4(0x29f)]&&_0x16c0d1[_0x2154d4(0x24c)]==_0x291a26['bay']&&(console['log'](parseInt(_0x16c0d1[_0x2154d4(0x2e8)])+_0x2154d4(0x291)+parseInt(_0x291a26[_0x2154d4(0x206)])),_0x16c0d1[_0x2154d4(0x2e8)]=parseInt(_0x16c0d1[_0x2154d4(0x2e8)])-parseInt(_0x291a26[_0x2154d4(0x206)]));});}),await _0xe1a8e1[_0x4715a4(0x2bb)]();var _0xfaf160=0x0;_0x356fce[_0x4715a4(0x264)](_0x189e69=>{var _0x13eae5=_0x4715a4;(parseInt(_0x189e69['purchase_quantity'])<parseInt(_0x189e69['return_qty'])||parseInt(_0x189e69[_0x13eae5(0x222)])<parseInt(_0x189e69[_0x13eae5(0x206)]))&&_0xfaf160++;});if(_0xfaf160!=0x0)return _0x383e20[_0x4715a4(0x2ba)]('errors',_0x4715a4(0x217)),_0x24a601['redirect'](_0x4715a4(0x2cd));const _0x42319d=new purchases_return_finished({'invoice':_0x32c27d,'suppliers':_0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x22c)],'date':_0x446553,'warehouse_name':_0x4c5841,'return_product':_0x356fce,'note':_0x1a6666,'room':_0x275c74,'to_warehouse_name':_0x3d31f2,'to_room':_0x4a8223}),_0x30039c=await _0x42319d[_0x4715a4(0x2bb)](),_0x163ae4=await purchases_return_finished[_0x4715a4(0x1f4)]({'invoice':_0x32c27d}),_0xdc6c9f=await warehouse['findOne']({'name':_0x3d31f2,'room':_0x4a8223,'warehouse_category':_0x4715a4(0x238)});_0x163ae4[_0x4715a4(0x227)][_0x4715a4(0x264)](_0x43cdec=>{var _0xf770d2=_0x4715a4,_0x56e624=0x0;const _0x62dc0a=_0xdc6c9f[_0xf770d2(0x228)]['map'](_0x520090=>{var _0x2f9b1a=_0xf770d2;console[_0x2f9b1a(0x2d6)](_0x520090[_0x2f9b1a(0x29f)]+'=='+_0x43cdec[_0x2f9b1a(0x29f)]+'&&'+_0x520090[_0x2f9b1a(0x24c)]+'=='+_0x43cdec[_0x2f9b1a(0x24c)]),_0x520090[_0x2f9b1a(0x29f)]==_0x43cdec[_0x2f9b1a(0x29f)]&&_0x520090[_0x2f9b1a(0x24c)]==_0x43cdec[_0x2f9b1a(0x24c)]&&(_0x520090['product_stock']=parseInt(_0x520090['product_stock'])-parseInt(_0x43cdec[_0x2f9b1a(0x206)]),_0x56e624++);});_0x56e624=='0'&&(_0xdc6c9f[_0xf770d2(0x228)]=_0xdc6c9f[_0xf770d2(0x228)]['concat']({'product_name':_0x43cdec['product_name'],'product_stock':_0x43cdec[_0xf770d2(0x206)],'primary_code':_0x43cdec[_0xf770d2(0x2a2)],'secondary_code':_0x43cdec['secondary_code'],'product_code':_0x43cdec[_0xf770d2(0x29b)],'bay':_0x43cdec[_0xf770d2(0x24c)],'maxProducts':0xf423f}));}),await _0xdc6c9f[_0x4715a4(0x2bb)]();const _0x2a8773=await purchases_finished[_0x4715a4(0x1f4)]({'invoice':_0x32c27d});_0x2a8773[_0x4715a4(0x247)]=_0x4715a4(0x237);const _0x4dc027=await _0x2a8773['save'](),_0x46ce33=new s_payment_data({'invoice':_0x32c27d,'suppliers':_0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x22c)],'reason':_0x4715a4(0x239)});await _0x46ce33[_0x4715a4(0x2bb)]();const _0x1a6561=await master_shop[_0x4715a4(0x2b4)](),_0x49d729=await email_settings['findOne'](),_0x121927=await suppliers[_0x4715a4(0x1f4)]({'name':_0x383e20[_0x4715a4(0x2a5)][_0x4715a4(0x22c)]});_0x1a6561[0x0][_0x4715a4(0x2cc)]==0x1?(right_currency=_0x1a6561[0x0][_0x4715a4(0x25b)],left_currency=''):(right_currency='',left_currency=_0x1a6561[0x0]['currency']);var _0x2c38ea=_0x589fbb,_0x3eca30=_0x4e663c,_0x2ca6c3='',_0x1fe7e4;for(_0x1fe7e4 in _0x2c38ea){_0x2ca6c3+=_0x4715a4(0x1f5)+_0x4715a4(0x2ce)+_0x2c38ea[_0x1fe7e4]+'</td>'+_0x4715a4(0x2ce)+_0x3eca30[_0x1fe7e4]+_0x4715a4(0x2aa)+'</tr>';}let _0x7112cb=nodemailer[_0x4715a4(0x28c)]({'service':_0x4715a4(0x242),'auth':{'user':_0x49d729[_0x4715a4(0x204)],'pass':_0x49d729[_0x4715a4(0x208)]}}),_0x7ad204={'from':_0x49d729[_0x4715a4(0x204)],'to':_0x121927[_0x4715a4(0x204)],'subject':_0x4715a4(0x221),'attachments':[{'filename':_0x4715a4(0x2ea),'path':__dirname+_0x4715a4(0x24a)+_0x4715a4(0x2e5)+_0x1a6561[0x0][_0x4715a4(0x2d5)],'cid':_0x4715a4(0x210)}],'html':_0x4715a4(0x229)+'<html><head><title></title>'+_0x4715a4(0x2c4)+_0x4715a4(0x211)+_0x4715a4(0x23e)+_0x4715a4(0x211)+_0x4715a4(0x2b2)+_0x4715a4(0x203)+'<div>'+'<h2>\x20'+_0x1a6561[0x0][_0x4715a4(0x1f9)]+_0x4715a4(0x20d)+'</div>'+_0x4715a4(0x203)+'<hr\x20class=\x22my-3\x22>'+_0x4715a4(0x211)+_0x4715a4(0x2f4)+_0x4715a4(0x29d)+_0x32c27d+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x446553+'\x20'+_0x4715a4(0x2a4)+_0x4715a4(0x23f)+_0x4715a4(0x203)+_0x4715a4(0x2e6)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4715a4(0x1f5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4715a4(0x212)+_0x4715a4(0x215)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x4715a4(0x209)+_0x4715a4(0x23b)+'\x20'+_0x2ca6c3+'\x20'+_0x4715a4(0x21b)+'</table>'+_0x4715a4(0x211)+_0x4715a4(0x2be)+'<h5>'+_0x1a6561[0x0][_0x4715a4(0x1f9)]+_0x4715a4(0x23f)+_0x4715a4(0x203)+_0x4715a4(0x203)+_0x4715a4(0x26a)};_0x7112cb['sendMail'](_0x7ad204,function(_0x23b8d3,_0x980a99){var _0x194b94=_0x4715a4;_0x23b8d3?console[_0x194b94(0x2d6)](_0x194b94(0x2c2)):console[_0x194b94(0x2d6)](_0x194b94(0x253));}),_0x383e20['flash']('success',_0x4715a4(0x298)),_0x24a601[_0x4715a4(0x24e)](_0x4715a4(0x1fc));}catch(_0x2aa838){_0x24a601[_0x4715a4(0x286)](0xc8)[_0x4715a4(0x2c3)]({'message':_0x2aa838[_0x4715a4(0x2ec)]});}}),router[a0_0x1030b8(0x2a0)]('/barcode/:id',auth,async(_0x5c4b56,_0x14d558)=>{var _0x6bd656=a0_0x1030b8;try{const {username:_0x4b1701,email:_0x388c11,role:_0x193fe7}=_0x5c4b56[_0x6bd656(0x2d9)],_0x3e62f8=_0x5c4b56[_0x6bd656(0x2d9)],_0x5bd256=await profile['findOne']({'email':_0x3e62f8[_0x6bd656(0x204)]}),_0x553ef6=await master_shop[_0x6bd656(0x2b4)](),_0x4c505d=_0x5c4b56['params']['id'],_0x77bead=await purchases_finished[_0x6bd656(0x249)](_0x4c505d);if(_0x553ef6[0x0][_0x6bd656(0x255)]=='English\x20(US)')var _0x2e7812=users['English'];else{if(_0x553ef6[0x0][_0x6bd656(0x255)]==_0x6bd656(0x2f6))var _0x2e7812=users['Hindi'];else{if(_0x553ef6[0x0][_0x6bd656(0x255)]==_0x6bd656(0x22d))var _0x2e7812=users[_0x6bd656(0x22d)];else{if(_0x553ef6[0x0][_0x6bd656(0x255)]==_0x6bd656(0x22f))var _0x2e7812=users[_0x6bd656(0x22f)];else{if(_0x553ef6[0x0]['language']==_0x6bd656(0x21d))var _0x2e7812=users[_0x6bd656(0x21d)];else{if(_0x553ef6[0x0][_0x6bd656(0x255)]=='Portuguese\x20(BR)')var _0x2e7812=users[_0x6bd656(0x24b)];else{if(_0x553ef6[0x0]['language']==_0x6bd656(0x2c0))var _0x2e7812=users[_0x6bd656(0x2c0)];else{if(_0x553ef6[0x0][_0x6bd656(0x255)]==_0x6bd656(0x260))var _0x2e7812=users['Arabic'];}}}}}}}_0x14d558[_0x6bd656(0x2a3)]('all_purchases_barcode',{'success':_0x5c4b56[_0x6bd656(0x2ba)](_0x6bd656(0x27a)),'errors':_0x5c4b56[_0x6bd656(0x2ba)](_0x6bd656(0x2a8)),'role':_0x3e62f8,'profile':_0x5bd256,'alldata':_0x77bead,'master_shop':_0x553ef6,'language':_0x2e7812}),console[_0x6bd656(0x2d6)](alldata);}catch(_0xb5a48b){console[_0x6bd656(0x2d6)](_0xb5a48b);}}),router[a0_0x1030b8(0x226)](a0_0x1030b8(0x250),async(_0x1d4316,_0x771506)=>{var _0x3e4471=a0_0x1030b8;const {product_code:_0x33ead5}=_0x1d4316['body'];var _0x52cdb8;const _0x16b716=await product[_0x3e4471(0x2b0)]([{'$match':{'primary_code':_0x33ead5,'product_category':_0x3e4471(0x238)}},{'$group':{'_id':_0x3e4471(0x276),'name':{'$first':_0x3e4471(0x274)},'category':{'$first':_0x3e4471(0x2c6)},'brand':{'$first':_0x3e4471(0x2dd)},'unit':{'$first':_0x3e4471(0x22a)},'alertquantity':{'$first':_0x3e4471(0x2d0)},'product_code':{'$first':_0x3e4471(0x27c)},'primary_code':{'$first':_0x3e4471(0x220)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x3e4471(0x1fb)},'maxProdPerUnit':{'$first':_0x3e4471(0x288)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3e4471(0x281)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xbd6751=await product[_0x3e4471(0x2b0)]([{'$match':{'secondary_code':_0x33ead5}},{'$group':{'_id':_0x3e4471(0x276),'name':{'$first':_0x3e4471(0x274)},'category':{'$first':_0x3e4471(0x2c6)},'brand':{'$first':_0x3e4471(0x2dd)},'unit':{'$first':_0x3e4471(0x22a)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3e4471(0x27c)},'primary_code':{'$first':_0x3e4471(0x220)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x3e4471(0x1fb)},'maxProdPerUnit':{'$first':_0x3e4471(0x288)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3e4471(0x281)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x16b716['length']>0x0)_0x52cdb8=_0x16b716;else _0xbd6751[_0x3e4471(0x23c)]>0x0&&(_0x52cdb8=_0xbd6751);_0x771506['json'](_0x52cdb8);}),router[a0_0x1030b8(0x226)](a0_0x1030b8(0x262),async(_0x4fd13f,_0x11570f)=>{var _0x31effa=a0_0x1030b8;const {productCode:_0x2b7bcd,bay:_0x396d72,warehouses:_0x4d86fe,room:_0x42e465}=_0x4fd13f[_0x31effa(0x2a5)];console[_0x31effa(0x2d6)](_0x4fd13f[_0x31effa(0x2a5)]);try{const _0x1c89bb=await warehouse['aggregate']([{'$match':{'name':_0x4d86fe,'room':_0x42e465}},{'$unwind':_0x31effa(0x266)},{'$match':{'product_details.bay':parseInt(_0x396d72)}},{'$group':{'_id':_0x31effa(0x21e),'name':{'$first':_0x31effa(0x23a)},'product_stock':{'$first':_0x31effa(0x20f)},'bay':{'$first':_0x31effa(0x257)},'maxProducts':{'$first':_0x31effa(0x254)}}}]);_0x11570f[_0x31effa(0x286)](0xc8)[_0x31effa(0x2c3)](_0x1c89bb);}catch(_0x368350){_0x11570f[_0x31effa(0x286)](0x194)[_0x31effa(0x2c3)]({'message':_0x368350[_0x31effa(0x2ec)]});}}),module[a0_0x1030b8(0x2af)]=router;