var a0_0x3e6c99=a0_0x40e2;(function(_0x13bee9,_0x86aa76){var _0x13eb52=a0_0x40e2,_0x4bb534=_0x13bee9();while(!![]){try{var _0x578d98=-parseInt(_0x13eb52(0x21b))/0x1*(parseInt(_0x13eb52(0x1e9))/0x2)+-parseInt(_0x13eb52(0x17d))/0x3*(-parseInt(_0x13eb52(0x1d4))/0x4)+parseInt(_0x13eb52(0x182))/0x5+-parseInt(_0x13eb52(0x1f0))/0x6+parseInt(_0x13eb52(0x1fe))/0x7*(-parseInt(_0x13eb52(0x188))/0x8)+-parseInt(_0x13eb52(0x1ff))/0x9+parseInt(_0x13eb52(0x1c5))/0xa;if(_0x578d98===_0x86aa76)break;else _0x4bb534['push'](_0x4bb534['shift']());}catch(_0x3e33ae){_0x4bb534['push'](_0x4bb534['shift']());}}}(a0_0x34b2,0x8b7cd));function a0_0x34b2(){var _0x1cea1d=['</span>','purchase\x20data\x20add\x20successfully','purchase_quantity','$return_data','currency','$product_details.primary_code','$product.floorlevel','return_purchase_finished','product_date','standard_unit','warehouse_name','/view/add_purchases/:id','return_qty','staff','<div>','prod_level','getMonth','$alertquantity','params','getDate','<span\x20style=\x22float:\x20right;\x22>','add_purchases\x20error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_Qty','bay','host','findById','render','all','\x20Order\x20Date\x20:\x20','$due_amount','ejs','primary_code','Purchase\x20Mail','German','purchase_invoice','updateOne','gmail','maxStocks','get','/barcode/:id','<tr>','$expiry_date','table\x20page','RoomAssign','POnumber','Portuguese\x20(BR)','$product_details.maxProducts','Email\x20sent\x20successfully','</tr>','$suppliers_docs','9GvFhLl','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','secondary_code_hide','warehouse','Hindi','4178390fenouy','secondary_unit','Finished\x20Goods','$category','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','2799928xcBSPI','/barcode_scanner','$product_details.bay','length','note','body','stock_quantity','English\x20(US)','$maxProdPerUnit','image','success','product_code','$note','prod_qty','logo','</head><body>','Purchase\x20Return\x20Mail','QA\x20Warehouse','$suppliers','$room','prod_code','French','../middleware/auth','$batch_code','amount','/view','$product_details.product_code','$product_details.rack','$product.bin','user','$product.type','catch','maxperunit','<!DOCTYPE\x20html>','email','/give_payment/:id','quantity','log','Paid\x20For\x20Purchase','max_product_unit','invoice','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','getFullYear','save','edit_purchases_finished','express','../models/all_models','map','Portuguese','room_name','back','purchase\x20data\x20update\x20successfully','$product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<hr\x20class=\x22my-3\x22>','forEach','port','</body></html>','$_id','$maxStocks','8427920xcPHfH','<h2>\x20','/upload/','$product.bay','/all_purchases/view','Return\x20Goods','sendMail','/view/add_purchases','\x20</h2>','message','INCF-','Arabic','FROZEN\x20GOODS','Enclosed','suppliers','931692AzBbsc','$product_details.floorlevel','$warehouse_name','product_stock','JO_number','prod_unit','filter','$product_details._id','return_product','prod_invoice','</div>','Spanish','prod_cat','json','product_cat','slice','then','find','paid_amount','error','toString','84654RMfYuq','name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','secondary_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','English','An\x20error\x20occurred.','3203706ByQbMx','Error\x20Occurs','string','True','product_name','prod_secondunit','MaxStocks_data','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Logo.png','Purchase\x20Return','concat','errors','padStart','master','7TLRJzR','6773832EWNzAI','Arabic\x20(ae)','$product.quantity','prod_primunit','flash','product_details','$product_details.type','Router','Enabled','path','<tbody\x20style=\x22text-align:\x20center;\x22>','room','batch_code','</h5>','aggregate','$invoice','edit_purchases_finished_view','/view/:id','stocks','/view/return_purchase/:id','Chinese','all_purchases_finished','user_id','<h5>','/../public','Ambient','post','Rack\x201','4jaeptW','product','primary_code_hide','date','production_date','return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/all_purchases_finished/view','<h5\x20style=\x22text-align:\x20left;\x22>','/preview/:id','DRY\x20GOODS','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product','$brand','prod_name','expiry_date','$product_details','</table>','createTransport','all_purchases_barcode','language','$product_details.bin','$unit','currency_placement','</thead>','<strong>\x20Regards\x20</strong>','stock_data','status','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','redirect','due_amount','nodemailer','Rack\x202','level','$name','</tbody>','$product_details.product_stock','role','</td>','exports','suppliers_docs','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/CheckingWarehouse','$paid_amount','$primary_code','findOne','$secondary_unit','floor','$secondary_code'];a0_0x34b2=function(){return _0x1cea1d;};return a0_0x34b2();}const express=require(a0_0x3e6c99(0x1b5)),app=express(),router=express[a0_0x3e6c99(0x206)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x3e6c99(0x1b6)),auth=require(a0_0x3e6c99(0x19e)),nodemailer=require(a0_0x3e6c99(0x23a));var ejs=require(a0_0x3e6c99(0x169));const path=require(a0_0x3e6c99(0x208)),users=require('../public/language/languages.json');router['get'](a0_0x3e6c99(0x1a1),auth,async(_0x296db8,_0x17c34a)=>{var _0x6bcac8=a0_0x3e6c99;try{const {username:_0x4065e7,email:_0x3d2632,role:_0x49cb64}=_0x296db8[_0x6bcac8(0x1a5)],_0x334cf4=_0x296db8[_0x6bcac8(0x1a5)],_0x5c0836=await profile[_0x6bcac8(0x248)]({'email':_0x334cf4['email']}),_0x38b118=await staff['findOne']({'email':_0x334cf4[_0x6bcac8(0x1aa)]});if(_0x334cf4[_0x6bcac8(0x240)]==_0x6bcac8(0x157)){const _0x381544=await staff[_0x6bcac8(0x248)]({'email':_0x334cf4['email']});}const _0x5bf4a3=await master_shop['find']();let _0x1472cd;if(_0x334cf4[_0x6bcac8(0x240)]==_0x6bcac8(0x157)){const _0x52be05=await staff[_0x6bcac8(0x248)]({'email':_0x334cf4[_0x6bcac8(0x1aa)]});_0x1472cd=await purchases_finished[_0x6bcac8(0x20d)]([{'$match':{'warehouse_name':_0x52be05[_0x6bcac8(0x180)]}},{'$lookup':{'from':_0x6bcac8(0x1d3),'localField':'suppliers','foreignField':_0x6bcac8(0x1ea),'as':_0x6bcac8(0x243)}},{'$unwind':_0x6bcac8(0x17c)},{'$unwind':_0x6bcac8(0x227)},{'$group':{'_id':_0x6bcac8(0x1c3),'invoice':{'$first':_0x6bcac8(0x20e)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x6bcac8(0x1d6)},'room':{'$first':_0x6bcac8(0x19b)},'product':{'$push':_0x6bcac8(0x227)},'note':{'$first':_0x6bcac8(0x194)},'paid_amount':{'$first':_0x6bcac8(0x246)},'due_amount':{'$first':_0x6bcac8(0x168)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x6bcac8(0x19f)},'expiry_date':{'$first':_0x6bcac8(0x174)},'suppliers_docs':{'$first':_0x6bcac8(0x17c)},'total_product_quantity':{'$sum':_0x6bcac8(0x201)},'level':{'$addToSet':_0x6bcac8(0x1c8)},'isle':{'$addToSet':_0x6bcac8(0x1a4)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x6bcac8(0x252)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1472cd=await purchases_finished[_0x6bcac8(0x20d)]([{'$unwind':'$product'},{'$group':{'_id':_0x6bcac8(0x1c3),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x6bcac8(0x19a)},'date':{'$first':_0x6bcac8(0x186)},'warehouse_name':{'$first':_0x6bcac8(0x1d6)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x6bcac8(0x194)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x6bcac8(0x168)},'return_data':{'$first':_0x6bcac8(0x24f)},'batch_code':{'$first':_0x6bcac8(0x19f)},'expiry_date':{'$first':_0x6bcac8(0x174)},'suppliers_docs':{'$first':_0x6bcac8(0x17c)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x6bcac8(0x1c8)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x6bcac8(0x1a6)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x5bf4a3[0x0][_0x6bcac8(0x22f)]==_0x6bcac8(0x18f))var _0xdcceb1=users[_0x6bcac8(0x1ee)];else{if(_0x5bf4a3[0x0][_0x6bcac8(0x22f)]==_0x6bcac8(0x181))var _0xdcceb1=users[_0x6bcac8(0x181)];else{if(_0x5bf4a3[0x0]['language']=='German')var _0xdcceb1=users[_0x6bcac8(0x16c)];else{if(_0x5bf4a3[0x0][_0x6bcac8(0x22f)]==_0x6bcac8(0x1df))var _0xdcceb1=users[_0x6bcac8(0x1df)];else{if(_0x5bf4a3[0x0]['language']==_0x6bcac8(0x19d))var _0xdcceb1=users[_0x6bcac8(0x19d)];else{if(_0x5bf4a3[0x0][_0x6bcac8(0x22f)]==_0x6bcac8(0x178))var _0xdcceb1=users['Portuguese'];else{if(_0x5bf4a3[0x0]['language']=='Chinese')var _0xdcceb1=users[_0x6bcac8(0x213)];else{if(_0x5bf4a3[0x0][_0x6bcac8(0x22f)]==_0x6bcac8(0x200))var _0xdcceb1=users[_0x6bcac8(0x1d0)];}}}}}}}_0x17c34a[_0x6bcac8(0x165)](_0x6bcac8(0x214),{'success':_0x296db8[_0x6bcac8(0x203)](_0x6bcac8(0x192)),'errors':_0x296db8['flash'](_0x6bcac8(0x1fb)),'purchases':_0x1472cd,'role':_0x334cf4,'profile':_0x5c0836,'master_shop':_0x5bf4a3,'language':_0xdcceb1});}catch(_0x40e1b2){console[_0x6bcac8(0x1ad)](_0x6bcac8(0x175),_0x40e1b2),_0x17c34a[_0x6bcac8(0x236)](0xc8)[_0x6bcac8(0x1e1)]({'message':_0x40e1b2[_0x6bcac8(0x1ce)]});}});function BayBinSelected(_0x28c0e5,_0x39e99d){var _0x299aad=a0_0x3e6c99,_0x17dfea=[],_0x58e436=[];if(_0x28c0e5==_0x299aad(0x225)){switch(_0x39e99d){case'Rack\x201':_0x17dfea=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x299aad(0x23b):_0x17dfea=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x58e436=['DG'];}else{if(_0x28c0e5==_0x299aad(0x1d1)){switch(_0x39e99d){case _0x299aad(0x21a):_0x17dfea=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x299aad(0x23b):_0x17dfea=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x58e436=['FG'];}}return{'levels':_0x17dfea,'identify':_0x58e436};}function a0_0x40e2(_0x4e294f,_0xf709){var _0x34b2d7=a0_0x34b2();return a0_0x40e2=function(_0x40e207,_0x339382){_0x40e207=_0x40e207-0x153;var _0x589515=_0x34b2d7[_0x40e207];return _0x589515;},a0_0x40e2(_0x4e294f,_0xf709);}async function getRandom8DigitNumber(){var _0x27d816=a0_0x3e6c99;const _0x3905b0=0x989680,_0x9226b8=0x5f5e0ff,_0x273403=Math[_0x27d816(0x24a)](Math['random']()*(_0x9226b8-_0x3905b0+0x1))+_0x3905b0;var _0xb5aafb;const _0x56ac89=await purchases_finished[_0x27d816(0x248)]({'invoice':'INCF-'+_0x273403});return _0x56ac89&&_0x56ac89[_0x27d816(0x18b)]>0x0?_0xb5aafb=_0x27d816(0x1cf)+_0x273403:_0xb5aafb=_0x27d816(0x1cf)+_0x273403,_0xb5aafb;}router[a0_0x3e6c99(0x171)](a0_0x3e6c99(0x1cc),auth,async(_0x30e6bd,_0x37e3cb)=>{var _0x27126b=a0_0x3e6c99;try{const {username:_0x34e8ce,email:_0x2bb665,role:_0x3f068e}=_0x30e6bd['user'],_0x567030=_0x30e6bd[_0x27126b(0x1a5)],_0x584eb3=await profile[_0x27126b(0x248)]({'email':_0x567030[_0x27126b(0x1aa)]}),_0x4f0fa0=await master_shop['find'](),_0x582f4f=await staff[_0x27126b(0x248)]({'email':_0x567030[_0x27126b(0x1aa)]}),_0x56fd95=await suppliers[_0x27126b(0x1e5)]({});let _0x54a211;if(_0x567030[_0x27126b(0x240)]==_0x27126b(0x157)){const _0x2ac624=await staff[_0x27126b(0x248)]({'email':_0x567030['email']});_0x54a211=await warehouse[_0x27126b(0x20d)]([{'$match':{'status':'Enabled','name':_0x2ac624[_0x27126b(0x180)],'warehouse_category':_0x27126b(0x184)}},{'$group':{'_id':'$name','name':{'$first':_0x27126b(0x23d)}}}]);}else _0x54a211=await warehouse[_0x27126b(0x20d)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0x27126b(0x199)}}},{'$group':{'_id':'$name','name':{'$first':_0x27126b(0x23d)}}}]);const _0x397fed=await product['find']({}),_0xb650bc=await warehouse[_0x27126b(0x1e5)]({'status':_0x27126b(0x207)}),_0x2841ae=await purchases_finished[_0x27126b(0x1e5)]({}),_0x2d6ecc=_0x2841ae['length']+0x1,_0x3a4707=_0x27126b(0x1cf)+_0x2d6ecc[_0x27126b(0x1e8)]()[_0x27126b(0x1fc)](0x5,'0');var _0x1d6b66=[_0x27126b(0x218),_0x27126b(0x1d2)];if(_0x4f0fa0[0x0][_0x27126b(0x22f)]==_0x27126b(0x18f))var _0x4a59aa=users[_0x27126b(0x1ee)];else{if(_0x4f0fa0[0x0]['language']==_0x27126b(0x181))var _0x4a59aa=users[_0x27126b(0x181)];else{if(_0x4f0fa0[0x0][_0x27126b(0x22f)]=='German')var _0x4a59aa=users[_0x27126b(0x16c)];else{if(_0x4f0fa0[0x0][_0x27126b(0x22f)]==_0x27126b(0x1df))var _0x4a59aa=users[_0x27126b(0x1df)];else{if(_0x4f0fa0[0x0][_0x27126b(0x22f)]==_0x27126b(0x19d))var _0x4a59aa=users[_0x27126b(0x19d)];else{if(_0x4f0fa0[0x0][_0x27126b(0x22f)]==_0x27126b(0x178))var _0x4a59aa=users['Portuguese'];else{if(_0x4f0fa0[0x0][_0x27126b(0x22f)]==_0x27126b(0x213))var _0x4a59aa=users[_0x27126b(0x213)];else{if(_0x4f0fa0[0x0][_0x27126b(0x22f)]=='Arabic\x20(ae)')var _0x4a59aa=users[_0x27126b(0x1d0)];}}}}}}}const _0xc7240d=getRandom8DigitNumber();_0xc7240d[_0x27126b(0x1e4)](_0x5203e4=>{var _0x40d5ab=_0x27126b;_0x37e3cb['render']('add_purchases_finished',{'success':_0x30e6bd[_0x40d5ab(0x203)]('success'),'errors':_0x30e6bd[_0x40d5ab(0x203)]('errors'),'role':_0x567030,'profile':_0x584eb3,'suppliers':_0x56fd95,'warehouse':_0x54a211,'product':_0x397fed,'invoice':_0x5203e4,'master_shop':_0x4f0fa0,'language':_0x4a59aa,'find_data':_0xb650bc,'rooms_data':_0x1d6b66});})[_0x27126b(0x1a7)](_0x17938e=>{var _0x4f5df6=_0x27126b;_0x30e6bd['flash'](_0x4f5df6(0x1fb),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x37e3cb[_0x4f5df6(0x238)](_0x4f5df6(0x222));});}catch(_0xaa0831){console['log'](_0xaa0831);}}),router[a0_0x3e6c99(0x171)](a0_0x3e6c99(0x155),auth,async(_0x5e837a,_0x232ef2)=>{var _0x3901b7=a0_0x3e6c99;try{const _0xb273fa=_0x5e837a[_0x3901b7(0x15c)]['id'];console['log'](_0xb273fa);const _0x4d6194=await master_shop['find']();console['log'](_0x3901b7(0x1fd),_0x4d6194);const _0x52e021=await product[_0x3901b7(0x248)]({'name':_0xb273fa});console[_0x3901b7(0x1ad)](_0x3901b7(0x21c),_0x52e021),_0x232ef2[_0x3901b7(0x236)](0xc8)[_0x3901b7(0x1e1)]({'product_data':_0x52e021,'master':_0x4d6194});}catch(_0x581510){console[_0x3901b7(0x1ad)](_0x3901b7(0x15f),_0x581510);}}),router[a0_0x3e6c99(0x219)](a0_0x3e6c99(0x1cc),auth,async(_0x2fbf10,_0x5118a4)=>{var _0x46bcea=a0_0x3e6c99;try{const {invoice:_0x5a2011,date:_0x2e8e2e,warehouse_name:_0x161115,prod_name:_0x4e8b0c,prod_code:_0x4b8b1a,prod_qty:_0x230d54,prod_unit:_0x463a02,prod_secondunit:_0x4038c9,prod_level:_0xb1d9a2,prod_isle:_0x574c4a,prod_pallet:_0x474aeb,note:_0x44cf95,expiry_date:_0x24bef9,batch_code:_0x57ecaa,payable:_0x36b1fe,due_amount:_0x548b12,Room_name:_0x21b4ca,primary_code:_0x49db8c,secondary_code:_0x3b23c2,MaxStocks_data:_0x241035,PO_number:_0x1ee673,SCRN:_0x217762,JO_number:_0x4e27e4}=_0x2fbf10[_0x46bcea(0x18d)];if(typeof _0x4e8b0c==_0x46bcea(0x1f2))var _0x34e4de=[_0x2fbf10[_0x46bcea(0x18d)]['prod_name']],_0x169ec8=[_0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x19c)]],_0x4094c1=[_0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x161)]],_0x42aa36=[_0x2fbf10['body']['prod_primunit']],_0x35d0c9=[_0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x1f5)]],_0xcb9445=[_0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x159)]],_0x3fe33d=[_0x2fbf10['body']['primary_code']],_0x57f9bc=[_0x2fbf10[_0x46bcea(0x18d)]['secondary_code']],_0x39ae2a=[_0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x1f6)]],_0x4ff39d=[_0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x20b)]],_0x16c2af=[_0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x22a)]],_0x342a9b=[_0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x254)]],_0x221ce4=[_0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x1af)]],_0x2c702e=[_0x2fbf10['body']['prod_cat']],_0x4cffd2=[_0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x176)]],_0x2cbd44=[_0x2fbf10['body'][_0x46bcea(0x1dd)]];else var _0x34e4de=[..._0x2fbf10[_0x46bcea(0x18d)]['prod_name']],_0x169ec8=[..._0x2fbf10['body'][_0x46bcea(0x19c)]],_0x4094c1=[..._0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x161)]],_0x42aa36=[..._0x2fbf10['body'][_0x46bcea(0x202)]],_0x35d0c9=[..._0x2fbf10[_0x46bcea(0x18d)]['prod_secondunit']],_0xcb9445=[..._0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x159)]],_0x3fe33d=[..._0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x16a)]],_0x57f9bc=[..._0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x1ec)]],_0x39ae2a=[..._0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x1f6)]],_0x4ff39d=[..._0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x20b)]],_0x16c2af=[..._0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x22a)]],_0x342a9b=[..._0x2fbf10[_0x46bcea(0x18d)]['product_date']],_0x221ce4=[..._0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x1af)]],_0x2c702e=[..._0x2fbf10['body'][_0x46bcea(0x1e0)]],_0x4cffd2=[..._0x2fbf10['body']['RoomAssign']],_0x2cbd44=[..._0x2fbf10[_0x46bcea(0x18d)][_0x46bcea(0x1dd)]];const _0x284f57=_0x34e4de[_0x46bcea(0x1b7)](_0xebd0f=>{return _0xebd0f={'product_name':_0xebd0f};});_0x169ec8[_0x46bcea(0x1c0)]((_0x597c3b,_0x1503a9)=>{_0x284f57[_0x1503a9]['product_code']=_0x597c3b;}),_0x4094c1[_0x46bcea(0x1c0)]((_0xf8ac4a,_0x1c1241)=>{var _0x618506=_0x46bcea;_0x284f57[_0x1c1241][_0x618506(0x1ac)]=_0xf8ac4a;}),_0x42aa36[_0x46bcea(0x1c0)]((_0x355e22,_0x148e89)=>{var _0x2767b3=_0x46bcea;_0x284f57[_0x148e89][_0x2767b3(0x153)]=_0x355e22;}),_0x35d0c9[_0x46bcea(0x1c0)]((_0x2b3e42,_0x28b43f)=>{var _0x3230c7=_0x46bcea;_0x284f57[_0x28b43f][_0x3230c7(0x183)]=_0x2b3e42;}),_0xcb9445[_0x46bcea(0x1c0)]((_0x512148,_0x2f2e94)=>{var _0x1fadcc=_0x46bcea;_0x284f57[_0x2f2e94][_0x1fadcc(0x162)]=_0x512148;}),_0x3fe33d[_0x46bcea(0x1c0)]((_0x5cf354,_0x4541c7)=>{var _0x5d2ee6=_0x46bcea;_0x284f57[_0x4541c7][_0x5d2ee6(0x16a)]=_0x5cf354;}),_0x57f9bc[_0x46bcea(0x1c0)]((_0x702783,_0xc21f8a)=>{var _0x3fd78b=_0x46bcea;_0x284f57[_0xc21f8a][_0x3fd78b(0x1ec)]=_0x702783;}),_0x39ae2a[_0x46bcea(0x1c0)]((_0xc1a90f,_0x309f34)=>{var _0x4cccab=_0x46bcea;_0x284f57[_0x309f34][_0x4cccab(0x170)]=_0xc1a90f;}),_0x4ff39d[_0x46bcea(0x1c0)]((_0x2ec08b,_0xda9613)=>{var _0x33574f=_0x46bcea;_0x284f57[_0xda9613][_0x33574f(0x20b)]=_0x2ec08b;}),_0x16c2af[_0x46bcea(0x1c0)]((_0x148d54,_0x47eb56)=>{var _0x19f30a=_0x46bcea;_0x284f57[_0x47eb56][_0x19f30a(0x22a)]=_0x148d54;}),_0x342a9b['forEach']((_0x226ec6,_0x33a102)=>{var _0x5614da=_0x46bcea;_0x284f57[_0x33a102][_0x5614da(0x21f)]=_0x226ec6;}),_0x221ce4['forEach']((_0x5020ee,_0x448377)=>{var _0xfc029e=_0x46bcea;_0x284f57[_0x448377][_0xfc029e(0x1a8)]=_0x5020ee;}),_0x2c702e[_0x46bcea(0x1c0)]((_0x4b3916,_0x39e271)=>{_0x284f57[_0x39e271]['product_cat']=_0x4b3916;}),_0x4cffd2[_0x46bcea(0x1c0)]((_0x32ffed,_0x3dd9ec)=>{var _0x3b9cec=_0x46bcea;_0x284f57[_0x3dd9ec][_0x3b9cec(0x1b9)]=_0x32ffed;}),_0x2cbd44[_0x46bcea(0x1c0)]((_0x3db763,_0x22dbe6)=>{var _0xa1129c=_0x46bcea;_0x284f57[_0x22dbe6][_0xa1129c(0x1b0)]=_0x3db763;});const _0x5b5119=_0x284f57[_0x46bcea(0x1da)](_0x40c201=>_0x40c201['quantity']!=='0'&&_0x40c201[_0x46bcea(0x1ac)]!==''),_0x1b89d1=new purchases_finished({'invoice':_0x5a2011,'suppliers':_0x2fbf10['body'][_0x46bcea(0x1d3)],'date':_0x2e8e2e,'warehouse_name':_0x161115,'product':_0x5b5119,'note':_0x44cf95,'due_amount':_0x548b12,'room':_0x21b4ca,'POnumber':_0x1ee673,'SCRN':_0x217762,'JO_number':_0x4e27e4}),_0x5e32de=await _0x1b89d1[_0x46bcea(0x1b3)](),_0x44c712=await purchases_finished[_0x46bcea(0x248)]({'invoice':_0x5a2011}),_0x12d85f=_0x44c712[_0x46bcea(0x21c)]['map'](async _0x3a4315=>{var _0x29e786=_0x46bcea,_0x1de73d=await warehouse[_0x29e786(0x248)]({'name':_0x161115,'room':_0x3a4315[_0x29e786(0x1b9)]}),_0x218fa9=0x0;const _0x45e20e=_0x1de73d[_0x29e786(0x204)][_0x29e786(0x1b7)](_0x476548=>{var _0x3fe137=_0x29e786;console[_0x3fe137(0x1ad)](_0x476548[_0x3fe137(0x1f4)]+'=='+_0x3a4315[_0x3fe137(0x1f4)]+'&&'+_0x476548[_0x3fe137(0x162)]+'=='+_0x3a4315[_0x3fe137(0x162)]+'&&'+_0x476548[_0x3fe137(0x22a)]+'=='+_0x3a4315[_0x3fe137(0x22a)]+'&&'+_0x476548[_0x3fe137(0x21f)]+'=='+_0x3a4315['production_date']+'&&'+_0x476548[_0x3fe137(0x20b)]+'=='+_0x3a4315[_0x3fe137(0x20b)]+'&&'+_0x476548[_0x3fe137(0x1b0)]+'=='+_0x44c712['invoice']),_0x476548[_0x3fe137(0x1f4)]==_0x3a4315[_0x3fe137(0x1f4)]&&_0x476548[_0x3fe137(0x162)]==_0x3a4315[_0x3fe137(0x162)]&&_0x476548[_0x3fe137(0x22a)]==_0x3a4315['expiry_date']&&_0x476548[_0x3fe137(0x21f)]==_0x3a4315[_0x3fe137(0x21f)]&&_0x476548[_0x3fe137(0x20b)]==_0x3a4315['batch_code']&&_0x476548[_0x3fe137(0x1b0)]==_0x44c712['invoice']&&(_0x476548[_0x3fe137(0x1d7)]=_0x476548['product_stock']+_0x3a4315[_0x3fe137(0x1ac)],_0x218fa9++);});return _0x218fa9=='0'&&(_0x1de73d[_0x29e786(0x204)]=_0x1de73d[_0x29e786(0x204)]['concat']({'product_name':_0x3a4315[_0x29e786(0x1f4)],'product_stock':_0x3a4315[_0x29e786(0x1ac)],'primary_code':_0x3a4315[_0x29e786(0x16a)],'secondary_code':_0x3a4315[_0x29e786(0x1ec)],'product_code':_0x3a4315[_0x29e786(0x193)],'bay':_0x3a4315[_0x29e786(0x162)],'maxProducts':_0x3a4315[_0x29e786(0x170)],'unit':_0x3a4315[_0x29e786(0x153)],'secondary_unit':_0x3a4315[_0x29e786(0x183)],'expiry_date':_0x3a4315[_0x29e786(0x22a)],'production_date':_0x3a4315['production_date'],'maxProducts':_0x3a4315[_0x29e786(0x170)],'maxPerUnit':_0x3a4315[_0x29e786(0x1a8)],'batch_code':_0x3a4315[_0x29e786(0x20b)],'product_cat':_0x3a4315[_0x29e786(0x1e2)],'invoice':_0x3a4315[_0x29e786(0x1b0)]})),_0x1de73d;});Promise[_0x46bcea(0x166)](_0x12d85f)['then'](async _0x17352b=>{var _0x23b595=_0x46bcea;try{for(const _0x58cb15 of _0x17352b){await warehouse[_0x23b595(0x16e)]({'_id':_0x58cb15['_id']},{'$addToSet':{'product_details':{'$each':_0x58cb15[_0x23b595(0x204)]}}});}const _0x1f0176=await master_shop[_0x23b595(0x1e5)](),_0x17b6d8=await email_settings[_0x23b595(0x248)](),_0x42cc37=await supervisor_settings[_0x23b595(0x1e5)]();var _0x572cfd=_0x44c712[_0x23b595(0x21c)],_0x3dc730='',_0x275bd9;for(_0x275bd9 in _0x572cfd){var _0xa29b61='FG';_0x44c712[_0x23b595(0x154)]==_0x23b595(0x225)&&(_0xa29b61='DG'),_0x3dc730+=_0x23b595(0x173)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x572cfd[_0x275bd9][_0x23b595(0x1f4)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x572cfd[_0x275bd9][_0x23b595(0x193)]+_0x23b595(0x241)+_0x23b595(0x1ed)+_0x572cfd[_0x275bd9]['quantity']+'</td>'+_0x23b595(0x1ed)+_0x572cfd[_0x275bd9][_0x23b595(0x153)]+_0x23b595(0x241)+_0x23b595(0x1ed)+_0x572cfd[_0x275bd9][_0x23b595(0x183)]+_0x23b595(0x241)+_0x23b595(0x1ed)+_0x44c712[_0x23b595(0x154)]+_0x23b595(0x241)+_0x23b595(0x1ed)+_0x572cfd[_0x275bd9][_0x23b595(0x1b9)]+_0x23b595(0x241)+_0x23b595(0x1ed)+_0xa29b61+_0x572cfd[_0x275bd9][_0x23b595(0x162)]+'</td>','</tr>';}let _0x36582e=nodemailer[_0x23b595(0x22d)]({'host':_0x17b6d8[_0x23b595(0x163)],'port':Number(_0x17b6d8[_0x23b595(0x1c1)]),'secure':![],'auth':{'user':_0x17b6d8['email'],'pass':_0x17b6d8['password']}}),_0x3337b1={'from':_0x17b6d8['email'],'to':_0x42cc37[0x0]['FGSEmail'],'subject':_0x23b595(0x16b),'attachments':[{'filename':_0x23b595(0x1f8),'path':__dirname+_0x23b595(0x217)+_0x23b595(0x1c7)+_0x1f0176[0x0][_0x23b595(0x191)],'cid':_0x23b595(0x196)}],'html':_0x23b595(0x1a9)+'<html><head><title></title>'+_0x23b595(0x197)+'<div>'+_0x23b595(0x1b1)+'<div>'+_0x23b595(0x237)+_0x23b595(0x1de)+_0x23b595(0x158)+_0x23b595(0x1c6)+_0x1f0176[0x0]['site_title']+_0x23b595(0x1cd)+'</div>'+_0x23b595(0x1de)+_0x23b595(0x1bf)+_0x23b595(0x158)+_0x23b595(0x223)+'\x20Order\x20Number\x20:\x20'+_0x44c712[_0x23b595(0x1b0)]+'\x20'+_0x23b595(0x15e)+_0x23b595(0x167)+_0x44c712[_0x23b595(0x21e)]+'\x20'+'</span>'+_0x23b595(0x20c)+_0x23b595(0x1de)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x23b595(0x1f7)+_0x23b595(0x173)+_0x23b595(0x160)+_0x23b595(0x226)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x23b595(0x187)+_0x23b595(0x1bd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x23b595(0x17e)+_0x23b595(0x1eb)+_0x23b595(0x17b)+_0x23b595(0x233)+_0x23b595(0x209)+'\x20'+_0x3dc730+'\x20'+_0x23b595(0x23e)+_0x23b595(0x22c)+_0x23b595(0x158)+'<strong>\x20Regards\x20</strong>'+_0x23b595(0x216)+_0x1f0176[0x0]['site_title']+_0x23b595(0x20c)+_0x23b595(0x1de)+_0x23b595(0x1de)+'</body></html>'};_0x36582e['sendMail'](_0x3337b1,function(_0x34a740,_0x2d851b){var _0xaf9dde=_0x23b595;_0x34a740?(console['log'](_0x34a740),console['log'](_0xaf9dde(0x1f1))):console[_0xaf9dde(0x1ad)](_0xaf9dde(0x17a));});}catch(_0x335ab6){console['error'](_0x335ab6),_0x5118a4[_0x23b595(0x236)](0x1f4)[_0x23b595(0x1e1)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x335ab6[_0x23b595(0x1ce)]});}})[_0x46bcea(0x1a7)](_0x13bd11=>{var _0x4c3049=_0x46bcea;console[_0x4c3049(0x1e7)](_0x13bd11),_0x5118a4['status'](0x1f4)[_0x4c3049(0x1e1)]({'error':_0x4c3049(0x1ef)});}),_0x2fbf10[_0x46bcea(0x203)](_0x46bcea(0x192),_0x46bcea(0x24d)),_0x5118a4[_0x46bcea(0x238)](_0x46bcea(0x222));}catch(_0x6d7905){console[_0x46bcea(0x1ad)](_0x6d7905);}}),router[a0_0x3e6c99(0x171)](a0_0x3e6c99(0x224),auth,async(_0xb53870,_0x199480)=>{var _0x2ad0fb=a0_0x3e6c99;try{const {username:_0x277249,email:_0x226463,role:_0x1065ee}=_0xb53870[_0x2ad0fb(0x1a5)],_0x5a5b15=_0xb53870[_0x2ad0fb(0x1a5)],_0x1ca546=await profile[_0x2ad0fb(0x248)]({'email':_0x5a5b15['email']}),_0x5719d0=await master_shop[_0x2ad0fb(0x1e5)](),_0x3d1f70=_0xb53870[_0x2ad0fb(0x15c)]['id'],_0x16ba14=await purchases_finished[_0x2ad0fb(0x164)](_0x3d1f70),_0x24db90=await suppliers[_0x2ad0fb(0x1e5)]({});let _0x2cf4d3;if(_0x5a5b15[_0x2ad0fb(0x240)]==_0x2ad0fb(0x157)){const _0x5dc500=await staff['findOne']({'email':_0x5a5b15[_0x2ad0fb(0x1aa)]});_0x2cf4d3=await warehouse[_0x2ad0fb(0x1e5)]({'status':_0x2ad0fb(0x207),'name':_0x5dc500[_0x2ad0fb(0x180)],'warehouse_category':'Finished\x20Goods'});}else _0x2cf4d3=await warehouse[_0x2ad0fb(0x20d)]([{'$match':{'status':_0x2ad0fb(0x207),'warehouse_category':_0x2ad0fb(0x184)}},{'$group':{'_id':_0x2ad0fb(0x23d),'name':{'$first':_0x2ad0fb(0x23d)}}}]);const _0x5e5b59=await product['find']({}),_0x5e6467=BayBinSelected(_0x16ba14[_0x2ad0fb(0x154)],_0x16ba14[_0x2ad0fb(0x20a)]);let _0x5130f5=new Date(_0x16ba14[_0x2ad0fb(0x22a)]),_0x7187a6=('0'+_0x5130f5[_0x2ad0fb(0x15d)]())['slice'](-0x2),_0x2ce91a=('0'+(_0x5130f5[_0x2ad0fb(0x15a)]()+0x1))[_0x2ad0fb(0x1e3)](-0x2),_0x15d438=_0x5130f5[_0x2ad0fb(0x1b2)](),_0x209c1b=_0x15d438+'-'+_0x2ce91a+'-'+_0x7187a6;if(_0x5719d0[0x0][_0x2ad0fb(0x22f)]==_0x2ad0fb(0x18f)){var _0x1ad8e7=users[_0x2ad0fb(0x1ee)];console[_0x2ad0fb(0x1ad)](_0x1ad8e7);}else{if(_0x5719d0[0x0][_0x2ad0fb(0x22f)]==_0x2ad0fb(0x181))var _0x1ad8e7=users[_0x2ad0fb(0x181)];else{if(_0x5719d0[0x0][_0x2ad0fb(0x22f)]==_0x2ad0fb(0x16c))var _0x1ad8e7=users[_0x2ad0fb(0x16c)];else{if(_0x5719d0[0x0][_0x2ad0fb(0x22f)]==_0x2ad0fb(0x1df))var _0x1ad8e7=users['Spanish'];else{if(_0x5719d0[0x0][_0x2ad0fb(0x22f)]==_0x2ad0fb(0x19d))var _0x1ad8e7=users[_0x2ad0fb(0x19d)];else{if(_0x5719d0[0x0][_0x2ad0fb(0x22f)]==_0x2ad0fb(0x178))var _0x1ad8e7=users[_0x2ad0fb(0x1b8)];else{if(_0x5719d0[0x0][_0x2ad0fb(0x22f)]==_0x2ad0fb(0x213))var _0x1ad8e7=users['Chinese'];else{if(_0x5719d0[0x0][_0x2ad0fb(0x22f)]==_0x2ad0fb(0x200))var _0x1ad8e7=users[_0x2ad0fb(0x1d0)];}}}}}}}_0x199480[_0x2ad0fb(0x165)](_0x2ad0fb(0x20f),{'success':_0xb53870[_0x2ad0fb(0x203)](_0x2ad0fb(0x192)),'errors':_0xb53870[_0x2ad0fb(0x203)](_0x2ad0fb(0x1fb)),'role':_0x5a5b15,'profile':_0x1ca546,'purchases':_0x16ba14,'suppliers':_0x24db90,'warehouse':_0x2cf4d3,'product':_0x5e5b59,'master_shop':_0x5719d0,'language':_0x1ad8e7,'ed_fullDate':_0x209c1b,'dataSelected':_0x5e6467});}catch(_0x5907cb){console[_0x2ad0fb(0x1ad)](_0x5907cb);}}),router[a0_0x3e6c99(0x171)](a0_0x3e6c99(0x210),auth,async(_0x4868d2,_0x247115)=>{var _0x3f3d18=a0_0x3e6c99;try{const {username:_0x2873fc,email:_0x3d0d57,role:_0x13b74e}=_0x4868d2[_0x3f3d18(0x1a5)],_0x143c34=_0x4868d2[_0x3f3d18(0x1a5)],_0x71d24b=await profile[_0x3f3d18(0x248)]({'email':_0x143c34['email']}),_0x19c0e7=await master_shop[_0x3f3d18(0x1e5)](),_0x584864=_0x4868d2[_0x3f3d18(0x15c)]['id'],_0x1840fa=await purchases_finished['findById'](_0x584864),_0x33865f=await suppliers[_0x3f3d18(0x1e5)]({});let _0x43691c;if(_0x143c34[_0x3f3d18(0x240)]==_0x3f3d18(0x157)){const _0x182d76=await staff[_0x3f3d18(0x248)]({'email':_0x143c34[_0x3f3d18(0x1aa)]});_0x43691c=await warehouse[_0x3f3d18(0x1e5)]({'status':_0x3f3d18(0x207),'name':_0x182d76[_0x3f3d18(0x180)],'warehouse_category':'Finished\x20Goods'});}else _0x43691c=await warehouse[_0x3f3d18(0x20d)]([{'$match':{'status':_0x3f3d18(0x207),'warehouse_category':_0x3f3d18(0x184)}},{'$group':{'_id':'$name','name':{'$first':_0x3f3d18(0x23d)}}}]);const _0x5555ae=await product[_0x3f3d18(0x1e5)]({}),_0x60d617=BayBinSelected(_0x1840fa['warehouse_name'],_0x1840fa[_0x3f3d18(0x20a)]);let _0x371d0f=new Date(_0x1840fa['expiry_date']),_0xd8e0ee=('0'+_0x371d0f[_0x3f3d18(0x15d)]())[_0x3f3d18(0x1e3)](-0x2),_0x4c30dd=('0'+(_0x371d0f[_0x3f3d18(0x15a)]()+0x1))[_0x3f3d18(0x1e3)](-0x2),_0x2bf0a3=_0x371d0f[_0x3f3d18(0x1b2)](),_0x3eb670=_0x2bf0a3+'-'+_0x4c30dd+'-'+_0xd8e0ee;if(_0x19c0e7[0x0][_0x3f3d18(0x22f)]=='English\x20(US)'){var _0x4ea9c0=users[_0x3f3d18(0x1ee)];console[_0x3f3d18(0x1ad)](_0x4ea9c0);}else{if(_0x19c0e7[0x0][_0x3f3d18(0x22f)]==_0x3f3d18(0x181))var _0x4ea9c0=users[_0x3f3d18(0x181)];else{if(_0x19c0e7[0x0][_0x3f3d18(0x22f)]==_0x3f3d18(0x16c))var _0x4ea9c0=users[_0x3f3d18(0x16c)];else{if(_0x19c0e7[0x0][_0x3f3d18(0x22f)]=='Spanish')var _0x4ea9c0=users[_0x3f3d18(0x1df)];else{if(_0x19c0e7[0x0][_0x3f3d18(0x22f)]=='French')var _0x4ea9c0=users[_0x3f3d18(0x19d)];else{if(_0x19c0e7[0x0][_0x3f3d18(0x22f)]==_0x3f3d18(0x178))var _0x4ea9c0=users[_0x3f3d18(0x1b8)];else{if(_0x19c0e7[0x0][_0x3f3d18(0x22f)]==_0x3f3d18(0x213))var _0x4ea9c0=users['Chinese'];else{if(_0x19c0e7[0x0]['language']=='Arabic\x20(ae)')var _0x4ea9c0=users['Arabic'];}}}}}}}_0x247115[_0x3f3d18(0x165)](_0x3f3d18(0x1b4),{'success':_0x4868d2[_0x3f3d18(0x203)](_0x3f3d18(0x192)),'errors':_0x4868d2[_0x3f3d18(0x203)](_0x3f3d18(0x1fb)),'role':_0x143c34,'profile':_0x71d24b,'purchases':_0x1840fa,'suppliers':_0x33865f,'warehouse':_0x43691c,'product':_0x5555ae,'master_shop':_0x19c0e7,'language':_0x4ea9c0,'ed_fullDate':_0x3eb670,'dataSelected':_0x60d617});}catch(_0x29f936){console[_0x3f3d18(0x1ad)](_0x29f936);}}),router['post']('/view/:id',auth,async(_0x1a046a,_0x353c2d)=>{var _0x3dba07=a0_0x3e6c99;try{const _0x4d226f=_0x1a046a['params']['id'],_0x62dd76=await purchases_finished['findOne']({'_id':_0x1a046a[_0x3dba07(0x15c)]['id']}),_0x303aef=await warehouse[_0x3dba07(0x248)]({'name':_0x62dd76[_0x3dba07(0x154)],'room':_0x62dd76[_0x3dba07(0x20a)]});_0x62dd76[_0x3dba07(0x21c)][_0x3dba07(0x1c0)](_0x1bc6a3=>{var _0x35dbf5=_0x3dba07;const _0x41a70d=_0x303aef[_0x35dbf5(0x204)][_0x35dbf5(0x1b7)](_0x2ae5d5=>{var _0x186915=_0x35dbf5;_0x2ae5d5[_0x186915(0x1f4)]==_0x1bc6a3[_0x186915(0x1f4)]&&_0x2ae5d5[_0x186915(0x162)]==_0x1bc6a3[_0x186915(0x162)]&&(_0x2ae5d5[_0x186915(0x1d7)]=parseInt(_0x2ae5d5[_0x186915(0x1d7)])-parseInt(_0x1bc6a3['quantity']));});}),await _0x303aef[_0x3dba07(0x1b3)]();const {invoice:_0x14729a,suppliers:_0xec3177,date:_0x2a7703,warehouse_name:_0x227a9e,prod_name:_0x5df2e8,prod_code:_0x325266,prod_qty:_0x2d1538,prod_unit:_0x544032,prod_secondunit:_0x3c418e,prod_level:_0x580f06,prod_isle:_0x493d40,prod_pallet:_0x7a019f,note:_0x312835,expiry_date:_0x121570,batch_code:_0x149c14,paid_amount:_0x3494f2,due_amount:_0x316c08,Room_name:_0x49f80d,primary_code:_0x5b5e3e,secondary_code:_0x33a610,PO_number:_0x471fdb,JO_number:_0x2c3ca4}=_0x1a046a[_0x3dba07(0x18d)];if(typeof _0x5df2e8==_0x3dba07(0x1f2))var _0x377994=[_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x229)]],_0x2336f8=[_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x19c)]],_0x27eecd=[_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x195)]],_0x5e5ec9=[_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x1d9)]],_0x2f002f=[_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x1f5)]],_0x62f7c5=[_0x1a046a['body'][_0x3dba07(0x159)]],_0x2c6c1f=[_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x16a)]],_0x41bfc0=[_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x1ec)]],_0x38bcac=[_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x1f6)]],_0x5456ea=[_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x20b)]],_0x466429=[_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x22a)]];else var _0x377994=[..._0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x229)]],_0x2336f8=[..._0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x19c)]],_0x27eecd=[..._0x1a046a['body']['prod_qty']],_0x5e5ec9=[..._0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x1d9)]],_0x2f002f=[..._0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x1f5)]],_0x62f7c5=[..._0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x159)]],_0x2c6c1f=[..._0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x16a)]],_0x41bfc0=[..._0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x1ec)]],_0x38bcac=[..._0x1a046a[_0x3dba07(0x18d)]['MaxStocks_data']],_0x5456ea=[..._0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x20b)]],_0x466429=[..._0x1a046a['body'][_0x3dba07(0x22a)]];const _0x7b1c0a=_0x377994['map'](_0x1ed386=>{return _0x1ed386={'product_name':_0x1ed386};});_0x2336f8[_0x3dba07(0x1c0)]((_0x3d29c0,_0xba1dda)=>{var _0x128488=_0x3dba07;_0x7b1c0a[_0xba1dda][_0x128488(0x193)]=_0x3d29c0;}),_0x27eecd[_0x3dba07(0x1c0)]((_0x271735,_0x380575)=>{var _0x5b746d=_0x3dba07;_0x7b1c0a[_0x380575][_0x5b746d(0x1ac)]=_0x271735;}),_0x5e5ec9[_0x3dba07(0x1c0)]((_0x260595,_0x132954)=>{var _0x5c3120=_0x3dba07;_0x7b1c0a[_0x132954][_0x5c3120(0x153)]=_0x260595;}),_0x2f002f[_0x3dba07(0x1c0)]((_0x3be717,_0x5927bd)=>{_0x7b1c0a[_0x5927bd]['secondary_unit']=_0x3be717;}),_0x62f7c5[_0x3dba07(0x1c0)]((_0x49782a,_0x4d60d5)=>{_0x7b1c0a[_0x4d60d5]['bay']=_0x49782a;}),_0x2c6c1f[_0x3dba07(0x1c0)]((_0x27e24b,_0x576e9c)=>{var _0x119ef4=_0x3dba07;_0x7b1c0a[_0x576e9c][_0x119ef4(0x16a)]=_0x27e24b;}),_0x41bfc0[_0x3dba07(0x1c0)]((_0x2bc916,_0x44079e)=>{var _0x3a35a5=_0x3dba07;_0x7b1c0a[_0x44079e][_0x3a35a5(0x1ec)]=_0x2bc916;}),_0x38bcac[_0x3dba07(0x1c0)]((_0x2e295a,_0x12e15a)=>{var _0x4cf616=_0x3dba07;_0x7b1c0a[_0x12e15a][_0x4cf616(0x170)]=_0x2e295a;}),_0x5456ea['forEach']((_0x319c84,_0x47e01d)=>{_0x7b1c0a[_0x47e01d]['batch_code']=_0x319c84;}),_0x466429[_0x3dba07(0x1c0)]((_0x30b640,_0x1c4fe7)=>{var _0x21720d=_0x3dba07;_0x7b1c0a[_0x1c4fe7][_0x21720d(0x22a)]=_0x30b640;});const _0x579e64=_0x7b1c0a['filter'](_0x4eae01=>_0x4eae01[_0x3dba07(0x1ac)]!=='0'&&_0x4eae01[_0x3dba07(0x1ac)]!=='');_0x62dd76[_0x3dba07(0x1b0)]=_0x14729a,_0x62dd76['suppliers']=_0xec3177,_0x62dd76[_0x3dba07(0x21e)]=_0x2a7703,_0x62dd76[_0x3dba07(0x154)]=_0x227a9e,_0x62dd76[_0x3dba07(0x21c)]=_0x579e64,_0x62dd76[_0x3dba07(0x18c)]=_0x312835,_0x62dd76['paid_amount']=_0x3494f2,_0x62dd76[_0x3dba07(0x239)]=_0x316c08,_0x62dd76[_0x3dba07(0x20a)]=_0x49f80d,_0x62dd76[_0x3dba07(0x177)]=_0x471fdb,_0x62dd76[_0x3dba07(0x1d8)]=_0x2c3ca4;const _0x6e0523=await _0x62dd76['save'](),_0x4d20c3=await warehouse['findOne']({'name':_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x154)],'room':_0x1a046a[_0x3dba07(0x18d)]['Room_name']});_0x62dd76[_0x3dba07(0x21c)][_0x3dba07(0x1c0)](_0x5e47e3=>{var _0x3d10f8=_0x3dba07,_0x54abc3=0x0;const _0x1d0abd=_0x4d20c3[_0x3d10f8(0x204)][_0x3d10f8(0x1b7)](_0x2103e3=>{var _0x75a83=_0x3d10f8;_0x2103e3['product_name']==_0x5e47e3[_0x75a83(0x1f4)]&&_0x2103e3['bay']==_0x5e47e3[_0x75a83(0x162)]&&(_0x2103e3[_0x75a83(0x1d7)]=parseInt(_0x2103e3[_0x75a83(0x1d7)])+parseInt(_0x5e47e3[_0x75a83(0x1ac)]),_0x54abc3++);});_0x54abc3=='0'&&(_0x4d20c3[_0x3d10f8(0x204)]=_0x4d20c3[_0x3d10f8(0x204)][_0x3d10f8(0x1fa)]({'product_name':_0x5e47e3[_0x3d10f8(0x1f4)],'product_stock':_0x5e47e3[_0x3d10f8(0x1ac)],'primary_code':_0x5e47e3[_0x3d10f8(0x16a)],'secondary_code':_0x5e47e3['secondary_code'],'product_code':_0x5e47e3[_0x3d10f8(0x193)],'bay':_0x5e47e3['bay'],'maxProducts':_0x5e47e3[_0x3d10f8(0x170)],'unit':_0x5e47e3[_0x3d10f8(0x153)],'secondary_unit':_0x5e47e3[_0x3d10f8(0x183)],'expiry_date':_0x5e47e3[_0x3d10f8(0x22a)]}));}),await _0x4d20c3[_0x3dba07(0x1b3)]();const _0x4b3ba4=await s_payment_data[_0x3dba07(0x248)]({'invoice':_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x1b0)]});if(_0x4b3ba4===null){}else console['log'](_0x3dba07(0x1d3),_0x4b3ba4,_0x1a046a[_0x3dba07(0x18d)]['invoice']),_0x4b3ba4[_0x3dba07(0x1d3)]=_0x1a046a[_0x3dba07(0x18d)][_0x3dba07(0x1d3)],await _0x4b3ba4[_0x3dba07(0x1b3)]();_0x1a046a['flash'](_0x3dba07(0x192),_0x3dba07(0x1bb)),_0x353c2d[_0x3dba07(0x238)](_0x3dba07(0x222));}catch(_0x5b1083){console['log'](_0x5b1083);}}),router[a0_0x3e6c99(0x219)](a0_0x3e6c99(0x1ab),auth,async(_0x473a93,_0x4a7a6e)=>{var _0x4ba7eb=a0_0x3e6c99;try{const _0x55e614=_0x473a93[_0x4ba7eb(0x15c)]['id'],{invoice:_0x4bbc29,suppliers:_0x12114b,payable:_0x1b75fd,due_amount:_0x594434}=_0x473a93['body'],_0x16f6c0=await purchases[_0x4ba7eb(0x164)](_0x55e614);var _0x311ab2=_0x1b75fd-_0x594434;_0x16f6c0[_0x4ba7eb(0x1e6)]=parseFloat(_0x16f6c0[_0x4ba7eb(0x1e6)])+parseFloat(_0x594434),_0x16f6c0[_0x4ba7eb(0x239)]=_0x311ab2;const _0x3be0a2=await _0x16f6c0['save']();console[_0x4ba7eb(0x1ad)](_0x3be0a2);const _0x3c8e65=await s_payment_data['findOne']({'invoice':_0x4bbc29});_0x3c8e65[_0x4ba7eb(0x1a0)]=_0x311ab2,await _0x3c8e65[_0x4ba7eb(0x1b3)]();let _0x5b3a84=new Date(),_0x128986=('0'+_0x5b3a84[_0x4ba7eb(0x15d)]())['slice'](-0x2),_0x1c66b8=('0'+(_0x5b3a84[_0x4ba7eb(0x15a)]()+0x1))[_0x4ba7eb(0x1e3)](-0x2),_0x2802e4=_0x5b3a84[_0x4ba7eb(0x1b2)](),_0x4c4c33=_0x2802e4+'-'+_0x1c66b8+'-'+_0x128986;const _0x5f49c4=new suppliers_payment({'invoice':_0x4bbc29,'date':_0x2802e4+'-'+_0x1c66b8+'-'+_0x128986,'suppliers':_0x12114b,'reason':_0x4ba7eb(0x1ae),'amount':_0x594434}),_0x5d15e9=await _0x5f49c4['save']();_0x473a93['flash']('success','payment\x20successfull'),_0x4a7a6e['redirect'](_0x4ba7eb(0x1c9));}catch(_0x44f598){console[_0x4ba7eb(0x1ad)](_0x44f598);}}),router[a0_0x3e6c99(0x171)]('/invoice/:id',auth,async(_0x215190,_0x218e86)=>{var _0x7abd49=a0_0x3e6c99;try{const {username:_0x4a7053,email:_0x272e5f,role:_0x564f49}=_0x215190['user'],_0x569f99=_0x215190[_0x7abd49(0x1a5)],_0xc19f33=await profile['findOne']({'email':_0x569f99['email']}),_0xdb2996=await master_shop[_0x7abd49(0x1e5)]();console[_0x7abd49(0x1ad)](_0x7abd49(0x1fd),_0xdb2996);const _0x147f19=_0x215190[_0x7abd49(0x15c)]['id'],_0xd4b52b=await purchases[_0x7abd49(0x164)](_0x147f19);console[_0x7abd49(0x1ad)](_0xd4b52b);const _0x48069f=await suppliers['findOne']({'name':_0xd4b52b['suppliers']});console[_0x7abd49(0x1ad)](_0x48069f);if(_0xdb2996[0x0][_0x7abd49(0x22f)]==_0x7abd49(0x18f)){var _0x4a6495=users[_0x7abd49(0x1ee)];console[_0x7abd49(0x1ad)](_0x4a6495);}else{if(_0xdb2996[0x0][_0x7abd49(0x22f)]==_0x7abd49(0x181))var _0x4a6495=users[_0x7abd49(0x181)];else{if(_0xdb2996[0x0][_0x7abd49(0x22f)]==_0x7abd49(0x16c))var _0x4a6495=users['German'];else{if(_0xdb2996[0x0][_0x7abd49(0x22f)]==_0x7abd49(0x1df))var _0x4a6495=users['Spanish'];else{if(_0xdb2996[0x0][_0x7abd49(0x22f)]=='French')var _0x4a6495=users[_0x7abd49(0x19d)];else{if(_0xdb2996[0x0][_0x7abd49(0x22f)]==_0x7abd49(0x178))var _0x4a6495=users[_0x7abd49(0x1b8)];else{if(_0xdb2996[0x0]['language']==_0x7abd49(0x213))var _0x4a6495=users[_0x7abd49(0x213)];else{if(_0xdb2996[0x0][_0x7abd49(0x22f)]=='Arabic\x20(ae)')var _0x4a6495=users[_0x7abd49(0x1d0)];}}}}}}}_0x218e86[_0x7abd49(0x165)](_0x7abd49(0x16d),{'success':_0x215190['flash'](_0x7abd49(0x192)),'errors':_0x215190[_0x7abd49(0x203)](_0x7abd49(0x1fb)),'role':_0x569f99,'profile':_0xc19f33,'master_shop':_0xdb2996,'supplier':_0x48069f,'purchase':_0xd4b52b,'language':_0x4a6495});}catch(_0x3c3991){console[_0x7abd49(0x1ad)](_0x3c3991);}}),router[a0_0x3e6c99(0x171)](a0_0x3e6c99(0x212),auth,async(_0x2cca7d,_0x1ef947)=>{var _0x33f978=a0_0x3e6c99;try{const {username:_0x5436b7,email:_0x110ba8,role:_0x469a6a}=_0x2cca7d[_0x33f978(0x1a5)],_0x2f8cd8=_0x2cca7d[_0x33f978(0x1a5)],_0x2b9f59=await profile[_0x33f978(0x248)]({'email':_0x2f8cd8[_0x33f978(0x1aa)]}),_0x1a2637=await master_shop['find']();console['log'](_0x33f978(0x1fd),_0x1a2637);const _0x49ddef=_0x2cca7d[_0x33f978(0x15c)]['id'];console[_0x33f978(0x1ad)](_0x49ddef);const _0x3fcd52=await purchases_finished[_0x33f978(0x164)](_0x49ddef);console['log'](_0x33f978(0x215),_0x3fcd52);const _0x3b52d4=await product[_0x33f978(0x1e5)]({}),_0x148e5a=await warehouse[_0x33f978(0x20d)]([{'$match':{'name':_0x3fcd52['warehouse_name'],'room':_0x3fcd52[_0x33f978(0x20a)]}},{'$unwind':_0x33f978(0x22b)},{'$group':{'_id':_0x33f978(0x1db),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x33f978(0x23f)},'bay':{'$first':_0x33f978(0x18a)},'bin':{'$first':_0x33f978(0x230)},'type':{'$first':_0x33f978(0x205)},'floorlevel':{'$first':_0x33f978(0x1d5)},'primary_code':{'$first':_0x33f978(0x251)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x33f978(0x1a2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x33f978(0x1a3)}}}]);console['log'](_0x33f978(0x235),_0x148e5a);let _0x56eb1d;if(_0x2f8cd8[_0x33f978(0x240)]==_0x33f978(0x157)){const _0x183ab9=await staff[_0x33f978(0x248)]({'email':_0x2f8cd8['email']});_0x56eb1d=await warehouse[_0x33f978(0x1e5)]({'status':'Enabled','name':_0x183ab9[_0x33f978(0x180)],'warehouse_category':_0x33f978(0x184),'name':'Return\x20Goods'});}else _0x56eb1d=await warehouse[_0x33f978(0x20d)]([{'$match':{'status':_0x33f978(0x207),'warehouse_category':_0x33f978(0x184),'name':_0x33f978(0x1ca)}},{'$group':{'_id':_0x33f978(0x23d),'name':{'$first':_0x33f978(0x23d)}}}]);if(_0x1a2637[0x0][_0x33f978(0x22f)]=='English\x20(US)'){var _0x2a496b=users[_0x33f978(0x1ee)];console[_0x33f978(0x1ad)](_0x2a496b);}else{if(_0x1a2637[0x0]['language']=='Hindi')var _0x2a496b=users[_0x33f978(0x181)];else{if(_0x1a2637[0x0][_0x33f978(0x22f)]=='German')var _0x2a496b=users[_0x33f978(0x16c)];else{if(_0x1a2637[0x0][_0x33f978(0x22f)]==_0x33f978(0x1df))var _0x2a496b=users['Spanish'];else{if(_0x1a2637[0x0][_0x33f978(0x22f)]=='French')var _0x2a496b=users[_0x33f978(0x19d)];else{if(_0x1a2637[0x0][_0x33f978(0x22f)]==_0x33f978(0x178))var _0x2a496b=users[_0x33f978(0x1b8)];else{if(_0x1a2637[0x0][_0x33f978(0x22f)]==_0x33f978(0x213))var _0x2a496b=users[_0x33f978(0x213)];else{if(_0x1a2637[0x0][_0x33f978(0x22f)]==_0x33f978(0x200))var _0x2a496b=users[_0x33f978(0x1d0)];}}}}}}}_0x1ef947[_0x33f978(0x165)](_0x33f978(0x253),{'success':_0x2cca7d[_0x33f978(0x203)](_0x33f978(0x192)),'errors':_0x2cca7d[_0x33f978(0x203)](_0x33f978(0x1fb)),'role':_0x2f8cd8,'profile':_0x2b9f59,'user':_0x3fcd52,'stock':_0x148e5a,'master_shop':_0x1a2637,'product':_0x3b52d4,'language':_0x2a496b,'warehouse':_0x56eb1d});}catch(_0x480653){console[_0x33f978(0x1ad)](_0x480653);}}),router['post'](a0_0x3e6c99(0x212),auth,async(_0x125a7a,_0x4e7455)=>{var _0x1657e7=a0_0x3e6c99;try{const {invoice:_0x709e9,date:_0x1abf83,warehouse_name:_0x1a1098,Room_name:_0xa46606,product_name:_0x564e94,purchase_quantity:_0x4120fc,stocks:_0x4ff579,return_qty:_0xc37d8e,note:_0x27a03f,level:_0xc8f508,isle:_0x57df56,pallet:_0x192fd4,to_warehouse_name:_0x1bb634,to_Room_name:_0x5e7db3}=_0x125a7a[_0x1657e7(0x18d)],_0x33d3bb=await purchases_finished[_0x1657e7(0x248)]({'_id':_0x125a7a['params']['id']}),_0x4f3170=await warehouse['findOne']({'name':_0x1a1098,'room':_0xa46606,'warehouse_category':'Finished\x20Goods'});if(typeof _0x564e94=='string')var _0x13e965=[_0x125a7a[_0x1657e7(0x18d)][_0x1657e7(0x1f4)]],_0x5710c6=[_0x125a7a['body'][_0x1657e7(0x24e)]],_0x5cccdc=[_0x125a7a[_0x1657e7(0x18d)][_0x1657e7(0x211)]],_0x5d5ead=[_0x125a7a[_0x1657e7(0x18d)][_0x1657e7(0x156)]],_0x5e7591=[_0x125a7a[_0x1657e7(0x18d)]['level']],_0xa44449=[_0x125a7a['body']['product_code_hide']],_0x58166e=[_0x125a7a[_0x1657e7(0x18d)]['primary_code_hide']],_0x5ab866=[_0x125a7a[_0x1657e7(0x18d)][_0x1657e7(0x17f)]];else var _0x13e965=[..._0x125a7a['body'][_0x1657e7(0x1f4)]],_0x5710c6=[..._0x125a7a[_0x1657e7(0x18d)][_0x1657e7(0x24e)]],_0x5cccdc=[..._0x125a7a[_0x1657e7(0x18d)][_0x1657e7(0x211)]],_0x5d5ead=[..._0x125a7a[_0x1657e7(0x18d)][_0x1657e7(0x156)]],_0x5e7591=[..._0x125a7a['body'][_0x1657e7(0x23c)]],_0xa44449=[..._0x125a7a[_0x1657e7(0x18d)]['product_code_hide']],_0x58166e=[..._0x125a7a[_0x1657e7(0x18d)][_0x1657e7(0x21d)]],_0x5ab866=[..._0x125a7a[_0x1657e7(0x18d)][_0x1657e7(0x17f)]];const _0x100ec8=_0x13e965[_0x1657e7(0x1b7)](_0xd0879b=>{return _0xd0879b={'product_name':_0xd0879b};});_0x5710c6[_0x1657e7(0x1c0)]((_0x3c82b6,_0x5243b4)=>{_0x100ec8[_0x5243b4]['purchase_quantity']=_0x3c82b6;}),_0x5cccdc[_0x1657e7(0x1c0)]((_0x4d4236,_0xeece0b)=>{var _0x286ec1=_0x1657e7;_0x100ec8[_0xeece0b][_0x286ec1(0x18e)]=_0x4d4236;}),_0x5d5ead['forEach']((_0xec1b94,_0x1896e0)=>{_0x100ec8[_0x1896e0]['return_qty']=_0xec1b94;}),_0x5e7591[_0x1657e7(0x1c0)]((_0x4b55e3,_0x1bb465)=>{var _0x3401b5=_0x1657e7;_0x100ec8[_0x1bb465][_0x3401b5(0x162)]=_0x4b55e3;}),_0xa44449[_0x1657e7(0x1c0)]((_0x411d8b,_0x5e2a1b)=>{_0x100ec8[_0x5e2a1b]['product_code']=_0x411d8b;}),_0x58166e[_0x1657e7(0x1c0)]((_0x1d35b3,_0xb99667)=>{var _0x174975=_0x1657e7;_0x100ec8[_0xb99667][_0x174975(0x16a)]=_0x1d35b3;}),_0x5ab866[_0x1657e7(0x1c0)]((_0x244ff2,_0x4ddb17)=>{var _0x27f25e=_0x1657e7;_0x100ec8[_0x4ddb17][_0x27f25e(0x1ec)]=_0x244ff2;}),_0x100ec8['forEach'](_0x1b48cf=>{var _0x286ad9=_0x1657e7;console[_0x286ad9(0x1ad)](_0x1b48cf);const _0x2588f0=_0x4f3170['product_details'][_0x286ad9(0x1b7)](_0x1ab100=>{var _0x356a43=_0x286ad9;_0x1ab100['product_name']==_0x1b48cf[_0x356a43(0x1f4)]&&_0x1ab100['bay']==_0x1b48cf[_0x356a43(0x162)]&&(console[_0x356a43(0x1ad)](parseInt(_0x1ab100[_0x356a43(0x1d7)])+'\x20<>\x20'+parseInt(_0x1b48cf[_0x356a43(0x156)])),_0x1ab100[_0x356a43(0x1d7)]=parseInt(_0x1ab100[_0x356a43(0x1d7)])-parseInt(_0x1b48cf['return_qty']));});}),await _0x4f3170[_0x1657e7(0x1b3)]();var _0x5d3744=0x0;_0x100ec8['forEach'](_0x4d7e20=>{var _0x396c96=_0x1657e7;(parseInt(_0x4d7e20[_0x396c96(0x24e)])<parseInt(_0x4d7e20[_0x396c96(0x156)])||parseInt(_0x4d7e20[_0x396c96(0x18e)])<parseInt(_0x4d7e20[_0x396c96(0x156)]))&&_0x5d3744++;});if(_0x5d3744!=0x0)return _0x125a7a['flash'](_0x1657e7(0x1fb),_0x1657e7(0x1be)),_0x4e7455[_0x1657e7(0x238)](_0x1657e7(0x1ba));const _0x4c06e0=new purchases_return_finished({'invoice':_0x709e9,'suppliers':_0x125a7a[_0x1657e7(0x18d)]['suppliers'],'date':_0x1abf83,'warehouse_name':_0x1a1098,'return_product':_0x100ec8,'note':_0x27a03f,'room':_0xa46606,'to_warehouse_name':_0x1bb634,'to_room':_0x5e7db3}),_0x1c29f2=await _0x4c06e0[_0x1657e7(0x1b3)](),_0x4e0f97=await purchases_return_finished[_0x1657e7(0x248)]({'invoice':_0x709e9}),_0x1e05ab=await warehouse['findOne']({'name':_0x1bb634,'room':_0x5e7db3,'warehouse_category':_0x1657e7(0x184)});_0x4e0f97[_0x1657e7(0x1dc)]['forEach'](_0x7c4fa6=>{var _0xfc038e=_0x1657e7,_0x406877=0x0;const _0x1cd139=_0x1e05ab[_0xfc038e(0x204)][_0xfc038e(0x1b7)](_0xfb041f=>{var _0x5c5b4f=_0xfc038e;console[_0x5c5b4f(0x1ad)](_0xfb041f[_0x5c5b4f(0x1f4)]+'=='+_0x7c4fa6['product_name']+'&&'+_0xfb041f[_0x5c5b4f(0x162)]+'=='+_0x7c4fa6[_0x5c5b4f(0x162)]),_0xfb041f['product_name']==_0x7c4fa6[_0x5c5b4f(0x1f4)]&&_0xfb041f[_0x5c5b4f(0x162)]==_0x7c4fa6[_0x5c5b4f(0x162)]&&(_0xfb041f[_0x5c5b4f(0x1d7)]=parseInt(_0xfb041f['product_stock'])-parseInt(_0x7c4fa6[_0x5c5b4f(0x156)]),_0x406877++);});_0x406877=='0'&&(_0x1e05ab['product_details']=_0x1e05ab[_0xfc038e(0x204)][_0xfc038e(0x1fa)]({'product_name':_0x7c4fa6[_0xfc038e(0x1f4)],'product_stock':_0x7c4fa6['return_qty'],'primary_code':_0x7c4fa6[_0xfc038e(0x16a)],'secondary_code':_0x7c4fa6[_0xfc038e(0x1ec)],'product_code':_0x7c4fa6['product_code'],'bay':_0x7c4fa6[_0xfc038e(0x162)],'maxProducts':0xf423f}));}),await _0x1e05ab[_0x1657e7(0x1b3)]();const _0x5e7f0b=await purchases_finished[_0x1657e7(0x248)]({'invoice':_0x709e9});_0x5e7f0b[_0x1657e7(0x220)]=_0x1657e7(0x1f3);const _0x4b1481=await _0x5e7f0b[_0x1657e7(0x1b3)](),_0xfd1952=new s_payment_data({'invoice':_0x709e9,'suppliers':_0x125a7a[_0x1657e7(0x18d)][_0x1657e7(0x1d3)],'reason':_0x1657e7(0x1f9)});await _0xfd1952[_0x1657e7(0x1b3)]();const _0xe745fb=await master_shop[_0x1657e7(0x1e5)](),_0x54d658=await email_settings[_0x1657e7(0x248)](),_0x5ccdb7=await suppliers[_0x1657e7(0x248)]({'name':_0x125a7a['body'][_0x1657e7(0x1d3)]});_0xe745fb[0x0][_0x1657e7(0x232)]==0x1?(right_currency=_0xe745fb[0x0][_0x1657e7(0x250)],left_currency=''):(right_currency='',left_currency=_0xe745fb[0x0][_0x1657e7(0x250)]);var _0x2e038d=_0x13e965,_0x3366e9=_0x5d5ead,_0x418796='',_0x53efe1;for(_0x53efe1 in _0x2e038d){_0x418796+=_0x1657e7(0x173)+_0x1657e7(0x1ed)+_0x2e038d[_0x53efe1]+_0x1657e7(0x241)+_0x1657e7(0x1ed)+_0x3366e9[_0x53efe1]+'</td>'+'</tr>';}let _0x660d20=nodemailer[_0x1657e7(0x22d)]({'service':_0x1657e7(0x16f),'auth':{'user':_0x54d658[_0x1657e7(0x1aa)],'pass':_0x54d658['password']}}),_0x498a1b={'from':_0x54d658[_0x1657e7(0x1aa)],'to':_0x5ccdb7[_0x1657e7(0x1aa)],'subject':_0x1657e7(0x198),'attachments':[{'filename':'Logo.png','path':__dirname+_0x1657e7(0x217)+'/upload/'+_0xe745fb[0x0]['image'],'cid':_0x1657e7(0x196)}],'html':_0x1657e7(0x1a9)+'<html><head><title></title>'+_0x1657e7(0x197)+_0x1657e7(0x158)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1657e7(0x158)+_0x1657e7(0x237)+'</div>'+_0x1657e7(0x158)+_0x1657e7(0x1c6)+_0xe745fb[0x0]['site_title']+_0x1657e7(0x1cd)+'</div>'+'</div>'+_0x1657e7(0x1bf)+_0x1657e7(0x158)+_0x1657e7(0x223)+'\x20Order\x20Number\x20:\x20'+_0x709e9+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1657e7(0x167)+_0x1abf83+'\x20'+_0x1657e7(0x24c)+_0x1657e7(0x20c)+'</div>'+_0x1657e7(0x244)+_0x1657e7(0x1f7)+'<tr>'+_0x1657e7(0x160)+_0x1657e7(0x221)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x1657e7(0x233)+_0x1657e7(0x209)+'\x20'+_0x418796+'\x20'+_0x1657e7(0x23e)+_0x1657e7(0x22c)+'<div>'+_0x1657e7(0x234)+_0x1657e7(0x216)+_0xe745fb[0x0]['site_title']+_0x1657e7(0x20c)+_0x1657e7(0x1de)+_0x1657e7(0x1de)+_0x1657e7(0x1c2)};_0x660d20[_0x1657e7(0x1cb)](_0x498a1b,function(_0x3279c7,_0x17f1be){var _0x5968a6=_0x1657e7;_0x3279c7?console[_0x5968a6(0x1ad)](_0x5968a6(0x1f1)):console[_0x5968a6(0x1ad)]('Email\x20sent\x20successfully');}),_0x125a7a[_0x1657e7(0x203)](_0x1657e7(0x192),'purchases\x20item\x20return\x20successfull'),_0x4e7455[_0x1657e7(0x238)](_0x1657e7(0x222));}catch(_0x208ee4){_0x4e7455[_0x1657e7(0x236)](0xc8)[_0x1657e7(0x1e1)]({'message':_0x208ee4[_0x1657e7(0x1ce)]});}}),router['get'](a0_0x3e6c99(0x172),auth,async(_0x3782a5,_0x4dd628)=>{var _0x525d55=a0_0x3e6c99;try{const {username:_0xe4222a,email:_0x3828b1,role:_0x1ddc62}=_0x3782a5[_0x525d55(0x1a5)],_0x42dd49=_0x3782a5[_0x525d55(0x1a5)],_0x11e9c8=await profile[_0x525d55(0x248)]({'email':_0x42dd49[_0x525d55(0x1aa)]}),_0x3e63f8=await master_shop['find'](),_0x505681=_0x3782a5['params']['id'],_0x314088=await purchases_finished[_0x525d55(0x164)](_0x505681);if(_0x3e63f8[0x0][_0x525d55(0x22f)]==_0x525d55(0x18f))var _0x279aa9=users[_0x525d55(0x1ee)];else{if(_0x3e63f8[0x0][_0x525d55(0x22f)]==_0x525d55(0x181))var _0x279aa9=users[_0x525d55(0x181)];else{if(_0x3e63f8[0x0][_0x525d55(0x22f)]==_0x525d55(0x16c))var _0x279aa9=users[_0x525d55(0x16c)];else{if(_0x3e63f8[0x0][_0x525d55(0x22f)]==_0x525d55(0x1df))var _0x279aa9=users[_0x525d55(0x1df)];else{if(_0x3e63f8[0x0]['language']==_0x525d55(0x19d))var _0x279aa9=users[_0x525d55(0x19d)];else{if(_0x3e63f8[0x0][_0x525d55(0x22f)]==_0x525d55(0x178))var _0x279aa9=users[_0x525d55(0x1b8)];else{if(_0x3e63f8[0x0][_0x525d55(0x22f)]==_0x525d55(0x213))var _0x279aa9=users[_0x525d55(0x213)];else{if(_0x3e63f8[0x0]['language']=='Arabic\x20(ae)')var _0x279aa9=users['Arabic'];}}}}}}}_0x4dd628[_0x525d55(0x165)](_0x525d55(0x22e),{'success':_0x3782a5['flash']('success'),'errors':_0x3782a5[_0x525d55(0x203)](_0x525d55(0x1fb)),'role':_0x42dd49,'profile':_0x11e9c8,'alldata':_0x314088,'master_shop':_0x3e63f8,'language':_0x279aa9}),console[_0x525d55(0x1ad)](alldata);}catch(_0x3ae317){console[_0x525d55(0x1ad)](_0x3ae317);}}),router['post'](a0_0x3e6c99(0x189),async(_0x5a9def,_0x16fe6c)=>{var _0x8ec9b2=a0_0x3e6c99;const {product_code:_0x562465}=_0x5a9def[_0x8ec9b2(0x18d)];var _0x305516;const _0x14e332=await product['aggregate']([{'$match':{'primary_code':_0x562465,'product_category':_0x8ec9b2(0x184)}},{'$group':{'_id':_0x8ec9b2(0x1c3),'name':{'$first':'$name'},'category':{'$first':_0x8ec9b2(0x185)},'brand':{'$first':_0x8ec9b2(0x228)},'unit':{'$first':_0x8ec9b2(0x231)},'alertquantity':{'$first':_0x8ec9b2(0x15b)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x8ec9b2(0x247)},'secondary_code':{'$first':_0x8ec9b2(0x24b)},'maxStocks':{'$first':_0x8ec9b2(0x1c4)},'maxProdPerUnit':{'$first':_0x8ec9b2(0x190)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x8ec9b2(0x249)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x20b100=await product[_0x8ec9b2(0x20d)]([{'$match':{'secondary_code':_0x562465}},{'$group':{'_id':'$_id','name':{'$first':_0x8ec9b2(0x23d)},'category':{'$first':_0x8ec9b2(0x185)},'brand':{'$first':_0x8ec9b2(0x228)},'unit':{'$first':_0x8ec9b2(0x231)},'alertquantity':{'$first':_0x8ec9b2(0x15b)},'product_code':{'$first':_0x8ec9b2(0x1bc)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x8ec9b2(0x24b)},'maxStocks':{'$first':_0x8ec9b2(0x1c4)},'maxProdPerUnit':{'$first':_0x8ec9b2(0x190)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x8ec9b2(0x249)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x14e332[_0x8ec9b2(0x18b)]>0x0)_0x305516=_0x14e332;else _0x20b100[_0x8ec9b2(0x18b)]>0x0&&(_0x305516=_0x20b100);_0x16fe6c[_0x8ec9b2(0x1e1)](_0x305516);}),router[a0_0x3e6c99(0x219)](a0_0x3e6c99(0x245),async(_0x216f8d,_0x14bf3b)=>{var _0x5d0127=a0_0x3e6c99;const {productCode:_0x57e04c,bay:_0x3e46b6,warehouses:_0x3375da,room:_0x2df8f6}=_0x216f8d[_0x5d0127(0x18d)];console[_0x5d0127(0x1ad)](_0x216f8d[_0x5d0127(0x18d)]);try{const _0x51287a=await warehouse[_0x5d0127(0x20d)]([{'$match':{'name':_0x3375da,'room':_0x2df8f6}},{'$unwind':_0x5d0127(0x22b)},{'$match':{'product_details.bay':parseInt(_0x3e46b6)}},{'$group':{'_id':_0x5d0127(0x1db),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5d0127(0x23f)},'bay':{'$first':_0x5d0127(0x18a)},'maxProducts':{'$first':_0x5d0127(0x179)}}}]);_0x14bf3b[_0x5d0127(0x236)](0xc8)[_0x5d0127(0x1e1)](_0x51287a);}catch(_0x14e642){_0x14bf3b[_0x5d0127(0x236)](0x194)[_0x5d0127(0x1e1)]({'message':_0x14e642[_0x5d0127(0x1ce)]});}}),module[a0_0x3e6c99(0x242)]=router;