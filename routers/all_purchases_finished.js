var a0_0x55c7a0=a0_0x4a91;(function(_0x5e138f,_0x4c64bc){var _0x344fec=a0_0x4a91,_0x3287c8=_0x5e138f();while(!![]){try{var _0x2637ad=parseInt(_0x344fec(0x20c))/0x1+parseInt(_0x344fec(0x24f))/0x2*(-parseInt(_0x344fec(0x271))/0x3)+-parseInt(_0x344fec(0x2a1))/0x4+parseInt(_0x344fec(0x256))/0x5*(-parseInt(_0x344fec(0x1fe))/0x6)+-parseInt(_0x344fec(0x1ea))/0x7*(parseInt(_0x344fec(0x23d))/0x8)+parseInt(_0x344fec(0x24d))/0x9*(-parseInt(_0x344fec(0x257))/0xa)+parseInt(_0x344fec(0x2e3))/0xb*(parseInt(_0x344fec(0x2b3))/0xc);if(_0x2637ad===_0x4c64bc)break;else _0x3287c8['push'](_0x3287c8['shift']());}catch(_0x21905e){_0x3287c8['push'](_0x3287c8['shift']());}}}(a0_0x1906,0x53b45));const express=require(a0_0x55c7a0(0x229)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x55c7a0(0x25a)),auth=require('../middleware/auth'),nodemailer=require(a0_0x55c7a0(0x223));var ejs=require(a0_0x55c7a0(0x2b5));const path=require('path'),users=require(a0_0x55c7a0(0x204));router[a0_0x55c7a0(0x296)]('/view',auth,async(_0x406b16,_0x203c5c)=>{var _0xd65ac1=a0_0x55c7a0;try{const {username:_0x25895a,email:_0x3037ad,role:_0x47e188}=_0x406b16[_0xd65ac1(0x1ef)],_0x4aa396=_0x406b16[_0xd65ac1(0x1ef)],_0x1a554b=await profile[_0xd65ac1(0x2c7)]({'email':_0x4aa396[_0xd65ac1(0x1f9)]}),_0x4762ae=await staff[_0xd65ac1(0x2c7)]({'email':_0x4aa396[_0xd65ac1(0x1f9)]});if(_0x4aa396[_0xd65ac1(0x243)]==_0xd65ac1(0x222)){const _0x477db9=await staff[_0xd65ac1(0x2c7)]({'email':_0x4aa396['email']});}const _0x1119bd=await master_shop[_0xd65ac1(0x21f)]();let _0x2674cc;if(_0x4aa396[_0xd65ac1(0x243)]==_0xd65ac1(0x222)){const _0x41b34c=await staff[_0xd65ac1(0x2c7)]({'email':_0x4aa396[_0xd65ac1(0x1f9)]});_0x2674cc=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x41b34c[_0xd65ac1(0x208)]}},{'$lookup':{'from':_0xd65ac1(0x25f),'localField':_0xd65ac1(0x25f),'foreignField':_0xd65ac1(0x255),'as':_0xd65ac1(0x2db)}},{'$unwind':_0xd65ac1(0x29c)},{'$unwind':_0xd65ac1(0x2de)},{'$group':{'_id':_0xd65ac1(0x2c3),'invoice':{'$first':_0xd65ac1(0x2bf)},'suppliers':{'$first':_0xd65ac1(0x26b)},'date':{'$first':_0xd65ac1(0x237)},'warehouse_name':{'$first':_0xd65ac1(0x249)},'room':{'$first':_0xd65ac1(0x2cc)},'product':{'$push':_0xd65ac1(0x2de)},'note':{'$first':_0xd65ac1(0x24a)},'paid_amount':{'$first':_0xd65ac1(0x202)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0xd65ac1(0x25d)},'batch_code':{'$first':_0xd65ac1(0x246)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0xd65ac1(0x29c)},'total_product_quantity':{'$sum':_0xd65ac1(0x27b)},'level':{'$addToSet':_0xd65ac1(0x2b8)},'isle':{'$addToSet':_0xd65ac1(0x225)},'type':{'$addToSet':_0xd65ac1(0x298)},'floorlevel':{'$addToSet':_0xd65ac1(0x1f8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2674cc=await purchases_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0xd65ac1(0x2c3),'invoice':{'$first':_0xd65ac1(0x2bf)},'suppliers':{'$first':_0xd65ac1(0x26b)},'date':{'$first':_0xd65ac1(0x237)},'warehouse_name':{'$first':_0xd65ac1(0x249)},'room':{'$addToSet':_0xd65ac1(0x2a9)},'product':{'$push':_0xd65ac1(0x2de)},'note':{'$first':_0xd65ac1(0x24a)},'paid_amount':{'$first':_0xd65ac1(0x202)},'due_amount':{'$first':_0xd65ac1(0x24b)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0xd65ac1(0x246)},'expiry_date':{'$first':_0xd65ac1(0x26a)},'suppliers_docs':{'$first':_0xd65ac1(0x29c)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0xd65ac1(0x225)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0xd65ac1(0x1f8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x1119bd[0x0]['language']==_0xd65ac1(0x231))var _0xaf0c09=users['English'];else{if(_0x1119bd[0x0][_0xd65ac1(0x22f)]==_0xd65ac1(0x2bd))var _0xaf0c09=users['Hindi'];else{if(_0x1119bd[0x0][_0xd65ac1(0x22f)]==_0xd65ac1(0x1e7))var _0xaf0c09=users[_0xd65ac1(0x1e7)];else{if(_0x1119bd[0x0]['language']==_0xd65ac1(0x209))var _0xaf0c09=users[_0xd65ac1(0x209)];else{if(_0x1119bd[0x0][_0xd65ac1(0x22f)]=='French')var _0xaf0c09=users[_0xd65ac1(0x1e6)];else{if(_0x1119bd[0x0]['language']==_0xd65ac1(0x210))var _0xaf0c09=users[_0xd65ac1(0x28e)];else{if(_0x1119bd[0x0][_0xd65ac1(0x22f)]=='Chinese')var _0xaf0c09=users[_0xd65ac1(0x239)];else{if(_0x1119bd[0x0][_0xd65ac1(0x22f)]==_0xd65ac1(0x2cd))var _0xaf0c09=users[_0xd65ac1(0x261)];}}}}}}}_0x203c5c['render'](_0xd65ac1(0x280),{'success':_0x406b16[_0xd65ac1(0x2d9)](_0xd65ac1(0x25b)),'errors':_0x406b16['flash'](_0xd65ac1(0x29b)),'purchases':_0x2674cc,'role':_0x4aa396,'profile':_0x1a554b,'master_shop':_0x1119bd,'language':_0xaf0c09});}catch(_0x1ed11b){console['log']('table\x20page',_0x1ed11b),_0x203c5c[_0xd65ac1(0x293)](0xc8)[_0xd65ac1(0x2e5)]({'message':_0x1ed11b[_0xd65ac1(0x236)]});}});function BayBinSelected(_0x30a1f5,_0x11cb80){var _0x32e23d=a0_0x55c7a0,_0xdb49ce=[],_0x2a7673=[];if(_0x30a1f5=='DRY\x20GOODS'){switch(_0x11cb80){case _0x32e23d(0x2d7):_0xdb49ce=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0xdb49ce=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2a7673=['DG'];}else{if(_0x30a1f5==_0x32e23d(0x263)){switch(_0x11cb80){case _0x32e23d(0x2d7):_0xdb49ce=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x32e23d(0x295):_0xdb49ce=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2a7673=['FG'];}}return{'levels':_0xdb49ce,'identify':_0x2a7673};}async function getRandom8DigitNumber(){var _0x2397f6=a0_0x55c7a0;const _0x2c4cc3=0x989680,_0x2ee15f=0x5f5e0ff,_0x433fa9=Math['floor'](Math[_0x2397f6(0x259)]()*(_0x2ee15f-_0x2c4cc3+0x1))+_0x2c4cc3;var _0x1f2d62;const _0x25c880=await purchases_finished[_0x2397f6(0x2c7)]({'invoice':'INCF-'+_0x433fa9});return _0x25c880&&_0x25c880[_0x2397f6(0x2dc)]>0x0?_0x1f2d62=_0x2397f6(0x250)+_0x433fa9:_0x1f2d62=_0x2397f6(0x250)+_0x433fa9,_0x1f2d62;}router[a0_0x55c7a0(0x296)](a0_0x55c7a0(0x2dd),auth,async(_0x1fa28e,_0xd454)=>{var _0x480822=a0_0x55c7a0;try{const {username:_0x4d58fc,email:_0x164296,role:_0xc76b87}=_0x1fa28e[_0x480822(0x1ef)],_0x65bde7=_0x1fa28e[_0x480822(0x1ef)],_0x4e84ac=await profile[_0x480822(0x2c7)]({'email':_0x65bde7[_0x480822(0x1f9)]}),_0x31f05c=await master_shop[_0x480822(0x21f)](),_0x108277=await staff['findOne']({'email':_0x65bde7[_0x480822(0x1f9)]}),_0x1d0c3b=await suppliers[_0x480822(0x21f)]({});let _0x4ce64f;if(_0x65bde7[_0x480822(0x243)]==_0x480822(0x222)){const _0x50872a=await staff[_0x480822(0x2c7)]({'email':_0x65bde7[_0x480822(0x1f9)]});_0x4ce64f=await warehouse['aggregate']([{'$match':{'status':_0x480822(0x1fc),'name':_0x50872a['warehouse'],'warehouse_category':_0x480822(0x2e2)}},{'$group':{'_id':_0x480822(0x2a0),'name':{'$first':_0x480822(0x2a0)}}}]);}else _0x4ce64f=await warehouse[_0x480822(0x24c)]([{'$match':{'status':_0x480822(0x1fc),'warehouse_category':_0x480822(0x2e2),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x480822(0x2a0),'name':{'$first':'$name'}}}]);const _0x1ba1b4=await product[_0x480822(0x21f)]({}),_0x153fbc=await warehouse[_0x480822(0x21f)]({'status':_0x480822(0x1fc)}),_0x486e85=await purchases_finished['find']({}),_0x4c4950=_0x486e85[_0x480822(0x2dc)]+0x1,_0x5b8b65=_0x480822(0x250)+_0x4c4950['toString']()[_0x480822(0x2d8)](0x5,'0');var _0x31f10b=[_0x480822(0x22c),'Enclosed'];if(_0x31f05c[0x0][_0x480822(0x22f)]==_0x480822(0x231))var _0x294b7e=users[_0x480822(0x27c)];else{if(_0x31f05c[0x0][_0x480822(0x22f)]==_0x480822(0x2bd))var _0x294b7e=users[_0x480822(0x2bd)];else{if(_0x31f05c[0x0][_0x480822(0x22f)]=='German')var _0x294b7e=users[_0x480822(0x1e7)];else{if(_0x31f05c[0x0][_0x480822(0x22f)]==_0x480822(0x209))var _0x294b7e=users['Spanish'];else{if(_0x31f05c[0x0]['language']==_0x480822(0x1e6))var _0x294b7e=users['French'];else{if(_0x31f05c[0x0][_0x480822(0x22f)]==_0x480822(0x210))var _0x294b7e=users['Portuguese'];else{if(_0x31f05c[0x0][_0x480822(0x22f)]==_0x480822(0x239))var _0x294b7e=users[_0x480822(0x239)];else{if(_0x31f05c[0x0]['language']==_0x480822(0x2cd))var _0x294b7e=users[_0x480822(0x261)];}}}}}}}const _0xa21685=getRandom8DigitNumber();_0xa21685[_0x480822(0x252)](_0x7e5dbb=>{var _0x30554c=_0x480822;_0xd454[_0x30554c(0x2e4)](_0x30554c(0x20b),{'success':_0x1fa28e[_0x30554c(0x2d9)](_0x30554c(0x25b)),'errors':_0x1fa28e[_0x30554c(0x2d9)](_0x30554c(0x29b)),'role':_0x65bde7,'profile':_0x4e84ac,'suppliers':_0x1d0c3b,'warehouse':_0x4ce64f,'product':_0x1ba1b4,'invoice':_0x7e5dbb,'master_shop':_0x31f05c,'language':_0x294b7e,'find_data':_0x153fbc,'rooms_data':_0x31f10b});})[_0x480822(0x254)](_0x2c957b=>{var _0x4ad95b=_0x480822;_0x1fa28e[_0x4ad95b(0x2d9)]('errors',_0x4ad95b(0x2c0)),_0xd454[_0x4ad95b(0x1ed)](_0x4ad95b(0x2a5));});}catch(_0x5366bb){console['log'](_0x5366bb);}}),router['get']('/view/add_purchases/:id',auth,async(_0x341842,_0x64aa36)=>{var _0x2d819e=a0_0x55c7a0;try{const _0x23195d=_0x341842[_0x2d819e(0x299)]['id'];console['log'](_0x23195d);const _0xe00400=await master_shop[_0x2d819e(0x21f)]();console['log']('master',_0xe00400);const _0x56465e=await product[_0x2d819e(0x2c7)]({'name':_0x23195d});console['log'](_0x2d819e(0x276),_0x56465e),_0x64aa36[_0x2d819e(0x293)](0xc8)['json']({'product_data':_0x56465e,'master':_0xe00400});}catch(_0x1caef6){console[_0x2d819e(0x2a8)](_0x2d819e(0x2be),_0x1caef6);}}),router[a0_0x55c7a0(0x29a)](a0_0x55c7a0(0x2dd),auth,async(_0x77b84a,_0x11b67c)=>{var _0x5acccd=a0_0x55c7a0;try{const {invoice:_0x531cb1,date:_0x15b422,warehouse_name:_0xb52d78,prod_name:_0x39f5d3,prod_code:_0x6d99e0,prod_qty:_0x26ce3d,prod_unit:_0x3adbae,prod_secondunit:_0x226962,prod_level:_0x5f2551,prod_isle:_0x36ea47,prod_pallet:_0x45d168,note:_0x2f062a,expiry_date:_0x2d83e1,batch_code:_0x42930c,payable:_0x1f820d,due_amount:_0x3fe839,Room_name:_0x2f8956,primary_code:_0x51530e,secondary_code:_0x2b6db0,MaxStocks_data:_0x2038a5,PO_number:_0x519cc4,SCRN:_0x5ec5e4,JO_number:_0x5643ac}=_0x77b84a['body'];if(typeof _0x39f5d3==_0x5acccd(0x29d))var _0x5282ec=[_0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x25c)]],_0x348d6a=[_0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x266)]],_0x30fc97=[_0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x2aa)]],_0x287810=[_0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x283)]],_0x40feaf=[_0x77b84a['body'][_0x5acccd(0x20a)]],_0x16b88d=[_0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x269)]],_0x4eb391=[_0x77b84a['body']['primary_code']],_0x2aeb44=[_0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x224)]],_0x351ec8=[_0x77b84a['body'][_0x5acccd(0x2b0)]],_0x51b8de=[_0x77b84a['body']['batch_code']],_0x5ec75b=[_0x77b84a['body'][_0x5acccd(0x22b)]],_0x44dcd5=[_0x77b84a['body']['product_date']],_0x36f673=[_0x77b84a[_0x5acccd(0x1f5)]['max_product_unit']],_0x41027d=[_0x77b84a['body']['prod_cat']],_0x332ad4=[_0x77b84a['body'][_0x5acccd(0x242)]],_0x42c1ff=[_0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x21c)]];else var _0x5282ec=[..._0x77b84a['body']['prod_name']],_0x348d6a=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x266)]],_0x30fc97=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x2aa)]],_0x287810=[..._0x77b84a[_0x5acccd(0x1f5)]['prod_primunit']],_0x40feaf=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x20a)]],_0x16b88d=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x269)]],_0x4eb391=[..._0x77b84a['body'][_0x5acccd(0x27a)]],_0x2aeb44=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x224)]],_0x351ec8=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x2b0)]],_0x51b8de=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x275)]],_0x5ec75b=[..._0x77b84a['body'][_0x5acccd(0x22b)]],_0x44dcd5=[..._0x77b84a['body'][_0x5acccd(0x2c9)]],_0x36f673=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x285)]],_0x41027d=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x219)]],_0x332ad4=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x242)]],_0x42c1ff=[..._0x77b84a[_0x5acccd(0x1f5)][_0x5acccd(0x21c)]];const _0x342415=_0x5282ec[_0x5acccd(0x218)](_0x3d7324=>{return _0x3d7324={'product_name':_0x3d7324};});_0x348d6a[_0x5acccd(0x2a4)]((_0x206eaf,_0x4bc496)=>{_0x342415[_0x4bc496]['product_code']=_0x206eaf;}),_0x30fc97[_0x5acccd(0x2a4)]((_0xd2cbc,_0x1bdfe9)=>{_0x342415[_0x1bdfe9]['quantity']=Math['abs'](_0xd2cbc);}),_0x287810[_0x5acccd(0x2a4)]((_0x1cba01,_0x402370)=>{var _0x251264=_0x5acccd;_0x342415[_0x402370][_0x251264(0x28b)]=_0x1cba01;}),_0x40feaf[_0x5acccd(0x2a4)]((_0x53f446,_0x222723)=>{var _0x590138=_0x5acccd;_0x342415[_0x222723][_0x590138(0x2c2)]=_0x53f446;}),_0x16b88d['forEach']((_0x41c2bd,_0xcb2f3c)=>{_0x342415[_0xcb2f3c]['bay']=_0x41c2bd;}),_0x4eb391[_0x5acccd(0x2a4)]((_0x2d665c,_0x525cd8)=>{var _0x9f763c=_0x5acccd;_0x342415[_0x525cd8][_0x9f763c(0x27a)]=_0x2d665c;}),_0x2aeb44[_0x5acccd(0x2a4)]((_0x52b47d,_0x12a7bf)=>{var _0x108fee=_0x5acccd;_0x342415[_0x12a7bf][_0x108fee(0x224)]=_0x52b47d;}),_0x351ec8['forEach']((_0x7a8e4a,_0x2f4f7f)=>{var _0x32ce4b=_0x5acccd;_0x342415[_0x2f4f7f][_0x32ce4b(0x292)]=_0x7a8e4a;}),_0x51b8de[_0x5acccd(0x2a4)]((_0x14022a,_0x5a6f49)=>{var _0x1eae23=_0x5acccd;_0x342415[_0x5a6f49][_0x1eae23(0x275)]=_0x14022a;}),_0x5ec75b['forEach']((_0x3dbc9a,_0x120bbf)=>{var _0x4eb214=_0x5acccd;_0x342415[_0x120bbf][_0x4eb214(0x22b)]=_0x3dbc9a;}),_0x44dcd5[_0x5acccd(0x2a4)]((_0x590f7b,_0x423284)=>{var _0x5f2fb8=_0x5acccd;_0x342415[_0x423284][_0x5f2fb8(0x2c5)]=_0x590f7b;}),_0x36f673[_0x5acccd(0x2a4)]((_0x13ecbb,_0x244f40)=>{var _0x24f1a4=_0x5acccd;_0x342415[_0x244f40][_0x24f1a4(0x2a3)]=_0x13ecbb;}),_0x41027d['forEach']((_0x3e73a0,_0x3f4097)=>{_0x342415[_0x3f4097]['product_cat']=_0x3e73a0;}),_0x332ad4[_0x5acccd(0x2a4)]((_0x508e63,_0x47cb25)=>{var _0x377471=_0x5acccd;_0x342415[_0x47cb25][_0x377471(0x240)]=_0x508e63;}),_0x42c1ff[_0x5acccd(0x2a4)]((_0x15090b,_0x27164a)=>{_0x342415[_0x27164a]['invoice']=_0x15090b;});const _0x30c2ee=_0x342415[_0x5acccd(0x20f)](_0x40b956=>_0x40b956[_0x5acccd(0x2e0)]!=='0'&&_0x40b956[_0x5acccd(0x2e0)]!==''),_0x255900=new purchases_finished({'invoice':_0x531cb1,'suppliers':_0x77b84a['body'][_0x5acccd(0x25f)],'date':_0x15b422,'warehouse_name':_0xb52d78,'product':_0x30c2ee,'note':_0x2f062a,'due_amount':_0x3fe839,'room':_0x2f8956,'POnumber':_0x519cc4,'SCRN':_0x5ec5e4,'JO_number':_0x5643ac}),_0x3e4f3d=await _0x255900[_0x5acccd(0x21a)](),_0x24c02c=await purchases_finished[_0x5acccd(0x2c7)]({'invoice':_0x531cb1}),_0x244e18=_0x24c02c[_0x5acccd(0x276)]['map'](async _0x11fdc9=>{var _0x3c0565=_0x5acccd;try{var _0x2e721b=await warehouse[_0x3c0565(0x2c7)]({'name':_0xb52d78,'room':_0x11fdc9['room_name']}),_0xd73f41=0x0;const _0x2ff915=_0x2e721b['product_details']['map'](_0x2a7e0c=>{var _0x29ba10=_0x3c0565;console['log'](_0x2a7e0c[_0x29ba10(0x2b7)]+'=='+_0x11fdc9[_0x29ba10(0x2b7)]+'&&'+_0x2a7e0c['bay']+'=='+_0x11fdc9[_0x29ba10(0x23c)]+'&&'+_0x2a7e0c['expiry_date']+'=='+_0x11fdc9[_0x29ba10(0x22b)]+'&&'+_0x2a7e0c[_0x29ba10(0x2c5)]+'=='+_0x11fdc9['production_date']+'&&'+_0x2a7e0c[_0x29ba10(0x275)]+'=='+_0x11fdc9[_0x29ba10(0x275)]+'&&'+_0x2a7e0c[_0x29ba10(0x2bc)]+'=='+_0x24c02c[_0x29ba10(0x2bc)]),_0x2a7e0c['product_name']==_0x11fdc9[_0x29ba10(0x2b7)]&&_0x2a7e0c[_0x29ba10(0x23c)]==_0x11fdc9['bay']&&_0x2a7e0c['expiry_date']==_0x11fdc9[_0x29ba10(0x22b)]&&_0x2a7e0c[_0x29ba10(0x2c5)]==_0x11fdc9[_0x29ba10(0x2c5)]&&_0x2a7e0c['batch_code']==_0x11fdc9[_0x29ba10(0x275)]&&_0x2a7e0c[_0x29ba10(0x2bc)]==_0x24c02c['invoice']&&(_0x2a7e0c['product_stock']=Math[_0x29ba10(0x217)](_0x2a7e0c[_0x29ba10(0x268)])+Math['abs'](_0x11fdc9[_0x29ba10(0x2e0)]),_0xd73f41++);});return _0xd73f41==0x0&&(_0x2e721b['product_details']=_0x2e721b[_0x3c0565(0x2d1)]['concat']({'product_name':_0x11fdc9['product_name'],'product_stock':Math[_0x3c0565(0x217)](_0x11fdc9[_0x3c0565(0x2e0)]),'primary_code':_0x11fdc9[_0x3c0565(0x27a)],'secondary_code':_0x11fdc9[_0x3c0565(0x224)],'product_code':_0x11fdc9[_0x3c0565(0x294)],'bay':_0x11fdc9['bay'],'maxProducts':_0x11fdc9[_0x3c0565(0x292)],'unit':_0x11fdc9[_0x3c0565(0x28b)],'secondary_unit':_0x11fdc9[_0x3c0565(0x2c2)],'expiry_date':_0x11fdc9[_0x3c0565(0x22b)],'production_date':_0x11fdc9[_0x3c0565(0x2c5)],'maxProducts':_0x11fdc9[_0x3c0565(0x292)],'maxPerUnit':_0x11fdc9['maxperunit'],'batch_code':_0x11fdc9[_0x3c0565(0x275)],'product_cat':_0x11fdc9[_0x3c0565(0x1e8)],'invoice':_0x11fdc9[_0x3c0565(0x2bc)],'id_incoming':_0x11fdc9[_0x3c0565(0x2b6)]})),_0x2e721b;}catch(_0x3f9cde){return console[_0x3c0565(0x2a7)](_0x3c0565(0x207),_0x3f9cde),null;}});Promise[_0x5acccd(0x212)](_0x244e18)[_0x5acccd(0x252)](async _0x4dbdf0=>{var _0x538ab5=_0x5acccd;try{for(const _0x2dd0c9 of _0x4dbdf0){await warehouse[_0x538ab5(0x2ae)]({'_id':_0x2dd0c9[_0x538ab5(0x2b6)]},{'$addToSet':{'product_details':{'$each':_0x2dd0c9['product_details']}}});}const _0x54d5ba=await master_shop[_0x538ab5(0x21f)](),_0x4d87e2=await email_settings[_0x538ab5(0x2c7)](),_0x333d2c=await supervisor_settings[_0x538ab5(0x21f)]();var _0x84a3b0=_0x24c02c[_0x538ab5(0x276)],_0x3ab8a7='',_0x19da28;for(_0x19da28 in _0x84a3b0){var _0x4aefe8='FG';_0x24c02c['warehouse_name']==_0x538ab5(0x2b2)&&(_0x4aefe8='DG'),_0x3ab8a7+=_0x538ab5(0x23f)+_0x538ab5(0x24e)+_0x84a3b0[_0x19da28][_0x538ab5(0x2b7)]+'</td>'+_0x538ab5(0x24e)+_0x84a3b0[_0x19da28]['product_code']+_0x538ab5(0x2b1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x84a3b0[_0x19da28][_0x538ab5(0x2e0)]+_0x538ab5(0x2b1)+_0x538ab5(0x24e)+_0x84a3b0[_0x19da28]['standard_unit']+_0x538ab5(0x2b1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x84a3b0[_0x19da28][_0x538ab5(0x2c2)]+_0x538ab5(0x2b1)+_0x538ab5(0x24e)+_0x24c02c[_0x538ab5(0x287)]+_0x538ab5(0x2b1)+_0x538ab5(0x24e)+_0x84a3b0[_0x19da28][_0x538ab5(0x240)]+'</td>'+_0x538ab5(0x24e)+_0x4aefe8+_0x84a3b0[_0x19da28][_0x538ab5(0x23c)]+_0x538ab5(0x2b1),_0x538ab5(0x26c);}let _0x6508a0=nodemailer[_0x538ab5(0x29e)]({'host':_0x4d87e2[_0x538ab5(0x244)],'port':Number(_0x4d87e2[_0x538ab5(0x201)]),'secure':![],'auth':{'user':_0x4d87e2[_0x538ab5(0x1f9)],'pass':_0x4d87e2[_0x538ab5(0x1fd)]}}),_0x131e4e={'from':_0x4d87e2[_0x538ab5(0x1f9)],'to':_0x333d2c[0x0]['FGSEmail'],'subject':_0x538ab5(0x232),'attachments':[{'filename':_0x538ab5(0x260),'path':__dirname+_0x538ab5(0x211)+'/upload/'+_0x54d5ba[0x0]['image'],'cid':_0x538ab5(0x20e)}],'html':_0x538ab5(0x2ca)+'<html><head><title></title>'+_0x538ab5(0x1fa)+'<div>'+_0x538ab5(0x206)+_0x538ab5(0x205)+_0x538ab5(0x2b4)+_0x538ab5(0x2c8)+_0x538ab5(0x205)+_0x538ab5(0x235)+_0x54d5ba[0x0]['site_title']+'\x20</h2>'+_0x538ab5(0x2c8)+_0x538ab5(0x2c8)+'<hr\x20class=\x22my-3\x22>'+_0x538ab5(0x205)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x538ab5(0x2cf)+_0x24c02c['invoice']+'\x20'+_0x538ab5(0x2da)+_0x538ab5(0x2c6)+_0x24c02c[_0x538ab5(0x23b)]+'\x20'+'</span>'+_0x538ab5(0x28d)+_0x538ab5(0x2c8)+_0x538ab5(0x25e)+_0x538ab5(0x2ce)+'<tr>'+_0x538ab5(0x289)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x538ab5(0x23e)+_0x538ab5(0x253)+_0x538ab5(0x226)+_0x538ab5(0x1f0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x538ab5(0x233)+_0x538ab5(0x26c)+_0x538ab5(0x262)+_0x538ab5(0x291)+'\x20'+_0x3ab8a7+'\x20'+'</tbody>'+_0x538ab5(0x230)+_0x538ab5(0x205)+_0x538ab5(0x234)+'<h5>'+_0x54d5ba[0x0]['site_title']+_0x538ab5(0x28d)+_0x538ab5(0x2c8)+'</div>'+_0x538ab5(0x264)};_0x6508a0[_0x538ab5(0x21d)](_0x131e4e,function(_0x645ff0,_0x15125f){var _0x5923e4=_0x538ab5;_0x645ff0?(console[_0x5923e4(0x2a8)](_0x645ff0),console[_0x5923e4(0x2a8)](_0x5923e4(0x286))):console[_0x5923e4(0x2a8)](_0x5923e4(0x1eb));});}catch(_0x333c5a){console[_0x538ab5(0x2a7)](_0x333c5a),_0x11b67c[_0x538ab5(0x293)](0x1f4)[_0x538ab5(0x2e5)]({'error':_0x538ab5(0x278),'message':_0x333c5a[_0x538ab5(0x236)]});}})[_0x5acccd(0x254)](_0x35418a=>{var _0x374b7f=_0x5acccd;console[_0x374b7f(0x2a7)](_0x35418a);}),_0x77b84a[_0x5acccd(0x2d9)]('success','purchase\x20data\x20add\x20successfully'),_0x11b67c['redirect'](_0x5acccd(0x2a5));}catch(_0x40d359){console[_0x5acccd(0x2a8)](_0x40d359);}}),router[a0_0x55c7a0(0x296)](a0_0x55c7a0(0x29f),auth,async(_0x5090b8,_0x2d1f72)=>{var _0x22e610=a0_0x55c7a0;try{const {username:_0x3b64e2,email:_0x292991,role:_0x1d64f0}=_0x5090b8['user'],_0x430e8d=_0x5090b8['user'],_0x32b2d9=await profile[_0x22e610(0x2c7)]({'email':_0x430e8d[_0x22e610(0x1f9)]}),_0x463f58=await master_shop[_0x22e610(0x21f)](),_0x5cb848=_0x5090b8[_0x22e610(0x299)]['id'],_0x350d75=await purchases_finished[_0x22e610(0x265)](_0x5cb848),_0x5b841b=await suppliers[_0x22e610(0x21f)]({});let _0x1eae1a;if(_0x430e8d[_0x22e610(0x243)]==_0x22e610(0x222)){const _0x56dd4e=await staff[_0x22e610(0x2c7)]({'email':_0x430e8d[_0x22e610(0x1f9)]});_0x1eae1a=await warehouse[_0x22e610(0x21f)]({'status':_0x22e610(0x1fc),'name':_0x56dd4e['warehouse'],'warehouse_category':_0x22e610(0x2e2)});}else _0x1eae1a=await warehouse[_0x22e610(0x24c)]([{'$match':{'status':'Enabled','warehouse_category':_0x22e610(0x2e2)}},{'$group':{'_id':_0x22e610(0x2a0),'name':{'$first':_0x22e610(0x2a0)}}}]);const _0x2bcd5c=await product[_0x22e610(0x21f)]({}),_0xaef72=BayBinSelected(_0x350d75['warehouse_name'],_0x350d75[_0x22e610(0x21b)]);let _0x14fc85=new Date(_0x350d75[_0x22e610(0x22b)]),_0x30e78d=('0'+_0x14fc85[_0x22e610(0x28a)]())[_0x22e610(0x26e)](-0x2),_0xb008c=('0'+(_0x14fc85[_0x22e610(0x288)]()+0x1))[_0x22e610(0x26e)](-0x2),_0x6ab5fd=_0x14fc85[_0x22e610(0x2ac)](),_0x588dc6=_0x6ab5fd+'-'+_0xb008c+'-'+_0x30e78d;if(_0x463f58[0x0][_0x22e610(0x22f)]==_0x22e610(0x231)){var _0x2027e0=users[_0x22e610(0x27c)];console['log'](_0x2027e0);}else{if(_0x463f58[0x0][_0x22e610(0x22f)]==_0x22e610(0x2bd))var _0x2027e0=users['Hindi'];else{if(_0x463f58[0x0][_0x22e610(0x22f)]==_0x22e610(0x1e7))var _0x2027e0=users[_0x22e610(0x1e7)];else{if(_0x463f58[0x0]['language']==_0x22e610(0x209))var _0x2027e0=users['Spanish'];else{if(_0x463f58[0x0][_0x22e610(0x22f)]==_0x22e610(0x1e6))var _0x2027e0=users[_0x22e610(0x1e6)];else{if(_0x463f58[0x0][_0x22e610(0x22f)]==_0x22e610(0x210))var _0x2027e0=users[_0x22e610(0x28e)];else{if(_0x463f58[0x0]['language']=='Chinese')var _0x2027e0=users[_0x22e610(0x239)];else{if(_0x463f58[0x0][_0x22e610(0x22f)]==_0x22e610(0x2cd))var _0x2027e0=users[_0x22e610(0x261)];}}}}}}}_0x2d1f72[_0x22e610(0x2e4)]('edit_purchases_finished_view',{'success':_0x5090b8[_0x22e610(0x2d9)](_0x22e610(0x25b)),'errors':_0x5090b8[_0x22e610(0x2d9)](_0x22e610(0x29b)),'role':_0x430e8d,'profile':_0x32b2d9,'purchases':_0x350d75,'suppliers':_0x5b841b,'warehouse':_0x1eae1a,'product':_0x2bcd5c,'master_shop':_0x463f58,'language':_0x2027e0,'ed_fullDate':_0x588dc6,'dataSelected':_0xaef72});}catch(_0xd17bf3){console[_0x22e610(0x2a8)](_0xd17bf3);}}),router['get']('/view/:id',auth,async(_0x4304e4,_0x5574f7)=>{var _0x430089=a0_0x55c7a0;try{const {username:_0x4b0ea7,email:_0x51543f,role:_0x2587a3}=_0x4304e4['user'],_0x370a24=_0x4304e4[_0x430089(0x1ef)],_0xa615c3=await profile[_0x430089(0x2c7)]({'email':_0x370a24[_0x430089(0x1f9)]}),_0x475bf1=await master_shop['find'](),_0x5db106=_0x4304e4['params']['id'],_0xefcf2=await purchases_finished[_0x430089(0x265)](_0x5db106),_0xa6ffe5=await suppliers[_0x430089(0x21f)]({});let _0x3ebc63;if(_0x370a24[_0x430089(0x243)]==_0x430089(0x222)){const _0x3898bc=await staff[_0x430089(0x2c7)]({'email':_0x370a24[_0x430089(0x1f9)]});_0x3ebc63=await warehouse[_0x430089(0x21f)]({'status':_0x430089(0x1fc),'name':_0x3898bc[_0x430089(0x208)],'warehouse_category':_0x430089(0x2e2)});}else _0x3ebc63=await warehouse[_0x430089(0x24c)]([{'$match':{'status':_0x430089(0x1fc),'warehouse_category':_0x430089(0x2e2)}},{'$group':{'_id':_0x430089(0x2a0),'name':{'$first':_0x430089(0x2a0)}}}]);const _0x4e966a=await product[_0x430089(0x21f)]({}),_0x5dd3c4=BayBinSelected(_0xefcf2['warehouse_name'],_0xefcf2[_0x430089(0x21b)]);let _0x4adee7=new Date(_0xefcf2['expiry_date']),_0x5450f1=('0'+_0x4adee7[_0x430089(0x28a)]())['slice'](-0x2),_0x417d7d=('0'+(_0x4adee7[_0x430089(0x288)]()+0x1))[_0x430089(0x26e)](-0x2),_0xc36711=_0x4adee7['getFullYear'](),_0xdab478=_0xc36711+'-'+_0x417d7d+'-'+_0x5450f1;if(_0x475bf1[0x0][_0x430089(0x22f)]==_0x430089(0x231)){var _0x302882=users[_0x430089(0x27c)];console[_0x430089(0x2a8)](_0x302882);}else{if(_0x475bf1[0x0][_0x430089(0x22f)]=='Hindi')var _0x302882=users[_0x430089(0x2bd)];else{if(_0x475bf1[0x0][_0x430089(0x22f)]==_0x430089(0x1e7))var _0x302882=users['German'];else{if(_0x475bf1[0x0]['language']==_0x430089(0x209))var _0x302882=users[_0x430089(0x209)];else{if(_0x475bf1[0x0][_0x430089(0x22f)]==_0x430089(0x1e6))var _0x302882=users[_0x430089(0x1e6)];else{if(_0x475bf1[0x0]['language']==_0x430089(0x210))var _0x302882=users[_0x430089(0x28e)];else{if(_0x475bf1[0x0][_0x430089(0x22f)]=='Chinese')var _0x302882=users[_0x430089(0x239)];else{if(_0x475bf1[0x0][_0x430089(0x22f)]==_0x430089(0x2cd))var _0x302882=users[_0x430089(0x261)];}}}}}}}_0x5574f7[_0x430089(0x2e4)]('edit_purchases_finished',{'success':_0x4304e4[_0x430089(0x2d9)](_0x430089(0x25b)),'errors':_0x4304e4['flash'](_0x430089(0x29b)),'role':_0x370a24,'profile':_0xa615c3,'purchases':_0xefcf2,'suppliers':_0xa6ffe5,'warehouse':_0x3ebc63,'product':_0x4e966a,'master_shop':_0x475bf1,'language':_0x302882,'ed_fullDate':_0xdab478,'dataSelected':_0x5dd3c4});}catch(_0x8c1580){console[_0x430089(0x2a8)](_0x8c1580);}}),router[a0_0x55c7a0(0x29a)](a0_0x55c7a0(0x245),auth,async(_0x4f902f,_0x3fc27c)=>{var _0x47fb9b=a0_0x55c7a0;try{const _0x2a1ade=_0x4f902f[_0x47fb9b(0x299)]['id'],_0x4c69be=await purchases_finished[_0x47fb9b(0x2c7)]({'_id':_0x4f902f['params']['id']}),_0x4044d8=await warehouse[_0x47fb9b(0x2c7)]({'name':_0x4c69be['warehouse_name'],'room':_0x4c69be[_0x47fb9b(0x21b)]});_0x4c69be[_0x47fb9b(0x276)][_0x47fb9b(0x2a4)](_0x1abe1e=>{var _0x483d6d=_0x47fb9b;const _0x29de3e=_0x4044d8[_0x483d6d(0x2d1)]['map'](_0x59a373=>{var _0x48f80b=_0x483d6d;_0x59a373[_0x48f80b(0x2b7)]==_0x1abe1e['product_name']&&_0x59a373[_0x48f80b(0x23c)]==_0x1abe1e['bay']&&(_0x59a373['product_stock']=parseInt(_0x59a373[_0x48f80b(0x268)])-parseInt(_0x1abe1e[_0x48f80b(0x2e0)]));});}),await _0x4044d8['save']();const {invoice:_0x1cbce9,suppliers:_0x2486ae,date:_0x213344,warehouse_name:_0x5c0da3,prod_name:_0x60cf71,prod_code:_0x50ea4f,prod_qty:_0x120097,prod_unit:_0x1edf75,prod_secondunit:_0x1f9e5b,prod_level:_0x1a4204,prod_isle:_0x2ab8e7,prod_pallet:_0x3dc740,note:_0x243784,expiry_date:_0x424d0d,batch_code:_0x40cb22,paid_amount:_0x31d50c,due_amount:_0x4580e3,Room_name:_0x2e6acf,primary_code:_0x202f67,secondary_code:_0x50485f,PO_number:_0xcbd8e2,JO_number:_0x1b32a7}=_0x4f902f[_0x47fb9b(0x1f5)];if(typeof _0x60cf71==_0x47fb9b(0x29d))var _0x418464=[_0x4f902f['body'][_0x47fb9b(0x25c)]],_0x56a73b=[_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x266)]],_0xea1732=[_0x4f902f[_0x47fb9b(0x1f5)]['prod_qty']],_0x4cfde2=[_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x277)]],_0x1fa977=[_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x20a)]],_0x5d4247=[_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x269)]],_0x293e1c=[_0x4f902f['body'][_0x47fb9b(0x27a)]],_0x54e8c6=[_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x224)]],_0x15aff3=[_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x2b0)]],_0xf00902=[_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x275)]],_0x1ec2af=[_0x4f902f['body']['expiry_date']];else var _0x418464=[..._0x4f902f[_0x47fb9b(0x1f5)]['prod_name']],_0x56a73b=[..._0x4f902f['body']['prod_code']],_0xea1732=[..._0x4f902f[_0x47fb9b(0x1f5)]['prod_qty']],_0x4cfde2=[..._0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x277)]],_0x1fa977=[..._0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x20a)]],_0x5d4247=[..._0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x269)]],_0x293e1c=[..._0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x27a)]],_0x54e8c6=[..._0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x224)]],_0x15aff3=[..._0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x2b0)]],_0xf00902=[..._0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x275)]],_0x1ec2af=[..._0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x22b)]];const _0x1b9795=_0x418464['map'](_0x3078a6=>{return _0x3078a6={'product_name':_0x3078a6};});_0x56a73b[_0x47fb9b(0x2a4)]((_0x1e8928,_0x3c0109)=>{var _0x44807a=_0x47fb9b;_0x1b9795[_0x3c0109][_0x44807a(0x294)]=_0x1e8928;}),_0xea1732['forEach']((_0x5a4108,_0x233707)=>{var _0x165348=_0x47fb9b;_0x1b9795[_0x233707][_0x165348(0x2e0)]=_0x5a4108;}),_0x4cfde2[_0x47fb9b(0x2a4)]((_0x33efdb,_0x22d8f3)=>{var _0x255752=_0x47fb9b;_0x1b9795[_0x22d8f3][_0x255752(0x28b)]=_0x33efdb;}),_0x1fa977[_0x47fb9b(0x2a4)]((_0xa2ccf6,_0xb7b60f)=>{_0x1b9795[_0xb7b60f]['secondary_unit']=_0xa2ccf6;}),_0x5d4247[_0x47fb9b(0x2a4)]((_0x2b8441,_0x3a78b6)=>{var _0x2ae232=_0x47fb9b;_0x1b9795[_0x3a78b6][_0x2ae232(0x23c)]=_0x2b8441;}),_0x293e1c['forEach']((_0x1ed40b,_0x1eedd4)=>{var _0x38573=_0x47fb9b;_0x1b9795[_0x1eedd4][_0x38573(0x27a)]=_0x1ed40b;}),_0x54e8c6[_0x47fb9b(0x2a4)]((_0x64da93,_0x5d630c)=>{_0x1b9795[_0x5d630c]['secondary_code']=_0x64da93;}),_0x15aff3[_0x47fb9b(0x2a4)]((_0x364a37,_0x2ab801)=>{var _0x51f4b5=_0x47fb9b;_0x1b9795[_0x2ab801][_0x51f4b5(0x292)]=_0x364a37;}),_0xf00902[_0x47fb9b(0x2a4)]((_0x3db84b,_0x37a60d)=>{_0x1b9795[_0x37a60d]['batch_code']=_0x3db84b;}),_0x1ec2af['forEach']((_0x4d8045,_0x1f0949)=>{var _0x5b46a5=_0x47fb9b;_0x1b9795[_0x1f0949][_0x5b46a5(0x22b)]=_0x4d8045;});const _0x3ae2ab=_0x1b9795['filter'](_0x445bd3=>_0x445bd3[_0x47fb9b(0x2e0)]!=='0'&&_0x445bd3[_0x47fb9b(0x2e0)]!=='');_0x4c69be[_0x47fb9b(0x2bc)]=_0x1cbce9,_0x4c69be[_0x47fb9b(0x25f)]=_0x2486ae,_0x4c69be['date']=_0x213344,_0x4c69be[_0x47fb9b(0x287)]=_0x5c0da3,_0x4c69be[_0x47fb9b(0x276)]=_0x3ae2ab,_0x4c69be[_0x47fb9b(0x2d4)]=_0x243784,_0x4c69be[_0x47fb9b(0x2d6)]=_0x31d50c,_0x4c69be[_0x47fb9b(0x2a2)]=_0x4580e3,_0x4c69be[_0x47fb9b(0x21b)]=_0x2e6acf,_0x4c69be[_0x47fb9b(0x228)]=_0xcbd8e2,_0x4c69be[_0x47fb9b(0x290)]=_0x1b32a7;const _0x3e15f0=await _0x4c69be['save'](),_0x35b7e8=await warehouse[_0x47fb9b(0x2c7)]({'name':_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x287)],'room':_0x4f902f['body'][_0x47fb9b(0x216)]});_0x4c69be[_0x47fb9b(0x276)][_0x47fb9b(0x2a4)](_0x4d7cc9=>{var _0x1e8f46=_0x47fb9b,_0x373dec=0x0;const _0xeeb986=_0x35b7e8[_0x1e8f46(0x2d1)][_0x1e8f46(0x218)](_0x2caee6=>{var _0x47076d=_0x1e8f46;_0x2caee6['product_name']==_0x4d7cc9[_0x47076d(0x2b7)]&&_0x2caee6[_0x47076d(0x23c)]==_0x4d7cc9[_0x47076d(0x23c)]&&(_0x2caee6[_0x47076d(0x268)]=parseInt(_0x2caee6[_0x47076d(0x268)])+parseInt(_0x4d7cc9['quantity']),_0x373dec++);});_0x373dec=='0'&&(_0x35b7e8[_0x1e8f46(0x2d1)]=_0x35b7e8[_0x1e8f46(0x2d1)][_0x1e8f46(0x214)]({'product_name':_0x4d7cc9[_0x1e8f46(0x2b7)],'product_stock':_0x4d7cc9[_0x1e8f46(0x2e0)],'primary_code':_0x4d7cc9[_0x1e8f46(0x27a)],'secondary_code':_0x4d7cc9[_0x1e8f46(0x224)],'product_code':_0x4d7cc9[_0x1e8f46(0x294)],'bay':_0x4d7cc9['bay'],'maxProducts':_0x4d7cc9[_0x1e8f46(0x292)],'unit':_0x4d7cc9[_0x1e8f46(0x28b)],'secondary_unit':_0x4d7cc9[_0x1e8f46(0x2c2)],'expiry_date':_0x4d7cc9[_0x1e8f46(0x22b)]}));}),await _0x35b7e8[_0x47fb9b(0x21a)]();const _0x5a179c=await s_payment_data['findOne']({'invoice':_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x2bc)]});if(_0x5a179c===null){}else console[_0x47fb9b(0x2a8)]('suppliers',_0x5a179c,_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x2bc)]),_0x5a179c[_0x47fb9b(0x25f)]=_0x4f902f[_0x47fb9b(0x1f5)][_0x47fb9b(0x25f)],await _0x5a179c[_0x47fb9b(0x21a)]();_0x4f902f['flash'](_0x47fb9b(0x25b),_0x47fb9b(0x248)),_0x3fc27c[_0x47fb9b(0x1ed)](_0x47fb9b(0x2a5));}catch(_0xf3c06d){console[_0x47fb9b(0x2a8)](_0xf3c06d);}}),router[a0_0x55c7a0(0x29a)](a0_0x55c7a0(0x28c),auth,async(_0x38216c,_0x12d9c5)=>{var _0x2b866e=a0_0x55c7a0;try{const _0x3451af=_0x38216c[_0x2b866e(0x299)]['id'],{invoice:_0x34e9d2,suppliers:_0x18fd77,payable:_0x1eac6f,due_amount:_0x3410c8}=_0x38216c[_0x2b866e(0x1f5)],_0x3e9c6b=await purchases['findById'](_0x3451af);var _0x347875=_0x1eac6f-_0x3410c8;_0x3e9c6b[_0x2b866e(0x2d6)]=parseFloat(_0x3e9c6b['paid_amount'])+parseFloat(_0x3410c8),_0x3e9c6b[_0x2b866e(0x2a2)]=_0x347875;const _0x140d4a=await _0x3e9c6b[_0x2b866e(0x21a)]();console[_0x2b866e(0x2a8)](_0x140d4a);const _0x5e53f9=await s_payment_data[_0x2b866e(0x2c7)]({'invoice':_0x34e9d2});_0x5e53f9[_0x2b866e(0x297)]=_0x347875,await _0x5e53f9['save']();let _0x59b227=new Date(),_0x266105=('0'+_0x59b227[_0x2b866e(0x28a)]())[_0x2b866e(0x26e)](-0x2),_0x36db44=('0'+(_0x59b227[_0x2b866e(0x288)]()+0x1))['slice'](-0x2),_0x1579cd=_0x59b227[_0x2b866e(0x2ac)](),_0x12b717=_0x1579cd+'-'+_0x36db44+'-'+_0x266105;const _0x483884=new suppliers_payment({'invoice':_0x34e9d2,'date':_0x1579cd+'-'+_0x36db44+'-'+_0x266105,'suppliers':_0x18fd77,'reason':_0x2b866e(0x22e),'amount':_0x3410c8}),_0x524876=await _0x483884['save']();_0x38216c[_0x2b866e(0x2d9)]('success','payment\x20successfull'),_0x12d9c5['redirect'](_0x2b866e(0x2a6));}catch(_0x2f51b5){console[_0x2b866e(0x2a8)](_0x2f51b5);}}),router[a0_0x55c7a0(0x296)]('/invoice/:id',auth,async(_0x2663d4,_0x34b175)=>{var _0x20adc2=a0_0x55c7a0;try{const {username:_0x539f11,email:_0x55e428,role:_0x29af49}=_0x2663d4['user'],_0x58bcef=_0x2663d4[_0x20adc2(0x1ef)],_0x49856b=await profile[_0x20adc2(0x2c7)]({'email':_0x58bcef[_0x20adc2(0x1f9)]}),_0x5e0d6a=await master_shop['find']();console[_0x20adc2(0x2a8)](_0x20adc2(0x2bb),_0x5e0d6a);const _0x252dc5=_0x2663d4['params']['id'],_0x551147=await purchases[_0x20adc2(0x265)](_0x252dc5);console[_0x20adc2(0x2a8)](_0x551147);const _0x3cfa30=await suppliers[_0x20adc2(0x2c7)]({'name':_0x551147[_0x20adc2(0x25f)]});console[_0x20adc2(0x2a8)](_0x3cfa30);if(_0x5e0d6a[0x0][_0x20adc2(0x22f)]==_0x20adc2(0x231)){var _0x32e5d8=users[_0x20adc2(0x27c)];console[_0x20adc2(0x2a8)](_0x32e5d8);}else{if(_0x5e0d6a[0x0]['language']==_0x20adc2(0x2bd))var _0x32e5d8=users[_0x20adc2(0x2bd)];else{if(_0x5e0d6a[0x0][_0x20adc2(0x22f)]=='German')var _0x32e5d8=users['German'];else{if(_0x5e0d6a[0x0][_0x20adc2(0x22f)]==_0x20adc2(0x209))var _0x32e5d8=users[_0x20adc2(0x209)];else{if(_0x5e0d6a[0x0][_0x20adc2(0x22f)]==_0x20adc2(0x1e6))var _0x32e5d8=users[_0x20adc2(0x1e6)];else{if(_0x5e0d6a[0x0][_0x20adc2(0x22f)]==_0x20adc2(0x210))var _0x32e5d8=users['Portuguese'];else{if(_0x5e0d6a[0x0][_0x20adc2(0x22f)]==_0x20adc2(0x239))var _0x32e5d8=users[_0x20adc2(0x239)];else{if(_0x5e0d6a[0x0][_0x20adc2(0x22f)]==_0x20adc2(0x2cd))var _0x32e5d8=users[_0x20adc2(0x261)];}}}}}}}_0x34b175['render'](_0x20adc2(0x258),{'success':_0x2663d4[_0x20adc2(0x2d9)](_0x20adc2(0x25b)),'errors':_0x2663d4[_0x20adc2(0x2d9)](_0x20adc2(0x29b)),'role':_0x58bcef,'profile':_0x49856b,'master_shop':_0x5e0d6a,'supplier':_0x3cfa30,'purchase':_0x551147,'language':_0x32e5d8});}catch(_0x4b2e31){console[_0x20adc2(0x2a8)](_0x4b2e31);}}),router[a0_0x55c7a0(0x296)](a0_0x55c7a0(0x203),auth,async(_0x490846,_0x3df5be)=>{var _0x574f05=a0_0x55c7a0;try{const {username:_0x208b78,email:_0x4f721c,role:_0x481192}=_0x490846[_0x574f05(0x1ef)],_0x5c6424=_0x490846['user'],_0x188641=await profile[_0x574f05(0x2c7)]({'email':_0x5c6424[_0x574f05(0x1f9)]}),_0x23ec0b=await master_shop['find']();console['log'](_0x574f05(0x2bb),_0x23ec0b);const _0x2772fc=_0x490846[_0x574f05(0x299)]['id'];console[_0x574f05(0x2a8)](_0x2772fc);const _0x27a416=await purchases_finished[_0x574f05(0x265)](_0x2772fc);console[_0x574f05(0x2a8)]('user_id',_0x27a416);const _0x1c8e50=await product[_0x574f05(0x21f)]({}),_0x3e5750=await warehouse['aggregate']([{'$match':{'name':_0x27a416[_0x574f05(0x287)],'room':_0x27a416[_0x574f05(0x21b)]}},{'$unwind':_0x574f05(0x2d0)},{'$group':{'_id':_0x574f05(0x220),'name':{'$first':_0x574f05(0x2df)},'product_stock':{'$first':_0x574f05(0x270)},'bay':{'$first':_0x574f05(0x1ec)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x574f05(0x200)},'floorlevel':{'$first':_0x574f05(0x282)},'primary_code':{'$first':_0x574f05(0x1f7)},'secondary_code':{'$first':_0x574f05(0x2d5)},'product_code':{'$first':_0x574f05(0x273)},'storage':{'$first':_0x574f05(0x26d)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x574f05(0x2a8)](_0x574f05(0x274),_0x3e5750);let _0x4deecb;if(_0x5c6424[_0x574f05(0x243)]=='staff'){const _0x2622d8=await staff[_0x574f05(0x2c7)]({'email':_0x5c6424['email']});_0x4deecb=await warehouse[_0x574f05(0x21f)]({'status':_0x574f05(0x1fc),'name':_0x2622d8[_0x574f05(0x208)],'warehouse_category':_0x574f05(0x2e2),'name':_0x574f05(0x2d2)});}else _0x4deecb=await warehouse['aggregate']([{'$match':{'status':_0x574f05(0x1fc),'warehouse_category':_0x574f05(0x2e2),'name':_0x574f05(0x2d2)}},{'$group':{'_id':_0x574f05(0x2a0),'name':{'$first':'$name'}}}]);if(_0x23ec0b[0x0][_0x574f05(0x22f)]==_0x574f05(0x231)){var _0x57c376=users[_0x574f05(0x27c)];console[_0x574f05(0x2a8)](_0x57c376);}else{if(_0x23ec0b[0x0]['language']==_0x574f05(0x2bd))var _0x57c376=users[_0x574f05(0x2bd)];else{if(_0x23ec0b[0x0][_0x574f05(0x22f)]==_0x574f05(0x1e7))var _0x57c376=users[_0x574f05(0x1e7)];else{if(_0x23ec0b[0x0][_0x574f05(0x22f)]=='Spanish')var _0x57c376=users['Spanish'];else{if(_0x23ec0b[0x0][_0x574f05(0x22f)]==_0x574f05(0x1e6))var _0x57c376=users['French'];else{if(_0x23ec0b[0x0][_0x574f05(0x22f)]==_0x574f05(0x210))var _0x57c376=users[_0x574f05(0x28e)];else{if(_0x23ec0b[0x0][_0x574f05(0x22f)]==_0x574f05(0x239))var _0x57c376=users[_0x574f05(0x239)];else{if(_0x23ec0b[0x0][_0x574f05(0x22f)]==_0x574f05(0x2cd))var _0x57c376=users['Arabic'];}}}}}}}_0x3df5be['render'](_0x574f05(0x251),{'success':_0x490846[_0x574f05(0x2d9)]('success'),'errors':_0x490846['flash'](_0x574f05(0x29b)),'role':_0x5c6424,'profile':_0x188641,'user':_0x27a416,'stock':_0x3e5750,'master_shop':_0x23ec0b,'product':_0x1c8e50,'language':_0x57c376,'warehouse':_0x4deecb});}catch(_0x11babd){console[_0x574f05(0x2a8)](_0x11babd);}}),router[a0_0x55c7a0(0x29a)](a0_0x55c7a0(0x203),auth,async(_0x48cf66,_0x530a7d)=>{var _0x2ee591=a0_0x55c7a0;try{const {invoice:_0x2b84ca,date:_0x27bf9e,warehouse_name:_0x4e92c6,Room_name:_0x4d5a4b,product_name:_0x5beddf,purchase_quantity:_0x93065f,stocks:_0x2616c6,return_qty:_0x1f92fa,note:_0x14d734,level:_0x829e18,isle:_0x221f16,pallet:_0x2d90ba,to_warehouse_name:_0x59e2f0,to_Room_name:_0x2c3172}=_0x48cf66[_0x2ee591(0x1f5)],_0xfd93b1=await purchases_finished[_0x2ee591(0x2c7)]({'_id':_0x48cf66['params']['id']}),_0x16ebe4=await warehouse[_0x2ee591(0x2c7)]({'name':_0x4e92c6,'room':_0x4d5a4b,'warehouse_category':'Finished\x20Goods'});if(typeof _0x5beddf==_0x2ee591(0x29d))var _0x8eb9e9=[_0x48cf66['body']['product_name']],_0x2308d2=[_0x48cf66['body'][_0x2ee591(0x1e9)]],_0x494262=[_0x48cf66[_0x2ee591(0x1f5)][_0x2ee591(0x23a)]],_0x5d0b85=[_0x48cf66[_0x2ee591(0x1f5)]['return_qty']],_0x738a4=[_0x48cf66[_0x2ee591(0x1f5)]['level']],_0x234036=[_0x48cf66['body'][_0x2ee591(0x26f)]],_0x48038b=[_0x48cf66[_0x2ee591(0x1f5)][_0x2ee591(0x1f6)]],_0x28ee72=[_0x48cf66[_0x2ee591(0x1f5)][_0x2ee591(0x2c4)]];else var _0x8eb9e9=[..._0x48cf66['body'][_0x2ee591(0x2b7)]],_0x2308d2=[..._0x48cf66[_0x2ee591(0x1f5)][_0x2ee591(0x1e9)]],_0x494262=[..._0x48cf66[_0x2ee591(0x1f5)]['stocks']],_0x5d0b85=[..._0x48cf66[_0x2ee591(0x1f5)][_0x2ee591(0x213)]],_0x738a4=[..._0x48cf66[_0x2ee591(0x1f5)]['level']],_0x234036=[..._0x48cf66[_0x2ee591(0x1f5)][_0x2ee591(0x26f)]],_0x48038b=[..._0x48cf66[_0x2ee591(0x1f5)]['primary_code_hide']],_0x28ee72=[..._0x48cf66[_0x2ee591(0x1f5)][_0x2ee591(0x2c4)]];const _0x26c6d3=_0x8eb9e9[_0x2ee591(0x218)](_0x33329e=>{return _0x33329e={'product_name':_0x33329e};});_0x2308d2[_0x2ee591(0x2a4)]((_0x155bfa,_0x4c2125)=>{var _0x24f027=_0x2ee591;_0x26c6d3[_0x4c2125][_0x24f027(0x1e9)]=_0x155bfa;}),_0x494262[_0x2ee591(0x2a4)]((_0xc5c476,_0x4d13df)=>{var _0x37e5de=_0x2ee591;_0x26c6d3[_0x4d13df][_0x37e5de(0x1ff)]=_0xc5c476;}),_0x5d0b85[_0x2ee591(0x2a4)]((_0x264eef,_0x12af36)=>{_0x26c6d3[_0x12af36]['return_qty']=_0x264eef;}),_0x738a4[_0x2ee591(0x2a4)]((_0x28d478,_0x5e29ca)=>{var _0x5bcd74=_0x2ee591;_0x26c6d3[_0x5e29ca][_0x5bcd74(0x23c)]=_0x28d478;}),_0x234036[_0x2ee591(0x2a4)]((_0x486d7f,_0x2fa476)=>{var _0x885577=_0x2ee591;_0x26c6d3[_0x2fa476][_0x885577(0x294)]=_0x486d7f;}),_0x48038b[_0x2ee591(0x2a4)]((_0x53ec59,_0x4f099a)=>{var _0x285553=_0x2ee591;_0x26c6d3[_0x4f099a][_0x285553(0x27a)]=_0x53ec59;}),_0x28ee72[_0x2ee591(0x2a4)]((_0x5e3741,_0x85836c)=>{var _0x3c6ac8=_0x2ee591;_0x26c6d3[_0x85836c][_0x3c6ac8(0x224)]=_0x5e3741;}),_0x26c6d3['forEach'](_0xdcd6c=>{var _0x2dc58e=_0x2ee591;console[_0x2dc58e(0x2a8)](_0xdcd6c);const _0x5bb8e4=_0x16ebe4[_0x2dc58e(0x2d1)][_0x2dc58e(0x218)](_0x499f6e=>{var _0x111aa6=_0x2dc58e;_0x499f6e[_0x111aa6(0x2b7)]==_0xdcd6c[_0x111aa6(0x2b7)]&&_0x499f6e['bay']==_0xdcd6c['bay']&&(console['log'](parseInt(_0x499f6e[_0x111aa6(0x268)])+'\x20<>\x20'+parseInt(_0xdcd6c['return_qty'])),_0x499f6e['product_stock']=parseInt(_0x499f6e['product_stock'])-parseInt(_0xdcd6c[_0x111aa6(0x213)]));});}),await _0x16ebe4[_0x2ee591(0x21a)]();var _0xd57aea=0x0;_0x26c6d3[_0x2ee591(0x2a4)](_0x344361=>{var _0x329c26=_0x2ee591;(parseInt(_0x344361['purchase_quantity'])<parseInt(_0x344361[_0x329c26(0x213)])||parseInt(_0x344361[_0x329c26(0x1ff)])<parseInt(_0x344361['return_qty']))&&_0xd57aea++;});if(_0xd57aea!=0x0)return _0x48cf66['flash'](_0x2ee591(0x29b),_0x2ee591(0x2c1)),_0x530a7d[_0x2ee591(0x1ed)]('back');const _0x3f7ea7=new purchases_return_finished({'invoice':_0x2b84ca,'suppliers':_0x48cf66['body'][_0x2ee591(0x25f)],'date':_0x27bf9e,'warehouse_name':_0x4e92c6,'return_product':_0x26c6d3,'note':_0x14d734,'room':_0x4d5a4b,'to_warehouse_name':_0x59e2f0,'to_room':_0x2c3172}),_0x36d82f=await _0x3f7ea7['save'](),_0xe9ec2a=await purchases_return_finished['findOne']({'invoice':_0x2b84ca}),_0x3cd955=await warehouse[_0x2ee591(0x2c7)]({'name':_0x59e2f0,'room':_0x2c3172,'warehouse_category':_0x2ee591(0x2e2)});_0xe9ec2a[_0x2ee591(0x267)]['forEach'](_0x4a4d59=>{var _0x4c628e=_0x2ee591,_0x1bc660=0x0;const _0x25f104=_0x3cd955[_0x4c628e(0x2d1)][_0x4c628e(0x218)](_0x2ff6e2=>{var _0x3a62e2=_0x4c628e;console[_0x3a62e2(0x2a8)](_0x2ff6e2[_0x3a62e2(0x2b7)]+'=='+_0x4a4d59[_0x3a62e2(0x2b7)]+'&&'+_0x2ff6e2[_0x3a62e2(0x23c)]+'=='+_0x4a4d59[_0x3a62e2(0x23c)]),_0x2ff6e2[_0x3a62e2(0x2b7)]==_0x4a4d59[_0x3a62e2(0x2b7)]&&_0x2ff6e2[_0x3a62e2(0x23c)]==_0x4a4d59['bay']&&(_0x2ff6e2[_0x3a62e2(0x268)]=parseInt(_0x2ff6e2[_0x3a62e2(0x268)])-parseInt(_0x4a4d59[_0x3a62e2(0x213)]),_0x1bc660++);});_0x1bc660=='0'&&(_0x3cd955[_0x4c628e(0x2d1)]=_0x3cd955[_0x4c628e(0x2d1)][_0x4c628e(0x214)]({'product_name':_0x4a4d59['product_name'],'product_stock':_0x4a4d59[_0x4c628e(0x213)],'primary_code':_0x4a4d59['primary_code'],'secondary_code':_0x4a4d59['secondary_code'],'product_code':_0x4a4d59[_0x4c628e(0x294)],'bay':_0x4a4d59[_0x4c628e(0x23c)],'maxProducts':0xf423f}));}),await _0x3cd955[_0x2ee591(0x21a)]();const _0x42ffb5=await purchases_finished['findOne']({'invoice':_0x2b84ca});_0x42ffb5[_0x2ee591(0x1f2)]=_0x2ee591(0x28f);const _0x2ccd34=await _0x42ffb5['save'](),_0x366e2f=new s_payment_data({'invoice':_0x2b84ca,'suppliers':_0x48cf66[_0x2ee591(0x1f5)][_0x2ee591(0x25f)],'reason':_0x2ee591(0x279)});await _0x366e2f[_0x2ee591(0x21a)]();const _0x87d3aa=await master_shop['find'](),_0x1d8468=await email_settings[_0x2ee591(0x2c7)](),_0x47ffbe=await suppliers[_0x2ee591(0x2c7)]({'name':_0x48cf66[_0x2ee591(0x1f5)][_0x2ee591(0x25f)]});_0x87d3aa[0x0][_0x2ee591(0x21e)]==0x1?(right_currency=_0x87d3aa[0x0][_0x2ee591(0x2ab)],left_currency=''):(right_currency='',left_currency=_0x87d3aa[0x0][_0x2ee591(0x2ab)]);var _0x524abe=_0x8eb9e9,_0x54eccb=_0x5d0b85,_0x1f52e3='',_0x479a3f;for(_0x479a3f in _0x524abe){_0x1f52e3+='<tr>'+_0x2ee591(0x24e)+_0x524abe[_0x479a3f]+_0x2ee591(0x2b1)+_0x2ee591(0x24e)+_0x54eccb[_0x479a3f]+_0x2ee591(0x2b1)+_0x2ee591(0x26c);}let _0x4b1fde=nodemailer['createTransport']({'service':_0x2ee591(0x1f1),'auth':{'user':_0x1d8468[_0x2ee591(0x1f9)],'pass':_0x1d8468[_0x2ee591(0x1fd)]}}),_0x5e7c08={'from':_0x1d8468[_0x2ee591(0x1f9)],'to':_0x47ffbe[_0x2ee591(0x1f9)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x2ee591(0x260),'path':__dirname+_0x2ee591(0x211)+_0x2ee591(0x241)+_0x87d3aa[0x0][_0x2ee591(0x272)],'cid':'logo'}],'html':_0x2ee591(0x2ca)+'<html><head><title></title>'+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2ee591(0x2c8)+_0x2ee591(0x205)+_0x2ee591(0x235)+_0x87d3aa[0x0][_0x2ee591(0x2e1)]+_0x2ee591(0x2af)+_0x2ee591(0x2c8)+_0x2ee591(0x2c8)+_0x2ee591(0x27f)+_0x2ee591(0x205)+_0x2ee591(0x1e5)+_0x2ee591(0x2cf)+_0x2b84ca+'\x20'+_0x2ee591(0x2da)+_0x2ee591(0x2c6)+_0x27bf9e+'\x20'+_0x2ee591(0x247)+'</h5>'+_0x2ee591(0x2c8)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2ee591(0x2ce)+_0x2ee591(0x23f)+_0x2ee591(0x289)+_0x2ee591(0x1ee)+_0x2ee591(0x227)+_0x2ee591(0x20d)+_0x2ee591(0x26c)+'</thead>'+_0x2ee591(0x291)+'\x20'+_0x1f52e3+'\x20'+_0x2ee591(0x22d)+_0x2ee591(0x230)+_0x2ee591(0x205)+_0x2ee591(0x234)+_0x2ee591(0x2d3)+_0x87d3aa[0x0][_0x2ee591(0x2e1)]+'</h5>'+_0x2ee591(0x2c8)+_0x2ee591(0x2c8)+_0x2ee591(0x264)};_0x4b1fde['sendMail'](_0x5e7c08,function(_0x41ad25,_0x2f0f27){var _0x54dae7=_0x2ee591;_0x41ad25?console[_0x54dae7(0x2a8)](_0x54dae7(0x286)):console['log'](_0x54dae7(0x1eb));}),_0x48cf66[_0x2ee591(0x2d9)]('success',_0x2ee591(0x2cb)),_0x530a7d[_0x2ee591(0x1ed)](_0x2ee591(0x2a5));}catch(_0x5a60d2){_0x530a7d[_0x2ee591(0x293)](0xc8)[_0x2ee591(0x2e5)]({'message':_0x5a60d2['message']});}}),router[a0_0x55c7a0(0x296)]('/barcode/:id',auth,async(_0x2feaaa,_0x578e90)=>{var _0x28a4f0=a0_0x55c7a0;try{const {username:_0x47d070,email:_0xdfc0d,role:_0x187ffe}=_0x2feaaa[_0x28a4f0(0x1ef)],_0x194a7d=_0x2feaaa[_0x28a4f0(0x1ef)],_0x51126d=await profile['findOne']({'email':_0x194a7d['email']}),_0x542d36=await master_shop[_0x28a4f0(0x21f)](),_0x2f1260=_0x2feaaa[_0x28a4f0(0x299)]['id'],_0x5ba8ae=await purchases_finished[_0x28a4f0(0x265)](_0x2f1260);if(_0x542d36[0x0][_0x28a4f0(0x22f)]==_0x28a4f0(0x231))var _0xf79359=users[_0x28a4f0(0x27c)];else{if(_0x542d36[0x0]['language']==_0x28a4f0(0x2bd))var _0xf79359=users['Hindi'];else{if(_0x542d36[0x0][_0x28a4f0(0x22f)]==_0x28a4f0(0x1e7))var _0xf79359=users[_0x28a4f0(0x1e7)];else{if(_0x542d36[0x0][_0x28a4f0(0x22f)]==_0x28a4f0(0x209))var _0xf79359=users[_0x28a4f0(0x209)];else{if(_0x542d36[0x0]['language']==_0x28a4f0(0x1e6))var _0xf79359=users['French'];else{if(_0x542d36[0x0][_0x28a4f0(0x22f)]==_0x28a4f0(0x210))var _0xf79359=users[_0x28a4f0(0x28e)];else{if(_0x542d36[0x0][_0x28a4f0(0x22f)]==_0x28a4f0(0x239))var _0xf79359=users[_0x28a4f0(0x239)];else{if(_0x542d36[0x0][_0x28a4f0(0x22f)]==_0x28a4f0(0x2cd))var _0xf79359=users[_0x28a4f0(0x261)];}}}}}}}_0x578e90[_0x28a4f0(0x2e4)](_0x28a4f0(0x2b9),{'success':_0x2feaaa[_0x28a4f0(0x2d9)](_0x28a4f0(0x25b)),'errors':_0x2feaaa[_0x28a4f0(0x2d9)](_0x28a4f0(0x29b)),'role':_0x194a7d,'profile':_0x51126d,'alldata':_0x5ba8ae,'master_shop':_0x542d36,'language':_0xf79359}),console[_0x28a4f0(0x2a8)](alldata);}catch(_0x57d8bc){console['log'](_0x57d8bc);}}),router[a0_0x55c7a0(0x29a)](a0_0x55c7a0(0x281),async(_0x3f131e,_0x5883d0)=>{var _0xc05cfe=a0_0x55c7a0;const {product_code:_0x47624c}=_0x3f131e[_0xc05cfe(0x1f5)];var _0x38c718;const _0x572c1c=await product[_0xc05cfe(0x24c)]([{'$match':{'primary_code':_0x47624c,'product_category':_0xc05cfe(0x2e2)}},{'$group':{'_id':'$_id','name':{'$first':_0xc05cfe(0x2a0)},'category':{'$first':_0xc05cfe(0x1f3)},'brand':{'$first':_0xc05cfe(0x221)},'unit':{'$first':_0xc05cfe(0x1fb)},'alertquantity':{'$first':_0xc05cfe(0x284)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0xc05cfe(0x22a)},'maxStocks':{'$first':_0xc05cfe(0x27e)},'maxProdPerUnit':{'$first':_0xc05cfe(0x215)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4b7486=await product[_0xc05cfe(0x24c)]([{'$match':{'secondary_code':_0x47624c}},{'$group':{'_id':_0xc05cfe(0x2c3),'name':{'$first':_0xc05cfe(0x2a0)},'category':{'$first':_0xc05cfe(0x1f3)},'brand':{'$first':'$brand'},'unit':{'$first':_0xc05cfe(0x1fb)},'alertquantity':{'$first':_0xc05cfe(0x284)},'product_code':{'$first':_0xc05cfe(0x1f4)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0xc05cfe(0x27e)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xc05cfe(0x238)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x572c1c['length']>0x0)_0x38c718=_0x572c1c;else _0x4b7486[_0xc05cfe(0x2dc)]>0x0&&(_0x38c718=_0x4b7486);_0x5883d0[_0xc05cfe(0x2e5)](_0x38c718);}),router[a0_0x55c7a0(0x29a)](a0_0x55c7a0(0x27d),async(_0x508519,_0x2732bc)=>{var _0x1cfc02=a0_0x55c7a0;const {productCode:_0x53bd06,bay:_0xb6cc2,warehouses:_0x5a1209,room:_0x29d67c}=_0x508519[_0x1cfc02(0x1f5)];console[_0x1cfc02(0x2a8)](_0x508519[_0x1cfc02(0x1f5)]);try{const _0x59e6b2=await warehouse[_0x1cfc02(0x24c)]([{'$match':{'name':_0x5a1209,'room':_0x29d67c}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0xb6cc2)}},{'$group':{'_id':_0x1cfc02(0x220),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1cfc02(0x270)},'bay':{'$first':_0x1cfc02(0x1ec)},'maxProducts':{'$first':_0x1cfc02(0x2ad)}}}]);_0x2732bc[_0x1cfc02(0x293)](0xc8)[_0x1cfc02(0x2e5)](_0x59e6b2);}catch(_0x3e227f){_0x2732bc['status'](0x194)['json']({'message':_0x3e227f[_0x1cfc02(0x236)]});}}),module[a0_0x55c7a0(0x2ba)]=router;function a0_0x4a91(_0x39bb79,_0x4df8f5){var _0x1906a1=a0_0x1906();return a0_0x4a91=function(_0x4a9114,_0x2c2c55){_0x4a9114=_0x4a9114-0x1e5;var _0x29d12b=_0x1906a1[_0x4a9114];return _0x29d12b;},a0_0x4a91(_0x39bb79,_0x4df8f5);}function a0_0x1906(){var _0x439064=['<!DOCTYPE\x20html>','purchases\x20item\x20return\x20successfull','$room','Arabic\x20(ae)','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','\x20Order\x20Number\x20:\x20','$product_details','product_details','Return\x20Goods','<h5>','note','$product_details.secondary_code','paid_amount','Rack\x201','padStart','flash','<span\x20style=\x22float:\x20right;\x22>','suppliers_docs','length','/view/add_purchases','$product','$product_details.product_name','quantity','site_title','Finished\x20Goods','12680855FzqmzH','render','json','<h5\x20style=\x22text-align:\x20left;\x22>','French','German','product_cat','purchase_quantity','686DowpEv','Email\x20sent\x20successfully','$product_details.bay','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','gmail','return_data','$category','$product_code','body','primary_code_hide','$product_details.primary_code','$product.floorlevel','email','</head><body>','$unit','Enabled','password','12uzQCEt','stock_quantity','$product_details.type','port','$paid_amount','/view/return_purchase/:id','../public/language/languages.json','<div>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Error\x20occurred\x20while\x20processing\x20product:','warehouse','Spanish','prod_secondunit','add_purchases_finished','591043DdkQuB','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','logo','filter','Portuguese\x20(BR)','/../public','all','return_qty','concat','$maxProdPerUnit','Room_name','abs','map','prod_cat','save','room','prod_invoice','sendMail','currency_placement','find','$product_details._id','$brand','staff','nodemailer','secondary_code','$product.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','POnumber','express','$secondary_code','expiry_date','Ambient','</tbody>','Paid\x20For\x20Purchase','language','</table>','English\x20(US)','Purchase\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<strong>\x20Regards\x20</strong>','<h2>\x20','message','$date','$secondary_unit','Chinese','stocks','date','bay','2928iAPMXX','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<tr>','room_name','/upload/','RoomAssign','role','host','/view/:id','$batch_code','</span>','purchase\x20data\x20update\x20successfully','$warehouse_name','$note','$due_amount','aggregate','9YKOIBb','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','116WYCmul','INCF-','return_purchase_finished','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','catch','name','1336085WHpHHn','4506050BOhxmZ','purchase_invoice','random','../models/all_models','success','prod_name','$return_data','<table\x20style=\x22width:\x20100%\x20!important;\x22>','suppliers','Logo.png','Arabic','</thead>','FROZEN\x20GOODS','</body></html>','findById','prod_code','return_product','product_stock','prod_level','$expiry_date','$suppliers','</tr>','$product_details.storage','slice','product_code_hide','$product_details.product_stock','16896csYYJO','image','$product_details.product_code','stock_data','batch_code','product','prod_unit','An\x20error\x20occurred\x20while\x20saving\x20data.','Purchase\x20Return','primary_code','$product.quantity','English','/CheckingWarehouse','$maxStocks','<hr\x20class=\x22my-3\x22>','all_purchases_finished','/barcode_scanner','$product_details.floorlevel','prod_primunit','$alertquantity','max_product_unit','Error\x20Occurs','warehouse_name','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','getDate','standard_unit','/give_payment/:id','</h5>','Portuguese','True','JO_number','<tbody\x20style=\x22text-align:\x20center;\x22>','maxStocks','status','product_code','Rack\x202','get','amount','$product.type','params','post','errors','$suppliers_docs','string','createTransport','/preview/:id','$name','213728aIEftK','due_amount','maxperunit','forEach','/all_purchases_finished/view','/all_purchases/view','error','log','$product.room_name','prod_Qty','currency','getFullYear','$product_details.maxProducts','updateOne','\x20</h2>','MaxStocks_data','</td>','DRY\x20GOODS','12QXtCJG','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','ejs','_id','product_name','$product.bay','all_purchases_barcode','exports','master','invoice','Hindi','add_purchases\x20error','$invoice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','secondary_unit','$_id','secondary_code_hide','production_date','\x20Order\x20Date\x20:\x20','findOne','</div>','product_date'];a0_0x1906=function(){return _0x439064;};return a0_0x1906();}