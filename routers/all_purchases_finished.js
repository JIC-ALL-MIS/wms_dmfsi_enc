var a0_0x5e6977=a0_0x44f2;(function(_0x2e8313,_0x1aaaad){var _0x1a6948=a0_0x44f2,_0x10c1ee=_0x2e8313();while(!![]){try{var _0x35f78a=-parseInt(_0x1a6948(0x211))/0x1*(parseInt(_0x1a6948(0x1e7))/0x2)+parseInt(_0x1a6948(0x205))/0x3+parseInt(_0x1a6948(0x13f))/0x4*(parseInt(_0x1a6948(0x223))/0x5)+-parseInt(_0x1a6948(0x16c))/0x6+-parseInt(_0x1a6948(0x1cf))/0x7*(parseInt(_0x1a6948(0x19b))/0x8)+parseInt(_0x1a6948(0x204))/0x9*(-parseInt(_0x1a6948(0x203))/0xa)+-parseInt(_0x1a6948(0x155))/0xb*(-parseInt(_0x1a6948(0x1fb))/0xc);if(_0x35f78a===_0x1aaaad)break;else _0x10c1ee['push'](_0x10c1ee['shift']());}catch(_0x2845f8){_0x10c1ee['push'](_0x10c1ee['shift']());}}}(a0_0x2420,0xa2be1));const express=require(a0_0x5e6977(0x20f)),app=express(),router=express[a0_0x5e6977(0x1d2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x5e6977(0x191)),nodemailer=require(a0_0x5e6977(0x146));var ejs=require(a0_0x5e6977(0x166));const path=require(a0_0x5e6977(0x1c9)),users=require('../public/language/languages.json');function a0_0x44f2(_0x5e45af,_0x5aa5d3){var _0x2420ee=a0_0x2420();return a0_0x44f2=function(_0x44f20d,_0x1bd2c4){_0x44f20d=_0x44f20d-0x138;var _0x41f26d=_0x2420ee[_0x44f20d];return _0x41f26d;},a0_0x44f2(_0x5e45af,_0x5aa5d3);}router[a0_0x5e6977(0x1ce)](a0_0x5e6977(0x1d3),auth,async(_0x36a07e,_0x5b47c4)=>{var _0x4189f3=a0_0x5e6977;try{const {username:_0x712896,email:_0xa0990,role:_0x1cf40b}=_0x36a07e[_0x4189f3(0x190)],_0x3aa4f8=_0x36a07e['user'],_0x232ff7=await profile[_0x4189f3(0x1ad)]({'email':_0x3aa4f8[_0x4189f3(0x1a4)]}),_0x486f81=await staff[_0x4189f3(0x1ad)]({'email':_0x3aa4f8[_0x4189f3(0x1a4)]});if(_0x3aa4f8[_0x4189f3(0x20b)]==_0x4189f3(0x1c7)){const _0x4286d3=await staff[_0x4189f3(0x1ad)]({'email':_0x3aa4f8['email']});}const _0x2508eb=await master_shop[_0x4189f3(0x156)]();let _0x2ca1dd;if(_0x3aa4f8[_0x4189f3(0x20b)]=='staff'){const _0x4476ef=await staff['findOne']({'email':_0x3aa4f8[_0x4189f3(0x1a4)]});_0x2ca1dd=await purchases_finished[_0x4189f3(0x193)]([{'$match':{'warehouse_name':_0x4476ef[_0x4189f3(0x206)]}},{'$lookup':{'from':_0x4189f3(0x160),'localField':_0x4189f3(0x160),'foreignField':_0x4189f3(0x1c8),'as':_0x4189f3(0x1fe)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x4189f3(0x207)},{'$group':{'_id':_0x4189f3(0x168),'invoice':{'$first':_0x4189f3(0x162)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x4189f3(0x19f)},'warehouse_name':{'$first':_0x4189f3(0x1e0)},'room':{'$first':_0x4189f3(0x1bf)},'product':{'$push':_0x4189f3(0x207)},'note':{'$first':_0x4189f3(0x1fa)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x4189f3(0x1ac)},'return_data':{'$first':_0x4189f3(0x1ec)},'batch_code':{'$first':_0x4189f3(0x235)},'expiry_date':{'$first':_0x4189f3(0x138)},'suppliers_docs':{'$first':_0x4189f3(0x1f0)},'total_product_quantity':{'$sum':_0x4189f3(0x1a3)},'level':{'$addToSet':_0x4189f3(0x144)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x4189f3(0x14c)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2ca1dd=await purchases_finished[_0x4189f3(0x193)]([{'$unwind':'$product'},{'$group':{'_id':_0x4189f3(0x168),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x4189f3(0x1ab)},'date':{'$first':_0x4189f3(0x19f)},'warehouse_name':{'$first':_0x4189f3(0x1e0)},'room':{'$addToSet':_0x4189f3(0x1a2)},'product':{'$push':_0x4189f3(0x207)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x4189f3(0x1ac)},'return_data':{'$first':_0x4189f3(0x1ec)},'batch_code':{'$first':_0x4189f3(0x235)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x4189f3(0x1a3)},'level':{'$addToSet':_0x4189f3(0x144)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x4189f3(0x14c)},'floorlevel':{'$addToSet':_0x4189f3(0x1e1)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x2508eb[0x0][_0x4189f3(0x186)]==_0x4189f3(0x142))var _0x3e57b7=users[_0x4189f3(0x1ee)];else{if(_0x2508eb[0x0][_0x4189f3(0x186)]==_0x4189f3(0x18a))var _0x3e57b7=users[_0x4189f3(0x18a)];else{if(_0x2508eb[0x0][_0x4189f3(0x186)]==_0x4189f3(0x1dc))var _0x3e57b7=users[_0x4189f3(0x1dc)];else{if(_0x2508eb[0x0][_0x4189f3(0x186)]=='Spanish')var _0x3e57b7=users[_0x4189f3(0x1da)];else{if(_0x2508eb[0x0][_0x4189f3(0x186)]==_0x4189f3(0x1c4))var _0x3e57b7=users[_0x4189f3(0x1c4)];else{if(_0x2508eb[0x0][_0x4189f3(0x186)]==_0x4189f3(0x201))var _0x3e57b7=users[_0x4189f3(0x22a)];else{if(_0x2508eb[0x0][_0x4189f3(0x186)]==_0x4189f3(0x17d))var _0x3e57b7=users[_0x4189f3(0x17d)];else{if(_0x2508eb[0x0][_0x4189f3(0x186)]==_0x4189f3(0x13a))var _0x3e57b7=users[_0x4189f3(0x181)];}}}}}}}_0x5b47c4[_0x4189f3(0x180)]('all_purchases_finished',{'success':_0x36a07e['flash']('success'),'errors':_0x36a07e['flash']('errors'),'purchases':_0x2ca1dd,'role':_0x3aa4f8,'profile':_0x232ff7,'master_shop':_0x2508eb,'language':_0x3e57b7});}catch(_0xba4379){console[_0x4189f3(0x1e6)](_0x4189f3(0x1ea),_0xba4379),_0x5b47c4[_0x4189f3(0x21e)](0xc8)[_0x4189f3(0x1cb)]({'message':_0xba4379['message']});}});function BayBinSelected(_0x2420fc,_0x3ded8d){var _0x1946cd=a0_0x5e6977,_0x53d133=[],_0x4c48ca=[];if(_0x2420fc==_0x1946cd(0x167)){switch(_0x3ded8d){case'Rack\x201':_0x53d133=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1946cd(0x161):_0x53d133=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x4c48ca=['DG'];}else{if(_0x2420fc=='FROZEN\x20GOODS'){switch(_0x3ded8d){case'Rack\x201':_0x53d133=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x53d133=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x4c48ca=['FG'];}}return{'levels':_0x53d133,'identify':_0x4c48ca};}async function getRandom8DigitNumber(){var _0x1d88c9=a0_0x5e6977;const _0x1cfdc0=0x989680,_0x1df6f6=0x5f5e0ff,_0x3edf62=Math[_0x1d88c9(0x200)](Math[_0x1d88c9(0x158)]()*(_0x1df6f6-_0x1cfdc0+0x1))+_0x1cfdc0;var _0x332cb2;const _0x4625eb=await purchases_finished['findOne']({'invoice':_0x1d88c9(0x226)+_0x3edf62});return _0x4625eb&&_0x4625eb[_0x1d88c9(0x14f)]>0x0?_0x332cb2=_0x1d88c9(0x226)+_0x3edf62:_0x332cb2=_0x1d88c9(0x226)+_0x3edf62,_0x332cb2;}router['get']('/view/add_purchases',auth,async(_0x592ad9,_0x2d7c1a)=>{var _0x362957=a0_0x5e6977;try{const {username:_0x6d7142,email:_0x39690f,role:_0x555590}=_0x592ad9[_0x362957(0x190)],_0x5813c9=_0x592ad9['user'],_0x392907=await profile[_0x362957(0x1ad)]({'email':_0x5813c9[_0x362957(0x1a4)]}),_0xd381ae=await master_shop[_0x362957(0x156)](),_0x24421d=await staff[_0x362957(0x1ad)]({'email':_0x5813c9['email']}),_0xd5fedd=await suppliers[_0x362957(0x156)]({});let _0x5a63e1;if(_0x5813c9[_0x362957(0x20b)]=='staff'){const _0x11e530=await staff[_0x362957(0x1ad)]({'email':_0x5813c9[_0x362957(0x1a4)]});_0x5a63e1=await warehouse[_0x362957(0x193)]([{'$match':{'status':_0x362957(0x182),'name':_0x11e530[_0x362957(0x206)],'warehouse_category':_0x362957(0x1de)}},{'$group':{'_id':_0x362957(0x151),'name':{'$first':'$name'}}}]);}else _0x5a63e1=await warehouse[_0x362957(0x193)]([{'$match':{'status':_0x362957(0x182),'warehouse_category':_0x362957(0x1de),'name':{'$ne':_0x362957(0x210)}}},{'$group':{'_id':_0x362957(0x151),'name':{'$first':_0x362957(0x151)}}}]);const _0x4b0dca=await product[_0x362957(0x156)]({}),_0x2d14b0=await warehouse['find']({'status':'Enabled'}),_0x3f827b=await purchases_finished[_0x362957(0x156)]({}),_0x56f2cf=_0x3f827b[_0x362957(0x14f)]+0x1,_0xcad00b=_0x362957(0x226)+_0x56f2cf[_0x362957(0x1bd)]()['padStart'](0x5,'0');var _0xb16c17=['Ambient','Enclosed'];if(_0xd381ae[0x0][_0x362957(0x186)]==_0x362957(0x142))var _0x55fc88=users[_0x362957(0x1ee)];else{if(_0xd381ae[0x0]['language']==_0x362957(0x18a))var _0x55fc88=users['Hindi'];else{if(_0xd381ae[0x0][_0x362957(0x186)]=='German')var _0x55fc88=users['German'];else{if(_0xd381ae[0x0][_0x362957(0x186)]=='Spanish')var _0x55fc88=users[_0x362957(0x1da)];else{if(_0xd381ae[0x0][_0x362957(0x186)]==_0x362957(0x1c4))var _0x55fc88=users[_0x362957(0x1c4)];else{if(_0xd381ae[0x0][_0x362957(0x186)]==_0x362957(0x201))var _0x55fc88=users[_0x362957(0x22a)];else{if(_0xd381ae[0x0]['language']==_0x362957(0x17d))var _0x55fc88=users['Chinese'];else{if(_0xd381ae[0x0]['language']==_0x362957(0x13a))var _0x55fc88=users[_0x362957(0x181)];}}}}}}}const _0x263bfc=getRandom8DigitNumber();_0x263bfc['then'](_0x221131=>{var _0x1649b5=_0x362957;_0x2d7c1a[_0x1649b5(0x180)](_0x1649b5(0x1d0),{'success':_0x592ad9['flash'](_0x1649b5(0x22b)),'errors':_0x592ad9[_0x1649b5(0x169)](_0x1649b5(0x215)),'role':_0x5813c9,'profile':_0x392907,'suppliers':_0xd5fedd,'warehouse':_0x5a63e1,'product':_0x4b0dca,'invoice':_0x221131,'master_shop':_0xd381ae,'language':_0x55fc88,'find_data':_0x2d14b0,'rooms_data':_0xb16c17});})[_0x362957(0x143)](_0x205963=>{var _0x2feba7=_0x362957;_0x592ad9[_0x2feba7(0x169)]('errors',_0x2feba7(0x219)),_0x2d7c1a[_0x2feba7(0x227)]('/all_purchases_finished/view');});}catch(_0x3c9190){console[_0x362957(0x1e6)](_0x3c9190);}}),router['get']('/view/add_purchases/:id',auth,async(_0x26204a,_0x2b801b)=>{var _0x2b117f=a0_0x5e6977;try{const _0x178372=_0x26204a[_0x2b117f(0x148)]['id'];console[_0x2b117f(0x1e6)](_0x178372);const _0x3f3fcb=await master_shop['find']();console[_0x2b117f(0x1e6)](_0x2b117f(0x17e),_0x3f3fcb);const _0x2b9535=await product[_0x2b117f(0x1ad)]({'name':_0x178372});console[_0x2b117f(0x1e6)]('product',_0x2b9535),_0x2b801b['status'](0xc8)[_0x2b117f(0x1cb)]({'product_data':_0x2b9535,'master':_0x3f3fcb});}catch(_0x11748b){console[_0x2b117f(0x1e6)](_0x2b117f(0x1b9),_0x11748b);}}),router[a0_0x5e6977(0x1cd)](a0_0x5e6977(0x1c3),auth,async(_0x29303a,_0x79562f)=>{var _0xfe5bc8=a0_0x5e6977;try{const {invoice:_0xffaa40,date:_0xb4abc0,warehouse_name:_0x56382b,prod_name:_0x3512f9,prod_code:_0xb980e,prod_qty:_0x5499ad,prod_unit:_0x3568e0,prod_secondunit:_0x10f402,prod_level:_0x308e7d,prod_isle:_0x2f86b2,prod_pallet:_0x127900,note:_0x329f18,expiry_date:_0x57beb5,batch_code:_0x2fa803,payable:_0x5e06ab,due_amount:_0x49139f,Room_name:_0x5621e2,primary_code:_0x246804,secondary_code:_0x2a50c2,MaxStocks_data:_0x3c6f90,PO_number:_0x8c9a33,SCRN:_0x2c56ee,JO_number:_0x3967fc}=_0x29303a[_0xfe5bc8(0x1ae)];if(typeof _0x3512f9==_0xfe5bc8(0x147))var _0x1cd630=[_0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x184)]],_0xfd4fe5=[_0x29303a[_0xfe5bc8(0x1ae)]['prod_code']],_0x3aadde=[_0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x1c5)]],_0x153156=[_0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x217)]],_0x354b02=[_0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x1f8)]],_0x17a589=[_0x29303a['body'][_0xfe5bc8(0x213)]],_0x39cf7a=[_0x29303a[_0xfe5bc8(0x1ae)]['primary_code']],_0x14aeb0=[_0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x188)]],_0x3b5fec=[_0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x1e4)]],_0x1ce6b7=[_0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x238)]],_0x1aec85=[_0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x149)]],_0x2fcc2c=[_0x29303a[_0xfe5bc8(0x1ae)]['product_date']],_0x293976=[_0x29303a[_0xfe5bc8(0x1ae)]['max_product_unit']],_0x7bbf0e=[_0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x1c0)]],_0x59564e=[_0x29303a['body'][_0xfe5bc8(0x165)]],_0x4dd348=[_0x29303a[_0xfe5bc8(0x1ae)]['prod_invoice']];else var _0x1cd630=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x184)]],_0xfd4fe5=[..._0x29303a[_0xfe5bc8(0x1ae)]['prod_code']],_0x3aadde=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x1c5)]],_0x153156=[..._0x29303a[_0xfe5bc8(0x1ae)]['prod_primunit']],_0x354b02=[..._0x29303a['body'][_0xfe5bc8(0x1f8)]],_0x17a589=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x213)]],_0x39cf7a=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x1c6)]],_0x14aeb0=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x188)]],_0x3b5fec=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x1e4)]],_0x1ce6b7=[..._0x29303a['body'][_0xfe5bc8(0x238)]],_0x1aec85=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x149)]],_0x2fcc2c=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x145)]],_0x293976=[..._0x29303a['body']['max_product_unit']],_0x7bbf0e=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x1c0)]],_0x59564e=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x165)]],_0x4dd348=[..._0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x173)]];const _0x58b032=_0x1cd630[_0xfe5bc8(0x140)](_0x25037a=>{return _0x25037a={'product_name':_0x25037a};});_0xfd4fe5[_0xfe5bc8(0x21d)]((_0x12b764,_0x13ba32)=>{var _0x410b40=_0xfe5bc8;_0x58b032[_0x13ba32][_0x410b40(0x15c)]=_0x12b764;}),_0x3aadde[_0xfe5bc8(0x21d)]((_0x5b4c9b,_0xa1d0dc)=>{var _0x1f38e2=_0xfe5bc8;_0x58b032[_0xa1d0dc][_0x1f38e2(0x1ed)]=Math[_0x1f38e2(0x1f4)](_0x5b4c9b);}),_0x153156['forEach']((_0x8c42a4,_0x50f43f)=>{var _0x3a0431=_0xfe5bc8;_0x58b032[_0x50f43f][_0x3a0431(0x220)]=_0x8c42a4;}),_0x354b02[_0xfe5bc8(0x21d)]((_0x56d2d8,_0xcc3efa)=>{_0x58b032[_0xcc3efa]['secondary_unit']=_0x56d2d8;}),_0x17a589[_0xfe5bc8(0x21d)]((_0x59b827,_0x29972f)=>{_0x58b032[_0x29972f]['bay']=_0x59b827;}),_0x39cf7a['forEach']((_0x4f06b5,_0x17a18f)=>{var _0x22792d=_0xfe5bc8;_0x58b032[_0x17a18f][_0x22792d(0x1c6)]=_0x4f06b5;}),_0x14aeb0[_0xfe5bc8(0x21d)]((_0x5c00d9,_0x4a381a)=>{var _0x4fe096=_0xfe5bc8;_0x58b032[_0x4a381a][_0x4fe096(0x188)]=_0x5c00d9;}),_0x3b5fec[_0xfe5bc8(0x21d)]((_0x5c429f,_0x330bb9)=>{_0x58b032[_0x330bb9]['maxStocks']=_0x5c429f;}),_0x1ce6b7[_0xfe5bc8(0x21d)]((_0x4e87c5,_0x108d3f)=>{var _0x2cdc1b=_0xfe5bc8;_0x58b032[_0x108d3f][_0x2cdc1b(0x238)]=_0x4e87c5;}),_0x1aec85['forEach']((_0x230f34,_0x4823bc)=>{_0x58b032[_0x4823bc]['expiry_date']=_0x230f34;}),_0x2fcc2c[_0xfe5bc8(0x21d)]((_0x530cb5,_0x36516e)=>{var _0x158608=_0xfe5bc8;_0x58b032[_0x36516e][_0x158608(0x216)]=_0x530cb5;}),_0x293976[_0xfe5bc8(0x21d)]((_0x4b11b9,_0x201969)=>{var _0x999a1a=_0xfe5bc8;_0x58b032[_0x201969][_0x999a1a(0x1a9)]=_0x4b11b9;}),_0x7bbf0e[_0xfe5bc8(0x21d)]((_0x49be1d,_0x53f5af)=>{var _0x454955=_0xfe5bc8;_0x58b032[_0x53f5af][_0x454955(0x14d)]=_0x49be1d;}),_0x59564e[_0xfe5bc8(0x21d)]((_0x11a723,_0x1849a1)=>{var _0x4ef9e2=_0xfe5bc8;_0x58b032[_0x1849a1][_0x4ef9e2(0x1eb)]=_0x11a723;}),_0x4dd348[_0xfe5bc8(0x21d)]((_0x2d7b76,_0x200e94)=>{var _0x534d76=_0xfe5bc8;_0x58b032[_0x200e94][_0x534d76(0x18b)]=_0x2d7b76;});const _0x1b3f64=_0x58b032['filter'](_0x196d49=>_0x196d49[_0xfe5bc8(0x1ed)]!=='0'&&_0x196d49[_0xfe5bc8(0x1ed)]!==''),_0x53b61f=new purchases_finished({'invoice':_0xffaa40,'suppliers':_0x29303a[_0xfe5bc8(0x1ae)][_0xfe5bc8(0x160)],'date':_0xb4abc0,'warehouse_name':_0x56382b,'product':_0x1b3f64,'note':_0x329f18,'due_amount':_0x49139f,'room':_0x5621e2,'POnumber':_0x8c9a33,'SCRN':_0x2c56ee,'JO_number':_0x3967fc}),_0x557634=await _0x53b61f[_0xfe5bc8(0x19a)](),_0x1d743d=await purchases_finished[_0xfe5bc8(0x1ad)]({'invoice':_0xffaa40}),_0x43bd78=_0x1d743d[_0xfe5bc8(0x1b1)][_0xfe5bc8(0x140)](async _0x4f5aea=>{var _0xb2ebef=_0xfe5bc8;try{var _0x3be5e9=await warehouse['findOne']({'name':_0x56382b,'room':_0x4f5aea['room_name']}),_0x412511=0x0;const _0x32def4=_0x3be5e9[_0xb2ebef(0x164)][_0xb2ebef(0x140)](_0x3f1ea6=>{var _0x31b2be=_0xb2ebef;console[_0x31b2be(0x1e6)](_0x3f1ea6[_0x31b2be(0x170)]+'=='+_0x4f5aea[_0x31b2be(0x170)]+'&&'+_0x3f1ea6['bay']+'=='+_0x4f5aea[_0x31b2be(0x1dd)]+'&&'+_0x3f1ea6[_0x31b2be(0x149)]+'=='+_0x4f5aea[_0x31b2be(0x149)]+'&&'+_0x3f1ea6[_0x31b2be(0x216)]+'=='+_0x4f5aea[_0x31b2be(0x216)]+'&&'+_0x3f1ea6[_0x31b2be(0x238)]+'=='+_0x4f5aea[_0x31b2be(0x238)]+'&&'+_0x3f1ea6[_0x31b2be(0x18b)]+'=='+_0x1d743d['invoice']),_0x3f1ea6[_0x31b2be(0x170)]==_0x4f5aea['product_name']&&_0x3f1ea6[_0x31b2be(0x1dd)]==_0x4f5aea[_0x31b2be(0x1dd)]&&_0x3f1ea6[_0x31b2be(0x149)]==_0x4f5aea[_0x31b2be(0x149)]&&_0x3f1ea6[_0x31b2be(0x216)]==_0x4f5aea[_0x31b2be(0x216)]&&_0x3f1ea6[_0x31b2be(0x238)]==_0x4f5aea['batch_code']&&_0x3f1ea6['invoice']==_0x1d743d[_0x31b2be(0x18b)]&&(_0x3f1ea6[_0x31b2be(0x192)]=Math[_0x31b2be(0x1f4)](_0x3f1ea6['product_stock'])+Math[_0x31b2be(0x1f4)](_0x4f5aea[_0x31b2be(0x1ed)]),_0x412511++);});return _0x412511==0x0&&(_0x3be5e9[_0xb2ebef(0x164)]=_0x3be5e9[_0xb2ebef(0x164)]['concat']({'product_name':_0x4f5aea[_0xb2ebef(0x170)],'product_stock':Math['abs'](_0x4f5aea['quantity']),'primary_code':_0x4f5aea[_0xb2ebef(0x1c6)],'secondary_code':_0x4f5aea[_0xb2ebef(0x188)],'product_code':_0x4f5aea[_0xb2ebef(0x15c)],'bay':_0x4f5aea[_0xb2ebef(0x1dd)],'maxProducts':_0x4f5aea[_0xb2ebef(0x225)],'unit':_0x4f5aea['standard_unit'],'secondary_unit':_0x4f5aea['secondary_unit'],'expiry_date':_0x4f5aea[_0xb2ebef(0x149)],'production_date':_0x4f5aea[_0xb2ebef(0x216)],'maxProducts':_0x4f5aea[_0xb2ebef(0x225)],'maxPerUnit':_0x4f5aea[_0xb2ebef(0x1a9)],'batch_code':_0x4f5aea[_0xb2ebef(0x238)],'product_cat':_0x4f5aea['product_cat'],'invoice':_0x4f5aea[_0xb2ebef(0x18b)],'id_incoming':_0x4f5aea[_0xb2ebef(0x19e)]})),_0x3be5e9;}catch(_0x3018f0){return console[_0xb2ebef(0x17c)]('Error\x20occurred\x20while\x20processing\x20product:',_0x3018f0),null;}});Promise[_0xfe5bc8(0x1f6)](_0x43bd78)['then'](async _0x98a466=>{var _0x2bfced=_0xfe5bc8;try{for(const _0x22ded7 of _0x98a466){await warehouse[_0x2bfced(0x1e5)]({'_id':_0x22ded7[_0x2bfced(0x19e)]},{'$addToSet':{'product_details':{'$each':_0x22ded7['product_details']}}});}const _0xba7260=await master_shop['find'](),_0x6e4c97=await email_settings[_0x2bfced(0x1ad)](),_0x41d70c=await supervisor_settings[_0x2bfced(0x156)]();var _0x362877=_0x1d743d[_0x2bfced(0x1b1)],_0x45230d='',_0x50d652;for(_0x50d652 in _0x362877){var _0x2527ee='FG';_0x1d743d[_0x2bfced(0x22c)]==_0x2bfced(0x167)&&(_0x2527ee='DG'),_0x45230d+=_0x2bfced(0x21c)+_0x2bfced(0x16b)+_0x362877[_0x50d652][_0x2bfced(0x170)]+_0x2bfced(0x1d7)+_0x2bfced(0x16b)+_0x362877[_0x50d652][_0x2bfced(0x15c)]+'</td>'+_0x2bfced(0x16b)+_0x362877[_0x50d652][_0x2bfced(0x1ed)]+_0x2bfced(0x1d7)+_0x2bfced(0x16b)+_0x362877[_0x50d652][_0x2bfced(0x220)]+_0x2bfced(0x1d7)+_0x2bfced(0x16b)+_0x362877[_0x50d652]['secondary_unit']+_0x2bfced(0x1d7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1d743d[_0x2bfced(0x22c)]+_0x2bfced(0x1d7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x362877[_0x50d652]['room_name']+_0x2bfced(0x1d7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2527ee+_0x362877[_0x50d652][_0x2bfced(0x1dd)]+_0x2bfced(0x1d7),_0x2bfced(0x17f);}let _0x126e50=nodemailer[_0x2bfced(0x21a)]({'host':_0x6e4c97[_0x2bfced(0x189)],'port':Number(_0x6e4c97[_0x2bfced(0x14e)]),'secure':![],'auth':{'user':_0x6e4c97[_0x2bfced(0x1a4)],'pass':_0x6e4c97[_0x2bfced(0x14b)]}}),_0xf7c5dd={'from':_0x6e4c97['email'],'to':_0x41d70c[0x0][_0x2bfced(0x198)],'subject':_0x2bfced(0x237),'attachments':[{'filename':_0x2bfced(0x13d),'path':__dirname+_0x2bfced(0x171)+_0x2bfced(0x19c)+_0xba7260[0x0]['image'],'cid':_0x2bfced(0x179)}],'html':_0x2bfced(0x1a7)+'<html><head><title></title>'+'</head><body>'+_0x2bfced(0x1ef)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2bfced(0x1ef)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2bfced(0x1f3)+'<div>'+'<h2>\x20'+_0xba7260[0x0]['site_title']+_0x2bfced(0x174)+_0x2bfced(0x1f3)+_0x2bfced(0x1f3)+_0x2bfced(0x194)+_0x2bfced(0x1ef)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2bfced(0x1d4)+_0x1d743d[_0x2bfced(0x18b)]+'\x20'+_0x2bfced(0x16a)+_0x2bfced(0x233)+_0x1d743d['date']+'\x20'+_0x2bfced(0x199)+_0x2bfced(0x153)+_0x2bfced(0x1f3)+_0x2bfced(0x152)+_0x2bfced(0x22e)+_0x2bfced(0x21c)+_0x2bfced(0x18c)+_0x2bfced(0x1bb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x2bfced(0x15b)+_0x2bfced(0x21f)+_0x2bfced(0x1f9)+_0x2bfced(0x163)+_0x2bfced(0x1b2)+_0x2bfced(0x17f)+_0x2bfced(0x157)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x45230d+'\x20'+'</tbody>'+_0x2bfced(0x1b4)+_0x2bfced(0x1ef)+_0x2bfced(0x16e)+_0x2bfced(0x18f)+_0xba7260[0x0]['site_title']+_0x2bfced(0x153)+'</div>'+'</div>'+_0x2bfced(0x224)};_0x126e50[_0x2bfced(0x1d1)](_0xf7c5dd,function(_0x45136a,_0x6707f8){var _0x1502d5=_0x2bfced;_0x45136a?(console[_0x1502d5(0x1e6)](_0x45136a),console['log']('Error\x20Occurs')):console[_0x1502d5(0x1e6)](_0x1502d5(0x22f));});}catch(_0x2ae69c){console['error'](_0x2ae69c),_0x79562f[_0x2bfced(0x21e)](0x1f4)[_0x2bfced(0x1cb)]({'error':_0x2bfced(0x222),'message':_0x2ae69c['message']});}})[_0xfe5bc8(0x143)](_0xbff07e=>{var _0x4f4943=_0xfe5bc8;console[_0x4f4943(0x17c)](_0xbff07e);}),_0x29303a[_0xfe5bc8(0x169)](_0xfe5bc8(0x22b),_0xfe5bc8(0x230)),_0x79562f[_0xfe5bc8(0x227)](_0xfe5bc8(0x1e9));}catch(_0x1f1234){console[_0xfe5bc8(0x1e6)](_0x1f1234);}}),router[a0_0x5e6977(0x1ce)](a0_0x5e6977(0x1a1),auth,async(_0x2cfd38,_0xce52e1)=>{var _0x2b5f0e=a0_0x5e6977;try{const {username:_0x5b5ed6,email:_0x3c36c5,role:_0x276047}=_0x2cfd38['user'],_0x29b55a=_0x2cfd38[_0x2b5f0e(0x190)],_0x2b58b6=await profile[_0x2b5f0e(0x1ad)]({'email':_0x29b55a[_0x2b5f0e(0x1a4)]}),_0x514ad2=await master_shop[_0x2b5f0e(0x156)](),_0x2bf158=_0x2cfd38['params']['id'],_0x351dac=await purchases_finished[_0x2b5f0e(0x15e)](_0x2bf158),_0x2bb8e5=await suppliers[_0x2b5f0e(0x156)]({});let _0x1e1e97;if(_0x29b55a[_0x2b5f0e(0x20b)]==_0x2b5f0e(0x1c7)){const _0x47b039=await staff[_0x2b5f0e(0x1ad)]({'email':_0x29b55a['email']});_0x1e1e97=await warehouse[_0x2b5f0e(0x156)]({'status':_0x2b5f0e(0x182),'name':_0x47b039[_0x2b5f0e(0x206)],'warehouse_category':_0x2b5f0e(0x1de)});}else _0x1e1e97=await warehouse[_0x2b5f0e(0x193)]([{'$match':{'status':_0x2b5f0e(0x182),'warehouse_category':_0x2b5f0e(0x1de)}},{'$group':{'_id':_0x2b5f0e(0x151),'name':{'$first':'$name'}}}]);const _0x75f811=await product[_0x2b5f0e(0x156)]({}),_0x2af666=BayBinSelected(_0x351dac[_0x2b5f0e(0x22c)],_0x351dac[_0x2b5f0e(0x1fc)]);let _0x4b59ad=new Date(_0x351dac['expiry_date']),_0x4666b6=('0'+_0x4b59ad[_0x2b5f0e(0x1f7)]())[_0x2b5f0e(0x176)](-0x2),_0x4f3aec=('0'+(_0x4b59ad[_0x2b5f0e(0x14a)]()+0x1))[_0x2b5f0e(0x176)](-0x2),_0x4b0003=_0x4b59ad[_0x2b5f0e(0x234)](),_0x5e7d70=_0x4b0003+'-'+_0x4f3aec+'-'+_0x4666b6;if(_0x514ad2[0x0][_0x2b5f0e(0x186)]==_0x2b5f0e(0x142)){var _0x365906=users['English'];console['log'](_0x365906);}else{if(_0x514ad2[0x0][_0x2b5f0e(0x186)]==_0x2b5f0e(0x18a))var _0x365906=users[_0x2b5f0e(0x18a)];else{if(_0x514ad2[0x0]['language']==_0x2b5f0e(0x1dc))var _0x365906=users['German'];else{if(_0x514ad2[0x0]['language']==_0x2b5f0e(0x1da))var _0x365906=users['Spanish'];else{if(_0x514ad2[0x0][_0x2b5f0e(0x186)]==_0x2b5f0e(0x1c4))var _0x365906=users[_0x2b5f0e(0x1c4)];else{if(_0x514ad2[0x0][_0x2b5f0e(0x186)]=='Portuguese\x20(BR)')var _0x365906=users['Portuguese'];else{if(_0x514ad2[0x0][_0x2b5f0e(0x186)]==_0x2b5f0e(0x17d))var _0x365906=users[_0x2b5f0e(0x17d)];else{if(_0x514ad2[0x0]['language']==_0x2b5f0e(0x13a))var _0x365906=users[_0x2b5f0e(0x181)];}}}}}}}_0xce52e1[_0x2b5f0e(0x180)](_0x2b5f0e(0x1b6),{'success':_0x2cfd38['flash'](_0x2b5f0e(0x22b)),'errors':_0x2cfd38['flash'](_0x2b5f0e(0x215)),'role':_0x29b55a,'profile':_0x2b58b6,'purchases':_0x351dac,'suppliers':_0x2bb8e5,'warehouse':_0x1e1e97,'product':_0x75f811,'master_shop':_0x514ad2,'language':_0x365906,'ed_fullDate':_0x5e7d70,'dataSelected':_0x2af666});}catch(_0x8dd89f){console[_0x2b5f0e(0x1e6)](_0x8dd89f);}}),router[a0_0x5e6977(0x1ce)](a0_0x5e6977(0x1b5),auth,async(_0x107add,_0x15120f)=>{var _0x3c8ea6=a0_0x5e6977;try{const {username:_0xa593a2,email:_0x2d98c5,role:_0x1034d4}=_0x107add['user'],_0x31c324=_0x107add[_0x3c8ea6(0x190)],_0x5242d6=await profile[_0x3c8ea6(0x1ad)]({'email':_0x31c324[_0x3c8ea6(0x1a4)]}),_0x2626d9=await master_shop[_0x3c8ea6(0x156)](),_0x4c968d=_0x107add[_0x3c8ea6(0x148)]['id'],_0x5bc4e0=await purchases_finished[_0x3c8ea6(0x15e)](_0x4c968d),_0x560f22=await suppliers[_0x3c8ea6(0x156)]({});let _0xb9d006;if(_0x31c324[_0x3c8ea6(0x20b)]=='staff'){const _0x262902=await staff['findOne']({'email':_0x31c324[_0x3c8ea6(0x1a4)]});_0xb9d006=await warehouse[_0x3c8ea6(0x156)]({'status':_0x3c8ea6(0x182),'name':_0x262902[_0x3c8ea6(0x206)],'warehouse_category':_0x3c8ea6(0x1de)});}else _0xb9d006=await warehouse['aggregate']([{'$match':{'status':_0x3c8ea6(0x182),'warehouse_category':_0x3c8ea6(0x1de)}},{'$group':{'_id':_0x3c8ea6(0x151),'name':{'$first':_0x3c8ea6(0x151)}}}]);const _0x558af2=await product[_0x3c8ea6(0x156)]({}),_0x20da53=BayBinSelected(_0x5bc4e0[_0x3c8ea6(0x22c)],_0x5bc4e0[_0x3c8ea6(0x1fc)]);let _0xaac944=new Date(_0x5bc4e0['expiry_date']),_0x11eebd=('0'+_0xaac944[_0x3c8ea6(0x1f7)]())[_0x3c8ea6(0x176)](-0x2),_0x55ddd4=('0'+(_0xaac944['getMonth']()+0x1))[_0x3c8ea6(0x176)](-0x2),_0x44a376=_0xaac944[_0x3c8ea6(0x234)](),_0x3d970e=_0x44a376+'-'+_0x55ddd4+'-'+_0x11eebd;if(_0x2626d9[0x0]['language']==_0x3c8ea6(0x142)){var _0x380250=users[_0x3c8ea6(0x1ee)];console['log'](_0x380250);}else{if(_0x2626d9[0x0][_0x3c8ea6(0x186)]=='Hindi')var _0x380250=users[_0x3c8ea6(0x18a)];else{if(_0x2626d9[0x0][_0x3c8ea6(0x186)]==_0x3c8ea6(0x1dc))var _0x380250=users['German'];else{if(_0x2626d9[0x0][_0x3c8ea6(0x186)]==_0x3c8ea6(0x1da))var _0x380250=users['Spanish'];else{if(_0x2626d9[0x0][_0x3c8ea6(0x186)]=='French')var _0x380250=users[_0x3c8ea6(0x1c4)];else{if(_0x2626d9[0x0][_0x3c8ea6(0x186)]=='Portuguese\x20(BR)')var _0x380250=users[_0x3c8ea6(0x22a)];else{if(_0x2626d9[0x0]['language']=='Chinese')var _0x380250=users[_0x3c8ea6(0x17d)];else{if(_0x2626d9[0x0][_0x3c8ea6(0x186)]==_0x3c8ea6(0x13a))var _0x380250=users['Arabic'];}}}}}}}_0x15120f['render'](_0x3c8ea6(0x13c),{'success':_0x107add['flash']('success'),'errors':_0x107add['flash']('errors'),'role':_0x31c324,'profile':_0x5242d6,'purchases':_0x5bc4e0,'suppliers':_0x560f22,'warehouse':_0xb9d006,'product':_0x558af2,'master_shop':_0x2626d9,'language':_0x380250,'ed_fullDate':_0x3d970e,'dataSelected':_0x20da53});}catch(_0x1fd168){console[_0x3c8ea6(0x1e6)](_0x1fd168);}}),router[a0_0x5e6977(0x1cd)](a0_0x5e6977(0x1b5),auth,async(_0x131640,_0x2c0817)=>{var _0x5a0994=a0_0x5e6977;try{const _0x97f10c=_0x131640[_0x5a0994(0x148)]['id'],_0x1e56aa=await purchases_finished[_0x5a0994(0x1ad)]({'_id':_0x131640[_0x5a0994(0x148)]['id']}),_0x36f4b9=await warehouse['findOne']({'name':_0x1e56aa[_0x5a0994(0x22c)],'room':_0x1e56aa['room']});_0x1e56aa[_0x5a0994(0x1b1)][_0x5a0994(0x21d)](_0x121caa=>{var _0x3dacb1=_0x5a0994;const _0x545e4c=_0x36f4b9[_0x3dacb1(0x164)]['map'](_0x7b2e77=>{var _0x45f468=_0x3dacb1;_0x7b2e77[_0x45f468(0x170)]==_0x121caa['product_name']&&_0x7b2e77[_0x45f468(0x1dd)]==_0x121caa[_0x45f468(0x1dd)]&&(_0x7b2e77['product_stock']=parseInt(_0x7b2e77[_0x45f468(0x192)])-parseInt(_0x121caa[_0x45f468(0x1ed)]));});}),await _0x36f4b9[_0x5a0994(0x19a)]();const {invoice:_0x439f15,suppliers:_0x123da1,date:_0x97b42,warehouse_name:_0x2d04cc,prod_name:_0x5de297,prod_code:_0x2c4085,prod_qty:_0x140806,prod_unit:_0x122a2b,prod_secondunit:_0xa4406a,prod_level:_0xd2ee4f,prod_isle:_0x534e9e,prod_pallet:_0x5dd993,note:_0x231930,expiry_date:_0x5ebc25,batch_code:_0x4fc290,paid_amount:_0x4ed638,due_amount:_0x4718ff,Room_name:_0x3157ed,primary_code:_0x2f97cd,secondary_code:_0x532cf4,PO_number:_0xfafde8,JO_number:_0x290565}=_0x131640[_0x5a0994(0x1ae)];if(typeof _0x5de297=='string')var _0x3ae4f1=[_0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x184)]],_0x2387ba=[_0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x150)]],_0xcbd24c=[_0x131640[_0x5a0994(0x1ae)]['prod_qty']],_0x4902ed=[_0x131640['body']['prod_unit']],_0x449959=[_0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x1f8)]],_0x7570f9=[_0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x213)]],_0x5576e5=[_0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x1c6)]],_0x193b35=[_0x131640['body'][_0x5a0994(0x188)]],_0x5abb43=[_0x131640[_0x5a0994(0x1ae)]['MaxStocks_data']],_0x212dea=[_0x131640['body'][_0x5a0994(0x238)]],_0x21e783=[_0x131640['body'][_0x5a0994(0x149)]];else var _0x3ae4f1=[..._0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x184)]],_0x2387ba=[..._0x131640['body'][_0x5a0994(0x150)]],_0xcbd24c=[..._0x131640[_0x5a0994(0x1ae)]['prod_qty']],_0x4902ed=[..._0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x1a8)]],_0x449959=[..._0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x1f8)]],_0x7570f9=[..._0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x213)]],_0x5576e5=[..._0x131640[_0x5a0994(0x1ae)]['primary_code']],_0x193b35=[..._0x131640['body'][_0x5a0994(0x188)]],_0x5abb43=[..._0x131640['body'][_0x5a0994(0x1e4)]],_0x212dea=[..._0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x238)]],_0x21e783=[..._0x131640['body']['expiry_date']];const _0x3b33be=_0x3ae4f1[_0x5a0994(0x140)](_0x39e1e3=>{return _0x39e1e3={'product_name':_0x39e1e3};});_0x2387ba[_0x5a0994(0x21d)]((_0x1173d3,_0x56a892)=>{var _0xaae486=_0x5a0994;_0x3b33be[_0x56a892][_0xaae486(0x15c)]=_0x1173d3;}),_0xcbd24c['forEach']((_0x7cd839,_0x3b5d07)=>{var _0xc9ce2a=_0x5a0994;_0x3b33be[_0x3b5d07][_0xc9ce2a(0x1ed)]=_0x7cd839;}),_0x4902ed['forEach']((_0x235fb0,_0x5128af)=>{var _0x43c323=_0x5a0994;_0x3b33be[_0x5128af][_0x43c323(0x220)]=_0x235fb0;}),_0x449959[_0x5a0994(0x21d)]((_0x1f695b,_0x1eefe5)=>{var _0x1e5a04=_0x5a0994;_0x3b33be[_0x1eefe5][_0x1e5a04(0x185)]=_0x1f695b;}),_0x7570f9['forEach']((_0x4b8aff,_0xaab719)=>{var _0x1d8ac7=_0x5a0994;_0x3b33be[_0xaab719][_0x1d8ac7(0x1dd)]=_0x4b8aff;}),_0x5576e5[_0x5a0994(0x21d)]((_0x267ae8,_0x4c2515)=>{var _0x3e93de=_0x5a0994;_0x3b33be[_0x4c2515][_0x3e93de(0x1c6)]=_0x267ae8;}),_0x193b35[_0x5a0994(0x21d)]((_0x28722d,_0x26882d)=>{var _0x2b9649=_0x5a0994;_0x3b33be[_0x26882d][_0x2b9649(0x188)]=_0x28722d;}),_0x5abb43['forEach']((_0x3f0ba0,_0x1ba65c)=>{var _0x4fd18a=_0x5a0994;_0x3b33be[_0x1ba65c][_0x4fd18a(0x225)]=_0x3f0ba0;}),_0x212dea[_0x5a0994(0x21d)]((_0xe21eb6,_0x4504a3)=>{var _0x5802aa=_0x5a0994;_0x3b33be[_0x4504a3][_0x5802aa(0x238)]=_0xe21eb6;}),_0x21e783['forEach']((_0x3f155d,_0x347fe8)=>{var _0x17bdac=_0x5a0994;_0x3b33be[_0x347fe8][_0x17bdac(0x149)]=_0x3f155d;});const _0x1dca0e=_0x3b33be[_0x5a0994(0x20d)](_0x302572=>_0x302572['quantity']!=='0'&&_0x302572['quantity']!=='');_0x1e56aa[_0x5a0994(0x18b)]=_0x439f15,_0x1e56aa[_0x5a0994(0x160)]=_0x123da1,_0x1e56aa[_0x5a0994(0x16f)]=_0x97b42,_0x1e56aa[_0x5a0994(0x22c)]=_0x2d04cc,_0x1e56aa[_0x5a0994(0x1b1)]=_0x1dca0e,_0x1e56aa['note']=_0x231930,_0x1e56aa['paid_amount']=_0x4ed638,_0x1e56aa[_0x5a0994(0x13b)]=_0x4718ff,_0x1e56aa[_0x5a0994(0x1fc)]=_0x3157ed,_0x1e56aa[_0x5a0994(0x218)]=_0xfafde8,_0x1e56aa[_0x5a0994(0x178)]=_0x290565;const _0x57111b=await _0x1e56aa[_0x5a0994(0x19a)](),_0x2a137d=await warehouse[_0x5a0994(0x1ad)]({'name':_0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x22c)],'room':_0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x232)]});_0x1e56aa['product'][_0x5a0994(0x21d)](_0x488c7d=>{var _0x284bf2=_0x5a0994,_0x55c906=0x0;const _0x5f4632=_0x2a137d['product_details'][_0x284bf2(0x140)](_0x44ea10=>{var _0x294fa5=_0x284bf2;_0x44ea10[_0x294fa5(0x170)]==_0x488c7d['product_name']&&_0x44ea10['bay']==_0x488c7d['bay']&&(_0x44ea10[_0x294fa5(0x192)]=parseInt(_0x44ea10['product_stock'])+parseInt(_0x488c7d[_0x294fa5(0x1ed)]),_0x55c906++);});_0x55c906=='0'&&(_0x2a137d[_0x284bf2(0x164)]=_0x2a137d[_0x284bf2(0x164)]['concat']({'product_name':_0x488c7d[_0x284bf2(0x170)],'product_stock':_0x488c7d[_0x284bf2(0x1ed)],'primary_code':_0x488c7d['primary_code'],'secondary_code':_0x488c7d['secondary_code'],'product_code':_0x488c7d[_0x284bf2(0x15c)],'bay':_0x488c7d[_0x284bf2(0x1dd)],'maxProducts':_0x488c7d['maxStocks'],'unit':_0x488c7d[_0x284bf2(0x220)],'secondary_unit':_0x488c7d['secondary_unit'],'expiry_date':_0x488c7d[_0x284bf2(0x149)]}));}),await _0x2a137d['save']();const _0x245141=await s_payment_data[_0x5a0994(0x1ad)]({'invoice':_0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x18b)]});if(_0x245141===null){}else console[_0x5a0994(0x1e6)](_0x5a0994(0x160),_0x245141,_0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x18b)]),_0x245141[_0x5a0994(0x160)]=_0x131640[_0x5a0994(0x1ae)][_0x5a0994(0x160)],await _0x245141['save']();_0x131640[_0x5a0994(0x169)](_0x5a0994(0x22b),_0x5a0994(0x172)),_0x2c0817['redirect'](_0x5a0994(0x1e9));}catch(_0x58e278){console[_0x5a0994(0x1e6)](_0x58e278);}}),router[a0_0x5e6977(0x1cd)](a0_0x5e6977(0x17a),auth,async(_0xbd9863,_0x39c7fa)=>{var _0x8e99a5=a0_0x5e6977;try{const _0x3db3ae=_0xbd9863[_0x8e99a5(0x148)]['id'],{invoice:_0x1ed25d,suppliers:_0x570f5b,payable:_0x537a75,due_amount:_0x28ebd3}=_0xbd9863[_0x8e99a5(0x1ae)],_0x52e6b8=await purchases[_0x8e99a5(0x15e)](_0x3db3ae);var _0x2f1910=_0x537a75-_0x28ebd3;_0x52e6b8[_0x8e99a5(0x1f1)]=parseFloat(_0x52e6b8['paid_amount'])+parseFloat(_0x28ebd3),_0x52e6b8[_0x8e99a5(0x13b)]=_0x2f1910;const _0x1c4a93=await _0x52e6b8['save']();console[_0x8e99a5(0x1e6)](_0x1c4a93);const _0x415921=await s_payment_data[_0x8e99a5(0x1ad)]({'invoice':_0x1ed25d});_0x415921[_0x8e99a5(0x1df)]=_0x2f1910,await _0x415921[_0x8e99a5(0x19a)]();let _0x5f2be8=new Date(),_0x3368b0=('0'+_0x5f2be8[_0x8e99a5(0x1f7)]())[_0x8e99a5(0x176)](-0x2),_0x3ac565=('0'+(_0x5f2be8[_0x8e99a5(0x14a)]()+0x1))[_0x8e99a5(0x176)](-0x2),_0x2ad7ac=_0x5f2be8[_0x8e99a5(0x234)](),_0x5c9146=_0x2ad7ac+'-'+_0x3ac565+'-'+_0x3368b0;const _0x3f45d1=new suppliers_payment({'invoice':_0x1ed25d,'date':_0x2ad7ac+'-'+_0x3ac565+'-'+_0x3368b0,'suppliers':_0x570f5b,'reason':_0x8e99a5(0x228),'amount':_0x28ebd3}),_0x14e877=await _0x3f45d1['save']();_0xbd9863[_0x8e99a5(0x169)](_0x8e99a5(0x22b),_0x8e99a5(0x195)),_0x39c7fa[_0x8e99a5(0x227)](_0x8e99a5(0x15d));}catch(_0x534e17){console[_0x8e99a5(0x1e6)](_0x534e17);}}),router[a0_0x5e6977(0x1ce)](a0_0x5e6977(0x23a),auth,async(_0x299213,_0x1a057a)=>{var _0x2796ec=a0_0x5e6977;try{const {username:_0x520429,email:_0x2573f3,role:_0x2b3885}=_0x299213[_0x2796ec(0x190)],_0x2a503d=_0x299213[_0x2796ec(0x190)],_0x4068d1=await profile[_0x2796ec(0x1ad)]({'email':_0x2a503d[_0x2796ec(0x1a4)]}),_0x1450eb=await master_shop['find']();console[_0x2796ec(0x1e6)](_0x2796ec(0x17e),_0x1450eb);const _0xc8b7fa=_0x299213['params']['id'],_0x5c2837=await purchases[_0x2796ec(0x15e)](_0xc8b7fa);console['log'](_0x5c2837);const _0x3938f1=await suppliers[_0x2796ec(0x1ad)]({'name':_0x5c2837['suppliers']});console[_0x2796ec(0x1e6)](_0x3938f1);if(_0x1450eb[0x0][_0x2796ec(0x186)]=='English\x20(US)'){var _0x325217=users[_0x2796ec(0x1ee)];console[_0x2796ec(0x1e6)](_0x325217);}else{if(_0x1450eb[0x0][_0x2796ec(0x186)]=='Hindi')var _0x325217=users[_0x2796ec(0x18a)];else{if(_0x1450eb[0x0][_0x2796ec(0x186)]=='German')var _0x325217=users['German'];else{if(_0x1450eb[0x0][_0x2796ec(0x186)]==_0x2796ec(0x1da))var _0x325217=users[_0x2796ec(0x1da)];else{if(_0x1450eb[0x0][_0x2796ec(0x186)]==_0x2796ec(0x1c4))var _0x325217=users[_0x2796ec(0x1c4)];else{if(_0x1450eb[0x0][_0x2796ec(0x186)]==_0x2796ec(0x201))var _0x325217=users[_0x2796ec(0x22a)];else{if(_0x1450eb[0x0][_0x2796ec(0x186)]=='Chinese')var _0x325217=users[_0x2796ec(0x17d)];else{if(_0x1450eb[0x0][_0x2796ec(0x186)]==_0x2796ec(0x13a))var _0x325217=users[_0x2796ec(0x181)];}}}}}}}_0x1a057a[_0x2796ec(0x180)](_0x2796ec(0x17b),{'success':_0x299213[_0x2796ec(0x169)](_0x2796ec(0x22b)),'errors':_0x299213['flash'](_0x2796ec(0x215)),'role':_0x2a503d,'profile':_0x4068d1,'master_shop':_0x1450eb,'supplier':_0x3938f1,'purchase':_0x5c2837,'language':_0x325217});}catch(_0x19c03e){console[_0x2796ec(0x1e6)](_0x19c03e);}}),router['get'](a0_0x5e6977(0x196),auth,async(_0x21f716,_0x278c70)=>{var _0x1d2b36=a0_0x5e6977;try{const {username:_0x1f6f9b,email:_0x1fa845,role:_0x4cae60}=_0x21f716[_0x1d2b36(0x190)],_0x80d8e3=_0x21f716[_0x1d2b36(0x190)],_0x54ea66=await profile['findOne']({'email':_0x80d8e3[_0x1d2b36(0x1a4)]}),_0x19cdfc=await master_shop[_0x1d2b36(0x156)]();console[_0x1d2b36(0x1e6)](_0x1d2b36(0x17e),_0x19cdfc);const _0x29bfd3=_0x21f716[_0x1d2b36(0x148)]['id'];console[_0x1d2b36(0x1e6)](_0x29bfd3);const _0x312e13=await purchases_finished[_0x1d2b36(0x15e)](_0x29bfd3);console[_0x1d2b36(0x1e6)](_0x1d2b36(0x1a0),_0x312e13);const _0x16780b=await product[_0x1d2b36(0x156)]({}),_0x95f21d=await warehouse[_0x1d2b36(0x193)]([{'$match':{'name':_0x312e13[_0x1d2b36(0x22c)],'room':_0x312e13[_0x1d2b36(0x1fc)]}},{'$unwind':_0x1d2b36(0x1b7)},{'$group':{'_id':_0x1d2b36(0x141),'name':{'$first':_0x1d2b36(0x15f)},'product_stock':{'$first':_0x1d2b36(0x197)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1d2b36(0x1b8)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1d2b36(0x1f2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1d2b36(0x231)},'storage':{'$first':_0x1d2b36(0x1aa)},'rack':{'$first':_0x1d2b36(0x212)}}}]);console[_0x1d2b36(0x1e6)](_0x1d2b36(0x21b),_0x95f21d);let _0x172051;if(_0x80d8e3[_0x1d2b36(0x20b)]=='staff'){const _0x24b297=await staff['findOne']({'email':_0x80d8e3['email']});_0x172051=await warehouse['find']({'status':_0x1d2b36(0x182),'name':_0x24b297[_0x1d2b36(0x206)],'warehouse_category':_0x1d2b36(0x1de),'name':_0x1d2b36(0x175)});}else _0x172051=await warehouse[_0x1d2b36(0x193)]([{'$match':{'status':_0x1d2b36(0x182),'warehouse_category':_0x1d2b36(0x1de),'name':_0x1d2b36(0x175)}},{'$group':{'_id':_0x1d2b36(0x151),'name':{'$first':_0x1d2b36(0x151)}}}]);if(_0x19cdfc[0x0][_0x1d2b36(0x186)]==_0x1d2b36(0x142)){var _0x15bc75=users[_0x1d2b36(0x1ee)];console['log'](_0x15bc75);}else{if(_0x19cdfc[0x0][_0x1d2b36(0x186)]==_0x1d2b36(0x18a))var _0x15bc75=users[_0x1d2b36(0x18a)];else{if(_0x19cdfc[0x0]['language']==_0x1d2b36(0x1dc))var _0x15bc75=users[_0x1d2b36(0x1dc)];else{if(_0x19cdfc[0x0]['language']==_0x1d2b36(0x1da))var _0x15bc75=users[_0x1d2b36(0x1da)];else{if(_0x19cdfc[0x0][_0x1d2b36(0x186)]==_0x1d2b36(0x1c4))var _0x15bc75=users[_0x1d2b36(0x1c4)];else{if(_0x19cdfc[0x0]['language']==_0x1d2b36(0x201))var _0x15bc75=users['Portuguese'];else{if(_0x19cdfc[0x0][_0x1d2b36(0x186)]==_0x1d2b36(0x17d))var _0x15bc75=users[_0x1d2b36(0x17d)];else{if(_0x19cdfc[0x0][_0x1d2b36(0x186)]==_0x1d2b36(0x13a))var _0x15bc75=users['Arabic'];}}}}}}}_0x278c70[_0x1d2b36(0x180)](_0x1d2b36(0x1a5),{'success':_0x21f716[_0x1d2b36(0x169)](_0x1d2b36(0x22b)),'errors':_0x21f716[_0x1d2b36(0x169)](_0x1d2b36(0x215)),'role':_0x80d8e3,'profile':_0x54ea66,'user':_0x312e13,'stock':_0x95f21d,'master_shop':_0x19cdfc,'product':_0x16780b,'language':_0x15bc75,'warehouse':_0x172051});}catch(_0x1042b9){console['log'](_0x1042b9);}}),router[a0_0x5e6977(0x1cd)](a0_0x5e6977(0x196),auth,async(_0x165248,_0x51cb21)=>{var _0x25453c=a0_0x5e6977;try{const {invoice:_0x1a161d,date:_0x471ea6,warehouse_name:_0x40a83e,Room_name:_0x40645f,product_name:_0x3de607,purchase_quantity:_0x503def,stocks:_0xa53fdd,return_qty:_0xbc9df2,note:_0x59a675,level:_0xcf06c5,isle:_0xe10327,pallet:_0x5c3ea8,to_warehouse_name:_0x4e00d9,to_Room_name:_0x4f6c3c}=_0x165248[_0x25453c(0x1ae)],_0x52cb81=await purchases_finished[_0x25453c(0x1ad)]({'_id':_0x165248[_0x25453c(0x148)]['id']}),_0x54c55c=await warehouse[_0x25453c(0x1ad)]({'name':_0x40a83e,'room':_0x40645f,'warehouse_category':_0x25453c(0x1de)});if(typeof _0x3de607==_0x25453c(0x147))var _0x57b5fc=[_0x165248[_0x25453c(0x1ae)][_0x25453c(0x170)]],_0x4f6105=[_0x165248[_0x25453c(0x1ae)]['purchase_quantity']],_0x336b79=[_0x165248[_0x25453c(0x1ae)][_0x25453c(0x221)]],_0x822aa4=[_0x165248[_0x25453c(0x1ae)][_0x25453c(0x1b3)]],_0x588b73=[_0x165248[_0x25453c(0x1ae)][_0x25453c(0x177)]],_0x4eb1a6=[_0x165248[_0x25453c(0x1ae)][_0x25453c(0x23b)]],_0x507304=[_0x165248[_0x25453c(0x1ae)][_0x25453c(0x187)]],_0x34dffb=[_0x165248[_0x25453c(0x1ae)][_0x25453c(0x20e)]];else var _0x57b5fc=[..._0x165248['body'][_0x25453c(0x170)]],_0x4f6105=[..._0x165248[_0x25453c(0x1ae)][_0x25453c(0x20a)]],_0x336b79=[..._0x165248['body']['stocks']],_0x822aa4=[..._0x165248[_0x25453c(0x1ae)][_0x25453c(0x1b3)]],_0x588b73=[..._0x165248['body'][_0x25453c(0x177)]],_0x4eb1a6=[..._0x165248[_0x25453c(0x1ae)][_0x25453c(0x23b)]],_0x507304=[..._0x165248[_0x25453c(0x1ae)][_0x25453c(0x187)]],_0x34dffb=[..._0x165248[_0x25453c(0x1ae)][_0x25453c(0x20e)]];const _0x1f6c4c=_0x57b5fc['map'](_0x3ddcc6=>{return _0x3ddcc6={'product_name':_0x3ddcc6};});_0x4f6105['forEach']((_0x3c5711,_0x3237db)=>{var _0x22677c=_0x25453c;_0x1f6c4c[_0x3237db][_0x22677c(0x20a)]=_0x3c5711;}),_0x336b79['forEach']((_0x186191,_0x5cc211)=>{var _0x5cc94d=_0x25453c;_0x1f6c4c[_0x5cc211][_0x5cc94d(0x1c1)]=_0x186191;}),_0x822aa4[_0x25453c(0x21d)]((_0x2a9bb1,_0x1e4384)=>{var _0x1414d7=_0x25453c;_0x1f6c4c[_0x1e4384][_0x1414d7(0x1b3)]=_0x2a9bb1;}),_0x588b73['forEach']((_0x5eae1b,_0x21aaae)=>{var _0x3804f3=_0x25453c;_0x1f6c4c[_0x21aaae][_0x3804f3(0x1dd)]=_0x5eae1b;}),_0x4eb1a6[_0x25453c(0x21d)]((_0x2fbcad,_0x10a632)=>{var _0x1defc9=_0x25453c;_0x1f6c4c[_0x10a632][_0x1defc9(0x15c)]=_0x2fbcad;}),_0x507304['forEach']((_0x2a8b25,_0x1081b2)=>{var _0x3678a3=_0x25453c;_0x1f6c4c[_0x1081b2][_0x3678a3(0x1c6)]=_0x2a8b25;}),_0x34dffb[_0x25453c(0x21d)]((_0xeda62b,_0x4d8235)=>{var _0x4a976d=_0x25453c;_0x1f6c4c[_0x4d8235][_0x4a976d(0x188)]=_0xeda62b;}),_0x1f6c4c[_0x25453c(0x21d)](_0x50b932=>{var _0x9c2f10=_0x25453c;console[_0x9c2f10(0x1e6)](_0x50b932);const _0x5568aa=_0x54c55c[_0x9c2f10(0x164)]['map'](_0x66f9e9=>{var _0x316c0f=_0x9c2f10;_0x66f9e9[_0x316c0f(0x170)]==_0x50b932[_0x316c0f(0x170)]&&_0x66f9e9[_0x316c0f(0x1dd)]==_0x50b932['bay']&&(console[_0x316c0f(0x1e6)](parseInt(_0x66f9e9[_0x316c0f(0x192)])+_0x316c0f(0x1e2)+parseInt(_0x50b932[_0x316c0f(0x1b3)])),_0x66f9e9[_0x316c0f(0x192)]=parseInt(_0x66f9e9['product_stock'])-parseInt(_0x50b932[_0x316c0f(0x1b3)]));});}),await _0x54c55c[_0x25453c(0x19a)]();var _0x4609cd=0x0;_0x1f6c4c[_0x25453c(0x21d)](_0x4f5254=>{var _0x5c247c=_0x25453c;(parseInt(_0x4f5254[_0x5c247c(0x20a)])<parseInt(_0x4f5254[_0x5c247c(0x1b3)])||parseInt(_0x4f5254[_0x5c247c(0x1c1)])<parseInt(_0x4f5254[_0x5c247c(0x1b3)]))&&_0x4609cd++;});if(_0x4609cd!=0x0)return _0x165248[_0x25453c(0x169)](_0x25453c(0x215),_0x25453c(0x18e)),_0x51cb21['redirect'](_0x25453c(0x1bc));const _0x25d8ae=new purchases_return_finished({'invoice':_0x1a161d,'suppliers':_0x165248[_0x25453c(0x1ae)]['suppliers'],'date':_0x471ea6,'warehouse_name':_0x40a83e,'return_product':_0x1f6c4c,'note':_0x59a675,'room':_0x40645f,'to_warehouse_name':_0x4e00d9,'to_room':_0x4f6c3c}),_0xf15b38=await _0x25d8ae[_0x25453c(0x19a)](),_0x27fdda=await purchases_return_finished[_0x25453c(0x1ad)]({'invoice':_0x1a161d}),_0x1adbde=await warehouse[_0x25453c(0x1ad)]({'name':_0x4e00d9,'room':_0x4f6c3c,'warehouse_category':_0x25453c(0x1de)});_0x27fdda[_0x25453c(0x209)][_0x25453c(0x21d)](_0x2d9253=>{var _0xf9cc21=_0x25453c,_0x53c7ce=0x0;const _0x391361=_0x1adbde[_0xf9cc21(0x164)][_0xf9cc21(0x140)](_0x154642=>{var _0x4dd578=_0xf9cc21;console[_0x4dd578(0x1e6)](_0x154642['product_name']+'=='+_0x2d9253[_0x4dd578(0x170)]+'&&'+_0x154642['bay']+'=='+_0x2d9253['bay']),_0x154642[_0x4dd578(0x170)]==_0x2d9253[_0x4dd578(0x170)]&&_0x154642[_0x4dd578(0x1dd)]==_0x2d9253[_0x4dd578(0x1dd)]&&(_0x154642[_0x4dd578(0x192)]=parseInt(_0x154642[_0x4dd578(0x192)])-parseInt(_0x2d9253[_0x4dd578(0x1b3)]),_0x53c7ce++);});_0x53c7ce=='0'&&(_0x1adbde['product_details']=_0x1adbde[_0xf9cc21(0x164)][_0xf9cc21(0x1ba)]({'product_name':_0x2d9253['product_name'],'product_stock':_0x2d9253[_0xf9cc21(0x1b3)],'primary_code':_0x2d9253[_0xf9cc21(0x1c6)],'secondary_code':_0x2d9253['secondary_code'],'product_code':_0x2d9253[_0xf9cc21(0x15c)],'bay':_0x2d9253[_0xf9cc21(0x1dd)],'maxProducts':0xf423f}));}),await _0x1adbde['save']();const _0x55b6fc=await purchases_finished['findOne']({'invoice':_0x1a161d});_0x55b6fc[_0x25453c(0x183)]='True';const _0x2810b5=await _0x55b6fc['save'](),_0x43adc2=new s_payment_data({'invoice':_0x1a161d,'suppliers':_0x165248[_0x25453c(0x1ae)]['suppliers'],'reason':_0x25453c(0x22d)});await _0x43adc2[_0x25453c(0x19a)]();const _0x5e875c=await master_shop[_0x25453c(0x156)](),_0x4754e2=await email_settings['findOne'](),_0x18d5ef=await suppliers[_0x25453c(0x1ad)]({'name':_0x165248[_0x25453c(0x1ae)][_0x25453c(0x160)]});_0x5e875c[0x0]['currency_placement']==0x1?(right_currency=_0x5e875c[0x0][_0x25453c(0x1d6)],left_currency=''):(right_currency='',left_currency=_0x5e875c[0x0]['currency']);var _0xa461c8=_0x57b5fc,_0x102c91=_0x822aa4,_0x31753c='',_0x4eec18;for(_0x4eec18 in _0xa461c8){_0x31753c+=_0x25453c(0x21c)+_0x25453c(0x16b)+_0xa461c8[_0x4eec18]+_0x25453c(0x1d7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x102c91[_0x4eec18]+_0x25453c(0x1d7)+_0x25453c(0x17f);}let _0x38c4ed=nodemailer['createTransport']({'service':_0x25453c(0x20c),'auth':{'user':_0x4754e2[_0x25453c(0x1a4)],'pass':_0x4754e2[_0x25453c(0x14b)]}}),_0x277d4f={'from':_0x4754e2[_0x25453c(0x1a4)],'to':_0x18d5ef['email'],'subject':_0x25453c(0x239),'attachments':[{'filename':_0x25453c(0x13d),'path':__dirname+_0x25453c(0x171)+'/upload/'+_0x5e875c[0x0][_0x25453c(0x154)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x25453c(0x15a)+_0x25453c(0x19d)+_0x25453c(0x1ef)+_0x25453c(0x18d)+_0x25453c(0x1ef)+_0x25453c(0x1c2)+_0x25453c(0x1f3)+_0x25453c(0x1ef)+_0x25453c(0x1e3)+_0x5e875c[0x0][_0x25453c(0x208)]+_0x25453c(0x174)+_0x25453c(0x1f3)+_0x25453c(0x1f3)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x25453c(0x1d9)+_0x25453c(0x1d4)+_0x1a161d+'\x20'+_0x25453c(0x16a)+'\x20Order\x20Date\x20:\x20'+_0x471ea6+'\x20'+_0x25453c(0x199)+'</h5>'+_0x25453c(0x1f3)+_0x25453c(0x152)+_0x25453c(0x22e)+_0x25453c(0x21c)+_0x25453c(0x18c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x25453c(0x1ca)+_0x25453c(0x1cc)+_0x25453c(0x17f)+_0x25453c(0x157)+_0x25453c(0x1fd)+'\x20'+_0x31753c+'\x20'+_0x25453c(0x13e)+_0x25453c(0x1b4)+_0x25453c(0x1ef)+_0x25453c(0x16e)+_0x25453c(0x18f)+_0x5e875c[0x0][_0x25453c(0x208)]+'</h5>'+'</div>'+_0x25453c(0x1f3)+_0x25453c(0x224)};_0x38c4ed['sendMail'](_0x277d4f,function(_0x321f79,_0x4ba750){var _0x3766aa=_0x25453c;_0x321f79?console['log'](_0x3766aa(0x16d)):console[_0x3766aa(0x1e6)](_0x3766aa(0x22f));}),_0x165248['flash'](_0x25453c(0x22b),_0x25453c(0x139)),_0x51cb21[_0x25453c(0x227)]('/all_purchases_finished/view');}catch(_0x292467){_0x51cb21[_0x25453c(0x21e)](0xc8)['json']({'message':_0x292467[_0x25453c(0x1ff)]});}}),router[a0_0x5e6977(0x1ce)](a0_0x5e6977(0x1af),auth,async(_0x2d41c9,_0x1e3aec)=>{var _0x1316be=a0_0x5e6977;try{const {username:_0x222531,email:_0x19cc92,role:_0x2a24df}=_0x2d41c9[_0x1316be(0x190)],_0x4396e7=_0x2d41c9[_0x1316be(0x190)],_0x37878b=await profile[_0x1316be(0x1ad)]({'email':_0x4396e7['email']}),_0x351cd7=await master_shop[_0x1316be(0x156)](),_0xc40319=_0x2d41c9['params']['id'],_0x313d21=await purchases_finished['findById'](_0xc40319);if(_0x351cd7[0x0]['language']==_0x1316be(0x142))var _0x193055=users['English'];else{if(_0x351cd7[0x0][_0x1316be(0x186)]==_0x1316be(0x18a))var _0x193055=users[_0x1316be(0x18a)];else{if(_0x351cd7[0x0][_0x1316be(0x186)]==_0x1316be(0x1dc))var _0x193055=users[_0x1316be(0x1dc)];else{if(_0x351cd7[0x0]['language']==_0x1316be(0x1da))var _0x193055=users['Spanish'];else{if(_0x351cd7[0x0]['language']==_0x1316be(0x1c4))var _0x193055=users['French'];else{if(_0x351cd7[0x0]['language']=='Portuguese\x20(BR)')var _0x193055=users['Portuguese'];else{if(_0x351cd7[0x0][_0x1316be(0x186)]=='Chinese')var _0x193055=users['Chinese'];else{if(_0x351cd7[0x0][_0x1316be(0x186)]==_0x1316be(0x13a))var _0x193055=users[_0x1316be(0x181)];}}}}}}}_0x1e3aec[_0x1316be(0x180)]('all_purchases_barcode',{'success':_0x2d41c9[_0x1316be(0x169)]('success'),'errors':_0x2d41c9[_0x1316be(0x169)]('errors'),'role':_0x4396e7,'profile':_0x37878b,'alldata':_0x313d21,'master_shop':_0x351cd7,'language':_0x193055}),console[_0x1316be(0x1e6)](alldata);}catch(_0x3aedc7){console[_0x1316be(0x1e6)](_0x3aedc7);}}),router[a0_0x5e6977(0x1cd)](a0_0x5e6977(0x236),async(_0x5dd5e5,_0x162216)=>{var _0x15ac97=a0_0x5e6977;const {product_code:_0x18268e}=_0x5dd5e5[_0x15ac97(0x1ae)];var _0x570025;const _0x41628a=await product[_0x15ac97(0x193)]([{'$match':{'primary_code':_0x18268e,'product_category':_0x15ac97(0x1de)}},{'$group':{'_id':'$_id','name':{'$first':_0x15ac97(0x151)},'category':{'$first':_0x15ac97(0x1a6)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x15ac97(0x202)},'product_code':{'$first':_0x15ac97(0x229)},'primary_code':{'$first':_0x15ac97(0x1d5)},'secondary_code':{'$first':_0x15ac97(0x214)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x15ac97(0x159)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x15ac97(0x1e8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x525590=await product[_0x15ac97(0x193)]([{'$match':{'secondary_code':_0x18268e}},{'$group':{'_id':_0x15ac97(0x168),'name':{'$first':_0x15ac97(0x151)},'category':{'$first':_0x15ac97(0x1a6)},'brand':{'$first':'$brand'},'unit':{'$first':_0x15ac97(0x1b0)},'alertquantity':{'$first':_0x15ac97(0x202)},'product_code':{'$first':_0x15ac97(0x229)},'primary_code':{'$first':_0x15ac97(0x1d5)},'secondary_code':{'$first':_0x15ac97(0x214)},'maxStocks':{'$first':_0x15ac97(0x1be)},'maxProdPerUnit':{'$first':_0x15ac97(0x159)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x15ac97(0x1e8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x41628a[_0x15ac97(0x14f)]>0x0)_0x570025=_0x41628a;else _0x525590[_0x15ac97(0x14f)]>0x0&&(_0x570025=_0x525590);_0x162216[_0x15ac97(0x1cb)](_0x570025);}),router['post'](a0_0x5e6977(0x1d8),async(_0x275ae8,_0x1512cf)=>{var _0x46aaa4=a0_0x5e6977;const {productCode:_0x3bb7b8,bay:_0x45c1db,warehouses:_0x2b0f1a,room:_0x16cc14}=_0x275ae8['body'];console[_0x46aaa4(0x1e6)](_0x275ae8[_0x46aaa4(0x1ae)]);try{const _0x935e43=await warehouse[_0x46aaa4(0x193)]([{'$match':{'name':_0x2b0f1a,'room':_0x16cc14}},{'$unwind':_0x46aaa4(0x1b7)},{'$match':{'product_details.bay':parseInt(_0x45c1db)}},{'$group':{'_id':_0x46aaa4(0x141),'name':{'$first':_0x46aaa4(0x15f)},'product_stock':{'$first':_0x46aaa4(0x197)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x46aaa4(0x1f5)}}}]);_0x1512cf[_0x46aaa4(0x21e)](0xc8)['json'](_0x935e43);}catch(_0x3cefa9){_0x1512cf['status'](0x194)[_0x46aaa4(0x1cb)]({'message':_0x3cefa9[_0x46aaa4(0x1ff)]});}}),module[a0_0x5e6977(0x1db)]=router;function a0_0x2420(){var _0x190e5a=['$return_data','quantity','English','<div>','$suppliers_docs','paid_amount','$product_details.primary_code','</div>','abs','$product_details.maxProducts','all','getDate','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$note','1020BmNxqf','room','<tbody\x20style=\x22text-align:\x20center;\x22>','suppliers_docs','message','floor','Portuguese\x20(BR)','$alertquantity','10Mvjgnl','1174923BMTXqX','2691708ECtrwO','warehouse','$product','site_title','return_product','purchase_quantity','role','gmail','filter','secondary_code_hide','express','QA\x20Warehouse','1reYMif','$product_details.rack','prod_level','$secondary_code','errors','production_date','prod_primunit','POnumber','There\x27s\x20a\x20error\x20in\x20this\x20transaction','createTransport','stock_data','<tr>','forEach','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','standard_unit','stocks','An\x20error\x20occurred\x20while\x20saving\x20data.','68450XjuzQg','</body></html>','maxStocks','INCF-','redirect','Paid\x20For\x20Purchase','$product_code','Portuguese','success','warehouse_name','Purchase\x20Return','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Email\x20sent\x20successfully','purchase\x20data\x20add\x20successfully','$product_details.product_code','Room_name','\x20Order\x20Date\x20:\x20','getFullYear','$batch_code','/barcode_scanner','Purchase\x20Mail','batch_code','Purchase\x20Return\x20Mail','/invoice/:id','product_code_hide','$expiry_date','purchases\x20item\x20return\x20successfull','Arabic\x20(ae)','due_amount','edit_purchases_finished','Logo.png','</tbody>','172JQefeZ','map','$product_details._id','English\x20(US)','catch','$product.bay','product_date','nodemailer','string','params','expiry_date','getMonth','password','$product.type','product_cat','port','length','prod_code','$name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</h5>','image','214841dxCLCa','find','</thead>','random','$maxProdPerUnit','<html><head><title></title>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','product_code','/all_purchases/view','findById','$product_details.product_name','suppliers','Rack\x202','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','product_details','RoomAssign','ejs','DRY\x20GOODS','$_id','flash','<span\x20style=\x22float:\x20right;\x22>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','6988926IVIEmd','Error\x20Occurs','<strong>\x20Regards\x20</strong>','date','product_name','/../public','purchase\x20data\x20update\x20successfully','prod_invoice','\x20</h2>','Return\x20Goods','slice','level','JO_number','logo','/give_payment/:id','purchase_invoice','error','Chinese','master','</tr>','render','Arabic','Enabled','return_data','prod_name','secondary_unit','language','primary_code_hide','secondary_code','host','Hindi','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<h5>','user','../middleware/auth','product_stock','aggregate','<hr\x20class=\x22my-3\x22>','payment\x20successfull','/view/return_purchase/:id','$product_details.product_stock','FGSEmail','</span>','save','130496CaXaRw','/upload/','</head><body>','_id','$date','user_id','/preview/:id','$product.room_name','$product.quantity','email','return_purchase_finished','$category','<!DOCTYPE\x20html>','prod_unit','maxperunit','$product_details.storage','$suppliers','$due_amount','findOne','body','/barcode/:id','$unit','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','return_qty','</table>','/view/:id','edit_purchases_finished_view','$product_details','$product_details.type','add_purchases\x20error','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','back','toString','$maxStocks','$room','prod_cat','stock_quantity','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/add_purchases','French','prod_Qty','primary_code','staff','name','path','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','post','get','7mXoCgr','add_purchases_finished','sendMail','Router','/view','\x20Order\x20Number\x20:\x20','$primary_code','currency','</td>','/CheckingWarehouse','<h5\x20style=\x22text-align:\x20left;\x22>','Spanish','exports','German','bay','Finished\x20Goods','amount','$warehouse_name','$product.floorlevel','\x20<>\x20','<h2>\x20','MaxStocks_data','updateOne','log','2335536MEJjSX','$secondary_unit','/all_purchases_finished/view','table\x20page','room_name'];a0_0x2420=function(){return _0x190e5a;};return a0_0x2420();}