var a0_0x41b9e4=a0_0x3caa;(function(_0x3a8517,_0x5a9998){var _0xe10caf=a0_0x3caa,_0x1386d8=_0x3a8517();while(!![]){try{var _0x2af7e0=-parseInt(_0xe10caf(0x15f))/0x1*(parseInt(_0xe10caf(0x121))/0x2)+parseInt(_0xe10caf(0x1a5))/0x3*(parseInt(_0xe10caf(0xe3))/0x4)+-parseInt(_0xe10caf(0x16b))/0x5+parseInt(_0xe10caf(0xcc))/0x6*(-parseInt(_0xe10caf(0x13f))/0x7)+-parseInt(_0xe10caf(0x158))/0x8+parseInt(_0xe10caf(0x1a3))/0x9+parseInt(_0xe10caf(0x188))/0xa*(parseInt(_0xe10caf(0xb4))/0xb);if(_0x2af7e0===_0x5a9998)break;else _0x1386d8['push'](_0x1386d8['shift']());}catch(_0x513e99){_0x1386d8['push'](_0x1386d8['shift']());}}}(a0_0x278c,0x42cb2));const express=require(a0_0x41b9e4(0xaf)),app=express(),router=express[a0_0x41b9e4(0x167)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x41b9e4(0xe4)),auth=require(a0_0x41b9e4(0x18a)),nodemailer=require('nodemailer');var ejs=require(a0_0x41b9e4(0xbd));function a0_0x3caa(_0x3b8738,_0x4c476a){var _0x278cf1=a0_0x278c();return a0_0x3caa=function(_0x3caa6e,_0x2543c4){_0x3caa6e=_0x3caa6e-0xac;var _0x1fa87a=_0x278cf1[_0x3caa6e];return _0x1fa87a;},a0_0x3caa(_0x3b8738,_0x4c476a);}const path=require(a0_0x41b9e4(0xde)),users=require(a0_0x41b9e4(0xc5));router['get'](a0_0x41b9e4(0xc3),auth,async(_0x408186,_0x212efb)=>{var _0x144887=a0_0x41b9e4;try{const {username:_0x3fa0e,email:_0x2af61f,role:_0x386084}=_0x408186[_0x144887(0x17e)],_0xe8f7ec=_0x408186[_0x144887(0x17e)],_0x54cdd8=await profile[_0x144887(0xd1)]({'email':_0xe8f7ec[_0x144887(0xc6)]}),_0x485105=await staff['findOne']({'email':_0xe8f7ec[_0x144887(0xc6)]});if(_0xe8f7ec['role']==_0x144887(0x126)){const _0x2248f9=await staff[_0x144887(0xd1)]({'email':_0xe8f7ec[_0x144887(0xc6)]});}const _0x4140ad=await master_shop['find']();let _0x1e7de2;if(_0xe8f7ec[_0x144887(0xd8)]==_0x144887(0x126)){const _0x4b6f09=await staff[_0x144887(0xd1)]({'email':_0xe8f7ec[_0x144887(0xc6)]});_0x1e7de2=await purchases_finished[_0x144887(0xdd)]([{'$match':{'warehouse_name':_0x4b6f09['warehouse']}},{'$lookup':{'from':_0x144887(0x12a),'localField':_0x144887(0x12a),'foreignField':_0x144887(0x199),'as':_0x144887(0xd3)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x144887(0xf0)},'suppliers':{'$first':_0x144887(0x10c)},'date':{'$first':_0x144887(0xeb)},'warehouse_name':{'$first':_0x144887(0x117)},'room':{'$first':_0x144887(0x119)},'product':{'$push':_0x144887(0x193)},'note':{'$first':_0x144887(0x176)},'paid_amount':{'$first':_0x144887(0x16e)},'due_amount':{'$first':_0x144887(0x16f)},'return_data':{'$first':_0x144887(0x186)},'batch_code':{'$first':_0x144887(0x132)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x144887(0x144)},'total_product_quantity':{'$sum':_0x144887(0x127)},'level':{'$addToSet':_0x144887(0x19e)},'isle':{'$addToSet':_0x144887(0x19b)},'type':{'$addToSet':_0x144887(0xae)},'floorlevel':{'$addToSet':_0x144887(0x1a7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1e7de2=await purchases_finished[_0x144887(0xdd)]([{'$unwind':_0x144887(0x193)},{'$group':{'_id':_0x144887(0x13d),'invoice':{'$first':_0x144887(0xf0)},'suppliers':{'$first':_0x144887(0x10c)},'date':{'$first':_0x144887(0xeb)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x144887(0x193)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x144887(0x16e)},'due_amount':{'$first':_0x144887(0x16f)},'return_data':{'$first':_0x144887(0x186)},'batch_code':{'$first':_0x144887(0x132)},'expiry_date':{'$first':_0x144887(0xb3)},'suppliers_docs':{'$first':_0x144887(0x144)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x144887(0xae)},'floorlevel':{'$addToSet':_0x144887(0x1a7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x4140ad[0x0][_0x144887(0x169)]==_0x144887(0x150))var _0xc7d4d8=users[_0x144887(0x15b)];else{if(_0x4140ad[0x0][_0x144887(0x169)]==_0x144887(0xb7))var _0xc7d4d8=users[_0x144887(0xb7)];else{if(_0x4140ad[0x0][_0x144887(0x169)]==_0x144887(0xcd))var _0xc7d4d8=users[_0x144887(0xcd)];else{if(_0x4140ad[0x0]['language']==_0x144887(0x14c))var _0xc7d4d8=users[_0x144887(0x14c)];else{if(_0x4140ad[0x0]['language']==_0x144887(0xe8))var _0xc7d4d8=users[_0x144887(0xe8)];else{if(_0x4140ad[0x0]['language']==_0x144887(0x14b))var _0xc7d4d8=users[_0x144887(0x138)];else{if(_0x4140ad[0x0]['language']==_0x144887(0x104))var _0xc7d4d8=users[_0x144887(0x104)];else{if(_0x4140ad[0x0][_0x144887(0x169)]==_0x144887(0x168))var _0xc7d4d8=users[_0x144887(0xf8)];}}}}}}}_0x212efb[_0x144887(0x177)](_0x144887(0x147),{'success':_0x408186[_0x144887(0xfb)]('success'),'errors':_0x408186[_0x144887(0xfb)](_0x144887(0x17d)),'purchases':_0x1e7de2,'role':_0xe8f7ec,'profile':_0x54cdd8,'master_shop':_0x4140ad,'language':_0xc7d4d8});}catch(_0x413ad4){console[_0x144887(0x173)](_0x144887(0x1a6),_0x413ad4),_0x212efb['status'](0xc8)[_0x144887(0x1a9)]({'message':_0x413ad4[_0x144887(0x1a8)]});}});function a0_0x278c(){var _0x46a795=['edit_purchases_finished_view','Purchase\x20Return','$product_details','Portuguese','MaxStocks_data','$primary_code','site_title','</h5>','$_id','$unit','28GFPidP','product_date','note','<h2>\x20','/give_payment/:id','$suppliers_docs','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','all_purchases_finished','</body></html>','prod_level','/barcode/:id','Portuguese\x20(BR)','Spanish','INCF-','catch','return_purchase_finished','English\x20(US)','RoomAssign','prod_unit','filter','return_qty','$product_details.floorlevel','<h5>','$category','34224xtIxMJ','max_product_unit','product_code_hide','English','post','purchase_quantity','amount','71138RvGwBV','payment\x20successfull','Logo.png','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','sendMail','</div>','forEach','save','Router','Arabic\x20(ae)','language','<strong>\x20Regards\x20</strong>','733465iglGtj','\x20Order\x20Date\x20:\x20','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$paid_amount','$due_amount','<div>','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','An\x20error\x20occurred.','$note','render','Paid\x20For\x20Purchase','production_date','findById','createTransport','success','errors','user','product_name','/all_purchases/view','$brand','$secondary_unit','An\x20error\x20occurred\x20while\x20saving\x20data.','<hr\x20class=\x22my-3\x22>','batch_code','$return_data','concat','410YlvYkN','prod_invoice','../middleware/auth','invoice','edit_purchases_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','expiry_date','Finished\x20Goods','$maxProdPerUnit','get','</tr>','$product','\x20Order\x20Number\x20:\x20','prod_primunit','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','</td>','$alertquantity','name','\x20</h2>','$product.bin','$product_details.bay','floor','$product.bay','$product_details.product_stock','$maxStocks','$product_details.bin','/view/:id','1575675fGxwRg','user_id','164001lsgTox','table\x20page','$product.floorlevel','message','json','/view/add_purchases/:id','quantity','purchase_invoice','Rack\x201','$product.type','express','params','$product_details.secondary_code','<tbody\x20style=\x22text-align:\x20center;\x22>','$expiry_date','119262VnMTyE','updateOne','Enabled','Hindi','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','secondary_code','</tbody>','room_name','due_amount','ejs','QA\x20Warehouse','stocks','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','purchase\x20data\x20add\x20successfully','/view','prod_qty','../public/language/languages.json','email','$product_details.type','getFullYear','Email\x20sent\x20successfully','padStart','DRY\x20GOODS','349854QdEeZx','German','currency_placement','map','image','findOne','purchase\x20data\x20update\x20successfully','suppliers_docs','prod_Qty','standard_unit','room','/invoice/:id','role','Purchase\x20Return\x20Mail','$product_details.product_name','host','FROZEN\x20GOODS','aggregate','path','</span>','stock_quantity','getDate','date','8hwZzqV','../models/all_models','$secondary_code','product_stock','secondary_unit','French','prod_cat','$product_details.maxProducts','$date','secondary_code_hide','status','\x20<>\x20','currency','$invoice','find','/view/return_purchase/:id','/../public','prod_name','return_data','product_details','$product_details.rack','Arabic','toString','warehouse_name','flash','POnumber','product_code','$product_details._id','warehouse','master','paid_amount','body','FGSEmail','Chinese','string','/view/add_purchases','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','slice','random','gmail','$suppliers','$product_code','product','length','abs','Return\x20Goods','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','JO_number','primary_code','port','then','$warehouse_name','/all_purchases_finished/view','$room','Error\x20Occurs','$product_details.product_code','$name','add_purchases_finished','/upload/','product_cat','bay','2wZyWCO','add_purchases\x20error','</table>','<span\x20style=\x22float:\x20right;\x22>','maxStocks','staff','$product.quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','suppliers','logo','getMonth','<tr>','</head><body>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','primary_code_hide','maxperunit','$batch_code','prod_secondunit','$product_details.primary_code'];a0_0x278c=function(){return _0x46a795;};return a0_0x278c();}function BayBinSelected(_0x3583db,_0x502219){var _0x3212e1=a0_0x41b9e4,_0x54a8d5=[],_0x583a95=[];if(_0x3583db==_0x3212e1(0xcb)){switch(_0x502219){case'Rack\x201':_0x54a8d5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x54a8d5=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x583a95=['DG'];}else{if(_0x3583db==_0x3212e1(0xdc)){switch(_0x502219){case _0x3212e1(0xad):_0x54a8d5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x54a8d5=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x583a95=['FG'];}}return{'levels':_0x54a8d5,'identify':_0x583a95};}async function getRandom8DigitNumber(){var _0x155766=a0_0x41b9e4;const _0x2dc901=0x989680,_0x33b996=0x5f5e0ff,_0x3b76fa=Math[_0x155766(0x19d)](Math[_0x155766(0x10a)]()*(_0x33b996-_0x2dc901+0x1))+_0x2dc901;var _0x483c6f;const _0x3bdca3=await purchases_finished[_0x155766(0xd1)]({'invoice':_0x155766(0x14d)+_0x3b76fa});return _0x3bdca3&&_0x3bdca3['length']>0x0?_0x483c6f=_0x155766(0x14d)+_0x3b76fa:_0x483c6f=_0x155766(0x14d)+_0x3b76fa,_0x483c6f;}router[a0_0x41b9e4(0x191)](a0_0x41b9e4(0x106),auth,async(_0x4796b8,_0x1b40a0)=>{var _0x4ad1ee=a0_0x41b9e4;try{const {username:_0x52d414,email:_0x2ebf60,role:_0x2ebead}=_0x4796b8['user'],_0x435880=_0x4796b8[_0x4ad1ee(0x17e)],_0x4581ce=await profile[_0x4ad1ee(0xd1)]({'email':_0x435880[_0x4ad1ee(0xc6)]}),_0x111aed=await master_shop[_0x4ad1ee(0xf1)](),_0x310918=await staff[_0x4ad1ee(0xd1)]({'email':_0x435880[_0x4ad1ee(0xc6)]}),_0x555493=await suppliers['find']({});let _0x5a4043;if(_0x435880[_0x4ad1ee(0xd8)]==_0x4ad1ee(0x126)){const _0x2e2fd1=await staff[_0x4ad1ee(0xd1)]({'email':_0x435880['email']});_0x5a4043=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x2e2fd1[_0x4ad1ee(0xff)],'warehouse_category':_0x4ad1ee(0x18f)}},{'$group':{'_id':'$name','name':{'$first':_0x4ad1ee(0x11c)}}}]);}else _0x5a4043=await warehouse[_0x4ad1ee(0xdd)]([{'$match':{'status':'Enabled','warehouse_category':_0x4ad1ee(0x18f),'name':{'$ne':_0x4ad1ee(0xbe)}}},{'$group':{'_id':_0x4ad1ee(0x11c),'name':{'$first':'$name'}}}]);const _0x3833a2=await product['find']({}),_0x1afbca=await warehouse[_0x4ad1ee(0xf1)]({'status':_0x4ad1ee(0xb6)}),_0x3fb74a=await purchases_finished[_0x4ad1ee(0xf1)]({}),_0x3e4cdb=_0x3fb74a[_0x4ad1ee(0x10f)]+0x1,_0x2e6408=_0x4ad1ee(0x14d)+_0x3e4cdb[_0x4ad1ee(0xf9)]()[_0x4ad1ee(0xca)](0x5,'0');var _0x58eae6=['Ambient','Enclosed'];if(_0x111aed[0x0][_0x4ad1ee(0x169)]==_0x4ad1ee(0x150))var _0x2cdb19=users[_0x4ad1ee(0x15b)];else{if(_0x111aed[0x0][_0x4ad1ee(0x169)]==_0x4ad1ee(0xb7))var _0x2cdb19=users[_0x4ad1ee(0xb7)];else{if(_0x111aed[0x0][_0x4ad1ee(0x169)]=='German')var _0x2cdb19=users['German'];else{if(_0x111aed[0x0][_0x4ad1ee(0x169)]==_0x4ad1ee(0x14c))var _0x2cdb19=users[_0x4ad1ee(0x14c)];else{if(_0x111aed[0x0][_0x4ad1ee(0x169)]==_0x4ad1ee(0xe8))var _0x2cdb19=users[_0x4ad1ee(0xe8)];else{if(_0x111aed[0x0][_0x4ad1ee(0x169)]==_0x4ad1ee(0x14b))var _0x2cdb19=users['Portuguese'];else{if(_0x111aed[0x0]['language']==_0x4ad1ee(0x104))var _0x2cdb19=users[_0x4ad1ee(0x104)];else{if(_0x111aed[0x0]['language']==_0x4ad1ee(0x168))var _0x2cdb19=users['Arabic'];}}}}}}}const _0x584ad4=getRandom8DigitNumber();_0x584ad4[_0x4ad1ee(0x116)](_0x296c43=>{var _0x51dc79=_0x4ad1ee;_0x1b40a0[_0x51dc79(0x177)](_0x51dc79(0x11d),{'success':_0x4796b8['flash'](_0x51dc79(0x17c)),'errors':_0x4796b8['flash'](_0x51dc79(0x17d)),'role':_0x435880,'profile':_0x4581ce,'suppliers':_0x555493,'warehouse':_0x5a4043,'product':_0x3833a2,'invoice':_0x296c43,'master_shop':_0x111aed,'language':_0x2cdb19,'find_data':_0x1afbca,'rooms_data':_0x58eae6});})[_0x4ad1ee(0x14e)](_0x1b40e1=>{var _0x4d56ff=_0x4ad1ee;_0x4796b8[_0x4d56ff(0xfb)](_0x4d56ff(0x17d),_0x4d56ff(0x12f)),_0x1b40a0['redirect'](_0x4d56ff(0x118));});}catch(_0x45e332){console['log'](_0x45e332);}}),router['get'](a0_0x41b9e4(0x1aa),auth,async(_0x3e9354,_0x2118c2)=>{var _0x5a87b9=a0_0x41b9e4;try{const _0x5b75a6=_0x3e9354['params']['id'];console['log'](_0x5b75a6);const _0x2db8b3=await master_shop[_0x5a87b9(0xf1)]();console[_0x5a87b9(0x173)](_0x5a87b9(0x100),_0x2db8b3);const _0x2eaa48=await product[_0x5a87b9(0xd1)]({'name':_0x5b75a6});console['log'](_0x5a87b9(0x10e),_0x2eaa48),_0x2118c2['status'](0xc8)['json']({'product_data':_0x2eaa48,'master':_0x2db8b3});}catch(_0x4c7db9){console[_0x5a87b9(0x173)](_0x5a87b9(0x122),_0x4c7db9);}}),router[a0_0x41b9e4(0x15c)](a0_0x41b9e4(0x106),auth,async(_0x39a6b0,_0x14357e)=>{var _0x25ddf4=a0_0x41b9e4;try{const {invoice:_0x59c74b,date:_0x55e06a,warehouse_name:_0xf19e43,prod_name:_0x2169df,prod_code:_0x34f5fd,prod_qty:_0x3b78bf,prod_unit:_0x3769b1,prod_secondunit:_0x2519bf,prod_level:_0xc06959,prod_isle:_0x388b0d,prod_pallet:_0x271cab,note:_0x1cf7f0,expiry_date:_0x3ffe77,batch_code:_0x1d991b,payable:_0x1117b1,due_amount:_0x247201,Room_name:_0x36651e,primary_code:_0x15ef9e,secondary_code:_0x38c5be,MaxStocks_data:_0x5283b6,PO_number:_0x106031,SCRN:_0x30da00,JO_number:_0x1444e6}=_0x39a6b0[_0x25ddf4(0x102)];if(typeof _0x2169df=='string')var _0x513eb8=[_0x39a6b0[_0x25ddf4(0x102)]['prod_name']],_0xe1d4af=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x107)]],_0x25ca74=[_0x39a6b0['body']['prod_Qty']],_0x5633fe=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x195)]],_0x20a727=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x133)]],_0x368619=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x149)]],_0x515050=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x114)]],_0x1f41fe=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0xb9)]],_0xdccdea=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x139)]],_0x15e34f=[_0x39a6b0[_0x25ddf4(0x102)]['batch_code']],_0xf2b3d=[_0x39a6b0['body'][_0x25ddf4(0x18e)]],_0x4170fd=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x140)]],_0x41b5e6=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x159)]],_0x5dec7d=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0xe9)]],_0x242be9=[_0x39a6b0['body'][_0x25ddf4(0x151)]],_0xe11d=[_0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x189)]];else var _0x513eb8=[..._0x39a6b0['body'][_0x25ddf4(0xf4)]],_0xe1d4af=[..._0x39a6b0[_0x25ddf4(0x102)]['prod_code']],_0x25ca74=[..._0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0xd4)]],_0x5633fe=[..._0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x195)]],_0x20a727=[..._0x39a6b0['body'][_0x25ddf4(0x133)]],_0x368619=[..._0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x149)]],_0x515050=[..._0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x114)]],_0x1f41fe=[..._0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0xb9)]],_0xdccdea=[..._0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x139)]],_0x15e34f=[..._0x39a6b0[_0x25ddf4(0x102)]['batch_code']],_0xf2b3d=[..._0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x18e)]],_0x4170fd=[..._0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x140)]],_0x41b5e6=[..._0x39a6b0[_0x25ddf4(0x102)]['max_product_unit']],_0x5dec7d=[..._0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0xe9)]],_0x242be9=[..._0x39a6b0['body'][_0x25ddf4(0x151)]],_0xe11d=[..._0x39a6b0[_0x25ddf4(0x102)][_0x25ddf4(0x189)]];const _0x17ddbc=_0x513eb8[_0x25ddf4(0xcf)](_0x520438=>{return _0x520438={'product_name':_0x520438};});_0xe1d4af[_0x25ddf4(0x165)]((_0x500fd2,_0x3e6b13)=>{_0x17ddbc[_0x3e6b13]['product_code']=_0x500fd2;}),_0x25ca74[_0x25ddf4(0x165)]((_0x460fe4,_0x2c8438)=>{var _0x503455=_0x25ddf4;_0x17ddbc[_0x2c8438][_0x503455(0x1ab)]=Math[_0x503455(0x110)](_0x460fe4);}),_0x5633fe[_0x25ddf4(0x165)]((_0x2a56f9,_0x226293)=>{var _0x336801=_0x25ddf4;_0x17ddbc[_0x226293][_0x336801(0xd5)]=_0x2a56f9;}),_0x20a727[_0x25ddf4(0x165)]((_0x42f21e,_0x57d893)=>{var _0x1dc070=_0x25ddf4;_0x17ddbc[_0x57d893][_0x1dc070(0xe7)]=_0x42f21e;}),_0x368619[_0x25ddf4(0x165)]((_0x330a6b,_0x325c8b)=>{var _0x3a0e81=_0x25ddf4;_0x17ddbc[_0x325c8b][_0x3a0e81(0x120)]=_0x330a6b;}),_0x515050[_0x25ddf4(0x165)]((_0x229887,_0x3a065a)=>{_0x17ddbc[_0x3a065a]['primary_code']=_0x229887;}),_0x1f41fe[_0x25ddf4(0x165)]((_0x142d09,_0x27f6fc)=>{_0x17ddbc[_0x27f6fc]['secondary_code']=_0x142d09;}),_0xdccdea[_0x25ddf4(0x165)]((_0x3f1fd8,_0x30d6fe)=>{var _0x50db7c=_0x25ddf4;_0x17ddbc[_0x30d6fe][_0x50db7c(0x125)]=_0x3f1fd8;}),_0x15e34f['forEach']((_0x1da97c,_0x5755ff)=>{_0x17ddbc[_0x5755ff]['batch_code']=_0x1da97c;}),_0xf2b3d['forEach']((_0x2d159d,_0x41859c)=>{var _0x194ba7=_0x25ddf4;_0x17ddbc[_0x41859c][_0x194ba7(0x18e)]=_0x2d159d;}),_0x4170fd[_0x25ddf4(0x165)]((_0x2b4135,_0x67ea2e)=>{var _0x7fcc11=_0x25ddf4;_0x17ddbc[_0x67ea2e][_0x7fcc11(0x179)]=_0x2b4135;}),_0x41b5e6['forEach']((_0x23c76c,_0x510d74)=>{var _0x4d3f3b=_0x25ddf4;_0x17ddbc[_0x510d74][_0x4d3f3b(0x131)]=_0x23c76c;}),_0x5dec7d[_0x25ddf4(0x165)]((_0x34e77b,_0x4e8984)=>{var _0x55d300=_0x25ddf4;_0x17ddbc[_0x4e8984][_0x55d300(0x11f)]=_0x34e77b;}),_0x242be9[_0x25ddf4(0x165)]((_0x2d749d,_0x26a5b3)=>{var _0x5bf75e=_0x25ddf4;_0x17ddbc[_0x26a5b3][_0x5bf75e(0xbb)]=_0x2d749d;}),_0xe11d[_0x25ddf4(0x165)]((_0x420cd7,_0x22cdd2)=>{var _0x3952fb=_0x25ddf4;_0x17ddbc[_0x22cdd2][_0x3952fb(0x18b)]=_0x420cd7;});const _0x429b03=_0x17ddbc['filter'](_0x3fc0e6=>_0x3fc0e6[_0x25ddf4(0x1ab)]!=='0'&&_0x3fc0e6[_0x25ddf4(0x1ab)]!==''),_0x1ea8b8=new purchases_finished({'invoice':_0x59c74b,'suppliers':_0x39a6b0['body'][_0x25ddf4(0x12a)],'date':_0x55e06a,'warehouse_name':_0xf19e43,'product':_0x429b03,'note':_0x1cf7f0,'due_amount':_0x247201,'room':_0x36651e,'POnumber':_0x106031,'SCRN':_0x30da00,'JO_number':_0x1444e6}),_0x3f647d=await _0x1ea8b8[_0x25ddf4(0x166)](),_0x44a9e8=await purchases_finished[_0x25ddf4(0xd1)]({'invoice':_0x59c74b}),_0xf59d18=_0x44a9e8[_0x25ddf4(0x10e)][_0x25ddf4(0xcf)](async _0x50ba40=>{var _0x1b92f2=_0x25ddf4,_0x58f333=await warehouse[_0x1b92f2(0xd1)]({'name':_0xf19e43,'room':_0x50ba40[_0x1b92f2(0xbb)]}),_0x3760c0=0x0;const _0x44ecc4=_0x58f333[_0x1b92f2(0xf6)][_0x1b92f2(0xcf)](_0x5d2f7d=>{var _0x29db8=_0x1b92f2;console[_0x29db8(0x173)](_0x5d2f7d[_0x29db8(0x17f)]+'=='+_0x50ba40['product_name']+'&&'+_0x5d2f7d['bay']+'=='+_0x50ba40[_0x29db8(0x120)]+'&&'+_0x5d2f7d[_0x29db8(0x18e)]+'=='+_0x50ba40[_0x29db8(0x18e)]+'&&'+_0x5d2f7d[_0x29db8(0x179)]+'=='+_0x50ba40[_0x29db8(0x179)]+'&&'+_0x5d2f7d[_0x29db8(0x185)]+'=='+_0x50ba40[_0x29db8(0x185)]+'&&'+_0x5d2f7d['invoice']+'=='+_0x44a9e8[_0x29db8(0x18b)]),_0x5d2f7d[_0x29db8(0x17f)]==_0x50ba40[_0x29db8(0x17f)]&&_0x5d2f7d['bay']==_0x50ba40['bay']&&_0x5d2f7d[_0x29db8(0x18e)]==_0x50ba40[_0x29db8(0x18e)]&&_0x5d2f7d['production_date']==_0x50ba40[_0x29db8(0x179)]&&_0x5d2f7d['batch_code']==_0x50ba40[_0x29db8(0x185)]&&_0x5d2f7d[_0x29db8(0x18b)]==_0x44a9e8['invoice']&&(_0x5d2f7d[_0x29db8(0xe6)]=Math['abs'](_0x5d2f7d[_0x29db8(0xe6)])+Math[_0x29db8(0x110)](_0x50ba40['quantity']),_0x3760c0++);});return _0x3760c0=='0'&&(_0x58f333[_0x1b92f2(0xf6)]=_0x58f333[_0x1b92f2(0xf6)][_0x1b92f2(0x187)]({'product_name':_0x50ba40['product_name'],'product_stock':Math[_0x1b92f2(0x110)](_0x50ba40[_0x1b92f2(0x1ab)]),'primary_code':_0x50ba40[_0x1b92f2(0x114)],'secondary_code':_0x50ba40[_0x1b92f2(0xb9)],'product_code':_0x50ba40[_0x1b92f2(0xfd)],'bay':_0x50ba40[_0x1b92f2(0x120)],'maxProducts':_0x50ba40['maxStocks'],'unit':_0x50ba40['standard_unit'],'secondary_unit':_0x50ba40[_0x1b92f2(0xe7)],'expiry_date':_0x50ba40[_0x1b92f2(0x18e)],'production_date':_0x50ba40['production_date'],'maxProducts':_0x50ba40[_0x1b92f2(0x125)],'maxPerUnit':_0x50ba40[_0x1b92f2(0x131)],'batch_code':_0x50ba40[_0x1b92f2(0x185)],'product_cat':_0x50ba40['product_cat'],'invoice':_0x50ba40[_0x1b92f2(0x18b)]})),_0x58f333;});Promise['all'](_0xf59d18)['then'](async _0x2f0e95=>{var _0x2b0eb7=_0x25ddf4;try{for(const _0x50ac3e of _0x2f0e95){await warehouse[_0x2b0eb7(0xb5)]({'_id':_0x50ac3e['_id']},{'$addToSet':{'product_details':{'$each':_0x50ac3e[_0x2b0eb7(0xf6)]}}});}const _0x280f8f=await master_shop[_0x2b0eb7(0xf1)](),_0x5705d9=await email_settings[_0x2b0eb7(0xd1)](),_0x11b7b1=await supervisor_settings[_0x2b0eb7(0xf1)]();var _0x578880=_0x44a9e8[_0x2b0eb7(0x10e)],_0x3470b2='',_0x146d06;for(_0x146d06 in _0x578880){var _0x10fbee='FG';_0x44a9e8['warehouse_name']==_0x2b0eb7(0xcb)&&(_0x10fbee='DG'),_0x3470b2+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x578880[_0x146d06][_0x2b0eb7(0x17f)]+_0x2b0eb7(0x197)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x578880[_0x146d06][_0x2b0eb7(0xfd)]+_0x2b0eb7(0x197)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x578880[_0x146d06]['quantity']+_0x2b0eb7(0x197)+_0x2b0eb7(0x16d)+_0x578880[_0x146d06][_0x2b0eb7(0xd5)]+_0x2b0eb7(0x197)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x578880[_0x146d06][_0x2b0eb7(0xe7)]+'</td>'+_0x2b0eb7(0x16d)+_0x44a9e8[_0x2b0eb7(0xfa)]+_0x2b0eb7(0x197)+_0x2b0eb7(0x16d)+_0x578880[_0x146d06]['room_name']+_0x2b0eb7(0x197)+_0x2b0eb7(0x16d)+_0x10fbee+_0x578880[_0x146d06][_0x2b0eb7(0x120)]+_0x2b0eb7(0x197),_0x2b0eb7(0x192);}let _0x1ed468=nodemailer[_0x2b0eb7(0x17b)]({'host':_0x5705d9[_0x2b0eb7(0xdb)],'port':Number(_0x5705d9[_0x2b0eb7(0x115)]),'secure':![],'auth':{'user':_0x5705d9[_0x2b0eb7(0xc6)],'pass':_0x5705d9['password']}}),_0x390415={'from':_0x5705d9[_0x2b0eb7(0xc6)],'to':_0x11b7b1[0x0][_0x2b0eb7(0x103)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x2b0eb7(0x161),'path':__dirname+_0x2b0eb7(0xf3)+_0x2b0eb7(0x11e)+_0x280f8f[0x0][_0x2b0eb7(0xd0)],'cid':_0x2b0eb7(0x12b)}],'html':_0x2b0eb7(0x171)+'<html><head><title></title>'+_0x2b0eb7(0x12e)+_0x2b0eb7(0x170)+_0x2b0eb7(0x162)+_0x2b0eb7(0x170)+_0x2b0eb7(0xb8)+_0x2b0eb7(0x164)+_0x2b0eb7(0x170)+_0x2b0eb7(0x142)+_0x280f8f[0x0][_0x2b0eb7(0x13b)]+'\x20</h2>'+'</div>'+'</div>'+_0x2b0eb7(0x184)+_0x2b0eb7(0x170)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2b0eb7(0x194)+_0x44a9e8['invoice']+'\x20'+_0x2b0eb7(0x124)+_0x2b0eb7(0x16c)+_0x44a9e8[_0x2b0eb7(0xe2)]+'\x20'+_0x2b0eb7(0xdf)+'</h5>'+_0x2b0eb7(0x164)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2b0eb7(0x112)+_0x2b0eb7(0x12d)+_0x2b0eb7(0xc1)+_0x2b0eb7(0x146)+_0x2b0eb7(0x108)+_0x2b0eb7(0x18d)+_0x2b0eb7(0x174)+_0x2b0eb7(0x128)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x2b0eb7(0x129)+_0x2b0eb7(0x192)+'</thead>'+_0x2b0eb7(0xb2)+'\x20'+_0x3470b2+'\x20'+_0x2b0eb7(0xba)+_0x2b0eb7(0x123)+_0x2b0eb7(0x170)+_0x2b0eb7(0x16a)+'<h5>'+_0x280f8f[0x0][_0x2b0eb7(0x13b)]+_0x2b0eb7(0x13c)+'</div>'+_0x2b0eb7(0x164)+_0x2b0eb7(0x148)};_0x1ed468[_0x2b0eb7(0x163)](_0x390415,function(_0x1cd7ef,_0x4dfaa7){var _0x17f276=_0x2b0eb7;_0x1cd7ef?(console[_0x17f276(0x173)](_0x1cd7ef),console['log'](_0x17f276(0x11a))):console[_0x17f276(0x173)](_0x17f276(0xc9));});}catch(_0x27c817){console['error'](_0x27c817),_0x14357e[_0x2b0eb7(0xed)](0x1f4)[_0x2b0eb7(0x1a9)]({'error':_0x2b0eb7(0x183),'message':_0x27c817[_0x2b0eb7(0x1a8)]});}})[_0x25ddf4(0x14e)](_0x4ef9a8=>{var _0x2e0f20=_0x25ddf4;console['error'](_0x4ef9a8),_0x14357e[_0x2e0f20(0xed)](0x1f4)[_0x2e0f20(0x1a9)]({'error':_0x2e0f20(0x175)});}),_0x39a6b0[_0x25ddf4(0xfb)](_0x25ddf4(0x17c),_0x25ddf4(0xc2)),_0x14357e[_0x25ddf4(0x145)](_0x25ddf4(0x118));}catch(_0x10b84f){console[_0x25ddf4(0x173)](_0x10b84f);}}),router[a0_0x41b9e4(0x191)]('/preview/:id',auth,async(_0x4a3bdc,_0x5e5067)=>{var _0x4b2f76=a0_0x41b9e4;try{const {username:_0x55b7b3,email:_0x663af4,role:_0x42412a}=_0x4a3bdc[_0x4b2f76(0x17e)],_0x3fbe98=_0x4a3bdc['user'],_0x410a26=await profile[_0x4b2f76(0xd1)]({'email':_0x3fbe98[_0x4b2f76(0xc6)]}),_0x310d9d=await master_shop[_0x4b2f76(0xf1)](),_0x601a3=_0x4a3bdc[_0x4b2f76(0xb0)]['id'],_0x716d6f=await purchases_finished['findById'](_0x601a3),_0x590175=await suppliers[_0x4b2f76(0xf1)]({});let _0x1594bf;if(_0x3fbe98['role']==_0x4b2f76(0x126)){const _0x7ed8d4=await staff[_0x4b2f76(0xd1)]({'email':_0x3fbe98[_0x4b2f76(0xc6)]});_0x1594bf=await warehouse[_0x4b2f76(0xf1)]({'status':_0x4b2f76(0xb6),'name':_0x7ed8d4['warehouse'],'warehouse_category':_0x4b2f76(0x18f)});}else _0x1594bf=await warehouse[_0x4b2f76(0xdd)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x1a820e=await product[_0x4b2f76(0xf1)]({}),_0x1fa856=BayBinSelected(_0x716d6f[_0x4b2f76(0xfa)],_0x716d6f[_0x4b2f76(0xd6)]);let _0x32cab4=new Date(_0x716d6f['expiry_date']),_0x5ad1a0=('0'+_0x32cab4[_0x4b2f76(0xe1)]())[_0x4b2f76(0x109)](-0x2),_0x42612d=('0'+(_0x32cab4[_0x4b2f76(0x12c)]()+0x1))['slice'](-0x2),_0x1d46f4=_0x32cab4['getFullYear'](),_0x54dfc7=_0x1d46f4+'-'+_0x42612d+'-'+_0x5ad1a0;if(_0x310d9d[0x0][_0x4b2f76(0x169)]==_0x4b2f76(0x150)){var _0x488a84=users[_0x4b2f76(0x15b)];console[_0x4b2f76(0x173)](_0x488a84);}else{if(_0x310d9d[0x0][_0x4b2f76(0x169)]==_0x4b2f76(0xb7))var _0x488a84=users[_0x4b2f76(0xb7)];else{if(_0x310d9d[0x0][_0x4b2f76(0x169)]==_0x4b2f76(0xcd))var _0x488a84=users[_0x4b2f76(0xcd)];else{if(_0x310d9d[0x0][_0x4b2f76(0x169)]==_0x4b2f76(0x14c))var _0x488a84=users['Spanish'];else{if(_0x310d9d[0x0][_0x4b2f76(0x169)]=='French')var _0x488a84=users[_0x4b2f76(0xe8)];else{if(_0x310d9d[0x0]['language']==_0x4b2f76(0x14b))var _0x488a84=users[_0x4b2f76(0x138)];else{if(_0x310d9d[0x0][_0x4b2f76(0x169)]==_0x4b2f76(0x104))var _0x488a84=users['Chinese'];else{if(_0x310d9d[0x0]['language']==_0x4b2f76(0x168))var _0x488a84=users[_0x4b2f76(0xf8)];}}}}}}}_0x5e5067[_0x4b2f76(0x177)](_0x4b2f76(0x135),{'success':_0x4a3bdc[_0x4b2f76(0xfb)]('success'),'errors':_0x4a3bdc[_0x4b2f76(0xfb)](_0x4b2f76(0x17d)),'role':_0x3fbe98,'profile':_0x410a26,'purchases':_0x716d6f,'suppliers':_0x590175,'warehouse':_0x1594bf,'product':_0x1a820e,'master_shop':_0x310d9d,'language':_0x488a84,'ed_fullDate':_0x54dfc7,'dataSelected':_0x1fa856});}catch(_0x32d49f){console[_0x4b2f76(0x173)](_0x32d49f);}}),router['get'](a0_0x41b9e4(0x1a2),auth,async(_0x19fa9a,_0x22be44)=>{var _0x2ea2b7=a0_0x41b9e4;try{const {username:_0x390231,email:_0xfce26b,role:_0x4db744}=_0x19fa9a[_0x2ea2b7(0x17e)],_0xb72526=_0x19fa9a[_0x2ea2b7(0x17e)],_0x4e39dc=await profile[_0x2ea2b7(0xd1)]({'email':_0xb72526['email']}),_0x1443a3=await master_shop[_0x2ea2b7(0xf1)](),_0x170f3d=_0x19fa9a[_0x2ea2b7(0xb0)]['id'],_0x3d1c85=await purchases_finished['findById'](_0x170f3d),_0x59aa9d=await suppliers[_0x2ea2b7(0xf1)]({});let _0x35e9b2;if(_0xb72526['role']=='staff'){const _0xc80660=await staff['findOne']({'email':_0xb72526[_0x2ea2b7(0xc6)]});_0x35e9b2=await warehouse[_0x2ea2b7(0xf1)]({'status':_0x2ea2b7(0xb6),'name':_0xc80660[_0x2ea2b7(0xff)],'warehouse_category':_0x2ea2b7(0x18f)});}else _0x35e9b2=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x2ea2b7(0x11c),'name':{'$first':_0x2ea2b7(0x11c)}}}]);const _0x304522=await product[_0x2ea2b7(0xf1)]({}),_0x1318d4=BayBinSelected(_0x3d1c85['warehouse_name'],_0x3d1c85[_0x2ea2b7(0xd6)]);let _0x57c161=new Date(_0x3d1c85[_0x2ea2b7(0x18e)]),_0x8b0239=('0'+_0x57c161[_0x2ea2b7(0xe1)]())[_0x2ea2b7(0x109)](-0x2),_0x271b7b=('0'+(_0x57c161[_0x2ea2b7(0x12c)]()+0x1))[_0x2ea2b7(0x109)](-0x2),_0x5822df=_0x57c161['getFullYear'](),_0x259e1b=_0x5822df+'-'+_0x271b7b+'-'+_0x8b0239;if(_0x1443a3[0x0][_0x2ea2b7(0x169)]==_0x2ea2b7(0x150)){var _0x3d4623=users['English'];console[_0x2ea2b7(0x173)](_0x3d4623);}else{if(_0x1443a3[0x0][_0x2ea2b7(0x169)]=='Hindi')var _0x3d4623=users['Hindi'];else{if(_0x1443a3[0x0][_0x2ea2b7(0x169)]==_0x2ea2b7(0xcd))var _0x3d4623=users[_0x2ea2b7(0xcd)];else{if(_0x1443a3[0x0][_0x2ea2b7(0x169)]=='Spanish')var _0x3d4623=users[_0x2ea2b7(0x14c)];else{if(_0x1443a3[0x0][_0x2ea2b7(0x169)]=='French')var _0x3d4623=users['French'];else{if(_0x1443a3[0x0][_0x2ea2b7(0x169)]==_0x2ea2b7(0x14b))var _0x3d4623=users[_0x2ea2b7(0x138)];else{if(_0x1443a3[0x0][_0x2ea2b7(0x169)]=='Chinese')var _0x3d4623=users[_0x2ea2b7(0x104)];else{if(_0x1443a3[0x0][_0x2ea2b7(0x169)]=='Arabic\x20(ae)')var _0x3d4623=users[_0x2ea2b7(0xf8)];}}}}}}}_0x22be44['render'](_0x2ea2b7(0x18c),{'success':_0x19fa9a['flash']('success'),'errors':_0x19fa9a[_0x2ea2b7(0xfb)](_0x2ea2b7(0x17d)),'role':_0xb72526,'profile':_0x4e39dc,'purchases':_0x3d1c85,'suppliers':_0x59aa9d,'warehouse':_0x35e9b2,'product':_0x304522,'master_shop':_0x1443a3,'language':_0x3d4623,'ed_fullDate':_0x259e1b,'dataSelected':_0x1318d4});}catch(_0x3d1aac){console[_0x2ea2b7(0x173)](_0x3d1aac);}}),router[a0_0x41b9e4(0x15c)]('/view/:id',auth,async(_0x2cfdb9,_0x35d973)=>{var _0x4ea97d=a0_0x41b9e4;try{const _0x1acd74=_0x2cfdb9['params']['id'],_0x34c3ad=await purchases_finished['findOne']({'_id':_0x2cfdb9['params']['id']}),_0xf510ef=await warehouse[_0x4ea97d(0xd1)]({'name':_0x34c3ad['warehouse_name'],'room':_0x34c3ad[_0x4ea97d(0xd6)]});_0x34c3ad['product'][_0x4ea97d(0x165)](_0x30aa18=>{const _0x119cf9=_0xf510ef['product_details']['map'](_0x3f0a82=>{var _0x5816dc=a0_0x3caa;_0x3f0a82['product_name']==_0x30aa18[_0x5816dc(0x17f)]&&_0x3f0a82[_0x5816dc(0x120)]==_0x30aa18[_0x5816dc(0x120)]&&(_0x3f0a82[_0x5816dc(0xe6)]=parseInt(_0x3f0a82[_0x5816dc(0xe6)])-parseInt(_0x30aa18[_0x5816dc(0x1ab)]));});}),await _0xf510ef[_0x4ea97d(0x166)]();const {invoice:_0xf6c71a,suppliers:_0x22a0e4,date:_0x4a8b3b,warehouse_name:_0x4cfe4,prod_name:_0x491628,prod_code:_0x41347a,prod_qty:_0x199d8d,prod_unit:_0x3df337,prod_secondunit:_0x18843a,prod_level:_0x2c8ebe,prod_isle:_0xd5a99d,prod_pallet:_0x5b73a1,note:_0x31849d,expiry_date:_0xb6e684,batch_code:_0x57d836,paid_amount:_0x583dbd,due_amount:_0x511221,Room_name:_0x2c53d8,primary_code:_0x146c2a,secondary_code:_0x21d93c,PO_number:_0x56f745,JO_number:_0x291bce}=_0x2cfdb9[_0x4ea97d(0x102)];if(typeof _0x491628=='string')var _0x4d8686=[_0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0xf4)]],_0x1a8f43=[_0x2cfdb9['body'][_0x4ea97d(0x107)]],_0xb626a9=[_0x2cfdb9[_0x4ea97d(0x102)]['prod_qty']],_0x47fe07=[_0x2cfdb9[_0x4ea97d(0x102)]['prod_unit']],_0x48e989=[_0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x133)]],_0x589f0d=[_0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x149)]],_0x211cef=[_0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x114)]],_0x1befce=[_0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0xb9)]],_0xdf4e94=[_0x2cfdb9['body'][_0x4ea97d(0x139)]],_0x493019=[_0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x185)]],_0x2e8533=[_0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x18e)]];else var _0x4d8686=[..._0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0xf4)]],_0x1a8f43=[..._0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x107)]],_0xb626a9=[..._0x2cfdb9['body'][_0x4ea97d(0xc4)]],_0x47fe07=[..._0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x152)]],_0x48e989=[..._0x2cfdb9['body'][_0x4ea97d(0x133)]],_0x589f0d=[..._0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x149)]],_0x211cef=[..._0x2cfdb9['body'][_0x4ea97d(0x114)]],_0x1befce=[..._0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0xb9)]],_0xdf4e94=[..._0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x139)]],_0x493019=[..._0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x185)]],_0x2e8533=[..._0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0x18e)]];const _0x2cbbef=_0x4d8686['map'](_0x2b3adf=>{return _0x2b3adf={'product_name':_0x2b3adf};});_0x1a8f43[_0x4ea97d(0x165)]((_0x46d698,_0xf4f965)=>{var _0x910d90=_0x4ea97d;_0x2cbbef[_0xf4f965][_0x910d90(0xfd)]=_0x46d698;}),_0xb626a9['forEach']((_0x1002ee,_0x2d00a4)=>{var _0x3115ac=_0x4ea97d;_0x2cbbef[_0x2d00a4][_0x3115ac(0x1ab)]=_0x1002ee;}),_0x47fe07[_0x4ea97d(0x165)]((_0x9cbdee,_0x411f6b)=>{_0x2cbbef[_0x411f6b]['standard_unit']=_0x9cbdee;}),_0x48e989[_0x4ea97d(0x165)]((_0x2b68e2,_0x1b2de0)=>{var _0x34cddf=_0x4ea97d;_0x2cbbef[_0x1b2de0][_0x34cddf(0xe7)]=_0x2b68e2;}),_0x589f0d[_0x4ea97d(0x165)]((_0x266421,_0x47a06f)=>{var _0x3e96b4=_0x4ea97d;_0x2cbbef[_0x47a06f][_0x3e96b4(0x120)]=_0x266421;}),_0x211cef['forEach']((_0x35c555,_0x5aab9c)=>{var _0x163cd0=_0x4ea97d;_0x2cbbef[_0x5aab9c][_0x163cd0(0x114)]=_0x35c555;}),_0x1befce[_0x4ea97d(0x165)]((_0x52c79a,_0xc88a11)=>{var _0xf051a2=_0x4ea97d;_0x2cbbef[_0xc88a11][_0xf051a2(0xb9)]=_0x52c79a;}),_0xdf4e94['forEach']((_0x281b12,_0x556546)=>{var _0x45f1a7=_0x4ea97d;_0x2cbbef[_0x556546][_0x45f1a7(0x125)]=_0x281b12;}),_0x493019[_0x4ea97d(0x165)]((_0x3d525e,_0x4ebd39)=>{var _0x4c5b71=_0x4ea97d;_0x2cbbef[_0x4ebd39][_0x4c5b71(0x185)]=_0x3d525e;}),_0x2e8533[_0x4ea97d(0x165)]((_0x1f15bf,_0x3c4664)=>{_0x2cbbef[_0x3c4664]['expiry_date']=_0x1f15bf;});const _0x2434e1=_0x2cbbef[_0x4ea97d(0x153)](_0x2d27bf=>_0x2d27bf[_0x4ea97d(0x1ab)]!=='0'&&_0x2d27bf[_0x4ea97d(0x1ab)]!=='');_0x34c3ad[_0x4ea97d(0x18b)]=_0xf6c71a,_0x34c3ad[_0x4ea97d(0x12a)]=_0x22a0e4,_0x34c3ad[_0x4ea97d(0xe2)]=_0x4a8b3b,_0x34c3ad[_0x4ea97d(0xfa)]=_0x4cfe4,_0x34c3ad[_0x4ea97d(0x10e)]=_0x2434e1,_0x34c3ad[_0x4ea97d(0x141)]=_0x31849d,_0x34c3ad['paid_amount']=_0x583dbd,_0x34c3ad[_0x4ea97d(0xbc)]=_0x511221,_0x34c3ad[_0x4ea97d(0xd6)]=_0x2c53d8,_0x34c3ad[_0x4ea97d(0xfc)]=_0x56f745,_0x34c3ad[_0x4ea97d(0x113)]=_0x291bce;const _0x389719=await _0x34c3ad[_0x4ea97d(0x166)](),_0x207de2=await warehouse[_0x4ea97d(0xd1)]({'name':_0x2cfdb9[_0x4ea97d(0x102)][_0x4ea97d(0xfa)],'room':_0x2cfdb9[_0x4ea97d(0x102)]['Room_name']});_0x34c3ad[_0x4ea97d(0x10e)][_0x4ea97d(0x165)](_0x435ad1=>{var _0x2a2f84=_0x4ea97d,_0x2450a8=0x0;const _0x154c29=_0x207de2['product_details'][_0x2a2f84(0xcf)](_0x48e9d3=>{var _0x398661=_0x2a2f84;_0x48e9d3['product_name']==_0x435ad1[_0x398661(0x17f)]&&_0x48e9d3['bay']==_0x435ad1[_0x398661(0x120)]&&(_0x48e9d3[_0x398661(0xe6)]=parseInt(_0x48e9d3['product_stock'])+parseInt(_0x435ad1[_0x398661(0x1ab)]),_0x2450a8++);});_0x2450a8=='0'&&(_0x207de2['product_details']=_0x207de2[_0x2a2f84(0xf6)][_0x2a2f84(0x187)]({'product_name':_0x435ad1[_0x2a2f84(0x17f)],'product_stock':_0x435ad1[_0x2a2f84(0x1ab)],'primary_code':_0x435ad1[_0x2a2f84(0x114)],'secondary_code':_0x435ad1[_0x2a2f84(0xb9)],'product_code':_0x435ad1[_0x2a2f84(0xfd)],'bay':_0x435ad1[_0x2a2f84(0x120)],'maxProducts':_0x435ad1[_0x2a2f84(0x125)],'unit':_0x435ad1[_0x2a2f84(0xd5)],'secondary_unit':_0x435ad1[_0x2a2f84(0xe7)],'expiry_date':_0x435ad1[_0x2a2f84(0x18e)]}));}),await _0x207de2[_0x4ea97d(0x166)]();const _0x370382=await s_payment_data[_0x4ea97d(0xd1)]({'invoice':_0x2cfdb9['body'][_0x4ea97d(0x18b)]});if(_0x370382===null){}else console[_0x4ea97d(0x173)](_0x4ea97d(0x12a),_0x370382,_0x2cfdb9['body'][_0x4ea97d(0x18b)]),_0x370382[_0x4ea97d(0x12a)]=_0x2cfdb9['body'][_0x4ea97d(0x12a)],await _0x370382[_0x4ea97d(0x166)]();_0x2cfdb9['flash']('success',_0x4ea97d(0xd2)),_0x35d973[_0x4ea97d(0x145)](_0x4ea97d(0x118));}catch(_0xb9e4e2){console[_0x4ea97d(0x173)](_0xb9e4e2);}}),router[a0_0x41b9e4(0x15c)](a0_0x41b9e4(0x143),auth,async(_0x4ac60c,_0x1c58f0)=>{var _0x56897d=a0_0x41b9e4;try{const _0x4899eb=_0x4ac60c['params']['id'],{invoice:_0x12f12e,suppliers:_0x37deec,payable:_0x5a622e,due_amount:_0x4bc83a}=_0x4ac60c['body'],_0x37c4b3=await purchases[_0x56897d(0x17a)](_0x4899eb);var _0x2e3fac=_0x5a622e-_0x4bc83a;_0x37c4b3[_0x56897d(0x101)]=parseFloat(_0x37c4b3[_0x56897d(0x101)])+parseFloat(_0x4bc83a),_0x37c4b3[_0x56897d(0xbc)]=_0x2e3fac;const _0x2ef58e=await _0x37c4b3['save']();console[_0x56897d(0x173)](_0x2ef58e);const _0x45d064=await s_payment_data[_0x56897d(0xd1)]({'invoice':_0x12f12e});_0x45d064[_0x56897d(0x15e)]=_0x2e3fac,await _0x45d064[_0x56897d(0x166)]();let _0x4e288c=new Date(),_0x45a913=('0'+_0x4e288c[_0x56897d(0xe1)]())[_0x56897d(0x109)](-0x2),_0x33f32e=('0'+(_0x4e288c['getMonth']()+0x1))[_0x56897d(0x109)](-0x2),_0x5574f0=_0x4e288c[_0x56897d(0xc8)](),_0x959ca3=_0x5574f0+'-'+_0x33f32e+'-'+_0x45a913;const _0x193e57=new suppliers_payment({'invoice':_0x12f12e,'date':_0x5574f0+'-'+_0x33f32e+'-'+_0x45a913,'suppliers':_0x37deec,'reason':_0x56897d(0x178),'amount':_0x4bc83a}),_0x1ae8af=await _0x193e57[_0x56897d(0x166)]();_0x4ac60c['flash'](_0x56897d(0x17c),_0x56897d(0x160)),_0x1c58f0[_0x56897d(0x145)](_0x56897d(0x180));}catch(_0x22ef69){console[_0x56897d(0x173)](_0x22ef69);}}),router[a0_0x41b9e4(0x191)](a0_0x41b9e4(0xd7),auth,async(_0x3fb868,_0x10803f)=>{var _0x46b96a=a0_0x41b9e4;try{const {username:_0x9d5c3f,email:_0x3933e7,role:_0x1c0cbe}=_0x3fb868['user'],_0x937655=_0x3fb868[_0x46b96a(0x17e)],_0x46bfe9=await profile[_0x46b96a(0xd1)]({'email':_0x937655['email']}),_0x4baf4f=await master_shop['find']();console['log']('master',_0x4baf4f);const _0x5f1300=_0x3fb868[_0x46b96a(0xb0)]['id'],_0x4bda8c=await purchases[_0x46b96a(0x17a)](_0x5f1300);console[_0x46b96a(0x173)](_0x4bda8c);const _0x102422=await suppliers[_0x46b96a(0xd1)]({'name':_0x4bda8c[_0x46b96a(0x12a)]});console[_0x46b96a(0x173)](_0x102422);if(_0x4baf4f[0x0][_0x46b96a(0x169)]==_0x46b96a(0x150)){var _0x3bbe85=users['English'];console[_0x46b96a(0x173)](_0x3bbe85);}else{if(_0x4baf4f[0x0][_0x46b96a(0x169)]=='Hindi')var _0x3bbe85=users['Hindi'];else{if(_0x4baf4f[0x0][_0x46b96a(0x169)]==_0x46b96a(0xcd))var _0x3bbe85=users[_0x46b96a(0xcd)];else{if(_0x4baf4f[0x0][_0x46b96a(0x169)]==_0x46b96a(0x14c))var _0x3bbe85=users['Spanish'];else{if(_0x4baf4f[0x0][_0x46b96a(0x169)]==_0x46b96a(0xe8))var _0x3bbe85=users['French'];else{if(_0x4baf4f[0x0][_0x46b96a(0x169)]==_0x46b96a(0x14b))var _0x3bbe85=users['Portuguese'];else{if(_0x4baf4f[0x0][_0x46b96a(0x169)]==_0x46b96a(0x104))var _0x3bbe85=users[_0x46b96a(0x104)];else{if(_0x4baf4f[0x0]['language']==_0x46b96a(0x168))var _0x3bbe85=users['Arabic'];}}}}}}}_0x10803f[_0x46b96a(0x177)](_0x46b96a(0xac),{'success':_0x3fb868[_0x46b96a(0xfb)]('success'),'errors':_0x3fb868[_0x46b96a(0xfb)]('errors'),'role':_0x937655,'profile':_0x46bfe9,'master_shop':_0x4baf4f,'supplier':_0x102422,'purchase':_0x4bda8c,'language':_0x3bbe85});}catch(_0x96d685){console[_0x46b96a(0x173)](_0x96d685);}}),router[a0_0x41b9e4(0x191)](a0_0x41b9e4(0xf2),auth,async(_0xa98ab3,_0x3f83f7)=>{var _0xf576aa=a0_0x41b9e4;try{const {username:_0x1498c1,email:_0x386831,role:_0x4d9238}=_0xa98ab3[_0xf576aa(0x17e)],_0x41b206=_0xa98ab3[_0xf576aa(0x17e)],_0x172478=await profile[_0xf576aa(0xd1)]({'email':_0x41b206[_0xf576aa(0xc6)]}),_0x4bd833=await master_shop['find']();console[_0xf576aa(0x173)](_0xf576aa(0x100),_0x4bd833);const _0x3a5dae=_0xa98ab3[_0xf576aa(0xb0)]['id'];console[_0xf576aa(0x173)](_0x3a5dae);const _0x492de0=await purchases_finished['findById'](_0x3a5dae);console[_0xf576aa(0x173)](_0xf576aa(0x1a4),_0x492de0);const _0x4ac289=await product[_0xf576aa(0xf1)]({}),_0x4454f1=await warehouse['aggregate']([{'$match':{'name':_0x492de0[_0xf576aa(0xfa)],'room':_0x492de0[_0xf576aa(0xd6)]}},{'$unwind':_0xf576aa(0x137)},{'$group':{'_id':_0xf576aa(0xfe),'name':{'$first':_0xf576aa(0xda)},'product_stock':{'$first':_0xf576aa(0x19f)},'bay':{'$first':_0xf576aa(0x19c)},'bin':{'$first':_0xf576aa(0x1a1)},'type':{'$first':_0xf576aa(0xc7)},'floorlevel':{'$first':_0xf576aa(0x155)},'primary_code':{'$first':_0xf576aa(0x134)},'secondary_code':{'$first':_0xf576aa(0xb1)},'product_code':{'$first':_0xf576aa(0x11b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xf576aa(0xf7)}}}]);console[_0xf576aa(0x173)]('stock_data',_0x4454f1);let _0xaa58de;if(_0x41b206[_0xf576aa(0xd8)]==_0xf576aa(0x126)){const _0x1bbceb=await staff[_0xf576aa(0xd1)]({'email':_0x41b206[_0xf576aa(0xc6)]});_0xaa58de=await warehouse[_0xf576aa(0xf1)]({'status':_0xf576aa(0xb6),'name':_0x1bbceb[_0xf576aa(0xff)],'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'});}else _0xaa58de=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0xf576aa(0x18f),'name':_0xf576aa(0x111)}},{'$group':{'_id':'$name','name':{'$first':_0xf576aa(0x11c)}}}]);if(_0x4bd833[0x0][_0xf576aa(0x169)]==_0xf576aa(0x150)){var _0x125dbe=users['English'];console['log'](_0x125dbe);}else{if(_0x4bd833[0x0]['language']==_0xf576aa(0xb7))var _0x125dbe=users[_0xf576aa(0xb7)];else{if(_0x4bd833[0x0][_0xf576aa(0x169)]==_0xf576aa(0xcd))var _0x125dbe=users[_0xf576aa(0xcd)];else{if(_0x4bd833[0x0][_0xf576aa(0x169)]==_0xf576aa(0x14c))var _0x125dbe=users[_0xf576aa(0x14c)];else{if(_0x4bd833[0x0][_0xf576aa(0x169)]==_0xf576aa(0xe8))var _0x125dbe=users[_0xf576aa(0xe8)];else{if(_0x4bd833[0x0][_0xf576aa(0x169)]==_0xf576aa(0x14b))var _0x125dbe=users[_0xf576aa(0x138)];else{if(_0x4bd833[0x0]['language']==_0xf576aa(0x104))var _0x125dbe=users[_0xf576aa(0x104)];else{if(_0x4bd833[0x0][_0xf576aa(0x169)]==_0xf576aa(0x168))var _0x125dbe=users[_0xf576aa(0xf8)];}}}}}}}_0x3f83f7[_0xf576aa(0x177)](_0xf576aa(0x14f),{'success':_0xa98ab3['flash']('success'),'errors':_0xa98ab3[_0xf576aa(0xfb)](_0xf576aa(0x17d)),'role':_0x41b206,'profile':_0x172478,'user':_0x492de0,'stock':_0x4454f1,'master_shop':_0x4bd833,'product':_0x4ac289,'language':_0x125dbe,'warehouse':_0xaa58de});}catch(_0x1f56e3){console[_0xf576aa(0x173)](_0x1f56e3);}}),router['post'](a0_0x41b9e4(0xf2),auth,async(_0x570e86,_0x590d7b)=>{var _0x50556c=a0_0x41b9e4;try{const {invoice:_0x244055,date:_0x10b04a,warehouse_name:_0x167ffa,Room_name:_0x4429cf,product_name:_0x152986,purchase_quantity:_0x2c9773,stocks:_0x16cc61,return_qty:_0x297336,note:_0x23218b,level:_0x417e03,isle:_0x2a163f,pallet:_0x515128,to_warehouse_name:_0x2613bb,to_Room_name:_0x236faa}=_0x570e86[_0x50556c(0x102)],_0x191201=await purchases_finished[_0x50556c(0xd1)]({'_id':_0x570e86[_0x50556c(0xb0)]['id']}),_0x3ff046=await warehouse[_0x50556c(0xd1)]({'name':_0x167ffa,'room':_0x4429cf,'warehouse_category':_0x50556c(0x18f)});if(typeof _0x152986==_0x50556c(0x105))var _0x2fa1b3=[_0x570e86['body'][_0x50556c(0x17f)]],_0x337f0d=[_0x570e86[_0x50556c(0x102)]['purchase_quantity']],_0x2a9bb1=[_0x570e86[_0x50556c(0x102)][_0x50556c(0xbf)]],_0x2a3370=[_0x570e86['body']['return_qty']],_0x2c43a1=[_0x570e86[_0x50556c(0x102)][_0x50556c(0xc0)]],_0x3d0a6c=[_0x570e86['body'][_0x50556c(0x15a)]],_0x28f391=[_0x570e86[_0x50556c(0x102)][_0x50556c(0x130)]],_0xff5d02=[_0x570e86[_0x50556c(0x102)][_0x50556c(0xec)]];else var _0x2fa1b3=[..._0x570e86[_0x50556c(0x102)]['product_name']],_0x337f0d=[..._0x570e86[_0x50556c(0x102)][_0x50556c(0x15d)]],_0x2a9bb1=[..._0x570e86['body'][_0x50556c(0xbf)]],_0x2a3370=[..._0x570e86[_0x50556c(0x102)]['return_qty']],_0x2c43a1=[..._0x570e86[_0x50556c(0x102)][_0x50556c(0xc0)]],_0x3d0a6c=[..._0x570e86[_0x50556c(0x102)][_0x50556c(0x15a)]],_0x28f391=[..._0x570e86[_0x50556c(0x102)][_0x50556c(0x130)]],_0xff5d02=[..._0x570e86[_0x50556c(0x102)]['secondary_code_hide']];const _0x225bbe=_0x2fa1b3[_0x50556c(0xcf)](_0x24bab4=>{return _0x24bab4={'product_name':_0x24bab4};});_0x337f0d['forEach']((_0x340fb9,_0x1c792c)=>{_0x225bbe[_0x1c792c]['purchase_quantity']=_0x340fb9;}),_0x2a9bb1['forEach']((_0x5624c6,_0x29df32)=>{var _0x39cf9f=_0x50556c;_0x225bbe[_0x29df32][_0x39cf9f(0xe0)]=_0x5624c6;}),_0x2a3370[_0x50556c(0x165)]((_0x51c457,_0x308f79)=>{var _0x5ba6ec=_0x50556c;_0x225bbe[_0x308f79][_0x5ba6ec(0x154)]=_0x51c457;}),_0x2c43a1[_0x50556c(0x165)]((_0x25dd95,_0x166594)=>{var _0x300397=_0x50556c;_0x225bbe[_0x166594][_0x300397(0x120)]=_0x25dd95;}),_0x3d0a6c[_0x50556c(0x165)]((_0x34f4c1,_0x4edac7)=>{var _0x183338=_0x50556c;_0x225bbe[_0x4edac7][_0x183338(0xfd)]=_0x34f4c1;}),_0x28f391['forEach']((_0xeffeff,_0x281ff1)=>{var _0xa2c81e=_0x50556c;_0x225bbe[_0x281ff1][_0xa2c81e(0x114)]=_0xeffeff;}),_0xff5d02['forEach']((_0x2367ed,_0x2976b2)=>{var _0x2c1772=_0x50556c;_0x225bbe[_0x2976b2][_0x2c1772(0xb9)]=_0x2367ed;}),_0x225bbe[_0x50556c(0x165)](_0x2423a0=>{var _0x33cf4c=_0x50556c;console[_0x33cf4c(0x173)](_0x2423a0);const _0x608ed1=_0x3ff046[_0x33cf4c(0xf6)]['map'](_0x539f32=>{var _0x832a78=_0x33cf4c;_0x539f32[_0x832a78(0x17f)]==_0x2423a0['product_name']&&_0x539f32['bay']==_0x2423a0[_0x832a78(0x120)]&&(console[_0x832a78(0x173)](parseInt(_0x539f32[_0x832a78(0xe6)])+_0x832a78(0xee)+parseInt(_0x2423a0[_0x832a78(0x154)])),_0x539f32[_0x832a78(0xe6)]=parseInt(_0x539f32[_0x832a78(0xe6)])-parseInt(_0x2423a0['return_qty']));});}),await _0x3ff046[_0x50556c(0x166)]();var _0x46d10d=0x0;_0x225bbe[_0x50556c(0x165)](_0x152f07=>{var _0x938dc9=_0x50556c;(parseInt(_0x152f07[_0x938dc9(0x15d)])<parseInt(_0x152f07['return_qty'])||parseInt(_0x152f07[_0x938dc9(0xe0)])<parseInt(_0x152f07[_0x938dc9(0x154)]))&&_0x46d10d++;});if(_0x46d10d!=0x0)return _0x570e86[_0x50556c(0xfb)](_0x50556c(0x17d),_0x50556c(0x196)),_0x590d7b[_0x50556c(0x145)]('back');const _0x5d69e2=new purchases_return_finished({'invoice':_0x244055,'suppliers':_0x570e86[_0x50556c(0x102)][_0x50556c(0x12a)],'date':_0x10b04a,'warehouse_name':_0x167ffa,'return_product':_0x225bbe,'note':_0x23218b,'room':_0x4429cf,'to_warehouse_name':_0x2613bb,'to_room':_0x236faa}),_0x13d995=await _0x5d69e2['save'](),_0x2c41e7=await purchases_return_finished['findOne']({'invoice':_0x244055}),_0x5917c5=await warehouse['findOne']({'name':_0x2613bb,'room':_0x236faa,'warehouse_category':_0x50556c(0x18f)});_0x2c41e7['return_product'][_0x50556c(0x165)](_0x67c1c6=>{var _0x56b5c6=_0x50556c,_0x16eb7b=0x0;const _0x46fb75=_0x5917c5[_0x56b5c6(0xf6)][_0x56b5c6(0xcf)](_0x3f7ec8=>{var _0x3d8381=_0x56b5c6;console['log'](_0x3f7ec8[_0x3d8381(0x17f)]+'=='+_0x67c1c6[_0x3d8381(0x17f)]+'&&'+_0x3f7ec8['bay']+'=='+_0x67c1c6[_0x3d8381(0x120)]),_0x3f7ec8[_0x3d8381(0x17f)]==_0x67c1c6[_0x3d8381(0x17f)]&&_0x3f7ec8[_0x3d8381(0x120)]==_0x67c1c6[_0x3d8381(0x120)]&&(_0x3f7ec8[_0x3d8381(0xe6)]=parseInt(_0x3f7ec8[_0x3d8381(0xe6)])-parseInt(_0x67c1c6[_0x3d8381(0x154)]),_0x16eb7b++);});_0x16eb7b=='0'&&(_0x5917c5[_0x56b5c6(0xf6)]=_0x5917c5[_0x56b5c6(0xf6)][_0x56b5c6(0x187)]({'product_name':_0x67c1c6[_0x56b5c6(0x17f)],'product_stock':_0x67c1c6[_0x56b5c6(0x154)],'primary_code':_0x67c1c6[_0x56b5c6(0x114)],'secondary_code':_0x67c1c6['secondary_code'],'product_code':_0x67c1c6[_0x56b5c6(0xfd)],'bay':_0x67c1c6['bay'],'maxProducts':0xf423f}));}),await _0x5917c5[_0x50556c(0x166)]();const _0x3b710a=await purchases_finished[_0x50556c(0xd1)]({'invoice':_0x244055});_0x3b710a[_0x50556c(0xf5)]='True';const _0x40fd2f=await _0x3b710a[_0x50556c(0x166)](),_0x57cfec=new s_payment_data({'invoice':_0x244055,'suppliers':_0x570e86['body'][_0x50556c(0x12a)],'reason':_0x50556c(0x136)});await _0x57cfec[_0x50556c(0x166)]();const _0x452ae2=await master_shop[_0x50556c(0xf1)](),_0x2b17b8=await email_settings[_0x50556c(0xd1)](),_0x5849b3=await suppliers[_0x50556c(0xd1)]({'name':_0x570e86[_0x50556c(0x102)][_0x50556c(0x12a)]});_0x452ae2[0x0][_0x50556c(0xce)]==0x1?(right_currency=_0x452ae2[0x0][_0x50556c(0xef)],left_currency=''):(right_currency='',left_currency=_0x452ae2[0x0][_0x50556c(0xef)]);var _0x224f8f=_0x2fa1b3,_0x1d21f6=_0x2a3370,_0x5452f1='',_0x5619e4;for(_0x5619e4 in _0x224f8f){_0x5452f1+=_0x50556c(0x12d)+_0x50556c(0x16d)+_0x224f8f[_0x5619e4]+_0x50556c(0x197)+_0x50556c(0x16d)+_0x1d21f6[_0x5619e4]+_0x50556c(0x197)+_0x50556c(0x192);}let _0x302611=nodemailer[_0x50556c(0x17b)]({'service':_0x50556c(0x10b),'auth':{'user':_0x2b17b8[_0x50556c(0xc6)],'pass':_0x2b17b8['password']}}),_0x1c85e2={'from':_0x2b17b8['email'],'to':_0x5849b3['email'],'subject':_0x50556c(0xd9),'attachments':[{'filename':_0x50556c(0x161),'path':__dirname+'/../public'+_0x50556c(0x11e)+_0x452ae2[0x0][_0x50556c(0xd0)],'cid':_0x50556c(0x12b)}],'html':_0x50556c(0x171)+'<html><head><title></title>'+_0x50556c(0x12e)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x50556c(0xb8)+'</div>'+_0x50556c(0x170)+_0x50556c(0x142)+_0x452ae2[0x0]['site_title']+_0x50556c(0x19a)+'</div>'+_0x50556c(0x164)+_0x50556c(0x184)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x50556c(0x194)+_0x244055+'\x20'+_0x50556c(0x124)+_0x50556c(0x16c)+_0x10b04a+'\x20'+_0x50556c(0xdf)+_0x50556c(0x13c)+_0x50556c(0x164)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x50556c(0x12d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x50556c(0x172)+_0x50556c(0x192)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5452f1+'\x20'+_0x50556c(0xba)+_0x50556c(0x123)+'<div>'+_0x50556c(0x16a)+_0x50556c(0x156)+_0x452ae2[0x0][_0x50556c(0x13b)]+_0x50556c(0x13c)+_0x50556c(0x164)+'</div>'+_0x50556c(0x148)};_0x302611['sendMail'](_0x1c85e2,function(_0x4d5631,_0x3bfc2a){var _0x2119d5=_0x50556c;_0x4d5631?console[_0x2119d5(0x173)](_0x2119d5(0x11a)):console[_0x2119d5(0x173)]('Email\x20sent\x20successfully');}),_0x570e86[_0x50556c(0xfb)](_0x50556c(0x17c),'purchases\x20item\x20return\x20successfull'),_0x590d7b['redirect'](_0x50556c(0x118));}catch(_0x5283bf){_0x590d7b[_0x50556c(0xed)](0xc8)[_0x50556c(0x1a9)]({'message':_0x5283bf[_0x50556c(0x1a8)]});}}),router['get'](a0_0x41b9e4(0x14a),auth,async(_0x3fc488,_0x2588d6)=>{var _0x350b80=a0_0x41b9e4;try{const {username:_0x339d6b,email:_0x379b00,role:_0x389ce2}=_0x3fc488['user'],_0x50511a=_0x3fc488[_0x350b80(0x17e)],_0x103096=await profile['findOne']({'email':_0x50511a[_0x350b80(0xc6)]}),_0x293144=await master_shop[_0x350b80(0xf1)](),_0x5906d4=_0x3fc488[_0x350b80(0xb0)]['id'],_0x1118ba=await purchases_finished[_0x350b80(0x17a)](_0x5906d4);if(_0x293144[0x0]['language']==_0x350b80(0x150))var _0x122eb7=users[_0x350b80(0x15b)];else{if(_0x293144[0x0][_0x350b80(0x169)]==_0x350b80(0xb7))var _0x122eb7=users[_0x350b80(0xb7)];else{if(_0x293144[0x0]['language']==_0x350b80(0xcd))var _0x122eb7=users[_0x350b80(0xcd)];else{if(_0x293144[0x0][_0x350b80(0x169)]==_0x350b80(0x14c))var _0x122eb7=users['Spanish'];else{if(_0x293144[0x0][_0x350b80(0x169)]==_0x350b80(0xe8))var _0x122eb7=users['French'];else{if(_0x293144[0x0][_0x350b80(0x169)]==_0x350b80(0x14b))var _0x122eb7=users['Portuguese'];else{if(_0x293144[0x0]['language']==_0x350b80(0x104))var _0x122eb7=users[_0x350b80(0x104)];else{if(_0x293144[0x0]['language']=='Arabic\x20(ae)')var _0x122eb7=users['Arabic'];}}}}}}}_0x2588d6['render']('all_purchases_barcode',{'success':_0x3fc488[_0x350b80(0xfb)](_0x350b80(0x17c)),'errors':_0x3fc488[_0x350b80(0xfb)](_0x350b80(0x17d)),'role':_0x50511a,'profile':_0x103096,'alldata':_0x1118ba,'master_shop':_0x293144,'language':_0x122eb7}),console[_0x350b80(0x173)](alldata);}catch(_0xc9928){console['log'](_0xc9928);}}),router['post']('/barcode_scanner',async(_0x3cc72a,_0xfc99fc)=>{var _0x61ac57=a0_0x41b9e4;const {product_code:_0x265a93}=_0x3cc72a[_0x61ac57(0x102)];var _0x4d7281;const _0x37cab8=await product[_0x61ac57(0xdd)]([{'$match':{'primary_code':_0x265a93,'product_category':_0x61ac57(0x18f)}},{'$group':{'_id':_0x61ac57(0x13d),'name':{'$first':'$name'},'category':{'$first':_0x61ac57(0x157)},'brand':{'$first':_0x61ac57(0x181)},'unit':{'$first':_0x61ac57(0x13e)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x61ac57(0x13a)},'secondary_code':{'$first':_0x61ac57(0xe5)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x61ac57(0x190)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x61ac57(0x182)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5d1d5a=await product[_0x61ac57(0xdd)]([{'$match':{'secondary_code':_0x265a93}},{'$group':{'_id':_0x61ac57(0x13d),'name':{'$first':_0x61ac57(0x11c)},'category':{'$first':_0x61ac57(0x157)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x61ac57(0x198)},'product_code':{'$first':_0x61ac57(0x10d)},'primary_code':{'$first':_0x61ac57(0x13a)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x61ac57(0x1a0)},'maxProdPerUnit':{'$first':_0x61ac57(0x190)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x61ac57(0x182)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x37cab8[_0x61ac57(0x10f)]>0x0)_0x4d7281=_0x37cab8;else _0x5d1d5a[_0x61ac57(0x10f)]>0x0&&(_0x4d7281=_0x5d1d5a);_0xfc99fc[_0x61ac57(0x1a9)](_0x4d7281);}),router[a0_0x41b9e4(0x15c)]('/CheckingWarehouse',async(_0x4dcdad,_0xc48442)=>{var _0x45be62=a0_0x41b9e4;const {productCode:_0x26680e,bay:_0x1b170d,warehouses:_0x399d2a,room:_0x285f85}=_0x4dcdad[_0x45be62(0x102)];console[_0x45be62(0x173)](_0x4dcdad[_0x45be62(0x102)]);try{const _0x16f91a=await warehouse[_0x45be62(0xdd)]([{'$match':{'name':_0x399d2a,'room':_0x285f85}},{'$unwind':_0x45be62(0x137)},{'$match':{'product_details.bay':parseInt(_0x1b170d)}},{'$group':{'_id':_0x45be62(0xfe),'name':{'$first':_0x45be62(0xda)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x45be62(0x19c)},'maxProducts':{'$first':_0x45be62(0xea)}}}]);_0xc48442[_0x45be62(0xed)](0xc8)['json'](_0x16f91a);}catch(_0x4cd432){_0xc48442['status'](0x194)[_0x45be62(0x1a9)]({'message':_0x4cd432[_0x45be62(0x1a8)]});}}),module['exports']=router;