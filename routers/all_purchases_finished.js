var a0_0x725126=a0_0x1674;(function(_0x11d65e,_0x1263fc){var _0x150cf4=a0_0x1674,_0x533213=_0x11d65e();while(!![]){try{var _0x2f75ff=parseInt(_0x150cf4(0x28b))/0x1+-parseInt(_0x150cf4(0x1f1))/0x2+-parseInt(_0x150cf4(0x24b))/0x3*(-parseInt(_0x150cf4(0x244))/0x4)+-parseInt(_0x150cf4(0x2bd))/0x5+parseInt(_0x150cf4(0x1eb))/0x6+parseInt(_0x150cf4(0x2c9))/0x7*(parseInt(_0x150cf4(0x1fb))/0x8)+-parseInt(_0x150cf4(0x240))/0x9*(parseInt(_0x150cf4(0x26b))/0xa);if(_0x2f75ff===_0x1263fc)break;else _0x533213['push'](_0x533213['shift']());}catch(_0x401ed1){_0x533213['push'](_0x533213['shift']());}}}(a0_0x3c51,0xcf3bd));const express=require(a0_0x725126(0x24e)),app=express(),router=express[a0_0x725126(0x229)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x725126(0x2c1)),nodemailer=require(a0_0x725126(0x2a7));var ejs=require('ejs');const path=require(a0_0x725126(0x261)),users=require(a0_0x725126(0x2c7));router[a0_0x725126(0x21d)](a0_0x725126(0x27a),auth,async(_0x5cbf71,_0x1cd897)=>{var _0x3d6ef8=a0_0x725126;try{const {username:_0xfb4a9f,email:_0x404e98,role:_0x518fe3}=_0x5cbf71[_0x3d6ef8(0x294)],_0x56e6e4=_0x5cbf71[_0x3d6ef8(0x294)],_0x495850=await profile[_0x3d6ef8(0x287)]({'email':_0x56e6e4[_0x3d6ef8(0x2b9)]}),_0x50fe10=await staff[_0x3d6ef8(0x287)]({'email':_0x56e6e4[_0x3d6ef8(0x2b9)]});if(_0x56e6e4[_0x3d6ef8(0x1f5)]==_0x3d6ef8(0x27c)){const _0x2f6afd=await staff[_0x3d6ef8(0x287)]({'email':_0x56e6e4['email']});}const _0x4e7f0b=await master_shop[_0x3d6ef8(0x1d9)]();let _0x3f8385;if(_0x56e6e4[_0x3d6ef8(0x1f5)]==_0x3d6ef8(0x27c)){const _0x502382=await staff['findOne']({'email':_0x56e6e4[_0x3d6ef8(0x2b9)]});_0x3f8385=await purchases_finished[_0x3d6ef8(0x2af)]([{'$match':{'warehouse_name':_0x502382[_0x3d6ef8(0x207)]}},{'$lookup':{'from':'suppliers','localField':_0x3d6ef8(0x25d),'foreignField':_0x3d6ef8(0x279),'as':_0x3d6ef8(0x200)}},{'$unwind':_0x3d6ef8(0x1ec)},{'$unwind':_0x3d6ef8(0x1d8)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3d6ef8(0x262)},'suppliers':{'$first':_0x3d6ef8(0x2a6)},'date':{'$first':_0x3d6ef8(0x1fd)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3d6ef8(0x2b7)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3d6ef8(0x20d)},'batch_code':{'$first':_0x3d6ef8(0x2c3)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x3d6ef8(0x1ec)},'total_product_quantity':{'$sum':_0x3d6ef8(0x215)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x3d6ef8(0x226)},'type':{'$addToSet':_0x3d6ef8(0x25e)},'floorlevel':{'$addToSet':_0x3d6ef8(0x2b4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3f8385=await purchases_finished['aggregate']([{'$unwind':_0x3d6ef8(0x1d8)},{'$group':{'_id':_0x3d6ef8(0x235),'invoice':{'$first':_0x3d6ef8(0x262)},'suppliers':{'$first':_0x3d6ef8(0x2a6)},'date':{'$first':_0x3d6ef8(0x1fd)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x3d6ef8(0x1d8)},'note':{'$first':_0x3d6ef8(0x1e6)},'paid_amount':{'$first':_0x3d6ef8(0x2b7)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3d6ef8(0x20d)},'batch_code':{'$first':_0x3d6ef8(0x2c3)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x3d6ef8(0x1ec)},'total_product_quantity':{'$sum':_0x3d6ef8(0x215)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x3d6ef8(0x2b4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x4e7f0b[0x0][_0x3d6ef8(0x299)]==_0x3d6ef8(0x29b))var _0x10a60e=users['English'];else{if(_0x4e7f0b[0x0][_0x3d6ef8(0x299)]=='Hindi')var _0x10a60e=users['Hindi'];else{if(_0x4e7f0b[0x0]['language']=='German')var _0x10a60e=users[_0x3d6ef8(0x23f)];else{if(_0x4e7f0b[0x0][_0x3d6ef8(0x299)]==_0x3d6ef8(0x282))var _0x10a60e=users[_0x3d6ef8(0x282)];else{if(_0x4e7f0b[0x0][_0x3d6ef8(0x299)]==_0x3d6ef8(0x201))var _0x10a60e=users[_0x3d6ef8(0x201)];else{if(_0x4e7f0b[0x0][_0x3d6ef8(0x299)]=='Portuguese\x20(BR)')var _0x10a60e=users['Portuguese'];else{if(_0x4e7f0b[0x0][_0x3d6ef8(0x299)]==_0x3d6ef8(0x1f4))var _0x10a60e=users[_0x3d6ef8(0x1f4)];else{if(_0x4e7f0b[0x0]['language']==_0x3d6ef8(0x28d))var _0x10a60e=users[_0x3d6ef8(0x297)];}}}}}}}_0x1cd897[_0x3d6ef8(0x254)](_0x3d6ef8(0x255),{'success':_0x5cbf71[_0x3d6ef8(0x263)](_0x3d6ef8(0x274)),'errors':_0x5cbf71[_0x3d6ef8(0x263)](_0x3d6ef8(0x26f)),'purchases':_0x3f8385,'role':_0x56e6e4,'profile':_0x495850,'master_shop':_0x4e7f0b,'language':_0x10a60e});}catch(_0x43e62e){console[_0x3d6ef8(0x288)](_0x3d6ef8(0x276),_0x43e62e),_0x1cd897[_0x3d6ef8(0x1e9)](0xc8)[_0x3d6ef8(0x293)]({'message':_0x43e62e[_0x3d6ef8(0x253)]});}});function a0_0x3c51(){var _0x111182=['</h5>','Ambient','$product_code','1586225flKdeN','$alertquantity','/give_payment/:id','Error\x20occurred\x20while\x20processing\x20product:','../middleware/auth','$unit','$batch_code','image','prod_secondunit','<!DOCTYPE\x20html>','../public/language/languages.json','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','531678MpTrqm','\x20</h2>','INCF-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</tr>','$product','find','maxperunit','/preview/:id','<strong>\x20Regards\x20</strong>','<tr>','product_date','return_qty','exports','product_code','date','amount','</tbody>','prod_cat','$note','expiry_date','Purchase\x20Mail','status','RoomAssign','7454952uCBnSn','$suppliers_docs','$product_details.storage','getMonth','bay','product_name','1327022oneZdO','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Chinese','role','batch_code','save','paid_amount','<tbody\x20style=\x22text-align:\x20center;\x22>','Enclosed','8NVaEff','<hr\x20class=\x22my-3\x22>','$date','Return\x20Goods','map','suppliers_docs','French','$maxProdPerUnit','purchase_invoice','product','Purchase\x20Return','secondary_unit','warehouse','maxStocks','createTransport','purchase\x20data\x20update\x20successfully','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/all_purchases_finished/view','$return_data','redirect','purchase_quantity','Finished\x20Goods','max_product_unit','/invoice/:id','DRY\x20GOODS','$primary_code','$product.quantity','return_product','$product_details.product_name','gmail','$product_details','payment\x20successfull','Hindi','level','get','\x20Order\x20Date\x20:\x20','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','add_purchases\x20error','quantity','currency','Rack\x201','filter','params','$product.bin','then','return_data','Router','invoice','product_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','An\x20error\x20occurred\x20while\x20saving\x20data.','/CheckingWarehouse','$maxStocks','prod_invoice','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$_id','prod_level','POnumber','abs','site_title','$secondary_unit','/view/add_purchases','<h2>\x20','<html><head><title></title>','$product_details.product_stock','German','36sjetDC','</body></html>','/barcode/:id','$product_details.product_code','84pNkqgc','body','/../public','error','</td>','slice','<div>','214251GHSICq','Portuguese','$category','express','prod_primunit','floor','/view/:id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','message','render','all_purchases_finished','</head><body>','/upload/','Error\x20Occurs','<h5\x20style=\x22text-align:\x20left;\x22>','product_cat','<h5>','stock_quantity','suppliers','$product.type','$brand','$product_details.maxProducts','path','$invoice','flash','catch','forEach','QA\x20Warehouse','$name','<span\x20style=\x22float:\x20right;\x22>','purchases\x20item\x20return\x20successfull','padStart','3372890WEeWiw','master','Rack\x202','$product_details.rack','errors','Room_name','post','$product_details.secondary_code','primary_code_hide','success','True','table\x20page','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','add_purchases_finished','name','/view','Portuguese\x20(BR)','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','password','edit_purchases_finished','findById','Enabled','Spanish','prod_name','edit_purchases_finished_view','warehouse_name','$product_details.bin','findOne','log','</table>','length','360538rmbdxM','primary_code','Arabic\x20(ae)','There\x27s\x20a\x20error\x20in\x20this\x20transaction','product_details','prod_code','$product_details.type','/view/return_purchase/:id','json','user','sendMail','getDate','Arabic','string','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','English\x20(US)','FROZEN\x20GOODS','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','</span>','host','Email\x20sent\x20successfully','</thead>','prod_Qty','room','standard_unit','secondary_code_hide','$suppliers','nodemailer','getFullYear','random','product_stock','note','$product_details._id','English','toString','aggregate','room_name','stocks','</div>','MaxStocks_data','$product.floorlevel','production_date','port','$paid_amount','secondary_code','email'];a0_0x3c51=function(){return _0x111182;};return a0_0x3c51();}function BayBinSelected(_0x18fc50,_0x21b486){var _0x1fb92b=a0_0x725126,_0x2d69a8=[],_0x523712=[];if(_0x18fc50==_0x1fb92b(0x213)){switch(_0x21b486){case _0x1fb92b(0x223):_0x2d69a8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1fb92b(0x26d):_0x2d69a8=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x523712=['DG'];}else{if(_0x18fc50==_0x1fb92b(0x29c)){switch(_0x21b486){case _0x1fb92b(0x223):_0x2d69a8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x2d69a8=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x523712=['FG'];}}return{'levels':_0x2d69a8,'identify':_0x523712};}function a0_0x1674(_0x8a4155,_0x569560){var _0x3c51b0=a0_0x3c51();return a0_0x1674=function(_0x1674a3,_0x126f4c){_0x1674a3=_0x1674a3-0x1d8;var _0xa20138=_0x3c51b0[_0x1674a3];return _0xa20138;},a0_0x1674(_0x8a4155,_0x569560);}async function getRandom8DigitNumber(){var _0x5b1607=a0_0x725126;const _0x98ef27=0x989680,_0x115867=0x5f5e0ff,_0xfb693b=Math[_0x5b1607(0x250)](Math[_0x5b1607(0x2a9)]()*(_0x115867-_0x98ef27+0x1))+_0x98ef27;var _0x3e90af;const _0x356a60=await purchases_finished[_0x5b1607(0x287)]({'invoice':'INCF-'+_0xfb693b});return _0x356a60&&_0x356a60[_0x5b1607(0x28a)]>0x0?_0x3e90af='INCF-'+_0xfb693b:_0x3e90af='INCF-'+_0xfb693b,_0x3e90af;}router[a0_0x725126(0x21d)](a0_0x725126(0x23b),auth,async(_0xf0c66,_0x32c2d4)=>{var _0x4d1e0a=a0_0x725126;try{const {username:_0x26e3f2,email:_0x3d8566,role:_0x55a315}=_0xf0c66[_0x4d1e0a(0x294)],_0x36f223=_0xf0c66[_0x4d1e0a(0x294)],_0x22312e=await profile[_0x4d1e0a(0x287)]({'email':_0x36f223[_0x4d1e0a(0x2b9)]}),_0x4bba6e=await master_shop['find'](),_0x21ad1d=await staff[_0x4d1e0a(0x287)]({'email':_0x36f223[_0x4d1e0a(0x2b9)]}),_0x18065c=await suppliers[_0x4d1e0a(0x1d9)]({});let _0x581ec6;if(_0x36f223[_0x4d1e0a(0x1f5)]==_0x4d1e0a(0x27c)){const _0x12e80a=await staff[_0x4d1e0a(0x287)]({'email':_0x36f223[_0x4d1e0a(0x2b9)]});_0x581ec6=await warehouse['aggregate']([{'$match':{'status':_0x4d1e0a(0x281),'name':_0x12e80a['warehouse'],'warehouse_category':_0x4d1e0a(0x210)}},{'$group':{'_id':_0x4d1e0a(0x267),'name':{'$first':_0x4d1e0a(0x267)}}}]);}else _0x581ec6=await warehouse['aggregate']([{'$match':{'status':_0x4d1e0a(0x281),'warehouse_category':_0x4d1e0a(0x210),'name':{'$ne':_0x4d1e0a(0x266)}}},{'$group':{'_id':_0x4d1e0a(0x267),'name':{'$first':_0x4d1e0a(0x267)}}}]);const _0x34dd63=await product[_0x4d1e0a(0x1d9)]({}),_0x3958b8=await warehouse[_0x4d1e0a(0x1d9)]({'status':_0x4d1e0a(0x281)}),_0xfa9487=await purchases_finished['find']({}),_0x9110=_0xfa9487['length']+0x1,_0x22f244=_0x4d1e0a(0x2cb)+_0x9110[_0x4d1e0a(0x2ae)]()[_0x4d1e0a(0x26a)](0x5,'0');var _0x17f63b=[_0x4d1e0a(0x2bb),_0x4d1e0a(0x1fa)];if(_0x4bba6e[0x0][_0x4d1e0a(0x299)]==_0x4d1e0a(0x29b))var _0x219411=users[_0x4d1e0a(0x2ad)];else{if(_0x4bba6e[0x0][_0x4d1e0a(0x299)]==_0x4d1e0a(0x21b))var _0x219411=users['Hindi'];else{if(_0x4bba6e[0x0][_0x4d1e0a(0x299)]==_0x4d1e0a(0x23f))var _0x219411=users[_0x4d1e0a(0x23f)];else{if(_0x4bba6e[0x0]['language']=='Spanish')var _0x219411=users[_0x4d1e0a(0x282)];else{if(_0x4bba6e[0x0]['language']=='French')var _0x219411=users[_0x4d1e0a(0x201)];else{if(_0x4bba6e[0x0]['language']==_0x4d1e0a(0x27b))var _0x219411=users[_0x4d1e0a(0x24c)];else{if(_0x4bba6e[0x0][_0x4d1e0a(0x299)]==_0x4d1e0a(0x1f4))var _0x219411=users[_0x4d1e0a(0x1f4)];else{if(_0x4bba6e[0x0][_0x4d1e0a(0x299)]=='Arabic\x20(ae)')var _0x219411=users['Arabic'];}}}}}}}const _0x251589=getRandom8DigitNumber();_0x251589[_0x4d1e0a(0x227)](_0x3a00ce=>{var _0x2c6b63=_0x4d1e0a;_0x32c2d4['render'](_0x2c6b63(0x278),{'success':_0xf0c66[_0x2c6b63(0x263)]('success'),'errors':_0xf0c66['flash'](_0x2c6b63(0x26f)),'role':_0x36f223,'profile':_0x22312e,'suppliers':_0x18065c,'warehouse':_0x581ec6,'product':_0x34dd63,'invoice':_0x3a00ce,'master_shop':_0x4bba6e,'language':_0x219411,'find_data':_0x3958b8,'rooms_data':_0x17f63b});})['catch'](_0x3d0941=>{var _0x5a2fc5=_0x4d1e0a;_0xf0c66[_0x5a2fc5(0x263)]('errors',_0x5a2fc5(0x28e)),_0x32c2d4[_0x5a2fc5(0x20e)](_0x5a2fc5(0x20c));});}catch(_0x3023e2){console['log'](_0x3023e2);}}),router[a0_0x725126(0x21d)]('/view/add_purchases/:id',auth,async(_0x4c2d26,_0x3823c6)=>{var _0x5009b2=a0_0x725126;try{const _0x1dbf42=_0x4c2d26['params']['id'];console[_0x5009b2(0x288)](_0x1dbf42);const _0x378b15=await master_shop[_0x5009b2(0x1d9)]();console['log'](_0x5009b2(0x26c),_0x378b15);const _0x157392=await product[_0x5009b2(0x287)]({'name':_0x1dbf42});console[_0x5009b2(0x288)](_0x5009b2(0x204),_0x157392),_0x3823c6[_0x5009b2(0x1e9)](0xc8)['json']({'product_data':_0x157392,'master':_0x378b15});}catch(_0x21e3bd){console['log'](_0x5009b2(0x220),_0x21e3bd);}}),router['post'](a0_0x725126(0x23b),auth,async(_0x51fbe3,_0x4c3651)=>{var _0x2638cc=a0_0x725126;try{const {invoice:_0x27e157,date:_0x5d56bd,warehouse_name:_0x11d021,prod_name:_0x28618c,prod_code:_0x2cce64,prod_qty:_0xa9ab01,prod_unit:_0x157792,prod_secondunit:_0x142f61,prod_level:_0x3ad494,prod_isle:_0x68468b,prod_pallet:_0x38235e,note:_0x396ea9,expiry_date:_0x25d0e1,batch_code:_0x2ab53a,payable:_0x311f44,due_amount:_0x3b106d,Room_name:_0x4d4c2e,primary_code:_0x34ea3a,secondary_code:_0x101289,MaxStocks_data:_0x44d982,PO_number:_0x57721d,SCRN:_0x180b16,JO_number:_0x4b170e}=_0x51fbe3[_0x2638cc(0x245)];if(typeof _0x28618c==_0x2638cc(0x298))var _0x303d82=[_0x51fbe3['body'][_0x2638cc(0x283)]],_0x33f90b=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x290)]],_0x1f6700=[_0x51fbe3[_0x2638cc(0x245)]['prod_Qty']],_0x3b29be=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x24f)]],_0x3ec5be=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x2c5)]],_0x2a8703=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x236)]],_0xc8fa3a=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x28c)]],_0x2196e3=[_0x51fbe3[_0x2638cc(0x245)]['secondary_code']],_0x44cda9=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x2b3)]],_0xdcd216=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x1f6)]],_0x178a34=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x1e7)]],_0x428c3c=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x1de)]],_0x3400ab=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x211)]],_0x46abc=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x1e5)]],_0x5129d7=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x1ea)]],_0x3e3e0c=[_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x232)]];else var _0x303d82=[..._0x51fbe3[_0x2638cc(0x245)]['prod_name']],_0x33f90b=[..._0x51fbe3[_0x2638cc(0x245)]['prod_code']],_0x1f6700=[..._0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x2a2)]],_0x3b29be=[..._0x51fbe3['body'][_0x2638cc(0x24f)]],_0x3ec5be=[..._0x51fbe3[_0x2638cc(0x245)]['prod_secondunit']],_0x2a8703=[..._0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x236)]],_0xc8fa3a=[..._0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x28c)]],_0x2196e3=[..._0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x2b8)]],_0x44cda9=[..._0x51fbe3[_0x2638cc(0x245)]['MaxStocks_data']],_0xdcd216=[..._0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x1f6)]],_0x178a34=[..._0x51fbe3['body'][_0x2638cc(0x1e7)]],_0x428c3c=[..._0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x1de)]],_0x3400ab=[..._0x51fbe3[_0x2638cc(0x245)]['max_product_unit']],_0x46abc=[..._0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x1e5)]],_0x5129d7=[..._0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x1ea)]],_0x3e3e0c=[..._0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x232)]];const _0x3009bf=_0x303d82[_0x2638cc(0x1ff)](_0x4aeb45=>{return _0x4aeb45={'product_name':_0x4aeb45};});_0x33f90b[_0x2638cc(0x265)]((_0x576507,_0x5a6fc6)=>{var _0x2a40ad=_0x2638cc;_0x3009bf[_0x5a6fc6][_0x2a40ad(0x1e1)]=_0x576507;}),_0x1f6700[_0x2638cc(0x265)]((_0x48de0c,_0x2d1455)=>{var _0x530199=_0x2638cc;_0x3009bf[_0x2d1455][_0x530199(0x221)]=Math[_0x530199(0x238)](_0x48de0c);}),_0x3b29be[_0x2638cc(0x265)]((_0x34aea5,_0x186943)=>{var _0x1f558c=_0x2638cc;_0x3009bf[_0x186943][_0x1f558c(0x2a4)]=_0x34aea5;}),_0x3ec5be[_0x2638cc(0x265)]((_0x46ade2,_0xf2acf9)=>{var _0xed9d71=_0x2638cc;_0x3009bf[_0xf2acf9][_0xed9d71(0x206)]=_0x46ade2;}),_0x2a8703[_0x2638cc(0x265)]((_0xa08632,_0x20cff2)=>{var _0x143daa=_0x2638cc;_0x3009bf[_0x20cff2][_0x143daa(0x1ef)]=_0xa08632;}),_0xc8fa3a['forEach']((_0x4493d8,_0xfaa2c)=>{_0x3009bf[_0xfaa2c]['primary_code']=_0x4493d8;}),_0x2196e3[_0x2638cc(0x265)]((_0x2a0325,_0x335d35)=>{_0x3009bf[_0x335d35]['secondary_code']=_0x2a0325;}),_0x44cda9[_0x2638cc(0x265)]((_0x27fe7f,_0x34db28)=>{var _0x28df73=_0x2638cc;_0x3009bf[_0x34db28][_0x28df73(0x208)]=_0x27fe7f;}),_0xdcd216['forEach']((_0x5095ca,_0x31881f)=>{_0x3009bf[_0x31881f]['batch_code']=_0x5095ca;}),_0x178a34['forEach']((_0x247b5e,_0x569711)=>{_0x3009bf[_0x569711]['expiry_date']=_0x247b5e;}),_0x428c3c[_0x2638cc(0x265)]((_0x5c3338,_0x461698)=>{var _0x46ecdb=_0x2638cc;_0x3009bf[_0x461698][_0x46ecdb(0x2b5)]=_0x5c3338;}),_0x3400ab[_0x2638cc(0x265)]((_0x1ce15d,_0x2f53cc)=>{var _0x5ab25d=_0x2638cc;_0x3009bf[_0x2f53cc][_0x5ab25d(0x1da)]=_0x1ce15d;}),_0x46abc['forEach']((_0x4464a,_0x3ac63c)=>{var _0x1ab607=_0x2638cc;_0x3009bf[_0x3ac63c][_0x1ab607(0x25a)]=_0x4464a;}),_0x5129d7['forEach']((_0x26c5d9,_0x5047c2)=>{var _0x9d3987=_0x2638cc;_0x3009bf[_0x5047c2][_0x9d3987(0x2b0)]=_0x26c5d9;}),_0x3e3e0c['forEach']((_0x5b5448,_0x308e9a)=>{var _0x29acc5=_0x2638cc;_0x3009bf[_0x308e9a][_0x29acc5(0x22a)]=_0x5b5448;});const _0x44909f=_0x3009bf[_0x2638cc(0x224)](_0x861bc2=>_0x861bc2['quantity']!=='0'&&_0x861bc2[_0x2638cc(0x221)]!==''),_0x42ef11=new purchases_finished({'invoice':_0x27e157,'suppliers':_0x51fbe3[_0x2638cc(0x245)][_0x2638cc(0x25d)],'date':_0x5d56bd,'warehouse_name':_0x11d021,'product':_0x44909f,'note':_0x396ea9,'due_amount':_0x3b106d,'room':_0x4d4c2e,'POnumber':_0x57721d,'SCRN':_0x180b16,'JO_number':_0x4b170e}),_0xe5136=await _0x42ef11[_0x2638cc(0x1f7)](),_0x3061ac=await purchases_finished[_0x2638cc(0x287)]({'invoice':_0x27e157}),_0x455b57=_0x3061ac[_0x2638cc(0x204)][_0x2638cc(0x1ff)](async _0x304644=>{var _0x51754b=_0x2638cc;try{var _0x2f8a33=await warehouse[_0x51754b(0x287)]({'name':_0x11d021,'room':_0x304644[_0x51754b(0x2b0)]}),_0x45cf46=0x0;const _0x4a9644=_0x2f8a33[_0x51754b(0x28f)]['map'](_0x5b6557=>{var _0x5510b4=_0x51754b;console[_0x5510b4(0x288)](_0x5b6557[_0x5510b4(0x1f0)]+'=='+_0x304644[_0x5510b4(0x1f0)]+'&&'+_0x5b6557[_0x5510b4(0x1ef)]+'=='+_0x304644[_0x5510b4(0x1ef)]+'&&'+_0x5b6557[_0x5510b4(0x1e7)]+'=='+_0x304644['expiry_date']+'&&'+_0x5b6557[_0x5510b4(0x2b5)]+'=='+_0x304644[_0x5510b4(0x2b5)]+'&&'+_0x5b6557[_0x5510b4(0x1f6)]+'=='+_0x304644['batch_code']+'&&'+_0x5b6557[_0x5510b4(0x22a)]+'=='+_0x3061ac[_0x5510b4(0x22a)]),_0x5b6557[_0x5510b4(0x1f0)]==_0x304644[_0x5510b4(0x1f0)]&&_0x5b6557['bay']==_0x304644[_0x5510b4(0x1ef)]&&_0x5b6557[_0x5510b4(0x1e7)]==_0x304644['expiry_date']&&_0x5b6557[_0x5510b4(0x2b5)]==_0x304644[_0x5510b4(0x2b5)]&&_0x5b6557[_0x5510b4(0x1f6)]==_0x304644[_0x5510b4(0x1f6)]&&_0x5b6557[_0x5510b4(0x22a)]==_0x3061ac[_0x5510b4(0x22a)]&&(_0x5b6557[_0x5510b4(0x2aa)]=Math[_0x5510b4(0x238)](_0x5b6557[_0x5510b4(0x2aa)])+Math[_0x5510b4(0x238)](_0x304644[_0x5510b4(0x221)]),_0x45cf46++);});return _0x45cf46==0x0&&(_0x2f8a33[_0x51754b(0x28f)]=_0x2f8a33[_0x51754b(0x28f)][_0x51754b(0x233)]({'product_name':_0x304644[_0x51754b(0x1f0)],'product_stock':Math[_0x51754b(0x238)](_0x304644['quantity']),'primary_code':_0x304644[_0x51754b(0x28c)],'secondary_code':_0x304644[_0x51754b(0x2b8)],'product_code':_0x304644[_0x51754b(0x1e1)],'bay':_0x304644[_0x51754b(0x1ef)],'maxProducts':_0x304644[_0x51754b(0x208)],'unit':_0x304644['standard_unit'],'secondary_unit':_0x304644[_0x51754b(0x206)],'expiry_date':_0x304644[_0x51754b(0x1e7)],'production_date':_0x304644[_0x51754b(0x2b5)],'maxProducts':_0x304644['maxStocks'],'maxPerUnit':_0x304644[_0x51754b(0x1da)],'batch_code':_0x304644[_0x51754b(0x1f6)],'product_cat':_0x304644['product_cat'],'invoice':_0x304644[_0x51754b(0x22a)],'id_incoming':_0x304644['_id']})),_0x2f8a33;}catch(_0x3964a6){return console[_0x51754b(0x247)](_0x51754b(0x2c0),_0x3964a6),null;}});Promise['all'](_0x455b57)['then'](async _0x51c31e=>{var _0x40bf64=_0x2638cc;try{for(const _0x2f1d97 of _0x51c31e){await warehouse['updateOne']({'_id':_0x2f1d97['_id']},{'$addToSet':{'product_details':{'$each':_0x2f1d97[_0x40bf64(0x28f)]}}});}const _0x40730f=await master_shop[_0x40bf64(0x1d9)](),_0x233e82=await email_settings[_0x40bf64(0x287)](),_0x38d9a5=await supervisor_settings[_0x40bf64(0x1d9)]();var _0x576d87=_0x3061ac['product'],_0x474f09='',_0x39ecb1;for(_0x39ecb1 in _0x576d87){var _0x580c11='FG';_0x3061ac[_0x40bf64(0x285)]==_0x40bf64(0x213)&&(_0x580c11='DG'),_0x474f09+=_0x40bf64(0x1dd)+_0x40bf64(0x2cd)+_0x576d87[_0x39ecb1][_0x40bf64(0x1f0)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x576d87[_0x39ecb1][_0x40bf64(0x1e1)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x576d87[_0x39ecb1][_0x40bf64(0x221)]+_0x40bf64(0x248)+_0x40bf64(0x2cd)+_0x576d87[_0x39ecb1]['standard_unit']+_0x40bf64(0x248)+_0x40bf64(0x2cd)+_0x576d87[_0x39ecb1]['secondary_unit']+'</td>'+_0x40bf64(0x2cd)+_0x3061ac[_0x40bf64(0x285)]+_0x40bf64(0x248)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x576d87[_0x39ecb1][_0x40bf64(0x2b0)]+_0x40bf64(0x248)+_0x40bf64(0x2cd)+_0x580c11+_0x576d87[_0x39ecb1][_0x40bf64(0x1ef)]+_0x40bf64(0x248),_0x40bf64(0x2ce);}let _0x2ad0fd=nodemailer[_0x40bf64(0x209)]({'host':_0x233e82[_0x40bf64(0x29f)],'port':Number(_0x233e82[_0x40bf64(0x2b6)]),'secure':![],'auth':{'user':_0x233e82[_0x40bf64(0x2b9)],'pass':_0x233e82['password']}}),_0x3d16c7={'from':_0x233e82[_0x40bf64(0x2b9)],'to':_0x38d9a5[0x0]['FGSEmail'],'subject':_0x40bf64(0x1e8),'attachments':[{'filename':_0x40bf64(0x1f2),'path':__dirname+_0x40bf64(0x246)+_0x40bf64(0x257)+_0x40730f[0x0][_0x40bf64(0x2c4)],'cid':'logo'}],'html':_0x40bf64(0x2c6)+_0x40bf64(0x23d)+_0x40bf64(0x256)+'<div>'+_0x40bf64(0x2c8)+_0x40bf64(0x24a)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x40bf64(0x2b2)+_0x40bf64(0x24a)+_0x40bf64(0x23c)+_0x40730f[0x0]['site_title']+_0x40bf64(0x2ca)+'</div>'+_0x40bf64(0x2b2)+_0x40bf64(0x1fc)+_0x40bf64(0x24a)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x3061ac['invoice']+'\x20'+_0x40bf64(0x268)+'\x20Order\x20Date\x20:\x20'+_0x3061ac[_0x40bf64(0x1e2)]+'\x20'+_0x40bf64(0x29e)+'</h5>'+_0x40bf64(0x2b2)+_0x40bf64(0x252)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x40bf64(0x22d)+_0x40bf64(0x1f3)+_0x40bf64(0x2cc)+_0x40bf64(0x29a)+_0x40bf64(0x234)+_0x40bf64(0x277)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x40bf64(0x29d)+_0x40bf64(0x2ce)+'</thead>'+_0x40bf64(0x1f9)+'\x20'+_0x474f09+'\x20'+_0x40bf64(0x1e4)+'</table>'+_0x40bf64(0x24a)+'<strong>\x20Regards\x20</strong>'+_0x40bf64(0x25b)+_0x40730f[0x0][_0x40bf64(0x239)]+_0x40bf64(0x2ba)+_0x40bf64(0x2b2)+_0x40bf64(0x2b2)+_0x40bf64(0x241)};_0x2ad0fd['sendMail'](_0x3d16c7,function(_0x432c5e,_0xde4e3d){var _0x2fb67f=_0x40bf64;_0x432c5e?(console[_0x2fb67f(0x288)](_0x432c5e),console[_0x2fb67f(0x288)](_0x2fb67f(0x258))):console[_0x2fb67f(0x288)](_0x2fb67f(0x2a0));});}catch(_0x5535ae){console['error'](_0x5535ae),_0x4c3651['status'](0x1f4)[_0x40bf64(0x293)]({'error':_0x40bf64(0x22f),'message':_0x5535ae[_0x40bf64(0x253)]});}})[_0x2638cc(0x264)](_0x254a45=>{var _0xc824ec=_0x2638cc;console[_0xc824ec(0x247)](_0x254a45);}),_0x51fbe3[_0x2638cc(0x263)](_0x2638cc(0x274),'purchase\x20data\x20add\x20successfully'),_0x4c3651[_0x2638cc(0x20e)](_0x2638cc(0x20c));}catch(_0x584bd6){console[_0x2638cc(0x288)](_0x584bd6);}}),router[a0_0x725126(0x21d)](a0_0x725126(0x1db),auth,async(_0x101b0f,_0x43ffb2)=>{var _0x1e9468=a0_0x725126;try{const {username:_0x1921cd,email:_0x5bd871,role:_0x14c906}=_0x101b0f[_0x1e9468(0x294)],_0x26a3a8=_0x101b0f['user'],_0x2f183d=await profile[_0x1e9468(0x287)]({'email':_0x26a3a8[_0x1e9468(0x2b9)]}),_0x3e01ac=await master_shop['find'](),_0x27bc0c=_0x101b0f[_0x1e9468(0x225)]['id'],_0x366852=await purchases_finished['findById'](_0x27bc0c),_0x2b2638=await suppliers['find']({});let _0x110a5a;if(_0x26a3a8['role']==_0x1e9468(0x27c)){const _0x3580a1=await staff[_0x1e9468(0x287)]({'email':_0x26a3a8['email']});_0x110a5a=await warehouse[_0x1e9468(0x1d9)]({'status':_0x1e9468(0x281),'name':_0x3580a1[_0x1e9468(0x207)],'warehouse_category':_0x1e9468(0x210)});}else _0x110a5a=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x1e9468(0x267),'name':{'$first':'$name'}}}]);const _0x4a18c3=await product[_0x1e9468(0x1d9)]({}),_0x56618e=BayBinSelected(_0x366852[_0x1e9468(0x285)],_0x366852['room']);let _0x4d26f1=new Date(_0x366852[_0x1e9468(0x1e7)]),_0x458ce6=('0'+_0x4d26f1[_0x1e9468(0x296)]())[_0x1e9468(0x249)](-0x2),_0x4a6a78=('0'+(_0x4d26f1['getMonth']()+0x1))[_0x1e9468(0x249)](-0x2),_0x48da58=_0x4d26f1[_0x1e9468(0x2a8)](),_0x335d05=_0x48da58+'-'+_0x4a6a78+'-'+_0x458ce6;if(_0x3e01ac[0x0][_0x1e9468(0x299)]==_0x1e9468(0x29b)){var _0x37775e=users[_0x1e9468(0x2ad)];console['log'](_0x37775e);}else{if(_0x3e01ac[0x0][_0x1e9468(0x299)]=='Hindi')var _0x37775e=users[_0x1e9468(0x21b)];else{if(_0x3e01ac[0x0][_0x1e9468(0x299)]=='German')var _0x37775e=users[_0x1e9468(0x23f)];else{if(_0x3e01ac[0x0][_0x1e9468(0x299)]==_0x1e9468(0x282))var _0x37775e=users[_0x1e9468(0x282)];else{if(_0x3e01ac[0x0][_0x1e9468(0x299)]==_0x1e9468(0x201))var _0x37775e=users[_0x1e9468(0x201)];else{if(_0x3e01ac[0x0][_0x1e9468(0x299)]==_0x1e9468(0x27b))var _0x37775e=users['Portuguese'];else{if(_0x3e01ac[0x0][_0x1e9468(0x299)]==_0x1e9468(0x1f4))var _0x37775e=users[_0x1e9468(0x1f4)];else{if(_0x3e01ac[0x0][_0x1e9468(0x299)]==_0x1e9468(0x28d))var _0x37775e=users['Arabic'];}}}}}}}_0x43ffb2[_0x1e9468(0x254)](_0x1e9468(0x284),{'success':_0x101b0f['flash'](_0x1e9468(0x274)),'errors':_0x101b0f[_0x1e9468(0x263)]('errors'),'role':_0x26a3a8,'profile':_0x2f183d,'purchases':_0x366852,'suppliers':_0x2b2638,'warehouse':_0x110a5a,'product':_0x4a18c3,'master_shop':_0x3e01ac,'language':_0x37775e,'ed_fullDate':_0x335d05,'dataSelected':_0x56618e});}catch(_0x1284b8){console[_0x1e9468(0x288)](_0x1284b8);}}),router[a0_0x725126(0x21d)](a0_0x725126(0x251),auth,async(_0xa097cf,_0x1133f0)=>{var _0x3f9204=a0_0x725126;try{const {username:_0x16de44,email:_0x22065c,role:_0x882969}=_0xa097cf[_0x3f9204(0x294)],_0xf3bd2f=_0xa097cf[_0x3f9204(0x294)],_0xb3a607=await profile[_0x3f9204(0x287)]({'email':_0xf3bd2f[_0x3f9204(0x2b9)]}),_0x4aee2e=await master_shop[_0x3f9204(0x1d9)](),_0x20511d=_0xa097cf[_0x3f9204(0x225)]['id'],_0x15aef4=await purchases_finished[_0x3f9204(0x280)](_0x20511d),_0x341c3f=await suppliers[_0x3f9204(0x1d9)]({});let _0x38c583;if(_0xf3bd2f[_0x3f9204(0x1f5)]==_0x3f9204(0x27c)){const _0x4cc5cf=await staff[_0x3f9204(0x287)]({'email':_0xf3bd2f['email']});_0x38c583=await warehouse[_0x3f9204(0x1d9)]({'status':_0x3f9204(0x281),'name':_0x4cc5cf[_0x3f9204(0x207)],'warehouse_category':'Finished\x20Goods'});}else _0x38c583=await warehouse[_0x3f9204(0x2af)]([{'$match':{'status':_0x3f9204(0x281),'warehouse_category':_0x3f9204(0x210)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x181975=await product[_0x3f9204(0x1d9)]({}),_0x264ad=BayBinSelected(_0x15aef4[_0x3f9204(0x285)],_0x15aef4[_0x3f9204(0x2a3)]);let _0x2eab08=new Date(_0x15aef4[_0x3f9204(0x1e7)]),_0xc11447=('0'+_0x2eab08[_0x3f9204(0x296)]())[_0x3f9204(0x249)](-0x2),_0x5a20dd=('0'+(_0x2eab08[_0x3f9204(0x1ee)]()+0x1))[_0x3f9204(0x249)](-0x2),_0x58bdae=_0x2eab08[_0x3f9204(0x2a8)](),_0x356fb4=_0x58bdae+'-'+_0x5a20dd+'-'+_0xc11447;if(_0x4aee2e[0x0][_0x3f9204(0x299)]=='English\x20(US)'){var _0x4168d9=users[_0x3f9204(0x2ad)];console[_0x3f9204(0x288)](_0x4168d9);}else{if(_0x4aee2e[0x0][_0x3f9204(0x299)]==_0x3f9204(0x21b))var _0x4168d9=users[_0x3f9204(0x21b)];else{if(_0x4aee2e[0x0][_0x3f9204(0x299)]==_0x3f9204(0x23f))var _0x4168d9=users['German'];else{if(_0x4aee2e[0x0]['language']=='Spanish')var _0x4168d9=users[_0x3f9204(0x282)];else{if(_0x4aee2e[0x0][_0x3f9204(0x299)]==_0x3f9204(0x201))var _0x4168d9=users[_0x3f9204(0x201)];else{if(_0x4aee2e[0x0][_0x3f9204(0x299)]=='Portuguese\x20(BR)')var _0x4168d9=users[_0x3f9204(0x24c)];else{if(_0x4aee2e[0x0][_0x3f9204(0x299)]==_0x3f9204(0x1f4))var _0x4168d9=users['Chinese'];else{if(_0x4aee2e[0x0][_0x3f9204(0x299)]==_0x3f9204(0x28d))var _0x4168d9=users[_0x3f9204(0x297)];}}}}}}}_0x1133f0[_0x3f9204(0x254)](_0x3f9204(0x27f),{'success':_0xa097cf[_0x3f9204(0x263)](_0x3f9204(0x274)),'errors':_0xa097cf[_0x3f9204(0x263)]('errors'),'role':_0xf3bd2f,'profile':_0xb3a607,'purchases':_0x15aef4,'suppliers':_0x341c3f,'warehouse':_0x38c583,'product':_0x181975,'master_shop':_0x4aee2e,'language':_0x4168d9,'ed_fullDate':_0x356fb4,'dataSelected':_0x264ad});}catch(_0x3c9e6e){console[_0x3f9204(0x288)](_0x3c9e6e);}}),router[a0_0x725126(0x271)](a0_0x725126(0x251),auth,async(_0x3020b6,_0x1ef535)=>{var _0x20e87b=a0_0x725126;try{const _0x4094a4=_0x3020b6[_0x20e87b(0x225)]['id'],_0x2af3c3=await purchases_finished[_0x20e87b(0x287)]({'_id':_0x3020b6[_0x20e87b(0x225)]['id']}),_0x14c061=await warehouse[_0x20e87b(0x287)]({'name':_0x2af3c3['warehouse_name'],'room':_0x2af3c3[_0x20e87b(0x2a3)]});_0x2af3c3[_0x20e87b(0x204)]['forEach'](_0x941926=>{var _0x48b6ea=_0x20e87b;const _0x3a7838=_0x14c061[_0x48b6ea(0x28f)]['map'](_0x14586d=>{var _0x3c7282=_0x48b6ea;_0x14586d['product_name']==_0x941926['product_name']&&_0x14586d[_0x3c7282(0x1ef)]==_0x941926[_0x3c7282(0x1ef)]&&(_0x14586d[_0x3c7282(0x2aa)]=parseInt(_0x14586d[_0x3c7282(0x2aa)])-parseInt(_0x941926[_0x3c7282(0x221)]));});}),await _0x14c061[_0x20e87b(0x1f7)]();const {invoice:_0x320042,suppliers:_0x177158,date:_0x24defe,warehouse_name:_0x5c7717,prod_name:_0x45acc5,prod_code:_0x3986c3,prod_qty:_0x61ef8b,prod_unit:_0x16366c,prod_secondunit:_0x22cea2,prod_level:_0x2fd073,prod_isle:_0x4f0d2e,prod_pallet:_0x3c1e79,note:_0x3b7d1f,expiry_date:_0x14e4ea,batch_code:_0xe5b54e,paid_amount:_0x4a05d2,due_amount:_0x4950a6,Room_name:_0x5ae885,primary_code:_0x4b5f14,secondary_code:_0x52adf6,PO_number:_0xff772a,JO_number:_0x178af5}=_0x3020b6[_0x20e87b(0x245)];if(typeof _0x45acc5==_0x20e87b(0x298))var _0x4b195a=[_0x3020b6[_0x20e87b(0x245)][_0x20e87b(0x283)]],_0x1542aa=[_0x3020b6[_0x20e87b(0x245)][_0x20e87b(0x290)]],_0x3431c3=[_0x3020b6['body']['prod_qty']],_0x72753a=[_0x3020b6['body']['prod_unit']],_0x2a9860=[_0x3020b6['body'][_0x20e87b(0x2c5)]],_0x6926ee=[_0x3020b6['body'][_0x20e87b(0x236)]],_0x536302=[_0x3020b6['body'][_0x20e87b(0x28c)]],_0x298b64=[_0x3020b6[_0x20e87b(0x245)]['secondary_code']],_0x480d2a=[_0x3020b6[_0x20e87b(0x245)][_0x20e87b(0x2b3)]],_0x3b54b7=[_0x3020b6['body'][_0x20e87b(0x1f6)]],_0x2ccb66=[_0x3020b6[_0x20e87b(0x245)][_0x20e87b(0x1e7)]];else var _0x4b195a=[..._0x3020b6['body'][_0x20e87b(0x283)]],_0x1542aa=[..._0x3020b6[_0x20e87b(0x245)][_0x20e87b(0x290)]],_0x3431c3=[..._0x3020b6[_0x20e87b(0x245)]['prod_qty']],_0x72753a=[..._0x3020b6[_0x20e87b(0x245)]['prod_unit']],_0x2a9860=[..._0x3020b6['body'][_0x20e87b(0x2c5)]],_0x6926ee=[..._0x3020b6[_0x20e87b(0x245)][_0x20e87b(0x236)]],_0x536302=[..._0x3020b6[_0x20e87b(0x245)]['primary_code']],_0x298b64=[..._0x3020b6['body'][_0x20e87b(0x2b8)]],_0x480d2a=[..._0x3020b6[_0x20e87b(0x245)]['MaxStocks_data']],_0x3b54b7=[..._0x3020b6[_0x20e87b(0x245)][_0x20e87b(0x1f6)]],_0x2ccb66=[..._0x3020b6[_0x20e87b(0x245)][_0x20e87b(0x1e7)]];const _0x106dd5=_0x4b195a['map'](_0x5c15f4=>{return _0x5c15f4={'product_name':_0x5c15f4};});_0x1542aa[_0x20e87b(0x265)]((_0x5a0dac,_0x3364e0)=>{var _0x22e626=_0x20e87b;_0x106dd5[_0x3364e0][_0x22e626(0x1e1)]=_0x5a0dac;}),_0x3431c3['forEach']((_0x1963c4,_0x55f098)=>{var _0x2e23f4=_0x20e87b;_0x106dd5[_0x55f098][_0x2e23f4(0x221)]=_0x1963c4;}),_0x72753a[_0x20e87b(0x265)]((_0x43c67f,_0x2ff53c)=>{var _0x4a1bb6=_0x20e87b;_0x106dd5[_0x2ff53c][_0x4a1bb6(0x2a4)]=_0x43c67f;}),_0x2a9860[_0x20e87b(0x265)]((_0x172671,_0x103d7c)=>{var _0x397763=_0x20e87b;_0x106dd5[_0x103d7c][_0x397763(0x206)]=_0x172671;}),_0x6926ee[_0x20e87b(0x265)]((_0x4f59c2,_0x30909f)=>{var _0x562206=_0x20e87b;_0x106dd5[_0x30909f][_0x562206(0x1ef)]=_0x4f59c2;}),_0x536302[_0x20e87b(0x265)]((_0x53ca35,_0x48d09c)=>{var _0x48909c=_0x20e87b;_0x106dd5[_0x48d09c][_0x48909c(0x28c)]=_0x53ca35;}),_0x298b64[_0x20e87b(0x265)]((_0x14b84e,_0x10f0dd)=>{var _0x327cae=_0x20e87b;_0x106dd5[_0x10f0dd][_0x327cae(0x2b8)]=_0x14b84e;}),_0x480d2a[_0x20e87b(0x265)]((_0x18ece0,_0x84eeed)=>{var _0x2845bc=_0x20e87b;_0x106dd5[_0x84eeed][_0x2845bc(0x208)]=_0x18ece0;}),_0x3b54b7[_0x20e87b(0x265)]((_0x356bba,_0x3a4701)=>{var _0x38c06b=_0x20e87b;_0x106dd5[_0x3a4701][_0x38c06b(0x1f6)]=_0x356bba;}),_0x2ccb66[_0x20e87b(0x265)]((_0x1aaa4d,_0xf75288)=>{_0x106dd5[_0xf75288]['expiry_date']=_0x1aaa4d;});const _0x288efe=_0x106dd5[_0x20e87b(0x224)](_0x152990=>_0x152990[_0x20e87b(0x221)]!=='0'&&_0x152990[_0x20e87b(0x221)]!=='');_0x2af3c3['invoice']=_0x320042,_0x2af3c3[_0x20e87b(0x25d)]=_0x177158,_0x2af3c3['date']=_0x24defe,_0x2af3c3[_0x20e87b(0x285)]=_0x5c7717,_0x2af3c3['product']=_0x288efe,_0x2af3c3[_0x20e87b(0x2ab)]=_0x3b7d1f,_0x2af3c3[_0x20e87b(0x1f8)]=_0x4a05d2,_0x2af3c3['due_amount']=_0x4950a6,_0x2af3c3['room']=_0x5ae885,_0x2af3c3[_0x20e87b(0x237)]=_0xff772a,_0x2af3c3['JO_number']=_0x178af5;const _0xb5847d=await _0x2af3c3['save'](),_0x1bb260=await warehouse[_0x20e87b(0x287)]({'name':_0x3020b6['body'][_0x20e87b(0x285)],'room':_0x3020b6['body'][_0x20e87b(0x270)]});_0x2af3c3[_0x20e87b(0x204)]['forEach'](_0xacc95e=>{var _0x18cb0b=_0x20e87b,_0x3cfdea=0x0;const _0x502e7c=_0x1bb260['product_details'][_0x18cb0b(0x1ff)](_0x3f6d33=>{var _0x369fe7=_0x18cb0b;_0x3f6d33['product_name']==_0xacc95e[_0x369fe7(0x1f0)]&&_0x3f6d33['bay']==_0xacc95e['bay']&&(_0x3f6d33[_0x369fe7(0x2aa)]=parseInt(_0x3f6d33[_0x369fe7(0x2aa)])+parseInt(_0xacc95e[_0x369fe7(0x221)]),_0x3cfdea++);});_0x3cfdea=='0'&&(_0x1bb260[_0x18cb0b(0x28f)]=_0x1bb260[_0x18cb0b(0x28f)][_0x18cb0b(0x233)]({'product_name':_0xacc95e['product_name'],'product_stock':_0xacc95e[_0x18cb0b(0x221)],'primary_code':_0xacc95e[_0x18cb0b(0x28c)],'secondary_code':_0xacc95e[_0x18cb0b(0x2b8)],'product_code':_0xacc95e[_0x18cb0b(0x1e1)],'bay':_0xacc95e['bay'],'maxProducts':_0xacc95e[_0x18cb0b(0x208)],'unit':_0xacc95e[_0x18cb0b(0x2a4)],'secondary_unit':_0xacc95e[_0x18cb0b(0x206)],'expiry_date':_0xacc95e[_0x18cb0b(0x1e7)]}));}),await _0x1bb260[_0x20e87b(0x1f7)]();const _0x3931bf=await s_payment_data[_0x20e87b(0x287)]({'invoice':_0x3020b6['body'][_0x20e87b(0x22a)]});if(_0x3931bf===null){}else console[_0x20e87b(0x288)]('suppliers',_0x3931bf,_0x3020b6['body']['invoice']),_0x3931bf[_0x20e87b(0x25d)]=_0x3020b6[_0x20e87b(0x245)]['suppliers'],await _0x3931bf['save']();_0x3020b6[_0x20e87b(0x263)](_0x20e87b(0x274),_0x20e87b(0x20a)),_0x1ef535[_0x20e87b(0x20e)](_0x20e87b(0x20c));}catch(_0x272861){console['log'](_0x272861);}}),router['post'](a0_0x725126(0x2bf),auth,async(_0x459f29,_0x3dc302)=>{var _0x1842af=a0_0x725126;try{const _0x8fa99=_0x459f29[_0x1842af(0x225)]['id'],{invoice:_0x5b9de7,suppliers:_0x9b6819,payable:_0x233209,due_amount:_0x1ea16f}=_0x459f29[_0x1842af(0x245)],_0x29d391=await purchases[_0x1842af(0x280)](_0x8fa99);var _0x27da62=_0x233209-_0x1ea16f;_0x29d391[_0x1842af(0x1f8)]=parseFloat(_0x29d391[_0x1842af(0x1f8)])+parseFloat(_0x1ea16f),_0x29d391['due_amount']=_0x27da62;const _0x37e22a=await _0x29d391[_0x1842af(0x1f7)]();console[_0x1842af(0x288)](_0x37e22a);const _0x550278=await s_payment_data[_0x1842af(0x287)]({'invoice':_0x5b9de7});_0x550278[_0x1842af(0x1e3)]=_0x27da62,await _0x550278['save']();let _0xd3c8bc=new Date(),_0x126cc9=('0'+_0xd3c8bc[_0x1842af(0x296)]())[_0x1842af(0x249)](-0x2),_0x2d6d72=('0'+(_0xd3c8bc['getMonth']()+0x1))[_0x1842af(0x249)](-0x2),_0x42f31b=_0xd3c8bc[_0x1842af(0x2a8)](),_0x29eb1c=_0x42f31b+'-'+_0x2d6d72+'-'+_0x126cc9;const _0x5e4c81=new suppliers_payment({'invoice':_0x5b9de7,'date':_0x42f31b+'-'+_0x2d6d72+'-'+_0x126cc9,'suppliers':_0x9b6819,'reason':'Paid\x20For\x20Purchase','amount':_0x1ea16f}),_0x1d5b99=await _0x5e4c81[_0x1842af(0x1f7)]();_0x459f29['flash'](_0x1842af(0x274),_0x1842af(0x21a)),_0x3dc302[_0x1842af(0x20e)]('/all_purchases/view');}catch(_0x57b7aa){console['log'](_0x57b7aa);}}),router['get'](a0_0x725126(0x212),auth,async(_0x582214,_0x51b49b)=>{var _0x44b012=a0_0x725126;try{const {username:_0x564707,email:_0x3fa89c,role:_0x5ddcb6}=_0x582214[_0x44b012(0x294)],_0x5c8fa2=_0x582214[_0x44b012(0x294)],_0x2c9cec=await profile[_0x44b012(0x287)]({'email':_0x5c8fa2[_0x44b012(0x2b9)]}),_0x243ed1=await master_shop[_0x44b012(0x1d9)]();console[_0x44b012(0x288)](_0x44b012(0x26c),_0x243ed1);const _0x1ff4dc=_0x582214[_0x44b012(0x225)]['id'],_0x40d2cb=await purchases[_0x44b012(0x280)](_0x1ff4dc);console[_0x44b012(0x288)](_0x40d2cb);const _0x13f189=await suppliers['findOne']({'name':_0x40d2cb['suppliers']});console[_0x44b012(0x288)](_0x13f189);if(_0x243ed1[0x0][_0x44b012(0x299)]=='English\x20(US)'){var _0x25a9c9=users[_0x44b012(0x2ad)];console[_0x44b012(0x288)](_0x25a9c9);}else{if(_0x243ed1[0x0][_0x44b012(0x299)]=='Hindi')var _0x25a9c9=users['Hindi'];else{if(_0x243ed1[0x0]['language']==_0x44b012(0x23f))var _0x25a9c9=users[_0x44b012(0x23f)];else{if(_0x243ed1[0x0][_0x44b012(0x299)]==_0x44b012(0x282))var _0x25a9c9=users[_0x44b012(0x282)];else{if(_0x243ed1[0x0]['language']==_0x44b012(0x201))var _0x25a9c9=users[_0x44b012(0x201)];else{if(_0x243ed1[0x0][_0x44b012(0x299)]==_0x44b012(0x27b))var _0x25a9c9=users[_0x44b012(0x24c)];else{if(_0x243ed1[0x0]['language']=='Chinese')var _0x25a9c9=users[_0x44b012(0x1f4)];else{if(_0x243ed1[0x0][_0x44b012(0x299)]==_0x44b012(0x28d))var _0x25a9c9=users[_0x44b012(0x297)];}}}}}}}_0x51b49b[_0x44b012(0x254)](_0x44b012(0x203),{'success':_0x582214[_0x44b012(0x263)](_0x44b012(0x274)),'errors':_0x582214['flash'](_0x44b012(0x26f)),'role':_0x5c8fa2,'profile':_0x2c9cec,'master_shop':_0x243ed1,'supplier':_0x13f189,'purchase':_0x40d2cb,'language':_0x25a9c9});}catch(_0xee3e9a){console[_0x44b012(0x288)](_0xee3e9a);}}),router['get'](a0_0x725126(0x292),auth,async(_0x4785f1,_0x143e74)=>{var _0x2893c8=a0_0x725126;try{const {username:_0x45aa9e,email:_0x33d72e,role:_0x3f23c1}=_0x4785f1[_0x2893c8(0x294)],_0x27727b=_0x4785f1[_0x2893c8(0x294)],_0x390196=await profile[_0x2893c8(0x287)]({'email':_0x27727b[_0x2893c8(0x2b9)]}),_0x24732c=await master_shop['find']();console[_0x2893c8(0x288)](_0x2893c8(0x26c),_0x24732c);const _0x425c4d=_0x4785f1[_0x2893c8(0x225)]['id'];console[_0x2893c8(0x288)](_0x425c4d);const _0x4eb1b0=await purchases_finished[_0x2893c8(0x280)](_0x425c4d);console[_0x2893c8(0x288)]('user_id',_0x4eb1b0);const _0x223509=await product['find']({}),_0x2f990f=await warehouse[_0x2893c8(0x2af)]([{'$match':{'name':_0x4eb1b0[_0x2893c8(0x285)],'room':_0x4eb1b0[_0x2893c8(0x2a3)]}},{'$unwind':_0x2893c8(0x219)},{'$group':{'_id':_0x2893c8(0x2ac),'name':{'$first':_0x2893c8(0x217)},'product_stock':{'$first':_0x2893c8(0x23e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2893c8(0x286)},'type':{'$first':_0x2893c8(0x291)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2893c8(0x272)},'product_code':{'$first':_0x2893c8(0x243)},'storage':{'$first':_0x2893c8(0x1ed)},'rack':{'$first':_0x2893c8(0x26e)}}}]);console[_0x2893c8(0x288)]('stock_data',_0x2f990f);let _0x2b1232;if(_0x27727b[_0x2893c8(0x1f5)]==_0x2893c8(0x27c)){const _0x4c5e97=await staff['findOne']({'email':_0x27727b[_0x2893c8(0x2b9)]});_0x2b1232=await warehouse['find']({'status':_0x2893c8(0x281),'name':_0x4c5e97[_0x2893c8(0x207)],'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'});}else _0x2b1232=await warehouse[_0x2893c8(0x2af)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':_0x2893c8(0x1fe)}},{'$group':{'_id':_0x2893c8(0x267),'name':{'$first':_0x2893c8(0x267)}}}]);if(_0x24732c[0x0]['language']==_0x2893c8(0x29b)){var _0x3348ce=users[_0x2893c8(0x2ad)];console[_0x2893c8(0x288)](_0x3348ce);}else{if(_0x24732c[0x0][_0x2893c8(0x299)]==_0x2893c8(0x21b))var _0x3348ce=users[_0x2893c8(0x21b)];else{if(_0x24732c[0x0][_0x2893c8(0x299)]==_0x2893c8(0x23f))var _0x3348ce=users['German'];else{if(_0x24732c[0x0][_0x2893c8(0x299)]==_0x2893c8(0x282))var _0x3348ce=users[_0x2893c8(0x282)];else{if(_0x24732c[0x0][_0x2893c8(0x299)]==_0x2893c8(0x201))var _0x3348ce=users[_0x2893c8(0x201)];else{if(_0x24732c[0x0][_0x2893c8(0x299)]==_0x2893c8(0x27b))var _0x3348ce=users[_0x2893c8(0x24c)];else{if(_0x24732c[0x0]['language']==_0x2893c8(0x1f4))var _0x3348ce=users[_0x2893c8(0x1f4)];else{if(_0x24732c[0x0][_0x2893c8(0x299)]==_0x2893c8(0x28d))var _0x3348ce=users[_0x2893c8(0x297)];}}}}}}}_0x143e74[_0x2893c8(0x254)]('return_purchase_finished',{'success':_0x4785f1[_0x2893c8(0x263)](_0x2893c8(0x274)),'errors':_0x4785f1[_0x2893c8(0x263)]('errors'),'role':_0x27727b,'profile':_0x390196,'user':_0x4eb1b0,'stock':_0x2f990f,'master_shop':_0x24732c,'product':_0x223509,'language':_0x3348ce,'warehouse':_0x2b1232});}catch(_0x4361bc){console[_0x2893c8(0x288)](_0x4361bc);}}),router[a0_0x725126(0x271)]('/view/return_purchase/:id',auth,async(_0x34092c,_0x2c32d1)=>{var _0x523c24=a0_0x725126;try{const {invoice:_0x48c4c4,date:_0x46986b,warehouse_name:_0x19baa0,Room_name:_0x1588d2,product_name:_0x3d161b,purchase_quantity:_0x3637d4,stocks:_0x3ae934,return_qty:_0x269334,note:_0x2bd238,level:_0x5b12bb,isle:_0x282588,pallet:_0x2d3c4f,to_warehouse_name:_0x31206f,to_Room_name:_0x339eee}=_0x34092c[_0x523c24(0x245)],_0x2bd171=await purchases_finished[_0x523c24(0x287)]({'_id':_0x34092c[_0x523c24(0x225)]['id']}),_0x3a3b84=await warehouse[_0x523c24(0x287)]({'name':_0x19baa0,'room':_0x1588d2,'warehouse_category':_0x523c24(0x210)});if(typeof _0x3d161b=='string')var _0x40ae77=[_0x34092c['body'][_0x523c24(0x1f0)]],_0x341cff=[_0x34092c[_0x523c24(0x245)][_0x523c24(0x20f)]],_0x3d57ac=[_0x34092c[_0x523c24(0x245)][_0x523c24(0x2b1)]],_0x33da98=[_0x34092c['body'][_0x523c24(0x1df)]],_0xebb2e9=[_0x34092c[_0x523c24(0x245)][_0x523c24(0x21c)]],_0x257e45=[_0x34092c[_0x523c24(0x245)]['product_code_hide']],_0x59db4a=[_0x34092c[_0x523c24(0x245)][_0x523c24(0x273)]],_0x53d906=[_0x34092c[_0x523c24(0x245)][_0x523c24(0x2a5)]];else var _0x40ae77=[..._0x34092c[_0x523c24(0x245)][_0x523c24(0x1f0)]],_0x341cff=[..._0x34092c['body'][_0x523c24(0x20f)]],_0x3d57ac=[..._0x34092c[_0x523c24(0x245)]['stocks']],_0x33da98=[..._0x34092c[_0x523c24(0x245)][_0x523c24(0x1df)]],_0xebb2e9=[..._0x34092c[_0x523c24(0x245)][_0x523c24(0x21c)]],_0x257e45=[..._0x34092c['body'][_0x523c24(0x22b)]],_0x59db4a=[..._0x34092c[_0x523c24(0x245)]['primary_code_hide']],_0x53d906=[..._0x34092c[_0x523c24(0x245)]['secondary_code_hide']];const _0xe733f9=_0x40ae77[_0x523c24(0x1ff)](_0x25252a=>{return _0x25252a={'product_name':_0x25252a};});_0x341cff[_0x523c24(0x265)]((_0x2f87e1,_0x3a8637)=>{var _0x50373c=_0x523c24;_0xe733f9[_0x3a8637][_0x50373c(0x20f)]=_0x2f87e1;}),_0x3d57ac[_0x523c24(0x265)]((_0x10efef,_0x5deb89)=>{_0xe733f9[_0x5deb89]['stock_quantity']=_0x10efef;}),_0x33da98[_0x523c24(0x265)]((_0xd7e55e,_0x488471)=>{var _0x4a8194=_0x523c24;_0xe733f9[_0x488471][_0x4a8194(0x1df)]=_0xd7e55e;}),_0xebb2e9[_0x523c24(0x265)]((_0xa60bb2,_0x1905d0)=>{_0xe733f9[_0x1905d0]['bay']=_0xa60bb2;}),_0x257e45['forEach']((_0x3662de,_0x5490b6)=>{_0xe733f9[_0x5490b6]['product_code']=_0x3662de;}),_0x59db4a['forEach']((_0x2af67d,_0x582e3b)=>{var _0x23bd6e=_0x523c24;_0xe733f9[_0x582e3b][_0x23bd6e(0x28c)]=_0x2af67d;}),_0x53d906[_0x523c24(0x265)]((_0x1fc930,_0x256bf7)=>{var _0x4b2e2f=_0x523c24;_0xe733f9[_0x256bf7][_0x4b2e2f(0x2b8)]=_0x1fc930;}),_0xe733f9[_0x523c24(0x265)](_0x23822e=>{var _0x31f2a=_0x523c24;console[_0x31f2a(0x288)](_0x23822e);const _0x2ced1c=_0x3a3b84[_0x31f2a(0x28f)][_0x31f2a(0x1ff)](_0x52e716=>{var _0xb11e33=_0x31f2a;_0x52e716[_0xb11e33(0x1f0)]==_0x23822e[_0xb11e33(0x1f0)]&&_0x52e716[_0xb11e33(0x1ef)]==_0x23822e[_0xb11e33(0x1ef)]&&(console[_0xb11e33(0x288)](parseInt(_0x52e716[_0xb11e33(0x2aa)])+'\x20<>\x20'+parseInt(_0x23822e[_0xb11e33(0x1df)])),_0x52e716[_0xb11e33(0x2aa)]=parseInt(_0x52e716[_0xb11e33(0x2aa)])-parseInt(_0x23822e[_0xb11e33(0x1df)]));});}),await _0x3a3b84[_0x523c24(0x1f7)]();var _0x521f68=0x0;_0xe733f9[_0x523c24(0x265)](_0x2789be=>{var _0x327bec=_0x523c24;(parseInt(_0x2789be['purchase_quantity'])<parseInt(_0x2789be[_0x327bec(0x1df)])||parseInt(_0x2789be[_0x327bec(0x25c)])<parseInt(_0x2789be[_0x327bec(0x1df)]))&&_0x521f68++;});if(_0x521f68!=0x0)return _0x34092c[_0x523c24(0x263)](_0x523c24(0x26f),_0x523c24(0x21f)),_0x2c32d1['redirect']('back');const _0x5d9cb2=new purchases_return_finished({'invoice':_0x48c4c4,'suppliers':_0x34092c[_0x523c24(0x245)][_0x523c24(0x25d)],'date':_0x46986b,'warehouse_name':_0x19baa0,'return_product':_0xe733f9,'note':_0x2bd238,'room':_0x1588d2,'to_warehouse_name':_0x31206f,'to_room':_0x339eee}),_0x1774b0=await _0x5d9cb2[_0x523c24(0x1f7)](),_0x485ed8=await purchases_return_finished[_0x523c24(0x287)]({'invoice':_0x48c4c4}),_0x49c832=await warehouse[_0x523c24(0x287)]({'name':_0x31206f,'room':_0x339eee,'warehouse_category':_0x523c24(0x210)});_0x485ed8[_0x523c24(0x216)][_0x523c24(0x265)](_0x1df17a=>{var _0x4a56bc=_0x523c24,_0x407890=0x0;const _0x420f2b=_0x49c832[_0x4a56bc(0x28f)][_0x4a56bc(0x1ff)](_0x4460c3=>{var _0x1cc4ea=_0x4a56bc;console[_0x1cc4ea(0x288)](_0x4460c3[_0x1cc4ea(0x1f0)]+'=='+_0x1df17a[_0x1cc4ea(0x1f0)]+'&&'+_0x4460c3[_0x1cc4ea(0x1ef)]+'=='+_0x1df17a[_0x1cc4ea(0x1ef)]),_0x4460c3[_0x1cc4ea(0x1f0)]==_0x1df17a[_0x1cc4ea(0x1f0)]&&_0x4460c3[_0x1cc4ea(0x1ef)]==_0x1df17a[_0x1cc4ea(0x1ef)]&&(_0x4460c3['product_stock']=parseInt(_0x4460c3['product_stock'])-parseInt(_0x1df17a['return_qty']),_0x407890++);});_0x407890=='0'&&(_0x49c832[_0x4a56bc(0x28f)]=_0x49c832[_0x4a56bc(0x28f)]['concat']({'product_name':_0x1df17a[_0x4a56bc(0x1f0)],'product_stock':_0x1df17a[_0x4a56bc(0x1df)],'primary_code':_0x1df17a[_0x4a56bc(0x28c)],'secondary_code':_0x1df17a[_0x4a56bc(0x2b8)],'product_code':_0x1df17a[_0x4a56bc(0x1e1)],'bay':_0x1df17a['bay'],'maxProducts':0xf423f}));}),await _0x49c832[_0x523c24(0x1f7)]();const _0x5b8283=await purchases_finished[_0x523c24(0x287)]({'invoice':_0x48c4c4});_0x5b8283[_0x523c24(0x228)]=_0x523c24(0x275);const _0x45225b=await _0x5b8283[_0x523c24(0x1f7)](),_0x26961a=new s_payment_data({'invoice':_0x48c4c4,'suppliers':_0x34092c[_0x523c24(0x245)][_0x523c24(0x25d)],'reason':_0x523c24(0x205)});await _0x26961a[_0x523c24(0x1f7)]();const _0x436e22=await master_shop['find'](),_0x5be083=await email_settings[_0x523c24(0x287)](),_0x30b088=await suppliers[_0x523c24(0x287)]({'name':_0x34092c[_0x523c24(0x245)][_0x523c24(0x25d)]});_0x436e22[0x0]['currency_placement']==0x1?(right_currency=_0x436e22[0x0][_0x523c24(0x222)],left_currency=''):(right_currency='',left_currency=_0x436e22[0x0][_0x523c24(0x222)]);var _0x106228=_0x40ae77,_0x5ce0bd=_0x33da98,_0x52d4e2='',_0x40aaa4;for(_0x40aaa4 in _0x106228){_0x52d4e2+='<tr>'+_0x523c24(0x2cd)+_0x106228[_0x40aaa4]+_0x523c24(0x248)+_0x523c24(0x2cd)+_0x5ce0bd[_0x40aaa4]+_0x523c24(0x248)+'</tr>';}let _0x21e002=nodemailer[_0x523c24(0x209)]({'service':_0x523c24(0x218),'auth':{'user':_0x5be083[_0x523c24(0x2b9)],'pass':_0x5be083[_0x523c24(0x27e)]}}),_0x1720ae={'from':_0x5be083[_0x523c24(0x2b9)],'to':_0x30b088['email'],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x523c24(0x1f2),'path':__dirname+'/../public'+_0x523c24(0x257)+_0x436e22[0x0]['image'],'cid':'logo'}],'html':_0x523c24(0x2c6)+'<html><head><title></title>'+_0x523c24(0x256)+_0x523c24(0x24a)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x523c24(0x20b)+_0x523c24(0x2b2)+'<div>'+_0x523c24(0x23c)+_0x436e22[0x0][_0x523c24(0x239)]+_0x523c24(0x2ca)+_0x523c24(0x2b2)+'</div>'+_0x523c24(0x1fc)+_0x523c24(0x24a)+_0x523c24(0x259)+'\x20Order\x20Number\x20:\x20'+_0x48c4c4+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x523c24(0x21e)+_0x46986b+'\x20'+_0x523c24(0x29e)+_0x523c24(0x2ba)+_0x523c24(0x2b2)+_0x523c24(0x252)+_0x523c24(0x22e)+_0x523c24(0x1dd)+_0x523c24(0x22d)+_0x523c24(0x22c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x523c24(0x27d)+_0x523c24(0x2ce)+_0x523c24(0x2a1)+_0x523c24(0x1f9)+'\x20'+_0x52d4e2+'\x20'+'</tbody>'+_0x523c24(0x289)+_0x523c24(0x24a)+_0x523c24(0x1dc)+_0x523c24(0x25b)+_0x436e22[0x0]['site_title']+_0x523c24(0x2ba)+_0x523c24(0x2b2)+_0x523c24(0x2b2)+_0x523c24(0x241)};_0x21e002[_0x523c24(0x295)](_0x1720ae,function(_0x3245b2,_0x37166e){var _0x3482a2=_0x523c24;_0x3245b2?console['log'](_0x3482a2(0x258)):console[_0x3482a2(0x288)]('Email\x20sent\x20successfully');}),_0x34092c[_0x523c24(0x263)](_0x523c24(0x274),_0x523c24(0x269)),_0x2c32d1[_0x523c24(0x20e)]('/all_purchases_finished/view');}catch(_0x13a99a){_0x2c32d1[_0x523c24(0x1e9)](0xc8)[_0x523c24(0x293)]({'message':_0x13a99a[_0x523c24(0x253)]});}}),router[a0_0x725126(0x21d)](a0_0x725126(0x242),auth,async(_0x5525f9,_0xb48db1)=>{var _0x21549a=a0_0x725126;try{const {username:_0x437d84,email:_0x3092f5,role:_0x3fc721}=_0x5525f9[_0x21549a(0x294)],_0x474d48=_0x5525f9[_0x21549a(0x294)],_0x365731=await profile['findOne']({'email':_0x474d48[_0x21549a(0x2b9)]}),_0x287059=await master_shop[_0x21549a(0x1d9)](),_0x480300=_0x5525f9[_0x21549a(0x225)]['id'],_0x5ba6b2=await purchases_finished[_0x21549a(0x280)](_0x480300);if(_0x287059[0x0]['language']==_0x21549a(0x29b))var _0x365f16=users[_0x21549a(0x2ad)];else{if(_0x287059[0x0][_0x21549a(0x299)]==_0x21549a(0x21b))var _0x365f16=users['Hindi'];else{if(_0x287059[0x0][_0x21549a(0x299)]==_0x21549a(0x23f))var _0x365f16=users[_0x21549a(0x23f)];else{if(_0x287059[0x0]['language']==_0x21549a(0x282))var _0x365f16=users['Spanish'];else{if(_0x287059[0x0][_0x21549a(0x299)]==_0x21549a(0x201))var _0x365f16=users['French'];else{if(_0x287059[0x0][_0x21549a(0x299)]==_0x21549a(0x27b))var _0x365f16=users[_0x21549a(0x24c)];else{if(_0x287059[0x0][_0x21549a(0x299)]==_0x21549a(0x1f4))var _0x365f16=users[_0x21549a(0x1f4)];else{if(_0x287059[0x0][_0x21549a(0x299)]=='Arabic\x20(ae)')var _0x365f16=users['Arabic'];}}}}}}}_0xb48db1[_0x21549a(0x254)]('all_purchases_barcode',{'success':_0x5525f9[_0x21549a(0x263)](_0x21549a(0x274)),'errors':_0x5525f9[_0x21549a(0x263)](_0x21549a(0x26f)),'role':_0x474d48,'profile':_0x365731,'alldata':_0x5ba6b2,'master_shop':_0x287059,'language':_0x365f16}),console[_0x21549a(0x288)](alldata);}catch(_0x4d005e){console[_0x21549a(0x288)](_0x4d005e);}}),router[a0_0x725126(0x271)]('/barcode_scanner',async(_0x282649,_0x4cc921)=>{var _0x240218=a0_0x725126;const {product_code:_0x2a4443}=_0x282649[_0x240218(0x245)];var _0x3c30e0;const _0x1b3952=await product[_0x240218(0x2af)]([{'$match':{'primary_code':_0x2a4443,'product_category':_0x240218(0x210)}},{'$group':{'_id':_0x240218(0x235),'name':{'$first':_0x240218(0x267)},'category':{'$first':_0x240218(0x24d)},'brand':{'$first':_0x240218(0x25f)},'unit':{'$first':_0x240218(0x2c2)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x240218(0x2bc)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x240218(0x231)},'maxProdPerUnit':{'$first':_0x240218(0x202)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x50a457=await product[_0x240218(0x2af)]([{'$match':{'secondary_code':_0x2a4443}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x240218(0x24d)},'brand':{'$first':_0x240218(0x25f)},'unit':{'$first':_0x240218(0x2c2)},'alertquantity':{'$first':_0x240218(0x2be)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x240218(0x214)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x240218(0x231)},'maxProdPerUnit':{'$first':_0x240218(0x202)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x240218(0x23a)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1b3952[_0x240218(0x28a)]>0x0)_0x3c30e0=_0x1b3952;else _0x50a457[_0x240218(0x28a)]>0x0&&(_0x3c30e0=_0x50a457);_0x4cc921['json'](_0x3c30e0);}),router['post'](a0_0x725126(0x230),async(_0xb89e01,_0x107ffb)=>{var _0x2c4063=a0_0x725126;const {productCode:_0x32242a,bay:_0x3fed72,warehouses:_0x40f600,room:_0x430d37}=_0xb89e01[_0x2c4063(0x245)];console['log'](_0xb89e01[_0x2c4063(0x245)]);try{const _0x2406b7=await warehouse[_0x2c4063(0x2af)]([{'$match':{'name':_0x40f600,'room':_0x430d37}},{'$unwind':_0x2c4063(0x219)},{'$match':{'product_details.bay':parseInt(_0x3fed72)}},{'$group':{'_id':_0x2c4063(0x2ac),'name':{'$first':_0x2c4063(0x217)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x2c4063(0x260)}}}]);_0x107ffb['status'](0xc8)[_0x2c4063(0x293)](_0x2406b7);}catch(_0x394f3f){_0x107ffb[_0x2c4063(0x1e9)](0x194)[_0x2c4063(0x293)]({'message':_0x394f3f[_0x2c4063(0x253)]});}}),module[a0_0x725126(0x1e0)]=router;