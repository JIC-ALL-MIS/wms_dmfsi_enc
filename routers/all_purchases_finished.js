var a0_0x267b14=a0_0x4344;(function(_0xaf0a42,_0x345d3a){var _0x5d61e8=a0_0x4344,_0x120ae5=_0xaf0a42();while(!![]){try{var _0x1c7577=parseInt(_0x5d61e8(0x17b))/0x1*(parseInt(_0x5d61e8(0x1f5))/0x2)+-parseInt(_0x5d61e8(0x196))/0x3+parseInt(_0x5d61e8(0x25b))/0x4*(-parseInt(_0x5d61e8(0x1ac))/0x5)+-parseInt(_0x5d61e8(0x21a))/0x6*(parseInt(_0x5d61e8(0x1de))/0x7)+-parseInt(_0x5d61e8(0x26b))/0x8*(-parseInt(_0x5d61e8(0x1b4))/0x9)+-parseInt(_0x5d61e8(0x178))/0xa+parseInt(_0x5d61e8(0x205))/0xb;if(_0x1c7577===_0x345d3a)break;else _0x120ae5['push'](_0x120ae5['shift']());}catch(_0x2d80d2){_0x120ae5['push'](_0x120ae5['shift']());}}}(a0_0x67c8,0x62120));const express=require(a0_0x267b14(0x1c0)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x267b14(0x237)),auth=require(a0_0x267b14(0x197)),nodemailer=require(a0_0x267b14(0x193));var ejs=require(a0_0x267b14(0x1c9));const path=require('path'),users=require(a0_0x267b14(0x1ca));function a0_0x67c8(){var _0x3d6ff7=['warehouse_name','$product.type','params','<tr>','success','Room_name','product_cat','FROZEN\x20GOODS','batch_code','812220sSsYvc','$note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','34321pybUTp','logo','edit_purchases_finished','$product_details.maxProducts','$return_data','</td>','secondary_unit','$product_details.storage','$product.bay','secondary_code','redirect','Purchase\x20Mail','errors','status','Spanish','note','<table\x20style=\x22width:\x20100%\x20!important;\x22>','RoomAssign','currency','QA\x20Warehouse','host','product_stock','return_data','aggregate','nodemailer','product','$suppliers_docs','1597404OyJeHR','../middleware/auth','post','\x20Order\x20Number\x20:\x20','$product.quantity','sendMail','/barcode/:id','$product_details.product_stock','$due_amount','port','$product_details._id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Logo.png','/view/:id','FGSEmail','stock_data','INCF-','email','True','Rack\x201','<h5>','catch','10910pvSnWw','$name','maxStocks','/upload/','Purchase\x20Return\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','master','German','33822HROuif','$warehouse_name','findOne','primary_code','find','product_date','<tbody\x20style=\x22text-align:\x20center;\x22>','<hr\x20class=\x22my-3\x22>','toString','suppliers','max_product_unit','</h5>','express','password','$unit','$secondary_code','getFullYear','warehouse','Portuguese\x20(BR)','user','$expiry_date','ejs','../public/language/languages.json','return_qty','slice','site_title','then','concat','flash','French','secondary_code_hide','purchases\x20item\x20return\x20successfull','DRY\x20GOODS','floor','$product_details.product_code','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Rack\x202','\x20</h2>','log','</div>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','525svrVUN','$date','MaxStocks_data','map','purchase\x20data\x20add\x20successfully','$product_details.bay','standard_unit','$secondary_unit','/all_purchases/view','POnumber','</body></html>','maxperunit','English','$product_details.rack','$maxStocks','prod_primunit','image','json','$product_details','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Paid\x20For\x20Purchase','prod_name','34ZhKoKg','edit_purchases_finished_view','prod_Qty','$_id','product_code','$brand','_id','$product','$product_details.product_name','$product.room_name','due_amount','Error\x20Occurs','language','$product.bin','all','prod_secondunit','13080848bUDWnm','Hindi','get','<html><head><title></title>','$suppliers','/view/return_purchase/:id','prod_unit','back','prod_level','paid_amount','error','$product_details.type','$product_details.bin','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','getDate','/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Portuguese','$primary_code','$category','/view/add_purchases','62742mCIjrH','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','currency_placement','<h2>\x20','product_name','Arabic\x20(ae)','quantity','product_code_hide','product_details','English\x20(US)','JO_number','</tbody>','createTransport','findById','</head><body>','gmail','date','stocks','/all_purchases_finished/view','level','render','Chinese','$paid_amount','invoice','prod_invoice','An\x20error\x20occurred.','Purchase\x20Return','filter','string','../models/all_models','/view/add_purchases/:id','Return\x20Goods','<div>','body','Finished\x20Goods','There\x27s\x20a\x20error\x20in\x20this\x20transaction','prod_qty','Arabic','Email\x20sent\x20successfully','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Enabled','save','length','purchase_quantity','production_date','message','getMonth','$product_details.primary_code','</table>','padStart','suppliers_docs','$product_code','updateOne','</span>','\x20Order\x20Date\x20:\x20','$maxProdPerUnit','</tr>','role','$batch_code','<strong>\x20Regards\x20</strong>','An\x20error\x20occurred\x20while\x20saving\x20data.','<!DOCTYPE\x20html>','staff','forEach','$product.floorlevel','164jzOcub','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$alertquantity','<span\x20style=\x22float:\x20right;\x22>','payment\x20successfull','room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$room','name','purchase\x20data\x20update\x20successfully','stock_quantity','room','prod_cat','bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<h5\x20style=\x22text-align:\x20left;\x22>','248mwbwTk','return_purchase_finished'];a0_0x67c8=function(){return _0x3d6ff7;};return a0_0x67c8();}router[a0_0x267b14(0x207)](a0_0x267b14(0x214),auth,async(_0x381b3b,_0x47fb6a)=>{var _0xef49af=a0_0x267b14;try{const {username:_0x265e1a,email:_0x498e4b,role:_0x32ab32}=_0x381b3b['user'],_0x489f80=_0x381b3b[_0xef49af(0x1c7)],_0x3656fb=await profile[_0xef49af(0x1b6)]({'email':_0x489f80[_0xef49af(0x1a7)]}),_0x3992e6=await staff['findOne']({'email':_0x489f80[_0xef49af(0x1a7)]});if(_0x489f80[_0xef49af(0x253)]==_0xef49af(0x258)){const _0x3552d5=await staff['findOne']({'email':_0x489f80[_0xef49af(0x1a7)]});}const _0x2cefb0=await master_shop['find']();let _0x3eb957;if(_0x489f80[_0xef49af(0x253)]==_0xef49af(0x258)){const _0x85aab5=await staff[_0xef49af(0x1b6)]({'email':_0x489f80[_0xef49af(0x1a7)]});_0x3eb957=await purchases_finished[_0xef49af(0x192)]([{'$match':{'warehouse_name':_0x85aab5[_0xef49af(0x1c5)]}},{'$lookup':{'from':_0xef49af(0x1bd),'localField':_0xef49af(0x1bd),'foreignField':_0xef49af(0x263),'as':_0xef49af(0x24c)}},{'$unwind':_0xef49af(0x195)},{'$unwind':_0xef49af(0x1fc)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0xef49af(0x209)},'date':{'$first':_0xef49af(0x1df)},'warehouse_name':{'$first':_0xef49af(0x1b5)},'room':{'$first':_0xef49af(0x262)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0xef49af(0x19e)},'return_data':{'$first':_0xef49af(0x17f)},'batch_code':{'$first':_0xef49af(0x254)},'expiry_date':{'$first':_0xef49af(0x1c8)},'suppliers_docs':{'$first':_0xef49af(0x195)},'total_product_quantity':{'$sum':_0xef49af(0x19a)},'level':{'$addToSet':_0xef49af(0x183)},'isle':{'$addToSet':_0xef49af(0x202)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0xef49af(0x25a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3eb957=await purchases_finished[_0xef49af(0x192)]([{'$unwind':_0xef49af(0x1fc)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0xef49af(0x209)},'date':{'$first':_0xef49af(0x1df)},'warehouse_name':{'$first':_0xef49af(0x1b5)},'room':{'$addToSet':_0xef49af(0x1fe)},'product':{'$push':_0xef49af(0x1fc)},'note':{'$first':_0xef49af(0x179)},'paid_amount':{'$first':_0xef49af(0x230)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0xef49af(0x254)},'expiry_date':{'$first':_0xef49af(0x1c8)},'suppliers_docs':{'$first':_0xef49af(0x195)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0xef49af(0x183)},'isle':{'$addToSet':_0xef49af(0x202)},'type':{'$addToSet':_0xef49af(0x26e)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x2cefb0[0x0][_0xef49af(0x201)]==_0xef49af(0x223))var _0x601458=users['English'];else{if(_0x2cefb0[0x0][_0xef49af(0x201)]=='Hindi')var _0x601458=users[_0xef49af(0x206)];else{if(_0x2cefb0[0x0][_0xef49af(0x201)]==_0xef49af(0x1b3))var _0x601458=users[_0xef49af(0x1b3)];else{if(_0x2cefb0[0x0][_0xef49af(0x201)]==_0xef49af(0x189))var _0x601458=users[_0xef49af(0x189)];else{if(_0x2cefb0[0x0][_0xef49af(0x201)]==_0xef49af(0x1d1))var _0x601458=users['French'];else{if(_0x2cefb0[0x0][_0xef49af(0x201)]==_0xef49af(0x1c6))var _0x601458=users[_0xef49af(0x216)];else{if(_0x2cefb0[0x0][_0xef49af(0x201)]==_0xef49af(0x22f))var _0x601458=users[_0xef49af(0x22f)];else{if(_0x2cefb0[0x0][_0xef49af(0x201)]==_0xef49af(0x21f))var _0x601458=users[_0xef49af(0x23f)];}}}}}}}_0x47fb6a[_0xef49af(0x22e)]('all_purchases_finished',{'success':_0x381b3b['flash']('success'),'errors':_0x381b3b[_0xef49af(0x1d0)](_0xef49af(0x187)),'purchases':_0x3eb957,'role':_0x489f80,'profile':_0x3656fb,'master_shop':_0x2cefb0,'language':_0x601458});}catch(_0x48e6e4){console[_0xef49af(0x1db)]('table\x20page',_0x48e6e4),_0x47fb6a[_0xef49af(0x188)](0xc8)[_0xef49af(0x1ef)]({'message':_0x48e6e4[_0xef49af(0x247)]});}});function BayBinSelected(_0x464f2e,_0x59a373){var _0x1a4d0b=a0_0x267b14,_0x68c17c=[],_0x399047=[];if(_0x464f2e==_0x1a4d0b(0x1d4)){switch(_0x59a373){case _0x1a4d0b(0x1a9):_0x68c17c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1a4d0b(0x1d9):_0x68c17c=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x399047=['DG'];}else{if(_0x464f2e==_0x1a4d0b(0x176)){switch(_0x59a373){case'Rack\x201':_0x68c17c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1a4d0b(0x1d9):_0x68c17c=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x399047=['FG'];}}return{'levels':_0x68c17c,'identify':_0x399047};}async function getRandom8DigitNumber(){var _0x287eee=a0_0x267b14;const _0x128508=0x989680,_0x2e5ed5=0x5f5e0ff,_0x33003c=Math[_0x287eee(0x1d5)](Math['random']()*(_0x2e5ed5-_0x128508+0x1))+_0x128508;var _0x9698e3;const _0x165d1e=await purchases_finished[_0x287eee(0x1b6)]({'invoice':_0x287eee(0x1a6)+_0x33003c});return _0x165d1e&&_0x165d1e['length']>0x0?_0x9698e3=_0x287eee(0x1a6)+_0x33003c:_0x9698e3=_0x287eee(0x1a6)+_0x33003c,_0x9698e3;}function a0_0x4344(_0x327d40,_0x3670e0){var _0x67c837=a0_0x67c8();return a0_0x4344=function(_0x434434,_0x42c04b){_0x434434=_0x434434-0x174;var _0x5a3ed5=_0x67c837[_0x434434];return _0x5a3ed5;},a0_0x4344(_0x327d40,_0x3670e0);}router[a0_0x267b14(0x207)](a0_0x267b14(0x219),auth,async(_0x5137ac,_0x5e7d97)=>{var _0x529fa1=a0_0x267b14;try{const {username:_0x58b175,email:_0x493454,role:_0x1586d2}=_0x5137ac[_0x529fa1(0x1c7)],_0x3a4aba=_0x5137ac[_0x529fa1(0x1c7)],_0x717499=await profile[_0x529fa1(0x1b6)]({'email':_0x3a4aba['email']}),_0x481f17=await master_shop[_0x529fa1(0x1b8)](),_0x1371ce=await staff[_0x529fa1(0x1b6)]({'email':_0x3a4aba[_0x529fa1(0x1a7)]}),_0x4bbe0f=await suppliers[_0x529fa1(0x1b8)]({});let _0x19271a;if(_0x3a4aba[_0x529fa1(0x253)]=='staff'){const _0x3b99ff=await staff[_0x529fa1(0x1b6)]({'email':_0x3a4aba[_0x529fa1(0x1a7)]});_0x19271a=await warehouse[_0x529fa1(0x192)]([{'$match':{'status':'Enabled','name':_0x3b99ff[_0x529fa1(0x1c5)],'warehouse_category':_0x529fa1(0x23c)}},{'$group':{'_id':_0x529fa1(0x1ad),'name':{'$first':_0x529fa1(0x1ad)}}}]);}else _0x19271a=await warehouse[_0x529fa1(0x192)]([{'$match':{'status':_0x529fa1(0x242),'warehouse_category':_0x529fa1(0x23c),'name':{'$ne':_0x529fa1(0x18e)}}},{'$group':{'_id':_0x529fa1(0x1ad),'name':{'$first':_0x529fa1(0x1ad)}}}]);const _0x237bbf=await product[_0x529fa1(0x1b8)]({}),_0x3a375b=await warehouse[_0x529fa1(0x1b8)]({'status':'Enabled'}),_0x10dba4=await purchases_finished[_0x529fa1(0x1b8)]({}),_0x32167b=_0x10dba4[_0x529fa1(0x244)]+0x1,_0x35b8cb=_0x529fa1(0x1a6)+_0x32167b[_0x529fa1(0x1bc)]()[_0x529fa1(0x24b)](0x5,'0');var _0xcedd93=['Ambient','Enclosed'];if(_0x481f17[0x0]['language']==_0x529fa1(0x223))var _0x41f908=users[_0x529fa1(0x1ea)];else{if(_0x481f17[0x0][_0x529fa1(0x201)]==_0x529fa1(0x206))var _0x41f908=users['Hindi'];else{if(_0x481f17[0x0][_0x529fa1(0x201)]==_0x529fa1(0x1b3))var _0x41f908=users[_0x529fa1(0x1b3)];else{if(_0x481f17[0x0][_0x529fa1(0x201)]==_0x529fa1(0x189))var _0x41f908=users[_0x529fa1(0x189)];else{if(_0x481f17[0x0][_0x529fa1(0x201)]==_0x529fa1(0x1d1))var _0x41f908=users[_0x529fa1(0x1d1)];else{if(_0x481f17[0x0][_0x529fa1(0x201)]==_0x529fa1(0x1c6))var _0x41f908=users[_0x529fa1(0x216)];else{if(_0x481f17[0x0][_0x529fa1(0x201)]==_0x529fa1(0x22f))var _0x41f908=users['Chinese'];else{if(_0x481f17[0x0]['language']==_0x529fa1(0x21f))var _0x41f908=users[_0x529fa1(0x23f)];}}}}}}}const _0x406ca0=getRandom8DigitNumber();_0x406ca0['then'](_0x1078de=>{var _0x3b0ad3=_0x529fa1;_0x5e7d97[_0x3b0ad3(0x22e)]('add_purchases_finished',{'success':_0x5137ac[_0x3b0ad3(0x1d0)](_0x3b0ad3(0x271)),'errors':_0x5137ac[_0x3b0ad3(0x1d0)](_0x3b0ad3(0x187)),'role':_0x3a4aba,'profile':_0x717499,'suppliers':_0x4bbe0f,'warehouse':_0x19271a,'product':_0x237bbf,'invoice':_0x1078de,'master_shop':_0x481f17,'language':_0x41f908,'find_data':_0x3a375b,'rooms_data':_0xcedd93});})['catch'](_0x38f6aa=>{var _0x5b56cc=_0x529fa1;_0x5137ac[_0x5b56cc(0x1d0)](_0x5b56cc(0x187),_0x5b56cc(0x23d)),_0x5e7d97[_0x5b56cc(0x185)]('/all_purchases_finished/view');});}catch(_0x2683a6){console[_0x529fa1(0x1db)](_0x2683a6);}}),router[a0_0x267b14(0x207)](a0_0x267b14(0x238),auth,async(_0x14ad5d,_0x22b182)=>{var _0x55f2a8=a0_0x267b14;try{const _0x5c96d8=_0x14ad5d[_0x55f2a8(0x26f)]['id'];console['log'](_0x5c96d8);const _0x39f7ba=await master_shop[_0x55f2a8(0x1b8)]();console['log'](_0x55f2a8(0x1b2),_0x39f7ba);const _0x3ba322=await product[_0x55f2a8(0x1b6)]({'name':_0x5c96d8});console[_0x55f2a8(0x1db)]('product',_0x3ba322),_0x22b182[_0x55f2a8(0x188)](0xc8)[_0x55f2a8(0x1ef)]({'product_data':_0x3ba322,'master':_0x39f7ba});}catch(_0x357d0d){console[_0x55f2a8(0x1db)]('add_purchases\x20error',_0x357d0d);}}),router['post'](a0_0x267b14(0x219),auth,async(_0xf9c90c,_0x244706)=>{var _0x247f25=a0_0x267b14;try{const {invoice:_0x273791,date:_0x1404e4,warehouse_name:_0x32dd05,prod_name:_0x3ff6f3,prod_code:_0x12d19c,prod_qty:_0x1f346c,prod_unit:_0x75ea3e,prod_secondunit:_0x3308a5,prod_level:_0x4ec825,prod_isle:_0x38f47b,prod_pallet:_0x1a6b87,note:_0x4cee68,expiry_date:_0x3ad59a,batch_code:_0x23bc60,payable:_0x3d0a1f,due_amount:_0x29ff44,Room_name:_0x425460,primary_code:_0x196ff8,secondary_code:_0x55dc15,MaxStocks_data:_0x13fb3e,PO_number:_0x137904,SCRN:_0x248fa1,JO_number:_0x5c6cc6}=_0xf9c90c[_0x247f25(0x23b)];if(typeof _0x3ff6f3=='string')var _0x555e9b=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1f4)]],_0x305cfe=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1d7)]],_0x433b9f=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1f7)]],_0x4b7c00=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1ed)]],_0x35b3c7=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x204)]],_0x29cc70=[_0xf9c90c[_0x247f25(0x23b)]['prod_level']],_0x1b42ed=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1b7)]],_0x2ba44=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x184)]],_0x2ff285=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1e0)]],_0x20fa05=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x177)]],_0x4bac1e=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1f1)]],_0x52d684=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1b9)]],_0x1270a3=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1be)]],_0x18746f=[_0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x267)]],_0x4853e1=[_0xf9c90c[_0x247f25(0x23b)]['RoomAssign']],_0x190888=[_0xf9c90c[_0x247f25(0x23b)]['prod_invoice']];else var _0x555e9b=[..._0xf9c90c[_0x247f25(0x23b)]['prod_name']],_0x305cfe=[..._0xf9c90c['body'][_0x247f25(0x1d7)]],_0x433b9f=[..._0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1f7)]],_0x4b7c00=[..._0xf9c90c['body'][_0x247f25(0x1ed)]],_0x35b3c7=[..._0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x204)]],_0x29cc70=[..._0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x20d)]],_0x1b42ed=[..._0xf9c90c['body'][_0x247f25(0x1b7)]],_0x2ba44=[..._0xf9c90c[_0x247f25(0x23b)]['secondary_code']],_0x2ff285=[..._0xf9c90c['body']['MaxStocks_data']],_0x20fa05=[..._0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x177)]],_0x4bac1e=[..._0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1f1)]],_0x52d684=[..._0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1b9)]],_0x1270a3=[..._0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x1be)]],_0x18746f=[..._0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x267)]],_0x4853e1=[..._0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x18c)]],_0x190888=[..._0xf9c90c[_0x247f25(0x23b)][_0x247f25(0x232)]];const _0x46e0bd=_0x555e9b[_0x247f25(0x1e1)](_0x7cc3f8=>{return _0x7cc3f8={'product_name':_0x7cc3f8};});_0x305cfe[_0x247f25(0x259)]((_0x2da184,_0x3a7627)=>{var _0x1859df=_0x247f25;_0x46e0bd[_0x3a7627][_0x1859df(0x1f9)]=_0x2da184;}),_0x433b9f[_0x247f25(0x259)]((_0x5043fb,_0x1be5d5)=>{var _0x233a78=_0x247f25;_0x46e0bd[_0x1be5d5][_0x233a78(0x220)]=_0x5043fb;}),_0x4b7c00[_0x247f25(0x259)]((_0x363850,_0x561a1e)=>{_0x46e0bd[_0x561a1e]['standard_unit']=_0x363850;}),_0x35b3c7[_0x247f25(0x259)]((_0x5d0628,_0x41629c)=>{_0x46e0bd[_0x41629c]['secondary_unit']=_0x5d0628;}),_0x29cc70[_0x247f25(0x259)]((_0x27dfa7,_0x27e9cf)=>{var _0xa185a5=_0x247f25;_0x46e0bd[_0x27e9cf][_0xa185a5(0x268)]=_0x27dfa7;}),_0x1b42ed['forEach']((_0x20b0a7,_0x4c94df)=>{var _0x190f69=_0x247f25;_0x46e0bd[_0x4c94df][_0x190f69(0x1b7)]=_0x20b0a7;}),_0x2ba44[_0x247f25(0x259)]((_0x5b7367,_0x57fba7)=>{var _0x367831=_0x247f25;_0x46e0bd[_0x57fba7][_0x367831(0x184)]=_0x5b7367;}),_0x2ff285[_0x247f25(0x259)]((_0x1e4f2c,_0x1ea281)=>{var _0x150031=_0x247f25;_0x46e0bd[_0x1ea281][_0x150031(0x1ae)]=_0x1e4f2c;}),_0x20fa05[_0x247f25(0x259)]((_0x30c808,_0x56a384)=>{var _0x36cf08=_0x247f25;_0x46e0bd[_0x56a384][_0x36cf08(0x177)]=_0x30c808;}),_0x4bac1e['forEach']((_0xc52509,_0x2680cd)=>{_0x46e0bd[_0x2680cd]['expiry_date']=_0xc52509;}),_0x52d684[_0x247f25(0x259)]((_0x413fdd,_0x347b2d)=>{var _0x28fe35=_0x247f25;_0x46e0bd[_0x347b2d][_0x28fe35(0x246)]=_0x413fdd;}),_0x1270a3[_0x247f25(0x259)]((_0x289254,_0x2b5563)=>{_0x46e0bd[_0x2b5563]['maxperunit']=_0x289254;}),_0x18746f[_0x247f25(0x259)]((_0x5e8745,_0x4840e4)=>{var _0x27e3b3=_0x247f25;_0x46e0bd[_0x4840e4][_0x27e3b3(0x175)]=_0x5e8745;}),_0x4853e1[_0x247f25(0x259)]((_0x1755e5,_0x234530)=>{var _0x4136e9=_0x247f25;_0x46e0bd[_0x234530][_0x4136e9(0x260)]=_0x1755e5;}),_0x190888[_0x247f25(0x259)]((_0x1a3d3e,_0x4c9c42)=>{var _0x2785ae=_0x247f25;_0x46e0bd[_0x4c9c42][_0x2785ae(0x231)]=_0x1a3d3e;});const _0x429de3=_0x46e0bd[_0x247f25(0x235)](_0x570d54=>_0x570d54['quantity']!=='0'&&_0x570d54[_0x247f25(0x220)]!==''),_0x97f736=new purchases_finished({'invoice':_0x273791,'suppliers':_0xf9c90c[_0x247f25(0x23b)]['suppliers'],'date':_0x1404e4,'warehouse_name':_0x32dd05,'product':_0x429de3,'note':_0x4cee68,'due_amount':_0x29ff44,'room':_0x425460,'POnumber':_0x137904,'SCRN':_0x248fa1,'JO_number':_0x5c6cc6}),_0x24a374=await _0x97f736[_0x247f25(0x243)](),_0x30f8f0=await purchases_finished[_0x247f25(0x1b6)]({'invoice':_0x273791}),_0x3a3940=_0x30f8f0['product']['map'](async _0x12dafa=>{var _0x54894b=_0x247f25,_0x3074c6=await warehouse[_0x54894b(0x1b6)]({'name':_0x32dd05,'room':_0x12dafa[_0x54894b(0x260)]}),_0x5153fb=0x0;const _0x50c779=_0x3074c6[_0x54894b(0x222)][_0x54894b(0x1e1)](_0x16ffcc=>{var _0x29ef5f=_0x54894b;console[_0x29ef5f(0x1db)](_0x16ffcc['product_name']+'=='+_0x12dafa[_0x29ef5f(0x21e)]+'&&'+_0x16ffcc['bay']+'=='+_0x12dafa[_0x29ef5f(0x268)]+'&&'+_0x16ffcc['expiry_date']+'=='+_0x12dafa['expiry_date']+'&&'+_0x16ffcc[_0x29ef5f(0x246)]+'=='+_0x12dafa[_0x29ef5f(0x246)]+'&&'+_0x16ffcc['batch_code']+'=='+_0x12dafa[_0x29ef5f(0x177)]+'&&'+_0x16ffcc[_0x29ef5f(0x231)]+'=='+_0x30f8f0[_0x29ef5f(0x231)]),_0x16ffcc[_0x29ef5f(0x21e)]==_0x12dafa[_0x29ef5f(0x21e)]&&_0x16ffcc[_0x29ef5f(0x268)]==_0x12dafa[_0x29ef5f(0x268)]&&_0x16ffcc[_0x29ef5f(0x1f1)]==_0x12dafa['expiry_date']&&_0x16ffcc['production_date']==_0x12dafa[_0x29ef5f(0x246)]&&_0x16ffcc[_0x29ef5f(0x177)]==_0x12dafa[_0x29ef5f(0x177)]&&_0x16ffcc['invoice']==_0x30f8f0[_0x29ef5f(0x231)]&&(_0x16ffcc[_0x29ef5f(0x190)]=_0x16ffcc['product_stock']+_0x12dafa[_0x29ef5f(0x220)],_0x5153fb++);});return _0x5153fb=='0'&&(_0x3074c6['product_details']=_0x3074c6[_0x54894b(0x222)][_0x54894b(0x1cf)]({'product_name':_0x12dafa['product_name'],'product_stock':_0x12dafa[_0x54894b(0x220)],'primary_code':_0x12dafa[_0x54894b(0x1b7)],'secondary_code':_0x12dafa[_0x54894b(0x184)],'product_code':_0x12dafa[_0x54894b(0x1f9)],'bay':_0x12dafa[_0x54894b(0x268)],'maxProducts':_0x12dafa[_0x54894b(0x1ae)],'unit':_0x12dafa[_0x54894b(0x1e4)],'secondary_unit':_0x12dafa[_0x54894b(0x181)],'expiry_date':_0x12dafa[_0x54894b(0x1f1)],'production_date':_0x12dafa[_0x54894b(0x246)],'maxProducts':_0x12dafa[_0x54894b(0x1ae)],'maxPerUnit':_0x12dafa[_0x54894b(0x1e9)],'batch_code':_0x12dafa[_0x54894b(0x177)],'product_cat':_0x12dafa['product_cat'],'invoice':_0x12dafa['invoice']})),_0x3074c6;});Promise[_0x247f25(0x203)](_0x3a3940)[_0x247f25(0x1ce)](async _0x308d17=>{var _0xab2201=_0x247f25;try{for(const _0xd2d50d of _0x308d17){await warehouse[_0xab2201(0x24e)]({'_id':_0xd2d50d[_0xab2201(0x1fb)]},{'$addToSet':{'product_details':{'$each':_0xd2d50d['product_details']}}});}const _0x31279c=await master_shop[_0xab2201(0x1b8)](),_0x34e643=await email_settings[_0xab2201(0x1b6)](),_0x517aa2=await supervisor_settings[_0xab2201(0x1b8)]();var _0x1470d2=_0x30f8f0['product'],_0x4eacbb='',_0x584eda;for(_0x584eda in _0x1470d2){var _0xd0a24e='FG';_0x30f8f0[_0xab2201(0x26d)]==_0xab2201(0x1d4)&&(_0xd0a24e='DG'),_0x4eacbb+='<tr>'+_0xab2201(0x21b)+_0x1470d2[_0x584eda][_0xab2201(0x21e)]+_0xab2201(0x180)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1470d2[_0x584eda][_0xab2201(0x1f9)]+_0xab2201(0x180)+_0xab2201(0x21b)+_0x1470d2[_0x584eda][_0xab2201(0x220)]+_0xab2201(0x180)+_0xab2201(0x21b)+_0x1470d2[_0x584eda][_0xab2201(0x1e4)]+'</td>'+_0xab2201(0x21b)+_0x1470d2[_0x584eda]['secondary_unit']+_0xab2201(0x180)+_0xab2201(0x21b)+_0x30f8f0['warehouse_name']+_0xab2201(0x180)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1470d2[_0x584eda]['room_name']+_0xab2201(0x180)+_0xab2201(0x21b)+_0xd0a24e+_0x1470d2[_0x584eda][_0xab2201(0x268)]+_0xab2201(0x180),_0xab2201(0x252);}let _0x34d316=nodemailer[_0xab2201(0x226)]({'host':_0x34e643[_0xab2201(0x18f)],'port':Number(_0x34e643[_0xab2201(0x19f)]),'secure':![],'auth':{'user':_0x34e643[_0xab2201(0x1a7)],'pass':_0x34e643[_0xab2201(0x1c1)]}}),_0x1420bc={'from':_0x34e643[_0xab2201(0x1a7)],'to':_0x517aa2[0x0][_0xab2201(0x1a4)],'subject':_0xab2201(0x186),'attachments':[{'filename':_0xab2201(0x1a2),'path':__dirname+'/../public'+_0xab2201(0x1af)+_0x31279c[0x0]['image'],'cid':_0xab2201(0x17c)}],'html':_0xab2201(0x257)+_0xab2201(0x208)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0xab2201(0x212)+'</div>'+_0xab2201(0x23a)+'<h2>\x20'+_0x31279c[0x0]['site_title']+_0xab2201(0x1da)+_0xab2201(0x1dc)+'</div>'+_0xab2201(0x1bb)+'<div>'+_0xab2201(0x26a)+_0xab2201(0x199)+_0x30f8f0['invoice']+'\x20'+_0xab2201(0x25e)+_0xab2201(0x250)+_0x30f8f0[_0xab2201(0x22a)]+'\x20'+_0xab2201(0x24f)+'</h5>'+'</div>'+_0xab2201(0x18b)+_0xab2201(0x241)+_0xab2201(0x270)+_0xab2201(0x261)+_0xab2201(0x1b1)+_0xab2201(0x269)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0xab2201(0x215)+_0xab2201(0x17a)+_0xab2201(0x1f2)+_0xab2201(0x1d8)+_0xab2201(0x252)+'</thead>'+_0xab2201(0x1ba)+'\x20'+_0x4eacbb+'\x20'+_0xab2201(0x225)+_0xab2201(0x24a)+_0xab2201(0x23a)+'<strong>\x20Regards\x20</strong>'+_0xab2201(0x1aa)+_0x31279c[0x0][_0xab2201(0x1cd)]+_0xab2201(0x1bf)+_0xab2201(0x1dc)+_0xab2201(0x1dc)+_0xab2201(0x1e8)};_0x34d316['sendMail'](_0x1420bc,function(_0x575920,_0x5c9fb7){var _0x58e51a=_0xab2201;_0x575920?(console[_0x58e51a(0x1db)](_0x575920),console[_0x58e51a(0x1db)]('Error\x20Occurs')):console['log'](_0x58e51a(0x240));});}catch(_0x326943){console['error'](_0x326943),_0x244706[_0xab2201(0x188)](0x1f4)[_0xab2201(0x1ef)]({'error':_0xab2201(0x256),'message':_0x326943[_0xab2201(0x247)]});}})[_0x247f25(0x1ab)](_0x5d1921=>{var _0x137f1b=_0x247f25;console[_0x137f1b(0x20f)](_0x5d1921),_0x244706[_0x137f1b(0x188)](0x1f4)[_0x137f1b(0x1ef)]({'error':_0x137f1b(0x233)});}),_0xf9c90c[_0x247f25(0x1d0)](_0x247f25(0x271),_0x247f25(0x1e2)),_0x244706[_0x247f25(0x185)](_0x247f25(0x22c));}catch(_0x472227){console[_0x247f25(0x1db)](_0x472227);}}),router[a0_0x267b14(0x207)]('/preview/:id',auth,async(_0x352e11,_0x242e15)=>{var _0x1855ae=a0_0x267b14;try{const {username:_0x1befca,email:_0x486296,role:_0x46555d}=_0x352e11[_0x1855ae(0x1c7)],_0x348d0d=_0x352e11['user'],_0x2b849b=await profile['findOne']({'email':_0x348d0d[_0x1855ae(0x1a7)]}),_0x6e1afb=await master_shop['find'](),_0x1bfb66=_0x352e11['params']['id'],_0x4b09e4=await purchases_finished['findById'](_0x1bfb66),_0x478388=await suppliers['find']({});let _0x276808;if(_0x348d0d['role']=='staff'){const _0x1e4ce3=await staff[_0x1855ae(0x1b6)]({'email':_0x348d0d[_0x1855ae(0x1a7)]});_0x276808=await warehouse[_0x1855ae(0x1b8)]({'status':_0x1855ae(0x242),'name':_0x1e4ce3[_0x1855ae(0x1c5)],'warehouse_category':_0x1855ae(0x23c)});}else _0x276808=await warehouse[_0x1855ae(0x192)]([{'$match':{'status':'Enabled','warehouse_category':_0x1855ae(0x23c)}},{'$group':{'_id':_0x1855ae(0x1ad),'name':{'$first':'$name'}}}]);const _0x35cce0=await product[_0x1855ae(0x1b8)]({}),_0x26f0ff=BayBinSelected(_0x4b09e4[_0x1855ae(0x26d)],_0x4b09e4['room']);let _0x1b3301=new Date(_0x4b09e4[_0x1855ae(0x1f1)]),_0x387ff7=('0'+_0x1b3301[_0x1855ae(0x213)]())[_0x1855ae(0x1cc)](-0x2),_0x948171=('0'+(_0x1b3301['getMonth']()+0x1))[_0x1855ae(0x1cc)](-0x2),_0xf97351=_0x1b3301['getFullYear'](),_0x94f023=_0xf97351+'-'+_0x948171+'-'+_0x387ff7;if(_0x6e1afb[0x0][_0x1855ae(0x201)]=='English\x20(US)'){var _0x397067=users['English'];console[_0x1855ae(0x1db)](_0x397067);}else{if(_0x6e1afb[0x0][_0x1855ae(0x201)]=='Hindi')var _0x397067=users[_0x1855ae(0x206)];else{if(_0x6e1afb[0x0]['language']==_0x1855ae(0x1b3))var _0x397067=users[_0x1855ae(0x1b3)];else{if(_0x6e1afb[0x0][_0x1855ae(0x201)]==_0x1855ae(0x189))var _0x397067=users['Spanish'];else{if(_0x6e1afb[0x0][_0x1855ae(0x201)]==_0x1855ae(0x1d1))var _0x397067=users[_0x1855ae(0x1d1)];else{if(_0x6e1afb[0x0][_0x1855ae(0x201)]==_0x1855ae(0x1c6))var _0x397067=users[_0x1855ae(0x216)];else{if(_0x6e1afb[0x0][_0x1855ae(0x201)]==_0x1855ae(0x22f))var _0x397067=users[_0x1855ae(0x22f)];else{if(_0x6e1afb[0x0]['language']==_0x1855ae(0x21f))var _0x397067=users[_0x1855ae(0x23f)];}}}}}}}_0x242e15[_0x1855ae(0x22e)](_0x1855ae(0x1f6),{'success':_0x352e11[_0x1855ae(0x1d0)]('success'),'errors':_0x352e11['flash'](_0x1855ae(0x187)),'role':_0x348d0d,'profile':_0x2b849b,'purchases':_0x4b09e4,'suppliers':_0x478388,'warehouse':_0x276808,'product':_0x35cce0,'master_shop':_0x6e1afb,'language':_0x397067,'ed_fullDate':_0x94f023,'dataSelected':_0x26f0ff});}catch(_0x3782d5){console['log'](_0x3782d5);}}),router[a0_0x267b14(0x207)]('/view/:id',auth,async(_0x5c539b,_0x237143)=>{var _0x56c24c=a0_0x267b14;try{const {username:_0x43ec6b,email:_0x362d93,role:_0x92d4d7}=_0x5c539b[_0x56c24c(0x1c7)],_0x5889e0=_0x5c539b[_0x56c24c(0x1c7)],_0x5c8b49=await profile[_0x56c24c(0x1b6)]({'email':_0x5889e0[_0x56c24c(0x1a7)]}),_0x212d5e=await master_shop[_0x56c24c(0x1b8)](),_0x1fac90=_0x5c539b[_0x56c24c(0x26f)]['id'],_0x1f4668=await purchases_finished[_0x56c24c(0x227)](_0x1fac90),_0x417577=await suppliers['find']({});let _0x273aae;if(_0x5889e0[_0x56c24c(0x253)]==_0x56c24c(0x258)){const _0x286be2=await staff[_0x56c24c(0x1b6)]({'email':_0x5889e0[_0x56c24c(0x1a7)]});_0x273aae=await warehouse['find']({'status':'Enabled','name':_0x286be2[_0x56c24c(0x1c5)],'warehouse_category':_0x56c24c(0x23c)});}else _0x273aae=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x56c24c(0x23c)}},{'$group':{'_id':_0x56c24c(0x1ad),'name':{'$first':_0x56c24c(0x1ad)}}}]);const _0x3406ee=await product[_0x56c24c(0x1b8)]({}),_0x40c580=BayBinSelected(_0x1f4668[_0x56c24c(0x26d)],_0x1f4668[_0x56c24c(0x266)]);let _0x3e0ef2=new Date(_0x1f4668['expiry_date']),_0x556ba8=('0'+_0x3e0ef2[_0x56c24c(0x213)]())[_0x56c24c(0x1cc)](-0x2),_0x47ef37=('0'+(_0x3e0ef2[_0x56c24c(0x248)]()+0x1))[_0x56c24c(0x1cc)](-0x2),_0x4beb11=_0x3e0ef2[_0x56c24c(0x1c4)](),_0x17cba4=_0x4beb11+'-'+_0x47ef37+'-'+_0x556ba8;if(_0x212d5e[0x0]['language']=='English\x20(US)'){var _0x8cb01d=users[_0x56c24c(0x1ea)];console[_0x56c24c(0x1db)](_0x8cb01d);}else{if(_0x212d5e[0x0]['language']==_0x56c24c(0x206))var _0x8cb01d=users['Hindi'];else{if(_0x212d5e[0x0][_0x56c24c(0x201)]==_0x56c24c(0x1b3))var _0x8cb01d=users['German'];else{if(_0x212d5e[0x0][_0x56c24c(0x201)]=='Spanish')var _0x8cb01d=users['Spanish'];else{if(_0x212d5e[0x0][_0x56c24c(0x201)]==_0x56c24c(0x1d1))var _0x8cb01d=users[_0x56c24c(0x1d1)];else{if(_0x212d5e[0x0][_0x56c24c(0x201)]=='Portuguese\x20(BR)')var _0x8cb01d=users[_0x56c24c(0x216)];else{if(_0x212d5e[0x0][_0x56c24c(0x201)]==_0x56c24c(0x22f))var _0x8cb01d=users[_0x56c24c(0x22f)];else{if(_0x212d5e[0x0]['language']=='Arabic\x20(ae)')var _0x8cb01d=users['Arabic'];}}}}}}}_0x237143[_0x56c24c(0x22e)](_0x56c24c(0x17d),{'success':_0x5c539b[_0x56c24c(0x1d0)]('success'),'errors':_0x5c539b['flash'](_0x56c24c(0x187)),'role':_0x5889e0,'profile':_0x5c8b49,'purchases':_0x1f4668,'suppliers':_0x417577,'warehouse':_0x273aae,'product':_0x3406ee,'master_shop':_0x212d5e,'language':_0x8cb01d,'ed_fullDate':_0x17cba4,'dataSelected':_0x40c580});}catch(_0xa948b3){console[_0x56c24c(0x1db)](_0xa948b3);}}),router['post'](a0_0x267b14(0x1a3),auth,async(_0x4e4250,_0x442558)=>{var _0x242e9d=a0_0x267b14;try{const _0x37b2d7=_0x4e4250[_0x242e9d(0x26f)]['id'],_0x3952a6=await purchases_finished[_0x242e9d(0x1b6)]({'_id':_0x4e4250[_0x242e9d(0x26f)]['id']}),_0x18695d=await warehouse['findOne']({'name':_0x3952a6['warehouse_name'],'room':_0x3952a6[_0x242e9d(0x266)]});_0x3952a6[_0x242e9d(0x194)][_0x242e9d(0x259)](_0x3bc414=>{var _0x1b2ac4=_0x242e9d;const _0x2fe39f=_0x18695d[_0x1b2ac4(0x222)][_0x1b2ac4(0x1e1)](_0x1f9c09=>{var _0x489247=_0x1b2ac4;_0x1f9c09[_0x489247(0x21e)]==_0x3bc414[_0x489247(0x21e)]&&_0x1f9c09[_0x489247(0x268)]==_0x3bc414[_0x489247(0x268)]&&(_0x1f9c09[_0x489247(0x190)]=parseInt(_0x1f9c09['product_stock'])-parseInt(_0x3bc414[_0x489247(0x220)]));});}),await _0x18695d[_0x242e9d(0x243)]();const {invoice:_0x33ef1a,suppliers:_0x5361a3,date:_0xc2b7e9,warehouse_name:_0x14d2fb,prod_name:_0x47a5f8,prod_code:_0x4fecd5,prod_qty:_0x52d09e,prod_unit:_0x307bab,prod_secondunit:_0x266719,prod_level:_0x48703e,prod_isle:_0x56be88,prod_pallet:_0xfd407f,note:_0x2a6a46,expiry_date:_0x12affa,batch_code:_0x5c0aa0,paid_amount:_0x1c7710,due_amount:_0x27c74d,Room_name:_0x13b1bc,primary_code:_0x18ceea,secondary_code:_0x50c3fa,PO_number:_0x1b237e,JO_number:_0x9f2657}=_0x4e4250[_0x242e9d(0x23b)];if(typeof _0x47a5f8==_0x242e9d(0x236))var _0x5c5699=[_0x4e4250['body'][_0x242e9d(0x1f4)]],_0xa50ff8=[_0x4e4250[_0x242e9d(0x23b)]['prod_code']],_0x50e219=[_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x23e)]],_0x46bbf5=[_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x20b)]],_0x5e0ee6=[_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x204)]],_0x108018=[_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x20d)]],_0x53e666=[_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x1b7)]],_0x394067=[_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x184)]],_0x1b4c1c=[_0x4e4250[_0x242e9d(0x23b)]['MaxStocks_data']],_0x5089af=[_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x177)]],_0x297e71=[_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x1f1)]];else var _0x5c5699=[..._0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x1f4)]],_0xa50ff8=[..._0x4e4250[_0x242e9d(0x23b)]['prod_code']],_0x50e219=[..._0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x23e)]],_0x46bbf5=[..._0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x20b)]],_0x5e0ee6=[..._0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x204)]],_0x108018=[..._0x4e4250['body']['prod_level']],_0x53e666=[..._0x4e4250['body'][_0x242e9d(0x1b7)]],_0x394067=[..._0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x184)]],_0x1b4c1c=[..._0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x1e0)]],_0x5089af=[..._0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x177)]],_0x297e71=[..._0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x1f1)]];const _0x4e23cb=_0x5c5699[_0x242e9d(0x1e1)](_0x2e269a=>{return _0x2e269a={'product_name':_0x2e269a};});_0xa50ff8[_0x242e9d(0x259)]((_0x55c939,_0x25d6b4)=>{var _0x32ae86=_0x242e9d;_0x4e23cb[_0x25d6b4][_0x32ae86(0x1f9)]=_0x55c939;}),_0x50e219[_0x242e9d(0x259)]((_0x29f7fc,_0xed731)=>{var _0x5f93d3=_0x242e9d;_0x4e23cb[_0xed731][_0x5f93d3(0x220)]=_0x29f7fc;}),_0x46bbf5[_0x242e9d(0x259)]((_0x3ca2b3,_0x5eb90c)=>{var _0x718515=_0x242e9d;_0x4e23cb[_0x5eb90c][_0x718515(0x1e4)]=_0x3ca2b3;}),_0x5e0ee6[_0x242e9d(0x259)]((_0xec8928,_0x2e8526)=>{var _0x58e32e=_0x242e9d;_0x4e23cb[_0x2e8526][_0x58e32e(0x181)]=_0xec8928;}),_0x108018[_0x242e9d(0x259)]((_0x17cc80,_0x410ce8)=>{var _0x36a4bb=_0x242e9d;_0x4e23cb[_0x410ce8][_0x36a4bb(0x268)]=_0x17cc80;}),_0x53e666[_0x242e9d(0x259)]((_0x1bb138,_0xa744e4)=>{var _0x1fd538=_0x242e9d;_0x4e23cb[_0xa744e4][_0x1fd538(0x1b7)]=_0x1bb138;}),_0x394067[_0x242e9d(0x259)]((_0x541639,_0x21aecb)=>{_0x4e23cb[_0x21aecb]['secondary_code']=_0x541639;}),_0x1b4c1c['forEach']((_0x41d3e7,_0xb6ec45)=>{var _0x2e2da2=_0x242e9d;_0x4e23cb[_0xb6ec45][_0x2e2da2(0x1ae)]=_0x41d3e7;}),_0x5089af['forEach']((_0x2fe0fc,_0x211e95)=>{_0x4e23cb[_0x211e95]['batch_code']=_0x2fe0fc;}),_0x297e71['forEach']((_0x18947b,_0x33ecdf)=>{var _0x41927b=_0x242e9d;_0x4e23cb[_0x33ecdf][_0x41927b(0x1f1)]=_0x18947b;});const _0x5a9bf7=_0x4e23cb[_0x242e9d(0x235)](_0x3b2b03=>_0x3b2b03[_0x242e9d(0x220)]!=='0'&&_0x3b2b03[_0x242e9d(0x220)]!=='');_0x3952a6[_0x242e9d(0x231)]=_0x33ef1a,_0x3952a6[_0x242e9d(0x1bd)]=_0x5361a3,_0x3952a6[_0x242e9d(0x22a)]=_0xc2b7e9,_0x3952a6[_0x242e9d(0x26d)]=_0x14d2fb,_0x3952a6[_0x242e9d(0x194)]=_0x5a9bf7,_0x3952a6[_0x242e9d(0x18a)]=_0x2a6a46,_0x3952a6['paid_amount']=_0x1c7710,_0x3952a6[_0x242e9d(0x1ff)]=_0x27c74d,_0x3952a6[_0x242e9d(0x266)]=_0x13b1bc,_0x3952a6[_0x242e9d(0x1e7)]=_0x1b237e,_0x3952a6[_0x242e9d(0x224)]=_0x9f2657;const _0x158deb=await _0x3952a6[_0x242e9d(0x243)](),_0x7c278b=await warehouse['findOne']({'name':_0x4e4250['body'][_0x242e9d(0x26d)],'room':_0x4e4250['body'][_0x242e9d(0x174)]});_0x3952a6['product']['forEach'](_0x5e606b=>{var _0x5abb08=_0x242e9d,_0xf857d9=0x0;const _0x2fff43=_0x7c278b['product_details'][_0x5abb08(0x1e1)](_0x1ef6ac=>{var _0x2118ee=_0x5abb08;_0x1ef6ac[_0x2118ee(0x21e)]==_0x5e606b[_0x2118ee(0x21e)]&&_0x1ef6ac[_0x2118ee(0x268)]==_0x5e606b[_0x2118ee(0x268)]&&(_0x1ef6ac[_0x2118ee(0x190)]=parseInt(_0x1ef6ac['product_stock'])+parseInt(_0x5e606b[_0x2118ee(0x220)]),_0xf857d9++);});_0xf857d9=='0'&&(_0x7c278b[_0x5abb08(0x222)]=_0x7c278b[_0x5abb08(0x222)][_0x5abb08(0x1cf)]({'product_name':_0x5e606b[_0x5abb08(0x21e)],'product_stock':_0x5e606b[_0x5abb08(0x220)],'primary_code':_0x5e606b[_0x5abb08(0x1b7)],'secondary_code':_0x5e606b[_0x5abb08(0x184)],'product_code':_0x5e606b[_0x5abb08(0x1f9)],'bay':_0x5e606b[_0x5abb08(0x268)],'maxProducts':_0x5e606b['maxStocks'],'unit':_0x5e606b[_0x5abb08(0x1e4)],'secondary_unit':_0x5e606b[_0x5abb08(0x181)],'expiry_date':_0x5e606b[_0x5abb08(0x1f1)]}));}),await _0x7c278b['save']();const _0x3232d4=await s_payment_data[_0x242e9d(0x1b6)]({'invoice':_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x231)]});if(_0x3232d4===null){}else console[_0x242e9d(0x1db)]('suppliers',_0x3232d4,_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x231)]),_0x3232d4[_0x242e9d(0x1bd)]=_0x4e4250[_0x242e9d(0x23b)][_0x242e9d(0x1bd)],await _0x3232d4[_0x242e9d(0x243)]();_0x4e4250['flash'](_0x242e9d(0x271),_0x242e9d(0x264)),_0x442558[_0x242e9d(0x185)](_0x242e9d(0x22c));}catch(_0x266513){console[_0x242e9d(0x1db)](_0x266513);}}),router[a0_0x267b14(0x198)]('/give_payment/:id',auth,async(_0xda7639,_0x23ca0d)=>{var _0x44c26b=a0_0x267b14;try{const _0x127c3a=_0xda7639[_0x44c26b(0x26f)]['id'],{invoice:_0x573b96,suppliers:_0x12129b,payable:_0x25ae76,due_amount:_0x5e74c7}=_0xda7639[_0x44c26b(0x23b)],_0x36a276=await purchases[_0x44c26b(0x227)](_0x127c3a);var _0x550913=_0x25ae76-_0x5e74c7;_0x36a276[_0x44c26b(0x20e)]=parseFloat(_0x36a276[_0x44c26b(0x20e)])+parseFloat(_0x5e74c7),_0x36a276[_0x44c26b(0x1ff)]=_0x550913;const _0x594ad1=await _0x36a276[_0x44c26b(0x243)]();console['log'](_0x594ad1);const _0x132733=await s_payment_data[_0x44c26b(0x1b6)]({'invoice':_0x573b96});_0x132733['amount']=_0x550913,await _0x132733['save']();let _0x4b8c53=new Date(),_0x25acc7=('0'+_0x4b8c53[_0x44c26b(0x213)]())[_0x44c26b(0x1cc)](-0x2),_0x5d2002=('0'+(_0x4b8c53[_0x44c26b(0x248)]()+0x1))[_0x44c26b(0x1cc)](-0x2),_0x5c5e95=_0x4b8c53[_0x44c26b(0x1c4)](),_0x4a7b38=_0x5c5e95+'-'+_0x5d2002+'-'+_0x25acc7;const _0x3df95f=new suppliers_payment({'invoice':_0x573b96,'date':_0x5c5e95+'-'+_0x5d2002+'-'+_0x25acc7,'suppliers':_0x12129b,'reason':_0x44c26b(0x1f3),'amount':_0x5e74c7}),_0x352511=await _0x3df95f[_0x44c26b(0x243)]();_0xda7639[_0x44c26b(0x1d0)]('success',_0x44c26b(0x25f)),_0x23ca0d['redirect'](_0x44c26b(0x1e6));}catch(_0x41266d){console[_0x44c26b(0x1db)](_0x41266d);}}),router[a0_0x267b14(0x207)]('/invoice/:id',auth,async(_0x2e4834,_0x76eb8f)=>{var _0x401088=a0_0x267b14;try{const {username:_0x5dc649,email:_0x414547,role:_0x18b71e}=_0x2e4834[_0x401088(0x1c7)],_0x146485=_0x2e4834[_0x401088(0x1c7)],_0x31675f=await profile[_0x401088(0x1b6)]({'email':_0x146485['email']}),_0x33e6f8=await master_shop[_0x401088(0x1b8)]();console[_0x401088(0x1db)](_0x401088(0x1b2),_0x33e6f8);const _0x29083d=_0x2e4834['params']['id'],_0x3bae8f=await purchases[_0x401088(0x227)](_0x29083d);console[_0x401088(0x1db)](_0x3bae8f);const _0x2f3305=await suppliers[_0x401088(0x1b6)]({'name':_0x3bae8f[_0x401088(0x1bd)]});console['log'](_0x2f3305);if(_0x33e6f8[0x0][_0x401088(0x201)]==_0x401088(0x223)){var _0x811973=users[_0x401088(0x1ea)];console[_0x401088(0x1db)](_0x811973);}else{if(_0x33e6f8[0x0][_0x401088(0x201)]==_0x401088(0x206))var _0x811973=users[_0x401088(0x206)];else{if(_0x33e6f8[0x0]['language']=='German')var _0x811973=users[_0x401088(0x1b3)];else{if(_0x33e6f8[0x0][_0x401088(0x201)]==_0x401088(0x189))var _0x811973=users[_0x401088(0x189)];else{if(_0x33e6f8[0x0][_0x401088(0x201)]==_0x401088(0x1d1))var _0x811973=users[_0x401088(0x1d1)];else{if(_0x33e6f8[0x0][_0x401088(0x201)]==_0x401088(0x1c6))var _0x811973=users['Portuguese'];else{if(_0x33e6f8[0x0]['language']==_0x401088(0x22f))var _0x811973=users[_0x401088(0x22f)];else{if(_0x33e6f8[0x0][_0x401088(0x201)]==_0x401088(0x21f))var _0x811973=users[_0x401088(0x23f)];}}}}}}}_0x76eb8f[_0x401088(0x22e)]('purchase_invoice',{'success':_0x2e4834[_0x401088(0x1d0)]('success'),'errors':_0x2e4834['flash'](_0x401088(0x187)),'role':_0x146485,'profile':_0x31675f,'master_shop':_0x33e6f8,'supplier':_0x2f3305,'purchase':_0x3bae8f,'language':_0x811973});}catch(_0x310bc1){console['log'](_0x310bc1);}}),router[a0_0x267b14(0x207)](a0_0x267b14(0x20a),auth,async(_0x392bde,_0x2c958e)=>{var _0x1cb884=a0_0x267b14;try{const {username:_0x17db82,email:_0xcd31ab,role:_0x350223}=_0x392bde[_0x1cb884(0x1c7)],_0x615ebc=_0x392bde[_0x1cb884(0x1c7)],_0x18656b=await profile[_0x1cb884(0x1b6)]({'email':_0x615ebc[_0x1cb884(0x1a7)]}),_0xa1bcf7=await master_shop[_0x1cb884(0x1b8)]();console[_0x1cb884(0x1db)](_0x1cb884(0x1b2),_0xa1bcf7);const _0x340ed5=_0x392bde['params']['id'];console[_0x1cb884(0x1db)](_0x340ed5);const _0x106529=await purchases_finished['findById'](_0x340ed5);console[_0x1cb884(0x1db)]('user_id',_0x106529);const _0x3d773e=await product[_0x1cb884(0x1b8)]({}),_0x2ac676=await warehouse[_0x1cb884(0x192)]([{'$match':{'name':_0x106529['warehouse_name'],'room':_0x106529[_0x1cb884(0x266)]}},{'$unwind':_0x1cb884(0x1f0)},{'$group':{'_id':_0x1cb884(0x1a0),'name':{'$first':_0x1cb884(0x1fd)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1cb884(0x211)},'type':{'$first':_0x1cb884(0x210)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1cb884(0x249)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1cb884(0x1d6)},'storage':{'$first':_0x1cb884(0x182)},'rack':{'$first':_0x1cb884(0x1eb)}}}]);console[_0x1cb884(0x1db)](_0x1cb884(0x1a5),_0x2ac676);let _0x570333;if(_0x615ebc[_0x1cb884(0x253)]==_0x1cb884(0x258)){const _0x3fc5d6=await staff[_0x1cb884(0x1b6)]({'email':_0x615ebc[_0x1cb884(0x1a7)]});_0x570333=await warehouse[_0x1cb884(0x1b8)]({'status':'Enabled','name':_0x3fc5d6['warehouse'],'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'});}else _0x570333=await warehouse[_0x1cb884(0x192)]([{'$match':{'status':_0x1cb884(0x242),'warehouse_category':'Finished\x20Goods','name':_0x1cb884(0x239)}},{'$group':{'_id':_0x1cb884(0x1ad),'name':{'$first':'$name'}}}]);if(_0xa1bcf7[0x0][_0x1cb884(0x201)]==_0x1cb884(0x223)){var _0x577ed6=users[_0x1cb884(0x1ea)];console[_0x1cb884(0x1db)](_0x577ed6);}else{if(_0xa1bcf7[0x0][_0x1cb884(0x201)]=='Hindi')var _0x577ed6=users[_0x1cb884(0x206)];else{if(_0xa1bcf7[0x0][_0x1cb884(0x201)]==_0x1cb884(0x1b3))var _0x577ed6=users['German'];else{if(_0xa1bcf7[0x0][_0x1cb884(0x201)]=='Spanish')var _0x577ed6=users[_0x1cb884(0x189)];else{if(_0xa1bcf7[0x0][_0x1cb884(0x201)]==_0x1cb884(0x1d1))var _0x577ed6=users[_0x1cb884(0x1d1)];else{if(_0xa1bcf7[0x0]['language']==_0x1cb884(0x1c6))var _0x577ed6=users[_0x1cb884(0x216)];else{if(_0xa1bcf7[0x0][_0x1cb884(0x201)]=='Chinese')var _0x577ed6=users['Chinese'];else{if(_0xa1bcf7[0x0][_0x1cb884(0x201)]==_0x1cb884(0x21f))var _0x577ed6=users[_0x1cb884(0x23f)];}}}}}}}_0x2c958e[_0x1cb884(0x22e)](_0x1cb884(0x26c),{'success':_0x392bde[_0x1cb884(0x1d0)]('success'),'errors':_0x392bde[_0x1cb884(0x1d0)](_0x1cb884(0x187)),'role':_0x615ebc,'profile':_0x18656b,'user':_0x106529,'stock':_0x2ac676,'master_shop':_0xa1bcf7,'product':_0x3d773e,'language':_0x577ed6,'warehouse':_0x570333});}catch(_0x39eac6){console[_0x1cb884(0x1db)](_0x39eac6);}}),router[a0_0x267b14(0x198)](a0_0x267b14(0x20a),auth,async(_0x362396,_0x8e76f2)=>{var _0x1348d0=a0_0x267b14;try{const {invoice:_0x4daafb,date:_0x413d6c,warehouse_name:_0x2a5670,Room_name:_0xfd7bff,product_name:_0x399c62,purchase_quantity:_0x3c58f5,stocks:_0x28443c,return_qty:_0x197b8b,note:_0x37fce6,level:_0x50c01a,isle:_0x3d1903,pallet:_0x50c094,to_warehouse_name:_0x4ae180,to_Room_name:_0x6f0c87}=_0x362396[_0x1348d0(0x23b)],_0x53ef60=await purchases_finished[_0x1348d0(0x1b6)]({'_id':_0x362396[_0x1348d0(0x26f)]['id']}),_0xb0a4c1=await warehouse[_0x1348d0(0x1b6)]({'name':_0x2a5670,'room':_0xfd7bff,'warehouse_category':_0x1348d0(0x23c)});if(typeof _0x399c62=='string')var _0x827501=[_0x362396['body']['product_name']],_0x11d567=[_0x362396[_0x1348d0(0x23b)][_0x1348d0(0x245)]],_0x4af8ed=[_0x362396[_0x1348d0(0x23b)][_0x1348d0(0x22b)]],_0x3bd839=[_0x362396[_0x1348d0(0x23b)][_0x1348d0(0x1cb)]],_0x1a7bf3=[_0x362396['body'][_0x1348d0(0x22d)]],_0x2899f4=[_0x362396[_0x1348d0(0x23b)]['product_code_hide']],_0x5dae43=[_0x362396['body']['primary_code_hide']],_0x16c2ef=[_0x362396[_0x1348d0(0x23b)][_0x1348d0(0x1d2)]];else var _0x827501=[..._0x362396[_0x1348d0(0x23b)][_0x1348d0(0x21e)]],_0x11d567=[..._0x362396[_0x1348d0(0x23b)][_0x1348d0(0x245)]],_0x4af8ed=[..._0x362396[_0x1348d0(0x23b)][_0x1348d0(0x22b)]],_0x3bd839=[..._0x362396[_0x1348d0(0x23b)][_0x1348d0(0x1cb)]],_0x1a7bf3=[..._0x362396[_0x1348d0(0x23b)][_0x1348d0(0x22d)]],_0x2899f4=[..._0x362396[_0x1348d0(0x23b)][_0x1348d0(0x221)]],_0x5dae43=[..._0x362396[_0x1348d0(0x23b)]['primary_code_hide']],_0x16c2ef=[..._0x362396[_0x1348d0(0x23b)]['secondary_code_hide']];const _0x1a7fb2=_0x827501[_0x1348d0(0x1e1)](_0x3285c8=>{return _0x3285c8={'product_name':_0x3285c8};});_0x11d567[_0x1348d0(0x259)]((_0x5ee032,_0x1502aa)=>{var _0x17f06c=_0x1348d0;_0x1a7fb2[_0x1502aa][_0x17f06c(0x245)]=_0x5ee032;}),_0x4af8ed[_0x1348d0(0x259)]((_0xfe358,_0x126988)=>{var _0xe7987a=_0x1348d0;_0x1a7fb2[_0x126988][_0xe7987a(0x265)]=_0xfe358;}),_0x3bd839[_0x1348d0(0x259)]((_0x5ebdba,_0x6a9eb8)=>{var _0x163efd=_0x1348d0;_0x1a7fb2[_0x6a9eb8][_0x163efd(0x1cb)]=_0x5ebdba;}),_0x1a7bf3['forEach']((_0x3635c3,_0x5c1ca2)=>{var _0x27317f=_0x1348d0;_0x1a7fb2[_0x5c1ca2][_0x27317f(0x268)]=_0x3635c3;}),_0x2899f4[_0x1348d0(0x259)]((_0x21ee8f,_0x3ba7c3)=>{var _0x500cde=_0x1348d0;_0x1a7fb2[_0x3ba7c3][_0x500cde(0x1f9)]=_0x21ee8f;}),_0x5dae43[_0x1348d0(0x259)]((_0x389a5d,_0x405d31)=>{var _0x1ee646=_0x1348d0;_0x1a7fb2[_0x405d31][_0x1ee646(0x1b7)]=_0x389a5d;}),_0x16c2ef[_0x1348d0(0x259)]((_0x117152,_0x481e5a)=>{var _0x4f48af=_0x1348d0;_0x1a7fb2[_0x481e5a][_0x4f48af(0x184)]=_0x117152;}),_0x1a7fb2['forEach'](_0x153f50=>{var _0x5bfccc=_0x1348d0;console[_0x5bfccc(0x1db)](_0x153f50);const _0x251711=_0xb0a4c1['product_details']['map'](_0x28152d=>{var _0x4e8e37=_0x5bfccc;_0x28152d['product_name']==_0x153f50['product_name']&&_0x28152d[_0x4e8e37(0x268)]==_0x153f50[_0x4e8e37(0x268)]&&(console[_0x4e8e37(0x1db)](parseInt(_0x28152d[_0x4e8e37(0x190)])+'\x20<>\x20'+parseInt(_0x153f50['return_qty'])),_0x28152d[_0x4e8e37(0x190)]=parseInt(_0x28152d[_0x4e8e37(0x190)])-parseInt(_0x153f50['return_qty']));});}),await _0xb0a4c1[_0x1348d0(0x243)]();var _0x5625d6=0x0;_0x1a7fb2[_0x1348d0(0x259)](_0x4e6ae0=>{var _0x2c2750=_0x1348d0;(parseInt(_0x4e6ae0[_0x2c2750(0x245)])<parseInt(_0x4e6ae0[_0x2c2750(0x1cb)])||parseInt(_0x4e6ae0[_0x2c2750(0x265)])<parseInt(_0x4e6ae0[_0x2c2750(0x1cb)]))&&_0x5625d6++;});if(_0x5625d6!=0x0)return _0x362396[_0x1348d0(0x1d0)](_0x1348d0(0x187),_0x1348d0(0x1dd)),_0x8e76f2[_0x1348d0(0x185)](_0x1348d0(0x20c));const _0x19fbbd=new purchases_return_finished({'invoice':_0x4daafb,'suppliers':_0x362396['body'][_0x1348d0(0x1bd)],'date':_0x413d6c,'warehouse_name':_0x2a5670,'return_product':_0x1a7fb2,'note':_0x37fce6,'room':_0xfd7bff,'to_warehouse_name':_0x4ae180,'to_room':_0x6f0c87}),_0x205f44=await _0x19fbbd['save'](),_0x4c6812=await purchases_return_finished[_0x1348d0(0x1b6)]({'invoice':_0x4daafb}),_0x267af8=await warehouse['findOne']({'name':_0x4ae180,'room':_0x6f0c87,'warehouse_category':_0x1348d0(0x23c)});_0x4c6812['return_product'][_0x1348d0(0x259)](_0x4a2e67=>{var _0x8eed01=_0x1348d0,_0x24542b=0x0;const _0x4fc6aa=_0x267af8[_0x8eed01(0x222)][_0x8eed01(0x1e1)](_0x2d8da2=>{var _0x2b44d0=_0x8eed01;console['log'](_0x2d8da2['product_name']+'=='+_0x4a2e67[_0x2b44d0(0x21e)]+'&&'+_0x2d8da2[_0x2b44d0(0x268)]+'=='+_0x4a2e67['bay']),_0x2d8da2[_0x2b44d0(0x21e)]==_0x4a2e67['product_name']&&_0x2d8da2[_0x2b44d0(0x268)]==_0x4a2e67['bay']&&(_0x2d8da2[_0x2b44d0(0x190)]=parseInt(_0x2d8da2[_0x2b44d0(0x190)])-parseInt(_0x4a2e67[_0x2b44d0(0x1cb)]),_0x24542b++);});_0x24542b=='0'&&(_0x267af8[_0x8eed01(0x222)]=_0x267af8['product_details']['concat']({'product_name':_0x4a2e67['product_name'],'product_stock':_0x4a2e67['return_qty'],'primary_code':_0x4a2e67['primary_code'],'secondary_code':_0x4a2e67['secondary_code'],'product_code':_0x4a2e67[_0x8eed01(0x1f9)],'bay':_0x4a2e67[_0x8eed01(0x268)],'maxProducts':0xf423f}));}),await _0x267af8[_0x1348d0(0x243)]();const _0x26b8d5=await purchases_finished['findOne']({'invoice':_0x4daafb});_0x26b8d5[_0x1348d0(0x191)]=_0x1348d0(0x1a8);const _0x5580f1=await _0x26b8d5[_0x1348d0(0x243)](),_0x112209=new s_payment_data({'invoice':_0x4daafb,'suppliers':_0x362396[_0x1348d0(0x23b)][_0x1348d0(0x1bd)],'reason':_0x1348d0(0x234)});await _0x112209[_0x1348d0(0x243)]();const _0x5e8ff6=await master_shop[_0x1348d0(0x1b8)](),_0x17d0e9=await email_settings[_0x1348d0(0x1b6)](),_0x57833a=await suppliers[_0x1348d0(0x1b6)]({'name':_0x362396['body'][_0x1348d0(0x1bd)]});_0x5e8ff6[0x0][_0x1348d0(0x21c)]==0x1?(right_currency=_0x5e8ff6[0x0][_0x1348d0(0x18d)],left_currency=''):(right_currency='',left_currency=_0x5e8ff6[0x0][_0x1348d0(0x18d)]);var _0x30337d=_0x827501,_0x185faa=_0x3bd839,_0x92702b='',_0x594df8;for(_0x594df8 in _0x30337d){_0x92702b+=_0x1348d0(0x270)+_0x1348d0(0x21b)+_0x30337d[_0x594df8]+_0x1348d0(0x180)+_0x1348d0(0x21b)+_0x185faa[_0x594df8]+'</td>'+_0x1348d0(0x252);}let _0x5f5d20=nodemailer[_0x1348d0(0x226)]({'service':_0x1348d0(0x229),'auth':{'user':_0x17d0e9[_0x1348d0(0x1a7)],'pass':_0x17d0e9[_0x1348d0(0x1c1)]}}),_0x555d2b={'from':_0x17d0e9[_0x1348d0(0x1a7)],'to':_0x57833a[_0x1348d0(0x1a7)],'subject':_0x1348d0(0x1b0),'attachments':[{'filename':_0x1348d0(0x1a2),'path':__dirname+'/../public'+_0x1348d0(0x1af)+_0x5e8ff6[0x0][_0x1348d0(0x1ee)],'cid':_0x1348d0(0x17c)}],'html':_0x1348d0(0x257)+'<html><head><title></title>'+_0x1348d0(0x228)+_0x1348d0(0x23a)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1348d0(0x23a)+_0x1348d0(0x212)+_0x1348d0(0x1dc)+'<div>'+_0x1348d0(0x21d)+_0x5e8ff6[0x0][_0x1348d0(0x1cd)]+'\x20</h2>'+'</div>'+_0x1348d0(0x1dc)+_0x1348d0(0x1bb)+'<div>'+_0x1348d0(0x26a)+_0x1348d0(0x199)+_0x4daafb+'\x20'+_0x1348d0(0x25e)+_0x1348d0(0x250)+_0x413d6c+'\x20'+_0x1348d0(0x24f)+_0x1348d0(0x1bf)+_0x1348d0(0x1dc)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1348d0(0x241)+_0x1348d0(0x270)+_0x1348d0(0x261)+_0x1348d0(0x1a1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x1348d0(0x25c)+_0x1348d0(0x252)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x92702b+'\x20'+_0x1348d0(0x225)+_0x1348d0(0x24a)+_0x1348d0(0x23a)+_0x1348d0(0x255)+'<h5>'+_0x5e8ff6[0x0][_0x1348d0(0x1cd)]+'</h5>'+_0x1348d0(0x1dc)+_0x1348d0(0x1dc)+_0x1348d0(0x1e8)};_0x5f5d20[_0x1348d0(0x19b)](_0x555d2b,function(_0x18e9b5,_0x51ff8f){var _0xecc919=_0x1348d0;_0x18e9b5?console[_0xecc919(0x1db)](_0xecc919(0x200)):console[_0xecc919(0x1db)](_0xecc919(0x240));}),_0x362396['flash'](_0x1348d0(0x271),_0x1348d0(0x1d3)),_0x8e76f2[_0x1348d0(0x185)](_0x1348d0(0x22c));}catch(_0x368665){_0x8e76f2[_0x1348d0(0x188)](0xc8)[_0x1348d0(0x1ef)]({'message':_0x368665[_0x1348d0(0x247)]});}}),router[a0_0x267b14(0x207)](a0_0x267b14(0x19c),auth,async(_0x136799,_0x57781c)=>{var _0x2380a7=a0_0x267b14;try{const {username:_0x26a6ff,email:_0x135b21,role:_0x211427}=_0x136799[_0x2380a7(0x1c7)],_0x1b2be=_0x136799[_0x2380a7(0x1c7)],_0x4f5c54=await profile[_0x2380a7(0x1b6)]({'email':_0x1b2be[_0x2380a7(0x1a7)]}),_0x264eb8=await master_shop[_0x2380a7(0x1b8)](),_0x4206ba=_0x136799[_0x2380a7(0x26f)]['id'],_0x45e53c=await purchases_finished[_0x2380a7(0x227)](_0x4206ba);if(_0x264eb8[0x0][_0x2380a7(0x201)]==_0x2380a7(0x223))var _0x1ff0f3=users[_0x2380a7(0x1ea)];else{if(_0x264eb8[0x0][_0x2380a7(0x201)]=='Hindi')var _0x1ff0f3=users[_0x2380a7(0x206)];else{if(_0x264eb8[0x0][_0x2380a7(0x201)]==_0x2380a7(0x1b3))var _0x1ff0f3=users[_0x2380a7(0x1b3)];else{if(_0x264eb8[0x0][_0x2380a7(0x201)]=='Spanish')var _0x1ff0f3=users[_0x2380a7(0x189)];else{if(_0x264eb8[0x0][_0x2380a7(0x201)]==_0x2380a7(0x1d1))var _0x1ff0f3=users[_0x2380a7(0x1d1)];else{if(_0x264eb8[0x0]['language']==_0x2380a7(0x1c6))var _0x1ff0f3=users[_0x2380a7(0x216)];else{if(_0x264eb8[0x0][_0x2380a7(0x201)]==_0x2380a7(0x22f))var _0x1ff0f3=users[_0x2380a7(0x22f)];else{if(_0x264eb8[0x0]['language']=='Arabic\x20(ae)')var _0x1ff0f3=users[_0x2380a7(0x23f)];}}}}}}}_0x57781c[_0x2380a7(0x22e)]('all_purchases_barcode',{'success':_0x136799[_0x2380a7(0x1d0)]('success'),'errors':_0x136799[_0x2380a7(0x1d0)]('errors'),'role':_0x1b2be,'profile':_0x4f5c54,'alldata':_0x45e53c,'master_shop':_0x264eb8,'language':_0x1ff0f3}),console['log'](alldata);}catch(_0x2b113f){console[_0x2380a7(0x1db)](_0x2b113f);}}),router[a0_0x267b14(0x198)]('/barcode_scanner',async(_0x3bbf06,_0x52d9d4)=>{var _0x3b7803=a0_0x267b14;const {product_code:_0x737767}=_0x3bbf06[_0x3b7803(0x23b)];var _0x5aae70;const _0x157616=await product[_0x3b7803(0x192)]([{'$match':{'primary_code':_0x737767,'product_category':_0x3b7803(0x23c)}},{'$group':{'_id':'$_id','name':{'$first':_0x3b7803(0x1ad)},'category':{'$first':_0x3b7803(0x218)},'brand':{'$first':'$brand'},'unit':{'$first':_0x3b7803(0x1c2)},'alertquantity':{'$first':_0x3b7803(0x25d)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x3b7803(0x217)},'secondary_code':{'$first':_0x3b7803(0x1c3)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x3b7803(0x251)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3b7803(0x1e5)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x355a02=await product[_0x3b7803(0x192)]([{'$match':{'secondary_code':_0x737767}},{'$group':{'_id':_0x3b7803(0x1f8),'name':{'$first':_0x3b7803(0x1ad)},'category':{'$first':'$category'},'brand':{'$first':_0x3b7803(0x1fa)},'unit':{'$first':_0x3b7803(0x1c2)},'alertquantity':{'$first':_0x3b7803(0x25d)},'product_code':{'$first':_0x3b7803(0x24d)},'primary_code':{'$first':_0x3b7803(0x217)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x3b7803(0x1ec)},'maxProdPerUnit':{'$first':_0x3b7803(0x251)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x157616['length']>0x0)_0x5aae70=_0x157616;else _0x355a02['length']>0x0&&(_0x5aae70=_0x355a02);_0x52d9d4['json'](_0x5aae70);}),router[a0_0x267b14(0x198)]('/CheckingWarehouse',async(_0x42d6c7,_0x52c2c1)=>{var _0xa5bf42=a0_0x267b14;const {productCode:_0x4d7d9d,bay:_0x310a57,warehouses:_0x34b2ac,room:_0x2089fb}=_0x42d6c7[_0xa5bf42(0x23b)];console['log'](_0x42d6c7['body']);try{const _0x44de47=await warehouse[_0xa5bf42(0x192)]([{'$match':{'name':_0x34b2ac,'room':_0x2089fb}},{'$unwind':_0xa5bf42(0x1f0)},{'$match':{'product_details.bay':parseInt(_0x310a57)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xa5bf42(0x19d)},'bay':{'$first':_0xa5bf42(0x1e3)},'maxProducts':{'$first':_0xa5bf42(0x17e)}}}]);_0x52c2c1[_0xa5bf42(0x188)](0xc8)[_0xa5bf42(0x1ef)](_0x44de47);}catch(_0x4dd78d){_0x52c2c1[_0xa5bf42(0x188)](0x194)[_0xa5bf42(0x1ef)]({'message':_0x4dd78d[_0xa5bf42(0x247)]});}}),module['exports']=router;