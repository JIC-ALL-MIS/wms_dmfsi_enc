var a0_0x29ec7b=a0_0x30aa;function a0_0x5bdc(){var _0x2ac104=['host','Paid\x20For\x20Purchase','$product_details.rack','Room_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','exports','$paid_amount','$product_details.product_stock','errors','quantity','RoomAssign','padStart','_id','Purchase\x20Return','<tr>','expiry_date','prod_cat','Finished\x20Goods','$product_details.secondary_code','getFullYear','date','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','add_purchases\x20error','prod_invoice','$product_details.product_code','/view/:id','/all_purchases_finished/view','3935240YVUWRt','all_purchases_barcode','port','toString','<h5\x20style=\x22text-align:\x20left;\x22>','room','Purchase\x20Mail','\x20Order\x20Number\x20:\x20','Return\x20Goods','slice','gmail','edit_purchases_finished','standard_unit','paid_amount','Router','<html><head><title></title>','/preview/:id','secondary_code','</thead>','sendMail','error','flash','post','560602AbEgeI','11JCylWu','primary_code_hide','Rack\x202','MaxStocks_data','</div>','success','/invoice/:id','$product_details.bin','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','product_code_hide','concat','Spanish','$product_details.product_name','purchases\x20item\x20return\x20successfull','<hr\x20class=\x22my-3\x22>','French','$due_amount','Purchase\x20Return\x20Mail','status','</h5>','JO_number','secondary_code_hide','</tr>','prod_unit','staff','prod_level','Email\x20sent\x20successfully','map','/upload/','QA\x20Warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','German','English\x20(US)','random','return_data','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$suppliers','Chinese','Rack\x201','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','role','12OVMcEI','all_purchases_finished','product_stock','Portuguese\x20(BR)','stocks','</body></html>','3LlgoHw','/view','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$primary_code','message','<!DOCTYPE\x20html>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_details','currency','$product_details','An\x20error\x20occurred\x20while\x20saving\x20data.','product_code','batch_code','$secondary_unit','$product.type','</tbody>','$room','prod_qty','<div>','warehouse_name','$product_details.type','prod_name','$batch_code','user','</td>','<strong>\x20Regards\x20</strong>','getDate','render','express','stock_data','Portuguese','<span\x20style=\x22float:\x20right;\x22>','$name','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','floor','1937380VCyjRD','site_title','<tbody\x20style=\x22text-align:\x20center;\x22>','1698088SCUCCx','string','edit_purchases_finished_view','purchase_quantity','note','$invoice','$product','../public/language/languages.json','$product_details.storage','$category','production_date','$alertquantity','876736jtSnEo','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Hindi','table\x20page','length','../middleware/auth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Ambient','True','DRY\x20GOODS','due_amount','ejs','abs','$suppliers_docs','$product.bay','Arabic\x20(ae)','$unit','user_id','<h2>\x20','email','</table>','</span>','1kjPsqk','prod_Qty','$brand','\x20Order\x20Date\x20:\x20','$product_code','save','/view/add_purchases','product_date','$product_details.primary_code','createTransport','nodemailer','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.bay','json','then','$secondary_code','body','maxStocks','amount','currency_placement','<h5>','forEach','\x20<>\x20','password','../models/all_models','payment\x20successfull','maxperunit','updateOne','Error\x20Occurs','getMonth','$maxStocks','POnumber','/all_purchases/view','invoice','filter','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','purchase\x20data\x20add\x20successfully','get','INCF-','add_purchases_finished','max_product_unit','$warehouse_name','/../public','9141363ZnDRYC','bay','Error\x20occurred\x20while\x20processing\x20product:','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_name','findOne','redirect','prod_secondunit','prod_primunit','/give_payment/:id','$product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','English','secondary_unit','$product_details.maxProducts','findById','$return_data','catch','Enabled','/barcode/:id','prod_code','warehouse','room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','16390230eWirdX','Arabic','image','return_qty','product_cat','logo','primary_code','Logo.png','/barcode_scanner','$_id','find','$maxProdPerUnit','master','params','suppliers','$note','stock_quantity','aggregate'];a0_0x5bdc=function(){return _0x2ac104;};return a0_0x5bdc();}(function(_0x357fd4,_0x509d2f){var _0x4d3227=a0_0x30aa,_0x3abbf9=_0x357fd4();while(!![]){try{var _0x337d95=parseInt(_0x4d3227(0x14c))/0x1*(-parseInt(_0x4d3227(0x1d6))/0x2)+parseInt(_0x4d3227(0x208))/0x3*(parseInt(_0x4d3227(0x22f))/0x4)+parseInt(_0x4d3227(0x22c))/0x5+parseInt(_0x4d3227(0x202))/0x6*(parseInt(_0x4d3227(0x23b))/0x7)+parseInt(_0x4d3227(0x1bf))/0x8+parseInt(_0x4d3227(0x178))/0x9+parseInt(_0x4d3227(0x190))/0xa*(-parseInt(_0x4d3227(0x1d7))/0xb);if(_0x337d95===_0x509d2f)break;else _0x3abbf9['push'](_0x3abbf9['shift']());}catch(_0x4af21c){_0x3abbf9['push'](_0x3abbf9['shift']());}}}(a0_0x5bdc,0x9ee1e));function a0_0x30aa(_0x3b5f26,_0x44a53f){var _0x5bdc32=a0_0x5bdc();return a0_0x30aa=function(_0x30aa22,_0x12c415){_0x30aa22=_0x30aa22-0x147;var _0x620e37=_0x5bdc32[_0x30aa22];return _0x620e37;},a0_0x30aa(_0x3b5f26,_0x44a53f);}const express=require(a0_0x29ec7b(0x225)),app=express(),router=express[a0_0x29ec7b(0x1cd)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x29ec7b(0x165)),auth=require(a0_0x29ec7b(0x240)),nodemailer=require(a0_0x29ec7b(0x156));var ejs=require(a0_0x29ec7b(0x246));const path=require('path'),users=require(a0_0x29ec7b(0x236));router[a0_0x29ec7b(0x172)](a0_0x29ec7b(0x209),auth,async(_0x352f44,_0x50a0f3)=>{var _0x159112=a0_0x29ec7b;try{const {username:_0x1385dd,email:_0x142f5f,role:_0x5ac868}=_0x352f44[_0x159112(0x220)],_0x17cb79=_0x352f44[_0x159112(0x220)],_0x1df6be=await profile[_0x159112(0x17d)]({'email':_0x17cb79[_0x159112(0x149)]}),_0x55d6bb=await staff[_0x159112(0x17d)]({'email':_0x17cb79[_0x159112(0x149)]});if(_0x17cb79['role']=='staff'){const _0x290b26=await staff[_0x159112(0x17d)]({'email':_0x17cb79[_0x159112(0x149)]});}const _0x5067ca=await master_shop[_0x159112(0x19a)]();let _0x19ee60;if(_0x17cb79[_0x159112(0x201)]==_0x159112(0x1f0)){const _0x54dbb3=await staff[_0x159112(0x17d)]({'email':_0x17cb79[_0x159112(0x149)]});_0x19ee60=await purchases_finished[_0x159112(0x1a1)]([{'$match':{'warehouse_name':_0x54dbb3[_0x159112(0x18d)]}},{'$lookup':{'from':'suppliers','localField':_0x159112(0x19e),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x159112(0x248)},{'$unwind':_0x159112(0x235)},{'$group':{'_id':_0x159112(0x199),'invoice':{'$first':_0x159112(0x234)},'suppliers':{'$first':_0x159112(0x1fc)},'date':{'$first':_0x159112(0x20a)},'warehouse_name':{'$first':_0x159112(0x176)},'room':{'$first':_0x159112(0x219)},'product':{'$push':_0x159112(0x235)},'note':{'$first':_0x159112(0x19f)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x159112(0x1e8)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x159112(0x21f)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x159112(0x248)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x159112(0x249)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x159112(0x217)},'floorlevel':{'$addToSet':_0x159112(0x182)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x19ee60=await purchases_finished[_0x159112(0x1a1)]([{'$unwind':_0x159112(0x235)},{'$group':{'_id':'$_id','invoice':{'$first':_0x159112(0x234)},'suppliers':{'$first':_0x159112(0x1fc)},'date':{'$first':_0x159112(0x20a)},'warehouse_name':{'$first':_0x159112(0x176)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x159112(0x19f)},'paid_amount':{'$first':_0x159112(0x1a8)},'due_amount':{'$first':_0x159112(0x1e8)},'return_data':{'$first':_0x159112(0x188)},'batch_code':{'$first':_0x159112(0x21f)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x159112(0x248)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x159112(0x249)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x159112(0x217)},'floorlevel':{'$addToSet':_0x159112(0x182)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x5067ca[0x0][_0x159112(0x1b7)]==_0x159112(0x1f8))var _0x10289e=users[_0x159112(0x184)];else{if(_0x5067ca[0x0][_0x159112(0x1b7)]==_0x159112(0x23d))var _0x10289e=users[_0x159112(0x23d)];else{if(_0x5067ca[0x0][_0x159112(0x1b7)]=='German')var _0x10289e=users[_0x159112(0x1f7)];else{if(_0x5067ca[0x0][_0x159112(0x1b7)]=='Spanish')var _0x10289e=users[_0x159112(0x1e3)];else{if(_0x5067ca[0x0]['language']==_0x159112(0x1e7))var _0x10289e=users['French'];else{if(_0x5067ca[0x0][_0x159112(0x1b7)]==_0x159112(0x205))var _0x10289e=users[_0x159112(0x227)];else{if(_0x5067ca[0x0][_0x159112(0x1b7)]==_0x159112(0x1fd))var _0x10289e=users[_0x159112(0x1fd)];else{if(_0x5067ca[0x0][_0x159112(0x1b7)]==_0x159112(0x24a))var _0x10289e=users[_0x159112(0x191)];}}}}}}}_0x50a0f3[_0x159112(0x224)](_0x159112(0x203),{'success':_0x352f44[_0x159112(0x1d4)](_0x159112(0x1dc)),'errors':_0x352f44[_0x159112(0x1d4)](_0x159112(0x1aa)),'purchases':_0x19ee60,'role':_0x17cb79,'profile':_0x1df6be,'master_shop':_0x5067ca,'language':_0x10289e});}catch(_0x4f7e52){console[_0x159112(0x1df)](_0x159112(0x23e),_0x4f7e52),_0x50a0f3['status'](0xc8)[_0x159112(0x15a)]({'message':_0x4f7e52['message']});}});function BayBinSelected(_0x25588c,_0x45fa6d){var _0xb7de78=a0_0x29ec7b,_0x2115dc=[],_0x440aaa=[];if(_0x25588c==_0xb7de78(0x244)){switch(_0x45fa6d){case _0xb7de78(0x1fe):_0x2115dc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0xb7de78(0x1d9):_0x2115dc=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x440aaa=['DG'];}else{if(_0x25588c=='FROZEN\x20GOODS'){switch(_0x45fa6d){case _0xb7de78(0x1fe):_0x2115dc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0xb7de78(0x1d9):_0x2115dc=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x440aaa=['FG'];}}return{'levels':_0x2115dc,'identify':_0x440aaa};}async function getRandom8DigitNumber(){var _0x5b05f4=a0_0x29ec7b;const _0x10be3f=0x989680,_0x3ede2d=0x5f5e0ff,_0x126eb1=Math[_0x5b05f4(0x22b)](Math[_0x5b05f4(0x1f9)]()*(_0x3ede2d-_0x10be3f+0x1))+_0x10be3f;var _0x5b734c;const _0x59e69b=await purchases_finished[_0x5b05f4(0x17d)]({'invoice':_0x5b05f4(0x173)+_0x126eb1});return _0x59e69b&&_0x59e69b[_0x5b05f4(0x23f)]>0x0?_0x5b734c=_0x5b05f4(0x173)+_0x126eb1:_0x5b734c=_0x5b05f4(0x173)+_0x126eb1,_0x5b734c;}router[a0_0x29ec7b(0x172)](a0_0x29ec7b(0x152),auth,async(_0x46c6f3,_0x247086)=>{var _0x2ddf49=a0_0x29ec7b;try{const {username:_0x5a7569,email:_0x360a4b,role:_0x18b6fd}=_0x46c6f3['user'],_0x39f86f=_0x46c6f3[_0x2ddf49(0x220)],_0x5cc29d=await profile[_0x2ddf49(0x17d)]({'email':_0x39f86f[_0x2ddf49(0x149)]}),_0xaa8fcc=await master_shop[_0x2ddf49(0x19a)](),_0x31b9ea=await staff['findOne']({'email':_0x39f86f[_0x2ddf49(0x149)]}),_0x19b1bf=await suppliers[_0x2ddf49(0x19a)]({});let _0x2af969;if(_0x39f86f['role']==_0x2ddf49(0x1f0)){const _0x439890=await staff['findOne']({'email':_0x39f86f[_0x2ddf49(0x149)]});_0x2af969=await warehouse['aggregate']([{'$match':{'status':_0x2ddf49(0x18a),'name':_0x439890[_0x2ddf49(0x18d)],'warehouse_category':_0x2ddf49(0x1b3)}},{'$group':{'_id':_0x2ddf49(0x229),'name':{'$first':_0x2ddf49(0x229)}}}]);}else _0x2af969=await warehouse[_0x2ddf49(0x1a1)]([{'$match':{'status':_0x2ddf49(0x18a),'warehouse_category':_0x2ddf49(0x1b3),'name':{'$ne':_0x2ddf49(0x1f5)}}},{'$group':{'_id':_0x2ddf49(0x229),'name':{'$first':_0x2ddf49(0x229)}}}]);const _0x5b9209=await product[_0x2ddf49(0x19a)]({}),_0x4e6630=await warehouse[_0x2ddf49(0x19a)]({'status':_0x2ddf49(0x18a)}),_0x356201=await purchases_finished[_0x2ddf49(0x19a)]({}),_0x182778=_0x356201[_0x2ddf49(0x23f)]+0x1,_0x1c15ae=_0x2ddf49(0x173)+_0x182778[_0x2ddf49(0x1c2)]()[_0x2ddf49(0x1ad)](0x5,'0');var _0x48b415=[_0x2ddf49(0x242),'Enclosed'];if(_0xaa8fcc[0x0][_0x2ddf49(0x1b7)]==_0x2ddf49(0x1f8))var _0x5f5acc=users['English'];else{if(_0xaa8fcc[0x0][_0x2ddf49(0x1b7)]=='Hindi')var _0x5f5acc=users[_0x2ddf49(0x23d)];else{if(_0xaa8fcc[0x0][_0x2ddf49(0x1b7)]==_0x2ddf49(0x1f7))var _0x5f5acc=users[_0x2ddf49(0x1f7)];else{if(_0xaa8fcc[0x0][_0x2ddf49(0x1b7)]=='Spanish')var _0x5f5acc=users[_0x2ddf49(0x1e3)];else{if(_0xaa8fcc[0x0][_0x2ddf49(0x1b7)]==_0x2ddf49(0x1e7))var _0x5f5acc=users[_0x2ddf49(0x1e7)];else{if(_0xaa8fcc[0x0][_0x2ddf49(0x1b7)]==_0x2ddf49(0x205))var _0x5f5acc=users[_0x2ddf49(0x227)];else{if(_0xaa8fcc[0x0][_0x2ddf49(0x1b7)]=='Chinese')var _0x5f5acc=users[_0x2ddf49(0x1fd)];else{if(_0xaa8fcc[0x0][_0x2ddf49(0x1b7)]==_0x2ddf49(0x24a))var _0x5f5acc=users['Arabic'];}}}}}}}const _0x3da219=getRandom8DigitNumber();_0x3da219['then'](_0x5a54fe=>{var _0x27d73=_0x2ddf49;_0x247086[_0x27d73(0x224)](_0x27d73(0x174),{'success':_0x46c6f3[_0x27d73(0x1d4)]('success'),'errors':_0x46c6f3[_0x27d73(0x1d4)](_0x27d73(0x1aa)),'role':_0x39f86f,'profile':_0x5cc29d,'suppliers':_0x19b1bf,'warehouse':_0x2af969,'product':_0x5b9209,'invoice':_0x5a54fe,'master_shop':_0xaa8fcc,'language':_0x5f5acc,'find_data':_0x4e6630,'rooms_data':_0x48b415});})[_0x2ddf49(0x189)](_0x2fbf41=>{var _0x852a67=_0x2ddf49;_0x46c6f3['flash'](_0x852a67(0x1aa),_0x852a67(0x23c)),_0x247086[_0x852a67(0x17e)]('/all_purchases_finished/view');});}catch(_0x5f1bcf){console[_0x2ddf49(0x1df)](_0x5f1bcf);}}),router['get']('/view/add_purchases/:id',auth,async(_0x2b295d,_0x168e67)=>{var _0x39a179=a0_0x29ec7b;try{const _0x36d98d=_0x2b295d[_0x39a179(0x19d)]['id'];console[_0x39a179(0x1df)](_0x36d98d);const _0x17ee83=await master_shop[_0x39a179(0x19a)]();console['log']('master',_0x17ee83);const _0x476fb2=await product[_0x39a179(0x17d)]({'name':_0x36d98d});console[_0x39a179(0x1df)]('product',_0x476fb2),_0x168e67['status'](0xc8)[_0x39a179(0x15a)]({'product_data':_0x476fb2,'master':_0x17ee83});}catch(_0x2c896c){console[_0x39a179(0x1df)](_0x39a179(0x1ba),_0x2c896c);}}),router[a0_0x29ec7b(0x1d5)](a0_0x29ec7b(0x152),auth,async(_0x44c465,_0x1d897b)=>{var _0x1b93ef=a0_0x29ec7b;try{const {invoice:_0x54d9c8,date:_0x2fd866,warehouse_name:_0x5474a6,prod_name:_0x5a7ca5,prod_code:_0x2ddb20,prod_qty:_0x432291,prod_unit:_0x160b0e,prod_secondunit:_0x57885,prod_level:_0x24fb08,prod_isle:_0x5df4a2,prod_pallet:_0x36969b,note:_0x26da73,expiry_date:_0x5c3823,batch_code:_0x571e22,payable:_0x60ec98,due_amount:_0x3acf6c,Room_name:_0x561037,primary_code:_0x4b0914,secondary_code:_0x47050b,MaxStocks_data:_0x418ea3,PO_number:_0x5c5a03,SCRN:_0x16c3f1,JO_number:_0x529e28}=_0x44c465['body'];if(typeof _0x5a7ca5==_0x1b93ef(0x230))var _0x4fb231=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x21e)]],_0x52165f=[_0x44c465['body'][_0x1b93ef(0x18c)]],_0x29e4c4=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x14d)]],_0x5ab537=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x180)]],_0x341f97=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x17f)]],_0x2e0d04=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x1f1)]],_0x4ef519=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x196)]],_0x2e3ccd=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x1d0)]],_0x4a45da=[_0x44c465[_0x1b93ef(0x15d)]['MaxStocks_data']],_0x14a509=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x215)]],_0x20fedf=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x1b1)]],_0xab5a7a=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x153)]],_0x4ce022=[_0x44c465['body'][_0x1b93ef(0x175)]],_0x129ef6=[_0x44c465['body'][_0x1b93ef(0x1b2)]],_0x356bfa=[_0x44c465['body'][_0x1b93ef(0x1ac)]],_0x4e6669=[_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x1bb)]];else var _0x4fb231=[..._0x44c465['body'][_0x1b93ef(0x21e)]],_0x52165f=[..._0x44c465[_0x1b93ef(0x15d)]['prod_code']],_0x29e4c4=[..._0x44c465['body'][_0x1b93ef(0x14d)]],_0x5ab537=[..._0x44c465['body']['prod_primunit']],_0x341f97=[..._0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x17f)]],_0x2e0d04=[..._0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x1f1)]],_0x4ef519=[..._0x44c465['body']['primary_code']],_0x2e3ccd=[..._0x44c465['body'][_0x1b93ef(0x1d0)]],_0x4a45da=[..._0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x1da)]],_0x14a509=[..._0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x215)]],_0x20fedf=[..._0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x1b1)]],_0xab5a7a=[..._0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x153)]],_0x4ce022=[..._0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x175)]],_0x129ef6=[..._0x44c465['body'][_0x1b93ef(0x1b2)]],_0x356bfa=[..._0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x1ac)]],_0x4e6669=[..._0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x1bb)]];const _0x5adf9e=_0x4fb231['map'](_0x3e5265=>{return _0x3e5265={'product_name':_0x3e5265};});_0x52165f[_0x1b93ef(0x162)]((_0x4f5f65,_0x223428)=>{var _0x3c0174=_0x1b93ef;_0x5adf9e[_0x223428][_0x3c0174(0x214)]=_0x4f5f65;}),_0x29e4c4[_0x1b93ef(0x162)]((_0x5dca5a,_0x5e8e7a)=>{_0x5adf9e[_0x5e8e7a]['quantity']=Math['abs'](_0x5dca5a);}),_0x5ab537[_0x1b93ef(0x162)]((_0x559254,_0x23ca9b)=>{var _0x1c8848=_0x1b93ef;_0x5adf9e[_0x23ca9b][_0x1c8848(0x1cb)]=_0x559254;}),_0x341f97[_0x1b93ef(0x162)]((_0x53162b,_0x1aaf6e)=>{var _0xf62a34=_0x1b93ef;_0x5adf9e[_0x1aaf6e][_0xf62a34(0x185)]=_0x53162b;}),_0x2e0d04['forEach']((_0x357ce5,_0x3ad3ce)=>{_0x5adf9e[_0x3ad3ce]['bay']=_0x357ce5;}),_0x4ef519[_0x1b93ef(0x162)]((_0x25967e,_0x579e2e)=>{var _0x18df7f=_0x1b93ef;_0x5adf9e[_0x579e2e][_0x18df7f(0x196)]=_0x25967e;}),_0x2e3ccd[_0x1b93ef(0x162)]((_0x55085a,_0x2d82a8)=>{var _0x2df7f5=_0x1b93ef;_0x5adf9e[_0x2d82a8][_0x2df7f5(0x1d0)]=_0x55085a;}),_0x4a45da['forEach']((_0x3f4662,_0x3ee5ca)=>{var _0x447105=_0x1b93ef;_0x5adf9e[_0x3ee5ca][_0x447105(0x15e)]=_0x3f4662;}),_0x14a509[_0x1b93ef(0x162)]((_0x118299,_0x3d06ca)=>{var _0x33e9ba=_0x1b93ef;_0x5adf9e[_0x3d06ca][_0x33e9ba(0x215)]=_0x118299;}),_0x20fedf['forEach']((_0x51339d,_0x133e0e)=>{var _0x30a7fd=_0x1b93ef;_0x5adf9e[_0x133e0e][_0x30a7fd(0x1b1)]=_0x51339d;}),_0xab5a7a[_0x1b93ef(0x162)]((_0xdadf68,_0xc2cf1)=>{var _0xe2531=_0x1b93ef;_0x5adf9e[_0xc2cf1][_0xe2531(0x239)]=_0xdadf68;}),_0x4ce022[_0x1b93ef(0x162)]((_0x64ff44,_0x1e938d)=>{var _0x381de9=_0x1b93ef;_0x5adf9e[_0x1e938d][_0x381de9(0x167)]=_0x64ff44;}),_0x129ef6[_0x1b93ef(0x162)]((_0x1b64d3,_0x3ccff4)=>{_0x5adf9e[_0x3ccff4]['product_cat']=_0x1b64d3;}),_0x356bfa[_0x1b93ef(0x162)]((_0x4b8659,_0x4d20fb)=>{var _0x1f6fc3=_0x1b93ef;_0x5adf9e[_0x4d20fb][_0x1f6fc3(0x18e)]=_0x4b8659;}),_0x4e6669[_0x1b93ef(0x162)]((_0xfcebba,_0x3fef80)=>{_0x5adf9e[_0x3fef80]['invoice']=_0xfcebba;});const _0x132cec=_0x5adf9e[_0x1b93ef(0x16f)](_0x21dd47=>_0x21dd47[_0x1b93ef(0x1ab)]!=='0'&&_0x21dd47['quantity']!==''),_0x2d0271=new purchases_finished({'invoice':_0x54d9c8,'suppliers':_0x44c465[_0x1b93ef(0x15d)][_0x1b93ef(0x19e)],'date':_0x2fd866,'warehouse_name':_0x5474a6,'product':_0x132cec,'note':_0x26da73,'due_amount':_0x3acf6c,'room':_0x561037,'POnumber':_0x5c5a03,'SCRN':_0x16c3f1,'JO_number':_0x529e28}),_0x4b671e=await _0x2d0271['save'](),_0x24e224=await purchases_finished['findOne']({'invoice':_0x54d9c8}),_0x22fcf4=_0x24e224[_0x1b93ef(0x1ff)][_0x1b93ef(0x1f3)](async _0x22b8b4=>{var _0x271c94=_0x1b93ef;try{var _0x454944=await warehouse[_0x271c94(0x17d)]({'name':_0x5474a6,'room':_0x22b8b4[_0x271c94(0x18e)]}),_0x4bf0f1=0x0;const _0x1e1541=_0x454944[_0x271c94(0x210)]['map'](_0x391aa5=>{var _0x4a3ed0=_0x271c94;console['log'](_0x391aa5[_0x4a3ed0(0x17c)]+'=='+_0x22b8b4[_0x4a3ed0(0x17c)]+'&&'+_0x391aa5[_0x4a3ed0(0x179)]+'=='+_0x22b8b4['bay']+'&&'+_0x391aa5[_0x4a3ed0(0x1b1)]+'=='+_0x22b8b4[_0x4a3ed0(0x1b1)]+'&&'+_0x391aa5[_0x4a3ed0(0x239)]+'=='+_0x22b8b4[_0x4a3ed0(0x239)]+'&&'+_0x391aa5[_0x4a3ed0(0x215)]+'=='+_0x22b8b4[_0x4a3ed0(0x215)]+'&&'+_0x391aa5[_0x4a3ed0(0x16e)]+'=='+_0x24e224['invoice']),_0x391aa5[_0x4a3ed0(0x17c)]==_0x22b8b4[_0x4a3ed0(0x17c)]&&_0x391aa5[_0x4a3ed0(0x179)]==_0x22b8b4[_0x4a3ed0(0x179)]&&_0x391aa5[_0x4a3ed0(0x1b1)]==_0x22b8b4[_0x4a3ed0(0x1b1)]&&_0x391aa5[_0x4a3ed0(0x239)]==_0x22b8b4[_0x4a3ed0(0x239)]&&_0x391aa5[_0x4a3ed0(0x215)]==_0x22b8b4[_0x4a3ed0(0x215)]&&_0x391aa5[_0x4a3ed0(0x16e)]==_0x24e224[_0x4a3ed0(0x16e)]&&(_0x391aa5[_0x4a3ed0(0x204)]=Math[_0x4a3ed0(0x247)](_0x391aa5[_0x4a3ed0(0x204)])+Math['abs'](_0x22b8b4[_0x4a3ed0(0x1ab)]),_0x4bf0f1++);});return _0x4bf0f1==0x0&&(_0x454944[_0x271c94(0x210)]=_0x454944[_0x271c94(0x210)][_0x271c94(0x1e2)]({'product_name':_0x22b8b4['product_name'],'product_stock':Math[_0x271c94(0x247)](_0x22b8b4[_0x271c94(0x1ab)]),'primary_code':_0x22b8b4[_0x271c94(0x196)],'secondary_code':_0x22b8b4[_0x271c94(0x1d0)],'product_code':_0x22b8b4[_0x271c94(0x214)],'bay':_0x22b8b4[_0x271c94(0x179)],'maxProducts':_0x22b8b4[_0x271c94(0x15e)],'unit':_0x22b8b4[_0x271c94(0x1cb)],'secondary_unit':_0x22b8b4[_0x271c94(0x185)],'expiry_date':_0x22b8b4['expiry_date'],'production_date':_0x22b8b4['production_date'],'maxProducts':_0x22b8b4[_0x271c94(0x15e)],'maxPerUnit':_0x22b8b4[_0x271c94(0x167)],'batch_code':_0x22b8b4[_0x271c94(0x215)],'product_cat':_0x22b8b4[_0x271c94(0x194)],'invoice':_0x22b8b4[_0x271c94(0x16e)],'id_incoming':_0x22b8b4[_0x271c94(0x1ae)]})),_0x454944;}catch(_0x189cbf){return console[_0x271c94(0x1d3)](_0x271c94(0x17a),_0x189cbf),null;}});Promise['all'](_0x22fcf4)[_0x1b93ef(0x15b)](async _0x53b318=>{var _0x188368=_0x1b93ef;try{for(const _0x1b110c of _0x53b318){await warehouse[_0x188368(0x168)]({'_id':_0x1b110c[_0x188368(0x1ae)]},{'$addToSet':{'product_details':{'$each':_0x1b110c['product_details']}}});}const _0xb9f123=await master_shop[_0x188368(0x19a)](),_0x15dab4=await email_settings[_0x188368(0x17d)](),_0x5f32a8=await supervisor_settings[_0x188368(0x19a)]();var _0x5ead18=_0x24e224[_0x188368(0x1ff)],_0x487e5b='',_0x52b083;for(_0x52b083 in _0x5ead18){var _0x56e344='FG';_0x24e224[_0x188368(0x21c)]==_0x188368(0x244)&&(_0x56e344='DG'),_0x487e5b+=_0x188368(0x1b0)+_0x188368(0x1a6)+_0x5ead18[_0x52b083][_0x188368(0x17c)]+'</td>'+_0x188368(0x1a6)+_0x5ead18[_0x52b083][_0x188368(0x214)]+_0x188368(0x221)+_0x188368(0x1a6)+_0x5ead18[_0x52b083]['quantity']+'</td>'+_0x188368(0x1a6)+_0x5ead18[_0x52b083][_0x188368(0x1cb)]+_0x188368(0x221)+_0x188368(0x1a6)+_0x5ead18[_0x52b083][_0x188368(0x185)]+_0x188368(0x221)+_0x188368(0x1a6)+_0x24e224[_0x188368(0x21c)]+'</td>'+_0x188368(0x1a6)+_0x5ead18[_0x52b083][_0x188368(0x18e)]+_0x188368(0x221)+_0x188368(0x1a6)+_0x56e344+_0x5ead18[_0x52b083][_0x188368(0x179)]+_0x188368(0x221),_0x188368(0x1ee);}let _0x5639a6=nodemailer[_0x188368(0x155)]({'host':_0x15dab4[_0x188368(0x1a2)],'port':Number(_0x15dab4[_0x188368(0x1c1)]),'secure':![],'auth':{'user':_0x15dab4[_0x188368(0x149)],'pass':_0x15dab4[_0x188368(0x164)]}}),_0x11a039={'from':_0x15dab4[_0x188368(0x149)],'to':_0x5f32a8[0x0]['FGSEmail'],'subject':_0x188368(0x1c5),'attachments':[{'filename':_0x188368(0x197),'path':__dirname+_0x188368(0x177)+_0x188368(0x1f4)+_0xb9f123[0x0][_0x188368(0x192)],'cid':_0x188368(0x195)}],'html':'<!DOCTYPE\x20html>'+_0x188368(0x1ce)+'</head><body>'+_0x188368(0x21b)+_0x188368(0x1b9)+_0x188368(0x21b)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x188368(0x1db)+_0x188368(0x21b)+_0x188368(0x148)+_0xb9f123[0x0][_0x188368(0x22d)]+'\x20</h2>'+'</div>'+_0x188368(0x1db)+_0x188368(0x1e6)+_0x188368(0x21b)+_0x188368(0x1c3)+_0x188368(0x1c6)+_0x24e224['invoice']+'\x20'+_0x188368(0x228)+_0x188368(0x14f)+_0x24e224[_0x188368(0x1b6)]+'\x20'+_0x188368(0x14b)+_0x188368(0x1eb)+_0x188368(0x1db)+_0x188368(0x1fb)+_0x188368(0x170)+_0x188368(0x1b0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x188368(0x1b8)+_0x188368(0x1f6)+_0x188368(0x18f)+_0x188368(0x17b)+_0x188368(0x158)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x188368(0x241)+_0x188368(0x1ee)+'</thead>'+_0x188368(0x22e)+'\x20'+_0x487e5b+'\x20'+_0x188368(0x218)+_0x188368(0x14a)+'<div>'+_0x188368(0x222)+'<h5>'+_0xb9f123[0x0][_0x188368(0x22d)]+_0x188368(0x1eb)+_0x188368(0x1db)+_0x188368(0x1db)+_0x188368(0x207)};_0x5639a6[_0x188368(0x1d2)](_0x11a039,function(_0x4530d8,_0x46f8d3){var _0x5dac67=_0x188368;_0x4530d8?(console[_0x5dac67(0x1df)](_0x4530d8),console[_0x5dac67(0x1df)](_0x5dac67(0x169))):console['log'](_0x5dac67(0x1f2));});}catch(_0x5aa08a){console[_0x188368(0x1d3)](_0x5aa08a),_0x1d897b[_0x188368(0x1ea)](0x1f4)['json']({'error':_0x188368(0x213),'message':_0x5aa08a[_0x188368(0x20d)]});}})[_0x1b93ef(0x189)](_0x20b431=>{var _0x48c4c1=_0x1b93ef;console[_0x48c4c1(0x1d3)](_0x20b431);}),_0x44c465[_0x1b93ef(0x1d4)](_0x1b93ef(0x1dc),_0x1b93ef(0x171)),_0x1d897b['redirect'](_0x1b93ef(0x1be));}catch(_0x56365a){console['log'](_0x56365a);}}),router['get'](a0_0x29ec7b(0x1cf),auth,async(_0x206d79,_0x3358e7)=>{var _0x3863e8=a0_0x29ec7b;try{const {username:_0x5b8f16,email:_0x4266c4,role:_0x5bba21}=_0x206d79['user'],_0x3e1af0=_0x206d79[_0x3863e8(0x220)],_0x17f5e6=await profile['findOne']({'email':_0x3e1af0[_0x3863e8(0x149)]}),_0x374440=await master_shop[_0x3863e8(0x19a)](),_0x105c92=_0x206d79[_0x3863e8(0x19d)]['id'],_0xa6b16=await purchases_finished[_0x3863e8(0x187)](_0x105c92),_0x40a1d6=await suppliers[_0x3863e8(0x19a)]({});let _0x53e44b;if(_0x3e1af0[_0x3863e8(0x201)]==_0x3863e8(0x1f0)){const _0x1b37b2=await staff[_0x3863e8(0x17d)]({'email':_0x3e1af0[_0x3863e8(0x149)]});_0x53e44b=await warehouse[_0x3863e8(0x19a)]({'status':_0x3863e8(0x18a),'name':_0x1b37b2[_0x3863e8(0x18d)],'warehouse_category':_0x3863e8(0x1b3)});}else _0x53e44b=await warehouse[_0x3863e8(0x1a1)]([{'$match':{'status':_0x3863e8(0x18a),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x3863e8(0x229),'name':{'$first':'$name'}}}]);const _0x120312=await product['find']({}),_0x2e2411=BayBinSelected(_0xa6b16[_0x3863e8(0x21c)],_0xa6b16[_0x3863e8(0x1c4)]);let _0x5945cc=new Date(_0xa6b16[_0x3863e8(0x1b1)]),_0x1594f7=('0'+_0x5945cc['getDate']())[_0x3863e8(0x1c8)](-0x2),_0x16bdbd=('0'+(_0x5945cc[_0x3863e8(0x16a)]()+0x1))[_0x3863e8(0x1c8)](-0x2),_0x59dec9=_0x5945cc['getFullYear'](),_0x45195e=_0x59dec9+'-'+_0x16bdbd+'-'+_0x1594f7;if(_0x374440[0x0][_0x3863e8(0x1b7)]==_0x3863e8(0x1f8)){var _0xacbe9c=users[_0x3863e8(0x184)];console['log'](_0xacbe9c);}else{if(_0x374440[0x0]['language']==_0x3863e8(0x23d))var _0xacbe9c=users[_0x3863e8(0x23d)];else{if(_0x374440[0x0]['language']==_0x3863e8(0x1f7))var _0xacbe9c=users['German'];else{if(_0x374440[0x0][_0x3863e8(0x1b7)]=='Spanish')var _0xacbe9c=users[_0x3863e8(0x1e3)];else{if(_0x374440[0x0][_0x3863e8(0x1b7)]==_0x3863e8(0x1e7))var _0xacbe9c=users[_0x3863e8(0x1e7)];else{if(_0x374440[0x0]['language']==_0x3863e8(0x205))var _0xacbe9c=users[_0x3863e8(0x227)];else{if(_0x374440[0x0][_0x3863e8(0x1b7)]==_0x3863e8(0x1fd))var _0xacbe9c=users[_0x3863e8(0x1fd)];else{if(_0x374440[0x0][_0x3863e8(0x1b7)]==_0x3863e8(0x24a))var _0xacbe9c=users[_0x3863e8(0x191)];}}}}}}}_0x3358e7[_0x3863e8(0x224)](_0x3863e8(0x231),{'success':_0x206d79[_0x3863e8(0x1d4)](_0x3863e8(0x1dc)),'errors':_0x206d79[_0x3863e8(0x1d4)](_0x3863e8(0x1aa)),'role':_0x3e1af0,'profile':_0x17f5e6,'purchases':_0xa6b16,'suppliers':_0x40a1d6,'warehouse':_0x53e44b,'product':_0x120312,'master_shop':_0x374440,'language':_0xacbe9c,'ed_fullDate':_0x45195e,'dataSelected':_0x2e2411});}catch(_0x5cc4a4){console['log'](_0x5cc4a4);}}),router[a0_0x29ec7b(0x172)]('/view/:id',auth,async(_0x5bf523,_0x4bfae1)=>{var _0x51a892=a0_0x29ec7b;try{const {username:_0x214f1a,email:_0x2a7fe2,role:_0x5222f8}=_0x5bf523['user'],_0x24e8b1=_0x5bf523[_0x51a892(0x220)],_0x4ca3d4=await profile[_0x51a892(0x17d)]({'email':_0x24e8b1[_0x51a892(0x149)]}),_0x56403d=await master_shop[_0x51a892(0x19a)](),_0x3461e7=_0x5bf523['params']['id'],_0x14df52=await purchases_finished[_0x51a892(0x187)](_0x3461e7),_0x34c1b1=await suppliers[_0x51a892(0x19a)]({});let _0x17b4e0;if(_0x24e8b1[_0x51a892(0x201)]==_0x51a892(0x1f0)){const _0x1db0e1=await staff[_0x51a892(0x17d)]({'email':_0x24e8b1['email']});_0x17b4e0=await warehouse[_0x51a892(0x19a)]({'status':_0x51a892(0x18a),'name':_0x1db0e1[_0x51a892(0x18d)],'warehouse_category':_0x51a892(0x1b3)});}else _0x17b4e0=await warehouse[_0x51a892(0x1a1)]([{'$match':{'status':_0x51a892(0x18a),'warehouse_category':_0x51a892(0x1b3)}},{'$group':{'_id':_0x51a892(0x229),'name':{'$first':_0x51a892(0x229)}}}]);const _0x4a6b84=await product[_0x51a892(0x19a)]({}),_0x276a97=BayBinSelected(_0x14df52[_0x51a892(0x21c)],_0x14df52['room']);let _0x2bb724=new Date(_0x14df52[_0x51a892(0x1b1)]),_0x1d2c29=('0'+_0x2bb724[_0x51a892(0x223)]())['slice'](-0x2),_0xd9946c=('0'+(_0x2bb724[_0x51a892(0x16a)]()+0x1))[_0x51a892(0x1c8)](-0x2),_0x5d2f5a=_0x2bb724[_0x51a892(0x1b5)](),_0x30a5f9=_0x5d2f5a+'-'+_0xd9946c+'-'+_0x1d2c29;if(_0x56403d[0x0]['language']==_0x51a892(0x1f8)){var _0x5f2e12=users[_0x51a892(0x184)];console[_0x51a892(0x1df)](_0x5f2e12);}else{if(_0x56403d[0x0]['language']==_0x51a892(0x23d))var _0x5f2e12=users[_0x51a892(0x23d)];else{if(_0x56403d[0x0]['language']=='German')var _0x5f2e12=users[_0x51a892(0x1f7)];else{if(_0x56403d[0x0]['language']==_0x51a892(0x1e3))var _0x5f2e12=users[_0x51a892(0x1e3)];else{if(_0x56403d[0x0][_0x51a892(0x1b7)]=='French')var _0x5f2e12=users['French'];else{if(_0x56403d[0x0][_0x51a892(0x1b7)]=='Portuguese\x20(BR)')var _0x5f2e12=users[_0x51a892(0x227)];else{if(_0x56403d[0x0]['language']==_0x51a892(0x1fd))var _0x5f2e12=users['Chinese'];else{if(_0x56403d[0x0]['language']=='Arabic\x20(ae)')var _0x5f2e12=users[_0x51a892(0x191)];}}}}}}}_0x4bfae1[_0x51a892(0x224)](_0x51a892(0x1ca),{'success':_0x5bf523[_0x51a892(0x1d4)](_0x51a892(0x1dc)),'errors':_0x5bf523[_0x51a892(0x1d4)](_0x51a892(0x1aa)),'role':_0x24e8b1,'profile':_0x4ca3d4,'purchases':_0x14df52,'suppliers':_0x34c1b1,'warehouse':_0x17b4e0,'product':_0x4a6b84,'master_shop':_0x56403d,'language':_0x5f2e12,'ed_fullDate':_0x30a5f9,'dataSelected':_0x276a97});}catch(_0x441f80){console[_0x51a892(0x1df)](_0x441f80);}}),router['post'](a0_0x29ec7b(0x1bd),auth,async(_0x4ddde3,_0x12017b)=>{var _0x507509=a0_0x29ec7b;try{const _0x1a34c8=_0x4ddde3[_0x507509(0x19d)]['id'],_0x459b7e=await purchases_finished[_0x507509(0x17d)]({'_id':_0x4ddde3[_0x507509(0x19d)]['id']}),_0x318cbe=await warehouse[_0x507509(0x17d)]({'name':_0x459b7e[_0x507509(0x21c)],'room':_0x459b7e[_0x507509(0x1c4)]});_0x459b7e[_0x507509(0x1ff)][_0x507509(0x162)](_0x292884=>{var _0x358c28=_0x507509;const _0x2011f4=_0x318cbe[_0x358c28(0x210)][_0x358c28(0x1f3)](_0x2e06ce=>{var _0x3eabf1=_0x358c28;_0x2e06ce['product_name']==_0x292884[_0x3eabf1(0x17c)]&&_0x2e06ce[_0x3eabf1(0x179)]==_0x292884['bay']&&(_0x2e06ce['product_stock']=parseInt(_0x2e06ce[_0x3eabf1(0x204)])-parseInt(_0x292884['quantity']));});}),await _0x318cbe[_0x507509(0x151)]();const {invoice:_0x5b3bf2,suppliers:_0x3e4eb4,date:_0x38fbf8,warehouse_name:_0x5d1bcd,prod_name:_0x3cb519,prod_code:_0x23ab8f,prod_qty:_0x4257bf,prod_unit:_0x519572,prod_secondunit:_0x23ce1b,prod_level:_0x409d07,prod_isle:_0x512265,prod_pallet:_0x149d23,note:_0x5f3d03,expiry_date:_0x46b305,batch_code:_0x1cfc0b,paid_amount:_0x33ab13,due_amount:_0x1800fc,Room_name:_0x560439,primary_code:_0x3c2dca,secondary_code:_0x4e2afb,PO_number:_0x263384,JO_number:_0x7f3afa}=_0x4ddde3[_0x507509(0x15d)];if(typeof _0x3cb519==_0x507509(0x230))var _0x5a2f51=[_0x4ddde3['body']['prod_name']],_0x290019=[_0x4ddde3['body'][_0x507509(0x18c)]],_0x36888e=[_0x4ddde3[_0x507509(0x15d)]['prod_qty']],_0x267524=[_0x4ddde3['body']['prod_unit']],_0x3aa7d1=[_0x4ddde3['body']['prod_secondunit']],_0x165c9d=[_0x4ddde3[_0x507509(0x15d)][_0x507509(0x1f1)]],_0x16b34c=[_0x4ddde3['body'][_0x507509(0x196)]],_0x67cbad=[_0x4ddde3[_0x507509(0x15d)][_0x507509(0x1d0)]],_0x16fc16=[_0x4ddde3[_0x507509(0x15d)][_0x507509(0x1da)]],_0xddbfcd=[_0x4ddde3[_0x507509(0x15d)][_0x507509(0x215)]],_0x16cd86=[_0x4ddde3[_0x507509(0x15d)][_0x507509(0x1b1)]];else var _0x5a2f51=[..._0x4ddde3[_0x507509(0x15d)][_0x507509(0x21e)]],_0x290019=[..._0x4ddde3[_0x507509(0x15d)][_0x507509(0x18c)]],_0x36888e=[..._0x4ddde3[_0x507509(0x15d)][_0x507509(0x21a)]],_0x267524=[..._0x4ddde3['body'][_0x507509(0x1ef)]],_0x3aa7d1=[..._0x4ddde3['body'][_0x507509(0x17f)]],_0x165c9d=[..._0x4ddde3[_0x507509(0x15d)][_0x507509(0x1f1)]],_0x16b34c=[..._0x4ddde3['body'][_0x507509(0x196)]],_0x67cbad=[..._0x4ddde3['body'][_0x507509(0x1d0)]],_0x16fc16=[..._0x4ddde3[_0x507509(0x15d)][_0x507509(0x1da)]],_0xddbfcd=[..._0x4ddde3[_0x507509(0x15d)][_0x507509(0x215)]],_0x16cd86=[..._0x4ddde3['body']['expiry_date']];const _0x1b5562=_0x5a2f51[_0x507509(0x1f3)](_0x4a0089=>{return _0x4a0089={'product_name':_0x4a0089};});_0x290019[_0x507509(0x162)]((_0x3f3e95,_0x279ff1)=>{var _0x5bd9c5=_0x507509;_0x1b5562[_0x279ff1][_0x5bd9c5(0x214)]=_0x3f3e95;}),_0x36888e[_0x507509(0x162)]((_0x232be6,_0x2d2f2f)=>{_0x1b5562[_0x2d2f2f]['quantity']=_0x232be6;}),_0x267524[_0x507509(0x162)]((_0x3cfe08,_0xee0b43)=>{var _0x5c096f=_0x507509;_0x1b5562[_0xee0b43][_0x5c096f(0x1cb)]=_0x3cfe08;}),_0x3aa7d1[_0x507509(0x162)]((_0x43b704,_0x3623b4)=>{var _0x19550a=_0x507509;_0x1b5562[_0x3623b4][_0x19550a(0x185)]=_0x43b704;}),_0x165c9d[_0x507509(0x162)]((_0x68ab7f,_0x401888)=>{var _0x4a6771=_0x507509;_0x1b5562[_0x401888][_0x4a6771(0x179)]=_0x68ab7f;}),_0x16b34c['forEach']((_0x305184,_0x494b0f)=>{var _0x162921=_0x507509;_0x1b5562[_0x494b0f][_0x162921(0x196)]=_0x305184;}),_0x67cbad[_0x507509(0x162)]((_0x4c0731,_0x599a91)=>{_0x1b5562[_0x599a91]['secondary_code']=_0x4c0731;}),_0x16fc16[_0x507509(0x162)]((_0x2b8c51,_0x2062f9)=>{_0x1b5562[_0x2062f9]['maxStocks']=_0x2b8c51;}),_0xddbfcd[_0x507509(0x162)]((_0x4cd362,_0x1af5fe)=>{var _0x262996=_0x507509;_0x1b5562[_0x1af5fe][_0x262996(0x215)]=_0x4cd362;}),_0x16cd86[_0x507509(0x162)]((_0x11957f,_0x523f3a)=>{var _0x4a7e60=_0x507509;_0x1b5562[_0x523f3a][_0x4a7e60(0x1b1)]=_0x11957f;});const _0x1b386b=_0x1b5562[_0x507509(0x16f)](_0xdbcaa8=>_0xdbcaa8[_0x507509(0x1ab)]!=='0'&&_0xdbcaa8['quantity']!=='');_0x459b7e[_0x507509(0x16e)]=_0x5b3bf2,_0x459b7e[_0x507509(0x19e)]=_0x3e4eb4,_0x459b7e[_0x507509(0x1b6)]=_0x38fbf8,_0x459b7e[_0x507509(0x21c)]=_0x5d1bcd,_0x459b7e['product']=_0x1b386b,_0x459b7e[_0x507509(0x233)]=_0x5f3d03,_0x459b7e[_0x507509(0x1cc)]=_0x33ab13,_0x459b7e[_0x507509(0x245)]=_0x1800fc,_0x459b7e[_0x507509(0x1c4)]=_0x560439,_0x459b7e[_0x507509(0x16c)]=_0x263384,_0x459b7e[_0x507509(0x1ec)]=_0x7f3afa;const _0xc143e3=await _0x459b7e[_0x507509(0x151)](),_0x5dab3b=await warehouse['findOne']({'name':_0x4ddde3[_0x507509(0x15d)][_0x507509(0x21c)],'room':_0x4ddde3['body'][_0x507509(0x1a5)]});_0x459b7e[_0x507509(0x1ff)][_0x507509(0x162)](_0x86161f=>{var _0x5631ea=_0x507509,_0x3d4381=0x0;const _0x3eda8e=_0x5dab3b[_0x5631ea(0x210)][_0x5631ea(0x1f3)](_0x4357df=>{var _0x25d119=_0x5631ea;_0x4357df[_0x25d119(0x17c)]==_0x86161f[_0x25d119(0x17c)]&&_0x4357df[_0x25d119(0x179)]==_0x86161f[_0x25d119(0x179)]&&(_0x4357df[_0x25d119(0x204)]=parseInt(_0x4357df['product_stock'])+parseInt(_0x86161f[_0x25d119(0x1ab)]),_0x3d4381++);});_0x3d4381=='0'&&(_0x5dab3b['product_details']=_0x5dab3b[_0x5631ea(0x210)][_0x5631ea(0x1e2)]({'product_name':_0x86161f[_0x5631ea(0x17c)],'product_stock':_0x86161f[_0x5631ea(0x1ab)],'primary_code':_0x86161f[_0x5631ea(0x196)],'secondary_code':_0x86161f[_0x5631ea(0x1d0)],'product_code':_0x86161f[_0x5631ea(0x214)],'bay':_0x86161f['bay'],'maxProducts':_0x86161f[_0x5631ea(0x15e)],'unit':_0x86161f[_0x5631ea(0x1cb)],'secondary_unit':_0x86161f[_0x5631ea(0x185)],'expiry_date':_0x86161f[_0x5631ea(0x1b1)]}));}),await _0x5dab3b[_0x507509(0x151)]();const _0x2c1bec=await s_payment_data[_0x507509(0x17d)]({'invoice':_0x4ddde3[_0x507509(0x15d)][_0x507509(0x16e)]});if(_0x2c1bec===null){}else console[_0x507509(0x1df)](_0x507509(0x19e),_0x2c1bec,_0x4ddde3[_0x507509(0x15d)][_0x507509(0x16e)]),_0x2c1bec['suppliers']=_0x4ddde3['body']['suppliers'],await _0x2c1bec['save']();_0x4ddde3['flash'](_0x507509(0x1dc),'purchase\x20data\x20update\x20successfully'),_0x12017b[_0x507509(0x17e)]('/all_purchases_finished/view');}catch(_0x4321da){console[_0x507509(0x1df)](_0x4321da);}}),router['post'](a0_0x29ec7b(0x181),auth,async(_0x4fc6a2,_0x10ca37)=>{var _0x550de9=a0_0x29ec7b;try{const _0x29971b=_0x4fc6a2[_0x550de9(0x19d)]['id'],{invoice:_0x2883a6,suppliers:_0x4ffa1e,payable:_0x2028bd,due_amount:_0x4432f6}=_0x4fc6a2[_0x550de9(0x15d)],_0x53c501=await purchases[_0x550de9(0x187)](_0x29971b);var _0x49232a=_0x2028bd-_0x4432f6;_0x53c501['paid_amount']=parseFloat(_0x53c501[_0x550de9(0x1cc)])+parseFloat(_0x4432f6),_0x53c501['due_amount']=_0x49232a;const _0x20736b=await _0x53c501[_0x550de9(0x151)]();console['log'](_0x20736b);const _0x55fe86=await s_payment_data[_0x550de9(0x17d)]({'invoice':_0x2883a6});_0x55fe86[_0x550de9(0x15f)]=_0x49232a,await _0x55fe86[_0x550de9(0x151)]();let _0x57380f=new Date(),_0xb60273=('0'+_0x57380f[_0x550de9(0x223)]())[_0x550de9(0x1c8)](-0x2),_0x5d3ec3=('0'+(_0x57380f[_0x550de9(0x16a)]()+0x1))[_0x550de9(0x1c8)](-0x2),_0x4a3458=_0x57380f[_0x550de9(0x1b5)](),_0x455bd0=_0x4a3458+'-'+_0x5d3ec3+'-'+_0xb60273;const _0x1e0d25=new suppliers_payment({'invoice':_0x2883a6,'date':_0x4a3458+'-'+_0x5d3ec3+'-'+_0xb60273,'suppliers':_0x4ffa1e,'reason':_0x550de9(0x1a3),'amount':_0x4432f6}),_0x972433=await _0x1e0d25[_0x550de9(0x151)]();_0x4fc6a2[_0x550de9(0x1d4)](_0x550de9(0x1dc),_0x550de9(0x166)),_0x10ca37['redirect'](_0x550de9(0x16d));}catch(_0x33c56c){console['log'](_0x33c56c);}}),router[a0_0x29ec7b(0x172)](a0_0x29ec7b(0x1dd),auth,async(_0x283fa8,_0x51124f)=>{var _0x104a7e=a0_0x29ec7b;try{const {username:_0x501d77,email:_0x2ae516,role:_0x5f53bf}=_0x283fa8['user'],_0x8743ac=_0x283fa8['user'],_0x1618fd=await profile[_0x104a7e(0x17d)]({'email':_0x8743ac[_0x104a7e(0x149)]}),_0x139371=await master_shop[_0x104a7e(0x19a)]();console[_0x104a7e(0x1df)](_0x104a7e(0x19c),_0x139371);const _0x408394=_0x283fa8[_0x104a7e(0x19d)]['id'],_0x17409a=await purchases[_0x104a7e(0x187)](_0x408394);console[_0x104a7e(0x1df)](_0x17409a);const _0x1c955b=await suppliers[_0x104a7e(0x17d)]({'name':_0x17409a[_0x104a7e(0x19e)]});console[_0x104a7e(0x1df)](_0x1c955b);if(_0x139371[0x0][_0x104a7e(0x1b7)]==_0x104a7e(0x1f8)){var _0x35bc62=users[_0x104a7e(0x184)];console[_0x104a7e(0x1df)](_0x35bc62);}else{if(_0x139371[0x0][_0x104a7e(0x1b7)]==_0x104a7e(0x23d))var _0x35bc62=users[_0x104a7e(0x23d)];else{if(_0x139371[0x0][_0x104a7e(0x1b7)]==_0x104a7e(0x1f7))var _0x35bc62=users[_0x104a7e(0x1f7)];else{if(_0x139371[0x0][_0x104a7e(0x1b7)]==_0x104a7e(0x1e3))var _0x35bc62=users[_0x104a7e(0x1e3)];else{if(_0x139371[0x0][_0x104a7e(0x1b7)]=='French')var _0x35bc62=users['French'];else{if(_0x139371[0x0][_0x104a7e(0x1b7)]==_0x104a7e(0x205))var _0x35bc62=users['Portuguese'];else{if(_0x139371[0x0][_0x104a7e(0x1b7)]==_0x104a7e(0x1fd))var _0x35bc62=users[_0x104a7e(0x1fd)];else{if(_0x139371[0x0][_0x104a7e(0x1b7)]=='Arabic\x20(ae)')var _0x35bc62=users[_0x104a7e(0x191)];}}}}}}}_0x51124f[_0x104a7e(0x224)]('purchase_invoice',{'success':_0x283fa8[_0x104a7e(0x1d4)](_0x104a7e(0x1dc)),'errors':_0x283fa8[_0x104a7e(0x1d4)]('errors'),'role':_0x8743ac,'profile':_0x1618fd,'master_shop':_0x139371,'supplier':_0x1c955b,'purchase':_0x17409a,'language':_0x35bc62});}catch(_0x1649b6){console['log'](_0x1649b6);}}),router[a0_0x29ec7b(0x172)]('/view/return_purchase/:id',auth,async(_0xeabd,_0x57d7f2)=>{var _0x552b67=a0_0x29ec7b;try{const {username:_0x5bc26d,email:_0x2e2a7c,role:_0x25514b}=_0xeabd['user'],_0x488fdb=_0xeabd[_0x552b67(0x220)],_0x31a82f=await profile[_0x552b67(0x17d)]({'email':_0x488fdb[_0x552b67(0x149)]}),_0x414320=await master_shop['find']();console[_0x552b67(0x1df)](_0x552b67(0x19c),_0x414320);const _0x34363f=_0xeabd[_0x552b67(0x19d)]['id'];console['log'](_0x34363f);const _0x24eb9f=await purchases_finished[_0x552b67(0x187)](_0x34363f);console[_0x552b67(0x1df)](_0x552b67(0x147),_0x24eb9f);const _0x360581=await product[_0x552b67(0x19a)]({}),_0x20fc9b=await warehouse[_0x552b67(0x1a1)]([{'$match':{'name':_0x24eb9f[_0x552b67(0x21c)],'room':_0x24eb9f[_0x552b67(0x1c4)]}},{'$unwind':_0x552b67(0x212)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x552b67(0x1e4)},'product_stock':{'$first':_0x552b67(0x1a9)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x552b67(0x1de)},'type':{'$first':_0x552b67(0x21d)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x552b67(0x154)},'secondary_code':{'$first':_0x552b67(0x1b4)},'product_code':{'$first':_0x552b67(0x1bc)},'storage':{'$first':_0x552b67(0x237)},'rack':{'$first':_0x552b67(0x1a4)}}}]);console[_0x552b67(0x1df)](_0x552b67(0x226),_0x20fc9b);let _0x5925ac;if(_0x488fdb[_0x552b67(0x201)]==_0x552b67(0x1f0)){const _0x50f539=await staff[_0x552b67(0x17d)]({'email':_0x488fdb[_0x552b67(0x149)]});_0x5925ac=await warehouse[_0x552b67(0x19a)]({'status':_0x552b67(0x18a),'name':_0x50f539[_0x552b67(0x18d)],'warehouse_category':_0x552b67(0x1b3),'name':_0x552b67(0x1c7)});}else _0x5925ac=await warehouse[_0x552b67(0x1a1)]([{'$match':{'status':_0x552b67(0x18a),'warehouse_category':_0x552b67(0x1b3),'name':'Return\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x552b67(0x229)}}}]);if(_0x414320[0x0][_0x552b67(0x1b7)]==_0x552b67(0x1f8)){var _0x3ed938=users[_0x552b67(0x184)];console[_0x552b67(0x1df)](_0x3ed938);}else{if(_0x414320[0x0]['language']=='Hindi')var _0x3ed938=users[_0x552b67(0x23d)];else{if(_0x414320[0x0]['language']=='German')var _0x3ed938=users['German'];else{if(_0x414320[0x0][_0x552b67(0x1b7)]==_0x552b67(0x1e3))var _0x3ed938=users[_0x552b67(0x1e3)];else{if(_0x414320[0x0][_0x552b67(0x1b7)]==_0x552b67(0x1e7))var _0x3ed938=users[_0x552b67(0x1e7)];else{if(_0x414320[0x0][_0x552b67(0x1b7)]==_0x552b67(0x205))var _0x3ed938=users['Portuguese'];else{if(_0x414320[0x0]['language']==_0x552b67(0x1fd))var _0x3ed938=users[_0x552b67(0x1fd)];else{if(_0x414320[0x0][_0x552b67(0x1b7)]=='Arabic\x20(ae)')var _0x3ed938=users['Arabic'];}}}}}}}_0x57d7f2[_0x552b67(0x224)]('return_purchase_finished',{'success':_0xeabd[_0x552b67(0x1d4)]('success'),'errors':_0xeabd[_0x552b67(0x1d4)](_0x552b67(0x1aa)),'role':_0x488fdb,'profile':_0x31a82f,'user':_0x24eb9f,'stock':_0x20fc9b,'master_shop':_0x414320,'product':_0x360581,'language':_0x3ed938,'warehouse':_0x5925ac});}catch(_0x15f064){console[_0x552b67(0x1df)](_0x15f064);}}),router[a0_0x29ec7b(0x1d5)]('/view/return_purchase/:id',auth,async(_0xd57e22,_0x4f40a4)=>{var _0xfb74cf=a0_0x29ec7b;try{const {invoice:_0x1b2c07,date:_0x5ae58b,warehouse_name:_0x53e609,Room_name:_0x54ce29,product_name:_0x36e113,purchase_quantity:_0x52d866,stocks:_0x29c202,return_qty:_0x46d935,note:_0x5cf5aa,level:_0x3e6970,isle:_0x451b30,pallet:_0x4ca228,to_warehouse_name:_0x335b17,to_Room_name:_0x5926e6}=_0xd57e22[_0xfb74cf(0x15d)],_0x23f5f8=await purchases_finished[_0xfb74cf(0x17d)]({'_id':_0xd57e22[_0xfb74cf(0x19d)]['id']}),_0x363e32=await warehouse[_0xfb74cf(0x17d)]({'name':_0x53e609,'room':_0x54ce29,'warehouse_category':_0xfb74cf(0x1b3)});if(typeof _0x36e113==_0xfb74cf(0x230))var _0x5ee1ca=[_0xd57e22[_0xfb74cf(0x15d)]['product_name']],_0x283a34=[_0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x232)]],_0x7d6d5b=[_0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x206)]],_0x57ef07=[_0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x193)]],_0x4b9b1d=[_0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x157)]],_0x3b1ed8=[_0xd57e22['body'][_0xfb74cf(0x1e1)]],_0x2758ca=[_0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x1d8)]],_0xaf2a06=[_0xd57e22[_0xfb74cf(0x15d)]['secondary_code_hide']];else var _0x5ee1ca=[..._0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x17c)]],_0x283a34=[..._0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x232)]],_0x7d6d5b=[..._0xd57e22[_0xfb74cf(0x15d)]['stocks']],_0x57ef07=[..._0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x193)]],_0x4b9b1d=[..._0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x157)]],_0x3b1ed8=[..._0xd57e22[_0xfb74cf(0x15d)]['product_code_hide']],_0x2758ca=[..._0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x1d8)]],_0xaf2a06=[..._0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x1ed)]];const _0x132350=_0x5ee1ca[_0xfb74cf(0x1f3)](_0x15f235=>{return _0x15f235={'product_name':_0x15f235};});_0x283a34[_0xfb74cf(0x162)]((_0x3691d7,_0x2c65e8)=>{var _0x33f183=_0xfb74cf;_0x132350[_0x2c65e8][_0x33f183(0x232)]=_0x3691d7;}),_0x7d6d5b[_0xfb74cf(0x162)]((_0x2d08de,_0x4f84d7)=>{var _0x1723b5=_0xfb74cf;_0x132350[_0x4f84d7][_0x1723b5(0x1a0)]=_0x2d08de;}),_0x57ef07['forEach']((_0x33706d,_0x1d5783)=>{var _0x8c6da6=_0xfb74cf;_0x132350[_0x1d5783][_0x8c6da6(0x193)]=_0x33706d;}),_0x4b9b1d[_0xfb74cf(0x162)]((_0x37b2c6,_0x31828f)=>{var _0x32c052=_0xfb74cf;_0x132350[_0x31828f][_0x32c052(0x179)]=_0x37b2c6;}),_0x3b1ed8[_0xfb74cf(0x162)]((_0x479a9c,_0x46f0c5)=>{var _0x1d3c85=_0xfb74cf;_0x132350[_0x46f0c5][_0x1d3c85(0x214)]=_0x479a9c;}),_0x2758ca[_0xfb74cf(0x162)]((_0x1bb5bb,_0x439ac1)=>{var _0xe21ebf=_0xfb74cf;_0x132350[_0x439ac1][_0xe21ebf(0x196)]=_0x1bb5bb;}),_0xaf2a06[_0xfb74cf(0x162)]((_0x4cec22,_0x393f5f)=>{var _0x1d2209=_0xfb74cf;_0x132350[_0x393f5f][_0x1d2209(0x1d0)]=_0x4cec22;}),_0x132350[_0xfb74cf(0x162)](_0x4f667c=>{var _0xd91ceb=_0xfb74cf;console[_0xd91ceb(0x1df)](_0x4f667c);const _0x1b01af=_0x363e32[_0xd91ceb(0x210)][_0xd91ceb(0x1f3)](_0x44e996=>{var _0x32e484=_0xd91ceb;_0x44e996[_0x32e484(0x17c)]==_0x4f667c[_0x32e484(0x17c)]&&_0x44e996[_0x32e484(0x179)]==_0x4f667c[_0x32e484(0x179)]&&(console['log'](parseInt(_0x44e996[_0x32e484(0x204)])+_0x32e484(0x163)+parseInt(_0x4f667c['return_qty'])),_0x44e996['product_stock']=parseInt(_0x44e996['product_stock'])-parseInt(_0x4f667c[_0x32e484(0x193)]));});}),await _0x363e32[_0xfb74cf(0x151)]();var _0x51f4b6=0x0;_0x132350[_0xfb74cf(0x162)](_0x2addf6=>{var _0xc66d06=_0xfb74cf;(parseInt(_0x2addf6[_0xc66d06(0x232)])<parseInt(_0x2addf6[_0xc66d06(0x193)])||parseInt(_0x2addf6[_0xc66d06(0x1a0)])<parseInt(_0x2addf6[_0xc66d06(0x193)]))&&_0x51f4b6++;});if(_0x51f4b6!=0x0)return _0xd57e22['flash']('errors',_0xfb74cf(0x22a)),_0x4f40a4[_0xfb74cf(0x17e)]('back');const _0x580b35=new purchases_return_finished({'invoice':_0x1b2c07,'suppliers':_0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x19e)],'date':_0x5ae58b,'warehouse_name':_0x53e609,'return_product':_0x132350,'note':_0x5cf5aa,'room':_0x54ce29,'to_warehouse_name':_0x335b17,'to_room':_0x5926e6}),_0x58314e=await _0x580b35[_0xfb74cf(0x151)](),_0x4241bd=await purchases_return_finished[_0xfb74cf(0x17d)]({'invoice':_0x1b2c07}),_0x335847=await warehouse['findOne']({'name':_0x335b17,'room':_0x5926e6,'warehouse_category':_0xfb74cf(0x1b3)});_0x4241bd['return_product']['forEach'](_0x497506=>{var _0x32d928=_0xfb74cf,_0x4615a3=0x0;const _0x15568c=_0x335847[_0x32d928(0x210)]['map'](_0xfb660=>{var _0x4f07e0=_0x32d928;console[_0x4f07e0(0x1df)](_0xfb660[_0x4f07e0(0x17c)]+'=='+_0x497506[_0x4f07e0(0x17c)]+'&&'+_0xfb660['bay']+'=='+_0x497506[_0x4f07e0(0x179)]),_0xfb660[_0x4f07e0(0x17c)]==_0x497506[_0x4f07e0(0x17c)]&&_0xfb660[_0x4f07e0(0x179)]==_0x497506['bay']&&(_0xfb660['product_stock']=parseInt(_0xfb660[_0x4f07e0(0x204)])-parseInt(_0x497506[_0x4f07e0(0x193)]),_0x4615a3++);});_0x4615a3=='0'&&(_0x335847[_0x32d928(0x210)]=_0x335847[_0x32d928(0x210)][_0x32d928(0x1e2)]({'product_name':_0x497506['product_name'],'product_stock':_0x497506['return_qty'],'primary_code':_0x497506[_0x32d928(0x196)],'secondary_code':_0x497506[_0x32d928(0x1d0)],'product_code':_0x497506['product_code'],'bay':_0x497506['bay'],'maxProducts':0xf423f}));}),await _0x335847['save']();const _0x1b0ead=await purchases_finished[_0xfb74cf(0x17d)]({'invoice':_0x1b2c07});_0x1b0ead[_0xfb74cf(0x1fa)]=_0xfb74cf(0x243);const _0x4b12eb=await _0x1b0ead['save'](),_0x5efe17=new s_payment_data({'invoice':_0x1b2c07,'suppliers':_0xd57e22[_0xfb74cf(0x15d)][_0xfb74cf(0x19e)],'reason':_0xfb74cf(0x1af)});await _0x5efe17[_0xfb74cf(0x151)]();const _0x276b02=await master_shop[_0xfb74cf(0x19a)](),_0x3f18ad=await email_settings[_0xfb74cf(0x17d)](),_0x411598=await suppliers['findOne']({'name':_0xd57e22[_0xfb74cf(0x15d)]['suppliers']});_0x276b02[0x0][_0xfb74cf(0x160)]==0x1?(right_currency=_0x276b02[0x0][_0xfb74cf(0x211)],left_currency=''):(right_currency='',left_currency=_0x276b02[0x0][_0xfb74cf(0x211)]);var _0x405923=_0x5ee1ca,_0x1ab1d3=_0x57ef07,_0x29a83e='',_0x4d63fd;for(_0x4d63fd in _0x405923){_0x29a83e+=_0xfb74cf(0x1b0)+_0xfb74cf(0x1a6)+_0x405923[_0x4d63fd]+_0xfb74cf(0x221)+_0xfb74cf(0x1a6)+_0x1ab1d3[_0x4d63fd]+_0xfb74cf(0x221)+_0xfb74cf(0x1ee);}let _0x293236=nodemailer[_0xfb74cf(0x155)]({'service':_0xfb74cf(0x1c9),'auth':{'user':_0x3f18ad[_0xfb74cf(0x149)],'pass':_0x3f18ad[_0xfb74cf(0x164)]}}),_0x221c64={'from':_0x3f18ad[_0xfb74cf(0x149)],'to':_0x411598['email'],'subject':_0xfb74cf(0x1e9),'attachments':[{'filename':_0xfb74cf(0x197),'path':__dirname+_0xfb74cf(0x177)+_0xfb74cf(0x1f4)+_0x276b02[0x0][_0xfb74cf(0x192)],'cid':'logo'}],'html':_0xfb74cf(0x20e)+_0xfb74cf(0x1ce)+'</head><body>'+_0xfb74cf(0x21b)+_0xfb74cf(0x1b9)+'<div>'+_0xfb74cf(0x20f)+_0xfb74cf(0x1db)+_0xfb74cf(0x21b)+_0xfb74cf(0x148)+_0x276b02[0x0][_0xfb74cf(0x22d)]+'\x20</h2>'+_0xfb74cf(0x1db)+_0xfb74cf(0x1db)+_0xfb74cf(0x1e6)+_0xfb74cf(0x21b)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0xfb74cf(0x1c6)+_0x1b2c07+'\x20'+_0xfb74cf(0x228)+_0xfb74cf(0x14f)+_0x5ae58b+'\x20'+_0xfb74cf(0x14b)+_0xfb74cf(0x1eb)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xfb74cf(0x170)+'<tr>'+_0xfb74cf(0x183)+_0xfb74cf(0x1e0)+_0xfb74cf(0x20b)+_0xfb74cf(0x200)+_0xfb74cf(0x1ee)+_0xfb74cf(0x1d1)+_0xfb74cf(0x22e)+'\x20'+_0x29a83e+'\x20'+_0xfb74cf(0x218)+_0xfb74cf(0x14a)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0xfb74cf(0x161)+_0x276b02[0x0][_0xfb74cf(0x22d)]+_0xfb74cf(0x1eb)+_0xfb74cf(0x1db)+'</div>'+_0xfb74cf(0x207)};_0x293236['sendMail'](_0x221c64,function(_0x496525,_0x7db510){var _0x311a95=_0xfb74cf;_0x496525?console[_0x311a95(0x1df)](_0x311a95(0x169)):console[_0x311a95(0x1df)](_0x311a95(0x1f2));}),_0xd57e22[_0xfb74cf(0x1d4)](_0xfb74cf(0x1dc),_0xfb74cf(0x1e5)),_0x4f40a4[_0xfb74cf(0x17e)](_0xfb74cf(0x1be));}catch(_0x596523){_0x4f40a4[_0xfb74cf(0x1ea)](0xc8)['json']({'message':_0x596523[_0xfb74cf(0x20d)]});}}),router['get'](a0_0x29ec7b(0x18b),auth,async(_0x4badf5,_0x1fa7a8)=>{var _0x1f7402=a0_0x29ec7b;try{const {username:_0x468b34,email:_0x2ee990,role:_0x2ad11f}=_0x4badf5[_0x1f7402(0x220)],_0x52972d=_0x4badf5[_0x1f7402(0x220)],_0x43711f=await profile[_0x1f7402(0x17d)]({'email':_0x52972d['email']}),_0x3b9917=await master_shop[_0x1f7402(0x19a)](),_0x517745=_0x4badf5[_0x1f7402(0x19d)]['id'],_0x1f1e0a=await purchases_finished['findById'](_0x517745);if(_0x3b9917[0x0][_0x1f7402(0x1b7)]==_0x1f7402(0x1f8))var _0x253e0f=users[_0x1f7402(0x184)];else{if(_0x3b9917[0x0][_0x1f7402(0x1b7)]==_0x1f7402(0x23d))var _0x253e0f=users[_0x1f7402(0x23d)];else{if(_0x3b9917[0x0]['language']==_0x1f7402(0x1f7))var _0x253e0f=users[_0x1f7402(0x1f7)];else{if(_0x3b9917[0x0][_0x1f7402(0x1b7)]=='Spanish')var _0x253e0f=users[_0x1f7402(0x1e3)];else{if(_0x3b9917[0x0][_0x1f7402(0x1b7)]==_0x1f7402(0x1e7))var _0x253e0f=users[_0x1f7402(0x1e7)];else{if(_0x3b9917[0x0][_0x1f7402(0x1b7)]==_0x1f7402(0x205))var _0x253e0f=users[_0x1f7402(0x227)];else{if(_0x3b9917[0x0][_0x1f7402(0x1b7)]==_0x1f7402(0x1fd))var _0x253e0f=users[_0x1f7402(0x1fd)];else{if(_0x3b9917[0x0][_0x1f7402(0x1b7)]==_0x1f7402(0x24a))var _0x253e0f=users['Arabic'];}}}}}}}_0x1fa7a8[_0x1f7402(0x224)](_0x1f7402(0x1c0),{'success':_0x4badf5[_0x1f7402(0x1d4)](_0x1f7402(0x1dc)),'errors':_0x4badf5[_0x1f7402(0x1d4)](_0x1f7402(0x1aa)),'role':_0x52972d,'profile':_0x43711f,'alldata':_0x1f1e0a,'master_shop':_0x3b9917,'language':_0x253e0f}),console['log'](alldata);}catch(_0x4c71d1){console[_0x1f7402(0x1df)](_0x4c71d1);}}),router['post'](a0_0x29ec7b(0x198),async(_0xaa20e4,_0x4e0e27)=>{var _0x414e43=a0_0x29ec7b;const {product_code:_0x4d1ad7}=_0xaa20e4[_0x414e43(0x15d)];var _0x236d09;const _0xbc1ae7=await product[_0x414e43(0x1a1)]([{'$match':{'primary_code':_0x4d1ad7,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x414e43(0x199),'name':{'$first':_0x414e43(0x229)},'category':{'$first':'$category'},'brand':{'$first':_0x414e43(0x14e)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x414e43(0x23a)},'product_code':{'$first':_0x414e43(0x150)},'primary_code':{'$first':_0x414e43(0x20c)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x414e43(0x16b)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x414e43(0x216)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2f5fee=await product[_0x414e43(0x1a1)]([{'$match':{'secondary_code':_0x4d1ad7}},{'$group':{'_id':_0x414e43(0x199),'name':{'$first':_0x414e43(0x229)},'category':{'$first':_0x414e43(0x238)},'brand':{'$first':_0x414e43(0x14e)},'unit':{'$first':_0x414e43(0x24b)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x414e43(0x150)},'primary_code':{'$first':_0x414e43(0x20c)},'secondary_code':{'$first':_0x414e43(0x15c)},'maxStocks':{'$first':_0x414e43(0x16b)},'maxProdPerUnit':{'$first':_0x414e43(0x19b)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x414e43(0x216)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0xbc1ae7['length']>0x0)_0x236d09=_0xbc1ae7;else _0x2f5fee[_0x414e43(0x23f)]>0x0&&(_0x236d09=_0x2f5fee);_0x4e0e27[_0x414e43(0x15a)](_0x236d09);}),router['post']('/CheckingWarehouse',async(_0x3bf769,_0x7ac9ca)=>{var _0x845183=a0_0x29ec7b;const {productCode:_0x103061,bay:_0x1bf842,warehouses:_0x208338,room:_0x45cee4}=_0x3bf769['body'];console['log'](_0x3bf769[_0x845183(0x15d)]);try{const _0x37acfa=await warehouse[_0x845183(0x1a1)]([{'$match':{'name':_0x208338,'room':_0x45cee4}},{'$unwind':_0x845183(0x212)},{'$match':{'product_details.bay':parseInt(_0x1bf842)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x845183(0x1e4)},'product_stock':{'$first':_0x845183(0x1a9)},'bay':{'$first':_0x845183(0x159)},'maxProducts':{'$first':_0x845183(0x186)}}}]);_0x7ac9ca['status'](0xc8)[_0x845183(0x15a)](_0x37acfa);}catch(_0x4e1990){_0x7ac9ca[_0x845183(0x1ea)](0x194)[_0x845183(0x15a)]({'message':_0x4e1990['message']});}}),module[a0_0x29ec7b(0x1a7)]=router;