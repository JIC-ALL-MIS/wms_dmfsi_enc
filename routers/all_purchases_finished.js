var a0_0xe752c0=a0_0x3f7f;(function(_0x1067b1,_0xf2bed3){var _0x118ce6=a0_0x3f7f,_0x308260=_0x1067b1();while(!![]){try{var _0x3fe62d=-parseInt(_0x118ce6(0x13f))/0x1*(-parseInt(_0x118ce6(0x1aa))/0x2)+-parseInt(_0x118ce6(0xca))/0x3+-parseInt(_0x118ce6(0xfd))/0x4+parseInt(_0x118ce6(0x14d))/0x5*(parseInt(_0x118ce6(0x16f))/0x6)+-parseInt(_0x118ce6(0x168))/0x7+parseInt(_0x118ce6(0x140))/0x8*(-parseInt(_0x118ce6(0x15c))/0x9)+-parseInt(_0x118ce6(0x171))/0xa*(-parseInt(_0x118ce6(0x1a3))/0xb);if(_0x3fe62d===_0xf2bed3)break;else _0x308260['push'](_0x308260['shift']());}catch(_0x409b2b){_0x308260['push'](_0x308260['shift']());}}}(a0_0x5ace,0x54f18));const express=require(a0_0xe752c0(0xd0)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0xe752c0(0x19a)),auth=require(a0_0xe752c0(0x198)),nodemailer=require(a0_0xe752c0(0xd7));var ejs=require('ejs');const path=require(a0_0xe752c0(0x156)),users=require(a0_0xe752c0(0xcb));router['get']('/view',auth,async(_0x1b44e0,_0x597d70)=>{var _0x19a764=a0_0xe752c0;try{const {username:_0x1dc455,email:_0x109f0d,role:_0x16c5d0}=_0x1b44e0[_0x19a764(0x1a1)],_0x2f9b90=_0x1b44e0[_0x19a764(0x1a1)],_0x27dd15=await profile[_0x19a764(0xc5)]({'email':_0x2f9b90[_0x19a764(0x114)]}),_0x684d32=await staff[_0x19a764(0xc5)]({'email':_0x2f9b90[_0x19a764(0x114)]});if(_0x2f9b90['role']==_0x19a764(0x187)){const _0x542afa=await staff[_0x19a764(0xc5)]({'email':_0x2f9b90[_0x19a764(0x114)]});}const _0x2af8b1=await master_shop[_0x19a764(0x17a)]();let _0x2679db;if(_0x2f9b90[_0x19a764(0x11a)]==_0x19a764(0x187)){const _0x247ead=await staff[_0x19a764(0xc5)]({'email':_0x2f9b90[_0x19a764(0x114)]});_0x2679db=await purchases_finished[_0x19a764(0x19b)]([{'$match':{'warehouse_name':_0x247ead['warehouse']}},{'$lookup':{'from':_0x19a764(0x13b),'localField':_0x19a764(0x13b),'foreignField':_0x19a764(0x189),'as':_0x19a764(0x100)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x19a764(0x1a5)},{'$group':{'_id':'$_id','invoice':{'$first':_0x19a764(0x19d)},'suppliers':{'$first':_0x19a764(0xd8)},'date':{'$first':_0x19a764(0xc3)},'warehouse_name':{'$first':_0x19a764(0xb5)},'room':{'$first':_0x19a764(0xea)},'product':{'$push':_0x19a764(0x1a5)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x19a764(0xcc)},'due_amount':{'$first':_0x19a764(0xb4)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x19a764(0x1ad)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x19a764(0xda)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x19a764(0x183)},'type':{'$addToSet':_0x19a764(0x112)},'floorlevel':{'$addToSet':_0x19a764(0xe8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2679db=await purchases_finished[_0x19a764(0x19b)]([{'$unwind':'$product'},{'$group':{'_id':_0x19a764(0xe5),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x19a764(0xd8)},'date':{'$first':_0x19a764(0xc3)},'warehouse_name':{'$first':_0x19a764(0xb5)},'room':{'$addToSet':_0x19a764(0x158)},'product':{'$push':_0x19a764(0x1a5)},'note':{'$first':_0x19a764(0x173)},'paid_amount':{'$first':_0x19a764(0xcc)},'due_amount':{'$first':_0x19a764(0xb4)},'return_data':{'$first':_0x19a764(0x184)},'batch_code':{'$first':_0x19a764(0x1ad)},'expiry_date':{'$first':_0x19a764(0x162)},'suppliers_docs':{'$first':_0x19a764(0xda)},'total_product_quantity':{'$sum':_0x19a764(0x111)},'level':{'$addToSet':_0x19a764(0xb2)},'isle':{'$addToSet':_0x19a764(0x183)},'type':{'$addToSet':_0x19a764(0x112)},'floorlevel':{'$addToSet':_0x19a764(0xe8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x2af8b1[0x0][_0x19a764(0xce)]==_0x19a764(0xae))var _0x136aad=users['English'];else{if(_0x2af8b1[0x0][_0x19a764(0xce)]==_0x19a764(0xdb))var _0x136aad=users[_0x19a764(0xdb)];else{if(_0x2af8b1[0x0]['language']==_0x19a764(0x14c))var _0x136aad=users['German'];else{if(_0x2af8b1[0x0]['language']==_0x19a764(0x14f))var _0x136aad=users[_0x19a764(0x14f)];else{if(_0x2af8b1[0x0][_0x19a764(0xce)]==_0x19a764(0x137))var _0x136aad=users[_0x19a764(0x137)];else{if(_0x2af8b1[0x0][_0x19a764(0xce)]==_0x19a764(0x178))var _0x136aad=users[_0x19a764(0x10a)];else{if(_0x2af8b1[0x0][_0x19a764(0xce)]==_0x19a764(0xdf))var _0x136aad=users[_0x19a764(0xdf)];else{if(_0x2af8b1[0x0]['language']==_0x19a764(0xb9))var _0x136aad=users['Arabic'];}}}}}}}_0x597d70[_0x19a764(0x15a)](_0x19a764(0x197),{'success':_0x1b44e0[_0x19a764(0xf5)]('success'),'errors':_0x1b44e0[_0x19a764(0xf5)](_0x19a764(0x152)),'purchases':_0x2679db,'role':_0x2f9b90,'profile':_0x27dd15,'master_shop':_0x2af8b1,'language':_0x136aad});}catch(_0xd30b97){console[_0x19a764(0x122)]('table\x20page',_0xd30b97),_0x597d70['status'](0xc8)['json']({'message':_0xd30b97[_0x19a764(0xb1)]});}});function BayBinSelected(_0x488c6b,_0x47a2ee){var _0x198c75=a0_0xe752c0,_0x5c430a=[],_0x419a31=[];if(_0x488c6b==_0x198c75(0x188)){switch(_0x47a2ee){case'Rack\x201':_0x5c430a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x198c75(0x199):_0x5c430a=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x419a31=['DG'];}else{if(_0x488c6b==_0x198c75(0x1ab)){switch(_0x47a2ee){case'Rack\x201':_0x5c430a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x198c75(0x199):_0x5c430a=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x419a31=['FG'];}}return{'levels':_0x5c430a,'identify':_0x419a31};}function a0_0x3f7f(_0x2dd9fb,_0x3d7efa){var _0x5ace1e=a0_0x5ace();return a0_0x3f7f=function(_0x3f7f94,_0x4bf94c){_0x3f7f94=_0x3f7f94-0xac;var _0x51c839=_0x5ace1e[_0x3f7f94];return _0x51c839;},a0_0x3f7f(_0x2dd9fb,_0x3d7efa);}function a0_0x5ace(){var _0x4b4dd2=['success','$unit','stock_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','getDate','catch','prod_qty','quantity','</table>','Enclosed','</tr>','MaxStocks_data','concat','French','$product_details.bin','error','primary_code_hide','suppliers','</body></html>','then','product_stock','38RaxIKL','10000COthov','createTransport','level','currency','map','string','$product_details.maxProducts','$secondary_unit','add_purchases_finished','/upload/','</thead>','Paid\x20For\x20Purchase','German','80GydZiL','/preview/:id','Spanish','floor','warehouse_name','errors','QA\x20Warehouse','$name','toString','path','abs','$product.room_name','<html><head><title></title>','render','warehouse','3303DiqfVq','prod_Qty','gmail','master','maxperunit','/barcode/:id','$expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','RoomAssign','</div>','return_data','/give_payment/:id','149513ZscGVU','getMonth','<hr\x20class=\x22my-3\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','get','224310TwoKLR','return_product','770320mekEWx','standard_unit','$note','prod_invoice','</h5>','prod_name','invoice','Portuguese\x20(BR)','slice','find','all_purchases_barcode','prod_secondunit','port','exports','amount','Ambient','purchases\x20item\x20return\x20successfull','$brand','$product.bin','$return_data','add_purchases\x20error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','staff','DRY\x20GOODS','name','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','INCF-','$product_details._id','product_code','Error\x20Occurs','secondary_unit','Finished\x20Goods','Enabled','json','$maxProdPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','product_code_hide','all_purchases_finished','../middleware/auth','Rack\x202','../models/all_models','aggregate','$maxStocks','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</head><body>','user','<span\x20style=\x22float:\x20right;\x22>','77ydZSJj','/../public','$product','expiry_date','</tbody>','English','user_id','31624NTnTTZ','FROZEN\x20GOODS','findById','$batch_code','params','return_purchase_finished','English\x20(US)','stock_quantity','post','message','$product.bay','status','$due_amount','$warehouse_name','/view/return_purchase/:id','primary_code','POnumber','Arabic\x20(ae)','$product_details.bay','maxStocks','/view/add_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<tr>','<!DOCTYPE\x20html>','$product_details.type','prod_level','Error\x20occurred\x20while\x20processing\x20product:','$date','getFullYear','findOne','/view/add_purchases/:id','secondary_code_hide','$product_details.storage','redirect','1294767oTwxpe','../public/language/languages.json','$paid_amount','body','language','There\x27s\x20a\x20error\x20in\x20this\x20transaction','express','<tbody\x20style=\x22text-align:\x20center;\x22>','currency_placement','An\x20error\x20occurred\x20while\x20saving\x20data.','length','paid_amount','bay','nodemailer','$suppliers','/all_purchases_finished/view','$suppliers_docs','Hindi','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product','<div>','Chinese','save','payment\x20successfull','sendMail','room_name','$product_details.primary_code','$_id','password','edit_purchases_finished','$product.floorlevel','edit_purchases_finished_view','$room','secondary_code','forEach','stocks','</span>','all','<strong>\x20Regards\x20</strong>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$secondary_code','Room_name','_id','flash','<h2>\x20','site_title','\x20Order\x20Date\x20:\x20','logo','Email\x20sent\x20successfully','$primary_code','product_details','1914456vMobkq','<h5\x20style=\x22text-align:\x20left;\x22>','$category','suppliers_docs','$product_details.product_name','\x20Order\x20Number\x20:\x20','date','product_cat','prod_code','True','room','Return\x20Goods','prod_cat','Portuguese','updateOne','prod_unit','image','</td>','batch_code','$product_details.product_stock','$product.quantity','$product.type','prod_primunit','email','$product_details','/all_purchases/view','product_name','random','\x20</h2>','role','/CheckingWarehouse','Purchase\x20Return','/view/:id','production_date','return_qty','max_product_unit','purchase_quantity','log','$product_details.product_code','product_date','Arabic','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'];a0_0x5ace=function(){return _0x4b4dd2;};return a0_0x5ace();}async function getRandom8DigitNumber(){var _0xa9d4e3=a0_0xe752c0;const _0x17b2d1=0x989680,_0x29bed4=0x5f5e0ff,_0x31106c=Math[_0xa9d4e3(0x150)](Math[_0xa9d4e3(0x118)]()*(_0x29bed4-_0x17b2d1+0x1))+_0x17b2d1;var _0x1f54cc;const _0x316f6e=await purchases_finished[_0xa9d4e3(0xc5)]({'invoice':_0xa9d4e3(0x18c)+_0x31106c});return _0x316f6e&&_0x316f6e['length']>0x0?_0x1f54cc=_0xa9d4e3(0x18c)+_0x31106c:_0x1f54cc='INCF-'+_0x31106c,_0x1f54cc;}router[a0_0xe752c0(0x16e)]('/view/add_purchases',auth,async(_0x5afab1,_0x459ca1)=>{var _0x52b541=a0_0xe752c0;try{const {username:_0x14149a,email:_0x2333b8,role:_0x5dfdb6}=_0x5afab1['user'],_0x14b5b3=_0x5afab1[_0x52b541(0x1a1)],_0x16aba0=await profile['findOne']({'email':_0x14b5b3['email']}),_0x191832=await master_shop[_0x52b541(0x17a)](),_0x217e3c=await staff[_0x52b541(0xc5)]({'email':_0x14b5b3[_0x52b541(0x114)]}),_0x3b591f=await suppliers['find']({});let _0x192f5e;if(_0x14b5b3[_0x52b541(0x11a)]==_0x52b541(0x187)){const _0x1c386d=await staff[_0x52b541(0xc5)]({'email':_0x14b5b3[_0x52b541(0x114)]});_0x192f5e=await warehouse[_0x52b541(0x19b)]([{'$match':{'status':_0x52b541(0x192),'name':_0x1c386d[_0x52b541(0x15b)],'warehouse_category':_0x52b541(0x191)}},{'$group':{'_id':'$name','name':{'$first':_0x52b541(0x154)}}}]);}else _0x192f5e=await warehouse['aggregate']([{'$match':{'status':_0x52b541(0x192),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x52b541(0x153)}}},{'$group':{'_id':_0x52b541(0x154),'name':{'$first':_0x52b541(0x154)}}}]);const _0x49924b=await product[_0x52b541(0x17a)]({}),_0x426ea7=await warehouse['find']({'status':'Enabled'}),_0x46533e=await purchases_finished[_0x52b541(0x17a)]({}),_0x26e66e=_0x46533e[_0x52b541(0xd4)]+0x1,_0x4086fe=_0x52b541(0x18c)+_0x26e66e[_0x52b541(0x155)]()['padStart'](0x5,'0');var _0x3af4e4=[_0x52b541(0x180),_0x52b541(0x133)];if(_0x191832[0x0]['language']==_0x52b541(0xae))var _0x2a4bc7=users[_0x52b541(0x1a8)];else{if(_0x191832[0x0][_0x52b541(0xce)]==_0x52b541(0xdb))var _0x2a4bc7=users[_0x52b541(0xdb)];else{if(_0x191832[0x0][_0x52b541(0xce)]==_0x52b541(0x14c))var _0x2a4bc7=users['German'];else{if(_0x191832[0x0][_0x52b541(0xce)]==_0x52b541(0x14f))var _0x2a4bc7=users[_0x52b541(0x14f)];else{if(_0x191832[0x0][_0x52b541(0xce)]==_0x52b541(0x137))var _0x2a4bc7=users[_0x52b541(0x137)];else{if(_0x191832[0x0][_0x52b541(0xce)]==_0x52b541(0x178))var _0x2a4bc7=users[_0x52b541(0x10a)];else{if(_0x191832[0x0]['language']==_0x52b541(0xdf))var _0x2a4bc7=users[_0x52b541(0xdf)];else{if(_0x191832[0x0]['language']=='Arabic\x20(ae)')var _0x2a4bc7=users[_0x52b541(0x125)];}}}}}}}const _0x160111=getRandom8DigitNumber();_0x160111[_0x52b541(0x13d)](_0x532fba=>{var _0x582ce5=_0x52b541;_0x459ca1[_0x582ce5(0x15a)](_0x582ce5(0x148),{'success':_0x5afab1[_0x582ce5(0xf5)](_0x582ce5(0x12a)),'errors':_0x5afab1[_0x582ce5(0xf5)](_0x582ce5(0x152)),'role':_0x14b5b3,'profile':_0x16aba0,'suppliers':_0x3b591f,'warehouse':_0x192f5e,'product':_0x49924b,'invoice':_0x532fba,'master_shop':_0x191832,'language':_0x2a4bc7,'find_data':_0x426ea7,'rooms_data':_0x3af4e4});})[_0x52b541(0x12f)](_0x1e45f4=>{var _0x24f27f=_0x52b541;_0x5afab1['flash'](_0x24f27f(0x152),_0x24f27f(0xcf)),_0x459ca1[_0x24f27f(0xc9)]('/all_purchases_finished/view');});}catch(_0x251e64){console[_0x52b541(0x122)](_0x251e64);}}),router[a0_0xe752c0(0x16e)](a0_0xe752c0(0xc6),auth,async(_0x27f4c9,_0x574ad5)=>{var _0x3dfd2a=a0_0xe752c0;try{const _0x43d1b7=_0x27f4c9[_0x3dfd2a(0xac)]['id'];console[_0x3dfd2a(0x122)](_0x43d1b7);const _0x34279d=await master_shop[_0x3dfd2a(0x17a)]();console[_0x3dfd2a(0x122)](_0x3dfd2a(0x15f),_0x34279d);const _0x61f5c=await product[_0x3dfd2a(0xc5)]({'name':_0x43d1b7});console['log']('product',_0x61f5c),_0x574ad5[_0x3dfd2a(0xb3)](0xc8)[_0x3dfd2a(0x193)]({'product_data':_0x61f5c,'master':_0x34279d});}catch(_0x200e3d){console['log'](_0x3dfd2a(0x185),_0x200e3d);}}),router[a0_0xe752c0(0xb0)](a0_0xe752c0(0xbc),auth,async(_0x393504,_0x43a5ef)=>{var _0x49d4d5=a0_0xe752c0;try{const {invoice:_0x1af33,date:_0x2cb9a5,warehouse_name:_0x5119aa,prod_name:_0x4b9d62,prod_code:_0x1cdcc8,prod_qty:_0x1c5fff,prod_unit:_0x582f20,prod_secondunit:_0x4dc5a5,prod_level:_0x463092,prod_isle:_0x31784f,prod_pallet:_0x778aa8,note:_0x34cb85,expiry_date:_0x2479f2,batch_code:_0x42e655,payable:_0x5b94c8,due_amount:_0x52ba8a,Room_name:_0x5ac16c,primary_code:_0x22948b,secondary_code:_0x40a3d6,MaxStocks_data:_0x19a23d,PO_number:_0x3b259a,SCRN:_0x165c8a,JO_number:_0x7ed9c}=_0x393504[_0x49d4d5(0xcd)];if(typeof _0x4b9d62==_0x49d4d5(0x145))var _0x2c42e9=[_0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x176)]],_0x2add08=[_0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x105)]],_0x336da0=[_0x393504[_0x49d4d5(0xcd)]['prod_Qty']],_0x1934de=[_0x393504[_0x49d4d5(0xcd)]['prod_primunit']],_0x3bada6=[_0x393504['body']['prod_secondunit']],_0xf28c53=[_0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0xc1)]],_0x2362bb=[_0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0xb7)]],_0x10d893=[_0x393504['body']['secondary_code']],_0x56907c=[_0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x135)]],_0x5c3ccf=[_0x393504[_0x49d4d5(0xcd)]['batch_code']],_0xed8213=[_0x393504[_0x49d4d5(0xcd)]['expiry_date']],_0x51bbc2=[_0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x124)]],_0x51b29e=[_0x393504['body'][_0x49d4d5(0x120)]],_0xfa4918=[_0x393504['body'][_0x49d4d5(0x109)]],_0x1f7259=[_0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x164)]],_0x1ef133=[_0x393504['body'][_0x49d4d5(0x174)]];else var _0x2c42e9=[..._0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x176)]],_0x2add08=[..._0x393504[_0x49d4d5(0xcd)]['prod_code']],_0x336da0=[..._0x393504['body'][_0x49d4d5(0x15d)]],_0x1934de=[..._0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x113)]],_0x3bada6=[..._0x393504['body'][_0x49d4d5(0x17c)]],_0xf28c53=[..._0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0xc1)]],_0x2362bb=[..._0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0xb7)]],_0x10d893=[..._0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0xeb)]],_0x56907c=[..._0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x135)]],_0x5c3ccf=[..._0x393504[_0x49d4d5(0xcd)]['batch_code']],_0xed8213=[..._0x393504['body']['expiry_date']],_0x51bbc2=[..._0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x124)]],_0x51b29e=[..._0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x120)]],_0xfa4918=[..._0x393504['body']['prod_cat']],_0x1f7259=[..._0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x164)]],_0x1ef133=[..._0x393504['body'][_0x49d4d5(0x174)]];const _0x51e460=_0x2c42e9[_0x49d4d5(0x144)](_0x5779b3=>{return _0x5779b3={'product_name':_0x5779b3};});_0x2add08[_0x49d4d5(0xec)]((_0x26890a,_0x2e15f5)=>{var _0x54eab4=_0x49d4d5;_0x51e460[_0x2e15f5][_0x54eab4(0x18e)]=_0x26890a;}),_0x336da0[_0x49d4d5(0xec)]((_0x2807f6,_0x1362b1)=>{var _0x2624ea=_0x49d4d5;_0x51e460[_0x1362b1][_0x2624ea(0x131)]=Math[_0x2624ea(0x157)](_0x2807f6);}),_0x1934de['forEach']((_0x58b34d,_0x569046)=>{_0x51e460[_0x569046]['standard_unit']=_0x58b34d;}),_0x3bada6[_0x49d4d5(0xec)]((_0x440c3b,_0x29b7b0)=>{_0x51e460[_0x29b7b0]['secondary_unit']=_0x440c3b;}),_0xf28c53[_0x49d4d5(0xec)]((_0x354ee2,_0x2bab32)=>{var _0x247764=_0x49d4d5;_0x51e460[_0x2bab32][_0x247764(0xd6)]=_0x354ee2;}),_0x2362bb[_0x49d4d5(0xec)]((_0x43c04f,_0x4ad433)=>{var _0x80f83b=_0x49d4d5;_0x51e460[_0x4ad433][_0x80f83b(0xb7)]=_0x43c04f;}),_0x10d893[_0x49d4d5(0xec)]((_0x5014c4,_0x4b569e)=>{var _0x505281=_0x49d4d5;_0x51e460[_0x4b569e][_0x505281(0xeb)]=_0x5014c4;}),_0x56907c[_0x49d4d5(0xec)]((_0x335225,_0x1e5dea)=>{var _0x5547b6=_0x49d4d5;_0x51e460[_0x1e5dea][_0x5547b6(0xbb)]=_0x335225;}),_0x5c3ccf['forEach']((_0x37d55c,_0x4a18f0)=>{var _0x36cff7=_0x49d4d5;_0x51e460[_0x4a18f0][_0x36cff7(0x10f)]=_0x37d55c;}),_0xed8213[_0x49d4d5(0xec)]((_0x45b88c,_0x258372)=>{var _0x44cc2a=_0x49d4d5;_0x51e460[_0x258372][_0x44cc2a(0x1a6)]=_0x45b88c;}),_0x51bbc2[_0x49d4d5(0xec)]((_0x7f41cf,_0x1572ad)=>{var _0x1aa91d=_0x49d4d5;_0x51e460[_0x1572ad][_0x1aa91d(0x11e)]=_0x7f41cf;}),_0x51b29e[_0x49d4d5(0xec)]((_0x5df562,_0x53ee4c)=>{var _0xf779fa=_0x49d4d5;_0x51e460[_0x53ee4c][_0xf779fa(0x160)]=_0x5df562;}),_0xfa4918[_0x49d4d5(0xec)]((_0x365242,_0x4bafd3)=>{var _0x164b65=_0x49d4d5;_0x51e460[_0x4bafd3][_0x164b65(0x104)]=_0x365242;}),_0x1f7259['forEach']((_0x4e5b7b,_0x1e880f)=>{var _0x242196=_0x49d4d5;_0x51e460[_0x1e880f][_0x242196(0xe3)]=_0x4e5b7b;}),_0x1ef133[_0x49d4d5(0xec)]((_0x10ecc2,_0x54781a)=>{var _0x2335af=_0x49d4d5;_0x51e460[_0x54781a][_0x2335af(0x177)]=_0x10ecc2;});const _0x298ea6=_0x51e460['filter'](_0x49968e=>_0x49968e[_0x49d4d5(0x131)]!=='0'&&_0x49968e[_0x49d4d5(0x131)]!==''),_0x5af21f=new purchases_finished({'invoice':_0x1af33,'suppliers':_0x393504[_0x49d4d5(0xcd)][_0x49d4d5(0x13b)],'date':_0x2cb9a5,'warehouse_name':_0x5119aa,'product':_0x298ea6,'note':_0x34cb85,'due_amount':_0x52ba8a,'room':_0x5ac16c,'POnumber':_0x3b259a,'SCRN':_0x165c8a,'JO_number':_0x7ed9c}),_0x501954=await _0x5af21f[_0x49d4d5(0xe0)](),_0x4f1438=await purchases_finished[_0x49d4d5(0xc5)]({'invoice':_0x1af33}),_0x5df5de=_0x4f1438[_0x49d4d5(0xdd)][_0x49d4d5(0x144)](async _0x4aeaac=>{var _0x55c2b2=_0x49d4d5;try{var _0x5e3c2f=await warehouse[_0x55c2b2(0xc5)]({'name':_0x5119aa,'room':_0x4aeaac[_0x55c2b2(0xe3)]}),_0x35c401=0x0;const _0x32bab3=_0x5e3c2f[_0x55c2b2(0xfc)][_0x55c2b2(0x144)](_0x18a878=>{var _0x112a64=_0x55c2b2;console['log'](_0x18a878[_0x112a64(0x117)]+'=='+_0x4aeaac['product_name']+'&&'+_0x18a878[_0x112a64(0xd6)]+'=='+_0x4aeaac[_0x112a64(0xd6)]+'&&'+_0x18a878['expiry_date']+'=='+_0x4aeaac[_0x112a64(0x1a6)]+'&&'+_0x18a878[_0x112a64(0x11e)]+'=='+_0x4aeaac[_0x112a64(0x11e)]+'&&'+_0x18a878[_0x112a64(0x10f)]+'=='+_0x4aeaac['batch_code']+'&&'+_0x18a878['invoice']+'=='+_0x4f1438[_0x112a64(0x177)]),_0x18a878['product_name']==_0x4aeaac[_0x112a64(0x117)]&&_0x18a878['bay']==_0x4aeaac['bay']&&_0x18a878[_0x112a64(0x1a6)]==_0x4aeaac['expiry_date']&&_0x18a878[_0x112a64(0x11e)]==_0x4aeaac[_0x112a64(0x11e)]&&_0x18a878[_0x112a64(0x10f)]==_0x4aeaac[_0x112a64(0x10f)]&&_0x18a878[_0x112a64(0x177)]==_0x4f1438[_0x112a64(0x177)]&&(_0x18a878[_0x112a64(0x13e)]=Math[_0x112a64(0x157)](_0x18a878[_0x112a64(0x13e)])+Math[_0x112a64(0x157)](_0x4aeaac['quantity']),_0x35c401++);});return _0x35c401==0x0&&(_0x5e3c2f['product_details']=_0x5e3c2f[_0x55c2b2(0xfc)][_0x55c2b2(0x136)]({'product_name':_0x4aeaac['product_name'],'product_stock':Math[_0x55c2b2(0x157)](_0x4aeaac[_0x55c2b2(0x131)]),'primary_code':_0x4aeaac['primary_code'],'secondary_code':_0x4aeaac[_0x55c2b2(0xeb)],'product_code':_0x4aeaac['product_code'],'bay':_0x4aeaac[_0x55c2b2(0xd6)],'maxProducts':_0x4aeaac['maxStocks'],'unit':_0x4aeaac[_0x55c2b2(0x172)],'secondary_unit':_0x4aeaac[_0x55c2b2(0x190)],'expiry_date':_0x4aeaac[_0x55c2b2(0x1a6)],'production_date':_0x4aeaac[_0x55c2b2(0x11e)],'maxProducts':_0x4aeaac[_0x55c2b2(0xbb)],'maxPerUnit':_0x4aeaac['maxperunit'],'batch_code':_0x4aeaac[_0x55c2b2(0x10f)],'product_cat':_0x4aeaac[_0x55c2b2(0x104)],'invoice':_0x4aeaac[_0x55c2b2(0x177)],'id_incoming':_0x4aeaac[_0x55c2b2(0xf4)]})),_0x5e3c2f;}catch(_0x31f727){return console[_0x55c2b2(0x139)](_0x55c2b2(0xc2),_0x31f727),null;}});Promise[_0x49d4d5(0xef)](_0x5df5de)[_0x49d4d5(0x13d)](async _0xe97f34=>{var _0x225ee7=_0x49d4d5;try{for(const _0x1fb800 of _0xe97f34){await warehouse[_0x225ee7(0x10b)]({'_id':_0x1fb800[_0x225ee7(0xf4)]},{'$addToSet':{'product_details':{'$each':_0x1fb800[_0x225ee7(0xfc)]}}});}const _0x378470=await master_shop['find'](),_0x20db90=await email_settings[_0x225ee7(0xc5)](),_0x16e2d7=await supervisor_settings[_0x225ee7(0x17a)]();var _0x1f885c=_0x4f1438['product'],_0x1de9e5='',_0x12e7cb;for(_0x12e7cb in _0x1f885c){var _0x14fda6='FG';_0x4f1438[_0x225ee7(0x151)]==_0x225ee7(0x188)&&(_0x14fda6='DG'),_0x1de9e5+=_0x225ee7(0xbe)+_0x225ee7(0x19f)+_0x1f885c[_0x12e7cb]['product_name']+_0x225ee7(0x10e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f885c[_0x12e7cb]['product_code']+_0x225ee7(0x10e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f885c[_0x12e7cb][_0x225ee7(0x131)]+_0x225ee7(0x10e)+_0x225ee7(0x19f)+_0x1f885c[_0x12e7cb][_0x225ee7(0x172)]+_0x225ee7(0x10e)+_0x225ee7(0x19f)+_0x1f885c[_0x12e7cb]['secondary_unit']+'</td>'+_0x225ee7(0x19f)+_0x4f1438[_0x225ee7(0x151)]+_0x225ee7(0x10e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f885c[_0x12e7cb][_0x225ee7(0xe3)]+_0x225ee7(0x10e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x14fda6+_0x1f885c[_0x12e7cb][_0x225ee7(0xd6)]+'</td>',_0x225ee7(0x134);}let _0x56826d=nodemailer[_0x225ee7(0x141)]({'host':_0x20db90['host'],'port':Number(_0x20db90[_0x225ee7(0x17d)]),'secure':![],'auth':{'user':_0x20db90[_0x225ee7(0x114)],'pass':_0x20db90['password']}}),_0x5921d1={'from':_0x20db90[_0x225ee7(0x114)],'to':_0x16e2d7[0x0]['FGSEmail'],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x225ee7(0x126),'path':__dirname+'/../public'+_0x225ee7(0x149)+_0x378470[0x0][_0x225ee7(0x10d)],'cid':'logo'}],'html':_0x225ee7(0xbf)+_0x225ee7(0x159)+_0x225ee7(0x1a0)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x225ee7(0xde)+_0x225ee7(0x16b)+_0x225ee7(0x165)+'<div>'+'<h2>\x20'+_0x378470[0x0][_0x225ee7(0xf7)]+_0x225ee7(0x119)+_0x225ee7(0x165)+'</div>'+_0x225ee7(0x16a)+_0x225ee7(0xde)+_0x225ee7(0xfe)+_0x225ee7(0x102)+_0x4f1438['invoice']+'\x20'+_0x225ee7(0x1a2)+_0x225ee7(0xf8)+_0x4f1438['date']+'\x20'+'</span>'+'</h5>'+_0x225ee7(0x165)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x225ee7(0xdc)+'<tr>'+_0x225ee7(0x129)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x225ee7(0x12d)+_0x225ee7(0x19e)+_0x225ee7(0xbd)+_0x225ee7(0x163)+_0x225ee7(0x18b)+_0x225ee7(0x195)+_0x225ee7(0x134)+_0x225ee7(0x14a)+_0x225ee7(0xd1)+'\x20'+_0x1de9e5+'\x20'+_0x225ee7(0x1a7)+_0x225ee7(0x132)+_0x225ee7(0xde)+_0x225ee7(0xf0)+_0x225ee7(0x16c)+_0x378470[0x0]['site_title']+'</h5>'+_0x225ee7(0x165)+_0x225ee7(0x165)+_0x225ee7(0x13c)};_0x56826d['sendMail'](_0x5921d1,function(_0x3eefdc,_0x5e7e5b){var _0x2b21c3=_0x225ee7;_0x3eefdc?(console[_0x2b21c3(0x122)](_0x3eefdc),console[_0x2b21c3(0x122)](_0x2b21c3(0x18f))):console['log']('Email\x20sent\x20successfully');});}catch(_0x9631c3){console['error'](_0x9631c3),_0x43a5ef[_0x225ee7(0xb3)](0x1f4)[_0x225ee7(0x193)]({'error':_0x225ee7(0xd3),'message':_0x9631c3[_0x225ee7(0xb1)]});}})[_0x49d4d5(0x12f)](_0x1d06cb=>{var _0x4a9762=_0x49d4d5;console[_0x4a9762(0x139)](_0x1d06cb);}),_0x393504[_0x49d4d5(0xf5)](_0x49d4d5(0x12a),'purchase\x20data\x20add\x20successfully'),_0x43a5ef['redirect']('/all_purchases_finished/view');}catch(_0x2b29c9){console[_0x49d4d5(0x122)](_0x2b29c9);}}),router[a0_0xe752c0(0x16e)](a0_0xe752c0(0x14e),auth,async(_0xb5bea6,_0x18d32c)=>{var _0xaeb5e7=a0_0xe752c0;try{const {username:_0x30d08a,email:_0x5e7cb4,role:_0x417362}=_0xb5bea6[_0xaeb5e7(0x1a1)],_0x4dc133=_0xb5bea6[_0xaeb5e7(0x1a1)],_0x24d51f=await profile['findOne']({'email':_0x4dc133[_0xaeb5e7(0x114)]}),_0x269ce2=await master_shop[_0xaeb5e7(0x17a)](),_0x56c18d=_0xb5bea6[_0xaeb5e7(0xac)]['id'],_0x51f897=await purchases_finished['findById'](_0x56c18d),_0x866946=await suppliers[_0xaeb5e7(0x17a)]({});let _0x39908b;if(_0x4dc133[_0xaeb5e7(0x11a)]=='staff'){const _0x1be04b=await staff['findOne']({'email':_0x4dc133[_0xaeb5e7(0x114)]});_0x39908b=await warehouse['find']({'status':'Enabled','name':_0x1be04b['warehouse'],'warehouse_category':_0xaeb5e7(0x191)});}else _0x39908b=await warehouse[_0xaeb5e7(0x19b)]([{'$match':{'status':_0xaeb5e7(0x192),'warehouse_category':_0xaeb5e7(0x191)}},{'$group':{'_id':_0xaeb5e7(0x154),'name':{'$first':_0xaeb5e7(0x154)}}}]);const _0x474d4c=await product['find']({}),_0x57e4c0=BayBinSelected(_0x51f897[_0xaeb5e7(0x151)],_0x51f897[_0xaeb5e7(0x107)]);let _0xbde34c=new Date(_0x51f897[_0xaeb5e7(0x1a6)]),_0x3113b6=('0'+_0xbde34c['getDate']())[_0xaeb5e7(0x179)](-0x2),_0x23899e=('0'+(_0xbde34c['getMonth']()+0x1))['slice'](-0x2),_0x4a52be=_0xbde34c['getFullYear'](),_0x3fb6be=_0x4a52be+'-'+_0x23899e+'-'+_0x3113b6;if(_0x269ce2[0x0]['language']==_0xaeb5e7(0xae)){var _0x397846=users[_0xaeb5e7(0x1a8)];console[_0xaeb5e7(0x122)](_0x397846);}else{if(_0x269ce2[0x0][_0xaeb5e7(0xce)]==_0xaeb5e7(0xdb))var _0x397846=users[_0xaeb5e7(0xdb)];else{if(_0x269ce2[0x0][_0xaeb5e7(0xce)]==_0xaeb5e7(0x14c))var _0x397846=users[_0xaeb5e7(0x14c)];else{if(_0x269ce2[0x0][_0xaeb5e7(0xce)]=='Spanish')var _0x397846=users[_0xaeb5e7(0x14f)];else{if(_0x269ce2[0x0][_0xaeb5e7(0xce)]==_0xaeb5e7(0x137))var _0x397846=users['French'];else{if(_0x269ce2[0x0][_0xaeb5e7(0xce)]=='Portuguese\x20(BR)')var _0x397846=users[_0xaeb5e7(0x10a)];else{if(_0x269ce2[0x0][_0xaeb5e7(0xce)]==_0xaeb5e7(0xdf))var _0x397846=users[_0xaeb5e7(0xdf)];else{if(_0x269ce2[0x0][_0xaeb5e7(0xce)]=='Arabic\x20(ae)')var _0x397846=users[_0xaeb5e7(0x125)];}}}}}}}_0x18d32c[_0xaeb5e7(0x15a)](_0xaeb5e7(0xe9),{'success':_0xb5bea6[_0xaeb5e7(0xf5)](_0xaeb5e7(0x12a)),'errors':_0xb5bea6[_0xaeb5e7(0xf5)](_0xaeb5e7(0x152)),'role':_0x4dc133,'profile':_0x24d51f,'purchases':_0x51f897,'suppliers':_0x866946,'warehouse':_0x39908b,'product':_0x474d4c,'master_shop':_0x269ce2,'language':_0x397846,'ed_fullDate':_0x3fb6be,'dataSelected':_0x57e4c0});}catch(_0x5d7355){console[_0xaeb5e7(0x122)](_0x5d7355);}}),router[a0_0xe752c0(0x16e)](a0_0xe752c0(0x11d),auth,async(_0x46d2c8,_0x195b54)=>{var _0x1fb823=a0_0xe752c0;try{const {username:_0x4da881,email:_0x195076,role:_0x46dbf6}=_0x46d2c8[_0x1fb823(0x1a1)],_0xe4daee=_0x46d2c8['user'],_0x32892f=await profile[_0x1fb823(0xc5)]({'email':_0xe4daee[_0x1fb823(0x114)]}),_0x127132=await master_shop[_0x1fb823(0x17a)](),_0x2dda66=_0x46d2c8['params']['id'],_0x185aa8=await purchases_finished[_0x1fb823(0x1ac)](_0x2dda66),_0x19a189=await suppliers['find']({});let _0x5e0a6c;if(_0xe4daee['role']==_0x1fb823(0x187)){const _0x50a314=await staff[_0x1fb823(0xc5)]({'email':_0xe4daee['email']});_0x5e0a6c=await warehouse[_0x1fb823(0x17a)]({'status':'Enabled','name':_0x50a314[_0x1fb823(0x15b)],'warehouse_category':'Finished\x20Goods'});}else _0x5e0a6c=await warehouse[_0x1fb823(0x19b)]([{'$match':{'status':_0x1fb823(0x192),'warehouse_category':_0x1fb823(0x191)}},{'$group':{'_id':'$name','name':{'$first':_0x1fb823(0x154)}}}]);const _0x4059fe=await product[_0x1fb823(0x17a)]({}),_0x37d667=BayBinSelected(_0x185aa8['warehouse_name'],_0x185aa8['room']);let _0x13e781=new Date(_0x185aa8[_0x1fb823(0x1a6)]),_0x3300af=('0'+_0x13e781['getDate']())['slice'](-0x2),_0x4f310b=('0'+(_0x13e781['getMonth']()+0x1))[_0x1fb823(0x179)](-0x2),_0x39e99f=_0x13e781['getFullYear'](),_0x1e8b89=_0x39e99f+'-'+_0x4f310b+'-'+_0x3300af;if(_0x127132[0x0]['language']==_0x1fb823(0xae)){var _0x2f26f1=users[_0x1fb823(0x1a8)];console['log'](_0x2f26f1);}else{if(_0x127132[0x0][_0x1fb823(0xce)]==_0x1fb823(0xdb))var _0x2f26f1=users[_0x1fb823(0xdb)];else{if(_0x127132[0x0][_0x1fb823(0xce)]==_0x1fb823(0x14c))var _0x2f26f1=users['German'];else{if(_0x127132[0x0][_0x1fb823(0xce)]==_0x1fb823(0x14f))var _0x2f26f1=users['Spanish'];else{if(_0x127132[0x0][_0x1fb823(0xce)]==_0x1fb823(0x137))var _0x2f26f1=users[_0x1fb823(0x137)];else{if(_0x127132[0x0][_0x1fb823(0xce)]==_0x1fb823(0x178))var _0x2f26f1=users[_0x1fb823(0x10a)];else{if(_0x127132[0x0][_0x1fb823(0xce)]=='Chinese')var _0x2f26f1=users['Chinese'];else{if(_0x127132[0x0]['language']==_0x1fb823(0xb9))var _0x2f26f1=users[_0x1fb823(0x125)];}}}}}}}_0x195b54['render'](_0x1fb823(0xe7),{'success':_0x46d2c8['flash'](_0x1fb823(0x12a)),'errors':_0x46d2c8[_0x1fb823(0xf5)]('errors'),'role':_0xe4daee,'profile':_0x32892f,'purchases':_0x185aa8,'suppliers':_0x19a189,'warehouse':_0x5e0a6c,'product':_0x4059fe,'master_shop':_0x127132,'language':_0x2f26f1,'ed_fullDate':_0x1e8b89,'dataSelected':_0x37d667});}catch(_0x5956fa){console[_0x1fb823(0x122)](_0x5956fa);}}),router[a0_0xe752c0(0xb0)]('/view/:id',auth,async(_0x47e96b,_0x4464e5)=>{var _0x280b28=a0_0xe752c0;try{const _0x550e6e=_0x47e96b['params']['id'],_0x1ff273=await purchases_finished[_0x280b28(0xc5)]({'_id':_0x47e96b[_0x280b28(0xac)]['id']}),_0x28da24=await warehouse['findOne']({'name':_0x1ff273[_0x280b28(0x151)],'room':_0x1ff273[_0x280b28(0x107)]});_0x1ff273[_0x280b28(0xdd)][_0x280b28(0xec)](_0x196f34=>{var _0x3b2a7c=_0x280b28;const _0x2a7a05=_0x28da24[_0x3b2a7c(0xfc)][_0x3b2a7c(0x144)](_0x4294a9=>{var _0x217d8e=_0x3b2a7c;_0x4294a9[_0x217d8e(0x117)]==_0x196f34['product_name']&&_0x4294a9[_0x217d8e(0xd6)]==_0x196f34['bay']&&(_0x4294a9[_0x217d8e(0x13e)]=parseInt(_0x4294a9[_0x217d8e(0x13e)])-parseInt(_0x196f34[_0x217d8e(0x131)]));});}),await _0x28da24[_0x280b28(0xe0)]();const {invoice:_0x148460,suppliers:_0x9d11eb,date:_0x225a29,warehouse_name:_0x1050c1,prod_name:_0x202874,prod_code:_0x4b5a18,prod_qty:_0x249ecb,prod_unit:_0x3144f7,prod_secondunit:_0x3dc537,prod_level:_0x444820,prod_isle:_0xd08ebb,prod_pallet:_0xc4d9d1,note:_0x37b6f8,expiry_date:_0x15eb80,batch_code:_0x5d75db,paid_amount:_0x3ca187,due_amount:_0x32d1c4,Room_name:_0x38567a,primary_code:_0x2a374a,secondary_code:_0x17ad82,PO_number:_0x39fc28,JO_number:_0x3fdbc6}=_0x47e96b[_0x280b28(0xcd)];if(typeof _0x202874==_0x280b28(0x145))var _0x2bd13e=[_0x47e96b['body'][_0x280b28(0x176)]],_0x40325f=[_0x47e96b['body'][_0x280b28(0x105)]],_0x3ea8c6=[_0x47e96b[_0x280b28(0xcd)][_0x280b28(0x130)]],_0x3726fc=[_0x47e96b['body'][_0x280b28(0x10c)]],_0x1fac87=[_0x47e96b[_0x280b28(0xcd)][_0x280b28(0x17c)]],_0x15c0ba=[_0x47e96b['body']['prod_level']],_0x8e0121=[_0x47e96b[_0x280b28(0xcd)][_0x280b28(0xb7)]],_0x1e8679=[_0x47e96b[_0x280b28(0xcd)][_0x280b28(0xeb)]],_0x1309e8=[_0x47e96b['body'][_0x280b28(0x135)]],_0x32c47a=[_0x47e96b[_0x280b28(0xcd)]['batch_code']],_0x2e1d8d=[_0x47e96b['body']['expiry_date']];else var _0x2bd13e=[..._0x47e96b[_0x280b28(0xcd)][_0x280b28(0x176)]],_0x40325f=[..._0x47e96b['body'][_0x280b28(0x105)]],_0x3ea8c6=[..._0x47e96b[_0x280b28(0xcd)][_0x280b28(0x130)]],_0x3726fc=[..._0x47e96b['body']['prod_unit']],_0x1fac87=[..._0x47e96b[_0x280b28(0xcd)][_0x280b28(0x17c)]],_0x15c0ba=[..._0x47e96b[_0x280b28(0xcd)][_0x280b28(0xc1)]],_0x8e0121=[..._0x47e96b['body'][_0x280b28(0xb7)]],_0x1e8679=[..._0x47e96b[_0x280b28(0xcd)][_0x280b28(0xeb)]],_0x1309e8=[..._0x47e96b[_0x280b28(0xcd)][_0x280b28(0x135)]],_0x32c47a=[..._0x47e96b[_0x280b28(0xcd)][_0x280b28(0x10f)]],_0x2e1d8d=[..._0x47e96b[_0x280b28(0xcd)]['expiry_date']];const _0x31b6bd=_0x2bd13e[_0x280b28(0x144)](_0x477845=>{return _0x477845={'product_name':_0x477845};});_0x40325f[_0x280b28(0xec)]((_0x45b574,_0x1b92ab)=>{_0x31b6bd[_0x1b92ab]['product_code']=_0x45b574;}),_0x3ea8c6[_0x280b28(0xec)]((_0x32c132,_0x13b6ca)=>{var _0x434e1c=_0x280b28;_0x31b6bd[_0x13b6ca][_0x434e1c(0x131)]=_0x32c132;}),_0x3726fc[_0x280b28(0xec)]((_0x744b61,_0xc251d5)=>{_0x31b6bd[_0xc251d5]['standard_unit']=_0x744b61;}),_0x1fac87[_0x280b28(0xec)]((_0x404aab,_0xb67228)=>{var _0x3962a2=_0x280b28;_0x31b6bd[_0xb67228][_0x3962a2(0x190)]=_0x404aab;}),_0x15c0ba[_0x280b28(0xec)]((_0x4ea57f,_0x202893)=>{_0x31b6bd[_0x202893]['bay']=_0x4ea57f;}),_0x8e0121[_0x280b28(0xec)]((_0x3b4af8,_0x220d94)=>{var _0x25f6ab=_0x280b28;_0x31b6bd[_0x220d94][_0x25f6ab(0xb7)]=_0x3b4af8;}),_0x1e8679[_0x280b28(0xec)]((_0x168c50,_0x3d002e)=>{var _0x1e3973=_0x280b28;_0x31b6bd[_0x3d002e][_0x1e3973(0xeb)]=_0x168c50;}),_0x1309e8[_0x280b28(0xec)]((_0x30fe4b,_0x2f71d4)=>{var _0x5c5b5b=_0x280b28;_0x31b6bd[_0x2f71d4][_0x5c5b5b(0xbb)]=_0x30fe4b;}),_0x32c47a[_0x280b28(0xec)]((_0x55ef31,_0x328357)=>{var _0x580f32=_0x280b28;_0x31b6bd[_0x328357][_0x580f32(0x10f)]=_0x55ef31;}),_0x2e1d8d[_0x280b28(0xec)]((_0x2ca3c3,_0x3c94c5)=>{_0x31b6bd[_0x3c94c5]['expiry_date']=_0x2ca3c3;});const _0x32ab19=_0x31b6bd[_0x280b28(0x128)](_0x44bb6c=>_0x44bb6c['quantity']!=='0'&&_0x44bb6c[_0x280b28(0x131)]!=='');_0x1ff273[_0x280b28(0x177)]=_0x148460,_0x1ff273['suppliers']=_0x9d11eb,_0x1ff273[_0x280b28(0x103)]=_0x225a29,_0x1ff273[_0x280b28(0x151)]=_0x1050c1,_0x1ff273[_0x280b28(0xdd)]=_0x32ab19,_0x1ff273['note']=_0x37b6f8,_0x1ff273[_0x280b28(0xd5)]=_0x3ca187,_0x1ff273['due_amount']=_0x32d1c4,_0x1ff273[_0x280b28(0x107)]=_0x38567a,_0x1ff273[_0x280b28(0xb8)]=_0x39fc28,_0x1ff273['JO_number']=_0x3fdbc6;const _0x3e0b56=await _0x1ff273[_0x280b28(0xe0)](),_0xa13ed6=await warehouse[_0x280b28(0xc5)]({'name':_0x47e96b[_0x280b28(0xcd)][_0x280b28(0x151)],'room':_0x47e96b[_0x280b28(0xcd)][_0x280b28(0xf3)]});_0x1ff273[_0x280b28(0xdd)][_0x280b28(0xec)](_0xac1490=>{var _0x1b2559=_0x280b28,_0x30284a=0x0;const _0x1d74f7=_0xa13ed6[_0x1b2559(0xfc)]['map'](_0x1bc614=>{var _0x17bffc=_0x1b2559;_0x1bc614['product_name']==_0xac1490['product_name']&&_0x1bc614[_0x17bffc(0xd6)]==_0xac1490['bay']&&(_0x1bc614[_0x17bffc(0x13e)]=parseInt(_0x1bc614[_0x17bffc(0x13e)])+parseInt(_0xac1490[_0x17bffc(0x131)]),_0x30284a++);});_0x30284a=='0'&&(_0xa13ed6['product_details']=_0xa13ed6[_0x1b2559(0xfc)][_0x1b2559(0x136)]({'product_name':_0xac1490[_0x1b2559(0x117)],'product_stock':_0xac1490['quantity'],'primary_code':_0xac1490[_0x1b2559(0xb7)],'secondary_code':_0xac1490[_0x1b2559(0xeb)],'product_code':_0xac1490[_0x1b2559(0x18e)],'bay':_0xac1490[_0x1b2559(0xd6)],'maxProducts':_0xac1490['maxStocks'],'unit':_0xac1490[_0x1b2559(0x172)],'secondary_unit':_0xac1490[_0x1b2559(0x190)],'expiry_date':_0xac1490['expiry_date']}));}),await _0xa13ed6[_0x280b28(0xe0)]();const _0x47cb71=await s_payment_data[_0x280b28(0xc5)]({'invoice':_0x47e96b[_0x280b28(0xcd)][_0x280b28(0x177)]});if(_0x47cb71===null){}else console[_0x280b28(0x122)](_0x280b28(0x13b),_0x47cb71,_0x47e96b[_0x280b28(0xcd)]['invoice']),_0x47cb71[_0x280b28(0x13b)]=_0x47e96b['body'][_0x280b28(0x13b)],await _0x47cb71[_0x280b28(0xe0)]();_0x47e96b[_0x280b28(0xf5)](_0x280b28(0x12a),'purchase\x20data\x20update\x20successfully'),_0x4464e5[_0x280b28(0xc9)](_0x280b28(0xd9));}catch(_0x52e068){console[_0x280b28(0x122)](_0x52e068);}}),router[a0_0xe752c0(0xb0)](a0_0xe752c0(0x167),auth,async(_0x5bd53e,_0x27848e)=>{var _0x4eebca=a0_0xe752c0;try{const _0x3cabde=_0x5bd53e[_0x4eebca(0xac)]['id'],{invoice:_0x4734ef,suppliers:_0x274125,payable:_0x2b458b,due_amount:_0x3e3307}=_0x5bd53e[_0x4eebca(0xcd)],_0x26e661=await purchases['findById'](_0x3cabde);var _0x166aa1=_0x2b458b-_0x3e3307;_0x26e661[_0x4eebca(0xd5)]=parseFloat(_0x26e661[_0x4eebca(0xd5)])+parseFloat(_0x3e3307),_0x26e661['due_amount']=_0x166aa1;const _0x4d65d4=await _0x26e661[_0x4eebca(0xe0)]();console[_0x4eebca(0x122)](_0x4d65d4);const _0x5226e4=await s_payment_data['findOne']({'invoice':_0x4734ef});_0x5226e4[_0x4eebca(0x17f)]=_0x166aa1,await _0x5226e4['save']();let _0xf7ab8c=new Date(),_0x420070=('0'+_0xf7ab8c[_0x4eebca(0x12e)]())['slice'](-0x2),_0x1ee338=('0'+(_0xf7ab8c[_0x4eebca(0x169)]()+0x1))['slice'](-0x2),_0x469a5c=_0xf7ab8c[_0x4eebca(0xc4)](),_0x68a217=_0x469a5c+'-'+_0x1ee338+'-'+_0x420070;const _0xe86250=new suppliers_payment({'invoice':_0x4734ef,'date':_0x469a5c+'-'+_0x1ee338+'-'+_0x420070,'suppliers':_0x274125,'reason':_0x4eebca(0x14b),'amount':_0x3e3307}),_0x7b0ab7=await _0xe86250[_0x4eebca(0xe0)]();_0x5bd53e[_0x4eebca(0xf5)](_0x4eebca(0x12a),_0x4eebca(0xe1)),_0x27848e['redirect'](_0x4eebca(0x116));}catch(_0x11399a){console[_0x4eebca(0x122)](_0x11399a);}}),router[a0_0xe752c0(0x16e)]('/invoice/:id',auth,async(_0x2346c8,_0x48e866)=>{var _0x2afff2=a0_0xe752c0;try{const {username:_0x1e6430,email:_0x521cff,role:_0x1eafd2}=_0x2346c8[_0x2afff2(0x1a1)],_0x3599c2=_0x2346c8[_0x2afff2(0x1a1)],_0xd2a654=await profile[_0x2afff2(0xc5)]({'email':_0x3599c2[_0x2afff2(0x114)]}),_0x398543=await master_shop['find']();console[_0x2afff2(0x122)]('master',_0x398543);const _0x33162f=_0x2346c8[_0x2afff2(0xac)]['id'],_0xeb23b9=await purchases[_0x2afff2(0x1ac)](_0x33162f);console[_0x2afff2(0x122)](_0xeb23b9);const _0x38e61b=await suppliers[_0x2afff2(0xc5)]({'name':_0xeb23b9[_0x2afff2(0x13b)]});console['log'](_0x38e61b);if(_0x398543[0x0][_0x2afff2(0xce)]==_0x2afff2(0xae)){var _0x4c80b1=users[_0x2afff2(0x1a8)];console['log'](_0x4c80b1);}else{if(_0x398543[0x0][_0x2afff2(0xce)]==_0x2afff2(0xdb))var _0x4c80b1=users[_0x2afff2(0xdb)];else{if(_0x398543[0x0][_0x2afff2(0xce)]==_0x2afff2(0x14c))var _0x4c80b1=users['German'];else{if(_0x398543[0x0][_0x2afff2(0xce)]==_0x2afff2(0x14f))var _0x4c80b1=users[_0x2afff2(0x14f)];else{if(_0x398543[0x0][_0x2afff2(0xce)]==_0x2afff2(0x137))var _0x4c80b1=users[_0x2afff2(0x137)];else{if(_0x398543[0x0][_0x2afff2(0xce)]=='Portuguese\x20(BR)')var _0x4c80b1=users['Portuguese'];else{if(_0x398543[0x0][_0x2afff2(0xce)]=='Chinese')var _0x4c80b1=users[_0x2afff2(0xdf)];else{if(_0x398543[0x0]['language']=='Arabic\x20(ae)')var _0x4c80b1=users[_0x2afff2(0x125)];}}}}}}}_0x48e866[_0x2afff2(0x15a)]('purchase_invoice',{'success':_0x2346c8[_0x2afff2(0xf5)](_0x2afff2(0x12a)),'errors':_0x2346c8[_0x2afff2(0xf5)](_0x2afff2(0x152)),'role':_0x3599c2,'profile':_0xd2a654,'master_shop':_0x398543,'supplier':_0x38e61b,'purchase':_0xeb23b9,'language':_0x4c80b1});}catch(_0x368125){console[_0x2afff2(0x122)](_0x368125);}}),router[a0_0xe752c0(0x16e)](a0_0xe752c0(0xb6),auth,async(_0x35569d,_0xae9ab0)=>{var _0x3d8997=a0_0xe752c0;try{const {username:_0x13ef79,email:_0x1b0c41,role:_0x37ff34}=_0x35569d[_0x3d8997(0x1a1)],_0x54956c=_0x35569d[_0x3d8997(0x1a1)],_0x266e6a=await profile[_0x3d8997(0xc5)]({'email':_0x54956c[_0x3d8997(0x114)]}),_0x3e7971=await master_shop[_0x3d8997(0x17a)]();console[_0x3d8997(0x122)](_0x3d8997(0x15f),_0x3e7971);const _0x131f1a=_0x35569d[_0x3d8997(0xac)]['id'];console[_0x3d8997(0x122)](_0x131f1a);const _0x262abe=await purchases_finished[_0x3d8997(0x1ac)](_0x131f1a);console[_0x3d8997(0x122)](_0x3d8997(0x1a9),_0x262abe);const _0x469a7f=await product[_0x3d8997(0x17a)]({}),_0x21c9d2=await warehouse[_0x3d8997(0x19b)]([{'$match':{'name':_0x262abe[_0x3d8997(0x151)],'room':_0x262abe[_0x3d8997(0x107)]}},{'$unwind':_0x3d8997(0x115)},{'$group':{'_id':_0x3d8997(0x18d),'name':{'$first':_0x3d8997(0x101)},'product_stock':{'$first':_0x3d8997(0x110)},'bay':{'$first':_0x3d8997(0xba)},'bin':{'$first':_0x3d8997(0x138)},'type':{'$first':_0x3d8997(0xc0)},'floorlevel':{'$first':_0x3d8997(0x18a)},'primary_code':{'$first':_0x3d8997(0xe4)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3d8997(0x123)},'storage':{'$first':_0x3d8997(0xc8)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x3d8997(0x122)](_0x3d8997(0x12c),_0x21c9d2);let _0x2fbba0;if(_0x54956c[_0x3d8997(0x11a)]==_0x3d8997(0x187)){const _0xf42f25=await staff[_0x3d8997(0xc5)]({'email':_0x54956c[_0x3d8997(0x114)]});_0x2fbba0=await warehouse[_0x3d8997(0x17a)]({'status':'Enabled','name':_0xf42f25[_0x3d8997(0x15b)],'warehouse_category':_0x3d8997(0x191),'name':'Return\x20Goods'});}else _0x2fbba0=await warehouse['aggregate']([{'$match':{'status':_0x3d8997(0x192),'warehouse_category':_0x3d8997(0x191),'name':_0x3d8997(0x108)}},{'$group':{'_id':_0x3d8997(0x154),'name':{'$first':'$name'}}}]);if(_0x3e7971[0x0][_0x3d8997(0xce)]==_0x3d8997(0xae)){var _0x21492d=users['English'];console[_0x3d8997(0x122)](_0x21492d);}else{if(_0x3e7971[0x0]['language']=='Hindi')var _0x21492d=users[_0x3d8997(0xdb)];else{if(_0x3e7971[0x0][_0x3d8997(0xce)]=='German')var _0x21492d=users[_0x3d8997(0x14c)];else{if(_0x3e7971[0x0][_0x3d8997(0xce)]==_0x3d8997(0x14f))var _0x21492d=users['Spanish'];else{if(_0x3e7971[0x0]['language']==_0x3d8997(0x137))var _0x21492d=users[_0x3d8997(0x137)];else{if(_0x3e7971[0x0][_0x3d8997(0xce)]==_0x3d8997(0x178))var _0x21492d=users[_0x3d8997(0x10a)];else{if(_0x3e7971[0x0]['language']==_0x3d8997(0xdf))var _0x21492d=users['Chinese'];else{if(_0x3e7971[0x0][_0x3d8997(0xce)]==_0x3d8997(0xb9))var _0x21492d=users[_0x3d8997(0x125)];}}}}}}}_0xae9ab0[_0x3d8997(0x15a)](_0x3d8997(0xad),{'success':_0x35569d[_0x3d8997(0xf5)](_0x3d8997(0x12a)),'errors':_0x35569d[_0x3d8997(0xf5)](_0x3d8997(0x152)),'role':_0x54956c,'profile':_0x266e6a,'user':_0x262abe,'stock':_0x21c9d2,'master_shop':_0x3e7971,'product':_0x469a7f,'language':_0x21492d,'warehouse':_0x2fbba0});}catch(_0x3b6574){console[_0x3d8997(0x122)](_0x3b6574);}}),router['post'](a0_0xe752c0(0xb6),auth,async(_0x1eb96f,_0x444c7b)=>{var _0x1303a4=a0_0xe752c0;try{const {invoice:_0x1234c5,date:_0x8ce8cf,warehouse_name:_0x1d48a2,Room_name:_0x51685a,product_name:_0x49b836,purchase_quantity:_0x2472c0,stocks:_0x251af3,return_qty:_0x11a51e,note:_0x17b26c,level:_0x52e804,isle:_0x5d6e22,pallet:_0x5990bf,to_warehouse_name:_0x41087b,to_Room_name:_0x4f9174}=_0x1eb96f['body'],_0xcd9607=await purchases_finished[_0x1303a4(0xc5)]({'_id':_0x1eb96f[_0x1303a4(0xac)]['id']}),_0x311167=await warehouse[_0x1303a4(0xc5)]({'name':_0x1d48a2,'room':_0x51685a,'warehouse_category':_0x1303a4(0x191)});if(typeof _0x49b836=='string')var _0x5d97df=[_0x1eb96f['body'][_0x1303a4(0x117)]],_0x2c7998=[_0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x121)]],_0x4c567c=[_0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0xed)]],_0x3b2513=[_0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x11f)]],_0x6dc025=[_0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x142)]],_0x143adf=[_0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x196)]],_0x180521=[_0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x13a)]],_0x11eb09=[_0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0xc7)]];else var _0x5d97df=[..._0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x117)]],_0x2c7998=[..._0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x121)]],_0x4c567c=[..._0x1eb96f['body'][_0x1303a4(0xed)]],_0x3b2513=[..._0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x11f)]],_0x6dc025=[..._0x1eb96f['body'][_0x1303a4(0x142)]],_0x143adf=[..._0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x196)]],_0x180521=[..._0x1eb96f['body'][_0x1303a4(0x13a)]],_0x11eb09=[..._0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0xc7)]];const _0x56bd70=_0x5d97df[_0x1303a4(0x144)](_0x6610a2=>{return _0x6610a2={'product_name':_0x6610a2};});_0x2c7998[_0x1303a4(0xec)]((_0x5a3698,_0x5e15e0)=>{var _0x21189d=_0x1303a4;_0x56bd70[_0x5e15e0][_0x21189d(0x121)]=_0x5a3698;}),_0x4c567c[_0x1303a4(0xec)]((_0x138697,_0x4247c6)=>{var _0x2d78d6=_0x1303a4;_0x56bd70[_0x4247c6][_0x2d78d6(0xaf)]=_0x138697;}),_0x3b2513[_0x1303a4(0xec)]((_0x2f6eed,_0x4eeea7)=>{var _0x490178=_0x1303a4;_0x56bd70[_0x4eeea7][_0x490178(0x11f)]=_0x2f6eed;}),_0x6dc025[_0x1303a4(0xec)]((_0x104f0d,_0x2d4375)=>{var _0xc386fe=_0x1303a4;_0x56bd70[_0x2d4375][_0xc386fe(0xd6)]=_0x104f0d;}),_0x143adf['forEach']((_0x55c134,_0x380459)=>{var _0x27eb15=_0x1303a4;_0x56bd70[_0x380459][_0x27eb15(0x18e)]=_0x55c134;}),_0x180521[_0x1303a4(0xec)]((_0x54758,_0x3dc730)=>{_0x56bd70[_0x3dc730]['primary_code']=_0x54758;}),_0x11eb09[_0x1303a4(0xec)]((_0x20b743,_0x29f10b)=>{var _0x26b2fc=_0x1303a4;_0x56bd70[_0x29f10b][_0x26b2fc(0xeb)]=_0x20b743;}),_0x56bd70[_0x1303a4(0xec)](_0x3ed490=>{var _0x4eac6d=_0x1303a4;console[_0x4eac6d(0x122)](_0x3ed490);const _0x2cf1a3=_0x311167[_0x4eac6d(0xfc)][_0x4eac6d(0x144)](_0x4c54c6=>{var _0x3df6f4=_0x4eac6d;_0x4c54c6[_0x3df6f4(0x117)]==_0x3ed490[_0x3df6f4(0x117)]&&_0x4c54c6['bay']==_0x3ed490[_0x3df6f4(0xd6)]&&(console[_0x3df6f4(0x122)](parseInt(_0x4c54c6[_0x3df6f4(0x13e)])+'\x20<>\x20'+parseInt(_0x3ed490[_0x3df6f4(0x11f)])),_0x4c54c6[_0x3df6f4(0x13e)]=parseInt(_0x4c54c6[_0x3df6f4(0x13e)])-parseInt(_0x3ed490[_0x3df6f4(0x11f)]));});}),await _0x311167[_0x1303a4(0xe0)]();var _0x34e550=0x0;_0x56bd70['forEach'](_0x3eee3a=>{var _0x46364e=_0x1303a4;(parseInt(_0x3eee3a[_0x46364e(0x121)])<parseInt(_0x3eee3a[_0x46364e(0x11f)])||parseInt(_0x3eee3a[_0x46364e(0xaf)])<parseInt(_0x3eee3a['return_qty']))&&_0x34e550++;});if(_0x34e550!=0x0)return _0x1eb96f[_0x1303a4(0xf5)](_0x1303a4(0x152),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x444c7b['redirect']('back');const _0x5d919c=new purchases_return_finished({'invoice':_0x1234c5,'suppliers':_0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x13b)],'date':_0x8ce8cf,'warehouse_name':_0x1d48a2,'return_product':_0x56bd70,'note':_0x17b26c,'room':_0x51685a,'to_warehouse_name':_0x41087b,'to_room':_0x4f9174}),_0x52f206=await _0x5d919c['save'](),_0x1c525f=await purchases_return_finished[_0x1303a4(0xc5)]({'invoice':_0x1234c5}),_0x4fb1d2=await warehouse['findOne']({'name':_0x41087b,'room':_0x4f9174,'warehouse_category':_0x1303a4(0x191)});_0x1c525f[_0x1303a4(0x170)]['forEach'](_0x3fc191=>{var _0x1b0eb2=_0x1303a4,_0x260409=0x0;const _0x4713c3=_0x4fb1d2[_0x1b0eb2(0xfc)][_0x1b0eb2(0x144)](_0x4cebd9=>{var _0x439c86=_0x1b0eb2;console[_0x439c86(0x122)](_0x4cebd9[_0x439c86(0x117)]+'=='+_0x3fc191[_0x439c86(0x117)]+'&&'+_0x4cebd9[_0x439c86(0xd6)]+'=='+_0x3fc191[_0x439c86(0xd6)]),_0x4cebd9[_0x439c86(0x117)]==_0x3fc191['product_name']&&_0x4cebd9['bay']==_0x3fc191[_0x439c86(0xd6)]&&(_0x4cebd9['product_stock']=parseInt(_0x4cebd9['product_stock'])-parseInt(_0x3fc191['return_qty']),_0x260409++);});_0x260409=='0'&&(_0x4fb1d2[_0x1b0eb2(0xfc)]=_0x4fb1d2[_0x1b0eb2(0xfc)][_0x1b0eb2(0x136)]({'product_name':_0x3fc191['product_name'],'product_stock':_0x3fc191[_0x1b0eb2(0x11f)],'primary_code':_0x3fc191[_0x1b0eb2(0xb7)],'secondary_code':_0x3fc191[_0x1b0eb2(0xeb)],'product_code':_0x3fc191['product_code'],'bay':_0x3fc191['bay'],'maxProducts':0xf423f}));}),await _0x4fb1d2[_0x1303a4(0xe0)]();const _0x11acf1=await purchases_finished[_0x1303a4(0xc5)]({'invoice':_0x1234c5});_0x11acf1[_0x1303a4(0x166)]=_0x1303a4(0x106);const _0xae2c78=await _0x11acf1[_0x1303a4(0xe0)](),_0x4ce5b9=new s_payment_data({'invoice':_0x1234c5,'suppliers':_0x1eb96f['body'][_0x1303a4(0x13b)],'reason':_0x1303a4(0x11c)});await _0x4ce5b9['save']();const _0x4435fc=await master_shop[_0x1303a4(0x17a)](),_0x14bfae=await email_settings[_0x1303a4(0xc5)](),_0x12ed5d=await suppliers[_0x1303a4(0xc5)]({'name':_0x1eb96f[_0x1303a4(0xcd)][_0x1303a4(0x13b)]});_0x4435fc[0x0][_0x1303a4(0xd2)]==0x1?(right_currency=_0x4435fc[0x0][_0x1303a4(0x143)],left_currency=''):(right_currency='',left_currency=_0x4435fc[0x0][_0x1303a4(0x143)]);var _0x55ca17=_0x5d97df,_0x47e2e1=_0x3b2513,_0x23c83f='',_0x5e653e;for(_0x5e653e in _0x55ca17){_0x23c83f+=_0x1303a4(0xbe)+_0x1303a4(0x19f)+_0x55ca17[_0x5e653e]+'</td>'+_0x1303a4(0x19f)+_0x47e2e1[_0x5e653e]+'</td>'+'</tr>';}let _0x56b2f1=nodemailer['createTransport']({'service':_0x1303a4(0x15e),'auth':{'user':_0x14bfae['email'],'pass':_0x14bfae[_0x1303a4(0xe6)]}}),_0x1cad46={'from':_0x14bfae['email'],'to':_0x12ed5d[_0x1303a4(0x114)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x1303a4(0x1a4)+_0x1303a4(0x149)+_0x4435fc[0x0][_0x1303a4(0x10d)],'cid':_0x1303a4(0xf9)}],'html':_0x1303a4(0xbf)+'<html><head><title></title>'+_0x1303a4(0x1a0)+_0x1303a4(0xde)+_0x1303a4(0xf1)+_0x1303a4(0xde)+_0x1303a4(0x16b)+_0x1303a4(0x165)+_0x1303a4(0xde)+_0x1303a4(0xf6)+_0x4435fc[0x0][_0x1303a4(0xf7)]+_0x1303a4(0x119)+_0x1303a4(0x165)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x1303a4(0xfe)+_0x1303a4(0x102)+_0x1234c5+'\x20'+_0x1303a4(0x1a2)+'\x20Order\x20Date\x20:\x20'+_0x8ce8cf+'\x20'+_0x1303a4(0xee)+_0x1303a4(0x175)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1303a4(0xdc)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1303a4(0x127)+_0x1303a4(0x186)+_0x1303a4(0x16d)+'</tr>'+'</thead>'+_0x1303a4(0xd1)+'\x20'+_0x23c83f+'\x20'+_0x1303a4(0x1a7)+_0x1303a4(0x132)+_0x1303a4(0xde)+_0x1303a4(0xf0)+_0x1303a4(0x16c)+_0x4435fc[0x0]['site_title']+'</h5>'+_0x1303a4(0x165)+_0x1303a4(0x165)+_0x1303a4(0x13c)};_0x56b2f1[_0x1303a4(0xe2)](_0x1cad46,function(_0x12ef3a,_0x11f8c0){var _0x481d58=_0x1303a4;_0x12ef3a?console[_0x481d58(0x122)](_0x481d58(0x18f)):console[_0x481d58(0x122)](_0x481d58(0xfa));}),_0x1eb96f['flash'](_0x1303a4(0x12a),_0x1303a4(0x181)),_0x444c7b[_0x1303a4(0xc9)]('/all_purchases_finished/view');}catch(_0x3abcfe){_0x444c7b['status'](0xc8)[_0x1303a4(0x193)]({'message':_0x3abcfe[_0x1303a4(0xb1)]});}}),router[a0_0xe752c0(0x16e)](a0_0xe752c0(0x161),auth,async(_0x26caa6,_0x21fa48)=>{var _0xa5b80f=a0_0xe752c0;try{const {username:_0x59b5a6,email:_0x5c98e5,role:_0x2f1b87}=_0x26caa6['user'],_0x420028=_0x26caa6[_0xa5b80f(0x1a1)],_0x2adaaa=await profile['findOne']({'email':_0x420028[_0xa5b80f(0x114)]}),_0x586328=await master_shop[_0xa5b80f(0x17a)](),_0x2a8c10=_0x26caa6[_0xa5b80f(0xac)]['id'],_0x338bbb=await purchases_finished[_0xa5b80f(0x1ac)](_0x2a8c10);if(_0x586328[0x0][_0xa5b80f(0xce)]==_0xa5b80f(0xae))var _0x39c112=users[_0xa5b80f(0x1a8)];else{if(_0x586328[0x0]['language']==_0xa5b80f(0xdb))var _0x39c112=users[_0xa5b80f(0xdb)];else{if(_0x586328[0x0][_0xa5b80f(0xce)]=='German')var _0x39c112=users[_0xa5b80f(0x14c)];else{if(_0x586328[0x0][_0xa5b80f(0xce)]==_0xa5b80f(0x14f))var _0x39c112=users['Spanish'];else{if(_0x586328[0x0][_0xa5b80f(0xce)]==_0xa5b80f(0x137))var _0x39c112=users['French'];else{if(_0x586328[0x0][_0xa5b80f(0xce)]==_0xa5b80f(0x178))var _0x39c112=users[_0xa5b80f(0x10a)];else{if(_0x586328[0x0][_0xa5b80f(0xce)]==_0xa5b80f(0xdf))var _0x39c112=users[_0xa5b80f(0xdf)];else{if(_0x586328[0x0]['language']==_0xa5b80f(0xb9))var _0x39c112=users[_0xa5b80f(0x125)];}}}}}}}_0x21fa48[_0xa5b80f(0x15a)](_0xa5b80f(0x17b),{'success':_0x26caa6[_0xa5b80f(0xf5)]('success'),'errors':_0x26caa6[_0xa5b80f(0xf5)]('errors'),'role':_0x420028,'profile':_0x2adaaa,'alldata':_0x338bbb,'master_shop':_0x586328,'language':_0x39c112}),console[_0xa5b80f(0x122)](alldata);}catch(_0x464df6){console[_0xa5b80f(0x122)](_0x464df6);}}),router[a0_0xe752c0(0xb0)]('/barcode_scanner',async(_0xd6263a,_0xf06024)=>{var _0x4574e3=a0_0xe752c0;const {product_code:_0x168b1c}=_0xd6263a['body'];var _0x1ca877;const _0x3eca58=await product[_0x4574e3(0x19b)]([{'$match':{'primary_code':_0x168b1c,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x4574e3(0xe5),'name':{'$first':_0x4574e3(0x154)},'category':{'$first':_0x4574e3(0xff)},'brand':{'$first':'$brand'},'unit':{'$first':_0x4574e3(0x12b)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x4574e3(0xfb)},'secondary_code':{'$first':_0x4574e3(0xf2)},'maxStocks':{'$first':_0x4574e3(0x19c)},'maxProdPerUnit':{'$first':_0x4574e3(0x194)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4574e3(0x147)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x42be48=await product['aggregate']([{'$match':{'secondary_code':_0x168b1c}},{'$group':{'_id':_0x4574e3(0xe5),'name':{'$first':_0x4574e3(0x154)},'category':{'$first':'$category'},'brand':{'$first':_0x4574e3(0x182)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x4574e3(0xfb)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x4574e3(0x194)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4574e3(0x147)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3eca58['length']>0x0)_0x1ca877=_0x3eca58;else _0x42be48[_0x4574e3(0xd4)]>0x0&&(_0x1ca877=_0x42be48);_0xf06024['json'](_0x1ca877);}),router[a0_0xe752c0(0xb0)](a0_0xe752c0(0x11b),async(_0x1f882e,_0x1a02ec)=>{var _0x1bf84c=a0_0xe752c0;const {productCode:_0x2fc64d,bay:_0x2a3f56,warehouses:_0x30c87e,room:_0x47978b}=_0x1f882e['body'];console[_0x1bf84c(0x122)](_0x1f882e[_0x1bf84c(0xcd)]);try{const _0x396387=await warehouse[_0x1bf84c(0x19b)]([{'$match':{'name':_0x30c87e,'room':_0x47978b}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x2a3f56)}},{'$group':{'_id':_0x1bf84c(0x18d),'name':{'$first':_0x1bf84c(0x101)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1bf84c(0xba)},'maxProducts':{'$first':_0x1bf84c(0x146)}}}]);_0x1a02ec[_0x1bf84c(0xb3)](0xc8)['json'](_0x396387);}catch(_0x370a3f){_0x1a02ec[_0x1bf84c(0xb3)](0x194)[_0x1bf84c(0x193)]({'message':_0x370a3f['message']});}}),module[a0_0xe752c0(0x17e)]=router;