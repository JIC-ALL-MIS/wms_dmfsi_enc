function a0_0x2ae8(_0x484e42,_0x558510){var _0x1b372c=a0_0x1b37();return a0_0x2ae8=function(_0x2ae834,_0x7e57e1){_0x2ae834=_0x2ae834-0x170;var _0x50be02=_0x1b372c[_0x2ae834];return _0x50be02;},a0_0x2ae8(_0x484e42,_0x558510);}var a0_0x2d1637=a0_0x2ae8;(function(_0x4489dd,_0x54c726){var _0x3adcec=a0_0x2ae8,_0x2754d2=_0x4489dd();while(!![]){try{var _0x1acd77=parseInt(_0x3adcec(0x1be))/0x1*(parseInt(_0x3adcec(0x214))/0x2)+-parseInt(_0x3adcec(0x1fe))/0x3+parseInt(_0x3adcec(0x1d1))/0x4*(parseInt(_0x3adcec(0x25f))/0x5)+-parseInt(_0x3adcec(0x246))/0x6*(-parseInt(_0x3adcec(0x1e9))/0x7)+parseInt(_0x3adcec(0x1e0))/0x8*(-parseInt(_0x3adcec(0x201))/0x9)+parseInt(_0x3adcec(0x23d))/0xa*(-parseInt(_0x3adcec(0x26f))/0xb)+-parseInt(_0x3adcec(0x181))/0xc;if(_0x1acd77===_0x54c726)break;else _0x2754d2['push'](_0x2754d2['shift']());}catch(_0x44706f){_0x2754d2['push'](_0x2754d2['shift']());}}}(a0_0x1b37,0x22d66));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x2d1637(0x206)),auth=require(a0_0x2d1637(0x17a)),nodemailer=require(a0_0x2d1637(0x1ae));var ejs=require(a0_0x2d1637(0x1d4));function a0_0x1b37(){var _0x2adda0=['/view/return_purchase/:id','length','$return_data','prod_unit','master','suppliers_docs','Email\x20sent\x20successfully','$date','string','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.bay','_id','filter','prod_name','<h2>\x20','warehouse','/all_purchases_finished/view','</td>','/barcode_scanner','return_product','prod_secondunit','/upload/','product_code_hide','stock_data','prod_qty','errors','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','purchase\x20data\x20add\x20successfully','staff','secondary_unit','/barcode/:id','status','warehouse_name','site_title','nodemailer','\x20<>\x20','product_stock','<tr>','/view/:id','date','$suppliers_docs','suppliers','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<h5>','$batch_code','/invoice/:id','Hindi','return_qty','True','French','37XRUxRx','render','/give_payment/:id','Error\x20occurred\x20while\x20processing\x20product:','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','add_purchases\x20error','findById','JO_number','purchase_quantity','return_purchase_finished','maxperunit','$product','Logo.png','prod_code','RoomAssign','Arabic\x20(ae)','/view/add_purchases/:id','flash','$paid_amount','52TAlmUO','table\x20page','<html><head><title></title>','ejs','batch_code','all','</head><body>','/CheckingWarehouse','$product.bay','</body></html>','INCF-','abs','exports','$maxProdPerUnit','$product_details.product_code','24FZDDZg','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$brand','$secondary_unit','product_date','all_purchases_barcode','purchases\x20item\x20return\x20successfull','product','Portuguese','483bGhipF','image','$invoice','sendMail','params','all_purchases_finished','production_date','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','payment\x20successfull','maxStocks','$product_details.product_name','/view/add_purchases','$secondary_code','\x20Order\x20Date\x20:\x20','$_id','save','back','$primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','English','Finished\x20Goods','193167JCNNSD','<hr\x20class=\x22my-3\x22>','$maxStocks','552897cVDiMZ','\x20Order\x20Number\x20:\x20','</div>','map','$product.type','../models/all_models','$product_details.storage','updateOne','FROZEN\x20GOODS','currency_placement','$product_details.product_stock','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','log','$product.room_name','</tbody>','email','<span\x20style=\x22float:\x20right;\x22>','json','error','12794KTvNze','$product_details.secondary_code','</table>','expiry_date','invoice','prod_primunit','Rack\x201','Enclosed','/preview/:id','$product.floorlevel','MaxStocks_data','$product_details._id','$room','/../public','</thead>','body','quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$due_amount','$category','language','POnumber','paid_amount','$warehouse_name','getMonth','English\x20(US)','../public/language/languages.json','Error\x20Occurs','Arabic','createTransport','gmail','room','secondary_code_hide','stocks','concat','secondary_code','getFullYear','slice','<div>','/view','</h5>','10kGmCAF','German','<strong>\x20Regards\x20</strong>','$name','product_name','<h5\x20style=\x22text-align:\x20left;\x22>','Portuguese\x20(BR)','</tr>','logo','13410FJtajb','catch','message','get','then','redirect','<!DOCTYPE\x20html>','Room_name','add_purchases_finished','$product_details','path','$suppliers','amount','$expiry_date','product_code','stock_quantity','aggregate','product_cat','find','$product.quantity','return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','role','Return\x20Goods','Spanish','78770SKPsPQ','primary_code_hide','forEach','Purchase\x20Return\x20Mail','post','toString','standard_unit','prod_level','findOne','prod_invoice','level','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','due_amount','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.rack','1781142bwPJoR','$product_code','purchase\x20data\x20update\x20successfully','prod_Qty','$alertquantity','padStart','note','prod_cat','QA\x20Warehouse','max_product_unit','user','../middleware/auth','bay','Chinese','$unit','getDate','primary_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','508824IuhrYa','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','success','edit_purchases_finished_view','Enabled','</span>','An\x20error\x20occurred\x20while\x20saving\x20data.','name','product_details','room_name'];a0_0x1b37=function(){return _0x2adda0;};return a0_0x1b37();}const path=require(a0_0x2d1637(0x250)),users=require(a0_0x2d1637(0x22e));router[a0_0x2d1637(0x249)](a0_0x2d1637(0x23b),auth,async(_0x226a6b,_0x177b6f)=>{var _0x3673cc=a0_0x2d1637;try{const {username:_0x144beb,email:_0x550c11,role:_0x41a49f}=_0x226a6b['user'],_0x52450f=_0x226a6b[_0x3673cc(0x179)],_0x537d91=await profile['findOne']({'email':_0x52450f['email']}),_0x376523=await staff['findOne']({'email':_0x52450f[_0x3673cc(0x210)]});if(_0x52450f['role']==_0x3673cc(0x1a8)){const _0x72597c=await staff['findOne']({'email':_0x52450f['email']});}const _0xd4f276=await master_shop['find']();let _0x31e714;if(_0x52450f[_0x3673cc(0x25c)]==_0x3673cc(0x1a8)){const _0x534e1a=await staff[_0x3673cc(0x267)]({'email':_0x52450f[_0x3673cc(0x210)]});_0x31e714=await purchases_finished[_0x3673cc(0x256)]([{'$match':{'warehouse_name':_0x534e1a[_0x3673cc(0x19b)]}},{'$lookup':{'from':_0x3673cc(0x1b5),'localField':_0x3673cc(0x1b5),'foreignField':_0x3673cc(0x189),'as':_0x3673cc(0x191)}},{'$unwind':_0x3673cc(0x1b4)},{'$unwind':_0x3673cc(0x1c9)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3673cc(0x1eb)},'suppliers':{'$first':_0x3673cc(0x251)},'date':{'$first':_0x3673cc(0x193)},'warehouse_name':{'$first':_0x3673cc(0x22b)},'room':{'$first':_0x3673cc(0x220)},'product':{'$push':_0x3673cc(0x1c9)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3673cc(0x1d0)},'due_amount':{'$first':_0x3673cc(0x226)},'return_data':{'$first':_0x3673cc(0x18e)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x3673cc(0x253)},'suppliers_docs':{'$first':_0x3673cc(0x1b4)},'total_product_quantity':{'$sum':_0x3673cc(0x259)},'level':{'$addToSet':_0x3673cc(0x1d9)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x3673cc(0x205)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x31e714=await purchases_finished[_0x3673cc(0x256)]([{'$unwind':_0x3673cc(0x1c9)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3673cc(0x1eb)},'suppliers':{'$first':_0x3673cc(0x251)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x3673cc(0x20e)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3673cc(0x1d0)},'due_amount':{'$first':_0x3673cc(0x226)},'return_data':{'$first':_0x3673cc(0x18e)},'batch_code':{'$first':_0x3673cc(0x1b8)},'expiry_date':{'$first':_0x3673cc(0x253)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x3673cc(0x259)},'level':{'$addToSet':_0x3673cc(0x1d9)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x3673cc(0x205)},'floorlevel':{'$addToSet':_0x3673cc(0x21d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xd4f276[0x0][_0x3673cc(0x228)]==_0x3673cc(0x22d))var _0x1dc144=users[_0x3673cc(0x1fc)];else{if(_0xd4f276[0x0][_0x3673cc(0x228)]=='Hindi')var _0x1dc144=users[_0x3673cc(0x1ba)];else{if(_0xd4f276[0x0][_0x3673cc(0x228)]=='German')var _0x1dc144=users[_0x3673cc(0x23e)];else{if(_0xd4f276[0x0][_0x3673cc(0x228)]==_0x3673cc(0x25e))var _0x1dc144=users[_0x3673cc(0x25e)];else{if(_0xd4f276[0x0][_0x3673cc(0x228)]==_0x3673cc(0x1bd))var _0x1dc144=users[_0x3673cc(0x1bd)];else{if(_0xd4f276[0x0][_0x3673cc(0x228)]==_0x3673cc(0x243))var _0x1dc144=users[_0x3673cc(0x1e8)];else{if(_0xd4f276[0x0][_0x3673cc(0x228)]=='Chinese')var _0x1dc144=users[_0x3673cc(0x17c)];else{if(_0xd4f276[0x0]['language']==_0x3673cc(0x1cd))var _0x1dc144=users[_0x3673cc(0x230)];}}}}}}}_0x177b6f['render'](_0x3673cc(0x1ee),{'success':_0x226a6b['flash'](_0x3673cc(0x184)),'errors':_0x226a6b['flash'](_0x3673cc(0x1a5)),'purchases':_0x31e714,'role':_0x52450f,'profile':_0x537d91,'master_shop':_0xd4f276,'language':_0x1dc144});}catch(_0x211fd3){console[_0x3673cc(0x20d)](_0x3673cc(0x1d2),_0x211fd3),_0x177b6f[_0x3673cc(0x1ab)](0xc8)[_0x3673cc(0x212)]({'message':_0x211fd3[_0x3673cc(0x248)]});}});function BayBinSelected(_0x562409,_0x1c7026){var _0x579dda=a0_0x2d1637,_0x543e47=[],_0x41a3c2=[];if(_0x562409=='DRY\x20GOODS'){switch(_0x1c7026){case _0x579dda(0x21a):_0x543e47=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x543e47=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x41a3c2=['DG'];}else{if(_0x562409==_0x579dda(0x209)){switch(_0x1c7026){case _0x579dda(0x21a):_0x543e47=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x543e47=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x41a3c2=['FG'];}}return{'levels':_0x543e47,'identify':_0x41a3c2};}async function getRandom8DigitNumber(){var _0x2c76ef=a0_0x2d1637;const _0xa8ce05=0x989680,_0x2d8bb8=0x5f5e0ff,_0x91853=Math[_0x2c76ef(0x182)](Math['random']()*(_0x2d8bb8-_0xa8ce05+0x1))+_0xa8ce05;var _0x15172f;const _0x1bde38=await purchases_finished[_0x2c76ef(0x267)]({'invoice':_0x2c76ef(0x1db)+_0x91853});return _0x1bde38&&_0x1bde38['length']>0x0?_0x15172f=_0x2c76ef(0x1db)+_0x91853:_0x15172f=_0x2c76ef(0x1db)+_0x91853,_0x15172f;}router[a0_0x2d1637(0x249)](a0_0x2d1637(0x1f4),auth,async(_0x1e7998,_0x358f29)=>{var _0x35f117=a0_0x2d1637;try{const {username:_0x257919,email:_0x71fae,role:_0x1d5a8a}=_0x1e7998[_0x35f117(0x179)],_0x283a3e=_0x1e7998['user'],_0x12143e=await profile['findOne']({'email':_0x283a3e['email']}),_0x2a03d2=await master_shop[_0x35f117(0x258)](),_0x15d283=await staff['findOne']({'email':_0x283a3e['email']}),_0x174788=await suppliers[_0x35f117(0x258)]({});let _0x43ce43;if(_0x283a3e['role']=='staff'){const _0x2fcc9a=await staff['findOne']({'email':_0x283a3e[_0x35f117(0x210)]});_0x43ce43=await warehouse['aggregate']([{'$match':{'status':_0x35f117(0x186),'name':_0x2fcc9a[_0x35f117(0x19b)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x35f117(0x240),'name':{'$first':'$name'}}}]);}else _0x43ce43=await warehouse[_0x35f117(0x256)]([{'$match':{'status':_0x35f117(0x186),'warehouse_category':_0x35f117(0x1fd),'name':{'$ne':_0x35f117(0x177)}}},{'$group':{'_id':_0x35f117(0x240),'name':{'$first':_0x35f117(0x240)}}}]);const _0x2fa696=await product[_0x35f117(0x258)]({}),_0x2ab15e=await warehouse[_0x35f117(0x258)]({'status':'Enabled'}),_0x1faaee=await purchases_finished[_0x35f117(0x258)]({}),_0x10a1f8=_0x1faaee[_0x35f117(0x18d)]+0x1,_0x267cee=_0x35f117(0x1db)+_0x10a1f8[_0x35f117(0x264)]()[_0x35f117(0x174)](0x5,'0');var _0x24c42f=['Ambient',_0x35f117(0x21b)];if(_0x2a03d2[0x0][_0x35f117(0x228)]==_0x35f117(0x22d))var _0x47c700=users[_0x35f117(0x1fc)];else{if(_0x2a03d2[0x0]['language']==_0x35f117(0x1ba))var _0x47c700=users[_0x35f117(0x1ba)];else{if(_0x2a03d2[0x0][_0x35f117(0x228)]==_0x35f117(0x23e))var _0x47c700=users[_0x35f117(0x23e)];else{if(_0x2a03d2[0x0]['language']==_0x35f117(0x25e))var _0x47c700=users[_0x35f117(0x25e)];else{if(_0x2a03d2[0x0][_0x35f117(0x228)]=='French')var _0x47c700=users[_0x35f117(0x1bd)];else{if(_0x2a03d2[0x0]['language']==_0x35f117(0x243))var _0x47c700=users[_0x35f117(0x1e8)];else{if(_0x2a03d2[0x0][_0x35f117(0x228)]=='Chinese')var _0x47c700=users[_0x35f117(0x17c)];else{if(_0x2a03d2[0x0][_0x35f117(0x228)]=='Arabic\x20(ae)')var _0x47c700=users[_0x35f117(0x230)];}}}}}}}const _0x3493f1=getRandom8DigitNumber();_0x3493f1[_0x35f117(0x24a)](_0x39d2cd=>{var _0x14d326=_0x35f117;_0x358f29[_0x14d326(0x1bf)](_0x14d326(0x24e),{'success':_0x1e7998[_0x14d326(0x1cf)](_0x14d326(0x184)),'errors':_0x1e7998['flash'](_0x14d326(0x1a5)),'role':_0x283a3e,'profile':_0x12143e,'suppliers':_0x174788,'warehouse':_0x43ce43,'product':_0x2fa696,'invoice':_0x39d2cd,'master_shop':_0x2a03d2,'language':_0x47c700,'find_data':_0x2ab15e,'rooms_data':_0x24c42f});})[_0x35f117(0x247)](_0xcf0a44=>{var _0x5b33f5=_0x35f117;_0x1e7998[_0x5b33f5(0x1cf)](_0x5b33f5(0x1a5),_0x5b33f5(0x180)),_0x358f29[_0x5b33f5(0x24b)](_0x5b33f5(0x19c));});}catch(_0xaae453){console[_0x35f117(0x20d)](_0xaae453);}}),router[a0_0x2d1637(0x249)](a0_0x2d1637(0x1ce),auth,async(_0x439c55,_0x3909f7)=>{var _0x48ac19=a0_0x2d1637;try{const _0x392c6c=_0x439c55['params']['id'];console[_0x48ac19(0x20d)](_0x392c6c);const _0x18595f=await master_shop[_0x48ac19(0x258)]();console[_0x48ac19(0x20d)](_0x48ac19(0x190),_0x18595f);const _0x4970ea=await product[_0x48ac19(0x267)]({'name':_0x392c6c});console[_0x48ac19(0x20d)](_0x48ac19(0x1e7),_0x4970ea),_0x3909f7[_0x48ac19(0x1ab)](0xc8)[_0x48ac19(0x212)]({'product_data':_0x4970ea,'master':_0x18595f});}catch(_0x15857a){console[_0x48ac19(0x20d)](_0x48ac19(0x1c3),_0x15857a);}}),router['post'](a0_0x2d1637(0x1f4),auth,async(_0x5d5ab0,_0x8e17aa)=>{var _0x3dde2d=a0_0x2d1637;try{const {invoice:_0x252f91,date:_0x1dd465,warehouse_name:_0xf1a9a5,prod_name:_0x527cfb,prod_code:_0x38d72e,prod_qty:_0x13e52b,prod_unit:_0x2c34c7,prod_secondunit:_0x25e227,prod_level:_0xa0beef,prod_isle:_0x928f31,prod_pallet:_0x22ee01,note:_0x2103e3,expiry_date:_0xd3af73,batch_code:_0x13f521,payable:_0x1e2413,due_amount:_0x44c31f,Room_name:_0x196f4d,primary_code:_0x2babf7,secondary_code:_0x24f96c,MaxStocks_data:_0x31fbf5,PO_number:_0x4039eb,SCRN:_0x296e05,JO_number:_0x2fd86e}=_0x5d5ab0[_0x3dde2d(0x223)];if(typeof _0x527cfb==_0x3dde2d(0x194))var _0x365dbf=[_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x199)]],_0x3e8fff=[_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x1cb)]],_0x485868=[_0x5d5ab0[_0x3dde2d(0x223)]['prod_Qty']],_0x369c26=[_0x5d5ab0['body'][_0x3dde2d(0x219)]],_0x5cc2f3=[_0x5d5ab0[_0x3dde2d(0x223)]['prod_secondunit']],_0x4dd9ee=[_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x266)]],_0x384668=[_0x5d5ab0[_0x3dde2d(0x223)]['primary_code']],_0x5a74a1=[_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x237)]],_0x383143=[_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x21e)]],_0x3b3445=[_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x1d5)]],_0x448365=[_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x217)]],_0x16c7d8=[_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x1e4)]],_0x3b02e4=[_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x178)]],_0x247c9d=[_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x176)]],_0x22b4ce=[_0x5d5ab0[_0x3dde2d(0x223)]['RoomAssign']],_0x2025d2=[_0x5d5ab0[_0x3dde2d(0x223)]['prod_invoice']];else var _0x365dbf=[..._0x5d5ab0[_0x3dde2d(0x223)]['prod_name']],_0x3e8fff=[..._0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x1cb)]],_0x485868=[..._0x5d5ab0['body'][_0x3dde2d(0x172)]],_0x369c26=[..._0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x219)]],_0x5cc2f3=[..._0x5d5ab0[_0x3dde2d(0x223)]['prod_secondunit']],_0x4dd9ee=[..._0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x266)]],_0x384668=[..._0x5d5ab0[_0x3dde2d(0x223)]['primary_code']],_0x5a74a1=[..._0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x237)]],_0x383143=[..._0x5d5ab0['body'][_0x3dde2d(0x21e)]],_0x3b3445=[..._0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x1d5)]],_0x448365=[..._0x5d5ab0['body'][_0x3dde2d(0x217)]],_0x16c7d8=[..._0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x1e4)]],_0x3b02e4=[..._0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x178)]],_0x247c9d=[..._0x5d5ab0[_0x3dde2d(0x223)]['prod_cat']],_0x22b4ce=[..._0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x1cc)]],_0x2025d2=[..._0x5d5ab0['body'][_0x3dde2d(0x268)]];const _0x5a3389=_0x365dbf['map'](_0x1aa895=>{return _0x1aa895={'product_name':_0x1aa895};});_0x3e8fff[_0x3dde2d(0x261)]((_0x99fcd8,_0x368d6a)=>{var _0x5c9eff=_0x3dde2d;_0x5a3389[_0x368d6a][_0x5c9eff(0x254)]=_0x99fcd8;}),_0x485868[_0x3dde2d(0x261)]((_0x4b79a7,_0x530788)=>{var _0x168e57=_0x3dde2d;_0x5a3389[_0x530788][_0x168e57(0x224)]=Math['abs'](_0x4b79a7);}),_0x369c26[_0x3dde2d(0x261)]((_0x5df5b1,_0x2a7eaf)=>{var _0x471926=_0x3dde2d;_0x5a3389[_0x2a7eaf][_0x471926(0x265)]=_0x5df5b1;}),_0x5cc2f3[_0x3dde2d(0x261)]((_0x399fe0,_0x3a6a1c)=>{var _0x360c40=_0x3dde2d;_0x5a3389[_0x3a6a1c][_0x360c40(0x1a9)]=_0x399fe0;}),_0x4dd9ee[_0x3dde2d(0x261)]((_0x277d89,_0x3a9694)=>{var _0x539fba=_0x3dde2d;_0x5a3389[_0x3a9694][_0x539fba(0x17b)]=_0x277d89;}),_0x384668[_0x3dde2d(0x261)]((_0x40fc11,_0x42b963)=>{var _0x17c49b=_0x3dde2d;_0x5a3389[_0x42b963][_0x17c49b(0x17f)]=_0x40fc11;}),_0x5a74a1['forEach']((_0x59e740,_0x26252b)=>{_0x5a3389[_0x26252b]['secondary_code']=_0x59e740;}),_0x383143[_0x3dde2d(0x261)]((_0x446b95,_0x3bebb6)=>{var _0x3a3534=_0x3dde2d;_0x5a3389[_0x3bebb6][_0x3a3534(0x1f2)]=_0x446b95;}),_0x3b3445[_0x3dde2d(0x261)]((_0x4bc7ee,_0x2a2c62)=>{var _0x486d0d=_0x3dde2d;_0x5a3389[_0x2a2c62][_0x486d0d(0x1d5)]=_0x4bc7ee;}),_0x448365[_0x3dde2d(0x261)]((_0x4223ad,_0x32ff93)=>{var _0x500c6e=_0x3dde2d;_0x5a3389[_0x32ff93][_0x500c6e(0x217)]=_0x4223ad;}),_0x16c7d8[_0x3dde2d(0x261)]((_0x2eb4da,_0x5b3b87)=>{var _0x1983ae=_0x3dde2d;_0x5a3389[_0x5b3b87][_0x1983ae(0x1ef)]=_0x2eb4da;}),_0x3b02e4['forEach']((_0x3cec7a,_0x43c6e5)=>{var _0x36d56c=_0x3dde2d;_0x5a3389[_0x43c6e5][_0x36d56c(0x1c8)]=_0x3cec7a;}),_0x247c9d[_0x3dde2d(0x261)]((_0x294633,_0x15b664)=>{_0x5a3389[_0x15b664]['product_cat']=_0x294633;}),_0x22b4ce[_0x3dde2d(0x261)]((_0xcba05d,_0x355e70)=>{var _0x38656d=_0x3dde2d;_0x5a3389[_0x355e70][_0x38656d(0x18b)]=_0xcba05d;}),_0x2025d2[_0x3dde2d(0x261)]((_0x10c6e8,_0x15cf47)=>{var _0x5e6435=_0x3dde2d;_0x5a3389[_0x15cf47][_0x5e6435(0x218)]=_0x10c6e8;});const _0x721834=_0x5a3389['filter'](_0x384759=>_0x384759[_0x3dde2d(0x224)]!=='0'&&_0x384759['quantity']!==''),_0x58bac5=new purchases_finished({'invoice':_0x252f91,'suppliers':_0x5d5ab0[_0x3dde2d(0x223)][_0x3dde2d(0x1b5)],'date':_0x1dd465,'warehouse_name':_0xf1a9a5,'product':_0x721834,'note':_0x2103e3,'due_amount':_0x44c31f,'room':_0x196f4d,'POnumber':_0x4039eb,'SCRN':_0x296e05,'JO_number':_0x2fd86e}),_0x2c1095=await _0x58bac5[_0x3dde2d(0x1f8)](),_0x463ce3=await purchases_finished[_0x3dde2d(0x267)]({'invoice':_0x252f91}),_0x2cfaa9=_0x463ce3[_0x3dde2d(0x1e7)][_0x3dde2d(0x204)](async _0x5043bb=>{var _0x2d3f4b=_0x3dde2d;try{var _0x5992c8=await warehouse[_0x2d3f4b(0x267)]({'name':_0xf1a9a5,'room':_0x5043bb['room_name']}),_0x32dfd4=0x0;const _0x3465e4=_0x5992c8[_0x2d3f4b(0x18a)][_0x2d3f4b(0x204)](_0x151302=>{var _0x8a9ab2=_0x2d3f4b;console['log'](_0x151302[_0x8a9ab2(0x241)]+'=='+_0x5043bb[_0x8a9ab2(0x241)]+'&&'+_0x151302[_0x8a9ab2(0x17b)]+'=='+_0x5043bb[_0x8a9ab2(0x17b)]+'&&'+_0x151302[_0x8a9ab2(0x217)]+'=='+_0x5043bb[_0x8a9ab2(0x217)]+'&&'+_0x151302['production_date']+'=='+_0x5043bb['production_date']+'&&'+_0x151302['batch_code']+'=='+_0x5043bb[_0x8a9ab2(0x1d5)]+'&&'+_0x151302[_0x8a9ab2(0x218)]+'=='+_0x463ce3['invoice']),_0x151302[_0x8a9ab2(0x241)]==_0x5043bb[_0x8a9ab2(0x241)]&&_0x151302[_0x8a9ab2(0x17b)]==_0x5043bb[_0x8a9ab2(0x17b)]&&_0x151302[_0x8a9ab2(0x217)]==_0x5043bb[_0x8a9ab2(0x217)]&&_0x151302[_0x8a9ab2(0x1ef)]==_0x5043bb['production_date']&&_0x151302[_0x8a9ab2(0x1d5)]==_0x5043bb['batch_code']&&_0x151302['invoice']==_0x463ce3[_0x8a9ab2(0x218)]&&(_0x151302[_0x8a9ab2(0x1b0)]=Math[_0x8a9ab2(0x1dc)](_0x151302['product_stock'])+Math[_0x8a9ab2(0x1dc)](_0x5043bb['quantity']),_0x32dfd4++);});return _0x32dfd4==0x0&&(_0x5992c8[_0x2d3f4b(0x18a)]=_0x5992c8[_0x2d3f4b(0x18a)]['concat']({'product_name':_0x5043bb[_0x2d3f4b(0x241)],'product_stock':Math[_0x2d3f4b(0x1dc)](_0x5043bb[_0x2d3f4b(0x224)]),'primary_code':_0x5043bb[_0x2d3f4b(0x17f)],'secondary_code':_0x5043bb[_0x2d3f4b(0x237)],'product_code':_0x5043bb['product_code'],'bay':_0x5043bb[_0x2d3f4b(0x17b)],'maxProducts':_0x5043bb[_0x2d3f4b(0x1f2)],'unit':_0x5043bb[_0x2d3f4b(0x265)],'secondary_unit':_0x5043bb[_0x2d3f4b(0x1a9)],'expiry_date':_0x5043bb[_0x2d3f4b(0x217)],'production_date':_0x5043bb[_0x2d3f4b(0x1ef)],'maxProducts':_0x5043bb[_0x2d3f4b(0x1f2)],'maxPerUnit':_0x5043bb[_0x2d3f4b(0x1c8)],'batch_code':_0x5043bb[_0x2d3f4b(0x1d5)],'product_cat':_0x5043bb[_0x2d3f4b(0x257)],'invoice':_0x5043bb[_0x2d3f4b(0x218)],'id_incoming':_0x5043bb[_0x2d3f4b(0x197)]})),_0x5992c8;}catch(_0x215b3d){return console['error'](_0x2d3f4b(0x1c1),_0x215b3d),null;}});Promise[_0x3dde2d(0x1d6)](_0x2cfaa9)[_0x3dde2d(0x24a)](async _0x3c2ffc=>{var _0x113977=_0x3dde2d;try{for(const _0x50049f of _0x3c2ffc){await warehouse[_0x113977(0x208)]({'_id':_0x50049f[_0x113977(0x197)]},{'$addToSet':{'product_details':{'$each':_0x50049f[_0x113977(0x18a)]}}});}const _0x5960be=await master_shop['find'](),_0x3a53ab=await email_settings[_0x113977(0x267)](),_0x5e0feb=await supervisor_settings['find']();var _0x1dd5a2=_0x463ce3[_0x113977(0x1e7)],_0x4cbcff='',_0x3e004d;for(_0x3e004d in _0x1dd5a2){var _0x1d4111='FG';_0x463ce3[_0x113977(0x1ac)]=='DRY\x20GOODS'&&(_0x1d4111='DG'),_0x4cbcff+=_0x113977(0x1b1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1dd5a2[_0x3e004d][_0x113977(0x241)]+_0x113977(0x19d)+_0x113977(0x26a)+_0x1dd5a2[_0x3e004d]['product_code']+_0x113977(0x19d)+_0x113977(0x26a)+_0x1dd5a2[_0x3e004d]['quantity']+_0x113977(0x19d)+_0x113977(0x26a)+_0x1dd5a2[_0x3e004d][_0x113977(0x265)]+_0x113977(0x19d)+_0x113977(0x26a)+_0x1dd5a2[_0x3e004d][_0x113977(0x1a9)]+_0x113977(0x19d)+_0x113977(0x26a)+_0x463ce3[_0x113977(0x1ac)]+_0x113977(0x19d)+_0x113977(0x26a)+_0x1dd5a2[_0x3e004d][_0x113977(0x18b)]+_0x113977(0x19d)+_0x113977(0x26a)+_0x1d4111+_0x1dd5a2[_0x3e004d][_0x113977(0x17b)]+'</td>',_0x113977(0x244);}let _0x5a6bdc=nodemailer['createTransport']({'host':_0x3a53ab['host'],'port':Number(_0x3a53ab['port']),'secure':![],'auth':{'user':_0x3a53ab['email'],'pass':_0x3a53ab['password']}}),_0x522d92={'from':_0x3a53ab['email'],'to':_0x5e0feb[0x0]['FGSEmail'],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x113977(0x1ca),'path':__dirname+'/../public'+'/upload/'+_0x5960be[0x0][_0x113977(0x1ea)],'cid':_0x113977(0x245)}],'html':_0x113977(0x24c)+_0x113977(0x1d3)+_0x113977(0x1d7)+_0x113977(0x23a)+_0x113977(0x1f0)+_0x113977(0x23a)+_0x113977(0x1a6)+_0x113977(0x203)+_0x113977(0x23a)+_0x113977(0x19a)+_0x5960be[0x0][_0x113977(0x1ad)]+'\x20</h2>'+_0x113977(0x203)+'</div>'+_0x113977(0x1ff)+_0x113977(0x23a)+_0x113977(0x242)+_0x113977(0x202)+_0x463ce3['invoice']+'\x20'+_0x113977(0x211)+_0x113977(0x1f6)+_0x463ce3[_0x113977(0x1b3)]+'\x20'+_0x113977(0x187)+_0x113977(0x23c)+_0x113977(0x203)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x113977(0x20c)+_0x113977(0x1b1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x113977(0x183)+_0x113977(0x26d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x113977(0x1fb)+_0x113977(0x225)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x113977(0x222)+_0x113977(0x195)+'\x20'+_0x4cbcff+'\x20'+_0x113977(0x20f)+'</table>'+_0x113977(0x23a)+_0x113977(0x23f)+_0x113977(0x1b7)+_0x5960be[0x0]['site_title']+_0x113977(0x23c)+_0x113977(0x203)+_0x113977(0x203)+_0x113977(0x1da)};_0x5a6bdc[_0x113977(0x1ec)](_0x522d92,function(_0x4bced7,_0x57bc12){var _0x467316=_0x113977;_0x4bced7?(console['log'](_0x4bced7),console[_0x467316(0x20d)]('Error\x20Occurs')):console[_0x467316(0x20d)]('Email\x20sent\x20successfully');});}catch(_0x4dd534){console[_0x113977(0x213)](_0x4dd534),_0x8e17aa[_0x113977(0x1ab)](0x1f4)[_0x113977(0x212)]({'error':_0x113977(0x188),'message':_0x4dd534['message']});}})[_0x3dde2d(0x247)](_0x10383c=>{var _0x38be5b=_0x3dde2d;console[_0x38be5b(0x213)](_0x10383c);}),_0x5d5ab0[_0x3dde2d(0x1cf)](_0x3dde2d(0x184),_0x3dde2d(0x1a7)),_0x8e17aa[_0x3dde2d(0x24b)](_0x3dde2d(0x19c));}catch(_0x3b4841){console[_0x3dde2d(0x20d)](_0x3b4841);}}),router[a0_0x2d1637(0x249)](a0_0x2d1637(0x21c),auth,async(_0x4a5da3,_0x484b25)=>{var _0x4cb47e=a0_0x2d1637;try{const {username:_0x1c04b3,email:_0x505938,role:_0x2038bf}=_0x4a5da3[_0x4cb47e(0x179)],_0x1e6bb3=_0x4a5da3['user'],_0x32b598=await profile[_0x4cb47e(0x267)]({'email':_0x1e6bb3[_0x4cb47e(0x210)]}),_0x3a0eb3=await master_shop[_0x4cb47e(0x258)](),_0x2c1181=_0x4a5da3[_0x4cb47e(0x1ed)]['id'],_0x486b86=await purchases_finished[_0x4cb47e(0x1c4)](_0x2c1181),_0x4024ed=await suppliers[_0x4cb47e(0x258)]({});let _0x4e06b9;if(_0x1e6bb3[_0x4cb47e(0x25c)]=='staff'){const _0x54927c=await staff[_0x4cb47e(0x267)]({'email':_0x1e6bb3[_0x4cb47e(0x210)]});_0x4e06b9=await warehouse[_0x4cb47e(0x258)]({'status':_0x4cb47e(0x186),'name':_0x54927c[_0x4cb47e(0x19b)],'warehouse_category':_0x4cb47e(0x1fd)});}else _0x4e06b9=await warehouse[_0x4cb47e(0x256)]([{'$match':{'status':_0x4cb47e(0x186),'warehouse_category':_0x4cb47e(0x1fd)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x375e91=await product[_0x4cb47e(0x258)]({}),_0x50274e=BayBinSelected(_0x486b86[_0x4cb47e(0x1ac)],_0x486b86['room']);let _0x422c72=new Date(_0x486b86['expiry_date']),_0x19090f=('0'+_0x422c72[_0x4cb47e(0x17e)]())[_0x4cb47e(0x239)](-0x2),_0x50ab79=('0'+(_0x422c72[_0x4cb47e(0x22c)]()+0x1))[_0x4cb47e(0x239)](-0x2),_0x357bc6=_0x422c72[_0x4cb47e(0x238)](),_0x280a82=_0x357bc6+'-'+_0x50ab79+'-'+_0x19090f;if(_0x3a0eb3[0x0][_0x4cb47e(0x228)]==_0x4cb47e(0x22d)){var _0x1f3f42=users[_0x4cb47e(0x1fc)];console[_0x4cb47e(0x20d)](_0x1f3f42);}else{if(_0x3a0eb3[0x0][_0x4cb47e(0x228)]==_0x4cb47e(0x1ba))var _0x1f3f42=users[_0x4cb47e(0x1ba)];else{if(_0x3a0eb3[0x0][_0x4cb47e(0x228)]==_0x4cb47e(0x23e))var _0x1f3f42=users['German'];else{if(_0x3a0eb3[0x0][_0x4cb47e(0x228)]==_0x4cb47e(0x25e))var _0x1f3f42=users['Spanish'];else{if(_0x3a0eb3[0x0][_0x4cb47e(0x228)]==_0x4cb47e(0x1bd))var _0x1f3f42=users[_0x4cb47e(0x1bd)];else{if(_0x3a0eb3[0x0][_0x4cb47e(0x228)]==_0x4cb47e(0x243))var _0x1f3f42=users['Portuguese'];else{if(_0x3a0eb3[0x0][_0x4cb47e(0x228)]==_0x4cb47e(0x17c))var _0x1f3f42=users[_0x4cb47e(0x17c)];else{if(_0x3a0eb3[0x0]['language']==_0x4cb47e(0x1cd))var _0x1f3f42=users[_0x4cb47e(0x230)];}}}}}}}_0x484b25['render'](_0x4cb47e(0x185),{'success':_0x4a5da3['flash'](_0x4cb47e(0x184)),'errors':_0x4a5da3['flash']('errors'),'role':_0x1e6bb3,'profile':_0x32b598,'purchases':_0x486b86,'suppliers':_0x4024ed,'warehouse':_0x4e06b9,'product':_0x375e91,'master_shop':_0x3a0eb3,'language':_0x1f3f42,'ed_fullDate':_0x280a82,'dataSelected':_0x50274e});}catch(_0x8e2c95){console['log'](_0x8e2c95);}}),router[a0_0x2d1637(0x249)](a0_0x2d1637(0x1b2),auth,async(_0x151939,_0x40eb7f)=>{var _0xc310d8=a0_0x2d1637;try{const {username:_0x1c35b6,email:_0x50aebe,role:_0x397dd3}=_0x151939[_0xc310d8(0x179)],_0x586336=_0x151939[_0xc310d8(0x179)],_0x53de67=await profile[_0xc310d8(0x267)]({'email':_0x586336[_0xc310d8(0x210)]}),_0xb1de3c=await master_shop[_0xc310d8(0x258)](),_0x331083=_0x151939['params']['id'],_0x5ee3dc=await purchases_finished['findById'](_0x331083),_0x20e3c0=await suppliers[_0xc310d8(0x258)]({});let _0x4f6afd;if(_0x586336[_0xc310d8(0x25c)]=='staff'){const _0x5837bc=await staff[_0xc310d8(0x267)]({'email':_0x586336[_0xc310d8(0x210)]});_0x4f6afd=await warehouse[_0xc310d8(0x258)]({'status':_0xc310d8(0x186),'name':_0x5837bc[_0xc310d8(0x19b)],'warehouse_category':'Finished\x20Goods'});}else _0x4f6afd=await warehouse['aggregate']([{'$match':{'status':_0xc310d8(0x186),'warehouse_category':_0xc310d8(0x1fd)}},{'$group':{'_id':_0xc310d8(0x240),'name':{'$first':_0xc310d8(0x240)}}}]);const _0x4a07b8=await product[_0xc310d8(0x258)]({}),_0x569958=BayBinSelected(_0x5ee3dc[_0xc310d8(0x1ac)],_0x5ee3dc[_0xc310d8(0x233)]);let _0x5a328c=new Date(_0x5ee3dc['expiry_date']),_0x350b88=('0'+_0x5a328c[_0xc310d8(0x17e)]())['slice'](-0x2),_0x159777=('0'+(_0x5a328c[_0xc310d8(0x22c)]()+0x1))[_0xc310d8(0x239)](-0x2),_0x42e0e1=_0x5a328c[_0xc310d8(0x238)](),_0x27ffce=_0x42e0e1+'-'+_0x159777+'-'+_0x350b88;if(_0xb1de3c[0x0][_0xc310d8(0x228)]==_0xc310d8(0x22d)){var _0x3a3ad5=users['English'];console[_0xc310d8(0x20d)](_0x3a3ad5);}else{if(_0xb1de3c[0x0][_0xc310d8(0x228)]==_0xc310d8(0x1ba))var _0x3a3ad5=users[_0xc310d8(0x1ba)];else{if(_0xb1de3c[0x0]['language']=='German')var _0x3a3ad5=users[_0xc310d8(0x23e)];else{if(_0xb1de3c[0x0][_0xc310d8(0x228)]==_0xc310d8(0x25e))var _0x3a3ad5=users['Spanish'];else{if(_0xb1de3c[0x0][_0xc310d8(0x228)]==_0xc310d8(0x1bd))var _0x3a3ad5=users[_0xc310d8(0x1bd)];else{if(_0xb1de3c[0x0]['language']=='Portuguese\x20(BR)')var _0x3a3ad5=users[_0xc310d8(0x1e8)];else{if(_0xb1de3c[0x0]['language']==_0xc310d8(0x17c))var _0x3a3ad5=users['Chinese'];else{if(_0xb1de3c[0x0][_0xc310d8(0x228)]==_0xc310d8(0x1cd))var _0x3a3ad5=users[_0xc310d8(0x230)];}}}}}}}_0x40eb7f[_0xc310d8(0x1bf)]('edit_purchases_finished',{'success':_0x151939[_0xc310d8(0x1cf)]('success'),'errors':_0x151939['flash'](_0xc310d8(0x1a5)),'role':_0x586336,'profile':_0x53de67,'purchases':_0x5ee3dc,'suppliers':_0x20e3c0,'warehouse':_0x4f6afd,'product':_0x4a07b8,'master_shop':_0xb1de3c,'language':_0x3a3ad5,'ed_fullDate':_0x27ffce,'dataSelected':_0x569958});}catch(_0x2823c9){console[_0xc310d8(0x20d)](_0x2823c9);}}),router[a0_0x2d1637(0x263)](a0_0x2d1637(0x1b2),auth,async(_0x341c38,_0x157abc)=>{var _0x324444=a0_0x2d1637;try{const _0x29197f=_0x341c38[_0x324444(0x1ed)]['id'],_0x41a0a9=await purchases_finished[_0x324444(0x267)]({'_id':_0x341c38[_0x324444(0x1ed)]['id']}),_0x50d64c=await warehouse[_0x324444(0x267)]({'name':_0x41a0a9['warehouse_name'],'room':_0x41a0a9[_0x324444(0x233)]});_0x41a0a9[_0x324444(0x1e7)]['forEach'](_0x187524=>{var _0x41a2f8=_0x324444;const _0x1e6984=_0x50d64c[_0x41a2f8(0x18a)][_0x41a2f8(0x204)](_0x1f46c9=>{var _0xf4f3a6=_0x41a2f8;_0x1f46c9[_0xf4f3a6(0x241)]==_0x187524[_0xf4f3a6(0x241)]&&_0x1f46c9[_0xf4f3a6(0x17b)]==_0x187524['bay']&&(_0x1f46c9[_0xf4f3a6(0x1b0)]=parseInt(_0x1f46c9[_0xf4f3a6(0x1b0)])-parseInt(_0x187524['quantity']));});}),await _0x50d64c[_0x324444(0x1f8)]();const {invoice:_0xfcbd7a,suppliers:_0x4ac021,date:_0x463b51,warehouse_name:_0x107735,prod_name:_0x1e5fc3,prod_code:_0x29bf0f,prod_qty:_0x3549cf,prod_unit:_0x2478ae,prod_secondunit:_0xf9ce01,prod_level:_0x350088,prod_isle:_0x57a197,prod_pallet:_0x37b4e2,note:_0x1dfa22,expiry_date:_0x27d77a,batch_code:_0x5bc608,paid_amount:_0x36841b,due_amount:_0x168683,Room_name:_0x2153d5,primary_code:_0x58c6a8,secondary_code:_0x3cb514,PO_number:_0x25a3fb,JO_number:_0x4d378f}=_0x341c38[_0x324444(0x223)];if(typeof _0x1e5fc3==_0x324444(0x194))var _0xc0f3f9=[_0x341c38['body']['prod_name']],_0x18e925=[_0x341c38[_0x324444(0x223)][_0x324444(0x1cb)]],_0x36596a=[_0x341c38[_0x324444(0x223)]['prod_qty']],_0x3293f0=[_0x341c38[_0x324444(0x223)][_0x324444(0x18f)]],_0x484864=[_0x341c38['body'][_0x324444(0x1a0)]],_0x3c1e88=[_0x341c38['body'][_0x324444(0x266)]],_0x45fd20=[_0x341c38[_0x324444(0x223)]['primary_code']],_0x3de435=[_0x341c38['body'][_0x324444(0x237)]],_0x8ff550=[_0x341c38[_0x324444(0x223)]['MaxStocks_data']],_0x187ab2=[_0x341c38[_0x324444(0x223)][_0x324444(0x1d5)]],_0x87d76b=[_0x341c38[_0x324444(0x223)][_0x324444(0x217)]];else var _0xc0f3f9=[..._0x341c38['body'][_0x324444(0x199)]],_0x18e925=[..._0x341c38[_0x324444(0x223)][_0x324444(0x1cb)]],_0x36596a=[..._0x341c38[_0x324444(0x223)][_0x324444(0x1a4)]],_0x3293f0=[..._0x341c38[_0x324444(0x223)][_0x324444(0x18f)]],_0x484864=[..._0x341c38['body'][_0x324444(0x1a0)]],_0x3c1e88=[..._0x341c38[_0x324444(0x223)][_0x324444(0x266)]],_0x45fd20=[..._0x341c38['body'][_0x324444(0x17f)]],_0x3de435=[..._0x341c38['body'][_0x324444(0x237)]],_0x8ff550=[..._0x341c38['body'][_0x324444(0x21e)]],_0x187ab2=[..._0x341c38['body']['batch_code']],_0x87d76b=[..._0x341c38['body'][_0x324444(0x217)]];const _0x46ab4e=_0xc0f3f9['map'](_0x1fec0d=>{return _0x1fec0d={'product_name':_0x1fec0d};});_0x18e925[_0x324444(0x261)]((_0x38cf49,_0xdccb1b)=>{var _0x254810=_0x324444;_0x46ab4e[_0xdccb1b][_0x254810(0x254)]=_0x38cf49;}),_0x36596a['forEach']((_0x476c31,_0x37415e)=>{var _0x161df4=_0x324444;_0x46ab4e[_0x37415e][_0x161df4(0x224)]=_0x476c31;}),_0x3293f0[_0x324444(0x261)]((_0x3ae247,_0x5466c0)=>{_0x46ab4e[_0x5466c0]['standard_unit']=_0x3ae247;}),_0x484864[_0x324444(0x261)]((_0x2d1d6b,_0x173271)=>{var _0x64a448=_0x324444;_0x46ab4e[_0x173271][_0x64a448(0x1a9)]=_0x2d1d6b;}),_0x3c1e88[_0x324444(0x261)]((_0x18df9f,_0x1c0ca8)=>{_0x46ab4e[_0x1c0ca8]['bay']=_0x18df9f;}),_0x45fd20[_0x324444(0x261)]((_0x152565,_0x4e2115)=>{var _0x463597=_0x324444;_0x46ab4e[_0x4e2115][_0x463597(0x17f)]=_0x152565;}),_0x3de435['forEach']((_0x19e078,_0x3e08e9)=>{var _0x340a21=_0x324444;_0x46ab4e[_0x3e08e9][_0x340a21(0x237)]=_0x19e078;}),_0x8ff550[_0x324444(0x261)]((_0x3fd4cb,_0x37c192)=>{var _0x22b57d=_0x324444;_0x46ab4e[_0x37c192][_0x22b57d(0x1f2)]=_0x3fd4cb;}),_0x187ab2['forEach']((_0x14e097,_0x1c4945)=>{var _0x190acf=_0x324444;_0x46ab4e[_0x1c4945][_0x190acf(0x1d5)]=_0x14e097;}),_0x87d76b[_0x324444(0x261)]((_0xe27c65,_0x49e85)=>{var _0x561935=_0x324444;_0x46ab4e[_0x49e85][_0x561935(0x217)]=_0xe27c65;});const _0x33b712=_0x46ab4e[_0x324444(0x198)](_0x1d89e1=>_0x1d89e1[_0x324444(0x224)]!=='0'&&_0x1d89e1['quantity']!=='');_0x41a0a9[_0x324444(0x218)]=_0xfcbd7a,_0x41a0a9[_0x324444(0x1b5)]=_0x4ac021,_0x41a0a9[_0x324444(0x1b3)]=_0x463b51,_0x41a0a9['warehouse_name']=_0x107735,_0x41a0a9[_0x324444(0x1e7)]=_0x33b712,_0x41a0a9[_0x324444(0x175)]=_0x1dfa22,_0x41a0a9[_0x324444(0x22a)]=_0x36841b,_0x41a0a9[_0x324444(0x26b)]=_0x168683,_0x41a0a9[_0x324444(0x233)]=_0x2153d5,_0x41a0a9[_0x324444(0x229)]=_0x25a3fb,_0x41a0a9[_0x324444(0x1c5)]=_0x4d378f;const _0x4d0aab=await _0x41a0a9[_0x324444(0x1f8)](),_0x371241=await warehouse[_0x324444(0x267)]({'name':_0x341c38[_0x324444(0x223)][_0x324444(0x1ac)],'room':_0x341c38[_0x324444(0x223)][_0x324444(0x24d)]});_0x41a0a9[_0x324444(0x1e7)][_0x324444(0x261)](_0x466352=>{var _0xc4c5a0=_0x324444,_0xf20c94=0x0;const _0x23cce8=_0x371241['product_details'][_0xc4c5a0(0x204)](_0x310233=>{var _0x161f4e=_0xc4c5a0;_0x310233[_0x161f4e(0x241)]==_0x466352['product_name']&&_0x310233[_0x161f4e(0x17b)]==_0x466352['bay']&&(_0x310233[_0x161f4e(0x1b0)]=parseInt(_0x310233[_0x161f4e(0x1b0)])+parseInt(_0x466352[_0x161f4e(0x224)]),_0xf20c94++);});_0xf20c94=='0'&&(_0x371241['product_details']=_0x371241[_0xc4c5a0(0x18a)][_0xc4c5a0(0x236)]({'product_name':_0x466352[_0xc4c5a0(0x241)],'product_stock':_0x466352[_0xc4c5a0(0x224)],'primary_code':_0x466352[_0xc4c5a0(0x17f)],'secondary_code':_0x466352[_0xc4c5a0(0x237)],'product_code':_0x466352['product_code'],'bay':_0x466352[_0xc4c5a0(0x17b)],'maxProducts':_0x466352[_0xc4c5a0(0x1f2)],'unit':_0x466352[_0xc4c5a0(0x265)],'secondary_unit':_0x466352['secondary_unit'],'expiry_date':_0x466352[_0xc4c5a0(0x217)]}));}),await _0x371241[_0x324444(0x1f8)]();const _0x1eeb82=await s_payment_data[_0x324444(0x267)]({'invoice':_0x341c38['body'][_0x324444(0x218)]});if(_0x1eeb82===null){}else console[_0x324444(0x20d)](_0x324444(0x1b5),_0x1eeb82,_0x341c38['body'][_0x324444(0x218)]),_0x1eeb82['suppliers']=_0x341c38[_0x324444(0x223)][_0x324444(0x1b5)],await _0x1eeb82[_0x324444(0x1f8)]();_0x341c38[_0x324444(0x1cf)](_0x324444(0x184),_0x324444(0x171)),_0x157abc[_0x324444(0x24b)](_0x324444(0x19c));}catch(_0x1998c7){console[_0x324444(0x20d)](_0x1998c7);}}),router[a0_0x2d1637(0x263)](a0_0x2d1637(0x1c0),auth,async(_0x263619,_0x2dc479)=>{var _0x4dbad0=a0_0x2d1637;try{const _0x5c83e1=_0x263619[_0x4dbad0(0x1ed)]['id'],{invoice:_0x525a9d,suppliers:_0x1d89b6,payable:_0x3ca8c2,due_amount:_0x3afca8}=_0x263619[_0x4dbad0(0x223)],_0x23d2fa=await purchases['findById'](_0x5c83e1);var _0x561fad=_0x3ca8c2-_0x3afca8;_0x23d2fa[_0x4dbad0(0x22a)]=parseFloat(_0x23d2fa[_0x4dbad0(0x22a)])+parseFloat(_0x3afca8),_0x23d2fa[_0x4dbad0(0x26b)]=_0x561fad;const _0x4c472c=await _0x23d2fa[_0x4dbad0(0x1f8)]();console[_0x4dbad0(0x20d)](_0x4c472c);const _0x3357c6=await s_payment_data[_0x4dbad0(0x267)]({'invoice':_0x525a9d});_0x3357c6[_0x4dbad0(0x252)]=_0x561fad,await _0x3357c6['save']();let _0x5ee81d=new Date(),_0xfc14a0=('0'+_0x5ee81d[_0x4dbad0(0x17e)]())[_0x4dbad0(0x239)](-0x2),_0x1e7bc4=('0'+(_0x5ee81d[_0x4dbad0(0x22c)]()+0x1))[_0x4dbad0(0x239)](-0x2),_0x393a3a=_0x5ee81d['getFullYear'](),_0x39eb86=_0x393a3a+'-'+_0x1e7bc4+'-'+_0xfc14a0;const _0x2175af=new suppliers_payment({'invoice':_0x525a9d,'date':_0x393a3a+'-'+_0x1e7bc4+'-'+_0xfc14a0,'suppliers':_0x1d89b6,'reason':'Paid\x20For\x20Purchase','amount':_0x3afca8}),_0x194130=await _0x2175af['save']();_0x263619[_0x4dbad0(0x1cf)](_0x4dbad0(0x184),_0x4dbad0(0x1f1)),_0x2dc479[_0x4dbad0(0x24b)]('/all_purchases/view');}catch(_0x2efadf){console[_0x4dbad0(0x20d)](_0x2efadf);}}),router['get'](a0_0x2d1637(0x1b9),auth,async(_0x567acb,_0x467f89)=>{var _0x56e6b7=a0_0x2d1637;try{const {username:_0x2cca35,email:_0x1dbd51,role:_0x5c4763}=_0x567acb['user'],_0x496a84=_0x567acb[_0x56e6b7(0x179)],_0x467298=await profile[_0x56e6b7(0x267)]({'email':_0x496a84[_0x56e6b7(0x210)]}),_0x2570da=await master_shop['find']();console['log'](_0x56e6b7(0x190),_0x2570da);const _0x4a1ee2=_0x567acb[_0x56e6b7(0x1ed)]['id'],_0x41d7a4=await purchases['findById'](_0x4a1ee2);console[_0x56e6b7(0x20d)](_0x41d7a4);const _0x1bb929=await suppliers[_0x56e6b7(0x267)]({'name':_0x41d7a4[_0x56e6b7(0x1b5)]});console['log'](_0x1bb929);if(_0x2570da[0x0][_0x56e6b7(0x228)]==_0x56e6b7(0x22d)){var _0x4b3221=users[_0x56e6b7(0x1fc)];console['log'](_0x4b3221);}else{if(_0x2570da[0x0][_0x56e6b7(0x228)]==_0x56e6b7(0x1ba))var _0x4b3221=users[_0x56e6b7(0x1ba)];else{if(_0x2570da[0x0][_0x56e6b7(0x228)]==_0x56e6b7(0x23e))var _0x4b3221=users[_0x56e6b7(0x23e)];else{if(_0x2570da[0x0][_0x56e6b7(0x228)]==_0x56e6b7(0x25e))var _0x4b3221=users[_0x56e6b7(0x25e)];else{if(_0x2570da[0x0][_0x56e6b7(0x228)]==_0x56e6b7(0x1bd))var _0x4b3221=users[_0x56e6b7(0x1bd)];else{if(_0x2570da[0x0][_0x56e6b7(0x228)]==_0x56e6b7(0x243))var _0x4b3221=users['Portuguese'];else{if(_0x2570da[0x0][_0x56e6b7(0x228)]==_0x56e6b7(0x17c))var _0x4b3221=users[_0x56e6b7(0x17c)];else{if(_0x2570da[0x0][_0x56e6b7(0x228)]==_0x56e6b7(0x1cd))var _0x4b3221=users[_0x56e6b7(0x230)];}}}}}}}_0x467f89[_0x56e6b7(0x1bf)]('purchase_invoice',{'success':_0x567acb[_0x56e6b7(0x1cf)]('success'),'errors':_0x567acb[_0x56e6b7(0x1cf)](_0x56e6b7(0x1a5)),'role':_0x496a84,'profile':_0x467298,'master_shop':_0x2570da,'supplier':_0x1bb929,'purchase':_0x41d7a4,'language':_0x4b3221});}catch(_0x23ffc5){console['log'](_0x23ffc5);}}),router[a0_0x2d1637(0x249)](a0_0x2d1637(0x18c),auth,async(_0x3e5149,_0x388e6c)=>{var _0x1938d3=a0_0x2d1637;try{const {username:_0x81cc15,email:_0x3da225,role:_0x182c8f}=_0x3e5149[_0x1938d3(0x179)],_0x3e99a6=_0x3e5149[_0x1938d3(0x179)],_0x1e4321=await profile[_0x1938d3(0x267)]({'email':_0x3e99a6['email']}),_0x3801e1=await master_shop[_0x1938d3(0x258)]();console[_0x1938d3(0x20d)](_0x1938d3(0x190),_0x3801e1);const _0x57d463=_0x3e5149[_0x1938d3(0x1ed)]['id'];console['log'](_0x57d463);const _0x4dabc5=await purchases_finished[_0x1938d3(0x1c4)](_0x57d463);console[_0x1938d3(0x20d)]('user_id',_0x4dabc5);const _0x1e1356=await product[_0x1938d3(0x258)]({}),_0x1cad3e=await warehouse[_0x1938d3(0x256)]([{'$match':{'name':_0x4dabc5[_0x1938d3(0x1ac)],'room':_0x4dabc5[_0x1938d3(0x233)]}},{'$unwind':_0x1938d3(0x24f)},{'$group':{'_id':_0x1938d3(0x21f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1938d3(0x20b)},'bay':{'$first':_0x1938d3(0x196)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1938d3(0x26c)},'secondary_code':{'$first':_0x1938d3(0x215)},'product_code':{'$first':_0x1938d3(0x1df)},'storage':{'$first':_0x1938d3(0x207)},'rack':{'$first':_0x1938d3(0x26e)}}}]);console['log'](_0x1938d3(0x1a3),_0x1cad3e);let _0x4bf3d0;if(_0x3e99a6['role']==_0x1938d3(0x1a8)){const _0x3c0c25=await staff[_0x1938d3(0x267)]({'email':_0x3e99a6[_0x1938d3(0x210)]});_0x4bf3d0=await warehouse['find']({'status':_0x1938d3(0x186),'name':_0x3c0c25[_0x1938d3(0x19b)],'warehouse_category':'Finished\x20Goods','name':_0x1938d3(0x25d)});}else _0x4bf3d0=await warehouse['aggregate']([{'$match':{'status':_0x1938d3(0x186),'warehouse_category':_0x1938d3(0x1fd),'name':_0x1938d3(0x25d)}},{'$group':{'_id':'$name','name':{'$first':_0x1938d3(0x240)}}}]);if(_0x3801e1[0x0]['language']=='English\x20(US)'){var _0x31340c=users[_0x1938d3(0x1fc)];console[_0x1938d3(0x20d)](_0x31340c);}else{if(_0x3801e1[0x0][_0x1938d3(0x228)]==_0x1938d3(0x1ba))var _0x31340c=users[_0x1938d3(0x1ba)];else{if(_0x3801e1[0x0][_0x1938d3(0x228)]==_0x1938d3(0x23e))var _0x31340c=users[_0x1938d3(0x23e)];else{if(_0x3801e1[0x0]['language']==_0x1938d3(0x25e))var _0x31340c=users['Spanish'];else{if(_0x3801e1[0x0][_0x1938d3(0x228)]==_0x1938d3(0x1bd))var _0x31340c=users[_0x1938d3(0x1bd)];else{if(_0x3801e1[0x0]['language']==_0x1938d3(0x243))var _0x31340c=users[_0x1938d3(0x1e8)];else{if(_0x3801e1[0x0][_0x1938d3(0x228)]==_0x1938d3(0x17c))var _0x31340c=users[_0x1938d3(0x17c)];else{if(_0x3801e1[0x0]['language']==_0x1938d3(0x1cd))var _0x31340c=users[_0x1938d3(0x230)];}}}}}}}_0x388e6c[_0x1938d3(0x1bf)](_0x1938d3(0x1c7),{'success':_0x3e5149[_0x1938d3(0x1cf)]('success'),'errors':_0x3e5149[_0x1938d3(0x1cf)](_0x1938d3(0x1a5)),'role':_0x3e99a6,'profile':_0x1e4321,'user':_0x4dabc5,'stock':_0x1cad3e,'master_shop':_0x3801e1,'product':_0x1e1356,'language':_0x31340c,'warehouse':_0x4bf3d0});}catch(_0x2711bd){console[_0x1938d3(0x20d)](_0x2711bd);}}),router[a0_0x2d1637(0x263)](a0_0x2d1637(0x18c),auth,async(_0x2c5491,_0x2b9d87)=>{var _0x4b11d3=a0_0x2d1637;try{const {invoice:_0x1df379,date:_0xb150d5,warehouse_name:_0x47e0d2,Room_name:_0x228b2c,product_name:_0x168104,purchase_quantity:_0x45b969,stocks:_0x26f817,return_qty:_0x3ea038,note:_0x538423,level:_0x99664e,isle:_0x525715,pallet:_0x4c4359,to_warehouse_name:_0x2cad44,to_Room_name:_0x1a9074}=_0x2c5491[_0x4b11d3(0x223)],_0x5c98c4=await purchases_finished[_0x4b11d3(0x267)]({'_id':_0x2c5491[_0x4b11d3(0x1ed)]['id']}),_0x48db71=await warehouse[_0x4b11d3(0x267)]({'name':_0x47e0d2,'room':_0x228b2c,'warehouse_category':_0x4b11d3(0x1fd)});if(typeof _0x168104==_0x4b11d3(0x194))var _0x115427=[_0x2c5491[_0x4b11d3(0x223)]['product_name']],_0x4c36e2=[_0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x1c6)]],_0x4edf80=[_0x2c5491['body'][_0x4b11d3(0x235)]],_0x114e40=[_0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x1bb)]],_0x33cedc=[_0x2c5491['body'][_0x4b11d3(0x269)]],_0x38f15c=[_0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x1a2)]],_0x1fe753=[_0x2c5491[_0x4b11d3(0x223)]['primary_code_hide']],_0x35f387=[_0x2c5491['body'][_0x4b11d3(0x234)]];else var _0x115427=[..._0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x241)]],_0x4c36e2=[..._0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x1c6)]],_0x4edf80=[..._0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x235)]],_0x114e40=[..._0x2c5491['body'][_0x4b11d3(0x1bb)]],_0x33cedc=[..._0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x269)]],_0x38f15c=[..._0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x1a2)]],_0x1fe753=[..._0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x260)]],_0x35f387=[..._0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x234)]];const _0x170441=_0x115427[_0x4b11d3(0x204)](_0x21e4d4=>{return _0x21e4d4={'product_name':_0x21e4d4};});_0x4c36e2[_0x4b11d3(0x261)]((_0x3a1b4a,_0x38013f)=>{var _0x447bce=_0x4b11d3;_0x170441[_0x38013f][_0x447bce(0x1c6)]=_0x3a1b4a;}),_0x4edf80['forEach']((_0x4b5f52,_0x3b3f4b)=>{var _0x12df2d=_0x4b11d3;_0x170441[_0x3b3f4b][_0x12df2d(0x255)]=_0x4b5f52;}),_0x114e40[_0x4b11d3(0x261)]((_0x895d50,_0x412acc)=>{_0x170441[_0x412acc]['return_qty']=_0x895d50;}),_0x33cedc['forEach']((_0x35bf0b,_0x5900be)=>{var _0x8904e3=_0x4b11d3;_0x170441[_0x5900be][_0x8904e3(0x17b)]=_0x35bf0b;}),_0x38f15c['forEach']((_0x477791,_0x437998)=>{var _0x214455=_0x4b11d3;_0x170441[_0x437998][_0x214455(0x254)]=_0x477791;}),_0x1fe753[_0x4b11d3(0x261)]((_0x54a31e,_0xbaa34b)=>{_0x170441[_0xbaa34b]['primary_code']=_0x54a31e;}),_0x35f387[_0x4b11d3(0x261)]((_0xc77158,_0x474748)=>{var _0x3a784c=_0x4b11d3;_0x170441[_0x474748][_0x3a784c(0x237)]=_0xc77158;}),_0x170441['forEach'](_0x4265b1=>{var _0x808362=_0x4b11d3;console[_0x808362(0x20d)](_0x4265b1);const _0x6fbc09=_0x48db71['product_details'][_0x808362(0x204)](_0x371abc=>{var _0xfb51dd=_0x808362;_0x371abc[_0xfb51dd(0x241)]==_0x4265b1[_0xfb51dd(0x241)]&&_0x371abc[_0xfb51dd(0x17b)]==_0x4265b1[_0xfb51dd(0x17b)]&&(console['log'](parseInt(_0x371abc[_0xfb51dd(0x1b0)])+_0xfb51dd(0x1af)+parseInt(_0x4265b1[_0xfb51dd(0x1bb)])),_0x371abc['product_stock']=parseInt(_0x371abc[_0xfb51dd(0x1b0)])-parseInt(_0x4265b1[_0xfb51dd(0x1bb)]));});}),await _0x48db71[_0x4b11d3(0x1f8)]();var _0x535f50=0x0;_0x170441[_0x4b11d3(0x261)](_0x53ccd8=>{var _0x5b73e4=_0x4b11d3;(parseInt(_0x53ccd8[_0x5b73e4(0x1c6)])<parseInt(_0x53ccd8[_0x5b73e4(0x1bb)])||parseInt(_0x53ccd8[_0x5b73e4(0x255)])<parseInt(_0x53ccd8[_0x5b73e4(0x1bb)]))&&_0x535f50++;});if(_0x535f50!=0x0)return _0x2c5491[_0x4b11d3(0x1cf)](_0x4b11d3(0x1a5),_0x4b11d3(0x1b6)),_0x2b9d87['redirect'](_0x4b11d3(0x1f9));const _0x512969=new purchases_return_finished({'invoice':_0x1df379,'suppliers':_0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x1b5)],'date':_0xb150d5,'warehouse_name':_0x47e0d2,'return_product':_0x170441,'note':_0x538423,'room':_0x228b2c,'to_warehouse_name':_0x2cad44,'to_room':_0x1a9074}),_0x16978a=await _0x512969[_0x4b11d3(0x1f8)](),_0x58789d=await purchases_return_finished[_0x4b11d3(0x267)]({'invoice':_0x1df379}),_0x5dff87=await warehouse['findOne']({'name':_0x2cad44,'room':_0x1a9074,'warehouse_category':_0x4b11d3(0x1fd)});_0x58789d[_0x4b11d3(0x19f)][_0x4b11d3(0x261)](_0x7f2d1e=>{var _0x252725=_0x4b11d3,_0x5a5a39=0x0;const _0xd8a482=_0x5dff87[_0x252725(0x18a)]['map'](_0x456fd0=>{var _0x2c422d=_0x252725;console[_0x2c422d(0x20d)](_0x456fd0[_0x2c422d(0x241)]+'=='+_0x7f2d1e['product_name']+'&&'+_0x456fd0[_0x2c422d(0x17b)]+'=='+_0x7f2d1e[_0x2c422d(0x17b)]),_0x456fd0[_0x2c422d(0x241)]==_0x7f2d1e['product_name']&&_0x456fd0[_0x2c422d(0x17b)]==_0x7f2d1e[_0x2c422d(0x17b)]&&(_0x456fd0[_0x2c422d(0x1b0)]=parseInt(_0x456fd0[_0x2c422d(0x1b0)])-parseInt(_0x7f2d1e[_0x2c422d(0x1bb)]),_0x5a5a39++);});_0x5a5a39=='0'&&(_0x5dff87[_0x252725(0x18a)]=_0x5dff87[_0x252725(0x18a)][_0x252725(0x236)]({'product_name':_0x7f2d1e[_0x252725(0x241)],'product_stock':_0x7f2d1e['return_qty'],'primary_code':_0x7f2d1e[_0x252725(0x17f)],'secondary_code':_0x7f2d1e['secondary_code'],'product_code':_0x7f2d1e[_0x252725(0x254)],'bay':_0x7f2d1e['bay'],'maxProducts':0xf423f}));}),await _0x5dff87[_0x4b11d3(0x1f8)]();const _0x3f29cc=await purchases_finished[_0x4b11d3(0x267)]({'invoice':_0x1df379});_0x3f29cc[_0x4b11d3(0x25a)]=_0x4b11d3(0x1bc);const _0x171241=await _0x3f29cc[_0x4b11d3(0x1f8)](),_0x5c6206=new s_payment_data({'invoice':_0x1df379,'suppliers':_0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x1b5)],'reason':'Purchase\x20Return'});await _0x5c6206[_0x4b11d3(0x1f8)]();const _0x5ebffb=await master_shop[_0x4b11d3(0x258)](),_0x5109c1=await email_settings[_0x4b11d3(0x267)](),_0x17099a=await suppliers[_0x4b11d3(0x267)]({'name':_0x2c5491[_0x4b11d3(0x223)][_0x4b11d3(0x1b5)]});_0x5ebffb[0x0][_0x4b11d3(0x20a)]==0x1?(right_currency=_0x5ebffb[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5ebffb[0x0]['currency']);var _0x3c0667=_0x115427,_0x14065c=_0x114e40,_0x51ebe4='',_0x29cf6f;for(_0x29cf6f in _0x3c0667){_0x51ebe4+=_0x4b11d3(0x1b1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3c0667[_0x29cf6f]+_0x4b11d3(0x19d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x14065c[_0x29cf6f]+_0x4b11d3(0x19d)+_0x4b11d3(0x244);}let _0x46e1b8=nodemailer[_0x4b11d3(0x231)]({'service':_0x4b11d3(0x232),'auth':{'user':_0x5109c1[_0x4b11d3(0x210)],'pass':_0x5109c1['password']}}),_0xd52813={'from':_0x5109c1['email'],'to':_0x17099a[_0x4b11d3(0x210)],'subject':_0x4b11d3(0x262),'attachments':[{'filename':_0x4b11d3(0x1ca),'path':__dirname+_0x4b11d3(0x221)+_0x4b11d3(0x1a1)+_0x5ebffb[0x0][_0x4b11d3(0x1ea)],'cid':_0x4b11d3(0x245)}],'html':'<!DOCTYPE\x20html>'+_0x4b11d3(0x1d3)+_0x4b11d3(0x1d7)+_0x4b11d3(0x23a)+_0x4b11d3(0x1f0)+_0x4b11d3(0x23a)+_0x4b11d3(0x1a6)+_0x4b11d3(0x203)+_0x4b11d3(0x23a)+_0x4b11d3(0x19a)+_0x5ebffb[0x0]['site_title']+'\x20</h2>'+_0x4b11d3(0x203)+'</div>'+_0x4b11d3(0x1ff)+_0x4b11d3(0x23a)+_0x4b11d3(0x242)+_0x4b11d3(0x202)+_0x1df379+'\x20'+_0x4b11d3(0x211)+_0x4b11d3(0x1f6)+_0xb150d5+'\x20'+_0x4b11d3(0x187)+_0x4b11d3(0x23c)+_0x4b11d3(0x203)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4b11d3(0x1b1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4b11d3(0x25b)+_0x4b11d3(0x1e1)+_0x4b11d3(0x1c2)+'</tr>'+'</thead>'+_0x4b11d3(0x195)+'\x20'+_0x51ebe4+'\x20'+_0x4b11d3(0x20f)+_0x4b11d3(0x216)+_0x4b11d3(0x23a)+'<strong>\x20Regards\x20</strong>'+_0x4b11d3(0x1b7)+_0x5ebffb[0x0][_0x4b11d3(0x1ad)]+'</h5>'+_0x4b11d3(0x203)+_0x4b11d3(0x203)+_0x4b11d3(0x1da)};_0x46e1b8['sendMail'](_0xd52813,function(_0x18ec42,_0x5434ee){var _0x5aeff4=_0x4b11d3;_0x18ec42?console[_0x5aeff4(0x20d)](_0x5aeff4(0x22f)):console['log'](_0x5aeff4(0x192));}),_0x2c5491[_0x4b11d3(0x1cf)]('success',_0x4b11d3(0x1e6)),_0x2b9d87[_0x4b11d3(0x24b)]('/all_purchases_finished/view');}catch(_0x579e8d){_0x2b9d87[_0x4b11d3(0x1ab)](0xc8)[_0x4b11d3(0x212)]({'message':_0x579e8d[_0x4b11d3(0x248)]});}}),router[a0_0x2d1637(0x249)](a0_0x2d1637(0x1aa),auth,async(_0x4d0534,_0x43804d)=>{var _0x57f86f=a0_0x2d1637;try{const {username:_0x1f0b11,email:_0x3a146c,role:_0x59106d}=_0x4d0534[_0x57f86f(0x179)],_0xca4bb6=_0x4d0534[_0x57f86f(0x179)],_0x16917d=await profile['findOne']({'email':_0xca4bb6[_0x57f86f(0x210)]}),_0x492184=await master_shop[_0x57f86f(0x258)](),_0x440e50=_0x4d0534[_0x57f86f(0x1ed)]['id'],_0x2c9e0a=await purchases_finished[_0x57f86f(0x1c4)](_0x440e50);if(_0x492184[0x0]['language']==_0x57f86f(0x22d))var _0x1dba4f=users['English'];else{if(_0x492184[0x0][_0x57f86f(0x228)]==_0x57f86f(0x1ba))var _0x1dba4f=users[_0x57f86f(0x1ba)];else{if(_0x492184[0x0][_0x57f86f(0x228)]==_0x57f86f(0x23e))var _0x1dba4f=users[_0x57f86f(0x23e)];else{if(_0x492184[0x0][_0x57f86f(0x228)]=='Spanish')var _0x1dba4f=users[_0x57f86f(0x25e)];else{if(_0x492184[0x0][_0x57f86f(0x228)]==_0x57f86f(0x1bd))var _0x1dba4f=users[_0x57f86f(0x1bd)];else{if(_0x492184[0x0]['language']==_0x57f86f(0x243))var _0x1dba4f=users[_0x57f86f(0x1e8)];else{if(_0x492184[0x0][_0x57f86f(0x228)]==_0x57f86f(0x17c))var _0x1dba4f=users[_0x57f86f(0x17c)];else{if(_0x492184[0x0]['language']==_0x57f86f(0x1cd))var _0x1dba4f=users[_0x57f86f(0x230)];}}}}}}}_0x43804d[_0x57f86f(0x1bf)](_0x57f86f(0x1e5),{'success':_0x4d0534[_0x57f86f(0x1cf)](_0x57f86f(0x184)),'errors':_0x4d0534[_0x57f86f(0x1cf)](_0x57f86f(0x1a5)),'role':_0xca4bb6,'profile':_0x16917d,'alldata':_0x2c9e0a,'master_shop':_0x492184,'language':_0x1dba4f}),console[_0x57f86f(0x20d)](alldata);}catch(_0x5f165a){console[_0x57f86f(0x20d)](_0x5f165a);}}),router[a0_0x2d1637(0x263)](a0_0x2d1637(0x19e),async(_0x16b982,_0x2bd9a9)=>{var _0x13cbb8=a0_0x2d1637;const {product_code:_0x3dc0bf}=_0x16b982[_0x13cbb8(0x223)];var _0xd44975;const _0x405c51=await product['aggregate']([{'$match':{'primary_code':_0x3dc0bf,'product_category':_0x13cbb8(0x1fd)}},{'$group':{'_id':_0x13cbb8(0x1f7),'name':{'$first':_0x13cbb8(0x240)},'category':{'$first':_0x13cbb8(0x227)},'brand':{'$first':'$brand'},'unit':{'$first':_0x13cbb8(0x17d)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x13cbb8(0x170)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x13cbb8(0x1f5)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x13cbb8(0x1de)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x13cbb8(0x1e3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x380c7d=await product[_0x13cbb8(0x256)]([{'$match':{'secondary_code':_0x3dc0bf}},{'$group':{'_id':_0x13cbb8(0x1f7),'name':{'$first':_0x13cbb8(0x240)},'category':{'$first':_0x13cbb8(0x227)},'brand':{'$first':_0x13cbb8(0x1e2)},'unit':{'$first':_0x13cbb8(0x17d)},'alertquantity':{'$first':_0x13cbb8(0x173)},'product_code':{'$first':_0x13cbb8(0x170)},'primary_code':{'$first':_0x13cbb8(0x1fa)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x13cbb8(0x200)},'maxProdPerUnit':{'$first':_0x13cbb8(0x1de)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x13cbb8(0x1e3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x405c51[_0x13cbb8(0x18d)]>0x0)_0xd44975=_0x405c51;else _0x380c7d[_0x13cbb8(0x18d)]>0x0&&(_0xd44975=_0x380c7d);_0x2bd9a9[_0x13cbb8(0x212)](_0xd44975);}),router[a0_0x2d1637(0x263)](a0_0x2d1637(0x1d8),async(_0x46f3f7,_0x4bb294)=>{var _0x488955=a0_0x2d1637;const {productCode:_0x45dfa9,bay:_0x176484,warehouses:_0x34cd11,room:_0x591e1b}=_0x46f3f7[_0x488955(0x223)];console[_0x488955(0x20d)](_0x46f3f7['body']);try{const _0x297e57=await warehouse[_0x488955(0x256)]([{'$match':{'name':_0x34cd11,'room':_0x591e1b}},{'$unwind':_0x488955(0x24f)},{'$match':{'product_details.bay':parseInt(_0x176484)}},{'$group':{'_id':_0x488955(0x21f),'name':{'$first':_0x488955(0x1f3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x488955(0x196)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4bb294[_0x488955(0x1ab)](0xc8)[_0x488955(0x212)](_0x297e57);}catch(_0x3f35dc){_0x4bb294[_0x488955(0x1ab)](0x194)[_0x488955(0x212)]({'message':_0x3f35dc[_0x488955(0x248)]});}}),module[a0_0x2d1637(0x1dd)]=router;