var a0_0x3d00da=a0_0x387a;(function(_0x52885a,_0x36c46c){var _0x51a0e5=a0_0x387a,_0x5de3cc=_0x52885a();while(!![]){try{var _0x316ea7=-parseInt(_0x51a0e5(0x289))/0x1*(parseInt(_0x51a0e5(0x224))/0x2)+parseInt(_0x51a0e5(0x237))/0x3+-parseInt(_0x51a0e5(0x214))/0x4*(parseInt(_0x51a0e5(0x230))/0x5)+parseInt(_0x51a0e5(0x28d))/0x6+parseInt(_0x51a0e5(0x1bd))/0x7*(-parseInt(_0x51a0e5(0x1ac))/0x8)+parseInt(_0x51a0e5(0x1cd))/0x9+parseInt(_0x51a0e5(0x265))/0xa;if(_0x316ea7===_0x36c46c)break;else _0x5de3cc['push'](_0x5de3cc['shift']());}catch(_0x2780a7){_0x5de3cc['push'](_0x5de3cc['shift']());}}}(a0_0x5170,0x6a1fa));function a0_0x5170(){var _0x519fb3=['maxStocks','1672996zhkLnd','quantity','createTransport','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_stock','product_date','bay','<h2>\x20','exports','FROZEN\x20GOODS','paid_amount','/invoice/:id','RoomAssign','padStart','<strong>\x20Regards\x20</strong>','\x20Order\x20Number\x20:\x20','2lbTRgT','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$warehouse_name','An\x20error\x20occurred\x20while\x20saving\x20data.','/CheckingWarehouse','add_purchases_finished','$invoice','findById','Enabled','$product.type','date','render','5FUEfMk','body','table\x20page','toString','</tr>','warehouse','room','1648581JRyOxW','string','<hr\x20class=\x22my-3\x22>','Chinese','English','Ambient','/upload/','English\x20(US)','$primary_code','Purchase\x20Mail','prod_unit','</thead>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.maxProducts','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','edit_purchases_finished','Paid\x20For\x20Purchase','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','sendMail','add_purchases\x20error','$product_details.secondary_code','<tr>','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','\x20<>\x20','role','$secondary_unit','product_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','host','status','message','abs','/view/add_purchases','Rack\x201','errors','name','expiry_date','product_code_hide','random','production_date','_id','$paid_amount','4647350gpCrgZ','find','stocks','catch','</h5>','secondary_unit','flash','</head><body>','length','password','$product.bay','warehouse_name','floor','$product_details','getMonth','site_title','/all_purchases/view','$product_details.product_name','note','$batch_code','Spanish','maxperunit','language','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','filter','$alertquantity','primary_code_hide','<div>','Hindi','../public/language/languages.json','$suppliers_docs','concat','room_name','</body></html>','purchase\x20data\x20add\x20successfully','currency','717620ecOUpS','JO_number','prod_secondunit','all_purchases_barcode','1656942AsDEeb','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','post','<tbody\x20style=\x22text-align:\x20center;\x22>','Portuguese','ejs','$product','Email\x20sent\x20successfully','$product_details._id','/give_payment/:id','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','getDate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_Qty','Enclosed','\x20Order\x20Date\x20:\x20','image','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product.room_name','prod_level','purchase\x20data\x20update\x20successfully','max_product_unit','French','user_id','batch_code','prod_invoice','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','1497016AYBOgc','getFullYear','$name','prod_code','$room','prod_cat','get','/view','updateOne','back','master','</tbody>','$maxProdPerUnit','user','$product_details.floorlevel','due_amount','Arabic\x20(ae)','7iYLoLS','<h5>','json','$category','<html><head><title></title>','standard_unit','</span>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/view/:id','prod_qty','purchase_invoice','$secondary_code','/view/return_purchase/:id','currency_placement','map','product','4205331GyJqze','$date','findOne','return_product','params','<!DOCTYPE\x20html>','$brand','$due_amount','return_purchase_finished','level','Rack\x202','$_id','Finished\x20Goods','aggregate','Arabic','product_name','$product_details.bay','</td>','DRY\x20GOODS','/../public','slice','$unit','$product_code','staff','product_details','/view/add_purchases/:id','return_qty','</div>','$maxStocks','<h5\x20style=\x22text-align:\x20left;\x22>','/all_purchases_finished/view','Return\x20Goods','Portuguese\x20(BR)','product_stock','then','log','purchase_quantity','secondary_code','port','success','prod_primunit','gmail','redirect','$product.bin','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','save','logo','<span\x20style=\x22float:\x20right;\x22>','$note','INCF-','../models/all_models','error','invoice','German','forEach','$product.floorlevel','suppliers_docs','express','suppliers','$suppliers','primary_code','MaxStocks_data','$return_data','nodemailer','secondary_code_hide','product_cat','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','email','$product.quantity'];a0_0x5170=function(){return _0x519fb3;};return a0_0x5170();}const express=require(a0_0x3d00da(0x207)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x3d00da(0x200)),auth=require('../middleware/auth'),nodemailer=require(a0_0x3d00da(0x20d));var ejs=require(a0_0x3d00da(0x292));const path=require('path'),users=require(a0_0x3d00da(0x282));router[a0_0x3d00da(0x1b2)](a0_0x3d00da(0x1b3),auth,async(_0x58a834,_0xd94d21)=>{var _0x4ae9f9=a0_0x3d00da;try{const {username:_0x19e1ff,email:_0x1313e9,role:_0x3f8633}=_0x58a834[_0x4ae9f9(0x1b9)],_0x2a5c5e=_0x58a834['user'],_0x559f4c=await profile[_0x4ae9f9(0x1cf)]({'email':_0x2a5c5e['email']}),_0x57819d=await staff[_0x4ae9f9(0x1cf)]({'email':_0x2a5c5e[_0x4ae9f9(0x211)]});if(_0x2a5c5e[_0x4ae9f9(0x253)]==_0x4ae9f9(0x1e4)){const _0x1252b2=await staff[_0x4ae9f9(0x1cf)]({'email':_0x2a5c5e['email']});}const _0x4d7d60=await master_shop[_0x4ae9f9(0x266)]();let _0x1b8438;if(_0x2a5c5e['role']==_0x4ae9f9(0x1e4)){const _0x2f73b6=await staff['findOne']({'email':_0x2a5c5e['email']});_0x1b8438=await purchases_finished[_0x4ae9f9(0x1da)]([{'$match':{'warehouse_name':_0x2f73b6[_0x4ae9f9(0x235)]}},{'$lookup':{'from':'suppliers','localField':_0x4ae9f9(0x208),'foreignField':_0x4ae9f9(0x25e),'as':_0x4ae9f9(0x206)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x4ae9f9(0x1d8),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x4ae9f9(0x1ce)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x4ae9f9(0x1b0)},'product':{'$push':_0x4ae9f9(0x293)},'note':{'$first':_0x4ae9f9(0x1fe)},'paid_amount':{'$first':_0x4ae9f9(0x264)},'due_amount':{'$first':_0x4ae9f9(0x1d4)},'return_data':{'$first':_0x4ae9f9(0x20c)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x4ae9f9(0x283)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x4ae9f9(0x26f)},'isle':{'$addToSet':_0x4ae9f9(0x1f8)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x4ae9f9(0x205)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1b8438=await purchases_finished[_0x4ae9f9(0x1da)]([{'$unwind':_0x4ae9f9(0x293)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4ae9f9(0x22a)},'suppliers':{'$first':_0x4ae9f9(0x209)},'date':{'$first':_0x4ae9f9(0x1ce)},'warehouse_name':{'$first':_0x4ae9f9(0x226)},'room':{'$addToSet':_0x4ae9f9(0x2a0)},'product':{'$push':_0x4ae9f9(0x293)},'note':{'$first':_0x4ae9f9(0x1fe)},'paid_amount':{'$first':_0x4ae9f9(0x264)},'due_amount':{'$first':_0x4ae9f9(0x1d4)},'return_data':{'$first':_0x4ae9f9(0x20c)},'batch_code':{'$first':_0x4ae9f9(0x278)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x4ae9f9(0x283)},'total_product_quantity':{'$sum':_0x4ae9f9(0x212)},'level':{'$addToSet':_0x4ae9f9(0x26f)},'isle':{'$addToSet':_0x4ae9f9(0x1f8)},'type':{'$addToSet':_0x4ae9f9(0x22d)},'floorlevel':{'$addToSet':_0x4ae9f9(0x205)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x4d7d60[0x0][_0x4ae9f9(0x27b)]==_0x4ae9f9(0x23e))var _0x4bbfa3=users[_0x4ae9f9(0x23b)];else{if(_0x4d7d60[0x0]['language']==_0x4ae9f9(0x281))var _0x4bbfa3=users[_0x4ae9f9(0x281)];else{if(_0x4d7d60[0x0][_0x4ae9f9(0x27b)]==_0x4ae9f9(0x203))var _0x4bbfa3=users[_0x4ae9f9(0x203)];else{if(_0x4d7d60[0x0][_0x4ae9f9(0x27b)]==_0x4ae9f9(0x279))var _0x4bbfa3=users[_0x4ae9f9(0x279)];else{if(_0x4d7d60[0x0]['language']==_0x4ae9f9(0x2a4))var _0x4bbfa3=users[_0x4ae9f9(0x2a4)];else{if(_0x4d7d60[0x0][_0x4ae9f9(0x27b)]=='Portuguese\x20(BR)')var _0x4bbfa3=users['Portuguese'];else{if(_0x4d7d60[0x0]['language']==_0x4ae9f9(0x23a))var _0x4bbfa3=users['Chinese'];else{if(_0x4d7d60[0x0][_0x4ae9f9(0x27b)]==_0x4ae9f9(0x1bc))var _0x4bbfa3=users[_0x4ae9f9(0x1db)];}}}}}}}_0xd94d21[_0x4ae9f9(0x22f)]('all_purchases_finished',{'success':_0x58a834[_0x4ae9f9(0x26b)](_0x4ae9f9(0x1f4)),'errors':_0x58a834[_0x4ae9f9(0x26b)](_0x4ae9f9(0x25d)),'purchases':_0x1b8438,'role':_0x2a5c5e,'profile':_0x559f4c,'master_shop':_0x4d7d60,'language':_0x4bbfa3});}catch(_0x20a36e){console[_0x4ae9f9(0x1f0)](_0x4ae9f9(0x232),_0x20a36e),_0xd94d21['status'](0xc8)['json']({'message':_0x20a36e[_0x4ae9f9(0x259)]});}});function a0_0x387a(_0x53f682,_0x90837b){var _0x5170bc=a0_0x5170();return a0_0x387a=function(_0x387a8e,_0x4a07cb){_0x387a8e=_0x387a8e-0x1ac;var _0x20c231=_0x5170bc[_0x387a8e];return _0x20c231;},a0_0x387a(_0x53f682,_0x90837b);}function BayBinSelected(_0x2f8425,_0x36e3bb){var _0x355188=a0_0x3d00da,_0x5aa90c=[],_0x445782=[];if(_0x2f8425=='DRY\x20GOODS'){switch(_0x36e3bb){case _0x355188(0x25c):_0x5aa90c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x355188(0x1d7):_0x5aa90c=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x445782=['DG'];}else{if(_0x2f8425==_0x355188(0x21d)){switch(_0x36e3bb){case'Rack\x201':_0x5aa90c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x355188(0x1d7):_0x5aa90c=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x445782=['FG'];}}return{'levels':_0x5aa90c,'identify':_0x445782};}async function getRandom8DigitNumber(){var _0x5c7428=a0_0x3d00da;const _0x52f721=0x989680,_0x29cba5=0x5f5e0ff,_0x2fa781=Math[_0x5c7428(0x271)](Math[_0x5c7428(0x261)]()*(_0x29cba5-_0x52f721+0x1))+_0x52f721;var _0x45d5e4;const _0xa00211=await purchases_finished['findOne']({'invoice':_0x5c7428(0x1ff)+_0x2fa781});return _0xa00211&&_0xa00211[_0x5c7428(0x26d)]>0x0?_0x45d5e4=_0x5c7428(0x1ff)+_0x2fa781:_0x45d5e4=_0x5c7428(0x1ff)+_0x2fa781,_0x45d5e4;}router[a0_0x3d00da(0x1b2)](a0_0x3d00da(0x25b),auth,async(_0x42c02b,_0x1041f3)=>{var _0x53ca48=a0_0x3d00da;try{const {username:_0xd3eb45,email:_0x57dbaf,role:_0x254a28}=_0x42c02b[_0x53ca48(0x1b9)],_0x353867=_0x42c02b[_0x53ca48(0x1b9)],_0x2def17=await profile[_0x53ca48(0x1cf)]({'email':_0x353867[_0x53ca48(0x211)]}),_0x509566=await master_shop[_0x53ca48(0x266)](),_0x359616=await staff[_0x53ca48(0x1cf)]({'email':_0x353867[_0x53ca48(0x211)]}),_0x4e7089=await suppliers[_0x53ca48(0x266)]({});let _0x562f61;if(_0x353867[_0x53ca48(0x253)]==_0x53ca48(0x1e4)){const _0x188d9b=await staff[_0x53ca48(0x1cf)]({'email':_0x353867[_0x53ca48(0x211)]});_0x562f61=await warehouse[_0x53ca48(0x1da)]([{'$match':{'status':'Enabled','name':_0x188d9b[_0x53ca48(0x235)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x53ca48(0x1ae),'name':{'$first':_0x53ca48(0x1ae)}}}]);}else _0x562f61=await warehouse[_0x53ca48(0x1da)]([{'$match':{'status':_0x53ca48(0x22c),'warehouse_category':_0x53ca48(0x1d9),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x53ca48(0x1ae),'name':{'$first':_0x53ca48(0x1ae)}}}]);const _0x401ff5=await product['find']({}),_0x3e20c5=await warehouse[_0x53ca48(0x266)]({'status':'Enabled'}),_0x15116d=await purchases_finished[_0x53ca48(0x266)]({}),_0x5ac007=_0x15116d[_0x53ca48(0x26d)]+0x1,_0x3c0fc8=_0x53ca48(0x1ff)+_0x5ac007[_0x53ca48(0x233)]()[_0x53ca48(0x221)](0x5,'0');var _0x59db4a=[_0x53ca48(0x23c),_0x53ca48(0x29c)];if(_0x509566[0x0][_0x53ca48(0x27b)]==_0x53ca48(0x23e))var _0xa64051=users[_0x53ca48(0x23b)];else{if(_0x509566[0x0]['language']==_0x53ca48(0x281))var _0xa64051=users[_0x53ca48(0x281)];else{if(_0x509566[0x0][_0x53ca48(0x27b)]=='German')var _0xa64051=users[_0x53ca48(0x203)];else{if(_0x509566[0x0]['language']==_0x53ca48(0x279))var _0xa64051=users[_0x53ca48(0x279)];else{if(_0x509566[0x0][_0x53ca48(0x27b)]=='French')var _0xa64051=users[_0x53ca48(0x2a4)];else{if(_0x509566[0x0][_0x53ca48(0x27b)]==_0x53ca48(0x1ed))var _0xa64051=users[_0x53ca48(0x291)];else{if(_0x509566[0x0][_0x53ca48(0x27b)]==_0x53ca48(0x23a))var _0xa64051=users[_0x53ca48(0x23a)];else{if(_0x509566[0x0]['language']==_0x53ca48(0x1bc))var _0xa64051=users['Arabic'];}}}}}}}const _0x14f935=getRandom8DigitNumber();_0x14f935[_0x53ca48(0x1ef)](_0x5bc67f=>{var _0x164890=_0x53ca48;_0x1041f3[_0x164890(0x22f)](_0x164890(0x229),{'success':_0x42c02b['flash'](_0x164890(0x1f4)),'errors':_0x42c02b[_0x164890(0x26b)]('errors'),'role':_0x353867,'profile':_0x2def17,'suppliers':_0x4e7089,'warehouse':_0x562f61,'product':_0x401ff5,'invoice':_0x5bc67f,'master_shop':_0x509566,'language':_0xa64051,'find_data':_0x3e20c5,'rooms_data':_0x59db4a});})[_0x53ca48(0x268)](_0xfa7f95=>{var _0x213bae=_0x53ca48;_0x42c02b[_0x213bae(0x26b)](_0x213bae(0x25d),_0x213bae(0x249)),_0x1041f3[_0x213bae(0x1f7)]('/all_purchases_finished/view');});}catch(_0x2fff70){console[_0x53ca48(0x1f0)](_0x2fff70);}}),router[a0_0x3d00da(0x1b2)](a0_0x3d00da(0x1e6),auth,async(_0x17c8e1,_0x2a48fc)=>{var _0xf3ebd8=a0_0x3d00da;try{const _0x51196b=_0x17c8e1[_0xf3ebd8(0x1d1)]['id'];console[_0xf3ebd8(0x1f0)](_0x51196b);const _0x478bd8=await master_shop[_0xf3ebd8(0x266)]();console[_0xf3ebd8(0x1f0)](_0xf3ebd8(0x1b6),_0x478bd8);const _0x675072=await product['findOne']({'name':_0x51196b});console[_0xf3ebd8(0x1f0)](_0xf3ebd8(0x1cc),_0x675072),_0x2a48fc[_0xf3ebd8(0x258)](0xc8)['json']({'product_data':_0x675072,'master':_0x478bd8});}catch(_0x2c8b62){console[_0xf3ebd8(0x1f0)](_0xf3ebd8(0x24d),_0x2c8b62);}}),router[a0_0x3d00da(0x28f)](a0_0x3d00da(0x25b),auth,async(_0xc5f98c,_0x1af7cb)=>{var _0x104c94=a0_0x3d00da;try{const {invoice:_0x1b0f43,date:_0xcf32b,warehouse_name:_0x55f826,prod_name:_0x50b3a6,prod_code:_0x36f0ab,prod_qty:_0x5e0d89,prod_unit:_0x42d851,prod_secondunit:_0x3d7ff5,prod_level:_0x123f81,prod_isle:_0x54b1d4,prod_pallet:_0xe1f184,note:_0x1722b3,expiry_date:_0x2e2473,batch_code:_0x1c544c,payable:_0x524acb,due_amount:_0x22926b,Room_name:_0x263c37,primary_code:_0x191ec7,secondary_code:_0x247227,MaxStocks_data:_0x302655,PO_number:_0x257b91,SCRN:_0x326689,JO_number:_0x4286e1}=_0xc5f98c[_0x104c94(0x231)];if(typeof _0x50b3a6==_0x104c94(0x238))var _0x4c43a0=[_0xc5f98c[_0x104c94(0x231)][_0x104c94(0x245)]],_0x10e530=[_0xc5f98c[_0x104c94(0x231)]['prod_code']],_0x52fc89=[_0xc5f98c['body']['prod_Qty']],_0x4a295e=[_0xc5f98c[_0x104c94(0x231)][_0x104c94(0x1f5)]],_0x388a46=[_0xc5f98c[_0x104c94(0x231)]['prod_secondunit']],_0x4ec687=[_0xc5f98c[_0x104c94(0x231)]['prod_level']],_0x2dd521=[_0xc5f98c[_0x104c94(0x231)][_0x104c94(0x20a)]],_0x3bfd27=[_0xc5f98c['body'][_0x104c94(0x1f2)]],_0x3fb43a=[_0xc5f98c[_0x104c94(0x231)][_0x104c94(0x20b)]],_0x140631=[_0xc5f98c[_0x104c94(0x231)][_0x104c94(0x2a6)]],_0x867d9e=[_0xc5f98c[_0x104c94(0x231)]['expiry_date']],_0x54fddd=[_0xc5f98c['body'][_0x104c94(0x219)]],_0x46ad9b=[_0xc5f98c[_0x104c94(0x231)][_0x104c94(0x2a3)]],_0x1a1c3a=[_0xc5f98c[_0x104c94(0x231)][_0x104c94(0x1b1)]],_0x1e7225=[_0xc5f98c[_0x104c94(0x231)][_0x104c94(0x220)]],_0x6c95e5=[_0xc5f98c[_0x104c94(0x231)]['prod_invoice']];else var _0x4c43a0=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x245)]],_0x10e530=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x1af)]],_0x52fc89=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x29b)]],_0x4a295e=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x1f5)]],_0x388a46=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x28b)]],_0x4ec687=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x2a1)]],_0x2dd521=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x20a)]],_0x3bfd27=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x1f2)]],_0x3fb43a=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x20b)]],_0x140631=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x2a6)]],_0x867d9e=[..._0xc5f98c['body'][_0x104c94(0x25f)]],_0x54fddd=[..._0xc5f98c['body']['product_date']],_0x46ad9b=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x2a3)]],_0x1a1c3a=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x1b1)]],_0x1e7225=[..._0xc5f98c['body'][_0x104c94(0x220)]],_0x6c95e5=[..._0xc5f98c[_0x104c94(0x231)][_0x104c94(0x2a7)]];const _0x10bb05=_0x4c43a0[_0x104c94(0x1cb)](_0x415877=>{return _0x415877={'product_name':_0x415877};});_0x10e530[_0x104c94(0x204)]((_0x10512f,_0x35804e)=>{var _0x2c7cf0=_0x104c94;_0x10bb05[_0x35804e][_0x2c7cf0(0x255)]=_0x10512f;}),_0x52fc89[_0x104c94(0x204)]((_0x5e3d1e,_0x2628eb)=>{var _0x3a0a9d=_0x104c94;_0x10bb05[_0x2628eb]['quantity']=Math[_0x3a0a9d(0x25a)](_0x5e3d1e);}),_0x4a295e[_0x104c94(0x204)]((_0x5e513b,_0x1c2c98)=>{var _0x40f90b=_0x104c94;_0x10bb05[_0x1c2c98][_0x40f90b(0x1c2)]=_0x5e513b;}),_0x388a46['forEach']((_0x45d23b,_0xff4299)=>{_0x10bb05[_0xff4299]['secondary_unit']=_0x45d23b;}),_0x4ec687[_0x104c94(0x204)]((_0x474363,_0x5da6d5)=>{var _0xd9ccc4=_0x104c94;_0x10bb05[_0x5da6d5][_0xd9ccc4(0x21a)]=_0x474363;}),_0x2dd521[_0x104c94(0x204)]((_0x46235a,_0x468a62)=>{_0x10bb05[_0x468a62]['primary_code']=_0x46235a;}),_0x3bfd27['forEach']((_0x250818,_0x24309c)=>{var _0x4fbbc5=_0x104c94;_0x10bb05[_0x24309c][_0x4fbbc5(0x1f2)]=_0x250818;}),_0x3fb43a[_0x104c94(0x204)]((_0x41cb11,_0x45b1de)=>{var _0x1a9fcb=_0x104c94;_0x10bb05[_0x45b1de][_0x1a9fcb(0x213)]=_0x41cb11;}),_0x140631[_0x104c94(0x204)]((_0x42ef59,_0x5e97ff)=>{var _0x13e2e3=_0x104c94;_0x10bb05[_0x5e97ff][_0x13e2e3(0x2a6)]=_0x42ef59;}),_0x867d9e[_0x104c94(0x204)]((_0x2fe809,_0x4ff6be)=>{var _0x5df845=_0x104c94;_0x10bb05[_0x4ff6be][_0x5df845(0x25f)]=_0x2fe809;}),_0x54fddd['forEach']((_0x5ba8fb,_0x224dc5)=>{var _0xe0e7e7=_0x104c94;_0x10bb05[_0x224dc5][_0xe0e7e7(0x262)]=_0x5ba8fb;}),_0x46ad9b[_0x104c94(0x204)]((_0x528d4e,_0x22d42e)=>{_0x10bb05[_0x22d42e]['maxperunit']=_0x528d4e;}),_0x1a1c3a['forEach']((_0x3e7f87,_0x22a4ff)=>{var _0xa4b7a1=_0x104c94;_0x10bb05[_0x22a4ff][_0xa4b7a1(0x20f)]=_0x3e7f87;}),_0x1e7225[_0x104c94(0x204)]((_0x4b9789,_0x82cbd3)=>{_0x10bb05[_0x82cbd3]['room_name']=_0x4b9789;}),_0x6c95e5[_0x104c94(0x204)]((_0x118037,_0x52dd57)=>{var _0x480217=_0x104c94;_0x10bb05[_0x52dd57][_0x480217(0x202)]=_0x118037;});const _0x400acb=_0x10bb05[_0x104c94(0x27d)](_0x499495=>_0x499495[_0x104c94(0x215)]!=='0'&&_0x499495[_0x104c94(0x215)]!==''),_0x5aec70=new purchases_finished({'invoice':_0x1b0f43,'suppliers':_0xc5f98c['body'][_0x104c94(0x208)],'date':_0xcf32b,'warehouse_name':_0x55f826,'product':_0x400acb,'note':_0x1722b3,'due_amount':_0x22926b,'room':_0x263c37,'POnumber':_0x257b91,'SCRN':_0x326689,'JO_number':_0x4286e1}),_0x5d9556=await _0x5aec70[_0x104c94(0x1fb)](),_0x4395d7=await purchases_finished[_0x104c94(0x1cf)]({'invoice':_0x1b0f43}),_0x478589=_0x4395d7[_0x104c94(0x1cc)][_0x104c94(0x1cb)](async _0xd05936=>{var _0x29761c=_0x104c94;try{var _0xefaa30=await warehouse[_0x29761c(0x1cf)]({'name':_0x55f826,'room':_0xd05936[_0x29761c(0x285)]}),_0x291f1e=0x0;const _0xf8e7c6=_0xefaa30[_0x29761c(0x1e5)][_0x29761c(0x1cb)](_0x10ae08=>{var _0x191b55=_0x29761c;console[_0x191b55(0x1f0)](_0x10ae08[_0x191b55(0x1dc)]+'=='+_0xd05936[_0x191b55(0x1dc)]+'&&'+_0x10ae08[_0x191b55(0x21a)]+'=='+_0xd05936[_0x191b55(0x21a)]+'&&'+_0x10ae08[_0x191b55(0x25f)]+'=='+_0xd05936[_0x191b55(0x25f)]+'&&'+_0x10ae08[_0x191b55(0x262)]+'=='+_0xd05936['production_date']+'&&'+_0x10ae08[_0x191b55(0x2a6)]+'=='+_0xd05936[_0x191b55(0x2a6)]+'&&'+_0x10ae08[_0x191b55(0x202)]+'=='+_0x4395d7[_0x191b55(0x202)]),_0x10ae08[_0x191b55(0x1dc)]==_0xd05936['product_name']&&_0x10ae08[_0x191b55(0x21a)]==_0xd05936[_0x191b55(0x21a)]&&_0x10ae08[_0x191b55(0x25f)]==_0xd05936[_0x191b55(0x25f)]&&_0x10ae08[_0x191b55(0x262)]==_0xd05936['production_date']&&_0x10ae08[_0x191b55(0x2a6)]==_0xd05936[_0x191b55(0x2a6)]&&_0x10ae08['invoice']==_0x4395d7[_0x191b55(0x202)]&&(_0x10ae08[_0x191b55(0x1ee)]=Math[_0x191b55(0x25a)](_0x10ae08[_0x191b55(0x1ee)])+Math['abs'](_0xd05936['quantity']),_0x291f1e++);});return _0x291f1e==0x0&&(_0xefaa30[_0x29761c(0x1e5)]=_0xefaa30[_0x29761c(0x1e5)][_0x29761c(0x284)]({'product_name':_0xd05936[_0x29761c(0x1dc)],'product_stock':Math[_0x29761c(0x25a)](_0xd05936[_0x29761c(0x215)]),'primary_code':_0xd05936['primary_code'],'secondary_code':_0xd05936[_0x29761c(0x1f2)],'product_code':_0xd05936['product_code'],'bay':_0xd05936[_0x29761c(0x21a)],'maxProducts':_0xd05936[_0x29761c(0x213)],'unit':_0xd05936[_0x29761c(0x1c2)],'secondary_unit':_0xd05936[_0x29761c(0x26a)],'expiry_date':_0xd05936[_0x29761c(0x25f)],'production_date':_0xd05936['production_date'],'maxProducts':_0xd05936['maxStocks'],'maxPerUnit':_0xd05936[_0x29761c(0x27a)],'batch_code':_0xd05936[_0x29761c(0x2a6)],'product_cat':_0xd05936['product_cat'],'invoice':_0xd05936[_0x29761c(0x202)],'id_incoming':_0xd05936[_0x29761c(0x263)]})),_0xefaa30;}catch(_0x4acd85){return console[_0x29761c(0x201)]('Error\x20occurred\x20while\x20processing\x20product:',_0x4acd85),null;}});Promise['all'](_0x478589)[_0x104c94(0x1ef)](async _0x435331=>{var _0x350d8d=_0x104c94;try{for(const _0x1ab242 of _0x435331){await warehouse[_0x350d8d(0x1b4)]({'_id':_0x1ab242[_0x350d8d(0x263)]},{'$addToSet':{'product_details':{'$each':_0x1ab242[_0x350d8d(0x1e5)]}}});}const _0x55cfab=await master_shop[_0x350d8d(0x266)](),_0x37d79b=await email_settings[_0x350d8d(0x1cf)](),_0x33c251=await supervisor_settings['find']();var _0x52bd52=_0x4395d7['product'],_0x49ed88='',_0x167d8b;for(_0x167d8b in _0x52bd52){var _0x5e2617='FG';_0x4395d7[_0x350d8d(0x270)]==_0x350d8d(0x1df)&&(_0x5e2617='DG'),_0x49ed88+=_0x350d8d(0x24f)+_0x350d8d(0x2a8)+_0x52bd52[_0x167d8b][_0x350d8d(0x1dc)]+'</td>'+_0x350d8d(0x2a8)+_0x52bd52[_0x167d8b]['product_code']+_0x350d8d(0x1de)+_0x350d8d(0x2a8)+_0x52bd52[_0x167d8b][_0x350d8d(0x215)]+_0x350d8d(0x1de)+_0x350d8d(0x2a8)+_0x52bd52[_0x167d8b]['standard_unit']+_0x350d8d(0x1de)+_0x350d8d(0x2a8)+_0x52bd52[_0x167d8b][_0x350d8d(0x26a)]+'</td>'+_0x350d8d(0x2a8)+_0x4395d7[_0x350d8d(0x270)]+'</td>'+_0x350d8d(0x2a8)+_0x52bd52[_0x167d8b][_0x350d8d(0x285)]+_0x350d8d(0x1de)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5e2617+_0x52bd52[_0x167d8b]['bay']+'</td>',_0x350d8d(0x234);}let _0x46235b=nodemailer[_0x350d8d(0x216)]({'host':_0x37d79b[_0x350d8d(0x257)],'port':Number(_0x37d79b[_0x350d8d(0x1f3)]),'secure':![],'auth':{'user':_0x37d79b['email'],'pass':_0x37d79b[_0x350d8d(0x26e)]}}),_0x459160={'from':_0x37d79b[_0x350d8d(0x211)],'to':_0x33c251[0x0]['FGSEmail'],'subject':_0x350d8d(0x240),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x350d8d(0x23d)+_0x55cfab[0x0][_0x350d8d(0x29e)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+'<div>'+_0x350d8d(0x29f)+_0x350d8d(0x280)+_0x350d8d(0x210)+_0x350d8d(0x1e8)+_0x350d8d(0x280)+_0x350d8d(0x21b)+_0x55cfab[0x0][_0x350d8d(0x274)]+'\x20</h2>'+'</div>'+_0x350d8d(0x1e8)+_0x350d8d(0x239)+'<div>'+_0x350d8d(0x1ea)+_0x350d8d(0x223)+_0x4395d7[_0x350d8d(0x202)]+'\x20'+_0x350d8d(0x1fd)+_0x350d8d(0x29d)+_0x4395d7['date']+'\x20'+_0x350d8d(0x1c3)+_0x350d8d(0x269)+_0x350d8d(0x1e8)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x350d8d(0x256)+_0x350d8d(0x24f)+_0x350d8d(0x225)+_0x350d8d(0x1c4)+_0x350d8d(0x251)+_0x350d8d(0x1fa)+_0x350d8d(0x24a)+_0x350d8d(0x298)+_0x350d8d(0x243)+_0x350d8d(0x28e)+_0x350d8d(0x234)+_0x350d8d(0x242)+_0x350d8d(0x290)+'\x20'+_0x49ed88+'\x20'+_0x350d8d(0x1b7)+'</table>'+_0x350d8d(0x280)+_0x350d8d(0x222)+_0x350d8d(0x1be)+_0x55cfab[0x0][_0x350d8d(0x274)]+_0x350d8d(0x269)+'</div>'+_0x350d8d(0x1e8)+_0x350d8d(0x286)};_0x46235b[_0x350d8d(0x24c)](_0x459160,function(_0x59d2c5,_0x337d02){var _0x50bb4b=_0x350d8d;_0x59d2c5?(console['log'](_0x59d2c5),console[_0x50bb4b(0x1f0)]('Error\x20Occurs')):console['log'](_0x50bb4b(0x294));});}catch(_0x128454){console[_0x350d8d(0x201)](_0x128454),_0x1af7cb[_0x350d8d(0x258)](0x1f4)[_0x350d8d(0x1bf)]({'error':_0x350d8d(0x227),'message':_0x128454[_0x350d8d(0x259)]});}})[_0x104c94(0x268)](_0x42e45d=>{var _0x5edefe=_0x104c94;console[_0x5edefe(0x201)](_0x42e45d);}),_0xc5f98c['flash'](_0x104c94(0x1f4),_0x104c94(0x287)),_0x1af7cb['redirect'](_0x104c94(0x1eb));}catch(_0x437748){console['log'](_0x437748);}}),router[a0_0x3d00da(0x1b2)]('/preview/:id',auth,async(_0x2256fa,_0x4e0fc0)=>{var _0xf11fbb=a0_0x3d00da;try{const {username:_0x57f503,email:_0x41d0cd,role:_0x1ad144}=_0x2256fa[_0xf11fbb(0x1b9)],_0x1e9b8b=_0x2256fa[_0xf11fbb(0x1b9)],_0x4298a6=await profile[_0xf11fbb(0x1cf)]({'email':_0x1e9b8b[_0xf11fbb(0x211)]}),_0x5bdfa1=await master_shop[_0xf11fbb(0x266)](),_0x4a551=_0x2256fa[_0xf11fbb(0x1d1)]['id'],_0x5f47a9=await purchases_finished['findById'](_0x4a551),_0x3b29c7=await suppliers[_0xf11fbb(0x266)]({});let _0x373f62;if(_0x1e9b8b['role']=='staff'){const _0x1e9ed4=await staff[_0xf11fbb(0x1cf)]({'email':_0x1e9b8b[_0xf11fbb(0x211)]});_0x373f62=await warehouse[_0xf11fbb(0x266)]({'status':'Enabled','name':_0x1e9ed4[_0xf11fbb(0x235)],'warehouse_category':'Finished\x20Goods'});}else _0x373f62=await warehouse['aggregate']([{'$match':{'status':_0xf11fbb(0x22c),'warehouse_category':_0xf11fbb(0x1d9)}},{'$group':{'_id':_0xf11fbb(0x1ae),'name':{'$first':'$name'}}}]);const _0x51a89e=await product[_0xf11fbb(0x266)]({}),_0x3e52fc=BayBinSelected(_0x5f47a9[_0xf11fbb(0x270)],_0x5f47a9[_0xf11fbb(0x236)]);let _0x552927=new Date(_0x5f47a9[_0xf11fbb(0x25f)]),_0xf5e8de=('0'+_0x552927[_0xf11fbb(0x299)]())[_0xf11fbb(0x1e1)](-0x2),_0xd27f4=('0'+(_0x552927[_0xf11fbb(0x273)]()+0x1))[_0xf11fbb(0x1e1)](-0x2),_0x5b15b3=_0x552927[_0xf11fbb(0x1ad)](),_0x553a04=_0x5b15b3+'-'+_0xd27f4+'-'+_0xf5e8de;if(_0x5bdfa1[0x0][_0xf11fbb(0x27b)]==_0xf11fbb(0x23e)){var _0x5dbc68=users[_0xf11fbb(0x23b)];console[_0xf11fbb(0x1f0)](_0x5dbc68);}else{if(_0x5bdfa1[0x0][_0xf11fbb(0x27b)]=='Hindi')var _0x5dbc68=users[_0xf11fbb(0x281)];else{if(_0x5bdfa1[0x0][_0xf11fbb(0x27b)]==_0xf11fbb(0x203))var _0x5dbc68=users[_0xf11fbb(0x203)];else{if(_0x5bdfa1[0x0][_0xf11fbb(0x27b)]==_0xf11fbb(0x279))var _0x5dbc68=users['Spanish'];else{if(_0x5bdfa1[0x0]['language']==_0xf11fbb(0x2a4))var _0x5dbc68=users[_0xf11fbb(0x2a4)];else{if(_0x5bdfa1[0x0][_0xf11fbb(0x27b)]==_0xf11fbb(0x1ed))var _0x5dbc68=users[_0xf11fbb(0x291)];else{if(_0x5bdfa1[0x0][_0xf11fbb(0x27b)]==_0xf11fbb(0x23a))var _0x5dbc68=users[_0xf11fbb(0x23a)];else{if(_0x5bdfa1[0x0]['language']==_0xf11fbb(0x1bc))var _0x5dbc68=users[_0xf11fbb(0x1db)];}}}}}}}_0x4e0fc0[_0xf11fbb(0x22f)]('edit_purchases_finished_view',{'success':_0x2256fa[_0xf11fbb(0x26b)](_0xf11fbb(0x1f4)),'errors':_0x2256fa[_0xf11fbb(0x26b)](_0xf11fbb(0x25d)),'role':_0x1e9b8b,'profile':_0x4298a6,'purchases':_0x5f47a9,'suppliers':_0x3b29c7,'warehouse':_0x373f62,'product':_0x51a89e,'master_shop':_0x5bdfa1,'language':_0x5dbc68,'ed_fullDate':_0x553a04,'dataSelected':_0x3e52fc});}catch(_0x3f4e5d){console[_0xf11fbb(0x1f0)](_0x3f4e5d);}}),router[a0_0x3d00da(0x1b2)](a0_0x3d00da(0x1c5),auth,async(_0x5a4716,_0x516020)=>{var _0x34373d=a0_0x3d00da;try{const {username:_0x5afb0e,email:_0x348c47,role:_0x129600}=_0x5a4716[_0x34373d(0x1b9)],_0x362a29=_0x5a4716[_0x34373d(0x1b9)],_0x5ac6b6=await profile['findOne']({'email':_0x362a29[_0x34373d(0x211)]}),_0x507b76=await master_shop['find'](),_0x58eddc=_0x5a4716[_0x34373d(0x1d1)]['id'],_0x257202=await purchases_finished['findById'](_0x58eddc),_0x50bd61=await suppliers[_0x34373d(0x266)]({});let _0x3b231f;if(_0x362a29[_0x34373d(0x253)]==_0x34373d(0x1e4)){const _0x5ce625=await staff[_0x34373d(0x1cf)]({'email':_0x362a29[_0x34373d(0x211)]});_0x3b231f=await warehouse[_0x34373d(0x266)]({'status':'Enabled','name':_0x5ce625[_0x34373d(0x235)],'warehouse_category':_0x34373d(0x1d9)});}else _0x3b231f=await warehouse[_0x34373d(0x1da)]([{'$match':{'status':'Enabled','warehouse_category':_0x34373d(0x1d9)}},{'$group':{'_id':_0x34373d(0x1ae),'name':{'$first':_0x34373d(0x1ae)}}}]);const _0x1b2127=await product[_0x34373d(0x266)]({}),_0xf2ff7d=BayBinSelected(_0x257202[_0x34373d(0x270)],_0x257202[_0x34373d(0x236)]);let _0x4652a1=new Date(_0x257202[_0x34373d(0x25f)]),_0x50304d=('0'+_0x4652a1[_0x34373d(0x299)]())[_0x34373d(0x1e1)](-0x2),_0x34a387=('0'+(_0x4652a1[_0x34373d(0x273)]()+0x1))[_0x34373d(0x1e1)](-0x2),_0x4a8173=_0x4652a1[_0x34373d(0x1ad)](),_0x8051c=_0x4a8173+'-'+_0x34a387+'-'+_0x50304d;if(_0x507b76[0x0]['language']==_0x34373d(0x23e)){var _0x747d84=users[_0x34373d(0x23b)];console['log'](_0x747d84);}else{if(_0x507b76[0x0][_0x34373d(0x27b)]=='Hindi')var _0x747d84=users[_0x34373d(0x281)];else{if(_0x507b76[0x0][_0x34373d(0x27b)]==_0x34373d(0x203))var _0x747d84=users[_0x34373d(0x203)];else{if(_0x507b76[0x0][_0x34373d(0x27b)]=='Spanish')var _0x747d84=users[_0x34373d(0x279)];else{if(_0x507b76[0x0]['language']==_0x34373d(0x2a4))var _0x747d84=users['French'];else{if(_0x507b76[0x0][_0x34373d(0x27b)]==_0x34373d(0x1ed))var _0x747d84=users['Portuguese'];else{if(_0x507b76[0x0][_0x34373d(0x27b)]==_0x34373d(0x23a))var _0x747d84=users['Chinese'];else{if(_0x507b76[0x0][_0x34373d(0x27b)]==_0x34373d(0x1bc))var _0x747d84=users[_0x34373d(0x1db)];}}}}}}}_0x516020[_0x34373d(0x22f)](_0x34373d(0x247),{'success':_0x5a4716['flash']('success'),'errors':_0x5a4716[_0x34373d(0x26b)](_0x34373d(0x25d)),'role':_0x362a29,'profile':_0x5ac6b6,'purchases':_0x257202,'suppliers':_0x50bd61,'warehouse':_0x3b231f,'product':_0x1b2127,'master_shop':_0x507b76,'language':_0x747d84,'ed_fullDate':_0x8051c,'dataSelected':_0xf2ff7d});}catch(_0x2e927b){console[_0x34373d(0x1f0)](_0x2e927b);}}),router[a0_0x3d00da(0x28f)](a0_0x3d00da(0x1c5),auth,async(_0x1a5f00,_0x333e98)=>{var _0x5d88b3=a0_0x3d00da;try{const _0x1b7fc9=_0x1a5f00[_0x5d88b3(0x1d1)]['id'],_0x3612cf=await purchases_finished[_0x5d88b3(0x1cf)]({'_id':_0x1a5f00[_0x5d88b3(0x1d1)]['id']}),_0x137a86=await warehouse['findOne']({'name':_0x3612cf[_0x5d88b3(0x270)],'room':_0x3612cf['room']});_0x3612cf[_0x5d88b3(0x1cc)][_0x5d88b3(0x204)](_0xfa3962=>{var _0x431d78=_0x5d88b3;const _0x5e140e=_0x137a86[_0x431d78(0x1e5)][_0x431d78(0x1cb)](_0x554f2f=>{var _0x381f9d=_0x431d78;_0x554f2f[_0x381f9d(0x1dc)]==_0xfa3962['product_name']&&_0x554f2f[_0x381f9d(0x21a)]==_0xfa3962[_0x381f9d(0x21a)]&&(_0x554f2f[_0x381f9d(0x1ee)]=parseInt(_0x554f2f[_0x381f9d(0x1ee)])-parseInt(_0xfa3962[_0x381f9d(0x215)]));});}),await _0x137a86[_0x5d88b3(0x1fb)]();const {invoice:_0x115cc0,suppliers:_0x51f871,date:_0x356b2c,warehouse_name:_0x3ebf03,prod_name:_0x2fc782,prod_code:_0x107d7b,prod_qty:_0x3c5275,prod_unit:_0x1d3cd4,prod_secondunit:_0x585ecc,prod_level:_0xf050e7,prod_isle:_0x365c8c,prod_pallet:_0x50280d,note:_0x47e2cb,expiry_date:_0x276187,batch_code:_0x14271a,paid_amount:_0x37fac5,due_amount:_0x48aeb6,Room_name:_0x416fe2,primary_code:_0x31d6c8,secondary_code:_0x1f085f,PO_number:_0x3df213,JO_number:_0x4eb393}=_0x1a5f00[_0x5d88b3(0x231)];if(typeof _0x2fc782==_0x5d88b3(0x238))var _0x4d8df9=[_0x1a5f00[_0x5d88b3(0x231)][_0x5d88b3(0x245)]],_0x4c3415=[_0x1a5f00['body'][_0x5d88b3(0x1af)]],_0x5a7bf4=[_0x1a5f00[_0x5d88b3(0x231)][_0x5d88b3(0x1c6)]],_0x3d6c2d=[_0x1a5f00['body'][_0x5d88b3(0x241)]],_0x25a15f=[_0x1a5f00[_0x5d88b3(0x231)][_0x5d88b3(0x28b)]],_0x27af50=[_0x1a5f00['body'][_0x5d88b3(0x2a1)]],_0x4a9203=[_0x1a5f00[_0x5d88b3(0x231)][_0x5d88b3(0x20a)]],_0x5356da=[_0x1a5f00[_0x5d88b3(0x231)]['secondary_code']],_0x237f51=[_0x1a5f00[_0x5d88b3(0x231)][_0x5d88b3(0x20b)]],_0x2c8a1c=[_0x1a5f00['body'][_0x5d88b3(0x2a6)]],_0x51787e=[_0x1a5f00['body'][_0x5d88b3(0x25f)]];else var _0x4d8df9=[..._0x1a5f00[_0x5d88b3(0x231)][_0x5d88b3(0x245)]],_0x4c3415=[..._0x1a5f00['body'][_0x5d88b3(0x1af)]],_0x5a7bf4=[..._0x1a5f00['body'][_0x5d88b3(0x1c6)]],_0x3d6c2d=[..._0x1a5f00[_0x5d88b3(0x231)][_0x5d88b3(0x241)]],_0x25a15f=[..._0x1a5f00[_0x5d88b3(0x231)]['prod_secondunit']],_0x27af50=[..._0x1a5f00['body']['prod_level']],_0x4a9203=[..._0x1a5f00['body'][_0x5d88b3(0x20a)]],_0x5356da=[..._0x1a5f00[_0x5d88b3(0x231)][_0x5d88b3(0x1f2)]],_0x237f51=[..._0x1a5f00['body'][_0x5d88b3(0x20b)]],_0x2c8a1c=[..._0x1a5f00[_0x5d88b3(0x231)]['batch_code']],_0x51787e=[..._0x1a5f00[_0x5d88b3(0x231)][_0x5d88b3(0x25f)]];const _0x121839=_0x4d8df9[_0x5d88b3(0x1cb)](_0x4003d0=>{return _0x4003d0={'product_name':_0x4003d0};});_0x4c3415[_0x5d88b3(0x204)]((_0x56f786,_0x1677d5)=>{_0x121839[_0x1677d5]['product_code']=_0x56f786;}),_0x5a7bf4['forEach']((_0x3a961b,_0x2cb35d)=>{var _0x1beedc=_0x5d88b3;_0x121839[_0x2cb35d][_0x1beedc(0x215)]=_0x3a961b;}),_0x3d6c2d['forEach']((_0x45f935,_0x12d8c7)=>{var _0x549fcc=_0x5d88b3;_0x121839[_0x12d8c7][_0x549fcc(0x1c2)]=_0x45f935;}),_0x25a15f['forEach']((_0x9d4cfe,_0x129b6f)=>{var _0x2f7bd6=_0x5d88b3;_0x121839[_0x129b6f][_0x2f7bd6(0x26a)]=_0x9d4cfe;}),_0x27af50[_0x5d88b3(0x204)]((_0xbb216f,_0x2a877d)=>{_0x121839[_0x2a877d]['bay']=_0xbb216f;}),_0x4a9203['forEach']((_0x2c353d,_0x5c523d)=>{var _0x4982dd=_0x5d88b3;_0x121839[_0x5c523d][_0x4982dd(0x20a)]=_0x2c353d;}),_0x5356da[_0x5d88b3(0x204)]((_0xad6217,_0x3a8fa4)=>{var _0x25c7ea=_0x5d88b3;_0x121839[_0x3a8fa4][_0x25c7ea(0x1f2)]=_0xad6217;}),_0x237f51[_0x5d88b3(0x204)]((_0x146b81,_0x472f2d)=>{_0x121839[_0x472f2d]['maxStocks']=_0x146b81;}),_0x2c8a1c[_0x5d88b3(0x204)]((_0x26fd04,_0x4b7b11)=>{var _0x5041ce=_0x5d88b3;_0x121839[_0x4b7b11][_0x5041ce(0x2a6)]=_0x26fd04;}),_0x51787e[_0x5d88b3(0x204)]((_0x42d7b8,_0x33bdee)=>{var _0x4138e7=_0x5d88b3;_0x121839[_0x33bdee][_0x4138e7(0x25f)]=_0x42d7b8;});const _0x525bc3=_0x121839['filter'](_0x4172e5=>_0x4172e5[_0x5d88b3(0x215)]!=='0'&&_0x4172e5[_0x5d88b3(0x215)]!=='');_0x3612cf[_0x5d88b3(0x202)]=_0x115cc0,_0x3612cf['suppliers']=_0x51f871,_0x3612cf[_0x5d88b3(0x22e)]=_0x356b2c,_0x3612cf['warehouse_name']=_0x3ebf03,_0x3612cf[_0x5d88b3(0x1cc)]=_0x525bc3,_0x3612cf[_0x5d88b3(0x277)]=_0x47e2cb,_0x3612cf[_0x5d88b3(0x21e)]=_0x37fac5,_0x3612cf[_0x5d88b3(0x1bb)]=_0x48aeb6,_0x3612cf[_0x5d88b3(0x236)]=_0x416fe2,_0x3612cf['POnumber']=_0x3df213,_0x3612cf[_0x5d88b3(0x28a)]=_0x4eb393;const _0x4f4790=await _0x3612cf['save'](),_0x31c649=await warehouse['findOne']({'name':_0x1a5f00[_0x5d88b3(0x231)][_0x5d88b3(0x270)],'room':_0x1a5f00[_0x5d88b3(0x231)]['Room_name']});_0x3612cf[_0x5d88b3(0x1cc)][_0x5d88b3(0x204)](_0x2f35df=>{var _0x23ee9c=_0x5d88b3,_0x52eb84=0x0;const _0x22ad6d=_0x31c649[_0x23ee9c(0x1e5)][_0x23ee9c(0x1cb)](_0x3b76cc=>{var _0x28747b=_0x23ee9c;_0x3b76cc[_0x28747b(0x1dc)]==_0x2f35df[_0x28747b(0x1dc)]&&_0x3b76cc['bay']==_0x2f35df[_0x28747b(0x21a)]&&(_0x3b76cc[_0x28747b(0x1ee)]=parseInt(_0x3b76cc[_0x28747b(0x1ee)])+parseInt(_0x2f35df['quantity']),_0x52eb84++);});_0x52eb84=='0'&&(_0x31c649[_0x23ee9c(0x1e5)]=_0x31c649[_0x23ee9c(0x1e5)][_0x23ee9c(0x284)]({'product_name':_0x2f35df[_0x23ee9c(0x1dc)],'product_stock':_0x2f35df[_0x23ee9c(0x215)],'primary_code':_0x2f35df[_0x23ee9c(0x20a)],'secondary_code':_0x2f35df[_0x23ee9c(0x1f2)],'product_code':_0x2f35df[_0x23ee9c(0x255)],'bay':_0x2f35df[_0x23ee9c(0x21a)],'maxProducts':_0x2f35df['maxStocks'],'unit':_0x2f35df[_0x23ee9c(0x1c2)],'secondary_unit':_0x2f35df[_0x23ee9c(0x26a)],'expiry_date':_0x2f35df['expiry_date']}));}),await _0x31c649[_0x5d88b3(0x1fb)]();const _0xab3786=await s_payment_data['findOne']({'invoice':_0x1a5f00['body'][_0x5d88b3(0x202)]});if(_0xab3786===null){}else console[_0x5d88b3(0x1f0)](_0x5d88b3(0x208),_0xab3786,_0x1a5f00['body'][_0x5d88b3(0x202)]),_0xab3786[_0x5d88b3(0x208)]=_0x1a5f00['body'][_0x5d88b3(0x208)],await _0xab3786[_0x5d88b3(0x1fb)]();_0x1a5f00[_0x5d88b3(0x26b)](_0x5d88b3(0x1f4),_0x5d88b3(0x2a2)),_0x333e98[_0x5d88b3(0x1f7)]('/all_purchases_finished/view');}catch(_0x58ad07){console['log'](_0x58ad07);}}),router[a0_0x3d00da(0x28f)](a0_0x3d00da(0x296),auth,async(_0x21bd46,_0x38cb61)=>{var _0x2104eb=a0_0x3d00da;try{const _0x424ca9=_0x21bd46[_0x2104eb(0x1d1)]['id'],{invoice:_0x3479a1,suppliers:_0x5a917b,payable:_0x4e1de0,due_amount:_0x582ff9}=_0x21bd46[_0x2104eb(0x231)],_0x1343df=await purchases[_0x2104eb(0x22b)](_0x424ca9);var _0x4e9c7a=_0x4e1de0-_0x582ff9;_0x1343df['paid_amount']=parseFloat(_0x1343df[_0x2104eb(0x21e)])+parseFloat(_0x582ff9),_0x1343df[_0x2104eb(0x1bb)]=_0x4e9c7a;const _0x41ecc7=await _0x1343df[_0x2104eb(0x1fb)]();console[_0x2104eb(0x1f0)](_0x41ecc7);const _0x309e02=await s_payment_data[_0x2104eb(0x1cf)]({'invoice':_0x3479a1});_0x309e02['amount']=_0x4e9c7a,await _0x309e02[_0x2104eb(0x1fb)]();let _0x52f6de=new Date(),_0x50a510=('0'+_0x52f6de['getDate']())[_0x2104eb(0x1e1)](-0x2),_0x527c0a=('0'+(_0x52f6de[_0x2104eb(0x273)]()+0x1))[_0x2104eb(0x1e1)](-0x2),_0x574b0f=_0x52f6de['getFullYear'](),_0x35939a=_0x574b0f+'-'+_0x527c0a+'-'+_0x50a510;const _0x424f4b=new suppliers_payment({'invoice':_0x3479a1,'date':_0x574b0f+'-'+_0x527c0a+'-'+_0x50a510,'suppliers':_0x5a917b,'reason':_0x2104eb(0x248),'amount':_0x582ff9}),_0x482d76=await _0x424f4b[_0x2104eb(0x1fb)]();_0x21bd46[_0x2104eb(0x26b)](_0x2104eb(0x1f4),'payment\x20successfull'),_0x38cb61[_0x2104eb(0x1f7)](_0x2104eb(0x275));}catch(_0x187ae2){console[_0x2104eb(0x1f0)](_0x187ae2);}}),router[a0_0x3d00da(0x1b2)](a0_0x3d00da(0x21f),auth,async(_0x2af67a,_0x1469f4)=>{var _0xc895c0=a0_0x3d00da;try{const {username:_0x4318da,email:_0x36fc8d,role:_0x115135}=_0x2af67a[_0xc895c0(0x1b9)],_0xa5d3fc=_0x2af67a[_0xc895c0(0x1b9)],_0x2028fc=await profile[_0xc895c0(0x1cf)]({'email':_0xa5d3fc[_0xc895c0(0x211)]}),_0x4a1964=await master_shop[_0xc895c0(0x266)]();console['log'](_0xc895c0(0x1b6),_0x4a1964);const _0x459a0d=_0x2af67a[_0xc895c0(0x1d1)]['id'],_0x5b4e0b=await purchases[_0xc895c0(0x22b)](_0x459a0d);console[_0xc895c0(0x1f0)](_0x5b4e0b);const _0x2c521b=await suppliers[_0xc895c0(0x1cf)]({'name':_0x5b4e0b[_0xc895c0(0x208)]});console[_0xc895c0(0x1f0)](_0x2c521b);if(_0x4a1964[0x0]['language']==_0xc895c0(0x23e)){var _0x59a60e=users[_0xc895c0(0x23b)];console[_0xc895c0(0x1f0)](_0x59a60e);}else{if(_0x4a1964[0x0]['language']==_0xc895c0(0x281))var _0x59a60e=users['Hindi'];else{if(_0x4a1964[0x0][_0xc895c0(0x27b)]==_0xc895c0(0x203))var _0x59a60e=users[_0xc895c0(0x203)];else{if(_0x4a1964[0x0]['language']==_0xc895c0(0x279))var _0x59a60e=users[_0xc895c0(0x279)];else{if(_0x4a1964[0x0][_0xc895c0(0x27b)]==_0xc895c0(0x2a4))var _0x59a60e=users['French'];else{if(_0x4a1964[0x0][_0xc895c0(0x27b)]==_0xc895c0(0x1ed))var _0x59a60e=users[_0xc895c0(0x291)];else{if(_0x4a1964[0x0][_0xc895c0(0x27b)]==_0xc895c0(0x23a))var _0x59a60e=users['Chinese'];else{if(_0x4a1964[0x0][_0xc895c0(0x27b)]=='Arabic\x20(ae)')var _0x59a60e=users[_0xc895c0(0x1db)];}}}}}}}_0x1469f4[_0xc895c0(0x22f)](_0xc895c0(0x1c7),{'success':_0x2af67a[_0xc895c0(0x26b)](_0xc895c0(0x1f4)),'errors':_0x2af67a['flash'](_0xc895c0(0x25d)),'role':_0xa5d3fc,'profile':_0x2028fc,'master_shop':_0x4a1964,'supplier':_0x2c521b,'purchase':_0x5b4e0b,'language':_0x59a60e});}catch(_0x4d0bbd){console[_0xc895c0(0x1f0)](_0x4d0bbd);}}),router[a0_0x3d00da(0x1b2)](a0_0x3d00da(0x1c9),auth,async(_0x59cae6,_0x21822b)=>{var _0x3ef0ea=a0_0x3d00da;try{const {username:_0x5d5992,email:_0x2e2024,role:_0x593566}=_0x59cae6[_0x3ef0ea(0x1b9)],_0x28724c=_0x59cae6[_0x3ef0ea(0x1b9)],_0x5f303e=await profile[_0x3ef0ea(0x1cf)]({'email':_0x28724c[_0x3ef0ea(0x211)]}),_0x39d8af=await master_shop[_0x3ef0ea(0x266)]();console[_0x3ef0ea(0x1f0)](_0x3ef0ea(0x1b6),_0x39d8af);const _0x434a68=_0x59cae6[_0x3ef0ea(0x1d1)]['id'];console[_0x3ef0ea(0x1f0)](_0x434a68);const _0x45eeda=await purchases_finished[_0x3ef0ea(0x22b)](_0x434a68);console[_0x3ef0ea(0x1f0)](_0x3ef0ea(0x2a5),_0x45eeda);const _0x1f1f6e=await product['find']({}),_0x531d9e=await warehouse[_0x3ef0ea(0x1da)]([{'$match':{'name':_0x45eeda['warehouse_name'],'room':_0x45eeda[_0x3ef0ea(0x236)]}},{'$unwind':_0x3ef0ea(0x272)},{'$group':{'_id':_0x3ef0ea(0x295),'name':{'$first':_0x3ef0ea(0x276)},'product_stock':{'$first':_0x3ef0ea(0x218)},'bay':{'$first':_0x3ef0ea(0x1dd)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3ef0ea(0x1ba)},'primary_code':{'$first':_0x3ef0ea(0x297)},'secondary_code':{'$first':_0x3ef0ea(0x24e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);console[_0x3ef0ea(0x1f0)]('stock_data',_0x531d9e);let _0xef9df3;if(_0x28724c[_0x3ef0ea(0x253)]==_0x3ef0ea(0x1e4)){const _0x5eb885=await staff[_0x3ef0ea(0x1cf)]({'email':_0x28724c['email']});_0xef9df3=await warehouse[_0x3ef0ea(0x266)]({'status':_0x3ef0ea(0x22c),'name':_0x5eb885['warehouse'],'warehouse_category':_0x3ef0ea(0x1d9),'name':_0x3ef0ea(0x1ec)});}else _0xef9df3=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x3ef0ea(0x1d9),'name':'Return\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x3ef0ea(0x1ae)}}}]);if(_0x39d8af[0x0][_0x3ef0ea(0x27b)]==_0x3ef0ea(0x23e)){var _0x3cc143=users[_0x3ef0ea(0x23b)];console[_0x3ef0ea(0x1f0)](_0x3cc143);}else{if(_0x39d8af[0x0]['language']==_0x3ef0ea(0x281))var _0x3cc143=users[_0x3ef0ea(0x281)];else{if(_0x39d8af[0x0][_0x3ef0ea(0x27b)]=='German')var _0x3cc143=users[_0x3ef0ea(0x203)];else{if(_0x39d8af[0x0][_0x3ef0ea(0x27b)]==_0x3ef0ea(0x279))var _0x3cc143=users['Spanish'];else{if(_0x39d8af[0x0][_0x3ef0ea(0x27b)]==_0x3ef0ea(0x2a4))var _0x3cc143=users[_0x3ef0ea(0x2a4)];else{if(_0x39d8af[0x0][_0x3ef0ea(0x27b)]=='Portuguese\x20(BR)')var _0x3cc143=users[_0x3ef0ea(0x291)];else{if(_0x39d8af[0x0]['language']==_0x3ef0ea(0x23a))var _0x3cc143=users[_0x3ef0ea(0x23a)];else{if(_0x39d8af[0x0][_0x3ef0ea(0x27b)]==_0x3ef0ea(0x1bc))var _0x3cc143=users[_0x3ef0ea(0x1db)];}}}}}}}_0x21822b[_0x3ef0ea(0x22f)](_0x3ef0ea(0x1d5),{'success':_0x59cae6[_0x3ef0ea(0x26b)](_0x3ef0ea(0x1f4)),'errors':_0x59cae6[_0x3ef0ea(0x26b)](_0x3ef0ea(0x25d)),'role':_0x28724c,'profile':_0x5f303e,'user':_0x45eeda,'stock':_0x531d9e,'master_shop':_0x39d8af,'product':_0x1f1f6e,'language':_0x3cc143,'warehouse':_0xef9df3});}catch(_0x375027){console[_0x3ef0ea(0x1f0)](_0x375027);}}),router[a0_0x3d00da(0x28f)](a0_0x3d00da(0x1c9),auth,async(_0x495f0d,_0x204dee)=>{var _0x5f3a33=a0_0x3d00da;try{const {invoice:_0x373a66,date:_0x21747f,warehouse_name:_0xc2c8cf,Room_name:_0x33df4e,product_name:_0x36448c,purchase_quantity:_0x3ec570,stocks:_0x450417,return_qty:_0x51f8da,note:_0x3f77e8,level:_0x1685d4,isle:_0x109e34,pallet:_0x57a61f,to_warehouse_name:_0x8c881b,to_Room_name:_0x18cafb}=_0x495f0d[_0x5f3a33(0x231)],_0x575182=await purchases_finished['findOne']({'_id':_0x495f0d[_0x5f3a33(0x1d1)]['id']}),_0x4a4409=await warehouse[_0x5f3a33(0x1cf)]({'name':_0xc2c8cf,'room':_0x33df4e,'warehouse_category':_0x5f3a33(0x1d9)});if(typeof _0x36448c==_0x5f3a33(0x238))var _0x4f88ee=[_0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x1dc)]],_0x47f01f=[_0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x1f1)]],_0x515573=[_0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x267)]],_0x40d50b=[_0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x1e7)]],_0x176cf2=[_0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x1d6)]],_0x37b37a=[_0x495f0d['body'][_0x5f3a33(0x260)]],_0x58a383=[_0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x27f)]],_0x4dbe7b=[_0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x20e)]];else var _0x4f88ee=[..._0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x1dc)]],_0x47f01f=[..._0x495f0d[_0x5f3a33(0x231)]['purchase_quantity']],_0x515573=[..._0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x267)]],_0x40d50b=[..._0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x1e7)]],_0x176cf2=[..._0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x1d6)]],_0x37b37a=[..._0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x260)]],_0x58a383=[..._0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x27f)]],_0x4dbe7b=[..._0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x20e)]];const _0x449836=_0x4f88ee[_0x5f3a33(0x1cb)](_0x14560a=>{return _0x14560a={'product_name':_0x14560a};});_0x47f01f['forEach']((_0x4c50ef,_0x1de874)=>{var _0x47f132=_0x5f3a33;_0x449836[_0x1de874][_0x47f132(0x1f1)]=_0x4c50ef;}),_0x515573[_0x5f3a33(0x204)]((_0x2e7d72,_0x1dda82)=>{_0x449836[_0x1dda82]['stock_quantity']=_0x2e7d72;}),_0x40d50b[_0x5f3a33(0x204)]((_0x29ce69,_0x74085e)=>{_0x449836[_0x74085e]['return_qty']=_0x29ce69;}),_0x176cf2['forEach']((_0x79d1ac,_0x309e71)=>{var _0x430015=_0x5f3a33;_0x449836[_0x309e71][_0x430015(0x21a)]=_0x79d1ac;}),_0x37b37a['forEach']((_0x142e9d,_0x593b2e)=>{var _0x4ea854=_0x5f3a33;_0x449836[_0x593b2e][_0x4ea854(0x255)]=_0x142e9d;}),_0x58a383[_0x5f3a33(0x204)]((_0x5899a4,_0x197acd)=>{var _0x44b24f=_0x5f3a33;_0x449836[_0x197acd][_0x44b24f(0x20a)]=_0x5899a4;}),_0x4dbe7b[_0x5f3a33(0x204)]((_0x49d71f,_0x5d12c0)=>{var _0x52234e=_0x5f3a33;_0x449836[_0x5d12c0][_0x52234e(0x1f2)]=_0x49d71f;}),_0x449836[_0x5f3a33(0x204)](_0x2f20cb=>{var _0x446345=_0x5f3a33;console[_0x446345(0x1f0)](_0x2f20cb);const _0x13abe7=_0x4a4409[_0x446345(0x1e5)][_0x446345(0x1cb)](_0x106c3c=>{var _0x142902=_0x446345;_0x106c3c[_0x142902(0x1dc)]==_0x2f20cb[_0x142902(0x1dc)]&&_0x106c3c[_0x142902(0x21a)]==_0x2f20cb['bay']&&(console[_0x142902(0x1f0)](parseInt(_0x106c3c[_0x142902(0x1ee)])+_0x142902(0x252)+parseInt(_0x2f20cb['return_qty'])),_0x106c3c['product_stock']=parseInt(_0x106c3c['product_stock'])-parseInt(_0x2f20cb[_0x142902(0x1e7)]));});}),await _0x4a4409[_0x5f3a33(0x1fb)]();var _0x2493bf=0x0;_0x449836[_0x5f3a33(0x204)](_0x5a7e3f=>{var _0x267399=_0x5f3a33;(parseInt(_0x5a7e3f[_0x267399(0x1f1)])<parseInt(_0x5a7e3f[_0x267399(0x1e7)])||parseInt(_0x5a7e3f['stock_quantity'])<parseInt(_0x5a7e3f['return_qty']))&&_0x2493bf++;});if(_0x2493bf!=0x0)return _0x495f0d[_0x5f3a33(0x26b)](_0x5f3a33(0x25d),_0x5f3a33(0x27c)),_0x204dee['redirect'](_0x5f3a33(0x1b5));const _0x2bc1dc=new purchases_return_finished({'invoice':_0x373a66,'suppliers':_0x495f0d[_0x5f3a33(0x231)]['suppliers'],'date':_0x21747f,'warehouse_name':_0xc2c8cf,'return_product':_0x449836,'note':_0x3f77e8,'room':_0x33df4e,'to_warehouse_name':_0x8c881b,'to_room':_0x18cafb}),_0x4e9c32=await _0x2bc1dc['save'](),_0x394233=await purchases_return_finished['findOne']({'invoice':_0x373a66}),_0x4c7baa=await warehouse['findOne']({'name':_0x8c881b,'room':_0x18cafb,'warehouse_category':_0x5f3a33(0x1d9)});_0x394233[_0x5f3a33(0x1d0)][_0x5f3a33(0x204)](_0x583dda=>{var _0x3d8697=_0x5f3a33,_0x6247a8=0x0;const _0x248f18=_0x4c7baa[_0x3d8697(0x1e5)][_0x3d8697(0x1cb)](_0x351692=>{var _0x113843=_0x3d8697;console[_0x113843(0x1f0)](_0x351692['product_name']+'=='+_0x583dda[_0x113843(0x1dc)]+'&&'+_0x351692[_0x113843(0x21a)]+'=='+_0x583dda[_0x113843(0x21a)]),_0x351692[_0x113843(0x1dc)]==_0x583dda[_0x113843(0x1dc)]&&_0x351692[_0x113843(0x21a)]==_0x583dda['bay']&&(_0x351692[_0x113843(0x1ee)]=parseInt(_0x351692[_0x113843(0x1ee)])-parseInt(_0x583dda[_0x113843(0x1e7)]),_0x6247a8++);});_0x6247a8=='0'&&(_0x4c7baa[_0x3d8697(0x1e5)]=_0x4c7baa[_0x3d8697(0x1e5)][_0x3d8697(0x284)]({'product_name':_0x583dda[_0x3d8697(0x1dc)],'product_stock':_0x583dda[_0x3d8697(0x1e7)],'primary_code':_0x583dda[_0x3d8697(0x20a)],'secondary_code':_0x583dda[_0x3d8697(0x1f2)],'product_code':_0x583dda[_0x3d8697(0x255)],'bay':_0x583dda[_0x3d8697(0x21a)],'maxProducts':0xf423f}));}),await _0x4c7baa[_0x5f3a33(0x1fb)]();const _0x21e284=await purchases_finished[_0x5f3a33(0x1cf)]({'invoice':_0x373a66});_0x21e284['return_data']=_0x5f3a33(0x1f9);const _0xd2688f=await _0x21e284[_0x5f3a33(0x1fb)](),_0x534874=new s_payment_data({'invoice':_0x373a66,'suppliers':_0x495f0d[_0x5f3a33(0x231)][_0x5f3a33(0x208)],'reason':'Purchase\x20Return'});await _0x534874[_0x5f3a33(0x1fb)]();const _0x1b0252=await master_shop[_0x5f3a33(0x266)](),_0x5c6720=await email_settings[_0x5f3a33(0x1cf)](),_0x2664f0=await suppliers[_0x5f3a33(0x1cf)]({'name':_0x495f0d[_0x5f3a33(0x231)]['suppliers']});_0x1b0252[0x0][_0x5f3a33(0x1ca)]==0x1?(right_currency=_0x1b0252[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1b0252[0x0][_0x5f3a33(0x288)]);var _0xd67549=_0x4f88ee,_0x1d08c5=_0x40d50b,_0x2052a1='',_0x59837b;for(_0x59837b in _0xd67549){_0x2052a1+='<tr>'+_0x5f3a33(0x2a8)+_0xd67549[_0x59837b]+_0x5f3a33(0x1de)+_0x5f3a33(0x2a8)+_0x1d08c5[_0x59837b]+_0x5f3a33(0x1de)+'</tr>';}let _0x2cf8ae=nodemailer[_0x5f3a33(0x216)]({'service':_0x5f3a33(0x1f6),'auth':{'user':_0x5c6720[_0x5f3a33(0x211)],'pass':_0x5c6720['password']}}),_0x41e1c3={'from':_0x5c6720['email'],'to':_0x2664f0[_0x5f3a33(0x211)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x5f3a33(0x1e0)+_0x5f3a33(0x23d)+_0x1b0252[0x0][_0x5f3a33(0x29e)],'cid':_0x5f3a33(0x1fc)}],'html':_0x5f3a33(0x1d2)+_0x5f3a33(0x1c1)+_0x5f3a33(0x26c)+_0x5f3a33(0x280)+_0x5f3a33(0x29f)+_0x5f3a33(0x280)+_0x5f3a33(0x210)+_0x5f3a33(0x1e8)+_0x5f3a33(0x280)+_0x5f3a33(0x21b)+_0x1b0252[0x0][_0x5f3a33(0x274)]+_0x5f3a33(0x250)+_0x5f3a33(0x1e8)+_0x5f3a33(0x1e8)+_0x5f3a33(0x239)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x373a66+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x5f3a33(0x29d)+_0x21747f+'\x20'+'</span>'+'</h5>'+_0x5f3a33(0x1e8)+_0x5f3a33(0x217)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x5f3a33(0x225)+_0x5f3a33(0x246)+_0x5f3a33(0x24b)+_0x5f3a33(0x29a)+_0x5f3a33(0x234)+_0x5f3a33(0x242)+_0x5f3a33(0x290)+'\x20'+_0x2052a1+'\x20'+_0x5f3a33(0x1b7)+'</table>'+'<div>'+_0x5f3a33(0x222)+_0x5f3a33(0x1be)+_0x1b0252[0x0][_0x5f3a33(0x274)]+'</h5>'+_0x5f3a33(0x1e8)+'</div>'+'</body></html>'};_0x2cf8ae['sendMail'](_0x41e1c3,function(_0x4f14df,_0x38dbb0){var _0xdef55b=_0x5f3a33;_0x4f14df?console[_0xdef55b(0x1f0)]('Error\x20Occurs'):console[_0xdef55b(0x1f0)]('Email\x20sent\x20successfully');}),_0x495f0d[_0x5f3a33(0x26b)](_0x5f3a33(0x1f4),'purchases\x20item\x20return\x20successfull'),_0x204dee['redirect'](_0x5f3a33(0x1eb));}catch(_0x258dc4){_0x204dee[_0x5f3a33(0x258)](0xc8)[_0x5f3a33(0x1bf)]({'message':_0x258dc4['message']});}}),router[a0_0x3d00da(0x1b2)]('/barcode/:id',auth,async(_0x14d5e1,_0x19fcda)=>{var _0x57b339=a0_0x3d00da;try{const {username:_0x28d487,email:_0x4c5e98,role:_0x27a0cf}=_0x14d5e1[_0x57b339(0x1b9)],_0x172a20=_0x14d5e1['user'],_0x409cec=await profile['findOne']({'email':_0x172a20[_0x57b339(0x211)]}),_0x36e694=await master_shop[_0x57b339(0x266)](),_0x16f763=_0x14d5e1['params']['id'],_0x2a788d=await purchases_finished[_0x57b339(0x22b)](_0x16f763);if(_0x36e694[0x0][_0x57b339(0x27b)]==_0x57b339(0x23e))var _0x4048ca=users[_0x57b339(0x23b)];else{if(_0x36e694[0x0][_0x57b339(0x27b)]==_0x57b339(0x281))var _0x4048ca=users[_0x57b339(0x281)];else{if(_0x36e694[0x0]['language']==_0x57b339(0x203))var _0x4048ca=users[_0x57b339(0x203)];else{if(_0x36e694[0x0][_0x57b339(0x27b)]=='Spanish')var _0x4048ca=users[_0x57b339(0x279)];else{if(_0x36e694[0x0]['language']=='French')var _0x4048ca=users[_0x57b339(0x2a4)];else{if(_0x36e694[0x0]['language']=='Portuguese\x20(BR)')var _0x4048ca=users[_0x57b339(0x291)];else{if(_0x36e694[0x0][_0x57b339(0x27b)]==_0x57b339(0x23a))var _0x4048ca=users['Chinese'];else{if(_0x36e694[0x0][_0x57b339(0x27b)]==_0x57b339(0x1bc))var _0x4048ca=users[_0x57b339(0x1db)];}}}}}}}_0x19fcda[_0x57b339(0x22f)](_0x57b339(0x28c),{'success':_0x14d5e1[_0x57b339(0x26b)](_0x57b339(0x1f4)),'errors':_0x14d5e1['flash'](_0x57b339(0x25d)),'role':_0x172a20,'profile':_0x409cec,'alldata':_0x2a788d,'master_shop':_0x36e694,'language':_0x4048ca}),console['log'](alldata);}catch(_0xd89088){console[_0x57b339(0x1f0)](_0xd89088);}}),router[a0_0x3d00da(0x28f)]('/barcode_scanner',async(_0x47d1f8,_0x5e9f4b)=>{var _0x177235=a0_0x3d00da;const {product_code:_0x33cc8f}=_0x47d1f8['body'];var _0x541b61;const _0x1c544d=await product[_0x177235(0x1da)]([{'$match':{'primary_code':_0x33cc8f,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x177235(0x1d8),'name':{'$first':_0x177235(0x1ae)},'category':{'$first':_0x177235(0x1c0)},'brand':{'$first':_0x177235(0x1d3)},'unit':{'$first':_0x177235(0x1e2)},'alertquantity':{'$first':_0x177235(0x27e)},'product_code':{'$first':_0x177235(0x1e3)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x177235(0x1c8)},'maxStocks':{'$first':_0x177235(0x1e9)},'maxProdPerUnit':{'$first':_0x177235(0x1b8)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x147f2d=await product['aggregate']([{'$match':{'secondary_code':_0x33cc8f}},{'$group':{'_id':_0x177235(0x1d8),'name':{'$first':_0x177235(0x1ae)},'category':{'$first':_0x177235(0x1c0)},'brand':{'$first':_0x177235(0x1d3)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x177235(0x1e3)},'primary_code':{'$first':_0x177235(0x23f)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x177235(0x1e9)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x177235(0x254)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1c544d['length']>0x0)_0x541b61=_0x1c544d;else _0x147f2d['length']>0x0&&(_0x541b61=_0x147f2d);_0x5e9f4b[_0x177235(0x1bf)](_0x541b61);}),router[a0_0x3d00da(0x28f)](a0_0x3d00da(0x228),async(_0x5a6759,_0x19346c)=>{var _0x114dc6=a0_0x3d00da;const {productCode:_0x1cb30a,bay:_0x5c89b1,warehouses:_0x16d6b6,room:_0x3ab56a}=_0x5a6759[_0x114dc6(0x231)];console[_0x114dc6(0x1f0)](_0x5a6759[_0x114dc6(0x231)]);try{const _0x1fe775=await warehouse['aggregate']([{'$match':{'name':_0x16d6b6,'room':_0x3ab56a}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x5c89b1)}},{'$group':{'_id':_0x114dc6(0x295),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x114dc6(0x244)}}}]);_0x19346c[_0x114dc6(0x258)](0xc8)[_0x114dc6(0x1bf)](_0x1fe775);}catch(_0x548451){_0x19346c[_0x114dc6(0x258)](0x194)[_0x114dc6(0x1bf)]({'message':_0x548451['message']});}}),module[a0_0x3d00da(0x21c)]=router;