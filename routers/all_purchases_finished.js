var a0_0x41a8f0=a0_0x1754;function a0_0x2e46(){var _0x359be3=['$product.type','invoice','MaxStocks_data','nodemailer','Rack\x201','purchase_invoice','Enabled','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Purchase\x20Mail','$batch_code','9760xHfWMD','<tr>','prod_code','\x20Order\x20Number\x20:\x20','prod_level','417198cmzmCm','product_code','currency_placement','express','toString','$suppliers','level','maxperunit','due_amount','port','Spanish','warehouse','RoomAssign','purchases\x20item\x20return\x20successfull','$product_details.product_code','getFullYear','$warehouse_name','QA\x20Warehouse','site_title','$primary_code','../models/all_models','primary_code','staff','True','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Email\x20sent\x20successfully','<html><head><title></title>','DRY\x20GOODS','Room_name','<span\x20style=\x22float:\x20right;\x22>','$alertquantity','filter','\x20<>\x20','$product_details.floorlevel','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','quantity','name','createTransport','/barcode_scanner','1229460CPAQzL','maxStocks','note','exports','all_purchases_barcode','</tbody>','product_stock','$product.quantity','abs','Ambient','suppliers_docs','$suppliers_docs','<strong>\x20Regards\x20</strong>','/upload/','product_cat','182PaClBH','$expiry_date','$_id','English','/all_purchases_finished/view','$due_amount','product_date','364254CTSbvU','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','params','host','</body></html>','</thead>','$product','concat','batch_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','user','bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$return_data','FGSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','findOne','room_name','<tbody\x20style=\x22text-align:\x20center;\x22>','status','slice','INCF-','_id','product_details','product_name','add_purchases_finished','master','prod_secondunit','return_data','standard_unit','image','/CheckingWarehouse','secondary_code_hide','getDate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<div>','30GtflCW','Error\x20Occurs','$room','body','padStart','JO_number','English\x20(US)','render','updateOne','$paid_amount','payment\x20successfull','max_product_unit','aggregate','room','Chinese','forEach','/../public','$product_details.primary_code','production_date','prod_name','Hindi','all_purchases_finished','$invoice','Portuguese\x20(BR)','Rack\x202','$product_details.secondary_code','/invoice/:id','paid_amount','<!DOCTYPE\x20html>','German','/view/add_purchases/:id','<hr\x20class=\x22my-3\x22>','user_id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<h5\x20style=\x22text-align:\x20left;\x22>','\x20Order\x20Date\x20:\x20','../middleware/auth','French','errors','success','$note','</tr>','Portuguese','getMonth','find','amount','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','catch','Paid\x20For\x20Purchase','secondary_code','primary_code_hide','gmail','3115563JekWmj','product','language','55842rbNoPP','prod_qty','/view','$product_details._id','sendMail','all','post','Arabic','save','prod_Qty','$category','2661232tcLeec','product_code_hide','log','/view/add_purchases','$product.bay','/view/return_purchase/:id','then','redirect','Arabic\x20(ae)','prod_invoice','$product.floorlevel','$name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','expiry_date','Finished\x20Goods','purchase_quantity','string','1179hfWBxr','get','../public/language/languages.json','length','findById','stocks','</div>','prod_primunit','date','currency','suppliers','role','ejs','$secondary_unit','3viEoVf','$product_details.product_stock','$product_details.type','Logo.png','return_qty','</table>','secondary_unit','map','Return\x20Goods','$date','error','edit_purchases_finished_view','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','FROZEN\x20GOODS','$product_details','flash','message','prod_unit','$maxStocks','<h5>','email','/all_purchases/view','$product_details.product_name','json','An\x20error\x20occurred\x20while\x20saving\x20data.','stock_quantity','</h5>','\x20</h2>','</td>','</head><body>','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$brand','$secondary_code','password','add_purchases\x20error','/preview/:id','prod_cat','logo'];a0_0x2e46=function(){return _0x359be3;};return a0_0x2e46();}(function(_0x272b89,_0xc5d31d){var _0x2067a2=a0_0x1754,_0xccf774=_0x272b89();while(!![]){try{var _0x28a97d=parseInt(_0x2067a2(0x1ef))/0x1*(parseInt(_0x2067a2(0x226))/0x2)+parseInt(_0x2067a2(0x264))/0x3+parseInt(_0x2067a2(0x1d0))/0x4+-parseInt(_0x2067a2(0x24e))/0x5+parseInt(_0x2067a2(0x1c5))/0x6*(parseInt(_0x2067a2(0x25d))/0x7)+-parseInt(_0x2067a2(0x221))/0x8*(parseInt(_0x2067a2(0x1e1))/0x9)+parseInt(_0x2067a2(0x288))/0xa*(-parseInt(_0x2067a2(0x1c2))/0xb);if(_0x28a97d===_0xc5d31d)break;else _0xccf774['push'](_0xccf774['shift']());}catch(_0x426fc5){_0xccf774['push'](_0xccf774['shift']());}}}(a0_0x2e46,0x616f6));const express=require(a0_0x41a8f0(0x229)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x41a8f0(0x23a)),auth=require(a0_0x41a8f0(0x1b1)),nodemailer=require(a0_0x41a8f0(0x21a));var ejs=require(a0_0x41a8f0(0x1ed));const path=require('path'),users=require(a0_0x41a8f0(0x1e3));router[a0_0x41a8f0(0x1e2)](a0_0x41a8f0(0x1c7),auth,async(_0x32a729,_0x5b3dd5)=>{var _0x40fa45=a0_0x41a8f0;try{const {username:_0xfbade3,email:_0x17122a,role:_0x3e208c}=_0x32a729[_0x40fa45(0x26e)],_0x5148a9=_0x32a729[_0x40fa45(0x26e)],_0x5569e8=await profile[_0x40fa45(0x274)]({'email':_0x5148a9[_0x40fa45(0x203)]}),_0x57da2f=await staff[_0x40fa45(0x274)]({'email':_0x5148a9[_0x40fa45(0x203)]});if(_0x5148a9['role']=='staff'){const _0x359863=await staff['findOne']({'email':_0x5148a9[_0x40fa45(0x203)]});}const _0x270167=await master_shop['find']();let _0x5c3d7b;if(_0x5148a9[_0x40fa45(0x1ec)]=='staff'){const _0x268e05=await staff[_0x40fa45(0x274)]({'email':_0x5148a9['email']});_0x5c3d7b=await purchases_finished[_0x40fa45(0x294)]([{'$match':{'warehouse_name':_0x268e05[_0x40fa45(0x231)]}},{'$lookup':{'from':_0x40fa45(0x1eb),'localField':_0x40fa45(0x1eb),'foreignField':_0x40fa45(0x24b),'as':_0x40fa45(0x258)}},{'$unwind':_0x40fa45(0x259)},{'$unwind':_0x40fa45(0x26a)},{'$group':{'_id':_0x40fa45(0x25f),'invoice':{'$first':_0x40fa45(0x29e)},'suppliers':{'$first':_0x40fa45(0x22b)},'date':{'$first':_0x40fa45(0x1f8)},'warehouse_name':{'$first':_0x40fa45(0x236)},'room':{'$first':_0x40fa45(0x28a)},'product':{'$push':_0x40fa45(0x26a)},'note':{'$first':_0x40fa45(0x1b5)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x40fa45(0x262)},'return_data':{'$first':_0x40fa45(0x271)},'batch_code':{'$first':_0x40fa45(0x220)},'expiry_date':{'$first':_0x40fa45(0x25e)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x40fa45(0x255)},'level':{'$addToSet':_0x40fa45(0x1d4)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x40fa45(0x217)},'floorlevel':{'$addToSet':_0x40fa45(0x1da)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5c3d7b=await purchases_finished[_0x40fa45(0x294)]([{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x40fa45(0x22b)},'date':{'$first':_0x40fa45(0x1f8)},'warehouse_name':{'$first':_0x40fa45(0x236)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x40fa45(0x26a)},'note':{'$first':_0x40fa45(0x1b5)},'paid_amount':{'$first':_0x40fa45(0x291)},'due_amount':{'$first':_0x40fa45(0x262)},'return_data':{'$first':_0x40fa45(0x271)},'batch_code':{'$first':_0x40fa45(0x220)},'expiry_date':{'$first':_0x40fa45(0x25e)},'suppliers_docs':{'$first':_0x40fa45(0x259)},'total_product_quantity':{'$sum':_0x40fa45(0x255)},'level':{'$addToSet':_0x40fa45(0x1d4)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x40fa45(0x217)},'floorlevel':{'$addToSet':_0x40fa45(0x1da)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x270167[0x0][_0x40fa45(0x1c4)]==_0x40fa45(0x28e))var _0x2a0ea9=users[_0x40fa45(0x260)];else{if(_0x270167[0x0][_0x40fa45(0x1c4)]==_0x40fa45(0x29c))var _0x2a0ea9=users[_0x40fa45(0x29c)];else{if(_0x270167[0x0]['language']=='German')var _0x2a0ea9=users[_0x40fa45(0x1aa)];else{if(_0x270167[0x0][_0x40fa45(0x1c4)]=='Spanish')var _0x2a0ea9=users['Spanish'];else{if(_0x270167[0x0][_0x40fa45(0x1c4)]==_0x40fa45(0x1b2))var _0x2a0ea9=users[_0x40fa45(0x1b2)];else{if(_0x270167[0x0][_0x40fa45(0x1c4)]=='Portuguese\x20(BR)')var _0x2a0ea9=users[_0x40fa45(0x1b7)];else{if(_0x270167[0x0][_0x40fa45(0x1c4)]==_0x40fa45(0x296))var _0x2a0ea9=users[_0x40fa45(0x296)];else{if(_0x270167[0x0][_0x40fa45(0x1c4)]==_0x40fa45(0x1d8))var _0x2a0ea9=users[_0x40fa45(0x1cc)];}}}}}}}_0x5b3dd5[_0x40fa45(0x28f)](_0x40fa45(0x29d),{'success':_0x32a729[_0x40fa45(0x1fe)](_0x40fa45(0x1b4)),'errors':_0x32a729['flash'](_0x40fa45(0x1b3)),'purchases':_0x5c3d7b,'role':_0x5148a9,'profile':_0x5569e8,'master_shop':_0x270167,'language':_0x2a0ea9});}catch(_0x5774d8){console[_0x40fa45(0x1d2)]('table\x20page',_0x5774d8),_0x5b3dd5[_0x40fa45(0x277)](0xc8)[_0x40fa45(0x206)]({'message':_0x5774d8['message']});}});function BayBinSelected(_0x43eb3e,_0x57714b){var _0x1319ec=a0_0x41a8f0,_0x3c6ebb=[],_0x924c53=[];if(_0x43eb3e==_0x1319ec(0x241)){switch(_0x57714b){case _0x1319ec(0x21b):_0x3c6ebb=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1319ec(0x2a0):_0x3c6ebb=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x924c53=['DG'];}else{if(_0x43eb3e==_0x1319ec(0x1fc)){switch(_0x57714b){case'Rack\x201':_0x3c6ebb=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1319ec(0x2a0):_0x3c6ebb=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x924c53=['FG'];}}return{'levels':_0x3c6ebb,'identify':_0x924c53};}function a0_0x1754(_0x387b82,_0x330daf){var _0x2e467f=a0_0x2e46();return a0_0x1754=function(_0x175402,_0x200bf9){_0x175402=_0x175402-0x1a7;var _0x34c5a7=_0x2e467f[_0x175402];return _0x34c5a7;},a0_0x1754(_0x387b82,_0x330daf);}async function getRandom8DigitNumber(){var _0x2a6b78=a0_0x41a8f0;const _0x582856=0x989680,_0x598c79=0x5f5e0ff,_0x18b6a5=Math['floor'](Math['random']()*(_0x598c79-_0x582856+0x1))+_0x582856;var _0x5a3a81;const _0x5530f9=await purchases_finished[_0x2a6b78(0x274)]({'invoice':_0x2a6b78(0x279)+_0x18b6a5});return _0x5530f9&&_0x5530f9['length']>0x0?_0x5a3a81=_0x2a6b78(0x279)+_0x18b6a5:_0x5a3a81=_0x2a6b78(0x279)+_0x18b6a5,_0x5a3a81;}router[a0_0x41a8f0(0x1e2)](a0_0x41a8f0(0x1d3),auth,async(_0x588dbe,_0x4cd7df)=>{var _0x5911f1=a0_0x41a8f0;try{const {username:_0x436eae,email:_0x49817a,role:_0x21398e}=_0x588dbe[_0x5911f1(0x26e)],_0x152e69=_0x588dbe[_0x5911f1(0x26e)],_0x5e46b5=await profile[_0x5911f1(0x274)]({'email':_0x152e69['email']}),_0x3d1fe9=await master_shop[_0x5911f1(0x1b9)](),_0x82834d=await staff[_0x5911f1(0x274)]({'email':_0x152e69[_0x5911f1(0x203)]}),_0x20f090=await suppliers['find']({});let _0x178adc;if(_0x152e69[_0x5911f1(0x1ec)]==_0x5911f1(0x23c)){const _0x5449e5=await staff[_0x5911f1(0x274)]({'email':_0x152e69['email']});_0x178adc=await warehouse[_0x5911f1(0x294)]([{'$match':{'status':'Enabled','name':_0x5449e5[_0x5911f1(0x231)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x5911f1(0x1db),'name':{'$first':'$name'}}}]);}else _0x178adc=await warehouse[_0x5911f1(0x294)]([{'$match':{'status':_0x5911f1(0x21d),'warehouse_category':_0x5911f1(0x1de),'name':{'$ne':_0x5911f1(0x237)}}},{'$group':{'_id':_0x5911f1(0x1db),'name':{'$first':_0x5911f1(0x1db)}}}]);const _0x5e63b=await product[_0x5911f1(0x1b9)]({}),_0x3f12a6=await warehouse[_0x5911f1(0x1b9)]({'status':_0x5911f1(0x21d)}),_0x288061=await purchases_finished[_0x5911f1(0x1b9)]({}),_0x1b588b=_0x288061[_0x5911f1(0x1e4)]+0x1,_0x411dfd=_0x5911f1(0x279)+_0x1b588b[_0x5911f1(0x22a)]()[_0x5911f1(0x28c)](0x5,'0');var _0x552f75=[_0x5911f1(0x257),'Enclosed'];if(_0x3d1fe9[0x0]['language']==_0x5911f1(0x28e))var _0x54acc8=users[_0x5911f1(0x260)];else{if(_0x3d1fe9[0x0]['language']==_0x5911f1(0x29c))var _0x54acc8=users[_0x5911f1(0x29c)];else{if(_0x3d1fe9[0x0][_0x5911f1(0x1c4)]=='German')var _0x54acc8=users[_0x5911f1(0x1aa)];else{if(_0x3d1fe9[0x0]['language']==_0x5911f1(0x230))var _0x54acc8=users[_0x5911f1(0x230)];else{if(_0x3d1fe9[0x0][_0x5911f1(0x1c4)]==_0x5911f1(0x1b2))var _0x54acc8=users[_0x5911f1(0x1b2)];else{if(_0x3d1fe9[0x0][_0x5911f1(0x1c4)]==_0x5911f1(0x29f))var _0x54acc8=users[_0x5911f1(0x1b7)];else{if(_0x3d1fe9[0x0][_0x5911f1(0x1c4)]==_0x5911f1(0x296))var _0x54acc8=users[_0x5911f1(0x296)];else{if(_0x3d1fe9[0x0]['language']==_0x5911f1(0x1d8))var _0x54acc8=users[_0x5911f1(0x1cc)];}}}}}}}const _0x246f2f=getRandom8DigitNumber();_0x246f2f[_0x5911f1(0x1d6)](_0x14b26e=>{var _0x227c57=_0x5911f1;_0x4cd7df['render'](_0x227c57(0x27d),{'success':_0x588dbe[_0x227c57(0x1fe)](_0x227c57(0x1b4)),'errors':_0x588dbe[_0x227c57(0x1fe)](_0x227c57(0x1b3)),'role':_0x152e69,'profile':_0x5e46b5,'suppliers':_0x20f090,'warehouse':_0x178adc,'product':_0x5e63b,'invoice':_0x14b26e,'master_shop':_0x3d1fe9,'language':_0x54acc8,'find_data':_0x3f12a6,'rooms_data':_0x552f75});})[_0x5911f1(0x1bd)](_0x457344=>{var _0x51f629=_0x5911f1;_0x588dbe[_0x51f629(0x1fe)](_0x51f629(0x1b3),_0x51f629(0x1dc)),_0x4cd7df[_0x51f629(0x1d7)]('/all_purchases_finished/view');});}catch(_0x764721){console['log'](_0x764721);}}),router['get'](a0_0x41a8f0(0x1ab),auth,async(_0x25c67e,_0x245548)=>{var _0x181285=a0_0x41a8f0;try{const _0x41163f=_0x25c67e[_0x181285(0x266)]['id'];console[_0x181285(0x1d2)](_0x41163f);const _0x1edea9=await master_shop[_0x181285(0x1b9)]();console[_0x181285(0x1d2)]('master',_0x1edea9);const _0x43308c=await product[_0x181285(0x274)]({'name':_0x41163f});console[_0x181285(0x1d2)]('product',_0x43308c),_0x245548[_0x181285(0x277)](0xc8)[_0x181285(0x206)]({'product_data':_0x43308c,'master':_0x1edea9});}catch(_0x282a4b){console[_0x181285(0x1d2)](_0x181285(0x213),_0x282a4b);}}),router[a0_0x41a8f0(0x1cb)]('/view/add_purchases',auth,async(_0xe47651,_0x3b3eb5)=>{var _0x3d1cf9=a0_0x41a8f0;try{const {invoice:_0x43e6e6,date:_0x480119,warehouse_name:_0x49594a,prod_name:_0x4f0a64,prod_code:_0x17a1aa,prod_qty:_0x384e8,prod_unit:_0x3f020a,prod_secondunit:_0x221d4f,prod_level:_0x366075,prod_isle:_0x1ffdc3,prod_pallet:_0x35ed6f,note:_0x44f8f3,expiry_date:_0xa8c803,batch_code:_0x5b4425,payable:_0x36abf6,due_amount:_0x1e0f3f,Room_name:_0x492f22,primary_code:_0x6451ea,secondary_code:_0x2ee938,MaxStocks_data:_0x14c71d,PO_number:_0x30afd6,SCRN:_0x2300be,JO_number:_0x52f105}=_0xe47651['body'];if(typeof _0x4f0a64==_0x3d1cf9(0x1e0))var _0x23d4c9=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x29b)]],_0x5de410=[_0xe47651['body'][_0x3d1cf9(0x223)]],_0x162348=[_0xe47651['body'][_0x3d1cf9(0x1ce)]],_0x4e2227=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x1e8)]],_0x57b82a=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x27f)]],_0x46d101=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x225)]],_0x5d0c09=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x23b)]],_0x4eeefc=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x1bf)]],_0x8dacef=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x219)]],_0x32ae98=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x26c)]],_0x2e8084=[_0xe47651[_0x3d1cf9(0x28b)]['expiry_date']],_0x561192=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x263)]],_0x2ea18c=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x293)]],_0x4ee492=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x215)]],_0x15101c=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x232)]],_0x2e154c=[_0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x1d9)]];else var _0x23d4c9=[..._0xe47651['body'][_0x3d1cf9(0x29b)]],_0x5de410=[..._0xe47651['body'][_0x3d1cf9(0x223)]],_0x162348=[..._0xe47651[_0x3d1cf9(0x28b)]['prod_Qty']],_0x4e2227=[..._0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x1e8)]],_0x57b82a=[..._0xe47651['body'][_0x3d1cf9(0x27f)]],_0x46d101=[..._0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x225)]],_0x5d0c09=[..._0xe47651[_0x3d1cf9(0x28b)]['primary_code']],_0x4eeefc=[..._0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x1bf)]],_0x8dacef=[..._0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x219)]],_0x32ae98=[..._0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x26c)]],_0x2e8084=[..._0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x1dd)]],_0x561192=[..._0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x263)]],_0x2ea18c=[..._0xe47651[_0x3d1cf9(0x28b)][_0x3d1cf9(0x293)]],_0x4ee492=[..._0xe47651['body'][_0x3d1cf9(0x215)]],_0x15101c=[..._0xe47651[_0x3d1cf9(0x28b)]['RoomAssign']],_0x2e154c=[..._0xe47651[_0x3d1cf9(0x28b)]['prod_invoice']];const _0x319bd1=_0x23d4c9['map'](_0x335eb8=>{return _0x335eb8={'product_name':_0x335eb8};});_0x5de410[_0x3d1cf9(0x297)]((_0x4d85ec,_0x5612fa)=>{var _0x319f27=_0x3d1cf9;_0x319bd1[_0x5612fa][_0x319f27(0x227)]=_0x4d85ec;}),_0x162348[_0x3d1cf9(0x297)]((_0x890cd,_0x5bfebf)=>{_0x319bd1[_0x5bfebf]['quantity']=Math['abs'](_0x890cd);}),_0x4e2227[_0x3d1cf9(0x297)]((_0x51d33c,_0x33f833)=>{var _0x3413b4=_0x3d1cf9;_0x319bd1[_0x33f833][_0x3413b4(0x281)]=_0x51d33c;}),_0x57b82a[_0x3d1cf9(0x297)]((_0x14b789,_0x54f9d7)=>{var _0x48b220=_0x3d1cf9;_0x319bd1[_0x54f9d7][_0x48b220(0x1f5)]=_0x14b789;}),_0x46d101['forEach']((_0x46ab62,_0x238e75)=>{var _0x59635b=_0x3d1cf9;_0x319bd1[_0x238e75][_0x59635b(0x26f)]=_0x46ab62;}),_0x5d0c09[_0x3d1cf9(0x297)]((_0x2013e1,_0x20d07d)=>{var _0x161234=_0x3d1cf9;_0x319bd1[_0x20d07d][_0x161234(0x23b)]=_0x2013e1;}),_0x4eeefc[_0x3d1cf9(0x297)]((_0x344939,_0x51437a)=>{var _0x14fd2e=_0x3d1cf9;_0x319bd1[_0x51437a][_0x14fd2e(0x1bf)]=_0x344939;}),_0x8dacef[_0x3d1cf9(0x297)]((_0x44192e,_0x5a1d36)=>{var _0xcc580c=_0x3d1cf9;_0x319bd1[_0x5a1d36][_0xcc580c(0x24f)]=_0x44192e;}),_0x32ae98[_0x3d1cf9(0x297)]((_0x354a54,_0xdfa5da)=>{var _0x40bb7f=_0x3d1cf9;_0x319bd1[_0xdfa5da][_0x40bb7f(0x26c)]=_0x354a54;}),_0x2e8084['forEach']((_0x166122,_0x1b1c75)=>{var _0x247166=_0x3d1cf9;_0x319bd1[_0x1b1c75][_0x247166(0x1dd)]=_0x166122;}),_0x561192[_0x3d1cf9(0x297)]((_0x1fdbd7,_0x356ce3)=>{var _0x1a108a=_0x3d1cf9;_0x319bd1[_0x356ce3][_0x1a108a(0x29a)]=_0x1fdbd7;}),_0x2ea18c[_0x3d1cf9(0x297)]((_0x4a6c4a,_0x568a87)=>{var _0x29d006=_0x3d1cf9;_0x319bd1[_0x568a87][_0x29d006(0x22d)]=_0x4a6c4a;}),_0x4ee492['forEach']((_0x5615a7,_0x1ef419)=>{var _0x3b4d11=_0x3d1cf9;_0x319bd1[_0x1ef419][_0x3b4d11(0x25c)]=_0x5615a7;}),_0x15101c[_0x3d1cf9(0x297)]((_0x1cbee3,_0x30eabe)=>{var _0x1d6a69=_0x3d1cf9;_0x319bd1[_0x30eabe][_0x1d6a69(0x275)]=_0x1cbee3;}),_0x2e154c['forEach']((_0x310d85,_0xc584c)=>{var _0x20b883=_0x3d1cf9;_0x319bd1[_0xc584c][_0x20b883(0x218)]=_0x310d85;});const _0x1f6ae8=_0x319bd1['filter'](_0x56a068=>_0x56a068[_0x3d1cf9(0x24a)]!=='0'&&_0x56a068[_0x3d1cf9(0x24a)]!==''),_0x451882=new purchases_finished({'invoice':_0x43e6e6,'suppliers':_0xe47651['body'][_0x3d1cf9(0x1eb)],'date':_0x480119,'warehouse_name':_0x49594a,'product':_0x1f6ae8,'note':_0x44f8f3,'due_amount':_0x1e0f3f,'room':_0x492f22,'POnumber':_0x30afd6,'SCRN':_0x2300be,'JO_number':_0x52f105}),_0x2e4342=await _0x451882[_0x3d1cf9(0x1cd)](),_0xf7fec=await purchases_finished['findOne']({'invoice':_0x43e6e6}),_0x47b05b=_0xf7fec[_0x3d1cf9(0x1c3)]['map'](async _0x3b2d04=>{var _0x3ff032=_0x3d1cf9;try{var _0x3f951c=await warehouse[_0x3ff032(0x274)]({'name':_0x49594a,'room':_0x3b2d04[_0x3ff032(0x275)]}),_0x5a84e0=0x0;const _0x3fdb11=_0x3f951c['product_details'][_0x3ff032(0x1f6)](_0x1636d5=>{var _0x2ea184=_0x3ff032;console[_0x2ea184(0x1d2)](_0x1636d5['product_name']+'=='+_0x3b2d04[_0x2ea184(0x27c)]+'&&'+_0x1636d5[_0x2ea184(0x26f)]+'=='+_0x3b2d04[_0x2ea184(0x26f)]+'&&'+_0x1636d5[_0x2ea184(0x1dd)]+'=='+_0x3b2d04[_0x2ea184(0x1dd)]+'&&'+_0x1636d5[_0x2ea184(0x29a)]+'=='+_0x3b2d04[_0x2ea184(0x29a)]+'&&'+_0x1636d5[_0x2ea184(0x26c)]+'=='+_0x3b2d04[_0x2ea184(0x26c)]+'&&'+_0x1636d5[_0x2ea184(0x218)]+'=='+_0xf7fec[_0x2ea184(0x218)]),_0x1636d5[_0x2ea184(0x27c)]==_0x3b2d04[_0x2ea184(0x27c)]&&_0x1636d5['bay']==_0x3b2d04['bay']&&_0x1636d5['expiry_date']==_0x3b2d04[_0x2ea184(0x1dd)]&&_0x1636d5[_0x2ea184(0x29a)]==_0x3b2d04['production_date']&&_0x1636d5[_0x2ea184(0x26c)]==_0x3b2d04[_0x2ea184(0x26c)]&&_0x1636d5[_0x2ea184(0x218)]==_0xf7fec[_0x2ea184(0x218)]&&(_0x1636d5['product_stock']=Math[_0x2ea184(0x256)](_0x1636d5[_0x2ea184(0x254)])+Math[_0x2ea184(0x256)](_0x3b2d04[_0x2ea184(0x24a)]),_0x5a84e0++);});return _0x5a84e0==0x0&&(_0x3f951c[_0x3ff032(0x27b)]=_0x3f951c[_0x3ff032(0x27b)][_0x3ff032(0x26b)]({'product_name':_0x3b2d04[_0x3ff032(0x27c)],'product_stock':Math[_0x3ff032(0x256)](_0x3b2d04[_0x3ff032(0x24a)]),'primary_code':_0x3b2d04[_0x3ff032(0x23b)],'secondary_code':_0x3b2d04[_0x3ff032(0x1bf)],'product_code':_0x3b2d04['product_code'],'bay':_0x3b2d04[_0x3ff032(0x26f)],'maxProducts':_0x3b2d04[_0x3ff032(0x24f)],'unit':_0x3b2d04[_0x3ff032(0x281)],'secondary_unit':_0x3b2d04['secondary_unit'],'expiry_date':_0x3b2d04[_0x3ff032(0x1dd)],'production_date':_0x3b2d04['production_date'],'maxProducts':_0x3b2d04[_0x3ff032(0x24f)],'maxPerUnit':_0x3b2d04['maxperunit'],'batch_code':_0x3b2d04['batch_code'],'product_cat':_0x3b2d04[_0x3ff032(0x25c)],'invoice':_0x3b2d04[_0x3ff032(0x218)],'id_incoming':_0x3b2d04[_0x3ff032(0x27a)]})),_0x3f951c;}catch(_0x48eba4){return console[_0x3ff032(0x1f9)]('Error\x20occurred\x20while\x20processing\x20product:',_0x48eba4),null;}});Promise[_0x3d1cf9(0x1ca)](_0x47b05b)['then'](async _0x4baa7c=>{var _0x1dfc32=_0x3d1cf9;try{for(const _0x297437 of _0x4baa7c){await warehouse[_0x1dfc32(0x290)]({'_id':_0x297437['_id']},{'$addToSet':{'product_details':{'$each':_0x297437[_0x1dfc32(0x27b)]}}});}const _0xcb3313=await master_shop[_0x1dfc32(0x1b9)](),_0x1f2475=await email_settings[_0x1dfc32(0x274)](),_0x2e02b2=await supervisor_settings[_0x1dfc32(0x1b9)]();var _0x3819af=_0xf7fec['product'],_0x195d12='',_0x3aa10a;for(_0x3aa10a in _0x3819af){var _0x5bdd29='FG';_0xf7fec[_0x1dfc32(0x248)]==_0x1dfc32(0x241)&&(_0x5bdd29='DG'),_0x195d12+='<tr>'+_0x1dfc32(0x1fb)+_0x3819af[_0x3aa10a][_0x1dfc32(0x27c)]+_0x1dfc32(0x20b)+_0x1dfc32(0x1fb)+_0x3819af[_0x3aa10a]['product_code']+_0x1dfc32(0x20b)+_0x1dfc32(0x1fb)+_0x3819af[_0x3aa10a][_0x1dfc32(0x24a)]+_0x1dfc32(0x20b)+_0x1dfc32(0x1fb)+_0x3819af[_0x3aa10a]['standard_unit']+_0x1dfc32(0x20b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3819af[_0x3aa10a][_0x1dfc32(0x1f5)]+_0x1dfc32(0x20b)+_0x1dfc32(0x1fb)+_0xf7fec[_0x1dfc32(0x248)]+_0x1dfc32(0x20b)+_0x1dfc32(0x1fb)+_0x3819af[_0x3aa10a][_0x1dfc32(0x275)]+_0x1dfc32(0x20b)+_0x1dfc32(0x1fb)+_0x5bdd29+_0x3819af[_0x3aa10a]['bay']+_0x1dfc32(0x20b),'</tr>';}let _0x4195ac=nodemailer[_0x1dfc32(0x24c)]({'host':_0x1f2475[_0x1dfc32(0x267)],'port':Number(_0x1f2475[_0x1dfc32(0x22f)]),'secure':![],'auth':{'user':_0x1f2475[_0x1dfc32(0x203)],'pass':_0x1f2475['password']}}),_0x33d252={'from':_0x1f2475[_0x1dfc32(0x203)],'to':_0x2e02b2[0x0][_0x1dfc32(0x272)],'subject':_0x1dfc32(0x21f),'attachments':[{'filename':_0x1dfc32(0x1f2),'path':__dirname+_0x1dfc32(0x298)+_0x1dfc32(0x25b)+_0xcb3313[0x0][_0x1dfc32(0x282)],'cid':_0x1dfc32(0x216)}],'html':_0x1dfc32(0x1a9)+_0x1dfc32(0x240)+'</head><body>'+_0x1dfc32(0x287)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1dfc32(0x287)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1dfc32(0x1e7)+'<div>'+'<h2>\x20'+_0xcb3313[0x0]['site_title']+_0x1dfc32(0x20a)+'</div>'+'</div>'+_0x1dfc32(0x1ac)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1dfc32(0x224)+_0xf7fec['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0xf7fec['date']+'\x20'+'</span>'+'</h5>'+_0x1dfc32(0x1e7)+_0x1dfc32(0x21e)+_0x1dfc32(0x26d)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x1dfc32(0x1bc)+_0x1dfc32(0x20e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x1dfc32(0x270)+_0x1dfc32(0x249)+_0x1dfc32(0x286)+_0x1dfc32(0x1b6)+_0x1dfc32(0x269)+_0x1dfc32(0x276)+'\x20'+_0x195d12+'\x20'+_0x1dfc32(0x253)+_0x1dfc32(0x1f4)+_0x1dfc32(0x287)+_0x1dfc32(0x25a)+_0x1dfc32(0x202)+_0xcb3313[0x0][_0x1dfc32(0x238)]+'</h5>'+_0x1dfc32(0x1e7)+'</div>'+_0x1dfc32(0x268)};_0x4195ac[_0x1dfc32(0x1c9)](_0x33d252,function(_0x1a855d,_0x4c727c){var _0x434536=_0x1dfc32;_0x1a855d?(console[_0x434536(0x1d2)](_0x1a855d),console[_0x434536(0x1d2)](_0x434536(0x289))):console[_0x434536(0x1d2)](_0x434536(0x23f));});}catch(_0xf975be){console[_0x1dfc32(0x1f9)](_0xf975be),_0x3b3eb5[_0x1dfc32(0x277)](0x1f4)[_0x1dfc32(0x206)]({'error':_0x1dfc32(0x207),'message':_0xf975be['message']});}})[_0x3d1cf9(0x1bd)](_0x111fcd=>{var _0xedd839=_0x3d1cf9;console[_0xedd839(0x1f9)](_0x111fcd);}),_0xe47651['flash'](_0x3d1cf9(0x1b4),'purchase\x20data\x20add\x20successfully'),_0x3b3eb5[_0x3d1cf9(0x1d7)]('/all_purchases_finished/view');}catch(_0x2410a6){console[_0x3d1cf9(0x1d2)](_0x2410a6);}}),router[a0_0x41a8f0(0x1e2)](a0_0x41a8f0(0x214),auth,async(_0x5318da,_0x1b0dca)=>{var _0x52d1fe=a0_0x41a8f0;try{const {username:_0x24bdbd,email:_0x5d4463,role:_0x5981bb}=_0x5318da[_0x52d1fe(0x26e)],_0xe428e9=_0x5318da[_0x52d1fe(0x26e)],_0xdb37c9=await profile[_0x52d1fe(0x274)]({'email':_0xe428e9[_0x52d1fe(0x203)]}),_0x2ac0fd=await master_shop[_0x52d1fe(0x1b9)](),_0x1be512=_0x5318da[_0x52d1fe(0x266)]['id'],_0x4e9c4a=await purchases_finished['findById'](_0x1be512),_0x4d1db7=await suppliers[_0x52d1fe(0x1b9)]({});let _0x20e552;if(_0xe428e9[_0x52d1fe(0x1ec)]==_0x52d1fe(0x23c)){const _0xed6bdb=await staff[_0x52d1fe(0x274)]({'email':_0xe428e9[_0x52d1fe(0x203)]});_0x20e552=await warehouse['find']({'status':_0x52d1fe(0x21d),'name':_0xed6bdb[_0x52d1fe(0x231)],'warehouse_category':_0x52d1fe(0x1de)});}else _0x20e552=await warehouse[_0x52d1fe(0x294)]([{'$match':{'status':_0x52d1fe(0x21d),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x52d1fe(0x1db),'name':{'$first':_0x52d1fe(0x1db)}}}]);const _0x1f7dc1=await product[_0x52d1fe(0x1b9)]({}),_0x16f5e2=BayBinSelected(_0x4e9c4a[_0x52d1fe(0x248)],_0x4e9c4a[_0x52d1fe(0x295)]);let _0x4e207a=new Date(_0x4e9c4a[_0x52d1fe(0x1dd)]),_0x5c7c68=('0'+_0x4e207a[_0x52d1fe(0x285)]())[_0x52d1fe(0x278)](-0x2),_0x42fa1b=('0'+(_0x4e207a[_0x52d1fe(0x1b8)]()+0x1))['slice'](-0x2),_0x2b2902=_0x4e207a['getFullYear'](),_0x2897ff=_0x2b2902+'-'+_0x42fa1b+'-'+_0x5c7c68;if(_0x2ac0fd[0x0][_0x52d1fe(0x1c4)]==_0x52d1fe(0x28e)){var _0x2ce29f=users['English'];console[_0x52d1fe(0x1d2)](_0x2ce29f);}else{if(_0x2ac0fd[0x0][_0x52d1fe(0x1c4)]=='Hindi')var _0x2ce29f=users[_0x52d1fe(0x29c)];else{if(_0x2ac0fd[0x0]['language']==_0x52d1fe(0x1aa))var _0x2ce29f=users[_0x52d1fe(0x1aa)];else{if(_0x2ac0fd[0x0][_0x52d1fe(0x1c4)]==_0x52d1fe(0x230))var _0x2ce29f=users['Spanish'];else{if(_0x2ac0fd[0x0]['language']==_0x52d1fe(0x1b2))var _0x2ce29f=users[_0x52d1fe(0x1b2)];else{if(_0x2ac0fd[0x0][_0x52d1fe(0x1c4)]==_0x52d1fe(0x29f))var _0x2ce29f=users[_0x52d1fe(0x1b7)];else{if(_0x2ac0fd[0x0]['language']==_0x52d1fe(0x296))var _0x2ce29f=users['Chinese'];else{if(_0x2ac0fd[0x0][_0x52d1fe(0x1c4)]==_0x52d1fe(0x1d8))var _0x2ce29f=users[_0x52d1fe(0x1cc)];}}}}}}}_0x1b0dca[_0x52d1fe(0x28f)](_0x52d1fe(0x1fa),{'success':_0x5318da['flash'](_0x52d1fe(0x1b4)),'errors':_0x5318da[_0x52d1fe(0x1fe)]('errors'),'role':_0xe428e9,'profile':_0xdb37c9,'purchases':_0x4e9c4a,'suppliers':_0x4d1db7,'warehouse':_0x20e552,'product':_0x1f7dc1,'master_shop':_0x2ac0fd,'language':_0x2ce29f,'ed_fullDate':_0x2897ff,'dataSelected':_0x16f5e2});}catch(_0x3372aa){console[_0x52d1fe(0x1d2)](_0x3372aa);}}),router[a0_0x41a8f0(0x1e2)]('/view/:id',auth,async(_0x6e1727,_0x206e59)=>{var _0x2265dc=a0_0x41a8f0;try{const {username:_0x3136b1,email:_0x2e956a,role:_0x337ab3}=_0x6e1727['user'],_0x36152d=_0x6e1727['user'],_0x175c3c=await profile[_0x2265dc(0x274)]({'email':_0x36152d[_0x2265dc(0x203)]}),_0x39c17a=await master_shop[_0x2265dc(0x1b9)](),_0x4b3c0d=_0x6e1727[_0x2265dc(0x266)]['id'],_0xcd2b66=await purchases_finished[_0x2265dc(0x1e5)](_0x4b3c0d),_0xdb11b0=await suppliers[_0x2265dc(0x1b9)]({});let _0x32d45e;if(_0x36152d[_0x2265dc(0x1ec)]==_0x2265dc(0x23c)){const _0x552d04=await staff[_0x2265dc(0x274)]({'email':_0x36152d['email']});_0x32d45e=await warehouse[_0x2265dc(0x1b9)]({'status':_0x2265dc(0x21d),'name':_0x552d04[_0x2265dc(0x231)],'warehouse_category':'Finished\x20Goods'});}else _0x32d45e=await warehouse[_0x2265dc(0x294)]([{'$match':{'status':_0x2265dc(0x21d),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x2265dc(0x1db)}}}]);const _0x1ef422=await product[_0x2265dc(0x1b9)]({}),_0x9087f5=BayBinSelected(_0xcd2b66[_0x2265dc(0x248)],_0xcd2b66[_0x2265dc(0x295)]);let _0x1db603=new Date(_0xcd2b66[_0x2265dc(0x1dd)]),_0x7b343f=('0'+_0x1db603[_0x2265dc(0x285)]())['slice'](-0x2),_0xf12992=('0'+(_0x1db603[_0x2265dc(0x1b8)]()+0x1))[_0x2265dc(0x278)](-0x2),_0x94514f=_0x1db603[_0x2265dc(0x235)](),_0x94aa5f=_0x94514f+'-'+_0xf12992+'-'+_0x7b343f;if(_0x39c17a[0x0]['language']==_0x2265dc(0x28e)){var _0x19dc67=users[_0x2265dc(0x260)];console['log'](_0x19dc67);}else{if(_0x39c17a[0x0][_0x2265dc(0x1c4)]=='Hindi')var _0x19dc67=users['Hindi'];else{if(_0x39c17a[0x0]['language']=='German')var _0x19dc67=users[_0x2265dc(0x1aa)];else{if(_0x39c17a[0x0]['language']==_0x2265dc(0x230))var _0x19dc67=users[_0x2265dc(0x230)];else{if(_0x39c17a[0x0][_0x2265dc(0x1c4)]=='French')var _0x19dc67=users[_0x2265dc(0x1b2)];else{if(_0x39c17a[0x0][_0x2265dc(0x1c4)]=='Portuguese\x20(BR)')var _0x19dc67=users['Portuguese'];else{if(_0x39c17a[0x0][_0x2265dc(0x1c4)]==_0x2265dc(0x296))var _0x19dc67=users['Chinese'];else{if(_0x39c17a[0x0][_0x2265dc(0x1c4)]==_0x2265dc(0x1d8))var _0x19dc67=users[_0x2265dc(0x1cc)];}}}}}}}_0x206e59[_0x2265dc(0x28f)]('edit_purchases_finished',{'success':_0x6e1727[_0x2265dc(0x1fe)](_0x2265dc(0x1b4)),'errors':_0x6e1727[_0x2265dc(0x1fe)](_0x2265dc(0x1b3)),'role':_0x36152d,'profile':_0x175c3c,'purchases':_0xcd2b66,'suppliers':_0xdb11b0,'warehouse':_0x32d45e,'product':_0x1ef422,'master_shop':_0x39c17a,'language':_0x19dc67,'ed_fullDate':_0x94aa5f,'dataSelected':_0x9087f5});}catch(_0x184b4f){console['log'](_0x184b4f);}}),router['post']('/view/:id',auth,async(_0x501d0a,_0x4e0209)=>{var _0x978a63=a0_0x41a8f0;try{const _0x1afb57=_0x501d0a[_0x978a63(0x266)]['id'],_0x33b895=await purchases_finished[_0x978a63(0x274)]({'_id':_0x501d0a[_0x978a63(0x266)]['id']}),_0x16bcc1=await warehouse[_0x978a63(0x274)]({'name':_0x33b895[_0x978a63(0x248)],'room':_0x33b895[_0x978a63(0x295)]});_0x33b895[_0x978a63(0x1c3)][_0x978a63(0x297)](_0x30d1d8=>{var _0x237181=_0x978a63;const _0x2792b7=_0x16bcc1[_0x237181(0x27b)]['map'](_0x44a68f=>{var _0x304a32=_0x237181;_0x44a68f[_0x304a32(0x27c)]==_0x30d1d8[_0x304a32(0x27c)]&&_0x44a68f[_0x304a32(0x26f)]==_0x30d1d8[_0x304a32(0x26f)]&&(_0x44a68f[_0x304a32(0x254)]=parseInt(_0x44a68f[_0x304a32(0x254)])-parseInt(_0x30d1d8[_0x304a32(0x24a)]));});}),await _0x16bcc1['save']();const {invoice:_0x30b710,suppliers:_0x4dc512,date:_0x25133b,warehouse_name:_0x1f1904,prod_name:_0xe508f6,prod_code:_0x40f672,prod_qty:_0x71b4ec,prod_unit:_0x4f4ac3,prod_secondunit:_0x281a1e,prod_level:_0x15b451,prod_isle:_0x2cafb9,prod_pallet:_0x59db14,note:_0x4718a9,expiry_date:_0x3f4b18,batch_code:_0x20a9cc,paid_amount:_0x3d1d76,due_amount:_0x5cac58,Room_name:_0x194192,primary_code:_0x3ee095,secondary_code:_0x436a6c,PO_number:_0x10ed50,JO_number:_0x4f78ef}=_0x501d0a[_0x978a63(0x28b)];if(typeof _0xe508f6==_0x978a63(0x1e0))var _0x3372f2=[_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x29b)]],_0x4f0f1e=[_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x223)]],_0x29f45f=[_0x501d0a['body']['prod_qty']],_0xfa5902=[_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x200)]],_0x4b9d8d=[_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x27f)]],_0x321309=[_0x501d0a['body'][_0x978a63(0x225)]],_0x1aab30=[_0x501d0a['body'][_0x978a63(0x23b)]],_0x474514=[_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x1bf)]],_0xe5e898=[_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x219)]],_0x362689=[_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x26c)]],_0x101159=[_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x1dd)]];else var _0x3372f2=[..._0x501d0a[_0x978a63(0x28b)][_0x978a63(0x29b)]],_0x4f0f1e=[..._0x501d0a[_0x978a63(0x28b)][_0x978a63(0x223)]],_0x29f45f=[..._0x501d0a[_0x978a63(0x28b)][_0x978a63(0x1c6)]],_0xfa5902=[..._0x501d0a[_0x978a63(0x28b)]['prod_unit']],_0x4b9d8d=[..._0x501d0a['body'][_0x978a63(0x27f)]],_0x321309=[..._0x501d0a['body'][_0x978a63(0x225)]],_0x1aab30=[..._0x501d0a['body'][_0x978a63(0x23b)]],_0x474514=[..._0x501d0a['body']['secondary_code']],_0xe5e898=[..._0x501d0a[_0x978a63(0x28b)][_0x978a63(0x219)]],_0x362689=[..._0x501d0a['body'][_0x978a63(0x26c)]],_0x101159=[..._0x501d0a[_0x978a63(0x28b)]['expiry_date']];const _0x4bfd6c=_0x3372f2[_0x978a63(0x1f6)](_0xfa9248=>{return _0xfa9248={'product_name':_0xfa9248};});_0x4f0f1e['forEach']((_0x3f4484,_0x36a180)=>{var _0x255a78=_0x978a63;_0x4bfd6c[_0x36a180][_0x255a78(0x227)]=_0x3f4484;}),_0x29f45f[_0x978a63(0x297)]((_0x7c7d9a,_0x321258)=>{var _0x5e35d5=_0x978a63;_0x4bfd6c[_0x321258][_0x5e35d5(0x24a)]=_0x7c7d9a;}),_0xfa5902[_0x978a63(0x297)]((_0x53227a,_0xf283)=>{var _0x46eaaf=_0x978a63;_0x4bfd6c[_0xf283][_0x46eaaf(0x281)]=_0x53227a;}),_0x4b9d8d[_0x978a63(0x297)]((_0x268a67,_0x24cb2e)=>{var _0x5a530d=_0x978a63;_0x4bfd6c[_0x24cb2e][_0x5a530d(0x1f5)]=_0x268a67;}),_0x321309['forEach']((_0x29d3e2,_0x2533fc)=>{var _0x4f8022=_0x978a63;_0x4bfd6c[_0x2533fc][_0x4f8022(0x26f)]=_0x29d3e2;}),_0x1aab30[_0x978a63(0x297)]((_0x323be9,_0x585a44)=>{var _0x1a82ce=_0x978a63;_0x4bfd6c[_0x585a44][_0x1a82ce(0x23b)]=_0x323be9;}),_0x474514[_0x978a63(0x297)]((_0x3d28e6,_0x23b128)=>{var _0x1e6c1a=_0x978a63;_0x4bfd6c[_0x23b128][_0x1e6c1a(0x1bf)]=_0x3d28e6;}),_0xe5e898[_0x978a63(0x297)]((_0x567193,_0x3e5acd)=>{var _0x950ee7=_0x978a63;_0x4bfd6c[_0x3e5acd][_0x950ee7(0x24f)]=_0x567193;}),_0x362689[_0x978a63(0x297)]((_0x27f9ff,_0x2658a1)=>{_0x4bfd6c[_0x2658a1]['batch_code']=_0x27f9ff;}),_0x101159[_0x978a63(0x297)]((_0xa6a4e7,_0x413da7)=>{_0x4bfd6c[_0x413da7]['expiry_date']=_0xa6a4e7;});const _0x33a68c=_0x4bfd6c[_0x978a63(0x245)](_0x19117d=>_0x19117d[_0x978a63(0x24a)]!=='0'&&_0x19117d['quantity']!=='');_0x33b895[_0x978a63(0x218)]=_0x30b710,_0x33b895[_0x978a63(0x1eb)]=_0x4dc512,_0x33b895[_0x978a63(0x1e9)]=_0x25133b,_0x33b895[_0x978a63(0x248)]=_0x1f1904,_0x33b895[_0x978a63(0x1c3)]=_0x33a68c,_0x33b895[_0x978a63(0x250)]=_0x4718a9,_0x33b895[_0x978a63(0x1a8)]=_0x3d1d76,_0x33b895[_0x978a63(0x22e)]=_0x5cac58,_0x33b895[_0x978a63(0x295)]=_0x194192,_0x33b895['POnumber']=_0x10ed50,_0x33b895[_0x978a63(0x28d)]=_0x4f78ef;const _0x65c950=await _0x33b895[_0x978a63(0x1cd)](),_0x1840d4=await warehouse[_0x978a63(0x274)]({'name':_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x248)],'room':_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x242)]});_0x33b895[_0x978a63(0x1c3)][_0x978a63(0x297)](_0x3a26a9=>{var _0x4c01d2=_0x978a63,_0x18720b=0x0;const _0x273bae=_0x1840d4[_0x4c01d2(0x27b)][_0x4c01d2(0x1f6)](_0x5de244=>{var _0x3daebc=_0x4c01d2;_0x5de244[_0x3daebc(0x27c)]==_0x3a26a9[_0x3daebc(0x27c)]&&_0x5de244[_0x3daebc(0x26f)]==_0x3a26a9[_0x3daebc(0x26f)]&&(_0x5de244[_0x3daebc(0x254)]=parseInt(_0x5de244[_0x3daebc(0x254)])+parseInt(_0x3a26a9[_0x3daebc(0x24a)]),_0x18720b++);});_0x18720b=='0'&&(_0x1840d4['product_details']=_0x1840d4['product_details'][_0x4c01d2(0x26b)]({'product_name':_0x3a26a9[_0x4c01d2(0x27c)],'product_stock':_0x3a26a9[_0x4c01d2(0x24a)],'primary_code':_0x3a26a9['primary_code'],'secondary_code':_0x3a26a9['secondary_code'],'product_code':_0x3a26a9[_0x4c01d2(0x227)],'bay':_0x3a26a9['bay'],'maxProducts':_0x3a26a9[_0x4c01d2(0x24f)],'unit':_0x3a26a9[_0x4c01d2(0x281)],'secondary_unit':_0x3a26a9[_0x4c01d2(0x1f5)],'expiry_date':_0x3a26a9[_0x4c01d2(0x1dd)]}));}),await _0x1840d4[_0x978a63(0x1cd)]();const _0x1f1554=await s_payment_data[_0x978a63(0x274)]({'invoice':_0x501d0a[_0x978a63(0x28b)][_0x978a63(0x218)]});if(_0x1f1554===null){}else console[_0x978a63(0x1d2)](_0x978a63(0x1eb),_0x1f1554,_0x501d0a['body'][_0x978a63(0x218)]),_0x1f1554['suppliers']=_0x501d0a[_0x978a63(0x28b)]['suppliers'],await _0x1f1554['save']();_0x501d0a['flash']('success','purchase\x20data\x20update\x20successfully'),_0x4e0209[_0x978a63(0x1d7)](_0x978a63(0x261));}catch(_0x1ca1c9){console[_0x978a63(0x1d2)](_0x1ca1c9);}}),router[a0_0x41a8f0(0x1cb)]('/give_payment/:id',auth,async(_0x152d91,_0x4185a5)=>{var _0x5073fa=a0_0x41a8f0;try{const _0x1305f7=_0x152d91[_0x5073fa(0x266)]['id'],{invoice:_0x258848,suppliers:_0x2cea61,payable:_0x2aac65,due_amount:_0x255b8c}=_0x152d91['body'],_0x27f960=await purchases['findById'](_0x1305f7);var _0x57f134=_0x2aac65-_0x255b8c;_0x27f960[_0x5073fa(0x1a8)]=parseFloat(_0x27f960[_0x5073fa(0x1a8)])+parseFloat(_0x255b8c),_0x27f960[_0x5073fa(0x22e)]=_0x57f134;const _0x22c525=await _0x27f960[_0x5073fa(0x1cd)]();console['log'](_0x22c525);const _0x217a97=await s_payment_data[_0x5073fa(0x274)]({'invoice':_0x258848});_0x217a97[_0x5073fa(0x1ba)]=_0x57f134,await _0x217a97[_0x5073fa(0x1cd)]();let _0x20dc7c=new Date(),_0x482257=('0'+_0x20dc7c[_0x5073fa(0x285)]())[_0x5073fa(0x278)](-0x2),_0x76d6d8=('0'+(_0x20dc7c[_0x5073fa(0x1b8)]()+0x1))[_0x5073fa(0x278)](-0x2),_0x399ef8=_0x20dc7c[_0x5073fa(0x235)](),_0x1820bb=_0x399ef8+'-'+_0x76d6d8+'-'+_0x482257;const _0xf3075e=new suppliers_payment({'invoice':_0x258848,'date':_0x399ef8+'-'+_0x76d6d8+'-'+_0x482257,'suppliers':_0x2cea61,'reason':_0x5073fa(0x1be),'amount':_0x255b8c}),_0x402bb6=await _0xf3075e[_0x5073fa(0x1cd)]();_0x152d91[_0x5073fa(0x1fe)](_0x5073fa(0x1b4),_0x5073fa(0x292)),_0x4185a5[_0x5073fa(0x1d7)](_0x5073fa(0x204));}catch(_0x552d6f){console[_0x5073fa(0x1d2)](_0x552d6f);}}),router[a0_0x41a8f0(0x1e2)](a0_0x41a8f0(0x1a7),auth,async(_0x3238e6,_0x140ca8)=>{var _0x369952=a0_0x41a8f0;try{const {username:_0x35fb2f,email:_0x386e6a,role:_0x3e2886}=_0x3238e6[_0x369952(0x26e)],_0x58e6d5=_0x3238e6['user'],_0x237c77=await profile[_0x369952(0x274)]({'email':_0x58e6d5['email']}),_0x3f021a=await master_shop[_0x369952(0x1b9)]();console[_0x369952(0x1d2)](_0x369952(0x27e),_0x3f021a);const _0x39bf18=_0x3238e6[_0x369952(0x266)]['id'],_0x406859=await purchases['findById'](_0x39bf18);console['log'](_0x406859);const _0xeb0f9e=await suppliers[_0x369952(0x274)]({'name':_0x406859[_0x369952(0x1eb)]});console[_0x369952(0x1d2)](_0xeb0f9e);if(_0x3f021a[0x0]['language']==_0x369952(0x28e)){var _0x14c463=users[_0x369952(0x260)];console['log'](_0x14c463);}else{if(_0x3f021a[0x0][_0x369952(0x1c4)]=='Hindi')var _0x14c463=users[_0x369952(0x29c)];else{if(_0x3f021a[0x0][_0x369952(0x1c4)]==_0x369952(0x1aa))var _0x14c463=users[_0x369952(0x1aa)];else{if(_0x3f021a[0x0][_0x369952(0x1c4)]==_0x369952(0x230))var _0x14c463=users[_0x369952(0x230)];else{if(_0x3f021a[0x0][_0x369952(0x1c4)]==_0x369952(0x1b2))var _0x14c463=users['French'];else{if(_0x3f021a[0x0]['language']==_0x369952(0x29f))var _0x14c463=users[_0x369952(0x1b7)];else{if(_0x3f021a[0x0][_0x369952(0x1c4)]==_0x369952(0x296))var _0x14c463=users[_0x369952(0x296)];else{if(_0x3f021a[0x0][_0x369952(0x1c4)]=='Arabic\x20(ae)')var _0x14c463=users[_0x369952(0x1cc)];}}}}}}}_0x140ca8[_0x369952(0x28f)](_0x369952(0x21c),{'success':_0x3238e6[_0x369952(0x1fe)](_0x369952(0x1b4)),'errors':_0x3238e6[_0x369952(0x1fe)](_0x369952(0x1b3)),'role':_0x58e6d5,'profile':_0x237c77,'master_shop':_0x3f021a,'supplier':_0xeb0f9e,'purchase':_0x406859,'language':_0x14c463});}catch(_0x26c5ec){console[_0x369952(0x1d2)](_0x26c5ec);}}),router[a0_0x41a8f0(0x1e2)]('/view/return_purchase/:id',auth,async(_0x258066,_0x3bbd69)=>{var _0x19da96=a0_0x41a8f0;try{const {username:_0x84911c,email:_0x23ede1,role:_0x25ce1e}=_0x258066[_0x19da96(0x26e)],_0x745b6b=_0x258066[_0x19da96(0x26e)],_0x20aa1f=await profile['findOne']({'email':_0x745b6b[_0x19da96(0x203)]}),_0x25f3ad=await master_shop[_0x19da96(0x1b9)]();console[_0x19da96(0x1d2)](_0x19da96(0x27e),_0x25f3ad);const _0x4c3aa2=_0x258066[_0x19da96(0x266)]['id'];console[_0x19da96(0x1d2)](_0x4c3aa2);const _0x1749f8=await purchases_finished[_0x19da96(0x1e5)](_0x4c3aa2);console[_0x19da96(0x1d2)](_0x19da96(0x1ad),_0x1749f8);const _0x2b27d4=await product[_0x19da96(0x1b9)]({}),_0x207409=await warehouse[_0x19da96(0x294)]([{'$match':{'name':_0x1749f8['warehouse_name'],'room':_0x1749f8[_0x19da96(0x295)]}},{'$unwind':_0x19da96(0x1fd)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x19da96(0x1f0)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x19da96(0x1f1)},'floorlevel':{'$first':_0x19da96(0x247)},'primary_code':{'$first':_0x19da96(0x299)},'secondary_code':{'$first':_0x19da96(0x2a1)},'product_code':{'$first':_0x19da96(0x234)},'storage':{'$first':_0x19da96(0x20d)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x19da96(0x1d2)]('stock_data',_0x207409);let _0x125332;if(_0x745b6b[_0x19da96(0x1ec)]==_0x19da96(0x23c)){const _0xaf9ea4=await staff['findOne']({'email':_0x745b6b[_0x19da96(0x203)]});_0x125332=await warehouse[_0x19da96(0x1b9)]({'status':_0x19da96(0x21d),'name':_0xaf9ea4['warehouse'],'warehouse_category':_0x19da96(0x1de),'name':_0x19da96(0x1f7)});}else _0x125332=await warehouse['aggregate']([{'$match':{'status':_0x19da96(0x21d),'warehouse_category':_0x19da96(0x1de),'name':_0x19da96(0x1f7)}},{'$group':{'_id':_0x19da96(0x1db),'name':{'$first':'$name'}}}]);if(_0x25f3ad[0x0][_0x19da96(0x1c4)]==_0x19da96(0x28e)){var _0x54d25d=users[_0x19da96(0x260)];console['log'](_0x54d25d);}else{if(_0x25f3ad[0x0][_0x19da96(0x1c4)]==_0x19da96(0x29c))var _0x54d25d=users[_0x19da96(0x29c)];else{if(_0x25f3ad[0x0][_0x19da96(0x1c4)]==_0x19da96(0x1aa))var _0x54d25d=users['German'];else{if(_0x25f3ad[0x0]['language']==_0x19da96(0x230))var _0x54d25d=users[_0x19da96(0x230)];else{if(_0x25f3ad[0x0][_0x19da96(0x1c4)]==_0x19da96(0x1b2))var _0x54d25d=users[_0x19da96(0x1b2)];else{if(_0x25f3ad[0x0][_0x19da96(0x1c4)]==_0x19da96(0x29f))var _0x54d25d=users['Portuguese'];else{if(_0x25f3ad[0x0]['language']==_0x19da96(0x296))var _0x54d25d=users[_0x19da96(0x296)];else{if(_0x25f3ad[0x0][_0x19da96(0x1c4)]==_0x19da96(0x1d8))var _0x54d25d=users[_0x19da96(0x1cc)];}}}}}}}_0x3bbd69[_0x19da96(0x28f)]('return_purchase_finished',{'success':_0x258066[_0x19da96(0x1fe)](_0x19da96(0x1b4)),'errors':_0x258066['flash'](_0x19da96(0x1b3)),'role':_0x745b6b,'profile':_0x20aa1f,'user':_0x1749f8,'stock':_0x207409,'master_shop':_0x25f3ad,'product':_0x2b27d4,'language':_0x54d25d,'warehouse':_0x125332});}catch(_0x1cdb82){console[_0x19da96(0x1d2)](_0x1cdb82);}}),router[a0_0x41a8f0(0x1cb)](a0_0x41a8f0(0x1d5),auth,async(_0x433fba,_0x3ac2e8)=>{var _0x38206b=a0_0x41a8f0;try{const {invoice:_0x52dea0,date:_0x3eb7fb,warehouse_name:_0x2b387e,Room_name:_0x405020,product_name:_0x3d3b3e,purchase_quantity:_0x159a6a,stocks:_0x1ac6a3,return_qty:_0x58f02e,note:_0x30f1ea,level:_0x2f522d,isle:_0x343084,pallet:_0x1f5f68,to_warehouse_name:_0x21d627,to_Room_name:_0xc326ce}=_0x433fba[_0x38206b(0x28b)],_0x357153=await purchases_finished[_0x38206b(0x274)]({'_id':_0x433fba[_0x38206b(0x266)]['id']}),_0x543d06=await warehouse[_0x38206b(0x274)]({'name':_0x2b387e,'room':_0x405020,'warehouse_category':_0x38206b(0x1de)});if(typeof _0x3d3b3e=='string')var _0x36904f=[_0x433fba[_0x38206b(0x28b)][_0x38206b(0x27c)]],_0x1be75=[_0x433fba[_0x38206b(0x28b)]['purchase_quantity']],_0x5cbf4d=[_0x433fba['body']['stocks']],_0x1d590b=[_0x433fba['body']['return_qty']],_0x423b20=[_0x433fba[_0x38206b(0x28b)][_0x38206b(0x22c)]],_0x3dead6=[_0x433fba['body'][_0x38206b(0x1d1)]],_0x448073=[_0x433fba[_0x38206b(0x28b)]['primary_code_hide']],_0x28a13d=[_0x433fba['body'][_0x38206b(0x284)]];else var _0x36904f=[..._0x433fba[_0x38206b(0x28b)][_0x38206b(0x27c)]],_0x1be75=[..._0x433fba['body'][_0x38206b(0x1df)]],_0x5cbf4d=[..._0x433fba[_0x38206b(0x28b)][_0x38206b(0x1e6)]],_0x1d590b=[..._0x433fba[_0x38206b(0x28b)][_0x38206b(0x1f3)]],_0x423b20=[..._0x433fba['body']['level']],_0x3dead6=[..._0x433fba[_0x38206b(0x28b)][_0x38206b(0x1d1)]],_0x448073=[..._0x433fba[_0x38206b(0x28b)][_0x38206b(0x1c0)]],_0x28a13d=[..._0x433fba[_0x38206b(0x28b)][_0x38206b(0x284)]];const _0x395d2e=_0x36904f[_0x38206b(0x1f6)](_0x1f0b9a=>{return _0x1f0b9a={'product_name':_0x1f0b9a};});_0x1be75[_0x38206b(0x297)]((_0x21b768,_0x132dc3)=>{var _0x1dbed4=_0x38206b;_0x395d2e[_0x132dc3][_0x1dbed4(0x1df)]=_0x21b768;}),_0x5cbf4d[_0x38206b(0x297)]((_0x4f1222,_0x3d6ada)=>{var _0x5d99ec=_0x38206b;_0x395d2e[_0x3d6ada][_0x5d99ec(0x208)]=_0x4f1222;}),_0x1d590b['forEach']((_0x2a2dbe,_0x34653a)=>{var _0x3ad9d3=_0x38206b;_0x395d2e[_0x34653a][_0x3ad9d3(0x1f3)]=_0x2a2dbe;}),_0x423b20[_0x38206b(0x297)]((_0x31d3c3,_0x2db325)=>{_0x395d2e[_0x2db325]['bay']=_0x31d3c3;}),_0x3dead6[_0x38206b(0x297)]((_0xaf79d7,_0x1ac630)=>{_0x395d2e[_0x1ac630]['product_code']=_0xaf79d7;}),_0x448073['forEach']((_0x5ab9c4,_0x5ef675)=>{var _0x3ed36c=_0x38206b;_0x395d2e[_0x5ef675][_0x3ed36c(0x23b)]=_0x5ab9c4;}),_0x28a13d[_0x38206b(0x297)]((_0x331dde,_0x18d09a)=>{var _0x26dce7=_0x38206b;_0x395d2e[_0x18d09a][_0x26dce7(0x1bf)]=_0x331dde;}),_0x395d2e[_0x38206b(0x297)](_0x3aca18=>{var _0x343285=_0x38206b;console[_0x343285(0x1d2)](_0x3aca18);const _0x2de8e6=_0x543d06[_0x343285(0x27b)][_0x343285(0x1f6)](_0x513854=>{var _0x196b18=_0x343285;_0x513854[_0x196b18(0x27c)]==_0x3aca18[_0x196b18(0x27c)]&&_0x513854[_0x196b18(0x26f)]==_0x3aca18[_0x196b18(0x26f)]&&(console['log'](parseInt(_0x513854['product_stock'])+_0x196b18(0x246)+parseInt(_0x3aca18[_0x196b18(0x1f3)])),_0x513854[_0x196b18(0x254)]=parseInt(_0x513854['product_stock'])-parseInt(_0x3aca18['return_qty']));});}),await _0x543d06['save']();var _0x5acddd=0x0;_0x395d2e['forEach'](_0x139ea9=>{var _0x474300=_0x38206b;(parseInt(_0x139ea9[_0x474300(0x1df)])<parseInt(_0x139ea9[_0x474300(0x1f3)])||parseInt(_0x139ea9['stock_quantity'])<parseInt(_0x139ea9[_0x474300(0x1f3)]))&&_0x5acddd++;});if(_0x5acddd!=0x0)return _0x433fba[_0x38206b(0x1fe)](_0x38206b(0x1b3),_0x38206b(0x23e)),_0x3ac2e8[_0x38206b(0x1d7)]('back');const _0x54d817=new purchases_return_finished({'invoice':_0x52dea0,'suppliers':_0x433fba['body'][_0x38206b(0x1eb)],'date':_0x3eb7fb,'warehouse_name':_0x2b387e,'return_product':_0x395d2e,'note':_0x30f1ea,'room':_0x405020,'to_warehouse_name':_0x21d627,'to_room':_0xc326ce}),_0x558b9e=await _0x54d817[_0x38206b(0x1cd)](),_0xaf01f7=await purchases_return_finished[_0x38206b(0x274)]({'invoice':_0x52dea0}),_0x2c8ec5=await warehouse[_0x38206b(0x274)]({'name':_0x21d627,'room':_0xc326ce,'warehouse_category':_0x38206b(0x1de)});_0xaf01f7['return_product'][_0x38206b(0x297)](_0x3a6d23=>{var _0xed16fe=_0x38206b,_0x3e2a3f=0x0;const _0x51e2c0=_0x2c8ec5[_0xed16fe(0x27b)][_0xed16fe(0x1f6)](_0x587500=>{var _0x3c56a6=_0xed16fe;console['log'](_0x587500['product_name']+'=='+_0x3a6d23[_0x3c56a6(0x27c)]+'&&'+_0x587500['bay']+'=='+_0x3a6d23[_0x3c56a6(0x26f)]),_0x587500[_0x3c56a6(0x27c)]==_0x3a6d23['product_name']&&_0x587500['bay']==_0x3a6d23[_0x3c56a6(0x26f)]&&(_0x587500[_0x3c56a6(0x254)]=parseInt(_0x587500[_0x3c56a6(0x254)])-parseInt(_0x3a6d23[_0x3c56a6(0x1f3)]),_0x3e2a3f++);});_0x3e2a3f=='0'&&(_0x2c8ec5['product_details']=_0x2c8ec5['product_details'][_0xed16fe(0x26b)]({'product_name':_0x3a6d23[_0xed16fe(0x27c)],'product_stock':_0x3a6d23[_0xed16fe(0x1f3)],'primary_code':_0x3a6d23['primary_code'],'secondary_code':_0x3a6d23[_0xed16fe(0x1bf)],'product_code':_0x3a6d23[_0xed16fe(0x227)],'bay':_0x3a6d23[_0xed16fe(0x26f)],'maxProducts':0xf423f}));}),await _0x2c8ec5[_0x38206b(0x1cd)]();const _0x2925cb=await purchases_finished[_0x38206b(0x274)]({'invoice':_0x52dea0});_0x2925cb[_0x38206b(0x280)]=_0x38206b(0x23d);const _0x24c4bc=await _0x2925cb[_0x38206b(0x1cd)](),_0x111214=new s_payment_data({'invoice':_0x52dea0,'suppliers':_0x433fba[_0x38206b(0x28b)][_0x38206b(0x1eb)],'reason':'Purchase\x20Return'});await _0x111214['save']();const _0x23ac33=await master_shop[_0x38206b(0x1b9)](),_0x47004d=await email_settings[_0x38206b(0x274)](),_0x3cf515=await suppliers[_0x38206b(0x274)]({'name':_0x433fba[_0x38206b(0x28b)][_0x38206b(0x1eb)]});_0x23ac33[0x0][_0x38206b(0x228)]==0x1?(right_currency=_0x23ac33[0x0][_0x38206b(0x1ea)],left_currency=''):(right_currency='',left_currency=_0x23ac33[0x0][_0x38206b(0x1ea)]);var _0x287bf6=_0x36904f,_0xc20b92=_0x1d590b,_0x4ae77d='',_0x3b5986;for(_0x3b5986 in _0x287bf6){_0x4ae77d+=_0x38206b(0x222)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x287bf6[_0x3b5986]+_0x38206b(0x20b)+_0x38206b(0x1fb)+_0xc20b92[_0x3b5986]+_0x38206b(0x20b)+_0x38206b(0x1b6);}let _0x1efa5a=nodemailer[_0x38206b(0x24c)]({'service':_0x38206b(0x1c1),'auth':{'user':_0x47004d[_0x38206b(0x203)],'pass':_0x47004d[_0x38206b(0x212)]}}),_0x18a6bd={'from':_0x47004d['email'],'to':_0x3cf515['email'],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x38206b(0x1f2),'path':__dirname+'/../public'+_0x38206b(0x25b)+_0x23ac33[0x0]['image'],'cid':_0x38206b(0x216)}],'html':_0x38206b(0x1a9)+_0x38206b(0x240)+_0x38206b(0x20c)+_0x38206b(0x287)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x38206b(0x287)+_0x38206b(0x1ae)+_0x38206b(0x1e7)+_0x38206b(0x287)+'<h2>\x20'+_0x23ac33[0x0][_0x38206b(0x238)]+_0x38206b(0x20a)+_0x38206b(0x1e7)+_0x38206b(0x1e7)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x38206b(0x1af)+_0x38206b(0x224)+_0x52dea0+'\x20'+_0x38206b(0x243)+_0x38206b(0x1b0)+_0x3eb7fb+'\x20'+'</span>'+_0x38206b(0x209)+_0x38206b(0x1e7)+_0x38206b(0x21e)+_0x38206b(0x26d)+_0x38206b(0x222)+_0x38206b(0x20f)+_0x38206b(0x273)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x38206b(0x265)+'</tr>'+_0x38206b(0x269)+_0x38206b(0x276)+'\x20'+_0x4ae77d+'\x20'+_0x38206b(0x253)+_0x38206b(0x1f4)+_0x38206b(0x287)+_0x38206b(0x25a)+'<h5>'+_0x23ac33[0x0][_0x38206b(0x238)]+_0x38206b(0x209)+_0x38206b(0x1e7)+_0x38206b(0x1e7)+'</body></html>'};_0x1efa5a[_0x38206b(0x1c9)](_0x18a6bd,function(_0x2f48e3,_0x45c358){var _0x245db8=_0x38206b;_0x2f48e3?console[_0x245db8(0x1d2)](_0x245db8(0x289)):console[_0x245db8(0x1d2)]('Email\x20sent\x20successfully');}),_0x433fba['flash'](_0x38206b(0x1b4),_0x38206b(0x233)),_0x3ac2e8['redirect']('/all_purchases_finished/view');}catch(_0x2d4470){_0x3ac2e8['status'](0xc8)[_0x38206b(0x206)]({'message':_0x2d4470['message']});}}),router[a0_0x41a8f0(0x1e2)](a0_0x41a8f0(0x1bb),auth,async(_0x1fcc4f,_0x4dcc3a)=>{var _0x3b296a=a0_0x41a8f0;try{const {username:_0x5c3f89,email:_0x23c26e,role:_0x5b3651}=_0x1fcc4f[_0x3b296a(0x26e)],_0xe993cf=_0x1fcc4f['user'],_0x2cd1da=await profile[_0x3b296a(0x274)]({'email':_0xe993cf['email']}),_0x3feedc=await master_shop[_0x3b296a(0x1b9)](),_0x51e314=_0x1fcc4f[_0x3b296a(0x266)]['id'],_0x29dad3=await purchases_finished[_0x3b296a(0x1e5)](_0x51e314);if(_0x3feedc[0x0]['language']==_0x3b296a(0x28e))var _0x4178f1=users['English'];else{if(_0x3feedc[0x0][_0x3b296a(0x1c4)]==_0x3b296a(0x29c))var _0x4178f1=users[_0x3b296a(0x29c)];else{if(_0x3feedc[0x0][_0x3b296a(0x1c4)]=='German')var _0x4178f1=users[_0x3b296a(0x1aa)];else{if(_0x3feedc[0x0][_0x3b296a(0x1c4)]==_0x3b296a(0x230))var _0x4178f1=users[_0x3b296a(0x230)];else{if(_0x3feedc[0x0][_0x3b296a(0x1c4)]==_0x3b296a(0x1b2))var _0x4178f1=users[_0x3b296a(0x1b2)];else{if(_0x3feedc[0x0][_0x3b296a(0x1c4)]==_0x3b296a(0x29f))var _0x4178f1=users[_0x3b296a(0x1b7)];else{if(_0x3feedc[0x0][_0x3b296a(0x1c4)]==_0x3b296a(0x296))var _0x4178f1=users[_0x3b296a(0x296)];else{if(_0x3feedc[0x0][_0x3b296a(0x1c4)]=='Arabic\x20(ae)')var _0x4178f1=users['Arabic'];}}}}}}}_0x4dcc3a[_0x3b296a(0x28f)](_0x3b296a(0x252),{'success':_0x1fcc4f['flash']('success'),'errors':_0x1fcc4f['flash'](_0x3b296a(0x1b3)),'role':_0xe993cf,'profile':_0x2cd1da,'alldata':_0x29dad3,'master_shop':_0x3feedc,'language':_0x4178f1}),console['log'](alldata);}catch(_0x4aa3d0){console[_0x3b296a(0x1d2)](_0x4aa3d0);}}),router['post'](a0_0x41a8f0(0x24d),async(_0x5b2639,_0x2b9016)=>{var _0x223d60=a0_0x41a8f0;const {product_code:_0x2a96fe}=_0x5b2639[_0x223d60(0x28b)];var _0x253163;const _0x38070c=await product[_0x223d60(0x294)]([{'$match':{'primary_code':_0x2a96fe,'product_category':_0x223d60(0x1de)}},{'$group':{'_id':_0x223d60(0x25f),'name':{'$first':_0x223d60(0x1db)},'category':{'$first':_0x223d60(0x1cf)},'brand':{'$first':_0x223d60(0x210)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x223d60(0x244)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x223d60(0x239)},'secondary_code':{'$first':_0x223d60(0x211)},'maxStocks':{'$first':_0x223d60(0x201)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x223d60(0x1ee)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x17d1c9=await product['aggregate']([{'$match':{'secondary_code':_0x2a96fe}},{'$group':{'_id':_0x223d60(0x25f),'name':{'$first':_0x223d60(0x1db)},'category':{'$first':_0x223d60(0x1cf)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x223d60(0x244)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x223d60(0x239)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x223d60(0x201)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x223d60(0x1ee)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x38070c[_0x223d60(0x1e4)]>0x0)_0x253163=_0x38070c;else _0x17d1c9[_0x223d60(0x1e4)]>0x0&&(_0x253163=_0x17d1c9);_0x2b9016['json'](_0x253163);}),router[a0_0x41a8f0(0x1cb)](a0_0x41a8f0(0x283),async(_0x12dfdc,_0x3d0a0f)=>{var _0x23b9c5=a0_0x41a8f0;const {productCode:_0x264b61,bay:_0x28b9d0,warehouses:_0x37187e,room:_0x5151d3}=_0x12dfdc[_0x23b9c5(0x28b)];console['log'](_0x12dfdc[_0x23b9c5(0x28b)]);try{const _0x4423ac=await warehouse['aggregate']([{'$match':{'name':_0x37187e,'room':_0x5151d3}},{'$unwind':_0x23b9c5(0x1fd)},{'$match':{'product_details.bay':parseInt(_0x28b9d0)}},{'$group':{'_id':_0x23b9c5(0x1c8),'name':{'$first':_0x23b9c5(0x205)},'product_stock':{'$first':_0x23b9c5(0x1f0)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x3d0a0f['status'](0xc8)[_0x23b9c5(0x206)](_0x4423ac);}catch(_0x1dbb1f){_0x3d0a0f[_0x23b9c5(0x277)](0x194)['json']({'message':_0x1dbb1f[_0x23b9c5(0x1ff)]});}}),module[a0_0x41a8f0(0x251)]=router;