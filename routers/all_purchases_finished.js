var a0_0x507890=a0_0x2d3d;function a0_0x1d90(){var _0x4ce047=['primary_code_hide','/all_purchases/view','$product.floorlevel','product_cat','quantity','An\x20error\x20occurred\x20while\x20saving\x20data.','prod_Qty','length','Arabic\x20(ae)','findOne','success','filter','paid_amount','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details._id','product_name','$product_details.bay','Router','English','role','Email\x20sent\x20successfully','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','JO_number','expiry_date','../public/language/languages.json','$maxStocks','payment\x20successfull','Purchase\x20Return\x20Mail','Finished\x20Goods','</td>','Arabic','6070452AKdEdM','invoice','$product_details.floorlevel','$product.quantity','express','back','maxperunit','all_purchases_finished','createTransport','Portuguese','padStart','291XxHIRt','French','status','$name','/view/add_purchases','/invoice/:id','prod_level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','staff','sendMail','slice','$suppliers_docs','secondary_unit','product_code','POnumber','<tr>','gmail','$product_code','<tbody\x20style=\x22text-align:\x20center;\x22>','stocks','site_title','redirect','return_data','/view/add_purchases/:id','edit_purchases_finished_view','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','log','$product_details.storage','True','/CheckingWarehouse','primary_code','Portuguese\x20(BR)','standard_unit','date_data','$secondary_unit','Paid\x20For\x20Purchase','English\x20(US)','purchase\x20data\x20update\x20successfully','133cUNUED','return_purchase_finished','ejs','Rack\x201','findById','<table\x20style=\x22width:\x20100%\x20!important;\x22>','INCF-','abs','Ambient','$unit','currency','99688csbiOD','toString','prod_code','/../public','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','batch_code','Enabled','purchase\x20data\x20add\x20successfully','name','$product','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','nodemailer','bay','<html><head><title></title>','exports','<span\x20style=\x22float:\x20right;\x22>','Purchase\x20Return','$date','$product_details.type','Return\x20Goods','image','host','getMonth','$maxProdPerUnit','max_product_unit','</head><body>','production_date','Error\x20occurred\x20while\x20processing\x20product:','path','$note','/view/:id','/upload/','<div>','product','/barcode_scanner','logo','stock_quantity','$product_details','Chinese','find','/give_payment/:id','body','purchase_invoice','concat','updateOne','prod_name','</h5>','prod_qty','prod_secondunit','</div>','</tbody>','errors','save','<h5>','../middleware/auth','Hindi','Enclosed','</table>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','2772135BpXQgq','German','$return_data','Spanish','prod_unit','room','return_qty','json','product_code_hide','$product_details.rack','password','render','$product_details.product_name','431998joZQwT','master','add_purchases_finished','</thead>','prod_cat','$alertquantity','get','level','forEach','../models/all_models','currency_placement','suppliers','email','2071818tVLphR','_id','random','$expiry_date','catch','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</span>','$room','message','params','<!DOCTYPE\x20html>','warehouse','</tr>','flash','warehouse_name','/view/return_purchase/:id','then','</body></html>','all_purchases_barcode','$suppliers','Purchase\x20Mail','maxStocks','<strong>\x20Regards\x20</strong>','aggregate','map','$product.bin','product_stock','product_date','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','product_details','user_id','secondary_code','RoomAssign','$product.type','Error\x20Occurs','$product_details.bin','$category','MaxStocks_data','DRY\x20GOODS','/all_purchases_finished/view','32668VlPybU','<h2>\x20','1378590CgnPqb','$paid_amount','language','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','\x20Order\x20Date\x20:\x20','prod_invoice','user','FROZEN\x20GOODS','getDate','room_name','$invoice','Rack\x202','add_purchases\x20error','error','$product_details.product_code','$_id','$warehouse_name','stock_data','post','$brand','$product.bay','purchase_quantity','getFullYear','/preview/:id'];a0_0x1d90=function(){return _0x4ce047;};return a0_0x1d90();}(function(_0x50c88a,_0x58d9f9){var _0x1e5a98=a0_0x2d3d,_0x25496b=_0x50c88a();while(!![]){try{var _0x1005b7=-parseInt(_0x1e5a98(0x1e2))/0x1+parseInt(_0x1e5a98(0x1ef))/0x2+parseInt(_0x1e5a98(0x25f))/0x3*(-parseInt(_0x1e5a98(0x219))/0x4)+-parseInt(_0x1e5a98(0x21b))/0x5+parseInt(_0x1e5a98(0x254))/0x6+-parseInt(_0x1e5a98(0x287))/0x7*(parseInt(_0x1e5a98(0x292))/0x8)+parseInt(_0x1e5a98(0x1d5))/0x9;if(_0x1005b7===_0x58d9f9)break;else _0x25496b['push'](_0x25496b['shift']());}catch(_0x2b9ea5){_0x25496b['push'](_0x25496b['shift']());}}}(a0_0x1d90,0x971f0));function a0_0x2d3d(_0x1d1426,_0x2a0836){var _0x1d90b8=a0_0x1d90();return a0_0x2d3d=function(_0x2d3d2f,_0x3317b3){_0x2d3d2f=_0x2d3d2f-0x1ad;var _0x111f44=_0x1d90b8[_0x2d3d2f];return _0x111f44;},a0_0x2d3d(_0x1d1426,_0x2a0836);}const express=require(a0_0x507890(0x258)),app=express(),router=express[a0_0x507890(0x245)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x507890(0x1eb)),auth=require(a0_0x507890(0x1d0)),nodemailer=require(a0_0x507890(0x29e));var ejs=require(a0_0x507890(0x289));const path=require(a0_0x507890(0x1b6)),users=require(a0_0x507890(0x24d));router['get']('/view',auth,async(_0x3f0c59,_0x45fc60)=>{var _0x808468=a0_0x507890;try{const {username:_0x886f69,email:_0x29c0c5,role:_0x35a75e}=_0x3f0c59[_0x808468(0x221)],_0x522c73=_0x3f0c59[_0x808468(0x221)],_0x2b0128=await profile[_0x808468(0x23c)]({'email':_0x522c73[_0x808468(0x1ee)]}),_0x1fe31d=await staff['findOne']({'email':_0x522c73[_0x808468(0x1ee)]});if(_0x522c73[_0x808468(0x247)]=='staff'){const _0x108295=await staff[_0x808468(0x23c)]({'email':_0x522c73[_0x808468(0x1ee)]});}const _0x63ea7=await master_shop[_0x808468(0x1c1)]();let _0x40365b;if(_0x522c73['role']==_0x808468(0x269)){const _0x1f72cb=await staff[_0x808468(0x23c)]({'email':_0x522c73['email']});_0x40365b=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x1f72cb[_0x808468(0x1fb)]}},{'$lookup':{'from':_0x808468(0x1ed),'localField':_0x808468(0x1ed),'foreignField':_0x808468(0x29a),'as':'suppliers_docs'}},{'$unwind':_0x808468(0x26c)},{'$unwind':_0x808468(0x29b)},{'$group':{'_id':_0x808468(0x22a),'invoice':{'$first':_0x808468(0x225)},'suppliers':{'$first':_0x808468(0x203)},'date':{'$first':_0x808468(0x2a4)},'warehouse_name':{'$first':_0x808468(0x22b)},'room':{'$first':_0x808468(0x1f7)},'product':{'$push':'$product'},'note':{'$first':_0x808468(0x1b7)},'paid_amount':{'$first':_0x808468(0x21c)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x808468(0x1d7)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x808468(0x1f2)},'suppliers_docs':{'$first':_0x808468(0x26c)},'total_product_quantity':{'$sum':_0x808468(0x257)},'level':{'$addToSet':_0x808468(0x22f)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x40365b=await purchases_finished[_0x808468(0x207)]([{'$unwind':_0x808468(0x29b)},{'$group':{'_id':_0x808468(0x22a),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x808468(0x203)},'date':{'$first':_0x808468(0x2a4)},'warehouse_name':{'$first':_0x808468(0x22b)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x808468(0x29b)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x808468(0x1d7)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x808468(0x26c)},'total_product_quantity':{'$sum':_0x808468(0x257)},'level':{'$addToSet':_0x808468(0x22f)},'isle':{'$addToSet':_0x808468(0x209)},'type':{'$addToSet':_0x808468(0x212)},'floorlevel':{'$addToSet':_0x808468(0x235)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x63ea7[0x0]['language']=='English\x20(US)')var _0x35d160=users[_0x808468(0x246)];else{if(_0x63ea7[0x0][_0x808468(0x21d)]=='Hindi')var _0x35d160=users['Hindi'];else{if(_0x63ea7[0x0][_0x808468(0x21d)]=='German')var _0x35d160=users[_0x808468(0x1d6)];else{if(_0x63ea7[0x0][_0x808468(0x21d)]==_0x808468(0x1d8))var _0x35d160=users[_0x808468(0x1d8)];else{if(_0x63ea7[0x0][_0x808468(0x21d)]==_0x808468(0x260))var _0x35d160=users[_0x808468(0x260)];else{if(_0x63ea7[0x0][_0x808468(0x21d)]=='Portuguese\x20(BR)')var _0x35d160=users[_0x808468(0x25d)];else{if(_0x63ea7[0x0]['language']==_0x808468(0x1c0))var _0x35d160=users['Chinese'];else{if(_0x63ea7[0x0][_0x808468(0x21d)]==_0x808468(0x23b))var _0x35d160=users[_0x808468(0x253)];}}}}}}}_0x45fc60[_0x808468(0x1e0)](_0x808468(0x25b),{'success':_0x3f0c59[_0x808468(0x1fd)](_0x808468(0x23d)),'errors':_0x3f0c59[_0x808468(0x1fd)](_0x808468(0x1cd)),'purchases':_0x40365b,'role':_0x522c73,'profile':_0x2b0128,'master_shop':_0x63ea7,'language':_0x35d160});}catch(_0x159dd7){console[_0x808468(0x27b)]('table\x20page',_0x159dd7),_0x45fc60[_0x808468(0x261)](0xc8)[_0x808468(0x1dc)]({'message':_0x159dd7['message']});}});function BayBinSelected(_0x386efb,_0x3b0d78){var _0x51a07b=a0_0x507890,_0x4d6d9b=[],_0x1bb047=[];if(_0x386efb==_0x51a07b(0x217)){switch(_0x3b0d78){case'Rack\x201':_0x4d6d9b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x4d6d9b=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1bb047=['DG'];}else{if(_0x386efb==_0x51a07b(0x222)){switch(_0x3b0d78){case _0x51a07b(0x28a):_0x4d6d9b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x51a07b(0x226):_0x4d6d9b=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1bb047=['FG'];}}return{'levels':_0x4d6d9b,'identify':_0x1bb047};}async function getRandom8DigitNumber(){var _0x40d335=a0_0x507890;const _0x41afd4=0x989680,_0x3e816f=0x5f5e0ff,_0x93d80d=Math['floor'](Math[_0x40d335(0x1f1)]()*(_0x3e816f-_0x41afd4+0x1))+_0x41afd4;var _0x25e5cd;const _0x209ebd=await purchases_finished['findOne']({'invoice':_0x40d335(0x28d)+_0x93d80d});return _0x209ebd&&_0x209ebd[_0x40d335(0x23a)]>0x0?_0x25e5cd=_0x40d335(0x28d)+_0x93d80d:_0x25e5cd='INCF-'+_0x93d80d,_0x25e5cd;}router['get'](a0_0x507890(0x263),auth,async(_0x58f2b5,_0x38fed5)=>{var _0x502a8d=a0_0x507890;try{const {username:_0x54866b,email:_0x189440,role:_0x430599}=_0x58f2b5[_0x502a8d(0x221)],_0x59da23=_0x58f2b5[_0x502a8d(0x221)],_0x122fae=await profile[_0x502a8d(0x23c)]({'email':_0x59da23[_0x502a8d(0x1ee)]}),_0x4d3037=await master_shop[_0x502a8d(0x1c1)](),_0xf1119e=await staff[_0x502a8d(0x23c)]({'email':_0x59da23['email']}),_0x114e27=await suppliers[_0x502a8d(0x1c1)]({});let _0x580b5d;if(_0x59da23[_0x502a8d(0x247)]==_0x502a8d(0x269)){const _0x317c77=await staff['findOne']({'email':_0x59da23['email']});_0x580b5d=await warehouse['aggregate']([{'$match':{'status':_0x502a8d(0x298),'name':_0x317c77[_0x502a8d(0x1fb)],'warehouse_category':_0x502a8d(0x251)}},{'$group':{'_id':_0x502a8d(0x262),'name':{'$first':_0x502a8d(0x262)}}}]);}else _0x580b5d=await warehouse[_0x502a8d(0x207)]([{'$match':{'status':_0x502a8d(0x298),'warehouse_category':_0x502a8d(0x251),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x502a8d(0x262),'name':{'$first':'$name'}}}]);const _0xa736dc=await product[_0x502a8d(0x1c1)]({}),_0x3286f5=await warehouse[_0x502a8d(0x1c1)]({'status':'Enabled'}),_0x50449c=await purchases_finished[_0x502a8d(0x1c1)]({}),_0x503da0=_0x50449c[_0x502a8d(0x23a)]+0x1,_0x427fe7=_0x502a8d(0x28d)+_0x503da0[_0x502a8d(0x293)]()[_0x502a8d(0x25e)](0x5,'0');var _0x57632c=[_0x502a8d(0x28f),_0x502a8d(0x1d2)];if(_0x4d3037[0x0]['language']==_0x502a8d(0x285))var _0x18bbcb=users[_0x502a8d(0x246)];else{if(_0x4d3037[0x0][_0x502a8d(0x21d)]=='Hindi')var _0x18bbcb=users[_0x502a8d(0x1d1)];else{if(_0x4d3037[0x0][_0x502a8d(0x21d)]=='German')var _0x18bbcb=users[_0x502a8d(0x1d6)];else{if(_0x4d3037[0x0][_0x502a8d(0x21d)]==_0x502a8d(0x1d8))var _0x18bbcb=users['Spanish'];else{if(_0x4d3037[0x0]['language']==_0x502a8d(0x260))var _0x18bbcb=users[_0x502a8d(0x260)];else{if(_0x4d3037[0x0][_0x502a8d(0x21d)]=='Portuguese\x20(BR)')var _0x18bbcb=users['Portuguese'];else{if(_0x4d3037[0x0][_0x502a8d(0x21d)]==_0x502a8d(0x1c0))var _0x18bbcb=users[_0x502a8d(0x1c0)];else{if(_0x4d3037[0x0][_0x502a8d(0x21d)]==_0x502a8d(0x23b))var _0x18bbcb=users[_0x502a8d(0x253)];}}}}}}}const _0xaed21b=getRandom8DigitNumber();_0xaed21b[_0x502a8d(0x200)](_0x2c3f6f=>{var _0x4862e9=_0x502a8d;_0x38fed5['render'](_0x4862e9(0x1e4),{'success':_0x58f2b5[_0x4862e9(0x1fd)](_0x4862e9(0x23d)),'errors':_0x58f2b5[_0x4862e9(0x1fd)](_0x4862e9(0x1cd)),'role':_0x59da23,'profile':_0x122fae,'suppliers':_0x114e27,'warehouse':_0x580b5d,'product':_0xa736dc,'invoice':_0x2c3f6f,'master_shop':_0x4d3037,'language':_0x18bbcb,'find_data':_0x3286f5,'rooms_data':_0x57632c});})[_0x502a8d(0x1f3)](_0x30b3fd=>{var _0x163b7c=_0x502a8d;_0x58f2b5['flash'](_0x163b7c(0x1cd),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x38fed5[_0x163b7c(0x276)](_0x163b7c(0x218));});}catch(_0x401cb6){console[_0x502a8d(0x27b)](_0x401cb6);}}),router[a0_0x507890(0x1e8)](a0_0x507890(0x278),auth,async(_0x3494e7,_0x35bce2)=>{var _0x308797=a0_0x507890;try{const _0x184bdd=_0x3494e7[_0x308797(0x1f9)]['id'];console[_0x308797(0x27b)](_0x184bdd);const _0x560f61=await master_shop[_0x308797(0x1c1)]();console[_0x308797(0x27b)](_0x308797(0x1e3),_0x560f61);const _0x20c9f1=await product[_0x308797(0x23c)]({'name':_0x184bdd});console[_0x308797(0x27b)](_0x308797(0x1bb),_0x20c9f1),_0x35bce2[_0x308797(0x261)](0xc8)['json']({'product_data':_0x20c9f1,'master':_0x560f61});}catch(_0x2a6355){console['log'](_0x308797(0x227),_0x2a6355);}}),router[a0_0x507890(0x22d)](a0_0x507890(0x263),auth,async(_0x14d328,_0x587f97)=>{var _0x3410b7=a0_0x507890;try{const {invoice:_0x18fabb,date:_0x3b59d3,warehouse_name:_0x43012e,prod_name:_0x4850e9,prod_code:_0x1deae6,prod_qty:_0x50e81f,prod_unit:_0x505c19,prod_secondunit:_0x308161,prod_level:_0x237b10,prod_isle:_0x630f81,prod_pallet:_0xccf19c,note:_0x4a9b58,expiry_date:_0x140278,batch_code:_0x396d29,payable:_0x7433d9,due_amount:_0x3ab51a,Room_name:_0x3587ab,primary_code:_0x30a091,secondary_code:_0x161e72,MaxStocks_data:_0x5dd61e,PO_number:_0x3dc3f8,SCRN:_0x7dd4fc,JO_number:_0x206eed}=_0x14d328[_0x3410b7(0x1c3)];if(typeof _0x4850e9=='string')var _0x1742d7=[_0x14d328['body'][_0x3410b7(0x1c7)]],_0x2f2a49=[_0x14d328['body'][_0x3410b7(0x294)]],_0x3bdaa0=[_0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x239)]],_0x526216=[_0x14d328['body']['prod_primunit']],_0x37582d=[_0x14d328['body']['prod_secondunit']],_0x544d48=[_0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x265)]],_0x562f5e=[_0x14d328[_0x3410b7(0x1c3)]['primary_code']],_0x2b8b8f=[_0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x210)]],_0x48a190=[_0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x216)]],_0x369f37=[_0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x297)]],_0x48882d=[_0x14d328['body'][_0x3410b7(0x24c)]],_0x318d58=[_0x14d328[_0x3410b7(0x1c3)]['product_date']],_0x2b63ad=[_0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x1b2)]],_0x25bc68=[_0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x1e6)]],_0x3f7f5b=[_0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x211)]],_0x4682f6=[_0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x220)]];else var _0x1742d7=[..._0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x1c7)]],_0x2f2a49=[..._0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x294)]],_0x3bdaa0=[..._0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x239)]],_0x526216=[..._0x14d328[_0x3410b7(0x1c3)]['prod_primunit']],_0x37582d=[..._0x14d328[_0x3410b7(0x1c3)]['prod_secondunit']],_0x544d48=[..._0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x265)]],_0x562f5e=[..._0x14d328[_0x3410b7(0x1c3)]['primary_code']],_0x2b8b8f=[..._0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x210)]],_0x48a190=[..._0x14d328['body']['MaxStocks_data']],_0x369f37=[..._0x14d328['body'][_0x3410b7(0x297)]],_0x48882d=[..._0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x24c)]],_0x318d58=[..._0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x20b)]],_0x2b63ad=[..._0x14d328['body'][_0x3410b7(0x1b2)]],_0x25bc68=[..._0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x1e6)]],_0x3f7f5b=[..._0x14d328[_0x3410b7(0x1c3)][_0x3410b7(0x211)]],_0x4682f6=[..._0x14d328['body'][_0x3410b7(0x220)]];const _0xa4c060=_0x1742d7[_0x3410b7(0x208)](_0x4478f2=>{return _0x4478f2={'product_name':_0x4478f2};});_0x2f2a49[_0x3410b7(0x1ea)]((_0x1902f0,_0xe404ce)=>{var _0x53b7e9=_0x3410b7;_0xa4c060[_0xe404ce][_0x53b7e9(0x26e)]=_0x1902f0,_0xa4c060[_0xe404ce][_0x53b7e9(0x282)]=_0x3b59d3;}),_0x3bdaa0[_0x3410b7(0x1ea)]((_0x344870,_0x53a60f)=>{var _0x276ddc=_0x3410b7;_0xa4c060[_0x53a60f][_0x276ddc(0x237)]=Math['abs'](_0x344870);}),_0x526216[_0x3410b7(0x1ea)]((_0x4adf75,_0x14d2d7)=>{var _0x289b54=_0x3410b7;_0xa4c060[_0x14d2d7][_0x289b54(0x281)]=_0x4adf75;}),_0x37582d[_0x3410b7(0x1ea)]((_0x5a752f,_0x340b0e)=>{var _0x31259a=_0x3410b7;_0xa4c060[_0x340b0e][_0x31259a(0x26d)]=_0x5a752f;}),_0x544d48['forEach']((_0x1b4c4a,_0x5d9700)=>{var _0x2f0f69=_0x3410b7;_0xa4c060[_0x5d9700][_0x2f0f69(0x29f)]=_0x1b4c4a;}),_0x562f5e[_0x3410b7(0x1ea)]((_0x13bfe9,_0x42433c)=>{var _0x2a5b68=_0x3410b7;_0xa4c060[_0x42433c][_0x2a5b68(0x27f)]=_0x13bfe9;}),_0x2b8b8f['forEach']((_0x17cd53,_0x3222b3)=>{var _0xbacaab=_0x3410b7;_0xa4c060[_0x3222b3][_0xbacaab(0x210)]=_0x17cd53;}),_0x48a190['forEach']((_0x41d39e,_0x4b0601)=>{var _0x5cc81e=_0x3410b7;_0xa4c060[_0x4b0601][_0x5cc81e(0x205)]=_0x41d39e;}),_0x369f37['forEach']((_0x13dd2c,_0x29b34f)=>{var _0x1f0565=_0x3410b7;_0xa4c060[_0x29b34f][_0x1f0565(0x297)]=_0x13dd2c;}),_0x48882d[_0x3410b7(0x1ea)]((_0x48913f,_0x585ff3)=>{var _0x42f454=_0x3410b7;_0xa4c060[_0x585ff3][_0x42f454(0x24c)]=_0x48913f;}),_0x318d58[_0x3410b7(0x1ea)]((_0x322741,_0x528d04)=>{var _0x5a66ee=_0x3410b7;_0xa4c060[_0x528d04][_0x5a66ee(0x1b4)]=_0x322741;}),_0x2b63ad[_0x3410b7(0x1ea)]((_0x2e35ce,_0x2e1162)=>{_0xa4c060[_0x2e1162]['maxperunit']=_0x2e35ce;}),_0x25bc68[_0x3410b7(0x1ea)]((_0x4f2f77,_0x5ab87f)=>{var _0x58378d=_0x3410b7;_0xa4c060[_0x5ab87f][_0x58378d(0x236)]=_0x4f2f77;}),_0x3f7f5b[_0x3410b7(0x1ea)]((_0x2c8340,_0x287e2d)=>{var _0x49b451=_0x3410b7;_0xa4c060[_0x287e2d][_0x49b451(0x224)]=_0x2c8340;}),_0x4682f6[_0x3410b7(0x1ea)]((_0x9a1d22,_0x14c76c)=>{_0xa4c060[_0x14c76c]['invoice']=_0x9a1d22;});const _0x266f6d=_0xa4c060[_0x3410b7(0x23e)](_0x292ee3=>_0x292ee3[_0x3410b7(0x237)]!=='0'&&_0x292ee3[_0x3410b7(0x237)]!==''),_0x71a5cc=new purchases_finished({'invoice':_0x18fabb,'suppliers':_0x14d328['body'][_0x3410b7(0x1ed)],'date':_0x3b59d3,'warehouse_name':_0x43012e,'product':_0x266f6d,'note':_0x4a9b58,'due_amount':_0x3ab51a,'room':_0x3587ab,'POnumber':_0x3dc3f8,'SCRN':_0x7dd4fc,'JO_number':_0x206eed}),_0x2a50c7=await _0x71a5cc['save'](),_0x11bf4e=await purchases_finished['findOne']({'invoice':_0x18fabb}),_0x543481=_0x11bf4e[_0x3410b7(0x1bb)][_0x3410b7(0x208)](async _0x783f62=>{var _0x456e67=_0x3410b7;try{var _0x54c543=await warehouse['findOne']({'name':_0x43012e,'room':_0x783f62[_0x456e67(0x224)]}),_0x11e8e1=0x0;const _0x36f938=_0x54c543['product_details']['map'](_0x930432=>{var _0x1c128f=_0x456e67;console[_0x1c128f(0x27b)](_0x930432['product_name']+'=='+_0x783f62[_0x1c128f(0x243)]+'&&'+_0x930432[_0x1c128f(0x29f)]+'=='+_0x783f62[_0x1c128f(0x29f)]+'&&'+_0x930432[_0x1c128f(0x24c)]+'=='+_0x783f62[_0x1c128f(0x24c)]+'&&'+_0x930432[_0x1c128f(0x1b4)]+'=='+_0x783f62['production_date']+'&&'+_0x930432[_0x1c128f(0x297)]+'=='+_0x783f62[_0x1c128f(0x297)]+'&&'+_0x930432[_0x1c128f(0x255)]+'=='+_0x11bf4e[_0x1c128f(0x255)]),_0x930432[_0x1c128f(0x243)]==_0x783f62[_0x1c128f(0x243)]&&_0x930432[_0x1c128f(0x29f)]==_0x783f62[_0x1c128f(0x29f)]&&_0x930432[_0x1c128f(0x24c)]==_0x783f62[_0x1c128f(0x24c)]&&_0x930432[_0x1c128f(0x1b4)]==_0x783f62[_0x1c128f(0x1b4)]&&_0x930432[_0x1c128f(0x297)]==_0x783f62[_0x1c128f(0x297)]&&_0x930432[_0x1c128f(0x255)]==_0x11bf4e[_0x1c128f(0x255)]&&(_0x930432[_0x1c128f(0x20a)]=Math[_0x1c128f(0x28e)](_0x930432[_0x1c128f(0x20a)])+Math[_0x1c128f(0x28e)](_0x783f62[_0x1c128f(0x237)]),_0x11e8e1++);});return _0x11e8e1==0x0&&(_0x54c543[_0x456e67(0x20e)]=_0x54c543[_0x456e67(0x20e)][_0x456e67(0x1c5)]({'product_name':_0x783f62['product_name'],'product_stock':Math[_0x456e67(0x28e)](_0x783f62[_0x456e67(0x237)]),'primary_code':_0x783f62[_0x456e67(0x27f)],'secondary_code':_0x783f62[_0x456e67(0x210)],'product_code':_0x783f62[_0x456e67(0x26e)],'bay':_0x783f62[_0x456e67(0x29f)],'maxProducts':_0x783f62['maxStocks'],'unit':_0x783f62[_0x456e67(0x281)],'secondary_unit':_0x783f62[_0x456e67(0x26d)],'expiry_date':_0x783f62['expiry_date'],'production_date':_0x783f62['production_date'],'maxProducts':_0x783f62[_0x456e67(0x205)],'maxPerUnit':_0x783f62[_0x456e67(0x25a)],'batch_code':_0x783f62[_0x456e67(0x297)],'product_cat':_0x783f62[_0x456e67(0x236)],'invoice':_0x783f62['invoice'],'id_incoming':_0x783f62[_0x456e67(0x1f0)],'date_data':_0x783f62[_0x456e67(0x282)]})),_0x54c543;}catch(_0x10bfb1){return console[_0x456e67(0x228)](_0x456e67(0x1b5),_0x10bfb1),null;}});Promise['all'](_0x543481)[_0x3410b7(0x200)](async _0x27a6e8=>{var _0x5da8f3=_0x3410b7;try{for(const _0x44b1a2 of _0x27a6e8){await warehouse[_0x5da8f3(0x1c6)]({'_id':_0x44b1a2[_0x5da8f3(0x1f0)]},{'$addToSet':{'product_details':{'$each':_0x44b1a2['product_details']}}});}const _0x346ba7=await master_shop[_0x5da8f3(0x1c1)](),_0x49a150=await email_settings['findOne'](),_0x55067e=await supervisor_settings[_0x5da8f3(0x1c1)]();var _0x45866f=_0x11bf4e['product'],_0x42d749='',_0x2cfa04;for(_0x2cfa04 in _0x45866f){var _0x53b451='FG';_0x11bf4e['warehouse_name']==_0x5da8f3(0x217)&&(_0x53b451='DG'),_0x42d749+=_0x5da8f3(0x270)+_0x5da8f3(0x27a)+_0x45866f[_0x2cfa04][_0x5da8f3(0x243)]+_0x5da8f3(0x252)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x45866f[_0x2cfa04]['product_code']+_0x5da8f3(0x252)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x45866f[_0x2cfa04][_0x5da8f3(0x237)]+_0x5da8f3(0x252)+_0x5da8f3(0x27a)+_0x45866f[_0x2cfa04]['standard_unit']+_0x5da8f3(0x252)+_0x5da8f3(0x27a)+_0x45866f[_0x2cfa04][_0x5da8f3(0x26d)]+'</td>'+_0x5da8f3(0x27a)+_0x11bf4e['warehouse_name']+_0x5da8f3(0x252)+_0x5da8f3(0x27a)+_0x45866f[_0x2cfa04][_0x5da8f3(0x224)]+_0x5da8f3(0x252)+_0x5da8f3(0x27a)+_0x53b451+_0x45866f[_0x2cfa04][_0x5da8f3(0x29f)]+_0x5da8f3(0x252),_0x5da8f3(0x1fc);}let _0x101648=nodemailer[_0x5da8f3(0x25c)]({'host':_0x49a150[_0x5da8f3(0x1af)],'port':Number(_0x49a150['port']),'secure':![],'auth':{'user':_0x49a150[_0x5da8f3(0x1ee)],'pass':_0x49a150['password']}}),_0x30f25c={'from':_0x49a150[_0x5da8f3(0x1ee)],'to':_0x55067e[0x0]['FGSEmail'],'subject':_0x5da8f3(0x204),'attachments':[{'filename':_0x5da8f3(0x20c),'path':__dirname+_0x5da8f3(0x295)+_0x5da8f3(0x1b9)+_0x346ba7[0x0][_0x5da8f3(0x1ae)],'cid':_0x5da8f3(0x1bd)}],'html':'<!DOCTYPE\x20html>'+_0x5da8f3(0x2a0)+_0x5da8f3(0x1b3)+'<div>'+_0x5da8f3(0x21e)+'<div>'+_0x5da8f3(0x1d4)+_0x5da8f3(0x1cb)+_0x5da8f3(0x1ba)+_0x5da8f3(0x21a)+_0x346ba7[0x0][_0x5da8f3(0x275)]+_0x5da8f3(0x249)+'</div>'+_0x5da8f3(0x1cb)+'<hr\x20class=\x22my-3\x22>'+_0x5da8f3(0x1ba)+_0x5da8f3(0x1f4)+_0x5da8f3(0x29c)+_0x11bf4e['invoice']+'\x20'+_0x5da8f3(0x2a2)+'\x20Order\x20Date\x20:\x20'+_0x11bf4e['date']+'\x20'+_0x5da8f3(0x1f6)+_0x5da8f3(0x1c8)+_0x5da8f3(0x1cb)+_0x5da8f3(0x28c)+_0x5da8f3(0x296)+_0x5da8f3(0x270)+_0x5da8f3(0x1f5)+_0x5da8f3(0x29d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x5da8f3(0x266)+_0x5da8f3(0x241)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x5da8f3(0x1e5)+_0x5da8f3(0x273)+'\x20'+_0x42d749+'\x20'+'</tbody>'+_0x5da8f3(0x1d3)+_0x5da8f3(0x1ba)+_0x5da8f3(0x206)+_0x5da8f3(0x1cf)+_0x346ba7[0x0][_0x5da8f3(0x275)]+'</h5>'+_0x5da8f3(0x1cb)+_0x5da8f3(0x1cb)+_0x5da8f3(0x201)};_0x101648[_0x5da8f3(0x26a)](_0x30f25c,function(_0x4df491,_0x23fffb){var _0x1a6da3=_0x5da8f3;_0x4df491?(console[_0x1a6da3(0x27b)](_0x4df491),console[_0x1a6da3(0x27b)](_0x1a6da3(0x213))):console[_0x1a6da3(0x27b)](_0x1a6da3(0x248));});}catch(_0x138b70){console['error'](_0x138b70),_0x587f97[_0x5da8f3(0x261)](0x1f4)[_0x5da8f3(0x1dc)]({'error':_0x5da8f3(0x238),'message':_0x138b70[_0x5da8f3(0x1f8)]});}})[_0x3410b7(0x1f3)](_0x4819a0=>{console['error'](_0x4819a0);}),_0x14d328[_0x3410b7(0x1fd)](_0x3410b7(0x23d),_0x3410b7(0x299)),_0x587f97[_0x3410b7(0x276)](_0x3410b7(0x218));}catch(_0x29ff83){console[_0x3410b7(0x27b)](_0x29ff83);}}),router[a0_0x507890(0x1e8)](a0_0x507890(0x232),auth,async(_0x5554bf,_0x56e61f)=>{var _0x1a39df=a0_0x507890;try{const {username:_0x48c863,email:_0x465b36,role:_0x26bb4d}=_0x5554bf[_0x1a39df(0x221)],_0xc6a951=_0x5554bf[_0x1a39df(0x221)],_0x4424df=await profile[_0x1a39df(0x23c)]({'email':_0xc6a951[_0x1a39df(0x1ee)]}),_0x1b0d8f=await master_shop[_0x1a39df(0x1c1)](),_0x3cbc4b=_0x5554bf['params']['id'],_0x2933fc=await purchases_finished['findById'](_0x3cbc4b),_0x241eb0=await suppliers[_0x1a39df(0x1c1)]({});let _0x35259d;if(_0xc6a951['role']==_0x1a39df(0x269)){const _0x11a03a=await staff[_0x1a39df(0x23c)]({'email':_0xc6a951[_0x1a39df(0x1ee)]});_0x35259d=await warehouse['find']({'status':_0x1a39df(0x298),'name':_0x11a03a[_0x1a39df(0x1fb)],'warehouse_category':_0x1a39df(0x251)});}else _0x35259d=await warehouse[_0x1a39df(0x207)]([{'$match':{'status':_0x1a39df(0x298),'warehouse_category':_0x1a39df(0x251)}},{'$group':{'_id':_0x1a39df(0x262),'name':{'$first':'$name'}}}]);const _0x4da3a3=await product[_0x1a39df(0x1c1)]({}),_0x27ebf2=BayBinSelected(_0x2933fc['warehouse_name'],_0x2933fc[_0x1a39df(0x1da)]);let _0x26b0d8=new Date(_0x2933fc[_0x1a39df(0x24c)]),_0x3b8d8a=('0'+_0x26b0d8[_0x1a39df(0x223)]())[_0x1a39df(0x26b)](-0x2),_0x1ac525=('0'+(_0x26b0d8[_0x1a39df(0x1b0)]()+0x1))[_0x1a39df(0x26b)](-0x2),_0x38ae5d=_0x26b0d8[_0x1a39df(0x231)](),_0x2a8b24=_0x38ae5d+'-'+_0x1ac525+'-'+_0x3b8d8a;if(_0x1b0d8f[0x0]['language']==_0x1a39df(0x285)){var _0x548b5f=users['English'];console[_0x1a39df(0x27b)](_0x548b5f);}else{if(_0x1b0d8f[0x0]['language']=='Hindi')var _0x548b5f=users['Hindi'];else{if(_0x1b0d8f[0x0][_0x1a39df(0x21d)]==_0x1a39df(0x1d6))var _0x548b5f=users['German'];else{if(_0x1b0d8f[0x0][_0x1a39df(0x21d)]==_0x1a39df(0x1d8))var _0x548b5f=users[_0x1a39df(0x1d8)];else{if(_0x1b0d8f[0x0]['language']==_0x1a39df(0x260))var _0x548b5f=users['French'];else{if(_0x1b0d8f[0x0][_0x1a39df(0x21d)]==_0x1a39df(0x280))var _0x548b5f=users['Portuguese'];else{if(_0x1b0d8f[0x0][_0x1a39df(0x21d)]==_0x1a39df(0x1c0))var _0x548b5f=users[_0x1a39df(0x1c0)];else{if(_0x1b0d8f[0x0][_0x1a39df(0x21d)]==_0x1a39df(0x23b))var _0x548b5f=users[_0x1a39df(0x253)];}}}}}}}_0x56e61f[_0x1a39df(0x1e0)](_0x1a39df(0x279),{'success':_0x5554bf[_0x1a39df(0x1fd)](_0x1a39df(0x23d)),'errors':_0x5554bf[_0x1a39df(0x1fd)](_0x1a39df(0x1cd)),'role':_0xc6a951,'profile':_0x4424df,'purchases':_0x2933fc,'suppliers':_0x241eb0,'warehouse':_0x35259d,'product':_0x4da3a3,'master_shop':_0x1b0d8f,'language':_0x548b5f,'ed_fullDate':_0x2a8b24,'dataSelected':_0x27ebf2});}catch(_0x4df2ae){console[_0x1a39df(0x27b)](_0x4df2ae);}}),router[a0_0x507890(0x1e8)](a0_0x507890(0x1b8),auth,async(_0x56ab30,_0xe1dcc0)=>{var _0x38527a=a0_0x507890;try{const {username:_0x475762,email:_0xe8728b,role:_0x27eebd}=_0x56ab30['user'],_0x359461=_0x56ab30[_0x38527a(0x221)],_0x23d442=await profile[_0x38527a(0x23c)]({'email':_0x359461[_0x38527a(0x1ee)]}),_0x2c10b6=await master_shop['find'](),_0x4e320e=_0x56ab30[_0x38527a(0x1f9)]['id'],_0x1469c9=await purchases_finished[_0x38527a(0x28b)](_0x4e320e),_0x22f990=await suppliers['find']({});let _0x5ea83c;if(_0x359461['role']==_0x38527a(0x269)){const _0x14de52=await staff[_0x38527a(0x23c)]({'email':_0x359461[_0x38527a(0x1ee)]});_0x5ea83c=await warehouse[_0x38527a(0x1c1)]({'status':_0x38527a(0x298),'name':_0x14de52[_0x38527a(0x1fb)],'warehouse_category':'Finished\x20Goods'});}else _0x5ea83c=await warehouse[_0x38527a(0x207)]([{'$match':{'status':_0x38527a(0x298),'warehouse_category':_0x38527a(0x251)}},{'$group':{'_id':_0x38527a(0x262),'name':{'$first':_0x38527a(0x262)}}}]);const _0x14d80f=await product[_0x38527a(0x1c1)]({}),_0x36681c=BayBinSelected(_0x1469c9[_0x38527a(0x1fe)],_0x1469c9[_0x38527a(0x1da)]);let _0x1015f6=new Date(_0x1469c9[_0x38527a(0x24c)]),_0x13b433=('0'+_0x1015f6['getDate']())[_0x38527a(0x26b)](-0x2),_0x6e024b=('0'+(_0x1015f6['getMonth']()+0x1))[_0x38527a(0x26b)](-0x2),_0x39e90f=_0x1015f6['getFullYear'](),_0x1f1a28=_0x39e90f+'-'+_0x6e024b+'-'+_0x13b433;if(_0x2c10b6[0x0][_0x38527a(0x21d)]==_0x38527a(0x285)){var _0x18e60d=users['English'];console[_0x38527a(0x27b)](_0x18e60d);}else{if(_0x2c10b6[0x0][_0x38527a(0x21d)]=='Hindi')var _0x18e60d=users['Hindi'];else{if(_0x2c10b6[0x0]['language']==_0x38527a(0x1d6))var _0x18e60d=users[_0x38527a(0x1d6)];else{if(_0x2c10b6[0x0][_0x38527a(0x21d)]==_0x38527a(0x1d8))var _0x18e60d=users[_0x38527a(0x1d8)];else{if(_0x2c10b6[0x0][_0x38527a(0x21d)]=='French')var _0x18e60d=users[_0x38527a(0x260)];else{if(_0x2c10b6[0x0][_0x38527a(0x21d)]==_0x38527a(0x280))var _0x18e60d=users[_0x38527a(0x25d)];else{if(_0x2c10b6[0x0][_0x38527a(0x21d)]=='Chinese')var _0x18e60d=users[_0x38527a(0x1c0)];else{if(_0x2c10b6[0x0][_0x38527a(0x21d)]==_0x38527a(0x23b))var _0x18e60d=users[_0x38527a(0x253)];}}}}}}}_0xe1dcc0[_0x38527a(0x1e0)]('edit_purchases_finished',{'success':_0x56ab30['flash']('success'),'errors':_0x56ab30[_0x38527a(0x1fd)](_0x38527a(0x1cd)),'role':_0x359461,'profile':_0x23d442,'purchases':_0x1469c9,'suppliers':_0x22f990,'warehouse':_0x5ea83c,'product':_0x14d80f,'master_shop':_0x2c10b6,'language':_0x18e60d,'ed_fullDate':_0x1f1a28,'dataSelected':_0x36681c});}catch(_0x3695c2){console[_0x38527a(0x27b)](_0x3695c2);}}),router['post'](a0_0x507890(0x1b8),auth,async(_0x22a0ec,_0x120fa8)=>{var _0x2e366a=a0_0x507890;try{const _0x22a77f=_0x22a0ec[_0x2e366a(0x1f9)]['id'],_0x4c738a=await purchases_finished[_0x2e366a(0x23c)]({'_id':_0x22a0ec[_0x2e366a(0x1f9)]['id']}),_0x4631d2=await warehouse['findOne']({'name':_0x4c738a['warehouse_name'],'room':_0x4c738a[_0x2e366a(0x1da)]});_0x4c738a[_0x2e366a(0x1bb)]['forEach'](_0x409c90=>{var _0xfceb9e=_0x2e366a;const _0x20d523=_0x4631d2[_0xfceb9e(0x20e)][_0xfceb9e(0x208)](_0x54e551=>{var _0x302d60=_0xfceb9e;_0x54e551['product_name']==_0x409c90[_0x302d60(0x243)]&&_0x54e551[_0x302d60(0x29f)]==_0x409c90[_0x302d60(0x29f)]&&(_0x54e551['product_stock']=parseInt(_0x54e551['product_stock'])-parseInt(_0x409c90[_0x302d60(0x237)]));});}),await _0x4631d2[_0x2e366a(0x1ce)]();const {invoice:_0x3bd3cf,suppliers:_0x4e0619,date:_0x2c5a35,warehouse_name:_0x49dcba,prod_name:_0x5c4c15,prod_code:_0x5455cc,prod_qty:_0x15066a,prod_unit:_0xcc6900,prod_secondunit:_0x4843f2,prod_level:_0xd53595,prod_isle:_0x55c3b7,prod_pallet:_0x1d937b,note:_0x133450,expiry_date:_0x187afd,batch_code:_0x29700f,paid_amount:_0x5e12b2,due_amount:_0x1426fb,Room_name:_0x27d479,primary_code:_0x3a2763,secondary_code:_0x21bf77,PO_number:_0x4e0690,JO_number:_0x390a69}=_0x22a0ec['body'];if(typeof _0x5c4c15=='string')var _0x49302e=[_0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x1c7)]],_0x33390f=[_0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x294)]],_0x167f15=[_0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x1c9)]],_0x2c0d21=[_0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x1d9)]],_0x24659d=[_0x22a0ec['body'][_0x2e366a(0x1ca)]],_0x1aa21f=[_0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x265)]],_0x45b972=[_0x22a0ec['body'][_0x2e366a(0x27f)]],_0x304021=[_0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x210)]],_0xaec3e5=[_0x22a0ec[_0x2e366a(0x1c3)]['MaxStocks_data']],_0x11d6e3=[_0x22a0ec['body'][_0x2e366a(0x297)]],_0x1d8622=[_0x22a0ec[_0x2e366a(0x1c3)]['expiry_date']];else var _0x49302e=[..._0x22a0ec['body']['prod_name']],_0x33390f=[..._0x22a0ec['body'][_0x2e366a(0x294)]],_0x167f15=[..._0x22a0ec[_0x2e366a(0x1c3)]['prod_qty']],_0x2c0d21=[..._0x22a0ec['body'][_0x2e366a(0x1d9)]],_0x24659d=[..._0x22a0ec['body'][_0x2e366a(0x1ca)]],_0x1aa21f=[..._0x22a0ec['body'][_0x2e366a(0x265)]],_0x45b972=[..._0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x27f)]],_0x304021=[..._0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x210)]],_0xaec3e5=[..._0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x216)]],_0x11d6e3=[..._0x22a0ec['body'][_0x2e366a(0x297)]],_0x1d8622=[..._0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x24c)]];const _0x1b75b5=_0x49302e[_0x2e366a(0x208)](_0x21dfce=>{return _0x21dfce={'product_name':_0x21dfce};});_0x33390f[_0x2e366a(0x1ea)]((_0x58e7a1,_0x33d49c)=>{_0x1b75b5[_0x33d49c]['product_code']=_0x58e7a1;}),_0x167f15[_0x2e366a(0x1ea)]((_0x13ffec,_0x2602d9)=>{var _0x1fb704=_0x2e366a;_0x1b75b5[_0x2602d9][_0x1fb704(0x237)]=_0x13ffec;}),_0x2c0d21[_0x2e366a(0x1ea)]((_0x272e63,_0x4d997c)=>{var _0x17a599=_0x2e366a;_0x1b75b5[_0x4d997c][_0x17a599(0x281)]=_0x272e63;}),_0x24659d[_0x2e366a(0x1ea)]((_0x53fde7,_0x481ce9)=>{var _0x204c42=_0x2e366a;_0x1b75b5[_0x481ce9][_0x204c42(0x26d)]=_0x53fde7;}),_0x1aa21f[_0x2e366a(0x1ea)]((_0x276f09,_0x579212)=>{var _0x1d65be=_0x2e366a;_0x1b75b5[_0x579212][_0x1d65be(0x29f)]=_0x276f09;}),_0x45b972[_0x2e366a(0x1ea)]((_0x9d7199,_0x9caf2a)=>{var _0x13f7be=_0x2e366a;_0x1b75b5[_0x9caf2a][_0x13f7be(0x27f)]=_0x9d7199;}),_0x304021[_0x2e366a(0x1ea)]((_0xc0db05,_0x583490)=>{_0x1b75b5[_0x583490]['secondary_code']=_0xc0db05;}),_0xaec3e5['forEach']((_0x23346b,_0x911f1)=>{var _0x45797b=_0x2e366a;_0x1b75b5[_0x911f1][_0x45797b(0x205)]=_0x23346b;}),_0x11d6e3[_0x2e366a(0x1ea)]((_0x2991eb,_0x6dca2e)=>{var _0x124aac=_0x2e366a;_0x1b75b5[_0x6dca2e][_0x124aac(0x297)]=_0x2991eb;}),_0x1d8622[_0x2e366a(0x1ea)]((_0x3b3426,_0x2eb753)=>{var _0x3acd8a=_0x2e366a;_0x1b75b5[_0x2eb753][_0x3acd8a(0x24c)]=_0x3b3426;});const _0x2db2ff=_0x1b75b5[_0x2e366a(0x23e)](_0x32b05b=>_0x32b05b['quantity']!=='0'&&_0x32b05b['quantity']!=='');_0x4c738a[_0x2e366a(0x255)]=_0x3bd3cf,_0x4c738a[_0x2e366a(0x1ed)]=_0x4e0619,_0x4c738a['date']=_0x2c5a35,_0x4c738a['warehouse_name']=_0x49dcba,_0x4c738a[_0x2e366a(0x1bb)]=_0x2db2ff,_0x4c738a[_0x2e366a(0x240)]=_0x133450,_0x4c738a['paid_amount']=_0x5e12b2,_0x4c738a['due_amount']=_0x1426fb,_0x4c738a[_0x2e366a(0x1da)]=_0x27d479,_0x4c738a[_0x2e366a(0x26f)]=_0x4e0690,_0x4c738a[_0x2e366a(0x24b)]=_0x390a69;const _0x1cb570=await _0x4c738a[_0x2e366a(0x1ce)](),_0x3918f3=await warehouse[_0x2e366a(0x23c)]({'name':_0x22a0ec[_0x2e366a(0x1c3)][_0x2e366a(0x1fe)],'room':_0x22a0ec['body']['Room_name']});_0x4c738a[_0x2e366a(0x1bb)][_0x2e366a(0x1ea)](_0x1f5fb8=>{var _0x1b289d=_0x2e366a,_0x355ab5=0x0;const _0x5111f9=_0x3918f3[_0x1b289d(0x20e)]['map'](_0x304bc1=>{var _0x1b660a=_0x1b289d;_0x304bc1[_0x1b660a(0x243)]==_0x1f5fb8[_0x1b660a(0x243)]&&_0x304bc1[_0x1b660a(0x29f)]==_0x1f5fb8[_0x1b660a(0x29f)]&&(_0x304bc1[_0x1b660a(0x20a)]=parseInt(_0x304bc1[_0x1b660a(0x20a)])+parseInt(_0x1f5fb8[_0x1b660a(0x237)]),_0x355ab5++);});_0x355ab5=='0'&&(_0x3918f3['product_details']=_0x3918f3[_0x1b289d(0x20e)][_0x1b289d(0x1c5)]({'product_name':_0x1f5fb8[_0x1b289d(0x243)],'product_stock':_0x1f5fb8['quantity'],'primary_code':_0x1f5fb8['primary_code'],'secondary_code':_0x1f5fb8['secondary_code'],'product_code':_0x1f5fb8[_0x1b289d(0x26e)],'bay':_0x1f5fb8[_0x1b289d(0x29f)],'maxProducts':_0x1f5fb8[_0x1b289d(0x205)],'unit':_0x1f5fb8[_0x1b289d(0x281)],'secondary_unit':_0x1f5fb8[_0x1b289d(0x26d)],'expiry_date':_0x1f5fb8[_0x1b289d(0x24c)]}));}),await _0x3918f3[_0x2e366a(0x1ce)]();const _0x104fdc=await s_payment_data[_0x2e366a(0x23c)]({'invoice':_0x22a0ec['body'][_0x2e366a(0x255)]});if(_0x104fdc===null){}else console[_0x2e366a(0x27b)](_0x2e366a(0x1ed),_0x104fdc,_0x22a0ec[_0x2e366a(0x1c3)]['invoice']),_0x104fdc[_0x2e366a(0x1ed)]=_0x22a0ec['body']['suppliers'],await _0x104fdc[_0x2e366a(0x1ce)]();_0x22a0ec[_0x2e366a(0x1fd)](_0x2e366a(0x23d),_0x2e366a(0x286)),_0x120fa8[_0x2e366a(0x276)](_0x2e366a(0x218));}catch(_0x584ffa){console['log'](_0x584ffa);}}),router[a0_0x507890(0x22d)](a0_0x507890(0x1c2),auth,async(_0x598a63,_0x4b3677)=>{var _0x2270f4=a0_0x507890;try{const _0x33e754=_0x598a63['params']['id'],{invoice:_0x4de816,suppliers:_0x1843a3,payable:_0x545ec3,due_amount:_0x46b646}=_0x598a63[_0x2270f4(0x1c3)],_0x1fbd5e=await purchases['findById'](_0x33e754);var _0x202d28=_0x545ec3-_0x46b646;_0x1fbd5e['paid_amount']=parseFloat(_0x1fbd5e[_0x2270f4(0x23f)])+parseFloat(_0x46b646),_0x1fbd5e['due_amount']=_0x202d28;const _0x481334=await _0x1fbd5e[_0x2270f4(0x1ce)]();console[_0x2270f4(0x27b)](_0x481334);const _0x2206bb=await s_payment_data['findOne']({'invoice':_0x4de816});_0x2206bb['amount']=_0x202d28,await _0x2206bb[_0x2270f4(0x1ce)]();let _0x1db349=new Date(),_0x21c677=('0'+_0x1db349[_0x2270f4(0x223)]())[_0x2270f4(0x26b)](-0x2),_0x4989fc=('0'+(_0x1db349[_0x2270f4(0x1b0)]()+0x1))[_0x2270f4(0x26b)](-0x2),_0x3a6aff=_0x1db349[_0x2270f4(0x231)](),_0x5c5452=_0x3a6aff+'-'+_0x4989fc+'-'+_0x21c677;const _0x9c513=new suppliers_payment({'invoice':_0x4de816,'date':_0x3a6aff+'-'+_0x4989fc+'-'+_0x21c677,'suppliers':_0x1843a3,'reason':_0x2270f4(0x284),'amount':_0x46b646}),_0x2d1b04=await _0x9c513[_0x2270f4(0x1ce)]();_0x598a63[_0x2270f4(0x1fd)]('success',_0x2270f4(0x24f)),_0x4b3677['redirect'](_0x2270f4(0x234));}catch(_0x4258f0){console[_0x2270f4(0x27b)](_0x4258f0);}}),router[a0_0x507890(0x1e8)](a0_0x507890(0x264),auth,async(_0x32e850,_0x14aca7)=>{var _0x55b436=a0_0x507890;try{const {username:_0xf1fc22,email:_0xf77cdb,role:_0x9db128}=_0x32e850[_0x55b436(0x221)],_0xc6cf30=_0x32e850['user'],_0x3e616a=await profile[_0x55b436(0x23c)]({'email':_0xc6cf30[_0x55b436(0x1ee)]}),_0xbb3043=await master_shop['find']();console[_0x55b436(0x27b)](_0x55b436(0x1e3),_0xbb3043);const _0x456497=_0x32e850[_0x55b436(0x1f9)]['id'],_0x458ae8=await purchases[_0x55b436(0x28b)](_0x456497);console[_0x55b436(0x27b)](_0x458ae8);const _0x45088f=await suppliers[_0x55b436(0x23c)]({'name':_0x458ae8[_0x55b436(0x1ed)]});console[_0x55b436(0x27b)](_0x45088f);if(_0xbb3043[0x0][_0x55b436(0x21d)]==_0x55b436(0x285)){var _0x352ac1=users['English'];console['log'](_0x352ac1);}else{if(_0xbb3043[0x0][_0x55b436(0x21d)]==_0x55b436(0x1d1))var _0x352ac1=users[_0x55b436(0x1d1)];else{if(_0xbb3043[0x0][_0x55b436(0x21d)]==_0x55b436(0x1d6))var _0x352ac1=users['German'];else{if(_0xbb3043[0x0][_0x55b436(0x21d)]==_0x55b436(0x1d8))var _0x352ac1=users[_0x55b436(0x1d8)];else{if(_0xbb3043[0x0][_0x55b436(0x21d)]==_0x55b436(0x260))var _0x352ac1=users[_0x55b436(0x260)];else{if(_0xbb3043[0x0][_0x55b436(0x21d)]==_0x55b436(0x280))var _0x352ac1=users[_0x55b436(0x25d)];else{if(_0xbb3043[0x0]['language']==_0x55b436(0x1c0))var _0x352ac1=users[_0x55b436(0x1c0)];else{if(_0xbb3043[0x0][_0x55b436(0x21d)]=='Arabic\x20(ae)')var _0x352ac1=users[_0x55b436(0x253)];}}}}}}}_0x14aca7[_0x55b436(0x1e0)](_0x55b436(0x1c4),{'success':_0x32e850[_0x55b436(0x1fd)](_0x55b436(0x23d)),'errors':_0x32e850[_0x55b436(0x1fd)](_0x55b436(0x1cd)),'role':_0xc6cf30,'profile':_0x3e616a,'master_shop':_0xbb3043,'supplier':_0x45088f,'purchase':_0x458ae8,'language':_0x352ac1});}catch(_0xcd61e6){console['log'](_0xcd61e6);}}),router['get']('/view/return_purchase/:id',auth,async(_0x33f69a,_0x3bfbb5)=>{var _0x38f321=a0_0x507890;try{const {username:_0x453610,email:_0x1f04a0,role:_0x2f293b}=_0x33f69a['user'],_0x341d54=_0x33f69a['user'],_0x7bf11f=await profile[_0x38f321(0x23c)]({'email':_0x341d54[_0x38f321(0x1ee)]}),_0xb695de=await master_shop['find']();console[_0x38f321(0x27b)](_0x38f321(0x1e3),_0xb695de);const _0x3b72b6=_0x33f69a['params']['id'];console[_0x38f321(0x27b)](_0x3b72b6);const _0x4e5739=await purchases_finished[_0x38f321(0x28b)](_0x3b72b6);console[_0x38f321(0x27b)](_0x38f321(0x20f),_0x4e5739);const _0x4702d0=await product[_0x38f321(0x1c1)]({}),_0x48cc7c=await warehouse['aggregate']([{'$match':{'name':_0x4e5739[_0x38f321(0x1fe)],'room':_0x4e5739[_0x38f321(0x1da)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x38f321(0x242),'name':{'$first':_0x38f321(0x1e1)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x38f321(0x244)},'bin':{'$first':_0x38f321(0x214)},'type':{'$first':_0x38f321(0x2a5)},'floorlevel':{'$first':_0x38f321(0x256)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x38f321(0x229)},'storage':{'$first':_0x38f321(0x27c)},'rack':{'$first':_0x38f321(0x1de)}}}]);console[_0x38f321(0x27b)](_0x38f321(0x22c),_0x48cc7c);let _0xd17b12;if(_0x341d54[_0x38f321(0x247)]==_0x38f321(0x269)){const _0x5d8f5a=await staff[_0x38f321(0x23c)]({'email':_0x341d54['email']});_0xd17b12=await warehouse[_0x38f321(0x1c1)]({'status':_0x38f321(0x298),'name':_0x5d8f5a[_0x38f321(0x1fb)],'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'});}else _0xd17b12=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':_0x38f321(0x1ad)}},{'$group':{'_id':_0x38f321(0x262),'name':{'$first':'$name'}}}]);if(_0xb695de[0x0][_0x38f321(0x21d)]==_0x38f321(0x285)){var _0x210a39=users['English'];console[_0x38f321(0x27b)](_0x210a39);}else{if(_0xb695de[0x0][_0x38f321(0x21d)]==_0x38f321(0x1d1))var _0x210a39=users[_0x38f321(0x1d1)];else{if(_0xb695de[0x0][_0x38f321(0x21d)]==_0x38f321(0x1d6))var _0x210a39=users[_0x38f321(0x1d6)];else{if(_0xb695de[0x0][_0x38f321(0x21d)]==_0x38f321(0x1d8))var _0x210a39=users['Spanish'];else{if(_0xb695de[0x0]['language']=='French')var _0x210a39=users[_0x38f321(0x260)];else{if(_0xb695de[0x0][_0x38f321(0x21d)]=='Portuguese\x20(BR)')var _0x210a39=users['Portuguese'];else{if(_0xb695de[0x0][_0x38f321(0x21d)]==_0x38f321(0x1c0))var _0x210a39=users[_0x38f321(0x1c0)];else{if(_0xb695de[0x0][_0x38f321(0x21d)]=='Arabic\x20(ae)')var _0x210a39=users[_0x38f321(0x253)];}}}}}}}_0x3bfbb5[_0x38f321(0x1e0)](_0x38f321(0x288),{'success':_0x33f69a['flash'](_0x38f321(0x23d)),'errors':_0x33f69a[_0x38f321(0x1fd)](_0x38f321(0x1cd)),'role':_0x341d54,'profile':_0x7bf11f,'user':_0x4e5739,'stock':_0x48cc7c,'master_shop':_0xb695de,'product':_0x4702d0,'language':_0x210a39,'warehouse':_0xd17b12});}catch(_0x1725cb){console['log'](_0x1725cb);}}),router[a0_0x507890(0x22d)](a0_0x507890(0x1ff),auth,async(_0x38b8e4,_0x555240)=>{var _0x2fc0d8=a0_0x507890;try{const {invoice:_0x41136f,date:_0x2824be,warehouse_name:_0x1e280a,Room_name:_0x5cee8d,product_name:_0x433428,purchase_quantity:_0xd96bbd,stocks:_0x57c513,return_qty:_0x236559,note:_0x3500fe,level:_0x2b5d6c,isle:_0x4efc43,pallet:_0x21d21b,to_warehouse_name:_0xa0ac14,to_Room_name:_0x344284}=_0x38b8e4[_0x2fc0d8(0x1c3)],_0x45300b=await purchases_finished[_0x2fc0d8(0x23c)]({'_id':_0x38b8e4[_0x2fc0d8(0x1f9)]['id']}),_0xf93b97=await warehouse[_0x2fc0d8(0x23c)]({'name':_0x1e280a,'room':_0x5cee8d,'warehouse_category':_0x2fc0d8(0x251)});if(typeof _0x433428=='string')var _0x4e9103=[_0x38b8e4[_0x2fc0d8(0x1c3)]['product_name']],_0x314487=[_0x38b8e4[_0x2fc0d8(0x1c3)][_0x2fc0d8(0x230)]],_0x5e5b7b=[_0x38b8e4[_0x2fc0d8(0x1c3)][_0x2fc0d8(0x274)]],_0x392b02=[_0x38b8e4['body'][_0x2fc0d8(0x1db)]],_0xe8436e=[_0x38b8e4[_0x2fc0d8(0x1c3)][_0x2fc0d8(0x1e9)]],_0x4d31cc=[_0x38b8e4['body']['product_code_hide']],_0x46214a=[_0x38b8e4[_0x2fc0d8(0x1c3)][_0x2fc0d8(0x233)]],_0x41605f=[_0x38b8e4[_0x2fc0d8(0x1c3)]['secondary_code_hide']];else var _0x4e9103=[..._0x38b8e4[_0x2fc0d8(0x1c3)]['product_name']],_0x314487=[..._0x38b8e4[_0x2fc0d8(0x1c3)]['purchase_quantity']],_0x5e5b7b=[..._0x38b8e4['body']['stocks']],_0x392b02=[..._0x38b8e4['body'][_0x2fc0d8(0x1db)]],_0xe8436e=[..._0x38b8e4[_0x2fc0d8(0x1c3)]['level']],_0x4d31cc=[..._0x38b8e4[_0x2fc0d8(0x1c3)][_0x2fc0d8(0x1dd)]],_0x46214a=[..._0x38b8e4[_0x2fc0d8(0x1c3)][_0x2fc0d8(0x233)]],_0x41605f=[..._0x38b8e4[_0x2fc0d8(0x1c3)]['secondary_code_hide']];const _0x1798d1=_0x4e9103[_0x2fc0d8(0x208)](_0x545c9d=>{return _0x545c9d={'product_name':_0x545c9d};});_0x314487['forEach']((_0x2a3cb7,_0x4b211b)=>{var _0x1b05dc=_0x2fc0d8;_0x1798d1[_0x4b211b][_0x1b05dc(0x230)]=_0x2a3cb7;}),_0x5e5b7b['forEach']((_0xd9b60c,_0x1513ff)=>{var _0x3998f7=_0x2fc0d8;_0x1798d1[_0x1513ff][_0x3998f7(0x1be)]=_0xd9b60c;}),_0x392b02[_0x2fc0d8(0x1ea)]((_0x4c5c19,_0x479288)=>{var _0x30017e=_0x2fc0d8;_0x1798d1[_0x479288][_0x30017e(0x1db)]=_0x4c5c19;}),_0xe8436e[_0x2fc0d8(0x1ea)]((_0x793fbf,_0x58b5e3)=>{_0x1798d1[_0x58b5e3]['bay']=_0x793fbf;}),_0x4d31cc[_0x2fc0d8(0x1ea)]((_0x1fc9a9,_0x3f1c25)=>{_0x1798d1[_0x3f1c25]['product_code']=_0x1fc9a9;}),_0x46214a[_0x2fc0d8(0x1ea)]((_0x34b97e,_0x7ef0c3)=>{_0x1798d1[_0x7ef0c3]['primary_code']=_0x34b97e;}),_0x41605f[_0x2fc0d8(0x1ea)]((_0x546d58,_0x5efcad)=>{var _0x5b201f=_0x2fc0d8;_0x1798d1[_0x5efcad][_0x5b201f(0x210)]=_0x546d58;}),_0x1798d1[_0x2fc0d8(0x1ea)](_0x275ada=>{var _0x1f370a=_0x2fc0d8;console[_0x1f370a(0x27b)](_0x275ada);const _0x244a39=_0xf93b97['product_details'][_0x1f370a(0x208)](_0x4cb13c=>{var _0x2f6fd1=_0x1f370a;_0x4cb13c[_0x2f6fd1(0x243)]==_0x275ada['product_name']&&_0x4cb13c['bay']==_0x275ada[_0x2f6fd1(0x29f)]&&(console[_0x2f6fd1(0x27b)](parseInt(_0x4cb13c[_0x2f6fd1(0x20a)])+'\x20<>\x20'+parseInt(_0x275ada[_0x2f6fd1(0x1db)])),_0x4cb13c[_0x2f6fd1(0x20a)]=parseInt(_0x4cb13c[_0x2f6fd1(0x20a)])-parseInt(_0x275ada[_0x2f6fd1(0x1db)]));});}),await _0xf93b97['save']();var _0x10ffa9=0x0;_0x1798d1[_0x2fc0d8(0x1ea)](_0x42f994=>{var _0x38035c=_0x2fc0d8;(parseInt(_0x42f994[_0x38035c(0x230)])<parseInt(_0x42f994[_0x38035c(0x1db)])||parseInt(_0x42f994['stock_quantity'])<parseInt(_0x42f994[_0x38035c(0x1db)]))&&_0x10ffa9++;});if(_0x10ffa9!=0x0)return _0x38b8e4[_0x2fc0d8(0x1fd)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x555240[_0x2fc0d8(0x276)](_0x2fc0d8(0x259));const _0x59886c=new purchases_return_finished({'invoice':_0x41136f,'suppliers':_0x38b8e4['body'][_0x2fc0d8(0x1ed)],'date':_0x2824be,'warehouse_name':_0x1e280a,'return_product':_0x1798d1,'note':_0x3500fe,'room':_0x5cee8d,'to_warehouse_name':_0xa0ac14,'to_room':_0x344284}),_0x54245e=await _0x59886c[_0x2fc0d8(0x1ce)](),_0x4bce59=await purchases_return_finished[_0x2fc0d8(0x23c)]({'invoice':_0x41136f}),_0xe6523b=await warehouse[_0x2fc0d8(0x23c)]({'name':_0xa0ac14,'room':_0x344284,'warehouse_category':_0x2fc0d8(0x251)});_0x4bce59['return_product'][_0x2fc0d8(0x1ea)](_0x22f474=>{var _0x1303e8=_0x2fc0d8,_0x110232=0x0;const _0x519253=_0xe6523b[_0x1303e8(0x20e)]['map'](_0x5f3b5c=>{var _0x4970ae=_0x1303e8;console['log'](_0x5f3b5c[_0x4970ae(0x243)]+'=='+_0x22f474[_0x4970ae(0x243)]+'&&'+_0x5f3b5c['bay']+'=='+_0x22f474[_0x4970ae(0x29f)]),_0x5f3b5c[_0x4970ae(0x243)]==_0x22f474[_0x4970ae(0x243)]&&_0x5f3b5c[_0x4970ae(0x29f)]==_0x22f474['bay']&&(_0x5f3b5c[_0x4970ae(0x20a)]=parseInt(_0x5f3b5c[_0x4970ae(0x20a)])-parseInt(_0x22f474[_0x4970ae(0x1db)]),_0x110232++);});_0x110232=='0'&&(_0xe6523b[_0x1303e8(0x20e)]=_0xe6523b[_0x1303e8(0x20e)][_0x1303e8(0x1c5)]({'product_name':_0x22f474[_0x1303e8(0x243)],'product_stock':_0x22f474[_0x1303e8(0x1db)],'primary_code':_0x22f474['primary_code'],'secondary_code':_0x22f474[_0x1303e8(0x210)],'product_code':_0x22f474[_0x1303e8(0x26e)],'bay':_0x22f474[_0x1303e8(0x29f)],'maxProducts':0xf423f}));}),await _0xe6523b[_0x2fc0d8(0x1ce)]();const _0x35cef1=await purchases_finished['findOne']({'invoice':_0x41136f});_0x35cef1[_0x2fc0d8(0x277)]=_0x2fc0d8(0x27d);const _0x43e5aa=await _0x35cef1[_0x2fc0d8(0x1ce)](),_0x1fd98f=new s_payment_data({'invoice':_0x41136f,'suppliers':_0x38b8e4[_0x2fc0d8(0x1c3)][_0x2fc0d8(0x1ed)],'reason':_0x2fc0d8(0x2a3)});await _0x1fd98f[_0x2fc0d8(0x1ce)]();const _0xfa6997=await master_shop[_0x2fc0d8(0x1c1)](),_0x3c263d=await email_settings[_0x2fc0d8(0x23c)](),_0x3efd66=await suppliers[_0x2fc0d8(0x23c)]({'name':_0x38b8e4[_0x2fc0d8(0x1c3)][_0x2fc0d8(0x1ed)]});_0xfa6997[0x0][_0x2fc0d8(0x1ec)]==0x1?(right_currency=_0xfa6997[0x0][_0x2fc0d8(0x291)],left_currency=''):(right_currency='',left_currency=_0xfa6997[0x0]['currency']);var _0x165677=_0x4e9103,_0xf2af73=_0x392b02,_0x1f335c='',_0x2f218a;for(_0x2f218a in _0x165677){_0x1f335c+='<tr>'+_0x2fc0d8(0x27a)+_0x165677[_0x2f218a]+_0x2fc0d8(0x252)+_0x2fc0d8(0x27a)+_0xf2af73[_0x2f218a]+_0x2fc0d8(0x252)+_0x2fc0d8(0x1fc);}let _0x310fd9=nodemailer[_0x2fc0d8(0x25c)]({'service':_0x2fc0d8(0x271),'auth':{'user':_0x3c263d[_0x2fc0d8(0x1ee)],'pass':_0x3c263d[_0x2fc0d8(0x1df)]}}),_0x15825f={'from':_0x3c263d[_0x2fc0d8(0x1ee)],'to':_0x3efd66[_0x2fc0d8(0x1ee)],'subject':_0x2fc0d8(0x250),'attachments':[{'filename':_0x2fc0d8(0x20c),'path':__dirname+'/../public'+'/upload/'+_0xfa6997[0x0][_0x2fc0d8(0x1ae)],'cid':_0x2fc0d8(0x1bd)}],'html':_0x2fc0d8(0x1fa)+_0x2fc0d8(0x2a0)+_0x2fc0d8(0x1b3)+'<div>'+_0x2fc0d8(0x21e)+'<div>'+_0x2fc0d8(0x1d4)+_0x2fc0d8(0x1cb)+_0x2fc0d8(0x1ba)+'<h2>\x20'+_0xfa6997[0x0][_0x2fc0d8(0x275)]+_0x2fc0d8(0x249)+_0x2fc0d8(0x1cb)+_0x2fc0d8(0x1cb)+'<hr\x20class=\x22my-3\x22>'+_0x2fc0d8(0x1ba)+_0x2fc0d8(0x1f4)+_0x2fc0d8(0x29c)+_0x41136f+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2fc0d8(0x21f)+_0x2824be+'\x20'+_0x2fc0d8(0x1f6)+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2fc0d8(0x296)+_0x2fc0d8(0x270)+_0x2fc0d8(0x1f5)+_0x2fc0d8(0x24a)+_0x2fc0d8(0x20d)+_0x2fc0d8(0x268)+_0x2fc0d8(0x1fc)+_0x2fc0d8(0x1e5)+_0x2fc0d8(0x273)+'\x20'+_0x1f335c+'\x20'+_0x2fc0d8(0x1cc)+_0x2fc0d8(0x1d3)+_0x2fc0d8(0x1ba)+_0x2fc0d8(0x206)+_0x2fc0d8(0x1cf)+_0xfa6997[0x0]['site_title']+_0x2fc0d8(0x1c8)+_0x2fc0d8(0x1cb)+'</div>'+_0x2fc0d8(0x201)};_0x310fd9[_0x2fc0d8(0x26a)](_0x15825f,function(_0x178446,_0x104b8c){var _0x597947=_0x2fc0d8;_0x178446?console['log'](_0x597947(0x213)):console[_0x597947(0x27b)](_0x597947(0x248));}),_0x38b8e4[_0x2fc0d8(0x1fd)]('success','purchases\x20item\x20return\x20successfull'),_0x555240[_0x2fc0d8(0x276)](_0x2fc0d8(0x218));}catch(_0xc2fb87){_0x555240[_0x2fc0d8(0x261)](0xc8)[_0x2fc0d8(0x1dc)]({'message':_0xc2fb87[_0x2fc0d8(0x1f8)]});}}),router[a0_0x507890(0x1e8)]('/barcode/:id',auth,async(_0x479d66,_0x3c72e0)=>{var _0x5f49b2=a0_0x507890;try{const {username:_0x365f1f,email:_0x679ef3,role:_0x1bf4d9}=_0x479d66[_0x5f49b2(0x221)],_0x595eed=_0x479d66[_0x5f49b2(0x221)],_0x464498=await profile[_0x5f49b2(0x23c)]({'email':_0x595eed['email']}),_0x10caa2=await master_shop['find'](),_0x5acc7c=_0x479d66[_0x5f49b2(0x1f9)]['id'],_0x5ab6c5=await purchases_finished['findById'](_0x5acc7c);if(_0x10caa2[0x0]['language']==_0x5f49b2(0x285))var _0x4625ef=users[_0x5f49b2(0x246)];else{if(_0x10caa2[0x0][_0x5f49b2(0x21d)]=='Hindi')var _0x4625ef=users[_0x5f49b2(0x1d1)];else{if(_0x10caa2[0x0]['language']=='German')var _0x4625ef=users[_0x5f49b2(0x1d6)];else{if(_0x10caa2[0x0][_0x5f49b2(0x21d)]==_0x5f49b2(0x1d8))var _0x4625ef=users[_0x5f49b2(0x1d8)];else{if(_0x10caa2[0x0][_0x5f49b2(0x21d)]=='French')var _0x4625ef=users[_0x5f49b2(0x260)];else{if(_0x10caa2[0x0]['language']==_0x5f49b2(0x280))var _0x4625ef=users['Portuguese'];else{if(_0x10caa2[0x0][_0x5f49b2(0x21d)]=='Chinese')var _0x4625ef=users[_0x5f49b2(0x1c0)];else{if(_0x10caa2[0x0][_0x5f49b2(0x21d)]==_0x5f49b2(0x23b))var _0x4625ef=users['Arabic'];}}}}}}}_0x3c72e0[_0x5f49b2(0x1e0)](_0x5f49b2(0x202),{'success':_0x479d66['flash']('success'),'errors':_0x479d66[_0x5f49b2(0x1fd)]('errors'),'role':_0x595eed,'profile':_0x464498,'alldata':_0x5ab6c5,'master_shop':_0x10caa2,'language':_0x4625ef}),console[_0x5f49b2(0x27b)](alldata);}catch(_0x593fef){console[_0x5f49b2(0x27b)](_0x593fef);}}),router[a0_0x507890(0x22d)](a0_0x507890(0x1bc),async(_0x276883,_0x2cb4f9)=>{var _0x4e3078=a0_0x507890;const {product_code:_0x16c568}=_0x276883[_0x4e3078(0x1c3)];var _0x35673b;const _0x42d8d5=await product[_0x4e3078(0x207)]([{'$match':{'primary_code':_0x16c568,'product_category':_0x4e3078(0x251)}},{'$group':{'_id':_0x4e3078(0x22a),'name':{'$first':'$name'},'category':{'$first':_0x4e3078(0x215)},'brand':{'$first':_0x4e3078(0x22e)},'unit':{'$first':_0x4e3078(0x290)},'alertquantity':{'$first':_0x4e3078(0x1e7)},'product_code':{'$first':_0x4e3078(0x272)},'primary_code':{'$first':_0x4e3078(0x267)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x4e3078(0x24e)},'maxProdPerUnit':{'$first':_0x4e3078(0x1b1)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4e3078(0x283)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2d85f7=await product[_0x4e3078(0x207)]([{'$match':{'secondary_code':_0x16c568}},{'$group':{'_id':_0x4e3078(0x22a),'name':{'$first':_0x4e3078(0x262)},'category':{'$first':'$category'},'brand':{'$first':_0x4e3078(0x22e)},'unit':{'$first':_0x4e3078(0x290)},'alertquantity':{'$first':_0x4e3078(0x1e7)},'product_code':{'$first':_0x4e3078(0x272)},'primary_code':{'$first':_0x4e3078(0x267)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x42d8d5[_0x4e3078(0x23a)]>0x0)_0x35673b=_0x42d8d5;else _0x2d85f7[_0x4e3078(0x23a)]>0x0&&(_0x35673b=_0x2d85f7);_0x2cb4f9[_0x4e3078(0x1dc)](_0x35673b);}),router[a0_0x507890(0x22d)](a0_0x507890(0x27e),async(_0x1e2c3e,_0x38d210)=>{var _0x1e8231=a0_0x507890;const {productCode:_0x26dc64,bay:_0x2b2b91,warehouses:_0x179a13,room:_0x5af4fd}=_0x1e2c3e['body'];console[_0x1e8231(0x27b)](_0x1e2c3e[_0x1e8231(0x1c3)]);try{const _0x5767b7=await warehouse[_0x1e8231(0x207)]([{'$match':{'name':_0x179a13,'room':_0x5af4fd}},{'$unwind':_0x1e8231(0x1bf)},{'$match':{'product_details.bay':parseInt(_0x2b2b91)}},{'$group':{'_id':_0x1e8231(0x242),'name':{'$first':_0x1e8231(0x1e1)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1e8231(0x244)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x38d210[_0x1e8231(0x261)](0xc8)[_0x1e8231(0x1dc)](_0x5767b7);}catch(_0x7bb314){_0x38d210[_0x1e8231(0x261)](0x194)[_0x1e8231(0x1dc)]({'message':_0x7bb314[_0x1e8231(0x1f8)]});}}),module[a0_0x507890(0x2a1)]=router;