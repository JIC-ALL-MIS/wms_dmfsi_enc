var a0_0x5cb86d=a0_0x2671;function a0_0x2671(_0x3acea9,_0x36c680){var _0x145636=a0_0x1456();return a0_0x2671=function(_0x267109,_0x1ecff3){_0x267109=_0x267109-0x176;var _0x2a4951=_0x145636[_0x267109];return _0x2a4951;},a0_0x2671(_0x3acea9,_0x36c680);}(function(_0x49daa2,_0x2018d3){var _0x5b23cc=a0_0x2671,_0x53a42a=_0x49daa2();while(!![]){try{var _0xfe2510=parseInt(_0x5b23cc(0x20d))/0x1+parseInt(_0x5b23cc(0x19d))/0x2+-parseInt(_0x5b23cc(0x19c))/0x3+parseInt(_0x5b23cc(0x231))/0x4*(-parseInt(_0x5b23cc(0x1cd))/0x5)+-parseInt(_0x5b23cc(0x270))/0x6*(-parseInt(_0x5b23cc(0x1c1))/0x7)+-parseInt(_0x5b23cc(0x215))/0x8*(parseInt(_0x5b23cc(0x204))/0x9)+parseInt(_0x5b23cc(0x211))/0xa*(parseInt(_0x5b23cc(0x18e))/0xb);if(_0xfe2510===_0x2018d3)break;else _0x53a42a['push'](_0x53a42a['shift']());}catch(_0x51a82f){_0x53a42a['push'](_0x53a42a['shift']());}}}(a0_0x1456,0x503c5));const express=require(a0_0x5cb86d(0x223)),app=express(),router=express[a0_0x5cb86d(0x23f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x5cb86d(0x20b)),auth=require(a0_0x5cb86d(0x18b)),nodemailer=require(a0_0x5cb86d(0x18a));var ejs=require('ejs');const path=require('path'),users=require(a0_0x5cb86d(0x258));function a0_0x1456(){var _0x23ac1d=['errors','Spanish','purchase_invoice','6izJAtG','currency','</body></html>','$product.bay','params','prod_unit','/all_purchases_finished/view','master','<strong>\x20Regards\x20</strong>','currency_placement','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','then','get','payment\x20successfull','$_id','$name','Rack\x202','due_amount','French','True','password','expiry_date','$suppliers','/all_purchases/view','/CheckingWarehouse','floor','nodemailer','../middleware/auth','product_date','edit_purchases_finished_view','11YiUbuz','$date','An\x20error\x20occurred\x20while\x20saving\x20data.','paid_amount','<html><head><title></title>','message','back','Room_name','$secondary_unit','note','string','abs','$product.bin','purchases\x20item\x20return\x20successfull','373023CBoQUJ','1309790NEklkQ','all','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<hr\x20class=\x22my-3\x22>','$invoice','Portuguese','$unit','user_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.storage','$product.floorlevel','return_product','standard_unit','$product','find','max_product_unit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</head><body>','product_stock','Arabic','render','$secondary_code','Rack\x201','/barcode/:id','$suppliers_docs','$product_details.bay','<table\x20style=\x22width:\x20100%\x20!important;\x22>','log','/invoice/:id','/../public','$return_data','save','invoice','all_purchases_finished','primary_code_hide','prod_secondunit','1618610ZQrQkc','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','body','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_code_hide','success','$product_details.maxProducts','post','random','product_code','product','1200235stYYnl','/view/add_purchases/:id','Paid\x20For\x20Purchase','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','level','stocks','English','Portuguese\x20(BR)','$product.quantity','status','prod_level','$paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','forEach','prod_Qty','/give_payment/:id','maxperunit','$product_code','createTransport','English\x20(US)','$product_details','site_title','$room','findOne','batch_code','product_details','json','image','warehouse_name','return_purchase_finished','getDate','logo','getMonth','$product_details._id','all_purchases_barcode','</div>','$warehouse_name','slice','$category','\x20Order\x20Date\x20:\x20','$product_details.type','MaxStocks_data','Chinese','German','getFullYear','suppliers','map','$alertquantity','<div>','Logo.png','prod_cat','port','$product_details.product_name','$product_details.bin','Return\x20Goods','36Mxvbow','\x20</h2>','secondary_unit','</h5>','<h2>\x20','product_cat','$brand','../models/all_models','staff','31744FQIPOA','$batch_code','prod_primunit','Email\x20sent\x20successfully','535390hWxLzR','$product_details.secondary_code','/view/return_purchase/:id','length','76656DhSaZe','<h5>','findById','$maxStocks','Enabled','DRY\x20GOODS','\x20Order\x20Number\x20:\x20','<tr>','/view/:id','prod_code','<!DOCTYPE\x20html>','Arabic\x20(ae)','secondary_code_hide','secondary_code','express','/barcode_scanner','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/preview/:id','table\x20page','Finished\x20Goods','</td>','warehouse','return_data','$expiry_date','suppliers_docs','<h5\x20style=\x22text-align:\x20left;\x22>','/view','8UYJytU','Ambient','primary_code','/view/add_purchases','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</span>','email','$primary_code','$product_details.primary_code','$product_details.product_stock','$due_amount','RoomAssign','date','Router','$product_details.floorlevel','Enclosed','gmail','</table>','concat','</thead>','</tr>','stock_data','purchase_quantity','error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','purchase\x20data\x20update\x20successfully','role','bay','prod_qty','$product.type','flash','aggregate','quantity','</tbody>','filter','$note','/upload/','language','../public/language/languages.json','catch','$maxProdPerUnit','maxStocks','room','INCF-','room_name','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','return_qty','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Error\x20Occurs','$product.room_name','FROZEN\x20GOODS','<span\x20style=\x22float:\x20right;\x22>','QA\x20Warehouse','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','product_name','$product_details.rack'];a0_0x1456=function(){return _0x23ac1d;};return a0_0x1456();}router['get'](a0_0x5cb86d(0x230),auth,async(_0x46c7f7,_0x4d4953)=>{var _0x2039d3=a0_0x5cb86d;try{const {username:_0x164735,email:_0x31f7a4,role:_0x1943a8}=_0x46c7f7[_0x2039d3(0x1c2)],_0x5e0897=_0x46c7f7['user'],_0x33fe5d=await profile[_0x2039d3(0x1e4)]({'email':_0x5e0897[_0x2039d3(0x238)]}),_0x1a4c8a=await staff[_0x2039d3(0x1e4)]({'email':_0x5e0897[_0x2039d3(0x238)]});if(_0x5e0897[_0x2039d3(0x24c)]==_0x2039d3(0x20c)){const _0x4d9692=await staff['findOne']({'email':_0x5e0897['email']});}const _0x1dbdb4=await master_shop['find']();let _0x1d00f6;if(_0x5e0897['role']==_0x2039d3(0x20c)){const _0x57527c=await staff['findOne']({'email':_0x5e0897[_0x2039d3(0x238)]});_0x1d00f6=await purchases_finished[_0x2039d3(0x251)]([{'$match':{'warehouse_name':_0x57527c[_0x2039d3(0x22b)]}},{'$lookup':{'from':_0x2039d3(0x1fa),'localField':_0x2039d3(0x1fa),'foreignField':'name','as':_0x2039d3(0x22e)}},{'$unwind':_0x2039d3(0x1b5)},{'$unwind':_0x2039d3(0x1aa)},{'$group':{'_id':'$_id','invoice':{'$first':_0x2039d3(0x1a1)},'suppliers':{'$first':_0x2039d3(0x186)},'date':{'$first':_0x2039d3(0x18f)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x2039d3(0x1e3)},'product':{'$push':_0x2039d3(0x1aa)},'note':{'$first':_0x2039d3(0x255)},'paid_amount':{'$first':_0x2039d3(0x1d8)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x2039d3(0x1bb)},'batch_code':{'$first':_0x2039d3(0x20e)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2039d3(0x1b5)},'total_product_quantity':{'$sum':_0x2039d3(0x1d5)},'level':{'$addToSet':_0x2039d3(0x273)},'isle':{'$addToSet':_0x2039d3(0x19a)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2039d3(0x1a7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1d00f6=await purchases_finished[_0x2039d3(0x251)]([{'$unwind':_0x2039d3(0x1aa)},{'$group':{'_id':_0x2039d3(0x17e),'invoice':{'$first':_0x2039d3(0x1a1)},'suppliers':{'$first':_0x2039d3(0x186)},'date':{'$first':_0x2039d3(0x18f)},'warehouse_name':{'$first':_0x2039d3(0x1f1)},'room':{'$addToSet':_0x2039d3(0x265)},'product':{'$push':'$product'},'note':{'$first':_0x2039d3(0x255)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x2039d3(0x23c)},'return_data':{'$first':_0x2039d3(0x1bb)},'batch_code':{'$first':_0x2039d3(0x20e)},'expiry_date':{'$first':_0x2039d3(0x22d)},'suppliers_docs':{'$first':_0x2039d3(0x1b5)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2039d3(0x273)},'isle':{'$addToSet':_0x2039d3(0x19a)},'type':{'$addToSet':_0x2039d3(0x24f)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x1dbdb4[0x0]['language']==_0x2039d3(0x1e0))var _0x3f08f5=users[_0x2039d3(0x1d3)];else{if(_0x1dbdb4[0x0][_0x2039d3(0x257)]==_0x2039d3(0x269))var _0x3f08f5=users[_0x2039d3(0x269)];else{if(_0x1dbdb4[0x0][_0x2039d3(0x257)]==_0x2039d3(0x1f8))var _0x3f08f5=users[_0x2039d3(0x1f8)];else{if(_0x1dbdb4[0x0][_0x2039d3(0x257)]==_0x2039d3(0x26e))var _0x3f08f5=users[_0x2039d3(0x26e)];else{if(_0x1dbdb4[0x0]['language']==_0x2039d3(0x182))var _0x3f08f5=users[_0x2039d3(0x182)];else{if(_0x1dbdb4[0x0][_0x2039d3(0x257)]==_0x2039d3(0x1d4))var _0x3f08f5=users[_0x2039d3(0x1a2)];else{if(_0x1dbdb4[0x0][_0x2039d3(0x257)]==_0x2039d3(0x1f7))var _0x3f08f5=users[_0x2039d3(0x1f7)];else{if(_0x1dbdb4[0x0][_0x2039d3(0x257)]=='Arabic\x20(ae)')var _0x3f08f5=users[_0x2039d3(0x1b0)];}}}}}}}_0x4d4953[_0x2039d3(0x1b1)](_0x2039d3(0x1be),{'success':_0x46c7f7[_0x2039d3(0x250)]('success'),'errors':_0x46c7f7[_0x2039d3(0x250)](_0x2039d3(0x26d)),'purchases':_0x1d00f6,'role':_0x5e0897,'profile':_0x33fe5d,'master_shop':_0x1dbdb4,'language':_0x3f08f5});}catch(_0x44c20f){console[_0x2039d3(0x1b8)](_0x2039d3(0x228),_0x44c20f),_0x4d4953[_0x2039d3(0x1d6)](0xc8)[_0x2039d3(0x1e7)]({'message':_0x44c20f[_0x2039d3(0x193)]});}});function BayBinSelected(_0x2f3ba2,_0xdff39b){var _0x24488e=a0_0x5cb86d,_0x31d30f=[],_0x29c7f7=[];if(_0x2f3ba2==_0x24488e(0x21a)){switch(_0xdff39b){case _0x24488e(0x1b3):_0x31d30f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x24488e(0x180):_0x31d30f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x29c7f7=['DG'];}else{if(_0x2f3ba2==_0x24488e(0x266)){switch(_0xdff39b){case _0x24488e(0x1b3):_0x31d30f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x24488e(0x180):_0x31d30f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x29c7f7=['FG'];}}return{'levels':_0x31d30f,'identify':_0x29c7f7};}async function getRandom8DigitNumber(){var _0x27123d=a0_0x5cb86d;const _0x440258=0x989680,_0x1d1455=0x5f5e0ff,_0x47c4cb=Math[_0x27123d(0x189)](Math[_0x27123d(0x1ca)]()*(_0x1d1455-_0x440258+0x1))+_0x440258;var _0x540ee3;const _0x40da1e=await purchases_finished[_0x27123d(0x1e4)]({'invoice':_0x27123d(0x25d)+_0x47c4cb});return _0x40da1e&&_0x40da1e[_0x27123d(0x214)]>0x0?_0x540ee3=_0x27123d(0x25d)+_0x47c4cb:_0x540ee3=_0x27123d(0x25d)+_0x47c4cb,_0x540ee3;}router[a0_0x5cb86d(0x17c)](a0_0x5cb86d(0x234),auth,async(_0x5ddae9,_0x3899d8)=>{var _0x40e48e=a0_0x5cb86d;try{const {username:_0x3c3f55,email:_0x1845bb,role:_0x478ba0}=_0x5ddae9[_0x40e48e(0x1c2)],_0x3a14d9=_0x5ddae9['user'],_0x1a4317=await profile[_0x40e48e(0x1e4)]({'email':_0x3a14d9[_0x40e48e(0x238)]}),_0x15a9ce=await master_shop['find'](),_0x54dd6d=await staff[_0x40e48e(0x1e4)]({'email':_0x3a14d9[_0x40e48e(0x238)]}),_0x276c25=await suppliers['find']({});let _0x3dd64e;if(_0x3a14d9['role']==_0x40e48e(0x20c)){const _0x3c8f4c=await staff[_0x40e48e(0x1e4)]({'email':_0x3a14d9[_0x40e48e(0x238)]});_0x3dd64e=await warehouse[_0x40e48e(0x251)]([{'$match':{'status':'Enabled','name':_0x3c8f4c[_0x40e48e(0x22b)],'warehouse_category':_0x40e48e(0x229)}},{'$group':{'_id':_0x40e48e(0x17f),'name':{'$first':_0x40e48e(0x17f)}}}]);}else _0x3dd64e=await warehouse['aggregate']([{'$match':{'status':_0x40e48e(0x219),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x40e48e(0x268)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x58e410=await product[_0x40e48e(0x1ab)]({}),_0x26ac81=await warehouse[_0x40e48e(0x1ab)]({'status':_0x40e48e(0x219)}),_0x143fa0=await purchases_finished['find']({}),_0x83697f=_0x143fa0[_0x40e48e(0x214)]+0x1,_0x3028a5=_0x40e48e(0x25d)+_0x83697f['toString']()['padStart'](0x5,'0');var _0x4d7fc0=[_0x40e48e(0x232),_0x40e48e(0x241)];if(_0x15a9ce[0x0][_0x40e48e(0x257)]==_0x40e48e(0x1e0))var _0x1a0c8f=users[_0x40e48e(0x1d3)];else{if(_0x15a9ce[0x0][_0x40e48e(0x257)]==_0x40e48e(0x269))var _0x1a0c8f=users[_0x40e48e(0x269)];else{if(_0x15a9ce[0x0][_0x40e48e(0x257)]==_0x40e48e(0x1f8))var _0x1a0c8f=users['German'];else{if(_0x15a9ce[0x0][_0x40e48e(0x257)]==_0x40e48e(0x26e))var _0x1a0c8f=users[_0x40e48e(0x26e)];else{if(_0x15a9ce[0x0]['language']==_0x40e48e(0x182))var _0x1a0c8f=users[_0x40e48e(0x182)];else{if(_0x15a9ce[0x0]['language']==_0x40e48e(0x1d4))var _0x1a0c8f=users[_0x40e48e(0x1a2)];else{if(_0x15a9ce[0x0][_0x40e48e(0x257)]=='Chinese')var _0x1a0c8f=users[_0x40e48e(0x1f7)];else{if(_0x15a9ce[0x0][_0x40e48e(0x257)]==_0x40e48e(0x220))var _0x1a0c8f=users[_0x40e48e(0x1b0)];}}}}}}}const _0x49bb22=getRandom8DigitNumber();_0x49bb22[_0x40e48e(0x17b)](_0x3d59ab=>{var _0x2a3305=_0x40e48e;_0x3899d8['render']('add_purchases_finished',{'success':_0x5ddae9[_0x2a3305(0x250)](_0x2a3305(0x1c7)),'errors':_0x5ddae9['flash'](_0x2a3305(0x26d)),'role':_0x3a14d9,'profile':_0x1a4317,'suppliers':_0x276c25,'warehouse':_0x3dd64e,'product':_0x58e410,'invoice':_0x3d59ab,'master_shop':_0x15a9ce,'language':_0x1a0c8f,'find_data':_0x26ac81,'rooms_data':_0x4d7fc0});})['catch'](_0x3b396f=>{var _0x2d58f7=_0x40e48e;_0x5ddae9[_0x2d58f7(0x250)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3899d8['redirect'](_0x2d58f7(0x176));});}catch(_0x43a04c){console[_0x40e48e(0x1b8)](_0x43a04c);}}),router['get'](a0_0x5cb86d(0x1ce),auth,async(_0x53ee30,_0x1e675a)=>{var _0x1db082=a0_0x5cb86d;try{const _0x5ab8df=_0x53ee30[_0x1db082(0x274)]['id'];console['log'](_0x5ab8df);const _0x3fdda2=await master_shop[_0x1db082(0x1ab)]();console[_0x1db082(0x1b8)](_0x1db082(0x177),_0x3fdda2);const _0xa43ab3=await product[_0x1db082(0x1e4)]({'name':_0x5ab8df});console[_0x1db082(0x1b8)]('product',_0xa43ab3),_0x1e675a['status'](0xc8)[_0x1db082(0x1e7)]({'product_data':_0xa43ab3,'master':_0x3fdda2});}catch(_0x278953){console[_0x1db082(0x1b8)]('add_purchases\x20error',_0x278953);}}),router[a0_0x5cb86d(0x1c9)]('/view/add_purchases',auth,async(_0x2f2258,_0x5f2377)=>{var _0x2d1b71=a0_0x5cb86d;try{const {invoice:_0x2bd2f7,date:_0x93fe39,warehouse_name:_0x1e7575,prod_name:_0x34a14a,prod_code:_0x24a72d,prod_qty:_0x550829,prod_unit:_0x2a8b72,prod_secondunit:_0x2829de,prod_level:_0x33b30c,prod_isle:_0x356f2a,prod_pallet:_0x57250f,note:_0x4804ca,expiry_date:_0x24ad2a,batch_code:_0xf7ec3e,payable:_0x5c3f7a,due_amount:_0x5b5eff,Room_name:_0x38cd98,primary_code:_0x12d03c,secondary_code:_0x3e11c9,MaxStocks_data:_0x1d1644,PO_number:_0x423c0c,SCRN:_0x444d5c,JO_number:_0x34ef1f}=_0x2f2258[_0x2d1b71(0x1c4)];if(typeof _0x34a14a==_0x2d1b71(0x198))var _0x491135=[_0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x262)]],_0x11302b=[_0x2f2258['body']['prod_code']],_0x2403e8=[_0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x1db)]],_0x419f42=[_0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x20f)]],_0x394d55=[_0x2f2258[_0x2d1b71(0x1c4)]['prod_secondunit']],_0x5d2249=[_0x2f2258['body'][_0x2d1b71(0x1d7)]],_0x43ea98=[_0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x233)]],_0x2b2604=[_0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x222)]],_0x1529be=[_0x2f2258[_0x2d1b71(0x1c4)]['MaxStocks_data']],_0x26f65b=[_0x2f2258['body'][_0x2d1b71(0x1e5)]],_0x2478cf=[_0x2f2258['body']['expiry_date']],_0x4afb34=[_0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x18c)]],_0x415310=[_0x2f2258[_0x2d1b71(0x1c4)]['max_product_unit']],_0x36142e=[_0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x1ff)]],_0x2e1a14=[_0x2f2258['body'][_0x2d1b71(0x23d)]],_0x2750d4=[_0x2f2258['body']['prod_invoice']];else var _0x491135=[..._0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x262)]],_0x11302b=[..._0x2f2258[_0x2d1b71(0x1c4)]['prod_code']],_0x2403e8=[..._0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x1db)]],_0x419f42=[..._0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x20f)]],_0x394d55=[..._0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x1c0)]],_0x5d2249=[..._0x2f2258['body'][_0x2d1b71(0x1d7)]],_0x43ea98=[..._0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x233)]],_0x2b2604=[..._0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x222)]],_0x1529be=[..._0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x1f6)]],_0x26f65b=[..._0x2f2258['body']['batch_code']],_0x2478cf=[..._0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x185)]],_0x4afb34=[..._0x2f2258['body'][_0x2d1b71(0x18c)]],_0x415310=[..._0x2f2258['body'][_0x2d1b71(0x1ac)]],_0x36142e=[..._0x2f2258[_0x2d1b71(0x1c4)][_0x2d1b71(0x1ff)]],_0x2e1a14=[..._0x2f2258['body'][_0x2d1b71(0x23d)]],_0x2750d4=[..._0x2f2258[_0x2d1b71(0x1c4)]['prod_invoice']];const _0x4926ac=_0x491135[_0x2d1b71(0x1fb)](_0x3b27fe=>{return _0x3b27fe={'product_name':_0x3b27fe};});_0x11302b[_0x2d1b71(0x1da)]((_0x57d079,_0x3f59b8)=>{var _0x2a0d1e=_0x2d1b71;_0x4926ac[_0x3f59b8][_0x2a0d1e(0x1cb)]=_0x57d079;}),_0x2403e8[_0x2d1b71(0x1da)]((_0x2323ae,_0x4e1e2f)=>{var _0x345729=_0x2d1b71;_0x4926ac[_0x4e1e2f][_0x345729(0x252)]=Math[_0x345729(0x199)](_0x2323ae);}),_0x419f42[_0x2d1b71(0x1da)]((_0x1e5b41,_0xf98fbf)=>{var _0x5d692c=_0x2d1b71;_0x4926ac[_0xf98fbf][_0x5d692c(0x1a9)]=_0x1e5b41;}),_0x394d55[_0x2d1b71(0x1da)]((_0x5398fb,_0xdcfeee)=>{_0x4926ac[_0xdcfeee]['secondary_unit']=_0x5398fb;}),_0x5d2249['forEach']((_0x2a7f11,_0x10d2c2)=>{var _0x239c2b=_0x2d1b71;_0x4926ac[_0x10d2c2][_0x239c2b(0x24d)]=_0x2a7f11;}),_0x43ea98[_0x2d1b71(0x1da)]((_0x26dfe0,_0x4dafb9)=>{var _0x319093=_0x2d1b71;_0x4926ac[_0x4dafb9][_0x319093(0x233)]=_0x26dfe0;}),_0x2b2604['forEach']((_0xbd05fc,_0x406ffb)=>{_0x4926ac[_0x406ffb]['secondary_code']=_0xbd05fc;}),_0x1529be[_0x2d1b71(0x1da)]((_0x534bb8,_0x2a7c2)=>{var _0x5d0e35=_0x2d1b71;_0x4926ac[_0x2a7c2][_0x5d0e35(0x25b)]=_0x534bb8;}),_0x26f65b[_0x2d1b71(0x1da)]((_0x202261,_0x2f08fd)=>{_0x4926ac[_0x2f08fd]['batch_code']=_0x202261;}),_0x2478cf['forEach']((_0x4c0f10,_0x1c64f4)=>{var _0x17f4df=_0x2d1b71;_0x4926ac[_0x1c64f4][_0x17f4df(0x185)]=_0x4c0f10;}),_0x4afb34[_0x2d1b71(0x1da)]((_0x1ec476,_0x4dea91)=>{var _0x1635a0=_0x2d1b71;_0x4926ac[_0x4dea91][_0x1635a0(0x235)]=_0x1ec476;}),_0x415310[_0x2d1b71(0x1da)]((_0x29d674,_0x7df7a0)=>{var _0x3156f3=_0x2d1b71;_0x4926ac[_0x7df7a0][_0x3156f3(0x1dd)]=_0x29d674;}),_0x36142e['forEach']((_0x144884,_0x17d788)=>{var _0x4095c7=_0x2d1b71;_0x4926ac[_0x17d788][_0x4095c7(0x209)]=_0x144884;}),_0x2e1a14[_0x2d1b71(0x1da)]((_0x1a24c3,_0x38cc9f)=>{var _0x1b47aa=_0x2d1b71;_0x4926ac[_0x38cc9f][_0x1b47aa(0x25e)]=_0x1a24c3;}),_0x2750d4[_0x2d1b71(0x1da)]((_0x563f24,_0x5a0aea)=>{var _0x5d7321=_0x2d1b71;_0x4926ac[_0x5a0aea][_0x5d7321(0x1bd)]=_0x563f24;});const _0x1a8c1c=_0x4926ac[_0x2d1b71(0x254)](_0x242e1d=>_0x242e1d[_0x2d1b71(0x252)]!=='0'&&_0x242e1d[_0x2d1b71(0x252)]!==''),_0x128d32=new purchases_finished({'invoice':_0x2bd2f7,'suppliers':_0x2f2258[_0x2d1b71(0x1c4)]['suppliers'],'date':_0x93fe39,'warehouse_name':_0x1e7575,'product':_0x1a8c1c,'note':_0x4804ca,'due_amount':_0x5b5eff,'room':_0x38cd98,'POnumber':_0x423c0c,'SCRN':_0x444d5c,'JO_number':_0x34ef1f}),_0x46c017=await _0x128d32[_0x2d1b71(0x1bc)](),_0x3ebee4=await purchases_finished['findOne']({'invoice':_0x2bd2f7}),_0x4ff6ba=_0x3ebee4[_0x2d1b71(0x1cc)][_0x2d1b71(0x1fb)](async _0x7debcd=>{var _0x498fa8=_0x2d1b71;try{var _0x429afb=await warehouse[_0x498fa8(0x1e4)]({'name':_0x1e7575,'room':_0x7debcd[_0x498fa8(0x25e)]}),_0x503868=0x0;const _0x269ac5=_0x429afb[_0x498fa8(0x1e6)][_0x498fa8(0x1fb)](_0x4b8c7d=>{var _0x47a6ec=_0x498fa8;console['log'](_0x4b8c7d[_0x47a6ec(0x26b)]+'=='+_0x7debcd[_0x47a6ec(0x26b)]+'&&'+_0x4b8c7d['bay']+'=='+_0x7debcd[_0x47a6ec(0x24d)]+'&&'+_0x4b8c7d[_0x47a6ec(0x185)]+'=='+_0x7debcd[_0x47a6ec(0x185)]+'&&'+_0x4b8c7d[_0x47a6ec(0x235)]+'=='+_0x7debcd[_0x47a6ec(0x235)]+'&&'+_0x4b8c7d['batch_code']+'=='+_0x7debcd[_0x47a6ec(0x1e5)]+'&&'+_0x4b8c7d[_0x47a6ec(0x1bd)]+'=='+_0x3ebee4[_0x47a6ec(0x1bd)]),_0x4b8c7d[_0x47a6ec(0x26b)]==_0x7debcd[_0x47a6ec(0x26b)]&&_0x4b8c7d[_0x47a6ec(0x24d)]==_0x7debcd[_0x47a6ec(0x24d)]&&_0x4b8c7d[_0x47a6ec(0x185)]==_0x7debcd[_0x47a6ec(0x185)]&&_0x4b8c7d[_0x47a6ec(0x235)]==_0x7debcd[_0x47a6ec(0x235)]&&_0x4b8c7d['batch_code']==_0x7debcd[_0x47a6ec(0x1e5)]&&_0x4b8c7d[_0x47a6ec(0x1bd)]==_0x3ebee4[_0x47a6ec(0x1bd)]&&(_0x4b8c7d['product_stock']=Math['abs'](_0x4b8c7d[_0x47a6ec(0x1af)])+Math[_0x47a6ec(0x199)](_0x7debcd[_0x47a6ec(0x252)]),_0x503868++);});return _0x503868==0x0&&(_0x429afb[_0x498fa8(0x1e6)]=_0x429afb[_0x498fa8(0x1e6)]['concat']({'product_name':_0x7debcd[_0x498fa8(0x26b)],'product_stock':Math[_0x498fa8(0x199)](_0x7debcd[_0x498fa8(0x252)]),'primary_code':_0x7debcd['primary_code'],'secondary_code':_0x7debcd['secondary_code'],'product_code':_0x7debcd[_0x498fa8(0x1cb)],'bay':_0x7debcd['bay'],'maxProducts':_0x7debcd['maxStocks'],'unit':_0x7debcd['standard_unit'],'secondary_unit':_0x7debcd['secondary_unit'],'expiry_date':_0x7debcd['expiry_date'],'production_date':_0x7debcd[_0x498fa8(0x235)],'maxProducts':_0x7debcd[_0x498fa8(0x25b)],'maxPerUnit':_0x7debcd[_0x498fa8(0x1dd)],'batch_code':_0x7debcd[_0x498fa8(0x1e5)],'product_cat':_0x7debcd[_0x498fa8(0x209)],'invoice':_0x7debcd['invoice'],'id_incoming':_0x7debcd['_id']})),_0x429afb;}catch(_0xc2e79d){return console[_0x498fa8(0x249)]('Error\x20occurred\x20while\x20processing\x20product:',_0xc2e79d),null;}});Promise[_0x2d1b71(0x19e)](_0x4ff6ba)['then'](async _0x5344a4=>{var _0x391fae=_0x2d1b71;try{for(const _0x4cea68 of _0x5344a4){await warehouse['updateOne']({'_id':_0x4cea68[_0x391fae(0x25f)]},{'$addToSet':{'product_details':{'$each':_0x4cea68[_0x391fae(0x1e6)]}}});}const _0x5ae6ca=await master_shop['find'](),_0x50fdde=await email_settings[_0x391fae(0x1e4)](),_0x5a09fe=await supervisor_settings['find']();var _0x360bfa=_0x3ebee4[_0x391fae(0x1cc)],_0x101edb='',_0x39055;for(_0x39055 in _0x360bfa){var _0x2a84ae='FG';_0x3ebee4[_0x391fae(0x1e9)]=='DRY\x20GOODS'&&(_0x2a84ae='DG'),_0x101edb+=_0x391fae(0x21c)+_0x391fae(0x19f)+_0x360bfa[_0x39055][_0x391fae(0x26b)]+'</td>'+_0x391fae(0x19f)+_0x360bfa[_0x39055][_0x391fae(0x1cb)]+_0x391fae(0x22a)+_0x391fae(0x19f)+_0x360bfa[_0x39055][_0x391fae(0x252)]+'</td>'+_0x391fae(0x19f)+_0x360bfa[_0x39055][_0x391fae(0x1a9)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x360bfa[_0x39055][_0x391fae(0x206)]+_0x391fae(0x22a)+_0x391fae(0x19f)+_0x3ebee4[_0x391fae(0x1e9)]+'</td>'+_0x391fae(0x19f)+_0x360bfa[_0x39055]['room_name']+_0x391fae(0x22a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a84ae+_0x360bfa[_0x39055][_0x391fae(0x24d)]+_0x391fae(0x22a),_0x391fae(0x246);}let _0x32b01f=nodemailer[_0x391fae(0x1df)]({'host':_0x50fdde['host'],'port':Number(_0x50fdde[_0x391fae(0x200)]),'secure':![],'auth':{'user':_0x50fdde[_0x391fae(0x238)],'pass':_0x50fdde[_0x391fae(0x184)]}}),_0x5186e0={'from':_0x50fdde[_0x391fae(0x238)],'to':_0x5a09fe[0x0]['FGSEmail'],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x391fae(0x1fe),'path':__dirname+'/../public'+_0x391fae(0x256)+_0x5ae6ca[0x0][_0x391fae(0x1e8)],'cid':_0x391fae(0x1ec)}],'html':_0x391fae(0x21f)+_0x391fae(0x192)+_0x391fae(0x1ae)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x391fae(0x1fd)+_0x391fae(0x1ad)+_0x391fae(0x1f0)+'<div>'+_0x391fae(0x208)+_0x5ae6ca[0x0][_0x391fae(0x1e2)]+_0x391fae(0x205)+_0x391fae(0x1f0)+'</div>'+_0x391fae(0x1a0)+_0x391fae(0x1fd)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x391fae(0x21b)+_0x3ebee4[_0x391fae(0x1bd)]+'\x20'+_0x391fae(0x267)+_0x391fae(0x1f4)+_0x3ebee4[_0x391fae(0x23e)]+'\x20'+_0x391fae(0x237)+_0x391fae(0x207)+_0x391fae(0x1f0)+_0x391fae(0x1b7)+_0x391fae(0x1c5)+_0x391fae(0x21c)+_0x391fae(0x226)+_0x391fae(0x24a)+_0x391fae(0x236)+_0x391fae(0x1c3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x391fae(0x1a5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x391fae(0x26a)+'</tr>'+_0x391fae(0x245)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x101edb+'\x20'+_0x391fae(0x253)+'</table>'+'<div>'+_0x391fae(0x178)+_0x391fae(0x216)+_0x5ae6ca[0x0]['site_title']+_0x391fae(0x207)+_0x391fae(0x1f0)+_0x391fae(0x1f0)+_0x391fae(0x272)};_0x32b01f['sendMail'](_0x5186e0,function(_0x29c08b,_0x20fa28){var _0x263423=_0x391fae;_0x29c08b?(console[_0x263423(0x1b8)](_0x29c08b),console[_0x263423(0x1b8)]('Error\x20Occurs')):console[_0x263423(0x1b8)]('Email\x20sent\x20successfully');});}catch(_0x363d65){console[_0x391fae(0x249)](_0x363d65),_0x5f2377[_0x391fae(0x1d6)](0x1f4)[_0x391fae(0x1e7)]({'error':_0x391fae(0x190),'message':_0x363d65[_0x391fae(0x193)]});}})[_0x2d1b71(0x259)](_0x1792db=>{var _0x1bc2b9=_0x2d1b71;console[_0x1bc2b9(0x249)](_0x1792db);}),_0x2f2258[_0x2d1b71(0x250)](_0x2d1b71(0x1c7),'purchase\x20data\x20add\x20successfully'),_0x5f2377['redirect'](_0x2d1b71(0x176));}catch(_0x22b124){console[_0x2d1b71(0x1b8)](_0x22b124);}}),router[a0_0x5cb86d(0x17c)](a0_0x5cb86d(0x227),auth,async(_0x32c095,_0x48a0c0)=>{var _0x54a78b=a0_0x5cb86d;try{const {username:_0xb2d56c,email:_0x57bf2c,role:_0xf88ff7}=_0x32c095[_0x54a78b(0x1c2)],_0xc6467c=_0x32c095['user'],_0x1d22fb=await profile['findOne']({'email':_0xc6467c[_0x54a78b(0x238)]}),_0x4a9308=await master_shop[_0x54a78b(0x1ab)](),_0x4ddf1a=_0x32c095[_0x54a78b(0x274)]['id'],_0x3f3cfe=await purchases_finished['findById'](_0x4ddf1a),_0xafca9b=await suppliers[_0x54a78b(0x1ab)]({});let _0x43605a;if(_0xc6467c[_0x54a78b(0x24c)]==_0x54a78b(0x20c)){const _0x1e506d=await staff[_0x54a78b(0x1e4)]({'email':_0xc6467c[_0x54a78b(0x238)]});_0x43605a=await warehouse[_0x54a78b(0x1ab)]({'status':_0x54a78b(0x219),'name':_0x1e506d['warehouse'],'warehouse_category':_0x54a78b(0x229)});}else _0x43605a=await warehouse[_0x54a78b(0x251)]([{'$match':{'status':_0x54a78b(0x219),'warehouse_category':_0x54a78b(0x229)}},{'$group':{'_id':_0x54a78b(0x17f),'name':{'$first':_0x54a78b(0x17f)}}}]);const _0x153f61=await product[_0x54a78b(0x1ab)]({}),_0x41e250=BayBinSelected(_0x3f3cfe['warehouse_name'],_0x3f3cfe[_0x54a78b(0x25c)]);let _0x202531=new Date(_0x3f3cfe['expiry_date']),_0x5899c6=('0'+_0x202531[_0x54a78b(0x1eb)]())[_0x54a78b(0x1f2)](-0x2),_0x53c9d6=('0'+(_0x202531[_0x54a78b(0x1ed)]()+0x1))[_0x54a78b(0x1f2)](-0x2),_0x5210ae=_0x202531[_0x54a78b(0x1f9)](),_0x2a552b=_0x5210ae+'-'+_0x53c9d6+'-'+_0x5899c6;if(_0x4a9308[0x0][_0x54a78b(0x257)]=='English\x20(US)'){var _0x4870f2=users[_0x54a78b(0x1d3)];console[_0x54a78b(0x1b8)](_0x4870f2);}else{if(_0x4a9308[0x0]['language']==_0x54a78b(0x269))var _0x4870f2=users[_0x54a78b(0x269)];else{if(_0x4a9308[0x0][_0x54a78b(0x257)]==_0x54a78b(0x1f8))var _0x4870f2=users['German'];else{if(_0x4a9308[0x0]['language']==_0x54a78b(0x26e))var _0x4870f2=users[_0x54a78b(0x26e)];else{if(_0x4a9308[0x0][_0x54a78b(0x257)]==_0x54a78b(0x182))var _0x4870f2=users[_0x54a78b(0x182)];else{if(_0x4a9308[0x0]['language']==_0x54a78b(0x1d4))var _0x4870f2=users['Portuguese'];else{if(_0x4a9308[0x0][_0x54a78b(0x257)]=='Chinese')var _0x4870f2=users[_0x54a78b(0x1f7)];else{if(_0x4a9308[0x0][_0x54a78b(0x257)]==_0x54a78b(0x220))var _0x4870f2=users[_0x54a78b(0x1b0)];}}}}}}}_0x48a0c0[_0x54a78b(0x1b1)](_0x54a78b(0x18d),{'success':_0x32c095[_0x54a78b(0x250)]('success'),'errors':_0x32c095[_0x54a78b(0x250)]('errors'),'role':_0xc6467c,'profile':_0x1d22fb,'purchases':_0x3f3cfe,'suppliers':_0xafca9b,'warehouse':_0x43605a,'product':_0x153f61,'master_shop':_0x4a9308,'language':_0x4870f2,'ed_fullDate':_0x2a552b,'dataSelected':_0x41e250});}catch(_0x30eb1d){console[_0x54a78b(0x1b8)](_0x30eb1d);}}),router['get'](a0_0x5cb86d(0x21d),auth,async(_0x49e004,_0x3c0490)=>{var _0x1565b5=a0_0x5cb86d;try{const {username:_0x4d7c18,email:_0x4c3940,role:_0x426eeb}=_0x49e004[_0x1565b5(0x1c2)],_0x57d002=_0x49e004['user'],_0x2fe29b=await profile[_0x1565b5(0x1e4)]({'email':_0x57d002[_0x1565b5(0x238)]}),_0x397eba=await master_shop[_0x1565b5(0x1ab)](),_0x43e7a7=_0x49e004[_0x1565b5(0x274)]['id'],_0x20577c=await purchases_finished[_0x1565b5(0x217)](_0x43e7a7),_0x4237d7=await suppliers['find']({});let _0x36d9be;if(_0x57d002[_0x1565b5(0x24c)]=='staff'){const _0x35e577=await staff[_0x1565b5(0x1e4)]({'email':_0x57d002[_0x1565b5(0x238)]});_0x36d9be=await warehouse[_0x1565b5(0x1ab)]({'status':'Enabled','name':_0x35e577[_0x1565b5(0x22b)],'warehouse_category':_0x1565b5(0x229)});}else _0x36d9be=await warehouse['aggregate']([{'$match':{'status':_0x1565b5(0x219),'warehouse_category':_0x1565b5(0x229)}},{'$group':{'_id':'$name','name':{'$first':_0x1565b5(0x17f)}}}]);const _0x71e4ed=await product['find']({}),_0x13d921=BayBinSelected(_0x20577c[_0x1565b5(0x1e9)],_0x20577c[_0x1565b5(0x25c)]);let _0x2af178=new Date(_0x20577c['expiry_date']),_0x1f7ab1=('0'+_0x2af178[_0x1565b5(0x1eb)]())[_0x1565b5(0x1f2)](-0x2),_0x2c34d0=('0'+(_0x2af178[_0x1565b5(0x1ed)]()+0x1))[_0x1565b5(0x1f2)](-0x2),_0x287bc9=_0x2af178[_0x1565b5(0x1f9)](),_0x42a211=_0x287bc9+'-'+_0x2c34d0+'-'+_0x1f7ab1;if(_0x397eba[0x0]['language']=='English\x20(US)'){var _0x2b55b9=users[_0x1565b5(0x1d3)];console[_0x1565b5(0x1b8)](_0x2b55b9);}else{if(_0x397eba[0x0][_0x1565b5(0x257)]==_0x1565b5(0x269))var _0x2b55b9=users[_0x1565b5(0x269)];else{if(_0x397eba[0x0][_0x1565b5(0x257)]=='German')var _0x2b55b9=users[_0x1565b5(0x1f8)];else{if(_0x397eba[0x0][_0x1565b5(0x257)]==_0x1565b5(0x26e))var _0x2b55b9=users[_0x1565b5(0x26e)];else{if(_0x397eba[0x0][_0x1565b5(0x257)]=='French')var _0x2b55b9=users['French'];else{if(_0x397eba[0x0][_0x1565b5(0x257)]==_0x1565b5(0x1d4))var _0x2b55b9=users[_0x1565b5(0x1a2)];else{if(_0x397eba[0x0][_0x1565b5(0x257)]==_0x1565b5(0x1f7))var _0x2b55b9=users[_0x1565b5(0x1f7)];else{if(_0x397eba[0x0]['language']==_0x1565b5(0x220))var _0x2b55b9=users['Arabic'];}}}}}}}_0x3c0490[_0x1565b5(0x1b1)]('edit_purchases_finished',{'success':_0x49e004[_0x1565b5(0x250)](_0x1565b5(0x1c7)),'errors':_0x49e004[_0x1565b5(0x250)](_0x1565b5(0x26d)),'role':_0x57d002,'profile':_0x2fe29b,'purchases':_0x20577c,'suppliers':_0x4237d7,'warehouse':_0x36d9be,'product':_0x71e4ed,'master_shop':_0x397eba,'language':_0x2b55b9,'ed_fullDate':_0x42a211,'dataSelected':_0x13d921});}catch(_0x34232e){console[_0x1565b5(0x1b8)](_0x34232e);}}),router[a0_0x5cb86d(0x1c9)](a0_0x5cb86d(0x21d),auth,async(_0x1ca9f1,_0x4c91de)=>{var _0x8ce89=a0_0x5cb86d;try{const _0x5200fb=_0x1ca9f1['params']['id'],_0x293897=await purchases_finished[_0x8ce89(0x1e4)]({'_id':_0x1ca9f1[_0x8ce89(0x274)]['id']}),_0x279252=await warehouse[_0x8ce89(0x1e4)]({'name':_0x293897[_0x8ce89(0x1e9)],'room':_0x293897['room']});_0x293897[_0x8ce89(0x1cc)][_0x8ce89(0x1da)](_0x253dda=>{var _0x4386f8=_0x8ce89;const _0x4cb6bd=_0x279252[_0x4386f8(0x1e6)]['map'](_0x149272=>{var _0x41863e=_0x4386f8;_0x149272[_0x41863e(0x26b)]==_0x253dda[_0x41863e(0x26b)]&&_0x149272[_0x41863e(0x24d)]==_0x253dda[_0x41863e(0x24d)]&&(_0x149272[_0x41863e(0x1af)]=parseInt(_0x149272['product_stock'])-parseInt(_0x253dda[_0x41863e(0x252)]));});}),await _0x279252[_0x8ce89(0x1bc)]();const {invoice:_0x51c966,suppliers:_0x395620,date:_0x396596,warehouse_name:_0x470c76,prod_name:_0x2fc686,prod_code:_0x235a04,prod_qty:_0x5ab3aa,prod_unit:_0x2fee35,prod_secondunit:_0x39c088,prod_level:_0x2fb9b5,prod_isle:_0x7026f0,prod_pallet:_0x556ab7,note:_0x37043f,expiry_date:_0x3641bd,batch_code:_0x570b5c,paid_amount:_0x2c6e0d,due_amount:_0x312b65,Room_name:_0x533ec5,primary_code:_0x360a81,secondary_code:_0x173f39,PO_number:_0x1f7939,JO_number:_0x1fbccd}=_0x1ca9f1[_0x8ce89(0x1c4)];if(typeof _0x2fc686==_0x8ce89(0x198))var _0x40d397=[_0x1ca9f1['body'][_0x8ce89(0x262)]],_0x4651dc=[_0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x21e)]],_0x310c40=[_0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x24e)]],_0x40974d=[_0x1ca9f1['body'][_0x8ce89(0x275)]],_0x5cd783=[_0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x1c0)]],_0x476d8b=[_0x1ca9f1['body']['prod_level']],_0x3cd55b=[_0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x233)]],_0x46bd04=[_0x1ca9f1[_0x8ce89(0x1c4)]['secondary_code']],_0x2d4fd6=[_0x1ca9f1[_0x8ce89(0x1c4)]['MaxStocks_data']],_0x5aa762=[_0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x1e5)]],_0xf32aa=[_0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x185)]];else var _0x40d397=[..._0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x262)]],_0x4651dc=[..._0x1ca9f1[_0x8ce89(0x1c4)]['prod_code']],_0x310c40=[..._0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x24e)]],_0x40974d=[..._0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x275)]],_0x5cd783=[..._0x1ca9f1[_0x8ce89(0x1c4)]['prod_secondunit']],_0x476d8b=[..._0x1ca9f1[_0x8ce89(0x1c4)]['prod_level']],_0x3cd55b=[..._0x1ca9f1[_0x8ce89(0x1c4)]['primary_code']],_0x46bd04=[..._0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x222)]],_0x2d4fd6=[..._0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x1f6)]],_0x5aa762=[..._0x1ca9f1['body'][_0x8ce89(0x1e5)]],_0xf32aa=[..._0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x185)]];const _0x20c9c1=_0x40d397[_0x8ce89(0x1fb)](_0x232e30=>{return _0x232e30={'product_name':_0x232e30};});_0x4651dc[_0x8ce89(0x1da)]((_0x4f978c,_0x38eefb)=>{var _0x3d018e=_0x8ce89;_0x20c9c1[_0x38eefb][_0x3d018e(0x1cb)]=_0x4f978c;}),_0x310c40[_0x8ce89(0x1da)]((_0x4d476f,_0x25e4e7)=>{var _0x45167a=_0x8ce89;_0x20c9c1[_0x25e4e7][_0x45167a(0x252)]=_0x4d476f;}),_0x40974d['forEach']((_0x2073e9,_0x5dc8fa)=>{var _0x956b76=_0x8ce89;_0x20c9c1[_0x5dc8fa][_0x956b76(0x1a9)]=_0x2073e9;}),_0x5cd783[_0x8ce89(0x1da)]((_0x5730c8,_0x1dc8cb)=>{_0x20c9c1[_0x1dc8cb]['secondary_unit']=_0x5730c8;}),_0x476d8b['forEach']((_0x1e2a29,_0xb9a302)=>{var _0x4e675e=_0x8ce89;_0x20c9c1[_0xb9a302][_0x4e675e(0x24d)]=_0x1e2a29;}),_0x3cd55b[_0x8ce89(0x1da)]((_0x3650d4,_0x33f334)=>{var _0x2ed541=_0x8ce89;_0x20c9c1[_0x33f334][_0x2ed541(0x233)]=_0x3650d4;}),_0x46bd04[_0x8ce89(0x1da)]((_0xa5f272,_0x357ee9)=>{_0x20c9c1[_0x357ee9]['secondary_code']=_0xa5f272;}),_0x2d4fd6['forEach']((_0x2bd229,_0x3edb3c)=>{var _0x2bda05=_0x8ce89;_0x20c9c1[_0x3edb3c][_0x2bda05(0x25b)]=_0x2bd229;}),_0x5aa762['forEach']((_0x24ca74,_0x1f8e73)=>{var _0x44cf66=_0x8ce89;_0x20c9c1[_0x1f8e73][_0x44cf66(0x1e5)]=_0x24ca74;}),_0xf32aa['forEach']((_0x4e1dc5,_0x156b23)=>{var _0x13f31c=_0x8ce89;_0x20c9c1[_0x156b23][_0x13f31c(0x185)]=_0x4e1dc5;});const _0xbeedc8=_0x20c9c1['filter'](_0xc56784=>_0xc56784[_0x8ce89(0x252)]!=='0'&&_0xc56784['quantity']!=='');_0x293897[_0x8ce89(0x1bd)]=_0x51c966,_0x293897[_0x8ce89(0x1fa)]=_0x395620,_0x293897[_0x8ce89(0x23e)]=_0x396596,_0x293897['warehouse_name']=_0x470c76,_0x293897['product']=_0xbeedc8,_0x293897[_0x8ce89(0x197)]=_0x37043f,_0x293897[_0x8ce89(0x191)]=_0x2c6e0d,_0x293897[_0x8ce89(0x181)]=_0x312b65,_0x293897[_0x8ce89(0x25c)]=_0x533ec5,_0x293897['POnumber']=_0x1f7939,_0x293897['JO_number']=_0x1fbccd;const _0x5dda44=await _0x293897[_0x8ce89(0x1bc)](),_0x2d6432=await warehouse['findOne']({'name':_0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x1e9)],'room':_0x1ca9f1['body'][_0x8ce89(0x195)]});_0x293897[_0x8ce89(0x1cc)][_0x8ce89(0x1da)](_0x586f90=>{var _0x56e89e=_0x8ce89,_0x2cbcf8=0x0;const _0xe463bd=_0x2d6432[_0x56e89e(0x1e6)][_0x56e89e(0x1fb)](_0x49726d=>{var _0x1d197c=_0x56e89e;_0x49726d[_0x1d197c(0x26b)]==_0x586f90[_0x1d197c(0x26b)]&&_0x49726d[_0x1d197c(0x24d)]==_0x586f90[_0x1d197c(0x24d)]&&(_0x49726d[_0x1d197c(0x1af)]=parseInt(_0x49726d[_0x1d197c(0x1af)])+parseInt(_0x586f90['quantity']),_0x2cbcf8++);});_0x2cbcf8=='0'&&(_0x2d6432['product_details']=_0x2d6432['product_details']['concat']({'product_name':_0x586f90['product_name'],'product_stock':_0x586f90['quantity'],'primary_code':_0x586f90[_0x56e89e(0x233)],'secondary_code':_0x586f90['secondary_code'],'product_code':_0x586f90['product_code'],'bay':_0x586f90['bay'],'maxProducts':_0x586f90[_0x56e89e(0x25b)],'unit':_0x586f90[_0x56e89e(0x1a9)],'secondary_unit':_0x586f90[_0x56e89e(0x206)],'expiry_date':_0x586f90[_0x56e89e(0x185)]}));}),await _0x2d6432[_0x8ce89(0x1bc)]();const _0x31b0bb=await s_payment_data[_0x8ce89(0x1e4)]({'invoice':_0x1ca9f1[_0x8ce89(0x1c4)]['invoice']});if(_0x31b0bb===null){}else console['log'](_0x8ce89(0x1fa),_0x31b0bb,_0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x1bd)]),_0x31b0bb[_0x8ce89(0x1fa)]=_0x1ca9f1[_0x8ce89(0x1c4)][_0x8ce89(0x1fa)],await _0x31b0bb[_0x8ce89(0x1bc)]();_0x1ca9f1[_0x8ce89(0x250)](_0x8ce89(0x1c7),_0x8ce89(0x24b)),_0x4c91de[_0x8ce89(0x225)]('/all_purchases_finished/view');}catch(_0x36ac2e){console[_0x8ce89(0x1b8)](_0x36ac2e);}}),router['post'](a0_0x5cb86d(0x1dc),auth,async(_0x5ddb30,_0x417d1d)=>{var _0x60e2a2=a0_0x5cb86d;try{const _0x41162f=_0x5ddb30[_0x60e2a2(0x274)]['id'],{invoice:_0x23ba40,suppliers:_0x34cc90,payable:_0x458ac4,due_amount:_0x5cb3d5}=_0x5ddb30[_0x60e2a2(0x1c4)],_0x129804=await purchases[_0x60e2a2(0x217)](_0x41162f);var _0x102788=_0x458ac4-_0x5cb3d5;_0x129804[_0x60e2a2(0x191)]=parseFloat(_0x129804[_0x60e2a2(0x191)])+parseFloat(_0x5cb3d5),_0x129804[_0x60e2a2(0x181)]=_0x102788;const _0x5c25e1=await _0x129804[_0x60e2a2(0x1bc)]();console['log'](_0x5c25e1);const _0x27fc50=await s_payment_data['findOne']({'invoice':_0x23ba40});_0x27fc50['amount']=_0x102788,await _0x27fc50[_0x60e2a2(0x1bc)]();let _0x2c8fa7=new Date(),_0x32768d=('0'+_0x2c8fa7[_0x60e2a2(0x1eb)]())[_0x60e2a2(0x1f2)](-0x2),_0x5d5771=('0'+(_0x2c8fa7[_0x60e2a2(0x1ed)]()+0x1))[_0x60e2a2(0x1f2)](-0x2),_0x515dcb=_0x2c8fa7['getFullYear'](),_0x1b76d6=_0x515dcb+'-'+_0x5d5771+'-'+_0x32768d;const _0x59bd83=new suppliers_payment({'invoice':_0x23ba40,'date':_0x515dcb+'-'+_0x5d5771+'-'+_0x32768d,'suppliers':_0x34cc90,'reason':_0x60e2a2(0x1cf),'amount':_0x5cb3d5}),_0x41f76b=await _0x59bd83[_0x60e2a2(0x1bc)]();_0x5ddb30[_0x60e2a2(0x250)]('success',_0x60e2a2(0x17d)),_0x417d1d[_0x60e2a2(0x225)](_0x60e2a2(0x187));}catch(_0x283d43){console['log'](_0x283d43);}}),router['get'](a0_0x5cb86d(0x1b9),auth,async(_0x2f84a6,_0x2b8de4)=>{var _0x38f64a=a0_0x5cb86d;try{const {username:_0x22e6be,email:_0x4c27cf,role:_0x198410}=_0x2f84a6[_0x38f64a(0x1c2)],_0x51c265=_0x2f84a6['user'],_0x3a0f3d=await profile[_0x38f64a(0x1e4)]({'email':_0x51c265[_0x38f64a(0x238)]}),_0x5bb12b=await master_shop[_0x38f64a(0x1ab)]();console[_0x38f64a(0x1b8)](_0x38f64a(0x177),_0x5bb12b);const _0x3e63b8=_0x2f84a6['params']['id'],_0x246161=await purchases[_0x38f64a(0x217)](_0x3e63b8);console[_0x38f64a(0x1b8)](_0x246161);const _0x124d51=await suppliers['findOne']({'name':_0x246161[_0x38f64a(0x1fa)]});console['log'](_0x124d51);if(_0x5bb12b[0x0][_0x38f64a(0x257)]==_0x38f64a(0x1e0)){var _0x3070ab=users['English'];console['log'](_0x3070ab);}else{if(_0x5bb12b[0x0][_0x38f64a(0x257)]==_0x38f64a(0x269))var _0x3070ab=users['Hindi'];else{if(_0x5bb12b[0x0][_0x38f64a(0x257)]==_0x38f64a(0x1f8))var _0x3070ab=users[_0x38f64a(0x1f8)];else{if(_0x5bb12b[0x0][_0x38f64a(0x257)]==_0x38f64a(0x26e))var _0x3070ab=users[_0x38f64a(0x26e)];else{if(_0x5bb12b[0x0]['language']==_0x38f64a(0x182))var _0x3070ab=users[_0x38f64a(0x182)];else{if(_0x5bb12b[0x0][_0x38f64a(0x257)]==_0x38f64a(0x1d4))var _0x3070ab=users[_0x38f64a(0x1a2)];else{if(_0x5bb12b[0x0][_0x38f64a(0x257)]=='Chinese')var _0x3070ab=users[_0x38f64a(0x1f7)];else{if(_0x5bb12b[0x0][_0x38f64a(0x257)]==_0x38f64a(0x220))var _0x3070ab=users['Arabic'];}}}}}}}_0x2b8de4[_0x38f64a(0x1b1)](_0x38f64a(0x26f),{'success':_0x2f84a6[_0x38f64a(0x250)](_0x38f64a(0x1c7)),'errors':_0x2f84a6['flash'](_0x38f64a(0x26d)),'role':_0x51c265,'profile':_0x3a0f3d,'master_shop':_0x5bb12b,'supplier':_0x124d51,'purchase':_0x246161,'language':_0x3070ab});}catch(_0x1aa603){console[_0x38f64a(0x1b8)](_0x1aa603);}}),router[a0_0x5cb86d(0x17c)](a0_0x5cb86d(0x213),auth,async(_0x5e78e5,_0x4c79ad)=>{var _0x2a582f=a0_0x5cb86d;try{const {username:_0x34c8f1,email:_0x80dcf1,role:_0x2c2720}=_0x5e78e5['user'],_0x5ec000=_0x5e78e5[_0x2a582f(0x1c2)],_0xd7373c=await profile[_0x2a582f(0x1e4)]({'email':_0x5ec000['email']}),_0x13ea79=await master_shop[_0x2a582f(0x1ab)]();console[_0x2a582f(0x1b8)](_0x2a582f(0x177),_0x13ea79);const _0x4faa3c=_0x5e78e5[_0x2a582f(0x274)]['id'];console[_0x2a582f(0x1b8)](_0x4faa3c);const _0x5d9a45=await purchases_finished[_0x2a582f(0x217)](_0x4faa3c);console[_0x2a582f(0x1b8)](_0x2a582f(0x1a4),_0x5d9a45);const _0x83c3c1=await product[_0x2a582f(0x1ab)]({}),_0x3f8310=await warehouse['aggregate']([{'$match':{'name':_0x5d9a45[_0x2a582f(0x1e9)],'room':_0x5d9a45[_0x2a582f(0x25c)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2a582f(0x1ee),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x2a582f(0x1b6)},'bin':{'$first':_0x2a582f(0x202)},'type':{'$first':_0x2a582f(0x1f5)},'floorlevel':{'$first':_0x2a582f(0x240)},'primary_code':{'$first':_0x2a582f(0x23a)},'secondary_code':{'$first':_0x2a582f(0x212)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2a582f(0x1a6)},'rack':{'$first':_0x2a582f(0x26c)}}}]);console[_0x2a582f(0x1b8)](_0x2a582f(0x247),_0x3f8310);let _0x10b7e7;if(_0x5ec000[_0x2a582f(0x24c)]==_0x2a582f(0x20c)){const _0x517d13=await staff[_0x2a582f(0x1e4)]({'email':_0x5ec000[_0x2a582f(0x238)]});_0x10b7e7=await warehouse[_0x2a582f(0x1ab)]({'status':'Enabled','name':_0x517d13[_0x2a582f(0x22b)],'warehouse_category':_0x2a582f(0x229),'name':_0x2a582f(0x203)});}else _0x10b7e7=await warehouse['aggregate']([{'$match':{'status':_0x2a582f(0x219),'warehouse_category':_0x2a582f(0x229),'name':_0x2a582f(0x203)}},{'$group':{'_id':_0x2a582f(0x17f),'name':{'$first':_0x2a582f(0x17f)}}}]);if(_0x13ea79[0x0][_0x2a582f(0x257)]=='English\x20(US)'){var _0x3f461e=users[_0x2a582f(0x1d3)];console[_0x2a582f(0x1b8)](_0x3f461e);}else{if(_0x13ea79[0x0]['language']==_0x2a582f(0x269))var _0x3f461e=users[_0x2a582f(0x269)];else{if(_0x13ea79[0x0][_0x2a582f(0x257)]==_0x2a582f(0x1f8))var _0x3f461e=users[_0x2a582f(0x1f8)];else{if(_0x13ea79[0x0][_0x2a582f(0x257)]=='Spanish')var _0x3f461e=users[_0x2a582f(0x26e)];else{if(_0x13ea79[0x0][_0x2a582f(0x257)]==_0x2a582f(0x182))var _0x3f461e=users[_0x2a582f(0x182)];else{if(_0x13ea79[0x0][_0x2a582f(0x257)]=='Portuguese\x20(BR)')var _0x3f461e=users[_0x2a582f(0x1a2)];else{if(_0x13ea79[0x0][_0x2a582f(0x257)]==_0x2a582f(0x1f7))var _0x3f461e=users[_0x2a582f(0x1f7)];else{if(_0x13ea79[0x0][_0x2a582f(0x257)]==_0x2a582f(0x220))var _0x3f461e=users[_0x2a582f(0x1b0)];}}}}}}}_0x4c79ad[_0x2a582f(0x1b1)](_0x2a582f(0x1ea),{'success':_0x5e78e5[_0x2a582f(0x250)](_0x2a582f(0x1c7)),'errors':_0x5e78e5[_0x2a582f(0x250)](_0x2a582f(0x26d)),'role':_0x5ec000,'profile':_0xd7373c,'user':_0x5d9a45,'stock':_0x3f8310,'master_shop':_0x13ea79,'product':_0x83c3c1,'language':_0x3f461e,'warehouse':_0x10b7e7});}catch(_0x227d88){console[_0x2a582f(0x1b8)](_0x227d88);}}),router['post'](a0_0x5cb86d(0x213),auth,async(_0xd34c7b,_0x2fdafd)=>{var _0x2a4e6a=a0_0x5cb86d;try{const {invoice:_0x2abad9,date:_0x2d8327,warehouse_name:_0xb16a4e,Room_name:_0x1ccf74,product_name:_0x5e5fb2,purchase_quantity:_0x519ca5,stocks:_0x5917d9,return_qty:_0x5d9250,note:_0xa1e22f,level:_0x104c94,isle:_0x4d7689,pallet:_0x55d563,to_warehouse_name:_0x37076a,to_Room_name:_0x400b99}=_0xd34c7b['body'],_0x515967=await purchases_finished['findOne']({'_id':_0xd34c7b['params']['id']}),_0x2973ff=await warehouse[_0x2a4e6a(0x1e4)]({'name':_0xb16a4e,'room':_0x1ccf74,'warehouse_category':_0x2a4e6a(0x229)});if(typeof _0x5e5fb2==_0x2a4e6a(0x198))var _0x42e222=[_0xd34c7b['body'][_0x2a4e6a(0x26b)]],_0x1a0966=[_0xd34c7b[_0x2a4e6a(0x1c4)]['purchase_quantity']],_0x3eddb8=[_0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x1d2)]],_0x2d0c4c=[_0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x261)]],_0x1bfa41=[_0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x1d1)]],_0x5924b2=[_0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x1c6)]],_0x4bdd2f=[_0xd34c7b['body']['primary_code_hide']],_0x16fbdd=[_0xd34c7b['body'][_0x2a4e6a(0x221)]];else var _0x42e222=[..._0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x26b)]],_0x1a0966=[..._0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x248)]],_0x3eddb8=[..._0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x1d2)]],_0x2d0c4c=[..._0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x261)]],_0x1bfa41=[..._0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x1d1)]],_0x5924b2=[..._0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x1c6)]],_0x4bdd2f=[..._0xd34c7b['body'][_0x2a4e6a(0x1bf)]],_0x16fbdd=[..._0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x221)]];const _0x4af457=_0x42e222[_0x2a4e6a(0x1fb)](_0x21a6db=>{return _0x21a6db={'product_name':_0x21a6db};});_0x1a0966['forEach']((_0x460593,_0x49aa0b)=>{_0x4af457[_0x49aa0b]['purchase_quantity']=_0x460593;}),_0x3eddb8[_0x2a4e6a(0x1da)]((_0x17dc37,_0xa248dc)=>{_0x4af457[_0xa248dc]['stock_quantity']=_0x17dc37;}),_0x2d0c4c[_0x2a4e6a(0x1da)]((_0x3dfaa2,_0x11822a)=>{var _0x4b893e=_0x2a4e6a;_0x4af457[_0x11822a][_0x4b893e(0x261)]=_0x3dfaa2;}),_0x1bfa41[_0x2a4e6a(0x1da)]((_0x2febad,_0x4b976a)=>{var _0x34ff1c=_0x2a4e6a;_0x4af457[_0x4b976a][_0x34ff1c(0x24d)]=_0x2febad;}),_0x5924b2[_0x2a4e6a(0x1da)]((_0xf6ed3e,_0x324c1d)=>{var _0x2f9fef=_0x2a4e6a;_0x4af457[_0x324c1d][_0x2f9fef(0x1cb)]=_0xf6ed3e;}),_0x4bdd2f[_0x2a4e6a(0x1da)]((_0x184d12,_0x222899)=>{var _0x32d224=_0x2a4e6a;_0x4af457[_0x222899][_0x32d224(0x233)]=_0x184d12;}),_0x16fbdd[_0x2a4e6a(0x1da)]((_0x24346c,_0x281c7c)=>{var _0x323c62=_0x2a4e6a;_0x4af457[_0x281c7c][_0x323c62(0x222)]=_0x24346c;}),_0x4af457[_0x2a4e6a(0x1da)](_0x5e4650=>{var _0x3e43c0=_0x2a4e6a;console['log'](_0x5e4650);const _0x3bf988=_0x2973ff[_0x3e43c0(0x1e6)]['map'](_0x3db8d6=>{var _0xdd87d6=_0x3e43c0;_0x3db8d6[_0xdd87d6(0x26b)]==_0x5e4650[_0xdd87d6(0x26b)]&&_0x3db8d6[_0xdd87d6(0x24d)]==_0x5e4650[_0xdd87d6(0x24d)]&&(console[_0xdd87d6(0x1b8)](parseInt(_0x3db8d6['product_stock'])+'\x20<>\x20'+parseInt(_0x5e4650['return_qty'])),_0x3db8d6[_0xdd87d6(0x1af)]=parseInt(_0x3db8d6[_0xdd87d6(0x1af)])-parseInt(_0x5e4650[_0xdd87d6(0x261)]));});}),await _0x2973ff[_0x2a4e6a(0x1bc)]();var _0x2bbdaf=0x0;_0x4af457[_0x2a4e6a(0x1da)](_0x51a617=>{var _0x5c29b4=_0x2a4e6a;(parseInt(_0x51a617[_0x5c29b4(0x248)])<parseInt(_0x51a617[_0x5c29b4(0x261)])||parseInt(_0x51a617['stock_quantity'])<parseInt(_0x51a617['return_qty']))&&_0x2bbdaf++;});if(_0x2bbdaf!=0x0)return _0xd34c7b[_0x2a4e6a(0x250)](_0x2a4e6a(0x26d),_0x2a4e6a(0x1d0)),_0x2fdafd[_0x2a4e6a(0x225)](_0x2a4e6a(0x194));const _0x2d60a6=new purchases_return_finished({'invoice':_0x2abad9,'suppliers':_0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x1fa)],'date':_0x2d8327,'warehouse_name':_0xb16a4e,'return_product':_0x4af457,'note':_0xa1e22f,'room':_0x1ccf74,'to_warehouse_name':_0x37076a,'to_room':_0x400b99}),_0x137767=await _0x2d60a6['save'](),_0x2ebf0f=await purchases_return_finished[_0x2a4e6a(0x1e4)]({'invoice':_0x2abad9}),_0x3426fb=await warehouse['findOne']({'name':_0x37076a,'room':_0x400b99,'warehouse_category':'Finished\x20Goods'});_0x2ebf0f[_0x2a4e6a(0x1a8)][_0x2a4e6a(0x1da)](_0x4a252c=>{var _0x4ab9f1=_0x2a4e6a,_0x8195ad=0x0;const _0x37784b=_0x3426fb[_0x4ab9f1(0x1e6)][_0x4ab9f1(0x1fb)](_0x1923d2=>{var _0x5cfef9=_0x4ab9f1;console[_0x5cfef9(0x1b8)](_0x1923d2['product_name']+'=='+_0x4a252c[_0x5cfef9(0x26b)]+'&&'+_0x1923d2[_0x5cfef9(0x24d)]+'=='+_0x4a252c[_0x5cfef9(0x24d)]),_0x1923d2['product_name']==_0x4a252c[_0x5cfef9(0x26b)]&&_0x1923d2[_0x5cfef9(0x24d)]==_0x4a252c['bay']&&(_0x1923d2[_0x5cfef9(0x1af)]=parseInt(_0x1923d2[_0x5cfef9(0x1af)])-parseInt(_0x4a252c['return_qty']),_0x8195ad++);});_0x8195ad=='0'&&(_0x3426fb[_0x4ab9f1(0x1e6)]=_0x3426fb[_0x4ab9f1(0x1e6)][_0x4ab9f1(0x244)]({'product_name':_0x4a252c[_0x4ab9f1(0x26b)],'product_stock':_0x4a252c['return_qty'],'primary_code':_0x4a252c[_0x4ab9f1(0x233)],'secondary_code':_0x4a252c[_0x4ab9f1(0x222)],'product_code':_0x4a252c[_0x4ab9f1(0x1cb)],'bay':_0x4a252c['bay'],'maxProducts':0xf423f}));}),await _0x3426fb[_0x2a4e6a(0x1bc)]();const _0x3e17b1=await purchases_finished[_0x2a4e6a(0x1e4)]({'invoice':_0x2abad9});_0x3e17b1[_0x2a4e6a(0x22c)]=_0x2a4e6a(0x183);const _0x29f65e=await _0x3e17b1[_0x2a4e6a(0x1bc)](),_0x3576d4=new s_payment_data({'invoice':_0x2abad9,'suppliers':_0xd34c7b[_0x2a4e6a(0x1c4)]['suppliers'],'reason':'Purchase\x20Return'});await _0x3576d4[_0x2a4e6a(0x1bc)]();const _0x5e855c=await master_shop[_0x2a4e6a(0x1ab)](),_0x115ef4=await email_settings['findOne'](),_0x35d1c0=await suppliers[_0x2a4e6a(0x1e4)]({'name':_0xd34c7b[_0x2a4e6a(0x1c4)][_0x2a4e6a(0x1fa)]});_0x5e855c[0x0][_0x2a4e6a(0x179)]==0x1?(right_currency=_0x5e855c[0x0][_0x2a4e6a(0x271)],left_currency=''):(right_currency='',left_currency=_0x5e855c[0x0][_0x2a4e6a(0x271)]);var _0x464397=_0x42e222,_0x444122=_0x2d0c4c,_0x5a1d6b='',_0x33dec1;for(_0x33dec1 in _0x464397){_0x5a1d6b+='<tr>'+_0x2a4e6a(0x19f)+_0x464397[_0x33dec1]+_0x2a4e6a(0x22a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x444122[_0x33dec1]+_0x2a4e6a(0x22a)+_0x2a4e6a(0x246);}let _0x2b5d90=nodemailer['createTransport']({'service':_0x2a4e6a(0x242),'auth':{'user':_0x115ef4['email'],'pass':_0x115ef4['password']}}),_0x40599b={'from':_0x115ef4[_0x2a4e6a(0x238)],'to':_0x35d1c0[_0x2a4e6a(0x238)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x2a4e6a(0x1fe),'path':__dirname+_0x2a4e6a(0x1ba)+_0x2a4e6a(0x256)+_0x5e855c[0x0][_0x2a4e6a(0x1e8)],'cid':_0x2a4e6a(0x1ec)}],'html':_0x2a4e6a(0x21f)+'<html><head><title></title>'+_0x2a4e6a(0x1ae)+_0x2a4e6a(0x1fd)+_0x2a4e6a(0x17a)+'<div>'+_0x2a4e6a(0x1ad)+_0x2a4e6a(0x1f0)+_0x2a4e6a(0x1fd)+_0x2a4e6a(0x208)+_0x5e855c[0x0][_0x2a4e6a(0x1e2)]+'\x20</h2>'+_0x2a4e6a(0x1f0)+_0x2a4e6a(0x1f0)+_0x2a4e6a(0x1a0)+'<div>'+_0x2a4e6a(0x22f)+_0x2a4e6a(0x21b)+_0x2abad9+'\x20'+_0x2a4e6a(0x267)+_0x2a4e6a(0x1f4)+_0x2d8327+'\x20'+'</span>'+'</h5>'+_0x2a4e6a(0x1f0)+_0x2a4e6a(0x1b7)+_0x2a4e6a(0x1c5)+_0x2a4e6a(0x21c)+_0x2a4e6a(0x226)+_0x2a4e6a(0x263)+_0x2a4e6a(0x260)+_0x2a4e6a(0x1d9)+'</tr>'+_0x2a4e6a(0x245)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5a1d6b+'\x20'+_0x2a4e6a(0x253)+_0x2a4e6a(0x243)+_0x2a4e6a(0x1fd)+'<strong>\x20Regards\x20</strong>'+_0x2a4e6a(0x216)+_0x5e855c[0x0][_0x2a4e6a(0x1e2)]+_0x2a4e6a(0x207)+'</div>'+_0x2a4e6a(0x1f0)+_0x2a4e6a(0x272)};_0x2b5d90['sendMail'](_0x40599b,function(_0x5dbe96,_0x26ac12){var _0x3da1df=_0x2a4e6a;_0x5dbe96?console['log'](_0x3da1df(0x264)):console[_0x3da1df(0x1b8)](_0x3da1df(0x210));}),_0xd34c7b[_0x2a4e6a(0x250)](_0x2a4e6a(0x1c7),_0x2a4e6a(0x19b)),_0x2fdafd[_0x2a4e6a(0x225)](_0x2a4e6a(0x176));}catch(_0x686c64){_0x2fdafd[_0x2a4e6a(0x1d6)](0xc8)[_0x2a4e6a(0x1e7)]({'message':_0x686c64[_0x2a4e6a(0x193)]});}}),router[a0_0x5cb86d(0x17c)](a0_0x5cb86d(0x1b4),auth,async(_0x197386,_0x546a97)=>{var _0x378832=a0_0x5cb86d;try{const {username:_0x207e92,email:_0x35e8c4,role:_0x5de239}=_0x197386['user'],_0x4e17cf=_0x197386[_0x378832(0x1c2)],_0x1da320=await profile[_0x378832(0x1e4)]({'email':_0x4e17cf['email']}),_0xb2342f=await master_shop['find'](),_0x19f68e=_0x197386[_0x378832(0x274)]['id'],_0x3db9c6=await purchases_finished[_0x378832(0x217)](_0x19f68e);if(_0xb2342f[0x0][_0x378832(0x257)]=='English\x20(US)')var _0x43c7c0=users[_0x378832(0x1d3)];else{if(_0xb2342f[0x0][_0x378832(0x257)]==_0x378832(0x269))var _0x43c7c0=users[_0x378832(0x269)];else{if(_0xb2342f[0x0][_0x378832(0x257)]=='German')var _0x43c7c0=users['German'];else{if(_0xb2342f[0x0]['language']==_0x378832(0x26e))var _0x43c7c0=users[_0x378832(0x26e)];else{if(_0xb2342f[0x0][_0x378832(0x257)]==_0x378832(0x182))var _0x43c7c0=users['French'];else{if(_0xb2342f[0x0][_0x378832(0x257)]==_0x378832(0x1d4))var _0x43c7c0=users[_0x378832(0x1a2)];else{if(_0xb2342f[0x0][_0x378832(0x257)]==_0x378832(0x1f7))var _0x43c7c0=users[_0x378832(0x1f7)];else{if(_0xb2342f[0x0]['language']==_0x378832(0x220))var _0x43c7c0=users['Arabic'];}}}}}}}_0x546a97[_0x378832(0x1b1)](_0x378832(0x1ef),{'success':_0x197386[_0x378832(0x250)](_0x378832(0x1c7)),'errors':_0x197386['flash'](_0x378832(0x26d)),'role':_0x4e17cf,'profile':_0x1da320,'alldata':_0x3db9c6,'master_shop':_0xb2342f,'language':_0x43c7c0}),console[_0x378832(0x1b8)](alldata);}catch(_0xc6e4bf){console[_0x378832(0x1b8)](_0xc6e4bf);}}),router['post'](a0_0x5cb86d(0x224),async(_0xdbfb7b,_0x54ba3f)=>{var _0x36c0b6=a0_0x5cb86d;const {product_code:_0x5dc5ae}=_0xdbfb7b[_0x36c0b6(0x1c4)];var _0xbac977;const _0x2feea7=await product['aggregate']([{'$match':{'primary_code':_0x5dc5ae,'product_category':_0x36c0b6(0x229)}},{'$group':{'_id':_0x36c0b6(0x17e),'name':{'$first':_0x36c0b6(0x17f)},'category':{'$first':_0x36c0b6(0x1f3)},'brand':{'$first':_0x36c0b6(0x20a)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x36c0b6(0x1fc)},'product_code':{'$first':_0x36c0b6(0x1de)},'primary_code':{'$first':_0x36c0b6(0x239)},'secondary_code':{'$first':_0x36c0b6(0x1b2)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x36c0b6(0x25a)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4dcb28=await product['aggregate']([{'$match':{'secondary_code':_0x5dc5ae}},{'$group':{'_id':_0x36c0b6(0x17e),'name':{'$first':_0x36c0b6(0x17f)},'category':{'$first':_0x36c0b6(0x1f3)},'brand':{'$first':'$brand'},'unit':{'$first':_0x36c0b6(0x1a3)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x36c0b6(0x1de)},'primary_code':{'$first':_0x36c0b6(0x239)},'secondary_code':{'$first':_0x36c0b6(0x1b2)},'maxStocks':{'$first':_0x36c0b6(0x218)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x36c0b6(0x196)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2feea7[_0x36c0b6(0x214)]>0x0)_0xbac977=_0x2feea7;else _0x4dcb28[_0x36c0b6(0x214)]>0x0&&(_0xbac977=_0x4dcb28);_0x54ba3f[_0x36c0b6(0x1e7)](_0xbac977);}),router['post'](a0_0x5cb86d(0x188),async(_0x2282c8,_0x4b3dcb)=>{var _0x4607a3=a0_0x5cb86d;const {productCode:_0x293c7a,bay:_0x318700,warehouses:_0x3109e0,room:_0x4ed393}=_0x2282c8[_0x4607a3(0x1c4)];console['log'](_0x2282c8[_0x4607a3(0x1c4)]);try{const _0x3271a6=await warehouse[_0x4607a3(0x251)]([{'$match':{'name':_0x3109e0,'room':_0x4ed393}},{'$unwind':_0x4607a3(0x1e1)},{'$match':{'product_details.bay':parseInt(_0x318700)}},{'$group':{'_id':_0x4607a3(0x1ee),'name':{'$first':_0x4607a3(0x201)},'product_stock':{'$first':_0x4607a3(0x23b)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x4607a3(0x1c8)}}}]);_0x4b3dcb[_0x4607a3(0x1d6)](0xc8)['json'](_0x3271a6);}catch(_0x4b7105){_0x4b3dcb[_0x4607a3(0x1d6)](0x194)[_0x4607a3(0x1e7)]({'message':_0x4b7105[_0x4607a3(0x193)]});}}),module['exports']=router;