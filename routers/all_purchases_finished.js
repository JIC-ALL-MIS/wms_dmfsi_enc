var a0_0x53dd3f=a0_0x2691;(function(_0x66154f,_0x2542db){var _0x50b70d=a0_0x2691,_0xc0016a=_0x66154f();while(!![]){try{var _0x288963=parseInt(_0x50b70d(0x207))/0x1+-parseInt(_0x50b70d(0x1f8))/0x2*(parseInt(_0x50b70d(0x208))/0x3)+parseInt(_0x50b70d(0x127))/0x4*(parseInt(_0x50b70d(0x188))/0x5)+parseInt(_0x50b70d(0x1c0))/0x6*(parseInt(_0x50b70d(0x118))/0x7)+parseInt(_0x50b70d(0x1f0))/0x8+parseInt(_0x50b70d(0x20a))/0x9*(parseInt(_0x50b70d(0x1c5))/0xa)+-parseInt(_0x50b70d(0x136))/0xb;if(_0x288963===_0x2542db)break;else _0xc0016a['push'](_0xc0016a['shift']());}catch(_0x2d74cb){_0xc0016a['push'](_0xc0016a['shift']());}}}(a0_0x432f,0xc7906));const express=require('express'),app=express(),router=express[a0_0x53dd3f(0x203)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x53dd3f(0x197)),auth=require(a0_0x53dd3f(0x1d4)),nodemailer=require(a0_0x53dd3f(0x13b));var ejs=require(a0_0x53dd3f(0x130));const path=require(a0_0x53dd3f(0x121)),users=require(a0_0x53dd3f(0x158));router[a0_0x53dd3f(0x195)](a0_0x53dd3f(0x1c8),auth,async(_0x4de459,_0xe15ccd)=>{var _0x31c6a8=a0_0x53dd3f;try{const {username:_0x4bee51,email:_0xd7a7f3,role:_0x19b2f7}=_0x4de459[_0x31c6a8(0x15b)],_0x996de9=_0x4de459[_0x31c6a8(0x15b)],_0xdf4cd4=await profile[_0x31c6a8(0x157)]({'email':_0x996de9[_0x31c6a8(0x1f1)]}),_0x43d618=await staff[_0x31c6a8(0x157)]({'email':_0x996de9['email']});if(_0x996de9[_0x31c6a8(0x19b)]=='staff'){const _0x3eda99=await staff[_0x31c6a8(0x157)]({'email':_0x996de9[_0x31c6a8(0x1f1)]});}const _0x49dcc2=await master_shop[_0x31c6a8(0x1b2)]();let _0x36ea42;if(_0x996de9[_0x31c6a8(0x19b)]==_0x31c6a8(0x141)){const _0x757ff7=await staff[_0x31c6a8(0x157)]({'email':_0x996de9[_0x31c6a8(0x1f1)]});_0x36ea42=await purchases_finished[_0x31c6a8(0x14e)]([{'$match':{'warehouse_name':_0x757ff7[_0x31c6a8(0x171)]}},{'$lookup':{'from':_0x31c6a8(0x128),'localField':'suppliers','foreignField':_0x31c6a8(0x12f),'as':_0x31c6a8(0x1a3)}},{'$unwind':_0x31c6a8(0x13c)},{'$unwind':_0x31c6a8(0x176)},{'$group':{'_id':_0x31c6a8(0x217),'invoice':{'$first':_0x31c6a8(0x19a)},'suppliers':{'$first':_0x31c6a8(0x20d)},'date':{'$first':_0x31c6a8(0x15c)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x31c6a8(0x1ac)},'product':{'$push':'$product'},'note':{'$first':_0x31c6a8(0x1ba)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x31c6a8(0x14a)},'expiry_date':{'$first':_0x31c6a8(0x1be)},'suppliers_docs':{'$first':_0x31c6a8(0x13c)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x31c6a8(0x117)},'type':{'$addToSet':_0x31c6a8(0x170)},'floorlevel':{'$addToSet':_0x31c6a8(0x1c2)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x36ea42=await purchases_finished[_0x31c6a8(0x14e)]([{'$unwind':'$product'},{'$group':{'_id':_0x31c6a8(0x217),'invoice':{'$first':_0x31c6a8(0x19a)},'suppliers':{'$first':_0x31c6a8(0x20d)},'date':{'$first':_0x31c6a8(0x15c)},'warehouse_name':{'$first':_0x31c6a8(0x125)},'room':{'$addToSet':_0x31c6a8(0x13a)},'product':{'$push':'$product'},'note':{'$first':_0x31c6a8(0x1ba)},'paid_amount':{'$first':_0x31c6a8(0x1c9)},'due_amount':{'$first':_0x31c6a8(0x20f)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x31c6a8(0x14a)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x31c6a8(0x1e6)},'level':{'$addToSet':_0x31c6a8(0x1b7)},'isle':{'$addToSet':_0x31c6a8(0x117)},'type':{'$addToSet':_0x31c6a8(0x170)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x49dcc2[0x0][_0x31c6a8(0x1a4)]==_0x31c6a8(0x17b))var _0x7e77e=users[_0x31c6a8(0x1cb)];else{if(_0x49dcc2[0x0][_0x31c6a8(0x1a4)]==_0x31c6a8(0x1fc))var _0x7e77e=users[_0x31c6a8(0x1fc)];else{if(_0x49dcc2[0x0][_0x31c6a8(0x1a4)]=='German')var _0x7e77e=users['German'];else{if(_0x49dcc2[0x0][_0x31c6a8(0x1a4)]=='Spanish')var _0x7e77e=users[_0x31c6a8(0x12b)];else{if(_0x49dcc2[0x0][_0x31c6a8(0x1a4)]==_0x31c6a8(0x18f))var _0x7e77e=users['French'];else{if(_0x49dcc2[0x0]['language']=='Portuguese\x20(BR)')var _0x7e77e=users[_0x31c6a8(0x1a2)];else{if(_0x49dcc2[0x0][_0x31c6a8(0x1a4)]=='Chinese')var _0x7e77e=users[_0x31c6a8(0x11b)];else{if(_0x49dcc2[0x0][_0x31c6a8(0x1a4)]=='Arabic\x20(ae)')var _0x7e77e=users[_0x31c6a8(0x178)];}}}}}}}_0xe15ccd[_0x31c6a8(0x1d2)](_0x31c6a8(0x164),{'success':_0x4de459[_0x31c6a8(0x1d6)](_0x31c6a8(0x1ce)),'errors':_0x4de459[_0x31c6a8(0x1d6)](_0x31c6a8(0x1ed)),'purchases':_0x36ea42,'role':_0x996de9,'profile':_0xdf4cd4,'master_shop':_0x49dcc2,'language':_0x7e77e});}catch(_0x5b8d12){console[_0x31c6a8(0x12e)](_0x31c6a8(0x177),_0x5b8d12),_0xe15ccd['status'](0xc8)[_0x31c6a8(0x17c)]({'message':_0x5b8d12['message']});}});function BayBinSelected(_0x3fed0c,_0xccc2fb){var _0x25695b=a0_0x53dd3f,_0x5e1cef=[],_0x8a9b76=[];if(_0x3fed0c==_0x25695b(0x17d)){switch(_0xccc2fb){case _0x25695b(0x1bd):_0x5e1cef=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x25695b(0x172):_0x5e1cef=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x8a9b76=['DG'];}else{if(_0x3fed0c==_0x25695b(0x165)){switch(_0xccc2fb){case _0x25695b(0x1bd):_0x5e1cef=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x5e1cef=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x8a9b76=['FG'];}}return{'levels':_0x5e1cef,'identify':_0x8a9b76};}async function getRandom8DigitNumber(){var _0x284c98=a0_0x53dd3f;const _0x1c3597=0x989680,_0x91e22=0x5f5e0ff,_0xbb0a86=Math[_0x284c98(0x142)](Math[_0x284c98(0x1fa)]()*(_0x91e22-_0x1c3597+0x1))+_0x1c3597;var _0x1a9e92;const _0x42ce00=await purchases_finished[_0x284c98(0x157)]({'invoice':_0x284c98(0x14c)+_0xbb0a86});return _0x42ce00&&_0x42ce00['length']>0x0?_0x1a9e92=_0x284c98(0x14c)+_0xbb0a86:_0x1a9e92=_0x284c98(0x14c)+_0xbb0a86,_0x1a9e92;}function a0_0x2691(_0x4af22f,_0x19f967){var _0x432f73=a0_0x432f();return a0_0x2691=function(_0x2691cc,_0x18223d){_0x2691cc=_0x2691cc-0x115;var _0x44e259=_0x432f73[_0x2691cc];return _0x44e259;},a0_0x2691(_0x4af22f,_0x19f967);}router['get'](a0_0x53dd3f(0x152),auth,async(_0x1169a4,_0x2a81be)=>{var _0x491488=a0_0x53dd3f;try{const {username:_0x3d4c52,email:_0x216912,role:_0x302910}=_0x1169a4[_0x491488(0x15b)],_0x537d9c=_0x1169a4[_0x491488(0x15b)],_0x5a0aef=await profile['findOne']({'email':_0x537d9c[_0x491488(0x1f1)]}),_0x19aeb2=await master_shop[_0x491488(0x1b2)](),_0x4c45b7=await staff[_0x491488(0x157)]({'email':_0x537d9c['email']}),_0x2ea0be=await suppliers[_0x491488(0x1b2)]({});let _0x5371c5;if(_0x537d9c[_0x491488(0x19b)]==_0x491488(0x141)){const _0x444414=await staff[_0x491488(0x157)]({'email':_0x537d9c[_0x491488(0x1f1)]});_0x5371c5=await warehouse[_0x491488(0x14e)]([{'$match':{'status':'Enabled','name':_0x444414[_0x491488(0x171)],'warehouse_category':_0x491488(0x11a)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x5371c5=await warehouse[_0x491488(0x14e)]([{'$match':{'status':_0x491488(0x1dc),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x491488(0x216)}}},{'$group':{'_id':_0x491488(0x1a7),'name':{'$first':_0x491488(0x1a7)}}}]);const _0xcd5314=await product[_0x491488(0x1b2)]({}),_0xea42c3=await warehouse['find']({'status':_0x491488(0x1dc)}),_0x658ce3=await purchases_finished[_0x491488(0x1b2)]({}),_0xa3bb44=_0x658ce3[_0x491488(0x202)]+0x1,_0x12d852=_0x491488(0x14c)+_0xa3bb44[_0x491488(0x1cf)]()[_0x491488(0x1af)](0x5,'0');var _0xfaae94=[_0x491488(0x1b8),_0x491488(0x1d9)];if(_0x19aeb2[0x0][_0x491488(0x1a4)]=='English\x20(US)')var _0x53e417=users[_0x491488(0x1cb)];else{if(_0x19aeb2[0x0]['language']==_0x491488(0x1fc))var _0x53e417=users[_0x491488(0x1fc)];else{if(_0x19aeb2[0x0][_0x491488(0x1a4)]==_0x491488(0x150))var _0x53e417=users[_0x491488(0x150)];else{if(_0x19aeb2[0x0]['language']==_0x491488(0x12b))var _0x53e417=users['Spanish'];else{if(_0x19aeb2[0x0][_0x491488(0x1a4)]=='French')var _0x53e417=users[_0x491488(0x18f)];else{if(_0x19aeb2[0x0][_0x491488(0x1a4)]==_0x491488(0x19d))var _0x53e417=users[_0x491488(0x1a2)];else{if(_0x19aeb2[0x0][_0x491488(0x1a4)]==_0x491488(0x11b))var _0x53e417=users[_0x491488(0x11b)];else{if(_0x19aeb2[0x0][_0x491488(0x1a4)]=='Arabic\x20(ae)')var _0x53e417=users['Arabic'];}}}}}}}const _0x37b394=getRandom8DigitNumber();_0x37b394[_0x491488(0x151)](_0x45b625=>{var _0x19eaeb=_0x491488;_0x2a81be['render']('add_purchases_finished',{'success':_0x1169a4[_0x19eaeb(0x1d6)](_0x19eaeb(0x1ce)),'errors':_0x1169a4[_0x19eaeb(0x1d6)](_0x19eaeb(0x1ed)),'role':_0x537d9c,'profile':_0x5a0aef,'suppliers':_0x2ea0be,'warehouse':_0x5371c5,'product':_0xcd5314,'invoice':_0x45b625,'master_shop':_0x19aeb2,'language':_0x53e417,'find_data':_0xea42c3,'rooms_data':_0xfaae94});})[_0x491488(0x131)](_0x3c231c=>{var _0x448f9a=_0x491488;_0x1169a4[_0x448f9a(0x1d6)]('errors',_0x448f9a(0x12d)),_0x2a81be[_0x448f9a(0x1e2)]('/all_purchases_finished/view');});}catch(_0x11f78c){console[_0x491488(0x12e)](_0x11f78c);}}),router[a0_0x53dd3f(0x195)](a0_0x53dd3f(0x115),auth,async(_0x3c17c0,_0x123ef5)=>{var _0xa0ef6c=a0_0x53dd3f;try{const _0x36b740=_0x3c17c0[_0xa0ef6c(0x1eb)]['id'];console[_0xa0ef6c(0x12e)](_0x36b740);const _0x423f4c=await master_shop[_0xa0ef6c(0x1b2)]();console[_0xa0ef6c(0x12e)](_0xa0ef6c(0x1ff),_0x423f4c);const _0x3233bb=await product[_0xa0ef6c(0x157)]({'name':_0x36b740});console[_0xa0ef6c(0x12e)]('product',_0x3233bb),_0x123ef5[_0xa0ef6c(0x17e)](0xc8)[_0xa0ef6c(0x17c)]({'product_data':_0x3233bb,'master':_0x423f4c});}catch(_0x42813b){console[_0xa0ef6c(0x12e)](_0xa0ef6c(0x1a5),_0x42813b);}}),router[a0_0x53dd3f(0x154)]('/view/add_purchases',auth,async(_0x40c13e,_0x222dc7)=>{var _0x307fcb=a0_0x53dd3f;try{const {invoice:_0x45af8d,date:_0x18e0b3,warehouse_name:_0x5af354,prod_name:_0x49749a,prod_code:_0x2512dd,prod_qty:_0x5abeb3,prod_unit:_0x1ac7a8,prod_secondunit:_0x385ead,prod_level:_0x1086b4,prod_isle:_0x32c6d2,prod_pallet:_0x1cce26,note:_0x1bd77f,expiry_date:_0x434401,batch_code:_0x424db5,payable:_0x1773cf,due_amount:_0x2b202a,Room_name:_0x45e463,primary_code:_0xc80552,secondary_code:_0x21d26c,MaxStocks_data:_0x2305f9,PO_number:_0x30a531,SCRN:_0x192a9e,JO_number:_0x213b23}=_0x40c13e[_0x307fcb(0x11c)];if(typeof _0x49749a==_0x307fcb(0x1e1))var _0x48937e=[_0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x1ec)]],_0x5c04d0=[_0x40c13e['body']['prod_code']],_0x5cfcb6=[_0x40c13e['body'][_0x307fcb(0x18b)]],_0x5851e7=[_0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x129)]],_0xb65858=[_0x40c13e['body'][_0x307fcb(0x153)]],_0x8e9dad=[_0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x175)]],_0x2b17fb=[_0x40c13e['body'][_0x307fcb(0x19c)]],_0x5430a4=[_0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x198)]],_0x3157dc=[_0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x1ca)]],_0x2be381=[_0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x182)]],_0x2af304=[_0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x181)]],_0x235a5a=[_0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x137)]],_0x48d401=[_0x40c13e['body']['max_product_unit']],_0x55ed8e=[_0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x1c6)]],_0x53c887=[_0x40c13e['body'][_0x307fcb(0x1ab)]],_0x3e85d1=[_0x40c13e['body'][_0x307fcb(0x16c)]];else var _0x48937e=[..._0x40c13e['body'][_0x307fcb(0x1ec)]],_0x5c04d0=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x189)]],_0x5cfcb6=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x18b)]],_0x5851e7=[..._0x40c13e[_0x307fcb(0x11c)]['prod_primunit']],_0xb65858=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x153)]],_0x8e9dad=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x175)]],_0x2b17fb=[..._0x40c13e[_0x307fcb(0x11c)]['primary_code']],_0x5430a4=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x198)]],_0x3157dc=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x1ca)]],_0x2be381=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x182)]],_0x2af304=[..._0x40c13e['body']['expiry_date']],_0x235a5a=[..._0x40c13e[_0x307fcb(0x11c)]['product_date']],_0x48d401=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x199)]],_0x55ed8e=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x1c6)]],_0x53c887=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x1ab)]],_0x3e85d1=[..._0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x16c)]];const _0x51b194=_0x48937e[_0x307fcb(0x149)](_0x4f6a91=>{return _0x4f6a91={'product_name':_0x4f6a91};});_0x5c04d0['forEach']((_0x2bc186,_0x4f2a90)=>{_0x51b194[_0x4f2a90]['product_code']=_0x2bc186;}),_0x5cfcb6[_0x307fcb(0x206)]((_0x1c83e6,_0x178869)=>{_0x51b194[_0x178869]['quantity']=Math['abs'](_0x1c83e6);}),_0x5851e7[_0x307fcb(0x206)]((_0x35c630,_0x35cdb6)=>{var _0x26b292=_0x307fcb;_0x51b194[_0x35cdb6][_0x26b292(0x1e5)]=_0x35c630;}),_0xb65858['forEach']((_0x44cf8f,_0x1ca0c6)=>{var _0xec3743=_0x307fcb;_0x51b194[_0x1ca0c6][_0xec3743(0x1ee)]=_0x44cf8f;}),_0x8e9dad[_0x307fcb(0x206)]((_0x4a34c6,_0x109e94)=>{var _0x29d2ad=_0x307fcb;_0x51b194[_0x109e94][_0x29d2ad(0x196)]=_0x4a34c6;}),_0x2b17fb[_0x307fcb(0x206)]((_0x1d75e0,_0x477d87)=>{var _0x175e9e=_0x307fcb;_0x51b194[_0x477d87][_0x175e9e(0x19c)]=_0x1d75e0;}),_0x5430a4[_0x307fcb(0x206)]((_0x39e5a3,_0xb5dc3e)=>{_0x51b194[_0xb5dc3e]['secondary_code']=_0x39e5a3;}),_0x3157dc[_0x307fcb(0x206)]((_0x39dc6b,_0x33d478)=>{var _0x16b285=_0x307fcb;_0x51b194[_0x33d478][_0x16b285(0x1e7)]=_0x39dc6b;}),_0x2be381[_0x307fcb(0x206)]((_0x460e99,_0x324053)=>{var _0x7a49e5=_0x307fcb;_0x51b194[_0x324053][_0x7a49e5(0x182)]=_0x460e99;}),_0x2af304[_0x307fcb(0x206)]((_0x1221d8,_0x108a4e)=>{_0x51b194[_0x108a4e]['expiry_date']=_0x1221d8;}),_0x235a5a[_0x307fcb(0x206)]((_0x1d92b7,_0xf345ac)=>{var _0x501235=_0x307fcb;_0x51b194[_0xf345ac][_0x501235(0x1b9)]=_0x1d92b7;}),_0x48d401[_0x307fcb(0x206)]((_0x39c258,_0x438588)=>{var _0x57ac4e=_0x307fcb;_0x51b194[_0x438588][_0x57ac4e(0x15f)]=_0x39c258;}),_0x55ed8e[_0x307fcb(0x206)]((_0x383f30,_0x178676)=>{var _0x1eac80=_0x307fcb;_0x51b194[_0x178676][_0x1eac80(0x18c)]=_0x383f30;}),_0x53c887['forEach']((_0x236471,_0x437692)=>{var _0x15a52d=_0x307fcb;_0x51b194[_0x437692][_0x15a52d(0x144)]=_0x236471;}),_0x3e85d1['forEach']((_0x6f103f,_0x2dbf5c)=>{_0x51b194[_0x2dbf5c]['invoice']=_0x6f103f;});const _0xec620a=_0x51b194[_0x307fcb(0x14f)](_0x1a24db=>_0x1a24db['quantity']!=='0'&&_0x1a24db['quantity']!==''),_0x1e0f24=new purchases_finished({'invoice':_0x45af8d,'suppliers':_0x40c13e[_0x307fcb(0x11c)][_0x307fcb(0x128)],'date':_0x18e0b3,'warehouse_name':_0x5af354,'product':_0xec620a,'note':_0x1bd77f,'due_amount':_0x2b202a,'room':_0x45e463,'POnumber':_0x30a531,'SCRN':_0x192a9e,'JO_number':_0x213b23}),_0x12e1a5=await _0x1e0f24[_0x307fcb(0x167)](),_0x195b67=await purchases_finished[_0x307fcb(0x157)]({'invoice':_0x45af8d}),_0x23c289=_0x195b67[_0x307fcb(0x116)][_0x307fcb(0x149)](async _0x47ad28=>{var _0x2aa4a5=_0x307fcb,_0x3b3088=await warehouse[_0x2aa4a5(0x157)]({'name':_0x5af354,'room':_0x47ad28[_0x2aa4a5(0x144)]}),_0xfca0d7=0x0;const _0xcfa0a5=_0x3b3088[_0x2aa4a5(0x159)][_0x2aa4a5(0x149)](_0x442e2b=>{var _0x1cd2e5=_0x2aa4a5;console['log'](_0x442e2b['product_name']+'=='+_0x47ad28[_0x1cd2e5(0x1a6)]+'&&'+_0x442e2b[_0x1cd2e5(0x196)]+'=='+_0x47ad28[_0x1cd2e5(0x196)]+'&&'+_0x442e2b['expiry_date']+'=='+_0x47ad28[_0x1cd2e5(0x181)]+'&&'+_0x442e2b[_0x1cd2e5(0x1b9)]+'=='+_0x47ad28['production_date']+'&&'+_0x442e2b['batch_code']+'=='+_0x47ad28[_0x1cd2e5(0x182)]+'&&'+_0x442e2b[_0x1cd2e5(0x1bf)]+'=='+_0x195b67[_0x1cd2e5(0x1bf)]),_0x442e2b[_0x1cd2e5(0x1a6)]==_0x47ad28[_0x1cd2e5(0x1a6)]&&_0x442e2b[_0x1cd2e5(0x196)]==_0x47ad28[_0x1cd2e5(0x196)]&&_0x442e2b[_0x1cd2e5(0x181)]==_0x47ad28[_0x1cd2e5(0x181)]&&_0x442e2b['production_date']==_0x47ad28[_0x1cd2e5(0x1b9)]&&_0x442e2b['batch_code']==_0x47ad28[_0x1cd2e5(0x182)]&&_0x442e2b[_0x1cd2e5(0x1bf)]==_0x195b67[_0x1cd2e5(0x1bf)]&&(_0x442e2b[_0x1cd2e5(0x143)]=Math[_0x1cd2e5(0x1c4)](_0x442e2b[_0x1cd2e5(0x143)])+Math['abs'](_0x47ad28[_0x1cd2e5(0x185)]),_0xfca0d7++);});return _0xfca0d7=='0'&&(_0x3b3088[_0x2aa4a5(0x159)]=_0x3b3088[_0x2aa4a5(0x159)]['concat']({'product_name':_0x47ad28['product_name'],'product_stock':Math[_0x2aa4a5(0x1c4)](_0x47ad28['quantity']),'primary_code':_0x47ad28[_0x2aa4a5(0x19c)],'secondary_code':_0x47ad28[_0x2aa4a5(0x198)],'product_code':_0x47ad28[_0x2aa4a5(0x124)],'bay':_0x47ad28[_0x2aa4a5(0x196)],'maxProducts':_0x47ad28['maxStocks'],'unit':_0x47ad28['standard_unit'],'secondary_unit':_0x47ad28[_0x2aa4a5(0x1ee)],'expiry_date':_0x47ad28[_0x2aa4a5(0x181)],'production_date':_0x47ad28[_0x2aa4a5(0x1b9)],'maxProducts':_0x47ad28[_0x2aa4a5(0x1e7)],'maxPerUnit':_0x47ad28[_0x2aa4a5(0x15f)],'batch_code':_0x47ad28[_0x2aa4a5(0x182)],'product_cat':_0x47ad28['product_cat'],'invoice':_0x47ad28[_0x2aa4a5(0x1bf)]})),_0x3b3088;});Promise['all'](_0x23c289)['then'](async _0x44d6ce=>{var _0x1ed288=_0x307fcb;try{for(const _0x308834 of _0x44d6ce){await warehouse[_0x1ed288(0x20b)]({'_id':_0x308834[_0x1ed288(0x148)]},{'$addToSet':{'product_details':{'$each':_0x308834[_0x1ed288(0x159)]}}});}const _0xac57b5=await master_shop[_0x1ed288(0x1b2)](),_0x1089c7=await email_settings[_0x1ed288(0x157)](),_0x43ed02=await supervisor_settings[_0x1ed288(0x1b2)]();var _0x46f0e1=_0x195b67['product'],_0x3a0207='',_0xc1990c;for(_0xc1990c in _0x46f0e1){var _0x1b29f3='FG';_0x195b67[_0x1ed288(0x120)]==_0x1ed288(0x17d)&&(_0x1b29f3='DG'),_0x3a0207+=_0x1ed288(0x1db)+_0x1ed288(0x17f)+_0x46f0e1[_0xc1990c]['product_name']+'</td>'+_0x1ed288(0x17f)+_0x46f0e1[_0xc1990c]['product_code']+_0x1ed288(0x205)+_0x1ed288(0x17f)+_0x46f0e1[_0xc1990c][_0x1ed288(0x185)]+_0x1ed288(0x205)+_0x1ed288(0x17f)+_0x46f0e1[_0xc1990c][_0x1ed288(0x1e5)]+_0x1ed288(0x205)+_0x1ed288(0x17f)+_0x46f0e1[_0xc1990c]['secondary_unit']+'</td>'+_0x1ed288(0x17f)+_0x195b67['warehouse_name']+_0x1ed288(0x205)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x46f0e1[_0xc1990c]['room_name']+_0x1ed288(0x205)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b29f3+_0x46f0e1[_0xc1990c][_0x1ed288(0x196)]+'</td>',_0x1ed288(0x13e);}let _0x2068d0=nodemailer[_0x1ed288(0x1fe)]({'host':_0x1089c7[_0x1ed288(0x12a)],'port':Number(_0x1089c7['port']),'secure':![],'auth':{'user':_0x1089c7['email'],'pass':_0x1089c7[_0x1ed288(0x174)]}}),_0x4e797a={'from':_0x1089c7[_0x1ed288(0x1f1)],'to':_0x43ed02[0x0]['FGSEmail'],'subject':_0x1ed288(0x147),'attachments':[{'filename':_0x1ed288(0x1a8),'path':__dirname+'/../public'+_0x1ed288(0x18e)+_0xac57b5[0x0][_0x1ed288(0x1aa)],'cid':_0x1ed288(0x132)}],'html':_0x1ed288(0x11d)+_0x1ed288(0x169)+'</head><body>'+_0x1ed288(0x161)+_0x1ed288(0x14d)+_0x1ed288(0x161)+_0x1ed288(0x16f)+'</div>'+_0x1ed288(0x161)+'<h2>\x20'+_0xac57b5[0x0][_0x1ed288(0x1f5)]+_0x1ed288(0x200)+_0x1ed288(0x19f)+_0x1ed288(0x19f)+_0x1ed288(0x119)+_0x1ed288(0x161)+_0x1ed288(0x16b)+_0x1ed288(0x1f2)+_0x195b67[_0x1ed288(0x1bf)]+'\x20'+_0x1ed288(0x16d)+'\x20Order\x20Date\x20:\x20'+_0x195b67[_0x1ed288(0x156)]+'\x20'+'</span>'+_0x1ed288(0x210)+_0x1ed288(0x19f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1ed288(0x13d)+_0x1ed288(0x1db)+_0x1ed288(0x12c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x1ed288(0x214)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x1ed288(0x184)+_0x1ed288(0x1b4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x1ed288(0x13e)+'</thead>'+_0x1ed288(0x1b0)+'\x20'+_0x3a0207+'\x20'+_0x1ed288(0x17a)+_0x1ed288(0x194)+'<div>'+_0x1ed288(0x192)+'<h5>'+_0xac57b5[0x0][_0x1ed288(0x1f5)]+_0x1ed288(0x210)+_0x1ed288(0x19f)+'</div>'+'</body></html>'};_0x2068d0[_0x1ed288(0x11e)](_0x4e797a,function(_0x3135a2,_0x56e14f){var _0x512a44=_0x1ed288;_0x3135a2?(console[_0x512a44(0x12e)](_0x3135a2),console[_0x512a44(0x12e)](_0x512a44(0x1f7))):console[_0x512a44(0x12e)](_0x512a44(0x1de));});}catch(_0x4cb6bd){console[_0x1ed288(0x1e4)](_0x4cb6bd),_0x222dc7[_0x1ed288(0x17e)](0x1f4)['json']({'error':_0x1ed288(0x11f),'message':_0x4cb6bd['message']});}})['catch'](_0x510002=>{var _0x426b78=_0x307fcb;console[_0x426b78(0x1e4)](_0x510002),_0x222dc7[_0x426b78(0x17e)](0x1f4)[_0x426b78(0x17c)]({'error':_0x426b78(0x1a9)});}),_0x40c13e[_0x307fcb(0x1d6)](_0x307fcb(0x1ce),_0x307fcb(0x209)),_0x222dc7['redirect'](_0x307fcb(0x14b));}catch(_0x40ff1e){console['log'](_0x40ff1e);}}),router[a0_0x53dd3f(0x195)](a0_0x53dd3f(0x1ae),auth,async(_0x5ade3f,_0x2dc0ff)=>{var _0x3f1968=a0_0x53dd3f;try{const {username:_0x226a83,email:_0x4ec0af,role:_0x5595d1}=_0x5ade3f[_0x3f1968(0x15b)],_0x524131=_0x5ade3f['user'],_0xc8ab9a=await profile[_0x3f1968(0x157)]({'email':_0x524131[_0x3f1968(0x1f1)]}),_0x5f38ee=await master_shop[_0x3f1968(0x1b2)](),_0x472176=_0x5ade3f['params']['id'],_0x5e41b8=await purchases_finished[_0x3f1968(0x146)](_0x472176),_0x292b4e=await suppliers[_0x3f1968(0x1b2)]({});let _0x15b1c2;if(_0x524131[_0x3f1968(0x19b)]==_0x3f1968(0x141)){const _0xe0b9ec=await staff['findOne']({'email':_0x524131[_0x3f1968(0x1f1)]});_0x15b1c2=await warehouse['find']({'status':_0x3f1968(0x1dc),'name':_0xe0b9ec[_0x3f1968(0x171)],'warehouse_category':'Finished\x20Goods'});}else _0x15b1c2=await warehouse[_0x3f1968(0x14e)]([{'$match':{'status':_0x3f1968(0x1dc),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x3f1968(0x1a7),'name':{'$first':_0x3f1968(0x1a7)}}}]);const _0x1f74cc=await product[_0x3f1968(0x1b2)]({}),_0x1f6e47=BayBinSelected(_0x5e41b8[_0x3f1968(0x120)],_0x5e41b8[_0x3f1968(0x1fb)]);let _0x2ba756=new Date(_0x5e41b8['expiry_date']),_0x547d18=('0'+_0x2ba756[_0x3f1968(0x1df)]())[_0x3f1968(0x191)](-0x2),_0x45005f=('0'+(_0x2ba756['getMonth']()+0x1))[_0x3f1968(0x191)](-0x2),_0x3c753e=_0x2ba756[_0x3f1968(0x16a)](),_0x165f98=_0x3c753e+'-'+_0x45005f+'-'+_0x547d18;if(_0x5f38ee[0x0][_0x3f1968(0x1a4)]==_0x3f1968(0x17b)){var _0x3e9619=users[_0x3f1968(0x1cb)];console[_0x3f1968(0x12e)](_0x3e9619);}else{if(_0x5f38ee[0x0]['language']=='Hindi')var _0x3e9619=users[_0x3f1968(0x1fc)];else{if(_0x5f38ee[0x0][_0x3f1968(0x1a4)]==_0x3f1968(0x150))var _0x3e9619=users[_0x3f1968(0x150)];else{if(_0x5f38ee[0x0][_0x3f1968(0x1a4)]=='Spanish')var _0x3e9619=users[_0x3f1968(0x12b)];else{if(_0x5f38ee[0x0][_0x3f1968(0x1a4)]==_0x3f1968(0x18f))var _0x3e9619=users[_0x3f1968(0x18f)];else{if(_0x5f38ee[0x0][_0x3f1968(0x1a4)]==_0x3f1968(0x19d))var _0x3e9619=users['Portuguese'];else{if(_0x5f38ee[0x0]['language']=='Chinese')var _0x3e9619=users['Chinese'];else{if(_0x5f38ee[0x0][_0x3f1968(0x1a4)]=='Arabic\x20(ae)')var _0x3e9619=users[_0x3f1968(0x178)];}}}}}}}_0x2dc0ff[_0x3f1968(0x1d2)](_0x3f1968(0x1ad),{'success':_0x5ade3f[_0x3f1968(0x1d6)](_0x3f1968(0x1ce)),'errors':_0x5ade3f[_0x3f1968(0x1d6)](_0x3f1968(0x1ed)),'role':_0x524131,'profile':_0xc8ab9a,'purchases':_0x5e41b8,'suppliers':_0x292b4e,'warehouse':_0x15b1c2,'product':_0x1f74cc,'master_shop':_0x5f38ee,'language':_0x3e9619,'ed_fullDate':_0x165f98,'dataSelected':_0x1f6e47});}catch(_0x445062){console['log'](_0x445062);}}),router[a0_0x53dd3f(0x195)](a0_0x53dd3f(0x204),auth,async(_0x1c5282,_0x2edbc5)=>{var _0x3f29fa=a0_0x53dd3f;try{const {username:_0x331d49,email:_0x2b1a3b,role:_0x2c15e5}=_0x1c5282[_0x3f29fa(0x15b)],_0x3d0dff=_0x1c5282[_0x3f29fa(0x15b)],_0x1b4828=await profile[_0x3f29fa(0x157)]({'email':_0x3d0dff['email']}),_0xff5363=await master_shop[_0x3f29fa(0x1b2)](),_0x4eba38=_0x1c5282[_0x3f29fa(0x1eb)]['id'],_0x387709=await purchases_finished[_0x3f29fa(0x146)](_0x4eba38),_0x2110ae=await suppliers[_0x3f29fa(0x1b2)]({});let _0x12b806;if(_0x3d0dff[_0x3f29fa(0x19b)]==_0x3f29fa(0x141)){const _0x38d5e4=await staff[_0x3f29fa(0x157)]({'email':_0x3d0dff[_0x3f29fa(0x1f1)]});_0x12b806=await warehouse[_0x3f29fa(0x1b2)]({'status':_0x3f29fa(0x1dc),'name':_0x38d5e4[_0x3f29fa(0x171)],'warehouse_category':_0x3f29fa(0x11a)});}else _0x12b806=await warehouse[_0x3f29fa(0x14e)]([{'$match':{'status':_0x3f29fa(0x1dc),'warehouse_category':_0x3f29fa(0x11a)}},{'$group':{'_id':_0x3f29fa(0x1a7),'name':{'$first':'$name'}}}]);const _0x441c43=await product[_0x3f29fa(0x1b2)]({}),_0x3afc1f=BayBinSelected(_0x387709[_0x3f29fa(0x120)],_0x387709[_0x3f29fa(0x1fb)]);let _0x5ed51d=new Date(_0x387709[_0x3f29fa(0x181)]),_0x18b686=('0'+_0x5ed51d[_0x3f29fa(0x1df)]())[_0x3f29fa(0x191)](-0x2),_0x5f9a82=('0'+(_0x5ed51d[_0x3f29fa(0x1e8)]()+0x1))[_0x3f29fa(0x191)](-0x2),_0x40e5f6=_0x5ed51d[_0x3f29fa(0x16a)](),_0x14465e=_0x40e5f6+'-'+_0x5f9a82+'-'+_0x18b686;if(_0xff5363[0x0][_0x3f29fa(0x1a4)]==_0x3f29fa(0x17b)){var _0x353243=users[_0x3f29fa(0x1cb)];console[_0x3f29fa(0x12e)](_0x353243);}else{if(_0xff5363[0x0][_0x3f29fa(0x1a4)]==_0x3f29fa(0x1fc))var _0x353243=users['Hindi'];else{if(_0xff5363[0x0]['language']=='German')var _0x353243=users[_0x3f29fa(0x150)];else{if(_0xff5363[0x0][_0x3f29fa(0x1a4)]==_0x3f29fa(0x12b))var _0x353243=users['Spanish'];else{if(_0xff5363[0x0][_0x3f29fa(0x1a4)]==_0x3f29fa(0x18f))var _0x353243=users[_0x3f29fa(0x18f)];else{if(_0xff5363[0x0][_0x3f29fa(0x1a4)]==_0x3f29fa(0x19d))var _0x353243=users[_0x3f29fa(0x1a2)];else{if(_0xff5363[0x0][_0x3f29fa(0x1a4)]==_0x3f29fa(0x11b))var _0x353243=users['Chinese'];else{if(_0xff5363[0x0][_0x3f29fa(0x1a4)]==_0x3f29fa(0x1d5))var _0x353243=users[_0x3f29fa(0x178)];}}}}}}}_0x2edbc5['render'](_0x3f29fa(0x126),{'success':_0x1c5282[_0x3f29fa(0x1d6)](_0x3f29fa(0x1ce)),'errors':_0x1c5282[_0x3f29fa(0x1d6)]('errors'),'role':_0x3d0dff,'profile':_0x1b4828,'purchases':_0x387709,'suppliers':_0x2110ae,'warehouse':_0x12b806,'product':_0x441c43,'master_shop':_0xff5363,'language':_0x353243,'ed_fullDate':_0x14465e,'dataSelected':_0x3afc1f});}catch(_0x1198a3){console[_0x3f29fa(0x12e)](_0x1198a3);}}),router[a0_0x53dd3f(0x154)](a0_0x53dd3f(0x204),auth,async(_0xfa3da7,_0x41093c)=>{var _0x373fc4=a0_0x53dd3f;try{const _0x52bf18=_0xfa3da7[_0x373fc4(0x1eb)]['id'],_0xbf3a07=await purchases_finished[_0x373fc4(0x157)]({'_id':_0xfa3da7[_0x373fc4(0x1eb)]['id']}),_0x277607=await warehouse[_0x373fc4(0x157)]({'name':_0xbf3a07[_0x373fc4(0x120)],'room':_0xbf3a07[_0x373fc4(0x1fb)]});_0xbf3a07[_0x373fc4(0x116)][_0x373fc4(0x206)](_0x3c2fb9=>{var _0x351f0e=_0x373fc4;const _0x54cd5e=_0x277607[_0x351f0e(0x159)]['map'](_0x57b0d2=>{var _0x148f68=_0x351f0e;_0x57b0d2[_0x148f68(0x1a6)]==_0x3c2fb9[_0x148f68(0x1a6)]&&_0x57b0d2[_0x148f68(0x196)]==_0x3c2fb9[_0x148f68(0x196)]&&(_0x57b0d2[_0x148f68(0x143)]=parseInt(_0x57b0d2['product_stock'])-parseInt(_0x3c2fb9[_0x148f68(0x185)]));});}),await _0x277607[_0x373fc4(0x167)]();const {invoice:_0x564d0d,suppliers:_0x3efc5e,date:_0xdd74aa,warehouse_name:_0x2e1fcd,prod_name:_0x24bcd5,prod_code:_0x5aa5ac,prod_qty:_0x3935ad,prod_unit:_0x5c4843,prod_secondunit:_0x524517,prod_level:_0x286f7c,prod_isle:_0x4eb2be,prod_pallet:_0x5b1606,note:_0x32b050,expiry_date:_0x15fe91,batch_code:_0x5283bd,paid_amount:_0x2034b2,due_amount:_0x1bf425,Room_name:_0x4dc8fe,primary_code:_0x3b2763,secondary_code:_0x225f8e,PO_number:_0x30a029,JO_number:_0x3c3fb5}=_0xfa3da7['body'];if(typeof _0x24bcd5==_0x373fc4(0x1e1))var _0xca6070=[_0xfa3da7[_0x373fc4(0x11c)]['prod_name']],_0x1e34d6=[_0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x189)]],_0x4bcd50=[_0xfa3da7['body'][_0x373fc4(0x1bb)]],_0x5a9e11=[_0xfa3da7['body'][_0x373fc4(0x133)]],_0x53e56d=[_0xfa3da7['body']['prod_secondunit']],_0x82cebe=[_0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x175)]],_0x225e5b=[_0xfa3da7[_0x373fc4(0x11c)]['primary_code']],_0x5e16e8=[_0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x198)]],_0x530988=[_0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x1ca)]],_0x9f2479=[_0xfa3da7['body'][_0x373fc4(0x182)]],_0x15d5af=[_0xfa3da7[_0x373fc4(0x11c)]['expiry_date']];else var _0xca6070=[..._0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x1ec)]],_0x1e34d6=[..._0xfa3da7['body'][_0x373fc4(0x189)]],_0x4bcd50=[..._0xfa3da7['body']['prod_qty']],_0x5a9e11=[..._0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x133)]],_0x53e56d=[..._0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x153)]],_0x82cebe=[..._0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x175)]],_0x225e5b=[..._0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x19c)]],_0x5e16e8=[..._0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x198)]],_0x530988=[..._0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x1ca)]],_0x9f2479=[..._0xfa3da7['body'][_0x373fc4(0x182)]],_0x15d5af=[..._0xfa3da7[_0x373fc4(0x11c)]['expiry_date']];const _0x47c25e=_0xca6070['map'](_0x153827=>{return _0x153827={'product_name':_0x153827};});_0x1e34d6[_0x373fc4(0x206)]((_0x5ae9e0,_0x5a0b01)=>{var _0x1e5d5a=_0x373fc4;_0x47c25e[_0x5a0b01][_0x1e5d5a(0x124)]=_0x5ae9e0;}),_0x4bcd50['forEach']((_0x490d08,_0x1798bf)=>{var _0x39e3df=_0x373fc4;_0x47c25e[_0x1798bf][_0x39e3df(0x185)]=_0x490d08;}),_0x5a9e11[_0x373fc4(0x206)]((_0x1293df,_0xa16724)=>{_0x47c25e[_0xa16724]['standard_unit']=_0x1293df;}),_0x53e56d[_0x373fc4(0x206)]((_0xfeeb99,_0x541048)=>{var _0x51a641=_0x373fc4;_0x47c25e[_0x541048][_0x51a641(0x1ee)]=_0xfeeb99;}),_0x82cebe[_0x373fc4(0x206)]((_0x366133,_0x90eda7)=>{var _0xd1a7c3=_0x373fc4;_0x47c25e[_0x90eda7][_0xd1a7c3(0x196)]=_0x366133;}),_0x225e5b['forEach']((_0x52134c,_0x5d8470)=>{var _0xcb83aa=_0x373fc4;_0x47c25e[_0x5d8470][_0xcb83aa(0x19c)]=_0x52134c;}),_0x5e16e8[_0x373fc4(0x206)]((_0x28e011,_0x19e216)=>{_0x47c25e[_0x19e216]['secondary_code']=_0x28e011;}),_0x530988[_0x373fc4(0x206)]((_0x1531ad,_0xa659ad)=>{var _0x26d7ac=_0x373fc4;_0x47c25e[_0xa659ad][_0x26d7ac(0x1e7)]=_0x1531ad;}),_0x9f2479[_0x373fc4(0x206)]((_0x33fbc0,_0xdc0108)=>{_0x47c25e[_0xdc0108]['batch_code']=_0x33fbc0;}),_0x15d5af[_0x373fc4(0x206)]((_0x24fa6f,_0x4d3502)=>{var _0x314e2a=_0x373fc4;_0x47c25e[_0x4d3502][_0x314e2a(0x181)]=_0x24fa6f;});const _0xb0b10e=_0x47c25e[_0x373fc4(0x14f)](_0x4327fa=>_0x4327fa[_0x373fc4(0x185)]!=='0'&&_0x4327fa[_0x373fc4(0x185)]!=='');_0xbf3a07[_0x373fc4(0x1bf)]=_0x564d0d,_0xbf3a07[_0x373fc4(0x128)]=_0x3efc5e,_0xbf3a07[_0x373fc4(0x156)]=_0xdd74aa,_0xbf3a07['warehouse_name']=_0x2e1fcd,_0xbf3a07[_0x373fc4(0x116)]=_0xb0b10e,_0xbf3a07[_0x373fc4(0x15e)]=_0x32b050,_0xbf3a07['paid_amount']=_0x2034b2,_0xbf3a07[_0x373fc4(0x162)]=_0x1bf425,_0xbf3a07[_0x373fc4(0x1fb)]=_0x4dc8fe,_0xbf3a07[_0x373fc4(0x1c1)]=_0x30a029,_0xbf3a07['JO_number']=_0x3c3fb5;const _0x554cf7=await _0xbf3a07[_0x373fc4(0x167)](),_0x1f7e71=await warehouse['findOne']({'name':_0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x120)],'room':_0xfa3da7['body'][_0x373fc4(0x1f9)]});_0xbf3a07['product'][_0x373fc4(0x206)](_0x3c1203=>{var _0x57815=_0x373fc4,_0x535ceb=0x0;const _0x1c6599=_0x1f7e71[_0x57815(0x159)][_0x57815(0x149)](_0x227e1b=>{var _0x3e967c=_0x57815;_0x227e1b[_0x3e967c(0x1a6)]==_0x3c1203[_0x3e967c(0x1a6)]&&_0x227e1b[_0x3e967c(0x196)]==_0x3c1203['bay']&&(_0x227e1b[_0x3e967c(0x143)]=parseInt(_0x227e1b[_0x3e967c(0x143)])+parseInt(_0x3c1203[_0x3e967c(0x185)]),_0x535ceb++);});_0x535ceb=='0'&&(_0x1f7e71['product_details']=_0x1f7e71[_0x57815(0x159)]['concat']({'product_name':_0x3c1203['product_name'],'product_stock':_0x3c1203['quantity'],'primary_code':_0x3c1203[_0x57815(0x19c)],'secondary_code':_0x3c1203['secondary_code'],'product_code':_0x3c1203[_0x57815(0x124)],'bay':_0x3c1203[_0x57815(0x196)],'maxProducts':_0x3c1203[_0x57815(0x1e7)],'unit':_0x3c1203[_0x57815(0x1e5)],'secondary_unit':_0x3c1203[_0x57815(0x1ee)],'expiry_date':_0x3c1203[_0x57815(0x181)]}));}),await _0x1f7e71['save']();const _0x16d0d4=await s_payment_data['findOne']({'invoice':_0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x1bf)]});if(_0x16d0d4===null){}else console['log']('suppliers',_0x16d0d4,_0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x1bf)]),_0x16d0d4[_0x373fc4(0x128)]=_0xfa3da7[_0x373fc4(0x11c)][_0x373fc4(0x128)],await _0x16d0d4[_0x373fc4(0x167)]();_0xfa3da7[_0x373fc4(0x1d6)]('success',_0x373fc4(0x183)),_0x41093c['redirect'](_0x373fc4(0x14b));}catch(_0x1fe16f){console[_0x373fc4(0x12e)](_0x1fe16f);}}),router['post']('/give_payment/:id',auth,async(_0x41f1ad,_0x16d3a8)=>{var _0xe787a7=a0_0x53dd3f;try{const _0x477f26=_0x41f1ad['params']['id'],{invoice:_0xa176c8,suppliers:_0x7d9852,payable:_0x448c6e,due_amount:_0x1dbbea}=_0x41f1ad[_0xe787a7(0x11c)],_0x32fcc0=await purchases[_0xe787a7(0x146)](_0x477f26);var _0x46f2c1=_0x448c6e-_0x1dbbea;_0x32fcc0[_0xe787a7(0x1d7)]=parseFloat(_0x32fcc0['paid_amount'])+parseFloat(_0x1dbbea),_0x32fcc0[_0xe787a7(0x162)]=_0x46f2c1;const _0x547af7=await _0x32fcc0['save']();console[_0xe787a7(0x12e)](_0x547af7);const _0x3c174f=await s_payment_data[_0xe787a7(0x157)]({'invoice':_0xa176c8});_0x3c174f[_0xe787a7(0x1c3)]=_0x46f2c1,await _0x3c174f[_0xe787a7(0x167)]();let _0x4bbed4=new Date(),_0x31005a=('0'+_0x4bbed4['getDate']())['slice'](-0x2),_0xadb05f=('0'+(_0x4bbed4[_0xe787a7(0x1e8)]()+0x1))[_0xe787a7(0x191)](-0x2),_0x1a1892=_0x4bbed4[_0xe787a7(0x16a)](),_0x92cdeb=_0x1a1892+'-'+_0xadb05f+'-'+_0x31005a;const _0x3c0516=new suppliers_payment({'invoice':_0xa176c8,'date':_0x1a1892+'-'+_0xadb05f+'-'+_0x31005a,'suppliers':_0x7d9852,'reason':_0xe787a7(0x180),'amount':_0x1dbbea}),_0x272785=await _0x3c0516[_0xe787a7(0x167)]();_0x41f1ad[_0xe787a7(0x1d6)](_0xe787a7(0x1ce),'payment\x20successfull'),_0x16d3a8['redirect'](_0xe787a7(0x186));}catch(_0xf8caed){console['log'](_0xf8caed);}}),router[a0_0x53dd3f(0x195)](a0_0x53dd3f(0x1ea),auth,async(_0x77aa7d,_0x1cb15b)=>{var _0x1cc7bd=a0_0x53dd3f;try{const {username:_0x4b5b9e,email:_0x2fcd39,role:_0x1eef11}=_0x77aa7d[_0x1cc7bd(0x15b)],_0x1374e2=_0x77aa7d['user'],_0x2a3e4=await profile[_0x1cc7bd(0x157)]({'email':_0x1374e2[_0x1cc7bd(0x1f1)]}),_0x22c585=await master_shop[_0x1cc7bd(0x1b2)]();console[_0x1cc7bd(0x12e)]('master',_0x22c585);const _0xfa7ac4=_0x77aa7d[_0x1cc7bd(0x1eb)]['id'],_0x323910=await purchases['findById'](_0xfa7ac4);console[_0x1cc7bd(0x12e)](_0x323910);const _0x175624=await suppliers[_0x1cc7bd(0x157)]({'name':_0x323910[_0x1cc7bd(0x128)]});console[_0x1cc7bd(0x12e)](_0x175624);if(_0x22c585[0x0][_0x1cc7bd(0x1a4)]=='English\x20(US)'){var _0x474904=users[_0x1cc7bd(0x1cb)];console[_0x1cc7bd(0x12e)](_0x474904);}else{if(_0x22c585[0x0]['language']==_0x1cc7bd(0x1fc))var _0x474904=users[_0x1cc7bd(0x1fc)];else{if(_0x22c585[0x0][_0x1cc7bd(0x1a4)]==_0x1cc7bd(0x150))var _0x474904=users['German'];else{if(_0x22c585[0x0][_0x1cc7bd(0x1a4)]==_0x1cc7bd(0x12b))var _0x474904=users['Spanish'];else{if(_0x22c585[0x0][_0x1cc7bd(0x1a4)]=='French')var _0x474904=users[_0x1cc7bd(0x18f)];else{if(_0x22c585[0x0][_0x1cc7bd(0x1a4)]==_0x1cc7bd(0x19d))var _0x474904=users['Portuguese'];else{if(_0x22c585[0x0][_0x1cc7bd(0x1a4)]=='Chinese')var _0x474904=users[_0x1cc7bd(0x11b)];else{if(_0x22c585[0x0][_0x1cc7bd(0x1a4)]==_0x1cc7bd(0x1d5))var _0x474904=users[_0x1cc7bd(0x178)];}}}}}}}_0x1cb15b[_0x1cc7bd(0x1d2)](_0x1cc7bd(0x18a),{'success':_0x77aa7d[_0x1cc7bd(0x1d6)]('success'),'errors':_0x77aa7d['flash'](_0x1cc7bd(0x1ed)),'role':_0x1374e2,'profile':_0x2a3e4,'master_shop':_0x22c585,'supplier':_0x175624,'purchase':_0x323910,'language':_0x474904});}catch(_0x418b92){console['log'](_0x418b92);}}),router[a0_0x53dd3f(0x195)](a0_0x53dd3f(0x1d0),auth,async(_0xb9b3dc,_0x447fa2)=>{var _0x3d4bb0=a0_0x53dd3f;try{const {username:_0x3edb9e,email:_0x5d5c9f,role:_0x2c8391}=_0xb9b3dc[_0x3d4bb0(0x15b)],_0x2885ac=_0xb9b3dc[_0x3d4bb0(0x15b)],_0x35e1ee=await profile[_0x3d4bb0(0x157)]({'email':_0x2885ac['email']}),_0x4af936=await master_shop[_0x3d4bb0(0x1b2)]();console[_0x3d4bb0(0x12e)]('master',_0x4af936);const _0x4e424a=_0xb9b3dc['params']['id'];console[_0x3d4bb0(0x12e)](_0x4e424a);const _0x5c734d=await purchases_finished[_0x3d4bb0(0x146)](_0x4e424a);console[_0x3d4bb0(0x12e)]('user_id',_0x5c734d);const _0x4d08bb=await product['find']({}),_0x274705=await warehouse[_0x3d4bb0(0x14e)]([{'$match':{'name':_0x5c734d[_0x3d4bb0(0x120)],'room':_0x5c734d[_0x3d4bb0(0x1fb)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3d4bb0(0x1cc),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3d4bb0(0x190)},'bin':{'$first':_0x3d4bb0(0x1ef)},'type':{'$first':_0x3d4bb0(0x193)},'floorlevel':{'$first':_0x3d4bb0(0x1f6)},'primary_code':{'$first':_0x3d4bb0(0x140)},'secondary_code':{'$first':_0x3d4bb0(0x1b6)},'product_code':{'$first':_0x3d4bb0(0x134)},'storage':{'$first':_0x3d4bb0(0x1c7)},'rack':{'$first':_0x3d4bb0(0x166)}}}]);console[_0x3d4bb0(0x12e)](_0x3d4bb0(0x1f3),_0x274705);let _0x1f1b0b;if(_0x2885ac['role']==_0x3d4bb0(0x141)){const _0x2fb174=await staff['findOne']({'email':_0x2885ac['email']});_0x1f1b0b=await warehouse[_0x3d4bb0(0x1b2)]({'status':_0x3d4bb0(0x1dc),'name':_0x2fb174['warehouse'],'warehouse_category':'Finished\x20Goods','name':_0x3d4bb0(0x15a)});}else _0x1f1b0b=await warehouse[_0x3d4bb0(0x14e)]([{'$match':{'status':_0x3d4bb0(0x1dc),'warehouse_category':_0x3d4bb0(0x11a),'name':_0x3d4bb0(0x15a)}},{'$group':{'_id':_0x3d4bb0(0x1a7),'name':{'$first':_0x3d4bb0(0x1a7)}}}]);if(_0x4af936[0x0][_0x3d4bb0(0x1a4)]==_0x3d4bb0(0x17b)){var _0x4ea71a=users[_0x3d4bb0(0x1cb)];console[_0x3d4bb0(0x12e)](_0x4ea71a);}else{if(_0x4af936[0x0][_0x3d4bb0(0x1a4)]==_0x3d4bb0(0x1fc))var _0x4ea71a=users[_0x3d4bb0(0x1fc)];else{if(_0x4af936[0x0][_0x3d4bb0(0x1a4)]=='German')var _0x4ea71a=users['German'];else{if(_0x4af936[0x0][_0x3d4bb0(0x1a4)]==_0x3d4bb0(0x12b))var _0x4ea71a=users[_0x3d4bb0(0x12b)];else{if(_0x4af936[0x0][_0x3d4bb0(0x1a4)]=='French')var _0x4ea71a=users[_0x3d4bb0(0x18f)];else{if(_0x4af936[0x0]['language']==_0x3d4bb0(0x19d))var _0x4ea71a=users[_0x3d4bb0(0x1a2)];else{if(_0x4af936[0x0]['language']==_0x3d4bb0(0x11b))var _0x4ea71a=users[_0x3d4bb0(0x11b)];else{if(_0x4af936[0x0]['language']==_0x3d4bb0(0x1d5))var _0x4ea71a=users['Arabic'];}}}}}}}_0x447fa2[_0x3d4bb0(0x1d2)]('return_purchase_finished',{'success':_0xb9b3dc[_0x3d4bb0(0x1d6)](_0x3d4bb0(0x1ce)),'errors':_0xb9b3dc[_0x3d4bb0(0x1d6)](_0x3d4bb0(0x1ed)),'role':_0x2885ac,'profile':_0x35e1ee,'user':_0x5c734d,'stock':_0x274705,'master_shop':_0x4af936,'product':_0x4d08bb,'language':_0x4ea71a,'warehouse':_0x1f1b0b});}catch(_0xcddc99){console['log'](_0xcddc99);}}),router['post'](a0_0x53dd3f(0x1d0),auth,async(_0x276238,_0x2f89dc)=>{var _0x5f06ad=a0_0x53dd3f;try{const {invoice:_0x2cf831,date:_0x42e282,warehouse_name:_0x19111a,Room_name:_0x59f955,product_name:_0x16a630,purchase_quantity:_0x3037b8,stocks:_0x4d00af,return_qty:_0x2d686f,note:_0x513bdb,level:_0x4ff159,isle:_0x2f18c,pallet:_0x2012c8,to_warehouse_name:_0x38dcb5,to_Room_name:_0x3e8499}=_0x276238[_0x5f06ad(0x11c)],_0x6cfb96=await purchases_finished[_0x5f06ad(0x157)]({'_id':_0x276238[_0x5f06ad(0x1eb)]['id']}),_0x1567ff=await warehouse[_0x5f06ad(0x157)]({'name':_0x19111a,'room':_0x59f955,'warehouse_category':'Finished\x20Goods'});if(typeof _0x16a630=='string')var _0x519513=[_0x276238['body'][_0x5f06ad(0x1a6)]],_0x174b61=[_0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x201)]],_0x582dee=[_0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x1da)]],_0x4413d9=[_0x276238['body'][_0x5f06ad(0x215)]],_0x94889f=[_0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x1f4)]],_0x173cd6=[_0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x1e9)]],_0x5da237=[_0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x135)]],_0x144fe3=[_0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x1b5)]];else var _0x519513=[..._0x276238['body'][_0x5f06ad(0x1a6)]],_0x174b61=[..._0x276238['body'][_0x5f06ad(0x201)]],_0x582dee=[..._0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x1da)]],_0x4413d9=[..._0x276238[_0x5f06ad(0x11c)]['return_qty']],_0x94889f=[..._0x276238['body']['level']],_0x173cd6=[..._0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x1e9)]],_0x5da237=[..._0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x135)]],_0x144fe3=[..._0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x1b5)]];const _0x4da740=_0x519513[_0x5f06ad(0x149)](_0x5c657d=>{return _0x5c657d={'product_name':_0x5c657d};});_0x174b61[_0x5f06ad(0x206)]((_0x39a1ab,_0x5272d7)=>{var _0x500625=_0x5f06ad;_0x4da740[_0x5272d7][_0x500625(0x201)]=_0x39a1ab;}),_0x582dee[_0x5f06ad(0x206)]((_0x317758,_0x335870)=>{var _0x1f1339=_0x5f06ad;_0x4da740[_0x335870][_0x1f1339(0x155)]=_0x317758;}),_0x4413d9['forEach']((_0x4b2adf,_0xfe58e)=>{var _0x4ec710=_0x5f06ad;_0x4da740[_0xfe58e][_0x4ec710(0x215)]=_0x4b2adf;}),_0x94889f[_0x5f06ad(0x206)]((_0x3fa911,_0x1824c5)=>{_0x4da740[_0x1824c5]['bay']=_0x3fa911;}),_0x173cd6[_0x5f06ad(0x206)]((_0xea0555,_0x1362e4)=>{_0x4da740[_0x1362e4]['product_code']=_0xea0555;}),_0x5da237[_0x5f06ad(0x206)]((_0x13259e,_0x202387)=>{var _0x1a8579=_0x5f06ad;_0x4da740[_0x202387][_0x1a8579(0x19c)]=_0x13259e;}),_0x144fe3[_0x5f06ad(0x206)]((_0x1bfbb0,_0x281fc0)=>{var _0xc3755a=_0x5f06ad;_0x4da740[_0x281fc0][_0xc3755a(0x198)]=_0x1bfbb0;}),_0x4da740[_0x5f06ad(0x206)](_0xc57c92=>{console['log'](_0xc57c92);const _0x3a9756=_0x1567ff['product_details']['map'](_0x10bb45=>{var _0x5aa0f7=a0_0x2691;_0x10bb45[_0x5aa0f7(0x1a6)]==_0xc57c92[_0x5aa0f7(0x1a6)]&&_0x10bb45[_0x5aa0f7(0x196)]==_0xc57c92[_0x5aa0f7(0x196)]&&(console[_0x5aa0f7(0x12e)](parseInt(_0x10bb45[_0x5aa0f7(0x143)])+_0x5aa0f7(0x138)+parseInt(_0xc57c92[_0x5aa0f7(0x215)])),_0x10bb45[_0x5aa0f7(0x143)]=parseInt(_0x10bb45[_0x5aa0f7(0x143)])-parseInt(_0xc57c92[_0x5aa0f7(0x215)]));});}),await _0x1567ff[_0x5f06ad(0x167)]();var _0x3a906b=0x0;_0x4da740[_0x5f06ad(0x206)](_0x1bd3ed=>{var _0x42390c=_0x5f06ad;(parseInt(_0x1bd3ed['purchase_quantity'])<parseInt(_0x1bd3ed['return_qty'])||parseInt(_0x1bd3ed[_0x42390c(0x155)])<parseInt(_0x1bd3ed['return_qty']))&&_0x3a906b++;});if(_0x3a906b!=0x0)return _0x276238[_0x5f06ad(0x1d6)](_0x5f06ad(0x1ed),_0x5f06ad(0x122)),_0x2f89dc['redirect'](_0x5f06ad(0x15d));const _0x56daf7=new purchases_return_finished({'invoice':_0x2cf831,'suppliers':_0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x128)],'date':_0x42e282,'warehouse_name':_0x19111a,'return_product':_0x4da740,'note':_0x513bdb,'room':_0x59f955,'to_warehouse_name':_0x38dcb5,'to_room':_0x3e8499}),_0x564eee=await _0x56daf7[_0x5f06ad(0x167)](),_0x49c8aa=await purchases_return_finished[_0x5f06ad(0x157)]({'invoice':_0x2cf831}),_0x41521e=await warehouse['findOne']({'name':_0x38dcb5,'room':_0x3e8499,'warehouse_category':_0x5f06ad(0x11a)});_0x49c8aa[_0x5f06ad(0x211)][_0x5f06ad(0x206)](_0xf2086d=>{var _0x130ea9=_0x5f06ad,_0x271edf=0x0;const _0x5efb45=_0x41521e[_0x130ea9(0x159)][_0x130ea9(0x149)](_0x3de8d4=>{var _0x5c6c84=_0x130ea9;console['log'](_0x3de8d4[_0x5c6c84(0x1a6)]+'=='+_0xf2086d[_0x5c6c84(0x1a6)]+'&&'+_0x3de8d4[_0x5c6c84(0x196)]+'=='+_0xf2086d['bay']),_0x3de8d4[_0x5c6c84(0x1a6)]==_0xf2086d['product_name']&&_0x3de8d4[_0x5c6c84(0x196)]==_0xf2086d[_0x5c6c84(0x196)]&&(_0x3de8d4['product_stock']=parseInt(_0x3de8d4['product_stock'])-parseInt(_0xf2086d[_0x5c6c84(0x215)]),_0x271edf++);});_0x271edf=='0'&&(_0x41521e['product_details']=_0x41521e[_0x130ea9(0x159)][_0x130ea9(0x1b3)]({'product_name':_0xf2086d[_0x130ea9(0x1a6)],'product_stock':_0xf2086d['return_qty'],'primary_code':_0xf2086d['primary_code'],'secondary_code':_0xf2086d[_0x130ea9(0x198)],'product_code':_0xf2086d[_0x130ea9(0x124)],'bay':_0xf2086d['bay'],'maxProducts':0xf423f}));}),await _0x41521e['save']();const _0x338afd=await purchases_finished[_0x5f06ad(0x157)]({'invoice':_0x2cf831});_0x338afd[_0x5f06ad(0x16e)]='True';const _0x2a99ff=await _0x338afd[_0x5f06ad(0x167)](),_0x2f14c5=new s_payment_data({'invoice':_0x2cf831,'suppliers':_0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x128)],'reason':_0x5f06ad(0x1a1)});await _0x2f14c5[_0x5f06ad(0x167)]();const _0x4ab80c=await master_shop[_0x5f06ad(0x1b2)](),_0x52f887=await email_settings[_0x5f06ad(0x157)](),_0x86c949=await suppliers[_0x5f06ad(0x157)]({'name':_0x276238[_0x5f06ad(0x11c)][_0x5f06ad(0x128)]});_0x4ab80c[0x0]['currency_placement']==0x1?(right_currency=_0x4ab80c[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4ab80c[0x0][_0x5f06ad(0x139)]);var _0x1dc6f4=_0x519513,_0x3fe13a=_0x4413d9,_0x3fa26f='',_0x42dffb;for(_0x42dffb in _0x1dc6f4){_0x3fa26f+=_0x5f06ad(0x1db)+_0x5f06ad(0x17f)+_0x1dc6f4[_0x42dffb]+_0x5f06ad(0x205)+_0x5f06ad(0x17f)+_0x3fe13a[_0x42dffb]+_0x5f06ad(0x205)+_0x5f06ad(0x13e);}let _0x52e048=nodemailer[_0x5f06ad(0x1fe)]({'service':'gmail','auth':{'user':_0x52f887[_0x5f06ad(0x1f1)],'pass':_0x52f887[_0x5f06ad(0x174)]}}),_0x1efb3d={'from':_0x52f887[_0x5f06ad(0x1f1)],'to':_0x86c949[_0x5f06ad(0x1f1)],'subject':_0x5f06ad(0x20c),'attachments':[{'filename':_0x5f06ad(0x1a8),'path':__dirname+'/../public'+_0x5f06ad(0x18e)+_0x4ab80c[0x0][_0x5f06ad(0x1aa)],'cid':_0x5f06ad(0x132)}],'html':_0x5f06ad(0x11d)+_0x5f06ad(0x169)+_0x5f06ad(0x163)+_0x5f06ad(0x161)+_0x5f06ad(0x14d)+_0x5f06ad(0x161)+_0x5f06ad(0x16f)+_0x5f06ad(0x19f)+_0x5f06ad(0x161)+_0x5f06ad(0x212)+_0x4ab80c[0x0][_0x5f06ad(0x1f5)]+_0x5f06ad(0x200)+_0x5f06ad(0x19f)+'</div>'+_0x5f06ad(0x119)+_0x5f06ad(0x161)+_0x5f06ad(0x16b)+_0x5f06ad(0x1f2)+_0x2cf831+'\x20'+_0x5f06ad(0x16d)+_0x5f06ad(0x1fd)+_0x42e282+'\x20'+_0x5f06ad(0x13f)+'</h5>'+'</div>'+_0x5f06ad(0x18d)+_0x5f06ad(0x13d)+_0x5f06ad(0x1db)+_0x5f06ad(0x12c)+_0x5f06ad(0x20e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x5f06ad(0x13e)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3fa26f+'\x20'+_0x5f06ad(0x17a)+_0x5f06ad(0x194)+'<div>'+_0x5f06ad(0x192)+'<h5>'+_0x4ab80c[0x0][_0x5f06ad(0x1f5)]+_0x5f06ad(0x210)+_0x5f06ad(0x19f)+_0x5f06ad(0x19f)+'</body></html>'};_0x52e048[_0x5f06ad(0x11e)](_0x1efb3d,function(_0x5cf83e,_0x728eac){var _0x361fc9=_0x5f06ad;_0x5cf83e?console['log']('Error\x20Occurs'):console[_0x361fc9(0x12e)](_0x361fc9(0x1de));}),_0x276238[_0x5f06ad(0x1d6)]('success',_0x5f06ad(0x145)),_0x2f89dc[_0x5f06ad(0x1e2)](_0x5f06ad(0x14b));}catch(_0x58a135){_0x2f89dc[_0x5f06ad(0x17e)](0xc8)['json']({'message':_0x58a135[_0x5f06ad(0x123)]});}}),router['get'](a0_0x53dd3f(0x187),auth,async(_0x5577cd,_0x56e3d2)=>{var _0x531ca6=a0_0x53dd3f;try{const {username:_0xcc89dd,email:_0x3e3f01,role:_0x69c534}=_0x5577cd[_0x531ca6(0x15b)],_0x5c400e=_0x5577cd[_0x531ca6(0x15b)],_0x5a4a24=await profile['findOne']({'email':_0x5c400e[_0x531ca6(0x1f1)]}),_0x5992f3=await master_shop['find'](),_0x9cc42e=_0x5577cd[_0x531ca6(0x1eb)]['id'],_0x28bc82=await purchases_finished[_0x531ca6(0x146)](_0x9cc42e);if(_0x5992f3[0x0][_0x531ca6(0x1a4)]=='English\x20(US)')var _0x1a9c36=users[_0x531ca6(0x1cb)];else{if(_0x5992f3[0x0][_0x531ca6(0x1a4)]==_0x531ca6(0x1fc))var _0x1a9c36=users[_0x531ca6(0x1fc)];else{if(_0x5992f3[0x0][_0x531ca6(0x1a4)]==_0x531ca6(0x150))var _0x1a9c36=users['German'];else{if(_0x5992f3[0x0]['language']=='Spanish')var _0x1a9c36=users[_0x531ca6(0x12b)];else{if(_0x5992f3[0x0][_0x531ca6(0x1a4)]==_0x531ca6(0x18f))var _0x1a9c36=users['French'];else{if(_0x5992f3[0x0][_0x531ca6(0x1a4)]==_0x531ca6(0x19d))var _0x1a9c36=users['Portuguese'];else{if(_0x5992f3[0x0][_0x531ca6(0x1a4)]==_0x531ca6(0x11b))var _0x1a9c36=users[_0x531ca6(0x11b)];else{if(_0x5992f3[0x0][_0x531ca6(0x1a4)]==_0x531ca6(0x1d5))var _0x1a9c36=users[_0x531ca6(0x178)];}}}}}}}_0x56e3d2[_0x531ca6(0x1d2)](_0x531ca6(0x1e0),{'success':_0x5577cd['flash'](_0x531ca6(0x1ce)),'errors':_0x5577cd[_0x531ca6(0x1d6)](_0x531ca6(0x1ed)),'role':_0x5c400e,'profile':_0x5a4a24,'alldata':_0x28bc82,'master_shop':_0x5992f3,'language':_0x1a9c36}),console[_0x531ca6(0x12e)](alldata);}catch(_0x2d50f6){console[_0x531ca6(0x12e)](_0x2d50f6);}}),router['post'](a0_0x53dd3f(0x168),async(_0x72d69,_0x5b0782)=>{var _0x5fb0ee=a0_0x53dd3f;const {product_code:_0x5885d2}=_0x72d69[_0x5fb0ee(0x11c)];var _0x443731;const _0x5a69a1=await product[_0x5fb0ee(0x14e)]([{'$match':{'primary_code':_0x5885d2,'product_category':_0x5fb0ee(0x11a)}},{'$group':{'_id':'$_id','name':{'$first':_0x5fb0ee(0x1a7)},'category':{'$first':'$category'},'brand':{'$first':_0x5fb0ee(0x1bc)},'unit':{'$first':_0x5fb0ee(0x1d1)},'alertquantity':{'$first':_0x5fb0ee(0x1e3)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x5fb0ee(0x1d3)},'secondary_code':{'$first':_0x5fb0ee(0x179)},'maxStocks':{'$first':_0x5fb0ee(0x173)},'maxProdPerUnit':{'$first':_0x5fb0ee(0x1a0)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5fb0ee(0x1d8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x120bfb=await product[_0x5fb0ee(0x14e)]([{'$match':{'secondary_code':_0x5885d2}},{'$group':{'_id':_0x5fb0ee(0x217),'name':{'$first':_0x5fb0ee(0x1a7)},'category':{'$first':_0x5fb0ee(0x213)},'brand':{'$first':_0x5fb0ee(0x1bc)},'unit':{'$first':_0x5fb0ee(0x1d1)},'alertquantity':{'$first':_0x5fb0ee(0x1e3)},'product_code':{'$first':_0x5fb0ee(0x1b1)},'primary_code':{'$first':_0x5fb0ee(0x1d3)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x5fb0ee(0x173)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5fb0ee(0x1d8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5a69a1[_0x5fb0ee(0x202)]>0x0)_0x443731=_0x5a69a1;else _0x120bfb[_0x5fb0ee(0x202)]>0x0&&(_0x443731=_0x120bfb);_0x5b0782[_0x5fb0ee(0x17c)](_0x443731);}),router[a0_0x53dd3f(0x154)](a0_0x53dd3f(0x1cd),async(_0x565f2a,_0x211fb5)=>{var _0x5ac500=a0_0x53dd3f;const {productCode:_0x60f107,bay:_0x3472a0,warehouses:_0x26da96,room:_0x33356c}=_0x565f2a[_0x5ac500(0x11c)];console['log'](_0x565f2a[_0x5ac500(0x11c)]);try{const _0x2577e2=await warehouse[_0x5ac500(0x14e)]([{'$match':{'name':_0x26da96,'room':_0x33356c}},{'$unwind':_0x5ac500(0x1dd)},{'$match':{'product_details.bay':parseInt(_0x3472a0)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5ac500(0x190)},'maxProducts':{'$first':_0x5ac500(0x160)}}}]);_0x211fb5[_0x5ac500(0x17e)](0xc8)['json'](_0x2577e2);}catch(_0x5db6a3){_0x211fb5['status'](0x194)[_0x5ac500(0x17c)]({'message':_0x5db6a3[_0x5ac500(0x123)]});}}),module[a0_0x53dd3f(0x19e)]=router;function a0_0x432f(){var _0x4f02ae=['slice','<strong>\x20Regards\x20</strong>','$product_details.type','</table>','get','bay','../models/all_models','secondary_code','max_product_unit','$invoice','role','primary_code','Portuguese\x20(BR)','exports','</div>','$maxProdPerUnit','Purchase\x20Return','Portuguese','suppliers_docs','language','add_purchases\x20error','product_name','$name','Logo.png','An\x20error\x20occurred.','image','RoomAssign','$room','edit_purchases_finished_view','/preview/:id','padStart','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_code','find','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','secondary_code_hide','$product_details.secondary_code','$product.bay','Ambient','production_date','$note','prod_qty','$brand','Rack\x201','$expiry_date','invoice','12lRUrrh','POnumber','$product.floorlevel','amount','abs','10WCLJjC','prod_cat','$product_details.storage','/view','$paid_amount','MaxStocks_data','English','$product_details._id','/CheckingWarehouse','success','toString','/view/return_purchase/:id','$unit','render','$primary_code','../middleware/auth','Arabic\x20(ae)','flash','paid_amount','$secondary_unit','Enclosed','stocks','<tr>','Enabled','$product_details','Email\x20sent\x20successfully','getDate','all_purchases_barcode','string','redirect','$alertquantity','error','standard_unit','$product.quantity','maxStocks','getMonth','product_code_hide','/invoice/:id','params','prod_name','errors','secondary_unit','$product_details.bin','10888728xFMuNB','email','\x20Order\x20Number\x20:\x20','stock_data','level','site_title','$product_details.floorlevel','Error\x20Occurs','464788ASFEeZ','Room_name','random','room','Hindi','\x20Order\x20Date\x20:\x20','createTransport','master','\x20</h2>','purchase_quantity','length','Router','/view/:id','</td>','forEach','693173WDFmAo','21jFxNWz','purchase\x20data\x20add\x20successfully','12604842yUjrhh','updateOne','Purchase\x20Return\x20Mail','$suppliers','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$due_amount','</h5>','return_product','<h2>\x20','$category','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','return_qty','QA\x20Warehouse','$_id','/view/add_purchases/:id','product','$product.bin','2363165nWJlwB','<hr\x20class=\x22my-3\x22>','Finished\x20Goods','Chinese','body','<!DOCTYPE\x20html>','sendMail','An\x20error\x20occurred\x20while\x20saving\x20data.','warehouse_name','path','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','message','product_code','$warehouse_name','edit_purchases_finished','1000LTluVK','suppliers','prod_primunit','host','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','log','name','ejs','catch','logo','prod_unit','$product_details.product_code','primary_code_hide','31207770GhNYEd','product_date','\x20<>\x20','currency','$product.room_name','nodemailer','$suppliers_docs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</tr>','</span>','$product_details.primary_code','staff','floor','product_stock','room_name','purchases\x20item\x20return\x20successfull','findById','Purchase\x20Mail','_id','map','$batch_code','/all_purchases_finished/view','INCF-','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','aggregate','filter','German','then','/view/add_purchases','prod_secondunit','post','stock_quantity','date','findOne','../public/language/languages.json','product_details','Return\x20Goods','user','$date','back','note','maxperunit','$product_details.maxProducts','<div>','due_amount','</head><body>','all_purchases_finished','FROZEN\x20GOODS','$product_details.rack','save','/barcode_scanner','<html><head><title></title>','getFullYear','<h5\x20style=\x22text-align:\x20left;\x22>','prod_invoice','<span\x20style=\x22float:\x20right;\x22>','return_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product.type','warehouse','Rack\x202','$maxStocks','password','prod_level','$product','table\x20page','Arabic','$secondary_code','</tbody>','English\x20(US)','json','DRY\x20GOODS','status','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Paid\x20For\x20Purchase','expiry_date','batch_code','purchase\x20data\x20update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','quantity','/all_purchases/view','/barcode/:id','23025TcAzIj','prod_code','purchase_invoice','prod_Qty','product_cat','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/upload/','French','$product_details.bay'];a0_0x432f=function(){return _0x4f02ae;};return a0_0x432f();}