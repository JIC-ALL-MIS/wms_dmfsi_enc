var a0_0xfb35e6=a0_0x107f;(function(_0x753617,_0x133a1b){var _0x36fc37=a0_0x107f,_0x58161e=_0x753617();while(!![]){try{var _0x16028f=-parseInt(_0x36fc37(0x279))/0x1+parseInt(_0x36fc37(0x233))/0x2*(parseInt(_0x36fc37(0x247))/0x3)+-parseInt(_0x36fc37(0x1ef))/0x4+parseInt(_0x36fc37(0x1d8))/0x5+-parseInt(_0x36fc37(0x225))/0x6*(parseInt(_0x36fc37(0x1fb))/0x7)+parseInt(_0x36fc37(0x23c))/0x8+-parseInt(_0x36fc37(0x282))/0x9*(parseInt(_0x36fc37(0x1b8))/0xa);if(_0x16028f===_0x133a1b)break;else _0x58161e['push'](_0x58161e['shift']());}catch(_0x4b32cd){_0x58161e['push'](_0x58161e['shift']());}}}(a0_0x233d,0x44557));const express=require(a0_0xfb35e6(0x229)),app=express(),router=express[a0_0xfb35e6(0x24f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0xfb35e6(0x1f9)),auth=require(a0_0xfb35e6(0x207)),nodemailer=require(a0_0xfb35e6(0x1d9));function a0_0x107f(_0x9b7870,_0x27a366){var _0x233d3b=a0_0x233d();return a0_0x107f=function(_0x107f1e,_0x1b5976){_0x107f1e=_0x107f1e-0x1ad;var _0x396c7c=_0x233d3b[_0x107f1e];return _0x396c7c;},a0_0x107f(_0x9b7870,_0x27a366);}var ejs=require('ejs');const path=require('path'),users=require(a0_0xfb35e6(0x219));router['get'](a0_0xfb35e6(0x1b3),auth,async(_0x56a248,_0x637bdc)=>{var _0x219060=a0_0xfb35e6;try{const {username:_0x2f02fe,email:_0x1b88ae,role:_0xba082d}=_0x56a248['user'],_0x9fd2c9=_0x56a248[_0x219060(0x1f3)],_0x4bbf24=await profile[_0x219060(0x237)]({'email':_0x9fd2c9[_0x219060(0x258)]}),_0x388a76=await staff[_0x219060(0x237)]({'email':_0x9fd2c9[_0x219060(0x258)]});if(_0x9fd2c9[_0x219060(0x1c5)]==_0x219060(0x28d)){const _0x1847c8=await staff['findOne']({'email':_0x9fd2c9[_0x219060(0x258)]});}const _0x57e688=await master_shop[_0x219060(0x291)]();let _0xe51385;if(_0x9fd2c9[_0x219060(0x1c5)]==_0x219060(0x28d)){const _0x1c4940=await staff[_0x219060(0x237)]({'email':_0x9fd2c9[_0x219060(0x258)]});_0xe51385=await purchases_finished[_0x219060(0x264)]([{'$match':{'warehouse_name':_0x1c4940[_0x219060(0x2a3)]}},{'$lookup':{'from':_0x219060(0x201),'localField':_0x219060(0x201),'foreignField':_0x219060(0x1b9),'as':_0x219060(0x23f)}},{'$unwind':_0x219060(0x26a)},{'$unwind':_0x219060(0x253)},{'$group':{'_id':_0x219060(0x222),'invoice':{'$first':_0x219060(0x26f)},'suppliers':{'$first':_0x219060(0x21e)},'date':{'$first':_0x219060(0x232)},'warehouse_name':{'$first':_0x219060(0x276)},'room':{'$first':_0x219060(0x208)},'product':{'$push':_0x219060(0x253)},'note':{'$first':_0x219060(0x1d5)},'paid_amount':{'$first':_0x219060(0x273)},'due_amount':{'$first':_0x219060(0x1db)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x219060(0x1ad)},'expiry_date':{'$first':_0x219060(0x1e1)},'suppliers_docs':{'$first':_0x219060(0x26a)},'total_product_quantity':{'$sum':_0x219060(0x263)},'level':{'$addToSet':_0x219060(0x1bc)},'isle':{'$addToSet':_0x219060(0x1fc)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xe51385=await purchases_finished[_0x219060(0x264)]([{'$unwind':_0x219060(0x253)},{'$group':{'_id':_0x219060(0x222),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x219060(0x21e)},'date':{'$first':_0x219060(0x232)},'warehouse_name':{'$first':_0x219060(0x276)},'room':{'$addToSet':_0x219060(0x1e4)},'product':{'$push':_0x219060(0x253)},'note':{'$first':_0x219060(0x1d5)},'paid_amount':{'$first':_0x219060(0x273)},'due_amount':{'$first':_0x219060(0x1db)},'return_data':{'$first':_0x219060(0x2a6)},'batch_code':{'$first':_0x219060(0x1ad)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x219060(0x26a)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x219060(0x1bc)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x219060(0x1c3)},'floorlevel':{'$addToSet':_0x219060(0x1b7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x57e688[0x0]['language']==_0x219060(0x296))var _0x92c96a=users[_0x219060(0x210)];else{if(_0x57e688[0x0][_0x219060(0x250)]=='Hindi')var _0x92c96a=users[_0x219060(0x289)];else{if(_0x57e688[0x0][_0x219060(0x250)]=='German')var _0x92c96a=users['German'];else{if(_0x57e688[0x0]['language']==_0x219060(0x27f))var _0x92c96a=users['Spanish'];else{if(_0x57e688[0x0][_0x219060(0x250)]=='French')var _0x92c96a=users[_0x219060(0x28c)];else{if(_0x57e688[0x0][_0x219060(0x250)]=='Portuguese\x20(BR)')var _0x92c96a=users[_0x219060(0x26c)];else{if(_0x57e688[0x0][_0x219060(0x250)]==_0x219060(0x227))var _0x92c96a=users[_0x219060(0x227)];else{if(_0x57e688[0x0][_0x219060(0x250)]==_0x219060(0x274))var _0x92c96a=users['Arabic'];}}}}}}}_0x637bdc['render']('all_purchases_finished',{'success':_0x56a248[_0x219060(0x1b6)](_0x219060(0x21f)),'errors':_0x56a248[_0x219060(0x1b6)]('errors'),'purchases':_0xe51385,'role':_0x9fd2c9,'profile':_0x4bbf24,'master_shop':_0x57e688,'language':_0x92c96a});}catch(_0x46143c){console[_0x219060(0x27d)](_0x219060(0x231),_0x46143c),_0x637bdc[_0x219060(0x261)](0xc8)[_0x219060(0x270)]({'message':_0x46143c['message']});}});function a0_0x233d(){var _0x10eceb=['abs','findOne','getDate','$secondary_unit','product_cat','</table>','1083184lsEgjW','$brand','<span\x20style=\x22float:\x20right;\x22>','suppliers_docs','\x20Order\x20Date\x20:\x20','product_code','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','MaxStocks_data','prod_secondunit','product_stock','1563KMUpIG','errors','\x20<>\x20','prod_unit','$maxStocks','secondary_code','add_purchases_finished','$product_details.product_stock','Router','language','</td>','DRY\x20GOODS','$product','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$unit','product_date','email','<!DOCTYPE\x20html>','note','findById','edit_purchases_finished_view','/view/return_purchase/:id','date','$secondary_code','$product_details.type','status','slice','$product.quantity','aggregate','$product_details.primary_code','standard_unit','expiry_date','add_purchases\x20error','return_purchase_finished','$suppliers_docs','get','Portuguese','</div>','<strong>\x20Regards\x20</strong>','$invoice','json','paid_amount','redirect','$paid_amount','Arabic\x20(ae)','max_product_unit','$warehouse_name','purchase_quantity','/CheckingWarehouse','146410oAaJYY','Paid\x20For\x20Purchase','FROZEN\x20GOODS','purchase_invoice','log','product_details','Spanish','string','$name','162VgrnJd','Purchase\x20Mail','then','German','/view/:id','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<html><head><title></title>','French','staff','</thead>','<div>','$primary_code','find','purchase\x20data\x20update\x20successfully','user_id','prod_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','English\x20(US)','gmail','Email\x20sent\x20successfully','Logo.png','concat','/upload/','Error\x20Occurs','INCF-','Rack\x202','</tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','prod_name','$product_details.floorlevel','warehouse','$product_details.bay','due_amount','$return_data','Finished\x20Goods','$batch_code','\x20</h2>','</head><body>','$product_details.product_name','secondary_code_hide','<tr>','/view','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','sendMail','flash','$product.floorlevel','77400kidlTT','name','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','stock_quantity','$product.bay','getFullYear','message','filter','prod_invoice','Rack\x201','/give_payment/:id','$product.type','\x20Order\x20Number\x20:\x20','role','prod_level','stocks','<h2>\x20','secondary_unit','RoomAssign','purchases\x20item\x20return\x20successfull','An\x20error\x20occurred\x20while\x20saving\x20data.','body','warehouse_name','prod_primunit','port','params','post','forEach','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$note','$product_details._id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','2184530ljJdWX','nodemailer','quantity','$due_amount','production_date','level','<hr\x20class=\x22my-3\x22>','Purchase\x20Return\x20Mail','site_title','$expiry_date','updateOne','amount','$product.room_name','createTransport','</body></html>','$product_code','prod_cat','/all_purchases_finished/view','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/add_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','render','$product_details.secondary_code','1876960HMpRIh','$product_details.maxProducts','return_product','<h5\x20style=\x22text-align:\x20left;\x22>','user','$maxProdPerUnit','prod_Qty','room','$product_details','product_name','../models/all_models','master','288722GJHEUz','$product.bin','/view/add_purchases/:id','toString','maxStocks','logo','suppliers','An\x20error\x20occurred.','Enabled','/../public','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product','../middleware/auth','$room','padStart','There\x27s\x20a\x20error\x20in\x20this\x20transaction','error','<h5>','batch_code','getMonth','back','English','$category','return_qty','/invoice/:id','bay','</span>','all_purchases_barcode','save','Purchase\x20Return','../public/language/languages.json','length','Arabic','QA\x20Warehouse','primary_code','$suppliers','success','image','stock_data','$_id','map','room_name','6NcpQQZ','$alertquantity','Chinese','product_code_hide','express','JO_number','password','exports','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Return\x20Goods','</h5>','table\x20page','$date','1934jOJaek','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','invoice'];a0_0x233d=function(){return _0x10eceb;};return a0_0x233d();}function BayBinSelected(_0x225e11,_0x1a0794){var _0x5ee635=a0_0xfb35e6,_0x49121a=[],_0x2003b8=[];if(_0x225e11==_0x5ee635(0x252)){switch(_0x1a0794){case _0x5ee635(0x1c1):_0x49121a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x5ee635(0x29e):_0x49121a=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2003b8=['DG'];}else{if(_0x225e11==_0x5ee635(0x27b)){switch(_0x1a0794){case _0x5ee635(0x1c1):_0x49121a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x5ee635(0x29e):_0x49121a=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2003b8=['FG'];}}return{'levels':_0x49121a,'identify':_0x2003b8};}async function getRandom8DigitNumber(){var _0x4c84ab=a0_0xfb35e6;const _0x5c9445=0x989680,_0x5aa4c2=0x5f5e0ff,_0x47b0a4=Math[_0x4c84ab(0x242)](Math['random']()*(_0x5aa4c2-_0x5c9445+0x1))+_0x5c9445;var _0x35a14f;const _0xc64827=await purchases_finished[_0x4c84ab(0x237)]({'invoice':'INCF-'+_0x47b0a4});return _0xc64827&&_0xc64827[_0x4c84ab(0x21a)]>0x0?_0x35a14f=_0x4c84ab(0x29d)+_0x47b0a4:_0x35a14f=_0x4c84ab(0x29d)+_0x47b0a4,_0x35a14f;}router[a0_0xfb35e6(0x26b)](a0_0xfb35e6(0x1eb),auth,async(_0x10c557,_0x4d01c0)=>{var _0x4ae32d=a0_0xfb35e6;try{const {username:_0x11a1e3,email:_0x1ed02c,role:_0x3ccb11}=_0x10c557[_0x4ae32d(0x1f3)],_0x40a69e=_0x10c557[_0x4ae32d(0x1f3)],_0x4ef297=await profile[_0x4ae32d(0x237)]({'email':_0x40a69e[_0x4ae32d(0x258)]}),_0x596abe=await master_shop['find'](),_0x54aa17=await staff[_0x4ae32d(0x237)]({'email':_0x40a69e['email']}),_0x36508b=await suppliers[_0x4ae32d(0x291)]({});let _0x96975e;if(_0x40a69e[_0x4ae32d(0x1c5)]=='staff'){const _0x259095=await staff[_0x4ae32d(0x237)]({'email':_0x40a69e[_0x4ae32d(0x258)]});_0x96975e=await warehouse['aggregate']([{'$match':{'status':_0x4ae32d(0x203),'name':_0x259095[_0x4ae32d(0x2a3)],'warehouse_category':_0x4ae32d(0x2a7)}},{'$group':{'_id':'$name','name':{'$first':_0x4ae32d(0x281)}}}]);}else _0x96975e=await warehouse[_0x4ae32d(0x264)]([{'$match':{'status':_0x4ae32d(0x203),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x4ae32d(0x21c)}}},{'$group':{'_id':_0x4ae32d(0x281),'name':{'$first':_0x4ae32d(0x281)}}}]);const _0x171749=await product[_0x4ae32d(0x291)]({}),_0x45a146=await warehouse['find']({'status':_0x4ae32d(0x203)}),_0x3ebf5b=await purchases_finished[_0x4ae32d(0x291)]({}),_0x1999b4=_0x3ebf5b[_0x4ae32d(0x21a)]+0x1,_0x44d485=_0x4ae32d(0x29d)+_0x1999b4[_0x4ae32d(0x1fe)]()[_0x4ae32d(0x209)](0x5,'0');var _0x43019a=['Ambient','Enclosed'];if(_0x596abe[0x0][_0x4ae32d(0x250)]==_0x4ae32d(0x296))var _0x4dcae0=users[_0x4ae32d(0x210)];else{if(_0x596abe[0x0][_0x4ae32d(0x250)]==_0x4ae32d(0x289))var _0x4dcae0=users[_0x4ae32d(0x289)];else{if(_0x596abe[0x0][_0x4ae32d(0x250)]==_0x4ae32d(0x285))var _0x4dcae0=users[_0x4ae32d(0x285)];else{if(_0x596abe[0x0][_0x4ae32d(0x250)]==_0x4ae32d(0x27f))var _0x4dcae0=users[_0x4ae32d(0x27f)];else{if(_0x596abe[0x0][_0x4ae32d(0x250)]=='French')var _0x4dcae0=users[_0x4ae32d(0x28c)];else{if(_0x596abe[0x0][_0x4ae32d(0x250)]=='Portuguese\x20(BR)')var _0x4dcae0=users[_0x4ae32d(0x26c)];else{if(_0x596abe[0x0][_0x4ae32d(0x250)]=='Chinese')var _0x4dcae0=users[_0x4ae32d(0x227)];else{if(_0x596abe[0x0][_0x4ae32d(0x250)]=='Arabic\x20(ae)')var _0x4dcae0=users[_0x4ae32d(0x21b)];}}}}}}}const _0x10f052=getRandom8DigitNumber();_0x10f052[_0x4ae32d(0x284)](_0x1d3fc9=>{var _0x2650fd=_0x4ae32d;_0x4d01c0[_0x2650fd(0x1ed)](_0x2650fd(0x24d),{'success':_0x10c557[_0x2650fd(0x1b6)]('success'),'errors':_0x10c557[_0x2650fd(0x1b6)](_0x2650fd(0x248)),'role':_0x40a69e,'profile':_0x4ef297,'suppliers':_0x36508b,'warehouse':_0x96975e,'product':_0x171749,'invoice':_0x1d3fc9,'master_shop':_0x596abe,'language':_0x4dcae0,'find_data':_0x45a146,'rooms_data':_0x43019a});})[_0x4ae32d(0x22d)](_0x16ac94=>{var _0x1ade59=_0x4ae32d;_0x10c557[_0x1ade59(0x1b6)](_0x1ade59(0x248),_0x1ade59(0x20a)),_0x4d01c0[_0x1ade59(0x272)](_0x1ade59(0x1e9));});}catch(_0x2defa7){console[_0x4ae32d(0x27d)](_0x2defa7);}}),router[a0_0xfb35e6(0x26b)](a0_0xfb35e6(0x1fd),auth,async(_0x302fbb,_0x4694e2)=>{var _0x18f631=a0_0xfb35e6;try{const _0x43acb8=_0x302fbb[_0x18f631(0x1d1)]['id'];console['log'](_0x43acb8);const _0x5475eb=await master_shop[_0x18f631(0x291)]();console['log']('master',_0x5475eb);const _0x9d74b0=await product[_0x18f631(0x237)]({'name':_0x43acb8});console['log'](_0x18f631(0x206),_0x9d74b0),_0x4694e2[_0x18f631(0x261)](0xc8)[_0x18f631(0x270)]({'product_data':_0x9d74b0,'master':_0x5475eb});}catch(_0x3f7cb4){console[_0x18f631(0x27d)](_0x18f631(0x268),_0x3f7cb4);}}),router[a0_0xfb35e6(0x1d2)]('/view/add_purchases',auth,async(_0x3c1636,_0x20ae53)=>{var _0x11b5d9=a0_0xfb35e6;try{const {invoice:_0x11b352,date:_0x135911,warehouse_name:_0x1f6cf4,prod_name:_0x1c5245,prod_code:_0x3aa097,prod_qty:_0x4f365b,prod_unit:_0x1574a0,prod_secondunit:_0x316632,prod_level:_0x4266c5,prod_isle:_0x4141ac,prod_pallet:_0x9c7e7f,note:_0x4802c5,expiry_date:_0x28f831,batch_code:_0x540c4c,payable:_0x1c4887,due_amount:_0x1cb184,Room_name:_0x4b7d9d,primary_code:_0x5a1c49,secondary_code:_0x20cd16,MaxStocks_data:_0x5247fa,PO_number:_0x5aded8,SCRN:_0x5d4dc5,JO_number:_0x2b5813}=_0x3c1636[_0x11b5d9(0x1cd)];if(typeof _0x1c5245==_0x11b5d9(0x280))var _0x7e76da=[_0x3c1636['body'][_0x11b5d9(0x2a1)]],_0xd14092=[_0x3c1636[_0x11b5d9(0x1cd)]['prod_code']],_0x367453=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x1f5)]],_0x9ac9e9=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x1cf)]],_0x43905a=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x245)]],_0x27e31e=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x1c6)]],_0x531849=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x21d)]],_0x22b51=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x24c)]],_0x428c24=[_0x3c1636[_0x11b5d9(0x1cd)]['MaxStocks_data']],_0x43c287=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x20d)]],_0x3407d2=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x267)]],_0x4e2c28=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x257)]],_0x2504db=[_0x3c1636['body'][_0x11b5d9(0x275)]],_0xe424f4=[_0x3c1636['body'][_0x11b5d9(0x1e8)]],_0x20a0b0=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x1ca)]],_0x17a8c0=[_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x1c0)]];else var _0x7e76da=[..._0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x2a1)]],_0xd14092=[..._0x3c1636['body'][_0x11b5d9(0x294)]],_0x367453=[..._0x3c1636[_0x11b5d9(0x1cd)]['prod_Qty']],_0x9ac9e9=[..._0x3c1636['body']['prod_primunit']],_0x43905a=[..._0x3c1636[_0x11b5d9(0x1cd)]['prod_secondunit']],_0x27e31e=[..._0x3c1636[_0x11b5d9(0x1cd)]['prod_level']],_0x531849=[..._0x3c1636['body'][_0x11b5d9(0x21d)]],_0x22b51=[..._0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x24c)]],_0x428c24=[..._0x3c1636['body']['MaxStocks_data']],_0x43c287=[..._0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x20d)]],_0x3407d2=[..._0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x267)]],_0x4e2c28=[..._0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x257)]],_0x2504db=[..._0x3c1636['body'][_0x11b5d9(0x275)]],_0xe424f4=[..._0x3c1636['body'][_0x11b5d9(0x1e8)]],_0x20a0b0=[..._0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x1ca)]],_0x17a8c0=[..._0x3c1636['body']['prod_invoice']];const _0x4ead66=_0x7e76da[_0x11b5d9(0x223)](_0xa9762d=>{return _0xa9762d={'product_name':_0xa9762d};});_0xd14092[_0x11b5d9(0x1d3)]((_0x1ca21f,_0x572d06)=>{var _0x29d8ad=_0x11b5d9;_0x4ead66[_0x572d06][_0x29d8ad(0x241)]=_0x1ca21f;}),_0x367453['forEach']((_0x43e6bc,_0x236ad4)=>{var _0x9504eb=_0x11b5d9;_0x4ead66[_0x236ad4][_0x9504eb(0x1da)]=Math['abs'](_0x43e6bc);}),_0x9ac9e9[_0x11b5d9(0x1d3)]((_0x177182,_0xc95f78)=>{var _0x4d5528=_0x11b5d9;_0x4ead66[_0xc95f78][_0x4d5528(0x266)]=_0x177182;}),_0x43905a[_0x11b5d9(0x1d3)]((_0x4a1be7,_0x314819)=>{_0x4ead66[_0x314819]['secondary_unit']=_0x4a1be7;}),_0x27e31e['forEach']((_0x1be3ec,_0xaf2f1d)=>{var _0x348f4e=_0x11b5d9;_0x4ead66[_0xaf2f1d][_0x348f4e(0x214)]=_0x1be3ec;}),_0x531849['forEach']((_0x23162b,_0x38f56e)=>{var _0x2db18a=_0x11b5d9;_0x4ead66[_0x38f56e][_0x2db18a(0x21d)]=_0x23162b;}),_0x22b51[_0x11b5d9(0x1d3)]((_0x54d401,_0x56604b)=>{var _0x29fedc=_0x11b5d9;_0x4ead66[_0x56604b][_0x29fedc(0x24c)]=_0x54d401;}),_0x428c24[_0x11b5d9(0x1d3)]((_0xb51006,_0x661ec8)=>{var _0x282c5c=_0x11b5d9;_0x4ead66[_0x661ec8][_0x282c5c(0x1ff)]=_0xb51006;}),_0x43c287['forEach']((_0x173aa3,_0x1349ca)=>{var _0x26a80d=_0x11b5d9;_0x4ead66[_0x1349ca][_0x26a80d(0x20d)]=_0x173aa3;}),_0x3407d2[_0x11b5d9(0x1d3)]((_0x2b123a,_0x571b3a)=>{var _0x1a3941=_0x11b5d9;_0x4ead66[_0x571b3a][_0x1a3941(0x267)]=_0x2b123a;}),_0x4e2c28[_0x11b5d9(0x1d3)]((_0x721ad3,_0x480e29)=>{var _0x37405b=_0x11b5d9;_0x4ead66[_0x480e29][_0x37405b(0x1dc)]=_0x721ad3;}),_0x2504db[_0x11b5d9(0x1d3)]((_0x52549d,_0x256ff2)=>{_0x4ead66[_0x256ff2]['maxperunit']=_0x52549d;}),_0xe424f4[_0x11b5d9(0x1d3)]((_0x21d0cc,_0x18d007)=>{var _0x2d3a86=_0x11b5d9;_0x4ead66[_0x18d007][_0x2d3a86(0x23a)]=_0x21d0cc;}),_0x20a0b0['forEach']((_0x42a0d8,_0x5d035a)=>{var _0xc48dc3=_0x11b5d9;_0x4ead66[_0x5d035a][_0xc48dc3(0x224)]=_0x42a0d8;}),_0x17a8c0[_0x11b5d9(0x1d3)]((_0xae6e3d,_0x1fb212)=>{var _0xc4c58d=_0x11b5d9;_0x4ead66[_0x1fb212][_0xc4c58d(0x235)]=_0xae6e3d;});const _0x585c95=_0x4ead66[_0x11b5d9(0x1bf)](_0x7185c6=>_0x7185c6[_0x11b5d9(0x1da)]!=='0'&&_0x7185c6[_0x11b5d9(0x1da)]!==''),_0x2721d2=new purchases_finished({'invoice':_0x11b352,'suppliers':_0x3c1636[_0x11b5d9(0x1cd)][_0x11b5d9(0x201)],'date':_0x135911,'warehouse_name':_0x1f6cf4,'product':_0x585c95,'note':_0x4802c5,'due_amount':_0x1cb184,'room':_0x4b7d9d,'POnumber':_0x5aded8,'SCRN':_0x5d4dc5,'JO_number':_0x2b5813}),_0x1660a9=await _0x2721d2[_0x11b5d9(0x217)](),_0x394d9a=await purchases_finished['findOne']({'invoice':_0x11b352}),_0x5819ef=_0x394d9a[_0x11b5d9(0x206)][_0x11b5d9(0x223)](async _0x209692=>{var _0x87e214=_0x11b5d9,_0x5a26f6=await warehouse[_0x87e214(0x237)]({'name':_0x1f6cf4,'room':_0x209692[_0x87e214(0x224)]}),_0x4627c4=0x0;const _0x53fd24=_0x5a26f6[_0x87e214(0x27e)][_0x87e214(0x223)](_0xd0764b=>{var _0x44b69b=_0x87e214;console[_0x44b69b(0x27d)](_0xd0764b['product_name']+'=='+_0x209692[_0x44b69b(0x1f8)]+'&&'+_0xd0764b[_0x44b69b(0x214)]+'=='+_0x209692['bay']+'&&'+_0xd0764b[_0x44b69b(0x267)]+'=='+_0x209692[_0x44b69b(0x267)]+'&&'+_0xd0764b[_0x44b69b(0x1dc)]+'=='+_0x209692['production_date']+'&&'+_0xd0764b[_0x44b69b(0x20d)]+'=='+_0x209692['batch_code']+'&&'+_0xd0764b['invoice']+'=='+_0x394d9a[_0x44b69b(0x235)]),_0xd0764b[_0x44b69b(0x1f8)]==_0x209692[_0x44b69b(0x1f8)]&&_0xd0764b['bay']==_0x209692[_0x44b69b(0x214)]&&_0xd0764b[_0x44b69b(0x267)]==_0x209692['expiry_date']&&_0xd0764b[_0x44b69b(0x1dc)]==_0x209692[_0x44b69b(0x1dc)]&&_0xd0764b[_0x44b69b(0x20d)]==_0x209692[_0x44b69b(0x20d)]&&_0xd0764b[_0x44b69b(0x235)]==_0x394d9a[_0x44b69b(0x235)]&&(_0xd0764b[_0x44b69b(0x246)]=Math[_0x44b69b(0x236)](_0xd0764b[_0x44b69b(0x246)])+Math[_0x44b69b(0x236)](_0x209692[_0x44b69b(0x1da)]),_0x4627c4++);});return _0x4627c4=='0'&&(_0x5a26f6['product_details']=_0x5a26f6['product_details'][_0x87e214(0x29a)]({'product_name':_0x209692[_0x87e214(0x1f8)],'product_stock':Math['abs'](_0x209692[_0x87e214(0x1da)]),'primary_code':_0x209692[_0x87e214(0x21d)],'secondary_code':_0x209692[_0x87e214(0x24c)],'product_code':_0x209692[_0x87e214(0x241)],'bay':_0x209692[_0x87e214(0x214)],'maxProducts':_0x209692[_0x87e214(0x1ff)],'unit':_0x209692[_0x87e214(0x266)],'secondary_unit':_0x209692[_0x87e214(0x1c9)],'expiry_date':_0x209692[_0x87e214(0x267)],'production_date':_0x209692[_0x87e214(0x1dc)],'maxProducts':_0x209692[_0x87e214(0x1ff)],'maxPerUnit':_0x209692['maxperunit'],'batch_code':_0x209692[_0x87e214(0x20d)],'product_cat':_0x209692['product_cat'],'invoice':_0x209692['invoice']})),_0x5a26f6;});Promise['all'](_0x5819ef)[_0x11b5d9(0x284)](async _0x311d9e=>{var _0x2476c3=_0x11b5d9;try{for(const _0x17bbef of _0x311d9e){await warehouse[_0x2476c3(0x1e2)]({'_id':_0x17bbef['_id']},{'$addToSet':{'product_details':{'$each':_0x17bbef[_0x2476c3(0x27e)]}}});}const _0x1f32d5=await master_shop[_0x2476c3(0x291)](),_0x4d0306=await email_settings[_0x2476c3(0x237)](),_0x133318=await supervisor_settings[_0x2476c3(0x291)]();var _0x4377a7=_0x394d9a['product'],_0xe99b4f='',_0x1d6af7;for(_0x1d6af7 in _0x4377a7){var _0x521a55='FG';_0x394d9a[_0x2476c3(0x1ce)]==_0x2476c3(0x252)&&(_0x521a55='DG'),_0xe99b4f+=_0x2476c3(0x1b2)+_0x2476c3(0x295)+_0x4377a7[_0x1d6af7][_0x2476c3(0x1f8)]+_0x2476c3(0x251)+_0x2476c3(0x295)+_0x4377a7[_0x1d6af7][_0x2476c3(0x241)]+'</td>'+_0x2476c3(0x295)+_0x4377a7[_0x1d6af7][_0x2476c3(0x1da)]+'</td>'+_0x2476c3(0x295)+_0x4377a7[_0x1d6af7][_0x2476c3(0x266)]+_0x2476c3(0x251)+_0x2476c3(0x295)+_0x4377a7[_0x1d6af7][_0x2476c3(0x1c9)]+_0x2476c3(0x251)+_0x2476c3(0x295)+_0x394d9a[_0x2476c3(0x1ce)]+_0x2476c3(0x251)+_0x2476c3(0x295)+_0x4377a7[_0x1d6af7][_0x2476c3(0x224)]+'</td>'+_0x2476c3(0x295)+_0x521a55+_0x4377a7[_0x1d6af7]['bay']+'</td>','</tr>';}let _0x37b151=nodemailer[_0x2476c3(0x1e5)]({'host':_0x4d0306['host'],'port':Number(_0x4d0306[_0x2476c3(0x1d0)]),'secure':![],'auth':{'user':_0x4d0306[_0x2476c3(0x258)],'pass':_0x4d0306[_0x2476c3(0x22b)]}}),_0x5bb2fa={'from':_0x4d0306[_0x2476c3(0x258)],'to':_0x133318[0x0]['FGSEmail'],'subject':_0x2476c3(0x283),'attachments':[{'filename':_0x2476c3(0x299),'path':__dirname+_0x2476c3(0x204)+_0x2476c3(0x29b)+_0x1f32d5[0x0][_0x2476c3(0x220)],'cid':'logo'}],'html':_0x2476c3(0x259)+'<html><head><title></title>'+'</head><body>'+_0x2476c3(0x28f)+_0x2476c3(0x1b4)+_0x2476c3(0x28f)+_0x2476c3(0x1ea)+_0x2476c3(0x26d)+_0x2476c3(0x28f)+_0x2476c3(0x1c8)+_0x1f32d5[0x0]['site_title']+'\x20</h2>'+_0x2476c3(0x26d)+'</div>'+_0x2476c3(0x1de)+_0x2476c3(0x28f)+_0x2476c3(0x1f2)+_0x2476c3(0x1c4)+_0x394d9a[_0x2476c3(0x235)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2476c3(0x240)+_0x394d9a[_0x2476c3(0x25e)]+'\x20'+_0x2476c3(0x215)+_0x2476c3(0x230)+_0x2476c3(0x26d)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2476c3(0x205)+_0x2476c3(0x1b2)+_0x2476c3(0x255)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x2476c3(0x243)+_0x2476c3(0x288)+_0x2476c3(0x1ec)+_0x2476c3(0x2a0)+_0x2476c3(0x234)+_0x2476c3(0x28a)+_0x2476c3(0x29f)+_0x2476c3(0x28e)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xe99b4f+'\x20'+'</tbody>'+_0x2476c3(0x23b)+_0x2476c3(0x28f)+_0x2476c3(0x26e)+_0x2476c3(0x20c)+_0x1f32d5[0x0][_0x2476c3(0x1e0)]+_0x2476c3(0x230)+'</div>'+'</div>'+_0x2476c3(0x1e6)};_0x37b151[_0x2476c3(0x1b5)](_0x5bb2fa,function(_0x1fcfca,_0x3f0b92){var _0x3b452a=_0x2476c3;_0x1fcfca?(console['log'](_0x1fcfca),console[_0x3b452a(0x27d)](_0x3b452a(0x29c))):console[_0x3b452a(0x27d)]('Email\x20sent\x20successfully');});}catch(_0xb5ff2f){console[_0x2476c3(0x20b)](_0xb5ff2f),_0x20ae53[_0x2476c3(0x261)](0x1f4)['json']({'error':_0x2476c3(0x1cc),'message':_0xb5ff2f[_0x2476c3(0x1be)]});}})[_0x11b5d9(0x22d)](_0x3fb5cb=>{var _0x1b58e2=_0x11b5d9;console[_0x1b58e2(0x20b)](_0x3fb5cb),_0x20ae53['status'](0x1f4)[_0x1b58e2(0x270)]({'error':_0x1b58e2(0x202)});}),_0x3c1636['flash'](_0x11b5d9(0x21f),'purchase\x20data\x20add\x20successfully'),_0x20ae53[_0x11b5d9(0x272)](_0x11b5d9(0x1e9));}catch(_0x27b40e){console[_0x11b5d9(0x27d)](_0x27b40e);}}),router[a0_0xfb35e6(0x26b)]('/preview/:id',auth,async(_0x4855d2,_0x3bed60)=>{var _0x3f1159=a0_0xfb35e6;try{const {username:_0x59b0e4,email:_0x4e076f,role:_0x311076}=_0x4855d2[_0x3f1159(0x1f3)],_0x450015=_0x4855d2[_0x3f1159(0x1f3)],_0x112495=await profile[_0x3f1159(0x237)]({'email':_0x450015['email']}),_0x2b9b94=await master_shop[_0x3f1159(0x291)](),_0x1fe71e=_0x4855d2[_0x3f1159(0x1d1)]['id'],_0xcf58d0=await purchases_finished[_0x3f1159(0x25b)](_0x1fe71e),_0x584b16=await suppliers['find']({});let _0x486544;if(_0x450015[_0x3f1159(0x1c5)]=='staff'){const _0x410e84=await staff[_0x3f1159(0x237)]({'email':_0x450015[_0x3f1159(0x258)]});_0x486544=await warehouse[_0x3f1159(0x291)]({'status':_0x3f1159(0x203),'name':_0x410e84[_0x3f1159(0x2a3)],'warehouse_category':_0x3f1159(0x2a7)});}else _0x486544=await warehouse[_0x3f1159(0x264)]([{'$match':{'status':_0x3f1159(0x203),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x3f1159(0x281),'name':{'$first':_0x3f1159(0x281)}}}]);const _0x4017d8=await product['find']({}),_0x1a435d=BayBinSelected(_0xcf58d0[_0x3f1159(0x1ce)],_0xcf58d0[_0x3f1159(0x1f6)]);let _0x25ef78=new Date(_0xcf58d0['expiry_date']),_0x525403=('0'+_0x25ef78[_0x3f1159(0x238)]())[_0x3f1159(0x262)](-0x2),_0x16f43c=('0'+(_0x25ef78['getMonth']()+0x1))[_0x3f1159(0x262)](-0x2),_0x1cc048=_0x25ef78[_0x3f1159(0x1bd)](),_0x3df726=_0x1cc048+'-'+_0x16f43c+'-'+_0x525403;if(_0x2b9b94[0x0][_0x3f1159(0x250)]==_0x3f1159(0x296)){var _0x31588b=users['English'];console[_0x3f1159(0x27d)](_0x31588b);}else{if(_0x2b9b94[0x0][_0x3f1159(0x250)]==_0x3f1159(0x289))var _0x31588b=users[_0x3f1159(0x289)];else{if(_0x2b9b94[0x0][_0x3f1159(0x250)]=='German')var _0x31588b=users[_0x3f1159(0x285)];else{if(_0x2b9b94[0x0][_0x3f1159(0x250)]==_0x3f1159(0x27f))var _0x31588b=users[_0x3f1159(0x27f)];else{if(_0x2b9b94[0x0][_0x3f1159(0x250)]==_0x3f1159(0x28c))var _0x31588b=users['French'];else{if(_0x2b9b94[0x0][_0x3f1159(0x250)]=='Portuguese\x20(BR)')var _0x31588b=users[_0x3f1159(0x26c)];else{if(_0x2b9b94[0x0][_0x3f1159(0x250)]==_0x3f1159(0x227))var _0x31588b=users[_0x3f1159(0x227)];else{if(_0x2b9b94[0x0][_0x3f1159(0x250)]==_0x3f1159(0x274))var _0x31588b=users['Arabic'];}}}}}}}_0x3bed60[_0x3f1159(0x1ed)](_0x3f1159(0x25c),{'success':_0x4855d2[_0x3f1159(0x1b6)](_0x3f1159(0x21f)),'errors':_0x4855d2['flash'](_0x3f1159(0x248)),'role':_0x450015,'profile':_0x112495,'purchases':_0xcf58d0,'suppliers':_0x584b16,'warehouse':_0x486544,'product':_0x4017d8,'master_shop':_0x2b9b94,'language':_0x31588b,'ed_fullDate':_0x3df726,'dataSelected':_0x1a435d});}catch(_0x556662){console['log'](_0x556662);}}),router[a0_0xfb35e6(0x26b)](a0_0xfb35e6(0x286),auth,async(_0x16e119,_0x175837)=>{var _0x5d5800=a0_0xfb35e6;try{const {username:_0xf061b,email:_0x19b978,role:_0x2f56c5}=_0x16e119['user'],_0x968079=_0x16e119[_0x5d5800(0x1f3)],_0xcb0b89=await profile['findOne']({'email':_0x968079['email']}),_0x668326=await master_shop[_0x5d5800(0x291)](),_0x3b9074=_0x16e119[_0x5d5800(0x1d1)]['id'],_0x131fae=await purchases_finished[_0x5d5800(0x25b)](_0x3b9074),_0x370d0b=await suppliers[_0x5d5800(0x291)]({});let _0x5b450b;if(_0x968079[_0x5d5800(0x1c5)]==_0x5d5800(0x28d)){const _0x2a267c=await staff[_0x5d5800(0x237)]({'email':_0x968079[_0x5d5800(0x258)]});_0x5b450b=await warehouse['find']({'status':_0x5d5800(0x203),'name':_0x2a267c[_0x5d5800(0x2a3)],'warehouse_category':_0x5d5800(0x2a7)});}else _0x5b450b=await warehouse[_0x5d5800(0x264)]([{'$match':{'status':_0x5d5800(0x203),'warehouse_category':_0x5d5800(0x2a7)}},{'$group':{'_id':_0x5d5800(0x281),'name':{'$first':_0x5d5800(0x281)}}}]);const _0x18d07c=await product[_0x5d5800(0x291)]({}),_0x411db6=BayBinSelected(_0x131fae[_0x5d5800(0x1ce)],_0x131fae[_0x5d5800(0x1f6)]);let _0x45b021=new Date(_0x131fae[_0x5d5800(0x267)]),_0x5f59ca=('0'+_0x45b021[_0x5d5800(0x238)]())[_0x5d5800(0x262)](-0x2),_0x25e502=('0'+(_0x45b021[_0x5d5800(0x20e)]()+0x1))[_0x5d5800(0x262)](-0x2),_0x3a8fa0=_0x45b021[_0x5d5800(0x1bd)](),_0x4a4ae4=_0x3a8fa0+'-'+_0x25e502+'-'+_0x5f59ca;if(_0x668326[0x0][_0x5d5800(0x250)]==_0x5d5800(0x296)){var _0x1f2e63=users[_0x5d5800(0x210)];console[_0x5d5800(0x27d)](_0x1f2e63);}else{if(_0x668326[0x0][_0x5d5800(0x250)]==_0x5d5800(0x289))var _0x1f2e63=users[_0x5d5800(0x289)];else{if(_0x668326[0x0][_0x5d5800(0x250)]==_0x5d5800(0x285))var _0x1f2e63=users['German'];else{if(_0x668326[0x0][_0x5d5800(0x250)]==_0x5d5800(0x27f))var _0x1f2e63=users[_0x5d5800(0x27f)];else{if(_0x668326[0x0]['language']==_0x5d5800(0x28c))var _0x1f2e63=users[_0x5d5800(0x28c)];else{if(_0x668326[0x0][_0x5d5800(0x250)]=='Portuguese\x20(BR)')var _0x1f2e63=users['Portuguese'];else{if(_0x668326[0x0][_0x5d5800(0x250)]==_0x5d5800(0x227))var _0x1f2e63=users[_0x5d5800(0x227)];else{if(_0x668326[0x0][_0x5d5800(0x250)]==_0x5d5800(0x274))var _0x1f2e63=users[_0x5d5800(0x21b)];}}}}}}}_0x175837[_0x5d5800(0x1ed)]('edit_purchases_finished',{'success':_0x16e119[_0x5d5800(0x1b6)](_0x5d5800(0x21f)),'errors':_0x16e119[_0x5d5800(0x1b6)](_0x5d5800(0x248)),'role':_0x968079,'profile':_0xcb0b89,'purchases':_0x131fae,'suppliers':_0x370d0b,'warehouse':_0x5b450b,'product':_0x18d07c,'master_shop':_0x668326,'language':_0x1f2e63,'ed_fullDate':_0x4a4ae4,'dataSelected':_0x411db6});}catch(_0x2e6324){console['log'](_0x2e6324);}}),router[a0_0xfb35e6(0x1d2)]('/view/:id',auth,async(_0x213fb5,_0x1fdafa)=>{var _0x5ebf12=a0_0xfb35e6;try{const _0x255bef=_0x213fb5['params']['id'],_0x126e2f=await purchases_finished[_0x5ebf12(0x237)]({'_id':_0x213fb5[_0x5ebf12(0x1d1)]['id']}),_0x424203=await warehouse[_0x5ebf12(0x237)]({'name':_0x126e2f['warehouse_name'],'room':_0x126e2f[_0x5ebf12(0x1f6)]});_0x126e2f[_0x5ebf12(0x206)][_0x5ebf12(0x1d3)](_0x10a95b=>{var _0x4aa86e=_0x5ebf12;const _0x8b38d5=_0x424203[_0x4aa86e(0x27e)][_0x4aa86e(0x223)](_0x1a678b=>{var _0x578c93=_0x4aa86e;_0x1a678b['product_name']==_0x10a95b[_0x578c93(0x1f8)]&&_0x1a678b[_0x578c93(0x214)]==_0x10a95b[_0x578c93(0x214)]&&(_0x1a678b[_0x578c93(0x246)]=parseInt(_0x1a678b[_0x578c93(0x246)])-parseInt(_0x10a95b['quantity']));});}),await _0x424203[_0x5ebf12(0x217)]();const {invoice:_0x31d439,suppliers:_0x152f1a,date:_0x60b945,warehouse_name:_0x611202,prod_name:_0x20c7e2,prod_code:_0x5185da,prod_qty:_0x41f636,prod_unit:_0x1f1597,prod_secondunit:_0x46688e,prod_level:_0x43d538,prod_isle:_0x3a08b2,prod_pallet:_0x4aaff9,note:_0x1abac0,expiry_date:_0x24f729,batch_code:_0x5ea527,paid_amount:_0x433195,due_amount:_0x81f5a8,Room_name:_0x56b1c6,primary_code:_0x4476ed,secondary_code:_0x64fd2d,PO_number:_0x30da8d,JO_number:_0x11f4f2}=_0x213fb5[_0x5ebf12(0x1cd)];if(typeof _0x20c7e2==_0x5ebf12(0x280))var _0x28bd55=[_0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x2a1)]],_0x52f61e=[_0x213fb5['body'][_0x5ebf12(0x294)]],_0x2132c9=[_0x213fb5['body']['prod_qty']],_0x46bf79=[_0x213fb5['body'][_0x5ebf12(0x24a)]],_0x1b4ca9=[_0x213fb5['body'][_0x5ebf12(0x245)]],_0x2c2dba=[_0x213fb5[_0x5ebf12(0x1cd)]['prod_level']],_0x893dd=[_0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x21d)]],_0x55d006=[_0x213fb5['body'][_0x5ebf12(0x24c)]],_0x466bb6=[_0x213fb5[_0x5ebf12(0x1cd)]['MaxStocks_data']],_0x568986=[_0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x20d)]],_0x5bbddd=[_0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x267)]];else var _0x28bd55=[..._0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x2a1)]],_0x52f61e=[..._0x213fb5['body']['prod_code']],_0x2132c9=[..._0x213fb5[_0x5ebf12(0x1cd)]['prod_qty']],_0x46bf79=[..._0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x24a)]],_0x1b4ca9=[..._0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x245)]],_0x2c2dba=[..._0x213fb5['body'][_0x5ebf12(0x1c6)]],_0x893dd=[..._0x213fb5['body']['primary_code']],_0x55d006=[..._0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x24c)]],_0x466bb6=[..._0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x244)]],_0x568986=[..._0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x20d)]],_0x5bbddd=[..._0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x267)]];const _0x5265f7=_0x28bd55[_0x5ebf12(0x223)](_0x4b91b4=>{return _0x4b91b4={'product_name':_0x4b91b4};});_0x52f61e[_0x5ebf12(0x1d3)]((_0x17900f,_0x44df53)=>{var _0x1cbeca=_0x5ebf12;_0x5265f7[_0x44df53][_0x1cbeca(0x241)]=_0x17900f;}),_0x2132c9[_0x5ebf12(0x1d3)]((_0x18fba6,_0x499ad9)=>{var _0x2eabdf=_0x5ebf12;_0x5265f7[_0x499ad9][_0x2eabdf(0x1da)]=_0x18fba6;}),_0x46bf79['forEach']((_0x353fa2,_0x5f1c4b)=>{var _0x537f3f=_0x5ebf12;_0x5265f7[_0x5f1c4b][_0x537f3f(0x266)]=_0x353fa2;}),_0x1b4ca9[_0x5ebf12(0x1d3)]((_0x4a442c,_0x5e0165)=>{_0x5265f7[_0x5e0165]['secondary_unit']=_0x4a442c;}),_0x2c2dba[_0x5ebf12(0x1d3)]((_0x862735,_0x5c1732)=>{var _0x17a3db=_0x5ebf12;_0x5265f7[_0x5c1732][_0x17a3db(0x214)]=_0x862735;}),_0x893dd[_0x5ebf12(0x1d3)]((_0xae3b40,_0x559d26)=>{var _0xa0da3=_0x5ebf12;_0x5265f7[_0x559d26][_0xa0da3(0x21d)]=_0xae3b40;}),_0x55d006['forEach']((_0xcf471a,_0x4a041e)=>{var _0x511388=_0x5ebf12;_0x5265f7[_0x4a041e][_0x511388(0x24c)]=_0xcf471a;}),_0x466bb6[_0x5ebf12(0x1d3)]((_0x1b46b6,_0x538e3b)=>{var _0x12dfd2=_0x5ebf12;_0x5265f7[_0x538e3b][_0x12dfd2(0x1ff)]=_0x1b46b6;}),_0x568986[_0x5ebf12(0x1d3)]((_0xbc332b,_0x356869)=>{_0x5265f7[_0x356869]['batch_code']=_0xbc332b;}),_0x5bbddd[_0x5ebf12(0x1d3)]((_0x41d4ec,_0x1a77d6)=>{var _0x1ada53=_0x5ebf12;_0x5265f7[_0x1a77d6][_0x1ada53(0x267)]=_0x41d4ec;});const _0x457d85=_0x5265f7[_0x5ebf12(0x1bf)](_0x4fb6c9=>_0x4fb6c9[_0x5ebf12(0x1da)]!=='0'&&_0x4fb6c9[_0x5ebf12(0x1da)]!=='');_0x126e2f['invoice']=_0x31d439,_0x126e2f['suppliers']=_0x152f1a,_0x126e2f['date']=_0x60b945,_0x126e2f['warehouse_name']=_0x611202,_0x126e2f['product']=_0x457d85,_0x126e2f[_0x5ebf12(0x25a)]=_0x1abac0,_0x126e2f[_0x5ebf12(0x271)]=_0x433195,_0x126e2f[_0x5ebf12(0x2a5)]=_0x81f5a8,_0x126e2f[_0x5ebf12(0x1f6)]=_0x56b1c6,_0x126e2f['POnumber']=_0x30da8d,_0x126e2f[_0x5ebf12(0x22a)]=_0x11f4f2;const _0x2f42ab=await _0x126e2f[_0x5ebf12(0x217)](),_0x4d6c7a=await warehouse[_0x5ebf12(0x237)]({'name':_0x213fb5[_0x5ebf12(0x1cd)][_0x5ebf12(0x1ce)],'room':_0x213fb5[_0x5ebf12(0x1cd)]['Room_name']});_0x126e2f[_0x5ebf12(0x206)][_0x5ebf12(0x1d3)](_0x34a90d=>{var _0x46a708=_0x5ebf12,_0x2ad228=0x0;const _0x59253e=_0x4d6c7a[_0x46a708(0x27e)][_0x46a708(0x223)](_0x19d7fa=>{var _0x219676=_0x46a708;_0x19d7fa[_0x219676(0x1f8)]==_0x34a90d[_0x219676(0x1f8)]&&_0x19d7fa['bay']==_0x34a90d[_0x219676(0x214)]&&(_0x19d7fa[_0x219676(0x246)]=parseInt(_0x19d7fa[_0x219676(0x246)])+parseInt(_0x34a90d[_0x219676(0x1da)]),_0x2ad228++);});_0x2ad228=='0'&&(_0x4d6c7a[_0x46a708(0x27e)]=_0x4d6c7a[_0x46a708(0x27e)][_0x46a708(0x29a)]({'product_name':_0x34a90d[_0x46a708(0x1f8)],'product_stock':_0x34a90d[_0x46a708(0x1da)],'primary_code':_0x34a90d[_0x46a708(0x21d)],'secondary_code':_0x34a90d[_0x46a708(0x24c)],'product_code':_0x34a90d['product_code'],'bay':_0x34a90d[_0x46a708(0x214)],'maxProducts':_0x34a90d[_0x46a708(0x1ff)],'unit':_0x34a90d[_0x46a708(0x266)],'secondary_unit':_0x34a90d[_0x46a708(0x1c9)],'expiry_date':_0x34a90d['expiry_date']}));}),await _0x4d6c7a[_0x5ebf12(0x217)]();const _0x29aa4a=await s_payment_data[_0x5ebf12(0x237)]({'invoice':_0x213fb5['body']['invoice']});if(_0x29aa4a===null){}else console[_0x5ebf12(0x27d)](_0x5ebf12(0x201),_0x29aa4a,_0x213fb5[_0x5ebf12(0x1cd)]['invoice']),_0x29aa4a['suppliers']=_0x213fb5[_0x5ebf12(0x1cd)]['suppliers'],await _0x29aa4a[_0x5ebf12(0x217)]();_0x213fb5[_0x5ebf12(0x1b6)](_0x5ebf12(0x21f),_0x5ebf12(0x292)),_0x1fdafa[_0x5ebf12(0x272)]('/all_purchases_finished/view');}catch(_0xb28c78){console[_0x5ebf12(0x27d)](_0xb28c78);}}),router['post'](a0_0xfb35e6(0x1c2),auth,async(_0x311c21,_0x47a381)=>{var _0x51f39b=a0_0xfb35e6;try{const _0x3b2966=_0x311c21[_0x51f39b(0x1d1)]['id'],{invoice:_0x5e59a1,suppliers:_0x46d88a,payable:_0x38c084,due_amount:_0x4f3d91}=_0x311c21[_0x51f39b(0x1cd)],_0x270ccb=await purchases[_0x51f39b(0x25b)](_0x3b2966);var _0x108c72=_0x38c084-_0x4f3d91;_0x270ccb[_0x51f39b(0x271)]=parseFloat(_0x270ccb[_0x51f39b(0x271)])+parseFloat(_0x4f3d91),_0x270ccb[_0x51f39b(0x2a5)]=_0x108c72;const _0xb7c311=await _0x270ccb[_0x51f39b(0x217)]();console['log'](_0xb7c311);const _0x520260=await s_payment_data[_0x51f39b(0x237)]({'invoice':_0x5e59a1});_0x520260[_0x51f39b(0x1e3)]=_0x108c72,await _0x520260[_0x51f39b(0x217)]();let _0x2afafd=new Date(),_0x1cb33c=('0'+_0x2afafd['getDate']())[_0x51f39b(0x262)](-0x2),_0x3d4089=('0'+(_0x2afafd[_0x51f39b(0x20e)]()+0x1))[_0x51f39b(0x262)](-0x2),_0x462287=_0x2afafd['getFullYear'](),_0x3e63cb=_0x462287+'-'+_0x3d4089+'-'+_0x1cb33c;const _0x2e7836=new suppliers_payment({'invoice':_0x5e59a1,'date':_0x462287+'-'+_0x3d4089+'-'+_0x1cb33c,'suppliers':_0x46d88a,'reason':_0x51f39b(0x27a),'amount':_0x4f3d91}),_0x458f34=await _0x2e7836['save']();_0x311c21['flash']('success',_0x51f39b(0x287)),_0x47a381['redirect']('/all_purchases/view');}catch(_0x5d8027){console[_0x51f39b(0x27d)](_0x5d8027);}}),router['get'](a0_0xfb35e6(0x213),auth,async(_0x14e6c5,_0x479b18)=>{var _0x16a1be=a0_0xfb35e6;try{const {username:_0x324632,email:_0x57a8cf,role:_0x3fc581}=_0x14e6c5[_0x16a1be(0x1f3)],_0x32f4b0=_0x14e6c5[_0x16a1be(0x1f3)],_0x1a545b=await profile[_0x16a1be(0x237)]({'email':_0x32f4b0[_0x16a1be(0x258)]}),_0x53f4f2=await master_shop['find']();console[_0x16a1be(0x27d)]('master',_0x53f4f2);const _0x4933f7=_0x14e6c5[_0x16a1be(0x1d1)]['id'],_0x4195d0=await purchases[_0x16a1be(0x25b)](_0x4933f7);console['log'](_0x4195d0);const _0x3d89fd=await suppliers[_0x16a1be(0x237)]({'name':_0x4195d0[_0x16a1be(0x201)]});console[_0x16a1be(0x27d)](_0x3d89fd);if(_0x53f4f2[0x0][_0x16a1be(0x250)]=='English\x20(US)'){var _0x2514e3=users[_0x16a1be(0x210)];console[_0x16a1be(0x27d)](_0x2514e3);}else{if(_0x53f4f2[0x0][_0x16a1be(0x250)]==_0x16a1be(0x289))var _0x2514e3=users[_0x16a1be(0x289)];else{if(_0x53f4f2[0x0][_0x16a1be(0x250)]==_0x16a1be(0x285))var _0x2514e3=users[_0x16a1be(0x285)];else{if(_0x53f4f2[0x0][_0x16a1be(0x250)]==_0x16a1be(0x27f))var _0x2514e3=users[_0x16a1be(0x27f)];else{if(_0x53f4f2[0x0][_0x16a1be(0x250)]=='French')var _0x2514e3=users[_0x16a1be(0x28c)];else{if(_0x53f4f2[0x0][_0x16a1be(0x250)]=='Portuguese\x20(BR)')var _0x2514e3=users[_0x16a1be(0x26c)];else{if(_0x53f4f2[0x0][_0x16a1be(0x250)]==_0x16a1be(0x227))var _0x2514e3=users[_0x16a1be(0x227)];else{if(_0x53f4f2[0x0]['language']=='Arabic\x20(ae)')var _0x2514e3=users[_0x16a1be(0x21b)];}}}}}}}_0x479b18[_0x16a1be(0x1ed)](_0x16a1be(0x27c),{'success':_0x14e6c5[_0x16a1be(0x1b6)](_0x16a1be(0x21f)),'errors':_0x14e6c5['flash']('errors'),'role':_0x32f4b0,'profile':_0x1a545b,'master_shop':_0x53f4f2,'supplier':_0x3d89fd,'purchase':_0x4195d0,'language':_0x2514e3});}catch(_0x4b6af0){console[_0x16a1be(0x27d)](_0x4b6af0);}}),router['get']('/view/return_purchase/:id',auth,async(_0x526068,_0x185794)=>{var _0x3d4ac2=a0_0xfb35e6;try{const {username:_0x568b56,email:_0x473562,role:_0x5b25ff}=_0x526068['user'],_0x4df411=_0x526068['user'],_0xee4d8e=await profile[_0x3d4ac2(0x237)]({'email':_0x4df411['email']}),_0x18aeae=await master_shop[_0x3d4ac2(0x291)]();console[_0x3d4ac2(0x27d)](_0x3d4ac2(0x1fa),_0x18aeae);const _0x21815c=_0x526068['params']['id'];console[_0x3d4ac2(0x27d)](_0x21815c);const _0x948fee=await purchases_finished['findById'](_0x21815c);console[_0x3d4ac2(0x27d)](_0x3d4ac2(0x293),_0x948fee);const _0x16d98d=await product['find']({}),_0x3a7d96=await warehouse['aggregate']([{'$match':{'name':_0x948fee[_0x3d4ac2(0x1ce)],'room':_0x948fee[_0x3d4ac2(0x1f6)]}},{'$unwind':_0x3d4ac2(0x1f7)},{'$group':{'_id':_0x3d4ac2(0x1d6),'name':{'$first':_0x3d4ac2(0x1b0)},'product_stock':{'$first':_0x3d4ac2(0x24e)},'bay':{'$first':_0x3d4ac2(0x2a4)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3d4ac2(0x260)},'floorlevel':{'$first':_0x3d4ac2(0x2a2)},'primary_code':{'$first':_0x3d4ac2(0x265)},'secondary_code':{'$first':_0x3d4ac2(0x1ee)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);console[_0x3d4ac2(0x27d)](_0x3d4ac2(0x221),_0x3a7d96);let _0x46dd0f;if(_0x4df411[_0x3d4ac2(0x1c5)]==_0x3d4ac2(0x28d)){const _0x20d83c=await staff[_0x3d4ac2(0x237)]({'email':_0x4df411['email']});_0x46dd0f=await warehouse[_0x3d4ac2(0x291)]({'status':_0x3d4ac2(0x203),'name':_0x20d83c[_0x3d4ac2(0x2a3)],'warehouse_category':_0x3d4ac2(0x2a7),'name':'Return\x20Goods'});}else _0x46dd0f=await warehouse[_0x3d4ac2(0x264)]([{'$match':{'status':_0x3d4ac2(0x203),'warehouse_category':_0x3d4ac2(0x2a7),'name':_0x3d4ac2(0x22f)}},{'$group':{'_id':'$name','name':{'$first':_0x3d4ac2(0x281)}}}]);if(_0x18aeae[0x0][_0x3d4ac2(0x250)]=='English\x20(US)'){var _0x28b793=users['English'];console['log'](_0x28b793);}else{if(_0x18aeae[0x0]['language']==_0x3d4ac2(0x289))var _0x28b793=users[_0x3d4ac2(0x289)];else{if(_0x18aeae[0x0]['language']=='German')var _0x28b793=users[_0x3d4ac2(0x285)];else{if(_0x18aeae[0x0][_0x3d4ac2(0x250)]=='Spanish')var _0x28b793=users['Spanish'];else{if(_0x18aeae[0x0]['language']==_0x3d4ac2(0x28c))var _0x28b793=users[_0x3d4ac2(0x28c)];else{if(_0x18aeae[0x0][_0x3d4ac2(0x250)]=='Portuguese\x20(BR)')var _0x28b793=users[_0x3d4ac2(0x26c)];else{if(_0x18aeae[0x0]['language']==_0x3d4ac2(0x227))var _0x28b793=users[_0x3d4ac2(0x227)];else{if(_0x18aeae[0x0][_0x3d4ac2(0x250)]==_0x3d4ac2(0x274))var _0x28b793=users[_0x3d4ac2(0x21b)];}}}}}}}_0x185794[_0x3d4ac2(0x1ed)](_0x3d4ac2(0x269),{'success':_0x526068['flash'](_0x3d4ac2(0x21f)),'errors':_0x526068[_0x3d4ac2(0x1b6)](_0x3d4ac2(0x248)),'role':_0x4df411,'profile':_0xee4d8e,'user':_0x948fee,'stock':_0x3a7d96,'master_shop':_0x18aeae,'product':_0x16d98d,'language':_0x28b793,'warehouse':_0x46dd0f});}catch(_0x2a6e16){console['log'](_0x2a6e16);}}),router['post'](a0_0xfb35e6(0x25d),auth,async(_0x46c250,_0x404e65)=>{var _0x2861d7=a0_0xfb35e6;try{const {invoice:_0x30400d,date:_0x48bf8d,warehouse_name:_0x6a3dd,Room_name:_0x1b545a,product_name:_0x112306,purchase_quantity:_0x2f9122,stocks:_0x109d51,return_qty:_0x40630d,note:_0x13e7f1,level:_0x4c8626,isle:_0x554ba3,pallet:_0x501354,to_warehouse_name:_0x80ad7c,to_Room_name:_0x20c46f}=_0x46c250[_0x2861d7(0x1cd)],_0x51c38b=await purchases_finished[_0x2861d7(0x237)]({'_id':_0x46c250[_0x2861d7(0x1d1)]['id']}),_0x267752=await warehouse[_0x2861d7(0x237)]({'name':_0x6a3dd,'room':_0x1b545a,'warehouse_category':'Finished\x20Goods'});if(typeof _0x112306==_0x2861d7(0x280))var _0x456594=[_0x46c250['body'][_0x2861d7(0x1f8)]],_0x592e30=[_0x46c250[_0x2861d7(0x1cd)]['purchase_quantity']],_0x4b4580=[_0x46c250[_0x2861d7(0x1cd)][_0x2861d7(0x1c7)]],_0x3b9ad7=[_0x46c250[_0x2861d7(0x1cd)][_0x2861d7(0x212)]],_0x736b4e=[_0x46c250[_0x2861d7(0x1cd)][_0x2861d7(0x1dd)]],_0xc88662=[_0x46c250[_0x2861d7(0x1cd)]['product_code_hide']],_0x2019ca=[_0x46c250[_0x2861d7(0x1cd)]['primary_code_hide']],_0x44bb18=[_0x46c250[_0x2861d7(0x1cd)][_0x2861d7(0x1b1)]];else var _0x456594=[..._0x46c250['body']['product_name']],_0x592e30=[..._0x46c250[_0x2861d7(0x1cd)]['purchase_quantity']],_0x4b4580=[..._0x46c250['body']['stocks']],_0x3b9ad7=[..._0x46c250[_0x2861d7(0x1cd)][_0x2861d7(0x212)]],_0x736b4e=[..._0x46c250['body'][_0x2861d7(0x1dd)]],_0xc88662=[..._0x46c250[_0x2861d7(0x1cd)][_0x2861d7(0x228)]],_0x2019ca=[..._0x46c250['body']['primary_code_hide']],_0x44bb18=[..._0x46c250[_0x2861d7(0x1cd)]['secondary_code_hide']];const _0x1b7397=_0x456594[_0x2861d7(0x223)](_0x46fde5=>{return _0x46fde5={'product_name':_0x46fde5};});_0x592e30[_0x2861d7(0x1d3)]((_0x105038,_0x1750a6)=>{var _0x611c0d=_0x2861d7;_0x1b7397[_0x1750a6][_0x611c0d(0x277)]=_0x105038;}),_0x4b4580[_0x2861d7(0x1d3)]((_0x5d4c5c,_0x3389d8)=>{var _0x372523=_0x2861d7;_0x1b7397[_0x3389d8][_0x372523(0x1bb)]=_0x5d4c5c;}),_0x3b9ad7[_0x2861d7(0x1d3)]((_0x9174f9,_0x6397b8)=>{_0x1b7397[_0x6397b8]['return_qty']=_0x9174f9;}),_0x736b4e[_0x2861d7(0x1d3)]((_0x5dd4fc,_0x391f48)=>{var _0x112002=_0x2861d7;_0x1b7397[_0x391f48][_0x112002(0x214)]=_0x5dd4fc;}),_0xc88662[_0x2861d7(0x1d3)]((_0xcf3ae6,_0x4429d4)=>{_0x1b7397[_0x4429d4]['product_code']=_0xcf3ae6;}),_0x2019ca[_0x2861d7(0x1d3)]((_0x384ac5,_0x4a35fe)=>{_0x1b7397[_0x4a35fe]['primary_code']=_0x384ac5;}),_0x44bb18['forEach']((_0x296a63,_0xd7581)=>{_0x1b7397[_0xd7581]['secondary_code']=_0x296a63;}),_0x1b7397[_0x2861d7(0x1d3)](_0x56ae6b=>{var _0x6b2ecd=_0x2861d7;console['log'](_0x56ae6b);const _0x360d89=_0x267752[_0x6b2ecd(0x27e)]['map'](_0x4f02ea=>{var _0x42b72f=_0x6b2ecd;_0x4f02ea[_0x42b72f(0x1f8)]==_0x56ae6b[_0x42b72f(0x1f8)]&&_0x4f02ea['bay']==_0x56ae6b[_0x42b72f(0x214)]&&(console['log'](parseInt(_0x4f02ea[_0x42b72f(0x246)])+_0x42b72f(0x249)+parseInt(_0x56ae6b[_0x42b72f(0x212)])),_0x4f02ea[_0x42b72f(0x246)]=parseInt(_0x4f02ea[_0x42b72f(0x246)])-parseInt(_0x56ae6b[_0x42b72f(0x212)]));});}),await _0x267752[_0x2861d7(0x217)]();var _0x8ef453=0x0;_0x1b7397[_0x2861d7(0x1d3)](_0x2fe162=>{var _0x275d25=_0x2861d7;(parseInt(_0x2fe162[_0x275d25(0x277)])<parseInt(_0x2fe162[_0x275d25(0x212)])||parseInt(_0x2fe162[_0x275d25(0x1bb)])<parseInt(_0x2fe162['return_qty']))&&_0x8ef453++;});if(_0x8ef453!=0x0)return _0x46c250[_0x2861d7(0x1b6)](_0x2861d7(0x248),_0x2861d7(0x1ba)),_0x404e65[_0x2861d7(0x272)](_0x2861d7(0x20f));const _0x30b3ec=new purchases_return_finished({'invoice':_0x30400d,'suppliers':_0x46c250[_0x2861d7(0x1cd)][_0x2861d7(0x201)],'date':_0x48bf8d,'warehouse_name':_0x6a3dd,'return_product':_0x1b7397,'note':_0x13e7f1,'room':_0x1b545a,'to_warehouse_name':_0x80ad7c,'to_room':_0x20c46f}),_0x12e4f5=await _0x30b3ec[_0x2861d7(0x217)](),_0x4842d3=await purchases_return_finished[_0x2861d7(0x237)]({'invoice':_0x30400d}),_0x14c2d7=await warehouse[_0x2861d7(0x237)]({'name':_0x80ad7c,'room':_0x20c46f,'warehouse_category':_0x2861d7(0x2a7)});_0x4842d3[_0x2861d7(0x1f1)][_0x2861d7(0x1d3)](_0xfb61ab=>{var _0x5ec0d3=_0x2861d7,_0x4fa3d5=0x0;const _0x70d5ff=_0x14c2d7[_0x5ec0d3(0x27e)]['map'](_0x31d515=>{var _0x541440=_0x5ec0d3;console['log'](_0x31d515['product_name']+'=='+_0xfb61ab[_0x541440(0x1f8)]+'&&'+_0x31d515[_0x541440(0x214)]+'=='+_0xfb61ab[_0x541440(0x214)]),_0x31d515['product_name']==_0xfb61ab[_0x541440(0x1f8)]&&_0x31d515[_0x541440(0x214)]==_0xfb61ab[_0x541440(0x214)]&&(_0x31d515[_0x541440(0x246)]=parseInt(_0x31d515[_0x541440(0x246)])-parseInt(_0xfb61ab['return_qty']),_0x4fa3d5++);});_0x4fa3d5=='0'&&(_0x14c2d7[_0x5ec0d3(0x27e)]=_0x14c2d7[_0x5ec0d3(0x27e)][_0x5ec0d3(0x29a)]({'product_name':_0xfb61ab[_0x5ec0d3(0x1f8)],'product_stock':_0xfb61ab[_0x5ec0d3(0x212)],'primary_code':_0xfb61ab[_0x5ec0d3(0x21d)],'secondary_code':_0xfb61ab[_0x5ec0d3(0x24c)],'product_code':_0xfb61ab[_0x5ec0d3(0x241)],'bay':_0xfb61ab[_0x5ec0d3(0x214)],'maxProducts':0xf423f}));}),await _0x14c2d7[_0x2861d7(0x217)]();const _0x579ac2=await purchases_finished['findOne']({'invoice':_0x30400d});_0x579ac2['return_data']='True';const _0x2042d9=await _0x579ac2[_0x2861d7(0x217)](),_0x29d6ff=new s_payment_data({'invoice':_0x30400d,'suppliers':_0x46c250['body'][_0x2861d7(0x201)],'reason':_0x2861d7(0x218)});await _0x29d6ff[_0x2861d7(0x217)]();const _0x243287=await master_shop[_0x2861d7(0x291)](),_0x3b2c32=await email_settings['findOne'](),_0x44fc21=await suppliers['findOne']({'name':_0x46c250[_0x2861d7(0x1cd)]['suppliers']});_0x243287[0x0]['currency_placement']==0x1?(right_currency=_0x243287[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x243287[0x0][_0x2861d7(0x254)]);var _0x220049=_0x456594,_0x2da897=_0x3b9ad7,_0x52e1ac='',_0x39475e;for(_0x39475e in _0x220049){_0x52e1ac+=_0x2861d7(0x1b2)+_0x2861d7(0x295)+_0x220049[_0x39475e]+_0x2861d7(0x251)+_0x2861d7(0x295)+_0x2da897[_0x39475e]+_0x2861d7(0x251)+_0x2861d7(0x29f);}let _0x55aeee=nodemailer[_0x2861d7(0x1e5)]({'service':_0x2861d7(0x297),'auth':{'user':_0x3b2c32['email'],'pass':_0x3b2c32[_0x2861d7(0x22b)]}}),_0x37ad03={'from':_0x3b2c32[_0x2861d7(0x258)],'to':_0x44fc21[_0x2861d7(0x258)],'subject':_0x2861d7(0x1df),'attachments':[{'filename':_0x2861d7(0x299),'path':__dirname+_0x2861d7(0x204)+_0x2861d7(0x29b)+_0x243287[0x0][_0x2861d7(0x220)],'cid':_0x2861d7(0x200)}],'html':_0x2861d7(0x259)+_0x2861d7(0x28b)+_0x2861d7(0x1af)+_0x2861d7(0x28f)+_0x2861d7(0x1b4)+_0x2861d7(0x28f)+_0x2861d7(0x1ea)+_0x2861d7(0x26d)+'<div>'+_0x2861d7(0x1c8)+_0x243287[0x0][_0x2861d7(0x1e0)]+_0x2861d7(0x1ae)+_0x2861d7(0x26d)+_0x2861d7(0x26d)+_0x2861d7(0x1de)+'<div>'+_0x2861d7(0x1f2)+_0x2861d7(0x1c4)+_0x30400d+'\x20'+_0x2861d7(0x23e)+_0x2861d7(0x240)+_0x48bf8d+'\x20'+'</span>'+_0x2861d7(0x230)+'</div>'+_0x2861d7(0x1d4)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2861d7(0x1b2)+_0x2861d7(0x255)+_0x2861d7(0x22e)+_0x2861d7(0x1d7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x2861d7(0x29f)+_0x2861d7(0x28e)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x52e1ac+'\x20'+'</tbody>'+_0x2861d7(0x23b)+'<div>'+_0x2861d7(0x26e)+_0x2861d7(0x20c)+_0x243287[0x0]['site_title']+_0x2861d7(0x230)+_0x2861d7(0x26d)+_0x2861d7(0x26d)+'</body></html>'};_0x55aeee[_0x2861d7(0x1b5)](_0x37ad03,function(_0x4d1a57,_0x39f0a2){var _0xc548dd=_0x2861d7;_0x4d1a57?console[_0xc548dd(0x27d)](_0xc548dd(0x29c)):console['log'](_0xc548dd(0x298));}),_0x46c250[_0x2861d7(0x1b6)](_0x2861d7(0x21f),_0x2861d7(0x1cb)),_0x404e65[_0x2861d7(0x272)](_0x2861d7(0x1e9));}catch(_0x10db17){_0x404e65['status'](0xc8)[_0x2861d7(0x270)]({'message':_0x10db17[_0x2861d7(0x1be)]});}}),router[a0_0xfb35e6(0x26b)]('/barcode/:id',auth,async(_0x334ce4,_0x1bc804)=>{var _0x168929=a0_0xfb35e6;try{const {username:_0x5784d2,email:_0x196de4,role:_0x49a660}=_0x334ce4[_0x168929(0x1f3)],_0x2690b5=_0x334ce4[_0x168929(0x1f3)],_0x2acc48=await profile[_0x168929(0x237)]({'email':_0x2690b5[_0x168929(0x258)]}),_0x1a3942=await master_shop[_0x168929(0x291)](),_0x70cc1c=_0x334ce4[_0x168929(0x1d1)]['id'],_0x2b80d2=await purchases_finished[_0x168929(0x25b)](_0x70cc1c);if(_0x1a3942[0x0]['language']==_0x168929(0x296))var _0x372f60=users['English'];else{if(_0x1a3942[0x0]['language']==_0x168929(0x289))var _0x372f60=users['Hindi'];else{if(_0x1a3942[0x0][_0x168929(0x250)]==_0x168929(0x285))var _0x372f60=users[_0x168929(0x285)];else{if(_0x1a3942[0x0][_0x168929(0x250)]==_0x168929(0x27f))var _0x372f60=users[_0x168929(0x27f)];else{if(_0x1a3942[0x0]['language']==_0x168929(0x28c))var _0x372f60=users[_0x168929(0x28c)];else{if(_0x1a3942[0x0][_0x168929(0x250)]=='Portuguese\x20(BR)')var _0x372f60=users[_0x168929(0x26c)];else{if(_0x1a3942[0x0][_0x168929(0x250)]==_0x168929(0x227))var _0x372f60=users[_0x168929(0x227)];else{if(_0x1a3942[0x0][_0x168929(0x250)]==_0x168929(0x274))var _0x372f60=users[_0x168929(0x21b)];}}}}}}}_0x1bc804[_0x168929(0x1ed)](_0x168929(0x216),{'success':_0x334ce4['flash'](_0x168929(0x21f)),'errors':_0x334ce4[_0x168929(0x1b6)](_0x168929(0x248)),'role':_0x2690b5,'profile':_0x2acc48,'alldata':_0x2b80d2,'master_shop':_0x1a3942,'language':_0x372f60}),console[_0x168929(0x27d)](alldata);}catch(_0x113090){console['log'](_0x113090);}}),router[a0_0xfb35e6(0x1d2)]('/barcode_scanner',async(_0x249196,_0x2617e5)=>{var _0x16e575=a0_0xfb35e6;const {product_code:_0x406906}=_0x249196[_0x16e575(0x1cd)];var _0xd91e09;const _0x4073ad=await product[_0x16e575(0x264)]([{'$match':{'primary_code':_0x406906,'product_category':_0x16e575(0x2a7)}},{'$group':{'_id':_0x16e575(0x222),'name':{'$first':_0x16e575(0x281)},'category':{'$first':_0x16e575(0x211)},'brand':{'$first':_0x16e575(0x23d)},'unit':{'$first':_0x16e575(0x256)},'alertquantity':{'$first':_0x16e575(0x226)},'product_code':{'$first':_0x16e575(0x1e7)},'primary_code':{'$first':_0x16e575(0x290)},'secondary_code':{'$first':_0x16e575(0x25f)},'maxStocks':{'$first':_0x16e575(0x24b)},'maxProdPerUnit':{'$first':_0x16e575(0x1f4)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x16e575(0x239)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x264134=await product['aggregate']([{'$match':{'secondary_code':_0x406906}},{'$group':{'_id':_0x16e575(0x222),'name':{'$first':_0x16e575(0x281)},'category':{'$first':_0x16e575(0x211)},'brand':{'$first':_0x16e575(0x23d)},'unit':{'$first':_0x16e575(0x256)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x16e575(0x290)},'secondary_code':{'$first':_0x16e575(0x25f)},'maxStocks':{'$first':_0x16e575(0x24b)},'maxProdPerUnit':{'$first':_0x16e575(0x1f4)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x16e575(0x239)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x4073ad['length']>0x0)_0xd91e09=_0x4073ad;else _0x264134[_0x16e575(0x21a)]>0x0&&(_0xd91e09=_0x264134);_0x2617e5[_0x16e575(0x270)](_0xd91e09);}),router['post'](a0_0xfb35e6(0x278),async(_0x4b9ff3,_0x38cd50)=>{var _0x41e7a5=a0_0xfb35e6;const {productCode:_0x354900,bay:_0x1adbe3,warehouses:_0x280550,room:_0x488d81}=_0x4b9ff3[_0x41e7a5(0x1cd)];console[_0x41e7a5(0x27d)](_0x4b9ff3[_0x41e7a5(0x1cd)]);try{const _0xebe8b2=await warehouse['aggregate']([{'$match':{'name':_0x280550,'room':_0x488d81}},{'$unwind':_0x41e7a5(0x1f7)},{'$match':{'product_details.bay':parseInt(_0x1adbe3)}},{'$group':{'_id':_0x41e7a5(0x1d6),'name':{'$first':_0x41e7a5(0x1b0)},'product_stock':{'$first':_0x41e7a5(0x24e)},'bay':{'$first':_0x41e7a5(0x2a4)},'maxProducts':{'$first':_0x41e7a5(0x1f0)}}}]);_0x38cd50[_0x41e7a5(0x261)](0xc8)[_0x41e7a5(0x270)](_0xebe8b2);}catch(_0x19d9a6){_0x38cd50[_0x41e7a5(0x261)](0x194)[_0x41e7a5(0x270)]({'message':_0x19d9a6[_0x41e7a5(0x1be)]});}}),module[a0_0xfb35e6(0x22c)]=router;