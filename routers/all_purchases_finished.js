var a0_0x3976f0=a0_0x29a4;(function(_0x4a1ad0,_0xf7c9de){var _0x322d51=a0_0x29a4,_0xb584f0=_0x4a1ad0();while(!![]){try{var _0x4e1d74=-parseInt(_0x322d51(0x252))/0x1*(-parseInt(_0x322d51(0x22c))/0x2)+-parseInt(_0x322d51(0x22b))/0x3+parseInt(_0x322d51(0x251))/0x4*(parseInt(_0x322d51(0x279))/0x5)+parseInt(_0x322d51(0x23f))/0x6+parseInt(_0x322d51(0x292))/0x7*(-parseInt(_0x322d51(0x273))/0x8)+parseInt(_0x322d51(0x29b))/0x9+parseInt(_0x322d51(0x1ef))/0xa*(-parseInt(_0x322d51(0x2a5))/0xb);if(_0x4e1d74===_0xf7c9de)break;else _0xb584f0['push'](_0xb584f0['shift']());}catch(_0x5bb036){_0xb584f0['push'](_0xb584f0['shift']());}}}(a0_0x4d98,0x8b903));function a0_0x4d98(){var _0xf445f9=['log','Paid\x20For\x20Purchase','DRY\x20GOODS','$_id','English','all_purchases_barcode','/view/add_purchases','../models/all_models','host','$due_amount','product_code','POnumber','$product_details.secondary_code','$warehouse_name','$product_details.product_code','secondary_code','json','$product_details._id','currency','forEach','$product_details.primary_code','currency_placement','$secondary_unit','add_purchases\x20error','purchases\x20item\x20return\x20successfull','$product.bin','$room','/view/add_purchases/:id','$maxStocks','return_qty','filter','$note','2560700cFnYJk','all_purchases_finished','body','concat','suppliers','/all_purchases_finished/view','status','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','length','createTransport','stock_quantity','../middleware/auth','</body></html>','Arabic','prod_level','prod_invoice','</div>','success','/preview/:id','Portuguese\x20(BR)','edit_purchases_finished','Purchase\x20Return','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/invoice/:id','$unit','edit_purchases_finished_view','$product','/give_payment/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','standard_unit','Purchase\x20Mail','<h5\x20style=\x22text-align:\x20left;\x22>','staff','exports','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','RoomAssign','\x20</h2>','purchase_invoice','ejs','padStart','$product_details','errors','map','prod_qty','return_purchase_finished','table\x20page','master','$date','</tr>','site_title','Room_name','_id','params','product_code_hide','$return_data','186855cqmjnb','2qGrypM','<!DOCTYPE\x20html>','get','aggregate','Email\x20sent\x20successfully','<hr\x20class=\x22my-3\x22>','back','Hindi','render','user_id','/view','/all_purchases/view','<div>','catch','$paid_amount','$suppliers_docs','$product_details.floorlevel','batch_code','</td>','4563630oMzgHC','</h5>','all','<strong>\x20Regards\x20</strong>','then','production_date','prod_secondunit','<h2>\x20','prod_name','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','QA\x20Warehouse','$name','MaxStocks_data','$product_details.product_name','$batch_code','An\x20error\x20occurred\x20while\x20saving\x20data.','$product.bay','1350676ZvWxHc','52445WjFObT','amount','$brand','product_cat','/CheckingWarehouse','English\x20(US)','</span>','purchase_quantity','date_data','product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','message','Return\x20Goods','primary_code','Logo.png','language','findOne','warehouse','$alertquantity','$maxProdPerUnit','Arabic\x20(ae)','INCF-','updateOne','slice','$product_details.product_stock','<html><head><title></title>','secondary_unit','user','paid_amount','</table>','Chinese','Enabled','Enclosed','16MakuZM','role','findById','error','Finished\x20Goods','product_details','15YCKFfS','floor','Portuguese','gmail','\x20Order\x20Date\x20:\x20','Error\x20Occurs','Spanish','invoice','$invoice','\x20Order\x20Number\x20:\x20','$product_details.type','save','prod_code','<tr>','secondary_code_hide','JO_number','room','/barcode_scanner','Rack\x202','max_product_unit','$product_details.storage','email','$product_code','nodemailer','/view/:id','2032142czLzkD','date','bay','stocks','<span\x20style=\x22float:\x20right;\x22>','$product.quantity','image','$product.type','path','1410309oloSCm','warehouse_name','$product.floorlevel','product','due_amount','<tbody\x20style=\x22text-align:\x20center;\x22>','post','password','<table\x20style=\x22width:\x20100%\x20!important;\x22>','logo','33eabmeJ','prod_unit','string','/view/return_purchase/:id','maxStocks','Ambient','$expiry_date','$product_details.bay','redirect','flash','maxperunit','port','expiry_date','toString','$product.room_name','FROZEN\x20GOODS','$category','prod_primunit','</tbody>','abs','$suppliers','getFullYear','room_name','product_date','/../public','find','name','Router','prod_Qty','return_data','$product_details.bin','getMonth','sendMail','quantity','product_stock','express','German','</head><body>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','French','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'];a0_0x4d98=function(){return _0xf445f9;};return a0_0x4d98();}const express=require(a0_0x3976f0(0x1c9)),app=express(),router=express[a0_0x3976f0(0x1c1)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x3976f0(0x1d6)),auth=require(a0_0x3976f0(0x1fa)),nodemailer=require(a0_0x3976f0(0x290));var ejs=require(a0_0x3976f0(0x21a));const path=require(a0_0x3976f0(0x29a)),users=require('../public/language/languages.json');router[a0_0x3976f0(0x22e)](a0_0x3976f0(0x236),auth,async(_0x29cfd9,_0x310f60)=>{var _0xfefaa4=a0_0x3976f0;try{const {username:_0x5b439f,email:_0x31e76b,role:_0x90ced2}=_0x29cfd9['user'],_0x11ebf7=_0x29cfd9['user'],_0x205cc6=await profile[_0xfefaa4(0x262)]({'email':_0x11ebf7['email']}),_0x202f2f=await staff[_0xfefaa4(0x262)]({'email':_0x11ebf7[_0xfefaa4(0x28e)]});if(_0x11ebf7['role']==_0xfefaa4(0x211)){const _0xcbf3c5=await staff[_0xfefaa4(0x262)]({'email':_0x11ebf7[_0xfefaa4(0x28e)]});}const _0x34aff5=await master_shop[_0xfefaa4(0x1bf)]();let _0x35d51d;if(_0x11ebf7[_0xfefaa4(0x274)]=='staff'){const _0x481ec8=await staff['findOne']({'email':_0x11ebf7['email']});_0x35d51d=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x481ec8[_0xfefaa4(0x263)]}},{'$lookup':{'from':_0xfefaa4(0x1f3),'localField':_0xfefaa4(0x1f3),'foreignField':_0xfefaa4(0x1c0),'as':'suppliers_docs'}},{'$unwind':_0xfefaa4(0x23b)},{'$unwind':_0xfefaa4(0x209)},{'$group':{'_id':_0xfefaa4(0x1d2),'invoice':{'$first':_0xfefaa4(0x281)},'suppliers':{'$first':_0xfefaa4(0x1ba)},'date':{'$first':_0xfefaa4(0x223)},'warehouse_name':{'$first':_0xfefaa4(0x1dc)},'room':{'$first':_0xfefaa4(0x1e9)},'product':{'$push':_0xfefaa4(0x209)},'note':{'$first':'$note'},'paid_amount':{'$first':_0xfefaa4(0x23a)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0xfefaa4(0x22a)},'batch_code':{'$first':_0xfefaa4(0x24e)},'expiry_date':{'$first':_0xfefaa4(0x1ac)},'suppliers_docs':{'$first':_0xfefaa4(0x23b)},'total_product_quantity':{'$sum':_0xfefaa4(0x297)},'level':{'$addToSet':_0xfefaa4(0x250)},'isle':{'$addToSet':_0xfefaa4(0x1e8)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0xfefaa4(0x29d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x35d51d=await purchases_finished['aggregate']([{'$unwind':_0xfefaa4(0x209)},{'$group':{'_id':_0xfefaa4(0x1d2),'invoice':{'$first':_0xfefaa4(0x281)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0xfefaa4(0x223)},'warehouse_name':{'$first':_0xfefaa4(0x1dc)},'room':{'$addToSet':_0xfefaa4(0x1b4)},'product':{'$push':'$product'},'note':{'$first':_0xfefaa4(0x1ee)},'paid_amount':{'$first':_0xfefaa4(0x23a)},'due_amount':{'$first':_0xfefaa4(0x1d8)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0xfefaa4(0x1ac)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0xfefaa4(0x297)},'level':{'$addToSet':_0xfefaa4(0x250)},'isle':{'$addToSet':_0xfefaa4(0x1e8)},'type':{'$addToSet':_0xfefaa4(0x299)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x34aff5[0x0][_0xfefaa4(0x261)]=='English\x20(US)')var _0x21c3ca=users['English'];else{if(_0x34aff5[0x0][_0xfefaa4(0x261)]==_0xfefaa4(0x233))var _0x21c3ca=users[_0xfefaa4(0x233)];else{if(_0x34aff5[0x0]['language']==_0xfefaa4(0x1ca))var _0x21c3ca=users['German'];else{if(_0x34aff5[0x0][_0xfefaa4(0x261)]==_0xfefaa4(0x27f))var _0x21c3ca=users[_0xfefaa4(0x27f)];else{if(_0x34aff5[0x0][_0xfefaa4(0x261)]==_0xfefaa4(0x1cd))var _0x21c3ca=users[_0xfefaa4(0x1cd)];else{if(_0x34aff5[0x0][_0xfefaa4(0x261)]==_0xfefaa4(0x202))var _0x21c3ca=users['Portuguese'];else{if(_0x34aff5[0x0][_0xfefaa4(0x261)]==_0xfefaa4(0x270))var _0x21c3ca=users[_0xfefaa4(0x270)];else{if(_0x34aff5[0x0][_0xfefaa4(0x261)]==_0xfefaa4(0x266))var _0x21c3ca=users[_0xfefaa4(0x1fc)];}}}}}}}_0x310f60[_0xfefaa4(0x234)](_0xfefaa4(0x1f0),{'success':_0x29cfd9['flash'](_0xfefaa4(0x200)),'errors':_0x29cfd9[_0xfefaa4(0x1af)](_0xfefaa4(0x21d)),'purchases':_0x35d51d,'role':_0x11ebf7,'profile':_0x205cc6,'master_shop':_0x34aff5,'language':_0x21c3ca});}catch(_0x3a3e52){console[_0xfefaa4(0x1cf)](_0xfefaa4(0x221),_0x3a3e52),_0x310f60[_0xfefaa4(0x1f5)](0xc8)[_0xfefaa4(0x1df)]({'message':_0x3a3e52['message']});}});function BayBinSelected(_0x573fad,_0x4b2496){var _0x4fc2da=a0_0x3976f0,_0x5c367f=[],_0x402689=[];if(_0x573fad==_0x4fc2da(0x1d1)){switch(_0x4b2496){case'Rack\x201':_0x5c367f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x5c367f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x402689=['DG'];}else{if(_0x573fad==_0x4fc2da(0x1b5)){switch(_0x4b2496){case'Rack\x201':_0x5c367f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4fc2da(0x28b):_0x5c367f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x402689=['FG'];}}return{'levels':_0x5c367f,'identify':_0x402689};}function a0_0x29a4(_0x574d25,_0xb8e1d2){var _0x4d98aa=a0_0x4d98();return a0_0x29a4=function(_0x29a415,_0x3f5e0b){_0x29a415=_0x29a415-0x1a7;var _0x57cd4=_0x4d98aa[_0x29a415];return _0x57cd4;},a0_0x29a4(_0x574d25,_0xb8e1d2);}async function getRandom8DigitNumber(){var _0x441b23=a0_0x3976f0;const _0x9c46c1=0x989680,_0x1126f8=0x5f5e0ff,_0x19429f=Math[_0x441b23(0x27a)](Math['random']()*(_0x1126f8-_0x9c46c1+0x1))+_0x9c46c1;var _0x7c6777;const _0x4d87f7=await purchases_finished[_0x441b23(0x262)]({'invoice':'INCF-'+_0x19429f});return _0x4d87f7&&_0x4d87f7[_0x441b23(0x1f7)]>0x0?_0x7c6777=_0x441b23(0x267)+_0x19429f:_0x7c6777=_0x441b23(0x267)+_0x19429f,_0x7c6777;}router[a0_0x3976f0(0x22e)](a0_0x3976f0(0x1d5),auth,async(_0x7f77c2,_0x5079b8)=>{var _0x33f305=a0_0x3976f0;try{const {username:_0x25cad1,email:_0x2f60e0,role:_0x34f199}=_0x7f77c2[_0x33f305(0x26d)],_0x151882=_0x7f77c2['user'],_0x13f821=await profile['findOne']({'email':_0x151882[_0x33f305(0x28e)]}),_0x35e715=await master_shop[_0x33f305(0x1bf)](),_0x40976b=await staff['findOne']({'email':_0x151882[_0x33f305(0x28e)]}),_0x442c97=await suppliers[_0x33f305(0x1bf)]({});let _0x8b46e9;if(_0x151882[_0x33f305(0x274)]==_0x33f305(0x211)){const _0x25a5b2=await staff[_0x33f305(0x262)]({'email':_0x151882['email']});_0x8b46e9=await warehouse[_0x33f305(0x22f)]([{'$match':{'status':'Enabled','name':_0x25a5b2[_0x33f305(0x263)],'warehouse_category':_0x33f305(0x277)}},{'$group':{'_id':_0x33f305(0x24b),'name':{'$first':_0x33f305(0x24b)}}}]);}else _0x8b46e9=await warehouse[_0x33f305(0x22f)]([{'$match':{'status':_0x33f305(0x271),'warehouse_category':_0x33f305(0x277),'name':{'$ne':_0x33f305(0x24a)}}},{'$group':{'_id':'$name','name':{'$first':_0x33f305(0x24b)}}}]);const _0x3899eb=await product[_0x33f305(0x1bf)]({}),_0x1d9a92=await warehouse[_0x33f305(0x1bf)]({'status':_0x33f305(0x271)}),_0x30c7c2=await purchases_finished['find']({}),_0x552562=_0x30c7c2[_0x33f305(0x1f7)]+0x1,_0x5b3186='INCF-'+_0x552562[_0x33f305(0x1b3)]()[_0x33f305(0x21b)](0x5,'0');var _0x2cecea=[_0x33f305(0x1ab),_0x33f305(0x272)];if(_0x35e715[0x0][_0x33f305(0x261)]=='English\x20(US)')var _0x3d934d=users[_0x33f305(0x1d3)];else{if(_0x35e715[0x0][_0x33f305(0x261)]==_0x33f305(0x233))var _0x3d934d=users[_0x33f305(0x233)];else{if(_0x35e715[0x0][_0x33f305(0x261)]=='German')var _0x3d934d=users[_0x33f305(0x1ca)];else{if(_0x35e715[0x0][_0x33f305(0x261)]==_0x33f305(0x27f))var _0x3d934d=users[_0x33f305(0x27f)];else{if(_0x35e715[0x0][_0x33f305(0x261)]==_0x33f305(0x1cd))var _0x3d934d=users['French'];else{if(_0x35e715[0x0][_0x33f305(0x261)]=='Portuguese\x20(BR)')var _0x3d934d=users[_0x33f305(0x27b)];else{if(_0x35e715[0x0][_0x33f305(0x261)]==_0x33f305(0x270))var _0x3d934d=users[_0x33f305(0x270)];else{if(_0x35e715[0x0]['language']=='Arabic\x20(ae)')var _0x3d934d=users[_0x33f305(0x1fc)];}}}}}}}const _0x2c4869=getRandom8DigitNumber();_0x2c4869['then'](_0x4011aa=>{var _0x54dceb=_0x33f305;_0x5079b8['render']('add_purchases_finished',{'success':_0x7f77c2['flash'](_0x54dceb(0x200)),'errors':_0x7f77c2[_0x54dceb(0x1af)](_0x54dceb(0x21d)),'role':_0x151882,'profile':_0x13f821,'suppliers':_0x442c97,'warehouse':_0x8b46e9,'product':_0x3899eb,'invoice':_0x4011aa,'master_shop':_0x35e715,'language':_0x3d934d,'find_data':_0x1d9a92,'rooms_data':_0x2cecea});})[_0x33f305(0x239)](_0xe08814=>{var _0x48d21e=_0x33f305;_0x7f77c2['flash'](_0x48d21e(0x21d),_0x48d21e(0x213)),_0x5079b8['redirect'](_0x48d21e(0x1f4));});}catch(_0x3ba6cb){console[_0x33f305(0x1cf)](_0x3ba6cb);}}),router[a0_0x3976f0(0x22e)](a0_0x3976f0(0x1ea),auth,async(_0x4fc754,_0x47e54e)=>{var _0x1bcfb0=a0_0x3976f0;try{const _0x23571b=_0x4fc754[_0x1bcfb0(0x228)]['id'];console['log'](_0x23571b);const _0x4418a3=await master_shop[_0x1bcfb0(0x1bf)]();console['log'](_0x1bcfb0(0x222),_0x4418a3);const _0x48ae76=await product[_0x1bcfb0(0x262)]({'name':_0x23571b});console[_0x1bcfb0(0x1cf)](_0x1bcfb0(0x29e),_0x48ae76),_0x47e54e[_0x1bcfb0(0x1f5)](0xc8)[_0x1bcfb0(0x1df)]({'product_data':_0x48ae76,'master':_0x4418a3});}catch(_0x5d1223){console['log'](_0x1bcfb0(0x1e6),_0x5d1223);}}),router[a0_0x3976f0(0x2a1)]('/view/add_purchases',auth,async(_0x521671,_0x49cb35)=>{var _0x1fcf3f=a0_0x3976f0;try{const {invoice:_0x40842c,date:_0x3d76f9,warehouse_name:_0x239b50,prod_name:_0x15f60f,prod_code:_0x145d02,prod_qty:_0x336586,prod_unit:_0x638115,prod_secondunit:_0x32fc0e,prod_level:_0x18beb4,prod_isle:_0x30260c,prod_pallet:_0x29e7f1,note:_0x3f3b96,expiry_date:_0x118d65,batch_code:_0x309aac,payable:_0x50d641,due_amount:_0xc549e6,Room_name:_0x54a031,primary_code:_0x166dc3,secondary_code:_0x16798e,MaxStocks_data:_0x475da6,PO_number:_0x8e9de3,SCRN:_0xdac87c,JO_number:_0x513c18}=_0x521671['body'];if(typeof _0x15f60f==_0x1fcf3f(0x1a8))var _0x41e896=[_0x521671['body'][_0x1fcf3f(0x247)]],_0x426429=[_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x285)]],_0x388bd5=[_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1c2)]],_0x4828a1=[_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1b7)]],_0x3f85d7=[_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x245)]],_0x5725c6=[_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1fd)]],_0x4af949=[_0x521671['body'][_0x1fcf3f(0x25f)]],_0x1c92e0=[_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1de)]],_0x131d6d=[_0x521671['body'][_0x1fcf3f(0x24c)]],_0x1e025b=[_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x23d)]],_0x13153b=[_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1b2)]],_0x36af7c=[_0x521671['body'][_0x1fcf3f(0x1bd)]],_0xd5f8d6=[_0x521671[_0x1fcf3f(0x1f1)]['max_product_unit']],_0x47451a=[_0x521671[_0x1fcf3f(0x1f1)]['prod_cat']],_0x5e1d1e=[_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x217)]],_0x52fc36=[_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1fe)]];else var _0x41e896=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x247)]],_0x426429=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x285)]],_0x388bd5=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1c2)]],_0x4828a1=[..._0x521671['body'][_0x1fcf3f(0x1b7)]],_0x3f85d7=[..._0x521671['body'][_0x1fcf3f(0x245)]],_0x5725c6=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1fd)]],_0x4af949=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x25f)]],_0x1c92e0=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1de)]],_0x131d6d=[..._0x521671[_0x1fcf3f(0x1f1)]['MaxStocks_data']],_0x1e025b=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x23d)]],_0x13153b=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1b2)]],_0x36af7c=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1bd)]],_0xd5f8d6=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x28c)]],_0x47451a=[..._0x521671[_0x1fcf3f(0x1f1)]['prod_cat']],_0x5e1d1e=[..._0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x217)]],_0x52fc36=[..._0x521671[_0x1fcf3f(0x1f1)]['prod_invoice']];const _0x190d64=_0x41e896[_0x1fcf3f(0x21e)](_0xf93cda=>{return _0xf93cda={'product_name':_0xf93cda};});_0x426429['forEach']((_0x96dc9d,_0x5f8b43)=>{var _0x32d5c9=_0x1fcf3f;_0x190d64[_0x5f8b43][_0x32d5c9(0x1d9)]=_0x96dc9d,_0x190d64[_0x5f8b43]['date_data']=_0x3d76f9;}),_0x388bd5['forEach']((_0x58ce0b,_0x3df8b5)=>{var _0x3a49be=_0x1fcf3f;_0x190d64[_0x3df8b5]['quantity']=Math[_0x3a49be(0x1b9)](_0x58ce0b);}),_0x4828a1[_0x1fcf3f(0x1e2)]((_0x368d66,_0x3e338b)=>{var _0x489b5a=_0x1fcf3f;_0x190d64[_0x3e338b][_0x489b5a(0x20e)]=_0x368d66;}),_0x3f85d7[_0x1fcf3f(0x1e2)]((_0x271d53,_0x599b65)=>{var _0x122646=_0x1fcf3f;_0x190d64[_0x599b65][_0x122646(0x26c)]=_0x271d53;}),_0x5725c6[_0x1fcf3f(0x1e2)]((_0xf36af1,_0x10f80)=>{var _0x1d6547=_0x1fcf3f;_0x190d64[_0x10f80][_0x1d6547(0x294)]=_0xf36af1;}),_0x4af949['forEach']((_0x2aa15a,_0x1fdb3f)=>{var _0x535020=_0x1fcf3f;_0x190d64[_0x1fdb3f][_0x535020(0x25f)]=_0x2aa15a;}),_0x1c92e0[_0x1fcf3f(0x1e2)]((_0x286379,_0xeda9cc)=>{_0x190d64[_0xeda9cc]['secondary_code']=_0x286379;}),_0x131d6d[_0x1fcf3f(0x1e2)]((_0x4ce0dd,_0x4576b0)=>{var _0x3ca405=_0x1fcf3f;_0x190d64[_0x4576b0][_0x3ca405(0x1aa)]=_0x4ce0dd;}),_0x1e025b[_0x1fcf3f(0x1e2)]((_0x30f446,_0xec4ae1)=>{var _0x4b3672=_0x1fcf3f;_0x190d64[_0xec4ae1][_0x4b3672(0x23d)]=_0x30f446;}),_0x13153b['forEach']((_0xa06525,_0x970f08)=>{var _0x106079=_0x1fcf3f;_0x190d64[_0x970f08][_0x106079(0x1b2)]=_0xa06525;}),_0x36af7c[_0x1fcf3f(0x1e2)]((_0x5a775e,_0x3e1079)=>{_0x190d64[_0x3e1079]['production_date']=_0x5a775e;}),_0xd5f8d6[_0x1fcf3f(0x1e2)]((_0x4bbfad,_0x2f64be)=>{var _0x12b0a4=_0x1fcf3f;_0x190d64[_0x2f64be][_0x12b0a4(0x1b0)]=_0x4bbfad;}),_0x47451a[_0x1fcf3f(0x1e2)]((_0x38da7,_0x7f5470)=>{var _0x2366e0=_0x1fcf3f;_0x190d64[_0x7f5470][_0x2366e0(0x255)]=_0x38da7;}),_0x5e1d1e[_0x1fcf3f(0x1e2)]((_0x4af7b0,_0x495aa4)=>{var _0x58f7c8=_0x1fcf3f;_0x190d64[_0x495aa4][_0x58f7c8(0x1bc)]=_0x4af7b0;}),_0x52fc36[_0x1fcf3f(0x1e2)]((_0x191b27,_0x4011af)=>{var _0x5d59f2=_0x1fcf3f;_0x190d64[_0x4011af][_0x5d59f2(0x280)]=_0x191b27;});const _0x47ce1a=_0x190d64[_0x1fcf3f(0x1ed)](_0x2b4d48=>_0x2b4d48['quantity']!=='0'&&_0x2b4d48[_0x1fcf3f(0x1c7)]!==''),_0x1de2bb=new purchases_finished({'invoice':_0x40842c,'suppliers':_0x521671[_0x1fcf3f(0x1f1)][_0x1fcf3f(0x1f3)],'date':_0x3d76f9,'warehouse_name':_0x239b50,'product':_0x47ce1a,'note':_0x3f3b96,'due_amount':_0xc549e6,'room':_0x54a031,'POnumber':_0x8e9de3,'SCRN':_0xdac87c,'JO_number':_0x513c18}),_0x1982d7=await _0x1de2bb['save'](),_0x3b8481=await purchases_finished[_0x1fcf3f(0x262)]({'invoice':_0x40842c}),_0x19413f=_0x3b8481[_0x1fcf3f(0x29e)][_0x1fcf3f(0x21e)](async _0x56ad11=>{var _0x267517=_0x1fcf3f;try{var _0xb672bc=await warehouse['findOne']({'name':_0x239b50,'room':_0x56ad11[_0x267517(0x1bc)]}),_0x317cdf=0x0;const _0xdfaf56=_0xb672bc[_0x267517(0x278)][_0x267517(0x21e)](_0x1cea40=>{var _0x75aec3=_0x267517;console[_0x75aec3(0x1cf)](_0x1cea40['product_name']+'=='+_0x56ad11[_0x75aec3(0x25b)]+'&&'+_0x1cea40[_0x75aec3(0x294)]+'=='+_0x56ad11[_0x75aec3(0x294)]+'&&'+_0x1cea40[_0x75aec3(0x1b2)]+'=='+_0x56ad11[_0x75aec3(0x1b2)]+'&&'+_0x1cea40[_0x75aec3(0x244)]+'=='+_0x56ad11[_0x75aec3(0x244)]+'&&'+_0x1cea40[_0x75aec3(0x23d)]+'=='+_0x56ad11[_0x75aec3(0x23d)]+'&&'+_0x1cea40['invoice']+'=='+_0x3b8481[_0x75aec3(0x280)]),_0x1cea40[_0x75aec3(0x25b)]==_0x56ad11[_0x75aec3(0x25b)]&&_0x1cea40[_0x75aec3(0x294)]==_0x56ad11[_0x75aec3(0x294)]&&_0x1cea40[_0x75aec3(0x1b2)]==_0x56ad11[_0x75aec3(0x1b2)]&&_0x1cea40[_0x75aec3(0x244)]==_0x56ad11[_0x75aec3(0x244)]&&_0x1cea40[_0x75aec3(0x23d)]==_0x56ad11['batch_code']&&_0x1cea40[_0x75aec3(0x280)]==_0x3b8481[_0x75aec3(0x280)]&&(_0x1cea40['product_stock']=Math[_0x75aec3(0x1b9)](_0x1cea40[_0x75aec3(0x1c8)])+Math['abs'](_0x56ad11[_0x75aec3(0x1c7)]),_0x317cdf++);});return _0x317cdf==0x0&&(_0xb672bc[_0x267517(0x278)]=_0xb672bc['product_details'][_0x267517(0x1f2)]({'product_name':_0x56ad11[_0x267517(0x25b)],'product_stock':Math['abs'](_0x56ad11[_0x267517(0x1c7)]),'primary_code':_0x56ad11[_0x267517(0x25f)],'secondary_code':_0x56ad11[_0x267517(0x1de)],'product_code':_0x56ad11[_0x267517(0x1d9)],'bay':_0x56ad11[_0x267517(0x294)],'maxProducts':_0x56ad11[_0x267517(0x1aa)],'unit':_0x56ad11[_0x267517(0x20e)],'secondary_unit':_0x56ad11[_0x267517(0x26c)],'expiry_date':_0x56ad11[_0x267517(0x1b2)],'production_date':_0x56ad11['production_date'],'maxProducts':_0x56ad11[_0x267517(0x1aa)],'maxPerUnit':_0x56ad11['maxperunit'],'batch_code':_0x56ad11[_0x267517(0x23d)],'product_cat':_0x56ad11[_0x267517(0x255)],'invoice':_0x56ad11[_0x267517(0x280)],'id_incoming':_0x56ad11[_0x267517(0x227)],'date_data':_0x56ad11[_0x267517(0x25a)]})),_0xb672bc;}catch(_0x12b68a){return console[_0x267517(0x276)]('Error\x20occurred\x20while\x20processing\x20product:',_0x12b68a),null;}});Promise[_0x1fcf3f(0x241)](_0x19413f)[_0x1fcf3f(0x243)](async _0x3b08b0=>{var _0x5e874b=_0x1fcf3f;try{for(const _0x287ca4 of _0x3b08b0){await warehouse[_0x5e874b(0x268)]({'_id':_0x287ca4[_0x5e874b(0x227)]},{'$addToSet':{'product_details':{'$each':_0x287ca4[_0x5e874b(0x278)]}}});}const _0x92794c=await master_shop['find'](),_0x14e0d6=await email_settings[_0x5e874b(0x262)](),_0x92f462=await supervisor_settings[_0x5e874b(0x1bf)]();var _0x31d314=_0x3b8481[_0x5e874b(0x29e)],_0x27b411='',_0x3d7c48;for(_0x3d7c48 in _0x31d314){var _0x4e95a9='FG';_0x3b8481[_0x5e874b(0x29c)]=='DRY\x20GOODS'&&(_0x4e95a9='DG'),_0x27b411+=_0x5e874b(0x286)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x31d314[_0x3d7c48][_0x5e874b(0x25b)]+_0x5e874b(0x23e)+_0x5e874b(0x205)+_0x31d314[_0x3d7c48][_0x5e874b(0x1d9)]+_0x5e874b(0x23e)+_0x5e874b(0x205)+_0x31d314[_0x3d7c48][_0x5e874b(0x1c7)]+_0x5e874b(0x23e)+_0x5e874b(0x205)+_0x31d314[_0x3d7c48][_0x5e874b(0x20e)]+_0x5e874b(0x23e)+_0x5e874b(0x205)+_0x31d314[_0x3d7c48][_0x5e874b(0x26c)]+_0x5e874b(0x23e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b8481[_0x5e874b(0x29c)]+_0x5e874b(0x23e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x31d314[_0x3d7c48]['room_name']+_0x5e874b(0x23e)+_0x5e874b(0x205)+_0x4e95a9+_0x31d314[_0x3d7c48][_0x5e874b(0x294)]+_0x5e874b(0x23e),'</tr>';}let _0x1eb770=nodemailer['createTransport']({'host':_0x14e0d6[_0x5e874b(0x1d7)],'port':Number(_0x14e0d6[_0x5e874b(0x1b1)]),'secure':![],'auth':{'user':_0x14e0d6[_0x5e874b(0x28e)],'pass':_0x14e0d6[_0x5e874b(0x2a2)]}}),_0x983138={'from':_0x14e0d6[_0x5e874b(0x28e)],'to':_0x92f462[0x0]['FGSEmail'],'subject':_0x5e874b(0x20f),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5e874b(0x1be)+'/upload/'+_0x92794c[0x0][_0x5e874b(0x298)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x5e874b(0x26b)+_0x5e874b(0x1cb)+_0x5e874b(0x238)+_0x5e874b(0x1ce)+_0x5e874b(0x238)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5e874b(0x1ff)+_0x5e874b(0x238)+'<h2>\x20'+_0x92794c[0x0][_0x5e874b(0x225)]+_0x5e874b(0x218)+'</div>'+_0x5e874b(0x1ff)+_0x5e874b(0x231)+_0x5e874b(0x238)+_0x5e874b(0x210)+_0x5e874b(0x282)+_0x3b8481[_0x5e874b(0x280)]+'\x20'+_0x5e874b(0x296)+_0x5e874b(0x27d)+_0x3b8481[_0x5e874b(0x293)]+'\x20'+_0x5e874b(0x258)+_0x5e874b(0x240)+_0x5e874b(0x1ff)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5e874b(0x1f6)+_0x5e874b(0x286)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5e874b(0x25c)+_0x5e874b(0x249)+_0x5e874b(0x214)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x5e874b(0x20b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x5e874b(0x216)+'</tr>'+'</thead>'+_0x5e874b(0x2a0)+'\x20'+_0x27b411+'\x20'+_0x5e874b(0x1b8)+_0x5e874b(0x26f)+_0x5e874b(0x238)+_0x5e874b(0x242)+'<h5>'+_0x92794c[0x0][_0x5e874b(0x225)]+_0x5e874b(0x240)+_0x5e874b(0x1ff)+_0x5e874b(0x1ff)+'</body></html>'};_0x1eb770[_0x5e874b(0x1c6)](_0x983138,function(_0xa5197b,_0x272130){var _0x1adcee=_0x5e874b;_0xa5197b?(console[_0x1adcee(0x1cf)](_0xa5197b),console[_0x1adcee(0x1cf)]('Error\x20Occurs')):console[_0x1adcee(0x1cf)]('Email\x20sent\x20successfully');});}catch(_0x1be408){console[_0x5e874b(0x276)](_0x1be408),_0x49cb35[_0x5e874b(0x1f5)](0x1f4)[_0x5e874b(0x1df)]({'error':_0x5e874b(0x24f),'message':_0x1be408[_0x5e874b(0x25d)]});}})[_0x1fcf3f(0x239)](_0x1a1838=>{var _0x326964=_0x1fcf3f;console[_0x326964(0x276)](_0x1a1838);}),_0x521671[_0x1fcf3f(0x1af)]('success','purchase\x20data\x20add\x20successfully'),_0x49cb35[_0x1fcf3f(0x1ae)](_0x1fcf3f(0x1f4));}catch(_0x211847){console[_0x1fcf3f(0x1cf)](_0x211847);}}),router[a0_0x3976f0(0x22e)](a0_0x3976f0(0x201),auth,async(_0x53bc3b,_0x556c74)=>{var _0x3612d8=a0_0x3976f0;try{const {username:_0x4e5164,email:_0xd67178,role:_0x525256}=_0x53bc3b[_0x3612d8(0x26d)],_0x2c38de=_0x53bc3b[_0x3612d8(0x26d)],_0x86ed73=await profile[_0x3612d8(0x262)]({'email':_0x2c38de[_0x3612d8(0x28e)]}),_0x4ff8c1=await master_shop[_0x3612d8(0x1bf)](),_0x413f99=_0x53bc3b[_0x3612d8(0x228)]['id'],_0x417c6=await purchases_finished[_0x3612d8(0x275)](_0x413f99),_0xf2e746=await suppliers[_0x3612d8(0x1bf)]({});let _0x56ca50;if(_0x2c38de[_0x3612d8(0x274)]==_0x3612d8(0x211)){const _0x97d2ec=await staff['findOne']({'email':_0x2c38de[_0x3612d8(0x28e)]});_0x56ca50=await warehouse[_0x3612d8(0x1bf)]({'status':_0x3612d8(0x271),'name':_0x97d2ec[_0x3612d8(0x263)],'warehouse_category':_0x3612d8(0x277)});}else _0x56ca50=await warehouse[_0x3612d8(0x22f)]([{'$match':{'status':_0x3612d8(0x271),'warehouse_category':_0x3612d8(0x277)}},{'$group':{'_id':_0x3612d8(0x24b),'name':{'$first':'$name'}}}]);const _0x39c923=await product[_0x3612d8(0x1bf)]({}),_0x46a91b=BayBinSelected(_0x417c6['warehouse_name'],_0x417c6[_0x3612d8(0x289)]);let _0x2765ca=new Date(_0x417c6['expiry_date']),_0x54d643=('0'+_0x2765ca['getDate']())[_0x3612d8(0x269)](-0x2),_0xbbdc0d=('0'+(_0x2765ca[_0x3612d8(0x1c5)]()+0x1))['slice'](-0x2),_0x142528=_0x2765ca[_0x3612d8(0x1bb)](),_0x272c25=_0x142528+'-'+_0xbbdc0d+'-'+_0x54d643;if(_0x4ff8c1[0x0][_0x3612d8(0x261)]=='English\x20(US)'){var _0x6cfbca=users[_0x3612d8(0x1d3)];console[_0x3612d8(0x1cf)](_0x6cfbca);}else{if(_0x4ff8c1[0x0][_0x3612d8(0x261)]==_0x3612d8(0x233))var _0x6cfbca=users[_0x3612d8(0x233)];else{if(_0x4ff8c1[0x0][_0x3612d8(0x261)]==_0x3612d8(0x1ca))var _0x6cfbca=users[_0x3612d8(0x1ca)];else{if(_0x4ff8c1[0x0][_0x3612d8(0x261)]==_0x3612d8(0x27f))var _0x6cfbca=users[_0x3612d8(0x27f)];else{if(_0x4ff8c1[0x0][_0x3612d8(0x261)]==_0x3612d8(0x1cd))var _0x6cfbca=users['French'];else{if(_0x4ff8c1[0x0][_0x3612d8(0x261)]==_0x3612d8(0x202))var _0x6cfbca=users['Portuguese'];else{if(_0x4ff8c1[0x0]['language']=='Chinese')var _0x6cfbca=users[_0x3612d8(0x270)];else{if(_0x4ff8c1[0x0][_0x3612d8(0x261)]==_0x3612d8(0x266))var _0x6cfbca=users[_0x3612d8(0x1fc)];}}}}}}}_0x556c74[_0x3612d8(0x234)](_0x3612d8(0x208),{'success':_0x53bc3b['flash']('success'),'errors':_0x53bc3b[_0x3612d8(0x1af)](_0x3612d8(0x21d)),'role':_0x2c38de,'profile':_0x86ed73,'purchases':_0x417c6,'suppliers':_0xf2e746,'warehouse':_0x56ca50,'product':_0x39c923,'master_shop':_0x4ff8c1,'language':_0x6cfbca,'ed_fullDate':_0x272c25,'dataSelected':_0x46a91b});}catch(_0x4c3584){console[_0x3612d8(0x1cf)](_0x4c3584);}}),router[a0_0x3976f0(0x22e)](a0_0x3976f0(0x291),auth,async(_0x31b7c7,_0x26c248)=>{var _0x184e3b=a0_0x3976f0;try{const {username:_0x16618c,email:_0xfa5fd3,role:_0x164b72}=_0x31b7c7[_0x184e3b(0x26d)],_0x214e0e=_0x31b7c7[_0x184e3b(0x26d)],_0x67393=await profile[_0x184e3b(0x262)]({'email':_0x214e0e[_0x184e3b(0x28e)]}),_0x17c954=await master_shop[_0x184e3b(0x1bf)](),_0x1a5f9d=_0x31b7c7[_0x184e3b(0x228)]['id'],_0x4739dd=await purchases_finished[_0x184e3b(0x275)](_0x1a5f9d),_0x56d63c=await suppliers[_0x184e3b(0x1bf)]({});let _0x298d61;if(_0x214e0e[_0x184e3b(0x274)]==_0x184e3b(0x211)){const _0x4ab96e=await staff[_0x184e3b(0x262)]({'email':_0x214e0e[_0x184e3b(0x28e)]});_0x298d61=await warehouse[_0x184e3b(0x1bf)]({'status':_0x184e3b(0x271),'name':_0x4ab96e[_0x184e3b(0x263)],'warehouse_category':_0x184e3b(0x277)});}else _0x298d61=await warehouse[_0x184e3b(0x22f)]([{'$match':{'status':'Enabled','warehouse_category':_0x184e3b(0x277)}},{'$group':{'_id':_0x184e3b(0x24b),'name':{'$first':_0x184e3b(0x24b)}}}]);const _0xb72618=await product[_0x184e3b(0x1bf)]({}),_0xf894c7=BayBinSelected(_0x4739dd['warehouse_name'],_0x4739dd[_0x184e3b(0x289)]);let _0x1f2ecd=new Date(_0x4739dd[_0x184e3b(0x1b2)]),_0x41ee44=('0'+_0x1f2ecd['getDate']())[_0x184e3b(0x269)](-0x2),_0x2f98d0=('0'+(_0x1f2ecd[_0x184e3b(0x1c5)]()+0x1))[_0x184e3b(0x269)](-0x2),_0x4edebc=_0x1f2ecd['getFullYear'](),_0x453bd2=_0x4edebc+'-'+_0x2f98d0+'-'+_0x41ee44;if(_0x17c954[0x0][_0x184e3b(0x261)]==_0x184e3b(0x257)){var _0x4be59e=users['English'];console[_0x184e3b(0x1cf)](_0x4be59e);}else{if(_0x17c954[0x0][_0x184e3b(0x261)]==_0x184e3b(0x233))var _0x4be59e=users[_0x184e3b(0x233)];else{if(_0x17c954[0x0][_0x184e3b(0x261)]=='German')var _0x4be59e=users['German'];else{if(_0x17c954[0x0]['language']==_0x184e3b(0x27f))var _0x4be59e=users[_0x184e3b(0x27f)];else{if(_0x17c954[0x0][_0x184e3b(0x261)]=='French')var _0x4be59e=users[_0x184e3b(0x1cd)];else{if(_0x17c954[0x0][_0x184e3b(0x261)]==_0x184e3b(0x202))var _0x4be59e=users[_0x184e3b(0x27b)];else{if(_0x17c954[0x0]['language']==_0x184e3b(0x270))var _0x4be59e=users['Chinese'];else{if(_0x17c954[0x0][_0x184e3b(0x261)]==_0x184e3b(0x266))var _0x4be59e=users[_0x184e3b(0x1fc)];}}}}}}}_0x26c248[_0x184e3b(0x234)](_0x184e3b(0x203),{'success':_0x31b7c7['flash'](_0x184e3b(0x200)),'errors':_0x31b7c7['flash'](_0x184e3b(0x21d)),'role':_0x214e0e,'profile':_0x67393,'purchases':_0x4739dd,'suppliers':_0x56d63c,'warehouse':_0x298d61,'product':_0xb72618,'master_shop':_0x17c954,'language':_0x4be59e,'ed_fullDate':_0x453bd2,'dataSelected':_0xf894c7});}catch(_0x48eda8){console['log'](_0x48eda8);}}),router[a0_0x3976f0(0x2a1)](a0_0x3976f0(0x291),auth,async(_0xeed6c6,_0x308f4a)=>{var _0x3f34ba=a0_0x3976f0;try{const _0x139d60=_0xeed6c6[_0x3f34ba(0x228)]['id'],_0x50df36=await purchases_finished[_0x3f34ba(0x262)]({'_id':_0xeed6c6[_0x3f34ba(0x228)]['id']}),_0x2a9374=await warehouse[_0x3f34ba(0x262)]({'name':_0x50df36['warehouse_name'],'room':_0x50df36['room']});_0x50df36[_0x3f34ba(0x29e)]['forEach'](_0x451378=>{var _0x35cf27=_0x3f34ba;const _0x512cc1=_0x2a9374[_0x35cf27(0x278)][_0x35cf27(0x21e)](_0x101ad4=>{var _0x2c625d=_0x35cf27;_0x101ad4['product_name']==_0x451378[_0x2c625d(0x25b)]&&_0x101ad4[_0x2c625d(0x294)]==_0x451378['bay']&&(_0x101ad4[_0x2c625d(0x1c8)]=parseInt(_0x101ad4['product_stock'])-parseInt(_0x451378[_0x2c625d(0x1c7)]));});}),await _0x2a9374['save']();const {invoice:_0x836bc5,suppliers:_0x10641e,date:_0x4e7260,warehouse_name:_0x5122d9,prod_name:_0x3bd6b0,prod_code:_0x4f1520,prod_qty:_0x2863dd,prod_unit:_0x1cf78e,prod_secondunit:_0x5120db,prod_level:_0x4c3bcc,prod_isle:_0x7da664,prod_pallet:_0x3696f9,note:_0x4f5435,expiry_date:_0x19055b,batch_code:_0x447792,paid_amount:_0x3dc382,due_amount:_0x56cb4d,Room_name:_0x389018,primary_code:_0x3a187d,secondary_code:_0x12ceee,PO_number:_0xf39bbc,JO_number:_0x57675d}=_0xeed6c6[_0x3f34ba(0x1f1)];if(typeof _0x3bd6b0=='string')var _0x28dde6=[_0xeed6c6[_0x3f34ba(0x1f1)]['prod_name']],_0x9a2213=[_0xeed6c6[_0x3f34ba(0x1f1)]['prod_code']],_0x31faab=[_0xeed6c6[_0x3f34ba(0x1f1)][_0x3f34ba(0x21f)]],_0x1d1f7c=[_0xeed6c6[_0x3f34ba(0x1f1)][_0x3f34ba(0x1a7)]],_0x4c476b=[_0xeed6c6[_0x3f34ba(0x1f1)]['prod_secondunit']],_0x3a117c=[_0xeed6c6[_0x3f34ba(0x1f1)][_0x3f34ba(0x1fd)]],_0x5a5ebc=[_0xeed6c6['body'][_0x3f34ba(0x25f)]],_0x5b29c6=[_0xeed6c6['body'][_0x3f34ba(0x1de)]],_0x3b3edb=[_0xeed6c6[_0x3f34ba(0x1f1)]['MaxStocks_data']],_0x275d68=[_0xeed6c6[_0x3f34ba(0x1f1)][_0x3f34ba(0x23d)]],_0x2c65da=[_0xeed6c6[_0x3f34ba(0x1f1)][_0x3f34ba(0x1b2)]];else var _0x28dde6=[..._0xeed6c6[_0x3f34ba(0x1f1)]['prod_name']],_0x9a2213=[..._0xeed6c6['body'][_0x3f34ba(0x285)]],_0x31faab=[..._0xeed6c6['body']['prod_qty']],_0x1d1f7c=[..._0xeed6c6['body']['prod_unit']],_0x4c476b=[..._0xeed6c6[_0x3f34ba(0x1f1)][_0x3f34ba(0x245)]],_0x3a117c=[..._0xeed6c6[_0x3f34ba(0x1f1)]['prod_level']],_0x5a5ebc=[..._0xeed6c6[_0x3f34ba(0x1f1)][_0x3f34ba(0x25f)]],_0x5b29c6=[..._0xeed6c6[_0x3f34ba(0x1f1)][_0x3f34ba(0x1de)]],_0x3b3edb=[..._0xeed6c6[_0x3f34ba(0x1f1)]['MaxStocks_data']],_0x275d68=[..._0xeed6c6[_0x3f34ba(0x1f1)][_0x3f34ba(0x23d)]],_0x2c65da=[..._0xeed6c6['body'][_0x3f34ba(0x1b2)]];const _0x1a1335=_0x28dde6['map'](_0x52a0ee=>{return _0x52a0ee={'product_name':_0x52a0ee};});_0x9a2213[_0x3f34ba(0x1e2)]((_0x268346,_0x173048)=>{var _0x35766f=_0x3f34ba;_0x1a1335[_0x173048][_0x35766f(0x1d9)]=_0x268346;}),_0x31faab[_0x3f34ba(0x1e2)]((_0x532ffc,_0x40d4d4)=>{var _0x19c19a=_0x3f34ba;_0x1a1335[_0x40d4d4][_0x19c19a(0x1c7)]=_0x532ffc;}),_0x1d1f7c[_0x3f34ba(0x1e2)]((_0x21f322,_0x5c38ec)=>{var _0x8ffec6=_0x3f34ba;_0x1a1335[_0x5c38ec][_0x8ffec6(0x20e)]=_0x21f322;}),_0x4c476b[_0x3f34ba(0x1e2)]((_0x1f553e,_0x5dd29c)=>{var _0x25ca10=_0x3f34ba;_0x1a1335[_0x5dd29c][_0x25ca10(0x26c)]=_0x1f553e;}),_0x3a117c['forEach']((_0x1e0dcf,_0x4f5847)=>{_0x1a1335[_0x4f5847]['bay']=_0x1e0dcf;}),_0x5a5ebc[_0x3f34ba(0x1e2)]((_0x3e539f,_0x1be05e)=>{var _0x4b00ef=_0x3f34ba;_0x1a1335[_0x1be05e][_0x4b00ef(0x25f)]=_0x3e539f;}),_0x5b29c6[_0x3f34ba(0x1e2)]((_0x4225fb,_0x32422b)=>{_0x1a1335[_0x32422b]['secondary_code']=_0x4225fb;}),_0x3b3edb[_0x3f34ba(0x1e2)]((_0x32900a,_0x14c2be)=>{var _0x56548e=_0x3f34ba;_0x1a1335[_0x14c2be][_0x56548e(0x1aa)]=_0x32900a;}),_0x275d68['forEach']((_0x23f348,_0x452b9b)=>{var _0x1c754e=_0x3f34ba;_0x1a1335[_0x452b9b][_0x1c754e(0x23d)]=_0x23f348;}),_0x2c65da['forEach']((_0x33a781,_0x33fdf1)=>{_0x1a1335[_0x33fdf1]['expiry_date']=_0x33a781;});const _0x4561e4=_0x1a1335[_0x3f34ba(0x1ed)](_0x5636e7=>_0x5636e7['quantity']!=='0'&&_0x5636e7[_0x3f34ba(0x1c7)]!=='');_0x50df36[_0x3f34ba(0x280)]=_0x836bc5,_0x50df36[_0x3f34ba(0x1f3)]=_0x10641e,_0x50df36[_0x3f34ba(0x293)]=_0x4e7260,_0x50df36[_0x3f34ba(0x29c)]=_0x5122d9,_0x50df36[_0x3f34ba(0x29e)]=_0x4561e4,_0x50df36[_0x3f34ba(0x215)]=_0x4f5435,_0x50df36[_0x3f34ba(0x26e)]=_0x3dc382,_0x50df36[_0x3f34ba(0x29f)]=_0x56cb4d,_0x50df36[_0x3f34ba(0x289)]=_0x389018,_0x50df36[_0x3f34ba(0x1da)]=_0xf39bbc,_0x50df36[_0x3f34ba(0x288)]=_0x57675d;const _0x18c844=await _0x50df36[_0x3f34ba(0x284)](),_0x167c59=await warehouse[_0x3f34ba(0x262)]({'name':_0xeed6c6[_0x3f34ba(0x1f1)][_0x3f34ba(0x29c)],'room':_0xeed6c6['body'][_0x3f34ba(0x226)]});_0x50df36[_0x3f34ba(0x29e)]['forEach'](_0x8e5222=>{var _0x5bb2fb=_0x3f34ba,_0x474c4d=0x0;const _0x2d65bb=_0x167c59['product_details']['map'](_0x17c759=>{var _0x2c141a=a0_0x29a4;_0x17c759['product_name']==_0x8e5222[_0x2c141a(0x25b)]&&_0x17c759[_0x2c141a(0x294)]==_0x8e5222['bay']&&(_0x17c759[_0x2c141a(0x1c8)]=parseInt(_0x17c759[_0x2c141a(0x1c8)])+parseInt(_0x8e5222[_0x2c141a(0x1c7)]),_0x474c4d++);});_0x474c4d=='0'&&(_0x167c59[_0x5bb2fb(0x278)]=_0x167c59[_0x5bb2fb(0x278)]['concat']({'product_name':_0x8e5222[_0x5bb2fb(0x25b)],'product_stock':_0x8e5222[_0x5bb2fb(0x1c7)],'primary_code':_0x8e5222[_0x5bb2fb(0x25f)],'secondary_code':_0x8e5222[_0x5bb2fb(0x1de)],'product_code':_0x8e5222['product_code'],'bay':_0x8e5222[_0x5bb2fb(0x294)],'maxProducts':_0x8e5222[_0x5bb2fb(0x1aa)],'unit':_0x8e5222[_0x5bb2fb(0x20e)],'secondary_unit':_0x8e5222[_0x5bb2fb(0x26c)],'expiry_date':_0x8e5222[_0x5bb2fb(0x1b2)]}));}),await _0x167c59['save']();const _0x3da348=await s_payment_data[_0x3f34ba(0x262)]({'invoice':_0xeed6c6[_0x3f34ba(0x1f1)]['invoice']});if(_0x3da348===null){}else console['log'](_0x3f34ba(0x1f3),_0x3da348,_0xeed6c6['body'][_0x3f34ba(0x280)]),_0x3da348[_0x3f34ba(0x1f3)]=_0xeed6c6[_0x3f34ba(0x1f1)]['suppliers'],await _0x3da348['save']();_0xeed6c6[_0x3f34ba(0x1af)](_0x3f34ba(0x200),'purchase\x20data\x20update\x20successfully'),_0x308f4a[_0x3f34ba(0x1ae)](_0x3f34ba(0x1f4));}catch(_0x374784){console['log'](_0x374784);}}),router[a0_0x3976f0(0x2a1)](a0_0x3976f0(0x20a),auth,async(_0x3a0ce1,_0x4c54ce)=>{var _0x56b8af=a0_0x3976f0;try{const _0x1a5b28=_0x3a0ce1[_0x56b8af(0x228)]['id'],{invoice:_0x388e11,suppliers:_0x193146,payable:_0x4759b9,due_amount:_0x1d07b0}=_0x3a0ce1[_0x56b8af(0x1f1)],_0x3988c2=await purchases[_0x56b8af(0x275)](_0x1a5b28);var _0x499045=_0x4759b9-_0x1d07b0;_0x3988c2[_0x56b8af(0x26e)]=parseFloat(_0x3988c2[_0x56b8af(0x26e)])+parseFloat(_0x1d07b0),_0x3988c2[_0x56b8af(0x29f)]=_0x499045;const _0x3b29f7=await _0x3988c2[_0x56b8af(0x284)]();console[_0x56b8af(0x1cf)](_0x3b29f7);const _0x2e6a13=await s_payment_data[_0x56b8af(0x262)]({'invoice':_0x388e11});_0x2e6a13[_0x56b8af(0x253)]=_0x499045,await _0x2e6a13[_0x56b8af(0x284)]();let _0x4e3c35=new Date(),_0x311970=('0'+_0x4e3c35['getDate']())[_0x56b8af(0x269)](-0x2),_0x5d6646=('0'+(_0x4e3c35[_0x56b8af(0x1c5)]()+0x1))[_0x56b8af(0x269)](-0x2),_0xede2d6=_0x4e3c35[_0x56b8af(0x1bb)](),_0x3fab41=_0xede2d6+'-'+_0x5d6646+'-'+_0x311970;const _0x576f9e=new suppliers_payment({'invoice':_0x388e11,'date':_0xede2d6+'-'+_0x5d6646+'-'+_0x311970,'suppliers':_0x193146,'reason':_0x56b8af(0x1d0),'amount':_0x1d07b0}),_0x57013d=await _0x576f9e[_0x56b8af(0x284)]();_0x3a0ce1[_0x56b8af(0x1af)](_0x56b8af(0x200),_0x56b8af(0x248)),_0x4c54ce['redirect'](_0x56b8af(0x237));}catch(_0x514e92){console[_0x56b8af(0x1cf)](_0x514e92);}}),router[a0_0x3976f0(0x22e)](a0_0x3976f0(0x206),auth,async(_0x476c0c,_0x29dd86)=>{var _0x396166=a0_0x3976f0;try{const {username:_0x30d2eb,email:_0x4c4029,role:_0x4cea0d}=_0x476c0c['user'],_0x2704e0=_0x476c0c[_0x396166(0x26d)],_0x3a3990=await profile['findOne']({'email':_0x2704e0[_0x396166(0x28e)]}),_0x417e24=await master_shop['find']();console['log']('master',_0x417e24);const _0x3b87a6=_0x476c0c[_0x396166(0x228)]['id'],_0x301155=await purchases[_0x396166(0x275)](_0x3b87a6);console[_0x396166(0x1cf)](_0x301155);const _0x23c60a=await suppliers[_0x396166(0x262)]({'name':_0x301155[_0x396166(0x1f3)]});console[_0x396166(0x1cf)](_0x23c60a);if(_0x417e24[0x0][_0x396166(0x261)]==_0x396166(0x257)){var _0x3ff34c=users[_0x396166(0x1d3)];console[_0x396166(0x1cf)](_0x3ff34c);}else{if(_0x417e24[0x0][_0x396166(0x261)]==_0x396166(0x233))var _0x3ff34c=users[_0x396166(0x233)];else{if(_0x417e24[0x0]['language']==_0x396166(0x1ca))var _0x3ff34c=users[_0x396166(0x1ca)];else{if(_0x417e24[0x0][_0x396166(0x261)]==_0x396166(0x27f))var _0x3ff34c=users['Spanish'];else{if(_0x417e24[0x0][_0x396166(0x261)]==_0x396166(0x1cd))var _0x3ff34c=users['French'];else{if(_0x417e24[0x0][_0x396166(0x261)]==_0x396166(0x202))var _0x3ff34c=users[_0x396166(0x27b)];else{if(_0x417e24[0x0][_0x396166(0x261)]=='Chinese')var _0x3ff34c=users[_0x396166(0x270)];else{if(_0x417e24[0x0][_0x396166(0x261)]=='Arabic\x20(ae)')var _0x3ff34c=users[_0x396166(0x1fc)];}}}}}}}_0x29dd86[_0x396166(0x234)](_0x396166(0x219),{'success':_0x476c0c[_0x396166(0x1af)](_0x396166(0x200)),'errors':_0x476c0c['flash'](_0x396166(0x21d)),'role':_0x2704e0,'profile':_0x3a3990,'master_shop':_0x417e24,'supplier':_0x23c60a,'purchase':_0x301155,'language':_0x3ff34c});}catch(_0x110be6){console[_0x396166(0x1cf)](_0x110be6);}}),router[a0_0x3976f0(0x22e)](a0_0x3976f0(0x1a9),auth,async(_0x31536c,_0x195a9d)=>{var _0xe6e924=a0_0x3976f0;try{const {username:_0x3797d5,email:_0x4487ee,role:_0x44fa01}=_0x31536c[_0xe6e924(0x26d)],_0x279d1f=_0x31536c[_0xe6e924(0x26d)],_0x17d796=await profile['findOne']({'email':_0x279d1f['email']}),_0xdd15c9=await master_shop['find']();console['log'](_0xe6e924(0x222),_0xdd15c9);const _0x183194=_0x31536c['params']['id'];console[_0xe6e924(0x1cf)](_0x183194);const _0x45d68f=await purchases_finished[_0xe6e924(0x275)](_0x183194);console[_0xe6e924(0x1cf)](_0xe6e924(0x235),_0x45d68f);const _0x1a7359=await product[_0xe6e924(0x1bf)]({}),_0x9f0428=await warehouse[_0xe6e924(0x22f)]([{'$match':{'name':_0x45d68f[_0xe6e924(0x29c)],'room':_0x45d68f[_0xe6e924(0x289)]}},{'$unwind':_0xe6e924(0x21c)},{'$group':{'_id':'$product_details._id','name':{'$first':_0xe6e924(0x24d)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xe6e924(0x1ad)},'bin':{'$first':_0xe6e924(0x1c4)},'type':{'$first':_0xe6e924(0x283)},'floorlevel':{'$first':_0xe6e924(0x23c)},'primary_code':{'$first':_0xe6e924(0x1e3)},'secondary_code':{'$first':_0xe6e924(0x1db)},'product_code':{'$first':_0xe6e924(0x1dd)},'storage':{'$first':_0xe6e924(0x28d)},'rack':{'$first':'$product_details.rack'}}}]);console[_0xe6e924(0x1cf)]('stock_data',_0x9f0428);let _0x39dac6;if(_0x279d1f[_0xe6e924(0x274)]==_0xe6e924(0x211)){const _0x18bc2c=await staff[_0xe6e924(0x262)]({'email':_0x279d1f[_0xe6e924(0x28e)]});_0x39dac6=await warehouse[_0xe6e924(0x1bf)]({'status':_0xe6e924(0x271),'name':_0x18bc2c[_0xe6e924(0x263)],'warehouse_category':_0xe6e924(0x277),'name':'Return\x20Goods'});}else _0x39dac6=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0xe6e924(0x277),'name':_0xe6e924(0x25e)}},{'$group':{'_id':_0xe6e924(0x24b),'name':{'$first':_0xe6e924(0x24b)}}}]);if(_0xdd15c9[0x0][_0xe6e924(0x261)]==_0xe6e924(0x257)){var _0x1f9b1e=users['English'];console[_0xe6e924(0x1cf)](_0x1f9b1e);}else{if(_0xdd15c9[0x0][_0xe6e924(0x261)]=='Hindi')var _0x1f9b1e=users[_0xe6e924(0x233)];else{if(_0xdd15c9[0x0][_0xe6e924(0x261)]==_0xe6e924(0x1ca))var _0x1f9b1e=users['German'];else{if(_0xdd15c9[0x0][_0xe6e924(0x261)]==_0xe6e924(0x27f))var _0x1f9b1e=users[_0xe6e924(0x27f)];else{if(_0xdd15c9[0x0][_0xe6e924(0x261)]==_0xe6e924(0x1cd))var _0x1f9b1e=users['French'];else{if(_0xdd15c9[0x0][_0xe6e924(0x261)]==_0xe6e924(0x202))var _0x1f9b1e=users['Portuguese'];else{if(_0xdd15c9[0x0][_0xe6e924(0x261)]==_0xe6e924(0x270))var _0x1f9b1e=users[_0xe6e924(0x270)];else{if(_0xdd15c9[0x0][_0xe6e924(0x261)]==_0xe6e924(0x266))var _0x1f9b1e=users['Arabic'];}}}}}}}_0x195a9d[_0xe6e924(0x234)](_0xe6e924(0x220),{'success':_0x31536c[_0xe6e924(0x1af)](_0xe6e924(0x200)),'errors':_0x31536c[_0xe6e924(0x1af)](_0xe6e924(0x21d)),'role':_0x279d1f,'profile':_0x17d796,'user':_0x45d68f,'stock':_0x9f0428,'master_shop':_0xdd15c9,'product':_0x1a7359,'language':_0x1f9b1e,'warehouse':_0x39dac6});}catch(_0xfda0f2){console[_0xe6e924(0x1cf)](_0xfda0f2);}}),router[a0_0x3976f0(0x2a1)](a0_0x3976f0(0x1a9),auth,async(_0x3c84c6,_0x45c9c5)=>{var _0x2dc762=a0_0x3976f0;try{const {invoice:_0x3df9e6,date:_0x490fbb,warehouse_name:_0x2c3ece,Room_name:_0x5528c2,product_name:_0x437ab0,purchase_quantity:_0x511fc3,stocks:_0x3d9a54,return_qty:_0x488c67,note:_0x1b5713,level:_0x479ba0,isle:_0x139263,pallet:_0x8190da,to_warehouse_name:_0x19e0fa,to_Room_name:_0x16c986}=_0x3c84c6[_0x2dc762(0x1f1)],_0x1f54fc=await purchases_finished['findOne']({'_id':_0x3c84c6['params']['id']}),_0x1e2a43=await warehouse['findOne']({'name':_0x2c3ece,'room':_0x5528c2,'warehouse_category':_0x2dc762(0x277)});if(typeof _0x437ab0=='string')var _0x4e179c=[_0x3c84c6[_0x2dc762(0x1f1)]['product_name']],_0x5ec1d2=[_0x3c84c6[_0x2dc762(0x1f1)][_0x2dc762(0x259)]],_0x18016f=[_0x3c84c6[_0x2dc762(0x1f1)][_0x2dc762(0x295)]],_0x42a587=[_0x3c84c6['body'][_0x2dc762(0x1ec)]],_0x45762f=[_0x3c84c6[_0x2dc762(0x1f1)]['level']],_0x459149=[_0x3c84c6[_0x2dc762(0x1f1)]['product_code_hide']],_0xf8c6ae=[_0x3c84c6[_0x2dc762(0x1f1)]['primary_code_hide']],_0x3bffdd=[_0x3c84c6[_0x2dc762(0x1f1)][_0x2dc762(0x287)]];else var _0x4e179c=[..._0x3c84c6[_0x2dc762(0x1f1)][_0x2dc762(0x25b)]],_0x5ec1d2=[..._0x3c84c6[_0x2dc762(0x1f1)][_0x2dc762(0x259)]],_0x18016f=[..._0x3c84c6[_0x2dc762(0x1f1)][_0x2dc762(0x295)]],_0x42a587=[..._0x3c84c6['body'][_0x2dc762(0x1ec)]],_0x45762f=[..._0x3c84c6[_0x2dc762(0x1f1)]['level']],_0x459149=[..._0x3c84c6[_0x2dc762(0x1f1)][_0x2dc762(0x229)]],_0xf8c6ae=[..._0x3c84c6[_0x2dc762(0x1f1)]['primary_code_hide']],_0x3bffdd=[..._0x3c84c6['body'][_0x2dc762(0x287)]];const _0x2f8d3e=_0x4e179c[_0x2dc762(0x21e)](_0x36b0e5=>{return _0x36b0e5={'product_name':_0x36b0e5};});_0x5ec1d2[_0x2dc762(0x1e2)]((_0x25050a,_0x59134d)=>{var _0x147818=_0x2dc762;_0x2f8d3e[_0x59134d][_0x147818(0x259)]=_0x25050a;}),_0x18016f['forEach']((_0x35f9fe,_0x28c6d5)=>{_0x2f8d3e[_0x28c6d5]['stock_quantity']=_0x35f9fe;}),_0x42a587['forEach']((_0x250e6c,_0xcc6677)=>{var _0x323de9=_0x2dc762;_0x2f8d3e[_0xcc6677][_0x323de9(0x1ec)]=_0x250e6c;}),_0x45762f[_0x2dc762(0x1e2)]((_0x1d8339,_0x48ea0d)=>{_0x2f8d3e[_0x48ea0d]['bay']=_0x1d8339;}),_0x459149[_0x2dc762(0x1e2)]((_0x4b40c8,_0x185361)=>{_0x2f8d3e[_0x185361]['product_code']=_0x4b40c8;}),_0xf8c6ae['forEach']((_0x2c7779,_0x35285c)=>{var _0x415216=_0x2dc762;_0x2f8d3e[_0x35285c][_0x415216(0x25f)]=_0x2c7779;}),_0x3bffdd['forEach']((_0x3a641b,_0x2088fd)=>{var _0x414a41=_0x2dc762;_0x2f8d3e[_0x2088fd][_0x414a41(0x1de)]=_0x3a641b;}),_0x2f8d3e[_0x2dc762(0x1e2)](_0x5428e0=>{var _0x4c8739=_0x2dc762;console['log'](_0x5428e0);const _0x49f782=_0x1e2a43[_0x4c8739(0x278)][_0x4c8739(0x21e)](_0x24fe6e=>{var _0x865f5a=_0x4c8739;_0x24fe6e[_0x865f5a(0x25b)]==_0x5428e0[_0x865f5a(0x25b)]&&_0x24fe6e['bay']==_0x5428e0[_0x865f5a(0x294)]&&(console[_0x865f5a(0x1cf)](parseInt(_0x24fe6e['product_stock'])+'\x20<>\x20'+parseInt(_0x5428e0[_0x865f5a(0x1ec)])),_0x24fe6e[_0x865f5a(0x1c8)]=parseInt(_0x24fe6e[_0x865f5a(0x1c8)])-parseInt(_0x5428e0['return_qty']));});}),await _0x1e2a43[_0x2dc762(0x284)]();var _0x9c1013=0x0;_0x2f8d3e[_0x2dc762(0x1e2)](_0xfa5e3b=>{var _0x122caa=_0x2dc762;(parseInt(_0xfa5e3b[_0x122caa(0x259)])<parseInt(_0xfa5e3b[_0x122caa(0x1ec)])||parseInt(_0xfa5e3b[_0x122caa(0x1f9)])<parseInt(_0xfa5e3b[_0x122caa(0x1ec)]))&&_0x9c1013++;});if(_0x9c1013!=0x0)return _0x3c84c6[_0x2dc762(0x1af)](_0x2dc762(0x21d),_0x2dc762(0x1cc)),_0x45c9c5['redirect'](_0x2dc762(0x232));const _0x3f7cf6=new purchases_return_finished({'invoice':_0x3df9e6,'suppliers':_0x3c84c6['body']['suppliers'],'date':_0x490fbb,'warehouse_name':_0x2c3ece,'return_product':_0x2f8d3e,'note':_0x1b5713,'room':_0x5528c2,'to_warehouse_name':_0x19e0fa,'to_room':_0x16c986}),_0x539911=await _0x3f7cf6[_0x2dc762(0x284)](),_0x12c8f2=await purchases_return_finished[_0x2dc762(0x262)]({'invoice':_0x3df9e6}),_0xa4b237=await warehouse[_0x2dc762(0x262)]({'name':_0x19e0fa,'room':_0x16c986,'warehouse_category':_0x2dc762(0x277)});_0x12c8f2['return_product'][_0x2dc762(0x1e2)](_0x21bf0b=>{var _0x4b25a7=_0x2dc762,_0x16637d=0x0;const _0x373d99=_0xa4b237[_0x4b25a7(0x278)][_0x4b25a7(0x21e)](_0x430df9=>{var _0x41d84d=_0x4b25a7;console[_0x41d84d(0x1cf)](_0x430df9[_0x41d84d(0x25b)]+'=='+_0x21bf0b['product_name']+'&&'+_0x430df9['bay']+'=='+_0x21bf0b[_0x41d84d(0x294)]),_0x430df9[_0x41d84d(0x25b)]==_0x21bf0b[_0x41d84d(0x25b)]&&_0x430df9[_0x41d84d(0x294)]==_0x21bf0b[_0x41d84d(0x294)]&&(_0x430df9[_0x41d84d(0x1c8)]=parseInt(_0x430df9[_0x41d84d(0x1c8)])-parseInt(_0x21bf0b[_0x41d84d(0x1ec)]),_0x16637d++);});_0x16637d=='0'&&(_0xa4b237[_0x4b25a7(0x278)]=_0xa4b237[_0x4b25a7(0x278)]['concat']({'product_name':_0x21bf0b[_0x4b25a7(0x25b)],'product_stock':_0x21bf0b[_0x4b25a7(0x1ec)],'primary_code':_0x21bf0b['primary_code'],'secondary_code':_0x21bf0b[_0x4b25a7(0x1de)],'product_code':_0x21bf0b[_0x4b25a7(0x1d9)],'bay':_0x21bf0b['bay'],'maxProducts':0xf423f}));}),await _0xa4b237[_0x2dc762(0x284)]();const _0x1f8e84=await purchases_finished['findOne']({'invoice':_0x3df9e6});_0x1f8e84[_0x2dc762(0x1c3)]='True';const _0xdf26ff=await _0x1f8e84[_0x2dc762(0x284)](),_0xded576=new s_payment_data({'invoice':_0x3df9e6,'suppliers':_0x3c84c6[_0x2dc762(0x1f1)][_0x2dc762(0x1f3)],'reason':_0x2dc762(0x204)});await _0xded576[_0x2dc762(0x284)]();const _0x1f6a1f=await master_shop[_0x2dc762(0x1bf)](),_0x31c6e4=await email_settings[_0x2dc762(0x262)](),_0x1cd881=await suppliers[_0x2dc762(0x262)]({'name':_0x3c84c6[_0x2dc762(0x1f1)][_0x2dc762(0x1f3)]});_0x1f6a1f[0x0][_0x2dc762(0x1e4)]==0x1?(right_currency=_0x1f6a1f[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1f6a1f[0x0][_0x2dc762(0x1e1)]);var _0x66fe0d=_0x4e179c,_0x2435b4=_0x42a587,_0x1193aa='',_0x5a6fb8;for(_0x5a6fb8 in _0x66fe0d){_0x1193aa+=_0x2dc762(0x286)+_0x2dc762(0x205)+_0x66fe0d[_0x5a6fb8]+_0x2dc762(0x23e)+_0x2dc762(0x205)+_0x2435b4[_0x5a6fb8]+_0x2dc762(0x23e)+_0x2dc762(0x224);}let _0x5f3f46=nodemailer[_0x2dc762(0x1f8)]({'service':_0x2dc762(0x27c),'auth':{'user':_0x31c6e4[_0x2dc762(0x28e)],'pass':_0x31c6e4['password']}}),_0xbc75d6={'from':_0x31c6e4[_0x2dc762(0x28e)],'to':_0x1cd881[_0x2dc762(0x28e)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x2dc762(0x260),'path':__dirname+'/../public'+'/upload/'+_0x1f6a1f[0x0]['image'],'cid':_0x2dc762(0x2a4)}],'html':_0x2dc762(0x22d)+_0x2dc762(0x26b)+'</head><body>'+_0x2dc762(0x238)+_0x2dc762(0x1ce)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2dc762(0x1ff)+'<div>'+_0x2dc762(0x246)+_0x1f6a1f[0x0]['site_title']+_0x2dc762(0x218)+_0x2dc762(0x1ff)+_0x2dc762(0x1ff)+_0x2dc762(0x231)+_0x2dc762(0x238)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2dc762(0x282)+_0x3df9e6+'\x20'+_0x2dc762(0x296)+'\x20Order\x20Date\x20:\x20'+_0x490fbb+'\x20'+'</span>'+_0x2dc762(0x240)+'</div>'+_0x2dc762(0x2a3)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x2dc762(0x20d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x2dc762(0x224)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1193aa+'\x20'+_0x2dc762(0x1b8)+_0x2dc762(0x26f)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x1f6a1f[0x0][_0x2dc762(0x225)]+_0x2dc762(0x240)+_0x2dc762(0x1ff)+_0x2dc762(0x1ff)+_0x2dc762(0x1fb)};_0x5f3f46[_0x2dc762(0x1c6)](_0xbc75d6,function(_0x4d8a75,_0x265b78){var _0x49546c=_0x2dc762;_0x4d8a75?console[_0x49546c(0x1cf)](_0x49546c(0x27e)):console[_0x49546c(0x1cf)](_0x49546c(0x230));}),_0x3c84c6[_0x2dc762(0x1af)](_0x2dc762(0x200),_0x2dc762(0x1e7)),_0x45c9c5[_0x2dc762(0x1ae)](_0x2dc762(0x1f4));}catch(_0x7f8559){_0x45c9c5[_0x2dc762(0x1f5)](0xc8)['json']({'message':_0x7f8559['message']});}}),router[a0_0x3976f0(0x22e)]('/barcode/:id',auth,async(_0x3a4320,_0x208799)=>{var _0x2a0a64=a0_0x3976f0;try{const {username:_0x5145e8,email:_0x478607,role:_0x334fa1}=_0x3a4320[_0x2a0a64(0x26d)],_0xdf3bce=_0x3a4320[_0x2a0a64(0x26d)],_0x363b7a=await profile[_0x2a0a64(0x262)]({'email':_0xdf3bce[_0x2a0a64(0x28e)]}),_0x37b859=await master_shop[_0x2a0a64(0x1bf)](),_0x270cc2=_0x3a4320['params']['id'],_0x3ac0ed=await purchases_finished[_0x2a0a64(0x275)](_0x270cc2);if(_0x37b859[0x0][_0x2a0a64(0x261)]=='English\x20(US)')var _0x21e6ec=users[_0x2a0a64(0x1d3)];else{if(_0x37b859[0x0][_0x2a0a64(0x261)]=='Hindi')var _0x21e6ec=users['Hindi'];else{if(_0x37b859[0x0][_0x2a0a64(0x261)]=='German')var _0x21e6ec=users['German'];else{if(_0x37b859[0x0][_0x2a0a64(0x261)]=='Spanish')var _0x21e6ec=users[_0x2a0a64(0x27f)];else{if(_0x37b859[0x0][_0x2a0a64(0x261)]==_0x2a0a64(0x1cd))var _0x21e6ec=users[_0x2a0a64(0x1cd)];else{if(_0x37b859[0x0][_0x2a0a64(0x261)]==_0x2a0a64(0x202))var _0x21e6ec=users[_0x2a0a64(0x27b)];else{if(_0x37b859[0x0][_0x2a0a64(0x261)]==_0x2a0a64(0x270))var _0x21e6ec=users[_0x2a0a64(0x270)];else{if(_0x37b859[0x0]['language']=='Arabic\x20(ae)')var _0x21e6ec=users[_0x2a0a64(0x1fc)];}}}}}}}_0x208799[_0x2a0a64(0x234)](_0x2a0a64(0x1d4),{'success':_0x3a4320[_0x2a0a64(0x1af)](_0x2a0a64(0x200)),'errors':_0x3a4320[_0x2a0a64(0x1af)](_0x2a0a64(0x21d)),'role':_0xdf3bce,'profile':_0x363b7a,'alldata':_0x3ac0ed,'master_shop':_0x37b859,'language':_0x21e6ec}),console[_0x2a0a64(0x1cf)](alldata);}catch(_0x5862fa){console[_0x2a0a64(0x1cf)](_0x5862fa);}}),router[a0_0x3976f0(0x2a1)](a0_0x3976f0(0x28a),async(_0xd6a1e4,_0x2f0740)=>{var _0x2d0bd0=a0_0x3976f0;const {product_code:_0x102b33}=_0xd6a1e4['body'];var _0x35e138;const _0x2d2d3e=await product[_0x2d0bd0(0x22f)]([{'$match':{'primary_code':_0x102b33,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x2d0bd0(0x1d2),'name':{'$first':_0x2d0bd0(0x24b)},'category':{'$first':'$category'},'brand':{'$first':_0x2d0bd0(0x254)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x2d0bd0(0x264)},'product_code':{'$first':_0x2d0bd0(0x28f)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2d0bd0(0x20c)},'maxStocks':{'$first':_0x2d0bd0(0x1eb)},'maxProdPerUnit':{'$first':_0x2d0bd0(0x265)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2d0bd0(0x1e5)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x248046=await product[_0x2d0bd0(0x22f)]([{'$match':{'secondary_code':_0x102b33}},{'$group':{'_id':_0x2d0bd0(0x1d2),'name':{'$first':_0x2d0bd0(0x24b)},'category':{'$first':_0x2d0bd0(0x1b6)},'brand':{'$first':'$brand'},'unit':{'$first':_0x2d0bd0(0x207)},'alertquantity':{'$first':_0x2d0bd0(0x264)},'product_code':{'$first':_0x2d0bd0(0x28f)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2d0bd0(0x20c)},'maxStocks':{'$first':_0x2d0bd0(0x1eb)},'maxProdPerUnit':{'$first':_0x2d0bd0(0x265)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2d0bd0(0x1e5)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2d2d3e[_0x2d0bd0(0x1f7)]>0x0)_0x35e138=_0x2d2d3e;else _0x248046[_0x2d0bd0(0x1f7)]>0x0&&(_0x35e138=_0x248046);_0x2f0740[_0x2d0bd0(0x1df)](_0x35e138);}),router[a0_0x3976f0(0x2a1)](a0_0x3976f0(0x256),async(_0x1e3eba,_0x163b8b)=>{var _0x975a34=a0_0x3976f0;const {productCode:_0x38f9e8,bay:_0x3d5bf0,warehouses:_0x37fb58,room:_0x3178a0}=_0x1e3eba['body'];console[_0x975a34(0x1cf)](_0x1e3eba[_0x975a34(0x1f1)]);try{const _0x44af8c=await warehouse[_0x975a34(0x22f)]([{'$match':{'name':_0x37fb58,'room':_0x3178a0}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x3d5bf0)}},{'$group':{'_id':_0x975a34(0x1e0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x975a34(0x26a)},'bay':{'$first':_0x975a34(0x1ad)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x163b8b['status'](0xc8)[_0x975a34(0x1df)](_0x44af8c);}catch(_0x2c4cc7){_0x163b8b[_0x975a34(0x1f5)](0x194)[_0x975a34(0x1df)]({'message':_0x2c4cc7['message']});}}),module[a0_0x3976f0(0x212)]=router;