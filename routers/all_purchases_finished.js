var a0_0x160a08=a0_0x3857;(function(_0x2c602b,_0x1bfe25){var _0x462513=a0_0x3857,_0x4d5d0c=_0x2c602b();while(!![]){try{var _0x3d36a9=-parseInt(_0x462513(0x1ba))/0x1*(-parseInt(_0x462513(0x18c))/0x2)+parseInt(_0x462513(0x153))/0x3*(parseInt(_0x462513(0x19c))/0x4)+parseInt(_0x462513(0x15e))/0x5*(parseInt(_0x462513(0x17a))/0x6)+parseInt(_0x462513(0x142))/0x7*(parseInt(_0x462513(0x216))/0x8)+-parseInt(_0x462513(0x204))/0x9+parseInt(_0x462513(0x222))/0xa*(-parseInt(_0x462513(0x1e6))/0xb)+parseInt(_0x462513(0x16f))/0xc*(-parseInt(_0x462513(0x225))/0xd);if(_0x3d36a9===_0x1bfe25)break;else _0x4d5d0c['push'](_0x4d5d0c['shift']());}catch(_0x162fe1){_0x4d5d0c['push'](_0x4d5d0c['shift']());}}}(a0_0x2e63,0xa74bc));const express=require(a0_0x160a08(0x149)),app=express(),router=express[a0_0x160a08(0x163)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x160a08(0x1ff)),auth=require(a0_0x160a08(0x1a6)),nodemailer=require('nodemailer');var ejs=require(a0_0x160a08(0x1b5));function a0_0x2e63(){var _0x6a6f98=['secondary_code','payment\x20successfull','primary_code_hide','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','/view/:id','product_cat','RoomAssign','get','Enclosed','<html><head><title></title>','return_product','/all_purchases_finished/view','\x20<>\x20','prod_level','log','</tr>','23155ahQYuw','An\x20error\x20occurred.','forEach','expiry_date','$maxStocks','$warehouse_name','$primary_code','$return_data','<!DOCTYPE\x20html>','$note','</span>','render','abs','level','INCF-','logo','Arabic\x20(ae)','exports','/give_payment/:id','return_purchase_finished','note','$_id','return_data','</thead>','<tr>','../models/all_models','status','Error\x20Occurs','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','floor','2394414jeQQuU','product_code','<h2>\x20','then','prod_code','$product','$secondary_code','product_stock','/view/add_purchases/:id','port','$product_details','</head><body>','Chinese','Logo.png','Paid\x20For\x20Purchase','$maxProdPerUnit','password','map','8gYmjlA','user','name','standard_unit','<div>','suppliers_docs','<h5>','gmail','maxperunit','post','DRY\x20GOODS','currency','1220djZRRG','json','/../public','25818221PHtqkh','paid_amount','findOne','user_id','$unit','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','date','padStart','product_code_hide','Purchase\x20Return\x20Mail','max_product_unit','/view/return_purchase/:id','product_name','createTransport','Hindi','$product_details.rack','purchase_quantity','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','return_qty','currency_placement','$brand','\x20</h2>','prod_primunit','$product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Return\x20Goods','secondary_code_hide','room_name','Purchase\x20Mail','$product_details.maxProducts','purchase_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product.quantity','staff','batch_code','Room_name','concat','Purchase\x20Return','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','suppliers','quantity','warehouse_name','5056765QQHlwB','FGSEmail','Finished\x20Goods','$product_details.secondary_code','bay','True','$room','express','prod_name','all_purchases_finished','errors','aggregate','\x20Order\x20Date\x20:\x20','$product_details._id','$product_details.product_code','/view/add_purchases','prod_cat','1068126ooFTZK','find','$product.bin','image','Arabic','primary_code','length','room','edit_purchases_finished_view','params','site_title','6770035CwIeHg','secondary_unit','$name','/barcode_scanner','purchase\x20data\x20add\x20successfully','Router','An\x20error\x20occurred\x20while\x20saving\x20data.','table\x20page','product_date','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','toString','$due_amount','$product_details.product_stock','stock_data','findById','</h5>','12whKzcs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','</td>','French','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','back','Spanish','stock_quantity','success','$product_code','Rack\x201','6nsFGgj','updateOne','\x20Order\x20Number\x20:\x20','POnumber','flash','$secondary_unit','product_details','string','getFullYear','QA\x20Warehouse','$invoice','<tbody\x20style=\x22text-align:\x20center;\x22>','Portuguese','$paid_amount','production_date','MaxStocks_data','English','add_purchases\x20error','1406ARAGbp','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/upload/','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<strong>\x20Regards\x20</strong>','$suppliers','path','prod_qty','FROZEN\x20GOODS','redirect','</body></html>','add_purchases_finished','<table\x20style=\x22width:\x20100%\x20!important;\x22>','error','Email\x20sent\x20successfully','8oDHztf','all','maxStocks','body','</table>','master','$suppliers_docs','$product_details.primary_code','invoice','save','../middleware/auth','$product.type','message','all_purchases_barcode','../public/language/languages.json','stocks','Enabled','getMonth','purchases\x20item\x20return\x20successfull','$batch_code','<h5\x20style=\x22text-align:\x20left;\x22>','getDate','Rack\x202','<span\x20style=\x22float:\x20right;\x22>','prod_Qty','ejs','host','</div>','role','filter','577GJEyKJ','$product.floorlevel','$product_details.product_name','slice','purchase\x20data\x20update\x20successfully','warehouse','$product_details.floorlevel','/view','_id','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product','prod_unit','German','JO_number','$alertquantity','</tbody>','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/preview/:id','Ambient','$category','<hr\x20class=\x22my-3\x22>','$date','due_amount','sendMail','catch'];a0_0x2e63=function(){return _0x6a6f98;};return a0_0x2e63();}const path=require(a0_0x160a08(0x193)),users=require(a0_0x160a08(0x1aa));router['get'](a0_0x160a08(0x1c1),auth,async(_0x2ebdf3,_0x3f55d2)=>{var _0x23bc64=a0_0x160a08;try{const {username:_0x3ec53b,email:_0x4094e9,role:_0x30aaee}=_0x2ebdf3[_0x23bc64(0x217)],_0x5238b4=_0x2ebdf3[_0x23bc64(0x217)],_0x3013d9=await profile['findOne']({'email':_0x5238b4[_0x23bc64(0x1ca)]}),_0x3dc97e=await staff[_0x23bc64(0x227)]({'email':_0x5238b4[_0x23bc64(0x1ca)]});if(_0x5238b4[_0x23bc64(0x1b8)]==_0x23bc64(0x139)){const _0x420f10=await staff[_0x23bc64(0x227)]({'email':_0x5238b4[_0x23bc64(0x1ca)]});}const _0xb76476=await master_shop[_0x23bc64(0x154)]();let _0x23fec9;if(_0x5238b4['role']==_0x23bc64(0x139)){const _0x2f4187=await staff[_0x23bc64(0x227)]({'email':_0x5238b4[_0x23bc64(0x1ca)]});_0x23fec9=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x2f4187[_0x23bc64(0x1bf)]}},{'$lookup':{'from':_0x23bc64(0x13f),'localField':_0x23bc64(0x13f),'foreignField':_0x23bc64(0x218),'as':_0x23bc64(0x21b)}},{'$unwind':_0x23bc64(0x1a2)},{'$unwind':_0x23bc64(0x209)},{'$group':{'_id':'$_id','invoice':{'$first':_0x23bc64(0x184)},'suppliers':{'$first':_0x23bc64(0x192)},'date':{'$first':_0x23bc64(0x1d2)},'warehouse_name':{'$first':_0x23bc64(0x1eb)},'room':{'$first':_0x23bc64(0x148)},'product':{'$push':_0x23bc64(0x209)},'note':{'$first':_0x23bc64(0x1ef)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x23bc64(0x16a)},'return_data':{'$first':_0x23bc64(0x1ed)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x23bc64(0x1a2)},'total_product_quantity':{'$sum':_0x23bc64(0x138)},'level':{'$addToSet':_0x23bc64(0x12f)},'isle':{'$addToSet':_0x23bc64(0x155)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x23bc64(0x1bb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x23fec9=await purchases_finished[_0x23bc64(0x14d)]([{'$unwind':_0x23bc64(0x209)},{'$group':{'_id':'$_id','invoice':{'$first':_0x23bc64(0x184)},'suppliers':{'$first':_0x23bc64(0x192)},'date':{'$first':_0x23bc64(0x1d2)},'warehouse_name':{'$first':_0x23bc64(0x1eb)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x23bc64(0x209)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x23bc64(0x187)},'due_amount':{'$first':_0x23bc64(0x16a)},'return_data':{'$first':_0x23bc64(0x1ed)},'batch_code':{'$first':_0x23bc64(0x1af)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x23bc64(0x138)},'level':{'$addToSet':_0x23bc64(0x12f)},'isle':{'$addToSet':_0x23bc64(0x155)},'type':{'$addToSet':_0x23bc64(0x1a7)},'floorlevel':{'$addToSet':_0x23bc64(0x1bb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xb76476[0x0][_0x23bc64(0x22a)]==_0x23bc64(0x18f))var _0x5ee582=users['English'];else{if(_0xb76476[0x0][_0x23bc64(0x22a)]==_0x23bc64(0x234))var _0x5ee582=users[_0x23bc64(0x234)];else{if(_0xb76476[0x0][_0x23bc64(0x22a)]==_0x23bc64(0x1c6))var _0x5ee582=users[_0x23bc64(0x1c6)];else{if(_0xb76476[0x0][_0x23bc64(0x22a)]=='Spanish')var _0x5ee582=users[_0x23bc64(0x175)];else{if(_0xb76476[0x0][_0x23bc64(0x22a)]=='French')var _0x5ee582=users[_0x23bc64(0x172)];else{if(_0xb76476[0x0][_0x23bc64(0x22a)]==_0x23bc64(0x237))var _0x5ee582=users['Portuguese'];else{if(_0xb76476[0x0]['language']=='Chinese')var _0x5ee582=users[_0x23bc64(0x210)];else{if(_0xb76476[0x0]['language']==_0x23bc64(0x1f6))var _0x5ee582=users['Arabic'];}}}}}}}_0x3f55d2[_0x23bc64(0x1f1)](_0x23bc64(0x14b),{'success':_0x2ebdf3[_0x23bc64(0x17e)]('success'),'errors':_0x2ebdf3[_0x23bc64(0x17e)](_0x23bc64(0x14c)),'purchases':_0x23fec9,'role':_0x5238b4,'profile':_0x3013d9,'master_shop':_0xb76476,'language':_0x5ee582});}catch(_0x1a9049){console[_0x23bc64(0x1e4)](_0x23bc64(0x165),_0x1a9049),_0x3f55d2[_0x23bc64(0x200)](0xc8)[_0x23bc64(0x223)]({'message':_0x1a9049[_0x23bc64(0x1a8)]});}});function a0_0x3857(_0x288d80,_0xda5683){var _0x2e63d0=a0_0x2e63();return a0_0x3857=function(_0x385724,_0x3b0a5a){_0x385724=_0x385724-0x12a;var _0x1553fc=_0x2e63d0[_0x385724];return _0x1553fc;},a0_0x3857(_0x288d80,_0xda5683);}function BayBinSelected(_0x4fb58a,_0x45e336){var _0x24d3d9=a0_0x160a08,_0x5c2312=[],_0x1255ea=[];if(_0x4fb58a==_0x24d3d9(0x220)){switch(_0x45e336){case _0x24d3d9(0x179):_0x5c2312=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x24d3d9(0x1b2):_0x5c2312=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1255ea=['DG'];}else{if(_0x4fb58a==_0x24d3d9(0x195)){switch(_0x45e336){case _0x24d3d9(0x179):_0x5c2312=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x5c2312=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1255ea=['FG'];}}return{'levels':_0x5c2312,'identify':_0x1255ea};}async function getRandom8DigitNumber(){var _0x182e58=a0_0x160a08;const _0x132991=0x989680,_0xf38f8=0x5f5e0ff,_0x5503b5=Math[_0x182e58(0x203)](Math['random']()*(_0xf38f8-_0x132991+0x1))+_0x132991;var _0x19597c;const _0x4cc5c2=await purchases_finished[_0x182e58(0x227)]({'invoice':_0x182e58(0x1f4)+_0x5503b5});return _0x4cc5c2&&_0x4cc5c2[_0x182e58(0x159)]>0x0?_0x19597c=_0x182e58(0x1f4)+_0x5503b5:_0x19597c=_0x182e58(0x1f4)+_0x5503b5,_0x19597c;}router[a0_0x160a08(0x1dd)]('/view/add_purchases',auth,async(_0xf26f93,_0x6b3dbf)=>{var _0x35e9c8=a0_0x160a08;try{const {username:_0x545348,email:_0x226eaf,role:_0x361abe}=_0xf26f93[_0x35e9c8(0x217)],_0x1a965f=_0xf26f93[_0x35e9c8(0x217)],_0x54d451=await profile[_0x35e9c8(0x227)]({'email':_0x1a965f['email']}),_0x5b5341=await master_shop[_0x35e9c8(0x154)](),_0x40fbe2=await staff[_0x35e9c8(0x227)]({'email':_0x1a965f[_0x35e9c8(0x1ca)]}),_0x5f01d8=await suppliers[_0x35e9c8(0x154)]({});let _0x48e526;if(_0x1a965f[_0x35e9c8(0x1b8)]==_0x35e9c8(0x139)){const _0x4b6beb=await staff[_0x35e9c8(0x227)]({'email':_0x1a965f[_0x35e9c8(0x1ca)]});_0x48e526=await warehouse[_0x35e9c8(0x14d)]([{'$match':{'status':_0x35e9c8(0x1ac),'name':_0x4b6beb[_0x35e9c8(0x1bf)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x35e9c8(0x160),'name':{'$first':_0x35e9c8(0x160)}}}]);}else _0x48e526=await warehouse[_0x35e9c8(0x14d)]([{'$match':{'status':'Enabled','warehouse_category':_0x35e9c8(0x144),'name':{'$ne':_0x35e9c8(0x183)}}},{'$group':{'_id':_0x35e9c8(0x160),'name':{'$first':_0x35e9c8(0x160)}}}]);const _0x505929=await product[_0x35e9c8(0x154)]({}),_0x3ce83b=await warehouse[_0x35e9c8(0x154)]({'status':_0x35e9c8(0x1ac)}),_0x492964=await purchases_finished['find']({}),_0x19bb13=_0x492964[_0x35e9c8(0x159)]+0x1,_0x14ab8e=_0x35e9c8(0x1f4)+_0x19bb13[_0x35e9c8(0x169)]()[_0x35e9c8(0x22d)](0x5,'0');var _0x1f0f62=[_0x35e9c8(0x1cf),_0x35e9c8(0x1de)];if(_0x5b5341[0x0]['language']==_0x35e9c8(0x18f))var _0x37978a=users[_0x35e9c8(0x18a)];else{if(_0x5b5341[0x0]['language']=='Hindi')var _0x37978a=users[_0x35e9c8(0x234)];else{if(_0x5b5341[0x0][_0x35e9c8(0x22a)]==_0x35e9c8(0x1c6))var _0x37978a=users[_0x35e9c8(0x1c6)];else{if(_0x5b5341[0x0][_0x35e9c8(0x22a)]==_0x35e9c8(0x175))var _0x37978a=users[_0x35e9c8(0x175)];else{if(_0x5b5341[0x0][_0x35e9c8(0x22a)]==_0x35e9c8(0x172))var _0x37978a=users[_0x35e9c8(0x172)];else{if(_0x5b5341[0x0][_0x35e9c8(0x22a)]==_0x35e9c8(0x237))var _0x37978a=users['Portuguese'];else{if(_0x5b5341[0x0]['language']==_0x35e9c8(0x210))var _0x37978a=users[_0x35e9c8(0x210)];else{if(_0x5b5341[0x0][_0x35e9c8(0x22a)]==_0x35e9c8(0x1f6))var _0x37978a=users[_0x35e9c8(0x157)];}}}}}}}const _0x3ce9f2=getRandom8DigitNumber();_0x3ce9f2[_0x35e9c8(0x207)](_0xd027f9=>{var _0x2e1793=_0x35e9c8;_0x6b3dbf[_0x2e1793(0x1f1)](_0x2e1793(0x198),{'success':_0xf26f93['flash'](_0x2e1793(0x177)),'errors':_0xf26f93[_0x2e1793(0x17e)](_0x2e1793(0x14c)),'role':_0x1a965f,'profile':_0x54d451,'suppliers':_0x5f01d8,'warehouse':_0x48e526,'product':_0x505929,'invoice':_0xd027f9,'master_shop':_0x5b5341,'language':_0x37978a,'find_data':_0x3ce83b,'rooms_data':_0x1f0f62});})['catch'](_0x5a248a=>{var _0x5d6816=_0x35e9c8;_0xf26f93[_0x5d6816(0x17e)](_0x5d6816(0x14c),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x6b3dbf[_0x5d6816(0x196)]('/all_purchases_finished/view');});}catch(_0x2ea7e3){console[_0x35e9c8(0x1e4)](_0x2ea7e3);}}),router[a0_0x160a08(0x1dd)](a0_0x160a08(0x20c),auth,async(_0xf6de2f,_0x57f190)=>{var _0xae9bed=a0_0x160a08;try{const _0x23db52=_0xf6de2f[_0xae9bed(0x15c)]['id'];console[_0xae9bed(0x1e4)](_0x23db52);const _0x543b95=await master_shop[_0xae9bed(0x154)]();console[_0xae9bed(0x1e4)]('master',_0x543b95);const _0x31e205=await product[_0xae9bed(0x227)]({'name':_0x23db52});console['log'](_0xae9bed(0x1c4),_0x31e205),_0x57f190[_0xae9bed(0x200)](0xc8)[_0xae9bed(0x223)]({'product_data':_0x31e205,'master':_0x543b95});}catch(_0x54ad16){console[_0xae9bed(0x1e4)](_0xae9bed(0x18b),_0x54ad16);}}),router[a0_0x160a08(0x21f)](a0_0x160a08(0x151),auth,async(_0x162974,_0x4dd068)=>{var _0x2f816d=a0_0x160a08;try{const {invoice:_0x33ccc9,date:_0x10c718,warehouse_name:_0x39d865,prod_name:_0x262376,prod_code:_0x1bc691,prod_qty:_0x4a0f07,prod_unit:_0x327750,prod_secondunit:_0x6c9ba9,prod_level:_0x25e13b,prod_isle:_0x4e4f6,prod_pallet:_0x406a98,note:_0x5dc9e2,expiry_date:_0x23be0a,batch_code:_0x63e7d4,payable:_0x2102dc,due_amount:_0x2df6cf,Room_name:_0x5e0bb3,primary_code:_0x27c4cd,secondary_code:_0x33a191,MaxStocks_data:_0x48b73d,PO_number:_0x2e21f9,SCRN:_0x593a38,JO_number:_0x222141}=_0x162974[_0x2f816d(0x19f)];if(typeof _0x262376==_0x2f816d(0x181))var _0x5668cb=[_0x162974[_0x2f816d(0x19f)][_0x2f816d(0x14a)]],_0x11a8c9=[_0x162974[_0x2f816d(0x19f)][_0x2f816d(0x208)]],_0x29df65=[_0x162974[_0x2f816d(0x19f)][_0x2f816d(0x1b4)]],_0x4a36e8=[_0x162974[_0x2f816d(0x19f)][_0x2f816d(0x12e)]],_0xe2a594=[_0x162974[_0x2f816d(0x19f)]['prod_secondunit']],_0x18ec31=[_0x162974['body'][_0x2f816d(0x1e3)]],_0x3c44e0=[_0x162974[_0x2f816d(0x19f)]['primary_code']],_0x1d7a87=[_0x162974['body'][_0x2f816d(0x1d6)]],_0x19b302=[_0x162974['body']['MaxStocks_data']],_0x1c80d7=[_0x162974[_0x2f816d(0x19f)][_0x2f816d(0x13a)]],_0x53cb05=[_0x162974['body'][_0x2f816d(0x1e9)]],_0x5685d5=[_0x162974[_0x2f816d(0x19f)][_0x2f816d(0x166)]],_0x535591=[_0x162974['body'][_0x2f816d(0x230)]],_0x158f0e=[_0x162974[_0x2f816d(0x19f)][_0x2f816d(0x152)]],_0x59cdea=[_0x162974[_0x2f816d(0x19f)][_0x2f816d(0x1dc)]],_0x30a8a9=[_0x162974[_0x2f816d(0x19f)]['prod_invoice']];else var _0x5668cb=[..._0x162974['body'][_0x2f816d(0x14a)]],_0x11a8c9=[..._0x162974[_0x2f816d(0x19f)]['prod_code']],_0x29df65=[..._0x162974[_0x2f816d(0x19f)]['prod_Qty']],_0x4a36e8=[..._0x162974['body']['prod_primunit']],_0xe2a594=[..._0x162974[_0x2f816d(0x19f)][_0x2f816d(0x167)]],_0x18ec31=[..._0x162974[_0x2f816d(0x19f)]['prod_level']],_0x3c44e0=[..._0x162974[_0x2f816d(0x19f)][_0x2f816d(0x158)]],_0x1d7a87=[..._0x162974[_0x2f816d(0x19f)][_0x2f816d(0x1d6)]],_0x19b302=[..._0x162974['body']['MaxStocks_data']],_0x1c80d7=[..._0x162974[_0x2f816d(0x19f)][_0x2f816d(0x13a)]],_0x53cb05=[..._0x162974[_0x2f816d(0x19f)]['expiry_date']],_0x5685d5=[..._0x162974['body'][_0x2f816d(0x166)]],_0x535591=[..._0x162974[_0x2f816d(0x19f)]['max_product_unit']],_0x158f0e=[..._0x162974[_0x2f816d(0x19f)]['prod_cat']],_0x59cdea=[..._0x162974[_0x2f816d(0x19f)][_0x2f816d(0x1dc)]],_0x30a8a9=[..._0x162974['body'][_0x2f816d(0x1cc)]];const _0x2fa0f9=_0x5668cb[_0x2f816d(0x215)](_0x4b9dba=>{return _0x4b9dba={'product_name':_0x4b9dba};});_0x11a8c9[_0x2f816d(0x1e8)]((_0x20f13a,_0x8fce74)=>{var _0x2b4d7b=_0x2f816d;_0x2fa0f9[_0x8fce74][_0x2b4d7b(0x205)]=_0x20f13a;}),_0x29df65[_0x2f816d(0x1e8)]((_0xfa6604,_0x4403a2)=>{var _0x4934c8=_0x2f816d;_0x2fa0f9[_0x4403a2][_0x4934c8(0x140)]=Math[_0x4934c8(0x1f2)](_0xfa6604);}),_0x4a36e8['forEach']((_0x4a7b40,_0x5d3dc9)=>{var _0x5edb9b=_0x2f816d;_0x2fa0f9[_0x5d3dc9][_0x5edb9b(0x219)]=_0x4a7b40;}),_0xe2a594[_0x2f816d(0x1e8)]((_0x4515eb,_0x161b14)=>{var _0x362c0c=_0x2f816d;_0x2fa0f9[_0x161b14][_0x362c0c(0x15f)]=_0x4515eb;}),_0x18ec31[_0x2f816d(0x1e8)]((_0x585fd9,_0x1af718)=>{var _0x2660a1=_0x2f816d;_0x2fa0f9[_0x1af718][_0x2660a1(0x146)]=_0x585fd9;}),_0x3c44e0['forEach']((_0x5e0bb6,_0x26fdc5)=>{_0x2fa0f9[_0x26fdc5]['primary_code']=_0x5e0bb6;}),_0x1d7a87[_0x2f816d(0x1e8)]((_0x31a2a1,_0xd257a4)=>{_0x2fa0f9[_0xd257a4]['secondary_code']=_0x31a2a1;}),_0x19b302['forEach']((_0x459164,_0x1788ae)=>{var _0x127380=_0x2f816d;_0x2fa0f9[_0x1788ae][_0x127380(0x19e)]=_0x459164;}),_0x1c80d7[_0x2f816d(0x1e8)]((_0x25d7b3,_0x508bc4)=>{var _0x565836=_0x2f816d;_0x2fa0f9[_0x508bc4][_0x565836(0x13a)]=_0x25d7b3;}),_0x53cb05[_0x2f816d(0x1e8)]((_0x3dd148,_0x4f9630)=>{var _0x5c8472=_0x2f816d;_0x2fa0f9[_0x4f9630][_0x5c8472(0x1e9)]=_0x3dd148;}),_0x5685d5['forEach']((_0x4ee64d,_0xd93401)=>{var _0x12e953=_0x2f816d;_0x2fa0f9[_0xd93401][_0x12e953(0x188)]=_0x4ee64d;}),_0x535591[_0x2f816d(0x1e8)]((_0x11ee30,_0x4d57d5)=>{var _0x23f77f=_0x2f816d;_0x2fa0f9[_0x4d57d5][_0x23f77f(0x21e)]=_0x11ee30;}),_0x158f0e[_0x2f816d(0x1e8)]((_0x189b40,_0x594518)=>{var _0x14b8d0=_0x2f816d;_0x2fa0f9[_0x594518][_0x14b8d0(0x1db)]=_0x189b40;}),_0x59cdea['forEach']((_0x1154a0,_0x847d2a)=>{var _0x1de5f0=_0x2f816d;_0x2fa0f9[_0x847d2a][_0x1de5f0(0x133)]=_0x1154a0;}),_0x30a8a9['forEach']((_0x101257,_0xc31098)=>{_0x2fa0f9[_0xc31098]['invoice']=_0x101257;});const _0x4af3bf=_0x2fa0f9[_0x2f816d(0x1b9)](_0x29e599=>_0x29e599[_0x2f816d(0x140)]!=='0'&&_0x29e599['quantity']!==''),_0x1bb289=new purchases_finished({'invoice':_0x33ccc9,'suppliers':_0x162974[_0x2f816d(0x19f)][_0x2f816d(0x13f)],'date':_0x10c718,'warehouse_name':_0x39d865,'product':_0x4af3bf,'note':_0x5dc9e2,'due_amount':_0x2df6cf,'room':_0x5e0bb3,'POnumber':_0x2e21f9,'SCRN':_0x593a38,'JO_number':_0x222141}),_0x47a4be=await _0x1bb289['save'](),_0x29e717=await purchases_finished[_0x2f816d(0x227)]({'invoice':_0x33ccc9}),_0x2156e6=_0x29e717[_0x2f816d(0x1c4)][_0x2f816d(0x215)](async _0xe8f7c9=>{var _0x581a66=_0x2f816d,_0xd74511=await warehouse[_0x581a66(0x227)]({'name':_0x39d865,'room':_0xe8f7c9[_0x581a66(0x133)]}),_0x6f091=0x0;const _0x4910db=_0xd74511[_0x581a66(0x180)]['map'](_0x2423c5=>{var _0x40fb14=_0x581a66;console['log'](_0x2423c5[_0x40fb14(0x232)]+'=='+_0xe8f7c9[_0x40fb14(0x232)]+'&&'+_0x2423c5[_0x40fb14(0x146)]+'=='+_0xe8f7c9[_0x40fb14(0x146)]+'&&'+_0x2423c5['expiry_date']+'=='+_0xe8f7c9[_0x40fb14(0x1e9)]+'&&'+_0x2423c5[_0x40fb14(0x188)]+'=='+_0xe8f7c9[_0x40fb14(0x188)]+'&&'+_0x2423c5[_0x40fb14(0x13a)]+'=='+_0xe8f7c9[_0x40fb14(0x13a)]+'&&'+_0x2423c5[_0x40fb14(0x1a4)]+'=='+_0x29e717[_0x40fb14(0x1a4)]),_0x2423c5[_0x40fb14(0x232)]==_0xe8f7c9[_0x40fb14(0x232)]&&_0x2423c5['bay']==_0xe8f7c9[_0x40fb14(0x146)]&&_0x2423c5[_0x40fb14(0x1e9)]==_0xe8f7c9[_0x40fb14(0x1e9)]&&_0x2423c5[_0x40fb14(0x188)]==_0xe8f7c9[_0x40fb14(0x188)]&&_0x2423c5[_0x40fb14(0x13a)]==_0xe8f7c9[_0x40fb14(0x13a)]&&_0x2423c5[_0x40fb14(0x1a4)]==_0x29e717[_0x40fb14(0x1a4)]&&(_0x2423c5[_0x40fb14(0x20b)]=Math['abs'](_0x2423c5[_0x40fb14(0x20b)])+Math[_0x40fb14(0x1f2)](_0xe8f7c9['quantity']),_0x6f091++);});return _0x6f091=='0'&&(_0xd74511[_0x581a66(0x180)]=_0xd74511[_0x581a66(0x180)][_0x581a66(0x13c)]({'product_name':_0xe8f7c9[_0x581a66(0x232)],'product_stock':Math[_0x581a66(0x1f2)](_0xe8f7c9['quantity']),'primary_code':_0xe8f7c9[_0x581a66(0x158)],'secondary_code':_0xe8f7c9['secondary_code'],'product_code':_0xe8f7c9[_0x581a66(0x205)],'bay':_0xe8f7c9[_0x581a66(0x146)],'maxProducts':_0xe8f7c9[_0x581a66(0x19e)],'unit':_0xe8f7c9[_0x581a66(0x219)],'secondary_unit':_0xe8f7c9[_0x581a66(0x15f)],'expiry_date':_0xe8f7c9[_0x581a66(0x1e9)],'production_date':_0xe8f7c9[_0x581a66(0x188)],'maxProducts':_0xe8f7c9['maxStocks'],'maxPerUnit':_0xe8f7c9[_0x581a66(0x21e)],'batch_code':_0xe8f7c9[_0x581a66(0x13a)],'product_cat':_0xe8f7c9[_0x581a66(0x1db)],'invoice':_0xe8f7c9[_0x581a66(0x1a4)]})),_0xd74511;});Promise[_0x2f816d(0x19d)](_0x2156e6)[_0x2f816d(0x207)](async _0x51f7cc=>{var _0x428c18=_0x2f816d;try{for(const _0x1c11d3 of _0x51f7cc){await warehouse[_0x428c18(0x17b)]({'_id':_0x1c11d3[_0x428c18(0x1c2)]},{'$addToSet':{'product_details':{'$each':_0x1c11d3['product_details']}}});}const _0x290c34=await master_shop[_0x428c18(0x154)](),_0xc3eecd=await email_settings[_0x428c18(0x227)](),_0x588a97=await supervisor_settings['find']();var _0x1e8080=_0x29e717[_0x428c18(0x1c4)],_0x587231='',_0x18d6d2;for(_0x18d6d2 in _0x1e8080){var _0x5f3a7e='FG';_0x29e717['warehouse_name']=='DRY\x20GOODS'&&(_0x5f3a7e='DG'),_0x587231+='<tr>'+_0x428c18(0x1c3)+_0x1e8080[_0x18d6d2]['product_name']+_0x428c18(0x171)+_0x428c18(0x1c3)+_0x1e8080[_0x18d6d2][_0x428c18(0x205)]+'</td>'+_0x428c18(0x1c3)+_0x1e8080[_0x18d6d2][_0x428c18(0x140)]+_0x428c18(0x171)+_0x428c18(0x1c3)+_0x1e8080[_0x18d6d2]['standard_unit']+_0x428c18(0x171)+_0x428c18(0x1c3)+_0x1e8080[_0x18d6d2]['secondary_unit']+_0x428c18(0x171)+_0x428c18(0x1c3)+_0x29e717['warehouse_name']+_0x428c18(0x171)+_0x428c18(0x1c3)+_0x1e8080[_0x18d6d2][_0x428c18(0x133)]+_0x428c18(0x171)+_0x428c18(0x1c3)+_0x5f3a7e+_0x1e8080[_0x18d6d2][_0x428c18(0x146)]+'</td>',_0x428c18(0x1e5);}let _0x4217f8=nodemailer[_0x428c18(0x233)]({'host':_0xc3eecd[_0x428c18(0x1b6)],'port':Number(_0xc3eecd[_0x428c18(0x20d)]),'secure':![],'auth':{'user':_0xc3eecd[_0x428c18(0x1ca)],'pass':_0xc3eecd[_0x428c18(0x214)]}}),_0xe05947={'from':_0xc3eecd[_0x428c18(0x1ca)],'to':_0x588a97[0x0][_0x428c18(0x143)],'subject':_0x428c18(0x134),'attachments':[{'filename':_0x428c18(0x211),'path':__dirname+_0x428c18(0x224)+_0x428c18(0x18e)+_0x290c34[0x0][_0x428c18(0x156)],'cid':_0x428c18(0x1f5)}],'html':_0x428c18(0x1ee)+_0x428c18(0x1df)+_0x428c18(0x20f)+'<div>'+_0x428c18(0x202)+_0x428c18(0x21a)+_0x428c18(0x18d)+_0x428c18(0x1b7)+_0x428c18(0x21a)+_0x428c18(0x206)+_0x290c34[0x0]['site_title']+_0x428c18(0x12d)+_0x428c18(0x1b7)+_0x428c18(0x1b7)+_0x428c18(0x1d1)+_0x428c18(0x21a)+_0x428c18(0x1b0)+_0x428c18(0x17c)+_0x29e717[_0x428c18(0x1a4)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x428c18(0x14e)+_0x29e717[_0x428c18(0x22c)]+'\x20'+'</span>'+_0x428c18(0x16e)+_0x428c18(0x1b7)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x428c18(0x13e)+_0x428c18(0x1fe)+_0x428c18(0x173)+_0x428c18(0x238)+_0x428c18(0x130)+_0x428c18(0x168)+_0x428c18(0x190)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x428c18(0x1cb)+_0x428c18(0x22b)+_0x428c18(0x1e5)+_0x428c18(0x1fd)+_0x428c18(0x185)+'\x20'+_0x587231+'\x20'+_0x428c18(0x1c9)+_0x428c18(0x1a0)+_0x428c18(0x21a)+_0x428c18(0x191)+_0x428c18(0x21c)+_0x290c34[0x0][_0x428c18(0x15d)]+_0x428c18(0x16e)+_0x428c18(0x1b7)+_0x428c18(0x1b7)+_0x428c18(0x197)};_0x4217f8['sendMail'](_0xe05947,function(_0x3f7c86,_0x31a871){var _0x435a7e=_0x428c18;_0x3f7c86?(console[_0x435a7e(0x1e4)](_0x3f7c86),console[_0x435a7e(0x1e4)](_0x435a7e(0x201))):console['log'](_0x435a7e(0x19b));});}catch(_0x4c1b98){console[_0x428c18(0x19a)](_0x4c1b98),_0x4dd068[_0x428c18(0x200)](0x1f4)[_0x428c18(0x223)]({'error':_0x428c18(0x164),'message':_0x4c1b98[_0x428c18(0x1a8)]});}})[_0x2f816d(0x1d5)](_0x2ea6d5=>{var _0x105a49=_0x2f816d;console[_0x105a49(0x19a)](_0x2ea6d5),_0x4dd068[_0x105a49(0x200)](0x1f4)[_0x105a49(0x223)]({'error':_0x105a49(0x1e7)});}),_0x162974[_0x2f816d(0x17e)](_0x2f816d(0x177),_0x2f816d(0x162)),_0x4dd068[_0x2f816d(0x196)](_0x2f816d(0x1e1));}catch(_0x402ca1){console[_0x2f816d(0x1e4)](_0x402ca1);}}),router[a0_0x160a08(0x1dd)](a0_0x160a08(0x1ce),auth,async(_0x3e2ded,_0x255c54)=>{var _0x1690e4=a0_0x160a08;try{const {username:_0x513a97,email:_0x35f0a0,role:_0x12a19e}=_0x3e2ded[_0x1690e4(0x217)],_0x384bdd=_0x3e2ded[_0x1690e4(0x217)],_0xcd44d0=await profile['findOne']({'email':_0x384bdd['email']}),_0x594dcc=await master_shop[_0x1690e4(0x154)](),_0x16c1d3=_0x3e2ded[_0x1690e4(0x15c)]['id'],_0x442fa8=await purchases_finished['findById'](_0x16c1d3),_0x25ae61=await suppliers[_0x1690e4(0x154)]({});let _0x154a2c;if(_0x384bdd[_0x1690e4(0x1b8)]==_0x1690e4(0x139)){const _0x40aa65=await staff[_0x1690e4(0x227)]({'email':_0x384bdd[_0x1690e4(0x1ca)]});_0x154a2c=await warehouse[_0x1690e4(0x154)]({'status':_0x1690e4(0x1ac),'name':_0x40aa65[_0x1690e4(0x1bf)],'warehouse_category':_0x1690e4(0x144)});}else _0x154a2c=await warehouse['aggregate']([{'$match':{'status':_0x1690e4(0x1ac),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x1690e4(0x160),'name':{'$first':_0x1690e4(0x160)}}}]);const _0x1be5d6=await product[_0x1690e4(0x154)]({}),_0xe65999=BayBinSelected(_0x442fa8[_0x1690e4(0x141)],_0x442fa8['room']);let _0x1d061b=new Date(_0x442fa8[_0x1690e4(0x1e9)]),_0x3599ae=('0'+_0x1d061b[_0x1690e4(0x1b1)]())['slice'](-0x2),_0x2115ae=('0'+(_0x1d061b[_0x1690e4(0x1ad)]()+0x1))[_0x1690e4(0x1bd)](-0x2),_0x5ca2f1=_0x1d061b['getFullYear'](),_0x3802e3=_0x5ca2f1+'-'+_0x2115ae+'-'+_0x3599ae;if(_0x594dcc[0x0][_0x1690e4(0x22a)]==_0x1690e4(0x18f)){var _0x5a9b4a=users[_0x1690e4(0x18a)];console[_0x1690e4(0x1e4)](_0x5a9b4a);}else{if(_0x594dcc[0x0][_0x1690e4(0x22a)]==_0x1690e4(0x234))var _0x5a9b4a=users[_0x1690e4(0x234)];else{if(_0x594dcc[0x0]['language']==_0x1690e4(0x1c6))var _0x5a9b4a=users[_0x1690e4(0x1c6)];else{if(_0x594dcc[0x0][_0x1690e4(0x22a)]=='Spanish')var _0x5a9b4a=users[_0x1690e4(0x175)];else{if(_0x594dcc[0x0][_0x1690e4(0x22a)]==_0x1690e4(0x172))var _0x5a9b4a=users['French'];else{if(_0x594dcc[0x0][_0x1690e4(0x22a)]==_0x1690e4(0x237))var _0x5a9b4a=users[_0x1690e4(0x186)];else{if(_0x594dcc[0x0][_0x1690e4(0x22a)]==_0x1690e4(0x210))var _0x5a9b4a=users['Chinese'];else{if(_0x594dcc[0x0][_0x1690e4(0x22a)]==_0x1690e4(0x1f6))var _0x5a9b4a=users[_0x1690e4(0x157)];}}}}}}}_0x255c54[_0x1690e4(0x1f1)](_0x1690e4(0x15b),{'success':_0x3e2ded['flash']('success'),'errors':_0x3e2ded[_0x1690e4(0x17e)](_0x1690e4(0x14c)),'role':_0x384bdd,'profile':_0xcd44d0,'purchases':_0x442fa8,'suppliers':_0x25ae61,'warehouse':_0x154a2c,'product':_0x1be5d6,'master_shop':_0x594dcc,'language':_0x5a9b4a,'ed_fullDate':_0x3802e3,'dataSelected':_0xe65999});}catch(_0x4fcb21){console[_0x1690e4(0x1e4)](_0x4fcb21);}}),router['get'](a0_0x160a08(0x1da),auth,async(_0x461fa8,_0x3d24a3)=>{var _0x2571c4=a0_0x160a08;try{const {username:_0x1bfd89,email:_0x3c59d8,role:_0x3a50d9}=_0x461fa8['user'],_0x7cb384=_0x461fa8['user'],_0x435b38=await profile[_0x2571c4(0x227)]({'email':_0x7cb384[_0x2571c4(0x1ca)]}),_0x596b8e=await master_shop[_0x2571c4(0x154)](),_0x51a3cc=_0x461fa8['params']['id'],_0x75c876=await purchases_finished[_0x2571c4(0x16d)](_0x51a3cc),_0x3badcb=await suppliers[_0x2571c4(0x154)]({});let _0x5d8f0c;if(_0x7cb384[_0x2571c4(0x1b8)]==_0x2571c4(0x139)){const _0x57a5a5=await staff[_0x2571c4(0x227)]({'email':_0x7cb384[_0x2571c4(0x1ca)]});_0x5d8f0c=await warehouse[_0x2571c4(0x154)]({'status':_0x2571c4(0x1ac),'name':_0x57a5a5[_0x2571c4(0x1bf)],'warehouse_category':_0x2571c4(0x144)});}else _0x5d8f0c=await warehouse[_0x2571c4(0x14d)]([{'$match':{'status':'Enabled','warehouse_category':_0x2571c4(0x144)}},{'$group':{'_id':_0x2571c4(0x160),'name':{'$first':_0x2571c4(0x160)}}}]);const _0x3648c6=await product[_0x2571c4(0x154)]({}),_0x51f197=BayBinSelected(_0x75c876[_0x2571c4(0x141)],_0x75c876['room']);let _0x3727f9=new Date(_0x75c876[_0x2571c4(0x1e9)]),_0x4e440b=('0'+_0x3727f9[_0x2571c4(0x1b1)]())[_0x2571c4(0x1bd)](-0x2),_0x43a193=('0'+(_0x3727f9[_0x2571c4(0x1ad)]()+0x1))[_0x2571c4(0x1bd)](-0x2),_0x7a684=_0x3727f9[_0x2571c4(0x182)](),_0x302142=_0x7a684+'-'+_0x43a193+'-'+_0x4e440b;if(_0x596b8e[0x0][_0x2571c4(0x22a)]==_0x2571c4(0x18f)){var _0x133c95=users[_0x2571c4(0x18a)];console[_0x2571c4(0x1e4)](_0x133c95);}else{if(_0x596b8e[0x0][_0x2571c4(0x22a)]==_0x2571c4(0x234))var _0x133c95=users[_0x2571c4(0x234)];else{if(_0x596b8e[0x0][_0x2571c4(0x22a)]=='German')var _0x133c95=users['German'];else{if(_0x596b8e[0x0][_0x2571c4(0x22a)]==_0x2571c4(0x175))var _0x133c95=users[_0x2571c4(0x175)];else{if(_0x596b8e[0x0]['language']==_0x2571c4(0x172))var _0x133c95=users['French'];else{if(_0x596b8e[0x0][_0x2571c4(0x22a)]=='Portuguese\x20(BR)')var _0x133c95=users[_0x2571c4(0x186)];else{if(_0x596b8e[0x0][_0x2571c4(0x22a)]==_0x2571c4(0x210))var _0x133c95=users[_0x2571c4(0x210)];else{if(_0x596b8e[0x0][_0x2571c4(0x22a)]==_0x2571c4(0x1f6))var _0x133c95=users['Arabic'];}}}}}}}_0x3d24a3['render']('edit_purchases_finished',{'success':_0x461fa8['flash'](_0x2571c4(0x177)),'errors':_0x461fa8[_0x2571c4(0x17e)]('errors'),'role':_0x7cb384,'profile':_0x435b38,'purchases':_0x75c876,'suppliers':_0x3badcb,'warehouse':_0x5d8f0c,'product':_0x3648c6,'master_shop':_0x596b8e,'language':_0x133c95,'ed_fullDate':_0x302142,'dataSelected':_0x51f197});}catch(_0x47087e){console[_0x2571c4(0x1e4)](_0x47087e);}}),router['post'](a0_0x160a08(0x1da),auth,async(_0x10b031,_0x3763e4)=>{var _0x2876c8=a0_0x160a08;try{const _0x444834=_0x10b031[_0x2876c8(0x15c)]['id'],_0x2d2615=await purchases_finished[_0x2876c8(0x227)]({'_id':_0x10b031[_0x2876c8(0x15c)]['id']}),_0x392139=await warehouse[_0x2876c8(0x227)]({'name':_0x2d2615[_0x2876c8(0x141)],'room':_0x2d2615[_0x2876c8(0x15a)]});_0x2d2615[_0x2876c8(0x1c4)]['forEach'](_0x545e4b=>{const _0x33cf43=_0x392139['product_details']['map'](_0x461f7a=>{var _0x1e98f1=a0_0x3857;_0x461f7a[_0x1e98f1(0x232)]==_0x545e4b[_0x1e98f1(0x232)]&&_0x461f7a[_0x1e98f1(0x146)]==_0x545e4b['bay']&&(_0x461f7a['product_stock']=parseInt(_0x461f7a[_0x1e98f1(0x20b)])-parseInt(_0x545e4b[_0x1e98f1(0x140)]));});}),await _0x392139[_0x2876c8(0x1a5)]();const {invoice:_0x2cb45a,suppliers:_0x25c545,date:_0x4fa600,warehouse_name:_0x5539d5,prod_name:_0x568d5e,prod_code:_0x3e3d3c,prod_qty:_0x33b2cc,prod_unit:_0xc3e9b2,prod_secondunit:_0xe59da6,prod_level:_0x31be4f,prod_isle:_0x2b9b53,prod_pallet:_0x20b90e,note:_0x398b5f,expiry_date:_0x88e734,batch_code:_0x5727b8,paid_amount:_0x7e6b55,due_amount:_0xb47c7c,Room_name:_0x556103,primary_code:_0x2e13b7,secondary_code:_0x4227ed,PO_number:_0x351595,JO_number:_0xcf4bb1}=_0x10b031[_0x2876c8(0x19f)];if(typeof _0x568d5e=='string')var _0x34ea50=[_0x10b031['body'][_0x2876c8(0x14a)]],_0xf00b5e=[_0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x208)]],_0x2183fb=[_0x10b031['body'][_0x2876c8(0x194)]],_0x1b38d6=[_0x10b031['body']['prod_unit']],_0x52405f=[_0x10b031['body'][_0x2876c8(0x167)]],_0x386b37=[_0x10b031['body'][_0x2876c8(0x1e3)]],_0x395c03=[_0x10b031['body'][_0x2876c8(0x158)]],_0x3f7dd7=[_0x10b031[_0x2876c8(0x19f)]['secondary_code']],_0x591d87=[_0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x189)]],_0x5cda59=[_0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x13a)]],_0x5e6594=[_0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x1e9)]];else var _0x34ea50=[..._0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x14a)]],_0xf00b5e=[..._0x10b031['body']['prod_code']],_0x2183fb=[..._0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x194)]],_0x1b38d6=[..._0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x1c5)]],_0x52405f=[..._0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x167)]],_0x386b37=[..._0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x1e3)]],_0x395c03=[..._0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x158)]],_0x3f7dd7=[..._0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x1d6)]],_0x591d87=[..._0x10b031[_0x2876c8(0x19f)]['MaxStocks_data']],_0x5cda59=[..._0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x13a)]],_0x5e6594=[..._0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x1e9)]];const _0x433259=_0x34ea50[_0x2876c8(0x215)](_0x2bfc90=>{return _0x2bfc90={'product_name':_0x2bfc90};});_0xf00b5e[_0x2876c8(0x1e8)]((_0x453986,_0x4790a5)=>{var _0x3c7d30=_0x2876c8;_0x433259[_0x4790a5][_0x3c7d30(0x205)]=_0x453986;}),_0x2183fb['forEach']((_0x1a55ce,_0x2f1c7f)=>{var _0x2e2afe=_0x2876c8;_0x433259[_0x2f1c7f][_0x2e2afe(0x140)]=_0x1a55ce;}),_0x1b38d6[_0x2876c8(0x1e8)]((_0x2ff3c2,_0x4ee3d)=>{var _0x3cddc5=_0x2876c8;_0x433259[_0x4ee3d][_0x3cddc5(0x219)]=_0x2ff3c2;}),_0x52405f['forEach']((_0x328b05,_0x12cd9a)=>{_0x433259[_0x12cd9a]['secondary_unit']=_0x328b05;}),_0x386b37[_0x2876c8(0x1e8)]((_0x3a46eb,_0x225a30)=>{var _0x5d5914=_0x2876c8;_0x433259[_0x225a30][_0x5d5914(0x146)]=_0x3a46eb;}),_0x395c03[_0x2876c8(0x1e8)]((_0x1b93b2,_0xd62645)=>{var _0x4447e4=_0x2876c8;_0x433259[_0xd62645][_0x4447e4(0x158)]=_0x1b93b2;}),_0x3f7dd7[_0x2876c8(0x1e8)]((_0x56cb85,_0x4e6be2)=>{var _0x594875=_0x2876c8;_0x433259[_0x4e6be2][_0x594875(0x1d6)]=_0x56cb85;}),_0x591d87[_0x2876c8(0x1e8)]((_0xf5d0a2,_0x9d3660)=>{var _0x1b6515=_0x2876c8;_0x433259[_0x9d3660][_0x1b6515(0x19e)]=_0xf5d0a2;}),_0x5cda59[_0x2876c8(0x1e8)]((_0x305b1d,_0x1461b6)=>{var _0x4f503a=_0x2876c8;_0x433259[_0x1461b6][_0x4f503a(0x13a)]=_0x305b1d;}),_0x5e6594[_0x2876c8(0x1e8)]((_0x472549,_0x5e0c74)=>{var _0x3142d4=_0x2876c8;_0x433259[_0x5e0c74][_0x3142d4(0x1e9)]=_0x472549;});const _0x4e7695=_0x433259['filter'](_0xe10998=>_0xe10998[_0x2876c8(0x140)]!=='0'&&_0xe10998[_0x2876c8(0x140)]!=='');_0x2d2615[_0x2876c8(0x1a4)]=_0x2cb45a,_0x2d2615[_0x2876c8(0x13f)]=_0x25c545,_0x2d2615[_0x2876c8(0x22c)]=_0x4fa600,_0x2d2615[_0x2876c8(0x141)]=_0x5539d5,_0x2d2615[_0x2876c8(0x1c4)]=_0x4e7695,_0x2d2615[_0x2876c8(0x1fa)]=_0x398b5f,_0x2d2615[_0x2876c8(0x226)]=_0x7e6b55,_0x2d2615[_0x2876c8(0x1d3)]=_0xb47c7c,_0x2d2615[_0x2876c8(0x15a)]=_0x556103,_0x2d2615[_0x2876c8(0x17d)]=_0x351595,_0x2d2615[_0x2876c8(0x1c7)]=_0xcf4bb1;const _0x3b2fd7=await _0x2d2615['save'](),_0x24d463=await warehouse['findOne']({'name':_0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x141)],'room':_0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x13b)]});_0x2d2615[_0x2876c8(0x1c4)]['forEach'](_0x533d55=>{var _0x417fbb=_0x2876c8,_0x3bb7dc=0x0;const _0x342f82=_0x24d463[_0x417fbb(0x180)]['map'](_0x213a8a=>{var _0x374b4f=_0x417fbb;_0x213a8a[_0x374b4f(0x232)]==_0x533d55[_0x374b4f(0x232)]&&_0x213a8a[_0x374b4f(0x146)]==_0x533d55[_0x374b4f(0x146)]&&(_0x213a8a[_0x374b4f(0x20b)]=parseInt(_0x213a8a['product_stock'])+parseInt(_0x533d55[_0x374b4f(0x140)]),_0x3bb7dc++);});_0x3bb7dc=='0'&&(_0x24d463[_0x417fbb(0x180)]=_0x24d463[_0x417fbb(0x180)]['concat']({'product_name':_0x533d55[_0x417fbb(0x232)],'product_stock':_0x533d55[_0x417fbb(0x140)],'primary_code':_0x533d55[_0x417fbb(0x158)],'secondary_code':_0x533d55[_0x417fbb(0x1d6)],'product_code':_0x533d55[_0x417fbb(0x205)],'bay':_0x533d55['bay'],'maxProducts':_0x533d55['maxStocks'],'unit':_0x533d55['standard_unit'],'secondary_unit':_0x533d55['secondary_unit'],'expiry_date':_0x533d55[_0x417fbb(0x1e9)]}));}),await _0x24d463[_0x2876c8(0x1a5)]();const _0x4b01b1=await s_payment_data[_0x2876c8(0x227)]({'invoice':_0x10b031[_0x2876c8(0x19f)][_0x2876c8(0x1a4)]});if(_0x4b01b1===null){}else console[_0x2876c8(0x1e4)](_0x2876c8(0x13f),_0x4b01b1,_0x10b031['body'][_0x2876c8(0x1a4)]),_0x4b01b1[_0x2876c8(0x13f)]=_0x10b031['body'][_0x2876c8(0x13f)],await _0x4b01b1[_0x2876c8(0x1a5)]();_0x10b031['flash'](_0x2876c8(0x177),_0x2876c8(0x1be)),_0x3763e4['redirect'](_0x2876c8(0x1e1));}catch(_0x3eff9c){console[_0x2876c8(0x1e4)](_0x3eff9c);}}),router[a0_0x160a08(0x21f)](a0_0x160a08(0x1f8),auth,async(_0x254071,_0x99cddc)=>{var _0x39f43a=a0_0x160a08;try{const _0x4da188=_0x254071[_0x39f43a(0x15c)]['id'],{invoice:_0x4695fb,suppliers:_0x489984,payable:_0x36af0a,due_amount:_0x1fe0dc}=_0x254071[_0x39f43a(0x19f)],_0x502d6d=await purchases[_0x39f43a(0x16d)](_0x4da188);var _0x3c01d0=_0x36af0a-_0x1fe0dc;_0x502d6d[_0x39f43a(0x226)]=parseFloat(_0x502d6d[_0x39f43a(0x226)])+parseFloat(_0x1fe0dc),_0x502d6d[_0x39f43a(0x1d3)]=_0x3c01d0;const _0x56e12=await _0x502d6d[_0x39f43a(0x1a5)]();console[_0x39f43a(0x1e4)](_0x56e12);const _0x11eafe=await s_payment_data[_0x39f43a(0x227)]({'invoice':_0x4695fb});_0x11eafe['amount']=_0x3c01d0,await _0x11eafe[_0x39f43a(0x1a5)]();let _0x2f923c=new Date(),_0x1fa647=('0'+_0x2f923c[_0x39f43a(0x1b1)]())['slice'](-0x2),_0xd70196=('0'+(_0x2f923c[_0x39f43a(0x1ad)]()+0x1))[_0x39f43a(0x1bd)](-0x2),_0x35423e=_0x2f923c[_0x39f43a(0x182)](),_0x2c0111=_0x35423e+'-'+_0xd70196+'-'+_0x1fa647;const _0x2ea525=new suppliers_payment({'invoice':_0x4695fb,'date':_0x35423e+'-'+_0xd70196+'-'+_0x1fa647,'suppliers':_0x489984,'reason':_0x39f43a(0x212),'amount':_0x1fe0dc}),_0x59eef1=await _0x2ea525[_0x39f43a(0x1a5)]();_0x254071['flash'](_0x39f43a(0x177),_0x39f43a(0x1d7)),_0x99cddc[_0x39f43a(0x196)]('/all_purchases/view');}catch(_0x5e9feb){console[_0x39f43a(0x1e4)](_0x5e9feb);}}),router[a0_0x160a08(0x1dd)]('/invoice/:id',auth,async(_0x163def,_0x369edd)=>{var _0x2be46a=a0_0x160a08;try{const {username:_0x8eca45,email:_0x2c382b,role:_0x480bfa}=_0x163def[_0x2be46a(0x217)],_0x41e2cd=_0x163def['user'],_0x227987=await profile[_0x2be46a(0x227)]({'email':_0x41e2cd['email']}),_0x2f44a4=await master_shop[_0x2be46a(0x154)]();console['log'](_0x2be46a(0x1a1),_0x2f44a4);const _0x5e5d11=_0x163def[_0x2be46a(0x15c)]['id'],_0x6d7e94=await purchases[_0x2be46a(0x16d)](_0x5e5d11);console[_0x2be46a(0x1e4)](_0x6d7e94);const _0x5895df=await suppliers[_0x2be46a(0x227)]({'name':_0x6d7e94[_0x2be46a(0x13f)]});console[_0x2be46a(0x1e4)](_0x5895df);if(_0x2f44a4[0x0]['language']==_0x2be46a(0x18f)){var _0x211166=users[_0x2be46a(0x18a)];console[_0x2be46a(0x1e4)](_0x211166);}else{if(_0x2f44a4[0x0]['language']=='Hindi')var _0x211166=users[_0x2be46a(0x234)];else{if(_0x2f44a4[0x0]['language']==_0x2be46a(0x1c6))var _0x211166=users['German'];else{if(_0x2f44a4[0x0][_0x2be46a(0x22a)]==_0x2be46a(0x175))var _0x211166=users[_0x2be46a(0x175)];else{if(_0x2f44a4[0x0]['language']==_0x2be46a(0x172))var _0x211166=users[_0x2be46a(0x172)];else{if(_0x2f44a4[0x0]['language']==_0x2be46a(0x237))var _0x211166=users[_0x2be46a(0x186)];else{if(_0x2f44a4[0x0][_0x2be46a(0x22a)]=='Chinese')var _0x211166=users[_0x2be46a(0x210)];else{if(_0x2f44a4[0x0][_0x2be46a(0x22a)]==_0x2be46a(0x1f6))var _0x211166=users['Arabic'];}}}}}}}_0x369edd['render'](_0x2be46a(0x136),{'success':_0x163def[_0x2be46a(0x17e)](_0x2be46a(0x177)),'errors':_0x163def[_0x2be46a(0x17e)]('errors'),'role':_0x41e2cd,'profile':_0x227987,'master_shop':_0x2f44a4,'supplier':_0x5895df,'purchase':_0x6d7e94,'language':_0x211166});}catch(_0x4a9bdd){console[_0x2be46a(0x1e4)](_0x4a9bdd);}}),router[a0_0x160a08(0x1dd)](a0_0x160a08(0x231),auth,async(_0x1cbb83,_0x13d0e5)=>{var _0x4d3d42=a0_0x160a08;try{const {username:_0x350989,email:_0x3ef9a0,role:_0x28f740}=_0x1cbb83[_0x4d3d42(0x217)],_0xb2a13c=_0x1cbb83['user'],_0x2a796f=await profile[_0x4d3d42(0x227)]({'email':_0xb2a13c[_0x4d3d42(0x1ca)]}),_0x43f4bf=await master_shop[_0x4d3d42(0x154)]();console[_0x4d3d42(0x1e4)]('master',_0x43f4bf);const _0x460312=_0x1cbb83[_0x4d3d42(0x15c)]['id'];console[_0x4d3d42(0x1e4)](_0x460312);const _0x511add=await purchases_finished['findById'](_0x460312);console[_0x4d3d42(0x1e4)](_0x4d3d42(0x228),_0x511add);const _0x5eddd4=await product[_0x4d3d42(0x154)]({}),_0x136a48=await warehouse['aggregate']([{'$match':{'name':_0x511add[_0x4d3d42(0x141)],'room':_0x511add[_0x4d3d42(0x15a)]}},{'$unwind':_0x4d3d42(0x20e)},{'$group':{'_id':_0x4d3d42(0x14f),'name':{'$first':_0x4d3d42(0x1bc)},'product_stock':{'$first':_0x4d3d42(0x16b)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x4d3d42(0x1c0)},'primary_code':{'$first':_0x4d3d42(0x1a3)},'secondary_code':{'$first':_0x4d3d42(0x145)},'product_code':{'$first':_0x4d3d42(0x150)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4d3d42(0x235)}}}]);console[_0x4d3d42(0x1e4)](_0x4d3d42(0x16c),_0x136a48);let _0x30f458;if(_0xb2a13c[_0x4d3d42(0x1b8)]==_0x4d3d42(0x139)){const _0x173da2=await staff[_0x4d3d42(0x227)]({'email':_0xb2a13c[_0x4d3d42(0x1ca)]});_0x30f458=await warehouse['find']({'status':_0x4d3d42(0x1ac),'name':_0x173da2['warehouse'],'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'});}else _0x30f458=await warehouse[_0x4d3d42(0x14d)]([{'$match':{'status':_0x4d3d42(0x1ac),'warehouse_category':_0x4d3d42(0x144),'name':_0x4d3d42(0x131)}},{'$group':{'_id':_0x4d3d42(0x160),'name':{'$first':_0x4d3d42(0x160)}}}]);if(_0x43f4bf[0x0][_0x4d3d42(0x22a)]==_0x4d3d42(0x18f)){var _0x2b95ef=users[_0x4d3d42(0x18a)];console[_0x4d3d42(0x1e4)](_0x2b95ef);}else{if(_0x43f4bf[0x0][_0x4d3d42(0x22a)]==_0x4d3d42(0x234))var _0x2b95ef=users[_0x4d3d42(0x234)];else{if(_0x43f4bf[0x0]['language']==_0x4d3d42(0x1c6))var _0x2b95ef=users[_0x4d3d42(0x1c6)];else{if(_0x43f4bf[0x0][_0x4d3d42(0x22a)]==_0x4d3d42(0x175))var _0x2b95ef=users[_0x4d3d42(0x175)];else{if(_0x43f4bf[0x0]['language']==_0x4d3d42(0x172))var _0x2b95ef=users[_0x4d3d42(0x172)];else{if(_0x43f4bf[0x0]['language']==_0x4d3d42(0x237))var _0x2b95ef=users[_0x4d3d42(0x186)];else{if(_0x43f4bf[0x0][_0x4d3d42(0x22a)]=='Chinese')var _0x2b95ef=users[_0x4d3d42(0x210)];else{if(_0x43f4bf[0x0][_0x4d3d42(0x22a)]==_0x4d3d42(0x1f6))var _0x2b95ef=users[_0x4d3d42(0x157)];}}}}}}}_0x13d0e5[_0x4d3d42(0x1f1)](_0x4d3d42(0x1f9),{'success':_0x1cbb83[_0x4d3d42(0x17e)](_0x4d3d42(0x177)),'errors':_0x1cbb83[_0x4d3d42(0x17e)](_0x4d3d42(0x14c)),'role':_0xb2a13c,'profile':_0x2a796f,'user':_0x511add,'stock':_0x136a48,'master_shop':_0x43f4bf,'product':_0x5eddd4,'language':_0x2b95ef,'warehouse':_0x30f458});}catch(_0x20ce46){console[_0x4d3d42(0x1e4)](_0x20ce46);}}),router['post'](a0_0x160a08(0x231),auth,async(_0x23922d,_0x3dfad4)=>{var _0xd2d343=a0_0x160a08;try{const {invoice:_0x257027,date:_0x4a7f0d,warehouse_name:_0x259c45,Room_name:_0x564efc,product_name:_0x14af90,purchase_quantity:_0xe18a6,stocks:_0x39f4a6,return_qty:_0xff78cc,note:_0x17aa63,level:_0x4ecf6f,isle:_0x52aa9e,pallet:_0x52d5d5,to_warehouse_name:_0x40b2f2,to_Room_name:_0x5e6355}=_0x23922d[_0xd2d343(0x19f)],_0xe577dd=await purchases_finished[_0xd2d343(0x227)]({'_id':_0x23922d[_0xd2d343(0x15c)]['id']}),_0x3c076e=await warehouse[_0xd2d343(0x227)]({'name':_0x259c45,'room':_0x564efc,'warehouse_category':_0xd2d343(0x144)});if(typeof _0x14af90==_0xd2d343(0x181))var _0xa790aa=[_0x23922d[_0xd2d343(0x19f)]['product_name']],_0x2e8723=[_0x23922d['body'][_0xd2d343(0x236)]],_0x2e790c=[_0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x1ab)]],_0x1f4fb4=[_0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x12a)]],_0x318116=[_0x23922d['body'][_0xd2d343(0x1f3)]],_0x58f771=[_0x23922d[_0xd2d343(0x19f)]['product_code_hide']],_0x10622f=[_0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x1d8)]],_0x14ab24=[_0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x132)]];else var _0xa790aa=[..._0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x232)]],_0x2e8723=[..._0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x236)]],_0x2e790c=[..._0x23922d['body']['stocks']],_0x1f4fb4=[..._0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x12a)]],_0x318116=[..._0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x1f3)]],_0x58f771=[..._0x23922d['body'][_0xd2d343(0x22e)]],_0x10622f=[..._0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x1d8)]],_0x14ab24=[..._0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x132)]];const _0x3bd050=_0xa790aa['map'](_0x38dbf1=>{return _0x38dbf1={'product_name':_0x38dbf1};});_0x2e8723[_0xd2d343(0x1e8)]((_0x4a9450,_0x38a50e)=>{_0x3bd050[_0x38a50e]['purchase_quantity']=_0x4a9450;}),_0x2e790c[_0xd2d343(0x1e8)]((_0x27be4d,_0x49388e)=>{var _0x53e245=_0xd2d343;_0x3bd050[_0x49388e][_0x53e245(0x176)]=_0x27be4d;}),_0x1f4fb4[_0xd2d343(0x1e8)]((_0x4f1694,_0x659c72)=>{var _0x18ba98=_0xd2d343;_0x3bd050[_0x659c72][_0x18ba98(0x12a)]=_0x4f1694;}),_0x318116[_0xd2d343(0x1e8)]((_0x4b6091,_0x1658d2)=>{_0x3bd050[_0x1658d2]['bay']=_0x4b6091;}),_0x58f771[_0xd2d343(0x1e8)]((_0x3b5c3a,_0x4cb230)=>{var _0x1ef669=_0xd2d343;_0x3bd050[_0x4cb230][_0x1ef669(0x205)]=_0x3b5c3a;}),_0x10622f[_0xd2d343(0x1e8)]((_0xc9794f,_0x5b55da)=>{var _0x3daa56=_0xd2d343;_0x3bd050[_0x5b55da][_0x3daa56(0x158)]=_0xc9794f;}),_0x14ab24[_0xd2d343(0x1e8)]((_0x537fa1,_0x2d2686)=>{_0x3bd050[_0x2d2686]['secondary_code']=_0x537fa1;}),_0x3bd050[_0xd2d343(0x1e8)](_0x3486d1=>{var _0x3916e7=_0xd2d343;console['log'](_0x3486d1);const _0xf2425f=_0x3c076e[_0x3916e7(0x180)][_0x3916e7(0x215)](_0xf0536e=>{var _0x50c66d=_0x3916e7;_0xf0536e['product_name']==_0x3486d1[_0x50c66d(0x232)]&&_0xf0536e[_0x50c66d(0x146)]==_0x3486d1['bay']&&(console['log'](parseInt(_0xf0536e[_0x50c66d(0x20b)])+_0x50c66d(0x1e2)+parseInt(_0x3486d1[_0x50c66d(0x12a)])),_0xf0536e[_0x50c66d(0x20b)]=parseInt(_0xf0536e[_0x50c66d(0x20b)])-parseInt(_0x3486d1[_0x50c66d(0x12a)]));});}),await _0x3c076e[_0xd2d343(0x1a5)]();var _0x5bf096=0x0;_0x3bd050['forEach'](_0x2f7518=>{var _0x264c18=_0xd2d343;(parseInt(_0x2f7518['purchase_quantity'])<parseInt(_0x2f7518[_0x264c18(0x12a)])||parseInt(_0x2f7518[_0x264c18(0x176)])<parseInt(_0x2f7518['return_qty']))&&_0x5bf096++;});if(_0x5bf096!=0x0)return _0x23922d['flash']('errors',_0xd2d343(0x1d9)),_0x3dfad4[_0xd2d343(0x196)](_0xd2d343(0x174));const _0x1f5074=new purchases_return_finished({'invoice':_0x257027,'suppliers':_0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x13f)],'date':_0x4a7f0d,'warehouse_name':_0x259c45,'return_product':_0x3bd050,'note':_0x17aa63,'room':_0x564efc,'to_warehouse_name':_0x40b2f2,'to_room':_0x5e6355}),_0x2ef2f7=await _0x1f5074[_0xd2d343(0x1a5)](),_0xdba46f=await purchases_return_finished[_0xd2d343(0x227)]({'invoice':_0x257027}),_0xfe57c7=await warehouse[_0xd2d343(0x227)]({'name':_0x40b2f2,'room':_0x5e6355,'warehouse_category':'Finished\x20Goods'});_0xdba46f[_0xd2d343(0x1e0)][_0xd2d343(0x1e8)](_0x17bfd4=>{var _0x1ab6b0=_0xd2d343,_0x54ee81=0x0;const _0x2dc43b=_0xfe57c7[_0x1ab6b0(0x180)][_0x1ab6b0(0x215)](_0x274cc8=>{var _0xe08326=_0x1ab6b0;console[_0xe08326(0x1e4)](_0x274cc8[_0xe08326(0x232)]+'=='+_0x17bfd4[_0xe08326(0x232)]+'&&'+_0x274cc8[_0xe08326(0x146)]+'=='+_0x17bfd4[_0xe08326(0x146)]),_0x274cc8[_0xe08326(0x232)]==_0x17bfd4[_0xe08326(0x232)]&&_0x274cc8['bay']==_0x17bfd4[_0xe08326(0x146)]&&(_0x274cc8[_0xe08326(0x20b)]=parseInt(_0x274cc8[_0xe08326(0x20b)])-parseInt(_0x17bfd4[_0xe08326(0x12a)]),_0x54ee81++);});_0x54ee81=='0'&&(_0xfe57c7['product_details']=_0xfe57c7[_0x1ab6b0(0x180)][_0x1ab6b0(0x13c)]({'product_name':_0x17bfd4['product_name'],'product_stock':_0x17bfd4[_0x1ab6b0(0x12a)],'primary_code':_0x17bfd4[_0x1ab6b0(0x158)],'secondary_code':_0x17bfd4[_0x1ab6b0(0x1d6)],'product_code':_0x17bfd4[_0x1ab6b0(0x205)],'bay':_0x17bfd4[_0x1ab6b0(0x146)],'maxProducts':0xf423f}));}),await _0xfe57c7['save']();const _0x4f483e=await purchases_finished[_0xd2d343(0x227)]({'invoice':_0x257027});_0x4f483e[_0xd2d343(0x1fc)]=_0xd2d343(0x147);const _0x5a7dc0=await _0x4f483e[_0xd2d343(0x1a5)](),_0xa8186d=new s_payment_data({'invoice':_0x257027,'suppliers':_0x23922d[_0xd2d343(0x19f)][_0xd2d343(0x13f)],'reason':_0xd2d343(0x13d)});await _0xa8186d[_0xd2d343(0x1a5)]();const _0x172b17=await master_shop[_0xd2d343(0x154)](),_0x673099=await email_settings[_0xd2d343(0x227)](),_0x42d2f4=await suppliers['findOne']({'name':_0x23922d[_0xd2d343(0x19f)]['suppliers']});_0x172b17[0x0][_0xd2d343(0x12b)]==0x1?(right_currency=_0x172b17[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x172b17[0x0][_0xd2d343(0x221)]);var _0x43fd58=_0xa790aa,_0xc9689c=_0x1f4fb4,_0x5bc614='',_0xcdcc7;for(_0xcdcc7 in _0x43fd58){_0x5bc614+=_0xd2d343(0x1fe)+_0xd2d343(0x1c3)+_0x43fd58[_0xcdcc7]+_0xd2d343(0x171)+_0xd2d343(0x1c3)+_0xc9689c[_0xcdcc7]+_0xd2d343(0x171)+'</tr>';}let _0x4fb523=nodemailer['createTransport']({'service':_0xd2d343(0x21d),'auth':{'user':_0x673099['email'],'pass':_0x673099['password']}}),_0x461b83={'from':_0x673099[_0xd2d343(0x1ca)],'to':_0x42d2f4[_0xd2d343(0x1ca)],'subject':_0xd2d343(0x22f),'attachments':[{'filename':_0xd2d343(0x211),'path':__dirname+_0xd2d343(0x224)+_0xd2d343(0x18e)+_0x172b17[0x0][_0xd2d343(0x156)],'cid':_0xd2d343(0x1f5)}],'html':'<!DOCTYPE\x20html>'+_0xd2d343(0x1df)+_0xd2d343(0x20f)+_0xd2d343(0x21a)+_0xd2d343(0x202)+'<div>'+_0xd2d343(0x18d)+_0xd2d343(0x1b7)+_0xd2d343(0x21a)+'<h2>\x20'+_0x172b17[0x0][_0xd2d343(0x15d)]+_0xd2d343(0x12d)+_0xd2d343(0x1b7)+_0xd2d343(0x1b7)+_0xd2d343(0x1d1)+_0xd2d343(0x21a)+_0xd2d343(0x1b0)+_0xd2d343(0x17c)+_0x257027+'\x20'+_0xd2d343(0x1b3)+_0xd2d343(0x14e)+_0x4a7f0d+'\x20'+_0xd2d343(0x1f0)+_0xd2d343(0x16e)+_0xd2d343(0x1b7)+_0xd2d343(0x199)+_0xd2d343(0x13e)+_0xd2d343(0x1fe)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xd2d343(0x1cd)+_0xd2d343(0x170)+_0xd2d343(0x137)+_0xd2d343(0x1e5)+_0xd2d343(0x1fd)+_0xd2d343(0x185)+'\x20'+_0x5bc614+'\x20'+_0xd2d343(0x1c9)+_0xd2d343(0x1a0)+'<div>'+_0xd2d343(0x191)+_0xd2d343(0x21c)+_0x172b17[0x0]['site_title']+_0xd2d343(0x16e)+_0xd2d343(0x1b7)+'</div>'+'</body></html>'};_0x4fb523[_0xd2d343(0x1d4)](_0x461b83,function(_0x30434f,_0x5e93a6){var _0x1e67b8=_0xd2d343;_0x30434f?console['log'](_0x1e67b8(0x201)):console[_0x1e67b8(0x1e4)](_0x1e67b8(0x19b));}),_0x23922d[_0xd2d343(0x17e)](_0xd2d343(0x177),_0xd2d343(0x1ae)),_0x3dfad4[_0xd2d343(0x196)](_0xd2d343(0x1e1));}catch(_0x38f6f7){_0x3dfad4[_0xd2d343(0x200)](0xc8)[_0xd2d343(0x223)]({'message':_0x38f6f7[_0xd2d343(0x1a8)]});}}),router[a0_0x160a08(0x1dd)]('/barcode/:id',auth,async(_0x238de2,_0x3519e2)=>{var _0x3e4140=a0_0x160a08;try{const {username:_0x487204,email:_0x2516c7,role:_0x27acf5}=_0x238de2[_0x3e4140(0x217)],_0x1be719=_0x238de2['user'],_0x3001fa=await profile['findOne']({'email':_0x1be719[_0x3e4140(0x1ca)]}),_0x34a80a=await master_shop[_0x3e4140(0x154)](),_0xad9fe6=_0x238de2[_0x3e4140(0x15c)]['id'],_0x14bf96=await purchases_finished[_0x3e4140(0x16d)](_0xad9fe6);if(_0x34a80a[0x0][_0x3e4140(0x22a)]=='English\x20(US)')var _0x49ca71=users[_0x3e4140(0x18a)];else{if(_0x34a80a[0x0][_0x3e4140(0x22a)]==_0x3e4140(0x234))var _0x49ca71=users['Hindi'];else{if(_0x34a80a[0x0]['language']==_0x3e4140(0x1c6))var _0x49ca71=users['German'];else{if(_0x34a80a[0x0][_0x3e4140(0x22a)]=='Spanish')var _0x49ca71=users[_0x3e4140(0x175)];else{if(_0x34a80a[0x0][_0x3e4140(0x22a)]=='French')var _0x49ca71=users[_0x3e4140(0x172)];else{if(_0x34a80a[0x0][_0x3e4140(0x22a)]==_0x3e4140(0x237))var _0x49ca71=users[_0x3e4140(0x186)];else{if(_0x34a80a[0x0]['language']=='Chinese')var _0x49ca71=users['Chinese'];else{if(_0x34a80a[0x0]['language']=='Arabic\x20(ae)')var _0x49ca71=users[_0x3e4140(0x157)];}}}}}}}_0x3519e2[_0x3e4140(0x1f1)](_0x3e4140(0x1a9),{'success':_0x238de2[_0x3e4140(0x17e)](_0x3e4140(0x177)),'errors':_0x238de2[_0x3e4140(0x17e)](_0x3e4140(0x14c)),'role':_0x1be719,'profile':_0x3001fa,'alldata':_0x14bf96,'master_shop':_0x34a80a,'language':_0x49ca71}),console['log'](alldata);}catch(_0x285223){console[_0x3e4140(0x1e4)](_0x285223);}}),router[a0_0x160a08(0x21f)](a0_0x160a08(0x161),async(_0x3ce8f5,_0x275367)=>{var _0x150682=a0_0x160a08;const {product_code:_0x3dc51b}=_0x3ce8f5[_0x150682(0x19f)];var _0x4225e8;const _0x5d7e27=await product[_0x150682(0x14d)]([{'$match':{'primary_code':_0x3dc51b,'product_category':_0x150682(0x144)}},{'$group':{'_id':_0x150682(0x1fb),'name':{'$first':_0x150682(0x160)},'category':{'$first':_0x150682(0x1d0)},'brand':{'$first':_0x150682(0x12c)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x150682(0x1c8)},'product_code':{'$first':_0x150682(0x178)},'primary_code':{'$first':_0x150682(0x1ec)},'secondary_code':{'$first':_0x150682(0x20a)},'maxStocks':{'$first':_0x150682(0x1ea)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1bb448=await product[_0x150682(0x14d)]([{'$match':{'secondary_code':_0x3dc51b}},{'$group':{'_id':_0x150682(0x1fb),'name':{'$first':_0x150682(0x160)},'category':{'$first':'$category'},'brand':{'$first':_0x150682(0x12c)},'unit':{'$first':_0x150682(0x229)},'alertquantity':{'$first':_0x150682(0x1c8)},'product_code':{'$first':_0x150682(0x178)},'primary_code':{'$first':_0x150682(0x1ec)},'secondary_code':{'$first':_0x150682(0x20a)},'maxStocks':{'$first':_0x150682(0x1ea)},'maxProdPerUnit':{'$first':_0x150682(0x213)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x150682(0x17f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5d7e27['length']>0x0)_0x4225e8=_0x5d7e27;else _0x1bb448[_0x150682(0x159)]>0x0&&(_0x4225e8=_0x1bb448);_0x275367[_0x150682(0x223)](_0x4225e8);}),router['post']('/CheckingWarehouse',async(_0x291561,_0x4b9119)=>{var _0x3e3f7e=a0_0x160a08;const {productCode:_0x334cb3,bay:_0x4ee6ee,warehouses:_0x4a3c0c,room:_0x2b7275}=_0x291561['body'];console[_0x3e3f7e(0x1e4)](_0x291561['body']);try{const _0x54aa00=await warehouse['aggregate']([{'$match':{'name':_0x4a3c0c,'room':_0x2b7275}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x4ee6ee)}},{'$group':{'_id':_0x3e3f7e(0x14f),'name':{'$first':_0x3e3f7e(0x1bc)},'product_stock':{'$first':_0x3e3f7e(0x16b)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x3e3f7e(0x135)}}}]);_0x4b9119[_0x3e3f7e(0x200)](0xc8)[_0x3e3f7e(0x223)](_0x54aa00);}catch(_0x3a72eb){_0x4b9119['status'](0x194)[_0x3e3f7e(0x223)]({'message':_0x3a72eb[_0x3e3f7e(0x1a8)]});}}),module[a0_0x160a08(0x1f7)]=router;