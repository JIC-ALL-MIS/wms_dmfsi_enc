var a0_0x190607=a0_0x3275;(function(_0x50c75b,_0x1b73ef){var _0x55d40c=a0_0x3275,_0xa2d3a8=_0x50c75b();while(!![]){try{var _0x4ade11=parseInt(_0x55d40c(0x163))/0x1+-parseInt(_0x55d40c(0x16a))/0x2+-parseInt(_0x55d40c(0x10b))/0x3+parseInt(_0x55d40c(0xcc))/0x4*(parseInt(_0x55d40c(0x110))/0x5)+-parseInt(_0x55d40c(0x8e))/0x6+parseInt(_0x55d40c(0xdc))/0x7*(-parseInt(_0x55d40c(0xb3))/0x8)+parseInt(_0x55d40c(0x94))/0x9*(parseInt(_0x55d40c(0x90))/0xa);if(_0x4ade11===_0x1b73ef)break;else _0xa2d3a8['push'](_0xa2d3a8['shift']());}catch(_0x133042){_0xa2d3a8['push'](_0xa2d3a8['shift']());}}}(a0_0x15b1,0x5d4ee));const express=require(a0_0x190607(0x17a)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x190607(0xcb)),auth=require(a0_0x190607(0xc0)),nodemailer=require(a0_0x190607(0xb8));var ejs=require('ejs');const path=require(a0_0x190607(0x102)),users=require(a0_0x190607(0xc1));router[a0_0x190607(0xd2)]('/view',auth,async(_0x4b7231,_0xf4fcd0)=>{var _0x83ee41=a0_0x190607;try{const {username:_0x558fe4,email:_0x174fb1,role:_0x7d1a62}=_0x4b7231['user'],_0x3092b1=_0x4b7231[_0x83ee41(0x9d)],_0x59b1a2=await profile[_0x83ee41(0x132)]({'email':_0x3092b1['email']}),_0x4cac46=await staff['findOne']({'email':_0x3092b1[_0x83ee41(0x160)]});if(_0x3092b1['role']=='staff'){const _0x3a5c8f=await staff[_0x83ee41(0x132)]({'email':_0x3092b1['email']});}const _0x5794fa=await master_shop['find']();let _0x1a2d1c;if(_0x3092b1['role']==_0x83ee41(0x126)){const _0x378b44=await staff['findOne']({'email':_0x3092b1['email']});_0x1a2d1c=await purchases_finished[_0x83ee41(0x134)]([{'$match':{'warehouse_name':_0x378b44[_0x83ee41(0xd3)]}},{'$lookup':{'from':_0x83ee41(0x10d),'localField':'suppliers','foreignField':_0x83ee41(0x8d),'as':_0x83ee41(0x14e)}},{'$unwind':_0x83ee41(0x109)},{'$unwind':'$product'},{'$group':{'_id':_0x83ee41(0x107),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x83ee41(0x171)},'date':{'$first':_0x83ee41(0xfc)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':_0x83ee41(0xa4)},'note':{'$first':_0x83ee41(0x93)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x83ee41(0xba)},'batch_code':{'$first':_0x83ee41(0x155)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x83ee41(0x109)},'total_product_quantity':{'$sum':_0x83ee41(0xc9)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x83ee41(0xe2)},'type':{'$addToSet':_0x83ee41(0xfe)},'floorlevel':{'$addToSet':_0x83ee41(0x97)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1a2d1c=await purchases_finished[_0x83ee41(0x134)]([{'$unwind':'$product'},{'$group':{'_id':_0x83ee41(0x107),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x83ee41(0xfc)},'warehouse_name':{'$first':_0x83ee41(0x10c)},'room':{'$addToSet':_0x83ee41(0x12e)},'product':{'$push':_0x83ee41(0xa4)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x83ee41(0x124)},'due_amount':{'$first':_0x83ee41(0x10e)},'return_data':{'$first':_0x83ee41(0xba)},'batch_code':{'$first':_0x83ee41(0x155)},'expiry_date':{'$first':_0x83ee41(0x12b)},'suppliers_docs':{'$first':_0x83ee41(0x109)},'total_product_quantity':{'$sum':_0x83ee41(0xc9)},'level':{'$addToSet':_0x83ee41(0x127)},'isle':{'$addToSet':_0x83ee41(0xe2)},'type':{'$addToSet':_0x83ee41(0xfe)},'floorlevel':{'$addToSet':_0x83ee41(0x97)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x5794fa[0x0][_0x83ee41(0x14b)]==_0x83ee41(0x179))var _0x1f30ae=users[_0x83ee41(0x119)];else{if(_0x5794fa[0x0][_0x83ee41(0x14b)]==_0x83ee41(0x116))var _0x1f30ae=users[_0x83ee41(0x116)];else{if(_0x5794fa[0x0][_0x83ee41(0x14b)]==_0x83ee41(0xc8))var _0x1f30ae=users[_0x83ee41(0xc8)];else{if(_0x5794fa[0x0][_0x83ee41(0x14b)]==_0x83ee41(0x137))var _0x1f30ae=users[_0x83ee41(0x137)];else{if(_0x5794fa[0x0]['language']=='French')var _0x1f30ae=users['French'];else{if(_0x5794fa[0x0][_0x83ee41(0x14b)]==_0x83ee41(0x145))var _0x1f30ae=users[_0x83ee41(0x16d)];else{if(_0x5794fa[0x0][_0x83ee41(0x14b)]==_0x83ee41(0xd6))var _0x1f30ae=users[_0x83ee41(0xd6)];else{if(_0x5794fa[0x0]['language']==_0x83ee41(0xf8))var _0x1f30ae=users['Arabic'];}}}}}}}_0xf4fcd0[_0x83ee41(0x169)](_0x83ee41(0x175),{'success':_0x4b7231['flash'](_0x83ee41(0xe8)),'errors':_0x4b7231['flash']('errors'),'purchases':_0x1a2d1c,'role':_0x3092b1,'profile':_0x59b1a2,'master_shop':_0x5794fa,'language':_0x1f30ae});}catch(_0x4a30ae){console['log']('table\x20page',_0x4a30ae),_0xf4fcd0[_0x83ee41(0x133)](0xc8)[_0x83ee41(0x162)]({'message':_0x4a30ae[_0x83ee41(0x91)]});}});function a0_0x3275(_0x330d3a,_0x49dc2f){var _0x15b1e3=a0_0x15b1();return a0_0x3275=function(_0x327527,_0x3ad09b){_0x327527=_0x327527-0x83;var _0x37192f=_0x15b1e3[_0x327527];return _0x37192f;},a0_0x3275(_0x330d3a,_0x49dc2f);}function BayBinSelected(_0x51bd29,_0x51239a){var _0x160604=a0_0x190607,_0x207441=[],_0x961432=[];if(_0x51bd29==_0x160604(0x123)){switch(_0x51239a){case _0x160604(0xd5):_0x207441=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x160604(0x11e):_0x207441=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x961432=['DG'];}else{if(_0x51bd29=='FROZEN\x20GOODS'){switch(_0x51239a){case'Rack\x201':_0x207441=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x160604(0x11e):_0x207441=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x961432=['FG'];}}return{'levels':_0x207441,'identify':_0x961432};}function a0_0x15b1(){var _0x589372=['errors','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','all_purchases_finished','<hr\x20class=\x22my-3\x22>','return_data','$product_details.product_stock','English\x20(US)','express','An\x20error\x20occurred\x20while\x20saving\x20data.','product_code','level','master','/all_purchases/view','</head><body>','/view/:id','$product_code','$maxStocks','Enabled','$product_details.floorlevel','due_amount','logo','product_cat','secondary_code_hide','name','3450882JLtWfo','$product_details.bay','11667410TOqbOV','message','purchase_quantity','$note','9hCBVfn','\x20Order\x20Date\x20:\x20','</h5>','$product.floorlevel','params','POnumber','Return\x20Goods','string','add_purchases\x20error','user','note','forEach','add_purchases_finished','MaxStocks_data','role','prod_cat','$product','prod_invoice','prod_secondunit','prod_primunit','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<html><head><title></title>','slice','post','currency','quantity','maxStocks','concat','product_stock','<table\x20style=\x22width:\x20100%\x20!important;\x22>','64280rvjKfM','$secondary_code','stock_data','An\x20error\x20occurred.','max_product_unit','nodemailer','product','$return_data','filter','sendMail','all','then','paid_amount','../middleware/auth','../public/language/languages.json','redirect','getMonth','</thead>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','gmail','/view/return_purchase/:id','German','$product.quantity','image','../models/all_models','2158132bMiCqT','JO_number','/CheckingWarehouse','$product_details.rack','floor','date','get','warehouse','primary_code','Rack\x201','Chinese','random','/all_purchases_finished/view','find','<tr>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','539ucthVe','/preview/:id','padStart','map','<h5>','site_title','$product.bin','createTransport','$product_details.bin','/upload/','prod_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','success','maxperunit','room_name','_id','flash','secondary_code','$product_details.primary_code','INCF-','purchases\x20item\x20return\x20successfull','prod_Qty','</td>','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<h2>\x20','getDate','<h5\x20style=\x22text-align:\x20left;\x22>','Arabic\x20(ae)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Purchase\x20Return','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$date','purchase_invoice','$product.type','secondary_unit','Logo.png','</div>','path','prod_name','$product_details','prod_qty','<tbody\x20style=\x22text-align:\x20center;\x22>','$_id','standard_unit','$suppliers_docs','product_code_hide','720543wbWTkc','$warehouse_name','suppliers','$due_amount','invoice','5kDNlLe','RoomAssign','warehouse_name','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Hindi','room','$product_details.product_name','English','/../public','stocks','\x20Order\x20Number\x20:\x20','primary_code_hide','Rack\x202','stock_quantity','product_details','bay','prod_level','DRY\x20GOODS','$paid_amount','purchase\x20data\x20add\x20successfully','staff','$product.bay','production_date','/barcode/:id','</body></html>','$expiry_date','catch','updateOne','$product.room_name','payment\x20successfull','$secondary_unit','log','findOne','status','aggregate','Arabic','$primary_code','Spanish','return_qty','<div>','findById','back','$unit','return_product','user_id','expiry_date','Error\x20Occurs','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$name','French','product_date','Portuguese\x20(BR)','$category','body','/view/add_purchases','purchase\x20data\x20update\x20successfully','$brand','language','abs','toString','suppliers_docs','getFullYear','$alertquantity','</span>','True','error','</tbody>','$batch_code','prod_code','QA\x20Warehouse','Room_name','product_name','\x20</h2>','save','<strong>\x20Regards\x20</strong>','<span\x20style=\x22float:\x20right;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','length','email','$maxProdPerUnit','json','734324TiTnmM','currency_placement','edit_purchases_finished_view','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<!DOCTYPE\x20html>','</tr>','render','1248770yMdKdP','$product_details.storage','FGSEmail','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Email\x20sent\x20successfully','$product_details._id','$suppliers'];a0_0x15b1=function(){return _0x589372;};return a0_0x15b1();}async function getRandom8DigitNumber(){var _0x408b09=a0_0x190607;const _0x807470=0x989680,_0x368f47=0x5f5e0ff,_0x106f2c=Math[_0x408b09(0xd0)](Math[_0x408b09(0xd7)]()*(_0x368f47-_0x807470+0x1))+_0x807470;var _0x56e4cf;const _0x32b362=await purchases_finished[_0x408b09(0x132)]({'invoice':_0x408b09(0xef)+_0x106f2c});return _0x32b362&&_0x32b362[_0x408b09(0x15f)]>0x0?_0x56e4cf=_0x408b09(0xef)+_0x106f2c:_0x56e4cf=_0x408b09(0xef)+_0x106f2c,_0x56e4cf;}router['get']('/view/add_purchases',auth,async(_0x5389b4,_0x182d4e)=>{var _0x1116ff=a0_0x190607;try{const {username:_0x2bbd4b,email:_0xcda395,role:_0x2052d5}=_0x5389b4[_0x1116ff(0x9d)],_0x5e316d=_0x5389b4[_0x1116ff(0x9d)],_0x1f60af=await profile[_0x1116ff(0x132)]({'email':_0x5e316d['email']}),_0x19ed4c=await master_shop[_0x1116ff(0xd9)](),_0x4b50cc=await staff[_0x1116ff(0x132)]({'email':_0x5e316d[_0x1116ff(0x160)]}),_0x4a3ffc=await suppliers[_0x1116ff(0xd9)]({});let _0x5bcfbc;if(_0x5e316d[_0x1116ff(0xa2)]=='staff'){const _0x47be7a=await staff[_0x1116ff(0x132)]({'email':_0x5e316d[_0x1116ff(0x160)]});_0x5bcfbc=await warehouse['aggregate']([{'$match':{'status':_0x1116ff(0x87),'name':_0x47be7a['warehouse'],'warehouse_category':_0x1116ff(0xf3)}},{'$group':{'_id':_0x1116ff(0x142),'name':{'$first':'$name'}}}]);}else _0x5bcfbc=await warehouse['aggregate']([{'$match':{'status':_0x1116ff(0x87),'warehouse_category':_0x1116ff(0xf3),'name':{'$ne':_0x1116ff(0x157)}}},{'$group':{'_id':_0x1116ff(0x142),'name':{'$first':_0x1116ff(0x142)}}}]);const _0x367252=await product['find']({}),_0x4b5191=await warehouse['find']({'status':_0x1116ff(0x87)}),_0x5656ff=await purchases_finished['find']({}),_0x542fec=_0x5656ff['length']+0x1,_0x152c81='INCF-'+_0x542fec[_0x1116ff(0x14d)]()[_0x1116ff(0xde)](0x5,'0');var _0x34efb0=['Ambient','Enclosed'];if(_0x19ed4c[0x0][_0x1116ff(0x14b)]==_0x1116ff(0x179))var _0x41f6df=users['English'];else{if(_0x19ed4c[0x0][_0x1116ff(0x14b)]=='Hindi')var _0x41f6df=users[_0x1116ff(0x116)];else{if(_0x19ed4c[0x0][_0x1116ff(0x14b)]==_0x1116ff(0xc8))var _0x41f6df=users[_0x1116ff(0xc8)];else{if(_0x19ed4c[0x0][_0x1116ff(0x14b)]==_0x1116ff(0x137))var _0x41f6df=users[_0x1116ff(0x137)];else{if(_0x19ed4c[0x0][_0x1116ff(0x14b)]==_0x1116ff(0x143))var _0x41f6df=users['French'];else{if(_0x19ed4c[0x0][_0x1116ff(0x14b)]==_0x1116ff(0x145))var _0x41f6df=users[_0x1116ff(0x16d)];else{if(_0x19ed4c[0x0][_0x1116ff(0x14b)]=='Chinese')var _0x41f6df=users['Chinese'];else{if(_0x19ed4c[0x0]['language']==_0x1116ff(0xf8))var _0x41f6df=users[_0x1116ff(0x135)];}}}}}}}const _0x2cccd9=getRandom8DigitNumber();_0x2cccd9[_0x1116ff(0xbe)](_0x1f56d5=>{var _0x461050=_0x1116ff;_0x182d4e[_0x461050(0x169)](_0x461050(0xa0),{'success':_0x5389b4[_0x461050(0xec)](_0x461050(0xe8)),'errors':_0x5389b4[_0x461050(0xec)](_0x461050(0x172)),'role':_0x5e316d,'profile':_0x1f60af,'suppliers':_0x4a3ffc,'warehouse':_0x5bcfbc,'product':_0x367252,'invoice':_0x1f56d5,'master_shop':_0x19ed4c,'language':_0x41f6df,'find_data':_0x4b5191,'rooms_data':_0x34efb0});})[_0x1116ff(0x12c)](_0x48a853=>{var _0x1b8497=_0x1116ff;_0x5389b4[_0x1b8497(0xec)]('errors',_0x1b8497(0xdb)),_0x182d4e[_0x1b8497(0xc2)](_0x1b8497(0xd8));});}catch(_0x594186){console[_0x1116ff(0x131)](_0x594186);}}),router['get']('/view/add_purchases/:id',auth,async(_0x5c03fe,_0x4cadd2)=>{var _0x21a390=a0_0x190607;try{const _0x11c804=_0x5c03fe[_0x21a390(0x98)]['id'];console[_0x21a390(0x131)](_0x11c804);const _0x22cf7a=await master_shop[_0x21a390(0xd9)]();console[_0x21a390(0x131)]('master',_0x22cf7a);const _0x4ab3aa=await product[_0x21a390(0x132)]({'name':_0x11c804});console[_0x21a390(0x131)](_0x21a390(0xb9),_0x4ab3aa),_0x4cadd2[_0x21a390(0x133)](0xc8)[_0x21a390(0x162)]({'product_data':_0x4ab3aa,'master':_0x22cf7a});}catch(_0x361e74){console['log'](_0x21a390(0x9c),_0x361e74);}}),router[a0_0x190607(0xac)](a0_0x190607(0x148),auth,async(_0x55745c,_0x68261e)=>{var _0x4519dc=a0_0x190607;try{const {invoice:_0x227213,date:_0x3fc87f,warehouse_name:_0x162106,prod_name:_0x1ecc66,prod_code:_0x3526a0,prod_qty:_0x5d7405,prod_unit:_0xdd74f1,prod_secondunit:_0x2b0e0c,prod_level:_0x2b538a,prod_isle:_0x4582e1,prod_pallet:_0x11031b,note:_0x261ed5,expiry_date:_0x24f21f,batch_code:_0x3b81f0,payable:_0x503021,due_amount:_0x196d99,Room_name:_0x34109a,primary_code:_0x3c8b09,secondary_code:_0x8ce1b5,MaxStocks_data:_0x9c6699,PO_number:_0x599c83,SCRN:_0xe35e9,JO_number:_0x11eade}=_0x55745c[_0x4519dc(0x147)];if(typeof _0x1ecc66==_0x4519dc(0x9b))var _0x1aca2f=[_0x55745c[_0x4519dc(0x147)]['prod_name']],_0xb2fba6=[_0x55745c[_0x4519dc(0x147)][_0x4519dc(0x156)]],_0x569d4e=[_0x55745c['body'][_0x4519dc(0xf1)]],_0x226358=[_0x55745c[_0x4519dc(0x147)]['prod_primunit']],_0x1f4b49=[_0x55745c[_0x4519dc(0x147)][_0x4519dc(0xa6)]],_0x3bb179=[_0x55745c['body'][_0x4519dc(0x122)]],_0x262312=[_0x55745c[_0x4519dc(0x147)][_0x4519dc(0xd4)]],_0x335086=[_0x55745c['body'][_0x4519dc(0xed)]],_0x3df95c=[_0x55745c['body'][_0x4519dc(0xa1)]],_0x12dbf6=[_0x55745c[_0x4519dc(0x147)]['batch_code']],_0x5e5580=[_0x55745c[_0x4519dc(0x147)][_0x4519dc(0x13f)]],_0x4b3c74=[_0x55745c[_0x4519dc(0x147)][_0x4519dc(0x144)]],_0x30c079=[_0x55745c[_0x4519dc(0x147)][_0x4519dc(0xb7)]],_0x4a6bab=[_0x55745c['body'][_0x4519dc(0xa3)]],_0x44fe12=[_0x55745c['body']['RoomAssign']],_0x1b30c3=[_0x55745c[_0x4519dc(0x147)][_0x4519dc(0xa5)]];else var _0x1aca2f=[..._0x55745c[_0x4519dc(0x147)][_0x4519dc(0x103)]],_0xb2fba6=[..._0x55745c[_0x4519dc(0x147)]['prod_code']],_0x569d4e=[..._0x55745c[_0x4519dc(0x147)][_0x4519dc(0xf1)]],_0x226358=[..._0x55745c[_0x4519dc(0x147)][_0x4519dc(0xa7)]],_0x1f4b49=[..._0x55745c[_0x4519dc(0x147)][_0x4519dc(0xa6)]],_0x3bb179=[..._0x55745c['body'][_0x4519dc(0x122)]],_0x262312=[..._0x55745c[_0x4519dc(0x147)][_0x4519dc(0xd4)]],_0x335086=[..._0x55745c['body'][_0x4519dc(0xed)]],_0x3df95c=[..._0x55745c['body']['MaxStocks_data']],_0x12dbf6=[..._0x55745c[_0x4519dc(0x147)]['batch_code']],_0x5e5580=[..._0x55745c[_0x4519dc(0x147)][_0x4519dc(0x13f)]],_0x4b3c74=[..._0x55745c[_0x4519dc(0x147)][_0x4519dc(0x144)]],_0x30c079=[..._0x55745c[_0x4519dc(0x147)][_0x4519dc(0xb7)]],_0x4a6bab=[..._0x55745c[_0x4519dc(0x147)][_0x4519dc(0xa3)]],_0x44fe12=[..._0x55745c['body'][_0x4519dc(0x111)]],_0x1b30c3=[..._0x55745c['body'][_0x4519dc(0xa5)]];const _0x26efd0=_0x1aca2f[_0x4519dc(0xdf)](_0x1040a5=>{return _0x1040a5={'product_name':_0x1040a5};});_0xb2fba6[_0x4519dc(0x9f)]((_0x20ef43,_0xe559d1)=>{var _0x2a2769=_0x4519dc;_0x26efd0[_0xe559d1][_0x2a2769(0x17c)]=_0x20ef43;}),_0x569d4e[_0x4519dc(0x9f)]((_0x463531,_0x54a45c)=>{var _0x43c9e7=_0x4519dc;_0x26efd0[_0x54a45c][_0x43c9e7(0xae)]=Math[_0x43c9e7(0x14c)](_0x463531);}),_0x226358['forEach']((_0x4ef6bc,_0xb508fc)=>{var _0xf68e99=_0x4519dc;_0x26efd0[_0xb508fc][_0xf68e99(0x108)]=_0x4ef6bc;}),_0x1f4b49[_0x4519dc(0x9f)]((_0x2473c0,_0xf279bd)=>{var _0x39e284=_0x4519dc;_0x26efd0[_0xf279bd][_0x39e284(0xff)]=_0x2473c0;}),_0x3bb179[_0x4519dc(0x9f)]((_0x16c84c,_0x4cc2f2)=>{var _0x126895=_0x4519dc;_0x26efd0[_0x4cc2f2][_0x126895(0x121)]=_0x16c84c;}),_0x262312['forEach']((_0x5e7cd6,_0x48c524)=>{var _0x399b86=_0x4519dc;_0x26efd0[_0x48c524][_0x399b86(0xd4)]=_0x5e7cd6;}),_0x335086[_0x4519dc(0x9f)]((_0x4e2a8d,_0xbbdae2)=>{var _0x30811e=_0x4519dc;_0x26efd0[_0xbbdae2][_0x30811e(0xed)]=_0x4e2a8d;}),_0x3df95c['forEach']((_0x55b998,_0x53df7e)=>{var _0x4b1935=_0x4519dc;_0x26efd0[_0x53df7e][_0x4b1935(0xaf)]=_0x55b998;}),_0x12dbf6[_0x4519dc(0x9f)]((_0xeb40a2,_0x1ab353)=>{var _0x450d36=_0x4519dc;_0x26efd0[_0x1ab353][_0x450d36(0x173)]=_0xeb40a2;}),_0x5e5580['forEach']((_0x521522,_0x5498d8)=>{var _0x2f9c7e=_0x4519dc;_0x26efd0[_0x5498d8][_0x2f9c7e(0x13f)]=_0x521522;}),_0x4b3c74[_0x4519dc(0x9f)]((_0x1166d1,_0x3570e7)=>{var _0x23b7c8=_0x4519dc;_0x26efd0[_0x3570e7][_0x23b7c8(0x128)]=_0x1166d1;}),_0x30c079[_0x4519dc(0x9f)]((_0x5ef2c3,_0x1b49b2)=>{_0x26efd0[_0x1b49b2]['maxperunit']=_0x5ef2c3;}),_0x4a6bab[_0x4519dc(0x9f)]((_0x53bcbd,_0x22b991)=>{var _0x1582f0=_0x4519dc;_0x26efd0[_0x22b991][_0x1582f0(0x8b)]=_0x53bcbd;}),_0x44fe12[_0x4519dc(0x9f)]((_0x305e20,_0x27654f)=>{var _0x1ae5c4=_0x4519dc;_0x26efd0[_0x27654f][_0x1ae5c4(0xea)]=_0x305e20;}),_0x1b30c3[_0x4519dc(0x9f)]((_0x2fc14e,_0x27aab3)=>{var _0x25d38c=_0x4519dc;_0x26efd0[_0x27aab3][_0x25d38c(0x10f)]=_0x2fc14e;});const _0x184bfb=_0x26efd0[_0x4519dc(0xbb)](_0x2ccbd0=>_0x2ccbd0['quantity']!=='0'&&_0x2ccbd0['quantity']!==''),_0x5affe2=new purchases_finished({'invoice':_0x227213,'suppliers':_0x55745c[_0x4519dc(0x147)][_0x4519dc(0x10d)],'date':_0x3fc87f,'warehouse_name':_0x162106,'product':_0x184bfb,'note':_0x261ed5,'due_amount':_0x196d99,'room':_0x34109a,'POnumber':_0x599c83,'SCRN':_0xe35e9,'JO_number':_0x11eade}),_0x4dbf15=await _0x5affe2[_0x4519dc(0x15b)](),_0x3cb26f=await purchases_finished[_0x4519dc(0x132)]({'invoice':_0x227213}),_0x3ac523=_0x3cb26f['product'][_0x4519dc(0xdf)](async _0x351fad=>{var _0x4439d6=_0x4519dc,_0x3dddcf=await warehouse['findOne']({'name':_0x162106,'room':_0x351fad[_0x4439d6(0xea)]}),_0x35d924=0x0;const _0x127dfe=_0x3dddcf[_0x4439d6(0x120)]['map'](_0x3ec366=>{var _0x2b931a=_0x4439d6;console[_0x2b931a(0x131)](_0x3ec366[_0x2b931a(0x159)]+'=='+_0x351fad[_0x2b931a(0x159)]+'&&'+_0x3ec366[_0x2b931a(0x121)]+'=='+_0x351fad[_0x2b931a(0x121)]+'&&'+_0x3ec366[_0x2b931a(0x13f)]+'=='+_0x351fad[_0x2b931a(0x13f)]+'&&'+_0x3ec366['production_date']+'=='+_0x351fad['production_date']+'&&'+_0x3ec366['batch_code']+'=='+_0x351fad[_0x2b931a(0x173)]+'&&'+_0x3ec366[_0x2b931a(0x10f)]+'=='+_0x3cb26f['invoice']),_0x3ec366[_0x2b931a(0x159)]==_0x351fad['product_name']&&_0x3ec366['bay']==_0x351fad[_0x2b931a(0x121)]&&_0x3ec366[_0x2b931a(0x13f)]==_0x351fad[_0x2b931a(0x13f)]&&_0x3ec366[_0x2b931a(0x128)]==_0x351fad[_0x2b931a(0x128)]&&_0x3ec366[_0x2b931a(0x173)]==_0x351fad[_0x2b931a(0x173)]&&_0x3ec366[_0x2b931a(0x10f)]==_0x3cb26f[_0x2b931a(0x10f)]&&(_0x3ec366[_0x2b931a(0xb1)]=Math[_0x2b931a(0x14c)](_0x3ec366[_0x2b931a(0xb1)])+Math[_0x2b931a(0x14c)](_0x351fad[_0x2b931a(0xae)]),_0x35d924++);});return _0x35d924=='0'&&(_0x3dddcf[_0x4439d6(0x120)]=_0x3dddcf[_0x4439d6(0x120)]['concat']({'product_name':_0x351fad[_0x4439d6(0x159)],'product_stock':Math['abs'](_0x351fad[_0x4439d6(0xae)]),'primary_code':_0x351fad[_0x4439d6(0xd4)],'secondary_code':_0x351fad[_0x4439d6(0xed)],'product_code':_0x351fad['product_code'],'bay':_0x351fad[_0x4439d6(0x121)],'maxProducts':_0x351fad[_0x4439d6(0xaf)],'unit':_0x351fad[_0x4439d6(0x108)],'secondary_unit':_0x351fad[_0x4439d6(0xff)],'expiry_date':_0x351fad[_0x4439d6(0x13f)],'production_date':_0x351fad[_0x4439d6(0x128)],'maxProducts':_0x351fad[_0x4439d6(0xaf)],'maxPerUnit':_0x351fad[_0x4439d6(0xe9)],'batch_code':_0x351fad[_0x4439d6(0x173)],'product_cat':_0x351fad[_0x4439d6(0x8b)],'invoice':_0x351fad[_0x4439d6(0x10f)]})),_0x3dddcf;});Promise[_0x4519dc(0xbd)](_0x3ac523)[_0x4519dc(0xbe)](async _0x3b3394=>{var _0x377384=_0x4519dc;try{for(const _0x49b02c of _0x3b3394){await warehouse[_0x377384(0x12d)]({'_id':_0x49b02c[_0x377384(0xeb)]},{'$addToSet':{'product_details':{'$each':_0x49b02c[_0x377384(0x120)]}}});}const _0x3f0219=await master_shop[_0x377384(0xd9)](),_0x5f5b82=await email_settings['findOne'](),_0x249c9c=await supervisor_settings['find']();var _0x4038cb=_0x3cb26f[_0x377384(0xb9)],_0x4f2706='',_0x3de705;for(_0x3de705 in _0x4038cb){var _0x11b126='FG';_0x3cb26f[_0x377384(0x112)]==_0x377384(0x123)&&(_0x11b126='DG'),_0x4f2706+=_0x377384(0xda)+_0x377384(0x115)+_0x4038cb[_0x3de705][_0x377384(0x159)]+'</td>'+_0x377384(0x115)+_0x4038cb[_0x3de705][_0x377384(0x17c)]+_0x377384(0xf2)+_0x377384(0x115)+_0x4038cb[_0x3de705][_0x377384(0xae)]+_0x377384(0xf2)+_0x377384(0x115)+_0x4038cb[_0x3de705][_0x377384(0x108)]+_0x377384(0xf2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4038cb[_0x3de705][_0x377384(0xff)]+_0x377384(0xf2)+_0x377384(0x115)+_0x3cb26f['warehouse_name']+_0x377384(0xf2)+_0x377384(0x115)+_0x4038cb[_0x3de705]['room_name']+'</td>'+_0x377384(0x115)+_0x11b126+_0x4038cb[_0x3de705][_0x377384(0x121)]+'</td>',_0x377384(0x168);}let _0x39fb57=nodemailer[_0x377384(0xe3)]({'host':_0x5f5b82['host'],'port':Number(_0x5f5b82['port']),'secure':![],'auth':{'user':_0x5f5b82[_0x377384(0x160)],'pass':_0x5f5b82['password']}}),_0x1a3dcc={'from':_0x5f5b82[_0x377384(0x160)],'to':_0x249c9c[0x0][_0x377384(0x16c)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x377384(0x11a)+_0x377384(0xe5)+_0x3f0219[0x0]['image'],'cid':_0x377384(0x8a)}],'html':_0x377384(0x167)+_0x377384(0xaa)+_0x377384(0x83)+_0x377384(0x139)+_0x377384(0x141)+_0x377384(0x139)+_0x377384(0x15e)+'</div>'+_0x377384(0x139)+_0x377384(0xf5)+_0x3f0219[0x0]['site_title']+'\x20</h2>'+_0x377384(0x101)+_0x377384(0x101)+_0x377384(0x176)+_0x377384(0x139)+_0x377384(0xf7)+_0x377384(0x11c)+_0x3cb26f[_0x377384(0x10f)]+'\x20'+_0x377384(0x15d)+_0x377384(0x95)+_0x3cb26f[_0x377384(0xd1)]+'\x20'+_0x377384(0x151)+_0x377384(0x96)+_0x377384(0x101)+_0x377384(0xb2)+_0x377384(0x166)+_0x377384(0xda)+_0x377384(0xfb)+_0x377384(0xf9)+_0x377384(0xa9)+_0x377384(0x174)+_0x377384(0xf4)+_0x377384(0x16e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x377384(0xc5)+_0x377384(0x168)+_0x377384(0xc4)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4f2706+'\x20'+_0x377384(0x154)+'</table>'+_0x377384(0x139)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x3f0219[0x0][_0x377384(0xe1)]+_0x377384(0x96)+_0x377384(0x101)+_0x377384(0x101)+_0x377384(0x12a)};_0x39fb57['sendMail'](_0x1a3dcc,function(_0x1a8277,_0x5baae5){var _0x2018b6=_0x377384;_0x1a8277?(console[_0x2018b6(0x131)](_0x1a8277),console['log'](_0x2018b6(0x140))):console['log'](_0x2018b6(0x16f));});}catch(_0x3e37ae){console[_0x377384(0x153)](_0x3e37ae),_0x68261e[_0x377384(0x133)](0x1f4)['json']({'error':_0x377384(0x17b),'message':_0x3e37ae[_0x377384(0x91)]});}})[_0x4519dc(0x12c)](_0x1bf460=>{var _0x4962c7=_0x4519dc;console[_0x4962c7(0x153)](_0x1bf460),_0x68261e[_0x4962c7(0x133)](0x1f4)[_0x4962c7(0x162)]({'error':_0x4962c7(0xb6)});}),_0x55745c[_0x4519dc(0xec)](_0x4519dc(0xe8),_0x4519dc(0x125)),_0x68261e[_0x4519dc(0xc2)](_0x4519dc(0xd8));}catch(_0x5047cf){console[_0x4519dc(0x131)](_0x5047cf);}}),router[a0_0x190607(0xd2)](a0_0x190607(0xdd),auth,async(_0x36ca24,_0x129697)=>{var _0x35d6be=a0_0x190607;try{const {username:_0x43ca23,email:_0x1633fd,role:_0x3dd877}=_0x36ca24[_0x35d6be(0x9d)],_0x2e93d2=_0x36ca24[_0x35d6be(0x9d)],_0x457805=await profile[_0x35d6be(0x132)]({'email':_0x2e93d2['email']}),_0x1375a9=await master_shop['find'](),_0x22286f=_0x36ca24['params']['id'],_0x2fd215=await purchases_finished['findById'](_0x22286f),_0x16208a=await suppliers[_0x35d6be(0xd9)]({});let _0x5234da;if(_0x2e93d2[_0x35d6be(0xa2)]==_0x35d6be(0x126)){const _0xc47e91=await staff[_0x35d6be(0x132)]({'email':_0x2e93d2[_0x35d6be(0x160)]});_0x5234da=await warehouse[_0x35d6be(0xd9)]({'status':_0x35d6be(0x87),'name':_0xc47e91[_0x35d6be(0xd3)],'warehouse_category':_0x35d6be(0xf3)});}else _0x5234da=await warehouse['aggregate']([{'$match':{'status':_0x35d6be(0x87),'warehouse_category':_0x35d6be(0xf3)}},{'$group':{'_id':_0x35d6be(0x142),'name':{'$first':'$name'}}}]);const _0xf8f972=await product[_0x35d6be(0xd9)]({}),_0x5876fd=BayBinSelected(_0x2fd215['warehouse_name'],_0x2fd215[_0x35d6be(0x117)]);let _0x252c5b=new Date(_0x2fd215[_0x35d6be(0x13f)]),_0x1fbaf2=('0'+_0x252c5b[_0x35d6be(0xf6)]())[_0x35d6be(0xab)](-0x2),_0x30811f=('0'+(_0x252c5b[_0x35d6be(0xc3)]()+0x1))[_0x35d6be(0xab)](-0x2),_0x379214=_0x252c5b[_0x35d6be(0x14f)](),_0x86eaef=_0x379214+'-'+_0x30811f+'-'+_0x1fbaf2;if(_0x1375a9[0x0][_0x35d6be(0x14b)]==_0x35d6be(0x179)){var _0x45d608=users[_0x35d6be(0x119)];console[_0x35d6be(0x131)](_0x45d608);}else{if(_0x1375a9[0x0][_0x35d6be(0x14b)]=='Hindi')var _0x45d608=users[_0x35d6be(0x116)];else{if(_0x1375a9[0x0]['language']=='German')var _0x45d608=users['German'];else{if(_0x1375a9[0x0][_0x35d6be(0x14b)]=='Spanish')var _0x45d608=users[_0x35d6be(0x137)];else{if(_0x1375a9[0x0][_0x35d6be(0x14b)]=='French')var _0x45d608=users[_0x35d6be(0x143)];else{if(_0x1375a9[0x0][_0x35d6be(0x14b)]==_0x35d6be(0x145))var _0x45d608=users[_0x35d6be(0x16d)];else{if(_0x1375a9[0x0][_0x35d6be(0x14b)]=='Chinese')var _0x45d608=users['Chinese'];else{if(_0x1375a9[0x0]['language']=='Arabic\x20(ae)')var _0x45d608=users[_0x35d6be(0x135)];}}}}}}}_0x129697[_0x35d6be(0x169)](_0x35d6be(0x165),{'success':_0x36ca24[_0x35d6be(0xec)]('success'),'errors':_0x36ca24[_0x35d6be(0xec)](_0x35d6be(0x172)),'role':_0x2e93d2,'profile':_0x457805,'purchases':_0x2fd215,'suppliers':_0x16208a,'warehouse':_0x5234da,'product':_0xf8f972,'master_shop':_0x1375a9,'language':_0x45d608,'ed_fullDate':_0x86eaef,'dataSelected':_0x5876fd});}catch(_0x4c8c42){console[_0x35d6be(0x131)](_0x4c8c42);}}),router[a0_0x190607(0xd2)](a0_0x190607(0x84),auth,async(_0x21475f,_0xbb952c)=>{var _0x5a9da1=a0_0x190607;try{const {username:_0x354ab7,email:_0x2e9b99,role:_0xa34c73}=_0x21475f[_0x5a9da1(0x9d)],_0x39a47d=_0x21475f[_0x5a9da1(0x9d)],_0x5cc82f=await profile[_0x5a9da1(0x132)]({'email':_0x39a47d['email']}),_0x4c8ee4=await master_shop['find'](),_0x38003a=_0x21475f[_0x5a9da1(0x98)]['id'],_0x34f3dd=await purchases_finished['findById'](_0x38003a),_0x6460e=await suppliers[_0x5a9da1(0xd9)]({});let _0x140c24;if(_0x39a47d[_0x5a9da1(0xa2)]=='staff'){const _0x37d73c=await staff[_0x5a9da1(0x132)]({'email':_0x39a47d['email']});_0x140c24=await warehouse['find']({'status':_0x5a9da1(0x87),'name':_0x37d73c[_0x5a9da1(0xd3)],'warehouse_category':_0x5a9da1(0xf3)});}else _0x140c24=await warehouse['aggregate']([{'$match':{'status':_0x5a9da1(0x87),'warehouse_category':_0x5a9da1(0xf3)}},{'$group':{'_id':_0x5a9da1(0x142),'name':{'$first':'$name'}}}]);const _0x12bb01=await product['find']({}),_0x2a0262=BayBinSelected(_0x34f3dd[_0x5a9da1(0x112)],_0x34f3dd[_0x5a9da1(0x117)]);let _0x27ff1b=new Date(_0x34f3dd[_0x5a9da1(0x13f)]),_0x40a1e2=('0'+_0x27ff1b['getDate']())[_0x5a9da1(0xab)](-0x2),_0x46cf82=('0'+(_0x27ff1b['getMonth']()+0x1))[_0x5a9da1(0xab)](-0x2),_0x51264c=_0x27ff1b[_0x5a9da1(0x14f)](),_0x81e5e4=_0x51264c+'-'+_0x46cf82+'-'+_0x40a1e2;if(_0x4c8ee4[0x0][_0x5a9da1(0x14b)]=='English\x20(US)'){var _0x2c3351=users[_0x5a9da1(0x119)];console[_0x5a9da1(0x131)](_0x2c3351);}else{if(_0x4c8ee4[0x0][_0x5a9da1(0x14b)]=='Hindi')var _0x2c3351=users['Hindi'];else{if(_0x4c8ee4[0x0][_0x5a9da1(0x14b)]==_0x5a9da1(0xc8))var _0x2c3351=users['German'];else{if(_0x4c8ee4[0x0][_0x5a9da1(0x14b)]=='Spanish')var _0x2c3351=users[_0x5a9da1(0x137)];else{if(_0x4c8ee4[0x0][_0x5a9da1(0x14b)]=='French')var _0x2c3351=users[_0x5a9da1(0x143)];else{if(_0x4c8ee4[0x0][_0x5a9da1(0x14b)]==_0x5a9da1(0x145))var _0x2c3351=users[_0x5a9da1(0x16d)];else{if(_0x4c8ee4[0x0]['language']==_0x5a9da1(0xd6))var _0x2c3351=users['Chinese'];else{if(_0x4c8ee4[0x0][_0x5a9da1(0x14b)]==_0x5a9da1(0xf8))var _0x2c3351=users[_0x5a9da1(0x135)];}}}}}}}_0xbb952c[_0x5a9da1(0x169)]('edit_purchases_finished',{'success':_0x21475f[_0x5a9da1(0xec)](_0x5a9da1(0xe8)),'errors':_0x21475f[_0x5a9da1(0xec)](_0x5a9da1(0x172)),'role':_0x39a47d,'profile':_0x5cc82f,'purchases':_0x34f3dd,'suppliers':_0x6460e,'warehouse':_0x140c24,'product':_0x12bb01,'master_shop':_0x4c8ee4,'language':_0x2c3351,'ed_fullDate':_0x81e5e4,'dataSelected':_0x2a0262});}catch(_0x4eae92){console['log'](_0x4eae92);}}),router[a0_0x190607(0xac)]('/view/:id',auth,async(_0x5b81ed,_0xb561c1)=>{var _0x545d52=a0_0x190607;try{const _0x2d910b=_0x5b81ed[_0x545d52(0x98)]['id'],_0x5afaa9=await purchases_finished['findOne']({'_id':_0x5b81ed[_0x545d52(0x98)]['id']}),_0x15b383=await warehouse['findOne']({'name':_0x5afaa9[_0x545d52(0x112)],'room':_0x5afaa9[_0x545d52(0x117)]});_0x5afaa9['product']['forEach'](_0x2dfe14=>{var _0x3e6204=_0x545d52;const _0x4bb557=_0x15b383[_0x3e6204(0x120)]['map'](_0xd4333a=>{var _0x397b3a=_0x3e6204;_0xd4333a['product_name']==_0x2dfe14[_0x397b3a(0x159)]&&_0xd4333a[_0x397b3a(0x121)]==_0x2dfe14['bay']&&(_0xd4333a['product_stock']=parseInt(_0xd4333a['product_stock'])-parseInt(_0x2dfe14[_0x397b3a(0xae)]));});}),await _0x15b383['save']();const {invoice:_0x2b4d25,suppliers:_0x3a8ce5,date:_0x6601fa,warehouse_name:_0x448d01,prod_name:_0x5a00e5,prod_code:_0xab9a67,prod_qty:_0x571118,prod_unit:_0x54b335,prod_secondunit:_0x787813,prod_level:_0x189bcc,prod_isle:_0x25ae0c,prod_pallet:_0x18f955,note:_0x108fcb,expiry_date:_0x4f4667,batch_code:_0x29955f,paid_amount:_0x4d4c30,due_amount:_0x5e450e,Room_name:_0x492e34,primary_code:_0x18bc71,secondary_code:_0xbe9a81,PO_number:_0x1739f9,JO_number:_0x487017}=_0x5b81ed[_0x545d52(0x147)];if(typeof _0x5a00e5==_0x545d52(0x9b))var _0xec22e7=[_0x5b81ed[_0x545d52(0x147)][_0x545d52(0x103)]],_0x46f90c=[_0x5b81ed[_0x545d52(0x147)][_0x545d52(0x156)]],_0x4ac847=[_0x5b81ed[_0x545d52(0x147)][_0x545d52(0x105)]],_0x5b8152=[_0x5b81ed['body'][_0x545d52(0xe6)]],_0x16b5dd=[_0x5b81ed['body'][_0x545d52(0xa6)]],_0x33324a=[_0x5b81ed[_0x545d52(0x147)][_0x545d52(0x122)]],_0x976bba=[_0x5b81ed[_0x545d52(0x147)]['primary_code']],_0x16efdb=[_0x5b81ed[_0x545d52(0x147)][_0x545d52(0xed)]],_0x5069d8=[_0x5b81ed[_0x545d52(0x147)][_0x545d52(0xa1)]],_0x12752d=[_0x5b81ed[_0x545d52(0x147)]['batch_code']],_0x22356f=[_0x5b81ed[_0x545d52(0x147)][_0x545d52(0x13f)]];else var _0xec22e7=[..._0x5b81ed[_0x545d52(0x147)][_0x545d52(0x103)]],_0x46f90c=[..._0x5b81ed[_0x545d52(0x147)][_0x545d52(0x156)]],_0x4ac847=[..._0x5b81ed[_0x545d52(0x147)][_0x545d52(0x105)]],_0x5b8152=[..._0x5b81ed['body'][_0x545d52(0xe6)]],_0x16b5dd=[..._0x5b81ed['body'][_0x545d52(0xa6)]],_0x33324a=[..._0x5b81ed['body'][_0x545d52(0x122)]],_0x976bba=[..._0x5b81ed['body'][_0x545d52(0xd4)]],_0x16efdb=[..._0x5b81ed['body'][_0x545d52(0xed)]],_0x5069d8=[..._0x5b81ed['body'][_0x545d52(0xa1)]],_0x12752d=[..._0x5b81ed[_0x545d52(0x147)]['batch_code']],_0x22356f=[..._0x5b81ed[_0x545d52(0x147)][_0x545d52(0x13f)]];const _0x4d71c7=_0xec22e7[_0x545d52(0xdf)](_0x2f6a5c=>{return _0x2f6a5c={'product_name':_0x2f6a5c};});_0x46f90c[_0x545d52(0x9f)]((_0xae9d5e,_0x45a02b)=>{_0x4d71c7[_0x45a02b]['product_code']=_0xae9d5e;}),_0x4ac847[_0x545d52(0x9f)]((_0x28432f,_0x3ae8ac)=>{var _0xfe3bbc=_0x545d52;_0x4d71c7[_0x3ae8ac][_0xfe3bbc(0xae)]=_0x28432f;}),_0x5b8152[_0x545d52(0x9f)]((_0xfa3e1f,_0x48fede)=>{var _0x306650=_0x545d52;_0x4d71c7[_0x48fede][_0x306650(0x108)]=_0xfa3e1f;}),_0x16b5dd[_0x545d52(0x9f)]((_0x54c3f4,_0x4e754c)=>{var _0x4d0cd3=_0x545d52;_0x4d71c7[_0x4e754c][_0x4d0cd3(0xff)]=_0x54c3f4;}),_0x33324a[_0x545d52(0x9f)]((_0x106a48,_0x12f7b9)=>{var _0x39dd5c=_0x545d52;_0x4d71c7[_0x12f7b9][_0x39dd5c(0x121)]=_0x106a48;}),_0x976bba[_0x545d52(0x9f)]((_0x3b6f74,_0x54c4d7)=>{var _0x5c7e90=_0x545d52;_0x4d71c7[_0x54c4d7][_0x5c7e90(0xd4)]=_0x3b6f74;}),_0x16efdb[_0x545d52(0x9f)]((_0xb5ab3e,_0x394e9d)=>{var _0x297ccb=_0x545d52;_0x4d71c7[_0x394e9d][_0x297ccb(0xed)]=_0xb5ab3e;}),_0x5069d8[_0x545d52(0x9f)]((_0x3b8543,_0x2a5557)=>{_0x4d71c7[_0x2a5557]['maxStocks']=_0x3b8543;}),_0x12752d['forEach']((_0x1b8a94,_0x384c3b)=>{var _0x29d2d7=_0x545d52;_0x4d71c7[_0x384c3b][_0x29d2d7(0x173)]=_0x1b8a94;}),_0x22356f[_0x545d52(0x9f)]((_0x4ca4aa,_0x300378)=>{var _0x253c0f=_0x545d52;_0x4d71c7[_0x300378][_0x253c0f(0x13f)]=_0x4ca4aa;});const _0x61bfa=_0x4d71c7[_0x545d52(0xbb)](_0x2e3339=>_0x2e3339[_0x545d52(0xae)]!=='0'&&_0x2e3339['quantity']!=='');_0x5afaa9[_0x545d52(0x10f)]=_0x2b4d25,_0x5afaa9['suppliers']=_0x3a8ce5,_0x5afaa9[_0x545d52(0xd1)]=_0x6601fa,_0x5afaa9[_0x545d52(0x112)]=_0x448d01,_0x5afaa9['product']=_0x61bfa,_0x5afaa9[_0x545d52(0x9e)]=_0x108fcb,_0x5afaa9[_0x545d52(0xbf)]=_0x4d4c30,_0x5afaa9['due_amount']=_0x5e450e,_0x5afaa9[_0x545d52(0x117)]=_0x492e34,_0x5afaa9[_0x545d52(0x99)]=_0x1739f9,_0x5afaa9[_0x545d52(0xcd)]=_0x487017;const _0x506a13=await _0x5afaa9[_0x545d52(0x15b)](),_0x28f254=await warehouse['findOne']({'name':_0x5b81ed['body']['warehouse_name'],'room':_0x5b81ed[_0x545d52(0x147)][_0x545d52(0x158)]});_0x5afaa9[_0x545d52(0xb9)][_0x545d52(0x9f)](_0x5cbfd4=>{var _0x2dbd78=_0x545d52,_0x177daa=0x0;const _0xd4d1=_0x28f254[_0x2dbd78(0x120)][_0x2dbd78(0xdf)](_0x39dbc1=>{var _0x52ebc8=_0x2dbd78;_0x39dbc1[_0x52ebc8(0x159)]==_0x5cbfd4['product_name']&&_0x39dbc1['bay']==_0x5cbfd4[_0x52ebc8(0x121)]&&(_0x39dbc1[_0x52ebc8(0xb1)]=parseInt(_0x39dbc1['product_stock'])+parseInt(_0x5cbfd4[_0x52ebc8(0xae)]),_0x177daa++);});_0x177daa=='0'&&(_0x28f254[_0x2dbd78(0x120)]=_0x28f254[_0x2dbd78(0x120)]['concat']({'product_name':_0x5cbfd4[_0x2dbd78(0x159)],'product_stock':_0x5cbfd4['quantity'],'primary_code':_0x5cbfd4[_0x2dbd78(0xd4)],'secondary_code':_0x5cbfd4[_0x2dbd78(0xed)],'product_code':_0x5cbfd4[_0x2dbd78(0x17c)],'bay':_0x5cbfd4[_0x2dbd78(0x121)],'maxProducts':_0x5cbfd4[_0x2dbd78(0xaf)],'unit':_0x5cbfd4[_0x2dbd78(0x108)],'secondary_unit':_0x5cbfd4[_0x2dbd78(0xff)],'expiry_date':_0x5cbfd4[_0x2dbd78(0x13f)]}));}),await _0x28f254['save']();const _0xd6cb17=await s_payment_data['findOne']({'invoice':_0x5b81ed[_0x545d52(0x147)]['invoice']});if(_0xd6cb17===null){}else console[_0x545d52(0x131)](_0x545d52(0x10d),_0xd6cb17,_0x5b81ed[_0x545d52(0x147)][_0x545d52(0x10f)]),_0xd6cb17['suppliers']=_0x5b81ed[_0x545d52(0x147)][_0x545d52(0x10d)],await _0xd6cb17[_0x545d52(0x15b)]();_0x5b81ed[_0x545d52(0xec)](_0x545d52(0xe8),_0x545d52(0x149)),_0xb561c1['redirect'](_0x545d52(0xd8));}catch(_0x12c58d){console[_0x545d52(0x131)](_0x12c58d);}}),router[a0_0x190607(0xac)]('/give_payment/:id',auth,async(_0x4d881b,_0x29b89b)=>{var _0xa96d7b=a0_0x190607;try{const _0x51b17b=_0x4d881b[_0xa96d7b(0x98)]['id'],{invoice:_0x2fde7,suppliers:_0x4e6701,payable:_0x38a312,due_amount:_0x1bc917}=_0x4d881b[_0xa96d7b(0x147)],_0x1c66a4=await purchases[_0xa96d7b(0x13a)](_0x51b17b);var _0x58b963=_0x38a312-_0x1bc917;_0x1c66a4['paid_amount']=parseFloat(_0x1c66a4[_0xa96d7b(0xbf)])+parseFloat(_0x1bc917),_0x1c66a4[_0xa96d7b(0x89)]=_0x58b963;const _0x3c639b=await _0x1c66a4[_0xa96d7b(0x15b)]();console[_0xa96d7b(0x131)](_0x3c639b);const _0x4c55b3=await s_payment_data[_0xa96d7b(0x132)]({'invoice':_0x2fde7});_0x4c55b3['amount']=_0x58b963,await _0x4c55b3[_0xa96d7b(0x15b)]();let _0x49b589=new Date(),_0xe2c1af=('0'+_0x49b589['getDate']())[_0xa96d7b(0xab)](-0x2),_0x1f0f6c=('0'+(_0x49b589[_0xa96d7b(0xc3)]()+0x1))['slice'](-0x2),_0x213da1=_0x49b589[_0xa96d7b(0x14f)](),_0x40e345=_0x213da1+'-'+_0x1f0f6c+'-'+_0xe2c1af;const _0x53d90a=new suppliers_payment({'invoice':_0x2fde7,'date':_0x213da1+'-'+_0x1f0f6c+'-'+_0xe2c1af,'suppliers':_0x4e6701,'reason':'Paid\x20For\x20Purchase','amount':_0x1bc917}),_0x75ccbe=await _0x53d90a[_0xa96d7b(0x15b)]();_0x4d881b[_0xa96d7b(0xec)](_0xa96d7b(0xe8),_0xa96d7b(0x12f)),_0x29b89b[_0xa96d7b(0xc2)](_0xa96d7b(0x17f));}catch(_0x37dda4){console[_0xa96d7b(0x131)](_0x37dda4);}}),router['get']('/invoice/:id',auth,async(_0x3f7ff0,_0x51a7e8)=>{var _0x46e142=a0_0x190607;try{const {username:_0x2f1a1a,email:_0x2fee81,role:_0x46edc3}=_0x3f7ff0[_0x46e142(0x9d)],_0x4acee4=_0x3f7ff0[_0x46e142(0x9d)],_0x42b061=await profile['findOne']({'email':_0x4acee4[_0x46e142(0x160)]}),_0x45da45=await master_shop['find']();console[_0x46e142(0x131)](_0x46e142(0x17e),_0x45da45);const _0x290f82=_0x3f7ff0['params']['id'],_0x47b2c4=await purchases[_0x46e142(0x13a)](_0x290f82);console[_0x46e142(0x131)](_0x47b2c4);const _0x1d5656=await suppliers[_0x46e142(0x132)]({'name':_0x47b2c4[_0x46e142(0x10d)]});console[_0x46e142(0x131)](_0x1d5656);if(_0x45da45[0x0][_0x46e142(0x14b)]==_0x46e142(0x179)){var _0x546e37=users[_0x46e142(0x119)];console['log'](_0x546e37);}else{if(_0x45da45[0x0]['language']==_0x46e142(0x116))var _0x546e37=users['Hindi'];else{if(_0x45da45[0x0][_0x46e142(0x14b)]==_0x46e142(0xc8))var _0x546e37=users[_0x46e142(0xc8)];else{if(_0x45da45[0x0]['language']==_0x46e142(0x137))var _0x546e37=users[_0x46e142(0x137)];else{if(_0x45da45[0x0][_0x46e142(0x14b)]==_0x46e142(0x143))var _0x546e37=users['French'];else{if(_0x45da45[0x0][_0x46e142(0x14b)]=='Portuguese\x20(BR)')var _0x546e37=users[_0x46e142(0x16d)];else{if(_0x45da45[0x0][_0x46e142(0x14b)]==_0x46e142(0xd6))var _0x546e37=users[_0x46e142(0xd6)];else{if(_0x45da45[0x0][_0x46e142(0x14b)]==_0x46e142(0xf8))var _0x546e37=users[_0x46e142(0x135)];}}}}}}}_0x51a7e8[_0x46e142(0x169)](_0x46e142(0xfd),{'success':_0x3f7ff0[_0x46e142(0xec)]('success'),'errors':_0x3f7ff0[_0x46e142(0xec)](_0x46e142(0x172)),'role':_0x4acee4,'profile':_0x42b061,'master_shop':_0x45da45,'supplier':_0x1d5656,'purchase':_0x47b2c4,'language':_0x546e37});}catch(_0x2a2ae5){console[_0x46e142(0x131)](_0x2a2ae5);}}),router[a0_0x190607(0xd2)](a0_0x190607(0xc7),auth,async(_0x5f26dd,_0x1ae053)=>{var _0x31b718=a0_0x190607;try{const {username:_0x38a74d,email:_0x4273a9,role:_0x436654}=_0x5f26dd['user'],_0x1af3fc=_0x5f26dd['user'],_0x25dc0c=await profile[_0x31b718(0x132)]({'email':_0x1af3fc[_0x31b718(0x160)]}),_0x27ee02=await master_shop[_0x31b718(0xd9)]();console['log'](_0x31b718(0x17e),_0x27ee02);const _0x4588df=_0x5f26dd['params']['id'];console[_0x31b718(0x131)](_0x4588df);const _0x1cca22=await purchases_finished['findById'](_0x4588df);console[_0x31b718(0x131)](_0x31b718(0x13e),_0x1cca22);const _0x5727c7=await product[_0x31b718(0xd9)]({}),_0x1f24f0=await warehouse[_0x31b718(0x134)]([{'$match':{'name':_0x1cca22[_0x31b718(0x112)],'room':_0x1cca22[_0x31b718(0x117)]}},{'$unwind':_0x31b718(0x104)},{'$group':{'_id':_0x31b718(0x170),'name':{'$first':_0x31b718(0x118)},'product_stock':{'$first':_0x31b718(0x178)},'bay':{'$first':_0x31b718(0x8f)},'bin':{'$first':_0x31b718(0xe4)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x31b718(0x88)},'primary_code':{'$first':_0x31b718(0xee)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x31b718(0x16b)},'rack':{'$first':_0x31b718(0xcf)}}}]);console['log'](_0x31b718(0xb5),_0x1f24f0);let _0x3935c6;if(_0x1af3fc['role']==_0x31b718(0x126)){const _0x3aeb39=await staff['findOne']({'email':_0x1af3fc[_0x31b718(0x160)]});_0x3935c6=await warehouse[_0x31b718(0xd9)]({'status':_0x31b718(0x87),'name':_0x3aeb39[_0x31b718(0xd3)],'warehouse_category':_0x31b718(0xf3),'name':_0x31b718(0x9a)});}else _0x3935c6=await warehouse[_0x31b718(0x134)]([{'$match':{'status':_0x31b718(0x87),'warehouse_category':_0x31b718(0xf3),'name':'Return\x20Goods'}},{'$group':{'_id':_0x31b718(0x142),'name':{'$first':_0x31b718(0x142)}}}]);if(_0x27ee02[0x0][_0x31b718(0x14b)]==_0x31b718(0x179)){var _0x1dd016=users['English'];console['log'](_0x1dd016);}else{if(_0x27ee02[0x0][_0x31b718(0x14b)]==_0x31b718(0x116))var _0x1dd016=users[_0x31b718(0x116)];else{if(_0x27ee02[0x0][_0x31b718(0x14b)]=='German')var _0x1dd016=users['German'];else{if(_0x27ee02[0x0][_0x31b718(0x14b)]==_0x31b718(0x137))var _0x1dd016=users['Spanish'];else{if(_0x27ee02[0x0][_0x31b718(0x14b)]=='French')var _0x1dd016=users[_0x31b718(0x143)];else{if(_0x27ee02[0x0][_0x31b718(0x14b)]==_0x31b718(0x145))var _0x1dd016=users[_0x31b718(0x16d)];else{if(_0x27ee02[0x0]['language']==_0x31b718(0xd6))var _0x1dd016=users[_0x31b718(0xd6)];else{if(_0x27ee02[0x0][_0x31b718(0x14b)]=='Arabic\x20(ae)')var _0x1dd016=users[_0x31b718(0x135)];}}}}}}}_0x1ae053[_0x31b718(0x169)]('return_purchase_finished',{'success':_0x5f26dd[_0x31b718(0xec)](_0x31b718(0xe8)),'errors':_0x5f26dd[_0x31b718(0xec)]('errors'),'role':_0x1af3fc,'profile':_0x25dc0c,'user':_0x1cca22,'stock':_0x1f24f0,'master_shop':_0x27ee02,'product':_0x5727c7,'language':_0x1dd016,'warehouse':_0x3935c6});}catch(_0x4a0330){console[_0x31b718(0x131)](_0x4a0330);}}),router['post'](a0_0x190607(0xc7),auth,async(_0x4db95c,_0x3cdd5e)=>{var _0x32dc48=a0_0x190607;try{const {invoice:_0x3f900a,date:_0x3120c1,warehouse_name:_0x31dab1,Room_name:_0x548be5,product_name:_0x5eb7d0,purchase_quantity:_0x2c6726,stocks:_0x19fe26,return_qty:_0x5d9fc3,note:_0x430993,level:_0x47a262,isle:_0x43265c,pallet:_0x23a049,to_warehouse_name:_0x56347a,to_Room_name:_0x57b58d}=_0x4db95c['body'],_0x23cebf=await purchases_finished[_0x32dc48(0x132)]({'_id':_0x4db95c['params']['id']}),_0x2d9b92=await warehouse[_0x32dc48(0x132)]({'name':_0x31dab1,'room':_0x548be5,'warehouse_category':'Finished\x20Goods'});if(typeof _0x5eb7d0=='string')var _0x37dfb0=[_0x4db95c[_0x32dc48(0x147)]['product_name']],_0x463869=[_0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x92)]],_0x290afd=[_0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x11b)]],_0xd834c5=[_0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x138)]],_0x2aaef9=[_0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x17d)]],_0x5caf9c=[_0x4db95c['body'][_0x32dc48(0x10a)]],_0x495db7=[_0x4db95c['body'][_0x32dc48(0x11d)]],_0x42f8f9=[_0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x8c)]];else var _0x37dfb0=[..._0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x159)]],_0x463869=[..._0x4db95c['body']['purchase_quantity']],_0x290afd=[..._0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x11b)]],_0xd834c5=[..._0x4db95c['body']['return_qty']],_0x2aaef9=[..._0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x17d)]],_0x5caf9c=[..._0x4db95c[_0x32dc48(0x147)]['product_code_hide']],_0x495db7=[..._0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x11d)]],_0x42f8f9=[..._0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x8c)]];const _0x26e83d=_0x37dfb0[_0x32dc48(0xdf)](_0x2ff896=>{return _0x2ff896={'product_name':_0x2ff896};});_0x463869[_0x32dc48(0x9f)]((_0x9a43c1,_0x308e79)=>{var _0x454b2a=_0x32dc48;_0x26e83d[_0x308e79][_0x454b2a(0x92)]=_0x9a43c1;}),_0x290afd[_0x32dc48(0x9f)]((_0x903071,_0x46e50a)=>{var _0x4f9284=_0x32dc48;_0x26e83d[_0x46e50a][_0x4f9284(0x11f)]=_0x903071;}),_0xd834c5[_0x32dc48(0x9f)]((_0x152d88,_0x3708c2)=>{_0x26e83d[_0x3708c2]['return_qty']=_0x152d88;}),_0x2aaef9[_0x32dc48(0x9f)]((_0x57a28c,_0x5bb5d2)=>{_0x26e83d[_0x5bb5d2]['bay']=_0x57a28c;}),_0x5caf9c[_0x32dc48(0x9f)]((_0x553087,_0x171db7)=>{var _0x1a35fa=_0x32dc48;_0x26e83d[_0x171db7][_0x1a35fa(0x17c)]=_0x553087;}),_0x495db7['forEach']((_0x1b7d9e,_0x3e6f96)=>{var _0x39ade9=_0x32dc48;_0x26e83d[_0x3e6f96][_0x39ade9(0xd4)]=_0x1b7d9e;}),_0x42f8f9[_0x32dc48(0x9f)]((_0x6e9993,_0x47d3c5)=>{var _0x2927de=_0x32dc48;_0x26e83d[_0x47d3c5][_0x2927de(0xed)]=_0x6e9993;}),_0x26e83d[_0x32dc48(0x9f)](_0xb784a9=>{var _0x48e48e=_0x32dc48;console['log'](_0xb784a9);const _0x578aea=_0x2d9b92[_0x48e48e(0x120)]['map'](_0x92c8c=>{var _0xe73336=_0x48e48e;_0x92c8c[_0xe73336(0x159)]==_0xb784a9[_0xe73336(0x159)]&&_0x92c8c[_0xe73336(0x121)]==_0xb784a9[_0xe73336(0x121)]&&(console[_0xe73336(0x131)](parseInt(_0x92c8c[_0xe73336(0xb1)])+'\x20<>\x20'+parseInt(_0xb784a9[_0xe73336(0x138)])),_0x92c8c[_0xe73336(0xb1)]=parseInt(_0x92c8c[_0xe73336(0xb1)])-parseInt(_0xb784a9[_0xe73336(0x138)]));});}),await _0x2d9b92[_0x32dc48(0x15b)]();var _0x2f6860=0x0;_0x26e83d[_0x32dc48(0x9f)](_0x2cf631=>{var _0x2df9e4=_0x32dc48;(parseInt(_0x2cf631['purchase_quantity'])<parseInt(_0x2cf631[_0x2df9e4(0x138)])||parseInt(_0x2cf631[_0x2df9e4(0x11f)])<parseInt(_0x2cf631[_0x2df9e4(0x138)]))&&_0x2f6860++;});if(_0x2f6860!=0x0)return _0x4db95c[_0x32dc48(0xec)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3cdd5e[_0x32dc48(0xc2)](_0x32dc48(0x13b));const _0x18ca83=new purchases_return_finished({'invoice':_0x3f900a,'suppliers':_0x4db95c['body'][_0x32dc48(0x10d)],'date':_0x3120c1,'warehouse_name':_0x31dab1,'return_product':_0x26e83d,'note':_0x430993,'room':_0x548be5,'to_warehouse_name':_0x56347a,'to_room':_0x57b58d}),_0x2b51e0=await _0x18ca83['save'](),_0x495996=await purchases_return_finished['findOne']({'invoice':_0x3f900a}),_0x391fe2=await warehouse[_0x32dc48(0x132)]({'name':_0x56347a,'room':_0x57b58d,'warehouse_category':'Finished\x20Goods'});_0x495996[_0x32dc48(0x13d)][_0x32dc48(0x9f)](_0x5f4a59=>{var _0x2a7c8a=_0x32dc48,_0x570cbd=0x0;const _0xd4b353=_0x391fe2['product_details'][_0x2a7c8a(0xdf)](_0x2a3a68=>{var _0x5a7483=_0x2a7c8a;console['log'](_0x2a3a68['product_name']+'=='+_0x5f4a59[_0x5a7483(0x159)]+'&&'+_0x2a3a68[_0x5a7483(0x121)]+'=='+_0x5f4a59['bay']),_0x2a3a68[_0x5a7483(0x159)]==_0x5f4a59['product_name']&&_0x2a3a68['bay']==_0x5f4a59[_0x5a7483(0x121)]&&(_0x2a3a68['product_stock']=parseInt(_0x2a3a68[_0x5a7483(0xb1)])-parseInt(_0x5f4a59[_0x5a7483(0x138)]),_0x570cbd++);});_0x570cbd=='0'&&(_0x391fe2[_0x2a7c8a(0x120)]=_0x391fe2['product_details'][_0x2a7c8a(0xb0)]({'product_name':_0x5f4a59[_0x2a7c8a(0x159)],'product_stock':_0x5f4a59[_0x2a7c8a(0x138)],'primary_code':_0x5f4a59[_0x2a7c8a(0xd4)],'secondary_code':_0x5f4a59[_0x2a7c8a(0xed)],'product_code':_0x5f4a59[_0x2a7c8a(0x17c)],'bay':_0x5f4a59[_0x2a7c8a(0x121)],'maxProducts':0xf423f}));}),await _0x391fe2['save']();const _0x31d83a=await purchases_finished[_0x32dc48(0x132)]({'invoice':_0x3f900a});_0x31d83a[_0x32dc48(0x177)]=_0x32dc48(0x152);const _0xc5d637=await _0x31d83a['save'](),_0x1943b2=new s_payment_data({'invoice':_0x3f900a,'suppliers':_0x4db95c['body'][_0x32dc48(0x10d)],'reason':_0x32dc48(0xfa)});await _0x1943b2['save']();const _0x438778=await master_shop['find'](),_0xbb4ed5=await email_settings[_0x32dc48(0x132)](),_0x353d26=await suppliers[_0x32dc48(0x132)]({'name':_0x4db95c[_0x32dc48(0x147)][_0x32dc48(0x10d)]});_0x438778[0x0][_0x32dc48(0x164)]==0x1?(right_currency=_0x438778[0x0][_0x32dc48(0xad)],left_currency=''):(right_currency='',left_currency=_0x438778[0x0][_0x32dc48(0xad)]);var _0x34df73=_0x37dfb0,_0xa5815a=_0xd834c5,_0x5ca061='',_0x54df80;for(_0x54df80 in _0x34df73){_0x5ca061+=_0x32dc48(0xda)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34df73[_0x54df80]+'</td>'+_0x32dc48(0x115)+_0xa5815a[_0x54df80]+'</td>'+'</tr>';}let _0x4a918d=nodemailer['createTransport']({'service':_0x32dc48(0xc6),'auth':{'user':_0xbb4ed5[_0x32dc48(0x160)],'pass':_0xbb4ed5['password']}}),_0x15cde9={'from':_0xbb4ed5['email'],'to':_0x353d26[_0x32dc48(0x160)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x32dc48(0x100),'path':__dirname+'/../public'+_0x32dc48(0xe5)+_0x438778[0x0][_0x32dc48(0xca)],'cid':_0x32dc48(0x8a)}],'html':_0x32dc48(0x167)+'<html><head><title></title>'+_0x32dc48(0x83)+_0x32dc48(0x139)+_0x32dc48(0x141)+_0x32dc48(0x139)+_0x32dc48(0x15e)+_0x32dc48(0x101)+_0x32dc48(0x139)+_0x32dc48(0xf5)+_0x438778[0x0][_0x32dc48(0xe1)]+_0x32dc48(0x15a)+_0x32dc48(0x101)+_0x32dc48(0x101)+_0x32dc48(0x176)+_0x32dc48(0x139)+_0x32dc48(0xf7)+_0x32dc48(0x11c)+_0x3f900a+'\x20'+_0x32dc48(0x15d)+_0x32dc48(0x95)+_0x3120c1+'\x20'+'</span>'+_0x32dc48(0x96)+_0x32dc48(0x101)+_0x32dc48(0xb2)+_0x32dc48(0x166)+_0x32dc48(0xda)+_0x32dc48(0xfb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x32dc48(0xe7)+_0x32dc48(0x114)+_0x32dc48(0x168)+_0x32dc48(0xc4)+_0x32dc48(0x106)+'\x20'+_0x5ca061+'\x20'+_0x32dc48(0x154)+'</table>'+_0x32dc48(0x139)+_0x32dc48(0x15c)+_0x32dc48(0xe0)+_0x438778[0x0]['site_title']+'</h5>'+'</div>'+_0x32dc48(0x101)+_0x32dc48(0x12a)};_0x4a918d[_0x32dc48(0xbc)](_0x15cde9,function(_0x11eb6b,_0x1738ce){var _0x2e810c=_0x32dc48;_0x11eb6b?console[_0x2e810c(0x131)](_0x2e810c(0x140)):console[_0x2e810c(0x131)](_0x2e810c(0x16f));}),_0x4db95c['flash'](_0x32dc48(0xe8),_0x32dc48(0xf0)),_0x3cdd5e[_0x32dc48(0xc2)](_0x32dc48(0xd8));}catch(_0x133856){_0x3cdd5e[_0x32dc48(0x133)](0xc8)['json']({'message':_0x133856[_0x32dc48(0x91)]});}}),router['get'](a0_0x190607(0x129),auth,async(_0x3df3b1,_0x45b763)=>{var _0x7bb448=a0_0x190607;try{const {username:_0x1ccb8e,email:_0xb92cf4,role:_0xe3e3be}=_0x3df3b1[_0x7bb448(0x9d)],_0x31a0e9=_0x3df3b1[_0x7bb448(0x9d)],_0x30cad5=await profile[_0x7bb448(0x132)]({'email':_0x31a0e9[_0x7bb448(0x160)]}),_0x2f58fe=await master_shop[_0x7bb448(0xd9)](),_0x845f81=_0x3df3b1[_0x7bb448(0x98)]['id'],_0x190b8a=await purchases_finished[_0x7bb448(0x13a)](_0x845f81);if(_0x2f58fe[0x0][_0x7bb448(0x14b)]=='English\x20(US)')var _0x50770d=users['English'];else{if(_0x2f58fe[0x0][_0x7bb448(0x14b)]==_0x7bb448(0x116))var _0x50770d=users[_0x7bb448(0x116)];else{if(_0x2f58fe[0x0][_0x7bb448(0x14b)]=='German')var _0x50770d=users[_0x7bb448(0xc8)];else{if(_0x2f58fe[0x0]['language']=='Spanish')var _0x50770d=users[_0x7bb448(0x137)];else{if(_0x2f58fe[0x0][_0x7bb448(0x14b)]=='French')var _0x50770d=users['French'];else{if(_0x2f58fe[0x0][_0x7bb448(0x14b)]==_0x7bb448(0x145))var _0x50770d=users[_0x7bb448(0x16d)];else{if(_0x2f58fe[0x0][_0x7bb448(0x14b)]=='Chinese')var _0x50770d=users[_0x7bb448(0xd6)];else{if(_0x2f58fe[0x0][_0x7bb448(0x14b)]=='Arabic\x20(ae)')var _0x50770d=users[_0x7bb448(0x135)];}}}}}}}_0x45b763[_0x7bb448(0x169)]('all_purchases_barcode',{'success':_0x3df3b1[_0x7bb448(0xec)]('success'),'errors':_0x3df3b1[_0x7bb448(0xec)]('errors'),'role':_0x31a0e9,'profile':_0x30cad5,'alldata':_0x190b8a,'master_shop':_0x2f58fe,'language':_0x50770d}),console[_0x7bb448(0x131)](alldata);}catch(_0x569f2f){console['log'](_0x569f2f);}}),router[a0_0x190607(0xac)](a0_0x190607(0xa8),async(_0x52b7bd,_0x5ab720)=>{var _0x5a1e8c=a0_0x190607;const {product_code:_0x2c1f7c}=_0x52b7bd[_0x5a1e8c(0x147)];var _0x5f320d;const _0xf6b7ac=await product[_0x5a1e8c(0x134)]([{'$match':{'primary_code':_0x2c1f7c,'product_category':_0x5a1e8c(0xf3)}},{'$group':{'_id':_0x5a1e8c(0x107),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x5a1e8c(0x14a)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x5a1e8c(0x150)},'product_code':{'$first':_0x5a1e8c(0x85)},'primary_code':{'$first':_0x5a1e8c(0x136)},'secondary_code':{'$first':_0x5a1e8c(0xb4)},'maxStocks':{'$first':_0x5a1e8c(0x86)},'maxProdPerUnit':{'$first':_0x5a1e8c(0x161)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5a1e8c(0x130)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5ea75c=await product[_0x5a1e8c(0x134)]([{'$match':{'secondary_code':_0x2c1f7c}},{'$group':{'_id':_0x5a1e8c(0x107),'name':{'$first':_0x5a1e8c(0x142)},'category':{'$first':_0x5a1e8c(0x146)},'brand':{'$first':'$brand'},'unit':{'$first':_0x5a1e8c(0x13c)},'alertquantity':{'$first':_0x5a1e8c(0x150)},'product_code':{'$first':_0x5a1e8c(0x85)},'primary_code':{'$first':_0x5a1e8c(0x136)},'secondary_code':{'$first':_0x5a1e8c(0xb4)},'maxStocks':{'$first':_0x5a1e8c(0x86)},'maxProdPerUnit':{'$first':_0x5a1e8c(0x161)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5a1e8c(0x130)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0xf6b7ac[_0x5a1e8c(0x15f)]>0x0)_0x5f320d=_0xf6b7ac;else _0x5ea75c[_0x5a1e8c(0x15f)]>0x0&&(_0x5f320d=_0x5ea75c);_0x5ab720[_0x5a1e8c(0x162)](_0x5f320d);}),router[a0_0x190607(0xac)](a0_0x190607(0xce),async(_0x51837f,_0x5d0fab)=>{var _0xe18d41=a0_0x190607;const {productCode:_0x520451,bay:_0xd9f1d7,warehouses:_0x1090d2,room:_0x4e2259}=_0x51837f[_0xe18d41(0x147)];console['log'](_0x51837f[_0xe18d41(0x147)]);try{const _0x4a7447=await warehouse[_0xe18d41(0x134)]([{'$match':{'name':_0x1090d2,'room':_0x4e2259}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0xd9f1d7)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0xe18d41(0x118)},'product_stock':{'$first':_0xe18d41(0x178)},'bay':{'$first':_0xe18d41(0x8f)},'maxProducts':{'$first':_0xe18d41(0x113)}}}]);_0x5d0fab['status'](0xc8)[_0xe18d41(0x162)](_0x4a7447);}catch(_0x238708){_0x5d0fab[_0xe18d41(0x133)](0x194)[_0xe18d41(0x162)]({'message':_0x238708[_0xe18d41(0x91)]});}}),module['exports']=router;