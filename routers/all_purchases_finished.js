var a0_0x12ab79=a0_0x5d54;(function(_0x95a384,_0x508e43){var _0x2126b3=a0_0x5d54,_0x6832bc=_0x95a384();while(!![]){try{var _0x6bfdc3=-parseInt(_0x2126b3(0x148))/0x1*(parseInt(_0x2126b3(0x197))/0x2)+parseInt(_0x2126b3(0x13c))/0x3*(parseInt(_0x2126b3(0x1d6))/0x4)+parseInt(_0x2126b3(0x202))/0x5*(parseInt(_0x2126b3(0x15b))/0x6)+-parseInt(_0x2126b3(0x169))/0x7+parseInt(_0x2126b3(0x1ad))/0x8*(-parseInt(_0x2126b3(0x106))/0x9)+parseInt(_0x2126b3(0x1cf))/0xa*(parseInt(_0x2126b3(0x1e5))/0xb)+parseInt(_0x2126b3(0x20b))/0xc;if(_0x6bfdc3===_0x508e43)break;else _0x6832bc['push'](_0x6832bc['shift']());}catch(_0x2ba17a){_0x6832bc['push'](_0x6832bc['shift']());}}}(a0_0x1ccd,0x2ddab));function a0_0x5d54(_0x53cf9d,_0x57404d){var _0x1ccdcd=a0_0x1ccd();return a0_0x5d54=function(_0x5d54af,_0x49a3f6){_0x5d54af=_0x5d54af-0x105;var _0x35bd3d=_0x1ccdcd[_0x5d54af];return _0x35bd3d;},a0_0x5d54(_0x53cf9d,_0x57404d);}const express=require(a0_0x12ab79(0x1e6)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x12ab79(0x203)),nodemailer=require('nodemailer');var ejs=require(a0_0x12ab79(0x1b2));const path=require('path'),users=require(a0_0x12ab79(0x194));router[a0_0x12ab79(0x209)](a0_0x12ab79(0x1e2),auth,async(_0x24f811,_0x2af9c6)=>{var _0x20834d=a0_0x12ab79;try{const {username:_0xcebc6,email:_0x549279,role:_0x2af207}=_0x24f811[_0x20834d(0x1e4)],_0x5945fc=_0x24f811[_0x20834d(0x1e4)],_0x356a89=await profile['findOne']({'email':_0x5945fc[_0x20834d(0x133)]}),_0x57d7bd=await staff['findOne']({'email':_0x5945fc[_0x20834d(0x133)]});if(_0x5945fc['role']==_0x20834d(0x13d)){const _0x36c062=await staff[_0x20834d(0x1b6)]({'email':_0x5945fc[_0x20834d(0x133)]});}const _0x1d8ac1=await master_shop[_0x20834d(0x1bd)]();let _0xcecdd6;if(_0x5945fc[_0x20834d(0x1a0)]==_0x20834d(0x13d)){const _0x5af08a=await staff[_0x20834d(0x1b6)]({'email':_0x5945fc[_0x20834d(0x133)]});_0xcecdd6=await purchases_finished[_0x20834d(0x12b)]([{'$match':{'warehouse_name':_0x5af08a['warehouse']}},{'$lookup':{'from':_0x20834d(0x1f5),'localField':_0x20834d(0x1f5),'foreignField':'name','as':_0x20834d(0x206)}},{'$unwind':_0x20834d(0x10b)},{'$unwind':_0x20834d(0x1ef)},{'$group':{'_id':_0x20834d(0x1f7),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x20834d(0x174)},'date':{'$first':_0x20834d(0x1ac)},'warehouse_name':{'$first':_0x20834d(0x201)},'room':{'$first':_0x20834d(0x1ee)},'product':{'$push':_0x20834d(0x1ef)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x20834d(0x144)},'due_amount':{'$first':_0x20834d(0x160)},'return_data':{'$first':_0x20834d(0x110)},'batch_code':{'$first':_0x20834d(0x18d)},'expiry_date':{'$first':_0x20834d(0x156)},'suppliers_docs':{'$first':_0x20834d(0x10b)},'total_product_quantity':{'$sum':_0x20834d(0x1ae)},'level':{'$addToSet':_0x20834d(0x1b1)},'isle':{'$addToSet':_0x20834d(0x1dc)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x20834d(0x165)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xcecdd6=await purchases_finished['aggregate']([{'$unwind':_0x20834d(0x1ef)},{'$group':{'_id':_0x20834d(0x1f7),'invoice':{'$first':_0x20834d(0x1f1)},'suppliers':{'$first':_0x20834d(0x174)},'date':{'$first':_0x20834d(0x1ac)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x20834d(0x189)},'product':{'$push':'$product'},'note':{'$first':_0x20834d(0x15a)},'paid_amount':{'$first':_0x20834d(0x144)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x20834d(0x110)},'batch_code':{'$first':_0x20834d(0x18d)},'expiry_date':{'$first':_0x20834d(0x156)},'suppliers_docs':{'$first':_0x20834d(0x10b)},'total_product_quantity':{'$sum':_0x20834d(0x1ae)},'level':{'$addToSet':_0x20834d(0x1b1)},'isle':{'$addToSet':_0x20834d(0x1dc)},'type':{'$addToSet':_0x20834d(0x1d2)},'floorlevel':{'$addToSet':_0x20834d(0x165)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x1d8ac1[0x0][_0x20834d(0x185)]=='English\x20(US)')var _0x1646d5=users[_0x20834d(0x16f)];else{if(_0x1d8ac1[0x0][_0x20834d(0x185)]=='Hindi')var _0x1646d5=users[_0x20834d(0x149)];else{if(_0x1d8ac1[0x0][_0x20834d(0x185)]==_0x20834d(0x139))var _0x1646d5=users[_0x20834d(0x139)];else{if(_0x1d8ac1[0x0][_0x20834d(0x185)]==_0x20834d(0x142))var _0x1646d5=users['Spanish'];else{if(_0x1d8ac1[0x0][_0x20834d(0x185)]==_0x20834d(0x1f4))var _0x1646d5=users['French'];else{if(_0x1d8ac1[0x0][_0x20834d(0x185)]=='Portuguese\x20(BR)')var _0x1646d5=users[_0x20834d(0x183)];else{if(_0x1d8ac1[0x0]['language']==_0x20834d(0x187))var _0x1646d5=users[_0x20834d(0x187)];else{if(_0x1d8ac1[0x0]['language']==_0x20834d(0x20c))var _0x1646d5=users[_0x20834d(0x1bb)];}}}}}}}_0x2af9c6[_0x20834d(0x124)](_0x20834d(0x12a),{'success':_0x24f811[_0x20834d(0x128)](_0x20834d(0x127)),'errors':_0x24f811[_0x20834d(0x128)]('errors'),'purchases':_0xcecdd6,'role':_0x5945fc,'profile':_0x356a89,'master_shop':_0x1d8ac1,'language':_0x1646d5});}catch(_0x959e0b){console[_0x20834d(0x11b)](_0x20834d(0x10a),_0x959e0b),_0x2af9c6[_0x20834d(0x166)](0xc8)[_0x20834d(0x199)]({'message':_0x959e0b[_0x20834d(0x1ca)]});}});function BayBinSelected(_0x26073c,_0xf78e){var _0x533889=a0_0x12ab79,_0x2bdf89=[],_0x37a85f=[];if(_0x26073c=='DRY\x20GOODS'){switch(_0xf78e){case'Rack\x201':_0x2bdf89=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x533889(0x16e):_0x2bdf89=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x37a85f=['DG'];}else{if(_0x26073c=='FROZEN\x20GOODS'){switch(_0xf78e){case _0x533889(0x1d5):_0x2bdf89=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x533889(0x16e):_0x2bdf89=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x37a85f=['FG'];}}return{'levels':_0x2bdf89,'identify':_0x37a85f};}async function getRandom8DigitNumber(){var _0x98b451=a0_0x12ab79;const _0x7000d1=0x989680,_0x45f996=0x5f5e0ff,_0x658d8b=Math[_0x98b451(0x1a3)](Math[_0x98b451(0x112)]()*(_0x45f996-_0x7000d1+0x1))+_0x7000d1;var _0x3fdd26;const _0x2cbe3b=await purchases_finished[_0x98b451(0x1b6)]({'invoice':_0x98b451(0x16a)+_0x658d8b});return _0x2cbe3b&&_0x2cbe3b[_0x98b451(0x1e7)]>0x0?_0x3fdd26='INCF-'+_0x658d8b:_0x3fdd26=_0x98b451(0x16a)+_0x658d8b,_0x3fdd26;}function a0_0x1ccd(){var _0x89558f=['product_name','<tr>','exports','Spanish','catch','$paid_amount','expiry_date','/all_purchases/view','currency_placement','163497tcNiIj','Hindi','$maxStocks','getFullYear','forEach','<!DOCTYPE\x20html>','purchase\x20data\x20add\x20successfully','<strong>\x20Regards\x20</strong>','host','POnumber','Enclosed','createTransport','primary_code_hide','$product_details.maxProducts','$expiry_date','FGSEmail','$product_details._id','level','$note','144JMaTTE','$maxProdPerUnit','$secondary_code','MaxStocks_data','production_date','$due_amount','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','edit_purchases_finished','$product_details.secondary_code','$primary_code','$product.floorlevel','status','Paid\x20For\x20Purchase','/all_purchases_finished/view','720580hwMvRm','INCF-','room_name','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','return_purchase_finished','Rack\x202','English','Enabled','<div>','gmail','slice','$suppliers','Purchase\x20Mail','return_data','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</div>','paid_amount','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','\x20</h2>','Return\x20Goods','$product_details.floorlevel','Portuguese\x20(BR)','batch_code','standard_unit','/view/return_purchase/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Chinese','product','$product.room_name','all','redirect','user_id','$batch_code','<tbody\x20style=\x22text-align:\x20center;\x22>','\x20Order\x20Date\x20:\x20','<h5\x20style=\x22text-align:\x20left;\x22>','Logo.png','back','</span>','../public/language/languages.json','$name','prod_code','4dXoYew','\x20<>\x20','json','error','</h5>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/upload/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','stocks','role','return_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','floor','product_stock','product_code','$product_details.bin','getMonth','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<h2>\x20','stock_data','$date','1192POmrVe','$product.quantity','prod_unit','maxperunit','$product.bay','ejs','post','warehouse','findById','findOne','prod_invoice','$product_details.type','add_purchases_finished','prod_Qty','Arabic','purchase\x20data\x20update\x20successfully','find','$brand','RoomAssign','edit_purchases_finished_view','invoice','DRY\x20GOODS','purchases\x20item\x20return\x20successfull','/preview/:id','</td>','max_product_unit','$product_code','/view/add_purchases','purchase_quantity','message','$product_details.bay','secondary_code','prod_primunit','</body></html>','2110dVkDBu','prod_qty','Purchase\x20Return','$product.type','product_details','due_amount','Rack\x201','124056PKYzoK','master','logo','True','maxStocks','date','$product.bin','</tbody>','room','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','updateOne','/view','map','user','5621fJRCyN','express','length','prod_secondunit','Finished\x20Goods','$product_details.product_name','filter','Purchase\x20Return\x20Mail','</head><body>','$room','$product','</tr>','$invoice','$product_details','abs','French','suppliers','secondary_code_hide','$_id','/invoice/:id','bay','$product_details.product_stock','padStart','toString','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','\x20Order\x20Number\x20:\x20','/give_payment/:id','<span\x20style=\x22float:\x20right;\x22>','$warehouse_name','14130hgjLyW','../middleware/auth','secondary_unit','string','suppliers_docs','params','</thead>','get','/../public','3594852wyymLD','Arabic\x20(ae)','image','11997pwFixA','getDate','save','password','table\x20page','$suppliers_docs','An\x20error\x20occurred\x20while\x20saving\x20data.','<h5>','body','site_title','$return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','random','payment\x20successfull','note','<html><head><title></title>','then','$secondary_unit','English\x20(US)','$alertquantity','$unit','log','Room_name','return_qty','concat','<hr\x20class=\x22my-3\x22>','/view/add_purchases/:id','</table>','currency','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','render','primary_code','product_date','success','flash','/barcode_scanner','all_purchases_finished','aggregate','product_code_hide','/CheckingWarehouse','sendMail','purchase_invoice','$product_details.storage','quantity','warehouse_name','email','prod_level','/view/:id','stock_quantity','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','German','Email\x20sent\x20successfully','QA\x20Warehouse','33riTzOL','staff','prod_cat'];a0_0x1ccd=function(){return _0x89558f;};return a0_0x1ccd();}router[a0_0x12ab79(0x209)](a0_0x12ab79(0x1c8),auth,async(_0x6751f0,_0x50b4b8)=>{var _0x2fba38=a0_0x12ab79;try{const {username:_0x327e8e,email:_0x2e8df0,role:_0x460f39}=_0x6751f0[_0x2fba38(0x1e4)],_0x74066d=_0x6751f0[_0x2fba38(0x1e4)],_0x36ca46=await profile['findOne']({'email':_0x74066d[_0x2fba38(0x133)]}),_0x317347=await master_shop[_0x2fba38(0x1bd)](),_0x2f167d=await staff[_0x2fba38(0x1b6)]({'email':_0x74066d['email']}),_0x142485=await suppliers[_0x2fba38(0x1bd)]({});let _0x2a5a84;if(_0x74066d['role']==_0x2fba38(0x13d)){const _0x406bf6=await staff[_0x2fba38(0x1b6)]({'email':_0x74066d[_0x2fba38(0x133)]});_0x2a5a84=await warehouse[_0x2fba38(0x12b)]([{'$match':{'status':'Enabled','name':_0x406bf6[_0x2fba38(0x1b4)],'warehouse_category':_0x2fba38(0x1e9)}},{'$group':{'_id':_0x2fba38(0x195),'name':{'$first':_0x2fba38(0x195)}}}]);}else _0x2a5a84=await warehouse['aggregate']([{'$match':{'status':_0x2fba38(0x170),'warehouse_category':_0x2fba38(0x1e9),'name':{'$ne':_0x2fba38(0x13b)}}},{'$group':{'_id':_0x2fba38(0x195),'name':{'$first':'$name'}}}]);const _0x2c7d64=await product[_0x2fba38(0x1bd)]({}),_0x4a4bc4=await warehouse[_0x2fba38(0x1bd)]({'status':_0x2fba38(0x170)}),_0x4e00a0=await purchases_finished[_0x2fba38(0x1bd)]({}),_0x58de52=_0x4e00a0[_0x2fba38(0x1e7)]+0x1,_0x38960e=_0x2fba38(0x16a)+_0x58de52[_0x2fba38(0x1fc)]()[_0x2fba38(0x1fb)](0x5,'0');var _0x2fc67a=['Ambient',_0x2fba38(0x152)];if(_0x317347[0x0][_0x2fba38(0x185)]==_0x2fba38(0x118))var _0x277a7b=users[_0x2fba38(0x16f)];else{if(_0x317347[0x0]['language']=='Hindi')var _0x277a7b=users[_0x2fba38(0x149)];else{if(_0x317347[0x0][_0x2fba38(0x185)]==_0x2fba38(0x139))var _0x277a7b=users[_0x2fba38(0x139)];else{if(_0x317347[0x0][_0x2fba38(0x185)]=='Spanish')var _0x277a7b=users[_0x2fba38(0x142)];else{if(_0x317347[0x0][_0x2fba38(0x185)]=='French')var _0x277a7b=users[_0x2fba38(0x1f4)];else{if(_0x317347[0x0]['language']==_0x2fba38(0x17e))var _0x277a7b=users['Portuguese'];else{if(_0x317347[0x0][_0x2fba38(0x185)]==_0x2fba38(0x187))var _0x277a7b=users[_0x2fba38(0x187)];else{if(_0x317347[0x0][_0x2fba38(0x185)]==_0x2fba38(0x20c))var _0x277a7b=users[_0x2fba38(0x1bb)];}}}}}}}const _0x3c2785=getRandom8DigitNumber();_0x3c2785[_0x2fba38(0x116)](_0x468d51=>{var _0x1e66d9=_0x2fba38;_0x50b4b8[_0x1e66d9(0x124)](_0x1e66d9(0x1b9),{'success':_0x6751f0[_0x1e66d9(0x128)](_0x1e66d9(0x127)),'errors':_0x6751f0[_0x1e66d9(0x128)](_0x1e66d9(0x137)),'role':_0x74066d,'profile':_0x36ca46,'suppliers':_0x142485,'warehouse':_0x2a5a84,'product':_0x2c7d64,'invoice':_0x468d51,'master_shop':_0x317347,'language':_0x277a7b,'find_data':_0x4a4bc4,'rooms_data':_0x2fc67a});})[_0x2fba38(0x143)](_0x223cdd=>{var _0x21beb2=_0x2fba38;_0x6751f0['flash'](_0x21beb2(0x137),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x50b4b8[_0x21beb2(0x18b)]('/all_purchases_finished/view');});}catch(_0x265bf9){console['log'](_0x265bf9);}}),router['get'](a0_0x12ab79(0x120),auth,async(_0x4fea95,_0x3d82c0)=>{var _0x5646f3=a0_0x12ab79;try{const _0x43c58e=_0x4fea95[_0x5646f3(0x207)]['id'];console[_0x5646f3(0x11b)](_0x43c58e);const _0x53e7fc=await master_shop[_0x5646f3(0x1bd)]();console['log'](_0x5646f3(0x1d7),_0x53e7fc);const _0x13495d=await product[_0x5646f3(0x1b6)]({'name':_0x43c58e});console[_0x5646f3(0x11b)]('product',_0x13495d),_0x3d82c0['status'](0xc8)[_0x5646f3(0x199)]({'product_data':_0x13495d,'master':_0x53e7fc});}catch(_0x53507c){console[_0x5646f3(0x11b)]('add_purchases\x20error',_0x53507c);}}),router[a0_0x12ab79(0x1b3)]('/view/add_purchases',auth,async(_0x3c5d32,_0x1ef057)=>{var _0x471fee=a0_0x12ab79;try{const {invoice:_0x1fcded,date:_0x437784,warehouse_name:_0x17044d,prod_name:_0x729fe3,prod_code:_0x3ac995,prod_qty:_0x253d86,prod_unit:_0x5940d4,prod_secondunit:_0x47b8c2,prod_level:_0x896173,prod_isle:_0x901988,prod_pallet:_0x7340ce,note:_0xeeedc3,expiry_date:_0x388663,batch_code:_0xbf5b5f,payable:_0x5e4f5d,due_amount:_0x263e83,Room_name:_0x561278,primary_code:_0x325a7d,secondary_code:_0x414d64,MaxStocks_data:_0x2920de,PO_number:_0x4a04b6,SCRN:_0x1c5dc6,JO_number:_0x5cea06}=_0x3c5d32['body'];if(typeof _0x729fe3=='string')var _0x791acd=[_0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x1df)]],_0x2fe1d1=[_0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x196)]],_0x1eff2d=[_0x3c5d32['body']['prod_Qty']],_0x5c49d2=[_0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x1cd)]],_0x1c70d6=[_0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x1e8)]],_0x55b487=[_0x3c5d32[_0x471fee(0x10e)]['prod_level']],_0x4f861b=[_0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x125)]],_0x3281ed=[_0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x1cc)]],_0x8d96a2=[_0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x15e)]],_0x3f7be8=[_0x3c5d32[_0x471fee(0x10e)]['batch_code']],_0xfb438f=[_0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x145)]],_0x2472c8=[_0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x126)]],_0x10bf83=[_0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x1c6)]],_0xe5e0af=[_0x3c5d32[_0x471fee(0x10e)]['prod_cat']],_0x2181da=[_0x3c5d32[_0x471fee(0x10e)]['RoomAssign']],_0xbc774b=[_0x3c5d32['body'][_0x471fee(0x1b7)]];else var _0x791acd=[..._0x3c5d32[_0x471fee(0x10e)]['prod_name']],_0x2fe1d1=[..._0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x196)]],_0x1eff2d=[..._0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x1ba)]],_0x5c49d2=[..._0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x1cd)]],_0x1c70d6=[..._0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x1e8)]],_0x55b487=[..._0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x134)]],_0x4f861b=[..._0x3c5d32[_0x471fee(0x10e)]['primary_code']],_0x3281ed=[..._0x3c5d32['body'][_0x471fee(0x1cc)]],_0x8d96a2=[..._0x3c5d32[_0x471fee(0x10e)]['MaxStocks_data']],_0x3f7be8=[..._0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x17f)]],_0xfb438f=[..._0x3c5d32[_0x471fee(0x10e)]['expiry_date']],_0x2472c8=[..._0x3c5d32[_0x471fee(0x10e)]['product_date']],_0x10bf83=[..._0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x1c6)]],_0xe5e0af=[..._0x3c5d32['body'][_0x471fee(0x13e)]],_0x2181da=[..._0x3c5d32[_0x471fee(0x10e)][_0x471fee(0x1bf)]],_0xbc774b=[..._0x3c5d32[_0x471fee(0x10e)]['prod_invoice']];const _0x2333f7=_0x791acd['map'](_0x1913f2=>{return _0x1913f2={'product_name':_0x1913f2};});_0x2fe1d1[_0x471fee(0x14c)]((_0x137f96,_0x3f2771)=>{var _0x330a9e=_0x471fee;_0x2333f7[_0x3f2771][_0x330a9e(0x1a5)]=_0x137f96;}),_0x1eff2d[_0x471fee(0x14c)]((_0x20a5a9,_0x4863c9)=>{var _0x5eddf5=_0x471fee;_0x2333f7[_0x4863c9][_0x5eddf5(0x131)]=Math[_0x5eddf5(0x1f3)](_0x20a5a9);}),_0x5c49d2[_0x471fee(0x14c)]((_0x156eb8,_0x47559c)=>{var _0x3a928b=_0x471fee;_0x2333f7[_0x47559c][_0x3a928b(0x180)]=_0x156eb8;}),_0x1c70d6[_0x471fee(0x14c)]((_0x23a699,_0x584171)=>{var _0x13395f=_0x471fee;_0x2333f7[_0x584171][_0x13395f(0x204)]=_0x23a699;}),_0x55b487[_0x471fee(0x14c)]((_0x3966c3,_0x20fb40)=>{var _0x376b82=_0x471fee;_0x2333f7[_0x20fb40][_0x376b82(0x1f9)]=_0x3966c3;}),_0x4f861b[_0x471fee(0x14c)]((_0x252752,_0x4c9471)=>{_0x2333f7[_0x4c9471]['primary_code']=_0x252752;}),_0x3281ed[_0x471fee(0x14c)]((_0x5ddf53,_0xb7aaa2)=>{_0x2333f7[_0xb7aaa2]['secondary_code']=_0x5ddf53;}),_0x8d96a2[_0x471fee(0x14c)]((_0x47ccf8,_0x5153c2)=>{var _0x32a92f=_0x471fee;_0x2333f7[_0x5153c2][_0x32a92f(0x1da)]=_0x47ccf8;}),_0x3f7be8[_0x471fee(0x14c)]((_0x41c357,_0x4573b3)=>{var _0x45b9f4=_0x471fee;_0x2333f7[_0x4573b3][_0x45b9f4(0x17f)]=_0x41c357;}),_0xfb438f[_0x471fee(0x14c)]((_0x521ece,_0x4206f0)=>{var _0x3b8afe=_0x471fee;_0x2333f7[_0x4206f0][_0x3b8afe(0x145)]=_0x521ece;}),_0x2472c8[_0x471fee(0x14c)]((_0x1b2abe,_0x17cacb)=>{var _0x5d435c=_0x471fee;_0x2333f7[_0x17cacb][_0x5d435c(0x15f)]=_0x1b2abe;}),_0x10bf83['forEach']((_0x1a919c,_0x474309)=>{var _0xc1df92=_0x471fee;_0x2333f7[_0x474309][_0xc1df92(0x1b0)]=_0x1a919c;}),_0xe5e0af[_0x471fee(0x14c)]((_0x138dab,_0x32ab45)=>{_0x2333f7[_0x32ab45]['product_cat']=_0x138dab;}),_0x2181da[_0x471fee(0x14c)]((_0x22a5d7,_0xb35f2d)=>{var _0x2da041=_0x471fee;_0x2333f7[_0xb35f2d][_0x2da041(0x16b)]=_0x22a5d7;}),_0xbc774b['forEach']((_0x1e7254,_0xd9ec46)=>{var _0x1e639d=_0x471fee;_0x2333f7[_0xd9ec46][_0x1e639d(0x1c1)]=_0x1e7254;});const _0x40aac9=_0x2333f7[_0x471fee(0x1eb)](_0x23991e=>_0x23991e[_0x471fee(0x131)]!=='0'&&_0x23991e['quantity']!==''),_0x705827=new purchases_finished({'invoice':_0x1fcded,'suppliers':_0x3c5d32['body'][_0x471fee(0x1f5)],'date':_0x437784,'warehouse_name':_0x17044d,'product':_0x40aac9,'note':_0xeeedc3,'due_amount':_0x263e83,'room':_0x561278,'POnumber':_0x4a04b6,'SCRN':_0x1c5dc6,'JO_number':_0x5cea06}),_0x78af7d=await _0x705827[_0x471fee(0x108)](),_0x5a2f66=await purchases_finished[_0x471fee(0x1b6)]({'invoice':_0x1fcded}),_0x23a90b=_0x5a2f66[_0x471fee(0x188)][_0x471fee(0x1e3)](async _0x43de2e=>{var _0x40e66f=_0x471fee,_0x32e5a5=await warehouse['findOne']({'name':_0x17044d,'room':_0x43de2e[_0x40e66f(0x16b)]}),_0x569c27=0x0;const _0x3f6e7d=_0x32e5a5[_0x40e66f(0x1d3)][_0x40e66f(0x1e3)](_0x579d56=>{var _0x261617=_0x40e66f;console['log'](_0x579d56[_0x261617(0x13f)]+'=='+_0x43de2e[_0x261617(0x13f)]+'&&'+_0x579d56[_0x261617(0x1f9)]+'=='+_0x43de2e[_0x261617(0x1f9)]+'&&'+_0x579d56[_0x261617(0x145)]+'=='+_0x43de2e[_0x261617(0x145)]+'&&'+_0x579d56['production_date']+'=='+_0x43de2e[_0x261617(0x15f)]+'&&'+_0x579d56[_0x261617(0x17f)]+'=='+_0x43de2e[_0x261617(0x17f)]+'&&'+_0x579d56[_0x261617(0x1c1)]+'=='+_0x5a2f66[_0x261617(0x1c1)]),_0x579d56[_0x261617(0x13f)]==_0x43de2e[_0x261617(0x13f)]&&_0x579d56['bay']==_0x43de2e[_0x261617(0x1f9)]&&_0x579d56[_0x261617(0x145)]==_0x43de2e[_0x261617(0x145)]&&_0x579d56['production_date']==_0x43de2e[_0x261617(0x15f)]&&_0x579d56['batch_code']==_0x43de2e[_0x261617(0x17f)]&&_0x579d56[_0x261617(0x1c1)]==_0x5a2f66[_0x261617(0x1c1)]&&(_0x579d56['product_stock']=Math['abs'](_0x579d56[_0x261617(0x1a4)])+Math[_0x261617(0x1f3)](_0x43de2e[_0x261617(0x131)]),_0x569c27++);});return _0x569c27=='0'&&(_0x32e5a5['product_details']=_0x32e5a5[_0x40e66f(0x1d3)][_0x40e66f(0x11e)]({'product_name':_0x43de2e['product_name'],'product_stock':Math[_0x40e66f(0x1f3)](_0x43de2e[_0x40e66f(0x131)]),'primary_code':_0x43de2e[_0x40e66f(0x125)],'secondary_code':_0x43de2e[_0x40e66f(0x1cc)],'product_code':_0x43de2e['product_code'],'bay':_0x43de2e['bay'],'maxProducts':_0x43de2e[_0x40e66f(0x1da)],'unit':_0x43de2e[_0x40e66f(0x180)],'secondary_unit':_0x43de2e[_0x40e66f(0x204)],'expiry_date':_0x43de2e['expiry_date'],'production_date':_0x43de2e[_0x40e66f(0x15f)],'maxProducts':_0x43de2e['maxStocks'],'maxPerUnit':_0x43de2e[_0x40e66f(0x1b0)],'batch_code':_0x43de2e[_0x40e66f(0x17f)],'product_cat':_0x43de2e['product_cat'],'invoice':_0x43de2e['invoice']})),_0x32e5a5;});Promise[_0x471fee(0x18a)](_0x23a90b)['then'](async _0x3ca285=>{var _0xd969f7=_0x471fee;try{for(const _0x5adac7 of _0x3ca285){await warehouse[_0xd969f7(0x1e1)]({'_id':_0x5adac7['_id']},{'$addToSet':{'product_details':{'$each':_0x5adac7['product_details']}}});}const _0x45bb25=await master_shop[_0xd969f7(0x1bd)](),_0x50039a=await email_settings[_0xd969f7(0x1b6)](),_0x4f07cc=await supervisor_settings[_0xd969f7(0x1bd)]();var _0x315fb0=_0x5a2f66['product'],_0x4e77db='',_0xbf7a54;for(_0xbf7a54 in _0x315fb0){var _0x30905f='FG';_0x5a2f66[_0xd969f7(0x132)]==_0xd969f7(0x1c2)&&(_0x30905f='DG'),_0x4e77db+=_0xd969f7(0x140)+_0xd969f7(0x17a)+_0x315fb0[_0xbf7a54][_0xd969f7(0x13f)]+_0xd969f7(0x1c5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x315fb0[_0xbf7a54][_0xd969f7(0x1a5)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x315fb0[_0xbf7a54][_0xd969f7(0x131)]+_0xd969f7(0x1c5)+_0xd969f7(0x17a)+_0x315fb0[_0xbf7a54][_0xd969f7(0x180)]+_0xd969f7(0x1c5)+_0xd969f7(0x17a)+_0x315fb0[_0xbf7a54][_0xd969f7(0x204)]+'</td>'+_0xd969f7(0x17a)+_0x5a2f66['warehouse_name']+_0xd969f7(0x1c5)+_0xd969f7(0x17a)+_0x315fb0[_0xbf7a54]['room_name']+_0xd969f7(0x1c5)+_0xd969f7(0x17a)+_0x30905f+_0x315fb0[_0xbf7a54][_0xd969f7(0x1f9)]+_0xd969f7(0x1c5),_0xd969f7(0x1f0);}let _0x5367f7=nodemailer[_0xd969f7(0x153)]({'host':_0x50039a[_0xd969f7(0x150)],'port':Number(_0x50039a['port']),'secure':![],'auth':{'user':_0x50039a[_0xd969f7(0x133)],'pass':_0x50039a['password']}}),_0x3bad07={'from':_0x50039a[_0xd969f7(0x133)],'to':_0x4f07cc[0x0][_0xd969f7(0x157)],'subject':_0xd969f7(0x175),'attachments':[{'filename':_0xd969f7(0x191),'path':__dirname+_0xd969f7(0x20a)+'/upload/'+_0x45bb25[0x0]['image'],'cid':_0xd969f7(0x1d8)}],'html':_0xd969f7(0x14d)+_0xd969f7(0x115)+_0xd969f7(0x1ed)+_0xd969f7(0x171)+_0xd969f7(0x161)+_0xd969f7(0x171)+_0xd969f7(0x123)+_0xd969f7(0x178)+_0xd969f7(0x171)+_0xd969f7(0x1aa)+_0x45bb25[0x0][_0xd969f7(0x10f)]+_0xd969f7(0x17b)+_0xd969f7(0x178)+_0xd969f7(0x178)+_0xd969f7(0x11f)+_0xd969f7(0x171)+_0xd969f7(0x190)+_0xd969f7(0x1fe)+_0x5a2f66[_0xd969f7(0x1c1)]+'\x20'+_0xd969f7(0x200)+_0xd969f7(0x18f)+_0x5a2f66['date']+'\x20'+_0xd969f7(0x193)+_0xd969f7(0x19b)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xd969f7(0x140)+_0xd969f7(0x19e)+_0xd969f7(0x111)+_0xd969f7(0x1fd)+_0xd969f7(0x1e0)+_0xd969f7(0x186)+_0xd969f7(0x1a2)+_0xd969f7(0x182)+_0xd969f7(0x1a9)+_0xd969f7(0x1f0)+_0xd969f7(0x208)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4e77db+'\x20'+_0xd969f7(0x1dd)+_0xd969f7(0x121)+_0xd969f7(0x171)+_0xd969f7(0x14f)+_0xd969f7(0x10d)+_0x45bb25[0x0]['site_title']+_0xd969f7(0x19b)+'</div>'+_0xd969f7(0x178)+_0xd969f7(0x1ce)};_0x5367f7[_0xd969f7(0x12e)](_0x3bad07,function(_0x355b01,_0xbb7754){var _0x3e1267=_0xd969f7;_0x355b01?(console[_0x3e1267(0x11b)](_0x355b01),console[_0x3e1267(0x11b)]('Error\x20Occurs')):console[_0x3e1267(0x11b)](_0x3e1267(0x13a));});}catch(_0x322c19){console[_0xd969f7(0x19a)](_0x322c19),_0x1ef057['status'](0x1f4)[_0xd969f7(0x199)]({'error':_0xd969f7(0x10c),'message':_0x322c19['message']});}})[_0x471fee(0x143)](_0x3f5e5f=>{var _0x5a59fb=_0x471fee;console[_0x5a59fb(0x19a)](_0x3f5e5f),_0x1ef057[_0x5a59fb(0x166)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});}),_0x3c5d32[_0x471fee(0x128)](_0x471fee(0x127),_0x471fee(0x14e)),_0x1ef057[_0x471fee(0x18b)](_0x471fee(0x168));}catch(_0x5d8b68){console[_0x471fee(0x11b)](_0x5d8b68);}}),router[a0_0x12ab79(0x209)](a0_0x12ab79(0x1c4),auth,async(_0x4823d0,_0x32e747)=>{var _0x1a9d98=a0_0x12ab79;try{const {username:_0x5058d4,email:_0x39118e,role:_0x29693c}=_0x4823d0[_0x1a9d98(0x1e4)],_0x204af0=_0x4823d0[_0x1a9d98(0x1e4)],_0x3c6589=await profile['findOne']({'email':_0x204af0['email']}),_0x4df210=await master_shop[_0x1a9d98(0x1bd)](),_0x440d89=_0x4823d0['params']['id'],_0x4f89e8=await purchases_finished['findById'](_0x440d89),_0xef5f4a=await suppliers[_0x1a9d98(0x1bd)]({});let _0x9c7e5f;if(_0x204af0[_0x1a9d98(0x1a0)]=='staff'){const _0x58c501=await staff[_0x1a9d98(0x1b6)]({'email':_0x204af0[_0x1a9d98(0x133)]});_0x9c7e5f=await warehouse[_0x1a9d98(0x1bd)]({'status':'Enabled','name':_0x58c501['warehouse'],'warehouse_category':_0x1a9d98(0x1e9)});}else _0x9c7e5f=await warehouse[_0x1a9d98(0x12b)]([{'$match':{'status':_0x1a9d98(0x170),'warehouse_category':_0x1a9d98(0x1e9)}},{'$group':{'_id':_0x1a9d98(0x195),'name':{'$first':_0x1a9d98(0x195)}}}]);const _0x50b6af=await product['find']({}),_0x177d69=BayBinSelected(_0x4f89e8[_0x1a9d98(0x132)],_0x4f89e8['room']);let _0x31ffb6=new Date(_0x4f89e8[_0x1a9d98(0x145)]),_0x29593e=('0'+_0x31ffb6[_0x1a9d98(0x107)]())[_0x1a9d98(0x173)](-0x2),_0x23e57f=('0'+(_0x31ffb6[_0x1a9d98(0x1a7)]()+0x1))[_0x1a9d98(0x173)](-0x2),_0x4bcc45=_0x31ffb6[_0x1a9d98(0x14b)](),_0x1552e9=_0x4bcc45+'-'+_0x23e57f+'-'+_0x29593e;if(_0x4df210[0x0][_0x1a9d98(0x185)]==_0x1a9d98(0x118)){var _0x3ebb13=users[_0x1a9d98(0x16f)];console[_0x1a9d98(0x11b)](_0x3ebb13);}else{if(_0x4df210[0x0][_0x1a9d98(0x185)]==_0x1a9d98(0x149))var _0x3ebb13=users[_0x1a9d98(0x149)];else{if(_0x4df210[0x0][_0x1a9d98(0x185)]==_0x1a9d98(0x139))var _0x3ebb13=users['German'];else{if(_0x4df210[0x0]['language']==_0x1a9d98(0x142))var _0x3ebb13=users['Spanish'];else{if(_0x4df210[0x0][_0x1a9d98(0x185)]==_0x1a9d98(0x1f4))var _0x3ebb13=users['French'];else{if(_0x4df210[0x0][_0x1a9d98(0x185)]=='Portuguese\x20(BR)')var _0x3ebb13=users[_0x1a9d98(0x183)];else{if(_0x4df210[0x0][_0x1a9d98(0x185)]==_0x1a9d98(0x187))var _0x3ebb13=users[_0x1a9d98(0x187)];else{if(_0x4df210[0x0]['language']==_0x1a9d98(0x20c))var _0x3ebb13=users[_0x1a9d98(0x1bb)];}}}}}}}_0x32e747[_0x1a9d98(0x124)](_0x1a9d98(0x1c0),{'success':_0x4823d0[_0x1a9d98(0x128)]('success'),'errors':_0x4823d0[_0x1a9d98(0x128)](_0x1a9d98(0x137)),'role':_0x204af0,'profile':_0x3c6589,'purchases':_0x4f89e8,'suppliers':_0xef5f4a,'warehouse':_0x9c7e5f,'product':_0x50b6af,'master_shop':_0x4df210,'language':_0x3ebb13,'ed_fullDate':_0x1552e9,'dataSelected':_0x177d69});}catch(_0x1b5158){console[_0x1a9d98(0x11b)](_0x1b5158);}}),router[a0_0x12ab79(0x209)](a0_0x12ab79(0x135),auth,async(_0x5b2ca1,_0x3ee23d)=>{var _0x3cd1ef=a0_0x12ab79;try{const {username:_0x2b8ee0,email:_0x446f4f,role:_0x222445}=_0x5b2ca1[_0x3cd1ef(0x1e4)],_0x1efc63=_0x5b2ca1['user'],_0x5058a8=await profile[_0x3cd1ef(0x1b6)]({'email':_0x1efc63['email']}),_0x503824=await master_shop[_0x3cd1ef(0x1bd)](),_0x3647a5=_0x5b2ca1[_0x3cd1ef(0x207)]['id'],_0x286275=await purchases_finished[_0x3cd1ef(0x1b5)](_0x3647a5),_0x49576f=await suppliers[_0x3cd1ef(0x1bd)]({});let _0xf6db32;if(_0x1efc63['role']=='staff'){const _0xe25be6=await staff[_0x3cd1ef(0x1b6)]({'email':_0x1efc63[_0x3cd1ef(0x133)]});_0xf6db32=await warehouse[_0x3cd1ef(0x1bd)]({'status':_0x3cd1ef(0x170),'name':_0xe25be6[_0x3cd1ef(0x1b4)],'warehouse_category':_0x3cd1ef(0x1e9)});}else _0xf6db32=await warehouse[_0x3cd1ef(0x12b)]([{'$match':{'status':'Enabled','warehouse_category':_0x3cd1ef(0x1e9)}},{'$group':{'_id':'$name','name':{'$first':_0x3cd1ef(0x195)}}}]);const _0x45050f=await product['find']({}),_0x556563=BayBinSelected(_0x286275[_0x3cd1ef(0x132)],_0x286275[_0x3cd1ef(0x1de)]);let _0x25541c=new Date(_0x286275['expiry_date']),_0x49d21f=('0'+_0x25541c[_0x3cd1ef(0x107)]())['slice'](-0x2),_0x57ef87=('0'+(_0x25541c[_0x3cd1ef(0x1a7)]()+0x1))['slice'](-0x2),_0x5e211f=_0x25541c['getFullYear'](),_0x154d1f=_0x5e211f+'-'+_0x57ef87+'-'+_0x49d21f;if(_0x503824[0x0]['language']==_0x3cd1ef(0x118)){var _0x3e58d7=users[_0x3cd1ef(0x16f)];console[_0x3cd1ef(0x11b)](_0x3e58d7);}else{if(_0x503824[0x0][_0x3cd1ef(0x185)]==_0x3cd1ef(0x149))var _0x3e58d7=users[_0x3cd1ef(0x149)];else{if(_0x503824[0x0][_0x3cd1ef(0x185)]==_0x3cd1ef(0x139))var _0x3e58d7=users[_0x3cd1ef(0x139)];else{if(_0x503824[0x0][_0x3cd1ef(0x185)]==_0x3cd1ef(0x142))var _0x3e58d7=users[_0x3cd1ef(0x142)];else{if(_0x503824[0x0][_0x3cd1ef(0x185)]==_0x3cd1ef(0x1f4))var _0x3e58d7=users[_0x3cd1ef(0x1f4)];else{if(_0x503824[0x0]['language']==_0x3cd1ef(0x17e))var _0x3e58d7=users['Portuguese'];else{if(_0x503824[0x0][_0x3cd1ef(0x185)]==_0x3cd1ef(0x187))var _0x3e58d7=users['Chinese'];else{if(_0x503824[0x0][_0x3cd1ef(0x185)]==_0x3cd1ef(0x20c))var _0x3e58d7=users[_0x3cd1ef(0x1bb)];}}}}}}}_0x3ee23d['render'](_0x3cd1ef(0x162),{'success':_0x5b2ca1['flash'](_0x3cd1ef(0x127)),'errors':_0x5b2ca1[_0x3cd1ef(0x128)](_0x3cd1ef(0x137)),'role':_0x1efc63,'profile':_0x5058a8,'purchases':_0x286275,'suppliers':_0x49576f,'warehouse':_0xf6db32,'product':_0x45050f,'master_shop':_0x503824,'language':_0x3e58d7,'ed_fullDate':_0x154d1f,'dataSelected':_0x556563});}catch(_0x218ba5){console[_0x3cd1ef(0x11b)](_0x218ba5);}}),router[a0_0x12ab79(0x1b3)](a0_0x12ab79(0x135),auth,async(_0x181b99,_0x540650)=>{var _0x131e90=a0_0x12ab79;try{const _0x2d9d98=_0x181b99[_0x131e90(0x207)]['id'],_0x316ace=await purchases_finished['findOne']({'_id':_0x181b99[_0x131e90(0x207)]['id']}),_0x4b1c0b=await warehouse[_0x131e90(0x1b6)]({'name':_0x316ace[_0x131e90(0x132)],'room':_0x316ace['room']});_0x316ace[_0x131e90(0x188)][_0x131e90(0x14c)](_0x40e082=>{var _0x1a002f=_0x131e90;const _0xe55beb=_0x4b1c0b[_0x1a002f(0x1d3)][_0x1a002f(0x1e3)](_0x58a19f=>{var _0x50f312=_0x1a002f;_0x58a19f['product_name']==_0x40e082[_0x50f312(0x13f)]&&_0x58a19f[_0x50f312(0x1f9)]==_0x40e082[_0x50f312(0x1f9)]&&(_0x58a19f[_0x50f312(0x1a4)]=parseInt(_0x58a19f[_0x50f312(0x1a4)])-parseInt(_0x40e082[_0x50f312(0x131)]));});}),await _0x4b1c0b[_0x131e90(0x108)]();const {invoice:_0x11d3d7,suppliers:_0x43046f,date:_0x6752e,warehouse_name:_0x33e20e,prod_name:_0x3fa467,prod_code:_0x33e93c,prod_qty:_0x29b870,prod_unit:_0xa1a085,prod_secondunit:_0x4bd22d,prod_level:_0x1c3987,prod_isle:_0x189075,prod_pallet:_0x1bc162,note:_0x4c8b62,expiry_date:_0x4961f9,batch_code:_0x33a942,paid_amount:_0x5af08b,due_amount:_0x55cef5,Room_name:_0x411d44,primary_code:_0x57290c,secondary_code:_0x5271fa,PO_number:_0x1259a5,JO_number:_0x5485f9}=_0x181b99[_0x131e90(0x10e)];if(typeof _0x3fa467==_0x131e90(0x205))var _0x3cf3c4=[_0x181b99[_0x131e90(0x10e)][_0x131e90(0x1df)]],_0x3740cf=[_0x181b99[_0x131e90(0x10e)][_0x131e90(0x196)]],_0x427661=[_0x181b99['body'][_0x131e90(0x1d0)]],_0x7eeac9=[_0x181b99['body'][_0x131e90(0x1af)]],_0x362fbf=[_0x181b99[_0x131e90(0x10e)][_0x131e90(0x1e8)]],_0x7b5ac8=[_0x181b99[_0x131e90(0x10e)][_0x131e90(0x134)]],_0xf28571=[_0x181b99[_0x131e90(0x10e)][_0x131e90(0x125)]],_0x2fe35c=[_0x181b99[_0x131e90(0x10e)][_0x131e90(0x1cc)]],_0x4526b6=[_0x181b99['body'][_0x131e90(0x15e)]],_0x3e30e1=[_0x181b99[_0x131e90(0x10e)][_0x131e90(0x17f)]],_0xb2f68b=[_0x181b99[_0x131e90(0x10e)][_0x131e90(0x145)]];else var _0x3cf3c4=[..._0x181b99[_0x131e90(0x10e)][_0x131e90(0x1df)]],_0x3740cf=[..._0x181b99[_0x131e90(0x10e)]['prod_code']],_0x427661=[..._0x181b99[_0x131e90(0x10e)]['prod_qty']],_0x7eeac9=[..._0x181b99[_0x131e90(0x10e)][_0x131e90(0x1af)]],_0x362fbf=[..._0x181b99[_0x131e90(0x10e)][_0x131e90(0x1e8)]],_0x7b5ac8=[..._0x181b99[_0x131e90(0x10e)][_0x131e90(0x134)]],_0xf28571=[..._0x181b99[_0x131e90(0x10e)]['primary_code']],_0x2fe35c=[..._0x181b99[_0x131e90(0x10e)][_0x131e90(0x1cc)]],_0x4526b6=[..._0x181b99['body'][_0x131e90(0x15e)]],_0x3e30e1=[..._0x181b99['body'][_0x131e90(0x17f)]],_0xb2f68b=[..._0x181b99[_0x131e90(0x10e)][_0x131e90(0x145)]];const _0x47bb77=_0x3cf3c4[_0x131e90(0x1e3)](_0x30f026=>{return _0x30f026={'product_name':_0x30f026};});_0x3740cf[_0x131e90(0x14c)]((_0x40aff2,_0x49cc0a)=>{var _0x3da2fc=_0x131e90;_0x47bb77[_0x49cc0a][_0x3da2fc(0x1a5)]=_0x40aff2;}),_0x427661[_0x131e90(0x14c)]((_0x9b5eef,_0x431090)=>{var _0x27f0c0=_0x131e90;_0x47bb77[_0x431090][_0x27f0c0(0x131)]=_0x9b5eef;}),_0x7eeac9[_0x131e90(0x14c)]((_0x299a44,_0x248106)=>{var _0x1a8e4a=_0x131e90;_0x47bb77[_0x248106][_0x1a8e4a(0x180)]=_0x299a44;}),_0x362fbf[_0x131e90(0x14c)]((_0x36c364,_0x21b4d5)=>{var _0x398a03=_0x131e90;_0x47bb77[_0x21b4d5][_0x398a03(0x204)]=_0x36c364;}),_0x7b5ac8['forEach']((_0x1d524f,_0x22344a)=>{_0x47bb77[_0x22344a]['bay']=_0x1d524f;}),_0xf28571[_0x131e90(0x14c)]((_0x5716a0,_0x1c6363)=>{var _0x667d89=_0x131e90;_0x47bb77[_0x1c6363][_0x667d89(0x125)]=_0x5716a0;}),_0x2fe35c['forEach']((_0x511e7c,_0x27f183)=>{_0x47bb77[_0x27f183]['secondary_code']=_0x511e7c;}),_0x4526b6['forEach']((_0x1a70f0,_0x35dab1)=>{var _0x1baf3b=_0x131e90;_0x47bb77[_0x35dab1][_0x1baf3b(0x1da)]=_0x1a70f0;}),_0x3e30e1['forEach']((_0x53abf7,_0x3e4452)=>{var _0x27c8dc=_0x131e90;_0x47bb77[_0x3e4452][_0x27c8dc(0x17f)]=_0x53abf7;}),_0xb2f68b[_0x131e90(0x14c)]((_0x43dcc9,_0x225e82)=>{var _0x2a3f12=_0x131e90;_0x47bb77[_0x225e82][_0x2a3f12(0x145)]=_0x43dcc9;});const _0x518f99=_0x47bb77[_0x131e90(0x1eb)](_0x402459=>_0x402459[_0x131e90(0x131)]!=='0'&&_0x402459[_0x131e90(0x131)]!=='');_0x316ace[_0x131e90(0x1c1)]=_0x11d3d7,_0x316ace[_0x131e90(0x1f5)]=_0x43046f,_0x316ace[_0x131e90(0x1db)]=_0x6752e,_0x316ace[_0x131e90(0x132)]=_0x33e20e,_0x316ace[_0x131e90(0x188)]=_0x518f99,_0x316ace[_0x131e90(0x114)]=_0x4c8b62,_0x316ace[_0x131e90(0x179)]=_0x5af08b,_0x316ace[_0x131e90(0x1d4)]=_0x55cef5,_0x316ace['room']=_0x411d44,_0x316ace[_0x131e90(0x151)]=_0x1259a5,_0x316ace['JO_number']=_0x5485f9;const _0x5c430c=await _0x316ace['save'](),_0x2e199f=await warehouse[_0x131e90(0x1b6)]({'name':_0x181b99[_0x131e90(0x10e)]['warehouse_name'],'room':_0x181b99[_0x131e90(0x10e)][_0x131e90(0x11c)]});_0x316ace[_0x131e90(0x188)][_0x131e90(0x14c)](_0x19b103=>{var _0x1d3406=_0x131e90,_0x58ee9b=0x0;const _0x286652=_0x2e199f[_0x1d3406(0x1d3)][_0x1d3406(0x1e3)](_0x1df619=>{var _0x527e11=_0x1d3406;_0x1df619['product_name']==_0x19b103[_0x527e11(0x13f)]&&_0x1df619[_0x527e11(0x1f9)]==_0x19b103[_0x527e11(0x1f9)]&&(_0x1df619['product_stock']=parseInt(_0x1df619[_0x527e11(0x1a4)])+parseInt(_0x19b103[_0x527e11(0x131)]),_0x58ee9b++);});_0x58ee9b=='0'&&(_0x2e199f['product_details']=_0x2e199f['product_details'][_0x1d3406(0x11e)]({'product_name':_0x19b103[_0x1d3406(0x13f)],'product_stock':_0x19b103[_0x1d3406(0x131)],'primary_code':_0x19b103[_0x1d3406(0x125)],'secondary_code':_0x19b103[_0x1d3406(0x1cc)],'product_code':_0x19b103[_0x1d3406(0x1a5)],'bay':_0x19b103[_0x1d3406(0x1f9)],'maxProducts':_0x19b103[_0x1d3406(0x1da)],'unit':_0x19b103[_0x1d3406(0x180)],'secondary_unit':_0x19b103['secondary_unit'],'expiry_date':_0x19b103['expiry_date']}));}),await _0x2e199f[_0x131e90(0x108)]();const _0x5e04bb=await s_payment_data[_0x131e90(0x1b6)]({'invoice':_0x181b99[_0x131e90(0x10e)][_0x131e90(0x1c1)]});if(_0x5e04bb===null){}else console['log']('suppliers',_0x5e04bb,_0x181b99[_0x131e90(0x10e)]['invoice']),_0x5e04bb[_0x131e90(0x1f5)]=_0x181b99[_0x131e90(0x10e)][_0x131e90(0x1f5)],await _0x5e04bb[_0x131e90(0x108)]();_0x181b99[_0x131e90(0x128)](_0x131e90(0x127),_0x131e90(0x1bc)),_0x540650[_0x131e90(0x18b)](_0x131e90(0x168));}catch(_0x4d1f27){console[_0x131e90(0x11b)](_0x4d1f27);}}),router['post'](a0_0x12ab79(0x1ff),auth,async(_0x562da3,_0x325d2d)=>{var _0x308d2c=a0_0x12ab79;try{const _0x1d6d22=_0x562da3[_0x308d2c(0x207)]['id'],{invoice:_0x211104,suppliers:_0x3e2f0f,payable:_0x4b4841,due_amount:_0x41cd97}=_0x562da3[_0x308d2c(0x10e)],_0x2e5b70=await purchases['findById'](_0x1d6d22);var _0xd812fc=_0x4b4841-_0x41cd97;_0x2e5b70[_0x308d2c(0x179)]=parseFloat(_0x2e5b70[_0x308d2c(0x179)])+parseFloat(_0x41cd97),_0x2e5b70[_0x308d2c(0x1d4)]=_0xd812fc;const _0x377bbd=await _0x2e5b70[_0x308d2c(0x108)]();console[_0x308d2c(0x11b)](_0x377bbd);const _0x58f22f=await s_payment_data['findOne']({'invoice':_0x211104});_0x58f22f['amount']=_0xd812fc,await _0x58f22f[_0x308d2c(0x108)]();let _0x52feb2=new Date(),_0x8eaf7f=('0'+_0x52feb2[_0x308d2c(0x107)]())[_0x308d2c(0x173)](-0x2),_0x2c437d=('0'+(_0x52feb2[_0x308d2c(0x1a7)]()+0x1))['slice'](-0x2),_0x2571fd=_0x52feb2[_0x308d2c(0x14b)](),_0x3e131e=_0x2571fd+'-'+_0x2c437d+'-'+_0x8eaf7f;const _0x8a3d5e=new suppliers_payment({'invoice':_0x211104,'date':_0x2571fd+'-'+_0x2c437d+'-'+_0x8eaf7f,'suppliers':_0x3e2f0f,'reason':_0x308d2c(0x167),'amount':_0x41cd97}),_0x3a8060=await _0x8a3d5e['save']();_0x562da3[_0x308d2c(0x128)](_0x308d2c(0x127),_0x308d2c(0x113)),_0x325d2d[_0x308d2c(0x18b)](_0x308d2c(0x146));}catch(_0x46ea12){console[_0x308d2c(0x11b)](_0x46ea12);}}),router[a0_0x12ab79(0x209)](a0_0x12ab79(0x1f8),auth,async(_0xdf7a89,_0x579704)=>{var _0x4d07e9=a0_0x12ab79;try{const {username:_0x47e7bc,email:_0x37c0f6,role:_0x5ab8dd}=_0xdf7a89[_0x4d07e9(0x1e4)],_0x54a26d=_0xdf7a89[_0x4d07e9(0x1e4)],_0x44a679=await profile[_0x4d07e9(0x1b6)]({'email':_0x54a26d[_0x4d07e9(0x133)]}),_0x5021bd=await master_shop['find']();console[_0x4d07e9(0x11b)](_0x4d07e9(0x1d7),_0x5021bd);const _0x311bb0=_0xdf7a89['params']['id'],_0x1d65fb=await purchases['findById'](_0x311bb0);console[_0x4d07e9(0x11b)](_0x1d65fb);const _0x1be9c8=await suppliers[_0x4d07e9(0x1b6)]({'name':_0x1d65fb[_0x4d07e9(0x1f5)]});console[_0x4d07e9(0x11b)](_0x1be9c8);if(_0x5021bd[0x0][_0x4d07e9(0x185)]==_0x4d07e9(0x118)){var _0x149bb5=users[_0x4d07e9(0x16f)];console[_0x4d07e9(0x11b)](_0x149bb5);}else{if(_0x5021bd[0x0]['language']=='Hindi')var _0x149bb5=users[_0x4d07e9(0x149)];else{if(_0x5021bd[0x0][_0x4d07e9(0x185)]==_0x4d07e9(0x139))var _0x149bb5=users['German'];else{if(_0x5021bd[0x0][_0x4d07e9(0x185)]==_0x4d07e9(0x142))var _0x149bb5=users[_0x4d07e9(0x142)];else{if(_0x5021bd[0x0][_0x4d07e9(0x185)]==_0x4d07e9(0x1f4))var _0x149bb5=users[_0x4d07e9(0x1f4)];else{if(_0x5021bd[0x0]['language']==_0x4d07e9(0x17e))var _0x149bb5=users['Portuguese'];else{if(_0x5021bd[0x0]['language']==_0x4d07e9(0x187))var _0x149bb5=users[_0x4d07e9(0x187)];else{if(_0x5021bd[0x0]['language']==_0x4d07e9(0x20c))var _0x149bb5=users[_0x4d07e9(0x1bb)];}}}}}}}_0x579704[_0x4d07e9(0x124)](_0x4d07e9(0x12f),{'success':_0xdf7a89[_0x4d07e9(0x128)](_0x4d07e9(0x127)),'errors':_0xdf7a89[_0x4d07e9(0x128)](_0x4d07e9(0x137)),'role':_0x54a26d,'profile':_0x44a679,'master_shop':_0x5021bd,'supplier':_0x1be9c8,'purchase':_0x1d65fb,'language':_0x149bb5});}catch(_0x98fbfd){console['log'](_0x98fbfd);}}),router['get']('/view/return_purchase/:id',auth,async(_0x448bdb,_0x502078)=>{var _0x31987b=a0_0x12ab79;try{const {username:_0x1cdb8b,email:_0x21fc7f,role:_0x59502a}=_0x448bdb[_0x31987b(0x1e4)],_0x24a703=_0x448bdb['user'],_0xe0ddce=await profile[_0x31987b(0x1b6)]({'email':_0x24a703[_0x31987b(0x133)]}),_0x2dfc7e=await master_shop[_0x31987b(0x1bd)]();console[_0x31987b(0x11b)]('master',_0x2dfc7e);const _0x1cbf20=_0x448bdb[_0x31987b(0x207)]['id'];console[_0x31987b(0x11b)](_0x1cbf20);const _0x1d3e2f=await purchases_finished['findById'](_0x1cbf20);console[_0x31987b(0x11b)](_0x31987b(0x18c),_0x1d3e2f);const _0x4665ed=await product[_0x31987b(0x1bd)]({}),_0x453394=await warehouse['aggregate']([{'$match':{'name':_0x1d3e2f[_0x31987b(0x132)],'room':_0x1d3e2f['room']}},{'$unwind':_0x31987b(0x1f2)},{'$group':{'_id':_0x31987b(0x158),'name':{'$first':_0x31987b(0x1ea)},'product_stock':{'$first':_0x31987b(0x1fa)},'bay':{'$first':_0x31987b(0x1cb)},'bin':{'$first':_0x31987b(0x1a6)},'type':{'$first':_0x31987b(0x1b8)},'floorlevel':{'$first':_0x31987b(0x17d)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x31987b(0x163)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x31987b(0x130)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x31987b(0x11b)](_0x31987b(0x1ab),_0x453394);let _0x2200ea;if(_0x24a703[_0x31987b(0x1a0)]=='staff'){const _0x330892=await staff[_0x31987b(0x1b6)]({'email':_0x24a703[_0x31987b(0x133)]});_0x2200ea=await warehouse[_0x31987b(0x1bd)]({'status':_0x31987b(0x170),'name':_0x330892[_0x31987b(0x1b4)],'warehouse_category':_0x31987b(0x1e9),'name':_0x31987b(0x17c)});}else _0x2200ea=await warehouse[_0x31987b(0x12b)]([{'$match':{'status':_0x31987b(0x170),'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'}},{'$group':{'_id':_0x31987b(0x195),'name':{'$first':_0x31987b(0x195)}}}]);if(_0x2dfc7e[0x0][_0x31987b(0x185)]=='English\x20(US)'){var _0x5bd7f1=users[_0x31987b(0x16f)];console[_0x31987b(0x11b)](_0x5bd7f1);}else{if(_0x2dfc7e[0x0]['language']==_0x31987b(0x149))var _0x5bd7f1=users['Hindi'];else{if(_0x2dfc7e[0x0]['language']==_0x31987b(0x139))var _0x5bd7f1=users[_0x31987b(0x139)];else{if(_0x2dfc7e[0x0]['language']==_0x31987b(0x142))var _0x5bd7f1=users[_0x31987b(0x142)];else{if(_0x2dfc7e[0x0][_0x31987b(0x185)]==_0x31987b(0x1f4))var _0x5bd7f1=users[_0x31987b(0x1f4)];else{if(_0x2dfc7e[0x0][_0x31987b(0x185)]=='Portuguese\x20(BR)')var _0x5bd7f1=users[_0x31987b(0x183)];else{if(_0x2dfc7e[0x0]['language']=='Chinese')var _0x5bd7f1=users[_0x31987b(0x187)];else{if(_0x2dfc7e[0x0]['language']=='Arabic\x20(ae)')var _0x5bd7f1=users[_0x31987b(0x1bb)];}}}}}}}_0x502078[_0x31987b(0x124)](_0x31987b(0x16d),{'success':_0x448bdb['flash'](_0x31987b(0x127)),'errors':_0x448bdb[_0x31987b(0x128)](_0x31987b(0x137)),'role':_0x24a703,'profile':_0xe0ddce,'user':_0x1d3e2f,'stock':_0x453394,'master_shop':_0x2dfc7e,'product':_0x4665ed,'language':_0x5bd7f1,'warehouse':_0x2200ea});}catch(_0x213947){console['log'](_0x213947);}}),router[a0_0x12ab79(0x1b3)](a0_0x12ab79(0x181),auth,async(_0x13b34b,_0x3774a4)=>{var _0x1ea69f=a0_0x12ab79;try{const {invoice:_0x294ba6,date:_0x1d09ad,warehouse_name:_0x9f7da0,Room_name:_0x24ffdd,product_name:_0x2740e5,purchase_quantity:_0x3b96a6,stocks:_0x221fb5,return_qty:_0x8c5be8,note:_0x38b29b,level:_0x113e22,isle:_0x2bb098,pallet:_0x2a3c99,to_warehouse_name:_0x4a2688,to_Room_name:_0x55aa41}=_0x13b34b[_0x1ea69f(0x10e)],_0x3783cd=await purchases_finished[_0x1ea69f(0x1b6)]({'_id':_0x13b34b['params']['id']}),_0x1dff7e=await warehouse[_0x1ea69f(0x1b6)]({'name':_0x9f7da0,'room':_0x24ffdd,'warehouse_category':_0x1ea69f(0x1e9)});if(typeof _0x2740e5=='string')var _0x4f1a8f=[_0x13b34b[_0x1ea69f(0x10e)][_0x1ea69f(0x13f)]],_0x2f1f80=[_0x13b34b[_0x1ea69f(0x10e)][_0x1ea69f(0x1c9)]],_0x367d1a=[_0x13b34b[_0x1ea69f(0x10e)]['stocks']],_0x447ee4=[_0x13b34b[_0x1ea69f(0x10e)][_0x1ea69f(0x11d)]],_0x44d373=[_0x13b34b[_0x1ea69f(0x10e)][_0x1ea69f(0x159)]],_0x554e42=[_0x13b34b[_0x1ea69f(0x10e)]['product_code_hide']],_0x511ebe=[_0x13b34b[_0x1ea69f(0x10e)][_0x1ea69f(0x154)]],_0x7d905b=[_0x13b34b[_0x1ea69f(0x10e)]['secondary_code_hide']];else var _0x4f1a8f=[..._0x13b34b[_0x1ea69f(0x10e)][_0x1ea69f(0x13f)]],_0x2f1f80=[..._0x13b34b[_0x1ea69f(0x10e)][_0x1ea69f(0x1c9)]],_0x367d1a=[..._0x13b34b['body'][_0x1ea69f(0x19f)]],_0x447ee4=[..._0x13b34b[_0x1ea69f(0x10e)][_0x1ea69f(0x11d)]],_0x44d373=[..._0x13b34b[_0x1ea69f(0x10e)]['level']],_0x554e42=[..._0x13b34b[_0x1ea69f(0x10e)][_0x1ea69f(0x12c)]],_0x511ebe=[..._0x13b34b['body'][_0x1ea69f(0x154)]],_0x7d905b=[..._0x13b34b['body'][_0x1ea69f(0x1f6)]];const _0x465213=_0x4f1a8f[_0x1ea69f(0x1e3)](_0x439625=>{return _0x439625={'product_name':_0x439625};});_0x2f1f80[_0x1ea69f(0x14c)]((_0x4637a1,_0x5ded37)=>{var _0x482b59=_0x1ea69f;_0x465213[_0x5ded37][_0x482b59(0x1c9)]=_0x4637a1;}),_0x367d1a[_0x1ea69f(0x14c)]((_0x3127e5,_0x5b09ce)=>{var _0x2dc4d1=_0x1ea69f;_0x465213[_0x5b09ce][_0x2dc4d1(0x136)]=_0x3127e5;}),_0x447ee4[_0x1ea69f(0x14c)]((_0x4d6250,_0x627667)=>{var _0xaa063b=_0x1ea69f;_0x465213[_0x627667][_0xaa063b(0x11d)]=_0x4d6250;}),_0x44d373[_0x1ea69f(0x14c)]((_0x179c59,_0x18a6d7)=>{var _0x182d29=_0x1ea69f;_0x465213[_0x18a6d7][_0x182d29(0x1f9)]=_0x179c59;}),_0x554e42[_0x1ea69f(0x14c)]((_0x3e13b7,_0x3da228)=>{var _0x111116=_0x1ea69f;_0x465213[_0x3da228][_0x111116(0x1a5)]=_0x3e13b7;}),_0x511ebe['forEach']((_0x114a87,_0x4d8b38)=>{_0x465213[_0x4d8b38]['primary_code']=_0x114a87;}),_0x7d905b['forEach']((_0x3c8c61,_0x16393c)=>{_0x465213[_0x16393c]['secondary_code']=_0x3c8c61;}),_0x465213['forEach'](_0xf07b99=>{var _0x5c05d8=_0x1ea69f;console[_0x5c05d8(0x11b)](_0xf07b99);const _0x41b0c4=_0x1dff7e[_0x5c05d8(0x1d3)][_0x5c05d8(0x1e3)](_0x49e113=>{var _0x5253a9=_0x5c05d8;_0x49e113[_0x5253a9(0x13f)]==_0xf07b99[_0x5253a9(0x13f)]&&_0x49e113[_0x5253a9(0x1f9)]==_0xf07b99[_0x5253a9(0x1f9)]&&(console[_0x5253a9(0x11b)](parseInt(_0x49e113['product_stock'])+_0x5253a9(0x198)+parseInt(_0xf07b99['return_qty'])),_0x49e113[_0x5253a9(0x1a4)]=parseInt(_0x49e113[_0x5253a9(0x1a4)])-parseInt(_0xf07b99['return_qty']));});}),await _0x1dff7e[_0x1ea69f(0x108)]();var _0x33d793=0x0;_0x465213[_0x1ea69f(0x14c)](_0x586048=>{var _0x2591a9=_0x1ea69f;(parseInt(_0x586048['purchase_quantity'])<parseInt(_0x586048['return_qty'])||parseInt(_0x586048[_0x2591a9(0x136)])<parseInt(_0x586048[_0x2591a9(0x11d)]))&&_0x33d793++;});if(_0x33d793!=0x0)return _0x13b34b[_0x1ea69f(0x128)]('errors',_0x1ea69f(0x16c)),_0x3774a4[_0x1ea69f(0x18b)](_0x1ea69f(0x192));const _0x260a34=new purchases_return_finished({'invoice':_0x294ba6,'suppliers':_0x13b34b['body'][_0x1ea69f(0x1f5)],'date':_0x1d09ad,'warehouse_name':_0x9f7da0,'return_product':_0x465213,'note':_0x38b29b,'room':_0x24ffdd,'to_warehouse_name':_0x4a2688,'to_room':_0x55aa41}),_0xe128bc=await _0x260a34[_0x1ea69f(0x108)](),_0x962621=await purchases_return_finished[_0x1ea69f(0x1b6)]({'invoice':_0x294ba6}),_0x46ddd0=await warehouse[_0x1ea69f(0x1b6)]({'name':_0x4a2688,'room':_0x55aa41,'warehouse_category':'Finished\x20Goods'});_0x962621[_0x1ea69f(0x1a1)][_0x1ea69f(0x14c)](_0x488972=>{var _0x494c76=_0x1ea69f,_0x12a068=0x0;const _0x2851d3=_0x46ddd0[_0x494c76(0x1d3)][_0x494c76(0x1e3)](_0x38c44b=>{var _0x243968=_0x494c76;console['log'](_0x38c44b[_0x243968(0x13f)]+'=='+_0x488972[_0x243968(0x13f)]+'&&'+_0x38c44b[_0x243968(0x1f9)]+'=='+_0x488972[_0x243968(0x1f9)]),_0x38c44b['product_name']==_0x488972[_0x243968(0x13f)]&&_0x38c44b['bay']==_0x488972[_0x243968(0x1f9)]&&(_0x38c44b[_0x243968(0x1a4)]=parseInt(_0x38c44b[_0x243968(0x1a4)])-parseInt(_0x488972[_0x243968(0x11d)]),_0x12a068++);});_0x12a068=='0'&&(_0x46ddd0[_0x494c76(0x1d3)]=_0x46ddd0[_0x494c76(0x1d3)][_0x494c76(0x11e)]({'product_name':_0x488972[_0x494c76(0x13f)],'product_stock':_0x488972['return_qty'],'primary_code':_0x488972[_0x494c76(0x125)],'secondary_code':_0x488972[_0x494c76(0x1cc)],'product_code':_0x488972['product_code'],'bay':_0x488972[_0x494c76(0x1f9)],'maxProducts':0xf423f}));}),await _0x46ddd0[_0x1ea69f(0x108)]();const _0x597b7e=await purchases_finished['findOne']({'invoice':_0x294ba6});_0x597b7e[_0x1ea69f(0x176)]=_0x1ea69f(0x1d9);const _0x2df550=await _0x597b7e[_0x1ea69f(0x108)](),_0x278fbd=new s_payment_data({'invoice':_0x294ba6,'suppliers':_0x13b34b['body'][_0x1ea69f(0x1f5)],'reason':_0x1ea69f(0x1d1)});await _0x278fbd['save']();const _0xf7dc9f=await master_shop[_0x1ea69f(0x1bd)](),_0x4cf6e2=await email_settings[_0x1ea69f(0x1b6)](),_0x3c0669=await suppliers[_0x1ea69f(0x1b6)]({'name':_0x13b34b['body']['suppliers']});_0xf7dc9f[0x0][_0x1ea69f(0x147)]==0x1?(right_currency=_0xf7dc9f[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0xf7dc9f[0x0][_0x1ea69f(0x122)]);var _0x2bd891=_0x4f1a8f,_0x5344e6=_0x447ee4,_0x45ffcc='',_0x2e0095;for(_0x2e0095 in _0x2bd891){_0x45ffcc+=_0x1ea69f(0x140)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2bd891[_0x2e0095]+_0x1ea69f(0x1c5)+_0x1ea69f(0x17a)+_0x5344e6[_0x2e0095]+_0x1ea69f(0x1c5)+'</tr>';}let _0x36a19c=nodemailer[_0x1ea69f(0x153)]({'service':_0x1ea69f(0x172),'auth':{'user':_0x4cf6e2[_0x1ea69f(0x133)],'pass':_0x4cf6e2[_0x1ea69f(0x109)]}}),_0x10b17c={'from':_0x4cf6e2['email'],'to':_0x3c0669[_0x1ea69f(0x133)],'subject':_0x1ea69f(0x1ec),'attachments':[{'filename':'Logo.png','path':__dirname+_0x1ea69f(0x20a)+_0x1ea69f(0x19d)+_0xf7dc9f[0x0][_0x1ea69f(0x105)],'cid':_0x1ea69f(0x1d8)}],'html':_0x1ea69f(0x14d)+_0x1ea69f(0x115)+'</head><body>'+_0x1ea69f(0x171)+_0x1ea69f(0x161)+'<div>'+_0x1ea69f(0x123)+_0x1ea69f(0x178)+'<div>'+_0x1ea69f(0x1aa)+_0xf7dc9f[0x0]['site_title']+'\x20</h2>'+_0x1ea69f(0x178)+_0x1ea69f(0x178)+_0x1ea69f(0x11f)+_0x1ea69f(0x171)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1ea69f(0x1fe)+_0x294ba6+'\x20'+_0x1ea69f(0x200)+_0x1ea69f(0x18f)+_0x1d09ad+'\x20'+'</span>'+'</h5>'+_0x1ea69f(0x178)+_0x1ea69f(0x19c)+_0x1ea69f(0x177)+_0x1ea69f(0x140)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1ea69f(0x184)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x1ea69f(0x138)+_0x1ea69f(0x1f0)+_0x1ea69f(0x208)+_0x1ea69f(0x18e)+'\x20'+_0x45ffcc+'\x20'+_0x1ea69f(0x1dd)+_0x1ea69f(0x121)+_0x1ea69f(0x171)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0xf7dc9f[0x0]['site_title']+_0x1ea69f(0x19b)+_0x1ea69f(0x178)+_0x1ea69f(0x178)+_0x1ea69f(0x1ce)};_0x36a19c['sendMail'](_0x10b17c,function(_0xfc3275,_0x4dd662){var _0x15eee3=_0x1ea69f;_0xfc3275?console[_0x15eee3(0x11b)]('Error\x20Occurs'):console[_0x15eee3(0x11b)](_0x15eee3(0x13a));}),_0x13b34b['flash']('success',_0x1ea69f(0x1c3)),_0x3774a4[_0x1ea69f(0x18b)](_0x1ea69f(0x168));}catch(_0x440ebc){_0x3774a4[_0x1ea69f(0x166)](0xc8)['json']({'message':_0x440ebc[_0x1ea69f(0x1ca)]});}}),router[a0_0x12ab79(0x209)](a0_0x12ab79(0x1a8),auth,async(_0x4fdbc6,_0xc28608)=>{var _0x35b938=a0_0x12ab79;try{const {username:_0x5d868a,email:_0xc3293,role:_0x46677c}=_0x4fdbc6[_0x35b938(0x1e4)],_0x19f053=_0x4fdbc6[_0x35b938(0x1e4)],_0x27ad07=await profile[_0x35b938(0x1b6)]({'email':_0x19f053[_0x35b938(0x133)]}),_0x51d3d3=await master_shop[_0x35b938(0x1bd)](),_0x16ffb0=_0x4fdbc6[_0x35b938(0x207)]['id'],_0x3fdcdd=await purchases_finished[_0x35b938(0x1b5)](_0x16ffb0);if(_0x51d3d3[0x0][_0x35b938(0x185)]==_0x35b938(0x118))var _0x11b4b0=users[_0x35b938(0x16f)];else{if(_0x51d3d3[0x0][_0x35b938(0x185)]==_0x35b938(0x149))var _0x11b4b0=users[_0x35b938(0x149)];else{if(_0x51d3d3[0x0]['language']==_0x35b938(0x139))var _0x11b4b0=users[_0x35b938(0x139)];else{if(_0x51d3d3[0x0][_0x35b938(0x185)]==_0x35b938(0x142))var _0x11b4b0=users['Spanish'];else{if(_0x51d3d3[0x0][_0x35b938(0x185)]==_0x35b938(0x1f4))var _0x11b4b0=users[_0x35b938(0x1f4)];else{if(_0x51d3d3[0x0][_0x35b938(0x185)]==_0x35b938(0x17e))var _0x11b4b0=users['Portuguese'];else{if(_0x51d3d3[0x0]['language']==_0x35b938(0x187))var _0x11b4b0=users['Chinese'];else{if(_0x51d3d3[0x0][_0x35b938(0x185)]=='Arabic\x20(ae)')var _0x11b4b0=users['Arabic'];}}}}}}}_0xc28608[_0x35b938(0x124)]('all_purchases_barcode',{'success':_0x4fdbc6['flash']('success'),'errors':_0x4fdbc6[_0x35b938(0x128)](_0x35b938(0x137)),'role':_0x19f053,'profile':_0x27ad07,'alldata':_0x3fdcdd,'master_shop':_0x51d3d3,'language':_0x11b4b0}),console[_0x35b938(0x11b)](alldata);}catch(_0x583505){console['log'](_0x583505);}}),router[a0_0x12ab79(0x1b3)](a0_0x12ab79(0x129),async(_0x20580d,_0x429c25)=>{var _0x61c84e=a0_0x12ab79;const {product_code:_0x36522d}=_0x20580d[_0x61c84e(0x10e)];var _0x4797b2;const _0x49dc48=await product['aggregate']([{'$match':{'primary_code':_0x36522d,'product_category':_0x61c84e(0x1e9)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x61c84e(0x1be)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x61c84e(0x119)},'product_code':{'$first':_0x61c84e(0x1c7)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x61c84e(0x15d)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x61c84e(0x15c)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x61c84e(0x117)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2e885b=await product['aggregate']([{'$match':{'secondary_code':_0x36522d}},{'$group':{'_id':_0x61c84e(0x1f7),'name':{'$first':_0x61c84e(0x195)},'category':{'$first':'$category'},'brand':{'$first':_0x61c84e(0x1be)},'unit':{'$first':_0x61c84e(0x11a)},'alertquantity':{'$first':_0x61c84e(0x119)},'product_code':{'$first':_0x61c84e(0x1c7)},'primary_code':{'$first':_0x61c84e(0x164)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x61c84e(0x14a)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x61c84e(0x117)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x49dc48[_0x61c84e(0x1e7)]>0x0)_0x4797b2=_0x49dc48;else _0x2e885b['length']>0x0&&(_0x4797b2=_0x2e885b);_0x429c25[_0x61c84e(0x199)](_0x4797b2);}),router[a0_0x12ab79(0x1b3)](a0_0x12ab79(0x12d),async(_0x3e4aef,_0x2d8bd9)=>{var _0x4a5b23=a0_0x12ab79;const {productCode:_0x42bc1a,bay:_0x5f11b4,warehouses:_0x10bbfe,room:_0xa7d70}=_0x3e4aef[_0x4a5b23(0x10e)];console[_0x4a5b23(0x11b)](_0x3e4aef['body']);try{const _0x91e0ad=await warehouse['aggregate']([{'$match':{'name':_0x10bbfe,'room':_0xa7d70}},{'$unwind':_0x4a5b23(0x1f2)},{'$match':{'product_details.bay':parseInt(_0x5f11b4)}},{'$group':{'_id':_0x4a5b23(0x158),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4a5b23(0x1fa)},'bay':{'$first':_0x4a5b23(0x1cb)},'maxProducts':{'$first':_0x4a5b23(0x155)}}}]);_0x2d8bd9[_0x4a5b23(0x166)](0xc8)[_0x4a5b23(0x199)](_0x91e0ad);}catch(_0x50916a){_0x2d8bd9['status'](0x194)[_0x4a5b23(0x199)]({'message':_0x50916a[_0x4a5b23(0x1ca)]});}}),module[a0_0x12ab79(0x141)]=router;