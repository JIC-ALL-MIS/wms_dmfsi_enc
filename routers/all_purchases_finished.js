var a0_0x34d2cf=a0_0x1330;(function(_0x1db468,_0x56f8bb){var _0x744d4=a0_0x1330,_0x8a73c7=_0x1db468();while(!![]){try{var _0xcf621d=-parseInt(_0x744d4(0x18d))/0x1+parseInt(_0x744d4(0x1b3))/0x2+parseInt(_0x744d4(0x191))/0x3*(-parseInt(_0x744d4(0x14c))/0x4)+-parseInt(_0x744d4(0x167))/0x5+parseInt(_0x744d4(0x125))/0x6+parseInt(_0x744d4(0x11a))/0x7*(parseInt(_0x744d4(0x1c4))/0x8)+parseInt(_0x744d4(0x1ab))/0x9;if(_0xcf621d===_0x56f8bb)break;else _0x8a73c7['push'](_0x8a73c7['shift']());}catch(_0x1e649c){_0x8a73c7['push'](_0x8a73c7['shift']());}}}(a0_0x320c,0x26333));const express=require(a0_0x34d2cf(0x202)),app=express(),router=express[a0_0x34d2cf(0x1f6)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require('nodemailer');var ejs=require(a0_0x34d2cf(0x17a));const path=require(a0_0x34d2cf(0x1c1)),users=require(a0_0x34d2cf(0x1d1));router['get'](a0_0x34d2cf(0x152),auth,async(_0x3325e6,_0x365e05)=>{var _0x3818a2=a0_0x34d2cf;try{const {username:_0x8755d3,email:_0x2e2eb4,role:_0x32517b}=_0x3325e6[_0x3818a2(0x13f)],_0x37789a=_0x3325e6[_0x3818a2(0x13f)],_0x186ad4=await profile[_0x3818a2(0x1fd)]({'email':_0x37789a['email']}),_0x907c9f=await staff[_0x3818a2(0x1fd)]({'email':_0x37789a[_0x3818a2(0x1c3)]});if(_0x37789a[_0x3818a2(0x153)]==_0x3818a2(0x1b4)){const _0x37ee83=await staff[_0x3818a2(0x1fd)]({'email':_0x37789a[_0x3818a2(0x1c3)]});}const _0x4d7973=await master_shop[_0x3818a2(0x1c7)]();let _0x55acf6;if(_0x37789a[_0x3818a2(0x153)]==_0x3818a2(0x1b4)){const _0x4f089d=await staff[_0x3818a2(0x1fd)]({'email':_0x37789a[_0x3818a2(0x1c3)]});_0x55acf6=await purchases_finished[_0x3818a2(0x1cc)]([{'$match':{'warehouse_name':_0x4f089d[_0x3818a2(0x12e)]}},{'$lookup':{'from':_0x3818a2(0x1f3),'localField':_0x3818a2(0x1f3),'foreignField':_0x3818a2(0x215),'as':'suppliers_docs'}},{'$unwind':_0x3818a2(0x146)},{'$unwind':_0x3818a2(0x181)},{'$group':{'_id':_0x3818a2(0x208),'invoice':{'$first':_0x3818a2(0x1d4)},'suppliers':{'$first':_0x3818a2(0x184)},'date':{'$first':_0x3818a2(0x154)},'warehouse_name':{'$first':_0x3818a2(0x129)},'room':{'$first':_0x3818a2(0x214)},'product':{'$push':_0x3818a2(0x181)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3818a2(0x187)},'due_amount':{'$first':_0x3818a2(0x20c)},'return_data':{'$first':_0x3818a2(0x1d7)},'batch_code':{'$first':_0x3818a2(0x1f4)},'expiry_date':{'$first':_0x3818a2(0x1aa)},'suppliers_docs':{'$first':_0x3818a2(0x146)},'total_product_quantity':{'$sum':_0x3818a2(0x188)},'level':{'$addToSet':_0x3818a2(0x163)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x3818a2(0x1c0)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x55acf6=await purchases_finished['aggregate']([{'$unwind':_0x3818a2(0x181)},{'$group':{'_id':_0x3818a2(0x208),'invoice':{'$first':_0x3818a2(0x1d4)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x3818a2(0x154)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x3818a2(0x18f)},'product':{'$push':_0x3818a2(0x181)},'note':{'$first':_0x3818a2(0x1ec)},'paid_amount':{'$first':_0x3818a2(0x187)},'due_amount':{'$first':_0x3818a2(0x20c)},'return_data':{'$first':_0x3818a2(0x1d7)},'batch_code':{'$first':_0x3818a2(0x1f4)},'expiry_date':{'$first':_0x3818a2(0x1aa)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x3818a2(0x163)},'isle':{'$addToSet':_0x3818a2(0x149)},'type':{'$addToSet':_0x3818a2(0x1c0)},'floorlevel':{'$addToSet':_0x3818a2(0x1b6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x4d7973[0x0][_0x3818a2(0x161)]==_0x3818a2(0x1c8))var _0x5ce1b9=users[_0x3818a2(0x1bc)];else{if(_0x4d7973[0x0][_0x3818a2(0x161)]=='Hindi')var _0x5ce1b9=users[_0x3818a2(0x217)];else{if(_0x4d7973[0x0]['language']==_0x3818a2(0x141))var _0x5ce1b9=users[_0x3818a2(0x141)];else{if(_0x4d7973[0x0][_0x3818a2(0x161)]==_0x3818a2(0x162))var _0x5ce1b9=users[_0x3818a2(0x162)];else{if(_0x4d7973[0x0][_0x3818a2(0x161)]==_0x3818a2(0x1dc))var _0x5ce1b9=users[_0x3818a2(0x1dc)];else{if(_0x4d7973[0x0][_0x3818a2(0x161)]==_0x3818a2(0x1d2))var _0x5ce1b9=users[_0x3818a2(0x120)];else{if(_0x4d7973[0x0][_0x3818a2(0x161)]==_0x3818a2(0x205))var _0x5ce1b9=users[_0x3818a2(0x205)];else{if(_0x4d7973[0x0][_0x3818a2(0x161)]==_0x3818a2(0x1e8))var _0x5ce1b9=users['Arabic'];}}}}}}}_0x365e05['render'](_0x3818a2(0x1e3),{'success':_0x3325e6[_0x3818a2(0x178)](_0x3818a2(0x142)),'errors':_0x3325e6[_0x3818a2(0x178)](_0x3818a2(0x18c)),'purchases':_0x55acf6,'role':_0x37789a,'profile':_0x186ad4,'master_shop':_0x4d7973,'language':_0x5ce1b9});}catch(_0x5d3c06){console['log'](_0x3818a2(0x1e5),_0x5d3c06),_0x365e05['status'](0xc8)['json']({'message':_0x5d3c06[_0x3818a2(0x1f5)]});}});function a0_0x320c(){var _0xccfe2a=['purchases\x20item\x20return\x20successfull','product_name','gmail','secondary_unit','updateOne','warehouse_name','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','German','success','host','$product_details.bay','/all_purchases/view','$suppliers_docs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','add_purchases\x20error','$product.bin','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','24OSicCU','currency','status','return_product','$secondary_unit','getMonth','/view','role','$date','product_stock','prod_qty','all_purchases_barcode','$product_details.product_stock','_id','$maxProdPerUnit','exports','\x20Order\x20Date\x20:\x20','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$name','language','Spanish','$product.bay','purchase_invoice','logo','$product_details.primary_code','1521630JXiXWq','Enclosed','True','Ambient','prod_Qty','</tr>','batch_code','redirect','render','<!DOCTYPE\x20html>','get','floor','forEach','Error\x20Occurs','concat','invoice','all','flash','$product_details.bin','ejs','<hr\x20class=\x22my-3\x22>','back','standard_unit','/barcode/:id','payment\x20successfull','\x20<>\x20','$product','user_id','stock_data','$suppliers','return_qty','<h5>','$paid_amount','$product.quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','log','\x20</h2>','errors','150331kCarRg','</h5>','$product.room_name','</div>','144654MqdWON','stocks','length','primary_code_hide','Finished\x20Goods','purchase_quantity','maxStocks','product_code_hide','</body></html>','image','$product_details.product_code','An\x20error\x20occurred.','<span\x20style=\x22float:\x20right;\x22>','catch','amount','master','then','getDate','purchase\x20data\x20add\x20successfully','slice','Arabic','return_purchase_finished','post','primary_code','<div>','$expiry_date','5143806pBBdlm','Logo.png','add_purchases_finished','<h5\x20style=\x22text-align:\x20left;\x22>','product_details','<html><head><title></title>','createTransport','Return\x20Goods','374526VgrwPK','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product.floorlevel','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','prod_invoice','/barcode_scanner','There\x27s\x20a\x20error\x20in\x20this\x20transaction','English','params','$secondary_code','Rack\x202','$product.type','path','POnumber','email','24oqbPxp','<tr>','edit_purchases_finished','find','English\x20(US)','DRY\x20GOODS','secondary_code','json','aggregate','$product_details.floorlevel','max_product_unit','product_code','$primary_code','../public/language/languages.json','Portuguese\x20(BR)','$product_code','$invoice','</head><body>','</tbody>','$return_data','/give_payment/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','abs','<table\x20style=\x22width:\x20100%\x20!important;\x22>','French','prod_primunit','Email\x20sent\x20successfully','production_date','Purchase\x20Return\x20Mail','expiry_date','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','all_purchases_finished','Purchase\x20Mail','table\x20page','getFullYear','save','Arabic\x20(ae)','prod_code','RoomAssign','filter','$note','/all_purchases_finished/view','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','body','/view/add_purchases','Room_name','/invoice/:id','suppliers','$batch_code','message','Router','port','site_title','Paid\x20For\x20Purchase','prod_cat','stock_quantity','purchase\x20data\x20update\x20successfully','findOne','paid_amount','<h2>\x20','map','room_name','express','INCF-','prod_name','Chinese','product_date','$category','$_id','prod_unit','$brand','date','$due_amount','sendMail','prod_level','note','</span>','/view/add_purchases/:id','FGSEmail','MaxStocks_data','$room','name','toString','Hindi','maxperunit','\x20Order\x20Number\x20:\x20','room','string','127449URFiBR','/view/return_purchase/:id','product_cat','product','findById','/upload/','Portuguese','currency_placement','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','error','bay','522084KyWHWD','</table>','</td>','/CheckingWarehouse','$warehouse_name','</thead>','quantity','secondary_code_hide','padStart','warehouse','/view/:id','FROZEN\x20GOODS','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$alertquantity','$product_details.product_name','level','$maxStocks','edit_purchases_finished_view','$product_details.type'];a0_0x320c=function(){return _0xccfe2a;};return a0_0x320c();}function BayBinSelected(_0x5d4800,_0x20e068){var _0x5eaa34=a0_0x34d2cf,_0x826c94=[],_0x500acb=[];if(_0x5d4800==_0x5eaa34(0x1c9)){switch(_0x20e068){case'Rack\x201':_0x826c94=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x5eaa34(0x1bf):_0x826c94=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x500acb=['DG'];}else{if(_0x5d4800==_0x5eaa34(0x130)){switch(_0x20e068){case'Rack\x201':_0x826c94=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x5eaa34(0x1bf):_0x826c94=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x500acb=['FG'];}}return{'levels':_0x826c94,'identify':_0x500acb};}async function getRandom8DigitNumber(){var _0x2a4590=a0_0x34d2cf;const _0x22da2e=0x989680,_0x426202=0x5f5e0ff,_0x1e666e=Math[_0x2a4590(0x172)](Math['random']()*(_0x426202-_0x22da2e+0x1))+_0x22da2e;var _0x2695af;const _0x82dda=await purchases_finished['findOne']({'invoice':_0x2a4590(0x203)+_0x1e666e});return _0x82dda&&_0x82dda[_0x2a4590(0x193)]>0x0?_0x2695af=_0x2a4590(0x203)+_0x1e666e:_0x2695af=_0x2a4590(0x203)+_0x1e666e,_0x2695af;}function a0_0x1330(_0x2cac74,_0x562cf9){var _0x320c14=a0_0x320c();return a0_0x1330=function(_0x133066,_0x2e34f5){_0x133066=_0x133066-0x119;var _0x2f5b82=_0x320c14[_0x133066];return _0x2f5b82;},a0_0x1330(_0x2cac74,_0x562cf9);}router[a0_0x34d2cf(0x171)](a0_0x34d2cf(0x1f0),auth,async(_0xa0a0cc,_0x59f634)=>{var _0xf605f3=a0_0x34d2cf;try{const {username:_0x194d43,email:_0x4b9d54,role:_0x27e6e1}=_0xa0a0cc[_0xf605f3(0x13f)],_0x13abc5=_0xa0a0cc[_0xf605f3(0x13f)],_0x50a08a=await profile[_0xf605f3(0x1fd)]({'email':_0x13abc5[_0xf605f3(0x1c3)]}),_0x50a979=await master_shop['find'](),_0x5e24bc=await staff[_0xf605f3(0x1fd)]({'email':_0x13abc5[_0xf605f3(0x1c3)]}),_0x37c92c=await suppliers[_0xf605f3(0x1c7)]({});let _0x27b3cb;if(_0x13abc5[_0xf605f3(0x153)]=='staff'){const _0x54517d=await staff['findOne']({'email':_0x13abc5[_0xf605f3(0x1c3)]});_0x27b3cb=await warehouse[_0xf605f3(0x1cc)]([{'$match':{'status':_0xf605f3(0x131),'name':_0x54517d['warehouse'],'warehouse_category':_0xf605f3(0x195)}},{'$group':{'_id':_0xf605f3(0x160),'name':{'$first':_0xf605f3(0x160)}}}]);}else _0x27b3cb=await warehouse[_0xf605f3(0x1cc)]([{'$match':{'status':'Enabled','warehouse_category':_0xf605f3(0x195),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0xf605f3(0x160)}}}]);const _0x2d7f5b=await product[_0xf605f3(0x1c7)]({}),_0x2ead07=await warehouse[_0xf605f3(0x1c7)]({'status':'Enabled'}),_0x4f62e9=await purchases_finished[_0xf605f3(0x1c7)]({}),_0x6984a2=_0x4f62e9[_0xf605f3(0x193)]+0x1,_0x3aa256=_0xf605f3(0x203)+_0x6984a2[_0xf605f3(0x216)]()[_0xf605f3(0x12d)](0x5,'0');var _0x37ed8c=[_0xf605f3(0x16a),_0xf605f3(0x168)];if(_0x50a979[0x0][_0xf605f3(0x161)]==_0xf605f3(0x1c8))var _0x2cbbf7=users[_0xf605f3(0x1bc)];else{if(_0x50a979[0x0][_0xf605f3(0x161)]=='Hindi')var _0x2cbbf7=users[_0xf605f3(0x217)];else{if(_0x50a979[0x0][_0xf605f3(0x161)]==_0xf605f3(0x141))var _0x2cbbf7=users[_0xf605f3(0x141)];else{if(_0x50a979[0x0][_0xf605f3(0x161)]==_0xf605f3(0x162))var _0x2cbbf7=users[_0xf605f3(0x162)];else{if(_0x50a979[0x0][_0xf605f3(0x161)]=='French')var _0x2cbbf7=users['French'];else{if(_0x50a979[0x0][_0xf605f3(0x161)]==_0xf605f3(0x1d2))var _0x2cbbf7=users['Portuguese'];else{if(_0x50a979[0x0][_0xf605f3(0x161)]==_0xf605f3(0x205))var _0x2cbbf7=users[_0xf605f3(0x205)];else{if(_0x50a979[0x0][_0xf605f3(0x161)]=='Arabic\x20(ae)')var _0x2cbbf7=users[_0xf605f3(0x1a5)];}}}}}}}const _0x3b1b2d=getRandom8DigitNumber();_0x3b1b2d[_0xf605f3(0x1a1)](_0x5013a0=>{var _0x3a2a78=_0xf605f3;_0x59f634[_0x3a2a78(0x16f)](_0x3a2a78(0x1ad),{'success':_0xa0a0cc['flash'](_0x3a2a78(0x142)),'errors':_0xa0a0cc[_0x3a2a78(0x178)]('errors'),'role':_0x13abc5,'profile':_0x50a08a,'suppliers':_0x37c92c,'warehouse':_0x27b3cb,'product':_0x2d7f5b,'invoice':_0x5013a0,'master_shop':_0x50a979,'language':_0x2cbbf7,'find_data':_0x2ead07,'rooms_data':_0x37ed8c});})[_0xf605f3(0x19e)](_0x38ee4c=>{var _0x55ad32=_0xf605f3;_0xa0a0cc[_0x55ad32(0x178)](_0x55ad32(0x18c),_0x55ad32(0x1bb)),_0x59f634[_0x55ad32(0x16e)](_0x55ad32(0x1ed));});}catch(_0x32e634){console[_0xf605f3(0x18a)](_0x32e634);}}),router[a0_0x34d2cf(0x171)](a0_0x34d2cf(0x211),auth,async(_0x5ecd52,_0x5cbe6c)=>{var _0x207da3=a0_0x34d2cf;try{const _0x4fe9cf=_0x5ecd52[_0x207da3(0x1bd)]['id'];console[_0x207da3(0x18a)](_0x4fe9cf);const _0x4abaa2=await master_shop[_0x207da3(0x1c7)]();console[_0x207da3(0x18a)](_0x207da3(0x1a0),_0x4abaa2);const _0x467c4e=await product[_0x207da3(0x1fd)]({'name':_0x4fe9cf});console[_0x207da3(0x18a)](_0x207da3(0x11d),_0x467c4e),_0x5cbe6c[_0x207da3(0x14e)](0xc8)['json']({'product_data':_0x467c4e,'master':_0x4abaa2});}catch(_0xb0e623){console[_0x207da3(0x18a)](_0x207da3(0x148),_0xb0e623);}}),router['post'](a0_0x34d2cf(0x1f0),auth,async(_0x48c1c8,_0x52aa63)=>{var _0x3d2311=a0_0x34d2cf;try{const {invoice:_0xf09b5c,date:_0x4d2c23,warehouse_name:_0x31e07e,prod_name:_0x1cf8bd,prod_code:_0x2cab7f,prod_qty:_0x22d194,prod_unit:_0x36bd49,prod_secondunit:_0x391fe8,prod_level:_0x20cf3e,prod_isle:_0x4d657d,prod_pallet:_0x324c27,note:_0x536465,expiry_date:_0x8f5a32,batch_code:_0x3593aa,payable:_0xb48ccb,due_amount:_0x18d5e9,Room_name:_0x1ac8db,primary_code:_0x298419,secondary_code:_0x5770ad,MaxStocks_data:_0x160ef5,PO_number:_0x499f9b,SCRN:_0x2803c3,JO_number:_0xf99420}=_0x48c1c8[_0x3d2311(0x1ef)];if(typeof _0x1cf8bd==_0x3d2311(0x119))var _0x4c7b18=[_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x204)]],_0x34dae3=[_0x48c1c8[_0x3d2311(0x1ef)]['prod_code']],_0x569758=[_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x16b)]],_0x4b4e14=[_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1dd)]],_0x4f49c7=[_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x14a)]],_0x35f387=[_0x48c1c8['body'][_0x3d2311(0x20e)]],_0x3dc1d4=[_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1a8)]],_0xb4c7a4=[_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1ca)]],_0x29431d=[_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x213)]],_0x2202f9=[_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x16d)]],_0x29d6fe=[_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1e1)]],_0x13018c=[_0x48c1c8['body']['product_date']],_0x5c12aa=[_0x48c1c8['body'][_0x3d2311(0x1ce)]],_0x32b475=[_0x48c1c8['body'][_0x3d2311(0x1fa)]],_0xfac0da=[_0x48c1c8[_0x3d2311(0x1ef)]['RoomAssign']],_0x2f039e=[_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1b9)]];else var _0x4c7b18=[..._0x48c1c8['body']['prod_name']],_0x34dae3=[..._0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1e9)]],_0x569758=[..._0x48c1c8[_0x3d2311(0x1ef)]['prod_Qty']],_0x4b4e14=[..._0x48c1c8[_0x3d2311(0x1ef)]['prod_primunit']],_0x4f49c7=[..._0x48c1c8['body'][_0x3d2311(0x14a)]],_0x35f387=[..._0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x20e)]],_0x3dc1d4=[..._0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1a8)]],_0xb4c7a4=[..._0x48c1c8[_0x3d2311(0x1ef)]['secondary_code']],_0x29431d=[..._0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x213)]],_0x2202f9=[..._0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x16d)]],_0x29d6fe=[..._0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1e1)]],_0x13018c=[..._0x48c1c8['body'][_0x3d2311(0x206)]],_0x5c12aa=[..._0x48c1c8['body'][_0x3d2311(0x1ce)]],_0x32b475=[..._0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1fa)]],_0xfac0da=[..._0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1ea)]],_0x2f039e=[..._0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1b9)]];const _0x203545=_0x4c7b18[_0x3d2311(0x200)](_0x326551=>{return _0x326551={'product_name':_0x326551};});_0x34dae3[_0x3d2311(0x173)]((_0x175ef1,_0x4dbbae)=>{var _0x469ff6=_0x3d2311;_0x203545[_0x4dbbae][_0x469ff6(0x1cf)]=_0x175ef1;}),_0x569758[_0x3d2311(0x173)]((_0x368da8,_0x3cc4dd)=>{var _0x27b7bb=_0x3d2311;_0x203545[_0x3cc4dd]['quantity']=Math[_0x27b7bb(0x1da)](_0x368da8);}),_0x4b4e14['forEach']((_0x93f74,_0x1d786d)=>{_0x203545[_0x1d786d]['standard_unit']=_0x93f74;}),_0x4f49c7['forEach']((_0x3625a2,_0x109004)=>{var _0xa2c2a0=_0x3d2311;_0x203545[_0x109004][_0xa2c2a0(0x13c)]=_0x3625a2;}),_0x35f387[_0x3d2311(0x173)]((_0x5247e8,_0x24ff29)=>{var _0x345181=_0x3d2311;_0x203545[_0x24ff29][_0x345181(0x124)]=_0x5247e8;}),_0x3dc1d4['forEach']((_0x36133e,_0x1f834d)=>{_0x203545[_0x1f834d]['primary_code']=_0x36133e;}),_0xb4c7a4[_0x3d2311(0x173)]((_0x204a0e,_0x384948)=>{var _0x1a478c=_0x3d2311;_0x203545[_0x384948][_0x1a478c(0x1ca)]=_0x204a0e;}),_0x29431d[_0x3d2311(0x173)]((_0x5976c9,_0x267dbd)=>{_0x203545[_0x267dbd]['maxStocks']=_0x5976c9;}),_0x2202f9[_0x3d2311(0x173)]((_0x38f804,_0x4e0de0)=>{var _0x126157=_0x3d2311;_0x203545[_0x4e0de0][_0x126157(0x16d)]=_0x38f804;}),_0x29d6fe[_0x3d2311(0x173)]((_0x581841,_0x54c3a6)=>{var _0x3c2fcb=_0x3d2311;_0x203545[_0x54c3a6][_0x3c2fcb(0x1e1)]=_0x581841;}),_0x13018c[_0x3d2311(0x173)]((_0x575683,_0x1ce822)=>{var _0x1a25d3=_0x3d2311;_0x203545[_0x1ce822][_0x1a25d3(0x1df)]=_0x575683;}),_0x5c12aa[_0x3d2311(0x173)]((_0x5c7d49,_0x473061)=>{var _0x18ebe9=_0x3d2311;_0x203545[_0x473061][_0x18ebe9(0x218)]=_0x5c7d49;}),_0x32b475[_0x3d2311(0x173)]((_0x2899a0,_0x49dc76)=>{_0x203545[_0x49dc76]['product_cat']=_0x2899a0;}),_0xfac0da[_0x3d2311(0x173)]((_0x386ccc,_0x505d1e)=>{_0x203545[_0x505d1e]['room_name']=_0x386ccc;}),_0x2f039e[_0x3d2311(0x173)]((_0x393b72,_0x232818)=>{var _0x3b9cc1=_0x3d2311;_0x203545[_0x232818][_0x3b9cc1(0x176)]=_0x393b72;});const _0x5bdf0d=_0x203545[_0x3d2311(0x1eb)](_0x55aee9=>_0x55aee9[_0x3d2311(0x12b)]!=='0'&&_0x55aee9[_0x3d2311(0x12b)]!==''),_0x5e56d8=new purchases_finished({'invoice':_0xf09b5c,'suppliers':_0x48c1c8[_0x3d2311(0x1ef)][_0x3d2311(0x1f3)],'date':_0x4d2c23,'warehouse_name':_0x31e07e,'product':_0x5bdf0d,'note':_0x536465,'due_amount':_0x18d5e9,'room':_0x1ac8db,'POnumber':_0x499f9b,'SCRN':_0x2803c3,'JO_number':_0xf99420}),_0x67d809=await _0x5e56d8[_0x3d2311(0x1e7)](),_0x1c809f=await purchases_finished[_0x3d2311(0x1fd)]({'invoice':_0xf09b5c}),_0x44e2a6=_0x1c809f[_0x3d2311(0x11d)][_0x3d2311(0x200)](async _0x6472ad=>{var _0x97ccd3=_0x3d2311,_0x148ed6=await warehouse['findOne']({'name':_0x31e07e,'room':_0x6472ad['room_name']}),_0x3dbce7=0x0;const _0x1a3f3c=_0x148ed6['product_details'][_0x97ccd3(0x200)](_0x133188=>{var _0x441363=_0x97ccd3;console[_0x441363(0x18a)](_0x133188[_0x441363(0x13a)]+'=='+_0x6472ad[_0x441363(0x13a)]+'&&'+_0x133188[_0x441363(0x124)]+'=='+_0x6472ad['bay']+'&&'+_0x133188[_0x441363(0x1e1)]+'=='+_0x6472ad[_0x441363(0x1e1)]+'&&'+_0x133188[_0x441363(0x1df)]+'=='+_0x6472ad['production_date']+'&&'+_0x133188[_0x441363(0x16d)]+'=='+_0x6472ad[_0x441363(0x16d)]+'&&'+_0x133188['invoice']+'=='+_0x1c809f[_0x441363(0x176)]),_0x133188[_0x441363(0x13a)]==_0x6472ad['product_name']&&_0x133188[_0x441363(0x124)]==_0x6472ad[_0x441363(0x124)]&&_0x133188[_0x441363(0x1e1)]==_0x6472ad[_0x441363(0x1e1)]&&_0x133188['production_date']==_0x6472ad[_0x441363(0x1df)]&&_0x133188[_0x441363(0x16d)]==_0x6472ad[_0x441363(0x16d)]&&_0x133188[_0x441363(0x176)]==_0x1c809f[_0x441363(0x176)]&&(_0x133188[_0x441363(0x155)]=Math[_0x441363(0x1da)](_0x133188[_0x441363(0x155)])+Math[_0x441363(0x1da)](_0x6472ad[_0x441363(0x12b)]),_0x3dbce7++);});return _0x3dbce7=='0'&&(_0x148ed6[_0x97ccd3(0x1af)]=_0x148ed6['product_details']['concat']({'product_name':_0x6472ad[_0x97ccd3(0x13a)],'product_stock':Math[_0x97ccd3(0x1da)](_0x6472ad[_0x97ccd3(0x12b)]),'primary_code':_0x6472ad[_0x97ccd3(0x1a8)],'secondary_code':_0x6472ad[_0x97ccd3(0x1ca)],'product_code':_0x6472ad['product_code'],'bay':_0x6472ad['bay'],'maxProducts':_0x6472ad[_0x97ccd3(0x197)],'unit':_0x6472ad['standard_unit'],'secondary_unit':_0x6472ad[_0x97ccd3(0x13c)],'expiry_date':_0x6472ad[_0x97ccd3(0x1e1)],'production_date':_0x6472ad['production_date'],'maxProducts':_0x6472ad[_0x97ccd3(0x197)],'maxPerUnit':_0x6472ad[_0x97ccd3(0x218)],'batch_code':_0x6472ad['batch_code'],'product_cat':_0x6472ad[_0x97ccd3(0x11c)],'invoice':_0x6472ad[_0x97ccd3(0x176)]})),_0x148ed6;});Promise[_0x3d2311(0x177)](_0x44e2a6)[_0x3d2311(0x1a1)](async _0x35f562=>{var _0x37bf79=_0x3d2311;try{for(const _0x494e88 of _0x35f562){await warehouse[_0x37bf79(0x13d)]({'_id':_0x494e88[_0x37bf79(0x159)]},{'$addToSet':{'product_details':{'$each':_0x494e88[_0x37bf79(0x1af)]}}});}const _0x959a4c=await master_shop[_0x37bf79(0x1c7)](),_0xe4e3b=await email_settings[_0x37bf79(0x1fd)](),_0x361bab=await supervisor_settings[_0x37bf79(0x1c7)]();var _0x52beb7=_0x1c809f['product'],_0x493868='',_0x2b2fbf;for(_0x2b2fbf in _0x52beb7){var _0x4ca2d4='FG';_0x1c809f[_0x37bf79(0x13e)]==_0x37bf79(0x1c9)&&(_0x4ca2d4='DG'),_0x493868+=_0x37bf79(0x1c5)+_0x37bf79(0x1e2)+_0x52beb7[_0x2b2fbf][_0x37bf79(0x13a)]+_0x37bf79(0x127)+_0x37bf79(0x1e2)+_0x52beb7[_0x2b2fbf][_0x37bf79(0x1cf)]+_0x37bf79(0x127)+_0x37bf79(0x1e2)+_0x52beb7[_0x2b2fbf]['quantity']+_0x37bf79(0x127)+_0x37bf79(0x1e2)+_0x52beb7[_0x2b2fbf][_0x37bf79(0x17d)]+_0x37bf79(0x127)+_0x37bf79(0x1e2)+_0x52beb7[_0x2b2fbf][_0x37bf79(0x13c)]+_0x37bf79(0x127)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1c809f[_0x37bf79(0x13e)]+_0x37bf79(0x127)+_0x37bf79(0x1e2)+_0x52beb7[_0x2b2fbf][_0x37bf79(0x201)]+_0x37bf79(0x127)+_0x37bf79(0x1e2)+_0x4ca2d4+_0x52beb7[_0x2b2fbf]['bay']+_0x37bf79(0x127),_0x37bf79(0x16c);}let _0x5ba371=nodemailer[_0x37bf79(0x1b1)]({'host':_0xe4e3b[_0x37bf79(0x143)],'port':Number(_0xe4e3b[_0x37bf79(0x1f7)]),'secure':![],'auth':{'user':_0xe4e3b[_0x37bf79(0x1c3)],'pass':_0xe4e3b['password']}}),_0x14ad11={'from':_0xe4e3b[_0x37bf79(0x1c3)],'to':_0x361bab[0x0][_0x37bf79(0x212)],'subject':_0x37bf79(0x1e4),'attachments':[{'filename':_0x37bf79(0x1ac),'path':__dirname+'/../public'+_0x37bf79(0x11f)+_0x959a4c[0x0][_0x37bf79(0x19a)],'cid':_0x37bf79(0x165)}],'html':'<!DOCTYPE\x20html>'+_0x37bf79(0x1b0)+_0x37bf79(0x1d5)+_0x37bf79(0x1a9)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x37bf79(0x1a9)+_0x37bf79(0x15f)+_0x37bf79(0x190)+_0x37bf79(0x1a9)+_0x37bf79(0x1ff)+_0x959a4c[0x0][_0x37bf79(0x1f8)]+_0x37bf79(0x18b)+_0x37bf79(0x190)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x37bf79(0x1a9)+_0x37bf79(0x1ae)+_0x37bf79(0x219)+_0x1c809f[_0x37bf79(0x176)]+'\x20'+_0x37bf79(0x19d)+_0x37bf79(0x15c)+_0x1c809f['date']+'\x20'+'</span>'+'</h5>'+_0x37bf79(0x190)+_0x37bf79(0x1db)+_0x37bf79(0x147)+_0x37bf79(0x1c5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x37bf79(0x122)+_0x37bf79(0x132)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x37bf79(0x1b5)+_0x37bf79(0x15e)+_0x37bf79(0x140)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x37bf79(0x12a)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x493868+'\x20'+_0x37bf79(0x1d6)+_0x37bf79(0x126)+'<div>'+_0x37bf79(0x1b7)+_0x37bf79(0x186)+_0x959a4c[0x0][_0x37bf79(0x1f8)]+_0x37bf79(0x18e)+'</div>'+_0x37bf79(0x190)+_0x37bf79(0x199)};_0x5ba371[_0x37bf79(0x20d)](_0x14ad11,function(_0xe75289,_0x5375c5){var _0x5754ec=_0x37bf79;_0xe75289?(console[_0x5754ec(0x18a)](_0xe75289),console[_0x5754ec(0x18a)]('Error\x20Occurs')):console[_0x5754ec(0x18a)](_0x5754ec(0x1de));});}catch(_0x5e7599){console[_0x37bf79(0x123)](_0x5e7599),_0x52aa63[_0x37bf79(0x14e)](0x1f4)[_0x37bf79(0x1cb)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x5e7599[_0x37bf79(0x1f5)]});}})[_0x3d2311(0x19e)](_0x10faef=>{var _0x2345e8=_0x3d2311;console['error'](_0x10faef),_0x52aa63[_0x2345e8(0x14e)](0x1f4)[_0x2345e8(0x1cb)]({'error':_0x2345e8(0x19c)});}),_0x48c1c8[_0x3d2311(0x178)](_0x3d2311(0x142),_0x3d2311(0x1a3)),_0x52aa63[_0x3d2311(0x16e)](_0x3d2311(0x1ed));}catch(_0x4aa11d){console[_0x3d2311(0x18a)](_0x4aa11d);}}),router[a0_0x34d2cf(0x171)](a0_0x34d2cf(0x15d),auth,async(_0x33abe2,_0x4dd1a9)=>{var _0x132d17=a0_0x34d2cf;try{const {username:_0x571dbe,email:_0x13e908,role:_0xcf0260}=_0x33abe2[_0x132d17(0x13f)],_0x264be3=_0x33abe2[_0x132d17(0x13f)],_0xb7b040=await profile[_0x132d17(0x1fd)]({'email':_0x264be3[_0x132d17(0x1c3)]}),_0x322a13=await master_shop[_0x132d17(0x1c7)](),_0x7b92e0=_0x33abe2[_0x132d17(0x1bd)]['id'],_0x513fbd=await purchases_finished[_0x132d17(0x11e)](_0x7b92e0),_0x47ac4d=await suppliers[_0x132d17(0x1c7)]({});let _0x38afe0;if(_0x264be3[_0x132d17(0x153)]==_0x132d17(0x1b4)){const _0xb96c35=await staff[_0x132d17(0x1fd)]({'email':_0x264be3[_0x132d17(0x1c3)]});_0x38afe0=await warehouse[_0x132d17(0x1c7)]({'status':'Enabled','name':_0xb96c35['warehouse'],'warehouse_category':_0x132d17(0x195)});}else _0x38afe0=await warehouse[_0x132d17(0x1cc)]([{'$match':{'status':_0x132d17(0x131),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x132d17(0x160),'name':{'$first':_0x132d17(0x160)}}}]);const _0x4a02ef=await product[_0x132d17(0x1c7)]({}),_0x4acfca=BayBinSelected(_0x513fbd[_0x132d17(0x13e)],_0x513fbd['room']);let _0x50675d=new Date(_0x513fbd[_0x132d17(0x1e1)]),_0x455549=('0'+_0x50675d[_0x132d17(0x1a2)]())[_0x132d17(0x1a4)](-0x2),_0x402fe7=('0'+(_0x50675d[_0x132d17(0x151)]()+0x1))[_0x132d17(0x1a4)](-0x2),_0x3a4124=_0x50675d[_0x132d17(0x1e6)](),_0x2e0e00=_0x3a4124+'-'+_0x402fe7+'-'+_0x455549;if(_0x322a13[0x0][_0x132d17(0x161)]==_0x132d17(0x1c8)){var _0x149d6f=users[_0x132d17(0x1bc)];console[_0x132d17(0x18a)](_0x149d6f);}else{if(_0x322a13[0x0][_0x132d17(0x161)]==_0x132d17(0x217))var _0x149d6f=users[_0x132d17(0x217)];else{if(_0x322a13[0x0][_0x132d17(0x161)]==_0x132d17(0x141))var _0x149d6f=users[_0x132d17(0x141)];else{if(_0x322a13[0x0]['language']==_0x132d17(0x162))var _0x149d6f=users[_0x132d17(0x162)];else{if(_0x322a13[0x0]['language']==_0x132d17(0x1dc))var _0x149d6f=users[_0x132d17(0x1dc)];else{if(_0x322a13[0x0][_0x132d17(0x161)]==_0x132d17(0x1d2))var _0x149d6f=users[_0x132d17(0x120)];else{if(_0x322a13[0x0]['language']==_0x132d17(0x205))var _0x149d6f=users['Chinese'];else{if(_0x322a13[0x0][_0x132d17(0x161)]==_0x132d17(0x1e8))var _0x149d6f=users[_0x132d17(0x1a5)];}}}}}}}_0x4dd1a9[_0x132d17(0x16f)](_0x132d17(0x137),{'success':_0x33abe2['flash'](_0x132d17(0x142)),'errors':_0x33abe2[_0x132d17(0x178)](_0x132d17(0x18c)),'role':_0x264be3,'profile':_0xb7b040,'purchases':_0x513fbd,'suppliers':_0x47ac4d,'warehouse':_0x38afe0,'product':_0x4a02ef,'master_shop':_0x322a13,'language':_0x149d6f,'ed_fullDate':_0x2e0e00,'dataSelected':_0x4acfca});}catch(_0x65a28){console[_0x132d17(0x18a)](_0x65a28);}}),router[a0_0x34d2cf(0x171)](a0_0x34d2cf(0x12f),auth,async(_0x92f382,_0x39a0e7)=>{var _0x9a42fd=a0_0x34d2cf;try{const {username:_0x1016e8,email:_0xa61ded,role:_0x12bb3a}=_0x92f382[_0x9a42fd(0x13f)],_0x104303=_0x92f382[_0x9a42fd(0x13f)],_0x59ef0c=await profile[_0x9a42fd(0x1fd)]({'email':_0x104303[_0x9a42fd(0x1c3)]}),_0x3d93ac=await master_shop[_0x9a42fd(0x1c7)](),_0x27064a=_0x92f382[_0x9a42fd(0x1bd)]['id'],_0x14e69d=await purchases_finished['findById'](_0x27064a),_0x4f0e3d=await suppliers[_0x9a42fd(0x1c7)]({});let _0x347f8b;if(_0x104303[_0x9a42fd(0x153)]==_0x9a42fd(0x1b4)){const _0x4839a8=await staff[_0x9a42fd(0x1fd)]({'email':_0x104303[_0x9a42fd(0x1c3)]});_0x347f8b=await warehouse[_0x9a42fd(0x1c7)]({'status':'Enabled','name':_0x4839a8[_0x9a42fd(0x12e)],'warehouse_category':_0x9a42fd(0x195)});}else _0x347f8b=await warehouse['aggregate']([{'$match':{'status':_0x9a42fd(0x131),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x9a42fd(0x160)}}}]);const _0x3e2262=await product['find']({}),_0x480464=BayBinSelected(_0x14e69d[_0x9a42fd(0x13e)],_0x14e69d['room']);let _0x337eac=new Date(_0x14e69d[_0x9a42fd(0x1e1)]),_0x259d0a=('0'+_0x337eac['getDate']())[_0x9a42fd(0x1a4)](-0x2),_0x2656bc=('0'+(_0x337eac[_0x9a42fd(0x151)]()+0x1))[_0x9a42fd(0x1a4)](-0x2),_0x2fd0ac=_0x337eac[_0x9a42fd(0x1e6)](),_0x4d3430=_0x2fd0ac+'-'+_0x2656bc+'-'+_0x259d0a;if(_0x3d93ac[0x0][_0x9a42fd(0x161)]==_0x9a42fd(0x1c8)){var _0x432fc1=users['English'];console['log'](_0x432fc1);}else{if(_0x3d93ac[0x0][_0x9a42fd(0x161)]==_0x9a42fd(0x217))var _0x432fc1=users[_0x9a42fd(0x217)];else{if(_0x3d93ac[0x0][_0x9a42fd(0x161)]=='German')var _0x432fc1=users[_0x9a42fd(0x141)];else{if(_0x3d93ac[0x0][_0x9a42fd(0x161)]==_0x9a42fd(0x162))var _0x432fc1=users[_0x9a42fd(0x162)];else{if(_0x3d93ac[0x0][_0x9a42fd(0x161)]==_0x9a42fd(0x1dc))var _0x432fc1=users[_0x9a42fd(0x1dc)];else{if(_0x3d93ac[0x0]['language']=='Portuguese\x20(BR)')var _0x432fc1=users[_0x9a42fd(0x120)];else{if(_0x3d93ac[0x0][_0x9a42fd(0x161)]=='Chinese')var _0x432fc1=users[_0x9a42fd(0x205)];else{if(_0x3d93ac[0x0][_0x9a42fd(0x161)]==_0x9a42fd(0x1e8))var _0x432fc1=users['Arabic'];}}}}}}}_0x39a0e7[_0x9a42fd(0x16f)](_0x9a42fd(0x1c6),{'success':_0x92f382['flash'](_0x9a42fd(0x142)),'errors':_0x92f382[_0x9a42fd(0x178)](_0x9a42fd(0x18c)),'role':_0x104303,'profile':_0x59ef0c,'purchases':_0x14e69d,'suppliers':_0x4f0e3d,'warehouse':_0x347f8b,'product':_0x3e2262,'master_shop':_0x3d93ac,'language':_0x432fc1,'ed_fullDate':_0x4d3430,'dataSelected':_0x480464});}catch(_0x5d8e79){console[_0x9a42fd(0x18a)](_0x5d8e79);}}),router[a0_0x34d2cf(0x1a7)]('/view/:id',auth,async(_0x51bc96,_0x5f7c11)=>{var _0x7e4fb8=a0_0x34d2cf;try{const _0x157709=_0x51bc96[_0x7e4fb8(0x1bd)]['id'],_0x4875f6=await purchases_finished[_0x7e4fb8(0x1fd)]({'_id':_0x51bc96['params']['id']}),_0x98c1c=await warehouse[_0x7e4fb8(0x1fd)]({'name':_0x4875f6[_0x7e4fb8(0x13e)],'room':_0x4875f6[_0x7e4fb8(0x21a)]});_0x4875f6[_0x7e4fb8(0x11d)][_0x7e4fb8(0x173)](_0x4eb63b=>{var _0x548caf=_0x7e4fb8;const _0x40a2d0=_0x98c1c[_0x548caf(0x1af)][_0x548caf(0x200)](_0x4decd3=>{var _0x113e6c=_0x548caf;_0x4decd3[_0x113e6c(0x13a)]==_0x4eb63b['product_name']&&_0x4decd3['bay']==_0x4eb63b['bay']&&(_0x4decd3[_0x113e6c(0x155)]=parseInt(_0x4decd3[_0x113e6c(0x155)])-parseInt(_0x4eb63b[_0x113e6c(0x12b)]));});}),await _0x98c1c[_0x7e4fb8(0x1e7)]();const {invoice:_0x49a83a,suppliers:_0x5e728a,date:_0x40ce23,warehouse_name:_0x290085,prod_name:_0x1b75db,prod_code:_0x505223,prod_qty:_0x3127eb,prod_unit:_0x2053b3,prod_secondunit:_0xbf2983,prod_level:_0x1b7396,prod_isle:_0x348b99,prod_pallet:_0x4b2923,note:_0x2426fe,expiry_date:_0x1ad1ec,batch_code:_0x35d968,paid_amount:_0x2f4cff,due_amount:_0x27b9ff,Room_name:_0x496c8a,primary_code:_0x112cb5,secondary_code:_0x4120cb,PO_number:_0x312399,JO_number:_0x226db7}=_0x51bc96[_0x7e4fb8(0x1ef)];if(typeof _0x1b75db==_0x7e4fb8(0x119))var _0x3ee14e=[_0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x204)]],_0x3eaef4=[_0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x1e9)]],_0x5c9480=[_0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x156)]],_0xdb033=[_0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x209)]],_0x2a6a5c=[_0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x14a)]],_0x2a4a22=[_0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x20e)]],_0x6cfab4=[_0x51bc96[_0x7e4fb8(0x1ef)]['primary_code']],_0x1f946b=[_0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x1ca)]],_0x4b525f=[_0x51bc96['body'][_0x7e4fb8(0x213)]],_0x21e7aa=[_0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x16d)]],_0x30fb65=[_0x51bc96[_0x7e4fb8(0x1ef)]['expiry_date']];else var _0x3ee14e=[..._0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x204)]],_0x3eaef4=[..._0x51bc96['body'][_0x7e4fb8(0x1e9)]],_0x5c9480=[..._0x51bc96[_0x7e4fb8(0x1ef)]['prod_qty']],_0xdb033=[..._0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x209)]],_0x2a6a5c=[..._0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x14a)]],_0x2a4a22=[..._0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x20e)]],_0x6cfab4=[..._0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x1a8)]],_0x1f946b=[..._0x51bc96[_0x7e4fb8(0x1ef)]['secondary_code']],_0x4b525f=[..._0x51bc96[_0x7e4fb8(0x1ef)]['MaxStocks_data']],_0x21e7aa=[..._0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x16d)]],_0x30fb65=[..._0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x1e1)]];const _0x51b831=_0x3ee14e['map'](_0x4fb889=>{return _0x4fb889={'product_name':_0x4fb889};});_0x3eaef4[_0x7e4fb8(0x173)]((_0x2b1cc3,_0xba6aa4)=>{var _0x134510=_0x7e4fb8;_0x51b831[_0xba6aa4][_0x134510(0x1cf)]=_0x2b1cc3;}),_0x5c9480[_0x7e4fb8(0x173)]((_0x5ece64,_0x1d1340)=>{var _0x3c821d=_0x7e4fb8;_0x51b831[_0x1d1340][_0x3c821d(0x12b)]=_0x5ece64;}),_0xdb033[_0x7e4fb8(0x173)]((_0x5dabd7,_0x4a5c90)=>{var _0x1f7098=_0x7e4fb8;_0x51b831[_0x4a5c90][_0x1f7098(0x17d)]=_0x5dabd7;}),_0x2a6a5c[_0x7e4fb8(0x173)]((_0x237b5b,_0x40cd13)=>{var _0x275dba=_0x7e4fb8;_0x51b831[_0x40cd13][_0x275dba(0x13c)]=_0x237b5b;}),_0x2a4a22[_0x7e4fb8(0x173)]((_0x659a2e,_0x4dcce1)=>{_0x51b831[_0x4dcce1]['bay']=_0x659a2e;}),_0x6cfab4['forEach']((_0x2fbe4f,_0x354494)=>{var _0x3e89f1=_0x7e4fb8;_0x51b831[_0x354494][_0x3e89f1(0x1a8)]=_0x2fbe4f;}),_0x1f946b[_0x7e4fb8(0x173)]((_0x1dce87,_0x10c06a)=>{var _0x13f097=_0x7e4fb8;_0x51b831[_0x10c06a][_0x13f097(0x1ca)]=_0x1dce87;}),_0x4b525f['forEach']((_0x246e0e,_0x1ec28b)=>{var _0x5d2d83=_0x7e4fb8;_0x51b831[_0x1ec28b][_0x5d2d83(0x197)]=_0x246e0e;}),_0x21e7aa[_0x7e4fb8(0x173)]((_0x3b147f,_0x1b0280)=>{var _0x32fe64=_0x7e4fb8;_0x51b831[_0x1b0280][_0x32fe64(0x16d)]=_0x3b147f;}),_0x30fb65[_0x7e4fb8(0x173)]((_0x43ece9,_0x45db88)=>{_0x51b831[_0x45db88]['expiry_date']=_0x43ece9;});const _0x2ae5e7=_0x51b831[_0x7e4fb8(0x1eb)](_0x44f665=>_0x44f665[_0x7e4fb8(0x12b)]!=='0'&&_0x44f665['quantity']!=='');_0x4875f6['invoice']=_0x49a83a,_0x4875f6[_0x7e4fb8(0x1f3)]=_0x5e728a,_0x4875f6[_0x7e4fb8(0x20b)]=_0x40ce23,_0x4875f6['warehouse_name']=_0x290085,_0x4875f6[_0x7e4fb8(0x11d)]=_0x2ae5e7,_0x4875f6[_0x7e4fb8(0x20f)]=_0x2426fe,_0x4875f6['paid_amount']=_0x2f4cff,_0x4875f6['due_amount']=_0x27b9ff,_0x4875f6[_0x7e4fb8(0x21a)]=_0x496c8a,_0x4875f6[_0x7e4fb8(0x1c2)]=_0x312399,_0x4875f6['JO_number']=_0x226db7;const _0x3cfa4f=await _0x4875f6[_0x7e4fb8(0x1e7)](),_0x1a4542=await warehouse[_0x7e4fb8(0x1fd)]({'name':_0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x13e)],'room':_0x51bc96['body'][_0x7e4fb8(0x1f1)]});_0x4875f6[_0x7e4fb8(0x11d)][_0x7e4fb8(0x173)](_0x53e70b=>{var _0x5dc484=_0x7e4fb8,_0x48c978=0x0;const _0x21eb6d=_0x1a4542[_0x5dc484(0x1af)][_0x5dc484(0x200)](_0x24dcf1=>{var _0x393589=_0x5dc484;_0x24dcf1[_0x393589(0x13a)]==_0x53e70b[_0x393589(0x13a)]&&_0x24dcf1[_0x393589(0x124)]==_0x53e70b['bay']&&(_0x24dcf1['product_stock']=parseInt(_0x24dcf1[_0x393589(0x155)])+parseInt(_0x53e70b[_0x393589(0x12b)]),_0x48c978++);});_0x48c978=='0'&&(_0x1a4542['product_details']=_0x1a4542['product_details'][_0x5dc484(0x175)]({'product_name':_0x53e70b['product_name'],'product_stock':_0x53e70b[_0x5dc484(0x12b)],'primary_code':_0x53e70b[_0x5dc484(0x1a8)],'secondary_code':_0x53e70b[_0x5dc484(0x1ca)],'product_code':_0x53e70b[_0x5dc484(0x1cf)],'bay':_0x53e70b[_0x5dc484(0x124)],'maxProducts':_0x53e70b[_0x5dc484(0x197)],'unit':_0x53e70b[_0x5dc484(0x17d)],'secondary_unit':_0x53e70b[_0x5dc484(0x13c)],'expiry_date':_0x53e70b[_0x5dc484(0x1e1)]}));}),await _0x1a4542['save']();const _0x218477=await s_payment_data[_0x7e4fb8(0x1fd)]({'invoice':_0x51bc96[_0x7e4fb8(0x1ef)]['invoice']});if(_0x218477===null){}else console[_0x7e4fb8(0x18a)]('suppliers',_0x218477,_0x51bc96[_0x7e4fb8(0x1ef)][_0x7e4fb8(0x176)]),_0x218477['suppliers']=_0x51bc96['body'][_0x7e4fb8(0x1f3)],await _0x218477[_0x7e4fb8(0x1e7)]();_0x51bc96[_0x7e4fb8(0x178)](_0x7e4fb8(0x142),_0x7e4fb8(0x1fc)),_0x5f7c11['redirect']('/all_purchases_finished/view');}catch(_0x57f30b){console['log'](_0x57f30b);}}),router[a0_0x34d2cf(0x1a7)](a0_0x34d2cf(0x1d8),auth,async(_0x70b44,_0x1e977a)=>{var _0x2566f8=a0_0x34d2cf;try{const _0x376346=_0x70b44['params']['id'],{invoice:_0x5da4e0,suppliers:_0x53c8ed,payable:_0x11e6db,due_amount:_0x4a668d}=_0x70b44[_0x2566f8(0x1ef)],_0x5384e3=await purchases[_0x2566f8(0x11e)](_0x376346);var _0x1dbaf4=_0x11e6db-_0x4a668d;_0x5384e3[_0x2566f8(0x1fe)]=parseFloat(_0x5384e3[_0x2566f8(0x1fe)])+parseFloat(_0x4a668d),_0x5384e3['due_amount']=_0x1dbaf4;const _0x8c12df=await _0x5384e3[_0x2566f8(0x1e7)]();console[_0x2566f8(0x18a)](_0x8c12df);const _0x2b7fa5=await s_payment_data[_0x2566f8(0x1fd)]({'invoice':_0x5da4e0});_0x2b7fa5[_0x2566f8(0x19f)]=_0x1dbaf4,await _0x2b7fa5[_0x2566f8(0x1e7)]();let _0x499db8=new Date(),_0x2a7386=('0'+_0x499db8[_0x2566f8(0x1a2)]())[_0x2566f8(0x1a4)](-0x2),_0x40b28d=('0'+(_0x499db8[_0x2566f8(0x151)]()+0x1))[_0x2566f8(0x1a4)](-0x2),_0x45b93a=_0x499db8[_0x2566f8(0x1e6)](),_0x2d967c=_0x45b93a+'-'+_0x40b28d+'-'+_0x2a7386;const _0x5f43f7=new suppliers_payment({'invoice':_0x5da4e0,'date':_0x45b93a+'-'+_0x40b28d+'-'+_0x2a7386,'suppliers':_0x53c8ed,'reason':_0x2566f8(0x1f9),'amount':_0x4a668d}),_0x540412=await _0x5f43f7['save']();_0x70b44[_0x2566f8(0x178)](_0x2566f8(0x142),_0x2566f8(0x17f)),_0x1e977a[_0x2566f8(0x16e)](_0x2566f8(0x145));}catch(_0x55171c){console['log'](_0x55171c);}}),router[a0_0x34d2cf(0x171)](a0_0x34d2cf(0x1f2),auth,async(_0x5341f7,_0x40172a)=>{var _0x40bf83=a0_0x34d2cf;try{const {username:_0x181fba,email:_0x13e00a,role:_0x1ab51c}=_0x5341f7['user'],_0x543fa2=_0x5341f7[_0x40bf83(0x13f)],_0x22014d=await profile['findOne']({'email':_0x543fa2[_0x40bf83(0x1c3)]}),_0x3cc406=await master_shop[_0x40bf83(0x1c7)]();console[_0x40bf83(0x18a)](_0x40bf83(0x1a0),_0x3cc406);const _0x2c93f7=_0x5341f7[_0x40bf83(0x1bd)]['id'],_0x565f58=await purchases[_0x40bf83(0x11e)](_0x2c93f7);console[_0x40bf83(0x18a)](_0x565f58);const _0x45d89d=await suppliers[_0x40bf83(0x1fd)]({'name':_0x565f58[_0x40bf83(0x1f3)]});console[_0x40bf83(0x18a)](_0x45d89d);if(_0x3cc406[0x0][_0x40bf83(0x161)]==_0x40bf83(0x1c8)){var _0x22dc54=users[_0x40bf83(0x1bc)];console[_0x40bf83(0x18a)](_0x22dc54);}else{if(_0x3cc406[0x0][_0x40bf83(0x161)]==_0x40bf83(0x217))var _0x22dc54=users[_0x40bf83(0x217)];else{if(_0x3cc406[0x0]['language']=='German')var _0x22dc54=users[_0x40bf83(0x141)];else{if(_0x3cc406[0x0][_0x40bf83(0x161)]=='Spanish')var _0x22dc54=users[_0x40bf83(0x162)];else{if(_0x3cc406[0x0][_0x40bf83(0x161)]=='French')var _0x22dc54=users['French'];else{if(_0x3cc406[0x0][_0x40bf83(0x161)]==_0x40bf83(0x1d2))var _0x22dc54=users[_0x40bf83(0x120)];else{if(_0x3cc406[0x0][_0x40bf83(0x161)]==_0x40bf83(0x205))var _0x22dc54=users[_0x40bf83(0x205)];else{if(_0x3cc406[0x0][_0x40bf83(0x161)]=='Arabic\x20(ae)')var _0x22dc54=users[_0x40bf83(0x1a5)];}}}}}}}_0x40172a[_0x40bf83(0x16f)](_0x40bf83(0x164),{'success':_0x5341f7[_0x40bf83(0x178)](_0x40bf83(0x142)),'errors':_0x5341f7[_0x40bf83(0x178)](_0x40bf83(0x18c)),'role':_0x543fa2,'profile':_0x22014d,'master_shop':_0x3cc406,'supplier':_0x45d89d,'purchase':_0x565f58,'language':_0x22dc54});}catch(_0x361d0f){console[_0x40bf83(0x18a)](_0x361d0f);}}),router[a0_0x34d2cf(0x171)](a0_0x34d2cf(0x11b),auth,async(_0x5637f5,_0x38a55c)=>{var _0x306173=a0_0x34d2cf;try{const {username:_0x1c940f,email:_0x4899a5,role:_0x352519}=_0x5637f5['user'],_0x17b245=_0x5637f5['user'],_0x4a5336=await profile[_0x306173(0x1fd)]({'email':_0x17b245[_0x306173(0x1c3)]}),_0x394eb2=await master_shop[_0x306173(0x1c7)]();console['log'](_0x306173(0x1a0),_0x394eb2);const _0x37c43d=_0x5637f5[_0x306173(0x1bd)]['id'];console[_0x306173(0x18a)](_0x37c43d);const _0x1ec6dc=await purchases_finished[_0x306173(0x11e)](_0x37c43d);console[_0x306173(0x18a)](_0x306173(0x182),_0x1ec6dc);const _0x435bd6=await product[_0x306173(0x1c7)]({}),_0x34f90a=await warehouse['aggregate']([{'$match':{'name':_0x1ec6dc['warehouse_name'],'room':_0x1ec6dc[_0x306173(0x21a)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x306173(0x144)},'bin':{'$first':_0x306173(0x179)},'type':{'$first':_0x306173(0x138)},'floorlevel':{'$first':_0x306173(0x1cd)},'primary_code':{'$first':_0x306173(0x166)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x306173(0x19b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);console[_0x306173(0x18a)](_0x306173(0x183),_0x34f90a);let _0x217786;if(_0x17b245[_0x306173(0x153)]==_0x306173(0x1b4)){const _0x423500=await staff[_0x306173(0x1fd)]({'email':_0x17b245[_0x306173(0x1c3)]});_0x217786=await warehouse[_0x306173(0x1c7)]({'status':_0x306173(0x131),'name':_0x423500[_0x306173(0x12e)],'warehouse_category':_0x306173(0x195),'name':_0x306173(0x1b2)});}else _0x217786=await warehouse[_0x306173(0x1cc)]([{'$match':{'status':_0x306173(0x131),'warehouse_category':'Finished\x20Goods','name':_0x306173(0x1b2)}},{'$group':{'_id':_0x306173(0x160),'name':{'$first':_0x306173(0x160)}}}]);if(_0x394eb2[0x0][_0x306173(0x161)]==_0x306173(0x1c8)){var _0x39b412=users['English'];console['log'](_0x39b412);}else{if(_0x394eb2[0x0]['language']==_0x306173(0x217))var _0x39b412=users[_0x306173(0x217)];else{if(_0x394eb2[0x0][_0x306173(0x161)]==_0x306173(0x141))var _0x39b412=users[_0x306173(0x141)];else{if(_0x394eb2[0x0][_0x306173(0x161)]=='Spanish')var _0x39b412=users[_0x306173(0x162)];else{if(_0x394eb2[0x0][_0x306173(0x161)]==_0x306173(0x1dc))var _0x39b412=users[_0x306173(0x1dc)];else{if(_0x394eb2[0x0][_0x306173(0x161)]=='Portuguese\x20(BR)')var _0x39b412=users['Portuguese'];else{if(_0x394eb2[0x0][_0x306173(0x161)]=='Chinese')var _0x39b412=users[_0x306173(0x205)];else{if(_0x394eb2[0x0][_0x306173(0x161)]==_0x306173(0x1e8))var _0x39b412=users[_0x306173(0x1a5)];}}}}}}}_0x38a55c[_0x306173(0x16f)](_0x306173(0x1a6),{'success':_0x5637f5['flash']('success'),'errors':_0x5637f5[_0x306173(0x178)](_0x306173(0x18c)),'role':_0x17b245,'profile':_0x4a5336,'user':_0x1ec6dc,'stock':_0x34f90a,'master_shop':_0x394eb2,'product':_0x435bd6,'language':_0x39b412,'warehouse':_0x217786});}catch(_0x1f9a11){console[_0x306173(0x18a)](_0x1f9a11);}}),router[a0_0x34d2cf(0x1a7)](a0_0x34d2cf(0x11b),auth,async(_0x4d242f,_0x376b34)=>{var _0xc2ec6c=a0_0x34d2cf;try{const {invoice:_0x4f4e20,date:_0x25f83a,warehouse_name:_0x1457da,Room_name:_0x54cb46,product_name:_0x11ae85,purchase_quantity:_0x5a71fe,stocks:_0x3b3473,return_qty:_0x257cd3,note:_0x5e480f,level:_0x1a5572,isle:_0x5abf95,pallet:_0x4ebc7d,to_warehouse_name:_0x4306f6,to_Room_name:_0x34622c}=_0x4d242f[_0xc2ec6c(0x1ef)],_0x52a21f=await purchases_finished[_0xc2ec6c(0x1fd)]({'_id':_0x4d242f[_0xc2ec6c(0x1bd)]['id']}),_0x176ced=await warehouse[_0xc2ec6c(0x1fd)]({'name':_0x1457da,'room':_0x54cb46,'warehouse_category':_0xc2ec6c(0x195)});if(typeof _0x11ae85=='string')var _0xa8ef00=[_0x4d242f['body'][_0xc2ec6c(0x13a)]],_0x54fc96=[_0x4d242f['body'][_0xc2ec6c(0x196)]],_0x4aa5af=[_0x4d242f[_0xc2ec6c(0x1ef)]['stocks']],_0x5b7987=[_0x4d242f['body'][_0xc2ec6c(0x185)]],_0x274e90=[_0x4d242f[_0xc2ec6c(0x1ef)]['level']],_0x1aba02=[_0x4d242f[_0xc2ec6c(0x1ef)][_0xc2ec6c(0x198)]],_0x4db08e=[_0x4d242f[_0xc2ec6c(0x1ef)][_0xc2ec6c(0x194)]],_0x3511f9=[_0x4d242f['body']['secondary_code_hide']];else var _0xa8ef00=[..._0x4d242f[_0xc2ec6c(0x1ef)][_0xc2ec6c(0x13a)]],_0x54fc96=[..._0x4d242f[_0xc2ec6c(0x1ef)]['purchase_quantity']],_0x4aa5af=[..._0x4d242f[_0xc2ec6c(0x1ef)][_0xc2ec6c(0x192)]],_0x5b7987=[..._0x4d242f[_0xc2ec6c(0x1ef)][_0xc2ec6c(0x185)]],_0x274e90=[..._0x4d242f['body'][_0xc2ec6c(0x135)]],_0x1aba02=[..._0x4d242f[_0xc2ec6c(0x1ef)][_0xc2ec6c(0x198)]],_0x4db08e=[..._0x4d242f[_0xc2ec6c(0x1ef)][_0xc2ec6c(0x194)]],_0x3511f9=[..._0x4d242f['body'][_0xc2ec6c(0x12c)]];const _0x1645a3=_0xa8ef00[_0xc2ec6c(0x200)](_0x3cad54=>{return _0x3cad54={'product_name':_0x3cad54};});_0x54fc96[_0xc2ec6c(0x173)]((_0x31f14a,_0xf1ed74)=>{_0x1645a3[_0xf1ed74]['purchase_quantity']=_0x31f14a;}),_0x4aa5af[_0xc2ec6c(0x173)]((_0x2cc1d1,_0x13bb37)=>{var _0x72f9fb=_0xc2ec6c;_0x1645a3[_0x13bb37][_0x72f9fb(0x1fb)]=_0x2cc1d1;}),_0x5b7987[_0xc2ec6c(0x173)]((_0x2b16f7,_0x2fa228)=>{var _0x24abab=_0xc2ec6c;_0x1645a3[_0x2fa228][_0x24abab(0x185)]=_0x2b16f7;}),_0x274e90['forEach']((_0x15bf94,_0x497833)=>{var _0xc5e383=_0xc2ec6c;_0x1645a3[_0x497833][_0xc5e383(0x124)]=_0x15bf94;}),_0x1aba02[_0xc2ec6c(0x173)]((_0x536604,_0x414748)=>{var _0x379cb0=_0xc2ec6c;_0x1645a3[_0x414748][_0x379cb0(0x1cf)]=_0x536604;}),_0x4db08e[_0xc2ec6c(0x173)]((_0x199214,_0x1ee523)=>{var _0x251a37=_0xc2ec6c;_0x1645a3[_0x1ee523][_0x251a37(0x1a8)]=_0x199214;}),_0x3511f9[_0xc2ec6c(0x173)]((_0x55490e,_0x5ea3bc)=>{var _0xe56c55=_0xc2ec6c;_0x1645a3[_0x5ea3bc][_0xe56c55(0x1ca)]=_0x55490e;}),_0x1645a3[_0xc2ec6c(0x173)](_0x4b46ac=>{var _0x10e874=_0xc2ec6c;console[_0x10e874(0x18a)](_0x4b46ac);const _0x5bbae0=_0x176ced[_0x10e874(0x1af)][_0x10e874(0x200)](_0x4c35d9=>{var _0x2743b9=_0x10e874;_0x4c35d9['product_name']==_0x4b46ac[_0x2743b9(0x13a)]&&_0x4c35d9['bay']==_0x4b46ac[_0x2743b9(0x124)]&&(console['log'](parseInt(_0x4c35d9['product_stock'])+_0x2743b9(0x180)+parseInt(_0x4b46ac[_0x2743b9(0x185)])),_0x4c35d9[_0x2743b9(0x155)]=parseInt(_0x4c35d9[_0x2743b9(0x155)])-parseInt(_0x4b46ac['return_qty']));});}),await _0x176ced[_0xc2ec6c(0x1e7)]();var _0x96eeb2=0x0;_0x1645a3[_0xc2ec6c(0x173)](_0x46ac31=>{var _0x2972b5=_0xc2ec6c;(parseInt(_0x46ac31[_0x2972b5(0x196)])<parseInt(_0x46ac31['return_qty'])||parseInt(_0x46ac31[_0x2972b5(0x1fb)])<parseInt(_0x46ac31[_0x2972b5(0x185)]))&&_0x96eeb2++;});if(_0x96eeb2!=0x0)return _0x4d242f['flash']('errors',_0xc2ec6c(0x1ee)),_0x376b34[_0xc2ec6c(0x16e)](_0xc2ec6c(0x17c));const _0x24b2cf=new purchases_return_finished({'invoice':_0x4f4e20,'suppliers':_0x4d242f[_0xc2ec6c(0x1ef)]['suppliers'],'date':_0x25f83a,'warehouse_name':_0x1457da,'return_product':_0x1645a3,'note':_0x5e480f,'room':_0x54cb46,'to_warehouse_name':_0x4306f6,'to_room':_0x34622c}),_0x3d89ae=await _0x24b2cf['save'](),_0x3d1c9d=await purchases_return_finished[_0xc2ec6c(0x1fd)]({'invoice':_0x4f4e20}),_0x426e55=await warehouse[_0xc2ec6c(0x1fd)]({'name':_0x4306f6,'room':_0x34622c,'warehouse_category':'Finished\x20Goods'});_0x3d1c9d[_0xc2ec6c(0x14f)][_0xc2ec6c(0x173)](_0x2cb9d4=>{var _0x171075=_0xc2ec6c,_0x514bd6=0x0;const _0x108c84=_0x426e55[_0x171075(0x1af)][_0x171075(0x200)](_0x490523=>{var _0xe5cc74=_0x171075;console[_0xe5cc74(0x18a)](_0x490523[_0xe5cc74(0x13a)]+'=='+_0x2cb9d4[_0xe5cc74(0x13a)]+'&&'+_0x490523[_0xe5cc74(0x124)]+'=='+_0x2cb9d4[_0xe5cc74(0x124)]),_0x490523[_0xe5cc74(0x13a)]==_0x2cb9d4[_0xe5cc74(0x13a)]&&_0x490523['bay']==_0x2cb9d4[_0xe5cc74(0x124)]&&(_0x490523[_0xe5cc74(0x155)]=parseInt(_0x490523['product_stock'])-parseInt(_0x2cb9d4[_0xe5cc74(0x185)]),_0x514bd6++);});_0x514bd6=='0'&&(_0x426e55['product_details']=_0x426e55[_0x171075(0x1af)][_0x171075(0x175)]({'product_name':_0x2cb9d4['product_name'],'product_stock':_0x2cb9d4[_0x171075(0x185)],'primary_code':_0x2cb9d4[_0x171075(0x1a8)],'secondary_code':_0x2cb9d4[_0x171075(0x1ca)],'product_code':_0x2cb9d4[_0x171075(0x1cf)],'bay':_0x2cb9d4[_0x171075(0x124)],'maxProducts':0xf423f}));}),await _0x426e55['save']();const _0x2e2975=await purchases_finished['findOne']({'invoice':_0x4f4e20});_0x2e2975['return_data']=_0xc2ec6c(0x169);const _0x2f96a3=await _0x2e2975[_0xc2ec6c(0x1e7)](),_0x1df2d0=new s_payment_data({'invoice':_0x4f4e20,'suppliers':_0x4d242f[_0xc2ec6c(0x1ef)][_0xc2ec6c(0x1f3)],'reason':'Purchase\x20Return'});await _0x1df2d0['save']();const _0x426250=await master_shop[_0xc2ec6c(0x1c7)](),_0x516768=await email_settings['findOne'](),_0x5e9520=await suppliers[_0xc2ec6c(0x1fd)]({'name':_0x4d242f[_0xc2ec6c(0x1ef)][_0xc2ec6c(0x1f3)]});_0x426250[0x0][_0xc2ec6c(0x121)]==0x1?(right_currency=_0x426250[0x0][_0xc2ec6c(0x14d)],left_currency=''):(right_currency='',left_currency=_0x426250[0x0][_0xc2ec6c(0x14d)]);var _0x506017=_0xa8ef00,_0x557d89=_0x5b7987,_0x5b7bc8='',_0x45f31c;for(_0x45f31c in _0x506017){_0x5b7bc8+=_0xc2ec6c(0x1c5)+_0xc2ec6c(0x1e2)+_0x506017[_0x45f31c]+_0xc2ec6c(0x127)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x557d89[_0x45f31c]+'</td>'+_0xc2ec6c(0x16c);}let _0x24760a=nodemailer[_0xc2ec6c(0x1b1)]({'service':_0xc2ec6c(0x13b),'auth':{'user':_0x516768[_0xc2ec6c(0x1c3)],'pass':_0x516768['password']}}),_0x55aa22={'from':_0x516768[_0xc2ec6c(0x1c3)],'to':_0x5e9520['email'],'subject':_0xc2ec6c(0x1e0),'attachments':[{'filename':_0xc2ec6c(0x1ac),'path':__dirname+'/../public'+'/upload/'+_0x426250[0x0][_0xc2ec6c(0x19a)],'cid':'logo'}],'html':_0xc2ec6c(0x170)+_0xc2ec6c(0x1b0)+_0xc2ec6c(0x1d5)+_0xc2ec6c(0x1a9)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xc2ec6c(0x1a9)+_0xc2ec6c(0x15f)+_0xc2ec6c(0x190)+_0xc2ec6c(0x1a9)+'<h2>\x20'+_0x426250[0x0][_0xc2ec6c(0x1f8)]+_0xc2ec6c(0x18b)+_0xc2ec6c(0x190)+_0xc2ec6c(0x190)+_0xc2ec6c(0x17b)+_0xc2ec6c(0x1a9)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x4f4e20+'\x20'+_0xc2ec6c(0x19d)+_0xc2ec6c(0x15c)+_0x25f83a+'\x20'+_0xc2ec6c(0x210)+'</h5>'+_0xc2ec6c(0x190)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xc2ec6c(0x147)+_0xc2ec6c(0x1c5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xc2ec6c(0x1b8)+_0xc2ec6c(0x14b)+_0xc2ec6c(0x189)+'</tr>'+_0xc2ec6c(0x12a)+_0xc2ec6c(0x1d9)+'\x20'+_0x5b7bc8+'\x20'+'</tbody>'+'</table>'+_0xc2ec6c(0x1a9)+_0xc2ec6c(0x1b7)+_0xc2ec6c(0x186)+_0x426250[0x0][_0xc2ec6c(0x1f8)]+_0xc2ec6c(0x18e)+_0xc2ec6c(0x190)+_0xc2ec6c(0x190)+_0xc2ec6c(0x199)};_0x24760a[_0xc2ec6c(0x20d)](_0x55aa22,function(_0x24916e,_0x4e1ff2){var _0x4f5a5c=_0xc2ec6c;_0x24916e?console['log'](_0x4f5a5c(0x174)):console[_0x4f5a5c(0x18a)]('Email\x20sent\x20successfully');}),_0x4d242f['flash']('success',_0xc2ec6c(0x139)),_0x376b34[_0xc2ec6c(0x16e)](_0xc2ec6c(0x1ed));}catch(_0x48da02){_0x376b34[_0xc2ec6c(0x14e)](0xc8)['json']({'message':_0x48da02['message']});}}),router['get'](a0_0x34d2cf(0x17e),auth,async(_0x14a940,_0xc530c9)=>{var _0x1e219c=a0_0x34d2cf;try{const {username:_0x53bd6e,email:_0x5b47f9,role:_0x337c01}=_0x14a940[_0x1e219c(0x13f)],_0x49f387=_0x14a940['user'],_0x3aec24=await profile[_0x1e219c(0x1fd)]({'email':_0x49f387[_0x1e219c(0x1c3)]}),_0x185fde=await master_shop['find'](),_0x5d7f2c=_0x14a940[_0x1e219c(0x1bd)]['id'],_0x553d20=await purchases_finished['findById'](_0x5d7f2c);if(_0x185fde[0x0][_0x1e219c(0x161)]==_0x1e219c(0x1c8))var _0x2f4089=users['English'];else{if(_0x185fde[0x0]['language']==_0x1e219c(0x217))var _0x2f4089=users[_0x1e219c(0x217)];else{if(_0x185fde[0x0][_0x1e219c(0x161)]==_0x1e219c(0x141))var _0x2f4089=users[_0x1e219c(0x141)];else{if(_0x185fde[0x0]['language']==_0x1e219c(0x162))var _0x2f4089=users[_0x1e219c(0x162)];else{if(_0x185fde[0x0]['language']==_0x1e219c(0x1dc))var _0x2f4089=users[_0x1e219c(0x1dc)];else{if(_0x185fde[0x0][_0x1e219c(0x161)]=='Portuguese\x20(BR)')var _0x2f4089=users[_0x1e219c(0x120)];else{if(_0x185fde[0x0][_0x1e219c(0x161)]==_0x1e219c(0x205))var _0x2f4089=users[_0x1e219c(0x205)];else{if(_0x185fde[0x0]['language']==_0x1e219c(0x1e8))var _0x2f4089=users[_0x1e219c(0x1a5)];}}}}}}}_0xc530c9['render'](_0x1e219c(0x157),{'success':_0x14a940[_0x1e219c(0x178)]('success'),'errors':_0x14a940['flash'](_0x1e219c(0x18c)),'role':_0x49f387,'profile':_0x3aec24,'alldata':_0x553d20,'master_shop':_0x185fde,'language':_0x2f4089}),console['log'](alldata);}catch(_0xc7dde7){console[_0x1e219c(0x18a)](_0xc7dde7);}}),router['post'](a0_0x34d2cf(0x1ba),async(_0x506eca,_0x2c3a14)=>{var _0x59bf79=a0_0x34d2cf;const {product_code:_0x25e832}=_0x506eca[_0x59bf79(0x1ef)];var _0x1c7359;const _0x13d884=await product[_0x59bf79(0x1cc)]([{'$match':{'primary_code':_0x25e832,'product_category':_0x59bf79(0x195)}},{'$group':{'_id':_0x59bf79(0x208),'name':{'$first':_0x59bf79(0x160)},'category':{'$first':_0x59bf79(0x207)},'brand':{'$first':_0x59bf79(0x20a)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x59bf79(0x133)},'product_code':{'$first':_0x59bf79(0x1d3)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x59bf79(0x15a)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x59bf79(0x150)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x10200b=await product[_0x59bf79(0x1cc)]([{'$match':{'secondary_code':_0x25e832}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x59bf79(0x207)},'brand':{'$first':_0x59bf79(0x20a)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x59bf79(0x1d3)},'primary_code':{'$first':_0x59bf79(0x1d0)},'secondary_code':{'$first':_0x59bf79(0x1be)},'maxStocks':{'$first':_0x59bf79(0x136)},'maxProdPerUnit':{'$first':_0x59bf79(0x15a)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x13d884[_0x59bf79(0x193)]>0x0)_0x1c7359=_0x13d884;else _0x10200b['length']>0x0&&(_0x1c7359=_0x10200b);_0x2c3a14[_0x59bf79(0x1cb)](_0x1c7359);}),router[a0_0x34d2cf(0x1a7)](a0_0x34d2cf(0x128),async(_0x5ea022,_0x2b8af0)=>{var _0x1c23b9=a0_0x34d2cf;const {productCode:_0x38176d,bay:_0x2c15a9,warehouses:_0x5e5bc3,room:_0x2a102a}=_0x5ea022[_0x1c23b9(0x1ef)];console['log'](_0x5ea022[_0x1c23b9(0x1ef)]);try{const _0x3ad282=await warehouse[_0x1c23b9(0x1cc)]([{'$match':{'name':_0x5e5bc3,'room':_0x2a102a}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x2c15a9)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1c23b9(0x134)},'product_stock':{'$first':_0x1c23b9(0x158)},'bay':{'$first':_0x1c23b9(0x144)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x2b8af0[_0x1c23b9(0x14e)](0xc8)['json'](_0x3ad282);}catch(_0x449250){_0x2b8af0[_0x1c23b9(0x14e)](0x194)[_0x1c23b9(0x1cb)]({'message':_0x449250[_0x1c23b9(0x1f5)]});}}),module[a0_0x34d2cf(0x15b)]=router;