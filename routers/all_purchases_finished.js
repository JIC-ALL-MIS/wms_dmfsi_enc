var a0_0x551ff4=a0_0x4f3a;(function(_0x42ca12,_0x6d106a){var _0xf101dc=a0_0x4f3a,_0x45810f=_0x42ca12();while(!![]){try{var _0x377f9e=parseInt(_0xf101dc(0x103))/0x1*(-parseInt(_0xf101dc(0x137))/0x2)+parseInt(_0xf101dc(0xcd))/0x3+-parseInt(_0xf101dc(0x178))/0x4+-parseInt(_0xf101dc(0x92))/0x5+-parseInt(_0xf101dc(0x10c))/0x6+-parseInt(_0xf101dc(0x94))/0x7+parseInt(_0xf101dc(0x10e))/0x8;if(_0x377f9e===_0x6d106a)break;else _0x45810f['push'](_0x45810f['shift']());}catch(_0x178aca){_0x45810f['push'](_0x45810f['shift']());}}}(a0_0x5d04,0xb9d3f));function a0_0x4f3a(_0x2cc24d,_0x94433b){var _0x5d04f1=a0_0x5d04();return a0_0x4f3a=function(_0x4f3a44,_0x15de61){_0x4f3a44=_0x4f3a44-0x8d;var _0x307c11=_0x5d04f1[_0x4f3a44];return _0x307c11;},a0_0x4f3a(_0x2cc24d,_0x94433b);}const express=require('express'),app=express(),router=express[a0_0x551ff4(0xaf)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x551ff4(0x99)),nodemailer=require(a0_0x551ff4(0x142));var ejs=require(a0_0x551ff4(0x182));const path=require(a0_0x551ff4(0x116)),users=require(a0_0x551ff4(0xfa));router[a0_0x551ff4(0xe7)](a0_0x551ff4(0x13f),auth,async(_0x214c36,_0x54a023)=>{var _0x2738ab=a0_0x551ff4;try{const {username:_0x539676,email:_0x5b33af,role:_0x1b594a}=_0x214c36['user'],_0xe24a85=_0x214c36[_0x2738ab(0x16c)],_0x395bfb=await profile['findOne']({'email':_0xe24a85['email']}),_0x2ada1c=await staff[_0x2738ab(0x180)]({'email':_0xe24a85[_0x2738ab(0x171)]});if(_0xe24a85[_0x2738ab(0x10a)]==_0x2738ab(0xfc)){const _0x2e65b0=await staff[_0x2738ab(0x180)]({'email':_0xe24a85[_0x2738ab(0x171)]});}const _0x22be58=await master_shop[_0x2738ab(0xa3)]();let _0x2847c5;if(_0xe24a85['role']==_0x2738ab(0xfc)){const _0x1b6892=await staff[_0x2738ab(0x180)]({'email':_0xe24a85[_0x2738ab(0x171)]});_0x2847c5=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x1b6892[_0x2738ab(0xf5)]}},{'$lookup':{'from':_0x2738ab(0x151),'localField':'suppliers','foreignField':_0x2738ab(0x100),'as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x2738ab(0x11b)},{'$group':{'_id':_0x2738ab(0xc4),'invoice':{'$first':_0x2738ab(0xdc)},'suppliers':{'$first':_0x2738ab(0x11e)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2738ab(0xb5)},'room':{'$first':'$room'},'product':{'$push':_0x2738ab(0x11b)},'note':{'$first':_0x2738ab(0x190)},'paid_amount':{'$first':_0x2738ab(0xb2)},'due_amount':{'$first':_0x2738ab(0xbf)},'return_data':{'$first':_0x2738ab(0xb4)},'batch_code':{'$first':_0x2738ab(0x104)},'expiry_date':{'$first':_0x2738ab(0xe0)},'suppliers_docs':{'$first':_0x2738ab(0x8d)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x2738ab(0x154)},'type':{'$addToSet':_0x2738ab(0x157)},'floorlevel':{'$addToSet':_0x2738ab(0xe5)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2847c5=await purchases_finished[_0x2738ab(0x191)]([{'$unwind':_0x2738ab(0x11b)},{'$group':{'_id':_0x2738ab(0xc4),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x2738ab(0x11e)},'date':{'$first':_0x2738ab(0x17b)},'warehouse_name':{'$first':_0x2738ab(0xb5)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x2738ab(0x190)},'paid_amount':{'$first':_0x2738ab(0xb2)},'due_amount':{'$first':_0x2738ab(0xbf)},'return_data':{'$first':_0x2738ab(0xb4)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2738ab(0xe0)},'suppliers_docs':{'$first':_0x2738ab(0x8d)},'total_product_quantity':{'$sum':_0x2738ab(0x10b)},'level':{'$addToSet':_0x2738ab(0xc2)},'isle':{'$addToSet':_0x2738ab(0x154)},'type':{'$addToSet':_0x2738ab(0x157)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x22be58[0x0]['language']==_0x2738ab(0x176))var _0x27ed65=users[_0x2738ab(0x161)];else{if(_0x22be58[0x0][_0x2738ab(0xf3)]==_0x2738ab(0x114))var _0x27ed65=users['Hindi'];else{if(_0x22be58[0x0][_0x2738ab(0xf3)]==_0x2738ab(0x111))var _0x27ed65=users[_0x2738ab(0x111)];else{if(_0x22be58[0x0][_0x2738ab(0xf3)]==_0x2738ab(0x9e))var _0x27ed65=users['Spanish'];else{if(_0x22be58[0x0][_0x2738ab(0xf3)]==_0x2738ab(0x101))var _0x27ed65=users[_0x2738ab(0x101)];else{if(_0x22be58[0x0][_0x2738ab(0xf3)]==_0x2738ab(0x189))var _0x27ed65=users[_0x2738ab(0xec)];else{if(_0x22be58[0x0]['language']==_0x2738ab(0x160))var _0x27ed65=users['Chinese'];else{if(_0x22be58[0x0][_0x2738ab(0xf3)]=='Arabic\x20(ae)')var _0x27ed65=users['Arabic'];}}}}}}}_0x54a023[_0x2738ab(0x152)](_0x2738ab(0xef),{'success':_0x214c36[_0x2738ab(0x156)](_0x2738ab(0x165)),'errors':_0x214c36['flash'](_0x2738ab(0xed)),'purchases':_0x2847c5,'role':_0xe24a85,'profile':_0x395bfb,'master_shop':_0x22be58,'language':_0x27ed65});}catch(_0x44c080){console[_0x2738ab(0xe3)](_0x2738ab(0xab),_0x44c080),_0x54a023[_0x2738ab(0x163)](0xc8)[_0x2738ab(0x16a)]({'message':_0x44c080['message']});}});function BayBinSelected(_0x32067f,_0x52e2ae){var _0x45ddf5=a0_0x551ff4,_0x3f93ee=[],_0x488b9c=[];if(_0x32067f==_0x45ddf5(0xa1)){switch(_0x52e2ae){case _0x45ddf5(0x146):_0x3f93ee=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x45ddf5(0xc7):_0x3f93ee=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x488b9c=['DG'];}else{if(_0x32067f==_0x45ddf5(0x13d)){switch(_0x52e2ae){case _0x45ddf5(0x146):_0x3f93ee=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x45ddf5(0xc7):_0x3f93ee=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x488b9c=['FG'];}}return{'levels':_0x3f93ee,'identify':_0x488b9c};}function a0_0x5d04(){var _0x3264a3=['/give_payment/:id','all_purchases_barcode','\x20Order\x20Date\x20:\x20','name','French','product_date','46028RTVSbp','$batch_code','product','purchase_invoice','$product_details.bay','secondary_unit','$secondary_unit','role','$product.quantity','2506284TgZGFB','maxStocks','42586280EGzWfk','$product_details.product_name','/view/return_purchase/:id','German','</tbody>','prod_secondunit','Hindi','return_data','path','$product_details.secondary_code','primary_code_hide','$product_details.product_code','Finished\x20Goods','$product','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$suppliers','$maxProdPerUnit','return_purchase_finished','INCF-','Purchase\x20Return\x20Mail','prod_cat','/view/:id','$alertquantity','secondary_code_hide','Arabic\x20(ae)','save','QA\x20Warehouse','error','purchases\x20item\x20return\x20successfull','/invoice/:id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','floor','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','batch_code','return_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/../public','max_product_unit','note','60TBBMhu','prod_unit','getDate','$product_details.floorlevel','prod_level','$brand','FROZEN\x20GOODS','purchase\x20data\x20add\x20successfully','/view','quantity','$product_details.bin','nodemailer','$unit','length','then','Rack\x201','catch','Email\x20sent\x20successfully','MaxStocks_data','Error\x20occurred\x20while\x20processing\x20product:','$maxStocks','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','\x20Order\x20Number\x20:\x20','$secondary_code','</thead>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','suppliers','render','padStart','$product.bin','prod_code','flash','$product.type','invoice','redirect','toString','logo','body','room_name','$product_code','<h2>\x20','Chinese','English','port','status','product_name','success','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details','forEach','map','json','paid_amount','user','prod_invoice','amount','edit_purchases_finished_view','</head><body>','email','\x20<>\x20','</tr>','product_cat','/upload/','English\x20(US)','</h5>','5156704BgLeMC','prod_Qty','<!DOCTYPE\x20html>','$date','/preview/:id','maxperunit','master','product_code','findOne','<h5\x20style=\x22text-align:\x20left;\x22>','ejs','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</td>','<tr>','</span>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','password','Portuguese\x20(BR)','$product_details.product_stock','message','Arabic','Enabled','secondary_code','gmail','$note','aggregate','$suppliers_docs','user_id','<span\x20style=\x22float:\x20right;\x22>','RoomAssign','</table>','5518980roqBBa','post','3273683xsUZaI','string','$category','slice','<div>','../middleware/auth','all','<strong>\x20Regards\x20</strong>','<tbody\x20style=\x22text-align:\x20center;\x22>','date','Spanish','level','due_amount','DRY\x20GOODS','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','find','$product_details.rack','product_code_hide','payment\x20successfull','findById','stock_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','currency_placement','table\x20page','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','add_purchases\x20error','Router','add_purchases_finished','params','$paid_amount','random','$return_data','$warehouse_name','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','POnumber','createTransport','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','product_details','exports','/view/add_purchases','$due_amount','/all_purchases_finished/view','getMonth','$product.bay','warehouse_name','$_id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','updateOne','Rack\x202','getFullYear','room','$product_details.type','$product_details.storage','stock_data','291183RXhifz','back','$product_details.primary_code','_id','$product_details._id','primary_code','Paid\x20For\x20Purchase','<html><head><title></title>','standard_unit','\x20</h2>','product_stock','<hr\x20class=\x22my-3\x22>','stocks','prod_name','bay','$invoice','return_product','Ambient','purchase_quantity','$expiry_date','image','Purchase\x20Return','log','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product.floorlevel','Error\x20Occurs','get','site_title','JO_number','</body></html>','expiry_date','Portuguese','errors','</div>','all_purchases_finished','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','/barcode/:id','language','filter','warehouse','concat','abs','Enclosed','<h5>','../public/language/languages.json','production_date','staff'];a0_0x5d04=function(){return _0x3264a3;};return a0_0x5d04();}async function getRandom8DigitNumber(){var _0x52fbd4=a0_0x551ff4;const _0x53bcda=0x989680,_0x10c0d3=0x5f5e0ff,_0x134bda=Math[_0x52fbd4(0x12e)](Math[_0x52fbd4(0xb3)]()*(_0x10c0d3-_0x53bcda+0x1))+_0x53bcda;var _0x568cbc;const _0x4a7925=await purchases_finished[_0x52fbd4(0x180)]({'invoice':_0x52fbd4(0x121)+_0x134bda});return _0x4a7925&&_0x4a7925['length']>0x0?_0x568cbc='INCF-'+_0x134bda:_0x568cbc=_0x52fbd4(0x121)+_0x134bda,_0x568cbc;}router[a0_0x551ff4(0xe7)](a0_0x551ff4(0xbe),auth,async(_0x5edecc,_0x6800fc)=>{var _0x5e402f=a0_0x551ff4;try{const {username:_0x4763f5,email:_0x5deb9b,role:_0x222fa3}=_0x5edecc[_0x5e402f(0x16c)],_0x3407a3=_0x5edecc['user'],_0x1504e8=await profile['findOne']({'email':_0x3407a3[_0x5e402f(0x171)]}),_0x2b0251=await master_shop[_0x5e402f(0xa3)](),_0x269ac1=await staff[_0x5e402f(0x180)]({'email':_0x3407a3['email']}),_0xf72489=await suppliers['find']({});let _0x335c72;if(_0x3407a3[_0x5e402f(0x10a)]==_0x5e402f(0xfc)){const _0x45313d=await staff[_0x5e402f(0x180)]({'email':_0x3407a3[_0x5e402f(0x171)]});_0x335c72=await warehouse['aggregate']([{'$match':{'status':_0x5e402f(0x18d),'name':_0x45313d[_0x5e402f(0xf5)],'warehouse_category':_0x5e402f(0x11a)}},{'$group':{'_id':_0x5e402f(0xf0),'name':{'$first':_0x5e402f(0xf0)}}}]);}else _0x335c72=await warehouse[_0x5e402f(0x191)]([{'$match':{'status':_0x5e402f(0x18d),'warehouse_category':_0x5e402f(0x11a),'name':{'$ne':_0x5e402f(0x129)}}},{'$group':{'_id':_0x5e402f(0xf0),'name':{'$first':_0x5e402f(0xf0)}}}]);const _0xb77211=await product[_0x5e402f(0xa3)]({}),_0x5cc7a1=await warehouse[_0x5e402f(0xa3)]({'status':'Enabled'}),_0x3283d9=await purchases_finished[_0x5e402f(0xa3)]({}),_0x19aa11=_0x3283d9[_0x5e402f(0x144)]+0x1,_0x31255f=_0x5e402f(0x121)+_0x19aa11[_0x5e402f(0x15a)]()[_0x5e402f(0x153)](0x5,'0');var _0x4cf15a=[_0x5e402f(0xde),_0x5e402f(0xf8)];if(_0x2b0251[0x0][_0x5e402f(0xf3)]=='English\x20(US)')var _0x2990d2=users[_0x5e402f(0x161)];else{if(_0x2b0251[0x0]['language']==_0x5e402f(0x114))var _0x2990d2=users[_0x5e402f(0x114)];else{if(_0x2b0251[0x0][_0x5e402f(0xf3)]==_0x5e402f(0x111))var _0x2990d2=users['German'];else{if(_0x2b0251[0x0][_0x5e402f(0xf3)]==_0x5e402f(0x9e))var _0x2990d2=users[_0x5e402f(0x9e)];else{if(_0x2b0251[0x0][_0x5e402f(0xf3)]=='French')var _0x2990d2=users[_0x5e402f(0x101)];else{if(_0x2b0251[0x0]['language']==_0x5e402f(0x189))var _0x2990d2=users['Portuguese'];else{if(_0x2b0251[0x0]['language']==_0x5e402f(0x160))var _0x2990d2=users['Chinese'];else{if(_0x2b0251[0x0]['language']=='Arabic\x20(ae)')var _0x2990d2=users[_0x5e402f(0x18c)];}}}}}}}const _0xd72da9=getRandom8DigitNumber();_0xd72da9[_0x5e402f(0x145)](_0x3262de=>{var _0x597ec7=_0x5e402f;_0x6800fc[_0x597ec7(0x152)](_0x597ec7(0xb0),{'success':_0x5edecc[_0x597ec7(0x156)](_0x597ec7(0x165)),'errors':_0x5edecc[_0x597ec7(0x156)](_0x597ec7(0xed)),'role':_0x3407a3,'profile':_0x1504e8,'suppliers':_0xf72489,'warehouse':_0x335c72,'product':_0xb77211,'invoice':_0x3262de,'master_shop':_0x2b0251,'language':_0x2990d2,'find_data':_0x5cc7a1,'rooms_data':_0x4cf15a});})[_0x5e402f(0x147)](_0xc9194e=>{var _0x4d7328=_0x5e402f;_0x5edecc[_0x4d7328(0x156)](_0x4d7328(0xed),_0x4d7328(0xe4)),_0x6800fc[_0x4d7328(0x159)](_0x4d7328(0xc0));});}catch(_0x4dcdb1){console[_0x5e402f(0xe3)](_0x4dcdb1);}}),router['get']('/view/add_purchases/:id',auth,async(_0x26a274,_0x47bb83)=>{var _0x428a96=a0_0x551ff4;try{const _0x47d753=_0x26a274[_0x428a96(0xb1)]['id'];console[_0x428a96(0xe3)](_0x47d753);const _0x50eb03=await master_shop['find']();console['log'](_0x428a96(0x17e),_0x50eb03);const _0x1e6097=await product['findOne']({'name':_0x47d753});console[_0x428a96(0xe3)](_0x428a96(0x105),_0x1e6097),_0x47bb83[_0x428a96(0x163)](0xc8)['json']({'product_data':_0x1e6097,'master':_0x50eb03});}catch(_0x4d6461){console[_0x428a96(0xe3)](_0x428a96(0xae),_0x4d6461);}}),router[a0_0x551ff4(0x93)](a0_0x551ff4(0xbe),auth,async(_0x77d276,_0x190078)=>{var _0xebe92a=a0_0x551ff4;try{const {invoice:_0x37b2ef,date:_0x53ee99,warehouse_name:_0xb710a2,prod_name:_0x141772,prod_code:_0x2cb4dc,prod_qty:_0x4755aa,prod_unit:_0x514724,prod_secondunit:_0x485c8d,prod_level:_0x35ddaa,prod_isle:_0x314842,prod_pallet:_0x122a61,note:_0x17b281,expiry_date:_0x26cf16,batch_code:_0x485b73,payable:_0x38186a,due_amount:_0x116446,Room_name:_0xceba65,primary_code:_0x4e53b6,secondary_code:_0x1c6f4f,MaxStocks_data:_0x1bed3d,PO_number:_0x54c2ea,SCRN:_0x187bbf,JO_number:_0x46fe38}=_0x77d276[_0xebe92a(0x15c)];if(typeof _0x141772==_0xebe92a(0x95))var _0x3582b5=[_0x77d276[_0xebe92a(0x15c)][_0xebe92a(0xda)]],_0x36b4a8=[_0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x155)]],_0x21caae=[_0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x179)]],_0x2241c9=[_0x77d276[_0xebe92a(0x15c)]['prod_primunit']],_0x4ab38a=[_0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x113)]],_0x45e2f2=[_0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x13b)]],_0x42c7f0=[_0x77d276['body'][_0xebe92a(0xd2)]],_0x3481f1=[_0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x18e)]],_0x410651=[_0x77d276[_0xebe92a(0x15c)]['MaxStocks_data']],_0x52b504=[_0x77d276['body'][_0xebe92a(0x131)]],_0x4f98fb=[_0x77d276[_0xebe92a(0x15c)]['expiry_date']],_0x10bcd7=[_0x77d276[_0xebe92a(0x15c)]['product_date']],_0x17bbd7=[_0x77d276['body']['max_product_unit']],_0x19f0e3=[_0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x123)]],_0x11899b=[_0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x90)]],_0x5ad32d=[_0x77d276[_0xebe92a(0x15c)]['prod_invoice']];else var _0x3582b5=[..._0x77d276[_0xebe92a(0x15c)][_0xebe92a(0xda)]],_0x36b4a8=[..._0x77d276[_0xebe92a(0x15c)]['prod_code']],_0x21caae=[..._0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x179)]],_0x2241c9=[..._0x77d276[_0xebe92a(0x15c)]['prod_primunit']],_0x4ab38a=[..._0x77d276[_0xebe92a(0x15c)]['prod_secondunit']],_0x45e2f2=[..._0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x13b)]],_0x42c7f0=[..._0x77d276[_0xebe92a(0x15c)][_0xebe92a(0xd2)]],_0x3481f1=[..._0x77d276['body']['secondary_code']],_0x410651=[..._0x77d276[_0xebe92a(0x15c)]['MaxStocks_data']],_0x52b504=[..._0x77d276['body'][_0xebe92a(0x131)]],_0x4f98fb=[..._0x77d276[_0xebe92a(0x15c)][_0xebe92a(0xeb)]],_0x10bcd7=[..._0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x102)]],_0x17bbd7=[..._0x77d276['body'][_0xebe92a(0x135)]],_0x19f0e3=[..._0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x123)]],_0x11899b=[..._0x77d276[_0xebe92a(0x15c)]['RoomAssign']],_0x5ad32d=[..._0x77d276[_0xebe92a(0x15c)][_0xebe92a(0x16d)]];const _0x201261=_0x3582b5[_0xebe92a(0x169)](_0x5db970=>{return _0x5db970={'product_name':_0x5db970};});_0x36b4a8[_0xebe92a(0x168)]((_0x42c4f7,_0x27913e)=>{var _0xf637b=_0xebe92a;_0x201261[_0x27913e][_0xf637b(0x17f)]=_0x42c4f7;}),_0x21caae[_0xebe92a(0x168)]((_0x1f1978,_0x1dfe3f)=>{var _0x326b0d=_0xebe92a;_0x201261[_0x1dfe3f][_0x326b0d(0x140)]=Math[_0x326b0d(0xf7)](_0x1f1978);}),_0x2241c9[_0xebe92a(0x168)]((_0x48af7c,_0x34dd41)=>{var _0x245dc2=_0xebe92a;_0x201261[_0x34dd41][_0x245dc2(0xd5)]=_0x48af7c;}),_0x4ab38a['forEach']((_0xeb8747,_0x5fd84a)=>{_0x201261[_0x5fd84a]['secondary_unit']=_0xeb8747;}),_0x45e2f2[_0xebe92a(0x168)]((_0x5c71f0,_0x5e3915)=>{var _0x10b16a=_0xebe92a;_0x201261[_0x5e3915][_0x10b16a(0xdb)]=_0x5c71f0;}),_0x42c7f0[_0xebe92a(0x168)]((_0x373f7d,_0x4f1ad0)=>{_0x201261[_0x4f1ad0]['primary_code']=_0x373f7d;}),_0x3481f1[_0xebe92a(0x168)]((_0x17757b,_0x4c2d20)=>{var _0x36f16f=_0xebe92a;_0x201261[_0x4c2d20][_0x36f16f(0x18e)]=_0x17757b;}),_0x410651[_0xebe92a(0x168)]((_0x3bad2e,_0x166561)=>{_0x201261[_0x166561]['maxStocks']=_0x3bad2e;}),_0x52b504[_0xebe92a(0x168)]((_0x157e2a,_0x49b774)=>{_0x201261[_0x49b774]['batch_code']=_0x157e2a;}),_0x4f98fb['forEach']((_0x22398d,_0x359b21)=>{_0x201261[_0x359b21]['expiry_date']=_0x22398d;}),_0x10bcd7[_0xebe92a(0x168)]((_0x148ac9,_0x18e21e)=>{_0x201261[_0x18e21e]['production_date']=_0x148ac9;}),_0x17bbd7[_0xebe92a(0x168)]((_0x2f0db4,_0x1845eb)=>{var _0x1968c9=_0xebe92a;_0x201261[_0x1845eb][_0x1968c9(0x17d)]=_0x2f0db4;}),_0x19f0e3[_0xebe92a(0x168)]((_0x5e9de5,_0x19c995)=>{var _0x5da346=_0xebe92a;_0x201261[_0x19c995][_0x5da346(0x174)]=_0x5e9de5;}),_0x11899b['forEach']((_0x29f694,_0x130a23)=>{_0x201261[_0x130a23]['room_name']=_0x29f694;}),_0x5ad32d[_0xebe92a(0x168)]((_0xcb5497,_0x19c84b)=>{var _0x2abaa1=_0xebe92a;_0x201261[_0x19c84b][_0x2abaa1(0x158)]=_0xcb5497;});const _0x2f5709=_0x201261[_0xebe92a(0xf4)](_0x1dbfd1=>_0x1dbfd1[_0xebe92a(0x140)]!=='0'&&_0x1dbfd1[_0xebe92a(0x140)]!==''),_0x5ae829=new purchases_finished({'invoice':_0x37b2ef,'suppliers':_0x77d276['body'][_0xebe92a(0x151)],'date':_0x53ee99,'warehouse_name':_0xb710a2,'product':_0x2f5709,'note':_0x17b281,'due_amount':_0x116446,'room':_0xceba65,'POnumber':_0x54c2ea,'SCRN':_0x187bbf,'JO_number':_0x46fe38}),_0x3bc2da=await _0x5ae829['save'](),_0x55fe40=await purchases_finished['findOne']({'invoice':_0x37b2ef}),_0x39574f=_0x55fe40[_0xebe92a(0x105)][_0xebe92a(0x169)](async _0x5b0ede=>{var _0x4d3fb4=_0xebe92a;try{var _0x287969=await warehouse[_0x4d3fb4(0x180)]({'name':_0xb710a2,'room':_0x5b0ede[_0x4d3fb4(0x15d)]}),_0x3c3592=0x0;const _0x3163a6=_0x287969['product_details']['map'](_0xfe54a4=>{var _0x1bffcb=_0x4d3fb4;console['log'](_0xfe54a4[_0x1bffcb(0x164)]+'=='+_0x5b0ede['product_name']+'&&'+_0xfe54a4[_0x1bffcb(0xdb)]+'=='+_0x5b0ede[_0x1bffcb(0xdb)]+'&&'+_0xfe54a4[_0x1bffcb(0xeb)]+'=='+_0x5b0ede[_0x1bffcb(0xeb)]+'&&'+_0xfe54a4[_0x1bffcb(0xfb)]+'=='+_0x5b0ede[_0x1bffcb(0xfb)]+'&&'+_0xfe54a4[_0x1bffcb(0x131)]+'=='+_0x5b0ede[_0x1bffcb(0x131)]+'&&'+_0xfe54a4['invoice']+'=='+_0x55fe40[_0x1bffcb(0x158)]),_0xfe54a4[_0x1bffcb(0x164)]==_0x5b0ede[_0x1bffcb(0x164)]&&_0xfe54a4[_0x1bffcb(0xdb)]==_0x5b0ede[_0x1bffcb(0xdb)]&&_0xfe54a4[_0x1bffcb(0xeb)]==_0x5b0ede[_0x1bffcb(0xeb)]&&_0xfe54a4['production_date']==_0x5b0ede[_0x1bffcb(0xfb)]&&_0xfe54a4[_0x1bffcb(0x131)]==_0x5b0ede[_0x1bffcb(0x131)]&&_0xfe54a4[_0x1bffcb(0x158)]==_0x55fe40[_0x1bffcb(0x158)]&&(_0xfe54a4[_0x1bffcb(0xd7)]=Math[_0x1bffcb(0xf7)](_0xfe54a4[_0x1bffcb(0xd7)])+Math[_0x1bffcb(0xf7)](_0x5b0ede[_0x1bffcb(0x140)]),_0x3c3592++);});return _0x3c3592==0x0&&(_0x287969[_0x4d3fb4(0xbc)]=_0x287969[_0x4d3fb4(0xbc)][_0x4d3fb4(0xf6)]({'product_name':_0x5b0ede[_0x4d3fb4(0x164)],'product_stock':Math[_0x4d3fb4(0xf7)](_0x5b0ede[_0x4d3fb4(0x140)]),'primary_code':_0x5b0ede[_0x4d3fb4(0xd2)],'secondary_code':_0x5b0ede[_0x4d3fb4(0x18e)],'product_code':_0x5b0ede[_0x4d3fb4(0x17f)],'bay':_0x5b0ede['bay'],'maxProducts':_0x5b0ede[_0x4d3fb4(0x10d)],'unit':_0x5b0ede[_0x4d3fb4(0xd5)],'secondary_unit':_0x5b0ede['secondary_unit'],'expiry_date':_0x5b0ede[_0x4d3fb4(0xeb)],'production_date':_0x5b0ede[_0x4d3fb4(0xfb)],'maxProducts':_0x5b0ede['maxStocks'],'maxPerUnit':_0x5b0ede[_0x4d3fb4(0x17d)],'batch_code':_0x5b0ede[_0x4d3fb4(0x131)],'product_cat':_0x5b0ede['product_cat'],'invoice':_0x5b0ede[_0x4d3fb4(0x158)],'id_incoming':_0x5b0ede[_0x4d3fb4(0xd0)]})),_0x287969;}catch(_0x298f77){return console[_0x4d3fb4(0x12a)](_0x4d3fb4(0x14a),_0x298f77),null;}});Promise[_0xebe92a(0x9a)](_0x39574f)[_0xebe92a(0x145)](async _0x2fa2c4=>{var _0x1ab584=_0xebe92a;try{for(const _0x196427 of _0x2fa2c4){await warehouse[_0x1ab584(0xc6)]({'_id':_0x196427[_0x1ab584(0xd0)]},{'$addToSet':{'product_details':{'$each':_0x196427[_0x1ab584(0xbc)]}}});}const _0x1401b5=await master_shop[_0x1ab584(0xa3)](),_0x2bf153=await email_settings['findOne'](),_0x40628b=await supervisor_settings[_0x1ab584(0xa3)]();var _0x549d82=_0x55fe40[_0x1ab584(0x105)],_0x1525bc='',_0x2ba83d;for(_0x2ba83d in _0x549d82){var _0x33e0e7='FG';_0x55fe40['warehouse_name']=='DRY\x20GOODS'&&(_0x33e0e7='DG'),_0x1525bc+=_0x1ab584(0x185)+_0x1ab584(0x183)+_0x549d82[_0x2ba83d][_0x1ab584(0x164)]+_0x1ab584(0x184)+_0x1ab584(0x183)+_0x549d82[_0x2ba83d][_0x1ab584(0x17f)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x549d82[_0x2ba83d][_0x1ab584(0x140)]+_0x1ab584(0x184)+_0x1ab584(0x183)+_0x549d82[_0x2ba83d][_0x1ab584(0xd5)]+'</td>'+_0x1ab584(0x183)+_0x549d82[_0x2ba83d][_0x1ab584(0x108)]+_0x1ab584(0x184)+_0x1ab584(0x183)+_0x55fe40[_0x1ab584(0xc3)]+_0x1ab584(0x184)+_0x1ab584(0x183)+_0x549d82[_0x2ba83d][_0x1ab584(0x15d)]+_0x1ab584(0x184)+_0x1ab584(0x183)+_0x33e0e7+_0x549d82[_0x2ba83d][_0x1ab584(0xdb)]+_0x1ab584(0x184),_0x1ab584(0x173);}let _0x1208ad=nodemailer[_0x1ab584(0xba)]({'host':_0x2bf153['host'],'port':Number(_0x2bf153[_0x1ab584(0x162)]),'secure':![],'auth':{'user':_0x2bf153[_0x1ab584(0x171)],'pass':_0x2bf153[_0x1ab584(0x188)]}}),_0x1f61d4={'from':_0x2bf153[_0x1ab584(0x171)],'to':_0x40628b[0x0]['FGSEmail'],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x1ab584(0x134)+_0x1ab584(0x175)+_0x1401b5[0x0][_0x1ab584(0xe1)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x1ab584(0xd4)+_0x1ab584(0x170)+'<div>'+_0x1ab584(0x14c)+_0x1ab584(0x98)+_0x1ab584(0xa2)+_0x1ab584(0xee)+_0x1ab584(0x98)+_0x1ab584(0x15f)+_0x1401b5[0x0]['site_title']+_0x1ab584(0xd6)+_0x1ab584(0xee)+_0x1ab584(0xee)+_0x1ab584(0xd8)+'<div>'+_0x1ab584(0x181)+_0x1ab584(0x14d)+_0x55fe40[_0x1ab584(0x158)]+'\x20'+_0x1ab584(0x8f)+_0x1ab584(0xff)+_0x55fe40[_0x1ab584(0x9d)]+'\x20'+_0x1ab584(0x186)+'</h5>'+_0x1ab584(0xee)+_0x1ab584(0xc5)+_0x1ab584(0x12d)+_0x1ab584(0x185)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1ab584(0x11d)+_0x1ab584(0xac)+_0x1ab584(0x150)+_0x1ab584(0xb7)+_0x1ab584(0xa9)+_0x1ab584(0xb8)+_0x1ab584(0x187)+_0x1ab584(0x173)+_0x1ab584(0x14f)+_0x1ab584(0x9c)+'\x20'+_0x1525bc+'\x20'+_0x1ab584(0x112)+_0x1ab584(0x91)+_0x1ab584(0x98)+'<strong>\x20Regards\x20</strong>'+_0x1ab584(0xf9)+_0x1401b5[0x0][_0x1ab584(0xe8)]+'</h5>'+_0x1ab584(0xee)+_0x1ab584(0xee)+_0x1ab584(0xea)};_0x1208ad[_0x1ab584(0xb6)](_0x1f61d4,function(_0x510fd2,_0x5e81ca){var _0x483e0e=_0x1ab584;_0x510fd2?(console[_0x483e0e(0xe3)](_0x510fd2),console['log'](_0x483e0e(0xe6))):console[_0x483e0e(0xe3)](_0x483e0e(0x148));});}catch(_0x1b2e1f){console['error'](_0x1b2e1f),_0x190078[_0x1ab584(0x163)](0x1f4)[_0x1ab584(0x16a)]({'error':_0x1ab584(0x166),'message':_0x1b2e1f[_0x1ab584(0x18b)]});}})['catch'](_0x121e35=>{var _0x463764=_0xebe92a;console[_0x463764(0x12a)](_0x121e35);}),_0x77d276['flash'](_0xebe92a(0x165),_0xebe92a(0x13e)),_0x190078[_0xebe92a(0x159)](_0xebe92a(0xc0));}catch(_0x117132){console['log'](_0x117132);}}),router[a0_0x551ff4(0xe7)](a0_0x551ff4(0x17c),auth,async(_0x399b0c,_0x521ea5)=>{var _0x33ddfb=a0_0x551ff4;try{const {username:_0x1815ef,email:_0x139c2c,role:_0x300621}=_0x399b0c[_0x33ddfb(0x16c)],_0x200b0b=_0x399b0c['user'],_0x37470b=await profile['findOne']({'email':_0x200b0b['email']}),_0x5217cc=await master_shop['find'](),_0x591866=_0x399b0c[_0x33ddfb(0xb1)]['id'],_0x5f2c87=await purchases_finished[_0x33ddfb(0xa7)](_0x591866),_0x38e59d=await suppliers[_0x33ddfb(0xa3)]({});let _0x4a6e8e;if(_0x200b0b[_0x33ddfb(0x10a)]==_0x33ddfb(0xfc)){const _0x3993d1=await staff[_0x33ddfb(0x180)]({'email':_0x200b0b[_0x33ddfb(0x171)]});_0x4a6e8e=await warehouse[_0x33ddfb(0xa3)]({'status':'Enabled','name':_0x3993d1[_0x33ddfb(0xf5)],'warehouse_category':_0x33ddfb(0x11a)});}else _0x4a6e8e=await warehouse[_0x33ddfb(0x191)]([{'$match':{'status':_0x33ddfb(0x18d),'warehouse_category':_0x33ddfb(0x11a)}},{'$group':{'_id':_0x33ddfb(0xf0),'name':{'$first':_0x33ddfb(0xf0)}}}]);const _0x5884af=await product[_0x33ddfb(0xa3)]({}),_0x149198=BayBinSelected(_0x5f2c87['warehouse_name'],_0x5f2c87['room']);let _0x409e10=new Date(_0x5f2c87[_0x33ddfb(0xeb)]),_0x598437=('0'+_0x409e10[_0x33ddfb(0x139)]())[_0x33ddfb(0x97)](-0x2),_0x1f9a2b=('0'+(_0x409e10[_0x33ddfb(0xc1)]()+0x1))['slice'](-0x2),_0xeedb58=_0x409e10[_0x33ddfb(0xc8)](),_0x56c834=_0xeedb58+'-'+_0x1f9a2b+'-'+_0x598437;if(_0x5217cc[0x0][_0x33ddfb(0xf3)]==_0x33ddfb(0x176)){var _0x5a91e7=users[_0x33ddfb(0x161)];console[_0x33ddfb(0xe3)](_0x5a91e7);}else{if(_0x5217cc[0x0][_0x33ddfb(0xf3)]=='Hindi')var _0x5a91e7=users['Hindi'];else{if(_0x5217cc[0x0][_0x33ddfb(0xf3)]==_0x33ddfb(0x111))var _0x5a91e7=users[_0x33ddfb(0x111)];else{if(_0x5217cc[0x0]['language']==_0x33ddfb(0x9e))var _0x5a91e7=users[_0x33ddfb(0x9e)];else{if(_0x5217cc[0x0][_0x33ddfb(0xf3)]==_0x33ddfb(0x101))var _0x5a91e7=users[_0x33ddfb(0x101)];else{if(_0x5217cc[0x0][_0x33ddfb(0xf3)]==_0x33ddfb(0x189))var _0x5a91e7=users[_0x33ddfb(0xec)];else{if(_0x5217cc[0x0][_0x33ddfb(0xf3)]==_0x33ddfb(0x160))var _0x5a91e7=users[_0x33ddfb(0x160)];else{if(_0x5217cc[0x0][_0x33ddfb(0xf3)]==_0x33ddfb(0x127))var _0x5a91e7=users['Arabic'];}}}}}}}_0x521ea5[_0x33ddfb(0x152)](_0x33ddfb(0x16f),{'success':_0x399b0c[_0x33ddfb(0x156)](_0x33ddfb(0x165)),'errors':_0x399b0c[_0x33ddfb(0x156)](_0x33ddfb(0xed)),'role':_0x200b0b,'profile':_0x37470b,'purchases':_0x5f2c87,'suppliers':_0x38e59d,'warehouse':_0x4a6e8e,'product':_0x5884af,'master_shop':_0x5217cc,'language':_0x5a91e7,'ed_fullDate':_0x56c834,'dataSelected':_0x149198});}catch(_0x51c079){console[_0x33ddfb(0xe3)](_0x51c079);}}),router[a0_0x551ff4(0xe7)](a0_0x551ff4(0x124),auth,async(_0x51e309,_0xdf8c31)=>{var _0x55de2e=a0_0x551ff4;try{const {username:_0x1bc670,email:_0x116f69,role:_0x31a200}=_0x51e309[_0x55de2e(0x16c)],_0x38e8e7=_0x51e309[_0x55de2e(0x16c)],_0x51425a=await profile['findOne']({'email':_0x38e8e7[_0x55de2e(0x171)]}),_0x184e29=await master_shop[_0x55de2e(0xa3)](),_0x4758de=_0x51e309[_0x55de2e(0xb1)]['id'],_0x2920ed=await purchases_finished[_0x55de2e(0xa7)](_0x4758de),_0xf8b1a9=await suppliers[_0x55de2e(0xa3)]({});let _0x1d22bf;if(_0x38e8e7['role']=='staff'){const _0x55b353=await staff[_0x55de2e(0x180)]({'email':_0x38e8e7[_0x55de2e(0x171)]});_0x1d22bf=await warehouse[_0x55de2e(0xa3)]({'status':_0x55de2e(0x18d),'name':_0x55b353[_0x55de2e(0xf5)],'warehouse_category':'Finished\x20Goods'});}else _0x1d22bf=await warehouse['aggregate']([{'$match':{'status':_0x55de2e(0x18d),'warehouse_category':_0x55de2e(0x11a)}},{'$group':{'_id':_0x55de2e(0xf0),'name':{'$first':'$name'}}}]);const _0x56c734=await product[_0x55de2e(0xa3)]({}),_0x1c4acf=BayBinSelected(_0x2920ed['warehouse_name'],_0x2920ed[_0x55de2e(0xc9)]);let _0x3e62fc=new Date(_0x2920ed[_0x55de2e(0xeb)]),_0x43e43a=('0'+_0x3e62fc[_0x55de2e(0x139)]())[_0x55de2e(0x97)](-0x2),_0x2f125a=('0'+(_0x3e62fc[_0x55de2e(0xc1)]()+0x1))['slice'](-0x2),_0x22df0d=_0x3e62fc[_0x55de2e(0xc8)](),_0x4e09a6=_0x22df0d+'-'+_0x2f125a+'-'+_0x43e43a;if(_0x184e29[0x0]['language']==_0x55de2e(0x176)){var _0x217dd8=users[_0x55de2e(0x161)];console[_0x55de2e(0xe3)](_0x217dd8);}else{if(_0x184e29[0x0][_0x55de2e(0xf3)]==_0x55de2e(0x114))var _0x217dd8=users[_0x55de2e(0x114)];else{if(_0x184e29[0x0]['language']==_0x55de2e(0x111))var _0x217dd8=users[_0x55de2e(0x111)];else{if(_0x184e29[0x0][_0x55de2e(0xf3)]=='Spanish')var _0x217dd8=users['Spanish'];else{if(_0x184e29[0x0][_0x55de2e(0xf3)]==_0x55de2e(0x101))var _0x217dd8=users[_0x55de2e(0x101)];else{if(_0x184e29[0x0][_0x55de2e(0xf3)]==_0x55de2e(0x189))var _0x217dd8=users[_0x55de2e(0xec)];else{if(_0x184e29[0x0]['language']==_0x55de2e(0x160))var _0x217dd8=users[_0x55de2e(0x160)];else{if(_0x184e29[0x0]['language']==_0x55de2e(0x127))var _0x217dd8=users[_0x55de2e(0x18c)];}}}}}}}_0xdf8c31['render']('edit_purchases_finished',{'success':_0x51e309[_0x55de2e(0x156)]('success'),'errors':_0x51e309[_0x55de2e(0x156)](_0x55de2e(0xed)),'role':_0x38e8e7,'profile':_0x51425a,'purchases':_0x2920ed,'suppliers':_0xf8b1a9,'warehouse':_0x1d22bf,'product':_0x56c734,'master_shop':_0x184e29,'language':_0x217dd8,'ed_fullDate':_0x4e09a6,'dataSelected':_0x1c4acf});}catch(_0x5a4123){console['log'](_0x5a4123);}}),router[a0_0x551ff4(0x93)]('/view/:id',auth,async(_0x413523,_0x49645e)=>{var _0x2728db=a0_0x551ff4;try{const _0x366143=_0x413523[_0x2728db(0xb1)]['id'],_0x4faa91=await purchases_finished[_0x2728db(0x180)]({'_id':_0x413523[_0x2728db(0xb1)]['id']}),_0x220c86=await warehouse['findOne']({'name':_0x4faa91[_0x2728db(0xc3)],'room':_0x4faa91[_0x2728db(0xc9)]});_0x4faa91[_0x2728db(0x105)][_0x2728db(0x168)](_0x41d103=>{var _0x30078a=_0x2728db;const _0x8586c5=_0x220c86[_0x30078a(0xbc)]['map'](_0x276f57=>{var _0x598a75=_0x30078a;_0x276f57[_0x598a75(0x164)]==_0x41d103['product_name']&&_0x276f57[_0x598a75(0xdb)]==_0x41d103[_0x598a75(0xdb)]&&(_0x276f57[_0x598a75(0xd7)]=parseInt(_0x276f57['product_stock'])-parseInt(_0x41d103[_0x598a75(0x140)]));});}),await _0x220c86[_0x2728db(0x128)]();const {invoice:_0x4abc92,suppliers:_0x5d37c7,date:_0x235344,warehouse_name:_0x2c9ae6,prod_name:_0x2b97aa,prod_code:_0x830b46,prod_qty:_0x1a0dc6,prod_unit:_0x511b19,prod_secondunit:_0x957596,prod_level:_0x4a98ee,prod_isle:_0x30534f,prod_pallet:_0x3aaa8e,note:_0x2a4bd6,expiry_date:_0x22964b,batch_code:_0x352574,paid_amount:_0x2f61fa,due_amount:_0x1b39f3,Room_name:_0x330731,primary_code:_0x349d4c,secondary_code:_0x2a6c30,PO_number:_0x1da205,JO_number:_0x5343}=_0x413523[_0x2728db(0x15c)];if(typeof _0x2b97aa==_0x2728db(0x95))var _0x316d3a=[_0x413523['body'][_0x2728db(0xda)]],_0x319861=[_0x413523['body'][_0x2728db(0x155)]],_0x1e5c2b=[_0x413523[_0x2728db(0x15c)]['prod_qty']],_0x25f7a1=[_0x413523[_0x2728db(0x15c)][_0x2728db(0x138)]],_0x1d5beb=[_0x413523[_0x2728db(0x15c)][_0x2728db(0x113)]],_0x31e582=[_0x413523[_0x2728db(0x15c)][_0x2728db(0x13b)]],_0x5ad339=[_0x413523[_0x2728db(0x15c)]['primary_code']],_0x5e7a72=[_0x413523[_0x2728db(0x15c)][_0x2728db(0x18e)]],_0x339300=[_0x413523[_0x2728db(0x15c)][_0x2728db(0x149)]],_0x251da9=[_0x413523[_0x2728db(0x15c)]['batch_code']],_0x26e7f3=[_0x413523[_0x2728db(0x15c)][_0x2728db(0xeb)]];else var _0x316d3a=[..._0x413523[_0x2728db(0x15c)]['prod_name']],_0x319861=[..._0x413523[_0x2728db(0x15c)]['prod_code']],_0x1e5c2b=[..._0x413523[_0x2728db(0x15c)]['prod_qty']],_0x25f7a1=[..._0x413523[_0x2728db(0x15c)]['prod_unit']],_0x1d5beb=[..._0x413523[_0x2728db(0x15c)][_0x2728db(0x113)]],_0x31e582=[..._0x413523[_0x2728db(0x15c)][_0x2728db(0x13b)]],_0x5ad339=[..._0x413523[_0x2728db(0x15c)]['primary_code']],_0x5e7a72=[..._0x413523[_0x2728db(0x15c)][_0x2728db(0x18e)]],_0x339300=[..._0x413523['body']['MaxStocks_data']],_0x251da9=[..._0x413523['body'][_0x2728db(0x131)]],_0x26e7f3=[..._0x413523[_0x2728db(0x15c)][_0x2728db(0xeb)]];const _0x55f112=_0x316d3a[_0x2728db(0x169)](_0x30775b=>{return _0x30775b={'product_name':_0x30775b};});_0x319861[_0x2728db(0x168)]((_0x305ecc,_0x5924a0)=>{var _0x13c254=_0x2728db;_0x55f112[_0x5924a0][_0x13c254(0x17f)]=_0x305ecc;}),_0x1e5c2b[_0x2728db(0x168)]((_0x1669a6,_0x696b70)=>{_0x55f112[_0x696b70]['quantity']=_0x1669a6;}),_0x25f7a1[_0x2728db(0x168)]((_0xff0f48,_0x173f21)=>{var _0xfe079=_0x2728db;_0x55f112[_0x173f21][_0xfe079(0xd5)]=_0xff0f48;}),_0x1d5beb[_0x2728db(0x168)]((_0x4f14b5,_0x49ca48)=>{_0x55f112[_0x49ca48]['secondary_unit']=_0x4f14b5;}),_0x31e582[_0x2728db(0x168)]((_0xfa42d9,_0xc018ab)=>{var _0x1d1729=_0x2728db;_0x55f112[_0xc018ab][_0x1d1729(0xdb)]=_0xfa42d9;}),_0x5ad339[_0x2728db(0x168)]((_0xf8dbf0,_0x5a8fd3)=>{var _0x386995=_0x2728db;_0x55f112[_0x5a8fd3][_0x386995(0xd2)]=_0xf8dbf0;}),_0x5e7a72['forEach']((_0x2d5912,_0x5bf502)=>{var _0x5404d0=_0x2728db;_0x55f112[_0x5bf502][_0x5404d0(0x18e)]=_0x2d5912;}),_0x339300[_0x2728db(0x168)]((_0x46a26d,_0x42c613)=>{var _0x32df52=_0x2728db;_0x55f112[_0x42c613][_0x32df52(0x10d)]=_0x46a26d;}),_0x251da9['forEach']((_0x459621,_0x51f257)=>{var _0x24b372=_0x2728db;_0x55f112[_0x51f257][_0x24b372(0x131)]=_0x459621;}),_0x26e7f3[_0x2728db(0x168)]((_0x4a5f16,_0x25bc23)=>{var _0xa8e461=_0x2728db;_0x55f112[_0x25bc23][_0xa8e461(0xeb)]=_0x4a5f16;});const _0x4a1c45=_0x55f112[_0x2728db(0xf4)](_0x59c616=>_0x59c616[_0x2728db(0x140)]!=='0'&&_0x59c616[_0x2728db(0x140)]!=='');_0x4faa91[_0x2728db(0x158)]=_0x4abc92,_0x4faa91[_0x2728db(0x151)]=_0x5d37c7,_0x4faa91[_0x2728db(0x9d)]=_0x235344,_0x4faa91[_0x2728db(0xc3)]=_0x2c9ae6,_0x4faa91[_0x2728db(0x105)]=_0x4a1c45,_0x4faa91[_0x2728db(0x136)]=_0x2a4bd6,_0x4faa91[_0x2728db(0x16b)]=_0x2f61fa,_0x4faa91[_0x2728db(0xa0)]=_0x1b39f3,_0x4faa91[_0x2728db(0xc9)]=_0x330731,_0x4faa91[_0x2728db(0xb9)]=_0x1da205,_0x4faa91[_0x2728db(0xe9)]=_0x5343;const _0x537673=await _0x4faa91['save'](),_0x5a361a=await warehouse[_0x2728db(0x180)]({'name':_0x413523[_0x2728db(0x15c)][_0x2728db(0xc3)],'room':_0x413523[_0x2728db(0x15c)]['Room_name']});_0x4faa91['product'][_0x2728db(0x168)](_0x1ed8b6=>{var _0x31e574=_0x2728db,_0x2a4623=0x0;const _0x382b07=_0x5a361a[_0x31e574(0xbc)][_0x31e574(0x169)](_0x1037d3=>{var _0x36b0b8=_0x31e574;_0x1037d3[_0x36b0b8(0x164)]==_0x1ed8b6[_0x36b0b8(0x164)]&&_0x1037d3[_0x36b0b8(0xdb)]==_0x1ed8b6['bay']&&(_0x1037d3[_0x36b0b8(0xd7)]=parseInt(_0x1037d3[_0x36b0b8(0xd7)])+parseInt(_0x1ed8b6['quantity']),_0x2a4623++);});_0x2a4623=='0'&&(_0x5a361a[_0x31e574(0xbc)]=_0x5a361a[_0x31e574(0xbc)][_0x31e574(0xf6)]({'product_name':_0x1ed8b6[_0x31e574(0x164)],'product_stock':_0x1ed8b6['quantity'],'primary_code':_0x1ed8b6[_0x31e574(0xd2)],'secondary_code':_0x1ed8b6[_0x31e574(0x18e)],'product_code':_0x1ed8b6[_0x31e574(0x17f)],'bay':_0x1ed8b6[_0x31e574(0xdb)],'maxProducts':_0x1ed8b6['maxStocks'],'unit':_0x1ed8b6[_0x31e574(0xd5)],'secondary_unit':_0x1ed8b6['secondary_unit'],'expiry_date':_0x1ed8b6[_0x31e574(0xeb)]}));}),await _0x5a361a[_0x2728db(0x128)]();const _0x155bd0=await s_payment_data[_0x2728db(0x180)]({'invoice':_0x413523[_0x2728db(0x15c)][_0x2728db(0x158)]});if(_0x155bd0===null){}else console[_0x2728db(0xe3)](_0x2728db(0x151),_0x155bd0,_0x413523[_0x2728db(0x15c)][_0x2728db(0x158)]),_0x155bd0[_0x2728db(0x151)]=_0x413523['body'][_0x2728db(0x151)],await _0x155bd0[_0x2728db(0x128)]();_0x413523[_0x2728db(0x156)](_0x2728db(0x165),'purchase\x20data\x20update\x20successfully'),_0x49645e[_0x2728db(0x159)](_0x2728db(0xc0));}catch(_0x505cbf){console[_0x2728db(0xe3)](_0x505cbf);}}),router['post'](a0_0x551ff4(0xfd),auth,async(_0x280407,_0x40ef58)=>{var _0x20e264=a0_0x551ff4;try{const _0x4b9191=_0x280407[_0x20e264(0xb1)]['id'],{invoice:_0x19c886,suppliers:_0x91ddfc,payable:_0x11c775,due_amount:_0x30ccee}=_0x280407[_0x20e264(0x15c)],_0x4f40aa=await purchases[_0x20e264(0xa7)](_0x4b9191);var _0x31e602=_0x11c775-_0x30ccee;_0x4f40aa['paid_amount']=parseFloat(_0x4f40aa[_0x20e264(0x16b)])+parseFloat(_0x30ccee),_0x4f40aa[_0x20e264(0xa0)]=_0x31e602;const _0x2eaf55=await _0x4f40aa['save']();console['log'](_0x2eaf55);const _0x397e26=await s_payment_data[_0x20e264(0x180)]({'invoice':_0x19c886});_0x397e26[_0x20e264(0x16e)]=_0x31e602,await _0x397e26[_0x20e264(0x128)]();let _0xea141b=new Date(),_0x1853da=('0'+_0xea141b[_0x20e264(0x139)]())[_0x20e264(0x97)](-0x2),_0x3124d8=('0'+(_0xea141b[_0x20e264(0xc1)]()+0x1))[_0x20e264(0x97)](-0x2),_0x542beb=_0xea141b[_0x20e264(0xc8)](),_0x428617=_0x542beb+'-'+_0x3124d8+'-'+_0x1853da;const _0x436836=new suppliers_payment({'invoice':_0x19c886,'date':_0x542beb+'-'+_0x3124d8+'-'+_0x1853da,'suppliers':_0x91ddfc,'reason':_0x20e264(0xd3),'amount':_0x30ccee}),_0x44f98e=await _0x436836[_0x20e264(0x128)]();_0x280407[_0x20e264(0x156)]('success',_0x20e264(0xa6)),_0x40ef58[_0x20e264(0x159)]('/all_purchases/view');}catch(_0x4b8cfe){console[_0x20e264(0xe3)](_0x4b8cfe);}}),router[a0_0x551ff4(0xe7)](a0_0x551ff4(0x12c),auth,async(_0x4671fb,_0x1677bf)=>{var _0x4dc1a4=a0_0x551ff4;try{const {username:_0xc73cd2,email:_0x533bb8,role:_0x45a62c}=_0x4671fb[_0x4dc1a4(0x16c)],_0x20dfbc=_0x4671fb[_0x4dc1a4(0x16c)],_0x2858d9=await profile['findOne']({'email':_0x20dfbc['email']}),_0x1f9b7a=await master_shop[_0x4dc1a4(0xa3)]();console['log'](_0x4dc1a4(0x17e),_0x1f9b7a);const _0x39c905=_0x4671fb[_0x4dc1a4(0xb1)]['id'],_0x47e6c7=await purchases[_0x4dc1a4(0xa7)](_0x39c905);console[_0x4dc1a4(0xe3)](_0x47e6c7);const _0x3badfb=await suppliers[_0x4dc1a4(0x180)]({'name':_0x47e6c7[_0x4dc1a4(0x151)]});console['log'](_0x3badfb);if(_0x1f9b7a[0x0][_0x4dc1a4(0xf3)]==_0x4dc1a4(0x176)){var _0x5c2d77=users[_0x4dc1a4(0x161)];console[_0x4dc1a4(0xe3)](_0x5c2d77);}else{if(_0x1f9b7a[0x0][_0x4dc1a4(0xf3)]==_0x4dc1a4(0x114))var _0x5c2d77=users[_0x4dc1a4(0x114)];else{if(_0x1f9b7a[0x0]['language']==_0x4dc1a4(0x111))var _0x5c2d77=users['German'];else{if(_0x1f9b7a[0x0][_0x4dc1a4(0xf3)]==_0x4dc1a4(0x9e))var _0x5c2d77=users[_0x4dc1a4(0x9e)];else{if(_0x1f9b7a[0x0][_0x4dc1a4(0xf3)]==_0x4dc1a4(0x101))var _0x5c2d77=users['French'];else{if(_0x1f9b7a[0x0][_0x4dc1a4(0xf3)]==_0x4dc1a4(0x189))var _0x5c2d77=users[_0x4dc1a4(0xec)];else{if(_0x1f9b7a[0x0]['language']==_0x4dc1a4(0x160))var _0x5c2d77=users['Chinese'];else{if(_0x1f9b7a[0x0][_0x4dc1a4(0xf3)]==_0x4dc1a4(0x127))var _0x5c2d77=users[_0x4dc1a4(0x18c)];}}}}}}}_0x1677bf[_0x4dc1a4(0x152)](_0x4dc1a4(0x106),{'success':_0x4671fb[_0x4dc1a4(0x156)]('success'),'errors':_0x4671fb['flash'](_0x4dc1a4(0xed)),'role':_0x20dfbc,'profile':_0x2858d9,'master_shop':_0x1f9b7a,'supplier':_0x3badfb,'purchase':_0x47e6c7,'language':_0x5c2d77});}catch(_0x1591e8){console[_0x4dc1a4(0xe3)](_0x1591e8);}}),router['get'](a0_0x551ff4(0x110),auth,async(_0xe80bab,_0x10b040)=>{var _0xf9a33e=a0_0x551ff4;try{const {username:_0x1c3f3a,email:_0x558a24,role:_0xb27b70}=_0xe80bab[_0xf9a33e(0x16c)],_0x442957=_0xe80bab[_0xf9a33e(0x16c)],_0x62fbdf=await profile[_0xf9a33e(0x180)]({'email':_0x442957[_0xf9a33e(0x171)]}),_0x3a129b=await master_shop['find']();console[_0xf9a33e(0xe3)](_0xf9a33e(0x17e),_0x3a129b);const _0x3c288e=_0xe80bab['params']['id'];console[_0xf9a33e(0xe3)](_0x3c288e);const _0x41f0a1=await purchases_finished['findById'](_0x3c288e);console['log'](_0xf9a33e(0x8e),_0x41f0a1);const _0x5b6786=await product[_0xf9a33e(0xa3)]({}),_0x5a8730=await warehouse[_0xf9a33e(0x191)]([{'$match':{'name':_0x41f0a1[_0xf9a33e(0xc3)],'room':_0x41f0a1[_0xf9a33e(0xc9)]}},{'$unwind':_0xf9a33e(0x167)},{'$group':{'_id':_0xf9a33e(0xd1),'name':{'$first':_0xf9a33e(0x10f)},'product_stock':{'$first':_0xf9a33e(0x18a)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xf9a33e(0x141)},'type':{'$first':_0xf9a33e(0xca)},'floorlevel':{'$first':_0xf9a33e(0x13a)},'primary_code':{'$first':_0xf9a33e(0xcf)},'secondary_code':{'$first':_0xf9a33e(0x117)},'product_code':{'$first':_0xf9a33e(0x119)},'storage':{'$first':_0xf9a33e(0xcb)},'rack':{'$first':_0xf9a33e(0xa4)}}}]);console[_0xf9a33e(0xe3)](_0xf9a33e(0xcc),_0x5a8730);let _0x395684;if(_0x442957[_0xf9a33e(0x10a)]=='staff'){const _0x1f22e0=await staff['findOne']({'email':_0x442957[_0xf9a33e(0x171)]});_0x395684=await warehouse[_0xf9a33e(0xa3)]({'status':_0xf9a33e(0x18d),'name':_0x1f22e0['warehouse'],'warehouse_category':_0xf9a33e(0x11a),'name':'Return\x20Goods'});}else _0x395684=await warehouse['aggregate']([{'$match':{'status':_0xf9a33e(0x18d),'warehouse_category':_0xf9a33e(0x11a),'name':'Return\x20Goods'}},{'$group':{'_id':_0xf9a33e(0xf0),'name':{'$first':_0xf9a33e(0xf0)}}}]);if(_0x3a129b[0x0][_0xf9a33e(0xf3)]==_0xf9a33e(0x176)){var _0x20a7f6=users[_0xf9a33e(0x161)];console[_0xf9a33e(0xe3)](_0x20a7f6);}else{if(_0x3a129b[0x0][_0xf9a33e(0xf3)]==_0xf9a33e(0x114))var _0x20a7f6=users[_0xf9a33e(0x114)];else{if(_0x3a129b[0x0][_0xf9a33e(0xf3)]==_0xf9a33e(0x111))var _0x20a7f6=users['German'];else{if(_0x3a129b[0x0]['language']==_0xf9a33e(0x9e))var _0x20a7f6=users['Spanish'];else{if(_0x3a129b[0x0][_0xf9a33e(0xf3)]=='French')var _0x20a7f6=users[_0xf9a33e(0x101)];else{if(_0x3a129b[0x0][_0xf9a33e(0xf3)]==_0xf9a33e(0x189))var _0x20a7f6=users[_0xf9a33e(0xec)];else{if(_0x3a129b[0x0]['language']==_0xf9a33e(0x160))var _0x20a7f6=users[_0xf9a33e(0x160)];else{if(_0x3a129b[0x0][_0xf9a33e(0xf3)]==_0xf9a33e(0x127))var _0x20a7f6=users[_0xf9a33e(0x18c)];}}}}}}}_0x10b040['render'](_0xf9a33e(0x120),{'success':_0xe80bab[_0xf9a33e(0x156)](_0xf9a33e(0x165)),'errors':_0xe80bab[_0xf9a33e(0x156)](_0xf9a33e(0xed)),'role':_0x442957,'profile':_0x62fbdf,'user':_0x41f0a1,'stock':_0x5a8730,'master_shop':_0x3a129b,'product':_0x5b6786,'language':_0x20a7f6,'warehouse':_0x395684});}catch(_0x4d0a85){console[_0xf9a33e(0xe3)](_0x4d0a85);}}),router[a0_0x551ff4(0x93)](a0_0x551ff4(0x110),auth,async(_0x5e6f35,_0x273974)=>{var _0x5e1c66=a0_0x551ff4;try{const {invoice:_0x2c4617,date:_0xe5a5b6,warehouse_name:_0x5882ec,Room_name:_0x3b595a,product_name:_0x21f981,purchase_quantity:_0x234dd6,stocks:_0x391a88,return_qty:_0x3ede02,note:_0x1c6dc2,level:_0x55f829,isle:_0x288355,pallet:_0x5a0b38,to_warehouse_name:_0x3b10f8,to_Room_name:_0x24df4a}=_0x5e6f35[_0x5e1c66(0x15c)],_0x173389=await purchases_finished['findOne']({'_id':_0x5e6f35[_0x5e1c66(0xb1)]['id']}),_0x4c38cb=await warehouse[_0x5e1c66(0x180)]({'name':_0x5882ec,'room':_0x3b595a,'warehouse_category':_0x5e1c66(0x11a)});if(typeof _0x21f981==_0x5e1c66(0x95))var _0x3e7671=[_0x5e6f35[_0x5e1c66(0x15c)]['product_name']],_0x2a4f82=[_0x5e6f35[_0x5e1c66(0x15c)]['purchase_quantity']],_0x361d6f=[_0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0xd9)]],_0xaeef29=[_0x5e6f35[_0x5e1c66(0x15c)]['return_qty']],_0x19fc14=[_0x5e6f35['body'][_0x5e1c66(0x9f)]],_0x395576=[_0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0xa5)]],_0x58dae6=[_0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0x118)]],_0x216c3b=[_0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0x126)]];else var _0x3e7671=[..._0x5e6f35[_0x5e1c66(0x15c)]['product_name']],_0x2a4f82=[..._0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0xdf)]],_0x361d6f=[..._0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0xd9)]],_0xaeef29=[..._0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0x132)]],_0x19fc14=[..._0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0x9f)]],_0x395576=[..._0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0xa5)]],_0x58dae6=[..._0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0x118)]],_0x216c3b=[..._0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0x126)]];const _0x2217ad=_0x3e7671[_0x5e1c66(0x169)](_0x1f1e6c=>{return _0x1f1e6c={'product_name':_0x1f1e6c};});_0x2a4f82['forEach']((_0x4ec6d5,_0x26e1f7)=>{var _0x4e94e4=_0x5e1c66;_0x2217ad[_0x26e1f7][_0x4e94e4(0xdf)]=_0x4ec6d5;}),_0x361d6f[_0x5e1c66(0x168)]((_0x598fe1,_0x5090a9)=>{var _0x259879=_0x5e1c66;_0x2217ad[_0x5090a9][_0x259879(0xa8)]=_0x598fe1;}),_0xaeef29[_0x5e1c66(0x168)]((_0x18a92c,_0x3616e0)=>{var _0x3b367e=_0x5e1c66;_0x2217ad[_0x3616e0][_0x3b367e(0x132)]=_0x18a92c;}),_0x19fc14[_0x5e1c66(0x168)]((_0x12658f,_0x5e3ed3)=>{_0x2217ad[_0x5e3ed3]['bay']=_0x12658f;}),_0x395576[_0x5e1c66(0x168)]((_0x265ba4,_0x46f995)=>{_0x2217ad[_0x46f995]['product_code']=_0x265ba4;}),_0x58dae6[_0x5e1c66(0x168)]((_0x2c46db,_0x5e46fe)=>{var _0x3dfc72=_0x5e1c66;_0x2217ad[_0x5e46fe][_0x3dfc72(0xd2)]=_0x2c46db;}),_0x216c3b['forEach']((_0x1d7166,_0x1d3447)=>{var _0x1bfa43=_0x5e1c66;_0x2217ad[_0x1d3447][_0x1bfa43(0x18e)]=_0x1d7166;}),_0x2217ad[_0x5e1c66(0x168)](_0x25c013=>{var _0x2ff507=_0x5e1c66;console[_0x2ff507(0xe3)](_0x25c013);const _0x191c71=_0x4c38cb[_0x2ff507(0xbc)][_0x2ff507(0x169)](_0x4d8aca=>{var _0x48919a=_0x2ff507;_0x4d8aca[_0x48919a(0x164)]==_0x25c013[_0x48919a(0x164)]&&_0x4d8aca['bay']==_0x25c013[_0x48919a(0xdb)]&&(console['log'](parseInt(_0x4d8aca[_0x48919a(0xd7)])+_0x48919a(0x172)+parseInt(_0x25c013[_0x48919a(0x132)])),_0x4d8aca[_0x48919a(0xd7)]=parseInt(_0x4d8aca[_0x48919a(0xd7)])-parseInt(_0x25c013[_0x48919a(0x132)]));});}),await _0x4c38cb[_0x5e1c66(0x128)]();var _0x5b83d1=0x0;_0x2217ad[_0x5e1c66(0x168)](_0x10ffda=>{var _0x3f9725=_0x5e1c66;(parseInt(_0x10ffda[_0x3f9725(0xdf)])<parseInt(_0x10ffda['return_qty'])||parseInt(_0x10ffda[_0x3f9725(0xa8)])<parseInt(_0x10ffda['return_qty']))&&_0x5b83d1++;});if(_0x5b83d1!=0x0)return _0x5e6f35['flash'](_0x5e1c66(0xed),_0x5e1c66(0xbb)),_0x273974[_0x5e1c66(0x159)](_0x5e1c66(0xce));const _0x40a81c=new purchases_return_finished({'invoice':_0x2c4617,'suppliers':_0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0x151)],'date':_0xe5a5b6,'warehouse_name':_0x5882ec,'return_product':_0x2217ad,'note':_0x1c6dc2,'room':_0x3b595a,'to_warehouse_name':_0x3b10f8,'to_room':_0x24df4a}),_0x50e6a9=await _0x40a81c['save'](),_0x390e63=await purchases_return_finished[_0x5e1c66(0x180)]({'invoice':_0x2c4617}),_0x4770ef=await warehouse[_0x5e1c66(0x180)]({'name':_0x3b10f8,'room':_0x24df4a,'warehouse_category':_0x5e1c66(0x11a)});_0x390e63[_0x5e1c66(0xdd)][_0x5e1c66(0x168)](_0x179c51=>{var _0x3eb829=_0x5e1c66,_0x2f389e=0x0;const _0x206cea=_0x4770ef[_0x3eb829(0xbc)][_0x3eb829(0x169)](_0x486fbb=>{var _0x3ca7e7=_0x3eb829;console[_0x3ca7e7(0xe3)](_0x486fbb['product_name']+'=='+_0x179c51['product_name']+'&&'+_0x486fbb[_0x3ca7e7(0xdb)]+'=='+_0x179c51[_0x3ca7e7(0xdb)]),_0x486fbb['product_name']==_0x179c51['product_name']&&_0x486fbb['bay']==_0x179c51[_0x3ca7e7(0xdb)]&&(_0x486fbb[_0x3ca7e7(0xd7)]=parseInt(_0x486fbb[_0x3ca7e7(0xd7)])-parseInt(_0x179c51[_0x3ca7e7(0x132)]),_0x2f389e++);});_0x2f389e=='0'&&(_0x4770ef['product_details']=_0x4770ef[_0x3eb829(0xbc)][_0x3eb829(0xf6)]({'product_name':_0x179c51[_0x3eb829(0x164)],'product_stock':_0x179c51[_0x3eb829(0x132)],'primary_code':_0x179c51[_0x3eb829(0xd2)],'secondary_code':_0x179c51[_0x3eb829(0x18e)],'product_code':_0x179c51[_0x3eb829(0x17f)],'bay':_0x179c51[_0x3eb829(0xdb)],'maxProducts':0xf423f}));}),await _0x4770ef[_0x5e1c66(0x128)]();const _0x5c1dd0=await purchases_finished[_0x5e1c66(0x180)]({'invoice':_0x2c4617});_0x5c1dd0[_0x5e1c66(0x115)]='True';const _0x1bdc66=await _0x5c1dd0[_0x5e1c66(0x128)](),_0x3d0794=new s_payment_data({'invoice':_0x2c4617,'suppliers':_0x5e6f35['body'][_0x5e1c66(0x151)],'reason':_0x5e1c66(0xe2)});await _0x3d0794[_0x5e1c66(0x128)]();const _0x16bfda=await master_shop[_0x5e1c66(0xa3)](),_0x5840f5=await email_settings[_0x5e1c66(0x180)](),_0x5ec502=await suppliers[_0x5e1c66(0x180)]({'name':_0x5e6f35[_0x5e1c66(0x15c)][_0x5e1c66(0x151)]});_0x16bfda[0x0][_0x5e1c66(0xaa)]==0x1?(right_currency=_0x16bfda[0x0][_0x5e1c66(0x12f)],left_currency=''):(right_currency='',left_currency=_0x16bfda[0x0][_0x5e1c66(0x12f)]);var _0x1e6e94=_0x3e7671,_0x52c0fd=_0xaeef29,_0x46c7a2='',_0x54f766;for(_0x54f766 in _0x1e6e94){_0x46c7a2+=_0x5e1c66(0x185)+_0x5e1c66(0x183)+_0x1e6e94[_0x54f766]+_0x5e1c66(0x184)+_0x5e1c66(0x183)+_0x52c0fd[_0x54f766]+_0x5e1c66(0x184)+_0x5e1c66(0x173);}let _0x5d6651=nodemailer[_0x5e1c66(0xba)]({'service':_0x5e1c66(0x18f),'auth':{'user':_0x5840f5[_0x5e1c66(0x171)],'pass':_0x5840f5[_0x5e1c66(0x188)]}}),_0xd06b13={'from':_0x5840f5[_0x5e1c66(0x171)],'to':_0x5ec502[_0x5e1c66(0x171)],'subject':_0x5e1c66(0x122),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5e1c66(0x134)+'/upload/'+_0x16bfda[0x0][_0x5e1c66(0xe1)],'cid':_0x5e1c66(0x15b)}],'html':_0x5e1c66(0x17a)+_0x5e1c66(0xd4)+_0x5e1c66(0x170)+_0x5e1c66(0x98)+_0x5e1c66(0x14c)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5e1c66(0xee)+_0x5e1c66(0x98)+_0x5e1c66(0x15f)+_0x16bfda[0x0]['site_title']+_0x5e1c66(0xd6)+_0x5e1c66(0xee)+_0x5e1c66(0xee)+_0x5e1c66(0xd8)+_0x5e1c66(0x98)+_0x5e1c66(0x181)+_0x5e1c66(0x14d)+_0x2c4617+'\x20'+_0x5e1c66(0x8f)+'\x20Order\x20Date\x20:\x20'+_0xe5a5b6+'\x20'+'</span>'+'</h5>'+_0x5e1c66(0xee)+_0x5e1c66(0xc5)+_0x5e1c66(0x12d)+_0x5e1c66(0x185)+_0x5e1c66(0x133)+_0x5e1c66(0xad)+_0x5e1c66(0xf1)+_0x5e1c66(0x130)+_0x5e1c66(0x173)+_0x5e1c66(0x14f)+_0x5e1c66(0x9c)+'\x20'+_0x46c7a2+'\x20'+_0x5e1c66(0x112)+_0x5e1c66(0x91)+'<div>'+_0x5e1c66(0x9b)+_0x5e1c66(0xf9)+_0x16bfda[0x0]['site_title']+_0x5e1c66(0x177)+_0x5e1c66(0xee)+'</div>'+_0x5e1c66(0xea)};_0x5d6651[_0x5e1c66(0xb6)](_0xd06b13,function(_0x323eb1,_0x48f967){var _0x1921bb=_0x5e1c66;_0x323eb1?console[_0x1921bb(0xe3)](_0x1921bb(0xe6)):console[_0x1921bb(0xe3)]('Email\x20sent\x20successfully');}),_0x5e6f35[_0x5e1c66(0x156)](_0x5e1c66(0x165),_0x5e1c66(0x12b)),_0x273974[_0x5e1c66(0x159)](_0x5e1c66(0xc0));}catch(_0x188efb){_0x273974[_0x5e1c66(0x163)](0xc8)[_0x5e1c66(0x16a)]({'message':_0x188efb['message']});}}),router[a0_0x551ff4(0xe7)](a0_0x551ff4(0xf2),auth,async(_0x4f8bf4,_0x3027da)=>{var _0x235a71=a0_0x551ff4;try{const {username:_0x4fbfc9,email:_0x3dd3f6,role:_0x14483f}=_0x4f8bf4[_0x235a71(0x16c)],_0x427862=_0x4f8bf4[_0x235a71(0x16c)],_0x2c8a9a=await profile[_0x235a71(0x180)]({'email':_0x427862[_0x235a71(0x171)]}),_0x3f61f2=await master_shop[_0x235a71(0xa3)](),_0x42e545=_0x4f8bf4[_0x235a71(0xb1)]['id'],_0x5a7c49=await purchases_finished[_0x235a71(0xa7)](_0x42e545);if(_0x3f61f2[0x0][_0x235a71(0xf3)]==_0x235a71(0x176))var _0x276596=users['English'];else{if(_0x3f61f2[0x0][_0x235a71(0xf3)]==_0x235a71(0x114))var _0x276596=users[_0x235a71(0x114)];else{if(_0x3f61f2[0x0][_0x235a71(0xf3)]==_0x235a71(0x111))var _0x276596=users[_0x235a71(0x111)];else{if(_0x3f61f2[0x0][_0x235a71(0xf3)]==_0x235a71(0x9e))var _0x276596=users[_0x235a71(0x9e)];else{if(_0x3f61f2[0x0][_0x235a71(0xf3)]==_0x235a71(0x101))var _0x276596=users[_0x235a71(0x101)];else{if(_0x3f61f2[0x0]['language']=='Portuguese\x20(BR)')var _0x276596=users['Portuguese'];else{if(_0x3f61f2[0x0][_0x235a71(0xf3)]==_0x235a71(0x160))var _0x276596=users[_0x235a71(0x160)];else{if(_0x3f61f2[0x0][_0x235a71(0xf3)]=='Arabic\x20(ae)')var _0x276596=users[_0x235a71(0x18c)];}}}}}}}_0x3027da[_0x235a71(0x152)](_0x235a71(0xfe),{'success':_0x4f8bf4[_0x235a71(0x156)](_0x235a71(0x165)),'errors':_0x4f8bf4['flash'](_0x235a71(0xed)),'role':_0x427862,'profile':_0x2c8a9a,'alldata':_0x5a7c49,'master_shop':_0x3f61f2,'language':_0x276596}),console[_0x235a71(0xe3)](alldata);}catch(_0x4f246d){console[_0x235a71(0xe3)](_0x4f246d);}}),router[a0_0x551ff4(0x93)]('/barcode_scanner',async(_0x5dd57a,_0xc954d0)=>{var _0x1bc43f=a0_0x551ff4;const {product_code:_0xfab392}=_0x5dd57a['body'];var _0x33d5ae;const _0x5ea12a=await product[_0x1bc43f(0x191)]([{'$match':{'primary_code':_0xfab392,'product_category':_0x1bc43f(0x11a)}},{'$group':{'_id':_0x1bc43f(0xc4),'name':{'$first':_0x1bc43f(0xf0)},'category':{'$first':'$category'},'brand':{'$first':_0x1bc43f(0x13c)},'unit':{'$first':_0x1bc43f(0x143)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x1bc43f(0x15e)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x1bc43f(0x14e)},'maxStocks':{'$first':_0x1bc43f(0x14b)},'maxProdPerUnit':{'$first':_0x1bc43f(0x11f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4905c8=await product['aggregate']([{'$match':{'secondary_code':_0xfab392}},{'$group':{'_id':'$_id','name':{'$first':_0x1bc43f(0xf0)},'category':{'$first':_0x1bc43f(0x96)},'brand':{'$first':_0x1bc43f(0x13c)},'unit':{'$first':_0x1bc43f(0x143)},'alertquantity':{'$first':_0x1bc43f(0x125)},'product_code':{'$first':_0x1bc43f(0x15e)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x1bc43f(0x14e)},'maxStocks':{'$first':_0x1bc43f(0x14b)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1bc43f(0x109)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5ea12a[_0x1bc43f(0x144)]>0x0)_0x33d5ae=_0x5ea12a;else _0x4905c8[_0x1bc43f(0x144)]>0x0&&(_0x33d5ae=_0x4905c8);_0xc954d0[_0x1bc43f(0x16a)](_0x33d5ae);}),router[a0_0x551ff4(0x93)]('/CheckingWarehouse',async(_0xb78b,_0x25e589)=>{var _0x4d1b21=a0_0x551ff4;const {productCode:_0x537510,bay:_0x1480f0,warehouses:_0x7ec223,room:_0x46183a}=_0xb78b['body'];console[_0x4d1b21(0xe3)](_0xb78b['body']);try{const _0x911aab=await warehouse[_0x4d1b21(0x191)]([{'$match':{'name':_0x7ec223,'room':_0x46183a}},{'$unwind':_0x4d1b21(0x167)},{'$match':{'product_details.bay':parseInt(_0x1480f0)}},{'$group':{'_id':_0x4d1b21(0xd1),'name':{'$first':_0x4d1b21(0x10f)},'product_stock':{'$first':_0x4d1b21(0x18a)},'bay':{'$first':_0x4d1b21(0x107)},'maxProducts':{'$first':_0x4d1b21(0x11c)}}}]);_0x25e589[_0x4d1b21(0x163)](0xc8)[_0x4d1b21(0x16a)](_0x911aab);}catch(_0x20497f){_0x25e589[_0x4d1b21(0x163)](0x194)['json']({'message':_0x20497f[_0x4d1b21(0x18b)]});}}),module[a0_0x551ff4(0xbd)]=router;