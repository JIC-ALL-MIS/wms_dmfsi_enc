var a0_0x4347e7=a0_0x3fd0;function a0_0x272a(){var _0x49a30a=['31422cLEcEt','length','/preview/:id','purchase\x20data\x20update\x20successfully','room_name','$brand','errors','<h2>\x20','maxStocks','Purchase\x20Return\x20Mail','getDate','save','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','getMonth','$_id','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','forEach','room_spmx','return_data','/barcode/:id','view_purchases_finished_spmx','then','Email\x20sent\x20successfully','site_title','$category','$date','email','port','Hindi','/give_payment/:id','<div>','$product_details.product_name','<span\x20style=\x22float:\x20right;\x22>','payment\x20successfull','paid_amount','True','$product_details.floorlevel','body','$product.extenders_spmx_qty','findOne','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','all','stock_data','$product.type','$product.spicemix_spmx','find','$product.product_code','secondary_code','brand_spmx','<tbody\x20style=\x22text-align:\x20center;\x22>','return_purchase_finished','params','product_cat','$product.bin','prod_cat','Enabled','Spanish','/view/add_purchases','prod_code','$primary_code','Portuguese','warehouse_name','$secondary_code','invoice','language','role','Error\x20Occurs','/upload/','currency','post','purchase\x20data\x20add\x20successfully','</tr>','$product_details.maxProducts','json','edit_purchases_finished_view','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$return_data','redirect','curing_spmx','/all_purchases_finished/view','path','user_id','secondary_unit','Ambient','<strong>\x20Regards\x20</strong>','$room','DRY\x20GOODS','return_qty','sendMail','20WFOgLS','\x20Order\x20Date\x20:\x20','extenders_spmx_qty','extender_spmx','back','$suppliers_docs','getFullYear','updateOne','connect-flash','English','$product.floorlevel','Purchase\x20Return','Portuguese\x20(BR)','purchase_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Room_name','catch','</div>','$invoice','filter','QA\x20Warehouse','FROZEN\x20GOODS','Logo.png','/view','$suppliers','render','../models/all_models','all_purchases_finished_spmx','return_product','production_date','_id','quantity','MaxStocks_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','spicemix_spmx','status','log','Purchase\x20Mail','ejs','<html><head><title></title>','Router','secondary_code_hide','</h5>','host','product_details','due_amount','$paid_amount','amount','date_data','all_purchases_barcode','Chinese','$product_details.secondary_code','add_purchases\x20error','$product_code','<hr\x20class=\x22my-3\x22>','string','createTransport','An\x20error\x20occurred\x20while\x20saving\x20data.','exports','invoice_init','$product','$due_amount','$name','prod_invoice','primary_code_hide','bay','stocks','master','prod_primunit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','map','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','741688qxbbZi','6016554jwHQbN','English\x20(US)','10mPVYKT','SPMX','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','</tbody>','get','slice','unit_spmx','standard_unit','$product.bay','error','$product_details.type','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','add_purchases_finished','stock_quantity','note','<h5\x20style=\x22text-align:\x20left;\x22>','</span>','success','room','Rack\x202','10316119TFfZzX','curing_spmx_qty','5456856hRjbJm','27TJxDDz','<h5>','category_spmx','floor','prod_level','toString','$unit','/CheckingWarehouse','/all_purchases_finished/view_purchases_spmx/','$product_details.primary_code','purchases\x20item\x20return\x20successfull','RoomAssign','$product_details._id','\x20Order\x20Number\x20:\x20','</td>','$warehouse_name','prod_secondunit','20206XDSgiy','product_code','\x20</h2>','$product_code_spmx','$note','staff','message','password','$product.spicemix_spmx_qty','/all_purchases/view','prod_Qty','1680912dXiQzj','$maxProdPerUnit','FGSEmail','product_code_hide','expiry_date','Arabic\x20(ae)','extender_spmx_qty','flash','$secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','warehouse','maxperunit','/invoice/:id','Finished\x20Goods','$product_details.rack','padStart','max_product_unit','/view/:id','$maxStocks','primary_code','658sTRSWL','aggregate','product_stock','findById','../middleware/auth','prod_name','date','$batch_code','</table>','purchase_invoice','$product.extenders_spmx','Return\x20Goods','add_purchases_finished_spmx','Arabic','</head><body>','product','prod_qty','batch_code','$product.quantity','../public/language/languages.json','$product_details.product_stock','French','/view_purchases_spmx/:id','express','$alertquantity','INCF-','level','Rack\x201','concat','user','Error\x20occurred\x20while\x20processing\x20product:','German','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$expiry_date','$product.curing_spmx','\x20<>\x20','product_date','product_name','/view/return_purchase/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','image','abs','all_purchases_finished','spicemix_spmx_qty','extenders_spmx','$product_details.storage','</body></html>','$product.room_name','logo','<tr>','suppliers','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','/view/add_purchases_spmx','$product_details.bay'];a0_0x272a=function(){return _0x49a30a;};return a0_0x272a();}(function(_0x2c24cd,_0x5cf822){var _0x440351=a0_0x3fd0,_0x36effb=_0x2c24cd();while(!![]){try{var _0x423045=parseInt(_0x440351(0x10d))/0x1*(parseInt(_0x440351(0x11e))/0x2)+-parseInt(_0x440351(0x129))/0x3+-parseInt(_0x440351(0xf2))/0x4*(-parseInt(_0x440351(0xa9))/0x5)+-parseInt(_0x440351(0x175))/0x6*(parseInt(_0x440351(0x13f))/0x7)+parseInt(_0x440351(0x10c))/0x8+-parseInt(_0x440351(0xf3))/0x9*(-parseInt(_0x440351(0xf5))/0xa)+-parseInt(_0x440351(0x10a))/0xb;if(_0x423045===_0x5cf822)break;else _0x36effb['push'](_0x36effb['shift']());}catch(_0xe9a8fb){_0x36effb['push'](_0x36effb['shift']());}}}(a0_0x272a,0x5b78f));const express=require(a0_0x4347e7(0x156)),app=express(),router=express[a0_0x4347e7(0xd1)](),{profile,master_shop,purchases_spmx,invoice_for_incoming,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x4347e7(0xc3)),auth=require(a0_0x4347e7(0x143)),nodemailer=require('nodemailer');var ejs=require(a0_0x4347e7(0xcf));const path=require(a0_0x4347e7(0xa0)),users=require(a0_0x4347e7(0x152)),e=require(a0_0x4347e7(0xb1));router[a0_0x4347e7(0xfa)]('/view_spmx',auth,async(_0x1534cd,_0x148f68)=>{var _0xa195a5=a0_0x4347e7;try{const {username:_0x156a82,email:_0x5565c1,role:_0x2d45be}=_0x1534cd[_0xa195a5(0x15c)],_0xbef784=_0x1534cd['user'],_0x18ae03=await profile[_0xa195a5(0x19e)]({'email':_0xbef784[_0xa195a5(0x191)]}),_0xe5a523=await staff[_0xa195a5(0x19e)]({'email':_0xbef784[_0xa195a5(0x191)]});if(_0xbef784[_0xa195a5(0x91)]=='staff'){const _0x70be9a=await staff[_0xa195a5(0x19e)]({'email':_0xbef784[_0xa195a5(0x191)]});}const _0x577a9e=await master_shop[_0xa195a5(0x1a4)](),_0x1fd4a7=await purchases_spmx[_0xa195a5(0x140)]([{'$unwind':'$product'},{'$group':{'_id':_0xa195a5(0x183),'invoice':{'$first':_0xa195a5(0xbb)},'date':{'$first':_0xa195a5(0x190)},'warehouse_name':{'$first':_0xa195a5(0x11c)},'room_spmx':{'$addToSet':'$product.room_spmx'},'product':{'$push':_0xa195a5(0xe5)},'note':{'$first':_0xa195a5(0x122)},'spicemix_spmx_qty':{'$sum':_0xa195a5(0x126)},'extenders_spmx_qty':{'$sum':_0xa195a5(0x19d)},'curing_spmx_qty':{'$sum':'$product.curing_spmx_qty'},'spicemix_spmx':{'$addToSet':_0xa195a5(0x1a3)},'extenders_spmx':{'$addToSet':_0xa195a5(0x149)},'curing_spmx':{'$addToSet':_0xa195a5(0x161)},'product_code':{'$addToSet':_0xa195a5(0x1a5)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'warehouse_name':0x1,'room_spmx':0x1,'product':0x1,'note':0x1,'spicemix_spmx_qty':0x1,'extenders_spmx_qty':0x1,'curing_spmx_qty':0x1,'spicemix_spmx':0x1,'extenders_spmx':0x1,'curing_spmx':0x1,'product_code':0x1}}]);if(_0x577a9e[0x0][_0xa195a5(0x90)]==_0xa195a5(0xf4))var _0x5b5666=users[_0xa195a5(0xb2)];else{if(_0x577a9e[0x0][_0xa195a5(0x90)]==_0xa195a5(0x193))var _0x5b5666=users[_0xa195a5(0x193)];else{if(_0x577a9e[0x0][_0xa195a5(0x90)]=='German')var _0x5b5666=users[_0xa195a5(0x15e)];else{if(_0x577a9e[0x0][_0xa195a5(0x90)]==_0xa195a5(0x88))var _0x5b5666=users[_0xa195a5(0x88)];else{if(_0x577a9e[0x0]['language']==_0xa195a5(0x154))var _0x5b5666=users[_0xa195a5(0x154)];else{if(_0x577a9e[0x0]['language']==_0xa195a5(0xb5))var _0x5b5666=users[_0xa195a5(0x8c)];else{if(_0x577a9e[0x0]['language']==_0xa195a5(0xdb))var _0x5b5666=users[_0xa195a5(0xdb)];else{if(_0x577a9e[0x0][_0xa195a5(0x90)]==_0xa195a5(0x12e))var _0x5b5666=users[_0xa195a5(0x14c)];}}}}}}}_0x148f68[_0xa195a5(0xc2)](_0xa195a5(0xc4),{'success':_0x1534cd['flash']('success'),'errors':_0x1534cd[_0xa195a5(0x130)](_0xa195a5(0x17b)),'purchases':_0x1fd4a7,'role':_0xbef784,'profile':_0x18ae03,'master_shop':_0x577a9e,'language':_0x5b5666});}catch(_0xc7af9b){console['log']('table\x20page',_0xc7af9b),_0x148f68[_0xa195a5(0xcc)](0xc8)[_0xa195a5(0x99)]({'message':_0xc7af9b[_0xa195a5(0x124)]});}}),router['get'](a0_0x4347e7(0x173),auth,async(_0x2ffff1,_0x153068)=>{var _0x3b9398=a0_0x4347e7;try{const {username:_0x326a5e,email:_0x72d89c,role:_0x2a5298}=_0x2ffff1[_0x3b9398(0x15c)],_0x4e05e3=_0x2ffff1[_0x3b9398(0x15c)],_0x74b84c=await profile[_0x3b9398(0x19e)]({'email':_0x4e05e3[_0x3b9398(0x191)]}),_0xb1ea30=await master_shop[_0x3b9398(0x1a4)](),_0x1aa5d4=await staff[_0x3b9398(0x19e)]({'email':_0x4e05e3[_0x3b9398(0x191)]}),_0x431067=await suppliers[_0x3b9398(0x1a4)]({}),_0x4a87c5=await warehouse['aggregate']([{'$match':{'status':_0x3b9398(0x87),'warehouse_category':_0x3b9398(0xf6),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x3b9398(0xe7),'name':{'$first':'$name'}}}]),_0x518b8a=await product[_0x3b9398(0x1a4)]({}),_0x370714=await warehouse[_0x3b9398(0x1a4)]({'status':_0x3b9398(0x87)}),_0xcd569a=await purchases_finished[_0x3b9398(0x1a4)]({}),_0x4af11a=_0xcd569a['length']+0x1,_0xdcb0b3='INCF-'+_0x4af11a[_0x3b9398(0x112)]()[_0x3b9398(0x13a)](0x5,'0');var _0x4bc0bb=[_0x3b9398(0xa3),'Enclosed'];if(_0xb1ea30[0x0][_0x3b9398(0x90)]==_0x3b9398(0xf4))var _0x10ed04=users[_0x3b9398(0xb2)];else{if(_0xb1ea30[0x0][_0x3b9398(0x90)]==_0x3b9398(0x193))var _0x10ed04=users[_0x3b9398(0x193)];else{if(_0xb1ea30[0x0][_0x3b9398(0x90)]==_0x3b9398(0x15e))var _0x10ed04=users['German'];else{if(_0xb1ea30[0x0][_0x3b9398(0x90)]==_0x3b9398(0x88))var _0x10ed04=users['Spanish'];else{if(_0xb1ea30[0x0][_0x3b9398(0x90)]=='French')var _0x10ed04=users['French'];else{if(_0xb1ea30[0x0][_0x3b9398(0x90)]==_0x3b9398(0xb5))var _0x10ed04=users[_0x3b9398(0x8c)];else{if(_0xb1ea30[0x0][_0x3b9398(0x90)]==_0x3b9398(0xdb))var _0x10ed04=users[_0x3b9398(0xdb)];else{if(_0xb1ea30[0x0]['language']==_0x3b9398(0x12e))var _0x10ed04=users[_0x3b9398(0x14c)];}}}}}}}const _0x11d0db=getRandom8DigitNumber();_0x11d0db['then'](_0x5ad034=>{var _0x2e9318=_0x3b9398;_0x153068['render'](_0x2e9318(0x14b),{'success':_0x2ffff1['flash'](_0x2e9318(0x107)),'errors':_0x2ffff1[_0x2e9318(0x130)](_0x2e9318(0x17b)),'role':_0x4e05e3,'profile':_0x74b84c,'suppliers':_0x431067,'warehouse':_0x4a87c5,'product':_0x518b8a,'invoice':_0x5ad034,'master_shop':_0xb1ea30,'language':_0x10ed04,'find_data':_0x370714,'rooms_data':_0x4bc0bb});})[_0x3b9398(0xb9)](_0xf534ed=>{var _0x48c93c=_0x3b9398;_0x2ffff1[_0x48c93c(0x130)]('errors',_0x48c93c(0x186)),_0x153068['redirect']('/all_purchases_finished/view');});}catch(_0x2226e3){console[_0x3b9398(0xcd)](_0x2226e3);}}),router[a0_0x4347e7(0x95)](a0_0x4347e7(0x173),auth,async(_0x10fc29,_0x1ada10)=>{var _0x9bc13a=a0_0x4347e7;try{const {date:_0x3f552c,warehouse_name:_0x53b11f,room_name:_0x4111d3,SCRN:_0x4d3ee8,PO_number:_0x15458f,prod_code:_0xc2798c,note:_0x54d829}=_0x10fc29[_0x9bc13a(0x19c)];if(typeof _0xc2798c=='string')var _0x4ab2f9=[_0x10fc29[_0x9bc13a(0x19c)]['prod_code']],_0x5591ff=[_0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0xcb)]],_0x1af974=[_0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0x16a)]],_0x5d2e75=[_0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0xac)]],_0x39ce85=[_0x10fc29['body'][_0x9bc13a(0x12f)]],_0x36fb39=[_0x10fc29[_0x9bc13a(0x19c)]['curing_spmx']],_0x2e547b=[_0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0x10b)]],_0x45846=[_0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0xfc)]],_0x3fd089=[_0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0x1a7)]],_0x2e368b=[_0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0x10f)]],_0xcf5aac=[_0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0x188)]];else var _0x4ab2f9=[..._0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0x8a)]],_0x5591ff=[..._0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0xcb)]],_0x1af974=[..._0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0x16a)]],_0x5d2e75=[..._0x10fc29['body'][_0x9bc13a(0x16b)]],_0x39ce85=[..._0x10fc29['body'][_0x9bc13a(0xab)]],_0x36fb39=[..._0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0x9e)]],_0x2e547b=[..._0x10fc29['body']['curing_spmx_qty']],_0x45846=[..._0x10fc29['body']['unit_spmx']],_0x3fd089=[..._0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0x1a7)]],_0x2e368b=[..._0x10fc29['body']['category_spmx']],_0xcf5aac=[..._0x10fc29[_0x9bc13a(0x19c)][_0x9bc13a(0x188)]];const _0x44557c=_0x4ab2f9[_0x9bc13a(0xef)](_0x51bb55=>{return _0x51bb55={'product_code':_0x51bb55};});_0x5591ff[_0x9bc13a(0x187)]((_0x49e4f5,_0x497f0a)=>{var _0x1df124=_0x9bc13a;_0x44557c[_0x497f0a][_0x1df124(0xcb)]=_0x49e4f5;}),_0x1af974['forEach']((_0x63454c,_0x400dc2)=>{_0x44557c[_0x400dc2]['spicemix_spmx_qty']=_0x63454c;}),_0x5d2e75['forEach']((_0x1dae82,_0x29a30c)=>{var _0x1cc805=_0x9bc13a;_0x44557c[_0x29a30c][_0x1cc805(0x16b)]=_0x1dae82;}),_0x39ce85[_0x9bc13a(0x187)]((_0xee8c72,_0x4c55b7)=>{var _0x8858df=_0x9bc13a;_0x44557c[_0x4c55b7][_0x8858df(0xab)]=_0xee8c72;}),_0x36fb39[_0x9bc13a(0x187)]((_0x4e52d3,_0x39e6b9)=>{var _0xae22e4=_0x9bc13a;_0x44557c[_0x39e6b9][_0xae22e4(0x9e)]=_0x4e52d3;}),_0x2e547b[_0x9bc13a(0x187)]((_0x61d1c2,_0x5bea43)=>{var _0x85eef0=_0x9bc13a;_0x44557c[_0x5bea43][_0x85eef0(0x10b)]=_0x61d1c2;}),_0x45846[_0x9bc13a(0x187)]((_0x2c0d79,_0x1dc49e)=>{var _0x4b95b7=_0x9bc13a;_0x44557c[_0x1dc49e][_0x4b95b7(0xfc)]=_0x2c0d79;}),_0x3fd089[_0x9bc13a(0x187)]((_0x3dd214,_0xa95e58)=>{var _0x5e0c9e=_0x9bc13a;_0x44557c[_0xa95e58][_0x5e0c9e(0x1a7)]=_0x3dd214;}),_0x2e368b[_0x9bc13a(0x187)]((_0x54cc20,_0x1afa9a)=>{var _0x31578d=_0x9bc13a;_0x44557c[_0x1afa9a][_0x31578d(0x10f)]=_0x54cc20;}),_0xcf5aac[_0x9bc13a(0x187)]((_0x259959,_0x28b97d)=>{_0x44557c[_0x28b97d]['room_spmx']=_0x259959;});const _0x4d1572=new invoice_for_incoming();await _0x4d1572[_0x9bc13a(0x180)]();const _0x514cab=new purchases_spmx({'invoice':'INC-'+_0x4d1572[_0x9bc13a(0xe4)][_0x9bc13a(0x112)]()[_0x9bc13a(0x13a)](0x8,'0'),'date':_0x3f552c,'warehouse_name':_0x53b11f,'product':_0x44557c,'note':_0x54d829,'room':_0x4111d3,'POnumber':_0x15458f,'SCRN':_0x4d3ee8}),_0x5c2bde=await _0x514cab[_0x9bc13a(0x180)](),_0x5d43dc=await purchases_spmx[_0x9bc13a(0x142)](_0x5c2bde[_0x9bc13a(0xc7)]);_0x5d43dc[_0x9bc13a(0x14e)][_0x9bc13a(0x187)](async _0x498cb2=>{var _0x26f14f=_0x9bc13a;const _0x5f4b82=_0x498cb2[_0x26f14f(0x11f)],_0x1be685=_0x498cb2[_0x26f14f(0xcb)],_0x435757=_0x498cb2['spicemix_spmx_qty'],_0x72fafc=_0x498cb2['extenders_spmx'],_0x5a8bda=_0x498cb2[_0x26f14f(0xab)],_0xae721b=_0x498cb2[_0x26f14f(0x9e)],_0x2e99f2=_0x498cb2[_0x26f14f(0x10b)],_0x5cd355=_0x498cb2['unit_spmx'],_0x5a19b9=_0x498cb2[_0x26f14f(0x1a7)],_0x6f0721=_0x498cb2['category_spmx'],_0x4bd49b=_0x498cb2[_0x26f14f(0x188)],_0x5f5413=_0x5d43dc[_0x26f14f(0x8f)],_0x4af249=_0x5d43dc['_id'][_0x26f14f(0x112)]()+'~'+_0x498cb2[_0x26f14f(0xc7)][_0x26f14f(0x112)]();await warehouse[_0x26f14f(0xb0)]({'name':_0x53b11f,'room':_0x4bd49b},{'$push':{'product_details_spmx':{'product_code':_0x5f4b82,'spicemix_spmx':_0x1be685,'spicemix_spmx_qty':_0x435757,'extenders_spmx':_0x72fafc,'extenders_spmx_qty':_0x5a8bda,'curing_spmx':_0xae721b,'curing_spmx_qty':_0x2e99f2,'unit_spmx':_0x5cd355,'brand_spmx':_0x5a19b9,'category_spmx':_0x6f0721,'inv_incoming':_0x5f5413,'id_incoming':_0x4af249}}});}),_0x10fc29[_0x9bc13a(0x130)]('success','Incoming\x20Successfully\x20Added'),_0x1ada10[_0x9bc13a(0x9d)](_0x9bc13a(0x115)+_0x5c2bde[_0x9bc13a(0xc7)]);}catch(_0x31ce1e){console[_0x9bc13a(0xcd)](_0x31ce1e);}}),router[a0_0x4347e7(0xfa)](a0_0x4347e7(0x155),auth,async(_0x1507eb,_0x23a915)=>{var _0x462f04=a0_0x4347e7;try{const _0x105c1e=_0x1507eb[_0x462f04(0x1aa)]['id'],_0x5004bc=await purchases_spmx['findById'](_0x105c1e),_0x122e90=await master_shop['find'](),_0x233d48=_0x1507eb['user'],_0x301ee9=await profile[_0x462f04(0x19e)]({'email':_0x233d48[_0x462f04(0x191)]}),_0x19f402=await staff[_0x462f04(0x19e)]({'email':_0x233d48[_0x462f04(0x191)]});if(_0x122e90[0x0][_0x462f04(0x90)]==_0x462f04(0xf4))var _0x441cb9=users[_0x462f04(0xb2)];else{if(_0x122e90[0x0][_0x462f04(0x90)]==_0x462f04(0x193))var _0x441cb9=users[_0x462f04(0x193)];else{if(_0x122e90[0x0][_0x462f04(0x90)]=='German')var _0x441cb9=users[_0x462f04(0x15e)];else{if(_0x122e90[0x0][_0x462f04(0x90)]==_0x462f04(0x88))var _0x441cb9=users[_0x462f04(0x88)];else{if(_0x122e90[0x0][_0x462f04(0x90)]==_0x462f04(0x154))var _0x441cb9=users[_0x462f04(0x154)];else{if(_0x122e90[0x0][_0x462f04(0x90)]==_0x462f04(0xb5))var _0x441cb9=users[_0x462f04(0x8c)];else{if(_0x122e90[0x0][_0x462f04(0x90)]==_0x462f04(0xdb))var _0x441cb9=users[_0x462f04(0xdb)];else{if(_0x122e90[0x0][_0x462f04(0x90)]=='Arabic\x20(ae)')var _0x441cb9=users['Arabic'];}}}}}}}_0x23a915[_0x462f04(0xc2)](_0x462f04(0x18b),{'success':_0x1507eb[_0x462f04(0x130)](_0x462f04(0x107)),'errors':_0x1507eb[_0x462f04(0x130)](_0x462f04(0x17b)),'role':_0x233d48,'profile':_0x301ee9,'master_shop':_0x122e90,'language':_0x441cb9,'data':_0x5004bc});}catch(_0x4d5e42){console[_0x462f04(0xcd)](_0x4d5e42);}}),router['get'](a0_0x4347e7(0xc0),auth,async(_0x5e2580,_0xd6bccf)=>{var _0x5ca4bf=a0_0x4347e7;try{const {username:_0x1d6767,email:_0x2468e3,role:_0x3cb00f}=_0x5e2580[_0x5ca4bf(0x15c)],_0x35a211=_0x5e2580['user'],_0xaf8195=await profile[_0x5ca4bf(0x19e)]({'email':_0x35a211[_0x5ca4bf(0x191)]}),_0x5105fa=await staff[_0x5ca4bf(0x19e)]({'email':_0x35a211[_0x5ca4bf(0x191)]});if(_0x35a211[_0x5ca4bf(0x91)]==_0x5ca4bf(0x123)){const _0x2662c9=await staff['findOne']({'email':_0x35a211[_0x5ca4bf(0x191)]});}const _0x494677=await master_shop[_0x5ca4bf(0x1a4)]();let _0x115f5f;if(_0x35a211['role']==_0x5ca4bf(0x123)){const _0x3e9d74=await staff[_0x5ca4bf(0x19e)]({'email':_0x35a211[_0x5ca4bf(0x191)]});_0x115f5f=await purchases_finished[_0x5ca4bf(0x140)]([{'$unwind':_0x5ca4bf(0xe5)},{'$group':{'_id':_0x5ca4bf(0x183),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x5ca4bf(0x190)},'warehouse_name':{'$first':_0x5ca4bf(0x11c)},'room':{'$first':_0x5ca4bf(0xa5)},'product':{'$push':_0x5ca4bf(0xe5)},'note':{'$first':_0x5ca4bf(0x122)},'paid_amount':{'$first':_0x5ca4bf(0xd7)},'due_amount':{'$first':_0x5ca4bf(0xe6)},'return_data':{'$first':_0x5ca4bf(0x9c)},'batch_code':{'$first':_0x5ca4bf(0x146)},'expiry_date':{'$first':_0x5ca4bf(0x160)},'suppliers_docs':{'$first':_0x5ca4bf(0xae)},'total_product_quantity':{'$sum':_0x5ca4bf(0x151)},'level':{'$addToSet':_0x5ca4bf(0xfe)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x5ca4bf(0x1a2)},'floorlevel':{'$addToSet':_0x5ca4bf(0xb3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x115f5f=await purchases_finished[_0x5ca4bf(0x140)]([{'$unwind':_0x5ca4bf(0xe5)},{'$group':{'_id':_0x5ca4bf(0x183),'invoice':{'$first':_0x5ca4bf(0xbb)},'suppliers':{'$first':_0x5ca4bf(0xc1)},'date':{'$first':_0x5ca4bf(0x190)},'warehouse_name':{'$first':_0x5ca4bf(0x11c)},'room':{'$addToSet':_0x5ca4bf(0x16e)},'product':{'$push':_0x5ca4bf(0xe5)},'note':{'$first':_0x5ca4bf(0x122)},'paid_amount':{'$first':_0x5ca4bf(0xd7)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x5ca4bf(0x146)},'expiry_date':{'$first':_0x5ca4bf(0x160)},'suppliers_docs':{'$first':_0x5ca4bf(0xae)},'total_product_quantity':{'$sum':_0x5ca4bf(0x151)},'level':{'$addToSet':_0x5ca4bf(0xfe)},'isle':{'$addToSet':_0x5ca4bf(0x85)},'type':{'$addToSet':_0x5ca4bf(0x1a2)},'floorlevel':{'$addToSet':_0x5ca4bf(0xb3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x494677[0x0]['language']==_0x5ca4bf(0xf4))var _0x29e781=users[_0x5ca4bf(0xb2)];else{if(_0x494677[0x0][_0x5ca4bf(0x90)]==_0x5ca4bf(0x193))var _0x29e781=users['Hindi'];else{if(_0x494677[0x0]['language']==_0x5ca4bf(0x15e))var _0x29e781=users[_0x5ca4bf(0x15e)];else{if(_0x494677[0x0][_0x5ca4bf(0x90)]==_0x5ca4bf(0x88))var _0x29e781=users[_0x5ca4bf(0x88)];else{if(_0x494677[0x0]['language']=='French')var _0x29e781=users[_0x5ca4bf(0x154)];else{if(_0x494677[0x0][_0x5ca4bf(0x90)]==_0x5ca4bf(0xb5))var _0x29e781=users[_0x5ca4bf(0x8c)];else{if(_0x494677[0x0]['language']=='Chinese')var _0x29e781=users['Chinese'];else{if(_0x494677[0x0]['language']==_0x5ca4bf(0x12e))var _0x29e781=users['Arabic'];}}}}}}}_0xd6bccf[_0x5ca4bf(0xc2)](_0x5ca4bf(0x169),{'success':_0x5e2580[_0x5ca4bf(0x130)](_0x5ca4bf(0x107)),'errors':_0x5e2580[_0x5ca4bf(0x130)](_0x5ca4bf(0x17b)),'purchases':_0x115f5f,'role':_0x35a211,'profile':_0xaf8195,'master_shop':_0x494677,'language':_0x29e781});}catch(_0x285d33){console[_0x5ca4bf(0xcd)]('table\x20page',_0x285d33),_0xd6bccf[_0x5ca4bf(0xcc)](0xc8)[_0x5ca4bf(0x99)]({'message':_0x285d33['message']});}});function BayBinSelected(_0x5da78c,_0x845235){var _0x4c3e20=a0_0x4347e7,_0x5ed3a1=[],_0x3797df=[];if(_0x5da78c==_0x4c3e20(0xa6)){switch(_0x845235){case _0x4c3e20(0x15a):_0x5ed3a1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x4c3e20(0x109):_0x5ed3a1=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3797df=['DG'];}else{if(_0x5da78c==_0x4c3e20(0xbe)){switch(_0x845235){case _0x4c3e20(0x15a):_0x5ed3a1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4c3e20(0x109):_0x5ed3a1=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3797df=['FG'];}}return{'levels':_0x5ed3a1,'identify':_0x3797df};}async function getRandom8DigitNumber(){var _0x191d3c=a0_0x4347e7;const _0x3b1d65=0x989680,_0x6422ee=0x5f5e0ff,_0x20f817=Math[_0x191d3c(0x110)](Math['random']()*(_0x6422ee-_0x3b1d65+0x1))+_0x3b1d65;var _0x3d2dfb;const _0x35cce8=await purchases_finished[_0x191d3c(0x19e)]({'invoice':_0x191d3c(0x158)+_0x20f817});return _0x35cce8&&_0x35cce8[_0x191d3c(0x176)]>0x0?_0x3d2dfb=_0x191d3c(0x158)+_0x20f817:_0x3d2dfb=_0x191d3c(0x158)+_0x20f817,_0x3d2dfb;}function a0_0x3fd0(_0x165c70,_0xd5a2c1){var _0x272ab1=a0_0x272a();return a0_0x3fd0=function(_0x3fd0ad,_0x37cd32){_0x3fd0ad=_0x3fd0ad-0x84;var _0x460534=_0x272ab1[_0x3fd0ad];return _0x460534;},a0_0x3fd0(_0x165c70,_0xd5a2c1);}router[a0_0x4347e7(0xfa)](a0_0x4347e7(0x89),auth,async(_0x4b2bb6,_0x599ff8)=>{var _0x3a16c9=a0_0x4347e7;try{const {username:_0x385352,email:_0x5ed1e5,role:_0x23806d}=_0x4b2bb6['user'],_0x42508d=_0x4b2bb6['user'],_0x1eebf6=await profile['findOne']({'email':_0x42508d['email']}),_0x386add=await master_shop[_0x3a16c9(0x1a4)](),_0x12773f=await staff['findOne']({'email':_0x42508d[_0x3a16c9(0x191)]}),_0x46c580=await suppliers[_0x3a16c9(0x1a4)]({});let _0x42a782;if(_0x42508d[_0x3a16c9(0x91)]==_0x3a16c9(0x123)){const _0x413d01=await staff[_0x3a16c9(0x19e)]({'email':_0x42508d['email']});_0x42a782=await warehouse[_0x3a16c9(0x140)]([{'$match':{'status':_0x3a16c9(0x87),'name':_0x413d01['warehouse'],'warehouse_category':_0x3a16c9(0x138)}},{'$group':{'_id':_0x3a16c9(0xe7),'name':{'$first':_0x3a16c9(0xe7)}}}]);}else _0x42a782=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0x3a16c9(0xbd)}}},{'$group':{'_id':_0x3a16c9(0xe7),'name':{'$first':_0x3a16c9(0xe7)}}}]);const _0x1a10d1=await product[_0x3a16c9(0x1a4)]({}),_0x22d732=await warehouse['find']({'status':'Enabled'}),_0x22b29f=await purchases_finished[_0x3a16c9(0x1a4)]({}),_0x46098a=_0x22b29f[_0x3a16c9(0x176)]+0x1,_0x53627c=_0x3a16c9(0x158)+_0x46098a[_0x3a16c9(0x112)]()['padStart'](0x5,'0');var _0x603baa=[_0x3a16c9(0xa3),_0x3a16c9(0xf0)];if(_0x386add[0x0][_0x3a16c9(0x90)]==_0x3a16c9(0xf4))var _0x478496=users[_0x3a16c9(0xb2)];else{if(_0x386add[0x0][_0x3a16c9(0x90)]==_0x3a16c9(0x193))var _0x478496=users[_0x3a16c9(0x193)];else{if(_0x386add[0x0][_0x3a16c9(0x90)]==_0x3a16c9(0x15e))var _0x478496=users[_0x3a16c9(0x15e)];else{if(_0x386add[0x0][_0x3a16c9(0x90)]==_0x3a16c9(0x88))var _0x478496=users[_0x3a16c9(0x88)];else{if(_0x386add[0x0]['language']==_0x3a16c9(0x154))var _0x478496=users['French'];else{if(_0x386add[0x0]['language']=='Portuguese\x20(BR)')var _0x478496=users[_0x3a16c9(0x8c)];else{if(_0x386add[0x0][_0x3a16c9(0x90)]==_0x3a16c9(0xdb))var _0x478496=users[_0x3a16c9(0xdb)];else{if(_0x386add[0x0][_0x3a16c9(0x90)]==_0x3a16c9(0x12e))var _0x478496=users['Arabic'];}}}}}}}const _0x98c784=getRandom8DigitNumber();_0x98c784[_0x3a16c9(0x18c)](_0x5cc1f9=>{var _0x350165=_0x3a16c9;_0x599ff8[_0x350165(0xc2)](_0x350165(0x102),{'success':_0x4b2bb6[_0x350165(0x130)](_0x350165(0x107)),'errors':_0x4b2bb6[_0x350165(0x130)](_0x350165(0x17b)),'role':_0x42508d,'profile':_0x1eebf6,'suppliers':_0x46c580,'warehouse':_0x42a782,'product':_0x1a10d1,'invoice':_0x5cc1f9,'master_shop':_0x386add,'language':_0x478496,'find_data':_0x22d732,'rooms_data':_0x603baa});})['catch'](_0x28d306=>{var _0x1c8a41=_0x3a16c9;_0x4b2bb6[_0x1c8a41(0x130)]('errors',_0x1c8a41(0x186)),_0x599ff8[_0x1c8a41(0x9d)](_0x1c8a41(0x9f));});}catch(_0x46badb){console[_0x3a16c9(0xcd)](_0x46badb);}}),router[a0_0x4347e7(0xfa)]('/view/add_purchases/:id',auth,async(_0x138744,_0x21040c)=>{var _0x143ef1=a0_0x4347e7;try{const _0x27d5db=_0x138744['params']['id'];console[_0x143ef1(0xcd)](_0x27d5db);const _0x427166=await master_shop[_0x143ef1(0x1a4)]();console[_0x143ef1(0xcd)]('master',_0x427166);const _0x7d523f=await product['findOne']({'name':_0x27d5db});console[_0x143ef1(0xcd)]('product',_0x7d523f),_0x21040c[_0x143ef1(0xcc)](0xc8)['json']({'product_data':_0x7d523f,'master':_0x427166});}catch(_0x4593d5){console[_0x143ef1(0xcd)](_0x143ef1(0xdd),_0x4593d5);}}),router[a0_0x4347e7(0x95)](a0_0x4347e7(0x89),auth,async(_0x51ef2d,_0x3ac2be)=>{var _0x58af64=a0_0x4347e7;try{const {invoice:_0xe1899a,date:_0x16d5a9,warehouse_name:_0x487d71,prod_name:_0x456e2c,prod_code:_0x4cf616,prod_qty:_0x44120b,prod_unit:_0x1357de,prod_secondunit:_0x160ab8,prod_level:_0x175140,prod_isle:_0xbab403,prod_pallet:_0x140f05,note:_0x1fec7a,expiry_date:_0x31ddf9,batch_code:_0x430cf9,payable:_0x103229,due_amount:_0x121070,Room_name:_0x54c896,primary_code:_0x3f8a64,secondary_code:_0x7f61e2,MaxStocks_data:_0x35317c,PO_number:_0x1e62b5,SCRN:_0x45c993,JO_number:_0x111e2a}=_0x51ef2d['body'];if(typeof _0x456e2c==_0x58af64(0xe0))var _0x251251=[_0x51ef2d[_0x58af64(0x19c)]['prod_name']],_0x3d78e2=[_0x51ef2d[_0x58af64(0x19c)]['prod_code']],_0x20049c=[_0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x128)]],_0x5b3c8a=[_0x51ef2d[_0x58af64(0x19c)][_0x58af64(0xed)]],_0x1f38ce=[_0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x11d)]],_0xe5f677=[_0x51ef2d['body']['prod_level']],_0x2fac93=[_0x51ef2d['body'][_0x58af64(0x13e)]],_0x25e2e3=[_0x51ef2d['body'][_0x58af64(0x1a6)]],_0x48ff2b=[_0x51ef2d['body'][_0x58af64(0xc9)]],_0xc34f=[_0x51ef2d['body'][_0x58af64(0x150)]],_0x2f6e40=[_0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x12d)]],_0x200fbd=[_0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x163)]],_0x2c3e5a=[_0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x13b)]],_0x45b1c3=[_0x51ef2d[_0x58af64(0x19c)]['prod_cat']],_0x2992b5=[_0x51ef2d['body'][_0x58af64(0x118)]],_0x254794=[_0x51ef2d['body']['prod_invoice']];else var _0x251251=[..._0x51ef2d[_0x58af64(0x19c)]['prod_name']],_0x3d78e2=[..._0x51ef2d['body'][_0x58af64(0x8a)]],_0x20049c=[..._0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x128)]],_0x5b3c8a=[..._0x51ef2d[_0x58af64(0x19c)][_0x58af64(0xed)]],_0x1f38ce=[..._0x51ef2d['body'][_0x58af64(0x11d)]],_0xe5f677=[..._0x51ef2d[_0x58af64(0x19c)]['prod_level']],_0x2fac93=[..._0x51ef2d['body'][_0x58af64(0x13e)]],_0x25e2e3=[..._0x51ef2d[_0x58af64(0x19c)]['secondary_code']],_0x48ff2b=[..._0x51ef2d['body'][_0x58af64(0xc9)]],_0xc34f=[..._0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x150)]],_0x2f6e40=[..._0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x12d)]],_0x200fbd=[..._0x51ef2d[_0x58af64(0x19c)]['product_date']],_0x2c3e5a=[..._0x51ef2d[_0x58af64(0x19c)]['max_product_unit']],_0x45b1c3=[..._0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x86)]],_0x2992b5=[..._0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x118)]],_0x254794=[..._0x51ef2d['body'][_0x58af64(0xe8)]];const _0x1ae50a=_0x251251['map'](_0x45710b=>{return _0x45710b={'product_name':_0x45710b};});_0x3d78e2['forEach']((_0x19ff91,_0x40616d)=>{var _0x32a8de=_0x58af64;_0x1ae50a[_0x40616d][_0x32a8de(0x11f)]=_0x19ff91,_0x1ae50a[_0x40616d][_0x32a8de(0xd9)]=_0x16d5a9;}),_0x20049c['forEach']((_0x2c8c59,_0x929b5c)=>{var _0x50257d=_0x58af64;_0x1ae50a[_0x929b5c]['quantity']=Math[_0x50257d(0x168)](_0x2c8c59);}),_0x5b3c8a['forEach']((_0x29fcc3,_0x5b8d7e)=>{var _0x4fb5f0=_0x58af64;_0x1ae50a[_0x5b8d7e][_0x4fb5f0(0xfd)]=_0x29fcc3;}),_0x1f38ce[_0x58af64(0x187)]((_0x4d2f37,_0x166b63)=>{var _0x4fe264=_0x58af64;_0x1ae50a[_0x166b63][_0x4fe264(0xa2)]=_0x4d2f37;}),_0xe5f677['forEach']((_0x5211b3,_0x37f687)=>{_0x1ae50a[_0x37f687]['bay']=_0x5211b3;}),_0x2fac93['forEach']((_0x795b59,_0x532035)=>{var _0x28ecba=_0x58af64;_0x1ae50a[_0x532035][_0x28ecba(0x13e)]=_0x795b59;}),_0x25e2e3[_0x58af64(0x187)]((_0x11b525,_0x4f3fd9)=>{var _0x476019=_0x58af64;_0x1ae50a[_0x4f3fd9][_0x476019(0x1a6)]=_0x11b525;}),_0x48ff2b[_0x58af64(0x187)]((_0x1aeb17,_0x138c2f)=>{var _0x548b10=_0x58af64;_0x1ae50a[_0x138c2f][_0x548b10(0x17d)]=_0x1aeb17;}),_0xc34f['forEach']((_0x41dd7c,_0x45931a)=>{var _0x1d3210=_0x58af64;_0x1ae50a[_0x45931a][_0x1d3210(0x150)]=_0x41dd7c;}),_0x2f6e40['forEach']((_0x3a7975,_0x47b57c)=>{var _0x3cde0f=_0x58af64;_0x1ae50a[_0x47b57c][_0x3cde0f(0x12d)]=_0x3a7975;}),_0x200fbd[_0x58af64(0x187)]((_0x5dc3df,_0x2579af)=>{_0x1ae50a[_0x2579af]['production_date']=_0x5dc3df;}),_0x2c3e5a['forEach']((_0x2d4893,_0xa6f299)=>{_0x1ae50a[_0xa6f299]['maxperunit']=_0x2d4893;}),_0x45b1c3['forEach']((_0x43313a,_0x5d2658)=>{var _0x39bd99=_0x58af64;_0x1ae50a[_0x5d2658][_0x39bd99(0x84)]=_0x43313a;}),_0x2992b5[_0x58af64(0x187)]((_0x5272cd,_0x33787b)=>{var _0x581226=_0x58af64;_0x1ae50a[_0x33787b][_0x581226(0x179)]=_0x5272cd;}),_0x254794[_0x58af64(0x187)]((_0x5354ae,_0x455e54)=>{var _0x3ad06e=_0x58af64;_0x1ae50a[_0x455e54][_0x3ad06e(0x8f)]=_0x5354ae;});const _0x4d18f5=_0x1ae50a[_0x58af64(0xbc)](_0x2622d6=>_0x2622d6[_0x58af64(0xc8)]!=='0'&&_0x2622d6[_0x58af64(0xc8)]!==''),_0x5879f1=new purchases_finished({'invoice':_0xe1899a,'suppliers':_0x51ef2d[_0x58af64(0x19c)][_0x58af64(0x171)],'date':_0x16d5a9,'warehouse_name':_0x487d71,'product':_0x4d18f5,'note':_0x1fec7a,'due_amount':_0x121070,'room':_0x54c896,'POnumber':_0x1e62b5,'SCRN':_0x45c993,'JO_number':_0x111e2a}),_0x524edf=await _0x5879f1['save'](),_0x2b00ee=await purchases_finished[_0x58af64(0x19e)]({'invoice':_0xe1899a}),_0x18dfe1=_0x2b00ee[_0x58af64(0x14e)][_0x58af64(0xef)](async _0x278f54=>{var _0x12c13b=_0x58af64;try{var _0x212799=await warehouse['findOne']({'name':_0x487d71,'room':_0x278f54['room_name']}),_0x3c0e06=0x0;const _0x950b1c=_0x212799[_0x12c13b(0xd5)]['map'](_0x570ec0=>{var _0x3fad51=_0x12c13b;console[_0x3fad51(0xcd)](_0x570ec0[_0x3fad51(0x164)]+'=='+_0x278f54[_0x3fad51(0x164)]+'&&'+_0x570ec0[_0x3fad51(0xea)]+'=='+_0x278f54[_0x3fad51(0xea)]+'&&'+_0x570ec0[_0x3fad51(0x12d)]+'=='+_0x278f54[_0x3fad51(0x12d)]+'&&'+_0x570ec0['production_date']+'=='+_0x278f54[_0x3fad51(0xc6)]+'&&'+_0x570ec0[_0x3fad51(0x150)]+'=='+_0x278f54['batch_code']+'&&'+_0x570ec0[_0x3fad51(0x8f)]+'=='+_0x2b00ee[_0x3fad51(0x8f)]),_0x570ec0[_0x3fad51(0x164)]==_0x278f54[_0x3fad51(0x164)]&&_0x570ec0[_0x3fad51(0xea)]==_0x278f54[_0x3fad51(0xea)]&&_0x570ec0['expiry_date']==_0x278f54['expiry_date']&&_0x570ec0[_0x3fad51(0xc6)]==_0x278f54['production_date']&&_0x570ec0['batch_code']==_0x278f54[_0x3fad51(0x150)]&&_0x570ec0[_0x3fad51(0x8f)]==_0x2b00ee[_0x3fad51(0x8f)]&&(_0x570ec0[_0x3fad51(0x141)]=Math[_0x3fad51(0x168)](_0x570ec0[_0x3fad51(0x141)])+Math[_0x3fad51(0x168)](_0x278f54[_0x3fad51(0xc8)]),_0x3c0e06++);});return _0x3c0e06==0x0&&(_0x212799[_0x12c13b(0xd5)]=_0x212799[_0x12c13b(0xd5)][_0x12c13b(0x15b)]({'product_name':_0x278f54['product_name'],'product_stock':Math[_0x12c13b(0x168)](_0x278f54['quantity']),'primary_code':_0x278f54[_0x12c13b(0x13e)],'secondary_code':_0x278f54[_0x12c13b(0x1a6)],'product_code':_0x278f54[_0x12c13b(0x11f)],'bay':_0x278f54[_0x12c13b(0xea)],'maxProducts':_0x278f54[_0x12c13b(0x17d)],'unit':_0x278f54[_0x12c13b(0xfd)],'secondary_unit':_0x278f54[_0x12c13b(0xa2)],'expiry_date':_0x278f54[_0x12c13b(0x12d)],'production_date':_0x278f54[_0x12c13b(0xc6)],'maxProducts':_0x278f54['maxStocks'],'maxPerUnit':_0x278f54[_0x12c13b(0x136)],'batch_code':_0x278f54[_0x12c13b(0x150)],'product_cat':_0x278f54[_0x12c13b(0x84)],'invoice':_0x278f54[_0x12c13b(0x8f)],'id_incoming':_0x278f54[_0x12c13b(0xc7)],'date_data':_0x278f54['date_data']})),_0x212799;}catch(_0x4609de){return console[_0x12c13b(0xff)](_0x12c13b(0x15d),_0x4609de),null;}});Promise[_0x58af64(0x1a0)](_0x18dfe1)[_0x58af64(0x18c)](async _0x155389=>{var _0x4f8257=_0x58af64;try{for(const _0x40b852 of _0x155389){await warehouse[_0x4f8257(0xb0)]({'_id':_0x40b852[_0x4f8257(0xc7)]},{'$addToSet':{'product_details':{'$each':_0x40b852['product_details']}}});}const _0x42c36b=await master_shop[_0x4f8257(0x1a4)](),_0x1d343f=await email_settings['findOne'](),_0x5c670f=await supervisor_settings[_0x4f8257(0x1a4)]();var _0x51e895=_0x2b00ee[_0x4f8257(0x14e)],_0x275750='',_0x5c5153;for(_0x5c5153 in _0x51e895){var _0x49a1fd='FG';_0x2b00ee[_0x4f8257(0x8d)]==_0x4f8257(0xa6)&&(_0x49a1fd='DG'),_0x275750+=_0x4f8257(0x170)+_0x4f8257(0xee)+_0x51e895[_0x5c5153][_0x4f8257(0x164)]+_0x4f8257(0x11b)+_0x4f8257(0xee)+_0x51e895[_0x5c5153][_0x4f8257(0x11f)]+_0x4f8257(0x11b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x51e895[_0x5c5153][_0x4f8257(0xc8)]+'</td>'+_0x4f8257(0xee)+_0x51e895[_0x5c5153][_0x4f8257(0xfd)]+_0x4f8257(0x11b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x51e895[_0x5c5153]['secondary_unit']+_0x4f8257(0x11b)+_0x4f8257(0xee)+_0x2b00ee[_0x4f8257(0x8d)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x51e895[_0x5c5153]['room_name']+_0x4f8257(0x11b)+_0x4f8257(0xee)+_0x49a1fd+_0x51e895[_0x5c5153][_0x4f8257(0xea)]+'</td>',_0x4f8257(0x97);}let _0x63d77e=nodemailer[_0x4f8257(0xe1)]({'host':_0x1d343f[_0x4f8257(0xd4)],'port':Number(_0x1d343f[_0x4f8257(0x192)]),'secure':![],'auth':{'user':_0x1d343f[_0x4f8257(0x191)],'pass':_0x1d343f[_0x4f8257(0x125)]}}),_0x224369={'from':_0x1d343f[_0x4f8257(0x191)],'to':_0x5c670f[0x0][_0x4f8257(0x12b)],'subject':_0x4f8257(0xce),'attachments':[{'filename':'Logo.png','path':__dirname+_0x4f8257(0x184)+'/upload/'+_0x42c36b[0x0][_0x4f8257(0x167)],'cid':_0x4f8257(0x16f)}],'html':_0x4f8257(0xf7)+'<html><head><title></title>'+_0x4f8257(0x14d)+'<div>'+_0x4f8257(0x19f)+_0x4f8257(0x195)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4f8257(0xba)+_0x4f8257(0x195)+_0x4f8257(0x17c)+_0x42c36b[0x0][_0x4f8257(0x18e)]+_0x4f8257(0x120)+_0x4f8257(0xba)+_0x4f8257(0xba)+_0x4f8257(0xdf)+_0x4f8257(0x195)+_0x4f8257(0x105)+'\x20Order\x20Number\x20:\x20'+_0x2b00ee[_0x4f8257(0x8f)]+'\x20'+_0x4f8257(0x197)+'\x20Order\x20Date\x20:\x20'+_0x2b00ee['date']+'\x20'+'</span>'+_0x4f8257(0xd3)+_0x4f8257(0xba)+_0x4f8257(0x9b)+_0x4f8257(0x101)+'<tr>'+_0x4f8257(0x132)+_0x4f8257(0x134)+_0x4f8257(0xb7)+_0x4f8257(0x15f)+_0x4f8257(0xf8)+_0x4f8257(0xca)+_0x4f8257(0x185)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x4f8257(0x97)+'</thead>'+_0x4f8257(0x1a8)+'\x20'+_0x275750+'\x20'+_0x4f8257(0xf9)+_0x4f8257(0x147)+_0x4f8257(0x195)+_0x4f8257(0xa4)+_0x4f8257(0x10e)+_0x42c36b[0x0][_0x4f8257(0x18e)]+_0x4f8257(0xd3)+_0x4f8257(0xba)+_0x4f8257(0xba)+'</body></html>'};_0x63d77e[_0x4f8257(0xa8)](_0x224369,function(_0x3fa8da,_0x3ca443){var _0xee4fa4=_0x4f8257;_0x3fa8da?(console[_0xee4fa4(0xcd)](_0x3fa8da),console[_0xee4fa4(0xcd)](_0xee4fa4(0x92))):console[_0xee4fa4(0xcd)](_0xee4fa4(0x18d));});}catch(_0x4e4818){console[_0x4f8257(0xff)](_0x4e4818),_0x3ac2be[_0x4f8257(0xcc)](0x1f4)[_0x4f8257(0x99)]({'error':_0x4f8257(0xe2),'message':_0x4e4818[_0x4f8257(0x124)]});}})[_0x58af64(0xb9)](_0x7f24b9=>{var _0x236685=_0x58af64;console[_0x236685(0xff)](_0x7f24b9);}),_0x51ef2d[_0x58af64(0x130)](_0x58af64(0x107),_0x58af64(0x96)),_0x3ac2be['redirect'](_0x58af64(0x9f));}catch(_0x300043){console[_0x58af64(0xcd)](_0x300043);}}),router[a0_0x4347e7(0xfa)](a0_0x4347e7(0x177),auth,async(_0x68ae38,_0x151fb8)=>{var _0x451240=a0_0x4347e7;try{const {username:_0x2de25d,email:_0xe45bf4,role:_0x490a59}=_0x68ae38['user'],_0x11c447=_0x68ae38[_0x451240(0x15c)],_0x572dfc=await profile['findOne']({'email':_0x11c447['email']}),_0x39615d=await master_shop['find'](),_0xe85c75=_0x68ae38['params']['id'],_0x10b8c5=await purchases_finished[_0x451240(0x142)](_0xe85c75),_0x5296a3=await suppliers[_0x451240(0x1a4)]({});let _0x472992;if(_0x11c447[_0x451240(0x91)]=='staff'){const _0x5aae51=await staff[_0x451240(0x19e)]({'email':_0x11c447[_0x451240(0x191)]});_0x472992=await warehouse[_0x451240(0x1a4)]({'status':_0x451240(0x87),'name':_0x5aae51['warehouse'],'warehouse_category':_0x451240(0x138)});}else _0x472992=await warehouse[_0x451240(0x140)]([{'$match':{'status':_0x451240(0x87),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x451240(0xe7),'name':{'$first':_0x451240(0xe7)}}}]);const _0x4b0ba6=await product[_0x451240(0x1a4)]({}),_0x55b395=BayBinSelected(_0x10b8c5[_0x451240(0x8d)],_0x10b8c5['room']);let _0x3a1ae5=new Date(_0x10b8c5['expiry_date']),_0x29651c=('0'+_0x3a1ae5[_0x451240(0x17f)]())[_0x451240(0xfb)](-0x2),_0x29f29e=('0'+(_0x3a1ae5[_0x451240(0x182)]()+0x1))['slice'](-0x2),_0x6cc1fb=_0x3a1ae5['getFullYear'](),_0x13ca28=_0x6cc1fb+'-'+_0x29f29e+'-'+_0x29651c;if(_0x39615d[0x0][_0x451240(0x90)]=='English\x20(US)'){var _0x49d51a=users[_0x451240(0xb2)];console[_0x451240(0xcd)](_0x49d51a);}else{if(_0x39615d[0x0][_0x451240(0x90)]==_0x451240(0x193))var _0x49d51a=users['Hindi'];else{if(_0x39615d[0x0][_0x451240(0x90)]==_0x451240(0x15e))var _0x49d51a=users[_0x451240(0x15e)];else{if(_0x39615d[0x0][_0x451240(0x90)]==_0x451240(0x88))var _0x49d51a=users[_0x451240(0x88)];else{if(_0x39615d[0x0]['language']==_0x451240(0x154))var _0x49d51a=users[_0x451240(0x154)];else{if(_0x39615d[0x0][_0x451240(0x90)]==_0x451240(0xb5))var _0x49d51a=users[_0x451240(0x8c)];else{if(_0x39615d[0x0][_0x451240(0x90)]==_0x451240(0xdb))var _0x49d51a=users[_0x451240(0xdb)];else{if(_0x39615d[0x0][_0x451240(0x90)]=='Arabic\x20(ae)')var _0x49d51a=users[_0x451240(0x14c)];}}}}}}}_0x151fb8[_0x451240(0xc2)](_0x451240(0x9a),{'success':_0x68ae38['flash'](_0x451240(0x107)),'errors':_0x68ae38[_0x451240(0x130)]('errors'),'role':_0x11c447,'profile':_0x572dfc,'purchases':_0x10b8c5,'suppliers':_0x5296a3,'warehouse':_0x472992,'product':_0x4b0ba6,'master_shop':_0x39615d,'language':_0x49d51a,'ed_fullDate':_0x13ca28,'dataSelected':_0x55b395});}catch(_0x1b6313){console[_0x451240(0xcd)](_0x1b6313);}}),router[a0_0x4347e7(0xfa)](a0_0x4347e7(0x13c),auth,async(_0x5e802e,_0x320ce6)=>{var _0x21cd69=a0_0x4347e7;try{const {username:_0x148286,email:_0x8b7c87,role:_0x147df5}=_0x5e802e[_0x21cd69(0x15c)],_0x24b446=_0x5e802e[_0x21cd69(0x15c)],_0x436324=await profile[_0x21cd69(0x19e)]({'email':_0x24b446['email']}),_0x7d273b=await master_shop[_0x21cd69(0x1a4)](),_0x9d2230=_0x5e802e[_0x21cd69(0x1aa)]['id'],_0x35a360=await purchases_finished['findById'](_0x9d2230),_0x10f87f=await suppliers[_0x21cd69(0x1a4)]({});let _0x55d1b5;if(_0x24b446['role']==_0x21cd69(0x123)){const _0x446cec=await staff[_0x21cd69(0x19e)]({'email':_0x24b446['email']});_0x55d1b5=await warehouse[_0x21cd69(0x1a4)]({'status':_0x21cd69(0x87),'name':_0x446cec[_0x21cd69(0x135)],'warehouse_category':_0x21cd69(0x138)});}else _0x55d1b5=await warehouse[_0x21cd69(0x140)]([{'$match':{'status':_0x21cd69(0x87),'warehouse_category':_0x21cd69(0x138)}},{'$group':{'_id':_0x21cd69(0xe7),'name':{'$first':_0x21cd69(0xe7)}}}]);const _0x465541=await product[_0x21cd69(0x1a4)]({}),_0x22014a=BayBinSelected(_0x35a360['warehouse_name'],_0x35a360['room']);let _0x14dc7a=new Date(_0x35a360['expiry_date']),_0x1847c5=('0'+_0x14dc7a[_0x21cd69(0x17f)]())[_0x21cd69(0xfb)](-0x2),_0x2a199d=('0'+(_0x14dc7a[_0x21cd69(0x182)]()+0x1))[_0x21cd69(0xfb)](-0x2),_0x4c418d=_0x14dc7a[_0x21cd69(0xaf)](),_0x1f0f2b=_0x4c418d+'-'+_0x2a199d+'-'+_0x1847c5;if(_0x7d273b[0x0]['language']==_0x21cd69(0xf4)){var _0x5e5776=users[_0x21cd69(0xb2)];console[_0x21cd69(0xcd)](_0x5e5776);}else{if(_0x7d273b[0x0]['language']==_0x21cd69(0x193))var _0x5e5776=users['Hindi'];else{if(_0x7d273b[0x0]['language']=='German')var _0x5e5776=users[_0x21cd69(0x15e)];else{if(_0x7d273b[0x0][_0x21cd69(0x90)]==_0x21cd69(0x88))var _0x5e5776=users[_0x21cd69(0x88)];else{if(_0x7d273b[0x0][_0x21cd69(0x90)]==_0x21cd69(0x154))var _0x5e5776=users['French'];else{if(_0x7d273b[0x0][_0x21cd69(0x90)]=='Portuguese\x20(BR)')var _0x5e5776=users[_0x21cd69(0x8c)];else{if(_0x7d273b[0x0][_0x21cd69(0x90)]==_0x21cd69(0xdb))var _0x5e5776=users[_0x21cd69(0xdb)];else{if(_0x7d273b[0x0][_0x21cd69(0x90)]=='Arabic\x20(ae)')var _0x5e5776=users[_0x21cd69(0x14c)];}}}}}}}_0x320ce6['render']('edit_purchases_finished',{'success':_0x5e802e[_0x21cd69(0x130)](_0x21cd69(0x107)),'errors':_0x5e802e['flash'](_0x21cd69(0x17b)),'role':_0x24b446,'profile':_0x436324,'purchases':_0x35a360,'suppliers':_0x10f87f,'warehouse':_0x55d1b5,'product':_0x465541,'master_shop':_0x7d273b,'language':_0x5e5776,'ed_fullDate':_0x1f0f2b,'dataSelected':_0x22014a});}catch(_0x1f52c6){console[_0x21cd69(0xcd)](_0x1f52c6);}}),router[a0_0x4347e7(0x95)](a0_0x4347e7(0x13c),auth,async(_0x888a84,_0x458a0c)=>{var _0x3e2eeb=a0_0x4347e7;try{const _0x13d3ce=_0x888a84[_0x3e2eeb(0x1aa)]['id'],_0x1e0673=await purchases_finished[_0x3e2eeb(0x19e)]({'_id':_0x888a84['params']['id']}),_0x18db10=await warehouse[_0x3e2eeb(0x19e)]({'name':_0x1e0673[_0x3e2eeb(0x8d)],'room':_0x1e0673[_0x3e2eeb(0x108)]});_0x1e0673[_0x3e2eeb(0x14e)]['forEach'](_0x2a9c4f=>{var _0x3eff13=_0x3e2eeb;const _0x2e8621=_0x18db10[_0x3eff13(0xd5)][_0x3eff13(0xef)](_0x546f33=>{var _0x3511ba=_0x3eff13;_0x546f33[_0x3511ba(0x164)]==_0x2a9c4f['product_name']&&_0x546f33[_0x3511ba(0xea)]==_0x2a9c4f[_0x3511ba(0xea)]&&(_0x546f33[_0x3511ba(0x141)]=parseInt(_0x546f33[_0x3511ba(0x141)])-parseInt(_0x2a9c4f[_0x3511ba(0xc8)]));});}),await _0x18db10[_0x3e2eeb(0x180)]();const {invoice:_0x5dd2ad,suppliers:_0x18f55e,date:_0x1db650,warehouse_name:_0x371e09,prod_name:_0x32c9f0,prod_code:_0x15adeb,prod_qty:_0x10b601,prod_unit:_0x5ef342,prod_secondunit:_0x3587ab,prod_level:_0x64a898,prod_isle:_0x86166,prod_pallet:_0x514fb4,note:_0x11b1e6,expiry_date:_0x5dacc9,batch_code:_0x18d8be,paid_amount:_0xe5219e,due_amount:_0x23ba9a,Room_name:_0x35c96a,primary_code:_0x1eebf3,secondary_code:_0x46a7c7,PO_number:_0x2e7b37,JO_number:_0x1ef753}=_0x888a84[_0x3e2eeb(0x19c)];if(typeof _0x32c9f0==_0x3e2eeb(0xe0))var _0x22b031=[_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x144)]],_0x912cf6=[_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x8a)]],_0x4628df=[_0x888a84[_0x3e2eeb(0x19c)]['prod_qty']],_0x5e42e3=[_0x888a84[_0x3e2eeb(0x19c)]['prod_unit']],_0x4a124f=[_0x888a84['body']['prod_secondunit']],_0xe3b573=[_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x111)]],_0x276052=[_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x13e)]],_0x4aa209=[_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x1a6)]],_0x1d95a4=[_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0xc9)]],_0x2c0c48=[_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x150)]],_0x2b3479=[_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x12d)]];else var _0x22b031=[..._0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x144)]],_0x912cf6=[..._0x888a84[_0x3e2eeb(0x19c)]['prod_code']],_0x4628df=[..._0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x14f)]],_0x5e42e3=[..._0x888a84[_0x3e2eeb(0x19c)]['prod_unit']],_0x4a124f=[..._0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x11d)]],_0xe3b573=[..._0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x111)]],_0x276052=[..._0x888a84[_0x3e2eeb(0x19c)]['primary_code']],_0x4aa209=[..._0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x1a6)]],_0x1d95a4=[..._0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0xc9)]],_0x2c0c48=[..._0x888a84[_0x3e2eeb(0x19c)]['batch_code']],_0x2b3479=[..._0x888a84['body'][_0x3e2eeb(0x12d)]];const _0x3b973a=_0x22b031[_0x3e2eeb(0xef)](_0x561d10=>{return _0x561d10={'product_name':_0x561d10};});_0x912cf6[_0x3e2eeb(0x187)]((_0x8a2f9c,_0x2ccc86)=>{_0x3b973a[_0x2ccc86]['product_code']=_0x8a2f9c;}),_0x4628df[_0x3e2eeb(0x187)]((_0x579a96,_0x4ee92c)=>{var _0x1e9267=_0x3e2eeb;_0x3b973a[_0x4ee92c][_0x1e9267(0xc8)]=_0x579a96;}),_0x5e42e3['forEach']((_0x437cca,_0x2b93b4)=>{var _0x71ca48=_0x3e2eeb;_0x3b973a[_0x2b93b4][_0x71ca48(0xfd)]=_0x437cca;}),_0x4a124f['forEach']((_0x3524a0,_0x432930)=>{_0x3b973a[_0x432930]['secondary_unit']=_0x3524a0;}),_0xe3b573[_0x3e2eeb(0x187)]((_0x38fc90,_0x51d9e3)=>{_0x3b973a[_0x51d9e3]['bay']=_0x38fc90;}),_0x276052[_0x3e2eeb(0x187)]((_0x22ad7e,_0xc8a03b)=>{var _0x2e6cc6=_0x3e2eeb;_0x3b973a[_0xc8a03b][_0x2e6cc6(0x13e)]=_0x22ad7e;}),_0x4aa209[_0x3e2eeb(0x187)]((_0x3c77f8,_0x1ea141)=>{var _0x54f656=_0x3e2eeb;_0x3b973a[_0x1ea141][_0x54f656(0x1a6)]=_0x3c77f8;}),_0x1d95a4[_0x3e2eeb(0x187)]((_0x487fa2,_0xe820ba)=>{var _0x5056d8=_0x3e2eeb;_0x3b973a[_0xe820ba][_0x5056d8(0x17d)]=_0x487fa2;}),_0x2c0c48['forEach']((_0x55c7a2,_0x2e3493)=>{var _0x2fd77d=_0x3e2eeb;_0x3b973a[_0x2e3493][_0x2fd77d(0x150)]=_0x55c7a2;}),_0x2b3479[_0x3e2eeb(0x187)]((_0x4c64ff,_0x42d87b)=>{var _0x25d167=_0x3e2eeb;_0x3b973a[_0x42d87b][_0x25d167(0x12d)]=_0x4c64ff;});const _0x7531eb=_0x3b973a[_0x3e2eeb(0xbc)](_0x10c9d0=>_0x10c9d0[_0x3e2eeb(0xc8)]!=='0'&&_0x10c9d0[_0x3e2eeb(0xc8)]!=='');_0x1e0673['invoice']=_0x5dd2ad,_0x1e0673[_0x3e2eeb(0x171)]=_0x18f55e,_0x1e0673[_0x3e2eeb(0x145)]=_0x1db650,_0x1e0673['warehouse_name']=_0x371e09,_0x1e0673[_0x3e2eeb(0x14e)]=_0x7531eb,_0x1e0673[_0x3e2eeb(0x104)]=_0x11b1e6,_0x1e0673[_0x3e2eeb(0x199)]=_0xe5219e,_0x1e0673['due_amount']=_0x23ba9a,_0x1e0673[_0x3e2eeb(0x108)]=_0x35c96a,_0x1e0673['POnumber']=_0x2e7b37,_0x1e0673['JO_number']=_0x1ef753;const _0x99f1ee=await _0x1e0673[_0x3e2eeb(0x180)](),_0x349318=await warehouse['findOne']({'name':_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x8d)],'room':_0x888a84['body'][_0x3e2eeb(0xb8)]});_0x1e0673[_0x3e2eeb(0x14e)][_0x3e2eeb(0x187)](_0x4b6962=>{var _0x1c2175=_0x3e2eeb,_0x3fef44=0x0;const _0x5c7f9a=_0x349318['product_details'][_0x1c2175(0xef)](_0x12c2c7=>{var _0x5f0bf7=_0x1c2175;_0x12c2c7[_0x5f0bf7(0x164)]==_0x4b6962[_0x5f0bf7(0x164)]&&_0x12c2c7[_0x5f0bf7(0xea)]==_0x4b6962[_0x5f0bf7(0xea)]&&(_0x12c2c7[_0x5f0bf7(0x141)]=parseInt(_0x12c2c7[_0x5f0bf7(0x141)])+parseInt(_0x4b6962['quantity']),_0x3fef44++);});_0x3fef44=='0'&&(_0x349318['product_details']=_0x349318['product_details'][_0x1c2175(0x15b)]({'product_name':_0x4b6962[_0x1c2175(0x164)],'product_stock':_0x4b6962[_0x1c2175(0xc8)],'primary_code':_0x4b6962[_0x1c2175(0x13e)],'secondary_code':_0x4b6962['secondary_code'],'product_code':_0x4b6962[_0x1c2175(0x11f)],'bay':_0x4b6962[_0x1c2175(0xea)],'maxProducts':_0x4b6962['maxStocks'],'unit':_0x4b6962[_0x1c2175(0xfd)],'secondary_unit':_0x4b6962[_0x1c2175(0xa2)],'expiry_date':_0x4b6962[_0x1c2175(0x12d)]}));}),await _0x349318[_0x3e2eeb(0x180)]();const _0x34a709=await s_payment_data[_0x3e2eeb(0x19e)]({'invoice':_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x8f)]});if(_0x34a709===null){}else console[_0x3e2eeb(0xcd)](_0x3e2eeb(0x171),_0x34a709,_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x8f)]),_0x34a709['suppliers']=_0x888a84[_0x3e2eeb(0x19c)][_0x3e2eeb(0x171)],await _0x34a709['save']();_0x888a84['flash'](_0x3e2eeb(0x107),_0x3e2eeb(0x178)),_0x458a0c['redirect']('/all_purchases_finished/view');}catch(_0x1f31cb){console[_0x3e2eeb(0xcd)](_0x1f31cb);}}),router[a0_0x4347e7(0x95)](a0_0x4347e7(0x194),auth,async(_0x1a2b4f,_0x52c8a5)=>{var _0x46d3c2=a0_0x4347e7;try{const _0x2a9e85=_0x1a2b4f[_0x46d3c2(0x1aa)]['id'],{invoice:_0x1ec32a,suppliers:_0x4614c1,payable:_0x420b17,due_amount:_0x532da8}=_0x1a2b4f[_0x46d3c2(0x19c)],_0x16f61c=await purchases[_0x46d3c2(0x142)](_0x2a9e85);var _0x4f69ca=_0x420b17-_0x532da8;_0x16f61c[_0x46d3c2(0x199)]=parseFloat(_0x16f61c[_0x46d3c2(0x199)])+parseFloat(_0x532da8),_0x16f61c[_0x46d3c2(0xd6)]=_0x4f69ca;const _0x563d3e=await _0x16f61c[_0x46d3c2(0x180)]();console[_0x46d3c2(0xcd)](_0x563d3e);const _0x99470e=await s_payment_data[_0x46d3c2(0x19e)]({'invoice':_0x1ec32a});_0x99470e[_0x46d3c2(0xd8)]=_0x4f69ca,await _0x99470e[_0x46d3c2(0x180)]();let _0x5c920a=new Date(),_0x358aae=('0'+_0x5c920a['getDate']())[_0x46d3c2(0xfb)](-0x2),_0x1c8bd7=('0'+(_0x5c920a[_0x46d3c2(0x182)]()+0x1))[_0x46d3c2(0xfb)](-0x2),_0x52664e=_0x5c920a[_0x46d3c2(0xaf)](),_0x207101=_0x52664e+'-'+_0x1c8bd7+'-'+_0x358aae;const _0x2ec8c1=new suppliers_payment({'invoice':_0x1ec32a,'date':_0x52664e+'-'+_0x1c8bd7+'-'+_0x358aae,'suppliers':_0x4614c1,'reason':'Paid\x20For\x20Purchase','amount':_0x532da8}),_0x2b9d2b=await _0x2ec8c1[_0x46d3c2(0x180)]();_0x1a2b4f[_0x46d3c2(0x130)](_0x46d3c2(0x107),_0x46d3c2(0x198)),_0x52c8a5['redirect'](_0x46d3c2(0x127));}catch(_0x5b37a1){console[_0x46d3c2(0xcd)](_0x5b37a1);}}),router['get'](a0_0x4347e7(0x137),auth,async(_0x17e115,_0x5869cd)=>{var _0x4ebf55=a0_0x4347e7;try{const {username:_0x2993cb,email:_0x4a4140,role:_0x5a22df}=_0x17e115[_0x4ebf55(0x15c)],_0x38c1c6=_0x17e115[_0x4ebf55(0x15c)],_0x170216=await profile[_0x4ebf55(0x19e)]({'email':_0x38c1c6[_0x4ebf55(0x191)]}),_0x2c9ccf=await master_shop['find']();console[_0x4ebf55(0xcd)](_0x4ebf55(0xec),_0x2c9ccf);const _0x51ad82=_0x17e115[_0x4ebf55(0x1aa)]['id'],_0x5e0000=await purchases[_0x4ebf55(0x142)](_0x51ad82);console[_0x4ebf55(0xcd)](_0x5e0000);const _0x37259f=await suppliers['findOne']({'name':_0x5e0000['suppliers']});console[_0x4ebf55(0xcd)](_0x37259f);if(_0x2c9ccf[0x0][_0x4ebf55(0x90)]=='English\x20(US)'){var _0x50fecf=users['English'];console[_0x4ebf55(0xcd)](_0x50fecf);}else{if(_0x2c9ccf[0x0][_0x4ebf55(0x90)]==_0x4ebf55(0x193))var _0x50fecf=users[_0x4ebf55(0x193)];else{if(_0x2c9ccf[0x0][_0x4ebf55(0x90)]==_0x4ebf55(0x15e))var _0x50fecf=users[_0x4ebf55(0x15e)];else{if(_0x2c9ccf[0x0]['language']==_0x4ebf55(0x88))var _0x50fecf=users[_0x4ebf55(0x88)];else{if(_0x2c9ccf[0x0][_0x4ebf55(0x90)]==_0x4ebf55(0x154))var _0x50fecf=users[_0x4ebf55(0x154)];else{if(_0x2c9ccf[0x0][_0x4ebf55(0x90)]==_0x4ebf55(0xb5))var _0x50fecf=users[_0x4ebf55(0x8c)];else{if(_0x2c9ccf[0x0][_0x4ebf55(0x90)]==_0x4ebf55(0xdb))var _0x50fecf=users[_0x4ebf55(0xdb)];else{if(_0x2c9ccf[0x0][_0x4ebf55(0x90)]==_0x4ebf55(0x12e))var _0x50fecf=users['Arabic'];}}}}}}}_0x5869cd['render'](_0x4ebf55(0x148),{'success':_0x17e115[_0x4ebf55(0x130)](_0x4ebf55(0x107)),'errors':_0x17e115[_0x4ebf55(0x130)](_0x4ebf55(0x17b)),'role':_0x38c1c6,'profile':_0x170216,'master_shop':_0x2c9ccf,'supplier':_0x37259f,'purchase':_0x5e0000,'language':_0x50fecf});}catch(_0x7e8ac3){console[_0x4ebf55(0xcd)](_0x7e8ac3);}}),router[a0_0x4347e7(0xfa)](a0_0x4347e7(0x165),auth,async(_0x5dea6e,_0x2fc758)=>{var _0x220200=a0_0x4347e7;try{const {username:_0x146382,email:_0x22bd1b,role:_0xf9d7be}=_0x5dea6e[_0x220200(0x15c)],_0x94d78c=_0x5dea6e[_0x220200(0x15c)],_0x52f73f=await profile[_0x220200(0x19e)]({'email':_0x94d78c[_0x220200(0x191)]}),_0x1cc403=await master_shop[_0x220200(0x1a4)]();console[_0x220200(0xcd)]('master',_0x1cc403);const _0x8787bb=_0x5dea6e[_0x220200(0x1aa)]['id'];console[_0x220200(0xcd)](_0x8787bb);const _0x30337e=await purchases_finished['findById'](_0x8787bb);console[_0x220200(0xcd)](_0x220200(0xa1),_0x30337e);const _0x5d4af1=await product[_0x220200(0x1a4)]({}),_0x99a334=await warehouse[_0x220200(0x140)]([{'$match':{'name':_0x30337e[_0x220200(0x8d)],'room':_0x30337e[_0x220200(0x108)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x220200(0x196)},'product_stock':{'$first':_0x220200(0x153)},'bay':{'$first':_0x220200(0x174)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x220200(0x100)},'floorlevel':{'$first':_0x220200(0x19b)},'primary_code':{'$first':_0x220200(0x116)},'secondary_code':{'$first':_0x220200(0xdc)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x220200(0x16c)},'rack':{'$first':_0x220200(0x139)}}}]);console[_0x220200(0xcd)](_0x220200(0x1a1),_0x99a334);let _0x4f16f7;if(_0x94d78c[_0x220200(0x91)]==_0x220200(0x123)){const _0x5652ed=await staff[_0x220200(0x19e)]({'email':_0x94d78c[_0x220200(0x191)]});_0x4f16f7=await warehouse[_0x220200(0x1a4)]({'status':_0x220200(0x87),'name':_0x5652ed[_0x220200(0x135)],'warehouse_category':_0x220200(0x138),'name':'Return\x20Goods'});}else _0x4f16f7=await warehouse[_0x220200(0x140)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':_0x220200(0x14a)}},{'$group':{'_id':_0x220200(0xe7),'name':{'$first':_0x220200(0xe7)}}}]);if(_0x1cc403[0x0][_0x220200(0x90)]==_0x220200(0xf4)){var _0x3817ee=users['English'];console[_0x220200(0xcd)](_0x3817ee);}else{if(_0x1cc403[0x0][_0x220200(0x90)]=='Hindi')var _0x3817ee=users[_0x220200(0x193)];else{if(_0x1cc403[0x0][_0x220200(0x90)]=='German')var _0x3817ee=users[_0x220200(0x15e)];else{if(_0x1cc403[0x0]['language']=='Spanish')var _0x3817ee=users[_0x220200(0x88)];else{if(_0x1cc403[0x0][_0x220200(0x90)]=='French')var _0x3817ee=users['French'];else{if(_0x1cc403[0x0]['language']==_0x220200(0xb5))var _0x3817ee=users[_0x220200(0x8c)];else{if(_0x1cc403[0x0][_0x220200(0x90)]==_0x220200(0xdb))var _0x3817ee=users[_0x220200(0xdb)];else{if(_0x1cc403[0x0][_0x220200(0x90)]==_0x220200(0x12e))var _0x3817ee=users['Arabic'];}}}}}}}_0x2fc758[_0x220200(0xc2)](_0x220200(0x1a9),{'success':_0x5dea6e['flash'](_0x220200(0x107)),'errors':_0x5dea6e[_0x220200(0x130)]('errors'),'role':_0x94d78c,'profile':_0x52f73f,'user':_0x30337e,'stock':_0x99a334,'master_shop':_0x1cc403,'product':_0x5d4af1,'language':_0x3817ee,'warehouse':_0x4f16f7});}catch(_0x2aeacd){console[_0x220200(0xcd)](_0x2aeacd);}}),router[a0_0x4347e7(0x95)](a0_0x4347e7(0x165),auth,async(_0x5403a,_0x493b2d)=>{var _0xdbe18a=a0_0x4347e7;try{const {invoice:_0xa08492,date:_0x253e8b,warehouse_name:_0x352b2c,Room_name:_0x18b972,product_name:_0x8f7f65,purchase_quantity:_0x53bb3e,stocks:_0x21ed0f,return_qty:_0x16647b,note:_0x2f7387,level:_0x12724b,isle:_0x3ba2d4,pallet:_0x43413a,to_warehouse_name:_0x1198f9,to_Room_name:_0x5a744c}=_0x5403a[_0xdbe18a(0x19c)],_0x5a5e32=await purchases_finished[_0xdbe18a(0x19e)]({'_id':_0x5403a['params']['id']}),_0x1d41eb=await warehouse['findOne']({'name':_0x352b2c,'room':_0x18b972,'warehouse_category':_0xdbe18a(0x138)});if(typeof _0x8f7f65=='string')var _0x265273=[_0x5403a['body']['product_name']],_0x57f3eb=[_0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0xb6)]],_0xd9a1d4=[_0x5403a[_0xdbe18a(0x19c)]['stocks']],_0x3dcd27=[_0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0xa7)]],_0x5dca2d=[_0x5403a['body'][_0xdbe18a(0x159)]],_0x15551c=[_0x5403a['body'][_0xdbe18a(0x12c)]],_0x5ab846=[_0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0xe9)]],_0x42497e=[_0x5403a['body'][_0xdbe18a(0xd2)]];else var _0x265273=[..._0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0x164)]],_0x57f3eb=[..._0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0xb6)]],_0xd9a1d4=[..._0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0xeb)]],_0x3dcd27=[..._0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0xa7)]],_0x5dca2d=[..._0x5403a['body'][_0xdbe18a(0x159)]],_0x15551c=[..._0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0x12c)]],_0x5ab846=[..._0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0xe9)]],_0x42497e=[..._0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0xd2)]];const _0x8250df=_0x265273[_0xdbe18a(0xef)](_0xf7a3d3=>{return _0xf7a3d3={'product_name':_0xf7a3d3};});_0x57f3eb['forEach']((_0x53f95b,_0x5b6056)=>{var _0x421996=_0xdbe18a;_0x8250df[_0x5b6056][_0x421996(0xb6)]=_0x53f95b;}),_0xd9a1d4[_0xdbe18a(0x187)]((_0x4cd900,_0x30d200)=>{var _0x3f9ccc=_0xdbe18a;_0x8250df[_0x30d200][_0x3f9ccc(0x103)]=_0x4cd900;}),_0x3dcd27[_0xdbe18a(0x187)]((_0x4b199c,_0x2e2fdf)=>{var _0x5130a1=_0xdbe18a;_0x8250df[_0x2e2fdf][_0x5130a1(0xa7)]=_0x4b199c;}),_0x5dca2d[_0xdbe18a(0x187)]((_0x3eec9c,_0x597f2d)=>{_0x8250df[_0x597f2d]['bay']=_0x3eec9c;}),_0x15551c[_0xdbe18a(0x187)]((_0x27b290,_0x5a5c76)=>{_0x8250df[_0x5a5c76]['product_code']=_0x27b290;}),_0x5ab846[_0xdbe18a(0x187)]((_0x6a9fb6,_0x23d7c9)=>{var _0x5b1569=_0xdbe18a;_0x8250df[_0x23d7c9][_0x5b1569(0x13e)]=_0x6a9fb6;}),_0x42497e[_0xdbe18a(0x187)]((_0x4d09f9,_0xf4d0bc)=>{var _0x227610=_0xdbe18a;_0x8250df[_0xf4d0bc][_0x227610(0x1a6)]=_0x4d09f9;}),_0x8250df['forEach'](_0xbd0ecf=>{var _0x4408fe=_0xdbe18a;console['log'](_0xbd0ecf);const _0x3e38c2=_0x1d41eb['product_details'][_0x4408fe(0xef)](_0x261108=>{var _0x2d08e6=_0x4408fe;_0x261108[_0x2d08e6(0x164)]==_0xbd0ecf[_0x2d08e6(0x164)]&&_0x261108['bay']==_0xbd0ecf[_0x2d08e6(0xea)]&&(console[_0x2d08e6(0xcd)](parseInt(_0x261108['product_stock'])+_0x2d08e6(0x162)+parseInt(_0xbd0ecf[_0x2d08e6(0xa7)])),_0x261108[_0x2d08e6(0x141)]=parseInt(_0x261108[_0x2d08e6(0x141)])-parseInt(_0xbd0ecf['return_qty']));});}),await _0x1d41eb[_0xdbe18a(0x180)]();var _0x7991db=0x0;_0x8250df['forEach'](_0x2208ba=>{var _0x1a2f45=_0xdbe18a;(parseInt(_0x2208ba[_0x1a2f45(0xb6)])<parseInt(_0x2208ba[_0x1a2f45(0xa7)])||parseInt(_0x2208ba[_0x1a2f45(0x103)])<parseInt(_0x2208ba[_0x1a2f45(0xa7)]))&&_0x7991db++;});if(_0x7991db!=0x0)return _0x5403a[_0xdbe18a(0x130)](_0xdbe18a(0x17b),_0xdbe18a(0x172)),_0x493b2d[_0xdbe18a(0x9d)](_0xdbe18a(0xad));const _0x3d3c5d=new purchases_return_finished({'invoice':_0xa08492,'suppliers':_0x5403a[_0xdbe18a(0x19c)][_0xdbe18a(0x171)],'date':_0x253e8b,'warehouse_name':_0x352b2c,'return_product':_0x8250df,'note':_0x2f7387,'room':_0x18b972,'to_warehouse_name':_0x1198f9,'to_room':_0x5a744c}),_0x5e416b=await _0x3d3c5d[_0xdbe18a(0x180)](),_0x4fc65a=await purchases_return_finished[_0xdbe18a(0x19e)]({'invoice':_0xa08492}),_0x5a00eb=await warehouse['findOne']({'name':_0x1198f9,'room':_0x5a744c,'warehouse_category':_0xdbe18a(0x138)});_0x4fc65a[_0xdbe18a(0xc5)][_0xdbe18a(0x187)](_0x2e5cff=>{var _0x5f4c43=_0xdbe18a,_0x49b3af=0x0;const _0x1ee468=_0x5a00eb[_0x5f4c43(0xd5)][_0x5f4c43(0xef)](_0x4d58d9=>{var _0x2ffa6a=_0x5f4c43;console['log'](_0x4d58d9[_0x2ffa6a(0x164)]+'=='+_0x2e5cff[_0x2ffa6a(0x164)]+'&&'+_0x4d58d9[_0x2ffa6a(0xea)]+'=='+_0x2e5cff[_0x2ffa6a(0xea)]),_0x4d58d9[_0x2ffa6a(0x164)]==_0x2e5cff[_0x2ffa6a(0x164)]&&_0x4d58d9[_0x2ffa6a(0xea)]==_0x2e5cff[_0x2ffa6a(0xea)]&&(_0x4d58d9[_0x2ffa6a(0x141)]=parseInt(_0x4d58d9[_0x2ffa6a(0x141)])-parseInt(_0x2e5cff[_0x2ffa6a(0xa7)]),_0x49b3af++);});_0x49b3af=='0'&&(_0x5a00eb[_0x5f4c43(0xd5)]=_0x5a00eb['product_details']['concat']({'product_name':_0x2e5cff[_0x5f4c43(0x164)],'product_stock':_0x2e5cff[_0x5f4c43(0xa7)],'primary_code':_0x2e5cff[_0x5f4c43(0x13e)],'secondary_code':_0x2e5cff[_0x5f4c43(0x1a6)],'product_code':_0x2e5cff[_0x5f4c43(0x11f)],'bay':_0x2e5cff[_0x5f4c43(0xea)],'maxProducts':0xf423f}));}),await _0x5a00eb[_0xdbe18a(0x180)]();const _0x36809d=await purchases_finished[_0xdbe18a(0x19e)]({'invoice':_0xa08492});_0x36809d[_0xdbe18a(0x189)]=_0xdbe18a(0x19a);const _0x5d62db=await _0x36809d['save'](),_0x234f89=new s_payment_data({'invoice':_0xa08492,'suppliers':_0x5403a[_0xdbe18a(0x19c)]['suppliers'],'reason':_0xdbe18a(0xb4)});await _0x234f89[_0xdbe18a(0x180)]();const _0x4c369b=await master_shop[_0xdbe18a(0x1a4)](),_0x5bc317=await email_settings[_0xdbe18a(0x19e)](),_0x5c7bb4=await suppliers['findOne']({'name':_0x5403a['body'][_0xdbe18a(0x171)]});_0x4c369b[0x0]['currency_placement']==0x1?(right_currency=_0x4c369b[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4c369b[0x0][_0xdbe18a(0x94)]);var _0x106cc8=_0x265273,_0x382fef=_0x3dcd27,_0x354968='',_0x3697c0;for(_0x3697c0 in _0x106cc8){_0x354968+='<tr>'+_0xdbe18a(0xee)+_0x106cc8[_0x3697c0]+_0xdbe18a(0x11b)+_0xdbe18a(0xee)+_0x382fef[_0x3697c0]+'</td>'+_0xdbe18a(0x97);}let _0x487f79=nodemailer[_0xdbe18a(0xe1)]({'service':'gmail','auth':{'user':_0x5bc317[_0xdbe18a(0x191)],'pass':_0x5bc317[_0xdbe18a(0x125)]}}),_0x3ecb67={'from':_0x5bc317[_0xdbe18a(0x191)],'to':_0x5c7bb4[_0xdbe18a(0x191)],'subject':_0xdbe18a(0x17e),'attachments':[{'filename':_0xdbe18a(0xbf),'path':__dirname+_0xdbe18a(0x184)+_0xdbe18a(0x93)+_0x4c369b[0x0][_0xdbe18a(0x167)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0xdbe18a(0xd0)+_0xdbe18a(0x14d)+_0xdbe18a(0x195)+_0xdbe18a(0x19f)+_0xdbe18a(0x195)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0xdbe18a(0x195)+_0xdbe18a(0x17c)+_0x4c369b[0x0]['site_title']+_0xdbe18a(0x120)+_0xdbe18a(0xba)+_0xdbe18a(0xba)+'<hr\x20class=\x22my-3\x22>'+_0xdbe18a(0x195)+_0xdbe18a(0x105)+_0xdbe18a(0x11a)+_0xa08492+'\x20'+_0xdbe18a(0x197)+_0xdbe18a(0xaa)+_0x253e8b+'\x20'+_0xdbe18a(0x106)+'</h5>'+_0xdbe18a(0xba)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xdbe18a(0x101)+_0xdbe18a(0x170)+_0xdbe18a(0x132)+_0xdbe18a(0x181)+_0xdbe18a(0xf1)+_0xdbe18a(0x166)+_0xdbe18a(0x97)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x354968+'\x20'+_0xdbe18a(0xf9)+_0xdbe18a(0x147)+_0xdbe18a(0x195)+_0xdbe18a(0xa4)+'<h5>'+_0x4c369b[0x0]['site_title']+_0xdbe18a(0xd3)+_0xdbe18a(0xba)+_0xdbe18a(0xba)+_0xdbe18a(0x16d)};_0x487f79[_0xdbe18a(0xa8)](_0x3ecb67,function(_0x30f3a4,_0xb8d542){var _0x403385=_0xdbe18a;_0x30f3a4?console[_0x403385(0xcd)]('Error\x20Occurs'):console[_0x403385(0xcd)](_0x403385(0x18d));}),_0x5403a[_0xdbe18a(0x130)](_0xdbe18a(0x107),_0xdbe18a(0x117)),_0x493b2d[_0xdbe18a(0x9d)]('/all_purchases_finished/view');}catch(_0x58a72f){_0x493b2d[_0xdbe18a(0xcc)](0xc8)[_0xdbe18a(0x99)]({'message':_0x58a72f[_0xdbe18a(0x124)]});}}),router[a0_0x4347e7(0xfa)](a0_0x4347e7(0x18a),auth,async(_0x18fddd,_0x2ba372)=>{var _0x35f1d9=a0_0x4347e7;try{const {username:_0x16c3b1,email:_0x5d4ae9,role:_0x548d8f}=_0x18fddd['user'],_0x13f588=_0x18fddd[_0x35f1d9(0x15c)],_0x236187=await profile['findOne']({'email':_0x13f588[_0x35f1d9(0x191)]}),_0x32c5f1=await master_shop[_0x35f1d9(0x1a4)](),_0x32b7dd=_0x18fddd[_0x35f1d9(0x1aa)]['id'],_0x34dd14=await purchases_finished[_0x35f1d9(0x142)](_0x32b7dd);if(_0x32c5f1[0x0][_0x35f1d9(0x90)]==_0x35f1d9(0xf4))var _0x48dd4b=users[_0x35f1d9(0xb2)];else{if(_0x32c5f1[0x0][_0x35f1d9(0x90)]==_0x35f1d9(0x193))var _0x48dd4b=users['Hindi'];else{if(_0x32c5f1[0x0][_0x35f1d9(0x90)]==_0x35f1d9(0x15e))var _0x48dd4b=users[_0x35f1d9(0x15e)];else{if(_0x32c5f1[0x0][_0x35f1d9(0x90)]=='Spanish')var _0x48dd4b=users[_0x35f1d9(0x88)];else{if(_0x32c5f1[0x0][_0x35f1d9(0x90)]==_0x35f1d9(0x154))var _0x48dd4b=users[_0x35f1d9(0x154)];else{if(_0x32c5f1[0x0][_0x35f1d9(0x90)]==_0x35f1d9(0xb5))var _0x48dd4b=users[_0x35f1d9(0x8c)];else{if(_0x32c5f1[0x0][_0x35f1d9(0x90)]==_0x35f1d9(0xdb))var _0x48dd4b=users['Chinese'];else{if(_0x32c5f1[0x0][_0x35f1d9(0x90)]==_0x35f1d9(0x12e))var _0x48dd4b=users[_0x35f1d9(0x14c)];}}}}}}}_0x2ba372[_0x35f1d9(0xc2)](_0x35f1d9(0xda),{'success':_0x18fddd[_0x35f1d9(0x130)]('success'),'errors':_0x18fddd[_0x35f1d9(0x130)](_0x35f1d9(0x17b)),'role':_0x13f588,'profile':_0x236187,'alldata':_0x34dd14,'master_shop':_0x32c5f1,'language':_0x48dd4b}),console[_0x35f1d9(0xcd)](alldata);}catch(_0x4fc190){console[_0x35f1d9(0xcd)](_0x4fc190);}}),router[a0_0x4347e7(0x95)]('/barcode_scanner',async(_0x45cc27,_0x1f3cfb)=>{var _0x37eddd=a0_0x4347e7;const {product_code:_0x2045d1}=_0x45cc27['body'];var _0x208f72;const _0x354736=await product[_0x37eddd(0x140)]([{'$match':{'primary_code':_0x2045d1,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x37eddd(0x183),'name':{'$first':_0x37eddd(0xe7)},'category':{'$first':_0x37eddd(0x18f)},'brand':{'$first':'$brand'},'unit':{'$first':_0x37eddd(0x113)},'alertquantity':{'$first':_0x37eddd(0x157)},'product_code':{'$first':_0x37eddd(0xde)},'primary_code':{'$first':_0x37eddd(0x8b)},'secondary_code':{'$first':_0x37eddd(0x8e)},'maxStocks':{'$first':_0x37eddd(0x13d)},'maxProdPerUnit':{'$first':_0x37eddd(0x12a)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x37eddd(0x131)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5b0e0b=await product['aggregate']([{'$match':{'secondary_code':_0x2045d1}},{'$group':{'_id':_0x37eddd(0x183),'name':{'$first':_0x37eddd(0xe7)},'category':{'$first':_0x37eddd(0x18f)},'brand':{'$first':_0x37eddd(0x17a)},'unit':{'$first':_0x37eddd(0x113)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x37eddd(0x8b)},'secondary_code':{'$first':_0x37eddd(0x8e)},'maxStocks':{'$first':_0x37eddd(0x13d)},'maxProdPerUnit':{'$first':_0x37eddd(0x12a)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x37eddd(0x131)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x354736['length']>0x0)_0x208f72=_0x354736;else _0x5b0e0b[_0x37eddd(0x176)]>0x0&&(_0x208f72=_0x5b0e0b);_0x1f3cfb[_0x37eddd(0x99)](_0x208f72);}),router[a0_0x4347e7(0x95)]('/barcode_scanner_spmx',async(_0x5ae97e,_0x336da7)=>{var _0x42837=a0_0x4347e7;const {product_code:_0x55717d}=_0x5ae97e[_0x42837(0x19c)];var _0x2420e9;const _0x55eb3e=await product[_0x42837(0x140)]([{'$match':{'product_code_spmx':_0x55717d,'product_category':_0x42837(0xf6)}},{'$group':{'_id':_0x42837(0x183),'category':{'$first':_0x42837(0x18f)},'brand':{'$first':_0x42837(0x17a)},'unit':{'$first':_0x42837(0x113)},'product_code_spmx':{'$first':_0x42837(0x121)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x42837(0x8b)},'secondary_code':{'$first':'$secondary_code'},'product_cat':{'$first':'SPMX'}}},{'$project':{'_id':0x1,'category':0x1,'brand':0x1,'unit':0x1,'product_code_spmx':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'product_cat':0x1}}]);_0x2420e9=_0x55eb3e,_0x336da7[_0x42837(0x99)](_0x2420e9);}),router[a0_0x4347e7(0x95)](a0_0x4347e7(0x114),async(_0x430949,_0x12dbc8)=>{var _0x5c2aed=a0_0x4347e7;const {productCode:_0x57117b,bay:_0x5defe4,warehouses:_0xdac27,room:_0x2eb70f}=_0x430949[_0x5c2aed(0x19c)];console[_0x5c2aed(0xcd)](_0x430949[_0x5c2aed(0x19c)]);try{const _0x165713=await warehouse['aggregate']([{'$match':{'name':_0xdac27,'room':_0x2eb70f}},{'$unwind':_0x5c2aed(0x133)},{'$match':{'product_details.bay':parseInt(_0x5defe4)}},{'$group':{'_id':_0x5c2aed(0x119),'name':{'$first':_0x5c2aed(0x196)},'product_stock':{'$first':_0x5c2aed(0x153)},'bay':{'$first':_0x5c2aed(0x174)},'maxProducts':{'$first':_0x5c2aed(0x98)}}}]);_0x12dbc8[_0x5c2aed(0xcc)](0xc8)[_0x5c2aed(0x99)](_0x165713);}catch(_0x453e22){_0x12dbc8[_0x5c2aed(0xcc)](0x194)['json']({'message':_0x453e22[_0x5c2aed(0x124)]});}}),module[a0_0x4347e7(0xe3)]=router;