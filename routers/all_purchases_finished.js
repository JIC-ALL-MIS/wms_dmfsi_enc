var a0_0x2ecaf4=a0_0x5433;function a0_0x5433(_0x3b30c9,_0x38f604){var _0xd1dc0b=a0_0xd1dc();return a0_0x5433=function(_0x543358,_0x2d496d){_0x543358=_0x543358-0x108;var _0x53b0cf=_0xd1dc0b[_0x543358];return _0x53b0cf;},a0_0x5433(_0x3b30c9,_0x38f604);}(function(_0x406bc7,_0x4e1ceb){var _0x3b24ab=a0_0x5433,_0x1bdb71=_0x406bc7();while(!![]){try{var _0x2ffcc8=parseInt(_0x3b24ab(0x1b5))/0x1*(-parseInt(_0x3b24ab(0x121))/0x2)+parseInt(_0x3b24ab(0x1e3))/0x3*(-parseInt(_0x3b24ab(0x120))/0x4)+-parseInt(_0x3b24ab(0x148))/0x5+-parseInt(_0x3b24ab(0x152))/0x6*(parseInt(_0x3b24ab(0x172))/0x7)+parseInt(_0x3b24ab(0x1c8))/0x8*(parseInt(_0x3b24ab(0x1ce))/0x9)+-parseInt(_0x3b24ab(0x1cb))/0xa+parseInt(_0x3b24ab(0x113))/0xb;if(_0x2ffcc8===_0x4e1ceb)break;else _0x1bdb71['push'](_0x1bdb71['shift']());}catch(_0x6a2333){_0x1bdb71['push'](_0x1bdb71['shift']());}}}(a0_0xd1dc,0xf182c));const express=require(a0_0x2ecaf4(0x154)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x2ecaf4(0x1b3)),auth=require(a0_0x2ecaf4(0x16f)),nodemailer=require(a0_0x2ecaf4(0x17c));var ejs=require(a0_0x2ecaf4(0x14c));const path=require(a0_0x2ecaf4(0x1ef)),users=require(a0_0x2ecaf4(0x1a5));router['get'](a0_0x2ecaf4(0x1bc),auth,async(_0x2a9066,_0x1ef838)=>{var _0x111d2b=a0_0x2ecaf4;try{const {username:_0x1c76ab,email:_0xa93a07,role:_0x4c5912}=_0x2a9066[_0x111d2b(0x1d3)],_0x2050e6=_0x2a9066[_0x111d2b(0x1d3)],_0x2b70e1=await profile[_0x111d2b(0x1ea)]({'email':_0x2050e6['email']}),_0x57bbe6=await staff[_0x111d2b(0x1ea)]({'email':_0x2050e6[_0x111d2b(0x16a)]});if(_0x2050e6[_0x111d2b(0x1ff)]=='staff'){const _0x55c6a0=await staff[_0x111d2b(0x1ea)]({'email':_0x2050e6['email']});}const _0x20c84=await master_shop[_0x111d2b(0x1f1)]();let _0x53361d;if(_0x2050e6['role']=='staff'){const _0x2f7261=await staff[_0x111d2b(0x1ea)]({'email':_0x2050e6[_0x111d2b(0x16a)]});_0x53361d=await purchases_finished[_0x111d2b(0x1ae)]([{'$match':{'warehouse_name':_0x2f7261['warehouse']}},{'$lookup':{'from':_0x111d2b(0x18b),'localField':_0x111d2b(0x18b),'foreignField':_0x111d2b(0x1e1),'as':'suppliers_docs'}},{'$unwind':_0x111d2b(0x1af)},{'$unwind':_0x111d2b(0x15b)},{'$group':{'_id':'$_id','invoice':{'$first':_0x111d2b(0x1df)},'suppliers':{'$first':_0x111d2b(0x114)},'date':{'$first':_0x111d2b(0x13c)},'warehouse_name':{'$first':_0x111d2b(0x1cc)},'room':{'$first':_0x111d2b(0x1c4)},'product':{'$push':_0x111d2b(0x15b)},'note':{'$first':_0x111d2b(0x1a9)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x111d2b(0x149)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x111d2b(0x1ac)},'expiry_date':{'$first':_0x111d2b(0x16b)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x111d2b(0x16d)},'level':{'$addToSet':_0x111d2b(0x124)},'isle':{'$addToSet':_0x111d2b(0x111)},'type':{'$addToSet':_0x111d2b(0x1a8)},'floorlevel':{'$addToSet':_0x111d2b(0x1c7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x53361d=await purchases_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0x111d2b(0x140),'invoice':{'$first':_0x111d2b(0x1df)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x111d2b(0x13c)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x111d2b(0x130)},'product':{'$push':_0x111d2b(0x15b)},'note':{'$first':_0x111d2b(0x1a9)},'paid_amount':{'$first':_0x111d2b(0x185)},'due_amount':{'$first':_0x111d2b(0x149)},'return_data':{'$first':_0x111d2b(0x118)},'batch_code':{'$first':_0x111d2b(0x1ac)},'expiry_date':{'$first':_0x111d2b(0x16b)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x111d2b(0x16d)},'level':{'$addToSet':_0x111d2b(0x124)},'isle':{'$addToSet':_0x111d2b(0x111)},'type':{'$addToSet':_0x111d2b(0x1a8)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x20c84[0x0][_0x111d2b(0x13b)]==_0x111d2b(0x1f9))var _0xb6a43d=users[_0x111d2b(0x10c)];else{if(_0x20c84[0x0][_0x111d2b(0x13b)]==_0x111d2b(0x142))var _0xb6a43d=users[_0x111d2b(0x142)];else{if(_0x20c84[0x0]['language']==_0x111d2b(0x19f))var _0xb6a43d=users['German'];else{if(_0x20c84[0x0][_0x111d2b(0x13b)]=='Spanish')var _0xb6a43d=users[_0x111d2b(0x1db)];else{if(_0x20c84[0x0]['language']==_0x111d2b(0x1ab))var _0xb6a43d=users[_0x111d2b(0x1ab)];else{if(_0x20c84[0x0][_0x111d2b(0x13b)]==_0x111d2b(0x202))var _0xb6a43d=users[_0x111d2b(0x1fa)];else{if(_0x20c84[0x0]['language']==_0x111d2b(0x163))var _0xb6a43d=users['Chinese'];else{if(_0x20c84[0x0][_0x111d2b(0x13b)]=='Arabic\x20(ae)')var _0xb6a43d=users['Arabic'];}}}}}}}_0x1ef838['render'](_0x111d2b(0x1dd),{'success':_0x2a9066['flash']('success'),'errors':_0x2a9066[_0x111d2b(0x1be)](_0x111d2b(0x198)),'purchases':_0x53361d,'role':_0x2050e6,'profile':_0x2b70e1,'master_shop':_0x20c84,'language':_0xb6a43d});}catch(_0x374cee){console['log']('table\x20page',_0x374cee),_0x1ef838[_0x111d2b(0x203)](0xc8)[_0x111d2b(0x1ca)]({'message':_0x374cee[_0x111d2b(0x144)]});}});function BayBinSelected(_0x3251da,_0x50e480){var _0x12e6e6=a0_0x2ecaf4,_0x123aad=[],_0x2c08ad=[];if(_0x3251da==_0x12e6e6(0x138)){switch(_0x50e480){case _0x12e6e6(0x128):_0x123aad=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x12e6e6(0x183):_0x123aad=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2c08ad=['DG'];}else{if(_0x3251da==_0x12e6e6(0x196)){switch(_0x50e480){case _0x12e6e6(0x128):_0x123aad=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x12e6e6(0x183):_0x123aad=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2c08ad=['FG'];}}return{'levels':_0x123aad,'identify':_0x2c08ad};}async function getRandom8DigitNumber(){var _0x1f6da7=a0_0x2ecaf4;const _0x4f5d25=0x989680,_0x133ac5=0x5f5e0ff,_0x17ca68=Math[_0x1f6da7(0x125)](Math[_0x1f6da7(0x1a6)]()*(_0x133ac5-_0x4f5d25+0x1))+_0x4f5d25;var _0x214126;const _0x15f2fb=await purchases_finished[_0x1f6da7(0x1ea)]({'invoice':'INCF-'+_0x17ca68});return _0x15f2fb&&_0x15f2fb[_0x1f6da7(0x18a)]>0x0?_0x214126=_0x1f6da7(0x201)+_0x17ca68:_0x214126=_0x1f6da7(0x201)+_0x17ca68,_0x214126;}router[a0_0x2ecaf4(0x1cf)]('/view/add_purchases',auth,async(_0xa73f6,_0x1598de)=>{var _0x2009db=a0_0x2ecaf4;try{const {username:_0x7fe01c,email:_0x5c5458,role:_0x339977}=_0xa73f6[_0x2009db(0x1d3)],_0x339743=_0xa73f6[_0x2009db(0x1d3)],_0x1052ad=await profile['findOne']({'email':_0x339743[_0x2009db(0x16a)]}),_0x938003=await master_shop[_0x2009db(0x1f1)](),_0x2d9874=await staff[_0x2009db(0x1ea)]({'email':_0x339743[_0x2009db(0x16a)]}),_0x326698=await suppliers[_0x2009db(0x1f1)]({});let _0x499cc5;if(_0x339743[_0x2009db(0x1ff)]==_0x2009db(0x171)){const _0x2758f1=await staff[_0x2009db(0x1ea)]({'email':_0x339743[_0x2009db(0x16a)]});_0x499cc5=await warehouse[_0x2009db(0x1ae)]([{'$match':{'status':_0x2009db(0x191),'name':_0x2758f1[_0x2009db(0x1d4)],'warehouse_category':_0x2009db(0x1fb)}},{'$group':{'_id':_0x2009db(0x1c3),'name':{'$first':'$name'}}}]);}else _0x499cc5=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x2009db(0x1fb),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x2009db(0x1c3),'name':{'$first':_0x2009db(0x1c3)}}}]);const _0x59c7fc=await product[_0x2009db(0x1f1)]({}),_0x37994a=await warehouse[_0x2009db(0x1f1)]({'status':_0x2009db(0x191)}),_0x4ca85c=await purchases_finished['find']({}),_0x23a346=_0x4ca85c[_0x2009db(0x18a)]+0x1,_0x3c8b02=_0x2009db(0x201)+_0x23a346[_0x2009db(0x1e6)]()[_0x2009db(0x109)](0x5,'0');var _0x2f1f7a=[_0x2009db(0x134),'Enclosed'];if(_0x938003[0x0][_0x2009db(0x13b)]==_0x2009db(0x1f9))var _0x41fec3=users[_0x2009db(0x10c)];else{if(_0x938003[0x0]['language']==_0x2009db(0x142))var _0x41fec3=users[_0x2009db(0x142)];else{if(_0x938003[0x0]['language']=='German')var _0x41fec3=users[_0x2009db(0x19f)];else{if(_0x938003[0x0][_0x2009db(0x13b)]==_0x2009db(0x1db))var _0x41fec3=users[_0x2009db(0x1db)];else{if(_0x938003[0x0][_0x2009db(0x13b)]==_0x2009db(0x1ab))var _0x41fec3=users['French'];else{if(_0x938003[0x0][_0x2009db(0x13b)]=='Portuguese\x20(BR)')var _0x41fec3=users[_0x2009db(0x1fa)];else{if(_0x938003[0x0]['language']=='Chinese')var _0x41fec3=users['Chinese'];else{if(_0x938003[0x0]['language']==_0x2009db(0x11d))var _0x41fec3=users[_0x2009db(0x194)];}}}}}}}const _0x480a9d=getRandom8DigitNumber();_0x480a9d[_0x2009db(0x170)](_0x6897f6=>{var _0x3883b4=_0x2009db;_0x1598de[_0x3883b4(0x12d)](_0x3883b4(0x11e),{'success':_0xa73f6['flash'](_0x3883b4(0x1d0)),'errors':_0xa73f6[_0x3883b4(0x1be)](_0x3883b4(0x198)),'role':_0x339743,'profile':_0x1052ad,'suppliers':_0x326698,'warehouse':_0x499cc5,'product':_0x59c7fc,'invoice':_0x6897f6,'master_shop':_0x938003,'language':_0x41fec3,'find_data':_0x37994a,'rooms_data':_0x2f1f7a});})[_0x2009db(0x186)](_0x343fc4=>{var _0x54e65d=_0x2009db;_0xa73f6['flash'](_0x54e65d(0x198),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1598de['redirect'](_0x54e65d(0x1d2));});}catch(_0x196027){console[_0x2009db(0x12b)](_0x196027);}}),router[a0_0x2ecaf4(0x1cf)]('/view/add_purchases/:id',auth,async(_0x32418b,_0x3c5052)=>{var _0x21934c=a0_0x2ecaf4;try{const _0x5eaaa4=_0x32418b[_0x21934c(0x1d1)]['id'];console['log'](_0x5eaaa4);const _0x3cb29d=await master_shop[_0x21934c(0x1f1)]();console[_0x21934c(0x12b)](_0x21934c(0x169),_0x3cb29d);const _0x246077=await product[_0x21934c(0x1ea)]({'name':_0x5eaaa4});console[_0x21934c(0x12b)](_0x21934c(0x14f),_0x246077),_0x3c5052['status'](0xc8)['json']({'product_data':_0x246077,'master':_0x3cb29d});}catch(_0x222f79){console[_0x21934c(0x12b)](_0x21934c(0x1ed),_0x222f79);}}),router['post']('/view/add_purchases',auth,async(_0xebe187,_0x203b66)=>{var _0x4b9b35=a0_0x2ecaf4;try{const {invoice:_0x4c76f3,date:_0xef4b80,warehouse_name:_0x180e9f,prod_name:_0x2a032f,prod_code:_0x40f79e,prod_qty:_0x594ca2,prod_unit:_0x29fae1,prod_secondunit:_0x3800c1,prod_level:_0x100e22,prod_isle:_0x2623cb,prod_pallet:_0x4a6603,note:_0xaa001f,expiry_date:_0xb4b7ce,batch_code:_0x4494a4,payable:_0x18af6e,due_amount:_0x485b47,Room_name:_0x19ca13,primary_code:_0x50d2ff,secondary_code:_0x1110f4,MaxStocks_data:_0x32d98c,PO_number:_0x380908,SCRN:_0x4e124f,JO_number:_0x42115b}=_0xebe187['body'];if(typeof _0x2a032f==_0x4b9b35(0x1da))var _0x56132f=[_0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x157)]],_0x270deb=[_0xebe187[_0x4b9b35(0x11f)]['prod_code']],_0x3f7749=[_0xebe187[_0x4b9b35(0x11f)]['prod_Qty']],_0x3f63a6=[_0xebe187[_0x4b9b35(0x11f)]['prod_primunit']],_0x268767=[_0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x19a)]],_0x3d9ca6=[_0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x1d9)]],_0x4b8c9e=[_0xebe187['body'][_0x4b9b35(0x158)]],_0x207be4=[_0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x159)]],_0x19fea2=[_0xebe187['body'][_0x4b9b35(0x15d)]],_0x50afce=[_0xebe187[_0x4b9b35(0x11f)]['batch_code']],_0x549ef9=[_0xebe187['body'][_0x4b9b35(0x167)]],_0x3b425a=[_0xebe187[_0x4b9b35(0x11f)]['product_date']],_0x12f7c6=[_0xebe187[_0x4b9b35(0x11f)]['max_product_unit']],_0x3bf7dd=[_0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x1f5)]],_0x19059b=[_0xebe187['body'][_0x4b9b35(0x1c6)]],_0x1e6341=[_0xebe187['body']['prod_invoice']];else var _0x56132f=[..._0xebe187['body'][_0x4b9b35(0x157)]],_0x270deb=[..._0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x177)]],_0x3f7749=[..._0xebe187[_0x4b9b35(0x11f)]['prod_Qty']],_0x3f63a6=[..._0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x12e)]],_0x268767=[..._0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x19a)]],_0x3d9ca6=[..._0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x1d9)]],_0x4b8c9e=[..._0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x158)]],_0x207be4=[..._0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x159)]],_0x19fea2=[..._0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x15d)]],_0x50afce=[..._0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x10a)]],_0x549ef9=[..._0xebe187[_0x4b9b35(0x11f)]['expiry_date']],_0x3b425a=[..._0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x1b0)]],_0x12f7c6=[..._0xebe187['body'][_0x4b9b35(0x15f)]],_0x3bf7dd=[..._0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x1f5)]],_0x19059b=[..._0xebe187['body'][_0x4b9b35(0x1c6)]],_0x1e6341=[..._0xebe187[_0x4b9b35(0x11f)]['prod_invoice']];const _0x4b9342=_0x56132f[_0x4b9b35(0x188)](_0x1bf854=>{return _0x1bf854={'product_name':_0x1bf854};});_0x270deb[_0x4b9b35(0x1f2)]((_0x216dc1,_0x526f5f)=>{var _0x3b794d=_0x4b9b35;_0x4b9342[_0x526f5f][_0x3b794d(0x137)]=_0x216dc1;}),_0x3f7749['forEach']((_0x2feab0,_0x7a519d)=>{var _0x52a2a8=_0x4b9b35;_0x4b9342[_0x7a519d][_0x52a2a8(0x1b6)]=Math[_0x52a2a8(0x145)](_0x2feab0);}),_0x3f63a6[_0x4b9b35(0x1f2)]((_0x5201ff,_0x12db72)=>{var _0x2cc392=_0x4b9b35;_0x4b9342[_0x12db72][_0x2cc392(0x1e2)]=_0x5201ff;}),_0x268767[_0x4b9b35(0x1f2)]((_0x1a405e,_0x56f6b6)=>{_0x4b9342[_0x56f6b6]['secondary_unit']=_0x1a405e;}),_0x3d9ca6[_0x4b9b35(0x1f2)]((_0x30add8,_0x136c6b)=>{_0x4b9342[_0x136c6b]['bay']=_0x30add8;}),_0x4b8c9e[_0x4b9b35(0x1f2)]((_0x5a0b1f,_0x1ce047)=>{var _0xf3fd6c=_0x4b9b35;_0x4b9342[_0x1ce047][_0xf3fd6c(0x158)]=_0x5a0b1f;}),_0x207be4[_0x4b9b35(0x1f2)]((_0x4697c5,_0x3dadc2)=>{_0x4b9342[_0x3dadc2]['secondary_code']=_0x4697c5;}),_0x19fea2[_0x4b9b35(0x1f2)]((_0x5a7c24,_0x53e1b1)=>{var _0x548533=_0x4b9b35;_0x4b9342[_0x53e1b1][_0x548533(0x139)]=_0x5a7c24;}),_0x50afce[_0x4b9b35(0x1f2)]((_0xb49ca8,_0x5e3a6f)=>{_0x4b9342[_0x5e3a6f]['batch_code']=_0xb49ca8;}),_0x549ef9['forEach']((_0x15f96c,_0x22a4b2)=>{var _0x15e144=_0x4b9b35;_0x4b9342[_0x22a4b2][_0x15e144(0x167)]=_0x15f96c;}),_0x3b425a['forEach']((_0x1ebd18,_0x25fe02)=>{var _0x4b20c7=_0x4b9b35;_0x4b9342[_0x25fe02][_0x4b20c7(0x166)]=_0x1ebd18;}),_0x12f7c6[_0x4b9b35(0x1f2)]((_0x19db4e,_0x1cd890)=>{var _0x2f2f3d=_0x4b9b35;_0x4b9342[_0x1cd890][_0x2f2f3d(0x1f4)]=_0x19db4e;}),_0x3bf7dd[_0x4b9b35(0x1f2)]((_0x40e809,_0x4ca1f2)=>{var _0x129b3b=_0x4b9b35;_0x4b9342[_0x4ca1f2][_0x129b3b(0x199)]=_0x40e809;}),_0x19059b[_0x4b9b35(0x1f2)]((_0x296ccd,_0x402edb)=>{var _0x38bf67=_0x4b9b35;_0x4b9342[_0x402edb][_0x38bf67(0x164)]=_0x296ccd;}),_0x1e6341[_0x4b9b35(0x1f2)]((_0x587e72,_0x5935de)=>{_0x4b9342[_0x5935de]['invoice']=_0x587e72;});const _0x2bd42c=_0x4b9342[_0x4b9b35(0x15e)](_0x55b662=>_0x55b662[_0x4b9b35(0x1b6)]!=='0'&&_0x55b662[_0x4b9b35(0x1b6)]!==''),_0x435eca=new purchases_finished({'invoice':_0x4c76f3,'suppliers':_0xebe187[_0x4b9b35(0x11f)][_0x4b9b35(0x18b)],'date':_0xef4b80,'warehouse_name':_0x180e9f,'product':_0x2bd42c,'note':_0xaa001f,'due_amount':_0x485b47,'room':_0x19ca13,'POnumber':_0x380908,'SCRN':_0x4e124f,'JO_number':_0x42115b}),_0x4769ff=await _0x435eca[_0x4b9b35(0x1fc)](),_0x54178e=await purchases_finished['findOne']({'invoice':_0x4c76f3}),_0x49a356=_0x54178e[_0x4b9b35(0x14f)][_0x4b9b35(0x188)](async _0xad383a=>{var _0x248801=_0x4b9b35;try{var _0x217847=await warehouse['findOne']({'name':_0x180e9f,'room':_0xad383a[_0x248801(0x164)]}),_0x2ee642=0x0;const _0x385e6d=_0x217847[_0x248801(0x200)][_0x248801(0x188)](_0x4b1ca1=>{var _0x3c4315=_0x248801;console[_0x3c4315(0x12b)](_0x4b1ca1['product_name']+'=='+_0xad383a['product_name']+'&&'+_0x4b1ca1[_0x3c4315(0x110)]+'=='+_0xad383a['bay']+'&&'+_0x4b1ca1[_0x3c4315(0x167)]+'=='+_0xad383a[_0x3c4315(0x167)]+'&&'+_0x4b1ca1['production_date']+'=='+_0xad383a[_0x3c4315(0x166)]+'&&'+_0x4b1ca1[_0x3c4315(0x10a)]+'=='+_0xad383a[_0x3c4315(0x10a)]+'&&'+_0x4b1ca1[_0x3c4315(0x17d)]+'=='+_0x54178e[_0x3c4315(0x17d)]),_0x4b1ca1[_0x3c4315(0x18d)]==_0xad383a[_0x3c4315(0x18d)]&&_0x4b1ca1[_0x3c4315(0x110)]==_0xad383a[_0x3c4315(0x110)]&&_0x4b1ca1['expiry_date']==_0xad383a[_0x3c4315(0x167)]&&_0x4b1ca1[_0x3c4315(0x166)]==_0xad383a[_0x3c4315(0x166)]&&_0x4b1ca1[_0x3c4315(0x10a)]==_0xad383a[_0x3c4315(0x10a)]&&_0x4b1ca1['invoice']==_0x54178e['invoice']&&(_0x4b1ca1[_0x3c4315(0x12c)]=Math[_0x3c4315(0x145)](_0x4b1ca1[_0x3c4315(0x12c)])+Math['abs'](_0xad383a[_0x3c4315(0x1b6)]),_0x2ee642++);});return _0x2ee642==0x0&&(_0x217847[_0x248801(0x200)]=_0x217847['product_details'][_0x248801(0x1e9)]({'product_name':_0xad383a['product_name'],'product_stock':Math[_0x248801(0x145)](_0xad383a[_0x248801(0x1b6)]),'primary_code':_0xad383a[_0x248801(0x158)],'secondary_code':_0xad383a['secondary_code'],'product_code':_0xad383a['product_code'],'bay':_0xad383a[_0x248801(0x110)],'maxProducts':_0xad383a[_0x248801(0x139)],'unit':_0xad383a[_0x248801(0x1e2)],'secondary_unit':_0xad383a[_0x248801(0x13f)],'expiry_date':_0xad383a[_0x248801(0x167)],'production_date':_0xad383a[_0x248801(0x166)],'maxProducts':_0xad383a[_0x248801(0x139)],'maxPerUnit':_0xad383a[_0x248801(0x1f4)],'batch_code':_0xad383a['batch_code'],'product_cat':_0xad383a['product_cat'],'invoice':_0xad383a[_0x248801(0x17d)],'id_incoming':_0xad383a['_id']})),_0x217847;}catch(_0x1a93a6){return console[_0x248801(0x117)]('Error\x20occurred\x20while\x20processing\x20product:',_0x1a93a6),null;}});Promise['all'](_0x49a356)[_0x4b9b35(0x170)](async _0xec45c3=>{var _0x16f0a1=_0x4b9b35;try{for(const _0x51be54 of _0xec45c3){await warehouse['updateOne']({'_id':_0x51be54[_0x16f0a1(0x1f3)]},{'$addToSet':{'product_details':{'$each':_0x51be54[_0x16f0a1(0x200)]}}});}const _0x1c5985=await master_shop[_0x16f0a1(0x1f1)](),_0x28e413=await email_settings[_0x16f0a1(0x1ea)](),_0x2aff0c=await supervisor_settings[_0x16f0a1(0x1f1)]();var _0x537f21=_0x54178e['product'],_0x2866f4='',_0x4a9146;for(_0x4a9146 in _0x537f21){var _0x5d8ac0='FG';_0x54178e[_0x16f0a1(0x13e)]=='DRY\x20GOODS'&&(_0x5d8ac0='DG'),_0x2866f4+=_0x16f0a1(0x18e)+_0x16f0a1(0x19e)+_0x537f21[_0x4a9146]['product_name']+'</td>'+_0x16f0a1(0x19e)+_0x537f21[_0x4a9146]['product_code']+_0x16f0a1(0x10f)+_0x16f0a1(0x19e)+_0x537f21[_0x4a9146][_0x16f0a1(0x1b6)]+'</td>'+_0x16f0a1(0x19e)+_0x537f21[_0x4a9146]['standard_unit']+_0x16f0a1(0x10f)+_0x16f0a1(0x19e)+_0x537f21[_0x4a9146]['secondary_unit']+'</td>'+_0x16f0a1(0x19e)+_0x54178e[_0x16f0a1(0x13e)]+'</td>'+_0x16f0a1(0x19e)+_0x537f21[_0x4a9146][_0x16f0a1(0x164)]+'</td>'+_0x16f0a1(0x19e)+_0x5d8ac0+_0x537f21[_0x4a9146][_0x16f0a1(0x110)]+_0x16f0a1(0x10f),'</tr>';}let _0x5d97ce=nodemailer[_0x16f0a1(0x133)]({'host':_0x28e413[_0x16f0a1(0x1a3)],'port':Number(_0x28e413[_0x16f0a1(0x119)]),'secure':![],'auth':{'user':_0x28e413[_0x16f0a1(0x16a)],'pass':_0x28e413[_0x16f0a1(0x1e0)]}}),_0x3a5a72={'from':_0x28e413[_0x16f0a1(0x16a)],'to':_0x2aff0c[0x0]['FGSEmail'],'subject':_0x16f0a1(0x1a4),'attachments':[{'filename':_0x16f0a1(0x127),'path':__dirname+_0x16f0a1(0x15c)+'/upload/'+_0x1c5985[0x0]['image'],'cid':_0x16f0a1(0x193)}],'html':_0x16f0a1(0x16e)+_0x16f0a1(0x16c)+_0x16f0a1(0x17f)+_0x16f0a1(0x18f)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x16f0a1(0x176)+_0x16f0a1(0x1d7)+_0x16f0a1(0x18f)+_0x16f0a1(0x14d)+_0x1c5985[0x0]['site_title']+_0x16f0a1(0x11c)+_0x16f0a1(0x1d7)+'</div>'+_0x16f0a1(0x141)+'<div>'+_0x16f0a1(0x1ba)+_0x16f0a1(0x14b)+_0x54178e[_0x16f0a1(0x17d)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x16f0a1(0x17a)+_0x54178e[_0x16f0a1(0x143)]+'\x20'+_0x16f0a1(0x1b8)+_0x16f0a1(0x11a)+_0x16f0a1(0x1d7)+_0x16f0a1(0x1e8)+_0x16f0a1(0x13d)+'<tr>'+_0x16f0a1(0x1bd)+_0x16f0a1(0x182)+_0x16f0a1(0x17b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x16f0a1(0x1f6)+_0x16f0a1(0x1c1)+_0x16f0a1(0x115)+_0x16f0a1(0x1eb)+_0x16f0a1(0x14e)+'\x20'+_0x2866f4+'\x20'+'</tbody>'+_0x16f0a1(0x178)+'<div>'+_0x16f0a1(0x175)+_0x16f0a1(0x197)+_0x1c5985[0x0][_0x16f0a1(0x19b)]+'</h5>'+'</div>'+_0x16f0a1(0x1d7)+'</body></html>'};_0x5d97ce['sendMail'](_0x3a5a72,function(_0x1991de,_0x4ded38){var _0x44ceac=_0x16f0a1;_0x1991de?(console['log'](_0x1991de),console['log']('Error\x20Occurs')):console[_0x44ceac(0x12b)](_0x44ceac(0x1b7));});}catch(_0x6e08ff){console[_0x16f0a1(0x117)](_0x6e08ff),_0x203b66['status'](0x1f4)[_0x16f0a1(0x1ca)]({'error':_0x16f0a1(0x10d),'message':_0x6e08ff[_0x16f0a1(0x144)]});}})['catch'](_0x274422=>{var _0x2f2156=_0x4b9b35;console[_0x2f2156(0x117)](_0x274422);}),_0xebe187[_0x4b9b35(0x1be)](_0x4b9b35(0x1d0),_0x4b9b35(0x123)),_0x203b66[_0x4b9b35(0x14a)](_0x4b9b35(0x1d2));}catch(_0x17a6e3){console['log'](_0x17a6e3);}}),router[a0_0x2ecaf4(0x1cf)]('/preview/:id',auth,async(_0x17c7c3,_0x5d1443)=>{var _0x1e2092=a0_0x2ecaf4;try{const {username:_0x17ce30,email:_0x1144ec,role:_0x527ea}=_0x17c7c3[_0x1e2092(0x1d3)],_0x58390f=_0x17c7c3[_0x1e2092(0x1d3)],_0x16ef3a=await profile[_0x1e2092(0x1ea)]({'email':_0x58390f['email']}),_0x239e65=await master_shop['find'](),_0x2d611b=_0x17c7c3[_0x1e2092(0x1d1)]['id'],_0x33b816=await purchases_finished[_0x1e2092(0x1bb)](_0x2d611b),_0x350ffd=await suppliers['find']({});let _0x406760;if(_0x58390f['role']=='staff'){const _0x4089b7=await staff['findOne']({'email':_0x58390f[_0x1e2092(0x16a)]});_0x406760=await warehouse[_0x1e2092(0x1f1)]({'status':_0x1e2092(0x191),'name':_0x4089b7[_0x1e2092(0x1d4)],'warehouse_category':_0x1e2092(0x1fb)});}else _0x406760=await warehouse['aggregate']([{'$match':{'status':_0x1e2092(0x191),'warehouse_category':_0x1e2092(0x1fb)}},{'$group':{'_id':_0x1e2092(0x1c3),'name':{'$first':_0x1e2092(0x1c3)}}}]);const _0x23573d=await product[_0x1e2092(0x1f1)]({}),_0x1a69f7=BayBinSelected(_0x33b816['warehouse_name'],_0x33b816[_0x1e2092(0x190)]);let _0x79cf1a=new Date(_0x33b816[_0x1e2092(0x167)]),_0x397745=('0'+_0x79cf1a[_0x1e2092(0x174)]())[_0x1e2092(0x12f)](-0x2),_0x481542=('0'+(_0x79cf1a[_0x1e2092(0x1fd)]()+0x1))[_0x1e2092(0x12f)](-0x2),_0xb626a4=_0x79cf1a['getFullYear'](),_0x513844=_0xb626a4+'-'+_0x481542+'-'+_0x397745;if(_0x239e65[0x0][_0x1e2092(0x13b)]=='English\x20(US)'){var _0xffdaf7=users[_0x1e2092(0x10c)];console['log'](_0xffdaf7);}else{if(_0x239e65[0x0][_0x1e2092(0x13b)]==_0x1e2092(0x142))var _0xffdaf7=users[_0x1e2092(0x142)];else{if(_0x239e65[0x0]['language']==_0x1e2092(0x19f))var _0xffdaf7=users[_0x1e2092(0x19f)];else{if(_0x239e65[0x0]['language']==_0x1e2092(0x1db))var _0xffdaf7=users[_0x1e2092(0x1db)];else{if(_0x239e65[0x0][_0x1e2092(0x13b)]=='French')var _0xffdaf7=users['French'];else{if(_0x239e65[0x0][_0x1e2092(0x13b)]=='Portuguese\x20(BR)')var _0xffdaf7=users[_0x1e2092(0x1fa)];else{if(_0x239e65[0x0][_0x1e2092(0x13b)]==_0x1e2092(0x163))var _0xffdaf7=users[_0x1e2092(0x163)];else{if(_0x239e65[0x0]['language']==_0x1e2092(0x11d))var _0xffdaf7=users['Arabic'];}}}}}}}_0x5d1443[_0x1e2092(0x12d)]('edit_purchases_finished_view',{'success':_0x17c7c3[_0x1e2092(0x1be)]('success'),'errors':_0x17c7c3[_0x1e2092(0x1be)](_0x1e2092(0x198)),'role':_0x58390f,'profile':_0x16ef3a,'purchases':_0x33b816,'suppliers':_0x350ffd,'warehouse':_0x406760,'product':_0x23573d,'master_shop':_0x239e65,'language':_0xffdaf7,'ed_fullDate':_0x513844,'dataSelected':_0x1a69f7});}catch(_0x83b7d7){console[_0x1e2092(0x12b)](_0x83b7d7);}}),router[a0_0x2ecaf4(0x1cf)]('/view/:id',auth,async(_0x5ccbf1,_0x1ab92c)=>{var _0x3a87f6=a0_0x2ecaf4;try{const {username:_0x2688e8,email:_0x4f49d5,role:_0x4d8c64}=_0x5ccbf1[_0x3a87f6(0x1d3)],_0x614fd9=_0x5ccbf1[_0x3a87f6(0x1d3)],_0xa18d13=await profile['findOne']({'email':_0x614fd9[_0x3a87f6(0x16a)]}),_0x247c0c=await master_shop[_0x3a87f6(0x1f1)](),_0x386116=_0x5ccbf1[_0x3a87f6(0x1d1)]['id'],_0x12bcbd=await purchases_finished[_0x3a87f6(0x1bb)](_0x386116),_0xc52f73=await suppliers[_0x3a87f6(0x1f1)]({});let _0x1bb2dd;if(_0x614fd9[_0x3a87f6(0x1ff)]==_0x3a87f6(0x171)){const _0x3d0a67=await staff[_0x3a87f6(0x1ea)]({'email':_0x614fd9[_0x3a87f6(0x16a)]});_0x1bb2dd=await warehouse[_0x3a87f6(0x1f1)]({'status':'Enabled','name':_0x3d0a67[_0x3a87f6(0x1d4)],'warehouse_category':'Finished\x20Goods'});}else _0x1bb2dd=await warehouse[_0x3a87f6(0x1ae)]([{'$match':{'status':_0x3a87f6(0x191),'warehouse_category':_0x3a87f6(0x1fb)}},{'$group':{'_id':_0x3a87f6(0x1c3),'name':{'$first':_0x3a87f6(0x1c3)}}}]);const _0x46d8f4=await product[_0x3a87f6(0x1f1)]({}),_0x3357ae=BayBinSelected(_0x12bcbd['warehouse_name'],_0x12bcbd[_0x3a87f6(0x190)]);let _0x46c252=new Date(_0x12bcbd['expiry_date']),_0x37a2cd=('0'+_0x46c252[_0x3a87f6(0x174)]())[_0x3a87f6(0x12f)](-0x2),_0x1e9b83=('0'+(_0x46c252['getMonth']()+0x1))[_0x3a87f6(0x12f)](-0x2),_0x25c511=_0x46c252[_0x3a87f6(0x1a0)](),_0x2e1305=_0x25c511+'-'+_0x1e9b83+'-'+_0x37a2cd;if(_0x247c0c[0x0][_0x3a87f6(0x13b)]==_0x3a87f6(0x1f9)){var _0x21512d=users['English'];console[_0x3a87f6(0x12b)](_0x21512d);}else{if(_0x247c0c[0x0][_0x3a87f6(0x13b)]=='Hindi')var _0x21512d=users['Hindi'];else{if(_0x247c0c[0x0][_0x3a87f6(0x13b)]==_0x3a87f6(0x19f))var _0x21512d=users[_0x3a87f6(0x19f)];else{if(_0x247c0c[0x0][_0x3a87f6(0x13b)]=='Spanish')var _0x21512d=users['Spanish'];else{if(_0x247c0c[0x0][_0x3a87f6(0x13b)]==_0x3a87f6(0x1ab))var _0x21512d=users[_0x3a87f6(0x1ab)];else{if(_0x247c0c[0x0][_0x3a87f6(0x13b)]==_0x3a87f6(0x202))var _0x21512d=users[_0x3a87f6(0x1fa)];else{if(_0x247c0c[0x0][_0x3a87f6(0x13b)]==_0x3a87f6(0x163))var _0x21512d=users[_0x3a87f6(0x163)];else{if(_0x247c0c[0x0]['language']=='Arabic\x20(ae)')var _0x21512d=users[_0x3a87f6(0x194)];}}}}}}}_0x1ab92c[_0x3a87f6(0x12d)](_0x3a87f6(0x189),{'success':_0x5ccbf1['flash'](_0x3a87f6(0x1d0)),'errors':_0x5ccbf1['flash'](_0x3a87f6(0x198)),'role':_0x614fd9,'profile':_0xa18d13,'purchases':_0x12bcbd,'suppliers':_0xc52f73,'warehouse':_0x1bb2dd,'product':_0x46d8f4,'master_shop':_0x247c0c,'language':_0x21512d,'ed_fullDate':_0x2e1305,'dataSelected':_0x3357ae});}catch(_0x2e3fad){console[_0x3a87f6(0x12b)](_0x2e3fad);}}),router[a0_0x2ecaf4(0x1c5)](a0_0x2ecaf4(0x1e4),auth,async(_0x180014,_0x2f1eb2)=>{var _0x367676=a0_0x2ecaf4;try{const _0x4cd01a=_0x180014['params']['id'],_0xbcf942=await purchases_finished[_0x367676(0x1ea)]({'_id':_0x180014['params']['id']}),_0x51dbbd=await warehouse['findOne']({'name':_0xbcf942[_0x367676(0x13e)],'room':_0xbcf942[_0x367676(0x190)]});_0xbcf942['product'][_0x367676(0x1f2)](_0x21bcd5=>{var _0x2ca7b6=_0x367676;const _0x50a514=_0x51dbbd[_0x2ca7b6(0x200)][_0x2ca7b6(0x188)](_0x26bb3e=>{var _0x5d8563=_0x2ca7b6;_0x26bb3e[_0x5d8563(0x18d)]==_0x21bcd5[_0x5d8563(0x18d)]&&_0x26bb3e[_0x5d8563(0x110)]==_0x21bcd5[_0x5d8563(0x110)]&&(_0x26bb3e[_0x5d8563(0x12c)]=parseInt(_0x26bb3e['product_stock'])-parseInt(_0x21bcd5[_0x5d8563(0x1b6)]));});}),await _0x51dbbd[_0x367676(0x1fc)]();const {invoice:_0x2513d1,suppliers:_0x5b1cd7,date:_0x2fda85,warehouse_name:_0x3410ab,prod_name:_0x39d2f4,prod_code:_0xd12a7c,prod_qty:_0x4d1a1f,prod_unit:_0x5d58a6,prod_secondunit:_0x5093c9,prod_level:_0x14deb0,prod_isle:_0x31b19e,prod_pallet:_0x3c6d0a,note:_0x26f840,expiry_date:_0x23c24c,batch_code:_0x47fc08,paid_amount:_0x2d74f1,due_amount:_0xbb97d,Room_name:_0x2c67d8,primary_code:_0x459378,secondary_code:_0xd25c4,PO_number:_0x32264f,JO_number:_0x2f54bb}=_0x180014[_0x367676(0x11f)];if(typeof _0x39d2f4=='string')var _0x506dc4=[_0x180014[_0x367676(0x11f)][_0x367676(0x157)]],_0xdbd0b5=[_0x180014[_0x367676(0x11f)][_0x367676(0x177)]],_0x47d328=[_0x180014[_0x367676(0x11f)]['prod_qty']],_0x5b302e=[_0x180014[_0x367676(0x11f)][_0x367676(0x1f8)]],_0xcb7ee2=[_0x180014[_0x367676(0x11f)][_0x367676(0x19a)]],_0x486485=[_0x180014[_0x367676(0x11f)][_0x367676(0x1d9)]],_0x388eae=[_0x180014[_0x367676(0x11f)][_0x367676(0x158)]],_0x32e349=[_0x180014[_0x367676(0x11f)][_0x367676(0x159)]],_0x1cd93b=[_0x180014[_0x367676(0x11f)]['MaxStocks_data']],_0x5f26b2=[_0x180014[_0x367676(0x11f)][_0x367676(0x10a)]],_0x3461a2=[_0x180014[_0x367676(0x11f)][_0x367676(0x167)]];else var _0x506dc4=[..._0x180014[_0x367676(0x11f)][_0x367676(0x157)]],_0xdbd0b5=[..._0x180014[_0x367676(0x11f)][_0x367676(0x177)]],_0x47d328=[..._0x180014[_0x367676(0x11f)][_0x367676(0x116)]],_0x5b302e=[..._0x180014[_0x367676(0x11f)][_0x367676(0x1f8)]],_0xcb7ee2=[..._0x180014[_0x367676(0x11f)][_0x367676(0x19a)]],_0x486485=[..._0x180014['body'][_0x367676(0x1d9)]],_0x388eae=[..._0x180014[_0x367676(0x11f)]['primary_code']],_0x32e349=[..._0x180014[_0x367676(0x11f)][_0x367676(0x159)]],_0x1cd93b=[..._0x180014['body'][_0x367676(0x15d)]],_0x5f26b2=[..._0x180014[_0x367676(0x11f)][_0x367676(0x10a)]],_0x3461a2=[..._0x180014[_0x367676(0x11f)][_0x367676(0x167)]];const _0x10b278=_0x506dc4['map'](_0x46033c=>{return _0x46033c={'product_name':_0x46033c};});_0xdbd0b5[_0x367676(0x1f2)]((_0x4a12e3,_0x4f2234)=>{var _0xd83e74=_0x367676;_0x10b278[_0x4f2234][_0xd83e74(0x137)]=_0x4a12e3;}),_0x47d328[_0x367676(0x1f2)]((_0x16f714,_0x40323e)=>{_0x10b278[_0x40323e]['quantity']=_0x16f714;}),_0x5b302e['forEach']((_0x1658d9,_0x3a7045)=>{var _0x10ba20=_0x367676;_0x10b278[_0x3a7045][_0x10ba20(0x1e2)]=_0x1658d9;}),_0xcb7ee2[_0x367676(0x1f2)]((_0x57fd14,_0xb1ef6d)=>{var _0x23a98a=_0x367676;_0x10b278[_0xb1ef6d][_0x23a98a(0x13f)]=_0x57fd14;}),_0x486485[_0x367676(0x1f2)]((_0x5cc552,_0x34367a)=>{_0x10b278[_0x34367a]['bay']=_0x5cc552;}),_0x388eae[_0x367676(0x1f2)]((_0x332196,_0x36dcaf)=>{var _0x537a65=_0x367676;_0x10b278[_0x36dcaf][_0x537a65(0x158)]=_0x332196;}),_0x32e349[_0x367676(0x1f2)]((_0x55612b,_0x193e5f)=>{var _0x4bc2aa=_0x367676;_0x10b278[_0x193e5f][_0x4bc2aa(0x159)]=_0x55612b;}),_0x1cd93b[_0x367676(0x1f2)]((_0x57563d,_0x5361db)=>{var _0x233afa=_0x367676;_0x10b278[_0x5361db][_0x233afa(0x139)]=_0x57563d;}),_0x5f26b2[_0x367676(0x1f2)]((_0x1db8a9,_0x1d063d)=>{var _0xfb68f4=_0x367676;_0x10b278[_0x1d063d][_0xfb68f4(0x10a)]=_0x1db8a9;}),_0x3461a2['forEach']((_0x57cb6d,_0x92bfbf)=>{var _0x3ac441=_0x367676;_0x10b278[_0x92bfbf][_0x3ac441(0x167)]=_0x57cb6d;});const _0x284d8c=_0x10b278[_0x367676(0x15e)](_0x54678f=>_0x54678f[_0x367676(0x1b6)]!=='0'&&_0x54678f[_0x367676(0x1b6)]!=='');_0xbcf942[_0x367676(0x17d)]=_0x2513d1,_0xbcf942[_0x367676(0x18b)]=_0x5b1cd7,_0xbcf942[_0x367676(0x143)]=_0x2fda85,_0xbcf942['warehouse_name']=_0x3410ab,_0xbcf942[_0x367676(0x14f)]=_0x284d8c,_0xbcf942[_0x367676(0x132)]=_0x26f840,_0xbcf942[_0x367676(0x1f7)]=_0x2d74f1,_0xbcf942[_0x367676(0x150)]=_0xbb97d,_0xbcf942['room']=_0x2c67d8,_0xbcf942[_0x367676(0x1d5)]=_0x32264f,_0xbcf942[_0x367676(0x15a)]=_0x2f54bb;const _0x2b57c2=await _0xbcf942[_0x367676(0x1fc)](),_0x700bb2=await warehouse[_0x367676(0x1ea)]({'name':_0x180014[_0x367676(0x11f)]['warehouse_name'],'room':_0x180014['body'][_0x367676(0x1dc)]});_0xbcf942[_0x367676(0x14f)][_0x367676(0x1f2)](_0x46b75a=>{var _0x11413b=_0x367676,_0x5e7600=0x0;const _0x10e4f4=_0x700bb2[_0x11413b(0x200)]['map'](_0xd5ce19=>{var _0x31da2f=_0x11413b;_0xd5ce19[_0x31da2f(0x18d)]==_0x46b75a[_0x31da2f(0x18d)]&&_0xd5ce19['bay']==_0x46b75a[_0x31da2f(0x110)]&&(_0xd5ce19[_0x31da2f(0x12c)]=parseInt(_0xd5ce19['product_stock'])+parseInt(_0x46b75a[_0x31da2f(0x1b6)]),_0x5e7600++);});_0x5e7600=='0'&&(_0x700bb2[_0x11413b(0x200)]=_0x700bb2['product_details'][_0x11413b(0x1e9)]({'product_name':_0x46b75a[_0x11413b(0x18d)],'product_stock':_0x46b75a[_0x11413b(0x1b6)],'primary_code':_0x46b75a[_0x11413b(0x158)],'secondary_code':_0x46b75a[_0x11413b(0x159)],'product_code':_0x46b75a['product_code'],'bay':_0x46b75a['bay'],'maxProducts':_0x46b75a[_0x11413b(0x139)],'unit':_0x46b75a['standard_unit'],'secondary_unit':_0x46b75a[_0x11413b(0x13f)],'expiry_date':_0x46b75a[_0x11413b(0x167)]}));}),await _0x700bb2['save']();const _0x46854d=await s_payment_data[_0x367676(0x1ea)]({'invoice':_0x180014[_0x367676(0x11f)]['invoice']});if(_0x46854d===null){}else console['log'](_0x367676(0x18b),_0x46854d,_0x180014['body'][_0x367676(0x17d)]),_0x46854d[_0x367676(0x18b)]=_0x180014['body']['suppliers'],await _0x46854d['save']();_0x180014[_0x367676(0x1be)](_0x367676(0x1d0),_0x367676(0x129)),_0x2f1eb2[_0x367676(0x14a)]('/all_purchases_finished/view');}catch(_0x32c879){console['log'](_0x32c879);}}),router['post']('/give_payment/:id',auth,async(_0x5a3497,_0x1ef6a7)=>{var _0x22cba1=a0_0x2ecaf4;try{const _0x73efe8=_0x5a3497[_0x22cba1(0x1d1)]['id'],{invoice:_0x5d31a6,suppliers:_0x537f04,payable:_0x36c77f,due_amount:_0x59ae99}=_0x5a3497[_0x22cba1(0x11f)],_0x3db6d4=await purchases['findById'](_0x73efe8);var _0x59ee92=_0x36c77f-_0x59ae99;_0x3db6d4[_0x22cba1(0x1f7)]=parseFloat(_0x3db6d4[_0x22cba1(0x1f7)])+parseFloat(_0x59ae99),_0x3db6d4[_0x22cba1(0x150)]=_0x59ee92;const _0xdb7bda=await _0x3db6d4[_0x22cba1(0x1fc)]();console[_0x22cba1(0x12b)](_0xdb7bda);const _0x41d3c7=await s_payment_data['findOne']({'invoice':_0x5d31a6});_0x41d3c7[_0x22cba1(0x156)]=_0x59ee92,await _0x41d3c7[_0x22cba1(0x1fc)]();let _0x5e540c=new Date(),_0x57d94a=('0'+_0x5e540c[_0x22cba1(0x174)]())[_0x22cba1(0x12f)](-0x2),_0xa4baa9=('0'+(_0x5e540c[_0x22cba1(0x1fd)]()+0x1))[_0x22cba1(0x12f)](-0x2),_0x1bb767=_0x5e540c[_0x22cba1(0x1a0)](),_0x347469=_0x1bb767+'-'+_0xa4baa9+'-'+_0x57d94a;const _0x5a96a9=new suppliers_payment({'invoice':_0x5d31a6,'date':_0x1bb767+'-'+_0xa4baa9+'-'+_0x57d94a,'suppliers':_0x537f04,'reason':'Paid\x20For\x20Purchase','amount':_0x59ae99}),_0x2f2311=await _0x5a96a9['save']();_0x5a3497[_0x22cba1(0x1be)](_0x22cba1(0x1d0),_0x22cba1(0x1a7)),_0x1ef6a7[_0x22cba1(0x14a)](_0x22cba1(0x168));}catch(_0x468e16){console[_0x22cba1(0x12b)](_0x468e16);}}),router[a0_0x2ecaf4(0x1cf)](a0_0x2ecaf4(0x1fe),auth,async(_0xe0b102,_0x4510e2)=>{var _0x51d3a2=a0_0x2ecaf4;try{const {username:_0x5c37bb,email:_0x35d8f6,role:_0xef236e}=_0xe0b102[_0x51d3a2(0x1d3)],_0x484643=_0xe0b102[_0x51d3a2(0x1d3)],_0x23c5d9=await profile[_0x51d3a2(0x1ea)]({'email':_0x484643['email']}),_0x319d5f=await master_shop[_0x51d3a2(0x1f1)]();console['log'](_0x51d3a2(0x169),_0x319d5f);const _0x464d65=_0xe0b102[_0x51d3a2(0x1d1)]['id'],_0x2dc2c5=await purchases[_0x51d3a2(0x1bb)](_0x464d65);console['log'](_0x2dc2c5);const _0x36cd60=await suppliers[_0x51d3a2(0x1ea)]({'name':_0x2dc2c5[_0x51d3a2(0x18b)]});console[_0x51d3a2(0x12b)](_0x36cd60);if(_0x319d5f[0x0][_0x51d3a2(0x13b)]==_0x51d3a2(0x1f9)){var _0x2c1649=users[_0x51d3a2(0x10c)];console['log'](_0x2c1649);}else{if(_0x319d5f[0x0][_0x51d3a2(0x13b)]==_0x51d3a2(0x142))var _0x2c1649=users['Hindi'];else{if(_0x319d5f[0x0][_0x51d3a2(0x13b)]==_0x51d3a2(0x19f))var _0x2c1649=users[_0x51d3a2(0x19f)];else{if(_0x319d5f[0x0]['language']==_0x51d3a2(0x1db))var _0x2c1649=users[_0x51d3a2(0x1db)];else{if(_0x319d5f[0x0][_0x51d3a2(0x13b)]==_0x51d3a2(0x1ab))var _0x2c1649=users[_0x51d3a2(0x1ab)];else{if(_0x319d5f[0x0][_0x51d3a2(0x13b)]==_0x51d3a2(0x202))var _0x2c1649=users[_0x51d3a2(0x1fa)];else{if(_0x319d5f[0x0][_0x51d3a2(0x13b)]==_0x51d3a2(0x163))var _0x2c1649=users[_0x51d3a2(0x163)];else{if(_0x319d5f[0x0][_0x51d3a2(0x13b)]=='Arabic\x20(ae)')var _0x2c1649=users[_0x51d3a2(0x194)];}}}}}}}_0x4510e2['render']('purchase_invoice',{'success':_0xe0b102[_0x51d3a2(0x1be)]('success'),'errors':_0xe0b102[_0x51d3a2(0x1be)](_0x51d3a2(0x198)),'role':_0x484643,'profile':_0x23c5d9,'master_shop':_0x319d5f,'supplier':_0x36cd60,'purchase':_0x2dc2c5,'language':_0x2c1649});}catch(_0xe28446){console['log'](_0xe28446);}}),router[a0_0x2ecaf4(0x1cf)](a0_0x2ecaf4(0x1c0),auth,async(_0x509f51,_0x248eed)=>{var _0x9771d5=a0_0x2ecaf4;try{const {username:_0x4b0187,email:_0x4a43ee,role:_0x3cdbda}=_0x509f51[_0x9771d5(0x1d3)],_0x48e208=_0x509f51['user'],_0x3da985=await profile[_0x9771d5(0x1ea)]({'email':_0x48e208[_0x9771d5(0x16a)]}),_0x357e73=await master_shop[_0x9771d5(0x1f1)]();console[_0x9771d5(0x12b)](_0x9771d5(0x169),_0x357e73);const _0x2df2d3=_0x509f51['params']['id'];console[_0x9771d5(0x12b)](_0x2df2d3);const _0x164c1b=await purchases_finished[_0x9771d5(0x1bb)](_0x2df2d3);console['log']('user_id',_0x164c1b);const _0x3acd36=await product[_0x9771d5(0x1f1)]({}),_0x3c7199=await warehouse['aggregate']([{'$match':{'name':_0x164c1b[_0x9771d5(0x13e)],'room':_0x164c1b[_0x9771d5(0x190)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x9771d5(0x12a),'name':{'$first':_0x9771d5(0x126)},'product_stock':{'$first':_0x9771d5(0x146)},'bay':{'$first':_0x9771d5(0x10b)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x9771d5(0x173)},'floorlevel':{'$first':_0x9771d5(0x19c)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x9771d5(0x112)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x9771d5(0x151)},'rack':{'$first':_0x9771d5(0x1de)}}}]);console[_0x9771d5(0x12b)](_0x9771d5(0x1e5),_0x3c7199);let _0x525f36;if(_0x48e208['role']==_0x9771d5(0x171)){const _0x35faf3=await staff[_0x9771d5(0x1ea)]({'email':_0x48e208[_0x9771d5(0x16a)]});_0x525f36=await warehouse[_0x9771d5(0x1f1)]({'status':_0x9771d5(0x191),'name':_0x35faf3['warehouse'],'warehouse_category':_0x9771d5(0x1fb),'name':'Return\x20Goods'});}else _0x525f36=await warehouse['aggregate']([{'$match':{'status':_0x9771d5(0x191),'warehouse_category':'Finished\x20Goods','name':_0x9771d5(0x1e7)}},{'$group':{'_id':'$name','name':{'$first':_0x9771d5(0x1c3)}}}]);if(_0x357e73[0x0][_0x9771d5(0x13b)]==_0x9771d5(0x1f9)){var _0x3bd368=users[_0x9771d5(0x10c)];console[_0x9771d5(0x12b)](_0x3bd368);}else{if(_0x357e73[0x0][_0x9771d5(0x13b)]==_0x9771d5(0x142))var _0x3bd368=users['Hindi'];else{if(_0x357e73[0x0]['language']==_0x9771d5(0x19f))var _0x3bd368=users[_0x9771d5(0x19f)];else{if(_0x357e73[0x0]['language']==_0x9771d5(0x1db))var _0x3bd368=users[_0x9771d5(0x1db)];else{if(_0x357e73[0x0]['language']==_0x9771d5(0x1ab))var _0x3bd368=users[_0x9771d5(0x1ab)];else{if(_0x357e73[0x0]['language']=='Portuguese\x20(BR)')var _0x3bd368=users[_0x9771d5(0x1fa)];else{if(_0x357e73[0x0][_0x9771d5(0x13b)]==_0x9771d5(0x163))var _0x3bd368=users[_0x9771d5(0x163)];else{if(_0x357e73[0x0][_0x9771d5(0x13b)]==_0x9771d5(0x11d))var _0x3bd368=users[_0x9771d5(0x194)];}}}}}}}_0x248eed['render'](_0x9771d5(0x195),{'success':_0x509f51[_0x9771d5(0x1be)]('success'),'errors':_0x509f51[_0x9771d5(0x1be)](_0x9771d5(0x198)),'role':_0x48e208,'profile':_0x3da985,'user':_0x164c1b,'stock':_0x3c7199,'master_shop':_0x357e73,'product':_0x3acd36,'language':_0x3bd368,'warehouse':_0x525f36});}catch(_0x604f3e){console['log'](_0x604f3e);}}),router[a0_0x2ecaf4(0x1c5)](a0_0x2ecaf4(0x1c0),auth,async(_0x3994b7,_0x3009bb)=>{var _0x456fc7=a0_0x2ecaf4;try{const {invoice:_0x5226d6,date:_0x32c290,warehouse_name:_0x418f8b,Room_name:_0x239948,product_name:_0x59ab78,purchase_quantity:_0xdd4992,stocks:_0x3d25ed,return_qty:_0x142a75,note:_0x7a08ba,level:_0x9e83bf,isle:_0x4eb41b,pallet:_0x28776a,to_warehouse_name:_0x329445,to_Room_name:_0x2f251d}=_0x3994b7['body'],_0x5e9737=await purchases_finished[_0x456fc7(0x1ea)]({'_id':_0x3994b7[_0x456fc7(0x1d1)]['id']}),_0x4d9a18=await warehouse['findOne']({'name':_0x418f8b,'room':_0x239948,'warehouse_category':_0x456fc7(0x1fb)});if(typeof _0x59ab78==_0x456fc7(0x1da))var _0x447503=[_0x3994b7['body'][_0x456fc7(0x18d)]],_0x1d58a8=[_0x3994b7[_0x456fc7(0x11f)]['purchase_quantity']],_0x488768=[_0x3994b7[_0x456fc7(0x11f)]['stocks']],_0x5a45c8=[_0x3994b7['body'][_0x456fc7(0x10e)]],_0x3eae25=[_0x3994b7['body'][_0x456fc7(0x184)]],_0x438003=[_0x3994b7['body'][_0x456fc7(0x1d8)]],_0x382cf9=[_0x3994b7[_0x456fc7(0x11f)]['primary_code_hide']],_0x1a247a=[_0x3994b7['body'][_0x456fc7(0x13a)]];else var _0x447503=[..._0x3994b7[_0x456fc7(0x11f)][_0x456fc7(0x18d)]],_0x1d58a8=[..._0x3994b7[_0x456fc7(0x11f)][_0x456fc7(0x160)]],_0x488768=[..._0x3994b7[_0x456fc7(0x11f)]['stocks']],_0x5a45c8=[..._0x3994b7[_0x456fc7(0x11f)][_0x456fc7(0x10e)]],_0x3eae25=[..._0x3994b7['body'][_0x456fc7(0x184)]],_0x438003=[..._0x3994b7[_0x456fc7(0x11f)][_0x456fc7(0x1d8)]],_0x382cf9=[..._0x3994b7[_0x456fc7(0x11f)]['primary_code_hide']],_0x1a247a=[..._0x3994b7[_0x456fc7(0x11f)][_0x456fc7(0x13a)]];const _0x14b0fb=_0x447503['map'](_0xbbf305=>{return _0xbbf305={'product_name':_0xbbf305};});_0x1d58a8[_0x456fc7(0x1f2)]((_0x3544a9,_0x1134a4)=>{var _0xc7aa94=_0x456fc7;_0x14b0fb[_0x1134a4][_0xc7aa94(0x160)]=_0x3544a9;}),_0x488768['forEach']((_0x32008f,_0x32cc61)=>{var _0x4dab40=_0x456fc7;_0x14b0fb[_0x32cc61][_0x4dab40(0x1b4)]=_0x32008f;}),_0x5a45c8[_0x456fc7(0x1f2)]((_0x8116af,_0x396c45)=>{var _0xd956cd=_0x456fc7;_0x14b0fb[_0x396c45][_0xd956cd(0x10e)]=_0x8116af;}),_0x3eae25['forEach']((_0x4c7d0c,_0x3c0359)=>{var _0x3ea18d=_0x456fc7;_0x14b0fb[_0x3c0359][_0x3ea18d(0x110)]=_0x4c7d0c;}),_0x438003[_0x456fc7(0x1f2)]((_0x748f69,_0x110af5)=>{_0x14b0fb[_0x110af5]['product_code']=_0x748f69;}),_0x382cf9[_0x456fc7(0x1f2)]((_0x42f300,_0x2ed407)=>{_0x14b0fb[_0x2ed407]['primary_code']=_0x42f300;}),_0x1a247a[_0x456fc7(0x1f2)]((_0x26d81f,_0x4532d7)=>{var _0x24d809=_0x456fc7;_0x14b0fb[_0x4532d7][_0x24d809(0x159)]=_0x26d81f;}),_0x14b0fb['forEach'](_0x1de6fd=>{var _0x3605a6=_0x456fc7;console[_0x3605a6(0x12b)](_0x1de6fd);const _0x443512=_0x4d9a18[_0x3605a6(0x200)]['map'](_0x26104b=>{var _0x674b33=_0x3605a6;_0x26104b[_0x674b33(0x18d)]==_0x1de6fd[_0x674b33(0x18d)]&&_0x26104b[_0x674b33(0x110)]==_0x1de6fd[_0x674b33(0x110)]&&(console['log'](parseInt(_0x26104b[_0x674b33(0x12c)])+_0x674b33(0x155)+parseInt(_0x1de6fd[_0x674b33(0x10e)])),_0x26104b['product_stock']=parseInt(_0x26104b[_0x674b33(0x12c)])-parseInt(_0x1de6fd[_0x674b33(0x10e)]));});}),await _0x4d9a18['save']();var _0x492a55=0x0;_0x14b0fb['forEach'](_0x33231b=>{var _0xf9b395=_0x456fc7;(parseInt(_0x33231b[_0xf9b395(0x160)])<parseInt(_0x33231b[_0xf9b395(0x10e)])||parseInt(_0x33231b[_0xf9b395(0x1b4)])<parseInt(_0x33231b[_0xf9b395(0x10e)]))&&_0x492a55++;});if(_0x492a55!=0x0)return _0x3994b7[_0x456fc7(0x1be)](_0x456fc7(0x198),_0x456fc7(0x1c2)),_0x3009bb['redirect']('back');const _0x3577a7=new purchases_return_finished({'invoice':_0x5226d6,'suppliers':_0x3994b7[_0x456fc7(0x11f)][_0x456fc7(0x18b)],'date':_0x32c290,'warehouse_name':_0x418f8b,'return_product':_0x14b0fb,'note':_0x7a08ba,'room':_0x239948,'to_warehouse_name':_0x329445,'to_room':_0x2f251d}),_0x3ab5e8=await _0x3577a7['save'](),_0x154b93=await purchases_return_finished[_0x456fc7(0x1ea)]({'invoice':_0x5226d6}),_0x140ae7=await warehouse[_0x456fc7(0x1ea)]({'name':_0x329445,'room':_0x2f251d,'warehouse_category':'Finished\x20Goods'});_0x154b93['return_product'][_0x456fc7(0x1f2)](_0x1549f2=>{var _0x9d8558=_0x456fc7,_0x359d64=0x0;const _0x5059ac=_0x140ae7['product_details'][_0x9d8558(0x188)](_0x4cd139=>{var _0x917a2e=_0x9d8558;console[_0x917a2e(0x12b)](_0x4cd139['product_name']+'=='+_0x1549f2[_0x917a2e(0x18d)]+'&&'+_0x4cd139[_0x917a2e(0x110)]+'=='+_0x1549f2[_0x917a2e(0x110)]),_0x4cd139[_0x917a2e(0x18d)]==_0x1549f2[_0x917a2e(0x18d)]&&_0x4cd139[_0x917a2e(0x110)]==_0x1549f2[_0x917a2e(0x110)]&&(_0x4cd139[_0x917a2e(0x12c)]=parseInt(_0x4cd139[_0x917a2e(0x12c)])-parseInt(_0x1549f2[_0x917a2e(0x10e)]),_0x359d64++);});_0x359d64=='0'&&(_0x140ae7[_0x9d8558(0x200)]=_0x140ae7['product_details'][_0x9d8558(0x1e9)]({'product_name':_0x1549f2['product_name'],'product_stock':_0x1549f2[_0x9d8558(0x10e)],'primary_code':_0x1549f2['primary_code'],'secondary_code':_0x1549f2['secondary_code'],'product_code':_0x1549f2[_0x9d8558(0x137)],'bay':_0x1549f2[_0x9d8558(0x110)],'maxProducts':0xf423f}));}),await _0x140ae7[_0x456fc7(0x1fc)]();const _0x3b1c03=await purchases_finished[_0x456fc7(0x1ea)]({'invoice':_0x5226d6});_0x3b1c03[_0x456fc7(0x1a1)]=_0x456fc7(0x18c);const _0x53cc60=await _0x3b1c03['save'](),_0x580f5c=new s_payment_data({'invoice':_0x5226d6,'suppliers':_0x3994b7[_0x456fc7(0x11f)][_0x456fc7(0x18b)],'reason':'Purchase\x20Return'});await _0x580f5c['save']();const _0x3ca6a2=await master_shop[_0x456fc7(0x1f1)](),_0x50a320=await email_settings[_0x456fc7(0x1ea)](),_0x994e98=await suppliers[_0x456fc7(0x1ea)]({'name':_0x3994b7[_0x456fc7(0x11f)][_0x456fc7(0x18b)]});_0x3ca6a2[0x0][_0x456fc7(0x187)]==0x1?(right_currency=_0x3ca6a2[0x0][_0x456fc7(0x1ec)],left_currency=''):(right_currency='',left_currency=_0x3ca6a2[0x0][_0x456fc7(0x1ec)]);var _0x48aea4=_0x447503,_0x17beb5=_0x5a45c8,_0x40158b='',_0x51c054;for(_0x51c054 in _0x48aea4){_0x40158b+=_0x456fc7(0x18e)+_0x456fc7(0x19e)+_0x48aea4[_0x51c054]+'</td>'+_0x456fc7(0x19e)+_0x17beb5[_0x51c054]+_0x456fc7(0x10f)+'</tr>';}let _0x5b3c14=nodemailer[_0x456fc7(0x133)]({'service':_0x456fc7(0x1a2),'auth':{'user':_0x50a320[_0x456fc7(0x16a)],'pass':_0x50a320['password']}}),_0x1a0d50={'from':_0x50a320['email'],'to':_0x994e98[_0x456fc7(0x16a)],'subject':_0x456fc7(0x17e),'attachments':[{'filename':'Logo.png','path':__dirname+_0x456fc7(0x15c)+_0x456fc7(0x179)+_0x3ca6a2[0x0][_0x456fc7(0x180)],'cid':_0x456fc7(0x193)}],'html':_0x456fc7(0x16e)+'<html><head><title></title>'+_0x456fc7(0x17f)+_0x456fc7(0x18f)+_0x456fc7(0x136)+'<div>'+_0x456fc7(0x176)+_0x456fc7(0x1d7)+_0x456fc7(0x18f)+_0x456fc7(0x14d)+_0x3ca6a2[0x0][_0x456fc7(0x19b)]+'\x20</h2>'+'</div>'+'</div>'+_0x456fc7(0x141)+_0x456fc7(0x18f)+_0x456fc7(0x1ba)+'\x20Order\x20Number\x20:\x20'+_0x5226d6+'\x20'+_0x456fc7(0x1ee)+'\x20Order\x20Date\x20:\x20'+_0x32c290+'\x20'+_0x456fc7(0x1b8)+_0x456fc7(0x11a)+'</div>'+_0x456fc7(0x1e8)+_0x456fc7(0x13d)+_0x456fc7(0x18e)+_0x456fc7(0x1bd)+_0x456fc7(0x108)+_0x456fc7(0x162)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+_0x456fc7(0x14e)+'\x20'+_0x40158b+'\x20'+_0x456fc7(0x19d)+_0x456fc7(0x178)+_0x456fc7(0x18f)+_0x456fc7(0x175)+'<h5>'+_0x3ca6a2[0x0]['site_title']+_0x456fc7(0x11a)+'</div>'+_0x456fc7(0x1d7)+_0x456fc7(0x131)};_0x5b3c14[_0x456fc7(0x181)](_0x1a0d50,function(_0x45f886,_0x59ff50){var _0x12fecc=_0x456fc7;_0x45f886?console['log'](_0x12fecc(0x161)):console[_0x12fecc(0x12b)]('Email\x20sent\x20successfully');}),_0x3994b7[_0x456fc7(0x1be)]('success',_0x456fc7(0x165)),_0x3009bb[_0x456fc7(0x14a)](_0x456fc7(0x1d2));}catch(_0x270372){_0x3009bb[_0x456fc7(0x203)](0xc8)[_0x456fc7(0x1ca)]({'message':_0x270372[_0x456fc7(0x144)]});}}),router['get'](a0_0x2ecaf4(0x1d6),auth,async(_0x5bf0d6,_0x2623d6)=>{var _0x15e5b7=a0_0x2ecaf4;try{const {username:_0x583018,email:_0x1cf4a4,role:_0x2089f9}=_0x5bf0d6[_0x15e5b7(0x1d3)],_0xacf6ee=_0x5bf0d6['user'],_0x50f3bd=await profile['findOne']({'email':_0xacf6ee['email']}),_0x1653cd=await master_shop[_0x15e5b7(0x1f1)](),_0x44c38d=_0x5bf0d6[_0x15e5b7(0x1d1)]['id'],_0xf68f13=await purchases_finished[_0x15e5b7(0x1bb)](_0x44c38d);if(_0x1653cd[0x0][_0x15e5b7(0x13b)]==_0x15e5b7(0x1f9))var _0x4cb5ec=users[_0x15e5b7(0x10c)];else{if(_0x1653cd[0x0][_0x15e5b7(0x13b)]==_0x15e5b7(0x142))var _0x4cb5ec=users['Hindi'];else{if(_0x1653cd[0x0]['language']==_0x15e5b7(0x19f))var _0x4cb5ec=users[_0x15e5b7(0x19f)];else{if(_0x1653cd[0x0]['language']==_0x15e5b7(0x1db))var _0x4cb5ec=users[_0x15e5b7(0x1db)];else{if(_0x1653cd[0x0][_0x15e5b7(0x13b)]==_0x15e5b7(0x1ab))var _0x4cb5ec=users['French'];else{if(_0x1653cd[0x0][_0x15e5b7(0x13b)]=='Portuguese\x20(BR)')var _0x4cb5ec=users[_0x15e5b7(0x1fa)];else{if(_0x1653cd[0x0][_0x15e5b7(0x13b)]==_0x15e5b7(0x163))var _0x4cb5ec=users[_0x15e5b7(0x163)];else{if(_0x1653cd[0x0][_0x15e5b7(0x13b)]==_0x15e5b7(0x11d))var _0x4cb5ec=users[_0x15e5b7(0x194)];}}}}}}}_0x2623d6['render'](_0x15e5b7(0x1c9),{'success':_0x5bf0d6['flash'](_0x15e5b7(0x1d0)),'errors':_0x5bf0d6[_0x15e5b7(0x1be)](_0x15e5b7(0x198)),'role':_0xacf6ee,'profile':_0x50f3bd,'alldata':_0xf68f13,'master_shop':_0x1653cd,'language':_0x4cb5ec}),console[_0x15e5b7(0x12b)](alldata);}catch(_0x12189e){console[_0x15e5b7(0x12b)](_0x12189e);}}),router[a0_0x2ecaf4(0x1c5)](a0_0x2ecaf4(0x1aa),async(_0x3e4e6c,_0x13f88f)=>{var _0x704ef4=a0_0x2ecaf4;const {product_code:_0x40affd}=_0x3e4e6c[_0x704ef4(0x11f)];var _0x196cf2;const _0x32f814=await product['aggregate']([{'$match':{'primary_code':_0x40affd,'product_category':_0x704ef4(0x1fb)}},{'$group':{'_id':_0x704ef4(0x140),'name':{'$first':_0x704ef4(0x1c3)},'category':{'$first':_0x704ef4(0x135)},'brand':{'$first':_0x704ef4(0x1bf)},'unit':{'$first':_0x704ef4(0x1f0)},'alertquantity':{'$first':_0x704ef4(0x122)},'product_code':{'$first':_0x704ef4(0x1b2)},'primary_code':{'$first':_0x704ef4(0x147)},'secondary_code':{'$first':_0x704ef4(0x153)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x704ef4(0x1ad)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x704ef4(0x1cd)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2b4440=await product[_0x704ef4(0x1ae)]([{'$match':{'secondary_code':_0x40affd}},{'$group':{'_id':'$_id','name':{'$first':_0x704ef4(0x1c3)},'category':{'$first':_0x704ef4(0x135)},'brand':{'$first':_0x704ef4(0x1bf)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x704ef4(0x122)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x704ef4(0x147)},'secondary_code':{'$first':_0x704ef4(0x153)},'maxStocks':{'$first':_0x704ef4(0x192)},'maxProdPerUnit':{'$first':_0x704ef4(0x1ad)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x704ef4(0x1cd)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x32f814['length']>0x0)_0x196cf2=_0x32f814;else _0x2b4440[_0x704ef4(0x18a)]>0x0&&(_0x196cf2=_0x2b4440);_0x13f88f[_0x704ef4(0x1ca)](_0x196cf2);}),router['post'](a0_0x2ecaf4(0x1b9),async(_0x4540b5,_0x2fbc1c)=>{var _0x34d567=a0_0x2ecaf4;const {productCode:_0x5d085b,bay:_0x4b422a,warehouses:_0x4c70d6,room:_0x1b68ae}=_0x4540b5[_0x34d567(0x11f)];console['log'](_0x4540b5[_0x34d567(0x11f)]);try{const _0x234f8b=await warehouse[_0x34d567(0x1ae)]([{'$match':{'name':_0x4c70d6,'room':_0x1b68ae}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x4b422a)}},{'$group':{'_id':_0x34d567(0x12a),'name':{'$first':_0x34d567(0x126)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x34d567(0x10b)},'maxProducts':{'$first':_0x34d567(0x1b1)}}}]);_0x2fbc1c[_0x34d567(0x203)](0xc8)['json'](_0x234f8b);}catch(_0x5c382c){_0x2fbc1c[_0x34d567(0x203)](0x194)['json']({'message':_0x5c382c['message']});}}),module[a0_0x2ecaf4(0x11b)]=router;function a0_0xd1dc(){var _0x266454=['secondary_unit','$_id','<hr\x20class=\x22my-3\x22>','Hindi','date','message','abs','$product_details.product_stock','$primary_code','4715780pFNZHk','$due_amount','redirect','\x20Order\x20Number\x20:\x20','ejs','<h2>\x20','<tbody\x20style=\x22text-align:\x20center;\x22>','product','due_amount','$product_details.storage','281388MsUPCJ','$secondary_code','express','\x20<>\x20','amount','prod_name','primary_code','secondary_code','JO_number','$product','/../public','MaxStocks_data','filter','max_product_unit','purchase_quantity','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Chinese','room_name','purchases\x20item\x20return\x20successfull','production_date','expiry_date','/all_purchases/view','master','email','$expiry_date','<html><head><title></title>','$product.quantity','<!DOCTYPE\x20html>','../middleware/auth','then','staff','98usSYAY','$product_details.type','getDate','<strong>\x20Regards\x20</strong>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','prod_code','</table>','/upload/','\x20Order\x20Date\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','nodemailer','invoice','Purchase\x20Return\x20Mail','</head><body>','image','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Rack\x202','level','$paid_amount','catch','currency_placement','map','edit_purchases_finished','length','suppliers','True','product_name','<tr>','<div>','room','Enabled','$maxStocks','logo','Arabic','return_purchase_finished','FROZEN\x20GOODS','<h5>','errors','product_cat','prod_secondunit','site_title','$product_details.floorlevel','</tbody>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','German','getFullYear','return_data','gmail','host','Purchase\x20Mail','../public/language/languages.json','random','payment\x20successfull','$product.type','$note','/barcode_scanner','French','$batch_code','$maxProdPerUnit','aggregate','$suppliers_docs','product_date','$product_details.maxProducts','$product_code','../models/all_models','stock_quantity','16214UkeGiF','quantity','Email\x20sent\x20successfully','</span>','/CheckingWarehouse','<h5\x20style=\x22text-align:\x20left;\x22>','findById','/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','flash','$brand','/view/return_purchase/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$name','$room','post','RoomAssign','$product.floorlevel','469088gpZrSi','all_purchases_barcode','json','1543260gTkkww','$warehouse_name','$secondary_unit','99tcrnON','get','success','params','/all_purchases_finished/view','user','warehouse','POnumber','/barcode/:id','</div>','product_code_hide','prod_level','string','Spanish','Room_name','all_purchases_finished','$product_details.rack','$invoice','password','name','standard_unit','2529RWDKJA','/view/:id','stock_data','toString','Return\x20Goods','<table\x20style=\x22width:\x20100%\x20!important;\x22>','concat','findOne','</thead>','currency','add_purchases\x20error','<span\x20style=\x22float:\x20right;\x22>','path','$unit','find','forEach','_id','maxperunit','prod_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','paid_amount','prod_unit','English\x20(US)','Portuguese','Finished\x20Goods','save','getMonth','/invoice/:id','role','product_details','INCF-','Portuguese\x20(BR)','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','padStart','batch_code','$product_details.bay','English','An\x20error\x20occurred\x20while\x20saving\x20data.','return_qty','</td>','bay','$product.bin','$product_details.secondary_code','55369424mXnqjF','$suppliers','</tr>','prod_qty','error','$return_data','port','</h5>','exports','\x20</h2>','Arabic\x20(ae)','add_purchases_finished','body','6696RsWEXM','188ofwUwF','$alertquantity','purchase\x20data\x20add\x20successfully','$product.bay','floor','$product_details.product_name','Logo.png','Rack\x201','purchase\x20data\x20update\x20successfully','$product_details._id','log','product_stock','render','prod_primunit','slice','$product.room_name','</body></html>','note','createTransport','Ambient','$category','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_code','DRY\x20GOODS','maxStocks','secondary_code_hide','language','$date','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','warehouse_name'];a0_0xd1dc=function(){return _0x266454;};return a0_0xd1dc();}