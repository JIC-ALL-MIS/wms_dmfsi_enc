var a0_0x3e3aff=a0_0x45b8;(function(_0x2fd3d0,_0x157b7b){var _0xcaf66e=a0_0x45b8,_0x29c022=_0x2fd3d0();while(!![]){try{var _0x4d9db6=-parseInt(_0xcaf66e(0x27e))/0x1*(-parseInt(_0xcaf66e(0x283))/0x2)+-parseInt(_0xcaf66e(0x29a))/0x3*(parseInt(_0xcaf66e(0x27b))/0x4)+-parseInt(_0xcaf66e(0x240))/0x5+-parseInt(_0xcaf66e(0x265))/0x6*(parseInt(_0xcaf66e(0x2a3))/0x7)+parseInt(_0xcaf66e(0x264))/0x8*(parseInt(_0xcaf66e(0x20c))/0x9)+parseInt(_0xcaf66e(0x28d))/0xa*(parseInt(_0xcaf66e(0x1e0))/0xb)+parseInt(_0xcaf66e(0x2a4))/0xc*(parseInt(_0xcaf66e(0x1b7))/0xd);if(_0x4d9db6===_0x157b7b)break;else _0x29c022['push'](_0x29c022['shift']());}catch(_0x25fea4){_0x29c022['push'](_0x29c022['shift']());}}}(a0_0x4727,0xb7db3));const express=require(a0_0x3e3aff(0x213)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x3e3aff(0x27d)),auth=require('../middleware/auth'),nodemailer=require(a0_0x3e3aff(0x244));var ejs=require(a0_0x3e3aff(0x23d));const path=require(a0_0x3e3aff(0x279)),users=require('../public/language/languages.json');function a0_0x45b8(_0x1e587c,_0x32d969){var _0x47277b=a0_0x4727();return a0_0x45b8=function(_0x45b89a,_0xda0166){_0x45b89a=_0x45b89a-0x1b0;var _0x85b150=_0x47277b[_0x45b89a];return _0x85b150;},a0_0x45b8(_0x1e587c,_0x32d969);}router[a0_0x3e3aff(0x1ba)](a0_0x3e3aff(0x2b3),auth,async(_0xe22b47,_0x2543d6)=>{var _0x2d1b65=a0_0x3e3aff;try{const {username:_0x24f32d,email:_0x43dc8b,role:_0x324603}=_0xe22b47[_0x2d1b65(0x253)],_0x3a7bcd=_0xe22b47[_0x2d1b65(0x253)],_0x57c5b7=await profile[_0x2d1b65(0x25b)]({'email':_0x3a7bcd[_0x2d1b65(0x1f0)]}),_0x2349d4=await staff[_0x2d1b65(0x25b)]({'email':_0x3a7bcd[_0x2d1b65(0x1f0)]});if(_0x3a7bcd[_0x2d1b65(0x25f)]==_0x2d1b65(0x1c7)){const _0x5a0d19=await staff['findOne']({'email':_0x3a7bcd[_0x2d1b65(0x1f0)]});}const _0x3b6500=await master_shop[_0x2d1b65(0x297)]();let _0x164e9a;if(_0x3a7bcd[_0x2d1b65(0x25f)]==_0x2d1b65(0x1c7)){const _0x39c958=await staff[_0x2d1b65(0x25b)]({'email':_0x3a7bcd[_0x2d1b65(0x1f0)]});_0x164e9a=await purchases_finished[_0x2d1b65(0x290)]([{'$match':{'warehouse_name':_0x39c958['warehouse']}},{'$lookup':{'from':_0x2d1b65(0x2a1),'localField':_0x2d1b65(0x2a1),'foreignField':_0x2d1b65(0x1c0),'as':_0x2d1b65(0x225)}},{'$unwind':_0x2d1b65(0x2ab)},{'$unwind':'$product'},{'$group':{'_id':_0x2d1b65(0x2ad),'invoice':{'$first':_0x2d1b65(0x285)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x2d1b65(0x252)},'warehouse_name':{'$first':_0x2d1b65(0x1fd)},'room':{'$first':_0x2d1b65(0x242)},'product':{'$push':_0x2d1b65(0x2a7)},'note':{'$first':_0x2d1b65(0x272)},'paid_amount':{'$first':_0x2d1b65(0x1c5)},'due_amount':{'$first':_0x2d1b65(0x249)},'return_data':{'$first':_0x2d1b65(0x1cd)},'batch_code':{'$first':_0x2d1b65(0x2af)},'expiry_date':{'$first':_0x2d1b65(0x214)},'suppliers_docs':{'$first':_0x2d1b65(0x2ab)},'total_product_quantity':{'$sum':_0x2d1b65(0x1e2)},'level':{'$addToSet':_0x2d1b65(0x218)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2d1b65(0x1f4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x164e9a=await purchases_finished[_0x2d1b65(0x290)]([{'$unwind':_0x2d1b65(0x2a7)},{'$group':{'_id':_0x2d1b65(0x2ad),'invoice':{'$first':_0x2d1b65(0x285)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x2d1b65(0x252)},'warehouse_name':{'$first':_0x2d1b65(0x1fd)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x2d1b65(0x2a7)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x2d1b65(0x1cd)},'batch_code':{'$first':_0x2d1b65(0x2af)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2d1b65(0x2ab)},'total_product_quantity':{'$sum':_0x2d1b65(0x1e2)},'level':{'$addToSet':_0x2d1b65(0x218)},'isle':{'$addToSet':_0x2d1b65(0x269)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2d1b65(0x1f4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x3b6500[0x0][_0x2d1b65(0x239)]==_0x2d1b65(0x1d6))var _0x3c25e7=users[_0x2d1b65(0x1b5)];else{if(_0x3b6500[0x0][_0x2d1b65(0x239)]==_0x2d1b65(0x25d))var _0x3c25e7=users[_0x2d1b65(0x25d)];else{if(_0x3b6500[0x0][_0x2d1b65(0x239)]=='German')var _0x3c25e7=users['German'];else{if(_0x3b6500[0x0]['language']==_0x2d1b65(0x1f9))var _0x3c25e7=users[_0x2d1b65(0x1f9)];else{if(_0x3b6500[0x0]['language']==_0x2d1b65(0x2a9))var _0x3c25e7=users['French'];else{if(_0x3b6500[0x0][_0x2d1b65(0x239)]==_0x2d1b65(0x23c))var _0x3c25e7=users[_0x2d1b65(0x1bd)];else{if(_0x3b6500[0x0][_0x2d1b65(0x239)]==_0x2d1b65(0x1e8))var _0x3c25e7=users[_0x2d1b65(0x1e8)];else{if(_0x3b6500[0x0][_0x2d1b65(0x239)]==_0x2d1b65(0x1f6))var _0x3c25e7=users[_0x2d1b65(0x1c9)];}}}}}}}_0x2543d6[_0x2d1b65(0x1d8)](_0x2d1b65(0x1bc),{'success':_0xe22b47[_0x2d1b65(0x280)](_0x2d1b65(0x259)),'errors':_0xe22b47[_0x2d1b65(0x280)](_0x2d1b65(0x1d5)),'purchases':_0x164e9a,'role':_0x3a7bcd,'profile':_0x57c5b7,'master_shop':_0x3b6500,'language':_0x3c25e7});}catch(_0x555b9f){console[_0x2d1b65(0x256)](_0x2d1b65(0x1d1),_0x555b9f),_0x2543d6[_0x2d1b65(0x1ef)](0xc8)[_0x2d1b65(0x26f)]({'message':_0x555b9f[_0x2d1b65(0x205)]});}});function BayBinSelected(_0x222f0a,_0x4964e0){var _0x2d9469=a0_0x3e3aff,_0x37edb7=[],_0x547e60=[];if(_0x222f0a==_0x2d9469(0x24a)){switch(_0x4964e0){case _0x2d9469(0x204):_0x37edb7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x2d9469(0x287):_0x37edb7=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x547e60=['DG'];}else{if(_0x222f0a==_0x2d9469(0x24d)){switch(_0x4964e0){case _0x2d9469(0x204):_0x37edb7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x2d9469(0x287):_0x37edb7=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x547e60=['FG'];}}return{'levels':_0x37edb7,'identify':_0x547e60};}function a0_0x4727(){var _0x17659a=['$product.quantity','$primary_code','forEach','standard_unit','floor','payment\x20successfull','Chinese','Return\x20Goods','$alertquantity','edit_purchases_finished_view','/barcode/:id','date_data','</body></html>','status','email','port','getDate','updateOne','$product.floorlevel','image','Arabic\x20(ae)','True','length','Spanish','POnumber','password','batch_code','$warehouse_name','/invoice/:id','prod_unit','product_stock','$product_details.floorlevel','stocks','</div>','Rack\x201','message','host','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$maxStocks','Room_name','An\x20error\x20occurred\x20while\x20saving\x20data.','3231LHraNl','getMonth','secondary_code_hide','map','$product_details.type','/../public','prod_primunit','express','$expiry_date','$product_details.bin','level','secondary_code','$product.bay','user_id','<!DOCTYPE\x20html>','prod_secondunit','due_amount','prod_cat','maxperunit','exports','site_title','MaxStocks_data','<html><head><title></title>','product','<strong>\x20Regards\x20</strong>','suppliers_docs','Email\x20sent\x20successfully','date','Enclosed','\x20</h2>','<hr\x20class=\x22my-3\x22>','primary_code_hide','/upload/','post','$product_details.maxProducts','slice','/barcode_scanner','return_purchase_finished','<tr>','prod_level','$product_details','$brand','/view/return_purchase/:id','currency','Purchase\x20Mail','language','return_qty','back','Portuguese\x20(BR)','ejs','Error\x20Occurs','</head><body>','1550455KMNiil','edit_purchases_finished','$room','abs','nodemailer','$product_details._id','prod_Qty','<h2>\x20','sendMail','$due_amount','DRY\x20GOODS','prod_qty','redirect','FROZEN\x20GOODS','product_details','return_data','</tbody>','prod_name','$date','user','bay','</table>','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','warehouse_name','success','createTransport','findOne','product_name','Hindi','QA\x20Warehouse','role','$unit','string','\x20Order\x20Number\x20:\x20','amount','12584vlCCzO','1758rKjUPV','purchase_invoice','$product_details.bay','random','$product.bin','error','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','logo','Purchase\x20Return','json','maxStocks','body','$note','_id','secondary_unit','purchase\x20data\x20update\x20successfully','$product_details.product_stock','product_date','stock_data','path','primary_code','4485308INtzVv','product_code_hide','../models/all_models','23XNHhXv','Ambient','flash','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','62204KXgwWR','\x20Order\x20Date\x20:\x20','$invoice','purchase_quantity','Rack\x202','German','/view/:id','paid_amount','$maxProdPerUnit','padStart','101830pSRRLd','</span>','concat','aggregate','<div>','stock_quantity','save','production_date','$product_details.product_name','product_code','find','Logo.png','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','3ZRvSBD','$secondary_code','room','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','\x20<>\x20','warehouse','INCF-','suppliers','purchase\x20data\x20add\x20successfully','21203CvBQkR','1067436DRbGlH','quantity','/preview/:id','$product','<table\x20style=\x22width:\x20100%\x20!important;\x22>','French','Enabled','$suppliers_docs','<h5>','$_id','gmail','$batch_code','prod_invoice','$product_details.storage','max_product_unit','/view','<tbody\x20style=\x22text-align:\x20center;\x22>','params','note','</h5>','add_purchases_finished','English','Finished\x20Goods','247rNCuMd','There\x27s\x20a\x20error\x20in\x20this\x20transaction','currency_placement','get','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','all_purchases_finished','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','FGSEmail','name','invoice','/all_purchases_finished/view','RoomAssign','Paid\x20For\x20Purchase','$paid_amount','</thead>','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Arabic','<h5\x20style=\x22text-align:\x20left;\x22>','/all_purchases/view','add_purchases\x20error','$return_data','$product_code','getFullYear','purchases\x20item\x20return\x20successfull','table\x20page','$category','$name','</tr>','errors','English\x20(US)','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','render','$product_details.primary_code','findById','master','product_cat','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','room_name','110rYWvPE','</td>'];a0_0x4727=function(){return _0x17659a;};return a0_0x4727();}async function getRandom8DigitNumber(){var _0x912f74=a0_0x3e3aff;const _0x5b004c=0x989680,_0xe9fb43=0x5f5e0ff,_0x151613=Math[_0x912f74(0x1e6)](Math[_0x912f74(0x268)]()*(_0xe9fb43-_0x5b004c+0x1))+_0x5b004c;var _0x21a6f8;const _0x4c8970=await purchases_finished['findOne']({'invoice':_0x912f74(0x2a0)+_0x151613});return _0x4c8970&&_0x4c8970['length']>0x0?_0x21a6f8=_0x912f74(0x2a0)+_0x151613:_0x21a6f8=_0x912f74(0x2a0)+_0x151613,_0x21a6f8;}router['get']('/view/add_purchases',auth,async(_0x1c1524,_0xc79ae2)=>{var _0x6de728=a0_0x3e3aff;try{const {username:_0x4e27c0,email:_0x1cf911,role:_0x14b1ae}=_0x1c1524[_0x6de728(0x253)],_0x3c2082=_0x1c1524[_0x6de728(0x253)],_0x14faa0=await profile[_0x6de728(0x25b)]({'email':_0x3c2082[_0x6de728(0x1f0)]}),_0x469b47=await master_shop[_0x6de728(0x297)](),_0x4866d0=await staff[_0x6de728(0x25b)]({'email':_0x3c2082[_0x6de728(0x1f0)]}),_0x2bb257=await suppliers['find']({});let _0x25324c;if(_0x3c2082[_0x6de728(0x25f)]=='staff'){const _0x18b1f7=await staff[_0x6de728(0x25b)]({'email':_0x3c2082[_0x6de728(0x1f0)]});_0x25324c=await warehouse['aggregate']([{'$match':{'status':_0x6de728(0x2aa),'name':_0x18b1f7[_0x6de728(0x29f)],'warehouse_category':_0x6de728(0x1b6)}},{'$group':{'_id':'$name','name':{'$first':_0x6de728(0x1d3)}}}]);}else _0x25324c=await warehouse['aggregate']([{'$match':{'status':_0x6de728(0x2aa),'warehouse_category':_0x6de728(0x1b6),'name':{'$ne':_0x6de728(0x25e)}}},{'$group':{'_id':_0x6de728(0x1d3),'name':{'$first':_0x6de728(0x1d3)}}}]);const _0x596692=await product[_0x6de728(0x297)]({}),_0x2220f9=await warehouse[_0x6de728(0x297)]({'status':'Enabled'}),_0x40b9d5=await purchases_finished[_0x6de728(0x297)]({}),_0xe08e36=_0x40b9d5[_0x6de728(0x1f8)]+0x1,_0x1f826c=_0x6de728(0x2a0)+_0xe08e36['toString']()[_0x6de728(0x28c)](0x5,'0');var _0x4ca629=[_0x6de728(0x27f),_0x6de728(0x228)];if(_0x469b47[0x0][_0x6de728(0x239)]==_0x6de728(0x1d6))var _0x5e8e2b=users['English'];else{if(_0x469b47[0x0][_0x6de728(0x239)]==_0x6de728(0x25d))var _0x5e8e2b=users['Hindi'];else{if(_0x469b47[0x0][_0x6de728(0x239)]==_0x6de728(0x288))var _0x5e8e2b=users[_0x6de728(0x288)];else{if(_0x469b47[0x0][_0x6de728(0x239)]=='Spanish')var _0x5e8e2b=users[_0x6de728(0x1f9)];else{if(_0x469b47[0x0][_0x6de728(0x239)]==_0x6de728(0x2a9))var _0x5e8e2b=users['French'];else{if(_0x469b47[0x0][_0x6de728(0x239)]==_0x6de728(0x23c))var _0x5e8e2b=users[_0x6de728(0x1bd)];else{if(_0x469b47[0x0]['language']=='Chinese')var _0x5e8e2b=users[_0x6de728(0x1e8)];else{if(_0x469b47[0x0][_0x6de728(0x239)]==_0x6de728(0x1f6))var _0x5e8e2b=users[_0x6de728(0x1c9)];}}}}}}}const _0x2b5528=getRandom8DigitNumber();_0x2b5528['then'](_0x56b1c3=>{var _0xf9ba5=_0x6de728;_0xc79ae2['render'](_0xf9ba5(0x1b4),{'success':_0x1c1524[_0xf9ba5(0x280)](_0xf9ba5(0x259)),'errors':_0x1c1524[_0xf9ba5(0x280)](_0xf9ba5(0x1d5)),'role':_0x3c2082,'profile':_0x14faa0,'suppliers':_0x2bb257,'warehouse':_0x25324c,'product':_0x596692,'invoice':_0x56b1c3,'master_shop':_0x469b47,'language':_0x5e8e2b,'find_data':_0x2220f9,'rooms_data':_0x4ca629});})['catch'](_0xe93642=>{var _0x244bf7=_0x6de728;_0x1c1524[_0x244bf7(0x280)](_0x244bf7(0x1d5),_0x244bf7(0x1b8)),_0xc79ae2[_0x244bf7(0x24c)](_0x244bf7(0x1c2));});}catch(_0x710b69){console['log'](_0x710b69);}}),router[a0_0x3e3aff(0x1ba)]('/view/add_purchases/:id',auth,async(_0x1be25b,_0x50bb17)=>{var _0x311ff3=a0_0x3e3aff;try{const _0x528760=_0x1be25b[_0x311ff3(0x1b1)]['id'];console[_0x311ff3(0x256)](_0x528760);const _0x43bce7=await master_shop[_0x311ff3(0x297)]();console['log'](_0x311ff3(0x1db),_0x43bce7);const _0x2e562e=await product[_0x311ff3(0x25b)]({'name':_0x528760});console[_0x311ff3(0x256)](_0x311ff3(0x223),_0x2e562e),_0x50bb17[_0x311ff3(0x1ef)](0xc8)[_0x311ff3(0x26f)]({'product_data':_0x2e562e,'master':_0x43bce7});}catch(_0x5cf035){console[_0x311ff3(0x256)](_0x311ff3(0x1cc),_0x5cf035);}}),router['post']('/view/add_purchases',auth,async(_0x20b92d,_0x7897a8)=>{var _0xc96362=a0_0x3e3aff;try{const {invoice:_0x320b49,date:_0x325337,warehouse_name:_0x4a16be,prod_name:_0xf8d01c,prod_code:_0x5b0fec,prod_qty:_0x48992d,prod_unit:_0xac9ad3,prod_secondunit:_0x9d2543,prod_level:_0x7d5d71,prod_isle:_0x26b771,prod_pallet:_0x391a5d,note:_0x44a070,expiry_date:_0x5e8214,batch_code:_0xbb667d,payable:_0x164f0d,due_amount:_0x48442e,Room_name:_0x357f7e,primary_code:_0x281746,secondary_code:_0x213ddf,MaxStocks_data:_0x21c09c,PO_number:_0x28e5ce,SCRN:_0x8690a3,JO_number:_0x100c7b}=_0x20b92d['body'];if(typeof _0xf8d01c==_0xc96362(0x261))var _0x4cdc36=[_0x20b92d[_0xc96362(0x271)][_0xc96362(0x251)]],_0x4df11c=[_0x20b92d[_0xc96362(0x271)][_0xc96362(0x281)]],_0x48dd9f=[_0x20b92d[_0xc96362(0x271)][_0xc96362(0x246)]],_0x4e6a9f=[_0x20b92d['body'][_0xc96362(0x212)]],_0x2a403e=[_0x20b92d[_0xc96362(0x271)][_0xc96362(0x21b)]],_0x11231d=[_0x20b92d['body'][_0xc96362(0x233)]],_0x11aca1=[_0x20b92d[_0xc96362(0x271)]['primary_code']],_0x48758e=[_0x20b92d[_0xc96362(0x271)]['secondary_code']],_0x287956=[_0x20b92d[_0xc96362(0x271)][_0xc96362(0x221)]],_0x31783b=[_0x20b92d[_0xc96362(0x271)][_0xc96362(0x1fc)]],_0xa2bfc9=[_0x20b92d[_0xc96362(0x271)][_0xc96362(0x1dd)]],_0x5ebec8=[_0x20b92d[_0xc96362(0x271)][_0xc96362(0x277)]],_0x1e8968=[_0x20b92d[_0xc96362(0x271)][_0xc96362(0x2b2)]],_0x144805=[_0x20b92d['body'][_0xc96362(0x21d)]],_0x24a9ba=[_0x20b92d[_0xc96362(0x271)]['RoomAssign']],_0x7826f3=[_0x20b92d[_0xc96362(0x271)][_0xc96362(0x2b0)]];else var _0x4cdc36=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x251)]],_0x4df11c=[..._0x20b92d[_0xc96362(0x271)]['prod_code']],_0x48dd9f=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x246)]],_0x4e6a9f=[..._0x20b92d['body'][_0xc96362(0x212)]],_0x2a403e=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x21b)]],_0x11231d=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x233)]],_0x11aca1=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x27a)]],_0x48758e=[..._0x20b92d['body'][_0xc96362(0x217)]],_0x287956=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x221)]],_0x31783b=[..._0x20b92d['body'][_0xc96362(0x1fc)]],_0xa2bfc9=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x1dd)]],_0x5ebec8=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x277)]],_0x1e8968=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x2b2)]],_0x144805=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x21d)]],_0x24a9ba=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x1c3)]],_0x7826f3=[..._0x20b92d[_0xc96362(0x271)][_0xc96362(0x2b0)]];const _0x42787d=_0x4cdc36[_0xc96362(0x20f)](_0x380e1e=>{return _0x380e1e={'product_name':_0x380e1e};});_0x4df11c[_0xc96362(0x1e4)]((_0x5466eb,_0x3227a0)=>{var _0x4837f7=_0xc96362;_0x42787d[_0x3227a0][_0x4837f7(0x296)]=_0x5466eb,_0x42787d[_0x3227a0][_0x4837f7(0x1ed)]=_0x325337;}),_0x48dd9f['forEach']((_0x4350be,_0x1e4885)=>{var _0x3a8bd3=_0xc96362;_0x42787d[_0x1e4885][_0x3a8bd3(0x2a5)]=Math[_0x3a8bd3(0x243)](_0x4350be);}),_0x4e6a9f[_0xc96362(0x1e4)]((_0x179274,_0x48a198)=>{_0x42787d[_0x48a198]['standard_unit']=_0x179274;}),_0x2a403e[_0xc96362(0x1e4)]((_0x4c792b,_0x26becf)=>{var _0x4b786f=_0xc96362;_0x42787d[_0x26becf][_0x4b786f(0x274)]=_0x4c792b;}),_0x11231d[_0xc96362(0x1e4)]((_0x8fe597,_0x12d5b8)=>{var _0x356503=_0xc96362;_0x42787d[_0x12d5b8][_0x356503(0x254)]=_0x8fe597;}),_0x11aca1['forEach']((_0x537259,_0x130499)=>{var _0x1badb8=_0xc96362;_0x42787d[_0x130499][_0x1badb8(0x27a)]=_0x537259;}),_0x48758e['forEach']((_0x21b1bc,_0x56d23e)=>{var _0x357d53=_0xc96362;_0x42787d[_0x56d23e][_0x357d53(0x217)]=_0x21b1bc;}),_0x287956[_0xc96362(0x1e4)]((_0x2fda94,_0x3814bb)=>{_0x42787d[_0x3814bb]['maxStocks']=_0x2fda94;}),_0x31783b[_0xc96362(0x1e4)]((_0x323c84,_0x31ea5b)=>{var _0x5a0f2d=_0xc96362;_0x42787d[_0x31ea5b][_0x5a0f2d(0x1fc)]=_0x323c84;}),_0xa2bfc9['forEach']((_0x5aa1c5,_0x54c75c)=>{_0x42787d[_0x54c75c]['expiry_date']=_0x5aa1c5;}),_0x5ebec8[_0xc96362(0x1e4)]((_0x2ef53c,_0x3d95fe)=>{var _0x3dbc82=_0xc96362;_0x42787d[_0x3d95fe][_0x3dbc82(0x294)]=_0x2ef53c;}),_0x1e8968[_0xc96362(0x1e4)]((_0x255f0e,_0x68901a)=>{_0x42787d[_0x68901a]['maxperunit']=_0x255f0e;}),_0x144805['forEach']((_0x2c883b,_0x40fcb5)=>{var _0x10024e=_0xc96362;_0x42787d[_0x40fcb5][_0x10024e(0x1dc)]=_0x2c883b;}),_0x24a9ba[_0xc96362(0x1e4)]((_0x1a9a11,_0x38f1d5)=>{_0x42787d[_0x38f1d5]['room_name']=_0x1a9a11;}),_0x7826f3[_0xc96362(0x1e4)]((_0x1d3c55,_0x7084eb)=>{_0x42787d[_0x7084eb]['invoice']=_0x1d3c55;});const _0x45fccf=_0x42787d['filter'](_0x38afe4=>_0x38afe4[_0xc96362(0x2a5)]!=='0'&&_0x38afe4[_0xc96362(0x2a5)]!==''),_0x5f1cca=new purchases_finished({'invoice':_0x320b49,'suppliers':_0x20b92d['body']['suppliers'],'date':_0x325337,'warehouse_name':_0x4a16be,'product':_0x45fccf,'note':_0x44a070,'due_amount':_0x48442e,'room':_0x357f7e,'POnumber':_0x28e5ce,'SCRN':_0x8690a3,'JO_number':_0x100c7b}),_0x3e3c43=await _0x5f1cca['save'](),_0x95e8dd=await purchases_finished['findOne']({'invoice':_0x320b49}),_0x368291=_0x95e8dd[_0xc96362(0x223)][_0xc96362(0x20f)](async _0x493202=>{var _0x379ccc=_0xc96362;try{var _0x47a833=await warehouse[_0x379ccc(0x25b)]({'name':_0x4a16be,'room':_0x493202[_0x379ccc(0x1df)]}),_0x25307f=0x0;const _0x2e98d0=_0x47a833[_0x379ccc(0x24e)][_0x379ccc(0x20f)](_0x5a5e1e=>{var _0x4eb499=_0x379ccc;console[_0x4eb499(0x256)](_0x5a5e1e[_0x4eb499(0x25c)]+'=='+_0x493202[_0x4eb499(0x25c)]+'&&'+_0x5a5e1e[_0x4eb499(0x254)]+'=='+_0x493202[_0x4eb499(0x254)]+'&&'+_0x5a5e1e[_0x4eb499(0x1dd)]+'=='+_0x493202[_0x4eb499(0x1dd)]+'&&'+_0x5a5e1e[_0x4eb499(0x294)]+'=='+_0x493202[_0x4eb499(0x294)]+'&&'+_0x5a5e1e[_0x4eb499(0x1fc)]+'=='+_0x493202[_0x4eb499(0x1fc)]+'&&'+_0x5a5e1e[_0x4eb499(0x1c1)]+'=='+_0x95e8dd['invoice']),_0x5a5e1e[_0x4eb499(0x25c)]==_0x493202['product_name']&&_0x5a5e1e[_0x4eb499(0x254)]==_0x493202[_0x4eb499(0x254)]&&_0x5a5e1e['expiry_date']==_0x493202[_0x4eb499(0x1dd)]&&_0x5a5e1e[_0x4eb499(0x294)]==_0x493202[_0x4eb499(0x294)]&&_0x5a5e1e['batch_code']==_0x493202[_0x4eb499(0x1fc)]&&_0x5a5e1e['invoice']==_0x95e8dd[_0x4eb499(0x1c1)]&&(_0x5a5e1e[_0x4eb499(0x200)]=Math[_0x4eb499(0x243)](_0x5a5e1e[_0x4eb499(0x200)])+Math[_0x4eb499(0x243)](_0x493202[_0x4eb499(0x2a5)]),_0x25307f++);});return _0x25307f==0x0&&(_0x47a833[_0x379ccc(0x24e)]=_0x47a833[_0x379ccc(0x24e)]['concat']({'product_name':_0x493202['product_name'],'product_stock':Math['abs'](_0x493202[_0x379ccc(0x2a5)]),'primary_code':_0x493202[_0x379ccc(0x27a)],'secondary_code':_0x493202['secondary_code'],'product_code':_0x493202[_0x379ccc(0x296)],'bay':_0x493202['bay'],'maxProducts':_0x493202[_0x379ccc(0x270)],'unit':_0x493202[_0x379ccc(0x1e5)],'secondary_unit':_0x493202[_0x379ccc(0x274)],'expiry_date':_0x493202[_0x379ccc(0x1dd)],'production_date':_0x493202[_0x379ccc(0x294)],'maxProducts':_0x493202['maxStocks'],'maxPerUnit':_0x493202[_0x379ccc(0x21e)],'batch_code':_0x493202[_0x379ccc(0x1fc)],'product_cat':_0x493202[_0x379ccc(0x1dc)],'invoice':_0x493202[_0x379ccc(0x1c1)],'id_incoming':_0x493202['_id'],'date_data':_0x493202[_0x379ccc(0x1ed)]})),_0x47a833;}catch(_0x11c4f5){return console[_0x379ccc(0x26a)]('Error\x20occurred\x20while\x20processing\x20product:',_0x11c4f5),null;}});Promise['all'](_0x368291)['then'](async _0x452758=>{var _0xc73b32=_0xc96362;try{for(const _0x32aa14 of _0x452758){await warehouse[_0xc73b32(0x1f3)]({'_id':_0x32aa14[_0xc73b32(0x273)]},{'$addToSet':{'product_details':{'$each':_0x32aa14['product_details']}}});}const _0x10433a=await master_shop[_0xc73b32(0x297)](),_0x385776=await email_settings[_0xc73b32(0x25b)](),_0x32330c=await supervisor_settings['find']();var _0x3bb193=_0x95e8dd[_0xc73b32(0x223)],_0x11d5b9='',_0x1d63cb;for(_0x1d63cb in _0x3bb193){var _0x502ffd='FG';_0x95e8dd[_0xc73b32(0x258)]==_0xc73b32(0x24a)&&(_0x502ffd='DG'),_0x11d5b9+=_0xc73b32(0x232)+_0xc73b32(0x1d7)+_0x3bb193[_0x1d63cb][_0xc73b32(0x25c)]+_0xc73b32(0x1e1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3bb193[_0x1d63cb][_0xc73b32(0x296)]+_0xc73b32(0x1e1)+_0xc73b32(0x1d7)+_0x3bb193[_0x1d63cb][_0xc73b32(0x2a5)]+'</td>'+_0xc73b32(0x1d7)+_0x3bb193[_0x1d63cb][_0xc73b32(0x1e5)]+_0xc73b32(0x1e1)+_0xc73b32(0x1d7)+_0x3bb193[_0x1d63cb]['secondary_unit']+_0xc73b32(0x1e1)+_0xc73b32(0x1d7)+_0x95e8dd[_0xc73b32(0x258)]+_0xc73b32(0x1e1)+_0xc73b32(0x1d7)+_0x3bb193[_0x1d63cb][_0xc73b32(0x1df)]+_0xc73b32(0x1e1)+_0xc73b32(0x1d7)+_0x502ffd+_0x3bb193[_0x1d63cb][_0xc73b32(0x254)]+'</td>',_0xc73b32(0x1d4);}let _0x42f321=nodemailer[_0xc73b32(0x25a)]({'host':_0x385776[_0xc73b32(0x206)],'port':Number(_0x385776[_0xc73b32(0x1f1)]),'secure':![],'auth':{'user':_0x385776[_0xc73b32(0x1f0)],'pass':_0x385776[_0xc73b32(0x1fb)]}}),_0x404f49={'from':_0x385776[_0xc73b32(0x1f0)],'to':_0x32330c[0x0][_0xc73b32(0x1bf)],'subject':_0xc73b32(0x238),'attachments':[{'filename':'Logo.png','path':__dirname+_0xc73b32(0x211)+_0xc73b32(0x22c)+_0x10433a[0x0][_0xc73b32(0x1f5)],'cid':_0xc73b32(0x26d)}],'html':_0xc73b32(0x21a)+_0xc73b32(0x222)+_0xc73b32(0x23f)+'<div>'+_0xc73b32(0x26b)+'<div>'+_0xc73b32(0x26c)+_0xc73b32(0x203)+_0xc73b32(0x291)+'<h2>\x20'+_0x10433a[0x0][_0xc73b32(0x220)]+_0xc73b32(0x229)+_0xc73b32(0x203)+_0xc73b32(0x203)+_0xc73b32(0x22a)+_0xc73b32(0x291)+_0xc73b32(0x1ca)+'\x20Order\x20Number\x20:\x20'+_0x95e8dd[_0xc73b32(0x1c1)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0xc73b32(0x284)+_0x95e8dd[_0xc73b32(0x227)]+'\x20'+_0xc73b32(0x28e)+_0xc73b32(0x1b3)+_0xc73b32(0x203)+_0xc73b32(0x2a8)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xc73b32(0x232)+_0xc73b32(0x1de)+_0xc73b32(0x282)+_0xc73b32(0x207)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0xc73b32(0x1be)+_0xc73b32(0x1c8)+_0xc73b32(0x1bb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0xc73b32(0x1d4)+'</thead>'+_0xc73b32(0x1b0)+'\x20'+_0x11d5b9+'\x20'+_0xc73b32(0x250)+_0xc73b32(0x255)+_0xc73b32(0x291)+'<strong>\x20Regards\x20</strong>'+_0xc73b32(0x2ac)+_0x10433a[0x0][_0xc73b32(0x220)]+_0xc73b32(0x1b3)+'</div>'+_0xc73b32(0x203)+_0xc73b32(0x1ee)};_0x42f321[_0xc73b32(0x248)](_0x404f49,function(_0x2cd9d9,_0x3980c7){var _0xee6cf0=_0xc73b32;_0x2cd9d9?(console[_0xee6cf0(0x256)](_0x2cd9d9),console[_0xee6cf0(0x256)](_0xee6cf0(0x23e))):console[_0xee6cf0(0x256)](_0xee6cf0(0x226));});}catch(_0x179b41){console['error'](_0x179b41),_0x7897a8[_0xc73b32(0x1ef)](0x1f4)[_0xc73b32(0x26f)]({'error':_0xc73b32(0x20b),'message':_0x179b41[_0xc73b32(0x205)]});}})['catch'](_0x240c69=>{var _0x1cd2ca=_0xc96362;console[_0x1cd2ca(0x26a)](_0x240c69);}),_0x20b92d['flash'](_0xc96362(0x259),_0xc96362(0x2a2)),_0x7897a8[_0xc96362(0x24c)](_0xc96362(0x1c2));}catch(_0x2b1419){console[_0xc96362(0x256)](_0x2b1419);}}),router['get'](a0_0x3e3aff(0x2a6),auth,async(_0x3abf4e,_0x2e6f78)=>{var _0x358874=a0_0x3e3aff;try{const {username:_0x22a448,email:_0x2cd4a4,role:_0x41674d}=_0x3abf4e[_0x358874(0x253)],_0x590f6d=_0x3abf4e['user'],_0x100234=await profile[_0x358874(0x25b)]({'email':_0x590f6d['email']}),_0xff5266=await master_shop[_0x358874(0x297)](),_0x1ab6c6=_0x3abf4e['params']['id'],_0x3da4e8=await purchases_finished[_0x358874(0x1da)](_0x1ab6c6),_0xf2a3f1=await suppliers[_0x358874(0x297)]({});let _0x685bd7;if(_0x590f6d[_0x358874(0x25f)]==_0x358874(0x1c7)){const _0x2f75c2=await staff['findOne']({'email':_0x590f6d[_0x358874(0x1f0)]});_0x685bd7=await warehouse[_0x358874(0x297)]({'status':_0x358874(0x2aa),'name':_0x2f75c2[_0x358874(0x29f)],'warehouse_category':_0x358874(0x1b6)});}else _0x685bd7=await warehouse[_0x358874(0x290)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x358874(0x1d3),'name':{'$first':'$name'}}}]);const _0x510032=await product[_0x358874(0x297)]({}),_0x244b3c=BayBinSelected(_0x3da4e8[_0x358874(0x258)],_0x3da4e8[_0x358874(0x29c)]);let _0x1adddb=new Date(_0x3da4e8[_0x358874(0x1dd)]),_0x50ab62=('0'+_0x1adddb[_0x358874(0x1f2)]())['slice'](-0x2),_0x1d8e71=('0'+(_0x1adddb['getMonth']()+0x1))[_0x358874(0x22f)](-0x2),_0x38f25e=_0x1adddb[_0x358874(0x1cf)](),_0x5780b4=_0x38f25e+'-'+_0x1d8e71+'-'+_0x50ab62;if(_0xff5266[0x0][_0x358874(0x239)]==_0x358874(0x1d6)){var _0x468534=users['English'];console['log'](_0x468534);}else{if(_0xff5266[0x0][_0x358874(0x239)]==_0x358874(0x25d))var _0x468534=users[_0x358874(0x25d)];else{if(_0xff5266[0x0][_0x358874(0x239)]=='German')var _0x468534=users['German'];else{if(_0xff5266[0x0][_0x358874(0x239)]==_0x358874(0x1f9))var _0x468534=users[_0x358874(0x1f9)];else{if(_0xff5266[0x0][_0x358874(0x239)]==_0x358874(0x2a9))var _0x468534=users[_0x358874(0x2a9)];else{if(_0xff5266[0x0]['language']==_0x358874(0x23c))var _0x468534=users[_0x358874(0x1bd)];else{if(_0xff5266[0x0][_0x358874(0x239)]==_0x358874(0x1e8))var _0x468534=users['Chinese'];else{if(_0xff5266[0x0][_0x358874(0x239)]==_0x358874(0x1f6))var _0x468534=users[_0x358874(0x1c9)];}}}}}}}_0x2e6f78[_0x358874(0x1d8)](_0x358874(0x1eb),{'success':_0x3abf4e[_0x358874(0x280)](_0x358874(0x259)),'errors':_0x3abf4e['flash'](_0x358874(0x1d5)),'role':_0x590f6d,'profile':_0x100234,'purchases':_0x3da4e8,'suppliers':_0xf2a3f1,'warehouse':_0x685bd7,'product':_0x510032,'master_shop':_0xff5266,'language':_0x468534,'ed_fullDate':_0x5780b4,'dataSelected':_0x244b3c});}catch(_0x313b33){console['log'](_0x313b33);}}),router[a0_0x3e3aff(0x1ba)](a0_0x3e3aff(0x289),auth,async(_0x5cb8ab,_0xb448b2)=>{var _0x3f119b=a0_0x3e3aff;try{const {username:_0x52470e,email:_0x1c6f26,role:_0xd86056}=_0x5cb8ab[_0x3f119b(0x253)],_0x38479a=_0x5cb8ab[_0x3f119b(0x253)],_0x598db0=await profile[_0x3f119b(0x25b)]({'email':_0x38479a['email']}),_0x5d3e0a=await master_shop['find'](),_0x5a089b=_0x5cb8ab[_0x3f119b(0x1b1)]['id'],_0x4c6b87=await purchases_finished[_0x3f119b(0x1da)](_0x5a089b),_0x32055a=await suppliers[_0x3f119b(0x297)]({});let _0x17d00a;if(_0x38479a[_0x3f119b(0x25f)]==_0x3f119b(0x1c7)){const _0x3e6871=await staff[_0x3f119b(0x25b)]({'email':_0x38479a[_0x3f119b(0x1f0)]});_0x17d00a=await warehouse[_0x3f119b(0x297)]({'status':_0x3f119b(0x2aa),'name':_0x3e6871[_0x3f119b(0x29f)],'warehouse_category':'Finished\x20Goods'});}else _0x17d00a=await warehouse[_0x3f119b(0x290)]([{'$match':{'status':_0x3f119b(0x2aa),'warehouse_category':_0x3f119b(0x1b6)}},{'$group':{'_id':_0x3f119b(0x1d3),'name':{'$first':'$name'}}}]);const _0x595cee=await product[_0x3f119b(0x297)]({}),_0x1bff43=BayBinSelected(_0x4c6b87[_0x3f119b(0x258)],_0x4c6b87[_0x3f119b(0x29c)]);let _0x268d31=new Date(_0x4c6b87[_0x3f119b(0x1dd)]),_0x3c088c=('0'+_0x268d31[_0x3f119b(0x1f2)]())[_0x3f119b(0x22f)](-0x2),_0x16d412=('0'+(_0x268d31[_0x3f119b(0x20d)]()+0x1))['slice'](-0x2),_0x11f329=_0x268d31['getFullYear'](),_0xe269cd=_0x11f329+'-'+_0x16d412+'-'+_0x3c088c;if(_0x5d3e0a[0x0]['language']=='English\x20(US)'){var _0x3ff899=users[_0x3f119b(0x1b5)];console[_0x3f119b(0x256)](_0x3ff899);}else{if(_0x5d3e0a[0x0]['language']==_0x3f119b(0x25d))var _0x3ff899=users[_0x3f119b(0x25d)];else{if(_0x5d3e0a[0x0][_0x3f119b(0x239)]=='German')var _0x3ff899=users[_0x3f119b(0x288)];else{if(_0x5d3e0a[0x0][_0x3f119b(0x239)]==_0x3f119b(0x1f9))var _0x3ff899=users['Spanish'];else{if(_0x5d3e0a[0x0][_0x3f119b(0x239)]==_0x3f119b(0x2a9))var _0x3ff899=users['French'];else{if(_0x5d3e0a[0x0]['language']==_0x3f119b(0x23c))var _0x3ff899=users[_0x3f119b(0x1bd)];else{if(_0x5d3e0a[0x0][_0x3f119b(0x239)]==_0x3f119b(0x1e8))var _0x3ff899=users[_0x3f119b(0x1e8)];else{if(_0x5d3e0a[0x0]['language']==_0x3f119b(0x1f6))var _0x3ff899=users[_0x3f119b(0x1c9)];}}}}}}}_0xb448b2[_0x3f119b(0x1d8)](_0x3f119b(0x241),{'success':_0x5cb8ab[_0x3f119b(0x280)](_0x3f119b(0x259)),'errors':_0x5cb8ab[_0x3f119b(0x280)](_0x3f119b(0x1d5)),'role':_0x38479a,'profile':_0x598db0,'purchases':_0x4c6b87,'suppliers':_0x32055a,'warehouse':_0x17d00a,'product':_0x595cee,'master_shop':_0x5d3e0a,'language':_0x3ff899,'ed_fullDate':_0xe269cd,'dataSelected':_0x1bff43});}catch(_0x3bbe13){console['log'](_0x3bbe13);}}),router['post'](a0_0x3e3aff(0x289),auth,async(_0x4651a9,_0x5612d2)=>{var _0x29420f=a0_0x3e3aff;try{const _0x1d2666=_0x4651a9['params']['id'],_0x5bef4b=await purchases_finished[_0x29420f(0x25b)]({'_id':_0x4651a9['params']['id']}),_0x49ae27=await warehouse[_0x29420f(0x25b)]({'name':_0x5bef4b[_0x29420f(0x258)],'room':_0x5bef4b[_0x29420f(0x29c)]});_0x5bef4b[_0x29420f(0x223)][_0x29420f(0x1e4)](_0x10ae36=>{var _0x47827c=_0x29420f;const _0x5911a7=_0x49ae27[_0x47827c(0x24e)][_0x47827c(0x20f)](_0x2b1dce=>{var _0x55904a=_0x47827c;_0x2b1dce['product_name']==_0x10ae36[_0x55904a(0x25c)]&&_0x2b1dce[_0x55904a(0x254)]==_0x10ae36[_0x55904a(0x254)]&&(_0x2b1dce['product_stock']=parseInt(_0x2b1dce[_0x55904a(0x200)])-parseInt(_0x10ae36[_0x55904a(0x2a5)]));});}),await _0x49ae27[_0x29420f(0x293)]();const {invoice:_0xcfd1c5,suppliers:_0x2820b8,date:_0xc8f71f,warehouse_name:_0x889e1b,prod_name:_0x5061a7,prod_code:_0x357e25,prod_qty:_0x162486,prod_unit:_0x5f183f,prod_secondunit:_0xe7b35d,prod_level:_0x4ba78e,prod_isle:_0x177620,prod_pallet:_0x595fc0,note:_0x33c200,expiry_date:_0x1d1215,batch_code:_0x5244cc,paid_amount:_0x23936f,due_amount:_0x4e92e7,Room_name:_0x1aa61c,primary_code:_0x405417,secondary_code:_0x3266c8,PO_number:_0x3d0d89,JO_number:_0x4f4d26}=_0x4651a9[_0x29420f(0x271)];if(typeof _0x5061a7=='string')var _0x137ad3=[_0x4651a9[_0x29420f(0x271)][_0x29420f(0x251)]],_0x2f5e7a=[_0x4651a9[_0x29420f(0x271)][_0x29420f(0x281)]],_0x1c833b=[_0x4651a9['body']['prod_qty']],_0x208fef=[_0x4651a9[_0x29420f(0x271)]['prod_unit']],_0x3132bb=[_0x4651a9[_0x29420f(0x271)]['prod_secondunit']],_0x425a96=[_0x4651a9[_0x29420f(0x271)][_0x29420f(0x233)]],_0x1ee76e=[_0x4651a9[_0x29420f(0x271)][_0x29420f(0x27a)]],_0x26ec28=[_0x4651a9[_0x29420f(0x271)][_0x29420f(0x217)]],_0x154493=[_0x4651a9[_0x29420f(0x271)][_0x29420f(0x221)]],_0xacfc8=[_0x4651a9[_0x29420f(0x271)][_0x29420f(0x1fc)]],_0x5da491=[_0x4651a9[_0x29420f(0x271)][_0x29420f(0x1dd)]];else var _0x137ad3=[..._0x4651a9[_0x29420f(0x271)]['prod_name']],_0x2f5e7a=[..._0x4651a9[_0x29420f(0x271)]['prod_code']],_0x1c833b=[..._0x4651a9[_0x29420f(0x271)][_0x29420f(0x24b)]],_0x208fef=[..._0x4651a9['body'][_0x29420f(0x1ff)]],_0x3132bb=[..._0x4651a9[_0x29420f(0x271)][_0x29420f(0x21b)]],_0x425a96=[..._0x4651a9['body'][_0x29420f(0x233)]],_0x1ee76e=[..._0x4651a9[_0x29420f(0x271)][_0x29420f(0x27a)]],_0x26ec28=[..._0x4651a9[_0x29420f(0x271)][_0x29420f(0x217)]],_0x154493=[..._0x4651a9[_0x29420f(0x271)][_0x29420f(0x221)]],_0xacfc8=[..._0x4651a9[_0x29420f(0x271)]['batch_code']],_0x5da491=[..._0x4651a9[_0x29420f(0x271)][_0x29420f(0x1dd)]];const _0x219b23=_0x137ad3[_0x29420f(0x20f)](_0x553505=>{return _0x553505={'product_name':_0x553505};});_0x2f5e7a[_0x29420f(0x1e4)]((_0x182e79,_0x5a3a84)=>{_0x219b23[_0x5a3a84]['product_code']=_0x182e79;}),_0x1c833b[_0x29420f(0x1e4)]((_0x345029,_0x35aaa8)=>{_0x219b23[_0x35aaa8]['quantity']=_0x345029;}),_0x208fef['forEach']((_0x21e9a6,_0x1b3b54)=>{var _0x4d9ee4=_0x29420f;_0x219b23[_0x1b3b54][_0x4d9ee4(0x1e5)]=_0x21e9a6;}),_0x3132bb['forEach']((_0x50feeb,_0x4eed4f)=>{var _0x49c9ce=_0x29420f;_0x219b23[_0x4eed4f][_0x49c9ce(0x274)]=_0x50feeb;}),_0x425a96[_0x29420f(0x1e4)]((_0x29f22b,_0x514771)=>{var _0x4bfbd5=_0x29420f;_0x219b23[_0x514771][_0x4bfbd5(0x254)]=_0x29f22b;}),_0x1ee76e[_0x29420f(0x1e4)]((_0x267bd3,_0x55160a)=>{var _0x22262f=_0x29420f;_0x219b23[_0x55160a][_0x22262f(0x27a)]=_0x267bd3;}),_0x26ec28[_0x29420f(0x1e4)]((_0x1f1344,_0x46d8a8)=>{var _0x4742b7=_0x29420f;_0x219b23[_0x46d8a8][_0x4742b7(0x217)]=_0x1f1344;}),_0x154493[_0x29420f(0x1e4)]((_0x2f29a3,_0x126b2f)=>{var _0x3beccb=_0x29420f;_0x219b23[_0x126b2f][_0x3beccb(0x270)]=_0x2f29a3;}),_0xacfc8[_0x29420f(0x1e4)]((_0x266b4d,_0x44615e)=>{_0x219b23[_0x44615e]['batch_code']=_0x266b4d;}),_0x5da491[_0x29420f(0x1e4)]((_0x1c4062,_0x30c44e)=>{var _0x1b253b=_0x29420f;_0x219b23[_0x30c44e][_0x1b253b(0x1dd)]=_0x1c4062;});const _0x5c2209=_0x219b23['filter'](_0x4f19bd=>_0x4f19bd[_0x29420f(0x2a5)]!=='0'&&_0x4f19bd['quantity']!=='');_0x5bef4b[_0x29420f(0x1c1)]=_0xcfd1c5,_0x5bef4b[_0x29420f(0x2a1)]=_0x2820b8,_0x5bef4b[_0x29420f(0x227)]=_0xc8f71f,_0x5bef4b[_0x29420f(0x258)]=_0x889e1b,_0x5bef4b[_0x29420f(0x223)]=_0x5c2209,_0x5bef4b[_0x29420f(0x1b2)]=_0x33c200,_0x5bef4b[_0x29420f(0x28a)]=_0x23936f,_0x5bef4b[_0x29420f(0x21c)]=_0x4e92e7,_0x5bef4b[_0x29420f(0x29c)]=_0x1aa61c,_0x5bef4b[_0x29420f(0x1fa)]=_0x3d0d89,_0x5bef4b['JO_number']=_0x4f4d26;const _0x23d286=await _0x5bef4b[_0x29420f(0x293)](),_0x291a75=await warehouse[_0x29420f(0x25b)]({'name':_0x4651a9[_0x29420f(0x271)][_0x29420f(0x258)],'room':_0x4651a9[_0x29420f(0x271)][_0x29420f(0x20a)]});_0x5bef4b[_0x29420f(0x223)][_0x29420f(0x1e4)](_0x242cb1=>{var _0x3c8fc2=_0x29420f,_0x5d90d2=0x0;const _0x3f17e3=_0x291a75[_0x3c8fc2(0x24e)][_0x3c8fc2(0x20f)](_0x3976b4=>{var _0x5ee2f4=_0x3c8fc2;_0x3976b4['product_name']==_0x242cb1[_0x5ee2f4(0x25c)]&&_0x3976b4[_0x5ee2f4(0x254)]==_0x242cb1[_0x5ee2f4(0x254)]&&(_0x3976b4[_0x5ee2f4(0x200)]=parseInt(_0x3976b4[_0x5ee2f4(0x200)])+parseInt(_0x242cb1[_0x5ee2f4(0x2a5)]),_0x5d90d2++);});_0x5d90d2=='0'&&(_0x291a75[_0x3c8fc2(0x24e)]=_0x291a75[_0x3c8fc2(0x24e)][_0x3c8fc2(0x28f)]({'product_name':_0x242cb1[_0x3c8fc2(0x25c)],'product_stock':_0x242cb1[_0x3c8fc2(0x2a5)],'primary_code':_0x242cb1[_0x3c8fc2(0x27a)],'secondary_code':_0x242cb1[_0x3c8fc2(0x217)],'product_code':_0x242cb1[_0x3c8fc2(0x296)],'bay':_0x242cb1[_0x3c8fc2(0x254)],'maxProducts':_0x242cb1[_0x3c8fc2(0x270)],'unit':_0x242cb1[_0x3c8fc2(0x1e5)],'secondary_unit':_0x242cb1[_0x3c8fc2(0x274)],'expiry_date':_0x242cb1[_0x3c8fc2(0x1dd)]}));}),await _0x291a75['save']();const _0x2121b4=await s_payment_data[_0x29420f(0x25b)]({'invoice':_0x4651a9[_0x29420f(0x271)][_0x29420f(0x1c1)]});if(_0x2121b4===null){}else console[_0x29420f(0x256)](_0x29420f(0x2a1),_0x2121b4,_0x4651a9[_0x29420f(0x271)][_0x29420f(0x1c1)]),_0x2121b4[_0x29420f(0x2a1)]=_0x4651a9[_0x29420f(0x271)][_0x29420f(0x2a1)],await _0x2121b4[_0x29420f(0x293)]();_0x4651a9[_0x29420f(0x280)]('success',_0x29420f(0x275)),_0x5612d2[_0x29420f(0x24c)](_0x29420f(0x1c2));}catch(_0x2adeab){console['log'](_0x2adeab);}}),router[a0_0x3e3aff(0x22d)]('/give_payment/:id',auth,async(_0x1a7cd9,_0x111826)=>{var _0x53b9d5=a0_0x3e3aff;try{const _0x589664=_0x1a7cd9[_0x53b9d5(0x1b1)]['id'],{invoice:_0x5a1602,suppliers:_0xc9abfc,payable:_0x3fb997,due_amount:_0x403e87}=_0x1a7cd9['body'],_0xaa3d0=await purchases[_0x53b9d5(0x1da)](_0x589664);var _0x598cb3=_0x3fb997-_0x403e87;_0xaa3d0['paid_amount']=parseFloat(_0xaa3d0['paid_amount'])+parseFloat(_0x403e87),_0xaa3d0[_0x53b9d5(0x21c)]=_0x598cb3;const _0x4126a5=await _0xaa3d0[_0x53b9d5(0x293)]();console[_0x53b9d5(0x256)](_0x4126a5);const _0x1614ef=await s_payment_data[_0x53b9d5(0x25b)]({'invoice':_0x5a1602});_0x1614ef[_0x53b9d5(0x263)]=_0x598cb3,await _0x1614ef['save']();let _0x512ec1=new Date(),_0x253749=('0'+_0x512ec1[_0x53b9d5(0x1f2)]())[_0x53b9d5(0x22f)](-0x2),_0x92acf4=('0'+(_0x512ec1['getMonth']()+0x1))['slice'](-0x2),_0x1e1a22=_0x512ec1[_0x53b9d5(0x1cf)](),_0x59f1f7=_0x1e1a22+'-'+_0x92acf4+'-'+_0x253749;const _0x1eec6f=new suppliers_payment({'invoice':_0x5a1602,'date':_0x1e1a22+'-'+_0x92acf4+'-'+_0x253749,'suppliers':_0xc9abfc,'reason':_0x53b9d5(0x1c4),'amount':_0x403e87}),_0x4d3fac=await _0x1eec6f[_0x53b9d5(0x293)]();_0x1a7cd9[_0x53b9d5(0x280)](_0x53b9d5(0x259),_0x53b9d5(0x1e7)),_0x111826[_0x53b9d5(0x24c)](_0x53b9d5(0x1cb));}catch(_0x393023){console[_0x53b9d5(0x256)](_0x393023);}}),router[a0_0x3e3aff(0x1ba)](a0_0x3e3aff(0x1fe),auth,async(_0x2c4122,_0x2b741f)=>{var _0x167fee=a0_0x3e3aff;try{const {username:_0x1a12dd,email:_0x3f1a1b,role:_0x59fbfe}=_0x2c4122[_0x167fee(0x253)],_0x2bcae9=_0x2c4122[_0x167fee(0x253)],_0x26910d=await profile['findOne']({'email':_0x2bcae9[_0x167fee(0x1f0)]}),_0x246e6a=await master_shop[_0x167fee(0x297)]();console[_0x167fee(0x256)]('master',_0x246e6a);const _0xbfd337=_0x2c4122[_0x167fee(0x1b1)]['id'],_0x3b768b=await purchases[_0x167fee(0x1da)](_0xbfd337);console[_0x167fee(0x256)](_0x3b768b);const _0x1a905a=await suppliers['findOne']({'name':_0x3b768b[_0x167fee(0x2a1)]});console[_0x167fee(0x256)](_0x1a905a);if(_0x246e6a[0x0][_0x167fee(0x239)]=='English\x20(US)'){var _0x2fe29e=users[_0x167fee(0x1b5)];console[_0x167fee(0x256)](_0x2fe29e);}else{if(_0x246e6a[0x0]['language']=='Hindi')var _0x2fe29e=users[_0x167fee(0x25d)];else{if(_0x246e6a[0x0][_0x167fee(0x239)]=='German')var _0x2fe29e=users[_0x167fee(0x288)];else{if(_0x246e6a[0x0]['language']=='Spanish')var _0x2fe29e=users[_0x167fee(0x1f9)];else{if(_0x246e6a[0x0][_0x167fee(0x239)]==_0x167fee(0x2a9))var _0x2fe29e=users[_0x167fee(0x2a9)];else{if(_0x246e6a[0x0][_0x167fee(0x239)]=='Portuguese\x20(BR)')var _0x2fe29e=users[_0x167fee(0x1bd)];else{if(_0x246e6a[0x0][_0x167fee(0x239)]=='Chinese')var _0x2fe29e=users[_0x167fee(0x1e8)];else{if(_0x246e6a[0x0][_0x167fee(0x239)]==_0x167fee(0x1f6))var _0x2fe29e=users[_0x167fee(0x1c9)];}}}}}}}_0x2b741f['render'](_0x167fee(0x266),{'success':_0x2c4122[_0x167fee(0x280)](_0x167fee(0x259)),'errors':_0x2c4122['flash']('errors'),'role':_0x2bcae9,'profile':_0x26910d,'master_shop':_0x246e6a,'supplier':_0x1a905a,'purchase':_0x3b768b,'language':_0x2fe29e});}catch(_0x4f72fa){console[_0x167fee(0x256)](_0x4f72fa);}}),router[a0_0x3e3aff(0x1ba)](a0_0x3e3aff(0x236),auth,async(_0x4b42ce,_0x53ade2)=>{var _0x27ae03=a0_0x3e3aff;try{const {username:_0x3809e6,email:_0x1ac8dc,role:_0xf9f963}=_0x4b42ce[_0x27ae03(0x253)],_0x20e21d=_0x4b42ce[_0x27ae03(0x253)],_0x39a1db=await profile[_0x27ae03(0x25b)]({'email':_0x20e21d['email']}),_0x25a795=await master_shop[_0x27ae03(0x297)]();console[_0x27ae03(0x256)]('master',_0x25a795);const _0x1c0fdc=_0x4b42ce['params']['id'];console[_0x27ae03(0x256)](_0x1c0fdc);const _0x4423e7=await purchases_finished[_0x27ae03(0x1da)](_0x1c0fdc);console[_0x27ae03(0x256)](_0x27ae03(0x219),_0x4423e7);const _0x2f3177=await product['find']({}),_0x8c73c0=await warehouse[_0x27ae03(0x290)]([{'$match':{'name':_0x4423e7[_0x27ae03(0x258)],'room':_0x4423e7['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x27ae03(0x245),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x27ae03(0x267)},'bin':{'$first':_0x27ae03(0x215)},'type':{'$first':_0x27ae03(0x210)},'floorlevel':{'$first':_0x27ae03(0x201)},'primary_code':{'$first':_0x27ae03(0x1d9)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x27ae03(0x2b1)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x27ae03(0x256)](_0x27ae03(0x278),_0x8c73c0);let _0x3a102a;if(_0x20e21d['role']==_0x27ae03(0x1c7)){const _0x5afba6=await staff['findOne']({'email':_0x20e21d['email']});_0x3a102a=await warehouse[_0x27ae03(0x297)]({'status':_0x27ae03(0x2aa),'name':_0x5afba6[_0x27ae03(0x29f)],'warehouse_category':_0x27ae03(0x1b6),'name':_0x27ae03(0x1e9)});}else _0x3a102a=await warehouse[_0x27ae03(0x290)]([{'$match':{'status':_0x27ae03(0x2aa),'warehouse_category':_0x27ae03(0x1b6),'name':_0x27ae03(0x1e9)}},{'$group':{'_id':_0x27ae03(0x1d3),'name':{'$first':'$name'}}}]);if(_0x25a795[0x0][_0x27ae03(0x239)]==_0x27ae03(0x1d6)){var _0x30ebc1=users['English'];console[_0x27ae03(0x256)](_0x30ebc1);}else{if(_0x25a795[0x0]['language']=='Hindi')var _0x30ebc1=users['Hindi'];else{if(_0x25a795[0x0]['language']==_0x27ae03(0x288))var _0x30ebc1=users[_0x27ae03(0x288)];else{if(_0x25a795[0x0][_0x27ae03(0x239)]==_0x27ae03(0x1f9))var _0x30ebc1=users[_0x27ae03(0x1f9)];else{if(_0x25a795[0x0][_0x27ae03(0x239)]==_0x27ae03(0x2a9))var _0x30ebc1=users[_0x27ae03(0x2a9)];else{if(_0x25a795[0x0]['language']==_0x27ae03(0x23c))var _0x30ebc1=users[_0x27ae03(0x1bd)];else{if(_0x25a795[0x0][_0x27ae03(0x239)]=='Chinese')var _0x30ebc1=users[_0x27ae03(0x1e8)];else{if(_0x25a795[0x0]['language']==_0x27ae03(0x1f6))var _0x30ebc1=users['Arabic'];}}}}}}}_0x53ade2[_0x27ae03(0x1d8)](_0x27ae03(0x231),{'success':_0x4b42ce['flash'](_0x27ae03(0x259)),'errors':_0x4b42ce[_0x27ae03(0x280)](_0x27ae03(0x1d5)),'role':_0x20e21d,'profile':_0x39a1db,'user':_0x4423e7,'stock':_0x8c73c0,'master_shop':_0x25a795,'product':_0x2f3177,'language':_0x30ebc1,'warehouse':_0x3a102a});}catch(_0x48d187){console[_0x27ae03(0x256)](_0x48d187);}}),router['post'](a0_0x3e3aff(0x236),auth,async(_0x128213,_0xdccb14)=>{var _0x2b8e03=a0_0x3e3aff;try{const {invoice:_0x5d041c,date:_0x2278d4,warehouse_name:_0xe63a5a,Room_name:_0xa64e0c,product_name:_0x196cfa,purchase_quantity:_0x395790,stocks:_0x34c057,return_qty:_0x30069c,note:_0x5cd4ff,level:_0x36f4f2,isle:_0x50f37e,pallet:_0x4ded40,to_warehouse_name:_0x452ffc,to_Room_name:_0x1ecc73}=_0x128213[_0x2b8e03(0x271)],_0x5df474=await purchases_finished[_0x2b8e03(0x25b)]({'_id':_0x128213[_0x2b8e03(0x1b1)]['id']}),_0x5de46c=await warehouse['findOne']({'name':_0xe63a5a,'room':_0xa64e0c,'warehouse_category':'Finished\x20Goods'});if(typeof _0x196cfa=='string')var _0x16f8ed=[_0x128213['body'][_0x2b8e03(0x25c)]],_0x1210c7=[_0x128213[_0x2b8e03(0x271)]['purchase_quantity']],_0x2adda1=[_0x128213['body']['stocks']],_0x40c9f2=[_0x128213['body']['return_qty']],_0x562619=[_0x128213[_0x2b8e03(0x271)][_0x2b8e03(0x216)]],_0x27b483=[_0x128213[_0x2b8e03(0x271)]['product_code_hide']],_0xda2d7c=[_0x128213['body'][_0x2b8e03(0x22b)]],_0x55873b=[_0x128213[_0x2b8e03(0x271)][_0x2b8e03(0x20e)]];else var _0x16f8ed=[..._0x128213['body']['product_name']],_0x1210c7=[..._0x128213[_0x2b8e03(0x271)][_0x2b8e03(0x286)]],_0x2adda1=[..._0x128213[_0x2b8e03(0x271)][_0x2b8e03(0x202)]],_0x40c9f2=[..._0x128213[_0x2b8e03(0x271)][_0x2b8e03(0x23a)]],_0x562619=[..._0x128213[_0x2b8e03(0x271)][_0x2b8e03(0x216)]],_0x27b483=[..._0x128213[_0x2b8e03(0x271)][_0x2b8e03(0x27c)]],_0xda2d7c=[..._0x128213['body']['primary_code_hide']],_0x55873b=[..._0x128213[_0x2b8e03(0x271)][_0x2b8e03(0x20e)]];const _0x2aa504=_0x16f8ed[_0x2b8e03(0x20f)](_0x28e91b=>{return _0x28e91b={'product_name':_0x28e91b};});_0x1210c7['forEach']((_0x3245ab,_0x2639c2)=>{var _0x276090=_0x2b8e03;_0x2aa504[_0x2639c2][_0x276090(0x286)]=_0x3245ab;}),_0x2adda1[_0x2b8e03(0x1e4)]((_0x3a7adb,_0x5206fa)=>{var _0x1f8086=_0x2b8e03;_0x2aa504[_0x5206fa][_0x1f8086(0x292)]=_0x3a7adb;}),_0x40c9f2[_0x2b8e03(0x1e4)]((_0x360d45,_0x1af2b5)=>{_0x2aa504[_0x1af2b5]['return_qty']=_0x360d45;}),_0x562619[_0x2b8e03(0x1e4)]((_0x24c9a0,_0x36a284)=>{_0x2aa504[_0x36a284]['bay']=_0x24c9a0;}),_0x27b483['forEach']((_0x1ed4cd,_0x12552f)=>{var _0x3e9aed=_0x2b8e03;_0x2aa504[_0x12552f][_0x3e9aed(0x296)]=_0x1ed4cd;}),_0xda2d7c[_0x2b8e03(0x1e4)]((_0xde613c,_0x364ff2)=>{var _0x1ed1a8=_0x2b8e03;_0x2aa504[_0x364ff2][_0x1ed1a8(0x27a)]=_0xde613c;}),_0x55873b[_0x2b8e03(0x1e4)]((_0x4c42fd,_0x442b34)=>{var _0x3c584c=_0x2b8e03;_0x2aa504[_0x442b34][_0x3c584c(0x217)]=_0x4c42fd;}),_0x2aa504[_0x2b8e03(0x1e4)](_0x598a84=>{var _0x2d3cb0=_0x2b8e03;console[_0x2d3cb0(0x256)](_0x598a84);const _0x3718bf=_0x5de46c['product_details'][_0x2d3cb0(0x20f)](_0x776737=>{var _0x3e05c7=_0x2d3cb0;_0x776737[_0x3e05c7(0x25c)]==_0x598a84[_0x3e05c7(0x25c)]&&_0x776737['bay']==_0x598a84[_0x3e05c7(0x254)]&&(console['log'](parseInt(_0x776737[_0x3e05c7(0x200)])+_0x3e05c7(0x29e)+parseInt(_0x598a84[_0x3e05c7(0x23a)])),_0x776737[_0x3e05c7(0x200)]=parseInt(_0x776737['product_stock'])-parseInt(_0x598a84[_0x3e05c7(0x23a)]));});}),await _0x5de46c[_0x2b8e03(0x293)]();var _0x4428e5=0x0;_0x2aa504[_0x2b8e03(0x1e4)](_0x345a13=>{var _0x5cbffe=_0x2b8e03;(parseInt(_0x345a13[_0x5cbffe(0x286)])<parseInt(_0x345a13['return_qty'])||parseInt(_0x345a13[_0x5cbffe(0x292)])<parseInt(_0x345a13['return_qty']))&&_0x4428e5++;});if(_0x4428e5!=0x0)return _0x128213[_0x2b8e03(0x280)]('errors',_0x2b8e03(0x29d)),_0xdccb14[_0x2b8e03(0x24c)](_0x2b8e03(0x23b));const _0x23d2c8=new purchases_return_finished({'invoice':_0x5d041c,'suppliers':_0x128213[_0x2b8e03(0x271)][_0x2b8e03(0x2a1)],'date':_0x2278d4,'warehouse_name':_0xe63a5a,'return_product':_0x2aa504,'note':_0x5cd4ff,'room':_0xa64e0c,'to_warehouse_name':_0x452ffc,'to_room':_0x1ecc73}),_0x53cc39=await _0x23d2c8[_0x2b8e03(0x293)](),_0x2b1f39=await purchases_return_finished['findOne']({'invoice':_0x5d041c}),_0x384e08=await warehouse[_0x2b8e03(0x25b)]({'name':_0x452ffc,'room':_0x1ecc73,'warehouse_category':_0x2b8e03(0x1b6)});_0x2b1f39['return_product'][_0x2b8e03(0x1e4)](_0x13fd67=>{var _0x264145=_0x2b8e03,_0x1ec644=0x0;const _0x4d9373=_0x384e08['product_details'][_0x264145(0x20f)](_0xd5450f=>{var _0x55af9f=_0x264145;console[_0x55af9f(0x256)](_0xd5450f['product_name']+'=='+_0x13fd67[_0x55af9f(0x25c)]+'&&'+_0xd5450f[_0x55af9f(0x254)]+'=='+_0x13fd67['bay']),_0xd5450f['product_name']==_0x13fd67[_0x55af9f(0x25c)]&&_0xd5450f[_0x55af9f(0x254)]==_0x13fd67[_0x55af9f(0x254)]&&(_0xd5450f[_0x55af9f(0x200)]=parseInt(_0xd5450f['product_stock'])-parseInt(_0x13fd67[_0x55af9f(0x23a)]),_0x1ec644++);});_0x1ec644=='0'&&(_0x384e08[_0x264145(0x24e)]=_0x384e08['product_details'][_0x264145(0x28f)]({'product_name':_0x13fd67[_0x264145(0x25c)],'product_stock':_0x13fd67[_0x264145(0x23a)],'primary_code':_0x13fd67[_0x264145(0x27a)],'secondary_code':_0x13fd67[_0x264145(0x217)],'product_code':_0x13fd67[_0x264145(0x296)],'bay':_0x13fd67[_0x264145(0x254)],'maxProducts':0xf423f}));}),await _0x384e08['save']();const _0x44f7ef=await purchases_finished['findOne']({'invoice':_0x5d041c});_0x44f7ef[_0x2b8e03(0x24f)]=_0x2b8e03(0x1f7);const _0x58a2a3=await _0x44f7ef[_0x2b8e03(0x293)](),_0x146f41=new s_payment_data({'invoice':_0x5d041c,'suppliers':_0x128213['body']['suppliers'],'reason':_0x2b8e03(0x26e)});await _0x146f41[_0x2b8e03(0x293)]();const _0x5a8e81=await master_shop[_0x2b8e03(0x297)](),_0x213d0f=await email_settings[_0x2b8e03(0x25b)](),_0x2080c2=await suppliers[_0x2b8e03(0x25b)]({'name':_0x128213[_0x2b8e03(0x271)][_0x2b8e03(0x2a1)]});_0x5a8e81[0x0][_0x2b8e03(0x1b9)]==0x1?(right_currency=_0x5a8e81[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5a8e81[0x0][_0x2b8e03(0x237)]);var _0x4f8f9a=_0x16f8ed,_0x259891=_0x40c9f2,_0x9edfd0='',_0x3d711f;for(_0x3d711f in _0x4f8f9a){_0x9edfd0+=_0x2b8e03(0x232)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4f8f9a[_0x3d711f]+_0x2b8e03(0x1e1)+_0x2b8e03(0x1d7)+_0x259891[_0x3d711f]+_0x2b8e03(0x1e1)+_0x2b8e03(0x1d4);}let _0x36f576=nodemailer[_0x2b8e03(0x25a)]({'service':_0x2b8e03(0x2ae),'auth':{'user':_0x213d0f['email'],'pass':_0x213d0f[_0x2b8e03(0x1fb)]}}),_0xc849cc={'from':_0x213d0f[_0x2b8e03(0x1f0)],'to':_0x2080c2[_0x2b8e03(0x1f0)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x2b8e03(0x298),'path':__dirname+_0x2b8e03(0x211)+'/upload/'+_0x5a8e81[0x0][_0x2b8e03(0x1f5)],'cid':'logo'}],'html':_0x2b8e03(0x21a)+_0x2b8e03(0x222)+_0x2b8e03(0x23f)+'<div>'+_0x2b8e03(0x26b)+_0x2b8e03(0x291)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2b8e03(0x203)+_0x2b8e03(0x291)+_0x2b8e03(0x247)+_0x5a8e81[0x0][_0x2b8e03(0x220)]+'\x20</h2>'+'</div>'+_0x2b8e03(0x203)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x2b8e03(0x1ca)+_0x2b8e03(0x262)+_0x5d041c+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x2278d4+'\x20'+_0x2b8e03(0x28e)+_0x2b8e03(0x1b3)+_0x2b8e03(0x203)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2b8e03(0x299)+_0x2b8e03(0x232)+_0x2b8e03(0x1de)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x2b8e03(0x257)+_0x2b8e03(0x208)+'</tr>'+_0x2b8e03(0x1c6)+_0x2b8e03(0x1b0)+'\x20'+_0x9edfd0+'\x20'+_0x2b8e03(0x250)+_0x2b8e03(0x255)+_0x2b8e03(0x291)+_0x2b8e03(0x224)+_0x2b8e03(0x2ac)+_0x5a8e81[0x0][_0x2b8e03(0x220)]+_0x2b8e03(0x1b3)+_0x2b8e03(0x203)+'</div>'+'</body></html>'};_0x36f576[_0x2b8e03(0x248)](_0xc849cc,function(_0x32fbe2,_0x419fe3){var _0x1eb1f5=_0x2b8e03;_0x32fbe2?console[_0x1eb1f5(0x256)](_0x1eb1f5(0x23e)):console[_0x1eb1f5(0x256)](_0x1eb1f5(0x226));}),_0x128213['flash'](_0x2b8e03(0x259),_0x2b8e03(0x1d0)),_0xdccb14[_0x2b8e03(0x24c)](_0x2b8e03(0x1c2));}catch(_0x13fba3){_0xdccb14[_0x2b8e03(0x1ef)](0xc8)[_0x2b8e03(0x26f)]({'message':_0x13fba3[_0x2b8e03(0x205)]});}}),router[a0_0x3e3aff(0x1ba)](a0_0x3e3aff(0x1ec),auth,async(_0x372184,_0x108346)=>{var _0x411bec=a0_0x3e3aff;try{const {username:_0x1aab3e,email:_0x281706,role:_0x11ba07}=_0x372184[_0x411bec(0x253)],_0x1084a0=_0x372184[_0x411bec(0x253)],_0x5b1583=await profile[_0x411bec(0x25b)]({'email':_0x1084a0['email']}),_0x13ab4d=await master_shop[_0x411bec(0x297)](),_0x39957e=_0x372184[_0x411bec(0x1b1)]['id'],_0x3864dc=await purchases_finished[_0x411bec(0x1da)](_0x39957e);if(_0x13ab4d[0x0]['language']=='English\x20(US)')var _0x41c677=users[_0x411bec(0x1b5)];else{if(_0x13ab4d[0x0][_0x411bec(0x239)]==_0x411bec(0x25d))var _0x41c677=users[_0x411bec(0x25d)];else{if(_0x13ab4d[0x0][_0x411bec(0x239)]=='German')var _0x41c677=users[_0x411bec(0x288)];else{if(_0x13ab4d[0x0]['language']==_0x411bec(0x1f9))var _0x41c677=users[_0x411bec(0x1f9)];else{if(_0x13ab4d[0x0][_0x411bec(0x239)]==_0x411bec(0x2a9))var _0x41c677=users[_0x411bec(0x2a9)];else{if(_0x13ab4d[0x0][_0x411bec(0x239)]==_0x411bec(0x23c))var _0x41c677=users[_0x411bec(0x1bd)];else{if(_0x13ab4d[0x0][_0x411bec(0x239)]==_0x411bec(0x1e8))var _0x41c677=users['Chinese'];else{if(_0x13ab4d[0x0][_0x411bec(0x239)]==_0x411bec(0x1f6))var _0x41c677=users[_0x411bec(0x1c9)];}}}}}}}_0x108346[_0x411bec(0x1d8)]('all_purchases_barcode',{'success':_0x372184['flash'](_0x411bec(0x259)),'errors':_0x372184[_0x411bec(0x280)]('errors'),'role':_0x1084a0,'profile':_0x5b1583,'alldata':_0x3864dc,'master_shop':_0x13ab4d,'language':_0x41c677}),console['log'](alldata);}catch(_0x44ed07){console[_0x411bec(0x256)](_0x44ed07);}}),router['post'](a0_0x3e3aff(0x230),async(_0x17f99a,_0x2853ee)=>{var _0x3870bf=a0_0x3e3aff;const {product_code:_0x5cf588}=_0x17f99a[_0x3870bf(0x271)];var _0x72e822;const _0x3c3432=await product[_0x3870bf(0x290)]([{'$match':{'primary_code':_0x5cf588,'product_category':_0x3870bf(0x1b6)}},{'$group':{'_id':_0x3870bf(0x2ad),'name':{'$first':_0x3870bf(0x1d3)},'category':{'$first':_0x3870bf(0x1d2)},'brand':{'$first':_0x3870bf(0x235)},'unit':{'$first':_0x3870bf(0x260)},'alertquantity':{'$first':_0x3870bf(0x1ea)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x3870bf(0x1e3)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x3870bf(0x209)},'maxProdPerUnit':{'$first':_0x3870bf(0x28b)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4104ba=await product[_0x3870bf(0x290)]([{'$match':{'secondary_code':_0x5cf588}},{'$group':{'_id':_0x3870bf(0x2ad),'name':{'$first':_0x3870bf(0x1d3)},'category':{'$first':'$category'},'brand':{'$first':_0x3870bf(0x235)},'unit':{'$first':_0x3870bf(0x260)},'alertquantity':{'$first':_0x3870bf(0x1ea)},'product_code':{'$first':_0x3870bf(0x1ce)},'primary_code':{'$first':_0x3870bf(0x1e3)},'secondary_code':{'$first':_0x3870bf(0x29b)},'maxStocks':{'$first':_0x3870bf(0x209)},'maxProdPerUnit':{'$first':_0x3870bf(0x28b)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3c3432[_0x3870bf(0x1f8)]>0x0)_0x72e822=_0x3c3432;else _0x4104ba[_0x3870bf(0x1f8)]>0x0&&(_0x72e822=_0x4104ba);_0x2853ee[_0x3870bf(0x26f)](_0x72e822);}),router['post']('/CheckingWarehouse',async(_0x1d26a6,_0x4c0dd1)=>{var _0x2375cd=a0_0x3e3aff;const {productCode:_0x2ddbc8,bay:_0x5a8804,warehouses:_0x36951e,room:_0x8def02}=_0x1d26a6[_0x2375cd(0x271)];console[_0x2375cd(0x256)](_0x1d26a6['body']);try{const _0x2dcced=await warehouse[_0x2375cd(0x290)]([{'$match':{'name':_0x36951e,'room':_0x8def02}},{'$unwind':_0x2375cd(0x234)},{'$match':{'product_details.bay':parseInt(_0x5a8804)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2375cd(0x295)},'product_stock':{'$first':_0x2375cd(0x276)},'bay':{'$first':_0x2375cd(0x267)},'maxProducts':{'$first':_0x2375cd(0x22e)}}}]);_0x4c0dd1[_0x2375cd(0x1ef)](0xc8)[_0x2375cd(0x26f)](_0x2dcced);}catch(_0x44622f){_0x4c0dd1[_0x2375cd(0x1ef)](0x194)[_0x2375cd(0x26f)]({'message':_0x44622f['message']});}}),module[a0_0x3e3aff(0x21f)]=router;