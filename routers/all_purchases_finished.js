var a0_0x2623cf=a0_0x2da7;function a0_0x2da7(_0x12d66d,_0x39ca2f){var _0xdb6207=a0_0xdb62();return a0_0x2da7=function(_0x2da7b4,_0x3bf229){_0x2da7b4=_0x2da7b4-0x148;var _0x1fc7fa=_0xdb6207[_0x2da7b4];return _0x1fc7fa;},a0_0x2da7(_0x12d66d,_0x39ca2f);}(function(_0x3417ce,_0x41dc62){var _0x59744b=a0_0x2da7,_0x5120fc=_0x3417ce();while(!![]){try{var _0x43b818=parseInt(_0x59744b(0x1a6))/0x1*(-parseInt(_0x59744b(0x1c0))/0x2)+parseInt(_0x59744b(0x19b))/0x3+-parseInt(_0x59744b(0x19d))/0x4*(-parseInt(_0x59744b(0x211))/0x5)+parseInt(_0x59744b(0x16c))/0x6+parseInt(_0x59744b(0x1e9))/0x7+-parseInt(_0x59744b(0x1de))/0x8*(parseInt(_0x59744b(0x204))/0x9)+parseInt(_0x59744b(0x14a))/0xa*(-parseInt(_0x59744b(0x1fa))/0xb);if(_0x43b818===_0x41dc62)break;else _0x5120fc['push'](_0x5120fc['shift']());}catch(_0x2a89c1){_0x5120fc['push'](_0x5120fc['shift']());}}}(a0_0xdb62,0x77b45));const express=require(a0_0x2623cf(0x1ab)),app=express(),router=express[a0_0x2623cf(0x191)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x2623cf(0x1a1)),auth=require(a0_0x2623cf(0x1f8)),nodemailer=require(a0_0x2623cf(0x179));var ejs=require('ejs');function a0_0xdb62(){var _0x282290=['back','$product_details.floorlevel','3742242WlpoCV','find','<div>','password','FROZEN\x20GOODS','$maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/CheckingWarehouse','sendMail','port','edit_purchases_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','batch_code','nodemailer','currency','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.secondary_code','success','prod_invoice','concat','primary_code','</thead>','</h5>','</head><body>','$_id','warehouse_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','host','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_date','$warehouse_name','product_cat','$unit','prod_cat','<tr>','<h5>','json','Router','save','<h5\x20style=\x22text-align:\x20left;\x22>','abs','prod_name','due_amount','$brand','$alertquantity','/view/add_purchases','$product_details.product_stock','1684911SjdnSb','stocks','75736GVeLhn','Ambient','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Logo.png','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Portuguese\x20(BR)','$product.room_name','bay','787SBpQWV','random','$category','$batch_code','$date','express','then','errors','secondary_unit','prod_level','JO_number','$product.bin','/../public','English','</div>','/upload/','params','$return_data','site_title','There\x27s\x20a\x20error\x20in\x20this\x20transaction','message','\x20</h2>','</tr>','warehouse','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','386kjTNyU','$suppliers','redirect','product_stock','Arabic','<html><head><title></title>','payment\x20successfull','English\x20(US)','/view/:id','$note','edit_purchases_finished_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','../public/language/languages.json','$name','_id','$product_details.maxProducts','French','stock_quantity','getDate','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Paid\x20For\x20Purchase','$product_code','/barcode_scanner','purchase_quantity','currency_placement','$product_details._id','product_name','prod_code','secondary_code','German','2135888BDOrhF','<strong>\x20Regards\x20</strong>','\x20Order\x20Date\x20:\x20','\x20<>\x20','user','all','staff','role','maxperunit','Room_name','POnumber','3446905AsJtBi','$suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','\x20Order\x20Number\x20:\x20','True','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$invoice','$primary_code','$product.floorlevel','</table>','Rack\x201','MaxStocks_data','Chinese','/all_purchases/view','../middleware/auth','$due_amount','3179AUzMhQ','secondary_code_hide','Purchase\x20Return','room_name','toString','log','Purchase\x20Return\x20Mail','Finished\x20Goods','max_product_unit','$product_details.rack','9uvCKCr','production_date','/all_purchases_finished/view','language','return_data','INCF-','string','/invoice/:id','master','Spanish','Portuguese','image','prod_qty','25FuEzRz','product','<!DOCTYPE\x20html>','</body></html>','forEach','prod_Qty','post','level','floor','DRY\x20GOODS','purchase\x20data\x20add\x20successfully','getFullYear','RoomAssign','$paid_amount','get','findById','aggregate','$product_details.product_code','<h2>\x20','error','filter','add_purchases_finished','$product_details.bin','Arabic\x20(ae)','map','Email\x20sent\x20successfully','Hindi','status','primary_code_hide','exports','$maxProdPerUnit','name','$product_details.primary_code','/view/add_purchases/:id','return_qty','maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','prod_primunit','$product_details.storage','body','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','logo','$product_details','all_purchases_finished','quantity','<span\x20style=\x22float:\x20right;\x22>','</span>','suppliers','An\x20error\x20occurred\x20while\x20saving\x20data.','add_purchases\x20error','purchase\x20data\x20update\x20successfully','</tbody>','paid_amount','purchase_invoice','/view/return_purchase/:id','$expiry_date','catch','$product.bay','product_code','slice','product_code_hide','length','updateOne','29870QJydxS','invoice','amount','$product','note','suppliers_docs','$room','product_details','getMonth','findOne','/preview/:id','return_product','/view','purchases\x20item\x20return\x20successfull','$product_details.product_name','table\x20page','Rack\x202','<tbody\x20style=\x22text-align:\x20center;\x22>','Purchase\x20Mail','render','$product.type','FGSEmail','date','createTransport','expiry_date','prod_secondunit','room','flash','email','$secondary_code','Enabled','standard_unit'];a0_0xdb62=function(){return _0x282290;};return a0_0xdb62();}const path=require('path'),users=require(a0_0x2623cf(0x1cc));router[a0_0x2623cf(0x21f)](a0_0x2623cf(0x156),auth,async(_0x56eecc,_0x183511)=>{var _0x245b8d=a0_0x2623cf;try{const {username:_0x27c245,email:_0x1ec12a,role:_0x30ef5a}=_0x56eecc[_0x245b8d(0x1e2)],_0x374a9b=_0x56eecc['user'],_0x547f81=await profile['findOne']({'email':_0x374a9b[_0x245b8d(0x166)]}),_0xb4d15f=await staff[_0x245b8d(0x153)]({'email':_0x374a9b[_0x245b8d(0x166)]});if(_0x374a9b['role']=='staff'){const _0x45a8da=await staff[_0x245b8d(0x153)]({'email':_0x374a9b['email']});}const _0x25fe79=await master_shop[_0x245b8d(0x16d)]();let _0x104c28;if(_0x374a9b[_0x245b8d(0x1e5)]==_0x245b8d(0x1e4)){const _0x1bb2fc=await staff['findOne']({'email':_0x374a9b[_0x245b8d(0x166)]});_0x104c28=await purchases_finished[_0x245b8d(0x221)]([{'$match':{'warehouse_name':_0x1bb2fc[_0x245b8d(0x1bd)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x245b8d(0x230),'as':_0x245b8d(0x14f)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x245b8d(0x14d)},{'$group':{'_id':_0x245b8d(0x184),'invoice':{'$first':_0x245b8d(0x1f0)},'suppliers':{'$first':_0x245b8d(0x1c1)},'date':{'$first':_0x245b8d(0x1aa)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x245b8d(0x150)},'product':{'$push':'$product'},'note':{'$first':_0x245b8d(0x1c9)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x245b8d(0x1f9)},'return_data':{'$first':_0x245b8d(0x1b7)},'batch_code':{'$first':_0x245b8d(0x1a9)},'expiry_date':{'$first':_0x245b8d(0x248)},'suppliers_docs':{'$first':_0x245b8d(0x1ea)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x245b8d(0x24a)},'isle':{'$addToSet':_0x245b8d(0x1b1)},'type':{'$addToSet':_0x245b8d(0x15e)},'floorlevel':{'$addToSet':_0x245b8d(0x1f2)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x104c28=await purchases_finished[_0x245b8d(0x221)]([{'$unwind':_0x245b8d(0x14d)},{'$group':{'_id':_0x245b8d(0x184),'invoice':{'$first':_0x245b8d(0x1f0)},'suppliers':{'$first':_0x245b8d(0x1c1)},'date':{'$first':_0x245b8d(0x1aa)},'warehouse_name':{'$first':_0x245b8d(0x18a)},'room':{'$addToSet':_0x245b8d(0x1a4)},'product':{'$push':'$product'},'note':{'$first':_0x245b8d(0x1c9)},'paid_amount':{'$first':_0x245b8d(0x21e)},'due_amount':{'$first':_0x245b8d(0x1f9)},'return_data':{'$first':_0x245b8d(0x1b7)},'batch_code':{'$first':_0x245b8d(0x1a9)},'expiry_date':{'$first':_0x245b8d(0x248)},'suppliers_docs':{'$first':_0x245b8d(0x1ea)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x245b8d(0x24a)},'isle':{'$addToSet':_0x245b8d(0x1b1)},'type':{'$addToSet':_0x245b8d(0x15e)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x25fe79[0x0][_0x245b8d(0x207)]==_0x245b8d(0x1c7))var _0x2511d9=users[_0x245b8d(0x1b3)];else{if(_0x25fe79[0x0]['language']==_0x245b8d(0x22b))var _0x2511d9=users['Hindi'];else{if(_0x25fe79[0x0][_0x245b8d(0x207)]=='German')var _0x2511d9=users[_0x245b8d(0x1dd)];else{if(_0x25fe79[0x0][_0x245b8d(0x207)]=='Spanish')var _0x2511d9=users['Spanish'];else{if(_0x25fe79[0x0][_0x245b8d(0x207)]==_0x245b8d(0x1d0))var _0x2511d9=users[_0x245b8d(0x1d0)];else{if(_0x25fe79[0x0]['language']==_0x245b8d(0x1a3))var _0x2511d9=users[_0x245b8d(0x20e)];else{if(_0x25fe79[0x0][_0x245b8d(0x207)]==_0x245b8d(0x1f6))var _0x2511d9=users[_0x245b8d(0x1f6)];else{if(_0x25fe79[0x0][_0x245b8d(0x207)]=='Arabic\x20(ae)')var _0x2511d9=users[_0x245b8d(0x1c4)];}}}}}}}_0x183511['render'](_0x245b8d(0x23c),{'success':_0x56eecc['flash'](_0x245b8d(0x17d)),'errors':_0x56eecc[_0x245b8d(0x165)](_0x245b8d(0x1ad)),'purchases':_0x104c28,'role':_0x374a9b,'profile':_0x547f81,'master_shop':_0x25fe79,'language':_0x2511d9});}catch(_0x2901e5){console[_0x245b8d(0x1ff)](_0x245b8d(0x159),_0x2901e5),_0x183511[_0x245b8d(0x22c)](0xc8)['json']({'message':_0x2901e5['message']});}});function BayBinSelected(_0x43be95,_0x522ca6){var _0x269a38=a0_0x2623cf,_0x4960b4=[],_0x478430=[];if(_0x43be95==_0x269a38(0x21a)){switch(_0x522ca6){case _0x269a38(0x1f4):_0x4960b4=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x4960b4=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x478430=['DG'];}else{if(_0x43be95==_0x269a38(0x170)){switch(_0x522ca6){case'Rack\x201':_0x4960b4=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x269a38(0x15a):_0x4960b4=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x478430=['FG'];}}return{'levels':_0x4960b4,'identify':_0x478430};}async function getRandom8DigitNumber(){var _0x51742c=a0_0x2623cf;const _0x22ac8b=0x989680,_0x3e9d14=0x5f5e0ff,_0x464aa7=Math[_0x51742c(0x219)](Math[_0x51742c(0x1a7)]()*(_0x3e9d14-_0x22ac8b+0x1))+_0x22ac8b;var _0x252a6d;const _0x20d7c9=await purchases_finished[_0x51742c(0x153)]({'invoice':_0x51742c(0x209)+_0x464aa7});return _0x20d7c9&&_0x20d7c9['length']>0x0?_0x252a6d=_0x51742c(0x209)+_0x464aa7:_0x252a6d=_0x51742c(0x209)+_0x464aa7,_0x252a6d;}router[a0_0x2623cf(0x21f)](a0_0x2623cf(0x199),auth,async(_0x444188,_0x3e71c9)=>{var _0x18a21c=a0_0x2623cf;try{const {username:_0x42f811,email:_0x5bbc23,role:_0x5776ad}=_0x444188['user'],_0x3cd34c=_0x444188[_0x18a21c(0x1e2)],_0x1c0aa5=await profile[_0x18a21c(0x153)]({'email':_0x3cd34c[_0x18a21c(0x166)]}),_0x4e8c82=await master_shop[_0x18a21c(0x16d)](),_0x21463d=await staff[_0x18a21c(0x153)]({'email':_0x3cd34c[_0x18a21c(0x166)]}),_0x2aef7f=await suppliers[_0x18a21c(0x16d)]({});let _0xe33761;if(_0x3cd34c[_0x18a21c(0x1e5)]==_0x18a21c(0x1e4)){const _0x12fec0=await staff[_0x18a21c(0x153)]({'email':_0x3cd34c[_0x18a21c(0x166)]});_0xe33761=await warehouse[_0x18a21c(0x221)]([{'$match':{'status':_0x18a21c(0x168),'name':_0x12fec0[_0x18a21c(0x1bd)],'warehouse_category':_0x18a21c(0x201)}},{'$group':{'_id':_0x18a21c(0x1cd),'name':{'$first':_0x18a21c(0x1cd)}}}]);}else _0xe33761=await warehouse[_0x18a21c(0x221)]([{'$match':{'status':_0x18a21c(0x168),'warehouse_category':_0x18a21c(0x201),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x18a21c(0x1cd),'name':{'$first':_0x18a21c(0x1cd)}}}]);const _0x2aa329=await product[_0x18a21c(0x16d)]({}),_0xe886e8=await warehouse[_0x18a21c(0x16d)]({'status':_0x18a21c(0x168)}),_0x506718=await purchases_finished[_0x18a21c(0x16d)]({}),_0x4b29d1=_0x506718[_0x18a21c(0x148)]+0x1,_0x4be0aa=_0x18a21c(0x209)+_0x4b29d1[_0x18a21c(0x1fe)]()['padStart'](0x5,'0');var _0x541d6d=[_0x18a21c(0x19e),'Enclosed'];if(_0x4e8c82[0x0][_0x18a21c(0x207)]==_0x18a21c(0x1c7))var _0x984f=users[_0x18a21c(0x1b3)];else{if(_0x4e8c82[0x0]['language']==_0x18a21c(0x22b))var _0x984f=users[_0x18a21c(0x22b)];else{if(_0x4e8c82[0x0][_0x18a21c(0x207)]==_0x18a21c(0x1dd))var _0x984f=users['German'];else{if(_0x4e8c82[0x0]['language']=='Spanish')var _0x984f=users['Spanish'];else{if(_0x4e8c82[0x0][_0x18a21c(0x207)]==_0x18a21c(0x1d0))var _0x984f=users['French'];else{if(_0x4e8c82[0x0][_0x18a21c(0x207)]=='Portuguese\x20(BR)')var _0x984f=users[_0x18a21c(0x20e)];else{if(_0x4e8c82[0x0][_0x18a21c(0x207)]=='Chinese')var _0x984f=users['Chinese'];else{if(_0x4e8c82[0x0]['language']==_0x18a21c(0x228))var _0x984f=users[_0x18a21c(0x1c4)];}}}}}}}const _0x9f98f5=getRandom8DigitNumber();_0x9f98f5[_0x18a21c(0x1ac)](_0x312b1f=>{var _0x366aa4=_0x18a21c;_0x3e71c9[_0x366aa4(0x15d)](_0x366aa4(0x226),{'success':_0x444188[_0x366aa4(0x165)](_0x366aa4(0x17d)),'errors':_0x444188[_0x366aa4(0x165)](_0x366aa4(0x1ad)),'role':_0x3cd34c,'profile':_0x1c0aa5,'suppliers':_0x2aef7f,'warehouse':_0xe33761,'product':_0x2aa329,'invoice':_0x312b1f,'master_shop':_0x4e8c82,'language':_0x984f,'find_data':_0xe886e8,'rooms_data':_0x541d6d});})[_0x18a21c(0x249)](_0x4f0bbf=>{var _0x12da44=_0x18a21c;_0x444188[_0x12da44(0x165)](_0x12da44(0x1ad),_0x12da44(0x1b9)),_0x3e71c9[_0x12da44(0x1c2)]('/all_purchases_finished/view');});}catch(_0x277afe){console[_0x18a21c(0x1ff)](_0x277afe);}}),router['get'](a0_0x2623cf(0x232),auth,async(_0x3cf36f,_0xdac7ca)=>{var _0x2dc66f=a0_0x2623cf;try{const _0x4fab64=_0x3cf36f[_0x2dc66f(0x1b6)]['id'];console[_0x2dc66f(0x1ff)](_0x4fab64);const _0x1f1abb=await master_shop['find']();console[_0x2dc66f(0x1ff)](_0x2dc66f(0x20c),_0x1f1abb);const _0x46534=await product['findOne']({'name':_0x4fab64});console[_0x2dc66f(0x1ff)](_0x2dc66f(0x212),_0x46534),_0xdac7ca[_0x2dc66f(0x22c)](0xc8)[_0x2dc66f(0x190)]({'product_data':_0x46534,'master':_0x1f1abb});}catch(_0x38be17){console[_0x2dc66f(0x1ff)](_0x2dc66f(0x242),_0x38be17);}}),router[a0_0x2623cf(0x217)](a0_0x2623cf(0x199),auth,async(_0x4433ba,_0x3881f8)=>{var _0x41d1cd=a0_0x2623cf;try{const {invoice:_0xaf60cb,date:_0x5dc327,warehouse_name:_0x3abb19,prod_name:_0x527f84,prod_code:_0x1b1b92,prod_qty:_0x1dda40,prod_unit:_0x59024c,prod_secondunit:_0x2047cb,prod_level:_0x1fba50,prod_isle:_0x2202b6,prod_pallet:_0x172abc,note:_0x35564f,expiry_date:_0x2b0f7d,batch_code:_0xacf2d0,payable:_0x584bfe,due_amount:_0xbe8401,Room_name:_0x5e9134,primary_code:_0x4ee8d4,secondary_code:_0x337b6a,MaxStocks_data:_0x41f02f,PO_number:_0x252c9d,SCRN:_0x4459f7,JO_number:_0x58483d}=_0x4433ba[_0x41d1cd(0x238)];if(typeof _0x527f84==_0x41d1cd(0x20a))var _0x5aca16=[_0x4433ba['body'][_0x41d1cd(0x195)]],_0x5d6c35=[_0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x1db)]],_0x31c92e=[_0x4433ba['body'][_0x41d1cd(0x216)]],_0x1c1cc8=[_0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x236)]],_0x3927b0=[_0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x163)]],_0x4ce63c=[_0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x1af)]],_0x14664e=[_0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x180)]],_0x59e976=[_0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x1dc)]],_0x314031=[_0x4433ba['body'][_0x41d1cd(0x1f5)]],_0x79186b=[_0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x178)]],_0x12df3e=[_0x4433ba['body'][_0x41d1cd(0x162)]],_0x2e45fb=[_0x4433ba[_0x41d1cd(0x238)]['product_date']],_0x2a26a2=[_0x4433ba['body']['max_product_unit']],_0x5940c9=[_0x4433ba['body'][_0x41d1cd(0x18d)]],_0x5ef227=[_0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x21d)]],_0xf517b6=[_0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x17e)]];else var _0x5aca16=[..._0x4433ba[_0x41d1cd(0x238)]['prod_name']],_0x5d6c35=[..._0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x1db)]],_0x31c92e=[..._0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x216)]],_0x1c1cc8=[..._0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x236)]],_0x3927b0=[..._0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x163)]],_0x4ce63c=[..._0x4433ba[_0x41d1cd(0x238)]['prod_level']],_0x14664e=[..._0x4433ba[_0x41d1cd(0x238)]['primary_code']],_0x59e976=[..._0x4433ba['body'][_0x41d1cd(0x1dc)]],_0x314031=[..._0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x1f5)]],_0x79186b=[..._0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x178)]],_0x12df3e=[..._0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x162)]],_0x2e45fb=[..._0x4433ba['body'][_0x41d1cd(0x189)]],_0x2a26a2=[..._0x4433ba[_0x41d1cd(0x238)][_0x41d1cd(0x202)]],_0x5940c9=[..._0x4433ba['body'][_0x41d1cd(0x18d)]],_0x5ef227=[..._0x4433ba[_0x41d1cd(0x238)]['RoomAssign']],_0xf517b6=[..._0x4433ba['body'][_0x41d1cd(0x17e)]];const _0x1b23f9=_0x5aca16[_0x41d1cd(0x229)](_0x1c7e0=>{return _0x1c7e0={'product_name':_0x1c7e0};});_0x5d6c35[_0x41d1cd(0x215)]((_0x4f9748,_0x9d5edc)=>{var _0x49fcf8=_0x41d1cd;_0x1b23f9[_0x9d5edc][_0x49fcf8(0x24b)]=_0x4f9748;}),_0x31c92e[_0x41d1cd(0x215)]((_0x5cafc8,_0x11431e)=>{var _0x31d7ff=_0x41d1cd;_0x1b23f9[_0x11431e][_0x31d7ff(0x23d)]=Math[_0x31d7ff(0x194)](_0x5cafc8);}),_0x1c1cc8['forEach']((_0x584a57,_0x4d8ca2)=>{_0x1b23f9[_0x4d8ca2]['standard_unit']=_0x584a57;}),_0x3927b0[_0x41d1cd(0x215)]((_0x38dbbd,_0x476fd7)=>{var _0x3db66c=_0x41d1cd;_0x1b23f9[_0x476fd7][_0x3db66c(0x1ae)]=_0x38dbbd;}),_0x4ce63c['forEach']((_0x52ef65,_0x3845b4)=>{var _0x1d8529=_0x41d1cd;_0x1b23f9[_0x3845b4][_0x1d8529(0x1a5)]=_0x52ef65;}),_0x14664e[_0x41d1cd(0x215)]((_0x3d57c4,_0x1fcb78)=>{var _0x1aae57=_0x41d1cd;_0x1b23f9[_0x1fcb78][_0x1aae57(0x180)]=_0x3d57c4;}),_0x59e976['forEach']((_0x22e4d9,_0x19b23e)=>{var _0xeafa6f=_0x41d1cd;_0x1b23f9[_0x19b23e][_0xeafa6f(0x1dc)]=_0x22e4d9;}),_0x314031[_0x41d1cd(0x215)]((_0x5507c9,_0x4101a6)=>{var _0x22c54c=_0x41d1cd;_0x1b23f9[_0x4101a6][_0x22c54c(0x234)]=_0x5507c9;}),_0x79186b[_0x41d1cd(0x215)]((_0x2f0f9e,_0x307735)=>{var _0x2a7daa=_0x41d1cd;_0x1b23f9[_0x307735][_0x2a7daa(0x178)]=_0x2f0f9e;}),_0x12df3e[_0x41d1cd(0x215)]((_0xd28781,_0x69bd55)=>{var _0x313d93=_0x41d1cd;_0x1b23f9[_0x69bd55][_0x313d93(0x162)]=_0xd28781;}),_0x2e45fb[_0x41d1cd(0x215)]((_0x32443e,_0x1a6129)=>{_0x1b23f9[_0x1a6129]['production_date']=_0x32443e;}),_0x2a26a2[_0x41d1cd(0x215)]((_0x37a107,_0x565d1c)=>{var _0x11fed2=_0x41d1cd;_0x1b23f9[_0x565d1c][_0x11fed2(0x1e6)]=_0x37a107;}),_0x5940c9[_0x41d1cd(0x215)]((_0x34fa66,_0x26b4c8)=>{var _0x55e407=_0x41d1cd;_0x1b23f9[_0x26b4c8][_0x55e407(0x18b)]=_0x34fa66;}),_0x5ef227[_0x41d1cd(0x215)]((_0x371db0,_0x48da50)=>{var _0x19e1a3=_0x41d1cd;_0x1b23f9[_0x48da50][_0x19e1a3(0x1fd)]=_0x371db0;}),_0xf517b6[_0x41d1cd(0x215)]((_0x3e6870,_0x2d42c5)=>{var _0x35404d=_0x41d1cd;_0x1b23f9[_0x2d42c5][_0x35404d(0x14b)]=_0x3e6870;});const _0x583304=_0x1b23f9[_0x41d1cd(0x225)](_0x20c762=>_0x20c762['quantity']!=='0'&&_0x20c762[_0x41d1cd(0x23d)]!==''),_0x261aba=new purchases_finished({'invoice':_0xaf60cb,'suppliers':_0x4433ba['body'][_0x41d1cd(0x240)],'date':_0x5dc327,'warehouse_name':_0x3abb19,'product':_0x583304,'note':_0x35564f,'due_amount':_0xbe8401,'room':_0x5e9134,'POnumber':_0x252c9d,'SCRN':_0x4459f7,'JO_number':_0x58483d}),_0x3ddbd6=await _0x261aba[_0x41d1cd(0x192)](),_0x1c0336=await purchases_finished[_0x41d1cd(0x153)]({'invoice':_0xaf60cb}),_0x55b75b=_0x1c0336[_0x41d1cd(0x212)]['map'](async _0x4aea8c=>{var _0x3d9662=_0x41d1cd;try{var _0x4a0604=await warehouse['findOne']({'name':_0x3abb19,'room':_0x4aea8c[_0x3d9662(0x1fd)]}),_0x479261=0x0;const _0x548585=_0x4a0604[_0x3d9662(0x151)][_0x3d9662(0x229)](_0x5ee7c5=>{var _0x2c7b67=_0x3d9662;console[_0x2c7b67(0x1ff)](_0x5ee7c5[_0x2c7b67(0x1da)]+'=='+_0x4aea8c[_0x2c7b67(0x1da)]+'&&'+_0x5ee7c5[_0x2c7b67(0x1a5)]+'=='+_0x4aea8c[_0x2c7b67(0x1a5)]+'&&'+_0x5ee7c5[_0x2c7b67(0x162)]+'=='+_0x4aea8c[_0x2c7b67(0x162)]+'&&'+_0x5ee7c5['production_date']+'=='+_0x4aea8c[_0x2c7b67(0x205)]+'&&'+_0x5ee7c5['batch_code']+'=='+_0x4aea8c['batch_code']+'&&'+_0x5ee7c5[_0x2c7b67(0x14b)]+'=='+_0x1c0336[_0x2c7b67(0x14b)]),_0x5ee7c5[_0x2c7b67(0x1da)]==_0x4aea8c[_0x2c7b67(0x1da)]&&_0x5ee7c5[_0x2c7b67(0x1a5)]==_0x4aea8c['bay']&&_0x5ee7c5[_0x2c7b67(0x162)]==_0x4aea8c[_0x2c7b67(0x162)]&&_0x5ee7c5[_0x2c7b67(0x205)]==_0x4aea8c[_0x2c7b67(0x205)]&&_0x5ee7c5['batch_code']==_0x4aea8c[_0x2c7b67(0x178)]&&_0x5ee7c5[_0x2c7b67(0x14b)]==_0x1c0336['invoice']&&(_0x5ee7c5['product_stock']=Math['abs'](_0x5ee7c5[_0x2c7b67(0x1c3)])+Math[_0x2c7b67(0x194)](_0x4aea8c[_0x2c7b67(0x23d)]),_0x479261++);});return _0x479261==0x0&&(_0x4a0604['product_details']=_0x4a0604[_0x3d9662(0x151)][_0x3d9662(0x17f)]({'product_name':_0x4aea8c[_0x3d9662(0x1da)],'product_stock':Math['abs'](_0x4aea8c[_0x3d9662(0x23d)]),'primary_code':_0x4aea8c['primary_code'],'secondary_code':_0x4aea8c[_0x3d9662(0x1dc)],'product_code':_0x4aea8c[_0x3d9662(0x24b)],'bay':_0x4aea8c['bay'],'maxProducts':_0x4aea8c[_0x3d9662(0x234)],'unit':_0x4aea8c[_0x3d9662(0x169)],'secondary_unit':_0x4aea8c[_0x3d9662(0x1ae)],'expiry_date':_0x4aea8c['expiry_date'],'production_date':_0x4aea8c[_0x3d9662(0x205)],'maxProducts':_0x4aea8c[_0x3d9662(0x234)],'maxPerUnit':_0x4aea8c[_0x3d9662(0x1e6)],'batch_code':_0x4aea8c[_0x3d9662(0x178)],'product_cat':_0x4aea8c[_0x3d9662(0x18b)],'invoice':_0x4aea8c['invoice'],'id_incoming':_0x4aea8c['_id']})),_0x4a0604;}catch(_0x48bebf){return console[_0x3d9662(0x224)]('Error\x20occurred\x20while\x20processing\x20product:',_0x48bebf),null;}});Promise[_0x41d1cd(0x1e3)](_0x55b75b)['then'](async _0x17cabf=>{var _0x5bedf7=_0x41d1cd;try{for(const _0x2659ec of _0x17cabf){await warehouse[_0x5bedf7(0x149)]({'_id':_0x2659ec[_0x5bedf7(0x1ce)]},{'$addToSet':{'product_details':{'$each':_0x2659ec[_0x5bedf7(0x151)]}}});}const _0x527fca=await master_shop[_0x5bedf7(0x16d)](),_0x57116c=await email_settings[_0x5bedf7(0x153)](),_0x2b1155=await supervisor_settings[_0x5bedf7(0x16d)]();var _0x3ae993=_0x1c0336[_0x5bedf7(0x212)],_0x554a6f='',_0x2fb5c4;for(_0x2fb5c4 in _0x3ae993){var _0x1e1a6c='FG';_0x1c0336['warehouse_name']==_0x5bedf7(0x21a)&&(_0x1e1a6c='DG'),_0x554a6f+='<tr>'+_0x5bedf7(0x17b)+_0x3ae993[_0x2fb5c4][_0x5bedf7(0x1da)]+_0x5bedf7(0x1be)+_0x5bedf7(0x17b)+_0x3ae993[_0x2fb5c4][_0x5bedf7(0x24b)]+'</td>'+_0x5bedf7(0x17b)+_0x3ae993[_0x2fb5c4][_0x5bedf7(0x23d)]+_0x5bedf7(0x1be)+_0x5bedf7(0x17b)+_0x3ae993[_0x2fb5c4][_0x5bedf7(0x169)]+_0x5bedf7(0x1be)+_0x5bedf7(0x17b)+_0x3ae993[_0x2fb5c4][_0x5bedf7(0x1ae)]+'</td>'+_0x5bedf7(0x17b)+_0x1c0336[_0x5bedf7(0x185)]+'</td>'+_0x5bedf7(0x17b)+_0x3ae993[_0x2fb5c4][_0x5bedf7(0x1fd)]+_0x5bedf7(0x1be)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1e1a6c+_0x3ae993[_0x2fb5c4][_0x5bedf7(0x1a5)]+_0x5bedf7(0x1be),_0x5bedf7(0x1bc);}let _0x42899f=nodemailer[_0x5bedf7(0x161)]({'host':_0x57116c[_0x5bedf7(0x187)],'port':Number(_0x57116c[_0x5bedf7(0x175)]),'secure':![],'auth':{'user':_0x57116c[_0x5bedf7(0x166)],'pass':_0x57116c[_0x5bedf7(0x16f)]}}),_0x5a5d6b={'from':_0x57116c[_0x5bedf7(0x166)],'to':_0x2b1155[0x0][_0x5bedf7(0x15f)],'subject':_0x5bedf7(0x15c),'attachments':[{'filename':_0x5bedf7(0x1a0),'path':__dirname+'/../public'+_0x5bedf7(0x1b5)+_0x527fca[0x0][_0x5bedf7(0x20f)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x5bedf7(0x1c5)+_0x5bedf7(0x183)+'<div>'+_0x5bedf7(0x186)+_0x5bedf7(0x16e)+_0x5bedf7(0x239)+'</div>'+'<div>'+_0x5bedf7(0x223)+_0x527fca[0x0][_0x5bedf7(0x1b8)]+'\x20</h2>'+_0x5bedf7(0x1b4)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x5bedf7(0x16e)+_0x5bedf7(0x193)+_0x5bedf7(0x1ec)+_0x1c0336[_0x5bedf7(0x14b)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x5bedf7(0x1e0)+_0x1c0336[_0x5bedf7(0x160)]+'\x20'+_0x5bedf7(0x23f)+_0x5bedf7(0x182)+_0x5bedf7(0x1b4)+_0x5bedf7(0x1d3)+_0x5bedf7(0x19f)+'<tr>'+_0x5bedf7(0x188)+_0x5bedf7(0x177)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x5bedf7(0x1ef)+_0x5bedf7(0x235)+_0x5bedf7(0x172)+_0x5bedf7(0x1a2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x5bedf7(0x1bc)+_0x5bedf7(0x181)+_0x5bedf7(0x15b)+'\x20'+_0x554a6f+'\x20'+_0x5bedf7(0x244)+_0x5bedf7(0x1f3)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x5bedf7(0x18f)+_0x527fca[0x0][_0x5bedf7(0x1b8)]+_0x5bedf7(0x182)+_0x5bedf7(0x1b4)+_0x5bedf7(0x1b4)+_0x5bedf7(0x214)};_0x42899f['sendMail'](_0x5a5d6b,function(_0xc3a1e8,_0x19e568){var _0x3a41b3=_0x5bedf7;_0xc3a1e8?(console[_0x3a41b3(0x1ff)](_0xc3a1e8),console[_0x3a41b3(0x1ff)](_0x3a41b3(0x1ee))):console[_0x3a41b3(0x1ff)](_0x3a41b3(0x22a));});}catch(_0x4363d0){console[_0x5bedf7(0x224)](_0x4363d0),_0x3881f8[_0x5bedf7(0x22c)](0x1f4)[_0x5bedf7(0x190)]({'error':_0x5bedf7(0x241),'message':_0x4363d0[_0x5bedf7(0x1ba)]});}})[_0x41d1cd(0x249)](_0x22fc72=>{console['error'](_0x22fc72);}),_0x4433ba[_0x41d1cd(0x165)](_0x41d1cd(0x17d),_0x41d1cd(0x21b)),_0x3881f8[_0x41d1cd(0x1c2)]('/all_purchases_finished/view');}catch(_0x5e2c19){console[_0x41d1cd(0x1ff)](_0x5e2c19);}}),router[a0_0x2623cf(0x21f)](a0_0x2623cf(0x154),auth,async(_0x268f08,_0x4f7914)=>{var _0x34bbf8=a0_0x2623cf;try{const {username:_0x778995,email:_0x10c222,role:_0x107d0f}=_0x268f08['user'],_0xc0a01c=_0x268f08['user'],_0x1783ea=await profile[_0x34bbf8(0x153)]({'email':_0xc0a01c[_0x34bbf8(0x166)]}),_0x4459ed=await master_shop['find'](),_0x4cf422=_0x268f08[_0x34bbf8(0x1b6)]['id'],_0x324041=await purchases_finished[_0x34bbf8(0x220)](_0x4cf422),_0x86b14f=await suppliers['find']({});let _0x2b84ee;if(_0xc0a01c[_0x34bbf8(0x1e5)]==_0x34bbf8(0x1e4)){const _0x4b91f8=await staff[_0x34bbf8(0x153)]({'email':_0xc0a01c['email']});_0x2b84ee=await warehouse[_0x34bbf8(0x16d)]({'status':_0x34bbf8(0x168),'name':_0x4b91f8[_0x34bbf8(0x1bd)],'warehouse_category':_0x34bbf8(0x201)});}else _0x2b84ee=await warehouse[_0x34bbf8(0x221)]([{'$match':{'status':_0x34bbf8(0x168),'warehouse_category':_0x34bbf8(0x201)}},{'$group':{'_id':_0x34bbf8(0x1cd),'name':{'$first':'$name'}}}]);const _0x5dea6b=await product['find']({}),_0xf5b580=BayBinSelected(_0x324041[_0x34bbf8(0x185)],_0x324041[_0x34bbf8(0x164)]);let _0xc9e537=new Date(_0x324041[_0x34bbf8(0x162)]),_0x123294=('0'+_0xc9e537[_0x34bbf8(0x1d2)]())[_0x34bbf8(0x24c)](-0x2),_0x8409ba=('0'+(_0xc9e537[_0x34bbf8(0x152)]()+0x1))[_0x34bbf8(0x24c)](-0x2),_0x38e491=_0xc9e537[_0x34bbf8(0x21c)](),_0x37b424=_0x38e491+'-'+_0x8409ba+'-'+_0x123294;if(_0x4459ed[0x0][_0x34bbf8(0x207)]==_0x34bbf8(0x1c7)){var _0x16f74f=users[_0x34bbf8(0x1b3)];console[_0x34bbf8(0x1ff)](_0x16f74f);}else{if(_0x4459ed[0x0][_0x34bbf8(0x207)]=='Hindi')var _0x16f74f=users['Hindi'];else{if(_0x4459ed[0x0]['language']==_0x34bbf8(0x1dd))var _0x16f74f=users[_0x34bbf8(0x1dd)];else{if(_0x4459ed[0x0][_0x34bbf8(0x207)]==_0x34bbf8(0x20d))var _0x16f74f=users['Spanish'];else{if(_0x4459ed[0x0][_0x34bbf8(0x207)]==_0x34bbf8(0x1d0))var _0x16f74f=users[_0x34bbf8(0x1d0)];else{if(_0x4459ed[0x0][_0x34bbf8(0x207)]==_0x34bbf8(0x1a3))var _0x16f74f=users['Portuguese'];else{if(_0x4459ed[0x0][_0x34bbf8(0x207)]==_0x34bbf8(0x1f6))var _0x16f74f=users[_0x34bbf8(0x1f6)];else{if(_0x4459ed[0x0][_0x34bbf8(0x207)]=='Arabic\x20(ae)')var _0x16f74f=users[_0x34bbf8(0x1c4)];}}}}}}}_0x4f7914[_0x34bbf8(0x15d)](_0x34bbf8(0x1ca),{'success':_0x268f08['flash']('success'),'errors':_0x268f08[_0x34bbf8(0x165)]('errors'),'role':_0xc0a01c,'profile':_0x1783ea,'purchases':_0x324041,'suppliers':_0x86b14f,'warehouse':_0x2b84ee,'product':_0x5dea6b,'master_shop':_0x4459ed,'language':_0x16f74f,'ed_fullDate':_0x37b424,'dataSelected':_0xf5b580});}catch(_0x5911a3){console[_0x34bbf8(0x1ff)](_0x5911a3);}}),router[a0_0x2623cf(0x21f)](a0_0x2623cf(0x1c8),auth,async(_0x359e26,_0x5de321)=>{var _0x4d69da=a0_0x2623cf;try{const {username:_0x54a43c,email:_0x44691f,role:_0x5e78e5}=_0x359e26['user'],_0x53b8a7=_0x359e26[_0x4d69da(0x1e2)],_0x16cf87=await profile[_0x4d69da(0x153)]({'email':_0x53b8a7[_0x4d69da(0x166)]}),_0x4a04f5=await master_shop[_0x4d69da(0x16d)](),_0xfb8ed3=_0x359e26['params']['id'],_0x588cba=await purchases_finished[_0x4d69da(0x220)](_0xfb8ed3),_0x1992ba=await suppliers['find']({});let _0xf0dc3f;if(_0x53b8a7['role']==_0x4d69da(0x1e4)){const _0x4678fa=await staff['findOne']({'email':_0x53b8a7[_0x4d69da(0x166)]});_0xf0dc3f=await warehouse[_0x4d69da(0x16d)]({'status':_0x4d69da(0x168),'name':_0x4678fa['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0xf0dc3f=await warehouse['aggregate']([{'$match':{'status':_0x4d69da(0x168),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x4d69da(0x1cd),'name':{'$first':_0x4d69da(0x1cd)}}}]);const _0x2898af=await product[_0x4d69da(0x16d)]({}),_0x5e3819=BayBinSelected(_0x588cba[_0x4d69da(0x185)],_0x588cba[_0x4d69da(0x164)]);let _0xa9e5b0=new Date(_0x588cba[_0x4d69da(0x162)]),_0xc7a78f=('0'+_0xa9e5b0[_0x4d69da(0x1d2)]())['slice'](-0x2),_0x1071c0=('0'+(_0xa9e5b0['getMonth']()+0x1))[_0x4d69da(0x24c)](-0x2),_0x3ebbcd=_0xa9e5b0[_0x4d69da(0x21c)](),_0x487b7f=_0x3ebbcd+'-'+_0x1071c0+'-'+_0xc7a78f;if(_0x4a04f5[0x0][_0x4d69da(0x207)]==_0x4d69da(0x1c7)){var _0xf4548c=users[_0x4d69da(0x1b3)];console[_0x4d69da(0x1ff)](_0xf4548c);}else{if(_0x4a04f5[0x0][_0x4d69da(0x207)]==_0x4d69da(0x22b))var _0xf4548c=users[_0x4d69da(0x22b)];else{if(_0x4a04f5[0x0][_0x4d69da(0x207)]==_0x4d69da(0x1dd))var _0xf4548c=users[_0x4d69da(0x1dd)];else{if(_0x4a04f5[0x0][_0x4d69da(0x207)]=='Spanish')var _0xf4548c=users['Spanish'];else{if(_0x4a04f5[0x0][_0x4d69da(0x207)]=='French')var _0xf4548c=users[_0x4d69da(0x1d0)];else{if(_0x4a04f5[0x0][_0x4d69da(0x207)]==_0x4d69da(0x1a3))var _0xf4548c=users[_0x4d69da(0x20e)];else{if(_0x4a04f5[0x0][_0x4d69da(0x207)]==_0x4d69da(0x1f6))var _0xf4548c=users['Chinese'];else{if(_0x4a04f5[0x0][_0x4d69da(0x207)]==_0x4d69da(0x228))var _0xf4548c=users[_0x4d69da(0x1c4)];}}}}}}}_0x5de321[_0x4d69da(0x15d)](_0x4d69da(0x176),{'success':_0x359e26['flash'](_0x4d69da(0x17d)),'errors':_0x359e26['flash'](_0x4d69da(0x1ad)),'role':_0x53b8a7,'profile':_0x16cf87,'purchases':_0x588cba,'suppliers':_0x1992ba,'warehouse':_0xf0dc3f,'product':_0x2898af,'master_shop':_0x4a04f5,'language':_0xf4548c,'ed_fullDate':_0x487b7f,'dataSelected':_0x5e3819});}catch(_0x138766){console[_0x4d69da(0x1ff)](_0x138766);}}),router[a0_0x2623cf(0x217)](a0_0x2623cf(0x1c8),auth,async(_0x47dc4c,_0x4e3d1c)=>{var _0x340936=a0_0x2623cf;try{const _0x39656c=_0x47dc4c[_0x340936(0x1b6)]['id'],_0x499935=await purchases_finished['findOne']({'_id':_0x47dc4c[_0x340936(0x1b6)]['id']}),_0x3057d9=await warehouse['findOne']({'name':_0x499935[_0x340936(0x185)],'room':_0x499935[_0x340936(0x164)]});_0x499935['product'][_0x340936(0x215)](_0x23f20b=>{var _0xfa0737=_0x340936;const _0x27e1fd=_0x3057d9[_0xfa0737(0x151)]['map'](_0x2176cd=>{var _0x55431f=_0xfa0737;_0x2176cd['product_name']==_0x23f20b[_0x55431f(0x1da)]&&_0x2176cd[_0x55431f(0x1a5)]==_0x23f20b[_0x55431f(0x1a5)]&&(_0x2176cd[_0x55431f(0x1c3)]=parseInt(_0x2176cd[_0x55431f(0x1c3)])-parseInt(_0x23f20b[_0x55431f(0x23d)]));});}),await _0x3057d9['save']();const {invoice:_0x115d85,suppliers:_0x5105b5,date:_0x695bca,warehouse_name:_0x3570a5,prod_name:_0x18b135,prod_code:_0x2f505e,prod_qty:_0x27a449,prod_unit:_0x1b438d,prod_secondunit:_0x19a483,prod_level:_0x1b9287,prod_isle:_0x28a1e4,prod_pallet:_0x4801fe,note:_0x5eb230,expiry_date:_0x4e7915,batch_code:_0x1ef95b,paid_amount:_0x5a3731,due_amount:_0x247105,Room_name:_0x2bdf38,primary_code:_0x836ff7,secondary_code:_0x1ca5d9,PO_number:_0x474fd8,JO_number:_0x1bd258}=_0x47dc4c['body'];if(typeof _0x18b135==_0x340936(0x20a))var _0x59714b=[_0x47dc4c[_0x340936(0x238)][_0x340936(0x195)]],_0x3f203d=[_0x47dc4c[_0x340936(0x238)]['prod_code']],_0x465a41=[_0x47dc4c[_0x340936(0x238)]['prod_qty']],_0x3e5f41=[_0x47dc4c[_0x340936(0x238)]['prod_unit']],_0x5a56f7=[_0x47dc4c[_0x340936(0x238)]['prod_secondunit']],_0x376397=[_0x47dc4c[_0x340936(0x238)]['prod_level']],_0x12edcb=[_0x47dc4c['body'][_0x340936(0x180)]],_0x3affdc=[_0x47dc4c[_0x340936(0x238)][_0x340936(0x1dc)]],_0x1477d0=[_0x47dc4c['body'][_0x340936(0x1f5)]],_0x46e8ea=[_0x47dc4c[_0x340936(0x238)]['batch_code']],_0x313a89=[_0x47dc4c['body'][_0x340936(0x162)]];else var _0x59714b=[..._0x47dc4c['body'][_0x340936(0x195)]],_0x3f203d=[..._0x47dc4c[_0x340936(0x238)]['prod_code']],_0x465a41=[..._0x47dc4c[_0x340936(0x238)][_0x340936(0x210)]],_0x3e5f41=[..._0x47dc4c[_0x340936(0x238)]['prod_unit']],_0x5a56f7=[..._0x47dc4c['body'][_0x340936(0x163)]],_0x376397=[..._0x47dc4c['body']['prod_level']],_0x12edcb=[..._0x47dc4c['body']['primary_code']],_0x3affdc=[..._0x47dc4c['body'][_0x340936(0x1dc)]],_0x1477d0=[..._0x47dc4c[_0x340936(0x238)]['MaxStocks_data']],_0x46e8ea=[..._0x47dc4c[_0x340936(0x238)]['batch_code']],_0x313a89=[..._0x47dc4c[_0x340936(0x238)][_0x340936(0x162)]];const _0x31ae13=_0x59714b[_0x340936(0x229)](_0x11ae56=>{return _0x11ae56={'product_name':_0x11ae56};});_0x3f203d[_0x340936(0x215)]((_0x4301c7,_0x3235a3)=>{var _0x4e280c=_0x340936;_0x31ae13[_0x3235a3][_0x4e280c(0x24b)]=_0x4301c7;}),_0x465a41['forEach']((_0x3b9f20,_0x4bf70d)=>{_0x31ae13[_0x4bf70d]['quantity']=_0x3b9f20;}),_0x3e5f41[_0x340936(0x215)]((_0x1d1050,_0x3162fa)=>{var _0x4e1611=_0x340936;_0x31ae13[_0x3162fa][_0x4e1611(0x169)]=_0x1d1050;}),_0x5a56f7['forEach']((_0x2856ff,_0x36bb05)=>{var _0x59e3f0=_0x340936;_0x31ae13[_0x36bb05][_0x59e3f0(0x1ae)]=_0x2856ff;}),_0x376397['forEach']((_0x7720a0,_0x224fb7)=>{var _0xbf4713=_0x340936;_0x31ae13[_0x224fb7][_0xbf4713(0x1a5)]=_0x7720a0;}),_0x12edcb['forEach']((_0x489e2a,_0x3ce0a7)=>{var _0xabe112=_0x340936;_0x31ae13[_0x3ce0a7][_0xabe112(0x180)]=_0x489e2a;}),_0x3affdc[_0x340936(0x215)]((_0x2f9086,_0x5291a9)=>{var _0x20b189=_0x340936;_0x31ae13[_0x5291a9][_0x20b189(0x1dc)]=_0x2f9086;}),_0x1477d0[_0x340936(0x215)]((_0x3502da,_0x2c9bf0)=>{var _0x4905b1=_0x340936;_0x31ae13[_0x2c9bf0][_0x4905b1(0x234)]=_0x3502da;}),_0x46e8ea['forEach']((_0x498592,_0x47d090)=>{var _0x3e99cb=_0x340936;_0x31ae13[_0x47d090][_0x3e99cb(0x178)]=_0x498592;}),_0x313a89[_0x340936(0x215)]((_0x5c5e48,_0x130e5f)=>{var _0x586aa5=_0x340936;_0x31ae13[_0x130e5f][_0x586aa5(0x162)]=_0x5c5e48;});const _0x4eb48c=_0x31ae13[_0x340936(0x225)](_0x7c854=>_0x7c854[_0x340936(0x23d)]!=='0'&&_0x7c854[_0x340936(0x23d)]!=='');_0x499935[_0x340936(0x14b)]=_0x115d85,_0x499935[_0x340936(0x240)]=_0x5105b5,_0x499935[_0x340936(0x160)]=_0x695bca,_0x499935[_0x340936(0x185)]=_0x3570a5,_0x499935['product']=_0x4eb48c,_0x499935[_0x340936(0x14e)]=_0x5eb230,_0x499935[_0x340936(0x245)]=_0x5a3731,_0x499935[_0x340936(0x196)]=_0x247105,_0x499935[_0x340936(0x164)]=_0x2bdf38,_0x499935[_0x340936(0x1e8)]=_0x474fd8,_0x499935[_0x340936(0x1b0)]=_0x1bd258;const _0x31b30b=await _0x499935[_0x340936(0x192)](),_0x595f5c=await warehouse[_0x340936(0x153)]({'name':_0x47dc4c['body']['warehouse_name'],'room':_0x47dc4c['body'][_0x340936(0x1e7)]});_0x499935[_0x340936(0x212)][_0x340936(0x215)](_0x16e2f8=>{var _0x5ac475=_0x340936,_0x3215b9=0x0;const _0x313cf2=_0x595f5c[_0x5ac475(0x151)][_0x5ac475(0x229)](_0xd9d120=>{var _0x4c6bab=_0x5ac475;_0xd9d120['product_name']==_0x16e2f8[_0x4c6bab(0x1da)]&&_0xd9d120[_0x4c6bab(0x1a5)]==_0x16e2f8['bay']&&(_0xd9d120[_0x4c6bab(0x1c3)]=parseInt(_0xd9d120['product_stock'])+parseInt(_0x16e2f8[_0x4c6bab(0x23d)]),_0x3215b9++);});_0x3215b9=='0'&&(_0x595f5c['product_details']=_0x595f5c[_0x5ac475(0x151)][_0x5ac475(0x17f)]({'product_name':_0x16e2f8[_0x5ac475(0x1da)],'product_stock':_0x16e2f8[_0x5ac475(0x23d)],'primary_code':_0x16e2f8[_0x5ac475(0x180)],'secondary_code':_0x16e2f8[_0x5ac475(0x1dc)],'product_code':_0x16e2f8['product_code'],'bay':_0x16e2f8['bay'],'maxProducts':_0x16e2f8['maxStocks'],'unit':_0x16e2f8[_0x5ac475(0x169)],'secondary_unit':_0x16e2f8[_0x5ac475(0x1ae)],'expiry_date':_0x16e2f8[_0x5ac475(0x162)]}));}),await _0x595f5c[_0x340936(0x192)]();const _0x18faf0=await s_payment_data[_0x340936(0x153)]({'invoice':_0x47dc4c[_0x340936(0x238)][_0x340936(0x14b)]});if(_0x18faf0===null){}else console[_0x340936(0x1ff)]('suppliers',_0x18faf0,_0x47dc4c[_0x340936(0x238)]['invoice']),_0x18faf0[_0x340936(0x240)]=_0x47dc4c[_0x340936(0x238)][_0x340936(0x240)],await _0x18faf0['save']();_0x47dc4c[_0x340936(0x165)](_0x340936(0x17d),_0x340936(0x243)),_0x4e3d1c[_0x340936(0x1c2)](_0x340936(0x206));}catch(_0x586fd9){console[_0x340936(0x1ff)](_0x586fd9);}}),router[a0_0x2623cf(0x217)]('/give_payment/:id',auth,async(_0x3aa084,_0x5469fc)=>{var _0x183ab7=a0_0x2623cf;try{const _0x12d246=_0x3aa084[_0x183ab7(0x1b6)]['id'],{invoice:_0x5e0f83,suppliers:_0x1dfe87,payable:_0xefabad,due_amount:_0x40db33}=_0x3aa084[_0x183ab7(0x238)],_0xf9bc9d=await purchases[_0x183ab7(0x220)](_0x12d246);var _0x491f4e=_0xefabad-_0x40db33;_0xf9bc9d[_0x183ab7(0x245)]=parseFloat(_0xf9bc9d[_0x183ab7(0x245)])+parseFloat(_0x40db33),_0xf9bc9d[_0x183ab7(0x196)]=_0x491f4e;const _0x49446a=await _0xf9bc9d[_0x183ab7(0x192)]();console[_0x183ab7(0x1ff)](_0x49446a);const _0x24449a=await s_payment_data[_0x183ab7(0x153)]({'invoice':_0x5e0f83});_0x24449a[_0x183ab7(0x14c)]=_0x491f4e,await _0x24449a['save']();let _0x105e20=new Date(),_0x4ab4da=('0'+_0x105e20[_0x183ab7(0x1d2)]())[_0x183ab7(0x24c)](-0x2),_0x3e0ff0=('0'+(_0x105e20[_0x183ab7(0x152)]()+0x1))[_0x183ab7(0x24c)](-0x2),_0x11064b=_0x105e20[_0x183ab7(0x21c)](),_0x28e4b3=_0x11064b+'-'+_0x3e0ff0+'-'+_0x4ab4da;const _0xc011a8=new suppliers_payment({'invoice':_0x5e0f83,'date':_0x11064b+'-'+_0x3e0ff0+'-'+_0x4ab4da,'suppliers':_0x1dfe87,'reason':_0x183ab7(0x1d4),'amount':_0x40db33}),_0x191108=await _0xc011a8[_0x183ab7(0x192)]();_0x3aa084[_0x183ab7(0x165)]('success',_0x183ab7(0x1c6)),_0x5469fc[_0x183ab7(0x1c2)](_0x183ab7(0x1f7));}catch(_0x25184a){console[_0x183ab7(0x1ff)](_0x25184a);}}),router['get'](a0_0x2623cf(0x20b),auth,async(_0x2a2ea8,_0x3d941a)=>{var _0x4178e2=a0_0x2623cf;try{const {username:_0x165e36,email:_0xb98759,role:_0x4d1940}=_0x2a2ea8[_0x4178e2(0x1e2)],_0x221bc6=_0x2a2ea8[_0x4178e2(0x1e2)],_0x32d2df=await profile['findOne']({'email':_0x221bc6[_0x4178e2(0x166)]}),_0xb5cb4a=await master_shop[_0x4178e2(0x16d)]();console['log'](_0x4178e2(0x20c),_0xb5cb4a);const _0x207bd9=_0x2a2ea8[_0x4178e2(0x1b6)]['id'],_0x1027db=await purchases[_0x4178e2(0x220)](_0x207bd9);console['log'](_0x1027db);const _0x11c5de=await suppliers[_0x4178e2(0x153)]({'name':_0x1027db['suppliers']});console['log'](_0x11c5de);if(_0xb5cb4a[0x0]['language']=='English\x20(US)'){var _0x1c932c=users[_0x4178e2(0x1b3)];console['log'](_0x1c932c);}else{if(_0xb5cb4a[0x0][_0x4178e2(0x207)]==_0x4178e2(0x22b))var _0x1c932c=users[_0x4178e2(0x22b)];else{if(_0xb5cb4a[0x0][_0x4178e2(0x207)]==_0x4178e2(0x1dd))var _0x1c932c=users['German'];else{if(_0xb5cb4a[0x0]['language']==_0x4178e2(0x20d))var _0x1c932c=users[_0x4178e2(0x20d)];else{if(_0xb5cb4a[0x0][_0x4178e2(0x207)]==_0x4178e2(0x1d0))var _0x1c932c=users[_0x4178e2(0x1d0)];else{if(_0xb5cb4a[0x0][_0x4178e2(0x207)]==_0x4178e2(0x1a3))var _0x1c932c=users[_0x4178e2(0x20e)];else{if(_0xb5cb4a[0x0][_0x4178e2(0x207)]==_0x4178e2(0x1f6))var _0x1c932c=users[_0x4178e2(0x1f6)];else{if(_0xb5cb4a[0x0]['language']==_0x4178e2(0x228))var _0x1c932c=users[_0x4178e2(0x1c4)];}}}}}}}_0x3d941a[_0x4178e2(0x15d)](_0x4178e2(0x246),{'success':_0x2a2ea8[_0x4178e2(0x165)](_0x4178e2(0x17d)),'errors':_0x2a2ea8[_0x4178e2(0x165)](_0x4178e2(0x1ad)),'role':_0x221bc6,'profile':_0x32d2df,'master_shop':_0xb5cb4a,'supplier':_0x11c5de,'purchase':_0x1027db,'language':_0x1c932c});}catch(_0xe00b8a){console[_0x4178e2(0x1ff)](_0xe00b8a);}}),router[a0_0x2623cf(0x21f)](a0_0x2623cf(0x247),auth,async(_0x5368c8,_0x156b6e)=>{var _0x15b14a=a0_0x2623cf;try{const {username:_0xd9b090,email:_0x142e14,role:_0x167e94}=_0x5368c8[_0x15b14a(0x1e2)],_0x4d998e=_0x5368c8['user'],_0x5cdd5c=await profile[_0x15b14a(0x153)]({'email':_0x4d998e[_0x15b14a(0x166)]}),_0x1c7337=await master_shop['find']();console[_0x15b14a(0x1ff)]('master',_0x1c7337);const _0x259f36=_0x5368c8['params']['id'];console[_0x15b14a(0x1ff)](_0x259f36);const _0x1a8d49=await purchases_finished['findById'](_0x259f36);console['log']('user_id',_0x1a8d49);const _0x584490=await product[_0x15b14a(0x16d)]({}),_0x5ead65=await warehouse[_0x15b14a(0x221)]([{'$match':{'name':_0x1a8d49['warehouse_name'],'room':_0x1a8d49[_0x15b14a(0x164)]}},{'$unwind':_0x15b14a(0x23b)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x15b14a(0x158)},'product_stock':{'$first':_0x15b14a(0x19a)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x15b14a(0x227)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x15b14a(0x16b)},'primary_code':{'$first':_0x15b14a(0x231)},'secondary_code':{'$first':_0x15b14a(0x17c)},'product_code':{'$first':_0x15b14a(0x222)},'storage':{'$first':_0x15b14a(0x237)},'rack':{'$first':_0x15b14a(0x203)}}}]);console['log']('stock_data',_0x5ead65);let _0x35a05a;if(_0x4d998e['role']=='staff'){const _0x21ebef=await staff['findOne']({'email':_0x4d998e[_0x15b14a(0x166)]});_0x35a05a=await warehouse[_0x15b14a(0x16d)]({'status':_0x15b14a(0x168),'name':_0x21ebef[_0x15b14a(0x1bd)],'warehouse_category':_0x15b14a(0x201),'name':'Return\x20Goods'});}else _0x35a05a=await warehouse['aggregate']([{'$match':{'status':_0x15b14a(0x168),'warehouse_category':_0x15b14a(0x201),'name':'Return\x20Goods'}},{'$group':{'_id':_0x15b14a(0x1cd),'name':{'$first':_0x15b14a(0x1cd)}}}]);if(_0x1c7337[0x0][_0x15b14a(0x207)]=='English\x20(US)'){var _0x4abf00=users[_0x15b14a(0x1b3)];console[_0x15b14a(0x1ff)](_0x4abf00);}else{if(_0x1c7337[0x0][_0x15b14a(0x207)]==_0x15b14a(0x22b))var _0x4abf00=users[_0x15b14a(0x22b)];else{if(_0x1c7337[0x0]['language']==_0x15b14a(0x1dd))var _0x4abf00=users[_0x15b14a(0x1dd)];else{if(_0x1c7337[0x0][_0x15b14a(0x207)]==_0x15b14a(0x20d))var _0x4abf00=users['Spanish'];else{if(_0x1c7337[0x0][_0x15b14a(0x207)]==_0x15b14a(0x1d0))var _0x4abf00=users[_0x15b14a(0x1d0)];else{if(_0x1c7337[0x0][_0x15b14a(0x207)]=='Portuguese\x20(BR)')var _0x4abf00=users[_0x15b14a(0x20e)];else{if(_0x1c7337[0x0][_0x15b14a(0x207)]==_0x15b14a(0x1f6))var _0x4abf00=users[_0x15b14a(0x1f6)];else{if(_0x1c7337[0x0]['language']==_0x15b14a(0x228))var _0x4abf00=users[_0x15b14a(0x1c4)];}}}}}}}_0x156b6e[_0x15b14a(0x15d)]('return_purchase_finished',{'success':_0x5368c8[_0x15b14a(0x165)](_0x15b14a(0x17d)),'errors':_0x5368c8['flash'](_0x15b14a(0x1ad)),'role':_0x4d998e,'profile':_0x5cdd5c,'user':_0x1a8d49,'stock':_0x5ead65,'master_shop':_0x1c7337,'product':_0x584490,'language':_0x4abf00,'warehouse':_0x35a05a});}catch(_0x5b642d){console[_0x15b14a(0x1ff)](_0x5b642d);}}),router[a0_0x2623cf(0x217)](a0_0x2623cf(0x247),auth,async(_0x1fb256,_0x531a94)=>{var _0x503c54=a0_0x2623cf;try{const {invoice:_0x302f8b,date:_0x25c518,warehouse_name:_0x36bd0b,Room_name:_0x39bca3,product_name:_0x45567d,purchase_quantity:_0xe01d60,stocks:_0x8c67f0,return_qty:_0x3643c7,note:_0x1c169b,level:_0x3c2d50,isle:_0x175cf1,pallet:_0x1dc57f,to_warehouse_name:_0x570b10,to_Room_name:_0x5aeb8b}=_0x1fb256[_0x503c54(0x238)],_0x3d63f7=await purchases_finished[_0x503c54(0x153)]({'_id':_0x1fb256['params']['id']}),_0x58bb46=await warehouse[_0x503c54(0x153)]({'name':_0x36bd0b,'room':_0x39bca3,'warehouse_category':_0x503c54(0x201)});if(typeof _0x45567d=='string')var _0x2bafc5=[_0x1fb256['body'][_0x503c54(0x1da)]],_0x3cb48f=[_0x1fb256[_0x503c54(0x238)][_0x503c54(0x1d7)]],_0x57e975=[_0x1fb256[_0x503c54(0x238)][_0x503c54(0x19c)]],_0x2116a3=[_0x1fb256[_0x503c54(0x238)][_0x503c54(0x233)]],_0x1ff795=[_0x1fb256[_0x503c54(0x238)][_0x503c54(0x218)]],_0x44c173=[_0x1fb256[_0x503c54(0x238)]['product_code_hide']],_0x3b9a0f=[_0x1fb256[_0x503c54(0x238)][_0x503c54(0x22d)]],_0x12da23=[_0x1fb256['body']['secondary_code_hide']];else var _0x2bafc5=[..._0x1fb256[_0x503c54(0x238)][_0x503c54(0x1da)]],_0x3cb48f=[..._0x1fb256['body'][_0x503c54(0x1d7)]],_0x57e975=[..._0x1fb256[_0x503c54(0x238)][_0x503c54(0x19c)]],_0x2116a3=[..._0x1fb256[_0x503c54(0x238)][_0x503c54(0x233)]],_0x1ff795=[..._0x1fb256[_0x503c54(0x238)][_0x503c54(0x218)]],_0x44c173=[..._0x1fb256[_0x503c54(0x238)][_0x503c54(0x24d)]],_0x3b9a0f=[..._0x1fb256[_0x503c54(0x238)][_0x503c54(0x22d)]],_0x12da23=[..._0x1fb256[_0x503c54(0x238)][_0x503c54(0x1fb)]];const _0x1ea825=_0x2bafc5['map'](_0x545dcf=>{return _0x545dcf={'product_name':_0x545dcf};});_0x3cb48f[_0x503c54(0x215)]((_0x1ef738,_0x2308a5)=>{_0x1ea825[_0x2308a5]['purchase_quantity']=_0x1ef738;}),_0x57e975[_0x503c54(0x215)]((_0x3b6273,_0x3eb58f)=>{var _0x2a00ef=_0x503c54;_0x1ea825[_0x3eb58f][_0x2a00ef(0x1d1)]=_0x3b6273;}),_0x2116a3['forEach']((_0x160760,_0x3745c3)=>{var _0xdcfcd=_0x503c54;_0x1ea825[_0x3745c3][_0xdcfcd(0x233)]=_0x160760;}),_0x1ff795[_0x503c54(0x215)]((_0x2a7ec5,_0x438904)=>{var _0x5e8db8=_0x503c54;_0x1ea825[_0x438904][_0x5e8db8(0x1a5)]=_0x2a7ec5;}),_0x44c173['forEach']((_0x20e4df,_0x253cf0)=>{_0x1ea825[_0x253cf0]['product_code']=_0x20e4df;}),_0x3b9a0f[_0x503c54(0x215)]((_0xec03a7,_0x31471e)=>{var _0x1d7639=_0x503c54;_0x1ea825[_0x31471e][_0x1d7639(0x180)]=_0xec03a7;}),_0x12da23['forEach']((_0x181c31,_0x554750)=>{var _0x3056f0=_0x503c54;_0x1ea825[_0x554750][_0x3056f0(0x1dc)]=_0x181c31;}),_0x1ea825[_0x503c54(0x215)](_0x2eb5f5=>{var _0x5411f9=_0x503c54;console[_0x5411f9(0x1ff)](_0x2eb5f5);const _0x1715b8=_0x58bb46[_0x5411f9(0x151)][_0x5411f9(0x229)](_0x9be2e8=>{var _0x400c80=_0x5411f9;_0x9be2e8[_0x400c80(0x1da)]==_0x2eb5f5[_0x400c80(0x1da)]&&_0x9be2e8['bay']==_0x2eb5f5[_0x400c80(0x1a5)]&&(console[_0x400c80(0x1ff)](parseInt(_0x9be2e8[_0x400c80(0x1c3)])+_0x400c80(0x1e1)+parseInt(_0x2eb5f5[_0x400c80(0x233)])),_0x9be2e8[_0x400c80(0x1c3)]=parseInt(_0x9be2e8[_0x400c80(0x1c3)])-parseInt(_0x2eb5f5['return_qty']));});}),await _0x58bb46[_0x503c54(0x192)]();var _0x11a631=0x0;_0x1ea825[_0x503c54(0x215)](_0x5536a9=>{var _0x5e9cc0=_0x503c54;(parseInt(_0x5536a9[_0x5e9cc0(0x1d7)])<parseInt(_0x5536a9[_0x5e9cc0(0x233)])||parseInt(_0x5536a9['stock_quantity'])<parseInt(_0x5536a9['return_qty']))&&_0x11a631++;});if(_0x11a631!=0x0)return _0x1fb256[_0x503c54(0x165)](_0x503c54(0x1ad),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x531a94[_0x503c54(0x1c2)](_0x503c54(0x16a));const _0x1e6a44=new purchases_return_finished({'invoice':_0x302f8b,'suppliers':_0x1fb256[_0x503c54(0x238)][_0x503c54(0x240)],'date':_0x25c518,'warehouse_name':_0x36bd0b,'return_product':_0x1ea825,'note':_0x1c169b,'room':_0x39bca3,'to_warehouse_name':_0x570b10,'to_room':_0x5aeb8b}),_0x43bd9e=await _0x1e6a44[_0x503c54(0x192)](),_0x1a74a4=await purchases_return_finished[_0x503c54(0x153)]({'invoice':_0x302f8b}),_0x353697=await warehouse[_0x503c54(0x153)]({'name':_0x570b10,'room':_0x5aeb8b,'warehouse_category':_0x503c54(0x201)});_0x1a74a4[_0x503c54(0x155)][_0x503c54(0x215)](_0x56d29b=>{var _0x4a4119=_0x503c54,_0x2dd2e4=0x0;const _0x49a782=_0x353697[_0x4a4119(0x151)][_0x4a4119(0x229)](_0x9f87f7=>{var _0x4ee680=_0x4a4119;console[_0x4ee680(0x1ff)](_0x9f87f7[_0x4ee680(0x1da)]+'=='+_0x56d29b[_0x4ee680(0x1da)]+'&&'+_0x9f87f7[_0x4ee680(0x1a5)]+'=='+_0x56d29b[_0x4ee680(0x1a5)]),_0x9f87f7[_0x4ee680(0x1da)]==_0x56d29b[_0x4ee680(0x1da)]&&_0x9f87f7[_0x4ee680(0x1a5)]==_0x56d29b['bay']&&(_0x9f87f7[_0x4ee680(0x1c3)]=parseInt(_0x9f87f7[_0x4ee680(0x1c3)])-parseInt(_0x56d29b[_0x4ee680(0x233)]),_0x2dd2e4++);});_0x2dd2e4=='0'&&(_0x353697[_0x4a4119(0x151)]=_0x353697[_0x4a4119(0x151)][_0x4a4119(0x17f)]({'product_name':_0x56d29b[_0x4a4119(0x1da)],'product_stock':_0x56d29b[_0x4a4119(0x233)],'primary_code':_0x56d29b[_0x4a4119(0x180)],'secondary_code':_0x56d29b[_0x4a4119(0x1dc)],'product_code':_0x56d29b[_0x4a4119(0x24b)],'bay':_0x56d29b['bay'],'maxProducts':0xf423f}));}),await _0x353697[_0x503c54(0x192)]();const _0x324faa=await purchases_finished['findOne']({'invoice':_0x302f8b});_0x324faa[_0x503c54(0x208)]=_0x503c54(0x1ed);const _0x4fc14f=await _0x324faa[_0x503c54(0x192)](),_0x320369=new s_payment_data({'invoice':_0x302f8b,'suppliers':_0x1fb256[_0x503c54(0x238)][_0x503c54(0x240)],'reason':_0x503c54(0x1fc)});await _0x320369[_0x503c54(0x192)]();const _0x30aabf=await master_shop['find'](),_0x34a1d3=await email_settings['findOne'](),_0x2a097f=await suppliers[_0x503c54(0x153)]({'name':_0x1fb256['body'][_0x503c54(0x240)]});_0x30aabf[0x0][_0x503c54(0x1d8)]==0x1?(right_currency=_0x30aabf[0x0][_0x503c54(0x17a)],left_currency=''):(right_currency='',left_currency=_0x30aabf[0x0][_0x503c54(0x17a)]);var _0x1c4f5f=_0x2bafc5,_0x5c8fa2=_0x2116a3,_0x17ee1c='',_0x170242;for(_0x170242 in _0x1c4f5f){_0x17ee1c+=_0x503c54(0x18e)+_0x503c54(0x17b)+_0x1c4f5f[_0x170242]+_0x503c54(0x1be)+_0x503c54(0x17b)+_0x5c8fa2[_0x170242]+_0x503c54(0x1be)+_0x503c54(0x1bc);}let _0x25cf2c=nodemailer[_0x503c54(0x161)]({'service':'gmail','auth':{'user':_0x34a1d3[_0x503c54(0x166)],'pass':_0x34a1d3['password']}}),_0x329cbd={'from':_0x34a1d3[_0x503c54(0x166)],'to':_0x2a097f[_0x503c54(0x166)],'subject':_0x503c54(0x200),'attachments':[{'filename':_0x503c54(0x1a0),'path':__dirname+_0x503c54(0x1b2)+_0x503c54(0x1b5)+_0x30aabf[0x0][_0x503c54(0x20f)],'cid':_0x503c54(0x23a)}],'html':_0x503c54(0x213)+_0x503c54(0x1c5)+_0x503c54(0x183)+_0x503c54(0x16e)+_0x503c54(0x186)+_0x503c54(0x16e)+_0x503c54(0x239)+'</div>'+_0x503c54(0x16e)+_0x503c54(0x223)+_0x30aabf[0x0]['site_title']+_0x503c54(0x1bb)+_0x503c54(0x1b4)+_0x503c54(0x1b4)+'<hr\x20class=\x22my-3\x22>'+_0x503c54(0x16e)+_0x503c54(0x193)+'\x20Order\x20Number\x20:\x20'+_0x302f8b+'\x20'+_0x503c54(0x23e)+_0x503c54(0x1e0)+_0x25c518+'\x20'+_0x503c54(0x23f)+'</h5>'+_0x503c54(0x1b4)+_0x503c54(0x1d3)+_0x503c54(0x19f)+_0x503c54(0x18e)+_0x503c54(0x188)+_0x503c54(0x1cb)+_0x503c54(0x1eb)+_0x503c54(0x1bf)+_0x503c54(0x1bc)+_0x503c54(0x181)+_0x503c54(0x15b)+'\x20'+_0x17ee1c+'\x20'+_0x503c54(0x244)+'</table>'+_0x503c54(0x16e)+_0x503c54(0x1df)+'<h5>'+_0x30aabf[0x0][_0x503c54(0x1b8)]+_0x503c54(0x182)+'</div>'+_0x503c54(0x1b4)+_0x503c54(0x214)};_0x25cf2c[_0x503c54(0x174)](_0x329cbd,function(_0x2b6686,_0x3a565d){var _0x1de4d5=_0x503c54;_0x2b6686?console[_0x1de4d5(0x1ff)](_0x1de4d5(0x1ee)):console['log'](_0x1de4d5(0x22a));}),_0x1fb256[_0x503c54(0x165)](_0x503c54(0x17d),_0x503c54(0x157)),_0x531a94[_0x503c54(0x1c2)](_0x503c54(0x206));}catch(_0x418d90){_0x531a94[_0x503c54(0x22c)](0xc8)['json']({'message':_0x418d90[_0x503c54(0x1ba)]});}}),router[a0_0x2623cf(0x21f)]('/barcode/:id',auth,async(_0xd128e5,_0x1fa630)=>{var _0x562d00=a0_0x2623cf;try{const {username:_0xe8126c,email:_0x51edba,role:_0x1ed3ab}=_0xd128e5['user'],_0x4b1c99=_0xd128e5[_0x562d00(0x1e2)],_0x1e6876=await profile['findOne']({'email':_0x4b1c99[_0x562d00(0x166)]}),_0x32ab70=await master_shop[_0x562d00(0x16d)](),_0xbc91ce=_0xd128e5['params']['id'],_0x307813=await purchases_finished['findById'](_0xbc91ce);if(_0x32ab70[0x0][_0x562d00(0x207)]=='English\x20(US)')var _0xf2d11c=users[_0x562d00(0x1b3)];else{if(_0x32ab70[0x0][_0x562d00(0x207)]=='Hindi')var _0xf2d11c=users['Hindi'];else{if(_0x32ab70[0x0][_0x562d00(0x207)]==_0x562d00(0x1dd))var _0xf2d11c=users['German'];else{if(_0x32ab70[0x0][_0x562d00(0x207)]==_0x562d00(0x20d))var _0xf2d11c=users[_0x562d00(0x20d)];else{if(_0x32ab70[0x0][_0x562d00(0x207)]==_0x562d00(0x1d0))var _0xf2d11c=users[_0x562d00(0x1d0)];else{if(_0x32ab70[0x0][_0x562d00(0x207)]==_0x562d00(0x1a3))var _0xf2d11c=users['Portuguese'];else{if(_0x32ab70[0x0][_0x562d00(0x207)]=='Chinese')var _0xf2d11c=users[_0x562d00(0x1f6)];else{if(_0x32ab70[0x0][_0x562d00(0x207)]==_0x562d00(0x228))var _0xf2d11c=users['Arabic'];}}}}}}}_0x1fa630[_0x562d00(0x15d)]('all_purchases_barcode',{'success':_0xd128e5[_0x562d00(0x165)]('success'),'errors':_0xd128e5[_0x562d00(0x165)](_0x562d00(0x1ad)),'role':_0x4b1c99,'profile':_0x1e6876,'alldata':_0x307813,'master_shop':_0x32ab70,'language':_0xf2d11c}),console['log'](alldata);}catch(_0x495a60){console['log'](_0x495a60);}}),router['post'](a0_0x2623cf(0x1d6),async(_0x27a32,_0x1f1915)=>{var _0x36b240=a0_0x2623cf;const {product_code:_0x42f94c}=_0x27a32['body'];var _0x1eeff9;const _0x233093=await product['aggregate']([{'$match':{'primary_code':_0x42f94c,'product_category':_0x36b240(0x201)}},{'$group':{'_id':_0x36b240(0x184),'name':{'$first':_0x36b240(0x1cd)},'category':{'$first':_0x36b240(0x1a8)},'brand':{'$first':_0x36b240(0x197)},'unit':{'$first':_0x36b240(0x18c)},'alertquantity':{'$first':_0x36b240(0x198)},'product_code':{'$first':_0x36b240(0x1d5)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x36b240(0x167)},'maxStocks':{'$first':_0x36b240(0x171)},'maxProdPerUnit':{'$first':_0x36b240(0x22f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2177cf=await product[_0x36b240(0x221)]([{'$match':{'secondary_code':_0x42f94c}},{'$group':{'_id':_0x36b240(0x184),'name':{'$first':_0x36b240(0x1cd)},'category':{'$first':_0x36b240(0x1a8)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x36b240(0x1d5)},'primary_code':{'$first':_0x36b240(0x1f1)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x36b240(0x22f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x233093[_0x36b240(0x148)]>0x0)_0x1eeff9=_0x233093;else _0x2177cf['length']>0x0&&(_0x1eeff9=_0x2177cf);_0x1f1915[_0x36b240(0x190)](_0x1eeff9);}),router[a0_0x2623cf(0x217)](a0_0x2623cf(0x173),async(_0x32ceab,_0x257261)=>{var _0xa3ca53=a0_0x2623cf;const {productCode:_0x4b4b7a,bay:_0x1066da,warehouses:_0x818e5f,room:_0x313b65}=_0x32ceab[_0xa3ca53(0x238)];console['log'](_0x32ceab[_0xa3ca53(0x238)]);try{const _0x9c6704=await warehouse['aggregate']([{'$match':{'name':_0x818e5f,'room':_0x313b65}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x1066da)}},{'$group':{'_id':_0xa3ca53(0x1d9),'name':{'$first':_0xa3ca53(0x158)},'product_stock':{'$first':_0xa3ca53(0x19a)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0xa3ca53(0x1cf)}}}]);_0x257261[_0xa3ca53(0x22c)](0xc8)[_0xa3ca53(0x190)](_0x9c6704);}catch(_0x3be780){_0x257261['status'](0x194)[_0xa3ca53(0x190)]({'message':_0x3be780['message']});}}),module[a0_0x2623cf(0x22e)]=router;