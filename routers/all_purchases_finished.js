var a0_0x4122f8=a0_0x31aa;(function(_0x2ef7ca,_0x370fc6){var _0x19cb78=a0_0x31aa,_0x1a7fa8=_0x2ef7ca();while(!![]){try{var _0x31df11=-parseInt(_0x19cb78(0xef))/0x1+parseInt(_0x19cb78(0x118))/0x2+parseInt(_0x19cb78(0xe8))/0x3+parseInt(_0x19cb78(0xde))/0x4+-parseInt(_0x19cb78(0x14b))/0x5+parseInt(_0x19cb78(0x8a))/0x6*(-parseInt(_0x19cb78(0x103))/0x7)+parseInt(_0x19cb78(0xcf))/0x8;if(_0x31df11===_0x370fc6)break;else _0x1a7fa8['push'](_0x1a7fa8['shift']());}catch(_0x63c36f){_0x1a7fa8['push'](_0x1a7fa8['shift']());}}}(a0_0x30e5,0x7be26));const express=require(a0_0x4122f8(0x120)),app=express(),router=express[a0_0x4122f8(0x15c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x4122f8(0x13e)),auth=require(a0_0x4122f8(0x15b)),nodemailer=require(a0_0x4122f8(0xec));var ejs=require(a0_0x4122f8(0xeb));function a0_0x31aa(_0xe6f662,_0x5c2652){var _0x30e50d=a0_0x30e5();return a0_0x31aa=function(_0x31aac6,_0x2f82f0){_0x31aac6=_0x31aac6-0x6e;var _0x52510c=_0x30e50d[_0x31aac6];return _0x52510c;},a0_0x31aa(_0xe6f662,_0x5c2652);}const path=require(a0_0x4122f8(0xf7)),users=require(a0_0x4122f8(0x162));function a0_0x30e5(){var _0x4e17e7=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$suppliers_docs','room','then','concat','string','maxStocks','\x20<>\x20','log','/CheckingWarehouse','<hr\x20class=\x22my-3\x22>','flash','Hindi','English\x20(US)','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','back','/upload/','purchase_quantity','Paid\x20For\x20Purchase','site_title','toString','$maxProdPerUnit','</body></html>','getDate','bay','table\x20page','$date','find','warehouse_name','get','JO_number','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','add_purchases\x20error','prod_cat','$category','aggregate','</div>','$paid_amount','/../public','German','<h5\x20style=\x22text-align:\x20left;\x22>','room_name','$product','<!DOCTYPE\x20html>','</table>','/preview/:id','$maxStocks','map','purchase\x20data\x20update\x20successfully','email','product_date','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','</tr>','product','maxperunit','language','1576496xhXuJH','Logo.png','findById','message','post','Finished\x20Goods','MaxStocks_data','amount','$product_details.storage','Room_name','Error\x20Occurs','production_date','</span>','/invoice/:id','prod_invoice','1987528EElbYx','/barcode_scanner','return_purchase_finished','slice','getMonth','redirect','errors','suppliers_docs','random','$product_details.product_stock','2836974bPAGgT','product_code_hide','getFullYear','ejs','nodemailer','prod_name','<h2>\x20','593391UbNVtD','secondary_code','<html><head><title></title>','user','createTransport','gmail','$product_details.floorlevel','$suppliers','path','expiry_date','all_purchases_barcode','quantity','stock_quantity','date','/barcode/:id','INCF-','POnumber','stock_data','</thead>','Arabic\x20(ae)','56RBZFLQ','due_amount','Spanish','prod_secondunit','forEach','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','\x20</h2>','An\x20error\x20occurred\x20while\x20saving\x20data.','role','master','Error\x20occurred\x20while\x20processing\x20product:','prod_primunit','French','floor','body','primary_code_hide','$product_details.product_code','$secondary_code','$alertquantity','$product.floorlevel','1610936EQaAEu','Enabled','$product_code','$_id','FGSEmail','Purchase\x20Return','success','Portuguese\x20(BR)','express','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.rack','payment\x20successfull','English','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details._id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/all_purchases_finished/view','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.bay','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','all','Enclosed','$product_details.maxProducts','note','/view/add_purchases','warehouse','standard_unit','<h5>','edit_purchases_finished','abs','$brand','error','<tr>','user_id','$unit','prod_Qty','../models/all_models','$product_details','prod_unit','prod_level','$name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','max_product_unit','$primary_code','logo','$product.bay','Rack\x202','secondary_unit','product_name','4062885YSwuNu','$batch_code','$secondary_unit','Purchase\x20Mail','return_qty','save','product_code','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','True','\x20Order\x20Number\x20:\x20','$room','Email\x20sent\x20successfully','stocks','invoice','name','../middleware/auth','Router','</h5>','<strong>\x20Regards\x20</strong>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','prod_code','sendMail','../public/language/languages.json','image','purchase\x20data\x20add\x20successfully','filter','purchase_invoice','<div>','password','<tbody\x20style=\x22text-align:\x20center;\x22>','suppliers','</tbody>','staff','render','purchases\x20item\x20return\x20successfull','$product.type','Chinese','product_details','RoomAssign','$return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','host','FROZEN\x20GOODS','$product.quantity','$product.bin','Portuguese','paid_amount','currency','$expiry_date','Return\x20Goods','params','prod_qty','currency_placement','json','$note','Arabic','product_cat','status','398754XJXxdi','_id','primary_code','$product_details.secondary_code','</head><body>','findOne','DRY\x20GOODS','length','QA\x20Warehouse','secondary_code_hide','/view/return_purchase/:id'];a0_0x30e5=function(){return _0x4e17e7;};return a0_0x30e5();}router['get']('/view',auth,async(_0x55168b,_0x3d7f53)=>{var _0x40758b=a0_0x4122f8;try{const {username:_0x551f1a,email:_0x3c0b5a,role:_0xf9e562}=_0x55168b['user'],_0x5bfba0=_0x55168b['user'],_0x42b09b=await profile[_0x40758b(0x8f)]({'email':_0x5bfba0['email']}),_0x1020bc=await staff['findOne']({'email':_0x5bfba0['email']});if(_0x5bfba0['role']==_0x40758b(0x70)){const _0x4dc6fb=await staff['findOne']({'email':_0x5bfba0[_0x40758b(0xc7)]});}const _0x3644a4=await master_shop[_0x40758b(0xb1)]();let _0x14022b;if(_0x5bfba0[_0x40758b(0x10c)]==_0x40758b(0x70)){const _0x4d2ee3=await staff['findOne']({'email':_0x5bfba0[_0x40758b(0xc7)]});_0x14022b=await purchases_finished[_0x40758b(0xb9)]([{'$match':{'warehouse_name':_0x4d2ee3[_0x40758b(0x133)]}},{'$lookup':{'from':_0x40758b(0x6e),'localField':_0x40758b(0x6e),'foreignField':_0x40758b(0x15a),'as':_0x40758b(0xe5)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x40758b(0xc0)},{'$group':{'_id':_0x40758b(0x11b),'invoice':{'$first':_0x40758b(0x152)},'suppliers':{'$first':_0x40758b(0xf6)},'date':{'$first':_0x40758b(0xb0)},'warehouse_name':{'$first':_0x40758b(0xc9)},'room':{'$first':_0x40758b(0x156)},'product':{'$push':'$product'},'note':{'$first':_0x40758b(0x86)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x40758b(0x77)},'batch_code':{'$first':_0x40758b(0x14c)},'expiry_date':{'$first':_0x40758b(0x80)},'suppliers_docs':{'$first':_0x40758b(0x96)},'total_product_quantity':{'$sum':_0x40758b(0x7b)},'level':{'$addToSet':_0x40758b(0x147)},'isle':{'$addToSet':_0x40758b(0x7c)},'type':{'$addToSet':_0x40758b(0x73)},'floorlevel':{'$addToSet':_0x40758b(0x117)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x14022b=await purchases_finished[_0x40758b(0xb9)]([{'$unwind':_0x40758b(0xc0)},{'$group':{'_id':_0x40758b(0x11b),'invoice':{'$first':_0x40758b(0x152)},'suppliers':{'$first':_0x40758b(0xf6)},'date':{'$first':_0x40758b(0xb0)},'warehouse_name':{'$first':_0x40758b(0xc9)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x40758b(0xc0)},'note':{'$first':_0x40758b(0x86)},'paid_amount':{'$first':_0x40758b(0xbb)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x40758b(0x77)},'batch_code':{'$first':_0x40758b(0x14c)},'expiry_date':{'$first':_0x40758b(0x80)},'suppliers_docs':{'$first':_0x40758b(0x96)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x40758b(0x147)},'isle':{'$addToSet':_0x40758b(0x7c)},'type':{'$addToSet':_0x40758b(0x73)},'floorlevel':{'$addToSet':_0x40758b(0x117)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x3644a4[0x0][_0x40758b(0xce)]==_0x40758b(0xa2))var _0x4593da=users[_0x40758b(0x124)];else{if(_0x3644a4[0x0][_0x40758b(0xce)]=='Hindi')var _0x4593da=users['Hindi'];else{if(_0x3644a4[0x0]['language']==_0x40758b(0xbd))var _0x4593da=users[_0x40758b(0xbd)];else{if(_0x3644a4[0x0][_0x40758b(0xce)]==_0x40758b(0x105))var _0x4593da=users[_0x40758b(0x105)];else{if(_0x3644a4[0x0]['language']==_0x40758b(0x110))var _0x4593da=users[_0x40758b(0x110)];else{if(_0x3644a4[0x0][_0x40758b(0xce)]==_0x40758b(0x11f))var _0x4593da=users[_0x40758b(0x7d)];else{if(_0x3644a4[0x0][_0x40758b(0xce)]==_0x40758b(0x74))var _0x4593da=users[_0x40758b(0x74)];else{if(_0x3644a4[0x0][_0x40758b(0xce)]==_0x40758b(0x102))var _0x4593da=users[_0x40758b(0x87)];}}}}}}}_0x3d7f53['render']('all_purchases_finished',{'success':_0x55168b['flash'](_0x40758b(0x11e)),'errors':_0x55168b[_0x40758b(0xa0)](_0x40758b(0xe4)),'purchases':_0x14022b,'role':_0x5bfba0,'profile':_0x42b09b,'master_shop':_0x3644a4,'language':_0x4593da});}catch(_0x27941c){console[_0x40758b(0x9d)](_0x40758b(0xaf),_0x27941c),_0x3d7f53['status'](0xc8)[_0x40758b(0x85)]({'message':_0x27941c[_0x40758b(0xd2)]});}});function BayBinSelected(_0xb97be6,_0x2ebac1){var _0x51bb53=a0_0x4122f8,_0x3574cb=[],_0x53f615=[];if(_0xb97be6=='DRY\x20GOODS'){switch(_0x2ebac1){case'Rack\x201':_0x3574cb=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x51bb53(0x148):_0x3574cb=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x53f615=['DG'];}else{if(_0xb97be6==_0x51bb53(0x7a)){switch(_0x2ebac1){case'Rack\x201':_0x3574cb=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x51bb53(0x148):_0x3574cb=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x53f615=['FG'];}}return{'levels':_0x3574cb,'identify':_0x53f615};}async function getRandom8DigitNumber(){var _0x35c650=a0_0x4122f8;const _0xb5174=0x989680,_0x1c3fea=0x5f5e0ff,_0x13b04b=Math[_0x35c650(0x111)](Math[_0x35c650(0xe6)]()*(_0x1c3fea-_0xb5174+0x1))+_0xb5174;var _0x1ccf36;const _0x44c633=await purchases_finished[_0x35c650(0x8f)]({'invoice':_0x35c650(0xfe)+_0x13b04b});return _0x44c633&&_0x44c633['length']>0x0?_0x1ccf36=_0x35c650(0xfe)+_0x13b04b:_0x1ccf36='INCF-'+_0x13b04b,_0x1ccf36;}router[a0_0x4122f8(0xb3)]('/view/add_purchases',auth,async(_0x2b89b8,_0x4b7086)=>{var _0x1c21fb=a0_0x4122f8;try{const {username:_0x11275d,email:_0x59e007,role:_0x6e4911}=_0x2b89b8[_0x1c21fb(0xf2)],_0x53cbaa=_0x2b89b8[_0x1c21fb(0xf2)],_0x1c9d29=await profile[_0x1c21fb(0x8f)]({'email':_0x53cbaa[_0x1c21fb(0xc7)]}),_0x2b459d=await master_shop['find'](),_0x1fe520=await staff['findOne']({'email':_0x53cbaa[_0x1c21fb(0xc7)]}),_0x2fad90=await suppliers[_0x1c21fb(0xb1)]({});let _0x1ed87c;if(_0x53cbaa[_0x1c21fb(0x10c)]=='staff'){const _0x5c9646=await staff[_0x1c21fb(0x8f)]({'email':_0x53cbaa[_0x1c21fb(0xc7)]});_0x1ed87c=await warehouse[_0x1c21fb(0xb9)]([{'$match':{'status':_0x1c21fb(0x119),'name':_0x5c9646[_0x1c21fb(0x133)],'warehouse_category':_0x1c21fb(0xd4)}},{'$group':{'_id':_0x1c21fb(0x142),'name':{'$first':_0x1c21fb(0x142)}}}]);}else _0x1ed87c=await warehouse[_0x1c21fb(0xb9)]([{'$match':{'status':_0x1c21fb(0x119),'warehouse_category':_0x1c21fb(0xd4),'name':{'$ne':_0x1c21fb(0x92)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x27ebd8=await product['find']({}),_0x1dd446=await warehouse['find']({'status':_0x1c21fb(0x119)}),_0x41ec7c=await purchases_finished[_0x1c21fb(0xb1)]({}),_0x3d3acc=_0x41ec7c[_0x1c21fb(0x91)]+0x1,_0x675101=_0x1c21fb(0xfe)+_0x3d3acc[_0x1c21fb(0xaa)]()['padStart'](0x5,'0');var _0x4e9bd7=['Ambient',_0x1c21fb(0x12f)];if(_0x2b459d[0x0]['language']=='English\x20(US)')var _0x66fbb7=users[_0x1c21fb(0x124)];else{if(_0x2b459d[0x0][_0x1c21fb(0xce)]==_0x1c21fb(0xa1))var _0x66fbb7=users[_0x1c21fb(0xa1)];else{if(_0x2b459d[0x0]['language']=='German')var _0x66fbb7=users[_0x1c21fb(0xbd)];else{if(_0x2b459d[0x0]['language']==_0x1c21fb(0x105))var _0x66fbb7=users[_0x1c21fb(0x105)];else{if(_0x2b459d[0x0][_0x1c21fb(0xce)]=='French')var _0x66fbb7=users[_0x1c21fb(0x110)];else{if(_0x2b459d[0x0]['language']==_0x1c21fb(0x11f))var _0x66fbb7=users[_0x1c21fb(0x7d)];else{if(_0x2b459d[0x0][_0x1c21fb(0xce)]==_0x1c21fb(0x74))var _0x66fbb7=users[_0x1c21fb(0x74)];else{if(_0x2b459d[0x0][_0x1c21fb(0xce)]==_0x1c21fb(0x102))var _0x66fbb7=users['Arabic'];}}}}}}}const _0x2f7863=getRandom8DigitNumber();_0x2f7863[_0x1c21fb(0x98)](_0x5e3030=>{var _0x2d5fbd=_0x1c21fb;_0x4b7086['render']('add_purchases_finished',{'success':_0x2b89b8[_0x2d5fbd(0xa0)](_0x2d5fbd(0x11e)),'errors':_0x2b89b8[_0x2d5fbd(0xa0)]('errors'),'role':_0x53cbaa,'profile':_0x1c9d29,'suppliers':_0x2fad90,'warehouse':_0x1ed87c,'product':_0x27ebd8,'invoice':_0x5e3030,'master_shop':_0x2b459d,'language':_0x66fbb7,'find_data':_0x1dd446,'rooms_data':_0x4e9bd7});})['catch'](_0x84c2a5=>{var _0x4fc7a2=_0x1c21fb;_0x2b89b8['flash'](_0x4fc7a2(0xe4),_0x4fc7a2(0x15f)),_0x4b7086[_0x4fc7a2(0xe3)](_0x4fc7a2(0x128));});}catch(_0x3697a0){console[_0x1c21fb(0x9d)](_0x3697a0);}}),router[a0_0x4122f8(0xb3)]('/view/add_purchases/:id',auth,async(_0x1f464f,_0x5d1365)=>{var _0x5394cc=a0_0x4122f8;try{const _0x3fbcd3=_0x1f464f[_0x5394cc(0x82)]['id'];console[_0x5394cc(0x9d)](_0x3fbcd3);const _0x14a818=await master_shop['find']();console['log'](_0x5394cc(0x10d),_0x14a818);const _0x1c9a87=await product['findOne']({'name':_0x3fbcd3});console[_0x5394cc(0x9d)]('product',_0x1c9a87),_0x5d1365['status'](0xc8)[_0x5394cc(0x85)]({'product_data':_0x1c9a87,'master':_0x14a818});}catch(_0x5a0620){console[_0x5394cc(0x9d)](_0x5394cc(0xb6),_0x5a0620);}}),router[a0_0x4122f8(0xd3)](a0_0x4122f8(0x132),auth,async(_0x459771,_0x23bb83)=>{var _0x2c20f0=a0_0x4122f8;try{const {invoice:_0x23ceb1,date:_0x226e56,warehouse_name:_0x3f755b,prod_name:_0x5a69e3,prod_code:_0x1c312a,prod_qty:_0xc43977,prod_unit:_0x27c686,prod_secondunit:_0x2d7ec2,prod_level:_0x238b2e,prod_isle:_0x17a0e4,prod_pallet:_0x545b2f,note:_0x3e0fa8,expiry_date:_0x1f5cf2,batch_code:_0x46da42,payable:_0x2df057,due_amount:_0x2ee22f,Room_name:_0xc5b10b,primary_code:_0x2dcd02,secondary_code:_0x56548b,MaxStocks_data:_0x15ef03,PO_number:_0x300a98,SCRN:_0x3cd903,JO_number:_0x2032fa}=_0x459771[_0x2c20f0(0x112)];if(typeof _0x5a69e3=='string')var _0x2bb8ff=[_0x459771[_0x2c20f0(0x112)]['prod_name']],_0x135570=[_0x459771['body'][_0x2c20f0(0x160)]],_0x441f09=[_0x459771[_0x2c20f0(0x112)][_0x2c20f0(0x13d)]],_0x19bfba=[_0x459771['body'][_0x2c20f0(0x10f)]],_0x5e373d=[_0x459771[_0x2c20f0(0x112)][_0x2c20f0(0x106)]],_0x1fda05=[_0x459771[_0x2c20f0(0x112)][_0x2c20f0(0x141)]],_0x514531=[_0x459771['body'][_0x2c20f0(0x8c)]],_0x54e2ce=[_0x459771['body'][_0x2c20f0(0xf0)]],_0x480b5e=[_0x459771[_0x2c20f0(0x112)][_0x2c20f0(0xd5)]],_0x37ccab=[_0x459771['body'][_0x2c20f0(0x108)]],_0x51f432=[_0x459771['body'][_0x2c20f0(0xf8)]],_0x1087de=[_0x459771[_0x2c20f0(0x112)]['product_date']],_0x3c067d=[_0x459771[_0x2c20f0(0x112)][_0x2c20f0(0x144)]],_0x487f54=[_0x459771[_0x2c20f0(0x112)][_0x2c20f0(0xb7)]],_0x10ae35=[_0x459771['body'][_0x2c20f0(0x76)]],_0x4a6b31=[_0x459771[_0x2c20f0(0x112)][_0x2c20f0(0xdd)]];else var _0x2bb8ff=[..._0x459771[_0x2c20f0(0x112)]['prod_name']],_0x135570=[..._0x459771[_0x2c20f0(0x112)][_0x2c20f0(0x160)]],_0x441f09=[..._0x459771[_0x2c20f0(0x112)][_0x2c20f0(0x13d)]],_0x19bfba=[..._0x459771['body']['prod_primunit']],_0x5e373d=[..._0x459771[_0x2c20f0(0x112)][_0x2c20f0(0x106)]],_0x1fda05=[..._0x459771[_0x2c20f0(0x112)][_0x2c20f0(0x141)]],_0x514531=[..._0x459771[_0x2c20f0(0x112)][_0x2c20f0(0x8c)]],_0x54e2ce=[..._0x459771['body'][_0x2c20f0(0xf0)]],_0x480b5e=[..._0x459771[_0x2c20f0(0x112)][_0x2c20f0(0xd5)]],_0x37ccab=[..._0x459771[_0x2c20f0(0x112)]['batch_code']],_0x51f432=[..._0x459771[_0x2c20f0(0x112)]['expiry_date']],_0x1087de=[..._0x459771[_0x2c20f0(0x112)][_0x2c20f0(0xc8)]],_0x3c067d=[..._0x459771['body'][_0x2c20f0(0x144)]],_0x487f54=[..._0x459771[_0x2c20f0(0x112)]['prod_cat']],_0x10ae35=[..._0x459771['body'][_0x2c20f0(0x76)]],_0x4a6b31=[..._0x459771[_0x2c20f0(0x112)][_0x2c20f0(0xdd)]];const _0x3dc5df=_0x2bb8ff[_0x2c20f0(0xc5)](_0x35965c=>{return _0x35965c={'product_name':_0x35965c};});_0x135570[_0x2c20f0(0x107)]((_0x7c66ec,_0x33976f)=>{var _0x2889b9=_0x2c20f0;_0x3dc5df[_0x33976f][_0x2889b9(0x151)]=_0x7c66ec;}),_0x441f09[_0x2c20f0(0x107)]((_0x4ec9ad,_0x157f84)=>{var _0xbb8840=_0x2c20f0;_0x3dc5df[_0x157f84][_0xbb8840(0xfa)]=Math['abs'](_0x4ec9ad);}),_0x19bfba[_0x2c20f0(0x107)]((_0x30d070,_0x20c329)=>{var _0x5b84a1=_0x2c20f0;_0x3dc5df[_0x20c329][_0x5b84a1(0x134)]=_0x30d070;}),_0x5e373d[_0x2c20f0(0x107)]((_0x380896,_0xe3c0c8)=>{var _0x1752ec=_0x2c20f0;_0x3dc5df[_0xe3c0c8][_0x1752ec(0x149)]=_0x380896;}),_0x1fda05[_0x2c20f0(0x107)]((_0x1ce80a,_0x45bcf7)=>{var _0x204771=_0x2c20f0;_0x3dc5df[_0x45bcf7][_0x204771(0xae)]=_0x1ce80a;}),_0x514531[_0x2c20f0(0x107)]((_0x534712,_0x1ced90)=>{var _0x271172=_0x2c20f0;_0x3dc5df[_0x1ced90][_0x271172(0x8c)]=_0x534712;}),_0x54e2ce[_0x2c20f0(0x107)]((_0x4e9be6,_0x85995b)=>{var _0x46c3fe=_0x2c20f0;_0x3dc5df[_0x85995b][_0x46c3fe(0xf0)]=_0x4e9be6;}),_0x480b5e[_0x2c20f0(0x107)]((_0x2bfa65,_0x15ddf1)=>{_0x3dc5df[_0x15ddf1]['maxStocks']=_0x2bfa65;}),_0x37ccab['forEach']((_0x2600b5,_0x2add65)=>{var _0x54ae3d=_0x2c20f0;_0x3dc5df[_0x2add65][_0x54ae3d(0x108)]=_0x2600b5;}),_0x51f432['forEach']((_0x57ce6c,_0x428613)=>{_0x3dc5df[_0x428613]['expiry_date']=_0x57ce6c;}),_0x1087de['forEach']((_0x359a7b,_0x4a30d6)=>{var _0x49c5e5=_0x2c20f0;_0x3dc5df[_0x4a30d6][_0x49c5e5(0xda)]=_0x359a7b;}),_0x3c067d['forEach']((_0x3c88e1,_0x12f3da)=>{var _0x2ad233=_0x2c20f0;_0x3dc5df[_0x12f3da][_0x2ad233(0xcd)]=_0x3c88e1;}),_0x487f54['forEach']((_0x53ecd6,_0x4e8400)=>{var _0x808d04=_0x2c20f0;_0x3dc5df[_0x4e8400][_0x808d04(0x88)]=_0x53ecd6;}),_0x10ae35['forEach']((_0x4d9593,_0x350a68)=>{var _0x200b0b=_0x2c20f0;_0x3dc5df[_0x350a68][_0x200b0b(0xbf)]=_0x4d9593;}),_0x4a6b31['forEach']((_0x232a94,_0x9a8931)=>{var _0x5505c3=_0x2c20f0;_0x3dc5df[_0x9a8931][_0x5505c3(0x159)]=_0x232a94;});const _0x3570ba=_0x3dc5df['filter'](_0x300e36=>_0x300e36['quantity']!=='0'&&_0x300e36[_0x2c20f0(0xfa)]!==''),_0xa1ffcc=new purchases_finished({'invoice':_0x23ceb1,'suppliers':_0x459771[_0x2c20f0(0x112)][_0x2c20f0(0x6e)],'date':_0x226e56,'warehouse_name':_0x3f755b,'product':_0x3570ba,'note':_0x3e0fa8,'due_amount':_0x2ee22f,'room':_0xc5b10b,'POnumber':_0x300a98,'SCRN':_0x3cd903,'JO_number':_0x2032fa}),_0x11c21b=await _0xa1ffcc['save'](),_0x162c71=await purchases_finished[_0x2c20f0(0x8f)]({'invoice':_0x23ceb1}),_0x125e1c=_0x162c71[_0x2c20f0(0xcc)]['map'](async _0x2c986f=>{var _0x488d20=_0x2c20f0;try{var _0x1ceb31=await warehouse[_0x488d20(0x8f)]({'name':_0x3f755b,'room':_0x2c986f[_0x488d20(0xbf)]}),_0x34d8eb=0x0;const _0xa90c1=_0x1ceb31[_0x488d20(0x75)]['map'](_0x213d74=>{var _0x241e7f=_0x488d20;console[_0x241e7f(0x9d)](_0x213d74[_0x241e7f(0x14a)]+'=='+_0x2c986f[_0x241e7f(0x14a)]+'&&'+_0x213d74['bay']+'=='+_0x2c986f[_0x241e7f(0xae)]+'&&'+_0x213d74[_0x241e7f(0xf8)]+'=='+_0x2c986f['expiry_date']+'&&'+_0x213d74[_0x241e7f(0xda)]+'=='+_0x2c986f[_0x241e7f(0xda)]+'&&'+_0x213d74[_0x241e7f(0x108)]+'=='+_0x2c986f[_0x241e7f(0x108)]+'&&'+_0x213d74[_0x241e7f(0x159)]+'=='+_0x162c71[_0x241e7f(0x159)]),_0x213d74[_0x241e7f(0x14a)]==_0x2c986f['product_name']&&_0x213d74[_0x241e7f(0xae)]==_0x2c986f[_0x241e7f(0xae)]&&_0x213d74[_0x241e7f(0xf8)]==_0x2c986f['expiry_date']&&_0x213d74[_0x241e7f(0xda)]==_0x2c986f[_0x241e7f(0xda)]&&_0x213d74[_0x241e7f(0x108)]==_0x2c986f['batch_code']&&_0x213d74[_0x241e7f(0x159)]==_0x162c71[_0x241e7f(0x159)]&&(_0x213d74['product_stock']=Math[_0x241e7f(0x137)](_0x213d74['product_stock'])+Math['abs'](_0x2c986f[_0x241e7f(0xfa)]),_0x34d8eb++);});return _0x34d8eb==0x0&&(_0x1ceb31[_0x488d20(0x75)]=_0x1ceb31[_0x488d20(0x75)][_0x488d20(0x99)]({'product_name':_0x2c986f['product_name'],'product_stock':Math[_0x488d20(0x137)](_0x2c986f['quantity']),'primary_code':_0x2c986f[_0x488d20(0x8c)],'secondary_code':_0x2c986f[_0x488d20(0xf0)],'product_code':_0x2c986f[_0x488d20(0x151)],'bay':_0x2c986f['bay'],'maxProducts':_0x2c986f[_0x488d20(0x9b)],'unit':_0x2c986f[_0x488d20(0x134)],'secondary_unit':_0x2c986f[_0x488d20(0x149)],'expiry_date':_0x2c986f['expiry_date'],'production_date':_0x2c986f[_0x488d20(0xda)],'maxProducts':_0x2c986f[_0x488d20(0x9b)],'maxPerUnit':_0x2c986f['maxperunit'],'batch_code':_0x2c986f[_0x488d20(0x108)],'product_cat':_0x2c986f[_0x488d20(0x88)],'invoice':_0x2c986f[_0x488d20(0x159)],'id_incoming':_0x2c986f[_0x488d20(0x8b)]})),_0x1ceb31;}catch(_0x41f8b6){return console[_0x488d20(0x139)](_0x488d20(0x10e),_0x41f8b6),null;}});Promise[_0x2c20f0(0x12e)](_0x125e1c)[_0x2c20f0(0x98)](async _0x481df8=>{var _0x1167a9=_0x2c20f0;try{for(const _0x4fce51 of _0x481df8){await warehouse['updateOne']({'_id':_0x4fce51['_id']},{'$addToSet':{'product_details':{'$each':_0x4fce51[_0x1167a9(0x75)]}}});}const _0x2d55a1=await master_shop[_0x1167a9(0xb1)](),_0x192492=await email_settings[_0x1167a9(0x8f)](),_0x33ced4=await supervisor_settings['find']();var _0x364e74=_0x162c71['product'],_0xbd15c5='',_0x5814d7;for(_0x5814d7 in _0x364e74){var _0x1a1070='FG';_0x162c71[_0x1167a9(0xb2)]==_0x1167a9(0x90)&&(_0x1a1070='DG'),_0xbd15c5+=_0x1167a9(0x13a)+_0x1167a9(0x125)+_0x364e74[_0x5814d7]['product_name']+_0x1167a9(0xa3)+_0x1167a9(0x125)+_0x364e74[_0x5814d7]['product_code']+_0x1167a9(0xa3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x364e74[_0x5814d7][_0x1167a9(0xfa)]+'</td>'+_0x1167a9(0x125)+_0x364e74[_0x5814d7][_0x1167a9(0x134)]+'</td>'+_0x1167a9(0x125)+_0x364e74[_0x5814d7]['secondary_unit']+_0x1167a9(0xa3)+_0x1167a9(0x125)+_0x162c71['warehouse_name']+_0x1167a9(0xa3)+_0x1167a9(0x125)+_0x364e74[_0x5814d7][_0x1167a9(0xbf)]+_0x1167a9(0xa3)+_0x1167a9(0x125)+_0x1a1070+_0x364e74[_0x5814d7][_0x1167a9(0xae)]+_0x1167a9(0xa3),_0x1167a9(0xcb);}let _0xd88256=nodemailer[_0x1167a9(0xf3)]({'host':_0x192492[_0x1167a9(0x79)],'port':Number(_0x192492['port']),'secure':![],'auth':{'user':_0x192492['email'],'pass':_0x192492[_0x1167a9(0x168)]}}),_0x5ed149={'from':_0x192492[_0x1167a9(0xc7)],'to':_0x33ced4[0x0][_0x1167a9(0x11c)],'subject':_0x1167a9(0x14e),'attachments':[{'filename':_0x1167a9(0xd0),'path':__dirname+_0x1167a9(0xbc)+_0x1167a9(0xa6)+_0x2d55a1[0x0][_0x1167a9(0x163)],'cid':_0x1167a9(0x146)}],'html':_0x1167a9(0xc1)+_0x1167a9(0xf1)+_0x1167a9(0x8e)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1167a9(0x167)+_0x1167a9(0x127)+'</div>'+'<div>'+_0x1167a9(0xee)+_0x2d55a1[0x0][_0x1167a9(0xa9)]+_0x1167a9(0x10a)+_0x1167a9(0xba)+_0x1167a9(0xba)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x1167a9(0xbe)+'\x20Order\x20Number\x20:\x20'+_0x162c71[_0x1167a9(0x159)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x162c71[_0x1167a9(0xfc)]+'\x20'+_0x1167a9(0xdb)+_0x1167a9(0x15d)+_0x1167a9(0xba)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1167a9(0xb5)+_0x1167a9(0x13a)+_0x1167a9(0x121)+_0x1167a9(0xa4)+_0x1167a9(0x153)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x1167a9(0xca)+_0x1167a9(0x109)+_0x1167a9(0x78)+_0x1167a9(0x12a)+_0x1167a9(0xcb)+_0x1167a9(0x101)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xbd15c5+'\x20'+_0x1167a9(0x6f)+_0x1167a9(0xc2)+'<div>'+_0x1167a9(0x15e)+_0x1167a9(0x135)+_0x2d55a1[0x0][_0x1167a9(0xa9)]+_0x1167a9(0x15d)+'</div>'+'</div>'+_0x1167a9(0xac)};_0xd88256[_0x1167a9(0x161)](_0x5ed149,function(_0x5abe93,_0x5b6cf2){var _0x19ef10=_0x1167a9;_0x5abe93?(console['log'](_0x5abe93),console['log'](_0x19ef10(0xd9))):console[_0x19ef10(0x9d)](_0x19ef10(0x157));});}catch(_0xe422b0){console[_0x1167a9(0x139)](_0xe422b0),_0x23bb83[_0x1167a9(0x89)](0x1f4)[_0x1167a9(0x85)]({'error':_0x1167a9(0x10b),'message':_0xe422b0[_0x1167a9(0xd2)]});}})['catch'](_0x4262d1=>{var _0x311a88=_0x2c20f0;console[_0x311a88(0x139)](_0x4262d1);}),_0x459771[_0x2c20f0(0xa0)](_0x2c20f0(0x11e),_0x2c20f0(0x164)),_0x23bb83[_0x2c20f0(0xe3)](_0x2c20f0(0x128));}catch(_0x226438){console[_0x2c20f0(0x9d)](_0x226438);}}),router[a0_0x4122f8(0xb3)](a0_0x4122f8(0xc3),auth,async(_0x4acb44,_0x4d58b2)=>{var _0x3e4c54=a0_0x4122f8;try{const {username:_0x8e239,email:_0x124dbc,role:_0xe5cfb8}=_0x4acb44['user'],_0x55a387=_0x4acb44['user'],_0x58d6f0=await profile[_0x3e4c54(0x8f)]({'email':_0x55a387['email']}),_0xd8281b=await master_shop['find'](),_0x3432bd=_0x4acb44[_0x3e4c54(0x82)]['id'],_0xc25021=await purchases_finished[_0x3e4c54(0xd1)](_0x3432bd),_0x2e01d0=await suppliers[_0x3e4c54(0xb1)]({});let _0x149a49;if(_0x55a387[_0x3e4c54(0x10c)]==_0x3e4c54(0x70)){const _0x145921=await staff['findOne']({'email':_0x55a387['email']});_0x149a49=await warehouse['find']({'status':_0x3e4c54(0x119),'name':_0x145921[_0x3e4c54(0x133)],'warehouse_category':_0x3e4c54(0xd4)});}else _0x149a49=await warehouse[_0x3e4c54(0xb9)]([{'$match':{'status':_0x3e4c54(0x119),'warehouse_category':_0x3e4c54(0xd4)}},{'$group':{'_id':_0x3e4c54(0x142),'name':{'$first':_0x3e4c54(0x142)}}}]);const _0xdaf052=await product[_0x3e4c54(0xb1)]({}),_0x10ce87=BayBinSelected(_0xc25021[_0x3e4c54(0xb2)],_0xc25021[_0x3e4c54(0x97)]);let _0x47ec76=new Date(_0xc25021[_0x3e4c54(0xf8)]),_0x39078a=('0'+_0x47ec76[_0x3e4c54(0xad)]())[_0x3e4c54(0xe1)](-0x2),_0x3a6724=('0'+(_0x47ec76[_0x3e4c54(0xe2)]()+0x1))[_0x3e4c54(0xe1)](-0x2),_0x39f0e8=_0x47ec76[_0x3e4c54(0xea)](),_0x38ed30=_0x39f0e8+'-'+_0x3a6724+'-'+_0x39078a;if(_0xd8281b[0x0]['language']==_0x3e4c54(0xa2)){var _0x4a70b=users[_0x3e4c54(0x124)];console['log'](_0x4a70b);}else{if(_0xd8281b[0x0]['language']=='Hindi')var _0x4a70b=users[_0x3e4c54(0xa1)];else{if(_0xd8281b[0x0]['language']=='German')var _0x4a70b=users[_0x3e4c54(0xbd)];else{if(_0xd8281b[0x0][_0x3e4c54(0xce)]==_0x3e4c54(0x105))var _0x4a70b=users[_0x3e4c54(0x105)];else{if(_0xd8281b[0x0][_0x3e4c54(0xce)]==_0x3e4c54(0x110))var _0x4a70b=users[_0x3e4c54(0x110)];else{if(_0xd8281b[0x0][_0x3e4c54(0xce)]==_0x3e4c54(0x11f))var _0x4a70b=users[_0x3e4c54(0x7d)];else{if(_0xd8281b[0x0][_0x3e4c54(0xce)]==_0x3e4c54(0x74))var _0x4a70b=users[_0x3e4c54(0x74)];else{if(_0xd8281b[0x0]['language']=='Arabic\x20(ae)')var _0x4a70b=users['Arabic'];}}}}}}}_0x4d58b2[_0x3e4c54(0x71)]('edit_purchases_finished_view',{'success':_0x4acb44[_0x3e4c54(0xa0)]('success'),'errors':_0x4acb44[_0x3e4c54(0xa0)](_0x3e4c54(0xe4)),'role':_0x55a387,'profile':_0x58d6f0,'purchases':_0xc25021,'suppliers':_0x2e01d0,'warehouse':_0x149a49,'product':_0xdaf052,'master_shop':_0xd8281b,'language':_0x4a70b,'ed_fullDate':_0x38ed30,'dataSelected':_0x10ce87});}catch(_0x5d2dba){console[_0x3e4c54(0x9d)](_0x5d2dba);}}),router[a0_0x4122f8(0xb3)]('/view/:id',auth,async(_0x5765e7,_0x4c1ee3)=>{var _0x2945aa=a0_0x4122f8;try{const {username:_0x53386e,email:_0x31c4b5,role:_0x4a4aa1}=_0x5765e7[_0x2945aa(0xf2)],_0x3cad83=_0x5765e7[_0x2945aa(0xf2)],_0x1fdcf0=await profile[_0x2945aa(0x8f)]({'email':_0x3cad83[_0x2945aa(0xc7)]}),_0x11f395=await master_shop[_0x2945aa(0xb1)](),_0x508251=_0x5765e7['params']['id'],_0x5b6a18=await purchases_finished['findById'](_0x508251),_0x1599f4=await suppliers[_0x2945aa(0xb1)]({});let _0x190469;if(_0x3cad83[_0x2945aa(0x10c)]==_0x2945aa(0x70)){const _0x7fcef0=await staff[_0x2945aa(0x8f)]({'email':_0x3cad83[_0x2945aa(0xc7)]});_0x190469=await warehouse[_0x2945aa(0xb1)]({'status':_0x2945aa(0x119),'name':_0x7fcef0['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x190469=await warehouse['aggregate']([{'$match':{'status':_0x2945aa(0x119),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x2945aa(0x142),'name':{'$first':_0x2945aa(0x142)}}}]);const _0x50f340=await product['find']({}),_0x3dc9c3=BayBinSelected(_0x5b6a18[_0x2945aa(0xb2)],_0x5b6a18[_0x2945aa(0x97)]);let _0x394ce1=new Date(_0x5b6a18[_0x2945aa(0xf8)]),_0x3a4c8d=('0'+_0x394ce1[_0x2945aa(0xad)]())[_0x2945aa(0xe1)](-0x2),_0x6ac129=('0'+(_0x394ce1['getMonth']()+0x1))['slice'](-0x2),_0x40f947=_0x394ce1[_0x2945aa(0xea)](),_0x400978=_0x40f947+'-'+_0x6ac129+'-'+_0x3a4c8d;if(_0x11f395[0x0][_0x2945aa(0xce)]==_0x2945aa(0xa2)){var _0x568a0d=users['English'];console[_0x2945aa(0x9d)](_0x568a0d);}else{if(_0x11f395[0x0][_0x2945aa(0xce)]==_0x2945aa(0xa1))var _0x568a0d=users[_0x2945aa(0xa1)];else{if(_0x11f395[0x0][_0x2945aa(0xce)]==_0x2945aa(0xbd))var _0x568a0d=users[_0x2945aa(0xbd)];else{if(_0x11f395[0x0][_0x2945aa(0xce)]=='Spanish')var _0x568a0d=users[_0x2945aa(0x105)];else{if(_0x11f395[0x0][_0x2945aa(0xce)]=='French')var _0x568a0d=users['French'];else{if(_0x11f395[0x0]['language']==_0x2945aa(0x11f))var _0x568a0d=users[_0x2945aa(0x7d)];else{if(_0x11f395[0x0][_0x2945aa(0xce)]=='Chinese')var _0x568a0d=users[_0x2945aa(0x74)];else{if(_0x11f395[0x0][_0x2945aa(0xce)]==_0x2945aa(0x102))var _0x568a0d=users[_0x2945aa(0x87)];}}}}}}}_0x4c1ee3[_0x2945aa(0x71)](_0x2945aa(0x136),{'success':_0x5765e7['flash'](_0x2945aa(0x11e)),'errors':_0x5765e7['flash'](_0x2945aa(0xe4)),'role':_0x3cad83,'profile':_0x1fdcf0,'purchases':_0x5b6a18,'suppliers':_0x1599f4,'warehouse':_0x190469,'product':_0x50f340,'master_shop':_0x11f395,'language':_0x568a0d,'ed_fullDate':_0x400978,'dataSelected':_0x3dc9c3});}catch(_0x2908ec){console['log'](_0x2908ec);}}),router[a0_0x4122f8(0xd3)]('/view/:id',auth,async(_0x45d8f5,_0x477936)=>{var _0x11f96b=a0_0x4122f8;try{const _0x2b42ed=_0x45d8f5['params']['id'],_0xfbb5c5=await purchases_finished[_0x11f96b(0x8f)]({'_id':_0x45d8f5[_0x11f96b(0x82)]['id']}),_0x234689=await warehouse['findOne']({'name':_0xfbb5c5[_0x11f96b(0xb2)],'room':_0xfbb5c5['room']});_0xfbb5c5[_0x11f96b(0xcc)][_0x11f96b(0x107)](_0x523e40=>{var _0x588266=_0x11f96b;const _0x28025b=_0x234689[_0x588266(0x75)][_0x588266(0xc5)](_0x3efcc7=>{var _0x3f74c3=_0x588266;_0x3efcc7[_0x3f74c3(0x14a)]==_0x523e40[_0x3f74c3(0x14a)]&&_0x3efcc7['bay']==_0x523e40[_0x3f74c3(0xae)]&&(_0x3efcc7[_0x3f74c3(0x129)]=parseInt(_0x3efcc7[_0x3f74c3(0x129)])-parseInt(_0x523e40['quantity']));});}),await _0x234689[_0x11f96b(0x150)]();const {invoice:_0x2378bd,suppliers:_0x540cb6,date:_0x5a275a,warehouse_name:_0x2822bf,prod_name:_0x3695c2,prod_code:_0x5aa700,prod_qty:_0x580ae8,prod_unit:_0x12b0f2,prod_secondunit:_0x34d31f,prod_level:_0x4b439,prod_isle:_0xa48698,prod_pallet:_0x432d6d,note:_0xb608ff,expiry_date:_0x46025c,batch_code:_0x191a44,paid_amount:_0x59f0b5,due_amount:_0xf5b0fa,Room_name:_0x286f38,primary_code:_0x45e9c2,secondary_code:_0x1a6da0,PO_number:_0x73aedb,JO_number:_0x25fba2}=_0x45d8f5[_0x11f96b(0x112)];if(typeof _0x3695c2==_0x11f96b(0x9a))var _0x13f269=[_0x45d8f5[_0x11f96b(0x112)]['prod_name']],_0x156534=[_0x45d8f5['body'][_0x11f96b(0x160)]],_0x55601b=[_0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0x83)]],_0x2c0aab=[_0x45d8f5['body']['prod_unit']],_0x38855b=[_0x45d8f5['body'][_0x11f96b(0x106)]],_0x1e6108=[_0x45d8f5['body']['prod_level']],_0x3b0a69=[_0x45d8f5['body'][_0x11f96b(0x8c)]],_0x4b63dc=[_0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0xf0)]],_0x3cf9f3=[_0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0xd5)]],_0x2d70f2=[_0x45d8f5[_0x11f96b(0x112)]['batch_code']],_0x1e3ded=[_0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0xf8)]];else var _0x13f269=[..._0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0xed)]],_0x156534=[..._0x45d8f5['body'][_0x11f96b(0x160)]],_0x55601b=[..._0x45d8f5['body'][_0x11f96b(0x83)]],_0x2c0aab=[..._0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0x140)]],_0x38855b=[..._0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0x106)]],_0x1e6108=[..._0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0x141)]],_0x3b0a69=[..._0x45d8f5[_0x11f96b(0x112)]['primary_code']],_0x4b63dc=[..._0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0xf0)]],_0x3cf9f3=[..._0x45d8f5['body'][_0x11f96b(0xd5)]],_0x2d70f2=[..._0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0x108)]],_0x1e3ded=[..._0x45d8f5['body']['expiry_date']];const _0xe71fba=_0x13f269[_0x11f96b(0xc5)](_0x433de1=>{return _0x433de1={'product_name':_0x433de1};});_0x156534[_0x11f96b(0x107)]((_0x487ae1,_0x340ae7)=>{_0xe71fba[_0x340ae7]['product_code']=_0x487ae1;}),_0x55601b[_0x11f96b(0x107)]((_0x177693,_0x893c4d)=>{var _0x2f1f50=_0x11f96b;_0xe71fba[_0x893c4d][_0x2f1f50(0xfa)]=_0x177693;}),_0x2c0aab[_0x11f96b(0x107)]((_0x361ede,_0x544048)=>{var _0x1db9c1=_0x11f96b;_0xe71fba[_0x544048][_0x1db9c1(0x134)]=_0x361ede;}),_0x38855b['forEach']((_0xb1d881,_0x36e581)=>{_0xe71fba[_0x36e581]['secondary_unit']=_0xb1d881;}),_0x1e6108[_0x11f96b(0x107)]((_0x93c4a3,_0x5ecb71)=>{var _0x247434=_0x11f96b;_0xe71fba[_0x5ecb71][_0x247434(0xae)]=_0x93c4a3;}),_0x3b0a69[_0x11f96b(0x107)]((_0x244c0a,_0x51d99a)=>{_0xe71fba[_0x51d99a]['primary_code']=_0x244c0a;}),_0x4b63dc[_0x11f96b(0x107)]((_0x403966,_0x114dff)=>{_0xe71fba[_0x114dff]['secondary_code']=_0x403966;}),_0x3cf9f3['forEach']((_0x141b3e,_0x5ad0eb)=>{var _0x40ce35=_0x11f96b;_0xe71fba[_0x5ad0eb][_0x40ce35(0x9b)]=_0x141b3e;}),_0x2d70f2['forEach']((_0x5493ed,_0x32ccac)=>{var _0x1924f9=_0x11f96b;_0xe71fba[_0x32ccac][_0x1924f9(0x108)]=_0x5493ed;}),_0x1e3ded[_0x11f96b(0x107)]((_0x3976ef,_0x3dc821)=>{var _0x1ca241=_0x11f96b;_0xe71fba[_0x3dc821][_0x1ca241(0xf8)]=_0x3976ef;});const _0x52caef=_0xe71fba[_0x11f96b(0x165)](_0x21d6cc=>_0x21d6cc[_0x11f96b(0xfa)]!=='0'&&_0x21d6cc['quantity']!=='');_0xfbb5c5[_0x11f96b(0x159)]=_0x2378bd,_0xfbb5c5[_0x11f96b(0x6e)]=_0x540cb6,_0xfbb5c5[_0x11f96b(0xfc)]=_0x5a275a,_0xfbb5c5[_0x11f96b(0xb2)]=_0x2822bf,_0xfbb5c5['product']=_0x52caef,_0xfbb5c5[_0x11f96b(0x131)]=_0xb608ff,_0xfbb5c5[_0x11f96b(0x7e)]=_0x59f0b5,_0xfbb5c5[_0x11f96b(0x104)]=_0xf5b0fa,_0xfbb5c5[_0x11f96b(0x97)]=_0x286f38,_0xfbb5c5[_0x11f96b(0xff)]=_0x73aedb,_0xfbb5c5[_0x11f96b(0xb4)]=_0x25fba2;const _0xf3734e=await _0xfbb5c5['save'](),_0x717098=await warehouse[_0x11f96b(0x8f)]({'name':_0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0xb2)],'room':_0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0xd8)]});_0xfbb5c5['product'][_0x11f96b(0x107)](_0x257172=>{var _0x22ba3f=_0x11f96b,_0x4057af=0x0;const _0xe04b6=_0x717098[_0x22ba3f(0x75)][_0x22ba3f(0xc5)](_0x9a2ec7=>{var _0x45ed66=_0x22ba3f;_0x9a2ec7[_0x45ed66(0x14a)]==_0x257172[_0x45ed66(0x14a)]&&_0x9a2ec7['bay']==_0x257172[_0x45ed66(0xae)]&&(_0x9a2ec7[_0x45ed66(0x129)]=parseInt(_0x9a2ec7[_0x45ed66(0x129)])+parseInt(_0x257172[_0x45ed66(0xfa)]),_0x4057af++);});_0x4057af=='0'&&(_0x717098[_0x22ba3f(0x75)]=_0x717098[_0x22ba3f(0x75)][_0x22ba3f(0x99)]({'product_name':_0x257172[_0x22ba3f(0x14a)],'product_stock':_0x257172[_0x22ba3f(0xfa)],'primary_code':_0x257172['primary_code'],'secondary_code':_0x257172[_0x22ba3f(0xf0)],'product_code':_0x257172[_0x22ba3f(0x151)],'bay':_0x257172[_0x22ba3f(0xae)],'maxProducts':_0x257172[_0x22ba3f(0x9b)],'unit':_0x257172[_0x22ba3f(0x134)],'secondary_unit':_0x257172[_0x22ba3f(0x149)],'expiry_date':_0x257172['expiry_date']}));}),await _0x717098[_0x11f96b(0x150)]();const _0x17d044=await s_payment_data[_0x11f96b(0x8f)]({'invoice':_0x45d8f5[_0x11f96b(0x112)]['invoice']});if(_0x17d044===null){}else console[_0x11f96b(0x9d)](_0x11f96b(0x6e),_0x17d044,_0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0x159)]),_0x17d044[_0x11f96b(0x6e)]=_0x45d8f5[_0x11f96b(0x112)][_0x11f96b(0x6e)],await _0x17d044[_0x11f96b(0x150)]();_0x45d8f5[_0x11f96b(0xa0)]('success',_0x11f96b(0xc6)),_0x477936['redirect']('/all_purchases_finished/view');}catch(_0x4f5740){console['log'](_0x4f5740);}}),router['post']('/give_payment/:id',auth,async(_0xda38ba,_0xf911ed)=>{var _0x5705a2=a0_0x4122f8;try{const _0x51f931=_0xda38ba[_0x5705a2(0x82)]['id'],{invoice:_0x1ab715,suppliers:_0x4233e4,payable:_0x57b83f,due_amount:_0x300b58}=_0xda38ba['body'],_0x265943=await purchases['findById'](_0x51f931);var _0x136e7e=_0x57b83f-_0x300b58;_0x265943['paid_amount']=parseFloat(_0x265943[_0x5705a2(0x7e)])+parseFloat(_0x300b58),_0x265943[_0x5705a2(0x104)]=_0x136e7e;const _0x17c0cb=await _0x265943['save']();console[_0x5705a2(0x9d)](_0x17c0cb);const _0x449ac1=await s_payment_data[_0x5705a2(0x8f)]({'invoice':_0x1ab715});_0x449ac1[_0x5705a2(0xd6)]=_0x136e7e,await _0x449ac1[_0x5705a2(0x150)]();let _0x1ad9bd=new Date(),_0x529bce=('0'+_0x1ad9bd[_0x5705a2(0xad)]())[_0x5705a2(0xe1)](-0x2),_0x4b0366=('0'+(_0x1ad9bd[_0x5705a2(0xe2)]()+0x1))['slice'](-0x2),_0x42e9f1=_0x1ad9bd[_0x5705a2(0xea)](),_0x164475=_0x42e9f1+'-'+_0x4b0366+'-'+_0x529bce;const _0x3b2d42=new suppliers_payment({'invoice':_0x1ab715,'date':_0x42e9f1+'-'+_0x4b0366+'-'+_0x529bce,'suppliers':_0x4233e4,'reason':_0x5705a2(0xa8),'amount':_0x300b58}),_0x136cf0=await _0x3b2d42[_0x5705a2(0x150)]();_0xda38ba['flash'](_0x5705a2(0x11e),_0x5705a2(0x123)),_0xf911ed[_0x5705a2(0xe3)]('/all_purchases/view');}catch(_0x3f4ea0){console[_0x5705a2(0x9d)](_0x3f4ea0);}}),router[a0_0x4122f8(0xb3)](a0_0x4122f8(0xdc),auth,async(_0x4b5f20,_0x46f99d)=>{var _0x2109ce=a0_0x4122f8;try{const {username:_0xad1b14,email:_0x4afb91,role:_0xa8d2aa}=_0x4b5f20[_0x2109ce(0xf2)],_0x18201b=_0x4b5f20[_0x2109ce(0xf2)],_0x438231=await profile[_0x2109ce(0x8f)]({'email':_0x18201b['email']}),_0x4da186=await master_shop[_0x2109ce(0xb1)]();console[_0x2109ce(0x9d)](_0x2109ce(0x10d),_0x4da186);const _0x42fb14=_0x4b5f20[_0x2109ce(0x82)]['id'],_0xaa0c5d=await purchases['findById'](_0x42fb14);console[_0x2109ce(0x9d)](_0xaa0c5d);const _0x3091aa=await suppliers['findOne']({'name':_0xaa0c5d[_0x2109ce(0x6e)]});console[_0x2109ce(0x9d)](_0x3091aa);if(_0x4da186[0x0][_0x2109ce(0xce)]==_0x2109ce(0xa2)){var _0x5e9d0b=users[_0x2109ce(0x124)];console[_0x2109ce(0x9d)](_0x5e9d0b);}else{if(_0x4da186[0x0]['language']==_0x2109ce(0xa1))var _0x5e9d0b=users['Hindi'];else{if(_0x4da186[0x0][_0x2109ce(0xce)]=='German')var _0x5e9d0b=users[_0x2109ce(0xbd)];else{if(_0x4da186[0x0]['language']==_0x2109ce(0x105))var _0x5e9d0b=users[_0x2109ce(0x105)];else{if(_0x4da186[0x0][_0x2109ce(0xce)]==_0x2109ce(0x110))var _0x5e9d0b=users['French'];else{if(_0x4da186[0x0][_0x2109ce(0xce)]==_0x2109ce(0x11f))var _0x5e9d0b=users['Portuguese'];else{if(_0x4da186[0x0][_0x2109ce(0xce)]=='Chinese')var _0x5e9d0b=users[_0x2109ce(0x74)];else{if(_0x4da186[0x0][_0x2109ce(0xce)]==_0x2109ce(0x102))var _0x5e9d0b=users[_0x2109ce(0x87)];}}}}}}}_0x46f99d[_0x2109ce(0x71)](_0x2109ce(0x166),{'success':_0x4b5f20['flash'](_0x2109ce(0x11e)),'errors':_0x4b5f20[_0x2109ce(0xa0)](_0x2109ce(0xe4)),'role':_0x18201b,'profile':_0x438231,'master_shop':_0x4da186,'supplier':_0x3091aa,'purchase':_0xaa0c5d,'language':_0x5e9d0b});}catch(_0x22708d){console[_0x2109ce(0x9d)](_0x22708d);}}),router['get'](a0_0x4122f8(0x94),auth,async(_0x5db449,_0x28c5ae)=>{var _0x17dc6b=a0_0x4122f8;try{const {username:_0x4f822f,email:_0x2f05ac,role:_0x14df2c}=_0x5db449[_0x17dc6b(0xf2)],_0x4d2622=_0x5db449[_0x17dc6b(0xf2)],_0x30a545=await profile[_0x17dc6b(0x8f)]({'email':_0x4d2622[_0x17dc6b(0xc7)]}),_0x2e3865=await master_shop['find']();console[_0x17dc6b(0x9d)](_0x17dc6b(0x10d),_0x2e3865);const _0x4aedae=_0x5db449[_0x17dc6b(0x82)]['id'];console[_0x17dc6b(0x9d)](_0x4aedae);const _0x3f8d40=await purchases_finished['findById'](_0x4aedae);console[_0x17dc6b(0x9d)](_0x17dc6b(0x13b),_0x3f8d40);const _0x58e1b1=await product[_0x17dc6b(0xb1)]({}),_0x4ea7ab=await warehouse[_0x17dc6b(0xb9)]([{'$match':{'name':_0x3f8d40[_0x17dc6b(0xb2)],'room':_0x3f8d40['room']}},{'$unwind':_0x17dc6b(0x13f)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x17dc6b(0xe7)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x17dc6b(0xf5)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x17dc6b(0x8d)},'product_code':{'$first':_0x17dc6b(0x114)},'storage':{'$first':_0x17dc6b(0xd7)},'rack':{'$first':_0x17dc6b(0x122)}}}]);console[_0x17dc6b(0x9d)](_0x17dc6b(0x100),_0x4ea7ab);let _0x40841a;if(_0x4d2622[_0x17dc6b(0x10c)]==_0x17dc6b(0x70)){const _0xa57f28=await staff[_0x17dc6b(0x8f)]({'email':_0x4d2622['email']});_0x40841a=await warehouse[_0x17dc6b(0xb1)]({'status':_0x17dc6b(0x119),'name':_0xa57f28[_0x17dc6b(0x133)],'warehouse_category':'Finished\x20Goods','name':_0x17dc6b(0x81)});}else _0x40841a=await warehouse[_0x17dc6b(0xb9)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':_0x17dc6b(0x81)}},{'$group':{'_id':_0x17dc6b(0x142),'name':{'$first':_0x17dc6b(0x142)}}}]);if(_0x2e3865[0x0][_0x17dc6b(0xce)]==_0x17dc6b(0xa2)){var _0x341918=users[_0x17dc6b(0x124)];console[_0x17dc6b(0x9d)](_0x341918);}else{if(_0x2e3865[0x0][_0x17dc6b(0xce)]=='Hindi')var _0x341918=users[_0x17dc6b(0xa1)];else{if(_0x2e3865[0x0]['language']==_0x17dc6b(0xbd))var _0x341918=users[_0x17dc6b(0xbd)];else{if(_0x2e3865[0x0][_0x17dc6b(0xce)]=='Spanish')var _0x341918=users[_0x17dc6b(0x105)];else{if(_0x2e3865[0x0][_0x17dc6b(0xce)]==_0x17dc6b(0x110))var _0x341918=users[_0x17dc6b(0x110)];else{if(_0x2e3865[0x0][_0x17dc6b(0xce)]=='Portuguese\x20(BR)')var _0x341918=users['Portuguese'];else{if(_0x2e3865[0x0]['language']==_0x17dc6b(0x74))var _0x341918=users[_0x17dc6b(0x74)];else{if(_0x2e3865[0x0]['language']=='Arabic\x20(ae)')var _0x341918=users['Arabic'];}}}}}}}_0x28c5ae[_0x17dc6b(0x71)](_0x17dc6b(0xe0),{'success':_0x5db449[_0x17dc6b(0xa0)](_0x17dc6b(0x11e)),'errors':_0x5db449[_0x17dc6b(0xa0)](_0x17dc6b(0xe4)),'role':_0x4d2622,'profile':_0x30a545,'user':_0x3f8d40,'stock':_0x4ea7ab,'master_shop':_0x2e3865,'product':_0x58e1b1,'language':_0x341918,'warehouse':_0x40841a});}catch(_0x58939a){console[_0x17dc6b(0x9d)](_0x58939a);}}),router[a0_0x4122f8(0xd3)](a0_0x4122f8(0x94),auth,async(_0x1874aa,_0xf61936)=>{var _0x5d7a25=a0_0x4122f8;try{const {invoice:_0x227a9e,date:_0x5a988e,warehouse_name:_0x534b22,Room_name:_0x450407,product_name:_0x5b51c6,purchase_quantity:_0x5eec40,stocks:_0x125d61,return_qty:_0x292466,note:_0x4308f9,level:_0x52f54f,isle:_0x4835d1,pallet:_0x3b37b3,to_warehouse_name:_0x1489d1,to_Room_name:_0x120379}=_0x1874aa[_0x5d7a25(0x112)],_0x3fb286=await purchases_finished[_0x5d7a25(0x8f)]({'_id':_0x1874aa[_0x5d7a25(0x82)]['id']}),_0x563f5f=await warehouse[_0x5d7a25(0x8f)]({'name':_0x534b22,'room':_0x450407,'warehouse_category':_0x5d7a25(0xd4)});if(typeof _0x5b51c6==_0x5d7a25(0x9a))var _0x307a9b=[_0x1874aa['body'][_0x5d7a25(0x14a)]],_0x158b1a=[_0x1874aa[_0x5d7a25(0x112)][_0x5d7a25(0xa7)]],_0x2f8f89=[_0x1874aa[_0x5d7a25(0x112)][_0x5d7a25(0x158)]],_0x1c1461=[_0x1874aa[_0x5d7a25(0x112)]['return_qty']],_0x96b7c0=[_0x1874aa['body'][_0x5d7a25(0x12c)]],_0x3994e3=[_0x1874aa['body'][_0x5d7a25(0xe9)]],_0xe1036d=[_0x1874aa[_0x5d7a25(0x112)][_0x5d7a25(0x113)]],_0x2709eb=[_0x1874aa[_0x5d7a25(0x112)][_0x5d7a25(0x93)]];else var _0x307a9b=[..._0x1874aa[_0x5d7a25(0x112)][_0x5d7a25(0x14a)]],_0x158b1a=[..._0x1874aa[_0x5d7a25(0x112)][_0x5d7a25(0xa7)]],_0x2f8f89=[..._0x1874aa['body'][_0x5d7a25(0x158)]],_0x1c1461=[..._0x1874aa[_0x5d7a25(0x112)][_0x5d7a25(0x14f)]],_0x96b7c0=[..._0x1874aa[_0x5d7a25(0x112)]['level']],_0x3994e3=[..._0x1874aa[_0x5d7a25(0x112)]['product_code_hide']],_0xe1036d=[..._0x1874aa[_0x5d7a25(0x112)][_0x5d7a25(0x113)]],_0x2709eb=[..._0x1874aa[_0x5d7a25(0x112)]['secondary_code_hide']];const _0x556672=_0x307a9b[_0x5d7a25(0xc5)](_0x335044=>{return _0x335044={'product_name':_0x335044};});_0x158b1a[_0x5d7a25(0x107)]((_0x4db4ae,_0x2c4a24)=>{var _0x45258c=_0x5d7a25;_0x556672[_0x2c4a24][_0x45258c(0xa7)]=_0x4db4ae;}),_0x2f8f89['forEach']((_0x1df032,_0x3571e2)=>{var _0x130ede=_0x5d7a25;_0x556672[_0x3571e2][_0x130ede(0xfb)]=_0x1df032;}),_0x1c1461[_0x5d7a25(0x107)]((_0xc1d8c2,_0x5bbaf2)=>{var _0x71e8ff=_0x5d7a25;_0x556672[_0x5bbaf2][_0x71e8ff(0x14f)]=_0xc1d8c2;}),_0x96b7c0[_0x5d7a25(0x107)]((_0xc36f10,_0x540310)=>{var _0x25279f=_0x5d7a25;_0x556672[_0x540310][_0x25279f(0xae)]=_0xc36f10;}),_0x3994e3[_0x5d7a25(0x107)]((_0x5e455c,_0x4cf281)=>{var _0x544eac=_0x5d7a25;_0x556672[_0x4cf281][_0x544eac(0x151)]=_0x5e455c;}),_0xe1036d[_0x5d7a25(0x107)]((_0x22f767,_0x3a97f3)=>{var _0x44ba6b=_0x5d7a25;_0x556672[_0x3a97f3][_0x44ba6b(0x8c)]=_0x22f767;}),_0x2709eb[_0x5d7a25(0x107)]((_0x37b119,_0x33dbc5)=>{_0x556672[_0x33dbc5]['secondary_code']=_0x37b119;}),_0x556672[_0x5d7a25(0x107)](_0x5e59fb=>{var _0x3aa75c=_0x5d7a25;console['log'](_0x5e59fb);const _0x5551d5=_0x563f5f[_0x3aa75c(0x75)]['map'](_0x118525=>{var _0x22eabe=_0x3aa75c;_0x118525[_0x22eabe(0x14a)]==_0x5e59fb['product_name']&&_0x118525['bay']==_0x5e59fb[_0x22eabe(0xae)]&&(console[_0x22eabe(0x9d)](parseInt(_0x118525[_0x22eabe(0x129)])+_0x22eabe(0x9c)+parseInt(_0x5e59fb[_0x22eabe(0x14f)])),_0x118525[_0x22eabe(0x129)]=parseInt(_0x118525[_0x22eabe(0x129)])-parseInt(_0x5e59fb[_0x22eabe(0x14f)]));});}),await _0x563f5f[_0x5d7a25(0x150)]();var _0x204a13=0x0;_0x556672[_0x5d7a25(0x107)](_0x4b651f=>{var _0x154f96=_0x5d7a25;(parseInt(_0x4b651f[_0x154f96(0xa7)])<parseInt(_0x4b651f['return_qty'])||parseInt(_0x4b651f['stock_quantity'])<parseInt(_0x4b651f['return_qty']))&&_0x204a13++;});if(_0x204a13!=0x0)return _0x1874aa['flash'](_0x5d7a25(0xe4),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0xf61936['redirect'](_0x5d7a25(0xa5));const _0x31dec3=new purchases_return_finished({'invoice':_0x227a9e,'suppliers':_0x1874aa[_0x5d7a25(0x112)][_0x5d7a25(0x6e)],'date':_0x5a988e,'warehouse_name':_0x534b22,'return_product':_0x556672,'note':_0x4308f9,'room':_0x450407,'to_warehouse_name':_0x1489d1,'to_room':_0x120379}),_0x397990=await _0x31dec3['save'](),_0x5a6eee=await purchases_return_finished[_0x5d7a25(0x8f)]({'invoice':_0x227a9e}),_0x4f60be=await warehouse['findOne']({'name':_0x1489d1,'room':_0x120379,'warehouse_category':_0x5d7a25(0xd4)});_0x5a6eee['return_product']['forEach'](_0x189962=>{var _0xd85e31=_0x5d7a25,_0xac5848=0x0;const _0xcfdbd1=_0x4f60be['product_details'][_0xd85e31(0xc5)](_0x1fee2f=>{var _0x37e34=_0xd85e31;console[_0x37e34(0x9d)](_0x1fee2f[_0x37e34(0x14a)]+'=='+_0x189962[_0x37e34(0x14a)]+'&&'+_0x1fee2f[_0x37e34(0xae)]+'=='+_0x189962[_0x37e34(0xae)]),_0x1fee2f[_0x37e34(0x14a)]==_0x189962['product_name']&&_0x1fee2f[_0x37e34(0xae)]==_0x189962['bay']&&(_0x1fee2f[_0x37e34(0x129)]=parseInt(_0x1fee2f[_0x37e34(0x129)])-parseInt(_0x189962[_0x37e34(0x14f)]),_0xac5848++);});_0xac5848=='0'&&(_0x4f60be['product_details']=_0x4f60be['product_details'][_0xd85e31(0x99)]({'product_name':_0x189962[_0xd85e31(0x14a)],'product_stock':_0x189962[_0xd85e31(0x14f)],'primary_code':_0x189962['primary_code'],'secondary_code':_0x189962[_0xd85e31(0xf0)],'product_code':_0x189962[_0xd85e31(0x151)],'bay':_0x189962[_0xd85e31(0xae)],'maxProducts':0xf423f}));}),await _0x4f60be[_0x5d7a25(0x150)]();const _0x1a33f0=await purchases_finished['findOne']({'invoice':_0x227a9e});_0x1a33f0['return_data']=_0x5d7a25(0x154);const _0x11c097=await _0x1a33f0[_0x5d7a25(0x150)](),_0xd47ba6=new s_payment_data({'invoice':_0x227a9e,'suppliers':_0x1874aa['body']['suppliers'],'reason':_0x5d7a25(0x11d)});await _0xd47ba6[_0x5d7a25(0x150)]();const _0x1753b8=await master_shop[_0x5d7a25(0xb1)](),_0x2df59e=await email_settings[_0x5d7a25(0x8f)](),_0x5a384f=await suppliers[_0x5d7a25(0x8f)]({'name':_0x1874aa[_0x5d7a25(0x112)][_0x5d7a25(0x6e)]});_0x1753b8[0x0][_0x5d7a25(0x84)]==0x1?(right_currency=_0x1753b8[0x0][_0x5d7a25(0x7f)],left_currency=''):(right_currency='',left_currency=_0x1753b8[0x0][_0x5d7a25(0x7f)]);var _0x5b51dc=_0x307a9b,_0x1d26fe=_0x1c1461,_0x546a74='',_0x103f1d;for(_0x103f1d in _0x5b51dc){_0x546a74+='<tr>'+_0x5d7a25(0x125)+_0x5b51dc[_0x103f1d]+_0x5d7a25(0xa3)+_0x5d7a25(0x125)+_0x1d26fe[_0x103f1d]+'</td>'+_0x5d7a25(0xcb);}let _0x3a763d=nodemailer['createTransport']({'service':_0x5d7a25(0xf4),'auth':{'user':_0x2df59e[_0x5d7a25(0xc7)],'pass':_0x2df59e['password']}}),_0x36cb21={'from':_0x2df59e[_0x5d7a25(0xc7)],'to':_0x5a384f[_0x5d7a25(0xc7)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x5d7a25(0xbc)+'/upload/'+_0x1753b8[0x0]['image'],'cid':_0x5d7a25(0x146)}],'html':_0x5d7a25(0xc1)+_0x5d7a25(0xf1)+_0x5d7a25(0x8e)+_0x5d7a25(0x167)+_0x5d7a25(0x143)+'<div>'+_0x5d7a25(0x127)+_0x5d7a25(0xba)+'<div>'+_0x5d7a25(0xee)+_0x1753b8[0x0][_0x5d7a25(0xa9)]+_0x5d7a25(0x10a)+_0x5d7a25(0xba)+_0x5d7a25(0xba)+_0x5d7a25(0x9f)+_0x5d7a25(0x167)+_0x5d7a25(0xbe)+_0x5d7a25(0x155)+_0x227a9e+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x5a988e+'\x20'+_0x5d7a25(0xdb)+_0x5d7a25(0x15d)+_0x5d7a25(0xba)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5d7a25(0x13a)+_0x5d7a25(0x121)+_0x5d7a25(0x12d)+_0x5d7a25(0x95)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x5d7a25(0x101)+_0x5d7a25(0x169)+'\x20'+_0x546a74+'\x20'+'</tbody>'+_0x5d7a25(0xc2)+_0x5d7a25(0x167)+_0x5d7a25(0x15e)+_0x5d7a25(0x135)+_0x1753b8[0x0][_0x5d7a25(0xa9)]+_0x5d7a25(0x15d)+_0x5d7a25(0xba)+'</div>'+_0x5d7a25(0xac)};_0x3a763d['sendMail'](_0x36cb21,function(_0x52cdfb,_0x58bce3){var _0xf714d6=_0x5d7a25;_0x52cdfb?console[_0xf714d6(0x9d)]('Error\x20Occurs'):console[_0xf714d6(0x9d)](_0xf714d6(0x157));}),_0x1874aa[_0x5d7a25(0xa0)](_0x5d7a25(0x11e),_0x5d7a25(0x72)),_0xf61936[_0x5d7a25(0xe3)](_0x5d7a25(0x128));}catch(_0xaf344e){_0xf61936[_0x5d7a25(0x89)](0xc8)[_0x5d7a25(0x85)]({'message':_0xaf344e['message']});}}),router['get'](a0_0x4122f8(0xfd),auth,async(_0x552f54,_0xbeca2)=>{var _0x4d1e7e=a0_0x4122f8;try{const {username:_0x2f8bf9,email:_0x44ca93,role:_0x30d1cf}=_0x552f54[_0x4d1e7e(0xf2)],_0x139de6=_0x552f54[_0x4d1e7e(0xf2)],_0x3c99f9=await profile['findOne']({'email':_0x139de6['email']}),_0x2e056f=await master_shop[_0x4d1e7e(0xb1)](),_0x331c18=_0x552f54[_0x4d1e7e(0x82)]['id'],_0x451852=await purchases_finished['findById'](_0x331c18);if(_0x2e056f[0x0]['language']==_0x4d1e7e(0xa2))var _0x4a3595=users[_0x4d1e7e(0x124)];else{if(_0x2e056f[0x0][_0x4d1e7e(0xce)]==_0x4d1e7e(0xa1))var _0x4a3595=users[_0x4d1e7e(0xa1)];else{if(_0x2e056f[0x0][_0x4d1e7e(0xce)]==_0x4d1e7e(0xbd))var _0x4a3595=users[_0x4d1e7e(0xbd)];else{if(_0x2e056f[0x0][_0x4d1e7e(0xce)]==_0x4d1e7e(0x105))var _0x4a3595=users[_0x4d1e7e(0x105)];else{if(_0x2e056f[0x0][_0x4d1e7e(0xce)]==_0x4d1e7e(0x110))var _0x4a3595=users['French'];else{if(_0x2e056f[0x0][_0x4d1e7e(0xce)]==_0x4d1e7e(0x11f))var _0x4a3595=users[_0x4d1e7e(0x7d)];else{if(_0x2e056f[0x0][_0x4d1e7e(0xce)]==_0x4d1e7e(0x74))var _0x4a3595=users['Chinese'];else{if(_0x2e056f[0x0]['language']==_0x4d1e7e(0x102))var _0x4a3595=users['Arabic'];}}}}}}}_0xbeca2[_0x4d1e7e(0x71)](_0x4d1e7e(0xf9),{'success':_0x552f54[_0x4d1e7e(0xa0)](_0x4d1e7e(0x11e)),'errors':_0x552f54[_0x4d1e7e(0xa0)](_0x4d1e7e(0xe4)),'role':_0x139de6,'profile':_0x3c99f9,'alldata':_0x451852,'master_shop':_0x2e056f,'language':_0x4a3595}),console[_0x4d1e7e(0x9d)](alldata);}catch(_0x239391){console[_0x4d1e7e(0x9d)](_0x239391);}}),router['post'](a0_0x4122f8(0xdf),async(_0x15c08c,_0x5cd048)=>{var _0x3fae4d=a0_0x4122f8;const {product_code:_0x205bf4}=_0x15c08c['body'];var _0x16182d;const _0x43c70b=await product[_0x3fae4d(0xb9)]([{'$match':{'primary_code':_0x205bf4,'product_category':_0x3fae4d(0xd4)}},{'$group':{'_id':_0x3fae4d(0x11b),'name':{'$first':'$name'},'category':{'$first':_0x3fae4d(0xb8)},'brand':{'$first':_0x3fae4d(0x138)},'unit':{'$first':_0x3fae4d(0x13c)},'alertquantity':{'$first':_0x3fae4d(0x116)},'product_code':{'$first':_0x3fae4d(0x11a)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x3fae4d(0x115)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x3fae4d(0xab)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3fae4d(0x14d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5245fa=await product['aggregate']([{'$match':{'secondary_code':_0x205bf4}},{'$group':{'_id':_0x3fae4d(0x11b),'name':{'$first':_0x3fae4d(0x142)},'category':{'$first':_0x3fae4d(0xb8)},'brand':{'$first':'$brand'},'unit':{'$first':_0x3fae4d(0x13c)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3fae4d(0x11a)},'primary_code':{'$first':_0x3fae4d(0x145)},'secondary_code':{'$first':_0x3fae4d(0x115)},'maxStocks':{'$first':_0x3fae4d(0xc4)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3fae4d(0x14d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x43c70b[_0x3fae4d(0x91)]>0x0)_0x16182d=_0x43c70b;else _0x5245fa[_0x3fae4d(0x91)]>0x0&&(_0x16182d=_0x5245fa);_0x5cd048[_0x3fae4d(0x85)](_0x16182d);}),router[a0_0x4122f8(0xd3)](a0_0x4122f8(0x9e),async(_0x51b7f2,_0x53cb93)=>{var _0x4c43a5=a0_0x4122f8;const {productCode:_0x3fe431,bay:_0x48cf3d,warehouses:_0x5317e1,room:_0x5725f7}=_0x51b7f2[_0x4c43a5(0x112)];console[_0x4c43a5(0x9d)](_0x51b7f2[_0x4c43a5(0x112)]);try{const _0x1c21e2=await warehouse[_0x4c43a5(0xb9)]([{'$match':{'name':_0x5317e1,'room':_0x5725f7}},{'$unwind':_0x4c43a5(0x13f)},{'$match':{'product_details.bay':parseInt(_0x48cf3d)}},{'$group':{'_id':_0x4c43a5(0x126),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4c43a5(0xe7)},'bay':{'$first':_0x4c43a5(0x12b)},'maxProducts':{'$first':_0x4c43a5(0x130)}}}]);_0x53cb93[_0x4c43a5(0x89)](0xc8)['json'](_0x1c21e2);}catch(_0x31b954){_0x53cb93[_0x4c43a5(0x89)](0x194)[_0x4c43a5(0x85)]({'message':_0x31b954['message']});}}),module['exports']=router;