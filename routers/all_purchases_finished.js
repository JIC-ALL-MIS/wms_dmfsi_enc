var a0_0x33a57f=a0_0x37cb;(function(_0x1bdc7f,_0x367a68){var _0x3cdf8a=a0_0x37cb,_0x108b4a=_0x1bdc7f();while(!![]){try{var _0x125e4a=parseInt(_0x3cdf8a(0x132))/0x1+parseInt(_0x3cdf8a(0x183))/0x2*(parseInt(_0x3cdf8a(0xbc))/0x3)+-parseInt(_0x3cdf8a(0x118))/0x4*(-parseInt(_0x3cdf8a(0x11e))/0x5)+parseInt(_0x3cdf8a(0x99))/0x6*(parseInt(_0x3cdf8a(0xde))/0x7)+parseInt(_0x3cdf8a(0xd3))/0x8*(parseInt(_0x3cdf8a(0x17c))/0x9)+parseInt(_0x3cdf8a(0x138))/0xa+-parseInt(_0x3cdf8a(0x154))/0xb*(parseInt(_0x3cdf8a(0xe0))/0xc);if(_0x125e4a===_0x367a68)break;else _0x108b4a['push'](_0x108b4a['shift']());}catch(_0x1e21e0){_0x108b4a['push'](_0x108b4a['shift']());}}}(a0_0x2c89,0x86053));const express=require(a0_0x33a57f(0x12f)),app=express(),router=express[a0_0x33a57f(0x14d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x33a57f(0x17a)),auth=require('../middleware/auth'),nodemailer=require(a0_0x33a57f(0xb4));var ejs=require(a0_0x33a57f(0xa1));const path=require(a0_0x33a57f(0x137)),users=require(a0_0x33a57f(0x184));router[a0_0x33a57f(0x175)]('/view',auth,async(_0x290da3,_0x82cb30)=>{var _0x437e73=a0_0x33a57f;try{const {username:_0x4fd96f,email:_0x42bab4,role:_0x26877e}=_0x290da3[_0x437e73(0xe6)],_0x2aff87=_0x290da3[_0x437e73(0xe6)],_0x3b60f2=await profile['findOne']({'email':_0x2aff87[_0x437e73(0x12e)]}),_0x5daa9b=await staff[_0x437e73(0xcb)]({'email':_0x2aff87[_0x437e73(0x12e)]});if(_0x2aff87[_0x437e73(0x104)]=='staff'){const _0x279115=await staff[_0x437e73(0xcb)]({'email':_0x2aff87[_0x437e73(0x12e)]});}const _0x25e21d=await master_shop[_0x437e73(0xa8)]();let _0x4f6328;if(_0x2aff87[_0x437e73(0x104)]==_0x437e73(0x9a)){const _0x5d58a4=await staff[_0x437e73(0xcb)]({'email':_0x2aff87[_0x437e73(0x12e)]});_0x4f6328=await purchases_finished[_0x437e73(0x134)]([{'$match':{'warehouse_name':_0x5d58a4[_0x437e73(0xbf)]}},{'$lookup':{'from':_0x437e73(0xf6),'localField':_0x437e73(0xf6),'foreignField':_0x437e73(0x13b),'as':_0x437e73(0x122)}},{'$unwind':_0x437e73(0xc7)},{'$unwind':'$product'},{'$group':{'_id':_0x437e73(0xe5),'invoice':{'$first':_0x437e73(0xf7)},'suppliers':{'$first':_0x437e73(0x160)},'date':{'$first':_0x437e73(0xe4)},'warehouse_name':{'$first':_0x437e73(0x10f)},'room':{'$first':'$room'},'product':{'$push':_0x437e73(0xe9)},'note':{'$first':_0x437e73(0x120)},'paid_amount':{'$first':_0x437e73(0x111)},'due_amount':{'$first':_0x437e73(0x174)},'return_data':{'$first':_0x437e73(0x108)},'batch_code':{'$first':_0x437e73(0x185)},'expiry_date':{'$first':_0x437e73(0xc3)},'suppliers_docs':{'$first':_0x437e73(0xc7)},'total_product_quantity':{'$sum':_0x437e73(0xb2)},'level':{'$addToSet':_0x437e73(0xd6)},'isle':{'$addToSet':_0x437e73(0x12a)},'type':{'$addToSet':_0x437e73(0xf4)},'floorlevel':{'$addToSet':_0x437e73(0x189)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4f6328=await purchases_finished[_0x437e73(0x134)]([{'$unwind':_0x437e73(0xe9)},{'$group':{'_id':_0x437e73(0xe5),'invoice':{'$first':_0x437e73(0xf7)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x437e73(0x173)},'product':{'$push':_0x437e73(0xe9)},'note':{'$first':_0x437e73(0x120)},'paid_amount':{'$first':_0x437e73(0x111)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x437e73(0x108)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x437e73(0xc3)},'suppliers_docs':{'$first':_0x437e73(0xc7)},'total_product_quantity':{'$sum':_0x437e73(0xb2)},'level':{'$addToSet':_0x437e73(0xd6)},'isle':{'$addToSet':_0x437e73(0x12a)},'type':{'$addToSet':_0x437e73(0xf4)},'floorlevel':{'$addToSet':_0x437e73(0x189)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x25e21d[0x0][_0x437e73(0xb3)]==_0x437e73(0x11f))var _0x4ba889=users[_0x437e73(0x155)];else{if(_0x25e21d[0x0]['language']=='Hindi')var _0x4ba889=users[_0x437e73(0xad)];else{if(_0x25e21d[0x0]['language']==_0x437e73(0x195))var _0x4ba889=users[_0x437e73(0x195)];else{if(_0x25e21d[0x0][_0x437e73(0xb3)]==_0x437e73(0x9b))var _0x4ba889=users[_0x437e73(0x9b)];else{if(_0x25e21d[0x0][_0x437e73(0xb3)]==_0x437e73(0xe1))var _0x4ba889=users['French'];else{if(_0x25e21d[0x0][_0x437e73(0xb3)]==_0x437e73(0x188))var _0x4ba889=users[_0x437e73(0x16e)];else{if(_0x25e21d[0x0][_0x437e73(0xb3)]=='Chinese')var _0x4ba889=users[_0x437e73(0xc1)];else{if(_0x25e21d[0x0][_0x437e73(0xb3)]=='Arabic\x20(ae)')var _0x4ba889=users['Arabic'];}}}}}}}_0x82cb30['render']('all_purchases_finished',{'success':_0x290da3['flash']('success'),'errors':_0x290da3[_0x437e73(0x128)]('errors'),'purchases':_0x4f6328,'role':_0x2aff87,'profile':_0x3b60f2,'master_shop':_0x25e21d,'language':_0x4ba889});}catch(_0xb08e0b){console['log'](_0x437e73(0x11a),_0xb08e0b),_0x82cb30[_0x437e73(0x166)](0xc8)['json']({'message':_0xb08e0b[_0x437e73(0x105)]});}});function BayBinSelected(_0x30d124,_0xfbb67a){var _0x383a5c=a0_0x33a57f,_0x357186=[],_0x587cff=[];if(_0x30d124==_0x383a5c(0x139)){switch(_0xfbb67a){case _0x383a5c(0x171):_0x357186=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x357186=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x587cff=['DG'];}else{if(_0x30d124==_0x383a5c(0xd0)){switch(_0xfbb67a){case _0x383a5c(0x171):_0x357186=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x357186=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x587cff=['FG'];}}return{'levels':_0x357186,'identify':_0x587cff};}function a0_0x2c89(){var _0x93c5fe=['path','5063320UPPgKv','DRY\x20GOODS','QA\x20Warehouse','name','INCF-','\x20Order\x20Number\x20:\x20','</head><body>','prod_name','$product_details.storage','primary_code_hide','</tr>','maxStocks','return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','body','</h5>','product','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','currency_placement','MaxStocks_data','An\x20error\x20occurred\x20while\x20saving\x20data.','Router','Arabic\x20(ae)','room','/view/return_purchase/:id','/barcode/:id','return_qty','</span>','11IZQQUc','English','<table\x20style=\x22width:\x20100%\x20!important;\x22>','slice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','prod_invoice','/invoice/:id','$secondary_code','$product_details.bin','secondary_code','prod_unit','$product_details.primary_code','$suppliers','Purchase\x20Return\x20Mail','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Ambient','batch_code','status','stock_quantity','</tbody>','<!DOCTYPE\x20html>','$product_details.bay','purchase\x20data\x20add\x20successfully','\x20<>\x20','prod_code','Portuguese','</div>','$product_details.product_code','Rack\x201','/all_purchases_finished/view','$product.room_name','$due_amount','get','site_title','Finished\x20Goods','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/give_payment/:id','../models/all_models','$alertquantity','196686JPBVwZ','\x20Order\x20Date\x20:\x20','</body></html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','createTransport','gmail','POnumber','147326HIraLE','../public/language/languages.json','$batch_code','Room_name','redirect','Portuguese\x20(BR)','$product.floorlevel','prod_cat','Return\x20Goods','/preview/:id','abs','sendMail','product_stock','stocks','<html><head><title></title>','$primary_code','Purchase\x20Mail','$maxProdPerUnit','German','toString','$product_details.rack','catch','25554MpfZjN','staff','Spanish','primary_code','prod_primunit','image','$name','product_cat','ejs','<h5>','errors','secondary_unit','forEach','port','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','find','</thead>','purchase_quantity','room_name','amount','Hindi','Logo.png','<hr\x20class=\x22my-3\x22>','date','password','$product.quantity','language','nodemailer','Arabic','purchase_invoice','/barcode_scanner','Error\x20Occurs','max_product_unit','back','invoice','33qIpzJX','getDate','Email\x20sent\x20successfully','warehouse','host','Chinese','prod_secondunit','$expiry_date','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','bay','$suppliers_docs','production_date','map','Enclosed','findOne','error','$product_details._id','Error\x20occurred\x20while\x20processing\x20product:','due_amount','FROZEN\x20GOODS','purchase\x20data\x20update\x20successfully','$maxStocks','40DrAhpB','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','$product.bay','product_date','product_name','stock_data','all','</td>','success','<div>','1561QbVWOI','<span\x20style=\x22float:\x20right;\x22>','40297308zdVKuo','French','edit_purchases_finished','string','$date','$_id','user','secondary_code_hide','user_id','$product','quantity','RoomAssign','paid_amount','return_purchase_finished','\x20</h2>','getFullYear','maxperunit','master','/../public','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product.type','currency','suppliers','$invoice','getMonth','product_code_hide','/upload/','findById','<h2>\x20','purchases\x20item\x20return\x20successfull','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','floor','Enabled','logo','role','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','True','$return_data','/view/add_purchases/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','exports','prod_Qty','json','standard_unit','$warehouse_name','$unit','$paid_amount','$category','length','product_code','log','concat','/all_purchases/view','204kgcyhx','$product_details','table\x20page','params','product_details','Purchase\x20Return','63815SkpHeV','English\x20(US)','$note','$secondary_unit','suppliers_docs','Paid\x20For\x20Purchase','$product_details.secondary_code','render','post','save','flash','$product_details.floorlevel','$product.bin','$brand','prod_qty','<tr>','email','express','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','prod_level','880491fHdjrg','expiry_date','aggregate','JO_number','warehouse_name'];a0_0x2c89=function(){return _0x93c5fe;};return a0_0x2c89();}function a0_0x37cb(_0x342b2f,_0xc34cd2){var _0x2c892c=a0_0x2c89();return a0_0x37cb=function(_0x37cb37,_0x332c34){_0x37cb37=_0x37cb37-0x96;var _0x20a08f=_0x2c892c[_0x37cb37];return _0x20a08f;},a0_0x37cb(_0x342b2f,_0xc34cd2);}async function getRandom8DigitNumber(){var _0x59f939=a0_0x33a57f;const _0x1fc325=0x989680,_0x329935=0x5f5e0ff,_0x1cc4a6=Math[_0x59f939(0x101)](Math['random']()*(_0x329935-_0x1fc325+0x1))+_0x1fc325;var _0x390b6c;const _0x2f29ae=await purchases_finished[_0x59f939(0xcb)]({'invoice':'INCF-'+_0x1cc4a6});return _0x2f29ae&&_0x2f29ae[_0x59f939(0x113)]>0x0?_0x390b6c=_0x59f939(0x13c)+_0x1cc4a6:_0x390b6c=_0x59f939(0x13c)+_0x1cc4a6,_0x390b6c;}router[a0_0x33a57f(0x175)]('/view/add_purchases',auth,async(_0x139b6a,_0x1726c6)=>{var _0x1ce74c=a0_0x33a57f;try{const {username:_0x2b692c,email:_0xa546ae,role:_0x548718}=_0x139b6a[_0x1ce74c(0xe6)],_0x4043d1=_0x139b6a[_0x1ce74c(0xe6)],_0x1a22f8=await profile[_0x1ce74c(0xcb)]({'email':_0x4043d1['email']}),_0x1dbd0a=await master_shop[_0x1ce74c(0xa8)](),_0x4dba98=await staff['findOne']({'email':_0x4043d1['email']}),_0x3ee3f1=await suppliers['find']({});let _0x153121;if(_0x4043d1[_0x1ce74c(0x104)]=='staff'){const _0x15621b=await staff['findOne']({'email':_0x4043d1['email']});_0x153121=await warehouse[_0x1ce74c(0x134)]([{'$match':{'status':_0x1ce74c(0x102),'name':_0x15621b['warehouse'],'warehouse_category':_0x1ce74c(0x177)}},{'$group':{'_id':_0x1ce74c(0x9f),'name':{'$first':_0x1ce74c(0x9f)}}}]);}else _0x153121=await warehouse[_0x1ce74c(0x134)]([{'$match':{'status':_0x1ce74c(0x102),'warehouse_category':_0x1ce74c(0x177),'name':{'$ne':_0x1ce74c(0x13a)}}},{'$group':{'_id':_0x1ce74c(0x9f),'name':{'$first':_0x1ce74c(0x9f)}}}]);const _0x414acf=await product[_0x1ce74c(0xa8)]({}),_0x138a87=await warehouse[_0x1ce74c(0xa8)]({'status':_0x1ce74c(0x102)}),_0x52c56b=await purchases_finished[_0x1ce74c(0xa8)]({}),_0x4eea8b=_0x52c56b['length']+0x1,_0x480b43='INCF-'+_0x4eea8b[_0x1ce74c(0x96)]()['padStart'](0x5,'0');var _0x2f0b77=[_0x1ce74c(0x164),_0x1ce74c(0xca)];if(_0x1dbd0a[0x0][_0x1ce74c(0xb3)]=='English\x20(US)')var _0x5e097b=users['English'];else{if(_0x1dbd0a[0x0][_0x1ce74c(0xb3)]=='Hindi')var _0x5e097b=users[_0x1ce74c(0xad)];else{if(_0x1dbd0a[0x0][_0x1ce74c(0xb3)]==_0x1ce74c(0x195))var _0x5e097b=users[_0x1ce74c(0x195)];else{if(_0x1dbd0a[0x0][_0x1ce74c(0xb3)]=='Spanish')var _0x5e097b=users[_0x1ce74c(0x9b)];else{if(_0x1dbd0a[0x0][_0x1ce74c(0xb3)]==_0x1ce74c(0xe1))var _0x5e097b=users[_0x1ce74c(0xe1)];else{if(_0x1dbd0a[0x0][_0x1ce74c(0xb3)]==_0x1ce74c(0x188))var _0x5e097b=users['Portuguese'];else{if(_0x1dbd0a[0x0][_0x1ce74c(0xb3)]==_0x1ce74c(0xc1))var _0x5e097b=users[_0x1ce74c(0xc1)];else{if(_0x1dbd0a[0x0][_0x1ce74c(0xb3)]=='Arabic\x20(ae)')var _0x5e097b=users[_0x1ce74c(0xb5)];}}}}}}}const _0x1dd4f0=getRandom8DigitNumber();_0x1dd4f0['then'](_0x4d7507=>{var _0x2180be=_0x1ce74c;_0x1726c6[_0x2180be(0x125)]('add_purchases_finished',{'success':_0x139b6a[_0x2180be(0x128)]('success'),'errors':_0x139b6a[_0x2180be(0x128)](_0x2180be(0xa3)),'role':_0x4043d1,'profile':_0x1a22f8,'suppliers':_0x3ee3f1,'warehouse':_0x153121,'product':_0x414acf,'invoice':_0x4d7507,'master_shop':_0x1dbd0a,'language':_0x5e097b,'find_data':_0x138a87,'rooms_data':_0x2f0b77});})[_0x1ce74c(0x98)](_0x390d9d=>{var _0x5a7f58=_0x1ce74c;_0x139b6a[_0x5a7f58(0x128)]('errors',_0x5a7f58(0x158)),_0x1726c6['redirect'](_0x5a7f58(0x172));});}catch(_0x22b264){console[_0x1ce74c(0x115)](_0x22b264);}}),router[a0_0x33a57f(0x175)](a0_0x33a57f(0x109),auth,async(_0x364812,_0x523953)=>{var _0x5aa134=a0_0x33a57f;try{const _0x35e869=_0x364812[_0x5aa134(0x11b)]['id'];console[_0x5aa134(0x115)](_0x35e869);const _0x28709a=await master_shop['find']();console[_0x5aa134(0x115)](_0x5aa134(0xf1),_0x28709a);const _0x5016d7=await product[_0x5aa134(0xcb)]({'name':_0x35e869});console[_0x5aa134(0x115)]('product',_0x5016d7),_0x523953[_0x5aa134(0x166)](0xc8)[_0x5aa134(0x10d)]({'product_data':_0x5016d7,'master':_0x28709a});}catch(_0x5dc364){console[_0x5aa134(0x115)]('add_purchases\x20error',_0x5dc364);}}),router[a0_0x33a57f(0x126)]('/view/add_purchases',auth,async(_0x3b9b20,_0x1c4340)=>{var _0x15fa3d=a0_0x33a57f;try{const {invoice:_0x5339b4,date:_0x2fa52b,warehouse_name:_0x1f4f2e,prod_name:_0x3b3cfe,prod_code:_0x356e5d,prod_qty:_0xf1a959,prod_unit:_0x480584,prod_secondunit:_0x3d7029,prod_level:_0x3c1a05,prod_isle:_0x106fc0,prod_pallet:_0xcb8412,note:_0x503275,expiry_date:_0x422119,batch_code:_0x2e7f85,payable:_0x57d0b7,due_amount:_0x2aae4e,Room_name:_0x2efbda,primary_code:_0x470fb5,secondary_code:_0x1211c1,MaxStocks_data:_0x9cc0ef,PO_number:_0x232539,SCRN:_0x559076,JO_number:_0x4d14ba}=_0x3b9b20[_0x15fa3d(0x146)];if(typeof _0x3b3cfe==_0x15fa3d(0xe3))var _0x4ed816=[_0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x13f)]],_0x216ff6=[_0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x16d)]],_0x5bc23a=[_0x3b9b20['body']['prod_Qty']],_0x3e45f3=[_0x3b9b20['body']['prod_primunit']],_0x104d46=[_0x3b9b20['body'][_0x15fa3d(0xc2)]],_0x1b161d=[_0x3b9b20[_0x15fa3d(0x146)]['prod_level']],_0x2cf8bd=[_0x3b9b20['body'][_0x15fa3d(0x9c)]],_0x1f4ec2=[_0x3b9b20[_0x15fa3d(0x146)]['secondary_code']],_0x4dd552=[_0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x14b)]],_0xa05bd9=[_0x3b9b20[_0x15fa3d(0x146)]['batch_code']],_0x5d58d4=[_0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x133)]],_0x113bfe=[_0x3b9b20['body']['product_date']],_0x45537a=[_0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0xb9)]],_0x14e18a=[_0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x18a)]],_0x3bd162=[_0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0xeb)]],_0x3f4d50=[_0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x159)]];else var _0x4ed816=[..._0x3b9b20['body']['prod_name']],_0x216ff6=[..._0x3b9b20[_0x15fa3d(0x146)]['prod_code']],_0x5bc23a=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x10c)]],_0x3e45f3=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x9d)]],_0x104d46=[..._0x3b9b20['body'][_0x15fa3d(0xc2)]],_0x1b161d=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x131)]],_0x2cf8bd=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x9c)]],_0x1f4ec2=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x15d)]],_0x4dd552=[..._0x3b9b20['body'][_0x15fa3d(0x14b)]],_0xa05bd9=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x165)]],_0x5d58d4=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x133)]],_0x113bfe=[..._0x3b9b20['body'][_0x15fa3d(0xd7)]],_0x45537a=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0xb9)]],_0x14e18a=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x18a)]],_0x3bd162=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0xeb)]],_0x3f4d50=[..._0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0x159)]];const _0x49e96f=_0x4ed816['map'](_0x3474f1=>{return _0x3474f1={'product_name':_0x3474f1};});_0x216ff6[_0x15fa3d(0xa5)]((_0x452934,_0x3f632f)=>{var _0x2bfaac=_0x15fa3d;_0x49e96f[_0x3f632f][_0x2bfaac(0x114)]=_0x452934;}),_0x5bc23a['forEach']((_0x42f85b,_0x13319f)=>{var _0x58af62=_0x15fa3d;_0x49e96f[_0x13319f]['quantity']=Math[_0x58af62(0x18d)](_0x42f85b);}),_0x3e45f3['forEach']((_0x344ff9,_0x1490af)=>{var _0x5575c4=_0x15fa3d;_0x49e96f[_0x1490af][_0x5575c4(0x10e)]=_0x344ff9;}),_0x104d46[_0x15fa3d(0xa5)]((_0x5726d2,_0x5887e3)=>{var _0x123ccd=_0x15fa3d;_0x49e96f[_0x5887e3][_0x123ccd(0xa4)]=_0x5726d2;}),_0x1b161d['forEach']((_0x490a2b,_0x4860bf)=>{var _0x6fdddd=_0x15fa3d;_0x49e96f[_0x4860bf][_0x6fdddd(0xc6)]=_0x490a2b;}),_0x2cf8bd[_0x15fa3d(0xa5)]((_0x467faf,_0x498ba3)=>{var _0x41cb3f=_0x15fa3d;_0x49e96f[_0x498ba3][_0x41cb3f(0x9c)]=_0x467faf;}),_0x1f4ec2[_0x15fa3d(0xa5)]((_0x4e8826,_0x3dda97)=>{_0x49e96f[_0x3dda97]['secondary_code']=_0x4e8826;}),_0x4dd552[_0x15fa3d(0xa5)]((_0x34c463,_0x3ff0d0)=>{var _0x303951=_0x15fa3d;_0x49e96f[_0x3ff0d0][_0x303951(0x143)]=_0x34c463;}),_0xa05bd9[_0x15fa3d(0xa5)]((_0x438708,_0x1dc3cc)=>{var _0x2bdafd=_0x15fa3d;_0x49e96f[_0x1dc3cc][_0x2bdafd(0x165)]=_0x438708;}),_0x5d58d4['forEach']((_0x213a7e,_0x175836)=>{var _0x1df37d=_0x15fa3d;_0x49e96f[_0x175836][_0x1df37d(0x133)]=_0x213a7e;}),_0x113bfe['forEach']((_0x4f668f,_0x2b3451)=>{var _0x2c222f=_0x15fa3d;_0x49e96f[_0x2b3451][_0x2c222f(0xc8)]=_0x4f668f;}),_0x45537a[_0x15fa3d(0xa5)]((_0x1b886a,_0x4cf4dc)=>{var _0x5e11a4=_0x15fa3d;_0x49e96f[_0x4cf4dc][_0x5e11a4(0xf0)]=_0x1b886a;}),_0x14e18a[_0x15fa3d(0xa5)]((_0x39d5cb,_0x4fee0b)=>{var _0x50e53b=_0x15fa3d;_0x49e96f[_0x4fee0b][_0x50e53b(0xa0)]=_0x39d5cb;}),_0x3bd162[_0x15fa3d(0xa5)]((_0x2626d3,_0x242900)=>{var _0x18691a=_0x15fa3d;_0x49e96f[_0x242900][_0x18691a(0xab)]=_0x2626d3;}),_0x3f4d50[_0x15fa3d(0xa5)]((_0x49ae5f,_0x2d5ccd)=>{var _0x5b687c=_0x15fa3d;_0x49e96f[_0x2d5ccd][_0x5b687c(0xbb)]=_0x49ae5f;});const _0x1e851b=_0x49e96f['filter'](_0x2cb734=>_0x2cb734[_0x15fa3d(0xea)]!=='0'&&_0x2cb734['quantity']!==''),_0x337163=new purchases_finished({'invoice':_0x5339b4,'suppliers':_0x3b9b20[_0x15fa3d(0x146)][_0x15fa3d(0xf6)],'date':_0x2fa52b,'warehouse_name':_0x1f4f2e,'product':_0x1e851b,'note':_0x503275,'due_amount':_0x2aae4e,'room':_0x2efbda,'POnumber':_0x232539,'SCRN':_0x559076,'JO_number':_0x4d14ba}),_0x58f0f1=await _0x337163['save'](),_0x442043=await purchases_finished[_0x15fa3d(0xcb)]({'invoice':_0x5339b4}),_0x1309be=_0x442043[_0x15fa3d(0x148)][_0x15fa3d(0xc9)](async _0x4c8345=>{var _0x3db92d=_0x15fa3d;try{var _0x2ead0c=await warehouse[_0x3db92d(0xcb)]({'name':_0x1f4f2e,'room':_0x4c8345['room_name']}),_0x1e2006=0x0;const _0x25b2a0=_0x2ead0c['product_details'][_0x3db92d(0xc9)](_0x1acb74=>{var _0x2cf333=_0x3db92d;console['log'](_0x1acb74[_0x2cf333(0xd8)]+'=='+_0x4c8345[_0x2cf333(0xd8)]+'&&'+_0x1acb74[_0x2cf333(0xc6)]+'=='+_0x4c8345[_0x2cf333(0xc6)]+'&&'+_0x1acb74['expiry_date']+'=='+_0x4c8345[_0x2cf333(0x133)]+'&&'+_0x1acb74[_0x2cf333(0xc8)]+'=='+_0x4c8345[_0x2cf333(0xc8)]+'&&'+_0x1acb74[_0x2cf333(0x165)]+'=='+_0x4c8345[_0x2cf333(0x165)]+'&&'+_0x1acb74['invoice']+'=='+_0x442043[_0x2cf333(0xbb)]),_0x1acb74[_0x2cf333(0xd8)]==_0x4c8345[_0x2cf333(0xd8)]&&_0x1acb74[_0x2cf333(0xc6)]==_0x4c8345[_0x2cf333(0xc6)]&&_0x1acb74['expiry_date']==_0x4c8345[_0x2cf333(0x133)]&&_0x1acb74[_0x2cf333(0xc8)]==_0x4c8345['production_date']&&_0x1acb74[_0x2cf333(0x165)]==_0x4c8345['batch_code']&&_0x1acb74[_0x2cf333(0xbb)]==_0x442043['invoice']&&(_0x1acb74[_0x2cf333(0x18f)]=Math[_0x2cf333(0x18d)](_0x1acb74[_0x2cf333(0x18f)])+Math[_0x2cf333(0x18d)](_0x4c8345[_0x2cf333(0xea)]),_0x1e2006++);});return _0x1e2006==0x0&&(_0x2ead0c['product_details']=_0x2ead0c['product_details'][_0x3db92d(0x116)]({'product_name':_0x4c8345[_0x3db92d(0xd8)],'product_stock':Math[_0x3db92d(0x18d)](_0x4c8345['quantity']),'primary_code':_0x4c8345[_0x3db92d(0x9c)],'secondary_code':_0x4c8345[_0x3db92d(0x15d)],'product_code':_0x4c8345[_0x3db92d(0x114)],'bay':_0x4c8345['bay'],'maxProducts':_0x4c8345[_0x3db92d(0x143)],'unit':_0x4c8345['standard_unit'],'secondary_unit':_0x4c8345['secondary_unit'],'expiry_date':_0x4c8345[_0x3db92d(0x133)],'production_date':_0x4c8345[_0x3db92d(0xc8)],'maxProducts':_0x4c8345['maxStocks'],'maxPerUnit':_0x4c8345[_0x3db92d(0xf0)],'batch_code':_0x4c8345[_0x3db92d(0x165)],'product_cat':_0x4c8345['product_cat'],'invoice':_0x4c8345[_0x3db92d(0xbb)],'id_incoming':_0x4c8345[_0x3db92d(0xc4)]})),_0x2ead0c;}catch(_0x26c4d8){return console[_0x3db92d(0xcc)](_0x3db92d(0xce),_0x26c4d8),null;}});Promise[_0x15fa3d(0xda)](_0x1309be)['then'](async _0x5036ef=>{var _0x18435a=_0x15fa3d;try{for(const _0x4c11c5 of _0x5036ef){await warehouse['updateOne']({'_id':_0x4c11c5[_0x18435a(0xc4)]},{'$addToSet':{'product_details':{'$each':_0x4c11c5[_0x18435a(0x11c)]}}});}const _0x2edc31=await master_shop[_0x18435a(0xa8)](),_0xe648e3=await email_settings[_0x18435a(0xcb)](),_0x108b92=await supervisor_settings[_0x18435a(0xa8)]();var _0x1d7110=_0x442043[_0x18435a(0x148)],_0xf98563='',_0x2246b6;for(_0x2246b6 in _0x1d7110){var _0x731c0f='FG';_0x442043['warehouse_name']==_0x18435a(0x139)&&(_0x731c0f='DG'),_0xf98563+=_0x18435a(0x12d)+_0x18435a(0xd4)+_0x1d7110[_0x2246b6]['product_name']+_0x18435a(0xdb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1d7110[_0x2246b6][_0x18435a(0x114)]+_0x18435a(0xdb)+_0x18435a(0xd4)+_0x1d7110[_0x2246b6]['quantity']+'</td>'+_0x18435a(0xd4)+_0x1d7110[_0x2246b6]['standard_unit']+_0x18435a(0xdb)+_0x18435a(0xd4)+_0x1d7110[_0x2246b6][_0x18435a(0xa4)]+_0x18435a(0xdb)+_0x18435a(0xd4)+_0x442043['warehouse_name']+_0x18435a(0xdb)+_0x18435a(0xd4)+_0x1d7110[_0x2246b6]['room_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x731c0f+_0x1d7110[_0x2246b6][_0x18435a(0xc6)]+_0x18435a(0xdb),_0x18435a(0x142);}let _0x2fb063=nodemailer[_0x18435a(0x180)]({'host':_0xe648e3[_0x18435a(0xc0)],'port':Number(_0xe648e3[_0x18435a(0xa6)]),'secure':![],'auth':{'user':_0xe648e3[_0x18435a(0x12e)],'pass':_0xe648e3[_0x18435a(0xb1)]}}),_0x477d1c={'from':_0xe648e3[_0x18435a(0x12e)],'to':_0x108b92[0x0]['FGSEmail'],'subject':_0x18435a(0x193),'attachments':[{'filename':_0x18435a(0xae),'path':__dirname+_0x18435a(0xf2)+_0x18435a(0xfa)+_0x2edc31[0x0][_0x18435a(0x9e)],'cid':'logo'}],'html':_0x18435a(0x169)+_0x18435a(0x191)+_0x18435a(0x13e)+_0x18435a(0xdd)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x18435a(0x16f)+'<div>'+'<h2>\x20'+_0x2edc31[0x0][_0x18435a(0x176)]+_0x18435a(0xee)+_0x18435a(0x16f)+'</div>'+_0x18435a(0xaf)+_0x18435a(0xdd)+_0x18435a(0xd5)+_0x18435a(0x13d)+_0x442043[_0x18435a(0xbb)]+'\x20'+_0x18435a(0xdf)+_0x18435a(0x17d)+_0x442043[_0x18435a(0xb0)]+'\x20'+_0x18435a(0x153)+_0x18435a(0x147)+_0x18435a(0x16f)+_0x18435a(0x156)+_0x18435a(0x149)+_0x18435a(0x12d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x18435a(0x145)+_0x18435a(0x10a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x18435a(0x17f)+_0x18435a(0x100)+_0x18435a(0x106)+_0x18435a(0x142)+_0x18435a(0xa9)+_0x18435a(0xfe)+'\x20'+_0xf98563+'\x20'+'</tbody>'+'</table>'+_0x18435a(0xdd)+'<strong>\x20Regards\x20</strong>'+_0x18435a(0xa2)+_0x2edc31[0x0]['site_title']+_0x18435a(0x147)+_0x18435a(0x16f)+_0x18435a(0x16f)+_0x18435a(0x17e)};_0x2fb063['sendMail'](_0x477d1c,function(_0xdcb9d8,_0x997e10){var _0x501729=_0x18435a;_0xdcb9d8?(console['log'](_0xdcb9d8),console[_0x501729(0x115)](_0x501729(0xb8))):console[_0x501729(0x115)](_0x501729(0xbe));});}catch(_0x583eae){console['error'](_0x583eae),_0x1c4340[_0x18435a(0x166)](0x1f4)['json']({'error':_0x18435a(0x14c),'message':_0x583eae[_0x18435a(0x105)]});}})[_0x15fa3d(0x98)](_0x37d783=>{var _0x17e491=_0x15fa3d;console[_0x17e491(0xcc)](_0x37d783);}),_0x3b9b20[_0x15fa3d(0x128)](_0x15fa3d(0xdc),_0x15fa3d(0x16b)),_0x1c4340[_0x15fa3d(0x187)]('/all_purchases_finished/view');}catch(_0x4fad13){console['log'](_0x4fad13);}}),router[a0_0x33a57f(0x175)](a0_0x33a57f(0x18c),auth,async(_0x2d13d6,_0x52b4c4)=>{var _0x58a5f5=a0_0x33a57f;try{const {username:_0x4c74bc,email:_0x289001,role:_0xdd6cff}=_0x2d13d6[_0x58a5f5(0xe6)],_0x5799e7=_0x2d13d6[_0x58a5f5(0xe6)],_0x2214a9=await profile[_0x58a5f5(0xcb)]({'email':_0x5799e7['email']}),_0x3f583c=await master_shop['find'](),_0x848054=_0x2d13d6[_0x58a5f5(0x11b)]['id'],_0x2d3c9b=await purchases_finished[_0x58a5f5(0xfb)](_0x848054),_0xc5dddb=await suppliers[_0x58a5f5(0xa8)]({});let _0x4edde4;if(_0x5799e7['role']==_0x58a5f5(0x9a)){const _0x2b7114=await staff['findOne']({'email':_0x5799e7[_0x58a5f5(0x12e)]});_0x4edde4=await warehouse['find']({'status':'Enabled','name':_0x2b7114[_0x58a5f5(0xbf)],'warehouse_category':_0x58a5f5(0x177)});}else _0x4edde4=await warehouse[_0x58a5f5(0x134)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x58a5f5(0x9f),'name':{'$first':_0x58a5f5(0x9f)}}}]);const _0x4ba41c=await product['find']({}),_0x24dd63=BayBinSelected(_0x2d3c9b[_0x58a5f5(0x136)],_0x2d3c9b['room']);let _0x5e3b86=new Date(_0x2d3c9b[_0x58a5f5(0x133)]),_0x4786ea=('0'+_0x5e3b86[_0x58a5f5(0xbd)]())[_0x58a5f5(0x157)](-0x2),_0x4d759a=('0'+(_0x5e3b86['getMonth']()+0x1))[_0x58a5f5(0x157)](-0x2),_0x1e173e=_0x5e3b86[_0x58a5f5(0xef)](),_0x474c71=_0x1e173e+'-'+_0x4d759a+'-'+_0x4786ea;if(_0x3f583c[0x0]['language']==_0x58a5f5(0x11f)){var _0x2fe96b=users[_0x58a5f5(0x155)];console['log'](_0x2fe96b);}else{if(_0x3f583c[0x0][_0x58a5f5(0xb3)]==_0x58a5f5(0xad))var _0x2fe96b=users['Hindi'];else{if(_0x3f583c[0x0]['language']==_0x58a5f5(0x195))var _0x2fe96b=users[_0x58a5f5(0x195)];else{if(_0x3f583c[0x0][_0x58a5f5(0xb3)]==_0x58a5f5(0x9b))var _0x2fe96b=users[_0x58a5f5(0x9b)];else{if(_0x3f583c[0x0][_0x58a5f5(0xb3)]==_0x58a5f5(0xe1))var _0x2fe96b=users[_0x58a5f5(0xe1)];else{if(_0x3f583c[0x0][_0x58a5f5(0xb3)]=='Portuguese\x20(BR)')var _0x2fe96b=users[_0x58a5f5(0x16e)];else{if(_0x3f583c[0x0]['language']==_0x58a5f5(0xc1))var _0x2fe96b=users[_0x58a5f5(0xc1)];else{if(_0x3f583c[0x0][_0x58a5f5(0xb3)]==_0x58a5f5(0x14e))var _0x2fe96b=users[_0x58a5f5(0xb5)];}}}}}}}_0x52b4c4['render']('edit_purchases_finished_view',{'success':_0x2d13d6[_0x58a5f5(0x128)](_0x58a5f5(0xdc)),'errors':_0x2d13d6[_0x58a5f5(0x128)]('errors'),'role':_0x5799e7,'profile':_0x2214a9,'purchases':_0x2d3c9b,'suppliers':_0xc5dddb,'warehouse':_0x4edde4,'product':_0x4ba41c,'master_shop':_0x3f583c,'language':_0x2fe96b,'ed_fullDate':_0x474c71,'dataSelected':_0x24dd63});}catch(_0xe67a78){console[_0x58a5f5(0x115)](_0xe67a78);}}),router[a0_0x33a57f(0x175)]('/view/:id',auth,async(_0x23ac43,_0x1fc3a4)=>{var _0x38d3b3=a0_0x33a57f;try{const {username:_0x41c395,email:_0x39d4c5,role:_0x35e563}=_0x23ac43[_0x38d3b3(0xe6)],_0x16417f=_0x23ac43[_0x38d3b3(0xe6)],_0x4a9b28=await profile[_0x38d3b3(0xcb)]({'email':_0x16417f[_0x38d3b3(0x12e)]}),_0x7c6aee=await master_shop[_0x38d3b3(0xa8)](),_0x4053d9=_0x23ac43[_0x38d3b3(0x11b)]['id'],_0x4ba710=await purchases_finished['findById'](_0x4053d9),_0x346cb5=await suppliers[_0x38d3b3(0xa8)]({});let _0x55bd66;if(_0x16417f['role']==_0x38d3b3(0x9a)){const _0x296157=await staff[_0x38d3b3(0xcb)]({'email':_0x16417f[_0x38d3b3(0x12e)]});_0x55bd66=await warehouse[_0x38d3b3(0xa8)]({'status':'Enabled','name':_0x296157[_0x38d3b3(0xbf)],'warehouse_category':_0x38d3b3(0x177)});}else _0x55bd66=await warehouse['aggregate']([{'$match':{'status':_0x38d3b3(0x102),'warehouse_category':_0x38d3b3(0x177)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x4129da=await product['find']({}),_0x1b6609=BayBinSelected(_0x4ba710[_0x38d3b3(0x136)],_0x4ba710['room']);let _0x446131=new Date(_0x4ba710[_0x38d3b3(0x133)]),_0x1d1720=('0'+_0x446131['getDate']())[_0x38d3b3(0x157)](-0x2),_0xb91f95=('0'+(_0x446131['getMonth']()+0x1))['slice'](-0x2),_0x5d7d44=_0x446131[_0x38d3b3(0xef)](),_0x5f18c1=_0x5d7d44+'-'+_0xb91f95+'-'+_0x1d1720;if(_0x7c6aee[0x0][_0x38d3b3(0xb3)]==_0x38d3b3(0x11f)){var _0x430166=users['English'];console[_0x38d3b3(0x115)](_0x430166);}else{if(_0x7c6aee[0x0][_0x38d3b3(0xb3)]=='Hindi')var _0x430166=users['Hindi'];else{if(_0x7c6aee[0x0]['language']==_0x38d3b3(0x195))var _0x430166=users[_0x38d3b3(0x195)];else{if(_0x7c6aee[0x0][_0x38d3b3(0xb3)]==_0x38d3b3(0x9b))var _0x430166=users['Spanish'];else{if(_0x7c6aee[0x0][_0x38d3b3(0xb3)]=='French')var _0x430166=users[_0x38d3b3(0xe1)];else{if(_0x7c6aee[0x0][_0x38d3b3(0xb3)]=='Portuguese\x20(BR)')var _0x430166=users[_0x38d3b3(0x16e)];else{if(_0x7c6aee[0x0][_0x38d3b3(0xb3)]=='Chinese')var _0x430166=users[_0x38d3b3(0xc1)];else{if(_0x7c6aee[0x0][_0x38d3b3(0xb3)]==_0x38d3b3(0x14e))var _0x430166=users[_0x38d3b3(0xb5)];}}}}}}}_0x1fc3a4[_0x38d3b3(0x125)](_0x38d3b3(0xe2),{'success':_0x23ac43[_0x38d3b3(0x128)](_0x38d3b3(0xdc)),'errors':_0x23ac43[_0x38d3b3(0x128)](_0x38d3b3(0xa3)),'role':_0x16417f,'profile':_0x4a9b28,'purchases':_0x4ba710,'suppliers':_0x346cb5,'warehouse':_0x55bd66,'product':_0x4129da,'master_shop':_0x7c6aee,'language':_0x430166,'ed_fullDate':_0x5f18c1,'dataSelected':_0x1b6609});}catch(_0x5c5ce9){console[_0x38d3b3(0x115)](_0x5c5ce9);}}),router['post']('/view/:id',auth,async(_0x583d20,_0x29357c)=>{var _0x8fc2ad=a0_0x33a57f;try{const _0x524142=_0x583d20[_0x8fc2ad(0x11b)]['id'],_0x346e9f=await purchases_finished['findOne']({'_id':_0x583d20['params']['id']}),_0x2c329f=await warehouse['findOne']({'name':_0x346e9f[_0x8fc2ad(0x136)],'room':_0x346e9f['room']});_0x346e9f[_0x8fc2ad(0x148)]['forEach'](_0x513267=>{var _0x116008=_0x8fc2ad;const _0x29fe42=_0x2c329f['product_details'][_0x116008(0xc9)](_0x219755=>{var _0x3394c1=_0x116008;_0x219755[_0x3394c1(0xd8)]==_0x513267[_0x3394c1(0xd8)]&&_0x219755['bay']==_0x513267[_0x3394c1(0xc6)]&&(_0x219755[_0x3394c1(0x18f)]=parseInt(_0x219755[_0x3394c1(0x18f)])-parseInt(_0x513267[_0x3394c1(0xea)]));});}),await _0x2c329f['save']();const {invoice:_0x254919,suppliers:_0x288e8b,date:_0x41cb8e,warehouse_name:_0xe22786,prod_name:_0x586108,prod_code:_0x100528,prod_qty:_0x41ea45,prod_unit:_0x30e934,prod_secondunit:_0x426216,prod_level:_0x125247,prod_isle:_0x1bcc2b,prod_pallet:_0x4b0ec1,note:_0x4b5adf,expiry_date:_0x5daf20,batch_code:_0x3467c5,paid_amount:_0x28d1a9,due_amount:_0x4de857,Room_name:_0x31b165,primary_code:_0x55dcac,secondary_code:_0x1ebb17,PO_number:_0x3d0c30,JO_number:_0x3631c2}=_0x583d20[_0x8fc2ad(0x146)];if(typeof _0x586108==_0x8fc2ad(0xe3))var _0x4fdc8e=[_0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0x13f)]],_0x2d289e=[_0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0x16d)]],_0x2873c9=[_0x583d20['body'][_0x8fc2ad(0x12c)]],_0xb35d05=[_0x583d20['body']['prod_unit']],_0x4bab44=[_0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0xc2)]],_0xf55f78=[_0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0x131)]],_0x200270=[_0x583d20['body'][_0x8fc2ad(0x9c)]],_0x55dfc0=[_0x583d20[_0x8fc2ad(0x146)]['secondary_code']],_0x401895=[_0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0x14b)]],_0x2b18aa=[_0x583d20['body']['batch_code']],_0x2df3cf=[_0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0x133)]];else var _0x4fdc8e=[..._0x583d20['body'][_0x8fc2ad(0x13f)]],_0x2d289e=[..._0x583d20[_0x8fc2ad(0x146)]['prod_code']],_0x2873c9=[..._0x583d20['body'][_0x8fc2ad(0x12c)]],_0xb35d05=[..._0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0x15e)]],_0x4bab44=[..._0x583d20['body'][_0x8fc2ad(0xc2)]],_0xf55f78=[..._0x583d20['body'][_0x8fc2ad(0x131)]],_0x200270=[..._0x583d20[_0x8fc2ad(0x146)]['primary_code']],_0x55dfc0=[..._0x583d20['body'][_0x8fc2ad(0x15d)]],_0x401895=[..._0x583d20['body'][_0x8fc2ad(0x14b)]],_0x2b18aa=[..._0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0x165)]],_0x2df3cf=[..._0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0x133)]];const _0xae69b8=_0x4fdc8e['map'](_0xf92a02=>{return _0xf92a02={'product_name':_0xf92a02};});_0x2d289e[_0x8fc2ad(0xa5)]((_0xd923f5,_0x3ffc0e)=>{_0xae69b8[_0x3ffc0e]['product_code']=_0xd923f5;}),_0x2873c9['forEach']((_0x223a48,_0x2d9934)=>{_0xae69b8[_0x2d9934]['quantity']=_0x223a48;}),_0xb35d05[_0x8fc2ad(0xa5)]((_0x244534,_0x4cec78)=>{_0xae69b8[_0x4cec78]['standard_unit']=_0x244534;}),_0x4bab44['forEach']((_0x5dbba0,_0x161b6a)=>{var _0x24f726=_0x8fc2ad;_0xae69b8[_0x161b6a][_0x24f726(0xa4)]=_0x5dbba0;}),_0xf55f78['forEach']((_0x5e6ccd,_0x5247f9)=>{var _0x438727=_0x8fc2ad;_0xae69b8[_0x5247f9][_0x438727(0xc6)]=_0x5e6ccd;}),_0x200270[_0x8fc2ad(0xa5)]((_0x4e5220,_0x145ac5)=>{_0xae69b8[_0x145ac5]['primary_code']=_0x4e5220;}),_0x55dfc0[_0x8fc2ad(0xa5)]((_0xbc682a,_0x1ddfe7)=>{var _0x550130=_0x8fc2ad;_0xae69b8[_0x1ddfe7][_0x550130(0x15d)]=_0xbc682a;}),_0x401895[_0x8fc2ad(0xa5)]((_0x32fe15,_0x21318a)=>{var _0xda9b1d=_0x8fc2ad;_0xae69b8[_0x21318a][_0xda9b1d(0x143)]=_0x32fe15;}),_0x2b18aa[_0x8fc2ad(0xa5)]((_0x5cdddd,_0x32647b)=>{var _0x265073=_0x8fc2ad;_0xae69b8[_0x32647b][_0x265073(0x165)]=_0x5cdddd;}),_0x2df3cf[_0x8fc2ad(0xa5)]((_0x1d9456,_0x13fb4f)=>{var _0x473170=_0x8fc2ad;_0xae69b8[_0x13fb4f][_0x473170(0x133)]=_0x1d9456;});const _0x2591fe=_0xae69b8['filter'](_0xf2eeb5=>_0xf2eeb5[_0x8fc2ad(0xea)]!=='0'&&_0xf2eeb5[_0x8fc2ad(0xea)]!=='');_0x346e9f[_0x8fc2ad(0xbb)]=_0x254919,_0x346e9f[_0x8fc2ad(0xf6)]=_0x288e8b,_0x346e9f['date']=_0x41cb8e,_0x346e9f['warehouse_name']=_0xe22786,_0x346e9f['product']=_0x2591fe,_0x346e9f['note']=_0x4b5adf,_0x346e9f[_0x8fc2ad(0xec)]=_0x28d1a9,_0x346e9f[_0x8fc2ad(0xcf)]=_0x4de857,_0x346e9f[_0x8fc2ad(0x14f)]=_0x31b165,_0x346e9f[_0x8fc2ad(0x182)]=_0x3d0c30,_0x346e9f[_0x8fc2ad(0x135)]=_0x3631c2;const _0x5c1d2a=await _0x346e9f['save'](),_0x9496b7=await warehouse[_0x8fc2ad(0xcb)]({'name':_0x583d20['body'][_0x8fc2ad(0x136)],'room':_0x583d20['body'][_0x8fc2ad(0x186)]});_0x346e9f[_0x8fc2ad(0x148)]['forEach'](_0x16628b=>{var _0x37d6cd=_0x8fc2ad,_0x587d2c=0x0;const _0x3ec4ba=_0x9496b7[_0x37d6cd(0x11c)][_0x37d6cd(0xc9)](_0x592c4e=>{var _0x5e1b42=_0x37d6cd;_0x592c4e['product_name']==_0x16628b['product_name']&&_0x592c4e[_0x5e1b42(0xc6)]==_0x16628b[_0x5e1b42(0xc6)]&&(_0x592c4e[_0x5e1b42(0x18f)]=parseInt(_0x592c4e['product_stock'])+parseInt(_0x16628b[_0x5e1b42(0xea)]),_0x587d2c++);});_0x587d2c=='0'&&(_0x9496b7[_0x37d6cd(0x11c)]=_0x9496b7['product_details'][_0x37d6cd(0x116)]({'product_name':_0x16628b[_0x37d6cd(0xd8)],'product_stock':_0x16628b[_0x37d6cd(0xea)],'primary_code':_0x16628b[_0x37d6cd(0x9c)],'secondary_code':_0x16628b[_0x37d6cd(0x15d)],'product_code':_0x16628b[_0x37d6cd(0x114)],'bay':_0x16628b[_0x37d6cd(0xc6)],'maxProducts':_0x16628b['maxStocks'],'unit':_0x16628b[_0x37d6cd(0x10e)],'secondary_unit':_0x16628b['secondary_unit'],'expiry_date':_0x16628b['expiry_date']}));}),await _0x9496b7[_0x8fc2ad(0x127)]();const _0x1d5c49=await s_payment_data[_0x8fc2ad(0xcb)]({'invoice':_0x583d20['body'][_0x8fc2ad(0xbb)]});if(_0x1d5c49===null){}else console[_0x8fc2ad(0x115)](_0x8fc2ad(0xf6),_0x1d5c49,_0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0xbb)]),_0x1d5c49[_0x8fc2ad(0xf6)]=_0x583d20[_0x8fc2ad(0x146)][_0x8fc2ad(0xf6)],await _0x1d5c49[_0x8fc2ad(0x127)]();_0x583d20[_0x8fc2ad(0x128)]('success',_0x8fc2ad(0xd1)),_0x29357c[_0x8fc2ad(0x187)](_0x8fc2ad(0x172));}catch(_0x108c47){console[_0x8fc2ad(0x115)](_0x108c47);}}),router[a0_0x33a57f(0x126)](a0_0x33a57f(0x179),auth,async(_0x55a039,_0x3559a9)=>{var _0x4ef123=a0_0x33a57f;try{const _0x18b398=_0x55a039[_0x4ef123(0x11b)]['id'],{invoice:_0x2e124d,suppliers:_0x1bc677,payable:_0x300627,due_amount:_0x3c1fbf}=_0x55a039[_0x4ef123(0x146)],_0x45468d=await purchases[_0x4ef123(0xfb)](_0x18b398);var _0x245420=_0x300627-_0x3c1fbf;_0x45468d[_0x4ef123(0xec)]=parseFloat(_0x45468d[_0x4ef123(0xec)])+parseFloat(_0x3c1fbf),_0x45468d[_0x4ef123(0xcf)]=_0x245420;const _0x3a1ca8=await _0x45468d[_0x4ef123(0x127)]();console['log'](_0x3a1ca8);const _0x527edd=await s_payment_data[_0x4ef123(0xcb)]({'invoice':_0x2e124d});_0x527edd[_0x4ef123(0xac)]=_0x245420,await _0x527edd['save']();let _0x41bac9=new Date(),_0x4f8732=('0'+_0x41bac9[_0x4ef123(0xbd)]())[_0x4ef123(0x157)](-0x2),_0x1e8139=('0'+(_0x41bac9[_0x4ef123(0xf8)]()+0x1))[_0x4ef123(0x157)](-0x2),_0xcaa3db=_0x41bac9[_0x4ef123(0xef)](),_0x5e29ef=_0xcaa3db+'-'+_0x1e8139+'-'+_0x4f8732;const _0x29f8e3=new suppliers_payment({'invoice':_0x2e124d,'date':_0xcaa3db+'-'+_0x1e8139+'-'+_0x4f8732,'suppliers':_0x1bc677,'reason':_0x4ef123(0x123),'amount':_0x3c1fbf}),_0x1c7936=await _0x29f8e3[_0x4ef123(0x127)]();_0x55a039[_0x4ef123(0x128)](_0x4ef123(0xdc),'payment\x20successfull'),_0x3559a9[_0x4ef123(0x187)](_0x4ef123(0x117));}catch(_0x4bc329){console[_0x4ef123(0x115)](_0x4bc329);}}),router['get'](a0_0x33a57f(0x15a),auth,async(_0x51495f,_0x2f7e9d)=>{var _0x203290=a0_0x33a57f;try{const {username:_0x114db4,email:_0x34aab6,role:_0x2b0f91}=_0x51495f[_0x203290(0xe6)],_0x2d6347=_0x51495f[_0x203290(0xe6)],_0x388901=await profile[_0x203290(0xcb)]({'email':_0x2d6347[_0x203290(0x12e)]}),_0x323940=await master_shop[_0x203290(0xa8)]();console[_0x203290(0x115)](_0x203290(0xf1),_0x323940);const _0x120993=_0x51495f[_0x203290(0x11b)]['id'],_0x219cab=await purchases['findById'](_0x120993);console[_0x203290(0x115)](_0x219cab);const _0x14ba9e=await suppliers[_0x203290(0xcb)]({'name':_0x219cab[_0x203290(0xf6)]});console[_0x203290(0x115)](_0x14ba9e);if(_0x323940[0x0]['language']=='English\x20(US)'){var _0x294f1b=users[_0x203290(0x155)];console[_0x203290(0x115)](_0x294f1b);}else{if(_0x323940[0x0][_0x203290(0xb3)]=='Hindi')var _0x294f1b=users[_0x203290(0xad)];else{if(_0x323940[0x0][_0x203290(0xb3)]==_0x203290(0x195))var _0x294f1b=users[_0x203290(0x195)];else{if(_0x323940[0x0]['language']=='Spanish')var _0x294f1b=users[_0x203290(0x9b)];else{if(_0x323940[0x0][_0x203290(0xb3)]==_0x203290(0xe1))var _0x294f1b=users[_0x203290(0xe1)];else{if(_0x323940[0x0][_0x203290(0xb3)]==_0x203290(0x188))var _0x294f1b=users['Portuguese'];else{if(_0x323940[0x0]['language']==_0x203290(0xc1))var _0x294f1b=users[_0x203290(0xc1)];else{if(_0x323940[0x0][_0x203290(0xb3)]==_0x203290(0x14e))var _0x294f1b=users[_0x203290(0xb5)];}}}}}}}_0x2f7e9d['render'](_0x203290(0xb6),{'success':_0x51495f[_0x203290(0x128)](_0x203290(0xdc)),'errors':_0x51495f[_0x203290(0x128)](_0x203290(0xa3)),'role':_0x2d6347,'profile':_0x388901,'master_shop':_0x323940,'supplier':_0x14ba9e,'purchase':_0x219cab,'language':_0x294f1b});}catch(_0xf774a0){console[_0x203290(0x115)](_0xf774a0);}}),router[a0_0x33a57f(0x175)](a0_0x33a57f(0x150),auth,async(_0x1dc54f,_0x15f72c)=>{var _0x305990=a0_0x33a57f;try{const {username:_0x4e9781,email:_0x3b0533,role:_0x475c8d}=_0x1dc54f[_0x305990(0xe6)],_0x1e0c29=_0x1dc54f[_0x305990(0xe6)],_0x3b7305=await profile['findOne']({'email':_0x1e0c29[_0x305990(0x12e)]}),_0x5b56c8=await master_shop[_0x305990(0xa8)]();console[_0x305990(0x115)]('master',_0x5b56c8);const _0x3e357f=_0x1dc54f['params']['id'];console[_0x305990(0x115)](_0x3e357f);const _0x3d22fe=await purchases_finished[_0x305990(0xfb)](_0x3e357f);console['log'](_0x305990(0xe8),_0x3d22fe);const _0x3fd4c3=await product[_0x305990(0xa8)]({}),_0x8f6d42=await warehouse[_0x305990(0x134)]([{'$match':{'name':_0x3d22fe[_0x305990(0x136)],'room':_0x3d22fe[_0x305990(0x14f)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x305990(0xcd),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x305990(0xff)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x305990(0x15c)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x305990(0x129)},'primary_code':{'$first':_0x305990(0x15f)},'secondary_code':{'$first':_0x305990(0x124)},'product_code':{'$first':_0x305990(0x170)},'storage':{'$first':_0x305990(0x140)},'rack':{'$first':_0x305990(0x97)}}}]);console['log'](_0x305990(0xd9),_0x8f6d42);let _0x58fd5b;if(_0x1e0c29['role']==_0x305990(0x9a)){const _0x3f33b2=await staff[_0x305990(0xcb)]({'email':_0x1e0c29[_0x305990(0x12e)]});_0x58fd5b=await warehouse['find']({'status':_0x305990(0x102),'name':_0x3f33b2[_0x305990(0xbf)],'warehouse_category':_0x305990(0x177),'name':_0x305990(0x18b)});}else _0x58fd5b=await warehouse['aggregate']([{'$match':{'status':_0x305990(0x102),'warehouse_category':_0x305990(0x177),'name':_0x305990(0x18b)}},{'$group':{'_id':'$name','name':{'$first':_0x305990(0x9f)}}}]);if(_0x5b56c8[0x0][_0x305990(0xb3)]==_0x305990(0x11f)){var _0x1b5ba7=users[_0x305990(0x155)];console[_0x305990(0x115)](_0x1b5ba7);}else{if(_0x5b56c8[0x0][_0x305990(0xb3)]=='Hindi')var _0x1b5ba7=users[_0x305990(0xad)];else{if(_0x5b56c8[0x0][_0x305990(0xb3)]==_0x305990(0x195))var _0x1b5ba7=users[_0x305990(0x195)];else{if(_0x5b56c8[0x0]['language']==_0x305990(0x9b))var _0x1b5ba7=users[_0x305990(0x9b)];else{if(_0x5b56c8[0x0][_0x305990(0xb3)]==_0x305990(0xe1))var _0x1b5ba7=users['French'];else{if(_0x5b56c8[0x0][_0x305990(0xb3)]==_0x305990(0x188))var _0x1b5ba7=users[_0x305990(0x16e)];else{if(_0x5b56c8[0x0][_0x305990(0xb3)]==_0x305990(0xc1))var _0x1b5ba7=users[_0x305990(0xc1)];else{if(_0x5b56c8[0x0][_0x305990(0xb3)]==_0x305990(0x14e))var _0x1b5ba7=users[_0x305990(0xb5)];}}}}}}}_0x15f72c[_0x305990(0x125)](_0x305990(0xed),{'success':_0x1dc54f[_0x305990(0x128)](_0x305990(0xdc)),'errors':_0x1dc54f[_0x305990(0x128)](_0x305990(0xa3)),'role':_0x1e0c29,'profile':_0x3b7305,'user':_0x3d22fe,'stock':_0x8f6d42,'master_shop':_0x5b56c8,'product':_0x3fd4c3,'language':_0x1b5ba7,'warehouse':_0x58fd5b});}catch(_0x46ab40){console['log'](_0x46ab40);}}),router['post']('/view/return_purchase/:id',auth,async(_0x408f6f,_0x3fe96c)=>{var _0x28ac7d=a0_0x33a57f;try{const {invoice:_0x3cc364,date:_0x288172,warehouse_name:_0x53a641,Room_name:_0x3c601f,product_name:_0xff1ac2,purchase_quantity:_0x3b651b,stocks:_0x58a301,return_qty:_0x4fa670,note:_0x23ce7e,level:_0x17a144,isle:_0x3cd1d2,pallet:_0x5e3ff3,to_warehouse_name:_0x13f286,to_Room_name:_0x102629}=_0x408f6f[_0x28ac7d(0x146)],_0x51fc27=await purchases_finished[_0x28ac7d(0xcb)]({'_id':_0x408f6f['params']['id']}),_0x17aba4=await warehouse['findOne']({'name':_0x53a641,'room':_0x3c601f,'warehouse_category':_0x28ac7d(0x177)});if(typeof _0xff1ac2==_0x28ac7d(0xe3))var _0x5be767=[_0x408f6f['body'][_0x28ac7d(0xd8)]],_0x1d23ac=[_0x408f6f['body']['purchase_quantity']],_0x574e5d=[_0x408f6f['body'][_0x28ac7d(0x190)]],_0x2cfa9c=[_0x408f6f[_0x28ac7d(0x146)][_0x28ac7d(0x152)]],_0x396048=[_0x408f6f['body'][_0x28ac7d(0x162)]],_0x45c7f7=[_0x408f6f[_0x28ac7d(0x146)][_0x28ac7d(0xf9)]],_0x47c5c0=[_0x408f6f[_0x28ac7d(0x146)]['primary_code_hide']],_0xa3ea07=[_0x408f6f['body'][_0x28ac7d(0xe7)]];else var _0x5be767=[..._0x408f6f['body'][_0x28ac7d(0xd8)]],_0x1d23ac=[..._0x408f6f[_0x28ac7d(0x146)][_0x28ac7d(0xaa)]],_0x574e5d=[..._0x408f6f[_0x28ac7d(0x146)]['stocks']],_0x2cfa9c=[..._0x408f6f[_0x28ac7d(0x146)][_0x28ac7d(0x152)]],_0x396048=[..._0x408f6f[_0x28ac7d(0x146)][_0x28ac7d(0x162)]],_0x45c7f7=[..._0x408f6f[_0x28ac7d(0x146)][_0x28ac7d(0xf9)]],_0x47c5c0=[..._0x408f6f[_0x28ac7d(0x146)][_0x28ac7d(0x141)]],_0xa3ea07=[..._0x408f6f[_0x28ac7d(0x146)][_0x28ac7d(0xe7)]];const _0x4b03d0=_0x5be767['map'](_0x24443d=>{return _0x24443d={'product_name':_0x24443d};});_0x1d23ac[_0x28ac7d(0xa5)]((_0x5504d3,_0x45fef2)=>{var _0x197110=_0x28ac7d;_0x4b03d0[_0x45fef2][_0x197110(0xaa)]=_0x5504d3;}),_0x574e5d[_0x28ac7d(0xa5)]((_0x4b241e,_0x22e581)=>{var _0xb83233=_0x28ac7d;_0x4b03d0[_0x22e581][_0xb83233(0x167)]=_0x4b241e;}),_0x2cfa9c[_0x28ac7d(0xa5)]((_0xc21fb1,_0x5ce082)=>{_0x4b03d0[_0x5ce082]['return_qty']=_0xc21fb1;}),_0x396048[_0x28ac7d(0xa5)]((_0x148d43,_0x21e38d)=>{var _0xdca56d=_0x28ac7d;_0x4b03d0[_0x21e38d][_0xdca56d(0xc6)]=_0x148d43;}),_0x45c7f7[_0x28ac7d(0xa5)]((_0x115ab0,_0x3a39e1)=>{var _0x268ab4=_0x28ac7d;_0x4b03d0[_0x3a39e1][_0x268ab4(0x114)]=_0x115ab0;}),_0x47c5c0['forEach']((_0x29bb9d,_0x1b40c4)=>{var _0x127743=_0x28ac7d;_0x4b03d0[_0x1b40c4][_0x127743(0x9c)]=_0x29bb9d;}),_0xa3ea07[_0x28ac7d(0xa5)]((_0x173de9,_0x278dae)=>{var _0x275633=_0x28ac7d;_0x4b03d0[_0x278dae][_0x275633(0x15d)]=_0x173de9;}),_0x4b03d0[_0x28ac7d(0xa5)](_0x3080ac=>{var _0x291416=_0x28ac7d;console[_0x291416(0x115)](_0x3080ac);const _0x161ba0=_0x17aba4[_0x291416(0x11c)][_0x291416(0xc9)](_0x572190=>{var _0x31e32d=_0x291416;_0x572190['product_name']==_0x3080ac['product_name']&&_0x572190[_0x31e32d(0xc6)]==_0x3080ac[_0x31e32d(0xc6)]&&(console[_0x31e32d(0x115)](parseInt(_0x572190[_0x31e32d(0x18f)])+_0x31e32d(0x16c)+parseInt(_0x3080ac['return_qty'])),_0x572190[_0x31e32d(0x18f)]=parseInt(_0x572190[_0x31e32d(0x18f)])-parseInt(_0x3080ac[_0x31e32d(0x152)]));});}),await _0x17aba4[_0x28ac7d(0x127)]();var _0x553793=0x0;_0x4b03d0[_0x28ac7d(0xa5)](_0x5f4921=>{var _0x56d338=_0x28ac7d;(parseInt(_0x5f4921[_0x56d338(0xaa)])<parseInt(_0x5f4921[_0x56d338(0x152)])||parseInt(_0x5f4921[_0x56d338(0x167)])<parseInt(_0x5f4921['return_qty']))&&_0x553793++;});if(_0x553793!=0x0)return _0x408f6f['flash'](_0x28ac7d(0xa3),_0x28ac7d(0xf3)),_0x3fe96c[_0x28ac7d(0x187)](_0x28ac7d(0xba));const _0x5f13f2=new purchases_return_finished({'invoice':_0x3cc364,'suppliers':_0x408f6f[_0x28ac7d(0x146)][_0x28ac7d(0xf6)],'date':_0x288172,'warehouse_name':_0x53a641,'return_product':_0x4b03d0,'note':_0x23ce7e,'room':_0x3c601f,'to_warehouse_name':_0x13f286,'to_room':_0x102629}),_0x1f1899=await _0x5f13f2[_0x28ac7d(0x127)](),_0x5a5208=await purchases_return_finished[_0x28ac7d(0xcb)]({'invoice':_0x3cc364}),_0x1d756c=await warehouse[_0x28ac7d(0xcb)]({'name':_0x13f286,'room':_0x102629,'warehouse_category':_0x28ac7d(0x177)});_0x5a5208['return_product'][_0x28ac7d(0xa5)](_0x5b6c03=>{var _0x3bd538=_0x28ac7d,_0x3b5438=0x0;const _0x5c571f=_0x1d756c[_0x3bd538(0x11c)][_0x3bd538(0xc9)](_0x949ac0=>{var _0x4b95ec=_0x3bd538;console[_0x4b95ec(0x115)](_0x949ac0[_0x4b95ec(0xd8)]+'=='+_0x5b6c03[_0x4b95ec(0xd8)]+'&&'+_0x949ac0[_0x4b95ec(0xc6)]+'=='+_0x5b6c03['bay']),_0x949ac0[_0x4b95ec(0xd8)]==_0x5b6c03[_0x4b95ec(0xd8)]&&_0x949ac0[_0x4b95ec(0xc6)]==_0x5b6c03[_0x4b95ec(0xc6)]&&(_0x949ac0[_0x4b95ec(0x18f)]=parseInt(_0x949ac0['product_stock'])-parseInt(_0x5b6c03[_0x4b95ec(0x152)]),_0x3b5438++);});_0x3b5438=='0'&&(_0x1d756c[_0x3bd538(0x11c)]=_0x1d756c[_0x3bd538(0x11c)][_0x3bd538(0x116)]({'product_name':_0x5b6c03[_0x3bd538(0xd8)],'product_stock':_0x5b6c03[_0x3bd538(0x152)],'primary_code':_0x5b6c03[_0x3bd538(0x9c)],'secondary_code':_0x5b6c03[_0x3bd538(0x15d)],'product_code':_0x5b6c03[_0x3bd538(0x114)],'bay':_0x5b6c03[_0x3bd538(0xc6)],'maxProducts':0xf423f}));}),await _0x1d756c[_0x28ac7d(0x127)]();const _0x3408a3=await purchases_finished[_0x28ac7d(0xcb)]({'invoice':_0x3cc364});_0x3408a3[_0x28ac7d(0x144)]=_0x28ac7d(0x107);const _0x387305=await _0x3408a3[_0x28ac7d(0x127)](),_0x2260df=new s_payment_data({'invoice':_0x3cc364,'suppliers':_0x408f6f['body'][_0x28ac7d(0xf6)],'reason':_0x28ac7d(0x11d)});await _0x2260df[_0x28ac7d(0x127)]();const _0x1e7e4a=await master_shop[_0x28ac7d(0xa8)](),_0x500a64=await email_settings[_0x28ac7d(0xcb)](),_0x594dd1=await suppliers[_0x28ac7d(0xcb)]({'name':_0x408f6f['body'][_0x28ac7d(0xf6)]});_0x1e7e4a[0x0][_0x28ac7d(0x14a)]==0x1?(right_currency=_0x1e7e4a[0x0][_0x28ac7d(0xf5)],left_currency=''):(right_currency='',left_currency=_0x1e7e4a[0x0][_0x28ac7d(0xf5)]);var _0x1726de=_0x5be767,_0x56141a=_0x2cfa9c,_0x4b0152='',_0x30910b;for(_0x30910b in _0x1726de){_0x4b0152+=_0x28ac7d(0x12d)+_0x28ac7d(0xd4)+_0x1726de[_0x30910b]+_0x28ac7d(0xdb)+_0x28ac7d(0xd4)+_0x56141a[_0x30910b]+_0x28ac7d(0xdb)+_0x28ac7d(0x142);}let _0x37dd34=nodemailer['createTransport']({'service':_0x28ac7d(0x181),'auth':{'user':_0x500a64[_0x28ac7d(0x12e)],'pass':_0x500a64[_0x28ac7d(0xb1)]}}),_0x50a6e2={'from':_0x500a64[_0x28ac7d(0x12e)],'to':_0x594dd1['email'],'subject':_0x28ac7d(0x161),'attachments':[{'filename':_0x28ac7d(0xae),'path':__dirname+'/../public'+_0x28ac7d(0xfa)+_0x1e7e4a[0x0][_0x28ac7d(0x9e)],'cid':_0x28ac7d(0x103)}],'html':_0x28ac7d(0x169)+_0x28ac7d(0x191)+'</head><body>'+_0x28ac7d(0xdd)+_0x28ac7d(0x130)+'<div>'+_0x28ac7d(0x178)+_0x28ac7d(0x16f)+'<div>'+_0x28ac7d(0xfc)+_0x1e7e4a[0x0][_0x28ac7d(0x176)]+_0x28ac7d(0xee)+_0x28ac7d(0x16f)+_0x28ac7d(0x16f)+_0x28ac7d(0xaf)+_0x28ac7d(0xdd)+_0x28ac7d(0xd5)+_0x28ac7d(0x13d)+_0x3cc364+'\x20'+_0x28ac7d(0xdf)+'\x20Order\x20Date\x20:\x20'+_0x288172+'\x20'+_0x28ac7d(0x153)+_0x28ac7d(0x147)+_0x28ac7d(0x16f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x28ac7d(0x149)+_0x28ac7d(0x12d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x28ac7d(0xc5)+_0x28ac7d(0xa7)+_0x28ac7d(0x163)+'</tr>'+'</thead>'+_0x28ac7d(0xfe)+'\x20'+_0x4b0152+'\x20'+_0x28ac7d(0x168)+'</table>'+_0x28ac7d(0xdd)+'<strong>\x20Regards\x20</strong>'+_0x28ac7d(0xa2)+_0x1e7e4a[0x0][_0x28ac7d(0x176)]+_0x28ac7d(0x147)+'</div>'+_0x28ac7d(0x16f)+_0x28ac7d(0x17e)};_0x37dd34[_0x28ac7d(0x18e)](_0x50a6e2,function(_0x74f2bd,_0x24de05){var _0x441db1=_0x28ac7d;_0x74f2bd?console[_0x441db1(0x115)](_0x441db1(0xb8)):console[_0x441db1(0x115)](_0x441db1(0xbe));}),_0x408f6f[_0x28ac7d(0x128)]('success',_0x28ac7d(0xfd)),_0x3fe96c[_0x28ac7d(0x187)](_0x28ac7d(0x172));}catch(_0x519b74){_0x3fe96c[_0x28ac7d(0x166)](0xc8)[_0x28ac7d(0x10d)]({'message':_0x519b74['message']});}}),router[a0_0x33a57f(0x175)](a0_0x33a57f(0x151),auth,async(_0x226f29,_0x453b97)=>{var _0x5244cf=a0_0x33a57f;try{const {username:_0x38e551,email:_0x576daf,role:_0x298fa4}=_0x226f29[_0x5244cf(0xe6)],_0x52b20b=_0x226f29[_0x5244cf(0xe6)],_0x653ba5=await profile['findOne']({'email':_0x52b20b[_0x5244cf(0x12e)]}),_0x1a6c17=await master_shop[_0x5244cf(0xa8)](),_0x73bd0c=_0x226f29[_0x5244cf(0x11b)]['id'],_0x10300e=await purchases_finished[_0x5244cf(0xfb)](_0x73bd0c);if(_0x1a6c17[0x0][_0x5244cf(0xb3)]=='English\x20(US)')var _0x4e5938=users[_0x5244cf(0x155)];else{if(_0x1a6c17[0x0][_0x5244cf(0xb3)]=='Hindi')var _0x4e5938=users['Hindi'];else{if(_0x1a6c17[0x0][_0x5244cf(0xb3)]=='German')var _0x4e5938=users[_0x5244cf(0x195)];else{if(_0x1a6c17[0x0][_0x5244cf(0xb3)]==_0x5244cf(0x9b))var _0x4e5938=users[_0x5244cf(0x9b)];else{if(_0x1a6c17[0x0][_0x5244cf(0xb3)]==_0x5244cf(0xe1))var _0x4e5938=users[_0x5244cf(0xe1)];else{if(_0x1a6c17[0x0]['language']==_0x5244cf(0x188))var _0x4e5938=users[_0x5244cf(0x16e)];else{if(_0x1a6c17[0x0][_0x5244cf(0xb3)]=='Chinese')var _0x4e5938=users[_0x5244cf(0xc1)];else{if(_0x1a6c17[0x0]['language']==_0x5244cf(0x14e))var _0x4e5938=users[_0x5244cf(0xb5)];}}}}}}}_0x453b97[_0x5244cf(0x125)]('all_purchases_barcode',{'success':_0x226f29['flash'](_0x5244cf(0xdc)),'errors':_0x226f29[_0x5244cf(0x128)](_0x5244cf(0xa3)),'role':_0x52b20b,'profile':_0x653ba5,'alldata':_0x10300e,'master_shop':_0x1a6c17,'language':_0x4e5938}),console[_0x5244cf(0x115)](alldata);}catch(_0xba9708){console['log'](_0xba9708);}}),router['post'](a0_0x33a57f(0xb7),async(_0x21d646,_0x8399a0)=>{var _0x169297=a0_0x33a57f;const {product_code:_0xc816f2}=_0x21d646[_0x169297(0x146)];var _0x3e2c7c;const _0x3da194=await product['aggregate']([{'$match':{'primary_code':_0xc816f2,'product_category':_0x169297(0x177)}},{'$group':{'_id':_0x169297(0xe5),'name':{'$first':_0x169297(0x9f)},'category':{'$first':_0x169297(0x112)},'brand':{'$first':'$brand'},'unit':{'$first':_0x169297(0x110)},'alertquantity':{'$first':_0x169297(0x17b)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x169297(0x192)},'secondary_code':{'$first':_0x169297(0x15b)},'maxStocks':{'$first':_0x169297(0xd2)},'maxProdPerUnit':{'$first':_0x169297(0x194)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x169297(0x121)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x557980=await product[_0x169297(0x134)]([{'$match':{'secondary_code':_0xc816f2}},{'$group':{'_id':_0x169297(0xe5),'name':{'$first':_0x169297(0x9f)},'category':{'$first':'$category'},'brand':{'$first':_0x169297(0x12b)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x169297(0x17b)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x169297(0x192)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x169297(0xd2)},'maxProdPerUnit':{'$first':_0x169297(0x194)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x169297(0x121)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3da194[_0x169297(0x113)]>0x0)_0x3e2c7c=_0x3da194;else _0x557980[_0x169297(0x113)]>0x0&&(_0x3e2c7c=_0x557980);_0x8399a0[_0x169297(0x10d)](_0x3e2c7c);}),router['post']('/CheckingWarehouse',async(_0x5f4dff,_0x1615f5)=>{var _0x1b0118=a0_0x33a57f;const {productCode:_0x555dc4,bay:_0x2ff7d6,warehouses:_0x2824c8,room:_0x3e0c84}=_0x5f4dff['body'];console['log'](_0x5f4dff[_0x1b0118(0x146)]);try{const _0x5b4942=await warehouse[_0x1b0118(0x134)]([{'$match':{'name':_0x2824c8,'room':_0x3e0c84}},{'$unwind':_0x1b0118(0x119)},{'$match':{'product_details.bay':parseInt(_0x2ff7d6)}},{'$group':{'_id':_0x1b0118(0xcd),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1b0118(0xff)},'bay':{'$first':_0x1b0118(0x16a)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x1615f5[_0x1b0118(0x166)](0xc8)[_0x1b0118(0x10d)](_0x5b4942);}catch(_0x15a080){_0x1615f5[_0x1b0118(0x166)](0x194)[_0x1b0118(0x10d)]({'message':_0x15a080['message']});}}),module[a0_0x33a57f(0x10b)]=router;