var a0_0x1a6a75=a0_0x1a0e;(function(_0x226b3e,_0x1575f1){var _0x2c9090=a0_0x1a0e,_0x2851a1=_0x226b3e();while(!![]){try{var _0x2c8a0b=-parseInt(_0x2c9090(0xc8))/0x1*(-parseInt(_0x2c9090(0x15d))/0x2)+-parseInt(_0x2c9090(0x108))/0x3+parseInt(_0x2c9090(0x99))/0x4+parseInt(_0x2c9090(0x93))/0x5+parseInt(_0x2c9090(0x13b))/0x6+parseInt(_0x2c9090(0x15f))/0x7*(parseInt(_0x2c9090(0x141))/0x8)+parseInt(_0x2c9090(0xc3))/0x9*(-parseInt(_0x2c9090(0x159))/0xa);if(_0x2c8a0b===_0x1575f1)break;else _0x2851a1['push'](_0x2851a1['shift']());}catch(_0x492598){_0x2851a1['push'](_0x2851a1['shift']());}}}(a0_0x2a69,0x73d3d));function a0_0x1a0e(_0x80178d,_0x32c23e){var _0x2a6943=a0_0x2a69();return a0_0x1a0e=function(_0x1a0e92,_0x59006a){_0x1a0e92=_0x1a0e92-0x71;var _0x3a9069=_0x2a6943[_0x1a0e92];return _0x3a9069;},a0_0x1a0e(_0x80178d,_0x32c23e);}const express=require(a0_0x1a6a75(0x98)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x1a6a75(0x135)),nodemailer=require(a0_0x1a6a75(0xb9));var ejs=require('ejs');const path=require(a0_0x1a6a75(0x91)),users=require(a0_0x1a6a75(0x9b));router[a0_0x1a6a75(0xcf)]('/view',auth,async(_0x2fee83,_0x341b20)=>{var _0x426414=a0_0x1a6a75;try{const {username:_0x16975d,email:_0x5ca57b,role:_0x4deeec}=_0x2fee83[_0x426414(0x114)],_0x3e3006=_0x2fee83[_0x426414(0x114)],_0x37f54d=await profile[_0x426414(0xde)]({'email':_0x3e3006['email']}),_0x457b08=await staff['findOne']({'email':_0x3e3006['email']});if(_0x3e3006['role']==_0x426414(0x139)){const _0x58c952=await staff[_0x426414(0xde)]({'email':_0x3e3006[_0x426414(0x158)]});}const _0x486ced=await master_shop['find']();let _0x1682cb;if(_0x3e3006['role']==_0x426414(0x139)){const _0x4e3983=await staff[_0x426414(0xde)]({'email':_0x3e3006[_0x426414(0x158)]});_0x1682cb=await purchases_finished[_0x426414(0x11a)]([{'$match':{'warehouse_name':_0x4e3983[_0x426414(0xc0)]}},{'$lookup':{'from':_0x426414(0xe9),'localField':_0x426414(0xe9),'foreignField':_0x426414(0xb2),'as':_0x426414(0x167)}},{'$unwind':_0x426414(0xdd)},{'$unwind':_0x426414(0x13c)},{'$group':{'_id':_0x426414(0x11b),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x426414(0x12c)},'date':{'$first':_0x426414(0xfc)},'warehouse_name':{'$first':_0x426414(0x84)},'room':{'$first':_0x426414(0xb8)},'product':{'$push':'$product'},'note':{'$first':_0x426414(0x94)},'paid_amount':{'$first':_0x426414(0x133)},'due_amount':{'$first':_0x426414(0xf9)},'return_data':{'$first':_0x426414(0xeb)},'batch_code':{'$first':_0x426414(0x110)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x426414(0xdd)},'total_product_quantity':{'$sum':_0x426414(0x165)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x426414(0xf7)},'type':{'$addToSet':_0x426414(0xaf)},'floorlevel':{'$addToSet':_0x426414(0xd8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1682cb=await purchases_finished[_0x426414(0x11a)]([{'$unwind':_0x426414(0x13c)},{'$group':{'_id':_0x426414(0x11b),'invoice':{'$first':_0x426414(0x115)},'suppliers':{'$first':_0x426414(0x12c)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x426414(0x126)},'product':{'$push':'$product'},'note':{'$first':_0x426414(0x94)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x426414(0xeb)},'batch_code':{'$first':_0x426414(0x110)},'expiry_date':{'$first':_0x426414(0x123)},'suppliers_docs':{'$first':_0x426414(0xdd)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x426414(0xf7)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x426414(0xd8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x486ced[0x0][_0x426414(0xc7)]==_0x426414(0xf5))var _0x37264b=users[_0x426414(0x106)];else{if(_0x486ced[0x0][_0x426414(0xc7)]==_0x426414(0xf1))var _0x37264b=users['Hindi'];else{if(_0x486ced[0x0][_0x426414(0xc7)]=='German')var _0x37264b=users[_0x426414(0x82)];else{if(_0x486ced[0x0][_0x426414(0xc7)]==_0x426414(0xa3))var _0x37264b=users[_0x426414(0xa3)];else{if(_0x486ced[0x0][_0x426414(0xc7)]==_0x426414(0x154))var _0x37264b=users[_0x426414(0x154)];else{if(_0x486ced[0x0][_0x426414(0xc7)]=='Portuguese\x20(BR)')var _0x37264b=users[_0x426414(0x72)];else{if(_0x486ced[0x0]['language']==_0x426414(0x14b))var _0x37264b=users[_0x426414(0x14b)];else{if(_0x486ced[0x0][_0x426414(0xc7)]==_0x426414(0x89))var _0x37264b=users[_0x426414(0x149)];}}}}}}}_0x341b20[_0x426414(0x8b)](_0x426414(0x145),{'success':_0x2fee83[_0x426414(0x116)](_0x426414(0xfd)),'errors':_0x2fee83[_0x426414(0x116)]('errors'),'purchases':_0x1682cb,'role':_0x3e3006,'profile':_0x37f54d,'master_shop':_0x486ced,'language':_0x37264b});}catch(_0x2c194e){console[_0x426414(0xcc)](_0x426414(0x14a),_0x2c194e),_0x341b20[_0x426414(0x12f)](0xc8)[_0x426414(0xe6)]({'message':_0x2c194e['message']});}});function a0_0x2a69(){var _0xc655cc=['nodemailer','JO_number','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','note','prod_invoice','<tbody\x20style=\x22text-align:\x20center;\x22>','<html><head><title></title>','warehouse','warehouse_name','product_name','9RPOSkP','primary_code_hide','secondary_code_hide','Rack\x202','language','1uagcGw','product_code_hide','$unit','prod_unit','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','get','catch','production_date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','filter','stocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','all_purchases_barcode','role','$product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/barcode_scanner','max_product_unit','primary_code','$suppliers_docs','findOne','</td>','/give_payment/:id','/barcode/:id','QA\x20Warehouse','date','/view/:id','padStart','json','INCF-','floor','suppliers','return_qty','$return_data','prod_level','product_stock','$product_details.type','length','$product_details','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','invoice','edit_purchases_finished_view','English\x20(US)','$product_details.maxProducts','$product.bin','edit_purchases_finished','$due_amount','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/upload/','$date','success','$brand','</h5>','standard_unit','return_purchase_finished','createTransport','Email\x20sent\x20successfully','<table\x20style=\x22width:\x20100%\x20!important;\x22>','image','English','return_product','643704zMbOVe','getMonth','FGSEmail','quantity','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','room','POnumber','/view/return_purchase/:id','$batch_code','getFullYear','port','getDate','user','$invoice','flash','$product_details.secondary_code','<div>','paid_amount','aggregate','$_id','$product_code','expiry_date','amount','</body></html>','slice','back','body','$expiry_date','stock_data','product_date','$product.room_name','product_details','bay','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$suppliers','$product_details.bay','</div>','status','$product_details.storage','\x20Order\x20Date\x20:\x20','errors','$paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','../middleware/auth','post','findById','maxStocks','staff','prod_name','625080JEtfal','$product','<tr>','<!DOCTYPE\x20html>','purchase\x20data\x20add\x20successfully','currency_placement','1364312LtwvRr','Enclosed','$product_details.product_code','forEach','all_purchases_finished','MaxStocks_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','prod_Qty','Arabic','table\x20page','Chinese','random','$alertquantity','then','room_name','DRY\x20GOODS','$maxProdPerUnit','</tbody>','purchase_invoice','French','map','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','email','6462260Shcpqu','<hr\x20class=\x22my-3\x22>','batch_code','$product_details.floorlevel','819086CgUEqT','/all_purchases_finished/view','14UPxZXX','save','Finished\x20Goods','prod_cat','currency','Rack\x201','$product.quantity','prod_secondunit','suppliers_docs','</head><body>','prod_primunit','/view/add_purchases','</table>','Portuguese','stock_quantity','$product_details.rack','_id','$name','string','sendMail','Portuguese\x20(BR)','$maxStocks','purchase\x20data\x20update\x20successfully','$secondary_unit','find','$primary_code','$product_details.product_stock','maxperunit','concat','German','$product_details.bin','$warehouse_name','error','/../public','<span\x20style=\x22float:\x20right;\x22>','<strong>\x20Regards\x20</strong>','Arabic\x20(ae)','<h2>\x20','render','$secondary_code','<h5>','Ambient','</thead>','True','path','add_purchases\x20error','602780uulBZX','$note','FROZEN\x20GOODS','purchase_quantity','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','express','1439464SiwarT','product','../public/language/languages.json','due_amount','Enabled','site_title','params','Paid\x20For\x20Purchase','$product_details._id','secondary_unit','Spanish','secondary_code','</span>','master','exports','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','RoomAssign','prod_code','product_cat','Room_name','message','logo','$product.type','product_code','$product_details.product_name','name','abs','Logo.png','</tr>','level','Return\x20Goods','$room'];a0_0x2a69=function(){return _0xc655cc;};return a0_0x2a69();}function BayBinSelected(_0x257023,_0x2f7ae5){var _0x58751d=a0_0x1a6a75,_0xd5c611=[],_0x289550=[];if(_0x257023==_0x58751d(0x150)){switch(_0x2f7ae5){case _0x58751d(0x164):_0xd5c611=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x58751d(0xc6):_0xd5c611=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x289550=['DG'];}else{if(_0x257023==_0x58751d(0x95)){switch(_0x2f7ae5){case'Rack\x201':_0xd5c611=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0xd5c611=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x289550=['FG'];}}return{'levels':_0xd5c611,'identify':_0x289550};}async function getRandom8DigitNumber(){var _0x3a684c=a0_0x1a6a75;const _0x3d244c=0x989680,_0x419933=0x5f5e0ff,_0xd1484e=Math[_0x3a684c(0xe8)](Math[_0x3a684c(0x14c)]()*(_0x419933-_0x3d244c+0x1))+_0x3d244c;var _0x1e2818;const _0x6077c0=await purchases_finished[_0x3a684c(0xde)]({'invoice':_0x3a684c(0xe7)+_0xd1484e});return _0x6077c0&&_0x6077c0['length']>0x0?_0x1e2818=_0x3a684c(0xe7)+_0xd1484e:_0x1e2818=_0x3a684c(0xe7)+_0xd1484e,_0x1e2818;}router[a0_0x1a6a75(0xcf)](a0_0x1a6a75(0x16a),auth,async(_0x359b12,_0x1d3bed)=>{var _0x266c5e=a0_0x1a6a75;try{const {username:_0x26613e,email:_0x9a5e86,role:_0x2654e2}=_0x359b12[_0x266c5e(0x114)],_0x344c9d=_0x359b12[_0x266c5e(0x114)],_0x207a14=await profile[_0x266c5e(0xde)]({'email':_0x344c9d['email']}),_0x200ea6=await master_shop[_0x266c5e(0x7d)](),_0x186e23=await staff[_0x266c5e(0xde)]({'email':_0x344c9d[_0x266c5e(0x158)]}),_0x5bdcb3=await suppliers[_0x266c5e(0x7d)]({});let _0x52f757;if(_0x344c9d[_0x266c5e(0xd7)]==_0x266c5e(0x139)){const _0x4e8f1e=await staff[_0x266c5e(0xde)]({'email':_0x344c9d[_0x266c5e(0x158)]});_0x52f757=await warehouse[_0x266c5e(0x11a)]([{'$match':{'status':_0x266c5e(0x9d),'name':_0x4e8f1e[_0x266c5e(0xc0)],'warehouse_category':_0x266c5e(0x161)}},{'$group':{'_id':'$name','name':{'$first':_0x266c5e(0x76)}}}]);}else _0x52f757=await warehouse[_0x266c5e(0x11a)]([{'$match':{'status':_0x266c5e(0x9d),'warehouse_category':_0x266c5e(0x161),'name':{'$ne':_0x266c5e(0xe2)}}},{'$group':{'_id':_0x266c5e(0x76),'name':{'$first':_0x266c5e(0x76)}}}]);const _0x51aa31=await product[_0x266c5e(0x7d)]({}),_0x3666d1=await warehouse[_0x266c5e(0x7d)]({'status':_0x266c5e(0x9d)}),_0x25a39c=await purchases_finished[_0x266c5e(0x7d)]({}),_0x268014=_0x25a39c['length']+0x1,_0x58e25f=_0x266c5e(0xe7)+_0x268014['toString']()[_0x266c5e(0xe5)](0x5,'0');var _0x1bfed1=[_0x266c5e(0x8e),_0x266c5e(0x142)];if(_0x200ea6[0x0][_0x266c5e(0xc7)]==_0x266c5e(0xf5))var _0x5c4dd4=users['English'];else{if(_0x200ea6[0x0][_0x266c5e(0xc7)]=='Hindi')var _0x5c4dd4=users[_0x266c5e(0xf1)];else{if(_0x200ea6[0x0][_0x266c5e(0xc7)]==_0x266c5e(0x82))var _0x5c4dd4=users['German'];else{if(_0x200ea6[0x0][_0x266c5e(0xc7)]==_0x266c5e(0xa3))var _0x5c4dd4=users[_0x266c5e(0xa3)];else{if(_0x200ea6[0x0][_0x266c5e(0xc7)]=='French')var _0x5c4dd4=users[_0x266c5e(0x154)];else{if(_0x200ea6[0x0][_0x266c5e(0xc7)]==_0x266c5e(0x79))var _0x5c4dd4=users[_0x266c5e(0x72)];else{if(_0x200ea6[0x0][_0x266c5e(0xc7)]==_0x266c5e(0x14b))var _0x5c4dd4=users[_0x266c5e(0x14b)];else{if(_0x200ea6[0x0][_0x266c5e(0xc7)]==_0x266c5e(0x89))var _0x5c4dd4=users[_0x266c5e(0x149)];}}}}}}}const _0x5380d2=getRandom8DigitNumber();_0x5380d2[_0x266c5e(0x14e)](_0x5249ab=>{var _0x745d79=_0x266c5e;_0x1d3bed[_0x745d79(0x8b)]('add_purchases_finished',{'success':_0x359b12['flash']('success'),'errors':_0x359b12['flash'](_0x745d79(0x132)),'role':_0x344c9d,'profile':_0x207a14,'suppliers':_0x5bdcb3,'warehouse':_0x52f757,'product':_0x51aa31,'invoice':_0x5249ab,'master_shop':_0x200ea6,'language':_0x5c4dd4,'find_data':_0x3666d1,'rooms_data':_0x1bfed1});})[_0x266c5e(0xd0)](_0x57174e=>{var _0x56e4ec=_0x266c5e;_0x359b12[_0x56e4ec(0x116)]('errors',_0x56e4ec(0xd2)),_0x1d3bed[_0x56e4ec(0x129)](_0x56e4ec(0x15e));});}catch(_0x22a625){console[_0x266c5e(0xcc)](_0x22a625);}}),router['get']('/view/add_purchases/:id',auth,async(_0x5b28a9,_0x57751b)=>{var _0xa26a20=a0_0x1a6a75;try{const _0x27e5a2=_0x5b28a9[_0xa26a20(0x9f)]['id'];console['log'](_0x27e5a2);const _0x25045f=await master_shop['find']();console[_0xa26a20(0xcc)]('master',_0x25045f);const _0x2741b3=await product[_0xa26a20(0xde)]({'name':_0x27e5a2});console[_0xa26a20(0xcc)]('product',_0x2741b3),_0x57751b['status'](0xc8)['json']({'product_data':_0x2741b3,'master':_0x25045f});}catch(_0x38db03){console[_0xa26a20(0xcc)](_0xa26a20(0x92),_0x38db03);}}),router['post']('/view/add_purchases',auth,async(_0x20db64,_0x27bea1)=>{var _0x41cadd=a0_0x1a6a75;try{const {invoice:_0x50bc19,date:_0x495c4a,warehouse_name:_0x4eb1d2,prod_name:_0x23c120,prod_code:_0x4c7799,prod_qty:_0x1c3ccd,prod_unit:_0x19849b,prod_secondunit:_0x5b6022,prod_level:_0x259775,prod_isle:_0x105d2c,prod_pallet:_0x5f1715,note:_0x29bcba,expiry_date:_0x540bbf,batch_code:_0x2a259b,payable:_0x119ed0,due_amount:_0x26e0ef,Room_name:_0xbf67ae,primary_code:_0x4489ae,secondary_code:_0xdd0fb6,MaxStocks_data:_0x3bf7db,PO_number:_0x42b555,SCRN:_0x4fa628,JO_number:_0x5a6270}=_0x20db64['body'];if(typeof _0x23c120==_0x41cadd(0x77))var _0x3523eb=[_0x20db64['body'][_0x41cadd(0x13a)]],_0x20bb6f=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0xaa)]],_0x370d52=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0x148)]],_0x3f987a=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0x169)]],_0x2d784c=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0x166)]],_0x20b7ea=[_0x20db64[_0x41cadd(0x122)]['prod_level']],_0x4bb5bd=[_0x20db64['body'][_0x41cadd(0xdc)]],_0x5e839b=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0xa4)]],_0x413ea4=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0x146)]],_0x3bb781=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0x15b)]],_0x504880=[_0x20db64[_0x41cadd(0x122)]['expiry_date']],_0x5e7003=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0x125)]],_0xc8ecc7=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0xdb)]],_0x1a4cdc=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0x162)]],_0x409e26=[_0x20db64[_0x41cadd(0x122)][_0x41cadd(0xa9)]],_0x4b91c5=[_0x20db64['body'][_0x41cadd(0xbd)]];else var _0x3523eb=[..._0x20db64[_0x41cadd(0x122)][_0x41cadd(0x13a)]],_0x20bb6f=[..._0x20db64[_0x41cadd(0x122)][_0x41cadd(0xaa)]],_0x370d52=[..._0x20db64[_0x41cadd(0x122)][_0x41cadd(0x148)]],_0x3f987a=[..._0x20db64[_0x41cadd(0x122)][_0x41cadd(0x169)]],_0x2d784c=[..._0x20db64['body'][_0x41cadd(0x166)]],_0x20b7ea=[..._0x20db64[_0x41cadd(0x122)]['prod_level']],_0x4bb5bd=[..._0x20db64[_0x41cadd(0x122)]['primary_code']],_0x5e839b=[..._0x20db64[_0x41cadd(0x122)]['secondary_code']],_0x413ea4=[..._0x20db64[_0x41cadd(0x122)][_0x41cadd(0x146)]],_0x3bb781=[..._0x20db64[_0x41cadd(0x122)]['batch_code']],_0x504880=[..._0x20db64[_0x41cadd(0x122)][_0x41cadd(0x11d)]],_0x5e7003=[..._0x20db64['body'][_0x41cadd(0x125)]],_0xc8ecc7=[..._0x20db64['body'][_0x41cadd(0xdb)]],_0x1a4cdc=[..._0x20db64[_0x41cadd(0x122)]['prod_cat']],_0x409e26=[..._0x20db64['body'][_0x41cadd(0xa9)]],_0x4b91c5=[..._0x20db64[_0x41cadd(0x122)][_0x41cadd(0xbd)]];const _0x2aef67=_0x3523eb[_0x41cadd(0x155)](_0x10e21d=>{return _0x10e21d={'product_name':_0x10e21d};});_0x20bb6f['forEach']((_0xad78b6,_0x22cd93)=>{var _0xf4884=_0x41cadd;_0x2aef67[_0x22cd93][_0xf4884(0xb0)]=_0xad78b6;}),_0x370d52[_0x41cadd(0x144)]((_0x129496,_0x4396aa)=>{var _0x26ab5a=_0x41cadd;_0x2aef67[_0x4396aa][_0x26ab5a(0x10b)]=Math['abs'](_0x129496);}),_0x3f987a[_0x41cadd(0x144)]((_0x48b2e9,_0x1a87cf)=>{var _0x314558=_0x41cadd;_0x2aef67[_0x1a87cf][_0x314558(0x100)]=_0x48b2e9;}),_0x2d784c[_0x41cadd(0x144)]((_0x4c9e95,_0x8f1fc)=>{var _0x2e9fb9=_0x41cadd;_0x2aef67[_0x8f1fc][_0x2e9fb9(0xa2)]=_0x4c9e95;}),_0x20b7ea[_0x41cadd(0x144)]((_0x373dba,_0x2d20d1)=>{var _0x55019f=_0x41cadd;_0x2aef67[_0x2d20d1][_0x55019f(0x128)]=_0x373dba;}),_0x4bb5bd[_0x41cadd(0x144)]((_0x791e92,_0x211b7d)=>{var _0x362a91=_0x41cadd;_0x2aef67[_0x211b7d][_0x362a91(0xdc)]=_0x791e92;}),_0x5e839b[_0x41cadd(0x144)]((_0x52afed,_0x777e6b)=>{var _0xc591bf=_0x41cadd;_0x2aef67[_0x777e6b][_0xc591bf(0xa4)]=_0x52afed;}),_0x413ea4['forEach']((_0x7a2b06,_0x151907)=>{var _0xd03110=_0x41cadd;_0x2aef67[_0x151907][_0xd03110(0x138)]=_0x7a2b06;}),_0x3bb781[_0x41cadd(0x144)]((_0x46727f,_0x32a0f8)=>{_0x2aef67[_0x32a0f8]['batch_code']=_0x46727f;}),_0x504880[_0x41cadd(0x144)]((_0x1f600e,_0x28d370)=>{var _0x132922=_0x41cadd;_0x2aef67[_0x28d370][_0x132922(0x11d)]=_0x1f600e;}),_0x5e7003['forEach']((_0x267054,_0x6b414e)=>{var _0x21b78f=_0x41cadd;_0x2aef67[_0x6b414e][_0x21b78f(0xd1)]=_0x267054;}),_0xc8ecc7[_0x41cadd(0x144)]((_0x2a037a,_0x5a7932)=>{_0x2aef67[_0x5a7932]['maxperunit']=_0x2a037a;}),_0x1a4cdc['forEach']((_0x3f34da,_0x3c9712)=>{var _0x401611=_0x41cadd;_0x2aef67[_0x3c9712][_0x401611(0xab)]=_0x3f34da;}),_0x409e26[_0x41cadd(0x144)]((_0x27e991,_0x360c9b)=>{var _0x58d0d6=_0x41cadd;_0x2aef67[_0x360c9b][_0x58d0d6(0x14f)]=_0x27e991;}),_0x4b91c5[_0x41cadd(0x144)]((_0x32e665,_0x750ba2)=>{var _0xd7777f=_0x41cadd;_0x2aef67[_0x750ba2][_0xd7777f(0xf3)]=_0x32e665;});const _0x214b19=_0x2aef67[_0x41cadd(0xd3)](_0x54f26f=>_0x54f26f[_0x41cadd(0x10b)]!=='0'&&_0x54f26f[_0x41cadd(0x10b)]!==''),_0xa3839e=new purchases_finished({'invoice':_0x50bc19,'suppliers':_0x20db64[_0x41cadd(0x122)][_0x41cadd(0xe9)],'date':_0x495c4a,'warehouse_name':_0x4eb1d2,'product':_0x214b19,'note':_0x29bcba,'due_amount':_0x26e0ef,'room':_0xbf67ae,'POnumber':_0x42b555,'SCRN':_0x4fa628,'JO_number':_0x5a6270}),_0x9cc51a=await _0xa3839e[_0x41cadd(0x160)](),_0x12a381=await purchases_finished['findOne']({'invoice':_0x50bc19}),_0xe66c1c=_0x12a381[_0x41cadd(0x9a)]['map'](async _0x29a3ba=>{var _0x3ec164=_0x41cadd,_0x2176cc=await warehouse['findOne']({'name':_0x4eb1d2,'room':_0x29a3ba[_0x3ec164(0x14f)]}),_0x1ffee4=0x0;const _0x363a65=_0x2176cc[_0x3ec164(0x127)][_0x3ec164(0x155)](_0x1f1e98=>{var _0x5448eb=_0x3ec164;console['log'](_0x1f1e98['product_name']+'=='+_0x29a3ba[_0x5448eb(0xc2)]+'&&'+_0x1f1e98[_0x5448eb(0x128)]+'=='+_0x29a3ba['bay']+'&&'+_0x1f1e98[_0x5448eb(0x11d)]+'=='+_0x29a3ba[_0x5448eb(0x11d)]+'&&'+_0x1f1e98[_0x5448eb(0xd1)]+'=='+_0x29a3ba[_0x5448eb(0xd1)]+'&&'+_0x1f1e98[_0x5448eb(0x15b)]+'=='+_0x29a3ba['batch_code']+'&&'+_0x1f1e98['invoice']+'=='+_0x12a381[_0x5448eb(0xf3)]),_0x1f1e98[_0x5448eb(0xc2)]==_0x29a3ba[_0x5448eb(0xc2)]&&_0x1f1e98[_0x5448eb(0x128)]==_0x29a3ba['bay']&&_0x1f1e98[_0x5448eb(0x11d)]==_0x29a3ba['expiry_date']&&_0x1f1e98[_0x5448eb(0xd1)]==_0x29a3ba['production_date']&&_0x1f1e98[_0x5448eb(0x15b)]==_0x29a3ba['batch_code']&&_0x1f1e98[_0x5448eb(0xf3)]==_0x12a381[_0x5448eb(0xf3)]&&(_0x1f1e98[_0x5448eb(0xed)]=Math[_0x5448eb(0xb3)](_0x1f1e98[_0x5448eb(0xed)])+Math[_0x5448eb(0xb3)](_0x29a3ba[_0x5448eb(0x10b)]),_0x1ffee4++);});return _0x1ffee4=='0'&&(_0x2176cc[_0x3ec164(0x127)]=_0x2176cc['product_details']['concat']({'product_name':_0x29a3ba['product_name'],'product_stock':Math['abs'](_0x29a3ba[_0x3ec164(0x10b)]),'primary_code':_0x29a3ba[_0x3ec164(0xdc)],'secondary_code':_0x29a3ba['secondary_code'],'product_code':_0x29a3ba[_0x3ec164(0xb0)],'bay':_0x29a3ba[_0x3ec164(0x128)],'maxProducts':_0x29a3ba[_0x3ec164(0x138)],'unit':_0x29a3ba['standard_unit'],'secondary_unit':_0x29a3ba[_0x3ec164(0xa2)],'expiry_date':_0x29a3ba[_0x3ec164(0x11d)],'production_date':_0x29a3ba[_0x3ec164(0xd1)],'maxProducts':_0x29a3ba[_0x3ec164(0x138)],'maxPerUnit':_0x29a3ba[_0x3ec164(0x80)],'batch_code':_0x29a3ba[_0x3ec164(0x15b)],'product_cat':_0x29a3ba['product_cat'],'invoice':_0x29a3ba[_0x3ec164(0xf3)]})),_0x2176cc;});Promise['all'](_0xe66c1c)['then'](async _0x6341d1=>{var _0x28ffff=_0x41cadd;try{for(const _0xf05658 of _0x6341d1){await warehouse['updateOne']({'_id':_0xf05658[_0x28ffff(0x75)]},{'$addToSet':{'product_details':{'$each':_0xf05658[_0x28ffff(0x127)]}}});}const _0x2140d9=await master_shop[_0x28ffff(0x7d)](),_0x1b3347=await email_settings['findOne'](),_0x45c3f7=await supervisor_settings[_0x28ffff(0x7d)]();var _0x58eeb6=_0x12a381[_0x28ffff(0x9a)],_0x197f61='',_0x2786b8;for(_0x2786b8 in _0x58eeb6){var _0x26619b='FG';_0x12a381[_0x28ffff(0xc1)]=='DRY\x20GOODS'&&(_0x26619b='DG'),_0x197f61+=_0x28ffff(0x13d)+_0x28ffff(0xbb)+_0x58eeb6[_0x2786b8]['product_name']+_0x28ffff(0xdf)+_0x28ffff(0xbb)+_0x58eeb6[_0x2786b8][_0x28ffff(0xb0)]+_0x28ffff(0xdf)+_0x28ffff(0xbb)+_0x58eeb6[_0x2786b8][_0x28ffff(0x10b)]+'</td>'+_0x28ffff(0xbb)+_0x58eeb6[_0x2786b8][_0x28ffff(0x100)]+_0x28ffff(0xdf)+_0x28ffff(0xbb)+_0x58eeb6[_0x2786b8][_0x28ffff(0xa2)]+'</td>'+_0x28ffff(0xbb)+_0x12a381[_0x28ffff(0xc1)]+_0x28ffff(0xdf)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x58eeb6[_0x2786b8][_0x28ffff(0x14f)]+_0x28ffff(0xdf)+_0x28ffff(0xbb)+_0x26619b+_0x58eeb6[_0x2786b8]['bay']+_0x28ffff(0xdf),_0x28ffff(0xb5);}let _0x575479=nodemailer[_0x28ffff(0x102)]({'host':_0x1b3347['host'],'port':Number(_0x1b3347[_0x28ffff(0x112)]),'secure':![],'auth':{'user':_0x1b3347[_0x28ffff(0x158)],'pass':_0x1b3347['password']}}),_0x1038c8={'from':_0x1b3347[_0x28ffff(0x158)],'to':_0x45c3f7[0x0][_0x28ffff(0x10a)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x28ffff(0xb4),'path':__dirname+_0x28ffff(0x86)+_0x28ffff(0xfb)+_0x2140d9[0x0][_0x28ffff(0x105)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x28ffff(0xbf)+_0x28ffff(0x168)+_0x28ffff(0x118)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x28ffff(0x118)+_0x28ffff(0x10c)+_0x28ffff(0x12e)+_0x28ffff(0x118)+_0x28ffff(0x8a)+_0x2140d9[0x0]['site_title']+'\x20</h2>'+_0x28ffff(0x12e)+_0x28ffff(0x12e)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x28ffff(0x156)+'\x20Order\x20Number\x20:\x20'+_0x12a381[_0x28ffff(0xf3)]+'\x20'+_0x28ffff(0x87)+_0x28ffff(0x131)+_0x12a381[_0x28ffff(0xe3)]+'\x20'+'</span>'+_0x28ffff(0xff)+_0x28ffff(0x12e)+_0x28ffff(0x104)+_0x28ffff(0xfa)+_0x28ffff(0x13d)+_0x28ffff(0xcd)+_0x28ffff(0x157)+_0x28ffff(0xce)+_0x28ffff(0x147)+_0x28ffff(0x12b)+_0x28ffff(0x134)+_0x28ffff(0x12a)+_0x28ffff(0xd9)+_0x28ffff(0xb5)+_0x28ffff(0x8f)+_0x28ffff(0xbe)+'\x20'+_0x197f61+'\x20'+'</tbody>'+_0x28ffff(0x71)+'<div>'+_0x28ffff(0x88)+_0x28ffff(0x8d)+_0x2140d9[0x0][_0x28ffff(0x9e)]+_0x28ffff(0xff)+'</div>'+_0x28ffff(0x12e)+'</body></html>'};_0x575479[_0x28ffff(0x78)](_0x1038c8,function(_0x2ff5bb,_0x33c71a){var _0x3c9d42=_0x28ffff;_0x2ff5bb?(console[_0x3c9d42(0xcc)](_0x2ff5bb),console[_0x3c9d42(0xcc)]('Error\x20Occurs')):console[_0x3c9d42(0xcc)](_0x3c9d42(0x103));});}catch(_0x31ec36){console[_0x28ffff(0x85)](_0x31ec36),_0x27bea1[_0x28ffff(0x12f)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x31ec36[_0x28ffff(0xad)]});}})[_0x41cadd(0xd0)](_0x40460e=>{var _0x980cf3=_0x41cadd;console[_0x980cf3(0x85)](_0x40460e),_0x27bea1[_0x980cf3(0x12f)](0x1f4)[_0x980cf3(0xe6)]({'error':'An\x20error\x20occurred.'});}),_0x20db64[_0x41cadd(0x116)]('success',_0x41cadd(0x13f)),_0x27bea1['redirect'](_0x41cadd(0x15e));}catch(_0x5125b1){console[_0x41cadd(0xcc)](_0x5125b1);}}),router['get']('/preview/:id',auth,async(_0x35fecf,_0x3919fc)=>{var _0x5bc5d5=a0_0x1a6a75;try{const {username:_0x276378,email:_0x52ddbe,role:_0xd66c2d}=_0x35fecf[_0x5bc5d5(0x114)],_0x461cbc=_0x35fecf[_0x5bc5d5(0x114)],_0x34fb19=await profile[_0x5bc5d5(0xde)]({'email':_0x461cbc[_0x5bc5d5(0x158)]}),_0x5232ee=await master_shop['find'](),_0x4cd266=_0x35fecf[_0x5bc5d5(0x9f)]['id'],_0x7c4230=await purchases_finished[_0x5bc5d5(0x137)](_0x4cd266),_0x1b2966=await suppliers[_0x5bc5d5(0x7d)]({});let _0x5eeab2;if(_0x461cbc[_0x5bc5d5(0xd7)]==_0x5bc5d5(0x139)){const _0x284e35=await staff[_0x5bc5d5(0xde)]({'email':_0x461cbc['email']});_0x5eeab2=await warehouse[_0x5bc5d5(0x7d)]({'status':_0x5bc5d5(0x9d),'name':_0x284e35['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x5eeab2=await warehouse[_0x5bc5d5(0x11a)]([{'$match':{'status':_0x5bc5d5(0x9d),'warehouse_category':_0x5bc5d5(0x161)}},{'$group':{'_id':_0x5bc5d5(0x76),'name':{'$first':_0x5bc5d5(0x76)}}}]);const _0x1e1bf5=await product[_0x5bc5d5(0x7d)]({}),_0x196b26=BayBinSelected(_0x7c4230[_0x5bc5d5(0xc1)],_0x7c4230[_0x5bc5d5(0x10d)]);let _0x31707d=new Date(_0x7c4230[_0x5bc5d5(0x11d)]),_0x10fabf=('0'+_0x31707d[_0x5bc5d5(0x113)]())[_0x5bc5d5(0x120)](-0x2),_0x23f484=('0'+(_0x31707d['getMonth']()+0x1))[_0x5bc5d5(0x120)](-0x2),_0xa14ce7=_0x31707d['getFullYear'](),_0x53cb6f=_0xa14ce7+'-'+_0x23f484+'-'+_0x10fabf;if(_0x5232ee[0x0][_0x5bc5d5(0xc7)]==_0x5bc5d5(0xf5)){var _0x416312=users['English'];console[_0x5bc5d5(0xcc)](_0x416312);}else{if(_0x5232ee[0x0][_0x5bc5d5(0xc7)]=='Hindi')var _0x416312=users[_0x5bc5d5(0xf1)];else{if(_0x5232ee[0x0][_0x5bc5d5(0xc7)]=='German')var _0x416312=users[_0x5bc5d5(0x82)];else{if(_0x5232ee[0x0][_0x5bc5d5(0xc7)]==_0x5bc5d5(0xa3))var _0x416312=users[_0x5bc5d5(0xa3)];else{if(_0x5232ee[0x0]['language']=='French')var _0x416312=users[_0x5bc5d5(0x154)];else{if(_0x5232ee[0x0][_0x5bc5d5(0xc7)]==_0x5bc5d5(0x79))var _0x416312=users['Portuguese'];else{if(_0x5232ee[0x0][_0x5bc5d5(0xc7)]==_0x5bc5d5(0x14b))var _0x416312=users[_0x5bc5d5(0x14b)];else{if(_0x5232ee[0x0][_0x5bc5d5(0xc7)]==_0x5bc5d5(0x89))var _0x416312=users[_0x5bc5d5(0x149)];}}}}}}}_0x3919fc[_0x5bc5d5(0x8b)](_0x5bc5d5(0xf4),{'success':_0x35fecf[_0x5bc5d5(0x116)](_0x5bc5d5(0xfd)),'errors':_0x35fecf[_0x5bc5d5(0x116)](_0x5bc5d5(0x132)),'role':_0x461cbc,'profile':_0x34fb19,'purchases':_0x7c4230,'suppliers':_0x1b2966,'warehouse':_0x5eeab2,'product':_0x1e1bf5,'master_shop':_0x5232ee,'language':_0x416312,'ed_fullDate':_0x53cb6f,'dataSelected':_0x196b26});}catch(_0x29455b){console[_0x5bc5d5(0xcc)](_0x29455b);}}),router[a0_0x1a6a75(0xcf)](a0_0x1a6a75(0xe4),auth,async(_0x5a45da,_0x387eda)=>{var _0x59161a=a0_0x1a6a75;try{const {username:_0x4fd5a3,email:_0x156566,role:_0xb8ceae}=_0x5a45da[_0x59161a(0x114)],_0x4432fa=_0x5a45da['user'],_0x3d0cfe=await profile[_0x59161a(0xde)]({'email':_0x4432fa[_0x59161a(0x158)]}),_0x1b786e=await master_shop[_0x59161a(0x7d)](),_0xada830=_0x5a45da['params']['id'],_0x1d5895=await purchases_finished[_0x59161a(0x137)](_0xada830),_0x1d62b9=await suppliers[_0x59161a(0x7d)]({});let _0x539ac2;if(_0x4432fa[_0x59161a(0xd7)]=='staff'){const _0x155698=await staff['findOne']({'email':_0x4432fa[_0x59161a(0x158)]});_0x539ac2=await warehouse['find']({'status':_0x59161a(0x9d),'name':_0x155698[_0x59161a(0xc0)],'warehouse_category':_0x59161a(0x161)});}else _0x539ac2=await warehouse[_0x59161a(0x11a)]([{'$match':{'status':_0x59161a(0x9d),'warehouse_category':_0x59161a(0x161)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x26d9af=await product[_0x59161a(0x7d)]({}),_0x343946=BayBinSelected(_0x1d5895[_0x59161a(0xc1)],_0x1d5895[_0x59161a(0x10d)]);let _0x4f6ac3=new Date(_0x1d5895[_0x59161a(0x11d)]),_0x23206d=('0'+_0x4f6ac3[_0x59161a(0x113)]())[_0x59161a(0x120)](-0x2),_0x35810d=('0'+(_0x4f6ac3[_0x59161a(0x109)]()+0x1))['slice'](-0x2),_0x165342=_0x4f6ac3[_0x59161a(0x111)](),_0x4f3a17=_0x165342+'-'+_0x35810d+'-'+_0x23206d;if(_0x1b786e[0x0]['language']==_0x59161a(0xf5)){var _0x5bacbb=users[_0x59161a(0x106)];console[_0x59161a(0xcc)](_0x5bacbb);}else{if(_0x1b786e[0x0][_0x59161a(0xc7)]==_0x59161a(0xf1))var _0x5bacbb=users['Hindi'];else{if(_0x1b786e[0x0][_0x59161a(0xc7)]=='German')var _0x5bacbb=users[_0x59161a(0x82)];else{if(_0x1b786e[0x0][_0x59161a(0xc7)]==_0x59161a(0xa3))var _0x5bacbb=users[_0x59161a(0xa3)];else{if(_0x1b786e[0x0][_0x59161a(0xc7)]==_0x59161a(0x154))var _0x5bacbb=users[_0x59161a(0x154)];else{if(_0x1b786e[0x0][_0x59161a(0xc7)]=='Portuguese\x20(BR)')var _0x5bacbb=users[_0x59161a(0x72)];else{if(_0x1b786e[0x0][_0x59161a(0xc7)]==_0x59161a(0x14b))var _0x5bacbb=users[_0x59161a(0x14b)];else{if(_0x1b786e[0x0][_0x59161a(0xc7)]==_0x59161a(0x89))var _0x5bacbb=users[_0x59161a(0x149)];}}}}}}}_0x387eda[_0x59161a(0x8b)](_0x59161a(0xf8),{'success':_0x5a45da[_0x59161a(0x116)](_0x59161a(0xfd)),'errors':_0x5a45da['flash'](_0x59161a(0x132)),'role':_0x4432fa,'profile':_0x3d0cfe,'purchases':_0x1d5895,'suppliers':_0x1d62b9,'warehouse':_0x539ac2,'product':_0x26d9af,'master_shop':_0x1b786e,'language':_0x5bacbb,'ed_fullDate':_0x4f3a17,'dataSelected':_0x343946});}catch(_0x386916){console[_0x59161a(0xcc)](_0x386916);}}),router[a0_0x1a6a75(0x136)](a0_0x1a6a75(0xe4),auth,async(_0x30482e,_0x26fc7b)=>{var _0x430cd9=a0_0x1a6a75;try{const _0x191eb4=_0x30482e[_0x430cd9(0x9f)]['id'],_0x5875c7=await purchases_finished[_0x430cd9(0xde)]({'_id':_0x30482e[_0x430cd9(0x9f)]['id']}),_0x3e99d6=await warehouse[_0x430cd9(0xde)]({'name':_0x5875c7[_0x430cd9(0xc1)],'room':_0x5875c7['room']});_0x5875c7[_0x430cd9(0x9a)][_0x430cd9(0x144)](_0x1231f6=>{var _0x1bb40e=_0x430cd9;const _0xf0832d=_0x3e99d6[_0x1bb40e(0x127)][_0x1bb40e(0x155)](_0x400356=>{var _0x779e61=_0x1bb40e;_0x400356[_0x779e61(0xc2)]==_0x1231f6[_0x779e61(0xc2)]&&_0x400356[_0x779e61(0x128)]==_0x1231f6[_0x779e61(0x128)]&&(_0x400356[_0x779e61(0xed)]=parseInt(_0x400356[_0x779e61(0xed)])-parseInt(_0x1231f6[_0x779e61(0x10b)]));});}),await _0x3e99d6[_0x430cd9(0x160)]();const {invoice:_0x412a5a,suppliers:_0x1cded7,date:_0x2daa84,warehouse_name:_0x1e73ba,prod_name:_0x4a2702,prod_code:_0x4f6bbf,prod_qty:_0x496891,prod_unit:_0x1d5302,prod_secondunit:_0x4e4ad7,prod_level:_0x5d454a,prod_isle:_0x582dfb,prod_pallet:_0x1e7667,note:_0x1bb27c,expiry_date:_0x26cf4d,batch_code:_0x3f543a,paid_amount:_0x44a26e,due_amount:_0x50a3b7,Room_name:_0x16dec6,primary_code:_0x36d33a,secondary_code:_0x5b1799,PO_number:_0xbbe691,JO_number:_0x4ee1f7}=_0x30482e[_0x430cd9(0x122)];if(typeof _0x4a2702=='string')var _0x5e14e5=[_0x30482e[_0x430cd9(0x122)]['prod_name']],_0xdb4bb2=[_0x30482e['body']['prod_code']],_0x3ab68c=[_0x30482e['body']['prod_qty']],_0x5ac6eb=[_0x30482e[_0x430cd9(0x122)][_0x430cd9(0xcb)]],_0x3fc959=[_0x30482e['body'][_0x430cd9(0x166)]],_0x399c8b=[_0x30482e[_0x430cd9(0x122)][_0x430cd9(0xec)]],_0x365c28=[_0x30482e['body']['primary_code']],_0x2519f4=[_0x30482e[_0x430cd9(0x122)][_0x430cd9(0xa4)]],_0x1e1af6=[_0x30482e[_0x430cd9(0x122)][_0x430cd9(0x146)]],_0x4dffa8=[_0x30482e[_0x430cd9(0x122)][_0x430cd9(0x15b)]],_0x17cb18=[_0x30482e[_0x430cd9(0x122)][_0x430cd9(0x11d)]];else var _0x5e14e5=[..._0x30482e[_0x430cd9(0x122)][_0x430cd9(0x13a)]],_0xdb4bb2=[..._0x30482e[_0x430cd9(0x122)][_0x430cd9(0xaa)]],_0x3ab68c=[..._0x30482e[_0x430cd9(0x122)]['prod_qty']],_0x5ac6eb=[..._0x30482e[_0x430cd9(0x122)]['prod_unit']],_0x3fc959=[..._0x30482e[_0x430cd9(0x122)][_0x430cd9(0x166)]],_0x399c8b=[..._0x30482e['body']['prod_level']],_0x365c28=[..._0x30482e[_0x430cd9(0x122)][_0x430cd9(0xdc)]],_0x2519f4=[..._0x30482e[_0x430cd9(0x122)][_0x430cd9(0xa4)]],_0x1e1af6=[..._0x30482e[_0x430cd9(0x122)][_0x430cd9(0x146)]],_0x4dffa8=[..._0x30482e['body']['batch_code']],_0x17cb18=[..._0x30482e['body'][_0x430cd9(0x11d)]];const _0x271af1=_0x5e14e5[_0x430cd9(0x155)](_0x2c4449=>{return _0x2c4449={'product_name':_0x2c4449};});_0xdb4bb2[_0x430cd9(0x144)]((_0x31a266,_0x39631a)=>{_0x271af1[_0x39631a]['product_code']=_0x31a266;}),_0x3ab68c[_0x430cd9(0x144)]((_0x5e5583,_0x30d77f)=>{var _0x1d8af1=_0x430cd9;_0x271af1[_0x30d77f][_0x1d8af1(0x10b)]=_0x5e5583;}),_0x5ac6eb[_0x430cd9(0x144)]((_0x2a9386,_0xf9f5bc)=>{var _0x115302=_0x430cd9;_0x271af1[_0xf9f5bc][_0x115302(0x100)]=_0x2a9386;}),_0x3fc959[_0x430cd9(0x144)]((_0x16c31c,_0x177ecb)=>{_0x271af1[_0x177ecb]['secondary_unit']=_0x16c31c;}),_0x399c8b['forEach']((_0x10f3d7,_0x44ab17)=>{var _0x3633bc=_0x430cd9;_0x271af1[_0x44ab17][_0x3633bc(0x128)]=_0x10f3d7;}),_0x365c28['forEach']((_0x161048,_0x411c4e)=>{var _0x1458b6=_0x430cd9;_0x271af1[_0x411c4e][_0x1458b6(0xdc)]=_0x161048;}),_0x2519f4[_0x430cd9(0x144)]((_0x461a7e,_0x461890)=>{var _0x2637ed=_0x430cd9;_0x271af1[_0x461890][_0x2637ed(0xa4)]=_0x461a7e;}),_0x1e1af6[_0x430cd9(0x144)]((_0x1283e1,_0x2539dd)=>{_0x271af1[_0x2539dd]['maxStocks']=_0x1283e1;}),_0x4dffa8['forEach']((_0x16a8d9,_0x3f8889)=>{var _0x59a959=_0x430cd9;_0x271af1[_0x3f8889][_0x59a959(0x15b)]=_0x16a8d9;}),_0x17cb18[_0x430cd9(0x144)]((_0x1a5b11,_0x11e9b6)=>{var _0x5c3af0=_0x430cd9;_0x271af1[_0x11e9b6][_0x5c3af0(0x11d)]=_0x1a5b11;});const _0x514ffc=_0x271af1[_0x430cd9(0xd3)](_0x4fbef3=>_0x4fbef3[_0x430cd9(0x10b)]!=='0'&&_0x4fbef3[_0x430cd9(0x10b)]!=='');_0x5875c7[_0x430cd9(0xf3)]=_0x412a5a,_0x5875c7['suppliers']=_0x1cded7,_0x5875c7[_0x430cd9(0xe3)]=_0x2daa84,_0x5875c7[_0x430cd9(0xc1)]=_0x1e73ba,_0x5875c7[_0x430cd9(0x9a)]=_0x514ffc,_0x5875c7[_0x430cd9(0xbc)]=_0x1bb27c,_0x5875c7['paid_amount']=_0x44a26e,_0x5875c7[_0x430cd9(0x9c)]=_0x50a3b7,_0x5875c7['room']=_0x16dec6,_0x5875c7[_0x430cd9(0x10e)]=_0xbbe691,_0x5875c7[_0x430cd9(0xba)]=_0x4ee1f7;const _0x3e3422=await _0x5875c7[_0x430cd9(0x160)](),_0x31ccd8=await warehouse[_0x430cd9(0xde)]({'name':_0x30482e[_0x430cd9(0x122)]['warehouse_name'],'room':_0x30482e[_0x430cd9(0x122)][_0x430cd9(0xac)]});_0x5875c7[_0x430cd9(0x9a)][_0x430cd9(0x144)](_0x453f67=>{var _0xfa04d3=_0x430cd9,_0x226cf4=0x0;const _0x51cde4=_0x31ccd8['product_details'][_0xfa04d3(0x155)](_0x669d1a=>{var _0xd1a835=_0xfa04d3;_0x669d1a[_0xd1a835(0xc2)]==_0x453f67[_0xd1a835(0xc2)]&&_0x669d1a[_0xd1a835(0x128)]==_0x453f67[_0xd1a835(0x128)]&&(_0x669d1a[_0xd1a835(0xed)]=parseInt(_0x669d1a[_0xd1a835(0xed)])+parseInt(_0x453f67[_0xd1a835(0x10b)]),_0x226cf4++);});_0x226cf4=='0'&&(_0x31ccd8[_0xfa04d3(0x127)]=_0x31ccd8[_0xfa04d3(0x127)]['concat']({'product_name':_0x453f67[_0xfa04d3(0xc2)],'product_stock':_0x453f67['quantity'],'primary_code':_0x453f67['primary_code'],'secondary_code':_0x453f67[_0xfa04d3(0xa4)],'product_code':_0x453f67[_0xfa04d3(0xb0)],'bay':_0x453f67['bay'],'maxProducts':_0x453f67['maxStocks'],'unit':_0x453f67[_0xfa04d3(0x100)],'secondary_unit':_0x453f67[_0xfa04d3(0xa2)],'expiry_date':_0x453f67[_0xfa04d3(0x11d)]}));}),await _0x31ccd8[_0x430cd9(0x160)]();const _0xa4902c=await s_payment_data[_0x430cd9(0xde)]({'invoice':_0x30482e['body']['invoice']});if(_0xa4902c===null){}else console[_0x430cd9(0xcc)]('suppliers',_0xa4902c,_0x30482e['body'][_0x430cd9(0xf3)]),_0xa4902c[_0x430cd9(0xe9)]=_0x30482e[_0x430cd9(0x122)]['suppliers'],await _0xa4902c['save']();_0x30482e[_0x430cd9(0x116)](_0x430cd9(0xfd),_0x430cd9(0x7b)),_0x26fc7b[_0x430cd9(0x129)](_0x430cd9(0x15e));}catch(_0x476b7d){console[_0x430cd9(0xcc)](_0x476b7d);}}),router[a0_0x1a6a75(0x136)](a0_0x1a6a75(0xe0),auth,async(_0x433e88,_0x270767)=>{var _0x190d63=a0_0x1a6a75;try{const _0x2ad22d=_0x433e88[_0x190d63(0x9f)]['id'],{invoice:_0x184cac,suppliers:_0x28edd4,payable:_0x2a4bca,due_amount:_0x2c6615}=_0x433e88[_0x190d63(0x122)],_0xa4b3fa=await purchases[_0x190d63(0x137)](_0x2ad22d);var _0x2dd61c=_0x2a4bca-_0x2c6615;_0xa4b3fa[_0x190d63(0x119)]=parseFloat(_0xa4b3fa[_0x190d63(0x119)])+parseFloat(_0x2c6615),_0xa4b3fa[_0x190d63(0x9c)]=_0x2dd61c;const _0x36da0b=await _0xa4b3fa['save']();console[_0x190d63(0xcc)](_0x36da0b);const _0x521779=await s_payment_data[_0x190d63(0xde)]({'invoice':_0x184cac});_0x521779[_0x190d63(0x11e)]=_0x2dd61c,await _0x521779[_0x190d63(0x160)]();let _0x3d3d56=new Date(),_0x8eeb3a=('0'+_0x3d3d56[_0x190d63(0x113)]())[_0x190d63(0x120)](-0x2),_0x215448=('0'+(_0x3d3d56[_0x190d63(0x109)]()+0x1))['slice'](-0x2),_0x56c14d=_0x3d3d56[_0x190d63(0x111)](),_0x58f666=_0x56c14d+'-'+_0x215448+'-'+_0x8eeb3a;const _0x40b43f=new suppliers_payment({'invoice':_0x184cac,'date':_0x56c14d+'-'+_0x215448+'-'+_0x8eeb3a,'suppliers':_0x28edd4,'reason':_0x190d63(0xa0),'amount':_0x2c6615}),_0x231044=await _0x40b43f['save']();_0x433e88[_0x190d63(0x116)](_0x190d63(0xfd),'payment\x20successfull'),_0x270767[_0x190d63(0x129)]('/all_purchases/view');}catch(_0x35c487){console['log'](_0x35c487);}}),router['get']('/invoice/:id',auth,async(_0x511e52,_0x1652a7)=>{var _0x238123=a0_0x1a6a75;try{const {username:_0x184359,email:_0x52c650,role:_0x4f9c72}=_0x511e52[_0x238123(0x114)],_0xd4bd87=_0x511e52['user'],_0x965806=await profile[_0x238123(0xde)]({'email':_0xd4bd87[_0x238123(0x158)]}),_0x9f2fe3=await master_shop[_0x238123(0x7d)]();console['log'](_0x238123(0xa6),_0x9f2fe3);const _0x363407=_0x511e52[_0x238123(0x9f)]['id'],_0x3c75e2=await purchases[_0x238123(0x137)](_0x363407);console[_0x238123(0xcc)](_0x3c75e2);const _0x2e7033=await suppliers[_0x238123(0xde)]({'name':_0x3c75e2[_0x238123(0xe9)]});console[_0x238123(0xcc)](_0x2e7033);if(_0x9f2fe3[0x0][_0x238123(0xc7)]==_0x238123(0xf5)){var _0x44b2b6=users[_0x238123(0x106)];console[_0x238123(0xcc)](_0x44b2b6);}else{if(_0x9f2fe3[0x0][_0x238123(0xc7)]==_0x238123(0xf1))var _0x44b2b6=users[_0x238123(0xf1)];else{if(_0x9f2fe3[0x0]['language']==_0x238123(0x82))var _0x44b2b6=users[_0x238123(0x82)];else{if(_0x9f2fe3[0x0][_0x238123(0xc7)]==_0x238123(0xa3))var _0x44b2b6=users[_0x238123(0xa3)];else{if(_0x9f2fe3[0x0][_0x238123(0xc7)]=='French')var _0x44b2b6=users['French'];else{if(_0x9f2fe3[0x0][_0x238123(0xc7)]==_0x238123(0x79))var _0x44b2b6=users[_0x238123(0x72)];else{if(_0x9f2fe3[0x0]['language']==_0x238123(0x14b))var _0x44b2b6=users[_0x238123(0x14b)];else{if(_0x9f2fe3[0x0][_0x238123(0xc7)]==_0x238123(0x89))var _0x44b2b6=users[_0x238123(0x149)];}}}}}}}_0x1652a7[_0x238123(0x8b)](_0x238123(0x153),{'success':_0x511e52[_0x238123(0x116)](_0x238123(0xfd)),'errors':_0x511e52[_0x238123(0x116)]('errors'),'role':_0xd4bd87,'profile':_0x965806,'master_shop':_0x9f2fe3,'supplier':_0x2e7033,'purchase':_0x3c75e2,'language':_0x44b2b6});}catch(_0xff59e4){console['log'](_0xff59e4);}}),router[a0_0x1a6a75(0xcf)](a0_0x1a6a75(0x10f),auth,async(_0x409d50,_0x1650e8)=>{var _0x2c812b=a0_0x1a6a75;try{const {username:_0x53c765,email:_0x41a805,role:_0x51031c}=_0x409d50[_0x2c812b(0x114)],_0x282426=_0x409d50[_0x2c812b(0x114)],_0xd0113d=await profile[_0x2c812b(0xde)]({'email':_0x282426[_0x2c812b(0x158)]}),_0x50780b=await master_shop[_0x2c812b(0x7d)]();console['log'](_0x2c812b(0xa6),_0x50780b);const _0x23d562=_0x409d50['params']['id'];console[_0x2c812b(0xcc)](_0x23d562);const _0x2dc90d=await purchases_finished[_0x2c812b(0x137)](_0x23d562);console[_0x2c812b(0xcc)]('user_id',_0x2dc90d);const _0x841558=await product[_0x2c812b(0x7d)]({}),_0x207c24=await warehouse['aggregate']([{'$match':{'name':_0x2dc90d[_0x2c812b(0xc1)],'room':_0x2dc90d[_0x2c812b(0x10d)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2c812b(0xa1),'name':{'$first':_0x2c812b(0xb1)},'product_stock':{'$first':_0x2c812b(0x7f)},'bay':{'$first':_0x2c812b(0x12d)},'bin':{'$first':_0x2c812b(0x83)},'type':{'$first':_0x2c812b(0xee)},'floorlevel':{'$first':_0x2c812b(0x15c)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2c812b(0x117)},'product_code':{'$first':_0x2c812b(0x143)},'storage':{'$first':_0x2c812b(0x130)},'rack':{'$first':_0x2c812b(0x74)}}}]);console[_0x2c812b(0xcc)](_0x2c812b(0x124),_0x207c24);let _0x21c574;if(_0x282426[_0x2c812b(0xd7)]=='staff'){const _0x2c249f=await staff[_0x2c812b(0xde)]({'email':_0x282426[_0x2c812b(0x158)]});_0x21c574=await warehouse['find']({'status':_0x2c812b(0x9d),'name':_0x2c249f[_0x2c812b(0xc0)],'warehouse_category':'Finished\x20Goods','name':_0x2c812b(0xb7)});}else _0x21c574=await warehouse[_0x2c812b(0x11a)]([{'$match':{'status':_0x2c812b(0x9d),'warehouse_category':_0x2c812b(0x161),'name':_0x2c812b(0xb7)}},{'$group':{'_id':'$name','name':{'$first':_0x2c812b(0x76)}}}]);if(_0x50780b[0x0]['language']=='English\x20(US)'){var _0x55c938=users['English'];console['log'](_0x55c938);}else{if(_0x50780b[0x0][_0x2c812b(0xc7)]==_0x2c812b(0xf1))var _0x55c938=users[_0x2c812b(0xf1)];else{if(_0x50780b[0x0]['language']==_0x2c812b(0x82))var _0x55c938=users[_0x2c812b(0x82)];else{if(_0x50780b[0x0][_0x2c812b(0xc7)]==_0x2c812b(0xa3))var _0x55c938=users[_0x2c812b(0xa3)];else{if(_0x50780b[0x0]['language']==_0x2c812b(0x154))var _0x55c938=users[_0x2c812b(0x154)];else{if(_0x50780b[0x0][_0x2c812b(0xc7)]==_0x2c812b(0x79))var _0x55c938=users['Portuguese'];else{if(_0x50780b[0x0]['language']==_0x2c812b(0x14b))var _0x55c938=users['Chinese'];else{if(_0x50780b[0x0][_0x2c812b(0xc7)]==_0x2c812b(0x89))var _0x55c938=users['Arabic'];}}}}}}}_0x1650e8[_0x2c812b(0x8b)](_0x2c812b(0x101),{'success':_0x409d50['flash'](_0x2c812b(0xfd)),'errors':_0x409d50[_0x2c812b(0x116)](_0x2c812b(0x132)),'role':_0x282426,'profile':_0xd0113d,'user':_0x2dc90d,'stock':_0x207c24,'master_shop':_0x50780b,'product':_0x841558,'language':_0x55c938,'warehouse':_0x21c574});}catch(_0x3b038d){console['log'](_0x3b038d);}}),router[a0_0x1a6a75(0x136)](a0_0x1a6a75(0x10f),auth,async(_0x2c50f7,_0x28b292)=>{var _0x385696=a0_0x1a6a75;try{const {invoice:_0x4b4b92,date:_0x474556,warehouse_name:_0x2e3872,Room_name:_0xdc39f9,product_name:_0x2f743c,purchase_quantity:_0x5b2a30,stocks:_0x343a4a,return_qty:_0x12b73e,note:_0xf2efa1,level:_0x53243a,isle:_0x517781,pallet:_0x555e31,to_warehouse_name:_0x345697,to_Room_name:_0x43dade}=_0x2c50f7['body'],_0x4168ad=await purchases_finished[_0x385696(0xde)]({'_id':_0x2c50f7['params']['id']}),_0x59ee8e=await warehouse[_0x385696(0xde)]({'name':_0x2e3872,'room':_0xdc39f9,'warehouse_category':_0x385696(0x161)});if(typeof _0x2f743c==_0x385696(0x77))var _0x218bd5=[_0x2c50f7[_0x385696(0x122)][_0x385696(0xc2)]],_0x491e73=[_0x2c50f7[_0x385696(0x122)][_0x385696(0x96)]],_0x3df8b0=[_0x2c50f7[_0x385696(0x122)][_0x385696(0xd4)]],_0x2eb62c=[_0x2c50f7[_0x385696(0x122)]['return_qty']],_0x668260=[_0x2c50f7[_0x385696(0x122)][_0x385696(0xb6)]],_0x1dbe16=[_0x2c50f7['body'][_0x385696(0xc9)]],_0x16f05b=[_0x2c50f7[_0x385696(0x122)][_0x385696(0xc4)]],_0x259672=[_0x2c50f7[_0x385696(0x122)][_0x385696(0xc5)]];else var _0x218bd5=[..._0x2c50f7[_0x385696(0x122)][_0x385696(0xc2)]],_0x491e73=[..._0x2c50f7[_0x385696(0x122)][_0x385696(0x96)]],_0x3df8b0=[..._0x2c50f7[_0x385696(0x122)][_0x385696(0xd4)]],_0x2eb62c=[..._0x2c50f7[_0x385696(0x122)][_0x385696(0xea)]],_0x668260=[..._0x2c50f7[_0x385696(0x122)][_0x385696(0xb6)]],_0x1dbe16=[..._0x2c50f7['body'][_0x385696(0xc9)]],_0x16f05b=[..._0x2c50f7[_0x385696(0x122)][_0x385696(0xc4)]],_0x259672=[..._0x2c50f7['body']['secondary_code_hide']];const _0x37222b=_0x218bd5[_0x385696(0x155)](_0x2265f2=>{return _0x2265f2={'product_name':_0x2265f2};});_0x491e73[_0x385696(0x144)]((_0x3885df,_0x389fcd)=>{var _0x57c8d3=_0x385696;_0x37222b[_0x389fcd][_0x57c8d3(0x96)]=_0x3885df;}),_0x3df8b0['forEach']((_0x318696,_0x3f392c)=>{_0x37222b[_0x3f392c]['stock_quantity']=_0x318696;}),_0x2eb62c[_0x385696(0x144)]((_0x46e2e5,_0x1f06b8)=>{var _0xe8c423=_0x385696;_0x37222b[_0x1f06b8][_0xe8c423(0xea)]=_0x46e2e5;}),_0x668260[_0x385696(0x144)]((_0xeec34d,_0xaa0d06)=>{var _0x9c2351=_0x385696;_0x37222b[_0xaa0d06][_0x9c2351(0x128)]=_0xeec34d;}),_0x1dbe16[_0x385696(0x144)]((_0x403eee,_0x5e6191)=>{var _0x3517e0=_0x385696;_0x37222b[_0x5e6191][_0x3517e0(0xb0)]=_0x403eee;}),_0x16f05b[_0x385696(0x144)]((_0x61158c,_0x52ddc6)=>{var _0x35a355=_0x385696;_0x37222b[_0x52ddc6][_0x35a355(0xdc)]=_0x61158c;}),_0x259672[_0x385696(0x144)]((_0x2d3797,_0x2bee9a)=>{var _0x2217ae=_0x385696;_0x37222b[_0x2bee9a][_0x2217ae(0xa4)]=_0x2d3797;}),_0x37222b[_0x385696(0x144)](_0x288271=>{var _0x3a5883=_0x385696;console[_0x3a5883(0xcc)](_0x288271);const _0x25e358=_0x59ee8e['product_details'][_0x3a5883(0x155)](_0x222f3b=>{var _0x1a0936=_0x3a5883;_0x222f3b[_0x1a0936(0xc2)]==_0x288271['product_name']&&_0x222f3b[_0x1a0936(0x128)]==_0x288271[_0x1a0936(0x128)]&&(console[_0x1a0936(0xcc)](parseInt(_0x222f3b['product_stock'])+'\x20<>\x20'+parseInt(_0x288271[_0x1a0936(0xea)])),_0x222f3b[_0x1a0936(0xed)]=parseInt(_0x222f3b[_0x1a0936(0xed)])-parseInt(_0x288271['return_qty']));});}),await _0x59ee8e[_0x385696(0x160)]();var _0x5f00da=0x0;_0x37222b[_0x385696(0x144)](_0xef75a3=>{var _0x2936f7=_0x385696;(parseInt(_0xef75a3[_0x2936f7(0x96)])<parseInt(_0xef75a3[_0x2936f7(0xea)])||parseInt(_0xef75a3[_0x2936f7(0x73)])<parseInt(_0xef75a3[_0x2936f7(0xea)]))&&_0x5f00da++;});if(_0x5f00da!=0x0)return _0x2c50f7[_0x385696(0x116)]('errors',_0x385696(0xa8)),_0x28b292[_0x385696(0x129)](_0x385696(0x121));const _0x5a5190=new purchases_return_finished({'invoice':_0x4b4b92,'suppliers':_0x2c50f7[_0x385696(0x122)][_0x385696(0xe9)],'date':_0x474556,'warehouse_name':_0x2e3872,'return_product':_0x37222b,'note':_0xf2efa1,'room':_0xdc39f9,'to_warehouse_name':_0x345697,'to_room':_0x43dade}),_0x53ce9f=await _0x5a5190[_0x385696(0x160)](),_0x3681f9=await purchases_return_finished[_0x385696(0xde)]({'invoice':_0x4b4b92}),_0x457934=await warehouse[_0x385696(0xde)]({'name':_0x345697,'room':_0x43dade,'warehouse_category':'Finished\x20Goods'});_0x3681f9[_0x385696(0x107)][_0x385696(0x144)](_0x3d9e52=>{var _0x5861d4=_0x385696,_0x1cd8d3=0x0;const _0x551e65=_0x457934['product_details'][_0x5861d4(0x155)](_0x2c024d=>{var _0x3289aa=_0x5861d4;console[_0x3289aa(0xcc)](_0x2c024d[_0x3289aa(0xc2)]+'=='+_0x3d9e52['product_name']+'&&'+_0x2c024d[_0x3289aa(0x128)]+'=='+_0x3d9e52[_0x3289aa(0x128)]),_0x2c024d[_0x3289aa(0xc2)]==_0x3d9e52['product_name']&&_0x2c024d[_0x3289aa(0x128)]==_0x3d9e52[_0x3289aa(0x128)]&&(_0x2c024d[_0x3289aa(0xed)]=parseInt(_0x2c024d[_0x3289aa(0xed)])-parseInt(_0x3d9e52['return_qty']),_0x1cd8d3++);});_0x1cd8d3=='0'&&(_0x457934[_0x5861d4(0x127)]=_0x457934[_0x5861d4(0x127)][_0x5861d4(0x81)]({'product_name':_0x3d9e52['product_name'],'product_stock':_0x3d9e52[_0x5861d4(0xea)],'primary_code':_0x3d9e52[_0x5861d4(0xdc)],'secondary_code':_0x3d9e52['secondary_code'],'product_code':_0x3d9e52['product_code'],'bay':_0x3d9e52['bay'],'maxProducts':0xf423f}));}),await _0x457934[_0x385696(0x160)]();const _0x5d151c=await purchases_finished['findOne']({'invoice':_0x4b4b92});_0x5d151c['return_data']=_0x385696(0x90);const _0x22e4ec=await _0x5d151c[_0x385696(0x160)](),_0x6e3a88=new s_payment_data({'invoice':_0x4b4b92,'suppliers':_0x2c50f7['body'][_0x385696(0xe9)],'reason':'Purchase\x20Return'});await _0x6e3a88['save']();const _0x5cdaea=await master_shop['find'](),_0x3bad94=await email_settings[_0x385696(0xde)](),_0x2005cd=await suppliers[_0x385696(0xde)]({'name':_0x2c50f7[_0x385696(0x122)][_0x385696(0xe9)]});_0x5cdaea[0x0][_0x385696(0x140)]==0x1?(right_currency=_0x5cdaea[0x0][_0x385696(0x163)],left_currency=''):(right_currency='',left_currency=_0x5cdaea[0x0][_0x385696(0x163)]);var _0x293105=_0x218bd5,_0x2669e3=_0x2eb62c,_0x37d6f4='',_0x352768;for(_0x352768 in _0x293105){_0x37d6f4+=_0x385696(0x13d)+_0x385696(0xbb)+_0x293105[_0x352768]+_0x385696(0xdf)+_0x385696(0xbb)+_0x2669e3[_0x352768]+_0x385696(0xdf)+_0x385696(0xb5);}let _0x1b6e21=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x3bad94[_0x385696(0x158)],'pass':_0x3bad94['password']}}),_0x384b6a={'from':_0x3bad94['email'],'to':_0x2005cd[_0x385696(0x158)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x385696(0xb4),'path':__dirname+'/../public'+_0x385696(0xfb)+_0x5cdaea[0x0][_0x385696(0x105)],'cid':_0x385696(0xae)}],'html':_0x385696(0x13e)+_0x385696(0xbf)+_0x385696(0x168)+_0x385696(0x118)+_0x385696(0x97)+_0x385696(0x118)+_0x385696(0x10c)+_0x385696(0x12e)+_0x385696(0x118)+_0x385696(0x8a)+_0x5cdaea[0x0][_0x385696(0x9e)]+'\x20</h2>'+_0x385696(0x12e)+'</div>'+_0x385696(0x15a)+'<div>'+_0x385696(0x156)+'\x20Order\x20Number\x20:\x20'+_0x4b4b92+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x385696(0x131)+_0x474556+'\x20'+_0x385696(0xa5)+_0x385696(0xff)+_0x385696(0x12e)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x385696(0xfa)+'<tr>'+_0x385696(0xcd)+_0x385696(0xd5)+_0x385696(0xf2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x385696(0xb5)+_0x385696(0x8f)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x37d6f4+'\x20'+_0x385696(0x152)+'</table>'+_0x385696(0x118)+_0x385696(0x88)+'<h5>'+_0x5cdaea[0x0][_0x385696(0x9e)]+_0x385696(0xff)+_0x385696(0x12e)+_0x385696(0x12e)+_0x385696(0x11f)};_0x1b6e21[_0x385696(0x78)](_0x384b6a,function(_0x1f7dbf,_0x135512){var _0x3d35fa=_0x385696;_0x1f7dbf?console[_0x3d35fa(0xcc)]('Error\x20Occurs'):console[_0x3d35fa(0xcc)]('Email\x20sent\x20successfully');}),_0x2c50f7[_0x385696(0x116)](_0x385696(0xfd),'purchases\x20item\x20return\x20successfull'),_0x28b292[_0x385696(0x129)](_0x385696(0x15e));}catch(_0x4e5b40){_0x28b292[_0x385696(0x12f)](0xc8)[_0x385696(0xe6)]({'message':_0x4e5b40[_0x385696(0xad)]});}}),router[a0_0x1a6a75(0xcf)](a0_0x1a6a75(0xe1),auth,async(_0x28ec85,_0x29888c)=>{var _0x50d04a=a0_0x1a6a75;try{const {username:_0x13af25,email:_0x36b3b5,role:_0x22b5b1}=_0x28ec85[_0x50d04a(0x114)],_0x32ad71=_0x28ec85[_0x50d04a(0x114)],_0x2c19b2=await profile[_0x50d04a(0xde)]({'email':_0x32ad71[_0x50d04a(0x158)]}),_0x7ed79c=await master_shop['find'](),_0x3f3f32=_0x28ec85[_0x50d04a(0x9f)]['id'],_0x5a7648=await purchases_finished[_0x50d04a(0x137)](_0x3f3f32);if(_0x7ed79c[0x0]['language']=='English\x20(US)')var _0x329d73=users[_0x50d04a(0x106)];else{if(_0x7ed79c[0x0][_0x50d04a(0xc7)]=='Hindi')var _0x329d73=users['Hindi'];else{if(_0x7ed79c[0x0]['language']=='German')var _0x329d73=users[_0x50d04a(0x82)];else{if(_0x7ed79c[0x0][_0x50d04a(0xc7)]==_0x50d04a(0xa3))var _0x329d73=users['Spanish'];else{if(_0x7ed79c[0x0]['language']==_0x50d04a(0x154))var _0x329d73=users[_0x50d04a(0x154)];else{if(_0x7ed79c[0x0][_0x50d04a(0xc7)]==_0x50d04a(0x79))var _0x329d73=users[_0x50d04a(0x72)];else{if(_0x7ed79c[0x0][_0x50d04a(0xc7)]==_0x50d04a(0x14b))var _0x329d73=users['Chinese'];else{if(_0x7ed79c[0x0]['language']==_0x50d04a(0x89))var _0x329d73=users['Arabic'];}}}}}}}_0x29888c[_0x50d04a(0x8b)](_0x50d04a(0xd6),{'success':_0x28ec85[_0x50d04a(0x116)](_0x50d04a(0xfd)),'errors':_0x28ec85['flash'](_0x50d04a(0x132)),'role':_0x32ad71,'profile':_0x2c19b2,'alldata':_0x5a7648,'master_shop':_0x7ed79c,'language':_0x329d73}),console[_0x50d04a(0xcc)](alldata);}catch(_0x7cfe3e){console[_0x50d04a(0xcc)](_0x7cfe3e);}}),router[a0_0x1a6a75(0x136)](a0_0x1a6a75(0xda),async(_0x42a8e4,_0x5e6e4c)=>{var _0x9e341e=a0_0x1a6a75;const {product_code:_0x4f1b66}=_0x42a8e4[_0x9e341e(0x122)];var _0x94fc4;const _0x24f7cd=await product[_0x9e341e(0x11a)]([{'$match':{'primary_code':_0x4f1b66,'product_category':_0x9e341e(0x161)}},{'$group':{'_id':_0x9e341e(0x11b),'name':{'$first':_0x9e341e(0x76)},'category':{'$first':'$category'},'brand':{'$first':_0x9e341e(0xfe)},'unit':{'$first':_0x9e341e(0xca)},'alertquantity':{'$first':_0x9e341e(0x14d)},'product_code':{'$first':_0x9e341e(0x11c)},'primary_code':{'$first':_0x9e341e(0x7e)},'secondary_code':{'$first':_0x9e341e(0x8c)},'maxStocks':{'$first':_0x9e341e(0x7a)},'maxProdPerUnit':{'$first':_0x9e341e(0x151)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x9e341e(0x7c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x34bf1a=await product[_0x9e341e(0x11a)]([{'$match':{'secondary_code':_0x4f1b66}},{'$group':{'_id':'$_id','name':{'$first':_0x9e341e(0x76)},'category':{'$first':'$category'},'brand':{'$first':_0x9e341e(0xfe)},'unit':{'$first':_0x9e341e(0xca)},'alertquantity':{'$first':_0x9e341e(0x14d)},'product_code':{'$first':_0x9e341e(0x11c)},'primary_code':{'$first':_0x9e341e(0x7e)},'secondary_code':{'$first':_0x9e341e(0x8c)},'maxStocks':{'$first':_0x9e341e(0x7a)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x24f7cd['length']>0x0)_0x94fc4=_0x24f7cd;else _0x34bf1a[_0x9e341e(0xef)]>0x0&&(_0x94fc4=_0x34bf1a);_0x5e6e4c[_0x9e341e(0xe6)](_0x94fc4);}),router['post']('/CheckingWarehouse',async(_0x55040e,_0x3fb9a3)=>{var _0x1a0800=a0_0x1a6a75;const {productCode:_0x52d28f,bay:_0x1b4366,warehouses:_0x3d07a0,room:_0x3304ed}=_0x55040e['body'];console[_0x1a0800(0xcc)](_0x55040e[_0x1a0800(0x122)]);try{const _0x3a1054=await warehouse[_0x1a0800(0x11a)]([{'$match':{'name':_0x3d07a0,'room':_0x3304ed}},{'$unwind':_0x1a0800(0xf0)},{'$match':{'product_details.bay':parseInt(_0x1b4366)}},{'$group':{'_id':_0x1a0800(0xa1),'name':{'$first':_0x1a0800(0xb1)},'product_stock':{'$first':_0x1a0800(0x7f)},'bay':{'$first':_0x1a0800(0x12d)},'maxProducts':{'$first':_0x1a0800(0xf6)}}}]);_0x3fb9a3[_0x1a0800(0x12f)](0xc8)[_0x1a0800(0xe6)](_0x3a1054);}catch(_0x5e6ba6){_0x3fb9a3['status'](0x194)['json']({'message':_0x5e6ba6[_0x1a0800(0xad)]});}}),module[a0_0x1a6a75(0xa7)]=router;