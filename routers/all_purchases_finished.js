function a0_0x3d7a(){var _0xb7e5d3=['/CheckingWarehouse','prod_secondunit','$maxStocks','warehouse_name','12IGoQhO','$expiry_date','/barcode_scanner','prod_Qty','French','$date','staff','Arabic','\x20Order\x20Number\x20:\x20','<h5>','4nxmTwJ','all_purchases_finished','\x20Order\x20Date\x20:\x20','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','7qczYrP','/preview/:id','abs','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Hindi','errors','image','level','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','language','payment\x20successfull','log','Rack\x202','$product_details.bin','$product_details.product_name','FROZEN\x20GOODS','all_purchases_barcode','primary_code_hide','Purchase\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','German','$product.floorlevel','<tbody\x20style=\x22text-align:\x20center;\x22>','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','</thead>','Purchase\x20Return\x20Mail','flash','secondary_code_hide','render','<!DOCTYPE\x20html>','site_title','$suppliers','708346eOHzCQ','/view/return_purchase/:id','Arabic\x20(ae)','</td>','65845mjWcsR','prod_unit','prod_primunit','currency','password','</tr>','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','table\x20page','$secondary_unit','$product_details.product_stock','role','$return_data','email','floor','Enclosed','<span\x20style=\x22float:\x20right;\x22>','post','path','success','slice','INCF-','paid_amount','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','quantity','/view','purchase\x20data\x20update\x20successfully','Chinese','get','24PBEfqD','$product.room_name','Email\x20sent\x20successfully','bay','warehouse','stock_data','Portuguese','906735UTVxev','$product_details.rack','\x20<>\x20','findOne','purchase\x20data\x20add\x20successfully','map','findById','find','ejs','product_cat','params','prod_name','name','product','$paid_amount','product_name','sendMail','<tr>','</div>','$brand','secondary_unit','$product_details.product_code','return_product','<hr\x20class=\x22my-3\x22>','\x20</h2>','prod_code','nodemailer','<h2>\x20','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</table>','$product_details.secondary_code','getDate','/all_purchases_finished/view','product_code_hide','</body></html>','../public/language/languages.json','/view/add_purchases/:id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','273250gMkcQP','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','save','getMonth','$product','message','suppliers_docs','host','Enabled','filter','$product_code','1SNXzeR','prod_cat','return_purchase_finished','Ambient','Error\x20occurred\x20while\x20processing\x20product:','body','error','DRY\x20GOODS','purchase_quantity','8834WwcQIJ','</tbody>','back','$product.bay','updateOne','amount','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','prod_qty','prod_level','product_date','$warehouse_name','JO_number','5851456ilALyJ','</h5>','add_purchases\x20error','redirect','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$name','Router','4828615uiMZQT','return_qty','Paid\x20For\x20Purchase','express','Logo.png','$product.type','Room_name','$unit','$primary_code','purchases\x20item\x20return\x20successfull','../middleware/auth','/upload/','product_code','$product_details.storage','Purchase\x20Return','product_stock','261YCpwmj','MaxStocks_data','$maxProdPerUnit','return_data','stocks','suppliers','/view/add_purchases','$alertquantity','$_id','note','status','FGSEmail','then','Rack\x201','$product_details._id','$product_details.bay','<h5\x20style=\x22text-align:\x20left;\x22>','$product.bin','port','catch','room_name','primary_code','/view/:id','$product_details.type','invoice','createTransport','currency_placement','toString','max_product_unit','<html><head><title></title>','Spanish','$secondary_code','An\x20error\x20occurred\x20while\x20saving\x20data.','$suppliers_docs','879930DlrEMt','user','getFullYear','aggregate','$due_amount','edit_purchases_finished_view','Error\x20Occurs','standard_unit','json','date','$category','_id','English\x20(US)','maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','room','stock_quantity','string','<strong>\x20Regards\x20</strong>','$product_details.floorlevel','purchase_invoice','batch_code','maxperunit','$room','Return\x20Goods','/../public','$product_details','date_data','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</span>','logo','product_details','length','due_amount','$note','../models/all_models','add_purchases_finished','edit_purchases_finished','prod_invoice','production_date','/invoice/:id','<div>','$product.quantity'];a0_0x3d7a=function(){return _0xb7e5d3;};return a0_0x3d7a();}var a0_0x2ba444=a0_0x43a7;(function(_0x51238c,_0x1bd0ab){var _0x3a925d=a0_0x43a7,_0xc6b4f=_0x51238c();while(!![]){try{var _0x2b7f62=-parseInt(_0x3a925d(0x160))/0x1*(-parseInt(_0x3a925d(0x211))/0x2)+-parseInt(_0x3a925d(0x1b1))/0x3*(parseInt(_0x3a925d(0x1ea))/0x4)+-parseInt(_0x3a925d(0x12d))/0x5*(parseInt(_0x3a925d(0x1e0))/0x6)+-parseInt(_0x3a925d(0x1ee))/0x7*(parseInt(_0x3a925d(0x177))/0x8)+-parseInt(_0x3a925d(0x18f))/0x9*(parseInt(_0x3a925d(0x154))/0xa)+parseInt(_0x3a925d(0x17f))/0xb*(-parseInt(_0x3a925d(0x126))/0xc)+parseInt(_0x3a925d(0x108))/0xd*(parseInt(_0x3a925d(0x169))/0xe);if(_0x2b7f62===_0x1bd0ab)break;else _0xc6b4f['push'](_0xc6b4f['shift']());}catch(_0x3faa7b){_0xc6b4f['push'](_0xc6b4f['shift']());}}}(a0_0x3d7a,0x7836d));const express=require(a0_0x2ba444(0x182)),app=express(),router=express[a0_0x2ba444(0x17e)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x2ba444(0x1d4)),auth=require(a0_0x2ba444(0x189)),nodemailer=require(a0_0x2ba444(0x147));var ejs=require(a0_0x2ba444(0x135));const path=require(a0_0x2ba444(0x11a)),users=require(a0_0x2ba444(0x151));router['get'](a0_0x2ba444(0x122),auth,async(_0x21ba06,_0x4582be)=>{var _0x14a332=a0_0x2ba444;try{const {username:_0x526b9e,email:_0x3c94e7,role:_0x314327}=_0x21ba06[_0x14a332(0x1b2)],_0xd57997=_0x21ba06['user'],_0x39f089=await profile['findOne']({'email':_0xd57997['email']}),_0x40ba30=await staff[_0x14a332(0x130)]({'email':_0xd57997[_0x14a332(0x115)]});if(_0xd57997['role']==_0x14a332(0x1e6)){const _0x52bd4f=await staff['findOne']({'email':_0xd57997[_0x14a332(0x115)]});}const _0x6ed2c0=await master_shop[_0x14a332(0x134)]();let _0x5b8a12;if(_0xd57997[_0x14a332(0x113)]=='staff'){const _0x293207=await staff['findOne']({'email':_0xd57997[_0x14a332(0x115)]});_0x5b8a12=await purchases_finished[_0x14a332(0x1b4)]([{'$match':{'warehouse_name':_0x293207['warehouse']}},{'$lookup':{'from':'suppliers','localField':_0x14a332(0x194),'foreignField':_0x14a332(0x139),'as':_0x14a332(0x15b)}},{'$unwind':_0x14a332(0x1b0)},{'$unwind':_0x14a332(0x159)},{'$group':{'_id':_0x14a332(0x197),'invoice':{'$first':_0x14a332(0x11f)},'suppliers':{'$first':_0x14a332(0x210)},'date':{'$first':_0x14a332(0x1e5)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x14a332(0x1c8)},'product':{'$push':_0x14a332(0x159)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x14a332(0x13b)},'due_amount':{'$first':_0x14a332(0x1b5)},'return_data':{'$first':_0x14a332(0x114)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x14a332(0x1e1)},'suppliers_docs':{'$first':_0x14a332(0x1b0)},'total_product_quantity':{'$sum':_0x14a332(0x1db)},'level':{'$addToSet':_0x14a332(0x16c)},'isle':{'$addToSet':_0x14a332(0x1a0)},'type':{'$addToSet':_0x14a332(0x184)},'floorlevel':{'$addToSet':_0x14a332(0x205)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5b8a12=await purchases_finished[_0x14a332(0x1b4)]([{'$unwind':_0x14a332(0x159)},{'$group':{'_id':_0x14a332(0x197),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x14a332(0x1e5)},'warehouse_name':{'$first':_0x14a332(0x175)},'room':{'$addToSet':_0x14a332(0x127)},'product':{'$push':_0x14a332(0x159)},'note':{'$first':_0x14a332(0x1d3)},'paid_amount':{'$first':_0x14a332(0x13b)},'due_amount':{'$first':_0x14a332(0x1b5)},'return_data':{'$first':_0x14a332(0x114)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x14a332(0x1e1)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x14a332(0x1db)},'level':{'$addToSet':_0x14a332(0x16c)},'isle':{'$addToSet':_0x14a332(0x1a0)},'type':{'$addToSet':_0x14a332(0x184)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x6ed2c0[0x0][_0x14a332(0x1f9)]==_0x14a332(0x1bd))var _0x189e39=users[_0x14a332(0x207)];else{if(_0x6ed2c0[0x0][_0x14a332(0x1f9)]==_0x14a332(0x1f3))var _0x189e39=users['Hindi'];else{if(_0x6ed2c0[0x0]['language']==_0x14a332(0x204))var _0x189e39=users[_0x14a332(0x204)];else{if(_0x6ed2c0[0x0][_0x14a332(0x1f9)]==_0x14a332(0x1ad))var _0x189e39=users[_0x14a332(0x1ad)];else{if(_0x6ed2c0[0x0][_0x14a332(0x1f9)]==_0x14a332(0x1e4))var _0x189e39=users[_0x14a332(0x1e4)];else{if(_0x6ed2c0[0x0][_0x14a332(0x1f9)]==_0x14a332(0x17b))var _0x189e39=users[_0x14a332(0x12c)];else{if(_0x6ed2c0[0x0]['language']==_0x14a332(0x124))var _0x189e39=users[_0x14a332(0x124)];else{if(_0x6ed2c0[0x0]['language']==_0x14a332(0x213))var _0x189e39=users['Arabic'];}}}}}}}_0x4582be[_0x14a332(0x20d)](_0x14a332(0x1eb),{'success':_0x21ba06[_0x14a332(0x20b)](_0x14a332(0x11b)),'errors':_0x21ba06[_0x14a332(0x20b)]('errors'),'purchases':_0x5b8a12,'role':_0xd57997,'profile':_0x39f089,'master_shop':_0x6ed2c0,'language':_0x189e39});}catch(_0x3d43f9){console['log'](_0x14a332(0x110),_0x3d43f9),_0x4582be['status'](0xc8)[_0x14a332(0x1b9)]({'message':_0x3d43f9[_0x14a332(0x15a)]});}});function a0_0x43a7(_0x483b6d,_0x38dcda){var _0x3d7af3=a0_0x3d7a();return a0_0x43a7=function(_0x43a732,_0xf0c463){_0x43a732=_0x43a732-0x108;var _0x3f2450=_0x3d7af3[_0x43a732];return _0x3f2450;},a0_0x43a7(_0x483b6d,_0x38dcda);}function BayBinSelected(_0x425c8a,_0x41e4af){var _0x468600=a0_0x2ba444,_0x174601=[],_0x136acb=[];if(_0x425c8a==_0x468600(0x167)){switch(_0x41e4af){case _0x468600(0x19c):_0x174601=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x174601=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x136acb=['DG'];}else{if(_0x425c8a==_0x468600(0x1ff)){switch(_0x41e4af){case'Rack\x201':_0x174601=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x468600(0x1fc):_0x174601=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x136acb=['FG'];}}return{'levels':_0x174601,'identify':_0x136acb};}async function getRandom8DigitNumber(){var _0x510253=a0_0x2ba444;const _0xe60d5c=0x989680,_0x4da1d7=0x5f5e0ff,_0x23d539=Math[_0x510253(0x116)](Math['random']()*(_0x4da1d7-_0xe60d5c+0x1))+_0xe60d5c;var _0x28e43a;const _0x221de3=await purchases_finished[_0x510253(0x130)]({'invoice':'INCF-'+_0x23d539});return _0x221de3&&_0x221de3[_0x510253(0x1d1)]>0x0?_0x28e43a=_0x510253(0x11d)+_0x23d539:_0x28e43a=_0x510253(0x11d)+_0x23d539,_0x28e43a;}router[a0_0x2ba444(0x125)](a0_0x2ba444(0x195),auth,async(_0x50633e,_0x59ca8b)=>{var _0x543087=a0_0x2ba444;try{const {username:_0x19aae1,email:_0x36d62d,role:_0x1f44cf}=_0x50633e[_0x543087(0x1b2)],_0x2724f3=_0x50633e[_0x543087(0x1b2)],_0x28cec0=await profile['findOne']({'email':_0x2724f3['email']}),_0xe2c4ae=await master_shop[_0x543087(0x134)](),_0x5098fb=await staff[_0x543087(0x130)]({'email':_0x2724f3['email']}),_0x241a05=await suppliers[_0x543087(0x134)]({});let _0x5a4005;if(_0x2724f3[_0x543087(0x113)]==_0x543087(0x1e6)){const _0x144fec=await staff[_0x543087(0x130)]({'email':_0x2724f3[_0x543087(0x115)]});_0x5a4005=await warehouse['aggregate']([{'$match':{'status':_0x543087(0x15d),'name':_0x144fec[_0x543087(0x12a)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x543087(0x17d),'name':{'$first':_0x543087(0x17d)}}}]);}else _0x5a4005=await warehouse[_0x543087(0x1b4)]([{'$match':{'status':'Enabled','warehouse_category':_0x543087(0x155),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x543087(0x17d)}}}]);const _0x109dbb=await product[_0x543087(0x134)]({}),_0x169fc7=await warehouse[_0x543087(0x134)]({'status':_0x543087(0x15d)}),_0x3b13e5=await purchases_finished['find']({}),_0x572d49=_0x3b13e5[_0x543087(0x1d1)]+0x1,_0x23ee1c=_0x543087(0x11d)+_0x572d49[_0x543087(0x1aa)]()['padStart'](0x5,'0');var _0x4b50e8=[_0x543087(0x163),_0x543087(0x117)];if(_0xe2c4ae[0x0][_0x543087(0x1f9)]=='English\x20(US)')var _0x754e9c=users[_0x543087(0x207)];else{if(_0xe2c4ae[0x0][_0x543087(0x1f9)]==_0x543087(0x1f3))var _0x754e9c=users['Hindi'];else{if(_0xe2c4ae[0x0]['language']==_0x543087(0x204))var _0x754e9c=users[_0x543087(0x204)];else{if(_0xe2c4ae[0x0][_0x543087(0x1f9)]==_0x543087(0x1ad))var _0x754e9c=users['Spanish'];else{if(_0xe2c4ae[0x0][_0x543087(0x1f9)]==_0x543087(0x1e4))var _0x754e9c=users['French'];else{if(_0xe2c4ae[0x0][_0x543087(0x1f9)]==_0x543087(0x17b))var _0x754e9c=users[_0x543087(0x12c)];else{if(_0xe2c4ae[0x0][_0x543087(0x1f9)]==_0x543087(0x124))var _0x754e9c=users[_0x543087(0x124)];else{if(_0xe2c4ae[0x0][_0x543087(0x1f9)]=='Arabic\x20(ae)')var _0x754e9c=users[_0x543087(0x1e7)];}}}}}}}const _0x235358=getRandom8DigitNumber();_0x235358['then'](_0x4e4bb7=>{var _0x33e219=_0x543087;_0x59ca8b[_0x33e219(0x20d)](_0x33e219(0x1d5),{'success':_0x50633e[_0x33e219(0x20b)]('success'),'errors':_0x50633e[_0x33e219(0x20b)](_0x33e219(0x1f4)),'role':_0x2724f3,'profile':_0x28cec0,'suppliers':_0x241a05,'warehouse':_0x5a4005,'product':_0x109dbb,'invoice':_0x4e4bb7,'master_shop':_0xe2c4ae,'language':_0x754e9c,'find_data':_0x169fc7,'rooms_data':_0x4b50e8});})[_0x543087(0x1a2)](_0xc27a32=>{var _0x188698=_0x543087;_0x50633e[_0x188698(0x20b)]('errors',_0x188698(0x1f1)),_0x59ca8b[_0x188698(0x17a)](_0x188698(0x14e));});}catch(_0x24192d){console[_0x543087(0x1fb)](_0x24192d);}}),router[a0_0x2ba444(0x125)](a0_0x2ba444(0x152),auth,async(_0x4916d6,_0x44650e)=>{var _0x1b6c07=a0_0x2ba444;try{const _0x11e812=_0x4916d6['params']['id'];console[_0x1b6c07(0x1fb)](_0x11e812);const _0x495a09=await master_shop[_0x1b6c07(0x134)]();console[_0x1b6c07(0x1fb)](_0x1b6c07(0x1f7),_0x495a09);const _0x187552=await product[_0x1b6c07(0x130)]({'name':_0x11e812});console[_0x1b6c07(0x1fb)](_0x1b6c07(0x13a),_0x187552),_0x44650e[_0x1b6c07(0x199)](0xc8)[_0x1b6c07(0x1b9)]({'product_data':_0x187552,'master':_0x495a09});}catch(_0x1c8229){console[_0x1b6c07(0x1fb)](_0x1b6c07(0x179),_0x1c8229);}}),router[a0_0x2ba444(0x119)](a0_0x2ba444(0x195),auth,async(_0xaef92e,_0x2ac833)=>{var _0x2add75=a0_0x2ba444;try{const {invoice:_0x54f0a5,date:_0xc031fd,warehouse_name:_0xadce8b,prod_name:_0x2ee14f,prod_code:_0x413c72,prod_qty:_0x306954,prod_unit:_0x4b9f2b,prod_secondunit:_0x269086,prod_level:_0x48addf,prod_isle:_0x1e09d7,prod_pallet:_0x3eda9d,note:_0xf4a6e7,expiry_date:_0x2fba57,batch_code:_0x5a56b0,payable:_0x22802d,due_amount:_0xc1b6f6,Room_name:_0x4bf324,primary_code:_0x5d4422,secondary_code:_0x3012ed,MaxStocks_data:_0x5ab341,PO_number:_0x259826,SCRN:_0x4d13a7,JO_number:_0x174233}=_0xaef92e[_0x2add75(0x165)];if(typeof _0x2ee14f==_0x2add75(0x1c2))var _0x15269c=[_0xaef92e[_0x2add75(0x165)][_0x2add75(0x138)]],_0x50a064=[_0xaef92e[_0x2add75(0x165)]['prod_code']],_0x4a7377=[_0xaef92e[_0x2add75(0x165)][_0x2add75(0x1e3)]],_0x4f6582=[_0xaef92e[_0x2add75(0x165)][_0x2add75(0x10a)]],_0x57ff5d=[_0xaef92e[_0x2add75(0x165)][_0x2add75(0x1dd)]],_0x6d6b23=[_0xaef92e['body']['prod_level']],_0x5c2b06=[_0xaef92e[_0x2add75(0x165)][_0x2add75(0x1a4)]],_0x43070d=[_0xaef92e['body'][_0x2add75(0x170)]],_0x4c328f=[_0xaef92e[_0x2add75(0x165)][_0x2add75(0x190)]],_0x5c275a=[_0xaef92e[_0x2add75(0x165)][_0x2add75(0x1c6)]],_0x434a6a=[_0xaef92e[_0x2add75(0x165)][_0x2add75(0x10e)]],_0x2ee4f5=[_0xaef92e['body']['product_date']],_0x260375=[_0xaef92e['body']['max_product_unit']],_0x3f6252=[_0xaef92e[_0x2add75(0x165)][_0x2add75(0x161)]],_0x5cca04=[_0xaef92e[_0x2add75(0x165)]['RoomAssign']],_0x513dbd=[_0xaef92e[_0x2add75(0x165)][_0x2add75(0x1d7)]];else var _0x15269c=[..._0xaef92e['body'][_0x2add75(0x138)]],_0x50a064=[..._0xaef92e[_0x2add75(0x165)]['prod_code']],_0x4a7377=[..._0xaef92e[_0x2add75(0x165)][_0x2add75(0x1e3)]],_0x4f6582=[..._0xaef92e[_0x2add75(0x165)][_0x2add75(0x10a)]],_0x57ff5d=[..._0xaef92e[_0x2add75(0x165)][_0x2add75(0x1dd)]],_0x6d6b23=[..._0xaef92e[_0x2add75(0x165)][_0x2add75(0x173)]],_0x5c2b06=[..._0xaef92e[_0x2add75(0x165)]['primary_code']],_0x43070d=[..._0xaef92e[_0x2add75(0x165)][_0x2add75(0x170)]],_0x4c328f=[..._0xaef92e['body'][_0x2add75(0x190)]],_0x5c275a=[..._0xaef92e[_0x2add75(0x165)]['batch_code']],_0x434a6a=[..._0xaef92e['body']['expiry_date']],_0x2ee4f5=[..._0xaef92e[_0x2add75(0x165)][_0x2add75(0x174)]],_0x260375=[..._0xaef92e['body'][_0x2add75(0x1ab)]],_0x3f6252=[..._0xaef92e[_0x2add75(0x165)][_0x2add75(0x161)]],_0x5cca04=[..._0xaef92e['body']['RoomAssign']],_0x513dbd=[..._0xaef92e[_0x2add75(0x165)][_0x2add75(0x1d7)]];const _0xb5f60e=_0x15269c[_0x2add75(0x132)](_0x278110=>{return _0x278110={'product_name':_0x278110};});_0x50a064[_0x2add75(0x149)]((_0x593ed6,_0x2cb279)=>{var _0x17b9be=_0x2add75;_0xb5f60e[_0x2cb279][_0x17b9be(0x18b)]=_0x593ed6,_0xb5f60e[_0x2cb279][_0x17b9be(0x1cc)]=_0xc031fd;}),_0x4a7377['forEach']((_0x128361,_0x4a90c9)=>{var _0x465c55=_0x2add75;_0xb5f60e[_0x4a90c9][_0x465c55(0x121)]=Math['abs'](_0x128361);}),_0x4f6582[_0x2add75(0x149)]((_0x4cdf8c,_0x1a6e99)=>{var _0x3d9c8e=_0x2add75;_0xb5f60e[_0x1a6e99][_0x3d9c8e(0x1b8)]=_0x4cdf8c;}),_0x57ff5d['forEach']((_0x1401b6,_0x1cdba7)=>{var _0x592360=_0x2add75;_0xb5f60e[_0x1cdba7][_0x592360(0x141)]=_0x1401b6;}),_0x6d6b23['forEach']((_0x4afefb,_0x15f95d)=>{var _0xf59c7a=_0x2add75;_0xb5f60e[_0x15f95d][_0xf59c7a(0x129)]=_0x4afefb;}),_0x5c2b06[_0x2add75(0x149)]((_0x326789,_0xc21b43)=>{var _0x58f6c9=_0x2add75;_0xb5f60e[_0xc21b43][_0x58f6c9(0x1a4)]=_0x326789;}),_0x43070d['forEach']((_0xcb0e34,_0x54966b)=>{var _0xd005da=_0x2add75;_0xb5f60e[_0x54966b][_0xd005da(0x170)]=_0xcb0e34;}),_0x4c328f[_0x2add75(0x149)]((_0x574e2e,_0x52f024)=>{_0xb5f60e[_0x52f024]['maxStocks']=_0x574e2e;}),_0x5c275a[_0x2add75(0x149)]((_0x22c3b1,_0x158a24)=>{var _0x22ce38=_0x2add75;_0xb5f60e[_0x158a24][_0x22ce38(0x1c6)]=_0x22c3b1;}),_0x434a6a[_0x2add75(0x149)]((_0x3666d0,_0x4b7915)=>{var _0x2ecfcb=_0x2add75;_0xb5f60e[_0x4b7915][_0x2ecfcb(0x10e)]=_0x3666d0;}),_0x2ee4f5[_0x2add75(0x149)]((_0x31a9e2,_0x331e62)=>{var _0x2dfb81=_0x2add75;_0xb5f60e[_0x331e62][_0x2dfb81(0x1d8)]=_0x31a9e2;}),_0x260375['forEach']((_0x45acf6,_0x165493)=>{var _0x5dd18e=_0x2add75;_0xb5f60e[_0x165493][_0x5dd18e(0x1c7)]=_0x45acf6;}),_0x3f6252[_0x2add75(0x149)]((_0x49b7aa,_0x2f8993)=>{var _0x29f973=_0x2add75;_0xb5f60e[_0x2f8993][_0x29f973(0x136)]=_0x49b7aa;}),_0x5cca04['forEach']((_0x448326,_0x56dfda)=>{var _0x3d89ba=_0x2add75;_0xb5f60e[_0x56dfda][_0x3d89ba(0x1a3)]=_0x448326;}),_0x513dbd[_0x2add75(0x149)]((_0x28d79e,_0x26adda)=>{var _0xd5b57=_0x2add75;_0xb5f60e[_0x26adda][_0xd5b57(0x1a7)]=_0x28d79e;});const _0x2eec3f=_0xb5f60e[_0x2add75(0x15e)](_0x499a9a=>_0x499a9a[_0x2add75(0x121)]!=='0'&&_0x499a9a[_0x2add75(0x121)]!==''),_0x34b25e=new purchases_finished({'invoice':_0x54f0a5,'suppliers':_0xaef92e[_0x2add75(0x165)][_0x2add75(0x194)],'date':_0xc031fd,'warehouse_name':_0xadce8b,'product':_0x2eec3f,'note':_0xf4a6e7,'due_amount':_0xc1b6f6,'room':_0x4bf324,'POnumber':_0x259826,'SCRN':_0x4d13a7,'JO_number':_0x174233}),_0x40f3ef=await _0x34b25e[_0x2add75(0x157)](),_0x4b0abe=await purchases_finished[_0x2add75(0x130)]({'invoice':_0x54f0a5}),_0x3e6092=_0x4b0abe[_0x2add75(0x13a)][_0x2add75(0x132)](async _0x12b1c5=>{var _0x3a5718=_0x2add75;try{var _0x4e2191=await warehouse[_0x3a5718(0x130)]({'name':_0xadce8b,'room':_0x12b1c5[_0x3a5718(0x1a3)]}),_0x15086f=0x0;const _0x4f2e07=_0x4e2191[_0x3a5718(0x1d0)][_0x3a5718(0x132)](_0xc1c5e6=>{var _0x10c133=_0x3a5718;console['log'](_0xc1c5e6[_0x10c133(0x13c)]+'=='+_0x12b1c5['product_name']+'&&'+_0xc1c5e6[_0x10c133(0x129)]+'=='+_0x12b1c5[_0x10c133(0x129)]+'&&'+_0xc1c5e6[_0x10c133(0x10e)]+'=='+_0x12b1c5['expiry_date']+'&&'+_0xc1c5e6[_0x10c133(0x1d8)]+'=='+_0x12b1c5[_0x10c133(0x1d8)]+'&&'+_0xc1c5e6[_0x10c133(0x1c6)]+'=='+_0x12b1c5[_0x10c133(0x1c6)]+'&&'+_0xc1c5e6[_0x10c133(0x1a7)]+'=='+_0x4b0abe[_0x10c133(0x1a7)]),_0xc1c5e6[_0x10c133(0x13c)]==_0x12b1c5[_0x10c133(0x13c)]&&_0xc1c5e6['bay']==_0x12b1c5[_0x10c133(0x129)]&&_0xc1c5e6['expiry_date']==_0x12b1c5[_0x10c133(0x10e)]&&_0xc1c5e6[_0x10c133(0x1d8)]==_0x12b1c5[_0x10c133(0x1d8)]&&_0xc1c5e6['batch_code']==_0x12b1c5[_0x10c133(0x1c6)]&&_0xc1c5e6[_0x10c133(0x1a7)]==_0x4b0abe['invoice']&&(_0xc1c5e6[_0x10c133(0x18e)]=Math[_0x10c133(0x1f0)](_0xc1c5e6['product_stock'])+Math[_0x10c133(0x1f0)](_0x12b1c5[_0x10c133(0x121)]),_0x15086f++);});return _0x15086f==0x0&&(_0x4e2191[_0x3a5718(0x1d0)]=_0x4e2191[_0x3a5718(0x1d0)]['concat']({'product_name':_0x12b1c5['product_name'],'product_stock':Math['abs'](_0x12b1c5[_0x3a5718(0x121)]),'primary_code':_0x12b1c5['primary_code'],'secondary_code':_0x12b1c5['secondary_code'],'product_code':_0x12b1c5[_0x3a5718(0x18b)],'bay':_0x12b1c5['bay'],'maxProducts':_0x12b1c5['maxStocks'],'unit':_0x12b1c5[_0x3a5718(0x1b8)],'secondary_unit':_0x12b1c5[_0x3a5718(0x141)],'expiry_date':_0x12b1c5[_0x3a5718(0x10e)],'production_date':_0x12b1c5['production_date'],'maxProducts':_0x12b1c5[_0x3a5718(0x1be)],'maxPerUnit':_0x12b1c5['maxperunit'],'batch_code':_0x12b1c5[_0x3a5718(0x1c6)],'product_cat':_0x12b1c5[_0x3a5718(0x136)],'invoice':_0x12b1c5[_0x3a5718(0x1a7)],'id_incoming':_0x12b1c5[_0x3a5718(0x1bc)],'date_data':_0x12b1c5[_0x3a5718(0x1cc)]})),_0x4e2191;}catch(_0x49104a){return console[_0x3a5718(0x166)](_0x3a5718(0x164),_0x49104a),null;}});Promise['all'](_0x3e6092)[_0x2add75(0x19b)](async _0x215c98=>{var _0x3e6676=_0x2add75;try{for(const _0x5bc349 of _0x215c98){await warehouse[_0x3e6676(0x16d)]({'_id':_0x5bc349[_0x3e6676(0x1bc)]},{'$addToSet':{'product_details':{'$each':_0x5bc349[_0x3e6676(0x1d0)]}}});}const _0x3f08e6=await master_shop[_0x3e6676(0x134)](),_0x1c9bdd=await email_settings[_0x3e6676(0x130)](),_0x2ee1da=await supervisor_settings[_0x3e6676(0x134)]();var _0x2495bc=_0x4b0abe[_0x3e6676(0x13a)],_0x5b0bf5='',_0xf6708a;for(_0xf6708a in _0x2495bc){var _0x36d03e='FG';_0x4b0abe['warehouse_name']==_0x3e6676(0x167)&&(_0x36d03e='DG'),_0x5b0bf5+=_0x3e6676(0x13e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2495bc[_0xf6708a]['product_name']+_0x3e6676(0x214)+_0x3e6676(0x1f2)+_0x2495bc[_0xf6708a][_0x3e6676(0x18b)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2495bc[_0xf6708a][_0x3e6676(0x121)]+_0x3e6676(0x214)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2495bc[_0xf6708a][_0x3e6676(0x1b8)]+_0x3e6676(0x214)+_0x3e6676(0x1f2)+_0x2495bc[_0xf6708a][_0x3e6676(0x141)]+_0x3e6676(0x214)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b0abe[_0x3e6676(0x1df)]+_0x3e6676(0x214)+_0x3e6676(0x1f2)+_0x2495bc[_0xf6708a]['room_name']+_0x3e6676(0x214)+_0x3e6676(0x1f2)+_0x36d03e+_0x2495bc[_0xf6708a][_0x3e6676(0x129)]+_0x3e6676(0x214),_0x3e6676(0x10d);}let _0x4b2ec3=nodemailer[_0x3e6676(0x1a8)]({'host':_0x1c9bdd[_0x3e6676(0x15c)],'port':Number(_0x1c9bdd[_0x3e6676(0x1a1)]),'secure':![],'auth':{'user':_0x1c9bdd[_0x3e6676(0x115)],'pass':_0x1c9bdd[_0x3e6676(0x10c)]}}),_0x1ef2df={'from':_0x1c9bdd[_0x3e6676(0x115)],'to':_0x2ee1da[0x0][_0x3e6676(0x19a)],'subject':_0x3e6676(0x202),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x3e6676(0x18a)+_0x3f08e6[0x0][_0x3e6676(0x1f5)],'cid':_0x3e6676(0x1cf)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+_0x3e6676(0x1da)+_0x3e6676(0x16f)+_0x3e6676(0x1da)+_0x3e6676(0x153)+_0x3e6676(0x13f)+_0x3e6676(0x1da)+'<h2>\x20'+_0x3f08e6[0x0][_0x3e6676(0x20f)]+_0x3e6676(0x145)+'</div>'+'</div>'+_0x3e6676(0x144)+_0x3e6676(0x1da)+_0x3e6676(0x19f)+_0x3e6676(0x1e8)+_0x4b0abe[_0x3e6676(0x1a7)]+'\x20'+_0x3e6676(0x118)+_0x3e6676(0x1ec)+_0x4b0abe[_0x3e6676(0x1ba)]+'\x20'+_0x3e6676(0x1ce)+_0x3e6676(0x178)+_0x3e6676(0x13f)+_0x3e6676(0x1cd)+_0x3e6676(0x1ed)+_0x3e6676(0x13e)+_0x3e6676(0x14a)+_0x3e6676(0x17c)+_0x3e6676(0x171)+_0x3e6676(0x156)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x3e6676(0x203)+_0x3e6676(0x208)+_0x3e6676(0x1bf)+_0x3e6676(0x10d)+_0x3e6676(0x209)+_0x3e6676(0x206)+'\x20'+_0x5b0bf5+'\x20'+_0x3e6676(0x16a)+_0x3e6676(0x14b)+_0x3e6676(0x1da)+'<strong>\x20Regards\x20</strong>'+_0x3e6676(0x1e9)+_0x3f08e6[0x0][_0x3e6676(0x20f)]+_0x3e6676(0x178)+_0x3e6676(0x13f)+_0x3e6676(0x13f)+_0x3e6676(0x150)};_0x4b2ec3[_0x3e6676(0x13d)](_0x1ef2df,function(_0x344d90,_0x4d9bc4){var _0x567e2b=_0x3e6676;_0x344d90?(console['log'](_0x344d90),console[_0x567e2b(0x1fb)](_0x567e2b(0x1b7))):console[_0x567e2b(0x1fb)](_0x567e2b(0x128));});}catch(_0x4a36cb){console[_0x3e6676(0x166)](_0x4a36cb),_0x2ac833[_0x3e6676(0x199)](0x1f4)[_0x3e6676(0x1b9)]({'error':_0x3e6676(0x1af),'message':_0x4a36cb['message']});}})['catch'](_0x140a43=>{var _0x469a70=_0x2add75;console[_0x469a70(0x166)](_0x140a43);}),_0xaef92e['flash']('success',_0x2add75(0x131)),_0x2ac833[_0x2add75(0x17a)](_0x2add75(0x14e));}catch(_0x802602){console[_0x2add75(0x1fb)](_0x802602);}}),router[a0_0x2ba444(0x125)](a0_0x2ba444(0x1ef),auth,async(_0x426238,_0x240426)=>{var _0xd69f70=a0_0x2ba444;try{const {username:_0x17c874,email:_0x1f478f,role:_0x415ab6}=_0x426238['user'],_0x3e3c80=_0x426238['user'],_0x36a902=await profile['findOne']({'email':_0x3e3c80[_0xd69f70(0x115)]}),_0x450019=await master_shop[_0xd69f70(0x134)](),_0x2448ee=_0x426238[_0xd69f70(0x137)]['id'],_0xde296=await purchases_finished['findById'](_0x2448ee),_0x4a7074=await suppliers[_0xd69f70(0x134)]({});let _0x56574b;if(_0x3e3c80[_0xd69f70(0x113)]==_0xd69f70(0x1e6)){const _0x26dd50=await staff[_0xd69f70(0x130)]({'email':_0x3e3c80[_0xd69f70(0x115)]});_0x56574b=await warehouse[_0xd69f70(0x134)]({'status':'Enabled','name':_0x26dd50[_0xd69f70(0x12a)],'warehouse_category':'Finished\x20Goods'});}else _0x56574b=await warehouse['aggregate']([{'$match':{'status':_0xd69f70(0x15d),'warehouse_category':_0xd69f70(0x155)}},{'$group':{'_id':_0xd69f70(0x17d),'name':{'$first':'$name'}}}]);const _0x4fd436=await product[_0xd69f70(0x134)]({}),_0x1be41f=BayBinSelected(_0xde296[_0xd69f70(0x1df)],_0xde296[_0xd69f70(0x1c0)]);let _0x3bc493=new Date(_0xde296[_0xd69f70(0x10e)]),_0x6f257a=('0'+_0x3bc493[_0xd69f70(0x14d)]())['slice'](-0x2),_0x5761a9=('0'+(_0x3bc493[_0xd69f70(0x158)]()+0x1))['slice'](-0x2),_0x50ebeb=_0x3bc493[_0xd69f70(0x1b3)](),_0x43a8b6=_0x50ebeb+'-'+_0x5761a9+'-'+_0x6f257a;if(_0x450019[0x0][_0xd69f70(0x1f9)]==_0xd69f70(0x1bd)){var _0x17b0b2=users[_0xd69f70(0x207)];console['log'](_0x17b0b2);}else{if(_0x450019[0x0][_0xd69f70(0x1f9)]==_0xd69f70(0x1f3))var _0x17b0b2=users[_0xd69f70(0x1f3)];else{if(_0x450019[0x0][_0xd69f70(0x1f9)]==_0xd69f70(0x204))var _0x17b0b2=users['German'];else{if(_0x450019[0x0][_0xd69f70(0x1f9)]==_0xd69f70(0x1ad))var _0x17b0b2=users[_0xd69f70(0x1ad)];else{if(_0x450019[0x0][_0xd69f70(0x1f9)]==_0xd69f70(0x1e4))var _0x17b0b2=users[_0xd69f70(0x1e4)];else{if(_0x450019[0x0][_0xd69f70(0x1f9)]==_0xd69f70(0x17b))var _0x17b0b2=users[_0xd69f70(0x12c)];else{if(_0x450019[0x0][_0xd69f70(0x1f9)]==_0xd69f70(0x124))var _0x17b0b2=users[_0xd69f70(0x124)];else{if(_0x450019[0x0][_0xd69f70(0x1f9)]==_0xd69f70(0x213))var _0x17b0b2=users['Arabic'];}}}}}}}_0x240426['render'](_0xd69f70(0x1b6),{'success':_0x426238[_0xd69f70(0x20b)](_0xd69f70(0x11b)),'errors':_0x426238['flash']('errors'),'role':_0x3e3c80,'profile':_0x36a902,'purchases':_0xde296,'suppliers':_0x4a7074,'warehouse':_0x56574b,'product':_0x4fd436,'master_shop':_0x450019,'language':_0x17b0b2,'ed_fullDate':_0x43a8b6,'dataSelected':_0x1be41f});}catch(_0x5ee02a){console[_0xd69f70(0x1fb)](_0x5ee02a);}}),router[a0_0x2ba444(0x125)]('/view/:id',auth,async(_0x5aec7e,_0x3366a6)=>{var _0x4052b9=a0_0x2ba444;try{const {username:_0x4f39dd,email:_0x1ff2c1,role:_0x5c32ae}=_0x5aec7e[_0x4052b9(0x1b2)],_0x3beb99=_0x5aec7e[_0x4052b9(0x1b2)],_0x48a09e=await profile[_0x4052b9(0x130)]({'email':_0x3beb99[_0x4052b9(0x115)]}),_0x2dc786=await master_shop[_0x4052b9(0x134)](),_0xdce149=_0x5aec7e[_0x4052b9(0x137)]['id'],_0x499b06=await purchases_finished[_0x4052b9(0x133)](_0xdce149),_0x342ed2=await suppliers[_0x4052b9(0x134)]({});let _0x343956;if(_0x3beb99[_0x4052b9(0x113)]=='staff'){const _0x31b152=await staff[_0x4052b9(0x130)]({'email':_0x3beb99[_0x4052b9(0x115)]});_0x343956=await warehouse['find']({'status':_0x4052b9(0x15d),'name':_0x31b152[_0x4052b9(0x12a)],'warehouse_category':_0x4052b9(0x155)});}else _0x343956=await warehouse[_0x4052b9(0x1b4)]([{'$match':{'status':'Enabled','warehouse_category':_0x4052b9(0x155)}},{'$group':{'_id':_0x4052b9(0x17d),'name':{'$first':'$name'}}}]);const _0x24e1de=await product[_0x4052b9(0x134)]({}),_0x1683d4=BayBinSelected(_0x499b06[_0x4052b9(0x1df)],_0x499b06[_0x4052b9(0x1c0)]);let _0x34b894=new Date(_0x499b06[_0x4052b9(0x10e)]),_0x537486=('0'+_0x34b894['getDate']())[_0x4052b9(0x11c)](-0x2),_0x3a6e0d=('0'+(_0x34b894[_0x4052b9(0x158)]()+0x1))[_0x4052b9(0x11c)](-0x2),_0xea44f8=_0x34b894['getFullYear'](),_0x1591b5=_0xea44f8+'-'+_0x3a6e0d+'-'+_0x537486;if(_0x2dc786[0x0]['language']==_0x4052b9(0x1bd)){var _0x4c3f31=users[_0x4052b9(0x207)];console['log'](_0x4c3f31);}else{if(_0x2dc786[0x0][_0x4052b9(0x1f9)]=='Hindi')var _0x4c3f31=users[_0x4052b9(0x1f3)];else{if(_0x2dc786[0x0][_0x4052b9(0x1f9)]==_0x4052b9(0x204))var _0x4c3f31=users[_0x4052b9(0x204)];else{if(_0x2dc786[0x0][_0x4052b9(0x1f9)]==_0x4052b9(0x1ad))var _0x4c3f31=users[_0x4052b9(0x1ad)];else{if(_0x2dc786[0x0][_0x4052b9(0x1f9)]==_0x4052b9(0x1e4))var _0x4c3f31=users['French'];else{if(_0x2dc786[0x0]['language']==_0x4052b9(0x17b))var _0x4c3f31=users[_0x4052b9(0x12c)];else{if(_0x2dc786[0x0][_0x4052b9(0x1f9)]==_0x4052b9(0x124))var _0x4c3f31=users['Chinese'];else{if(_0x2dc786[0x0]['language']=='Arabic\x20(ae)')var _0x4c3f31=users[_0x4052b9(0x1e7)];}}}}}}}_0x3366a6[_0x4052b9(0x20d)](_0x4052b9(0x1d6),{'success':_0x5aec7e[_0x4052b9(0x20b)](_0x4052b9(0x11b)),'errors':_0x5aec7e[_0x4052b9(0x20b)](_0x4052b9(0x1f4)),'role':_0x3beb99,'profile':_0x48a09e,'purchases':_0x499b06,'suppliers':_0x342ed2,'warehouse':_0x343956,'product':_0x24e1de,'master_shop':_0x2dc786,'language':_0x4c3f31,'ed_fullDate':_0x1591b5,'dataSelected':_0x1683d4});}catch(_0x2f52a5){console[_0x4052b9(0x1fb)](_0x2f52a5);}}),router['post'](a0_0x2ba444(0x1a5),auth,async(_0x3a5b61,_0x40d2d7)=>{var _0x2e124c=a0_0x2ba444;try{const _0x34a7a8=_0x3a5b61[_0x2e124c(0x137)]['id'],_0x546434=await purchases_finished[_0x2e124c(0x130)]({'_id':_0x3a5b61['params']['id']}),_0x39989c=await warehouse[_0x2e124c(0x130)]({'name':_0x546434['warehouse_name'],'room':_0x546434[_0x2e124c(0x1c0)]});_0x546434[_0x2e124c(0x13a)][_0x2e124c(0x149)](_0x31d004=>{var _0x4e55c9=_0x2e124c;const _0x39e687=_0x39989c[_0x4e55c9(0x1d0)][_0x4e55c9(0x132)](_0x33a1c9=>{var _0x510af2=_0x4e55c9;_0x33a1c9[_0x510af2(0x13c)]==_0x31d004[_0x510af2(0x13c)]&&_0x33a1c9[_0x510af2(0x129)]==_0x31d004[_0x510af2(0x129)]&&(_0x33a1c9[_0x510af2(0x18e)]=parseInt(_0x33a1c9[_0x510af2(0x18e)])-parseInt(_0x31d004[_0x510af2(0x121)]));});}),await _0x39989c[_0x2e124c(0x157)]();const {invoice:_0x3ad7d6,suppliers:_0x3baefb,date:_0x25a650,warehouse_name:_0x3f60ac,prod_name:_0x7e2fc1,prod_code:_0x390a5f,prod_qty:_0x4f7601,prod_unit:_0x4ac264,prod_secondunit:_0x16b2a9,prod_level:_0x20f5d1,prod_isle:_0x1eed25,prod_pallet:_0x21b62f,note:_0x73bc51,expiry_date:_0xcefea,batch_code:_0x56e627,paid_amount:_0xc65424,due_amount:_0x599379,Room_name:_0x25b0c9,primary_code:_0x2e7429,secondary_code:_0x21a2dd,PO_number:_0x854a68,JO_number:_0x476325}=_0x3a5b61[_0x2e124c(0x165)];if(typeof _0x7e2fc1==_0x2e124c(0x1c2))var _0x4de012=[_0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x138)]],_0xb57f5b=[_0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x146)]],_0x40f584=[_0x3a5b61['body'][_0x2e124c(0x172)]],_0x3fe6fd=[_0x3a5b61[_0x2e124c(0x165)]['prod_unit']],_0x5c7d1f=[_0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x1dd)]],_0x49abca=[_0x3a5b61[_0x2e124c(0x165)]['prod_level']],_0x59b8dc=[_0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x1a4)]],_0x1cded3=[_0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x170)]],_0x2cbeaa=[_0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x190)]],_0x52daa9=[_0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x1c6)]],_0x32a00b=[_0x3a5b61[_0x2e124c(0x165)]['expiry_date']];else var _0x4de012=[..._0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x138)]],_0xb57f5b=[..._0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x146)]],_0x40f584=[..._0x3a5b61['body'][_0x2e124c(0x172)]],_0x3fe6fd=[..._0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x109)]],_0x5c7d1f=[..._0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x1dd)]],_0x49abca=[..._0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x173)]],_0x59b8dc=[..._0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x1a4)]],_0x1cded3=[..._0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x170)]],_0x2cbeaa=[..._0x3a5b61[_0x2e124c(0x165)]['MaxStocks_data']],_0x52daa9=[..._0x3a5b61['body'][_0x2e124c(0x1c6)]],_0x32a00b=[..._0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x10e)]];const _0x171c5a=_0x4de012[_0x2e124c(0x132)](_0x5b60ab=>{return _0x5b60ab={'product_name':_0x5b60ab};});_0xb57f5b['forEach']((_0x1d6f0e,_0x217779)=>{var _0x156eee=_0x2e124c;_0x171c5a[_0x217779][_0x156eee(0x18b)]=_0x1d6f0e;}),_0x40f584[_0x2e124c(0x149)]((_0x397917,_0x10d284)=>{var _0x39bd4a=_0x2e124c;_0x171c5a[_0x10d284][_0x39bd4a(0x121)]=_0x397917;}),_0x3fe6fd[_0x2e124c(0x149)]((_0x401b69,_0xfbf501)=>{var _0x482af7=_0x2e124c;_0x171c5a[_0xfbf501][_0x482af7(0x1b8)]=_0x401b69;}),_0x5c7d1f['forEach']((_0x465f88,_0x17d576)=>{var _0x4e5cbb=_0x2e124c;_0x171c5a[_0x17d576][_0x4e5cbb(0x141)]=_0x465f88;}),_0x49abca[_0x2e124c(0x149)]((_0x39c4bc,_0x1c17d4)=>{var _0x72a30b=_0x2e124c;_0x171c5a[_0x1c17d4][_0x72a30b(0x129)]=_0x39c4bc;}),_0x59b8dc[_0x2e124c(0x149)]((_0x424afa,_0x3e14a7)=>{var _0x36548e=_0x2e124c;_0x171c5a[_0x3e14a7][_0x36548e(0x1a4)]=_0x424afa;}),_0x1cded3[_0x2e124c(0x149)]((_0x5ccebc,_0x239be0)=>{var _0x386bd2=_0x2e124c;_0x171c5a[_0x239be0][_0x386bd2(0x170)]=_0x5ccebc;}),_0x2cbeaa[_0x2e124c(0x149)]((_0x30f4ee,_0x183087)=>{var _0x28a60b=_0x2e124c;_0x171c5a[_0x183087][_0x28a60b(0x1be)]=_0x30f4ee;}),_0x52daa9[_0x2e124c(0x149)]((_0x5a9544,_0x1a78da)=>{var _0x43ee69=_0x2e124c;_0x171c5a[_0x1a78da][_0x43ee69(0x1c6)]=_0x5a9544;}),_0x32a00b[_0x2e124c(0x149)]((_0x44c9ef,_0x429ade)=>{var _0x999509=_0x2e124c;_0x171c5a[_0x429ade][_0x999509(0x10e)]=_0x44c9ef;});const _0x54e29d=_0x171c5a[_0x2e124c(0x15e)](_0x567eaa=>_0x567eaa['quantity']!=='0'&&_0x567eaa[_0x2e124c(0x121)]!=='');_0x546434['invoice']=_0x3ad7d6,_0x546434['suppliers']=_0x3baefb,_0x546434[_0x2e124c(0x1ba)]=_0x25a650,_0x546434[_0x2e124c(0x1df)]=_0x3f60ac,_0x546434[_0x2e124c(0x13a)]=_0x54e29d,_0x546434[_0x2e124c(0x198)]=_0x73bc51,_0x546434[_0x2e124c(0x11e)]=_0xc65424,_0x546434[_0x2e124c(0x1d2)]=_0x599379,_0x546434[_0x2e124c(0x1c0)]=_0x25b0c9,_0x546434['POnumber']=_0x854a68,_0x546434[_0x2e124c(0x176)]=_0x476325;const _0xe68282=await _0x546434['save'](),_0x4e5977=await warehouse[_0x2e124c(0x130)]({'name':_0x3a5b61['body'][_0x2e124c(0x1df)],'room':_0x3a5b61[_0x2e124c(0x165)][_0x2e124c(0x185)]});_0x546434[_0x2e124c(0x13a)][_0x2e124c(0x149)](_0x212bcd=>{var _0x26e5b3=_0x2e124c,_0x1f22e0=0x0;const _0xe52c2a=_0x4e5977['product_details'][_0x26e5b3(0x132)](_0x34a7c2=>{var _0x427b29=_0x26e5b3;_0x34a7c2[_0x427b29(0x13c)]==_0x212bcd[_0x427b29(0x13c)]&&_0x34a7c2['bay']==_0x212bcd[_0x427b29(0x129)]&&(_0x34a7c2[_0x427b29(0x18e)]=parseInt(_0x34a7c2[_0x427b29(0x18e)])+parseInt(_0x212bcd['quantity']),_0x1f22e0++);});_0x1f22e0=='0'&&(_0x4e5977[_0x26e5b3(0x1d0)]=_0x4e5977[_0x26e5b3(0x1d0)]['concat']({'product_name':_0x212bcd[_0x26e5b3(0x13c)],'product_stock':_0x212bcd[_0x26e5b3(0x121)],'primary_code':_0x212bcd[_0x26e5b3(0x1a4)],'secondary_code':_0x212bcd['secondary_code'],'product_code':_0x212bcd[_0x26e5b3(0x18b)],'bay':_0x212bcd[_0x26e5b3(0x129)],'maxProducts':_0x212bcd[_0x26e5b3(0x1be)],'unit':_0x212bcd[_0x26e5b3(0x1b8)],'secondary_unit':_0x212bcd[_0x26e5b3(0x141)],'expiry_date':_0x212bcd[_0x26e5b3(0x10e)]}));}),await _0x4e5977[_0x2e124c(0x157)]();const _0x3066e5=await s_payment_data['findOne']({'invoice':_0x3a5b61['body']['invoice']});if(_0x3066e5===null){}else console[_0x2e124c(0x1fb)](_0x2e124c(0x194),_0x3066e5,_0x3a5b61[_0x2e124c(0x165)]['invoice']),_0x3066e5[_0x2e124c(0x194)]=_0x3a5b61[_0x2e124c(0x165)]['suppliers'],await _0x3066e5[_0x2e124c(0x157)]();_0x3a5b61[_0x2e124c(0x20b)]('success',_0x2e124c(0x123)),_0x40d2d7['redirect'](_0x2e124c(0x14e));}catch(_0x3e9858){console[_0x2e124c(0x1fb)](_0x3e9858);}}),router[a0_0x2ba444(0x119)]('/give_payment/:id',auth,async(_0xb2dcd7,_0x568d75)=>{var _0xa5f918=a0_0x2ba444;try{const _0x596731=_0xb2dcd7[_0xa5f918(0x137)]['id'],{invoice:_0x17dc6d,suppliers:_0x477fc4,payable:_0x13679f,due_amount:_0xc7a61e}=_0xb2dcd7['body'],_0x144946=await purchases['findById'](_0x596731);var _0x5a1910=_0x13679f-_0xc7a61e;_0x144946[_0xa5f918(0x11e)]=parseFloat(_0x144946[_0xa5f918(0x11e)])+parseFloat(_0xc7a61e),_0x144946[_0xa5f918(0x1d2)]=_0x5a1910;const _0x5379d6=await _0x144946[_0xa5f918(0x157)]();console['log'](_0x5379d6);const _0x2aafd9=await s_payment_data['findOne']({'invoice':_0x17dc6d});_0x2aafd9[_0xa5f918(0x16e)]=_0x5a1910,await _0x2aafd9[_0xa5f918(0x157)]();let _0x2653f6=new Date(),_0x3f6f71=('0'+_0x2653f6[_0xa5f918(0x14d)]())[_0xa5f918(0x11c)](-0x2),_0x5c76d3=('0'+(_0x2653f6['getMonth']()+0x1))[_0xa5f918(0x11c)](-0x2),_0x2d8bbf=_0x2653f6[_0xa5f918(0x1b3)](),_0x3944dd=_0x2d8bbf+'-'+_0x5c76d3+'-'+_0x3f6f71;const _0xf10495=new suppliers_payment({'invoice':_0x17dc6d,'date':_0x2d8bbf+'-'+_0x5c76d3+'-'+_0x3f6f71,'suppliers':_0x477fc4,'reason':_0xa5f918(0x181),'amount':_0xc7a61e}),_0x542385=await _0xf10495[_0xa5f918(0x157)]();_0xb2dcd7['flash'](_0xa5f918(0x11b),_0xa5f918(0x1fa)),_0x568d75['redirect']('/all_purchases/view');}catch(_0x4fc4a1){console[_0xa5f918(0x1fb)](_0x4fc4a1);}}),router[a0_0x2ba444(0x125)](a0_0x2ba444(0x1d9),auth,async(_0x48c7bc,_0x4fa1d3)=>{var _0x59358a=a0_0x2ba444;try{const {username:_0x4ff3c6,email:_0xa71b4d,role:_0x5138ad}=_0x48c7bc[_0x59358a(0x1b2)],_0x3e5673=_0x48c7bc['user'],_0xedecd=await profile['findOne']({'email':_0x3e5673[_0x59358a(0x115)]}),_0x237b13=await master_shop['find']();console['log'](_0x59358a(0x1f7),_0x237b13);const _0x2cab03=_0x48c7bc['params']['id'],_0x28803e=await purchases[_0x59358a(0x133)](_0x2cab03);console['log'](_0x28803e);const _0x4e62a6=await suppliers[_0x59358a(0x130)]({'name':_0x28803e[_0x59358a(0x194)]});console[_0x59358a(0x1fb)](_0x4e62a6);if(_0x237b13[0x0][_0x59358a(0x1f9)]==_0x59358a(0x1bd)){var _0x6a8885=users[_0x59358a(0x207)];console['log'](_0x6a8885);}else{if(_0x237b13[0x0][_0x59358a(0x1f9)]==_0x59358a(0x1f3))var _0x6a8885=users['Hindi'];else{if(_0x237b13[0x0][_0x59358a(0x1f9)]==_0x59358a(0x204))var _0x6a8885=users['German'];else{if(_0x237b13[0x0]['language']==_0x59358a(0x1ad))var _0x6a8885=users[_0x59358a(0x1ad)];else{if(_0x237b13[0x0][_0x59358a(0x1f9)]==_0x59358a(0x1e4))var _0x6a8885=users['French'];else{if(_0x237b13[0x0]['language']==_0x59358a(0x17b))var _0x6a8885=users[_0x59358a(0x12c)];else{if(_0x237b13[0x0][_0x59358a(0x1f9)]=='Chinese')var _0x6a8885=users[_0x59358a(0x124)];else{if(_0x237b13[0x0][_0x59358a(0x1f9)]==_0x59358a(0x213))var _0x6a8885=users[_0x59358a(0x1e7)];}}}}}}}_0x4fa1d3[_0x59358a(0x20d)](_0x59358a(0x1c5),{'success':_0x48c7bc[_0x59358a(0x20b)](_0x59358a(0x11b)),'errors':_0x48c7bc[_0x59358a(0x20b)]('errors'),'role':_0x3e5673,'profile':_0xedecd,'master_shop':_0x237b13,'supplier':_0x4e62a6,'purchase':_0x28803e,'language':_0x6a8885});}catch(_0x3f99f4){console['log'](_0x3f99f4);}}),router[a0_0x2ba444(0x125)]('/view/return_purchase/:id',auth,async(_0x210683,_0x2e695f)=>{var _0x52cd42=a0_0x2ba444;try{const {username:_0x34449b,email:_0x42a565,role:_0x13fcb8}=_0x210683[_0x52cd42(0x1b2)],_0x56709b=_0x210683['user'],_0x322b7b=await profile[_0x52cd42(0x130)]({'email':_0x56709b[_0x52cd42(0x115)]}),_0x483d62=await master_shop[_0x52cd42(0x134)]();console['log'](_0x52cd42(0x1f7),_0x483d62);const _0x1d2aef=_0x210683['params']['id'];console[_0x52cd42(0x1fb)](_0x1d2aef);const _0x3f7bde=await purchases_finished[_0x52cd42(0x133)](_0x1d2aef);console['log']('user_id',_0x3f7bde);const _0x46c420=await product[_0x52cd42(0x134)]({}),_0x5681b9=await warehouse[_0x52cd42(0x1b4)]([{'$match':{'name':_0x3f7bde[_0x52cd42(0x1df)],'room':_0x3f7bde[_0x52cd42(0x1c0)]}},{'$unwind':_0x52cd42(0x1cb)},{'$group':{'_id':_0x52cd42(0x19d),'name':{'$first':_0x52cd42(0x1fe)},'product_stock':{'$first':_0x52cd42(0x112)},'bay':{'$first':_0x52cd42(0x19e)},'bin':{'$first':_0x52cd42(0x1fd)},'type':{'$first':_0x52cd42(0x1a6)},'floorlevel':{'$first':_0x52cd42(0x1c4)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x52cd42(0x14c)},'product_code':{'$first':_0x52cd42(0x142)},'storage':{'$first':_0x52cd42(0x18c)},'rack':{'$first':_0x52cd42(0x12e)}}}]);console[_0x52cd42(0x1fb)](_0x52cd42(0x12b),_0x5681b9);let _0x4b4176;if(_0x56709b[_0x52cd42(0x113)]==_0x52cd42(0x1e6)){const _0x19b968=await staff[_0x52cd42(0x130)]({'email':_0x56709b[_0x52cd42(0x115)]});_0x4b4176=await warehouse[_0x52cd42(0x134)]({'status':_0x52cd42(0x15d),'name':_0x19b968[_0x52cd42(0x12a)],'warehouse_category':_0x52cd42(0x155),'name':'Return\x20Goods'});}else _0x4b4176=await warehouse[_0x52cd42(0x1b4)]([{'$match':{'status':_0x52cd42(0x15d),'warehouse_category':_0x52cd42(0x155),'name':_0x52cd42(0x1c9)}},{'$group':{'_id':'$name','name':{'$first':_0x52cd42(0x17d)}}}]);if(_0x483d62[0x0]['language']==_0x52cd42(0x1bd)){var _0xfaaacc=users['English'];console['log'](_0xfaaacc);}else{if(_0x483d62[0x0][_0x52cd42(0x1f9)]=='Hindi')var _0xfaaacc=users[_0x52cd42(0x1f3)];else{if(_0x483d62[0x0][_0x52cd42(0x1f9)]==_0x52cd42(0x204))var _0xfaaacc=users[_0x52cd42(0x204)];else{if(_0x483d62[0x0][_0x52cd42(0x1f9)]=='Spanish')var _0xfaaacc=users[_0x52cd42(0x1ad)];else{if(_0x483d62[0x0]['language']==_0x52cd42(0x1e4))var _0xfaaacc=users[_0x52cd42(0x1e4)];else{if(_0x483d62[0x0][_0x52cd42(0x1f9)]==_0x52cd42(0x17b))var _0xfaaacc=users[_0x52cd42(0x12c)];else{if(_0x483d62[0x0][_0x52cd42(0x1f9)]==_0x52cd42(0x124))var _0xfaaacc=users[_0x52cd42(0x124)];else{if(_0x483d62[0x0][_0x52cd42(0x1f9)]==_0x52cd42(0x213))var _0xfaaacc=users[_0x52cd42(0x1e7)];}}}}}}}_0x2e695f[_0x52cd42(0x20d)](_0x52cd42(0x162),{'success':_0x210683[_0x52cd42(0x20b)](_0x52cd42(0x11b)),'errors':_0x210683[_0x52cd42(0x20b)](_0x52cd42(0x1f4)),'role':_0x56709b,'profile':_0x322b7b,'user':_0x3f7bde,'stock':_0x5681b9,'master_shop':_0x483d62,'product':_0x46c420,'language':_0xfaaacc,'warehouse':_0x4b4176});}catch(_0x29ef71){console[_0x52cd42(0x1fb)](_0x29ef71);}}),router[a0_0x2ba444(0x119)](a0_0x2ba444(0x212),auth,async(_0x507c62,_0x54273b)=>{var _0x50795a=a0_0x2ba444;try{const {invoice:_0x3eae33,date:_0x1e7f24,warehouse_name:_0x5d9b38,Room_name:_0x533a79,product_name:_0x11ac95,purchase_quantity:_0xcd3e65,stocks:_0x5ccebb,return_qty:_0x1d9293,note:_0x1e5c19,level:_0x445420,isle:_0x1abf7c,pallet:_0x20da5b,to_warehouse_name:_0x1a8d39,to_Room_name:_0x391080}=_0x507c62[_0x50795a(0x165)],_0x2dadcd=await purchases_finished[_0x50795a(0x130)]({'_id':_0x507c62[_0x50795a(0x137)]['id']}),_0x172dde=await warehouse[_0x50795a(0x130)]({'name':_0x5d9b38,'room':_0x533a79,'warehouse_category':_0x50795a(0x155)});if(typeof _0x11ac95==_0x50795a(0x1c2))var _0x1a1058=[_0x507c62[_0x50795a(0x165)]['product_name']],_0x31e7dd=[_0x507c62[_0x50795a(0x165)][_0x50795a(0x168)]],_0x3ac550=[_0x507c62[_0x50795a(0x165)][_0x50795a(0x193)]],_0x53ab8a=[_0x507c62[_0x50795a(0x165)][_0x50795a(0x180)]],_0x236ca7=[_0x507c62[_0x50795a(0x165)]['level']],_0x258aff=[_0x507c62[_0x50795a(0x165)][_0x50795a(0x14f)]],_0x38ded7=[_0x507c62[_0x50795a(0x165)][_0x50795a(0x201)]],_0x16ae87=[_0x507c62[_0x50795a(0x165)][_0x50795a(0x20c)]];else var _0x1a1058=[..._0x507c62[_0x50795a(0x165)][_0x50795a(0x13c)]],_0x31e7dd=[..._0x507c62[_0x50795a(0x165)]['purchase_quantity']],_0x3ac550=[..._0x507c62['body']['stocks']],_0x53ab8a=[..._0x507c62[_0x50795a(0x165)]['return_qty']],_0x236ca7=[..._0x507c62[_0x50795a(0x165)][_0x50795a(0x1f6)]],_0x258aff=[..._0x507c62[_0x50795a(0x165)][_0x50795a(0x14f)]],_0x38ded7=[..._0x507c62['body'][_0x50795a(0x201)]],_0x16ae87=[..._0x507c62[_0x50795a(0x165)]['secondary_code_hide']];const _0x5a8be8=_0x1a1058[_0x50795a(0x132)](_0x215fdc=>{return _0x215fdc={'product_name':_0x215fdc};});_0x31e7dd['forEach']((_0x19afc7,_0x49e15c)=>{_0x5a8be8[_0x49e15c]['purchase_quantity']=_0x19afc7;}),_0x3ac550[_0x50795a(0x149)]((_0x1f420,_0x39fb74)=>{var _0x3bc580=_0x50795a;_0x5a8be8[_0x39fb74][_0x3bc580(0x1c1)]=_0x1f420;}),_0x53ab8a[_0x50795a(0x149)]((_0x46fe05,_0x51ba3b)=>{var _0x57fcaa=_0x50795a;_0x5a8be8[_0x51ba3b][_0x57fcaa(0x180)]=_0x46fe05;}),_0x236ca7[_0x50795a(0x149)]((_0xcf9ea,_0x5b77cb)=>{_0x5a8be8[_0x5b77cb]['bay']=_0xcf9ea;}),_0x258aff[_0x50795a(0x149)]((_0x5af51b,_0xc31fbf)=>{_0x5a8be8[_0xc31fbf]['product_code']=_0x5af51b;}),_0x38ded7[_0x50795a(0x149)]((_0x2071b4,_0x213b81)=>{var _0x32e42a=_0x50795a;_0x5a8be8[_0x213b81][_0x32e42a(0x1a4)]=_0x2071b4;}),_0x16ae87['forEach']((_0x4520d9,_0x18149d)=>{var _0x4eb39c=_0x50795a;_0x5a8be8[_0x18149d][_0x4eb39c(0x170)]=_0x4520d9;}),_0x5a8be8[_0x50795a(0x149)](_0xa425f9=>{var _0x37d122=_0x50795a;console[_0x37d122(0x1fb)](_0xa425f9);const _0x363f95=_0x172dde[_0x37d122(0x1d0)][_0x37d122(0x132)](_0x17ab0e=>{var _0x58de48=_0x37d122;_0x17ab0e['product_name']==_0xa425f9[_0x58de48(0x13c)]&&_0x17ab0e['bay']==_0xa425f9[_0x58de48(0x129)]&&(console[_0x58de48(0x1fb)](parseInt(_0x17ab0e[_0x58de48(0x18e)])+_0x58de48(0x12f)+parseInt(_0xa425f9['return_qty'])),_0x17ab0e[_0x58de48(0x18e)]=parseInt(_0x17ab0e[_0x58de48(0x18e)])-parseInt(_0xa425f9['return_qty']));});}),await _0x172dde['save']();var _0x2e6e27=0x0;_0x5a8be8[_0x50795a(0x149)](_0xe9c06f=>{var _0xedae41=_0x50795a;(parseInt(_0xe9c06f['purchase_quantity'])<parseInt(_0xe9c06f[_0xedae41(0x180)])||parseInt(_0xe9c06f[_0xedae41(0x1c1)])<parseInt(_0xe9c06f[_0xedae41(0x180)]))&&_0x2e6e27++;});if(_0x2e6e27!=0x0)return _0x507c62[_0x50795a(0x20b)](_0x50795a(0x1f4),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x54273b['redirect'](_0x50795a(0x16b));const _0x3aadbf=new purchases_return_finished({'invoice':_0x3eae33,'suppliers':_0x507c62[_0x50795a(0x165)][_0x50795a(0x194)],'date':_0x1e7f24,'warehouse_name':_0x5d9b38,'return_product':_0x5a8be8,'note':_0x1e5c19,'room':_0x533a79,'to_warehouse_name':_0x1a8d39,'to_room':_0x391080}),_0x3932ba=await _0x3aadbf['save'](),_0x54fb56=await purchases_return_finished[_0x50795a(0x130)]({'invoice':_0x3eae33}),_0xe9b0be=await warehouse[_0x50795a(0x130)]({'name':_0x1a8d39,'room':_0x391080,'warehouse_category':_0x50795a(0x155)});_0x54fb56[_0x50795a(0x143)][_0x50795a(0x149)](_0x1b4aad=>{var _0x130df3=_0x50795a,_0x58dc3e=0x0;const _0x1b7130=_0xe9b0be[_0x130df3(0x1d0)]['map'](_0x4bf7b9=>{var _0xb0de1a=_0x130df3;console[_0xb0de1a(0x1fb)](_0x4bf7b9['product_name']+'=='+_0x1b4aad[_0xb0de1a(0x13c)]+'&&'+_0x4bf7b9[_0xb0de1a(0x129)]+'=='+_0x1b4aad[_0xb0de1a(0x129)]),_0x4bf7b9[_0xb0de1a(0x13c)]==_0x1b4aad[_0xb0de1a(0x13c)]&&_0x4bf7b9['bay']==_0x1b4aad[_0xb0de1a(0x129)]&&(_0x4bf7b9[_0xb0de1a(0x18e)]=parseInt(_0x4bf7b9[_0xb0de1a(0x18e)])-parseInt(_0x1b4aad[_0xb0de1a(0x180)]),_0x58dc3e++);});_0x58dc3e=='0'&&(_0xe9b0be[_0x130df3(0x1d0)]=_0xe9b0be[_0x130df3(0x1d0)]['concat']({'product_name':_0x1b4aad[_0x130df3(0x13c)],'product_stock':_0x1b4aad[_0x130df3(0x180)],'primary_code':_0x1b4aad[_0x130df3(0x1a4)],'secondary_code':_0x1b4aad[_0x130df3(0x170)],'product_code':_0x1b4aad[_0x130df3(0x18b)],'bay':_0x1b4aad[_0x130df3(0x129)],'maxProducts':0xf423f}));}),await _0xe9b0be['save']();const _0x208714=await purchases_finished[_0x50795a(0x130)]({'invoice':_0x3eae33});_0x208714[_0x50795a(0x192)]='True';const _0x5993b2=await _0x208714['save'](),_0x32c563=new s_payment_data({'invoice':_0x3eae33,'suppliers':_0x507c62[_0x50795a(0x165)][_0x50795a(0x194)],'reason':_0x50795a(0x18d)});await _0x32c563['save']();const _0x15a0e=await master_shop[_0x50795a(0x134)](),_0x459e63=await email_settings[_0x50795a(0x130)](),_0x179599=await suppliers[_0x50795a(0x130)]({'name':_0x507c62[_0x50795a(0x165)][_0x50795a(0x194)]});_0x15a0e[0x0][_0x50795a(0x1a9)]==0x1?(right_currency=_0x15a0e[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x15a0e[0x0][_0x50795a(0x10b)]);var _0x1e29f3=_0x1a1058,_0x2c2876=_0x53ab8a,_0xc8f66a='',_0x371fbc;for(_0x371fbc in _0x1e29f3){_0xc8f66a+=_0x50795a(0x13e)+_0x50795a(0x1f2)+_0x1e29f3[_0x371fbc]+'</td>'+_0x50795a(0x1f2)+_0x2c2876[_0x371fbc]+_0x50795a(0x214)+_0x50795a(0x10d);}let _0x41c1eb=nodemailer[_0x50795a(0x1a8)]({'service':'gmail','auth':{'user':_0x459e63[_0x50795a(0x115)],'pass':_0x459e63['password']}}),_0xe438eb={'from':_0x459e63[_0x50795a(0x115)],'to':_0x179599['email'],'subject':_0x50795a(0x20a),'attachments':[{'filename':_0x50795a(0x183),'path':__dirname+_0x50795a(0x1ca)+_0x50795a(0x18a)+_0x15a0e[0x0][_0x50795a(0x1f5)],'cid':_0x50795a(0x1cf)}],'html':_0x50795a(0x20e)+_0x50795a(0x1ac)+'</head><body>'+'<div>'+_0x50795a(0x16f)+_0x50795a(0x1da)+_0x50795a(0x153)+_0x50795a(0x13f)+'<div>'+_0x50795a(0x148)+_0x15a0e[0x0][_0x50795a(0x20f)]+'\x20</h2>'+_0x50795a(0x13f)+_0x50795a(0x13f)+_0x50795a(0x144)+_0x50795a(0x1da)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x50795a(0x1e8)+_0x3eae33+'\x20'+_0x50795a(0x118)+_0x50795a(0x1ec)+_0x1e7f24+'\x20'+_0x50795a(0x1ce)+_0x50795a(0x178)+_0x50795a(0x13f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x50795a(0x13e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x50795a(0x10f)+_0x50795a(0x1f8)+_0x50795a(0x120)+_0x50795a(0x10d)+_0x50795a(0x209)+_0x50795a(0x206)+'\x20'+_0xc8f66a+'\x20'+_0x50795a(0x16a)+_0x50795a(0x14b)+_0x50795a(0x1da)+_0x50795a(0x1c3)+_0x50795a(0x1e9)+_0x15a0e[0x0][_0x50795a(0x20f)]+_0x50795a(0x178)+'</div>'+_0x50795a(0x13f)+_0x50795a(0x150)};_0x41c1eb[_0x50795a(0x13d)](_0xe438eb,function(_0xdfa840,_0x285fcb){var _0x119862=_0x50795a;_0xdfa840?console['log']('Error\x20Occurs'):console[_0x119862(0x1fb)](_0x119862(0x128));}),_0x507c62[_0x50795a(0x20b)](_0x50795a(0x11b),_0x50795a(0x188)),_0x54273b['redirect'](_0x50795a(0x14e));}catch(_0x4ea74c){_0x54273b[_0x50795a(0x199)](0xc8)[_0x50795a(0x1b9)]({'message':_0x4ea74c[_0x50795a(0x15a)]});}}),router[a0_0x2ba444(0x125)]('/barcode/:id',auth,async(_0x39ac76,_0x531b0f)=>{var _0x1e237a=a0_0x2ba444;try{const {username:_0x2016ec,email:_0x11dbcd,role:_0x408c62}=_0x39ac76['user'],_0x1065b6=_0x39ac76[_0x1e237a(0x1b2)],_0x2c8325=await profile['findOne']({'email':_0x1065b6[_0x1e237a(0x115)]}),_0x1cdcc4=await master_shop['find'](),_0x1ad61b=_0x39ac76[_0x1e237a(0x137)]['id'],_0x49ba56=await purchases_finished[_0x1e237a(0x133)](_0x1ad61b);if(_0x1cdcc4[0x0][_0x1e237a(0x1f9)]==_0x1e237a(0x1bd))var _0x277a7=users[_0x1e237a(0x207)];else{if(_0x1cdcc4[0x0][_0x1e237a(0x1f9)]==_0x1e237a(0x1f3))var _0x277a7=users[_0x1e237a(0x1f3)];else{if(_0x1cdcc4[0x0][_0x1e237a(0x1f9)]==_0x1e237a(0x204))var _0x277a7=users['German'];else{if(_0x1cdcc4[0x0][_0x1e237a(0x1f9)]==_0x1e237a(0x1ad))var _0x277a7=users[_0x1e237a(0x1ad)];else{if(_0x1cdcc4[0x0]['language']==_0x1e237a(0x1e4))var _0x277a7=users[_0x1e237a(0x1e4)];else{if(_0x1cdcc4[0x0]['language']==_0x1e237a(0x17b))var _0x277a7=users['Portuguese'];else{if(_0x1cdcc4[0x0][_0x1e237a(0x1f9)]==_0x1e237a(0x124))var _0x277a7=users[_0x1e237a(0x124)];else{if(_0x1cdcc4[0x0]['language']==_0x1e237a(0x213))var _0x277a7=users[_0x1e237a(0x1e7)];}}}}}}}_0x531b0f[_0x1e237a(0x20d)](_0x1e237a(0x200),{'success':_0x39ac76[_0x1e237a(0x20b)]('success'),'errors':_0x39ac76[_0x1e237a(0x20b)](_0x1e237a(0x1f4)),'role':_0x1065b6,'profile':_0x2c8325,'alldata':_0x49ba56,'master_shop':_0x1cdcc4,'language':_0x277a7}),console[_0x1e237a(0x1fb)](alldata);}catch(_0x4885c5){console['log'](_0x4885c5);}}),router[a0_0x2ba444(0x119)](a0_0x2ba444(0x1e2),async(_0x4594eb,_0x2cdd11)=>{var _0xfcdbff=a0_0x2ba444;const {product_code:_0x369d3e}=_0x4594eb[_0xfcdbff(0x165)];var _0x396cf5;const _0x34cffc=await product[_0xfcdbff(0x1b4)]([{'$match':{'primary_code':_0x369d3e,'product_category':_0xfcdbff(0x155)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0xfcdbff(0x1bb)},'brand':{'$first':_0xfcdbff(0x140)},'unit':{'$first':_0xfcdbff(0x186)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0xfcdbff(0x15f)},'primary_code':{'$first':_0xfcdbff(0x187)},'secondary_code':{'$first':_0xfcdbff(0x1ae)},'maxStocks':{'$first':_0xfcdbff(0x1de)},'maxProdPerUnit':{'$first':_0xfcdbff(0x191)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xfcdbff(0x111)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x522fab=await product[_0xfcdbff(0x1b4)]([{'$match':{'secondary_code':_0x369d3e}},{'$group':{'_id':_0xfcdbff(0x197),'name':{'$first':_0xfcdbff(0x17d)},'category':{'$first':_0xfcdbff(0x1bb)},'brand':{'$first':'$brand'},'unit':{'$first':_0xfcdbff(0x186)},'alertquantity':{'$first':_0xfcdbff(0x196)},'product_code':{'$first':_0xfcdbff(0x15f)},'primary_code':{'$first':_0xfcdbff(0x187)},'secondary_code':{'$first':_0xfcdbff(0x1ae)},'maxStocks':{'$first':_0xfcdbff(0x1de)},'maxProdPerUnit':{'$first':_0xfcdbff(0x191)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xfcdbff(0x111)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x34cffc[_0xfcdbff(0x1d1)]>0x0)_0x396cf5=_0x34cffc;else _0x522fab[_0xfcdbff(0x1d1)]>0x0&&(_0x396cf5=_0x522fab);_0x2cdd11[_0xfcdbff(0x1b9)](_0x396cf5);}),router[a0_0x2ba444(0x119)](a0_0x2ba444(0x1dc),async(_0x41d55b,_0x1b6a5a)=>{var _0x4e887d=a0_0x2ba444;const {productCode:_0x1fe242,bay:_0xa80e8b,warehouses:_0x4b0146,room:_0x38a470}=_0x41d55b[_0x4e887d(0x165)];console['log'](_0x41d55b[_0x4e887d(0x165)]);try{const _0x14baf7=await warehouse[_0x4e887d(0x1b4)]([{'$match':{'name':_0x4b0146,'room':_0x38a470}},{'$unwind':_0x4e887d(0x1cb)},{'$match':{'product_details.bay':parseInt(_0xa80e8b)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4e887d(0x1fe)},'product_stock':{'$first':_0x4e887d(0x112)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x1b6a5a[_0x4e887d(0x199)](0xc8)['json'](_0x14baf7);}catch(_0x47dafa){_0x1b6a5a[_0x4e887d(0x199)](0x194)[_0x4e887d(0x1b9)]({'message':_0x47dafa[_0x4e887d(0x15a)]});}}),module['exports']=router;