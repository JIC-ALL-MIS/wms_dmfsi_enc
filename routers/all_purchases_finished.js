function a0_0x26d7(_0x3f6b3c,_0x1906aa){var _0x19930d=a0_0x1993();return a0_0x26d7=function(_0x26d726,_0x359b6b){_0x26d726=_0x26d726-0x66;var _0x4c13b5=_0x19930d[_0x26d726];return _0x4c13b5;},a0_0x26d7(_0x3f6b3c,_0x1906aa);}var a0_0x4257e5=a0_0x26d7;function a0_0x1993(){var _0x47d2a7=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','amount','</span>','product_cat','edit_purchases_finished','$date','$product_details.secondary_code','batch_code','Ambient','\x20</h2>','suppliers','/CheckingWarehouse','purchase\x20data\x20update\x20successfully','purchases\x20item\x20return\x20successfull','name','prod_primunit','/view/add_purchases/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_secondunit','/invoice/:id','$primary_code','$product_details','warehouse_name','English','<html><head><title></title>','QA\x20Warehouse','currency','$product.bay','7843599qwAgCo','$product_details.bin','params','product_name','port','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','get','572wqHFpX','random','_id','product_details','MaxStocks_data','Rack\x201','invoice','\x20Order\x20Number\x20:\x20','return_product','Purchase\x20Return','$suppliers_docs','prod_code','An\x20error\x20occurred.','map','padStart','payment\x20successfull','quantity','slice','language','max_product_unit','table\x20page','Rack\x202','exports','$suppliers','Arabic','success','4364328hDcJuu','/all_purchases/view','secondary_code','$_id','$brand','secondary_unit','<!DOCTYPE\x20html>','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.product_stock','Router','express','22045dMqEjg','/view/add_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product.quantity','room_name','$due_amount','DRY\x20GOODS','logo','ejs','getMonth','prod_invoice','$product_details.floorlevel','</tr>','Enclosed','purchase_quantity','prod_level','$secondary_unit','product','errors','user_id','<h2>\x20','<tr>','German','/barcode/:id','RoomAssign','</body></html>','/barcode_scanner','</div>','aggregate','$product_details.product_name','</thead>','<div>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Hindi','staff','save','Purchase\x20Return\x20Mail','warehouse','render','True','\x20<>\x20','/../public','room','then','291611CwexXl','$invoice','error','return_data','findOne','return_qty','stock_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','email','maxperunit','redirect','path','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','getFullYear','$product_details.product_code','edit_purchases_finished_view','$note','product_stock','41217SmqSUF','</tbody>','return_purchase_finished','standard_unit','find','../middleware/auth','floor','$expiry_date','$name','prod_unit','/view','updateOne','$alertquantity','$product.bin','createTransport','message','94fQjOrh','$product.type','abs','all','level','/give_payment/:id','getDate','prod_name','$paid_amount','</h5>','post','secondary_code_hide','Room_name','$product_code','Arabic\x20(ae)','POnumber','$product_details.type','/all_purchases_finished/view','findById','Enabled','body','Portuguese\x20(BR)','$category','all_purchases_barcode','site_title','8142432QjUriL','</head><body>','<tbody\x20style=\x22text-align:\x20center;\x22>','json','\x20Order\x20Date\x20:\x20','image','FGSEmail','$product_details.primary_code','<h5\x20style=\x22text-align:\x20left;\x22>','$product','French','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','paid_amount','$maxProdPerUnit','Finished\x20Goods','log','concat','2362136vbGPoq','add_purchases\x20error','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','primary_code','production_date','flash','Logo.png','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Purchase\x20Mail','note','../models/all_models','string','Paid\x20For\x20Purchase','gmail','$unit','English\x20(US)','/view/:id','bay','currency_placement','maxStocks','stocks','length','due_amount','$product_details.bay','filter','<h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','product_date','$product_details.maxProducts','forEach','/preview/:id','Chinese','product_code','$product.floorlevel','$product_details._id','$product.room_name','INCF-','</table>','</td>','primary_code_hide','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<strong>\x20Regards\x20</strong>','purchase_invoice','prod_Qty','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','user','prod_cat','password','catch','expiry_date','/view/return_purchase/:id','An\x20error\x20occurred\x20while\x20saving\x20data.','date','$secondary_code','back','status','../public/language/languages.json','<hr\x20class=\x22my-3\x22>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','FROZEN\x20GOODS','prod_qty','Spanish','$maxStocks','$warehouse_name'];a0_0x1993=function(){return _0x47d2a7;};return a0_0x1993();}(function(_0x3d5170,_0x807dfb){var _0x7d6d68=a0_0x26d7,_0x4d99fc=_0x3d5170();while(!![]){try{var _0x2571d3=parseInt(_0x7d6d68(0x113))/0x1+parseInt(_0x7d6d68(0x136))/0x2*(-parseInt(_0x7d6d68(0x126))/0x3)+parseInt(_0x7d6d68(0xc0))/0x4*(parseInt(_0x7d6d68(0xe7))/0x5)+parseInt(_0x7d6d68(0xda))/0x6+-parseInt(_0x7d6d68(0x160))/0x7+-parseInt(_0x7d6d68(0x14f))/0x8+parseInt(_0x7d6d68(0xb9))/0x9;if(_0x2571d3===_0x807dfb)break;else _0x4d99fc['push'](_0x4d99fc['shift']());}catch(_0x152bc6){_0x4d99fc['push'](_0x4d99fc['shift']());}}}(a0_0x1993,0x7ef4c));const express=require(a0_0x4257e5(0xe6)),app=express(),router=express[a0_0x4257e5(0xe5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x4257e5(0x16a)),auth=require(a0_0x4257e5(0x12b)),nodemailer=require('nodemailer');var ejs=require(a0_0x4257e5(0xef));const path=require(a0_0x4257e5(0x11e)),users=require(a0_0x4257e5(0x93));router['get'](a0_0x4257e5(0x130),auth,async(_0x51f179,_0x431e24)=>{var _0x43a772=a0_0x4257e5;try{const {username:_0xaa9ffa,email:_0x201292,role:_0x16fada}=_0x51f179[_0x43a772(0x88)],_0x3e6a49=_0x51f179['user'],_0x36537c=await profile['findOne']({'email':_0x3e6a49[_0x43a772(0x11b)]}),_0x21278f=await staff[_0x43a772(0x117)]({'email':_0x3e6a49['email']});if(_0x3e6a49[_0x43a772(0x11f)]==_0x43a772(0x109)){const _0x5a352b=await staff[_0x43a772(0x117)]({'email':_0x3e6a49['email']});}const _0x405cde=await master_shop[_0x43a772(0x12a)]();let _0x104a48;if(_0x3e6a49[_0x43a772(0x11f)]==_0x43a772(0x109)){const _0x1109f1=await staff[_0x43a772(0x117)]({'email':_0x3e6a49[_0x43a772(0x11b)]});_0x104a48=await purchases_finished[_0x43a772(0x103)]([{'$match':{'warehouse_name':_0x1109f1['warehouse']}},{'$lookup':{'from':_0x43a772(0xa7),'localField':_0x43a772(0xa7),'foreignField':_0x43a772(0xab),'as':'suppliers_docs'}},{'$unwind':_0x43a772(0xca)},{'$unwind':_0x43a772(0x158)},{'$group':{'_id':_0x43a772(0xdd),'invoice':{'$first':_0x43a772(0x114)},'suppliers':{'$first':_0x43a772(0xd7)},'date':{'$first':_0x43a772(0xa2)},'warehouse_name':{'$first':_0x43a772(0x9c)},'room':{'$first':'$room'},'product':{'$push':_0x43a772(0x158)},'note':{'$first':_0x43a772(0x124)},'paid_amount':{'$first':_0x43a772(0x13e)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x43a772(0x12d)},'suppliers_docs':{'$first':_0x43a772(0xca)},'total_product_quantity':{'$sum':_0x43a772(0xea)},'level':{'$addToSet':_0x43a772(0xb8)},'isle':{'$addToSet':_0x43a772(0x133)},'type':{'$addToSet':_0x43a772(0x137)},'floorlevel':{'$addToSet':_0x43a772(0x7b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x104a48=await purchases_finished[_0x43a772(0x103)]([{'$unwind':_0x43a772(0x158)},{'$group':{'_id':'$_id','invoice':{'$first':_0x43a772(0x114)},'suppliers':{'$first':_0x43a772(0xd7)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x43a772(0x9c)},'room':{'$addToSet':_0x43a772(0x7d)},'product':{'$push':'$product'},'note':{'$first':_0x43a772(0x124)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x43a772(0xec)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x43a772(0x12d)},'suppliers_docs':{'$first':_0x43a772(0xca)},'total_product_quantity':{'$sum':_0x43a772(0xea)},'level':{'$addToSet':_0x43a772(0xb8)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x43a772(0x137)},'floorlevel':{'$addToSet':_0x43a772(0x7b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x405cde[0x0]['language']==_0x43a772(0x69))var _0x26acc6=users[_0x43a772(0xb4)];else{if(_0x405cde[0x0]['language']=='Hindi')var _0x26acc6=users[_0x43a772(0x108)];else{if(_0x405cde[0x0][_0x43a772(0xd2)]=='German')var _0x26acc6=users[_0x43a772(0xfd)];else{if(_0x405cde[0x0][_0x43a772(0xd2)]==_0x43a772(0x9a))var _0x26acc6=users[_0x43a772(0x9a)];else{if(_0x405cde[0x0][_0x43a772(0xd2)]==_0x43a772(0x159))var _0x26acc6=users[_0x43a772(0x159)];else{if(_0x405cde[0x0]['language']=='Portuguese\x20(BR)')var _0x26acc6=users[_0x43a772(0xe1)];else{if(_0x405cde[0x0][_0x43a772(0xd2)]==_0x43a772(0x79))var _0x26acc6=users[_0x43a772(0x79)];else{if(_0x405cde[0x0]['language']==_0x43a772(0x144))var _0x26acc6=users[_0x43a772(0xd8)];}}}}}}}_0x431e24[_0x43a772(0x10d)]('all_purchases_finished',{'success':_0x51f179[_0x43a772(0x165)](_0x43a772(0xd9)),'errors':_0x51f179['flash'](_0x43a772(0xf9)),'purchases':_0x104a48,'role':_0x3e6a49,'profile':_0x36537c,'master_shop':_0x405cde,'language':_0x26acc6});}catch(_0x3c6661){console[_0x43a772(0x15e)](_0x43a772(0xd4),_0x3c6661),_0x431e24[_0x43a772(0x92)](0xc8)[_0x43a772(0x152)]({'message':_0x3c6661['message']});}});function BayBinSelected(_0x5f33b4,_0x4f206f){var _0xcc117b=a0_0x4257e5,_0x63b2dc=[],_0x3eb8f5=[];if(_0x5f33b4==_0xcc117b(0xed)){switch(_0x4f206f){case _0xcc117b(0xc5):_0x63b2dc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0xcc117b(0xd5):_0x63b2dc=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3eb8f5=['DG'];}else{if(_0x5f33b4==_0xcc117b(0x98)){switch(_0x4f206f){case'Rack\x201':_0x63b2dc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0xcc117b(0xd5):_0x63b2dc=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3eb8f5=['FG'];}}return{'levels':_0x63b2dc,'identify':_0x3eb8f5};}async function getRandom8DigitNumber(){var _0x216602=a0_0x4257e5;const _0x155ac3=0x989680,_0x1e5ce6=0x5f5e0ff,_0x3b7d6c=Math[_0x216602(0x12c)](Math[_0x216602(0xc1)]()*(_0x1e5ce6-_0x155ac3+0x1))+_0x155ac3;var _0x1bc594;const _0x17aa60=await purchases_finished['findOne']({'invoice':_0x216602(0x7e)+_0x3b7d6c});return _0x17aa60&&_0x17aa60[_0x216602(0x6f)]>0x0?_0x1bc594=_0x216602(0x7e)+_0x3b7d6c:_0x1bc594=_0x216602(0x7e)+_0x3b7d6c,_0x1bc594;}router[a0_0x4257e5(0xbf)](a0_0x4257e5(0xe8),auth,async(_0x34d7e4,_0x5b241b)=>{var _0x174acc=a0_0x4257e5;try{const {username:_0x221b9f,email:_0x297fa1,role:_0x54727d}=_0x34d7e4['user'],_0x5d0357=_0x34d7e4[_0x174acc(0x88)],_0x1a454e=await profile[_0x174acc(0x117)]({'email':_0x5d0357['email']}),_0x983aff=await master_shop[_0x174acc(0x12a)](),_0x5dda22=await staff[_0x174acc(0x117)]({'email':_0x5d0357[_0x174acc(0x11b)]}),_0x3019af=await suppliers[_0x174acc(0x12a)]({});let _0x24b11e;if(_0x5d0357['role']==_0x174acc(0x109)){const _0x376b47=await staff[_0x174acc(0x117)]({'email':_0x5d0357[_0x174acc(0x11b)]});_0x24b11e=await warehouse[_0x174acc(0x103)]([{'$match':{'status':_0x174acc(0x149),'name':_0x376b47[_0x174acc(0x10c)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x174acc(0x12e)}}}]);}else _0x24b11e=await warehouse[_0x174acc(0x103)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0x174acc(0xb6)}}},{'$group':{'_id':_0x174acc(0x12e),'name':{'$first':_0x174acc(0x12e)}}}]);const _0x2232c2=await product[_0x174acc(0x12a)]({}),_0x151570=await warehouse['find']({'status':_0x174acc(0x149)}),_0x472ca0=await purchases_finished[_0x174acc(0x12a)]({}),_0x9397e2=_0x472ca0['length']+0x1,_0x4b02fc='INCF-'+_0x9397e2['toString']()[_0x174acc(0xce)](0x5,'0');var _0x44d635=[_0x174acc(0xa5),_0x174acc(0xf4)];if(_0x983aff[0x0]['language']==_0x174acc(0x69))var _0x387419=users[_0x174acc(0xb4)];else{if(_0x983aff[0x0][_0x174acc(0xd2)]=='Hindi')var _0x387419=users['Hindi'];else{if(_0x983aff[0x0][_0x174acc(0xd2)]==_0x174acc(0xfd))var _0x387419=users['German'];else{if(_0x983aff[0x0][_0x174acc(0xd2)]==_0x174acc(0x9a))var _0x387419=users[_0x174acc(0x9a)];else{if(_0x983aff[0x0]['language']=='French')var _0x387419=users['French'];else{if(_0x983aff[0x0][_0x174acc(0xd2)]=='Portuguese\x20(BR)')var _0x387419=users['Portuguese'];else{if(_0x983aff[0x0][_0x174acc(0xd2)]==_0x174acc(0x79))var _0x387419=users[_0x174acc(0x79)];else{if(_0x983aff[0x0][_0x174acc(0xd2)]==_0x174acc(0x144))var _0x387419=users['Arabic'];}}}}}}}const _0x4b6b47=getRandom8DigitNumber();_0x4b6b47[_0x174acc(0x112)](_0x32154d=>{var _0x4ce87a=_0x174acc;_0x5b241b[_0x4ce87a(0x10d)]('add_purchases_finished',{'success':_0x34d7e4[_0x4ce87a(0x165)](_0x4ce87a(0xd9)),'errors':_0x34d7e4[_0x4ce87a(0x165)](_0x4ce87a(0xf9)),'role':_0x5d0357,'profile':_0x1a454e,'suppliers':_0x3019af,'warehouse':_0x24b11e,'product':_0x2232c2,'invoice':_0x32154d,'master_shop':_0x983aff,'language':_0x387419,'find_data':_0x151570,'rooms_data':_0x44d635});})['catch'](_0x2d170d=>{var _0x16c767=_0x174acc;_0x34d7e4['flash'](_0x16c767(0xf9),_0x16c767(0x107)),_0x5b241b[_0x16c767(0x11d)](_0x16c767(0x147));});}catch(_0x2b981d){console[_0x174acc(0x15e)](_0x2b981d);}}),router['get'](a0_0x4257e5(0xad),auth,async(_0x2422ea,_0x38fe3b)=>{var _0x3b44a9=a0_0x4257e5;try{const _0x429454=_0x2422ea['params']['id'];console['log'](_0x429454);const _0x4ca4cd=await master_shop[_0x3b44a9(0x12a)]();console[_0x3b44a9(0x15e)](_0x3b44a9(0x96),_0x4ca4cd);const _0x1773b5=await product[_0x3b44a9(0x117)]({'name':_0x429454});console[_0x3b44a9(0x15e)](_0x3b44a9(0xf8),_0x1773b5),_0x38fe3b[_0x3b44a9(0x92)](0xc8)[_0x3b44a9(0x152)]({'product_data':_0x1773b5,'master':_0x4ca4cd});}catch(_0x3da8ec){console[_0x3b44a9(0x15e)](_0x3b44a9(0x161),_0x3da8ec);}}),router[a0_0x4257e5(0x140)](a0_0x4257e5(0xe8),auth,async(_0xea686c,_0x5eddf1)=>{var _0x2d450b=a0_0x4257e5;try{const {invoice:_0x31857f,date:_0x4c1190,warehouse_name:_0x32b82a,prod_name:_0x41a90d,prod_code:_0x2bbbb2,prod_qty:_0x31e850,prod_unit:_0x344577,prod_secondunit:_0x5bb100,prod_level:_0x471634,prod_isle:_0x4fd1c0,prod_pallet:_0x99142c,note:_0x4718b9,expiry_date:_0x41f5d1,batch_code:_0x3403f2,payable:_0x191658,due_amount:_0x561bd2,Room_name:_0x1bee81,primary_code:_0x48725e,secondary_code:_0x5e8c6a,MaxStocks_data:_0x6f2f60,PO_number:_0x537979,SCRN:_0x3cd405,JO_number:_0x4cbda0}=_0xea686c[_0x2d450b(0x14a)];if(typeof _0x41a90d=='string')var _0x8f1246=[_0xea686c[_0x2d450b(0x14a)][_0x2d450b(0x13d)]],_0x1da147=[_0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xcb)]],_0x37d206=[_0xea686c[_0x2d450b(0x14a)][_0x2d450b(0x85)]],_0xf3ac3a=[_0xea686c['body'][_0x2d450b(0xac)]],_0x360496=[_0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xaf)]],_0x12b16e=[_0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xf6)]],_0xc70d29=[_0xea686c[_0x2d450b(0x14a)]['primary_code']],_0x439401=[_0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xdc)]],_0x2a301e=[_0xea686c['body'][_0x2d450b(0xc4)]],_0x1752fb=[_0xea686c['body'][_0x2d450b(0xa4)]],_0x5dff63=[_0xea686c[_0x2d450b(0x14a)][_0x2d450b(0x8c)]],_0x1fcfbf=[_0xea686c[_0x2d450b(0x14a)]['product_date']],_0x245a0a=[_0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xd3)]],_0x3206f0=[_0xea686c[_0x2d450b(0x14a)]['prod_cat']],_0x18b862=[_0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xff)]],_0x42577b=[_0xea686c['body'][_0x2d450b(0xf1)]];else var _0x8f1246=[..._0xea686c[_0x2d450b(0x14a)][_0x2d450b(0x13d)]],_0x1da147=[..._0xea686c[_0x2d450b(0x14a)]['prod_code']],_0x37d206=[..._0xea686c[_0x2d450b(0x14a)]['prod_Qty']],_0xf3ac3a=[..._0xea686c['body'][_0x2d450b(0xac)]],_0x360496=[..._0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xaf)]],_0x12b16e=[..._0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xf6)]],_0xc70d29=[..._0xea686c[_0x2d450b(0x14a)]['primary_code']],_0x439401=[..._0xea686c[_0x2d450b(0x14a)]['secondary_code']],_0x2a301e=[..._0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xc4)]],_0x1752fb=[..._0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xa4)]],_0x5dff63=[..._0xea686c['body'][_0x2d450b(0x8c)]],_0x1fcfbf=[..._0xea686c[_0x2d450b(0x14a)][_0x2d450b(0x75)]],_0x245a0a=[..._0xea686c[_0x2d450b(0x14a)]['max_product_unit']],_0x3206f0=[..._0xea686c['body'][_0x2d450b(0x89)]],_0x18b862=[..._0xea686c[_0x2d450b(0x14a)][_0x2d450b(0xff)]],_0x42577b=[..._0xea686c['body']['prod_invoice']];const _0x3fc5ec=_0x8f1246[_0x2d450b(0xcd)](_0x59bef2=>{return _0x59bef2={'product_name':_0x59bef2};});_0x1da147['forEach']((_0x3f23dd,_0x3069cb)=>{var _0x68b013=_0x2d450b;_0x3fc5ec[_0x3069cb][_0x68b013(0x7a)]=_0x3f23dd;}),_0x37d206[_0x2d450b(0x77)]((_0x571e65,_0x41518a)=>{var _0x9ace8a=_0x2d450b;_0x3fc5ec[_0x41518a][_0x9ace8a(0xd0)]=Math['abs'](_0x571e65);}),_0xf3ac3a[_0x2d450b(0x77)]((_0x46b1d4,_0x437c33)=>{var _0x13b391=_0x2d450b;_0x3fc5ec[_0x437c33][_0x13b391(0x129)]=_0x46b1d4;}),_0x360496['forEach']((_0xd89cb1,_0x931eac)=>{var _0x988983=_0x2d450b;_0x3fc5ec[_0x931eac][_0x988983(0xdf)]=_0xd89cb1;}),_0x12b16e['forEach']((_0x1f62bd,_0x796777)=>{var _0x366931=_0x2d450b;_0x3fc5ec[_0x796777][_0x366931(0x6b)]=_0x1f62bd;}),_0xc70d29[_0x2d450b(0x77)]((_0x5cb752,_0x1d24d4)=>{var _0x187b27=_0x2d450b;_0x3fc5ec[_0x1d24d4][_0x187b27(0x163)]=_0x5cb752;}),_0x439401[_0x2d450b(0x77)]((_0x33fe0a,_0x4a475e)=>{var _0x102308=_0x2d450b;_0x3fc5ec[_0x4a475e][_0x102308(0xdc)]=_0x33fe0a;}),_0x2a301e[_0x2d450b(0x77)]((_0x223567,_0x15a88f)=>{var _0x2766c3=_0x2d450b;_0x3fc5ec[_0x15a88f][_0x2766c3(0x6d)]=_0x223567;}),_0x1752fb[_0x2d450b(0x77)]((_0x4fa95b,_0x502e95)=>{_0x3fc5ec[_0x502e95]['batch_code']=_0x4fa95b;}),_0x5dff63[_0x2d450b(0x77)]((_0x3e7b47,_0x290409)=>{_0x3fc5ec[_0x290409]['expiry_date']=_0x3e7b47;}),_0x1fcfbf[_0x2d450b(0x77)]((_0x10897f,_0x4561ff)=>{_0x3fc5ec[_0x4561ff]['production_date']=_0x10897f;}),_0x245a0a[_0x2d450b(0x77)]((_0x3e7f3c,_0x1afd81)=>{var _0x1430d1=_0x2d450b;_0x3fc5ec[_0x1afd81][_0x1430d1(0x11c)]=_0x3e7f3c;}),_0x3206f0[_0x2d450b(0x77)]((_0x1cd996,_0x1bbf28)=>{var _0x579621=_0x2d450b;_0x3fc5ec[_0x1bbf28][_0x579621(0xa0)]=_0x1cd996;}),_0x18b862['forEach']((_0x207761,_0x424f77)=>{var _0x17fcfe=_0x2d450b;_0x3fc5ec[_0x424f77][_0x17fcfe(0xeb)]=_0x207761;}),_0x42577b[_0x2d450b(0x77)]((_0x381fcc,_0x3d2704)=>{_0x3fc5ec[_0x3d2704]['invoice']=_0x381fcc;});const _0x3139f9=_0x3fc5ec[_0x2d450b(0x72)](_0x270ba7=>_0x270ba7['quantity']!=='0'&&_0x270ba7['quantity']!==''),_0x246f6d=new purchases_finished({'invoice':_0x31857f,'suppliers':_0xea686c['body'][_0x2d450b(0xa7)],'date':_0x4c1190,'warehouse_name':_0x32b82a,'product':_0x3139f9,'note':_0x4718b9,'due_amount':_0x561bd2,'room':_0x1bee81,'POnumber':_0x537979,'SCRN':_0x3cd405,'JO_number':_0x4cbda0}),_0x200b92=await _0x246f6d[_0x2d450b(0x10a)](),_0x70656c=await purchases_finished[_0x2d450b(0x117)]({'invoice':_0x31857f}),_0x155c35=_0x70656c[_0x2d450b(0xf8)][_0x2d450b(0xcd)](async _0x5f48a5=>{var _0x3f46ea=_0x2d450b,_0x24a482=await warehouse[_0x3f46ea(0x117)]({'name':_0x32b82a,'room':_0x5f48a5[_0x3f46ea(0xeb)]}),_0x28d29d=0x0;const _0x73332b=_0x24a482[_0x3f46ea(0xc3)]['map'](_0x37df43=>{var _0x91fc5=_0x3f46ea;console[_0x91fc5(0x15e)](_0x37df43[_0x91fc5(0xbc)]+'=='+_0x5f48a5[_0x91fc5(0xbc)]+'&&'+_0x37df43[_0x91fc5(0x6b)]+'=='+_0x5f48a5['bay']+'&&'+_0x37df43['expiry_date']+'=='+_0x5f48a5['expiry_date']+'&&'+_0x37df43[_0x91fc5(0x164)]+'=='+_0x5f48a5[_0x91fc5(0x164)]+'&&'+_0x37df43[_0x91fc5(0xa4)]+'=='+_0x5f48a5['batch_code']+'&&'+_0x37df43[_0x91fc5(0xc6)]+'=='+_0x70656c[_0x91fc5(0xc6)]),_0x37df43['product_name']==_0x5f48a5[_0x91fc5(0xbc)]&&_0x37df43[_0x91fc5(0x6b)]==_0x5f48a5['bay']&&_0x37df43[_0x91fc5(0x8c)]==_0x5f48a5['expiry_date']&&_0x37df43[_0x91fc5(0x164)]==_0x5f48a5[_0x91fc5(0x164)]&&_0x37df43[_0x91fc5(0xa4)]==_0x5f48a5[_0x91fc5(0xa4)]&&_0x37df43[_0x91fc5(0xc6)]==_0x70656c[_0x91fc5(0xc6)]&&(_0x37df43[_0x91fc5(0x125)]=Math[_0x91fc5(0x138)](_0x37df43[_0x91fc5(0x125)])+Math[_0x91fc5(0x138)](_0x5f48a5[_0x91fc5(0xd0)]),_0x28d29d++);});return _0x28d29d=='0'&&(_0x24a482[_0x3f46ea(0xc3)]=_0x24a482['product_details']['concat']({'product_name':_0x5f48a5['product_name'],'product_stock':Math['abs'](_0x5f48a5[_0x3f46ea(0xd0)]),'primary_code':_0x5f48a5[_0x3f46ea(0x163)],'secondary_code':_0x5f48a5[_0x3f46ea(0xdc)],'product_code':_0x5f48a5['product_code'],'bay':_0x5f48a5[_0x3f46ea(0x6b)],'maxProducts':_0x5f48a5[_0x3f46ea(0x6d)],'unit':_0x5f48a5[_0x3f46ea(0x129)],'secondary_unit':_0x5f48a5[_0x3f46ea(0xdf)],'expiry_date':_0x5f48a5[_0x3f46ea(0x8c)],'production_date':_0x5f48a5[_0x3f46ea(0x164)],'maxProducts':_0x5f48a5[_0x3f46ea(0x6d)],'maxPerUnit':_0x5f48a5[_0x3f46ea(0x11c)],'batch_code':_0x5f48a5[_0x3f46ea(0xa4)],'product_cat':_0x5f48a5['product_cat'],'invoice':_0x5f48a5[_0x3f46ea(0xc6)]})),_0x24a482;});Promise[_0x2d450b(0x139)](_0x155c35)['then'](async _0x984e4c=>{var _0x2c1d07=_0x2d450b;try{for(const _0x22ed01 of _0x984e4c){await warehouse[_0x2c1d07(0x131)]({'_id':_0x22ed01[_0x2c1d07(0xc2)]},{'$addToSet':{'product_details':{'$each':_0x22ed01[_0x2c1d07(0xc3)]}}});}const _0x1d4f37=await master_shop[_0x2c1d07(0x12a)](),_0x13b20d=await email_settings[_0x2c1d07(0x117)](),_0x546c89=await supervisor_settings['find']();var _0x961c7b=_0x70656c[_0x2c1d07(0xf8)],_0x157b35='',_0x5f31a2;for(_0x5f31a2 in _0x961c7b){var _0x374546='FG';_0x70656c[_0x2c1d07(0xb3)]=='DRY\x20GOODS'&&(_0x374546='DG'),_0x157b35+=_0x2c1d07(0xfc)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x961c7b[_0x5f31a2][_0x2c1d07(0xbc)]+_0x2c1d07(0x80)+_0x2c1d07(0x167)+_0x961c7b[_0x5f31a2][_0x2c1d07(0x7a)]+_0x2c1d07(0x80)+_0x2c1d07(0x167)+_0x961c7b[_0x5f31a2]['quantity']+_0x2c1d07(0x80)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x961c7b[_0x5f31a2][_0x2c1d07(0x129)]+_0x2c1d07(0x80)+_0x2c1d07(0x167)+_0x961c7b[_0x5f31a2]['secondary_unit']+_0x2c1d07(0x80)+_0x2c1d07(0x167)+_0x70656c[_0x2c1d07(0xb3)]+_0x2c1d07(0x80)+_0x2c1d07(0x167)+_0x961c7b[_0x5f31a2]['room_name']+_0x2c1d07(0x80)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x374546+_0x961c7b[_0x5f31a2][_0x2c1d07(0x6b)]+'</td>',_0x2c1d07(0xf3);}let _0x280109=nodemailer[_0x2c1d07(0x134)]({'host':_0x13b20d['host'],'port':Number(_0x13b20d[_0x2c1d07(0xbd)]),'secure':![],'auth':{'user':_0x13b20d['email'],'pass':_0x13b20d[_0x2c1d07(0x8a)]}}),_0x82413e={'from':_0x13b20d['email'],'to':_0x546c89[0x0][_0x2c1d07(0x155)],'subject':_0x2c1d07(0x168),'attachments':[{'filename':_0x2c1d07(0x166),'path':__dirname+_0x2c1d07(0x110)+'/upload/'+_0x1d4f37[0x0][_0x2c1d07(0x154)],'cid':'logo'}],'html':_0x2c1d07(0xe0)+_0x2c1d07(0xb5)+_0x2c1d07(0x150)+_0x2c1d07(0x106)+_0x2c1d07(0x15a)+'<div>'+_0x2c1d07(0xbe)+_0x2c1d07(0x102)+_0x2c1d07(0x106)+_0x2c1d07(0xfb)+_0x1d4f37[0x0]['site_title']+_0x2c1d07(0xa6)+_0x2c1d07(0x102)+_0x2c1d07(0x102)+'<hr\x20class=\x22my-3\x22>'+_0x2c1d07(0x106)+_0x2c1d07(0x157)+_0x2c1d07(0xc7)+_0x70656c[_0x2c1d07(0xc6)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2c1d07(0x153)+_0x70656c[_0x2c1d07(0x8f)]+'\x20'+_0x2c1d07(0x9f)+_0x2c1d07(0x13f)+_0x2c1d07(0x102)+_0x2c1d07(0x82)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2c1d07(0xfc)+_0x2c1d07(0xae)+_0x2c1d07(0x74)+_0x2c1d07(0x87)+_0x2c1d07(0x11a)+_0x2c1d07(0x120)+_0x2c1d07(0xe9)+_0x2c1d07(0x97)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x2c1d07(0x105)+_0x2c1d07(0x151)+'\x20'+_0x157b35+'\x20'+_0x2c1d07(0x127)+'</table>'+_0x2c1d07(0x106)+_0x2c1d07(0x83)+_0x2c1d07(0x73)+_0x1d4f37[0x0][_0x2c1d07(0x14e)]+_0x2c1d07(0x13f)+_0x2c1d07(0x102)+_0x2c1d07(0x102)+_0x2c1d07(0x100)};_0x280109[_0x2c1d07(0x86)](_0x82413e,function(_0x1a1a81,_0x5e05aa){var _0x2ea128=_0x2c1d07;_0x1a1a81?(console[_0x2ea128(0x15e)](_0x1a1a81),console[_0x2ea128(0x15e)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');});}catch(_0x469044){console[_0x2c1d07(0x115)](_0x469044),_0x5eddf1['status'](0x1f4)[_0x2c1d07(0x152)]({'error':_0x2c1d07(0x8e),'message':_0x469044[_0x2c1d07(0x135)]});}})[_0x2d450b(0x8b)](_0x3bbd09=>{var _0x11ad9c=_0x2d450b;console[_0x11ad9c(0x115)](_0x3bbd09),_0x5eddf1[_0x11ad9c(0x92)](0x1f4)[_0x11ad9c(0x152)]({'error':_0x11ad9c(0xcc)});}),_0xea686c[_0x2d450b(0x165)](_0x2d450b(0xd9),'purchase\x20data\x20add\x20successfully'),_0x5eddf1['redirect'](_0x2d450b(0x147));}catch(_0x316bcf){console['log'](_0x316bcf);}}),router['get'](a0_0x4257e5(0x78),auth,async(_0x4b8ba4,_0x1ba6f4)=>{var _0x5ce531=a0_0x4257e5;try{const {username:_0x4b795b,email:_0x282b91,role:_0x57c6ec}=_0x4b8ba4[_0x5ce531(0x88)],_0x2d8ba0=_0x4b8ba4['user'],_0x5d7f60=await profile[_0x5ce531(0x117)]({'email':_0x2d8ba0[_0x5ce531(0x11b)]}),_0x15177d=await master_shop[_0x5ce531(0x12a)](),_0x49c146=_0x4b8ba4[_0x5ce531(0xbb)]['id'],_0x480a10=await purchases_finished[_0x5ce531(0x148)](_0x49c146),_0x250324=await suppliers[_0x5ce531(0x12a)]({});let _0x496254;if(_0x2d8ba0[_0x5ce531(0x11f)]==_0x5ce531(0x109)){const _0x3728b3=await staff['findOne']({'email':_0x2d8ba0[_0x5ce531(0x11b)]});_0x496254=await warehouse[_0x5ce531(0x12a)]({'status':_0x5ce531(0x149),'name':_0x3728b3[_0x5ce531(0x10c)],'warehouse_category':_0x5ce531(0x15d)});}else _0x496254=await warehouse[_0x5ce531(0x103)]([{'$match':{'status':_0x5ce531(0x149),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x5ce531(0x12e),'name':{'$first':_0x5ce531(0x12e)}}}]);const _0x1f475b=await product[_0x5ce531(0x12a)]({}),_0x11cf5d=BayBinSelected(_0x480a10[_0x5ce531(0xb3)],_0x480a10[_0x5ce531(0x111)]);let _0x4d06df=new Date(_0x480a10[_0x5ce531(0x8c)]),_0x5b4185=('0'+_0x4d06df[_0x5ce531(0x13c)]())[_0x5ce531(0xd1)](-0x2),_0x36407f=('0'+(_0x4d06df[_0x5ce531(0xf0)]()+0x1))[_0x5ce531(0xd1)](-0x2),_0x4c32ee=_0x4d06df[_0x5ce531(0x121)](),_0x5d82a7=_0x4c32ee+'-'+_0x36407f+'-'+_0x5b4185;if(_0x15177d[0x0][_0x5ce531(0xd2)]==_0x5ce531(0x69)){var _0x30f45a=users[_0x5ce531(0xb4)];console['log'](_0x30f45a);}else{if(_0x15177d[0x0][_0x5ce531(0xd2)]==_0x5ce531(0x108))var _0x30f45a=users['Hindi'];else{if(_0x15177d[0x0]['language']==_0x5ce531(0xfd))var _0x30f45a=users[_0x5ce531(0xfd)];else{if(_0x15177d[0x0][_0x5ce531(0xd2)]==_0x5ce531(0x9a))var _0x30f45a=users['Spanish'];else{if(_0x15177d[0x0][_0x5ce531(0xd2)]==_0x5ce531(0x159))var _0x30f45a=users[_0x5ce531(0x159)];else{if(_0x15177d[0x0]['language']==_0x5ce531(0x14b))var _0x30f45a=users['Portuguese'];else{if(_0x15177d[0x0][_0x5ce531(0xd2)]=='Chinese')var _0x30f45a=users[_0x5ce531(0x79)];else{if(_0x15177d[0x0][_0x5ce531(0xd2)]==_0x5ce531(0x144))var _0x30f45a=users[_0x5ce531(0xd8)];}}}}}}}_0x1ba6f4['render'](_0x5ce531(0x123),{'success':_0x4b8ba4[_0x5ce531(0x165)](_0x5ce531(0xd9)),'errors':_0x4b8ba4[_0x5ce531(0x165)]('errors'),'role':_0x2d8ba0,'profile':_0x5d7f60,'purchases':_0x480a10,'suppliers':_0x250324,'warehouse':_0x496254,'product':_0x1f475b,'master_shop':_0x15177d,'language':_0x30f45a,'ed_fullDate':_0x5d82a7,'dataSelected':_0x11cf5d});}catch(_0x36c426){console[_0x5ce531(0x15e)](_0x36c426);}}),router[a0_0x4257e5(0xbf)](a0_0x4257e5(0x6a),auth,async(_0x28559e,_0x118479)=>{var _0x127505=a0_0x4257e5;try{const {username:_0x57de2e,email:_0x4687be,role:_0x5afc0f}=_0x28559e[_0x127505(0x88)],_0xdf73e7=_0x28559e[_0x127505(0x88)],_0x2fbfbb=await profile[_0x127505(0x117)]({'email':_0xdf73e7[_0x127505(0x11b)]}),_0x1bf03a=await master_shop[_0x127505(0x12a)](),_0x279379=_0x28559e['params']['id'],_0x417dd0=await purchases_finished['findById'](_0x279379),_0xccd42e=await suppliers['find']({});let _0x460f09;if(_0xdf73e7[_0x127505(0x11f)]==_0x127505(0x109)){const _0x39da90=await staff[_0x127505(0x117)]({'email':_0xdf73e7[_0x127505(0x11b)]});_0x460f09=await warehouse[_0x127505(0x12a)]({'status':'Enabled','name':_0x39da90['warehouse'],'warehouse_category':_0x127505(0x15d)});}else _0x460f09=await warehouse[_0x127505(0x103)]([{'$match':{'status':_0x127505(0x149),'warehouse_category':_0x127505(0x15d)}},{'$group':{'_id':_0x127505(0x12e),'name':{'$first':_0x127505(0x12e)}}}]);const _0x109066=await product[_0x127505(0x12a)]({}),_0x15f642=BayBinSelected(_0x417dd0[_0x127505(0xb3)],_0x417dd0[_0x127505(0x111)]);let _0x18d1e8=new Date(_0x417dd0[_0x127505(0x8c)]),_0x5a8188=('0'+_0x18d1e8[_0x127505(0x13c)]())['slice'](-0x2),_0xce329d=('0'+(_0x18d1e8['getMonth']()+0x1))[_0x127505(0xd1)](-0x2),_0x111dac=_0x18d1e8[_0x127505(0x121)](),_0xf114aa=_0x111dac+'-'+_0xce329d+'-'+_0x5a8188;if(_0x1bf03a[0x0]['language']==_0x127505(0x69)){var _0x139fe6=users[_0x127505(0xb4)];console[_0x127505(0x15e)](_0x139fe6);}else{if(_0x1bf03a[0x0][_0x127505(0xd2)]==_0x127505(0x108))var _0x139fe6=users['Hindi'];else{if(_0x1bf03a[0x0][_0x127505(0xd2)]=='German')var _0x139fe6=users['German'];else{if(_0x1bf03a[0x0][_0x127505(0xd2)]==_0x127505(0x9a))var _0x139fe6=users[_0x127505(0x9a)];else{if(_0x1bf03a[0x0]['language']=='French')var _0x139fe6=users[_0x127505(0x159)];else{if(_0x1bf03a[0x0][_0x127505(0xd2)]==_0x127505(0x14b))var _0x139fe6=users[_0x127505(0xe1)];else{if(_0x1bf03a[0x0][_0x127505(0xd2)]==_0x127505(0x79))var _0x139fe6=users[_0x127505(0x79)];else{if(_0x1bf03a[0x0][_0x127505(0xd2)]==_0x127505(0x144))var _0x139fe6=users[_0x127505(0xd8)];}}}}}}}_0x118479[_0x127505(0x10d)](_0x127505(0xa1),{'success':_0x28559e[_0x127505(0x165)](_0x127505(0xd9)),'errors':_0x28559e[_0x127505(0x165)](_0x127505(0xf9)),'role':_0xdf73e7,'profile':_0x2fbfbb,'purchases':_0x417dd0,'suppliers':_0xccd42e,'warehouse':_0x460f09,'product':_0x109066,'master_shop':_0x1bf03a,'language':_0x139fe6,'ed_fullDate':_0xf114aa,'dataSelected':_0x15f642});}catch(_0x317931){console[_0x127505(0x15e)](_0x317931);}}),router[a0_0x4257e5(0x140)](a0_0x4257e5(0x6a),auth,async(_0x4c5e62,_0x2e255b)=>{var _0x37ae9a=a0_0x4257e5;try{const _0x4385ba=_0x4c5e62[_0x37ae9a(0xbb)]['id'],_0x2dee28=await purchases_finished['findOne']({'_id':_0x4c5e62[_0x37ae9a(0xbb)]['id']}),_0x5be798=await warehouse['findOne']({'name':_0x2dee28[_0x37ae9a(0xb3)],'room':_0x2dee28[_0x37ae9a(0x111)]});_0x2dee28[_0x37ae9a(0xf8)][_0x37ae9a(0x77)](_0x439513=>{var _0x1248ee=_0x37ae9a;const _0x1714d1=_0x5be798[_0x1248ee(0xc3)]['map'](_0x1a44c3=>{var _0x1fdfed=_0x1248ee;_0x1a44c3[_0x1fdfed(0xbc)]==_0x439513[_0x1fdfed(0xbc)]&&_0x1a44c3[_0x1fdfed(0x6b)]==_0x439513[_0x1fdfed(0x6b)]&&(_0x1a44c3[_0x1fdfed(0x125)]=parseInt(_0x1a44c3[_0x1fdfed(0x125)])-parseInt(_0x439513['quantity']));});}),await _0x5be798[_0x37ae9a(0x10a)]();const {invoice:_0x4f2fe1,suppliers:_0x14140b,date:_0x522c20,warehouse_name:_0x133303,prod_name:_0x48dcac,prod_code:_0xf5830e,prod_qty:_0x495f91,prod_unit:_0x73381a,prod_secondunit:_0x563ff9,prod_level:_0x374169,prod_isle:_0x35a90f,prod_pallet:_0xba1493,note:_0x564ee2,expiry_date:_0x492608,batch_code:_0xfb35a5,paid_amount:_0x563fac,due_amount:_0x5ea9ee,Room_name:_0x530373,primary_code:_0x3f8080,secondary_code:_0x5aa271,PO_number:_0x237a2a,JO_number:_0x5c40d1}=_0x4c5e62[_0x37ae9a(0x14a)];if(typeof _0x48dcac==_0x37ae9a(0x16b))var _0x5c6969=[_0x4c5e62[_0x37ae9a(0x14a)]['prod_name']],_0x1c6f2d=[_0x4c5e62[_0x37ae9a(0x14a)][_0x37ae9a(0xcb)]],_0x41899b=[_0x4c5e62[_0x37ae9a(0x14a)][_0x37ae9a(0x99)]],_0x2fc1a5=[_0x4c5e62['body'][_0x37ae9a(0x12f)]],_0x29ec9d=[_0x4c5e62['body'][_0x37ae9a(0xaf)]],_0x5cf50f=[_0x4c5e62['body']['prod_level']],_0x40c5fc=[_0x4c5e62['body'][_0x37ae9a(0x163)]],_0x2b7239=[_0x4c5e62['body']['secondary_code']],_0xf8ae7f=[_0x4c5e62[_0x37ae9a(0x14a)][_0x37ae9a(0xc4)]],_0x328b65=[_0x4c5e62['body'][_0x37ae9a(0xa4)]],_0x5bd928=[_0x4c5e62['body'][_0x37ae9a(0x8c)]];else var _0x5c6969=[..._0x4c5e62[_0x37ae9a(0x14a)][_0x37ae9a(0x13d)]],_0x1c6f2d=[..._0x4c5e62[_0x37ae9a(0x14a)]['prod_code']],_0x41899b=[..._0x4c5e62[_0x37ae9a(0x14a)]['prod_qty']],_0x2fc1a5=[..._0x4c5e62[_0x37ae9a(0x14a)][_0x37ae9a(0x12f)]],_0x29ec9d=[..._0x4c5e62[_0x37ae9a(0x14a)]['prod_secondunit']],_0x5cf50f=[..._0x4c5e62['body']['prod_level']],_0x40c5fc=[..._0x4c5e62[_0x37ae9a(0x14a)]['primary_code']],_0x2b7239=[..._0x4c5e62['body'][_0x37ae9a(0xdc)]],_0xf8ae7f=[..._0x4c5e62[_0x37ae9a(0x14a)][_0x37ae9a(0xc4)]],_0x328b65=[..._0x4c5e62[_0x37ae9a(0x14a)][_0x37ae9a(0xa4)]],_0x5bd928=[..._0x4c5e62['body'][_0x37ae9a(0x8c)]];const _0x59a3fe=_0x5c6969['map'](_0x19cded=>{return _0x19cded={'product_name':_0x19cded};});_0x1c6f2d[_0x37ae9a(0x77)]((_0xef8dc6,_0x5b7ce9)=>{var _0x301744=_0x37ae9a;_0x59a3fe[_0x5b7ce9][_0x301744(0x7a)]=_0xef8dc6;}),_0x41899b[_0x37ae9a(0x77)]((_0x56d45b,_0x4f69d7)=>{var _0x3a999b=_0x37ae9a;_0x59a3fe[_0x4f69d7][_0x3a999b(0xd0)]=_0x56d45b;}),_0x2fc1a5[_0x37ae9a(0x77)]((_0x345483,_0x5f92be)=>{var _0x3c69e7=_0x37ae9a;_0x59a3fe[_0x5f92be][_0x3c69e7(0x129)]=_0x345483;}),_0x29ec9d[_0x37ae9a(0x77)]((_0x2643f9,_0x4a3301)=>{_0x59a3fe[_0x4a3301]['secondary_unit']=_0x2643f9;}),_0x5cf50f[_0x37ae9a(0x77)]((_0xf62e95,_0x87adff)=>{_0x59a3fe[_0x87adff]['bay']=_0xf62e95;}),_0x40c5fc[_0x37ae9a(0x77)]((_0x99eac0,_0x580cf8)=>{_0x59a3fe[_0x580cf8]['primary_code']=_0x99eac0;}),_0x2b7239['forEach']((_0x4902cb,_0x42f90c)=>{var _0x3022e3=_0x37ae9a;_0x59a3fe[_0x42f90c][_0x3022e3(0xdc)]=_0x4902cb;}),_0xf8ae7f[_0x37ae9a(0x77)]((_0x158ab9,_0x1fdad5)=>{_0x59a3fe[_0x1fdad5]['maxStocks']=_0x158ab9;}),_0x328b65[_0x37ae9a(0x77)]((_0x5096af,_0x76698d)=>{var _0x2f76c2=_0x37ae9a;_0x59a3fe[_0x76698d][_0x2f76c2(0xa4)]=_0x5096af;}),_0x5bd928[_0x37ae9a(0x77)]((_0x55284c,_0x44b7f7)=>{_0x59a3fe[_0x44b7f7]['expiry_date']=_0x55284c;});const _0xe614f7=_0x59a3fe[_0x37ae9a(0x72)](_0x159246=>_0x159246[_0x37ae9a(0xd0)]!=='0'&&_0x159246[_0x37ae9a(0xd0)]!=='');_0x2dee28[_0x37ae9a(0xc6)]=_0x4f2fe1,_0x2dee28[_0x37ae9a(0xa7)]=_0x14140b,_0x2dee28[_0x37ae9a(0x8f)]=_0x522c20,_0x2dee28[_0x37ae9a(0xb3)]=_0x133303,_0x2dee28['product']=_0xe614f7,_0x2dee28[_0x37ae9a(0x169)]=_0x564ee2,_0x2dee28[_0x37ae9a(0x15b)]=_0x563fac,_0x2dee28[_0x37ae9a(0x70)]=_0x5ea9ee,_0x2dee28[_0x37ae9a(0x111)]=_0x530373,_0x2dee28[_0x37ae9a(0x145)]=_0x237a2a,_0x2dee28['JO_number']=_0x5c40d1;const _0x16da09=await _0x2dee28[_0x37ae9a(0x10a)](),_0x4ab4b1=await warehouse[_0x37ae9a(0x117)]({'name':_0x4c5e62[_0x37ae9a(0x14a)][_0x37ae9a(0xb3)],'room':_0x4c5e62[_0x37ae9a(0x14a)][_0x37ae9a(0x142)]});_0x2dee28[_0x37ae9a(0xf8)]['forEach'](_0x4472ad=>{var _0x19eaf0=_0x37ae9a,_0xe81ba8=0x0;const _0x3fd5b8=_0x4ab4b1[_0x19eaf0(0xc3)]['map'](_0x5b09ea=>{var _0x21793e=_0x19eaf0;_0x5b09ea[_0x21793e(0xbc)]==_0x4472ad[_0x21793e(0xbc)]&&_0x5b09ea[_0x21793e(0x6b)]==_0x4472ad[_0x21793e(0x6b)]&&(_0x5b09ea[_0x21793e(0x125)]=parseInt(_0x5b09ea[_0x21793e(0x125)])+parseInt(_0x4472ad['quantity']),_0xe81ba8++);});_0xe81ba8=='0'&&(_0x4ab4b1[_0x19eaf0(0xc3)]=_0x4ab4b1['product_details']['concat']({'product_name':_0x4472ad[_0x19eaf0(0xbc)],'product_stock':_0x4472ad['quantity'],'primary_code':_0x4472ad['primary_code'],'secondary_code':_0x4472ad[_0x19eaf0(0xdc)],'product_code':_0x4472ad[_0x19eaf0(0x7a)],'bay':_0x4472ad[_0x19eaf0(0x6b)],'maxProducts':_0x4472ad[_0x19eaf0(0x6d)],'unit':_0x4472ad[_0x19eaf0(0x129)],'secondary_unit':_0x4472ad['secondary_unit'],'expiry_date':_0x4472ad['expiry_date']}));}),await _0x4ab4b1[_0x37ae9a(0x10a)]();const _0xa82166=await s_payment_data[_0x37ae9a(0x117)]({'invoice':_0x4c5e62['body'][_0x37ae9a(0xc6)]});if(_0xa82166===null){}else console[_0x37ae9a(0x15e)]('suppliers',_0xa82166,_0x4c5e62['body'][_0x37ae9a(0xc6)]),_0xa82166[_0x37ae9a(0xa7)]=_0x4c5e62['body']['suppliers'],await _0xa82166[_0x37ae9a(0x10a)]();_0x4c5e62[_0x37ae9a(0x165)](_0x37ae9a(0xd9),_0x37ae9a(0xa9)),_0x2e255b['redirect'](_0x37ae9a(0x147));}catch(_0x345e1c){console[_0x37ae9a(0x15e)](_0x345e1c);}}),router[a0_0x4257e5(0x140)](a0_0x4257e5(0x13b),auth,async(_0x4dd3a3,_0x23d67c)=>{var _0x1dfce4=a0_0x4257e5;try{const _0x1e90ef=_0x4dd3a3[_0x1dfce4(0xbb)]['id'],{invoice:_0x46a02b,suppliers:_0x3e9a8d,payable:_0x47fc13,due_amount:_0x217b08}=_0x4dd3a3[_0x1dfce4(0x14a)],_0x23cdf1=await purchases['findById'](_0x1e90ef);var _0x5780c7=_0x47fc13-_0x217b08;_0x23cdf1[_0x1dfce4(0x15b)]=parseFloat(_0x23cdf1['paid_amount'])+parseFloat(_0x217b08),_0x23cdf1[_0x1dfce4(0x70)]=_0x5780c7;const _0x27a447=await _0x23cdf1[_0x1dfce4(0x10a)]();console[_0x1dfce4(0x15e)](_0x27a447);const _0x4aa204=await s_payment_data[_0x1dfce4(0x117)]({'invoice':_0x46a02b});_0x4aa204[_0x1dfce4(0x9e)]=_0x5780c7,await _0x4aa204[_0x1dfce4(0x10a)]();let _0x477e4f=new Date(),_0x4e76a8=('0'+_0x477e4f['getDate']())['slice'](-0x2),_0x890d68=('0'+(_0x477e4f['getMonth']()+0x1))[_0x1dfce4(0xd1)](-0x2),_0x112aea=_0x477e4f['getFullYear'](),_0x4c3e94=_0x112aea+'-'+_0x890d68+'-'+_0x4e76a8;const _0x35e31f=new suppliers_payment({'invoice':_0x46a02b,'date':_0x112aea+'-'+_0x890d68+'-'+_0x4e76a8,'suppliers':_0x3e9a8d,'reason':_0x1dfce4(0x66),'amount':_0x217b08}),_0x547585=await _0x35e31f[_0x1dfce4(0x10a)]();_0x4dd3a3['flash'](_0x1dfce4(0xd9),_0x1dfce4(0xcf)),_0x23d67c[_0x1dfce4(0x11d)](_0x1dfce4(0xdb));}catch(_0x38bb2f){console['log'](_0x38bb2f);}}),router[a0_0x4257e5(0xbf)](a0_0x4257e5(0xb0),auth,async(_0x53af87,_0x475a54)=>{var _0x39842a=a0_0x4257e5;try{const {username:_0x5bf7ea,email:_0x4800b1,role:_0x42ad3c}=_0x53af87[_0x39842a(0x88)],_0x545fd4=_0x53af87[_0x39842a(0x88)],_0x43c361=await profile[_0x39842a(0x117)]({'email':_0x545fd4['email']}),_0xde421e=await master_shop[_0x39842a(0x12a)]();console['log'](_0x39842a(0x96),_0xde421e);const _0x90e437=_0x53af87[_0x39842a(0xbb)]['id'],_0x562102=await purchases[_0x39842a(0x148)](_0x90e437);console[_0x39842a(0x15e)](_0x562102);const _0x1fc7af=await suppliers[_0x39842a(0x117)]({'name':_0x562102[_0x39842a(0xa7)]});console[_0x39842a(0x15e)](_0x1fc7af);if(_0xde421e[0x0][_0x39842a(0xd2)]==_0x39842a(0x69)){var _0x83aca2=users[_0x39842a(0xb4)];console['log'](_0x83aca2);}else{if(_0xde421e[0x0][_0x39842a(0xd2)]==_0x39842a(0x108))var _0x83aca2=users['Hindi'];else{if(_0xde421e[0x0][_0x39842a(0xd2)]==_0x39842a(0xfd))var _0x83aca2=users[_0x39842a(0xfd)];else{if(_0xde421e[0x0]['language']==_0x39842a(0x9a))var _0x83aca2=users[_0x39842a(0x9a)];else{if(_0xde421e[0x0][_0x39842a(0xd2)]==_0x39842a(0x159))var _0x83aca2=users[_0x39842a(0x159)];else{if(_0xde421e[0x0][_0x39842a(0xd2)]=='Portuguese\x20(BR)')var _0x83aca2=users['Portuguese'];else{if(_0xde421e[0x0][_0x39842a(0xd2)]=='Chinese')var _0x83aca2=users[_0x39842a(0x79)];else{if(_0xde421e[0x0]['language']==_0x39842a(0x144))var _0x83aca2=users['Arabic'];}}}}}}}_0x475a54[_0x39842a(0x10d)](_0x39842a(0x84),{'success':_0x53af87[_0x39842a(0x165)](_0x39842a(0xd9)),'errors':_0x53af87['flash'](_0x39842a(0xf9)),'role':_0x545fd4,'profile':_0x43c361,'master_shop':_0xde421e,'supplier':_0x1fc7af,'purchase':_0x562102,'language':_0x83aca2});}catch(_0x3cd512){console[_0x39842a(0x15e)](_0x3cd512);}}),router[a0_0x4257e5(0xbf)](a0_0x4257e5(0x8d),auth,async(_0x55667d,_0x13a05f)=>{var _0x530f45=a0_0x4257e5;try{const {username:_0x324086,email:_0x50ef54,role:_0xd1978e}=_0x55667d['user'],_0xd4785a=_0x55667d['user'],_0x3d918b=await profile['findOne']({'email':_0xd4785a[_0x530f45(0x11b)]}),_0x369184=await master_shop[_0x530f45(0x12a)]();console['log'](_0x530f45(0x96),_0x369184);const _0x5baab6=_0x55667d[_0x530f45(0xbb)]['id'];console[_0x530f45(0x15e)](_0x5baab6);const _0x45882d=await purchases_finished['findById'](_0x5baab6);console[_0x530f45(0x15e)](_0x530f45(0xfa),_0x45882d);const _0x507adb=await product[_0x530f45(0x12a)]({}),_0x14f3f0=await warehouse[_0x530f45(0x103)]([{'$match':{'name':_0x45882d[_0x530f45(0xb3)],'room':_0x45882d['room']}},{'$unwind':_0x530f45(0xb2)},{'$group':{'_id':_0x530f45(0x7c),'name':{'$first':_0x530f45(0x104)},'product_stock':{'$first':_0x530f45(0xe4)},'bay':{'$first':_0x530f45(0x71)},'bin':{'$first':_0x530f45(0xba)},'type':{'$first':_0x530f45(0x146)},'floorlevel':{'$first':_0x530f45(0xf2)},'primary_code':{'$first':_0x530f45(0x156)},'secondary_code':{'$first':_0x530f45(0xa3)},'product_code':{'$first':_0x530f45(0x122)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);console[_0x530f45(0x15e)]('stock_data',_0x14f3f0);let _0x2f2baf;if(_0xd4785a[_0x530f45(0x11f)]==_0x530f45(0x109)){const _0x441f2f=await staff[_0x530f45(0x117)]({'email':_0xd4785a[_0x530f45(0x11b)]});_0x2f2baf=await warehouse[_0x530f45(0x12a)]({'status':_0x530f45(0x149),'name':_0x441f2f[_0x530f45(0x10c)],'warehouse_category':_0x530f45(0x15d),'name':'Return\x20Goods'});}else _0x2f2baf=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'}},{'$group':{'_id':_0x530f45(0x12e),'name':{'$first':_0x530f45(0x12e)}}}]);if(_0x369184[0x0][_0x530f45(0xd2)]==_0x530f45(0x69)){var _0x33d553=users[_0x530f45(0xb4)];console[_0x530f45(0x15e)](_0x33d553);}else{if(_0x369184[0x0][_0x530f45(0xd2)]==_0x530f45(0x108))var _0x33d553=users[_0x530f45(0x108)];else{if(_0x369184[0x0]['language']==_0x530f45(0xfd))var _0x33d553=users[_0x530f45(0xfd)];else{if(_0x369184[0x0][_0x530f45(0xd2)]==_0x530f45(0x9a))var _0x33d553=users[_0x530f45(0x9a)];else{if(_0x369184[0x0][_0x530f45(0xd2)]=='French')var _0x33d553=users[_0x530f45(0x159)];else{if(_0x369184[0x0][_0x530f45(0xd2)]==_0x530f45(0x14b))var _0x33d553=users[_0x530f45(0xe1)];else{if(_0x369184[0x0][_0x530f45(0xd2)]==_0x530f45(0x79))var _0x33d553=users[_0x530f45(0x79)];else{if(_0x369184[0x0][_0x530f45(0xd2)]==_0x530f45(0x144))var _0x33d553=users[_0x530f45(0xd8)];}}}}}}}_0x13a05f['render'](_0x530f45(0x128),{'success':_0x55667d[_0x530f45(0x165)](_0x530f45(0xd9)),'errors':_0x55667d[_0x530f45(0x165)]('errors'),'role':_0xd4785a,'profile':_0x3d918b,'user':_0x45882d,'stock':_0x14f3f0,'master_shop':_0x369184,'product':_0x507adb,'language':_0x33d553,'warehouse':_0x2f2baf});}catch(_0x181702){console[_0x530f45(0x15e)](_0x181702);}}),router[a0_0x4257e5(0x140)](a0_0x4257e5(0x8d),auth,async(_0x2155ed,_0x5ea250)=>{var _0x57e552=a0_0x4257e5;try{const {invoice:_0x17bd1b,date:_0x1aa1a0,warehouse_name:_0xce3a78,Room_name:_0x47e37b,product_name:_0x245f99,purchase_quantity:_0xaac865,stocks:_0x89a214,return_qty:_0x31ae64,note:_0x491b77,level:_0x592cc5,isle:_0x36c2bb,pallet:_0x55b543,to_warehouse_name:_0x5291b4,to_Room_name:_0x462e46}=_0x2155ed['body'],_0x1b0c29=await purchases_finished[_0x57e552(0x117)]({'_id':_0x2155ed[_0x57e552(0xbb)]['id']}),_0x152159=await warehouse[_0x57e552(0x117)]({'name':_0xce3a78,'room':_0x47e37b,'warehouse_category':'Finished\x20Goods'});if(typeof _0x245f99=='string')var _0x42a4d6=[_0x2155ed[_0x57e552(0x14a)]['product_name']],_0x483290=[_0x2155ed[_0x57e552(0x14a)][_0x57e552(0xf5)]],_0x2dd8fe=[_0x2155ed[_0x57e552(0x14a)]['stocks']],_0x415182=[_0x2155ed[_0x57e552(0x14a)][_0x57e552(0x118)]],_0x1bdb20=[_0x2155ed[_0x57e552(0x14a)][_0x57e552(0x13a)]],_0x3e9af8=[_0x2155ed[_0x57e552(0x14a)]['product_code_hide']],_0x2ac556=[_0x2155ed[_0x57e552(0x14a)]['primary_code_hide']],_0x108f29=[_0x2155ed['body'][_0x57e552(0x141)]];else var _0x42a4d6=[..._0x2155ed[_0x57e552(0x14a)][_0x57e552(0xbc)]],_0x483290=[..._0x2155ed[_0x57e552(0x14a)][_0x57e552(0xf5)]],_0x2dd8fe=[..._0x2155ed[_0x57e552(0x14a)][_0x57e552(0x6e)]],_0x415182=[..._0x2155ed['body'][_0x57e552(0x118)]],_0x1bdb20=[..._0x2155ed['body'][_0x57e552(0x13a)]],_0x3e9af8=[..._0x2155ed[_0x57e552(0x14a)]['product_code_hide']],_0x2ac556=[..._0x2155ed[_0x57e552(0x14a)][_0x57e552(0x81)]],_0x108f29=[..._0x2155ed[_0x57e552(0x14a)][_0x57e552(0x141)]];const _0x291253=_0x42a4d6[_0x57e552(0xcd)](_0xabc403=>{return _0xabc403={'product_name':_0xabc403};});_0x483290['forEach']((_0x1fea59,_0x524662)=>{var _0xcbdd54=_0x57e552;_0x291253[_0x524662][_0xcbdd54(0xf5)]=_0x1fea59;}),_0x2dd8fe[_0x57e552(0x77)]((_0x3d62f8,_0x1eb0cc)=>{var _0x3a197b=_0x57e552;_0x291253[_0x1eb0cc][_0x3a197b(0x119)]=_0x3d62f8;}),_0x415182[_0x57e552(0x77)]((_0x34a91f,_0x51cc69)=>{var _0x56dc74=_0x57e552;_0x291253[_0x51cc69][_0x56dc74(0x118)]=_0x34a91f;}),_0x1bdb20[_0x57e552(0x77)]((_0x22c3b8,_0x2428e6)=>{var _0x147ba4=_0x57e552;_0x291253[_0x2428e6][_0x147ba4(0x6b)]=_0x22c3b8;}),_0x3e9af8[_0x57e552(0x77)]((_0x399c60,_0x1104a3)=>{var _0x13adec=_0x57e552;_0x291253[_0x1104a3][_0x13adec(0x7a)]=_0x399c60;}),_0x2ac556['forEach']((_0x4b97a6,_0x6e5a8f)=>{var _0x3e1b19=_0x57e552;_0x291253[_0x6e5a8f][_0x3e1b19(0x163)]=_0x4b97a6;}),_0x108f29[_0x57e552(0x77)]((_0x741ed5,_0xfa32dc)=>{var _0x85a680=_0x57e552;_0x291253[_0xfa32dc][_0x85a680(0xdc)]=_0x741ed5;}),_0x291253['forEach'](_0x7b5e1f=>{var _0x352d2b=_0x57e552;console[_0x352d2b(0x15e)](_0x7b5e1f);const _0x53a7f0=_0x152159[_0x352d2b(0xc3)][_0x352d2b(0xcd)](_0x47ba13=>{var _0xcb1df5=_0x352d2b;_0x47ba13[_0xcb1df5(0xbc)]==_0x7b5e1f[_0xcb1df5(0xbc)]&&_0x47ba13[_0xcb1df5(0x6b)]==_0x7b5e1f[_0xcb1df5(0x6b)]&&(console[_0xcb1df5(0x15e)](parseInt(_0x47ba13[_0xcb1df5(0x125)])+_0xcb1df5(0x10f)+parseInt(_0x7b5e1f[_0xcb1df5(0x118)])),_0x47ba13[_0xcb1df5(0x125)]=parseInt(_0x47ba13[_0xcb1df5(0x125)])-parseInt(_0x7b5e1f[_0xcb1df5(0x118)]));});}),await _0x152159[_0x57e552(0x10a)]();var _0x66ef5=0x0;_0x291253[_0x57e552(0x77)](_0x27fdc1=>{var _0xb5de7=_0x57e552;(parseInt(_0x27fdc1['purchase_quantity'])<parseInt(_0x27fdc1[_0xb5de7(0x118)])||parseInt(_0x27fdc1[_0xb5de7(0x119)])<parseInt(_0x27fdc1[_0xb5de7(0x118)]))&&_0x66ef5++;});if(_0x66ef5!=0x0)return _0x2155ed[_0x57e552(0x165)]('errors',_0x57e552(0x95)),_0x5ea250[_0x57e552(0x11d)](_0x57e552(0x91));const _0x3bca32=new purchases_return_finished({'invoice':_0x17bd1b,'suppliers':_0x2155ed[_0x57e552(0x14a)][_0x57e552(0xa7)],'date':_0x1aa1a0,'warehouse_name':_0xce3a78,'return_product':_0x291253,'note':_0x491b77,'room':_0x47e37b,'to_warehouse_name':_0x5291b4,'to_room':_0x462e46}),_0x509457=await _0x3bca32[_0x57e552(0x10a)](),_0xca57a1=await purchases_return_finished[_0x57e552(0x117)]({'invoice':_0x17bd1b}),_0x2abc81=await warehouse[_0x57e552(0x117)]({'name':_0x5291b4,'room':_0x462e46,'warehouse_category':_0x57e552(0x15d)});_0xca57a1[_0x57e552(0xc8)][_0x57e552(0x77)](_0x2b77be=>{var _0xb394eb=_0x57e552,_0x502c88=0x0;const _0xf2fc1e=_0x2abc81['product_details'][_0xb394eb(0xcd)](_0x119afb=>{var _0x3d00cf=_0xb394eb;console[_0x3d00cf(0x15e)](_0x119afb[_0x3d00cf(0xbc)]+'=='+_0x2b77be['product_name']+'&&'+_0x119afb['bay']+'=='+_0x2b77be[_0x3d00cf(0x6b)]),_0x119afb['product_name']==_0x2b77be[_0x3d00cf(0xbc)]&&_0x119afb['bay']==_0x2b77be[_0x3d00cf(0x6b)]&&(_0x119afb[_0x3d00cf(0x125)]=parseInt(_0x119afb[_0x3d00cf(0x125)])-parseInt(_0x2b77be[_0x3d00cf(0x118)]),_0x502c88++);});_0x502c88=='0'&&(_0x2abc81['product_details']=_0x2abc81['product_details'][_0xb394eb(0x15f)]({'product_name':_0x2b77be[_0xb394eb(0xbc)],'product_stock':_0x2b77be['return_qty'],'primary_code':_0x2b77be[_0xb394eb(0x163)],'secondary_code':_0x2b77be[_0xb394eb(0xdc)],'product_code':_0x2b77be[_0xb394eb(0x7a)],'bay':_0x2b77be[_0xb394eb(0x6b)],'maxProducts':0xf423f}));}),await _0x2abc81[_0x57e552(0x10a)]();const _0x325ea4=await purchases_finished[_0x57e552(0x117)]({'invoice':_0x17bd1b});_0x325ea4[_0x57e552(0x116)]=_0x57e552(0x10e);const _0x13ed7f=await _0x325ea4[_0x57e552(0x10a)](),_0x4bc617=new s_payment_data({'invoice':_0x17bd1b,'suppliers':_0x2155ed[_0x57e552(0x14a)][_0x57e552(0xa7)],'reason':_0x57e552(0xc9)});await _0x4bc617[_0x57e552(0x10a)]();const _0x4f52b1=await master_shop['find'](),_0x79a33a=await email_settings['findOne'](),_0x395800=await suppliers['findOne']({'name':_0x2155ed[_0x57e552(0x14a)][_0x57e552(0xa7)]});_0x4f52b1[0x0][_0x57e552(0x6c)]==0x1?(right_currency=_0x4f52b1[0x0][_0x57e552(0xb7)],left_currency=''):(right_currency='',left_currency=_0x4f52b1[0x0]['currency']);var _0x16e6ff=_0x42a4d6,_0x568488=_0x415182,_0x3f22cf='',_0x5c5f32;for(_0x5c5f32 in _0x16e6ff){_0x3f22cf+=_0x57e552(0xfc)+_0x57e552(0x167)+_0x16e6ff[_0x5c5f32]+_0x57e552(0x80)+_0x57e552(0x167)+_0x568488[_0x5c5f32]+_0x57e552(0x80)+_0x57e552(0xf3);}let _0x3473d9=nodemailer[_0x57e552(0x134)]({'service':_0x57e552(0x67),'auth':{'user':_0x79a33a[_0x57e552(0x11b)],'pass':_0x79a33a[_0x57e552(0x8a)]}}),_0x4f8a8f={'from':_0x79a33a[_0x57e552(0x11b)],'to':_0x395800[_0x57e552(0x11b)],'subject':_0x57e552(0x10b),'attachments':[{'filename':_0x57e552(0x166),'path':__dirname+_0x57e552(0x110)+'/upload/'+_0x4f52b1[0x0][_0x57e552(0x154)],'cid':_0x57e552(0xee)}],'html':_0x57e552(0xe0)+'<html><head><title></title>'+_0x57e552(0x150)+_0x57e552(0x106)+_0x57e552(0x15a)+_0x57e552(0x106)+_0x57e552(0xbe)+'</div>'+_0x57e552(0x106)+'<h2>\x20'+_0x4f52b1[0x0][_0x57e552(0x14e)]+'\x20</h2>'+_0x57e552(0x102)+_0x57e552(0x102)+_0x57e552(0x94)+_0x57e552(0x106)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x57e552(0xc7)+_0x17bd1b+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x57e552(0x153)+_0x1aa1a0+'\x20'+'</span>'+_0x57e552(0x13f)+'</div>'+_0x57e552(0x82)+_0x57e552(0x162)+'<tr>'+_0x57e552(0xae)+_0x57e552(0x9d)+_0x57e552(0xe2)+_0x57e552(0xe3)+_0x57e552(0xf3)+'</thead>'+_0x57e552(0x151)+'\x20'+_0x3f22cf+'\x20'+_0x57e552(0x127)+_0x57e552(0x7f)+_0x57e552(0x106)+'<strong>\x20Regards\x20</strong>'+_0x57e552(0x73)+_0x4f52b1[0x0][_0x57e552(0x14e)]+_0x57e552(0x13f)+_0x57e552(0x102)+_0x57e552(0x102)+_0x57e552(0x100)};_0x3473d9[_0x57e552(0x86)](_0x4f8a8f,function(_0x22dc4f,_0x5e6ae5){var _0x5c53d9=_0x57e552;_0x22dc4f?console[_0x5c53d9(0x15e)]('Error\x20Occurs'):console['log']('Email\x20sent\x20successfully');}),_0x2155ed[_0x57e552(0x165)]('success',_0x57e552(0xaa)),_0x5ea250['redirect']('/all_purchases_finished/view');}catch(_0x261015){_0x5ea250[_0x57e552(0x92)](0xc8)[_0x57e552(0x152)]({'message':_0x261015[_0x57e552(0x135)]});}}),router[a0_0x4257e5(0xbf)](a0_0x4257e5(0xfe),auth,async(_0x16b11d,_0x161dab)=>{var _0x320218=a0_0x4257e5;try{const {username:_0x239a85,email:_0xd7f375,role:_0x47b543}=_0x16b11d[_0x320218(0x88)],_0x5a55ac=_0x16b11d[_0x320218(0x88)],_0x78c534=await profile[_0x320218(0x117)]({'email':_0x5a55ac['email']}),_0x3120da=await master_shop['find'](),_0x30dc0a=_0x16b11d[_0x320218(0xbb)]['id'],_0x228d5c=await purchases_finished[_0x320218(0x148)](_0x30dc0a);if(_0x3120da[0x0][_0x320218(0xd2)]==_0x320218(0x69))var _0x320bb1=users[_0x320218(0xb4)];else{if(_0x3120da[0x0][_0x320218(0xd2)]=='Hindi')var _0x320bb1=users[_0x320218(0x108)];else{if(_0x3120da[0x0][_0x320218(0xd2)]==_0x320218(0xfd))var _0x320bb1=users[_0x320218(0xfd)];else{if(_0x3120da[0x0][_0x320218(0xd2)]==_0x320218(0x9a))var _0x320bb1=users[_0x320218(0x9a)];else{if(_0x3120da[0x0][_0x320218(0xd2)]==_0x320218(0x159))var _0x320bb1=users[_0x320218(0x159)];else{if(_0x3120da[0x0][_0x320218(0xd2)]==_0x320218(0x14b))var _0x320bb1=users[_0x320218(0xe1)];else{if(_0x3120da[0x0][_0x320218(0xd2)]==_0x320218(0x79))var _0x320bb1=users['Chinese'];else{if(_0x3120da[0x0]['language']==_0x320218(0x144))var _0x320bb1=users['Arabic'];}}}}}}}_0x161dab[_0x320218(0x10d)](_0x320218(0x14d),{'success':_0x16b11d[_0x320218(0x165)](_0x320218(0xd9)),'errors':_0x16b11d['flash'](_0x320218(0xf9)),'role':_0x5a55ac,'profile':_0x78c534,'alldata':_0x228d5c,'master_shop':_0x3120da,'language':_0x320bb1}),console[_0x320218(0x15e)](alldata);}catch(_0x5710d7){console[_0x320218(0x15e)](_0x5710d7);}}),router['post'](a0_0x4257e5(0x101),async(_0x203b60,_0x588da1)=>{var _0x4391b5=a0_0x4257e5;const {product_code:_0x4d2a22}=_0x203b60[_0x4391b5(0x14a)];var _0x32dc60;const _0x390c97=await product[_0x4391b5(0x103)]([{'$match':{'primary_code':_0x4d2a22,'product_category':_0x4391b5(0x15d)}},{'$group':{'_id':_0x4391b5(0xdd),'name':{'$first':'$name'},'category':{'$first':_0x4391b5(0x14c)},'brand':{'$first':_0x4391b5(0xde)},'unit':{'$first':_0x4391b5(0x68)},'alertquantity':{'$first':_0x4391b5(0x132)},'product_code':{'$first':_0x4391b5(0x143)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x4391b5(0x90)},'maxStocks':{'$first':_0x4391b5(0x9b)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4391b5(0xf7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x51f82c=await product['aggregate']([{'$match':{'secondary_code':_0x4d2a22}},{'$group':{'_id':_0x4391b5(0xdd),'name':{'$first':_0x4391b5(0x12e)},'category':{'$first':_0x4391b5(0x14c)},'brand':{'$first':_0x4391b5(0xde)},'unit':{'$first':_0x4391b5(0x68)},'alertquantity':{'$first':_0x4391b5(0x132)},'product_code':{'$first':_0x4391b5(0x143)},'primary_code':{'$first':_0x4391b5(0xb1)},'secondary_code':{'$first':_0x4391b5(0x90)},'maxStocks':{'$first':_0x4391b5(0x9b)},'maxProdPerUnit':{'$first':_0x4391b5(0x15c)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4391b5(0xf7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x390c97['length']>0x0)_0x32dc60=_0x390c97;else _0x51f82c['length']>0x0&&(_0x32dc60=_0x51f82c);_0x588da1['json'](_0x32dc60);}),router[a0_0x4257e5(0x140)](a0_0x4257e5(0xa8),async(_0x47af8f,_0x4ab0a8)=>{var _0x4bfcdb=a0_0x4257e5;const {productCode:_0x4bd1f4,bay:_0x2813a8,warehouses:_0x263cc4,room:_0x493064}=_0x47af8f[_0x4bfcdb(0x14a)];console[_0x4bfcdb(0x15e)](_0x47af8f[_0x4bfcdb(0x14a)]);try{const _0x246f00=await warehouse['aggregate']([{'$match':{'name':_0x263cc4,'room':_0x493064}},{'$unwind':_0x4bfcdb(0xb2)},{'$match':{'product_details.bay':parseInt(_0x2813a8)}},{'$group':{'_id':_0x4bfcdb(0x7c),'name':{'$first':_0x4bfcdb(0x104)},'product_stock':{'$first':_0x4bfcdb(0xe4)},'bay':{'$first':_0x4bfcdb(0x71)},'maxProducts':{'$first':_0x4bfcdb(0x76)}}}]);_0x4ab0a8[_0x4bfcdb(0x92)](0xc8)[_0x4bfcdb(0x152)](_0x246f00);}catch(_0x11341f){_0x4ab0a8['status'](0x194)[_0x4bfcdb(0x152)]({'message':_0x11341f[_0x4bfcdb(0x135)]});}}),module[a0_0x4257e5(0xd6)]=router;