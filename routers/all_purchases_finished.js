var a0_0x3af37a=a0_0x21cb;(function(_0x57303e,_0x4a6763){var _0x45bdc7=a0_0x21cb,_0x31c85e=_0x57303e();while(!![]){try{var _0x55974b=parseInt(_0x45bdc7(0x154))/0x1+-parseInt(_0x45bdc7(0x13d))/0x2+parseInt(_0x45bdc7(0x15c))/0x3*(-parseInt(_0x45bdc7(0xfe))/0x4)+-parseInt(_0x45bdc7(0x12c))/0x5+-parseInt(_0x45bdc7(0xd5))/0x6+-parseInt(_0x45bdc7(0x11c))/0x7*(-parseInt(_0x45bdc7(0x15f))/0x8)+parseInt(_0x45bdc7(0x91))/0x9;if(_0x55974b===_0x4a6763)break;else _0x31c85e['push'](_0x31c85e['shift']());}catch(_0x4a555f){_0x31c85e['push'](_0x31c85e['shift']());}}}(a0_0x4c72,0x7dc85));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x3af37a(0x106)),auth=require('../middleware/auth'),nodemailer=require(a0_0x3af37a(0x118));var ejs=require(a0_0x3af37a(0xca));function a0_0x4c72(){var _0xb1f325=['email','secondary_code_hide','stock_quantity','errors','$category','logo','save','$product_details.maxProducts','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','suppliers_docs','$product.room_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','product_details','image','\x20<>\x20','<tr>','currency_placement','prod_cat','exports','map','/view/add_purchases','<tbody\x20style=\x22text-align:\x20center;\x22>','product_code','1494909nQosPl','random','stocks','/upload/','secondary_unit','amount','$alertquantity','$suppliers_docs','bay','purchase_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','maxStocks','Rack\x202','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Arabic\x20(ae)','$unit','prod_primunit','$product_details._id','body','/view','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/all_purchases/view','add_purchases\x20error','</td>','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','batch_code','</tbody>','standard_unit','/give_payment/:id','$product_code','all','flash','prod_code','$note','<div>','$product_details.bay','Arabic','$primary_code','$date','product_name','error','json','French','findById','level','Room_name','product_stock','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','catch','$invoice','$product_details.type','ejs','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','port','/CheckingWarehouse','staff','getMonth','message','/all_purchases_finished/view','status','forEach','paid_amount','1234590uWCFcI','$return_data','length','purchase\x20data\x20update\x20successfully','$product_details.storage','product','Purchase\x20Return\x20Mail','INCF-','suppliers','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','concat','gmail','\x20</h2>','primary_code','site_title','edit_purchases_finished_view','warehouse_name','find','English','$product.bin','Rack\x201','return_data','</table>','English\x20(US)','/barcode/:id','$brand','DRY\x20GOODS','redirect','table\x20page','/../public','../public/language/languages.json','back','Hindi','product_cat','string','prod_secondunit','getFullYear','log','date','Logo.png','41076ghaTQr','<h5>','POnumber','return_qty','</span>','render','</h5>','getDate','../models/all_models','$_id','$product','_id','prod_level','user','<h2>\x20','$maxStocks','</div>','prod_qty','filter','prod_Qty','max_product_unit','secondary_code','password','$secondary_unit','$secondary_code','/barcode_scanner','nodemailer','findOne','all_purchases_finished','\x20Order\x20Number\x20:\x20','94717egzVos','payment\x20successfull','$product.bay','room_name','currency','return_purchase_finished','then','prod_unit','invoice','Enabled','name','Return\x20Goods','<strong>\x20Regards\x20</strong>','edit_purchases_finished','slice','get','877635ZyKJuQ','success','/preview/:id','abs','$maxProdPerUnit','language','<h5\x20style=\x22text-align:\x20left;\x22>','<html><head><title></title>','prod_invoice','Error\x20Occurs','$product.floorlevel','room','$product_details.product_name','sendMail','/view/return_purchase/:id','$due_amount','/invoice/:id','792222MXDaxb','/view/:id','prod_name','$expiry_date','post','Spanish','/view/add_purchases/:id','</body></html>','</thead>','$product.quantity','params','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Finished\x20Goods','FROZEN\x20GOODS','expiry_date','purchase\x20data\x20add\x20successfully','add_purchases_finished','An\x20error\x20occurred.','Purchase\x20Mail','Enclosed','Ambient','production_date','845373azXHru','Purchase\x20Return','German','stock_data','$name','RoomAssign','True','</tr>','159FnyDzr','maxperunit','JO_number','488stEclU','$suppliers','$product_details.floorlevel','purchase_quantity','MaxStocks_data','createTransport','\x20Order\x20Date\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','primary_code_hide','role','$batch_code','Portuguese\x20(BR)','Chinese','aggregate','</head><body>','warehouse','quantity','Portuguese','toString','$product_details.secondary_code','Paid\x20For\x20Purchase'];a0_0x4c72=function(){return _0xb1f325;};return a0_0x4c72();}const path=require('path'),users=require(a0_0x3af37a(0xf4));router[a0_0x3af37a(0x12b)](a0_0x3af37a(0xa6),auth,async(_0x30dcbc,_0xe5386b)=>{var _0xc6d8d4=a0_0x3af37a;try{const {username:_0x2a8efd,email:_0x24ca04,role:_0x5b407e}=_0x30dcbc[_0xc6d8d4(0x10b)],_0x3dc55b=_0x30dcbc[_0xc6d8d4(0x10b)],_0x1d86a7=await profile[_0xc6d8d4(0x119)]({'email':_0x3dc55b[_0xc6d8d4(0x174)]}),_0x5e7510=await staff[_0xc6d8d4(0x119)]({'email':_0x3dc55b[_0xc6d8d4(0x174)]});if(_0x3dc55b[_0xc6d8d4(0x168)]==_0xc6d8d4(0xce)){const _0x434c00=await staff['findOne']({'email':_0x3dc55b[_0xc6d8d4(0x174)]});}const _0x2899fa=await master_shop[_0xc6d8d4(0xe7)]();let _0x248d8f;if(_0x3dc55b[_0xc6d8d4(0x168)]==_0xc6d8d4(0xce)){const _0x431eef=await staff[_0xc6d8d4(0x119)]({'email':_0x3dc55b[_0xc6d8d4(0x174)]});_0x248d8f=await purchases_finished[_0xc6d8d4(0x16c)]([{'$match':{'warehouse_name':_0x431eef[_0xc6d8d4(0x16e)]}},{'$lookup':{'from':_0xc6d8d4(0xdd),'localField':_0xc6d8d4(0xdd),'foreignField':_0xc6d8d4(0x126),'as':_0xc6d8d4(0x17d)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0xc6d8d4(0x108)},{'$group':{'_id':'$_id','invoice':{'$first':_0xc6d8d4(0xc8)},'suppliers':{'$first':_0xc6d8d4(0x160)},'date':{'$first':_0xc6d8d4(0xbd)},'warehouse_name':{'$first':_0xc6d8d4(0xad)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':_0xc6d8d4(0xb8)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0xc6d8d4(0xd6)},'batch_code':{'$first':_0xc6d8d4(0x169)},'expiry_date':{'$first':_0xc6d8d4(0x140)},'suppliers_docs':{'$first':_0xc6d8d4(0x98)},'total_product_quantity':{'$sum':_0xc6d8d4(0x146)},'level':{'$addToSet':_0xc6d8d4(0x11e)},'isle':{'$addToSet':_0xc6d8d4(0xe9)},'type':{'$addToSet':_0xc6d8d4(0x9c)},'floorlevel':{'$addToSet':_0xc6d8d4(0x136)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x248d8f=await purchases_finished[_0xc6d8d4(0x16c)]([{'$unwind':_0xc6d8d4(0x108)},{'$group':{'_id':_0xc6d8d4(0x107),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0xc6d8d4(0x160)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0xc6d8d4(0x17e)},'product':{'$push':'$product'},'note':{'$first':_0xc6d8d4(0xb8)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0xc6d8d4(0x13b)},'return_data':{'$first':_0xc6d8d4(0xd6)},'batch_code':{'$first':_0xc6d8d4(0x169)},'expiry_date':{'$first':_0xc6d8d4(0x140)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0xc6d8d4(0x146)},'level':{'$addToSet':_0xc6d8d4(0x11e)},'isle':{'$addToSet':_0xc6d8d4(0xe9)},'type':{'$addToSet':_0xc6d8d4(0x9c)},'floorlevel':{'$addToSet':_0xc6d8d4(0x136)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x2899fa[0x0][_0xc6d8d4(0x131)]==_0xc6d8d4(0xed))var _0x4052c3=users['English'];else{if(_0x2899fa[0x0]['language']==_0xc6d8d4(0xf6))var _0x4052c3=users[_0xc6d8d4(0xf6)];else{if(_0x2899fa[0x0][_0xc6d8d4(0x131)]==_0xc6d8d4(0x156))var _0x4052c3=users[_0xc6d8d4(0x156)];else{if(_0x2899fa[0x0]['language']==_0xc6d8d4(0x142))var _0x4052c3=users[_0xc6d8d4(0x142)];else{if(_0x2899fa[0x0]['language']==_0xc6d8d4(0xc1))var _0x4052c3=users[_0xc6d8d4(0xc1)];else{if(_0x2899fa[0x0][_0xc6d8d4(0x131)]==_0xc6d8d4(0x16a))var _0x4052c3=users[_0xc6d8d4(0x170)];else{if(_0x2899fa[0x0]['language']==_0xc6d8d4(0x16b))var _0x4052c3=users[_0xc6d8d4(0x16b)];else{if(_0x2899fa[0x0]['language']==_0xc6d8d4(0xa1))var _0x4052c3=users[_0xc6d8d4(0xbb)];}}}}}}}_0xe5386b[_0xc6d8d4(0x103)](_0xc6d8d4(0x11a),{'success':_0x30dcbc['flash'](_0xc6d8d4(0x12d)),'errors':_0x30dcbc[_0xc6d8d4(0xb6)](_0xc6d8d4(0x177)),'purchases':_0x248d8f,'role':_0x3dc55b,'profile':_0x1d86a7,'master_shop':_0x2899fa,'language':_0x4052c3});}catch(_0x5c5b9b){console['log'](_0xc6d8d4(0xf2),_0x5c5b9b),_0xe5386b['status'](0xc8)[_0xc6d8d4(0xc0)]({'message':_0x5c5b9b[_0xc6d8d4(0xd0)]});}});function BayBinSelected(_0x2267bf,_0x4f8d49){var _0x5d9776=a0_0x3af37a,_0x44e671=[],_0x5309b5=[];if(_0x2267bf=='DRY\x20GOODS'){switch(_0x4f8d49){case'Rack\x201':_0x44e671=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x44e671=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5309b5=['DG'];}else{if(_0x2267bf==_0x5d9776(0x14b)){switch(_0x4f8d49){case _0x5d9776(0xea):_0x44e671=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x5d9776(0x9f):_0x44e671=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5309b5=['FG'];}}return{'levels':_0x44e671,'identify':_0x5309b5};}function a0_0x21cb(_0x4c88b1,_0x9881d6){var _0x4c7231=a0_0x4c72();return a0_0x21cb=function(_0x21cb89,_0x3b095b){_0x21cb89=_0x21cb89-0x85;var _0x42edb5=_0x4c7231[_0x21cb89];return _0x42edb5;},a0_0x21cb(_0x4c88b1,_0x9881d6);}async function getRandom8DigitNumber(){var _0x141347=a0_0x3af37a;const _0x31bd1b=0x989680,_0x119594=0x5f5e0ff,_0x8fcd54=Math[_0x141347(0xde)](Math[_0x141347(0x92)]()*(_0x119594-_0x31bd1b+0x1))+_0x31bd1b;var _0x7cb8bd;const _0x18e7a6=await purchases_finished[_0x141347(0x119)]({'invoice':_0x141347(0xdc)+_0x8fcd54});return _0x18e7a6&&_0x18e7a6[_0x141347(0xd7)]>0x0?_0x7cb8bd='INCF-'+_0x8fcd54:_0x7cb8bd=_0x141347(0xdc)+_0x8fcd54,_0x7cb8bd;}router['get'](a0_0x3af37a(0x8e),auth,async(_0xdcbce4,_0x115e04)=>{var _0x1703a1=a0_0x3af37a;try{const {username:_0x7f9b10,email:_0x4b1a16,role:_0x498d44}=_0xdcbce4[_0x1703a1(0x10b)],_0x13cf56=_0xdcbce4[_0x1703a1(0x10b)],_0x537009=await profile[_0x1703a1(0x119)]({'email':_0x13cf56['email']}),_0x303bdc=await master_shop[_0x1703a1(0xe7)](),_0x21dd93=await staff['findOne']({'email':_0x13cf56[_0x1703a1(0x174)]}),_0x52b2ac=await suppliers['find']({});let _0x5d77ad;if(_0x13cf56[_0x1703a1(0x168)]==_0x1703a1(0xce)){const _0x563548=await staff[_0x1703a1(0x119)]({'email':_0x13cf56[_0x1703a1(0x174)]});_0x5d77ad=await warehouse[_0x1703a1(0x16c)]([{'$match':{'status':_0x1703a1(0x125),'name':_0x563548[_0x1703a1(0x16e)],'warehouse_category':_0x1703a1(0x14a)}},{'$group':{'_id':_0x1703a1(0x158),'name':{'$first':_0x1703a1(0x158)}}}]);}else _0x5d77ad=await warehouse[_0x1703a1(0x16c)]([{'$match':{'status':'Enabled','warehouse_category':_0x1703a1(0x14a),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x1703a1(0x158),'name':{'$first':'$name'}}}]);const _0x4d8bd4=await product[_0x1703a1(0xe7)]({}),_0x2ab8af=await warehouse[_0x1703a1(0xe7)]({'status':_0x1703a1(0x125)}),_0x3177ce=await purchases_finished['find']({}),_0x4cce3c=_0x3177ce[_0x1703a1(0xd7)]+0x1,_0x4c96ef=_0x1703a1(0xdc)+_0x4cce3c[_0x1703a1(0x171)]()['padStart'](0x5,'0');var _0x5261ec=[_0x1703a1(0x152),_0x1703a1(0x151)];if(_0x303bdc[0x0]['language']==_0x1703a1(0xed))var _0xfd808d=users[_0x1703a1(0xe8)];else{if(_0x303bdc[0x0][_0x1703a1(0x131)]=='Hindi')var _0xfd808d=users[_0x1703a1(0xf6)];else{if(_0x303bdc[0x0]['language']=='German')var _0xfd808d=users['German'];else{if(_0x303bdc[0x0][_0x1703a1(0x131)]==_0x1703a1(0x142))var _0xfd808d=users['Spanish'];else{if(_0x303bdc[0x0][_0x1703a1(0x131)]==_0x1703a1(0xc1))var _0xfd808d=users['French'];else{if(_0x303bdc[0x0][_0x1703a1(0x131)]==_0x1703a1(0x16a))var _0xfd808d=users[_0x1703a1(0x170)];else{if(_0x303bdc[0x0][_0x1703a1(0x131)]==_0x1703a1(0x16b))var _0xfd808d=users[_0x1703a1(0x16b)];else{if(_0x303bdc[0x0][_0x1703a1(0x131)]==_0x1703a1(0xa1))var _0xfd808d=users[_0x1703a1(0xbb)];}}}}}}}const _0x5c2894=getRandom8DigitNumber();_0x5c2894[_0x1703a1(0x122)](_0x1d4dbd=>{var _0x23a7d9=_0x1703a1;_0x115e04['render'](_0x23a7d9(0x14e),{'success':_0xdcbce4[_0x23a7d9(0xb6)]('success'),'errors':_0xdcbce4[_0x23a7d9(0xb6)](_0x23a7d9(0x177)),'role':_0x13cf56,'profile':_0x537009,'suppliers':_0x52b2ac,'warehouse':_0x5d77ad,'product':_0x4d8bd4,'invoice':_0x1d4dbd,'master_shop':_0x303bdc,'language':_0xfd808d,'find_data':_0x2ab8af,'rooms_data':_0x5261ec});})[_0x1703a1(0xc7)](_0x37f83b=>{var _0x1959a5=_0x1703a1;_0xdcbce4['flash'](_0x1959a5(0x177),_0x1959a5(0x17f)),_0x115e04[_0x1959a5(0xf1)](_0x1959a5(0xd1));});}catch(_0x256d84){console[_0x1703a1(0xfb)](_0x256d84);}}),router[a0_0x3af37a(0x12b)](a0_0x3af37a(0x143),auth,async(_0xa77c85,_0x1886f2)=>{var _0x2750b6=a0_0x3af37a;try{const _0x36fa65=_0xa77c85[_0x2750b6(0x147)]['id'];console['log'](_0x36fa65);const _0x268cc4=await master_shop['find']();console[_0x2750b6(0xfb)]('master',_0x268cc4);const _0x3c4a25=await product[_0x2750b6(0x119)]({'name':_0x36fa65});console['log'](_0x2750b6(0xda),_0x3c4a25),_0x1886f2[_0x2750b6(0xd2)](0xc8)['json']({'product_data':_0x3c4a25,'master':_0x268cc4});}catch(_0x1c0954){console[_0x2750b6(0xfb)](_0x2750b6(0xab),_0x1c0954);}}),router[a0_0x3af37a(0x141)](a0_0x3af37a(0x8e),auth,async(_0x57acfa,_0x2e05e7)=>{var _0x547dfe=a0_0x3af37a;try{const {invoice:_0x991ef1,date:_0x165ab8,warehouse_name:_0x280990,prod_name:_0x57b782,prod_code:_0x27df58,prod_qty:_0x4f00fe,prod_unit:_0x353765,prod_secondunit:_0x4f687c,prod_level:_0x56ec8c,prod_isle:_0x36e575,prod_pallet:_0x50222f,note:_0x6c8c0d,expiry_date:_0x3790b5,batch_code:_0x4feeb4,payable:_0x451611,due_amount:_0x1a684c,Room_name:_0x1577e6,primary_code:_0xec01d7,secondary_code:_0x25feb9,MaxStocks_data:_0x50c457,PO_number:_0xa87de,SCRN:_0x5c13f7,JO_number:_0x377e1d}=_0x57acfa[_0x547dfe(0xa5)];if(typeof _0x57b782==_0x547dfe(0xf8))var _0x8f3627=[_0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x13f)]],_0x34747e=[_0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0xb7)]],_0x5ea6ff=[_0x57acfa[_0x547dfe(0xa5)]['prod_Qty']],_0x4694b6=[_0x57acfa['body']['prod_primunit']],_0xde877b=[_0x57acfa[_0x547dfe(0xa5)]['prod_secondunit']],_0x1d0f43=[_0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x10a)]],_0x454d28=[_0x57acfa['body'][_0x547dfe(0xe3)]],_0x420a05=[_0x57acfa['body']['secondary_code']],_0x36afe8=[_0x57acfa[_0x547dfe(0xa5)]['MaxStocks_data']],_0x4ef8f2=[_0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0xb0)]],_0x124d52=[_0x57acfa[_0x547dfe(0xa5)]['expiry_date']],_0x46cbdd=[_0x57acfa[_0x547dfe(0xa5)]['product_date']],_0x4e55a5=[_0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x112)]],_0x4db861=[_0x57acfa['body'][_0x547dfe(0x8b)]],_0x390ad8=[_0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x159)]],_0x5f20f5=[_0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x134)]];else var _0x8f3627=[..._0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x13f)]],_0x34747e=[..._0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0xb7)]],_0x5ea6ff=[..._0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x111)]],_0x4694b6=[..._0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0xa3)]],_0xde877b=[..._0x57acfa[_0x547dfe(0xa5)]['prod_secondunit']],_0x1d0f43=[..._0x57acfa[_0x547dfe(0xa5)]['prod_level']],_0x454d28=[..._0x57acfa['body']['primary_code']],_0x420a05=[..._0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x113)]],_0x36afe8=[..._0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x163)]],_0x4ef8f2=[..._0x57acfa['body'][_0x547dfe(0xb0)]],_0x124d52=[..._0x57acfa['body'][_0x547dfe(0x14c)]],_0x46cbdd=[..._0x57acfa[_0x547dfe(0xa5)]['product_date']],_0x4e55a5=[..._0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x112)]],_0x4db861=[..._0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x8b)]],_0x390ad8=[..._0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x159)]],_0x5f20f5=[..._0x57acfa[_0x547dfe(0xa5)][_0x547dfe(0x134)]];const _0x116df4=_0x8f3627[_0x547dfe(0x8d)](_0x5b00f0=>{return _0x5b00f0={'product_name':_0x5b00f0};});_0x34747e[_0x547dfe(0xd3)]((_0x34beaa,_0x689e38)=>{_0x116df4[_0x689e38]['product_code']=_0x34beaa;}),_0x5ea6ff[_0x547dfe(0xd3)]((_0x17b68d,_0x1e4c1b)=>{var _0x5e1f98=_0x547dfe;_0x116df4[_0x1e4c1b][_0x5e1f98(0x16f)]=Math[_0x5e1f98(0x12f)](_0x17b68d);}),_0x4694b6[_0x547dfe(0xd3)]((_0x1c719c,_0x2f274a)=>{var _0x2c1ff2=_0x547dfe;_0x116df4[_0x2f274a][_0x2c1ff2(0xb2)]=_0x1c719c;}),_0xde877b[_0x547dfe(0xd3)]((_0xa04803,_0x2a3876)=>{_0x116df4[_0x2a3876]['secondary_unit']=_0xa04803;}),_0x1d0f43['forEach']((_0x4be5b6,_0x9f04a)=>{var _0x560f5c=_0x547dfe;_0x116df4[_0x9f04a][_0x560f5c(0x99)]=_0x4be5b6;}),_0x454d28[_0x547dfe(0xd3)]((_0x3220b0,_0x10e532)=>{_0x116df4[_0x10e532]['primary_code']=_0x3220b0;}),_0x420a05[_0x547dfe(0xd3)]((_0x2d1e11,_0x22d8cf)=>{var _0x192f71=_0x547dfe;_0x116df4[_0x22d8cf][_0x192f71(0x113)]=_0x2d1e11;}),_0x36afe8[_0x547dfe(0xd3)]((_0x1e8189,_0x2540b7)=>{var _0x1f313f=_0x547dfe;_0x116df4[_0x2540b7][_0x1f313f(0x9e)]=_0x1e8189;}),_0x4ef8f2[_0x547dfe(0xd3)]((_0x3a1375,_0x5e068b)=>{_0x116df4[_0x5e068b]['batch_code']=_0x3a1375;}),_0x124d52[_0x547dfe(0xd3)]((_0x210496,_0x6a475c)=>{var _0x699f08=_0x547dfe;_0x116df4[_0x6a475c][_0x699f08(0x14c)]=_0x210496;}),_0x46cbdd[_0x547dfe(0xd3)]((_0x31ad61,_0x1753c7)=>{var _0x22d87b=_0x547dfe;_0x116df4[_0x1753c7][_0x22d87b(0x153)]=_0x31ad61;}),_0x4e55a5[_0x547dfe(0xd3)]((_0x5c1571,_0x5c47c7)=>{var _0x2dd3ef=_0x547dfe;_0x116df4[_0x5c47c7][_0x2dd3ef(0x15d)]=_0x5c1571;}),_0x4db861['forEach']((_0x3066b9,_0x1d1d3c)=>{var _0x160025=_0x547dfe;_0x116df4[_0x1d1d3c][_0x160025(0xf7)]=_0x3066b9;}),_0x390ad8[_0x547dfe(0xd3)]((_0x48551d,_0x1f9caf)=>{var _0x430bbb=_0x547dfe;_0x116df4[_0x1f9caf][_0x430bbb(0x11f)]=_0x48551d;}),_0x5f20f5[_0x547dfe(0xd3)]((_0x43a666,_0x4dd41c)=>{var _0x42513a=_0x547dfe;_0x116df4[_0x4dd41c][_0x42513a(0x124)]=_0x43a666;});const _0xb2571=_0x116df4[_0x547dfe(0x110)](_0x1ae17d=>_0x1ae17d['quantity']!=='0'&&_0x1ae17d[_0x547dfe(0x16f)]!==''),_0x2a5399=new purchases_finished({'invoice':_0x991ef1,'suppliers':_0x57acfa['body'][_0x547dfe(0xdd)],'date':_0x165ab8,'warehouse_name':_0x280990,'product':_0xb2571,'note':_0x6c8c0d,'due_amount':_0x1a684c,'room':_0x1577e6,'POnumber':_0xa87de,'SCRN':_0x5c13f7,'JO_number':_0x377e1d}),_0x3dbd4f=await _0x2a5399[_0x547dfe(0x17a)](),_0x47b730=await purchases_finished['findOne']({'invoice':_0x991ef1}),_0x3207a2=_0x47b730['product']['map'](async _0x8903b0=>{var _0x114792=_0x547dfe,_0x24dfa1=await warehouse[_0x114792(0x119)]({'name':_0x280990,'room':_0x8903b0[_0x114792(0x11f)]}),_0x4a4a88=0x0;const _0xa0b9b1=_0x24dfa1[_0x114792(0x86)]['map'](_0x5f2b18=>{var _0x2f0cba=_0x114792;console[_0x2f0cba(0xfb)](_0x5f2b18[_0x2f0cba(0xbe)]+'=='+_0x8903b0[_0x2f0cba(0xbe)]+'&&'+_0x5f2b18[_0x2f0cba(0x99)]+'=='+_0x8903b0[_0x2f0cba(0x99)]+'&&'+_0x5f2b18[_0x2f0cba(0x14c)]+'=='+_0x8903b0[_0x2f0cba(0x14c)]+'&&'+_0x5f2b18[_0x2f0cba(0x153)]+'=='+_0x8903b0[_0x2f0cba(0x153)]+'&&'+_0x5f2b18['batch_code']+'=='+_0x8903b0['batch_code']+'&&'+_0x5f2b18['invoice']+'=='+_0x47b730[_0x2f0cba(0x124)]),_0x5f2b18['product_name']==_0x8903b0[_0x2f0cba(0xbe)]&&_0x5f2b18['bay']==_0x8903b0[_0x2f0cba(0x99)]&&_0x5f2b18[_0x2f0cba(0x14c)]==_0x8903b0[_0x2f0cba(0x14c)]&&_0x5f2b18[_0x2f0cba(0x153)]==_0x8903b0['production_date']&&_0x5f2b18[_0x2f0cba(0xb0)]==_0x8903b0[_0x2f0cba(0xb0)]&&_0x5f2b18['invoice']==_0x47b730[_0x2f0cba(0x124)]&&(_0x5f2b18[_0x2f0cba(0xc5)]=Math[_0x2f0cba(0x12f)](_0x5f2b18[_0x2f0cba(0xc5)])+Math[_0x2f0cba(0x12f)](_0x8903b0[_0x2f0cba(0x16f)]),_0x4a4a88++);});return _0x4a4a88=='0'&&(_0x24dfa1[_0x114792(0x86)]=_0x24dfa1[_0x114792(0x86)][_0x114792(0xe0)]({'product_name':_0x8903b0[_0x114792(0xbe)],'product_stock':Math[_0x114792(0x12f)](_0x8903b0[_0x114792(0x16f)]),'primary_code':_0x8903b0[_0x114792(0xe3)],'secondary_code':_0x8903b0[_0x114792(0x113)],'product_code':_0x8903b0[_0x114792(0x90)],'bay':_0x8903b0[_0x114792(0x99)],'maxProducts':_0x8903b0[_0x114792(0x9e)],'unit':_0x8903b0[_0x114792(0xb2)],'secondary_unit':_0x8903b0[_0x114792(0x95)],'expiry_date':_0x8903b0[_0x114792(0x14c)],'production_date':_0x8903b0[_0x114792(0x153)],'maxProducts':_0x8903b0[_0x114792(0x9e)],'maxPerUnit':_0x8903b0[_0x114792(0x15d)],'batch_code':_0x8903b0['batch_code'],'product_cat':_0x8903b0['product_cat'],'invoice':_0x8903b0[_0x114792(0x124)]})),_0x24dfa1;});Promise[_0x547dfe(0xb5)](_0x3207a2)[_0x547dfe(0x122)](async _0x171353=>{var _0x52e17a=_0x547dfe;try{for(const _0x398561 of _0x171353){await warehouse['updateOne']({'_id':_0x398561[_0x52e17a(0x109)]},{'$addToSet':{'product_details':{'$each':_0x398561[_0x52e17a(0x86)]}}});}const _0x3f5752=await master_shop[_0x52e17a(0xe7)](),_0x3146b6=await email_settings['findOne'](),_0x471fc9=await supervisor_settings[_0x52e17a(0xe7)]();var _0x2ab3b1=_0x47b730[_0x52e17a(0xda)],_0x474b72='',_0x4c378d;for(_0x4c378d in _0x2ab3b1){var _0xae76db='FG';_0x47b730['warehouse_name']==_0x52e17a(0xf0)&&(_0xae76db='DG'),_0x474b72+=_0x52e17a(0x89)+_0x52e17a(0x180)+_0x2ab3b1[_0x4c378d][_0x52e17a(0xbe)]+_0x52e17a(0xac)+_0x52e17a(0x180)+_0x2ab3b1[_0x4c378d][_0x52e17a(0x90)]+_0x52e17a(0xac)+_0x52e17a(0x180)+_0x2ab3b1[_0x4c378d]['quantity']+_0x52e17a(0xac)+_0x52e17a(0x180)+_0x2ab3b1[_0x4c378d][_0x52e17a(0xb2)]+'</td>'+_0x52e17a(0x180)+_0x2ab3b1[_0x4c378d][_0x52e17a(0x95)]+_0x52e17a(0xac)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x47b730['warehouse_name']+_0x52e17a(0xac)+_0x52e17a(0x180)+_0x2ab3b1[_0x4c378d][_0x52e17a(0x11f)]+_0x52e17a(0xac)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xae76db+_0x2ab3b1[_0x4c378d][_0x52e17a(0x99)]+_0x52e17a(0xac),_0x52e17a(0x15b);}let _0x3e3aed=nodemailer[_0x52e17a(0x164)]({'host':_0x3146b6['host'],'port':Number(_0x3146b6[_0x52e17a(0xcc)]),'secure':![],'auth':{'user':_0x3146b6[_0x52e17a(0x174)],'pass':_0x3146b6[_0x52e17a(0x114)]}}),_0x4280b0={'from':_0x3146b6[_0x52e17a(0x174)],'to':_0x471fc9[0x0]['FGSEmail'],'subject':_0x52e17a(0x150),'attachments':[{'filename':_0x52e17a(0xfd),'path':__dirname+_0x52e17a(0xf3)+'/upload/'+_0x3f5752[0x0][_0x52e17a(0x87)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x52e17a(0x133)+'</head><body>'+_0x52e17a(0xb9)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x52e17a(0xb9)+_0x52e17a(0xc6)+_0x52e17a(0x10e)+_0x52e17a(0xb9)+'<h2>\x20'+_0x3f5752[0x0][_0x52e17a(0xe4)]+_0x52e17a(0xe2)+_0x52e17a(0x10e)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x52e17a(0xb9)+_0x52e17a(0x132)+_0x52e17a(0x11b)+_0x47b730[_0x52e17a(0x124)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x52e17a(0x165)+_0x47b730[_0x52e17a(0xfc)]+'\x20'+_0x52e17a(0x102)+_0x52e17a(0x104)+_0x52e17a(0x10e)+_0x52e17a(0x148)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x52e17a(0x89)+_0x52e17a(0x166)+_0x52e17a(0xa9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x52e17a(0xae)+_0x52e17a(0x9d)+_0x52e17a(0xa0)+_0x52e17a(0xdf)+_0x52e17a(0x9b)+_0x52e17a(0x15b)+_0x52e17a(0x145)+_0x52e17a(0x8f)+'\x20'+_0x474b72+'\x20'+_0x52e17a(0xb1)+_0x52e17a(0xec)+_0x52e17a(0xb9)+_0x52e17a(0x128)+_0x52e17a(0xff)+_0x3f5752[0x0][_0x52e17a(0xe4)]+_0x52e17a(0x104)+_0x52e17a(0x10e)+_0x52e17a(0x10e)+_0x52e17a(0x144)};_0x3e3aed[_0x52e17a(0x139)](_0x4280b0,function(_0x26b934,_0x365037){var _0x203b1e=_0x52e17a;_0x26b934?(console[_0x203b1e(0xfb)](_0x26b934),console['log']('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');});}catch(_0x24be5e){console[_0x52e17a(0xbf)](_0x24be5e),_0x2e05e7[_0x52e17a(0xd2)](0x1f4)[_0x52e17a(0xc0)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x24be5e[_0x52e17a(0xd0)]});}})[_0x547dfe(0xc7)](_0x24027b=>{var _0x277701=_0x547dfe;console[_0x277701(0xbf)](_0x24027b),_0x2e05e7['status'](0x1f4)[_0x277701(0xc0)]({'error':_0x277701(0x14f)});}),_0x57acfa['flash'](_0x547dfe(0x12d),_0x547dfe(0x14d)),_0x2e05e7[_0x547dfe(0xf1)]('/all_purchases_finished/view');}catch(_0x3a0082){console[_0x547dfe(0xfb)](_0x3a0082);}}),router['get'](a0_0x3af37a(0x12e),auth,async(_0x3eeb17,_0x2aed73)=>{var _0x3b4903=a0_0x3af37a;try{const {username:_0x4d368e,email:_0x408c86,role:_0x22e687}=_0x3eeb17[_0x3b4903(0x10b)],_0x79cbdf=_0x3eeb17['user'],_0x141061=await profile[_0x3b4903(0x119)]({'email':_0x79cbdf[_0x3b4903(0x174)]}),_0x575d00=await master_shop[_0x3b4903(0xe7)](),_0x33d219=_0x3eeb17['params']['id'],_0x1bbfc6=await purchases_finished['findById'](_0x33d219),_0xc85ef0=await suppliers['find']({});let _0x1976db;if(_0x79cbdf[_0x3b4903(0x168)]=='staff'){const _0x4cc3c3=await staff[_0x3b4903(0x119)]({'email':_0x79cbdf[_0x3b4903(0x174)]});_0x1976db=await warehouse['find']({'status':_0x3b4903(0x125),'name':_0x4cc3c3[_0x3b4903(0x16e)],'warehouse_category':_0x3b4903(0x14a)});}else _0x1976db=await warehouse['aggregate']([{'$match':{'status':_0x3b4903(0x125),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x3b4903(0x158),'name':{'$first':_0x3b4903(0x158)}}}]);const _0x45564c=await product['find']({}),_0x1cc44c=BayBinSelected(_0x1bbfc6[_0x3b4903(0xe6)],_0x1bbfc6[_0x3b4903(0x137)]);let _0x3b3702=new Date(_0x1bbfc6['expiry_date']),_0x13ed68=('0'+_0x3b3702[_0x3b4903(0x105)]())[_0x3b4903(0x12a)](-0x2),_0xf6649c=('0'+(_0x3b3702[_0x3b4903(0xcf)]()+0x1))[_0x3b4903(0x12a)](-0x2),_0x1ae350=_0x3b3702[_0x3b4903(0xfa)](),_0x2b112a=_0x1ae350+'-'+_0xf6649c+'-'+_0x13ed68;if(_0x575d00[0x0][_0x3b4903(0x131)]==_0x3b4903(0xed)){var _0x488b11=users[_0x3b4903(0xe8)];console['log'](_0x488b11);}else{if(_0x575d00[0x0][_0x3b4903(0x131)]==_0x3b4903(0xf6))var _0x488b11=users['Hindi'];else{if(_0x575d00[0x0]['language']==_0x3b4903(0x156))var _0x488b11=users[_0x3b4903(0x156)];else{if(_0x575d00[0x0]['language']==_0x3b4903(0x142))var _0x488b11=users[_0x3b4903(0x142)];else{if(_0x575d00[0x0]['language']==_0x3b4903(0xc1))var _0x488b11=users[_0x3b4903(0xc1)];else{if(_0x575d00[0x0][_0x3b4903(0x131)]=='Portuguese\x20(BR)')var _0x488b11=users[_0x3b4903(0x170)];else{if(_0x575d00[0x0][_0x3b4903(0x131)]==_0x3b4903(0x16b))var _0x488b11=users['Chinese'];else{if(_0x575d00[0x0][_0x3b4903(0x131)]==_0x3b4903(0xa1))var _0x488b11=users[_0x3b4903(0xbb)];}}}}}}}_0x2aed73[_0x3b4903(0x103)](_0x3b4903(0xe5),{'success':_0x3eeb17[_0x3b4903(0xb6)](_0x3b4903(0x12d)),'errors':_0x3eeb17[_0x3b4903(0xb6)]('errors'),'role':_0x79cbdf,'profile':_0x141061,'purchases':_0x1bbfc6,'suppliers':_0xc85ef0,'warehouse':_0x1976db,'product':_0x45564c,'master_shop':_0x575d00,'language':_0x488b11,'ed_fullDate':_0x2b112a,'dataSelected':_0x1cc44c});}catch(_0x40eb4e){console[_0x3b4903(0xfb)](_0x40eb4e);}}),router[a0_0x3af37a(0x12b)](a0_0x3af37a(0x13e),auth,async(_0x2f3408,_0x37e518)=>{var _0x5a38da=a0_0x3af37a;try{const {username:_0x39b05c,email:_0x581a0e,role:_0x86c56a}=_0x2f3408[_0x5a38da(0x10b)],_0x47d069=_0x2f3408[_0x5a38da(0x10b)],_0x2d2736=await profile['findOne']({'email':_0x47d069[_0x5a38da(0x174)]}),_0x14a4c1=await master_shop[_0x5a38da(0xe7)](),_0x4bd357=_0x2f3408['params']['id'],_0x298aa0=await purchases_finished[_0x5a38da(0xc2)](_0x4bd357),_0x233ee6=await suppliers[_0x5a38da(0xe7)]({});let _0xba3979;if(_0x47d069[_0x5a38da(0x168)]=='staff'){const _0x34f534=await staff[_0x5a38da(0x119)]({'email':_0x47d069['email']});_0xba3979=await warehouse[_0x5a38da(0xe7)]({'status':_0x5a38da(0x125),'name':_0x34f534[_0x5a38da(0x16e)],'warehouse_category':_0x5a38da(0x14a)});}else _0xba3979=await warehouse[_0x5a38da(0x16c)]([{'$match':{'status':'Enabled','warehouse_category':_0x5a38da(0x14a)}},{'$group':{'_id':_0x5a38da(0x158),'name':{'$first':_0x5a38da(0x158)}}}]);const _0x50a9dc=await product[_0x5a38da(0xe7)]({}),_0x68fbf6=BayBinSelected(_0x298aa0[_0x5a38da(0xe6)],_0x298aa0[_0x5a38da(0x137)]);let _0x96ffde=new Date(_0x298aa0['expiry_date']),_0x2b8acf=('0'+_0x96ffde['getDate']())['slice'](-0x2),_0xc03f09=('0'+(_0x96ffde[_0x5a38da(0xcf)]()+0x1))[_0x5a38da(0x12a)](-0x2),_0x2d590f=_0x96ffde[_0x5a38da(0xfa)](),_0x4d2e36=_0x2d590f+'-'+_0xc03f09+'-'+_0x2b8acf;if(_0x14a4c1[0x0][_0x5a38da(0x131)]==_0x5a38da(0xed)){var _0x15a6af=users[_0x5a38da(0xe8)];console['log'](_0x15a6af);}else{if(_0x14a4c1[0x0][_0x5a38da(0x131)]==_0x5a38da(0xf6))var _0x15a6af=users[_0x5a38da(0xf6)];else{if(_0x14a4c1[0x0][_0x5a38da(0x131)]==_0x5a38da(0x156))var _0x15a6af=users[_0x5a38da(0x156)];else{if(_0x14a4c1[0x0][_0x5a38da(0x131)]=='Spanish')var _0x15a6af=users['Spanish'];else{if(_0x14a4c1[0x0][_0x5a38da(0x131)]==_0x5a38da(0xc1))var _0x15a6af=users['French'];else{if(_0x14a4c1[0x0]['language']==_0x5a38da(0x16a))var _0x15a6af=users[_0x5a38da(0x170)];else{if(_0x14a4c1[0x0]['language']==_0x5a38da(0x16b))var _0x15a6af=users[_0x5a38da(0x16b)];else{if(_0x14a4c1[0x0]['language']=='Arabic\x20(ae)')var _0x15a6af=users[_0x5a38da(0xbb)];}}}}}}}_0x37e518[_0x5a38da(0x103)](_0x5a38da(0x129),{'success':_0x2f3408[_0x5a38da(0xb6)]('success'),'errors':_0x2f3408[_0x5a38da(0xb6)](_0x5a38da(0x177)),'role':_0x47d069,'profile':_0x2d2736,'purchases':_0x298aa0,'suppliers':_0x233ee6,'warehouse':_0xba3979,'product':_0x50a9dc,'master_shop':_0x14a4c1,'language':_0x15a6af,'ed_fullDate':_0x4d2e36,'dataSelected':_0x68fbf6});}catch(_0x28d9a1){console['log'](_0x28d9a1);}}),router[a0_0x3af37a(0x141)]('/view/:id',auth,async(_0x9917d2,_0x1ab6c7)=>{var _0x3ae15d=a0_0x3af37a;try{const _0x292656=_0x9917d2['params']['id'],_0x4d8b93=await purchases_finished[_0x3ae15d(0x119)]({'_id':_0x9917d2[_0x3ae15d(0x147)]['id']}),_0x5a0db8=await warehouse['findOne']({'name':_0x4d8b93[_0x3ae15d(0xe6)],'room':_0x4d8b93['room']});_0x4d8b93[_0x3ae15d(0xda)][_0x3ae15d(0xd3)](_0x3f7b8e=>{var _0x2b8c63=_0x3ae15d;const _0x3f26d7=_0x5a0db8[_0x2b8c63(0x86)][_0x2b8c63(0x8d)](_0x51e5b9=>{var _0xa989d8=_0x2b8c63;_0x51e5b9[_0xa989d8(0xbe)]==_0x3f7b8e[_0xa989d8(0xbe)]&&_0x51e5b9[_0xa989d8(0x99)]==_0x3f7b8e[_0xa989d8(0x99)]&&(_0x51e5b9[_0xa989d8(0xc5)]=parseInt(_0x51e5b9[_0xa989d8(0xc5)])-parseInt(_0x3f7b8e['quantity']));});}),await _0x5a0db8[_0x3ae15d(0x17a)]();const {invoice:_0x3d26d1,suppliers:_0x1398db,date:_0xaccd20,warehouse_name:_0x42372b,prod_name:_0x9af1df,prod_code:_0x2acf02,prod_qty:_0x50d51a,prod_unit:_0x45b105,prod_secondunit:_0x53a82d,prod_level:_0x3e7067,prod_isle:_0x2cc2ed,prod_pallet:_0x402f3b,note:_0x360bb8,expiry_date:_0x420926,batch_code:_0x4c963f,paid_amount:_0x269ea5,due_amount:_0xe67337,Room_name:_0x17c57e,primary_code:_0x4d2b73,secondary_code:_0x491dde,PO_number:_0x2058bc,JO_number:_0x34623b}=_0x9917d2[_0x3ae15d(0xa5)];if(typeof _0x9af1df==_0x3ae15d(0xf8))var _0x4ced05=[_0x9917d2['body'][_0x3ae15d(0x13f)]],_0x2f6913=[_0x9917d2[_0x3ae15d(0xa5)]['prod_code']],_0x168f29=[_0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x10f)]],_0x28f7f4=[_0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x123)]],_0x3f435c=[_0x9917d2[_0x3ae15d(0xa5)]['prod_secondunit']],_0x2dfb98=[_0x9917d2[_0x3ae15d(0xa5)]['prod_level']],_0x56080c=[_0x9917d2['body'][_0x3ae15d(0xe3)]],_0x1d92eb=[_0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x113)]],_0x43c555=[_0x9917d2['body'][_0x3ae15d(0x163)]],_0x49a26f=[_0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0xb0)]],_0x1f333f=[_0x9917d2['body']['expiry_date']];else var _0x4ced05=[..._0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x13f)]],_0x2f6913=[..._0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0xb7)]],_0x168f29=[..._0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x10f)]],_0x28f7f4=[..._0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x123)]],_0x3f435c=[..._0x9917d2['body'][_0x3ae15d(0xf9)]],_0x2dfb98=[..._0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x10a)]],_0x56080c=[..._0x9917d2['body']['primary_code']],_0x1d92eb=[..._0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x113)]],_0x43c555=[..._0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x163)]],_0x49a26f=[..._0x9917d2['body'][_0x3ae15d(0xb0)]],_0x1f333f=[..._0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x14c)]];const _0xd389d7=_0x4ced05['map'](_0x148ac3=>{return _0x148ac3={'product_name':_0x148ac3};});_0x2f6913[_0x3ae15d(0xd3)]((_0x48444c,_0x2c0936)=>{_0xd389d7[_0x2c0936]['product_code']=_0x48444c;}),_0x168f29[_0x3ae15d(0xd3)]((_0x3ae221,_0x2de915)=>{var _0x254a9c=_0x3ae15d;_0xd389d7[_0x2de915][_0x254a9c(0x16f)]=_0x3ae221;}),_0x28f7f4['forEach']((_0x3a76b2,_0x149add)=>{var _0x3ddc82=_0x3ae15d;_0xd389d7[_0x149add][_0x3ddc82(0xb2)]=_0x3a76b2;}),_0x3f435c[_0x3ae15d(0xd3)]((_0x11b5a1,_0x22cf19)=>{var _0x188b50=_0x3ae15d;_0xd389d7[_0x22cf19][_0x188b50(0x95)]=_0x11b5a1;}),_0x2dfb98['forEach']((_0x38a97e,_0xc54b12)=>{var _0x13d595=_0x3ae15d;_0xd389d7[_0xc54b12][_0x13d595(0x99)]=_0x38a97e;}),_0x56080c['forEach']((_0xd75da8,_0x1dcbd8)=>{_0xd389d7[_0x1dcbd8]['primary_code']=_0xd75da8;}),_0x1d92eb['forEach']((_0x512fc9,_0x48451b)=>{var _0x2e32c5=_0x3ae15d;_0xd389d7[_0x48451b][_0x2e32c5(0x113)]=_0x512fc9;}),_0x43c555[_0x3ae15d(0xd3)]((_0x1dc8d1,_0x4b2674)=>{_0xd389d7[_0x4b2674]['maxStocks']=_0x1dc8d1;}),_0x49a26f[_0x3ae15d(0xd3)]((_0x28955f,_0x28e8ec)=>{_0xd389d7[_0x28e8ec]['batch_code']=_0x28955f;}),_0x1f333f[_0x3ae15d(0xd3)]((_0x4a3427,_0xcc6f8f)=>{var _0x24f29c=_0x3ae15d;_0xd389d7[_0xcc6f8f][_0x24f29c(0x14c)]=_0x4a3427;});const _0x2500b2=_0xd389d7[_0x3ae15d(0x110)](_0x59ae20=>_0x59ae20['quantity']!=='0'&&_0x59ae20[_0x3ae15d(0x16f)]!=='');_0x4d8b93[_0x3ae15d(0x124)]=_0x3d26d1,_0x4d8b93[_0x3ae15d(0xdd)]=_0x1398db,_0x4d8b93[_0x3ae15d(0xfc)]=_0xaccd20,_0x4d8b93['warehouse_name']=_0x42372b,_0x4d8b93[_0x3ae15d(0xda)]=_0x2500b2,_0x4d8b93['note']=_0x360bb8,_0x4d8b93['paid_amount']=_0x269ea5,_0x4d8b93[_0x3ae15d(0x181)]=_0xe67337,_0x4d8b93['room']=_0x17c57e,_0x4d8b93[_0x3ae15d(0x100)]=_0x2058bc,_0x4d8b93[_0x3ae15d(0x15e)]=_0x34623b;const _0x413fcb=await _0x4d8b93['save'](),_0x14f7b9=await warehouse[_0x3ae15d(0x119)]({'name':_0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0xe6)],'room':_0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0xc4)]});_0x4d8b93[_0x3ae15d(0xda)][_0x3ae15d(0xd3)](_0x16a21f=>{var _0x139197=_0x3ae15d,_0x33c14d=0x0;const _0x445128=_0x14f7b9['product_details'][_0x139197(0x8d)](_0x320047=>{var _0x543124=_0x139197;_0x320047[_0x543124(0xbe)]==_0x16a21f[_0x543124(0xbe)]&&_0x320047['bay']==_0x16a21f['bay']&&(_0x320047[_0x543124(0xc5)]=parseInt(_0x320047[_0x543124(0xc5)])+parseInt(_0x16a21f[_0x543124(0x16f)]),_0x33c14d++);});_0x33c14d=='0'&&(_0x14f7b9[_0x139197(0x86)]=_0x14f7b9['product_details'][_0x139197(0xe0)]({'product_name':_0x16a21f[_0x139197(0xbe)],'product_stock':_0x16a21f[_0x139197(0x16f)],'primary_code':_0x16a21f[_0x139197(0xe3)],'secondary_code':_0x16a21f['secondary_code'],'product_code':_0x16a21f[_0x139197(0x90)],'bay':_0x16a21f[_0x139197(0x99)],'maxProducts':_0x16a21f[_0x139197(0x9e)],'unit':_0x16a21f['standard_unit'],'secondary_unit':_0x16a21f['secondary_unit'],'expiry_date':_0x16a21f[_0x139197(0x14c)]}));}),await _0x14f7b9['save']();const _0x2ac517=await s_payment_data[_0x3ae15d(0x119)]({'invoice':_0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0x124)]});if(_0x2ac517===null){}else console[_0x3ae15d(0xfb)](_0x3ae15d(0xdd),_0x2ac517,_0x9917d2[_0x3ae15d(0xa5)]['invoice']),_0x2ac517['suppliers']=_0x9917d2[_0x3ae15d(0xa5)][_0x3ae15d(0xdd)],await _0x2ac517[_0x3ae15d(0x17a)]();_0x9917d2[_0x3ae15d(0xb6)](_0x3ae15d(0x12d),_0x3ae15d(0xd8)),_0x1ab6c7['redirect'](_0x3ae15d(0xd1));}catch(_0x5319b2){console[_0x3ae15d(0xfb)](_0x5319b2);}}),router[a0_0x3af37a(0x141)](a0_0x3af37a(0xb3),auth,async(_0x5eecb0,_0x4ef1b8)=>{var _0x2bbe44=a0_0x3af37a;try{const _0x3772cf=_0x5eecb0['params']['id'],{invoice:_0x4af8b3,suppliers:_0x5c0bc4,payable:_0x39b5c8,due_amount:_0x210438}=_0x5eecb0['body'],_0x52936d=await purchases[_0x2bbe44(0xc2)](_0x3772cf);var _0x172c41=_0x39b5c8-_0x210438;_0x52936d[_0x2bbe44(0xd4)]=parseFloat(_0x52936d[_0x2bbe44(0xd4)])+parseFloat(_0x210438),_0x52936d[_0x2bbe44(0x181)]=_0x172c41;const _0x56d85e=await _0x52936d['save']();console[_0x2bbe44(0xfb)](_0x56d85e);const _0xfb9f5c=await s_payment_data[_0x2bbe44(0x119)]({'invoice':_0x4af8b3});_0xfb9f5c[_0x2bbe44(0x96)]=_0x172c41,await _0xfb9f5c[_0x2bbe44(0x17a)]();let _0x5820ce=new Date(),_0x4aff54=('0'+_0x5820ce[_0x2bbe44(0x105)]())[_0x2bbe44(0x12a)](-0x2),_0x27e2c0=('0'+(_0x5820ce[_0x2bbe44(0xcf)]()+0x1))[_0x2bbe44(0x12a)](-0x2),_0x3e24eb=_0x5820ce[_0x2bbe44(0xfa)](),_0x3748d8=_0x3e24eb+'-'+_0x27e2c0+'-'+_0x4aff54;const _0x10b3be=new suppliers_payment({'invoice':_0x4af8b3,'date':_0x3e24eb+'-'+_0x27e2c0+'-'+_0x4aff54,'suppliers':_0x5c0bc4,'reason':_0x2bbe44(0x173),'amount':_0x210438}),_0x1368d4=await _0x10b3be[_0x2bbe44(0x17a)]();_0x5eecb0[_0x2bbe44(0xb6)](_0x2bbe44(0x12d),_0x2bbe44(0x11d)),_0x4ef1b8['redirect'](_0x2bbe44(0xaa));}catch(_0x2ce51c){console[_0x2bbe44(0xfb)](_0x2ce51c);}}),router[a0_0x3af37a(0x12b)](a0_0x3af37a(0x13c),auth,async(_0x35051c,_0x22d9bc)=>{var _0x3be44d=a0_0x3af37a;try{const {username:_0x4b25b1,email:_0x2a272d,role:_0x2ab75f}=_0x35051c[_0x3be44d(0x10b)],_0x3e86ba=_0x35051c[_0x3be44d(0x10b)],_0x5f3212=await profile[_0x3be44d(0x119)]({'email':_0x3e86ba[_0x3be44d(0x174)]}),_0x58a2fc=await master_shop['find']();console[_0x3be44d(0xfb)]('master',_0x58a2fc);const _0x3dbfa6=_0x35051c[_0x3be44d(0x147)]['id'],_0x3ff31b=await purchases[_0x3be44d(0xc2)](_0x3dbfa6);console[_0x3be44d(0xfb)](_0x3ff31b);const _0x249a40=await suppliers['findOne']({'name':_0x3ff31b[_0x3be44d(0xdd)]});console['log'](_0x249a40);if(_0x58a2fc[0x0]['language']=='English\x20(US)'){var _0x57dc07=users[_0x3be44d(0xe8)];console[_0x3be44d(0xfb)](_0x57dc07);}else{if(_0x58a2fc[0x0][_0x3be44d(0x131)]==_0x3be44d(0xf6))var _0x57dc07=users[_0x3be44d(0xf6)];else{if(_0x58a2fc[0x0]['language']=='German')var _0x57dc07=users[_0x3be44d(0x156)];else{if(_0x58a2fc[0x0][_0x3be44d(0x131)]==_0x3be44d(0x142))var _0x57dc07=users[_0x3be44d(0x142)];else{if(_0x58a2fc[0x0]['language']==_0x3be44d(0xc1))var _0x57dc07=users[_0x3be44d(0xc1)];else{if(_0x58a2fc[0x0][_0x3be44d(0x131)]==_0x3be44d(0x16a))var _0x57dc07=users[_0x3be44d(0x170)];else{if(_0x58a2fc[0x0]['language']==_0x3be44d(0x16b))var _0x57dc07=users[_0x3be44d(0x16b)];else{if(_0x58a2fc[0x0]['language']==_0x3be44d(0xa1))var _0x57dc07=users[_0x3be44d(0xbb)];}}}}}}}_0x22d9bc[_0x3be44d(0x103)](_0x3be44d(0x9a),{'success':_0x35051c[_0x3be44d(0xb6)]('success'),'errors':_0x35051c[_0x3be44d(0xb6)](_0x3be44d(0x177)),'role':_0x3e86ba,'profile':_0x5f3212,'master_shop':_0x58a2fc,'supplier':_0x249a40,'purchase':_0x3ff31b,'language':_0x57dc07});}catch(_0x2c51ad){console[_0x3be44d(0xfb)](_0x2c51ad);}}),router[a0_0x3af37a(0x12b)](a0_0x3af37a(0x13a),auth,async(_0x23d14f,_0x539cfa)=>{var _0x19021b=a0_0x3af37a;try{const {username:_0x1f0ddf,email:_0xb435bc,role:_0x4e1856}=_0x23d14f[_0x19021b(0x10b)],_0x127476=_0x23d14f[_0x19021b(0x10b)],_0x3d24c3=await profile[_0x19021b(0x119)]({'email':_0x127476[_0x19021b(0x174)]}),_0x53ab52=await master_shop[_0x19021b(0xe7)]();console[_0x19021b(0xfb)]('master',_0x53ab52);const _0x15c545=_0x23d14f[_0x19021b(0x147)]['id'];console[_0x19021b(0xfb)](_0x15c545);const _0x253acc=await purchases_finished[_0x19021b(0xc2)](_0x15c545);console[_0x19021b(0xfb)]('user_id',_0x253acc);const _0x76f12d=await product['find']({}),_0x21c3a2=await warehouse[_0x19021b(0x16c)]([{'$match':{'name':_0x253acc['warehouse_name'],'room':_0x253acc[_0x19021b(0x137)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x19021b(0xa4),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x19021b(0xa7)},'bay':{'$first':_0x19021b(0xba)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x19021b(0xc9)},'floorlevel':{'$first':_0x19021b(0x161)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x19021b(0x172)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x19021b(0xd9)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x19021b(0xfb)](_0x19021b(0x157),_0x21c3a2);let _0x4b39f1;if(_0x127476[_0x19021b(0x168)]=='staff'){const _0x339b93=await staff[_0x19021b(0x119)]({'email':_0x127476[_0x19021b(0x174)]});_0x4b39f1=await warehouse[_0x19021b(0xe7)]({'status':_0x19021b(0x125),'name':_0x339b93['warehouse'],'warehouse_category':_0x19021b(0x14a),'name':_0x19021b(0x127)});}else _0x4b39f1=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x19021b(0x14a),'name':_0x19021b(0x127)}},{'$group':{'_id':_0x19021b(0x158),'name':{'$first':_0x19021b(0x158)}}}]);if(_0x53ab52[0x0]['language']==_0x19021b(0xed)){var _0x7f57c0=users[_0x19021b(0xe8)];console[_0x19021b(0xfb)](_0x7f57c0);}else{if(_0x53ab52[0x0]['language']=='Hindi')var _0x7f57c0=users[_0x19021b(0xf6)];else{if(_0x53ab52[0x0]['language']=='German')var _0x7f57c0=users['German'];else{if(_0x53ab52[0x0][_0x19021b(0x131)]=='Spanish')var _0x7f57c0=users['Spanish'];else{if(_0x53ab52[0x0]['language']==_0x19021b(0xc1))var _0x7f57c0=users['French'];else{if(_0x53ab52[0x0]['language']=='Portuguese\x20(BR)')var _0x7f57c0=users[_0x19021b(0x170)];else{if(_0x53ab52[0x0]['language']=='Chinese')var _0x7f57c0=users[_0x19021b(0x16b)];else{if(_0x53ab52[0x0][_0x19021b(0x131)]=='Arabic\x20(ae)')var _0x7f57c0=users['Arabic'];}}}}}}}_0x539cfa['render'](_0x19021b(0x121),{'success':_0x23d14f['flash'](_0x19021b(0x12d)),'errors':_0x23d14f[_0x19021b(0xb6)](_0x19021b(0x177)),'role':_0x127476,'profile':_0x3d24c3,'user':_0x253acc,'stock':_0x21c3a2,'master_shop':_0x53ab52,'product':_0x76f12d,'language':_0x7f57c0,'warehouse':_0x4b39f1});}catch(_0x34f03c){console[_0x19021b(0xfb)](_0x34f03c);}}),router['post'](a0_0x3af37a(0x13a),auth,async(_0x4d13af,_0x1ec525)=>{var _0x1290a9=a0_0x3af37a;try{const {invoice:_0x16bec8,date:_0x330bd7,warehouse_name:_0x37a87b,Room_name:_0x1c8f7e,product_name:_0x491cfc,purchase_quantity:_0x317d10,stocks:_0x5a872d,return_qty:_0x1ec73b,note:_0x491d53,level:_0x5e1c1a,isle:_0x2bace9,pallet:_0x98d45,to_warehouse_name:_0x3ed868,to_Room_name:_0x729194}=_0x4d13af[_0x1290a9(0xa5)],_0x2dfa53=await purchases_finished['findOne']({'_id':_0x4d13af['params']['id']}),_0x89b4ce=await warehouse[_0x1290a9(0x119)]({'name':_0x37a87b,'room':_0x1c8f7e,'warehouse_category':'Finished\x20Goods'});if(typeof _0x491cfc==_0x1290a9(0xf8))var _0x78b066=[_0x4d13af[_0x1290a9(0xa5)][_0x1290a9(0xbe)]],_0x28325a=[_0x4d13af[_0x1290a9(0xa5)]['purchase_quantity']],_0x402017=[_0x4d13af[_0x1290a9(0xa5)]['stocks']],_0x5c7f42=[_0x4d13af[_0x1290a9(0xa5)][_0x1290a9(0x101)]],_0x3dcd79=[_0x4d13af[_0x1290a9(0xa5)]['level']],_0x2098ad=[_0x4d13af[_0x1290a9(0xa5)]['product_code_hide']],_0x21b59c=[_0x4d13af[_0x1290a9(0xa5)][_0x1290a9(0x167)]],_0x418003=[_0x4d13af['body'][_0x1290a9(0x175)]];else var _0x78b066=[..._0x4d13af['body'][_0x1290a9(0xbe)]],_0x28325a=[..._0x4d13af[_0x1290a9(0xa5)][_0x1290a9(0x162)]],_0x402017=[..._0x4d13af[_0x1290a9(0xa5)][_0x1290a9(0x93)]],_0x5c7f42=[..._0x4d13af['body'][_0x1290a9(0x101)]],_0x3dcd79=[..._0x4d13af[_0x1290a9(0xa5)][_0x1290a9(0xc3)]],_0x2098ad=[..._0x4d13af[_0x1290a9(0xa5)]['product_code_hide']],_0x21b59c=[..._0x4d13af[_0x1290a9(0xa5)][_0x1290a9(0x167)]],_0x418003=[..._0x4d13af[_0x1290a9(0xa5)]['secondary_code_hide']];const _0x352e38=_0x78b066[_0x1290a9(0x8d)](_0x1e0d39=>{return _0x1e0d39={'product_name':_0x1e0d39};});_0x28325a[_0x1290a9(0xd3)]((_0x40db8a,_0x82134d)=>{var _0x2b7adb=_0x1290a9;_0x352e38[_0x82134d][_0x2b7adb(0x162)]=_0x40db8a;}),_0x402017['forEach']((_0x3d346a,_0x12f244)=>{var _0x1b26a5=_0x1290a9;_0x352e38[_0x12f244][_0x1b26a5(0x176)]=_0x3d346a;}),_0x5c7f42[_0x1290a9(0xd3)]((_0x109f37,_0xa319f)=>{var _0x7c0298=_0x1290a9;_0x352e38[_0xa319f][_0x7c0298(0x101)]=_0x109f37;}),_0x3dcd79['forEach']((_0x27e6d3,_0x3ec5dd)=>{var _0x5a0672=_0x1290a9;_0x352e38[_0x3ec5dd][_0x5a0672(0x99)]=_0x27e6d3;}),_0x2098ad[_0x1290a9(0xd3)]((_0x18381e,_0x505c1a)=>{var _0x1d4544=_0x1290a9;_0x352e38[_0x505c1a][_0x1d4544(0x90)]=_0x18381e;}),_0x21b59c['forEach']((_0x302653,_0x1a741f)=>{var _0x375c2d=_0x1290a9;_0x352e38[_0x1a741f][_0x375c2d(0xe3)]=_0x302653;}),_0x418003[_0x1290a9(0xd3)]((_0x4e0615,_0xf0a134)=>{var _0x35dd38=_0x1290a9;_0x352e38[_0xf0a134][_0x35dd38(0x113)]=_0x4e0615;}),_0x352e38[_0x1290a9(0xd3)](_0x377402=>{var _0x12ea92=_0x1290a9;console[_0x12ea92(0xfb)](_0x377402);const _0x5b9a59=_0x89b4ce[_0x12ea92(0x86)][_0x12ea92(0x8d)](_0x3bdc50=>{var _0x445876=_0x12ea92;_0x3bdc50['product_name']==_0x377402[_0x445876(0xbe)]&&_0x3bdc50['bay']==_0x377402['bay']&&(console[_0x445876(0xfb)](parseInt(_0x3bdc50[_0x445876(0xc5)])+_0x445876(0x88)+parseInt(_0x377402['return_qty'])),_0x3bdc50[_0x445876(0xc5)]=parseInt(_0x3bdc50[_0x445876(0xc5)])-parseInt(_0x377402[_0x445876(0x101)]));});}),await _0x89b4ce[_0x1290a9(0x17a)]();var _0x58a815=0x0;_0x352e38[_0x1290a9(0xd3)](_0x517f66=>{var _0x31c3f5=_0x1290a9;(parseInt(_0x517f66['purchase_quantity'])<parseInt(_0x517f66[_0x31c3f5(0x101)])||parseInt(_0x517f66[_0x31c3f5(0x176)])<parseInt(_0x517f66['return_qty']))&&_0x58a815++;});if(_0x58a815!=0x0)return _0x4d13af['flash'](_0x1290a9(0x177),_0x1290a9(0xcb)),_0x1ec525[_0x1290a9(0xf1)](_0x1290a9(0xf5));const _0x2aa2da=new purchases_return_finished({'invoice':_0x16bec8,'suppliers':_0x4d13af[_0x1290a9(0xa5)][_0x1290a9(0xdd)],'date':_0x330bd7,'warehouse_name':_0x37a87b,'return_product':_0x352e38,'note':_0x491d53,'room':_0x1c8f7e,'to_warehouse_name':_0x3ed868,'to_room':_0x729194}),_0x3f49df=await _0x2aa2da[_0x1290a9(0x17a)](),_0x2e74cd=await purchases_return_finished[_0x1290a9(0x119)]({'invoice':_0x16bec8}),_0x246866=await warehouse[_0x1290a9(0x119)]({'name':_0x3ed868,'room':_0x729194,'warehouse_category':'Finished\x20Goods'});_0x2e74cd['return_product'][_0x1290a9(0xd3)](_0x3d6010=>{var _0x19d2a9=_0x1290a9,_0x1a39a8=0x0;const _0x31ef13=_0x246866[_0x19d2a9(0x86)][_0x19d2a9(0x8d)](_0x3869e0=>{var _0x3b365a=_0x19d2a9;console[_0x3b365a(0xfb)](_0x3869e0['product_name']+'=='+_0x3d6010[_0x3b365a(0xbe)]+'&&'+_0x3869e0[_0x3b365a(0x99)]+'=='+_0x3d6010[_0x3b365a(0x99)]),_0x3869e0[_0x3b365a(0xbe)]==_0x3d6010[_0x3b365a(0xbe)]&&_0x3869e0[_0x3b365a(0x99)]==_0x3d6010[_0x3b365a(0x99)]&&(_0x3869e0[_0x3b365a(0xc5)]=parseInt(_0x3869e0[_0x3b365a(0xc5)])-parseInt(_0x3d6010['return_qty']),_0x1a39a8++);});_0x1a39a8=='0'&&(_0x246866[_0x19d2a9(0x86)]=_0x246866['product_details'][_0x19d2a9(0xe0)]({'product_name':_0x3d6010[_0x19d2a9(0xbe)],'product_stock':_0x3d6010[_0x19d2a9(0x101)],'primary_code':_0x3d6010['primary_code'],'secondary_code':_0x3d6010[_0x19d2a9(0x113)],'product_code':_0x3d6010[_0x19d2a9(0x90)],'bay':_0x3d6010[_0x19d2a9(0x99)],'maxProducts':0xf423f}));}),await _0x246866['save']();const _0x31341d=await purchases_finished[_0x1290a9(0x119)]({'invoice':_0x16bec8});_0x31341d[_0x1290a9(0xeb)]=_0x1290a9(0x15a);const _0x6fd484=await _0x31341d[_0x1290a9(0x17a)](),_0x5c5f46=new s_payment_data({'invoice':_0x16bec8,'suppliers':_0x4d13af['body'][_0x1290a9(0xdd)],'reason':_0x1290a9(0x155)});await _0x5c5f46[_0x1290a9(0x17a)]();const _0xba73a2=await master_shop[_0x1290a9(0xe7)](),_0x42653c=await email_settings[_0x1290a9(0x119)](),_0xcf9ea1=await suppliers[_0x1290a9(0x119)]({'name':_0x4d13af[_0x1290a9(0xa5)][_0x1290a9(0xdd)]});_0xba73a2[0x0][_0x1290a9(0x8a)]==0x1?(right_currency=_0xba73a2[0x0][_0x1290a9(0x120)],left_currency=''):(right_currency='',left_currency=_0xba73a2[0x0][_0x1290a9(0x120)]);var _0x2268c3=_0x78b066,_0xd91faf=_0x5c7f42,_0x29f6d5='',_0x577dcc;for(_0x577dcc in _0x2268c3){_0x29f6d5+=_0x1290a9(0x89)+_0x1290a9(0x180)+_0x2268c3[_0x577dcc]+_0x1290a9(0xac)+_0x1290a9(0x180)+_0xd91faf[_0x577dcc]+_0x1290a9(0xac)+_0x1290a9(0x15b);}let _0x34b230=nodemailer[_0x1290a9(0x164)]({'service':_0x1290a9(0xe1),'auth':{'user':_0x42653c[_0x1290a9(0x174)],'pass':_0x42653c[_0x1290a9(0x114)]}}),_0xc25d2d={'from':_0x42653c[_0x1290a9(0x174)],'to':_0xcf9ea1[_0x1290a9(0x174)],'subject':_0x1290a9(0xdb),'attachments':[{'filename':_0x1290a9(0xfd),'path':__dirname+_0x1290a9(0xf3)+_0x1290a9(0x94)+_0xba73a2[0x0][_0x1290a9(0x87)],'cid':_0x1290a9(0x179)}],'html':'<!DOCTYPE\x20html>'+_0x1290a9(0x133)+_0x1290a9(0x16d)+_0x1290a9(0xb9)+_0x1290a9(0x149)+'<div>'+_0x1290a9(0xc6)+'</div>'+_0x1290a9(0xb9)+_0x1290a9(0x10c)+_0xba73a2[0x0]['site_title']+_0x1290a9(0xe2)+'</div>'+_0x1290a9(0x10e)+'<hr\x20class=\x22my-3\x22>'+_0x1290a9(0xb9)+_0x1290a9(0x132)+_0x1290a9(0x11b)+_0x16bec8+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1290a9(0x165)+_0x330bd7+'\x20'+'</span>'+_0x1290a9(0x104)+'</div>'+_0x1290a9(0x148)+_0x1290a9(0x17c)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1290a9(0xa8)+_0x1290a9(0xaf)+_0x1290a9(0x85)+'</tr>'+_0x1290a9(0x145)+_0x1290a9(0x8f)+'\x20'+_0x29f6d5+'\x20'+_0x1290a9(0xb1)+_0x1290a9(0xec)+_0x1290a9(0xb9)+_0x1290a9(0x128)+_0x1290a9(0xff)+_0xba73a2[0x0]['site_title']+_0x1290a9(0x104)+_0x1290a9(0x10e)+_0x1290a9(0x10e)+_0x1290a9(0x144)};_0x34b230['sendMail'](_0xc25d2d,function(_0x2ee582,_0x5f3560){var _0x413738=_0x1290a9;_0x2ee582?console[_0x413738(0xfb)](_0x413738(0x135)):console[_0x413738(0xfb)]('Email\x20sent\x20successfully');}),_0x4d13af[_0x1290a9(0xb6)]('success','purchases\x20item\x20return\x20successfull'),_0x1ec525[_0x1290a9(0xf1)](_0x1290a9(0xd1));}catch(_0x56fe6e){_0x1ec525[_0x1290a9(0xd2)](0xc8)[_0x1290a9(0xc0)]({'message':_0x56fe6e[_0x1290a9(0xd0)]});}}),router[a0_0x3af37a(0x12b)](a0_0x3af37a(0xee),auth,async(_0x471a33,_0x32eeeb)=>{var _0x30242d=a0_0x3af37a;try{const {username:_0x2a7809,email:_0x3b9195,role:_0x25b058}=_0x471a33[_0x30242d(0x10b)],_0x383931=_0x471a33[_0x30242d(0x10b)],_0x1f4289=await profile[_0x30242d(0x119)]({'email':_0x383931[_0x30242d(0x174)]}),_0x27d882=await master_shop[_0x30242d(0xe7)](),_0xfe4742=_0x471a33['params']['id'],_0x4e8ceb=await purchases_finished[_0x30242d(0xc2)](_0xfe4742);if(_0x27d882[0x0][_0x30242d(0x131)]==_0x30242d(0xed))var _0x243d75=users['English'];else{if(_0x27d882[0x0][_0x30242d(0x131)]==_0x30242d(0xf6))var _0x243d75=users['Hindi'];else{if(_0x27d882[0x0]['language']=='German')var _0x243d75=users[_0x30242d(0x156)];else{if(_0x27d882[0x0]['language']==_0x30242d(0x142))var _0x243d75=users['Spanish'];else{if(_0x27d882[0x0][_0x30242d(0x131)]=='French')var _0x243d75=users[_0x30242d(0xc1)];else{if(_0x27d882[0x0][_0x30242d(0x131)]=='Portuguese\x20(BR)')var _0x243d75=users[_0x30242d(0x170)];else{if(_0x27d882[0x0][_0x30242d(0x131)]==_0x30242d(0x16b))var _0x243d75=users[_0x30242d(0x16b)];else{if(_0x27d882[0x0][_0x30242d(0x131)]==_0x30242d(0xa1))var _0x243d75=users[_0x30242d(0xbb)];}}}}}}}_0x32eeeb[_0x30242d(0x103)]('all_purchases_barcode',{'success':_0x471a33[_0x30242d(0xb6)](_0x30242d(0x12d)),'errors':_0x471a33[_0x30242d(0xb6)](_0x30242d(0x177)),'role':_0x383931,'profile':_0x1f4289,'alldata':_0x4e8ceb,'master_shop':_0x27d882,'language':_0x243d75}),console[_0x30242d(0xfb)](alldata);}catch(_0x37e6be){console[_0x30242d(0xfb)](_0x37e6be);}}),router[a0_0x3af37a(0x141)](a0_0x3af37a(0x117),async(_0x38c7c8,_0x505303)=>{var _0xa4461e=a0_0x3af37a;const {product_code:_0x21c6aa}=_0x38c7c8[_0xa4461e(0xa5)];var _0x27eb72;const _0x39d5e0=await product[_0xa4461e(0x16c)]([{'$match':{'primary_code':_0x21c6aa,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0xa4461e(0x107),'name':{'$first':_0xa4461e(0x158)},'category':{'$first':_0xa4461e(0x178)},'brand':{'$first':_0xa4461e(0xef)},'unit':{'$first':_0xa4461e(0xa2)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0xa4461e(0xb4)},'primary_code':{'$first':_0xa4461e(0xbc)},'secondary_code':{'$first':_0xa4461e(0x116)},'maxStocks':{'$first':_0xa4461e(0x10d)},'maxProdPerUnit':{'$first':_0xa4461e(0x130)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xa4461e(0x115)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x55cbe2=await product[_0xa4461e(0x16c)]([{'$match':{'secondary_code':_0x21c6aa}},{'$group':{'_id':'$_id','name':{'$first':_0xa4461e(0x158)},'category':{'$first':_0xa4461e(0x178)},'brand':{'$first':'$brand'},'unit':{'$first':_0xa4461e(0xa2)},'alertquantity':{'$first':_0xa4461e(0x97)},'product_code':{'$first':_0xa4461e(0xb4)},'primary_code':{'$first':_0xa4461e(0xbc)},'secondary_code':{'$first':_0xa4461e(0x116)},'maxStocks':{'$first':_0xa4461e(0x10d)},'maxProdPerUnit':{'$first':_0xa4461e(0x130)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xa4461e(0x115)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x39d5e0['length']>0x0)_0x27eb72=_0x39d5e0;else _0x55cbe2[_0xa4461e(0xd7)]>0x0&&(_0x27eb72=_0x55cbe2);_0x505303[_0xa4461e(0xc0)](_0x27eb72);}),router['post'](a0_0x3af37a(0xcd),async(_0x1b24db,_0x1b83eb)=>{var _0x364782=a0_0x3af37a;const {productCode:_0x5bc3b7,bay:_0x346adb,warehouses:_0xb13cd0,room:_0xb961af}=_0x1b24db[_0x364782(0xa5)];console['log'](_0x1b24db[_0x364782(0xa5)]);try{const _0x21dcb9=await warehouse[_0x364782(0x16c)]([{'$match':{'name':_0xb13cd0,'room':_0xb961af}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x346adb)}},{'$group':{'_id':_0x364782(0xa4),'name':{'$first':_0x364782(0x138)},'product_stock':{'$first':_0x364782(0xa7)},'bay':{'$first':_0x364782(0xba)},'maxProducts':{'$first':_0x364782(0x17b)}}}]);_0x1b83eb[_0x364782(0xd2)](0xc8)[_0x364782(0xc0)](_0x21dcb9);}catch(_0x4bfc07){_0x1b83eb[_0x364782(0xd2)](0x194)[_0x364782(0xc0)]({'message':_0x4bfc07[_0x364782(0xd0)]});}}),module[a0_0x3af37a(0x8c)]=router;