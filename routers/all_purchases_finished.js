var a0_0x300711=a0_0xe246;(function(_0x23c248,_0x5842f8){var _0x37c8e9=a0_0xe246,_0x3f7b22=_0x23c248();while(!![]){try{var _0x573947=parseInt(_0x37c8e9(0x9c))/0x1+-parseInt(_0x37c8e9(0xcf))/0x2+-parseInt(_0x37c8e9(0x98))/0x3*(-parseInt(_0x37c8e9(0x14a))/0x4)+parseInt(_0x37c8e9(0xb9))/0x5+-parseInt(_0x37c8e9(0x124))/0x6*(parseInt(_0x37c8e9(0xcb))/0x7)+parseInt(_0x37c8e9(0x127))/0x8*(parseInt(_0x37c8e9(0xb3))/0x9)+-parseInt(_0x37c8e9(0xad))/0xa*(parseInt(_0x37c8e9(0xb0))/0xb);if(_0x573947===_0x5842f8)break;else _0x3f7b22['push'](_0x3f7b22['shift']());}catch(_0x4493ad){_0x3f7b22['push'](_0x3f7b22['shift']());}}}(a0_0x3a27,0x96c81));const express=require(a0_0x300711(0x164)),app=express(),router=express[a0_0x300711(0xc1)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x300711(0x7f)),auth=require(a0_0x300711(0x126)),nodemailer=require(a0_0x300711(0x122));var ejs=require('ejs');const path=require(a0_0x300711(0x14f)),users=require(a0_0x300711(0x82));function a0_0xe246(_0x588bfe,_0x368b71){var _0x3a271e=a0_0x3a27();return a0_0xe246=function(_0xe246c9,_0x1adfd2){_0xe246c9=_0xe246c9-0x78;var _0x5037be=_0x3a271e[_0xe246c9];return _0x5037be;},a0_0xe246(_0x588bfe,_0x368b71);}function a0_0x3a27(){var _0x5299cb=['$product_details.product_name','flash','map','product_stock','<!DOCTYPE\x20html>','password','status','nodemailer','/view','468zJMtFH','$warehouse_name','../middleware/auth','4843816mziMlt','German','catch','all_purchases_barcode','</tr>','\x20Order\x20Date\x20:\x20','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','user_id','prod_name','role','Arabic','Error\x20Occurs','edit_purchases_finished_view','prod_Qty','name','/upload/','secondary_code','<html><head><title></title>','findById','JO_number','Spanish','$product_details.product_stock','$unit','Hindi','toString','then','$room','add_purchases_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','site_title','purchase\x20data\x20update\x20successfully','bay','$product.type','FROZEN\x20GOODS','8YMXHRt','/preview/:id','$product_details.product_code','exports','$date','path','purchase\x20data\x20add\x20successfully','Rack\x201','message','</thead>','amount','Purchase\x20Mail','stock_quantity','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','return_purchase_finished','prod_cat','Enclosed','max_product_unit','/give_payment/:id','master','$product_details.type','product_code','$suppliers','updateOne','all_purchases_finished','express','$maxProdPerUnit','</h5>','Purchase\x20Return','<h2>\x20','DRY\x20GOODS','secondary_code_hide','$product.quantity','maxStocks','product_date','$name','forEach','due_amount','length','quantity','success','Finished\x20Goods','secondary_unit','<hr\x20class=\x22my-3\x22>','$brand','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','slice','$secondary_unit','json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','currency','/view/return_purchase/:id','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','return_data','../public/language/languages.json','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<span\x20style=\x22float:\x20right;\x22>','Ambient','</span>','purchase_quantity','$due_amount','</td>','$product_details.bin','$paid_amount','errors','/view/:id','createTransport','product_name','edit_purchases_finished','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','product','$maxStocks','<tr>','$expiry_date','prod_secondunit','457167FPmDhi','Email\x20sent\x20successfully','</table>','$product.room_name','969888NnDyoM','/barcode_scanner','English\x20(US)','string','abs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','save','floor','getMonth','/all_purchases_finished/view','Arabic\x20(ae)','expiry_date','maxperunit','</div>','primary_code_hide','host','error','200HIdPti','findOne','getFullYear','202829KEfAQJ','room','return_qty','9YdVKCz','get','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_details','INCF-','$product_details._id','3490415yoNpur','MaxStocks_data','Logo.png','An\x20error\x20occurred\x20while\x20saving\x20data.','Portuguese\x20(BR)','$product_code','</body></html>','French','Router','/view/add_purchases','/barcode/:id','room_name','<h5>','find','</head><body>','warehouse','getDate','params','42287QxKjoT','Error\x20occurred\x20while\x20processing\x20product:','</tbody>','prod_code','2241294nbtxaN','paid_amount','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details','$product','padStart','random','production_date','table\x20page','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','prod_level','logo','concat','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product_cat','suppliers','/../public','standard_unit','\x20</h2>','$product_details.rack','return_product','$return_data','aggregate','/CheckingWarehouse','warehouse_name','redirect','stock_data','Enabled','$product_details.maxProducts','filter','render','$secondary_code','prod_unit','post','Rack\x202','body','True','staff','$batch_code','$product_details.secondary_code','Chinese','prod_qty','user','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<tbody\x20style=\x22text-align:\x20center;\x22>','email','batch_code','$_id','$product.bin','$product_details.storage','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','prod_primunit','level','RoomAssign','<h5\x20style=\x22text-align:\x20left;\x22>','$primary_code','QA\x20Warehouse','$alertquantity','prod_invoice','invoice','$note','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/view/add_purchases/:id','$suppliers_docs','<div>','$product_details.floorlevel','Paid\x20For\x20Purchase','log','purchase_invoice','<strong>\x20Regards\x20</strong>','English','primary_code','date','$invoice','POnumber'];a0_0x3a27=function(){return _0x5299cb;};return a0_0x3a27();}router['get'](a0_0x300711(0x123),auth,async(_0x1fe67e,_0x5a15ee)=>{var _0x41ac5e=a0_0x300711;try{const {username:_0x487d11,email:_0x36cc2d,role:_0x2681e7}=_0x1fe67e[_0x41ac5e(0xf9)],_0x198b75=_0x1fe67e[_0x41ac5e(0xf9)],_0x13cccc=await profile['findOne']({'email':_0x198b75[_0x41ac5e(0xfc)]}),_0x46f0b7=await staff[_0x41ac5e(0xae)]({'email':_0x198b75[_0x41ac5e(0xfc)]});if(_0x198b75['role']=='staff'){const _0x19f1fb=await staff['findOne']({'email':_0x198b75[_0x41ac5e(0xfc)]});}const _0x5b3b79=await master_shop['find']();let _0x518748;if(_0x198b75[_0x41ac5e(0x131)]=='staff'){const _0x440836=await staff[_0x41ac5e(0xae)]({'email':_0x198b75[_0x41ac5e(0xfc)]});_0x518748=await purchases_finished[_0x41ac5e(0xe5)]([{'$match':{'warehouse_name':_0x440836[_0x41ac5e(0xc8)]}},{'$lookup':{'from':'suppliers','localField':_0x41ac5e(0xde),'foreignField':_0x41ac5e(0x136),'as':'suppliers_docs'}},{'$unwind':_0x41ac5e(0x10f)},{'$unwind':_0x41ac5e(0xd3)},{'$group':{'_id':_0x41ac5e(0xfe),'invoice':{'$first':_0x41ac5e(0x119)},'suppliers':{'$first':_0x41ac5e(0x161)},'date':{'$first':_0x41ac5e(0x14e)},'warehouse_name':{'$first':_0x41ac5e(0x125)},'room':{'$first':_0x41ac5e(0x142)},'product':{'$push':_0x41ac5e(0xd3)},'note':{'$first':_0x41ac5e(0x10c)},'paid_amount':{'$first':_0x41ac5e(0x8b)},'due_amount':{'$first':_0x41ac5e(0x88)},'return_data':{'$first':_0x41ac5e(0xe4)},'batch_code':{'$first':_0x41ac5e(0xf5)},'expiry_date':{'$first':_0x41ac5e(0x96)},'suppliers_docs':{'$first':_0x41ac5e(0x10f)},'total_product_quantity':{'$sum':_0x41ac5e(0x16b)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x41ac5e(0x148)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x518748=await purchases_finished[_0x41ac5e(0xe5)]([{'$unwind':'$product'},{'$group':{'_id':_0x41ac5e(0xfe),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x41ac5e(0x161)},'date':{'$first':_0x41ac5e(0x14e)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x41ac5e(0x9b)},'product':{'$push':_0x41ac5e(0xd3)},'note':{'$first':_0x41ac5e(0x10c)},'paid_amount':{'$first':_0x41ac5e(0x8b)},'due_amount':{'$first':_0x41ac5e(0x88)},'return_data':{'$first':_0x41ac5e(0xe4)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x41ac5e(0x10f)},'total_product_quantity':{'$sum':_0x41ac5e(0x16b)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x41ac5e(0xff)},'type':{'$addToSet':_0x41ac5e(0x148)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x5b3b79[0x0][_0x41ac5e(0x101)]==_0x41ac5e(0x9e))var _0x5a940c=users[_0x41ac5e(0x116)];else{if(_0x5b3b79[0x0][_0x41ac5e(0x101)]==_0x41ac5e(0x13f))var _0x5a940c=users[_0x41ac5e(0x13f)];else{if(_0x5b3b79[0x0][_0x41ac5e(0x101)]==_0x41ac5e(0x128))var _0x5a940c=users[_0x41ac5e(0x128)];else{if(_0x5b3b79[0x0][_0x41ac5e(0x101)]==_0x41ac5e(0x13c))var _0x5a940c=users[_0x41ac5e(0x13c)];else{if(_0x5b3b79[0x0][_0x41ac5e(0x101)]==_0x41ac5e(0xc0))var _0x5a940c=users[_0x41ac5e(0xc0)];else{if(_0x5b3b79[0x0][_0x41ac5e(0x101)]==_0x41ac5e(0xbd))var _0x5a940c=users['Portuguese'];else{if(_0x5b3b79[0x0][_0x41ac5e(0x101)]==_0x41ac5e(0xf7))var _0x5a940c=users[_0x41ac5e(0xf7)];else{if(_0x5b3b79[0x0][_0x41ac5e(0x101)]==_0x41ac5e(0xa6))var _0x5a940c=users['Arabic'];}}}}}}}_0x5a15ee['render'](_0x41ac5e(0x163),{'success':_0x1fe67e[_0x41ac5e(0x11c)](_0x41ac5e(0x173)),'errors':_0x1fe67e[_0x41ac5e(0x11c)](_0x41ac5e(0x8c)),'purchases':_0x518748,'role':_0x198b75,'profile':_0x13cccc,'master_shop':_0x5b3b79,'language':_0x5a940c});}catch(_0x5c9879){console[_0x41ac5e(0x113)](_0x41ac5e(0xd7),_0x5c9879),_0x5a15ee[_0x41ac5e(0x121)](0xc8)[_0x41ac5e(0x7b)]({'message':_0x5c9879[_0x41ac5e(0x152)]});}});function BayBinSelected(_0x1a2b31,_0x4608ba){var _0x46eda9=a0_0x300711,_0x18fb1c=[],_0x6ded41=[];if(_0x1a2b31==_0x46eda9(0x169)){switch(_0x4608ba){case _0x46eda9(0x151):_0x18fb1c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x18fb1c=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x6ded41=['DG'];}else{if(_0x1a2b31==_0x46eda9(0x149)){switch(_0x4608ba){case'Rack\x201':_0x18fb1c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x46eda9(0xf1):_0x18fb1c=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x6ded41=['FG'];}}return{'levels':_0x18fb1c,'identify':_0x6ded41};}async function getRandom8DigitNumber(){var _0x112b5d=a0_0x300711;const _0xa268b8=0x989680,_0x56b2b9=0x5f5e0ff,_0x3d3cfe=Math[_0x112b5d(0xa3)](Math[_0x112b5d(0xd5)]()*(_0x56b2b9-_0xa268b8+0x1))+_0xa268b8;var _0x347258;const _0x2b65eb=await purchases_finished[_0x112b5d(0xae)]({'invoice':_0x112b5d(0xb7)+_0x3d3cfe});return _0x2b65eb&&_0x2b65eb[_0x112b5d(0x171)]>0x0?_0x347258=_0x112b5d(0xb7)+_0x3d3cfe:_0x347258='INCF-'+_0x3d3cfe,_0x347258;}router[a0_0x300711(0xb4)](a0_0x300711(0xc2),auth,async(_0x3417ca,_0x357260)=>{var _0x185bd4=a0_0x300711;try{const {username:_0x56a374,email:_0x51d624,role:_0x609468}=_0x3417ca[_0x185bd4(0xf9)],_0xdeb12a=_0x3417ca[_0x185bd4(0xf9)],_0x490c0f=await profile[_0x185bd4(0xae)]({'email':_0xdeb12a['email']}),_0x2d13c0=await master_shop['find'](),_0x3861c9=await staff[_0x185bd4(0xae)]({'email':_0xdeb12a['email']}),_0x41f035=await suppliers[_0x185bd4(0xc6)]({});let _0x1386f7;if(_0xdeb12a[_0x185bd4(0x131)]==_0x185bd4(0xf4)){const _0x8f2b8b=await staff[_0x185bd4(0xae)]({'email':_0xdeb12a['email']});_0x1386f7=await warehouse[_0x185bd4(0xe5)]([{'$match':{'status':'Enabled','name':_0x8f2b8b[_0x185bd4(0xc8)],'warehouse_category':_0x185bd4(0x174)}},{'$group':{'_id':_0x185bd4(0x16e),'name':{'$first':_0x185bd4(0x16e)}}}]);}else _0x1386f7=await warehouse['aggregate']([{'$match':{'status':_0x185bd4(0xea),'warehouse_category':_0x185bd4(0x174),'name':{'$ne':_0x185bd4(0x108)}}},{'$group':{'_id':_0x185bd4(0x16e),'name':{'$first':'$name'}}}]);const _0x3e20c7=await product[_0x185bd4(0xc6)]({}),_0x534f22=await warehouse['find']({'status':_0x185bd4(0xea)}),_0x1305da=await purchases_finished[_0x185bd4(0xc6)]({}),_0x18542f=_0x1305da[_0x185bd4(0x171)]+0x1,_0x48529c=_0x185bd4(0xb7)+_0x18542f[_0x185bd4(0x140)]()[_0x185bd4(0xd4)](0x5,'0');var _0x37251f=[_0x185bd4(0x85),_0x185bd4(0x15b)];if(_0x2d13c0[0x0][_0x185bd4(0x101)]=='English\x20(US)')var _0x515e67=users[_0x185bd4(0x116)];else{if(_0x2d13c0[0x0]['language']==_0x185bd4(0x13f))var _0x515e67=users[_0x185bd4(0x13f)];else{if(_0x2d13c0[0x0]['language']=='German')var _0x515e67=users[_0x185bd4(0x128)];else{if(_0x2d13c0[0x0][_0x185bd4(0x101)]==_0x185bd4(0x13c))var _0x515e67=users[_0x185bd4(0x13c)];else{if(_0x2d13c0[0x0][_0x185bd4(0x101)]==_0x185bd4(0xc0))var _0x515e67=users[_0x185bd4(0xc0)];else{if(_0x2d13c0[0x0]['language']==_0x185bd4(0xbd))var _0x515e67=users['Portuguese'];else{if(_0x2d13c0[0x0][_0x185bd4(0x101)]==_0x185bd4(0xf7))var _0x515e67=users[_0x185bd4(0xf7)];else{if(_0x2d13c0[0x0]['language']=='Arabic\x20(ae)')var _0x515e67=users[_0x185bd4(0x132)];}}}}}}}const _0x1f5377=getRandom8DigitNumber();_0x1f5377[_0x185bd4(0x141)](_0x2fdc8f=>{var _0x4810ca=_0x185bd4;_0x357260['render'](_0x4810ca(0x143),{'success':_0x3417ca[_0x4810ca(0x11c)]('success'),'errors':_0x3417ca[_0x4810ca(0x11c)](_0x4810ca(0x8c)),'role':_0xdeb12a,'profile':_0x490c0f,'suppliers':_0x41f035,'warehouse':_0x1386f7,'product':_0x3e20c7,'invoice':_0x2fdc8f,'master_shop':_0x2d13c0,'language':_0x515e67,'find_data':_0x534f22,'rooms_data':_0x37251f});})[_0x185bd4(0x129)](_0x11c358=>{var _0x3efeb4=_0x185bd4;_0x3417ca['flash'](_0x3efeb4(0x8c),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x357260[_0x3efeb4(0xe8)]('/all_purchases_finished/view');});}catch(_0x4499d7){console['log'](_0x4499d7);}}),router['get'](a0_0x300711(0x10e),auth,async(_0x22d932,_0x2d181a)=>{var _0x337ed9=a0_0x300711;try{const _0x231dc7=_0x22d932[_0x337ed9(0xca)]['id'];console[_0x337ed9(0x113)](_0x231dc7);const _0x170fdb=await master_shop['find']();console[_0x337ed9(0x113)](_0x337ed9(0x15e),_0x170fdb);const _0x102f0a=await product[_0x337ed9(0xae)]({'name':_0x231dc7});console[_0x337ed9(0x113)](_0x337ed9(0x93),_0x102f0a),_0x2d181a['status'](0xc8)['json']({'product_data':_0x102f0a,'master':_0x170fdb});}catch(_0x31f767){console[_0x337ed9(0x113)]('add_purchases\x20error',_0x31f767);}}),router[a0_0x300711(0xf0)](a0_0x300711(0xc2),auth,async(_0x2acaf9,_0x52d734)=>{var _0x3f4d51=a0_0x300711;try{const {invoice:_0x420f2d,date:_0x189a9d,warehouse_name:_0x4cab46,prod_name:_0x39ff28,prod_code:_0x29ce2d,prod_qty:_0x47f901,prod_unit:_0x27b59c,prod_secondunit:_0x49851e,prod_level:_0x442af1,prod_isle:_0x3a214c,prod_pallet:_0x1a6841,note:_0x8c818e,expiry_date:_0x3a7bf1,batch_code:_0x2e4b1c,payable:_0x46dab9,due_amount:_0x13873e,Room_name:_0x26d8e0,primary_code:_0x5b38bb,secondary_code:_0x4b079b,MaxStocks_data:_0x42597f,PO_number:_0x1f2e3a,SCRN:_0x3fd6d4,JO_number:_0x3fbce0}=_0x2acaf9['body'];if(typeof _0x39ff28==_0x3f4d51(0x9f))var _0x5b7ff7=[_0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x130)]],_0x303b9a=[_0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0xce)]],_0x38275a=[_0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x135)]],_0x14630f=[_0x2acaf9['body'][_0x3f4d51(0x103)]],_0x41dd7a=[_0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x97)]],_0x241e8d=[_0x2acaf9[_0x3f4d51(0xf2)]['prod_level']],_0x170e14=[_0x2acaf9[_0x3f4d51(0xf2)]['primary_code']],_0x5d571d=[_0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x138)]],_0x3fb12e=[_0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0xba)]],_0x18b6c3=[_0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0xfd)]],_0x59d867=[_0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0xa7)]],_0x380b4c=[_0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x16d)]],_0x2e43bb=[_0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x15c)]],_0x382e05=[_0x2acaf9['body'][_0x3f4d51(0x15a)]],_0xf50718=[_0x2acaf9['body'][_0x3f4d51(0x105)]],_0x555439=[_0x2acaf9['body'][_0x3f4d51(0x10a)]];else var _0x5b7ff7=[..._0x2acaf9[_0x3f4d51(0xf2)]['prod_name']],_0x303b9a=[..._0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0xce)]],_0x38275a=[..._0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x135)]],_0x14630f=[..._0x2acaf9['body']['prod_primunit']],_0x41dd7a=[..._0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x97)]],_0x241e8d=[..._0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0xd9)]],_0x170e14=[..._0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x117)]],_0x5d571d=[..._0x2acaf9['body'][_0x3f4d51(0x138)]],_0x3fb12e=[..._0x2acaf9[_0x3f4d51(0xf2)]['MaxStocks_data']],_0x18b6c3=[..._0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0xfd)]],_0x59d867=[..._0x2acaf9[_0x3f4d51(0xf2)]['expiry_date']],_0x380b4c=[..._0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x16d)]],_0x2e43bb=[..._0x2acaf9['body'][_0x3f4d51(0x15c)]],_0x382e05=[..._0x2acaf9['body'][_0x3f4d51(0x15a)]],_0xf50718=[..._0x2acaf9[_0x3f4d51(0xf2)]['RoomAssign']],_0x555439=[..._0x2acaf9[_0x3f4d51(0xf2)][_0x3f4d51(0x10a)]];const _0x565240=_0x5b7ff7[_0x3f4d51(0x11d)](_0x146636=>{return _0x146636={'product_name':_0x146636};});_0x303b9a[_0x3f4d51(0x16f)]((_0x3749fd,_0x3ea3ee)=>{var _0x2c63b3=_0x3f4d51;_0x565240[_0x3ea3ee][_0x2c63b3(0x160)]=_0x3749fd;}),_0x38275a['forEach']((_0x4693d3,_0x1e9614)=>{var _0x587960=_0x3f4d51;_0x565240[_0x1e9614][_0x587960(0x172)]=Math['abs'](_0x4693d3);}),_0x14630f[_0x3f4d51(0x16f)]((_0x1f1793,_0x290046)=>{var _0x5e2226=_0x3f4d51;_0x565240[_0x290046][_0x5e2226(0xe0)]=_0x1f1793;}),_0x41dd7a[_0x3f4d51(0x16f)]((_0x521872,_0x2f3890)=>{var _0x348093=_0x3f4d51;_0x565240[_0x2f3890][_0x348093(0x175)]=_0x521872;}),_0x241e8d['forEach']((_0x4242fa,_0x266cf8)=>{var _0x397513=_0x3f4d51;_0x565240[_0x266cf8][_0x397513(0x147)]=_0x4242fa;}),_0x170e14[_0x3f4d51(0x16f)]((_0x449554,_0x1156b4)=>{var _0x489af6=_0x3f4d51;_0x565240[_0x1156b4][_0x489af6(0x117)]=_0x449554;}),_0x5d571d[_0x3f4d51(0x16f)]((_0x3c1f03,_0x21dde1)=>{_0x565240[_0x21dde1]['secondary_code']=_0x3c1f03;}),_0x3fb12e[_0x3f4d51(0x16f)]((_0x435e4e,_0x313b4f)=>{var _0x5c5f87=_0x3f4d51;_0x565240[_0x313b4f][_0x5c5f87(0x16c)]=_0x435e4e;}),_0x18b6c3[_0x3f4d51(0x16f)]((_0x46946a,_0x17d837)=>{var _0x417c84=_0x3f4d51;_0x565240[_0x17d837][_0x417c84(0xfd)]=_0x46946a;}),_0x59d867['forEach']((_0x4b9288,_0x22a46c)=>{var _0xd8f9e5=_0x3f4d51;_0x565240[_0x22a46c][_0xd8f9e5(0xa7)]=_0x4b9288;}),_0x380b4c[_0x3f4d51(0x16f)]((_0x1d4913,_0x1df8ae)=>{var _0x23f3cc=_0x3f4d51;_0x565240[_0x1df8ae][_0x23f3cc(0xd6)]=_0x1d4913;}),_0x2e43bb[_0x3f4d51(0x16f)]((_0x9d8ba2,_0x1229a5)=>{_0x565240[_0x1229a5]['maxperunit']=_0x9d8ba2;}),_0x382e05['forEach']((_0x1db043,_0x187d78)=>{var _0x55fe10=_0x3f4d51;_0x565240[_0x187d78][_0x55fe10(0xdd)]=_0x1db043;}),_0xf50718[_0x3f4d51(0x16f)]((_0x2737b5,_0x4a5c44)=>{_0x565240[_0x4a5c44]['room_name']=_0x2737b5;}),_0x555439[_0x3f4d51(0x16f)]((_0x14e9e6,_0x3476f4)=>{_0x565240[_0x3476f4]['invoice']=_0x14e9e6;});const _0x35385b=_0x565240[_0x3f4d51(0xec)](_0x435637=>_0x435637[_0x3f4d51(0x172)]!=='0'&&_0x435637['quantity']!==''),_0x582167=new purchases_finished({'invoice':_0x420f2d,'suppliers':_0x2acaf9['body'][_0x3f4d51(0xde)],'date':_0x189a9d,'warehouse_name':_0x4cab46,'product':_0x35385b,'note':_0x8c818e,'due_amount':_0x13873e,'room':_0x26d8e0,'POnumber':_0x1f2e3a,'SCRN':_0x3fd6d4,'JO_number':_0x3fbce0}),_0x4f5a19=await _0x582167[_0x3f4d51(0xa2)](),_0xccc1bb=await purchases_finished[_0x3f4d51(0xae)]({'invoice':_0x420f2d}),_0x3742e7=_0xccc1bb[_0x3f4d51(0x93)][_0x3f4d51(0x11d)](async _0x44bac7=>{var _0x45c7dc=_0x3f4d51;try{var _0x2911bb=await warehouse[_0x45c7dc(0xae)]({'name':_0x4cab46,'room':_0x44bac7['room_name']}),_0x4227d5=0x0;const _0x156aac=_0x2911bb[_0x45c7dc(0xb6)]['map'](_0x22f575=>{var _0xe769f3=_0x45c7dc;console[_0xe769f3(0x113)](_0x22f575['product_name']+'=='+_0x44bac7[_0xe769f3(0x8f)]+'&&'+_0x22f575[_0xe769f3(0x147)]+'=='+_0x44bac7['bay']+'&&'+_0x22f575['expiry_date']+'=='+_0x44bac7[_0xe769f3(0xa7)]+'&&'+_0x22f575[_0xe769f3(0xd6)]+'=='+_0x44bac7['production_date']+'&&'+_0x22f575[_0xe769f3(0xfd)]+'=='+_0x44bac7[_0xe769f3(0xfd)]+'&&'+_0x22f575['invoice']+'=='+_0xccc1bb[_0xe769f3(0x10b)]),_0x22f575[_0xe769f3(0x8f)]==_0x44bac7[_0xe769f3(0x8f)]&&_0x22f575[_0xe769f3(0x147)]==_0x44bac7['bay']&&_0x22f575[_0xe769f3(0xa7)]==_0x44bac7[_0xe769f3(0xa7)]&&_0x22f575['production_date']==_0x44bac7[_0xe769f3(0xd6)]&&_0x22f575['batch_code']==_0x44bac7[_0xe769f3(0xfd)]&&_0x22f575[_0xe769f3(0x10b)]==_0xccc1bb[_0xe769f3(0x10b)]&&(_0x22f575[_0xe769f3(0x11e)]=Math['abs'](_0x22f575['product_stock'])+Math[_0xe769f3(0xa0)](_0x44bac7[_0xe769f3(0x172)]),_0x4227d5++);});return _0x4227d5==0x0&&(_0x2911bb[_0x45c7dc(0xb6)]=_0x2911bb[_0x45c7dc(0xb6)]['concat']({'product_name':_0x44bac7[_0x45c7dc(0x8f)],'product_stock':Math[_0x45c7dc(0xa0)](_0x44bac7[_0x45c7dc(0x172)]),'primary_code':_0x44bac7['primary_code'],'secondary_code':_0x44bac7['secondary_code'],'product_code':_0x44bac7['product_code'],'bay':_0x44bac7[_0x45c7dc(0x147)],'maxProducts':_0x44bac7[_0x45c7dc(0x16c)],'unit':_0x44bac7['standard_unit'],'secondary_unit':_0x44bac7[_0x45c7dc(0x175)],'expiry_date':_0x44bac7[_0x45c7dc(0xa7)],'production_date':_0x44bac7[_0x45c7dc(0xd6)],'maxProducts':_0x44bac7[_0x45c7dc(0x16c)],'maxPerUnit':_0x44bac7[_0x45c7dc(0xa8)],'batch_code':_0x44bac7[_0x45c7dc(0xfd)],'product_cat':_0x44bac7[_0x45c7dc(0xdd)],'invoice':_0x44bac7['invoice'],'id_incoming':_0x44bac7[_0x45c7dc(0x12d)]})),_0x2911bb;}catch(_0x4c1fb9){return console[_0x45c7dc(0xac)](_0x45c7dc(0xcc),_0x4c1fb9),null;}});Promise['all'](_0x3742e7)[_0x3f4d51(0x141)](async _0x3528e7=>{var _0x45ee1b=_0x3f4d51;try{for(const _0x145f37 of _0x3528e7){await warehouse[_0x45ee1b(0x162)]({'_id':_0x145f37[_0x45ee1b(0x12d)]},{'$addToSet':{'product_details':{'$each':_0x145f37[_0x45ee1b(0xb6)]}}});}const _0x323ed7=await master_shop[_0x45ee1b(0xc6)](),_0x69c291=await email_settings['findOne'](),_0x51e94c=await supervisor_settings['find']();var _0x2c7eeb=_0xccc1bb[_0x45ee1b(0x93)],_0x497cc7='',_0x4fc951;for(_0x4fc951 in _0x2c7eeb){var _0x233ea3='FG';_0xccc1bb[_0x45ee1b(0xe7)]==_0x45ee1b(0x169)&&(_0x233ea3='DG'),_0x497cc7+='<tr>'+_0x45ee1b(0x10d)+_0x2c7eeb[_0x4fc951][_0x45ee1b(0x8f)]+_0x45ee1b(0x89)+_0x45ee1b(0x10d)+_0x2c7eeb[_0x4fc951][_0x45ee1b(0x160)]+_0x45ee1b(0x89)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2c7eeb[_0x4fc951]['quantity']+'</td>'+_0x45ee1b(0x10d)+_0x2c7eeb[_0x4fc951]['standard_unit']+_0x45ee1b(0x89)+_0x45ee1b(0x10d)+_0x2c7eeb[_0x4fc951][_0x45ee1b(0x175)]+_0x45ee1b(0x89)+_0x45ee1b(0x10d)+_0xccc1bb[_0x45ee1b(0xe7)]+_0x45ee1b(0x89)+_0x45ee1b(0x10d)+_0x2c7eeb[_0x4fc951][_0x45ee1b(0xc4)]+_0x45ee1b(0x89)+_0x45ee1b(0x10d)+_0x233ea3+_0x2c7eeb[_0x4fc951]['bay']+_0x45ee1b(0x89),_0x45ee1b(0x12b);}let _0x591a80=nodemailer[_0x45ee1b(0x8e)]({'host':_0x69c291[_0x45ee1b(0xab)],'port':Number(_0x69c291['port']),'secure':![],'auth':{'user':_0x69c291[_0x45ee1b(0xfc)],'pass':_0x69c291[_0x45ee1b(0x120)]}}),_0x2740b6={'from':_0x69c291[_0x45ee1b(0xfc)],'to':_0x51e94c[0x0]['FGSEmail'],'subject':_0x45ee1b(0x155),'attachments':[{'filename':_0x45ee1b(0xbb),'path':__dirname+_0x45ee1b(0xdf)+_0x45ee1b(0x137)+_0x323ed7[0x0]['image'],'cid':_0x45ee1b(0xda)}],'html':_0x45ee1b(0x11f)+_0x45ee1b(0x139)+_0x45ee1b(0xc7)+_0x45ee1b(0x110)+_0x45ee1b(0xd1)+_0x45ee1b(0x110)+_0x45ee1b(0x83)+'</div>'+_0x45ee1b(0x110)+_0x45ee1b(0x168)+_0x323ed7[0x0]['site_title']+'\x20</h2>'+_0x45ee1b(0xa9)+'</div>'+_0x45ee1b(0x176)+_0x45ee1b(0x110)+_0x45ee1b(0x106)+'\x20Order\x20Number\x20:\x20'+_0xccc1bb[_0x45ee1b(0x10b)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x45ee1b(0x12c)+_0xccc1bb[_0x45ee1b(0x118)]+'\x20'+'</span>'+_0x45ee1b(0x166)+_0x45ee1b(0xa9)+_0x45ee1b(0xdc)+_0x45ee1b(0x78)+_0x45ee1b(0x95)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x45ee1b(0xd8)+_0x45ee1b(0x12e)+_0x45ee1b(0x80)+_0x45ee1b(0x144)+_0x45ee1b(0x7c)+_0x45ee1b(0x102)+_0x45ee1b(0x158)+_0x45ee1b(0x12b)+_0x45ee1b(0x153)+_0x45ee1b(0xfb)+'\x20'+_0x497cc7+'\x20'+'</tbody>'+_0x45ee1b(0x9a)+'<div>'+_0x45ee1b(0x115)+_0x45ee1b(0xc5)+_0x323ed7[0x0][_0x45ee1b(0x145)]+_0x45ee1b(0x166)+_0x45ee1b(0xa9)+'</div>'+_0x45ee1b(0xbf)};_0x591a80['sendMail'](_0x2740b6,function(_0x2c57b6,_0x2e6c1e){var _0x555fb6=_0x45ee1b;_0x2c57b6?(console[_0x555fb6(0x113)](_0x2c57b6),console[_0x555fb6(0x113)](_0x555fb6(0x133))):console[_0x555fb6(0x113)]('Email\x20sent\x20successfully');});}catch(_0x23b69c){console[_0x45ee1b(0xac)](_0x23b69c),_0x52d734[_0x45ee1b(0x121)](0x1f4)['json']({'error':_0x45ee1b(0xbc),'message':_0x23b69c[_0x45ee1b(0x152)]});}})[_0x3f4d51(0x129)](_0x1a9873=>{var _0x1342fe=_0x3f4d51;console[_0x1342fe(0xac)](_0x1a9873);}),_0x2acaf9['flash'](_0x3f4d51(0x173),_0x3f4d51(0x150)),_0x52d734[_0x3f4d51(0xe8)](_0x3f4d51(0xa5));}catch(_0x2d6370){console[_0x3f4d51(0x113)](_0x2d6370);}}),router['get'](a0_0x300711(0x14b),auth,async(_0x51cbc5,_0x38ea92)=>{var _0x1be696=a0_0x300711;try{const {username:_0x10c766,email:_0x49f52c,role:_0x5107f0}=_0x51cbc5[_0x1be696(0xf9)],_0x339c3d=_0x51cbc5[_0x1be696(0xf9)],_0x48b88a=await profile[_0x1be696(0xae)]({'email':_0x339c3d[_0x1be696(0xfc)]}),_0x33688a=await master_shop['find'](),_0x1e1ede=_0x51cbc5['params']['id'],_0x333fbb=await purchases_finished[_0x1be696(0x13a)](_0x1e1ede),_0x1020b5=await suppliers[_0x1be696(0xc6)]({});let _0x5e5169;if(_0x339c3d['role']==_0x1be696(0xf4)){const _0x3098fe=await staff[_0x1be696(0xae)]({'email':_0x339c3d[_0x1be696(0xfc)]});_0x5e5169=await warehouse['find']({'status':_0x1be696(0xea),'name':_0x3098fe['warehouse'],'warehouse_category':_0x1be696(0x174)});}else _0x5e5169=await warehouse[_0x1be696(0xe5)]([{'$match':{'status':_0x1be696(0xea),'warehouse_category':_0x1be696(0x174)}},{'$group':{'_id':'$name','name':{'$first':_0x1be696(0x16e)}}}]);const _0x5037e0=await product[_0x1be696(0xc6)]({}),_0xd0deff=BayBinSelected(_0x333fbb[_0x1be696(0xe7)],_0x333fbb['room']);let _0x50df51=new Date(_0x333fbb['expiry_date']),_0x540ae8=('0'+_0x50df51['getDate']())[_0x1be696(0x79)](-0x2),_0x47a917=('0'+(_0x50df51[_0x1be696(0xa4)]()+0x1))[_0x1be696(0x79)](-0x2),_0xa0a87d=_0x50df51['getFullYear'](),_0x2ae9e5=_0xa0a87d+'-'+_0x47a917+'-'+_0x540ae8;if(_0x33688a[0x0]['language']=='English\x20(US)'){var _0x32cb35=users[_0x1be696(0x116)];console['log'](_0x32cb35);}else{if(_0x33688a[0x0][_0x1be696(0x101)]=='Hindi')var _0x32cb35=users[_0x1be696(0x13f)];else{if(_0x33688a[0x0]['language']==_0x1be696(0x128))var _0x32cb35=users[_0x1be696(0x128)];else{if(_0x33688a[0x0][_0x1be696(0x101)]=='Spanish')var _0x32cb35=users[_0x1be696(0x13c)];else{if(_0x33688a[0x0][_0x1be696(0x101)]=='French')var _0x32cb35=users[_0x1be696(0xc0)];else{if(_0x33688a[0x0][_0x1be696(0x101)]=='Portuguese\x20(BR)')var _0x32cb35=users[_0x1be696(0x157)];else{if(_0x33688a[0x0]['language']==_0x1be696(0xf7))var _0x32cb35=users[_0x1be696(0xf7)];else{if(_0x33688a[0x0][_0x1be696(0x101)]==_0x1be696(0xa6))var _0x32cb35=users['Arabic'];}}}}}}}_0x38ea92[_0x1be696(0xed)](_0x1be696(0x134),{'success':_0x51cbc5['flash'](_0x1be696(0x173)),'errors':_0x51cbc5[_0x1be696(0x11c)]('errors'),'role':_0x339c3d,'profile':_0x48b88a,'purchases':_0x333fbb,'suppliers':_0x1020b5,'warehouse':_0x5e5169,'product':_0x5037e0,'master_shop':_0x33688a,'language':_0x32cb35,'ed_fullDate':_0x2ae9e5,'dataSelected':_0xd0deff});}catch(_0x12c373){console['log'](_0x12c373);}}),router[a0_0x300711(0xb4)](a0_0x300711(0x8d),auth,async(_0x1e988a,_0x2da8c8)=>{var _0x4e8aaa=a0_0x300711;try{const {username:_0x30482e,email:_0x4875f8,role:_0x3b6571}=_0x1e988a[_0x4e8aaa(0xf9)],_0x5816cd=_0x1e988a[_0x4e8aaa(0xf9)],_0x995047=await profile[_0x4e8aaa(0xae)]({'email':_0x5816cd[_0x4e8aaa(0xfc)]}),_0x1bd42e=await master_shop[_0x4e8aaa(0xc6)](),_0x3e64ac=_0x1e988a[_0x4e8aaa(0xca)]['id'],_0x4f18df=await purchases_finished['findById'](_0x3e64ac),_0x426184=await suppliers[_0x4e8aaa(0xc6)]({});let _0x485769;if(_0x5816cd[_0x4e8aaa(0x131)]==_0x4e8aaa(0xf4)){const _0x39560b=await staff[_0x4e8aaa(0xae)]({'email':_0x5816cd['email']});_0x485769=await warehouse[_0x4e8aaa(0xc6)]({'status':'Enabled','name':_0x39560b['warehouse'],'warehouse_category':_0x4e8aaa(0x174)});}else _0x485769=await warehouse[_0x4e8aaa(0xe5)]([{'$match':{'status':_0x4e8aaa(0xea),'warehouse_category':_0x4e8aaa(0x174)}},{'$group':{'_id':_0x4e8aaa(0x16e),'name':{'$first':_0x4e8aaa(0x16e)}}}]);const _0x4174de=await product[_0x4e8aaa(0xc6)]({}),_0x214bc3=BayBinSelected(_0x4f18df[_0x4e8aaa(0xe7)],_0x4f18df[_0x4e8aaa(0xb1)]);let _0x123547=new Date(_0x4f18df[_0x4e8aaa(0xa7)]),_0x4cad18=('0'+_0x123547[_0x4e8aaa(0xc9)]())[_0x4e8aaa(0x79)](-0x2),_0x45b9cd=('0'+(_0x123547[_0x4e8aaa(0xa4)]()+0x1))[_0x4e8aaa(0x79)](-0x2),_0x3c72b1=_0x123547[_0x4e8aaa(0xaf)](),_0x2bfa65=_0x3c72b1+'-'+_0x45b9cd+'-'+_0x4cad18;if(_0x1bd42e[0x0]['language']==_0x4e8aaa(0x9e)){var _0x6d1a33=users['English'];console[_0x4e8aaa(0x113)](_0x6d1a33);}else{if(_0x1bd42e[0x0]['language']==_0x4e8aaa(0x13f))var _0x6d1a33=users[_0x4e8aaa(0x13f)];else{if(_0x1bd42e[0x0][_0x4e8aaa(0x101)]=='German')var _0x6d1a33=users[_0x4e8aaa(0x128)];else{if(_0x1bd42e[0x0]['language']=='Spanish')var _0x6d1a33=users['Spanish'];else{if(_0x1bd42e[0x0][_0x4e8aaa(0x101)]==_0x4e8aaa(0xc0))var _0x6d1a33=users[_0x4e8aaa(0xc0)];else{if(_0x1bd42e[0x0]['language']==_0x4e8aaa(0xbd))var _0x6d1a33=users['Portuguese'];else{if(_0x1bd42e[0x0]['language']==_0x4e8aaa(0xf7))var _0x6d1a33=users[_0x4e8aaa(0xf7)];else{if(_0x1bd42e[0x0][_0x4e8aaa(0x101)]==_0x4e8aaa(0xa6))var _0x6d1a33=users[_0x4e8aaa(0x132)];}}}}}}}_0x2da8c8['render'](_0x4e8aaa(0x90),{'success':_0x1e988a[_0x4e8aaa(0x11c)](_0x4e8aaa(0x173)),'errors':_0x1e988a[_0x4e8aaa(0x11c)]('errors'),'role':_0x5816cd,'profile':_0x995047,'purchases':_0x4f18df,'suppliers':_0x426184,'warehouse':_0x485769,'product':_0x4174de,'master_shop':_0x1bd42e,'language':_0x6d1a33,'ed_fullDate':_0x2bfa65,'dataSelected':_0x214bc3});}catch(_0x1d84c5){console['log'](_0x1d84c5);}}),router[a0_0x300711(0xf0)]('/view/:id',auth,async(_0x458689,_0xbb21c2)=>{var _0x168821=a0_0x300711;try{const _0x10585f=_0x458689[_0x168821(0xca)]['id'],_0x540bc0=await purchases_finished[_0x168821(0xae)]({'_id':_0x458689[_0x168821(0xca)]['id']}),_0x159a74=await warehouse[_0x168821(0xae)]({'name':_0x540bc0[_0x168821(0xe7)],'room':_0x540bc0[_0x168821(0xb1)]});_0x540bc0[_0x168821(0x93)][_0x168821(0x16f)](_0x4fa89e=>{var _0x56d4b7=_0x168821;const _0x4247f6=_0x159a74[_0x56d4b7(0xb6)][_0x56d4b7(0x11d)](_0x514397=>{var _0x53a5e1=_0x56d4b7;_0x514397['product_name']==_0x4fa89e[_0x53a5e1(0x8f)]&&_0x514397['bay']==_0x4fa89e[_0x53a5e1(0x147)]&&(_0x514397[_0x53a5e1(0x11e)]=parseInt(_0x514397[_0x53a5e1(0x11e)])-parseInt(_0x4fa89e[_0x53a5e1(0x172)]));});}),await _0x159a74[_0x168821(0xa2)]();const {invoice:_0x3e2597,suppliers:_0x77b84f,date:_0x33ecd3,warehouse_name:_0x3122ed,prod_name:_0x1c7373,prod_code:_0x14a0f9,prod_qty:_0x4c09bf,prod_unit:_0x531212,prod_secondunit:_0x378593,prod_level:_0x1b0773,prod_isle:_0x3fa371,prod_pallet:_0x41fd19,note:_0x1274da,expiry_date:_0x4f559f,batch_code:_0x3cf327,paid_amount:_0x1e0547,due_amount:_0x26294f,Room_name:_0xe6e2ca,primary_code:_0x3b5cfa,secondary_code:_0x42b062,PO_number:_0xcc5aa0,JO_number:_0x31c4ad}=_0x458689['body'];if(typeof _0x1c7373==_0x168821(0x9f))var _0x57f42e=[_0x458689['body']['prod_name']],_0x335f75=[_0x458689['body']['prod_code']],_0x146719=[_0x458689[_0x168821(0xf2)][_0x168821(0xf8)]],_0x59ec9f=[_0x458689[_0x168821(0xf2)][_0x168821(0xef)]],_0x46ae62=[_0x458689[_0x168821(0xf2)]['prod_secondunit']],_0x26d8e8=[_0x458689[_0x168821(0xf2)]['prod_level']],_0x1bf74d=[_0x458689['body'][_0x168821(0x117)]],_0x2a2524=[_0x458689[_0x168821(0xf2)][_0x168821(0x138)]],_0x32ab5a=[_0x458689[_0x168821(0xf2)][_0x168821(0xba)]],_0x4c8a7c=[_0x458689['body'][_0x168821(0xfd)]],_0x1dd63d=[_0x458689[_0x168821(0xf2)]['expiry_date']];else var _0x57f42e=[..._0x458689[_0x168821(0xf2)][_0x168821(0x130)]],_0x335f75=[..._0x458689['body'][_0x168821(0xce)]],_0x146719=[..._0x458689[_0x168821(0xf2)][_0x168821(0xf8)]],_0x59ec9f=[..._0x458689[_0x168821(0xf2)]['prod_unit']],_0x46ae62=[..._0x458689[_0x168821(0xf2)][_0x168821(0x97)]],_0x26d8e8=[..._0x458689[_0x168821(0xf2)][_0x168821(0xd9)]],_0x1bf74d=[..._0x458689['body']['primary_code']],_0x2a2524=[..._0x458689['body'][_0x168821(0x138)]],_0x32ab5a=[..._0x458689[_0x168821(0xf2)][_0x168821(0xba)]],_0x4c8a7c=[..._0x458689[_0x168821(0xf2)][_0x168821(0xfd)]],_0x1dd63d=[..._0x458689[_0x168821(0xf2)][_0x168821(0xa7)]];const _0x5d9c36=_0x57f42e[_0x168821(0x11d)](_0x1d6e3b=>{return _0x1d6e3b={'product_name':_0x1d6e3b};});_0x335f75[_0x168821(0x16f)]((_0x23f75c,_0x289d7a)=>{var _0x3c6c36=_0x168821;_0x5d9c36[_0x289d7a][_0x3c6c36(0x160)]=_0x23f75c;}),_0x146719[_0x168821(0x16f)]((_0x52ea22,_0x5a847b)=>{var _0x5af58b=_0x168821;_0x5d9c36[_0x5a847b][_0x5af58b(0x172)]=_0x52ea22;}),_0x59ec9f[_0x168821(0x16f)]((_0x135da3,_0x5c30ac)=>{var _0x302c33=_0x168821;_0x5d9c36[_0x5c30ac][_0x302c33(0xe0)]=_0x135da3;}),_0x46ae62['forEach']((_0x22d7af,_0x23384b)=>{var _0x24cb9c=_0x168821;_0x5d9c36[_0x23384b][_0x24cb9c(0x175)]=_0x22d7af;}),_0x26d8e8[_0x168821(0x16f)]((_0xbc8e1a,_0x48b031)=>{_0x5d9c36[_0x48b031]['bay']=_0xbc8e1a;}),_0x1bf74d[_0x168821(0x16f)]((_0x321e02,_0x367cc2)=>{_0x5d9c36[_0x367cc2]['primary_code']=_0x321e02;}),_0x2a2524[_0x168821(0x16f)]((_0x2370c6,_0x53065d)=>{_0x5d9c36[_0x53065d]['secondary_code']=_0x2370c6;}),_0x32ab5a[_0x168821(0x16f)]((_0x365aaa,_0x11a49d)=>{_0x5d9c36[_0x11a49d]['maxStocks']=_0x365aaa;}),_0x4c8a7c['forEach']((_0xbb8bf4,_0x448f2b)=>{var _0x4e59b6=_0x168821;_0x5d9c36[_0x448f2b][_0x4e59b6(0xfd)]=_0xbb8bf4;}),_0x1dd63d[_0x168821(0x16f)]((_0x229ee8,_0xf80a08)=>{var _0x24117b=_0x168821;_0x5d9c36[_0xf80a08][_0x24117b(0xa7)]=_0x229ee8;});const _0x1752d2=_0x5d9c36[_0x168821(0xec)](_0x141f77=>_0x141f77[_0x168821(0x172)]!=='0'&&_0x141f77['quantity']!=='');_0x540bc0[_0x168821(0x10b)]=_0x3e2597,_0x540bc0['suppliers']=_0x77b84f,_0x540bc0[_0x168821(0x118)]=_0x33ecd3,_0x540bc0['warehouse_name']=_0x3122ed,_0x540bc0[_0x168821(0x93)]=_0x1752d2,_0x540bc0['note']=_0x1274da,_0x540bc0[_0x168821(0xd0)]=_0x1e0547,_0x540bc0['due_amount']=_0x26294f,_0x540bc0[_0x168821(0xb1)]=_0xe6e2ca,_0x540bc0[_0x168821(0x11a)]=_0xcc5aa0,_0x540bc0[_0x168821(0x13b)]=_0x31c4ad;const _0x4dfaac=await _0x540bc0[_0x168821(0xa2)](),_0x3f0a7b=await warehouse[_0x168821(0xae)]({'name':_0x458689[_0x168821(0xf2)][_0x168821(0xe7)],'room':_0x458689[_0x168821(0xf2)]['Room_name']});_0x540bc0[_0x168821(0x93)]['forEach'](_0x3f3f29=>{var _0xd61da9=_0x168821,_0x14eec3=0x0;const _0xe1c034=_0x3f0a7b[_0xd61da9(0xb6)]['map'](_0x4d0601=>{var _0x45e152=_0xd61da9;_0x4d0601[_0x45e152(0x8f)]==_0x3f3f29[_0x45e152(0x8f)]&&_0x4d0601[_0x45e152(0x147)]==_0x3f3f29[_0x45e152(0x147)]&&(_0x4d0601['product_stock']=parseInt(_0x4d0601[_0x45e152(0x11e)])+parseInt(_0x3f3f29['quantity']),_0x14eec3++);});_0x14eec3=='0'&&(_0x3f0a7b[_0xd61da9(0xb6)]=_0x3f0a7b['product_details']['concat']({'product_name':_0x3f3f29[_0xd61da9(0x8f)],'product_stock':_0x3f3f29['quantity'],'primary_code':_0x3f3f29[_0xd61da9(0x117)],'secondary_code':_0x3f3f29[_0xd61da9(0x138)],'product_code':_0x3f3f29['product_code'],'bay':_0x3f3f29[_0xd61da9(0x147)],'maxProducts':_0x3f3f29[_0xd61da9(0x16c)],'unit':_0x3f3f29[_0xd61da9(0xe0)],'secondary_unit':_0x3f3f29['secondary_unit'],'expiry_date':_0x3f3f29[_0xd61da9(0xa7)]}));}),await _0x3f0a7b[_0x168821(0xa2)]();const _0x1e7606=await s_payment_data[_0x168821(0xae)]({'invoice':_0x458689[_0x168821(0xf2)][_0x168821(0x10b)]});if(_0x1e7606===null){}else console[_0x168821(0x113)](_0x168821(0xde),_0x1e7606,_0x458689[_0x168821(0xf2)]['invoice']),_0x1e7606[_0x168821(0xde)]=_0x458689[_0x168821(0xf2)][_0x168821(0xde)],await _0x1e7606['save']();_0x458689[_0x168821(0x11c)](_0x168821(0x173),_0x168821(0x146)),_0xbb21c2['redirect'](_0x168821(0xa5));}catch(_0x3a7481){console[_0x168821(0x113)](_0x3a7481);}}),router[a0_0x300711(0xf0)](a0_0x300711(0x15d),auth,async(_0x18e30f,_0x2764d4)=>{var _0x5d26a8=a0_0x300711;try{const _0xbbf207=_0x18e30f['params']['id'],{invoice:_0x4007a4,suppliers:_0x5175ca,payable:_0x3708f8,due_amount:_0x530b8e}=_0x18e30f[_0x5d26a8(0xf2)],_0x31f90a=await purchases[_0x5d26a8(0x13a)](_0xbbf207);var _0x3de86a=_0x3708f8-_0x530b8e;_0x31f90a['paid_amount']=parseFloat(_0x31f90a[_0x5d26a8(0xd0)])+parseFloat(_0x530b8e),_0x31f90a[_0x5d26a8(0x170)]=_0x3de86a;const _0x5e635d=await _0x31f90a[_0x5d26a8(0xa2)]();console[_0x5d26a8(0x113)](_0x5e635d);const _0x1f264e=await s_payment_data[_0x5d26a8(0xae)]({'invoice':_0x4007a4});_0x1f264e[_0x5d26a8(0x154)]=_0x3de86a,await _0x1f264e[_0x5d26a8(0xa2)]();let _0x3420c0=new Date(),_0x26b4ea=('0'+_0x3420c0[_0x5d26a8(0xc9)]())['slice'](-0x2),_0x2c8a44=('0'+(_0x3420c0[_0x5d26a8(0xa4)]()+0x1))['slice'](-0x2),_0x1d87b2=_0x3420c0['getFullYear'](),_0x4f7704=_0x1d87b2+'-'+_0x2c8a44+'-'+_0x26b4ea;const _0x46ffeb=new suppliers_payment({'invoice':_0x4007a4,'date':_0x1d87b2+'-'+_0x2c8a44+'-'+_0x26b4ea,'suppliers':_0x5175ca,'reason':_0x5d26a8(0x112),'amount':_0x530b8e}),_0x1c4915=await _0x46ffeb[_0x5d26a8(0xa2)]();_0x18e30f[_0x5d26a8(0x11c)]('success','payment\x20successfull'),_0x2764d4[_0x5d26a8(0xe8)]('/all_purchases/view');}catch(_0x3cc061){console['log'](_0x3cc061);}}),router[a0_0x300711(0xb4)]('/invoice/:id',auth,async(_0x1be2e5,_0x427d57)=>{var _0x503f52=a0_0x300711;try{const {username:_0xabba20,email:_0x5c8c74,role:_0x23282a}=_0x1be2e5[_0x503f52(0xf9)],_0x332bdc=_0x1be2e5[_0x503f52(0xf9)],_0x23925a=await profile[_0x503f52(0xae)]({'email':_0x332bdc[_0x503f52(0xfc)]}),_0x463576=await master_shop[_0x503f52(0xc6)]();console['log'](_0x503f52(0x15e),_0x463576);const _0x4dfe90=_0x1be2e5['params']['id'],_0x2299fc=await purchases[_0x503f52(0x13a)](_0x4dfe90);console[_0x503f52(0x113)](_0x2299fc);const _0x4e3b9a=await suppliers[_0x503f52(0xae)]({'name':_0x2299fc[_0x503f52(0xde)]});console[_0x503f52(0x113)](_0x4e3b9a);if(_0x463576[0x0][_0x503f52(0x101)]==_0x503f52(0x9e)){var _0x244048=users[_0x503f52(0x116)];console[_0x503f52(0x113)](_0x244048);}else{if(_0x463576[0x0][_0x503f52(0x101)]==_0x503f52(0x13f))var _0x244048=users['Hindi'];else{if(_0x463576[0x0][_0x503f52(0x101)]==_0x503f52(0x128))var _0x244048=users[_0x503f52(0x128)];else{if(_0x463576[0x0][_0x503f52(0x101)]=='Spanish')var _0x244048=users[_0x503f52(0x13c)];else{if(_0x463576[0x0][_0x503f52(0x101)]==_0x503f52(0xc0))var _0x244048=users['French'];else{if(_0x463576[0x0][_0x503f52(0x101)]==_0x503f52(0xbd))var _0x244048=users[_0x503f52(0x157)];else{if(_0x463576[0x0][_0x503f52(0x101)]==_0x503f52(0xf7))var _0x244048=users['Chinese'];else{if(_0x463576[0x0][_0x503f52(0x101)]=='Arabic\x20(ae)')var _0x244048=users['Arabic'];}}}}}}}_0x427d57[_0x503f52(0xed)](_0x503f52(0x114),{'success':_0x1be2e5[_0x503f52(0x11c)](_0x503f52(0x173)),'errors':_0x1be2e5[_0x503f52(0x11c)]('errors'),'role':_0x332bdc,'profile':_0x23925a,'master_shop':_0x463576,'supplier':_0x4e3b9a,'purchase':_0x2299fc,'language':_0x244048});}catch(_0x4fcafa){console[_0x503f52(0x113)](_0x4fcafa);}}),router[a0_0x300711(0xb4)](a0_0x300711(0x7e),auth,async(_0x5f520f,_0x368213)=>{var _0x25cc2b=a0_0x300711;try{const {username:_0x3a66cd,email:_0x44897d,role:_0x14bf24}=_0x5f520f[_0x25cc2b(0xf9)],_0x40b7b2=_0x5f520f[_0x25cc2b(0xf9)],_0x1bda65=await profile[_0x25cc2b(0xae)]({'email':_0x40b7b2['email']}),_0x16fbce=await master_shop[_0x25cc2b(0xc6)]();console[_0x25cc2b(0x113)](_0x25cc2b(0x15e),_0x16fbce);const _0x48553b=_0x5f520f[_0x25cc2b(0xca)]['id'];console['log'](_0x48553b);const _0x1799da=await purchases_finished['findById'](_0x48553b);console[_0x25cc2b(0x113)](_0x25cc2b(0x12f),_0x1799da);const _0x20d58c=await product[_0x25cc2b(0xc6)]({}),_0x478ea8=await warehouse[_0x25cc2b(0xe5)]([{'$match':{'name':_0x1799da[_0x25cc2b(0xe7)],'room':_0x1799da[_0x25cc2b(0xb1)]}},{'$unwind':_0x25cc2b(0xd2)},{'$group':{'_id':_0x25cc2b(0xb8),'name':{'$first':_0x25cc2b(0x11b)},'product_stock':{'$first':_0x25cc2b(0x13d)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x25cc2b(0x8a)},'type':{'$first':_0x25cc2b(0x15f)},'floorlevel':{'$first':_0x25cc2b(0x111)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x25cc2b(0xf6)},'product_code':{'$first':_0x25cc2b(0x14c)},'storage':{'$first':_0x25cc2b(0x100)},'rack':{'$first':_0x25cc2b(0xe2)}}}]);console[_0x25cc2b(0x113)](_0x25cc2b(0xe9),_0x478ea8);let _0x39b754;if(_0x40b7b2[_0x25cc2b(0x131)]==_0x25cc2b(0xf4)){const _0x24d3f4=await staff[_0x25cc2b(0xae)]({'email':_0x40b7b2[_0x25cc2b(0xfc)]});_0x39b754=await warehouse['find']({'status':_0x25cc2b(0xea),'name':_0x24d3f4[_0x25cc2b(0xc8)],'warehouse_category':'Finished\x20Goods','name':'Return\x20Goods'});}else _0x39b754=await warehouse[_0x25cc2b(0xe5)]([{'$match':{'status':'Enabled','warehouse_category':_0x25cc2b(0x174),'name':'Return\x20Goods'}},{'$group':{'_id':_0x25cc2b(0x16e),'name':{'$first':'$name'}}}]);if(_0x16fbce[0x0][_0x25cc2b(0x101)]==_0x25cc2b(0x9e)){var _0x27a47d=users['English'];console[_0x25cc2b(0x113)](_0x27a47d);}else{if(_0x16fbce[0x0]['language']=='Hindi')var _0x27a47d=users[_0x25cc2b(0x13f)];else{if(_0x16fbce[0x0][_0x25cc2b(0x101)]==_0x25cc2b(0x128))var _0x27a47d=users[_0x25cc2b(0x128)];else{if(_0x16fbce[0x0]['language']==_0x25cc2b(0x13c))var _0x27a47d=users[_0x25cc2b(0x13c)];else{if(_0x16fbce[0x0][_0x25cc2b(0x101)]=='French')var _0x27a47d=users[_0x25cc2b(0xc0)];else{if(_0x16fbce[0x0][_0x25cc2b(0x101)]==_0x25cc2b(0xbd))var _0x27a47d=users[_0x25cc2b(0x157)];else{if(_0x16fbce[0x0]['language']==_0x25cc2b(0xf7))var _0x27a47d=users[_0x25cc2b(0xf7)];else{if(_0x16fbce[0x0]['language']==_0x25cc2b(0xa6))var _0x27a47d=users['Arabic'];}}}}}}}_0x368213[_0x25cc2b(0xed)](_0x25cc2b(0x159),{'success':_0x5f520f['flash'](_0x25cc2b(0x173)),'errors':_0x5f520f[_0x25cc2b(0x11c)](_0x25cc2b(0x8c)),'role':_0x40b7b2,'profile':_0x1bda65,'user':_0x1799da,'stock':_0x478ea8,'master_shop':_0x16fbce,'product':_0x20d58c,'language':_0x27a47d,'warehouse':_0x39b754});}catch(_0x2ff3e0){console[_0x25cc2b(0x113)](_0x2ff3e0);}}),router[a0_0x300711(0xf0)]('/view/return_purchase/:id',auth,async(_0x3c2295,_0x450ab7)=>{var _0x3d0fe7=a0_0x300711;try{const {invoice:_0x14a1eb,date:_0x216970,warehouse_name:_0x437543,Room_name:_0x158aab,product_name:_0x20486e,purchase_quantity:_0x2f4e12,stocks:_0x38526c,return_qty:_0x4ea3c7,note:_0x1800e4,level:_0x5c3494,isle:_0x40a1c9,pallet:_0x5d5046,to_warehouse_name:_0x8fbade,to_Room_name:_0x4f2ad6}=_0x3c2295[_0x3d0fe7(0xf2)],_0x20d29d=await purchases_finished['findOne']({'_id':_0x3c2295[_0x3d0fe7(0xca)]['id']}),_0x5b2d72=await warehouse[_0x3d0fe7(0xae)]({'name':_0x437543,'room':_0x158aab,'warehouse_category':_0x3d0fe7(0x174)});if(typeof _0x20486e==_0x3d0fe7(0x9f))var _0x4797e1=[_0x3c2295[_0x3d0fe7(0xf2)][_0x3d0fe7(0x8f)]],_0x12a30f=[_0x3c2295[_0x3d0fe7(0xf2)][_0x3d0fe7(0x87)]],_0x2a4b8d=[_0x3c2295['body']['stocks']],_0x241364=[_0x3c2295[_0x3d0fe7(0xf2)]['return_qty']],_0x4efab1=[_0x3c2295['body'][_0x3d0fe7(0x104)]],_0xf565ba=[_0x3c2295['body']['product_code_hide']],_0x2b09c8=[_0x3c2295[_0x3d0fe7(0xf2)][_0x3d0fe7(0xaa)]],_0x414bb3=[_0x3c2295['body'][_0x3d0fe7(0x16a)]];else var _0x4797e1=[..._0x3c2295[_0x3d0fe7(0xf2)]['product_name']],_0x12a30f=[..._0x3c2295[_0x3d0fe7(0xf2)][_0x3d0fe7(0x87)]],_0x2a4b8d=[..._0x3c2295['body']['stocks']],_0x241364=[..._0x3c2295[_0x3d0fe7(0xf2)][_0x3d0fe7(0xb2)]],_0x4efab1=[..._0x3c2295['body'][_0x3d0fe7(0x104)]],_0xf565ba=[..._0x3c2295[_0x3d0fe7(0xf2)]['product_code_hide']],_0x2b09c8=[..._0x3c2295['body'][_0x3d0fe7(0xaa)]],_0x414bb3=[..._0x3c2295[_0x3d0fe7(0xf2)][_0x3d0fe7(0x16a)]];const _0x3b34e9=_0x4797e1[_0x3d0fe7(0x11d)](_0x4748ef=>{return _0x4748ef={'product_name':_0x4748ef};});_0x12a30f['forEach']((_0xdb0a93,_0x766534)=>{var _0x68cd55=_0x3d0fe7;_0x3b34e9[_0x766534][_0x68cd55(0x87)]=_0xdb0a93;}),_0x2a4b8d[_0x3d0fe7(0x16f)]((_0x48ba1e,_0x3b75ed)=>{var _0x36410b=_0x3d0fe7;_0x3b34e9[_0x3b75ed][_0x36410b(0x156)]=_0x48ba1e;}),_0x241364[_0x3d0fe7(0x16f)]((_0x374cc9,_0xb9db5c)=>{_0x3b34e9[_0xb9db5c]['return_qty']=_0x374cc9;}),_0x4efab1['forEach']((_0x47a57e,_0x30d0fc)=>{_0x3b34e9[_0x30d0fc]['bay']=_0x47a57e;}),_0xf565ba[_0x3d0fe7(0x16f)]((_0x31c027,_0x5560d2)=>{_0x3b34e9[_0x5560d2]['product_code']=_0x31c027;}),_0x2b09c8['forEach']((_0x37dd85,_0x5c6ede)=>{_0x3b34e9[_0x5c6ede]['primary_code']=_0x37dd85;}),_0x414bb3['forEach']((_0x4f6426,_0x4f17a8)=>{var _0x27ebe3=_0x3d0fe7;_0x3b34e9[_0x4f17a8][_0x27ebe3(0x138)]=_0x4f6426;}),_0x3b34e9[_0x3d0fe7(0x16f)](_0x20ec11=>{var _0x3c6580=_0x3d0fe7;console[_0x3c6580(0x113)](_0x20ec11);const _0x6b1402=_0x5b2d72[_0x3c6580(0xb6)][_0x3c6580(0x11d)](_0x396dc1=>{var _0xf3d1ae=_0x3c6580;_0x396dc1[_0xf3d1ae(0x8f)]==_0x20ec11[_0xf3d1ae(0x8f)]&&_0x396dc1[_0xf3d1ae(0x147)]==_0x20ec11[_0xf3d1ae(0x147)]&&(console[_0xf3d1ae(0x113)](parseInt(_0x396dc1[_0xf3d1ae(0x11e)])+'\x20<>\x20'+parseInt(_0x20ec11[_0xf3d1ae(0xb2)])),_0x396dc1['product_stock']=parseInt(_0x396dc1['product_stock'])-parseInt(_0x20ec11['return_qty']));});}),await _0x5b2d72[_0x3d0fe7(0xa2)]();var _0x594936=0x0;_0x3b34e9['forEach'](_0x3cc778=>{var _0x2e5bf9=_0x3d0fe7;(parseInt(_0x3cc778['purchase_quantity'])<parseInt(_0x3cc778[_0x2e5bf9(0xb2)])||parseInt(_0x3cc778[_0x2e5bf9(0x156)])<parseInt(_0x3cc778[_0x2e5bf9(0xb2)]))&&_0x594936++;});if(_0x594936!=0x0)return _0x3c2295['flash']('errors',_0x3d0fe7(0xfa)),_0x450ab7['redirect']('back');const _0xd58308=new purchases_return_finished({'invoice':_0x14a1eb,'suppliers':_0x3c2295[_0x3d0fe7(0xf2)][_0x3d0fe7(0xde)],'date':_0x216970,'warehouse_name':_0x437543,'return_product':_0x3b34e9,'note':_0x1800e4,'room':_0x158aab,'to_warehouse_name':_0x8fbade,'to_room':_0x4f2ad6}),_0xc5b2d3=await _0xd58308[_0x3d0fe7(0xa2)](),_0x5ba451=await purchases_return_finished[_0x3d0fe7(0xae)]({'invoice':_0x14a1eb}),_0xa0ad2a=await warehouse[_0x3d0fe7(0xae)]({'name':_0x8fbade,'room':_0x4f2ad6,'warehouse_category':_0x3d0fe7(0x174)});_0x5ba451[_0x3d0fe7(0xe3)]['forEach'](_0x5e47f5=>{var _0x3912b7=_0x3d0fe7,_0x2979d3=0x0;const _0x55f602=_0xa0ad2a[_0x3912b7(0xb6)][_0x3912b7(0x11d)](_0x555a73=>{var _0x214a77=_0x3912b7;console[_0x214a77(0x113)](_0x555a73[_0x214a77(0x8f)]+'=='+_0x5e47f5['product_name']+'&&'+_0x555a73[_0x214a77(0x147)]+'=='+_0x5e47f5[_0x214a77(0x147)]),_0x555a73['product_name']==_0x5e47f5[_0x214a77(0x8f)]&&_0x555a73[_0x214a77(0x147)]==_0x5e47f5[_0x214a77(0x147)]&&(_0x555a73[_0x214a77(0x11e)]=parseInt(_0x555a73[_0x214a77(0x11e)])-parseInt(_0x5e47f5['return_qty']),_0x2979d3++);});_0x2979d3=='0'&&(_0xa0ad2a[_0x3912b7(0xb6)]=_0xa0ad2a[_0x3912b7(0xb6)][_0x3912b7(0xdb)]({'product_name':_0x5e47f5[_0x3912b7(0x8f)],'product_stock':_0x5e47f5['return_qty'],'primary_code':_0x5e47f5['primary_code'],'secondary_code':_0x5e47f5[_0x3912b7(0x138)],'product_code':_0x5e47f5[_0x3912b7(0x160)],'bay':_0x5e47f5['bay'],'maxProducts':0xf423f}));}),await _0xa0ad2a[_0x3d0fe7(0xa2)]();const _0x180db3=await purchases_finished[_0x3d0fe7(0xae)]({'invoice':_0x14a1eb});_0x180db3[_0x3d0fe7(0x81)]=_0x3d0fe7(0xf3);const _0x3ce7c9=await _0x180db3[_0x3d0fe7(0xa2)](),_0x586372=new s_payment_data({'invoice':_0x14a1eb,'suppliers':_0x3c2295['body'][_0x3d0fe7(0xde)],'reason':_0x3d0fe7(0x167)});await _0x586372[_0x3d0fe7(0xa2)]();const _0x2664ff=await master_shop[_0x3d0fe7(0xc6)](),_0x2ab4c0=await email_settings[_0x3d0fe7(0xae)](),_0x1eae25=await suppliers[_0x3d0fe7(0xae)]({'name':_0x3c2295[_0x3d0fe7(0xf2)][_0x3d0fe7(0xde)]});_0x2664ff[0x0]['currency_placement']==0x1?(right_currency=_0x2664ff[0x0][_0x3d0fe7(0x7d)],left_currency=''):(right_currency='',left_currency=_0x2664ff[0x0]['currency']);var _0x17b47a=_0x4797e1,_0x135323=_0x241364,_0x1f7280='',_0x6e9693;for(_0x6e9693 in _0x17b47a){_0x1f7280+=_0x3d0fe7(0x95)+_0x3d0fe7(0x10d)+_0x17b47a[_0x6e9693]+_0x3d0fe7(0x89)+_0x3d0fe7(0x10d)+_0x135323[_0x6e9693]+'</td>'+_0x3d0fe7(0x12b);}let _0x3dd8f8=nodemailer[_0x3d0fe7(0x8e)]({'service':'gmail','auth':{'user':_0x2ab4c0[_0x3d0fe7(0xfc)],'pass':_0x2ab4c0[_0x3d0fe7(0x120)]}}),_0x271cd1={'from':_0x2ab4c0[_0x3d0fe7(0xfc)],'to':_0x1eae25['email'],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x3d0fe7(0xdf)+'/upload/'+_0x2664ff[0x0]['image'],'cid':_0x3d0fe7(0xda)}],'html':_0x3d0fe7(0x11f)+'<html><head><title></title>'+_0x3d0fe7(0xc7)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3d0fe7(0x110)+_0x3d0fe7(0x83)+_0x3d0fe7(0xa9)+'<div>'+_0x3d0fe7(0x168)+_0x2664ff[0x0][_0x3d0fe7(0x145)]+_0x3d0fe7(0xe1)+_0x3d0fe7(0xa9)+_0x3d0fe7(0xa9)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x3d0fe7(0x106)+'\x20Order\x20Number\x20:\x20'+_0x14a1eb+'\x20'+_0x3d0fe7(0x84)+_0x3d0fe7(0x12c)+_0x216970+'\x20'+_0x3d0fe7(0x86)+'</h5>'+_0x3d0fe7(0xa9)+_0x3d0fe7(0xdc)+_0x3d0fe7(0x78)+_0x3d0fe7(0x95)+_0x3d0fe7(0xb5)+_0x3d0fe7(0x92)+_0x3d0fe7(0xa1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x3d0fe7(0x153)+_0x3d0fe7(0xfb)+'\x20'+_0x1f7280+'\x20'+_0x3d0fe7(0xcd)+_0x3d0fe7(0x9a)+_0x3d0fe7(0x110)+_0x3d0fe7(0x115)+_0x3d0fe7(0xc5)+_0x2664ff[0x0][_0x3d0fe7(0x145)]+_0x3d0fe7(0x166)+_0x3d0fe7(0xa9)+'</div>'+'</body></html>'};_0x3dd8f8[_0x3d0fe7(0x91)](_0x271cd1,function(_0x185116,_0x1255e6){var _0x3ed035=_0x3d0fe7;_0x185116?console[_0x3ed035(0x113)](_0x3ed035(0x133)):console[_0x3ed035(0x113)](_0x3ed035(0x99));}),_0x3c2295['flash'](_0x3d0fe7(0x173),'purchases\x20item\x20return\x20successfull'),_0x450ab7[_0x3d0fe7(0xe8)]('/all_purchases_finished/view');}catch(_0x1b49bc){_0x450ab7[_0x3d0fe7(0x121)](0xc8)[_0x3d0fe7(0x7b)]({'message':_0x1b49bc[_0x3d0fe7(0x152)]});}}),router[a0_0x300711(0xb4)](a0_0x300711(0xc3),auth,async(_0xd9566b,_0x447db3)=>{var _0x18ed7e=a0_0x300711;try{const {username:_0x4d7c5e,email:_0x42766f,role:_0x147d80}=_0xd9566b['user'],_0x3bbca3=_0xd9566b[_0x18ed7e(0xf9)],_0x4bf769=await profile[_0x18ed7e(0xae)]({'email':_0x3bbca3[_0x18ed7e(0xfc)]}),_0x4d03cb=await master_shop[_0x18ed7e(0xc6)](),_0xd7ae57=_0xd9566b[_0x18ed7e(0xca)]['id'],_0x51b90a=await purchases_finished[_0x18ed7e(0x13a)](_0xd7ae57);if(_0x4d03cb[0x0][_0x18ed7e(0x101)]==_0x18ed7e(0x9e))var _0x2a3586=users['English'];else{if(_0x4d03cb[0x0][_0x18ed7e(0x101)]==_0x18ed7e(0x13f))var _0x2a3586=users['Hindi'];else{if(_0x4d03cb[0x0][_0x18ed7e(0x101)]==_0x18ed7e(0x128))var _0x2a3586=users[_0x18ed7e(0x128)];else{if(_0x4d03cb[0x0][_0x18ed7e(0x101)]=='Spanish')var _0x2a3586=users[_0x18ed7e(0x13c)];else{if(_0x4d03cb[0x0][_0x18ed7e(0x101)]==_0x18ed7e(0xc0))var _0x2a3586=users['French'];else{if(_0x4d03cb[0x0][_0x18ed7e(0x101)]==_0x18ed7e(0xbd))var _0x2a3586=users[_0x18ed7e(0x157)];else{if(_0x4d03cb[0x0][_0x18ed7e(0x101)]==_0x18ed7e(0xf7))var _0x2a3586=users['Chinese'];else{if(_0x4d03cb[0x0][_0x18ed7e(0x101)]==_0x18ed7e(0xa6))var _0x2a3586=users[_0x18ed7e(0x132)];}}}}}}}_0x447db3[_0x18ed7e(0xed)](_0x18ed7e(0x12a),{'success':_0xd9566b[_0x18ed7e(0x11c)](_0x18ed7e(0x173)),'errors':_0xd9566b['flash'](_0x18ed7e(0x8c)),'role':_0x3bbca3,'profile':_0x4bf769,'alldata':_0x51b90a,'master_shop':_0x4d03cb,'language':_0x2a3586}),console['log'](alldata);}catch(_0x5498d0){console['log'](_0x5498d0);}}),router[a0_0x300711(0xf0)](a0_0x300711(0x9d),async(_0x68b568,_0x583012)=>{var _0x58357f=a0_0x300711;const {product_code:_0x5401d9}=_0x68b568[_0x58357f(0xf2)];var _0x33791a;const _0x5310e8=await product[_0x58357f(0xe5)]([{'$match':{'primary_code':_0x5401d9,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x58357f(0xfe),'name':{'$first':_0x58357f(0x16e)},'category':{'$first':'$category'},'brand':{'$first':_0x58357f(0x177)},'unit':{'$first':_0x58357f(0x13e)},'alertquantity':{'$first':_0x58357f(0x109)},'product_code':{'$first':_0x58357f(0xbe)},'primary_code':{'$first':_0x58357f(0x107)},'secondary_code':{'$first':_0x58357f(0xee)},'maxStocks':{'$first':_0x58357f(0x94)},'maxProdPerUnit':{'$first':_0x58357f(0x165)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x37589a=await product[_0x58357f(0xe5)]([{'$match':{'secondary_code':_0x5401d9}},{'$group':{'_id':'$_id','name':{'$first':_0x58357f(0x16e)},'category':{'$first':'$category'},'brand':{'$first':_0x58357f(0x177)},'unit':{'$first':_0x58357f(0x13e)},'alertquantity':{'$first':_0x58357f(0x109)},'product_code':{'$first':_0x58357f(0xbe)},'primary_code':{'$first':_0x58357f(0x107)},'secondary_code':{'$first':_0x58357f(0xee)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x58357f(0x7a)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5310e8['length']>0x0)_0x33791a=_0x5310e8;else _0x37589a[_0x58357f(0x171)]>0x0&&(_0x33791a=_0x37589a);_0x583012[_0x58357f(0x7b)](_0x33791a);}),router[a0_0x300711(0xf0)](a0_0x300711(0xe6),async(_0x47ff66,_0x1bb600)=>{var _0x57052d=a0_0x300711;const {productCode:_0x16e31c,bay:_0x5d3cc0,warehouses:_0x229be2,room:_0x3adce2}=_0x47ff66[_0x57052d(0xf2)];console[_0x57052d(0x113)](_0x47ff66[_0x57052d(0xf2)]);try{const _0x5193e3=await warehouse[_0x57052d(0xe5)]([{'$match':{'name':_0x229be2,'room':_0x3adce2}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x5d3cc0)}},{'$group':{'_id':_0x57052d(0xb8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x57052d(0x13d)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x57052d(0xeb)}}}]);_0x1bb600[_0x57052d(0x121)](0xc8)['json'](_0x5193e3);}catch(_0x5920f1){_0x1bb600['status'](0x194)[_0x57052d(0x7b)]({'message':_0x5920f1[_0x57052d(0x152)]});}}),module[a0_0x300711(0x14d)]=router;