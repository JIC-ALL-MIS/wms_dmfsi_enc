var a0_0x4b7d49=a0_0x20c6;function a0_0x20c6(_0x31f825,_0x45439a){var _0x4c971c=a0_0x4c97();return a0_0x20c6=function(_0x20c6af,_0xaeae1a){_0x20c6af=_0x20c6af-0x19f;var _0x34cd44=_0x4c971c[_0x20c6af];return _0x34cd44;},a0_0x20c6(_0x31f825,_0x45439a);}(function(_0x5f1e4c,_0x3a397b){var _0x56dccc=a0_0x20c6,_0x165782=_0x5f1e4c();while(!![]){try{var _0xc8d3be=parseInt(_0x56dccc(0x282))/0x1*(-parseInt(_0x56dccc(0x226))/0x2)+parseInt(_0x56dccc(0x240))/0x3*(-parseInt(_0x56dccc(0x219))/0x4)+-parseInt(_0x56dccc(0x1ba))/0x5*(parseInt(_0x56dccc(0x25d))/0x6)+parseInt(_0x56dccc(0x235))/0x7+-parseInt(_0x56dccc(0x214))/0x8+parseInt(_0x56dccc(0x1fd))/0x9+parseInt(_0x56dccc(0x208))/0xa;if(_0xc8d3be===_0x3a397b)break;else _0x165782['push'](_0x165782['shift']());}catch(_0x226807){_0x165782['push'](_0x165782['shift']());}}}(a0_0x4c97,0x83f77));const express=require('express'),app=express(),router=express[a0_0x4b7d49(0x223)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x4b7d49(0x291)),auth=require(a0_0x4b7d49(0x1ed)),nodemailer=require(a0_0x4b7d49(0x212));var ejs=require(a0_0x4b7d49(0x22e));const path=require(a0_0x4b7d49(0x201)),users=require('../public/language/languages.json');router[a0_0x4b7d49(0x29b)](a0_0x4b7d49(0x1e4),auth,async(_0x349afd,_0x1b4c90)=>{var _0x22314c=a0_0x4b7d49;try{const {username:_0x21d6d1,email:_0x209050,role:_0x3e90bb}=_0x349afd[_0x22314c(0x266)],_0x1191b7=_0x349afd[_0x22314c(0x266)],_0x21fb6f=await profile[_0x22314c(0x1f4)]({'email':_0x1191b7['email']}),_0x296354=await staff[_0x22314c(0x1f4)]({'email':_0x1191b7['email']});if(_0x1191b7[_0x22314c(0x20c)]==_0x22314c(0x20b)){const _0x7f5b17=await staff[_0x22314c(0x1f4)]({'email':_0x1191b7['email']});}const _0x29b067=await master_shop[_0x22314c(0x1ad)]();let _0x3f6b97;if(_0x1191b7['role']==_0x22314c(0x20b)){const _0x5e23a9=await staff[_0x22314c(0x1f4)]({'email':_0x1191b7[_0x22314c(0x293)]});_0x3f6b97=await purchases_finished[_0x22314c(0x299)]([{'$match':{'warehouse_name':_0x5e23a9[_0x22314c(0x1a0)]}},{'$lookup':{'from':_0x22314c(0x258),'localField':_0x22314c(0x258),'foreignField':_0x22314c(0x1d7),'as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x22314c(0x27e)},{'$group':{'_id':_0x22314c(0x23b),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x22314c(0x232)},'date':{'$first':_0x22314c(0x234)},'warehouse_name':{'$first':_0x22314c(0x1ec)},'room':{'$first':'$room'},'product':{'$push':_0x22314c(0x27e)},'note':{'$first':_0x22314c(0x1a9)},'paid_amount':{'$first':_0x22314c(0x1e5)},'due_amount':{'$first':_0x22314c(0x22b)},'return_data':{'$first':_0x22314c(0x296)},'batch_code':{'$first':_0x22314c(0x284)},'expiry_date':{'$first':_0x22314c(0x28c)},'suppliers_docs':{'$first':_0x22314c(0x209)},'total_product_quantity':{'$sum':_0x22314c(0x1b9)},'level':{'$addToSet':_0x22314c(0x249)},'isle':{'$addToSet':_0x22314c(0x253)},'type':{'$addToSet':_0x22314c(0x1f8)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3f6b97=await purchases_finished['aggregate']([{'$unwind':_0x22314c(0x27e)},{'$group':{'_id':_0x22314c(0x23b),'invoice':{'$first':_0x22314c(0x257)},'suppliers':{'$first':_0x22314c(0x232)},'date':{'$first':_0x22314c(0x234)},'warehouse_name':{'$first':_0x22314c(0x1ec)},'room':{'$addToSet':_0x22314c(0x25c)},'product':{'$push':_0x22314c(0x27e)},'note':{'$first':_0x22314c(0x1a9)},'paid_amount':{'$first':_0x22314c(0x1e5)},'due_amount':{'$first':_0x22314c(0x22b)},'return_data':{'$first':_0x22314c(0x296)},'batch_code':{'$first':_0x22314c(0x284)},'expiry_date':{'$first':_0x22314c(0x28c)},'suppliers_docs':{'$first':_0x22314c(0x209)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x22314c(0x249)},'isle':{'$addToSet':_0x22314c(0x253)},'type':{'$addToSet':_0x22314c(0x1f8)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x29b067[0x0][_0x22314c(0x1a8)]=='English\x20(US)')var _0x52f7e3=users[_0x22314c(0x27c)];else{if(_0x29b067[0x0][_0x22314c(0x1a8)]==_0x22314c(0x244))var _0x52f7e3=users[_0x22314c(0x244)];else{if(_0x29b067[0x0][_0x22314c(0x1a8)]==_0x22314c(0x1c6))var _0x52f7e3=users[_0x22314c(0x1c6)];else{if(_0x29b067[0x0][_0x22314c(0x1a8)]=='Spanish')var _0x52f7e3=users[_0x22314c(0x1f1)];else{if(_0x29b067[0x0][_0x22314c(0x1a8)]=='French')var _0x52f7e3=users['French'];else{if(_0x29b067[0x0]['language']=='Portuguese\x20(BR)')var _0x52f7e3=users[_0x22314c(0x221)];else{if(_0x29b067[0x0][_0x22314c(0x1a8)]==_0x22314c(0x26f))var _0x52f7e3=users['Chinese'];else{if(_0x29b067[0x0][_0x22314c(0x1a8)]==_0x22314c(0x222))var _0x52f7e3=users[_0x22314c(0x200)];}}}}}}}_0x1b4c90['render'](_0x22314c(0x286),{'success':_0x349afd[_0x22314c(0x283)](_0x22314c(0x1dd)),'errors':_0x349afd[_0x22314c(0x283)](_0x22314c(0x206)),'purchases':_0x3f6b97,'role':_0x1191b7,'profile':_0x21fb6f,'master_shop':_0x29b067,'language':_0x52f7e3});}catch(_0x3a7b13){console[_0x22314c(0x236)](_0x22314c(0x265),_0x3a7b13),_0x1b4c90[_0x22314c(0x27b)](0xc8)[_0x22314c(0x19f)]({'message':_0x3a7b13[_0x22314c(0x1b2)]});}});function BayBinSelected(_0x12c39a,_0x43827c){var _0x48bf86=a0_0x4b7d49,_0x47bb8e=[],_0x3af896=[];if(_0x12c39a==_0x48bf86(0x281)){switch(_0x43827c){case'Rack\x201':_0x47bb8e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x48bf86(0x202):_0x47bb8e=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3af896=['DG'];}else{if(_0x12c39a==_0x48bf86(0x1e1)){switch(_0x43827c){case _0x48bf86(0x27f):_0x47bb8e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x47bb8e=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3af896=['FG'];}}return{'levels':_0x47bb8e,'identify':_0x3af896};}function a0_0x4c97(){var _0x2013f8=['warehouse','Email\x20sent\x20successfully','<h5>','INCF-','Purchase\x20Return\x20Mail','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','product_cat','language','$note','<span\x20style=\x22float:\x20right;\x22>','\x20<>\x20','stock_data','find','$name','product_stock','</td>','purchase\x20data\x20update\x20successfully','message','$maxProdPerUnit','port','secondary_unit','/barcode/:id','</div>','edit_purchases_finished','$product.quantity','165PMXrNO','FGSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','max_product_unit','getMonth','prod_cat','purchase\x20data\x20add\x20successfully','<html><head><title></title>','/view/return_purchase/:id','Purchase\x20Return','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','map','German','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$secondary_unit','params','purchase_quantity','back','French','$product_details.product_stock','There\x27s\x20a\x20error\x20in\x20this\x20transaction','product_name','add_purchases\x20error','render','stocks','floor','concat','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/../public','name','\x20</h2>','$product_details','bay','updateOne','logo','success','amount','return_qty','$alertquantity','FROZEN\x20GOODS','random','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/view','$paid_amount','</tr>','</tbody>','secondary_code','findById','prod_primunit','getFullYear','$warehouse_name','../middleware/auth','product_details','master','post','Spanish','/view/add_purchases/:id','prod_secondunit','findOne','maxStocks','image','primary_code','$product.type','product_date','<div>','\x20Order\x20Date\x20:\x20','site_title','3884229tdKXVQ','body','$product_details.product_code','Arabic','path','Rack\x202','batch_code','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','errors','date','20841620POWKyu','$suppliers_docs','</table>','staff','role','Portuguese\x20(BR)','<tr>','prod_name','edit_purchases_finished_view','</h5>','nodemailer','filter','8106264sLtxuN','secondary_code_hide','$product_code','MaxStocks_data','</head><body>','20fJmiXT','error','quantity','warehouse_name','/give_payment/:id','QA\x20Warehouse','</body></html>','<h2>\x20','Portuguese','Arabic\x20(ae)','Router','return_data','room','10JNQqXF','stock_quantity','Paid\x20For\x20Purchase','redirect','<!DOCTYPE\x20html>','$due_amount','Error\x20Occurs','/upload/','ejs','expiry_date','/view/:id','product_code_hide','$suppliers','paid_amount','$date','6011530hmQWdt','log','$product_details._id','createTransport','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$_id','$product_details.rack','host','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','398631dawHXN','JO_number','/all_purchases_finished/view','production_date','Hindi','Ambient','$product_details.maxProducts','length','primary_code_hide','$product.bay','$product_details.primary_code','$product_details.bin','RoomAssign','exports','$maxStocks','invoice','$product_details.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','room_name','$product.bin','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$brand','$invoice','suppliers','prod_unit','Enabled','standard_unit','$product.room_name','157830Pjxqng','slice','currency','product_code','product','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','currency_placement','table\x20page','user','$product_details.floorlevel','level','getDate','$secondary_code','$product_details.secondary_code','$category','</thead>','string','Chinese','/all_purchases/view','$unit','/view/add_purchases','prod_Qty','password','$product_details.type','prod_invoice','save','due_amount','</span>','add_purchases_finished','status','English','/barcode_scanner','$product','Rack\x201','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','DRY\x20GOODS','57653evNFfL','flash','$batch_code','<tbody\x20style=\x22text-align:\x20center;\x22>','all_purchases_finished','prod_code','return_purchase_finished','Logo.png','forEach','Purchase\x20Mail','$expiry_date','abs','note','POnumber','padStart','../models/all_models','English\x20(US)','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/CheckingWarehouse','$return_data','prod_level','sendMail','aggregate','purchase_invoice','get','prod_qty','then','purchases\x20item\x20return\x20successfull','<table\x20style=\x22width:\x20100%\x20!important;\x22>','json'];a0_0x4c97=function(){return _0x2013f8;};return a0_0x4c97();}async function getRandom8DigitNumber(){var _0x136048=a0_0x4b7d49;const _0x4738c6=0x989680,_0x27c3dc=0x5f5e0ff,_0x15c4c5=Math[_0x136048(0x1d3)](Math[_0x136048(0x1e2)]()*(_0x27c3dc-_0x4738c6+0x1))+_0x4738c6;var _0x50b0ed;const _0x4cfe40=await purchases_finished[_0x136048(0x1f4)]({'invoice':_0x136048(0x1a3)+_0x15c4c5});return _0x4cfe40&&_0x4cfe40['length']>0x0?_0x50b0ed='INCF-'+_0x15c4c5:_0x50b0ed=_0x136048(0x1a3)+_0x15c4c5,_0x50b0ed;}router[a0_0x4b7d49(0x29b)](a0_0x4b7d49(0x272),auth,async(_0x13a7f1,_0x3c9a76)=>{var _0x598f66=a0_0x4b7d49;try{const {username:_0x2445d4,email:_0x10c50f,role:_0x26c5dd}=_0x13a7f1['user'],_0x4752d7=_0x13a7f1[_0x598f66(0x266)],_0x2b9b7d=await profile['findOne']({'email':_0x4752d7['email']}),_0x5d0187=await master_shop[_0x598f66(0x1ad)](),_0x5760bc=await staff[_0x598f66(0x1f4)]({'email':_0x4752d7[_0x598f66(0x293)]}),_0x339a08=await suppliers['find']({});let _0x24f83e;if(_0x4752d7['role']==_0x598f66(0x20b)){const _0x4f5cdd=await staff[_0x598f66(0x1f4)]({'email':_0x4752d7[_0x598f66(0x293)]});_0x24f83e=await warehouse[_0x598f66(0x299)]([{'$match':{'status':_0x598f66(0x25a),'name':_0x4f5cdd[_0x598f66(0x1a0)],'warehouse_category':_0x598f66(0x204)}},{'$group':{'_id':_0x598f66(0x1ae),'name':{'$first':'$name'}}}]);}else _0x24f83e=await warehouse[_0x598f66(0x299)]([{'$match':{'status':_0x598f66(0x25a),'warehouse_category':_0x598f66(0x204),'name':{'$ne':_0x598f66(0x21e)}}},{'$group':{'_id':'$name','name':{'$first':_0x598f66(0x1ae)}}}]);const _0xc53b2=await product[_0x598f66(0x1ad)]({}),_0x334a36=await warehouse['find']({'status':_0x598f66(0x25a)}),_0x28d278=await purchases_finished[_0x598f66(0x1ad)]({}),_0x3ba00f=_0x28d278['length']+0x1,_0x3aecb0='INCF-'+_0x3ba00f['toString']()[_0x598f66(0x290)](0x5,'0');var _0x41e7c2=[_0x598f66(0x245),'Enclosed'];if(_0x5d0187[0x0][_0x598f66(0x1a8)]==_0x598f66(0x292))var _0x5b2fe2=users['English'];else{if(_0x5d0187[0x0][_0x598f66(0x1a8)]==_0x598f66(0x244))var _0x5b2fe2=users[_0x598f66(0x244)];else{if(_0x5d0187[0x0][_0x598f66(0x1a8)]==_0x598f66(0x1c6))var _0x5b2fe2=users[_0x598f66(0x1c6)];else{if(_0x5d0187[0x0]['language']==_0x598f66(0x1f1))var _0x5b2fe2=users['Spanish'];else{if(_0x5d0187[0x0][_0x598f66(0x1a8)]==_0x598f66(0x1cc))var _0x5b2fe2=users['French'];else{if(_0x5d0187[0x0][_0x598f66(0x1a8)]=='Portuguese\x20(BR)')var _0x5b2fe2=users['Portuguese'];else{if(_0x5d0187[0x0][_0x598f66(0x1a8)]==_0x598f66(0x26f))var _0x5b2fe2=users[_0x598f66(0x26f)];else{if(_0x5d0187[0x0]['language']==_0x598f66(0x222))var _0x5b2fe2=users[_0x598f66(0x200)];}}}}}}}const _0x54475e=getRandom8DigitNumber();_0x54475e[_0x598f66(0x29d)](_0x467f7d=>{var _0x49b96c=_0x598f66;_0x3c9a76[_0x49b96c(0x1d1)](_0x49b96c(0x27a),{'success':_0x13a7f1[_0x49b96c(0x283)](_0x49b96c(0x1dd)),'errors':_0x13a7f1[_0x49b96c(0x283)](_0x49b96c(0x206)),'role':_0x4752d7,'profile':_0x2b9b7d,'suppliers':_0x339a08,'warehouse':_0x24f83e,'product':_0xc53b2,'invoice':_0x467f7d,'master_shop':_0x5d0187,'language':_0x5b2fe2,'find_data':_0x334a36,'rooms_data':_0x41e7c2});})[_0x598f66(0x254)](_0x10460f=>{var _0x2829f3=_0x598f66;_0x13a7f1[_0x2829f3(0x283)](_0x2829f3(0x206),_0x2829f3(0x1ce)),_0x3c9a76['redirect']('/all_purchases_finished/view');});}catch(_0x4acae3){console[_0x598f66(0x236)](_0x4acae3);}}),router[a0_0x4b7d49(0x29b)](a0_0x4b7d49(0x1f2),auth,async(_0x1a1c77,_0x802a6c)=>{var _0xa265f3=a0_0x4b7d49;try{const _0x330be4=_0x1a1c77[_0xa265f3(0x1c9)]['id'];console[_0xa265f3(0x236)](_0x330be4);const _0x4faaef=await master_shop[_0xa265f3(0x1ad)]();console[_0xa265f3(0x236)](_0xa265f3(0x1ef),_0x4faaef);const _0x571aca=await product[_0xa265f3(0x1f4)]({'name':_0x330be4});console['log'](_0xa265f3(0x261),_0x571aca),_0x802a6c[_0xa265f3(0x27b)](0xc8)['json']({'product_data':_0x571aca,'master':_0x4faaef});}catch(_0x291ed5){console['log'](_0xa265f3(0x1d0),_0x291ed5);}}),router[a0_0x4b7d49(0x1f0)](a0_0x4b7d49(0x272),auth,async(_0x5f2ef2,_0x256b95)=>{var _0x4dc8e1=a0_0x4b7d49;try{const {invoice:_0x5e7359,date:_0x34d25c,warehouse_name:_0x1eeb65,prod_name:_0x110f72,prod_code:_0x335cdd,prod_qty:_0x432bc2,prod_unit:_0x3a3dc8,prod_secondunit:_0x4277e1,prod_level:_0x34626a,prod_isle:_0x36bdd0,prod_pallet:_0x287093,note:_0x5ce6c7,expiry_date:_0x286f98,batch_code:_0x1334a4,payable:_0x41713d,due_amount:_0x24b8a2,Room_name:_0x355c25,primary_code:_0x508038,secondary_code:_0xb5e223,MaxStocks_data:_0x4c9ae9,PO_number:_0x1e2709,SCRN:_0x4bbc68,JO_number:_0xb5f047}=_0x5f2ef2[_0x4dc8e1(0x1fe)];if(typeof _0x110f72==_0x4dc8e1(0x26e))var _0x5b26f0=[_0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x20f)]],_0xa7a0cf=[_0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x287)]],_0x3ec0ff=[_0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x273)]],_0x1ecdd0=[_0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x1ea)]],_0x35a1b3=[_0x5f2ef2[_0x4dc8e1(0x1fe)]['prod_secondunit']],_0x383ace=[_0x5f2ef2['body'][_0x4dc8e1(0x297)]],_0x417683=[_0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x1f7)]],_0x10bcd8=[_0x5f2ef2['body']['secondary_code']],_0x1d2524=[_0x5f2ef2['body'][_0x4dc8e1(0x217)]],_0xfdf53e=[_0x5f2ef2['body'][_0x4dc8e1(0x203)]],_0x4da660=[_0x5f2ef2[_0x4dc8e1(0x1fe)]['expiry_date']],_0x12b664=[_0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x1f9)]],_0x3fb7dc=[_0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x1bd)]],_0x3407ec=[_0x5f2ef2[_0x4dc8e1(0x1fe)]['prod_cat']],_0x699f59=[_0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x24c)]],_0x27630a=[_0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x276)]];else var _0x5b26f0=[..._0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x20f)]],_0xa7a0cf=[..._0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x287)]],_0x3ec0ff=[..._0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x273)]],_0x1ecdd0=[..._0x5f2ef2[_0x4dc8e1(0x1fe)]['prod_primunit']],_0x35a1b3=[..._0x5f2ef2[_0x4dc8e1(0x1fe)]['prod_secondunit']],_0x383ace=[..._0x5f2ef2[_0x4dc8e1(0x1fe)]['prod_level']],_0x417683=[..._0x5f2ef2['body'][_0x4dc8e1(0x1f7)]],_0x10bcd8=[..._0x5f2ef2['body']['secondary_code']],_0x1d2524=[..._0x5f2ef2['body'][_0x4dc8e1(0x217)]],_0xfdf53e=[..._0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x203)]],_0x4da660=[..._0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x22f)]],_0x12b664=[..._0x5f2ef2['body'][_0x4dc8e1(0x1f9)]],_0x3fb7dc=[..._0x5f2ef2[_0x4dc8e1(0x1fe)][_0x4dc8e1(0x1bd)]],_0x3407ec=[..._0x5f2ef2['body'][_0x4dc8e1(0x1bf)]],_0x699f59=[..._0x5f2ef2[_0x4dc8e1(0x1fe)]['RoomAssign']],_0x27630a=[..._0x5f2ef2[_0x4dc8e1(0x1fe)]['prod_invoice']];const _0x2c741b=_0x5b26f0['map'](_0xd2f275=>{return _0xd2f275={'product_name':_0xd2f275};});_0xa7a0cf[_0x4dc8e1(0x28a)]((_0x466ec8,_0xcf639c)=>{_0x2c741b[_0xcf639c]['product_code']=_0x466ec8;}),_0x3ec0ff[_0x4dc8e1(0x28a)]((_0x328645,_0x3d4286)=>{var _0x2ab1ab=_0x4dc8e1;_0x2c741b[_0x3d4286][_0x2ab1ab(0x21b)]=Math[_0x2ab1ab(0x28d)](_0x328645);}),_0x1ecdd0[_0x4dc8e1(0x28a)]((_0x186e75,_0x46b177)=>{var _0x2083fa=_0x4dc8e1;_0x2c741b[_0x46b177][_0x2083fa(0x25b)]=_0x186e75;}),_0x35a1b3[_0x4dc8e1(0x28a)]((_0x129159,_0x36e396)=>{var _0x318bf0=_0x4dc8e1;_0x2c741b[_0x36e396][_0x318bf0(0x1b5)]=_0x129159;}),_0x383ace[_0x4dc8e1(0x28a)]((_0x3c8bd6,_0x3c56f4)=>{_0x2c741b[_0x3c56f4]['bay']=_0x3c8bd6;}),_0x417683[_0x4dc8e1(0x28a)]((_0x498169,_0x20a143)=>{var _0x4480d7=_0x4dc8e1;_0x2c741b[_0x20a143][_0x4480d7(0x1f7)]=_0x498169;}),_0x10bcd8[_0x4dc8e1(0x28a)]((_0x40294a,_0x24c44e)=>{var _0x136b18=_0x4dc8e1;_0x2c741b[_0x24c44e][_0x136b18(0x1e8)]=_0x40294a;}),_0x1d2524[_0x4dc8e1(0x28a)]((_0x2db917,_0x211581)=>{var _0x206fb7=_0x4dc8e1;_0x2c741b[_0x211581][_0x206fb7(0x1f5)]=_0x2db917;}),_0xfdf53e['forEach']((_0x55e1fd,_0x1a118c)=>{var _0xc5ee4=_0x4dc8e1;_0x2c741b[_0x1a118c][_0xc5ee4(0x203)]=_0x55e1fd;}),_0x4da660[_0x4dc8e1(0x28a)]((_0x45d6a3,_0x43c3bd)=>{var _0x534b21=_0x4dc8e1;_0x2c741b[_0x43c3bd][_0x534b21(0x22f)]=_0x45d6a3;}),_0x12b664[_0x4dc8e1(0x28a)]((_0x164a3e,_0x665b1a)=>{var _0x351d4b=_0x4dc8e1;_0x2c741b[_0x665b1a][_0x351d4b(0x243)]=_0x164a3e;}),_0x3fb7dc['forEach']((_0x217711,_0x2aee98)=>{_0x2c741b[_0x2aee98]['maxperunit']=_0x217711;}),_0x3407ec['forEach']((_0x4bd6de,_0x30faba)=>{var _0x3cb886=_0x4dc8e1;_0x2c741b[_0x30faba][_0x3cb886(0x1a7)]=_0x4bd6de;}),_0x699f59['forEach']((_0x2f5812,_0x5959c5)=>{var _0x485fed=_0x4dc8e1;_0x2c741b[_0x5959c5][_0x485fed(0x252)]=_0x2f5812;}),_0x27630a[_0x4dc8e1(0x28a)]((_0x3d60d5,_0x1a7eab)=>{var _0x431929=_0x4dc8e1;_0x2c741b[_0x1a7eab][_0x431929(0x24f)]=_0x3d60d5;});const _0x42bdf5=_0x2c741b[_0x4dc8e1(0x213)](_0x2b91b5=>_0x2b91b5[_0x4dc8e1(0x21b)]!=='0'&&_0x2b91b5[_0x4dc8e1(0x21b)]!==''),_0x2cbf13=new purchases_finished({'invoice':_0x5e7359,'suppliers':_0x5f2ef2[_0x4dc8e1(0x1fe)]['suppliers'],'date':_0x34d25c,'warehouse_name':_0x1eeb65,'product':_0x42bdf5,'note':_0x5ce6c7,'due_amount':_0x24b8a2,'room':_0x355c25,'POnumber':_0x1e2709,'SCRN':_0x4bbc68,'JO_number':_0xb5f047}),_0x2936e6=await _0x2cbf13[_0x4dc8e1(0x277)](),_0x3eab98=await purchases_finished[_0x4dc8e1(0x1f4)]({'invoice':_0x5e7359}),_0x30d652=_0x3eab98['product'][_0x4dc8e1(0x1c5)](async _0x1b22ae=>{var _0x5039b8=_0x4dc8e1;try{var _0x13a66c=await warehouse[_0x5039b8(0x1f4)]({'name':_0x1eeb65,'room':_0x1b22ae[_0x5039b8(0x252)]}),_0x1a0b3c=0x0;const _0x58f555=_0x13a66c[_0x5039b8(0x1ee)]['map'](_0xa1ae95=>{var _0x12ef7f=_0x5039b8;console[_0x12ef7f(0x236)](_0xa1ae95[_0x12ef7f(0x1cf)]+'=='+_0x1b22ae[_0x12ef7f(0x1cf)]+'&&'+_0xa1ae95[_0x12ef7f(0x1da)]+'=='+_0x1b22ae[_0x12ef7f(0x1da)]+'&&'+_0xa1ae95[_0x12ef7f(0x22f)]+'=='+_0x1b22ae['expiry_date']+'&&'+_0xa1ae95[_0x12ef7f(0x243)]+'=='+_0x1b22ae[_0x12ef7f(0x243)]+'&&'+_0xa1ae95[_0x12ef7f(0x203)]+'=='+_0x1b22ae['batch_code']+'&&'+_0xa1ae95[_0x12ef7f(0x24f)]+'=='+_0x3eab98['invoice']),_0xa1ae95[_0x12ef7f(0x1cf)]==_0x1b22ae[_0x12ef7f(0x1cf)]&&_0xa1ae95[_0x12ef7f(0x1da)]==_0x1b22ae[_0x12ef7f(0x1da)]&&_0xa1ae95[_0x12ef7f(0x22f)]==_0x1b22ae[_0x12ef7f(0x22f)]&&_0xa1ae95[_0x12ef7f(0x243)]==_0x1b22ae[_0x12ef7f(0x243)]&&_0xa1ae95[_0x12ef7f(0x203)]==_0x1b22ae[_0x12ef7f(0x203)]&&_0xa1ae95[_0x12ef7f(0x24f)]==_0x3eab98[_0x12ef7f(0x24f)]&&(_0xa1ae95['product_stock']=Math[_0x12ef7f(0x28d)](_0xa1ae95[_0x12ef7f(0x1af)])+Math[_0x12ef7f(0x28d)](_0x1b22ae['quantity']),_0x1a0b3c++);});return _0x1a0b3c==0x0&&(_0x13a66c[_0x5039b8(0x1ee)]=_0x13a66c[_0x5039b8(0x1ee)][_0x5039b8(0x1d4)]({'product_name':_0x1b22ae['product_name'],'product_stock':Math[_0x5039b8(0x28d)](_0x1b22ae[_0x5039b8(0x21b)]),'primary_code':_0x1b22ae[_0x5039b8(0x1f7)],'secondary_code':_0x1b22ae[_0x5039b8(0x1e8)],'product_code':_0x1b22ae[_0x5039b8(0x260)],'bay':_0x1b22ae['bay'],'maxProducts':_0x1b22ae[_0x5039b8(0x1f5)],'unit':_0x1b22ae['standard_unit'],'secondary_unit':_0x1b22ae[_0x5039b8(0x1b5)],'expiry_date':_0x1b22ae['expiry_date'],'production_date':_0x1b22ae[_0x5039b8(0x243)],'maxProducts':_0x1b22ae[_0x5039b8(0x1f5)],'maxPerUnit':_0x1b22ae['maxperunit'],'batch_code':_0x1b22ae[_0x5039b8(0x203)],'product_cat':_0x1b22ae[_0x5039b8(0x1a7)],'invoice':_0x1b22ae[_0x5039b8(0x24f)],'id_incoming':_0x1b22ae['_id']})),_0x13a66c;}catch(_0x2a1fdc){return console[_0x5039b8(0x21a)]('Error\x20occurred\x20while\x20processing\x20product:',_0x2a1fdc),null;}});Promise['all'](_0x30d652)[_0x4dc8e1(0x29d)](async _0x498097=>{var _0x4c0d88=_0x4dc8e1;try{for(const _0x3f2c48 of _0x498097){await warehouse[_0x4c0d88(0x1db)]({'_id':_0x3f2c48['_id']},{'$addToSet':{'product_details':{'$each':_0x3f2c48['product_details']}}});}const _0x860eb7=await master_shop['find'](),_0x222f80=await email_settings[_0x4c0d88(0x1f4)](),_0x309e15=await supervisor_settings[_0x4c0d88(0x1ad)]();var _0x723a63=_0x3eab98[_0x4c0d88(0x261)],_0x349335='',_0x139fe4;for(_0x139fe4 in _0x723a63){var _0x5d4fa6='FG';_0x3eab98[_0x4c0d88(0x21c)]=='DRY\x20GOODS'&&(_0x5d4fa6='DG'),_0x349335+=_0x4c0d88(0x20e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x723a63[_0x139fe4][_0x4c0d88(0x1cf)]+_0x4c0d88(0x1b0)+_0x4c0d88(0x239)+_0x723a63[_0x139fe4][_0x4c0d88(0x260)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x723a63[_0x139fe4][_0x4c0d88(0x21b)]+'</td>'+_0x4c0d88(0x239)+_0x723a63[_0x139fe4]['standard_unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x723a63[_0x139fe4][_0x4c0d88(0x1b5)]+'</td>'+_0x4c0d88(0x239)+_0x3eab98['warehouse_name']+_0x4c0d88(0x1b0)+_0x4c0d88(0x239)+_0x723a63[_0x139fe4][_0x4c0d88(0x252)]+_0x4c0d88(0x1b0)+_0x4c0d88(0x239)+_0x5d4fa6+_0x723a63[_0x139fe4][_0x4c0d88(0x1da)]+'</td>','</tr>';}let _0x360562=nodemailer[_0x4c0d88(0x238)]({'host':_0x222f80[_0x4c0d88(0x23d)],'port':Number(_0x222f80[_0x4c0d88(0x1b4)]),'secure':![],'auth':{'user':_0x222f80[_0x4c0d88(0x293)],'pass':_0x222f80[_0x4c0d88(0x274)]}}),_0x1303f7={'from':_0x222f80[_0x4c0d88(0x293)],'to':_0x309e15[0x0][_0x4c0d88(0x1bb)],'subject':_0x4c0d88(0x28b),'attachments':[{'filename':'Logo.png','path':__dirname+_0x4c0d88(0x1d6)+_0x4c0d88(0x22d)+_0x860eb7[0x0][_0x4c0d88(0x1f6)],'cid':_0x4c0d88(0x1dc)}],'html':_0x4c0d88(0x22a)+'<html><head><title></title>'+_0x4c0d88(0x218)+_0x4c0d88(0x1fa)+_0x4c0d88(0x1d5)+_0x4c0d88(0x1fa)+_0x4c0d88(0x1c4)+'</div>'+_0x4c0d88(0x1fa)+_0x4c0d88(0x220)+_0x860eb7[0x0][_0x4c0d88(0x1fc)]+_0x4c0d88(0x1d8)+_0x4c0d88(0x1b7)+_0x4c0d88(0x1b7)+'<hr\x20class=\x22my-3\x22>'+_0x4c0d88(0x1fa)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4c0d88(0x23e)+_0x3eab98[_0x4c0d88(0x24f)]+'\x20'+_0x4c0d88(0x1aa)+'\x20Order\x20Date\x20:\x20'+_0x3eab98[_0x4c0d88(0x207)]+'\x20'+_0x4c0d88(0x279)+_0x4c0d88(0x211)+_0x4c0d88(0x1b7)+_0x4c0d88(0x29f)+_0x4c0d88(0x1c7)+_0x4c0d88(0x20e)+_0x4c0d88(0x255)+_0x4c0d88(0x1a6)+_0x4c0d88(0x23a)+_0x4c0d88(0x1e3)+_0x4c0d88(0x251)+_0x4c0d88(0x1bc)+_0x4c0d88(0x205)+_0x4c0d88(0x294)+'</tr>'+_0x4c0d88(0x26d)+_0x4c0d88(0x285)+'\x20'+_0x349335+'\x20'+_0x4c0d88(0x1e7)+_0x4c0d88(0x20a)+_0x4c0d88(0x1fa)+_0x4c0d88(0x1a5)+_0x4c0d88(0x1a2)+_0x860eb7[0x0]['site_title']+_0x4c0d88(0x211)+'</div>'+_0x4c0d88(0x1b7)+_0x4c0d88(0x21f)};_0x360562[_0x4c0d88(0x298)](_0x1303f7,function(_0x4f7d7d,_0x6790c6){var _0x2a6347=_0x4c0d88;_0x4f7d7d?(console[_0x2a6347(0x236)](_0x4f7d7d),console[_0x2a6347(0x236)](_0x2a6347(0x22c))):console[_0x2a6347(0x236)](_0x2a6347(0x1a1));});}catch(_0x33e91b){console[_0x4c0d88(0x21a)](_0x33e91b),_0x256b95[_0x4c0d88(0x27b)](0x1f4)[_0x4c0d88(0x19f)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x33e91b[_0x4c0d88(0x1b2)]});}})['catch'](_0x27c083=>{var _0x441048=_0x4dc8e1;console[_0x441048(0x21a)](_0x27c083);}),_0x5f2ef2[_0x4dc8e1(0x283)]('success',_0x4dc8e1(0x1c0)),_0x256b95[_0x4dc8e1(0x229)](_0x4dc8e1(0x242));}catch(_0x56b913){console[_0x4dc8e1(0x236)](_0x56b913);}}),router[a0_0x4b7d49(0x29b)]('/preview/:id',auth,async(_0x46ab69,_0x374121)=>{var _0x4d99b5=a0_0x4b7d49;try{const {username:_0x384be9,email:_0x267849,role:_0x23d27d}=_0x46ab69[_0x4d99b5(0x266)],_0x39cbde=_0x46ab69[_0x4d99b5(0x266)],_0x146064=await profile[_0x4d99b5(0x1f4)]({'email':_0x39cbde[_0x4d99b5(0x293)]}),_0x2b6db9=await master_shop[_0x4d99b5(0x1ad)](),_0x1fc55c=_0x46ab69[_0x4d99b5(0x1c9)]['id'],_0x3773b5=await purchases_finished['findById'](_0x1fc55c),_0x38a053=await suppliers[_0x4d99b5(0x1ad)]({});let _0x3961fd;if(_0x39cbde[_0x4d99b5(0x20c)]==_0x4d99b5(0x20b)){const _0x32cbbb=await staff[_0x4d99b5(0x1f4)]({'email':_0x39cbde[_0x4d99b5(0x293)]});_0x3961fd=await warehouse[_0x4d99b5(0x1ad)]({'status':_0x4d99b5(0x25a),'name':_0x32cbbb[_0x4d99b5(0x1a0)],'warehouse_category':'Finished\x20Goods'});}else _0x3961fd=await warehouse[_0x4d99b5(0x299)]([{'$match':{'status':'Enabled','warehouse_category':_0x4d99b5(0x204)}},{'$group':{'_id':'$name','name':{'$first':_0x4d99b5(0x1ae)}}}]);const _0x41bef9=await product[_0x4d99b5(0x1ad)]({}),_0x12289d=BayBinSelected(_0x3773b5[_0x4d99b5(0x21c)],_0x3773b5['room']);let _0x58cc59=new Date(_0x3773b5[_0x4d99b5(0x22f)]),_0xb084=('0'+_0x58cc59['getDate']())[_0x4d99b5(0x25e)](-0x2),_0x12b7db=('0'+(_0x58cc59[_0x4d99b5(0x1be)]()+0x1))['slice'](-0x2),_0x17a832=_0x58cc59[_0x4d99b5(0x1eb)](),_0x533158=_0x17a832+'-'+_0x12b7db+'-'+_0xb084;if(_0x2b6db9[0x0][_0x4d99b5(0x1a8)]==_0x4d99b5(0x292)){var _0x533a8e=users['English'];console['log'](_0x533a8e);}else{if(_0x2b6db9[0x0][_0x4d99b5(0x1a8)]==_0x4d99b5(0x244))var _0x533a8e=users[_0x4d99b5(0x244)];else{if(_0x2b6db9[0x0][_0x4d99b5(0x1a8)]==_0x4d99b5(0x1c6))var _0x533a8e=users[_0x4d99b5(0x1c6)];else{if(_0x2b6db9[0x0][_0x4d99b5(0x1a8)]=='Spanish')var _0x533a8e=users[_0x4d99b5(0x1f1)];else{if(_0x2b6db9[0x0]['language']==_0x4d99b5(0x1cc))var _0x533a8e=users[_0x4d99b5(0x1cc)];else{if(_0x2b6db9[0x0][_0x4d99b5(0x1a8)]==_0x4d99b5(0x20d))var _0x533a8e=users['Portuguese'];else{if(_0x2b6db9[0x0]['language']=='Chinese')var _0x533a8e=users[_0x4d99b5(0x26f)];else{if(_0x2b6db9[0x0][_0x4d99b5(0x1a8)]==_0x4d99b5(0x222))var _0x533a8e=users['Arabic'];}}}}}}}_0x374121['render'](_0x4d99b5(0x210),{'success':_0x46ab69['flash'](_0x4d99b5(0x1dd)),'errors':_0x46ab69[_0x4d99b5(0x283)]('errors'),'role':_0x39cbde,'profile':_0x146064,'purchases':_0x3773b5,'suppliers':_0x38a053,'warehouse':_0x3961fd,'product':_0x41bef9,'master_shop':_0x2b6db9,'language':_0x533a8e,'ed_fullDate':_0x533158,'dataSelected':_0x12289d});}catch(_0x1e2ce5){console[_0x4d99b5(0x236)](_0x1e2ce5);}}),router[a0_0x4b7d49(0x29b)](a0_0x4b7d49(0x230),auth,async(_0x13798b,_0x8cf927)=>{var _0x2b3e95=a0_0x4b7d49;try{const {username:_0x3d4687,email:_0x581d51,role:_0x14d25a}=_0x13798b[_0x2b3e95(0x266)],_0x7c6bab=_0x13798b[_0x2b3e95(0x266)],_0x425241=await profile[_0x2b3e95(0x1f4)]({'email':_0x7c6bab[_0x2b3e95(0x293)]}),_0x45ba6c=await master_shop[_0x2b3e95(0x1ad)](),_0x325f25=_0x13798b[_0x2b3e95(0x1c9)]['id'],_0x341911=await purchases_finished[_0x2b3e95(0x1e9)](_0x325f25),_0x66530=await suppliers[_0x2b3e95(0x1ad)]({});let _0x498b6f;if(_0x7c6bab[_0x2b3e95(0x20c)]==_0x2b3e95(0x20b)){const _0xef6219=await staff[_0x2b3e95(0x1f4)]({'email':_0x7c6bab[_0x2b3e95(0x293)]});_0x498b6f=await warehouse[_0x2b3e95(0x1ad)]({'status':'Enabled','name':_0xef6219['warehouse'],'warehouse_category':_0x2b3e95(0x204)});}else _0x498b6f=await warehouse[_0x2b3e95(0x299)]([{'$match':{'status':_0x2b3e95(0x25a),'warehouse_category':_0x2b3e95(0x204)}},{'$group':{'_id':_0x2b3e95(0x1ae),'name':{'$first':_0x2b3e95(0x1ae)}}}]);const _0x16261c=await product['find']({}),_0x2b80a0=BayBinSelected(_0x341911[_0x2b3e95(0x21c)],_0x341911[_0x2b3e95(0x225)]);let _0x1f7e39=new Date(_0x341911[_0x2b3e95(0x22f)]),_0x156c8d=('0'+_0x1f7e39['getDate']())['slice'](-0x2),_0x25bb59=('0'+(_0x1f7e39[_0x2b3e95(0x1be)]()+0x1))['slice'](-0x2),_0x2364bc=_0x1f7e39['getFullYear'](),_0x1f4563=_0x2364bc+'-'+_0x25bb59+'-'+_0x156c8d;if(_0x45ba6c[0x0][_0x2b3e95(0x1a8)]==_0x2b3e95(0x292)){var _0xb96c40=users['English'];console[_0x2b3e95(0x236)](_0xb96c40);}else{if(_0x45ba6c[0x0][_0x2b3e95(0x1a8)]=='Hindi')var _0xb96c40=users[_0x2b3e95(0x244)];else{if(_0x45ba6c[0x0]['language']==_0x2b3e95(0x1c6))var _0xb96c40=users[_0x2b3e95(0x1c6)];else{if(_0x45ba6c[0x0][_0x2b3e95(0x1a8)]==_0x2b3e95(0x1f1))var _0xb96c40=users[_0x2b3e95(0x1f1)];else{if(_0x45ba6c[0x0][_0x2b3e95(0x1a8)]==_0x2b3e95(0x1cc))var _0xb96c40=users['French'];else{if(_0x45ba6c[0x0][_0x2b3e95(0x1a8)]==_0x2b3e95(0x20d))var _0xb96c40=users['Portuguese'];else{if(_0x45ba6c[0x0]['language']==_0x2b3e95(0x26f))var _0xb96c40=users[_0x2b3e95(0x26f)];else{if(_0x45ba6c[0x0]['language']==_0x2b3e95(0x222))var _0xb96c40=users[_0x2b3e95(0x200)];}}}}}}}_0x8cf927[_0x2b3e95(0x1d1)](_0x2b3e95(0x1b8),{'success':_0x13798b['flash'](_0x2b3e95(0x1dd)),'errors':_0x13798b['flash'](_0x2b3e95(0x206)),'role':_0x7c6bab,'profile':_0x425241,'purchases':_0x341911,'suppliers':_0x66530,'warehouse':_0x498b6f,'product':_0x16261c,'master_shop':_0x45ba6c,'language':_0xb96c40,'ed_fullDate':_0x1f4563,'dataSelected':_0x2b80a0});}catch(_0xb50b25){console[_0x2b3e95(0x236)](_0xb50b25);}}),router[a0_0x4b7d49(0x1f0)]('/view/:id',auth,async(_0x500046,_0x2c85fe)=>{var _0x14fd3e=a0_0x4b7d49;try{const _0x503d6e=_0x500046[_0x14fd3e(0x1c9)]['id'],_0x27c349=await purchases_finished[_0x14fd3e(0x1f4)]({'_id':_0x500046[_0x14fd3e(0x1c9)]['id']}),_0x4ee553=await warehouse[_0x14fd3e(0x1f4)]({'name':_0x27c349[_0x14fd3e(0x21c)],'room':_0x27c349[_0x14fd3e(0x225)]});_0x27c349['product'][_0x14fd3e(0x28a)](_0xb1322f=>{var _0x30696f=_0x14fd3e;const _0x53a94e=_0x4ee553[_0x30696f(0x1ee)]['map'](_0x51537b=>{var _0x30bf9d=_0x30696f;_0x51537b[_0x30bf9d(0x1cf)]==_0xb1322f[_0x30bf9d(0x1cf)]&&_0x51537b[_0x30bf9d(0x1da)]==_0xb1322f[_0x30bf9d(0x1da)]&&(_0x51537b[_0x30bf9d(0x1af)]=parseInt(_0x51537b['product_stock'])-parseInt(_0xb1322f['quantity']));});}),await _0x4ee553['save']();const {invoice:_0x5eedb7,suppliers:_0x4adba2,date:_0x56ba75,warehouse_name:_0x595775,prod_name:_0x35f29f,prod_code:_0x5559f6,prod_qty:_0x573235,prod_unit:_0x5b2a58,prod_secondunit:_0x5a038e,prod_level:_0x267f42,prod_isle:_0x2d648f,prod_pallet:_0x5e06d3,note:_0x39a842,expiry_date:_0x44e755,batch_code:_0x55caf3,paid_amount:_0x498bf4,due_amount:_0x337fd4,Room_name:_0x2b08ff,primary_code:_0x3037b7,secondary_code:_0x1d6a98,PO_number:_0x28a1c3,JO_number:_0x5c8cc3}=_0x500046[_0x14fd3e(0x1fe)];if(typeof _0x35f29f==_0x14fd3e(0x26e))var _0x9455c2=[_0x500046['body'][_0x14fd3e(0x20f)]],_0x481c6e=[_0x500046['body'][_0x14fd3e(0x287)]],_0x55c277=[_0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x29c)]],_0x55fb26=[_0x500046[_0x14fd3e(0x1fe)]['prod_unit']],_0x53bac3=[_0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x1f3)]],_0x3bbdd5=[_0x500046['body'][_0x14fd3e(0x297)]],_0x1dba2b=[_0x500046['body']['primary_code']],_0x23fb0c=[_0x500046[_0x14fd3e(0x1fe)]['secondary_code']],_0xf234c1=[_0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x217)]],_0x4931b9=[_0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x203)]],_0x573d7c=[_0x500046[_0x14fd3e(0x1fe)]['expiry_date']];else var _0x9455c2=[..._0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x20f)]],_0x481c6e=[..._0x500046[_0x14fd3e(0x1fe)]['prod_code']],_0x55c277=[..._0x500046['body']['prod_qty']],_0x55fb26=[..._0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x259)]],_0x53bac3=[..._0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x1f3)]],_0x3bbdd5=[..._0x500046['body'][_0x14fd3e(0x297)]],_0x1dba2b=[..._0x500046['body']['primary_code']],_0x23fb0c=[..._0x500046['body'][_0x14fd3e(0x1e8)]],_0xf234c1=[..._0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x217)]],_0x4931b9=[..._0x500046[_0x14fd3e(0x1fe)]['batch_code']],_0x573d7c=[..._0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x22f)]];const _0x2d9dce=_0x9455c2[_0x14fd3e(0x1c5)](_0x3a475f=>{return _0x3a475f={'product_name':_0x3a475f};});_0x481c6e[_0x14fd3e(0x28a)]((_0x1c0fec,_0x3c9bf8)=>{_0x2d9dce[_0x3c9bf8]['product_code']=_0x1c0fec;}),_0x55c277['forEach']((_0x2d1a1d,_0x3f4c62)=>{var _0x2d08e2=_0x14fd3e;_0x2d9dce[_0x3f4c62][_0x2d08e2(0x21b)]=_0x2d1a1d;}),_0x55fb26[_0x14fd3e(0x28a)]((_0x5afaf9,_0x4f313d)=>{_0x2d9dce[_0x4f313d]['standard_unit']=_0x5afaf9;}),_0x53bac3[_0x14fd3e(0x28a)]((_0xc7f9e2,_0x1b6d35)=>{var _0x3f1f80=_0x14fd3e;_0x2d9dce[_0x1b6d35][_0x3f1f80(0x1b5)]=_0xc7f9e2;}),_0x3bbdd5[_0x14fd3e(0x28a)]((_0x26f682,_0xd43b8d)=>{_0x2d9dce[_0xd43b8d]['bay']=_0x26f682;}),_0x1dba2b[_0x14fd3e(0x28a)]((_0x23f31b,_0x16c590)=>{var _0x1f6156=_0x14fd3e;_0x2d9dce[_0x16c590][_0x1f6156(0x1f7)]=_0x23f31b;}),_0x23fb0c[_0x14fd3e(0x28a)]((_0x50b795,_0xb143e7)=>{var _0x48bf5b=_0x14fd3e;_0x2d9dce[_0xb143e7][_0x48bf5b(0x1e8)]=_0x50b795;}),_0xf234c1[_0x14fd3e(0x28a)]((_0x3a0a37,_0x2900c5)=>{var _0x461a93=_0x14fd3e;_0x2d9dce[_0x2900c5][_0x461a93(0x1f5)]=_0x3a0a37;}),_0x4931b9[_0x14fd3e(0x28a)]((_0x1a8e63,_0x1a52a2)=>{_0x2d9dce[_0x1a52a2]['batch_code']=_0x1a8e63;}),_0x573d7c[_0x14fd3e(0x28a)]((_0xad1f71,_0x435ab3)=>{var _0x46f612=_0x14fd3e;_0x2d9dce[_0x435ab3][_0x46f612(0x22f)]=_0xad1f71;});const _0x5e8cc8=_0x2d9dce[_0x14fd3e(0x213)](_0x204fff=>_0x204fff[_0x14fd3e(0x21b)]!=='0'&&_0x204fff[_0x14fd3e(0x21b)]!=='');_0x27c349[_0x14fd3e(0x24f)]=_0x5eedb7,_0x27c349[_0x14fd3e(0x258)]=_0x4adba2,_0x27c349[_0x14fd3e(0x207)]=_0x56ba75,_0x27c349[_0x14fd3e(0x21c)]=_0x595775,_0x27c349['product']=_0x5e8cc8,_0x27c349[_0x14fd3e(0x28e)]=_0x39a842,_0x27c349['paid_amount']=_0x498bf4,_0x27c349[_0x14fd3e(0x278)]=_0x337fd4,_0x27c349[_0x14fd3e(0x225)]=_0x2b08ff,_0x27c349[_0x14fd3e(0x28f)]=_0x28a1c3,_0x27c349[_0x14fd3e(0x241)]=_0x5c8cc3;const _0x4560d3=await _0x27c349[_0x14fd3e(0x277)](),_0x2aa045=await warehouse['findOne']({'name':_0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x21c)],'room':_0x500046[_0x14fd3e(0x1fe)]['Room_name']});_0x27c349[_0x14fd3e(0x261)][_0x14fd3e(0x28a)](_0x2fbe14=>{var _0x11d8b6=_0x14fd3e,_0x394b34=0x0;const _0x55cd85=_0x2aa045['product_details']['map'](_0x499387=>{var _0x3d7109=a0_0x20c6;_0x499387['product_name']==_0x2fbe14[_0x3d7109(0x1cf)]&&_0x499387[_0x3d7109(0x1da)]==_0x2fbe14[_0x3d7109(0x1da)]&&(_0x499387[_0x3d7109(0x1af)]=parseInt(_0x499387[_0x3d7109(0x1af)])+parseInt(_0x2fbe14[_0x3d7109(0x21b)]),_0x394b34++);});_0x394b34=='0'&&(_0x2aa045[_0x11d8b6(0x1ee)]=_0x2aa045[_0x11d8b6(0x1ee)]['concat']({'product_name':_0x2fbe14[_0x11d8b6(0x1cf)],'product_stock':_0x2fbe14[_0x11d8b6(0x21b)],'primary_code':_0x2fbe14[_0x11d8b6(0x1f7)],'secondary_code':_0x2fbe14['secondary_code'],'product_code':_0x2fbe14[_0x11d8b6(0x260)],'bay':_0x2fbe14[_0x11d8b6(0x1da)],'maxProducts':_0x2fbe14[_0x11d8b6(0x1f5)],'unit':_0x2fbe14[_0x11d8b6(0x25b)],'secondary_unit':_0x2fbe14['secondary_unit'],'expiry_date':_0x2fbe14[_0x11d8b6(0x22f)]}));}),await _0x2aa045['save']();const _0x224c05=await s_payment_data[_0x14fd3e(0x1f4)]({'invoice':_0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x24f)]});if(_0x224c05===null){}else console['log'](_0x14fd3e(0x258),_0x224c05,_0x500046['body']['invoice']),_0x224c05[_0x14fd3e(0x258)]=_0x500046[_0x14fd3e(0x1fe)][_0x14fd3e(0x258)],await _0x224c05[_0x14fd3e(0x277)]();_0x500046[_0x14fd3e(0x283)](_0x14fd3e(0x1dd),_0x14fd3e(0x1b1)),_0x2c85fe[_0x14fd3e(0x229)](_0x14fd3e(0x242));}catch(_0x22a089){console[_0x14fd3e(0x236)](_0x22a089);}}),router[a0_0x4b7d49(0x1f0)](a0_0x4b7d49(0x21d),auth,async(_0x49f2e3,_0x5bb991)=>{var _0x384a73=a0_0x4b7d49;try{const _0x5d1069=_0x49f2e3[_0x384a73(0x1c9)]['id'],{invoice:_0x2a5295,suppliers:_0x5d0b0d,payable:_0x36b02f,due_amount:_0x217ea9}=_0x49f2e3['body'],_0x5dd3dc=await purchases[_0x384a73(0x1e9)](_0x5d1069);var _0x5b350d=_0x36b02f-_0x217ea9;_0x5dd3dc[_0x384a73(0x233)]=parseFloat(_0x5dd3dc[_0x384a73(0x233)])+parseFloat(_0x217ea9),_0x5dd3dc[_0x384a73(0x278)]=_0x5b350d;const _0x5463f4=await _0x5dd3dc['save']();console['log'](_0x5463f4);const _0x11fe71=await s_payment_data[_0x384a73(0x1f4)]({'invoice':_0x2a5295});_0x11fe71[_0x384a73(0x1de)]=_0x5b350d,await _0x11fe71[_0x384a73(0x277)]();let _0x16e3fc=new Date(),_0x53c5b1=('0'+_0x16e3fc[_0x384a73(0x269)]())['slice'](-0x2),_0x249572=('0'+(_0x16e3fc[_0x384a73(0x1be)]()+0x1))['slice'](-0x2),_0x5262d6=_0x16e3fc[_0x384a73(0x1eb)](),_0x55375c=_0x5262d6+'-'+_0x249572+'-'+_0x53c5b1;const _0x5a8132=new suppliers_payment({'invoice':_0x2a5295,'date':_0x5262d6+'-'+_0x249572+'-'+_0x53c5b1,'suppliers':_0x5d0b0d,'reason':_0x384a73(0x228),'amount':_0x217ea9}),_0x1937ed=await _0x5a8132[_0x384a73(0x277)]();_0x49f2e3[_0x384a73(0x283)]('success','payment\x20successfull'),_0x5bb991[_0x384a73(0x229)](_0x384a73(0x270));}catch(_0x5a98bf){console[_0x384a73(0x236)](_0x5a98bf);}}),router[a0_0x4b7d49(0x29b)]('/invoice/:id',auth,async(_0x4ffa58,_0x2a6a17)=>{var _0x5ee3ae=a0_0x4b7d49;try{const {username:_0x37f2aa,email:_0x2d7563,role:_0x336cfa}=_0x4ffa58['user'],_0x5829ab=_0x4ffa58[_0x5ee3ae(0x266)],_0x239360=await profile[_0x5ee3ae(0x1f4)]({'email':_0x5829ab[_0x5ee3ae(0x293)]}),_0x5641c9=await master_shop['find']();console[_0x5ee3ae(0x236)](_0x5ee3ae(0x1ef),_0x5641c9);const _0x5d9b83=_0x4ffa58[_0x5ee3ae(0x1c9)]['id'],_0xbb229e=await purchases['findById'](_0x5d9b83);console[_0x5ee3ae(0x236)](_0xbb229e);const _0xbb3c7d=await suppliers['findOne']({'name':_0xbb229e['suppliers']});console[_0x5ee3ae(0x236)](_0xbb3c7d);if(_0x5641c9[0x0][_0x5ee3ae(0x1a8)]=='English\x20(US)'){var _0x36f356=users[_0x5ee3ae(0x27c)];console[_0x5ee3ae(0x236)](_0x36f356);}else{if(_0x5641c9[0x0][_0x5ee3ae(0x1a8)]==_0x5ee3ae(0x244))var _0x36f356=users[_0x5ee3ae(0x244)];else{if(_0x5641c9[0x0]['language']==_0x5ee3ae(0x1c6))var _0x36f356=users[_0x5ee3ae(0x1c6)];else{if(_0x5641c9[0x0][_0x5ee3ae(0x1a8)]==_0x5ee3ae(0x1f1))var _0x36f356=users[_0x5ee3ae(0x1f1)];else{if(_0x5641c9[0x0][_0x5ee3ae(0x1a8)]==_0x5ee3ae(0x1cc))var _0x36f356=users[_0x5ee3ae(0x1cc)];else{if(_0x5641c9[0x0][_0x5ee3ae(0x1a8)]==_0x5ee3ae(0x20d))var _0x36f356=users[_0x5ee3ae(0x221)];else{if(_0x5641c9[0x0][_0x5ee3ae(0x1a8)]==_0x5ee3ae(0x26f))var _0x36f356=users['Chinese'];else{if(_0x5641c9[0x0][_0x5ee3ae(0x1a8)]==_0x5ee3ae(0x222))var _0x36f356=users[_0x5ee3ae(0x200)];}}}}}}}_0x2a6a17[_0x5ee3ae(0x1d1)](_0x5ee3ae(0x29a),{'success':_0x4ffa58[_0x5ee3ae(0x283)](_0x5ee3ae(0x1dd)),'errors':_0x4ffa58[_0x5ee3ae(0x283)](_0x5ee3ae(0x206)),'role':_0x5829ab,'profile':_0x239360,'master_shop':_0x5641c9,'supplier':_0xbb3c7d,'purchase':_0xbb229e,'language':_0x36f356});}catch(_0x23ae4a){console[_0x5ee3ae(0x236)](_0x23ae4a);}}),router[a0_0x4b7d49(0x29b)]('/view/return_purchase/:id',auth,async(_0x9bf61a,_0x240c29)=>{var _0x25a753=a0_0x4b7d49;try{const {username:_0x45c2fc,email:_0x348217,role:_0x4acf46}=_0x9bf61a['user'],_0x506c5c=_0x9bf61a['user'],_0x1ca861=await profile[_0x25a753(0x1f4)]({'email':_0x506c5c[_0x25a753(0x293)]}),_0x43f416=await master_shop[_0x25a753(0x1ad)]();console[_0x25a753(0x236)](_0x25a753(0x1ef),_0x43f416);const _0xece7ab=_0x9bf61a[_0x25a753(0x1c9)]['id'];console[_0x25a753(0x236)](_0xece7ab);const _0x3513f4=await purchases_finished[_0x25a753(0x1e9)](_0xece7ab);console[_0x25a753(0x236)]('user_id',_0x3513f4);const _0x151cd6=await product[_0x25a753(0x1ad)]({}),_0x2eb343=await warehouse['aggregate']([{'$match':{'name':_0x3513f4[_0x25a753(0x21c)],'room':_0x3513f4[_0x25a753(0x225)]}},{'$unwind':_0x25a753(0x1d9)},{'$group':{'_id':_0x25a753(0x237),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x25a753(0x1cd)},'bay':{'$first':_0x25a753(0x250)},'bin':{'$first':_0x25a753(0x24b)},'type':{'$first':_0x25a753(0x275)},'floorlevel':{'$first':_0x25a753(0x267)},'primary_code':{'$first':_0x25a753(0x24a)},'secondary_code':{'$first':_0x25a753(0x26b)},'product_code':{'$first':_0x25a753(0x1ff)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x25a753(0x23c)}}}]);console[_0x25a753(0x236)](_0x25a753(0x1ac),_0x2eb343);let _0x2bbff2;if(_0x506c5c[_0x25a753(0x20c)]=='staff'){const _0x22740a=await staff[_0x25a753(0x1f4)]({'email':_0x506c5c['email']});_0x2bbff2=await warehouse[_0x25a753(0x1ad)]({'status':_0x25a753(0x25a),'name':_0x22740a[_0x25a753(0x1a0)],'warehouse_category':_0x25a753(0x204),'name':_0x25a753(0x262)});}else _0x2bbff2=await warehouse[_0x25a753(0x299)]([{'$match':{'status':_0x25a753(0x25a),'warehouse_category':_0x25a753(0x204),'name':'Return\x20Goods'}},{'$group':{'_id':_0x25a753(0x1ae),'name':{'$first':'$name'}}}]);if(_0x43f416[0x0][_0x25a753(0x1a8)]==_0x25a753(0x292)){var _0x556d8b=users['English'];console['log'](_0x556d8b);}else{if(_0x43f416[0x0][_0x25a753(0x1a8)]==_0x25a753(0x244))var _0x556d8b=users['Hindi'];else{if(_0x43f416[0x0][_0x25a753(0x1a8)]==_0x25a753(0x1c6))var _0x556d8b=users['German'];else{if(_0x43f416[0x0][_0x25a753(0x1a8)]==_0x25a753(0x1f1))var _0x556d8b=users['Spanish'];else{if(_0x43f416[0x0][_0x25a753(0x1a8)]==_0x25a753(0x1cc))var _0x556d8b=users[_0x25a753(0x1cc)];else{if(_0x43f416[0x0][_0x25a753(0x1a8)]==_0x25a753(0x20d))var _0x556d8b=users[_0x25a753(0x221)];else{if(_0x43f416[0x0][_0x25a753(0x1a8)]==_0x25a753(0x26f))var _0x556d8b=users[_0x25a753(0x26f)];else{if(_0x43f416[0x0][_0x25a753(0x1a8)]==_0x25a753(0x222))var _0x556d8b=users['Arabic'];}}}}}}}_0x240c29[_0x25a753(0x1d1)](_0x25a753(0x288),{'success':_0x9bf61a['flash'](_0x25a753(0x1dd)),'errors':_0x9bf61a[_0x25a753(0x283)](_0x25a753(0x206)),'role':_0x506c5c,'profile':_0x1ca861,'user':_0x3513f4,'stock':_0x2eb343,'master_shop':_0x43f416,'product':_0x151cd6,'language':_0x556d8b,'warehouse':_0x2bbff2});}catch(_0x11d34c){console[_0x25a753(0x236)](_0x11d34c);}}),router[a0_0x4b7d49(0x1f0)](a0_0x4b7d49(0x1c2),auth,async(_0x179272,_0x28c031)=>{var _0x15b741=a0_0x4b7d49;try{const {invoice:_0x5db7aa,date:_0x20593c,warehouse_name:_0x22a8e6,Room_name:_0x531460,product_name:_0x23a10b,purchase_quantity:_0x5c36c8,stocks:_0x54e683,return_qty:_0x39dd16,note:_0x377305,level:_0xe05d22,isle:_0x3e589f,pallet:_0xa32a64,to_warehouse_name:_0x529e4c,to_Room_name:_0x109f02}=_0x179272[_0x15b741(0x1fe)],_0x2ac6fe=await purchases_finished[_0x15b741(0x1f4)]({'_id':_0x179272[_0x15b741(0x1c9)]['id']}),_0x2413eb=await warehouse['findOne']({'name':_0x22a8e6,'room':_0x531460,'warehouse_category':_0x15b741(0x204)});if(typeof _0x23a10b==_0x15b741(0x26e))var _0x19faaf=[_0x179272['body'][_0x15b741(0x1cf)]],_0x457269=[_0x179272[_0x15b741(0x1fe)][_0x15b741(0x1ca)]],_0x237f7a=[_0x179272[_0x15b741(0x1fe)]['stocks']],_0x5ac57f=[_0x179272['body'][_0x15b741(0x1df)]],_0x432f73=[_0x179272[_0x15b741(0x1fe)][_0x15b741(0x268)]],_0x7c5bf8=[_0x179272['body'][_0x15b741(0x231)]],_0x4ecc2d=[_0x179272[_0x15b741(0x1fe)][_0x15b741(0x248)]],_0x5d46f1=[_0x179272[_0x15b741(0x1fe)][_0x15b741(0x215)]];else var _0x19faaf=[..._0x179272['body']['product_name']],_0x457269=[..._0x179272[_0x15b741(0x1fe)]['purchase_quantity']],_0x237f7a=[..._0x179272[_0x15b741(0x1fe)][_0x15b741(0x1d2)]],_0x5ac57f=[..._0x179272['body'][_0x15b741(0x1df)]],_0x432f73=[..._0x179272[_0x15b741(0x1fe)][_0x15b741(0x268)]],_0x7c5bf8=[..._0x179272[_0x15b741(0x1fe)][_0x15b741(0x231)]],_0x4ecc2d=[..._0x179272[_0x15b741(0x1fe)][_0x15b741(0x248)]],_0x5d46f1=[..._0x179272[_0x15b741(0x1fe)][_0x15b741(0x215)]];const _0x2e5539=_0x19faaf['map'](_0x14c891=>{return _0x14c891={'product_name':_0x14c891};});_0x457269[_0x15b741(0x28a)]((_0x38a3e2,_0x18f852)=>{var _0x21851e=_0x15b741;_0x2e5539[_0x18f852][_0x21851e(0x1ca)]=_0x38a3e2;}),_0x237f7a[_0x15b741(0x28a)]((_0x1713d2,_0x5e7cb4)=>{var _0x251b47=_0x15b741;_0x2e5539[_0x5e7cb4][_0x251b47(0x227)]=_0x1713d2;}),_0x5ac57f[_0x15b741(0x28a)]((_0x4c5934,_0x89f1b5)=>{var _0x128426=_0x15b741;_0x2e5539[_0x89f1b5][_0x128426(0x1df)]=_0x4c5934;}),_0x432f73[_0x15b741(0x28a)]((_0x3c9807,_0x5bfa6d)=>{_0x2e5539[_0x5bfa6d]['bay']=_0x3c9807;}),_0x7c5bf8[_0x15b741(0x28a)]((_0x2395b2,_0x5034ad)=>{var _0x1fa589=_0x15b741;_0x2e5539[_0x5034ad][_0x1fa589(0x260)]=_0x2395b2;}),_0x4ecc2d[_0x15b741(0x28a)]((_0x1e617f,_0x230fe1)=>{var _0x230a25=_0x15b741;_0x2e5539[_0x230fe1][_0x230a25(0x1f7)]=_0x1e617f;}),_0x5d46f1[_0x15b741(0x28a)]((_0x145724,_0x430530)=>{var _0x4a6cdf=_0x15b741;_0x2e5539[_0x430530][_0x4a6cdf(0x1e8)]=_0x145724;}),_0x2e5539[_0x15b741(0x28a)](_0x1f0540=>{var _0x34942e=_0x15b741;console[_0x34942e(0x236)](_0x1f0540);const _0x52a883=_0x2413eb[_0x34942e(0x1ee)][_0x34942e(0x1c5)](_0x166a78=>{var _0x1a6862=_0x34942e;_0x166a78[_0x1a6862(0x1cf)]==_0x1f0540[_0x1a6862(0x1cf)]&&_0x166a78['bay']==_0x1f0540[_0x1a6862(0x1da)]&&(console[_0x1a6862(0x236)](parseInt(_0x166a78['product_stock'])+_0x1a6862(0x1ab)+parseInt(_0x1f0540[_0x1a6862(0x1df)])),_0x166a78[_0x1a6862(0x1af)]=parseInt(_0x166a78[_0x1a6862(0x1af)])-parseInt(_0x1f0540['return_qty']));});}),await _0x2413eb[_0x15b741(0x277)]();var _0x3c9f91=0x0;_0x2e5539['forEach'](_0x184f5e=>{var _0x47602d=_0x15b741;(parseInt(_0x184f5e[_0x47602d(0x1ca)])<parseInt(_0x184f5e[_0x47602d(0x1df)])||parseInt(_0x184f5e[_0x47602d(0x227)])<parseInt(_0x184f5e[_0x47602d(0x1df)]))&&_0x3c9f91++;});if(_0x3c9f91!=0x0)return _0x179272[_0x15b741(0x283)]('errors',_0x15b741(0x280)),_0x28c031[_0x15b741(0x229)](_0x15b741(0x1cb));const _0x38515d=new purchases_return_finished({'invoice':_0x5db7aa,'suppliers':_0x179272[_0x15b741(0x1fe)][_0x15b741(0x258)],'date':_0x20593c,'warehouse_name':_0x22a8e6,'return_product':_0x2e5539,'note':_0x377305,'room':_0x531460,'to_warehouse_name':_0x529e4c,'to_room':_0x109f02}),_0x11476a=await _0x38515d[_0x15b741(0x277)](),_0x5221bb=await purchases_return_finished[_0x15b741(0x1f4)]({'invoice':_0x5db7aa}),_0x2f42e8=await warehouse[_0x15b741(0x1f4)]({'name':_0x529e4c,'room':_0x109f02,'warehouse_category':_0x15b741(0x204)});_0x5221bb['return_product']['forEach'](_0x1efcdc=>{var _0x36a6aa=_0x15b741,_0x45a934=0x0;const _0x45a979=_0x2f42e8[_0x36a6aa(0x1ee)][_0x36a6aa(0x1c5)](_0x2442ae=>{var _0x562668=_0x36a6aa;console[_0x562668(0x236)](_0x2442ae[_0x562668(0x1cf)]+'=='+_0x1efcdc['product_name']+'&&'+_0x2442ae[_0x562668(0x1da)]+'=='+_0x1efcdc[_0x562668(0x1da)]),_0x2442ae['product_name']==_0x1efcdc[_0x562668(0x1cf)]&&_0x2442ae['bay']==_0x1efcdc['bay']&&(_0x2442ae[_0x562668(0x1af)]=parseInt(_0x2442ae[_0x562668(0x1af)])-parseInt(_0x1efcdc[_0x562668(0x1df)]),_0x45a934++);});_0x45a934=='0'&&(_0x2f42e8[_0x36a6aa(0x1ee)]=_0x2f42e8[_0x36a6aa(0x1ee)][_0x36a6aa(0x1d4)]({'product_name':_0x1efcdc['product_name'],'product_stock':_0x1efcdc['return_qty'],'primary_code':_0x1efcdc[_0x36a6aa(0x1f7)],'secondary_code':_0x1efcdc[_0x36a6aa(0x1e8)],'product_code':_0x1efcdc[_0x36a6aa(0x260)],'bay':_0x1efcdc[_0x36a6aa(0x1da)],'maxProducts':0xf423f}));}),await _0x2f42e8[_0x15b741(0x277)]();const _0x1cab1e=await purchases_finished[_0x15b741(0x1f4)]({'invoice':_0x5db7aa});_0x1cab1e[_0x15b741(0x224)]='True';const _0x20190d=await _0x1cab1e['save'](),_0x5cbce6=new s_payment_data({'invoice':_0x5db7aa,'suppliers':_0x179272['body'][_0x15b741(0x258)],'reason':_0x15b741(0x1c3)});await _0x5cbce6['save']();const _0x5442f2=await master_shop[_0x15b741(0x1ad)](),_0x2759f9=await email_settings[_0x15b741(0x1f4)](),_0x5c2993=await suppliers[_0x15b741(0x1f4)]({'name':_0x179272[_0x15b741(0x1fe)][_0x15b741(0x258)]});_0x5442f2[0x0][_0x15b741(0x264)]==0x1?(right_currency=_0x5442f2[0x0][_0x15b741(0x25f)],left_currency=''):(right_currency='',left_currency=_0x5442f2[0x0][_0x15b741(0x25f)]);var _0x47f961=_0x19faaf,_0x2870b5=_0x5ac57f,_0x94f7bb='',_0xae34b;for(_0xae34b in _0x47f961){_0x94f7bb+=_0x15b741(0x20e)+_0x15b741(0x239)+_0x47f961[_0xae34b]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2870b5[_0xae34b]+_0x15b741(0x1b0)+_0x15b741(0x1e6);}let _0x10c4fa=nodemailer[_0x15b741(0x238)]({'service':'gmail','auth':{'user':_0x2759f9[_0x15b741(0x293)],'pass':_0x2759f9[_0x15b741(0x274)]}}),_0x5d8d51={'from':_0x2759f9[_0x15b741(0x293)],'to':_0x5c2993[_0x15b741(0x293)],'subject':_0x15b741(0x1a4),'attachments':[{'filename':_0x15b741(0x289),'path':__dirname+_0x15b741(0x1d6)+_0x15b741(0x22d)+_0x5442f2[0x0][_0x15b741(0x1f6)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x15b741(0x1c1)+_0x15b741(0x218)+_0x15b741(0x1fa)+_0x15b741(0x1d5)+_0x15b741(0x1fa)+_0x15b741(0x1c4)+_0x15b741(0x1b7)+_0x15b741(0x1fa)+_0x15b741(0x220)+_0x5442f2[0x0][_0x15b741(0x1fc)]+_0x15b741(0x1d8)+_0x15b741(0x1b7)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x15b741(0x1fa)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x15b741(0x23e)+_0x5db7aa+'\x20'+_0x15b741(0x1aa)+_0x15b741(0x1fb)+_0x20593c+'\x20'+_0x15b741(0x279)+_0x15b741(0x211)+_0x15b741(0x1b7)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x15b741(0x1c7)+_0x15b741(0x20e)+_0x15b741(0x255)+_0x15b741(0x263)+_0x15b741(0x23f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x15b741(0x1e6)+_0x15b741(0x26d)+_0x15b741(0x285)+'\x20'+_0x94f7bb+'\x20'+'</tbody>'+_0x15b741(0x20a)+_0x15b741(0x1fa)+_0x15b741(0x1a5)+'<h5>'+_0x5442f2[0x0][_0x15b741(0x1fc)]+_0x15b741(0x211)+'</div>'+_0x15b741(0x1b7)+_0x15b741(0x21f)};_0x10c4fa[_0x15b741(0x298)](_0x5d8d51,function(_0x130cc4,_0xed8514){var _0x4b025d=_0x15b741;_0x130cc4?console['log'](_0x4b025d(0x22c)):console['log']('Email\x20sent\x20successfully');}),_0x179272[_0x15b741(0x283)](_0x15b741(0x1dd),_0x15b741(0x29e)),_0x28c031[_0x15b741(0x229)]('/all_purchases_finished/view');}catch(_0x4d771b){_0x28c031[_0x15b741(0x27b)](0xc8)['json']({'message':_0x4d771b[_0x15b741(0x1b2)]});}}),router['get'](a0_0x4b7d49(0x1b6),auth,async(_0x12702b,_0x1d4cb1)=>{var _0x5f154b=a0_0x4b7d49;try{const {username:_0x244736,email:_0x40556c,role:_0x16d83e}=_0x12702b['user'],_0x55d4cd=_0x12702b[_0x5f154b(0x266)],_0x31baf8=await profile[_0x5f154b(0x1f4)]({'email':_0x55d4cd[_0x5f154b(0x293)]}),_0x162c59=await master_shop[_0x5f154b(0x1ad)](),_0x35d956=_0x12702b[_0x5f154b(0x1c9)]['id'],_0x4be6af=await purchases_finished[_0x5f154b(0x1e9)](_0x35d956);if(_0x162c59[0x0]['language']==_0x5f154b(0x292))var _0x327479=users[_0x5f154b(0x27c)];else{if(_0x162c59[0x0][_0x5f154b(0x1a8)]==_0x5f154b(0x244))var _0x327479=users[_0x5f154b(0x244)];else{if(_0x162c59[0x0]['language']==_0x5f154b(0x1c6))var _0x327479=users[_0x5f154b(0x1c6)];else{if(_0x162c59[0x0][_0x5f154b(0x1a8)]==_0x5f154b(0x1f1))var _0x327479=users['Spanish'];else{if(_0x162c59[0x0][_0x5f154b(0x1a8)]=='French')var _0x327479=users[_0x5f154b(0x1cc)];else{if(_0x162c59[0x0]['language']==_0x5f154b(0x20d))var _0x327479=users[_0x5f154b(0x221)];else{if(_0x162c59[0x0][_0x5f154b(0x1a8)]=='Chinese')var _0x327479=users[_0x5f154b(0x26f)];else{if(_0x162c59[0x0][_0x5f154b(0x1a8)]==_0x5f154b(0x222))var _0x327479=users['Arabic'];}}}}}}}_0x1d4cb1[_0x5f154b(0x1d1)]('all_purchases_barcode',{'success':_0x12702b['flash'](_0x5f154b(0x1dd)),'errors':_0x12702b[_0x5f154b(0x283)]('errors'),'role':_0x55d4cd,'profile':_0x31baf8,'alldata':_0x4be6af,'master_shop':_0x162c59,'language':_0x327479}),console['log'](alldata);}catch(_0x7fc00c){console[_0x5f154b(0x236)](_0x7fc00c);}}),router[a0_0x4b7d49(0x1f0)](a0_0x4b7d49(0x27d),async(_0x40b0a0,_0x3df946)=>{var _0x86a949=a0_0x4b7d49;const {product_code:_0x74f173}=_0x40b0a0[_0x86a949(0x1fe)];var _0x3b5a27;const _0x26a053=await product['aggregate']([{'$match':{'primary_code':_0x74f173,'product_category':_0x86a949(0x204)}},{'$group':{'_id':_0x86a949(0x23b),'name':{'$first':_0x86a949(0x1ae)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x86a949(0x1e0)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x86a949(0x24e)},'maxProdPerUnit':{'$first':_0x86a949(0x1b3)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x86a949(0x1c8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3a0188=await product['aggregate']([{'$match':{'secondary_code':_0x74f173}},{'$group':{'_id':_0x86a949(0x23b),'name':{'$first':'$name'},'category':{'$first':_0x86a949(0x26c)},'brand':{'$first':_0x86a949(0x256)},'unit':{'$first':_0x86a949(0x271)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x86a949(0x216)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x86a949(0x26a)},'maxStocks':{'$first':_0x86a949(0x24e)},'maxProdPerUnit':{'$first':_0x86a949(0x1b3)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x26a053[_0x86a949(0x247)]>0x0)_0x3b5a27=_0x26a053;else _0x3a0188[_0x86a949(0x247)]>0x0&&(_0x3b5a27=_0x3a0188);_0x3df946[_0x86a949(0x19f)](_0x3b5a27);}),router[a0_0x4b7d49(0x1f0)](a0_0x4b7d49(0x295),async(_0x1a4df3,_0x47357f)=>{var _0x25e29c=a0_0x4b7d49;const {productCode:_0xd8406a,bay:_0x5a88c0,warehouses:_0x3cf4d2,room:_0x1cd3ba}=_0x1a4df3[_0x25e29c(0x1fe)];console[_0x25e29c(0x236)](_0x1a4df3[_0x25e29c(0x1fe)]);try{const _0x58be87=await warehouse[_0x25e29c(0x299)]([{'$match':{'name':_0x3cf4d2,'room':_0x1cd3ba}},{'$unwind':_0x25e29c(0x1d9)},{'$match':{'product_details.bay':parseInt(_0x5a88c0)}},{'$group':{'_id':_0x25e29c(0x237),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x25e29c(0x250)},'maxProducts':{'$first':_0x25e29c(0x246)}}}]);_0x47357f[_0x25e29c(0x27b)](0xc8)[_0x25e29c(0x19f)](_0x58be87);}catch(_0x2eca50){_0x47357f[_0x25e29c(0x27b)](0x194)[_0x25e29c(0x19f)]({'message':_0x2eca50[_0x25e29c(0x1b2)]});}}),module[a0_0x4b7d49(0x24d)]=router;