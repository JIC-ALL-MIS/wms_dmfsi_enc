var a0_0x4f0836=a0_0x5f5b;(function(_0x187d09,_0x2ea303){var _0x59a299=a0_0x5f5b,_0x1ea56e=_0x187d09();while(!![]){try{var _0x317f88=-parseInt(_0x59a299(0x2b0))/0x1+parseInt(_0x59a299(0x1f6))/0x2+parseInt(_0x59a299(0x259))/0x3*(-parseInt(_0x59a299(0x261))/0x4)+parseInt(_0x59a299(0x2bb))/0x5*(parseInt(_0x59a299(0x2a0))/0x6)+parseInt(_0x59a299(0x243))/0x7*(parseInt(_0x59a299(0x225))/0x8)+parseInt(_0x59a299(0x27a))/0x9+parseInt(_0x59a299(0x231))/0xa*(-parseInt(_0x59a299(0x2af))/0xb);if(_0x317f88===_0x2ea303)break;else _0x1ea56e['push'](_0x1ea56e['shift']());}catch(_0x286cff){_0x1ea56e['push'](_0x1ea56e['shift']());}}}(a0_0x43af,0xbfb5d));const express=require(a0_0x4f0836(0x23f)),app=express(),router=express[a0_0x4f0836(0x2a6)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x4f0836(0x20f)),auth=require(a0_0x4f0836(0x242)),nodemailer=require(a0_0x4f0836(0x271));function a0_0x43af(){var _0x1c962b=['</table>','prod_secondunit','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','render','findById','product_details','$secondary_code','then','<tr>','<h2>\x20','$product.bin','RoomAssign','</tr>','../public/language/languages.json','return_qty','$product_details.product_stock','Purchase\x20Return\x20Mail','<div>','/view/add_purchases/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','DRY\x20GOODS','$product.floorlevel','gmail','<h5\x20style=\x22text-align:\x20left;\x22>','flash','Arabic','date','Rack\x201','padStart','<span\x20style=\x22float:\x20right;\x22>','1369544NYUkrh','/view','currency_placement','$product_details.floorlevel','$name','currency','English\x20(US)','/../public','<!DOCTYPE\x20html>','Ambient','find','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Purchase\x20Mail','<strong>\x20Regards\x20</strong>','/CheckingWarehouse','/view/:id','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product_details.bin','\x20Order\x20Date\x20:\x20','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','json','maxStocks','forEach','$expiry_date','../models/all_models','$unit','max_product_unit','get','findOne','$product_code','Logo.png','toString','role','Email\x20sent\x20successfully','\x20Order\x20Number\x20:\x20','prod_primunit','secondary_code_hide','<hr\x20class=\x22my-3\x22>','German','log','French','aggregate','Finished\x20Goods','body','warehouse','$invoice','2152MmylwE','</div>','$product.bay','<html><head><title></title>','name','room_name','save','Portuguese','$product_details.storage','product','expiry_date','product_code_hide','2470FIJJyZ','$date','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$alertquantity','edit_purchases_finished','product_date','email','\x20<>\x20','quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$due_amount','$suppliers_docs','/view/return_purchase/:id','express','add_purchases\x20error','$_id','../middleware/auth','37163IRmCKO','/upload/','stock_quantity','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/give_payment/:id','Room_name','/preview/:id','$product_details.bay','True','$product.type','Error\x20Occurs','Spanish','table\x20page','FGSEmail','all','Return\x20Goods','primary_code','product_name','language','updateOne','concat','abs','9yrslHQ','Arabic\x20(ae)','/barcode/:id','</h5>','$maxStocks','prod_cat','product_stock','purchase_invoice','1752068cdBPGQ','prod_qty','image','/all_purchases_finished/view','production_date','secondary_unit','bay','Chinese','room','floor','getDate','<h5>','prod_name','$primary_code','return_data','Enclosed','nodemailer','<table\x20style=\x22width:\x20100%\x20!important;\x22>','redirect','$note','staff','length','$category','params','standard_unit','4624821pkQqyU','$product_details.product_name','paid_amount','status','prod_level','message','user_id','/all_purchases/view','MaxStocks_data','warehouse_name','product_code','product_cat','stock_data','$product_details.rack','$return_data','post','$product.quantity','secondary_code','_id','$product_details._id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$suppliers','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','POnumber','suppliers_docs','password','$product','</td>','$paid_amount','error','purchases\x20item\x20return\x20successfull','catch','logo','Portuguese\x20(BR)','site_title','slice','master','createTransport','1243146uppuwL','user','stocks','return_product','Purchase\x20Return','</thead>','Router','$warehouse_name','/invoice/:id','back','errors','filter','$product_details.product_code','note','</body></html>','24343ojjMTn','1016810gmBhVW','</span>','$product_details.primary_code','Hindi','INCF-','suppliers','batch_code','$secondary_unit','</head><body>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','\x20</h2>','25YriVgQ','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','invoice','map','Enabled','prod_invoice','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','ejs','host','</tbody>','purchase\x20data\x20update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','purchase\x20data\x20add\x20successfully','FROZEN\x20GOODS','maxperunit','English','purchase_quantity','/view/add_purchases','prod_Qty','string','$brand','primary_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','prod_code','Error\x20occurred\x20while\x20processing\x20product:','path'];a0_0x43af=function(){return _0x1c962b;};return a0_0x43af();}var ejs=require(a0_0x4f0836(0x1c4));const path=require(a0_0x4f0836(0x1d6)),users=require(a0_0x4f0836(0x1e5));function a0_0x5f5b(_0x53b718,_0xebd251){var _0x43af2b=a0_0x43af();return a0_0x5f5b=function(_0x5f5b15,_0x4e3dd3){_0x5f5b15=_0x5f5b15-0x1bf;var _0x4bd3e9=_0x43af2b[_0x5f5b15];return _0x4bd3e9;},a0_0x5f5b(_0x53b718,_0xebd251);}router['get'](a0_0x4f0836(0x1f7),auth,async(_0x26c35c,_0x685e40)=>{var _0x353ef5=a0_0x4f0836;try{const {username:_0x173e91,email:_0x2fdc18,role:_0x368bba}=_0x26c35c[_0x353ef5(0x2a1)],_0x4b57f5=_0x26c35c[_0x353ef5(0x2a1)],_0x2afa18=await profile['findOne']({'email':_0x4b57f5['email']}),_0x370484=await staff[_0x353ef5(0x213)]({'email':_0x4b57f5[_0x353ef5(0x238)]});if(_0x4b57f5[_0x353ef5(0x217)]==_0x353ef5(0x275)){const _0x5612ca=await staff[_0x353ef5(0x213)]({'email':_0x4b57f5[_0x353ef5(0x238)]});}const _0x29c61d=await master_shop[_0x353ef5(0x200)]();let _0x56d8b2;if(_0x4b57f5[_0x353ef5(0x217)]==_0x353ef5(0x275)){const _0x288c4c=await staff[_0x353ef5(0x213)]({'email':_0x4b57f5[_0x353ef5(0x238)]});_0x56d8b2=await purchases_finished[_0x353ef5(0x220)]([{'$match':{'warehouse_name':_0x288c4c['warehouse']}},{'$lookup':{'from':_0x353ef5(0x2b5),'localField':_0x353ef5(0x2b5),'foreignField':_0x353ef5(0x229),'as':_0x353ef5(0x292)}},{'$unwind':_0x353ef5(0x23d)},{'$unwind':_0x353ef5(0x294)},{'$group':{'_id':_0x353ef5(0x241),'invoice':{'$first':_0x353ef5(0x224)},'suppliers':{'$first':_0x353ef5(0x28f)},'date':{'$first':_0x353ef5(0x232)},'warehouse_name':{'$first':_0x353ef5(0x2a7)},'room':{'$first':'$room'},'product':{'$push':_0x353ef5(0x294)},'note':{'$first':_0x353ef5(0x274)},'paid_amount':{'$first':_0x353ef5(0x296)},'due_amount':{'$first':_0x353ef5(0x23c)},'return_data':{'$first':_0x353ef5(0x288)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x353ef5(0x23d)},'total_product_quantity':{'$sum':_0x353ef5(0x28a)},'level':{'$addToSet':_0x353ef5(0x227)},'isle':{'$addToSet':_0x353ef5(0x1e2)},'type':{'$addToSet':_0x353ef5(0x24c)},'floorlevel':{'$addToSet':_0x353ef5(0x1ed)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x56d8b2=await purchases_finished[_0x353ef5(0x220)]([{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x353ef5(0x2a7)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x353ef5(0x274)},'paid_amount':{'$first':_0x353ef5(0x296)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x353ef5(0x20e)},'suppliers_docs':{'$first':_0x353ef5(0x23d)},'total_product_quantity':{'$sum':_0x353ef5(0x28a)},'level':{'$addToSet':_0x353ef5(0x227)},'isle':{'$addToSet':_0x353ef5(0x1e2)},'type':{'$addToSet':_0x353ef5(0x24c)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x29c61d[0x0][_0x353ef5(0x255)]==_0x353ef5(0x1fc))var _0x5616a2=users[_0x353ef5(0x1cc)];else{if(_0x29c61d[0x0]['language']==_0x353ef5(0x2b3))var _0x5616a2=users[_0x353ef5(0x2b3)];else{if(_0x29c61d[0x0][_0x353ef5(0x255)]=='German')var _0x5616a2=users['German'];else{if(_0x29c61d[0x0][_0x353ef5(0x255)]==_0x353ef5(0x24e))var _0x5616a2=users['Spanish'];else{if(_0x29c61d[0x0][_0x353ef5(0x255)]=='French')var _0x5616a2=users[_0x353ef5(0x21f)];else{if(_0x29c61d[0x0][_0x353ef5(0x255)]==_0x353ef5(0x29b))var _0x5616a2=users[_0x353ef5(0x22c)];else{if(_0x29c61d[0x0][_0x353ef5(0x255)]==_0x353ef5(0x268))var _0x5616a2=users['Chinese'];else{if(_0x29c61d[0x0][_0x353ef5(0x255)]==_0x353ef5(0x25a))var _0x5616a2=users[_0x353ef5(0x1f1)];}}}}}}}_0x685e40[_0x353ef5(0x1db)]('all_purchases_finished',{'success':_0x26c35c[_0x353ef5(0x1f0)](_0x353ef5(0x233)),'errors':_0x26c35c[_0x353ef5(0x1f0)](_0x353ef5(0x2aa)),'purchases':_0x56d8b2,'role':_0x4b57f5,'profile':_0x2afa18,'master_shop':_0x29c61d,'language':_0x5616a2});}catch(_0x36de70){console[_0x353ef5(0x21e)](_0x353ef5(0x24f),_0x36de70),_0x685e40[_0x353ef5(0x27d)](0xc8)['json']({'message':_0x36de70[_0x353ef5(0x27f)]});}});function BayBinSelected(_0x3e6e2b,_0x5e4eed){var _0x39b0c6=a0_0x4f0836,_0x4506cc=[],_0x3fb278=[];if(_0x3e6e2b==_0x39b0c6(0x1ec)){switch(_0x5e4eed){case _0x39b0c6(0x1f3):_0x4506cc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x4506cc=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3fb278=['DG'];}else{if(_0x3e6e2b==_0x39b0c6(0x1ca)){switch(_0x5e4eed){case _0x39b0c6(0x1f3):_0x4506cc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x4506cc=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3fb278=['FG'];}}return{'levels':_0x4506cc,'identify':_0x3fb278};}async function getRandom8DigitNumber(){var _0x309c1d=a0_0x4f0836;const _0x4d6716=0x989680,_0x1a5e2d=0x5f5e0ff,_0x3cea57=Math[_0x309c1d(0x26a)](Math['random']()*(_0x1a5e2d-_0x4d6716+0x1))+_0x4d6716;var _0x4dd9a0;const _0x5f20be=await purchases_finished[_0x309c1d(0x213)]({'invoice':_0x309c1d(0x2b4)+_0x3cea57});return _0x5f20be&&_0x5f20be[_0x309c1d(0x276)]>0x0?_0x4dd9a0=_0x309c1d(0x2b4)+_0x3cea57:_0x4dd9a0=_0x309c1d(0x2b4)+_0x3cea57,_0x4dd9a0;}router[a0_0x4f0836(0x212)]('/view/add_purchases',auth,async(_0x1e71d8,_0x15e9f5)=>{var _0x6ea3f=a0_0x4f0836;try{const {username:_0x170fbb,email:_0x36de53,role:_0x32fb0b}=_0x1e71d8[_0x6ea3f(0x2a1)],_0x30d2cf=_0x1e71d8[_0x6ea3f(0x2a1)],_0x1a3f52=await profile['findOne']({'email':_0x30d2cf[_0x6ea3f(0x238)]}),_0x2d6c0d=await master_shop[_0x6ea3f(0x200)](),_0x11da30=await staff[_0x6ea3f(0x213)]({'email':_0x30d2cf['email']}),_0x26acf4=await suppliers[_0x6ea3f(0x200)]({});let _0x26cdf4;if(_0x30d2cf[_0x6ea3f(0x217)]==_0x6ea3f(0x275)){const _0x569e8d=await staff[_0x6ea3f(0x213)]({'email':_0x30d2cf['email']});_0x26cdf4=await warehouse[_0x6ea3f(0x220)]([{'$match':{'status':'Enabled','name':_0x569e8d[_0x6ea3f(0x223)],'warehouse_category':_0x6ea3f(0x221)}},{'$group':{'_id':'$name','name':{'$first':_0x6ea3f(0x1fa)}}}]);}else _0x26cdf4=await warehouse[_0x6ea3f(0x220)]([{'$match':{'status':_0x6ea3f(0x1c1),'warehouse_category':_0x6ea3f(0x221),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x472bd6=await product[_0x6ea3f(0x200)]({}),_0x5876d9=await warehouse[_0x6ea3f(0x200)]({'status':_0x6ea3f(0x1c1)}),_0x4dc096=await purchases_finished[_0x6ea3f(0x200)]({}),_0x3d6f9a=_0x4dc096[_0x6ea3f(0x276)]+0x1,_0x969563=_0x6ea3f(0x2b4)+_0x3d6f9a[_0x6ea3f(0x216)]()[_0x6ea3f(0x1f4)](0x5,'0');var _0x526e35=[_0x6ea3f(0x1ff),_0x6ea3f(0x270)];if(_0x2d6c0d[0x0][_0x6ea3f(0x255)]==_0x6ea3f(0x1fc))var _0x8a8d93=users[_0x6ea3f(0x1cc)];else{if(_0x2d6c0d[0x0][_0x6ea3f(0x255)]==_0x6ea3f(0x2b3))var _0x8a8d93=users[_0x6ea3f(0x2b3)];else{if(_0x2d6c0d[0x0][_0x6ea3f(0x255)]==_0x6ea3f(0x21d))var _0x8a8d93=users[_0x6ea3f(0x21d)];else{if(_0x2d6c0d[0x0]['language']==_0x6ea3f(0x24e))var _0x8a8d93=users[_0x6ea3f(0x24e)];else{if(_0x2d6c0d[0x0][_0x6ea3f(0x255)]==_0x6ea3f(0x21f))var _0x8a8d93=users[_0x6ea3f(0x21f)];else{if(_0x2d6c0d[0x0][_0x6ea3f(0x255)]==_0x6ea3f(0x29b))var _0x8a8d93=users[_0x6ea3f(0x22c)];else{if(_0x2d6c0d[0x0]['language']==_0x6ea3f(0x268))var _0x8a8d93=users[_0x6ea3f(0x268)];else{if(_0x2d6c0d[0x0][_0x6ea3f(0x255)]==_0x6ea3f(0x25a))var _0x8a8d93=users[_0x6ea3f(0x1f1)];}}}}}}}const _0x37bfe0=getRandom8DigitNumber();_0x37bfe0[_0x6ea3f(0x1df)](_0x537a69=>{var _0x25365a=_0x6ea3f;_0x15e9f5[_0x25365a(0x1db)]('add_purchases_finished',{'success':_0x1e71d8[_0x25365a(0x1f0)](_0x25365a(0x233)),'errors':_0x1e71d8[_0x25365a(0x1f0)](_0x25365a(0x2aa)),'role':_0x30d2cf,'profile':_0x1a3f52,'suppliers':_0x26acf4,'warehouse':_0x26cdf4,'product':_0x472bd6,'invoice':_0x537a69,'master_shop':_0x2d6c0d,'language':_0x8a8d93,'find_data':_0x5876d9,'rooms_data':_0x526e35});})[_0x6ea3f(0x299)](_0xff958c=>{var _0x3cc8e8=_0x6ea3f;_0x1e71d8[_0x3cc8e8(0x1f0)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x15e9f5[_0x3cc8e8(0x273)](_0x3cc8e8(0x264));});}catch(_0x427f23){console[_0x6ea3f(0x21e)](_0x427f23);}}),router[a0_0x4f0836(0x212)](a0_0x4f0836(0x1ea),auth,async(_0x2da6f6,_0x48cbd5)=>{var _0x408a2c=a0_0x4f0836;try{const _0x40a49e=_0x2da6f6[_0x408a2c(0x278)]['id'];console[_0x408a2c(0x21e)](_0x40a49e);const _0x45ae0d=await master_shop[_0x408a2c(0x200)]();console[_0x408a2c(0x21e)]('master',_0x45ae0d);const _0x4d21b9=await product['findOne']({'name':_0x40a49e});console['log'](_0x408a2c(0x22e),_0x4d21b9),_0x48cbd5['status'](0xc8)[_0x408a2c(0x20b)]({'product_data':_0x4d21b9,'master':_0x45ae0d});}catch(_0x4e2a31){console[_0x408a2c(0x21e)](_0x408a2c(0x240),_0x4e2a31);}}),router['post'](a0_0x4f0836(0x1ce),auth,async(_0x2fc30e,_0x1bed10)=>{var _0x31cb18=a0_0x4f0836;try{const {invoice:_0x334fcd,date:_0x379234,warehouse_name:_0x421301,prod_name:_0x2e42a2,prod_code:_0x3430ad,prod_qty:_0x5499a1,prod_unit:_0x595969,prod_secondunit:_0xc7e66e,prod_level:_0x1dc8ef,prod_isle:_0x1c2df2,prod_pallet:_0x3bd962,note:_0x484899,expiry_date:_0x127799,batch_code:_0x2f9d17,payable:_0x36fc7a,due_amount:_0x20a3b0,Room_name:_0x4e1a05,primary_code:_0x37b05b,secondary_code:_0x7fd303,MaxStocks_data:_0x536fa7,PO_number:_0x274d96,SCRN:_0x3c0922,JO_number:_0x34e570}=_0x2fc30e[_0x31cb18(0x222)];if(typeof _0x2e42a2==_0x31cb18(0x1d0))var _0x1e7a87=[_0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x26d)]],_0x43dccc=[_0x2fc30e['body']['prod_code']],_0x1359e7=[_0x2fc30e[_0x31cb18(0x222)]['prod_Qty']],_0x38d886=[_0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x21a)]],_0x4512af=[_0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x1d8)]],_0x2c5af0=[_0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x27e)]],_0x6df0a7=[_0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x253)]],_0x90e6ee=[_0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x28b)]],_0x111304=[_0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x282)]],_0x3eae35=[_0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x2b6)]],_0x3bd7d1=[_0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x22f)]],_0x11a08b=[_0x2fc30e['body']['product_date']],_0x499906=[_0x2fc30e['body'][_0x31cb18(0x211)]],_0x37f3e6=[_0x2fc30e['body'][_0x31cb18(0x25e)]],_0x261dc8=[_0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x1e3)]],_0x4dc988=[_0x2fc30e['body'][_0x31cb18(0x1c2)]];else var _0x1e7a87=[..._0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x26d)]],_0x43dccc=[..._0x2fc30e[_0x31cb18(0x222)]['prod_code']],_0x1359e7=[..._0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x1cf)]],_0x38d886=[..._0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x21a)]],_0x4512af=[..._0x2fc30e['body'][_0x31cb18(0x1d8)]],_0x2c5af0=[..._0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x27e)]],_0x6df0a7=[..._0x2fc30e[_0x31cb18(0x222)]['primary_code']],_0x90e6ee=[..._0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x28b)]],_0x111304=[..._0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x282)]],_0x3eae35=[..._0x2fc30e['body'][_0x31cb18(0x2b6)]],_0x3bd7d1=[..._0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x22f)]],_0x11a08b=[..._0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x237)]],_0x499906=[..._0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x211)]],_0x37f3e6=[..._0x2fc30e['body'][_0x31cb18(0x25e)]],_0x261dc8=[..._0x2fc30e['body']['RoomAssign']],_0x4dc988=[..._0x2fc30e[_0x31cb18(0x222)][_0x31cb18(0x1c2)]];const _0x5c0e11=_0x1e7a87[_0x31cb18(0x1c0)](_0x30fb55=>{return _0x30fb55={'product_name':_0x30fb55};});_0x43dccc['forEach']((_0x4e03fb,_0x5ea7e8)=>{var _0x29accf=_0x31cb18;_0x5c0e11[_0x5ea7e8][_0x29accf(0x284)]=_0x4e03fb;}),_0x1359e7[_0x31cb18(0x20d)]((_0x2ebec6,_0x1d262b)=>{var _0x1d3a6c=_0x31cb18;_0x5c0e11[_0x1d262b][_0x1d3a6c(0x23a)]=Math[_0x1d3a6c(0x258)](_0x2ebec6);}),_0x38d886['forEach']((_0x51419c,_0x70b752)=>{var _0x133090=_0x31cb18;_0x5c0e11[_0x70b752][_0x133090(0x279)]=_0x51419c;}),_0x4512af[_0x31cb18(0x20d)]((_0x31e4fb,_0x57ae39)=>{_0x5c0e11[_0x57ae39]['secondary_unit']=_0x31e4fb;}),_0x2c5af0['forEach']((_0x3a2c5e,_0x8a5838)=>{_0x5c0e11[_0x8a5838]['bay']=_0x3a2c5e;}),_0x6df0a7[_0x31cb18(0x20d)]((_0xd39ec6,_0x56510b)=>{var _0xf9850=_0x31cb18;_0x5c0e11[_0x56510b][_0xf9850(0x253)]=_0xd39ec6;}),_0x90e6ee['forEach']((_0xc2288,_0x1be7b0)=>{_0x5c0e11[_0x1be7b0]['secondary_code']=_0xc2288;}),_0x111304[_0x31cb18(0x20d)]((_0x3ff3bb,_0x329a5d)=>{var _0x2c72b9=_0x31cb18;_0x5c0e11[_0x329a5d][_0x2c72b9(0x20c)]=_0x3ff3bb;}),_0x3eae35['forEach']((_0x589d18,_0x5da3ce)=>{var _0x28c4b2=_0x31cb18;_0x5c0e11[_0x5da3ce][_0x28c4b2(0x2b6)]=_0x589d18;}),_0x3bd7d1[_0x31cb18(0x20d)]((_0x5ee74e,_0x10d383)=>{var _0x4bd3d6=_0x31cb18;_0x5c0e11[_0x10d383][_0x4bd3d6(0x22f)]=_0x5ee74e;}),_0x11a08b[_0x31cb18(0x20d)]((_0x91d4e9,_0xaa234c)=>{var _0x446852=_0x31cb18;_0x5c0e11[_0xaa234c][_0x446852(0x265)]=_0x91d4e9;}),_0x499906[_0x31cb18(0x20d)]((_0x5ac74d,_0x45f444)=>{var _0x54c55b=_0x31cb18;_0x5c0e11[_0x45f444][_0x54c55b(0x1cb)]=_0x5ac74d;}),_0x37f3e6[_0x31cb18(0x20d)]((_0x3c7228,_0x59b6c2)=>{var _0x603154=_0x31cb18;_0x5c0e11[_0x59b6c2][_0x603154(0x285)]=_0x3c7228;}),_0x261dc8[_0x31cb18(0x20d)]((_0x261194,_0xad27a1)=>{var _0x57f580=_0x31cb18;_0x5c0e11[_0xad27a1][_0x57f580(0x22a)]=_0x261194;}),_0x4dc988['forEach']((_0x3ebc81,_0x4eca5f)=>{var _0x2099ca=_0x31cb18;_0x5c0e11[_0x4eca5f][_0x2099ca(0x1bf)]=_0x3ebc81;});const _0x1f25de=_0x5c0e11['filter'](_0x1dc98d=>_0x1dc98d[_0x31cb18(0x23a)]!=='0'&&_0x1dc98d[_0x31cb18(0x23a)]!==''),_0x28e2fb=new purchases_finished({'invoice':_0x334fcd,'suppliers':_0x2fc30e['body'][_0x31cb18(0x2b5)],'date':_0x379234,'warehouse_name':_0x421301,'product':_0x1f25de,'note':_0x484899,'due_amount':_0x20a3b0,'room':_0x4e1a05,'POnumber':_0x274d96,'SCRN':_0x3c0922,'JO_number':_0x34e570}),_0x71ac67=await _0x28e2fb[_0x31cb18(0x22b)](),_0x5d9604=await purchases_finished[_0x31cb18(0x213)]({'invoice':_0x334fcd}),_0x5677bd=_0x5d9604[_0x31cb18(0x22e)][_0x31cb18(0x1c0)](async _0x9958fe=>{var _0x33af87=_0x31cb18;try{var _0x244afd=await warehouse[_0x33af87(0x213)]({'name':_0x421301,'room':_0x9958fe[_0x33af87(0x22a)]}),_0x199ff4=0x0;const _0x44d8f6=_0x244afd[_0x33af87(0x1dd)][_0x33af87(0x1c0)](_0x3aec9f=>{var _0x122b7b=_0x33af87;console['log'](_0x3aec9f['product_name']+'=='+_0x9958fe[_0x122b7b(0x254)]+'&&'+_0x3aec9f[_0x122b7b(0x267)]+'=='+_0x9958fe[_0x122b7b(0x267)]+'&&'+_0x3aec9f[_0x122b7b(0x22f)]+'=='+_0x9958fe[_0x122b7b(0x22f)]+'&&'+_0x3aec9f[_0x122b7b(0x265)]+'=='+_0x9958fe['production_date']+'&&'+_0x3aec9f[_0x122b7b(0x2b6)]+'=='+_0x9958fe[_0x122b7b(0x2b6)]+'&&'+_0x3aec9f[_0x122b7b(0x1bf)]+'=='+_0x5d9604['invoice']),_0x3aec9f[_0x122b7b(0x254)]==_0x9958fe[_0x122b7b(0x254)]&&_0x3aec9f['bay']==_0x9958fe[_0x122b7b(0x267)]&&_0x3aec9f['expiry_date']==_0x9958fe[_0x122b7b(0x22f)]&&_0x3aec9f[_0x122b7b(0x265)]==_0x9958fe[_0x122b7b(0x265)]&&_0x3aec9f[_0x122b7b(0x2b6)]==_0x9958fe['batch_code']&&_0x3aec9f[_0x122b7b(0x1bf)]==_0x5d9604[_0x122b7b(0x1bf)]&&(_0x3aec9f[_0x122b7b(0x25f)]=Math['abs'](_0x3aec9f[_0x122b7b(0x25f)])+Math[_0x122b7b(0x258)](_0x9958fe[_0x122b7b(0x23a)]),_0x199ff4++);});return _0x199ff4==0x0&&(_0x244afd[_0x33af87(0x1dd)]=_0x244afd['product_details'][_0x33af87(0x257)]({'product_name':_0x9958fe[_0x33af87(0x254)],'product_stock':Math['abs'](_0x9958fe['quantity']),'primary_code':_0x9958fe[_0x33af87(0x253)],'secondary_code':_0x9958fe[_0x33af87(0x28b)],'product_code':_0x9958fe['product_code'],'bay':_0x9958fe[_0x33af87(0x267)],'maxProducts':_0x9958fe[_0x33af87(0x20c)],'unit':_0x9958fe[_0x33af87(0x279)],'secondary_unit':_0x9958fe[_0x33af87(0x266)],'expiry_date':_0x9958fe['expiry_date'],'production_date':_0x9958fe[_0x33af87(0x265)],'maxProducts':_0x9958fe[_0x33af87(0x20c)],'maxPerUnit':_0x9958fe['maxperunit'],'batch_code':_0x9958fe[_0x33af87(0x2b6)],'product_cat':_0x9958fe[_0x33af87(0x285)],'invoice':_0x9958fe['invoice'],'id_incoming':_0x9958fe[_0x33af87(0x28c)]})),_0x244afd;}catch(_0x110fcc){return console[_0x33af87(0x297)](_0x33af87(0x1d5),_0x110fcc),null;}});Promise[_0x31cb18(0x251)](_0x5677bd)['then'](async _0xe99438=>{var _0x2f7b29=_0x31cb18;try{for(const _0x2dc27f of _0xe99438){await warehouse[_0x2f7b29(0x256)]({'_id':_0x2dc27f['_id']},{'$addToSet':{'product_details':{'$each':_0x2dc27f[_0x2f7b29(0x1dd)]}}});}const _0x8a6364=await master_shop[_0x2f7b29(0x200)](),_0x3a713a=await email_settings['findOne'](),_0x2ded12=await supervisor_settings[_0x2f7b29(0x200)]();var _0x232b2d=_0x5d9604[_0x2f7b29(0x22e)],_0x878b22='',_0x29a2b5;for(_0x29a2b5 in _0x232b2d){var _0x3a2ff1='FG';_0x5d9604['warehouse_name']==_0x2f7b29(0x1ec)&&(_0x3a2ff1='DG'),_0x878b22+=_0x2f7b29(0x1e0)+_0x2f7b29(0x2b9)+_0x232b2d[_0x29a2b5][_0x2f7b29(0x254)]+_0x2f7b29(0x295)+_0x2f7b29(0x2b9)+_0x232b2d[_0x29a2b5][_0x2f7b29(0x284)]+_0x2f7b29(0x295)+_0x2f7b29(0x2b9)+_0x232b2d[_0x29a2b5][_0x2f7b29(0x23a)]+_0x2f7b29(0x295)+_0x2f7b29(0x2b9)+_0x232b2d[_0x29a2b5][_0x2f7b29(0x279)]+_0x2f7b29(0x295)+_0x2f7b29(0x2b9)+_0x232b2d[_0x29a2b5][_0x2f7b29(0x266)]+_0x2f7b29(0x295)+_0x2f7b29(0x2b9)+_0x5d9604[_0x2f7b29(0x283)]+_0x2f7b29(0x295)+_0x2f7b29(0x2b9)+_0x232b2d[_0x29a2b5][_0x2f7b29(0x22a)]+_0x2f7b29(0x295)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a2ff1+_0x232b2d[_0x29a2b5][_0x2f7b29(0x267)]+_0x2f7b29(0x295),_0x2f7b29(0x1e4);}let _0x144c5e=nodemailer['createTransport']({'host':_0x3a713a[_0x2f7b29(0x1c5)],'port':Number(_0x3a713a['port']),'secure':![],'auth':{'user':_0x3a713a[_0x2f7b29(0x238)],'pass':_0x3a713a['password']}}),_0x4c2a7e={'from':_0x3a713a[_0x2f7b29(0x238)],'to':_0x2ded12[0x0][_0x2f7b29(0x250)],'subject':_0x2f7b29(0x203),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2f7b29(0x1fd)+_0x2f7b29(0x244)+_0x8a6364[0x0][_0x2f7b29(0x263)],'cid':_0x2f7b29(0x29a)}],'html':_0x2f7b29(0x1fe)+_0x2f7b29(0x228)+'</head><body>'+_0x2f7b29(0x1e9)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2f7b29(0x1e9)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2f7b29(0x226)+_0x2f7b29(0x1e9)+_0x2f7b29(0x1e1)+_0x8a6364[0x0]['site_title']+_0x2f7b29(0x2ba)+_0x2f7b29(0x226)+'</div>'+_0x2f7b29(0x21c)+_0x2f7b29(0x1e9)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2f7b29(0x219)+_0x5d9604['invoice']+'\x20'+_0x2f7b29(0x1f5)+_0x2f7b29(0x209)+_0x5d9604[_0x2f7b29(0x1f2)]+'\x20'+_0x2f7b29(0x2b1)+_0x2f7b29(0x25c)+'</div>'+_0x2f7b29(0x272)+_0x2f7b29(0x20a)+_0x2f7b29(0x1e0)+_0x2f7b29(0x23b)+_0x2f7b29(0x28e)+_0x2f7b29(0x1c8)+_0x2f7b29(0x1da)+_0x2f7b29(0x290)+_0x2f7b29(0x1d3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x2f7b29(0x2bc)+'</tr>'+_0x2f7b29(0x2a5)+_0x2f7b29(0x1eb)+'\x20'+_0x878b22+'\x20'+_0x2f7b29(0x1c6)+_0x2f7b29(0x1d7)+_0x2f7b29(0x1e9)+_0x2f7b29(0x204)+_0x2f7b29(0x26c)+_0x8a6364[0x0]['site_title']+'</h5>'+_0x2f7b29(0x226)+'</div>'+_0x2f7b29(0x2ae)};_0x144c5e['sendMail'](_0x4c2a7e,function(_0x5b5bed,_0x5354a9){var _0x4c55c2=_0x2f7b29;_0x5b5bed?(console['log'](_0x5b5bed),console[_0x4c55c2(0x21e)](_0x4c55c2(0x24d))):console[_0x4c55c2(0x21e)](_0x4c55c2(0x218));});}catch(_0x71abd8){console[_0x2f7b29(0x297)](_0x71abd8),_0x1bed10['status'](0x1f4)[_0x2f7b29(0x20b)]({'error':_0x2f7b29(0x1d9),'message':_0x71abd8[_0x2f7b29(0x27f)]});}})[_0x31cb18(0x299)](_0x4ab5c1=>{var _0x4c39cd=_0x31cb18;console[_0x4c39cd(0x297)](_0x4ab5c1);}),_0x2fc30e[_0x31cb18(0x1f0)](_0x31cb18(0x233),_0x31cb18(0x1c9)),_0x1bed10[_0x31cb18(0x273)](_0x31cb18(0x264));}catch(_0x1cb71e){console[_0x31cb18(0x21e)](_0x1cb71e);}}),router['get'](a0_0x4f0836(0x249),auth,async(_0x4785ff,_0x5d68e0)=>{var _0x186364=a0_0x4f0836;try{const {username:_0x11f1c1,email:_0xc2f94a,role:_0x5b38e7}=_0x4785ff['user'],_0x1f43a5=_0x4785ff[_0x186364(0x2a1)],_0x33488c=await profile['findOne']({'email':_0x1f43a5[_0x186364(0x238)]}),_0x2db83a=await master_shop['find'](),_0x2748ad=_0x4785ff[_0x186364(0x278)]['id'],_0x8e39cc=await purchases_finished[_0x186364(0x1dc)](_0x2748ad),_0x4ff7e0=await suppliers['find']({});let _0x4ff4b6;if(_0x1f43a5['role']==_0x186364(0x275)){const _0x4ef6b6=await staff[_0x186364(0x213)]({'email':_0x1f43a5[_0x186364(0x238)]});_0x4ff4b6=await warehouse[_0x186364(0x200)]({'status':'Enabled','name':_0x4ef6b6[_0x186364(0x223)],'warehouse_category':_0x186364(0x221)});}else _0x4ff4b6=await warehouse['aggregate']([{'$match':{'status':_0x186364(0x1c1),'warehouse_category':_0x186364(0x221)}},{'$group':{'_id':_0x186364(0x1fa),'name':{'$first':_0x186364(0x1fa)}}}]);const _0x997e27=await product[_0x186364(0x200)]({}),_0xc9ab60=BayBinSelected(_0x8e39cc['warehouse_name'],_0x8e39cc[_0x186364(0x269)]);let _0x4b59ab=new Date(_0x8e39cc[_0x186364(0x22f)]),_0x7fe89e=('0'+_0x4b59ab[_0x186364(0x26b)]())['slice'](-0x2),_0x51f1b7=('0'+(_0x4b59ab['getMonth']()+0x1))[_0x186364(0x29d)](-0x2),_0x275e31=_0x4b59ab['getFullYear'](),_0x4edd47=_0x275e31+'-'+_0x51f1b7+'-'+_0x7fe89e;if(_0x2db83a[0x0]['language']==_0x186364(0x1fc)){var _0x30c1d8=users['English'];console['log'](_0x30c1d8);}else{if(_0x2db83a[0x0][_0x186364(0x255)]=='Hindi')var _0x30c1d8=users[_0x186364(0x2b3)];else{if(_0x2db83a[0x0][_0x186364(0x255)]==_0x186364(0x21d))var _0x30c1d8=users['German'];else{if(_0x2db83a[0x0][_0x186364(0x255)]==_0x186364(0x24e))var _0x30c1d8=users[_0x186364(0x24e)];else{if(_0x2db83a[0x0]['language']==_0x186364(0x21f))var _0x30c1d8=users[_0x186364(0x21f)];else{if(_0x2db83a[0x0][_0x186364(0x255)]=='Portuguese\x20(BR)')var _0x30c1d8=users['Portuguese'];else{if(_0x2db83a[0x0]['language']==_0x186364(0x268))var _0x30c1d8=users['Chinese'];else{if(_0x2db83a[0x0][_0x186364(0x255)]=='Arabic\x20(ae)')var _0x30c1d8=users['Arabic'];}}}}}}}_0x5d68e0['render']('edit_purchases_finished_view',{'success':_0x4785ff[_0x186364(0x1f0)](_0x186364(0x233)),'errors':_0x4785ff[_0x186364(0x1f0)](_0x186364(0x2aa)),'role':_0x1f43a5,'profile':_0x33488c,'purchases':_0x8e39cc,'suppliers':_0x4ff7e0,'warehouse':_0x4ff4b6,'product':_0x997e27,'master_shop':_0x2db83a,'language':_0x30c1d8,'ed_fullDate':_0x4edd47,'dataSelected':_0xc9ab60});}catch(_0xd06f09){console[_0x186364(0x21e)](_0xd06f09);}}),router['get']('/view/:id',auth,async(_0xec1c87,_0x4ec56e)=>{var _0x171bee=a0_0x4f0836;try{const {username:_0x2ee126,email:_0x1ffda2,role:_0x13398c}=_0xec1c87[_0x171bee(0x2a1)],_0x26d873=_0xec1c87['user'],_0xbb257d=await profile[_0x171bee(0x213)]({'email':_0x26d873[_0x171bee(0x238)]}),_0x56237f=await master_shop[_0x171bee(0x200)](),_0x496c51=_0xec1c87['params']['id'],_0x1b6da0=await purchases_finished[_0x171bee(0x1dc)](_0x496c51),_0x3339bf=await suppliers[_0x171bee(0x200)]({});let _0x1c5400;if(_0x26d873[_0x171bee(0x217)]==_0x171bee(0x275)){const _0x8bea42=await staff[_0x171bee(0x213)]({'email':_0x26d873[_0x171bee(0x238)]});_0x1c5400=await warehouse[_0x171bee(0x200)]({'status':_0x171bee(0x1c1),'name':_0x8bea42[_0x171bee(0x223)],'warehouse_category':_0x171bee(0x221)});}else _0x1c5400=await warehouse[_0x171bee(0x220)]([{'$match':{'status':'Enabled','warehouse_category':_0x171bee(0x221)}},{'$group':{'_id':_0x171bee(0x1fa),'name':{'$first':_0x171bee(0x1fa)}}}]);const _0x27a681=await product[_0x171bee(0x200)]({}),_0x861582=BayBinSelected(_0x1b6da0[_0x171bee(0x283)],_0x1b6da0[_0x171bee(0x269)]);let _0x1bd680=new Date(_0x1b6da0[_0x171bee(0x22f)]),_0x3487c6=('0'+_0x1bd680[_0x171bee(0x26b)]())[_0x171bee(0x29d)](-0x2),_0x770fe4=('0'+(_0x1bd680['getMonth']()+0x1))[_0x171bee(0x29d)](-0x2),_0x4235e3=_0x1bd680[_0x171bee(0x201)](),_0x22b9d7=_0x4235e3+'-'+_0x770fe4+'-'+_0x3487c6;if(_0x56237f[0x0][_0x171bee(0x255)]=='English\x20(US)'){var _0x40181f=users[_0x171bee(0x1cc)];console[_0x171bee(0x21e)](_0x40181f);}else{if(_0x56237f[0x0][_0x171bee(0x255)]==_0x171bee(0x2b3))var _0x40181f=users[_0x171bee(0x2b3)];else{if(_0x56237f[0x0][_0x171bee(0x255)]==_0x171bee(0x21d))var _0x40181f=users[_0x171bee(0x21d)];else{if(_0x56237f[0x0][_0x171bee(0x255)]==_0x171bee(0x24e))var _0x40181f=users['Spanish'];else{if(_0x56237f[0x0]['language']==_0x171bee(0x21f))var _0x40181f=users[_0x171bee(0x21f)];else{if(_0x56237f[0x0][_0x171bee(0x255)]==_0x171bee(0x29b))var _0x40181f=users[_0x171bee(0x22c)];else{if(_0x56237f[0x0]['language']==_0x171bee(0x268))var _0x40181f=users['Chinese'];else{if(_0x56237f[0x0][_0x171bee(0x255)]==_0x171bee(0x25a))var _0x40181f=users[_0x171bee(0x1f1)];}}}}}}}_0x4ec56e[_0x171bee(0x1db)](_0x171bee(0x236),{'success':_0xec1c87[_0x171bee(0x1f0)](_0x171bee(0x233)),'errors':_0xec1c87['flash'](_0x171bee(0x2aa)),'role':_0x26d873,'profile':_0xbb257d,'purchases':_0x1b6da0,'suppliers':_0x3339bf,'warehouse':_0x1c5400,'product':_0x27a681,'master_shop':_0x56237f,'language':_0x40181f,'ed_fullDate':_0x22b9d7,'dataSelected':_0x861582});}catch(_0x28c6e6){console[_0x171bee(0x21e)](_0x28c6e6);}}),router['post'](a0_0x4f0836(0x206),auth,async(_0x141ca6,_0x404073)=>{var _0x42e79c=a0_0x4f0836;try{const _0x55e869=_0x141ca6['params']['id'],_0x5cce53=await purchases_finished[_0x42e79c(0x213)]({'_id':_0x141ca6[_0x42e79c(0x278)]['id']}),_0x6eca5c=await warehouse[_0x42e79c(0x213)]({'name':_0x5cce53[_0x42e79c(0x283)],'room':_0x5cce53['room']});_0x5cce53[_0x42e79c(0x22e)]['forEach'](_0x458f71=>{var _0x519491=_0x42e79c;const _0x4237c5=_0x6eca5c[_0x519491(0x1dd)][_0x519491(0x1c0)](_0x158221=>{var _0xc9c7fc=_0x519491;_0x158221[_0xc9c7fc(0x254)]==_0x458f71[_0xc9c7fc(0x254)]&&_0x158221[_0xc9c7fc(0x267)]==_0x458f71['bay']&&(_0x158221[_0xc9c7fc(0x25f)]=parseInt(_0x158221['product_stock'])-parseInt(_0x458f71[_0xc9c7fc(0x23a)]));});}),await _0x6eca5c[_0x42e79c(0x22b)]();const {invoice:_0x4ae136,suppliers:_0x5cb836,date:_0x1c45fa,warehouse_name:_0x3e8e46,prod_name:_0x5b343b,prod_code:_0x210937,prod_qty:_0x2d82bc,prod_unit:_0x5241ba,prod_secondunit:_0x4f1dcf,prod_level:_0x1898a4,prod_isle:_0x4e5b50,prod_pallet:_0xb0aa3b,note:_0x64b38d,expiry_date:_0x4febb2,batch_code:_0x15227c,paid_amount:_0x12d3eb,due_amount:_0x22cace,Room_name:_0x2947c5,primary_code:_0x4a4f9f,secondary_code:_0x418e50,PO_number:_0x4af32b,JO_number:_0x13a2aa}=_0x141ca6[_0x42e79c(0x222)];if(typeof _0x5b343b==_0x42e79c(0x1d0))var _0x248a11=[_0x141ca6['body'][_0x42e79c(0x26d)]],_0x4fef2c=[_0x141ca6['body'][_0x42e79c(0x1d4)]],_0xb234c3=[_0x141ca6[_0x42e79c(0x222)]['prod_qty']],_0x387a7d=[_0x141ca6['body']['prod_unit']],_0x236189=[_0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x1d8)]],_0x407378=[_0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x27e)]],_0x18a819=[_0x141ca6[_0x42e79c(0x222)]['primary_code']],_0x165de0=[_0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x28b)]],_0x2778ef=[_0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x282)]],_0x27a606=[_0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x2b6)]],_0x1cc016=[_0x141ca6['body'][_0x42e79c(0x22f)]];else var _0x248a11=[..._0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x26d)]],_0x4fef2c=[..._0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x1d4)]],_0xb234c3=[..._0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x262)]],_0x387a7d=[..._0x141ca6[_0x42e79c(0x222)]['prod_unit']],_0x236189=[..._0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x1d8)]],_0x407378=[..._0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x27e)]],_0x18a819=[..._0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x253)]],_0x165de0=[..._0x141ca6[_0x42e79c(0x222)]['secondary_code']],_0x2778ef=[..._0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x282)]],_0x27a606=[..._0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x2b6)]],_0x1cc016=[..._0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x22f)]];const _0x3c573e=_0x248a11[_0x42e79c(0x1c0)](_0x2e6b99=>{return _0x2e6b99={'product_name':_0x2e6b99};});_0x4fef2c[_0x42e79c(0x20d)]((_0x3189b,_0x20b431)=>{var _0x120e84=_0x42e79c;_0x3c573e[_0x20b431][_0x120e84(0x284)]=_0x3189b;}),_0xb234c3[_0x42e79c(0x20d)]((_0x383066,_0x1bd9f9)=>{var _0x420f06=_0x42e79c;_0x3c573e[_0x1bd9f9][_0x420f06(0x23a)]=_0x383066;}),_0x387a7d['forEach']((_0x1885e6,_0x14337b)=>{_0x3c573e[_0x14337b]['standard_unit']=_0x1885e6;}),_0x236189['forEach']((_0x209e6c,_0x4d3832)=>{_0x3c573e[_0x4d3832]['secondary_unit']=_0x209e6c;}),_0x407378['forEach']((_0x54c315,_0x100eb5)=>{var _0x10f239=_0x42e79c;_0x3c573e[_0x100eb5][_0x10f239(0x267)]=_0x54c315;}),_0x18a819['forEach']((_0x51d5d6,_0x2c96b0)=>{var _0x40294a=_0x42e79c;_0x3c573e[_0x2c96b0][_0x40294a(0x253)]=_0x51d5d6;}),_0x165de0[_0x42e79c(0x20d)]((_0x1ad687,_0x233249)=>{var _0xb89997=_0x42e79c;_0x3c573e[_0x233249][_0xb89997(0x28b)]=_0x1ad687;}),_0x2778ef['forEach']((_0x5a4f4a,_0x287f58)=>{var _0x2b4d85=_0x42e79c;_0x3c573e[_0x287f58][_0x2b4d85(0x20c)]=_0x5a4f4a;}),_0x27a606[_0x42e79c(0x20d)]((_0x577fe7,_0x292c4e)=>{_0x3c573e[_0x292c4e]['batch_code']=_0x577fe7;}),_0x1cc016[_0x42e79c(0x20d)]((_0x1bf322,_0x1802d6)=>{var _0x2c65be=_0x42e79c;_0x3c573e[_0x1802d6][_0x2c65be(0x22f)]=_0x1bf322;});const _0x16465d=_0x3c573e[_0x42e79c(0x2ab)](_0x2c72a8=>_0x2c72a8[_0x42e79c(0x23a)]!=='0'&&_0x2c72a8[_0x42e79c(0x23a)]!=='');_0x5cce53['invoice']=_0x4ae136,_0x5cce53[_0x42e79c(0x2b5)]=_0x5cb836,_0x5cce53[_0x42e79c(0x1f2)]=_0x1c45fa,_0x5cce53[_0x42e79c(0x283)]=_0x3e8e46,_0x5cce53[_0x42e79c(0x22e)]=_0x16465d,_0x5cce53[_0x42e79c(0x2ad)]=_0x64b38d,_0x5cce53[_0x42e79c(0x27c)]=_0x12d3eb,_0x5cce53['due_amount']=_0x22cace,_0x5cce53[_0x42e79c(0x269)]=_0x2947c5,_0x5cce53[_0x42e79c(0x291)]=_0x4af32b,_0x5cce53['JO_number']=_0x13a2aa;const _0x379f87=await _0x5cce53[_0x42e79c(0x22b)](),_0x3fbee1=await warehouse[_0x42e79c(0x213)]({'name':_0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x283)],'room':_0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x248)]});_0x5cce53['product'][_0x42e79c(0x20d)](_0x596f42=>{var _0x71ca79=_0x42e79c,_0x1cb3d9=0x0;const _0x22a7a0=_0x3fbee1[_0x71ca79(0x1dd)][_0x71ca79(0x1c0)](_0x2d5626=>{var _0x444949=_0x71ca79;_0x2d5626[_0x444949(0x254)]==_0x596f42[_0x444949(0x254)]&&_0x2d5626[_0x444949(0x267)]==_0x596f42[_0x444949(0x267)]&&(_0x2d5626[_0x444949(0x25f)]=parseInt(_0x2d5626['product_stock'])+parseInt(_0x596f42['quantity']),_0x1cb3d9++);});_0x1cb3d9=='0'&&(_0x3fbee1[_0x71ca79(0x1dd)]=_0x3fbee1[_0x71ca79(0x1dd)][_0x71ca79(0x257)]({'product_name':_0x596f42[_0x71ca79(0x254)],'product_stock':_0x596f42[_0x71ca79(0x23a)],'primary_code':_0x596f42[_0x71ca79(0x253)],'secondary_code':_0x596f42[_0x71ca79(0x28b)],'product_code':_0x596f42[_0x71ca79(0x284)],'bay':_0x596f42[_0x71ca79(0x267)],'maxProducts':_0x596f42[_0x71ca79(0x20c)],'unit':_0x596f42['standard_unit'],'secondary_unit':_0x596f42[_0x71ca79(0x266)],'expiry_date':_0x596f42['expiry_date']}));}),await _0x3fbee1['save']();const _0x44fa8a=await s_payment_data[_0x42e79c(0x213)]({'invoice':_0x141ca6[_0x42e79c(0x222)]['invoice']});if(_0x44fa8a===null){}else console[_0x42e79c(0x21e)](_0x42e79c(0x2b5),_0x44fa8a,_0x141ca6['body'][_0x42e79c(0x1bf)]),_0x44fa8a[_0x42e79c(0x2b5)]=_0x141ca6[_0x42e79c(0x222)][_0x42e79c(0x2b5)],await _0x44fa8a[_0x42e79c(0x22b)]();_0x141ca6[_0x42e79c(0x1f0)](_0x42e79c(0x233),_0x42e79c(0x1c7)),_0x404073[_0x42e79c(0x273)](_0x42e79c(0x264));}catch(_0x4bf7ca){console['log'](_0x4bf7ca);}}),router[a0_0x4f0836(0x289)](a0_0x4f0836(0x247),auth,async(_0x2a36fe,_0x13a3b5)=>{var _0x46bf84=a0_0x4f0836;try{const _0x36c6c9=_0x2a36fe[_0x46bf84(0x278)]['id'],{invoice:_0x454c45,suppliers:_0x2804f9,payable:_0x2871ba,due_amount:_0x2a3af9}=_0x2a36fe[_0x46bf84(0x222)],_0x3dc9c5=await purchases[_0x46bf84(0x1dc)](_0x36c6c9);var _0x33cc56=_0x2871ba-_0x2a3af9;_0x3dc9c5[_0x46bf84(0x27c)]=parseFloat(_0x3dc9c5[_0x46bf84(0x27c)])+parseFloat(_0x2a3af9),_0x3dc9c5['due_amount']=_0x33cc56;const _0x8f5401=await _0x3dc9c5[_0x46bf84(0x22b)]();console['log'](_0x8f5401);const _0x197281=await s_payment_data[_0x46bf84(0x213)]({'invoice':_0x454c45});_0x197281['amount']=_0x33cc56,await _0x197281[_0x46bf84(0x22b)]();let _0x4fc496=new Date(),_0x36d0e6=('0'+_0x4fc496[_0x46bf84(0x26b)]())[_0x46bf84(0x29d)](-0x2),_0x467769=('0'+(_0x4fc496['getMonth']()+0x1))[_0x46bf84(0x29d)](-0x2),_0x38b9f5=_0x4fc496['getFullYear'](),_0x7be392=_0x38b9f5+'-'+_0x467769+'-'+_0x36d0e6;const _0x10f806=new suppliers_payment({'invoice':_0x454c45,'date':_0x38b9f5+'-'+_0x467769+'-'+_0x36d0e6,'suppliers':_0x2804f9,'reason':'Paid\x20For\x20Purchase','amount':_0x2a3af9}),_0x40882c=await _0x10f806[_0x46bf84(0x22b)]();_0x2a36fe[_0x46bf84(0x1f0)](_0x46bf84(0x233),'payment\x20successfull'),_0x13a3b5[_0x46bf84(0x273)](_0x46bf84(0x281));}catch(_0x6ff015){console[_0x46bf84(0x21e)](_0x6ff015);}}),router[a0_0x4f0836(0x212)](a0_0x4f0836(0x2a8),auth,async(_0x148d03,_0x8117a5)=>{var _0x2c6e26=a0_0x4f0836;try{const {username:_0x205465,email:_0x2c5dda,role:_0x17512a}=_0x148d03['user'],_0x2d08b9=_0x148d03[_0x2c6e26(0x2a1)],_0x202912=await profile[_0x2c6e26(0x213)]({'email':_0x2d08b9['email']}),_0x7feaf0=await master_shop[_0x2c6e26(0x200)]();console['log'](_0x2c6e26(0x29e),_0x7feaf0);const _0x111a21=_0x148d03[_0x2c6e26(0x278)]['id'],_0x18bdc5=await purchases['findById'](_0x111a21);console[_0x2c6e26(0x21e)](_0x18bdc5);const _0x4c07e5=await suppliers[_0x2c6e26(0x213)]({'name':_0x18bdc5[_0x2c6e26(0x2b5)]});console[_0x2c6e26(0x21e)](_0x4c07e5);if(_0x7feaf0[0x0][_0x2c6e26(0x255)]==_0x2c6e26(0x1fc)){var _0x13ccf7=users['English'];console[_0x2c6e26(0x21e)](_0x13ccf7);}else{if(_0x7feaf0[0x0]['language']==_0x2c6e26(0x2b3))var _0x13ccf7=users[_0x2c6e26(0x2b3)];else{if(_0x7feaf0[0x0]['language']==_0x2c6e26(0x21d))var _0x13ccf7=users[_0x2c6e26(0x21d)];else{if(_0x7feaf0[0x0][_0x2c6e26(0x255)]=='Spanish')var _0x13ccf7=users[_0x2c6e26(0x24e)];else{if(_0x7feaf0[0x0]['language']==_0x2c6e26(0x21f))var _0x13ccf7=users[_0x2c6e26(0x21f)];else{if(_0x7feaf0[0x0][_0x2c6e26(0x255)]==_0x2c6e26(0x29b))var _0x13ccf7=users[_0x2c6e26(0x22c)];else{if(_0x7feaf0[0x0][_0x2c6e26(0x255)]==_0x2c6e26(0x268))var _0x13ccf7=users[_0x2c6e26(0x268)];else{if(_0x7feaf0[0x0][_0x2c6e26(0x255)]==_0x2c6e26(0x25a))var _0x13ccf7=users[_0x2c6e26(0x1f1)];}}}}}}}_0x8117a5[_0x2c6e26(0x1db)](_0x2c6e26(0x260),{'success':_0x148d03[_0x2c6e26(0x1f0)]('success'),'errors':_0x148d03[_0x2c6e26(0x1f0)](_0x2c6e26(0x2aa)),'role':_0x2d08b9,'profile':_0x202912,'master_shop':_0x7feaf0,'supplier':_0x4c07e5,'purchase':_0x18bdc5,'language':_0x13ccf7});}catch(_0x52051b){console[_0x2c6e26(0x21e)](_0x52051b);}}),router[a0_0x4f0836(0x212)](a0_0x4f0836(0x23e),auth,async(_0xaf73f6,_0x143fd9)=>{var _0x4e78ae=a0_0x4f0836;try{const {username:_0x44ef57,email:_0x2f838f,role:_0x4c453d}=_0xaf73f6['user'],_0x5b9fa0=_0xaf73f6[_0x4e78ae(0x2a1)],_0x247ef9=await profile['findOne']({'email':_0x5b9fa0[_0x4e78ae(0x238)]}),_0x24c052=await master_shop['find']();console[_0x4e78ae(0x21e)](_0x4e78ae(0x29e),_0x24c052);const _0x3f09ef=_0xaf73f6[_0x4e78ae(0x278)]['id'];console[_0x4e78ae(0x21e)](_0x3f09ef);const _0x48cbfc=await purchases_finished['findById'](_0x3f09ef);console[_0x4e78ae(0x21e)](_0x4e78ae(0x280),_0x48cbfc);const _0x4a4d00=await product[_0x4e78ae(0x200)]({}),_0x12eade=await warehouse[_0x4e78ae(0x220)]([{'$match':{'name':_0x48cbfc[_0x4e78ae(0x283)],'room':_0x48cbfc[_0x4e78ae(0x269)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4e78ae(0x28d),'name':{'$first':_0x4e78ae(0x27b)},'product_stock':{'$first':_0x4e78ae(0x1e7)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4e78ae(0x208)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x4e78ae(0x1f9)},'primary_code':{'$first':_0x4e78ae(0x2b2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4e78ae(0x2ac)},'storage':{'$first':_0x4e78ae(0x22d)},'rack':{'$first':_0x4e78ae(0x287)}}}]);console[_0x4e78ae(0x21e)](_0x4e78ae(0x286),_0x12eade);let _0x428cdb;if(_0x5b9fa0['role']=='staff'){const _0x1f33c=await staff[_0x4e78ae(0x213)]({'email':_0x5b9fa0[_0x4e78ae(0x238)]});_0x428cdb=await warehouse['find']({'status':'Enabled','name':_0x1f33c['warehouse'],'warehouse_category':'Finished\x20Goods','name':_0x4e78ae(0x252)});}else _0x428cdb=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x4e78ae(0x221),'name':_0x4e78ae(0x252)}},{'$group':{'_id':_0x4e78ae(0x1fa),'name':{'$first':_0x4e78ae(0x1fa)}}}]);if(_0x24c052[0x0][_0x4e78ae(0x255)]=='English\x20(US)'){var _0x48e4af=users[_0x4e78ae(0x1cc)];console[_0x4e78ae(0x21e)](_0x48e4af);}else{if(_0x24c052[0x0]['language']==_0x4e78ae(0x2b3))var _0x48e4af=users[_0x4e78ae(0x2b3)];else{if(_0x24c052[0x0][_0x4e78ae(0x255)]==_0x4e78ae(0x21d))var _0x48e4af=users[_0x4e78ae(0x21d)];else{if(_0x24c052[0x0][_0x4e78ae(0x255)]==_0x4e78ae(0x24e))var _0x48e4af=users['Spanish'];else{if(_0x24c052[0x0]['language']==_0x4e78ae(0x21f))var _0x48e4af=users['French'];else{if(_0x24c052[0x0][_0x4e78ae(0x255)]=='Portuguese\x20(BR)')var _0x48e4af=users[_0x4e78ae(0x22c)];else{if(_0x24c052[0x0][_0x4e78ae(0x255)]==_0x4e78ae(0x268))var _0x48e4af=users[_0x4e78ae(0x268)];else{if(_0x24c052[0x0][_0x4e78ae(0x255)]==_0x4e78ae(0x25a))var _0x48e4af=users[_0x4e78ae(0x1f1)];}}}}}}}_0x143fd9[_0x4e78ae(0x1db)]('return_purchase_finished',{'success':_0xaf73f6['flash'](_0x4e78ae(0x233)),'errors':_0xaf73f6[_0x4e78ae(0x1f0)]('errors'),'role':_0x5b9fa0,'profile':_0x247ef9,'user':_0x48cbfc,'stock':_0x12eade,'master_shop':_0x24c052,'product':_0x4a4d00,'language':_0x48e4af,'warehouse':_0x428cdb});}catch(_0x45d730){console[_0x4e78ae(0x21e)](_0x45d730);}}),router[a0_0x4f0836(0x289)](a0_0x4f0836(0x23e),auth,async(_0x2f5edd,_0x1c2731)=>{var _0x32cc2e=a0_0x4f0836;try{const {invoice:_0xa5776e,date:_0x4019bf,warehouse_name:_0x30ce5c,Room_name:_0x22eab3,product_name:_0x237d7e,purchase_quantity:_0x28b891,stocks:_0x352adc,return_qty:_0x53156f,note:_0xeb0c79,level:_0x4e3d42,isle:_0x384d02,pallet:_0xf03981,to_warehouse_name:_0x21e3c9,to_Room_name:_0x2ea91c}=_0x2f5edd['body'],_0x1b0fce=await purchases_finished[_0x32cc2e(0x213)]({'_id':_0x2f5edd[_0x32cc2e(0x278)]['id']}),_0x4eb7e8=await warehouse[_0x32cc2e(0x213)]({'name':_0x30ce5c,'room':_0x22eab3,'warehouse_category':_0x32cc2e(0x221)});if(typeof _0x237d7e==_0x32cc2e(0x1d0))var _0x4c4ade=[_0x2f5edd[_0x32cc2e(0x222)][_0x32cc2e(0x254)]],_0x414259=[_0x2f5edd[_0x32cc2e(0x222)][_0x32cc2e(0x1cd)]],_0x115910=[_0x2f5edd[_0x32cc2e(0x222)][_0x32cc2e(0x2a2)]],_0x14dbaa=[_0x2f5edd[_0x32cc2e(0x222)]['return_qty']],_0x402b98=[_0x2f5edd['body']['level']],_0x38720d=[_0x2f5edd[_0x32cc2e(0x222)]['product_code_hide']],_0xcaf729=[_0x2f5edd['body'][_0x32cc2e(0x1d2)]],_0x3b4e1e=[_0x2f5edd['body'][_0x32cc2e(0x21b)]];else var _0x4c4ade=[..._0x2f5edd['body']['product_name']],_0x414259=[..._0x2f5edd[_0x32cc2e(0x222)][_0x32cc2e(0x1cd)]],_0x115910=[..._0x2f5edd[_0x32cc2e(0x222)][_0x32cc2e(0x2a2)]],_0x14dbaa=[..._0x2f5edd[_0x32cc2e(0x222)][_0x32cc2e(0x1e6)]],_0x402b98=[..._0x2f5edd['body']['level']],_0x38720d=[..._0x2f5edd[_0x32cc2e(0x222)][_0x32cc2e(0x230)]],_0xcaf729=[..._0x2f5edd['body']['primary_code_hide']],_0x3b4e1e=[..._0x2f5edd['body'][_0x32cc2e(0x21b)]];const _0x2ebac6=_0x4c4ade['map'](_0x2e443e=>{return _0x2e443e={'product_name':_0x2e443e};});_0x414259['forEach']((_0x2905bf,_0x4f11ec)=>{var _0x142c7d=_0x32cc2e;_0x2ebac6[_0x4f11ec][_0x142c7d(0x1cd)]=_0x2905bf;}),_0x115910[_0x32cc2e(0x20d)]((_0x158e7a,_0x177b47)=>{var _0xf55781=_0x32cc2e;_0x2ebac6[_0x177b47][_0xf55781(0x245)]=_0x158e7a;}),_0x14dbaa[_0x32cc2e(0x20d)]((_0x314168,_0x5c458f)=>{var _0x52f3fd=_0x32cc2e;_0x2ebac6[_0x5c458f][_0x52f3fd(0x1e6)]=_0x314168;}),_0x402b98[_0x32cc2e(0x20d)]((_0x465471,_0x2c7277)=>{var _0x4ee025=_0x32cc2e;_0x2ebac6[_0x2c7277][_0x4ee025(0x267)]=_0x465471;}),_0x38720d['forEach']((_0x43c092,_0x106eca)=>{_0x2ebac6[_0x106eca]['product_code']=_0x43c092;}),_0xcaf729['forEach']((_0x1818a9,_0x1c7f49)=>{var _0x2978b9=_0x32cc2e;_0x2ebac6[_0x1c7f49][_0x2978b9(0x253)]=_0x1818a9;}),_0x3b4e1e[_0x32cc2e(0x20d)]((_0x147272,_0x1ef1d7)=>{var _0x1b3d28=_0x32cc2e;_0x2ebac6[_0x1ef1d7][_0x1b3d28(0x28b)]=_0x147272;}),_0x2ebac6['forEach'](_0x123e80=>{var _0x2b0733=_0x32cc2e;console[_0x2b0733(0x21e)](_0x123e80);const _0x59592a=_0x4eb7e8[_0x2b0733(0x1dd)]['map'](_0x33aa8e=>{var _0x78a24=_0x2b0733;_0x33aa8e[_0x78a24(0x254)]==_0x123e80[_0x78a24(0x254)]&&_0x33aa8e[_0x78a24(0x267)]==_0x123e80['bay']&&(console['log'](parseInt(_0x33aa8e['product_stock'])+_0x78a24(0x239)+parseInt(_0x123e80[_0x78a24(0x1e6)])),_0x33aa8e[_0x78a24(0x25f)]=parseInt(_0x33aa8e['product_stock'])-parseInt(_0x123e80[_0x78a24(0x1e6)]));});}),await _0x4eb7e8['save']();var _0x1f424d=0x0;_0x2ebac6[_0x32cc2e(0x20d)](_0x5ea10b=>{var _0x5b8fdc=_0x32cc2e;(parseInt(_0x5ea10b['purchase_quantity'])<parseInt(_0x5ea10b[_0x5b8fdc(0x1e6)])||parseInt(_0x5ea10b[_0x5b8fdc(0x245)])<parseInt(_0x5ea10b[_0x5b8fdc(0x1e6)]))&&_0x1f424d++;});if(_0x1f424d!=0x0)return _0x2f5edd[_0x32cc2e(0x1f0)](_0x32cc2e(0x2aa),_0x32cc2e(0x207)),_0x1c2731[_0x32cc2e(0x273)](_0x32cc2e(0x2a9));const _0x361a6c=new purchases_return_finished({'invoice':_0xa5776e,'suppliers':_0x2f5edd[_0x32cc2e(0x222)][_0x32cc2e(0x2b5)],'date':_0x4019bf,'warehouse_name':_0x30ce5c,'return_product':_0x2ebac6,'note':_0xeb0c79,'room':_0x22eab3,'to_warehouse_name':_0x21e3c9,'to_room':_0x2ea91c}),_0x38d5f7=await _0x361a6c[_0x32cc2e(0x22b)](),_0x1fcbd9=await purchases_return_finished[_0x32cc2e(0x213)]({'invoice':_0xa5776e}),_0x2eef64=await warehouse[_0x32cc2e(0x213)]({'name':_0x21e3c9,'room':_0x2ea91c,'warehouse_category':_0x32cc2e(0x221)});_0x1fcbd9[_0x32cc2e(0x2a3)][_0x32cc2e(0x20d)](_0x53e6a2=>{var _0x120641=_0x32cc2e,_0x5600be=0x0;const _0x215ab8=_0x2eef64[_0x120641(0x1dd)][_0x120641(0x1c0)](_0x3df57d=>{var _0x1c98db=_0x120641;console['log'](_0x3df57d[_0x1c98db(0x254)]+'=='+_0x53e6a2[_0x1c98db(0x254)]+'&&'+_0x3df57d[_0x1c98db(0x267)]+'=='+_0x53e6a2[_0x1c98db(0x267)]),_0x3df57d[_0x1c98db(0x254)]==_0x53e6a2[_0x1c98db(0x254)]&&_0x3df57d[_0x1c98db(0x267)]==_0x53e6a2[_0x1c98db(0x267)]&&(_0x3df57d[_0x1c98db(0x25f)]=parseInt(_0x3df57d[_0x1c98db(0x25f)])-parseInt(_0x53e6a2[_0x1c98db(0x1e6)]),_0x5600be++);});_0x5600be=='0'&&(_0x2eef64[_0x120641(0x1dd)]=_0x2eef64[_0x120641(0x1dd)][_0x120641(0x257)]({'product_name':_0x53e6a2[_0x120641(0x254)],'product_stock':_0x53e6a2['return_qty'],'primary_code':_0x53e6a2[_0x120641(0x253)],'secondary_code':_0x53e6a2[_0x120641(0x28b)],'product_code':_0x53e6a2[_0x120641(0x284)],'bay':_0x53e6a2[_0x120641(0x267)],'maxProducts':0xf423f}));}),await _0x2eef64[_0x32cc2e(0x22b)]();const _0x23b9b2=await purchases_finished['findOne']({'invoice':_0xa5776e});_0x23b9b2[_0x32cc2e(0x26f)]=_0x32cc2e(0x24b);const _0x44305a=await _0x23b9b2[_0x32cc2e(0x22b)](),_0x3e5dc4=new s_payment_data({'invoice':_0xa5776e,'suppliers':_0x2f5edd[_0x32cc2e(0x222)]['suppliers'],'reason':_0x32cc2e(0x2a4)});await _0x3e5dc4[_0x32cc2e(0x22b)]();const _0xf56956=await master_shop['find'](),_0x1f43eb=await email_settings[_0x32cc2e(0x213)](),_0x376a35=await suppliers['findOne']({'name':_0x2f5edd[_0x32cc2e(0x222)][_0x32cc2e(0x2b5)]});_0xf56956[0x0][_0x32cc2e(0x1f8)]==0x1?(right_currency=_0xf56956[0x0][_0x32cc2e(0x1fb)],left_currency=''):(right_currency='',left_currency=_0xf56956[0x0]['currency']);var _0x3b4756=_0x4c4ade,_0x1c421a=_0x14dbaa,_0x47dfb0='',_0x49994b;for(_0x49994b in _0x3b4756){_0x47dfb0+=_0x32cc2e(0x1e0)+_0x32cc2e(0x2b9)+_0x3b4756[_0x49994b]+'</td>'+_0x32cc2e(0x2b9)+_0x1c421a[_0x49994b]+'</td>'+_0x32cc2e(0x1e4);}let _0x2bb027=nodemailer[_0x32cc2e(0x29f)]({'service':_0x32cc2e(0x1ee),'auth':{'user':_0x1f43eb[_0x32cc2e(0x238)],'pass':_0x1f43eb[_0x32cc2e(0x293)]}}),_0x10b6bf={'from':_0x1f43eb[_0x32cc2e(0x238)],'to':_0x376a35[_0x32cc2e(0x238)],'subject':_0x32cc2e(0x1e8),'attachments':[{'filename':_0x32cc2e(0x215),'path':__dirname+'/../public'+_0x32cc2e(0x244)+_0xf56956[0x0][_0x32cc2e(0x263)],'cid':_0x32cc2e(0x29a)}],'html':_0x32cc2e(0x1fe)+_0x32cc2e(0x228)+_0x32cc2e(0x2b8)+_0x32cc2e(0x1e9)+_0x32cc2e(0x246)+'<div>'+_0x32cc2e(0x1c3)+_0x32cc2e(0x226)+_0x32cc2e(0x1e9)+_0x32cc2e(0x1e1)+_0xf56956[0x0][_0x32cc2e(0x29c)]+_0x32cc2e(0x2ba)+_0x32cc2e(0x226)+_0x32cc2e(0x226)+'<hr\x20class=\x22my-3\x22>'+_0x32cc2e(0x1e9)+_0x32cc2e(0x1ef)+'\x20Order\x20Number\x20:\x20'+_0xa5776e+'\x20'+_0x32cc2e(0x1f5)+_0x32cc2e(0x209)+_0x4019bf+'\x20'+_0x32cc2e(0x2b1)+_0x32cc2e(0x25c)+_0x32cc2e(0x226)+_0x32cc2e(0x272)+_0x32cc2e(0x20a)+_0x32cc2e(0x1e0)+_0x32cc2e(0x23b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x32cc2e(0x202)+_0x32cc2e(0x234)+_0x32cc2e(0x1e4)+_0x32cc2e(0x2a5)+_0x32cc2e(0x1eb)+'\x20'+_0x47dfb0+'\x20'+'</tbody>'+_0x32cc2e(0x1d7)+_0x32cc2e(0x1e9)+_0x32cc2e(0x204)+'<h5>'+_0xf56956[0x0][_0x32cc2e(0x29c)]+_0x32cc2e(0x25c)+_0x32cc2e(0x226)+_0x32cc2e(0x226)+_0x32cc2e(0x2ae)};_0x2bb027['sendMail'](_0x10b6bf,function(_0x44912b,_0x1e11bb){var _0x2fa448=_0x32cc2e;_0x44912b?console[_0x2fa448(0x21e)](_0x2fa448(0x24d)):console[_0x2fa448(0x21e)]('Email\x20sent\x20successfully');}),_0x2f5edd['flash'](_0x32cc2e(0x233),_0x32cc2e(0x298)),_0x1c2731['redirect'](_0x32cc2e(0x264));}catch(_0x2bfd76){_0x1c2731[_0x32cc2e(0x27d)](0xc8)[_0x32cc2e(0x20b)]({'message':_0x2bfd76[_0x32cc2e(0x27f)]});}}),router[a0_0x4f0836(0x212)](a0_0x4f0836(0x25b),auth,async(_0x16fd51,_0x12ee99)=>{var _0x468178=a0_0x4f0836;try{const {username:_0x329605,email:_0x5f4be8,role:_0x47f73e}=_0x16fd51[_0x468178(0x2a1)],_0x163c60=_0x16fd51[_0x468178(0x2a1)],_0x544801=await profile['findOne']({'email':_0x163c60[_0x468178(0x238)]}),_0x1ac7ee=await master_shop[_0x468178(0x200)](),_0x2de16a=_0x16fd51[_0x468178(0x278)]['id'],_0x5175c7=await purchases_finished['findById'](_0x2de16a);if(_0x1ac7ee[0x0]['language']==_0x468178(0x1fc))var _0x5c7b23=users['English'];else{if(_0x1ac7ee[0x0][_0x468178(0x255)]==_0x468178(0x2b3))var _0x5c7b23=users['Hindi'];else{if(_0x1ac7ee[0x0][_0x468178(0x255)]==_0x468178(0x21d))var _0x5c7b23=users[_0x468178(0x21d)];else{if(_0x1ac7ee[0x0][_0x468178(0x255)]==_0x468178(0x24e))var _0x5c7b23=users[_0x468178(0x24e)];else{if(_0x1ac7ee[0x0]['language']=='French')var _0x5c7b23=users[_0x468178(0x21f)];else{if(_0x1ac7ee[0x0][_0x468178(0x255)]=='Portuguese\x20(BR)')var _0x5c7b23=users['Portuguese'];else{if(_0x1ac7ee[0x0][_0x468178(0x255)]==_0x468178(0x268))var _0x5c7b23=users[_0x468178(0x268)];else{if(_0x1ac7ee[0x0]['language']==_0x468178(0x25a))var _0x5c7b23=users[_0x468178(0x1f1)];}}}}}}}_0x12ee99[_0x468178(0x1db)]('all_purchases_barcode',{'success':_0x16fd51[_0x468178(0x1f0)](_0x468178(0x233)),'errors':_0x16fd51[_0x468178(0x1f0)](_0x468178(0x2aa)),'role':_0x163c60,'profile':_0x544801,'alldata':_0x5175c7,'master_shop':_0x1ac7ee,'language':_0x5c7b23}),console['log'](alldata);}catch(_0x48d2c8){console[_0x468178(0x21e)](_0x48d2c8);}}),router[a0_0x4f0836(0x289)]('/barcode_scanner',async(_0x79f14b,_0x155467)=>{var _0xbee643=a0_0x4f0836;const {product_code:_0x33eb40}=_0x79f14b['body'];var _0x4afde3;const _0x2b700e=await product[_0xbee643(0x220)]([{'$match':{'primary_code':_0x33eb40,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0xbee643(0x241),'name':{'$first':_0xbee643(0x1fa)},'category':{'$first':_0xbee643(0x277)},'brand':{'$first':'$brand'},'unit':{'$first':_0xbee643(0x210)},'alertquantity':{'$first':_0xbee643(0x235)},'product_code':{'$first':_0xbee643(0x214)},'primary_code':{'$first':_0xbee643(0x26e)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0xbee643(0x25d)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xbee643(0x2b7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x33316a=await product['aggregate']([{'$match':{'secondary_code':_0x33eb40}},{'$group':{'_id':_0xbee643(0x241),'name':{'$first':_0xbee643(0x1fa)},'category':{'$first':'$category'},'brand':{'$first':_0xbee643(0x1d1)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0xbee643(0x26e)},'secondary_code':{'$first':_0xbee643(0x1de)},'maxStocks':{'$first':_0xbee643(0x25d)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2b700e[_0xbee643(0x276)]>0x0)_0x4afde3=_0x2b700e;else _0x33316a[_0xbee643(0x276)]>0x0&&(_0x4afde3=_0x33316a);_0x155467[_0xbee643(0x20b)](_0x4afde3);}),router[a0_0x4f0836(0x289)](a0_0x4f0836(0x205),async(_0x297b41,_0x4037ee)=>{var _0x110291=a0_0x4f0836;const {productCode:_0x279887,bay:_0x1fb5db,warehouses:_0x16cc34,room:_0x1e29cf}=_0x297b41[_0x110291(0x222)];console[_0x110291(0x21e)](_0x297b41[_0x110291(0x222)]);try{const _0x29c334=await warehouse[_0x110291(0x220)]([{'$match':{'name':_0x16cc34,'room':_0x1e29cf}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x1fb5db)}},{'$group':{'_id':_0x110291(0x28d),'name':{'$first':_0x110291(0x27b)},'product_stock':{'$first':_0x110291(0x1e7)},'bay':{'$first':_0x110291(0x24a)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4037ee[_0x110291(0x27d)](0xc8)['json'](_0x29c334);}catch(_0x159dfb){_0x4037ee[_0x110291(0x27d)](0x194)['json']({'message':_0x159dfb[_0x110291(0x27f)]});}}),module['exports']=router;