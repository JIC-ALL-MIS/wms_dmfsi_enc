var a0_0x1f5b25=a0_0x1851;(function(_0x1b44f4,_0x25ee8b){var _0x498f89=a0_0x1851,_0x111f80=_0x1b44f4();while(!![]){try{var _0x552792=parseInt(_0x498f89(0x181))/0x1*(-parseInt(_0x498f89(0x170))/0x2)+-parseInt(_0x498f89(0x1f5))/0x3+-parseInt(_0x498f89(0x1d4))/0x4+-parseInt(_0x498f89(0x245))/0x5+parseInt(_0x498f89(0x1cf))/0x6+parseInt(_0x498f89(0x23c))/0x7+parseInt(_0x498f89(0x16b))/0x8;if(_0x552792===_0x25ee8b)break;else _0x111f80['push'](_0x111f80['shift']());}catch(_0x2c2d03){_0x111f80['push'](_0x111f80['shift']());}}}(a0_0x22bd,0x1b87e));const express=require(a0_0x1f5b25(0x1b4)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x1f5b25(0x24b)),auth=require(a0_0x1f5b25(0x178)),nodemailer=require(a0_0x1f5b25(0x257));var ejs=require('ejs');const path=require(a0_0x1f5b25(0x24f)),users=require(a0_0x1f5b25(0x1e0));function a0_0x22bd(){var _0x359997=['secondary_unit','/all_purchases_finished/view','prod_unit','purchase\x20data\x20update\x20successfully','$suppliers_docs','all_purchases_finished','return_qty','error','Purchase\x20Mail','$product.bay','slice','user_id','forEach','concat','secondary_code_hide','getFullYear','logo','Portuguese\x20(BR)','json','filter','$product.floorlevel','length','user','staff','/CheckingWarehouse','$maxProdPerUnit','1061166VrMqlb','updateOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Ambient','$unit','278084giFsjW','Enclosed','Paid\x20For\x20Purchase','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product','/view/add_purchases','invoice','Spanish','toString','Error\x20Occurs','INCF-','../public/language/languages.json','$product_details.product_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','prod_primunit','<html><head><title></title>','MaxStocks_data','Chinese','<span\x20style=\x22float:\x20right;\x22>','return_purchase_finished','$product_details.bin','errors','Rack\x201','Rack\x202','Room_name','</h5>','max_product_unit','getDate','$_id','$return_data','508221sDYbKu','render','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$primary_code','payment\x20successfull','role','quantity','redirect','purchase_quantity','createTransport','Email\x20sent\x20successfully','</head><body>','bay','language','There\x27s\x20a\x20error\x20in\x20this\x20transaction','paid_amount','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','stock_data','product_stock','findById','$category','\x20Order\x20Date\x20:\x20','$warehouse_name','<tr>','An\x20error\x20occurred\x20while\x20saving\x20data.','prod_invoice','QA\x20Warehouse','suppliers','$product_details.floorlevel','/view','/invoice/:id','/view/:id','/barcode_scanner','aggregate','primary_code','/../public','</tbody>','\x20Order\x20Number\x20:\x20','level','$expiry_date','</tr>','$product_details.storage','\x20<>\x20','return_data','product_date','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','string','$product.quantity','German','message','room','$suppliers','English','/barcode/:id','primary_code_hide','production_date','date','prod_cat','product_code','<h2>\x20','all_purchases_barcode','</td>','prod_qty','prod_name','prod_level','/view/return_purchase/:id','Enabled','498862ytqvif','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details','$product_code','findOne','/all_purchases/view','prod_code','edit_purchases_finished','$invoice','626760YWkNWg','product_cat','Purchase\x20Return','expiry_date','map','$secondary_unit','../models/all_models','$product_details.secondary_code','$secondary_code','DRY\x20GOODS','path','</body></html>','image','save','$product_details.product_code','master','</div>','maxperunit','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','add_purchases\x20error','maxStocks','stocks','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</table>','Hindi','padStart','suppliers_docs','product_name','warehouse_name','stock_quantity','RoomAssign','product_code_hide','$product','host','FGSEmail','<tbody\x20style=\x22text-align:\x20center;\x22>','2854320EjjVkL','flash','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product_details','success','255742bAjGBD','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','find','$product_details.primary_code','all','currency','JO_number','../middleware/auth','Portuguese','catch','back','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product.bin','purchase_invoice','name','$name','1FwrTdb','$product.room_name','body','getMonth','$batch_code','Logo.png','add_purchases_finished','$maxStocks','post','$product_details.bay','standard_unit','$brand','site_title','/upload/','Arabic\x20(ae)','$product_details._id','return_product','<div>','Arabic','\x20</h2>','secondary_code','edit_purchases_finished_view','exports','warehouse','<strong>\x20Regards\x20</strong>','password','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$note','currency_placement','log','Return\x20Goods','gmail','room_name','get','email','due_amount','Finished\x20Goods','POnumber','prod_Qty','status','<h5>','$alertquantity','$product.type','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<h5\x20style=\x22text-align:\x20left;\x22>','params','French','batch_code','$room','prod_secondunit','express'];a0_0x22bd=function(){return _0x359997;};return a0_0x22bd();}router[a0_0x1f5b25(0x1a2)](a0_0x1f5b25(0x215),auth,async(_0x184868,_0x215a83)=>{var _0x1d203a=a0_0x1f5b25;try{const {username:_0x58992b,email:_0x2f2655,role:_0x55b37f}=_0x184868['user'],_0x5b2ce9=_0x184868[_0x1d203a(0x1cb)],_0x51c4ae=await profile['findOne']({'email':_0x5b2ce9[_0x1d203a(0x1a3)]}),_0x49f3de=await staff[_0x1d203a(0x240)]({'email':_0x5b2ce9[_0x1d203a(0x1a3)]});if(_0x5b2ce9['role']==_0x1d203a(0x1cc)){const _0x5402ee=await staff[_0x1d203a(0x240)]({'email':_0x5b2ce9[_0x1d203a(0x1a3)]});}const _0x5133eb=await master_shop[_0x1d203a(0x173)]();let _0xf5feac;if(_0x5b2ce9[_0x1d203a(0x1fb)]=='staff'){const _0x3492d7=await staff['findOne']({'email':_0x5b2ce9[_0x1d203a(0x1a3)]});_0xf5feac=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x3492d7[_0x1d203a(0x198)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x1d203a(0x17f),'as':_0x1d203a(0x161)}},{'$unwind':_0x1d203a(0x1b9)},{'$unwind':'$product'},{'$group':{'_id':_0x1d203a(0x1f3),'invoice':{'$first':_0x1d203a(0x244)},'suppliers':{'$first':_0x1d203a(0x22c)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x1d203a(0x1b2)},'product':{'$push':_0x1d203a(0x167)},'note':{'$first':_0x1d203a(0x19c)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x1d203a(0x1f4)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x1d203a(0x21f)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x1d203a(0x228)},'level':{'$addToSet':_0x1d203a(0x1be)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x1d203a(0x1ab)},'floorlevel':{'$addToSet':_0x1d203a(0x1c9)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xf5feac=await purchases_finished[_0x1d203a(0x219)]([{'$unwind':_0x1d203a(0x167)},{'$group':{'_id':_0x1d203a(0x1f3),'invoice':{'$first':_0x1d203a(0x244)},'suppliers':{'$first':_0x1d203a(0x22c)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1d203a(0x20e)},'room':{'$addToSet':_0x1d203a(0x182)},'product':{'$push':_0x1d203a(0x167)},'note':{'$first':_0x1d203a(0x19c)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x1d203a(0x1f4)},'batch_code':{'$first':_0x1d203a(0x185)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x1d203a(0x1b9)},'total_product_quantity':{'$sum':_0x1d203a(0x228)},'level':{'$addToSet':_0x1d203a(0x1be)},'isle':{'$addToSet':_0x1d203a(0x17d)},'type':{'$addToSet':_0x1d203a(0x1ab)},'floorlevel':{'$addToSet':_0x1d203a(0x1c9)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x5133eb[0x0][_0x1d203a(0x203)]==_0x1d203a(0x207))var _0x4aee62=users[_0x1d203a(0x22d)];else{if(_0x5133eb[0x0][_0x1d203a(0x203)]=='Hindi')var _0x4aee62=users[_0x1d203a(0x15f)];else{if(_0x5133eb[0x0][_0x1d203a(0x203)]==_0x1d203a(0x229))var _0x4aee62=users[_0x1d203a(0x229)];else{if(_0x5133eb[0x0][_0x1d203a(0x203)]==_0x1d203a(0x1dc))var _0x4aee62=users[_0x1d203a(0x1dc)];else{if(_0x5133eb[0x0][_0x1d203a(0x203)]=='French')var _0x4aee62=users[_0x1d203a(0x1b0)];else{if(_0x5133eb[0x0][_0x1d203a(0x203)]=='Portuguese\x20(BR)')var _0x4aee62=users[_0x1d203a(0x179)];else{if(_0x5133eb[0x0][_0x1d203a(0x203)]==_0x1d203a(0x1e8))var _0x4aee62=users[_0x1d203a(0x1e8)];else{if(_0x5133eb[0x0]['language']=='Arabic\x20(ae)')var _0x4aee62=users[_0x1d203a(0x193)];}}}}}}}_0x215a83[_0x1d203a(0x1f6)](_0x1d203a(0x1ba),{'success':_0x184868['flash']('success'),'errors':_0x184868[_0x1d203a(0x16c)](_0x1d203a(0x1ec)),'purchases':_0xf5feac,'role':_0x5b2ce9,'profile':_0x51c4ae,'master_shop':_0x5133eb,'language':_0x4aee62});}catch(_0x3a9dc0){console['log']('table\x20page',_0x3a9dc0),_0x215a83[_0x1d203a(0x1a8)](0xc8)['json']({'message':_0x3a9dc0[_0x1d203a(0x22a)]});}});function BayBinSelected(_0x371971,_0x559c87){var _0x2d47bb=a0_0x1f5b25,_0x2c3a3c=[],_0x37c0d2=[];if(_0x371971=='DRY\x20GOODS'){switch(_0x559c87){case _0x2d47bb(0x1ed):_0x2c3a3c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x2c3a3c=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x37c0d2=['DG'];}else{if(_0x371971=='FROZEN\x20GOODS'){switch(_0x559c87){case _0x2d47bb(0x1ed):_0x2c3a3c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x2d47bb(0x1ee):_0x2c3a3c=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x37c0d2=['FG'];}}return{'levels':_0x2c3a3c,'identify':_0x37c0d2};}function a0_0x1851(_0x371be4,_0x58ce19){var _0x22bdf8=a0_0x22bd();return a0_0x1851=function(_0x1851a4,_0x14a4b4){_0x1851a4=_0x1851a4-0x15d;var _0x5cf516=_0x22bdf8[_0x1851a4];return _0x5cf516;},a0_0x1851(_0x371be4,_0x58ce19);}async function getRandom8DigitNumber(){var _0x2af84b=a0_0x1f5b25;const _0x363ed8=0x989680,_0x37647e=0x5f5e0ff,_0x2562e3=Math[_0x2af84b(0x1d7)](Math['random']()*(_0x37647e-_0x363ed8+0x1))+_0x363ed8;var _0x283943;const _0x5b146f=await purchases_finished[_0x2af84b(0x240)]({'invoice':'INCF-'+_0x2562e3});return _0x5b146f&&_0x5b146f[_0x2af84b(0x1ca)]>0x0?_0x283943=_0x2af84b(0x1df)+_0x2562e3:_0x283943=_0x2af84b(0x1df)+_0x2562e3,_0x283943;}router['get'](a0_0x1f5b25(0x1da),auth,async(_0x19816,_0x5caebe)=>{var _0x4b0c9a=a0_0x1f5b25;try{const {username:_0x1a38b2,email:_0x186c2f,role:_0x31a337}=_0x19816['user'],_0x83362d=_0x19816[_0x4b0c9a(0x1cb)],_0x1caa7b=await profile[_0x4b0c9a(0x240)]({'email':_0x83362d['email']}),_0x26ccea=await master_shop[_0x4b0c9a(0x173)](),_0x28103a=await staff[_0x4b0c9a(0x240)]({'email':_0x83362d[_0x4b0c9a(0x1a3)]}),_0x317211=await suppliers[_0x4b0c9a(0x173)]({});let _0x3dff4f;if(_0x83362d[_0x4b0c9a(0x1fb)]==_0x4b0c9a(0x1cc)){const _0x57f180=await staff[_0x4b0c9a(0x240)]({'email':_0x83362d['email']});_0x3dff4f=await warehouse[_0x4b0c9a(0x219)]([{'$match':{'status':_0x4b0c9a(0x23b),'name':_0x57f180[_0x4b0c9a(0x198)],'warehouse_category':_0x4b0c9a(0x1a5)}},{'$group':{'_id':_0x4b0c9a(0x180),'name':{'$first':_0x4b0c9a(0x180)}}}]);}else _0x3dff4f=await warehouse[_0x4b0c9a(0x219)]([{'$match':{'status':'Enabled','warehouse_category':_0x4b0c9a(0x1a5),'name':{'$ne':_0x4b0c9a(0x212)}}},{'$group':{'_id':_0x4b0c9a(0x180),'name':{'$first':_0x4b0c9a(0x180)}}}]);const _0x2b948e=await product['find']({}),_0x238f1d=await warehouse['find']({'status':_0x4b0c9a(0x23b)}),_0x2bf662=await purchases_finished[_0x4b0c9a(0x173)]({}),_0x1ef04e=_0x2bf662[_0x4b0c9a(0x1ca)]+0x1,_0x35a949='INCF-'+_0x1ef04e[_0x4b0c9a(0x1dd)]()[_0x4b0c9a(0x160)](0x5,'0');var _0x18e610=[_0x4b0c9a(0x1d2),_0x4b0c9a(0x1d5)];if(_0x26ccea[0x0]['language']==_0x4b0c9a(0x207))var _0x26d1f9=users['English'];else{if(_0x26ccea[0x0][_0x4b0c9a(0x203)]==_0x4b0c9a(0x15f))var _0x26d1f9=users[_0x4b0c9a(0x15f)];else{if(_0x26ccea[0x0][_0x4b0c9a(0x203)]=='German')var _0x26d1f9=users[_0x4b0c9a(0x229)];else{if(_0x26ccea[0x0][_0x4b0c9a(0x203)]==_0x4b0c9a(0x1dc))var _0x26d1f9=users[_0x4b0c9a(0x1dc)];else{if(_0x26ccea[0x0]['language']==_0x4b0c9a(0x1b0))var _0x26d1f9=users['French'];else{if(_0x26ccea[0x0][_0x4b0c9a(0x203)]==_0x4b0c9a(0x1c6))var _0x26d1f9=users[_0x4b0c9a(0x179)];else{if(_0x26ccea[0x0][_0x4b0c9a(0x203)]==_0x4b0c9a(0x1e8))var _0x26d1f9=users['Chinese'];else{if(_0x26ccea[0x0]['language']==_0x4b0c9a(0x18f))var _0x26d1f9=users[_0x4b0c9a(0x193)];}}}}}}}const _0x5222e7=getRandom8DigitNumber();_0x5222e7['then'](_0x41ed60=>{var _0x38c715=_0x4b0c9a;_0x5caebe[_0x38c715(0x1f6)](_0x38c715(0x187),{'success':_0x19816[_0x38c715(0x16c)]('success'),'errors':_0x19816['flash'](_0x38c715(0x1ec)),'role':_0x83362d,'profile':_0x1caa7b,'suppliers':_0x317211,'warehouse':_0x3dff4f,'product':_0x2b948e,'invoice':_0x41ed60,'master_shop':_0x26ccea,'language':_0x26d1f9,'find_data':_0x238f1d,'rooms_data':_0x18e610});})[_0x4b0c9a(0x17a)](_0x501435=>{var _0x398722=_0x4b0c9a;_0x19816[_0x398722(0x16c)](_0x398722(0x1ec),_0x398722(0x204)),_0x5caebe['redirect'](_0x398722(0x1b6));});}catch(_0x8998a5){console[_0x4b0c9a(0x19e)](_0x8998a5);}}),router['get']('/view/add_purchases/:id',auth,async(_0x11d5c9,_0x30fb58)=>{var _0x39e2be=a0_0x1f5b25;try{const _0x313a31=_0x11d5c9[_0x39e2be(0x1af)]['id'];console[_0x39e2be(0x19e)](_0x313a31);const _0x536e3c=await master_shop['find']();console[_0x39e2be(0x19e)]('master',_0x536e3c);const _0x2f0496=await product[_0x39e2be(0x240)]({'name':_0x313a31});console[_0x39e2be(0x19e)](_0x39e2be(0x1d9),_0x2f0496),_0x30fb58[_0x39e2be(0x1a8)](0xc8)[_0x39e2be(0x1c7)]({'product_data':_0x2f0496,'master':_0x536e3c});}catch(_0x512a83){console['log'](_0x39e2be(0x259),_0x512a83);}}),router['post'](a0_0x1f5b25(0x1da),auth,async(_0x507589,_0x2c4645)=>{var _0x22de24=a0_0x1f5b25;try{const {invoice:_0x3d3d39,date:_0x4e8694,warehouse_name:_0x4de708,prod_name:_0x5ddf24,prod_code:_0x176a56,prod_qty:_0x2b0426,prod_unit:_0x1cbbcc,prod_secondunit:_0x1c0863,prod_level:_0x42b80c,prod_isle:_0x3c8f4f,prod_pallet:_0x21c72b,note:_0x2c610d,expiry_date:_0x5ca804,batch_code:_0x43d82b,payable:_0x1e4024,due_amount:_0x2d5367,Room_name:_0x36efbf,primary_code:_0x51674a,secondary_code:_0x309f1f,MaxStocks_data:_0x268951,PO_number:_0x2ee84f,SCRN:_0x2ee434,JO_number:_0x51264c}=_0x507589[_0x22de24(0x183)];if(typeof _0x5ddf24==_0x22de24(0x227))var _0xabd7f2=[_0x507589['body'][_0x22de24(0x238)]],_0x3abf54=[_0x507589[_0x22de24(0x183)][_0x22de24(0x242)]],_0x6f6648=[_0x507589['body'][_0x22de24(0x1a7)]],_0x288dc7=[_0x507589[_0x22de24(0x183)]['prod_primunit']],_0x43c606=[_0x507589[_0x22de24(0x183)][_0x22de24(0x1b3)]],_0x5927e6=[_0x507589[_0x22de24(0x183)]['prod_level']],_0x45908a=[_0x507589[_0x22de24(0x183)][_0x22de24(0x21a)]],_0x42f0fd=[_0x507589[_0x22de24(0x183)][_0x22de24(0x195)]],_0x548624=[_0x507589[_0x22de24(0x183)][_0x22de24(0x1e7)]],_0x174993=[_0x507589[_0x22de24(0x183)][_0x22de24(0x1b1)]],_0x1ecd99=[_0x507589[_0x22de24(0x183)][_0x22de24(0x248)]],_0x200e2e=[_0x507589['body'][_0x22de24(0x224)]],_0x2aa9b8=[_0x507589[_0x22de24(0x183)][_0x22de24(0x1f1)]],_0x356eae=[_0x507589['body']['prod_cat']],_0x1be100=[_0x507589[_0x22de24(0x183)][_0x22de24(0x165)]],_0x3868c0=[_0x507589['body'][_0x22de24(0x211)]];else var _0xabd7f2=[..._0x507589[_0x22de24(0x183)]['prod_name']],_0x3abf54=[..._0x507589[_0x22de24(0x183)][_0x22de24(0x242)]],_0x6f6648=[..._0x507589[_0x22de24(0x183)][_0x22de24(0x1a7)]],_0x288dc7=[..._0x507589[_0x22de24(0x183)][_0x22de24(0x1e5)]],_0x43c606=[..._0x507589[_0x22de24(0x183)][_0x22de24(0x1b3)]],_0x5927e6=[..._0x507589['body'][_0x22de24(0x239)]],_0x45908a=[..._0x507589['body'][_0x22de24(0x21a)]],_0x42f0fd=[..._0x507589[_0x22de24(0x183)][_0x22de24(0x195)]],_0x548624=[..._0x507589['body'][_0x22de24(0x1e7)]],_0x174993=[..._0x507589[_0x22de24(0x183)][_0x22de24(0x1b1)]],_0x1ecd99=[..._0x507589['body'][_0x22de24(0x248)]],_0x200e2e=[..._0x507589[_0x22de24(0x183)][_0x22de24(0x224)]],_0x2aa9b8=[..._0x507589[_0x22de24(0x183)][_0x22de24(0x1f1)]],_0x356eae=[..._0x507589[_0x22de24(0x183)][_0x22de24(0x232)]],_0x1be100=[..._0x507589['body'][_0x22de24(0x165)]],_0x3868c0=[..._0x507589[_0x22de24(0x183)][_0x22de24(0x211)]];const _0x44e97b=_0xabd7f2[_0x22de24(0x249)](_0x23cab3=>{return _0x23cab3={'product_name':_0x23cab3};});_0x3abf54[_0x22de24(0x1c1)]((_0x776b0a,_0x5d9906)=>{var _0x108104=_0x22de24;_0x44e97b[_0x5d9906][_0x108104(0x233)]=_0x776b0a;}),_0x6f6648['forEach']((_0x22b461,_0x11db21)=>{_0x44e97b[_0x11db21]['quantity']=_0x22b461;}),_0x288dc7['forEach']((_0x472f09,_0x1f78c6)=>{var _0x591a99=_0x22de24;_0x44e97b[_0x1f78c6][_0x591a99(0x18b)]=_0x472f09;}),_0x43c606[_0x22de24(0x1c1)]((_0x237922,_0x526984)=>{_0x44e97b[_0x526984]['secondary_unit']=_0x237922;}),_0x5927e6[_0x22de24(0x1c1)]((_0x55c01d,_0x241780)=>{var _0x15d957=_0x22de24;_0x44e97b[_0x241780][_0x15d957(0x202)]=_0x55c01d;}),_0x45908a[_0x22de24(0x1c1)]((_0x76fe8c,_0x460b19)=>{_0x44e97b[_0x460b19]['primary_code']=_0x76fe8c;}),_0x42f0fd[_0x22de24(0x1c1)]((_0xba0ab0,_0x5ef71a)=>{var _0x3aa0bf=_0x22de24;_0x44e97b[_0x5ef71a][_0x3aa0bf(0x195)]=_0xba0ab0;}),_0x548624[_0x22de24(0x1c1)]((_0x2680dd,_0x9b23df)=>{var _0x1665d7=_0x22de24;_0x44e97b[_0x9b23df][_0x1665d7(0x25a)]=_0x2680dd;}),_0x174993['forEach']((_0x4e4791,_0x7ece4c)=>{var _0x2f1b8c=_0x22de24;_0x44e97b[_0x7ece4c][_0x2f1b8c(0x1b1)]=_0x4e4791;}),_0x1ecd99[_0x22de24(0x1c1)]((_0x4a5867,_0x258664)=>{var _0xac3e94=_0x22de24;_0x44e97b[_0x258664][_0xac3e94(0x248)]=_0x4a5867;}),_0x200e2e['forEach']((_0x259291,_0x558366)=>{var _0x15d5e6=_0x22de24;_0x44e97b[_0x558366][_0x15d5e6(0x230)]=_0x259291;}),_0x2aa9b8[_0x22de24(0x1c1)]((_0x4e6ac7,_0x19b941)=>{var _0x227d12=_0x22de24;_0x44e97b[_0x19b941][_0x227d12(0x256)]=_0x4e6ac7;}),_0x356eae[_0x22de24(0x1c1)]((_0x4916ad,_0x49dd16)=>{_0x44e97b[_0x49dd16]['product_cat']=_0x4916ad;}),_0x1be100[_0x22de24(0x1c1)]((_0x1233b9,_0x50eebe)=>{var _0x3db03e=_0x22de24;_0x44e97b[_0x50eebe][_0x3db03e(0x1a1)]=_0x1233b9;}),_0x3868c0[_0x22de24(0x1c1)]((_0x51cc32,_0x1384ad)=>{_0x44e97b[_0x1384ad]['invoice']=_0x51cc32;});const _0x3c696d=_0x44e97b[_0x22de24(0x1c8)](_0x403b29=>_0x403b29[_0x22de24(0x1fc)]!=='0'&&_0x403b29['quantity']!==''),_0x4a9cdb=new purchases_finished({'invoice':_0x3d3d39,'suppliers':_0x507589[_0x22de24(0x183)][_0x22de24(0x213)],'date':_0x4e8694,'warehouse_name':_0x4de708,'product':_0x3c696d,'note':_0x2c610d,'due_amount':_0x2d5367,'room':_0x36efbf,'POnumber':_0x2ee84f,'SCRN':_0x2ee434,'JO_number':_0x51264c}),_0x1044d2=await _0x4a9cdb[_0x22de24(0x252)](),_0x40f470=await purchases_finished[_0x22de24(0x240)]({'invoice':_0x3d3d39}),_0x3c546b=_0x40f470[_0x22de24(0x1d9)][_0x22de24(0x249)](async _0x25d246=>{var _0x58264c=_0x22de24,_0x58db39=await warehouse[_0x58264c(0x240)]({'name':_0x4de708,'room':_0x25d246[_0x58264c(0x1a1)]}),_0x1947d0=0x0;const _0x18c04e=_0x58db39[_0x58264c(0x16e)][_0x58264c(0x249)](_0xb0a48f=>{var _0x59e755=_0x58264c;console[_0x59e755(0x19e)](_0xb0a48f[_0x59e755(0x162)]+'=='+_0x25d246[_0x59e755(0x162)]+'&&'+_0xb0a48f[_0x59e755(0x202)]+'=='+_0x25d246['bay']+'&&'+_0xb0a48f[_0x59e755(0x248)]+'=='+_0x25d246[_0x59e755(0x248)]+'&&'+_0xb0a48f[_0x59e755(0x230)]+'=='+_0x25d246['production_date']+'&&'+_0xb0a48f[_0x59e755(0x1b1)]+'=='+_0x25d246['batch_code']+'&&'+_0xb0a48f[_0x59e755(0x1db)]+'=='+_0x40f470[_0x59e755(0x1db)]),_0xb0a48f[_0x59e755(0x162)]==_0x25d246[_0x59e755(0x162)]&&_0xb0a48f[_0x59e755(0x202)]==_0x25d246[_0x59e755(0x202)]&&_0xb0a48f[_0x59e755(0x248)]==_0x25d246[_0x59e755(0x248)]&&_0xb0a48f['production_date']==_0x25d246[_0x59e755(0x230)]&&_0xb0a48f[_0x59e755(0x1b1)]==_0x25d246[_0x59e755(0x1b1)]&&_0xb0a48f['invoice']==_0x40f470[_0x59e755(0x1db)]&&(_0xb0a48f[_0x59e755(0x20a)]=_0xb0a48f['product_stock']+_0x25d246[_0x59e755(0x1fc)],_0x1947d0++);});return _0x1947d0=='0'&&(_0x58db39[_0x58264c(0x16e)]=_0x58db39['product_details'][_0x58264c(0x1c2)]({'product_name':_0x25d246['product_name'],'product_stock':_0x25d246['quantity'],'primary_code':_0x25d246[_0x58264c(0x21a)],'secondary_code':_0x25d246[_0x58264c(0x195)],'product_code':_0x25d246['product_code'],'bay':_0x25d246['bay'],'maxProducts':_0x25d246[_0x58264c(0x25a)],'unit':_0x25d246[_0x58264c(0x18b)],'secondary_unit':_0x25d246['secondary_unit'],'expiry_date':_0x25d246[_0x58264c(0x248)],'production_date':_0x25d246[_0x58264c(0x230)],'maxProducts':_0x25d246[_0x58264c(0x25a)],'maxPerUnit':_0x25d246[_0x58264c(0x256)],'batch_code':_0x25d246[_0x58264c(0x1b1)],'product_cat':_0x25d246[_0x58264c(0x246)],'invoice':_0x25d246[_0x58264c(0x1db)]})),_0x58db39;});Promise[_0x22de24(0x175)](_0x3c546b)['then'](async _0x52c7e6=>{var _0x4ec6d3=_0x22de24;try{for(const _0x5bbb9f of _0x52c7e6){await warehouse[_0x4ec6d3(0x1d0)]({'_id':_0x5bbb9f['_id']},{'$addToSet':{'product_details':{'$each':_0x5bbb9f[_0x4ec6d3(0x16e)]}}});}const _0x50cbbd=await master_shop[_0x4ec6d3(0x173)](),_0x3dfaf0=await email_settings[_0x4ec6d3(0x240)](),_0x133d20=await supervisor_settings[_0x4ec6d3(0x173)]();var _0x4042bb=_0x40f470[_0x4ec6d3(0x1d9)],_0x533459='',_0x5587cd;for(_0x5587cd in _0x4042bb){var _0x4c3f78='FG';_0x40f470['warehouse_name']==_0x4ec6d3(0x24e)&&(_0x4c3f78='DG'),_0x533459+='<tr>'+_0x4ec6d3(0x1e2)+_0x4042bb[_0x5587cd][_0x4ec6d3(0x162)]+_0x4ec6d3(0x236)+_0x4ec6d3(0x1e2)+_0x4042bb[_0x5587cd][_0x4ec6d3(0x233)]+_0x4ec6d3(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4042bb[_0x5587cd][_0x4ec6d3(0x1fc)]+'</td>'+_0x4ec6d3(0x1e2)+_0x4042bb[_0x5587cd][_0x4ec6d3(0x18b)]+_0x4ec6d3(0x236)+_0x4ec6d3(0x1e2)+_0x4042bb[_0x5587cd][_0x4ec6d3(0x1b5)]+_0x4ec6d3(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x40f470[_0x4ec6d3(0x163)]+_0x4ec6d3(0x236)+_0x4ec6d3(0x1e2)+_0x4042bb[_0x5587cd][_0x4ec6d3(0x1a1)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c3f78+_0x4042bb[_0x5587cd][_0x4ec6d3(0x202)]+_0x4ec6d3(0x236),_0x4ec6d3(0x220);}let _0x32d076=nodemailer['createTransport']({'host':_0x3dfaf0[_0x4ec6d3(0x168)],'port':Number(_0x3dfaf0['port']),'secure':![],'auth':{'user':_0x3dfaf0[_0x4ec6d3(0x1a3)],'pass':_0x3dfaf0[_0x4ec6d3(0x19a)]}}),_0x605d32={'from':_0x3dfaf0[_0x4ec6d3(0x1a3)],'to':_0x133d20[0x0][_0x4ec6d3(0x169)],'subject':_0x4ec6d3(0x1bd),'attachments':[{'filename':_0x4ec6d3(0x186),'path':__dirname+_0x4ec6d3(0x21b)+_0x4ec6d3(0x18e)+_0x50cbbd[0x0]['image'],'cid':_0x4ec6d3(0x1c5)}],'html':'<!DOCTYPE\x20html>'+_0x4ec6d3(0x1e6)+_0x4ec6d3(0x201)+_0x4ec6d3(0x192)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4ec6d3(0x192)+_0x4ec6d3(0x15d)+_0x4ec6d3(0x255)+'<div>'+_0x4ec6d3(0x234)+_0x50cbbd[0x0][_0x4ec6d3(0x18d)]+_0x4ec6d3(0x194)+_0x4ec6d3(0x255)+_0x4ec6d3(0x255)+_0x4ec6d3(0x1ac)+_0x4ec6d3(0x192)+_0x4ec6d3(0x1ae)+_0x4ec6d3(0x21d)+_0x40f470[_0x4ec6d3(0x1db)]+'\x20'+_0x4ec6d3(0x1e9)+'\x20Order\x20Date\x20:\x20'+_0x40f470[_0x4ec6d3(0x231)]+'\x20'+'</span>'+'</h5>'+_0x4ec6d3(0x255)+_0x4ec6d3(0x19b)+_0x4ec6d3(0x23d)+_0x4ec6d3(0x20f)+_0x4ec6d3(0x1d1)+_0x4ec6d3(0x171)+_0x4ec6d3(0x16d)+_0x4ec6d3(0x1f8)+_0x4ec6d3(0x1d8)+_0x4ec6d3(0x208)+_0x4ec6d3(0x258)+_0x4ec6d3(0x1e4)+_0x4ec6d3(0x220)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x533459+'\x20'+_0x4ec6d3(0x21c)+_0x4ec6d3(0x15e)+'<div>'+_0x4ec6d3(0x199)+'<h5>'+_0x50cbbd[0x0]['site_title']+_0x4ec6d3(0x1f0)+'</div>'+_0x4ec6d3(0x255)+'</body></html>'};_0x32d076['sendMail'](_0x605d32,function(_0x292f67,_0x14c362){var _0x5d5b43=_0x4ec6d3;_0x292f67?(console['log'](_0x292f67),console[_0x5d5b43(0x19e)](_0x5d5b43(0x1de))):console[_0x5d5b43(0x19e)](_0x5d5b43(0x200));});}catch(_0x46fd9d){console[_0x4ec6d3(0x1bc)](_0x46fd9d),_0x2c4645['status'](0x1f4)[_0x4ec6d3(0x1c7)]({'error':_0x4ec6d3(0x210),'message':_0x46fd9d[_0x4ec6d3(0x22a)]});}})[_0x22de24(0x17a)](_0x4b9b75=>{var _0x1051f3=_0x22de24;console[_0x1051f3(0x1bc)](_0x4b9b75),_0x2c4645[_0x1051f3(0x1a8)](0x1f4)[_0x1051f3(0x1c7)]({'error':'An\x20error\x20occurred.'});}),_0x507589['flash'](_0x22de24(0x16f),'purchase\x20data\x20add\x20successfully'),_0x2c4645[_0x22de24(0x1fd)]('/all_purchases_finished/view');}catch(_0x59fe34){console[_0x22de24(0x19e)](_0x59fe34);}}),router[a0_0x1f5b25(0x1a2)]('/preview/:id',auth,async(_0x48b12b,_0x1a3a1f)=>{var _0x2f6ed4=a0_0x1f5b25;try{const {username:_0x3c745a,email:_0x5bff9f,role:_0x294dc9}=_0x48b12b[_0x2f6ed4(0x1cb)],_0x2f8333=_0x48b12b[_0x2f6ed4(0x1cb)],_0x5d3b2e=await profile[_0x2f6ed4(0x240)]({'email':_0x2f8333[_0x2f6ed4(0x1a3)]}),_0x52ddc4=await master_shop[_0x2f6ed4(0x173)](),_0x58fe55=_0x48b12b['params']['id'],_0x2e86b=await purchases_finished[_0x2f6ed4(0x20b)](_0x58fe55),_0x55093a=await suppliers['find']({});let _0x25629f;if(_0x2f8333[_0x2f6ed4(0x1fb)]=='staff'){const _0x53b66d=await staff[_0x2f6ed4(0x240)]({'email':_0x2f8333[_0x2f6ed4(0x1a3)]});_0x25629f=await warehouse[_0x2f6ed4(0x173)]({'status':_0x2f6ed4(0x23b),'name':_0x53b66d[_0x2f6ed4(0x198)],'warehouse_category':_0x2f6ed4(0x1a5)});}else _0x25629f=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x2f6ed4(0x1a5)}},{'$group':{'_id':_0x2f6ed4(0x180),'name':{'$first':_0x2f6ed4(0x180)}}}]);const _0x473824=await product[_0x2f6ed4(0x173)]({}),_0x1f9d8c=BayBinSelected(_0x2e86b['warehouse_name'],_0x2e86b[_0x2f6ed4(0x22b)]);let _0x4f9d4f=new Date(_0x2e86b[_0x2f6ed4(0x248)]),_0x5d5423=('0'+_0x4f9d4f[_0x2f6ed4(0x1f2)]())[_0x2f6ed4(0x1bf)](-0x2),_0x962c3e=('0'+(_0x4f9d4f[_0x2f6ed4(0x184)]()+0x1))[_0x2f6ed4(0x1bf)](-0x2),_0x23376d=_0x4f9d4f[_0x2f6ed4(0x1c4)](),_0x387a6b=_0x23376d+'-'+_0x962c3e+'-'+_0x5d5423;if(_0x52ddc4[0x0]['language']=='English\x20(US)'){var _0x1513b3=users[_0x2f6ed4(0x22d)];console[_0x2f6ed4(0x19e)](_0x1513b3);}else{if(_0x52ddc4[0x0][_0x2f6ed4(0x203)]==_0x2f6ed4(0x15f))var _0x1513b3=users['Hindi'];else{if(_0x52ddc4[0x0][_0x2f6ed4(0x203)]=='German')var _0x1513b3=users[_0x2f6ed4(0x229)];else{if(_0x52ddc4[0x0][_0x2f6ed4(0x203)]==_0x2f6ed4(0x1dc))var _0x1513b3=users[_0x2f6ed4(0x1dc)];else{if(_0x52ddc4[0x0][_0x2f6ed4(0x203)]==_0x2f6ed4(0x1b0))var _0x1513b3=users[_0x2f6ed4(0x1b0)];else{if(_0x52ddc4[0x0][_0x2f6ed4(0x203)]==_0x2f6ed4(0x1c6))var _0x1513b3=users[_0x2f6ed4(0x179)];else{if(_0x52ddc4[0x0][_0x2f6ed4(0x203)]=='Chinese')var _0x1513b3=users[_0x2f6ed4(0x1e8)];else{if(_0x52ddc4[0x0][_0x2f6ed4(0x203)]=='Arabic\x20(ae)')var _0x1513b3=users[_0x2f6ed4(0x193)];}}}}}}}_0x1a3a1f[_0x2f6ed4(0x1f6)](_0x2f6ed4(0x196),{'success':_0x48b12b[_0x2f6ed4(0x16c)]('success'),'errors':_0x48b12b[_0x2f6ed4(0x16c)](_0x2f6ed4(0x1ec)),'role':_0x2f8333,'profile':_0x5d3b2e,'purchases':_0x2e86b,'suppliers':_0x55093a,'warehouse':_0x25629f,'product':_0x473824,'master_shop':_0x52ddc4,'language':_0x1513b3,'ed_fullDate':_0x387a6b,'dataSelected':_0x1f9d8c});}catch(_0x2e0d74){console[_0x2f6ed4(0x19e)](_0x2e0d74);}}),router[a0_0x1f5b25(0x1a2)]('/view/:id',auth,async(_0x41c26e,_0x2d53fc)=>{var _0x36d093=a0_0x1f5b25;try{const {username:_0x20884f,email:_0x17105c,role:_0x573f30}=_0x41c26e[_0x36d093(0x1cb)],_0x281985=_0x41c26e[_0x36d093(0x1cb)],_0x3d5fdc=await profile['findOne']({'email':_0x281985[_0x36d093(0x1a3)]}),_0x3b95ec=await master_shop[_0x36d093(0x173)](),_0x22816d=_0x41c26e['params']['id'],_0x1a0c55=await purchases_finished[_0x36d093(0x20b)](_0x22816d),_0x27500e=await suppliers['find']({});let _0x13ccb9;if(_0x281985[_0x36d093(0x1fb)]==_0x36d093(0x1cc)){const _0x100793=await staff[_0x36d093(0x240)]({'email':_0x281985[_0x36d093(0x1a3)]});_0x13ccb9=await warehouse[_0x36d093(0x173)]({'status':_0x36d093(0x23b),'name':_0x100793[_0x36d093(0x198)],'warehouse_category':_0x36d093(0x1a5)});}else _0x13ccb9=await warehouse['aggregate']([{'$match':{'status':_0x36d093(0x23b),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x36d093(0x180),'name':{'$first':_0x36d093(0x180)}}}]);const _0x183da7=await product[_0x36d093(0x173)]({}),_0x33d822=BayBinSelected(_0x1a0c55[_0x36d093(0x163)],_0x1a0c55['room']);let _0x3096ab=new Date(_0x1a0c55[_0x36d093(0x248)]),_0x2386ec=('0'+_0x3096ab[_0x36d093(0x1f2)]())[_0x36d093(0x1bf)](-0x2),_0x3d12f0=('0'+(_0x3096ab['getMonth']()+0x1))[_0x36d093(0x1bf)](-0x2),_0x2d75e6=_0x3096ab[_0x36d093(0x1c4)](),_0x31cdfe=_0x2d75e6+'-'+_0x3d12f0+'-'+_0x2386ec;if(_0x3b95ec[0x0]['language']==_0x36d093(0x207)){var _0x146100=users[_0x36d093(0x22d)];console[_0x36d093(0x19e)](_0x146100);}else{if(_0x3b95ec[0x0][_0x36d093(0x203)]==_0x36d093(0x15f))var _0x146100=users['Hindi'];else{if(_0x3b95ec[0x0][_0x36d093(0x203)]==_0x36d093(0x229))var _0x146100=users[_0x36d093(0x229)];else{if(_0x3b95ec[0x0][_0x36d093(0x203)]=='Spanish')var _0x146100=users[_0x36d093(0x1dc)];else{if(_0x3b95ec[0x0][_0x36d093(0x203)]==_0x36d093(0x1b0))var _0x146100=users['French'];else{if(_0x3b95ec[0x0][_0x36d093(0x203)]=='Portuguese\x20(BR)')var _0x146100=users['Portuguese'];else{if(_0x3b95ec[0x0]['language']==_0x36d093(0x1e8))var _0x146100=users['Chinese'];else{if(_0x3b95ec[0x0][_0x36d093(0x203)]==_0x36d093(0x18f))var _0x146100=users['Arabic'];}}}}}}}_0x2d53fc[_0x36d093(0x1f6)](_0x36d093(0x243),{'success':_0x41c26e[_0x36d093(0x16c)](_0x36d093(0x16f)),'errors':_0x41c26e[_0x36d093(0x16c)]('errors'),'role':_0x281985,'profile':_0x3d5fdc,'purchases':_0x1a0c55,'suppliers':_0x27500e,'warehouse':_0x13ccb9,'product':_0x183da7,'master_shop':_0x3b95ec,'language':_0x146100,'ed_fullDate':_0x31cdfe,'dataSelected':_0x33d822});}catch(_0x46f770){console['log'](_0x46f770);}}),router[a0_0x1f5b25(0x189)](a0_0x1f5b25(0x217),auth,async(_0x534454,_0x2a0b80)=>{var _0x68368d=a0_0x1f5b25;try{const _0x5edcf2=_0x534454[_0x68368d(0x1af)]['id'],_0x359c59=await purchases_finished['findOne']({'_id':_0x534454['params']['id']}),_0x383178=await warehouse['findOne']({'name':_0x359c59[_0x68368d(0x163)],'room':_0x359c59[_0x68368d(0x22b)]});_0x359c59[_0x68368d(0x1d9)]['forEach'](_0x33b601=>{var _0x59fcf1=_0x68368d;const _0x16b2ba=_0x383178[_0x59fcf1(0x16e)][_0x59fcf1(0x249)](_0x10f0f9=>{var _0x472fcc=_0x59fcf1;_0x10f0f9[_0x472fcc(0x162)]==_0x33b601[_0x472fcc(0x162)]&&_0x10f0f9[_0x472fcc(0x202)]==_0x33b601[_0x472fcc(0x202)]&&(_0x10f0f9[_0x472fcc(0x20a)]=parseInt(_0x10f0f9[_0x472fcc(0x20a)])-parseInt(_0x33b601[_0x472fcc(0x1fc)]));});}),await _0x383178[_0x68368d(0x252)]();const {invoice:_0x40940d,suppliers:_0x5580eb,date:_0xc6013d,warehouse_name:_0x2343f8,prod_name:_0x3b0cec,prod_code:_0x1d4bee,prod_qty:_0x57cc06,prod_unit:_0x109f64,prod_secondunit:_0x3c99ae,prod_level:_0x2b101f,prod_isle:_0x2338e7,prod_pallet:_0x5e1ca4,note:_0x398788,expiry_date:_0x168bd8,batch_code:_0x3f69ac,paid_amount:_0x18ee68,due_amount:_0x183206,Room_name:_0x147ae5,primary_code:_0x55f9c5,secondary_code:_0x39b227,PO_number:_0x25175b,JO_number:_0x4ecb2f}=_0x534454['body'];if(typeof _0x3b0cec=='string')var _0x21e1c8=[_0x534454['body'][_0x68368d(0x238)]],_0xffab5=[_0x534454[_0x68368d(0x183)]['prod_code']],_0xf7a4ee=[_0x534454[_0x68368d(0x183)][_0x68368d(0x237)]],_0x51390d=[_0x534454[_0x68368d(0x183)][_0x68368d(0x1b7)]],_0x2bcdfc=[_0x534454['body']['prod_secondunit']],_0x6cf2e3=[_0x534454[_0x68368d(0x183)][_0x68368d(0x239)]],_0x2f9ace=[_0x534454[_0x68368d(0x183)][_0x68368d(0x21a)]],_0x4f7387=[_0x534454[_0x68368d(0x183)][_0x68368d(0x195)]],_0x4875d1=[_0x534454['body'][_0x68368d(0x1e7)]],_0x589b1b=[_0x534454[_0x68368d(0x183)][_0x68368d(0x1b1)]],_0x5eb87e=[_0x534454['body']['expiry_date']];else var _0x21e1c8=[..._0x534454['body'][_0x68368d(0x238)]],_0xffab5=[..._0x534454['body']['prod_code']],_0xf7a4ee=[..._0x534454[_0x68368d(0x183)][_0x68368d(0x237)]],_0x51390d=[..._0x534454[_0x68368d(0x183)][_0x68368d(0x1b7)]],_0x2bcdfc=[..._0x534454['body'][_0x68368d(0x1b3)]],_0x6cf2e3=[..._0x534454[_0x68368d(0x183)][_0x68368d(0x239)]],_0x2f9ace=[..._0x534454[_0x68368d(0x183)][_0x68368d(0x21a)]],_0x4f7387=[..._0x534454[_0x68368d(0x183)][_0x68368d(0x195)]],_0x4875d1=[..._0x534454[_0x68368d(0x183)]['MaxStocks_data']],_0x589b1b=[..._0x534454[_0x68368d(0x183)][_0x68368d(0x1b1)]],_0x5eb87e=[..._0x534454[_0x68368d(0x183)][_0x68368d(0x248)]];const _0x49e1df=_0x21e1c8[_0x68368d(0x249)](_0x36cc61=>{return _0x36cc61={'product_name':_0x36cc61};});_0xffab5[_0x68368d(0x1c1)]((_0x5c02e3,_0x4c9ccb)=>{_0x49e1df[_0x4c9ccb]['product_code']=_0x5c02e3;}),_0xf7a4ee[_0x68368d(0x1c1)]((_0x4d9dc5,_0x5a9c7e)=>{_0x49e1df[_0x5a9c7e]['quantity']=_0x4d9dc5;}),_0x51390d[_0x68368d(0x1c1)]((_0x1d06ed,_0x26558b)=>{var _0x30fb50=_0x68368d;_0x49e1df[_0x26558b][_0x30fb50(0x18b)]=_0x1d06ed;}),_0x2bcdfc[_0x68368d(0x1c1)]((_0x4e6833,_0x39c9c2)=>{_0x49e1df[_0x39c9c2]['secondary_unit']=_0x4e6833;}),_0x6cf2e3['forEach']((_0xad8e23,_0xf3e5ed)=>{var _0x4f9ede=_0x68368d;_0x49e1df[_0xf3e5ed][_0x4f9ede(0x202)]=_0xad8e23;}),_0x2f9ace[_0x68368d(0x1c1)]((_0x23af2c,_0x484452)=>{var _0x37af4b=_0x68368d;_0x49e1df[_0x484452][_0x37af4b(0x21a)]=_0x23af2c;}),_0x4f7387[_0x68368d(0x1c1)]((_0x21e700,_0x2b2563)=>{var _0x20ede1=_0x68368d;_0x49e1df[_0x2b2563][_0x20ede1(0x195)]=_0x21e700;}),_0x4875d1[_0x68368d(0x1c1)]((_0x4c77b2,_0x4d2432)=>{var _0x21eefe=_0x68368d;_0x49e1df[_0x4d2432][_0x21eefe(0x25a)]=_0x4c77b2;}),_0x589b1b[_0x68368d(0x1c1)]((_0x44cfba,_0x46056d)=>{_0x49e1df[_0x46056d]['batch_code']=_0x44cfba;}),_0x5eb87e[_0x68368d(0x1c1)]((_0x1be6fe,_0x178968)=>{var _0x4d3310=_0x68368d;_0x49e1df[_0x178968][_0x4d3310(0x248)]=_0x1be6fe;});const _0x1d8e3a=_0x49e1df[_0x68368d(0x1c8)](_0x3c217a=>_0x3c217a['quantity']!=='0'&&_0x3c217a['quantity']!=='');_0x359c59['invoice']=_0x40940d,_0x359c59[_0x68368d(0x213)]=_0x5580eb,_0x359c59[_0x68368d(0x231)]=_0xc6013d,_0x359c59[_0x68368d(0x163)]=_0x2343f8,_0x359c59[_0x68368d(0x1d9)]=_0x1d8e3a,_0x359c59['note']=_0x398788,_0x359c59[_0x68368d(0x205)]=_0x18ee68,_0x359c59['due_amount']=_0x183206,_0x359c59[_0x68368d(0x22b)]=_0x147ae5,_0x359c59[_0x68368d(0x1a6)]=_0x25175b,_0x359c59[_0x68368d(0x177)]=_0x4ecb2f;const _0x2f0c52=await _0x359c59[_0x68368d(0x252)](),_0x3a4ddf=await warehouse[_0x68368d(0x240)]({'name':_0x534454[_0x68368d(0x183)][_0x68368d(0x163)],'room':_0x534454[_0x68368d(0x183)][_0x68368d(0x1ef)]});_0x359c59[_0x68368d(0x1d9)]['forEach'](_0x24bd92=>{var _0x1ede62=_0x68368d,_0x178f44=0x0;const _0x55b332=_0x3a4ddf[_0x1ede62(0x16e)]['map'](_0x8fd7b2=>{var _0xcc3f33=_0x1ede62;_0x8fd7b2['product_name']==_0x24bd92[_0xcc3f33(0x162)]&&_0x8fd7b2[_0xcc3f33(0x202)]==_0x24bd92['bay']&&(_0x8fd7b2[_0xcc3f33(0x20a)]=parseInt(_0x8fd7b2[_0xcc3f33(0x20a)])+parseInt(_0x24bd92['quantity']),_0x178f44++);});_0x178f44=='0'&&(_0x3a4ddf[_0x1ede62(0x16e)]=_0x3a4ddf['product_details']['concat']({'product_name':_0x24bd92[_0x1ede62(0x162)],'product_stock':_0x24bd92[_0x1ede62(0x1fc)],'primary_code':_0x24bd92[_0x1ede62(0x21a)],'secondary_code':_0x24bd92[_0x1ede62(0x195)],'product_code':_0x24bd92[_0x1ede62(0x233)],'bay':_0x24bd92[_0x1ede62(0x202)],'maxProducts':_0x24bd92[_0x1ede62(0x25a)],'unit':_0x24bd92[_0x1ede62(0x18b)],'secondary_unit':_0x24bd92[_0x1ede62(0x1b5)],'expiry_date':_0x24bd92[_0x1ede62(0x248)]}));}),await _0x3a4ddf[_0x68368d(0x252)]();const _0x2d988d=await s_payment_data['findOne']({'invoice':_0x534454[_0x68368d(0x183)]['invoice']});if(_0x2d988d===null){}else console[_0x68368d(0x19e)](_0x68368d(0x213),_0x2d988d,_0x534454[_0x68368d(0x183)][_0x68368d(0x1db)]),_0x2d988d[_0x68368d(0x213)]=_0x534454[_0x68368d(0x183)][_0x68368d(0x213)],await _0x2d988d['save']();_0x534454['flash'](_0x68368d(0x16f),_0x68368d(0x1b8)),_0x2a0b80[_0x68368d(0x1fd)](_0x68368d(0x1b6));}catch(_0x1509f1){console[_0x68368d(0x19e)](_0x1509f1);}}),router[a0_0x1f5b25(0x189)]('/give_payment/:id',auth,async(_0x5631cb,_0x1336d0)=>{var _0x27a07b=a0_0x1f5b25;try{const _0x43a7b0=_0x5631cb[_0x27a07b(0x1af)]['id'],{invoice:_0x35e1fd,suppliers:_0x481748,payable:_0x4b02c5,due_amount:_0x43e8a5}=_0x5631cb[_0x27a07b(0x183)],_0x366dce=await purchases[_0x27a07b(0x20b)](_0x43a7b0);var _0x43e9fb=_0x4b02c5-_0x43e8a5;_0x366dce[_0x27a07b(0x205)]=parseFloat(_0x366dce[_0x27a07b(0x205)])+parseFloat(_0x43e8a5),_0x366dce[_0x27a07b(0x1a4)]=_0x43e9fb;const _0x457157=await _0x366dce[_0x27a07b(0x252)]();console[_0x27a07b(0x19e)](_0x457157);const _0x464e9b=await s_payment_data[_0x27a07b(0x240)]({'invoice':_0x35e1fd});_0x464e9b[_0x27a07b(0x225)]=_0x43e9fb,await _0x464e9b[_0x27a07b(0x252)]();let _0x5969d8=new Date(),_0x3a6b87=('0'+_0x5969d8[_0x27a07b(0x1f2)]())[_0x27a07b(0x1bf)](-0x2),_0x58ee93=('0'+(_0x5969d8[_0x27a07b(0x184)]()+0x1))[_0x27a07b(0x1bf)](-0x2),_0x5ce6da=_0x5969d8[_0x27a07b(0x1c4)](),_0x15cb4e=_0x5ce6da+'-'+_0x58ee93+'-'+_0x3a6b87;const _0x3cf5e3=new suppliers_payment({'invoice':_0x35e1fd,'date':_0x5ce6da+'-'+_0x58ee93+'-'+_0x3a6b87,'suppliers':_0x481748,'reason':_0x27a07b(0x1d6),'amount':_0x43e8a5}),_0x5405a4=await _0x3cf5e3[_0x27a07b(0x252)]();_0x5631cb[_0x27a07b(0x16c)](_0x27a07b(0x16f),_0x27a07b(0x1fa)),_0x1336d0[_0x27a07b(0x1fd)](_0x27a07b(0x241));}catch(_0x16eeb5){console[_0x27a07b(0x19e)](_0x16eeb5);}}),router[a0_0x1f5b25(0x1a2)](a0_0x1f5b25(0x216),auth,async(_0x4ca737,_0x2da71f)=>{var _0x2d7eae=a0_0x1f5b25;try{const {username:_0x491c8d,email:_0x293b73,role:_0x5c309c}=_0x4ca737[_0x2d7eae(0x1cb)],_0x452109=_0x4ca737[_0x2d7eae(0x1cb)],_0x790d51=await profile[_0x2d7eae(0x240)]({'email':_0x452109['email']}),_0x4a885f=await master_shop[_0x2d7eae(0x173)]();console[_0x2d7eae(0x19e)](_0x2d7eae(0x254),_0x4a885f);const _0x5c04a9=_0x4ca737[_0x2d7eae(0x1af)]['id'],_0xc00c92=await purchases[_0x2d7eae(0x20b)](_0x5c04a9);console[_0x2d7eae(0x19e)](_0xc00c92);const _0x142e9e=await suppliers[_0x2d7eae(0x240)]({'name':_0xc00c92['suppliers']});console['log'](_0x142e9e);if(_0x4a885f[0x0][_0x2d7eae(0x203)]=='English\x20(US)'){var _0x4ed8a9=users[_0x2d7eae(0x22d)];console[_0x2d7eae(0x19e)](_0x4ed8a9);}else{if(_0x4a885f[0x0]['language']==_0x2d7eae(0x15f))var _0x4ed8a9=users['Hindi'];else{if(_0x4a885f[0x0][_0x2d7eae(0x203)]==_0x2d7eae(0x229))var _0x4ed8a9=users['German'];else{if(_0x4a885f[0x0][_0x2d7eae(0x203)]==_0x2d7eae(0x1dc))var _0x4ed8a9=users[_0x2d7eae(0x1dc)];else{if(_0x4a885f[0x0]['language']==_0x2d7eae(0x1b0))var _0x4ed8a9=users[_0x2d7eae(0x1b0)];else{if(_0x4a885f[0x0][_0x2d7eae(0x203)]=='Portuguese\x20(BR)')var _0x4ed8a9=users[_0x2d7eae(0x179)];else{if(_0x4a885f[0x0][_0x2d7eae(0x203)]=='Chinese')var _0x4ed8a9=users[_0x2d7eae(0x1e8)];else{if(_0x4a885f[0x0][_0x2d7eae(0x203)]==_0x2d7eae(0x18f))var _0x4ed8a9=users[_0x2d7eae(0x193)];}}}}}}}_0x2da71f['render'](_0x2d7eae(0x17e),{'success':_0x4ca737[_0x2d7eae(0x16c)](_0x2d7eae(0x16f)),'errors':_0x4ca737[_0x2d7eae(0x16c)](_0x2d7eae(0x1ec)),'role':_0x452109,'profile':_0x790d51,'master_shop':_0x4a885f,'supplier':_0x142e9e,'purchase':_0xc00c92,'language':_0x4ed8a9});}catch(_0xdcf78d){console[_0x2d7eae(0x19e)](_0xdcf78d);}}),router[a0_0x1f5b25(0x1a2)](a0_0x1f5b25(0x23a),auth,async(_0x33fac0,_0x1ef733)=>{var _0x2245fa=a0_0x1f5b25;try{const {username:_0x6e6f65,email:_0x1d0382,role:_0x50f5ed}=_0x33fac0[_0x2245fa(0x1cb)],_0xe3e901=_0x33fac0['user'],_0x488dc3=await profile[_0x2245fa(0x240)]({'email':_0xe3e901[_0x2245fa(0x1a3)]}),_0x377531=await master_shop[_0x2245fa(0x173)]();console[_0x2245fa(0x19e)](_0x2245fa(0x254),_0x377531);const _0x5c6e39=_0x33fac0['params']['id'];console[_0x2245fa(0x19e)](_0x5c6e39);const _0x1d77f3=await purchases_finished[_0x2245fa(0x20b)](_0x5c6e39);console[_0x2245fa(0x19e)](_0x2245fa(0x1c0),_0x1d77f3);const _0xd6a73d=await product[_0x2245fa(0x173)]({}),_0x438665=await warehouse[_0x2245fa(0x219)]([{'$match':{'name':_0x1d77f3[_0x2245fa(0x163)],'room':_0x1d77f3[_0x2245fa(0x22b)]}},{'$unwind':_0x2245fa(0x23e)},{'$group':{'_id':_0x2245fa(0x190),'name':{'$first':_0x2245fa(0x1e1)},'product_stock':{'$first':_0x2245fa(0x1e3)},'bay':{'$first':_0x2245fa(0x18a)},'bin':{'$first':_0x2245fa(0x1eb)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2245fa(0x214)},'primary_code':{'$first':_0x2245fa(0x174)},'secondary_code':{'$first':_0x2245fa(0x24c)},'product_code':{'$first':_0x2245fa(0x253)},'storage':{'$first':_0x2245fa(0x221)},'rack':{'$first':'$product_details.rack'}}}]);console['log'](_0x2245fa(0x209),_0x438665);let _0x37194d;if(_0xe3e901[_0x2245fa(0x1fb)]==_0x2245fa(0x1cc)){const _0x19e6e2=await staff['findOne']({'email':_0xe3e901[_0x2245fa(0x1a3)]});_0x37194d=await warehouse[_0x2245fa(0x173)]({'status':_0x2245fa(0x23b),'name':_0x19e6e2['warehouse'],'warehouse_category':_0x2245fa(0x1a5),'name':'Return\x20Goods'});}else _0x37194d=await warehouse[_0x2245fa(0x219)]([{'$match':{'status':_0x2245fa(0x23b),'warehouse_category':_0x2245fa(0x1a5),'name':_0x2245fa(0x19f)}},{'$group':{'_id':'$name','name':{'$first':_0x2245fa(0x180)}}}]);if(_0x377531[0x0][_0x2245fa(0x203)]==_0x2245fa(0x207)){var _0x13612a=users[_0x2245fa(0x22d)];console[_0x2245fa(0x19e)](_0x13612a);}else{if(_0x377531[0x0][_0x2245fa(0x203)]==_0x2245fa(0x15f))var _0x13612a=users['Hindi'];else{if(_0x377531[0x0][_0x2245fa(0x203)]==_0x2245fa(0x229))var _0x13612a=users['German'];else{if(_0x377531[0x0][_0x2245fa(0x203)]==_0x2245fa(0x1dc))var _0x13612a=users[_0x2245fa(0x1dc)];else{if(_0x377531[0x0]['language']=='French')var _0x13612a=users[_0x2245fa(0x1b0)];else{if(_0x377531[0x0][_0x2245fa(0x203)]==_0x2245fa(0x1c6))var _0x13612a=users[_0x2245fa(0x179)];else{if(_0x377531[0x0][_0x2245fa(0x203)]==_0x2245fa(0x1e8))var _0x13612a=users['Chinese'];else{if(_0x377531[0x0][_0x2245fa(0x203)]==_0x2245fa(0x18f))var _0x13612a=users['Arabic'];}}}}}}}_0x1ef733[_0x2245fa(0x1f6)](_0x2245fa(0x1ea),{'success':_0x33fac0[_0x2245fa(0x16c)]('success'),'errors':_0x33fac0['flash'](_0x2245fa(0x1ec)),'role':_0xe3e901,'profile':_0x488dc3,'user':_0x1d77f3,'stock':_0x438665,'master_shop':_0x377531,'product':_0xd6a73d,'language':_0x13612a,'warehouse':_0x37194d});}catch(_0x32bdcd){console[_0x2245fa(0x19e)](_0x32bdcd);}}),router[a0_0x1f5b25(0x189)](a0_0x1f5b25(0x23a),auth,async(_0x3a3d82,_0x6f174a)=>{var _0x10e281=a0_0x1f5b25;try{const {invoice:_0x1ed342,date:_0x2acce4,warehouse_name:_0x2cf6fb,Room_name:_0x32e9de,product_name:_0x3cfe25,purchase_quantity:_0x8b6378,stocks:_0x1aa4cc,return_qty:_0xb4acd0,note:_0x172d6f,level:_0x487dfa,isle:_0xbe31dd,pallet:_0x4eecc9,to_warehouse_name:_0x53d8ec,to_Room_name:_0x253d56}=_0x3a3d82[_0x10e281(0x183)],_0x2a3165=await purchases_finished[_0x10e281(0x240)]({'_id':_0x3a3d82[_0x10e281(0x1af)]['id']}),_0x94eaff=await warehouse['findOne']({'name':_0x2cf6fb,'room':_0x32e9de,'warehouse_category':_0x10e281(0x1a5)});if(typeof _0x3cfe25==_0x10e281(0x227))var _0x44c956=[_0x3a3d82[_0x10e281(0x183)][_0x10e281(0x162)]],_0x50baae=[_0x3a3d82['body'][_0x10e281(0x1fe)]],_0x514b05=[_0x3a3d82[_0x10e281(0x183)][_0x10e281(0x25b)]],_0x52bb1e=[_0x3a3d82[_0x10e281(0x183)]['return_qty']],_0x16eba5=[_0x3a3d82[_0x10e281(0x183)][_0x10e281(0x21e)]],_0x5c1b23=[_0x3a3d82['body'][_0x10e281(0x166)]],_0xb9f618=[_0x3a3d82[_0x10e281(0x183)][_0x10e281(0x22f)]],_0x129563=[_0x3a3d82['body']['secondary_code_hide']];else var _0x44c956=[..._0x3a3d82[_0x10e281(0x183)]['product_name']],_0x50baae=[..._0x3a3d82[_0x10e281(0x183)][_0x10e281(0x1fe)]],_0x514b05=[..._0x3a3d82[_0x10e281(0x183)][_0x10e281(0x25b)]],_0x52bb1e=[..._0x3a3d82['body'][_0x10e281(0x1bb)]],_0x16eba5=[..._0x3a3d82[_0x10e281(0x183)][_0x10e281(0x21e)]],_0x5c1b23=[..._0x3a3d82[_0x10e281(0x183)][_0x10e281(0x166)]],_0xb9f618=[..._0x3a3d82[_0x10e281(0x183)][_0x10e281(0x22f)]],_0x129563=[..._0x3a3d82[_0x10e281(0x183)][_0x10e281(0x1c3)]];const _0x1b99e4=_0x44c956[_0x10e281(0x249)](_0x5f3798=>{return _0x5f3798={'product_name':_0x5f3798};});_0x50baae[_0x10e281(0x1c1)]((_0x466365,_0x59fc8f)=>{var _0x5b9bad=_0x10e281;_0x1b99e4[_0x59fc8f][_0x5b9bad(0x1fe)]=_0x466365;}),_0x514b05[_0x10e281(0x1c1)]((_0x2c3c5a,_0x1f9831)=>{_0x1b99e4[_0x1f9831]['stock_quantity']=_0x2c3c5a;}),_0x52bb1e[_0x10e281(0x1c1)]((_0x14953a,_0x38b556)=>{_0x1b99e4[_0x38b556]['return_qty']=_0x14953a;}),_0x16eba5['forEach']((_0x1b603f,_0x317f51)=>{var _0x3678f3=_0x10e281;_0x1b99e4[_0x317f51][_0x3678f3(0x202)]=_0x1b603f;}),_0x5c1b23[_0x10e281(0x1c1)]((_0x20f60a,_0x4afb21)=>{var _0x575cf9=_0x10e281;_0x1b99e4[_0x4afb21][_0x575cf9(0x233)]=_0x20f60a;}),_0xb9f618[_0x10e281(0x1c1)]((_0x3a8d00,_0x42cf96)=>{var _0x2de10b=_0x10e281;_0x1b99e4[_0x42cf96][_0x2de10b(0x21a)]=_0x3a8d00;}),_0x129563[_0x10e281(0x1c1)]((_0x231d8a,_0x110683)=>{var _0x4c75fe=_0x10e281;_0x1b99e4[_0x110683][_0x4c75fe(0x195)]=_0x231d8a;}),_0x1b99e4[_0x10e281(0x1c1)](_0x3b43b9=>{var _0x33791a=_0x10e281;console[_0x33791a(0x19e)](_0x3b43b9);const _0x2ada3e=_0x94eaff[_0x33791a(0x16e)][_0x33791a(0x249)](_0x253bea=>{var _0xac6e8=_0x33791a;_0x253bea[_0xac6e8(0x162)]==_0x3b43b9[_0xac6e8(0x162)]&&_0x253bea['bay']==_0x3b43b9[_0xac6e8(0x202)]&&(console[_0xac6e8(0x19e)](parseInt(_0x253bea[_0xac6e8(0x20a)])+_0xac6e8(0x222)+parseInt(_0x3b43b9[_0xac6e8(0x1bb)])),_0x253bea[_0xac6e8(0x20a)]=parseInt(_0x253bea[_0xac6e8(0x20a)])-parseInt(_0x3b43b9['return_qty']));});}),await _0x94eaff['save']();var _0x36082f=0x0;_0x1b99e4[_0x10e281(0x1c1)](_0x41d76f=>{var _0x148d42=_0x10e281;(parseInt(_0x41d76f['purchase_quantity'])<parseInt(_0x41d76f['return_qty'])||parseInt(_0x41d76f[_0x148d42(0x164)])<parseInt(_0x41d76f[_0x148d42(0x1bb)]))&&_0x36082f++;});if(_0x36082f!=0x0)return _0x3a3d82['flash'](_0x10e281(0x1ec),_0x10e281(0x206)),_0x6f174a['redirect'](_0x10e281(0x17b));const _0x3e4cd7=new purchases_return_finished({'invoice':_0x1ed342,'suppliers':_0x3a3d82[_0x10e281(0x183)][_0x10e281(0x213)],'date':_0x2acce4,'warehouse_name':_0x2cf6fb,'return_product':_0x1b99e4,'note':_0x172d6f,'room':_0x32e9de,'to_warehouse_name':_0x53d8ec,'to_room':_0x253d56}),_0x1fc68f=await _0x3e4cd7[_0x10e281(0x252)](),_0x7f6eab=await purchases_return_finished['findOne']({'invoice':_0x1ed342}),_0x22107c=await warehouse[_0x10e281(0x240)]({'name':_0x53d8ec,'room':_0x253d56,'warehouse_category':_0x10e281(0x1a5)});_0x7f6eab[_0x10e281(0x191)]['forEach'](_0x36eed5=>{var _0x292bf1=_0x10e281,_0x5704e6=0x0;const _0x20b5e3=_0x22107c['product_details'][_0x292bf1(0x249)](_0x26f180=>{var _0x50d6cc=_0x292bf1;console[_0x50d6cc(0x19e)](_0x26f180[_0x50d6cc(0x162)]+'=='+_0x36eed5[_0x50d6cc(0x162)]+'&&'+_0x26f180[_0x50d6cc(0x202)]+'=='+_0x36eed5[_0x50d6cc(0x202)]),_0x26f180[_0x50d6cc(0x162)]==_0x36eed5['product_name']&&_0x26f180[_0x50d6cc(0x202)]==_0x36eed5[_0x50d6cc(0x202)]&&(_0x26f180[_0x50d6cc(0x20a)]=parseInt(_0x26f180['product_stock'])-parseInt(_0x36eed5['return_qty']),_0x5704e6++);});_0x5704e6=='0'&&(_0x22107c['product_details']=_0x22107c[_0x292bf1(0x16e)][_0x292bf1(0x1c2)]({'product_name':_0x36eed5[_0x292bf1(0x162)],'product_stock':_0x36eed5[_0x292bf1(0x1bb)],'primary_code':_0x36eed5['primary_code'],'secondary_code':_0x36eed5[_0x292bf1(0x195)],'product_code':_0x36eed5[_0x292bf1(0x233)],'bay':_0x36eed5[_0x292bf1(0x202)],'maxProducts':0xf423f}));}),await _0x22107c[_0x10e281(0x252)]();const _0x21e690=await purchases_finished['findOne']({'invoice':_0x1ed342});_0x21e690[_0x10e281(0x223)]='True';const _0x14fcff=await _0x21e690[_0x10e281(0x252)](),_0x2aa211=new s_payment_data({'invoice':_0x1ed342,'suppliers':_0x3a3d82[_0x10e281(0x183)]['suppliers'],'reason':_0x10e281(0x247)});await _0x2aa211[_0x10e281(0x252)]();const _0x536696=await master_shop[_0x10e281(0x173)](),_0x2f7c6c=await email_settings['findOne'](),_0x5c72f4=await suppliers[_0x10e281(0x240)]({'name':_0x3a3d82[_0x10e281(0x183)][_0x10e281(0x213)]});_0x536696[0x0][_0x10e281(0x19d)]==0x1?(right_currency=_0x536696[0x0][_0x10e281(0x176)],left_currency=''):(right_currency='',left_currency=_0x536696[0x0][_0x10e281(0x176)]);var _0x416e7d=_0x44c956,_0x203b42=_0x52bb1e,_0x6ca855='',_0x576365;for(_0x576365 in _0x416e7d){_0x6ca855+='<tr>'+_0x10e281(0x1e2)+_0x416e7d[_0x576365]+_0x10e281(0x236)+_0x10e281(0x1e2)+_0x203b42[_0x576365]+_0x10e281(0x236)+_0x10e281(0x220);}let _0x24ac2b=nodemailer[_0x10e281(0x1ff)]({'service':_0x10e281(0x1a0),'auth':{'user':_0x2f7c6c[_0x10e281(0x1a3)],'pass':_0x2f7c6c[_0x10e281(0x19a)]}}),_0x1ec1b5={'from':_0x2f7c6c['email'],'to':_0x5c72f4[_0x10e281(0x1a3)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x10e281(0x186),'path':__dirname+'/../public'+_0x10e281(0x18e)+_0x536696[0x0][_0x10e281(0x251)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x10e281(0x201)+_0x10e281(0x192)+_0x10e281(0x172)+_0x10e281(0x192)+_0x10e281(0x15d)+_0x10e281(0x255)+'<div>'+_0x10e281(0x234)+_0x536696[0x0]['site_title']+'\x20</h2>'+_0x10e281(0x255)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x10e281(0x192)+_0x10e281(0x1ae)+_0x10e281(0x21d)+_0x1ed342+'\x20'+_0x10e281(0x1e9)+_0x10e281(0x20d)+_0x2acce4+'\x20'+'</span>'+'</h5>'+_0x10e281(0x255)+_0x10e281(0x19b)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x10e281(0x20f)+_0x10e281(0x1d1)+_0x10e281(0x17c)+_0x10e281(0x226)+_0x10e281(0x1ad)+'</tr>'+'</thead>'+_0x10e281(0x16a)+'\x20'+_0x6ca855+'\x20'+_0x10e281(0x21c)+'</table>'+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x10e281(0x1a9)+_0x536696[0x0]['site_title']+_0x10e281(0x1f0)+'</div>'+_0x10e281(0x255)+_0x10e281(0x250)};_0x24ac2b[_0x10e281(0x1f7)](_0x1ec1b5,function(_0x4fe2c7,_0xe4d115){var _0x22ed29=_0x10e281;_0x4fe2c7?console[_0x22ed29(0x19e)](_0x22ed29(0x1de)):console['log']('Email\x20sent\x20successfully');}),_0x3a3d82[_0x10e281(0x16c)]('success','purchases\x20item\x20return\x20successfull'),_0x6f174a[_0x10e281(0x1fd)](_0x10e281(0x1b6));}catch(_0x52f6a1){_0x6f174a[_0x10e281(0x1a8)](0xc8)[_0x10e281(0x1c7)]({'message':_0x52f6a1['message']});}}),router[a0_0x1f5b25(0x1a2)](a0_0x1f5b25(0x22e),auth,async(_0x1363a5,_0x6acc04)=>{var _0x1dc68c=a0_0x1f5b25;try{const {username:_0x503992,email:_0x1a186e,role:_0x473359}=_0x1363a5['user'],_0x502267=_0x1363a5['user'],_0x2a34f3=await profile[_0x1dc68c(0x240)]({'email':_0x502267['email']}),_0x284b55=await master_shop[_0x1dc68c(0x173)](),_0x5d900e=_0x1363a5[_0x1dc68c(0x1af)]['id'],_0xf32e6e=await purchases_finished[_0x1dc68c(0x20b)](_0x5d900e);if(_0x284b55[0x0]['language']=='English\x20(US)')var _0x58b5a3=users[_0x1dc68c(0x22d)];else{if(_0x284b55[0x0]['language']==_0x1dc68c(0x15f))var _0x58b5a3=users['Hindi'];else{if(_0x284b55[0x0][_0x1dc68c(0x203)]=='German')var _0x58b5a3=users[_0x1dc68c(0x229)];else{if(_0x284b55[0x0]['language']=='Spanish')var _0x58b5a3=users[_0x1dc68c(0x1dc)];else{if(_0x284b55[0x0][_0x1dc68c(0x203)]=='French')var _0x58b5a3=users[_0x1dc68c(0x1b0)];else{if(_0x284b55[0x0][_0x1dc68c(0x203)]=='Portuguese\x20(BR)')var _0x58b5a3=users[_0x1dc68c(0x179)];else{if(_0x284b55[0x0][_0x1dc68c(0x203)]==_0x1dc68c(0x1e8))var _0x58b5a3=users[_0x1dc68c(0x1e8)];else{if(_0x284b55[0x0]['language']==_0x1dc68c(0x18f))var _0x58b5a3=users[_0x1dc68c(0x193)];}}}}}}}_0x6acc04[_0x1dc68c(0x1f6)](_0x1dc68c(0x235),{'success':_0x1363a5[_0x1dc68c(0x16c)]('success'),'errors':_0x1363a5[_0x1dc68c(0x16c)](_0x1dc68c(0x1ec)),'role':_0x502267,'profile':_0x2a34f3,'alldata':_0xf32e6e,'master_shop':_0x284b55,'language':_0x58b5a3}),console[_0x1dc68c(0x19e)](alldata);}catch(_0x211032){console[_0x1dc68c(0x19e)](_0x211032);}}),router['post'](a0_0x1f5b25(0x218),async(_0x5f59a6,_0x11e716)=>{var _0x2eb826=a0_0x1f5b25;const {product_code:_0x4907c9}=_0x5f59a6[_0x2eb826(0x183)];var _0x5ad60a;const _0x310c80=await product[_0x2eb826(0x219)]([{'$match':{'primary_code':_0x4907c9,'product_category':_0x2eb826(0x1a5)}},{'$group':{'_id':'$_id','name':{'$first':_0x2eb826(0x180)},'category':{'$first':_0x2eb826(0x20c)},'brand':{'$first':'$brand'},'unit':{'$first':_0x2eb826(0x1d3)},'alertquantity':{'$first':_0x2eb826(0x1aa)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x2eb826(0x1f9)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x2eb826(0x1ce)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2eb826(0x24a)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x25b613=await product['aggregate']([{'$match':{'secondary_code':_0x4907c9}},{'$group':{'_id':'$_id','name':{'$first':_0x2eb826(0x180)},'category':{'$first':_0x2eb826(0x20c)},'brand':{'$first':_0x2eb826(0x18c)},'unit':{'$first':_0x2eb826(0x1d3)},'alertquantity':{'$first':_0x2eb826(0x1aa)},'product_code':{'$first':_0x2eb826(0x23f)},'primary_code':{'$first':_0x2eb826(0x1f9)},'secondary_code':{'$first':_0x2eb826(0x24d)},'maxStocks':{'$first':_0x2eb826(0x188)},'maxProdPerUnit':{'$first':_0x2eb826(0x1ce)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2eb826(0x24a)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x310c80[_0x2eb826(0x1ca)]>0x0)_0x5ad60a=_0x310c80;else _0x25b613[_0x2eb826(0x1ca)]>0x0&&(_0x5ad60a=_0x25b613);_0x11e716[_0x2eb826(0x1c7)](_0x5ad60a);}),router['post'](a0_0x1f5b25(0x1cd),async(_0x1e0bc9,_0x15f7ea)=>{var _0x2b4256=a0_0x1f5b25;const {productCode:_0x2ad8ca,bay:_0x590fc6,warehouses:_0x2ec0d5,room:_0xa74fc9}=_0x1e0bc9['body'];console[_0x2b4256(0x19e)](_0x1e0bc9['body']);try{const _0x1b4f39=await warehouse[_0x2b4256(0x219)]([{'$match':{'name':_0x2ec0d5,'room':_0xa74fc9}},{'$unwind':_0x2b4256(0x23e)},{'$match':{'product_details.bay':parseInt(_0x590fc6)}},{'$group':{'_id':_0x2b4256(0x190),'name':{'$first':_0x2b4256(0x1e1)},'product_stock':{'$first':_0x2b4256(0x1e3)},'bay':{'$first':_0x2b4256(0x18a)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x15f7ea['status'](0xc8)[_0x2b4256(0x1c7)](_0x1b4f39);}catch(_0x4b9398){_0x15f7ea['status'](0x194)[_0x2b4256(0x1c7)]({'message':_0x4b9398['message']});}}),module[a0_0x1f5b25(0x197)]=router;