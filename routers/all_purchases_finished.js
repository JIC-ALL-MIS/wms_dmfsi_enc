var a0_0x30599f=a0_0x51fa;function a0_0x4963(){var _0x1fe40a=['$product_details.rack','invoice','Hindi','currency_placement','172898mldPLl','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','role','<h5\x20style=\x22text-align:\x20left;\x22>','gmail','floor','$product_details._id','RoomAssign','INCF-','<tr>','$product.floorlevel','</span>','9084177WvzSMQ','English\x20(US)','errors','$unit','/invoice/:id','purchase\x20data\x20add\x20successfully','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<span\x20style=\x22float:\x20right;\x22>','findOne','$_id','<tbody\x20style=\x22text-align:\x20center;\x22>','$room','find','suppliers_docs','primary_code','abs','$product_details.maxProducts','map','getMonth','getDate','edit_purchases_finished_view','purchase\x20data\x20update\x20successfully','body','Email\x20sent\x20successfully','redirect','An\x20error\x20occurred\x20while\x20saving\x20data.','Paid\x20For\x20Purchase','<h2>\x20','/preview/:id','name','$maxStocks','4128125JfHopo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','due_amount','\x20<>\x20','/all_purchases_finished/view','post','master','length','$alertquantity','staff','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</thead>','$product','6690396ZWpWhN','prod_level','secondary_unit','prod_name','$name','prod_primunit','site_title','findById','Arabic','suppliers','There\x27s\x20a\x20error\x20in\x20this\x20transaction','../public/language/languages.json','</tr>','Room_name','return_data','$product_details.storage','$product.bin','exports','POnumber','random','Return\x20Goods','catch','Spanish','secondary_code','FROZEN\x20GOODS','getFullYear','json','$invoice','status','$product.type','/all_purchases/view','Ambient','$secondary_code','product_name','forEach','expiry_date','filter','date','English','then','back','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Router','104937MIOEHX','</body></html>','Arabic\x20(ae)','purchases\x20item\x20return\x20successfull','376oKKDQP','room','/view/add_purchases','product_code','$primary_code','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','updateOne','$product.bay','stock_quantity','/barcode/:id','render','Logo.png','prod_qty','<h5>','670dgtamG','add_purchases_finished','Portuguese','German','slice','Enabled','room_name','prod_unit','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','prod_Qty','</div>','product_date','DRY\x20GOODS','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','prod_code','$return_data','note','bay','/view/add_purchases/:id','product_code_hide','save','prod_secondunit','$batch_code','aggregate','language','maxStocks','2204wBEUmX','purchase_quantity','$product_details.product_code','$product_details.product_name','$product_details.bay','image','\x20</h2>','warehouse','$secondary_unit','warehouse_name','production_date','edit_purchases_finished','user_id','Rack\x201','get','stocks','standard_unit','/view','log','createTransport','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','../models/all_models','</table>','</h5>','\x20Order\x20Date\x20:\x20','/give_payment/:id','padStart','24FxjpDa','<strong>\x20Regards\x20</strong>','return_product','Error\x20occurred\x20while\x20processing\x20product:','$date','$product.room_name','<!DOCTYPE\x20html>','error','stock_data','Error\x20Occurs','../middleware/auth','\x20Order\x20Number\x20:\x20','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','success','all_purchases_finished','$product_code','product_cat','max_product_unit','email','Finished\x20Goods','product_details','3657101DCSFmb','currency','$product_details.bin','maxperunit','JO_number','188iZYYUh','Rack\x202','Chinese','MaxStocks_data','product','$maxProdPerUnit','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','password','purchase_invoice','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Purchase\x20Return\x20Mail','add_purchases\x20error','$paid_amount','</td>','all','French','logo','/view/return_purchase/:id','string','$suppliers','level','flash','Purchase\x20Mail','Portuguese\x20(BR)','True','prod_cat','$brand','product_stock','$expiry_date','$suppliers_docs','path','return_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$category','$product_details.product_stock','$product_details.type','_id','</tbody>','quantity','<hr\x20class=\x22my-3\x22>','user','<div>','port','$product.quantity','toString','params','$product_details','<html><head><title></title>','paid_amount','$note','prod_invoice','/CheckingWarehouse','$product_details.secondary_code','all_purchases_barcode','/upload/','$due_amount','primary_code_hide','secondary_code_hide','message','batch_code'];a0_0x4963=function(){return _0x1fe40a;};return a0_0x4963();}(function(_0x523b5a,_0x55dbab){var _0x156314=a0_0x51fa,_0x8a99d5=_0x523b5a();while(!![]){try{var _0x11027d=parseInt(_0x156314(0x131))/0x1*(parseInt(_0x156314(0x107))/0x2)+-parseInt(_0x156314(0x20c))/0x3*(-parseInt(_0x156314(0x167))/0x4)+-parseInt(_0x156314(0x1d4))/0x5+parseInt(_0x156314(0x1e1))/0x6+parseInt(_0x156314(0x162))/0x7*(-parseInt(_0x156314(0x14c))/0x8)+-parseInt(_0x156314(0x1b4))/0x9+parseInt(_0x156314(0x116))/0xa*(parseInt(_0x156314(0x1a8))/0xb);if(_0x11027d===_0x55dbab)break;else _0x8a99d5['push'](_0x8a99d5['shift']());}catch(_0x20f1eb){_0x8a99d5['push'](_0x8a99d5['shift']());}}}(a0_0x4963,0xc93a6));const express=require('express'),app=express(),router=express[a0_0x30599f(0x20b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x30599f(0x146)),auth=require(a0_0x30599f(0x156)),nodemailer=require('nodemailer');var ejs=require('ejs');const path=require(a0_0x30599f(0x186)),users=require(a0_0x30599f(0x1ec));router['get'](a0_0x30599f(0x142),auth,async(_0x283eae,_0x1a349a)=>{var _0x1106a6=a0_0x30599f;try{const {username:_0x522624,email:_0x50883e,role:_0x34e178}=_0x283eae[_0x1106a6(0x190)],_0x1b41ea=_0x283eae[_0x1106a6(0x190)],_0x550f94=await profile[_0x1106a6(0x1bd)]({'email':_0x1b41ea['email']}),_0x1916f6=await staff[_0x1106a6(0x1bd)]({'email':_0x1b41ea[_0x1106a6(0x15f)]});if(_0x1b41ea['role']=='staff'){const _0x2a1ffc=await staff[_0x1106a6(0x1bd)]({'email':_0x1b41ea[_0x1106a6(0x15f)]});}const _0x441bc6=await master_shop[_0x1106a6(0x1c1)]();let _0x2c3822;if(_0x1b41ea[_0x1106a6(0x1aa)]==_0x1106a6(0x1dd)){const _0x238447=await staff[_0x1106a6(0x1bd)]({'email':_0x1b41ea[_0x1106a6(0x15f)]});_0x2c3822=await purchases_finished[_0x1106a6(0x12e)]([{'$match':{'warehouse_name':_0x238447[_0x1106a6(0x138)]}},{'$lookup':{'from':_0x1106a6(0x1ea),'localField':_0x1106a6(0x1ea),'foreignField':_0x1106a6(0x1d2),'as':_0x1106a6(0x1c2)}},{'$unwind':_0x1106a6(0x185)},{'$unwind':_0x1106a6(0x1e0)},{'$group':{'_id':_0x1106a6(0x1be),'invoice':{'$first':_0x1106a6(0x1fc)},'suppliers':{'$first':_0x1106a6(0x17b)},'date':{'$first':_0x1106a6(0x150)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x1106a6(0x1c0)},'product':{'$push':_0x1106a6(0x1e0)},'note':{'$first':_0x1106a6(0x199)},'paid_amount':{'$first':_0x1106a6(0x174)},'due_amount':{'$first':_0x1106a6(0x19f)},'return_data':{'$first':_0x1106a6(0x126)},'batch_code':{'$first':_0x1106a6(0x12d)},'expiry_date':{'$first':_0x1106a6(0x184)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x1106a6(0x193)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x1106a6(0x1f1)},'type':{'$addToSet':_0x1106a6(0x1fe)},'floorlevel':{'$addToSet':_0x1106a6(0x1b2)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2c3822=await purchases_finished[_0x1106a6(0x12e)]([{'$unwind':_0x1106a6(0x1e0)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x1106a6(0x17b)},'date':{'$first':_0x1106a6(0x150)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x1106a6(0x151)},'product':{'$push':_0x1106a6(0x1e0)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x1106a6(0x174)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x1106a6(0x126)},'batch_code':{'$first':_0x1106a6(0x12d)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x1106a6(0x185)},'total_product_quantity':{'$sum':_0x1106a6(0x193)},'level':{'$addToSet':_0x1106a6(0x10f)},'isle':{'$addToSet':_0x1106a6(0x1f1)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x441bc6[0x0][_0x1106a6(0x12f)]=='English\x20(US)')var _0x5b5cf0=users[_0x1106a6(0x207)];else{if(_0x441bc6[0x0][_0x1106a6(0x12f)]==_0x1106a6(0x1a6))var _0x5b5cf0=users[_0x1106a6(0x1a6)];else{if(_0x441bc6[0x0]['language']==_0x1106a6(0x119))var _0x5b5cf0=users[_0x1106a6(0x119)];else{if(_0x441bc6[0x0][_0x1106a6(0x12f)]=='Spanish')var _0x5b5cf0=users['Spanish'];else{if(_0x441bc6[0x0]['language']=='French')var _0x5b5cf0=users[_0x1106a6(0x177)];else{if(_0x441bc6[0x0][_0x1106a6(0x12f)]=='Portuguese\x20(BR)')var _0x5b5cf0=users[_0x1106a6(0x118)];else{if(_0x441bc6[0x0]['language']==_0x1106a6(0x169))var _0x5b5cf0=users['Chinese'];else{if(_0x441bc6[0x0][_0x1106a6(0x12f)]==_0x1106a6(0x105))var _0x5b5cf0=users[_0x1106a6(0x1e9)];}}}}}}}_0x1a349a[_0x1106a6(0x112)](_0x1106a6(0x15b),{'success':_0x283eae[_0x1106a6(0x17d)](_0x1106a6(0x15a)),'errors':_0x283eae[_0x1106a6(0x17d)]('errors'),'purchases':_0x2c3822,'role':_0x1b41ea,'profile':_0x550f94,'master_shop':_0x441bc6,'language':_0x5b5cf0});}catch(_0x59725d){console[_0x1106a6(0x143)]('table\x20page',_0x59725d),_0x1a349a[_0x1106a6(0x1fd)](0xc8)[_0x1106a6(0x1fb)]({'message':_0x59725d[_0x1106a6(0x1a2)]});}});function a0_0x51fa(_0x4dfec5,_0x4dc2b1){var _0x4963c7=a0_0x4963();return a0_0x51fa=function(_0x51faa2,_0x14597e){_0x51faa2=_0x51faa2-0x104;var _0x257c5e=_0x4963c7[_0x51faa2];return _0x257c5e;},a0_0x51fa(_0x4dfec5,_0x4dc2b1);}function BayBinSelected(_0x338726,_0xda5f0d){var _0x3f93d0=a0_0x30599f,_0x4f129c=[],_0x2e4cdb=[];if(_0x338726==_0x3f93d0(0x123)){switch(_0xda5f0d){case _0x3f93d0(0x13e):_0x4f129c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x3f93d0(0x168):_0x4f129c=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2e4cdb=['DG'];}else{if(_0x338726==_0x3f93d0(0x1f9)){switch(_0xda5f0d){case _0x3f93d0(0x13e):_0x4f129c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x3f93d0(0x168):_0x4f129c=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2e4cdb=['FG'];}}return{'levels':_0x4f129c,'identify':_0x2e4cdb};}async function getRandom8DigitNumber(){var _0x5c3779=a0_0x30599f;const _0x92df18=0x989680,_0x8871b1=0x5f5e0ff,_0x437258=Math[_0x5c3779(0x1ad)](Math[_0x5c3779(0x1f4)]()*(_0x8871b1-_0x92df18+0x1))+_0x92df18;var _0x1e299d;const _0x2d3b71=await purchases_finished[_0x5c3779(0x1bd)]({'invoice':'INCF-'+_0x437258});return _0x2d3b71&&_0x2d3b71['length']>0x0?_0x1e299d=_0x5c3779(0x1b0)+_0x437258:_0x1e299d=_0x5c3779(0x1b0)+_0x437258,_0x1e299d;}router[a0_0x30599f(0x13f)](a0_0x30599f(0x109),auth,async(_0x42604d,_0x6a2a3e)=>{var _0x27543f=a0_0x30599f;try{const {username:_0xf924af,email:_0x150d7a,role:_0x2e5ed2}=_0x42604d[_0x27543f(0x190)],_0x4c3962=_0x42604d[_0x27543f(0x190)],_0x2885db=await profile[_0x27543f(0x1bd)]({'email':_0x4c3962[_0x27543f(0x15f)]}),_0x6abb13=await master_shop[_0x27543f(0x1c1)](),_0x4a0a24=await staff[_0x27543f(0x1bd)]({'email':_0x4c3962[_0x27543f(0x15f)]}),_0x3bd9c4=await suppliers['find']({});let _0x4527f9;if(_0x4c3962['role']=='staff'){const _0x16e7fe=await staff[_0x27543f(0x1bd)]({'email':_0x4c3962[_0x27543f(0x15f)]});_0x4527f9=await warehouse[_0x27543f(0x12e)]([{'$match':{'status':_0x27543f(0x11b),'name':_0x16e7fe[_0x27543f(0x138)],'warehouse_category':_0x27543f(0x160)}},{'$group':{'_id':'$name','name':{'$first':_0x27543f(0x1e5)}}}]);}else _0x4527f9=await warehouse[_0x27543f(0x12e)]([{'$match':{'status':'Enabled','warehouse_category':_0x27543f(0x160),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x27543f(0x1e5)}}}]);const _0x1e648b=await product[_0x27543f(0x1c1)]({}),_0x521082=await warehouse[_0x27543f(0x1c1)]({'status':_0x27543f(0x11b)}),_0x496cde=await purchases_finished['find']({}),_0x22395e=_0x496cde[_0x27543f(0x1db)]+0x1,_0xddc53=_0x27543f(0x1b0)+_0x22395e[_0x27543f(0x194)]()[_0x27543f(0x14b)](0x5,'0');var _0x54c742=[_0x27543f(0x200),'Enclosed'];if(_0x6abb13[0x0]['language']==_0x27543f(0x1b5))var _0x205889=users[_0x27543f(0x207)];else{if(_0x6abb13[0x0][_0x27543f(0x12f)]=='Hindi')var _0x205889=users[_0x27543f(0x1a6)];else{if(_0x6abb13[0x0]['language']==_0x27543f(0x119))var _0x205889=users[_0x27543f(0x119)];else{if(_0x6abb13[0x0][_0x27543f(0x12f)]==_0x27543f(0x1f7))var _0x205889=users[_0x27543f(0x1f7)];else{if(_0x6abb13[0x0][_0x27543f(0x12f)]==_0x27543f(0x177))var _0x205889=users[_0x27543f(0x177)];else{if(_0x6abb13[0x0][_0x27543f(0x12f)]==_0x27543f(0x17f))var _0x205889=users[_0x27543f(0x118)];else{if(_0x6abb13[0x0]['language']=='Chinese')var _0x205889=users[_0x27543f(0x169)];else{if(_0x6abb13[0x0][_0x27543f(0x12f)]==_0x27543f(0x105))var _0x205889=users[_0x27543f(0x1e9)];}}}}}}}const _0x42483f=getRandom8DigitNumber();_0x42483f[_0x27543f(0x208)](_0x3e80d5=>{var _0x315bc2=_0x27543f;_0x6a2a3e['render'](_0x315bc2(0x117),{'success':_0x42604d[_0x315bc2(0x17d)](_0x315bc2(0x15a)),'errors':_0x42604d['flash'](_0x315bc2(0x1b6)),'role':_0x4c3962,'profile':_0x2885db,'suppliers':_0x3bd9c4,'warehouse':_0x4527f9,'product':_0x1e648b,'invoice':_0x3e80d5,'master_shop':_0x6abb13,'language':_0x205889,'find_data':_0x521082,'rooms_data':_0x54c742});})[_0x27543f(0x1f6)](_0x3d5e6c=>{var _0x3594b=_0x27543f;_0x42604d[_0x3594b(0x17d)]('errors',_0x3594b(0x1eb)),_0x6a2a3e[_0x3594b(0x1cd)](_0x3594b(0x1d8));});}catch(_0x31d4c0){console[_0x27543f(0x143)](_0x31d4c0);}}),router[a0_0x30599f(0x13f)](a0_0x30599f(0x129),auth,async(_0xb2dc4f,_0x27dd50)=>{var _0x2bb7b9=a0_0x30599f;try{const _0x575a76=_0xb2dc4f[_0x2bb7b9(0x195)]['id'];console[_0x2bb7b9(0x143)](_0x575a76);const _0x2e0fd6=await master_shop[_0x2bb7b9(0x1c1)]();console[_0x2bb7b9(0x143)](_0x2bb7b9(0x1da),_0x2e0fd6);const _0x4ca6c7=await product['findOne']({'name':_0x575a76});console[_0x2bb7b9(0x143)](_0x2bb7b9(0x16b),_0x4ca6c7),_0x27dd50[_0x2bb7b9(0x1fd)](0xc8)[_0x2bb7b9(0x1fb)]({'product_data':_0x4ca6c7,'master':_0x2e0fd6});}catch(_0xd05636){console[_0x2bb7b9(0x143)](_0x2bb7b9(0x173),_0xd05636);}}),router[a0_0x30599f(0x1d9)](a0_0x30599f(0x109),auth,async(_0x1d1ec2,_0x9b1a50)=>{var _0x127227=a0_0x30599f;try{const {invoice:_0x297869,date:_0x4fefd9,warehouse_name:_0x14cdd0,prod_name:_0x23ec5f,prod_code:_0x5285d1,prod_qty:_0x3c9fcb,prod_unit:_0x166740,prod_secondunit:_0xd5fd5d,prod_level:_0x28fc99,prod_isle:_0x131003,prod_pallet:_0x177c23,note:_0x62cb9e,expiry_date:_0x4c98f2,batch_code:_0x53b68a,payable:_0x541252,due_amount:_0x32a5e8,Room_name:_0x4086f5,primary_code:_0x106eb9,secondary_code:_0x541d7f,MaxStocks_data:_0x247372,PO_number:_0x5d5dbe,SCRN:_0x4a45d1,JO_number:_0x1e5285}=_0x1d1ec2[_0x127227(0x1cb)];if(typeof _0x23ec5f==_0x127227(0x17a))var _0x38a067=[_0x1d1ec2['body'][_0x127227(0x1e4)]],_0x9c587c=[_0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x125)]],_0x3a6195=[_0x1d1ec2[_0x127227(0x1cb)]['prod_Qty']],_0x4ce5bf=[_0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x1e6)]],_0x244d02=[_0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x12c)]],_0x5bc216=[_0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x1e2)]],_0x53be22=[_0x1d1ec2[_0x127227(0x1cb)]['primary_code']],_0x128cf0=[_0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x1f8)]],_0x18394e=[_0x1d1ec2['body']['MaxStocks_data']],_0x45e367=[_0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x1a3)]],_0x47b444=[_0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x204)]],_0x197373=[_0x1d1ec2['body'][_0x127227(0x122)]],_0x19db65=[_0x1d1ec2['body'][_0x127227(0x15e)]],_0x4b1e15=[_0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x181)]],_0x4a0b6b=[_0x1d1ec2['body'][_0x127227(0x1af)]],_0x280d8b=[_0x1d1ec2['body'][_0x127227(0x19a)]];else var _0x38a067=[..._0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x1e4)]],_0x9c587c=[..._0x1d1ec2['body'][_0x127227(0x125)]],_0x3a6195=[..._0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x120)]],_0x4ce5bf=[..._0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x1e6)]],_0x244d02=[..._0x1d1ec2[_0x127227(0x1cb)]['prod_secondunit']],_0x5bc216=[..._0x1d1ec2['body'][_0x127227(0x1e2)]],_0x53be22=[..._0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x1c3)]],_0x128cf0=[..._0x1d1ec2['body'][_0x127227(0x1f8)]],_0x18394e=[..._0x1d1ec2[_0x127227(0x1cb)]['MaxStocks_data']],_0x45e367=[..._0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x1a3)]],_0x47b444=[..._0x1d1ec2['body'][_0x127227(0x204)]],_0x197373=[..._0x1d1ec2['body']['product_date']],_0x19db65=[..._0x1d1ec2['body'][_0x127227(0x15e)]],_0x4b1e15=[..._0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x181)]],_0x4a0b6b=[..._0x1d1ec2['body']['RoomAssign']],_0x280d8b=[..._0x1d1ec2[_0x127227(0x1cb)][_0x127227(0x19a)]];const _0x17ca36=_0x38a067[_0x127227(0x1c6)](_0x71d1fe=>{return _0x71d1fe={'product_name':_0x71d1fe};});_0x9c587c[_0x127227(0x203)]((_0x3cb55c,_0x42d84e)=>{var _0xdf23bc=_0x127227;_0x17ca36[_0x42d84e][_0xdf23bc(0x10a)]=_0x3cb55c;}),_0x3a6195['forEach']((_0x281b3d,_0x27ceb7)=>{var _0x178819=_0x127227;_0x17ca36[_0x27ceb7][_0x178819(0x18e)]=Math['abs'](_0x281b3d);}),_0x4ce5bf['forEach']((_0xa3f021,_0x4b59dd)=>{_0x17ca36[_0x4b59dd]['standard_unit']=_0xa3f021;}),_0x244d02[_0x127227(0x203)]((_0x4d36fd,_0x465c4e)=>{var _0x1c5928=_0x127227;_0x17ca36[_0x465c4e][_0x1c5928(0x1e3)]=_0x4d36fd;}),_0x5bc216[_0x127227(0x203)]((_0xf468c6,_0x59151b)=>{var _0x53a8ef=_0x127227;_0x17ca36[_0x59151b][_0x53a8ef(0x128)]=_0xf468c6;}),_0x53be22[_0x127227(0x203)]((_0x1af4ed,_0x2164eb)=>{_0x17ca36[_0x2164eb]['primary_code']=_0x1af4ed;}),_0x128cf0[_0x127227(0x203)]((_0x2e5c82,_0x3d1084)=>{var _0x4073f2=_0x127227;_0x17ca36[_0x3d1084][_0x4073f2(0x1f8)]=_0x2e5c82;}),_0x18394e['forEach']((_0x558479,_0x3a5cdf)=>{var _0x1af440=_0x127227;_0x17ca36[_0x3a5cdf][_0x1af440(0x130)]=_0x558479;}),_0x45e367[_0x127227(0x203)]((_0x2ab8e6,_0x3d8728)=>{_0x17ca36[_0x3d8728]['batch_code']=_0x2ab8e6;}),_0x47b444[_0x127227(0x203)]((_0x415faf,_0x19c8fa)=>{_0x17ca36[_0x19c8fa]['expiry_date']=_0x415faf;}),_0x197373[_0x127227(0x203)]((_0x2f9f31,_0x5d5a35)=>{var _0x162058=_0x127227;_0x17ca36[_0x5d5a35][_0x162058(0x13b)]=_0x2f9f31;}),_0x19db65[_0x127227(0x203)]((_0x1e43a7,_0x5baf9a)=>{var _0x39862f=_0x127227;_0x17ca36[_0x5baf9a][_0x39862f(0x165)]=_0x1e43a7;}),_0x4b1e15[_0x127227(0x203)]((_0x255230,_0x50d652)=>{_0x17ca36[_0x50d652]['product_cat']=_0x255230;}),_0x4a0b6b[_0x127227(0x203)]((_0x3b257b,_0x57ecb0)=>{var _0x599d40=_0x127227;_0x17ca36[_0x57ecb0][_0x599d40(0x11c)]=_0x3b257b;}),_0x280d8b[_0x127227(0x203)]((_0x3cfd62,_0xec33b5)=>{var _0x4f239a=_0x127227;_0x17ca36[_0xec33b5][_0x4f239a(0x1a5)]=_0x3cfd62;});const _0x53429c=_0x17ca36[_0x127227(0x205)](_0x1d7e23=>_0x1d7e23['quantity']!=='0'&&_0x1d7e23[_0x127227(0x18e)]!==''),_0x508f58=new purchases_finished({'invoice':_0x297869,'suppliers':_0x1d1ec2['body'][_0x127227(0x1ea)],'date':_0x4fefd9,'warehouse_name':_0x14cdd0,'product':_0x53429c,'note':_0x62cb9e,'due_amount':_0x32a5e8,'room':_0x4086f5,'POnumber':_0x5d5dbe,'SCRN':_0x4a45d1,'JO_number':_0x1e5285}),_0x3501e8=await _0x508f58[_0x127227(0x12b)](),_0x4b04b0=await purchases_finished[_0x127227(0x1bd)]({'invoice':_0x297869}),_0x378775=_0x4b04b0[_0x127227(0x16b)][_0x127227(0x1c6)](async _0x108f78=>{var _0x3bc92e=_0x127227;try{var _0x110b8a=await warehouse[_0x3bc92e(0x1bd)]({'name':_0x14cdd0,'room':_0x108f78['room_name']}),_0x29a0da=0x0;const _0x618d81=_0x110b8a[_0x3bc92e(0x161)]['map'](_0x4bc64a=>{var _0x118932=_0x3bc92e;console[_0x118932(0x143)](_0x4bc64a[_0x118932(0x202)]+'=='+_0x108f78['product_name']+'&&'+_0x4bc64a[_0x118932(0x128)]+'=='+_0x108f78['bay']+'&&'+_0x4bc64a[_0x118932(0x204)]+'=='+_0x108f78[_0x118932(0x204)]+'&&'+_0x4bc64a[_0x118932(0x13b)]+'=='+_0x108f78[_0x118932(0x13b)]+'&&'+_0x4bc64a['batch_code']+'=='+_0x108f78[_0x118932(0x1a3)]+'&&'+_0x4bc64a[_0x118932(0x1a5)]+'=='+_0x4b04b0[_0x118932(0x1a5)]),_0x4bc64a[_0x118932(0x202)]==_0x108f78[_0x118932(0x202)]&&_0x4bc64a[_0x118932(0x128)]==_0x108f78[_0x118932(0x128)]&&_0x4bc64a[_0x118932(0x204)]==_0x108f78[_0x118932(0x204)]&&_0x4bc64a['production_date']==_0x108f78[_0x118932(0x13b)]&&_0x4bc64a[_0x118932(0x1a3)]==_0x108f78['batch_code']&&_0x4bc64a[_0x118932(0x1a5)]==_0x4b04b0[_0x118932(0x1a5)]&&(_0x4bc64a[_0x118932(0x183)]=Math[_0x118932(0x1c4)](_0x4bc64a[_0x118932(0x183)])+Math['abs'](_0x108f78[_0x118932(0x18e)]),_0x29a0da++);});return _0x29a0da==0x0&&(_0x110b8a[_0x3bc92e(0x161)]=_0x110b8a['product_details'][_0x3bc92e(0x10c)]({'product_name':_0x108f78['product_name'],'product_stock':Math[_0x3bc92e(0x1c4)](_0x108f78[_0x3bc92e(0x18e)]),'primary_code':_0x108f78[_0x3bc92e(0x1c3)],'secondary_code':_0x108f78['secondary_code'],'product_code':_0x108f78[_0x3bc92e(0x10a)],'bay':_0x108f78[_0x3bc92e(0x128)],'maxProducts':_0x108f78[_0x3bc92e(0x130)],'unit':_0x108f78['standard_unit'],'secondary_unit':_0x108f78[_0x3bc92e(0x1e3)],'expiry_date':_0x108f78[_0x3bc92e(0x204)],'production_date':_0x108f78[_0x3bc92e(0x13b)],'maxProducts':_0x108f78['maxStocks'],'maxPerUnit':_0x108f78[_0x3bc92e(0x165)],'batch_code':_0x108f78[_0x3bc92e(0x1a3)],'product_cat':_0x108f78[_0x3bc92e(0x15d)],'invoice':_0x108f78[_0x3bc92e(0x1a5)],'id_incoming':_0x108f78[_0x3bc92e(0x18c)]})),_0x110b8a;}catch(_0x33af91){return console['error'](_0x3bc92e(0x14f),_0x33af91),null;}});Promise[_0x127227(0x176)](_0x378775)['then'](async _0x51a225=>{var _0x55f81b=_0x127227;try{for(const _0x4c0b7a of _0x51a225){await warehouse[_0x55f81b(0x10e)]({'_id':_0x4c0b7a[_0x55f81b(0x18c)]},{'$addToSet':{'product_details':{'$each':_0x4c0b7a[_0x55f81b(0x161)]}}});}const _0xcd8fac=await master_shop['find'](),_0x3be0f8=await email_settings[_0x55f81b(0x1bd)](),_0x57e7d8=await supervisor_settings[_0x55f81b(0x1c1)]();var _0x5d327b=_0x4b04b0['product'],_0x55bdde='',_0x5c2acb;for(_0x5c2acb in _0x5d327b){var _0x9f4244='FG';_0x4b04b0[_0x55f81b(0x13a)]==_0x55f81b(0x123)&&(_0x9f4244='DG'),_0x55bdde+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5d327b[_0x5c2acb]['product_name']+_0x55f81b(0x175)+_0x55f81b(0x1de)+_0x5d327b[_0x5c2acb][_0x55f81b(0x10a)]+_0x55f81b(0x175)+_0x55f81b(0x1de)+_0x5d327b[_0x5c2acb][_0x55f81b(0x18e)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5d327b[_0x5c2acb][_0x55f81b(0x141)]+_0x55f81b(0x175)+_0x55f81b(0x1de)+_0x5d327b[_0x5c2acb]['secondary_unit']+_0x55f81b(0x175)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b04b0[_0x55f81b(0x13a)]+'</td>'+_0x55f81b(0x1de)+_0x5d327b[_0x5c2acb]['room_name']+_0x55f81b(0x175)+_0x55f81b(0x1de)+_0x9f4244+_0x5d327b[_0x5c2acb][_0x55f81b(0x128)]+_0x55f81b(0x175),_0x55f81b(0x1ed);}let _0x5b9e6d=nodemailer[_0x55f81b(0x144)]({'host':_0x3be0f8['host'],'port':Number(_0x3be0f8[_0x55f81b(0x192)]),'secure':![],'auth':{'user':_0x3be0f8['email'],'pass':_0x3be0f8[_0x55f81b(0x16f)]}}),_0x15ca9a={'from':_0x3be0f8['email'],'to':_0x57e7d8[0x0]['FGSEmail'],'subject':_0x55f81b(0x17e),'attachments':[{'filename':_0x55f81b(0x113),'path':__dirname+'/../public'+_0x55f81b(0x19e)+_0xcd8fac[0x0]['image'],'cid':'logo'}],'html':_0x55f81b(0x152)+_0x55f81b(0x197)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x55f81b(0x20a)+_0x55f81b(0x121)+_0x55f81b(0x191)+_0x55f81b(0x1d0)+_0xcd8fac[0x0][_0x55f81b(0x1e7)]+_0x55f81b(0x137)+_0x55f81b(0x121)+'</div>'+_0x55f81b(0x18f)+_0x55f81b(0x191)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x55f81b(0x157)+_0x4b04b0['invoice']+'\x20'+_0x55f81b(0x1bc)+_0x55f81b(0x149)+_0x4b04b0[_0x55f81b(0x206)]+'\x20'+_0x55f81b(0x1b3)+'</h5>'+_0x55f81b(0x121)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x55f81b(0x145)+_0x55f81b(0x1b1)+_0x55f81b(0x16e)+_0x55f81b(0x10d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x55f81b(0x1a9)+_0x55f81b(0x124)+_0x55f81b(0x1bb)+_0x55f81b(0x159)+_0x55f81b(0x188)+_0x55f81b(0x1ed)+_0x55f81b(0x1df)+_0x55f81b(0x1bf)+'\x20'+_0x55bdde+'\x20'+_0x55f81b(0x18d)+_0x55f81b(0x147)+_0x55f81b(0x191)+_0x55f81b(0x14d)+_0x55f81b(0x115)+_0xcd8fac[0x0][_0x55f81b(0x1e7)]+_0x55f81b(0x148)+_0x55f81b(0x121)+_0x55f81b(0x121)+_0x55f81b(0x104)};_0x5b9e6d['sendMail'](_0x15ca9a,function(_0x442ce0,_0x1ba079){var _0x52f36a=_0x55f81b;_0x442ce0?(console['log'](_0x442ce0),console['log'](_0x52f36a(0x155))):console[_0x52f36a(0x143)](_0x52f36a(0x1cc));});}catch(_0x3b47f5){console[_0x55f81b(0x153)](_0x3b47f5),_0x9b1a50[_0x55f81b(0x1fd)](0x1f4)[_0x55f81b(0x1fb)]({'error':_0x55f81b(0x1ce),'message':_0x3b47f5['message']});}})['catch'](_0x261a20=>{console['error'](_0x261a20);}),_0x1d1ec2[_0x127227(0x17d)](_0x127227(0x15a),_0x127227(0x1b9)),_0x9b1a50[_0x127227(0x1cd)]('/all_purchases_finished/view');}catch(_0x4580a6){console[_0x127227(0x143)](_0x4580a6);}}),router[a0_0x30599f(0x13f)](a0_0x30599f(0x1d1),auth,async(_0x2cf9b0,_0x4e9bb7)=>{var _0x5337a5=a0_0x30599f;try{const {username:_0x566d72,email:_0x2b98d3,role:_0x23dcfb}=_0x2cf9b0[_0x5337a5(0x190)],_0x6cd350=_0x2cf9b0[_0x5337a5(0x190)],_0xc42cc0=await profile[_0x5337a5(0x1bd)]({'email':_0x6cd350['email']}),_0x48386b=await master_shop[_0x5337a5(0x1c1)](),_0x20f5a0=_0x2cf9b0[_0x5337a5(0x195)]['id'],_0x25f2fd=await purchases_finished[_0x5337a5(0x1e8)](_0x20f5a0),_0x5416e2=await suppliers[_0x5337a5(0x1c1)]({});let _0x3f9d54;if(_0x6cd350[_0x5337a5(0x1aa)]==_0x5337a5(0x1dd)){const _0x3e6c9c=await staff[_0x5337a5(0x1bd)]({'email':_0x6cd350[_0x5337a5(0x15f)]});_0x3f9d54=await warehouse[_0x5337a5(0x1c1)]({'status':_0x5337a5(0x11b),'name':_0x3e6c9c['warehouse'],'warehouse_category':_0x5337a5(0x160)});}else _0x3f9d54=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x5337a5(0x160)}},{'$group':{'_id':_0x5337a5(0x1e5),'name':{'$first':_0x5337a5(0x1e5)}}}]);const _0x275beb=await product[_0x5337a5(0x1c1)]({}),_0x2172a1=BayBinSelected(_0x25f2fd[_0x5337a5(0x13a)],_0x25f2fd[_0x5337a5(0x108)]);let _0x303e95=new Date(_0x25f2fd['expiry_date']),_0x37302e=('0'+_0x303e95[_0x5337a5(0x1c8)]())[_0x5337a5(0x11a)](-0x2),_0x29ec28=('0'+(_0x303e95[_0x5337a5(0x1c7)]()+0x1))['slice'](-0x2),_0x532281=_0x303e95[_0x5337a5(0x1fa)](),_0x1525ed=_0x532281+'-'+_0x29ec28+'-'+_0x37302e;if(_0x48386b[0x0][_0x5337a5(0x12f)]==_0x5337a5(0x1b5)){var _0x578621=users['English'];console[_0x5337a5(0x143)](_0x578621);}else{if(_0x48386b[0x0][_0x5337a5(0x12f)]==_0x5337a5(0x1a6))var _0x578621=users[_0x5337a5(0x1a6)];else{if(_0x48386b[0x0]['language']=='German')var _0x578621=users['German'];else{if(_0x48386b[0x0]['language']==_0x5337a5(0x1f7))var _0x578621=users[_0x5337a5(0x1f7)];else{if(_0x48386b[0x0][_0x5337a5(0x12f)]==_0x5337a5(0x177))var _0x578621=users[_0x5337a5(0x177)];else{if(_0x48386b[0x0][_0x5337a5(0x12f)]==_0x5337a5(0x17f))var _0x578621=users[_0x5337a5(0x118)];else{if(_0x48386b[0x0][_0x5337a5(0x12f)]=='Chinese')var _0x578621=users[_0x5337a5(0x169)];else{if(_0x48386b[0x0][_0x5337a5(0x12f)]=='Arabic\x20(ae)')var _0x578621=users[_0x5337a5(0x1e9)];}}}}}}}_0x4e9bb7[_0x5337a5(0x112)](_0x5337a5(0x1c9),{'success':_0x2cf9b0[_0x5337a5(0x17d)](_0x5337a5(0x15a)),'errors':_0x2cf9b0['flash'](_0x5337a5(0x1b6)),'role':_0x6cd350,'profile':_0xc42cc0,'purchases':_0x25f2fd,'suppliers':_0x5416e2,'warehouse':_0x3f9d54,'product':_0x275beb,'master_shop':_0x48386b,'language':_0x578621,'ed_fullDate':_0x1525ed,'dataSelected':_0x2172a1});}catch(_0xa31f94){console['log'](_0xa31f94);}}),router[a0_0x30599f(0x13f)](a0_0x30599f(0x16d),auth,async(_0x198bbb,_0x56fea1)=>{var _0x13222c=a0_0x30599f;try{const {username:_0x3f8297,email:_0x182832,role:_0x1d9d27}=_0x198bbb[_0x13222c(0x190)],_0x2cd665=_0x198bbb['user'],_0x9665d9=await profile[_0x13222c(0x1bd)]({'email':_0x2cd665[_0x13222c(0x15f)]}),_0x41723c=await master_shop[_0x13222c(0x1c1)](),_0x1cc124=_0x198bbb[_0x13222c(0x195)]['id'],_0x1cf31d=await purchases_finished[_0x13222c(0x1e8)](_0x1cc124),_0x26ef6=await suppliers['find']({});let _0x1c7ade;if(_0x2cd665[_0x13222c(0x1aa)]=='staff'){const _0x1bb4be=await staff['findOne']({'email':_0x2cd665[_0x13222c(0x15f)]});_0x1c7ade=await warehouse[_0x13222c(0x1c1)]({'status':_0x13222c(0x11b),'name':_0x1bb4be[_0x13222c(0x138)],'warehouse_category':_0x13222c(0x160)});}else _0x1c7ade=await warehouse[_0x13222c(0x12e)]([{'$match':{'status':_0x13222c(0x11b),'warehouse_category':_0x13222c(0x160)}},{'$group':{'_id':_0x13222c(0x1e5),'name':{'$first':'$name'}}}]);const _0x3ce71f=await product[_0x13222c(0x1c1)]({}),_0xb66e2d=BayBinSelected(_0x1cf31d[_0x13222c(0x13a)],_0x1cf31d[_0x13222c(0x108)]);let _0x2658b8=new Date(_0x1cf31d['expiry_date']),_0x4fed96=('0'+_0x2658b8[_0x13222c(0x1c8)]())[_0x13222c(0x11a)](-0x2),_0x5a3033=('0'+(_0x2658b8['getMonth']()+0x1))[_0x13222c(0x11a)](-0x2),_0x2d652b=_0x2658b8[_0x13222c(0x1fa)](),_0x2865a3=_0x2d652b+'-'+_0x5a3033+'-'+_0x4fed96;if(_0x41723c[0x0]['language']==_0x13222c(0x1b5)){var _0xaa20eb=users[_0x13222c(0x207)];console[_0x13222c(0x143)](_0xaa20eb);}else{if(_0x41723c[0x0]['language']==_0x13222c(0x1a6))var _0xaa20eb=users[_0x13222c(0x1a6)];else{if(_0x41723c[0x0]['language']==_0x13222c(0x119))var _0xaa20eb=users[_0x13222c(0x119)];else{if(_0x41723c[0x0][_0x13222c(0x12f)]==_0x13222c(0x1f7))var _0xaa20eb=users[_0x13222c(0x1f7)];else{if(_0x41723c[0x0][_0x13222c(0x12f)]=='French')var _0xaa20eb=users[_0x13222c(0x177)];else{if(_0x41723c[0x0][_0x13222c(0x12f)]==_0x13222c(0x17f))var _0xaa20eb=users[_0x13222c(0x118)];else{if(_0x41723c[0x0][_0x13222c(0x12f)]==_0x13222c(0x169))var _0xaa20eb=users['Chinese'];else{if(_0x41723c[0x0][_0x13222c(0x12f)]==_0x13222c(0x105))var _0xaa20eb=users[_0x13222c(0x1e9)];}}}}}}}_0x56fea1[_0x13222c(0x112)](_0x13222c(0x13c),{'success':_0x198bbb[_0x13222c(0x17d)](_0x13222c(0x15a)),'errors':_0x198bbb[_0x13222c(0x17d)](_0x13222c(0x1b6)),'role':_0x2cd665,'profile':_0x9665d9,'purchases':_0x1cf31d,'suppliers':_0x26ef6,'warehouse':_0x1c7ade,'product':_0x3ce71f,'master_shop':_0x41723c,'language':_0xaa20eb,'ed_fullDate':_0x2865a3,'dataSelected':_0xb66e2d});}catch(_0x4cc7fa){console[_0x13222c(0x143)](_0x4cc7fa);}}),router['post']('/view/:id',auth,async(_0x47bce3,_0xacaf81)=>{var _0x590a25=a0_0x30599f;try{const _0x137b59=_0x47bce3[_0x590a25(0x195)]['id'],_0xe8698d=await purchases_finished[_0x590a25(0x1bd)]({'_id':_0x47bce3['params']['id']}),_0x2f8c14=await warehouse[_0x590a25(0x1bd)]({'name':_0xe8698d[_0x590a25(0x13a)],'room':_0xe8698d[_0x590a25(0x108)]});_0xe8698d[_0x590a25(0x16b)][_0x590a25(0x203)](_0x46f5c7=>{const _0x13b420=_0x2f8c14['product_details']['map'](_0x42ab16=>{var _0xfab0d4=a0_0x51fa;_0x42ab16[_0xfab0d4(0x202)]==_0x46f5c7[_0xfab0d4(0x202)]&&_0x42ab16[_0xfab0d4(0x128)]==_0x46f5c7[_0xfab0d4(0x128)]&&(_0x42ab16[_0xfab0d4(0x183)]=parseInt(_0x42ab16[_0xfab0d4(0x183)])-parseInt(_0x46f5c7['quantity']));});}),await _0x2f8c14[_0x590a25(0x12b)]();const {invoice:_0x9614d8,suppliers:_0x41dbf5,date:_0x2fbd62,warehouse_name:_0x458cb0,prod_name:_0x5bb7e1,prod_code:_0x4f0bdc,prod_qty:_0x629266,prod_unit:_0x33a133,prod_secondunit:_0x2db60d,prod_level:_0x5ea801,prod_isle:_0x23c3ae,prod_pallet:_0x35129d,note:_0x62e640,expiry_date:_0x1ff525,batch_code:_0x23769e,paid_amount:_0x2d451d,due_amount:_0x3c3a77,Room_name:_0x217ac7,primary_code:_0x1227ee,secondary_code:_0x32eedb,PO_number:_0x53efd2,JO_number:_0x133e5a}=_0x47bce3['body'];if(typeof _0x5bb7e1==_0x590a25(0x17a))var _0x428ead=[_0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x1e4)]],_0x489ac6=[_0x47bce3[_0x590a25(0x1cb)]['prod_code']],_0x53a56a=[_0x47bce3[_0x590a25(0x1cb)]['prod_qty']],_0x335408=[_0x47bce3['body'][_0x590a25(0x11d)]],_0x23f5f9=[_0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x12c)]],_0x582982=[_0x47bce3[_0x590a25(0x1cb)]['prod_level']],_0x279c4e=[_0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x1c3)]],_0x43c192=[_0x47bce3['body'][_0x590a25(0x1f8)]],_0x1b810b=[_0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x16a)]],_0x17ef40=[_0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x1a3)]],_0x58debb=[_0x47bce3[_0x590a25(0x1cb)]['expiry_date']];else var _0x428ead=[..._0x47bce3[_0x590a25(0x1cb)]['prod_name']],_0x489ac6=[..._0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x125)]],_0x53a56a=[..._0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x114)]],_0x335408=[..._0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x11d)]],_0x23f5f9=[..._0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x12c)]],_0x582982=[..._0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x1e2)]],_0x279c4e=[..._0x47bce3['body']['primary_code']],_0x43c192=[..._0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x1f8)]],_0x1b810b=[..._0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x16a)]],_0x17ef40=[..._0x47bce3[_0x590a25(0x1cb)]['batch_code']],_0x58debb=[..._0x47bce3['body'][_0x590a25(0x204)]];const _0x4f3b41=_0x428ead['map'](_0x3f9dac=>{return _0x3f9dac={'product_name':_0x3f9dac};});_0x489ac6['forEach']((_0x5d220a,_0x29dfb8)=>{var _0x4fee24=_0x590a25;_0x4f3b41[_0x29dfb8][_0x4fee24(0x10a)]=_0x5d220a;}),_0x53a56a['forEach']((_0x4ec6f5,_0x37cdfc)=>{var _0x5b1091=_0x590a25;_0x4f3b41[_0x37cdfc][_0x5b1091(0x18e)]=_0x4ec6f5;}),_0x335408[_0x590a25(0x203)]((_0x473f46,_0x2a2932)=>{_0x4f3b41[_0x2a2932]['standard_unit']=_0x473f46;}),_0x23f5f9[_0x590a25(0x203)]((_0x18084d,_0x2077f4)=>{var _0x25e3ea=_0x590a25;_0x4f3b41[_0x2077f4][_0x25e3ea(0x1e3)]=_0x18084d;}),_0x582982[_0x590a25(0x203)]((_0x5e97c8,_0x3f3e43)=>{_0x4f3b41[_0x3f3e43]['bay']=_0x5e97c8;}),_0x279c4e[_0x590a25(0x203)]((_0x4f3a2d,_0x1c0ab0)=>{var _0x2024eb=_0x590a25;_0x4f3b41[_0x1c0ab0][_0x2024eb(0x1c3)]=_0x4f3a2d;}),_0x43c192[_0x590a25(0x203)]((_0x4cbb88,_0x2d9a9f)=>{var _0x44ba8e=_0x590a25;_0x4f3b41[_0x2d9a9f][_0x44ba8e(0x1f8)]=_0x4cbb88;}),_0x1b810b[_0x590a25(0x203)]((_0x32a73c,_0x4f5e58)=>{var _0x126542=_0x590a25;_0x4f3b41[_0x4f5e58][_0x126542(0x130)]=_0x32a73c;}),_0x17ef40[_0x590a25(0x203)]((_0x28a914,_0x2241bf)=>{var _0x279337=_0x590a25;_0x4f3b41[_0x2241bf][_0x279337(0x1a3)]=_0x28a914;}),_0x58debb['forEach']((_0x4bdeff,_0x146edb)=>{_0x4f3b41[_0x146edb]['expiry_date']=_0x4bdeff;});const _0x57a51d=_0x4f3b41['filter'](_0xd44bd3=>_0xd44bd3['quantity']!=='0'&&_0xd44bd3[_0x590a25(0x18e)]!=='');_0xe8698d['invoice']=_0x9614d8,_0xe8698d['suppliers']=_0x41dbf5,_0xe8698d[_0x590a25(0x206)]=_0x2fbd62,_0xe8698d['warehouse_name']=_0x458cb0,_0xe8698d['product']=_0x57a51d,_0xe8698d[_0x590a25(0x127)]=_0x62e640,_0xe8698d[_0x590a25(0x198)]=_0x2d451d,_0xe8698d[_0x590a25(0x1d6)]=_0x3c3a77,_0xe8698d[_0x590a25(0x108)]=_0x217ac7,_0xe8698d[_0x590a25(0x1f3)]=_0x53efd2,_0xe8698d[_0x590a25(0x166)]=_0x133e5a;const _0x34f210=await _0xe8698d[_0x590a25(0x12b)](),_0x58f4d6=await warehouse[_0x590a25(0x1bd)]({'name':_0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x13a)],'room':_0x47bce3['body'][_0x590a25(0x1ee)]});_0xe8698d[_0x590a25(0x16b)][_0x590a25(0x203)](_0x5e74b6=>{var _0x46e009=_0x590a25,_0x2d1171=0x0;const _0x327432=_0x58f4d6['product_details'][_0x46e009(0x1c6)](_0x55be11=>{var _0x1a5ea6=_0x46e009;_0x55be11[_0x1a5ea6(0x202)]==_0x5e74b6[_0x1a5ea6(0x202)]&&_0x55be11[_0x1a5ea6(0x128)]==_0x5e74b6[_0x1a5ea6(0x128)]&&(_0x55be11[_0x1a5ea6(0x183)]=parseInt(_0x55be11['product_stock'])+parseInt(_0x5e74b6['quantity']),_0x2d1171++);});_0x2d1171=='0'&&(_0x58f4d6[_0x46e009(0x161)]=_0x58f4d6[_0x46e009(0x161)][_0x46e009(0x10c)]({'product_name':_0x5e74b6['product_name'],'product_stock':_0x5e74b6[_0x46e009(0x18e)],'primary_code':_0x5e74b6['primary_code'],'secondary_code':_0x5e74b6[_0x46e009(0x1f8)],'product_code':_0x5e74b6[_0x46e009(0x10a)],'bay':_0x5e74b6[_0x46e009(0x128)],'maxProducts':_0x5e74b6[_0x46e009(0x130)],'unit':_0x5e74b6[_0x46e009(0x141)],'secondary_unit':_0x5e74b6[_0x46e009(0x1e3)],'expiry_date':_0x5e74b6[_0x46e009(0x204)]}));}),await _0x58f4d6[_0x590a25(0x12b)]();const _0xb8cf48=await s_payment_data['findOne']({'invoice':_0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x1a5)]});if(_0xb8cf48===null){}else console[_0x590a25(0x143)](_0x590a25(0x1ea),_0xb8cf48,_0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x1a5)]),_0xb8cf48[_0x590a25(0x1ea)]=_0x47bce3[_0x590a25(0x1cb)][_0x590a25(0x1ea)],await _0xb8cf48['save']();_0x47bce3['flash']('success',_0x590a25(0x1ca)),_0xacaf81['redirect'](_0x590a25(0x1d8));}catch(_0x542051){console[_0x590a25(0x143)](_0x542051);}}),router[a0_0x30599f(0x1d9)](a0_0x30599f(0x14a),auth,async(_0xc45649,_0x1e3da8)=>{var _0xd4a730=a0_0x30599f;try{const _0x5449fd=_0xc45649[_0xd4a730(0x195)]['id'],{invoice:_0xd88761,suppliers:_0x29dace,payable:_0x338441,due_amount:_0x3586ce}=_0xc45649[_0xd4a730(0x1cb)],_0xee3fbf=await purchases[_0xd4a730(0x1e8)](_0x5449fd);var _0x2dbe3a=_0x338441-_0x3586ce;_0xee3fbf['paid_amount']=parseFloat(_0xee3fbf[_0xd4a730(0x198)])+parseFloat(_0x3586ce),_0xee3fbf['due_amount']=_0x2dbe3a;const _0x3ac515=await _0xee3fbf[_0xd4a730(0x12b)]();console['log'](_0x3ac515);const _0x45b0c3=await s_payment_data[_0xd4a730(0x1bd)]({'invoice':_0xd88761});_0x45b0c3[_0xd4a730(0x11e)]=_0x2dbe3a,await _0x45b0c3[_0xd4a730(0x12b)]();let _0x10920c=new Date(),_0x385e82=('0'+_0x10920c['getDate']())[_0xd4a730(0x11a)](-0x2),_0x2ffab0=('0'+(_0x10920c[_0xd4a730(0x1c7)]()+0x1))['slice'](-0x2),_0x25e443=_0x10920c['getFullYear'](),_0xed0407=_0x25e443+'-'+_0x2ffab0+'-'+_0x385e82;const _0x486c24=new suppliers_payment({'invoice':_0xd88761,'date':_0x25e443+'-'+_0x2ffab0+'-'+_0x385e82,'suppliers':_0x29dace,'reason':_0xd4a730(0x1cf),'amount':_0x3586ce}),_0x4f9276=await _0x486c24[_0xd4a730(0x12b)]();_0xc45649[_0xd4a730(0x17d)](_0xd4a730(0x15a),'payment\x20successfull'),_0x1e3da8[_0xd4a730(0x1cd)](_0xd4a730(0x1ff));}catch(_0x6d2d1b){console[_0xd4a730(0x143)](_0x6d2d1b);}}),router['get'](a0_0x30599f(0x1b8),auth,async(_0x132f53,_0x182142)=>{var _0x95a3e8=a0_0x30599f;try{const {username:_0x3969d9,email:_0x1186d6,role:_0x5a28df}=_0x132f53[_0x95a3e8(0x190)],_0x52fade=_0x132f53[_0x95a3e8(0x190)],_0x4090b8=await profile[_0x95a3e8(0x1bd)]({'email':_0x52fade[_0x95a3e8(0x15f)]}),_0x3b4c5e=await master_shop['find']();console[_0x95a3e8(0x143)](_0x95a3e8(0x1da),_0x3b4c5e);const _0x364a0b=_0x132f53[_0x95a3e8(0x195)]['id'],_0x1cfeba=await purchases[_0x95a3e8(0x1e8)](_0x364a0b);console[_0x95a3e8(0x143)](_0x1cfeba);const _0x237024=await suppliers[_0x95a3e8(0x1bd)]({'name':_0x1cfeba[_0x95a3e8(0x1ea)]});console['log'](_0x237024);if(_0x3b4c5e[0x0][_0x95a3e8(0x12f)]==_0x95a3e8(0x1b5)){var _0xe1b4b9=users[_0x95a3e8(0x207)];console[_0x95a3e8(0x143)](_0xe1b4b9);}else{if(_0x3b4c5e[0x0][_0x95a3e8(0x12f)]==_0x95a3e8(0x1a6))var _0xe1b4b9=users[_0x95a3e8(0x1a6)];else{if(_0x3b4c5e[0x0]['language']==_0x95a3e8(0x119))var _0xe1b4b9=users[_0x95a3e8(0x119)];else{if(_0x3b4c5e[0x0]['language']=='Spanish')var _0xe1b4b9=users[_0x95a3e8(0x1f7)];else{if(_0x3b4c5e[0x0][_0x95a3e8(0x12f)]==_0x95a3e8(0x177))var _0xe1b4b9=users['French'];else{if(_0x3b4c5e[0x0][_0x95a3e8(0x12f)]=='Portuguese\x20(BR)')var _0xe1b4b9=users['Portuguese'];else{if(_0x3b4c5e[0x0][_0x95a3e8(0x12f)]==_0x95a3e8(0x169))var _0xe1b4b9=users['Chinese'];else{if(_0x3b4c5e[0x0][_0x95a3e8(0x12f)]==_0x95a3e8(0x105))var _0xe1b4b9=users[_0x95a3e8(0x1e9)];}}}}}}}_0x182142['render'](_0x95a3e8(0x170),{'success':_0x132f53['flash']('success'),'errors':_0x132f53['flash'](_0x95a3e8(0x1b6)),'role':_0x52fade,'profile':_0x4090b8,'master_shop':_0x3b4c5e,'supplier':_0x237024,'purchase':_0x1cfeba,'language':_0xe1b4b9});}catch(_0xa4e751){console[_0x95a3e8(0x143)](_0xa4e751);}}),router[a0_0x30599f(0x13f)](a0_0x30599f(0x179),auth,async(_0x4b58e7,_0x106eef)=>{var _0x3498a7=a0_0x30599f;try{const {username:_0x52fc1e,email:_0x372682,role:_0x4655b8}=_0x4b58e7[_0x3498a7(0x190)],_0x17ae5c=_0x4b58e7[_0x3498a7(0x190)],_0xa34e66=await profile['findOne']({'email':_0x17ae5c['email']}),_0x4db0df=await master_shop[_0x3498a7(0x1c1)]();console[_0x3498a7(0x143)](_0x3498a7(0x1da),_0x4db0df);const _0x2695bb=_0x4b58e7['params']['id'];console[_0x3498a7(0x143)](_0x2695bb);const _0x32debd=await purchases_finished[_0x3498a7(0x1e8)](_0x2695bb);console[_0x3498a7(0x143)](_0x3498a7(0x13d),_0x32debd);const _0x2337ac=await product[_0x3498a7(0x1c1)]({}),_0x49962b=await warehouse[_0x3498a7(0x12e)]([{'$match':{'name':_0x32debd[_0x3498a7(0x13a)],'room':_0x32debd[_0x3498a7(0x108)]}},{'$unwind':_0x3498a7(0x196)},{'$group':{'_id':_0x3498a7(0x1ae),'name':{'$first':_0x3498a7(0x134)},'product_stock':{'$first':_0x3498a7(0x18a)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x3498a7(0x164)},'type':{'$first':_0x3498a7(0x18b)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3498a7(0x158)},'secondary_code':{'$first':_0x3498a7(0x19c)},'product_code':{'$first':_0x3498a7(0x133)},'storage':{'$first':_0x3498a7(0x1f0)},'rack':{'$first':_0x3498a7(0x1a4)}}}]);console[_0x3498a7(0x143)](_0x3498a7(0x154),_0x49962b);let _0x4931e8;if(_0x17ae5c['role']==_0x3498a7(0x1dd)){const _0x3ab4c9=await staff['findOne']({'email':_0x17ae5c[_0x3498a7(0x15f)]});_0x4931e8=await warehouse['find']({'status':'Enabled','name':_0x3ab4c9[_0x3498a7(0x138)],'warehouse_category':_0x3498a7(0x160),'name':_0x3498a7(0x1f5)});}else _0x4931e8=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x3498a7(0x160),'name':'Return\x20Goods'}},{'$group':{'_id':_0x3498a7(0x1e5),'name':{'$first':_0x3498a7(0x1e5)}}}]);if(_0x4db0df[0x0]['language']==_0x3498a7(0x1b5)){var _0x28987e=users['English'];console[_0x3498a7(0x143)](_0x28987e);}else{if(_0x4db0df[0x0][_0x3498a7(0x12f)]==_0x3498a7(0x1a6))var _0x28987e=users['Hindi'];else{if(_0x4db0df[0x0][_0x3498a7(0x12f)]==_0x3498a7(0x119))var _0x28987e=users['German'];else{if(_0x4db0df[0x0][_0x3498a7(0x12f)]==_0x3498a7(0x1f7))var _0x28987e=users['Spanish'];else{if(_0x4db0df[0x0][_0x3498a7(0x12f)]==_0x3498a7(0x177))var _0x28987e=users['French'];else{if(_0x4db0df[0x0][_0x3498a7(0x12f)]==_0x3498a7(0x17f))var _0x28987e=users[_0x3498a7(0x118)];else{if(_0x4db0df[0x0][_0x3498a7(0x12f)]==_0x3498a7(0x169))var _0x28987e=users[_0x3498a7(0x169)];else{if(_0x4db0df[0x0][_0x3498a7(0x12f)]=='Arabic\x20(ae)')var _0x28987e=users[_0x3498a7(0x1e9)];}}}}}}}_0x106eef[_0x3498a7(0x112)]('return_purchase_finished',{'success':_0x4b58e7[_0x3498a7(0x17d)]('success'),'errors':_0x4b58e7['flash'](_0x3498a7(0x1b6)),'role':_0x17ae5c,'profile':_0xa34e66,'user':_0x32debd,'stock':_0x49962b,'master_shop':_0x4db0df,'product':_0x2337ac,'language':_0x28987e,'warehouse':_0x4931e8});}catch(_0x281b27){console['log'](_0x281b27);}}),router[a0_0x30599f(0x1d9)](a0_0x30599f(0x179),auth,async(_0x59cba3,_0x45523d)=>{var _0x28169d=a0_0x30599f;try{const {invoice:_0xff4569,date:_0x315958,warehouse_name:_0x44bebd,Room_name:_0x1c9d22,product_name:_0x54e26d,purchase_quantity:_0xa81e4b,stocks:_0x4f472a,return_qty:_0x3b01c8,note:_0xc47a5a,level:_0x2d622b,isle:_0x3be813,pallet:_0x24e5c4,to_warehouse_name:_0x4a995a,to_Room_name:_0x26e293}=_0x59cba3[_0x28169d(0x1cb)],_0x3c7cc6=await purchases_finished[_0x28169d(0x1bd)]({'_id':_0x59cba3['params']['id']}),_0x21ea8a=await warehouse[_0x28169d(0x1bd)]({'name':_0x44bebd,'room':_0x1c9d22,'warehouse_category':_0x28169d(0x160)});if(typeof _0x54e26d==_0x28169d(0x17a))var _0xc4bc4c=[_0x59cba3['body'][_0x28169d(0x202)]],_0xfbfae6=[_0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x132)]],_0x23c013=[_0x59cba3['body'][_0x28169d(0x140)]],_0xe0aeea=[_0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x187)]],_0x24a2cd=[_0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x17c)]],_0x2632ee=[_0x59cba3[_0x28169d(0x1cb)]['product_code_hide']],_0x5edfb7=[_0x59cba3[_0x28169d(0x1cb)]['primary_code_hide']],_0x5f1f19=[_0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x1a1)]];else var _0xc4bc4c=[..._0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x202)]],_0xfbfae6=[..._0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x132)]],_0x23c013=[..._0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x140)]],_0xe0aeea=[..._0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x187)]],_0x24a2cd=[..._0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x17c)]],_0x2632ee=[..._0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x12a)]],_0x5edfb7=[..._0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x1a0)]],_0x5f1f19=[..._0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x1a1)]];const _0x58a5ba=_0xc4bc4c[_0x28169d(0x1c6)](_0x4e1c29=>{return _0x4e1c29={'product_name':_0x4e1c29};});_0xfbfae6['forEach']((_0xe207f,_0x1b4bda)=>{var _0x4a1209=_0x28169d;_0x58a5ba[_0x1b4bda][_0x4a1209(0x132)]=_0xe207f;}),_0x23c013['forEach']((_0x22f086,_0x4a060f)=>{var _0x56c335=_0x28169d;_0x58a5ba[_0x4a060f][_0x56c335(0x110)]=_0x22f086;}),_0xe0aeea[_0x28169d(0x203)]((_0x414a24,_0x1c099f)=>{_0x58a5ba[_0x1c099f]['return_qty']=_0x414a24;}),_0x24a2cd[_0x28169d(0x203)]((_0xf5a3f8,_0x54af12)=>{_0x58a5ba[_0x54af12]['bay']=_0xf5a3f8;}),_0x2632ee['forEach']((_0x173c30,_0x722e68)=>{var _0x35e60e=_0x28169d;_0x58a5ba[_0x722e68][_0x35e60e(0x10a)]=_0x173c30;}),_0x5edfb7[_0x28169d(0x203)]((_0x82045c,_0x3bf467)=>{var _0xf2bd64=_0x28169d;_0x58a5ba[_0x3bf467][_0xf2bd64(0x1c3)]=_0x82045c;}),_0x5f1f19[_0x28169d(0x203)]((_0x6106ae,_0x3ef05a)=>{_0x58a5ba[_0x3ef05a]['secondary_code']=_0x6106ae;}),_0x58a5ba[_0x28169d(0x203)](_0x166bce=>{console['log'](_0x166bce);const _0x4d71b7=_0x21ea8a['product_details']['map'](_0x2fdf4e=>{var _0x88d8bf=a0_0x51fa;_0x2fdf4e[_0x88d8bf(0x202)]==_0x166bce[_0x88d8bf(0x202)]&&_0x2fdf4e[_0x88d8bf(0x128)]==_0x166bce[_0x88d8bf(0x128)]&&(console[_0x88d8bf(0x143)](parseInt(_0x2fdf4e[_0x88d8bf(0x183)])+_0x88d8bf(0x1d7)+parseInt(_0x166bce[_0x88d8bf(0x187)])),_0x2fdf4e[_0x88d8bf(0x183)]=parseInt(_0x2fdf4e['product_stock'])-parseInt(_0x166bce[_0x88d8bf(0x187)]));});}),await _0x21ea8a[_0x28169d(0x12b)]();var _0x1c4d64=0x0;_0x58a5ba[_0x28169d(0x203)](_0x13d062=>{var _0x586ac8=_0x28169d;(parseInt(_0x13d062[_0x586ac8(0x132)])<parseInt(_0x13d062[_0x586ac8(0x187)])||parseInt(_0x13d062['stock_quantity'])<parseInt(_0x13d062[_0x586ac8(0x187)]))&&_0x1c4d64++;});if(_0x1c4d64!=0x0)return _0x59cba3[_0x28169d(0x17d)](_0x28169d(0x1b6),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x45523d[_0x28169d(0x1cd)](_0x28169d(0x209));const _0x1e590e=new purchases_return_finished({'invoice':_0xff4569,'suppliers':_0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x1ea)],'date':_0x315958,'warehouse_name':_0x44bebd,'return_product':_0x58a5ba,'note':_0xc47a5a,'room':_0x1c9d22,'to_warehouse_name':_0x4a995a,'to_room':_0x26e293}),_0x2da81e=await _0x1e590e['save'](),_0x1b4890=await purchases_return_finished[_0x28169d(0x1bd)]({'invoice':_0xff4569}),_0xdce995=await warehouse[_0x28169d(0x1bd)]({'name':_0x4a995a,'room':_0x26e293,'warehouse_category':'Finished\x20Goods'});_0x1b4890[_0x28169d(0x14e)][_0x28169d(0x203)](_0x1d6c81=>{var _0x48f2df=_0x28169d,_0x55e8f4=0x0;const _0x3e1664=_0xdce995['product_details'][_0x48f2df(0x1c6)](_0x3c411b=>{var _0x8eae8b=_0x48f2df;console[_0x8eae8b(0x143)](_0x3c411b[_0x8eae8b(0x202)]+'=='+_0x1d6c81['product_name']+'&&'+_0x3c411b[_0x8eae8b(0x128)]+'=='+_0x1d6c81[_0x8eae8b(0x128)]),_0x3c411b[_0x8eae8b(0x202)]==_0x1d6c81['product_name']&&_0x3c411b[_0x8eae8b(0x128)]==_0x1d6c81[_0x8eae8b(0x128)]&&(_0x3c411b[_0x8eae8b(0x183)]=parseInt(_0x3c411b['product_stock'])-parseInt(_0x1d6c81[_0x8eae8b(0x187)]),_0x55e8f4++);});_0x55e8f4=='0'&&(_0xdce995['product_details']=_0xdce995[_0x48f2df(0x161)][_0x48f2df(0x10c)]({'product_name':_0x1d6c81[_0x48f2df(0x202)],'product_stock':_0x1d6c81[_0x48f2df(0x187)],'primary_code':_0x1d6c81['primary_code'],'secondary_code':_0x1d6c81['secondary_code'],'product_code':_0x1d6c81[_0x48f2df(0x10a)],'bay':_0x1d6c81['bay'],'maxProducts':0xf423f}));}),await _0xdce995[_0x28169d(0x12b)]();const _0xfc5915=await purchases_finished['findOne']({'invoice':_0xff4569});_0xfc5915[_0x28169d(0x1ef)]=_0x28169d(0x180);const _0x131d0e=await _0xfc5915['save'](),_0x1f90a8=new s_payment_data({'invoice':_0xff4569,'suppliers':_0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x1ea)],'reason':'Purchase\x20Return'});await _0x1f90a8[_0x28169d(0x12b)]();const _0x3b474e=await master_shop[_0x28169d(0x1c1)](),_0x26cf7f=await email_settings[_0x28169d(0x1bd)](),_0x4107d0=await suppliers[_0x28169d(0x1bd)]({'name':_0x59cba3[_0x28169d(0x1cb)][_0x28169d(0x1ea)]});_0x3b474e[0x0][_0x28169d(0x1a7)]==0x1?(right_currency=_0x3b474e[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x3b474e[0x0][_0x28169d(0x163)]);var _0x4de790=_0xc4bc4c,_0x5adfe9=_0xe0aeea,_0x49bef7='',_0x3f2e89;for(_0x3f2e89 in _0x4de790){_0x49bef7+=_0x28169d(0x1b1)+_0x28169d(0x1de)+_0x4de790[_0x3f2e89]+_0x28169d(0x175)+_0x28169d(0x1de)+_0x5adfe9[_0x3f2e89]+_0x28169d(0x175)+_0x28169d(0x1ed);}let _0x48f5b6=nodemailer[_0x28169d(0x144)]({'service':_0x28169d(0x1ac),'auth':{'user':_0x26cf7f[_0x28169d(0x15f)],'pass':_0x26cf7f[_0x28169d(0x16f)]}}),_0x337a1a={'from':_0x26cf7f[_0x28169d(0x15f)],'to':_0x4107d0['email'],'subject':_0x28169d(0x172),'attachments':[{'filename':_0x28169d(0x113),'path':__dirname+_0x28169d(0x1ba)+_0x28169d(0x19e)+_0x3b474e[0x0][_0x28169d(0x136)],'cid':_0x28169d(0x178)}],'html':_0x28169d(0x152)+_0x28169d(0x197)+'</head><body>'+_0x28169d(0x191)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x28169d(0x191)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x28169d(0x121)+_0x28169d(0x191)+'<h2>\x20'+_0x3b474e[0x0]['site_title']+_0x28169d(0x137)+_0x28169d(0x121)+_0x28169d(0x121)+'<hr\x20class=\x22my-3\x22>'+_0x28169d(0x191)+_0x28169d(0x1ab)+'\x20Order\x20Number\x20:\x20'+_0xff4569+'\x20'+_0x28169d(0x1bc)+'\x20Order\x20Date\x20:\x20'+_0x315958+'\x20'+_0x28169d(0x1b3)+_0x28169d(0x148)+_0x28169d(0x121)+_0x28169d(0x171)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x28169d(0x16e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x28169d(0x11f)+_0x28169d(0x1d5)+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x49bef7+'\x20'+_0x28169d(0x18d)+_0x28169d(0x147)+_0x28169d(0x191)+'<strong>\x20Regards\x20</strong>'+_0x28169d(0x115)+_0x3b474e[0x0][_0x28169d(0x1e7)]+_0x28169d(0x148)+'</div>'+_0x28169d(0x121)+_0x28169d(0x104)};_0x48f5b6['sendMail'](_0x337a1a,function(_0x1bda29,_0x5d0fca){var _0x1884a1=_0x28169d;_0x1bda29?console[_0x1884a1(0x143)](_0x1884a1(0x155)):console[_0x1884a1(0x143)]('Email\x20sent\x20successfully');}),_0x59cba3[_0x28169d(0x17d)](_0x28169d(0x15a),_0x28169d(0x106)),_0x45523d[_0x28169d(0x1cd)](_0x28169d(0x1d8));}catch(_0x4224fe){_0x45523d[_0x28169d(0x1fd)](0xc8)[_0x28169d(0x1fb)]({'message':_0x4224fe[_0x28169d(0x1a2)]});}}),router[a0_0x30599f(0x13f)](a0_0x30599f(0x111),auth,async(_0x56a7ac,_0x54c50e)=>{var _0x3a5b15=a0_0x30599f;try{const {username:_0x67dede,email:_0x38ae33,role:_0x1438b6}=_0x56a7ac[_0x3a5b15(0x190)],_0x1cd55c=_0x56a7ac[_0x3a5b15(0x190)],_0x52c3cb=await profile[_0x3a5b15(0x1bd)]({'email':_0x1cd55c[_0x3a5b15(0x15f)]}),_0x4d3e6e=await master_shop['find'](),_0x189033=_0x56a7ac['params']['id'],_0x52b411=await purchases_finished[_0x3a5b15(0x1e8)](_0x189033);if(_0x4d3e6e[0x0][_0x3a5b15(0x12f)]==_0x3a5b15(0x1b5))var _0x337aed=users['English'];else{if(_0x4d3e6e[0x0][_0x3a5b15(0x12f)]==_0x3a5b15(0x1a6))var _0x337aed=users[_0x3a5b15(0x1a6)];else{if(_0x4d3e6e[0x0][_0x3a5b15(0x12f)]=='German')var _0x337aed=users['German'];else{if(_0x4d3e6e[0x0]['language']==_0x3a5b15(0x1f7))var _0x337aed=users[_0x3a5b15(0x1f7)];else{if(_0x4d3e6e[0x0][_0x3a5b15(0x12f)]=='French')var _0x337aed=users['French'];else{if(_0x4d3e6e[0x0][_0x3a5b15(0x12f)]==_0x3a5b15(0x17f))var _0x337aed=users['Portuguese'];else{if(_0x4d3e6e[0x0]['language']=='Chinese')var _0x337aed=users['Chinese'];else{if(_0x4d3e6e[0x0][_0x3a5b15(0x12f)]=='Arabic\x20(ae)')var _0x337aed=users['Arabic'];}}}}}}}_0x54c50e[_0x3a5b15(0x112)](_0x3a5b15(0x19d),{'success':_0x56a7ac['flash']('success'),'errors':_0x56a7ac[_0x3a5b15(0x17d)](_0x3a5b15(0x1b6)),'role':_0x1cd55c,'profile':_0x52c3cb,'alldata':_0x52b411,'master_shop':_0x4d3e6e,'language':_0x337aed}),console[_0x3a5b15(0x143)](alldata);}catch(_0x196819){console[_0x3a5b15(0x143)](_0x196819);}}),router[a0_0x30599f(0x1d9)]('/barcode_scanner',async(_0x19c769,_0xf043e9)=>{var _0x428e18=a0_0x30599f;const {product_code:_0x4c8950}=_0x19c769[_0x428e18(0x1cb)];var _0x186545;const _0x5d9a5b=await product['aggregate']([{'$match':{'primary_code':_0x4c8950,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x428e18(0x1be),'name':{'$first':_0x428e18(0x1e5)},'category':{'$first':_0x428e18(0x189)},'brand':{'$first':_0x428e18(0x182)},'unit':{'$first':_0x428e18(0x1b7)},'alertquantity':{'$first':_0x428e18(0x1dc)},'product_code':{'$first':_0x428e18(0x15c)},'primary_code':{'$first':_0x428e18(0x10b)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x428e18(0x1d3)},'maxProdPerUnit':{'$first':_0x428e18(0x16c)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xc61250=await product[_0x428e18(0x12e)]([{'$match':{'secondary_code':_0x4c8950}},{'$group':{'_id':_0x428e18(0x1be),'name':{'$first':'$name'},'category':{'$first':_0x428e18(0x189)},'brand':{'$first':_0x428e18(0x182)},'unit':{'$first':_0x428e18(0x1b7)},'alertquantity':{'$first':_0x428e18(0x1dc)},'product_code':{'$first':_0x428e18(0x15c)},'primary_code':{'$first':_0x428e18(0x10b)},'secondary_code':{'$first':_0x428e18(0x201)},'maxStocks':{'$first':_0x428e18(0x1d3)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x428e18(0x139)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5d9a5b['length']>0x0)_0x186545=_0x5d9a5b;else _0xc61250[_0x428e18(0x1db)]>0x0&&(_0x186545=_0xc61250);_0xf043e9[_0x428e18(0x1fb)](_0x186545);}),router[a0_0x30599f(0x1d9)](a0_0x30599f(0x19b),async(_0x240eeb,_0x1343ca)=>{var _0xa5d513=a0_0x30599f;const {productCode:_0x14f90d,bay:_0x50d3ee,warehouses:_0x55eedb,room:_0x48a964}=_0x240eeb[_0xa5d513(0x1cb)];console['log'](_0x240eeb[_0xa5d513(0x1cb)]);try{const _0x5c86e9=await warehouse[_0xa5d513(0x12e)]([{'$match':{'name':_0x55eedb,'room':_0x48a964}},{'$unwind':_0xa5d513(0x196)},{'$match':{'product_details.bay':parseInt(_0x50d3ee)}},{'$group':{'_id':_0xa5d513(0x1ae),'name':{'$first':_0xa5d513(0x134)},'product_stock':{'$first':_0xa5d513(0x18a)},'bay':{'$first':_0xa5d513(0x135)},'maxProducts':{'$first':_0xa5d513(0x1c5)}}}]);_0x1343ca[_0xa5d513(0x1fd)](0xc8)[_0xa5d513(0x1fb)](_0x5c86e9);}catch(_0x164198){_0x1343ca[_0xa5d513(0x1fd)](0x194)['json']({'message':_0x164198['message']});}}),module[a0_0x30599f(0x1f2)]=router;