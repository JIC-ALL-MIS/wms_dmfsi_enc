var a0_0x13bedd=a0_0x2ba2;(function(_0x436d87,_0x306169){var _0x1d89d1=a0_0x2ba2,_0x339375=_0x436d87();while(!![]){try{var _0x1668bb=parseInt(_0x1d89d1(0x15b))/0x1*(parseInt(_0x1d89d1(0x130))/0x2)+parseInt(_0x1d89d1(0xdc))/0x3+-parseInt(_0x1d89d1(0x123))/0x4*(parseInt(_0x1d89d1(0x125))/0x5)+-parseInt(_0x1d89d1(0x19b))/0x6+parseInt(_0x1d89d1(0x13c))/0x7*(-parseInt(_0x1d89d1(0xf1))/0x8)+-parseInt(_0x1d89d1(0xd9))/0x9*(parseInt(_0x1d89d1(0xeb))/0xa)+-parseInt(_0x1d89d1(0x114))/0xb*(-parseInt(_0x1d89d1(0x1b8))/0xc);if(_0x1668bb===_0x306169)break;else _0x339375['push'](_0x339375['shift']());}catch(_0x208bfe){_0x339375['push'](_0x339375['shift']());}}}(a0_0x2af8,0x426bf));const express=require(a0_0x13bedd(0x146)),app=express(),router=express[a0_0x13bedd(0x17a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x13bedd(0x1a6)),auth=require(a0_0x13bedd(0x1cf)),nodemailer=require(a0_0x13bedd(0x18b));var ejs=require('ejs');const path=require(a0_0x13bedd(0x18c)),users=require(a0_0x13bedd(0x116));function a0_0x2af8(){var _0x5784c3=['Room_name','batch_code','English','7ERSvmQ','RoomAssign','back','Enclosed','currency_placement','email','status','prod_unit','message','product_name','express','<strong>\x20Regards\x20</strong>','Enabled','product_code','$product.bin','$product.type','/view/return_purchase/:id','then','return_qty','$category','prod_code','padStart','name','aggregate','language','prod_secondunit','abs','Finished\x20Goods','Error\x20Occurs','add_purchases_finished','product_date','61202GDGOgM','secondary_code_hide','findById','findOne','$return_data','maxperunit','$note','prod_cat','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</tr>','JO_number','catch','<html><head><title></title>','$maxStocks','$product_details.storage','map','$batch_code','slice','An\x20error\x20occurred\x20while\x20saving\x20data.','purchase_invoice','<hr\x20class=\x22my-3\x22>','purchase_quantity','exports','quantity','\x20Order\x20Number\x20:\x20','/upload/','Hindi','staff','/preview/:id','Arabic\x20(ae)','Router','prod_Qty','</div>','prod_level','purchase\x20data\x20add\x20successfully','max_product_unit','product_stock','/view/:id','INCF-','$product_details.bin','$product_details.secondary_code','password','return_purchase_finished','length','secondary_unit','</td>','note','nodemailer','path','product_code_hide','$room','$product_details.rack','FGSEmail','\x20Order\x20Date\x20:\x20','getDate','Purchase\x20Return','<table\x20style=\x22width:\x20100%\x20!important;\x22>','createTransport','<!DOCTYPE\x20html>','date','prod_primunit','<span\x20style=\x22float:\x20right;\x22>','$product.floorlevel','3041532gzkrvS','errors','maxStocks','$product_details.bay','$primary_code','due_amount','prod_qty','QA\x20Warehouse','secondary_code','$product.quantity','save','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','warehouse','user','room','<h5\x20style=\x22text-align:\x20left;\x22>','render','post','purchase\x20data\x20update\x20successfully','POnumber','$secondary_unit','flash','$brand','Return\x20Goods','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','image','floor','192zPWHpJ','stock_data','</thead>','master','find','Rack\x202','/view/add_purchases','all_purchases_barcode','forEach','$secondary_code','<h5>','Purchase\x20Mail','standard_unit','/all_purchases/view','$product_details.floorlevel','$date','Email\x20sent\x20successfully','$suppliers_docs','French','paid_amount','room_name','$product_details.product_code','/barcode/:id','../middleware/auth','Arabic','$product_details.product_name','suppliers_docs','primary_code','prod_invoice','filter','getFullYear','host','</span>','/view','purchases\x20item\x20return\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$alertquantity','German','459HcMtoI','stocks','Logo.png','8733hbEIOs','success','currency','random','suppliers','FROZEN\x20GOODS','getMonth','English\x20(US)','$expiry_date','$product','$product_details','$warehouse_name','Rack\x201','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','DRY\x20GOODS','8950UTrbce','expiry_date','concat','toString','<div>','$suppliers','2616584tsQPbX','<tr>','/give_payment/:id','bay','product_details','$product.room_name','Portuguese\x20(BR)','Error\x20occurred\x20while\x20processing\x20product:','/../public','<tbody\x20style=\x22text-align:\x20center;\x22>','gmail','$unit','level','invoice','$product_details.primary_code','Ambient','stock_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','_id','</h5>','log','Spanish','warehouse_name','MaxStocks_data','add_purchases\x20error','product','port','</head><body>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','sendMail','get','$product_details._id','$maxProdPerUnit','role','751179iwARoT','Portuguese','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','</tbody>','error','$invoice','redirect','table\x20page','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_cat','$due_amount','body','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','16eYwHJO','logo','388805WfcbQu','params','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','True','json','prod_name','edit_purchases_finished_view','string','primary_code_hide','</body></html>','$product_code','12AgDVHh','/all_purchases_finished/view','site_title','</table>','$name','payment\x20successfull','$product_details.product_stock','all_purchases_finished','$paid_amount'];a0_0x2af8=function(){return _0x5784c3;};return a0_0x2af8();}function a0_0x2ba2(_0xbd6fc3,_0x1349bb){var _0x2af868=a0_0x2af8();return a0_0x2ba2=function(_0x2ba24b,_0x2b99f5){_0x2ba24b=_0x2ba24b-0xd2;var _0xca01e3=_0x2af868[_0x2ba24b];return _0xca01e3;},a0_0x2ba2(_0xbd6fc3,_0x1349bb);}router[a0_0x13bedd(0x110)](a0_0x13bedd(0xd4),auth,async(_0x2f12d4,_0x5ae8c8)=>{var _0x1e7cbe=a0_0x13bedd;try{const {username:_0x504156,email:_0x538fb5,role:_0x4a20f4}=_0x2f12d4[_0x1e7cbe(0x1a9)],_0x5beee9=_0x2f12d4[_0x1e7cbe(0x1a9)],_0x5ee645=await profile[_0x1e7cbe(0x15e)]({'email':_0x5beee9[_0x1e7cbe(0x141)]}),_0x3c6007=await staff[_0x1e7cbe(0x15e)]({'email':_0x5beee9['email']});if(_0x5beee9[_0x1e7cbe(0x113)]==_0x1e7cbe(0x177)){const _0x3cbfc4=await staff['findOne']({'email':_0x5beee9['email']});}const _0x330401=await master_shop['find']();let _0x46db07;if(_0x5beee9['role']==_0x1e7cbe(0x177)){const _0x2ca7bd=await staff[_0x1e7cbe(0x15e)]({'email':_0x5beee9[_0x1e7cbe(0x141)]});_0x46db07=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x2ca7bd['warehouse']}},{'$lookup':{'from':_0x1e7cbe(0xe0),'localField':_0x1e7cbe(0xe0),'foreignField':_0x1e7cbe(0x152),'as':_0x1e7cbe(0x1d2)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x1e7cbe(0xe5)},{'$group':{'_id':_0x1e7cbe(0x11d),'invoice':{'$first':_0x1e7cbe(0x11a)},'suppliers':{'$first':_0x1e7cbe(0xf0)},'date':{'$first':_0x1e7cbe(0x1c7)},'warehouse_name':{'$first':_0x1e7cbe(0xe7)},'room':{'$first':_0x1e7cbe(0x18e)},'product':{'$push':_0x1e7cbe(0xe5)},'note':{'$first':_0x1e7cbe(0x161)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x1e7cbe(0x120)},'return_data':{'$first':_0x1e7cbe(0x15f)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x1e7cbe(0xe4)},'suppliers_docs':{'$first':_0x1e7cbe(0x1c9)},'total_product_quantity':{'$sum':_0x1e7cbe(0x1a4)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x1e7cbe(0x14a)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x1e7cbe(0x19a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x46db07=await purchases_finished['aggregate']([{'$unwind':_0x1e7cbe(0xe5)},{'$group':{'_id':_0x1e7cbe(0x11d),'invoice':{'$first':_0x1e7cbe(0x11a)},'suppliers':{'$first':_0x1e7cbe(0xf0)},'date':{'$first':_0x1e7cbe(0x1c7)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x1e7cbe(0xf6)},'product':{'$push':_0x1e7cbe(0xe5)},'note':{'$first':_0x1e7cbe(0x161)},'paid_amount':{'$first':_0x1e7cbe(0x138)},'due_amount':{'$first':_0x1e7cbe(0x120)},'return_data':{'$first':_0x1e7cbe(0x15f)},'batch_code':{'$first':_0x1e7cbe(0x16c)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x1e7cbe(0x1c9)},'total_product_quantity':{'$sum':_0x1e7cbe(0x1a4)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x1e7cbe(0x14a)},'type':{'$addToSet':_0x1e7cbe(0x14b)},'floorlevel':{'$addToSet':_0x1e7cbe(0x19a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x330401[0x0]['language']==_0x1e7cbe(0xe3))var _0x3aa98f=users['English'];else{if(_0x330401[0x0]['language']=='Hindi')var _0x3aa98f=users[_0x1e7cbe(0x176)];else{if(_0x330401[0x0][_0x1e7cbe(0x154)]==_0x1e7cbe(0xd8))var _0x3aa98f=users[_0x1e7cbe(0xd8)];else{if(_0x330401[0x0][_0x1e7cbe(0x154)]==_0x1e7cbe(0x106))var _0x3aa98f=users[_0x1e7cbe(0x106)];else{if(_0x330401[0x0][_0x1e7cbe(0x154)]==_0x1e7cbe(0x1ca))var _0x3aa98f=users[_0x1e7cbe(0x1ca)];else{if(_0x330401[0x0][_0x1e7cbe(0x154)]==_0x1e7cbe(0xf7))var _0x3aa98f=users[_0x1e7cbe(0x115)];else{if(_0x330401[0x0][_0x1e7cbe(0x154)]==_0x1e7cbe(0x1b4))var _0x3aa98f=users['Chinese'];else{if(_0x330401[0x0][_0x1e7cbe(0x154)]=='Arabic\x20(ae)')var _0x3aa98f=users[_0x1e7cbe(0x1d0)];}}}}}}}_0x5ae8c8[_0x1e7cbe(0x1ac)](_0x1e7cbe(0x137),{'success':_0x2f12d4[_0x1e7cbe(0x1b1)]('success'),'errors':_0x2f12d4[_0x1e7cbe(0x1b1)](_0x1e7cbe(0x19c)),'purchases':_0x46db07,'role':_0x5beee9,'profile':_0x5ee645,'master_shop':_0x330401,'language':_0x3aa98f});}catch(_0x3f9737){console[_0x1e7cbe(0x105)](_0x1e7cbe(0x11c),_0x3f9737),_0x5ae8c8[_0x1e7cbe(0x142)](0xc8)[_0x1e7cbe(0x129)]({'message':_0x3f9737['message']});}});function BayBinSelected(_0x2ddc0e,_0x58b6b9){var _0x1f6ea1=a0_0x13bedd,_0x17e6cc=[],_0x31ef2a=[];if(_0x2ddc0e==_0x1f6ea1(0xea)){switch(_0x58b6b9){case _0x1f6ea1(0xe8):_0x17e6cc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x17e6cc=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x31ef2a=['DG'];}else{if(_0x2ddc0e==_0x1f6ea1(0xe1)){switch(_0x58b6b9){case _0x1f6ea1(0xe8):_0x17e6cc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1f6ea1(0x1bd):_0x17e6cc=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x31ef2a=['FG'];}}return{'levels':_0x17e6cc,'identify':_0x31ef2a};}async function getRandom8DigitNumber(){var _0x4e0c8c=a0_0x13bedd;const _0x95b1e4=0x989680,_0x186d46=0x5f5e0ff,_0x5d4a42=Math[_0x4e0c8c(0x1b7)](Math[_0x4e0c8c(0xdf)]()*(_0x186d46-_0x95b1e4+0x1))+_0x95b1e4;var _0x370cf8;const _0x122e78=await purchases_finished[_0x4e0c8c(0x15e)]({'invoice':'INCF-'+_0x5d4a42});return _0x122e78&&_0x122e78[_0x4e0c8c(0x187)]>0x0?_0x370cf8=_0x4e0c8c(0x182)+_0x5d4a42:_0x370cf8=_0x4e0c8c(0x182)+_0x5d4a42,_0x370cf8;}router[a0_0x13bedd(0x110)](a0_0x13bedd(0x1be),auth,async(_0x4a774b,_0x101039)=>{var _0x38d1dd=a0_0x13bedd;try{const {username:_0x6c8b21,email:_0x58418b,role:_0x4427e8}=_0x4a774b[_0x38d1dd(0x1a9)],_0x3c1821=_0x4a774b['user'],_0x12cbf1=await profile[_0x38d1dd(0x15e)]({'email':_0x3c1821[_0x38d1dd(0x141)]}),_0x28133f=await master_shop[_0x38d1dd(0x1bc)](),_0x2c91b3=await staff[_0x38d1dd(0x15e)]({'email':_0x3c1821['email']}),_0x59b059=await suppliers[_0x38d1dd(0x1bc)]({});let _0x285c46;if(_0x3c1821['role']=='staff'){const _0x5db275=await staff['findOne']({'email':_0x3c1821[_0x38d1dd(0x141)]});_0x285c46=await warehouse[_0x38d1dd(0x153)]([{'$match':{'status':_0x38d1dd(0x148),'name':_0x5db275['warehouse'],'warehouse_category':_0x38d1dd(0x157)}},{'$group':{'_id':_0x38d1dd(0x134),'name':{'$first':_0x38d1dd(0x134)}}}]);}else _0x285c46=await warehouse[_0x38d1dd(0x153)]([{'$match':{'status':_0x38d1dd(0x148),'warehouse_category':_0x38d1dd(0x157),'name':{'$ne':_0x38d1dd(0x1a2)}}},{'$group':{'_id':_0x38d1dd(0x134),'name':{'$first':_0x38d1dd(0x134)}}}]);const _0x1ffb29=await product[_0x38d1dd(0x1bc)]({}),_0x528b2a=await warehouse['find']({'status':_0x38d1dd(0x148)}),_0x45f8c6=await purchases_finished['find']({}),_0x4a9782=_0x45f8c6[_0x38d1dd(0x187)]+0x1,_0x144033=_0x38d1dd(0x182)+_0x4a9782[_0x38d1dd(0xee)]()[_0x38d1dd(0x151)](0x5,'0');var _0xde621e=[_0x38d1dd(0x100),_0x38d1dd(0x13f)];if(_0x28133f[0x0][_0x38d1dd(0x154)]==_0x38d1dd(0xe3))var _0x2b6517=users[_0x38d1dd(0x13b)];else{if(_0x28133f[0x0][_0x38d1dd(0x154)]=='Hindi')var _0x2b6517=users[_0x38d1dd(0x176)];else{if(_0x28133f[0x0][_0x38d1dd(0x154)]==_0x38d1dd(0xd8))var _0x2b6517=users[_0x38d1dd(0xd8)];else{if(_0x28133f[0x0][_0x38d1dd(0x154)]==_0x38d1dd(0x106))var _0x2b6517=users[_0x38d1dd(0x106)];else{if(_0x28133f[0x0][_0x38d1dd(0x154)]==_0x38d1dd(0x1ca))var _0x2b6517=users['French'];else{if(_0x28133f[0x0][_0x38d1dd(0x154)]==_0x38d1dd(0xf7))var _0x2b6517=users[_0x38d1dd(0x115)];else{if(_0x28133f[0x0][_0x38d1dd(0x154)]==_0x38d1dd(0x1b4))var _0x2b6517=users[_0x38d1dd(0x1b4)];else{if(_0x28133f[0x0][_0x38d1dd(0x154)]==_0x38d1dd(0x179))var _0x2b6517=users[_0x38d1dd(0x1d0)];}}}}}}}const _0x2f6621=getRandom8DigitNumber();_0x2f6621['then'](_0x4389e5=>{var _0xc67f4c=_0x38d1dd;_0x101039[_0xc67f4c(0x1ac)](_0xc67f4c(0x159),{'success':_0x4a774b[_0xc67f4c(0x1b1)](_0xc67f4c(0xdd)),'errors':_0x4a774b['flash']('errors'),'role':_0x3c1821,'profile':_0x12cbf1,'suppliers':_0x59b059,'warehouse':_0x285c46,'product':_0x1ffb29,'invoice':_0x4389e5,'master_shop':_0x28133f,'language':_0x2b6517,'find_data':_0x528b2a,'rooms_data':_0xde621e});})[_0x38d1dd(0x167)](_0x4c42ac=>{var _0x611f2d=_0x38d1dd;_0x4a774b['flash'](_0x611f2d(0x19c),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x101039[_0x611f2d(0x11b)](_0x611f2d(0x131));});}catch(_0x4fbbe8){console['log'](_0x4fbbe8);}}),router[a0_0x13bedd(0x110)]('/view/add_purchases/:id',auth,async(_0x978568,_0xe252f0)=>{var _0x20c6d5=a0_0x13bedd;try{const _0x36edab=_0x978568['params']['id'];console[_0x20c6d5(0x105)](_0x36edab);const _0x46f2b2=await master_shop[_0x20c6d5(0x1bc)]();console[_0x20c6d5(0x105)](_0x20c6d5(0x1bb),_0x46f2b2);const _0x2e2304=await product[_0x20c6d5(0x15e)]({'name':_0x36edab});console[_0x20c6d5(0x105)](_0x20c6d5(0x10a),_0x2e2304),_0xe252f0['status'](0xc8)[_0x20c6d5(0x129)]({'product_data':_0x2e2304,'master':_0x46f2b2});}catch(_0x2e457e){console[_0x20c6d5(0x105)](_0x20c6d5(0x109),_0x2e457e);}}),router[a0_0x13bedd(0x1ad)](a0_0x13bedd(0x1be),auth,async(_0x4971df,_0x131141)=>{var _0xc31b9=a0_0x13bedd;try{const {invoice:_0x517804,date:_0x19b98b,warehouse_name:_0x180a08,prod_name:_0x3635df,prod_code:_0x1a8328,prod_qty:_0x297a55,prod_unit:_0x417a81,prod_secondunit:_0x2d73fb,prod_level:_0x3247db,prod_isle:_0x913d4,prod_pallet:_0x1eac92,note:_0x3deede,expiry_date:_0x3658c1,batch_code:_0x1723d5,payable:_0x4e3a78,due_amount:_0xcdd886,Room_name:_0x281b8f,primary_code:_0x545a9c,secondary_code:_0x5c09f1,MaxStocks_data:_0x504fdf,PO_number:_0x4559d9,SCRN:_0x3ab5d2,JO_number:_0x1ed783}=_0x4971df[_0xc31b9(0x121)];if(typeof _0x3635df==_0xc31b9(0x12c))var _0x3fb340=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0x12a)]],_0x36cbe0=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0x150)]],_0x4beb56=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0x17b)]],_0x12ec24=[_0x4971df[_0xc31b9(0x121)]['prod_primunit']],_0x3a3652=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0x155)]],_0x52cc54=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0x17d)]],_0xff7676=[_0x4971df[_0xc31b9(0x121)]['primary_code']],_0x2ed5c2=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0x1a3)]],_0x46afc4=[_0x4971df[_0xc31b9(0x121)]['MaxStocks_data']],_0x3facc0=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0x13a)]],_0x4b0da7=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0xec)]],_0x1b2a9a=[_0x4971df['body'][_0xc31b9(0x15a)]],_0x207d1e=[_0x4971df[_0xc31b9(0x121)]['max_product_unit']],_0x1e0a2b=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0x162)]],_0x1b85ab=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0x13d)]],_0x429aea=[_0x4971df[_0xc31b9(0x121)][_0xc31b9(0x1d4)]];else var _0x3fb340=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x12a)]],_0x36cbe0=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x150)]],_0x4beb56=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x17b)]],_0x12ec24=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x198)]],_0x3a3652=[..._0x4971df['body']['prod_secondunit']],_0x52cc54=[..._0x4971df['body'][_0xc31b9(0x17d)]],_0xff7676=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x1d3)]],_0x2ed5c2=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x1a3)]],_0x46afc4=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x108)]],_0x3facc0=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x13a)]],_0x4b0da7=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0xec)]],_0x1b2a9a=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x15a)]],_0x207d1e=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x17f)]],_0x1e0a2b=[..._0x4971df['body'][_0xc31b9(0x162)]],_0x1b85ab=[..._0x4971df[_0xc31b9(0x121)][_0xc31b9(0x13d)]],_0x429aea=[..._0x4971df[_0xc31b9(0x121)]['prod_invoice']];const _0x2b7567=_0x3fb340[_0xc31b9(0x16b)](_0x305ae9=>{return _0x305ae9={'product_name':_0x305ae9};});_0x36cbe0[_0xc31b9(0x1c0)]((_0x10f332,_0x1e82d5)=>{var _0x2b6cbe=_0xc31b9;_0x2b7567[_0x1e82d5][_0x2b6cbe(0x149)]=_0x10f332;}),_0x4beb56[_0xc31b9(0x1c0)]((_0x5d0181,_0x16ba9f)=>{var _0x39f622=_0xc31b9;_0x2b7567[_0x16ba9f]['quantity']=Math[_0x39f622(0x156)](_0x5d0181);}),_0x12ec24[_0xc31b9(0x1c0)]((_0x25a135,_0x2a3875)=>{_0x2b7567[_0x2a3875]['standard_unit']=_0x25a135;}),_0x3a3652[_0xc31b9(0x1c0)]((_0x37dedb,_0x25d258)=>{var _0x5be6ef=_0xc31b9;_0x2b7567[_0x25d258][_0x5be6ef(0x188)]=_0x37dedb;}),_0x52cc54[_0xc31b9(0x1c0)]((_0x1f292e,_0x1845bf)=>{var _0x5553f2=_0xc31b9;_0x2b7567[_0x1845bf][_0x5553f2(0xf4)]=_0x1f292e;}),_0xff7676['forEach']((_0x54ad67,_0x4f3104)=>{var _0x45afe7=_0xc31b9;_0x2b7567[_0x4f3104][_0x45afe7(0x1d3)]=_0x54ad67;}),_0x2ed5c2[_0xc31b9(0x1c0)]((_0x49ccef,_0x4d994c)=>{var _0x305072=_0xc31b9;_0x2b7567[_0x4d994c][_0x305072(0x1a3)]=_0x49ccef;}),_0x46afc4['forEach']((_0x1536cb,_0x5ac473)=>{var _0x1cf4a7=_0xc31b9;_0x2b7567[_0x5ac473][_0x1cf4a7(0x19d)]=_0x1536cb;}),_0x3facc0[_0xc31b9(0x1c0)]((_0x4c4d65,_0x399674)=>{_0x2b7567[_0x399674]['batch_code']=_0x4c4d65;}),_0x4b0da7[_0xc31b9(0x1c0)]((_0x112a47,_0x17318e)=>{_0x2b7567[_0x17318e]['expiry_date']=_0x112a47;}),_0x1b2a9a[_0xc31b9(0x1c0)]((_0x129e5c,_0x2f81f9)=>{var _0x2284db=_0xc31b9;_0x2b7567[_0x2f81f9][_0x2284db(0x163)]=_0x129e5c;}),_0x207d1e[_0xc31b9(0x1c0)]((_0x1b54ff,_0x42a1e2)=>{var _0x3da7a5=_0xc31b9;_0x2b7567[_0x42a1e2][_0x3da7a5(0x160)]=_0x1b54ff;}),_0x1e0a2b[_0xc31b9(0x1c0)]((_0x18e571,_0x381062)=>{var _0x3d83a3=_0xc31b9;_0x2b7567[_0x381062][_0x3d83a3(0x11f)]=_0x18e571;}),_0x1b85ab['forEach']((_0x387669,_0x459deb)=>{var _0x29efb9=_0xc31b9;_0x2b7567[_0x459deb][_0x29efb9(0x1cc)]=_0x387669;}),_0x429aea[_0xc31b9(0x1c0)]((_0x5d4d4a,_0x18069d)=>{var _0x218563=_0xc31b9;_0x2b7567[_0x18069d][_0x218563(0xfe)]=_0x5d4d4a;});const _0x11596a=_0x2b7567[_0xc31b9(0x1d5)](_0xcae20c=>_0xcae20c[_0xc31b9(0x173)]!=='0'&&_0xcae20c['quantity']!==''),_0x13b75f=new purchases_finished({'invoice':_0x517804,'suppliers':_0x4971df[_0xc31b9(0x121)][_0xc31b9(0xe0)],'date':_0x19b98b,'warehouse_name':_0x180a08,'product':_0x11596a,'note':_0x3deede,'due_amount':_0xcdd886,'room':_0x281b8f,'POnumber':_0x4559d9,'SCRN':_0x3ab5d2,'JO_number':_0x1ed783}),_0x44f66f=await _0x13b75f['save'](),_0x16376d=await purchases_finished['findOne']({'invoice':_0x517804}),_0x1eaba4=_0x16376d[_0xc31b9(0x10a)][_0xc31b9(0x16b)](async _0xb8edab=>{var _0x135812=_0xc31b9;try{var _0x155cf7=await warehouse[_0x135812(0x15e)]({'name':_0x180a08,'room':_0xb8edab[_0x135812(0x1cc)]}),_0xa8fee7=0x0;const _0x33896d=_0x155cf7['product_details'][_0x135812(0x16b)](_0x392933=>{var _0x3afc8c=_0x135812;console[_0x3afc8c(0x105)](_0x392933[_0x3afc8c(0x145)]+'=='+_0xb8edab['product_name']+'&&'+_0x392933[_0x3afc8c(0xf4)]+'=='+_0xb8edab[_0x3afc8c(0xf4)]+'&&'+_0x392933['expiry_date']+'=='+_0xb8edab[_0x3afc8c(0xec)]+'&&'+_0x392933[_0x3afc8c(0x163)]+'=='+_0xb8edab[_0x3afc8c(0x163)]+'&&'+_0x392933[_0x3afc8c(0x13a)]+'=='+_0xb8edab['batch_code']+'&&'+_0x392933[_0x3afc8c(0xfe)]+'=='+_0x16376d[_0x3afc8c(0xfe)]),_0x392933['product_name']==_0xb8edab['product_name']&&_0x392933[_0x3afc8c(0xf4)]==_0xb8edab[_0x3afc8c(0xf4)]&&_0x392933['expiry_date']==_0xb8edab['expiry_date']&&_0x392933[_0x3afc8c(0x163)]==_0xb8edab[_0x3afc8c(0x163)]&&_0x392933[_0x3afc8c(0x13a)]==_0xb8edab[_0x3afc8c(0x13a)]&&_0x392933['invoice']==_0x16376d[_0x3afc8c(0xfe)]&&(_0x392933[_0x3afc8c(0x180)]=Math[_0x3afc8c(0x156)](_0x392933[_0x3afc8c(0x180)])+Math[_0x3afc8c(0x156)](_0xb8edab[_0x3afc8c(0x173)]),_0xa8fee7++);});return _0xa8fee7==0x0&&(_0x155cf7[_0x135812(0xf5)]=_0x155cf7[_0x135812(0xf5)][_0x135812(0xed)]({'product_name':_0xb8edab[_0x135812(0x145)],'product_stock':Math[_0x135812(0x156)](_0xb8edab[_0x135812(0x173)]),'primary_code':_0xb8edab[_0x135812(0x1d3)],'secondary_code':_0xb8edab['secondary_code'],'product_code':_0xb8edab[_0x135812(0x149)],'bay':_0xb8edab[_0x135812(0xf4)],'maxProducts':_0xb8edab[_0x135812(0x19d)],'unit':_0xb8edab[_0x135812(0x1c4)],'secondary_unit':_0xb8edab[_0x135812(0x188)],'expiry_date':_0xb8edab['expiry_date'],'production_date':_0xb8edab['production_date'],'maxProducts':_0xb8edab[_0x135812(0x19d)],'maxPerUnit':_0xb8edab[_0x135812(0x160)],'batch_code':_0xb8edab[_0x135812(0x13a)],'product_cat':_0xb8edab[_0x135812(0x11f)],'invoice':_0xb8edab[_0x135812(0xfe)],'id_incoming':_0xb8edab[_0x135812(0x103)]})),_0x155cf7;}catch(_0x511dd2){return console[_0x135812(0x119)](_0x135812(0xf8),_0x511dd2),null;}});Promise['all'](_0x1eaba4)[_0xc31b9(0x14d)](async _0x484752=>{var _0x47f2d3=_0xc31b9;try{for(const _0x108f1f of _0x484752){await warehouse['updateOne']({'_id':_0x108f1f[_0x47f2d3(0x103)]},{'$addToSet':{'product_details':{'$each':_0x108f1f[_0x47f2d3(0xf5)]}}});}const _0x154040=await master_shop[_0x47f2d3(0x1bc)](),_0x3f940e=await email_settings[_0x47f2d3(0x15e)](),_0x2e6224=await supervisor_settings[_0x47f2d3(0x1bc)]();var _0x351b79=_0x16376d[_0x47f2d3(0x10a)],_0x4d76a2='',_0x5db6d6;for(_0x5db6d6 in _0x351b79){var _0x6ec9cd='FG';_0x16376d[_0x47f2d3(0x107)]=='DRY\x20GOODS'&&(_0x6ec9cd='DG'),_0x4d76a2+=_0x47f2d3(0xf2)+_0x47f2d3(0x127)+_0x351b79[_0x5db6d6][_0x47f2d3(0x145)]+_0x47f2d3(0x189)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x351b79[_0x5db6d6][_0x47f2d3(0x149)]+_0x47f2d3(0x189)+_0x47f2d3(0x127)+_0x351b79[_0x5db6d6][_0x47f2d3(0x173)]+_0x47f2d3(0x189)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x351b79[_0x5db6d6]['standard_unit']+_0x47f2d3(0x189)+_0x47f2d3(0x127)+_0x351b79[_0x5db6d6][_0x47f2d3(0x188)]+_0x47f2d3(0x189)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x16376d[_0x47f2d3(0x107)]+_0x47f2d3(0x189)+_0x47f2d3(0x127)+_0x351b79[_0x5db6d6]['room_name']+_0x47f2d3(0x189)+_0x47f2d3(0x127)+_0x6ec9cd+_0x351b79[_0x5db6d6][_0x47f2d3(0xf4)]+_0x47f2d3(0x189),'</tr>';}let _0x1b5054=nodemailer['createTransport']({'host':_0x3f940e[_0x47f2d3(0xd2)],'port':Number(_0x3f940e[_0x47f2d3(0x10b)]),'secure':![],'auth':{'user':_0x3f940e['email'],'pass':_0x3f940e[_0x47f2d3(0x185)]}}),_0x53ee7d={'from':_0x3f940e[_0x47f2d3(0x141)],'to':_0x2e6224[0x0][_0x47f2d3(0x190)],'subject':_0x47f2d3(0x1c3),'attachments':[{'filename':_0x47f2d3(0xdb),'path':__dirname+_0x47f2d3(0xf9)+_0x47f2d3(0x175)+_0x154040[0x0][_0x47f2d3(0x1b6)],'cid':_0x47f2d3(0x124)}],'html':_0x47f2d3(0x196)+_0x47f2d3(0x168)+_0x47f2d3(0x10c)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x47f2d3(0xef)+_0x47f2d3(0x122)+'</div>'+_0x47f2d3(0xef)+'<h2>\x20'+_0x154040[0x0][_0x47f2d3(0x132)]+'\x20</h2>'+'</div>'+_0x47f2d3(0x17c)+'<hr\x20class=\x22my-3\x22>'+_0x47f2d3(0xef)+_0x47f2d3(0x1ab)+_0x47f2d3(0x174)+_0x16376d[_0x47f2d3(0xfe)]+'\x20'+_0x47f2d3(0x199)+'\x20Order\x20Date\x20:\x20'+_0x16376d[_0x47f2d3(0x197)]+'\x20'+_0x47f2d3(0xd3)+_0x47f2d3(0x104)+_0x47f2d3(0x17c)+_0x47f2d3(0x194)+_0x47f2d3(0xe9)+'<tr>'+_0x47f2d3(0x11e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x47f2d3(0x164)+_0x47f2d3(0x1b5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x47f2d3(0x1a7)+_0x47f2d3(0x117)+_0x47f2d3(0x165)+_0x47f2d3(0x1ba)+_0x47f2d3(0xfa)+'\x20'+_0x4d76a2+'\x20'+_0x47f2d3(0x118)+'</table>'+_0x47f2d3(0xef)+_0x47f2d3(0x147)+_0x47f2d3(0x1c2)+_0x154040[0x0]['site_title']+_0x47f2d3(0x104)+_0x47f2d3(0x17c)+_0x47f2d3(0x17c)+_0x47f2d3(0x12e)};_0x1b5054[_0x47f2d3(0x10f)](_0x53ee7d,function(_0x44c474,_0x36a3fc){var _0x443655=_0x47f2d3;_0x44c474?(console[_0x443655(0x105)](_0x44c474),console[_0x443655(0x105)](_0x443655(0x158))):console['log'](_0x443655(0x1c8));});}catch(_0x2f08ae){console['error'](_0x2f08ae),_0x131141[_0x47f2d3(0x142)](0x1f4)[_0x47f2d3(0x129)]({'error':_0x47f2d3(0x16e),'message':_0x2f08ae['message']});}})[_0xc31b9(0x167)](_0x1230a9=>{var _0x5a8dc3=_0xc31b9;console[_0x5a8dc3(0x119)](_0x1230a9);}),_0x4971df[_0xc31b9(0x1b1)](_0xc31b9(0xdd),_0xc31b9(0x17e)),_0x131141['redirect'](_0xc31b9(0x131));}catch(_0x5aa590){console[_0xc31b9(0x105)](_0x5aa590);}}),router[a0_0x13bedd(0x110)](a0_0x13bedd(0x178),auth,async(_0x380ed0,_0x6fcdb2)=>{var _0x245c3e=a0_0x13bedd;try{const {username:_0x35de6b,email:_0x163d42,role:_0x5d009e}=_0x380ed0['user'],_0x4d144d=_0x380ed0[_0x245c3e(0x1a9)],_0x18421c=await profile[_0x245c3e(0x15e)]({'email':_0x4d144d[_0x245c3e(0x141)]}),_0x49cf6e=await master_shop[_0x245c3e(0x1bc)](),_0xb98166=_0x380ed0[_0x245c3e(0x126)]['id'],_0x1ba750=await purchases_finished[_0x245c3e(0x15d)](_0xb98166),_0x24607f=await suppliers[_0x245c3e(0x1bc)]({});let _0x13c8b0;if(_0x4d144d[_0x245c3e(0x113)]=='staff'){const _0x305f5c=await staff[_0x245c3e(0x15e)]({'email':_0x4d144d[_0x245c3e(0x141)]});_0x13c8b0=await warehouse[_0x245c3e(0x1bc)]({'status':'Enabled','name':_0x305f5c['warehouse'],'warehouse_category':_0x245c3e(0x157)});}else _0x13c8b0=await warehouse['aggregate']([{'$match':{'status':_0x245c3e(0x148),'warehouse_category':_0x245c3e(0x157)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0xc57dad=await product['find']({}),_0x4c6c84=BayBinSelected(_0x1ba750[_0x245c3e(0x107)],_0x1ba750[_0x245c3e(0x1aa)]);let _0x4960e5=new Date(_0x1ba750['expiry_date']),_0x4a5119=('0'+_0x4960e5['getDate']())[_0x245c3e(0x16d)](-0x2),_0x3a4acb=('0'+(_0x4960e5[_0x245c3e(0xe2)]()+0x1))[_0x245c3e(0x16d)](-0x2),_0x9cb333=_0x4960e5[_0x245c3e(0x1d6)](),_0x4bda1d=_0x9cb333+'-'+_0x3a4acb+'-'+_0x4a5119;if(_0x49cf6e[0x0][_0x245c3e(0x154)]==_0x245c3e(0xe3)){var _0x3a701c=users[_0x245c3e(0x13b)];console[_0x245c3e(0x105)](_0x3a701c);}else{if(_0x49cf6e[0x0][_0x245c3e(0x154)]==_0x245c3e(0x176))var _0x3a701c=users[_0x245c3e(0x176)];else{if(_0x49cf6e[0x0][_0x245c3e(0x154)]=='German')var _0x3a701c=users[_0x245c3e(0xd8)];else{if(_0x49cf6e[0x0][_0x245c3e(0x154)]==_0x245c3e(0x106))var _0x3a701c=users['Spanish'];else{if(_0x49cf6e[0x0][_0x245c3e(0x154)]==_0x245c3e(0x1ca))var _0x3a701c=users['French'];else{if(_0x49cf6e[0x0][_0x245c3e(0x154)]==_0x245c3e(0xf7))var _0x3a701c=users[_0x245c3e(0x115)];else{if(_0x49cf6e[0x0][_0x245c3e(0x154)]==_0x245c3e(0x1b4))var _0x3a701c=users[_0x245c3e(0x1b4)];else{if(_0x49cf6e[0x0][_0x245c3e(0x154)]==_0x245c3e(0x179))var _0x3a701c=users[_0x245c3e(0x1d0)];}}}}}}}_0x6fcdb2[_0x245c3e(0x1ac)](_0x245c3e(0x12b),{'success':_0x380ed0[_0x245c3e(0x1b1)](_0x245c3e(0xdd)),'errors':_0x380ed0[_0x245c3e(0x1b1)](_0x245c3e(0x19c)),'role':_0x4d144d,'profile':_0x18421c,'purchases':_0x1ba750,'suppliers':_0x24607f,'warehouse':_0x13c8b0,'product':_0xc57dad,'master_shop':_0x49cf6e,'language':_0x3a701c,'ed_fullDate':_0x4bda1d,'dataSelected':_0x4c6c84});}catch(_0x3e8eff){console[_0x245c3e(0x105)](_0x3e8eff);}}),router[a0_0x13bedd(0x110)](a0_0x13bedd(0x181),auth,async(_0x407ce9,_0x23e626)=>{var _0x4b9118=a0_0x13bedd;try{const {username:_0x2125a2,email:_0x43729d,role:_0xf90cad}=_0x407ce9[_0x4b9118(0x1a9)],_0x6481f9=_0x407ce9[_0x4b9118(0x1a9)],_0x3817b1=await profile[_0x4b9118(0x15e)]({'email':_0x6481f9[_0x4b9118(0x141)]}),_0x296c9f=await master_shop[_0x4b9118(0x1bc)](),_0x4de7ff=_0x407ce9['params']['id'],_0x906973=await purchases_finished[_0x4b9118(0x15d)](_0x4de7ff),_0x481180=await suppliers[_0x4b9118(0x1bc)]({});let _0x32e950;if(_0x6481f9[_0x4b9118(0x113)]==_0x4b9118(0x177)){const _0x378698=await staff[_0x4b9118(0x15e)]({'email':_0x6481f9['email']});_0x32e950=await warehouse[_0x4b9118(0x1bc)]({'status':'Enabled','name':_0x378698[_0x4b9118(0x1a8)],'warehouse_category':_0x4b9118(0x157)});}else _0x32e950=await warehouse[_0x4b9118(0x153)]([{'$match':{'status':_0x4b9118(0x148),'warehouse_category':_0x4b9118(0x157)}},{'$group':{'_id':_0x4b9118(0x134),'name':{'$first':_0x4b9118(0x134)}}}]);const _0x91f42a=await product[_0x4b9118(0x1bc)]({}),_0x5a5b91=BayBinSelected(_0x906973[_0x4b9118(0x107)],_0x906973['room']);let _0x144b74=new Date(_0x906973['expiry_date']),_0x2dddc1=('0'+_0x144b74['getDate']())[_0x4b9118(0x16d)](-0x2),_0x5da7e5=('0'+(_0x144b74[_0x4b9118(0xe2)]()+0x1))['slice'](-0x2),_0x13e16b=_0x144b74[_0x4b9118(0x1d6)](),_0x43aa7e=_0x13e16b+'-'+_0x5da7e5+'-'+_0x2dddc1;if(_0x296c9f[0x0][_0x4b9118(0x154)]==_0x4b9118(0xe3)){var _0xa93368=users['English'];console['log'](_0xa93368);}else{if(_0x296c9f[0x0][_0x4b9118(0x154)]=='Hindi')var _0xa93368=users[_0x4b9118(0x176)];else{if(_0x296c9f[0x0][_0x4b9118(0x154)]==_0x4b9118(0xd8))var _0xa93368=users[_0x4b9118(0xd8)];else{if(_0x296c9f[0x0][_0x4b9118(0x154)]==_0x4b9118(0x106))var _0xa93368=users[_0x4b9118(0x106)];else{if(_0x296c9f[0x0][_0x4b9118(0x154)]==_0x4b9118(0x1ca))var _0xa93368=users[_0x4b9118(0x1ca)];else{if(_0x296c9f[0x0]['language']==_0x4b9118(0xf7))var _0xa93368=users[_0x4b9118(0x115)];else{if(_0x296c9f[0x0][_0x4b9118(0x154)]==_0x4b9118(0x1b4))var _0xa93368=users[_0x4b9118(0x1b4)];else{if(_0x296c9f[0x0]['language']==_0x4b9118(0x179))var _0xa93368=users[_0x4b9118(0x1d0)];}}}}}}}_0x23e626[_0x4b9118(0x1ac)]('edit_purchases_finished',{'success':_0x407ce9[_0x4b9118(0x1b1)](_0x4b9118(0xdd)),'errors':_0x407ce9[_0x4b9118(0x1b1)](_0x4b9118(0x19c)),'role':_0x6481f9,'profile':_0x3817b1,'purchases':_0x906973,'suppliers':_0x481180,'warehouse':_0x32e950,'product':_0x91f42a,'master_shop':_0x296c9f,'language':_0xa93368,'ed_fullDate':_0x43aa7e,'dataSelected':_0x5a5b91});}catch(_0x1a646b){console[_0x4b9118(0x105)](_0x1a646b);}}),router[a0_0x13bedd(0x1ad)](a0_0x13bedd(0x181),auth,async(_0x32ae44,_0x587e13)=>{var _0x32c6fd=a0_0x13bedd;try{const _0x3be3d8=_0x32ae44[_0x32c6fd(0x126)]['id'],_0x4f9e0e=await purchases_finished[_0x32c6fd(0x15e)]({'_id':_0x32ae44[_0x32c6fd(0x126)]['id']}),_0x21ebf7=await warehouse['findOne']({'name':_0x4f9e0e[_0x32c6fd(0x107)],'room':_0x4f9e0e[_0x32c6fd(0x1aa)]});_0x4f9e0e['product'][_0x32c6fd(0x1c0)](_0x24ba1c=>{var _0x50bb8d=_0x32c6fd;const _0x23f155=_0x21ebf7['product_details'][_0x50bb8d(0x16b)](_0x15ec13=>{var _0x556bce=_0x50bb8d;_0x15ec13[_0x556bce(0x145)]==_0x24ba1c['product_name']&&_0x15ec13[_0x556bce(0xf4)]==_0x24ba1c['bay']&&(_0x15ec13[_0x556bce(0x180)]=parseInt(_0x15ec13[_0x556bce(0x180)])-parseInt(_0x24ba1c[_0x556bce(0x173)]));});}),await _0x21ebf7[_0x32c6fd(0x1a5)]();const {invoice:_0x24192f,suppliers:_0x293c74,date:_0x43a8d2,warehouse_name:_0x31373c,prod_name:_0x43387c,prod_code:_0x4c06e1,prod_qty:_0x282b13,prod_unit:_0x2f9642,prod_secondunit:_0x2eaecd,prod_level:_0x21844f,prod_isle:_0x40c9f5,prod_pallet:_0x515567,note:_0x10c9f7,expiry_date:_0x33ef8b,batch_code:_0x2ae544,paid_amount:_0x269579,due_amount:_0x565b4b,Room_name:_0x1da789,primary_code:_0x39ce00,secondary_code:_0xc52405,PO_number:_0x217812,JO_number:_0x142f2c}=_0x32ae44[_0x32c6fd(0x121)];if(typeof _0x43387c==_0x32c6fd(0x12c))var _0x458349=[_0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0x12a)]],_0x435714=[_0x32ae44['body'][_0x32c6fd(0x150)]],_0xe6f46f=[_0x32ae44[_0x32c6fd(0x121)]['prod_qty']],_0x5d3861=[_0x32ae44['body']['prod_unit']],_0x4d59b8=[_0x32ae44[_0x32c6fd(0x121)]['prod_secondunit']],_0x1b2c57=[_0x32ae44[_0x32c6fd(0x121)]['prod_level']],_0x403c95=[_0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0x1d3)]],_0x266865=[_0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0x1a3)]],_0x5b41f8=[_0x32ae44['body'][_0x32c6fd(0x108)]],_0x55b1f6=[_0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0x13a)]],_0x3f0628=[_0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0xec)]];else var _0x458349=[..._0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0x12a)]],_0x435714=[..._0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0x150)]],_0xe6f46f=[..._0x32ae44['body'][_0x32c6fd(0x1a1)]],_0x5d3861=[..._0x32ae44['body'][_0x32c6fd(0x143)]],_0x4d59b8=[..._0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0x155)]],_0x1b2c57=[..._0x32ae44['body'][_0x32c6fd(0x17d)]],_0x403c95=[..._0x32ae44[_0x32c6fd(0x121)]['primary_code']],_0x266865=[..._0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0x1a3)]],_0x5b41f8=[..._0x32ae44['body'][_0x32c6fd(0x108)]],_0x55b1f6=[..._0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0x13a)]],_0x3f0628=[..._0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0xec)]];const _0x1a1102=_0x458349[_0x32c6fd(0x16b)](_0x34aaaf=>{return _0x34aaaf={'product_name':_0x34aaaf};});_0x435714[_0x32c6fd(0x1c0)]((_0x605e1e,_0x51d47b)=>{var _0x2eac85=_0x32c6fd;_0x1a1102[_0x51d47b][_0x2eac85(0x149)]=_0x605e1e;}),_0xe6f46f['forEach']((_0x3102dc,_0x237c4f)=>{var _0x4ba198=_0x32c6fd;_0x1a1102[_0x237c4f][_0x4ba198(0x173)]=_0x3102dc;}),_0x5d3861[_0x32c6fd(0x1c0)]((_0x4e82a7,_0xc60a8d)=>{var _0x1df7da=_0x32c6fd;_0x1a1102[_0xc60a8d][_0x1df7da(0x1c4)]=_0x4e82a7;}),_0x4d59b8[_0x32c6fd(0x1c0)]((_0x54edf5,_0x301f0c)=>{var _0x1d9ca1=_0x32c6fd;_0x1a1102[_0x301f0c][_0x1d9ca1(0x188)]=_0x54edf5;}),_0x1b2c57[_0x32c6fd(0x1c0)]((_0x2fcd2c,_0x4ba586)=>{var _0x425972=_0x32c6fd;_0x1a1102[_0x4ba586][_0x425972(0xf4)]=_0x2fcd2c;}),_0x403c95['forEach']((_0xdde186,_0x8ebf30)=>{var _0x574e10=_0x32c6fd;_0x1a1102[_0x8ebf30][_0x574e10(0x1d3)]=_0xdde186;}),_0x266865['forEach']((_0x256730,_0x13719b)=>{var _0xf0666b=_0x32c6fd;_0x1a1102[_0x13719b][_0xf0666b(0x1a3)]=_0x256730;}),_0x5b41f8[_0x32c6fd(0x1c0)]((_0x20952b,_0x30528b)=>{var _0x4addf6=_0x32c6fd;_0x1a1102[_0x30528b][_0x4addf6(0x19d)]=_0x20952b;}),_0x55b1f6[_0x32c6fd(0x1c0)]((_0x45a951,_0x477ee5)=>{var _0x3de451=_0x32c6fd;_0x1a1102[_0x477ee5][_0x3de451(0x13a)]=_0x45a951;}),_0x3f0628[_0x32c6fd(0x1c0)]((_0x40baad,_0x33f93c)=>{var _0x375c3d=_0x32c6fd;_0x1a1102[_0x33f93c][_0x375c3d(0xec)]=_0x40baad;});const _0x424c80=_0x1a1102[_0x32c6fd(0x1d5)](_0xbb94a=>_0xbb94a[_0x32c6fd(0x173)]!=='0'&&_0xbb94a[_0x32c6fd(0x173)]!=='');_0x4f9e0e[_0x32c6fd(0xfe)]=_0x24192f,_0x4f9e0e[_0x32c6fd(0xe0)]=_0x293c74,_0x4f9e0e[_0x32c6fd(0x197)]=_0x43a8d2,_0x4f9e0e[_0x32c6fd(0x107)]=_0x31373c,_0x4f9e0e[_0x32c6fd(0x10a)]=_0x424c80,_0x4f9e0e[_0x32c6fd(0x18a)]=_0x10c9f7,_0x4f9e0e[_0x32c6fd(0x1cb)]=_0x269579,_0x4f9e0e[_0x32c6fd(0x1a0)]=_0x565b4b,_0x4f9e0e[_0x32c6fd(0x1aa)]=_0x1da789,_0x4f9e0e[_0x32c6fd(0x1af)]=_0x217812,_0x4f9e0e[_0x32c6fd(0x166)]=_0x142f2c;const _0x204e47=await _0x4f9e0e[_0x32c6fd(0x1a5)](),_0x16ebc8=await warehouse[_0x32c6fd(0x15e)]({'name':_0x32ae44['body']['warehouse_name'],'room':_0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0x139)]});_0x4f9e0e[_0x32c6fd(0x10a)][_0x32c6fd(0x1c0)](_0x31ef94=>{var _0x42282e=_0x32c6fd,_0x176c43=0x0;const _0x3706c1=_0x16ebc8[_0x42282e(0xf5)]['map'](_0x5ed7a8=>{var _0x53f2c7=_0x42282e;_0x5ed7a8[_0x53f2c7(0x145)]==_0x31ef94['product_name']&&_0x5ed7a8[_0x53f2c7(0xf4)]==_0x31ef94[_0x53f2c7(0xf4)]&&(_0x5ed7a8[_0x53f2c7(0x180)]=parseInt(_0x5ed7a8['product_stock'])+parseInt(_0x31ef94['quantity']),_0x176c43++);});_0x176c43=='0'&&(_0x16ebc8[_0x42282e(0xf5)]=_0x16ebc8[_0x42282e(0xf5)][_0x42282e(0xed)]({'product_name':_0x31ef94[_0x42282e(0x145)],'product_stock':_0x31ef94[_0x42282e(0x173)],'primary_code':_0x31ef94['primary_code'],'secondary_code':_0x31ef94[_0x42282e(0x1a3)],'product_code':_0x31ef94[_0x42282e(0x149)],'bay':_0x31ef94['bay'],'maxProducts':_0x31ef94[_0x42282e(0x19d)],'unit':_0x31ef94[_0x42282e(0x1c4)],'secondary_unit':_0x31ef94[_0x42282e(0x188)],'expiry_date':_0x31ef94['expiry_date']}));}),await _0x16ebc8['save']();const _0x4e5ad1=await s_payment_data['findOne']({'invoice':_0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0xfe)]});if(_0x4e5ad1===null){}else console['log'](_0x32c6fd(0xe0),_0x4e5ad1,_0x32ae44[_0x32c6fd(0x121)][_0x32c6fd(0xfe)]),_0x4e5ad1[_0x32c6fd(0xe0)]=_0x32ae44[_0x32c6fd(0x121)]['suppliers'],await _0x4e5ad1[_0x32c6fd(0x1a5)]();_0x32ae44[_0x32c6fd(0x1b1)](_0x32c6fd(0xdd),_0x32c6fd(0x1ae)),_0x587e13[_0x32c6fd(0x11b)](_0x32c6fd(0x131));}catch(_0x1228ff){console[_0x32c6fd(0x105)](_0x1228ff);}}),router[a0_0x13bedd(0x1ad)](a0_0x13bedd(0xf3),auth,async(_0x295b1e,_0x51350c)=>{var _0x4e249c=a0_0x13bedd;try{const _0x35d114=_0x295b1e[_0x4e249c(0x126)]['id'],{invoice:_0x276a19,suppliers:_0x3f5c22,payable:_0x427404,due_amount:_0x3f3e77}=_0x295b1e[_0x4e249c(0x121)],_0x28842e=await purchases[_0x4e249c(0x15d)](_0x35d114);var _0x29d8c9=_0x427404-_0x3f3e77;_0x28842e['paid_amount']=parseFloat(_0x28842e[_0x4e249c(0x1cb)])+parseFloat(_0x3f3e77),_0x28842e[_0x4e249c(0x1a0)]=_0x29d8c9;const _0x38b420=await _0x28842e[_0x4e249c(0x1a5)]();console['log'](_0x38b420);const _0x3665a9=await s_payment_data['findOne']({'invoice':_0x276a19});_0x3665a9['amount']=_0x29d8c9,await _0x3665a9[_0x4e249c(0x1a5)]();let _0x515472=new Date(),_0x1ed39f=('0'+_0x515472[_0x4e249c(0x192)]())[_0x4e249c(0x16d)](-0x2),_0x504e73=('0'+(_0x515472[_0x4e249c(0xe2)]()+0x1))['slice'](-0x2),_0x137092=_0x515472['getFullYear'](),_0x22a4d0=_0x137092+'-'+_0x504e73+'-'+_0x1ed39f;const _0x43c5dd=new suppliers_payment({'invoice':_0x276a19,'date':_0x137092+'-'+_0x504e73+'-'+_0x1ed39f,'suppliers':_0x3f5c22,'reason':'Paid\x20For\x20Purchase','amount':_0x3f3e77}),_0x49cd0c=await _0x43c5dd[_0x4e249c(0x1a5)]();_0x295b1e['flash'](_0x4e249c(0xdd),_0x4e249c(0x135)),_0x51350c['redirect'](_0x4e249c(0x1c5));}catch(_0x33a953){console['log'](_0x33a953);}}),router[a0_0x13bedd(0x110)]('/invoice/:id',auth,async(_0x1e968b,_0x261dca)=>{var _0x3276a=a0_0x13bedd;try{const {username:_0x136ec9,email:_0x19fba3,role:_0x3e3ecb}=_0x1e968b[_0x3276a(0x1a9)],_0xb461fd=_0x1e968b[_0x3276a(0x1a9)],_0x4e63a1=await profile['findOne']({'email':_0xb461fd['email']}),_0x17a719=await master_shop[_0x3276a(0x1bc)]();console['log']('master',_0x17a719);const _0x19737e=_0x1e968b[_0x3276a(0x126)]['id'],_0x24b5b5=await purchases[_0x3276a(0x15d)](_0x19737e);console[_0x3276a(0x105)](_0x24b5b5);const _0x42d5ce=await suppliers[_0x3276a(0x15e)]({'name':_0x24b5b5[_0x3276a(0xe0)]});console[_0x3276a(0x105)](_0x42d5ce);if(_0x17a719[0x0][_0x3276a(0x154)]==_0x3276a(0xe3)){var _0x2af8ad=users[_0x3276a(0x13b)];console[_0x3276a(0x105)](_0x2af8ad);}else{if(_0x17a719[0x0][_0x3276a(0x154)]==_0x3276a(0x176))var _0x2af8ad=users[_0x3276a(0x176)];else{if(_0x17a719[0x0]['language']=='German')var _0x2af8ad=users[_0x3276a(0xd8)];else{if(_0x17a719[0x0][_0x3276a(0x154)]=='Spanish')var _0x2af8ad=users[_0x3276a(0x106)];else{if(_0x17a719[0x0]['language']==_0x3276a(0x1ca))var _0x2af8ad=users['French'];else{if(_0x17a719[0x0][_0x3276a(0x154)]==_0x3276a(0xf7))var _0x2af8ad=users[_0x3276a(0x115)];else{if(_0x17a719[0x0][_0x3276a(0x154)]==_0x3276a(0x1b4))var _0x2af8ad=users['Chinese'];else{if(_0x17a719[0x0]['language']==_0x3276a(0x179))var _0x2af8ad=users[_0x3276a(0x1d0)];}}}}}}}_0x261dca['render'](_0x3276a(0x16f),{'success':_0x1e968b[_0x3276a(0x1b1)]('success'),'errors':_0x1e968b['flash'](_0x3276a(0x19c)),'role':_0xb461fd,'profile':_0x4e63a1,'master_shop':_0x17a719,'supplier':_0x42d5ce,'purchase':_0x24b5b5,'language':_0x2af8ad});}catch(_0x1c66d5){console[_0x3276a(0x105)](_0x1c66d5);}}),router['get'](a0_0x13bedd(0x14c),auth,async(_0x5acb48,_0x512dc0)=>{var _0x423c80=a0_0x13bedd;try{const {username:_0x28be84,email:_0xf5bf32,role:_0x254281}=_0x5acb48['user'],_0x32cd00=_0x5acb48[_0x423c80(0x1a9)],_0x5f957c=await profile[_0x423c80(0x15e)]({'email':_0x32cd00[_0x423c80(0x141)]}),_0x21efca=await master_shop[_0x423c80(0x1bc)]();console[_0x423c80(0x105)](_0x423c80(0x1bb),_0x21efca);const _0x528982=_0x5acb48[_0x423c80(0x126)]['id'];console[_0x423c80(0x105)](_0x528982);const _0x5cef7b=await purchases_finished[_0x423c80(0x15d)](_0x528982);console[_0x423c80(0x105)]('user_id',_0x5cef7b);const _0x46bd08=await product[_0x423c80(0x1bc)]({}),_0x2e7df6=await warehouse[_0x423c80(0x153)]([{'$match':{'name':_0x5cef7b[_0x423c80(0x107)],'room':_0x5cef7b[_0x423c80(0x1aa)]}},{'$unwind':_0x423c80(0xe6)},{'$group':{'_id':_0x423c80(0x111),'name':{'$first':_0x423c80(0x1d1)},'product_stock':{'$first':_0x423c80(0x136)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x423c80(0x183)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x423c80(0x1c6)},'primary_code':{'$first':_0x423c80(0xff)},'secondary_code':{'$first':_0x423c80(0x184)},'product_code':{'$first':_0x423c80(0x1cd)},'storage':{'$first':_0x423c80(0x16a)},'rack':{'$first':_0x423c80(0x18f)}}}]);console[_0x423c80(0x105)](_0x423c80(0x1b9),_0x2e7df6);let _0x4d996e;if(_0x32cd00[_0x423c80(0x113)]==_0x423c80(0x177)){const _0x450bb3=await staff['findOne']({'email':_0x32cd00[_0x423c80(0x141)]});_0x4d996e=await warehouse[_0x423c80(0x1bc)]({'status':_0x423c80(0x148),'name':_0x450bb3['warehouse'],'warehouse_category':_0x423c80(0x157),'name':'Return\x20Goods'});}else _0x4d996e=await warehouse['aggregate']([{'$match':{'status':_0x423c80(0x148),'warehouse_category':_0x423c80(0x157),'name':_0x423c80(0x1b3)}},{'$group':{'_id':_0x423c80(0x134),'name':{'$first':_0x423c80(0x134)}}}]);if(_0x21efca[0x0]['language']==_0x423c80(0xe3)){var _0x53af2b=users[_0x423c80(0x13b)];console[_0x423c80(0x105)](_0x53af2b);}else{if(_0x21efca[0x0][_0x423c80(0x154)]=='Hindi')var _0x53af2b=users[_0x423c80(0x176)];else{if(_0x21efca[0x0]['language']==_0x423c80(0xd8))var _0x53af2b=users[_0x423c80(0xd8)];else{if(_0x21efca[0x0][_0x423c80(0x154)]==_0x423c80(0x106))var _0x53af2b=users[_0x423c80(0x106)];else{if(_0x21efca[0x0][_0x423c80(0x154)]==_0x423c80(0x1ca))var _0x53af2b=users['French'];else{if(_0x21efca[0x0][_0x423c80(0x154)]==_0x423c80(0xf7))var _0x53af2b=users['Portuguese'];else{if(_0x21efca[0x0][_0x423c80(0x154)]==_0x423c80(0x1b4))var _0x53af2b=users[_0x423c80(0x1b4)];else{if(_0x21efca[0x0][_0x423c80(0x154)]==_0x423c80(0x179))var _0x53af2b=users[_0x423c80(0x1d0)];}}}}}}}_0x512dc0[_0x423c80(0x1ac)](_0x423c80(0x186),{'success':_0x5acb48['flash'](_0x423c80(0xdd)),'errors':_0x5acb48[_0x423c80(0x1b1)](_0x423c80(0x19c)),'role':_0x32cd00,'profile':_0x5f957c,'user':_0x5cef7b,'stock':_0x2e7df6,'master_shop':_0x21efca,'product':_0x46bd08,'language':_0x53af2b,'warehouse':_0x4d996e});}catch(_0x19aaa3){console[_0x423c80(0x105)](_0x19aaa3);}}),router['post'](a0_0x13bedd(0x14c),auth,async(_0x33f5cb,_0x2d55bb)=>{var _0x125578=a0_0x13bedd;try{const {invoice:_0x260097,date:_0x268292,warehouse_name:_0x6f99ba,Room_name:_0x7de235,product_name:_0x2e325d,purchase_quantity:_0x262adc,stocks:_0x8eb1d6,return_qty:_0x3a11af,note:_0x595c68,level:_0x86d2cf,isle:_0xaa7dbb,pallet:_0x592c30,to_warehouse_name:_0x38e71b,to_Room_name:_0x210d44}=_0x33f5cb[_0x125578(0x121)],_0x103b82=await purchases_finished[_0x125578(0x15e)]({'_id':_0x33f5cb[_0x125578(0x126)]['id']}),_0x38866c=await warehouse[_0x125578(0x15e)]({'name':_0x6f99ba,'room':_0x7de235,'warehouse_category':'Finished\x20Goods'});if(typeof _0x2e325d==_0x125578(0x12c))var _0x12aa77=[_0x33f5cb[_0x125578(0x121)][_0x125578(0x145)]],_0x47f835=[_0x33f5cb[_0x125578(0x121)]['purchase_quantity']],_0x1c72ef=[_0x33f5cb['body'][_0x125578(0xda)]],_0x224d2d=[_0x33f5cb['body'][_0x125578(0x14e)]],_0x5c17b9=[_0x33f5cb['body'][_0x125578(0xfd)]],_0x35b240=[_0x33f5cb[_0x125578(0x121)]['product_code_hide']],_0x21ac16=[_0x33f5cb[_0x125578(0x121)][_0x125578(0x12d)]],_0x49c598=[_0x33f5cb[_0x125578(0x121)][_0x125578(0x15c)]];else var _0x12aa77=[..._0x33f5cb[_0x125578(0x121)][_0x125578(0x145)]],_0x47f835=[..._0x33f5cb[_0x125578(0x121)][_0x125578(0x171)]],_0x1c72ef=[..._0x33f5cb['body'][_0x125578(0xda)]],_0x224d2d=[..._0x33f5cb[_0x125578(0x121)][_0x125578(0x14e)]],_0x5c17b9=[..._0x33f5cb[_0x125578(0x121)]['level']],_0x35b240=[..._0x33f5cb[_0x125578(0x121)][_0x125578(0x18d)]],_0x21ac16=[..._0x33f5cb[_0x125578(0x121)][_0x125578(0x12d)]],_0x49c598=[..._0x33f5cb[_0x125578(0x121)]['secondary_code_hide']];const _0x11108f=_0x12aa77['map'](_0x374475=>{return _0x374475={'product_name':_0x374475};});_0x47f835[_0x125578(0x1c0)]((_0x2d86c0,_0xd581ab)=>{var _0x2fad1c=_0x125578;_0x11108f[_0xd581ab][_0x2fad1c(0x171)]=_0x2d86c0;}),_0x1c72ef[_0x125578(0x1c0)]((_0x412ba7,_0x2cbc87)=>{var _0x39b684=_0x125578;_0x11108f[_0x2cbc87][_0x39b684(0x101)]=_0x412ba7;}),_0x224d2d[_0x125578(0x1c0)]((_0x1726b3,_0x4789e1)=>{var _0x41beae=_0x125578;_0x11108f[_0x4789e1][_0x41beae(0x14e)]=_0x1726b3;}),_0x5c17b9['forEach']((_0x3c8667,_0x344b90)=>{_0x11108f[_0x344b90]['bay']=_0x3c8667;}),_0x35b240[_0x125578(0x1c0)]((_0x1d251c,_0x6f8d5c)=>{var _0x3d5a48=_0x125578;_0x11108f[_0x6f8d5c][_0x3d5a48(0x149)]=_0x1d251c;}),_0x21ac16[_0x125578(0x1c0)]((_0x2945ac,_0xf92f90)=>{_0x11108f[_0xf92f90]['primary_code']=_0x2945ac;}),_0x49c598[_0x125578(0x1c0)]((_0x159edf,_0x3dbe6e)=>{_0x11108f[_0x3dbe6e]['secondary_code']=_0x159edf;}),_0x11108f[_0x125578(0x1c0)](_0x4fbc79=>{var _0x352618=_0x125578;console[_0x352618(0x105)](_0x4fbc79);const _0x4b9957=_0x38866c[_0x352618(0xf5)][_0x352618(0x16b)](_0x56938a=>{var _0x570725=_0x352618;_0x56938a[_0x570725(0x145)]==_0x4fbc79[_0x570725(0x145)]&&_0x56938a[_0x570725(0xf4)]==_0x4fbc79[_0x570725(0xf4)]&&(console[_0x570725(0x105)](parseInt(_0x56938a['product_stock'])+'\x20<>\x20'+parseInt(_0x4fbc79['return_qty'])),_0x56938a['product_stock']=parseInt(_0x56938a['product_stock'])-parseInt(_0x4fbc79['return_qty']));});}),await _0x38866c[_0x125578(0x1a5)]();var _0x357cc8=0x0;_0x11108f[_0x125578(0x1c0)](_0x5c7b99=>{var _0x5725a6=_0x125578;(parseInt(_0x5c7b99[_0x5725a6(0x171)])<parseInt(_0x5c7b99[_0x5725a6(0x14e)])||parseInt(_0x5c7b99[_0x5725a6(0x101)])<parseInt(_0x5c7b99[_0x5725a6(0x14e)]))&&_0x357cc8++;});if(_0x357cc8!=0x0)return _0x33f5cb[_0x125578(0x1b1)](_0x125578(0x19c),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x2d55bb['redirect'](_0x125578(0x13e));const _0x2edcc7=new purchases_return_finished({'invoice':_0x260097,'suppliers':_0x33f5cb[_0x125578(0x121)][_0x125578(0xe0)],'date':_0x268292,'warehouse_name':_0x6f99ba,'return_product':_0x11108f,'note':_0x595c68,'room':_0x7de235,'to_warehouse_name':_0x38e71b,'to_room':_0x210d44}),_0x354ced=await _0x2edcc7['save'](),_0x146e12=await purchases_return_finished['findOne']({'invoice':_0x260097}),_0x22c141=await warehouse['findOne']({'name':_0x38e71b,'room':_0x210d44,'warehouse_category':_0x125578(0x157)});_0x146e12['return_product'][_0x125578(0x1c0)](_0x1c8c9b=>{var _0x2641df=_0x125578,_0x4c0ffe=0x0;const _0x4484cb=_0x22c141[_0x2641df(0xf5)][_0x2641df(0x16b)](_0x47e040=>{var _0x1084e6=_0x2641df;console[_0x1084e6(0x105)](_0x47e040[_0x1084e6(0x145)]+'=='+_0x1c8c9b[_0x1084e6(0x145)]+'&&'+_0x47e040[_0x1084e6(0xf4)]+'=='+_0x1c8c9b['bay']),_0x47e040[_0x1084e6(0x145)]==_0x1c8c9b[_0x1084e6(0x145)]&&_0x47e040['bay']==_0x1c8c9b[_0x1084e6(0xf4)]&&(_0x47e040['product_stock']=parseInt(_0x47e040[_0x1084e6(0x180)])-parseInt(_0x1c8c9b[_0x1084e6(0x14e)]),_0x4c0ffe++);});_0x4c0ffe=='0'&&(_0x22c141[_0x2641df(0xf5)]=_0x22c141['product_details'][_0x2641df(0xed)]({'product_name':_0x1c8c9b['product_name'],'product_stock':_0x1c8c9b[_0x2641df(0x14e)],'primary_code':_0x1c8c9b[_0x2641df(0x1d3)],'secondary_code':_0x1c8c9b[_0x2641df(0x1a3)],'product_code':_0x1c8c9b[_0x2641df(0x149)],'bay':_0x1c8c9b[_0x2641df(0xf4)],'maxProducts':0xf423f}));}),await _0x22c141[_0x125578(0x1a5)]();const _0x5238ee=await purchases_finished[_0x125578(0x15e)]({'invoice':_0x260097});_0x5238ee['return_data']=_0x125578(0x128);const _0x5dd091=await _0x5238ee[_0x125578(0x1a5)](),_0x57a854=new s_payment_data({'invoice':_0x260097,'suppliers':_0x33f5cb[_0x125578(0x121)][_0x125578(0xe0)],'reason':_0x125578(0x193)});await _0x57a854[_0x125578(0x1a5)]();const _0x3211e9=await master_shop['find'](),_0x651833=await email_settings[_0x125578(0x15e)](),_0x49662b=await suppliers[_0x125578(0x15e)]({'name':_0x33f5cb[_0x125578(0x121)]['suppliers']});_0x3211e9[0x0][_0x125578(0x140)]==0x1?(right_currency=_0x3211e9[0x0][_0x125578(0xde)],left_currency=''):(right_currency='',left_currency=_0x3211e9[0x0][_0x125578(0xde)]);var _0xf6dfb1=_0x12aa77,_0x4dddf6=_0x224d2d,_0x3579a2='',_0x3046e9;for(_0x3046e9 in _0xf6dfb1){_0x3579a2+=_0x125578(0xf2)+_0x125578(0x127)+_0xf6dfb1[_0x3046e9]+_0x125578(0x189)+_0x125578(0x127)+_0x4dddf6[_0x3046e9]+_0x125578(0x189)+'</tr>';}let _0x532cbb=nodemailer[_0x125578(0x195)]({'service':_0x125578(0xfb),'auth':{'user':_0x651833[_0x125578(0x141)],'pass':_0x651833[_0x125578(0x185)]}}),_0x164df1={'from':_0x651833['email'],'to':_0x49662b[_0x125578(0x141)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x125578(0xf9)+_0x125578(0x175)+_0x3211e9[0x0][_0x125578(0x1b6)],'cid':_0x125578(0x124)}],'html':_0x125578(0x196)+_0x125578(0x168)+'</head><body>'+_0x125578(0xef)+_0x125578(0x10d)+_0x125578(0xef)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x125578(0xef)+'<h2>\x20'+_0x3211e9[0x0][_0x125578(0x132)]+'\x20</h2>'+'</div>'+'</div>'+_0x125578(0x170)+_0x125578(0xef)+_0x125578(0x1ab)+_0x125578(0x174)+_0x260097+'\x20'+_0x125578(0x199)+_0x125578(0x191)+_0x268292+'\x20'+_0x125578(0xd3)+_0x125578(0x104)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x125578(0xf2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x125578(0xd6)+_0x125578(0x10e)+_0x125578(0x102)+_0x125578(0x165)+_0x125578(0x1ba)+_0x125578(0xfa)+'\x20'+_0x3579a2+'\x20'+'</tbody>'+_0x125578(0x133)+'<div>'+_0x125578(0x147)+'<h5>'+_0x3211e9[0x0]['site_title']+_0x125578(0x104)+_0x125578(0x17c)+_0x125578(0x17c)+_0x125578(0x12e)};_0x532cbb['sendMail'](_0x164df1,function(_0x5a4b15,_0xc6c8b2){var _0x5316a2=_0x125578;_0x5a4b15?console['log'](_0x5316a2(0x158)):console['log'](_0x5316a2(0x1c8));}),_0x33f5cb['flash'](_0x125578(0xdd),_0x125578(0xd5)),_0x2d55bb[_0x125578(0x11b)]('/all_purchases_finished/view');}catch(_0x3780b2){_0x2d55bb[_0x125578(0x142)](0xc8)[_0x125578(0x129)]({'message':_0x3780b2['message']});}}),router[a0_0x13bedd(0x110)](a0_0x13bedd(0x1ce),auth,async(_0x41c425,_0x8eb54c)=>{var _0x2f9c01=a0_0x13bedd;try{const {username:_0x482616,email:_0x13e17a,role:_0x2f8d79}=_0x41c425[_0x2f9c01(0x1a9)],_0x95b242=_0x41c425[_0x2f9c01(0x1a9)],_0x53b42f=await profile[_0x2f9c01(0x15e)]({'email':_0x95b242['email']}),_0x2dfea0=await master_shop[_0x2f9c01(0x1bc)](),_0x32cc23=_0x41c425[_0x2f9c01(0x126)]['id'],_0x1bab1f=await purchases_finished['findById'](_0x32cc23);if(_0x2dfea0[0x0][_0x2f9c01(0x154)]==_0x2f9c01(0xe3))var _0x4292cc=users['English'];else{if(_0x2dfea0[0x0][_0x2f9c01(0x154)]==_0x2f9c01(0x176))var _0x4292cc=users[_0x2f9c01(0x176)];else{if(_0x2dfea0[0x0]['language']==_0x2f9c01(0xd8))var _0x4292cc=users[_0x2f9c01(0xd8)];else{if(_0x2dfea0[0x0]['language']==_0x2f9c01(0x106))var _0x4292cc=users[_0x2f9c01(0x106)];else{if(_0x2dfea0[0x0][_0x2f9c01(0x154)]=='French')var _0x4292cc=users['French'];else{if(_0x2dfea0[0x0][_0x2f9c01(0x154)]==_0x2f9c01(0xf7))var _0x4292cc=users[_0x2f9c01(0x115)];else{if(_0x2dfea0[0x0][_0x2f9c01(0x154)]==_0x2f9c01(0x1b4))var _0x4292cc=users[_0x2f9c01(0x1b4)];else{if(_0x2dfea0[0x0][_0x2f9c01(0x154)]==_0x2f9c01(0x179))var _0x4292cc=users['Arabic'];}}}}}}}_0x8eb54c[_0x2f9c01(0x1ac)](_0x2f9c01(0x1bf),{'success':_0x41c425[_0x2f9c01(0x1b1)](_0x2f9c01(0xdd)),'errors':_0x41c425[_0x2f9c01(0x1b1)](_0x2f9c01(0x19c)),'role':_0x95b242,'profile':_0x53b42f,'alldata':_0x1bab1f,'master_shop':_0x2dfea0,'language':_0x4292cc}),console['log'](alldata);}catch(_0x9b0086){console[_0x2f9c01(0x105)](_0x9b0086);}}),router[a0_0x13bedd(0x1ad)]('/barcode_scanner',async(_0x12b9ce,_0x4451c5)=>{var _0x38f8ab=a0_0x13bedd;const {product_code:_0x1f7a31}=_0x12b9ce[_0x38f8ab(0x121)];var _0xcb2a7b;const _0x48636c=await product[_0x38f8ab(0x153)]([{'$match':{'primary_code':_0x1f7a31,'product_category':_0x38f8ab(0x157)}},{'$group':{'_id':_0x38f8ab(0x11d),'name':{'$first':_0x38f8ab(0x134)},'category':{'$first':'$category'},'brand':{'$first':_0x38f8ab(0x1b2)},'unit':{'$first':_0x38f8ab(0xfc)},'alertquantity':{'$first':_0x38f8ab(0xd7)},'product_code':{'$first':_0x38f8ab(0x12f)},'primary_code':{'$first':_0x38f8ab(0x19f)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x38f8ab(0x169)},'maxProdPerUnit':{'$first':_0x38f8ab(0x112)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x38f8ab(0x1b0)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x8b8fab=await product[_0x38f8ab(0x153)]([{'$match':{'secondary_code':_0x1f7a31}},{'$group':{'_id':_0x38f8ab(0x11d),'name':{'$first':'$name'},'category':{'$first':_0x38f8ab(0x14f)},'brand':{'$first':_0x38f8ab(0x1b2)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x38f8ab(0xd7)},'product_code':{'$first':_0x38f8ab(0x12f)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x38f8ab(0x1c1)},'maxStocks':{'$first':_0x38f8ab(0x169)},'maxProdPerUnit':{'$first':_0x38f8ab(0x112)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x48636c[_0x38f8ab(0x187)]>0x0)_0xcb2a7b=_0x48636c;else _0x8b8fab[_0x38f8ab(0x187)]>0x0&&(_0xcb2a7b=_0x8b8fab);_0x4451c5['json'](_0xcb2a7b);}),router[a0_0x13bedd(0x1ad)]('/CheckingWarehouse',async(_0x7ffbdc,_0x44c83d)=>{var _0x3560f4=a0_0x13bedd;const {productCode:_0x393a3d,bay:_0x5076f1,warehouses:_0x737477,room:_0x9c49fc}=_0x7ffbdc[_0x3560f4(0x121)];console['log'](_0x7ffbdc[_0x3560f4(0x121)]);try{const _0x1bd239=await warehouse['aggregate']([{'$match':{'name':_0x737477,'room':_0x9c49fc}},{'$unwind':_0x3560f4(0xe6)},{'$match':{'product_details.bay':parseInt(_0x5076f1)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3560f4(0x1d1)},'product_stock':{'$first':_0x3560f4(0x136)},'bay':{'$first':_0x3560f4(0x19e)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x44c83d['status'](0xc8)['json'](_0x1bd239);}catch(_0x5c7376){_0x44c83d[_0x3560f4(0x142)](0x194)['json']({'message':_0x5c7376[_0x3560f4(0x144)]});}}),module[a0_0x13bedd(0x172)]=router;