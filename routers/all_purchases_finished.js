var a0_0x27a03e=a0_0x4f13;(function(_0x1d80ff,_0x51b91d){var _0x158bb2=a0_0x4f13,_0x53c14a=_0x1d80ff();while(!![]){try{var _0x44c2ad=-parseInt(_0x158bb2(0x19d))/0x1+-parseInt(_0x158bb2(0x140))/0x2*(-parseInt(_0x158bb2(0x1de))/0x3)+parseInt(_0x158bb2(0x1e7))/0x4+-parseInt(_0x158bb2(0x20b))/0x5*(parseInt(_0x158bb2(0x17e))/0x6)+-parseInt(_0x158bb2(0x13b))/0x7+parseInt(_0x158bb2(0x111))/0x8+-parseInt(_0x158bb2(0x1fb))/0x9*(parseInt(_0x158bb2(0x112))/0xa);if(_0x44c2ad===_0x51b91d)break;else _0x53c14a['push'](_0x53c14a['shift']());}catch(_0x38fad3){_0x53c14a['push'](_0x53c14a['shift']());}}}(a0_0x4497,0x6b1a2));const express=require(a0_0x27a03e(0x1dd)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x27a03e(0x16e)),auth=require(a0_0x27a03e(0x1fd)),nodemailer=require('nodemailer');var ejs=require(a0_0x27a03e(0x162));const path=require(a0_0x27a03e(0x192)),users=require('../public/language/languages.json');function a0_0x4f13(_0x1bb6bf,_0x533338){var _0x44973d=a0_0x4497();return a0_0x4f13=function(_0x4f1344,_0x16fa9a){_0x4f1344=_0x4f1344-0x110;var _0x106057=_0x44973d[_0x4f1344];return _0x106057;},a0_0x4f13(_0x1bb6bf,_0x533338);}router['get'](a0_0x27a03e(0x20e),auth,async(_0x471936,_0x14822c)=>{var _0x26348e=a0_0x27a03e;try{const {username:_0x1d4d52,email:_0x53e32b,role:_0x69988b}=_0x471936['user'],_0x347089=_0x471936[_0x26348e(0x163)],_0x4ac98d=await profile[_0x26348e(0x1d3)]({'email':_0x347089[_0x26348e(0x16c)]}),_0x2c000b=await staff[_0x26348e(0x1d3)]({'email':_0x347089[_0x26348e(0x16c)]});if(_0x347089[_0x26348e(0x175)]==_0x26348e(0x1d5)){const _0x1df3df=await staff[_0x26348e(0x1d3)]({'email':_0x347089['email']});}const _0xdc8c2=await master_shop[_0x26348e(0x1b6)]();let _0xa6a557;if(_0x347089[_0x26348e(0x175)]==_0x26348e(0x1d5)){const _0x4b237f=await staff[_0x26348e(0x1d3)]({'email':_0x347089[_0x26348e(0x16c)]});_0xa6a557=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x4b237f['warehouse']}},{'$lookup':{'from':_0x26348e(0x1d1),'localField':_0x26348e(0x1d1),'foreignField':_0x26348e(0x19e),'as':_0x26348e(0x117)}},{'$unwind':_0x26348e(0x1f1)},{'$unwind':_0x26348e(0x159)},{'$group':{'_id':_0x26348e(0x1a2),'invoice':{'$first':_0x26348e(0x132)},'suppliers':{'$first':_0x26348e(0x130)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x26348e(0x1e9)},'room':{'$first':_0x26348e(0x144)},'product':{'$push':_0x26348e(0x159)},'note':{'$first':_0x26348e(0x209)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x26348e(0x1c7)},'return_data':{'$first':_0x26348e(0x1f0)},'batch_code':{'$first':_0x26348e(0x1b4)},'expiry_date':{'$first':_0x26348e(0x1b7)},'suppliers_docs':{'$first':_0x26348e(0x1f1)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x26348e(0x1e0)},'isle':{'$addToSet':_0x26348e(0x198)},'type':{'$addToSet':_0x26348e(0x1c3)},'floorlevel':{'$addToSet':_0x26348e(0x1be)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xa6a557=await purchases_finished[_0x26348e(0x1ae)]([{'$unwind':_0x26348e(0x159)},{'$group':{'_id':_0x26348e(0x1a2),'invoice':{'$first':_0x26348e(0x132)},'suppliers':{'$first':_0x26348e(0x130)},'date':{'$first':_0x26348e(0x173)},'warehouse_name':{'$first':_0x26348e(0x1e9)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x26348e(0x159)},'note':{'$first':_0x26348e(0x209)},'paid_amount':{'$first':_0x26348e(0x1c0)},'due_amount':{'$first':_0x26348e(0x1c7)},'return_data':{'$first':_0x26348e(0x1f0)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x26348e(0x1f1)},'total_product_quantity':{'$sum':_0x26348e(0x176)},'level':{'$addToSet':_0x26348e(0x1e0)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x26348e(0x1c3)},'floorlevel':{'$addToSet':_0x26348e(0x1be)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xdc8c2[0x0][_0x26348e(0x188)]==_0x26348e(0x1f5))var _0x2747e9=users[_0x26348e(0x1af)];else{if(_0xdc8c2[0x0][_0x26348e(0x188)]==_0x26348e(0x129))var _0x2747e9=users['Hindi'];else{if(_0xdc8c2[0x0][_0x26348e(0x188)]==_0x26348e(0x212))var _0x2747e9=users['German'];else{if(_0xdc8c2[0x0][_0x26348e(0x188)]=='Spanish')var _0x2747e9=users[_0x26348e(0x1b5)];else{if(_0xdc8c2[0x0][_0x26348e(0x188)]==_0x26348e(0x1e2))var _0x2747e9=users[_0x26348e(0x1e2)];else{if(_0xdc8c2[0x0][_0x26348e(0x188)]==_0x26348e(0x181))var _0x2747e9=users[_0x26348e(0x17f)];else{if(_0xdc8c2[0x0][_0x26348e(0x188)]=='Chinese')var _0x2747e9=users[_0x26348e(0x178)];else{if(_0xdc8c2[0x0][_0x26348e(0x188)]==_0x26348e(0x1fa))var _0x2747e9=users[_0x26348e(0x170)];}}}}}}}_0x14822c[_0x26348e(0x136)](_0x26348e(0x1ac),{'success':_0x471936[_0x26348e(0x114)](_0x26348e(0x152)),'errors':_0x471936['flash'](_0x26348e(0x142)),'purchases':_0xa6a557,'role':_0x347089,'profile':_0x4ac98d,'master_shop':_0xdc8c2,'language':_0x2747e9});}catch(_0x4b3d0d){console[_0x26348e(0x18e)](_0x26348e(0x1f6),_0x4b3d0d),_0x14822c[_0x26348e(0x1d0)](0xc8)[_0x26348e(0x164)]({'message':_0x4b3d0d[_0x26348e(0x147)]});}});function BayBinSelected(_0x290185,_0x1ec5f3){var _0x1a74e4=a0_0x27a03e,_0x12c5c0=[],_0x38d222=[];if(_0x290185==_0x1a74e4(0x12c)){switch(_0x1ec5f3){case _0x1a74e4(0x197):_0x12c5c0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1a74e4(0x138):_0x12c5c0=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x38d222=['DG'];}else{if(_0x290185=='FROZEN\x20GOODS'){switch(_0x1ec5f3){case _0x1a74e4(0x197):_0x12c5c0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1a74e4(0x138):_0x12c5c0=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x38d222=['FG'];}}return{'levels':_0x12c5c0,'identify':_0x38d222};}async function getRandom8DigitNumber(){var _0x4f7f69=a0_0x27a03e;const _0x136d78=0x989680,_0x2d0095=0x5f5e0ff,_0x1db160=Math['floor'](Math[_0x4f7f69(0x1ad)]()*(_0x2d0095-_0x136d78+0x1))+_0x136d78;var _0x57ad5a;const _0x29b3d3=await purchases_finished['findOne']({'invoice':_0x4f7f69(0x180)+_0x1db160});return _0x29b3d3&&_0x29b3d3[_0x4f7f69(0x157)]>0x0?_0x57ad5a='INCF-'+_0x1db160:_0x57ad5a=_0x4f7f69(0x180)+_0x1db160,_0x57ad5a;}router[a0_0x27a03e(0x20f)]('/view/add_purchases',auth,async(_0x18fb18,_0x3e6061)=>{var _0x4bb4bf=a0_0x27a03e;try{const {username:_0x599eaa,email:_0x54cfa8,role:_0x8b1a46}=_0x18fb18['user'],_0x383bfc=_0x18fb18[_0x4bb4bf(0x163)],_0x48dc24=await profile[_0x4bb4bf(0x1d3)]({'email':_0x383bfc[_0x4bb4bf(0x16c)]}),_0x47e385=await master_shop[_0x4bb4bf(0x1b6)](),_0x5ac645=await staff[_0x4bb4bf(0x1d3)]({'email':_0x383bfc[_0x4bb4bf(0x16c)]}),_0x3c9266=await suppliers['find']({});let _0x4fa86a;if(_0x383bfc[_0x4bb4bf(0x175)]==_0x4bb4bf(0x1d5)){const _0x25a82d=await staff[_0x4bb4bf(0x1d3)]({'email':_0x383bfc[_0x4bb4bf(0x16c)]});_0x4fa86a=await warehouse['aggregate']([{'$match':{'status':_0x4bb4bf(0x125),'name':_0x25a82d[_0x4bb4bf(0x1f8)],'warehouse_category':_0x4bb4bf(0x20c)}},{'$group':{'_id':_0x4bb4bf(0x1dc),'name':{'$first':_0x4bb4bf(0x1dc)}}}]);}else _0x4fa86a=await warehouse[_0x4bb4bf(0x1ae)]([{'$match':{'status':_0x4bb4bf(0x125),'warehouse_category':_0x4bb4bf(0x20c),'name':{'$ne':_0x4bb4bf(0x15a)}}},{'$group':{'_id':_0x4bb4bf(0x1dc),'name':{'$first':'$name'}}}]);const _0x35a7f9=await product[_0x4bb4bf(0x1b6)]({}),_0x53f366=await warehouse[_0x4bb4bf(0x1b6)]({'status':'Enabled'}),_0x5a84b5=await purchases_finished[_0x4bb4bf(0x1b6)]({}),_0x1bc591=_0x5a84b5[_0x4bb4bf(0x157)]+0x1,_0x56858c=_0x4bb4bf(0x180)+_0x1bc591[_0x4bb4bf(0x1d8)]()[_0x4bb4bf(0x160)](0x5,'0');var _0x52f7fb=['Ambient',_0x4bb4bf(0x1ff)];if(_0x47e385[0x0][_0x4bb4bf(0x188)]=='English\x20(US)')var _0xaecc9b=users[_0x4bb4bf(0x1af)];else{if(_0x47e385[0x0][_0x4bb4bf(0x188)]=='Hindi')var _0xaecc9b=users['Hindi'];else{if(_0x47e385[0x0][_0x4bb4bf(0x188)]==_0x4bb4bf(0x212))var _0xaecc9b=users['German'];else{if(_0x47e385[0x0][_0x4bb4bf(0x188)]==_0x4bb4bf(0x1b5))var _0xaecc9b=users[_0x4bb4bf(0x1b5)];else{if(_0x47e385[0x0][_0x4bb4bf(0x188)]=='French')var _0xaecc9b=users[_0x4bb4bf(0x1e2)];else{if(_0x47e385[0x0]['language']==_0x4bb4bf(0x181))var _0xaecc9b=users['Portuguese'];else{if(_0x47e385[0x0][_0x4bb4bf(0x188)]==_0x4bb4bf(0x178))var _0xaecc9b=users[_0x4bb4bf(0x178)];else{if(_0x47e385[0x0][_0x4bb4bf(0x188)]==_0x4bb4bf(0x1fa))var _0xaecc9b=users['Arabic'];}}}}}}}const _0xe2ae5=getRandom8DigitNumber();_0xe2ae5[_0x4bb4bf(0x17d)](_0x1337cc=>{var _0x6557a=_0x4bb4bf;_0x3e6061[_0x6557a(0x136)]('add_purchases_finished',{'success':_0x18fb18[_0x6557a(0x114)](_0x6557a(0x152)),'errors':_0x18fb18[_0x6557a(0x114)](_0x6557a(0x142)),'role':_0x383bfc,'profile':_0x48dc24,'suppliers':_0x3c9266,'warehouse':_0x4fa86a,'product':_0x35a7f9,'invoice':_0x1337cc,'master_shop':_0x47e385,'language':_0xaecc9b,'find_data':_0x53f366,'rooms_data':_0x52f7fb});})[_0x4bb4bf(0x141)](_0x1c4e88=>{var _0x106bd0=_0x4bb4bf;_0x18fb18[_0x106bd0(0x114)](_0x106bd0(0x142),_0x106bd0(0x19a)),_0x3e6061['redirect'](_0x106bd0(0x126));});}catch(_0x2b805b){console[_0x4bb4bf(0x18e)](_0x2b805b);}}),router[a0_0x27a03e(0x20f)](a0_0x27a03e(0x1cf),auth,async(_0x5b9268,_0x1453ba)=>{var _0x8b8181=a0_0x27a03e;try{const _0x467357=_0x5b9268[_0x8b8181(0x169)]['id'];console[_0x8b8181(0x18e)](_0x467357);const _0x345206=await master_shop[_0x8b8181(0x1b6)]();console[_0x8b8181(0x18e)](_0x8b8181(0x208),_0x345206);const _0x46793d=await product[_0x8b8181(0x1d3)]({'name':_0x467357});console[_0x8b8181(0x18e)](_0x8b8181(0x153),_0x46793d),_0x1453ba[_0x8b8181(0x1d0)](0xc8)[_0x8b8181(0x164)]({'product_data':_0x46793d,'master':_0x345206});}catch(_0xcfab52){console['log'](_0x8b8181(0x150),_0xcfab52);}}),router[a0_0x27a03e(0x1ba)]('/view/add_purchases',auth,async(_0x24141c,_0x179913)=>{var _0x5765d4=a0_0x27a03e;try{const {invoice:_0x182b3c,date:_0x5a2684,warehouse_name:_0x5bc01e,prod_name:_0x44a0d4,prod_code:_0x4271d2,prod_qty:_0x348f8f,prod_unit:_0x3a599c,prod_secondunit:_0x19098d,prod_level:_0x403726,prod_isle:_0xd224,prod_pallet:_0x5599fe,note:_0x5819f0,expiry_date:_0x36bebf,batch_code:_0x557402,payable:_0x49014e,due_amount:_0x5774e7,Room_name:_0x2bb099,primary_code:_0x2c4b84,secondary_code:_0x37847c,MaxStocks_data:_0x41b218,PO_number:_0x5c68dd,SCRN:_0x1fe826,JO_number:_0x43a9c4}=_0x24141c[_0x5765d4(0x1bc)];if(typeof _0x44a0d4==_0x5765d4(0x19f))var _0x217560=[_0x24141c['body'][_0x5765d4(0x174)]],_0x15dda3=[_0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x161)]],_0x510155=[_0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x149)]],_0x4816cb=[_0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x143)]],_0x3ed286=[_0x24141c[_0x5765d4(0x1bc)]['prod_secondunit']],_0x3a16b4=[_0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x14d)]],_0x3827fe=[_0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x12b)]],_0x3628c3=[_0x24141c['body'][_0x5765d4(0x168)]],_0xabc246=[_0x24141c[_0x5765d4(0x1bc)]['MaxStocks_data']],_0x29a735=[_0x24141c[_0x5765d4(0x1bc)]['batch_code']],_0x4c8bef=[_0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x13c)]],_0x3beaca=[_0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x17c)]],_0x13c711=[_0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x1a3)]],_0x1487c3=[_0x24141c['body'][_0x5765d4(0x1cc)]],_0x5aa400=[_0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x1c4)]],_0x178961=[_0x24141c['body'][_0x5765d4(0x13f)]];else var _0x217560=[..._0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x174)]],_0x15dda3=[..._0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x161)]],_0x510155=[..._0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x149)]],_0x4816cb=[..._0x24141c[_0x5765d4(0x1bc)]['prod_primunit']],_0x3ed286=[..._0x24141c['body'][_0x5765d4(0x1b3)]],_0x3a16b4=[..._0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x14d)]],_0x3827fe=[..._0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x12b)]],_0x3628c3=[..._0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x168)]],_0xabc246=[..._0x24141c['body'][_0x5765d4(0x1c2)]],_0x29a735=[..._0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x1e5)]],_0x4c8bef=[..._0x24141c['body'][_0x5765d4(0x13c)]],_0x3beaca=[..._0x24141c['body'][_0x5765d4(0x17c)]],_0x13c711=[..._0x24141c[_0x5765d4(0x1bc)]['max_product_unit']],_0x1487c3=[..._0x24141c[_0x5765d4(0x1bc)]['prod_cat']],_0x5aa400=[..._0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x1c4)]],_0x178961=[..._0x24141c[_0x5765d4(0x1bc)]['prod_invoice']];const _0x147039=_0x217560[_0x5765d4(0x20a)](_0x457e9d=>{return _0x457e9d={'product_name':_0x457e9d};});_0x15dda3['forEach']((_0x5c34ff,_0x5f5c3b)=>{var _0x423ab5=_0x5765d4;_0x147039[_0x5f5c3b][_0x423ab5(0x207)]=_0x5c34ff;}),_0x510155[_0x5765d4(0x1c5)]((_0x4dd15a,_0x484b4e)=>{var _0x1686ea=_0x5765d4;_0x147039[_0x484b4e][_0x1686ea(0x177)]=Math['abs'](_0x4dd15a);}),_0x4816cb[_0x5765d4(0x1c5)]((_0x5b544d,_0x5ec541)=>{var _0x54a594=_0x5765d4;_0x147039[_0x5ec541][_0x54a594(0x205)]=_0x5b544d;}),_0x3ed286[_0x5765d4(0x1c5)]((_0x3302c6,_0x26005b)=>{var _0x5098f5=_0x5765d4;_0x147039[_0x26005b][_0x5098f5(0x11e)]=_0x3302c6;}),_0x3a16b4[_0x5765d4(0x1c5)]((_0x18dfdf,_0x505923)=>{var _0x4e36bc=_0x5765d4;_0x147039[_0x505923][_0x4e36bc(0x12e)]=_0x18dfdf;}),_0x3827fe[_0x5765d4(0x1c5)]((_0x16225c,_0x218a8e)=>{var _0x14c7a8=_0x5765d4;_0x147039[_0x218a8e][_0x14c7a8(0x12b)]=_0x16225c;}),_0x3628c3[_0x5765d4(0x1c5)]((_0x2e4385,_0xaa2fc)=>{var _0x3f7688=_0x5765d4;_0x147039[_0xaa2fc][_0x3f7688(0x168)]=_0x2e4385;}),_0xabc246['forEach']((_0x1bdb52,_0x2ad6c4)=>{_0x147039[_0x2ad6c4]['maxStocks']=_0x1bdb52;}),_0x29a735['forEach']((_0x36215e,_0x1b5400)=>{var _0x51a06b=_0x5765d4;_0x147039[_0x1b5400][_0x51a06b(0x1e5)]=_0x36215e;}),_0x4c8bef[_0x5765d4(0x1c5)]((_0x42c50e,_0x38cf79)=>{_0x147039[_0x38cf79]['expiry_date']=_0x42c50e;}),_0x3beaca[_0x5765d4(0x1c5)]((_0x33e5b,_0x6fdf77)=>{var _0x22d6f8=_0x5765d4;_0x147039[_0x6fdf77][_0x22d6f8(0x1db)]=_0x33e5b;}),_0x13c711[_0x5765d4(0x1c5)]((_0x20597a,_0x2ebad1)=>{var _0x1596d1=_0x5765d4;_0x147039[_0x2ebad1][_0x1596d1(0x1bb)]=_0x20597a;}),_0x1487c3['forEach']((_0x36ee8b,_0x4b12ec)=>{_0x147039[_0x4b12ec]['product_cat']=_0x36ee8b;}),_0x5aa400[_0x5765d4(0x1c5)]((_0x427544,_0x5b6082)=>{_0x147039[_0x5b6082]['room_name']=_0x427544;}),_0x178961['forEach']((_0x130d44,_0x28be65)=>{_0x147039[_0x28be65]['invoice']=_0x130d44;});const _0x2ff05c=_0x147039[_0x5765d4(0x165)](_0x173936=>_0x173936[_0x5765d4(0x177)]!=='0'&&_0x173936[_0x5765d4(0x177)]!==''),_0x2beb7e=new purchases_finished({'invoice':_0x182b3c,'suppliers':_0x24141c[_0x5765d4(0x1bc)][_0x5765d4(0x1d1)],'date':_0x5a2684,'warehouse_name':_0x5bc01e,'product':_0x2ff05c,'note':_0x5819f0,'due_amount':_0x5774e7,'room':_0x2bb099,'POnumber':_0x5c68dd,'SCRN':_0x1fe826,'JO_number':_0x43a9c4}),_0x3b300a=await _0x2beb7e[_0x5765d4(0x121)](),_0x63149a=await purchases_finished[_0x5765d4(0x1d3)]({'invoice':_0x182b3c}),_0x3b430e=_0x63149a[_0x5765d4(0x153)][_0x5765d4(0x20a)](async _0x362236=>{var _0x3801cf=_0x5765d4;try{var _0x4c3bf8=await warehouse[_0x3801cf(0x1d3)]({'name':_0x5bc01e,'room':_0x362236[_0x3801cf(0x1b9)]}),_0x2acad6=0x0;const _0x35be65=_0x4c3bf8[_0x3801cf(0x115)][_0x3801cf(0x20a)](_0xa549e1=>{var _0x29b945=_0x3801cf;console[_0x29b945(0x18e)](_0xa549e1[_0x29b945(0x1aa)]+'=='+_0x362236[_0x29b945(0x1aa)]+'&&'+_0xa549e1[_0x29b945(0x12e)]+'=='+_0x362236[_0x29b945(0x12e)]+'&&'+_0xa549e1[_0x29b945(0x13c)]+'=='+_0x362236['expiry_date']+'&&'+_0xa549e1[_0x29b945(0x1db)]+'=='+_0x362236['production_date']+'&&'+_0xa549e1['batch_code']+'=='+_0x362236[_0x29b945(0x1e5)]+'&&'+_0xa549e1[_0x29b945(0x12f)]+'=='+_0x63149a[_0x29b945(0x12f)]),_0xa549e1['product_name']==_0x362236[_0x29b945(0x1aa)]&&_0xa549e1[_0x29b945(0x12e)]==_0x362236['bay']&&_0xa549e1[_0x29b945(0x13c)]==_0x362236[_0x29b945(0x13c)]&&_0xa549e1[_0x29b945(0x1db)]==_0x362236[_0x29b945(0x1db)]&&_0xa549e1['batch_code']==_0x362236['batch_code']&&_0xa549e1['invoice']==_0x63149a[_0x29b945(0x12f)]&&(_0xa549e1[_0x29b945(0x1a9)]=Math['abs'](_0xa549e1[_0x29b945(0x1a9)])+Math[_0x29b945(0x199)](_0x362236[_0x29b945(0x177)]),_0x2acad6++);});return _0x2acad6==0x0&&(_0x4c3bf8[_0x3801cf(0x115)]=_0x4c3bf8[_0x3801cf(0x115)][_0x3801cf(0x200)]({'product_name':_0x362236[_0x3801cf(0x1aa)],'product_stock':Math['abs'](_0x362236['quantity']),'primary_code':_0x362236[_0x3801cf(0x12b)],'secondary_code':_0x362236[_0x3801cf(0x168)],'product_code':_0x362236[_0x3801cf(0x207)],'bay':_0x362236[_0x3801cf(0x12e)],'maxProducts':_0x362236[_0x3801cf(0x1f3)],'unit':_0x362236[_0x3801cf(0x205)],'secondary_unit':_0x362236[_0x3801cf(0x11e)],'expiry_date':_0x362236[_0x3801cf(0x13c)],'production_date':_0x362236[_0x3801cf(0x1db)],'maxProducts':_0x362236[_0x3801cf(0x1f3)],'maxPerUnit':_0x362236[_0x3801cf(0x1bb)],'batch_code':_0x362236[_0x3801cf(0x1e5)],'product_cat':_0x362236[_0x3801cf(0x123)],'invoice':_0x362236['invoice'],'id_incoming':_0x362236[_0x3801cf(0x1c8)]})),_0x4c3bf8;}catch(_0x5aead2){return console['error'](_0x3801cf(0x120),_0x5aead2),null;}});Promise[_0x5765d4(0x189)](_0x3b430e)['then'](async _0x1da82e=>{var _0x11ab06=_0x5765d4;try{for(const _0xf15d8b of _0x1da82e){await warehouse[_0x11ab06(0x1ea)]({'_id':_0xf15d8b[_0x11ab06(0x1c8)]},{'$addToSet':{'product_details':{'$each':_0xf15d8b[_0x11ab06(0x115)]}}});}const _0x4e2302=await master_shop[_0x11ab06(0x1b6)](),_0x1d2d0c=await email_settings[_0x11ab06(0x1d3)](),_0x2c1e8c=await supervisor_settings[_0x11ab06(0x1b6)]();var _0x54d61a=_0x63149a[_0x11ab06(0x153)],_0x38e937='',_0x541682;for(_0x541682 in _0x54d61a){var _0x28cce0='FG';_0x63149a['warehouse_name']==_0x11ab06(0x12c)&&(_0x28cce0='DG'),_0x38e937+=_0x11ab06(0x1a8)+_0x11ab06(0x11b)+_0x54d61a[_0x541682][_0x11ab06(0x1aa)]+_0x11ab06(0x171)+_0x11ab06(0x11b)+_0x54d61a[_0x541682]['product_code']+_0x11ab06(0x171)+_0x11ab06(0x11b)+_0x54d61a[_0x541682][_0x11ab06(0x177)]+_0x11ab06(0x171)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x54d61a[_0x541682]['standard_unit']+_0x11ab06(0x171)+_0x11ab06(0x11b)+_0x54d61a[_0x541682]['secondary_unit']+_0x11ab06(0x171)+_0x11ab06(0x11b)+_0x63149a[_0x11ab06(0x18f)]+_0x11ab06(0x171)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x54d61a[_0x541682][_0x11ab06(0x1b9)]+_0x11ab06(0x171)+_0x11ab06(0x11b)+_0x28cce0+_0x54d61a[_0x541682]['bay']+_0x11ab06(0x171),_0x11ab06(0x1ce);}let _0x1936cb=nodemailer[_0x11ab06(0x16b)]({'host':_0x1d2d0c[_0x11ab06(0x12d)],'port':Number(_0x1d2d0c[_0x11ab06(0x1d6)]),'secure':![],'auth':{'user':_0x1d2d0c[_0x11ab06(0x16c)],'pass':_0x1d2d0c['password']}}),_0x403a1d={'from':_0x1d2d0c[_0x11ab06(0x16c)],'to':_0x2c1e8c[0x0][_0x11ab06(0x1e3)],'subject':_0x11ab06(0x210),'attachments':[{'filename':'Logo.png','path':__dirname+_0x11ab06(0x167)+_0x11ab06(0x1b2)+_0x4e2302[0x0][_0x11ab06(0x1e6)],'cid':_0x11ab06(0x18b)}],'html':_0x11ab06(0x15d)+_0x11ab06(0x1f2)+_0x11ab06(0x185)+_0x11ab06(0x1a5)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x11ab06(0x1a5)+_0x11ab06(0x13a)+_0x11ab06(0x179)+_0x11ab06(0x1a5)+_0x11ab06(0x172)+_0x4e2302[0x0][_0x11ab06(0x1c6)]+_0x11ab06(0x1ef)+_0x11ab06(0x179)+_0x11ab06(0x179)+_0x11ab06(0x124)+_0x11ab06(0x1a5)+_0x11ab06(0x146)+_0x11ab06(0x145)+_0x63149a['invoice']+'\x20'+_0x11ab06(0x1bd)+'\x20Order\x20Date\x20:\x20'+_0x63149a[_0x11ab06(0x186)]+'\x20'+_0x11ab06(0x1ca)+_0x11ab06(0x191)+_0x11ab06(0x179)+_0x11ab06(0x110)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x11ab06(0x1a8)+_0x11ab06(0x1c9)+_0x11ab06(0x203)+_0x11ab06(0x16d)+_0x11ab06(0x154)+_0x11ab06(0x15e)+_0x11ab06(0x135)+_0x11ab06(0x128)+_0x11ab06(0x18d)+_0x11ab06(0x1ce)+_0x11ab06(0x15f)+_0x11ab06(0x11c)+'\x20'+_0x38e937+'\x20'+_0x11ab06(0x18c)+_0x11ab06(0x1ec)+_0x11ab06(0x1a5)+'<strong>\x20Regards\x20</strong>'+_0x11ab06(0x194)+_0x4e2302[0x0][_0x11ab06(0x1c6)]+'</h5>'+_0x11ab06(0x179)+_0x11ab06(0x179)+'</body></html>'};_0x1936cb[_0x11ab06(0x113)](_0x403a1d,function(_0x11e348,_0x19cdb0){var _0x3a2823=_0x11ab06;_0x11e348?(console[_0x3a2823(0x18e)](_0x11e348),console[_0x3a2823(0x18e)](_0x3a2823(0x158))):console[_0x3a2823(0x18e)]('Email\x20sent\x20successfully');});}catch(_0x66c5e){console[_0x11ab06(0x13d)](_0x66c5e),_0x179913['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x66c5e['message']});}})[_0x5765d4(0x141)](_0x99ef2c=>{var _0x2acaae=_0x5765d4;console[_0x2acaae(0x13d)](_0x99ef2c);}),_0x24141c[_0x5765d4(0x114)](_0x5765d4(0x152),_0x5765d4(0x17a)),_0x179913[_0x5765d4(0x1d9)](_0x5765d4(0x126));}catch(_0x44854e){console[_0x5765d4(0x18e)](_0x44854e);}}),router['get'](a0_0x27a03e(0x206),auth,async(_0x3aa470,_0x15d0cf)=>{var _0x24fdf6=a0_0x27a03e;try{const {username:_0x198bc3,email:_0x7c6ad9,role:_0x2db8b4}=_0x3aa470[_0x24fdf6(0x163)],_0x3a8c82=_0x3aa470['user'],_0x44833a=await profile[_0x24fdf6(0x1d3)]({'email':_0x3a8c82[_0x24fdf6(0x16c)]}),_0x2f5b9f=await master_shop[_0x24fdf6(0x1b6)](),_0x8e8de7=_0x3aa470[_0x24fdf6(0x169)]['id'],_0x32b0ef=await purchases_finished['findById'](_0x8e8de7),_0x40febf=await suppliers['find']({});let _0x15b5bf;if(_0x3a8c82[_0x24fdf6(0x175)]==_0x24fdf6(0x1d5)){const _0x18b345=await staff[_0x24fdf6(0x1d3)]({'email':_0x3a8c82[_0x24fdf6(0x16c)]});_0x15b5bf=await warehouse['find']({'status':_0x24fdf6(0x125),'name':_0x18b345['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x15b5bf=await warehouse[_0x24fdf6(0x1ae)]([{'$match':{'status':_0x24fdf6(0x125),'warehouse_category':_0x24fdf6(0x20c)}},{'$group':{'_id':_0x24fdf6(0x1dc),'name':{'$first':_0x24fdf6(0x1dc)}}}]);const _0x1c899f=await product['find']({}),_0x3e8b38=BayBinSelected(_0x32b0ef[_0x24fdf6(0x18f)],_0x32b0ef[_0x24fdf6(0x1b8)]);let _0x52a2bd=new Date(_0x32b0ef[_0x24fdf6(0x13c)]),_0x344045=('0'+_0x52a2bd[_0x24fdf6(0x19b)]())['slice'](-0x2),_0x47402a=('0'+(_0x52a2bd[_0x24fdf6(0x14c)]()+0x1))[_0x24fdf6(0x131)](-0x2),_0x2cbd03=_0x52a2bd['getFullYear'](),_0x6d3847=_0x2cbd03+'-'+_0x47402a+'-'+_0x344045;if(_0x2f5b9f[0x0][_0x24fdf6(0x188)]==_0x24fdf6(0x1f5)){var _0x5ae28e=users[_0x24fdf6(0x1af)];console['log'](_0x5ae28e);}else{if(_0x2f5b9f[0x0][_0x24fdf6(0x188)]==_0x24fdf6(0x129))var _0x5ae28e=users[_0x24fdf6(0x129)];else{if(_0x2f5b9f[0x0][_0x24fdf6(0x188)]==_0x24fdf6(0x212))var _0x5ae28e=users[_0x24fdf6(0x212)];else{if(_0x2f5b9f[0x0]['language']==_0x24fdf6(0x1b5))var _0x5ae28e=users[_0x24fdf6(0x1b5)];else{if(_0x2f5b9f[0x0][_0x24fdf6(0x188)]==_0x24fdf6(0x1e2))var _0x5ae28e=users[_0x24fdf6(0x1e2)];else{if(_0x2f5b9f[0x0]['language']=='Portuguese\x20(BR)')var _0x5ae28e=users[_0x24fdf6(0x17f)];else{if(_0x2f5b9f[0x0]['language']==_0x24fdf6(0x178))var _0x5ae28e=users[_0x24fdf6(0x178)];else{if(_0x2f5b9f[0x0]['language']==_0x24fdf6(0x1fa))var _0x5ae28e=users[_0x24fdf6(0x170)];}}}}}}}_0x15d0cf[_0x24fdf6(0x136)]('edit_purchases_finished_view',{'success':_0x3aa470[_0x24fdf6(0x114)]('success'),'errors':_0x3aa470[_0x24fdf6(0x114)](_0x24fdf6(0x142)),'role':_0x3a8c82,'profile':_0x44833a,'purchases':_0x32b0ef,'suppliers':_0x40febf,'warehouse':_0x15b5bf,'product':_0x1c899f,'master_shop':_0x2f5b9f,'language':_0x5ae28e,'ed_fullDate':_0x6d3847,'dataSelected':_0x3e8b38});}catch(_0x56a27d){console['log'](_0x56a27d);}}),router['get']('/view/:id',auth,async(_0x42e488,_0x4a0a7b)=>{var _0x408329=a0_0x27a03e;try{const {username:_0x1ba9a8,email:_0x42f113,role:_0x21d0f5}=_0x42e488[_0x408329(0x163)],_0x259fe6=_0x42e488[_0x408329(0x163)],_0x4cb5fe=await profile[_0x408329(0x1d3)]({'email':_0x259fe6[_0x408329(0x16c)]}),_0x65be22=await master_shop[_0x408329(0x1b6)](),_0xf311b8=_0x42e488[_0x408329(0x169)]['id'],_0x5520ae=await purchases_finished[_0x408329(0x184)](_0xf311b8),_0x5da52b=await suppliers['find']({});let _0x3af02f;if(_0x259fe6['role']==_0x408329(0x1d5)){const _0xd8a825=await staff[_0x408329(0x1d3)]({'email':_0x259fe6[_0x408329(0x16c)]});_0x3af02f=await warehouse[_0x408329(0x1b6)]({'status':_0x408329(0x125),'name':_0xd8a825['warehouse'],'warehouse_category':_0x408329(0x20c)});}else _0x3af02f=await warehouse[_0x408329(0x1ae)]([{'$match':{'status':_0x408329(0x125),'warehouse_category':_0x408329(0x20c)}},{'$group':{'_id':_0x408329(0x1dc),'name':{'$first':_0x408329(0x1dc)}}}]);const _0x2a0a20=await product[_0x408329(0x1b6)]({}),_0x4ef762=BayBinSelected(_0x5520ae[_0x408329(0x18f)],_0x5520ae['room']);let _0x2104e1=new Date(_0x5520ae[_0x408329(0x13c)]),_0x32f6db=('0'+_0x2104e1[_0x408329(0x19b)]())['slice'](-0x2),_0x29f802=('0'+(_0x2104e1[_0x408329(0x14c)]()+0x1))[_0x408329(0x131)](-0x2),_0xbfcc54=_0x2104e1[_0x408329(0x1a0)](),_0x5d4c66=_0xbfcc54+'-'+_0x29f802+'-'+_0x32f6db;if(_0x65be22[0x0][_0x408329(0x188)]==_0x408329(0x1f5)){var _0x38a8e6=users[_0x408329(0x1af)];console[_0x408329(0x18e)](_0x38a8e6);}else{if(_0x65be22[0x0][_0x408329(0x188)]==_0x408329(0x129))var _0x38a8e6=users[_0x408329(0x129)];else{if(_0x65be22[0x0]['language']==_0x408329(0x212))var _0x38a8e6=users['German'];else{if(_0x65be22[0x0][_0x408329(0x188)]==_0x408329(0x1b5))var _0x38a8e6=users['Spanish'];else{if(_0x65be22[0x0][_0x408329(0x188)]==_0x408329(0x1e2))var _0x38a8e6=users[_0x408329(0x1e2)];else{if(_0x65be22[0x0][_0x408329(0x188)]==_0x408329(0x181))var _0x38a8e6=users['Portuguese'];else{if(_0x65be22[0x0][_0x408329(0x188)]=='Chinese')var _0x38a8e6=users['Chinese'];else{if(_0x65be22[0x0]['language']=='Arabic\x20(ae)')var _0x38a8e6=users['Arabic'];}}}}}}}_0x4a0a7b[_0x408329(0x136)]('edit_purchases_finished',{'success':_0x42e488[_0x408329(0x114)]('success'),'errors':_0x42e488[_0x408329(0x114)](_0x408329(0x142)),'role':_0x259fe6,'profile':_0x4cb5fe,'purchases':_0x5520ae,'suppliers':_0x5da52b,'warehouse':_0x3af02f,'product':_0x2a0a20,'master_shop':_0x65be22,'language':_0x38a8e6,'ed_fullDate':_0x5d4c66,'dataSelected':_0x4ef762});}catch(_0x4b66b9){console[_0x408329(0x18e)](_0x4b66b9);}}),router[a0_0x27a03e(0x1ba)]('/view/:id',auth,async(_0x4696e4,_0x3b9aa2)=>{var _0x5ccf64=a0_0x27a03e;try{const _0x317952=_0x4696e4[_0x5ccf64(0x169)]['id'],_0x5155ea=await purchases_finished[_0x5ccf64(0x1d3)]({'_id':_0x4696e4['params']['id']}),_0x59b99e=await warehouse[_0x5ccf64(0x1d3)]({'name':_0x5155ea['warehouse_name'],'room':_0x5155ea[_0x5ccf64(0x1b8)]});_0x5155ea[_0x5ccf64(0x153)]['forEach'](_0x26adcc=>{var _0x5e5707=_0x5ccf64;const _0x3293e1=_0x59b99e[_0x5e5707(0x115)][_0x5e5707(0x20a)](_0x78a06a=>{var _0x2fc23b=_0x5e5707;_0x78a06a['product_name']==_0x26adcc[_0x2fc23b(0x1aa)]&&_0x78a06a[_0x2fc23b(0x12e)]==_0x26adcc['bay']&&(_0x78a06a[_0x2fc23b(0x1a9)]=parseInt(_0x78a06a[_0x2fc23b(0x1a9)])-parseInt(_0x26adcc[_0x2fc23b(0x177)]));});}),await _0x59b99e[_0x5ccf64(0x121)]();const {invoice:_0xd9bfaa,suppliers:_0x1ddc29,date:_0x1b1649,warehouse_name:_0x533fe5,prod_name:_0x5916f0,prod_code:_0x2f5411,prod_qty:_0x47d347,prod_unit:_0x1f409c,prod_secondunit:_0x31864f,prod_level:_0x45c046,prod_isle:_0x319a5b,prod_pallet:_0x5712ff,note:_0x1509a0,expiry_date:_0x22c21e,batch_code:_0x591505,paid_amount:_0x115144,due_amount:_0x44f545,Room_name:_0xcf98fc,primary_code:_0x258327,secondary_code:_0x386227,PO_number:_0xb05adc,JO_number:_0x51d5f6}=_0x4696e4['body'];if(typeof _0x5916f0=='string')var _0x5b9bdb=[_0x4696e4[_0x5ccf64(0x1bc)]['prod_name']],_0x45f61a=[_0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x161)]],_0xcc244c=[_0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x196)]],_0x1d0c30=[_0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x11f)]],_0x5d7f35=[_0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x1b3)]],_0x373583=[_0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x14d)]],_0x20d536=[_0x4696e4[_0x5ccf64(0x1bc)]['primary_code']],_0xf918e=[_0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x168)]],_0x4c657e=[_0x4696e4[_0x5ccf64(0x1bc)]['MaxStocks_data']],_0xf6eff3=[_0x4696e4[_0x5ccf64(0x1bc)]['batch_code']],_0x4e3734=[_0x4696e4['body'][_0x5ccf64(0x13c)]];else var _0x5b9bdb=[..._0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x174)]],_0x45f61a=[..._0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x161)]],_0xcc244c=[..._0x4696e4['body'][_0x5ccf64(0x196)]],_0x1d0c30=[..._0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x11f)]],_0x5d7f35=[..._0x4696e4['body'][_0x5ccf64(0x1b3)]],_0x373583=[..._0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x14d)]],_0x20d536=[..._0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x12b)]],_0xf918e=[..._0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x168)]],_0x4c657e=[..._0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x1c2)]],_0xf6eff3=[..._0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x1e5)]],_0x4e3734=[..._0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x13c)]];const _0xf116f4=_0x5b9bdb[_0x5ccf64(0x20a)](_0x324441=>{return _0x324441={'product_name':_0x324441};});_0x45f61a['forEach']((_0x35490a,_0x3dbcbb)=>{var _0x193af2=_0x5ccf64;_0xf116f4[_0x3dbcbb][_0x193af2(0x207)]=_0x35490a;}),_0xcc244c[_0x5ccf64(0x1c5)]((_0x48f0fb,_0x125f0e)=>{_0xf116f4[_0x125f0e]['quantity']=_0x48f0fb;}),_0x1d0c30[_0x5ccf64(0x1c5)]((_0x1c3abc,_0x19247b)=>{_0xf116f4[_0x19247b]['standard_unit']=_0x1c3abc;}),_0x5d7f35[_0x5ccf64(0x1c5)]((_0x27656f,_0x434fec)=>{var _0x447ba2=_0x5ccf64;_0xf116f4[_0x434fec][_0x447ba2(0x11e)]=_0x27656f;}),_0x373583[_0x5ccf64(0x1c5)]((_0x1ce747,_0xe005ed)=>{var _0x2d0c72=_0x5ccf64;_0xf116f4[_0xe005ed][_0x2d0c72(0x12e)]=_0x1ce747;}),_0x20d536['forEach']((_0x297ad9,_0x50fa8a)=>{var _0x4bfe88=_0x5ccf64;_0xf116f4[_0x50fa8a][_0x4bfe88(0x12b)]=_0x297ad9;}),_0xf918e['forEach']((_0x2678c6,_0x97efe)=>{_0xf116f4[_0x97efe]['secondary_code']=_0x2678c6;}),_0x4c657e[_0x5ccf64(0x1c5)]((_0x21c2d7,_0x886cf6)=>{var _0x52d9ce=_0x5ccf64;_0xf116f4[_0x886cf6][_0x52d9ce(0x1f3)]=_0x21c2d7;}),_0xf6eff3[_0x5ccf64(0x1c5)]((_0x3cb2b8,_0x585b5d)=>{_0xf116f4[_0x585b5d]['batch_code']=_0x3cb2b8;}),_0x4e3734[_0x5ccf64(0x1c5)]((_0x2263a0,_0x516aa3)=>{_0xf116f4[_0x516aa3]['expiry_date']=_0x2263a0;});const _0x1b2b01=_0xf116f4[_0x5ccf64(0x165)](_0x76be21=>_0x76be21[_0x5ccf64(0x177)]!=='0'&&_0x76be21[_0x5ccf64(0x177)]!=='');_0x5155ea[_0x5ccf64(0x12f)]=_0xd9bfaa,_0x5155ea['suppliers']=_0x1ddc29,_0x5155ea[_0x5ccf64(0x186)]=_0x1b1649,_0x5155ea['warehouse_name']=_0x533fe5,_0x5155ea['product']=_0x1b2b01,_0x5155ea[_0x5ccf64(0x1bf)]=_0x1509a0,_0x5155ea[_0x5ccf64(0x20d)]=_0x115144,_0x5155ea[_0x5ccf64(0x182)]=_0x44f545,_0x5155ea['room']=_0xcf98fc,_0x5155ea['POnumber']=_0xb05adc,_0x5155ea[_0x5ccf64(0x118)]=_0x51d5f6;const _0x5ef3e2=await _0x5155ea[_0x5ccf64(0x121)](),_0x575f8b=await warehouse[_0x5ccf64(0x1d3)]({'name':_0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x18f)],'room':_0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x190)]});_0x5155ea[_0x5ccf64(0x153)]['forEach'](_0x40929a=>{var _0x5e259c=_0x5ccf64,_0x3149ed=0x0;const _0x13272a=_0x575f8b[_0x5e259c(0x115)][_0x5e259c(0x20a)](_0xa71d88=>{var _0x8b8417=_0x5e259c;_0xa71d88[_0x8b8417(0x1aa)]==_0x40929a[_0x8b8417(0x1aa)]&&_0xa71d88[_0x8b8417(0x12e)]==_0x40929a['bay']&&(_0xa71d88[_0x8b8417(0x1a9)]=parseInt(_0xa71d88[_0x8b8417(0x1a9)])+parseInt(_0x40929a[_0x8b8417(0x177)]),_0x3149ed++);});_0x3149ed=='0'&&(_0x575f8b[_0x5e259c(0x115)]=_0x575f8b[_0x5e259c(0x115)][_0x5e259c(0x200)]({'product_name':_0x40929a[_0x5e259c(0x1aa)],'product_stock':_0x40929a[_0x5e259c(0x177)],'primary_code':_0x40929a['primary_code'],'secondary_code':_0x40929a[_0x5e259c(0x168)],'product_code':_0x40929a[_0x5e259c(0x207)],'bay':_0x40929a[_0x5e259c(0x12e)],'maxProducts':_0x40929a['maxStocks'],'unit':_0x40929a[_0x5e259c(0x205)],'secondary_unit':_0x40929a[_0x5e259c(0x11e)],'expiry_date':_0x40929a['expiry_date']}));}),await _0x575f8b[_0x5ccf64(0x121)]();const _0x3cac24=await s_payment_data[_0x5ccf64(0x1d3)]({'invoice':_0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x12f)]});if(_0x3cac24===null){}else console[_0x5ccf64(0x18e)](_0x5ccf64(0x1d1),_0x3cac24,_0x4696e4[_0x5ccf64(0x1bc)][_0x5ccf64(0x12f)]),_0x3cac24['suppliers']=_0x4696e4['body']['suppliers'],await _0x3cac24[_0x5ccf64(0x121)]();_0x4696e4[_0x5ccf64(0x114)]('success',_0x5ccf64(0x19c)),_0x3b9aa2['redirect'](_0x5ccf64(0x126));}catch(_0x2faa3f){console[_0x5ccf64(0x18e)](_0x2faa3f);}}),router['post'](a0_0x27a03e(0x134),auth,async(_0x1bae2a,_0x5d77e3)=>{var _0x504a1b=a0_0x27a03e;try{const _0x56efe3=_0x1bae2a[_0x504a1b(0x169)]['id'],{invoice:_0x16120f,suppliers:_0x4c38a2,payable:_0x1f8ee1,due_amount:_0x427bb6}=_0x1bae2a[_0x504a1b(0x1bc)],_0x155f8f=await purchases[_0x504a1b(0x184)](_0x56efe3);var _0x53a5f8=_0x1f8ee1-_0x427bb6;_0x155f8f[_0x504a1b(0x20d)]=parseFloat(_0x155f8f[_0x504a1b(0x20d)])+parseFloat(_0x427bb6),_0x155f8f['due_amount']=_0x53a5f8;const _0x1d0f78=await _0x155f8f[_0x504a1b(0x121)]();console[_0x504a1b(0x18e)](_0x1d0f78);const _0x312bf5=await s_payment_data[_0x504a1b(0x1d3)]({'invoice':_0x16120f});_0x312bf5[_0x504a1b(0x1ee)]=_0x53a5f8,await _0x312bf5['save']();let _0x219214=new Date(),_0x34813b=('0'+_0x219214[_0x504a1b(0x19b)]())['slice'](-0x2),_0x281adc=('0'+(_0x219214['getMonth']()+0x1))[_0x504a1b(0x131)](-0x2),_0x114a48=_0x219214[_0x504a1b(0x1a0)](),_0x4ae91a=_0x114a48+'-'+_0x281adc+'-'+_0x34813b;const _0x38af8a=new suppliers_payment({'invoice':_0x16120f,'date':_0x114a48+'-'+_0x281adc+'-'+_0x34813b,'suppliers':_0x4c38a2,'reason':_0x504a1b(0x187),'amount':_0x427bb6}),_0x53a146=await _0x38af8a[_0x504a1b(0x121)]();_0x1bae2a[_0x504a1b(0x114)](_0x504a1b(0x152),_0x504a1b(0x151)),_0x5d77e3[_0x504a1b(0x1d9)](_0x504a1b(0x133));}catch(_0x2898da){console[_0x504a1b(0x18e)](_0x2898da);}}),router[a0_0x27a03e(0x20f)](a0_0x27a03e(0x1d7),auth,async(_0x2e9479,_0x29e94a)=>{var _0x335819=a0_0x27a03e;try{const {username:_0x41b32a,email:_0x32f752,role:_0x61bafe}=_0x2e9479[_0x335819(0x163)],_0x2e4d5f=_0x2e9479[_0x335819(0x163)],_0x320383=await profile['findOne']({'email':_0x2e4d5f[_0x335819(0x16c)]}),_0x1657be=await master_shop['find']();console['log'](_0x335819(0x208),_0x1657be);const _0x55cf2b=_0x2e9479['params']['id'],_0x554f75=await purchases[_0x335819(0x184)](_0x55cf2b);console['log'](_0x554f75);const _0xe202fb=await suppliers[_0x335819(0x1d3)]({'name':_0x554f75[_0x335819(0x1d1)]});console[_0x335819(0x18e)](_0xe202fb);if(_0x1657be[0x0]['language']==_0x335819(0x1f5)){var _0x23edae=users['English'];console[_0x335819(0x18e)](_0x23edae);}else{if(_0x1657be[0x0]['language']==_0x335819(0x129))var _0x23edae=users[_0x335819(0x129)];else{if(_0x1657be[0x0][_0x335819(0x188)]==_0x335819(0x212))var _0x23edae=users['German'];else{if(_0x1657be[0x0][_0x335819(0x188)]==_0x335819(0x1b5))var _0x23edae=users[_0x335819(0x1b5)];else{if(_0x1657be[0x0]['language']==_0x335819(0x1e2))var _0x23edae=users[_0x335819(0x1e2)];else{if(_0x1657be[0x0][_0x335819(0x188)]==_0x335819(0x181))var _0x23edae=users[_0x335819(0x17f)];else{if(_0x1657be[0x0][_0x335819(0x188)]=='Chinese')var _0x23edae=users[_0x335819(0x178)];else{if(_0x1657be[0x0][_0x335819(0x188)]==_0x335819(0x1fa))var _0x23edae=users[_0x335819(0x170)];}}}}}}}_0x29e94a['render'](_0x335819(0x1cd),{'success':_0x2e9479[_0x335819(0x114)](_0x335819(0x152)),'errors':_0x2e9479[_0x335819(0x114)]('errors'),'role':_0x2e4d5f,'profile':_0x320383,'master_shop':_0x1657be,'supplier':_0xe202fb,'purchase':_0x554f75,'language':_0x23edae});}catch(_0x15a49b){console[_0x335819(0x18e)](_0x15a49b);}}),router['get'](a0_0x27a03e(0x1a7),auth,async(_0x1017e1,_0x51a618)=>{var _0x3025e4=a0_0x27a03e;try{const {username:_0x389544,email:_0x17059f,role:_0x437898}=_0x1017e1['user'],_0x3c6203=_0x1017e1[_0x3025e4(0x163)],_0x1e5519=await profile[_0x3025e4(0x1d3)]({'email':_0x3c6203[_0x3025e4(0x16c)]}),_0x128347=await master_shop[_0x3025e4(0x1b6)]();console['log']('master',_0x128347);const _0x21f7f1=_0x1017e1[_0x3025e4(0x169)]['id'];console[_0x3025e4(0x18e)](_0x21f7f1);const _0x35fbc2=await purchases_finished[_0x3025e4(0x184)](_0x21f7f1);console[_0x3025e4(0x18e)](_0x3025e4(0x201),_0x35fbc2);const _0x6a59b5=await product[_0x3025e4(0x1b6)]({}),_0x3f164e=await warehouse[_0x3025e4(0x1ae)]([{'$match':{'name':_0x35fbc2['warehouse_name'],'room':_0x35fbc2['room']}},{'$unwind':_0x3025e4(0x14e)},{'$group':{'_id':_0x3025e4(0x204),'name':{'$first':_0x3025e4(0x183)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3025e4(0x119)},'bin':{'$first':_0x3025e4(0x14a)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3025e4(0x1f9)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3025e4(0x116)},'product_code':{'$first':_0x3025e4(0x1e1)},'storage':{'$first':_0x3025e4(0x14f)},'rack':{'$first':_0x3025e4(0x1a4)}}}]);console[_0x3025e4(0x18e)]('stock_data',_0x3f164e);let _0x27ec40;if(_0x3c6203['role']=='staff'){const _0x35cc86=await staff[_0x3025e4(0x1d3)]({'email':_0x3c6203[_0x3025e4(0x16c)]});_0x27ec40=await warehouse[_0x3025e4(0x1b6)]({'status':_0x3025e4(0x125),'name':_0x35cc86[_0x3025e4(0x1f8)],'warehouse_category':'Finished\x20Goods','name':_0x3025e4(0x11d)});}else _0x27ec40=await warehouse[_0x3025e4(0x1ae)]([{'$match':{'status':_0x3025e4(0x125),'warehouse_category':_0x3025e4(0x20c),'name':'Return\x20Goods'}},{'$group':{'_id':_0x3025e4(0x1dc),'name':{'$first':'$name'}}}]);if(_0x128347[0x0][_0x3025e4(0x188)]==_0x3025e4(0x1f5)){var _0x309150=users[_0x3025e4(0x1af)];console[_0x3025e4(0x18e)](_0x309150);}else{if(_0x128347[0x0][_0x3025e4(0x188)]==_0x3025e4(0x129))var _0x309150=users[_0x3025e4(0x129)];else{if(_0x128347[0x0][_0x3025e4(0x188)]==_0x3025e4(0x212))var _0x309150=users['German'];else{if(_0x128347[0x0]['language']==_0x3025e4(0x1b5))var _0x309150=users[_0x3025e4(0x1b5)];else{if(_0x128347[0x0][_0x3025e4(0x188)]=='French')var _0x309150=users[_0x3025e4(0x1e2)];else{if(_0x128347[0x0][_0x3025e4(0x188)]==_0x3025e4(0x181))var _0x309150=users[_0x3025e4(0x17f)];else{if(_0x128347[0x0]['language']==_0x3025e4(0x178))var _0x309150=users[_0x3025e4(0x178)];else{if(_0x128347[0x0][_0x3025e4(0x188)]==_0x3025e4(0x1fa))var _0x309150=users[_0x3025e4(0x170)];}}}}}}}_0x51a618[_0x3025e4(0x136)](_0x3025e4(0x15b),{'success':_0x1017e1[_0x3025e4(0x114)](_0x3025e4(0x152)),'errors':_0x1017e1['flash']('errors'),'role':_0x3c6203,'profile':_0x1e5519,'user':_0x35fbc2,'stock':_0x3f164e,'master_shop':_0x128347,'product':_0x6a59b5,'language':_0x309150,'warehouse':_0x27ec40});}catch(_0x420b71){console[_0x3025e4(0x18e)](_0x420b71);}}),router[a0_0x27a03e(0x1ba)](a0_0x27a03e(0x1a7),auth,async(_0x239ebb,_0x40d64e)=>{var _0x388c68=a0_0x27a03e;try{const {invoice:_0x29fa3d,date:_0x20fbd8,warehouse_name:_0x155380,Room_name:_0x3aada5,product_name:_0x5f4182,purchase_quantity:_0x6bf74c,stocks:_0x145b6a,return_qty:_0x2a3d4c,note:_0x31538d,level:_0x25c649,isle:_0x2047e4,pallet:_0x3e870d,to_warehouse_name:_0x279c2e,to_Room_name:_0x400c91}=_0x239ebb[_0x388c68(0x1bc)],_0x21c61b=await purchases_finished[_0x388c68(0x1d3)]({'_id':_0x239ebb[_0x388c68(0x169)]['id']}),_0x45ba9b=await warehouse[_0x388c68(0x1d3)]({'name':_0x155380,'room':_0x3aada5,'warehouse_category':_0x388c68(0x20c)});if(typeof _0x5f4182==_0x388c68(0x19f))var _0x127fe9=[_0x239ebb[_0x388c68(0x1bc)]['product_name']],_0x4d1339=[_0x239ebb[_0x388c68(0x1bc)][_0x388c68(0x156)]],_0x1ce1d7=[_0x239ebb['body'][_0x388c68(0x211)]],_0x1b55ec=[_0x239ebb[_0x388c68(0x1bc)][_0x388c68(0x1a1)]],_0x353245=[_0x239ebb['body']['level']],_0x2e56e3=[_0x239ebb[_0x388c68(0x1bc)][_0x388c68(0x139)]],_0x5e662e=[_0x239ebb['body'][_0x388c68(0x15c)]],_0x57ee8e=[_0x239ebb['body']['secondary_code_hide']];else var _0x127fe9=[..._0x239ebb[_0x388c68(0x1bc)]['product_name']],_0x4d1339=[..._0x239ebb['body'][_0x388c68(0x156)]],_0x1ce1d7=[..._0x239ebb['body'][_0x388c68(0x211)]],_0x1b55ec=[..._0x239ebb[_0x388c68(0x1bc)][_0x388c68(0x1a1)]],_0x353245=[..._0x239ebb[_0x388c68(0x1bc)][_0x388c68(0x193)]],_0x2e56e3=[..._0x239ebb[_0x388c68(0x1bc)][_0x388c68(0x139)]],_0x5e662e=[..._0x239ebb[_0x388c68(0x1bc)][_0x388c68(0x15c)]],_0x57ee8e=[..._0x239ebb[_0x388c68(0x1bc)]['secondary_code_hide']];const _0x4f9ae0=_0x127fe9['map'](_0x51f717=>{return _0x51f717={'product_name':_0x51f717};});_0x4d1339['forEach']((_0x2249d2,_0x136904)=>{var _0x1bd43a=_0x388c68;_0x4f9ae0[_0x136904][_0x1bd43a(0x156)]=_0x2249d2;}),_0x1ce1d7[_0x388c68(0x1c5)]((_0x1ed653,_0x54391f)=>{var _0x260d8e=_0x388c68;_0x4f9ae0[_0x54391f][_0x260d8e(0x202)]=_0x1ed653;}),_0x1b55ec[_0x388c68(0x1c5)]((_0x2a70bb,_0x395c93)=>{var _0x1bad76=_0x388c68;_0x4f9ae0[_0x395c93][_0x1bad76(0x1a1)]=_0x2a70bb;}),_0x353245[_0x388c68(0x1c5)]((_0x2142ce,_0x2bd631)=>{var _0x9725df=_0x388c68;_0x4f9ae0[_0x2bd631][_0x9725df(0x12e)]=_0x2142ce;}),_0x2e56e3[_0x388c68(0x1c5)]((_0x5a611d,_0x988dc8)=>{var _0x8bacd3=_0x388c68;_0x4f9ae0[_0x988dc8][_0x8bacd3(0x207)]=_0x5a611d;}),_0x5e662e['forEach']((_0x2fcb58,_0x2b6bcd)=>{var _0x2f337a=_0x388c68;_0x4f9ae0[_0x2b6bcd][_0x2f337a(0x12b)]=_0x2fcb58;}),_0x57ee8e[_0x388c68(0x1c5)]((_0x222c01,_0x1d02f9)=>{var _0x532a6d=_0x388c68;_0x4f9ae0[_0x1d02f9][_0x532a6d(0x168)]=_0x222c01;}),_0x4f9ae0['forEach'](_0x4b5d41=>{var _0x34beb2=_0x388c68;console[_0x34beb2(0x18e)](_0x4b5d41);const _0x332734=_0x45ba9b['product_details'][_0x34beb2(0x20a)](_0x4fb26c=>{var _0x4cede0=_0x34beb2;_0x4fb26c[_0x4cede0(0x1aa)]==_0x4b5d41[_0x4cede0(0x1aa)]&&_0x4fb26c['bay']==_0x4b5d41['bay']&&(console[_0x4cede0(0x18e)](parseInt(_0x4fb26c[_0x4cede0(0x1a9)])+'\x20<>\x20'+parseInt(_0x4b5d41['return_qty'])),_0x4fb26c[_0x4cede0(0x1a9)]=parseInt(_0x4fb26c[_0x4cede0(0x1a9)])-parseInt(_0x4b5d41['return_qty']));});}),await _0x45ba9b[_0x388c68(0x121)]();var _0x4b3c10=0x0;_0x4f9ae0[_0x388c68(0x1c5)](_0x2b0bb3=>{var _0x208fe5=_0x388c68;(parseInt(_0x2b0bb3[_0x208fe5(0x156)])<parseInt(_0x2b0bb3[_0x208fe5(0x1a1)])||parseInt(_0x2b0bb3[_0x208fe5(0x202)])<parseInt(_0x2b0bb3[_0x208fe5(0x1a1)]))&&_0x4b3c10++;});if(_0x4b3c10!=0x0)return _0x239ebb[_0x388c68(0x114)](_0x388c68(0x142),_0x388c68(0x1a6)),_0x40d64e[_0x388c68(0x1d9)](_0x388c68(0x1d2));const _0x227b66=new purchases_return_finished({'invoice':_0x29fa3d,'suppliers':_0x239ebb['body'][_0x388c68(0x1d1)],'date':_0x20fbd8,'warehouse_name':_0x155380,'return_product':_0x4f9ae0,'note':_0x31538d,'room':_0x3aada5,'to_warehouse_name':_0x279c2e,'to_room':_0x400c91}),_0x340f0c=await _0x227b66[_0x388c68(0x121)](),_0x3e17a3=await purchases_return_finished[_0x388c68(0x1d3)]({'invoice':_0x29fa3d}),_0x52e843=await warehouse[_0x388c68(0x1d3)]({'name':_0x279c2e,'room':_0x400c91,'warehouse_category':_0x388c68(0x20c)});_0x3e17a3[_0x388c68(0x1ed)]['forEach'](_0x1b27fe=>{var _0x42b4c1=_0x388c68,_0x2f4f88=0x0;const _0x55a89e=_0x52e843[_0x42b4c1(0x115)][_0x42b4c1(0x20a)](_0x2b8549=>{var _0x7de991=_0x42b4c1;console[_0x7de991(0x18e)](_0x2b8549[_0x7de991(0x1aa)]+'=='+_0x1b27fe[_0x7de991(0x1aa)]+'&&'+_0x2b8549[_0x7de991(0x12e)]+'=='+_0x1b27fe[_0x7de991(0x12e)]),_0x2b8549[_0x7de991(0x1aa)]==_0x1b27fe[_0x7de991(0x1aa)]&&_0x2b8549['bay']==_0x1b27fe[_0x7de991(0x12e)]&&(_0x2b8549[_0x7de991(0x1a9)]=parseInt(_0x2b8549['product_stock'])-parseInt(_0x1b27fe[_0x7de991(0x1a1)]),_0x2f4f88++);});_0x2f4f88=='0'&&(_0x52e843[_0x42b4c1(0x115)]=_0x52e843[_0x42b4c1(0x115)][_0x42b4c1(0x200)]({'product_name':_0x1b27fe[_0x42b4c1(0x1aa)],'product_stock':_0x1b27fe[_0x42b4c1(0x1a1)],'primary_code':_0x1b27fe[_0x42b4c1(0x12b)],'secondary_code':_0x1b27fe['secondary_code'],'product_code':_0x1b27fe[_0x42b4c1(0x207)],'bay':_0x1b27fe[_0x42b4c1(0x12e)],'maxProducts':0xf423f}));}),await _0x52e843[_0x388c68(0x121)]();const _0x31d776=await purchases_finished[_0x388c68(0x1d3)]({'invoice':_0x29fa3d});_0x31d776[_0x388c68(0x1cb)]=_0x388c68(0x1f4);const _0x17a35b=await _0x31d776[_0x388c68(0x121)](),_0x5a86f0=new s_payment_data({'invoice':_0x29fa3d,'suppliers':_0x239ebb[_0x388c68(0x1bc)][_0x388c68(0x1d1)],'reason':_0x388c68(0x1fe)});await _0x5a86f0[_0x388c68(0x121)]();const _0x2168c3=await master_shop[_0x388c68(0x1b6)](),_0x5c4588=await email_settings[_0x388c68(0x1d3)](),_0x3f10d5=await suppliers[_0x388c68(0x1d3)]({'name':_0x239ebb[_0x388c68(0x1bc)]['suppliers']});_0x2168c3[0x0][_0x388c68(0x155)]==0x1?(right_currency=_0x2168c3[0x0][_0x388c68(0x122)],left_currency=''):(right_currency='',left_currency=_0x2168c3[0x0][_0x388c68(0x122)]);var _0x11903b=_0x127fe9,_0x2c5212=_0x1b55ec,_0x5f04e3='',_0x5a49fd;for(_0x5a49fd in _0x11903b){_0x5f04e3+=_0x388c68(0x1a8)+_0x388c68(0x11b)+_0x11903b[_0x5a49fd]+'</td>'+_0x388c68(0x11b)+_0x2c5212[_0x5a49fd]+_0x388c68(0x171)+'</tr>';}let _0x4f82aa=nodemailer[_0x388c68(0x16b)]({'service':_0x388c68(0x166),'auth':{'user':_0x5c4588['email'],'pass':_0x5c4588[_0x388c68(0x16a)]}}),_0x56a204={'from':_0x5c4588[_0x388c68(0x16c)],'to':_0x3f10d5[_0x388c68(0x16c)],'subject':_0x388c68(0x1eb),'attachments':[{'filename':_0x388c68(0x12a),'path':__dirname+_0x388c68(0x167)+_0x388c68(0x1b2)+_0x2168c3[0x0][_0x388c68(0x1e6)],'cid':_0x388c68(0x18b)}],'html':_0x388c68(0x15d)+_0x388c68(0x1f2)+_0x388c68(0x185)+'<div>'+_0x388c68(0x1fc)+'<div>'+_0x388c68(0x13a)+_0x388c68(0x179)+_0x388c68(0x1a5)+_0x388c68(0x172)+_0x2168c3[0x0]['site_title']+_0x388c68(0x1ef)+_0x388c68(0x179)+_0x388c68(0x179)+_0x388c68(0x124)+_0x388c68(0x1a5)+_0x388c68(0x146)+_0x388c68(0x145)+_0x29fa3d+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x388c68(0x1e8)+_0x20fbd8+'\x20'+_0x388c68(0x1ca)+_0x388c68(0x191)+_0x388c68(0x179)+_0x388c68(0x110)+_0x388c68(0x148)+_0x388c68(0x1a8)+_0x388c68(0x1c9)+_0x388c68(0x195)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x388c68(0x1ce)+'</thead>'+_0x388c68(0x11c)+'\x20'+_0x5f04e3+'\x20'+_0x388c68(0x18c)+_0x388c68(0x1ec)+_0x388c68(0x1a5)+_0x388c68(0x1df)+_0x388c68(0x194)+_0x2168c3[0x0]['site_title']+_0x388c68(0x191)+'</div>'+'</div>'+_0x388c68(0x16f)};_0x4f82aa['sendMail'](_0x56a204,function(_0x1b90f0,_0x1410cf){var _0x22da36=_0x388c68;_0x1b90f0?console[_0x22da36(0x18e)](_0x22da36(0x158)):console[_0x22da36(0x18e)](_0x22da36(0x1b0));}),_0x239ebb[_0x388c68(0x114)]('success',_0x388c68(0x1d4)),_0x40d64e[_0x388c68(0x1d9)](_0x388c68(0x126));}catch(_0x37aecb){_0x40d64e['status'](0xc8)['json']({'message':_0x37aecb[_0x388c68(0x147)]});}}),router[a0_0x27a03e(0x20f)](a0_0x27a03e(0x18a),auth,async(_0x5e2299,_0x398bbd)=>{var _0x32cc08=a0_0x27a03e;try{const {username:_0x5a5a29,email:_0xb9dfa8,role:_0x4e80cf}=_0x5e2299[_0x32cc08(0x163)],_0x38ffad=_0x5e2299[_0x32cc08(0x163)],_0x27574e=await profile['findOne']({'email':_0x38ffad['email']}),_0x59a8b5=await master_shop['find'](),_0x578445=_0x5e2299[_0x32cc08(0x169)]['id'],_0x5beaa8=await purchases_finished[_0x32cc08(0x184)](_0x578445);if(_0x59a8b5[0x0][_0x32cc08(0x188)]=='English\x20(US)')var _0x5c6df7=users[_0x32cc08(0x1af)];else{if(_0x59a8b5[0x0]['language']=='Hindi')var _0x5c6df7=users['Hindi'];else{if(_0x59a8b5[0x0][_0x32cc08(0x188)]==_0x32cc08(0x212))var _0x5c6df7=users[_0x32cc08(0x212)];else{if(_0x59a8b5[0x0]['language']==_0x32cc08(0x1b5))var _0x5c6df7=users[_0x32cc08(0x1b5)];else{if(_0x59a8b5[0x0][_0x32cc08(0x188)]==_0x32cc08(0x1e2))var _0x5c6df7=users['French'];else{if(_0x59a8b5[0x0][_0x32cc08(0x188)]==_0x32cc08(0x181))var _0x5c6df7=users[_0x32cc08(0x17f)];else{if(_0x59a8b5[0x0][_0x32cc08(0x188)]==_0x32cc08(0x178))var _0x5c6df7=users[_0x32cc08(0x178)];else{if(_0x59a8b5[0x0]['language']==_0x32cc08(0x1fa))var _0x5c6df7=users[_0x32cc08(0x170)];}}}}}}}_0x398bbd[_0x32cc08(0x136)]('all_purchases_barcode',{'success':_0x5e2299[_0x32cc08(0x114)](_0x32cc08(0x152)),'errors':_0x5e2299[_0x32cc08(0x114)](_0x32cc08(0x142)),'role':_0x38ffad,'profile':_0x27574e,'alldata':_0x5beaa8,'master_shop':_0x59a8b5,'language':_0x5c6df7}),console[_0x32cc08(0x18e)](alldata);}catch(_0x321a55){console['log'](_0x321a55);}}),router['post'](a0_0x27a03e(0x1da),async(_0x40e385,_0x3352a9)=>{var _0x2d775a=a0_0x27a03e;const {product_code:_0x3a1118}=_0x40e385[_0x2d775a(0x1bc)];var _0x5b215f;const _0x363a90=await product[_0x2d775a(0x1ae)]([{'$match':{'primary_code':_0x3a1118,'product_category':_0x2d775a(0x20c)}},{'$group':{'_id':_0x2d775a(0x1a2),'name':{'$first':'$name'},'category':{'$first':_0x2d775a(0x13e)},'brand':{'$first':_0x2d775a(0x17b)},'unit':{'$first':_0x2d775a(0x1c1)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x2d775a(0x137)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x2d775a(0x1b1)},'maxProdPerUnit':{'$first':_0x2d775a(0x1e4)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x23702f=await product[_0x2d775a(0x1ae)]([{'$match':{'secondary_code':_0x3a1118}},{'$group':{'_id':_0x2d775a(0x1a2),'name':{'$first':_0x2d775a(0x1dc)},'category':{'$first':_0x2d775a(0x13e)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x2d775a(0x1ab)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x2d775a(0x11a)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x2d775a(0x1b1)},'maxProdPerUnit':{'$first':_0x2d775a(0x1e4)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2d775a(0x14b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x363a90['length']>0x0)_0x5b215f=_0x363a90;else _0x23702f['length']>0x0&&(_0x5b215f=_0x23702f);_0x3352a9[_0x2d775a(0x164)](_0x5b215f);}),router[a0_0x27a03e(0x1ba)](a0_0x27a03e(0x1f7),async(_0x342df2,_0x15c74c)=>{var _0x5239f6=a0_0x27a03e;const {productCode:_0x9ad143,bay:_0x3215c6,warehouses:_0x390c84,room:_0x10b890}=_0x342df2[_0x5239f6(0x1bc)];console[_0x5239f6(0x18e)](_0x342df2[_0x5239f6(0x1bc)]);try{const _0x4c6cac=await warehouse['aggregate']([{'$match':{'name':_0x390c84,'room':_0x10b890}},{'$unwind':_0x5239f6(0x14e)},{'$match':{'product_details.bay':parseInt(_0x3215c6)}},{'$group':{'_id':_0x5239f6(0x204),'name':{'$first':_0x5239f6(0x183)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5239f6(0x119)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x15c74c['status'](0xc8)['json'](_0x4c6cac);}catch(_0x1792f6){_0x15c74c[_0x5239f6(0x1d0)](0x194)[_0x5239f6(0x164)]({'message':_0x1792f6[_0x5239f6(0x147)]});}}),module[a0_0x27a03e(0x127)]=router;function a0_0x4497(){var _0x21b88f=['<h5\x20style=\x22text-align:\x20left;\x22>','message','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','prod_Qty','$product_details.bin','$secondary_unit','getMonth','prod_level','$product_details','$product_details.storage','add_purchases\x20error','payment\x20successfull','success','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','currency_placement','purchase_quantity','length','Error\x20Occurs','$product','QA\x20Warehouse','return_purchase_finished','primary_code_hide','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','</thead>','padStart','prod_code','ejs','user','json','filter','gmail','/../public','secondary_code','params','password','createTransport','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','../models/all_models','</body></html>','Arabic','</td>','<h2>\x20','$date','prod_name','role','$product.quantity','quantity','Chinese','</div>','purchase\x20data\x20add\x20successfully','$brand','product_date','then','8862LdhJtG','Portuguese','INCF-','Portuguese\x20(BR)','due_amount','$product_details.product_name','findById','</head><body>','date','Paid\x20For\x20Purchase','language','all','/barcode/:id','logo','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','log','warehouse_name','Room_name','</h5>','path','level','<h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','prod_qty','Rack\x201','$product.bin','abs','There\x27s\x20a\x20error\x20in\x20this\x20transaction','getDate','purchase\x20data\x20update\x20successfully','232446essNBf','name','string','getFullYear','return_qty','$_id','max_product_unit','$product_details.rack','<div>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','/view/return_purchase/:id','<tr>','product_stock','product_name','$alertquantity','all_purchases_finished','random','aggregate','English','Email\x20sent\x20successfully','$maxStocks','/upload/','prod_secondunit','$batch_code','Spanish','find','$expiry_date','room','room_name','post','maxperunit','body','<span\x20style=\x22float:\x20right;\x22>','$product.floorlevel','note','$paid_amount','$unit','MaxStocks_data','$product.type','RoomAssign','forEach','site_title','$due_amount','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</span>','return_data','prod_cat','purchase_invoice','</tr>','/view/add_purchases/:id','status','suppliers','back','findOne','purchases\x20item\x20return\x20successfull','staff','port','/invoice/:id','toString','redirect','/barcode_scanner','production_date','$name','express','1812ZPILvI','<strong>\x20Regards\x20</strong>','$product.bay','$product_details.product_code','French','FGSEmail','$maxProdPerUnit','batch_code','image','711676lsGseC','\x20Order\x20Date\x20:\x20','$warehouse_name','updateOne','Purchase\x20Return\x20Mail','</table>','return_product','amount','\x20</h2>','$return_data','$suppliers_docs','<html><head><title></title>','maxStocks','True','English\x20(US)','table\x20page','/CheckingWarehouse','warehouse','$product_details.floorlevel','Arabic\x20(ae)','18pajXFk','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','../middleware/auth','Purchase\x20Return','Enclosed','concat','user_id','stock_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details._id','standard_unit','/preview/:id','product_code','master','$note','map','415YblMoc','Finished\x20Goods','paid_amount','/view','get','Purchase\x20Mail','stocks','German','<table\x20style=\x22width:\x20100%\x20!important;\x22>','6791128FIPTPD','1313150IUVCwP','sendMail','flash','product_details','$product_details.secondary_code','suppliers_docs','JO_number','$product_details.bay','$primary_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','Return\x20Goods','secondary_unit','prod_unit','Error\x20occurred\x20while\x20processing\x20product:','save','currency','product_cat','<hr\x20class=\x22my-3\x22>','Enabled','/all_purchases_finished/view','exports','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Hindi','Logo.png','primary_code','DRY\x20GOODS','host','bay','invoice','$suppliers','slice','$invoice','/all_purchases/view','/give_payment/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','render','$product_code','Rack\x202','product_code_hide','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','4279079OABpqz','expiry_date','error','$category','prod_invoice','2122KusDOw','catch','errors','prod_primunit','$room','\x20Order\x20Number\x20:\x20'];a0_0x4497=function(){return _0x21b88f;};return a0_0x4497();}