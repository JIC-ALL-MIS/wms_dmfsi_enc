var a0_0x2accef=a0_0x3662;(function(_0x3242d3,_0x576a14){var _0x33845b=a0_0x3662,_0x201168=_0x3242d3();while(!![]){try{var _0x143034=parseInt(_0x33845b(0x78))/0x1+-parseInt(_0x33845b(0x152))/0x2+parseInt(_0x33845b(0x12e))/0x3*(-parseInt(_0x33845b(0x13f))/0x4)+parseInt(_0x33845b(0xc7))/0x5+parseInt(_0x33845b(0xf5))/0x6+parseInt(_0x33845b(0xc4))/0x7*(-parseInt(_0x33845b(0x13c))/0x8)+parseInt(_0x33845b(0xc9))/0x9*(parseInt(_0x33845b(0x125))/0xa);if(_0x143034===_0x576a14)break;else _0x201168['push'](_0x201168['shift']());}catch(_0x263cca){_0x201168['push'](_0x201168['shift']());}}}(a0_0x4010,0xb7fb9));const express=require(a0_0x2accef(0x84)),app=express(),router=express[a0_0x2accef(0x8b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x2accef(0x118)),auth=require(a0_0x2accef(0x120)),nodemailer=require(a0_0x2accef(0xc1));var ejs=require('ejs');function a0_0x4010(){var _0x292cd4=['\x20Order\x20Date\x20:\x20','QA\x20Warehouse','</table>','Ambient','findById','exports','$product_details.bin','getMonth','user','$product_details.product_code','prod_unit','product_date','Error\x20Occurs','error','</head><body>','$product','prod_primunit','render','suppliers_docs','</span>','Rack\x201','$secondary_unit','Room_name','Arabic\x20(ae)','</tbody>','expiry_date','findOne','quantity','<span\x20style=\x22float:\x20right;\x22>','stock_quantity','$suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.maxProducts','../models/all_models','/invoice/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','../public/language/languages.json','$invoice','INCF-','image','staff','../middleware/auth','map','/give_payment/:id','</body></html>','body','13708480wGCBMk','An\x20error\x20occurred\x20while\x20saving\x20data.','getFullYear','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','True','</div>','$warehouse_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','3gljZXc','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','stocks','floor','$product_details.type','purchase_quantity','$product.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$batch_code','/view/return_purchase/:id','language','/all_purchases_finished/view','secondary_unit','Logo.png','24lXXrBL','$product_details.primary_code','catch','4829404cVVvox','user_id','json','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','aggregate','product_code_hide','save','getDate','Hindi','prod_code','prod_secondunit','primary_code','product_details','Arabic','<h2>\x20','host','all_purchases_finished','</td>','$product_details.product_stock','2035414Vpdcfi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','add_purchases_finished','warehouse_name','</thead>','name','gmail','product','$return_data','<tbody\x20style=\x22text-align:\x20center;\x22>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','note','$suppliers','edit_purchases_finished_view','/view/add_purchases/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','currency_placement','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','filter','product_cat','$name','$product_details.secondary_code','add_purchases\x20error','back','suppliers','purchase_invoice','prod_qty','$date','prod_cat','logo','1221069lXhqBH','Purchase\x20Mail','/all_purchases/view','payment\x20successfull','slice','errors','currency','maxStocks','length','POnumber','Chinese','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','express','</tr>','/barcode_scanner','Email\x20sent\x20successfully','French','$primary_code','then','Router','JO_number','warehouse','$product_details.storage','room_name','success','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Purchase\x20Return\x20Mail','abs','message','product_code','/view/add_purchases','standard_unit','flash','$product_details','padStart','</h5>','amount','$product_details._id','$unit','\x20Order\x20Number\x20:\x20','<table\x20style=\x22width:\x20100%\x20!important;\x22>','bay','due_amount','get','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/upload/','$product_details.product_name','<div>','secondary_code','$expiry_date','invoice','master','$room','<tr>','/../public','level','$paid_amount','role','English\x20(US)','/view/:id','log','Portuguese\x20(BR)','<!DOCTYPE\x20html>','\x20</h2>','table\x20page','password','/CheckingWarehouse','RoomAssign','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$note','German','$category','nodemailer','batch_code','secondary_code_hide','3149657Asyqko','$maxStocks','site_title','4940800zIRzOf','Finished\x20Goods','9mlnPQd','params','$product.type','paid_amount','date','redirect','$product_details.rack','primary_code_hide','find','FGSEmail','sendMail','_id','concat','<h5>','email','English','status','product_name','random','room','$product.floorlevel','$_id','$brand','prod_Qty','/view','return_qty','forEach','max_product_unit','/preview/:id','$product.bay','$alertquantity','return_purchase_finished','Enabled','prod_level','<html><head><title></title>','post','prod_name','product_stock','Portuguese','MaxStocks_data','<hr\x20class=\x22my-3\x22>','$product.quantity','string','<strong>\x20Regards\x20</strong>','4490562Ctoune','Rack\x202'];a0_0x4010=function(){return _0x292cd4;};return a0_0x4010();}const path=require('path'),users=require(a0_0x2accef(0x11b));router[a0_0x2accef(0xa4)](a0_0x2accef(0xe1),auth,async(_0x21e58d,_0x33a660)=>{var _0x49a391=a0_0x2accef;try{const {username:_0x116492,email:_0x492685,role:_0x5b9489}=_0x21e58d[_0x49a391(0xff)],_0x39305f=_0x21e58d['user'],_0x341d29=await profile[_0x49a391(0x111)]({'email':_0x39305f[_0x49a391(0xd7)]}),_0xb0c9a3=await staff[_0x49a391(0x111)]({'email':_0x39305f[_0x49a391(0xd7)]});if(_0x39305f[_0x49a391(0xb2)]=='staff'){const _0x1707a8=await staff['findOne']({'email':_0x39305f[_0x49a391(0xd7)]});}const _0x4166df=await master_shop['find']();let _0x2b0fbd;if(_0x39305f['role']==_0x49a391(0x11f)){const _0x414e21=await staff[_0x49a391(0x111)]({'email':_0x39305f[_0x49a391(0xd7)]});_0x2b0fbd=await purchases_finished[_0x49a391(0x143)]([{'$match':{'warehouse_name':_0x414e21['warehouse']}},{'$lookup':{'from':_0x49a391(0x72),'localField':_0x49a391(0x72),'foreignField':_0x49a391(0x157),'as':_0x49a391(0x109)}},{'$unwind':_0x49a391(0x115)},{'$unwind':_0x49a391(0x106)},{'$group':{'_id':_0x49a391(0xde),'invoice':{'$first':_0x49a391(0x11c)},'suppliers':{'$first':_0x49a391(0x15e)},'date':{'$first':_0x49a391(0x75)},'warehouse_name':{'$first':_0x49a391(0x12c)},'room':{'$first':_0x49a391(0xad)},'product':{'$push':_0x49a391(0x106)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x49a391(0xb1)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x49a391(0xaa)},'suppliers_docs':{'$first':_0x49a391(0x115)},'total_product_quantity':{'$sum':_0x49a391(0xf2)},'level':{'$addToSet':_0x49a391(0xe6)},'isle':{'$addToSet':_0x49a391(0x134)},'type':{'$addToSet':_0x49a391(0xcb)},'floorlevel':{'$addToSet':_0x49a391(0xdd)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2b0fbd=await purchases_finished[_0x49a391(0x143)]([{'$unwind':_0x49a391(0x106)},{'$group':{'_id':'$_id','invoice':{'$first':_0x49a391(0x11c)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x49a391(0x75)},'warehouse_name':{'$first':_0x49a391(0x12c)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x49a391(0xbe)},'paid_amount':{'$first':_0x49a391(0xb1)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x49a391(0x15a)},'batch_code':{'$first':_0x49a391(0x136)},'expiry_date':{'$first':_0x49a391(0xaa)},'suppliers_docs':{'$first':_0x49a391(0x115)},'total_product_quantity':{'$sum':_0x49a391(0xf2)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x49a391(0x134)},'type':{'$addToSet':_0x49a391(0xcb)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x4166df[0x0][_0x49a391(0x138)]==_0x49a391(0xb3))var _0x452cb7=users[_0x49a391(0xd8)];else{if(_0x4166df[0x0][_0x49a391(0x138)]==_0x49a391(0x147))var _0x452cb7=users[_0x49a391(0x147)];else{if(_0x4166df[0x0][_0x49a391(0x138)]==_0x49a391(0xbf))var _0x452cb7=users[_0x49a391(0xbf)];else{if(_0x4166df[0x0][_0x49a391(0x138)]==_0x49a391(0x91))var _0x452cb7=users['Spanish'];else{if(_0x4166df[0x0][_0x49a391(0x138)]=='French')var _0x452cb7=users[_0x49a391(0x88)];else{if(_0x4166df[0x0][_0x49a391(0x138)]==_0x49a391(0xb6))var _0x452cb7=users[_0x49a391(0xef)];else{if(_0x4166df[0x0][_0x49a391(0x138)]=='Chinese')var _0x452cb7=users[_0x49a391(0x82)];else{if(_0x4166df[0x0]['language']==_0x49a391(0x10e))var _0x452cb7=users[_0x49a391(0x14c)];}}}}}}}_0x33a660['render'](_0x49a391(0x14f),{'success':_0x21e58d[_0x49a391(0x99)](_0x49a391(0x90)),'errors':_0x21e58d['flash'](_0x49a391(0x7d)),'purchases':_0x2b0fbd,'role':_0x39305f,'profile':_0x341d29,'master_shop':_0x4166df,'language':_0x452cb7});}catch(_0x24e33b){console[_0x49a391(0xb5)](_0x49a391(0xb9),_0x24e33b),_0x33a660['status'](0xc8)[_0x49a391(0x141)]({'message':_0x24e33b[_0x49a391(0x95)]});}});function a0_0x3662(_0x2db5d3,_0x292c35){var _0x40100a=a0_0x4010();return a0_0x3662=function(_0x36620d,_0x5d7f18){_0x36620d=_0x36620d-0x6f;var _0x58a0f2=_0x40100a[_0x36620d];return _0x58a0f2;},a0_0x3662(_0x2db5d3,_0x292c35);}function BayBinSelected(_0x4d1ebc,_0x1e48db){var _0x1260ad=a0_0x2accef,_0x50ce19=[],_0x16d73c=[];if(_0x4d1ebc=='DRY\x20GOODS'){switch(_0x1e48db){case _0x1260ad(0x10b):_0x50ce19=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1260ad(0xf6):_0x50ce19=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x16d73c=['DG'];}else{if(_0x4d1ebc=='FROZEN\x20GOODS'){switch(_0x1e48db){case _0x1260ad(0x10b):_0x50ce19=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1260ad(0xf6):_0x50ce19=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x16d73c=['FG'];}}return{'levels':_0x50ce19,'identify':_0x16d73c};}async function getRandom8DigitNumber(){var _0x3b9ffc=a0_0x2accef;const _0x120754=0x989680,_0x4328bc=0x5f5e0ff,_0x175f86=Math[_0x3b9ffc(0x131)](Math[_0x3b9ffc(0xdb)]()*(_0x4328bc-_0x120754+0x1))+_0x120754;var _0xb26498;const _0x39eb66=await purchases_finished[_0x3b9ffc(0x111)]({'invoice':_0x3b9ffc(0x11d)+_0x175f86});return _0x39eb66&&_0x39eb66[_0x3b9ffc(0x80)]>0x0?_0xb26498=_0x3b9ffc(0x11d)+_0x175f86:_0xb26498=_0x3b9ffc(0x11d)+_0x175f86,_0xb26498;}router[a0_0x2accef(0xa4)](a0_0x2accef(0x97),auth,async(_0x990298,_0x4a8fdc)=>{var _0x14164a=a0_0x2accef;try{const {username:_0x125e37,email:_0x5733e2,role:_0x9bd9c2}=_0x990298[_0x14164a(0xff)],_0x2a4fdf=_0x990298[_0x14164a(0xff)],_0x2c1240=await profile[_0x14164a(0x111)]({'email':_0x2a4fdf[_0x14164a(0xd7)]}),_0x319d90=await master_shop[_0x14164a(0xd1)](),_0x106e20=await staff[_0x14164a(0x111)]({'email':_0x2a4fdf[_0x14164a(0xd7)]}),_0x3457f0=await suppliers[_0x14164a(0xd1)]({});let _0x5e8a8d;if(_0x2a4fdf['role']==_0x14164a(0x11f)){const _0x50a787=await staff['findOne']({'email':_0x2a4fdf[_0x14164a(0xd7)]});_0x5e8a8d=await warehouse[_0x14164a(0x143)]([{'$match':{'status':_0x14164a(0xe9),'name':_0x50a787[_0x14164a(0x8d)],'warehouse_category':_0x14164a(0xc8)}},{'$group':{'_id':_0x14164a(0x166),'name':{'$first':_0x14164a(0x166)}}}]);}else _0x5e8a8d=await warehouse[_0x14164a(0x143)]([{'$match':{'status':_0x14164a(0xe9),'warehouse_category':_0x14164a(0xc8),'name':{'$ne':_0x14164a(0xf8)}}},{'$group':{'_id':'$name','name':{'$first':_0x14164a(0x166)}}}]);const _0x341d7d=await product[_0x14164a(0xd1)]({}),_0x264d35=await warehouse[_0x14164a(0xd1)]({'status':_0x14164a(0xe9)}),_0x467aaf=await purchases_finished[_0x14164a(0xd1)]({}),_0x530b37=_0x467aaf['length']+0x1,_0x16da6b='INCF-'+_0x530b37['toString']()[_0x14164a(0x9b)](0x5,'0');var _0x102ff1=[_0x14164a(0xfa),'Enclosed'];if(_0x319d90[0x0][_0x14164a(0x138)]==_0x14164a(0xb3))var _0x349644=users[_0x14164a(0xd8)];else{if(_0x319d90[0x0][_0x14164a(0x138)]==_0x14164a(0x147))var _0x349644=users[_0x14164a(0x147)];else{if(_0x319d90[0x0][_0x14164a(0x138)]==_0x14164a(0xbf))var _0x349644=users[_0x14164a(0xbf)];else{if(_0x319d90[0x0]['language']=='Spanish')var _0x349644=users[_0x14164a(0x91)];else{if(_0x319d90[0x0][_0x14164a(0x138)]==_0x14164a(0x88))var _0x349644=users[_0x14164a(0x88)];else{if(_0x319d90[0x0][_0x14164a(0x138)]==_0x14164a(0xb6))var _0x349644=users[_0x14164a(0xef)];else{if(_0x319d90[0x0][_0x14164a(0x138)]==_0x14164a(0x82))var _0x349644=users[_0x14164a(0x82)];else{if(_0x319d90[0x0][_0x14164a(0x138)]==_0x14164a(0x10e))var _0x349644=users[_0x14164a(0x14c)];}}}}}}}const _0x544ada=getRandom8DigitNumber();_0x544ada[_0x14164a(0x8a)](_0x1d2a4e=>{var _0x4a868b=_0x14164a;_0x4a8fdc[_0x4a868b(0x108)](_0x4a868b(0x154),{'success':_0x990298['flash'](_0x4a868b(0x90)),'errors':_0x990298[_0x4a868b(0x99)]('errors'),'role':_0x2a4fdf,'profile':_0x2c1240,'suppliers':_0x3457f0,'warehouse':_0x5e8a8d,'product':_0x341d7d,'invoice':_0x1d2a4e,'master_shop':_0x319d90,'language':_0x349644,'find_data':_0x264d35,'rooms_data':_0x102ff1});})['catch'](_0xd91113=>{var _0x5667ac=_0x14164a;_0x990298[_0x5667ac(0x99)](_0x5667ac(0x7d),_0x5667ac(0x12d)),_0x4a8fdc['redirect'](_0x5667ac(0x139));});}catch(_0x2cf466){console['log'](_0x2cf466);}}),router[a0_0x2accef(0xa4)](a0_0x2accef(0x160),auth,async(_0x1f97dc,_0x38d0f7)=>{var _0x126bb2=a0_0x2accef;try{const _0x2036a8=_0x1f97dc[_0x126bb2(0xca)]['id'];console[_0x126bb2(0xb5)](_0x2036a8);const _0x104fd3=await master_shop[_0x126bb2(0xd1)]();console[_0x126bb2(0xb5)](_0x126bb2(0xac),_0x104fd3);const _0x1eb4f1=await product[_0x126bb2(0x111)]({'name':_0x2036a8});console['log'](_0x126bb2(0x159),_0x1eb4f1),_0x38d0f7[_0x126bb2(0xd9)](0xc8)[_0x126bb2(0x141)]({'product_data':_0x1eb4f1,'master':_0x104fd3});}catch(_0x4d729c){console[_0x126bb2(0xb5)](_0x126bb2(0x70),_0x4d729c);}}),router[a0_0x2accef(0xec)](a0_0x2accef(0x97),auth,async(_0x10c48f,_0x245ebe)=>{var _0x1c52f8=a0_0x2accef;try{const {invoice:_0x17e385,date:_0x575172,warehouse_name:_0x1e57f9,prod_name:_0x504e63,prod_code:_0x2ff94e,prod_qty:_0x40373c,prod_unit:_0x4fe028,prod_secondunit:_0xd7d824,prod_level:_0x3829d5,prod_isle:_0xd050c0,prod_pallet:_0x40dc38,note:_0x409e82,expiry_date:_0x3ecb8a,batch_code:_0x403492,payable:_0x386c2e,due_amount:_0x32b85d,Room_name:_0xb1cf4f,primary_code:_0x3a4f7f,secondary_code:_0x2ba1a3,MaxStocks_data:_0xe1a8c6,PO_number:_0x1b0a92,SCRN:_0x3edf79,JO_number:_0x597a89}=_0x10c48f[_0x1c52f8(0x124)];if(typeof _0x504e63==_0x1c52f8(0xf3))var _0x4a1b00=[_0x10c48f[_0x1c52f8(0x124)]['prod_name']],_0x2aa8e0=[_0x10c48f['body'][_0x1c52f8(0x148)]],_0x5c7bc1=[_0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0xe0)]],_0x5b3e7a=[_0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0x107)]],_0x40725a=[_0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0x149)]],_0x44c279=[_0x10c48f['body']['prod_level']],_0x130571=[_0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0x14a)]],_0x33b973=[_0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0xa9)]],_0x2e3d76=[_0x10c48f['body']['MaxStocks_data']],_0x54b4dd=[_0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0xc2)]],_0xffc770=[_0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0x110)]],_0x4a3c59=[_0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0x102)]],_0x535de0=[_0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0xe4)]],_0x235d17=[_0x10c48f['body'][_0x1c52f8(0x76)]],_0x5c9d8b=[_0x10c48f['body'][_0x1c52f8(0xbc)]],_0x482623=[_0x10c48f[_0x1c52f8(0x124)]['prod_invoice']];else var _0x4a1b00=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0xed)]],_0x2aa8e0=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0x148)]],_0x5c7bc1=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0xe0)]],_0x5b3e7a=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0x107)]],_0x40725a=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0x149)]],_0x44c279=[..._0x10c48f['body'][_0x1c52f8(0xea)]],_0x130571=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0x14a)]],_0x33b973=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0xa9)]],_0x2e3d76=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0xf0)]],_0x54b4dd=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0xc2)]],_0xffc770=[..._0x10c48f[_0x1c52f8(0x124)]['expiry_date']],_0x4a3c59=[..._0x10c48f['body']['product_date']],_0x535de0=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0xe4)]],_0x235d17=[..._0x10c48f[_0x1c52f8(0x124)][_0x1c52f8(0x76)]],_0x5c9d8b=[..._0x10c48f['body'][_0x1c52f8(0xbc)]],_0x482623=[..._0x10c48f[_0x1c52f8(0x124)]['prod_invoice']];const _0x65579c=_0x4a1b00['map'](_0x2c3319=>{return _0x2c3319={'product_name':_0x2c3319};});_0x2aa8e0[_0x1c52f8(0xe3)]((_0x28569b,_0x4c1f9f)=>{var _0x18b631=_0x1c52f8;_0x65579c[_0x4c1f9f][_0x18b631(0x96)]=_0x28569b;}),_0x5c7bc1[_0x1c52f8(0xe3)]((_0x5975c6,_0x333e38)=>{var _0x3a6f51=_0x1c52f8;_0x65579c[_0x333e38][_0x3a6f51(0x112)]=Math[_0x3a6f51(0x94)](_0x5975c6);}),_0x5b3e7a[_0x1c52f8(0xe3)]((_0xf2df7d,_0x4bf92e)=>{var _0x398f7a=_0x1c52f8;_0x65579c[_0x4bf92e][_0x398f7a(0x98)]=_0xf2df7d;}),_0x40725a['forEach']((_0xc20cc4,_0x3ad342)=>{_0x65579c[_0x3ad342]['secondary_unit']=_0xc20cc4;}),_0x44c279[_0x1c52f8(0xe3)]((_0xef0f7e,_0x2041cf)=>{var _0x3275ec=_0x1c52f8;_0x65579c[_0x2041cf][_0x3275ec(0xa2)]=_0xef0f7e;}),_0x130571[_0x1c52f8(0xe3)]((_0x9cc513,_0x118406)=>{var _0x391f74=_0x1c52f8;_0x65579c[_0x118406][_0x391f74(0x14a)]=_0x9cc513;}),_0x33b973[_0x1c52f8(0xe3)]((_0x101dda,_0x11f903)=>{var _0x3b9565=_0x1c52f8;_0x65579c[_0x11f903][_0x3b9565(0xa9)]=_0x101dda;}),_0x2e3d76[_0x1c52f8(0xe3)]((_0xc8b3af,_0xf50e6e)=>{var _0x21958b=_0x1c52f8;_0x65579c[_0xf50e6e][_0x21958b(0x7f)]=_0xc8b3af;}),_0x54b4dd['forEach']((_0x3bbc47,_0x5b877c)=>{var _0x143023=_0x1c52f8;_0x65579c[_0x5b877c][_0x143023(0xc2)]=_0x3bbc47;}),_0xffc770[_0x1c52f8(0xe3)]((_0x464b64,_0x1dcce3)=>{var _0x3f5d63=_0x1c52f8;_0x65579c[_0x1dcce3][_0x3f5d63(0x110)]=_0x464b64;}),_0x4a3c59[_0x1c52f8(0xe3)]((_0x5ee596,_0x11b6b5)=>{var _0xcc9171=_0x1c52f8;_0x65579c[_0x11b6b5][_0xcc9171(0x128)]=_0x5ee596;}),_0x535de0[_0x1c52f8(0xe3)]((_0x203c4e,_0x1787eb)=>{_0x65579c[_0x1787eb]['maxperunit']=_0x203c4e;}),_0x235d17[_0x1c52f8(0xe3)]((_0x3b2750,_0x550ab5)=>{var _0x3db1e6=_0x1c52f8;_0x65579c[_0x550ab5][_0x3db1e6(0x165)]=_0x3b2750;}),_0x5c9d8b['forEach']((_0x36d378,_0x1d746f)=>{var _0x59079e=_0x1c52f8;_0x65579c[_0x1d746f][_0x59079e(0x8f)]=_0x36d378;}),_0x482623[_0x1c52f8(0xe3)]((_0x384a8f,_0x490ac9)=>{_0x65579c[_0x490ac9]['invoice']=_0x384a8f;});const _0x14dc07=_0x65579c[_0x1c52f8(0x164)](_0x57813e=>_0x57813e[_0x1c52f8(0x112)]!=='0'&&_0x57813e[_0x1c52f8(0x112)]!==''),_0x9555b3=new purchases_finished({'invoice':_0x17e385,'suppliers':_0x10c48f['body']['suppliers'],'date':_0x575172,'warehouse_name':_0x1e57f9,'product':_0x14dc07,'note':_0x409e82,'due_amount':_0x32b85d,'room':_0xb1cf4f,'POnumber':_0x1b0a92,'SCRN':_0x3edf79,'JO_number':_0x597a89}),_0x416a64=await _0x9555b3[_0x1c52f8(0x145)](),_0x27d81a=await purchases_finished['findOne']({'invoice':_0x17e385}),_0x43490f=_0x27d81a[_0x1c52f8(0x159)]['map'](async _0x4841a6=>{var _0x34f8b6=_0x1c52f8,_0x295ce4=await warehouse[_0x34f8b6(0x111)]({'name':_0x1e57f9,'room':_0x4841a6[_0x34f8b6(0x8f)]}),_0x3a4e00=0x0;const _0x3423cb=_0x295ce4[_0x34f8b6(0x14b)][_0x34f8b6(0x121)](_0x436064=>{var _0x80fe30=_0x34f8b6;console['log'](_0x436064[_0x80fe30(0xda)]+'=='+_0x4841a6[_0x80fe30(0xda)]+'&&'+_0x436064[_0x80fe30(0xa2)]+'=='+_0x4841a6['bay']+'&&'+_0x436064['expiry_date']+'=='+_0x4841a6[_0x80fe30(0x110)]+'&&'+_0x436064[_0x80fe30(0x128)]+'=='+_0x4841a6['production_date']+'&&'+_0x436064[_0x80fe30(0xc2)]+'=='+_0x4841a6['batch_code']+'&&'+_0x436064[_0x80fe30(0xab)]+'=='+_0x27d81a[_0x80fe30(0xab)]),_0x436064[_0x80fe30(0xda)]==_0x4841a6[_0x80fe30(0xda)]&&_0x436064['bay']==_0x4841a6[_0x80fe30(0xa2)]&&_0x436064[_0x80fe30(0x110)]==_0x4841a6[_0x80fe30(0x110)]&&_0x436064[_0x80fe30(0x128)]==_0x4841a6['production_date']&&_0x436064[_0x80fe30(0xc2)]==_0x4841a6[_0x80fe30(0xc2)]&&_0x436064[_0x80fe30(0xab)]==_0x27d81a[_0x80fe30(0xab)]&&(_0x436064[_0x80fe30(0xee)]=Math[_0x80fe30(0x94)](_0x436064[_0x80fe30(0xee)])+Math[_0x80fe30(0x94)](_0x4841a6[_0x80fe30(0x112)]),_0x3a4e00++);});return _0x3a4e00=='0'&&(_0x295ce4[_0x34f8b6(0x14b)]=_0x295ce4[_0x34f8b6(0x14b)][_0x34f8b6(0xd5)]({'product_name':_0x4841a6['product_name'],'product_stock':Math[_0x34f8b6(0x94)](_0x4841a6['quantity']),'primary_code':_0x4841a6[_0x34f8b6(0x14a)],'secondary_code':_0x4841a6[_0x34f8b6(0xa9)],'product_code':_0x4841a6[_0x34f8b6(0x96)],'bay':_0x4841a6['bay'],'maxProducts':_0x4841a6[_0x34f8b6(0x7f)],'unit':_0x4841a6[_0x34f8b6(0x98)],'secondary_unit':_0x4841a6[_0x34f8b6(0x13a)],'expiry_date':_0x4841a6[_0x34f8b6(0x110)],'production_date':_0x4841a6[_0x34f8b6(0x128)],'maxProducts':_0x4841a6[_0x34f8b6(0x7f)],'maxPerUnit':_0x4841a6['maxperunit'],'batch_code':_0x4841a6['batch_code'],'product_cat':_0x4841a6[_0x34f8b6(0x165)],'invoice':_0x4841a6[_0x34f8b6(0xab)]})),_0x295ce4;});Promise['all'](_0x43490f)['then'](async _0x32bef4=>{var _0x155b61=_0x1c52f8;try{for(const _0x24cf71 of _0x32bef4){await warehouse['updateOne']({'_id':_0x24cf71[_0x155b61(0xd4)]},{'$addToSet':{'product_details':{'$each':_0x24cf71[_0x155b61(0x14b)]}}});}const _0xcb8d99=await master_shop['find'](),_0xa8f8d=await email_settings['findOne'](),_0x1ce102=await supervisor_settings['find']();var _0x117c30=_0x27d81a[_0x155b61(0x159)],_0x50682c='',_0x5c23d4;for(_0x5c23d4 in _0x117c30){var _0x32f9e1='FG';_0x27d81a['warehouse_name']=='DRY\x20GOODS'&&(_0x32f9e1='DG'),_0x50682c+=_0x155b61(0xae)+_0x155b61(0x15c)+_0x117c30[_0x5c23d4]['product_name']+_0x155b61(0x150)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x117c30[_0x5c23d4]['product_code']+_0x155b61(0x150)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x117c30[_0x5c23d4][_0x155b61(0x112)]+_0x155b61(0x150)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x117c30[_0x5c23d4][_0x155b61(0x98)]+'</td>'+_0x155b61(0x15c)+_0x117c30[_0x5c23d4][_0x155b61(0x13a)]+_0x155b61(0x150)+_0x155b61(0x15c)+_0x27d81a[_0x155b61(0x155)]+'</td>'+_0x155b61(0x15c)+_0x117c30[_0x5c23d4]['room_name']+'</td>'+_0x155b61(0x15c)+_0x32f9e1+_0x117c30[_0x5c23d4][_0x155b61(0xa2)]+_0x155b61(0x150),'</tr>';}let _0x1c13af=nodemailer['createTransport']({'host':_0xa8f8d[_0x155b61(0x14e)],'port':Number(_0xa8f8d['port']),'secure':![],'auth':{'user':_0xa8f8d[_0x155b61(0xd7)],'pass':_0xa8f8d[_0x155b61(0xba)]}}),_0x42578b={'from':_0xa8f8d[_0x155b61(0xd7)],'to':_0x1ce102[0x0][_0x155b61(0xd2)],'subject':_0x155b61(0x79),'attachments':[{'filename':_0x155b61(0x13b),'path':__dirname+_0x155b61(0xaf)+_0x155b61(0xa6)+_0xcb8d99[0x0][_0x155b61(0x11e)],'cid':_0x155b61(0x77)}],'html':_0x155b61(0xb7)+_0x155b61(0xeb)+_0x155b61(0x105)+_0x155b61(0xa8)+_0x155b61(0x142)+_0x155b61(0xa8)+_0x155b61(0xa5)+_0x155b61(0x12b)+'<div>'+_0x155b61(0x14d)+_0xcb8d99[0x0]['site_title']+_0x155b61(0xb8)+_0x155b61(0x12b)+_0x155b61(0x12b)+_0x155b61(0xf1)+_0x155b61(0xa8)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x155b61(0xa0)+_0x27d81a[_0x155b61(0xab)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x155b61(0xf7)+_0x27d81a[_0x155b61(0xcd)]+'\x20'+_0x155b61(0x10a)+_0x155b61(0x9c)+_0x155b61(0x12b)+_0x155b61(0xa1)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x155b61(0xae)+_0x155b61(0x135)+_0x155b61(0x92)+_0x155b61(0xbd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x155b61(0x12f)+_0x155b61(0x116)+_0x155b61(0x163)+_0x155b61(0x11a)+_0x155b61(0x85)+'</thead>'+_0x155b61(0x15b)+'\x20'+_0x50682c+'\x20'+_0x155b61(0x10f)+_0x155b61(0xf9)+_0x155b61(0xa8)+_0x155b61(0xf4)+_0x155b61(0xd6)+_0xcb8d99[0x0][_0x155b61(0xc6)]+'</h5>'+'</div>'+_0x155b61(0x12b)+'</body></html>'};_0x1c13af['sendMail'](_0x42578b,function(_0x275a2c,_0x44313c){var _0x1512e5=_0x155b61;_0x275a2c?(console[_0x1512e5(0xb5)](_0x275a2c),console[_0x1512e5(0xb5)](_0x1512e5(0x103))):console[_0x1512e5(0xb5)](_0x1512e5(0x87));});}catch(_0xd486cb){console[_0x155b61(0x104)](_0xd486cb),_0x245ebe[_0x155b61(0xd9)](0x1f4)[_0x155b61(0x141)]({'error':_0x155b61(0x126),'message':_0xd486cb['message']});}})[_0x1c52f8(0x13e)](_0x5b7f6a=>{console['error'](_0x5b7f6a),_0x245ebe['status'](0x1f4)['json']({'error':'An\x20error\x20occurred.'});}),_0x10c48f['flash'](_0x1c52f8(0x90),'purchase\x20data\x20add\x20successfully'),_0x245ebe[_0x1c52f8(0xce)](_0x1c52f8(0x139));}catch(_0x1f51b9){console[_0x1c52f8(0xb5)](_0x1f51b9);}}),router[a0_0x2accef(0xa4)](a0_0x2accef(0xe5),auth,async(_0x2987e7,_0x2ed1f0)=>{var _0x3c544e=a0_0x2accef;try{const {username:_0x3867d4,email:_0x308b80,role:_0x269b22}=_0x2987e7[_0x3c544e(0xff)],_0x44311c=_0x2987e7[_0x3c544e(0xff)],_0x5685bf=await profile[_0x3c544e(0x111)]({'email':_0x44311c[_0x3c544e(0xd7)]}),_0x52b4c6=await master_shop[_0x3c544e(0xd1)](),_0x42a618=_0x2987e7['params']['id'],_0x19fb40=await purchases_finished[_0x3c544e(0xfb)](_0x42a618),_0x19f130=await suppliers[_0x3c544e(0xd1)]({});let _0x4a6c17;if(_0x44311c[_0x3c544e(0xb2)]==_0x3c544e(0x11f)){const _0xa7b5ca=await staff[_0x3c544e(0x111)]({'email':_0x44311c[_0x3c544e(0xd7)]});_0x4a6c17=await warehouse[_0x3c544e(0xd1)]({'status':'Enabled','name':_0xa7b5ca[_0x3c544e(0x8d)],'warehouse_category':_0x3c544e(0xc8)});}else _0x4a6c17=await warehouse[_0x3c544e(0x143)]([{'$match':{'status':_0x3c544e(0xe9),'warehouse_category':_0x3c544e(0xc8)}},{'$group':{'_id':_0x3c544e(0x166),'name':{'$first':_0x3c544e(0x166)}}}]);const _0xa5b6c4=await product[_0x3c544e(0xd1)]({}),_0x4fae3f=BayBinSelected(_0x19fb40[_0x3c544e(0x155)],_0x19fb40[_0x3c544e(0xdc)]);let _0x4278de=new Date(_0x19fb40[_0x3c544e(0x110)]),_0x5da0fb=('0'+_0x4278de[_0x3c544e(0x146)]())[_0x3c544e(0x7c)](-0x2),_0x4627b0=('0'+(_0x4278de[_0x3c544e(0xfe)]()+0x1))[_0x3c544e(0x7c)](-0x2),_0x4d5f2b=_0x4278de[_0x3c544e(0x127)](),_0x4202c1=_0x4d5f2b+'-'+_0x4627b0+'-'+_0x5da0fb;if(_0x52b4c6[0x0]['language']==_0x3c544e(0xb3)){var _0x416844=users['English'];console[_0x3c544e(0xb5)](_0x416844);}else{if(_0x52b4c6[0x0][_0x3c544e(0x138)]=='Hindi')var _0x416844=users[_0x3c544e(0x147)];else{if(_0x52b4c6[0x0][_0x3c544e(0x138)]==_0x3c544e(0xbf))var _0x416844=users['German'];else{if(_0x52b4c6[0x0][_0x3c544e(0x138)]==_0x3c544e(0x91))var _0x416844=users[_0x3c544e(0x91)];else{if(_0x52b4c6[0x0]['language']==_0x3c544e(0x88))var _0x416844=users[_0x3c544e(0x88)];else{if(_0x52b4c6[0x0][_0x3c544e(0x138)]==_0x3c544e(0xb6))var _0x416844=users[_0x3c544e(0xef)];else{if(_0x52b4c6[0x0]['language']==_0x3c544e(0x82))var _0x416844=users[_0x3c544e(0x82)];else{if(_0x52b4c6[0x0][_0x3c544e(0x138)]=='Arabic\x20(ae)')var _0x416844=users[_0x3c544e(0x14c)];}}}}}}}_0x2ed1f0[_0x3c544e(0x108)](_0x3c544e(0x15f),{'success':_0x2987e7[_0x3c544e(0x99)]('success'),'errors':_0x2987e7[_0x3c544e(0x99)]('errors'),'role':_0x44311c,'profile':_0x5685bf,'purchases':_0x19fb40,'suppliers':_0x19f130,'warehouse':_0x4a6c17,'product':_0xa5b6c4,'master_shop':_0x52b4c6,'language':_0x416844,'ed_fullDate':_0x4202c1,'dataSelected':_0x4fae3f});}catch(_0x294944){console['log'](_0x294944);}}),router['get'](a0_0x2accef(0xb4),auth,async(_0x58af4f,_0x5d3b95)=>{var _0xe7553e=a0_0x2accef;try{const {username:_0x112446,email:_0xd3d1bd,role:_0x3948aa}=_0x58af4f['user'],_0x2334cd=_0x58af4f[_0xe7553e(0xff)],_0x522f45=await profile[_0xe7553e(0x111)]({'email':_0x2334cd[_0xe7553e(0xd7)]}),_0x3f781d=await master_shop[_0xe7553e(0xd1)](),_0x22cdde=_0x58af4f['params']['id'],_0x1c368a=await purchases_finished[_0xe7553e(0xfb)](_0x22cdde),_0x584d61=await suppliers[_0xe7553e(0xd1)]({});let _0x11f7f0;if(_0x2334cd[_0xe7553e(0xb2)]==_0xe7553e(0x11f)){const _0x44d594=await staff[_0xe7553e(0x111)]({'email':_0x2334cd[_0xe7553e(0xd7)]});_0x11f7f0=await warehouse[_0xe7553e(0xd1)]({'status':'Enabled','name':_0x44d594[_0xe7553e(0x8d)],'warehouse_category':_0xe7553e(0xc8)});}else _0x11f7f0=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0xe7553e(0xc8)}},{'$group':{'_id':_0xe7553e(0x166),'name':{'$first':_0xe7553e(0x166)}}}]);const _0x54edd5=await product['find']({}),_0x1b3d38=BayBinSelected(_0x1c368a[_0xe7553e(0x155)],_0x1c368a[_0xe7553e(0xdc)]);let _0x51affa=new Date(_0x1c368a[_0xe7553e(0x110)]),_0x50b982=('0'+_0x51affa[_0xe7553e(0x146)]())['slice'](-0x2),_0x542f26=('0'+(_0x51affa[_0xe7553e(0xfe)]()+0x1))['slice'](-0x2),_0x2dc14d=_0x51affa[_0xe7553e(0x127)](),_0x174a39=_0x2dc14d+'-'+_0x542f26+'-'+_0x50b982;if(_0x3f781d[0x0]['language']==_0xe7553e(0xb3)){var _0x26c949=users[_0xe7553e(0xd8)];console[_0xe7553e(0xb5)](_0x26c949);}else{if(_0x3f781d[0x0][_0xe7553e(0x138)]==_0xe7553e(0x147))var _0x26c949=users[_0xe7553e(0x147)];else{if(_0x3f781d[0x0][_0xe7553e(0x138)]==_0xe7553e(0xbf))var _0x26c949=users[_0xe7553e(0xbf)];else{if(_0x3f781d[0x0][_0xe7553e(0x138)]==_0xe7553e(0x91))var _0x26c949=users['Spanish'];else{if(_0x3f781d[0x0][_0xe7553e(0x138)]==_0xe7553e(0x88))var _0x26c949=users[_0xe7553e(0x88)];else{if(_0x3f781d[0x0][_0xe7553e(0x138)]=='Portuguese\x20(BR)')var _0x26c949=users['Portuguese'];else{if(_0x3f781d[0x0]['language']==_0xe7553e(0x82))var _0x26c949=users[_0xe7553e(0x82)];else{if(_0x3f781d[0x0][_0xe7553e(0x138)]==_0xe7553e(0x10e))var _0x26c949=users[_0xe7553e(0x14c)];}}}}}}}_0x5d3b95[_0xe7553e(0x108)]('edit_purchases_finished',{'success':_0x58af4f['flash']('success'),'errors':_0x58af4f['flash']('errors'),'role':_0x2334cd,'profile':_0x522f45,'purchases':_0x1c368a,'suppliers':_0x584d61,'warehouse':_0x11f7f0,'product':_0x54edd5,'master_shop':_0x3f781d,'language':_0x26c949,'ed_fullDate':_0x174a39,'dataSelected':_0x1b3d38});}catch(_0x136d7e){console[_0xe7553e(0xb5)](_0x136d7e);}}),router[a0_0x2accef(0xec)](a0_0x2accef(0xb4),auth,async(_0x55c008,_0x50e4cf)=>{var _0x5df62b=a0_0x2accef;try{const _0x53d858=_0x55c008[_0x5df62b(0xca)]['id'],_0x2dabb7=await purchases_finished['findOne']({'_id':_0x55c008[_0x5df62b(0xca)]['id']}),_0x6c2468=await warehouse[_0x5df62b(0x111)]({'name':_0x2dabb7[_0x5df62b(0x155)],'room':_0x2dabb7[_0x5df62b(0xdc)]});_0x2dabb7[_0x5df62b(0x159)][_0x5df62b(0xe3)](_0x34ad9=>{var _0x521cbb=_0x5df62b;const _0x18cea1=_0x6c2468['product_details'][_0x521cbb(0x121)](_0x101e0b=>{var _0x4a52fd=_0x521cbb;_0x101e0b[_0x4a52fd(0xda)]==_0x34ad9[_0x4a52fd(0xda)]&&_0x101e0b['bay']==_0x34ad9[_0x4a52fd(0xa2)]&&(_0x101e0b[_0x4a52fd(0xee)]=parseInt(_0x101e0b[_0x4a52fd(0xee)])-parseInt(_0x34ad9['quantity']));});}),await _0x6c2468[_0x5df62b(0x145)]();const {invoice:_0x5952bc,suppliers:_0x3ed19b,date:_0x1d85a6,warehouse_name:_0x57ea2c,prod_name:_0x5e5413,prod_code:_0x5a1ad0,prod_qty:_0x5b261b,prod_unit:_0x39bedb,prod_secondunit:_0x4a550b,prod_level:_0x342ef9,prod_isle:_0x215b10,prod_pallet:_0xadf1b2,note:_0x2fa503,expiry_date:_0x181554,batch_code:_0x2abad3,paid_amount:_0x3cd3c7,due_amount:_0x24390d,Room_name:_0x30a5fe,primary_code:_0x23f486,secondary_code:_0x2a684c,PO_number:_0x28e16c,JO_number:_0x38d6a5}=_0x55c008[_0x5df62b(0x124)];if(typeof _0x5e5413==_0x5df62b(0xf3))var _0x1b73b7=[_0x55c008[_0x5df62b(0x124)][_0x5df62b(0xed)]],_0x4c31bb=[_0x55c008['body'][_0x5df62b(0x148)]],_0x128891=[_0x55c008[_0x5df62b(0x124)]['prod_qty']],_0x5e83f2=[_0x55c008['body'][_0x5df62b(0x101)]],_0x510776=[_0x55c008[_0x5df62b(0x124)][_0x5df62b(0x149)]],_0x1be03f=[_0x55c008[_0x5df62b(0x124)]['prod_level']],_0x2a6a3f=[_0x55c008[_0x5df62b(0x124)]['primary_code']],_0x4e4615=[_0x55c008[_0x5df62b(0x124)]['secondary_code']],_0x3be1d2=[_0x55c008[_0x5df62b(0x124)]['MaxStocks_data']],_0xa263ae=[_0x55c008[_0x5df62b(0x124)]['batch_code']],_0x4db32f=[_0x55c008[_0x5df62b(0x124)][_0x5df62b(0x110)]];else var _0x1b73b7=[..._0x55c008[_0x5df62b(0x124)][_0x5df62b(0xed)]],_0x4c31bb=[..._0x55c008[_0x5df62b(0x124)][_0x5df62b(0x148)]],_0x128891=[..._0x55c008['body'][_0x5df62b(0x74)]],_0x5e83f2=[..._0x55c008['body'][_0x5df62b(0x101)]],_0x510776=[..._0x55c008[_0x5df62b(0x124)][_0x5df62b(0x149)]],_0x1be03f=[..._0x55c008[_0x5df62b(0x124)][_0x5df62b(0xea)]],_0x2a6a3f=[..._0x55c008[_0x5df62b(0x124)][_0x5df62b(0x14a)]],_0x4e4615=[..._0x55c008[_0x5df62b(0x124)][_0x5df62b(0xa9)]],_0x3be1d2=[..._0x55c008['body'][_0x5df62b(0xf0)]],_0xa263ae=[..._0x55c008['body']['batch_code']],_0x4db32f=[..._0x55c008[_0x5df62b(0x124)]['expiry_date']];const _0x496f31=_0x1b73b7[_0x5df62b(0x121)](_0x1f78f4=>{return _0x1f78f4={'product_name':_0x1f78f4};});_0x4c31bb[_0x5df62b(0xe3)]((_0x4f6684,_0x585852)=>{var _0x52309c=_0x5df62b;_0x496f31[_0x585852][_0x52309c(0x96)]=_0x4f6684;}),_0x128891[_0x5df62b(0xe3)]((_0x59f87b,_0x54df12)=>{var _0x22e798=_0x5df62b;_0x496f31[_0x54df12][_0x22e798(0x112)]=_0x59f87b;}),_0x5e83f2[_0x5df62b(0xe3)]((_0x519f5a,_0x2d4bd0)=>{_0x496f31[_0x2d4bd0]['standard_unit']=_0x519f5a;}),_0x510776[_0x5df62b(0xe3)]((_0x725f01,_0x254989)=>{var _0x2704cc=_0x5df62b;_0x496f31[_0x254989][_0x2704cc(0x13a)]=_0x725f01;}),_0x1be03f[_0x5df62b(0xe3)]((_0x22de1f,_0x1f1fb4)=>{var _0x412857=_0x5df62b;_0x496f31[_0x1f1fb4][_0x412857(0xa2)]=_0x22de1f;}),_0x2a6a3f[_0x5df62b(0xe3)]((_0x2da870,_0x43d709)=>{var _0x50c69d=_0x5df62b;_0x496f31[_0x43d709][_0x50c69d(0x14a)]=_0x2da870;}),_0x4e4615[_0x5df62b(0xe3)]((_0x50c2d4,_0x6351df)=>{var _0x2b722c=_0x5df62b;_0x496f31[_0x6351df][_0x2b722c(0xa9)]=_0x50c2d4;}),_0x3be1d2[_0x5df62b(0xe3)]((_0x5033c3,_0x2cbc3f)=>{var _0x5654fb=_0x5df62b;_0x496f31[_0x2cbc3f][_0x5654fb(0x7f)]=_0x5033c3;}),_0xa263ae[_0x5df62b(0xe3)]((_0x4da427,_0x8a2809)=>{_0x496f31[_0x8a2809]['batch_code']=_0x4da427;}),_0x4db32f[_0x5df62b(0xe3)]((_0x4c90d0,_0x5bcc4f)=>{var _0x3a95bb=_0x5df62b;_0x496f31[_0x5bcc4f][_0x3a95bb(0x110)]=_0x4c90d0;});const _0x2eff5f=_0x496f31['filter'](_0x4c7816=>_0x4c7816[_0x5df62b(0x112)]!=='0'&&_0x4c7816[_0x5df62b(0x112)]!=='');_0x2dabb7['invoice']=_0x5952bc,_0x2dabb7[_0x5df62b(0x72)]=_0x3ed19b,_0x2dabb7[_0x5df62b(0xcd)]=_0x1d85a6,_0x2dabb7[_0x5df62b(0x155)]=_0x57ea2c,_0x2dabb7[_0x5df62b(0x159)]=_0x2eff5f,_0x2dabb7[_0x5df62b(0x15d)]=_0x2fa503,_0x2dabb7[_0x5df62b(0xcc)]=_0x3cd3c7,_0x2dabb7[_0x5df62b(0xa3)]=_0x24390d,_0x2dabb7[_0x5df62b(0xdc)]=_0x30a5fe,_0x2dabb7[_0x5df62b(0x81)]=_0x28e16c,_0x2dabb7[_0x5df62b(0x8c)]=_0x38d6a5;const _0xa2b665=await _0x2dabb7[_0x5df62b(0x145)](),_0x35113f=await warehouse[_0x5df62b(0x111)]({'name':_0x55c008[_0x5df62b(0x124)]['warehouse_name'],'room':_0x55c008['body'][_0x5df62b(0x10d)]});_0x2dabb7['product'][_0x5df62b(0xe3)](_0x2b19aa=>{var _0x4475ae=_0x5df62b,_0x437c86=0x0;const _0x45544c=_0x35113f[_0x4475ae(0x14b)]['map'](_0x67cf88=>{var _0x235c8f=_0x4475ae;_0x67cf88[_0x235c8f(0xda)]==_0x2b19aa['product_name']&&_0x67cf88[_0x235c8f(0xa2)]==_0x2b19aa[_0x235c8f(0xa2)]&&(_0x67cf88[_0x235c8f(0xee)]=parseInt(_0x67cf88[_0x235c8f(0xee)])+parseInt(_0x2b19aa['quantity']),_0x437c86++);});_0x437c86=='0'&&(_0x35113f['product_details']=_0x35113f['product_details'][_0x4475ae(0xd5)]({'product_name':_0x2b19aa['product_name'],'product_stock':_0x2b19aa[_0x4475ae(0x112)],'primary_code':_0x2b19aa[_0x4475ae(0x14a)],'secondary_code':_0x2b19aa[_0x4475ae(0xa9)],'product_code':_0x2b19aa['product_code'],'bay':_0x2b19aa[_0x4475ae(0xa2)],'maxProducts':_0x2b19aa[_0x4475ae(0x7f)],'unit':_0x2b19aa[_0x4475ae(0x98)],'secondary_unit':_0x2b19aa['secondary_unit'],'expiry_date':_0x2b19aa[_0x4475ae(0x110)]}));}),await _0x35113f['save']();const _0x177385=await s_payment_data[_0x5df62b(0x111)]({'invoice':_0x55c008[_0x5df62b(0x124)][_0x5df62b(0xab)]});if(_0x177385===null){}else console[_0x5df62b(0xb5)](_0x5df62b(0x72),_0x177385,_0x55c008[_0x5df62b(0x124)][_0x5df62b(0xab)]),_0x177385['suppliers']=_0x55c008[_0x5df62b(0x124)]['suppliers'],await _0x177385[_0x5df62b(0x145)]();_0x55c008[_0x5df62b(0x99)](_0x5df62b(0x90),'purchase\x20data\x20update\x20successfully'),_0x50e4cf[_0x5df62b(0xce)](_0x5df62b(0x139));}catch(_0x4e0204){console[_0x5df62b(0xb5)](_0x4e0204);}}),router[a0_0x2accef(0xec)](a0_0x2accef(0x122),auth,async(_0x40d15a,_0x1f7926)=>{var _0x61998f=a0_0x2accef;try{const _0x54f682=_0x40d15a[_0x61998f(0xca)]['id'],{invoice:_0x344a9c,suppliers:_0xf5962c,payable:_0x4e6a78,due_amount:_0x36769c}=_0x40d15a['body'],_0x3a062c=await purchases[_0x61998f(0xfb)](_0x54f682);var _0x46080c=_0x4e6a78-_0x36769c;_0x3a062c['paid_amount']=parseFloat(_0x3a062c[_0x61998f(0xcc)])+parseFloat(_0x36769c),_0x3a062c['due_amount']=_0x46080c;const _0x1c0099=await _0x3a062c['save']();console[_0x61998f(0xb5)](_0x1c0099);const _0x25aa4b=await s_payment_data['findOne']({'invoice':_0x344a9c});_0x25aa4b[_0x61998f(0x9d)]=_0x46080c,await _0x25aa4b[_0x61998f(0x145)]();let _0x314f32=new Date(),_0x97d38d=('0'+_0x314f32['getDate']())[_0x61998f(0x7c)](-0x2),_0x2d0323=('0'+(_0x314f32['getMonth']()+0x1))[_0x61998f(0x7c)](-0x2),_0xc16f8=_0x314f32[_0x61998f(0x127)](),_0x171ba8=_0xc16f8+'-'+_0x2d0323+'-'+_0x97d38d;const _0x7dac7f=new suppliers_payment({'invoice':_0x344a9c,'date':_0xc16f8+'-'+_0x2d0323+'-'+_0x97d38d,'suppliers':_0xf5962c,'reason':'Paid\x20For\x20Purchase','amount':_0x36769c}),_0x7cccfe=await _0x7dac7f['save']();_0x40d15a['flash'](_0x61998f(0x90),_0x61998f(0x7b)),_0x1f7926[_0x61998f(0xce)](_0x61998f(0x7a));}catch(_0x44b1c3){console[_0x61998f(0xb5)](_0x44b1c3);}}),router[a0_0x2accef(0xa4)](a0_0x2accef(0x119),auth,async(_0x2dd556,_0x2d3028)=>{var _0x2bdc25=a0_0x2accef;try{const {username:_0x5320f1,email:_0x35cb32,role:_0x49f1e3}=_0x2dd556[_0x2bdc25(0xff)],_0x4c32f3=_0x2dd556[_0x2bdc25(0xff)],_0x22318a=await profile[_0x2bdc25(0x111)]({'email':_0x4c32f3[_0x2bdc25(0xd7)]}),_0x2752bb=await master_shop[_0x2bdc25(0xd1)]();console[_0x2bdc25(0xb5)]('master',_0x2752bb);const _0xe973e2=_0x2dd556[_0x2bdc25(0xca)]['id'],_0x28eeb8=await purchases[_0x2bdc25(0xfb)](_0xe973e2);console[_0x2bdc25(0xb5)](_0x28eeb8);const _0x419e94=await suppliers['findOne']({'name':_0x28eeb8['suppliers']});console[_0x2bdc25(0xb5)](_0x419e94);if(_0x2752bb[0x0][_0x2bdc25(0x138)]=='English\x20(US)'){var _0x562e5f=users['English'];console[_0x2bdc25(0xb5)](_0x562e5f);}else{if(_0x2752bb[0x0][_0x2bdc25(0x138)]=='Hindi')var _0x562e5f=users['Hindi'];else{if(_0x2752bb[0x0]['language']==_0x2bdc25(0xbf))var _0x562e5f=users[_0x2bdc25(0xbf)];else{if(_0x2752bb[0x0][_0x2bdc25(0x138)]==_0x2bdc25(0x91))var _0x562e5f=users[_0x2bdc25(0x91)];else{if(_0x2752bb[0x0]['language']==_0x2bdc25(0x88))var _0x562e5f=users['French'];else{if(_0x2752bb[0x0][_0x2bdc25(0x138)]==_0x2bdc25(0xb6))var _0x562e5f=users[_0x2bdc25(0xef)];else{if(_0x2752bb[0x0]['language']==_0x2bdc25(0x82))var _0x562e5f=users['Chinese'];else{if(_0x2752bb[0x0]['language']=='Arabic\x20(ae)')var _0x562e5f=users[_0x2bdc25(0x14c)];}}}}}}}_0x2d3028[_0x2bdc25(0x108)](_0x2bdc25(0x73),{'success':_0x2dd556[_0x2bdc25(0x99)](_0x2bdc25(0x90)),'errors':_0x2dd556[_0x2bdc25(0x99)](_0x2bdc25(0x7d)),'role':_0x4c32f3,'profile':_0x22318a,'master_shop':_0x2752bb,'supplier':_0x419e94,'purchase':_0x28eeb8,'language':_0x562e5f});}catch(_0xaa6eeb){console[_0x2bdc25(0xb5)](_0xaa6eeb);}}),router[a0_0x2accef(0xa4)](a0_0x2accef(0x137),auth,async(_0x3dbc07,_0x32cec5)=>{var _0x5cbe34=a0_0x2accef;try{const {username:_0x4d4e0a,email:_0x40c2cf,role:_0x12abf8}=_0x3dbc07[_0x5cbe34(0xff)],_0x305384=_0x3dbc07['user'],_0x3d7df2=await profile[_0x5cbe34(0x111)]({'email':_0x305384[_0x5cbe34(0xd7)]}),_0x5d8207=await master_shop[_0x5cbe34(0xd1)]();console['log'](_0x5cbe34(0xac),_0x5d8207);const _0x25da51=_0x3dbc07[_0x5cbe34(0xca)]['id'];console['log'](_0x25da51);const _0x520a1d=await purchases_finished['findById'](_0x25da51);console[_0x5cbe34(0xb5)](_0x5cbe34(0x140),_0x520a1d);const _0x5d7d74=await product[_0x5cbe34(0xd1)]({}),_0x4ba8b3=await warehouse[_0x5cbe34(0x143)]([{'$match':{'name':_0x520a1d['warehouse_name'],'room':_0x520a1d[_0x5cbe34(0xdc)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5cbe34(0xa7)},'product_stock':{'$first':_0x5cbe34(0x151)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5cbe34(0xfd)},'type':{'$first':_0x5cbe34(0x132)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5cbe34(0x13d)},'secondary_code':{'$first':_0x5cbe34(0x6f)},'product_code':{'$first':_0x5cbe34(0x100)},'storage':{'$first':_0x5cbe34(0x8e)},'rack':{'$first':_0x5cbe34(0xcf)}}}]);console['log']('stock_data',_0x4ba8b3);let _0x5e0b12;if(_0x305384['role']==_0x5cbe34(0x11f)){const _0x55f407=await staff[_0x5cbe34(0x111)]({'email':_0x305384[_0x5cbe34(0xd7)]});_0x5e0b12=await warehouse[_0x5cbe34(0xd1)]({'status':_0x5cbe34(0xe9),'name':_0x55f407[_0x5cbe34(0x8d)],'warehouse_category':_0x5cbe34(0xc8),'name':'Return\x20Goods'});}else _0x5e0b12=await warehouse[_0x5cbe34(0x143)]([{'$match':{'status':_0x5cbe34(0xe9),'warehouse_category':_0x5cbe34(0xc8),'name':'Return\x20Goods'}},{'$group':{'_id':_0x5cbe34(0x166),'name':{'$first':'$name'}}}]);if(_0x5d8207[0x0]['language']==_0x5cbe34(0xb3)){var _0x5625b6=users['English'];console[_0x5cbe34(0xb5)](_0x5625b6);}else{if(_0x5d8207[0x0]['language']=='Hindi')var _0x5625b6=users[_0x5cbe34(0x147)];else{if(_0x5d8207[0x0]['language']==_0x5cbe34(0xbf))var _0x5625b6=users[_0x5cbe34(0xbf)];else{if(_0x5d8207[0x0][_0x5cbe34(0x138)]==_0x5cbe34(0x91))var _0x5625b6=users[_0x5cbe34(0x91)];else{if(_0x5d8207[0x0][_0x5cbe34(0x138)]==_0x5cbe34(0x88))var _0x5625b6=users['French'];else{if(_0x5d8207[0x0]['language']==_0x5cbe34(0xb6))var _0x5625b6=users[_0x5cbe34(0xef)];else{if(_0x5d8207[0x0][_0x5cbe34(0x138)]==_0x5cbe34(0x82))var _0x5625b6=users['Chinese'];else{if(_0x5d8207[0x0]['language']==_0x5cbe34(0x10e))var _0x5625b6=users[_0x5cbe34(0x14c)];}}}}}}}_0x32cec5[_0x5cbe34(0x108)](_0x5cbe34(0xe8),{'success':_0x3dbc07[_0x5cbe34(0x99)](_0x5cbe34(0x90)),'errors':_0x3dbc07[_0x5cbe34(0x99)](_0x5cbe34(0x7d)),'role':_0x305384,'profile':_0x3d7df2,'user':_0x520a1d,'stock':_0x4ba8b3,'master_shop':_0x5d8207,'product':_0x5d7d74,'language':_0x5625b6,'warehouse':_0x5e0b12});}catch(_0x4c4b66){console[_0x5cbe34(0xb5)](_0x4c4b66);}}),router[a0_0x2accef(0xec)](a0_0x2accef(0x137),auth,async(_0x4e6232,_0x4ee5b7)=>{var _0x21765b=a0_0x2accef;try{const {invoice:_0x546ac3,date:_0x12b1e0,warehouse_name:_0x495bb0,Room_name:_0x171a76,product_name:_0x32cc21,purchase_quantity:_0xe3b9db,stocks:_0x24d19a,return_qty:_0x2b6782,note:_0x3d0d06,level:_0x7cfe21,isle:_0x23c8f6,pallet:_0x3a2c08,to_warehouse_name:_0x244448,to_Room_name:_0x46062e}=_0x4e6232[_0x21765b(0x124)],_0x20fb7f=await purchases_finished[_0x21765b(0x111)]({'_id':_0x4e6232[_0x21765b(0xca)]['id']}),_0x4e2f8f=await warehouse[_0x21765b(0x111)]({'name':_0x495bb0,'room':_0x171a76,'warehouse_category':'Finished\x20Goods'});if(typeof _0x32cc21==_0x21765b(0xf3))var _0xf138b5=[_0x4e6232['body'][_0x21765b(0xda)]],_0x47adda=[_0x4e6232[_0x21765b(0x124)][_0x21765b(0x133)]],_0x451ed1=[_0x4e6232[_0x21765b(0x124)]['stocks']],_0x5d08b6=[_0x4e6232['body'][_0x21765b(0xe2)]],_0xff0902=[_0x4e6232[_0x21765b(0x124)][_0x21765b(0xb0)]],_0x51e631=[_0x4e6232[_0x21765b(0x124)][_0x21765b(0x144)]],_0x5857e4=[_0x4e6232[_0x21765b(0x124)][_0x21765b(0xd0)]],_0x2341cc=[_0x4e6232[_0x21765b(0x124)][_0x21765b(0xc3)]];else var _0xf138b5=[..._0x4e6232['body'][_0x21765b(0xda)]],_0x47adda=[..._0x4e6232[_0x21765b(0x124)][_0x21765b(0x133)]],_0x451ed1=[..._0x4e6232['body'][_0x21765b(0x130)]],_0x5d08b6=[..._0x4e6232[_0x21765b(0x124)][_0x21765b(0xe2)]],_0xff0902=[..._0x4e6232[_0x21765b(0x124)][_0x21765b(0xb0)]],_0x51e631=[..._0x4e6232['body']['product_code_hide']],_0x5857e4=[..._0x4e6232[_0x21765b(0x124)][_0x21765b(0xd0)]],_0x2341cc=[..._0x4e6232['body']['secondary_code_hide']];const _0x3ca9d4=_0xf138b5[_0x21765b(0x121)](_0x3d330a=>{return _0x3d330a={'product_name':_0x3d330a};});_0x47adda[_0x21765b(0xe3)]((_0x1af4a6,_0x535f8c)=>{var _0x3fd387=_0x21765b;_0x3ca9d4[_0x535f8c][_0x3fd387(0x133)]=_0x1af4a6;}),_0x451ed1[_0x21765b(0xe3)]((_0x9470fb,_0x5e5779)=>{_0x3ca9d4[_0x5e5779]['stock_quantity']=_0x9470fb;}),_0x5d08b6['forEach']((_0x19be24,_0x2184d7)=>{var _0x337275=_0x21765b;_0x3ca9d4[_0x2184d7][_0x337275(0xe2)]=_0x19be24;}),_0xff0902[_0x21765b(0xe3)]((_0x5b0547,_0x4ec45a)=>{var _0x404cb1=_0x21765b;_0x3ca9d4[_0x4ec45a][_0x404cb1(0xa2)]=_0x5b0547;}),_0x51e631[_0x21765b(0xe3)]((_0x4b122c,_0x10af07)=>{_0x3ca9d4[_0x10af07]['product_code']=_0x4b122c;}),_0x5857e4[_0x21765b(0xe3)]((_0xf2764d,_0x11545c)=>{_0x3ca9d4[_0x11545c]['primary_code']=_0xf2764d;}),_0x2341cc[_0x21765b(0xe3)]((_0x28ff03,_0x559e04)=>{var _0x535bbd=_0x21765b;_0x3ca9d4[_0x559e04][_0x535bbd(0xa9)]=_0x28ff03;}),_0x3ca9d4[_0x21765b(0xe3)](_0x4f1a3e=>{var _0x3a0f3f=_0x21765b;console[_0x3a0f3f(0xb5)](_0x4f1a3e);const _0x1ab298=_0x4e2f8f[_0x3a0f3f(0x14b)][_0x3a0f3f(0x121)](_0x8f1348=>{var _0x404b21=_0x3a0f3f;_0x8f1348[_0x404b21(0xda)]==_0x4f1a3e[_0x404b21(0xda)]&&_0x8f1348[_0x404b21(0xa2)]==_0x4f1a3e[_0x404b21(0xa2)]&&(console[_0x404b21(0xb5)](parseInt(_0x8f1348[_0x404b21(0xee)])+'\x20<>\x20'+parseInt(_0x4f1a3e[_0x404b21(0xe2)])),_0x8f1348['product_stock']=parseInt(_0x8f1348[_0x404b21(0xee)])-parseInt(_0x4f1a3e['return_qty']));});}),await _0x4e2f8f[_0x21765b(0x145)]();var _0xb220c1=0x0;_0x3ca9d4[_0x21765b(0xe3)](_0x36474c=>{var _0x16cbef=_0x21765b;(parseInt(_0x36474c[_0x16cbef(0x133)])<parseInt(_0x36474c[_0x16cbef(0xe2)])||parseInt(_0x36474c[_0x16cbef(0x114)])<parseInt(_0x36474c['return_qty']))&&_0xb220c1++;});if(_0xb220c1!=0x0)return _0x4e6232[_0x21765b(0x99)](_0x21765b(0x7d),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x4ee5b7[_0x21765b(0xce)](_0x21765b(0x71));const _0x30ad8a=new purchases_return_finished({'invoice':_0x546ac3,'suppliers':_0x4e6232[_0x21765b(0x124)]['suppliers'],'date':_0x12b1e0,'warehouse_name':_0x495bb0,'return_product':_0x3ca9d4,'note':_0x3d0d06,'room':_0x171a76,'to_warehouse_name':_0x244448,'to_room':_0x46062e}),_0xc98a28=await _0x30ad8a[_0x21765b(0x145)](),_0x5d72f2=await purchases_return_finished[_0x21765b(0x111)]({'invoice':_0x546ac3}),_0x3590f2=await warehouse[_0x21765b(0x111)]({'name':_0x244448,'room':_0x46062e,'warehouse_category':_0x21765b(0xc8)});_0x5d72f2['return_product']['forEach'](_0x3e00be=>{var _0x2f7d09=_0x21765b,_0x5e0a7d=0x0;const _0x367517=_0x3590f2[_0x2f7d09(0x14b)][_0x2f7d09(0x121)](_0x21acdc=>{var _0x4fb0e5=_0x2f7d09;console['log'](_0x21acdc['product_name']+'=='+_0x3e00be[_0x4fb0e5(0xda)]+'&&'+_0x21acdc['bay']+'=='+_0x3e00be[_0x4fb0e5(0xa2)]),_0x21acdc[_0x4fb0e5(0xda)]==_0x3e00be[_0x4fb0e5(0xda)]&&_0x21acdc[_0x4fb0e5(0xa2)]==_0x3e00be[_0x4fb0e5(0xa2)]&&(_0x21acdc[_0x4fb0e5(0xee)]=parseInt(_0x21acdc[_0x4fb0e5(0xee)])-parseInt(_0x3e00be[_0x4fb0e5(0xe2)]),_0x5e0a7d++);});_0x5e0a7d=='0'&&(_0x3590f2[_0x2f7d09(0x14b)]=_0x3590f2[_0x2f7d09(0x14b)][_0x2f7d09(0xd5)]({'product_name':_0x3e00be[_0x2f7d09(0xda)],'product_stock':_0x3e00be[_0x2f7d09(0xe2)],'primary_code':_0x3e00be[_0x2f7d09(0x14a)],'secondary_code':_0x3e00be[_0x2f7d09(0xa9)],'product_code':_0x3e00be['product_code'],'bay':_0x3e00be[_0x2f7d09(0xa2)],'maxProducts':0xf423f}));}),await _0x3590f2['save']();const _0x3eada4=await purchases_finished['findOne']({'invoice':_0x546ac3});_0x3eada4['return_data']=_0x21765b(0x12a);const _0x2372b1=await _0x3eada4[_0x21765b(0x145)](),_0x1de02a=new s_payment_data({'invoice':_0x546ac3,'suppliers':_0x4e6232[_0x21765b(0x124)][_0x21765b(0x72)],'reason':'Purchase\x20Return'});await _0x1de02a[_0x21765b(0x145)]();const _0x59b360=await master_shop[_0x21765b(0xd1)](),_0x227dca=await email_settings[_0x21765b(0x111)](),_0x4f4034=await suppliers['findOne']({'name':_0x4e6232[_0x21765b(0x124)][_0x21765b(0x72)]});_0x59b360[0x0][_0x21765b(0x162)]==0x1?(right_currency=_0x59b360[0x0][_0x21765b(0x7e)],left_currency=''):(right_currency='',left_currency=_0x59b360[0x0]['currency']);var _0x4f749c=_0xf138b5,_0x4d0c4b=_0x5d08b6,_0x4ace03='',_0x446277;for(_0x446277 in _0x4f749c){_0x4ace03+=_0x21765b(0xae)+_0x21765b(0x15c)+_0x4f749c[_0x446277]+'</td>'+_0x21765b(0x15c)+_0x4d0c4b[_0x446277]+_0x21765b(0x150)+_0x21765b(0x85);}let _0x368974=nodemailer['createTransport']({'service':_0x21765b(0x158),'auth':{'user':_0x227dca[_0x21765b(0xd7)],'pass':_0x227dca[_0x21765b(0xba)]}}),_0x368c4e={'from':_0x227dca[_0x21765b(0xd7)],'to':_0x4f4034['email'],'subject':_0x21765b(0x93),'attachments':[{'filename':_0x21765b(0x13b),'path':__dirname+_0x21765b(0xaf)+_0x21765b(0xa6)+_0x59b360[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x21765b(0xeb)+_0x21765b(0x105)+_0x21765b(0xa8)+_0x21765b(0x142)+_0x21765b(0xa8)+_0x21765b(0xa5)+_0x21765b(0x12b)+_0x21765b(0xa8)+_0x21765b(0x14d)+_0x59b360[0x0][_0x21765b(0xc6)]+_0x21765b(0xb8)+_0x21765b(0x12b)+_0x21765b(0x12b)+_0x21765b(0xf1)+_0x21765b(0xa8)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x21765b(0xa0)+_0x546ac3+'\x20'+_0x21765b(0x113)+_0x21765b(0xf7)+_0x12b1e0+'\x20'+'</span>'+_0x21765b(0x9c)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x21765b(0x83)+_0x21765b(0xae)+_0x21765b(0x135)+_0x21765b(0x153)+_0x21765b(0x161)+_0x21765b(0x129)+_0x21765b(0x85)+_0x21765b(0x156)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4ace03+'\x20'+_0x21765b(0x10f)+_0x21765b(0xf9)+_0x21765b(0xa8)+_0x21765b(0xf4)+'<h5>'+_0x59b360[0x0][_0x21765b(0xc6)]+_0x21765b(0x9c)+_0x21765b(0x12b)+_0x21765b(0x12b)+_0x21765b(0x123)};_0x368974[_0x21765b(0xd3)](_0x368c4e,function(_0x9357de,_0x2c7323){var _0x3a1c14=_0x21765b;_0x9357de?console[_0x3a1c14(0xb5)](_0x3a1c14(0x103)):console[_0x3a1c14(0xb5)](_0x3a1c14(0x87));}),_0x4e6232[_0x21765b(0x99)]('success','purchases\x20item\x20return\x20successfull'),_0x4ee5b7[_0x21765b(0xce)](_0x21765b(0x139));}catch(_0x546dfa){_0x4ee5b7[_0x21765b(0xd9)](0xc8)[_0x21765b(0x141)]({'message':_0x546dfa[_0x21765b(0x95)]});}}),router[a0_0x2accef(0xa4)]('/barcode/:id',auth,async(_0x1eefc0,_0x2e37df)=>{var _0x14659c=a0_0x2accef;try{const {username:_0x1374b8,email:_0x4a5a94,role:_0x37d56b}=_0x1eefc0[_0x14659c(0xff)],_0x2b7d1d=_0x1eefc0['user'],_0x36a09d=await profile[_0x14659c(0x111)]({'email':_0x2b7d1d[_0x14659c(0xd7)]}),_0x1938cd=await master_shop[_0x14659c(0xd1)](),_0x1189b5=_0x1eefc0['params']['id'],_0x304f98=await purchases_finished[_0x14659c(0xfb)](_0x1189b5);if(_0x1938cd[0x0][_0x14659c(0x138)]==_0x14659c(0xb3))var _0x558722=users[_0x14659c(0xd8)];else{if(_0x1938cd[0x0]['language']=='Hindi')var _0x558722=users[_0x14659c(0x147)];else{if(_0x1938cd[0x0][_0x14659c(0x138)]==_0x14659c(0xbf))var _0x558722=users[_0x14659c(0xbf)];else{if(_0x1938cd[0x0][_0x14659c(0x138)]==_0x14659c(0x91))var _0x558722=users[_0x14659c(0x91)];else{if(_0x1938cd[0x0]['language']==_0x14659c(0x88))var _0x558722=users[_0x14659c(0x88)];else{if(_0x1938cd[0x0][_0x14659c(0x138)]==_0x14659c(0xb6))var _0x558722=users[_0x14659c(0xef)];else{if(_0x1938cd[0x0][_0x14659c(0x138)]==_0x14659c(0x82))var _0x558722=users['Chinese'];else{if(_0x1938cd[0x0][_0x14659c(0x138)]==_0x14659c(0x10e))var _0x558722=users[_0x14659c(0x14c)];}}}}}}}_0x2e37df[_0x14659c(0x108)]('all_purchases_barcode',{'success':_0x1eefc0[_0x14659c(0x99)](_0x14659c(0x90)),'errors':_0x1eefc0[_0x14659c(0x99)]('errors'),'role':_0x2b7d1d,'profile':_0x36a09d,'alldata':_0x304f98,'master_shop':_0x1938cd,'language':_0x558722}),console['log'](alldata);}catch(_0x4f5c12){console[_0x14659c(0xb5)](_0x4f5c12);}}),router['post'](a0_0x2accef(0x86),async(_0x44b6c,_0x595309)=>{var _0x419378=a0_0x2accef;const {product_code:_0x446fec}=_0x44b6c['body'];var _0x2c3f9f;const _0x404719=await product[_0x419378(0x143)]([{'$match':{'primary_code':_0x446fec,'product_category':_0x419378(0xc8)}},{'$group':{'_id':_0x419378(0xde),'name':{'$first':_0x419378(0x166)},'category':{'$first':_0x419378(0xc0)},'brand':{'$first':_0x419378(0xdf)},'unit':{'$first':_0x419378(0x9f)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x419378(0x89)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x419378(0x10c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4821cf=await product['aggregate']([{'$match':{'secondary_code':_0x446fec}},{'$group':{'_id':_0x419378(0xde),'name':{'$first':_0x419378(0x166)},'category':{'$first':_0x419378(0xc0)},'brand':{'$first':_0x419378(0xdf)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x419378(0xe7)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x419378(0x89)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x419378(0xc5)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x404719['length']>0x0)_0x2c3f9f=_0x404719;else _0x4821cf[_0x419378(0x80)]>0x0&&(_0x2c3f9f=_0x4821cf);_0x595309[_0x419378(0x141)](_0x2c3f9f);}),router['post'](a0_0x2accef(0xbb),async(_0x2a3a2e,_0x44ed64)=>{var _0x56659d=a0_0x2accef;const {productCode:_0x416ff6,bay:_0xcdc42a,warehouses:_0x596f9c,room:_0x527de2}=_0x2a3a2e['body'];console['log'](_0x2a3a2e['body']);try{const _0x1d2baf=await warehouse[_0x56659d(0x143)]([{'$match':{'name':_0x596f9c,'room':_0x527de2}},{'$unwind':_0x56659d(0x9a)},{'$match':{'product_details.bay':parseInt(_0xcdc42a)}},{'$group':{'_id':_0x56659d(0x9e),'name':{'$first':_0x56659d(0xa7)},'product_stock':{'$first':_0x56659d(0x151)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x56659d(0x117)}}}]);_0x44ed64[_0x56659d(0xd9)](0xc8)[_0x56659d(0x141)](_0x1d2baf);}catch(_0x32d577){_0x44ed64['status'](0x194)[_0x56659d(0x141)]({'message':_0x32d577[_0x56659d(0x95)]});}}),module[a0_0x2accef(0xfc)]=router;