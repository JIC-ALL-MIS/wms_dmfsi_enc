var a0_0x3d80eb=a0_0x5613;(function(_0x3178d4,_0x46712d){var _0x36fc17=a0_0x5613,_0x345f67=_0x3178d4();while(!![]){try{var _0xcbf6d4=parseInt(_0x36fc17(0x16e))/0x1+parseInt(_0x36fc17(0x209))/0x2+parseInt(_0x36fc17(0x1ed))/0x3*(parseInt(_0x36fc17(0x1cd))/0x4)+-parseInt(_0x36fc17(0x178))/0x5+parseInt(_0x36fc17(0x201))/0x6*(parseInt(_0x36fc17(0x1a5))/0x7)+parseInt(_0x36fc17(0x1fb))/0x8+-parseInt(_0x36fc17(0x11b))/0x9*(parseInt(_0x36fc17(0x1de))/0xa);if(_0xcbf6d4===_0x46712d)break;else _0x345f67['push'](_0x345f67['shift']());}catch(_0x1162eb){_0x345f67['push'](_0x345f67['shift']());}}}(a0_0x51dc,0x9577a));const express=require(a0_0x3d80eb(0x152)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x3d80eb(0x183)),nodemailer=require(a0_0x3d80eb(0x1c9));var ejs=require(a0_0x3d80eb(0x1bd));function a0_0x5613(_0x194a92,_0x22f256){var _0x51dccf=a0_0x51dc();return a0_0x5613=function(_0x5613a2,_0x54b687){_0x5613a2=_0x5613a2-0x112;var _0x53da7f=_0x51dccf[_0x5613a2];return _0x53da7f;},a0_0x5613(_0x194a92,_0x22f256);}function a0_0x51dc(){var _0x4dcbbf=['Portuguese\x20(BR)','/view/add_purchases','$product.quantity','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<tr>','return_product','Email\x20sent\x20successfully','French','secondary_unit','log','/upload/','Enabled','MaxStocks_data','Spanish','DRY\x20GOODS','quantity','<hr\x20class=\x22my-3\x22>','express','Arabic\x20(ae)','$maxStocks','findById','<tbody\x20style=\x22text-align:\x20center;\x22>','$expiry_date','$product_details._id','currency','password','string','\x20Order\x20Number\x20:\x20','language','prod_unit','prod_code','<!DOCTYPE\x20html>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$unit','Purchase\x20Return\x20Mail','An\x20error\x20occurred.','$room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','primary_code_hide','product_code_hide','errors','</body></html>','flash','production_date','/view','1122283eGGLXf','map','stock_quantity','/view/:id','json','random','\x20<>\x20','</td>','slice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','5611095OrTUmC','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','error','POnumber','$product.type','Rack\x202','suppliers','QA\x20Warehouse','product_cat','../middleware/auth','Rack\x201','email','params','status','$note','padStart','message','$product.room_name','prod_secondunit','</thead>','product_date','path','payment\x20successfull','post','Ambient','max_product_unit','prod_level','prod_name','/preview/:id','$invoice','/barcode_scanner','$product_details.secondary_code','bay','user','all_purchases_finished','Finished\x20Goods','add_purchases\x20error','$product_details.bin','<strong>\x20Regards\x20</strong>','</head><body>','maxperunit','$brand','$product_details.storage','994EUcghB','English','warehouse','room_name','FROZEN\x20GOODS','$category','paid_amount','level','stocks','due_amount','$maxProdPerUnit','$primary_code','/give_payment/:id','product_stock','$product_details','$product.floorlevel','aggregate','../public/language/languages.json','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<h5>','product','$secondary_unit','success','ejs','image','/invoice/:id','getDate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<span\x20style=\x22float:\x20right;\x22>','getMonth','forEach','$due_amount','nodemailer','get','find','catch','4qmaWxa','$product_details.rack','$_id','return_qty','$date','createTransport','all','German','findOne','all_purchases_barcode','$name','secondary_code_hide','batch_code','prod_primunit','/view/return_purchase/:id','primary_code','expiry_date','40JsfHER','$product.bay','$product_details.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','purchase_quantity','Arabic','RoomAssign','prod_cat','\x20</h2>','Return\x20Goods','site_title','$batch_code','updateOne','$product_details.maxProducts','$product_code','2204199RxXxJz','render','master','INCF-','abs','currency_placement','body','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','invoice','prod_qty','English\x20(US)','$product_details.product_stock','Chinese','6496216cXTfvz','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_Qty','user_id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$suppliers','13644bBcQSG','purchase_invoice','prod_invoice','$secondary_code','edit_purchases_finished_view','$product_details.primary_code','length','maxStocks','1774860taDnwO','return_purchase_finished','add_purchases_finished','\x20Order\x20Date\x20:\x20','concat','Hindi','save','$return_data','</div>','secondary_code','filter','Error\x20Occurs','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_code','name','/view/add_purchases/:id','Paid\x20For\x20Purchase','4826124AIQrkX','/all_purchases_finished/view','</tr>','</h5>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','toString','Enclosed','sendMail','redirect','floor','port','$product.bin','<h5\x20style=\x22text-align:\x20left;\x22>','$suppliers_docs','standard_unit','Purchase\x20Return','JO_number','Portuguese','<html><head><title></title>','room','<div>','staff','</tbody>','$paid_amount','<h2>\x20','</span>','$product','$alertquantity','$warehouse_name','$product_details.product_code','product_name','getFullYear','/../public','_id','warehouse_name','FGSEmail','then','product_details'];a0_0x51dc=function(){return _0x4dcbbf;};return a0_0x51dc();}const path=require(a0_0x3d80eb(0x18f)),users=require(a0_0x3d80eb(0x1b6));router[a0_0x3d80eb(0x1ca)](a0_0x3d80eb(0x16d),auth,async(_0x1fba80,_0x5f405a)=>{var _0x1b61bb=a0_0x3d80eb;try{const {username:_0x41595e,email:_0x3d2075,role:_0x2d100d}=_0x1fba80[_0x1b61bb(0x19b)],_0x231171=_0x1fba80[_0x1b61bb(0x19b)],_0x264025=await profile['findOne']({'email':_0x231171['email']}),_0x5f577d=await staff[_0x1b61bb(0x1d5)]({'email':_0x231171[_0x1b61bb(0x185)]});if(_0x231171[_0x1b61bb(0x17a)]==_0x1b61bb(0x130)){const _0x51df9c=await staff[_0x1b61bb(0x1d5)]({'email':_0x231171['email']});}const _0x678f92=await master_shop[_0x1b61bb(0x1cb)]();let _0x2597df;if(_0x231171[_0x1b61bb(0x17a)]=='staff'){const _0x45b66b=await staff['findOne']({'email':_0x231171[_0x1b61bb(0x185)]});_0x2597df=await purchases_finished[_0x1b61bb(0x1b5)]([{'$match':{'warehouse_name':_0x45b66b[_0x1b61bb(0x1a7)]}},{'$lookup':{'from':_0x1b61bb(0x180),'localField':_0x1b61bb(0x180),'foreignField':_0x1b61bb(0x118),'as':'suppliers_docs'}},{'$unwind':_0x1b61bb(0x128)},{'$unwind':_0x1b61bb(0x135)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x1b61bb(0x200)},'date':{'$first':_0x1b61bb(0x1d1)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x1b61bb(0x165)},'product':{'$push':_0x1b61bb(0x135)},'note':{'$first':_0x1b61bb(0x188)},'paid_amount':{'$first':_0x1b61bb(0x132)},'due_amount':{'$first':_0x1b61bb(0x1c8)},'return_data':{'$first':_0x1b61bb(0x210)},'batch_code':{'$first':_0x1b61bb(0x1e9)},'expiry_date':{'$first':_0x1b61bb(0x157)},'suppliers_docs':{'$first':_0x1b61bb(0x128)},'total_product_quantity':{'$sum':_0x1b61bb(0x143)},'level':{'$addToSet':_0x1b61bb(0x1df)},'isle':{'$addToSet':_0x1b61bb(0x126)},'type':{'$addToSet':_0x1b61bb(0x17e)},'floorlevel':{'$addToSet':_0x1b61bb(0x1b4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2597df=await purchases_finished[_0x1b61bb(0x1b5)]([{'$unwind':_0x1b61bb(0x135)},{'$group':{'_id':_0x1b61bb(0x1cf),'invoice':{'$first':_0x1b61bb(0x197)},'suppliers':{'$first':_0x1b61bb(0x200)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1b61bb(0x137)},'room':{'$addToSet':_0x1b61bb(0x18b)},'product':{'$push':_0x1b61bb(0x135)},'note':{'$first':_0x1b61bb(0x188)},'paid_amount':{'$first':_0x1b61bb(0x132)},'due_amount':{'$first':_0x1b61bb(0x1c8)},'return_data':{'$first':_0x1b61bb(0x210)},'batch_code':{'$first':_0x1b61bb(0x1e9)},'expiry_date':{'$first':_0x1b61bb(0x157)},'suppliers_docs':{'$first':_0x1b61bb(0x128)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x1b61bb(0x1df)},'isle':{'$addToSet':_0x1b61bb(0x126)},'type':{'$addToSet':_0x1b61bb(0x17e)},'floorlevel':{'$addToSet':_0x1b61bb(0x1b4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x678f92[0x0][_0x1b61bb(0x15d)]==_0x1b61bb(0x1f8))var _0x19f499=users[_0x1b61bb(0x1a6)];else{if(_0x678f92[0x0][_0x1b61bb(0x15d)]==_0x1b61bb(0x20e))var _0x19f499=users['Hindi'];else{if(_0x678f92[0x0][_0x1b61bb(0x15d)]==_0x1b61bb(0x1d4))var _0x19f499=users[_0x1b61bb(0x1d4)];else{if(_0x678f92[0x0][_0x1b61bb(0x15d)]==_0x1b61bb(0x14e))var _0x19f499=users[_0x1b61bb(0x14e)];else{if(_0x678f92[0x0][_0x1b61bb(0x15d)]==_0x1b61bb(0x148))var _0x19f499=users[_0x1b61bb(0x148)];else{if(_0x678f92[0x0][_0x1b61bb(0x15d)]==_0x1b61bb(0x141))var _0x19f499=users[_0x1b61bb(0x12c)];else{if(_0x678f92[0x0][_0x1b61bb(0x15d)]==_0x1b61bb(0x1fa))var _0x19f499=users[_0x1b61bb(0x1fa)];else{if(_0x678f92[0x0][_0x1b61bb(0x15d)]==_0x1b61bb(0x153))var _0x19f499=users['Arabic'];}}}}}}}_0x5f405a['render'](_0x1b61bb(0x19c),{'success':_0x1fba80[_0x1b61bb(0x16b)](_0x1b61bb(0x1bc)),'errors':_0x1fba80[_0x1b61bb(0x16b)](_0x1b61bb(0x169)),'purchases':_0x2597df,'role':_0x231171,'profile':_0x264025,'master_shop':_0x678f92,'language':_0x19f499});}catch(_0x1efacf){console[_0x1b61bb(0x14a)]('table\x20page',_0x1efacf),_0x5f405a[_0x1b61bb(0x187)](0xc8)[_0x1b61bb(0x172)]({'message':_0x1efacf[_0x1b61bb(0x18a)]});}});function BayBinSelected(_0xb9b097,_0x1f043b){var _0x4b0922=a0_0x3d80eb,_0x4a34dc=[],_0x1f2a70=[];if(_0xb9b097==_0x4b0922(0x14f)){switch(_0x1f043b){case'Rack\x201':_0x4a34dc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x4b0922(0x17f):_0x4a34dc=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1f2a70=['DG'];}else{if(_0xb9b097==_0x4b0922(0x1a9)){switch(_0x1f043b){case _0x4b0922(0x184):_0x4a34dc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4b0922(0x17f):_0x4a34dc=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1f2a70=['FG'];}}return{'levels':_0x4a34dc,'identify':_0x1f2a70};}async function getRandom8DigitNumber(){var _0x288b4c=a0_0x3d80eb;const _0xb717a6=0x989680,_0x57f5a0=0x5f5e0ff,_0x279378=Math[_0x288b4c(0x124)](Math[_0x288b4c(0x173)]()*(_0x57f5a0-_0xb717a6+0x1))+_0xb717a6;var _0x3336ce;const _0x1e10e9=await purchases_finished[_0x288b4c(0x1d5)]({'invoice':'INCF-'+_0x279378});return _0x1e10e9&&_0x1e10e9[_0x288b4c(0x207)]>0x0?_0x3336ce=_0x288b4c(0x1f0)+_0x279378:_0x3336ce=_0x288b4c(0x1f0)+_0x279378,_0x3336ce;}router[a0_0x3d80eb(0x1ca)](a0_0x3d80eb(0x142),auth,async(_0x341322,_0x580fc7)=>{var _0x590c78=a0_0x3d80eb;try{const {username:_0x3a1fa0,email:_0x113fb3,role:_0x3222eb}=_0x341322[_0x590c78(0x19b)],_0x4b2710=_0x341322[_0x590c78(0x19b)],_0x1acbb0=await profile[_0x590c78(0x1d5)]({'email':_0x4b2710['email']}),_0x5cbea5=await master_shop[_0x590c78(0x1cb)](),_0x23d4a8=await staff['findOne']({'email':_0x4b2710[_0x590c78(0x185)]}),_0x4397fb=await suppliers[_0x590c78(0x1cb)]({});let _0x4aaa93;if(_0x4b2710[_0x590c78(0x17a)]==_0x590c78(0x130)){const _0x5797cd=await staff[_0x590c78(0x1d5)]({'email':_0x4b2710[_0x590c78(0x185)]});_0x4aaa93=await warehouse[_0x590c78(0x1b5)]([{'$match':{'status':'Enabled','name':_0x5797cd['warehouse'],'warehouse_category':_0x590c78(0x19d)}},{'$group':{'_id':'$name','name':{'$first':_0x590c78(0x1d7)}}}]);}else _0x4aaa93=await warehouse[_0x590c78(0x1b5)]([{'$match':{'status':_0x590c78(0x14c),'warehouse_category':_0x590c78(0x19d),'name':{'$ne':_0x590c78(0x181)}}},{'$group':{'_id':'$name','name':{'$first':_0x590c78(0x1d7)}}}]);const _0x5c3819=await product[_0x590c78(0x1cb)]({}),_0x42ba71=await warehouse['find']({'status':'Enabled'}),_0x7f8386=await purchases_finished[_0x590c78(0x1cb)]({}),_0x5ea0cc=_0x7f8386['length']+0x1,_0x51033e=_0x590c78(0x1f0)+_0x5ea0cc[_0x590c78(0x120)]()[_0x590c78(0x189)](0x5,'0');var _0x4e1eaa=[_0x590c78(0x192),_0x590c78(0x121)];if(_0x5cbea5[0x0][_0x590c78(0x15d)]=='English\x20(US)')var _0x2830de=users[_0x590c78(0x1a6)];else{if(_0x5cbea5[0x0][_0x590c78(0x15d)]==_0x590c78(0x20e))var _0x2830de=users[_0x590c78(0x20e)];else{if(_0x5cbea5[0x0][_0x590c78(0x15d)]==_0x590c78(0x1d4))var _0x2830de=users[_0x590c78(0x1d4)];else{if(_0x5cbea5[0x0][_0x590c78(0x15d)]==_0x590c78(0x14e))var _0x2830de=users[_0x590c78(0x14e)];else{if(_0x5cbea5[0x0]['language']==_0x590c78(0x148))var _0x2830de=users[_0x590c78(0x148)];else{if(_0x5cbea5[0x0][_0x590c78(0x15d)]==_0x590c78(0x141))var _0x2830de=users['Portuguese'];else{if(_0x5cbea5[0x0][_0x590c78(0x15d)]=='Chinese')var _0x2830de=users[_0x590c78(0x1fa)];else{if(_0x5cbea5[0x0]['language']==_0x590c78(0x153))var _0x2830de=users['Arabic'];}}}}}}}const _0xf5bd42=getRandom8DigitNumber();_0xf5bd42[_0x590c78(0x13f)](_0x132790=>{var _0x1b5c9d=_0x590c78;_0x580fc7['render'](_0x1b5c9d(0x20b),{'success':_0x341322[_0x1b5c9d(0x16b)](_0x1b5c9d(0x1bc)),'errors':_0x341322[_0x1b5c9d(0x16b)](_0x1b5c9d(0x169)),'role':_0x4b2710,'profile':_0x1acbb0,'suppliers':_0x4397fb,'warehouse':_0x4aaa93,'product':_0x5c3819,'invoice':_0x132790,'master_shop':_0x5cbea5,'language':_0x2830de,'find_data':_0x42ba71,'rooms_data':_0x4e1eaa});})[_0x590c78(0x1cc)](_0x109d01=>{var _0x1ac3e3=_0x590c78;_0x341322[_0x1ac3e3(0x16b)](_0x1ac3e3(0x169),_0x1ac3e3(0x177)),_0x580fc7[_0x1ac3e3(0x123)](_0x1ac3e3(0x11c));});}catch(_0x262e90){console[_0x590c78(0x14a)](_0x262e90);}}),router[a0_0x3d80eb(0x1ca)](a0_0x3d80eb(0x119),auth,async(_0x26fa0d,_0x413cf9)=>{var _0x230f43=a0_0x3d80eb;try{const _0x1da5ba=_0x26fa0d[_0x230f43(0x186)]['id'];console[_0x230f43(0x14a)](_0x1da5ba);const _0x50f8c5=await master_shop['find']();console[_0x230f43(0x14a)]('master',_0x50f8c5);const _0xe7f00=await product[_0x230f43(0x1d5)]({'name':_0x1da5ba});console[_0x230f43(0x14a)](_0x230f43(0x1ba),_0xe7f00),_0x413cf9[_0x230f43(0x187)](0xc8)[_0x230f43(0x172)]({'product_data':_0xe7f00,'master':_0x50f8c5});}catch(_0x5a58c1){console[_0x230f43(0x14a)](_0x230f43(0x19e),_0x5a58c1);}}),router[a0_0x3d80eb(0x191)]('/view/add_purchases',auth,async(_0x4fe3aa,_0x247fe6)=>{var _0x29abc3=a0_0x3d80eb;try{const {invoice:_0x3200ef,date:_0x29c67f,warehouse_name:_0x2a5843,prod_name:_0x324368,prod_code:_0x46ad18,prod_qty:_0x6f7f93,prod_unit:_0xc1040b,prod_secondunit:_0x3f2eef,prod_level:_0x2af284,prod_isle:_0x5722a4,prod_pallet:_0x544177,note:_0x2cf563,expiry_date:_0x111073,batch_code:_0xb7fd60,payable:_0x5b7e19,due_amount:_0x5b6532,Room_name:_0x31f4e6,primary_code:_0x126a95,secondary_code:_0x24aeb6,MaxStocks_data:_0x1be353,PO_number:_0x1cb69f,SCRN:_0x464d2a,JO_number:_0x58846d}=_0x4fe3aa[_0x29abc3(0x1f3)];if(typeof _0x324368==_0x29abc3(0x15b))var _0x8a00da=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x195)]],_0x5087c0=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x15f)]],_0x42f14a=[_0x4fe3aa['body'][_0x29abc3(0x1fd)]],_0x44598e=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x1da)]],_0x3c05a2=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x18c)]],_0x566b52=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x194)]],_0x2f7f62=[_0x4fe3aa['body'][_0x29abc3(0x1dc)]],_0x283b8b=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x113)]],_0x4b5f04=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x14d)]],_0x3a7b94=[_0x4fe3aa[_0x29abc3(0x1f3)]['batch_code']],_0x4a5b62=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x1dd)]],_0x580cef=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x18e)]],_0x381fd6=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x193)]],_0x42e4b9=[_0x4fe3aa[_0x29abc3(0x1f3)]['prod_cat']],_0x24d830=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x1e4)]],_0xb97635=[_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x203)]];else var _0x8a00da=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x195)]],_0x5087c0=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x15f)]],_0x42f14a=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x1fd)]],_0x44598e=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x1da)]],_0x3c05a2=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x18c)]],_0x566b52=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x194)]],_0x2f7f62=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x1dc)]],_0x283b8b=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x113)]],_0x4b5f04=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x14d)]],_0x3a7b94=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x1d9)]],_0x4a5b62=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x1dd)]],_0x580cef=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x18e)]],_0x381fd6=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x193)]],_0x42e4b9=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x1e5)]],_0x24d830=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x1e4)]],_0xb97635=[..._0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x203)]];const _0x5ac81f=_0x8a00da[_0x29abc3(0x16f)](_0x5dcf4f=>{return _0x5dcf4f={'product_name':_0x5dcf4f};});_0x5087c0[_0x29abc3(0x1c7)]((_0x5121bf,_0x19e316)=>{var _0x518d9a=_0x29abc3;_0x5ac81f[_0x19e316][_0x518d9a(0x117)]=_0x5121bf;}),_0x42f14a['forEach']((_0x41a6ef,_0xbbfb42)=>{var _0x3a6d44=_0x29abc3;_0x5ac81f[_0xbbfb42][_0x3a6d44(0x150)]=Math[_0x3a6d44(0x1f1)](_0x41a6ef);}),_0x44598e[_0x29abc3(0x1c7)]((_0xc28721,_0x477f2c)=>{_0x5ac81f[_0x477f2c]['standard_unit']=_0xc28721;}),_0x3c05a2['forEach']((_0x2d09e3,_0xb411fb)=>{var _0x456690=_0x29abc3;_0x5ac81f[_0xb411fb][_0x456690(0x149)]=_0x2d09e3;}),_0x566b52['forEach']((_0x4f1b7,_0x395725)=>{var _0x4d251b=_0x29abc3;_0x5ac81f[_0x395725][_0x4d251b(0x19a)]=_0x4f1b7;}),_0x2f7f62['forEach']((_0x52d74e,_0x703f59)=>{_0x5ac81f[_0x703f59]['primary_code']=_0x52d74e;}),_0x283b8b[_0x29abc3(0x1c7)]((_0x5f222b,_0x453054)=>{var _0x21b093=_0x29abc3;_0x5ac81f[_0x453054][_0x21b093(0x113)]=_0x5f222b;}),_0x4b5f04[_0x29abc3(0x1c7)]((_0x133611,_0x226d5f)=>{_0x5ac81f[_0x226d5f]['maxStocks']=_0x133611;}),_0x3a7b94[_0x29abc3(0x1c7)]((_0x57b372,_0x21cccc)=>{var _0x33d647=_0x29abc3;_0x5ac81f[_0x21cccc][_0x33d647(0x1d9)]=_0x57b372;}),_0x4a5b62[_0x29abc3(0x1c7)]((_0x207b7b,_0x2568d8)=>{var _0x52af81=_0x29abc3;_0x5ac81f[_0x2568d8][_0x52af81(0x1dd)]=_0x207b7b;}),_0x580cef['forEach']((_0x21fe42,_0x236a06)=>{var _0x39cbe8=_0x29abc3;_0x5ac81f[_0x236a06][_0x39cbe8(0x16c)]=_0x21fe42;}),_0x381fd6[_0x29abc3(0x1c7)]((_0x46e0b7,_0x2b8ad4)=>{var _0x2d95f4=_0x29abc3;_0x5ac81f[_0x2b8ad4][_0x2d95f4(0x1a2)]=_0x46e0b7;}),_0x42e4b9[_0x29abc3(0x1c7)]((_0x55d85b,_0x449dfe)=>{var _0x2ce076=_0x29abc3;_0x5ac81f[_0x449dfe][_0x2ce076(0x182)]=_0x55d85b;}),_0x24d830['forEach']((_0x14232d,_0x2b94c0)=>{var _0x38dd97=_0x29abc3;_0x5ac81f[_0x2b94c0][_0x38dd97(0x1a8)]=_0x14232d;}),_0xb97635[_0x29abc3(0x1c7)]((_0x3e6b7b,_0x224856)=>{var _0x33e77e=_0x29abc3;_0x5ac81f[_0x224856][_0x33e77e(0x1f6)]=_0x3e6b7b;});const _0x175f53=_0x5ac81f[_0x29abc3(0x114)](_0xf0225d=>_0xf0225d[_0x29abc3(0x150)]!=='0'&&_0xf0225d[_0x29abc3(0x150)]!==''),_0x2a2c18=new purchases_finished({'invoice':_0x3200ef,'suppliers':_0x4fe3aa[_0x29abc3(0x1f3)][_0x29abc3(0x180)],'date':_0x29c67f,'warehouse_name':_0x2a5843,'product':_0x175f53,'note':_0x2cf563,'due_amount':_0x5b6532,'room':_0x31f4e6,'POnumber':_0x1cb69f,'SCRN':_0x464d2a,'JO_number':_0x58846d}),_0x25ce6c=await _0x2a2c18['save'](),_0x4dbf0d=await purchases_finished['findOne']({'invoice':_0x3200ef}),_0x52e2fc=_0x4dbf0d[_0x29abc3(0x1ba)][_0x29abc3(0x16f)](async _0x5bf29b=>{var _0x58a35f=_0x29abc3,_0x327ed1=await warehouse[_0x58a35f(0x1d5)]({'name':_0x2a5843,'room':_0x5bf29b[_0x58a35f(0x1a8)]}),_0x5d955d=0x0;const _0x5af869=_0x327ed1[_0x58a35f(0x140)][_0x58a35f(0x16f)](_0x55c8c6=>{var _0xbc55f1=_0x58a35f;console['log'](_0x55c8c6[_0xbc55f1(0x139)]+'=='+_0x5bf29b[_0xbc55f1(0x139)]+'&&'+_0x55c8c6[_0xbc55f1(0x19a)]+'=='+_0x5bf29b['bay']+'&&'+_0x55c8c6[_0xbc55f1(0x1dd)]+'=='+_0x5bf29b['expiry_date']+'&&'+_0x55c8c6[_0xbc55f1(0x16c)]+'=='+_0x5bf29b[_0xbc55f1(0x16c)]+'&&'+_0x55c8c6['batch_code']+'=='+_0x5bf29b[_0xbc55f1(0x1d9)]+'&&'+_0x55c8c6[_0xbc55f1(0x1f6)]+'=='+_0x4dbf0d[_0xbc55f1(0x1f6)]),_0x55c8c6[_0xbc55f1(0x139)]==_0x5bf29b[_0xbc55f1(0x139)]&&_0x55c8c6[_0xbc55f1(0x19a)]==_0x5bf29b[_0xbc55f1(0x19a)]&&_0x55c8c6[_0xbc55f1(0x1dd)]==_0x5bf29b[_0xbc55f1(0x1dd)]&&_0x55c8c6[_0xbc55f1(0x16c)]==_0x5bf29b['production_date']&&_0x55c8c6['batch_code']==_0x5bf29b[_0xbc55f1(0x1d9)]&&_0x55c8c6['invoice']==_0x4dbf0d[_0xbc55f1(0x1f6)]&&(_0x55c8c6[_0xbc55f1(0x1b2)]=Math[_0xbc55f1(0x1f1)](_0x55c8c6[_0xbc55f1(0x1b2)])+Math[_0xbc55f1(0x1f1)](_0x5bf29b[_0xbc55f1(0x150)]),_0x5d955d++);});return _0x5d955d=='0'&&(_0x327ed1[_0x58a35f(0x140)]=_0x327ed1[_0x58a35f(0x140)][_0x58a35f(0x20d)]({'product_name':_0x5bf29b[_0x58a35f(0x139)],'product_stock':Math['abs'](_0x5bf29b[_0x58a35f(0x150)]),'primary_code':_0x5bf29b[_0x58a35f(0x1dc)],'secondary_code':_0x5bf29b['secondary_code'],'product_code':_0x5bf29b[_0x58a35f(0x117)],'bay':_0x5bf29b[_0x58a35f(0x19a)],'maxProducts':_0x5bf29b['maxStocks'],'unit':_0x5bf29b[_0x58a35f(0x129)],'secondary_unit':_0x5bf29b['secondary_unit'],'expiry_date':_0x5bf29b[_0x58a35f(0x1dd)],'production_date':_0x5bf29b[_0x58a35f(0x16c)],'maxProducts':_0x5bf29b[_0x58a35f(0x208)],'maxPerUnit':_0x5bf29b[_0x58a35f(0x1a2)],'batch_code':_0x5bf29b[_0x58a35f(0x1d9)],'product_cat':_0x5bf29b[_0x58a35f(0x182)],'invoice':_0x5bf29b[_0x58a35f(0x1f6)]})),_0x327ed1;});Promise[_0x29abc3(0x1d3)](_0x52e2fc)[_0x29abc3(0x13f)](async _0x45e070=>{var _0x1d9636=_0x29abc3;try{for(const _0x3372df of _0x45e070){await warehouse[_0x1d9636(0x1ea)]({'_id':_0x3372df[_0x1d9636(0x13c)]},{'$addToSet':{'product_details':{'$each':_0x3372df['product_details']}}});}const _0x5d724b=await master_shop[_0x1d9636(0x1cb)](),_0x49cd04=await email_settings['findOne'](),_0x1e6b33=await supervisor_settings[_0x1d9636(0x1cb)]();var _0x358f77=_0x4dbf0d['product'],_0x574ae5='',_0x2d675d;for(_0x2d675d in _0x358f77){var _0xbe6b80='FG';_0x4dbf0d[_0x1d9636(0x13d)]=='DRY\x20GOODS'&&(_0xbe6b80='DG'),_0x574ae5+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x358f77[_0x2d675d][_0x1d9636(0x139)]+_0x1d9636(0x175)+_0x1d9636(0x161)+_0x358f77[_0x2d675d][_0x1d9636(0x117)]+_0x1d9636(0x175)+_0x1d9636(0x161)+_0x358f77[_0x2d675d][_0x1d9636(0x150)]+_0x1d9636(0x175)+_0x1d9636(0x161)+_0x358f77[_0x2d675d][_0x1d9636(0x129)]+'</td>'+_0x1d9636(0x161)+_0x358f77[_0x2d675d]['secondary_unit']+'</td>'+_0x1d9636(0x161)+_0x4dbf0d[_0x1d9636(0x13d)]+_0x1d9636(0x175)+_0x1d9636(0x161)+_0x358f77[_0x2d675d][_0x1d9636(0x1a8)]+_0x1d9636(0x175)+_0x1d9636(0x161)+_0xbe6b80+_0x358f77[_0x2d675d][_0x1d9636(0x19a)]+_0x1d9636(0x175),'</tr>';}let _0x2c0a24=nodemailer[_0x1d9636(0x1d2)]({'host':_0x49cd04['host'],'port':Number(_0x49cd04[_0x1d9636(0x125)]),'secure':![],'auth':{'user':_0x49cd04[_0x1d9636(0x185)],'pass':_0x49cd04[_0x1d9636(0x15a)]}}),_0x49d42b={'from':_0x49cd04['email'],'to':_0x1e6b33[0x0][_0x1d9636(0x13e)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x1d9636(0x13b)+'/upload/'+_0x5d724b[0x0]['image'],'cid':'logo'}],'html':_0x1d9636(0x160)+_0x1d9636(0x12d)+_0x1d9636(0x1a1)+_0x1d9636(0x12f)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1d9636(0x12f)+_0x1d9636(0x144)+_0x1d9636(0x112)+'<div>'+_0x1d9636(0x133)+_0x5d724b[0x0][_0x1d9636(0x1e8)]+'\x20</h2>'+_0x1d9636(0x112)+_0x1d9636(0x112)+_0x1d9636(0x151)+_0x1d9636(0x12f)+_0x1d9636(0x127)+_0x1d9636(0x15c)+_0x4dbf0d[_0x1d9636(0x1f6)]+'\x20'+_0x1d9636(0x1c5)+_0x1d9636(0x20c)+_0x4dbf0d[_0x1d9636(0x1b7)]+'\x20'+_0x1d9636(0x134)+'</h5>'+'</div>'+_0x1d9636(0x11f)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1d9636(0x145)+_0x1d9636(0x1c3)+_0x1d9636(0x166)+_0x1d9636(0x1b8)+_0x1d9636(0x1f5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x1d9636(0x17b)+_0x1d9636(0x1c1)+_0x1d9636(0x179)+'</tr>'+_0x1d9636(0x18d)+_0x1d9636(0x156)+'\x20'+_0x574ae5+'\x20'+'</tbody>'+'</table>'+_0x1d9636(0x12f)+_0x1d9636(0x1a0)+'<h5>'+_0x5d724b[0x0]['site_title']+'</h5>'+_0x1d9636(0x112)+_0x1d9636(0x112)+_0x1d9636(0x16a)};_0x2c0a24[_0x1d9636(0x122)](_0x49d42b,function(_0x346dd4,_0x30ed66){var _0x4c362b=_0x1d9636;_0x346dd4?(console['log'](_0x346dd4),console[_0x4c362b(0x14a)](_0x4c362b(0x115))):console[_0x4c362b(0x14a)](_0x4c362b(0x147));});}catch(_0x2a0a4e){console[_0x1d9636(0x17c)](_0x2a0a4e),_0x247fe6[_0x1d9636(0x187)](0x1f4)[_0x1d9636(0x172)]({'error':_0x1d9636(0x1c2),'message':_0x2a0a4e[_0x1d9636(0x18a)]});}})['catch'](_0x5779b2=>{var _0x4702e3=_0x29abc3;console[_0x4702e3(0x17c)](_0x5779b2),_0x247fe6['status'](0x1f4)['json']({'error':_0x4702e3(0x164)});}),_0x4fe3aa[_0x29abc3(0x16b)](_0x29abc3(0x1bc),'purchase\x20data\x20add\x20successfully'),_0x247fe6[_0x29abc3(0x123)]('/all_purchases_finished/view');}catch(_0x3e6902){console[_0x29abc3(0x14a)](_0x3e6902);}}),router[a0_0x3d80eb(0x1ca)](a0_0x3d80eb(0x196),auth,async(_0x4b30d2,_0x5a4d67)=>{var _0x3884ae=a0_0x3d80eb;try{const {username:_0x531d6a,email:_0x1d87ff,role:_0x410756}=_0x4b30d2[_0x3884ae(0x19b)],_0x59ff48=_0x4b30d2['user'],_0x4d674e=await profile[_0x3884ae(0x1d5)]({'email':_0x59ff48['email']}),_0x3bf773=await master_shop[_0x3884ae(0x1cb)](),_0x47322d=_0x4b30d2[_0x3884ae(0x186)]['id'],_0x4f96c5=await purchases_finished[_0x3884ae(0x155)](_0x47322d),_0x32b246=await suppliers[_0x3884ae(0x1cb)]({});let _0x27eac7;if(_0x59ff48[_0x3884ae(0x17a)]==_0x3884ae(0x130)){const _0x2a0223=await staff[_0x3884ae(0x1d5)]({'email':_0x59ff48[_0x3884ae(0x185)]});_0x27eac7=await warehouse['find']({'status':_0x3884ae(0x14c),'name':_0x2a0223[_0x3884ae(0x1a7)],'warehouse_category':_0x3884ae(0x19d)});}else _0x27eac7=await warehouse['aggregate']([{'$match':{'status':_0x3884ae(0x14c),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x3884ae(0x1d7),'name':{'$first':_0x3884ae(0x1d7)}}}]);const _0x18d8ca=await product[_0x3884ae(0x1cb)]({}),_0x45d8=BayBinSelected(_0x4f96c5[_0x3884ae(0x13d)],_0x4f96c5[_0x3884ae(0x12e)]);let _0x554f39=new Date(_0x4f96c5[_0x3884ae(0x1dd)]),_0x2e8c94=('0'+_0x554f39['getDate']())[_0x3884ae(0x176)](-0x2),_0x39f643=('0'+(_0x554f39[_0x3884ae(0x1c6)]()+0x1))[_0x3884ae(0x176)](-0x2),_0x7f8245=_0x554f39['getFullYear'](),_0x3fc81d=_0x7f8245+'-'+_0x39f643+'-'+_0x2e8c94;if(_0x3bf773[0x0][_0x3884ae(0x15d)]=='English\x20(US)'){var _0x220d35=users[_0x3884ae(0x1a6)];console[_0x3884ae(0x14a)](_0x220d35);}else{if(_0x3bf773[0x0][_0x3884ae(0x15d)]==_0x3884ae(0x20e))var _0x220d35=users['Hindi'];else{if(_0x3bf773[0x0]['language']==_0x3884ae(0x1d4))var _0x220d35=users[_0x3884ae(0x1d4)];else{if(_0x3bf773[0x0]['language']==_0x3884ae(0x14e))var _0x220d35=users['Spanish'];else{if(_0x3bf773[0x0][_0x3884ae(0x15d)]=='French')var _0x220d35=users[_0x3884ae(0x148)];else{if(_0x3bf773[0x0][_0x3884ae(0x15d)]==_0x3884ae(0x141))var _0x220d35=users[_0x3884ae(0x12c)];else{if(_0x3bf773[0x0][_0x3884ae(0x15d)]==_0x3884ae(0x1fa))var _0x220d35=users[_0x3884ae(0x1fa)];else{if(_0x3bf773[0x0]['language']=='Arabic\x20(ae)')var _0x220d35=users['Arabic'];}}}}}}}_0x5a4d67[_0x3884ae(0x1ee)](_0x3884ae(0x205),{'success':_0x4b30d2['flash'](_0x3884ae(0x1bc)),'errors':_0x4b30d2[_0x3884ae(0x16b)](_0x3884ae(0x169)),'role':_0x59ff48,'profile':_0x4d674e,'purchases':_0x4f96c5,'suppliers':_0x32b246,'warehouse':_0x27eac7,'product':_0x18d8ca,'master_shop':_0x3bf773,'language':_0x220d35,'ed_fullDate':_0x3fc81d,'dataSelected':_0x45d8});}catch(_0x499af8){console[_0x3884ae(0x14a)](_0x499af8);}}),router[a0_0x3d80eb(0x1ca)](a0_0x3d80eb(0x171),auth,async(_0x43b5e3,_0x2dec66)=>{var _0x46b8b5=a0_0x3d80eb;try{const {username:_0x2042e9,email:_0x5ce9d1,role:_0x55c92e}=_0x43b5e3['user'],_0x13dda4=_0x43b5e3[_0x46b8b5(0x19b)],_0x41f7e8=await profile[_0x46b8b5(0x1d5)]({'email':_0x13dda4['email']}),_0x6d42a6=await master_shop[_0x46b8b5(0x1cb)](),_0x3fb712=_0x43b5e3['params']['id'],_0x27705a=await purchases_finished[_0x46b8b5(0x155)](_0x3fb712),_0x1ebc75=await suppliers[_0x46b8b5(0x1cb)]({});let _0x1f1782;if(_0x13dda4['role']==_0x46b8b5(0x130)){const _0xaf50f8=await staff['findOne']({'email':_0x13dda4['email']});_0x1f1782=await warehouse[_0x46b8b5(0x1cb)]({'status':_0x46b8b5(0x14c),'name':_0xaf50f8[_0x46b8b5(0x1a7)],'warehouse_category':'Finished\x20Goods'});}else _0x1f1782=await warehouse[_0x46b8b5(0x1b5)]([{'$match':{'status':'Enabled','warehouse_category':_0x46b8b5(0x19d)}},{'$group':{'_id':_0x46b8b5(0x1d7),'name':{'$first':_0x46b8b5(0x1d7)}}}]);const _0x450f9e=await product['find']({}),_0x144e24=BayBinSelected(_0x27705a[_0x46b8b5(0x13d)],_0x27705a[_0x46b8b5(0x12e)]);let _0x5cb733=new Date(_0x27705a['expiry_date']),_0x11a65b=('0'+_0x5cb733[_0x46b8b5(0x1c0)]())[_0x46b8b5(0x176)](-0x2),_0x3d5f2e=('0'+(_0x5cb733[_0x46b8b5(0x1c6)]()+0x1))[_0x46b8b5(0x176)](-0x2),_0x408d95=_0x5cb733[_0x46b8b5(0x13a)](),_0x45c927=_0x408d95+'-'+_0x3d5f2e+'-'+_0x11a65b;if(_0x6d42a6[0x0][_0x46b8b5(0x15d)]==_0x46b8b5(0x1f8)){var _0x317c08=users[_0x46b8b5(0x1a6)];console[_0x46b8b5(0x14a)](_0x317c08);}else{if(_0x6d42a6[0x0][_0x46b8b5(0x15d)]==_0x46b8b5(0x20e))var _0x317c08=users[_0x46b8b5(0x20e)];else{if(_0x6d42a6[0x0]['language']==_0x46b8b5(0x1d4))var _0x317c08=users[_0x46b8b5(0x1d4)];else{if(_0x6d42a6[0x0][_0x46b8b5(0x15d)]==_0x46b8b5(0x14e))var _0x317c08=users[_0x46b8b5(0x14e)];else{if(_0x6d42a6[0x0][_0x46b8b5(0x15d)]=='French')var _0x317c08=users[_0x46b8b5(0x148)];else{if(_0x6d42a6[0x0][_0x46b8b5(0x15d)]==_0x46b8b5(0x141))var _0x317c08=users[_0x46b8b5(0x12c)];else{if(_0x6d42a6[0x0][_0x46b8b5(0x15d)]==_0x46b8b5(0x1fa))var _0x317c08=users[_0x46b8b5(0x1fa)];else{if(_0x6d42a6[0x0]['language']=='Arabic\x20(ae)')var _0x317c08=users[_0x46b8b5(0x1e3)];}}}}}}}_0x2dec66['render']('edit_purchases_finished',{'success':_0x43b5e3[_0x46b8b5(0x16b)]('success'),'errors':_0x43b5e3['flash'](_0x46b8b5(0x169)),'role':_0x13dda4,'profile':_0x41f7e8,'purchases':_0x27705a,'suppliers':_0x1ebc75,'warehouse':_0x1f1782,'product':_0x450f9e,'master_shop':_0x6d42a6,'language':_0x317c08,'ed_fullDate':_0x45c927,'dataSelected':_0x144e24});}catch(_0x870752){console[_0x46b8b5(0x14a)](_0x870752);}}),router[a0_0x3d80eb(0x191)](a0_0x3d80eb(0x171),auth,async(_0x5c3e82,_0x49c272)=>{var _0x142bc6=a0_0x3d80eb;try{const _0x4c24ce=_0x5c3e82[_0x142bc6(0x186)]['id'],_0x58bfe2=await purchases_finished['findOne']({'_id':_0x5c3e82[_0x142bc6(0x186)]['id']}),_0x5a3aa5=await warehouse[_0x142bc6(0x1d5)]({'name':_0x58bfe2[_0x142bc6(0x13d)],'room':_0x58bfe2[_0x142bc6(0x12e)]});_0x58bfe2[_0x142bc6(0x1ba)][_0x142bc6(0x1c7)](_0xb59270=>{var _0x405bdc=_0x142bc6;const _0x890c8a=_0x5a3aa5[_0x405bdc(0x140)][_0x405bdc(0x16f)](_0x525eb7=>{var _0x5c6160=_0x405bdc;_0x525eb7[_0x5c6160(0x139)]==_0xb59270[_0x5c6160(0x139)]&&_0x525eb7[_0x5c6160(0x19a)]==_0xb59270[_0x5c6160(0x19a)]&&(_0x525eb7[_0x5c6160(0x1b2)]=parseInt(_0x525eb7[_0x5c6160(0x1b2)])-parseInt(_0xb59270[_0x5c6160(0x150)]));});}),await _0x5a3aa5['save']();const {invoice:_0x4879ba,suppliers:_0x2092a5,date:_0x14f69f,warehouse_name:_0x52fab9,prod_name:_0x431c56,prod_code:_0xc6477c,prod_qty:_0x34ebfa,prod_unit:_0x752a49,prod_secondunit:_0x18a870,prod_level:_0xacffa0,prod_isle:_0x3f887e,prod_pallet:_0x4f6920,note:_0xf1980d,expiry_date:_0x3f4fa4,batch_code:_0x4e81df,paid_amount:_0x477ecd,due_amount:_0x49db5e,Room_name:_0x3194b5,primary_code:_0x3ea19c,secondary_code:_0x26cfe4,PO_number:_0x1cb460,JO_number:_0x578700}=_0x5c3e82[_0x142bc6(0x1f3)];if(typeof _0x431c56==_0x142bc6(0x15b))var _0x24e2be=[_0x5c3e82['body']['prod_name']],_0xc4066a=[_0x5c3e82[_0x142bc6(0x1f3)]['prod_code']],_0x17f2cf=[_0x5c3e82[_0x142bc6(0x1f3)][_0x142bc6(0x1f7)]],_0x218f95=[_0x5c3e82['body'][_0x142bc6(0x15e)]],_0x5d4e33=[_0x5c3e82[_0x142bc6(0x1f3)][_0x142bc6(0x18c)]],_0x2892b2=[_0x5c3e82[_0x142bc6(0x1f3)]['prod_level']],_0x22929f=[_0x5c3e82[_0x142bc6(0x1f3)][_0x142bc6(0x1dc)]],_0x5916ea=[_0x5c3e82[_0x142bc6(0x1f3)]['secondary_code']],_0x5cf754=[_0x5c3e82[_0x142bc6(0x1f3)]['MaxStocks_data']],_0x26bef7=[_0x5c3e82[_0x142bc6(0x1f3)][_0x142bc6(0x1d9)]],_0x568812=[_0x5c3e82[_0x142bc6(0x1f3)][_0x142bc6(0x1dd)]];else var _0x24e2be=[..._0x5c3e82[_0x142bc6(0x1f3)]['prod_name']],_0xc4066a=[..._0x5c3e82['body'][_0x142bc6(0x15f)]],_0x17f2cf=[..._0x5c3e82[_0x142bc6(0x1f3)]['prod_qty']],_0x218f95=[..._0x5c3e82[_0x142bc6(0x1f3)]['prod_unit']],_0x5d4e33=[..._0x5c3e82[_0x142bc6(0x1f3)]['prod_secondunit']],_0x2892b2=[..._0x5c3e82[_0x142bc6(0x1f3)][_0x142bc6(0x194)]],_0x22929f=[..._0x5c3e82[_0x142bc6(0x1f3)][_0x142bc6(0x1dc)]],_0x5916ea=[..._0x5c3e82[_0x142bc6(0x1f3)][_0x142bc6(0x113)]],_0x5cf754=[..._0x5c3e82['body']['MaxStocks_data']],_0x26bef7=[..._0x5c3e82['body'][_0x142bc6(0x1d9)]],_0x568812=[..._0x5c3e82['body'][_0x142bc6(0x1dd)]];const _0x3ae53a=_0x24e2be['map'](_0x263d5f=>{return _0x263d5f={'product_name':_0x263d5f};});_0xc4066a[_0x142bc6(0x1c7)]((_0x32a763,_0x21f52f)=>{var _0xc20375=_0x142bc6;_0x3ae53a[_0x21f52f][_0xc20375(0x117)]=_0x32a763;}),_0x17f2cf[_0x142bc6(0x1c7)]((_0x20fdf7,_0x44fb1d)=>{var _0x9ea61a=_0x142bc6;_0x3ae53a[_0x44fb1d][_0x9ea61a(0x150)]=_0x20fdf7;}),_0x218f95[_0x142bc6(0x1c7)]((_0x30340f,_0x2b0f93)=>{var _0x228395=_0x142bc6;_0x3ae53a[_0x2b0f93][_0x228395(0x129)]=_0x30340f;}),_0x5d4e33['forEach']((_0x4da2f8,_0x4b274f)=>{_0x3ae53a[_0x4b274f]['secondary_unit']=_0x4da2f8;}),_0x2892b2[_0x142bc6(0x1c7)]((_0x398017,_0x359ca2)=>{var _0x3e2f84=_0x142bc6;_0x3ae53a[_0x359ca2][_0x3e2f84(0x19a)]=_0x398017;}),_0x22929f['forEach']((_0x3f47ec,_0x308407)=>{var _0x20548e=_0x142bc6;_0x3ae53a[_0x308407][_0x20548e(0x1dc)]=_0x3f47ec;}),_0x5916ea[_0x142bc6(0x1c7)]((_0x1ebd11,_0x1ba229)=>{_0x3ae53a[_0x1ba229]['secondary_code']=_0x1ebd11;}),_0x5cf754['forEach']((_0x4b8a43,_0x2e1bff)=>{var _0x2e8bec=_0x142bc6;_0x3ae53a[_0x2e1bff][_0x2e8bec(0x208)]=_0x4b8a43;}),_0x26bef7['forEach']((_0x1650e8,_0x1ac388)=>{var _0x17eeb6=_0x142bc6;_0x3ae53a[_0x1ac388][_0x17eeb6(0x1d9)]=_0x1650e8;}),_0x568812[_0x142bc6(0x1c7)]((_0x2604b7,_0x15317d)=>{var _0x5a2186=_0x142bc6;_0x3ae53a[_0x15317d][_0x5a2186(0x1dd)]=_0x2604b7;});const _0x5df822=_0x3ae53a['filter'](_0x14a3d0=>_0x14a3d0['quantity']!=='0'&&_0x14a3d0[_0x142bc6(0x150)]!=='');_0x58bfe2[_0x142bc6(0x1f6)]=_0x4879ba,_0x58bfe2['suppliers']=_0x2092a5,_0x58bfe2[_0x142bc6(0x1b7)]=_0x14f69f,_0x58bfe2['warehouse_name']=_0x52fab9,_0x58bfe2[_0x142bc6(0x1ba)]=_0x5df822,_0x58bfe2['note']=_0xf1980d,_0x58bfe2['paid_amount']=_0x477ecd,_0x58bfe2[_0x142bc6(0x1ae)]=_0x49db5e,_0x58bfe2[_0x142bc6(0x12e)]=_0x3194b5,_0x58bfe2[_0x142bc6(0x17d)]=_0x1cb460,_0x58bfe2[_0x142bc6(0x12b)]=_0x578700;const _0xb0b9a9=await _0x58bfe2[_0x142bc6(0x20f)](),_0x56825a=await warehouse[_0x142bc6(0x1d5)]({'name':_0x5c3e82[_0x142bc6(0x1f3)]['warehouse_name'],'room':_0x5c3e82[_0x142bc6(0x1f3)]['Room_name']});_0x58bfe2[_0x142bc6(0x1ba)]['forEach'](_0x2da8bf=>{var _0x2aaf90=_0x142bc6,_0xa63b00=0x0;const _0x357295=_0x56825a[_0x2aaf90(0x140)][_0x2aaf90(0x16f)](_0x418818=>{var _0x1b1148=_0x2aaf90;_0x418818['product_name']==_0x2da8bf['product_name']&&_0x418818['bay']==_0x2da8bf[_0x1b1148(0x19a)]&&(_0x418818['product_stock']=parseInt(_0x418818[_0x1b1148(0x1b2)])+parseInt(_0x2da8bf['quantity']),_0xa63b00++);});_0xa63b00=='0'&&(_0x56825a[_0x2aaf90(0x140)]=_0x56825a[_0x2aaf90(0x140)][_0x2aaf90(0x20d)]({'product_name':_0x2da8bf[_0x2aaf90(0x139)],'product_stock':_0x2da8bf['quantity'],'primary_code':_0x2da8bf[_0x2aaf90(0x1dc)],'secondary_code':_0x2da8bf[_0x2aaf90(0x113)],'product_code':_0x2da8bf[_0x2aaf90(0x117)],'bay':_0x2da8bf[_0x2aaf90(0x19a)],'maxProducts':_0x2da8bf['maxStocks'],'unit':_0x2da8bf[_0x2aaf90(0x129)],'secondary_unit':_0x2da8bf[_0x2aaf90(0x149)],'expiry_date':_0x2da8bf[_0x2aaf90(0x1dd)]}));}),await _0x56825a[_0x142bc6(0x20f)]();const _0x3abf24=await s_payment_data[_0x142bc6(0x1d5)]({'invoice':_0x5c3e82[_0x142bc6(0x1f3)][_0x142bc6(0x1f6)]});if(_0x3abf24===null){}else console['log'](_0x142bc6(0x180),_0x3abf24,_0x5c3e82[_0x142bc6(0x1f3)][_0x142bc6(0x1f6)]),_0x3abf24['suppliers']=_0x5c3e82['body'][_0x142bc6(0x180)],await _0x3abf24[_0x142bc6(0x20f)]();_0x5c3e82[_0x142bc6(0x16b)](_0x142bc6(0x1bc),'purchase\x20data\x20update\x20successfully'),_0x49c272['redirect'](_0x142bc6(0x11c));}catch(_0x192340){console[_0x142bc6(0x14a)](_0x192340);}}),router[a0_0x3d80eb(0x191)](a0_0x3d80eb(0x1b1),auth,async(_0x33b6ba,_0x249b7d)=>{var _0x3f8987=a0_0x3d80eb;try{const _0x15d256=_0x33b6ba['params']['id'],{invoice:_0x427b49,suppliers:_0x1bb691,payable:_0x116626,due_amount:_0x114e02}=_0x33b6ba['body'],_0x32da32=await purchases[_0x3f8987(0x155)](_0x15d256);var _0x178b94=_0x116626-_0x114e02;_0x32da32[_0x3f8987(0x1ab)]=parseFloat(_0x32da32[_0x3f8987(0x1ab)])+parseFloat(_0x114e02),_0x32da32['due_amount']=_0x178b94;const _0x27d5ef=await _0x32da32[_0x3f8987(0x20f)]();console[_0x3f8987(0x14a)](_0x27d5ef);const _0x5b817c=await s_payment_data[_0x3f8987(0x1d5)]({'invoice':_0x427b49});_0x5b817c['amount']=_0x178b94,await _0x5b817c[_0x3f8987(0x20f)]();let _0x170ca6=new Date(),_0x55b23c=('0'+_0x170ca6[_0x3f8987(0x1c0)]())[_0x3f8987(0x176)](-0x2),_0x23728d=('0'+(_0x170ca6[_0x3f8987(0x1c6)]()+0x1))[_0x3f8987(0x176)](-0x2),_0x4ab3b7=_0x170ca6[_0x3f8987(0x13a)](),_0x80770a=_0x4ab3b7+'-'+_0x23728d+'-'+_0x55b23c;const _0x34fe07=new suppliers_payment({'invoice':_0x427b49,'date':_0x4ab3b7+'-'+_0x23728d+'-'+_0x55b23c,'suppliers':_0x1bb691,'reason':_0x3f8987(0x11a),'amount':_0x114e02}),_0x3984a6=await _0x34fe07[_0x3f8987(0x20f)]();_0x33b6ba[_0x3f8987(0x16b)](_0x3f8987(0x1bc),_0x3f8987(0x190)),_0x249b7d[_0x3f8987(0x123)]('/all_purchases/view');}catch(_0x178531){console[_0x3f8987(0x14a)](_0x178531);}}),router[a0_0x3d80eb(0x1ca)](a0_0x3d80eb(0x1bf),auth,async(_0x190cd2,_0x38e592)=>{var _0x4fe908=a0_0x3d80eb;try{const {username:_0x37e443,email:_0x2f9c6d,role:_0xc9c181}=_0x190cd2[_0x4fe908(0x19b)],_0x2f5b01=_0x190cd2['user'],_0x370645=await profile[_0x4fe908(0x1d5)]({'email':_0x2f5b01['email']}),_0x2bdfbc=await master_shop['find']();console[_0x4fe908(0x14a)](_0x4fe908(0x1ef),_0x2bdfbc);const _0x590521=_0x190cd2[_0x4fe908(0x186)]['id'],_0x36b8f1=await purchases['findById'](_0x590521);console['log'](_0x36b8f1);const _0x253418=await suppliers['findOne']({'name':_0x36b8f1[_0x4fe908(0x180)]});console[_0x4fe908(0x14a)](_0x253418);if(_0x2bdfbc[0x0][_0x4fe908(0x15d)]==_0x4fe908(0x1f8)){var _0xe9b021=users[_0x4fe908(0x1a6)];console[_0x4fe908(0x14a)](_0xe9b021);}else{if(_0x2bdfbc[0x0][_0x4fe908(0x15d)]==_0x4fe908(0x20e))var _0xe9b021=users[_0x4fe908(0x20e)];else{if(_0x2bdfbc[0x0][_0x4fe908(0x15d)]=='German')var _0xe9b021=users[_0x4fe908(0x1d4)];else{if(_0x2bdfbc[0x0][_0x4fe908(0x15d)]==_0x4fe908(0x14e))var _0xe9b021=users['Spanish'];else{if(_0x2bdfbc[0x0][_0x4fe908(0x15d)]==_0x4fe908(0x148))var _0xe9b021=users[_0x4fe908(0x148)];else{if(_0x2bdfbc[0x0][_0x4fe908(0x15d)]=='Portuguese\x20(BR)')var _0xe9b021=users['Portuguese'];else{if(_0x2bdfbc[0x0][_0x4fe908(0x15d)]==_0x4fe908(0x1fa))var _0xe9b021=users[_0x4fe908(0x1fa)];else{if(_0x2bdfbc[0x0][_0x4fe908(0x15d)]==_0x4fe908(0x153))var _0xe9b021=users[_0x4fe908(0x1e3)];}}}}}}}_0x38e592[_0x4fe908(0x1ee)](_0x4fe908(0x202),{'success':_0x190cd2[_0x4fe908(0x16b)]('success'),'errors':_0x190cd2[_0x4fe908(0x16b)]('errors'),'role':_0x2f5b01,'profile':_0x370645,'master_shop':_0x2bdfbc,'supplier':_0x253418,'purchase':_0x36b8f1,'language':_0xe9b021});}catch(_0xe02910){console[_0x4fe908(0x14a)](_0xe02910);}}),router[a0_0x3d80eb(0x1ca)](a0_0x3d80eb(0x1db),auth,async(_0x223495,_0x39766c)=>{var _0x10fd1d=a0_0x3d80eb;try{const {username:_0x434bad,email:_0x15eef8,role:_0x464466}=_0x223495[_0x10fd1d(0x19b)],_0x599d65=_0x223495[_0x10fd1d(0x19b)],_0x50328c=await profile['findOne']({'email':_0x599d65['email']}),_0x740245=await master_shop[_0x10fd1d(0x1cb)]();console['log'](_0x10fd1d(0x1ef),_0x740245);const _0x30fc19=_0x223495[_0x10fd1d(0x186)]['id'];console['log'](_0x30fc19);const _0x3b9dd3=await purchases_finished[_0x10fd1d(0x155)](_0x30fc19);console[_0x10fd1d(0x14a)](_0x10fd1d(0x1fe),_0x3b9dd3);const _0x10aa67=await product[_0x10fd1d(0x1cb)]({}),_0x480834=await warehouse[_0x10fd1d(0x1b5)]([{'$match':{'name':_0x3b9dd3[_0x10fd1d(0x13d)],'room':_0x3b9dd3[_0x10fd1d(0x12e)]}},{'$unwind':_0x10fd1d(0x1b3)},{'$group':{'_id':_0x10fd1d(0x158),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x10fd1d(0x1f9)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x10fd1d(0x19f)},'type':{'$first':_0x10fd1d(0x1e0)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x10fd1d(0x206)},'secondary_code':{'$first':_0x10fd1d(0x199)},'product_code':{'$first':_0x10fd1d(0x138)},'storage':{'$first':_0x10fd1d(0x1a4)},'rack':{'$first':_0x10fd1d(0x1ce)}}}]);console[_0x10fd1d(0x14a)]('stock_data',_0x480834);let _0x4ab83f;if(_0x599d65[_0x10fd1d(0x17a)]==_0x10fd1d(0x130)){const _0x46afbd=await staff[_0x10fd1d(0x1d5)]({'email':_0x599d65['email']});_0x4ab83f=await warehouse[_0x10fd1d(0x1cb)]({'status':'Enabled','name':_0x46afbd[_0x10fd1d(0x1a7)],'warehouse_category':_0x10fd1d(0x19d),'name':_0x10fd1d(0x1e7)});}else _0x4ab83f=await warehouse[_0x10fd1d(0x1b5)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':_0x10fd1d(0x1e7)}},{'$group':{'_id':_0x10fd1d(0x1d7),'name':{'$first':'$name'}}}]);if(_0x740245[0x0][_0x10fd1d(0x15d)]==_0x10fd1d(0x1f8)){var _0x150539=users['English'];console[_0x10fd1d(0x14a)](_0x150539);}else{if(_0x740245[0x0][_0x10fd1d(0x15d)]==_0x10fd1d(0x20e))var _0x150539=users[_0x10fd1d(0x20e)];else{if(_0x740245[0x0][_0x10fd1d(0x15d)]==_0x10fd1d(0x1d4))var _0x150539=users['German'];else{if(_0x740245[0x0][_0x10fd1d(0x15d)]==_0x10fd1d(0x14e))var _0x150539=users[_0x10fd1d(0x14e)];else{if(_0x740245[0x0][_0x10fd1d(0x15d)]==_0x10fd1d(0x148))var _0x150539=users['French'];else{if(_0x740245[0x0][_0x10fd1d(0x15d)]=='Portuguese\x20(BR)')var _0x150539=users[_0x10fd1d(0x12c)];else{if(_0x740245[0x0][_0x10fd1d(0x15d)]==_0x10fd1d(0x1fa))var _0x150539=users[_0x10fd1d(0x1fa)];else{if(_0x740245[0x0][_0x10fd1d(0x15d)]==_0x10fd1d(0x153))var _0x150539=users['Arabic'];}}}}}}}_0x39766c[_0x10fd1d(0x1ee)](_0x10fd1d(0x20a),{'success':_0x223495[_0x10fd1d(0x16b)](_0x10fd1d(0x1bc)),'errors':_0x223495[_0x10fd1d(0x16b)](_0x10fd1d(0x169)),'role':_0x599d65,'profile':_0x50328c,'user':_0x3b9dd3,'stock':_0x480834,'master_shop':_0x740245,'product':_0x10aa67,'language':_0x150539,'warehouse':_0x4ab83f});}catch(_0x5710c1){console[_0x10fd1d(0x14a)](_0x5710c1);}}),router['post'](a0_0x3d80eb(0x1db),auth,async(_0x308bf6,_0x5b6629)=>{var _0x5303d4=a0_0x3d80eb;try{const {invoice:_0xbf9a9e,date:_0x463ecb,warehouse_name:_0x296b5f,Room_name:_0x2d1346,product_name:_0x2d9245,purchase_quantity:_0x2232a2,stocks:_0x57018e,return_qty:_0x849ae,note:_0x4cf066,level:_0x1e9296,isle:_0x491570,pallet:_0x51cf77,to_warehouse_name:_0xec8974,to_Room_name:_0x3b72c1}=_0x308bf6[_0x5303d4(0x1f3)],_0x18d2d1=await purchases_finished[_0x5303d4(0x1d5)]({'_id':_0x308bf6[_0x5303d4(0x186)]['id']}),_0x19bc3b=await warehouse['findOne']({'name':_0x296b5f,'room':_0x2d1346,'warehouse_category':_0x5303d4(0x19d)});if(typeof _0x2d9245==_0x5303d4(0x15b))var _0x2f65c5=[_0x308bf6['body'][_0x5303d4(0x139)]],_0x5f48aa=[_0x308bf6[_0x5303d4(0x1f3)][_0x5303d4(0x1e2)]],_0x1bc6f1=[_0x308bf6[_0x5303d4(0x1f3)][_0x5303d4(0x1ad)]],_0x4cdfed=[_0x308bf6['body']['return_qty']],_0x1b20eb=[_0x308bf6[_0x5303d4(0x1f3)][_0x5303d4(0x1ac)]],_0x21a187=[_0x308bf6['body'][_0x5303d4(0x168)]],_0x28cd39=[_0x308bf6[_0x5303d4(0x1f3)][_0x5303d4(0x167)]],_0x4e3ecf=[_0x308bf6[_0x5303d4(0x1f3)][_0x5303d4(0x1d8)]];else var _0x2f65c5=[..._0x308bf6[_0x5303d4(0x1f3)][_0x5303d4(0x139)]],_0x5f48aa=[..._0x308bf6[_0x5303d4(0x1f3)]['purchase_quantity']],_0x1bc6f1=[..._0x308bf6[_0x5303d4(0x1f3)][_0x5303d4(0x1ad)]],_0x4cdfed=[..._0x308bf6[_0x5303d4(0x1f3)][_0x5303d4(0x1d0)]],_0x1b20eb=[..._0x308bf6[_0x5303d4(0x1f3)][_0x5303d4(0x1ac)]],_0x21a187=[..._0x308bf6[_0x5303d4(0x1f3)][_0x5303d4(0x168)]],_0x28cd39=[..._0x308bf6[_0x5303d4(0x1f3)]['primary_code_hide']],_0x4e3ecf=[..._0x308bf6[_0x5303d4(0x1f3)]['secondary_code_hide']];const _0x1683f4=_0x2f65c5[_0x5303d4(0x16f)](_0x49f158=>{return _0x49f158={'product_name':_0x49f158};});_0x5f48aa['forEach']((_0x130556,_0x4f3ecd)=>{var _0x178e70=_0x5303d4;_0x1683f4[_0x4f3ecd][_0x178e70(0x1e2)]=_0x130556;}),_0x1bc6f1[_0x5303d4(0x1c7)]((_0x814317,_0x1ab5a3)=>{var _0x3ba16d=_0x5303d4;_0x1683f4[_0x1ab5a3][_0x3ba16d(0x170)]=_0x814317;}),_0x4cdfed['forEach']((_0x2ffb36,_0x1a2af7)=>{var _0x41fda2=_0x5303d4;_0x1683f4[_0x1a2af7][_0x41fda2(0x1d0)]=_0x2ffb36;}),_0x1b20eb[_0x5303d4(0x1c7)]((_0x44bc31,_0x2f567a)=>{var _0x46b1de=_0x5303d4;_0x1683f4[_0x2f567a][_0x46b1de(0x19a)]=_0x44bc31;}),_0x21a187[_0x5303d4(0x1c7)]((_0x42941b,_0x4cf62a)=>{var _0x2597ba=_0x5303d4;_0x1683f4[_0x4cf62a][_0x2597ba(0x117)]=_0x42941b;}),_0x28cd39['forEach']((_0x2a502e,_0x8f296e)=>{var _0x460192=_0x5303d4;_0x1683f4[_0x8f296e][_0x460192(0x1dc)]=_0x2a502e;}),_0x4e3ecf[_0x5303d4(0x1c7)]((_0x2a78b0,_0x2627ae)=>{var _0x326492=_0x5303d4;_0x1683f4[_0x2627ae][_0x326492(0x113)]=_0x2a78b0;}),_0x1683f4[_0x5303d4(0x1c7)](_0x382223=>{var _0x31f57e=_0x5303d4;console['log'](_0x382223);const _0x2d38b9=_0x19bc3b['product_details'][_0x31f57e(0x16f)](_0x42d00d=>{var _0x4d55cb=_0x31f57e;_0x42d00d[_0x4d55cb(0x139)]==_0x382223['product_name']&&_0x42d00d[_0x4d55cb(0x19a)]==_0x382223[_0x4d55cb(0x19a)]&&(console[_0x4d55cb(0x14a)](parseInt(_0x42d00d[_0x4d55cb(0x1b2)])+_0x4d55cb(0x174)+parseInt(_0x382223['return_qty'])),_0x42d00d[_0x4d55cb(0x1b2)]=parseInt(_0x42d00d['product_stock'])-parseInt(_0x382223['return_qty']));});}),await _0x19bc3b[_0x5303d4(0x20f)]();var _0x131ee7=0x0;_0x1683f4[_0x5303d4(0x1c7)](_0x1cc76d=>{var _0x445070=_0x5303d4;(parseInt(_0x1cc76d[_0x445070(0x1e2)])<parseInt(_0x1cc76d[_0x445070(0x1d0)])||parseInt(_0x1cc76d[_0x445070(0x170)])<parseInt(_0x1cc76d[_0x445070(0x1d0)]))&&_0x131ee7++;});if(_0x131ee7!=0x0)return _0x308bf6[_0x5303d4(0x16b)](_0x5303d4(0x169),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x5b6629[_0x5303d4(0x123)]('back');const _0x548d4a=new purchases_return_finished({'invoice':_0xbf9a9e,'suppliers':_0x308bf6[_0x5303d4(0x1f3)]['suppliers'],'date':_0x463ecb,'warehouse_name':_0x296b5f,'return_product':_0x1683f4,'note':_0x4cf066,'room':_0x2d1346,'to_warehouse_name':_0xec8974,'to_room':_0x3b72c1}),_0x393bb8=await _0x548d4a[_0x5303d4(0x20f)](),_0x27b338=await purchases_return_finished[_0x5303d4(0x1d5)]({'invoice':_0xbf9a9e}),_0x3f5f5b=await warehouse[_0x5303d4(0x1d5)]({'name':_0xec8974,'room':_0x3b72c1,'warehouse_category':_0x5303d4(0x19d)});_0x27b338[_0x5303d4(0x146)][_0x5303d4(0x1c7)](_0x55bcf9=>{var _0x9ec3cb=_0x5303d4,_0x1e2060=0x0;const _0x22a64f=_0x3f5f5b[_0x9ec3cb(0x140)][_0x9ec3cb(0x16f)](_0x3a0cc6=>{var _0x7fee9f=_0x9ec3cb;console[_0x7fee9f(0x14a)](_0x3a0cc6[_0x7fee9f(0x139)]+'=='+_0x55bcf9[_0x7fee9f(0x139)]+'&&'+_0x3a0cc6[_0x7fee9f(0x19a)]+'=='+_0x55bcf9[_0x7fee9f(0x19a)]),_0x3a0cc6[_0x7fee9f(0x139)]==_0x55bcf9[_0x7fee9f(0x139)]&&_0x3a0cc6[_0x7fee9f(0x19a)]==_0x55bcf9[_0x7fee9f(0x19a)]&&(_0x3a0cc6['product_stock']=parseInt(_0x3a0cc6[_0x7fee9f(0x1b2)])-parseInt(_0x55bcf9[_0x7fee9f(0x1d0)]),_0x1e2060++);});_0x1e2060=='0'&&(_0x3f5f5b[_0x9ec3cb(0x140)]=_0x3f5f5b[_0x9ec3cb(0x140)][_0x9ec3cb(0x20d)]({'product_name':_0x55bcf9[_0x9ec3cb(0x139)],'product_stock':_0x55bcf9[_0x9ec3cb(0x1d0)],'primary_code':_0x55bcf9[_0x9ec3cb(0x1dc)],'secondary_code':_0x55bcf9['secondary_code'],'product_code':_0x55bcf9['product_code'],'bay':_0x55bcf9[_0x9ec3cb(0x19a)],'maxProducts':0xf423f}));}),await _0x3f5f5b[_0x5303d4(0x20f)]();const _0x501e7d=await purchases_finished[_0x5303d4(0x1d5)]({'invoice':_0xbf9a9e});_0x501e7d['return_data']='True';const _0xeac7b0=await _0x501e7d[_0x5303d4(0x20f)](),_0x105453=new s_payment_data({'invoice':_0xbf9a9e,'suppliers':_0x308bf6['body'][_0x5303d4(0x180)],'reason':_0x5303d4(0x12a)});await _0x105453[_0x5303d4(0x20f)]();const _0x40059d=await master_shop['find'](),_0xebe382=await email_settings[_0x5303d4(0x1d5)](),_0x13b62c=await suppliers[_0x5303d4(0x1d5)]({'name':_0x308bf6[_0x5303d4(0x1f3)]['suppliers']});_0x40059d[0x0][_0x5303d4(0x1f2)]==0x1?(right_currency=_0x40059d[0x0][_0x5303d4(0x159)],left_currency=''):(right_currency='',left_currency=_0x40059d[0x0][_0x5303d4(0x159)]);var _0x389a6b=_0x2f65c5,_0x188cfe=_0x4cdfed,_0x4c60ef='',_0xecee1b;for(_0xecee1b in _0x389a6b){_0x4c60ef+=_0x5303d4(0x145)+_0x5303d4(0x161)+_0x389a6b[_0xecee1b]+_0x5303d4(0x175)+_0x5303d4(0x161)+_0x188cfe[_0xecee1b]+_0x5303d4(0x175)+_0x5303d4(0x11d);}let _0x4b9efe=nodemailer[_0x5303d4(0x1d2)]({'service':'gmail','auth':{'user':_0xebe382[_0x5303d4(0x185)],'pass':_0xebe382[_0x5303d4(0x15a)]}}),_0x475911={'from':_0xebe382['email'],'to':_0x13b62c['email'],'subject':_0x5303d4(0x163),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x5303d4(0x14b)+_0x40059d[0x0][_0x5303d4(0x1be)],'cid':'logo'}],'html':_0x5303d4(0x160)+'<html><head><title></title>'+_0x5303d4(0x1a1)+_0x5303d4(0x12f)+_0x5303d4(0x116)+_0x5303d4(0x12f)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5303d4(0x112)+_0x5303d4(0x12f)+'<h2>\x20'+_0x40059d[0x0][_0x5303d4(0x1e8)]+_0x5303d4(0x1e6)+_0x5303d4(0x112)+_0x5303d4(0x112)+_0x5303d4(0x151)+_0x5303d4(0x12f)+_0x5303d4(0x127)+_0x5303d4(0x15c)+_0xbf9a9e+'\x20'+_0x5303d4(0x1c5)+_0x5303d4(0x20c)+_0x463ecb+'\x20'+'</span>'+_0x5303d4(0x11e)+_0x5303d4(0x112)+_0x5303d4(0x11f)+_0x5303d4(0x1ff)+'<tr>'+_0x5303d4(0x1c3)+_0x5303d4(0x1c4)+_0x5303d4(0x1e1)+_0x5303d4(0x1fc)+_0x5303d4(0x11d)+_0x5303d4(0x18d)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4c60ef+'\x20'+_0x5303d4(0x131)+_0x5303d4(0x1f4)+'<div>'+_0x5303d4(0x1a0)+_0x5303d4(0x1b9)+_0x40059d[0x0][_0x5303d4(0x1e8)]+'</h5>'+_0x5303d4(0x112)+_0x5303d4(0x112)+_0x5303d4(0x16a)};_0x4b9efe[_0x5303d4(0x122)](_0x475911,function(_0x24e44e,_0x44f93d){var _0x555cef=_0x5303d4;_0x24e44e?console[_0x555cef(0x14a)](_0x555cef(0x115)):console[_0x555cef(0x14a)](_0x555cef(0x147));}),_0x308bf6[_0x5303d4(0x16b)](_0x5303d4(0x1bc),'purchases\x20item\x20return\x20successfull'),_0x5b6629[_0x5303d4(0x123)](_0x5303d4(0x11c));}catch(_0x11bbce){_0x5b6629[_0x5303d4(0x187)](0xc8)[_0x5303d4(0x172)]({'message':_0x11bbce['message']});}}),router['get']('/barcode/:id',auth,async(_0x53ec74,_0x263161)=>{var _0x3cb273=a0_0x3d80eb;try{const {username:_0xe75833,email:_0xd652d5,role:_0x285676}=_0x53ec74[_0x3cb273(0x19b)],_0x477934=_0x53ec74['user'],_0x4ce848=await profile[_0x3cb273(0x1d5)]({'email':_0x477934['email']}),_0x15a4d8=await master_shop['find'](),_0x445857=_0x53ec74[_0x3cb273(0x186)]['id'],_0x1ab2ab=await purchases_finished[_0x3cb273(0x155)](_0x445857);if(_0x15a4d8[0x0][_0x3cb273(0x15d)]==_0x3cb273(0x1f8))var _0x3ed613=users[_0x3cb273(0x1a6)];else{if(_0x15a4d8[0x0][_0x3cb273(0x15d)]=='Hindi')var _0x3ed613=users[_0x3cb273(0x20e)];else{if(_0x15a4d8[0x0][_0x3cb273(0x15d)]==_0x3cb273(0x1d4))var _0x3ed613=users[_0x3cb273(0x1d4)];else{if(_0x15a4d8[0x0]['language']==_0x3cb273(0x14e))var _0x3ed613=users[_0x3cb273(0x14e)];else{if(_0x15a4d8[0x0][_0x3cb273(0x15d)]==_0x3cb273(0x148))var _0x3ed613=users[_0x3cb273(0x148)];else{if(_0x15a4d8[0x0]['language']==_0x3cb273(0x141))var _0x3ed613=users['Portuguese'];else{if(_0x15a4d8[0x0][_0x3cb273(0x15d)]==_0x3cb273(0x1fa))var _0x3ed613=users[_0x3cb273(0x1fa)];else{if(_0x15a4d8[0x0][_0x3cb273(0x15d)]==_0x3cb273(0x153))var _0x3ed613=users[_0x3cb273(0x1e3)];}}}}}}}_0x263161[_0x3cb273(0x1ee)](_0x3cb273(0x1d6),{'success':_0x53ec74['flash'](_0x3cb273(0x1bc)),'errors':_0x53ec74[_0x3cb273(0x16b)]('errors'),'role':_0x477934,'profile':_0x4ce848,'alldata':_0x1ab2ab,'master_shop':_0x15a4d8,'language':_0x3ed613}),console[_0x3cb273(0x14a)](alldata);}catch(_0x194dd4){console[_0x3cb273(0x14a)](_0x194dd4);}}),router[a0_0x3d80eb(0x191)](a0_0x3d80eb(0x198),async(_0x502129,_0x318d3a)=>{var _0x3f9b03=a0_0x3d80eb;const {product_code:_0xeb060e}=_0x502129[_0x3f9b03(0x1f3)];var _0x843bbd;const _0x5b1037=await product[_0x3f9b03(0x1b5)]([{'$match':{'primary_code':_0xeb060e,'product_category':_0x3f9b03(0x19d)}},{'$group':{'_id':_0x3f9b03(0x1cf),'name':{'$first':_0x3f9b03(0x1d7)},'category':{'$first':_0x3f9b03(0x1aa)},'brand':{'$first':_0x3f9b03(0x1a3)},'unit':{'$first':_0x3f9b03(0x162)},'alertquantity':{'$first':_0x3f9b03(0x136)},'product_code':{'$first':_0x3f9b03(0x1ec)},'primary_code':{'$first':_0x3f9b03(0x1b0)},'secondary_code':{'$first':_0x3f9b03(0x204)},'maxStocks':{'$first':_0x3f9b03(0x154)},'maxProdPerUnit':{'$first':_0x3f9b03(0x1af)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3f9b03(0x1bb)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5538f3=await product['aggregate']([{'$match':{'secondary_code':_0xeb060e}},{'$group':{'_id':_0x3f9b03(0x1cf),'name':{'$first':'$name'},'category':{'$first':_0x3f9b03(0x1aa)},'brand':{'$first':_0x3f9b03(0x1a3)},'unit':{'$first':_0x3f9b03(0x162)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3f9b03(0x1ec)},'primary_code':{'$first':_0x3f9b03(0x1b0)},'secondary_code':{'$first':_0x3f9b03(0x204)},'maxStocks':{'$first':_0x3f9b03(0x154)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3f9b03(0x1bb)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5b1037[_0x3f9b03(0x207)]>0x0)_0x843bbd=_0x5b1037;else _0x5538f3[_0x3f9b03(0x207)]>0x0&&(_0x843bbd=_0x5538f3);_0x318d3a[_0x3f9b03(0x172)](_0x843bbd);}),router[a0_0x3d80eb(0x191)]('/CheckingWarehouse',async(_0x4adf55,_0x469d7a)=>{var _0x4f74df=a0_0x3d80eb;const {productCode:_0x120ecf,bay:_0x196f86,warehouses:_0x261135,room:_0x1a5d55}=_0x4adf55['body'];console[_0x4f74df(0x14a)](_0x4adf55[_0x4f74df(0x1f3)]);try{const _0x2d2140=await warehouse['aggregate']([{'$match':{'name':_0x261135,'room':_0x1a5d55}},{'$unwind':_0x4f74df(0x1b3)},{'$match':{'product_details.bay':parseInt(_0x196f86)}},{'$group':{'_id':_0x4f74df(0x158),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4f74df(0x1f9)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x4f74df(0x1eb)}}}]);_0x469d7a[_0x4f74df(0x187)](0xc8)['json'](_0x2d2140);}catch(_0x4120c5){_0x469d7a[_0x4f74df(0x187)](0x194)['json']({'message':_0x4120c5['message']});}}),module['exports']=router;