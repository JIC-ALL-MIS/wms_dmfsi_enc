function a0_0x3924(){var _0x4952ef=['room_name','$product_details.type','$unit','abs','<tbody\x20style=\x22text-align:\x20center;\x22>','site_title','prod_unit','$product_details','return_purchase_finished','prod_invoice','24FmsHZp','2471889ATLDjl','Router','nodemailer','product_stock','</body></html>','prod_qty','English\x20(US)','role','json','<div>','$product_details.product_stock','all','\x20Order\x20Date\x20:\x20','length','master','expiry_date','Rack\x202','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product_name','flash','product_details','prod_Qty','get','$expiry_date','$suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','English','$product_details.bay','padStart','primary_code','suppliers_docs','../middleware/auth','status','add_purchases_finished','image','$invoice','German','1269408fixKVn','params','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Arabic\x20(ae)','$product_details._id','findById','$product.type','FROZEN\x20GOODS','purchase_quantity','$category','table\x20page','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.rack','secondary_unit','Portuguese\x20(BR)','stock_data','prod_secondunit','$return_data','../public/language/languages.json','$suppliers','</div>','QA\x20Warehouse','product_cat','../models/all_models','note','email','/view/add_purchases','prod_level','return_product','<span\x20style=\x22float:\x20right;\x22>','production_date','password','<h5>','concat','JO_number','date','$date','MaxStocks_data','$primary_code','French','1162988rgqIAG','ejs','findOne','<tr>','random','maxStocks','</h5>','$brand','room','1180185ZCDXIc','</thead>','purchase\x20data\x20add\x20successfully','Return\x20Goods','all_purchases_finished','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<!DOCTYPE\x20html>','level','There\x27s\x20a\x20error\x20in\x20this\x20transaction','prod_cat','errors','$secondary_unit','An\x20error\x20occurred.','quantity','$room','$batch_code','redirect','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','warehouse','message','product_code_hide','Spanish','log','/view/return_purchase/:id','prod_code','\x20<>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.primary_code','_id','user','edit_purchases_finished_view','</tr>','$warehouse_name','$alertquantity','$product.floorlevel','359244yRHtci','1vqwEEh','Chinese','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','An\x20error\x20occurred\x20while\x20saving\x20data.','/upload/','</tbody>','toString','back','language','$_id','getMonth','createTransport','success','$paid_amount','Hindi','error','purchases\x20item\x20return\x20successfull','/give_payment/:id','RoomAssign','$product_details.product_name','logo','prod_primunit','getDate','/invoice/:id','$maxProdPerUnit','batch_code','<h2>\x20','$product_code','$name','forEach','71930WDEpKV','post','FGSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','stocks','find','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','</td>','prod_name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/view','Error\x20Occurs','all_purchases_barcode','slice','return_qty','4635malzhn','<html><head><title></title>','floor','maxperunit','/all_purchases_finished/view','then','product_code','product','<strong>\x20Regards\x20</strong>','Rack\x201','Paid\x20For\x20Purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','edit_purchases_finished','purchase\x20data\x20update\x20successfully','max_product_unit','DRY\x20GOODS','bay','$due_amount','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','exports','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product.bay','staff','Portuguese','<hr\x20class=\x22my-3\x22>','save','currency','aggregate','payment\x20successfull','paid_amount','</table>','primary_code_hide','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Enabled','body','name','8045128axDvyo','catch','warehouse_name','$product','suppliers','$product_details.product_code','$note','INCF-','due_amount','sendMail','/../public','getFullYear','\x20Order\x20Number\x20:\x20','Finished\x20Goods','standard_unit','$product_details.storage','product_date','secondary_code','POnumber','host','$product.bin','render','</head><body>','filter','stock_quantity','map','Arabic','$product.room_name','Ambient'];a0_0x3924=function(){return _0x4952ef;};return a0_0x3924();}var a0_0x445c6a=a0_0x34b0;(function(_0x5be492,_0x54c3f0){var _0x49f49b=a0_0x34b0,_0x260a44=_0x5be492();while(!![]){try{var _0x349d9d=parseInt(_0x49f49b(0x2d7))/0x1*(parseInt(_0x49f49b(0x2d6))/0x2)+-parseInt(_0x49f49b(0x25b))/0x3+-parseInt(_0x49f49b(0x2a8))/0x4+-parseInt(_0x49f49b(0x2b1))/0x5*(parseInt(_0x49f49b(0x25a))/0x6)+-parseInt(_0x49f49b(0x233))/0x7+parseInt(_0x49f49b(0x280))/0x8+parseInt(_0x49f49b(0x20e))/0x9*(parseInt(_0x49f49b(0x1fd))/0xa);if(_0x349d9d===_0x54c3f0)break;else _0x260a44['push'](_0x260a44['shift']());}catch(_0x117999){_0x260a44['push'](_0x260a44['shift']());}}}(a0_0x3924,0xcbbe3));const express=require('express'),app=express(),router=express[a0_0x445c6a(0x25c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x445c6a(0x297)),auth=require(a0_0x445c6a(0x27a)),nodemailer=require(a0_0x445c6a(0x25d));var ejs=require(a0_0x445c6a(0x2a9));function a0_0x34b0(_0x33446d,_0x14dcab){var _0x39245e=a0_0x3924();return a0_0x34b0=function(_0x34b09d,_0x1ffb75){_0x34b09d=_0x34b09d-0x1e8;var _0x42cace=_0x39245e[_0x34b09d];return _0x42cace;},a0_0x34b0(_0x33446d,_0x14dcab);}const path=require('path'),users=require(a0_0x445c6a(0x292));router['get'](a0_0x445c6a(0x209),auth,async(_0x4105a0,_0x3448cf)=>{var _0x216260=a0_0x445c6a;try{const {username:_0x4c6421,email:_0x4e97de,role:_0x32402d}=_0x4105a0['user'],_0x2532de=_0x4105a0[_0x216260(0x2d0)],_0x3888f7=await profile[_0x216260(0x2aa)]({'email':_0x2532de[_0x216260(0x299)]}),_0x331911=await staff[_0x216260(0x2aa)]({'email':_0x2532de[_0x216260(0x299)]});if(_0x2532de[_0x216260(0x262)]==_0x216260(0x225)){const _0x803f13=await staff[_0x216260(0x2aa)]({'email':_0x2532de[_0x216260(0x299)]});}const _0x464620=await master_shop[_0x216260(0x202)]();let _0x47febb;if(_0x2532de[_0x216260(0x262)]=='staff'){const _0x37e8b7=await staff[_0x216260(0x2aa)]({'email':_0x2532de[_0x216260(0x299)]});_0x47febb=await purchases_finished[_0x216260(0x22a)]([{'$match':{'warehouse_name':_0x37e8b7[_0x216260(0x2c5)]}},{'$lookup':{'from':'suppliers','localField':_0x216260(0x237),'foreignField':_0x216260(0x232),'as':_0x216260(0x279)}},{'$unwind':_0x216260(0x273)},{'$unwind':_0x216260(0x236)},{'$group':{'_id':_0x216260(0x1e8),'invoice':{'$first':_0x216260(0x27e)},'suppliers':{'$first':_0x216260(0x293)},'date':{'$first':_0x216260(0x2a4)},'warehouse_name':{'$first':_0x216260(0x2d3)},'room':{'$first':_0x216260(0x2c0)},'product':{'$push':_0x216260(0x236)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x216260(0x1ec)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x216260(0x291)},'batch_code':{'$first':_0x216260(0x2c1)},'expiry_date':{'$first':_0x216260(0x272)},'suppliers_docs':{'$first':_0x216260(0x273)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x216260(0x224)},'isle':{'$addToSet':_0x216260(0x247)},'type':{'$addToSet':_0x216260(0x286)},'floorlevel':{'$addToSet':_0x216260(0x2d5)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x47febb=await purchases_finished[_0x216260(0x22a)]([{'$unwind':_0x216260(0x236)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x216260(0x293)},'date':{'$first':_0x216260(0x2a4)},'warehouse_name':{'$first':_0x216260(0x2d3)},'room':{'$addToSet':_0x216260(0x24e)},'product':{'$push':_0x216260(0x236)},'note':{'$first':_0x216260(0x239)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x216260(0x21f)},'return_data':{'$first':_0x216260(0x291)},'batch_code':{'$first':_0x216260(0x2c1)},'expiry_date':{'$first':_0x216260(0x272)},'suppliers_docs':{'$first':_0x216260(0x273)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x216260(0x224)},'isle':{'$addToSet':_0x216260(0x247)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x216260(0x2d5)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x464620[0x0]['language']==_0x216260(0x261))var _0x11cf00=users[_0x216260(0x275)];else{if(_0x464620[0x0]['language']==_0x216260(0x1ed))var _0x11cf00=users[_0x216260(0x1ed)];else{if(_0x464620[0x0]['language']==_0x216260(0x27f))var _0x11cf00=users[_0x216260(0x27f)];else{if(_0x464620[0x0][_0x216260(0x2e0)]==_0x216260(0x2c8))var _0x11cf00=users[_0x216260(0x2c8)];else{if(_0x464620[0x0][_0x216260(0x2e0)]==_0x216260(0x2a7))var _0x11cf00=users[_0x216260(0x2a7)];else{if(_0x464620[0x0]['language']==_0x216260(0x28e))var _0x11cf00=users['Portuguese'];else{if(_0x464620[0x0]['language']==_0x216260(0x2d8))var _0x11cf00=users['Chinese'];else{if(_0x464620[0x0][_0x216260(0x2e0)]==_0x216260(0x283))var _0x11cf00=users[_0x216260(0x24d)];}}}}}}}_0x3448cf['render'](_0x216260(0x2b5),{'success':_0x4105a0[_0x216260(0x26e)]('success'),'errors':_0x4105a0[_0x216260(0x26e)](_0x216260(0x2bc)),'purchases':_0x47febb,'role':_0x2532de,'profile':_0x3888f7,'master_shop':_0x464620,'language':_0x11cf00});}catch(_0x4a24b3){console['log'](_0x216260(0x28a),_0x4a24b3),_0x3448cf[_0x216260(0x27b)](0xc8)[_0x216260(0x263)]({'message':_0x4a24b3[_0x216260(0x2c6)]});}});function BayBinSelected(_0x35ecc3,_0x5967ff){var _0x207d07=a0_0x445c6a,_0x25beb0=[],_0x3bf640=[];if(_0x35ecc3==_0x207d07(0x21d)){switch(_0x5967ff){case _0x207d07(0x217):_0x25beb0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x207d07(0x26b):_0x25beb0=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3bf640=['DG'];}else{if(_0x35ecc3==_0x207d07(0x287)){switch(_0x5967ff){case _0x207d07(0x217):_0x25beb0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x25beb0=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3bf640=['FG'];}}return{'levels':_0x25beb0,'identify':_0x3bf640};}async function getRandom8DigitNumber(){var _0x3a569c=a0_0x445c6a;const _0x528831=0x989680,_0x589602=0x5f5e0ff,_0xfd6efe=Math[_0x3a569c(0x210)](Math[_0x3a569c(0x2ac)]()*(_0x589602-_0x528831+0x1))+_0x528831;var _0x3aa8f8;const _0x2528b0=await purchases_finished[_0x3a569c(0x2aa)]({'invoice':'INCF-'+_0xfd6efe});return _0x2528b0&&_0x2528b0['length']>0x0?_0x3aa8f8=_0x3a569c(0x23a)+_0xfd6efe:_0x3aa8f8=_0x3a569c(0x23a)+_0xfd6efe,_0x3aa8f8;}router['get']('/view/add_purchases',auth,async(_0x13ec07,_0x282457)=>{var _0x65ed5c=a0_0x445c6a;try{const {username:_0x398fed,email:_0x126adb,role:_0x271c96}=_0x13ec07[_0x65ed5c(0x2d0)],_0x509797=_0x13ec07[_0x65ed5c(0x2d0)],_0x117d26=await profile[_0x65ed5c(0x2aa)]({'email':_0x509797[_0x65ed5c(0x299)]}),_0x5bf972=await master_shop[_0x65ed5c(0x202)](),_0x2b9ab2=await staff[_0x65ed5c(0x2aa)]({'email':_0x509797[_0x65ed5c(0x299)]}),_0xa745b0=await suppliers[_0x65ed5c(0x202)]({});let _0x197c09;if(_0x509797[_0x65ed5c(0x262)]==_0x65ed5c(0x225)){const _0x3706ec=await staff[_0x65ed5c(0x2aa)]({'email':_0x509797[_0x65ed5c(0x299)]});_0x197c09=await warehouse[_0x65ed5c(0x22a)]([{'$match':{'status':_0x65ed5c(0x230),'name':_0x3706ec['warehouse'],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x65ed5c(0x1fb),'name':{'$first':_0x65ed5c(0x1fb)}}}]);}else _0x197c09=await warehouse[_0x65ed5c(0x22a)]([{'$match':{'status':_0x65ed5c(0x230),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x65ed5c(0x295)}}},{'$group':{'_id':_0x65ed5c(0x1fb),'name':{'$first':_0x65ed5c(0x1fb)}}}]);const _0x3364e2=await product[_0x65ed5c(0x202)]({}),_0x40cb18=await warehouse[_0x65ed5c(0x202)]({'status':_0x65ed5c(0x230)}),_0x106b68=await purchases_finished[_0x65ed5c(0x202)]({}),_0x384942=_0x106b68[_0x65ed5c(0x268)]+0x1,_0x1910ff=_0x65ed5c(0x23a)+_0x384942[_0x65ed5c(0x2de)]()[_0x65ed5c(0x277)](0x5,'0');var _0xacc4=[_0x65ed5c(0x24f),'Enclosed'];if(_0x5bf972[0x0]['language']==_0x65ed5c(0x261))var _0x2e392a=users[_0x65ed5c(0x275)];else{if(_0x5bf972[0x0][_0x65ed5c(0x2e0)]==_0x65ed5c(0x1ed))var _0x2e392a=users[_0x65ed5c(0x1ed)];else{if(_0x5bf972[0x0]['language']==_0x65ed5c(0x27f))var _0x2e392a=users[_0x65ed5c(0x27f)];else{if(_0x5bf972[0x0][_0x65ed5c(0x2e0)]==_0x65ed5c(0x2c8))var _0x2e392a=users['Spanish'];else{if(_0x5bf972[0x0][_0x65ed5c(0x2e0)]==_0x65ed5c(0x2a7))var _0x2e392a=users[_0x65ed5c(0x2a7)];else{if(_0x5bf972[0x0][_0x65ed5c(0x2e0)]==_0x65ed5c(0x28e))var _0x2e392a=users[_0x65ed5c(0x226)];else{if(_0x5bf972[0x0][_0x65ed5c(0x2e0)]=='Chinese')var _0x2e392a=users[_0x65ed5c(0x2d8)];else{if(_0x5bf972[0x0][_0x65ed5c(0x2e0)]==_0x65ed5c(0x283))var _0x2e392a=users[_0x65ed5c(0x24d)];}}}}}}}const _0x494731=getRandom8DigitNumber();_0x494731[_0x65ed5c(0x213)](_0x4e84a2=>{var _0x103617=_0x65ed5c;_0x282457[_0x103617(0x248)](_0x103617(0x27c),{'success':_0x13ec07[_0x103617(0x26e)](_0x103617(0x1eb)),'errors':_0x13ec07[_0x103617(0x26e)]('errors'),'role':_0x509797,'profile':_0x117d26,'suppliers':_0xa745b0,'warehouse':_0x197c09,'product':_0x3364e2,'invoice':_0x4e84a2,'master_shop':_0x5bf972,'language':_0x2e392a,'find_data':_0x40cb18,'rooms_data':_0xacc4});})[_0x65ed5c(0x234)](_0xcb296f=>{var _0x405f1b=_0x65ed5c;_0x13ec07['flash'](_0x405f1b(0x2bc),_0x405f1b(0x2ba)),_0x282457[_0x405f1b(0x2c2)](_0x405f1b(0x212));});}catch(_0x5b8c77){console[_0x65ed5c(0x2c9)](_0x5b8c77);}}),router[a0_0x445c6a(0x271)]('/view/add_purchases/:id',auth,async(_0x45dabf,_0x125901)=>{var _0x246dbc=a0_0x445c6a;try{const _0x6b46c5=_0x45dabf[_0x246dbc(0x281)]['id'];console['log'](_0x6b46c5);const _0x33010e=await master_shop[_0x246dbc(0x202)]();console[_0x246dbc(0x2c9)](_0x246dbc(0x269),_0x33010e);const _0x38e47d=await product[_0x246dbc(0x2aa)]({'name':_0x6b46c5});console[_0x246dbc(0x2c9)](_0x246dbc(0x215),_0x38e47d),_0x125901[_0x246dbc(0x27b)](0xc8)[_0x246dbc(0x263)]({'product_data':_0x38e47d,'master':_0x33010e});}catch(_0x556e3b){console[_0x246dbc(0x2c9)]('add_purchases\x20error',_0x556e3b);}}),router[a0_0x445c6a(0x1fe)](a0_0x445c6a(0x29a),auth,async(_0x1d263e,_0x481d1f)=>{var _0x4a1ea1=a0_0x445c6a;try{const {invoice:_0x29438b,date:_0x2b6739,warehouse_name:_0x21c9bb,prod_name:_0xe0a774,prod_code:_0x5ef654,prod_qty:_0x385dd5,prod_unit:_0x2011db,prod_secondunit:_0x1ec4bb,prod_level:_0xe0d543,prod_isle:_0x3c99c3,prod_pallet:_0x1c6572,note:_0x4e76e2,expiry_date:_0x416617,batch_code:_0x5c4f80,payable:_0x5d66b4,due_amount:_0x52f31e,Room_name:_0x2b8e1b,primary_code:_0x282809,secondary_code:_0x172045,MaxStocks_data:_0x4a1af8,PO_number:_0x23a876,SCRN:_0x4b48ca,JO_number:_0x2ad8c2}=_0x1d263e[_0x4a1ea1(0x231)];if(typeof _0xe0a774==_0x4a1ea1(0x220))var _0x4023f9=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x207)]],_0x146441=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x2cb)]],_0x29d1b5=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x270)]],_0x5c9c18=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x1f4)]],_0x5f06c7=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x290)]],_0x484fe4=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x29b)]],_0x257c24=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x278)]],_0x537114=[_0x1d263e['body'][_0x4a1ea1(0x244)]],_0x3020cd=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x2a5)]],_0x10cd2d=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x1f8)]],_0x192421=[_0x1d263e['body']['expiry_date']],_0x53316c=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x243)]],_0x59a4d9=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x21c)]],_0x4670aa=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x2bb)]],_0x494d7a=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x1f1)]],_0xe5810b=[_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x259)]];else var _0x4023f9=[..._0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x207)]],_0x146441=[..._0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x2cb)]],_0x29d1b5=[..._0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x270)]],_0x5c9c18=[..._0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x1f4)]],_0x5f06c7=[..._0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x290)]],_0x484fe4=[..._0x1d263e[_0x4a1ea1(0x231)]['prod_level']],_0x257c24=[..._0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x278)]],_0x537114=[..._0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x244)]],_0x3020cd=[..._0x1d263e['body'][_0x4a1ea1(0x2a5)]],_0x10cd2d=[..._0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x1f8)]],_0x192421=[..._0x1d263e[_0x4a1ea1(0x231)]['expiry_date']],_0x53316c=[..._0x1d263e[_0x4a1ea1(0x231)]['product_date']],_0x59a4d9=[..._0x1d263e[_0x4a1ea1(0x231)]['max_product_unit']],_0x4670aa=[..._0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x2bb)]],_0x494d7a=[..._0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x1f1)]],_0xe5810b=[..._0x1d263e['body'][_0x4a1ea1(0x259)]];const _0x46a661=_0x4023f9[_0x4a1ea1(0x24c)](_0x22ed96=>{return _0x22ed96={'product_name':_0x22ed96};});_0x146441[_0x4a1ea1(0x1fc)]((_0x10023b,_0x1ed01f)=>{var _0x4e12f7=_0x4a1ea1;_0x46a661[_0x1ed01f][_0x4e12f7(0x214)]=_0x10023b;}),_0x29d1b5[_0x4a1ea1(0x1fc)]((_0x9db687,_0x133e0f)=>{var _0x28eacb=_0x4a1ea1;_0x46a661[_0x133e0f][_0x28eacb(0x2bf)]=Math['abs'](_0x9db687);}),_0x5c9c18['forEach']((_0x348e7e,_0x2cabf9)=>{var _0x29ee13=_0x4a1ea1;_0x46a661[_0x2cabf9][_0x29ee13(0x241)]=_0x348e7e;}),_0x5f06c7[_0x4a1ea1(0x1fc)]((_0xbb14ff,_0x465a85)=>{_0x46a661[_0x465a85]['secondary_unit']=_0xbb14ff;}),_0x484fe4[_0x4a1ea1(0x1fc)]((_0x44576c,_0x5acefc)=>{var _0x758b5b=_0x4a1ea1;_0x46a661[_0x5acefc][_0x758b5b(0x21e)]=_0x44576c;}),_0x257c24['forEach']((_0x278397,_0x2fe81d)=>{var _0x17aee9=_0x4a1ea1;_0x46a661[_0x2fe81d][_0x17aee9(0x278)]=_0x278397;}),_0x537114[_0x4a1ea1(0x1fc)]((_0x5a7eb7,_0x5f1696)=>{_0x46a661[_0x5f1696]['secondary_code']=_0x5a7eb7;}),_0x3020cd['forEach']((_0x33eab2,_0xd5d7b9)=>{var _0x25629e=_0x4a1ea1;_0x46a661[_0xd5d7b9][_0x25629e(0x2ad)]=_0x33eab2;}),_0x10cd2d['forEach']((_0x1a59f6,_0x331236)=>{var _0x6a334b=_0x4a1ea1;_0x46a661[_0x331236][_0x6a334b(0x1f8)]=_0x1a59f6;}),_0x192421[_0x4a1ea1(0x1fc)]((_0x492e24,_0x35afa1)=>{var _0x43bffb=_0x4a1ea1;_0x46a661[_0x35afa1][_0x43bffb(0x26a)]=_0x492e24;}),_0x53316c[_0x4a1ea1(0x1fc)]((_0x6c1381,_0x550de7)=>{var _0x2fbf6c=_0x4a1ea1;_0x46a661[_0x550de7][_0x2fbf6c(0x29e)]=_0x6c1381;}),_0x59a4d9[_0x4a1ea1(0x1fc)]((_0x27e037,_0x217d0e)=>{var _0x4091a3=_0x4a1ea1;_0x46a661[_0x217d0e][_0x4091a3(0x211)]=_0x27e037;}),_0x4670aa[_0x4a1ea1(0x1fc)]((_0x246c9c,_0x2b5aee)=>{var _0x4d20aa=_0x4a1ea1;_0x46a661[_0x2b5aee][_0x4d20aa(0x296)]=_0x246c9c;}),_0x494d7a[_0x4a1ea1(0x1fc)]((_0x1e0ece,_0x53c5e3)=>{var _0x46869a=_0x4a1ea1;_0x46a661[_0x53c5e3][_0x46869a(0x250)]=_0x1e0ece;}),_0xe5810b[_0x4a1ea1(0x1fc)]((_0x3887a6,_0x3e0706)=>{_0x46a661[_0x3e0706]['invoice']=_0x3887a6;});const _0x1060c3=_0x46a661[_0x4a1ea1(0x24a)](_0x34b861=>_0x34b861[_0x4a1ea1(0x2bf)]!=='0'&&_0x34b861[_0x4a1ea1(0x2bf)]!==''),_0x1cbf41=new purchases_finished({'invoice':_0x29438b,'suppliers':_0x1d263e[_0x4a1ea1(0x231)][_0x4a1ea1(0x237)],'date':_0x2b6739,'warehouse_name':_0x21c9bb,'product':_0x1060c3,'note':_0x4e76e2,'due_amount':_0x52f31e,'room':_0x2b8e1b,'POnumber':_0x23a876,'SCRN':_0x4b48ca,'JO_number':_0x2ad8c2}),_0x4779b3=await _0x1cbf41[_0x4a1ea1(0x228)](),_0x55f5ce=await purchases_finished['findOne']({'invoice':_0x29438b}),_0x5e61a7=_0x55f5ce[_0x4a1ea1(0x215)]['map'](async _0x16f3be=>{var _0x786c23=_0x4a1ea1,_0x1b9ce1=await warehouse[_0x786c23(0x2aa)]({'name':_0x21c9bb,'room':_0x16f3be['room_name']}),_0x1129bd=0x0;const _0x4eaad5=_0x1b9ce1[_0x786c23(0x26f)][_0x786c23(0x24c)](_0x112a4c=>{var _0x385858=_0x786c23;console[_0x385858(0x2c9)](_0x112a4c[_0x385858(0x26d)]+'=='+_0x16f3be[_0x385858(0x26d)]+'&&'+_0x112a4c['bay']+'=='+_0x16f3be[_0x385858(0x21e)]+'&&'+_0x112a4c['expiry_date']+'=='+_0x16f3be[_0x385858(0x26a)]+'&&'+_0x112a4c['production_date']+'=='+_0x16f3be[_0x385858(0x29e)]+'&&'+_0x112a4c['batch_code']+'=='+_0x16f3be['batch_code']+'&&'+_0x112a4c[_0x385858(0x2c3)]+'=='+_0x55f5ce[_0x385858(0x2c3)]),_0x112a4c[_0x385858(0x26d)]==_0x16f3be[_0x385858(0x26d)]&&_0x112a4c[_0x385858(0x21e)]==_0x16f3be[_0x385858(0x21e)]&&_0x112a4c['expiry_date']==_0x16f3be[_0x385858(0x26a)]&&_0x112a4c['production_date']==_0x16f3be['production_date']&&_0x112a4c[_0x385858(0x1f8)]==_0x16f3be[_0x385858(0x1f8)]&&_0x112a4c[_0x385858(0x2c3)]==_0x55f5ce[_0x385858(0x2c3)]&&(_0x112a4c['product_stock']=Math[_0x385858(0x253)](_0x112a4c['product_stock'])+Math[_0x385858(0x253)](_0x16f3be[_0x385858(0x2bf)]),_0x1129bd++);});return _0x1129bd=='0'&&(_0x1b9ce1[_0x786c23(0x26f)]=_0x1b9ce1[_0x786c23(0x26f)][_0x786c23(0x2a1)]({'product_name':_0x16f3be[_0x786c23(0x26d)],'product_stock':Math[_0x786c23(0x253)](_0x16f3be[_0x786c23(0x2bf)]),'primary_code':_0x16f3be[_0x786c23(0x278)],'secondary_code':_0x16f3be[_0x786c23(0x244)],'product_code':_0x16f3be[_0x786c23(0x214)],'bay':_0x16f3be[_0x786c23(0x21e)],'maxProducts':_0x16f3be[_0x786c23(0x2ad)],'unit':_0x16f3be[_0x786c23(0x241)],'secondary_unit':_0x16f3be[_0x786c23(0x28d)],'expiry_date':_0x16f3be[_0x786c23(0x26a)],'production_date':_0x16f3be[_0x786c23(0x29e)],'maxProducts':_0x16f3be['maxStocks'],'maxPerUnit':_0x16f3be[_0x786c23(0x211)],'batch_code':_0x16f3be['batch_code'],'product_cat':_0x16f3be['product_cat'],'invoice':_0x16f3be[_0x786c23(0x2c3)]})),_0x1b9ce1;});Promise[_0x4a1ea1(0x266)](_0x5e61a7)[_0x4a1ea1(0x213)](async _0x2d76b5=>{var _0x5826b2=_0x4a1ea1;try{for(const _0x171c42 of _0x2d76b5){await warehouse['updateOne']({'_id':_0x171c42[_0x5826b2(0x2cf)]},{'$addToSet':{'product_details':{'$each':_0x171c42[_0x5826b2(0x26f)]}}});}const _0x56e4d8=await master_shop[_0x5826b2(0x202)](),_0x26ba04=await email_settings[_0x5826b2(0x2aa)](),_0xb00f45=await supervisor_settings[_0x5826b2(0x202)]();var _0xc8d631=_0x55f5ce[_0x5826b2(0x215)],_0x498b76='',_0xe1dcca;for(_0xe1dcca in _0xc8d631){var _0x5dddb8='FG';_0x55f5ce[_0x5826b2(0x235)]==_0x5826b2(0x21d)&&(_0x5dddb8='DG'),_0x498b76+='<tr>'+_0x5826b2(0x26c)+_0xc8d631[_0xe1dcca]['product_name']+_0x5826b2(0x206)+_0x5826b2(0x26c)+_0xc8d631[_0xe1dcca][_0x5826b2(0x214)]+'</td>'+_0x5826b2(0x26c)+_0xc8d631[_0xe1dcca][_0x5826b2(0x2bf)]+_0x5826b2(0x206)+_0x5826b2(0x26c)+_0xc8d631[_0xe1dcca]['standard_unit']+_0x5826b2(0x206)+_0x5826b2(0x26c)+_0xc8d631[_0xe1dcca]['secondary_unit']+'</td>'+_0x5826b2(0x26c)+_0x55f5ce[_0x5826b2(0x235)]+_0x5826b2(0x206)+_0x5826b2(0x26c)+_0xc8d631[_0xe1dcca][_0x5826b2(0x250)]+_0x5826b2(0x206)+_0x5826b2(0x26c)+_0x5dddb8+_0xc8d631[_0xe1dcca][_0x5826b2(0x21e)]+_0x5826b2(0x206),'</tr>';}let _0x3274de=nodemailer[_0x5826b2(0x1ea)]({'host':_0x26ba04[_0x5826b2(0x246)],'port':Number(_0x26ba04['port']),'secure':![],'auth':{'user':_0x26ba04[_0x5826b2(0x299)],'pass':_0x26ba04[_0x5826b2(0x29f)]}}),_0x109dff={'from':_0x26ba04[_0x5826b2(0x299)],'to':_0xb00f45[0x0][_0x5826b2(0x1ff)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x5826b2(0x23d)+_0x5826b2(0x2dc)+_0x56e4d8[0x0][_0x5826b2(0x27d)],'cid':_0x5826b2(0x1f3)}],'html':_0x5826b2(0x2b8)+_0x5826b2(0x20f)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x5826b2(0x264)+_0x5826b2(0x22f)+'</div>'+_0x5826b2(0x264)+_0x5826b2(0x1f9)+_0x56e4d8[0x0]['site_title']+'\x20</h2>'+_0x5826b2(0x294)+'</div>'+_0x5826b2(0x227)+_0x5826b2(0x264)+_0x5826b2(0x28b)+_0x5826b2(0x23f)+_0x55f5ce['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x5826b2(0x267)+_0x55f5ce[_0x5826b2(0x2a3)]+'\x20'+'</span>'+'</h5>'+_0x5826b2(0x294)+_0x5826b2(0x208)+_0x5826b2(0x203)+_0x5826b2(0x2ab)+_0x5826b2(0x2cd)+_0x5826b2(0x282)+_0x5826b2(0x219)+_0x5826b2(0x2b7)+_0x5826b2(0x205)+_0x5826b2(0x2da)+_0x5826b2(0x200)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x5826b2(0x2d2)+_0x5826b2(0x2b2)+_0x5826b2(0x254)+'\x20'+_0x498b76+'\x20'+_0x5826b2(0x2dd)+_0x5826b2(0x22d)+_0x5826b2(0x264)+_0x5826b2(0x216)+_0x5826b2(0x2a0)+_0x56e4d8[0x0][_0x5826b2(0x255)]+'</h5>'+_0x5826b2(0x294)+_0x5826b2(0x294)+_0x5826b2(0x25f)};_0x3274de[_0x5826b2(0x23c)](_0x109dff,function(_0x134172,_0x14955d){var _0x4f3d87=_0x5826b2;_0x134172?(console[_0x4f3d87(0x2c9)](_0x134172),console[_0x4f3d87(0x2c9)](_0x4f3d87(0x20a))):console[_0x4f3d87(0x2c9)]('Email\x20sent\x20successfully');});}catch(_0x32b5ce){console[_0x5826b2(0x1ee)](_0x32b5ce),_0x481d1f['status'](0x1f4)[_0x5826b2(0x263)]({'error':_0x5826b2(0x2db),'message':_0x32b5ce[_0x5826b2(0x2c6)]});}})[_0x4a1ea1(0x234)](_0x575a91=>{var _0x1cafd2=_0x4a1ea1;console[_0x1cafd2(0x1ee)](_0x575a91),_0x481d1f[_0x1cafd2(0x27b)](0x1f4)['json']({'error':_0x1cafd2(0x2be)});}),_0x1d263e['flash']('success',_0x4a1ea1(0x2b3)),_0x481d1f[_0x4a1ea1(0x2c2)](_0x4a1ea1(0x212));}catch(_0x272aed){console[_0x4a1ea1(0x2c9)](_0x272aed);}}),router['get'](a0_0x445c6a(0x204),auth,async(_0x3309d6,_0x1d441d)=>{var _0xa1a515=a0_0x445c6a;try{const {username:_0x29319c,email:_0x157548,role:_0x4b7e0f}=_0x3309d6[_0xa1a515(0x2d0)],_0x34a8fd=_0x3309d6[_0xa1a515(0x2d0)],_0x18801a=await profile[_0xa1a515(0x2aa)]({'email':_0x34a8fd['email']}),_0x3b26f2=await master_shop[_0xa1a515(0x202)](),_0x43c7e5=_0x3309d6[_0xa1a515(0x281)]['id'],_0x4c57b2=await purchases_finished[_0xa1a515(0x285)](_0x43c7e5),_0x114f42=await suppliers['find']({});let _0x297541;if(_0x34a8fd[_0xa1a515(0x262)]==_0xa1a515(0x225)){const _0x30b035=await staff[_0xa1a515(0x2aa)]({'email':_0x34a8fd[_0xa1a515(0x299)]});_0x297541=await warehouse['find']({'status':'Enabled','name':_0x30b035[_0xa1a515(0x2c5)],'warehouse_category':_0xa1a515(0x240)});}else _0x297541=await warehouse['aggregate']([{'$match':{'status':_0xa1a515(0x230),'warehouse_category':_0xa1a515(0x240)}},{'$group':{'_id':_0xa1a515(0x1fb),'name':{'$first':'$name'}}}]);const _0x16ac92=await product['find']({}),_0x51a3c5=BayBinSelected(_0x4c57b2[_0xa1a515(0x235)],_0x4c57b2[_0xa1a515(0x2b0)]);let _0x489eac=new Date(_0x4c57b2[_0xa1a515(0x26a)]),_0x25227c=('0'+_0x489eac[_0xa1a515(0x1f5)]())[_0xa1a515(0x20c)](-0x2),_0x379ee4=('0'+(_0x489eac[_0xa1a515(0x1e9)]()+0x1))['slice'](-0x2),_0x43f109=_0x489eac[_0xa1a515(0x23e)](),_0x339951=_0x43f109+'-'+_0x379ee4+'-'+_0x25227c;if(_0x3b26f2[0x0][_0xa1a515(0x2e0)]==_0xa1a515(0x261)){var _0x5d9be3=users[_0xa1a515(0x275)];console['log'](_0x5d9be3);}else{if(_0x3b26f2[0x0]['language']=='Hindi')var _0x5d9be3=users['Hindi'];else{if(_0x3b26f2[0x0][_0xa1a515(0x2e0)]=='German')var _0x5d9be3=users[_0xa1a515(0x27f)];else{if(_0x3b26f2[0x0]['language']==_0xa1a515(0x2c8))var _0x5d9be3=users['Spanish'];else{if(_0x3b26f2[0x0][_0xa1a515(0x2e0)]==_0xa1a515(0x2a7))var _0x5d9be3=users['French'];else{if(_0x3b26f2[0x0][_0xa1a515(0x2e0)]==_0xa1a515(0x28e))var _0x5d9be3=users[_0xa1a515(0x226)];else{if(_0x3b26f2[0x0][_0xa1a515(0x2e0)]==_0xa1a515(0x2d8))var _0x5d9be3=users[_0xa1a515(0x2d8)];else{if(_0x3b26f2[0x0][_0xa1a515(0x2e0)]==_0xa1a515(0x283))var _0x5d9be3=users[_0xa1a515(0x24d)];}}}}}}}_0x1d441d[_0xa1a515(0x248)](_0xa1a515(0x2d1),{'success':_0x3309d6[_0xa1a515(0x26e)](_0xa1a515(0x1eb)),'errors':_0x3309d6[_0xa1a515(0x26e)](_0xa1a515(0x2bc)),'role':_0x34a8fd,'profile':_0x18801a,'purchases':_0x4c57b2,'suppliers':_0x114f42,'warehouse':_0x297541,'product':_0x16ac92,'master_shop':_0x3b26f2,'language':_0x5d9be3,'ed_fullDate':_0x339951,'dataSelected':_0x51a3c5});}catch(_0x4c88d1){console[_0xa1a515(0x2c9)](_0x4c88d1);}}),router[a0_0x445c6a(0x271)](a0_0x445c6a(0x2b6),auth,async(_0x1e2125,_0x447c5f)=>{var _0x334de5=a0_0x445c6a;try{const {username:_0x32bbde,email:_0x3c4b91,role:_0x5b92a8}=_0x1e2125[_0x334de5(0x2d0)],_0x43bd4f=_0x1e2125[_0x334de5(0x2d0)],_0x106bcb=await profile[_0x334de5(0x2aa)]({'email':_0x43bd4f[_0x334de5(0x299)]}),_0x3803ce=await master_shop[_0x334de5(0x202)](),_0x1f416f=_0x1e2125['params']['id'],_0x1c1364=await purchases_finished[_0x334de5(0x285)](_0x1f416f),_0x21a04d=await suppliers[_0x334de5(0x202)]({});let _0x9beb6d;if(_0x43bd4f[_0x334de5(0x262)]=='staff'){const _0x8db5c2=await staff[_0x334de5(0x2aa)]({'email':_0x43bd4f[_0x334de5(0x299)]});_0x9beb6d=await warehouse[_0x334de5(0x202)]({'status':_0x334de5(0x230),'name':_0x8db5c2[_0x334de5(0x2c5)],'warehouse_category':_0x334de5(0x240)});}else _0x9beb6d=await warehouse['aggregate']([{'$match':{'status':_0x334de5(0x230),'warehouse_category':_0x334de5(0x240)}},{'$group':{'_id':_0x334de5(0x1fb),'name':{'$first':_0x334de5(0x1fb)}}}]);const _0x5410d8=await product[_0x334de5(0x202)]({}),_0x4e0584=BayBinSelected(_0x1c1364['warehouse_name'],_0x1c1364[_0x334de5(0x2b0)]);let _0x39e667=new Date(_0x1c1364[_0x334de5(0x26a)]),_0x215e81=('0'+_0x39e667[_0x334de5(0x1f5)]())['slice'](-0x2),_0x5aa4d7=('0'+(_0x39e667[_0x334de5(0x1e9)]()+0x1))[_0x334de5(0x20c)](-0x2),_0x5b82d7=_0x39e667[_0x334de5(0x23e)](),_0x4ecef7=_0x5b82d7+'-'+_0x5aa4d7+'-'+_0x215e81;if(_0x3803ce[0x0]['language']==_0x334de5(0x261)){var _0x3d17f2=users[_0x334de5(0x275)];console['log'](_0x3d17f2);}else{if(_0x3803ce[0x0][_0x334de5(0x2e0)]==_0x334de5(0x1ed))var _0x3d17f2=users[_0x334de5(0x1ed)];else{if(_0x3803ce[0x0]['language']=='German')var _0x3d17f2=users['German'];else{if(_0x3803ce[0x0]['language']==_0x334de5(0x2c8))var _0x3d17f2=users[_0x334de5(0x2c8)];else{if(_0x3803ce[0x0]['language']==_0x334de5(0x2a7))var _0x3d17f2=users[_0x334de5(0x2a7)];else{if(_0x3803ce[0x0][_0x334de5(0x2e0)]==_0x334de5(0x28e))var _0x3d17f2=users[_0x334de5(0x226)];else{if(_0x3803ce[0x0][_0x334de5(0x2e0)]==_0x334de5(0x2d8))var _0x3d17f2=users[_0x334de5(0x2d8)];else{if(_0x3803ce[0x0]['language']==_0x334de5(0x283))var _0x3d17f2=users[_0x334de5(0x24d)];}}}}}}}_0x447c5f['render'](_0x334de5(0x21a),{'success':_0x1e2125['flash'](_0x334de5(0x1eb)),'errors':_0x1e2125[_0x334de5(0x26e)](_0x334de5(0x2bc)),'role':_0x43bd4f,'profile':_0x106bcb,'purchases':_0x1c1364,'suppliers':_0x21a04d,'warehouse':_0x9beb6d,'product':_0x5410d8,'master_shop':_0x3803ce,'language':_0x3d17f2,'ed_fullDate':_0x4ecef7,'dataSelected':_0x4e0584});}catch(_0xa86d22){console['log'](_0xa86d22);}}),router[a0_0x445c6a(0x1fe)](a0_0x445c6a(0x2b6),auth,async(_0x1def11,_0xa3fe9b)=>{var _0x103d5f=a0_0x445c6a;try{const _0x5091b3=_0x1def11[_0x103d5f(0x281)]['id'],_0x51b9fc=await purchases_finished[_0x103d5f(0x2aa)]({'_id':_0x1def11['params']['id']}),_0x32d76a=await warehouse[_0x103d5f(0x2aa)]({'name':_0x51b9fc[_0x103d5f(0x235)],'room':_0x51b9fc[_0x103d5f(0x2b0)]});_0x51b9fc[_0x103d5f(0x215)]['forEach'](_0x5b161f=>{var _0x3f7092=_0x103d5f;const _0x11c6fd=_0x32d76a['product_details'][_0x3f7092(0x24c)](_0xfa6f59=>{var _0x4c3811=_0x3f7092;_0xfa6f59[_0x4c3811(0x26d)]==_0x5b161f[_0x4c3811(0x26d)]&&_0xfa6f59[_0x4c3811(0x21e)]==_0x5b161f[_0x4c3811(0x21e)]&&(_0xfa6f59['product_stock']=parseInt(_0xfa6f59[_0x4c3811(0x25e)])-parseInt(_0x5b161f[_0x4c3811(0x2bf)]));});}),await _0x32d76a[_0x103d5f(0x228)]();const {invoice:_0x564938,suppliers:_0x16c6ec,date:_0x5c2900,warehouse_name:_0x59ce84,prod_name:_0x4edd8b,prod_code:_0x414966,prod_qty:_0x5566b6,prod_unit:_0x2427e8,prod_secondunit:_0x4c3a65,prod_level:_0x2d5f20,prod_isle:_0x35d70e,prod_pallet:_0x484a79,note:_0x50daee,expiry_date:_0x4c38a3,batch_code:_0x3453f0,paid_amount:_0x151329,due_amount:_0x2e1527,Room_name:_0x1cb66e,primary_code:_0x5d39d2,secondary_code:_0x1f1676,PO_number:_0x11fd83,JO_number:_0x4244c0}=_0x1def11[_0x103d5f(0x231)];if(typeof _0x4edd8b=='string')var _0x15da38=[_0x1def11[_0x103d5f(0x231)][_0x103d5f(0x207)]],_0x48ff7d=[_0x1def11[_0x103d5f(0x231)][_0x103d5f(0x2cb)]],_0x43a4a8=[_0x1def11[_0x103d5f(0x231)]['prod_qty']],_0x1aa83d=[_0x1def11[_0x103d5f(0x231)][_0x103d5f(0x256)]],_0x51ece9=[_0x1def11['body'][_0x103d5f(0x290)]],_0x5d46e2=[_0x1def11['body'][_0x103d5f(0x29b)]],_0x175a8a=[_0x1def11['body'][_0x103d5f(0x278)]],_0x1890b0=[_0x1def11[_0x103d5f(0x231)][_0x103d5f(0x244)]],_0x258aad=[_0x1def11[_0x103d5f(0x231)][_0x103d5f(0x2a5)]],_0x5bab40=[_0x1def11[_0x103d5f(0x231)]['batch_code']],_0x402fd5=[_0x1def11['body']['expiry_date']];else var _0x15da38=[..._0x1def11[_0x103d5f(0x231)][_0x103d5f(0x207)]],_0x48ff7d=[..._0x1def11[_0x103d5f(0x231)][_0x103d5f(0x2cb)]],_0x43a4a8=[..._0x1def11[_0x103d5f(0x231)][_0x103d5f(0x260)]],_0x1aa83d=[..._0x1def11['body'][_0x103d5f(0x256)]],_0x51ece9=[..._0x1def11[_0x103d5f(0x231)]['prod_secondunit']],_0x5d46e2=[..._0x1def11[_0x103d5f(0x231)][_0x103d5f(0x29b)]],_0x175a8a=[..._0x1def11[_0x103d5f(0x231)][_0x103d5f(0x278)]],_0x1890b0=[..._0x1def11[_0x103d5f(0x231)][_0x103d5f(0x244)]],_0x258aad=[..._0x1def11[_0x103d5f(0x231)][_0x103d5f(0x2a5)]],_0x5bab40=[..._0x1def11[_0x103d5f(0x231)][_0x103d5f(0x1f8)]],_0x402fd5=[..._0x1def11[_0x103d5f(0x231)][_0x103d5f(0x26a)]];const _0x4044d7=_0x15da38[_0x103d5f(0x24c)](_0x5c678b=>{return _0x5c678b={'product_name':_0x5c678b};});_0x48ff7d[_0x103d5f(0x1fc)]((_0x183d26,_0x376073)=>{var _0x460d0f=_0x103d5f;_0x4044d7[_0x376073][_0x460d0f(0x214)]=_0x183d26;}),_0x43a4a8[_0x103d5f(0x1fc)]((_0x348e05,_0x1332d5)=>{var _0x1b2418=_0x103d5f;_0x4044d7[_0x1332d5][_0x1b2418(0x2bf)]=_0x348e05;}),_0x1aa83d[_0x103d5f(0x1fc)]((_0x520b5a,_0xa353ab)=>{_0x4044d7[_0xa353ab]['standard_unit']=_0x520b5a;}),_0x51ece9[_0x103d5f(0x1fc)]((_0x212389,_0x1765d3)=>{var _0x12db96=_0x103d5f;_0x4044d7[_0x1765d3][_0x12db96(0x28d)]=_0x212389;}),_0x5d46e2['forEach']((_0x2dbb81,_0x56338e)=>{_0x4044d7[_0x56338e]['bay']=_0x2dbb81;}),_0x175a8a['forEach']((_0x46ccf0,_0x13f610)=>{var _0xaaf563=_0x103d5f;_0x4044d7[_0x13f610][_0xaaf563(0x278)]=_0x46ccf0;}),_0x1890b0[_0x103d5f(0x1fc)]((_0x50ed31,_0x4f9488)=>{var _0x1b59b0=_0x103d5f;_0x4044d7[_0x4f9488][_0x1b59b0(0x244)]=_0x50ed31;}),_0x258aad[_0x103d5f(0x1fc)]((_0x511021,_0x124771)=>{var _0x141668=_0x103d5f;_0x4044d7[_0x124771][_0x141668(0x2ad)]=_0x511021;}),_0x5bab40[_0x103d5f(0x1fc)]((_0x454495,_0x30ae4e)=>{_0x4044d7[_0x30ae4e]['batch_code']=_0x454495;}),_0x402fd5[_0x103d5f(0x1fc)]((_0x50f8d3,_0x419adb)=>{var _0xbc203e=_0x103d5f;_0x4044d7[_0x419adb][_0xbc203e(0x26a)]=_0x50f8d3;});const _0x2dee5f=_0x4044d7['filter'](_0x2c9a0d=>_0x2c9a0d[_0x103d5f(0x2bf)]!=='0'&&_0x2c9a0d[_0x103d5f(0x2bf)]!=='');_0x51b9fc[_0x103d5f(0x2c3)]=_0x564938,_0x51b9fc[_0x103d5f(0x237)]=_0x16c6ec,_0x51b9fc[_0x103d5f(0x2a3)]=_0x5c2900,_0x51b9fc[_0x103d5f(0x235)]=_0x59ce84,_0x51b9fc[_0x103d5f(0x215)]=_0x2dee5f,_0x51b9fc[_0x103d5f(0x298)]=_0x50daee,_0x51b9fc['paid_amount']=_0x151329,_0x51b9fc[_0x103d5f(0x23b)]=_0x2e1527,_0x51b9fc[_0x103d5f(0x2b0)]=_0x1cb66e,_0x51b9fc[_0x103d5f(0x245)]=_0x11fd83,_0x51b9fc[_0x103d5f(0x2a2)]=_0x4244c0;const _0x1755f0=await _0x51b9fc[_0x103d5f(0x228)](),_0x3c6168=await warehouse['findOne']({'name':_0x1def11[_0x103d5f(0x231)][_0x103d5f(0x235)],'room':_0x1def11[_0x103d5f(0x231)]['Room_name']});_0x51b9fc['product'][_0x103d5f(0x1fc)](_0x2bf8be=>{var _0x2b977a=_0x103d5f,_0x3df689=0x0;const _0x551b2a=_0x3c6168[_0x2b977a(0x26f)][_0x2b977a(0x24c)](_0xf38d32=>{var _0x5c50a0=_0x2b977a;_0xf38d32[_0x5c50a0(0x26d)]==_0x2bf8be['product_name']&&_0xf38d32[_0x5c50a0(0x21e)]==_0x2bf8be[_0x5c50a0(0x21e)]&&(_0xf38d32['product_stock']=parseInt(_0xf38d32[_0x5c50a0(0x25e)])+parseInt(_0x2bf8be[_0x5c50a0(0x2bf)]),_0x3df689++);});_0x3df689=='0'&&(_0x3c6168[_0x2b977a(0x26f)]=_0x3c6168[_0x2b977a(0x26f)][_0x2b977a(0x2a1)]({'product_name':_0x2bf8be[_0x2b977a(0x26d)],'product_stock':_0x2bf8be[_0x2b977a(0x2bf)],'primary_code':_0x2bf8be['primary_code'],'secondary_code':_0x2bf8be[_0x2b977a(0x244)],'product_code':_0x2bf8be[_0x2b977a(0x214)],'bay':_0x2bf8be[_0x2b977a(0x21e)],'maxProducts':_0x2bf8be[_0x2b977a(0x2ad)],'unit':_0x2bf8be[_0x2b977a(0x241)],'secondary_unit':_0x2bf8be[_0x2b977a(0x28d)],'expiry_date':_0x2bf8be[_0x2b977a(0x26a)]}));}),await _0x3c6168[_0x103d5f(0x228)]();const _0x41246d=await s_payment_data[_0x103d5f(0x2aa)]({'invoice':_0x1def11[_0x103d5f(0x231)][_0x103d5f(0x2c3)]});if(_0x41246d===null){}else console[_0x103d5f(0x2c9)]('suppliers',_0x41246d,_0x1def11[_0x103d5f(0x231)][_0x103d5f(0x2c3)]),_0x41246d[_0x103d5f(0x237)]=_0x1def11[_0x103d5f(0x231)][_0x103d5f(0x237)],await _0x41246d[_0x103d5f(0x228)]();_0x1def11[_0x103d5f(0x26e)]('success',_0x103d5f(0x21b)),_0xa3fe9b[_0x103d5f(0x2c2)]('/all_purchases_finished/view');}catch(_0x5828cb){console[_0x103d5f(0x2c9)](_0x5828cb);}}),router[a0_0x445c6a(0x1fe)](a0_0x445c6a(0x1f0),auth,async(_0x59e6af,_0x753789)=>{var _0x4bde85=a0_0x445c6a;try{const _0x2df4ac=_0x59e6af[_0x4bde85(0x281)]['id'],{invoice:_0xf5c654,suppliers:_0x59100c,payable:_0x2fd754,due_amount:_0x5d4b2d}=_0x59e6af[_0x4bde85(0x231)],_0x58ed70=await purchases['findById'](_0x2df4ac);var _0x12c430=_0x2fd754-_0x5d4b2d;_0x58ed70[_0x4bde85(0x22c)]=parseFloat(_0x58ed70[_0x4bde85(0x22c)])+parseFloat(_0x5d4b2d),_0x58ed70[_0x4bde85(0x23b)]=_0x12c430;const _0x1b8c8d=await _0x58ed70[_0x4bde85(0x228)]();console[_0x4bde85(0x2c9)](_0x1b8c8d);const _0x104d77=await s_payment_data[_0x4bde85(0x2aa)]({'invoice':_0xf5c654});_0x104d77['amount']=_0x12c430,await _0x104d77['save']();let _0x48f84e=new Date(),_0x27c3d0=('0'+_0x48f84e['getDate']())['slice'](-0x2),_0x3ada0e=('0'+(_0x48f84e[_0x4bde85(0x1e9)]()+0x1))['slice'](-0x2),_0x10fa04=_0x48f84e[_0x4bde85(0x23e)](),_0x4db84d=_0x10fa04+'-'+_0x3ada0e+'-'+_0x27c3d0;const _0x4af919=new suppliers_payment({'invoice':_0xf5c654,'date':_0x10fa04+'-'+_0x3ada0e+'-'+_0x27c3d0,'suppliers':_0x59100c,'reason':_0x4bde85(0x218),'amount':_0x5d4b2d}),_0x55105f=await _0x4af919['save']();_0x59e6af[_0x4bde85(0x26e)]('success',_0x4bde85(0x22b)),_0x753789[_0x4bde85(0x2c2)]('/all_purchases/view');}catch(_0x23776a){console[_0x4bde85(0x2c9)](_0x23776a);}}),router[a0_0x445c6a(0x271)](a0_0x445c6a(0x1f6),auth,async(_0x7c08f5,_0x28791f)=>{var _0x2580ac=a0_0x445c6a;try{const {username:_0x5cc173,email:_0x22cab9,role:_0x2ba450}=_0x7c08f5[_0x2580ac(0x2d0)],_0x19db06=_0x7c08f5[_0x2580ac(0x2d0)],_0x29ff15=await profile['findOne']({'email':_0x19db06[_0x2580ac(0x299)]}),_0x446ce7=await master_shop[_0x2580ac(0x202)]();console[_0x2580ac(0x2c9)](_0x2580ac(0x269),_0x446ce7);const _0xa8f388=_0x7c08f5['params']['id'],_0x2b5b73=await purchases['findById'](_0xa8f388);console[_0x2580ac(0x2c9)](_0x2b5b73);const _0x1163ae=await suppliers[_0x2580ac(0x2aa)]({'name':_0x2b5b73[_0x2580ac(0x237)]});console['log'](_0x1163ae);if(_0x446ce7[0x0][_0x2580ac(0x2e0)]=='English\x20(US)'){var _0x6d1ead=users[_0x2580ac(0x275)];console[_0x2580ac(0x2c9)](_0x6d1ead);}else{if(_0x446ce7[0x0][_0x2580ac(0x2e0)]==_0x2580ac(0x1ed))var _0x6d1ead=users['Hindi'];else{if(_0x446ce7[0x0][_0x2580ac(0x2e0)]==_0x2580ac(0x27f))var _0x6d1ead=users[_0x2580ac(0x27f)];else{if(_0x446ce7[0x0][_0x2580ac(0x2e0)]==_0x2580ac(0x2c8))var _0x6d1ead=users[_0x2580ac(0x2c8)];else{if(_0x446ce7[0x0][_0x2580ac(0x2e0)]==_0x2580ac(0x2a7))var _0x6d1ead=users[_0x2580ac(0x2a7)];else{if(_0x446ce7[0x0]['language']==_0x2580ac(0x28e))var _0x6d1ead=users[_0x2580ac(0x226)];else{if(_0x446ce7[0x0][_0x2580ac(0x2e0)]==_0x2580ac(0x2d8))var _0x6d1ead=users[_0x2580ac(0x2d8)];else{if(_0x446ce7[0x0][_0x2580ac(0x2e0)]=='Arabic\x20(ae)')var _0x6d1ead=users[_0x2580ac(0x24d)];}}}}}}}_0x28791f['render']('purchase_invoice',{'success':_0x7c08f5['flash'](_0x2580ac(0x1eb)),'errors':_0x7c08f5[_0x2580ac(0x26e)](_0x2580ac(0x2bc)),'role':_0x19db06,'profile':_0x29ff15,'master_shop':_0x446ce7,'supplier':_0x1163ae,'purchase':_0x2b5b73,'language':_0x6d1ead});}catch(_0x2dec6a){console[_0x2580ac(0x2c9)](_0x2dec6a);}}),router['get'](a0_0x445c6a(0x2ca),auth,async(_0x472883,_0x529477)=>{var _0x46064c=a0_0x445c6a;try{const {username:_0x5f3b0e,email:_0x5e9780,role:_0x794003}=_0x472883[_0x46064c(0x2d0)],_0x13ab99=_0x472883['user'],_0x1d2551=await profile['findOne']({'email':_0x13ab99['email']}),_0x27d722=await master_shop[_0x46064c(0x202)]();console[_0x46064c(0x2c9)](_0x46064c(0x269),_0x27d722);const _0x390796=_0x472883[_0x46064c(0x281)]['id'];console[_0x46064c(0x2c9)](_0x390796);const _0x36cb04=await purchases_finished[_0x46064c(0x285)](_0x390796);console[_0x46064c(0x2c9)]('user_id',_0x36cb04);const _0x5beacf=await product[_0x46064c(0x202)]({}),_0x127f62=await warehouse[_0x46064c(0x22a)]([{'$match':{'name':_0x36cb04['warehouse_name'],'room':_0x36cb04['room']}},{'$unwind':_0x46064c(0x257)},{'$group':{'_id':_0x46064c(0x284),'name':{'$first':_0x46064c(0x1f2)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x46064c(0x276)},'bin':{'$first':_0x46064c(0x2d9)},'type':{'$first':_0x46064c(0x251)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x46064c(0x2ce)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x46064c(0x238)},'storage':{'$first':_0x46064c(0x242)},'rack':{'$first':_0x46064c(0x28c)}}}]);console[_0x46064c(0x2c9)](_0x46064c(0x28f),_0x127f62);let _0x4d483e;if(_0x13ab99[_0x46064c(0x262)]==_0x46064c(0x225)){const _0x368789=await staff[_0x46064c(0x2aa)]({'email':_0x13ab99[_0x46064c(0x299)]});_0x4d483e=await warehouse[_0x46064c(0x202)]({'status':_0x46064c(0x230),'name':_0x368789[_0x46064c(0x2c5)],'warehouse_category':_0x46064c(0x240),'name':_0x46064c(0x2b4)});}else _0x4d483e=await warehouse[_0x46064c(0x22a)]([{'$match':{'status':_0x46064c(0x230),'warehouse_category':_0x46064c(0x240),'name':'Return\x20Goods'}},{'$group':{'_id':_0x46064c(0x1fb),'name':{'$first':_0x46064c(0x1fb)}}}]);if(_0x27d722[0x0]['language']=='English\x20(US)'){var _0x59a64a=users[_0x46064c(0x275)];console[_0x46064c(0x2c9)](_0x59a64a);}else{if(_0x27d722[0x0][_0x46064c(0x2e0)]==_0x46064c(0x1ed))var _0x59a64a=users[_0x46064c(0x1ed)];else{if(_0x27d722[0x0][_0x46064c(0x2e0)]==_0x46064c(0x27f))var _0x59a64a=users['German'];else{if(_0x27d722[0x0][_0x46064c(0x2e0)]==_0x46064c(0x2c8))var _0x59a64a=users[_0x46064c(0x2c8)];else{if(_0x27d722[0x0][_0x46064c(0x2e0)]==_0x46064c(0x2a7))var _0x59a64a=users[_0x46064c(0x2a7)];else{if(_0x27d722[0x0][_0x46064c(0x2e0)]==_0x46064c(0x28e))var _0x59a64a=users[_0x46064c(0x226)];else{if(_0x27d722[0x0][_0x46064c(0x2e0)]==_0x46064c(0x2d8))var _0x59a64a=users[_0x46064c(0x2d8)];else{if(_0x27d722[0x0][_0x46064c(0x2e0)]=='Arabic\x20(ae)')var _0x59a64a=users[_0x46064c(0x24d)];}}}}}}}_0x529477['render'](_0x46064c(0x258),{'success':_0x472883[_0x46064c(0x26e)](_0x46064c(0x1eb)),'errors':_0x472883[_0x46064c(0x26e)]('errors'),'role':_0x13ab99,'profile':_0x1d2551,'user':_0x36cb04,'stock':_0x127f62,'master_shop':_0x27d722,'product':_0x5beacf,'language':_0x59a64a,'warehouse':_0x4d483e});}catch(_0x5a962c){console['log'](_0x5a962c);}}),router[a0_0x445c6a(0x1fe)](a0_0x445c6a(0x2ca),auth,async(_0x4dae03,_0x27aa20)=>{var _0x41273b=a0_0x445c6a;try{const {invoice:_0x719938,date:_0x2ab07d,warehouse_name:_0xbb7eae,Room_name:_0x1eb032,product_name:_0x44d477,purchase_quantity:_0x277ffc,stocks:_0x2e89da,return_qty:_0xf23c4a,note:_0xdaf6e5,level:_0x36f720,isle:_0x3f6cbc,pallet:_0x1909e6,to_warehouse_name:_0x2595f4,to_Room_name:_0x30e29f}=_0x4dae03[_0x41273b(0x231)],_0x274840=await purchases_finished[_0x41273b(0x2aa)]({'_id':_0x4dae03[_0x41273b(0x281)]['id']}),_0x125492=await warehouse['findOne']({'name':_0xbb7eae,'room':_0x1eb032,'warehouse_category':'Finished\x20Goods'});if(typeof _0x44d477=='string')var _0x4068d3=[_0x4dae03['body']['product_name']],_0x230101=[_0x4dae03['body'][_0x41273b(0x288)]],_0x2948c5=[_0x4dae03[_0x41273b(0x231)]['stocks']],_0x4aae9c=[_0x4dae03[_0x41273b(0x231)][_0x41273b(0x20d)]],_0x3d4127=[_0x4dae03['body'][_0x41273b(0x2b9)]],_0x157fd8=[_0x4dae03[_0x41273b(0x231)][_0x41273b(0x2c7)]],_0x310817=[_0x4dae03[_0x41273b(0x231)][_0x41273b(0x22e)]],_0x2568ff=[_0x4dae03[_0x41273b(0x231)]['secondary_code_hide']];else var _0x4068d3=[..._0x4dae03[_0x41273b(0x231)]['product_name']],_0x230101=[..._0x4dae03[_0x41273b(0x231)][_0x41273b(0x288)]],_0x2948c5=[..._0x4dae03[_0x41273b(0x231)][_0x41273b(0x201)]],_0x4aae9c=[..._0x4dae03[_0x41273b(0x231)][_0x41273b(0x20d)]],_0x3d4127=[..._0x4dae03[_0x41273b(0x231)][_0x41273b(0x2b9)]],_0x157fd8=[..._0x4dae03[_0x41273b(0x231)][_0x41273b(0x2c7)]],_0x310817=[..._0x4dae03[_0x41273b(0x231)]['primary_code_hide']],_0x2568ff=[..._0x4dae03[_0x41273b(0x231)]['secondary_code_hide']];const _0x573047=_0x4068d3['map'](_0x55c44b=>{return _0x55c44b={'product_name':_0x55c44b};});_0x230101[_0x41273b(0x1fc)]((_0x35020e,_0x2cc614)=>{var _0xa8b02e=_0x41273b;_0x573047[_0x2cc614][_0xa8b02e(0x288)]=_0x35020e;}),_0x2948c5[_0x41273b(0x1fc)]((_0x83672f,_0x598f03)=>{var _0x35be84=_0x41273b;_0x573047[_0x598f03][_0x35be84(0x24b)]=_0x83672f;}),_0x4aae9c['forEach']((_0x5addfa,_0x35eaef)=>{var _0x53d5a8=_0x41273b;_0x573047[_0x35eaef][_0x53d5a8(0x20d)]=_0x5addfa;}),_0x3d4127[_0x41273b(0x1fc)]((_0x3e1b42,_0x2e8b81)=>{_0x573047[_0x2e8b81]['bay']=_0x3e1b42;}),_0x157fd8[_0x41273b(0x1fc)]((_0x225983,_0x962902)=>{var _0x2200ca=_0x41273b;_0x573047[_0x962902][_0x2200ca(0x214)]=_0x225983;}),_0x310817['forEach']((_0x30de04,_0xa44b1d)=>{var _0x3869a2=_0x41273b;_0x573047[_0xa44b1d][_0x3869a2(0x278)]=_0x30de04;}),_0x2568ff[_0x41273b(0x1fc)]((_0x48c0c7,_0x25b898)=>{var _0xeb42e9=_0x41273b;_0x573047[_0x25b898][_0xeb42e9(0x244)]=_0x48c0c7;}),_0x573047[_0x41273b(0x1fc)](_0x1be7ba=>{var _0x4a4e62=_0x41273b;console['log'](_0x1be7ba);const _0x142b4d=_0x125492['product_details'][_0x4a4e62(0x24c)](_0x13c1cf=>{var _0x4424d3=_0x4a4e62;_0x13c1cf['product_name']==_0x1be7ba[_0x4424d3(0x26d)]&&_0x13c1cf[_0x4424d3(0x21e)]==_0x1be7ba[_0x4424d3(0x21e)]&&(console['log'](parseInt(_0x13c1cf[_0x4424d3(0x25e)])+_0x4424d3(0x2cc)+parseInt(_0x1be7ba[_0x4424d3(0x20d)])),_0x13c1cf[_0x4424d3(0x25e)]=parseInt(_0x13c1cf[_0x4424d3(0x25e)])-parseInt(_0x1be7ba['return_qty']));});}),await _0x125492[_0x41273b(0x228)]();var _0x77a2fd=0x0;_0x573047['forEach'](_0x2ce512=>{var _0x584220=_0x41273b;(parseInt(_0x2ce512['purchase_quantity'])<parseInt(_0x2ce512[_0x584220(0x20d)])||parseInt(_0x2ce512[_0x584220(0x24b)])<parseInt(_0x2ce512[_0x584220(0x20d)]))&&_0x77a2fd++;});if(_0x77a2fd!=0x0)return _0x4dae03[_0x41273b(0x26e)](_0x41273b(0x2bc),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x27aa20[_0x41273b(0x2c2)](_0x41273b(0x2df));const _0x356b49=new purchases_return_finished({'invoice':_0x719938,'suppliers':_0x4dae03[_0x41273b(0x231)]['suppliers'],'date':_0x2ab07d,'warehouse_name':_0xbb7eae,'return_product':_0x573047,'note':_0xdaf6e5,'room':_0x1eb032,'to_warehouse_name':_0x2595f4,'to_room':_0x30e29f}),_0x21cf09=await _0x356b49[_0x41273b(0x228)](),_0x1ee8c0=await purchases_return_finished[_0x41273b(0x2aa)]({'invoice':_0x719938}),_0x35f2b6=await warehouse[_0x41273b(0x2aa)]({'name':_0x2595f4,'room':_0x30e29f,'warehouse_category':_0x41273b(0x240)});_0x1ee8c0[_0x41273b(0x29c)][_0x41273b(0x1fc)](_0x2752f0=>{var _0x252617=_0x41273b,_0xf915a8=0x0;const _0x56d1f4=_0x35f2b6['product_details'][_0x252617(0x24c)](_0xe1df43=>{var _0x27ad93=_0x252617;console[_0x27ad93(0x2c9)](_0xe1df43[_0x27ad93(0x26d)]+'=='+_0x2752f0[_0x27ad93(0x26d)]+'&&'+_0xe1df43[_0x27ad93(0x21e)]+'=='+_0x2752f0['bay']),_0xe1df43[_0x27ad93(0x26d)]==_0x2752f0['product_name']&&_0xe1df43['bay']==_0x2752f0[_0x27ad93(0x21e)]&&(_0xe1df43['product_stock']=parseInt(_0xe1df43[_0x27ad93(0x25e)])-parseInt(_0x2752f0['return_qty']),_0xf915a8++);});_0xf915a8=='0'&&(_0x35f2b6['product_details']=_0x35f2b6['product_details'][_0x252617(0x2a1)]({'product_name':_0x2752f0[_0x252617(0x26d)],'product_stock':_0x2752f0[_0x252617(0x20d)],'primary_code':_0x2752f0[_0x252617(0x278)],'secondary_code':_0x2752f0[_0x252617(0x244)],'product_code':_0x2752f0[_0x252617(0x214)],'bay':_0x2752f0[_0x252617(0x21e)],'maxProducts':0xf423f}));}),await _0x35f2b6['save']();const _0x493af6=await purchases_finished[_0x41273b(0x2aa)]({'invoice':_0x719938});_0x493af6['return_data']='True';const _0x16a525=await _0x493af6[_0x41273b(0x228)](),_0xe366ab=new s_payment_data({'invoice':_0x719938,'suppliers':_0x4dae03[_0x41273b(0x231)]['suppliers'],'reason':'Purchase\x20Return'});await _0xe366ab[_0x41273b(0x228)]();const _0x81be33=await master_shop[_0x41273b(0x202)](),_0x18ccb5=await email_settings[_0x41273b(0x2aa)](),_0xd0e7f5=await suppliers[_0x41273b(0x2aa)]({'name':_0x4dae03[_0x41273b(0x231)][_0x41273b(0x237)]});_0x81be33[0x0]['currency_placement']==0x1?(right_currency=_0x81be33[0x0][_0x41273b(0x229)],left_currency=''):(right_currency='',left_currency=_0x81be33[0x0]['currency']);var _0x44edd2=_0x4068d3,_0x5441f9=_0x4aae9c,_0x467f02='',_0x458a60;for(_0x458a60 in _0x44edd2){_0x467f02+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x44edd2[_0x458a60]+'</td>'+_0x41273b(0x26c)+_0x5441f9[_0x458a60]+'</td>'+_0x41273b(0x2d2);}let _0x402254=nodemailer[_0x41273b(0x1ea)]({'service':'gmail','auth':{'user':_0x18ccb5[_0x41273b(0x299)],'pass':_0x18ccb5['password']}}),_0x746861={'from':_0x18ccb5[_0x41273b(0x299)],'to':_0xd0e7f5[_0x41273b(0x299)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x41273b(0x2dc)+_0x81be33[0x0][_0x41273b(0x27d)],'cid':_0x41273b(0x1f3)}],'html':_0x41273b(0x2b8)+_0x41273b(0x20f)+_0x41273b(0x249)+_0x41273b(0x264)+_0x41273b(0x223)+'<div>'+_0x41273b(0x22f)+_0x41273b(0x294)+_0x41273b(0x264)+_0x41273b(0x1f9)+_0x81be33[0x0][_0x41273b(0x255)]+'\x20</h2>'+_0x41273b(0x294)+_0x41273b(0x294)+_0x41273b(0x227)+'<div>'+_0x41273b(0x28b)+_0x41273b(0x23f)+_0x719938+'\x20'+_0x41273b(0x29d)+'\x20Order\x20Date\x20:\x20'+_0x2ab07d+'\x20'+'</span>'+_0x41273b(0x2ae)+'</div>'+_0x41273b(0x208)+_0x41273b(0x203)+_0x41273b(0x2ab)+_0x41273b(0x2cd)+_0x41273b(0x274)+_0x41273b(0x221)+_0x41273b(0x2c4)+_0x41273b(0x2d2)+_0x41273b(0x2b2)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x467f02+'\x20'+'</tbody>'+_0x41273b(0x22d)+_0x41273b(0x264)+_0x41273b(0x216)+_0x41273b(0x2a0)+_0x81be33[0x0][_0x41273b(0x255)]+_0x41273b(0x2ae)+'</div>'+_0x41273b(0x294)+'</body></html>'};_0x402254[_0x41273b(0x23c)](_0x746861,function(_0x24cbc9,_0x1602d5){var _0x182b3e=_0x41273b;_0x24cbc9?console['log'](_0x182b3e(0x20a)):console[_0x182b3e(0x2c9)]('Email\x20sent\x20successfully');}),_0x4dae03[_0x41273b(0x26e)](_0x41273b(0x1eb),_0x41273b(0x1ef)),_0x27aa20['redirect']('/all_purchases_finished/view');}catch(_0x10f395){_0x27aa20[_0x41273b(0x27b)](0xc8)[_0x41273b(0x263)]({'message':_0x10f395[_0x41273b(0x2c6)]});}}),router[a0_0x445c6a(0x271)]('/barcode/:id',auth,async(_0xae2a53,_0x17efc4)=>{var _0x2c5c97=a0_0x445c6a;try{const {username:_0x1c323c,email:_0x4a1497,role:_0x824a7}=_0xae2a53[_0x2c5c97(0x2d0)],_0x3d300e=_0xae2a53[_0x2c5c97(0x2d0)],_0x2f80fe=await profile['findOne']({'email':_0x3d300e[_0x2c5c97(0x299)]}),_0x2ece05=await master_shop[_0x2c5c97(0x202)](),_0x3c5a30=_0xae2a53['params']['id'],_0x186bc8=await purchases_finished[_0x2c5c97(0x285)](_0x3c5a30);if(_0x2ece05[0x0][_0x2c5c97(0x2e0)]==_0x2c5c97(0x261))var _0x5db7a9=users[_0x2c5c97(0x275)];else{if(_0x2ece05[0x0][_0x2c5c97(0x2e0)]==_0x2c5c97(0x1ed))var _0x5db7a9=users[_0x2c5c97(0x1ed)];else{if(_0x2ece05[0x0][_0x2c5c97(0x2e0)]==_0x2c5c97(0x27f))var _0x5db7a9=users[_0x2c5c97(0x27f)];else{if(_0x2ece05[0x0][_0x2c5c97(0x2e0)]==_0x2c5c97(0x2c8))var _0x5db7a9=users[_0x2c5c97(0x2c8)];else{if(_0x2ece05[0x0][_0x2c5c97(0x2e0)]==_0x2c5c97(0x2a7))var _0x5db7a9=users['French'];else{if(_0x2ece05[0x0]['language']==_0x2c5c97(0x28e))var _0x5db7a9=users[_0x2c5c97(0x226)];else{if(_0x2ece05[0x0][_0x2c5c97(0x2e0)]==_0x2c5c97(0x2d8))var _0x5db7a9=users['Chinese'];else{if(_0x2ece05[0x0][_0x2c5c97(0x2e0)]==_0x2c5c97(0x283))var _0x5db7a9=users[_0x2c5c97(0x24d)];}}}}}}}_0x17efc4[_0x2c5c97(0x248)](_0x2c5c97(0x20b),{'success':_0xae2a53[_0x2c5c97(0x26e)](_0x2c5c97(0x1eb)),'errors':_0xae2a53[_0x2c5c97(0x26e)]('errors'),'role':_0x3d300e,'profile':_0x2f80fe,'alldata':_0x186bc8,'master_shop':_0x2ece05,'language':_0x5db7a9}),console[_0x2c5c97(0x2c9)](alldata);}catch(_0x171641){console[_0x2c5c97(0x2c9)](_0x171641);}}),router['post']('/barcode_scanner',async(_0x1fa1fe,_0x38a860)=>{var _0x39d5c9=a0_0x445c6a;const {product_code:_0xa4fc30}=_0x1fa1fe[_0x39d5c9(0x231)];var _0x5a859c;const _0x19dd78=await product[_0x39d5c9(0x22a)]([{'$match':{'primary_code':_0xa4fc30,'product_category':_0x39d5c9(0x240)}},{'$group':{'_id':_0x39d5c9(0x1e8),'name':{'$first':_0x39d5c9(0x1fb)},'category':{'$first':_0x39d5c9(0x289)},'brand':{'$first':_0x39d5c9(0x2af)},'unit':{'$first':_0x39d5c9(0x252)},'alertquantity':{'$first':_0x39d5c9(0x2d4)},'product_code':{'$first':_0x39d5c9(0x1fa)},'primary_code':{'$first':_0x39d5c9(0x2a6)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x39d5c9(0x1f7)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x46231b=await product['aggregate']([{'$match':{'secondary_code':_0xa4fc30}},{'$group':{'_id':_0x39d5c9(0x1e8),'name':{'$first':'$name'},'category':{'$first':_0x39d5c9(0x289)},'brand':{'$first':'$brand'},'unit':{'$first':_0x39d5c9(0x252)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x39d5c9(0x1fa)},'primary_code':{'$first':_0x39d5c9(0x2a6)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x39d5c9(0x1f7)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x39d5c9(0x2bd)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x19dd78['length']>0x0)_0x5a859c=_0x19dd78;else _0x46231b[_0x39d5c9(0x268)]>0x0&&(_0x5a859c=_0x46231b);_0x38a860[_0x39d5c9(0x263)](_0x5a859c);}),router[a0_0x445c6a(0x1fe)]('/CheckingWarehouse',async(_0x540664,_0x53de05)=>{var _0x3b96d2=a0_0x445c6a;const {productCode:_0x9d12d2,bay:_0x505828,warehouses:_0x5318e9,room:_0x23f20d}=_0x540664[_0x3b96d2(0x231)];console[_0x3b96d2(0x2c9)](_0x540664['body']);try{const _0x208e50=await warehouse[_0x3b96d2(0x22a)]([{'$match':{'name':_0x5318e9,'room':_0x23f20d}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x505828)}},{'$group':{'_id':_0x3b96d2(0x284),'name':{'$first':_0x3b96d2(0x1f2)},'product_stock':{'$first':_0x3b96d2(0x265)},'bay':{'$first':_0x3b96d2(0x276)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x53de05[_0x3b96d2(0x27b)](0xc8)['json'](_0x208e50);}catch(_0x23aedf){_0x53de05[_0x3b96d2(0x27b)](0x194)[_0x3b96d2(0x263)]({'message':_0x23aedf[_0x3b96d2(0x2c6)]});}}),module[a0_0x445c6a(0x222)]=router;