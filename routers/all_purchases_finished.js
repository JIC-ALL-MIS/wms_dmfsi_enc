var a0_0x5a58e6=a0_0x252d;function a0_0xf19f(){var _0x50f278=['json','$product_details.floorlevel','/view/:id','$product.bay','prod_secondunit','</h5>','master','body','$alertquantity','host','</tr>','True','Return\x20Goods','secondary_unit','return_qty','return_purchase_finished','return_data','11397haAgEG','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','email','suppliers','product_cat','room_name','Portuguese\x20(BR)','product_date','$product_details.primary_code','primary_code_hide','prod_name','$product_details.product_name','$date','Paid\x20For\x20Purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','find','params','prod_unit','$name','forEach','production_date','secondary_code','MaxStocks_data','$brand','get','password','Rack\x201','</span>','Enclosed','errors','max_product_unit','An\x20error\x20occurred\x20while\x20saving\x20data.','random','level','$paid_amount','getFullYear','edit_purchases_finished','/CheckingWarehouse','string','$suppliers','$category','user','logo','stock_data','Logo.png','$invoice','warehouse_name','flash','success','prod_Qty','edit_purchases_finished_view','$product_details.type','concat','<h5>','save','prod_qty','/barcode_scanner','16YDrqYC','getDate','$product_details.secondary_code','paid_amount','secondary_code_hide','product_name','\x20Order\x20Number\x20:\x20','maxStocks','Purchase\x20Mail','<div>','purchase_quantity','/all_purchases/view','prod_primunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</table>','$note','$room','site_title','getMonth','$secondary_unit','product','<strong>\x20Regards\x20</strong>','/all_purchases_finished/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','updateOne','$product.floorlevel','purchase\x20data\x20add\x20successfully','table\x20page','$product_details.bay','gmail','prod_level','standard_unit','/view/return_purchase/:id','/barcode/:id','/give_payment/:id','</div>','findOne','3748612NFlMYR','$product_details.bin','415805wlwGJC','QA\x20Warehouse','$product.type','2UptrBN','Chinese','DRY\x20GOODS','</td>','redirect','English\x20(US)','Room_name','</tbody>','FGSEmail','staff','INCF-','express','German','</body></html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/view','<span\x20style=\x22float:\x20right;\x22>','../middleware/auth','status','floor','Spanish','Router','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','path','$product_details.product_stock','18062210JaaOMX','maxperunit','prod_code','purchase\x20data\x20update\x20successfully','currency','quantity','../public/language/languages.json','nodemailer','slice','createTransport','length','3453396TJmWZt','all_purchases_finished','</head><body>','$product_code','role','back','$suppliers_docs','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Rack\x202','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Email\x20sent\x20successfully','map','$product.room_name','\x20<>\x20','2004363hdSfVh','expiry_date','<tr>','Arabic','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','log','English','due_amount','toString','</thead>','<!DOCTYPE\x20html>','aggregate','$product.quantity','findById','note','amount','Purchase\x20Return','$product_details.rack','batch_code','<h2>\x20','French','render','$product','prod_invoice','$warehouse_name','error','payment\x20successfull','$maxStocks','then','/invoice/:id','invoice','$product_details','product_code','$primary_code','<h5\x20style=\x22text-align:\x20left;\x22>','name','product_stock','language','Hindi','warehouse','bay','Enabled','prod_cat','<html><head><title></title>','port','Error\x20Occurs','$_id','/view/add_purchases','\x20Order\x20Date\x20:\x20','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product_details.maxProducts','$maxProdPerUnit','Finished\x20Goods','$expiry_date','message','Portuguese','add_purchases_finished','date','JO_number','72DIWELb','$return_data','primary_code','product_details','An\x20error\x20occurred.','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<tbody\x20style=\x22text-align:\x20center;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_code_hide','catch','$product.bin','RoomAssign','sendMail','suppliers_docs','filter','\x20</h2>','room','Arabic\x20(ae)','$product_details.storage','$batch_code','94463XDBPlB','<hr\x20class=\x22my-3\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','post'];a0_0xf19f=function(){return _0x50f278;};return a0_0xf19f();}(function(_0x2218fb,_0xa29014){var _0x5e6f88=a0_0x252d,_0x41fad1=_0x2218fb();while(!![]){try{var _0x2657d7=parseInt(_0x5e6f88(0x2a9))/0x1*(parseInt(_0x5e6f88(0x226))/0x2)+parseInt(_0x5e6f88(0x1c3))/0x3*(parseInt(_0x5e6f88(0x295))/0x4)+-parseInt(_0x5e6f88(0x223))/0x5+-parseInt(_0x5e6f88(0x24a))/0x6+-parseInt(_0x5e6f88(0x221))/0x7+parseInt(_0x5e6f88(0x1fc))/0x8*(-parseInt(_0x5e6f88(0x259))/0x9)+parseInt(_0x5e6f88(0x23f))/0xa;if(_0x2657d7===_0xa29014)break;else _0x41fad1['push'](_0x41fad1['shift']());}catch(_0x186033){_0x41fad1['push'](_0x41fad1['shift']());}}}(a0_0xf19f,0x506c1));function a0_0x252d(_0x2ba453,_0x1cabfc){var _0xf19f40=a0_0xf19f();return a0_0x252d=function(_0x252d2e,_0xf2b6b8){_0x252d2e=_0x252d2e-0x1c3;var _0x10e537=_0xf19f40[_0x252d2e];return _0x10e537;},a0_0x252d(_0x2ba453,_0x1cabfc);}const express=require(a0_0x5a58e6(0x231)),app=express(),router=express[a0_0x5a58e6(0x23b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x5a58e6(0x237)),nodemailer=require(a0_0x5a58e6(0x246));var ejs=require('ejs');const path=require(a0_0x5a58e6(0x23d)),users=require(a0_0x5a58e6(0x245));router[a0_0x5a58e6(0x1db)](a0_0x5a58e6(0x235),auth,async(_0x398dd3,_0x38005b)=>{var _0x5e72bc=a0_0x5a58e6;try{const {username:_0x1e9e55,email:_0x5ce94b,role:_0x4a5997}=_0x398dd3[_0x5e72bc(0x1ec)],_0x10a41b=_0x398dd3['user'],_0x1cf590=await profile['findOne']({'email':_0x10a41b['email']}),_0x44fc12=await staff['findOne']({'email':_0x10a41b[_0x5e72bc(0x1c5)]});if(_0x10a41b[_0x5e72bc(0x24e)]==_0x5e72bc(0x22f)){const _0x15a85c=await staff[_0x5e72bc(0x220)]({'email':_0x10a41b[_0x5e72bc(0x1c5)]});}const _0x58d5d8=await master_shop[_0x5e72bc(0x1d2)]();let _0x2c0c74;if(_0x10a41b[_0x5e72bc(0x24e)]==_0x5e72bc(0x22f)){const _0x225190=await staff[_0x5e72bc(0x220)]({'email':_0x10a41b['email']});_0x2c0c74=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x225190[_0x5e72bc(0x280)]}},{'$lookup':{'from':_0x5e72bc(0x1c6),'localField':_0x5e72bc(0x1c6),'foreignField':_0x5e72bc(0x27c),'as':_0x5e72bc(0x2a2)}},{'$unwind':_0x5e72bc(0x250)},{'$unwind':'$product'},{'$group':{'_id':_0x5e72bc(0x287),'invoice':{'$first':_0x5e72bc(0x1f0)},'suppliers':{'$first':_0x5e72bc(0x1ea)},'date':{'$first':_0x5e72bc(0x1cf)},'warehouse_name':{'$first':_0x5e72bc(0x271)},'room':{'$first':_0x5e72bc(0x20c)},'product':{'$push':_0x5e72bc(0x26f)},'note':{'$first':_0x5e72bc(0x20b)},'paid_amount':{'$first':_0x5e72bc(0x1e5)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x5e72bc(0x296)},'batch_code':{'$first':_0x5e72bc(0x2a8)},'expiry_date':{'$first':_0x5e72bc(0x28f)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x5e72bc(0x265)},'level':{'$addToSet':_0x5e72bc(0x2b0)},'isle':{'$addToSet':_0x5e72bc(0x29f)},'type':{'$addToSet':_0x5e72bc(0x225)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2c0c74=await purchases_finished[_0x5e72bc(0x264)]([{'$unwind':_0x5e72bc(0x26f)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5e72bc(0x1f0)},'suppliers':{'$first':_0x5e72bc(0x1ea)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5e72bc(0x271)},'room':{'$addToSet':_0x5e72bc(0x257)},'product':{'$push':_0x5e72bc(0x26f)},'note':{'$first':_0x5e72bc(0x20b)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x5e72bc(0x296)},'batch_code':{'$first':_0x5e72bc(0x2a8)},'expiry_date':{'$first':_0x5e72bc(0x28f)},'suppliers_docs':{'$first':_0x5e72bc(0x250)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x5e72bc(0x225)},'floorlevel':{'$addToSet':_0x5e72bc(0x215)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x58d5d8[0x0][_0x5e72bc(0x27e)]=='English\x20(US)')var _0xe910bc=users[_0x5e72bc(0x25f)];else{if(_0x58d5d8[0x0]['language']==_0x5e72bc(0x27f))var _0xe910bc=users[_0x5e72bc(0x27f)];else{if(_0x58d5d8[0x0][_0x5e72bc(0x27e)]=='German')var _0xe910bc=users[_0x5e72bc(0x232)];else{if(_0x58d5d8[0x0][_0x5e72bc(0x27e)]==_0x5e72bc(0x23a))var _0xe910bc=users[_0x5e72bc(0x23a)];else{if(_0x58d5d8[0x0][_0x5e72bc(0x27e)]=='French')var _0xe910bc=users[_0x5e72bc(0x26d)];else{if(_0x58d5d8[0x0][_0x5e72bc(0x27e)]==_0x5e72bc(0x1c9))var _0xe910bc=users[_0x5e72bc(0x291)];else{if(_0x58d5d8[0x0]['language']==_0x5e72bc(0x227))var _0xe910bc=users[_0x5e72bc(0x227)];else{if(_0x58d5d8[0x0][_0x5e72bc(0x27e)]==_0x5e72bc(0x2a6))var _0xe910bc=users[_0x5e72bc(0x25c)];}}}}}}}_0x38005b['render'](_0x5e72bc(0x24b),{'success':_0x398dd3['flash'](_0x5e72bc(0x1f3)),'errors':_0x398dd3[_0x5e72bc(0x1f2)](_0x5e72bc(0x1e0)),'purchases':_0x2c0c74,'role':_0x10a41b,'profile':_0x1cf590,'master_shop':_0x58d5d8,'language':_0xe910bc});}catch(_0x162629){console[_0x5e72bc(0x25e)](_0x5e72bc(0x217),_0x162629),_0x38005b[_0x5e72bc(0x238)](0xc8)['json']({'message':_0x162629[_0x5e72bc(0x290)]});}});function BayBinSelected(_0x447df9,_0x3e363b){var _0x2626f7=a0_0x5a58e6,_0x3debb0=[],_0x5e3972=[];if(_0x447df9==_0x2626f7(0x228)){switch(_0x3e363b){case _0x2626f7(0x1dd):_0x3debb0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x2626f7(0x253):_0x3debb0=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5e3972=['DG'];}else{if(_0x447df9=='FROZEN\x20GOODS'){switch(_0x3e363b){case _0x2626f7(0x1dd):_0x3debb0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x2626f7(0x253):_0x3debb0=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5e3972=['FG'];}}return{'levels':_0x3debb0,'identify':_0x5e3972};}async function getRandom8DigitNumber(){var _0x2e238b=a0_0x5a58e6;const _0x220a25=0x989680,_0x4a3147=0x5f5e0ff,_0x1a1302=Math[_0x2e238b(0x239)](Math[_0x2e238b(0x1e3)]()*(_0x4a3147-_0x220a25+0x1))+_0x220a25;var _0xff5f85;const _0x23fba6=await purchases_finished[_0x2e238b(0x220)]({'invoice':_0x2e238b(0x230)+_0x1a1302});return _0x23fba6&&_0x23fba6[_0x2e238b(0x249)]>0x0?_0xff5f85=_0x2e238b(0x230)+_0x1a1302:_0xff5f85='INCF-'+_0x1a1302,_0xff5f85;}router['get'](a0_0x5a58e6(0x288),auth,async(_0x29aab2,_0x1a8f13)=>{var _0x4fb100=a0_0x5a58e6;try{const {username:_0x50386d,email:_0x5ba8b1,role:_0x50d2b7}=_0x29aab2[_0x4fb100(0x1ec)],_0x536f76=_0x29aab2[_0x4fb100(0x1ec)],_0xa59d08=await profile[_0x4fb100(0x220)]({'email':_0x536f76[_0x4fb100(0x1c5)]}),_0x9bb1f8=await master_shop['find'](),_0x108c73=await staff[_0x4fb100(0x220)]({'email':_0x536f76[_0x4fb100(0x1c5)]}),_0x10a1e2=await suppliers[_0x4fb100(0x1d2)]({});let _0x3777e5;if(_0x536f76['role']==_0x4fb100(0x22f)){const _0x30cb75=await staff[_0x4fb100(0x220)]({'email':_0x536f76['email']});_0x3777e5=await warehouse[_0x4fb100(0x264)]([{'$match':{'status':'Enabled','name':_0x30cb75['warehouse'],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x4fb100(0x1d5),'name':{'$first':_0x4fb100(0x1d5)}}}]);}else _0x3777e5=await warehouse[_0x4fb100(0x264)]([{'$match':{'status':_0x4fb100(0x282),'warehouse_category':_0x4fb100(0x28e),'name':{'$ne':_0x4fb100(0x224)}}},{'$group':{'_id':_0x4fb100(0x1d5),'name':{'$first':_0x4fb100(0x1d5)}}}]);const _0x7a214c=await product['find']({}),_0x1eb39f=await warehouse[_0x4fb100(0x1d2)]({'status':_0x4fb100(0x282)}),_0x5d75cf=await purchases_finished[_0x4fb100(0x1d2)]({}),_0x3b8969=_0x5d75cf[_0x4fb100(0x249)]+0x1,_0x1a59be=_0x4fb100(0x230)+_0x3b8969[_0x4fb100(0x261)]()['padStart'](0x5,'0');var _0x484135=[_0x4fb100(0x28a),_0x4fb100(0x1df)];if(_0x9bb1f8[0x0][_0x4fb100(0x27e)]==_0x4fb100(0x22b))var _0x32384d=users[_0x4fb100(0x25f)];else{if(_0x9bb1f8[0x0][_0x4fb100(0x27e)]==_0x4fb100(0x27f))var _0x32384d=users['Hindi'];else{if(_0x9bb1f8[0x0][_0x4fb100(0x27e)]==_0x4fb100(0x232))var _0x32384d=users['German'];else{if(_0x9bb1f8[0x0][_0x4fb100(0x27e)]==_0x4fb100(0x23a))var _0x32384d=users[_0x4fb100(0x23a)];else{if(_0x9bb1f8[0x0]['language']==_0x4fb100(0x26d))var _0x32384d=users[_0x4fb100(0x26d)];else{if(_0x9bb1f8[0x0]['language']==_0x4fb100(0x1c9))var _0x32384d=users[_0x4fb100(0x291)];else{if(_0x9bb1f8[0x0][_0x4fb100(0x27e)]==_0x4fb100(0x227))var _0x32384d=users[_0x4fb100(0x227)];else{if(_0x9bb1f8[0x0][_0x4fb100(0x27e)]=='Arabic\x20(ae)')var _0x32384d=users[_0x4fb100(0x25c)];}}}}}}}const _0x3fc96d=getRandom8DigitNumber();_0x3fc96d[_0x4fb100(0x275)](_0x220f15=>{var _0x86c55c=_0x4fb100;_0x1a8f13[_0x86c55c(0x26e)](_0x86c55c(0x292),{'success':_0x29aab2[_0x86c55c(0x1f2)](_0x86c55c(0x1f3)),'errors':_0x29aab2['flash'](_0x86c55c(0x1e0)),'role':_0x536f76,'profile':_0xa59d08,'suppliers':_0x10a1e2,'warehouse':_0x3777e5,'product':_0x7a214c,'invoice':_0x220f15,'master_shop':_0x9bb1f8,'language':_0x32384d,'find_data':_0x1eb39f,'rooms_data':_0x484135});})[_0x4fb100(0x29e)](_0x32e379=>{var _0x4d5a6d=_0x4fb100;_0x29aab2[_0x4d5a6d(0x1f2)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1a8f13['redirect'](_0x4d5a6d(0x212));});}catch(_0x174944){console[_0x4fb100(0x25e)](_0x174944);}}),router[a0_0x5a58e6(0x1db)]('/view/add_purchases/:id',auth,async(_0x102512,_0x191c03)=>{var _0x266cb8=a0_0x5a58e6;try{const _0x12224e=_0x102512[_0x266cb8(0x1d3)]['id'];console[_0x266cb8(0x25e)](_0x12224e);const _0x35f4c6=await master_shop[_0x266cb8(0x1d2)]();console[_0x266cb8(0x25e)](_0x266cb8(0x2b3),_0x35f4c6);const _0x59ca61=await product[_0x266cb8(0x220)]({'name':_0x12224e});console['log'](_0x266cb8(0x210),_0x59ca61),_0x191c03[_0x266cb8(0x238)](0xc8)['json']({'product_data':_0x59ca61,'master':_0x35f4c6});}catch(_0x355b6f){console['log']('add_purchases\x20error',_0x355b6f);}}),router[a0_0x5a58e6(0x2ac)](a0_0x5a58e6(0x288),auth,async(_0x55b907,_0x15da29)=>{var _0x304c12=a0_0x5a58e6;try{const {invoice:_0x5de374,date:_0x196c9f,warehouse_name:_0x3ceb06,prod_name:_0x55b91b,prod_code:_0x106cd9,prod_qty:_0x2e256e,prod_unit:_0x35d05b,prod_secondunit:_0x27e940,prod_level:_0x1d0c2,prod_isle:_0x8d9adc,prod_pallet:_0x3de1e9,note:_0x4858aa,expiry_date:_0xfd5a3,batch_code:_0x27e612,payable:_0x400722,due_amount:_0x3b0c20,Room_name:_0x316db5,primary_code:_0x31d467,secondary_code:_0x4f9774,MaxStocks_data:_0x509b72,PO_number:_0x87fc51,SCRN:_0x1db3c6,JO_number:_0x670b86}=_0x55b907[_0x304c12(0x2b4)];if(typeof _0x55b91b==_0x304c12(0x1e9))var _0x8df650=[_0x55b907[_0x304c12(0x2b4)]['prod_name']],_0x4feeaf=[_0x55b907[_0x304c12(0x2b4)][_0x304c12(0x241)]],_0x59a58b=[_0x55b907['body'][_0x304c12(0x1f4)]],_0x2b49f9=[_0x55b907['body'][_0x304c12(0x208)]],_0x2ac7f8=[_0x55b907['body'][_0x304c12(0x2b1)]],_0x3f4fad=[_0x55b907[_0x304c12(0x2b4)][_0x304c12(0x21a)]],_0x1af1bf=[_0x55b907['body'][_0x304c12(0x297)]],_0x47f090=[_0x55b907[_0x304c12(0x2b4)][_0x304c12(0x1d8)]],_0x48df10=[_0x55b907[_0x304c12(0x2b4)][_0x304c12(0x1d9)]],_0x1f013b=[_0x55b907[_0x304c12(0x2b4)][_0x304c12(0x26b)]],_0xbea385=[_0x55b907[_0x304c12(0x2b4)]['expiry_date']],_0x7220fa=[_0x55b907[_0x304c12(0x2b4)][_0x304c12(0x1ca)]],_0x4ee9b4=[_0x55b907[_0x304c12(0x2b4)][_0x304c12(0x1e1)]],_0x2c27fc=[_0x55b907[_0x304c12(0x2b4)][_0x304c12(0x283)]],_0x22518a=[_0x55b907['body'][_0x304c12(0x2a0)]],_0x5c2cc2=[_0x55b907[_0x304c12(0x2b4)]['prod_invoice']];else var _0x8df650=[..._0x55b907['body'][_0x304c12(0x1cd)]],_0x4feeaf=[..._0x55b907[_0x304c12(0x2b4)][_0x304c12(0x241)]],_0x59a58b=[..._0x55b907[_0x304c12(0x2b4)][_0x304c12(0x1f4)]],_0x2b49f9=[..._0x55b907[_0x304c12(0x2b4)][_0x304c12(0x208)]],_0x2ac7f8=[..._0x55b907['body'][_0x304c12(0x2b1)]],_0x3f4fad=[..._0x55b907[_0x304c12(0x2b4)]['prod_level']],_0x1af1bf=[..._0x55b907['body'][_0x304c12(0x297)]],_0x47f090=[..._0x55b907['body'][_0x304c12(0x1d8)]],_0x48df10=[..._0x55b907[_0x304c12(0x2b4)][_0x304c12(0x1d9)]],_0x1f013b=[..._0x55b907['body'][_0x304c12(0x26b)]],_0xbea385=[..._0x55b907[_0x304c12(0x2b4)][_0x304c12(0x25a)]],_0x7220fa=[..._0x55b907[_0x304c12(0x2b4)][_0x304c12(0x1ca)]],_0x4ee9b4=[..._0x55b907['body'][_0x304c12(0x1e1)]],_0x2c27fc=[..._0x55b907[_0x304c12(0x2b4)][_0x304c12(0x283)]],_0x22518a=[..._0x55b907[_0x304c12(0x2b4)][_0x304c12(0x2a0)]],_0x5c2cc2=[..._0x55b907['body'][_0x304c12(0x270)]];const _0x30d8aa=_0x8df650[_0x304c12(0x256)](_0x25d446=>{return _0x25d446={'product_name':_0x25d446};});_0x4feeaf[_0x304c12(0x1d6)]((_0xc23b38,_0x18e81a)=>{var _0x453d26=_0x304c12;_0x30d8aa[_0x18e81a][_0x453d26(0x279)]=_0xc23b38;}),_0x59a58b['forEach']((_0x3e2b0e,_0x5e332f)=>{var _0x3a9fb4=_0x304c12;_0x30d8aa[_0x5e332f][_0x3a9fb4(0x244)]=_0x3e2b0e;}),_0x2b49f9['forEach']((_0xd4f221,_0x568eeb)=>{var _0x239eca=_0x304c12;_0x30d8aa[_0x568eeb][_0x239eca(0x21b)]=_0xd4f221;}),_0x2ac7f8['forEach']((_0x3a38df,_0x716efa)=>{var _0x4ddf31=_0x304c12;_0x30d8aa[_0x716efa][_0x4ddf31(0x2ba)]=_0x3a38df;}),_0x3f4fad[_0x304c12(0x1d6)]((_0x417787,_0x444f8d)=>{var _0x113ba3=_0x304c12;_0x30d8aa[_0x444f8d][_0x113ba3(0x281)]=_0x417787;}),_0x1af1bf[_0x304c12(0x1d6)]((_0x45083c,_0x20ab85)=>{var _0x2006e5=_0x304c12;_0x30d8aa[_0x20ab85][_0x2006e5(0x297)]=_0x45083c;}),_0x47f090['forEach']((_0x45d99a,_0x1a7228)=>{_0x30d8aa[_0x1a7228]['secondary_code']=_0x45d99a;}),_0x48df10[_0x304c12(0x1d6)]((_0x32fe46,_0x1a2b9f)=>{var _0x268b52=_0x304c12;_0x30d8aa[_0x1a2b9f][_0x268b52(0x203)]=_0x32fe46;}),_0x1f013b[_0x304c12(0x1d6)]((_0x17f666,_0x4510c3)=>{var _0x5ba108=_0x304c12;_0x30d8aa[_0x4510c3][_0x5ba108(0x26b)]=_0x17f666;}),_0xbea385['forEach']((_0xc02dd7,_0x5b366)=>{var _0x2581e9=_0x304c12;_0x30d8aa[_0x5b366][_0x2581e9(0x25a)]=_0xc02dd7;}),_0x7220fa[_0x304c12(0x1d6)]((_0x37f142,_0x358260)=>{var _0x6c4376=_0x304c12;_0x30d8aa[_0x358260][_0x6c4376(0x1d7)]=_0x37f142;}),_0x4ee9b4[_0x304c12(0x1d6)]((_0x167313,_0x14007c)=>{var _0x389ed9=_0x304c12;_0x30d8aa[_0x14007c][_0x389ed9(0x240)]=_0x167313;}),_0x2c27fc[_0x304c12(0x1d6)]((_0x465554,_0x2dd9b2)=>{var _0x4ffbb4=_0x304c12;_0x30d8aa[_0x2dd9b2][_0x4ffbb4(0x1c7)]=_0x465554;}),_0x22518a['forEach']((_0x52dd06,_0x31ae16)=>{var _0x2224ad=_0x304c12;_0x30d8aa[_0x31ae16][_0x2224ad(0x1c8)]=_0x52dd06;}),_0x5c2cc2['forEach']((_0x3790b4,_0x303051)=>{var _0x4d0700=_0x304c12;_0x30d8aa[_0x303051][_0x4d0700(0x277)]=_0x3790b4;});const _0x1ec820=_0x30d8aa[_0x304c12(0x2a3)](_0x4096be=>_0x4096be[_0x304c12(0x244)]!=='0'&&_0x4096be['quantity']!==''),_0x5e461e=new purchases_finished({'invoice':_0x5de374,'suppliers':_0x55b907[_0x304c12(0x2b4)]['suppliers'],'date':_0x196c9f,'warehouse_name':_0x3ceb06,'product':_0x1ec820,'note':_0x4858aa,'due_amount':_0x3b0c20,'room':_0x316db5,'POnumber':_0x87fc51,'SCRN':_0x1db3c6,'JO_number':_0x670b86}),_0x433e9d=await _0x5e461e[_0x304c12(0x1f9)](),_0x38afc0=await purchases_finished[_0x304c12(0x220)]({'invoice':_0x5de374}),_0x47e5d6=_0x38afc0[_0x304c12(0x210)][_0x304c12(0x256)](async _0x49b2ca=>{var _0x4ddf4c=_0x304c12,_0x2ddbdf=await warehouse['findOne']({'name':_0x3ceb06,'room':_0x49b2ca['room_name']}),_0x2f7607=0x0;const _0x2ab945=_0x2ddbdf[_0x4ddf4c(0x298)][_0x4ddf4c(0x256)](_0x2a2cb4=>{var _0x492569=_0x4ddf4c;console[_0x492569(0x25e)](_0x2a2cb4[_0x492569(0x201)]+'=='+_0x49b2ca['product_name']+'&&'+_0x2a2cb4[_0x492569(0x281)]+'=='+_0x49b2ca[_0x492569(0x281)]+'&&'+_0x2a2cb4['expiry_date']+'=='+_0x49b2ca[_0x492569(0x25a)]+'&&'+_0x2a2cb4[_0x492569(0x1d7)]+'=='+_0x49b2ca[_0x492569(0x1d7)]+'&&'+_0x2a2cb4[_0x492569(0x26b)]+'=='+_0x49b2ca[_0x492569(0x26b)]+'&&'+_0x2a2cb4[_0x492569(0x277)]+'=='+_0x38afc0[_0x492569(0x277)]),_0x2a2cb4['product_name']==_0x49b2ca['product_name']&&_0x2a2cb4['bay']==_0x49b2ca[_0x492569(0x281)]&&_0x2a2cb4[_0x492569(0x25a)]==_0x49b2ca['expiry_date']&&_0x2a2cb4[_0x492569(0x1d7)]==_0x49b2ca[_0x492569(0x1d7)]&&_0x2a2cb4[_0x492569(0x26b)]==_0x49b2ca[_0x492569(0x26b)]&&_0x2a2cb4[_0x492569(0x277)]==_0x38afc0[_0x492569(0x277)]&&(_0x2a2cb4[_0x492569(0x27d)]=_0x2a2cb4[_0x492569(0x27d)]+_0x49b2ca[_0x492569(0x244)],_0x2f7607++);});return _0x2f7607=='0'&&(_0x2ddbdf[_0x4ddf4c(0x298)]=_0x2ddbdf[_0x4ddf4c(0x298)][_0x4ddf4c(0x1f7)]({'product_name':_0x49b2ca[_0x4ddf4c(0x201)],'product_stock':_0x49b2ca[_0x4ddf4c(0x244)],'primary_code':_0x49b2ca['primary_code'],'secondary_code':_0x49b2ca[_0x4ddf4c(0x1d8)],'product_code':_0x49b2ca[_0x4ddf4c(0x279)],'bay':_0x49b2ca['bay'],'maxProducts':_0x49b2ca[_0x4ddf4c(0x203)],'unit':_0x49b2ca[_0x4ddf4c(0x21b)],'secondary_unit':_0x49b2ca[_0x4ddf4c(0x2ba)],'expiry_date':_0x49b2ca[_0x4ddf4c(0x25a)],'production_date':_0x49b2ca['production_date'],'maxProducts':_0x49b2ca[_0x4ddf4c(0x203)],'maxPerUnit':_0x49b2ca[_0x4ddf4c(0x240)],'batch_code':_0x49b2ca[_0x4ddf4c(0x26b)],'product_cat':_0x49b2ca[_0x4ddf4c(0x1c7)],'invoice':_0x49b2ca[_0x4ddf4c(0x277)]})),_0x2ddbdf;});Promise['all'](_0x47e5d6)[_0x304c12(0x275)](async _0xbfc0c2=>{var _0x5a1b3c=_0x304c12;try{for(const _0x274b6d of _0xbfc0c2){await warehouse[_0x5a1b3c(0x214)]({'_id':_0x274b6d['_id']},{'$addToSet':{'product_details':{'$each':_0x274b6d[_0x5a1b3c(0x298)]}}});}const _0x16a122=await master_shop[_0x5a1b3c(0x1d2)](),_0x5e3d06=await email_settings[_0x5a1b3c(0x220)](),_0x22cbcb=await supervisor_settings['find']();var _0x2c7d30=_0x38afc0[_0x5a1b3c(0x210)],_0x5def1b='',_0x4f51fb;for(_0x4f51fb in _0x2c7d30){var _0x5ee0b9='FG';_0x38afc0[_0x5a1b3c(0x1f1)]==_0x5a1b3c(0x228)&&(_0x5ee0b9='DG'),_0x5def1b+=_0x5a1b3c(0x25b)+_0x5a1b3c(0x254)+_0x2c7d30[_0x4f51fb][_0x5a1b3c(0x201)]+_0x5a1b3c(0x229)+_0x5a1b3c(0x254)+_0x2c7d30[_0x4f51fb][_0x5a1b3c(0x279)]+_0x5a1b3c(0x229)+_0x5a1b3c(0x254)+_0x2c7d30[_0x4f51fb]['quantity']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2c7d30[_0x4f51fb][_0x5a1b3c(0x21b)]+_0x5a1b3c(0x229)+_0x5a1b3c(0x254)+_0x2c7d30[_0x4f51fb]['secondary_unit']+_0x5a1b3c(0x229)+_0x5a1b3c(0x254)+_0x38afc0[_0x5a1b3c(0x1f1)]+_0x5a1b3c(0x229)+_0x5a1b3c(0x254)+_0x2c7d30[_0x4f51fb]['room_name']+_0x5a1b3c(0x229)+_0x5a1b3c(0x254)+_0x5ee0b9+_0x2c7d30[_0x4f51fb][_0x5a1b3c(0x281)]+_0x5a1b3c(0x229),_0x5a1b3c(0x2b7);}let _0x378975=nodemailer[_0x5a1b3c(0x248)]({'host':_0x5e3d06[_0x5a1b3c(0x2b6)],'port':Number(_0x5e3d06[_0x5a1b3c(0x285)]),'secure':![],'auth':{'user':_0x5e3d06[_0x5a1b3c(0x1c5)],'pass':_0x5e3d06[_0x5a1b3c(0x1dc)]}}),_0xc5f94b={'from':_0x5e3d06[_0x5a1b3c(0x1c5)],'to':_0x22cbcb[0x0][_0x5a1b3c(0x22e)],'subject':_0x5a1b3c(0x204),'attachments':[{'filename':_0x5a1b3c(0x1ef),'path':__dirname+'/../public'+'/upload/'+_0x16a122[0x0]['image'],'cid':_0x5a1b3c(0x1ed)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x5a1b3c(0x24c)+'<div>'+_0x5a1b3c(0x2ab)+_0x5a1b3c(0x205)+_0x5a1b3c(0x29c)+_0x5a1b3c(0x21f)+_0x5a1b3c(0x205)+_0x5a1b3c(0x26c)+_0x16a122[0x0][_0x5a1b3c(0x20d)]+'\x20</h2>'+_0x5a1b3c(0x21f)+_0x5a1b3c(0x21f)+_0x5a1b3c(0x2aa)+_0x5a1b3c(0x205)+_0x5a1b3c(0x27b)+_0x5a1b3c(0x202)+_0x38afc0[_0x5a1b3c(0x277)]+'\x20'+_0x5a1b3c(0x236)+_0x5a1b3c(0x289)+_0x38afc0[_0x5a1b3c(0x293)]+'\x20'+'</span>'+'</h5>'+_0x5a1b3c(0x21f)+_0x5a1b3c(0x251)+_0x5a1b3c(0x25d)+_0x5a1b3c(0x25b)+_0x5a1b3c(0x1d1)+_0x5a1b3c(0x1c4)+_0x5a1b3c(0x23c)+_0x5a1b3c(0x209)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x5a1b3c(0x213)+_0x5a1b3c(0x234)+'</tr>'+_0x5a1b3c(0x262)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5def1b+'\x20'+_0x5a1b3c(0x22d)+'</table>'+_0x5a1b3c(0x205)+_0x5a1b3c(0x211)+_0x5a1b3c(0x1f8)+_0x16a122[0x0][_0x5a1b3c(0x20d)]+_0x5a1b3c(0x2b2)+_0x5a1b3c(0x21f)+'</div>'+_0x5a1b3c(0x233)};_0x378975[_0x5a1b3c(0x2a1)](_0xc5f94b,function(_0x31b340,_0x48d4e1){var _0x159194=_0x5a1b3c;_0x31b340?(console[_0x159194(0x25e)](_0x31b340),console[_0x159194(0x25e)](_0x159194(0x286))):console['log'](_0x159194(0x255));});}catch(_0x15b960){console['error'](_0x15b960),_0x15da29['status'](0x1f4)['json']({'error':_0x5a1b3c(0x1e2),'message':_0x15b960[_0x5a1b3c(0x290)]});}})[_0x304c12(0x29e)](_0x2667e5=>{var _0x475144=_0x304c12;console[_0x475144(0x272)](_0x2667e5),_0x15da29[_0x475144(0x238)](0x1f4)[_0x475144(0x2ad)]({'error':_0x475144(0x299)});}),_0x55b907[_0x304c12(0x1f2)]('success',_0x304c12(0x216)),_0x15da29[_0x304c12(0x22a)]('/all_purchases_finished/view');}catch(_0x987b6f){console[_0x304c12(0x25e)](_0x987b6f);}}),router[a0_0x5a58e6(0x1db)]('/preview/:id',auth,async(_0x3740dc,_0x205e2a)=>{var _0x54eb77=a0_0x5a58e6;try{const {username:_0x496605,email:_0x42880f,role:_0x5d989d}=_0x3740dc['user'],_0x4fb9cb=_0x3740dc[_0x54eb77(0x1ec)],_0x25b4ec=await profile[_0x54eb77(0x220)]({'email':_0x4fb9cb[_0x54eb77(0x1c5)]}),_0x9303a=await master_shop['find'](),_0x3d953f=_0x3740dc['params']['id'],_0xbc013f=await purchases_finished[_0x54eb77(0x266)](_0x3d953f),_0x410dee=await suppliers[_0x54eb77(0x1d2)]({});let _0x485f7f;if(_0x4fb9cb[_0x54eb77(0x24e)]==_0x54eb77(0x22f)){const _0x342505=await staff['findOne']({'email':_0x4fb9cb[_0x54eb77(0x1c5)]});_0x485f7f=await warehouse[_0x54eb77(0x1d2)]({'status':_0x54eb77(0x282),'name':_0x342505['warehouse'],'warehouse_category':_0x54eb77(0x28e)});}else _0x485f7f=await warehouse[_0x54eb77(0x264)]([{'$match':{'status':_0x54eb77(0x282),'warehouse_category':_0x54eb77(0x28e)}},{'$group':{'_id':_0x54eb77(0x1d5),'name':{'$first':_0x54eb77(0x1d5)}}}]);const _0xd118ba=await product['find']({}),_0x423c04=BayBinSelected(_0xbc013f[_0x54eb77(0x1f1)],_0xbc013f['room']);let _0x1af065=new Date(_0xbc013f['expiry_date']),_0x4bbe70=('0'+_0x1af065[_0x54eb77(0x1fd)]())['slice'](-0x2),_0x44359d=('0'+(_0x1af065[_0x54eb77(0x20e)]()+0x1))[_0x54eb77(0x247)](-0x2),_0x5cea8a=_0x1af065[_0x54eb77(0x1e6)](),_0x3d8c9d=_0x5cea8a+'-'+_0x44359d+'-'+_0x4bbe70;if(_0x9303a[0x0]['language']==_0x54eb77(0x22b)){var _0x39b29a=users[_0x54eb77(0x25f)];console['log'](_0x39b29a);}else{if(_0x9303a[0x0][_0x54eb77(0x27e)]=='Hindi')var _0x39b29a=users[_0x54eb77(0x27f)];else{if(_0x9303a[0x0]['language']==_0x54eb77(0x232))var _0x39b29a=users[_0x54eb77(0x232)];else{if(_0x9303a[0x0][_0x54eb77(0x27e)]==_0x54eb77(0x23a))var _0x39b29a=users['Spanish'];else{if(_0x9303a[0x0]['language']==_0x54eb77(0x26d))var _0x39b29a=users[_0x54eb77(0x26d)];else{if(_0x9303a[0x0][_0x54eb77(0x27e)]==_0x54eb77(0x1c9))var _0x39b29a=users[_0x54eb77(0x291)];else{if(_0x9303a[0x0][_0x54eb77(0x27e)]=='Chinese')var _0x39b29a=users[_0x54eb77(0x227)];else{if(_0x9303a[0x0][_0x54eb77(0x27e)]=='Arabic\x20(ae)')var _0x39b29a=users[_0x54eb77(0x25c)];}}}}}}}_0x205e2a[_0x54eb77(0x26e)](_0x54eb77(0x1f5),{'success':_0x3740dc[_0x54eb77(0x1f2)]('success'),'errors':_0x3740dc[_0x54eb77(0x1f2)](_0x54eb77(0x1e0)),'role':_0x4fb9cb,'profile':_0x25b4ec,'purchases':_0xbc013f,'suppliers':_0x410dee,'warehouse':_0x485f7f,'product':_0xd118ba,'master_shop':_0x9303a,'language':_0x39b29a,'ed_fullDate':_0x3d8c9d,'dataSelected':_0x423c04});}catch(_0x58020d){console[_0x54eb77(0x25e)](_0x58020d);}}),router[a0_0x5a58e6(0x1db)](a0_0x5a58e6(0x2af),auth,async(_0x38c815,_0x5dca6a)=>{var _0x5b76bb=a0_0x5a58e6;try{const {username:_0x27d6b8,email:_0x40f25d,role:_0x472393}=_0x38c815[_0x5b76bb(0x1ec)],_0x54421a=_0x38c815['user'],_0x566d3f=await profile[_0x5b76bb(0x220)]({'email':_0x54421a[_0x5b76bb(0x1c5)]}),_0x1da95c=await master_shop[_0x5b76bb(0x1d2)](),_0x48047d=_0x38c815['params']['id'],_0x3e9177=await purchases_finished['findById'](_0x48047d),_0x41d0ee=await suppliers['find']({});let _0x86b48d;if(_0x54421a[_0x5b76bb(0x24e)]==_0x5b76bb(0x22f)){const _0x294f83=await staff[_0x5b76bb(0x220)]({'email':_0x54421a[_0x5b76bb(0x1c5)]});_0x86b48d=await warehouse['find']({'status':_0x5b76bb(0x282),'name':_0x294f83[_0x5b76bb(0x280)],'warehouse_category':_0x5b76bb(0x28e)});}else _0x86b48d=await warehouse[_0x5b76bb(0x264)]([{'$match':{'status':_0x5b76bb(0x282),'warehouse_category':_0x5b76bb(0x28e)}},{'$group':{'_id':_0x5b76bb(0x1d5),'name':{'$first':_0x5b76bb(0x1d5)}}}]);const _0x4d4bf6=await product['find']({}),_0x174006=BayBinSelected(_0x3e9177['warehouse_name'],_0x3e9177[_0x5b76bb(0x2a5)]);let _0x15808b=new Date(_0x3e9177[_0x5b76bb(0x25a)]),_0x3dd2c3=('0'+_0x15808b[_0x5b76bb(0x1fd)]())['slice'](-0x2),_0x3d9369=('0'+(_0x15808b[_0x5b76bb(0x20e)]()+0x1))[_0x5b76bb(0x247)](-0x2),_0x57a77b=_0x15808b[_0x5b76bb(0x1e6)](),_0x2d538f=_0x57a77b+'-'+_0x3d9369+'-'+_0x3dd2c3;if(_0x1da95c[0x0]['language']==_0x5b76bb(0x22b)){var _0xb24a9f=users[_0x5b76bb(0x25f)];console['log'](_0xb24a9f);}else{if(_0x1da95c[0x0][_0x5b76bb(0x27e)]=='Hindi')var _0xb24a9f=users['Hindi'];else{if(_0x1da95c[0x0][_0x5b76bb(0x27e)]==_0x5b76bb(0x232))var _0xb24a9f=users[_0x5b76bb(0x232)];else{if(_0x1da95c[0x0][_0x5b76bb(0x27e)]=='Spanish')var _0xb24a9f=users[_0x5b76bb(0x23a)];else{if(_0x1da95c[0x0][_0x5b76bb(0x27e)]==_0x5b76bb(0x26d))var _0xb24a9f=users[_0x5b76bb(0x26d)];else{if(_0x1da95c[0x0][_0x5b76bb(0x27e)]==_0x5b76bb(0x1c9))var _0xb24a9f=users[_0x5b76bb(0x291)];else{if(_0x1da95c[0x0][_0x5b76bb(0x27e)]=='Chinese')var _0xb24a9f=users[_0x5b76bb(0x227)];else{if(_0x1da95c[0x0][_0x5b76bb(0x27e)]==_0x5b76bb(0x2a6))var _0xb24a9f=users[_0x5b76bb(0x25c)];}}}}}}}_0x5dca6a[_0x5b76bb(0x26e)](_0x5b76bb(0x1e7),{'success':_0x38c815[_0x5b76bb(0x1f2)](_0x5b76bb(0x1f3)),'errors':_0x38c815[_0x5b76bb(0x1f2)](_0x5b76bb(0x1e0)),'role':_0x54421a,'profile':_0x566d3f,'purchases':_0x3e9177,'suppliers':_0x41d0ee,'warehouse':_0x86b48d,'product':_0x4d4bf6,'master_shop':_0x1da95c,'language':_0xb24a9f,'ed_fullDate':_0x2d538f,'dataSelected':_0x174006});}catch(_0x2864f7){console[_0x5b76bb(0x25e)](_0x2864f7);}}),router[a0_0x5a58e6(0x2ac)](a0_0x5a58e6(0x2af),auth,async(_0x555a23,_0x16fc3f)=>{var _0x14baf7=a0_0x5a58e6;try{const _0x1c7a89=_0x555a23['params']['id'],_0x3962c4=await purchases_finished['findOne']({'_id':_0x555a23[_0x14baf7(0x1d3)]['id']}),_0x6f75c3=await warehouse[_0x14baf7(0x220)]({'name':_0x3962c4[_0x14baf7(0x1f1)],'room':_0x3962c4[_0x14baf7(0x2a5)]});_0x3962c4['product']['forEach'](_0x5c1f60=>{const _0x30e1de=_0x6f75c3['product_details']['map'](_0x2cc195=>{var _0x1423d9=a0_0x252d;_0x2cc195['product_name']==_0x5c1f60[_0x1423d9(0x201)]&&_0x2cc195[_0x1423d9(0x281)]==_0x5c1f60[_0x1423d9(0x281)]&&(_0x2cc195[_0x1423d9(0x27d)]=parseInt(_0x2cc195[_0x1423d9(0x27d)])-parseInt(_0x5c1f60['quantity']));});}),await _0x6f75c3[_0x14baf7(0x1f9)]();const {invoice:_0x5f2655,suppliers:_0x5a8ed7,date:_0x2c67a9,warehouse_name:_0x35a226,prod_name:_0xd88bf9,prod_code:_0x2ce5dc,prod_qty:_0x44347b,prod_unit:_0xf49189,prod_secondunit:_0x4fc1cc,prod_level:_0x3d31f9,prod_isle:_0x3d14b4,prod_pallet:_0x2e5016,note:_0x26eae3,expiry_date:_0x361d47,batch_code:_0xa2a7d0,paid_amount:_0x199ce2,due_amount:_0x3fb021,Room_name:_0x244c0f,primary_code:_0x5333f3,secondary_code:_0x20dc32,PO_number:_0x4a4727,JO_number:_0x48b8c4}=_0x555a23['body'];if(typeof _0xd88bf9=='string')var _0x2ffe40=[_0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x1cd)]],_0x37895b=[_0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x241)]],_0x5a5ffb=[_0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x1fa)]],_0x23e872=[_0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x1d4)]],_0x2a2a3a=[_0x555a23['body'][_0x14baf7(0x2b1)]],_0x583c94=[_0x555a23['body'][_0x14baf7(0x21a)]],_0x2873ab=[_0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x297)]],_0x4566e9=[_0x555a23[_0x14baf7(0x2b4)]['secondary_code']],_0x52d7a2=[_0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x1d9)]],_0x3e89e4=[_0x555a23[_0x14baf7(0x2b4)]['batch_code']],_0x25ff14=[_0x555a23['body'][_0x14baf7(0x25a)]];else var _0x2ffe40=[..._0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x1cd)]],_0x37895b=[..._0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x241)]],_0x5a5ffb=[..._0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x1fa)]],_0x23e872=[..._0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x1d4)]],_0x2a2a3a=[..._0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x2b1)]],_0x583c94=[..._0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x21a)]],_0x2873ab=[..._0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x297)]],_0x4566e9=[..._0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x1d8)]],_0x52d7a2=[..._0x555a23['body'][_0x14baf7(0x1d9)]],_0x3e89e4=[..._0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x26b)]],_0x25ff14=[..._0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x25a)]];const _0x23055d=_0x2ffe40[_0x14baf7(0x256)](_0x45652f=>{return _0x45652f={'product_name':_0x45652f};});_0x37895b[_0x14baf7(0x1d6)]((_0xa2674f,_0x6b7788)=>{var _0x591e61=_0x14baf7;_0x23055d[_0x6b7788][_0x591e61(0x279)]=_0xa2674f;}),_0x5a5ffb['forEach']((_0x7eccc0,_0x9380e3)=>{_0x23055d[_0x9380e3]['quantity']=_0x7eccc0;}),_0x23e872[_0x14baf7(0x1d6)]((_0x4eac57,_0x5ea4e9)=>{var _0x25c192=_0x14baf7;_0x23055d[_0x5ea4e9][_0x25c192(0x21b)]=_0x4eac57;}),_0x2a2a3a[_0x14baf7(0x1d6)]((_0x3513d3,_0xf28db0)=>{var _0x3f1412=_0x14baf7;_0x23055d[_0xf28db0][_0x3f1412(0x2ba)]=_0x3513d3;}),_0x583c94[_0x14baf7(0x1d6)]((_0x5d4423,_0x241546)=>{var _0x1e9475=_0x14baf7;_0x23055d[_0x241546][_0x1e9475(0x281)]=_0x5d4423;}),_0x2873ab[_0x14baf7(0x1d6)]((_0x2a4c6c,_0x3d94cf)=>{var _0x12bba0=_0x14baf7;_0x23055d[_0x3d94cf][_0x12bba0(0x297)]=_0x2a4c6c;}),_0x4566e9[_0x14baf7(0x1d6)]((_0x3dea06,_0x36e3bc)=>{var _0xee0235=_0x14baf7;_0x23055d[_0x36e3bc][_0xee0235(0x1d8)]=_0x3dea06;}),_0x52d7a2['forEach']((_0x46d5ce,_0x2203ea)=>{var _0x33b8e9=_0x14baf7;_0x23055d[_0x2203ea][_0x33b8e9(0x203)]=_0x46d5ce;}),_0x3e89e4[_0x14baf7(0x1d6)]((_0x180930,_0x5244b0)=>{var _0x5dbba4=_0x14baf7;_0x23055d[_0x5244b0][_0x5dbba4(0x26b)]=_0x180930;}),_0x25ff14[_0x14baf7(0x1d6)]((_0x3df705,_0x1caa4a)=>{var _0x554a22=_0x14baf7;_0x23055d[_0x1caa4a][_0x554a22(0x25a)]=_0x3df705;});const _0x1d60ae=_0x23055d[_0x14baf7(0x2a3)](_0x3cc066=>_0x3cc066[_0x14baf7(0x244)]!=='0'&&_0x3cc066[_0x14baf7(0x244)]!=='');_0x3962c4['invoice']=_0x5f2655,_0x3962c4[_0x14baf7(0x1c6)]=_0x5a8ed7,_0x3962c4[_0x14baf7(0x293)]=_0x2c67a9,_0x3962c4[_0x14baf7(0x1f1)]=_0x35a226,_0x3962c4[_0x14baf7(0x210)]=_0x1d60ae,_0x3962c4[_0x14baf7(0x267)]=_0x26eae3,_0x3962c4[_0x14baf7(0x1ff)]=_0x199ce2,_0x3962c4[_0x14baf7(0x260)]=_0x3fb021,_0x3962c4[_0x14baf7(0x2a5)]=_0x244c0f,_0x3962c4['POnumber']=_0x4a4727,_0x3962c4[_0x14baf7(0x294)]=_0x48b8c4;const _0xf5639=await _0x3962c4[_0x14baf7(0x1f9)](),_0xed9a13=await warehouse[_0x14baf7(0x220)]({'name':_0x555a23['body'][_0x14baf7(0x1f1)],'room':_0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x22c)]});_0x3962c4[_0x14baf7(0x210)]['forEach'](_0x321ed8=>{var _0x58fba2=_0x14baf7,_0x22b804=0x0;const _0x529a0c=_0xed9a13['product_details'][_0x58fba2(0x256)](_0xf1992c=>{var _0x420db6=_0x58fba2;_0xf1992c[_0x420db6(0x201)]==_0x321ed8[_0x420db6(0x201)]&&_0xf1992c[_0x420db6(0x281)]==_0x321ed8[_0x420db6(0x281)]&&(_0xf1992c[_0x420db6(0x27d)]=parseInt(_0xf1992c['product_stock'])+parseInt(_0x321ed8[_0x420db6(0x244)]),_0x22b804++);});_0x22b804=='0'&&(_0xed9a13['product_details']=_0xed9a13[_0x58fba2(0x298)]['concat']({'product_name':_0x321ed8['product_name'],'product_stock':_0x321ed8[_0x58fba2(0x244)],'primary_code':_0x321ed8[_0x58fba2(0x297)],'secondary_code':_0x321ed8['secondary_code'],'product_code':_0x321ed8['product_code'],'bay':_0x321ed8[_0x58fba2(0x281)],'maxProducts':_0x321ed8[_0x58fba2(0x203)],'unit':_0x321ed8[_0x58fba2(0x21b)],'secondary_unit':_0x321ed8[_0x58fba2(0x2ba)],'expiry_date':_0x321ed8[_0x58fba2(0x25a)]}));}),await _0xed9a13[_0x14baf7(0x1f9)]();const _0x3b9d3b=await s_payment_data[_0x14baf7(0x220)]({'invoice':_0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x277)]});if(_0x3b9d3b===null){}else console[_0x14baf7(0x25e)](_0x14baf7(0x1c6),_0x3b9d3b,_0x555a23[_0x14baf7(0x2b4)]['invoice']),_0x3b9d3b['suppliers']=_0x555a23[_0x14baf7(0x2b4)][_0x14baf7(0x1c6)],await _0x3b9d3b[_0x14baf7(0x1f9)]();_0x555a23[_0x14baf7(0x1f2)]('success',_0x14baf7(0x242)),_0x16fc3f[_0x14baf7(0x22a)]('/all_purchases_finished/view');}catch(_0x44d6a6){console[_0x14baf7(0x25e)](_0x44d6a6);}}),router[a0_0x5a58e6(0x2ac)](a0_0x5a58e6(0x21e),auth,async(_0x6107,_0x1124fc)=>{var _0x52663c=a0_0x5a58e6;try{const _0x5b013d=_0x6107['params']['id'],{invoice:_0x3ba3ee,suppliers:_0x3ad4c4,payable:_0x28d30b,due_amount:_0x5a3f0b}=_0x6107['body'],_0x343eb4=await purchases[_0x52663c(0x266)](_0x5b013d);var _0x33c205=_0x28d30b-_0x5a3f0b;_0x343eb4['paid_amount']=parseFloat(_0x343eb4['paid_amount'])+parseFloat(_0x5a3f0b),_0x343eb4[_0x52663c(0x260)]=_0x33c205;const _0x1b1494=await _0x343eb4['save']();console[_0x52663c(0x25e)](_0x1b1494);const _0x46c336=await s_payment_data[_0x52663c(0x220)]({'invoice':_0x3ba3ee});_0x46c336[_0x52663c(0x268)]=_0x33c205,await _0x46c336[_0x52663c(0x1f9)]();let _0x2b8652=new Date(),_0x964dec=('0'+_0x2b8652[_0x52663c(0x1fd)]())[_0x52663c(0x247)](-0x2),_0x473559=('0'+(_0x2b8652[_0x52663c(0x20e)]()+0x1))[_0x52663c(0x247)](-0x2),_0x5e7799=_0x2b8652[_0x52663c(0x1e6)](),_0x35f102=_0x5e7799+'-'+_0x473559+'-'+_0x964dec;const _0x3f85b7=new suppliers_payment({'invoice':_0x3ba3ee,'date':_0x5e7799+'-'+_0x473559+'-'+_0x964dec,'suppliers':_0x3ad4c4,'reason':_0x52663c(0x1d0),'amount':_0x5a3f0b}),_0x48e5eb=await _0x3f85b7[_0x52663c(0x1f9)]();_0x6107['flash']('success',_0x52663c(0x273)),_0x1124fc[_0x52663c(0x22a)](_0x52663c(0x207));}catch(_0x56a284){console['log'](_0x56a284);}}),router[a0_0x5a58e6(0x1db)](a0_0x5a58e6(0x276),auth,async(_0xdb67d4,_0x9510db)=>{var _0x5e0af3=a0_0x5a58e6;try{const {username:_0x56e90a,email:_0x4a3aa1,role:_0x5406e9}=_0xdb67d4[_0x5e0af3(0x1ec)],_0x5650f9=_0xdb67d4[_0x5e0af3(0x1ec)],_0x1d161c=await profile[_0x5e0af3(0x220)]({'email':_0x5650f9[_0x5e0af3(0x1c5)]}),_0x30116f=await master_shop['find']();console['log']('master',_0x30116f);const _0xbdc3c4=_0xdb67d4[_0x5e0af3(0x1d3)]['id'],_0x159889=await purchases[_0x5e0af3(0x266)](_0xbdc3c4);console[_0x5e0af3(0x25e)](_0x159889);const _0x111336=await suppliers[_0x5e0af3(0x220)]({'name':_0x159889[_0x5e0af3(0x1c6)]});console[_0x5e0af3(0x25e)](_0x111336);if(_0x30116f[0x0][_0x5e0af3(0x27e)]==_0x5e0af3(0x22b)){var _0x2c0219=users[_0x5e0af3(0x25f)];console[_0x5e0af3(0x25e)](_0x2c0219);}else{if(_0x30116f[0x0][_0x5e0af3(0x27e)]==_0x5e0af3(0x27f))var _0x2c0219=users[_0x5e0af3(0x27f)];else{if(_0x30116f[0x0][_0x5e0af3(0x27e)]==_0x5e0af3(0x232))var _0x2c0219=users['German'];else{if(_0x30116f[0x0][_0x5e0af3(0x27e)]=='Spanish')var _0x2c0219=users['Spanish'];else{if(_0x30116f[0x0][_0x5e0af3(0x27e)]==_0x5e0af3(0x26d))var _0x2c0219=users['French'];else{if(_0x30116f[0x0][_0x5e0af3(0x27e)]==_0x5e0af3(0x1c9))var _0x2c0219=users[_0x5e0af3(0x291)];else{if(_0x30116f[0x0][_0x5e0af3(0x27e)]==_0x5e0af3(0x227))var _0x2c0219=users['Chinese'];else{if(_0x30116f[0x0][_0x5e0af3(0x27e)]=='Arabic\x20(ae)')var _0x2c0219=users[_0x5e0af3(0x25c)];}}}}}}}_0x9510db[_0x5e0af3(0x26e)]('purchase_invoice',{'success':_0xdb67d4[_0x5e0af3(0x1f2)](_0x5e0af3(0x1f3)),'errors':_0xdb67d4[_0x5e0af3(0x1f2)](_0x5e0af3(0x1e0)),'role':_0x5650f9,'profile':_0x1d161c,'master_shop':_0x30116f,'supplier':_0x111336,'purchase':_0x159889,'language':_0x2c0219});}catch(_0x11e241){console[_0x5e0af3(0x25e)](_0x11e241);}}),router['get'](a0_0x5a58e6(0x21c),auth,async(_0x2c9c84,_0x49b6d4)=>{var _0x3bf5c7=a0_0x5a58e6;try{const {username:_0x4a67d8,email:_0x25b1d9,role:_0x214fb5}=_0x2c9c84[_0x3bf5c7(0x1ec)],_0x55076e=_0x2c9c84[_0x3bf5c7(0x1ec)],_0x2ace84=await profile[_0x3bf5c7(0x220)]({'email':_0x55076e[_0x3bf5c7(0x1c5)]}),_0x11fb8c=await master_shop[_0x3bf5c7(0x1d2)]();console['log'](_0x3bf5c7(0x2b3),_0x11fb8c);const _0x26f1c7=_0x2c9c84[_0x3bf5c7(0x1d3)]['id'];console['log'](_0x26f1c7);const _0x1f5749=await purchases_finished[_0x3bf5c7(0x266)](_0x26f1c7);console[_0x3bf5c7(0x25e)]('user_id',_0x1f5749);const _0x5c299c=await product[_0x3bf5c7(0x1d2)]({}),_0x4d7364=await warehouse[_0x3bf5c7(0x264)]([{'$match':{'name':_0x1f5749[_0x3bf5c7(0x1f1)],'room':_0x1f5749[_0x3bf5c7(0x2a5)]}},{'$unwind':_0x3bf5c7(0x278)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3bf5c7(0x1ce)},'product_stock':{'$first':_0x3bf5c7(0x23e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x3bf5c7(0x222)},'type':{'$first':_0x3bf5c7(0x1f6)},'floorlevel':{'$first':_0x3bf5c7(0x2ae)},'primary_code':{'$first':_0x3bf5c7(0x1cb)},'secondary_code':{'$first':_0x3bf5c7(0x1fe)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3bf5c7(0x2a7)},'rack':{'$first':_0x3bf5c7(0x26a)}}}]);console['log'](_0x3bf5c7(0x1ee),_0x4d7364);let _0x44f11e;if(_0x55076e['role']=='staff'){const _0x174b9a=await staff[_0x3bf5c7(0x220)]({'email':_0x55076e[_0x3bf5c7(0x1c5)]});_0x44f11e=await warehouse[_0x3bf5c7(0x1d2)]({'status':'Enabled','name':_0x174b9a[_0x3bf5c7(0x280)],'warehouse_category':_0x3bf5c7(0x28e),'name':_0x3bf5c7(0x2b9)});}else _0x44f11e=await warehouse[_0x3bf5c7(0x264)]([{'$match':{'status':_0x3bf5c7(0x282),'warehouse_category':_0x3bf5c7(0x28e),'name':_0x3bf5c7(0x2b9)}},{'$group':{'_id':_0x3bf5c7(0x1d5),'name':{'$first':_0x3bf5c7(0x1d5)}}}]);if(_0x11fb8c[0x0]['language']==_0x3bf5c7(0x22b)){var _0x13a106=users[_0x3bf5c7(0x25f)];console['log'](_0x13a106);}else{if(_0x11fb8c[0x0][_0x3bf5c7(0x27e)]==_0x3bf5c7(0x27f))var _0x13a106=users[_0x3bf5c7(0x27f)];else{if(_0x11fb8c[0x0][_0x3bf5c7(0x27e)]==_0x3bf5c7(0x232))var _0x13a106=users[_0x3bf5c7(0x232)];else{if(_0x11fb8c[0x0][_0x3bf5c7(0x27e)]==_0x3bf5c7(0x23a))var _0x13a106=users['Spanish'];else{if(_0x11fb8c[0x0]['language']==_0x3bf5c7(0x26d))var _0x13a106=users[_0x3bf5c7(0x26d)];else{if(_0x11fb8c[0x0][_0x3bf5c7(0x27e)]==_0x3bf5c7(0x1c9))var _0x13a106=users[_0x3bf5c7(0x291)];else{if(_0x11fb8c[0x0][_0x3bf5c7(0x27e)]=='Chinese')var _0x13a106=users[_0x3bf5c7(0x227)];else{if(_0x11fb8c[0x0][_0x3bf5c7(0x27e)]==_0x3bf5c7(0x2a6))var _0x13a106=users['Arabic'];}}}}}}}_0x49b6d4[_0x3bf5c7(0x26e)](_0x3bf5c7(0x2bc),{'success':_0x2c9c84[_0x3bf5c7(0x1f2)](_0x3bf5c7(0x1f3)),'errors':_0x2c9c84[_0x3bf5c7(0x1f2)]('errors'),'role':_0x55076e,'profile':_0x2ace84,'user':_0x1f5749,'stock':_0x4d7364,'master_shop':_0x11fb8c,'product':_0x5c299c,'language':_0x13a106,'warehouse':_0x44f11e});}catch(_0x3c6ca8){console[_0x3bf5c7(0x25e)](_0x3c6ca8);}}),router['post'](a0_0x5a58e6(0x21c),auth,async(_0x4fd673,_0x1b90b6)=>{var _0x243874=a0_0x5a58e6;try{const {invoice:_0x46b600,date:_0x303fc1,warehouse_name:_0x2f1597,Room_name:_0x3369bf,product_name:_0x4c97ae,purchase_quantity:_0x4ba7b0,stocks:_0x26c818,return_qty:_0x5c9b7c,note:_0x4bc38b,level:_0x14f05e,isle:_0x49c6bb,pallet:_0x517cbf,to_warehouse_name:_0x57870e,to_Room_name:_0x1cdaa5}=_0x4fd673['body'],_0x3614c6=await purchases_finished[_0x243874(0x220)]({'_id':_0x4fd673[_0x243874(0x1d3)]['id']}),_0x412dab=await warehouse[_0x243874(0x220)]({'name':_0x2f1597,'room':_0x3369bf,'warehouse_category':'Finished\x20Goods'});if(typeof _0x4c97ae==_0x243874(0x1e9))var _0x495154=[_0x4fd673[_0x243874(0x2b4)][_0x243874(0x201)]],_0x15f570=[_0x4fd673['body'][_0x243874(0x206)]],_0xc183d0=[_0x4fd673[_0x243874(0x2b4)]['stocks']],_0x4439ad=[_0x4fd673['body'][_0x243874(0x2bb)]],_0x293075=[_0x4fd673['body'][_0x243874(0x1e4)]],_0x21413d=[_0x4fd673[_0x243874(0x2b4)][_0x243874(0x29d)]],_0x50ebdb=[_0x4fd673[_0x243874(0x2b4)][_0x243874(0x1cc)]],_0x11281e=[_0x4fd673[_0x243874(0x2b4)][_0x243874(0x200)]];else var _0x495154=[..._0x4fd673[_0x243874(0x2b4)][_0x243874(0x201)]],_0x15f570=[..._0x4fd673[_0x243874(0x2b4)][_0x243874(0x206)]],_0xc183d0=[..._0x4fd673[_0x243874(0x2b4)]['stocks']],_0x4439ad=[..._0x4fd673[_0x243874(0x2b4)][_0x243874(0x2bb)]],_0x293075=[..._0x4fd673[_0x243874(0x2b4)][_0x243874(0x1e4)]],_0x21413d=[..._0x4fd673[_0x243874(0x2b4)][_0x243874(0x29d)]],_0x50ebdb=[..._0x4fd673['body'][_0x243874(0x1cc)]],_0x11281e=[..._0x4fd673[_0x243874(0x2b4)]['secondary_code_hide']];const _0x318d88=_0x495154['map'](_0x5ce8cd=>{return _0x5ce8cd={'product_name':_0x5ce8cd};});_0x15f570[_0x243874(0x1d6)]((_0x10d7c9,_0x110b8f)=>{var _0x58b450=_0x243874;_0x318d88[_0x110b8f][_0x58b450(0x206)]=_0x10d7c9;}),_0xc183d0['forEach']((_0x4c4a7e,_0x457dae)=>{_0x318d88[_0x457dae]['stock_quantity']=_0x4c4a7e;}),_0x4439ad['forEach']((_0x3ca876,_0x2e8fff)=>{var _0x5d7541=_0x243874;_0x318d88[_0x2e8fff][_0x5d7541(0x2bb)]=_0x3ca876;}),_0x293075[_0x243874(0x1d6)]((_0x4c6111,_0x13bb5b)=>{var _0x273657=_0x243874;_0x318d88[_0x13bb5b][_0x273657(0x281)]=_0x4c6111;}),_0x21413d[_0x243874(0x1d6)]((_0x47493e,_0x35313c)=>{var _0x4b2554=_0x243874;_0x318d88[_0x35313c][_0x4b2554(0x279)]=_0x47493e;}),_0x50ebdb['forEach']((_0xf182d7,_0x56f759)=>{var _0x4ebcac=_0x243874;_0x318d88[_0x56f759][_0x4ebcac(0x297)]=_0xf182d7;}),_0x11281e[_0x243874(0x1d6)]((_0x3a898b,_0x192449)=>{var _0xb2ecbc=_0x243874;_0x318d88[_0x192449][_0xb2ecbc(0x1d8)]=_0x3a898b;}),_0x318d88['forEach'](_0x430761=>{var _0x4398ab=_0x243874;console[_0x4398ab(0x25e)](_0x430761);const _0x38c262=_0x412dab['product_details']['map'](_0x47b28d=>{var _0x529b27=_0x4398ab;_0x47b28d[_0x529b27(0x201)]==_0x430761[_0x529b27(0x201)]&&_0x47b28d[_0x529b27(0x281)]==_0x430761[_0x529b27(0x281)]&&(console[_0x529b27(0x25e)](parseInt(_0x47b28d['product_stock'])+_0x529b27(0x258)+parseInt(_0x430761[_0x529b27(0x2bb)])),_0x47b28d[_0x529b27(0x27d)]=parseInt(_0x47b28d[_0x529b27(0x27d)])-parseInt(_0x430761[_0x529b27(0x2bb)]));});}),await _0x412dab['save']();var _0x231048=0x0;_0x318d88[_0x243874(0x1d6)](_0x4de1bc=>{var _0x3c16ee=_0x243874;(parseInt(_0x4de1bc[_0x3c16ee(0x206)])<parseInt(_0x4de1bc[_0x3c16ee(0x2bb)])||parseInt(_0x4de1bc['stock_quantity'])<parseInt(_0x4de1bc[_0x3c16ee(0x2bb)]))&&_0x231048++;});if(_0x231048!=0x0)return _0x4fd673['flash'](_0x243874(0x1e0),_0x243874(0x29a)),_0x1b90b6[_0x243874(0x22a)](_0x243874(0x24f));const _0x303a0f=new purchases_return_finished({'invoice':_0x46b600,'suppliers':_0x4fd673[_0x243874(0x2b4)][_0x243874(0x1c6)],'date':_0x303fc1,'warehouse_name':_0x2f1597,'return_product':_0x318d88,'note':_0x4bc38b,'room':_0x3369bf,'to_warehouse_name':_0x57870e,'to_room':_0x1cdaa5}),_0x482f7f=await _0x303a0f[_0x243874(0x1f9)](),_0x552876=await purchases_return_finished[_0x243874(0x220)]({'invoice':_0x46b600}),_0x973af4=await warehouse[_0x243874(0x220)]({'name':_0x57870e,'room':_0x1cdaa5,'warehouse_category':'Finished\x20Goods'});_0x552876['return_product'][_0x243874(0x1d6)](_0x562d5c=>{var _0x20056e=_0x243874,_0x44fb9d=0x0;const _0x237b2d=_0x973af4[_0x20056e(0x298)][_0x20056e(0x256)](_0x3730eb=>{var _0x44e06b=_0x20056e;console[_0x44e06b(0x25e)](_0x3730eb[_0x44e06b(0x201)]+'=='+_0x562d5c[_0x44e06b(0x201)]+'&&'+_0x3730eb[_0x44e06b(0x281)]+'=='+_0x562d5c[_0x44e06b(0x281)]),_0x3730eb[_0x44e06b(0x201)]==_0x562d5c['product_name']&&_0x3730eb[_0x44e06b(0x281)]==_0x562d5c[_0x44e06b(0x281)]&&(_0x3730eb[_0x44e06b(0x27d)]=parseInt(_0x3730eb['product_stock'])-parseInt(_0x562d5c[_0x44e06b(0x2bb)]),_0x44fb9d++);});_0x44fb9d=='0'&&(_0x973af4[_0x20056e(0x298)]=_0x973af4[_0x20056e(0x298)][_0x20056e(0x1f7)]({'product_name':_0x562d5c[_0x20056e(0x201)],'product_stock':_0x562d5c['return_qty'],'primary_code':_0x562d5c['primary_code'],'secondary_code':_0x562d5c['secondary_code'],'product_code':_0x562d5c[_0x20056e(0x279)],'bay':_0x562d5c[_0x20056e(0x281)],'maxProducts':0xf423f}));}),await _0x973af4[_0x243874(0x1f9)]();const _0x593dd3=await purchases_finished[_0x243874(0x220)]({'invoice':_0x46b600});_0x593dd3[_0x243874(0x2bd)]=_0x243874(0x2b8);const _0x5a6df1=await _0x593dd3[_0x243874(0x1f9)](),_0x1d86da=new s_payment_data({'invoice':_0x46b600,'suppliers':_0x4fd673[_0x243874(0x2b4)]['suppliers'],'reason':_0x243874(0x269)});await _0x1d86da[_0x243874(0x1f9)]();const _0x2c6f39=await master_shop[_0x243874(0x1d2)](),_0x1bab4e=await email_settings[_0x243874(0x220)](),_0x115b89=await suppliers['findOne']({'name':_0x4fd673[_0x243874(0x2b4)][_0x243874(0x1c6)]});_0x2c6f39[0x0]['currency_placement']==0x1?(right_currency=_0x2c6f39[0x0][_0x243874(0x243)],left_currency=''):(right_currency='',left_currency=_0x2c6f39[0x0][_0x243874(0x243)]);var _0x5f5d59=_0x495154,_0xfd0266=_0x4439ad,_0x2161e9='',_0x282399;for(_0x282399 in _0x5f5d59){_0x2161e9+=_0x243874(0x25b)+_0x243874(0x254)+_0x5f5d59[_0x282399]+'</td>'+_0x243874(0x254)+_0xfd0266[_0x282399]+'</td>'+_0x243874(0x2b7);}let _0x276c00=nodemailer[_0x243874(0x248)]({'service':_0x243874(0x219),'auth':{'user':_0x1bab4e[_0x243874(0x1c5)],'pass':_0x1bab4e['password']}}),_0x18c8b1={'from':_0x1bab4e[_0x243874(0x1c5)],'to':_0x115b89[_0x243874(0x1c5)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x243874(0x1ef),'path':__dirname+'/../public'+'/upload/'+_0x2c6f39[0x0]['image'],'cid':_0x243874(0x1ed)}],'html':_0x243874(0x263)+_0x243874(0x284)+_0x243874(0x24c)+_0x243874(0x205)+_0x243874(0x2ab)+'<div>'+_0x243874(0x29c)+'</div>'+_0x243874(0x205)+_0x243874(0x26c)+_0x2c6f39[0x0][_0x243874(0x20d)]+_0x243874(0x2a4)+'</div>'+_0x243874(0x21f)+'<hr\x20class=\x22my-3\x22>'+_0x243874(0x205)+_0x243874(0x27b)+'\x20Order\x20Number\x20:\x20'+_0x46b600+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x303fc1+'\x20'+_0x243874(0x1de)+_0x243874(0x2b2)+'</div>'+_0x243874(0x251)+_0x243874(0x25d)+_0x243874(0x25b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x243874(0x252)+_0x243874(0x28b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x243874(0x2b7)+_0x243874(0x262)+_0x243874(0x29b)+'\x20'+_0x2161e9+'\x20'+_0x243874(0x22d)+_0x243874(0x20a)+'<div>'+_0x243874(0x211)+_0x243874(0x1f8)+_0x2c6f39[0x0][_0x243874(0x20d)]+_0x243874(0x2b2)+_0x243874(0x21f)+_0x243874(0x21f)+'</body></html>'};_0x276c00[_0x243874(0x2a1)](_0x18c8b1,function(_0x1e8ff4,_0x10ca14){var _0x231bb9=_0x243874;_0x1e8ff4?console[_0x231bb9(0x25e)](_0x231bb9(0x286)):console[_0x231bb9(0x25e)](_0x231bb9(0x255));}),_0x4fd673['flash'](_0x243874(0x1f3),'purchases\x20item\x20return\x20successfull'),_0x1b90b6[_0x243874(0x22a)](_0x243874(0x212));}catch(_0x3ba378){_0x1b90b6[_0x243874(0x238)](0xc8)[_0x243874(0x2ad)]({'message':_0x3ba378[_0x243874(0x290)]});}}),router[a0_0x5a58e6(0x1db)](a0_0x5a58e6(0x21d),auth,async(_0x47579b,_0x556e11)=>{var _0x3d804e=a0_0x5a58e6;try{const {username:_0x193c6b,email:_0xe76fc8,role:_0x4f0593}=_0x47579b[_0x3d804e(0x1ec)],_0x1fb460=_0x47579b['user'],_0x1d5f26=await profile[_0x3d804e(0x220)]({'email':_0x1fb460['email']}),_0x41787f=await master_shop[_0x3d804e(0x1d2)](),_0x18616c=_0x47579b['params']['id'],_0x2e18ca=await purchases_finished[_0x3d804e(0x266)](_0x18616c);if(_0x41787f[0x0]['language']==_0x3d804e(0x22b))var _0x33f61a=users[_0x3d804e(0x25f)];else{if(_0x41787f[0x0][_0x3d804e(0x27e)]==_0x3d804e(0x27f))var _0x33f61a=users['Hindi'];else{if(_0x41787f[0x0][_0x3d804e(0x27e)]==_0x3d804e(0x232))var _0x33f61a=users[_0x3d804e(0x232)];else{if(_0x41787f[0x0][_0x3d804e(0x27e)]==_0x3d804e(0x23a))var _0x33f61a=users['Spanish'];else{if(_0x41787f[0x0][_0x3d804e(0x27e)]==_0x3d804e(0x26d))var _0x33f61a=users['French'];else{if(_0x41787f[0x0][_0x3d804e(0x27e)]==_0x3d804e(0x1c9))var _0x33f61a=users['Portuguese'];else{if(_0x41787f[0x0][_0x3d804e(0x27e)]==_0x3d804e(0x227))var _0x33f61a=users[_0x3d804e(0x227)];else{if(_0x41787f[0x0][_0x3d804e(0x27e)]==_0x3d804e(0x2a6))var _0x33f61a=users[_0x3d804e(0x25c)];}}}}}}}_0x556e11[_0x3d804e(0x26e)]('all_purchases_barcode',{'success':_0x47579b[_0x3d804e(0x1f2)](_0x3d804e(0x1f3)),'errors':_0x47579b['flash']('errors'),'role':_0x1fb460,'profile':_0x1d5f26,'alldata':_0x2e18ca,'master_shop':_0x41787f,'language':_0x33f61a}),console[_0x3d804e(0x25e)](alldata);}catch(_0x18b3f1){console['log'](_0x18b3f1);}}),router[a0_0x5a58e6(0x2ac)](a0_0x5a58e6(0x1fb),async(_0x583b1a,_0xfcfd6a)=>{var _0x51dabd=a0_0x5a58e6;const {product_code:_0x1633eb}=_0x583b1a['body'];var _0x3fbef5;const _0x2a9e6f=await product[_0x51dabd(0x264)]([{'$match':{'primary_code':_0x1633eb,'product_category':_0x51dabd(0x28e)}},{'$group':{'_id':'$_id','name':{'$first':_0x51dabd(0x1d5)},'category':{'$first':_0x51dabd(0x1eb)},'brand':{'$first':_0x51dabd(0x1da)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x51dabd(0x2b5)},'product_code':{'$first':_0x51dabd(0x24d)},'primary_code':{'$first':_0x51dabd(0x27a)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x51dabd(0x274)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x51dabd(0x20f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x52cfd9=await product[_0x51dabd(0x264)]([{'$match':{'secondary_code':_0x1633eb}},{'$group':{'_id':_0x51dabd(0x287),'name':{'$first':_0x51dabd(0x1d5)},'category':{'$first':_0x51dabd(0x1eb)},'brand':{'$first':_0x51dabd(0x1da)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x51dabd(0x24d)},'primary_code':{'$first':_0x51dabd(0x27a)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x51dabd(0x28d)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2a9e6f[_0x51dabd(0x249)]>0x0)_0x3fbef5=_0x2a9e6f;else _0x52cfd9['length']>0x0&&(_0x3fbef5=_0x52cfd9);_0xfcfd6a[_0x51dabd(0x2ad)](_0x3fbef5);}),router[a0_0x5a58e6(0x2ac)](a0_0x5a58e6(0x1e8),async(_0x4d8578,_0x3d639c)=>{var _0x11383f=a0_0x5a58e6;const {productCode:_0x4497b4,bay:_0x3228c3,warehouses:_0x2ee089,room:_0x1060f6}=_0x4d8578[_0x11383f(0x2b4)];console[_0x11383f(0x25e)](_0x4d8578[_0x11383f(0x2b4)]);try{const _0x4b3ca1=await warehouse['aggregate']([{'$match':{'name':_0x2ee089,'room':_0x1060f6}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x3228c3)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x11383f(0x1ce)},'product_stock':{'$first':_0x11383f(0x23e)},'bay':{'$first':_0x11383f(0x218)},'maxProducts':{'$first':_0x11383f(0x28c)}}}]);_0x3d639c[_0x11383f(0x238)](0xc8)[_0x11383f(0x2ad)](_0x4b3ca1);}catch(_0x476267){_0x3d639c[_0x11383f(0x238)](0x194)[_0x11383f(0x2ad)]({'message':_0x476267['message']});}}),module['exports']=router;