var a0_0x1a9f23=a0_0x4125;(function(_0x596a63,_0x1fdf69){var _0x12e107=a0_0x4125,_0x4e22db=_0x596a63();while(!![]){try{var _0x4ef9c6=-parseInt(_0x12e107(0x164))/0x1+-parseInt(_0x12e107(0x124))/0x2+parseInt(_0x12e107(0x1c7))/0x3+parseInt(_0x12e107(0x1aa))/0x4*(-parseInt(_0x12e107(0x163))/0x5)+parseInt(_0x12e107(0x18a))/0x6*(parseInt(_0x12e107(0x13d))/0x7)+parseInt(_0x12e107(0x156))/0x8+parseInt(_0x12e107(0x19a))/0x9;if(_0x4ef9c6===_0x1fdf69)break;else _0x4e22db['push'](_0x4e22db['shift']());}catch(_0x281c0f){_0x4e22db['push'](_0x4e22db['shift']());}}}(a0_0x1f6e,0x6c2f5));const express=require(a0_0x1a9f23(0x130)),app=express(),router=express[a0_0x1a9f23(0x1c0)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x1a9f23(0x16e)),auth=require(a0_0x1a9f23(0x1d7)),nodemailer=require(a0_0x1a9f23(0x168));var ejs=require(a0_0x1a9f23(0x1b2));const path=require(a0_0x1a9f23(0x1b6)),users=require(a0_0x1a9f23(0xfe));router['get'](a0_0x1a9f23(0x196),auth,async(_0xbf806c,_0x4886d4)=>{var _0x1d9abb=a0_0x1a9f23;try{const {username:_0x4670f7,email:_0x1635d1,role:_0x43449e}=_0xbf806c[_0x1d9abb(0x128)],_0x50ca60=_0xbf806c[_0x1d9abb(0x128)],_0x4d94d2=await profile[_0x1d9abb(0x1a3)]({'email':_0x50ca60[_0x1d9abb(0x121)]}),_0x32442d=await staff[_0x1d9abb(0x1a3)]({'email':_0x50ca60[_0x1d9abb(0x121)]});if(_0x50ca60[_0x1d9abb(0x12a)]==_0x1d9abb(0x198)){const _0x52b6f5=await staff[_0x1d9abb(0x1a3)]({'email':_0x50ca60['email']});}const _0x355133=await master_shop[_0x1d9abb(0xf7)]();let _0x18049e;if(_0x50ca60['role']==_0x1d9abb(0x198)){const _0x285515=await staff[_0x1d9abb(0x1a3)]({'email':_0x50ca60[_0x1d9abb(0x121)]});_0x18049e=await purchases_finished[_0x1d9abb(0x155)]([{'$match':{'warehouse_name':_0x285515['warehouse']}},{'$lookup':{'from':_0x1d9abb(0x10d),'localField':_0x1d9abb(0x10d),'foreignField':'name','as':_0x1d9abb(0x1b9)}},{'$unwind':_0x1d9abb(0x16f)},{'$unwind':'$product'},{'$group':{'_id':_0x1d9abb(0xe6),'invoice':{'$first':_0x1d9abb(0x118)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1d9abb(0x1a1)},'room':{'$first':_0x1d9abb(0x184)},'product':{'$push':_0x1d9abb(0x146)},'note':{'$first':_0x1d9abb(0x183)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x1d9abb(0x19b)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x1d9abb(0x1ce)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x1d9abb(0x16f)},'total_product_quantity':{'$sum':_0x1d9abb(0x133)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x1d9abb(0x1a9)},'type':{'$addToSet':_0x1d9abb(0x166)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x18049e=await purchases_finished[_0x1d9abb(0x155)]([{'$unwind':_0x1d9abb(0x146)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1d9abb(0x118)},'suppliers':{'$first':_0x1d9abb(0x17a)},'date':{'$first':_0x1d9abb(0x10f)},'warehouse_name':{'$first':_0x1d9abb(0x1a1)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x1d9abb(0x146)},'note':{'$first':_0x1d9abb(0x183)},'paid_amount':{'$first':_0x1d9abb(0x1d2)},'due_amount':{'$first':_0x1d9abb(0x19b)},'return_data':{'$first':_0x1d9abb(0x13a)},'batch_code':{'$first':_0x1d9abb(0x1ce)},'expiry_date':{'$first':_0x1d9abb(0x15f)},'suppliers_docs':{'$first':_0x1d9abb(0x16f)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x1d9abb(0x13e)},'isle':{'$addToSet':_0x1d9abb(0x1a9)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x355133[0x0]['language']==_0x1d9abb(0x182))var _0x1298ec=users[_0x1d9abb(0x150)];else{if(_0x355133[0x0][_0x1d9abb(0x120)]==_0x1d9abb(0x111))var _0x1298ec=users[_0x1d9abb(0x111)];else{if(_0x355133[0x0][_0x1d9abb(0x120)]==_0x1d9abb(0x14e))var _0x1298ec=users['German'];else{if(_0x355133[0x0][_0x1d9abb(0x120)]=='Spanish')var _0x1298ec=users[_0x1d9abb(0x195)];else{if(_0x355133[0x0][_0x1d9abb(0x120)]=='French')var _0x1298ec=users[_0x1d9abb(0x175)];else{if(_0x355133[0x0][_0x1d9abb(0x120)]=='Portuguese\x20(BR)')var _0x1298ec=users[_0x1d9abb(0xee)];else{if(_0x355133[0x0]['language']=='Chinese')var _0x1298ec=users[_0x1d9abb(0x1ad)];else{if(_0x355133[0x0][_0x1d9abb(0x120)]==_0x1d9abb(0x10e))var _0x1298ec=users[_0x1d9abb(0x123)];}}}}}}}_0x4886d4[_0x1d9abb(0x15e)](_0x1d9abb(0x1b7),{'success':_0xbf806c['flash'](_0x1d9abb(0x14f)),'errors':_0xbf806c[_0x1d9abb(0x17d)](_0x1d9abb(0x1c9)),'purchases':_0x18049e,'role':_0x50ca60,'profile':_0x4d94d2,'master_shop':_0x355133,'language':_0x1298ec});}catch(_0x395529){console[_0x1d9abb(0x1cf)](_0x1d9abb(0x1c3),_0x395529),_0x4886d4['status'](0xc8)[_0x1d9abb(0x16d)]({'message':_0x395529['message']});}});function BayBinSelected(_0x42ff86,_0x4b74cb){var _0x556705=a0_0x1a9f23,_0x5cbbca=[],_0x4749b9=[];if(_0x42ff86==_0x556705(0x143)){switch(_0x4b74cb){case _0x556705(0x1b3):_0x5cbbca=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x556705(0x11e):_0x5cbbca=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x4749b9=['DG'];}else{if(_0x42ff86=='FROZEN\x20GOODS'){switch(_0x4b74cb){case'Rack\x201':_0x5cbbca=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x5cbbca=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x4749b9=['FG'];}}return{'levels':_0x5cbbca,'identify':_0x4749b9};}async function getRandom8DigitNumber(){var _0x3873dd=a0_0x1a9f23;const _0x5984a2=0x989680,_0x5ee014=0x5f5e0ff,_0x2e9e23=Math['floor'](Math[_0x3873dd(0x1e1)]()*(_0x5ee014-_0x5984a2+0x1))+_0x5984a2;var _0x3dc306;const _0x7ac0cb=await purchases_finished['findOne']({'invoice':_0x3873dd(0xf2)+_0x2e9e23});return _0x7ac0cb&&_0x7ac0cb[_0x3873dd(0x1bb)]>0x0?_0x3dc306=_0x3873dd(0xf2)+_0x2e9e23:_0x3dc306=_0x3873dd(0xf2)+_0x2e9e23,_0x3dc306;}function a0_0x4125(_0x465dfe,_0x16fb4d){var _0x1f6ec3=a0_0x1f6e();return a0_0x4125=function(_0x41253b,_0x487a76){_0x41253b=_0x41253b-0xe6;var _0x3021b2=_0x1f6ec3[_0x41253b];return _0x3021b2;},a0_0x4125(_0x465dfe,_0x16fb4d);}router[a0_0x1a9f23(0x1cd)](a0_0x1a9f23(0x12e),auth,async(_0x10338f,_0x599103)=>{var _0x2ef6f5=a0_0x1a9f23;try{const {username:_0x26e9e6,email:_0x2a844f,role:_0x1c36ef}=_0x10338f[_0x2ef6f5(0x128)],_0x2e6084=_0x10338f[_0x2ef6f5(0x128)],_0x56b46c=await profile[_0x2ef6f5(0x1a3)]({'email':_0x2e6084['email']}),_0x340654=await master_shop[_0x2ef6f5(0xf7)](),_0x7de0d3=await staff[_0x2ef6f5(0x1a3)]({'email':_0x2e6084['email']}),_0x1b4dab=await suppliers[_0x2ef6f5(0xf7)]({});let _0x3fb68d;if(_0x2e6084['role']=='staff'){const _0x38b666=await staff['findOne']({'email':_0x2e6084['email']});_0x3fb68d=await warehouse[_0x2ef6f5(0x155)]([{'$match':{'status':'Enabled','name':_0x38b666[_0x2ef6f5(0x11b)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x2ef6f5(0x1e0),'name':{'$first':_0x2ef6f5(0x1e0)}}}]);}else _0x3fb68d=await warehouse[_0x2ef6f5(0x155)]([{'$match':{'status':_0x2ef6f5(0x1a2),'warehouse_category':_0x2ef6f5(0x108),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x2ef6f5(0x1e0),'name':{'$first':_0x2ef6f5(0x1e0)}}}]);const _0x497b25=await product[_0x2ef6f5(0xf7)]({}),_0x5c60b6=await warehouse[_0x2ef6f5(0xf7)]({'status':_0x2ef6f5(0x1a2)}),_0xe86fd4=await purchases_finished['find']({}),_0x51e724=_0xe86fd4[_0x2ef6f5(0x1bb)]+0x1,_0xe62f84=_0x2ef6f5(0xf2)+_0x51e724[_0x2ef6f5(0x18f)]()[_0x2ef6f5(0x1c6)](0x5,'0');var _0x3956df=[_0x2ef6f5(0x1bc),_0x2ef6f5(0x170)];if(_0x340654[0x0][_0x2ef6f5(0x120)]==_0x2ef6f5(0x182))var _0x52b580=users[_0x2ef6f5(0x150)];else{if(_0x340654[0x0][_0x2ef6f5(0x120)]=='Hindi')var _0x52b580=users[_0x2ef6f5(0x111)];else{if(_0x340654[0x0][_0x2ef6f5(0x120)]==_0x2ef6f5(0x14e))var _0x52b580=users['German'];else{if(_0x340654[0x0][_0x2ef6f5(0x120)]=='Spanish')var _0x52b580=users[_0x2ef6f5(0x195)];else{if(_0x340654[0x0][_0x2ef6f5(0x120)]==_0x2ef6f5(0x175))var _0x52b580=users[_0x2ef6f5(0x175)];else{if(_0x340654[0x0]['language']=='Portuguese\x20(BR)')var _0x52b580=users['Portuguese'];else{if(_0x340654[0x0]['language']==_0x2ef6f5(0x1ad))var _0x52b580=users[_0x2ef6f5(0x1ad)];else{if(_0x340654[0x0][_0x2ef6f5(0x120)]=='Arabic\x20(ae)')var _0x52b580=users[_0x2ef6f5(0x123)];}}}}}}}const _0x234b1f=getRandom8DigitNumber();_0x234b1f['then'](_0x1795ce=>{var _0x2e3531=_0x2ef6f5;_0x599103[_0x2e3531(0x15e)](_0x2e3531(0x1ba),{'success':_0x10338f['flash'](_0x2e3531(0x14f)),'errors':_0x10338f[_0x2e3531(0x17d)](_0x2e3531(0x1c9)),'role':_0x2e6084,'profile':_0x56b46c,'suppliers':_0x1b4dab,'warehouse':_0x3fb68d,'product':_0x497b25,'invoice':_0x1795ce,'master_shop':_0x340654,'language':_0x52b580,'find_data':_0x5c60b6,'rooms_data':_0x3956df});})['catch'](_0x3a13df=>{var _0x4c7060=_0x2ef6f5;_0x10338f[_0x4c7060(0x17d)](_0x4c7060(0x1c9),_0x4c7060(0xeb)),_0x599103[_0x4c7060(0x122)](_0x4c7060(0x14d));});}catch(_0x3d92d1){console[_0x2ef6f5(0x1cf)](_0x3d92d1);}}),router[a0_0x1a9f23(0x1cd)](a0_0x1a9f23(0x16c),auth,async(_0x39ce76,_0x10b832)=>{var _0x48e14c=a0_0x1a9f23;try{const _0x53440c=_0x39ce76[_0x48e14c(0xf8)]['id'];console[_0x48e14c(0x1cf)](_0x53440c);const _0x737b9e=await master_shop['find']();console[_0x48e14c(0x1cf)]('master',_0x737b9e);const _0x5f2b06=await product[_0x48e14c(0x1a3)]({'name':_0x53440c});console['log'](_0x48e14c(0x154),_0x5f2b06),_0x10b832[_0x48e14c(0xf5)](0xc8)[_0x48e14c(0x16d)]({'product_data':_0x5f2b06,'master':_0x737b9e});}catch(_0xd0033d){console[_0x48e14c(0x1cf)]('add_purchases\x20error',_0xd0033d);}}),router[a0_0x1a9f23(0x10a)](a0_0x1a9f23(0x12e),auth,async(_0x12fc2b,_0x30b43a)=>{var _0x2b4895=a0_0x1a9f23;try{const {invoice:_0x101534,date:_0x300465,warehouse_name:_0x38a3c4,prod_name:_0x5362b9,prod_code:_0xcaa1e,prod_qty:_0x4782ee,prod_unit:_0x2fbe0c,prod_secondunit:_0x2845d0,prod_level:_0x5e7606,prod_isle:_0x190371,prod_pallet:_0x53713f,note:_0x1ac864,expiry_date:_0x36dcff,batch_code:_0x50ffa7,payable:_0xb072ec,due_amount:_0xb161e0,Room_name:_0x35eaa9,primary_code:_0x36f7f2,secondary_code:_0x574cb3,MaxStocks_data:_0x3c4653,PO_number:_0x1ca867,SCRN:_0x4624cd,JO_number:_0x4084fd}=_0x12fc2b[_0x2b4895(0x15c)];if(typeof _0x5362b9==_0x2b4895(0x15a))var _0x39b727=[_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x145)]],_0x155c8b=[_0x12fc2b['body'][_0x2b4895(0x158)]],_0x22dfdb=[_0x12fc2b[_0x2b4895(0x15c)]['prod_Qty']],_0x4d87ea=[_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x15b)]],_0x23d8d5=[_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x13b)]],_0x18fc8c=[_0x12fc2b[_0x2b4895(0x15c)]['prod_level']],_0x405596=[_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x1c8)]],_0x421c7f=[_0x12fc2b[_0x2b4895(0x15c)]['secondary_code']],_0x156c3f=[_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x1d5)]],_0x131e8e=[_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x185)]],_0x2d9533=[_0x12fc2b[_0x2b4895(0x15c)]['expiry_date']],_0x2e01d1=[_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x18e)]],_0x4b72e1=[_0x12fc2b['body'][_0x2b4895(0x173)]],_0x575aa1=[_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0xef)]],_0x3aade7=[_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x117)]],_0x385ccc=[_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0xe8)]];else var _0x39b727=[..._0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x145)]],_0x155c8b=[..._0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x158)]],_0x22dfdb=[..._0x12fc2b[_0x2b4895(0x15c)]['prod_Qty']],_0x4d87ea=[..._0x12fc2b[_0x2b4895(0x15c)]['prod_primunit']],_0x23d8d5=[..._0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x13b)]],_0x18fc8c=[..._0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x199)]],_0x405596=[..._0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x1c8)]],_0x421c7f=[..._0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0xfa)]],_0x156c3f=[..._0x12fc2b['body']['MaxStocks_data']],_0x131e8e=[..._0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x185)]],_0x2d9533=[..._0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x1be)]],_0x2e01d1=[..._0x12fc2b[_0x2b4895(0x15c)]['product_date']],_0x4b72e1=[..._0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x173)]],_0x575aa1=[..._0x12fc2b[_0x2b4895(0x15c)]['prod_cat']],_0x3aade7=[..._0x12fc2b['body'][_0x2b4895(0x117)]],_0x385ccc=[..._0x12fc2b['body'][_0x2b4895(0xe8)]];const _0xd603cb=_0x39b727[_0x2b4895(0x1b1)](_0xb7db3a=>{return _0xb7db3a={'product_name':_0xb7db3a};});_0x155c8b[_0x2b4895(0x177)]((_0xa68ede,_0xf8ef0a)=>{var _0x3498e6=_0x2b4895;_0xd603cb[_0xf8ef0a][_0x3498e6(0x174)]=_0xa68ede;}),_0x22dfdb[_0x2b4895(0x177)]((_0x62dbc1,_0x448cb2)=>{var _0x2dcf1e=_0x2b4895;_0xd603cb[_0x448cb2][_0x2dcf1e(0x1df)]=Math['abs'](_0x62dbc1);}),_0x4d87ea['forEach']((_0x3ecbb4,_0x4957a5)=>{var _0x324455=_0x2b4895;_0xd603cb[_0x4957a5][_0x324455(0x161)]=_0x3ecbb4;}),_0x23d8d5[_0x2b4895(0x177)]((_0x6f1c89,_0x21dafb)=>{var _0x2fbc29=_0x2b4895;_0xd603cb[_0x21dafb][_0x2fbc29(0x109)]=_0x6f1c89;}),_0x18fc8c[_0x2b4895(0x177)]((_0x54cd56,_0x271fc1)=>{var _0x44ce87=_0x2b4895;_0xd603cb[_0x271fc1][_0x44ce87(0x102)]=_0x54cd56;}),_0x405596[_0x2b4895(0x177)]((_0x1925b3,_0x2f18cd)=>{_0xd603cb[_0x2f18cd]['primary_code']=_0x1925b3;}),_0x421c7f['forEach']((_0x259132,_0x47b20c)=>{var _0x31e741=_0x2b4895;_0xd603cb[_0x47b20c][_0x31e741(0xfa)]=_0x259132;}),_0x156c3f[_0x2b4895(0x177)]((_0x5ce8a8,_0x1b2089)=>{var _0x319b3e=_0x2b4895;_0xd603cb[_0x1b2089][_0x319b3e(0x151)]=_0x5ce8a8;}),_0x131e8e[_0x2b4895(0x177)]((_0x222240,_0x59073a)=>{var _0x48d60c=_0x2b4895;_0xd603cb[_0x59073a][_0x48d60c(0x185)]=_0x222240;}),_0x2d9533[_0x2b4895(0x177)]((_0x15179f,_0x5c8d8a)=>{var _0x1c50c4=_0x2b4895;_0xd603cb[_0x5c8d8a][_0x1c50c4(0x1be)]=_0x15179f;}),_0x2e01d1[_0x2b4895(0x177)]((_0xb9d64e,_0x43eaee)=>{_0xd603cb[_0x43eaee]['production_date']=_0xb9d64e;}),_0x4b72e1[_0x2b4895(0x177)]((_0x3b3552,_0x21e367)=>{var _0x291739=_0x2b4895;_0xd603cb[_0x21e367][_0x291739(0x113)]=_0x3b3552;}),_0x575aa1['forEach']((_0x4eb636,_0x46e6d8)=>{var _0x4d6522=_0x2b4895;_0xd603cb[_0x46e6d8][_0x4d6522(0x106)]=_0x4eb636;}),_0x3aade7[_0x2b4895(0x177)]((_0x10cb33,_0x29d8a2)=>{var _0xb85959=_0x2b4895;_0xd603cb[_0x29d8a2][_0xb85959(0x1a5)]=_0x10cb33;}),_0x385ccc['forEach']((_0x2283eb,_0x219fa1)=>{var _0x18ff05=_0x2b4895;_0xd603cb[_0x219fa1][_0x18ff05(0x172)]=_0x2283eb;});const _0xe98675=_0xd603cb['filter'](_0x3c5720=>_0x3c5720[_0x2b4895(0x1df)]!=='0'&&_0x3c5720[_0x2b4895(0x1df)]!==''),_0x2ca8dc=new purchases_finished({'invoice':_0x101534,'suppliers':_0x12fc2b[_0x2b4895(0x15c)][_0x2b4895(0x10d)],'date':_0x300465,'warehouse_name':_0x38a3c4,'product':_0xe98675,'note':_0x1ac864,'due_amount':_0xb161e0,'room':_0x35eaa9,'POnumber':_0x1ca867,'SCRN':_0x4624cd,'JO_number':_0x4084fd}),_0x11f39f=await _0x2ca8dc[_0x2b4895(0x1cc)](),_0x32c983=await purchases_finished[_0x2b4895(0x1a3)]({'invoice':_0x101534}),_0x5c5035=_0x32c983['product'][_0x2b4895(0x1b1)](async _0x1b5a72=>{var _0x2839c9=_0x2b4895;try{var _0x2c6580=await warehouse[_0x2839c9(0x1a3)]({'name':_0x38a3c4,'room':_0x1b5a72[_0x2839c9(0x1a5)]}),_0x275561=0x0;const _0x4e73d1=_0x2c6580['product_details']['map'](_0x3e7a63=>{var _0xc80f5f=_0x2839c9;console[_0xc80f5f(0x1cf)](_0x3e7a63[_0xc80f5f(0x1e4)]+'=='+_0x1b5a72[_0xc80f5f(0x1e4)]+'&&'+_0x3e7a63[_0xc80f5f(0x102)]+'=='+_0x1b5a72[_0xc80f5f(0x102)]+'&&'+_0x3e7a63[_0xc80f5f(0x1be)]+'=='+_0x1b5a72['expiry_date']+'&&'+_0x3e7a63[_0xc80f5f(0x1dd)]+'=='+_0x1b5a72[_0xc80f5f(0x1dd)]+'&&'+_0x3e7a63[_0xc80f5f(0x185)]+'=='+_0x1b5a72[_0xc80f5f(0x185)]+'&&'+_0x3e7a63['invoice']+'=='+_0x32c983[_0xc80f5f(0x172)]),_0x3e7a63['product_name']==_0x1b5a72[_0xc80f5f(0x1e4)]&&_0x3e7a63['bay']==_0x1b5a72['bay']&&_0x3e7a63['expiry_date']==_0x1b5a72['expiry_date']&&_0x3e7a63['production_date']==_0x1b5a72['production_date']&&_0x3e7a63[_0xc80f5f(0x185)]==_0x1b5a72[_0xc80f5f(0x185)]&&_0x3e7a63[_0xc80f5f(0x172)]==_0x32c983[_0xc80f5f(0x172)]&&(_0x3e7a63[_0xc80f5f(0x1a4)]=Math[_0xc80f5f(0x1c5)](_0x3e7a63[_0xc80f5f(0x1a4)])+Math[_0xc80f5f(0x1c5)](_0x1b5a72['quantity']),_0x275561++);});return _0x275561==0x0&&(_0x2c6580[_0x2839c9(0x18c)]=_0x2c6580[_0x2839c9(0x18c)][_0x2839c9(0x1b4)]({'product_name':_0x1b5a72[_0x2839c9(0x1e4)],'product_stock':Math['abs'](_0x1b5a72['quantity']),'primary_code':_0x1b5a72['primary_code'],'secondary_code':_0x1b5a72['secondary_code'],'product_code':_0x1b5a72[_0x2839c9(0x174)],'bay':_0x1b5a72[_0x2839c9(0x102)],'maxProducts':_0x1b5a72[_0x2839c9(0x151)],'unit':_0x1b5a72[_0x2839c9(0x161)],'secondary_unit':_0x1b5a72[_0x2839c9(0x109)],'expiry_date':_0x1b5a72['expiry_date'],'production_date':_0x1b5a72['production_date'],'maxProducts':_0x1b5a72[_0x2839c9(0x151)],'maxPerUnit':_0x1b5a72[_0x2839c9(0x113)],'batch_code':_0x1b5a72[_0x2839c9(0x185)],'product_cat':_0x1b5a72['product_cat'],'invoice':_0x1b5a72[_0x2839c9(0x172)],'id_incoming':_0x1b5a72[_0x2839c9(0x19f)]})),_0x2c6580;}catch(_0x4afae6){return console[_0x2839c9(0x129)](_0x2839c9(0x193),_0x4afae6),null;}});Promise[_0x2b4895(0x162)](_0x5c5035)[_0x2b4895(0x1dc)](async _0x2006d4=>{var _0x3fe22f=_0x2b4895;try{for(const _0x18a157 of _0x2006d4){await warehouse['updateOne']({'_id':_0x18a157[_0x3fe22f(0x19f)]},{'$addToSet':{'product_details':{'$each':_0x18a157[_0x3fe22f(0x18c)]}}});}const _0xc06055=await master_shop[_0x3fe22f(0xf7)](),_0x80f0b8=await email_settings['findOne'](),_0x2e786b=await supervisor_settings[_0x3fe22f(0xf7)]();var _0x5e7e7e=_0x32c983[_0x3fe22f(0x154)],_0x216805='',_0x341b0f;for(_0x341b0f in _0x5e7e7e){var _0x34df06='FG';_0x32c983[_0x3fe22f(0x131)]==_0x3fe22f(0x143)&&(_0x34df06='DG'),_0x216805+='<tr>'+_0x3fe22f(0x1d3)+_0x5e7e7e[_0x341b0f]['product_name']+'</td>'+_0x3fe22f(0x1d3)+_0x5e7e7e[_0x341b0f][_0x3fe22f(0x174)]+_0x3fe22f(0x1ca)+_0x3fe22f(0x1d3)+_0x5e7e7e[_0x341b0f]['quantity']+_0x3fe22f(0x1ca)+_0x3fe22f(0x1d3)+_0x5e7e7e[_0x341b0f][_0x3fe22f(0x161)]+_0x3fe22f(0x1ca)+_0x3fe22f(0x1d3)+_0x5e7e7e[_0x341b0f]['secondary_unit']+_0x3fe22f(0x1ca)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32c983['warehouse_name']+_0x3fe22f(0x1ca)+_0x3fe22f(0x1d3)+_0x5e7e7e[_0x341b0f]['room_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34df06+_0x5e7e7e[_0x341b0f][_0x3fe22f(0x102)]+'</td>',_0x3fe22f(0x159);}let _0x9c1674=nodemailer['createTransport']({'host':_0x80f0b8['host'],'port':Number(_0x80f0b8[_0x3fe22f(0x14b)]),'secure':![],'auth':{'user':_0x80f0b8[_0x3fe22f(0x121)],'pass':_0x80f0b8[_0x3fe22f(0x1a6)]}}),_0x44126d={'from':_0x80f0b8[_0x3fe22f(0x121)],'to':_0x2e786b[0x0][_0x3fe22f(0x11d)],'subject':_0x3fe22f(0x1c4),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3fe22f(0x188)+'/upload/'+_0xc06055[0x0][_0x3fe22f(0x11c)],'cid':'logo'}],'html':_0x3fe22f(0x125)+'<html><head><title></title>'+_0x3fe22f(0x1ae)+'<div>'+_0x3fe22f(0x194)+_0x3fe22f(0x105)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3fe22f(0x149)+_0x3fe22f(0x105)+'<h2>\x20'+_0xc06055[0x0][_0x3fe22f(0x11a)]+'\x20</h2>'+'</div>'+_0x3fe22f(0x149)+_0x3fe22f(0x1db)+_0x3fe22f(0x105)+_0x3fe22f(0x12d)+'\x20Order\x20Number\x20:\x20'+_0x32c983[_0x3fe22f(0x172)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3fe22f(0x191)+_0x32c983['date']+'\x20'+_0x3fe22f(0x171)+_0x3fe22f(0xec)+_0x3fe22f(0x149)+_0x3fe22f(0x1af)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3fe22f(0x1d1)+_0x3fe22f(0x135)+_0x3fe22f(0x126)+_0x3fe22f(0xf0)+_0x3fe22f(0x142)+_0x3fe22f(0x11f)+_0x3fe22f(0xff)+_0x3fe22f(0x180)+_0x3fe22f(0x1e2)+_0x3fe22f(0x159)+'</thead>'+_0x3fe22f(0x157)+'\x20'+_0x216805+'\x20'+_0x3fe22f(0x15d)+_0x3fe22f(0x17c)+_0x3fe22f(0x105)+_0x3fe22f(0x1bd)+_0x3fe22f(0x10b)+_0xc06055[0x0][_0x3fe22f(0x11a)]+_0x3fe22f(0xec)+_0x3fe22f(0x149)+'</div>'+_0x3fe22f(0x136)};_0x9c1674[_0x3fe22f(0x189)](_0x44126d,function(_0x2c43a3,_0xdf8c80){var _0x3296a0=_0x3fe22f;_0x2c43a3?(console[_0x3296a0(0x1cf)](_0x2c43a3),console['log']('Error\x20Occurs')):console[_0x3296a0(0x1cf)]('Email\x20sent\x20successfully');});}catch(_0x15c8ff){console[_0x3fe22f(0x129)](_0x15c8ff),_0x30b43a[_0x3fe22f(0xf5)](0x1f4)['json']({'error':_0x3fe22f(0x17e),'message':_0x15c8ff[_0x3fe22f(0x17f)]});}})[_0x2b4895(0x115)](_0x124d1e=>{var _0xce4afa=_0x2b4895;console[_0xce4afa(0x129)](_0x124d1e);}),_0x12fc2b[_0x2b4895(0x17d)](_0x2b4895(0x14f),'purchase\x20data\x20add\x20successfully'),_0x30b43a['redirect']('/all_purchases_finished/view');}catch(_0x44d66c){console[_0x2b4895(0x1cf)](_0x44d66c);}}),router['get'](a0_0x1a9f23(0x1cb),auth,async(_0x159487,_0x5447c8)=>{var _0x1363d2=a0_0x1a9f23;try{const {username:_0x4a4328,email:_0x3f62b2,role:_0x28214c}=_0x159487[_0x1363d2(0x128)],_0x39cb17=_0x159487[_0x1363d2(0x128)],_0x1c86b7=await profile[_0x1363d2(0x1a3)]({'email':_0x39cb17[_0x1363d2(0x121)]}),_0x4380bf=await master_shop[_0x1363d2(0xf7)](),_0x5007f6=_0x159487[_0x1363d2(0xf8)]['id'],_0x56bc01=await purchases_finished['findById'](_0x5007f6),_0x3e325b=await suppliers[_0x1363d2(0xf7)]({});let _0x7bcd32;if(_0x39cb17[_0x1363d2(0x12a)]==_0x1363d2(0x198)){const _0x29e2ee=await staff[_0x1363d2(0x1a3)]({'email':_0x39cb17['email']});_0x7bcd32=await warehouse[_0x1363d2(0xf7)]({'status':_0x1363d2(0x1a2),'name':_0x29e2ee[_0x1363d2(0x11b)],'warehouse_category':_0x1363d2(0x108)});}else _0x7bcd32=await warehouse[_0x1363d2(0x155)]([{'$match':{'status':_0x1363d2(0x1a2),'warehouse_category':_0x1363d2(0x108)}},{'$group':{'_id':_0x1363d2(0x1e0),'name':{'$first':_0x1363d2(0x1e0)}}}]);const _0x586409=await product[_0x1363d2(0xf7)]({}),_0x285ee4=BayBinSelected(_0x56bc01['warehouse_name'],_0x56bc01[_0x1363d2(0x179)]);let _0x1ac633=new Date(_0x56bc01[_0x1363d2(0x1be)]),_0x5af8e5=('0'+_0x1ac633[_0x1363d2(0x1d9)]())[_0x1363d2(0x144)](-0x2),_0x4074b9=('0'+(_0x1ac633['getMonth']()+0x1))['slice'](-0x2),_0x32797e=_0x1ac633[_0x1363d2(0x165)](),_0x4e2b8c=_0x32797e+'-'+_0x4074b9+'-'+_0x5af8e5;if(_0x4380bf[0x0][_0x1363d2(0x120)]==_0x1363d2(0x182)){var _0x360c86=users[_0x1363d2(0x150)];console['log'](_0x360c86);}else{if(_0x4380bf[0x0][_0x1363d2(0x120)]=='Hindi')var _0x360c86=users[_0x1363d2(0x111)];else{if(_0x4380bf[0x0][_0x1363d2(0x120)]=='German')var _0x360c86=users[_0x1363d2(0x14e)];else{if(_0x4380bf[0x0][_0x1363d2(0x120)]=='Spanish')var _0x360c86=users[_0x1363d2(0x195)];else{if(_0x4380bf[0x0][_0x1363d2(0x120)]==_0x1363d2(0x175))var _0x360c86=users[_0x1363d2(0x175)];else{if(_0x4380bf[0x0][_0x1363d2(0x120)]==_0x1363d2(0x114))var _0x360c86=users[_0x1363d2(0xee)];else{if(_0x4380bf[0x0][_0x1363d2(0x120)]==_0x1363d2(0x1ad))var _0x360c86=users[_0x1363d2(0x1ad)];else{if(_0x4380bf[0x0][_0x1363d2(0x120)]=='Arabic\x20(ae)')var _0x360c86=users['Arabic'];}}}}}}}_0x5447c8[_0x1363d2(0x15e)](_0x1363d2(0x101),{'success':_0x159487[_0x1363d2(0x17d)]('success'),'errors':_0x159487['flash'](_0x1363d2(0x1c9)),'role':_0x39cb17,'profile':_0x1c86b7,'purchases':_0x56bc01,'suppliers':_0x3e325b,'warehouse':_0x7bcd32,'product':_0x586409,'master_shop':_0x4380bf,'language':_0x360c86,'ed_fullDate':_0x4e2b8c,'dataSelected':_0x285ee4});}catch(_0x3e481e){console[_0x1363d2(0x1cf)](_0x3e481e);}}),router[a0_0x1a9f23(0x1cd)]('/view/:id',auth,async(_0x2e6e16,_0x355b08)=>{var _0x1e19a1=a0_0x1a9f23;try{const {username:_0x3eae66,email:_0x4b42aa,role:_0x390d1c}=_0x2e6e16[_0x1e19a1(0x128)],_0xd4379e=_0x2e6e16[_0x1e19a1(0x128)],_0x18c8fc=await profile[_0x1e19a1(0x1a3)]({'email':_0xd4379e[_0x1e19a1(0x121)]}),_0x21460e=await master_shop[_0x1e19a1(0xf7)](),_0x1b31ba=_0x2e6e16['params']['id'],_0x14cd81=await purchases_finished[_0x1e19a1(0x13f)](_0x1b31ba),_0x1793ab=await suppliers[_0x1e19a1(0xf7)]({});let _0xe0bf93;if(_0xd4379e[_0x1e19a1(0x12a)]==_0x1e19a1(0x198)){const _0x37138a=await staff[_0x1e19a1(0x1a3)]({'email':_0xd4379e['email']});_0xe0bf93=await warehouse[_0x1e19a1(0xf7)]({'status':_0x1e19a1(0x1a2),'name':_0x37138a['warehouse'],'warehouse_category':_0x1e19a1(0x108)});}else _0xe0bf93=await warehouse['aggregate']([{'$match':{'status':_0x1e19a1(0x1a2),'warehouse_category':_0x1e19a1(0x108)}},{'$group':{'_id':_0x1e19a1(0x1e0),'name':{'$first':_0x1e19a1(0x1e0)}}}]);const _0x1a7b1d=await product[_0x1e19a1(0xf7)]({}),_0x28c6d3=BayBinSelected(_0x14cd81[_0x1e19a1(0x131)],_0x14cd81[_0x1e19a1(0x179)]);let _0x5d42bc=new Date(_0x14cd81[_0x1e19a1(0x1be)]),_0x1ee70a=('0'+_0x5d42bc[_0x1e19a1(0x1d9)]())[_0x1e19a1(0x144)](-0x2),_0x5b5f9a=('0'+(_0x5d42bc[_0x1e19a1(0x152)]()+0x1))[_0x1e19a1(0x144)](-0x2),_0x3f416d=_0x5d42bc['getFullYear'](),_0x5bcc1a=_0x3f416d+'-'+_0x5b5f9a+'-'+_0x1ee70a;if(_0x21460e[0x0]['language']=='English\x20(US)'){var _0x4fa799=users['English'];console[_0x1e19a1(0x1cf)](_0x4fa799);}else{if(_0x21460e[0x0]['language']==_0x1e19a1(0x111))var _0x4fa799=users['Hindi'];else{if(_0x21460e[0x0][_0x1e19a1(0x120)]==_0x1e19a1(0x14e))var _0x4fa799=users[_0x1e19a1(0x14e)];else{if(_0x21460e[0x0][_0x1e19a1(0x120)]=='Spanish')var _0x4fa799=users[_0x1e19a1(0x195)];else{if(_0x21460e[0x0][_0x1e19a1(0x120)]==_0x1e19a1(0x175))var _0x4fa799=users[_0x1e19a1(0x175)];else{if(_0x21460e[0x0][_0x1e19a1(0x120)]==_0x1e19a1(0x114))var _0x4fa799=users[_0x1e19a1(0xee)];else{if(_0x21460e[0x0]['language']==_0x1e19a1(0x1ad))var _0x4fa799=users['Chinese'];else{if(_0x21460e[0x0][_0x1e19a1(0x120)]=='Arabic\x20(ae)')var _0x4fa799=users['Arabic'];}}}}}}}_0x355b08[_0x1e19a1(0x15e)](_0x1e19a1(0x12b),{'success':_0x2e6e16['flash'](_0x1e19a1(0x14f)),'errors':_0x2e6e16[_0x1e19a1(0x17d)]('errors'),'role':_0xd4379e,'profile':_0x18c8fc,'purchases':_0x14cd81,'suppliers':_0x1793ab,'warehouse':_0xe0bf93,'product':_0x1a7b1d,'master_shop':_0x21460e,'language':_0x4fa799,'ed_fullDate':_0x5bcc1a,'dataSelected':_0x28c6d3});}catch(_0x3a5d3a){console[_0x1e19a1(0x1cf)](_0x3a5d3a);}}),router[a0_0x1a9f23(0x10a)]('/view/:id',auth,async(_0x1f8757,_0xaa850a)=>{var _0x501cdb=a0_0x1a9f23;try{const _0x18dcf4=_0x1f8757[_0x501cdb(0xf8)]['id'],_0xb182fb=await purchases_finished[_0x501cdb(0x1a3)]({'_id':_0x1f8757[_0x501cdb(0xf8)]['id']}),_0x40c6a8=await warehouse[_0x501cdb(0x1a3)]({'name':_0xb182fb[_0x501cdb(0x131)],'room':_0xb182fb[_0x501cdb(0x179)]});_0xb182fb[_0x501cdb(0x154)][_0x501cdb(0x177)](_0x3625b8=>{var _0x1bd937=_0x501cdb;const _0x1e85a5=_0x40c6a8['product_details'][_0x1bd937(0x1b1)](_0x1f6b43=>{var _0x1c1218=_0x1bd937;_0x1f6b43['product_name']==_0x3625b8[_0x1c1218(0x1e4)]&&_0x1f6b43[_0x1c1218(0x102)]==_0x3625b8['bay']&&(_0x1f6b43[_0x1c1218(0x1a4)]=parseInt(_0x1f6b43[_0x1c1218(0x1a4)])-parseInt(_0x3625b8[_0x1c1218(0x1df)]));});}),await _0x40c6a8[_0x501cdb(0x1cc)]();const {invoice:_0x4e08fb,suppliers:_0x2c18d6,date:_0x12e033,warehouse_name:_0x2d3b3f,prod_name:_0x1f24db,prod_code:_0x4791ab,prod_qty:_0x52348d,prod_unit:_0x4a6b0f,prod_secondunit:_0xaeffd9,prod_level:_0x2946dd,prod_isle:_0x28f9ff,prod_pallet:_0x2ad603,note:_0x54b502,expiry_date:_0x11b496,batch_code:_0x31db40,paid_amount:_0x331ab3,due_amount:_0x5677ac,Room_name:_0x5127a5,primary_code:_0x406617,secondary_code:_0x41d4a2,PO_number:_0x3f4d88,JO_number:_0x4cacc2}=_0x1f8757['body'];if(typeof _0x1f24db==_0x501cdb(0x15a))var _0x427f36=[_0x1f8757[_0x501cdb(0x15c)]['prod_name']],_0x8b3eda=[_0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x158)]],_0x5cf816=[_0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x167)]],_0x1365b7=[_0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0xfb)]],_0x5a6627=[_0x1f8757['body'][_0x501cdb(0x13b)]],_0x53b189=[_0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x199)]],_0x5bbf5b=[_0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x1c8)]],_0x91d37b=[_0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0xfa)]],_0x2e4be5=[_0x1f8757['body'][_0x501cdb(0x1d5)]],_0x5b2ae2=[_0x1f8757[_0x501cdb(0x15c)]['batch_code']],_0x49e5d6=[_0x1f8757[_0x501cdb(0x15c)]['expiry_date']];else var _0x427f36=[..._0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x145)]],_0x8b3eda=[..._0x1f8757['body'][_0x501cdb(0x158)]],_0x5cf816=[..._0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x167)]],_0x1365b7=[..._0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0xfb)]],_0x5a6627=[..._0x1f8757[_0x501cdb(0x15c)]['prod_secondunit']],_0x53b189=[..._0x1f8757['body']['prod_level']],_0x5bbf5b=[..._0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x1c8)]],_0x91d37b=[..._0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0xfa)]],_0x2e4be5=[..._0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x1d5)]],_0x5b2ae2=[..._0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x185)]],_0x49e5d6=[..._0x1f8757['body'][_0x501cdb(0x1be)]];const _0x4296f4=_0x427f36[_0x501cdb(0x1b1)](_0x5c89f0=>{return _0x5c89f0={'product_name':_0x5c89f0};});_0x8b3eda['forEach']((_0x1d0679,_0xe95dff)=>{_0x4296f4[_0xe95dff]['product_code']=_0x1d0679;}),_0x5cf816[_0x501cdb(0x177)]((_0x55fdb1,_0x528a38)=>{var _0xe71916=_0x501cdb;_0x4296f4[_0x528a38][_0xe71916(0x1df)]=_0x55fdb1;}),_0x1365b7['forEach']((_0x17937c,_0xe69f0)=>{_0x4296f4[_0xe69f0]['standard_unit']=_0x17937c;}),_0x5a6627[_0x501cdb(0x177)]((_0x5d0a37,_0x58f3c2)=>{var _0x48c625=_0x501cdb;_0x4296f4[_0x58f3c2][_0x48c625(0x109)]=_0x5d0a37;}),_0x53b189[_0x501cdb(0x177)]((_0x4daa9a,_0x5878b4)=>{_0x4296f4[_0x5878b4]['bay']=_0x4daa9a;}),_0x5bbf5b['forEach']((_0x547990,_0xf55160)=>{var _0x274e1c=_0x501cdb;_0x4296f4[_0xf55160][_0x274e1c(0x1c8)]=_0x547990;}),_0x91d37b['forEach']((_0x20fe04,_0x50c914)=>{var _0xc7b569=_0x501cdb;_0x4296f4[_0x50c914][_0xc7b569(0xfa)]=_0x20fe04;}),_0x2e4be5['forEach']((_0x170f24,_0x55dece)=>{var _0x365c4c=_0x501cdb;_0x4296f4[_0x55dece][_0x365c4c(0x151)]=_0x170f24;}),_0x5b2ae2[_0x501cdb(0x177)]((_0x4761cc,_0x310efd)=>{_0x4296f4[_0x310efd]['batch_code']=_0x4761cc;}),_0x49e5d6[_0x501cdb(0x177)]((_0x4ba1e8,_0x2ca43b)=>{_0x4296f4[_0x2ca43b]['expiry_date']=_0x4ba1e8;});const _0x36c0a1=_0x4296f4[_0x501cdb(0x19d)](_0x11de63=>_0x11de63['quantity']!=='0'&&_0x11de63[_0x501cdb(0x1df)]!=='');_0xb182fb[_0x501cdb(0x172)]=_0x4e08fb,_0xb182fb[_0x501cdb(0x10d)]=_0x2c18d6,_0xb182fb[_0x501cdb(0x110)]=_0x12e033,_0xb182fb[_0x501cdb(0x131)]=_0x2d3b3f,_0xb182fb[_0x501cdb(0x154)]=_0x36c0a1,_0xb182fb[_0x501cdb(0x127)]=_0x54b502,_0xb182fb[_0x501cdb(0x140)]=_0x331ab3,_0xb182fb[_0x501cdb(0x176)]=_0x5677ac,_0xb182fb[_0x501cdb(0x179)]=_0x5127a5,_0xb182fb[_0x501cdb(0x14c)]=_0x3f4d88,_0xb182fb['JO_number']=_0x4cacc2;const _0x4cb176=await _0xb182fb[_0x501cdb(0x1cc)](),_0xdcd7cb=await warehouse[_0x501cdb(0x1a3)]({'name':_0x1f8757['body'][_0x501cdb(0x131)],'room':_0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x148)]});_0xb182fb['product'][_0x501cdb(0x177)](_0x28d81e=>{var _0x184cbf=_0x501cdb,_0x31dd51=0x0;const _0x10163a=_0xdcd7cb[_0x184cbf(0x18c)][_0x184cbf(0x1b1)](_0x121098=>{var _0x48fa91=_0x184cbf;_0x121098[_0x48fa91(0x1e4)]==_0x28d81e[_0x48fa91(0x1e4)]&&_0x121098[_0x48fa91(0x102)]==_0x28d81e['bay']&&(_0x121098[_0x48fa91(0x1a4)]=parseInt(_0x121098[_0x48fa91(0x1a4)])+parseInt(_0x28d81e['quantity']),_0x31dd51++);});_0x31dd51=='0'&&(_0xdcd7cb['product_details']=_0xdcd7cb[_0x184cbf(0x18c)]['concat']({'product_name':_0x28d81e[_0x184cbf(0x1e4)],'product_stock':_0x28d81e[_0x184cbf(0x1df)],'primary_code':_0x28d81e['primary_code'],'secondary_code':_0x28d81e[_0x184cbf(0xfa)],'product_code':_0x28d81e[_0x184cbf(0x174)],'bay':_0x28d81e['bay'],'maxProducts':_0x28d81e[_0x184cbf(0x151)],'unit':_0x28d81e[_0x184cbf(0x161)],'secondary_unit':_0x28d81e[_0x184cbf(0x109)],'expiry_date':_0x28d81e['expiry_date']}));}),await _0xdcd7cb['save']();const _0x5ac57c=await s_payment_data[_0x501cdb(0x1a3)]({'invoice':_0x1f8757['body'][_0x501cdb(0x172)]});if(_0x5ac57c===null){}else console['log'](_0x501cdb(0x10d),_0x5ac57c,_0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x172)]),_0x5ac57c[_0x501cdb(0x10d)]=_0x1f8757[_0x501cdb(0x15c)][_0x501cdb(0x10d)],await _0x5ac57c['save']();_0x1f8757[_0x501cdb(0x17d)](_0x501cdb(0x14f),_0x501cdb(0x1ab)),_0xaa850a[_0x501cdb(0x122)](_0x501cdb(0x14d));}catch(_0x1695a9){console[_0x501cdb(0x1cf)](_0x1695a9);}}),router[a0_0x1a9f23(0x10a)](a0_0x1a9f23(0x119),auth,async(_0x8831d4,_0x2acf05)=>{var _0x5ec283=a0_0x1a9f23;try{const _0x182fba=_0x8831d4[_0x5ec283(0xf8)]['id'],{invoice:_0x37c538,suppliers:_0x6a70f5,payable:_0x1964dc,due_amount:_0x52d9a6}=_0x8831d4[_0x5ec283(0x15c)],_0xf44814=await purchases['findById'](_0x182fba);var _0x43b8b0=_0x1964dc-_0x52d9a6;_0xf44814[_0x5ec283(0x140)]=parseFloat(_0xf44814['paid_amount'])+parseFloat(_0x52d9a6),_0xf44814[_0x5ec283(0x176)]=_0x43b8b0;const _0x4a1649=await _0xf44814[_0x5ec283(0x1cc)]();console[_0x5ec283(0x1cf)](_0x4a1649);const _0x2a1272=await s_payment_data[_0x5ec283(0x1a3)]({'invoice':_0x37c538});_0x2a1272[_0x5ec283(0x186)]=_0x43b8b0,await _0x2a1272[_0x5ec283(0x1cc)]();let _0x5e5cd4=new Date(),_0x183502=('0'+_0x5e5cd4['getDate']())[_0x5ec283(0x144)](-0x2),_0x3cf3d3=('0'+(_0x5e5cd4[_0x5ec283(0x152)]()+0x1))[_0x5ec283(0x144)](-0x2),_0x3401c9=_0x5e5cd4[_0x5ec283(0x165)](),_0x1cdb63=_0x3401c9+'-'+_0x3cf3d3+'-'+_0x183502;const _0x24c47c=new suppliers_payment({'invoice':_0x37c538,'date':_0x3401c9+'-'+_0x3cf3d3+'-'+_0x183502,'suppliers':_0x6a70f5,'reason':_0x5ec283(0x178),'amount':_0x52d9a6}),_0x5e63af=await _0x24c47c[_0x5ec283(0x1cc)]();_0x8831d4['flash']('success',_0x5ec283(0x18d)),_0x2acf05[_0x5ec283(0x122)]('/all_purchases/view');}catch(_0x3a335c){console[_0x5ec283(0x1cf)](_0x3a335c);}}),router[a0_0x1a9f23(0x1cd)]('/invoice/:id',auth,async(_0x534613,_0x374210)=>{var _0x19b27a=a0_0x1a9f23;try{const {username:_0x559321,email:_0xb114ee,role:_0x48dac5}=_0x534613['user'],_0x34f3b9=_0x534613[_0x19b27a(0x128)],_0x89edcd=await profile[_0x19b27a(0x1a3)]({'email':_0x34f3b9[_0x19b27a(0x121)]}),_0x14eaac=await master_shop['find']();console[_0x19b27a(0x1cf)](_0x19b27a(0x13c),_0x14eaac);const _0x2fe03b=_0x534613[_0x19b27a(0xf8)]['id'],_0x1d9bc8=await purchases['findById'](_0x2fe03b);console[_0x19b27a(0x1cf)](_0x1d9bc8);const _0x5c809d=await suppliers['findOne']({'name':_0x1d9bc8[_0x19b27a(0x10d)]});console[_0x19b27a(0x1cf)](_0x5c809d);if(_0x14eaac[0x0]['language']==_0x19b27a(0x182)){var _0x32c05e=users[_0x19b27a(0x150)];console[_0x19b27a(0x1cf)](_0x32c05e);}else{if(_0x14eaac[0x0][_0x19b27a(0x120)]==_0x19b27a(0x111))var _0x32c05e=users[_0x19b27a(0x111)];else{if(_0x14eaac[0x0][_0x19b27a(0x120)]==_0x19b27a(0x14e))var _0x32c05e=users[_0x19b27a(0x14e)];else{if(_0x14eaac[0x0][_0x19b27a(0x120)]==_0x19b27a(0x195))var _0x32c05e=users[_0x19b27a(0x195)];else{if(_0x14eaac[0x0]['language']==_0x19b27a(0x175))var _0x32c05e=users['French'];else{if(_0x14eaac[0x0][_0x19b27a(0x120)]=='Portuguese\x20(BR)')var _0x32c05e=users[_0x19b27a(0xee)];else{if(_0x14eaac[0x0][_0x19b27a(0x120)]==_0x19b27a(0x1ad))var _0x32c05e=users[_0x19b27a(0x1ad)];else{if(_0x14eaac[0x0][_0x19b27a(0x120)]==_0x19b27a(0x10e))var _0x32c05e=users[_0x19b27a(0x123)];}}}}}}}_0x374210[_0x19b27a(0x15e)](_0x19b27a(0xe9),{'success':_0x534613[_0x19b27a(0x17d)]('success'),'errors':_0x534613[_0x19b27a(0x17d)](_0x19b27a(0x1c9)),'role':_0x34f3b9,'profile':_0x89edcd,'master_shop':_0x14eaac,'supplier':_0x5c809d,'purchase':_0x1d9bc8,'language':_0x32c05e});}catch(_0x34cd77){console[_0x19b27a(0x1cf)](_0x34cd77);}}),router['get'](a0_0x1a9f23(0x116),auth,async(_0xe03ada,_0x2a926c)=>{var _0x25a1ce=a0_0x1a9f23;try{const {username:_0xe2829d,email:_0x3d521d,role:_0x17cd33}=_0xe03ada['user'],_0x3454dd=_0xe03ada[_0x25a1ce(0x128)],_0x4ceba0=await profile[_0x25a1ce(0x1a3)]({'email':_0x3454dd['email']}),_0x3646d2=await master_shop['find']();console[_0x25a1ce(0x1cf)](_0x25a1ce(0x13c),_0x3646d2);const _0x16fd0b=_0xe03ada[_0x25a1ce(0xf8)]['id'];console['log'](_0x16fd0b);const _0x48cdd8=await purchases_finished['findById'](_0x16fd0b);console[_0x25a1ce(0x1cf)](_0x25a1ce(0x181),_0x48cdd8);const _0x5bbb02=await product['find']({}),_0x38da63=await warehouse[_0x25a1ce(0x155)]([{'$match':{'name':_0x48cdd8[_0x25a1ce(0x131)],'room':_0x48cdd8[_0x25a1ce(0x179)]}},{'$unwind':_0x25a1ce(0x10c)},{'$group':{'_id':_0x25a1ce(0x14a),'name':{'$first':_0x25a1ce(0x1d4)},'product_stock':{'$first':_0x25a1ce(0x138)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x25a1ce(0xed)},'type':{'$first':_0x25a1ce(0x19e)},'floorlevel':{'$first':_0x25a1ce(0x160)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x25a1ce(0x16b)},'product_code':{'$first':_0x25a1ce(0x12c)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x25a1ce(0x192)}}}]);console[_0x25a1ce(0x1cf)](_0x25a1ce(0xf1),_0x38da63);let _0x48abf6;if(_0x3454dd[_0x25a1ce(0x12a)]=='staff'){const _0x1ff386=await staff[_0x25a1ce(0x1a3)]({'email':_0x3454dd[_0x25a1ce(0x121)]});_0x48abf6=await warehouse[_0x25a1ce(0xf7)]({'status':'Enabled','name':_0x1ff386[_0x25a1ce(0x11b)],'warehouse_category':_0x25a1ce(0x108),'name':_0x25a1ce(0x1ac)});}else _0x48abf6=await warehouse['aggregate']([{'$match':{'status':_0x25a1ce(0x1a2),'warehouse_category':_0x25a1ce(0x108),'name':_0x25a1ce(0x1ac)}},{'$group':{'_id':_0x25a1ce(0x1e0),'name':{'$first':_0x25a1ce(0x1e0)}}}]);if(_0x3646d2[0x0][_0x25a1ce(0x120)]=='English\x20(US)'){var _0x230fb0=users[_0x25a1ce(0x150)];console[_0x25a1ce(0x1cf)](_0x230fb0);}else{if(_0x3646d2[0x0][_0x25a1ce(0x120)]==_0x25a1ce(0x111))var _0x230fb0=users[_0x25a1ce(0x111)];else{if(_0x3646d2[0x0][_0x25a1ce(0x120)]==_0x25a1ce(0x14e))var _0x230fb0=users[_0x25a1ce(0x14e)];else{if(_0x3646d2[0x0][_0x25a1ce(0x120)]==_0x25a1ce(0x195))var _0x230fb0=users[_0x25a1ce(0x195)];else{if(_0x3646d2[0x0][_0x25a1ce(0x120)]==_0x25a1ce(0x175))var _0x230fb0=users['French'];else{if(_0x3646d2[0x0][_0x25a1ce(0x120)]==_0x25a1ce(0x114))var _0x230fb0=users[_0x25a1ce(0xee)];else{if(_0x3646d2[0x0][_0x25a1ce(0x120)]==_0x25a1ce(0x1ad))var _0x230fb0=users['Chinese'];else{if(_0x3646d2[0x0][_0x25a1ce(0x120)]=='Arabic\x20(ae)')var _0x230fb0=users[_0x25a1ce(0x123)];}}}}}}}_0x2a926c['render'](_0x25a1ce(0x1c2),{'success':_0xe03ada[_0x25a1ce(0x17d)](_0x25a1ce(0x14f)),'errors':_0xe03ada[_0x25a1ce(0x17d)](_0x25a1ce(0x1c9)),'role':_0x3454dd,'profile':_0x4ceba0,'user':_0x48cdd8,'stock':_0x38da63,'master_shop':_0x3646d2,'product':_0x5bbb02,'language':_0x230fb0,'warehouse':_0x48abf6});}catch(_0x4ee5b9){console[_0x25a1ce(0x1cf)](_0x4ee5b9);}}),router[a0_0x1a9f23(0x10a)](a0_0x1a9f23(0x116),auth,async(_0x348827,_0x24a986)=>{var _0x4a1301=a0_0x1a9f23;try{const {invoice:_0x4ba277,date:_0x5baa86,warehouse_name:_0x4064ec,Room_name:_0x3abd11,product_name:_0x5cb3db,purchase_quantity:_0x1215c6,stocks:_0x427083,return_qty:_0x471653,note:_0xc67dcc,level:_0x3fb387,isle:_0x408296,pallet:_0x12bc3f,to_warehouse_name:_0x52d499,to_Room_name:_0x414932}=_0x348827['body'],_0x2cdb81=await purchases_finished[_0x4a1301(0x1a3)]({'_id':_0x348827[_0x4a1301(0xf8)]['id']}),_0x794675=await warehouse['findOne']({'name':_0x4064ec,'room':_0x3abd11,'warehouse_category':_0x4a1301(0x108)});if(typeof _0x5cb3db==_0x4a1301(0x15a))var _0x337cd7=[_0x348827[_0x4a1301(0x15c)][_0x4a1301(0x1e4)]],_0x134f0c=[_0x348827[_0x4a1301(0x15c)][_0x4a1301(0x141)]],_0x5c5a96=[_0x348827[_0x4a1301(0x15c)]['stocks']],_0xd089f2=[_0x348827[_0x4a1301(0x15c)]['return_qty']],_0x50e601=[_0x348827[_0x4a1301(0x15c)][_0x4a1301(0x1d6)]],_0x2d6b3a=[_0x348827[_0x4a1301(0x15c)][_0x4a1301(0x190)]],_0x2ba2cc=[_0x348827[_0x4a1301(0x15c)][_0x4a1301(0x1d0)]],_0x5ab449=[_0x348827[_0x4a1301(0x15c)][_0x4a1301(0x134)]];else var _0x337cd7=[..._0x348827[_0x4a1301(0x15c)][_0x4a1301(0x1e4)]],_0x134f0c=[..._0x348827['body'][_0x4a1301(0x141)]],_0x5c5a96=[..._0x348827[_0x4a1301(0x15c)][_0x4a1301(0x1c1)]],_0xd089f2=[..._0x348827['body'][_0x4a1301(0x1de)]],_0x50e601=[..._0x348827['body'][_0x4a1301(0x1d6)]],_0x2d6b3a=[..._0x348827['body'][_0x4a1301(0x190)]],_0x2ba2cc=[..._0x348827['body'][_0x4a1301(0x1d0)]],_0x5ab449=[..._0x348827[_0x4a1301(0x15c)][_0x4a1301(0x134)]];const _0x4ccccc=_0x337cd7[_0x4a1301(0x1b1)](_0x483597=>{return _0x483597={'product_name':_0x483597};});_0x134f0c[_0x4a1301(0x177)]((_0x35ae66,_0x82155e)=>{var _0x1bf95a=_0x4a1301;_0x4ccccc[_0x82155e][_0x1bf95a(0x141)]=_0x35ae66;}),_0x5c5a96['forEach']((_0x4890bd,_0x6d0d27)=>{var _0x334ad5=_0x4a1301;_0x4ccccc[_0x6d0d27][_0x334ad5(0xfc)]=_0x4890bd;}),_0xd089f2[_0x4a1301(0x177)]((_0x5394d4,_0x396363)=>{var _0x5e8c77=_0x4a1301;_0x4ccccc[_0x396363][_0x5e8c77(0x1de)]=_0x5394d4;}),_0x50e601[_0x4a1301(0x177)]((_0x1bb045,_0x56b538)=>{var _0x54c41f=_0x4a1301;_0x4ccccc[_0x56b538][_0x54c41f(0x102)]=_0x1bb045;}),_0x2d6b3a[_0x4a1301(0x177)]((_0x1a5aee,_0x6204a9)=>{var _0x63cfb3=_0x4a1301;_0x4ccccc[_0x6204a9][_0x63cfb3(0x174)]=_0x1a5aee;}),_0x2ba2cc['forEach']((_0x1b525f,_0x1f7721)=>{var _0x503660=_0x4a1301;_0x4ccccc[_0x1f7721][_0x503660(0x1c8)]=_0x1b525f;}),_0x5ab449[_0x4a1301(0x177)]((_0x553ef8,_0x5cbd9c)=>{_0x4ccccc[_0x5cbd9c]['secondary_code']=_0x553ef8;}),_0x4ccccc['forEach'](_0x54a548=>{var _0x49d293=_0x4a1301;console[_0x49d293(0x1cf)](_0x54a548);const _0x2c134f=_0x794675[_0x49d293(0x18c)][_0x49d293(0x1b1)](_0x38a441=>{var _0x581868=_0x49d293;_0x38a441[_0x581868(0x1e4)]==_0x54a548[_0x581868(0x1e4)]&&_0x38a441['bay']==_0x54a548[_0x581868(0x102)]&&(console[_0x581868(0x1cf)](parseInt(_0x38a441[_0x581868(0x1a4)])+'\x20<>\x20'+parseInt(_0x54a548[_0x581868(0x1de)])),_0x38a441['product_stock']=parseInt(_0x38a441[_0x581868(0x1a4)])-parseInt(_0x54a548[_0x581868(0x1de)]));});}),await _0x794675[_0x4a1301(0x1cc)]();var _0x2d28cf=0x0;_0x4ccccc[_0x4a1301(0x177)](_0x2ee7af=>{var _0x5f659a=_0x4a1301;(parseInt(_0x2ee7af['purchase_quantity'])<parseInt(_0x2ee7af[_0x5f659a(0x1de)])||parseInt(_0x2ee7af[_0x5f659a(0xfc)])<parseInt(_0x2ee7af[_0x5f659a(0x1de)]))&&_0x2d28cf++;});if(_0x2d28cf!=0x0)return _0x348827[_0x4a1301(0x17d)](_0x4a1301(0x1c9),_0x4a1301(0x137)),_0x24a986['redirect'](_0x4a1301(0x169));const _0x8fb07a=new purchases_return_finished({'invoice':_0x4ba277,'suppliers':_0x348827[_0x4a1301(0x15c)][_0x4a1301(0x10d)],'date':_0x5baa86,'warehouse_name':_0x4064ec,'return_product':_0x4ccccc,'note':_0xc67dcc,'room':_0x3abd11,'to_warehouse_name':_0x52d499,'to_room':_0x414932}),_0x20231d=await _0x8fb07a[_0x4a1301(0x1cc)](),_0x4a4c1e=await purchases_return_finished['findOne']({'invoice':_0x4ba277}),_0x458ce2=await warehouse[_0x4a1301(0x1a3)]({'name':_0x52d499,'room':_0x414932,'warehouse_category':_0x4a1301(0x108)});_0x4a4c1e[_0x4a1301(0xf9)][_0x4a1301(0x177)](_0x3b3062=>{var _0x16e53b=_0x4a1301,_0x48dce8=0x0;const _0x30af20=_0x458ce2[_0x16e53b(0x18c)]['map'](_0x434982=>{var _0x44900b=_0x16e53b;console[_0x44900b(0x1cf)](_0x434982[_0x44900b(0x1e4)]+'=='+_0x3b3062[_0x44900b(0x1e4)]+'&&'+_0x434982[_0x44900b(0x102)]+'=='+_0x3b3062['bay']),_0x434982[_0x44900b(0x1e4)]==_0x3b3062['product_name']&&_0x434982[_0x44900b(0x102)]==_0x3b3062['bay']&&(_0x434982[_0x44900b(0x1a4)]=parseInt(_0x434982[_0x44900b(0x1a4)])-parseInt(_0x3b3062[_0x44900b(0x1de)]),_0x48dce8++);});_0x48dce8=='0'&&(_0x458ce2[_0x16e53b(0x18c)]=_0x458ce2[_0x16e53b(0x18c)][_0x16e53b(0x1b4)]({'product_name':_0x3b3062[_0x16e53b(0x1e4)],'product_stock':_0x3b3062['return_qty'],'primary_code':_0x3b3062['primary_code'],'secondary_code':_0x3b3062[_0x16e53b(0xfa)],'product_code':_0x3b3062[_0x16e53b(0x174)],'bay':_0x3b3062[_0x16e53b(0x102)],'maxProducts':0xf423f}));}),await _0x458ce2[_0x4a1301(0x1cc)]();const _0x333e17=await purchases_finished[_0x4a1301(0x1a3)]({'invoice':_0x4ba277});_0x333e17[_0x4a1301(0x103)]=_0x4a1301(0x1e3);const _0x5ae9aa=await _0x333e17[_0x4a1301(0x1cc)](),_0x41673d=new s_payment_data({'invoice':_0x4ba277,'suppliers':_0x348827[_0x4a1301(0x15c)][_0x4a1301(0x10d)],'reason':_0x4a1301(0x1d8)});await _0x41673d['save']();const _0x1bb5f9=await master_shop[_0x4a1301(0xf7)](),_0x4b25af=await email_settings['findOne'](),_0x15657e=await suppliers['findOne']({'name':_0x348827[_0x4a1301(0x15c)][_0x4a1301(0x10d)]});_0x1bb5f9[0x0][_0x4a1301(0x1b8)]==0x1?(right_currency=_0x1bb5f9[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1bb5f9[0x0]['currency']);var _0x1441a8=_0x337cd7,_0x38d6fd=_0xd089f2,_0x547935='',_0xb456f5;for(_0xb456f5 in _0x1441a8){_0x547935+='<tr>'+_0x4a1301(0x1d3)+_0x1441a8[_0xb456f5]+_0x4a1301(0x1ca)+_0x4a1301(0x1d3)+_0x38d6fd[_0xb456f5]+_0x4a1301(0x1ca)+'</tr>';}let _0x5ee9c1=nodemailer[_0x4a1301(0x18b)]({'service':'gmail','auth':{'user':_0x4b25af[_0x4a1301(0x121)],'pass':_0x4b25af[_0x4a1301(0x1a6)]}}),_0xb0c3df={'from':_0x4b25af[_0x4a1301(0x121)],'to':_0x15657e[_0x4a1301(0x121)],'subject':_0x4a1301(0xf3),'attachments':[{'filename':_0x4a1301(0x1a0),'path':__dirname+'/../public'+_0x4a1301(0xfd)+_0x1bb5f9[0x0]['image'],'cid':_0x4a1301(0x19c)}],'html':'<!DOCTYPE\x20html>'+_0x4a1301(0x1a7)+'</head><body>'+'<div>'+_0x4a1301(0x194)+_0x4a1301(0x105)+_0x4a1301(0x104)+'</div>'+'<div>'+_0x4a1301(0x132)+_0x1bb5f9[0x0][_0x4a1301(0x11a)]+'\x20</h2>'+_0x4a1301(0x149)+'</div>'+_0x4a1301(0x1db)+_0x4a1301(0x105)+_0x4a1301(0x12d)+_0x4a1301(0x153)+_0x4ba277+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x4a1301(0x191)+_0x5baa86+'\x20'+_0x4a1301(0x171)+_0x4a1301(0xec)+_0x4a1301(0x149)+_0x4a1301(0x1af)+_0x4a1301(0xf6)+_0x4a1301(0x1d1)+_0x4a1301(0x135)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x4a1301(0x187)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x4a1301(0x159)+_0x4a1301(0x1bf)+_0x4a1301(0x157)+'\x20'+_0x547935+'\x20'+_0x4a1301(0x15d)+_0x4a1301(0x17c)+_0x4a1301(0x105)+'<strong>\x20Regards\x20</strong>'+_0x4a1301(0x10b)+_0x1bb5f9[0x0]['site_title']+'</h5>'+_0x4a1301(0x149)+_0x4a1301(0x149)+'</body></html>'};_0x5ee9c1[_0x4a1301(0x189)](_0xb0c3df,function(_0x2720ce,_0x274360){var _0x428d6c=_0x4a1301;_0x2720ce?console[_0x428d6c(0x1cf)](_0x428d6c(0x100)):console['log']('Email\x20sent\x20successfully');}),_0x348827[_0x4a1301(0x17d)](_0x4a1301(0x14f),_0x4a1301(0xea)),_0x24a986[_0x4a1301(0x122)](_0x4a1301(0x14d));}catch(_0x1008af){_0x24a986[_0x4a1301(0xf5)](0xc8)['json']({'message':_0x1008af['message']});}}),router[a0_0x1a9f23(0x1cd)](a0_0x1a9f23(0x197),auth,async(_0x18eb70,_0x10bd09)=>{var _0x2df76e=a0_0x1a9f23;try{const {username:_0x3a306c,email:_0x9ca249,role:_0x45a2a5}=_0x18eb70[_0x2df76e(0x128)],_0x2b8827=_0x18eb70['user'],_0x31ffad=await profile['findOne']({'email':_0x2b8827[_0x2df76e(0x121)]}),_0x519d9f=await master_shop['find'](),_0x14432d=_0x18eb70[_0x2df76e(0xf8)]['id'],_0xbf74fe=await purchases_finished[_0x2df76e(0x13f)](_0x14432d);if(_0x519d9f[0x0][_0x2df76e(0x120)]=='English\x20(US)')var _0x2c0422=users['English'];else{if(_0x519d9f[0x0]['language']==_0x2df76e(0x111))var _0x2c0422=users[_0x2df76e(0x111)];else{if(_0x519d9f[0x0][_0x2df76e(0x120)]==_0x2df76e(0x14e))var _0x2c0422=users[_0x2df76e(0x14e)];else{if(_0x519d9f[0x0][_0x2df76e(0x120)]==_0x2df76e(0x195))var _0x2c0422=users['Spanish'];else{if(_0x519d9f[0x0][_0x2df76e(0x120)]==_0x2df76e(0x175))var _0x2c0422=users[_0x2df76e(0x175)];else{if(_0x519d9f[0x0][_0x2df76e(0x120)]=='Portuguese\x20(BR)')var _0x2c0422=users[_0x2df76e(0xee)];else{if(_0x519d9f[0x0][_0x2df76e(0x120)]==_0x2df76e(0x1ad))var _0x2c0422=users[_0x2df76e(0x1ad)];else{if(_0x519d9f[0x0][_0x2df76e(0x120)]==_0x2df76e(0x10e))var _0x2c0422=users[_0x2df76e(0x123)];}}}}}}}_0x10bd09[_0x2df76e(0x15e)]('all_purchases_barcode',{'success':_0x18eb70[_0x2df76e(0x17d)]('success'),'errors':_0x18eb70[_0x2df76e(0x17d)](_0x2df76e(0x1c9)),'role':_0x2b8827,'profile':_0x31ffad,'alldata':_0xbf74fe,'master_shop':_0x519d9f,'language':_0x2c0422}),console[_0x2df76e(0x1cf)](alldata);}catch(_0x42106a){console[_0x2df76e(0x1cf)](_0x42106a);}}),router[a0_0x1a9f23(0x10a)](a0_0x1a9f23(0x1a8),async(_0x410ad7,_0x158e73)=>{var _0x4e74f9=a0_0x1a9f23;const {product_code:_0x58e5dd}=_0x410ad7[_0x4e74f9(0x15c)];var _0x3648c7;const _0x59878d=await product[_0x4e74f9(0x155)]([{'$match':{'primary_code':_0x58e5dd,'product_category':_0x4e74f9(0x108)}},{'$group':{'_id':_0x4e74f9(0xe6),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x4e74f9(0x16a)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x4e74f9(0x1b0)},'primary_code':{'$first':_0x4e74f9(0x107)},'secondary_code':{'$first':_0x4e74f9(0xe7)},'maxStocks':{'$first':_0x4e74f9(0x139)},'maxProdPerUnit':{'$first':_0x4e74f9(0x147)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4e74f9(0xf4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3bd233=await product[_0x4e74f9(0x155)]([{'$match':{'secondary_code':_0x58e5dd}},{'$group':{'_id':_0x4e74f9(0xe6),'name':{'$first':_0x4e74f9(0x1e0)},'category':{'$first':_0x4e74f9(0x17b)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x4e74f9(0x1b5)},'product_code':{'$first':_0x4e74f9(0x1b0)},'primary_code':{'$first':_0x4e74f9(0x107)},'secondary_code':{'$first':_0x4e74f9(0xe7)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x4e74f9(0x147)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4e74f9(0xf4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x59878d[_0x4e74f9(0x1bb)]>0x0)_0x3648c7=_0x59878d;else _0x3bd233[_0x4e74f9(0x1bb)]>0x0&&(_0x3648c7=_0x3bd233);_0x158e73[_0x4e74f9(0x16d)](_0x3648c7);}),router[a0_0x1a9f23(0x10a)](a0_0x1a9f23(0x12f),async(_0x52d4bf,_0x5de5f0)=>{var _0x561507=a0_0x1a9f23;const {productCode:_0x3905e3,bay:_0x170a29,warehouses:_0x4699da,room:_0x1b2139}=_0x52d4bf[_0x561507(0x15c)];console[_0x561507(0x1cf)](_0x52d4bf[_0x561507(0x15c)]);try{const _0x23a7f1=await warehouse[_0x561507(0x155)]([{'$match':{'name':_0x4699da,'room':_0x1b2139}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x170a29)}},{'$group':{'_id':_0x561507(0x14a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x561507(0x138)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x561507(0x112)}}}]);_0x5de5f0['status'](0xc8)[_0x561507(0x16d)](_0x23a7f1);}catch(_0x91f9a0){_0x5de5f0[_0x561507(0xf5)](0x194)[_0x561507(0x16d)]({'message':_0x91f9a0[_0x561507(0x17f)]});}}),module[a0_0x1a9f23(0x1da)]=router;function a0_0x1f6e(){var _0x1fe66a=['$product_details.rack','Error\x20occurred\x20while\x20processing\x20product:','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Spanish','/view','/barcode/:id','staff','prod_level','7250877XdpJVb','$due_amount','logo','filter','$product_details.type','_id','Logo.png','$warehouse_name','Enabled','findOne','product_stock','room_name','password','<html><head><title></title>','/barcode_scanner','$product.bin','128ThRdvq','purchase\x20data\x20update\x20successfully','Return\x20Goods','Chinese','</head><body>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_code','map','ejs','Rack\x201','concat','$alertquantity','path','all_purchases_finished','currency_placement','suppliers_docs','add_purchases_finished','length','Ambient','<strong>\x20Regards\x20</strong>','expiry_date','</thead>','Router','stocks','return_purchase_finished','table\x20page','Purchase\x20Mail','abs','padStart','1958817oclZEW','primary_code','errors','</td>','/preview/:id','save','get','$batch_code','log','primary_code_hide','<tr>','$paid_amount','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_name','MaxStocks_data','level','../middleware/auth','Purchase\x20Return','getDate','exports','<hr\x20class=\x22my-3\x22>','then','production_date','return_qty','quantity','$name','random','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','True','product_name','$_id','$secondary_code','prod_invoice','purchase_invoice','purchases\x20item\x20return\x20successfull','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</h5>','$product_details.bin','Portuguese','prod_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','stock_data','INCF-','Purchase\x20Return\x20Mail','$secondary_unit','status','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','find','params','return_product','secondary_code','prod_unit','stock_quantity','/upload/','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Error\x20Occurs','edit_purchases_finished_view','bay','return_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<div>','product_cat','$primary_code','Finished\x20Goods','secondary_unit','post','<h5>','$product_details','suppliers','Arabic\x20(ae)','$date','date','Hindi','$product_details.maxProducts','maxperunit','Portuguese\x20(BR)','catch','/view/return_purchase/:id','RoomAssign','$invoice','/give_payment/:id','site_title','warehouse','image','FGSEmail','Rack\x202','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','language','email','redirect','Arabic','1362244bynfAB','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','note','user','error','role','edit_purchases_finished','$product_details.product_code','<h5\x20style=\x22text-align:\x20left;\x22>','/view/add_purchases','/CheckingWarehouse','express','warehouse_name','<h2>\x20','$product.quantity','secondary_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</body></html>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product_details.product_stock','$maxStocks','$return_data','prod_secondunit','master','77JvhPig','$product.bay','findById','paid_amount','purchase_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','DRY\x20GOODS','slice','prod_name','$product','$maxProdPerUnit','Room_name','</div>','$product_details._id','port','POnumber','/all_purchases_finished/view','German','success','English','maxStocks','getMonth','\x20Order\x20Number\x20:\x20','product','aggregate','2534376KIhJRj','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_code','</tr>','string','prod_primunit','body','</tbody>','render','$expiry_date','$product_details.floorlevel','standard_unit','all','4440hgphfj','770984GHOJpC','getFullYear','$product.type','prod_qty','nodemailer','back','$brand','$product_details.secondary_code','/view/add_purchases/:id','json','../models/all_models','$suppliers_docs','Enclosed','</span>','invoice','max_product_unit','product_code','French','due_amount','forEach','Paid\x20For\x20Purchase','room','$suppliers','$category','</table>','flash','An\x20error\x20occurred\x20while\x20saving\x20data.','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','user_id','English\x20(US)','$note','$room','batch_code','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','/../public','sendMail','80868lvoYta','createTransport','product_details','payment\x20successfull','product_date','toString','product_code_hide','\x20Order\x20Date\x20:\x20'];a0_0x1f6e=function(){return _0x1fe66a;};return a0_0x1f6e();}