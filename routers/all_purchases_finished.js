function a0_0x5315(_0x448e6e,_0x4077ff){var _0x1abae3=a0_0x1aba();return a0_0x5315=function(_0x531573,_0x45de9d){_0x531573=_0x531573-0x14a;var _0x411d70=_0x1abae3[_0x531573];return _0x411d70;},a0_0x5315(_0x448e6e,_0x4077ff);}var a0_0x3cd8fe=a0_0x5315;(function(_0x2ce466,_0x50f202){var _0x543f80=a0_0x5315,_0x9c5e03=_0x2ce466();while(!![]){try{var _0x320a5f=-parseInt(_0x543f80(0x20a))/0x1+parseInt(_0x543f80(0x167))/0x2*(parseInt(_0x543f80(0x14c))/0x3)+-parseInt(_0x543f80(0x1fa))/0x4+-parseInt(_0x543f80(0x15e))/0x5*(-parseInt(_0x543f80(0x1dd))/0x6)+parseInt(_0x543f80(0x15d))/0x7+-parseInt(_0x543f80(0x172))/0x8*(-parseInt(_0x543f80(0x175))/0x9)+parseInt(_0x543f80(0x22e))/0xa*(parseInt(_0x543f80(0x17d))/0xb);if(_0x320a5f===_0x50f202)break;else _0x9c5e03['push'](_0x9c5e03['shift']());}catch(_0x22f534){_0x9c5e03['push'](_0x9c5e03['shift']());}}}(a0_0x1aba,0x243dd));const express=require(a0_0x3cd8fe(0x17b)),app=express(),router=express[a0_0x3cd8fe(0x1db)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x3cd8fe(0x249)),auth=require('../middleware/auth'),nodemailer=require(a0_0x3cd8fe(0x20f));var ejs=require('ejs');const path=require(a0_0x3cd8fe(0x1ec)),users=require(a0_0x3cd8fe(0x174));function a0_0x1aba(){var _0x24d51e=['<tr>','return_product','product_details','Arabic\x20(ae)','<html><head><title></title>','prod_primunit','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.type','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','prod_secondunit','production_date','product','purchase\x20data\x20add\x20successfully','German','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<tbody\x20style=\x22text-align:\x20center;\x22>','return_qty','all','English','primary_code_hide','<div>','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','string','prod_name','room_name','Arabic','French','port','FGSEmail','</span>','all_purchases_finished','product_date','log','redirect','<h5>','$paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Error\x20Occurs','$product_details.primary_code','/upload/','<!DOCTYPE\x20html>','invoice','Logo.png','return_purchase_finished','exports','/view/return_purchase/:id','\x20Order\x20Number\x20:\x20','$expiry_date','Router','</tbody>','18wLOCZT','staff','product_name','$suppliers','</head><body>','Portuguese','edit_purchases_finished_view','getFullYear','Spanish','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','INCF-','$brand','$product.floorlevel','suppliers_docs','path','params','suppliers','$batch_code','toString','$category','DRY\x20GOODS','/view','warehouse_name','/barcode_scanner','primary_code','warehouse','status','$product_details.floorlevel','1010300YfpCeh','slice','findById','QA\x20Warehouse','sendMail','user','product_stock','</body></html>','note','filter','back','max_product_unit','$warehouse_name','purchase\x20data\x20update\x20successfully','</table>','$secondary_code','248731mWnTgU','</h5>','$product_details.secondary_code','/give_payment/:id','Rack\x201','nodemailer','map','prod_invoice','expiry_date','return_data','An\x20error\x20occurred\x20while\x20saving\x20data.','getDate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.storage','due_amount','$date','user_id','True','$product.bin','body','error','post','currency_placement','Room_name','product_cat','Portuguese\x20(BR)','add_purchases\x20error','Enclosed','FROZEN\x20GOODS','$name','get','<h2>\x20','Hindi','/view/:id','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Purchase\x20Return','20rMGlTW','stock_quantity','/preview/:id','json','prod_level','language','$product_details._id','/invoice/:id','purchase_quantity','<hr\x20class=\x22my-3\x22>','email','$product_details.product_code','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<span\x20style=\x22float:\x20right;\x22>','$note','stock_data','save','$maxStocks','abs','master','$_id','</tr>','$product_code','host','\x20Order\x20Date\x20:\x20','catch','../models/all_models','Paid\x20For\x20Purchase','Ambient','prod_unit','render','prod_cat','Purchase\x20Return\x20Mail','paid_amount','$product_details','padStart','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','JO_number','\x20</h2>','table\x20page','38973cTWbND','$due_amount','$unit','prod_code','gmail','$product_details.rack','getMonth','site_title','$alertquantity','random','Finished\x20Goods','_id','date_data','batch_code','</thead>','RoomAssign','$room','1430555QZGSeZ','171035gyQsWo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Error\x20occurred\x20while\x20processing\x20product:','\x20<>\x20','all_purchases_barcode','maxperunit','secondary_code_hide','then','message','22GgtCkP','maxStocks','Enabled','find','length','currency','standard_unit','image','/all_purchases_finished/view','$product','$invoice','16TLtOCc','$product.quantity','../public/language/languages.json','300771dXTDXY','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','role','prod_qty','$return_data','express','product_code_hide','731643wExNHa','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Return\x20Goods','flash','name','add_purchases_finished','<h5\x20style=\x22text-align:\x20left;\x22>','Email\x20sent\x20successfully','/view/add_purchases','room','aggregate','stocks','password','payment\x20successfull','$product.type','bay','$product_details.bay','prod_Qty','$product.bay','product_code','/../public','findOne','/barcode/:id','amount','$maxProdPerUnit','$product_details.product_name','createTransport','forEach','Chinese','date','English\x20(US)','quantity','$primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','purchase_invoice','level','edit_purchases_finished','MaxStocks_data','</div>','secondary_unit','purchases\x20item\x20return\x20successfull','<table\x20style=\x22width:\x20100%\x20!important;\x22>','success','$suppliers_docs'];a0_0x1aba=function(){return _0x24d51e;};return a0_0x1aba();}router['get'](a0_0x3cd8fe(0x1f3),auth,async(_0x30be6e,_0x5ac58c)=>{var _0x1e613e=a0_0x3cd8fe;try{const {username:_0x5578f0,email:_0x44aacd,role:_0x297bfb}=_0x30be6e[_0x1e613e(0x1ff)],_0x3147f1=_0x30be6e[_0x1e613e(0x1ff)],_0xfe487e=await profile['findOne']({'email':_0x3147f1[_0x1e613e(0x238)]}),_0x2e197f=await staff['findOne']({'email':_0x3147f1[_0x1e613e(0x238)]});if(_0x3147f1[_0x1e613e(0x178)]==_0x1e613e(0x1de)){const _0x129230=await staff[_0x1e613e(0x192)]({'email':_0x3147f1[_0x1e613e(0x238)]});}const _0x2bc236=await master_shop[_0x1e613e(0x16a)]();let _0x2378ef;if(_0x3147f1[_0x1e613e(0x178)]==_0x1e613e(0x1de)){const _0x20f52f=await staff['findOne']({'email':_0x3147f1[_0x1e613e(0x238)]});_0x2378ef=await purchases_finished[_0x1e613e(0x187)]([{'$match':{'warehouse_name':_0x20f52f[_0x1e613e(0x1f7)]}},{'$lookup':{'from':_0x1e613e(0x1ee),'localField':_0x1e613e(0x1ee),'foreignField':_0x1e613e(0x181),'as':_0x1e613e(0x1eb)}},{'$unwind':_0x1e613e(0x1a8)},{'$unwind':_0x1e613e(0x170)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1e613e(0x171)},'suppliers':{'$first':_0x1e613e(0x1e0)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1e613e(0x206)},'room':{'$first':_0x1e613e(0x15c)},'product':{'$push':_0x1e613e(0x170)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x1e613e(0x1ce)},'due_amount':{'$first':_0x1e613e(0x14d)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x1e613e(0x1ef)},'expiry_date':{'$first':_0x1e613e(0x1da)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x1e613e(0x173)},'level':{'$addToSet':_0x1e613e(0x18f)},'isle':{'$addToSet':_0x1e613e(0x21c)},'type':{'$addToSet':_0x1e613e(0x18b)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2378ef=await purchases_finished[_0x1e613e(0x187)]([{'$unwind':_0x1e613e(0x170)},{'$group':{'_id':_0x1e613e(0x243),'invoice':{'$first':_0x1e613e(0x171)},'suppliers':{'$first':_0x1e613e(0x1e0)},'date':{'$first':_0x1e613e(0x219)},'warehouse_name':{'$first':_0x1e613e(0x206)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x1e613e(0x170)},'note':{'$first':_0x1e613e(0x23d)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x1e613e(0x14d)},'return_data':{'$first':_0x1e613e(0x17a)},'batch_code':{'$first':_0x1e613e(0x1ef)},'expiry_date':{'$first':_0x1e613e(0x1da)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x1e613e(0x173)},'level':{'$addToSet':_0x1e613e(0x18f)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x1e613e(0x18b)},'floorlevel':{'$addToSet':_0x1e613e(0x1ea)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x2bc236[0x0][_0x1e613e(0x233)]==_0x1e613e(0x19b))var _0x37c7a4=users['English'];else{if(_0x2bc236[0x0][_0x1e613e(0x233)]==_0x1e613e(0x22a))var _0x37c7a4=users['Hindi'];else{if(_0x2bc236[0x0][_0x1e613e(0x233)]=='German')var _0x37c7a4=users[_0x1e613e(0x1b7)];else{if(_0x2bc236[0x0][_0x1e613e(0x233)]==_0x1e613e(0x1e5))var _0x37c7a4=users[_0x1e613e(0x1e5)];else{if(_0x2bc236[0x0]['language']=='French')var _0x37c7a4=users[_0x1e613e(0x1c5)];else{if(_0x2bc236[0x0][_0x1e613e(0x233)]==_0x1e613e(0x223))var _0x37c7a4=users[_0x1e613e(0x1e2)];else{if(_0x2bc236[0x0][_0x1e613e(0x233)]=='Chinese')var _0x37c7a4=users[_0x1e613e(0x199)];else{if(_0x2bc236[0x0][_0x1e613e(0x233)]=='Arabic\x20(ae)')var _0x37c7a4=users[_0x1e613e(0x1c4)];}}}}}}}_0x5ac58c[_0x1e613e(0x24d)](_0x1e613e(0x1c9),{'success':_0x30be6e[_0x1e613e(0x180)](_0x1e613e(0x1a7)),'errors':_0x30be6e[_0x1e613e(0x180)]('errors'),'purchases':_0x2378ef,'role':_0x3147f1,'profile':_0xfe487e,'master_shop':_0x2bc236,'language':_0x37c7a4});}catch(_0x1da3ce){console[_0x1e613e(0x1cb)](_0x1e613e(0x14b),_0x1da3ce),_0x5ac58c[_0x1e613e(0x1f8)](0xc8)['json']({'message':_0x1da3ce['message']});}});function BayBinSelected(_0x3e4ea8,_0x303a94){var _0x398165=a0_0x3cd8fe,_0x172e5b=[],_0x354ddb=[];if(_0x3e4ea8=='DRY\x20GOODS'){switch(_0x303a94){case'Rack\x201':_0x172e5b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x172e5b=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x354ddb=['DG'];}else{if(_0x3e4ea8==_0x398165(0x226)){switch(_0x303a94){case _0x398165(0x20e):_0x172e5b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x172e5b=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x354ddb=['FG'];}}return{'levels':_0x172e5b,'identify':_0x354ddb};}async function getRandom8DigitNumber(){var _0x54610e=a0_0x3cd8fe;const _0x32191a=0x989680,_0x1403f3=0x5f5e0ff,_0x122c01=Math['floor'](Math[_0x54610e(0x155)]()*(_0x1403f3-_0x32191a+0x1))+_0x32191a;var _0x1ffc19;const _0x11712f=await purchases_finished['findOne']({'invoice':'INCF-'+_0x122c01});return _0x11712f&&_0x11712f[_0x54610e(0x16b)]>0x0?_0x1ffc19=_0x54610e(0x1e8)+_0x122c01:_0x1ffc19=_0x54610e(0x1e8)+_0x122c01,_0x1ffc19;}router[a0_0x3cd8fe(0x228)](a0_0x3cd8fe(0x185),auth,async(_0x2ab260,_0x47b61f)=>{var _0x2e2c38=a0_0x3cd8fe;try{const {username:_0x2d65a9,email:_0x1e9b5b,role:_0x534bd}=_0x2ab260[_0x2e2c38(0x1ff)],_0x106f31=_0x2ab260[_0x2e2c38(0x1ff)],_0x48e625=await profile['findOne']({'email':_0x106f31[_0x2e2c38(0x238)]}),_0x4ac823=await master_shop[_0x2e2c38(0x16a)](),_0x46c49b=await staff['findOne']({'email':_0x106f31[_0x2e2c38(0x238)]}),_0x4346af=await suppliers[_0x2e2c38(0x16a)]({});let _0x19010a;if(_0x106f31[_0x2e2c38(0x178)]==_0x2e2c38(0x1de)){const _0x14deb5=await staff[_0x2e2c38(0x192)]({'email':_0x106f31['email']});_0x19010a=await warehouse['aggregate']([{'$match':{'status':_0x2e2c38(0x169),'name':_0x14deb5[_0x2e2c38(0x1f7)],'warehouse_category':_0x2e2c38(0x156)}},{'$group':{'_id':'$name','name':{'$first':_0x2e2c38(0x227)}}}]);}else _0x19010a=await warehouse[_0x2e2c38(0x187)]([{'$match':{'status':_0x2e2c38(0x169),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x2e2c38(0x1fd)}}},{'$group':{'_id':_0x2e2c38(0x227),'name':{'$first':'$name'}}}]);const _0x4694fb=await product[_0x2e2c38(0x16a)]({}),_0xee9f85=await warehouse[_0x2e2c38(0x16a)]({'status':_0x2e2c38(0x169)}),_0x5d952e=await purchases_finished[_0x2e2c38(0x16a)]({}),_0x2ec251=_0x5d952e['length']+0x1,_0x59aafb=_0x2e2c38(0x1e8)+_0x2ec251[_0x2e2c38(0x1f0)]()[_0x2e2c38(0x252)](0x5,'0');var _0x3878dc=[_0x2e2c38(0x24b),_0x2e2c38(0x225)];if(_0x4ac823[0x0]['language']==_0x2e2c38(0x19b))var _0x1d10f8=users['English'];else{if(_0x4ac823[0x0]['language']==_0x2e2c38(0x22a))var _0x1d10f8=users[_0x2e2c38(0x22a)];else{if(_0x4ac823[0x0][_0x2e2c38(0x233)]==_0x2e2c38(0x1b7))var _0x1d10f8=users[_0x2e2c38(0x1b7)];else{if(_0x4ac823[0x0][_0x2e2c38(0x233)]==_0x2e2c38(0x1e5))var _0x1d10f8=users[_0x2e2c38(0x1e5)];else{if(_0x4ac823[0x0][_0x2e2c38(0x233)]=='French')var _0x1d10f8=users[_0x2e2c38(0x1c5)];else{if(_0x4ac823[0x0][_0x2e2c38(0x233)]==_0x2e2c38(0x223))var _0x1d10f8=users[_0x2e2c38(0x1e2)];else{if(_0x4ac823[0x0]['language']=='Chinese')var _0x1d10f8=users[_0x2e2c38(0x199)];else{if(_0x4ac823[0x0][_0x2e2c38(0x233)]==_0x2e2c38(0x1ac))var _0x1d10f8=users[_0x2e2c38(0x1c4)];}}}}}}}const _0x4921ec=getRandom8DigitNumber();_0x4921ec[_0x2e2c38(0x165)](_0x561d44=>{var _0x41e862=_0x2e2c38;_0x47b61f[_0x41e862(0x24d)](_0x41e862(0x182),{'success':_0x2ab260[_0x41e862(0x180)](_0x41e862(0x1a7)),'errors':_0x2ab260['flash'](_0x41e862(0x1bf)),'role':_0x106f31,'profile':_0x48e625,'suppliers':_0x4346af,'warehouse':_0x19010a,'product':_0x4694fb,'invoice':_0x561d44,'master_shop':_0x4ac823,'language':_0x1d10f8,'find_data':_0xee9f85,'rooms_data':_0x3878dc});})[_0x2e2c38(0x248)](_0x58651c=>{var _0x3e6d2f=_0x2e2c38;_0x2ab260[_0x3e6d2f(0x180)](_0x3e6d2f(0x1bf),_0x3e6d2f(0x17e)),_0x47b61f[_0x3e6d2f(0x1cc)](_0x3e6d2f(0x16f));});}catch(_0x434378){console[_0x2e2c38(0x1cb)](_0x434378);}}),router['get']('/view/add_purchases/:id',auth,async(_0x40a03d,_0x57963a)=>{var _0x5a7816=a0_0x3cd8fe;try{const _0x1b1caa=_0x40a03d[_0x5a7816(0x1ed)]['id'];console[_0x5a7816(0x1cb)](_0x1b1caa);const _0x430bac=await master_shop[_0x5a7816(0x16a)]();console[_0x5a7816(0x1cb)](_0x5a7816(0x242),_0x430bac);const _0x1d9f7a=await product[_0x5a7816(0x192)]({'name':_0x1b1caa});console[_0x5a7816(0x1cb)](_0x5a7816(0x1b5),_0x1d9f7a),_0x57963a[_0x5a7816(0x1f8)](0xc8)[_0x5a7816(0x231)]({'product_data':_0x1d9f7a,'master':_0x430bac});}catch(_0x2950a3){console[_0x5a7816(0x1cb)](_0x5a7816(0x224),_0x2950a3);}}),router[a0_0x3cd8fe(0x21f)](a0_0x3cd8fe(0x185),auth,async(_0x1cf8c5,_0x23bcad)=>{var _0x335fb5=a0_0x3cd8fe;try{const {invoice:_0xe0212e,date:_0x1069e4,warehouse_name:_0x2c6438,prod_name:_0x565f5d,prod_code:_0x5496bc,prod_qty:_0x45fbd5,prod_unit:_0x4b57b8,prod_secondunit:_0x28ce09,prod_level:_0x213a70,prod_isle:_0x2d9d75,prod_pallet:_0x107721,note:_0x201bf5,expiry_date:_0x43d952,batch_code:_0x54ac4a,payable:_0x9dd3ad,due_amount:_0x51fb58,Room_name:_0x3760ac,primary_code:_0x26cc7b,secondary_code:_0x288d0e,MaxStocks_data:_0x4c6623,PO_number:_0x2afa22,SCRN:_0x22d46a,JO_number:_0x41d9b9}=_0x1cf8c5['body'];if(typeof _0x565f5d=='string')var _0x5f1c71=[_0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x1c2)]],_0x50f67b=[_0x1cf8c5['body']['prod_code']],_0x2a41b3=[_0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x18e)]],_0x4a9d99=[_0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x1ae)]],_0x3ebf3f=[_0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x1b3)]],_0x55eabf=[_0x1cf8c5['body'][_0x335fb5(0x232)]],_0x247264=[_0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x1f6)]],_0x3041d0=[_0x1cf8c5[_0x335fb5(0x21d)]['secondary_code']],_0x49688e=[_0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x1a2)]],_0x3e26c3=[_0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x159)]],_0x42f485=[_0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x212)]],_0xbf177c=[_0x1cf8c5['body'][_0x335fb5(0x1ca)]],_0xbb9222=[_0x1cf8c5['body'][_0x335fb5(0x205)]],_0x2cc268=[_0x1cf8c5['body'][_0x335fb5(0x24e)]],_0x35a0d3=[_0x1cf8c5['body'][_0x335fb5(0x15b)]],_0x3cff06=[_0x1cf8c5['body'][_0x335fb5(0x211)]];else var _0x5f1c71=[..._0x1cf8c5['body'][_0x335fb5(0x1c2)]],_0x50f67b=[..._0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x14f)]],_0x2a41b3=[..._0x1cf8c5['body']['prod_Qty']],_0x4a9d99=[..._0x1cf8c5[_0x335fb5(0x21d)]['prod_primunit']],_0x3ebf3f=[..._0x1cf8c5[_0x335fb5(0x21d)]['prod_secondunit']],_0x55eabf=[..._0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x232)]],_0x247264=[..._0x1cf8c5[_0x335fb5(0x21d)]['primary_code']],_0x3041d0=[..._0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x1af)]],_0x49688e=[..._0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x1a2)]],_0x3e26c3=[..._0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x159)]],_0x42f485=[..._0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x212)]],_0xbf177c=[..._0x1cf8c5[_0x335fb5(0x21d)]['product_date']],_0xbb9222=[..._0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x205)]],_0x2cc268=[..._0x1cf8c5['body'][_0x335fb5(0x24e)]],_0x35a0d3=[..._0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x15b)]],_0x3cff06=[..._0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x211)]];const _0x37c86e=_0x5f1c71['map'](_0x5c88a8=>{return _0x5c88a8={'product_name':_0x5c88a8};});_0x50f67b[_0x335fb5(0x198)]((_0x12f1f2,_0x5e2a5f)=>{var _0x4b050c=_0x335fb5;_0x37c86e[_0x5e2a5f][_0x4b050c(0x190)]=_0x12f1f2,_0x37c86e[_0x5e2a5f][_0x4b050c(0x158)]=_0x1069e4;}),_0x2a41b3[_0x335fb5(0x198)]((_0x433fd7,_0x1472ba)=>{var _0x3bb58a=_0x335fb5;_0x37c86e[_0x1472ba][_0x3bb58a(0x19c)]=Math['abs'](_0x433fd7);}),_0x4a9d99[_0x335fb5(0x198)]((_0x2e44da,_0x593826)=>{var _0x1ffd24=_0x335fb5;_0x37c86e[_0x593826][_0x1ffd24(0x16d)]=_0x2e44da;}),_0x3ebf3f[_0x335fb5(0x198)]((_0x1cd4c9,_0x38b26d)=>{var _0x353ba2=_0x335fb5;_0x37c86e[_0x38b26d][_0x353ba2(0x1a4)]=_0x1cd4c9;}),_0x55eabf[_0x335fb5(0x198)]((_0x346dbe,_0x4dab2e)=>{_0x37c86e[_0x4dab2e]['bay']=_0x346dbe;}),_0x247264['forEach']((_0x2f1d04,_0xe5922f)=>{_0x37c86e[_0xe5922f]['primary_code']=_0x2f1d04;}),_0x3041d0[_0x335fb5(0x198)]((_0x592e37,_0x119517)=>{var _0x286cc8=_0x335fb5;_0x37c86e[_0x119517][_0x286cc8(0x1af)]=_0x592e37;}),_0x49688e[_0x335fb5(0x198)]((_0x2c986f,_0x43ea1e)=>{var _0x5ca502=_0x335fb5;_0x37c86e[_0x43ea1e][_0x5ca502(0x168)]=_0x2c986f;}),_0x3e26c3['forEach']((_0x14f00e,_0x3d573d)=>{var _0x2ddc98=_0x335fb5;_0x37c86e[_0x3d573d][_0x2ddc98(0x159)]=_0x14f00e;}),_0x42f485[_0x335fb5(0x198)]((_0x1dea9a,_0x3d71f5)=>{_0x37c86e[_0x3d71f5]['expiry_date']=_0x1dea9a;}),_0xbf177c[_0x335fb5(0x198)]((_0x5c8d30,_0x42bd9a)=>{var _0x4ab690=_0x335fb5;_0x37c86e[_0x42bd9a][_0x4ab690(0x1b4)]=_0x5c8d30;}),_0xbb9222[_0x335fb5(0x198)]((_0xa4e81,_0x22fbf9)=>{var _0x2d3da5=_0x335fb5;_0x37c86e[_0x22fbf9][_0x2d3da5(0x163)]=_0xa4e81;}),_0x2cc268[_0x335fb5(0x198)]((_0x32cd6f,_0xf14ce4)=>{var _0x4fe608=_0x335fb5;_0x37c86e[_0xf14ce4][_0x4fe608(0x222)]=_0x32cd6f;}),_0x35a0d3[_0x335fb5(0x198)]((_0x3fd7a5,_0x434ae2)=>{var _0x5acb44=_0x335fb5;_0x37c86e[_0x434ae2][_0x5acb44(0x1c3)]=_0x3fd7a5;}),_0x3cff06['forEach']((_0xd951e2,_0x5e5b46)=>{var _0x5d3015=_0x335fb5;_0x37c86e[_0x5e5b46][_0x5d3015(0x1d4)]=_0xd951e2;});const _0x3b34ec=_0x37c86e[_0x335fb5(0x203)](_0x753dd4=>_0x753dd4[_0x335fb5(0x19c)]!=='0'&&_0x753dd4['quantity']!==''),_0xe12305=new purchases_finished({'invoice':_0xe0212e,'suppliers':_0x1cf8c5[_0x335fb5(0x21d)][_0x335fb5(0x1ee)],'date':_0x1069e4,'warehouse_name':_0x2c6438,'product':_0x3b34ec,'note':_0x201bf5,'due_amount':_0x51fb58,'room':_0x3760ac,'POnumber':_0x2afa22,'SCRN':_0x22d46a,'JO_number':_0x41d9b9}),_0x3b9dac=await _0xe12305[_0x335fb5(0x23f)](),_0x331b50=await purchases_finished[_0x335fb5(0x192)]({'invoice':_0xe0212e}),_0x5dba47=_0x331b50[_0x335fb5(0x1b5)]['map'](async _0x5f4f77=>{var _0x4da624=_0x335fb5;try{var _0x3e98e2=await warehouse[_0x4da624(0x192)]({'name':_0x2c6438,'room':_0x5f4f77[_0x4da624(0x1c3)]}),_0x4eda4f=0x0;const _0x2d7846=_0x3e98e2[_0x4da624(0x1ab)][_0x4da624(0x210)](_0x56965a=>{var _0xc60737=_0x4da624;console[_0xc60737(0x1cb)](_0x56965a[_0xc60737(0x1df)]+'=='+_0x5f4f77[_0xc60737(0x1df)]+'&&'+_0x56965a[_0xc60737(0x18c)]+'=='+_0x5f4f77['bay']+'&&'+_0x56965a[_0xc60737(0x212)]+'=='+_0x5f4f77[_0xc60737(0x212)]+'&&'+_0x56965a['production_date']+'=='+_0x5f4f77[_0xc60737(0x1b4)]+'&&'+_0x56965a['batch_code']+'=='+_0x5f4f77[_0xc60737(0x159)]+'&&'+_0x56965a[_0xc60737(0x1d4)]+'=='+_0x331b50[_0xc60737(0x1d4)]),_0x56965a['product_name']==_0x5f4f77[_0xc60737(0x1df)]&&_0x56965a[_0xc60737(0x18c)]==_0x5f4f77['bay']&&_0x56965a[_0xc60737(0x212)]==_0x5f4f77[_0xc60737(0x212)]&&_0x56965a['production_date']==_0x5f4f77[_0xc60737(0x1b4)]&&_0x56965a[_0xc60737(0x159)]==_0x5f4f77['batch_code']&&_0x56965a['invoice']==_0x331b50['invoice']&&(_0x56965a['product_stock']=Math[_0xc60737(0x241)](_0x56965a[_0xc60737(0x200)])+Math[_0xc60737(0x241)](_0x5f4f77[_0xc60737(0x19c)]),_0x4eda4f++);});return _0x4eda4f==0x0&&(_0x3e98e2[_0x4da624(0x1ab)]=_0x3e98e2['product_details'][_0x4da624(0x23a)]({'product_name':_0x5f4f77['product_name'],'product_stock':Math['abs'](_0x5f4f77[_0x4da624(0x19c)]),'primary_code':_0x5f4f77[_0x4da624(0x1f6)],'secondary_code':_0x5f4f77[_0x4da624(0x1af)],'product_code':_0x5f4f77[_0x4da624(0x190)],'bay':_0x5f4f77[_0x4da624(0x18c)],'maxProducts':_0x5f4f77[_0x4da624(0x168)],'unit':_0x5f4f77[_0x4da624(0x16d)],'secondary_unit':_0x5f4f77[_0x4da624(0x1a4)],'expiry_date':_0x5f4f77['expiry_date'],'production_date':_0x5f4f77[_0x4da624(0x1b4)],'maxProducts':_0x5f4f77[_0x4da624(0x168)],'maxPerUnit':_0x5f4f77[_0x4da624(0x163)],'batch_code':_0x5f4f77[_0x4da624(0x159)],'product_cat':_0x5f4f77['product_cat'],'invoice':_0x5f4f77[_0x4da624(0x1d4)],'id_incoming':_0x5f4f77[_0x4da624(0x157)],'date_data':_0x5f4f77[_0x4da624(0x158)]})),_0x3e98e2;}catch(_0x989a8){return console['error'](_0x4da624(0x160),_0x989a8),null;}});Promise[_0x335fb5(0x1bb)](_0x5dba47)[_0x335fb5(0x165)](async _0x13efb4=>{var _0x2e1ff8=_0x335fb5;try{for(const _0x101c3a of _0x13efb4){await warehouse['updateOne']({'_id':_0x101c3a['_id']},{'$addToSet':{'product_details':{'$each':_0x101c3a[_0x2e1ff8(0x1ab)]}}});}const _0x4e04c5=await master_shop[_0x2e1ff8(0x16a)](),_0x2e4d2a=await email_settings[_0x2e1ff8(0x192)](),_0x2c9c5a=await supervisor_settings['find']();var _0x5ca97a=_0x331b50['product'],_0x482a89='',_0x1c4a61;for(_0x1c4a61 in _0x5ca97a){var _0x5a4440='FG';_0x331b50[_0x2e1ff8(0x1f4)]==_0x2e1ff8(0x1f2)&&(_0x5a4440='DG'),_0x482a89+='<tr>'+_0x2e1ff8(0x22c)+_0x5ca97a[_0x1c4a61]['product_name']+_0x2e1ff8(0x1e6)+_0x2e1ff8(0x22c)+_0x5ca97a[_0x1c4a61][_0x2e1ff8(0x190)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5ca97a[_0x1c4a61][_0x2e1ff8(0x19c)]+'</td>'+_0x2e1ff8(0x22c)+_0x5ca97a[_0x1c4a61][_0x2e1ff8(0x16d)]+_0x2e1ff8(0x1e6)+_0x2e1ff8(0x22c)+_0x5ca97a[_0x1c4a61][_0x2e1ff8(0x1a4)]+_0x2e1ff8(0x1e6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x331b50[_0x2e1ff8(0x1f4)]+_0x2e1ff8(0x1e6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5ca97a[_0x1c4a61]['room_name']+_0x2e1ff8(0x1e6)+_0x2e1ff8(0x22c)+_0x5a4440+_0x5ca97a[_0x1c4a61][_0x2e1ff8(0x18c)]+'</td>',_0x2e1ff8(0x244);}let _0x178578=nodemailer[_0x2e1ff8(0x197)]({'host':_0x2e4d2a[_0x2e1ff8(0x246)],'port':Number(_0x2e4d2a[_0x2e1ff8(0x1c6)]),'secure':![],'auth':{'user':_0x2e4d2a[_0x2e1ff8(0x238)],'pass':_0x2e4d2a[_0x2e1ff8(0x189)]}}),_0x44e98d={'from':_0x2e4d2a['email'],'to':_0x2c9c5a[0x0][_0x2e1ff8(0x1c7)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x2e1ff8(0x1d5),'path':__dirname+_0x2e1ff8(0x191)+'/upload/'+_0x4e04c5[0x0][_0x2e1ff8(0x16e)],'cid':'logo'}],'html':_0x2e1ff8(0x1d3)+'<html><head><title></title>'+_0x2e1ff8(0x1e1)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2e1ff8(0x1a3)+_0x2e1ff8(0x1be)+_0x2e1ff8(0x229)+_0x4e04c5[0x0][_0x2e1ff8(0x153)]+_0x2e1ff8(0x14a)+_0x2e1ff8(0x1a3)+'</div>'+_0x2e1ff8(0x237)+_0x2e1ff8(0x1be)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2e1ff8(0x1d9)+_0x331b50[_0x2e1ff8(0x1d4)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2e1ff8(0x247)+_0x331b50[_0x2e1ff8(0x19a)]+'\x20'+'</span>'+'</h5>'+_0x2e1ff8(0x1a3)+_0x2e1ff8(0x1a6)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2e1ff8(0x1a9)+_0x2e1ff8(0x1b0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x2e1ff8(0x1e7)+_0x2e1ff8(0x216)+_0x2e1ff8(0x23b)+_0x2e1ff8(0x1c0)+_0x2e1ff8(0x15f)+_0x2e1ff8(0x253)+_0x2e1ff8(0x244)+_0x2e1ff8(0x15a)+_0x2e1ff8(0x1b9)+'\x20'+_0x482a89+'\x20'+_0x2e1ff8(0x1dc)+'</table>'+_0x2e1ff8(0x1be)+'<strong>\x20Regards\x20</strong>'+_0x2e1ff8(0x1cd)+_0x4e04c5[0x0][_0x2e1ff8(0x153)]+_0x2e1ff8(0x20b)+'</div>'+_0x2e1ff8(0x1a3)+_0x2e1ff8(0x201)};_0x178578[_0x2e1ff8(0x1fe)](_0x44e98d,function(_0x2290bf,_0x4e4a3d){var _0x4fa885=_0x2e1ff8;_0x2290bf?(console[_0x4fa885(0x1cb)](_0x2290bf),console[_0x4fa885(0x1cb)](_0x4fa885(0x1d0))):console[_0x4fa885(0x1cb)](_0x4fa885(0x184));});}catch(_0x2a27de){console[_0x2e1ff8(0x21e)](_0x2a27de),_0x23bcad[_0x2e1ff8(0x1f8)](0x1f4)[_0x2e1ff8(0x231)]({'error':_0x2e1ff8(0x214),'message':_0x2a27de[_0x2e1ff8(0x166)]});}})['catch'](_0x12574f=>{var _0x22bba6=_0x335fb5;console[_0x22bba6(0x21e)](_0x12574f);}),_0x1cf8c5[_0x335fb5(0x180)](_0x335fb5(0x1a7),_0x335fb5(0x1b6)),_0x23bcad[_0x335fb5(0x1cc)](_0x335fb5(0x16f));}catch(_0x35a4ae){console[_0x335fb5(0x1cb)](_0x35a4ae);}}),router[a0_0x3cd8fe(0x228)](a0_0x3cd8fe(0x230),auth,async(_0x16244f,_0xdd0f3c)=>{var _0x583aa2=a0_0x3cd8fe;try{const {username:_0x593b24,email:_0x214e3f,role:_0x5874a3}=_0x16244f[_0x583aa2(0x1ff)],_0x54d1e9=_0x16244f[_0x583aa2(0x1ff)],_0x205bfa=await profile[_0x583aa2(0x192)]({'email':_0x54d1e9[_0x583aa2(0x238)]}),_0x5e181b=await master_shop[_0x583aa2(0x16a)](),_0x25e94e=_0x16244f[_0x583aa2(0x1ed)]['id'],_0x4dd7de=await purchases_finished[_0x583aa2(0x1fc)](_0x25e94e),_0x3479b3=await suppliers[_0x583aa2(0x16a)]({});let _0x14cc66;if(_0x54d1e9[_0x583aa2(0x178)]==_0x583aa2(0x1de)){const _0xd1ea7b=await staff[_0x583aa2(0x192)]({'email':_0x54d1e9[_0x583aa2(0x238)]});_0x14cc66=await warehouse[_0x583aa2(0x16a)]({'status':_0x583aa2(0x169),'name':_0xd1ea7b[_0x583aa2(0x1f7)],'warehouse_category':_0x583aa2(0x156)});}else _0x14cc66=await warehouse[_0x583aa2(0x187)]([{'$match':{'status':_0x583aa2(0x169),'warehouse_category':_0x583aa2(0x156)}},{'$group':{'_id':_0x583aa2(0x227),'name':{'$first':'$name'}}}]);const _0x128488=await product[_0x583aa2(0x16a)]({}),_0x25eeca=BayBinSelected(_0x4dd7de['warehouse_name'],_0x4dd7de[_0x583aa2(0x186)]);let _0x51e3fa=new Date(_0x4dd7de[_0x583aa2(0x212)]),_0x351854=('0'+_0x51e3fa[_0x583aa2(0x215)]())[_0x583aa2(0x1fb)](-0x2),_0x14ed00=('0'+(_0x51e3fa['getMonth']()+0x1))[_0x583aa2(0x1fb)](-0x2),_0x2716b7=_0x51e3fa[_0x583aa2(0x1e4)](),_0x115f94=_0x2716b7+'-'+_0x14ed00+'-'+_0x351854;if(_0x5e181b[0x0][_0x583aa2(0x233)]==_0x583aa2(0x19b)){var _0x478812=users['English'];console[_0x583aa2(0x1cb)](_0x478812);}else{if(_0x5e181b[0x0][_0x583aa2(0x233)]=='Hindi')var _0x478812=users[_0x583aa2(0x22a)];else{if(_0x5e181b[0x0][_0x583aa2(0x233)]==_0x583aa2(0x1b7))var _0x478812=users[_0x583aa2(0x1b7)];else{if(_0x5e181b[0x0][_0x583aa2(0x233)]=='Spanish')var _0x478812=users[_0x583aa2(0x1e5)];else{if(_0x5e181b[0x0][_0x583aa2(0x233)]==_0x583aa2(0x1c5))var _0x478812=users['French'];else{if(_0x5e181b[0x0]['language']=='Portuguese\x20(BR)')var _0x478812=users[_0x583aa2(0x1e2)];else{if(_0x5e181b[0x0][_0x583aa2(0x233)]=='Chinese')var _0x478812=users['Chinese'];else{if(_0x5e181b[0x0][_0x583aa2(0x233)]==_0x583aa2(0x1ac))var _0x478812=users[_0x583aa2(0x1c4)];}}}}}}}_0xdd0f3c[_0x583aa2(0x24d)](_0x583aa2(0x1e3),{'success':_0x16244f['flash']('success'),'errors':_0x16244f[_0x583aa2(0x180)](_0x583aa2(0x1bf)),'role':_0x54d1e9,'profile':_0x205bfa,'purchases':_0x4dd7de,'suppliers':_0x3479b3,'warehouse':_0x14cc66,'product':_0x128488,'master_shop':_0x5e181b,'language':_0x478812,'ed_fullDate':_0x115f94,'dataSelected':_0x25eeca});}catch(_0x4121ac){console[_0x583aa2(0x1cb)](_0x4121ac);}}),router['get']('/view/:id',auth,async(_0x30b655,_0x10fc20)=>{var _0x334763=a0_0x3cd8fe;try{const {username:_0x3ca31e,email:_0x1ab081,role:_0x5d50bb}=_0x30b655[_0x334763(0x1ff)],_0xa53b76=_0x30b655[_0x334763(0x1ff)],_0x37b401=await profile['findOne']({'email':_0xa53b76[_0x334763(0x238)]}),_0x327d69=await master_shop[_0x334763(0x16a)](),_0x323c62=_0x30b655[_0x334763(0x1ed)]['id'],_0x579b64=await purchases_finished['findById'](_0x323c62),_0x23a1be=await suppliers[_0x334763(0x16a)]({});let _0x5843b1;if(_0xa53b76[_0x334763(0x178)]==_0x334763(0x1de)){const _0x272ae4=await staff[_0x334763(0x192)]({'email':_0xa53b76[_0x334763(0x238)]});_0x5843b1=await warehouse[_0x334763(0x16a)]({'status':_0x334763(0x169),'name':_0x272ae4['warehouse'],'warehouse_category':_0x334763(0x156)});}else _0x5843b1=await warehouse[_0x334763(0x187)]([{'$match':{'status':_0x334763(0x169),'warehouse_category':_0x334763(0x156)}},{'$group':{'_id':_0x334763(0x227),'name':{'$first':_0x334763(0x227)}}}]);const _0x1c8081=await product[_0x334763(0x16a)]({}),_0x30cdbe=BayBinSelected(_0x579b64[_0x334763(0x1f4)],_0x579b64[_0x334763(0x186)]);let _0x400635=new Date(_0x579b64[_0x334763(0x212)]),_0x3363ac=('0'+_0x400635[_0x334763(0x215)]())[_0x334763(0x1fb)](-0x2),_0x378f45=('0'+(_0x400635[_0x334763(0x152)]()+0x1))[_0x334763(0x1fb)](-0x2),_0x26a034=_0x400635[_0x334763(0x1e4)](),_0x1245bd=_0x26a034+'-'+_0x378f45+'-'+_0x3363ac;if(_0x327d69[0x0][_0x334763(0x233)]==_0x334763(0x19b)){var _0x422abb=users[_0x334763(0x1bc)];console['log'](_0x422abb);}else{if(_0x327d69[0x0][_0x334763(0x233)]=='Hindi')var _0x422abb=users[_0x334763(0x22a)];else{if(_0x327d69[0x0]['language']=='German')var _0x422abb=users[_0x334763(0x1b7)];else{if(_0x327d69[0x0][_0x334763(0x233)]==_0x334763(0x1e5))var _0x422abb=users[_0x334763(0x1e5)];else{if(_0x327d69[0x0][_0x334763(0x233)]==_0x334763(0x1c5))var _0x422abb=users['French'];else{if(_0x327d69[0x0][_0x334763(0x233)]==_0x334763(0x223))var _0x422abb=users[_0x334763(0x1e2)];else{if(_0x327d69[0x0][_0x334763(0x233)]==_0x334763(0x199))var _0x422abb=users['Chinese'];else{if(_0x327d69[0x0][_0x334763(0x233)]==_0x334763(0x1ac))var _0x422abb=users[_0x334763(0x1c4)];}}}}}}}_0x10fc20[_0x334763(0x24d)](_0x334763(0x1a1),{'success':_0x30b655[_0x334763(0x180)]('success'),'errors':_0x30b655[_0x334763(0x180)](_0x334763(0x1bf)),'role':_0xa53b76,'profile':_0x37b401,'purchases':_0x579b64,'suppliers':_0x23a1be,'warehouse':_0x5843b1,'product':_0x1c8081,'master_shop':_0x327d69,'language':_0x422abb,'ed_fullDate':_0x1245bd,'dataSelected':_0x30cdbe});}catch(_0x560bc4){console[_0x334763(0x1cb)](_0x560bc4);}}),router[a0_0x3cd8fe(0x21f)](a0_0x3cd8fe(0x22b),auth,async(_0x587acf,_0x47a23a)=>{var _0x572255=a0_0x3cd8fe;try{const _0x58d199=_0x587acf['params']['id'],_0x117fe5=await purchases_finished[_0x572255(0x192)]({'_id':_0x587acf[_0x572255(0x1ed)]['id']}),_0x15a02b=await warehouse[_0x572255(0x192)]({'name':_0x117fe5[_0x572255(0x1f4)],'room':_0x117fe5['room']});_0x117fe5[_0x572255(0x1b5)][_0x572255(0x198)](_0x292c32=>{var _0x2a59db=_0x572255;const _0x3db613=_0x15a02b[_0x2a59db(0x1ab)][_0x2a59db(0x210)](_0x564024=>{var _0x3c0247=_0x2a59db;_0x564024[_0x3c0247(0x1df)]==_0x292c32[_0x3c0247(0x1df)]&&_0x564024['bay']==_0x292c32['bay']&&(_0x564024[_0x3c0247(0x200)]=parseInt(_0x564024[_0x3c0247(0x200)])-parseInt(_0x292c32['quantity']));});}),await _0x15a02b[_0x572255(0x23f)]();const {invoice:_0xf0b578,suppliers:_0x177535,date:_0x6c12b2,warehouse_name:_0x53a918,prod_name:_0x5c22b9,prod_code:_0x297e3c,prod_qty:_0x5e5f48,prod_unit:_0x5a2b8d,prod_secondunit:_0xedd5c2,prod_level:_0x6281fe,prod_isle:_0x4ede91,prod_pallet:_0x51272c,note:_0x576625,expiry_date:_0x33662d,batch_code:_0x43d91f,paid_amount:_0xba5016,due_amount:_0x5bc9c7,Room_name:_0x532bde,primary_code:_0xf92623,secondary_code:_0x23a6ad,PO_number:_0x156b90,JO_number:_0x36c2e2}=_0x587acf['body'];if(typeof _0x5c22b9=='string')var _0x14fede=[_0x587acf[_0x572255(0x21d)]['prod_name']],_0x36176b=[_0x587acf['body'][_0x572255(0x14f)]],_0x11b8f9=[_0x587acf[_0x572255(0x21d)][_0x572255(0x179)]],_0x2f645a=[_0x587acf[_0x572255(0x21d)]['prod_unit']],_0x48d753=[_0x587acf[_0x572255(0x21d)][_0x572255(0x1b3)]],_0x46851d=[_0x587acf['body'][_0x572255(0x232)]],_0x33f3b5=[_0x587acf[_0x572255(0x21d)][_0x572255(0x1f6)]],_0x183b43=[_0x587acf[_0x572255(0x21d)][_0x572255(0x1af)]],_0x401375=[_0x587acf[_0x572255(0x21d)]['MaxStocks_data']],_0x16a3ee=[_0x587acf[_0x572255(0x21d)][_0x572255(0x159)]],_0x4e5cd1=[_0x587acf['body'][_0x572255(0x212)]];else var _0x14fede=[..._0x587acf[_0x572255(0x21d)][_0x572255(0x1c2)]],_0x36176b=[..._0x587acf[_0x572255(0x21d)][_0x572255(0x14f)]],_0x11b8f9=[..._0x587acf[_0x572255(0x21d)][_0x572255(0x179)]],_0x2f645a=[..._0x587acf[_0x572255(0x21d)][_0x572255(0x24c)]],_0x48d753=[..._0x587acf['body'][_0x572255(0x1b3)]],_0x46851d=[..._0x587acf[_0x572255(0x21d)]['prod_level']],_0x33f3b5=[..._0x587acf[_0x572255(0x21d)][_0x572255(0x1f6)]],_0x183b43=[..._0x587acf[_0x572255(0x21d)][_0x572255(0x1af)]],_0x401375=[..._0x587acf[_0x572255(0x21d)][_0x572255(0x1a2)]],_0x16a3ee=[..._0x587acf[_0x572255(0x21d)][_0x572255(0x159)]],_0x4e5cd1=[..._0x587acf[_0x572255(0x21d)]['expiry_date']];const _0x46dff9=_0x14fede['map'](_0x40be4b=>{return _0x40be4b={'product_name':_0x40be4b};});_0x36176b[_0x572255(0x198)]((_0x13f76d,_0x4e3cb2)=>{var _0x449083=_0x572255;_0x46dff9[_0x4e3cb2][_0x449083(0x190)]=_0x13f76d;}),_0x11b8f9[_0x572255(0x198)]((_0x144251,_0x2aa144)=>{_0x46dff9[_0x2aa144]['quantity']=_0x144251;}),_0x2f645a[_0x572255(0x198)]((_0x10afa7,_0x273d74)=>{var _0x953cbc=_0x572255;_0x46dff9[_0x273d74][_0x953cbc(0x16d)]=_0x10afa7;}),_0x48d753['forEach']((_0x20246d,_0x470f73)=>{var _0x46294d=_0x572255;_0x46dff9[_0x470f73][_0x46294d(0x1a4)]=_0x20246d;}),_0x46851d[_0x572255(0x198)]((_0x4f92f3,_0x2ea814)=>{var _0x3b09ec=_0x572255;_0x46dff9[_0x2ea814][_0x3b09ec(0x18c)]=_0x4f92f3;}),_0x33f3b5['forEach']((_0x251a07,_0x45e353)=>{var _0x2ec7ad=_0x572255;_0x46dff9[_0x45e353][_0x2ec7ad(0x1f6)]=_0x251a07;}),_0x183b43['forEach']((_0x10ee16,_0x31cd78)=>{var _0xf40e79=_0x572255;_0x46dff9[_0x31cd78][_0xf40e79(0x1af)]=_0x10ee16;}),_0x401375[_0x572255(0x198)]((_0x3845c1,_0x2435e0)=>{_0x46dff9[_0x2435e0]['maxStocks']=_0x3845c1;}),_0x16a3ee[_0x572255(0x198)]((_0x4dee42,_0x4b734d)=>{var _0x47566b=_0x572255;_0x46dff9[_0x4b734d][_0x47566b(0x159)]=_0x4dee42;}),_0x4e5cd1[_0x572255(0x198)]((_0x2386a6,_0x44ddd2)=>{_0x46dff9[_0x44ddd2]['expiry_date']=_0x2386a6;});const _0xe2318c=_0x46dff9[_0x572255(0x203)](_0x559df5=>_0x559df5[_0x572255(0x19c)]!=='0'&&_0x559df5['quantity']!=='');_0x117fe5[_0x572255(0x1d4)]=_0xf0b578,_0x117fe5[_0x572255(0x1ee)]=_0x177535,_0x117fe5[_0x572255(0x19a)]=_0x6c12b2,_0x117fe5['warehouse_name']=_0x53a918,_0x117fe5[_0x572255(0x1b5)]=_0xe2318c,_0x117fe5[_0x572255(0x202)]=_0x576625,_0x117fe5[_0x572255(0x250)]=_0xba5016,_0x117fe5[_0x572255(0x218)]=_0x5bc9c7,_0x117fe5[_0x572255(0x186)]=_0x532bde,_0x117fe5['POnumber']=_0x156b90,_0x117fe5[_0x572255(0x254)]=_0x36c2e2;const _0x657e35=await _0x117fe5[_0x572255(0x23f)](),_0xcf807a=await warehouse[_0x572255(0x192)]({'name':_0x587acf[_0x572255(0x21d)][_0x572255(0x1f4)],'room':_0x587acf[_0x572255(0x21d)][_0x572255(0x221)]});_0x117fe5[_0x572255(0x1b5)][_0x572255(0x198)](_0x57496a=>{var _0x2a79f3=_0x572255,_0x1b8154=0x0;const _0x3a097f=_0xcf807a[_0x2a79f3(0x1ab)][_0x2a79f3(0x210)](_0x18b92f=>{var _0x1184c7=_0x2a79f3;_0x18b92f[_0x1184c7(0x1df)]==_0x57496a[_0x1184c7(0x1df)]&&_0x18b92f[_0x1184c7(0x18c)]==_0x57496a['bay']&&(_0x18b92f[_0x1184c7(0x200)]=parseInt(_0x18b92f['product_stock'])+parseInt(_0x57496a['quantity']),_0x1b8154++);});_0x1b8154=='0'&&(_0xcf807a[_0x2a79f3(0x1ab)]=_0xcf807a[_0x2a79f3(0x1ab)][_0x2a79f3(0x23a)]({'product_name':_0x57496a[_0x2a79f3(0x1df)],'product_stock':_0x57496a['quantity'],'primary_code':_0x57496a[_0x2a79f3(0x1f6)],'secondary_code':_0x57496a[_0x2a79f3(0x1af)],'product_code':_0x57496a['product_code'],'bay':_0x57496a[_0x2a79f3(0x18c)],'maxProducts':_0x57496a[_0x2a79f3(0x168)],'unit':_0x57496a[_0x2a79f3(0x16d)],'secondary_unit':_0x57496a[_0x2a79f3(0x1a4)],'expiry_date':_0x57496a[_0x2a79f3(0x212)]}));}),await _0xcf807a[_0x572255(0x23f)]();const _0x47818f=await s_payment_data[_0x572255(0x192)]({'invoice':_0x587acf[_0x572255(0x21d)]['invoice']});if(_0x47818f===null){}else console[_0x572255(0x1cb)](_0x572255(0x1ee),_0x47818f,_0x587acf[_0x572255(0x21d)][_0x572255(0x1d4)]),_0x47818f['suppliers']=_0x587acf['body'][_0x572255(0x1ee)],await _0x47818f[_0x572255(0x23f)]();_0x587acf[_0x572255(0x180)]('success',_0x572255(0x207)),_0x47a23a[_0x572255(0x1cc)](_0x572255(0x16f));}catch(_0x59ca28){console[_0x572255(0x1cb)](_0x59ca28);}}),router[a0_0x3cd8fe(0x21f)](a0_0x3cd8fe(0x20d),auth,async(_0x308a1c,_0x914b8d)=>{var _0xef0422=a0_0x3cd8fe;try{const _0x567443=_0x308a1c[_0xef0422(0x1ed)]['id'],{invoice:_0x31e850,suppliers:_0x672bc7,payable:_0x45cf80,due_amount:_0x2b41fa}=_0x308a1c[_0xef0422(0x21d)],_0x2b4a23=await purchases[_0xef0422(0x1fc)](_0x567443);var _0x446fd7=_0x45cf80-_0x2b41fa;_0x2b4a23[_0xef0422(0x250)]=parseFloat(_0x2b4a23[_0xef0422(0x250)])+parseFloat(_0x2b41fa),_0x2b4a23[_0xef0422(0x218)]=_0x446fd7;const _0x24a1d8=await _0x2b4a23['save']();console[_0xef0422(0x1cb)](_0x24a1d8);const _0x5518e1=await s_payment_data['findOne']({'invoice':_0x31e850});_0x5518e1[_0xef0422(0x194)]=_0x446fd7,await _0x5518e1[_0xef0422(0x23f)]();let _0x1ac202=new Date(),_0xbb15bf=('0'+_0x1ac202['getDate']())[_0xef0422(0x1fb)](-0x2),_0xb36df5=('0'+(_0x1ac202['getMonth']()+0x1))[_0xef0422(0x1fb)](-0x2),_0x4ff624=_0x1ac202[_0xef0422(0x1e4)](),_0x3cf59b=_0x4ff624+'-'+_0xb36df5+'-'+_0xbb15bf;const _0x199bbe=new suppliers_payment({'invoice':_0x31e850,'date':_0x4ff624+'-'+_0xb36df5+'-'+_0xbb15bf,'suppliers':_0x672bc7,'reason':_0xef0422(0x24a),'amount':_0x2b41fa}),_0x23502a=await _0x199bbe[_0xef0422(0x23f)]();_0x308a1c[_0xef0422(0x180)](_0xef0422(0x1a7),_0xef0422(0x18a)),_0x914b8d[_0xef0422(0x1cc)]('/all_purchases/view');}catch(_0x51d72f){console[_0xef0422(0x1cb)](_0x51d72f);}}),router['get'](a0_0x3cd8fe(0x235),auth,async(_0x466ae7,_0x2e2caf)=>{var _0x21c1b2=a0_0x3cd8fe;try{const {username:_0x49399c,email:_0x2abeb8,role:_0x3185ed}=_0x466ae7[_0x21c1b2(0x1ff)],_0x296324=_0x466ae7[_0x21c1b2(0x1ff)],_0x1dceb5=await profile['findOne']({'email':_0x296324['email']}),_0xcad10=await master_shop['find']();console['log'](_0x21c1b2(0x242),_0xcad10);const _0x1b711e=_0x466ae7[_0x21c1b2(0x1ed)]['id'],_0x1c1d52=await purchases['findById'](_0x1b711e);console[_0x21c1b2(0x1cb)](_0x1c1d52);const _0x70620b=await suppliers['findOne']({'name':_0x1c1d52[_0x21c1b2(0x1ee)]});console[_0x21c1b2(0x1cb)](_0x70620b);if(_0xcad10[0x0][_0x21c1b2(0x233)]=='English\x20(US)'){var _0x4881f3=users['English'];console[_0x21c1b2(0x1cb)](_0x4881f3);}else{if(_0xcad10[0x0]['language']=='Hindi')var _0x4881f3=users['Hindi'];else{if(_0xcad10[0x0][_0x21c1b2(0x233)]==_0x21c1b2(0x1b7))var _0x4881f3=users[_0x21c1b2(0x1b7)];else{if(_0xcad10[0x0][_0x21c1b2(0x233)]==_0x21c1b2(0x1e5))var _0x4881f3=users['Spanish'];else{if(_0xcad10[0x0][_0x21c1b2(0x233)]=='French')var _0x4881f3=users[_0x21c1b2(0x1c5)];else{if(_0xcad10[0x0][_0x21c1b2(0x233)]==_0x21c1b2(0x223))var _0x4881f3=users['Portuguese'];else{if(_0xcad10[0x0][_0x21c1b2(0x233)]==_0x21c1b2(0x199))var _0x4881f3=users[_0x21c1b2(0x199)];else{if(_0xcad10[0x0][_0x21c1b2(0x233)]=='Arabic\x20(ae)')var _0x4881f3=users[_0x21c1b2(0x1c4)];}}}}}}}_0x2e2caf[_0x21c1b2(0x24d)](_0x21c1b2(0x19f),{'success':_0x466ae7[_0x21c1b2(0x180)](_0x21c1b2(0x1a7)),'errors':_0x466ae7[_0x21c1b2(0x180)](_0x21c1b2(0x1bf)),'role':_0x296324,'profile':_0x1dceb5,'master_shop':_0xcad10,'supplier':_0x70620b,'purchase':_0x1c1d52,'language':_0x4881f3});}catch(_0xb4165f){console[_0x21c1b2(0x1cb)](_0xb4165f);}}),router[a0_0x3cd8fe(0x228)](a0_0x3cd8fe(0x1d8),auth,async(_0x4eb324,_0x21e83b)=>{var _0x24ecdf=a0_0x3cd8fe;try{const {username:_0x5b3e20,email:_0xd8bf0c,role:_0x33786a}=_0x4eb324[_0x24ecdf(0x1ff)],_0x2b5e14=_0x4eb324['user'],_0x2c8d09=await profile[_0x24ecdf(0x192)]({'email':_0x2b5e14[_0x24ecdf(0x238)]}),_0x572466=await master_shop[_0x24ecdf(0x16a)]();console['log'](_0x24ecdf(0x242),_0x572466);const _0x4b6532=_0x4eb324[_0x24ecdf(0x1ed)]['id'];console['log'](_0x4b6532);const _0x453fe5=await purchases_finished[_0x24ecdf(0x1fc)](_0x4b6532);console[_0x24ecdf(0x1cb)](_0x24ecdf(0x21a),_0x453fe5);const _0x119f11=await product['find']({}),_0x3e0ea2=await warehouse[_0x24ecdf(0x187)]([{'$match':{'name':_0x453fe5['warehouse_name'],'room':_0x453fe5['room']}},{'$unwind':_0x24ecdf(0x251)},{'$group':{'_id':_0x24ecdf(0x234),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x24ecdf(0x18d)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x24ecdf(0x1b1)},'floorlevel':{'$first':_0x24ecdf(0x1f9)},'primary_code':{'$first':_0x24ecdf(0x1d1)},'secondary_code':{'$first':_0x24ecdf(0x20c)},'product_code':{'$first':_0x24ecdf(0x239)},'storage':{'$first':_0x24ecdf(0x217)},'rack':{'$first':_0x24ecdf(0x151)}}}]);console[_0x24ecdf(0x1cb)](_0x24ecdf(0x23e),_0x3e0ea2);let _0x1affba;if(_0x2b5e14[_0x24ecdf(0x178)]=='staff'){const _0x41d6d4=await staff[_0x24ecdf(0x192)]({'email':_0x2b5e14['email']});_0x1affba=await warehouse[_0x24ecdf(0x16a)]({'status':'Enabled','name':_0x41d6d4['warehouse'],'warehouse_category':_0x24ecdf(0x156),'name':_0x24ecdf(0x17f)});}else _0x1affba=await warehouse[_0x24ecdf(0x187)]([{'$match':{'status':_0x24ecdf(0x169),'warehouse_category':'Finished\x20Goods','name':_0x24ecdf(0x17f)}},{'$group':{'_id':_0x24ecdf(0x227),'name':{'$first':_0x24ecdf(0x227)}}}]);if(_0x572466[0x0][_0x24ecdf(0x233)]=='English\x20(US)'){var _0x5338d1=users[_0x24ecdf(0x1bc)];console[_0x24ecdf(0x1cb)](_0x5338d1);}else{if(_0x572466[0x0]['language']==_0x24ecdf(0x22a))var _0x5338d1=users['Hindi'];else{if(_0x572466[0x0][_0x24ecdf(0x233)]==_0x24ecdf(0x1b7))var _0x5338d1=users['German'];else{if(_0x572466[0x0][_0x24ecdf(0x233)]==_0x24ecdf(0x1e5))var _0x5338d1=users['Spanish'];else{if(_0x572466[0x0]['language']=='French')var _0x5338d1=users['French'];else{if(_0x572466[0x0][_0x24ecdf(0x233)]==_0x24ecdf(0x223))var _0x5338d1=users[_0x24ecdf(0x1e2)];else{if(_0x572466[0x0][_0x24ecdf(0x233)]==_0x24ecdf(0x199))var _0x5338d1=users[_0x24ecdf(0x199)];else{if(_0x572466[0x0][_0x24ecdf(0x233)]=='Arabic\x20(ae)')var _0x5338d1=users[_0x24ecdf(0x1c4)];}}}}}}}_0x21e83b['render'](_0x24ecdf(0x1d6),{'success':_0x4eb324[_0x24ecdf(0x180)]('success'),'errors':_0x4eb324['flash'](_0x24ecdf(0x1bf)),'role':_0x2b5e14,'profile':_0x2c8d09,'user':_0x453fe5,'stock':_0x3e0ea2,'master_shop':_0x572466,'product':_0x119f11,'language':_0x5338d1,'warehouse':_0x1affba});}catch(_0x4f2f3b){console[_0x24ecdf(0x1cb)](_0x4f2f3b);}}),router[a0_0x3cd8fe(0x21f)](a0_0x3cd8fe(0x1d8),auth,async(_0x4351b1,_0x5921d8)=>{var _0x41f251=a0_0x3cd8fe;try{const {invoice:_0x3c2471,date:_0x4688aa,warehouse_name:_0x1a8982,Room_name:_0x3c28e3,product_name:_0x3d1342,purchase_quantity:_0x13e84d,stocks:_0x395513,return_qty:_0x118e88,note:_0x5a50e5,level:_0x528922,isle:_0x51f212,pallet:_0x5d173,to_warehouse_name:_0x412275,to_Room_name:_0x138e62}=_0x4351b1[_0x41f251(0x21d)],_0x2d1ad4=await purchases_finished[_0x41f251(0x192)]({'_id':_0x4351b1[_0x41f251(0x1ed)]['id']}),_0x57fa47=await warehouse['findOne']({'name':_0x1a8982,'room':_0x3c28e3,'warehouse_category':_0x41f251(0x156)});if(typeof _0x3d1342==_0x41f251(0x1c1))var _0x326221=[_0x4351b1['body'][_0x41f251(0x1df)]],_0x387275=[_0x4351b1[_0x41f251(0x21d)][_0x41f251(0x236)]],_0x50ac1c=[_0x4351b1[_0x41f251(0x21d)][_0x41f251(0x188)]],_0x417e10=[_0x4351b1[_0x41f251(0x21d)][_0x41f251(0x1ba)]],_0x59c593=[_0x4351b1[_0x41f251(0x21d)]['level']],_0x421630=[_0x4351b1[_0x41f251(0x21d)][_0x41f251(0x17c)]],_0x4d2760=[_0x4351b1['body'][_0x41f251(0x1bd)]],_0x19f9fc=[_0x4351b1[_0x41f251(0x21d)][_0x41f251(0x164)]];else var _0x326221=[..._0x4351b1[_0x41f251(0x21d)][_0x41f251(0x1df)]],_0x387275=[..._0x4351b1[_0x41f251(0x21d)][_0x41f251(0x236)]],_0x50ac1c=[..._0x4351b1[_0x41f251(0x21d)][_0x41f251(0x188)]],_0x417e10=[..._0x4351b1['body'][_0x41f251(0x1ba)]],_0x59c593=[..._0x4351b1[_0x41f251(0x21d)][_0x41f251(0x1a0)]],_0x421630=[..._0x4351b1[_0x41f251(0x21d)]['product_code_hide']],_0x4d2760=[..._0x4351b1['body'][_0x41f251(0x1bd)]],_0x19f9fc=[..._0x4351b1[_0x41f251(0x21d)][_0x41f251(0x164)]];const _0x34224e=_0x326221[_0x41f251(0x210)](_0x18c70d=>{return _0x18c70d={'product_name':_0x18c70d};});_0x387275[_0x41f251(0x198)]((_0x4d5606,_0x29aed5)=>{var _0x1aef89=_0x41f251;_0x34224e[_0x29aed5][_0x1aef89(0x236)]=_0x4d5606;}),_0x50ac1c[_0x41f251(0x198)]((_0x3ae7f7,_0x1ad618)=>{var _0x35667c=_0x41f251;_0x34224e[_0x1ad618][_0x35667c(0x22f)]=_0x3ae7f7;}),_0x417e10[_0x41f251(0x198)]((_0x4b1539,_0x148581)=>{_0x34224e[_0x148581]['return_qty']=_0x4b1539;}),_0x59c593[_0x41f251(0x198)]((_0x385e67,_0x36582e)=>{var _0x573c8d=_0x41f251;_0x34224e[_0x36582e][_0x573c8d(0x18c)]=_0x385e67;}),_0x421630[_0x41f251(0x198)]((_0x741db9,_0x546adb)=>{_0x34224e[_0x546adb]['product_code']=_0x741db9;}),_0x4d2760[_0x41f251(0x198)]((_0x30dbca,_0x282e89)=>{var _0x48b922=_0x41f251;_0x34224e[_0x282e89][_0x48b922(0x1f6)]=_0x30dbca;}),_0x19f9fc[_0x41f251(0x198)]((_0xeeffc1,_0x5b6a17)=>{var _0x194101=_0x41f251;_0x34224e[_0x5b6a17][_0x194101(0x1af)]=_0xeeffc1;}),_0x34224e[_0x41f251(0x198)](_0x2121fe=>{var _0x733f18=_0x41f251;console[_0x733f18(0x1cb)](_0x2121fe);const _0x3686fc=_0x57fa47[_0x733f18(0x1ab)][_0x733f18(0x210)](_0x1300bb=>{var _0x319cec=_0x733f18;_0x1300bb[_0x319cec(0x1df)]==_0x2121fe[_0x319cec(0x1df)]&&_0x1300bb['bay']==_0x2121fe['bay']&&(console[_0x319cec(0x1cb)](parseInt(_0x1300bb[_0x319cec(0x200)])+_0x319cec(0x161)+parseInt(_0x2121fe[_0x319cec(0x1ba)])),_0x1300bb[_0x319cec(0x200)]=parseInt(_0x1300bb['product_stock'])-parseInt(_0x2121fe[_0x319cec(0x1ba)]));});}),await _0x57fa47['save']();var _0x3229b3=0x0;_0x34224e[_0x41f251(0x198)](_0x545fc9=>{var _0x39a1db=_0x41f251;(parseInt(_0x545fc9[_0x39a1db(0x236)])<parseInt(_0x545fc9['return_qty'])||parseInt(_0x545fc9['stock_quantity'])<parseInt(_0x545fc9[_0x39a1db(0x1ba)]))&&_0x3229b3++;});if(_0x3229b3!=0x0)return _0x4351b1[_0x41f251(0x180)](_0x41f251(0x1bf),_0x41f251(0x1b8)),_0x5921d8[_0x41f251(0x1cc)](_0x41f251(0x204));const _0x5170a7=new purchases_return_finished({'invoice':_0x3c2471,'suppliers':_0x4351b1[_0x41f251(0x21d)][_0x41f251(0x1ee)],'date':_0x4688aa,'warehouse_name':_0x1a8982,'return_product':_0x34224e,'note':_0x5a50e5,'room':_0x3c28e3,'to_warehouse_name':_0x412275,'to_room':_0x138e62}),_0x815b6a=await _0x5170a7['save'](),_0x1ae212=await purchases_return_finished[_0x41f251(0x192)]({'invoice':_0x3c2471}),_0x37c77f=await warehouse[_0x41f251(0x192)]({'name':_0x412275,'room':_0x138e62,'warehouse_category':_0x41f251(0x156)});_0x1ae212[_0x41f251(0x1aa)][_0x41f251(0x198)](_0x1c11d6=>{var _0x29666f=_0x41f251,_0x3bf5c5=0x0;const _0x448cf3=_0x37c77f[_0x29666f(0x1ab)][_0x29666f(0x210)](_0xfa3d4f=>{var _0x34bf7f=_0x29666f;console['log'](_0xfa3d4f[_0x34bf7f(0x1df)]+'=='+_0x1c11d6[_0x34bf7f(0x1df)]+'&&'+_0xfa3d4f[_0x34bf7f(0x18c)]+'=='+_0x1c11d6[_0x34bf7f(0x18c)]),_0xfa3d4f[_0x34bf7f(0x1df)]==_0x1c11d6[_0x34bf7f(0x1df)]&&_0xfa3d4f['bay']==_0x1c11d6[_0x34bf7f(0x18c)]&&(_0xfa3d4f[_0x34bf7f(0x200)]=parseInt(_0xfa3d4f['product_stock'])-parseInt(_0x1c11d6[_0x34bf7f(0x1ba)]),_0x3bf5c5++);});_0x3bf5c5=='0'&&(_0x37c77f['product_details']=_0x37c77f[_0x29666f(0x1ab)][_0x29666f(0x23a)]({'product_name':_0x1c11d6[_0x29666f(0x1df)],'product_stock':_0x1c11d6[_0x29666f(0x1ba)],'primary_code':_0x1c11d6[_0x29666f(0x1f6)],'secondary_code':_0x1c11d6[_0x29666f(0x1af)],'product_code':_0x1c11d6[_0x29666f(0x190)],'bay':_0x1c11d6[_0x29666f(0x18c)],'maxProducts':0xf423f}));}),await _0x37c77f[_0x41f251(0x23f)]();const _0x185942=await purchases_finished[_0x41f251(0x192)]({'invoice':_0x3c2471});_0x185942[_0x41f251(0x213)]=_0x41f251(0x21b);const _0x4959fc=await _0x185942[_0x41f251(0x23f)](),_0x3ebbde=new s_payment_data({'invoice':_0x3c2471,'suppliers':_0x4351b1['body'][_0x41f251(0x1ee)],'reason':_0x41f251(0x22d)});await _0x3ebbde[_0x41f251(0x23f)]();const _0x51a573=await master_shop[_0x41f251(0x16a)](),_0x208187=await email_settings[_0x41f251(0x192)](),_0x1917cb=await suppliers[_0x41f251(0x192)]({'name':_0x4351b1[_0x41f251(0x21d)][_0x41f251(0x1ee)]});_0x51a573[0x0][_0x41f251(0x220)]==0x1?(right_currency=_0x51a573[0x0][_0x41f251(0x16c)],left_currency=''):(right_currency='',left_currency=_0x51a573[0x0][_0x41f251(0x16c)]);var _0x3f88f0=_0x326221,_0xf6ce1d=_0x417e10,_0x17ef48='',_0x341775;for(_0x341775 in _0x3f88f0){_0x17ef48+=_0x41f251(0x1a9)+_0x41f251(0x22c)+_0x3f88f0[_0x341775]+_0x41f251(0x1e6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf6ce1d[_0x341775]+'</td>'+_0x41f251(0x244);}let _0x551583=nodemailer[_0x41f251(0x197)]({'service':_0x41f251(0x150),'auth':{'user':_0x208187['email'],'pass':_0x208187[_0x41f251(0x189)]}}),_0x273f1a={'from':_0x208187['email'],'to':_0x1917cb['email'],'subject':_0x41f251(0x24f),'attachments':[{'filename':_0x41f251(0x1d5),'path':__dirname+'/../public'+_0x41f251(0x1d2)+_0x51a573[0x0][_0x41f251(0x16e)],'cid':'logo'}],'html':_0x41f251(0x1d3)+_0x41f251(0x1ad)+_0x41f251(0x1e1)+_0x41f251(0x1be)+_0x41f251(0x177)+_0x41f251(0x1be)+_0x41f251(0x1b2)+_0x41f251(0x1a3)+_0x41f251(0x1be)+'<h2>\x20'+_0x51a573[0x0][_0x41f251(0x153)]+'\x20</h2>'+_0x41f251(0x1a3)+_0x41f251(0x1a3)+_0x41f251(0x237)+_0x41f251(0x1be)+_0x41f251(0x183)+_0x41f251(0x1d9)+_0x3c2471+'\x20'+_0x41f251(0x23c)+_0x41f251(0x247)+_0x4688aa+'\x20'+_0x41f251(0x1c8)+'</h5>'+_0x41f251(0x1a3)+_0x41f251(0x1a6)+_0x41f251(0x176)+_0x41f251(0x1a9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x41f251(0x19e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x41f251(0x1cf)+'</tr>'+_0x41f251(0x15a)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x17ef48+'\x20'+'</tbody>'+_0x41f251(0x208)+_0x41f251(0x1be)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x51a573[0x0][_0x41f251(0x153)]+'</h5>'+_0x41f251(0x1a3)+_0x41f251(0x1a3)+'</body></html>'};_0x551583[_0x41f251(0x1fe)](_0x273f1a,function(_0x7f2ea2,_0x3b7a95){var _0x27a8c1=_0x41f251;_0x7f2ea2?console['log']('Error\x20Occurs'):console[_0x27a8c1(0x1cb)](_0x27a8c1(0x184));}),_0x4351b1['flash'](_0x41f251(0x1a7),_0x41f251(0x1a5)),_0x5921d8[_0x41f251(0x1cc)]('/all_purchases_finished/view');}catch(_0x4c4bd6){_0x5921d8[_0x41f251(0x1f8)](0xc8)[_0x41f251(0x231)]({'message':_0x4c4bd6[_0x41f251(0x166)]});}}),router['get'](a0_0x3cd8fe(0x193),auth,async(_0x1c93c3,_0x80a47c)=>{var _0x4ab4df=a0_0x3cd8fe;try{const {username:_0x3de244,email:_0x3fbff8,role:_0x2cbe6a}=_0x1c93c3[_0x4ab4df(0x1ff)],_0x45fd7f=_0x1c93c3[_0x4ab4df(0x1ff)],_0x27212f=await profile[_0x4ab4df(0x192)]({'email':_0x45fd7f['email']}),_0x5d5107=await master_shop[_0x4ab4df(0x16a)](),_0xbd0fea=_0x1c93c3[_0x4ab4df(0x1ed)]['id'],_0x4e0216=await purchases_finished[_0x4ab4df(0x1fc)](_0xbd0fea);if(_0x5d5107[0x0]['language']==_0x4ab4df(0x19b))var _0x29f83c=users[_0x4ab4df(0x1bc)];else{if(_0x5d5107[0x0][_0x4ab4df(0x233)]==_0x4ab4df(0x22a))var _0x29f83c=users['Hindi'];else{if(_0x5d5107[0x0][_0x4ab4df(0x233)]==_0x4ab4df(0x1b7))var _0x29f83c=users[_0x4ab4df(0x1b7)];else{if(_0x5d5107[0x0]['language']==_0x4ab4df(0x1e5))var _0x29f83c=users[_0x4ab4df(0x1e5)];else{if(_0x5d5107[0x0][_0x4ab4df(0x233)]==_0x4ab4df(0x1c5))var _0x29f83c=users[_0x4ab4df(0x1c5)];else{if(_0x5d5107[0x0][_0x4ab4df(0x233)]==_0x4ab4df(0x223))var _0x29f83c=users[_0x4ab4df(0x1e2)];else{if(_0x5d5107[0x0][_0x4ab4df(0x233)]==_0x4ab4df(0x199))var _0x29f83c=users['Chinese'];else{if(_0x5d5107[0x0][_0x4ab4df(0x233)]=='Arabic\x20(ae)')var _0x29f83c=users[_0x4ab4df(0x1c4)];}}}}}}}_0x80a47c[_0x4ab4df(0x24d)](_0x4ab4df(0x162),{'success':_0x1c93c3[_0x4ab4df(0x180)]('success'),'errors':_0x1c93c3['flash'](_0x4ab4df(0x1bf)),'role':_0x45fd7f,'profile':_0x27212f,'alldata':_0x4e0216,'master_shop':_0x5d5107,'language':_0x29f83c}),console['log'](alldata);}catch(_0x17eebd){console['log'](_0x17eebd);}}),router[a0_0x3cd8fe(0x21f)](a0_0x3cd8fe(0x1f5),async(_0xe5b155,_0x5d7e2e)=>{var _0x5e5ca5=a0_0x3cd8fe;const {product_code:_0x3aa92f}=_0xe5b155['body'];var _0x555752;const _0x486f52=await product[_0x5e5ca5(0x187)]([{'$match':{'primary_code':_0x3aa92f,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x5e5ca5(0x243),'name':{'$first':'$name'},'category':{'$first':_0x5e5ca5(0x1f1)},'brand':{'$first':_0x5e5ca5(0x1e9)},'unit':{'$first':_0x5e5ca5(0x14e)},'alertquantity':{'$first':_0x5e5ca5(0x154)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x5e5ca5(0x19d)},'secondary_code':{'$first':_0x5e5ca5(0x209)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x5e5ca5(0x195)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x404ab9=await product['aggregate']([{'$match':{'secondary_code':_0x3aa92f}},{'$group':{'_id':'$_id','name':{'$first':_0x5e5ca5(0x227)},'category':{'$first':_0x5e5ca5(0x1f1)},'brand':{'$first':'$brand'},'unit':{'$first':_0x5e5ca5(0x14e)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x5e5ca5(0x245)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x5e5ca5(0x209)},'maxStocks':{'$first':_0x5e5ca5(0x240)},'maxProdPerUnit':{'$first':_0x5e5ca5(0x195)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x486f52[_0x5e5ca5(0x16b)]>0x0)_0x555752=_0x486f52;else _0x404ab9[_0x5e5ca5(0x16b)]>0x0&&(_0x555752=_0x404ab9);_0x5d7e2e['json'](_0x555752);}),router[a0_0x3cd8fe(0x21f)]('/CheckingWarehouse',async(_0x4c9cc6,_0x4eef2f)=>{var _0x2f408a=a0_0x3cd8fe;const {productCode:_0x47ea9e,bay:_0x1fee63,warehouses:_0x59d630,room:_0x5af5d4}=_0x4c9cc6[_0x2f408a(0x21d)];console['log'](_0x4c9cc6[_0x2f408a(0x21d)]);try{const _0x1d3bc6=await warehouse[_0x2f408a(0x187)]([{'$match':{'name':_0x59d630,'room':_0x5af5d4}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x1fee63)}},{'$group':{'_id':_0x2f408a(0x234),'name':{'$first':_0x2f408a(0x196)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x2f408a(0x18d)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4eef2f[_0x2f408a(0x1f8)](0xc8)[_0x2f408a(0x231)](_0x1d3bc6);}catch(_0x31b671){_0x4eef2f[_0x2f408a(0x1f8)](0x194)[_0x2f408a(0x231)]({'message':_0x31b671[_0x2f408a(0x166)]});}}),module[a0_0x3cd8fe(0x1d7)]=router;