var a0_0x543a13=a0_0x3c4e;function a0_0x1cc1(){var _0x399d8d=['\x20<>\x20','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/all_purchases_finished/view','<h2>\x20','purchase\x20data\x20add\x20successfully','product_details','catch','gmail','QA\x20Warehouse','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/preview/:id','11772684XrxkNb','Portuguese','prod_code','error','filter','28NjkbLC','$warehouse_name','add_purchases\x20error','_id','get','English','return_purchase_finished','$product_details.product_code','$product','warehouse_name','$product_code','Paid\x20For\x20Purchase','aggregate','4187484bHFTVl','logo','Purchase\x20Mail','params','Rack\x202','purchase_invoice','</td>','stocks','</body></html>','max_product_unit','$alertquantity','RoomAssign','json','2585GtbGbD','<h5\x20style=\x22text-align:\x20left;\x22>','\x20</h2>','$suppliers','Email\x20sent\x20successfully','return_data','FROZEN\x20GOODS','<html><head><title></title>','product_name','<span\x20style=\x22float:\x20right;\x22>','prod_secondunit','suppliers','return_qty','Ambient','message','add_purchases_finished','email','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','\x20Order\x20Number\x20:\x20','$invoice','$product_details.type','187UhLqFV','find','host','success','Logo.png','JO_number','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','paid_amount','flash','$brand','prod_qty','$batch_code','German','</head><body>','primary_code_hide','purchase_quantity','$product_details.secondary_code','secondary_code_hide','../middleware/auth','</tr>','password','length','date_data','$date','8252ocdWDf','map','user','standard_unit','render','sendMail','$product_details.maxProducts','role','$product_details','<tbody\x20style=\x22text-align:\x20center;\x22>','$expiry_date','$due_amount','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<tr>','findById','exports','<table\x20style=\x22width:\x20100%\x20!important;\x22>','return_product','product','maxperunit','createTransport','</thead>','/give_payment/:id','$product_details.bin','$product.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','getFullYear','/../public','</tbody>','slice','<strong>\x20Regards\x20</strong>','then','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.rack','$product_details._id','site_title','edit_purchases_finished_view','bay','$product_details.bay','errors','body','Return\x20Goods','back','quantity','</div>','Arabic','image','$product_details.storage','Rack\x201','$return_data','product_date','master','$product_details.product_name','product_code','/upload/','<h5>','$product.floorlevel','Chinese','<!DOCTYPE\x20html>','name','$primary_code','abs','concat','currency','ejs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','French','port','Enclosed','table\x20page','user_id','MaxStocks_data','../models/all_models','log','save','product_cat','prod_primunit','$_id','$note','prod_level','Enabled','Purchase\x20Return','purchases\x20item\x20return\x20successfull','note','</h5>','/all_purchases/view','381pEoflS','/view/add_purchases','<div>','language','$product.room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','batch_code','prod_name','2771022KEizIZ','Portuguese\x20(BR)','2315990ccxiOp','warehouse','getDate','prod_invoice','$secondary_unit','Finished\x20Goods','prod_cat','forEach','path','staff','/CheckingWarehouse','$name','string','INCF-','redirect','status','nodemailer','$room','$product.type','room','Spanish','expiry_date','all_purchases_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$suppliers_docs','stock_data','Error\x20Occurs','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','secondary_unit','due_amount','updateOne','edit_purchases_finished','maxStocks','$maxProdPerUnit','/view/return_purchase/:id','$unit','Hindi','product_code_hide','primary_code','product_stock','$category','room_name','Arabic\x20(ae)','$secondary_code','getMonth','invoice','post','DRY\x20GOODS','prod_unit','6460KDfHiH','</table>','production_date','12908704SfNGJf','secondary_code','</span>','prod_Qty','purchase\x20data\x20update\x20successfully','/view/:id','$maxStocks','Error\x20occurred\x20while\x20processing\x20product:','../public/language/languages.json','findOne','all','level','$product_details.floorlevel','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'];a0_0x1cc1=function(){return _0x399d8d;};return a0_0x1cc1();}(function(_0x33095d,_0x5be65f){var _0x43fa65=a0_0x3c4e,_0x11665b=_0x33095d();while(!![]){try{var _0x4008ac=-parseInt(_0x43fa65(0x19f))/0x1*(-parseInt(_0x43fa65(0x246))/0x2)+parseInt(_0x43fa65(0x20b))/0x3+-parseInt(_0x43fa65(0x1db))/0x4*(-parseInt(_0x43fa65(0x218))/0x5)+parseInt(_0x43fa65(0x1a8))/0x6*(-parseInt(_0x43fa65(0x1fe))/0x7)+parseInt(_0x43fa65(0x1de))/0x8+parseInt(_0x43fa65(0x1f9))/0x9+parseInt(_0x43fa65(0x1aa))/0xa*(-parseInt(_0x43fa65(0x22d))/0xb);if(_0x4008ac===_0x5be65f)break;else _0x11665b['push'](_0x11665b['shift']());}catch(_0xc57a78){_0x11665b['push'](_0x11665b['shift']());}}}(a0_0x1cc1,0xe5792));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x543a13(0x191)),auth=require(a0_0x543a13(0x240)),nodemailer=require(a0_0x543a13(0x1ba));var ejs=require(a0_0x543a13(0x189));const path=require(a0_0x543a13(0x1b2)),users=require(a0_0x543a13(0x1e6));router['get']('/view',auth,async(_0x37c3c0,_0x16aa50)=>{var _0xad7653=a0_0x543a13;try{const {username:_0x7d73f4,email:_0x36948b,role:_0x4b7f6e}=_0x37c3c0[_0xad7653(0x248)],_0x31889d=_0x37c3c0['user'],_0x2996db=await profile['findOne']({'email':_0x31889d['email']}),_0xb98d4c=await staff['findOne']({'email':_0x31889d[_0xad7653(0x228)]});if(_0x31889d['role']==_0xad7653(0x1b3)){const _0x29fa25=await staff[_0xad7653(0x1e7)]({'email':_0x31889d['email']});}const _0x1385a9=await master_shop[_0xad7653(0x22e)]();let _0x49158a;if(_0x31889d[_0xad7653(0x24d)]=='staff'){const _0x147db1=await staff[_0xad7653(0x1e7)]({'email':_0x31889d[_0xad7653(0x228)]});_0x49158a=await purchases_finished[_0xad7653(0x20a)]([{'$match':{'warehouse_name':_0x147db1['warehouse']}},{'$lookup':{'from':_0xad7653(0x223),'localField':_0xad7653(0x223),'foreignField':_0xad7653(0x184),'as':'suppliers_docs'}},{'$unwind':_0xad7653(0x1c2)},{'$unwind':'$product'},{'$group':{'_id':_0xad7653(0x196),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0xad7653(0x21b)},'date':{'$first':_0xad7653(0x245)},'warehouse_name':{'$first':_0xad7653(0x1ff)},'room':{'$first':_0xad7653(0x1bb)},'product':{'$push':_0xad7653(0x206)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0xad7653(0x17a)},'batch_code':{'$first':_0xad7653(0x239)},'expiry_date':{'$first':_0xad7653(0x250)},'suppliers_docs':{'$first':_0xad7653(0x1c2)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0xad7653(0x25e)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0xad7653(0x181)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x49158a=await purchases_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0xad7653(0x196),'invoice':{'$first':_0xad7653(0x22b)},'suppliers':{'$first':_0xad7653(0x21b)},'date':{'$first':_0xad7653(0x245)},'warehouse_name':{'$first':_0xad7653(0x1ff)},'room':{'$addToSet':_0xad7653(0x1a3)},'product':{'$push':'$product'},'note':{'$first':_0xad7653(0x197)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0xad7653(0x251)},'return_data':{'$first':_0xad7653(0x17a)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0xad7653(0x250)},'suppliers_docs':{'$first':_0xad7653(0x1c2)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0xad7653(0x25e)},'type':{'$addToSet':_0xad7653(0x1bc)},'floorlevel':{'$addToSet':_0xad7653(0x181)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x1385a9[0x0][_0xad7653(0x1a2)]==_0xad7653(0x1ee))var _0xcbc8d3=users[_0xad7653(0x203)];else{if(_0x1385a9[0x0][_0xad7653(0x1a2)]==_0xad7653(0x1ce))var _0xcbc8d3=users[_0xad7653(0x1ce)];else{if(_0x1385a9[0x0][_0xad7653(0x1a2)]==_0xad7653(0x23a))var _0xcbc8d3=users[_0xad7653(0x23a)];else{if(_0x1385a9[0x0][_0xad7653(0x1a2)]==_0xad7653(0x1be))var _0xcbc8d3=users['Spanish'];else{if(_0x1385a9[0x0][_0xad7653(0x1a2)]==_0xad7653(0x18b))var _0xcbc8d3=users[_0xad7653(0x18b)];else{if(_0x1385a9[0x0][_0xad7653(0x1a2)]=='Portuguese\x20(BR)')var _0xcbc8d3=users[_0xad7653(0x1fa)];else{if(_0x1385a9[0x0]['language']=='Chinese')var _0xcbc8d3=users[_0xad7653(0x182)];else{if(_0x1385a9[0x0]['language']=='Arabic\x20(ae)')var _0xcbc8d3=users['Arabic'];}}}}}}}_0x16aa50[_0xad7653(0x24a)](_0xad7653(0x1c0),{'success':_0x37c3c0[_0xad7653(0x236)](_0xad7653(0x230)),'errors':_0x37c3c0[_0xad7653(0x236)](_0xad7653(0x26d)),'purchases':_0x49158a,'role':_0x31889d,'profile':_0x2996db,'master_shop':_0x1385a9,'language':_0xcbc8d3});}catch(_0xf38628){console[_0xad7653(0x192)](_0xad7653(0x18e),_0xf38628),_0x16aa50['status'](0xc8)['json']({'message':_0xf38628[_0xad7653(0x226)]});}});function BayBinSelected(_0xec461,_0x1e2f56){var _0x1c43ed=a0_0x543a13,_0x3c1707=[],_0x5a5b12=[];if(_0xec461==_0x1c43ed(0x1d9)){switch(_0x1e2f56){case _0x1c43ed(0x179):_0x3c1707=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x3c1707=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5a5b12=['DG'];}else{if(_0xec461==_0x1c43ed(0x21e)){switch(_0x1e2f56){case _0x1c43ed(0x179):_0x3c1707=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1c43ed(0x20f):_0x3c1707=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5a5b12=['FG'];}}return{'levels':_0x3c1707,'identify':_0x5a5b12};}async function getRandom8DigitNumber(){var _0x4814b4=a0_0x543a13;const _0x4c5842=0x989680,_0x51d3e4=0x5f5e0ff,_0x31507b=Math['floor'](Math['random']()*(_0x51d3e4-_0x4c5842+0x1))+_0x4c5842;var _0x568cf1;const _0x322f44=await purchases_finished[_0x4814b4(0x1e7)]({'invoice':_0x4814b4(0x1b7)+_0x31507b});return _0x322f44&&_0x322f44[_0x4814b4(0x243)]>0x0?_0x568cf1=_0x4814b4(0x1b7)+_0x31507b:_0x568cf1='INCF-'+_0x31507b,_0x568cf1;}function a0_0x3c4e(_0x1e7a3a,_0x3764ed){var _0x1cc13a=a0_0x1cc1();return a0_0x3c4e=function(_0x3c4ebe,_0x938006){_0x3c4ebe=_0x3c4ebe-0x176;var _0x4a2dae=_0x1cc13a[_0x3c4ebe];return _0x4a2dae;},a0_0x3c4e(_0x1e7a3a,_0x3764ed);}router['get'](a0_0x543a13(0x1a0),auth,async(_0x87440f,_0x5cb9ba)=>{var _0x27615b=a0_0x543a13;try{const {username:_0x2d7e16,email:_0x16a31e,role:_0x4f5c35}=_0x87440f[_0x27615b(0x248)],_0x3022f6=_0x87440f[_0x27615b(0x248)],_0x4ea8e5=await profile[_0x27615b(0x1e7)]({'email':_0x3022f6[_0x27615b(0x228)]}),_0x19078c=await master_shop[_0x27615b(0x22e)](),_0x230706=await staff[_0x27615b(0x1e7)]({'email':_0x3022f6[_0x27615b(0x228)]}),_0x3393c2=await suppliers[_0x27615b(0x22e)]({});let _0x3c8151;if(_0x3022f6[_0x27615b(0x24d)]==_0x27615b(0x1b3)){const _0xaf56e6=await staff[_0x27615b(0x1e7)]({'email':_0x3022f6[_0x27615b(0x228)]});_0x3c8151=await warehouse['aggregate']([{'$match':{'status':_0x27615b(0x199),'name':_0xaf56e6[_0x27615b(0x1ab)],'warehouse_category':_0x27615b(0x1af)}},{'$group':{'_id':_0x27615b(0x1b5),'name':{'$first':_0x27615b(0x1b5)}}}]);}else _0x3c8151=await warehouse[_0x27615b(0x20a)]([{'$match':{'status':_0x27615b(0x199),'warehouse_category':_0x27615b(0x1af),'name':{'$ne':_0x27615b(0x1f6)}}},{'$group':{'_id':_0x27615b(0x1b5),'name':{'$first':_0x27615b(0x1b5)}}}]);const _0x3e54b7=await product[_0x27615b(0x22e)]({}),_0x386a3c=await warehouse[_0x27615b(0x22e)]({'status':_0x27615b(0x199)}),_0x3d3404=await purchases_finished[_0x27615b(0x22e)]({}),_0x29d901=_0x3d3404['length']+0x1,_0x5a388c='INCF-'+_0x29d901['toString']()['padStart'](0x5,'0');var _0xac09e0=[_0x27615b(0x225),_0x27615b(0x18d)];if(_0x19078c[0x0][_0x27615b(0x1a2)]==_0x27615b(0x1ee))var _0x4c2a6a=users[_0x27615b(0x203)];else{if(_0x19078c[0x0][_0x27615b(0x1a2)]=='Hindi')var _0x4c2a6a=users[_0x27615b(0x1ce)];else{if(_0x19078c[0x0][_0x27615b(0x1a2)]==_0x27615b(0x23a))var _0x4c2a6a=users[_0x27615b(0x23a)];else{if(_0x19078c[0x0][_0x27615b(0x1a2)]==_0x27615b(0x1be))var _0x4c2a6a=users[_0x27615b(0x1be)];else{if(_0x19078c[0x0]['language']==_0x27615b(0x18b))var _0x4c2a6a=users[_0x27615b(0x18b)];else{if(_0x19078c[0x0][_0x27615b(0x1a2)]=='Portuguese\x20(BR)')var _0x4c2a6a=users[_0x27615b(0x1fa)];else{if(_0x19078c[0x0]['language']==_0x27615b(0x182))var _0x4c2a6a=users[_0x27615b(0x182)];else{if(_0x19078c[0x0][_0x27615b(0x1a2)]==_0x27615b(0x1d4))var _0x4c2a6a=users[_0x27615b(0x176)];}}}}}}}const _0x62b437=getRandom8DigitNumber();_0x62b437[_0x27615b(0x265)](_0x2dc562=>{var _0x10d1c9=_0x27615b;_0x5cb9ba[_0x10d1c9(0x24a)](_0x10d1c9(0x227),{'success':_0x87440f[_0x10d1c9(0x236)]('success'),'errors':_0x87440f[_0x10d1c9(0x236)](_0x10d1c9(0x26d)),'role':_0x3022f6,'profile':_0x4ea8e5,'suppliers':_0x3393c2,'warehouse':_0x3c8151,'product':_0x3e54b7,'invoice':_0x2dc562,'master_shop':_0x19078c,'language':_0x4c2a6a,'find_data':_0x386a3c,'rooms_data':_0xac09e0});})[_0x27615b(0x1f4)](_0x508d62=>{var _0x235e7d=_0x27615b;_0x87440f[_0x235e7d(0x236)](_0x235e7d(0x26d),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5cb9ba[_0x235e7d(0x1b8)](_0x235e7d(0x1f0));});}catch(_0x2aa3ca){console[_0x27615b(0x192)](_0x2aa3ca);}}),router[a0_0x543a13(0x202)]('/view/add_purchases/:id',auth,async(_0x5c9e9b,_0xdd1e)=>{var _0x556856=a0_0x543a13;try{const _0x2e8ed8=_0x5c9e9b['params']['id'];console[_0x556856(0x192)](_0x2e8ed8);const _0x25ac55=await master_shop[_0x556856(0x22e)]();console['log']('master',_0x25ac55);const _0x394adb=await product[_0x556856(0x1e7)]({'name':_0x2e8ed8});console[_0x556856(0x192)](_0x556856(0x258),_0x394adb),_0xdd1e[_0x556856(0x1b9)](0xc8)[_0x556856(0x217)]({'product_data':_0x394adb,'master':_0x25ac55});}catch(_0x12ad44){console['log'](_0x556856(0x200),_0x12ad44);}}),router[a0_0x543a13(0x1d8)](a0_0x543a13(0x1a0),auth,async(_0x4b9b34,_0x5df036)=>{var _0x278e7d=a0_0x543a13;try{const {invoice:_0x5dbb86,date:_0xe4bf0b,warehouse_name:_0x32f1d5,prod_name:_0x486bfb,prod_code:_0x222e3b,prod_qty:_0x4c43db,prod_unit:_0x52a7f0,prod_secondunit:_0x330ecc,prod_level:_0x1d9d01,prod_isle:_0x206958,prod_pallet:_0x4fd016,note:_0x5d497e,expiry_date:_0x5b5e74,batch_code:_0x427367,payable:_0x56604b,due_amount:_0x12068f,Room_name:_0x105c16,primary_code:_0x46a239,secondary_code:_0x126975,MaxStocks_data:_0x5895f6,PO_number:_0x30f4b3,SCRN:_0x5f34aa,JO_number:_0x1b344f}=_0x4b9b34[_0x278e7d(0x26e)];if(typeof _0x486bfb==_0x278e7d(0x1b6))var _0x3837d1=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x1a7)]],_0x7a6f0c=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x1fb)]],_0x1deaec=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x1e1)]],_0x53c42c=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x195)]],_0x3cfaef=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x222)]],_0x1fde67=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x198)]],_0x1ade37=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x1d0)]],_0x478a2b=[_0x4b9b34[_0x278e7d(0x26e)]['secondary_code']],_0x302cf1=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x190)]],_0x1e2e7f=[_0x4b9b34['body']['batch_code']],_0x3271b4=[_0x4b9b34[_0x278e7d(0x26e)]['expiry_date']],_0x4aef37=[_0x4b9b34[_0x278e7d(0x26e)]['product_date']],_0x5e59ad=[_0x4b9b34[_0x278e7d(0x26e)]['max_product_unit']],_0x487f5e=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x1b0)]],_0x304019=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x216)]],_0x194aa7=[_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x1ad)]];else var _0x3837d1=[..._0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x1a7)]],_0x7a6f0c=[..._0x4b9b34[_0x278e7d(0x26e)]['prod_code']],_0x1deaec=[..._0x4b9b34[_0x278e7d(0x26e)]['prod_Qty']],_0x53c42c=[..._0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x195)]],_0x3cfaef=[..._0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x222)]],_0x1fde67=[..._0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x198)]],_0x1ade37=[..._0x4b9b34['body'][_0x278e7d(0x1d0)]],_0x478a2b=[..._0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x1df)]],_0x302cf1=[..._0x4b9b34['body']['MaxStocks_data']],_0x1e2e7f=[..._0x4b9b34[_0x278e7d(0x26e)]['batch_code']],_0x3271b4=[..._0x4b9b34[_0x278e7d(0x26e)]['expiry_date']],_0x4aef37=[..._0x4b9b34['body'][_0x278e7d(0x17b)]],_0x5e59ad=[..._0x4b9b34['body'][_0x278e7d(0x214)]],_0x487f5e=[..._0x4b9b34['body'][_0x278e7d(0x1b0)]],_0x304019=[..._0x4b9b34['body'][_0x278e7d(0x216)]],_0x194aa7=[..._0x4b9b34[_0x278e7d(0x26e)]['prod_invoice']];const _0x59bc59=_0x3837d1[_0x278e7d(0x247)](_0x5492c5=>{return _0x5492c5={'product_name':_0x5492c5};});_0x7a6f0c[_0x278e7d(0x1b1)]((_0x3237e7,_0x405b2a)=>{var _0x2eeac8=_0x278e7d;_0x59bc59[_0x405b2a][_0x2eeac8(0x17e)]=_0x3237e7,_0x59bc59[_0x405b2a][_0x2eeac8(0x244)]=_0xe4bf0b;}),_0x1deaec[_0x278e7d(0x1b1)]((_0x406e5b,_0x304301)=>{var _0xd5579b=_0x278e7d;_0x59bc59[_0x304301][_0xd5579b(0x271)]=Math[_0xd5579b(0x186)](_0x406e5b);}),_0x53c42c[_0x278e7d(0x1b1)]((_0x45812f,_0x1548ac)=>{var _0x197b74=_0x278e7d;_0x59bc59[_0x1548ac][_0x197b74(0x249)]=_0x45812f;}),_0x3cfaef[_0x278e7d(0x1b1)]((_0x526893,_0x54a91f)=>{var _0x20c345=_0x278e7d;_0x59bc59[_0x54a91f][_0x20c345(0x1c6)]=_0x526893;}),_0x1fde67['forEach']((_0x111f30,_0xc1b9a3)=>{var _0x26842f=_0x278e7d;_0x59bc59[_0xc1b9a3][_0x26842f(0x26b)]=_0x111f30;}),_0x1ade37[_0x278e7d(0x1b1)]((_0x374f72,_0x413d1f)=>{var _0x1b8a98=_0x278e7d;_0x59bc59[_0x413d1f][_0x1b8a98(0x1d0)]=_0x374f72;}),_0x478a2b[_0x278e7d(0x1b1)]((_0x202dec,_0x427195)=>{var _0x37ab3e=_0x278e7d;_0x59bc59[_0x427195][_0x37ab3e(0x1df)]=_0x202dec;}),_0x302cf1[_0x278e7d(0x1b1)]((_0x86ef05,_0x56ab78)=>{_0x59bc59[_0x56ab78]['maxStocks']=_0x86ef05;}),_0x1e2e7f[_0x278e7d(0x1b1)]((_0x308d51,_0x3d0dca)=>{var _0x5ac983=_0x278e7d;_0x59bc59[_0x3d0dca][_0x5ac983(0x1a6)]=_0x308d51;}),_0x3271b4[_0x278e7d(0x1b1)]((_0x55fc2d,_0x308a9b)=>{_0x59bc59[_0x308a9b]['expiry_date']=_0x55fc2d;}),_0x4aef37['forEach']((_0x1f716d,_0xea8c20)=>{_0x59bc59[_0xea8c20]['production_date']=_0x1f716d;}),_0x5e59ad['forEach']((_0x56bcf2,_0x4c6ad4)=>{_0x59bc59[_0x4c6ad4]['maxperunit']=_0x56bcf2;}),_0x487f5e[_0x278e7d(0x1b1)]((_0x5982d5,_0x5f1cc9)=>{var _0x5795f9=_0x278e7d;_0x59bc59[_0x5f1cc9][_0x5795f9(0x194)]=_0x5982d5;}),_0x304019['forEach']((_0x1d4c1d,_0x1d4e0d)=>{var _0x14269d=_0x278e7d;_0x59bc59[_0x1d4e0d][_0x14269d(0x1d3)]=_0x1d4c1d;}),_0x194aa7[_0x278e7d(0x1b1)]((_0x4dfb66,_0x55a529)=>{var _0x57b142=_0x278e7d;_0x59bc59[_0x55a529][_0x57b142(0x1d7)]=_0x4dfb66;});const _0x11b2e2=_0x59bc59['filter'](_0x3a573d=>_0x3a573d[_0x278e7d(0x271)]!=='0'&&_0x3a573d[_0x278e7d(0x271)]!==''),_0x4a1f09=new purchases_finished({'invoice':_0x5dbb86,'suppliers':_0x4b9b34[_0x278e7d(0x26e)][_0x278e7d(0x223)],'date':_0xe4bf0b,'warehouse_name':_0x32f1d5,'product':_0x11b2e2,'note':_0x5d497e,'due_amount':_0x12068f,'room':_0x105c16,'POnumber':_0x30f4b3,'SCRN':_0x5f34aa,'JO_number':_0x1b344f}),_0x22f0eb=await _0x4a1f09[_0x278e7d(0x193)](),_0x322e47=await purchases_finished[_0x278e7d(0x1e7)]({'invoice':_0x5dbb86}),_0x177e21=_0x322e47[_0x278e7d(0x258)][_0x278e7d(0x247)](async _0x49ce67=>{var _0x5cf32f=_0x278e7d;try{var _0x10bafe=await warehouse['findOne']({'name':_0x32f1d5,'room':_0x49ce67[_0x5cf32f(0x1d3)]}),_0x5a17c2=0x0;const _0x486668=_0x10bafe[_0x5cf32f(0x1f3)][_0x5cf32f(0x247)](_0xa680eb=>{var _0x544ca2=_0x5cf32f;console[_0x544ca2(0x192)](_0xa680eb[_0x544ca2(0x220)]+'=='+_0x49ce67[_0x544ca2(0x220)]+'&&'+_0xa680eb[_0x544ca2(0x26b)]+'=='+_0x49ce67[_0x544ca2(0x26b)]+'&&'+_0xa680eb[_0x544ca2(0x1bf)]+'=='+_0x49ce67[_0x544ca2(0x1bf)]+'&&'+_0xa680eb[_0x544ca2(0x1dd)]+'=='+_0x49ce67[_0x544ca2(0x1dd)]+'&&'+_0xa680eb[_0x544ca2(0x1a6)]+'=='+_0x49ce67[_0x544ca2(0x1a6)]+'&&'+_0xa680eb['invoice']+'=='+_0x322e47[_0x544ca2(0x1d7)]),_0xa680eb[_0x544ca2(0x220)]==_0x49ce67[_0x544ca2(0x220)]&&_0xa680eb[_0x544ca2(0x26b)]==_0x49ce67[_0x544ca2(0x26b)]&&_0xa680eb[_0x544ca2(0x1bf)]==_0x49ce67['expiry_date']&&_0xa680eb['production_date']==_0x49ce67['production_date']&&_0xa680eb[_0x544ca2(0x1a6)]==_0x49ce67[_0x544ca2(0x1a6)]&&_0xa680eb[_0x544ca2(0x1d7)]==_0x322e47[_0x544ca2(0x1d7)]&&(_0xa680eb[_0x544ca2(0x1d1)]=Math['abs'](_0xa680eb[_0x544ca2(0x1d1)])+Math[_0x544ca2(0x186)](_0x49ce67[_0x544ca2(0x271)]),_0x5a17c2++);});return _0x5a17c2==0x0&&(_0x10bafe[_0x5cf32f(0x1f3)]=_0x10bafe[_0x5cf32f(0x1f3)][_0x5cf32f(0x187)]({'product_name':_0x49ce67[_0x5cf32f(0x220)],'product_stock':Math[_0x5cf32f(0x186)](_0x49ce67['quantity']),'primary_code':_0x49ce67['primary_code'],'secondary_code':_0x49ce67[_0x5cf32f(0x1df)],'product_code':_0x49ce67[_0x5cf32f(0x17e)],'bay':_0x49ce67[_0x5cf32f(0x26b)],'maxProducts':_0x49ce67[_0x5cf32f(0x1ca)],'unit':_0x49ce67[_0x5cf32f(0x249)],'secondary_unit':_0x49ce67['secondary_unit'],'expiry_date':_0x49ce67['expiry_date'],'production_date':_0x49ce67[_0x5cf32f(0x1dd)],'maxProducts':_0x49ce67[_0x5cf32f(0x1ca)],'maxPerUnit':_0x49ce67[_0x5cf32f(0x259)],'batch_code':_0x49ce67[_0x5cf32f(0x1a6)],'product_cat':_0x49ce67['product_cat'],'invoice':_0x49ce67[_0x5cf32f(0x1d7)],'id_incoming':_0x49ce67[_0x5cf32f(0x201)],'date_data':_0x49ce67[_0x5cf32f(0x244)]})),_0x10bafe;}catch(_0x81bcaf){return console['error'](_0x5cf32f(0x1e5),_0x81bcaf),null;}});Promise[_0x278e7d(0x1e8)](_0x177e21)[_0x278e7d(0x265)](async _0x30330f=>{var _0x2f8557=_0x278e7d;try{for(const _0x35445d of _0x30330f){await warehouse[_0x2f8557(0x1c8)]({'_id':_0x35445d[_0x2f8557(0x201)]},{'$addToSet':{'product_details':{'$each':_0x35445d[_0x2f8557(0x1f3)]}}});}const _0x1d4eb2=await master_shop[_0x2f8557(0x22e)](),_0xeae6ae=await email_settings[_0x2f8557(0x1e7)](),_0x508983=await supervisor_settings[_0x2f8557(0x22e)]();var _0x5d19eb=_0x322e47[_0x2f8557(0x258)],_0x2bd6e3='',_0x182f0e;for(_0x182f0e in _0x5d19eb){var _0x324bb8='FG';_0x322e47['warehouse_name']==_0x2f8557(0x1d9)&&(_0x324bb8='DG'),_0x2bd6e3+=_0x2f8557(0x253)+_0x2f8557(0x266)+_0x5d19eb[_0x182f0e][_0x2f8557(0x220)]+_0x2f8557(0x211)+_0x2f8557(0x266)+_0x5d19eb[_0x182f0e]['product_code']+_0x2f8557(0x211)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5d19eb[_0x182f0e]['quantity']+'</td>'+_0x2f8557(0x266)+_0x5d19eb[_0x182f0e][_0x2f8557(0x249)]+_0x2f8557(0x211)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5d19eb[_0x182f0e][_0x2f8557(0x1c6)]+'</td>'+_0x2f8557(0x266)+_0x322e47['warehouse_name']+_0x2f8557(0x211)+_0x2f8557(0x266)+_0x5d19eb[_0x182f0e][_0x2f8557(0x1d3)]+_0x2f8557(0x211)+_0x2f8557(0x266)+_0x324bb8+_0x5d19eb[_0x182f0e]['bay']+_0x2f8557(0x211),_0x2f8557(0x241);}let _0x474538=nodemailer[_0x2f8557(0x25a)]({'host':_0xeae6ae[_0x2f8557(0x22f)],'port':Number(_0xeae6ae[_0x2f8557(0x18c)]),'secure':![],'auth':{'user':_0xeae6ae['email'],'pass':_0xeae6ae[_0x2f8557(0x242)]}}),_0xb0dd6f={'from':_0xeae6ae[_0x2f8557(0x228)],'to':_0x508983[0x0]['FGSEmail'],'subject':_0x2f8557(0x20d),'attachments':[{'filename':_0x2f8557(0x231),'path':__dirname+'/../public'+_0x2f8557(0x17f)+_0x1d4eb2[0x0][_0x2f8557(0x177)],'cid':_0x2f8557(0x20c)}],'html':_0x2f8557(0x183)+'<html><head><title></title>'+_0x2f8557(0x23b)+'<div>'+_0x2f8557(0x1f7)+_0x2f8557(0x1a1)+_0x2f8557(0x1c5)+_0x2f8557(0x272)+_0x2f8557(0x1a1)+'<h2>\x20'+_0x1d4eb2[0x0]['site_title']+_0x2f8557(0x21a)+_0x2f8557(0x272)+_0x2f8557(0x272)+'<hr\x20class=\x22my-3\x22>'+_0x2f8557(0x1a1)+_0x2f8557(0x219)+_0x2f8557(0x22a)+_0x322e47['invoice']+'\x20'+_0x2f8557(0x221)+'\x20Order\x20Date\x20:\x20'+_0x322e47[_0x2f8557(0x233)]+'\x20'+_0x2f8557(0x1e0)+_0x2f8557(0x19d)+'</div>'+_0x2f8557(0x256)+_0x2f8557(0x229)+_0x2f8557(0x253)+_0x2f8557(0x234)+_0x2f8557(0x25f)+_0x2f8557(0x1ef)+_0x2f8557(0x18a)+_0x2f8557(0x1a4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x2f8557(0x1a5)+_0x2f8557(0x241)+_0x2f8557(0x25b)+_0x2f8557(0x24f)+'\x20'+_0x2bd6e3+'\x20'+_0x2f8557(0x262)+_0x2f8557(0x1dc)+_0x2f8557(0x1a1)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x1d4eb2[0x0]['site_title']+_0x2f8557(0x19d)+_0x2f8557(0x272)+'</div>'+_0x2f8557(0x213)};_0x474538[_0x2f8557(0x24b)](_0xb0dd6f,function(_0x46a5a3,_0x4344c1){var _0x3f941d=_0x2f8557;_0x46a5a3?(console['log'](_0x46a5a3),console[_0x3f941d(0x192)](_0x3f941d(0x1c4))):console['log'](_0x3f941d(0x21c));});}catch(_0x31e3d6){console['error'](_0x31e3d6),_0x5df036['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x31e3d6[_0x2f8557(0x226)]});}})[_0x278e7d(0x1f4)](_0xfd338b=>{var _0x1db7fc=_0x278e7d;console[_0x1db7fc(0x1fc)](_0xfd338b);}),_0x4b9b34[_0x278e7d(0x236)](_0x278e7d(0x230),_0x278e7d(0x1f2)),_0x5df036[_0x278e7d(0x1b8)](_0x278e7d(0x1f0));}catch(_0x392326){console[_0x278e7d(0x192)](_0x392326);}}),router['get'](a0_0x543a13(0x1f8),auth,async(_0x337561,_0x524e63)=>{var _0x1851ac=a0_0x543a13;try{const {username:_0x28854c,email:_0x55039d,role:_0x12819f}=_0x337561[_0x1851ac(0x248)],_0x20412e=_0x337561[_0x1851ac(0x248)],_0x2fc9f5=await profile[_0x1851ac(0x1e7)]({'email':_0x20412e[_0x1851ac(0x228)]}),_0x2824d5=await master_shop['find'](),_0xf24906=_0x337561[_0x1851ac(0x20e)]['id'],_0x4360a8=await purchases_finished[_0x1851ac(0x254)](_0xf24906),_0x57475d=await suppliers[_0x1851ac(0x22e)]({});let _0x5ce9aa;if(_0x20412e[_0x1851ac(0x24d)]==_0x1851ac(0x1b3)){const _0xf9bdff=await staff[_0x1851ac(0x1e7)]({'email':_0x20412e['email']});_0x5ce9aa=await warehouse[_0x1851ac(0x22e)]({'status':_0x1851ac(0x199),'name':_0xf9bdff[_0x1851ac(0x1ab)],'warehouse_category':'Finished\x20Goods'});}else _0x5ce9aa=await warehouse[_0x1851ac(0x20a)]([{'$match':{'status':_0x1851ac(0x199),'warehouse_category':_0x1851ac(0x1af)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x249e5c=await product['find']({}),_0x38b784=BayBinSelected(_0x4360a8[_0x1851ac(0x207)],_0x4360a8[_0x1851ac(0x1bd)]);let _0x4181e8=new Date(_0x4360a8['expiry_date']),_0x327c3e=('0'+_0x4181e8[_0x1851ac(0x1ac)]())['slice'](-0x2),_0x84be23=('0'+(_0x4181e8[_0x1851ac(0x1d6)]()+0x1))[_0x1851ac(0x263)](-0x2),_0xe92810=_0x4181e8[_0x1851ac(0x260)](),_0x11d93e=_0xe92810+'-'+_0x84be23+'-'+_0x327c3e;if(_0x2824d5[0x0][_0x1851ac(0x1a2)]==_0x1851ac(0x1ee)){var _0xf8ae9b=users[_0x1851ac(0x203)];console['log'](_0xf8ae9b);}else{if(_0x2824d5[0x0][_0x1851ac(0x1a2)]==_0x1851ac(0x1ce))var _0xf8ae9b=users[_0x1851ac(0x1ce)];else{if(_0x2824d5[0x0][_0x1851ac(0x1a2)]=='German')var _0xf8ae9b=users[_0x1851ac(0x23a)];else{if(_0x2824d5[0x0][_0x1851ac(0x1a2)]==_0x1851ac(0x1be))var _0xf8ae9b=users[_0x1851ac(0x1be)];else{if(_0x2824d5[0x0]['language']==_0x1851ac(0x18b))var _0xf8ae9b=users[_0x1851ac(0x18b)];else{if(_0x2824d5[0x0][_0x1851ac(0x1a2)]==_0x1851ac(0x1a9))var _0xf8ae9b=users['Portuguese'];else{if(_0x2824d5[0x0][_0x1851ac(0x1a2)]==_0x1851ac(0x182))var _0xf8ae9b=users[_0x1851ac(0x182)];else{if(_0x2824d5[0x0][_0x1851ac(0x1a2)]==_0x1851ac(0x1d4))var _0xf8ae9b=users[_0x1851ac(0x176)];}}}}}}}_0x524e63['render'](_0x1851ac(0x26a),{'success':_0x337561['flash'](_0x1851ac(0x230)),'errors':_0x337561['flash'](_0x1851ac(0x26d)),'role':_0x20412e,'profile':_0x2fc9f5,'purchases':_0x4360a8,'suppliers':_0x57475d,'warehouse':_0x5ce9aa,'product':_0x249e5c,'master_shop':_0x2824d5,'language':_0xf8ae9b,'ed_fullDate':_0x11d93e,'dataSelected':_0x38b784});}catch(_0x2abd48){console[_0x1851ac(0x192)](_0x2abd48);}}),router[a0_0x543a13(0x202)](a0_0x543a13(0x1e3),auth,async(_0x378179,_0x45bed6)=>{var _0x5edf7c=a0_0x543a13;try{const {username:_0xd7a681,email:_0xbab33d,role:_0x3528a1}=_0x378179[_0x5edf7c(0x248)],_0x50618f=_0x378179[_0x5edf7c(0x248)],_0x2e3088=await profile[_0x5edf7c(0x1e7)]({'email':_0x50618f[_0x5edf7c(0x228)]}),_0x140d6d=await master_shop['find'](),_0x5754a3=_0x378179['params']['id'],_0x536b1c=await purchases_finished['findById'](_0x5754a3),_0x13101f=await suppliers['find']({});let _0x4b8da0;if(_0x50618f['role']==_0x5edf7c(0x1b3)){const _0x4de7e8=await staff[_0x5edf7c(0x1e7)]({'email':_0x50618f[_0x5edf7c(0x228)]});_0x4b8da0=await warehouse['find']({'status':'Enabled','name':_0x4de7e8['warehouse'],'warehouse_category':_0x5edf7c(0x1af)});}else _0x4b8da0=await warehouse[_0x5edf7c(0x20a)]([{'$match':{'status':_0x5edf7c(0x199),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x5edf7c(0x1b5),'name':{'$first':_0x5edf7c(0x1b5)}}}]);const _0x48dc47=await product[_0x5edf7c(0x22e)]({}),_0x5b5d58=BayBinSelected(_0x536b1c[_0x5edf7c(0x207)],_0x536b1c['room']);let _0x4ba66d=new Date(_0x536b1c[_0x5edf7c(0x1bf)]),_0x33f222=('0'+_0x4ba66d[_0x5edf7c(0x1ac)]())[_0x5edf7c(0x263)](-0x2),_0x1e848e=('0'+(_0x4ba66d[_0x5edf7c(0x1d6)]()+0x1))[_0x5edf7c(0x263)](-0x2),_0x38e83a=_0x4ba66d[_0x5edf7c(0x260)](),_0x44099f=_0x38e83a+'-'+_0x1e848e+'-'+_0x33f222;if(_0x140d6d[0x0]['language']==_0x5edf7c(0x1ee)){var _0x333bb5=users[_0x5edf7c(0x203)];console['log'](_0x333bb5);}else{if(_0x140d6d[0x0][_0x5edf7c(0x1a2)]==_0x5edf7c(0x1ce))var _0x333bb5=users['Hindi'];else{if(_0x140d6d[0x0]['language']==_0x5edf7c(0x23a))var _0x333bb5=users['German'];else{if(_0x140d6d[0x0]['language']==_0x5edf7c(0x1be))var _0x333bb5=users[_0x5edf7c(0x1be)];else{if(_0x140d6d[0x0][_0x5edf7c(0x1a2)]=='French')var _0x333bb5=users[_0x5edf7c(0x18b)];else{if(_0x140d6d[0x0]['language']==_0x5edf7c(0x1a9))var _0x333bb5=users[_0x5edf7c(0x1fa)];else{if(_0x140d6d[0x0]['language']==_0x5edf7c(0x182))var _0x333bb5=users['Chinese'];else{if(_0x140d6d[0x0]['language']=='Arabic\x20(ae)')var _0x333bb5=users[_0x5edf7c(0x176)];}}}}}}}_0x45bed6['render'](_0x5edf7c(0x1c9),{'success':_0x378179[_0x5edf7c(0x236)](_0x5edf7c(0x230)),'errors':_0x378179['flash'](_0x5edf7c(0x26d)),'role':_0x50618f,'profile':_0x2e3088,'purchases':_0x536b1c,'suppliers':_0x13101f,'warehouse':_0x4b8da0,'product':_0x48dc47,'master_shop':_0x140d6d,'language':_0x333bb5,'ed_fullDate':_0x44099f,'dataSelected':_0x5b5d58});}catch(_0x35db1d){console[_0x5edf7c(0x192)](_0x35db1d);}}),router[a0_0x543a13(0x1d8)]('/view/:id',auth,async(_0x327016,_0x23a7a1)=>{var _0x4e5be3=a0_0x543a13;try{const _0x27f582=_0x327016['params']['id'],_0x25ac00=await purchases_finished[_0x4e5be3(0x1e7)]({'_id':_0x327016[_0x4e5be3(0x20e)]['id']}),_0x196735=await warehouse[_0x4e5be3(0x1e7)]({'name':_0x25ac00[_0x4e5be3(0x207)],'room':_0x25ac00[_0x4e5be3(0x1bd)]});_0x25ac00['product']['forEach'](_0x564330=>{var _0x5c9281=_0x4e5be3;const _0x3a931e=_0x196735[_0x5c9281(0x1f3)][_0x5c9281(0x247)](_0x4ddc19=>{var _0x412439=_0x5c9281;_0x4ddc19[_0x412439(0x220)]==_0x564330['product_name']&&_0x4ddc19[_0x412439(0x26b)]==_0x564330['bay']&&(_0x4ddc19[_0x412439(0x1d1)]=parseInt(_0x4ddc19['product_stock'])-parseInt(_0x564330[_0x412439(0x271)]));});}),await _0x196735[_0x4e5be3(0x193)]();const {invoice:_0x432e60,suppliers:_0xf3c552,date:_0x9842b9,warehouse_name:_0x54596a,prod_name:_0x5ade87,prod_code:_0xa9c5de,prod_qty:_0x460c48,prod_unit:_0x34d8ec,prod_secondunit:_0x233a9d,prod_level:_0x8b285,prod_isle:_0x80501b,prod_pallet:_0xb6a016,note:_0x4392f6,expiry_date:_0x175138,batch_code:_0x3b9ce7,paid_amount:_0x4fc1e0,due_amount:_0x58c801,Room_name:_0x1f54b9,primary_code:_0x5c818d,secondary_code:_0x3b7d27,PO_number:_0x18721b,JO_number:_0x41f1c1}=_0x327016[_0x4e5be3(0x26e)];if(typeof _0x5ade87==_0x4e5be3(0x1b6))var _0x1cdaab=[_0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x1a7)]],_0x23a8b0=[_0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x1fb)]],_0x2a3ab0=[_0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x238)]],_0x31a0bd=[_0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x1da)]],_0x25d391=[_0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x222)]],_0x7c844d=[_0x327016['body'][_0x4e5be3(0x198)]],_0x15585a=[_0x327016['body']['primary_code']],_0x5c6efd=[_0x327016[_0x4e5be3(0x26e)]['secondary_code']],_0x477f09=[_0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x190)]],_0x331e49=[_0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x1a6)]],_0x385313=[_0x327016['body'][_0x4e5be3(0x1bf)]];else var _0x1cdaab=[..._0x327016[_0x4e5be3(0x26e)]['prod_name']],_0x23a8b0=[..._0x327016['body']['prod_code']],_0x2a3ab0=[..._0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x238)]],_0x31a0bd=[..._0x327016['body'][_0x4e5be3(0x1da)]],_0x25d391=[..._0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x222)]],_0x7c844d=[..._0x327016['body']['prod_level']],_0x15585a=[..._0x327016['body'][_0x4e5be3(0x1d0)]],_0x5c6efd=[..._0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x1df)]],_0x477f09=[..._0x327016['body'][_0x4e5be3(0x190)]],_0x331e49=[..._0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x1a6)]],_0x385313=[..._0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x1bf)]];const _0x4a8b86=_0x1cdaab['map'](_0xd6529e=>{return _0xd6529e={'product_name':_0xd6529e};});_0x23a8b0[_0x4e5be3(0x1b1)]((_0x33d3a8,_0x4d15df)=>{_0x4a8b86[_0x4d15df]['product_code']=_0x33d3a8;}),_0x2a3ab0[_0x4e5be3(0x1b1)]((_0x276062,_0x1a467d)=>{_0x4a8b86[_0x1a467d]['quantity']=_0x276062;}),_0x31a0bd[_0x4e5be3(0x1b1)]((_0x5f3cc8,_0x56a918)=>{var _0x33a358=_0x4e5be3;_0x4a8b86[_0x56a918][_0x33a358(0x249)]=_0x5f3cc8;}),_0x25d391[_0x4e5be3(0x1b1)]((_0x346fe6,_0x45650a)=>{var _0x7bd3de=_0x4e5be3;_0x4a8b86[_0x45650a][_0x7bd3de(0x1c6)]=_0x346fe6;}),_0x7c844d[_0x4e5be3(0x1b1)]((_0x64662b,_0x588a4)=>{_0x4a8b86[_0x588a4]['bay']=_0x64662b;}),_0x15585a[_0x4e5be3(0x1b1)]((_0x137008,_0x5be6ab)=>{var _0x9573b1=_0x4e5be3;_0x4a8b86[_0x5be6ab][_0x9573b1(0x1d0)]=_0x137008;}),_0x5c6efd[_0x4e5be3(0x1b1)]((_0x2c21dc,_0x3d768c)=>{var _0x1578f7=_0x4e5be3;_0x4a8b86[_0x3d768c][_0x1578f7(0x1df)]=_0x2c21dc;}),_0x477f09[_0x4e5be3(0x1b1)]((_0x1a92bb,_0x1c9176)=>{_0x4a8b86[_0x1c9176]['maxStocks']=_0x1a92bb;}),_0x331e49['forEach']((_0x338872,_0x54e558)=>{var _0x5e07ef=_0x4e5be3;_0x4a8b86[_0x54e558][_0x5e07ef(0x1a6)]=_0x338872;}),_0x385313[_0x4e5be3(0x1b1)]((_0xe29612,_0x10956a)=>{_0x4a8b86[_0x10956a]['expiry_date']=_0xe29612;});const _0xed0529=_0x4a8b86[_0x4e5be3(0x1fd)](_0x3c6f7e=>_0x3c6f7e['quantity']!=='0'&&_0x3c6f7e[_0x4e5be3(0x271)]!=='');_0x25ac00[_0x4e5be3(0x1d7)]=_0x432e60,_0x25ac00[_0x4e5be3(0x223)]=_0xf3c552,_0x25ac00[_0x4e5be3(0x233)]=_0x9842b9,_0x25ac00['warehouse_name']=_0x54596a,_0x25ac00[_0x4e5be3(0x258)]=_0xed0529,_0x25ac00[_0x4e5be3(0x19c)]=_0x4392f6,_0x25ac00['paid_amount']=_0x4fc1e0,_0x25ac00['due_amount']=_0x58c801,_0x25ac00['room']=_0x1f54b9,_0x25ac00['POnumber']=_0x18721b,_0x25ac00[_0x4e5be3(0x232)]=_0x41f1c1;const _0x28e005=await _0x25ac00[_0x4e5be3(0x193)](),_0x5c0f7f=await warehouse[_0x4e5be3(0x1e7)]({'name':_0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x207)],'room':_0x327016[_0x4e5be3(0x26e)]['Room_name']});_0x25ac00['product'][_0x4e5be3(0x1b1)](_0x4f4e58=>{var _0x468a8e=_0x4e5be3,_0x5bc61d=0x0;const _0x12182a=_0x5c0f7f['product_details'][_0x468a8e(0x247)](_0x4f5f79=>{var _0x33e8a3=_0x468a8e;_0x4f5f79[_0x33e8a3(0x220)]==_0x4f4e58[_0x33e8a3(0x220)]&&_0x4f5f79[_0x33e8a3(0x26b)]==_0x4f4e58[_0x33e8a3(0x26b)]&&(_0x4f5f79['product_stock']=parseInt(_0x4f5f79[_0x33e8a3(0x1d1)])+parseInt(_0x4f4e58['quantity']),_0x5bc61d++);});_0x5bc61d=='0'&&(_0x5c0f7f[_0x468a8e(0x1f3)]=_0x5c0f7f[_0x468a8e(0x1f3)][_0x468a8e(0x187)]({'product_name':_0x4f4e58[_0x468a8e(0x220)],'product_stock':_0x4f4e58[_0x468a8e(0x271)],'primary_code':_0x4f4e58[_0x468a8e(0x1d0)],'secondary_code':_0x4f4e58[_0x468a8e(0x1df)],'product_code':_0x4f4e58['product_code'],'bay':_0x4f4e58['bay'],'maxProducts':_0x4f4e58[_0x468a8e(0x1ca)],'unit':_0x4f4e58[_0x468a8e(0x249)],'secondary_unit':_0x4f4e58[_0x468a8e(0x1c6)],'expiry_date':_0x4f4e58[_0x468a8e(0x1bf)]}));}),await _0x5c0f7f['save']();const _0x3a8780=await s_payment_data['findOne']({'invoice':_0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x1d7)]});if(_0x3a8780===null){}else console[_0x4e5be3(0x192)](_0x4e5be3(0x223),_0x3a8780,_0x327016[_0x4e5be3(0x26e)][_0x4e5be3(0x1d7)]),_0x3a8780[_0x4e5be3(0x223)]=_0x327016[_0x4e5be3(0x26e)]['suppliers'],await _0x3a8780[_0x4e5be3(0x193)]();_0x327016[_0x4e5be3(0x236)]('success',_0x4e5be3(0x1e2)),_0x23a7a1[_0x4e5be3(0x1b8)]('/all_purchases_finished/view');}catch(_0x1efadb){console[_0x4e5be3(0x192)](_0x1efadb);}}),router[a0_0x543a13(0x1d8)](a0_0x543a13(0x25c),auth,async(_0x150775,_0x4acd51)=>{var _0x4d5720=a0_0x543a13;try{const _0x27d32d=_0x150775[_0x4d5720(0x20e)]['id'],{invoice:_0x16b3b4,suppliers:_0x3218bc,payable:_0x10165,due_amount:_0x487573}=_0x150775['body'],_0x125b64=await purchases['findById'](_0x27d32d);var _0x510314=_0x10165-_0x487573;_0x125b64[_0x4d5720(0x235)]=parseFloat(_0x125b64[_0x4d5720(0x235)])+parseFloat(_0x487573),_0x125b64[_0x4d5720(0x1c7)]=_0x510314;const _0x1faa0d=await _0x125b64[_0x4d5720(0x193)]();console['log'](_0x1faa0d);const _0x5d40f6=await s_payment_data[_0x4d5720(0x1e7)]({'invoice':_0x16b3b4});_0x5d40f6['amount']=_0x510314,await _0x5d40f6[_0x4d5720(0x193)]();let _0x2b86b1=new Date(),_0x451d4c=('0'+_0x2b86b1[_0x4d5720(0x1ac)]())[_0x4d5720(0x263)](-0x2),_0x2498e2=('0'+(_0x2b86b1[_0x4d5720(0x1d6)]()+0x1))[_0x4d5720(0x263)](-0x2),_0x4189a8=_0x2b86b1[_0x4d5720(0x260)](),_0x33b305=_0x4189a8+'-'+_0x2498e2+'-'+_0x451d4c;const _0x6146d5=new suppliers_payment({'invoice':_0x16b3b4,'date':_0x4189a8+'-'+_0x2498e2+'-'+_0x451d4c,'suppliers':_0x3218bc,'reason':_0x4d5720(0x209),'amount':_0x487573}),_0x28c958=await _0x6146d5[_0x4d5720(0x193)]();_0x150775[_0x4d5720(0x236)](_0x4d5720(0x230),'payment\x20successfull'),_0x4acd51['redirect'](_0x4d5720(0x19e));}catch(_0x4e9beb){console[_0x4d5720(0x192)](_0x4e9beb);}}),router[a0_0x543a13(0x202)]('/invoice/:id',auth,async(_0x5761a7,_0x4aef11)=>{var _0x1c6ed4=a0_0x543a13;try{const {username:_0x5359c5,email:_0x14e8a9,role:_0xa4c91}=_0x5761a7['user'],_0x16a817=_0x5761a7[_0x1c6ed4(0x248)],_0x3f0bbc=await profile[_0x1c6ed4(0x1e7)]({'email':_0x16a817[_0x1c6ed4(0x228)]}),_0x1ea695=await master_shop[_0x1c6ed4(0x22e)]();console[_0x1c6ed4(0x192)]('master',_0x1ea695);const _0x512d13=_0x5761a7[_0x1c6ed4(0x20e)]['id'],_0x57fa3a=await purchases[_0x1c6ed4(0x254)](_0x512d13);console['log'](_0x57fa3a);const _0xe372e8=await suppliers[_0x1c6ed4(0x1e7)]({'name':_0x57fa3a[_0x1c6ed4(0x223)]});console[_0x1c6ed4(0x192)](_0xe372e8);if(_0x1ea695[0x0]['language']=='English\x20(US)'){var _0xa98b8b=users[_0x1c6ed4(0x203)];console[_0x1c6ed4(0x192)](_0xa98b8b);}else{if(_0x1ea695[0x0][_0x1c6ed4(0x1a2)]=='Hindi')var _0xa98b8b=users[_0x1c6ed4(0x1ce)];else{if(_0x1ea695[0x0][_0x1c6ed4(0x1a2)]==_0x1c6ed4(0x23a))var _0xa98b8b=users[_0x1c6ed4(0x23a)];else{if(_0x1ea695[0x0][_0x1c6ed4(0x1a2)]==_0x1c6ed4(0x1be))var _0xa98b8b=users[_0x1c6ed4(0x1be)];else{if(_0x1ea695[0x0][_0x1c6ed4(0x1a2)]==_0x1c6ed4(0x18b))var _0xa98b8b=users[_0x1c6ed4(0x18b)];else{if(_0x1ea695[0x0][_0x1c6ed4(0x1a2)]==_0x1c6ed4(0x1a9))var _0xa98b8b=users[_0x1c6ed4(0x1fa)];else{if(_0x1ea695[0x0]['language']==_0x1c6ed4(0x182))var _0xa98b8b=users['Chinese'];else{if(_0x1ea695[0x0][_0x1c6ed4(0x1a2)]==_0x1c6ed4(0x1d4))var _0xa98b8b=users[_0x1c6ed4(0x176)];}}}}}}}_0x4aef11[_0x1c6ed4(0x24a)](_0x1c6ed4(0x210),{'success':_0x5761a7['flash'](_0x1c6ed4(0x230)),'errors':_0x5761a7['flash'](_0x1c6ed4(0x26d)),'role':_0x16a817,'profile':_0x3f0bbc,'master_shop':_0x1ea695,'supplier':_0xe372e8,'purchase':_0x57fa3a,'language':_0xa98b8b});}catch(_0x3b08f4){console[_0x1c6ed4(0x192)](_0x3b08f4);}}),router[a0_0x543a13(0x202)](a0_0x543a13(0x1cc),auth,async(_0x1a753a,_0x55dfe8)=>{var _0x1d91f4=a0_0x543a13;try{const {username:_0x282167,email:_0x1e4f55,role:_0xccc1f3}=_0x1a753a[_0x1d91f4(0x248)],_0x12f209=_0x1a753a[_0x1d91f4(0x248)],_0x6b963b=await profile[_0x1d91f4(0x1e7)]({'email':_0x12f209['email']}),_0x36e80b=await master_shop[_0x1d91f4(0x22e)]();console[_0x1d91f4(0x192)](_0x1d91f4(0x17c),_0x36e80b);const _0x24f730=_0x1a753a['params']['id'];console['log'](_0x24f730);const _0x45bab5=await purchases_finished['findById'](_0x24f730);console['log'](_0x1d91f4(0x18f),_0x45bab5);const _0x36531c=await product[_0x1d91f4(0x22e)]({}),_0x1d5377=await warehouse[_0x1d91f4(0x20a)]([{'$match':{'name':_0x45bab5[_0x1d91f4(0x207)],'room':_0x45bab5[_0x1d91f4(0x1bd)]}},{'$unwind':_0x1d91f4(0x24e)},{'$group':{'_id':_0x1d91f4(0x268),'name':{'$first':_0x1d91f4(0x17d)},'product_stock':{'$first':_0x1d91f4(0x1eb)},'bay':{'$first':_0x1d91f4(0x26c)},'bin':{'$first':_0x1d91f4(0x25d)},'type':{'$first':_0x1d91f4(0x22c)},'floorlevel':{'$first':_0x1d91f4(0x1ea)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1d91f4(0x23e)},'product_code':{'$first':_0x1d91f4(0x205)},'storage':{'$first':_0x1d91f4(0x178)},'rack':{'$first':_0x1d91f4(0x267)}}}]);console[_0x1d91f4(0x192)](_0x1d91f4(0x1c3),_0x1d5377);let _0x7f8cee;if(_0x12f209[_0x1d91f4(0x24d)]==_0x1d91f4(0x1b3)){const _0x12031c=await staff[_0x1d91f4(0x1e7)]({'email':_0x12f209[_0x1d91f4(0x228)]});_0x7f8cee=await warehouse[_0x1d91f4(0x22e)]({'status':_0x1d91f4(0x199),'name':_0x12031c['warehouse'],'warehouse_category':_0x1d91f4(0x1af),'name':_0x1d91f4(0x26f)});}else _0x7f8cee=await warehouse[_0x1d91f4(0x20a)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':_0x1d91f4(0x26f)}},{'$group':{'_id':_0x1d91f4(0x1b5),'name':{'$first':'$name'}}}]);if(_0x36e80b[0x0][_0x1d91f4(0x1a2)]=='English\x20(US)'){var _0x183e60=users[_0x1d91f4(0x203)];console[_0x1d91f4(0x192)](_0x183e60);}else{if(_0x36e80b[0x0][_0x1d91f4(0x1a2)]==_0x1d91f4(0x1ce))var _0x183e60=users[_0x1d91f4(0x1ce)];else{if(_0x36e80b[0x0][_0x1d91f4(0x1a2)]==_0x1d91f4(0x23a))var _0x183e60=users[_0x1d91f4(0x23a)];else{if(_0x36e80b[0x0]['language']==_0x1d91f4(0x1be))var _0x183e60=users[_0x1d91f4(0x1be)];else{if(_0x36e80b[0x0][_0x1d91f4(0x1a2)]=='French')var _0x183e60=users[_0x1d91f4(0x18b)];else{if(_0x36e80b[0x0][_0x1d91f4(0x1a2)]==_0x1d91f4(0x1a9))var _0x183e60=users[_0x1d91f4(0x1fa)];else{if(_0x36e80b[0x0][_0x1d91f4(0x1a2)]==_0x1d91f4(0x182))var _0x183e60=users[_0x1d91f4(0x182)];else{if(_0x36e80b[0x0][_0x1d91f4(0x1a2)]==_0x1d91f4(0x1d4))var _0x183e60=users[_0x1d91f4(0x176)];}}}}}}}_0x55dfe8['render'](_0x1d91f4(0x204),{'success':_0x1a753a[_0x1d91f4(0x236)](_0x1d91f4(0x230)),'errors':_0x1a753a['flash'](_0x1d91f4(0x26d)),'role':_0x12f209,'profile':_0x6b963b,'user':_0x45bab5,'stock':_0x1d5377,'master_shop':_0x36e80b,'product':_0x36531c,'language':_0x183e60,'warehouse':_0x7f8cee});}catch(_0x41edf9){console['log'](_0x41edf9);}}),router[a0_0x543a13(0x1d8)](a0_0x543a13(0x1cc),auth,async(_0x5659df,_0x1eaa3f)=>{var _0x5e7312=a0_0x543a13;try{const {invoice:_0x3715f6,date:_0x2d8508,warehouse_name:_0x2e8e9f,Room_name:_0x5e0c89,product_name:_0x2f2fb4,purchase_quantity:_0xf8863d,stocks:_0x2b4729,return_qty:_0x40dbb0,note:_0x14170c,level:_0x5581fe,isle:_0x14655c,pallet:_0x4660c1,to_warehouse_name:_0x4a1866,to_Room_name:_0x52ca48}=_0x5659df[_0x5e7312(0x26e)],_0x18013b=await purchases_finished[_0x5e7312(0x1e7)]({'_id':_0x5659df[_0x5e7312(0x20e)]['id']}),_0x582f3e=await warehouse[_0x5e7312(0x1e7)]({'name':_0x2e8e9f,'room':_0x5e0c89,'warehouse_category':_0x5e7312(0x1af)});if(typeof _0x2f2fb4==_0x5e7312(0x1b6))var _0x3b1bd2=[_0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x220)]],_0x71be3f=[_0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x23d)]],_0xe36583=[_0x5659df['body']['stocks']],_0x55dc79=[_0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x224)]],_0x2db126=[_0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x1e9)]],_0x481ed9=[_0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x1cf)]],_0x50ba89=[_0x5659df['body']['primary_code_hide']],_0x1e259e=[_0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x23f)]];else var _0x3b1bd2=[..._0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x220)]],_0x71be3f=[..._0x5659df[_0x5e7312(0x26e)]['purchase_quantity']],_0xe36583=[..._0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x212)]],_0x55dc79=[..._0x5659df['body'][_0x5e7312(0x224)]],_0x2db126=[..._0x5659df['body'][_0x5e7312(0x1e9)]],_0x481ed9=[..._0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x1cf)]],_0x50ba89=[..._0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x23c)]],_0x1e259e=[..._0x5659df['body'][_0x5e7312(0x23f)]];const _0x2bb152=_0x3b1bd2['map'](_0x2137bf=>{return _0x2137bf={'product_name':_0x2137bf};});_0x71be3f['forEach']((_0x39815c,_0x4b16dd)=>{var _0x3ad5cf=_0x5e7312;_0x2bb152[_0x4b16dd][_0x3ad5cf(0x23d)]=_0x39815c;}),_0xe36583[_0x5e7312(0x1b1)]((_0x508555,_0x816231)=>{_0x2bb152[_0x816231]['stock_quantity']=_0x508555;}),_0x55dc79[_0x5e7312(0x1b1)]((_0x282873,_0x1ca1b7)=>{var _0x52d3f9=_0x5e7312;_0x2bb152[_0x1ca1b7][_0x52d3f9(0x224)]=_0x282873;}),_0x2db126[_0x5e7312(0x1b1)]((_0xb2f76d,_0x1e7b3f)=>{var _0xc91cae=_0x5e7312;_0x2bb152[_0x1e7b3f][_0xc91cae(0x26b)]=_0xb2f76d;}),_0x481ed9[_0x5e7312(0x1b1)]((_0x43a790,_0x2446db)=>{var _0x3c540a=_0x5e7312;_0x2bb152[_0x2446db][_0x3c540a(0x17e)]=_0x43a790;}),_0x50ba89[_0x5e7312(0x1b1)]((_0x4721d4,_0x58e8e8)=>{var _0x153170=_0x5e7312;_0x2bb152[_0x58e8e8][_0x153170(0x1d0)]=_0x4721d4;}),_0x1e259e[_0x5e7312(0x1b1)]((_0x53ccb7,_0x5b82c8)=>{var _0x1aa60b=_0x5e7312;_0x2bb152[_0x5b82c8][_0x1aa60b(0x1df)]=_0x53ccb7;}),_0x2bb152[_0x5e7312(0x1b1)](_0x365fc1=>{var _0x2e810d=_0x5e7312;console[_0x2e810d(0x192)](_0x365fc1);const _0x377e3d=_0x582f3e[_0x2e810d(0x1f3)]['map'](_0x4bd1da=>{var _0x59f993=_0x2e810d;_0x4bd1da['product_name']==_0x365fc1['product_name']&&_0x4bd1da[_0x59f993(0x26b)]==_0x365fc1[_0x59f993(0x26b)]&&(console[_0x59f993(0x192)](parseInt(_0x4bd1da['product_stock'])+_0x59f993(0x1ed)+parseInt(_0x365fc1['return_qty'])),_0x4bd1da[_0x59f993(0x1d1)]=parseInt(_0x4bd1da['product_stock'])-parseInt(_0x365fc1[_0x59f993(0x224)]));});}),await _0x582f3e[_0x5e7312(0x193)]();var _0x31738a=0x0;_0x2bb152[_0x5e7312(0x1b1)](_0x3188f8=>{var _0x5609d3=_0x5e7312;(parseInt(_0x3188f8[_0x5609d3(0x23d)])<parseInt(_0x3188f8[_0x5609d3(0x224)])||parseInt(_0x3188f8['stock_quantity'])<parseInt(_0x3188f8[_0x5609d3(0x224)]))&&_0x31738a++;});if(_0x31738a!=0x0)return _0x5659df[_0x5e7312(0x236)]('errors',_0x5e7312(0x252)),_0x1eaa3f[_0x5e7312(0x1b8)](_0x5e7312(0x270));const _0x44f13=new purchases_return_finished({'invoice':_0x3715f6,'suppliers':_0x5659df[_0x5e7312(0x26e)]['suppliers'],'date':_0x2d8508,'warehouse_name':_0x2e8e9f,'return_product':_0x2bb152,'note':_0x14170c,'room':_0x5e0c89,'to_warehouse_name':_0x4a1866,'to_room':_0x52ca48}),_0x178fe5=await _0x44f13['save'](),_0x1cf1ee=await purchases_return_finished[_0x5e7312(0x1e7)]({'invoice':_0x3715f6}),_0x3a9a89=await warehouse[_0x5e7312(0x1e7)]({'name':_0x4a1866,'room':_0x52ca48,'warehouse_category':_0x5e7312(0x1af)});_0x1cf1ee[_0x5e7312(0x257)][_0x5e7312(0x1b1)](_0x39c572=>{var _0x3b1704=_0x5e7312,_0x4860ee=0x0;const _0x336d1e=_0x3a9a89[_0x3b1704(0x1f3)][_0x3b1704(0x247)](_0x3ed333=>{var _0x52b481=_0x3b1704;console['log'](_0x3ed333['product_name']+'=='+_0x39c572[_0x52b481(0x220)]+'&&'+_0x3ed333[_0x52b481(0x26b)]+'=='+_0x39c572[_0x52b481(0x26b)]),_0x3ed333['product_name']==_0x39c572[_0x52b481(0x220)]&&_0x3ed333[_0x52b481(0x26b)]==_0x39c572['bay']&&(_0x3ed333[_0x52b481(0x1d1)]=parseInt(_0x3ed333[_0x52b481(0x1d1)])-parseInt(_0x39c572[_0x52b481(0x224)]),_0x4860ee++);});_0x4860ee=='0'&&(_0x3a9a89['product_details']=_0x3a9a89['product_details']['concat']({'product_name':_0x39c572['product_name'],'product_stock':_0x39c572[_0x3b1704(0x224)],'primary_code':_0x39c572['primary_code'],'secondary_code':_0x39c572[_0x3b1704(0x1df)],'product_code':_0x39c572[_0x3b1704(0x17e)],'bay':_0x39c572[_0x3b1704(0x26b)],'maxProducts':0xf423f}));}),await _0x3a9a89[_0x5e7312(0x193)]();const _0x4bb864=await purchases_finished['findOne']({'invoice':_0x3715f6});_0x4bb864[_0x5e7312(0x21d)]='True';const _0x395090=await _0x4bb864[_0x5e7312(0x193)](),_0x45f7fa=new s_payment_data({'invoice':_0x3715f6,'suppliers':_0x5659df[_0x5e7312(0x26e)]['suppliers'],'reason':_0x5e7312(0x19a)});await _0x45f7fa[_0x5e7312(0x193)]();const _0x43f551=await master_shop[_0x5e7312(0x22e)](),_0x5d62cb=await email_settings[_0x5e7312(0x1e7)](),_0x5b5028=await suppliers[_0x5e7312(0x1e7)]({'name':_0x5659df[_0x5e7312(0x26e)][_0x5e7312(0x223)]});_0x43f551[0x0]['currency_placement']==0x1?(right_currency=_0x43f551[0x0][_0x5e7312(0x188)],left_currency=''):(right_currency='',left_currency=_0x43f551[0x0][_0x5e7312(0x188)]);var _0x5d5f0b=_0x3b1bd2,_0x13db31=_0x55dc79,_0x10132c='',_0xc5fa85;for(_0xc5fa85 in _0x5d5f0b){_0x10132c+=_0x5e7312(0x253)+_0x5e7312(0x266)+_0x5d5f0b[_0xc5fa85]+'</td>'+_0x5e7312(0x266)+_0x13db31[_0xc5fa85]+_0x5e7312(0x211)+_0x5e7312(0x241);}let _0x2a35fb=nodemailer[_0x5e7312(0x25a)]({'service':_0x5e7312(0x1f5),'auth':{'user':_0x5d62cb[_0x5e7312(0x228)],'pass':_0x5d62cb[_0x5e7312(0x242)]}}),_0x4718cf={'from':_0x5d62cb[_0x5e7312(0x228)],'to':_0x5b5028[_0x5e7312(0x228)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x5e7312(0x261)+_0x5e7312(0x17f)+_0x43f551[0x0]['image'],'cid':_0x5e7312(0x20c)}],'html':_0x5e7312(0x183)+_0x5e7312(0x21f)+_0x5e7312(0x23b)+_0x5e7312(0x1a1)+_0x5e7312(0x1f7)+'<div>'+_0x5e7312(0x1c5)+_0x5e7312(0x272)+_0x5e7312(0x1a1)+_0x5e7312(0x1f1)+_0x43f551[0x0][_0x5e7312(0x269)]+'\x20</h2>'+_0x5e7312(0x272)+_0x5e7312(0x272)+'<hr\x20class=\x22my-3\x22>'+_0x5e7312(0x1a1)+_0x5e7312(0x219)+'\x20Order\x20Number\x20:\x20'+_0x3715f6+'\x20'+_0x5e7312(0x221)+'\x20Order\x20Date\x20:\x20'+_0x2d8508+'\x20'+_0x5e7312(0x1e0)+_0x5e7312(0x19d)+_0x5e7312(0x272)+_0x5e7312(0x256)+_0x5e7312(0x229)+_0x5e7312(0x253)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5e7312(0x1ec)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x5e7312(0x1c1)+_0x5e7312(0x241)+'</thead>'+_0x5e7312(0x24f)+'\x20'+_0x10132c+'\x20'+'</tbody>'+_0x5e7312(0x1dc)+'<div>'+_0x5e7312(0x264)+_0x5e7312(0x180)+_0x43f551[0x0][_0x5e7312(0x269)]+_0x5e7312(0x19d)+'</div>'+_0x5e7312(0x272)+'</body></html>'};_0x2a35fb[_0x5e7312(0x24b)](_0x4718cf,function(_0x266efa,_0x1921e3){var _0x98bae=_0x5e7312;_0x266efa?console[_0x98bae(0x192)](_0x98bae(0x1c4)):console[_0x98bae(0x192)](_0x98bae(0x21c));}),_0x5659df[_0x5e7312(0x236)](_0x5e7312(0x230),_0x5e7312(0x19b)),_0x1eaa3f[_0x5e7312(0x1b8)](_0x5e7312(0x1f0));}catch(_0x4e3aff){_0x1eaa3f['status'](0xc8)[_0x5e7312(0x217)]({'message':_0x4e3aff['message']});}}),router['get']('/barcode/:id',auth,async(_0x2d74c9,_0x3fec4b)=>{var _0xa588dd=a0_0x543a13;try{const {username:_0x9252e0,email:_0x4760b4,role:_0x50ea4c}=_0x2d74c9[_0xa588dd(0x248)],_0x5aab6a=_0x2d74c9[_0xa588dd(0x248)],_0x44d189=await profile['findOne']({'email':_0x5aab6a[_0xa588dd(0x228)]}),_0x1bfbdb=await master_shop['find'](),_0x3044cd=_0x2d74c9[_0xa588dd(0x20e)]['id'],_0xe207e3=await purchases_finished[_0xa588dd(0x254)](_0x3044cd);if(_0x1bfbdb[0x0]['language']==_0xa588dd(0x1ee))var _0x2443ca=users[_0xa588dd(0x203)];else{if(_0x1bfbdb[0x0]['language']==_0xa588dd(0x1ce))var _0x2443ca=users[_0xa588dd(0x1ce)];else{if(_0x1bfbdb[0x0][_0xa588dd(0x1a2)]==_0xa588dd(0x23a))var _0x2443ca=users[_0xa588dd(0x23a)];else{if(_0x1bfbdb[0x0][_0xa588dd(0x1a2)]==_0xa588dd(0x1be))var _0x2443ca=users[_0xa588dd(0x1be)];else{if(_0x1bfbdb[0x0][_0xa588dd(0x1a2)]==_0xa588dd(0x18b))var _0x2443ca=users[_0xa588dd(0x18b)];else{if(_0x1bfbdb[0x0][_0xa588dd(0x1a2)]==_0xa588dd(0x1a9))var _0x2443ca=users[_0xa588dd(0x1fa)];else{if(_0x1bfbdb[0x0][_0xa588dd(0x1a2)]==_0xa588dd(0x182))var _0x2443ca=users['Chinese'];else{if(_0x1bfbdb[0x0]['language']=='Arabic\x20(ae)')var _0x2443ca=users['Arabic'];}}}}}}}_0x3fec4b[_0xa588dd(0x24a)]('all_purchases_barcode',{'success':_0x2d74c9[_0xa588dd(0x236)](_0xa588dd(0x230)),'errors':_0x2d74c9[_0xa588dd(0x236)](_0xa588dd(0x26d)),'role':_0x5aab6a,'profile':_0x44d189,'alldata':_0xe207e3,'master_shop':_0x1bfbdb,'language':_0x2443ca}),console[_0xa588dd(0x192)](alldata);}catch(_0x1162c3){console[_0xa588dd(0x192)](_0x1162c3);}}),router[a0_0x543a13(0x1d8)]('/barcode_scanner',async(_0x41ce59,_0x11f220)=>{var _0x3fc468=a0_0x543a13;const {product_code:_0x3d6778}=_0x41ce59[_0x3fc468(0x26e)];var _0x5bb2ac;const _0x32cb12=await product[_0x3fc468(0x20a)]([{'$match':{'primary_code':_0x3d6778,'product_category':'Finished\x20Goods'}},{'$group':{'_id':_0x3fc468(0x196),'name':{'$first':_0x3fc468(0x1b5)},'category':{'$first':_0x3fc468(0x1d2)},'brand':{'$first':_0x3fc468(0x237)},'unit':{'$first':_0x3fc468(0x1cd)},'alertquantity':{'$first':_0x3fc468(0x215)},'product_code':{'$first':_0x3fc468(0x208)},'primary_code':{'$first':_0x3fc468(0x185)},'secondary_code':{'$first':_0x3fc468(0x1d5)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3fc468(0x1ae)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x259699=await product[_0x3fc468(0x20a)]([{'$match':{'secondary_code':_0x3d6778}},{'$group':{'_id':_0x3fc468(0x196),'name':{'$first':_0x3fc468(0x1b5)},'category':{'$first':_0x3fc468(0x1d2)},'brand':{'$first':_0x3fc468(0x237)},'unit':{'$first':_0x3fc468(0x1cd)},'alertquantity':{'$first':_0x3fc468(0x215)},'product_code':{'$first':_0x3fc468(0x208)},'primary_code':{'$first':_0x3fc468(0x185)},'secondary_code':{'$first':_0x3fc468(0x1d5)},'maxStocks':{'$first':_0x3fc468(0x1e4)},'maxProdPerUnit':{'$first':_0x3fc468(0x1cb)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3fc468(0x1ae)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x32cb12['length']>0x0)_0x5bb2ac=_0x32cb12;else _0x259699[_0x3fc468(0x243)]>0x0&&(_0x5bb2ac=_0x259699);_0x11f220[_0x3fc468(0x217)](_0x5bb2ac);}),router[a0_0x543a13(0x1d8)](a0_0x543a13(0x1b4),async(_0x412db7,_0x20c1a0)=>{var _0x5a7f3a=a0_0x543a13;const {productCode:_0x35464d,bay:_0x59a024,warehouses:_0x504c0f,room:_0x28258d}=_0x412db7['body'];console['log'](_0x412db7[_0x5a7f3a(0x26e)]);try{const _0x574451=await warehouse[_0x5a7f3a(0x20a)]([{'$match':{'name':_0x504c0f,'room':_0x28258d}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x59a024)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5a7f3a(0x17d)},'product_stock':{'$first':_0x5a7f3a(0x1eb)},'bay':{'$first':_0x5a7f3a(0x26c)},'maxProducts':{'$first':_0x5a7f3a(0x24c)}}}]);_0x20c1a0[_0x5a7f3a(0x1b9)](0xc8)[_0x5a7f3a(0x217)](_0x574451);}catch(_0x266790){_0x20c1a0[_0x5a7f3a(0x1b9)](0x194)[_0x5a7f3a(0x217)]({'message':_0x266790[_0x5a7f3a(0x226)]});}}),module[a0_0x543a13(0x255)]=router;