var a0_0x5c2e34=a0_0xe24f;(function(_0x552271,_0x2ac13c){var _0x2e528b=a0_0xe24f,_0x87e267=_0x552271();while(!![]){try{var _0x1b5773=parseInt(_0x2e528b(0x223))/0x1*(parseInt(_0x2e528b(0x25b))/0x2)+-parseInt(_0x2e528b(0x20a))/0x3+parseInt(_0x2e528b(0x27e))/0x4*(parseInt(_0x2e528b(0x1b0))/0x5)+parseInt(_0x2e528b(0x201))/0x6*(parseInt(_0x2e528b(0x24b))/0x7)+-parseInt(_0x2e528b(0x27c))/0x8+parseInt(_0x2e528b(0x204))/0x9*(parseInt(_0x2e528b(0x1da))/0xa)+parseInt(_0x2e528b(0x224))/0xb*(-parseInt(_0x2e528b(0x1c8))/0xc);if(_0x1b5773===_0x2ac13c)break;else _0x87e267['push'](_0x87e267['shift']());}catch(_0x409057){_0x87e267['push'](_0x87e267['shift']());}}}(a0_0x4f37,0xa256f));const express=require(a0_0x5c2e34(0x24f)),app=express(),router=express[a0_0x5c2e34(0x1c5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x5c2e34(0x196)),nodemailer=require(a0_0x5c2e34(0x1d6));var ejs=require(a0_0x5c2e34(0x1ba));const path=require(a0_0x5c2e34(0x18b)),users=require('../public/language/languages.json');function a0_0xe24f(_0x256c71,_0x547549){var _0x4f37da=a0_0x4f37();return a0_0xe24f=function(_0xe24f3a,_0x421cfb){_0xe24f3a=_0xe24f3a-0x182;var _0x33d489=_0x4f37da[_0xe24f3a];return _0x33d489;},a0_0xe24f(_0x256c71,_0x547549);}function a0_0x4f37(){var _0x3ff4b2=['</thead>','/all_purchases_finished/view','master','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','purchase\x20data\x20add\x20successfully','/give_payment/:id','room','$product_details.type','True','$suppliers_docs','2LkAeRn','165EHzxhm','/invoice/:id','$product','\x20Order\x20Date\x20:\x20','getDate','</tbody>','MaxStocks_data','user_id','body','note','/barcode/:id','$product_code','return_data','$brand','product_code','$warehouse_name','</head><body>','return_purchase_finished','</td>','success','maxperunit','English\x20(US)','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_cat','all','return_product','<hr\x20class=\x22my-3\x22>','name','Purchase\x20Return\x20Mail','Rack\x202','</span>','$product_details.product_name','updateOne','return_qty','Error\x20Occurs','German','catch','$secondary_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','2433515SbWgLt','prod_name','prod_primunit','suppliers_docs','express','DRY\x20GOODS','$_id','expiry_date','product','prod_code','$product_details.product_stock','product_code_hide','<span\x20style=\x22float:\x20right;\x22>','$unit','getMonth','$expiry_date','1275224owFmNw','QA\x20Warehouse','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','error','secondary_code','<tr>','INCF-','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','redirect','role','secondary_unit','$category','<html><head><title></title>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','edit_purchases_finished','An\x20error\x20occurred\x20while\x20saving\x20data.','$suppliers','Arabic','getFullYear','Portuguese','Room_name','back','purchase_quantity','$product_details.bay','$product_details._id','Error\x20occurred\x20while\x20processing\x20product:','Chinese','$product_details.secondary_code','</div>','currency_placement','stock_quantity','prod_Qty','1903064uyXHzj','<table\x20style=\x22width:\x20100%\x20!important;\x22>','149752DvnMlc','/view/return_purchase/:id','room_name','French','concat','Rack\x201','<h5>','image','/upload/','Logo.png','Spanish','path','</h5>','</table>','$return_data','batch_code','all_purchases_finished','/view/add_purchases/:id','render','sendMail','$product_details.storage','POnumber','../middleware/auth','findById','password','$paid_amount','/../public','due_amount','product_name','gmail','Portuguese\x20(BR)','warehouse_name','max_product_unit','findOne','Enclosed','then','find','log','$primary_code','</tr>','Finished\x20Goods','invoice','filter','product_stock','errors','host','$due_amount','email','35BZgiVf','$product_details','logo','Return\x20Goods','prod_unit','stocks','RoomAssign','params','purchase_invoice','json','ejs','map','<h2>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$note','</body></html>','createTransport','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','JO_number','maxStocks','Router','$product_details.product_code','flash','596556HtamXY','abs','_id','English','suppliers','slice','message','bay','$maxProdPerUnit','paid_amount','post','$product_details.rack','length','language','nodemailer','<strong>\x20Regards\x20</strong>','/CheckingWarehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','10EgoJDr','production_date','get','toString','$product.quantity','/view/add_purchases','$product.bin','warehouse','secondary_code_hide','Purchase\x20Mail','quantity','Enabled','$product.bay','floor','save','add_purchases_finished','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$batch_code','$invoice','user','string','Hindi','staff','Arabic\x20(ae)','stock_data','payment\x20successfull','forEach','all_purchases_barcode','$alertquantity','status','product_details','\x20Order\x20Number\x20:\x20','aggregate','edit_purchases_finished_view','date','standard_unit','$product_details.floorlevel','/preview/:id','$name','12Qayqnv','prod_level','<div>','1915659WOSDAM','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','primary_code_hide','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','2390730GLpTKZ','product_cat','table\x20page','site_title','prod_qty','$maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$secondary_unit','/view/:id','level','$product.room_name','$date','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product.floorlevel','$product.type'];a0_0x4f37=function(){return _0x3ff4b2;};return a0_0x4f37();}router[a0_0x5c2e34(0x1dc)]('/view',auth,async(_0x185df4,_0x1c58c3)=>{var _0x553b3e=a0_0x5c2e34;try{const {username:_0x2d0563,email:_0x248687,role:_0x19fd80}=_0x185df4[_0x553b3e(0x1ed)],_0x2ea4b5=_0x185df4[_0x553b3e(0x1ed)],_0x4e4628=await profile[_0x553b3e(0x1a1)]({'email':_0x2ea4b5[_0x553b3e(0x1af)]}),_0xed8e72=await staff[_0x553b3e(0x1a1)]({'email':_0x2ea4b5[_0x553b3e(0x1af)]});if(_0x2ea4b5[_0x553b3e(0x265)]==_0x553b3e(0x1f0)){const _0x16b9f0=await staff['findOne']({'email':_0x2ea4b5[_0x553b3e(0x1af)]});}const _0x181b70=await master_shop[_0x553b3e(0x1a4)]();let _0x4bcd2d;if(_0x2ea4b5[_0x553b3e(0x265)]==_0x553b3e(0x1f0)){const _0x32ed9b=await staff[_0x553b3e(0x1a1)]({'email':_0x2ea4b5[_0x553b3e(0x1af)]});_0x4bcd2d=await purchases_finished[_0x553b3e(0x1fa)]([{'$match':{'warehouse_name':_0x32ed9b[_0x553b3e(0x1e1)]}},{'$lookup':{'from':_0x553b3e(0x1cc),'localField':_0x553b3e(0x1cc),'foreignField':_0x553b3e(0x23f),'as':_0x553b3e(0x24e)}},{'$unwind':_0x553b3e(0x222)},{'$unwind':_0x553b3e(0x226)},{'$group':{'_id':_0x553b3e(0x251),'invoice':{'$first':_0x553b3e(0x1ec)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x553b3e(0x233)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':_0x553b3e(0x1be)},'paid_amount':{'$first':_0x553b3e(0x199)},'due_amount':{'$first':_0x553b3e(0x1ae)},'return_data':{'$first':_0x553b3e(0x18e)},'batch_code':{'$first':_0x553b3e(0x1eb)},'expiry_date':{'$first':_0x553b3e(0x25a)},'suppliers_docs':{'$first':_0x553b3e(0x222)},'total_product_quantity':{'$sum':_0x553b3e(0x1de)},'level':{'$addToSet':_0x553b3e(0x1e6)},'isle':{'$addToSet':_0x553b3e(0x1e0)},'type':{'$addToSet':_0x553b3e(0x218)},'floorlevel':{'$addToSet':_0x553b3e(0x217)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4bcd2d=await purchases_finished[_0x553b3e(0x1fa)]([{'$unwind':'$product'},{'$group':{'_id':_0x553b3e(0x251),'invoice':{'$first':_0x553b3e(0x1ec)},'suppliers':{'$first':_0x553b3e(0x26c)},'date':{'$first':_0x553b3e(0x215)},'warehouse_name':{'$first':_0x553b3e(0x233)},'room':{'$addToSet':_0x553b3e(0x214)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x553b3e(0x199)},'due_amount':{'$first':_0x553b3e(0x1ae)},'return_data':{'$first':_0x553b3e(0x18e)},'batch_code':{'$first':_0x553b3e(0x1eb)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x553b3e(0x222)},'total_product_quantity':{'$sum':_0x553b3e(0x1de)},'level':{'$addToSet':_0x553b3e(0x1e6)},'isle':{'$addToSet':_0x553b3e(0x1e0)},'type':{'$addToSet':_0x553b3e(0x218)},'floorlevel':{'$addToSet':_0x553b3e(0x217)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x181b70[0x0][_0x553b3e(0x1d5)]==_0x553b3e(0x239))var _0x4d752c=users[_0x553b3e(0x1cb)];else{if(_0x181b70[0x0][_0x553b3e(0x1d5)]==_0x553b3e(0x1ef))var _0x4d752c=users[_0x553b3e(0x1ef)];else{if(_0x181b70[0x0]['language']==_0x553b3e(0x247))var _0x4d752c=users['German'];else{if(_0x181b70[0x0]['language']=='Spanish')var _0x4d752c=users[_0x553b3e(0x18a)];else{if(_0x181b70[0x0][_0x553b3e(0x1d5)]==_0x553b3e(0x183))var _0x4d752c=users[_0x553b3e(0x183)];else{if(_0x181b70[0x0][_0x553b3e(0x1d5)]==_0x553b3e(0x19e))var _0x4d752c=users[_0x553b3e(0x26f)];else{if(_0x181b70[0x0][_0x553b3e(0x1d5)]==_0x553b3e(0x276))var _0x4d752c=users[_0x553b3e(0x276)];else{if(_0x181b70[0x0]['language']==_0x553b3e(0x1f1))var _0x4d752c=users['Arabic'];}}}}}}}_0x1c58c3[_0x553b3e(0x192)](_0x553b3e(0x190),{'success':_0x185df4[_0x553b3e(0x1c7)](_0x553b3e(0x237)),'errors':_0x185df4[_0x553b3e(0x1c7)]('errors'),'purchases':_0x4bcd2d,'role':_0x2ea4b5,'profile':_0x4e4628,'master_shop':_0x181b70,'language':_0x4d752c});}catch(_0x2c4cdf){console[_0x553b3e(0x1a5)](_0x553b3e(0x20c),_0x2c4cdf),_0x1c58c3[_0x553b3e(0x1f7)](0xc8)['json']({'message':_0x2c4cdf['message']});}});function BayBinSelected(_0x215d06,_0x164198){var _0x797e9d=a0_0x5c2e34,_0x59d2aa=[],_0xe4e8c1=[];if(_0x215d06==_0x797e9d(0x250)){switch(_0x164198){case'Rack\x201':_0x59d2aa=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x797e9d(0x241):_0x59d2aa=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0xe4e8c1=['DG'];}else{if(_0x215d06=='FROZEN\x20GOODS'){switch(_0x164198){case _0x797e9d(0x185):_0x59d2aa=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x59d2aa=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0xe4e8c1=['FG'];}}return{'levels':_0x59d2aa,'identify':_0xe4e8c1};}async function getRandom8DigitNumber(){var _0x3ee808=a0_0x5c2e34;const _0x457a23=0x989680,_0xacc557=0x5f5e0ff,_0x4162c4=Math[_0x3ee808(0x1e7)](Math['random']()*(_0xacc557-_0x457a23+0x1))+_0x457a23;var _0x2999fe;const _0x1a2c7d=await purchases_finished[_0x3ee808(0x1a1)]({'invoice':_0x3ee808(0x261)+_0x4162c4});return _0x1a2c7d&&_0x1a2c7d['length']>0x0?_0x2999fe=_0x3ee808(0x261)+_0x4162c4:_0x2999fe=_0x3ee808(0x261)+_0x4162c4,_0x2999fe;}router['get'](a0_0x5c2e34(0x1df),auth,async(_0x51a193,_0x502654)=>{var _0x178b47=a0_0x5c2e34;try{const {username:_0x550bbd,email:_0x35d4d7,role:_0x1cf525}=_0x51a193[_0x178b47(0x1ed)],_0x41c3bc=_0x51a193['user'],_0x2193f5=await profile[_0x178b47(0x1a1)]({'email':_0x41c3bc[_0x178b47(0x1af)]}),_0x3d9b4e=await master_shop['find'](),_0x4939f2=await staff[_0x178b47(0x1a1)]({'email':_0x41c3bc['email']}),_0x59f129=await suppliers[_0x178b47(0x1a4)]({});let _0x401c14;if(_0x41c3bc['role']=='staff'){const _0x2b4f5a=await staff[_0x178b47(0x1a1)]({'email':_0x41c3bc[_0x178b47(0x1af)]});_0x401c14=await warehouse['aggregate']([{'$match':{'status':_0x178b47(0x1e5),'name':_0x2b4f5a[_0x178b47(0x1e1)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x178b47(0x200)}}}]);}else _0x401c14=await warehouse[_0x178b47(0x1fa)]([{'$match':{'status':_0x178b47(0x1e5),'warehouse_category':_0x178b47(0x1a8),'name':{'$ne':_0x178b47(0x25c)}}},{'$group':{'_id':_0x178b47(0x200),'name':{'$first':_0x178b47(0x200)}}}]);const _0x130f9e=await product[_0x178b47(0x1a4)]({}),_0x5d600a=await warehouse[_0x178b47(0x1a4)]({'status':_0x178b47(0x1e5)}),_0x15a14f=await purchases_finished['find']({}),_0x3593c2=_0x15a14f['length']+0x1,_0x18b130=_0x178b47(0x261)+_0x3593c2[_0x178b47(0x1dd)]()['padStart'](0x5,'0');var _0x4e6f77=['Ambient',_0x178b47(0x1a2)];if(_0x3d9b4e[0x0][_0x178b47(0x1d5)]=='English\x20(US)')var _0x1383bc=users['English'];else{if(_0x3d9b4e[0x0][_0x178b47(0x1d5)]==_0x178b47(0x1ef))var _0x1383bc=users[_0x178b47(0x1ef)];else{if(_0x3d9b4e[0x0][_0x178b47(0x1d5)]==_0x178b47(0x247))var _0x1383bc=users['German'];else{if(_0x3d9b4e[0x0][_0x178b47(0x1d5)]==_0x178b47(0x18a))var _0x1383bc=users[_0x178b47(0x18a)];else{if(_0x3d9b4e[0x0][_0x178b47(0x1d5)]=='French')var _0x1383bc=users['French'];else{if(_0x3d9b4e[0x0][_0x178b47(0x1d5)]==_0x178b47(0x19e))var _0x1383bc=users[_0x178b47(0x26f)];else{if(_0x3d9b4e[0x0][_0x178b47(0x1d5)]=='Chinese')var _0x1383bc=users[_0x178b47(0x276)];else{if(_0x3d9b4e[0x0][_0x178b47(0x1d5)]==_0x178b47(0x1f1))var _0x1383bc=users['Arabic'];}}}}}}}const _0x215f7e=getRandom8DigitNumber();_0x215f7e['then'](_0x5d5bac=>{var _0x170c6b=_0x178b47;_0x502654[_0x170c6b(0x192)](_0x170c6b(0x1e9),{'success':_0x51a193['flash'](_0x170c6b(0x237)),'errors':_0x51a193[_0x170c6b(0x1c7)](_0x170c6b(0x1ac)),'role':_0x41c3bc,'profile':_0x2193f5,'suppliers':_0x59f129,'warehouse':_0x401c14,'product':_0x130f9e,'invoice':_0x5d5bac,'master_shop':_0x3d9b4e,'language':_0x1383bc,'find_data':_0x5d600a,'rooms_data':_0x4e6f77});})[_0x178b47(0x248)](_0xe2e898=>{var _0x1d6067=_0x178b47;_0x51a193[_0x1d6067(0x1c7)](_0x1d6067(0x1ac),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x502654[_0x1d6067(0x264)]('/all_purchases_finished/view');});}catch(_0x5ae263){console['log'](_0x5ae263);}}),router[a0_0x5c2e34(0x1dc)](a0_0x5c2e34(0x191),auth,async(_0x3d5dfa,_0x4956df)=>{var _0x35144d=a0_0x5c2e34;try{const _0x19039e=_0x3d5dfa['params']['id'];console[_0x35144d(0x1a5)](_0x19039e);const _0x36aa8d=await master_shop[_0x35144d(0x1a4)]();console[_0x35144d(0x1a5)](_0x35144d(0x21b),_0x36aa8d);const _0x70d0c4=await product[_0x35144d(0x1a1)]({'name':_0x19039e});console[_0x35144d(0x1a5)](_0x35144d(0x253),_0x70d0c4),_0x4956df[_0x35144d(0x1f7)](0xc8)['json']({'product_data':_0x70d0c4,'master':_0x36aa8d});}catch(_0x5db30c){console[_0x35144d(0x1a5)]('add_purchases\x20error',_0x5db30c);}}),router[a0_0x5c2e34(0x1d2)](a0_0x5c2e34(0x1df),auth,async(_0x3619ae,_0x5493b8)=>{var _0x36cb01=a0_0x5c2e34;try{const {invoice:_0x5e1c5a,date:_0x2def4a,warehouse_name:_0x5237b2,prod_name:_0x26fc1b,prod_code:_0x1fe045,prod_qty:_0x13eda6,prod_unit:_0x2f6255,prod_secondunit:_0x3387db,prod_level:_0x41b413,prod_isle:_0x39b8ca,prod_pallet:_0x1177b8,note:_0x3fd63d,expiry_date:_0x1a136b,batch_code:_0x1cb0d2,payable:_0x1ef03f,due_amount:_0x42277e,Room_name:_0x3f08ea,primary_code:_0x5ebccf,secondary_code:_0x4b0e72,MaxStocks_data:_0x4a3e16,PO_number:_0x54f3f5,SCRN:_0x1abd29,JO_number:_0x30ebda}=_0x3619ae['body'];if(typeof _0x26fc1b==_0x36cb01(0x1ee))var _0x2eac38=[_0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x24c)]],_0x4d78f2=[_0x3619ae[_0x36cb01(0x22c)]['prod_code']],_0x40ad0e=[_0x3619ae['body'][_0x36cb01(0x27b)]],_0x110d2c=[_0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x24d)]],_0x3690c5=[_0x3619ae['body'][_0x36cb01(0x205)]],_0x3ff7d2=[_0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x202)]],_0xe95093=[_0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x262)]],_0x4c8bbc=[_0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x25f)]],_0x2110f3=[_0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x22a)]],_0x200017=[_0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x18f)]],_0x22889d=[_0x3619ae['body']['expiry_date']],_0x2d6f75=[_0x3619ae[_0x36cb01(0x22c)]['product_date']],_0x408c7f=[_0x3619ae['body'][_0x36cb01(0x1a0)]],_0x49afb4=[_0x3619ae['body']['prod_cat']],_0x4dc65a=[_0x3619ae[_0x36cb01(0x22c)]['RoomAssign']],_0x3b3dce=[_0x3619ae['body'][_0x36cb01(0x1c1)]];else var _0x2eac38=[..._0x3619ae[_0x36cb01(0x22c)]['prod_name']],_0x4d78f2=[..._0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x254)]],_0x40ad0e=[..._0x3619ae['body'][_0x36cb01(0x27b)]],_0x110d2c=[..._0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x24d)]],_0x3690c5=[..._0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x205)]],_0x3ff7d2=[..._0x3619ae['body']['prod_level']],_0xe95093=[..._0x3619ae['body'][_0x36cb01(0x262)]],_0x4c8bbc=[..._0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x25f)]],_0x2110f3=[..._0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x22a)]],_0x200017=[..._0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x18f)]],_0x22889d=[..._0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x252)]],_0x2d6f75=[..._0x3619ae[_0x36cb01(0x22c)]['product_date']],_0x408c7f=[..._0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x1a0)]],_0x49afb4=[..._0x3619ae['body'][_0x36cb01(0x23b)]],_0x4dc65a=[..._0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x1b6)]],_0x3b3dce=[..._0x3619ae[_0x36cb01(0x22c)][_0x36cb01(0x1c1)]];const _0x170fe8=_0x2eac38[_0x36cb01(0x1bb)](_0x37a42e=>{return _0x37a42e={'product_name':_0x37a42e};});_0x4d78f2[_0x36cb01(0x1f4)]((_0x57c6bc,_0x230265)=>{var _0x3cbc84=_0x36cb01;_0x170fe8[_0x230265][_0x3cbc84(0x232)]=_0x57c6bc;}),_0x40ad0e[_0x36cb01(0x1f4)]((_0x556c3f,_0x307c95)=>{var _0x159ff9=_0x36cb01;_0x170fe8[_0x307c95][_0x159ff9(0x1e4)]=Math[_0x159ff9(0x1c9)](_0x556c3f);}),_0x110d2c['forEach']((_0x3c96ca,_0x21f2c7)=>{var _0x52fcc0=_0x36cb01;_0x170fe8[_0x21f2c7][_0x52fcc0(0x1fd)]=_0x3c96ca;}),_0x3690c5[_0x36cb01(0x1f4)]((_0x403b09,_0x3ef542)=>{var _0x2a8bb4=_0x36cb01;_0x170fe8[_0x3ef542][_0x2a8bb4(0x266)]=_0x403b09;}),_0x3ff7d2[_0x36cb01(0x1f4)]((_0x365115,_0x4d910d)=>{_0x170fe8[_0x4d910d]['bay']=_0x365115;}),_0xe95093[_0x36cb01(0x1f4)]((_0x2602bd,_0x10151a)=>{var _0x1bb911=_0x36cb01;_0x170fe8[_0x10151a][_0x1bb911(0x262)]=_0x2602bd;}),_0x4c8bbc[_0x36cb01(0x1f4)]((_0x3964b3,_0x28c4f)=>{var _0x3a5a69=_0x36cb01;_0x170fe8[_0x28c4f][_0x3a5a69(0x25f)]=_0x3964b3;}),_0x2110f3[_0x36cb01(0x1f4)]((_0x5ae057,_0x3c18bd)=>{var _0x362497=_0x36cb01;_0x170fe8[_0x3c18bd][_0x362497(0x1c4)]=_0x5ae057;}),_0x200017['forEach']((_0x3a750b,_0x27e5bf)=>{var _0x5c9273=_0x36cb01;_0x170fe8[_0x27e5bf][_0x5c9273(0x18f)]=_0x3a750b;}),_0x22889d[_0x36cb01(0x1f4)]((_0x243c2a,_0x289bf8)=>{var _0x3dc63a=_0x36cb01;_0x170fe8[_0x289bf8][_0x3dc63a(0x252)]=_0x243c2a;}),_0x2d6f75['forEach']((_0x24e76d,_0xfb4fee)=>{var _0x33f05d=_0x36cb01;_0x170fe8[_0xfb4fee][_0x33f05d(0x1db)]=_0x24e76d;}),_0x408c7f[_0x36cb01(0x1f4)]((_0x3504db,_0xf0b1c3)=>{var _0x1bb84a=_0x36cb01;_0x170fe8[_0xf0b1c3][_0x1bb84a(0x238)]=_0x3504db;}),_0x49afb4[_0x36cb01(0x1f4)]((_0x11c836,_0x557530)=>{var _0x1eb7ac=_0x36cb01;_0x170fe8[_0x557530][_0x1eb7ac(0x20b)]=_0x11c836;}),_0x4dc65a[_0x36cb01(0x1f4)]((_0x1b5bbf,_0x492e1d)=>{var _0x5b343d=_0x36cb01;_0x170fe8[_0x492e1d][_0x5b343d(0x182)]=_0x1b5bbf;}),_0x3b3dce[_0x36cb01(0x1f4)]((_0x573fe7,_0x2d5002)=>{var _0xcc31a9=_0x36cb01;_0x170fe8[_0x2d5002][_0xcc31a9(0x1a9)]=_0x573fe7;});const _0x643817=_0x170fe8[_0x36cb01(0x1aa)](_0x2233bc=>_0x2233bc[_0x36cb01(0x1e4)]!=='0'&&_0x2233bc[_0x36cb01(0x1e4)]!==''),_0x1102ba=new purchases_finished({'invoice':_0x5e1c5a,'suppliers':_0x3619ae[_0x36cb01(0x22c)]['suppliers'],'date':_0x2def4a,'warehouse_name':_0x5237b2,'product':_0x643817,'note':_0x3fd63d,'due_amount':_0x42277e,'room':_0x3f08ea,'POnumber':_0x54f3f5,'SCRN':_0x1abd29,'JO_number':_0x30ebda}),_0x12d3c0=await _0x1102ba[_0x36cb01(0x1e8)](),_0x348250=await purchases_finished[_0x36cb01(0x1a1)]({'invoice':_0x5e1c5a}),_0x55f448=_0x348250['product']['map'](async _0x56acda=>{var _0x20b35b=_0x36cb01;try{var _0x4b4020=await warehouse[_0x20b35b(0x1a1)]({'name':_0x5237b2,'room':_0x56acda[_0x20b35b(0x182)]}),_0x80a5e3=0x0;const _0x1ac057=_0x4b4020['product_details'][_0x20b35b(0x1bb)](_0x10e902=>{var _0x45fd65=_0x20b35b;console[_0x45fd65(0x1a5)](_0x10e902[_0x45fd65(0x19c)]+'=='+_0x56acda[_0x45fd65(0x19c)]+'&&'+_0x10e902['bay']+'=='+_0x56acda[_0x45fd65(0x1cf)]+'&&'+_0x10e902[_0x45fd65(0x252)]+'=='+_0x56acda[_0x45fd65(0x252)]+'&&'+_0x10e902[_0x45fd65(0x1db)]+'=='+_0x56acda['production_date']+'&&'+_0x10e902['batch_code']+'=='+_0x56acda[_0x45fd65(0x18f)]+'&&'+_0x10e902[_0x45fd65(0x1a9)]+'=='+_0x348250['invoice']),_0x10e902[_0x45fd65(0x19c)]==_0x56acda[_0x45fd65(0x19c)]&&_0x10e902[_0x45fd65(0x1cf)]==_0x56acda[_0x45fd65(0x1cf)]&&_0x10e902[_0x45fd65(0x252)]==_0x56acda[_0x45fd65(0x252)]&&_0x10e902['production_date']==_0x56acda['production_date']&&_0x10e902[_0x45fd65(0x18f)]==_0x56acda[_0x45fd65(0x18f)]&&_0x10e902[_0x45fd65(0x1a9)]==_0x348250['invoice']&&(_0x10e902['product_stock']=Math[_0x45fd65(0x1c9)](_0x10e902[_0x45fd65(0x1ab)])+Math['abs'](_0x56acda['quantity']),_0x80a5e3++);});return _0x80a5e3==0x0&&(_0x4b4020['product_details']=_0x4b4020['product_details']['concat']({'product_name':_0x56acda[_0x20b35b(0x19c)],'product_stock':Math[_0x20b35b(0x1c9)](_0x56acda[_0x20b35b(0x1e4)]),'primary_code':_0x56acda[_0x20b35b(0x262)],'secondary_code':_0x56acda['secondary_code'],'product_code':_0x56acda[_0x20b35b(0x232)],'bay':_0x56acda[_0x20b35b(0x1cf)],'maxProducts':_0x56acda[_0x20b35b(0x1c4)],'unit':_0x56acda[_0x20b35b(0x1fd)],'secondary_unit':_0x56acda[_0x20b35b(0x266)],'expiry_date':_0x56acda['expiry_date'],'production_date':_0x56acda[_0x20b35b(0x1db)],'maxProducts':_0x56acda[_0x20b35b(0x1c4)],'maxPerUnit':_0x56acda[_0x20b35b(0x238)],'batch_code':_0x56acda['batch_code'],'product_cat':_0x56acda[_0x20b35b(0x20b)],'invoice':_0x56acda[_0x20b35b(0x1a9)],'id_incoming':_0x56acda[_0x20b35b(0x1ca)]})),_0x4b4020;}catch(_0x431a73){return console[_0x20b35b(0x25e)](_0x20b35b(0x275),_0x431a73),null;}});Promise[_0x36cb01(0x23c)](_0x55f448)[_0x36cb01(0x1a3)](async _0x50ae12=>{var _0x33cc76=_0x36cb01;try{for(const _0xac2eac of _0x50ae12){await warehouse[_0x33cc76(0x244)]({'_id':_0xac2eac[_0x33cc76(0x1ca)]},{'$addToSet':{'product_details':{'$each':_0xac2eac[_0x33cc76(0x1f8)]}}});}const _0x1d8e0d=await master_shop[_0x33cc76(0x1a4)](),_0x47da88=await email_settings[_0x33cc76(0x1a1)](),_0xcb57ea=await supervisor_settings[_0x33cc76(0x1a4)]();var _0x430c7f=_0x348250[_0x33cc76(0x253)],_0x699e6d='',_0x47aa2b;for(_0x47aa2b in _0x430c7f){var _0x37f2a7='FG';_0x348250[_0x33cc76(0x19f)]==_0x33cc76(0x250)&&(_0x37f2a7='DG'),_0x699e6d+=_0x33cc76(0x260)+_0x33cc76(0x24a)+_0x430c7f[_0x47aa2b][_0x33cc76(0x19c)]+_0x33cc76(0x236)+_0x33cc76(0x24a)+_0x430c7f[_0x47aa2b][_0x33cc76(0x232)]+_0x33cc76(0x236)+_0x33cc76(0x24a)+_0x430c7f[_0x47aa2b]['quantity']+'</td>'+_0x33cc76(0x24a)+_0x430c7f[_0x47aa2b][_0x33cc76(0x1fd)]+_0x33cc76(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x430c7f[_0x47aa2b][_0x33cc76(0x266)]+_0x33cc76(0x236)+_0x33cc76(0x24a)+_0x348250[_0x33cc76(0x19f)]+_0x33cc76(0x236)+_0x33cc76(0x24a)+_0x430c7f[_0x47aa2b]['room_name']+_0x33cc76(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x37f2a7+_0x430c7f[_0x47aa2b][_0x33cc76(0x1cf)]+_0x33cc76(0x236),_0x33cc76(0x1a7);}let _0x26a1b1=nodemailer[_0x33cc76(0x1c0)]({'host':_0x47da88[_0x33cc76(0x1ad)],'port':Number(_0x47da88['port']),'secure':![],'auth':{'user':_0x47da88[_0x33cc76(0x1af)],'pass':_0x47da88['password']}}),_0x5c09d3={'from':_0x47da88[_0x33cc76(0x1af)],'to':_0xcb57ea[0x0]['FGSEmail'],'subject':_0x33cc76(0x1e3),'attachments':[{'filename':_0x33cc76(0x189),'path':__dirname+_0x33cc76(0x19a)+_0x33cc76(0x188)+_0x1d8e0d[0x0]['image'],'cid':_0x33cc76(0x1b2)}],'html':'<!DOCTYPE\x20html>'+_0x33cc76(0x268)+_0x33cc76(0x234)+'<div>'+_0x33cc76(0x1ea)+'<div>'+_0x33cc76(0x25d)+_0x33cc76(0x278)+_0x33cc76(0x203)+_0x33cc76(0x1bc)+_0x1d8e0d[0x0][_0x33cc76(0x20d)]+'\x20</h2>'+_0x33cc76(0x278)+_0x33cc76(0x278)+'<hr\x20class=\x22my-3\x22>'+_0x33cc76(0x203)+_0x33cc76(0x208)+_0x33cc76(0x1f9)+_0x348250[_0x33cc76(0x1a9)]+'\x20'+_0x33cc76(0x257)+_0x33cc76(0x227)+_0x348250[_0x33cc76(0x1fc)]+'\x20'+'</span>'+_0x33cc76(0x18c)+'</div>'+_0x33cc76(0x27d)+_0x33cc76(0x21c)+_0x33cc76(0x260)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x33cc76(0x1bd)+_0x33cc76(0x1c2)+_0x33cc76(0x263)+_0x33cc76(0x206)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x33cc76(0x210)+_0x33cc76(0x1a7)+'</thead>'+_0x33cc76(0x23a)+'\x20'+_0x699e6d+'\x20'+_0x33cc76(0x229)+'</table>'+'<div>'+_0x33cc76(0x1d7)+_0x33cc76(0x186)+_0x1d8e0d[0x0]['site_title']+'</h5>'+_0x33cc76(0x278)+_0x33cc76(0x278)+_0x33cc76(0x1bf)};_0x26a1b1[_0x33cc76(0x193)](_0x5c09d3,function(_0x2f7834,_0x4fb8fd){var _0x4f2fb8=_0x33cc76;_0x2f7834?(console[_0x4f2fb8(0x1a5)](_0x2f7834),console[_0x4f2fb8(0x1a5)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');});}catch(_0x36cd71){console[_0x33cc76(0x25e)](_0x36cd71),_0x5493b8[_0x33cc76(0x1f7)](0x1f4)[_0x33cc76(0x1b9)]({'error':_0x33cc76(0x26b),'message':_0x36cd71[_0x33cc76(0x1ce)]});}})['catch'](_0x431c37=>{var _0x3960ae=_0x36cb01;console[_0x3960ae(0x25e)](_0x431c37);}),_0x3619ae['flash'](_0x36cb01(0x237),_0x36cb01(0x21d)),_0x5493b8[_0x36cb01(0x264)]('/all_purchases_finished/view');}catch(_0x22f7a8){console[_0x36cb01(0x1a5)](_0x22f7a8);}}),router[a0_0x5c2e34(0x1dc)](a0_0x5c2e34(0x1ff),auth,async(_0x54f95f,_0x3aca16)=>{var _0x5c28cb=a0_0x5c2e34;try{const {username:_0x59656a,email:_0x3b2674,role:_0x5e33dd}=_0x54f95f[_0x5c28cb(0x1ed)],_0x586fa0=_0x54f95f[_0x5c28cb(0x1ed)],_0x3a5bd7=await profile[_0x5c28cb(0x1a1)]({'email':_0x586fa0['email']}),_0x5cc7ae=await master_shop[_0x5c28cb(0x1a4)](),_0x5a71bd=_0x54f95f[_0x5c28cb(0x1b7)]['id'],_0x26db6e=await purchases_finished[_0x5c28cb(0x197)](_0x5a71bd),_0x56dc42=await suppliers[_0x5c28cb(0x1a4)]({});let _0x5aa0a8;if(_0x586fa0['role']==_0x5c28cb(0x1f0)){const _0x9e2f19=await staff[_0x5c28cb(0x1a1)]({'email':_0x586fa0[_0x5c28cb(0x1af)]});_0x5aa0a8=await warehouse[_0x5c28cb(0x1a4)]({'status':_0x5c28cb(0x1e5),'name':_0x9e2f19[_0x5c28cb(0x1e1)],'warehouse_category':_0x5c28cb(0x1a8)});}else _0x5aa0a8=await warehouse[_0x5c28cb(0x1fa)]([{'$match':{'status':_0x5c28cb(0x1e5),'warehouse_category':_0x5c28cb(0x1a8)}},{'$group':{'_id':'$name','name':{'$first':_0x5c28cb(0x200)}}}]);const _0x280d81=await product[_0x5c28cb(0x1a4)]({}),_0x1e22df=BayBinSelected(_0x26db6e[_0x5c28cb(0x19f)],_0x26db6e['room']);let _0x4a0801=new Date(_0x26db6e[_0x5c28cb(0x252)]),_0x5bb3d5=('0'+_0x4a0801['getDate']())[_0x5c28cb(0x1cd)](-0x2),_0x125803=('0'+(_0x4a0801[_0x5c28cb(0x259)]()+0x1))[_0x5c28cb(0x1cd)](-0x2),_0x4ff86c=_0x4a0801[_0x5c28cb(0x26e)](),_0x7c8a6=_0x4ff86c+'-'+_0x125803+'-'+_0x5bb3d5;if(_0x5cc7ae[0x0]['language']==_0x5c28cb(0x239)){var _0x103ed7=users[_0x5c28cb(0x1cb)];console[_0x5c28cb(0x1a5)](_0x103ed7);}else{if(_0x5cc7ae[0x0][_0x5c28cb(0x1d5)]==_0x5c28cb(0x1ef))var _0x103ed7=users[_0x5c28cb(0x1ef)];else{if(_0x5cc7ae[0x0][_0x5c28cb(0x1d5)]==_0x5c28cb(0x247))var _0x103ed7=users[_0x5c28cb(0x247)];else{if(_0x5cc7ae[0x0][_0x5c28cb(0x1d5)]==_0x5c28cb(0x18a))var _0x103ed7=users['Spanish'];else{if(_0x5cc7ae[0x0]['language']=='French')var _0x103ed7=users[_0x5c28cb(0x183)];else{if(_0x5cc7ae[0x0][_0x5c28cb(0x1d5)]==_0x5c28cb(0x19e))var _0x103ed7=users['Portuguese'];else{if(_0x5cc7ae[0x0]['language']=='Chinese')var _0x103ed7=users[_0x5c28cb(0x276)];else{if(_0x5cc7ae[0x0][_0x5c28cb(0x1d5)]==_0x5c28cb(0x1f1))var _0x103ed7=users[_0x5c28cb(0x26d)];}}}}}}}_0x3aca16[_0x5c28cb(0x192)](_0x5c28cb(0x1fb),{'success':_0x54f95f['flash'](_0x5c28cb(0x237)),'errors':_0x54f95f['flash'](_0x5c28cb(0x1ac)),'role':_0x586fa0,'profile':_0x3a5bd7,'purchases':_0x26db6e,'suppliers':_0x56dc42,'warehouse':_0x5aa0a8,'product':_0x280d81,'master_shop':_0x5cc7ae,'language':_0x103ed7,'ed_fullDate':_0x7c8a6,'dataSelected':_0x1e22df});}catch(_0x36abb5){console[_0x5c28cb(0x1a5)](_0x36abb5);}}),router[a0_0x5c2e34(0x1dc)](a0_0x5c2e34(0x212),auth,async(_0x26b1aa,_0x885662)=>{var _0x86a91b=a0_0x5c2e34;try{const {username:_0x496eca,email:_0x11e380,role:_0x16617e}=_0x26b1aa[_0x86a91b(0x1ed)],_0x2a7365=_0x26b1aa[_0x86a91b(0x1ed)],_0x6989c1=await profile[_0x86a91b(0x1a1)]({'email':_0x2a7365[_0x86a91b(0x1af)]}),_0x26e590=await master_shop[_0x86a91b(0x1a4)](),_0x3a686e=_0x26b1aa[_0x86a91b(0x1b7)]['id'],_0x43a088=await purchases_finished[_0x86a91b(0x197)](_0x3a686e),_0x55a3f3=await suppliers[_0x86a91b(0x1a4)]({});let _0x4864a6;if(_0x2a7365['role']==_0x86a91b(0x1f0)){const _0x5f56a1=await staff[_0x86a91b(0x1a1)]({'email':_0x2a7365['email']});_0x4864a6=await warehouse[_0x86a91b(0x1a4)]({'status':_0x86a91b(0x1e5),'name':_0x5f56a1[_0x86a91b(0x1e1)],'warehouse_category':_0x86a91b(0x1a8)});}else _0x4864a6=await warehouse['aggregate']([{'$match':{'status':_0x86a91b(0x1e5),'warehouse_category':_0x86a91b(0x1a8)}},{'$group':{'_id':_0x86a91b(0x200),'name':{'$first':_0x86a91b(0x200)}}}]);const _0x1ae0a3=await product[_0x86a91b(0x1a4)]({}),_0x44712c=BayBinSelected(_0x43a088[_0x86a91b(0x19f)],_0x43a088['room']);let _0x2220a0=new Date(_0x43a088[_0x86a91b(0x252)]),_0x5f4e3f=('0'+_0x2220a0[_0x86a91b(0x228)]())['slice'](-0x2),_0xc08a0f=('0'+(_0x2220a0['getMonth']()+0x1))[_0x86a91b(0x1cd)](-0x2),_0x5f4edc=_0x2220a0[_0x86a91b(0x26e)](),_0x3e92de=_0x5f4edc+'-'+_0xc08a0f+'-'+_0x5f4e3f;if(_0x26e590[0x0][_0x86a91b(0x1d5)]==_0x86a91b(0x239)){var _0x1dbe8b=users['English'];console[_0x86a91b(0x1a5)](_0x1dbe8b);}else{if(_0x26e590[0x0][_0x86a91b(0x1d5)]==_0x86a91b(0x1ef))var _0x1dbe8b=users[_0x86a91b(0x1ef)];else{if(_0x26e590[0x0][_0x86a91b(0x1d5)]==_0x86a91b(0x247))var _0x1dbe8b=users[_0x86a91b(0x247)];else{if(_0x26e590[0x0][_0x86a91b(0x1d5)]==_0x86a91b(0x18a))var _0x1dbe8b=users[_0x86a91b(0x18a)];else{if(_0x26e590[0x0]['language']==_0x86a91b(0x183))var _0x1dbe8b=users[_0x86a91b(0x183)];else{if(_0x26e590[0x0][_0x86a91b(0x1d5)]==_0x86a91b(0x19e))var _0x1dbe8b=users[_0x86a91b(0x26f)];else{if(_0x26e590[0x0][_0x86a91b(0x1d5)]==_0x86a91b(0x276))var _0x1dbe8b=users[_0x86a91b(0x276)];else{if(_0x26e590[0x0][_0x86a91b(0x1d5)]==_0x86a91b(0x1f1))var _0x1dbe8b=users[_0x86a91b(0x26d)];}}}}}}}_0x885662[_0x86a91b(0x192)](_0x86a91b(0x26a),{'success':_0x26b1aa[_0x86a91b(0x1c7)](_0x86a91b(0x237)),'errors':_0x26b1aa['flash'](_0x86a91b(0x1ac)),'role':_0x2a7365,'profile':_0x6989c1,'purchases':_0x43a088,'suppliers':_0x55a3f3,'warehouse':_0x4864a6,'product':_0x1ae0a3,'master_shop':_0x26e590,'language':_0x1dbe8b,'ed_fullDate':_0x3e92de,'dataSelected':_0x44712c});}catch(_0x1ee939){console[_0x86a91b(0x1a5)](_0x1ee939);}}),router[a0_0x5c2e34(0x1d2)]('/view/:id',auth,async(_0xdd9ea,_0x4831f5)=>{var _0x1ebdae=a0_0x5c2e34;try{const _0x224496=_0xdd9ea[_0x1ebdae(0x1b7)]['id'],_0x12adb4=await purchases_finished['findOne']({'_id':_0xdd9ea[_0x1ebdae(0x1b7)]['id']}),_0x57179c=await warehouse[_0x1ebdae(0x1a1)]({'name':_0x12adb4[_0x1ebdae(0x19f)],'room':_0x12adb4[_0x1ebdae(0x21f)]});_0x12adb4[_0x1ebdae(0x253)][_0x1ebdae(0x1f4)](_0x4f1f78=>{var _0x183595=_0x1ebdae;const _0x3113ab=_0x57179c[_0x183595(0x1f8)][_0x183595(0x1bb)](_0x40f1a7=>{var _0x3c0151=_0x183595;_0x40f1a7[_0x3c0151(0x19c)]==_0x4f1f78[_0x3c0151(0x19c)]&&_0x40f1a7[_0x3c0151(0x1cf)]==_0x4f1f78[_0x3c0151(0x1cf)]&&(_0x40f1a7[_0x3c0151(0x1ab)]=parseInt(_0x40f1a7['product_stock'])-parseInt(_0x4f1f78['quantity']));});}),await _0x57179c[_0x1ebdae(0x1e8)]();const {invoice:_0x4fa0f6,suppliers:_0x55fa98,date:_0x1c49b3,warehouse_name:_0x5b71ed,prod_name:_0x3f71b9,prod_code:_0x5b6060,prod_qty:_0xdacb2b,prod_unit:_0x481d98,prod_secondunit:_0x514a85,prod_level:_0x5e8c4c,prod_isle:_0x5a5862,prod_pallet:_0x2aa05d,note:_0x3ad010,expiry_date:_0xbe85b2,batch_code:_0x905cd7,paid_amount:_0x5d9c6b,due_amount:_0x53c422,Room_name:_0xe07fb1,primary_code:_0x423a19,secondary_code:_0x51bb06,PO_number:_0x43ba68,JO_number:_0x54eedd}=_0xdd9ea['body'];if(typeof _0x3f71b9==_0x1ebdae(0x1ee))var _0x16e841=[_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x24c)]],_0x595a25=[_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x254)]],_0x5cc146=[_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x20e)]],_0x1c1f59=[_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x1b4)]],_0x3bccf8=[_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x205)]],_0x2c58c3=[_0xdd9ea['body'][_0x1ebdae(0x202)]],_0x4a0f9b=[_0xdd9ea['body']['primary_code']],_0x40f7a1=[_0xdd9ea[_0x1ebdae(0x22c)]['secondary_code']],_0xde090d=[_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x22a)]],_0x594fb5=[_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x18f)]],_0x52a7f2=[_0xdd9ea['body']['expiry_date']];else var _0x16e841=[..._0xdd9ea['body']['prod_name']],_0x595a25=[..._0xdd9ea[_0x1ebdae(0x22c)]['prod_code']],_0x5cc146=[..._0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x20e)]],_0x1c1f59=[..._0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x1b4)]],_0x3bccf8=[..._0xdd9ea['body'][_0x1ebdae(0x205)]],_0x2c58c3=[..._0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x202)]],_0x4a0f9b=[..._0xdd9ea['body']['primary_code']],_0x40f7a1=[..._0xdd9ea[_0x1ebdae(0x22c)]['secondary_code']],_0xde090d=[..._0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x22a)]],_0x594fb5=[..._0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x18f)]],_0x52a7f2=[..._0xdd9ea[_0x1ebdae(0x22c)]['expiry_date']];const _0x27ebc8=_0x16e841[_0x1ebdae(0x1bb)](_0x362972=>{return _0x362972={'product_name':_0x362972};});_0x595a25['forEach']((_0x561b59,_0x19be14)=>{_0x27ebc8[_0x19be14]['product_code']=_0x561b59;}),_0x5cc146[_0x1ebdae(0x1f4)]((_0x59f5bd,_0x5f2d3c)=>{var _0x533a2=_0x1ebdae;_0x27ebc8[_0x5f2d3c][_0x533a2(0x1e4)]=_0x59f5bd;}),_0x1c1f59['forEach']((_0x313f98,_0x39f604)=>{_0x27ebc8[_0x39f604]['standard_unit']=_0x313f98;}),_0x3bccf8['forEach']((_0x450dd7,_0x1975b7)=>{var _0x267d61=_0x1ebdae;_0x27ebc8[_0x1975b7][_0x267d61(0x266)]=_0x450dd7;}),_0x2c58c3[_0x1ebdae(0x1f4)]((_0x5bee51,_0x18bc0c)=>{_0x27ebc8[_0x18bc0c]['bay']=_0x5bee51;}),_0x4a0f9b[_0x1ebdae(0x1f4)]((_0x5c659c,_0x6b8047)=>{_0x27ebc8[_0x6b8047]['primary_code']=_0x5c659c;}),_0x40f7a1['forEach']((_0x19423a,_0xbdfb2f)=>{_0x27ebc8[_0xbdfb2f]['secondary_code']=_0x19423a;}),_0xde090d['forEach']((_0x1ed875,_0x2ab82a)=>{_0x27ebc8[_0x2ab82a]['maxStocks']=_0x1ed875;}),_0x594fb5[_0x1ebdae(0x1f4)]((_0x3943aa,_0x135477)=>{var _0x3b465c=_0x1ebdae;_0x27ebc8[_0x135477][_0x3b465c(0x18f)]=_0x3943aa;}),_0x52a7f2[_0x1ebdae(0x1f4)]((_0x4bca0e,_0x574968)=>{var _0x15ffe9=_0x1ebdae;_0x27ebc8[_0x574968][_0x15ffe9(0x252)]=_0x4bca0e;});const _0x4ceb2e=_0x27ebc8[_0x1ebdae(0x1aa)](_0x34f948=>_0x34f948[_0x1ebdae(0x1e4)]!=='0'&&_0x34f948[_0x1ebdae(0x1e4)]!=='');_0x12adb4[_0x1ebdae(0x1a9)]=_0x4fa0f6,_0x12adb4['suppliers']=_0x55fa98,_0x12adb4[_0x1ebdae(0x1fc)]=_0x1c49b3,_0x12adb4[_0x1ebdae(0x19f)]=_0x5b71ed,_0x12adb4[_0x1ebdae(0x253)]=_0x4ceb2e,_0x12adb4[_0x1ebdae(0x22d)]=_0x3ad010,_0x12adb4[_0x1ebdae(0x1d1)]=_0x5d9c6b,_0x12adb4['due_amount']=_0x53c422,_0x12adb4[_0x1ebdae(0x21f)]=_0xe07fb1,_0x12adb4[_0x1ebdae(0x195)]=_0x43ba68,_0x12adb4[_0x1ebdae(0x1c3)]=_0x54eedd;const _0x192841=await _0x12adb4[_0x1ebdae(0x1e8)](),_0x24681a=await warehouse['findOne']({'name':_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x19f)],'room':_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x270)]});_0x12adb4[_0x1ebdae(0x253)][_0x1ebdae(0x1f4)](_0x5a44ba=>{var _0x40a137=_0x1ebdae,_0x464f7c=0x0;const _0x3fccf2=_0x24681a['product_details']['map'](_0x3b9aee=>{var _0x1fda94=a0_0xe24f;_0x3b9aee[_0x1fda94(0x19c)]==_0x5a44ba['product_name']&&_0x3b9aee[_0x1fda94(0x1cf)]==_0x5a44ba['bay']&&(_0x3b9aee[_0x1fda94(0x1ab)]=parseInt(_0x3b9aee[_0x1fda94(0x1ab)])+parseInt(_0x5a44ba[_0x1fda94(0x1e4)]),_0x464f7c++);});_0x464f7c=='0'&&(_0x24681a[_0x40a137(0x1f8)]=_0x24681a[_0x40a137(0x1f8)][_0x40a137(0x184)]({'product_name':_0x5a44ba[_0x40a137(0x19c)],'product_stock':_0x5a44ba['quantity'],'primary_code':_0x5a44ba[_0x40a137(0x262)],'secondary_code':_0x5a44ba['secondary_code'],'product_code':_0x5a44ba[_0x40a137(0x232)],'bay':_0x5a44ba[_0x40a137(0x1cf)],'maxProducts':_0x5a44ba[_0x40a137(0x1c4)],'unit':_0x5a44ba[_0x40a137(0x1fd)],'secondary_unit':_0x5a44ba[_0x40a137(0x266)],'expiry_date':_0x5a44ba[_0x40a137(0x252)]}));}),await _0x24681a[_0x1ebdae(0x1e8)]();const _0x4073ff=await s_payment_data[_0x1ebdae(0x1a1)]({'invoice':_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x1a9)]});if(_0x4073ff===null){}else console[_0x1ebdae(0x1a5)](_0x1ebdae(0x1cc),_0x4073ff,_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x1a9)]),_0x4073ff[_0x1ebdae(0x1cc)]=_0xdd9ea[_0x1ebdae(0x22c)][_0x1ebdae(0x1cc)],await _0x4073ff[_0x1ebdae(0x1e8)]();_0xdd9ea[_0x1ebdae(0x1c7)](_0x1ebdae(0x237),'purchase\x20data\x20update\x20successfully'),_0x4831f5[_0x1ebdae(0x264)](_0x1ebdae(0x21a));}catch(_0x4bde25){console[_0x1ebdae(0x1a5)](_0x4bde25);}}),router[a0_0x5c2e34(0x1d2)](a0_0x5c2e34(0x21e),auth,async(_0x3a2721,_0xba0093)=>{var _0x27bba0=a0_0x5c2e34;try{const _0x229ab1=_0x3a2721[_0x27bba0(0x1b7)]['id'],{invoice:_0x1e081d,suppliers:_0x279b52,payable:_0x4d9f86,due_amount:_0x510355}=_0x3a2721[_0x27bba0(0x22c)],_0x39eb4f=await purchases[_0x27bba0(0x197)](_0x229ab1);var _0x42bdd7=_0x4d9f86-_0x510355;_0x39eb4f[_0x27bba0(0x1d1)]=parseFloat(_0x39eb4f[_0x27bba0(0x1d1)])+parseFloat(_0x510355),_0x39eb4f[_0x27bba0(0x19b)]=_0x42bdd7;const _0x191202=await _0x39eb4f['save']();console[_0x27bba0(0x1a5)](_0x191202);const _0x2d6698=await s_payment_data[_0x27bba0(0x1a1)]({'invoice':_0x1e081d});_0x2d6698['amount']=_0x42bdd7,await _0x2d6698['save']();let _0x17ff56=new Date(),_0x365e7d=('0'+_0x17ff56['getDate']())['slice'](-0x2),_0x50d410=('0'+(_0x17ff56[_0x27bba0(0x259)]()+0x1))[_0x27bba0(0x1cd)](-0x2),_0x54e21a=_0x17ff56[_0x27bba0(0x26e)](),_0x5de7dd=_0x54e21a+'-'+_0x50d410+'-'+_0x365e7d;const _0x2aca1c=new suppliers_payment({'invoice':_0x1e081d,'date':_0x54e21a+'-'+_0x50d410+'-'+_0x365e7d,'suppliers':_0x279b52,'reason':'Paid\x20For\x20Purchase','amount':_0x510355}),_0xa0c1ef=await _0x2aca1c[_0x27bba0(0x1e8)]();_0x3a2721[_0x27bba0(0x1c7)](_0x27bba0(0x237),_0x27bba0(0x1f3)),_0xba0093[_0x27bba0(0x264)]('/all_purchases/view');}catch(_0x3a0290){console['log'](_0x3a0290);}}),router[a0_0x5c2e34(0x1dc)](a0_0x5c2e34(0x225),auth,async(_0x53d588,_0x5d6ddb)=>{var _0x5af3ce=a0_0x5c2e34;try{const {username:_0x26f9f0,email:_0x3e3683,role:_0x488560}=_0x53d588['user'],_0x547940=_0x53d588[_0x5af3ce(0x1ed)],_0x1574bf=await profile['findOne']({'email':_0x547940[_0x5af3ce(0x1af)]}),_0x43044e=await master_shop[_0x5af3ce(0x1a4)]();console[_0x5af3ce(0x1a5)](_0x5af3ce(0x21b),_0x43044e);const _0x160c4f=_0x53d588['params']['id'],_0x507350=await purchases[_0x5af3ce(0x197)](_0x160c4f);console[_0x5af3ce(0x1a5)](_0x507350);const _0x2ee892=await suppliers['findOne']({'name':_0x507350[_0x5af3ce(0x1cc)]});console['log'](_0x2ee892);if(_0x43044e[0x0][_0x5af3ce(0x1d5)]==_0x5af3ce(0x239)){var _0x22d7e8=users[_0x5af3ce(0x1cb)];console[_0x5af3ce(0x1a5)](_0x22d7e8);}else{if(_0x43044e[0x0][_0x5af3ce(0x1d5)]==_0x5af3ce(0x1ef))var _0x22d7e8=users[_0x5af3ce(0x1ef)];else{if(_0x43044e[0x0][_0x5af3ce(0x1d5)]=='German')var _0x22d7e8=users['German'];else{if(_0x43044e[0x0][_0x5af3ce(0x1d5)]=='Spanish')var _0x22d7e8=users[_0x5af3ce(0x18a)];else{if(_0x43044e[0x0][_0x5af3ce(0x1d5)]==_0x5af3ce(0x183))var _0x22d7e8=users['French'];else{if(_0x43044e[0x0][_0x5af3ce(0x1d5)]==_0x5af3ce(0x19e))var _0x22d7e8=users[_0x5af3ce(0x26f)];else{if(_0x43044e[0x0][_0x5af3ce(0x1d5)]==_0x5af3ce(0x276))var _0x22d7e8=users[_0x5af3ce(0x276)];else{if(_0x43044e[0x0]['language']==_0x5af3ce(0x1f1))var _0x22d7e8=users['Arabic'];}}}}}}}_0x5d6ddb[_0x5af3ce(0x192)](_0x5af3ce(0x1b8),{'success':_0x53d588[_0x5af3ce(0x1c7)](_0x5af3ce(0x237)),'errors':_0x53d588[_0x5af3ce(0x1c7)](_0x5af3ce(0x1ac)),'role':_0x547940,'profile':_0x1574bf,'master_shop':_0x43044e,'supplier':_0x2ee892,'purchase':_0x507350,'language':_0x22d7e8});}catch(_0x4642c2){console['log'](_0x4642c2);}}),router[a0_0x5c2e34(0x1dc)](a0_0x5c2e34(0x27f),auth,async(_0x1912fd,_0x539370)=>{var _0x4cc8a3=a0_0x5c2e34;try{const {username:_0x44a157,email:_0x1b2b5a,role:_0x1d3e54}=_0x1912fd[_0x4cc8a3(0x1ed)],_0x1c8471=_0x1912fd[_0x4cc8a3(0x1ed)],_0x25d70e=await profile[_0x4cc8a3(0x1a1)]({'email':_0x1c8471[_0x4cc8a3(0x1af)]}),_0x5718b2=await master_shop['find']();console['log'](_0x4cc8a3(0x21b),_0x5718b2);const _0x387731=_0x1912fd[_0x4cc8a3(0x1b7)]['id'];console[_0x4cc8a3(0x1a5)](_0x387731);const _0x56746a=await purchases_finished[_0x4cc8a3(0x197)](_0x387731);console[_0x4cc8a3(0x1a5)](_0x4cc8a3(0x22b),_0x56746a);const _0x5a9ddb=await product['find']({}),_0x25d37e=await warehouse[_0x4cc8a3(0x1fa)]([{'$match':{'name':_0x56746a[_0x4cc8a3(0x19f)],'room':_0x56746a[_0x4cc8a3(0x21f)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4cc8a3(0x274),'name':{'$first':_0x4cc8a3(0x243)},'product_stock':{'$first':_0x4cc8a3(0x255)},'bay':{'$first':_0x4cc8a3(0x273)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4cc8a3(0x220)},'floorlevel':{'$first':_0x4cc8a3(0x1fe)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4cc8a3(0x277)},'product_code':{'$first':_0x4cc8a3(0x1c6)},'storage':{'$first':_0x4cc8a3(0x194)},'rack':{'$first':_0x4cc8a3(0x1d3)}}}]);console[_0x4cc8a3(0x1a5)](_0x4cc8a3(0x1f2),_0x25d37e);let _0xfd24b9;if(_0x1c8471[_0x4cc8a3(0x265)]==_0x4cc8a3(0x1f0)){const _0x4d5c46=await staff['findOne']({'email':_0x1c8471[_0x4cc8a3(0x1af)]});_0xfd24b9=await warehouse[_0x4cc8a3(0x1a4)]({'status':_0x4cc8a3(0x1e5),'name':_0x4d5c46[_0x4cc8a3(0x1e1)],'warehouse_category':_0x4cc8a3(0x1a8),'name':'Return\x20Goods'});}else _0xfd24b9=await warehouse['aggregate']([{'$match':{'status':_0x4cc8a3(0x1e5),'warehouse_category':_0x4cc8a3(0x1a8),'name':_0x4cc8a3(0x1b3)}},{'$group':{'_id':_0x4cc8a3(0x200),'name':{'$first':_0x4cc8a3(0x200)}}}]);if(_0x5718b2[0x0][_0x4cc8a3(0x1d5)]==_0x4cc8a3(0x239)){var _0x27937e=users[_0x4cc8a3(0x1cb)];console[_0x4cc8a3(0x1a5)](_0x27937e);}else{if(_0x5718b2[0x0][_0x4cc8a3(0x1d5)]==_0x4cc8a3(0x1ef))var _0x27937e=users[_0x4cc8a3(0x1ef)];else{if(_0x5718b2[0x0]['language']==_0x4cc8a3(0x247))var _0x27937e=users[_0x4cc8a3(0x247)];else{if(_0x5718b2[0x0][_0x4cc8a3(0x1d5)]==_0x4cc8a3(0x18a))var _0x27937e=users[_0x4cc8a3(0x18a)];else{if(_0x5718b2[0x0][_0x4cc8a3(0x1d5)]==_0x4cc8a3(0x183))var _0x27937e=users[_0x4cc8a3(0x183)];else{if(_0x5718b2[0x0][_0x4cc8a3(0x1d5)]==_0x4cc8a3(0x19e))var _0x27937e=users[_0x4cc8a3(0x26f)];else{if(_0x5718b2[0x0]['language']=='Chinese')var _0x27937e=users[_0x4cc8a3(0x276)];else{if(_0x5718b2[0x0][_0x4cc8a3(0x1d5)]==_0x4cc8a3(0x1f1))var _0x27937e=users['Arabic'];}}}}}}}_0x539370[_0x4cc8a3(0x192)](_0x4cc8a3(0x235),{'success':_0x1912fd[_0x4cc8a3(0x1c7)](_0x4cc8a3(0x237)),'errors':_0x1912fd[_0x4cc8a3(0x1c7)](_0x4cc8a3(0x1ac)),'role':_0x1c8471,'profile':_0x25d70e,'user':_0x56746a,'stock':_0x25d37e,'master_shop':_0x5718b2,'product':_0x5a9ddb,'language':_0x27937e,'warehouse':_0xfd24b9});}catch(_0x16baf7){console[_0x4cc8a3(0x1a5)](_0x16baf7);}}),router[a0_0x5c2e34(0x1d2)](a0_0x5c2e34(0x27f),auth,async(_0x3a85d1,_0x3a3528)=>{var _0x4c1205=a0_0x5c2e34;try{const {invoice:_0x383fc8,date:_0x910782,warehouse_name:_0x415ab9,Room_name:_0x5f17c9,product_name:_0xfa42ce,purchase_quantity:_0x37ac2f,stocks:_0x11e8dc,return_qty:_0x166303,note:_0x5b717a,level:_0x1a6458,isle:_0x2df998,pallet:_0x430573,to_warehouse_name:_0x6a9af,to_Room_name:_0x99bbe3}=_0x3a85d1[_0x4c1205(0x22c)],_0x117fd2=await purchases_finished[_0x4c1205(0x1a1)]({'_id':_0x3a85d1[_0x4c1205(0x1b7)]['id']}),_0x502591=await warehouse['findOne']({'name':_0x415ab9,'room':_0x5f17c9,'warehouse_category':'Finished\x20Goods'});if(typeof _0xfa42ce==_0x4c1205(0x1ee))var _0x3691b8=[_0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x19c)]],_0x4ae38d=[_0x3a85d1['body']['purchase_quantity']],_0x216c72=[_0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x1b5)]],_0x84e73a=[_0x3a85d1[_0x4c1205(0x22c)]['return_qty']],_0x533d30=[_0x3a85d1[_0x4c1205(0x22c)]['level']],_0x260103=[_0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x256)]],_0x2f2194=[_0x3a85d1[_0x4c1205(0x22c)]['primary_code_hide']],_0x1c1c92=[_0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x1e2)]];else var _0x3691b8=[..._0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x19c)]],_0x4ae38d=[..._0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x272)]],_0x216c72=[..._0x3a85d1[_0x4c1205(0x22c)]['stocks']],_0x84e73a=[..._0x3a85d1[_0x4c1205(0x22c)]['return_qty']],_0x533d30=[..._0x3a85d1['body'][_0x4c1205(0x213)]],_0x260103=[..._0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x256)]],_0x2f2194=[..._0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x207)]],_0x1c1c92=[..._0x3a85d1['body'][_0x4c1205(0x1e2)]];const _0x583f39=_0x3691b8['map'](_0x595905=>{return _0x595905={'product_name':_0x595905};});_0x4ae38d[_0x4c1205(0x1f4)]((_0x3c7d9c,_0x52c785)=>{var _0x513209=_0x4c1205;_0x583f39[_0x52c785][_0x513209(0x272)]=_0x3c7d9c;}),_0x216c72[_0x4c1205(0x1f4)]((_0x46b0be,_0x52d1ae)=>{var _0x4c0c2e=_0x4c1205;_0x583f39[_0x52d1ae][_0x4c0c2e(0x27a)]=_0x46b0be;}),_0x84e73a[_0x4c1205(0x1f4)]((_0x1e632b,_0x34c870)=>{var _0x115783=_0x4c1205;_0x583f39[_0x34c870][_0x115783(0x245)]=_0x1e632b;}),_0x533d30[_0x4c1205(0x1f4)]((_0x420cb5,_0x1867fd)=>{var _0x1cb580=_0x4c1205;_0x583f39[_0x1867fd][_0x1cb580(0x1cf)]=_0x420cb5;}),_0x260103[_0x4c1205(0x1f4)]((_0xa4a070,_0x1fd94e)=>{var _0x304c23=_0x4c1205;_0x583f39[_0x1fd94e][_0x304c23(0x232)]=_0xa4a070;}),_0x2f2194['forEach']((_0x49e4ea,_0x876ead)=>{var _0x36e423=_0x4c1205;_0x583f39[_0x876ead][_0x36e423(0x262)]=_0x49e4ea;}),_0x1c1c92[_0x4c1205(0x1f4)]((_0xb5c1bb,_0x33985c)=>{_0x583f39[_0x33985c]['secondary_code']=_0xb5c1bb;}),_0x583f39['forEach'](_0x351b6e=>{var _0x5c4bff=_0x4c1205;console[_0x5c4bff(0x1a5)](_0x351b6e);const _0x415960=_0x502591[_0x5c4bff(0x1f8)]['map'](_0x3a182e=>{var _0x112222=_0x5c4bff;_0x3a182e[_0x112222(0x19c)]==_0x351b6e[_0x112222(0x19c)]&&_0x3a182e[_0x112222(0x1cf)]==_0x351b6e[_0x112222(0x1cf)]&&(console[_0x112222(0x1a5)](parseInt(_0x3a182e[_0x112222(0x1ab)])+'\x20<>\x20'+parseInt(_0x351b6e[_0x112222(0x245)])),_0x3a182e[_0x112222(0x1ab)]=parseInt(_0x3a182e['product_stock'])-parseInt(_0x351b6e[_0x112222(0x245)]));});}),await _0x502591[_0x4c1205(0x1e8)]();var _0x4c33f2=0x0;_0x583f39[_0x4c1205(0x1f4)](_0x2d4064=>{var _0x54665e=_0x4c1205;(parseInt(_0x2d4064['purchase_quantity'])<parseInt(_0x2d4064[_0x54665e(0x245)])||parseInt(_0x2d4064[_0x54665e(0x27a)])<parseInt(_0x2d4064[_0x54665e(0x245)]))&&_0x4c33f2++;});if(_0x4c33f2!=0x0)return _0x3a85d1[_0x4c1205(0x1c7)]('errors',_0x4c1205(0x216)),_0x3a3528[_0x4c1205(0x264)](_0x4c1205(0x271));const _0x4f88fb=new purchases_return_finished({'invoice':_0x383fc8,'suppliers':_0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x1cc)],'date':_0x910782,'warehouse_name':_0x415ab9,'return_product':_0x583f39,'note':_0x5b717a,'room':_0x5f17c9,'to_warehouse_name':_0x6a9af,'to_room':_0x99bbe3}),_0x176cb4=await _0x4f88fb['save'](),_0x43342e=await purchases_return_finished[_0x4c1205(0x1a1)]({'invoice':_0x383fc8}),_0x4a835c=await warehouse['findOne']({'name':_0x6a9af,'room':_0x99bbe3,'warehouse_category':_0x4c1205(0x1a8)});_0x43342e[_0x4c1205(0x23d)]['forEach'](_0x354dd5=>{var _0x1f9188=_0x4c1205,_0xd5e434=0x0;const _0x43ca41=_0x4a835c[_0x1f9188(0x1f8)][_0x1f9188(0x1bb)](_0x1f51d4=>{var _0x2d70f9=_0x1f9188;console['log'](_0x1f51d4['product_name']+'=='+_0x354dd5['product_name']+'&&'+_0x1f51d4['bay']+'=='+_0x354dd5[_0x2d70f9(0x1cf)]),_0x1f51d4[_0x2d70f9(0x19c)]==_0x354dd5['product_name']&&_0x1f51d4[_0x2d70f9(0x1cf)]==_0x354dd5['bay']&&(_0x1f51d4[_0x2d70f9(0x1ab)]=parseInt(_0x1f51d4[_0x2d70f9(0x1ab)])-parseInt(_0x354dd5[_0x2d70f9(0x245)]),_0xd5e434++);});_0xd5e434=='0'&&(_0x4a835c['product_details']=_0x4a835c[_0x1f9188(0x1f8)][_0x1f9188(0x184)]({'product_name':_0x354dd5[_0x1f9188(0x19c)],'product_stock':_0x354dd5[_0x1f9188(0x245)],'primary_code':_0x354dd5[_0x1f9188(0x262)],'secondary_code':_0x354dd5['secondary_code'],'product_code':_0x354dd5[_0x1f9188(0x232)],'bay':_0x354dd5[_0x1f9188(0x1cf)],'maxProducts':0xf423f}));}),await _0x4a835c[_0x4c1205(0x1e8)]();const _0x140902=await purchases_finished[_0x4c1205(0x1a1)]({'invoice':_0x383fc8});_0x140902[_0x4c1205(0x230)]=_0x4c1205(0x221);const _0x4d623e=await _0x140902['save'](),_0x5ba296=new s_payment_data({'invoice':_0x383fc8,'suppliers':_0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x1cc)],'reason':'Purchase\x20Return'});await _0x5ba296[_0x4c1205(0x1e8)]();const _0x4f7651=await master_shop[_0x4c1205(0x1a4)](),_0x299254=await email_settings[_0x4c1205(0x1a1)](),_0x1c36e1=await suppliers[_0x4c1205(0x1a1)]({'name':_0x3a85d1[_0x4c1205(0x22c)][_0x4c1205(0x1cc)]});_0x4f7651[0x0][_0x4c1205(0x279)]==0x1?(right_currency=_0x4f7651[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4f7651[0x0]['currency']);var _0x1bb336=_0x3691b8,_0x3ae80b=_0x84e73a,_0x4862fb='',_0x1c5fe2;for(_0x1c5fe2 in _0x1bb336){_0x4862fb+=_0x4c1205(0x260)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1bb336[_0x1c5fe2]+_0x4c1205(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3ae80b[_0x1c5fe2]+_0x4c1205(0x236)+_0x4c1205(0x1a7);}let _0x3c36ae=nodemailer[_0x4c1205(0x1c0)]({'service':_0x4c1205(0x19d),'auth':{'user':_0x299254[_0x4c1205(0x1af)],'pass':_0x299254[_0x4c1205(0x198)]}}),_0x555758={'from':_0x299254['email'],'to':_0x1c36e1[_0x4c1205(0x1af)],'subject':_0x4c1205(0x240),'attachments':[{'filename':_0x4c1205(0x189),'path':__dirname+_0x4c1205(0x19a)+'/upload/'+_0x4f7651[0x0][_0x4c1205(0x187)],'cid':_0x4c1205(0x1b2)}],'html':'<!DOCTYPE\x20html>'+_0x4c1205(0x268)+_0x4c1205(0x234)+_0x4c1205(0x203)+_0x4c1205(0x1ea)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4c1205(0x278)+_0x4c1205(0x203)+'<h2>\x20'+_0x4f7651[0x0]['site_title']+'\x20</h2>'+_0x4c1205(0x278)+_0x4c1205(0x278)+_0x4c1205(0x23e)+_0x4c1205(0x203)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4c1205(0x1f9)+_0x383fc8+'\x20'+_0x4c1205(0x257)+_0x4c1205(0x227)+_0x910782+'\x20'+_0x4c1205(0x242)+_0x4c1205(0x18c)+_0x4c1205(0x278)+_0x4c1205(0x27d)+_0x4c1205(0x21c)+_0x4c1205(0x260)+_0x4c1205(0x269)+_0x4c1205(0x1d9)+_0x4c1205(0x209)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x4c1205(0x1a7)+_0x4c1205(0x219)+_0x4c1205(0x23a)+'\x20'+_0x4862fb+'\x20'+_0x4c1205(0x229)+_0x4c1205(0x18d)+_0x4c1205(0x203)+_0x4c1205(0x1d7)+_0x4c1205(0x186)+_0x4f7651[0x0][_0x4c1205(0x20d)]+_0x4c1205(0x18c)+_0x4c1205(0x278)+_0x4c1205(0x278)+_0x4c1205(0x1bf)};_0x3c36ae[_0x4c1205(0x193)](_0x555758,function(_0x4f30d5,_0x498c3b){var _0x3d94f9=_0x4c1205;_0x4f30d5?console[_0x3d94f9(0x1a5)](_0x3d94f9(0x246)):console[_0x3d94f9(0x1a5)]('Email\x20sent\x20successfully');}),_0x3a85d1[_0x4c1205(0x1c7)](_0x4c1205(0x237),'purchases\x20item\x20return\x20successfull'),_0x3a3528['redirect'](_0x4c1205(0x21a));}catch(_0x546afd){_0x3a3528[_0x4c1205(0x1f7)](0xc8)[_0x4c1205(0x1b9)]({'message':_0x546afd[_0x4c1205(0x1ce)]});}}),router[a0_0x5c2e34(0x1dc)](a0_0x5c2e34(0x22e),auth,async(_0x3914e2,_0x1ea89d)=>{var _0x540558=a0_0x5c2e34;try{const {username:_0x91aa7c,email:_0x4a5ad7,role:_0x24b01c}=_0x3914e2['user'],_0x113d83=_0x3914e2[_0x540558(0x1ed)],_0x27123f=await profile[_0x540558(0x1a1)]({'email':_0x113d83[_0x540558(0x1af)]}),_0x28390f=await master_shop[_0x540558(0x1a4)](),_0x409885=_0x3914e2[_0x540558(0x1b7)]['id'],_0x4edfc8=await purchases_finished[_0x540558(0x197)](_0x409885);if(_0x28390f[0x0][_0x540558(0x1d5)]==_0x540558(0x239))var _0x458e01=users['English'];else{if(_0x28390f[0x0][_0x540558(0x1d5)]==_0x540558(0x1ef))var _0x458e01=users[_0x540558(0x1ef)];else{if(_0x28390f[0x0][_0x540558(0x1d5)]==_0x540558(0x247))var _0x458e01=users[_0x540558(0x247)];else{if(_0x28390f[0x0]['language']==_0x540558(0x18a))var _0x458e01=users[_0x540558(0x18a)];else{if(_0x28390f[0x0][_0x540558(0x1d5)]==_0x540558(0x183))var _0x458e01=users['French'];else{if(_0x28390f[0x0]['language']==_0x540558(0x19e))var _0x458e01=users[_0x540558(0x26f)];else{if(_0x28390f[0x0][_0x540558(0x1d5)]==_0x540558(0x276))var _0x458e01=users[_0x540558(0x276)];else{if(_0x28390f[0x0][_0x540558(0x1d5)]==_0x540558(0x1f1))var _0x458e01=users[_0x540558(0x26d)];}}}}}}}_0x1ea89d[_0x540558(0x192)](_0x540558(0x1f5),{'success':_0x3914e2[_0x540558(0x1c7)](_0x540558(0x237)),'errors':_0x3914e2[_0x540558(0x1c7)](_0x540558(0x1ac)),'role':_0x113d83,'profile':_0x27123f,'alldata':_0x4edfc8,'master_shop':_0x28390f,'language':_0x458e01}),console[_0x540558(0x1a5)](alldata);}catch(_0x5c7c04){console[_0x540558(0x1a5)](_0x5c7c04);}}),router[a0_0x5c2e34(0x1d2)]('/barcode_scanner',async(_0x59412c,_0x576a2d)=>{var _0x4604c0=a0_0x5c2e34;const {product_code:_0x2a3982}=_0x59412c['body'];var _0x2d5f98;const _0x3ab448=await product[_0x4604c0(0x1fa)]([{'$match':{'primary_code':_0x2a3982,'product_category':_0x4604c0(0x1a8)}},{'$group':{'_id':_0x4604c0(0x251),'name':{'$first':'$name'},'category':{'$first':_0x4604c0(0x267)},'brand':{'$first':_0x4604c0(0x231)},'unit':{'$first':_0x4604c0(0x258)},'alertquantity':{'$first':_0x4604c0(0x1f6)},'product_code':{'$first':_0x4604c0(0x22f)},'primary_code':{'$first':_0x4604c0(0x1a6)},'secondary_code':{'$first':_0x4604c0(0x249)},'maxStocks':{'$first':_0x4604c0(0x20f)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4604c0(0x211)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3c4047=await product[_0x4604c0(0x1fa)]([{'$match':{'secondary_code':_0x2a3982}},{'$group':{'_id':_0x4604c0(0x251),'name':{'$first':_0x4604c0(0x200)},'category':{'$first':_0x4604c0(0x267)},'brand':{'$first':_0x4604c0(0x231)},'unit':{'$first':_0x4604c0(0x258)},'alertquantity':{'$first':_0x4604c0(0x1f6)},'product_code':{'$first':_0x4604c0(0x22f)},'primary_code':{'$first':_0x4604c0(0x1a6)},'secondary_code':{'$first':_0x4604c0(0x249)},'maxStocks':{'$first':_0x4604c0(0x20f)},'maxProdPerUnit':{'$first':_0x4604c0(0x1d0)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4604c0(0x211)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3ab448[_0x4604c0(0x1d4)]>0x0)_0x2d5f98=_0x3ab448;else _0x3c4047[_0x4604c0(0x1d4)]>0x0&&(_0x2d5f98=_0x3c4047);_0x576a2d[_0x4604c0(0x1b9)](_0x2d5f98);}),router[a0_0x5c2e34(0x1d2)](a0_0x5c2e34(0x1d8),async(_0x2543d2,_0x3cadef)=>{var _0x5923d8=a0_0x5c2e34;const {productCode:_0x5eaaa6,bay:_0x25a9e5,warehouses:_0x3b80f1,room:_0x34cdad}=_0x2543d2[_0x5923d8(0x22c)];console[_0x5923d8(0x1a5)](_0x2543d2[_0x5923d8(0x22c)]);try{const _0x1da0f9=await warehouse['aggregate']([{'$match':{'name':_0x3b80f1,'room':_0x34cdad}},{'$unwind':_0x5923d8(0x1b1)},{'$match':{'product_details.bay':parseInt(_0x25a9e5)}},{'$group':{'_id':_0x5923d8(0x274),'name':{'$first':_0x5923d8(0x243)},'product_stock':{'$first':_0x5923d8(0x255)},'bay':{'$first':_0x5923d8(0x273)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x3cadef['status'](0xc8)[_0x5923d8(0x1b9)](_0x1da0f9);}catch(_0x1017d6){_0x3cadef[_0x5923d8(0x1f7)](0x194)['json']({'message':_0x1017d6[_0x5923d8(0x1ce)]});}}),module['exports']=router;