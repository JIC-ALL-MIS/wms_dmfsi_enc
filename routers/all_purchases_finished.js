var a0_0x4bd3da=a0_0x525e;(function(_0x3b75bf,_0x249eab){var _0x13c2b2=a0_0x525e,_0x46c84c=_0x3b75bf();while(!![]){try{var _0x1479dd=-parseInt(_0x13c2b2(0x21f))/0x1+-parseInt(_0x13c2b2(0x1b2))/0x2*(parseInt(_0x13c2b2(0x1d5))/0x3)+parseInt(_0x13c2b2(0x1f9))/0x4+-parseInt(_0x13c2b2(0x1c3))/0x5*(-parseInt(_0x13c2b2(0x1ca))/0x6)+-parseInt(_0x13c2b2(0x208))/0x7*(parseInt(_0x13c2b2(0x1aa))/0x8)+-parseInt(_0x13c2b2(0x236))/0x9*(parseInt(_0x13c2b2(0x1ff))/0xa)+parseInt(_0x13c2b2(0x1b5))/0xb;if(_0x1479dd===_0x249eab)break;else _0x46c84c['push'](_0x46c84c['shift']());}catch(_0x5bc9cd){_0x46c84c['push'](_0x46c84c['shift']());}}}(a0_0xac2b,0x67a88));const express=require(a0_0x4bd3da(0x195)),app=express(),router=express[a0_0x4bd3da(0x266)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x4bd3da(0x1a7)),auth=require(a0_0x4bd3da(0x28c)),nodemailer=require('nodemailer');var ejs=require(a0_0x4bd3da(0x1d4));const path=require(a0_0x4bd3da(0x1b8)),users=require(a0_0x4bd3da(0x211));function a0_0xac2b(){var _0x548469=['maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details','note','batch_code','/all_purchases_finished/view','prod_invoice','</td>','$maxStocks','prod_level','/give_payment/:id','<hr\x20class=\x22my-3\x22>','English\x20(US)','host','edit_purchases_finished','slice','email','site_title','room_name','$secondary_code','$product','/all_purchases/view','padStart','find','message','$brand','$maxProdPerUnit','quantity','aggregate','map','Purchase\x20Return\x20Mail','due_amount','production_date','$paid_amount','$category','$product_details.bay','$batch_code','bay','$product_details.primary_code','getMonth','findOne','purchase_quantity','Router','Rack\x202','$date','</body></html>','room','<tr>','suppliers_docs','log','payment\x20successfull','Finished\x20Goods','product_cat','</tr>','prod_code','secondary_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Spanish','Hindi','image','errors','FGSEmail','/CheckingWarehouse','secondary_code','<html><head><title></title>','$note','prod_cat','FROZEN\x20GOODS','$product_details.product_code','floor','$product.quantity','/view/add_purchases/:id','</thead>','$due_amount','</head><body>','name','product','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','\x20Order\x20Date\x20:\x20','../middleware/auth','Room_name','$room','Arabic\x20(ae)','invoice','Arabic','abs','/view/return_purchase/:id','Error\x20Occurs','/invoice/:id','length','/barcode_scanner','/upload/','express','English','</h5>','json','getFullYear','body','render','master','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','MaxStocks_data','prod_qty','$product.room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</span>','get','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','../models/all_models','exports','<table\x20style=\x22width:\x20100%\x20!important;\x22>','4168vOnlwh','product_code_hide','product_name','Return\x20Goods','purchase\x20data\x20update\x20successfully','_id','$product_details.floorlevel','edit_purchases_finished_view','26EuNDjQ','max_product_unit','secondary_unit','10817048eSLQgw','Logo.png','/view','path','/barcode/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','return_product','createTransport','Purchase\x20Mail','standard_unit','then','redirect','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','30fPDecY','prod_primunit','<span\x20style=\x22float:\x20right;\x22>','prod_unit','params','return_qty','$unit','818118HhELZS','Enabled','<strong>\x20Regards\x20</strong>','Portuguese','$product.floorlevel','purchase\x20data\x20add\x20successfully','$secondary_unit','RoomAssign','level','warehouse','ejs','149322VEHtiY','product_stock','$product.bay','add_purchases_finished','$product_details.maxProducts','currency','True','$_id','maxperunit','findById','Enclosed','warehouse_name','currency_placement','Email\x20sent\x20successfully','$alertquantity','purchase_invoice','Rack\x201','suppliers','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','catch','stocks','toString','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','user','INCF-','getDate','</div>','$product_details.product_name','role','Error\x20occurred\x20while\x20processing\x20product:','prod_Qty','$warehouse_name','post','POnumber','<h5\x20style=\x22text-align:\x20left;\x22>','\x20</h2>','1509412FyqHZd','$return_data','/preview/:id','password','$product_details.bin','/../public','30JIecAG','<h2>\x20','user_id','all','status','<h5>','stock_quantity','string','flash','9233uNoRXb','$name','return_purchase_finished','updateOne','staff','Chinese','$suppliers','$product_details.secondary_code','</table>','../public/language/languages.json','concat','stock_data','add_purchases\x20error','$product_code','paid_amount','$invoice','prod_secondunit','Purchase\x20Return','language','$primary_code','product_date','filter','primary_code','236160lKCasW','$suppliers_docs','Ambient','table\x20page','</tbody>','save','$product_details.product_stock','sendMail','product_details','back','date','$product_details.type','error','German','product_code','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Portuguese\x20(BR)','$product.type','/view/:id','all_purchases_barcode','success','551502zTEPxa','<div>','forEach','expiry_date','French','primary_code_hide'];a0_0xac2b=function(){return _0x548469;};return a0_0xac2b();}router[a0_0x4bd3da(0x1a4)](a0_0x4bd3da(0x1b7),auth,async(_0x56c929,_0x39f387)=>{var _0x4cb833=a0_0x4bd3da;try{const {username:_0x2c050a,email:_0x16d981,role:_0x59d73a}=_0x56c929[_0x4cb833(0x1ec)],_0x2359b7=_0x56c929[_0x4cb833(0x1ec)],_0x2078dc=await profile[_0x4cb833(0x264)]({'email':_0x2359b7[_0x4cb833(0x24c)]}),_0x2de48f=await staff['findOne']({'email':_0x2359b7[_0x4cb833(0x24c)]});if(_0x2359b7[_0x4cb833(0x1f1)]=='staff'){const _0x33bfdd=await staff[_0x4cb833(0x264)]({'email':_0x2359b7[_0x4cb833(0x24c)]});}const _0x42751c=await master_shop[_0x4cb833(0x253)]();let _0x54152e;if(_0x2359b7[_0x4cb833(0x1f1)]==_0x4cb833(0x20c)){const _0x163945=await staff['findOne']({'email':_0x2359b7[_0x4cb833(0x24c)]});_0x54152e=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x163945['warehouse']}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x4cb833(0x288),'as':_0x4cb833(0x26c)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x4cb833(0x250)},{'$group':{'_id':_0x4cb833(0x1dc),'invoice':{'$first':_0x4cb833(0x217)},'suppliers':{'$first':_0x4cb833(0x20e)},'date':{'$first':_0x4cb833(0x268)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x4cb833(0x28e)},'product':{'$push':_0x4cb833(0x250)},'note':{'$first':_0x4cb833(0x27e)},'paid_amount':{'$first':_0x4cb833(0x25d)},'due_amount':{'$first':_0x4cb833(0x286)},'return_data':{'$first':_0x4cb833(0x1fa)},'batch_code':{'$first':_0x4cb833(0x260)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x4cb833(0x283)},'level':{'$addToSet':_0x4cb833(0x1d7)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x4cb833(0x232)},'floorlevel':{'$addToSet':_0x4cb833(0x1ce)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x54152e=await purchases_finished[_0x4cb833(0x258)]([{'$unwind':_0x4cb833(0x250)},{'$group':{'_id':_0x4cb833(0x1dc),'invoice':{'$first':_0x4cb833(0x217)},'suppliers':{'$first':_0x4cb833(0x20e)},'date':{'$first':_0x4cb833(0x268)},'warehouse_name':{'$first':_0x4cb833(0x1f4)},'room':{'$addToSet':_0x4cb833(0x1a1)},'product':{'$push':_0x4cb833(0x250)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x4cb833(0x25d)},'due_amount':{'$first':_0x4cb833(0x286)},'return_data':{'$first':_0x4cb833(0x1fa)},'batch_code':{'$first':_0x4cb833(0x260)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x4cb833(0x220)},'total_product_quantity':{'$sum':_0x4cb833(0x283)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x4cb833(0x232)},'floorlevel':{'$addToSet':_0x4cb833(0x1ce)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x42751c[0x0][_0x4cb833(0x21a)]=='English\x20(US)')var _0x468d52=users[_0x4cb833(0x196)];else{if(_0x42751c[0x0][_0x4cb833(0x21a)]=='Hindi')var _0x468d52=users[_0x4cb833(0x277)];else{if(_0x42751c[0x0][_0x4cb833(0x21a)]==_0x4cb833(0x22c))var _0x468d52=users[_0x4cb833(0x22c)];else{if(_0x42751c[0x0]['language']=='Spanish')var _0x468d52=users[_0x4cb833(0x276)];else{if(_0x42751c[0x0][_0x4cb833(0x21a)]==_0x4cb833(0x23a))var _0x468d52=users['French'];else{if(_0x42751c[0x0][_0x4cb833(0x21a)]==_0x4cb833(0x231))var _0x468d52=users[_0x4cb833(0x1cd)];else{if(_0x42751c[0x0]['language']==_0x4cb833(0x20d))var _0x468d52=users['Chinese'];else{if(_0x42751c[0x0][_0x4cb833(0x21a)]=='Arabic\x20(ae)')var _0x468d52=users[_0x4cb833(0x291)];}}}}}}}_0x39f387[_0x4cb833(0x19b)]('all_purchases_finished',{'success':_0x56c929[_0x4cb833(0x207)](_0x4cb833(0x235)),'errors':_0x56c929[_0x4cb833(0x207)](_0x4cb833(0x279)),'purchases':_0x54152e,'role':_0x2359b7,'profile':_0x2078dc,'master_shop':_0x42751c,'language':_0x468d52});}catch(_0x360a6b){console[_0x4cb833(0x26d)](_0x4cb833(0x222),_0x360a6b),_0x39f387[_0x4cb833(0x203)](0xc8)['json']({'message':_0x360a6b[_0x4cb833(0x254)]});}});function BayBinSelected(_0x2af4ef,_0x47876c){var _0x55854d=a0_0x4bd3da,_0x3a145f=[],_0xed7011=[];if(_0x2af4ef=='DRY\x20GOODS'){switch(_0x47876c){case _0x55854d(0x1e5):_0x3a145f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x55854d(0x267):_0x3a145f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0xed7011=['DG'];}else{if(_0x2af4ef==_0x55854d(0x280)){switch(_0x47876c){case _0x55854d(0x1e5):_0x3a145f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x3a145f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0xed7011=['FG'];}}return{'levels':_0x3a145f,'identify':_0xed7011};}async function getRandom8DigitNumber(){var _0x13b810=a0_0x4bd3da;const _0x31d86a=0x989680,_0xd3212a=0x5f5e0ff,_0x590505=Math[_0x13b810(0x282)](Math['random']()*(_0xd3212a-_0x31d86a+0x1))+_0x31d86a;var _0x21beff;const _0x44faa7=await purchases_finished[_0x13b810(0x264)]({'invoice':_0x13b810(0x1ed)+_0x590505});return _0x44faa7&&_0x44faa7[_0x13b810(0x192)]>0x0?_0x21beff='INCF-'+_0x590505:_0x21beff=_0x13b810(0x1ed)+_0x590505,_0x21beff;}function a0_0x525e(_0x4293f8,_0x3f9309){var _0xac2ba=a0_0xac2b();return a0_0x525e=function(_0x525ea8,_0x36df28){_0x525ea8=_0x525ea8-0x18e;var _0x479788=_0xac2ba[_0x525ea8];return _0x479788;},a0_0x525e(_0x4293f8,_0x3f9309);}router[a0_0x4bd3da(0x1a4)]('/view/add_purchases',auth,async(_0x2a31e6,_0x52c606)=>{var _0x1d5dd9=a0_0x4bd3da;try{const {username:_0x420250,email:_0x1d52cd,role:_0x22d2ab}=_0x2a31e6[_0x1d5dd9(0x1ec)],_0x465d12=_0x2a31e6[_0x1d5dd9(0x1ec)],_0x458638=await profile[_0x1d5dd9(0x264)]({'email':_0x465d12[_0x1d5dd9(0x24c)]}),_0x4df351=await master_shop[_0x1d5dd9(0x253)](),_0x426f0e=await staff[_0x1d5dd9(0x264)]({'email':_0x465d12[_0x1d5dd9(0x24c)]}),_0xceef96=await suppliers[_0x1d5dd9(0x253)]({});let _0x1ab0fc;if(_0x465d12['role']==_0x1d5dd9(0x20c)){const _0x322dd9=await staff[_0x1d5dd9(0x264)]({'email':_0x465d12[_0x1d5dd9(0x24c)]});_0x1ab0fc=await warehouse[_0x1d5dd9(0x258)]([{'$match':{'status':'Enabled','name':_0x322dd9[_0x1d5dd9(0x1d3)],'warehouse_category':_0x1d5dd9(0x26f)}},{'$group':{'_id':'$name','name':{'$first':_0x1d5dd9(0x209)}}}]);}else _0x1ab0fc=await warehouse[_0x1d5dd9(0x258)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x1d5dd9(0x209)}}}]);const _0x422672=await product['find']({}),_0x5b6539=await warehouse['find']({'status':_0x1d5dd9(0x1cb)}),_0x565c01=await purchases_finished[_0x1d5dd9(0x253)]({}),_0xa0f021=_0x565c01['length']+0x1,_0x345fbc=_0x1d5dd9(0x1ed)+_0xa0f021[_0x1d5dd9(0x1ea)]()[_0x1d5dd9(0x252)](0x5,'0');var _0x2e352d=[_0x1d5dd9(0x221),_0x1d5dd9(0x1df)];if(_0x4df351[0x0][_0x1d5dd9(0x21a)]=='English\x20(US)')var _0x31208f=users[_0x1d5dd9(0x196)];else{if(_0x4df351[0x0][_0x1d5dd9(0x21a)]==_0x1d5dd9(0x277))var _0x31208f=users[_0x1d5dd9(0x277)];else{if(_0x4df351[0x0][_0x1d5dd9(0x21a)]==_0x1d5dd9(0x22c))var _0x31208f=users[_0x1d5dd9(0x22c)];else{if(_0x4df351[0x0][_0x1d5dd9(0x21a)]=='Spanish')var _0x31208f=users['Spanish'];else{if(_0x4df351[0x0][_0x1d5dd9(0x21a)]==_0x1d5dd9(0x23a))var _0x31208f=users[_0x1d5dd9(0x23a)];else{if(_0x4df351[0x0][_0x1d5dd9(0x21a)]==_0x1d5dd9(0x231))var _0x31208f=users['Portuguese'];else{if(_0x4df351[0x0][_0x1d5dd9(0x21a)]=='Chinese')var _0x31208f=users['Chinese'];else{if(_0x4df351[0x0][_0x1d5dd9(0x21a)]==_0x1d5dd9(0x28f))var _0x31208f=users[_0x1d5dd9(0x291)];}}}}}}}const _0x2f6d67=getRandom8DigitNumber();_0x2f6d67['then'](_0x4a147a=>{var _0x5aa096=_0x1d5dd9;_0x52c606[_0x5aa096(0x19b)](_0x5aa096(0x1d8),{'success':_0x2a31e6['flash'](_0x5aa096(0x235)),'errors':_0x2a31e6[_0x5aa096(0x207)]('errors'),'role':_0x465d12,'profile':_0x458638,'suppliers':_0xceef96,'warehouse':_0x1ab0fc,'product':_0x422672,'invoice':_0x4a147a,'master_shop':_0x4df351,'language':_0x31208f,'find_data':_0x5b6539,'rooms_data':_0x2e352d});})[_0x1d5dd9(0x1e8)](_0x34ed97=>{var _0x406361=_0x1d5dd9;_0x2a31e6[_0x406361(0x207)](_0x406361(0x279),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x52c606[_0x406361(0x1c0)](_0x406361(0x241));});}catch(_0x39a7d2){console[_0x1d5dd9(0x26d)](_0x39a7d2);}}),router[a0_0x4bd3da(0x1a4)](a0_0x4bd3da(0x284),auth,async(_0x535fb0,_0x4905b2)=>{var _0x5b775b=a0_0x4bd3da;try{const _0x2be906=_0x535fb0['params']['id'];console[_0x5b775b(0x26d)](_0x2be906);const _0x89baa3=await master_shop[_0x5b775b(0x253)]();console['log'](_0x5b775b(0x19c),_0x89baa3);const _0x342335=await product[_0x5b775b(0x264)]({'name':_0x2be906});console[_0x5b775b(0x26d)]('product',_0x342335),_0x4905b2[_0x5b775b(0x203)](0xc8)['json']({'product_data':_0x342335,'master':_0x89baa3});}catch(_0x5f29a2){console['log'](_0x5b775b(0x214),_0x5f29a2);}}),router[a0_0x4bd3da(0x1f5)]('/view/add_purchases',auth,async(_0x1e7af8,_0x28e64c)=>{var _0x245509=a0_0x4bd3da;try{const {invoice:_0x5c2848,date:_0x3c2728,warehouse_name:_0x3e7f8d,prod_name:_0x2f6814,prod_code:_0x2efc9d,prod_qty:_0x1f870e,prod_unit:_0xd16aa7,prod_secondunit:_0x162f3f,prod_level:_0x17ee67,prod_isle:_0x3609cb,prod_pallet:_0x47f862,note:_0x10eba9,expiry_date:_0x91675c,batch_code:_0x1f766e,payable:_0x5e986c,due_amount:_0x27012f,Room_name:_0x5a5571,primary_code:_0x41567a,secondary_code:_0x971299,MaxStocks_data:_0x3636e0,PO_number:_0x156698,SCRN:_0x5cfde7,JO_number:_0x407f50}=_0x1e7af8[_0x245509(0x19a)];if(typeof _0x2f6814==_0x245509(0x206))var _0xde228=[_0x1e7af8['body'][_0x245509(0x1c1)]],_0x44382e=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x272)]],_0x37dd53=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x1f3)]],_0x5cdc60=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x1c4)]],_0x5a3592=[_0x1e7af8['body']['prod_secondunit']],_0x11faca=[_0x1e7af8[_0x245509(0x19a)]['prod_level']],_0x2ca3ec=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x21e)]],_0x405733=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x27c)]],_0x4026fc=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x19f)]],_0x14a58a=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x240)]],_0x51865e=[_0x1e7af8['body']['expiry_date']],_0x2f27b1=[_0x1e7af8['body'][_0x245509(0x21c)]],_0x4a6ecc=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x1b3)]],_0x419d43=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x27f)]],_0x18ed10=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x1d1)]],_0x4498e0=[_0x1e7af8[_0x245509(0x19a)][_0x245509(0x242)]];else var _0xde228=[..._0x1e7af8[_0x245509(0x19a)][_0x245509(0x1c1)]],_0x44382e=[..._0x1e7af8[_0x245509(0x19a)][_0x245509(0x272)]],_0x37dd53=[..._0x1e7af8[_0x245509(0x19a)][_0x245509(0x1f3)]],_0x5cdc60=[..._0x1e7af8[_0x245509(0x19a)][_0x245509(0x1c4)]],_0x5a3592=[..._0x1e7af8[_0x245509(0x19a)]['prod_secondunit']],_0x11faca=[..._0x1e7af8[_0x245509(0x19a)][_0x245509(0x245)]],_0x2ca3ec=[..._0x1e7af8[_0x245509(0x19a)]['primary_code']],_0x405733=[..._0x1e7af8[_0x245509(0x19a)][_0x245509(0x27c)]],_0x4026fc=[..._0x1e7af8[_0x245509(0x19a)]['MaxStocks_data']],_0x14a58a=[..._0x1e7af8[_0x245509(0x19a)]['batch_code']],_0x51865e=[..._0x1e7af8['body'][_0x245509(0x239)]],_0x2f27b1=[..._0x1e7af8[_0x245509(0x19a)][_0x245509(0x21c)]],_0x4a6ecc=[..._0x1e7af8[_0x245509(0x19a)][_0x245509(0x1b3)]],_0x419d43=[..._0x1e7af8[_0x245509(0x19a)][_0x245509(0x27f)]],_0x18ed10=[..._0x1e7af8[_0x245509(0x19a)][_0x245509(0x1d1)]],_0x4498e0=[..._0x1e7af8['body'][_0x245509(0x242)]];const _0x48c654=_0xde228[_0x245509(0x259)](_0x56f6b3=>{return _0x56f6b3={'product_name':_0x56f6b3};});_0x44382e[_0x245509(0x238)]((_0x4e2d30,_0x2f4983)=>{_0x48c654[_0x2f4983]['product_code']=_0x4e2d30;}),_0x37dd53[_0x245509(0x238)]((_0xe8a132,_0x15369a)=>{var _0x58ea91=_0x245509;_0x48c654[_0x15369a][_0x58ea91(0x257)]=Math[_0x58ea91(0x18e)](_0xe8a132);}),_0x5cdc60[_0x245509(0x238)]((_0x5b38a4,_0x20c6a9)=>{var _0x24635d=_0x245509;_0x48c654[_0x20c6a9][_0x24635d(0x1be)]=_0x5b38a4;}),_0x5a3592[_0x245509(0x238)]((_0xb15b05,_0x2b49f4)=>{var _0x529c39=_0x245509;_0x48c654[_0x2b49f4][_0x529c39(0x1b4)]=_0xb15b05;}),_0x11faca[_0x245509(0x238)]((_0x435710,_0x248729)=>{var _0x24a3e5=_0x245509;_0x48c654[_0x248729][_0x24a3e5(0x261)]=_0x435710;}),_0x2ca3ec[_0x245509(0x238)]((_0x598ed0,_0x49daf0)=>{var _0x199175=_0x245509;_0x48c654[_0x49daf0][_0x199175(0x21e)]=_0x598ed0;}),_0x405733[_0x245509(0x238)]((_0x5a57f9,_0x5aa36b)=>{_0x48c654[_0x5aa36b]['secondary_code']=_0x5a57f9;}),_0x4026fc['forEach']((_0x54f509,_0x32d812)=>{var _0xaed79a=_0x245509;_0x48c654[_0x32d812][_0xaed79a(0x23c)]=_0x54f509;}),_0x14a58a[_0x245509(0x238)]((_0x5170c4,_0x1efe5d)=>{var _0x2fb1da=_0x245509;_0x48c654[_0x1efe5d][_0x2fb1da(0x240)]=_0x5170c4;}),_0x51865e[_0x245509(0x238)]((_0xee25b3,_0x2e34d1)=>{var _0x2337e7=_0x245509;_0x48c654[_0x2e34d1][_0x2337e7(0x239)]=_0xee25b3;}),_0x2f27b1[_0x245509(0x238)]((_0x492c53,_0x2f8fd6)=>{var _0x13d509=_0x245509;_0x48c654[_0x2f8fd6][_0x13d509(0x25c)]=_0x492c53;}),_0x4a6ecc['forEach']((_0x589a1e,_0x3fca05)=>{var _0x37e90c=_0x245509;_0x48c654[_0x3fca05][_0x37e90c(0x1dd)]=_0x589a1e;}),_0x419d43['forEach']((_0x57d1d5,_0x128454)=>{var _0x111f05=_0x245509;_0x48c654[_0x128454][_0x111f05(0x270)]=_0x57d1d5;}),_0x18ed10[_0x245509(0x238)]((_0x3fc44e,_0x407f05)=>{var _0x118c71=_0x245509;_0x48c654[_0x407f05][_0x118c71(0x24e)]=_0x3fc44e;}),_0x4498e0[_0x245509(0x238)]((_0x1e9b97,_0x533ded)=>{var _0x56ecf0=_0x245509;_0x48c654[_0x533ded][_0x56ecf0(0x290)]=_0x1e9b97;});const _0xf32ea4=_0x48c654[_0x245509(0x21d)](_0x2addbb=>_0x2addbb[_0x245509(0x257)]!=='0'&&_0x2addbb[_0x245509(0x257)]!==''),_0x2ec73a=new purchases_finished({'invoice':_0x5c2848,'suppliers':_0x1e7af8[_0x245509(0x19a)][_0x245509(0x1e6)],'date':_0x3c2728,'warehouse_name':_0x3e7f8d,'product':_0xf32ea4,'note':_0x10eba9,'due_amount':_0x27012f,'room':_0x5a5571,'POnumber':_0x156698,'SCRN':_0x5cfde7,'JO_number':_0x407f50}),_0x4e18dc=await _0x2ec73a[_0x245509(0x224)](),_0x33ad34=await purchases_finished[_0x245509(0x264)]({'invoice':_0x5c2848}),_0x520858=_0x33ad34[_0x245509(0x289)]['map'](async _0x59064c=>{var _0x5ba4c5=_0x245509;try{var _0x319584=await warehouse[_0x5ba4c5(0x264)]({'name':_0x3e7f8d,'room':_0x59064c[_0x5ba4c5(0x24e)]}),_0x1603c5=0x0;const _0x385063=_0x319584[_0x5ba4c5(0x227)]['map'](_0x56083a=>{var _0x2de8a2=_0x5ba4c5;console[_0x2de8a2(0x26d)](_0x56083a['product_name']+'=='+_0x59064c[_0x2de8a2(0x1ac)]+'&&'+_0x56083a[_0x2de8a2(0x261)]+'=='+_0x59064c[_0x2de8a2(0x261)]+'&&'+_0x56083a[_0x2de8a2(0x239)]+'=='+_0x59064c[_0x2de8a2(0x239)]+'&&'+_0x56083a[_0x2de8a2(0x25c)]+'=='+_0x59064c['production_date']+'&&'+_0x56083a[_0x2de8a2(0x240)]+'=='+_0x59064c['batch_code']+'&&'+_0x56083a['invoice']+'=='+_0x33ad34[_0x2de8a2(0x290)]),_0x56083a[_0x2de8a2(0x1ac)]==_0x59064c[_0x2de8a2(0x1ac)]&&_0x56083a[_0x2de8a2(0x261)]==_0x59064c[_0x2de8a2(0x261)]&&_0x56083a['expiry_date']==_0x59064c[_0x2de8a2(0x239)]&&_0x56083a['production_date']==_0x59064c[_0x2de8a2(0x25c)]&&_0x56083a[_0x2de8a2(0x240)]==_0x59064c[_0x2de8a2(0x240)]&&_0x56083a[_0x2de8a2(0x290)]==_0x33ad34[_0x2de8a2(0x290)]&&(_0x56083a[_0x2de8a2(0x1d6)]=Math[_0x2de8a2(0x18e)](_0x56083a[_0x2de8a2(0x1d6)])+Math[_0x2de8a2(0x18e)](_0x59064c['quantity']),_0x1603c5++);});return _0x1603c5==0x0&&(_0x319584[_0x5ba4c5(0x227)]=_0x319584[_0x5ba4c5(0x227)]['concat']({'product_name':_0x59064c[_0x5ba4c5(0x1ac)],'product_stock':Math[_0x5ba4c5(0x18e)](_0x59064c[_0x5ba4c5(0x257)]),'primary_code':_0x59064c[_0x5ba4c5(0x21e)],'secondary_code':_0x59064c[_0x5ba4c5(0x27c)],'product_code':_0x59064c['product_code'],'bay':_0x59064c[_0x5ba4c5(0x261)],'maxProducts':_0x59064c[_0x5ba4c5(0x23c)],'unit':_0x59064c['standard_unit'],'secondary_unit':_0x59064c['secondary_unit'],'expiry_date':_0x59064c['expiry_date'],'production_date':_0x59064c[_0x5ba4c5(0x25c)],'maxProducts':_0x59064c['maxStocks'],'maxPerUnit':_0x59064c[_0x5ba4c5(0x1dd)],'batch_code':_0x59064c[_0x5ba4c5(0x240)],'product_cat':_0x59064c[_0x5ba4c5(0x270)],'invoice':_0x59064c[_0x5ba4c5(0x290)],'id_incoming':_0x59064c[_0x5ba4c5(0x1af)]})),_0x319584;}catch(_0x474652){return console['error'](_0x5ba4c5(0x1f2),_0x474652),null;}});Promise[_0x245509(0x202)](_0x520858)[_0x245509(0x1bf)](async _0x4a3786=>{var _0x5a666e=_0x245509;try{for(const _0x18548a of _0x4a3786){await warehouse[_0x5a666e(0x20b)]({'_id':_0x18548a[_0x5a666e(0x1af)]},{'$addToSet':{'product_details':{'$each':_0x18548a[_0x5a666e(0x227)]}}});}const _0x1961dc=await master_shop[_0x5a666e(0x253)](),_0x300561=await email_settings[_0x5a666e(0x264)](),_0x4c954f=await supervisor_settings[_0x5a666e(0x253)]();var _0x403584=_0x33ad34['product'],_0x2e454f='',_0x32a94a;for(_0x32a94a in _0x403584){var _0x336173='FG';_0x33ad34[_0x5a666e(0x1e0)]=='DRY\x20GOODS'&&(_0x336173='DG'),_0x2e454f+=_0x5a666e(0x26b)+_0x5a666e(0x230)+_0x403584[_0x32a94a][_0x5a666e(0x1ac)]+_0x5a666e(0x243)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x403584[_0x32a94a][_0x5a666e(0x22d)]+'</td>'+_0x5a666e(0x230)+_0x403584[_0x32a94a]['quantity']+_0x5a666e(0x243)+_0x5a666e(0x230)+_0x403584[_0x32a94a][_0x5a666e(0x1be)]+_0x5a666e(0x243)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x403584[_0x32a94a][_0x5a666e(0x1b4)]+_0x5a666e(0x243)+_0x5a666e(0x230)+_0x33ad34['warehouse_name']+_0x5a666e(0x243)+_0x5a666e(0x230)+_0x403584[_0x32a94a][_0x5a666e(0x24e)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x336173+_0x403584[_0x32a94a][_0x5a666e(0x261)]+_0x5a666e(0x243),_0x5a666e(0x271);}let _0x29e353=nodemailer[_0x5a666e(0x1bc)]({'host':_0x300561[_0x5a666e(0x249)],'port':Number(_0x300561['port']),'secure':![],'auth':{'user':_0x300561[_0x5a666e(0x24c)],'pass':_0x300561[_0x5a666e(0x1fc)]}}),_0x52602f={'from':_0x300561['email'],'to':_0x4c954f[0x0][_0x5a666e(0x27a)],'subject':_0x5a666e(0x1bd),'attachments':[{'filename':_0x5a666e(0x1b6),'path':__dirname+_0x5a666e(0x1fe)+_0x5a666e(0x194)+_0x1961dc[0x0][_0x5a666e(0x278)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x5a666e(0x27d)+_0x5a666e(0x287)+'<div>'+_0x5a666e(0x1e7)+_0x5a666e(0x237)+_0x5a666e(0x28a)+_0x5a666e(0x1ef)+'<div>'+_0x5a666e(0x200)+_0x1961dc[0x0][_0x5a666e(0x24d)]+_0x5a666e(0x1f8)+_0x5a666e(0x1ef)+_0x5a666e(0x1ef)+_0x5a666e(0x247)+_0x5a666e(0x237)+_0x5a666e(0x1f7)+'\x20Order\x20Number\x20:\x20'+_0x33ad34[_0x5a666e(0x290)]+'\x20'+_0x5a666e(0x1c5)+_0x5a666e(0x28b)+_0x33ad34[_0x5a666e(0x229)]+'\x20'+_0x5a666e(0x1a3)+_0x5a666e(0x197)+'</div>'+_0x5a666e(0x1a9)+_0x5a666e(0x1eb)+_0x5a666e(0x26b)+_0x5a666e(0x274)+_0x5a666e(0x1a2)+_0x5a666e(0x23d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x5a666e(0x1a6)+_0x5a666e(0x19e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x5a666e(0x275)+_0x5a666e(0x271)+'</thead>'+_0x5a666e(0x1ba)+'\x20'+_0x2e454f+'\x20'+'</tbody>'+_0x5a666e(0x210)+'<div>'+_0x5a666e(0x1cc)+_0x5a666e(0x204)+_0x1961dc[0x0]['site_title']+_0x5a666e(0x197)+_0x5a666e(0x1ef)+_0x5a666e(0x1ef)+_0x5a666e(0x269)};_0x29e353['sendMail'](_0x52602f,function(_0x154a47,_0x447cd2){var _0x478adf=_0x5a666e;_0x154a47?(console[_0x478adf(0x26d)](_0x154a47),console['log'](_0x478adf(0x190))):console[_0x478adf(0x26d)](_0x478adf(0x1e2));});}catch(_0x3c2f99){console['error'](_0x3c2f99),_0x28e64c['status'](0x1f4)[_0x5a666e(0x198)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x3c2f99[_0x5a666e(0x254)]});}})[_0x245509(0x1e8)](_0x350151=>{var _0x24aae8=_0x245509;console[_0x24aae8(0x22b)](_0x350151);}),_0x1e7af8[_0x245509(0x207)](_0x245509(0x235),_0x245509(0x1cf)),_0x28e64c[_0x245509(0x1c0)](_0x245509(0x241));}catch(_0x6b0a1c){console[_0x245509(0x26d)](_0x6b0a1c);}}),router['get'](a0_0x4bd3da(0x1fb),auth,async(_0xdbe024,_0x8b262c)=>{var _0x2322b6=a0_0x4bd3da;try{const {username:_0x193c37,email:_0x4654f3,role:_0x4efb15}=_0xdbe024[_0x2322b6(0x1ec)],_0x4cfce6=_0xdbe024[_0x2322b6(0x1ec)],_0x2ecf28=await profile[_0x2322b6(0x264)]({'email':_0x4cfce6[_0x2322b6(0x24c)]}),_0x260230=await master_shop[_0x2322b6(0x253)](),_0x53d2a0=_0xdbe024[_0x2322b6(0x1c7)]['id'],_0x5cdf32=await purchases_finished[_0x2322b6(0x1de)](_0x53d2a0),_0x10086d=await suppliers[_0x2322b6(0x253)]({});let _0x3e38c0;if(_0x4cfce6[_0x2322b6(0x1f1)]==_0x2322b6(0x20c)){const _0x59611c=await staff[_0x2322b6(0x264)]({'email':_0x4cfce6[_0x2322b6(0x24c)]});_0x3e38c0=await warehouse[_0x2322b6(0x253)]({'status':_0x2322b6(0x1cb),'name':_0x59611c[_0x2322b6(0x1d3)],'warehouse_category':_0x2322b6(0x26f)});}else _0x3e38c0=await warehouse[_0x2322b6(0x258)]([{'$match':{'status':'Enabled','warehouse_category':_0x2322b6(0x26f)}},{'$group':{'_id':_0x2322b6(0x209),'name':{'$first':_0x2322b6(0x209)}}}]);const _0x2da770=await product[_0x2322b6(0x253)]({}),_0x9ac62f=BayBinSelected(_0x5cdf32[_0x2322b6(0x1e0)],_0x5cdf32['room']);let _0x27392b=new Date(_0x5cdf32[_0x2322b6(0x239)]),_0x529d62=('0'+_0x27392b[_0x2322b6(0x1ee)]())[_0x2322b6(0x24b)](-0x2),_0x4844d3=('0'+(_0x27392b[_0x2322b6(0x263)]()+0x1))['slice'](-0x2),_0x5e8662=_0x27392b['getFullYear'](),_0x3ff012=_0x5e8662+'-'+_0x4844d3+'-'+_0x529d62;if(_0x260230[0x0]['language']==_0x2322b6(0x248)){var _0x574f58=users[_0x2322b6(0x196)];console['log'](_0x574f58);}else{if(_0x260230[0x0][_0x2322b6(0x21a)]=='Hindi')var _0x574f58=users['Hindi'];else{if(_0x260230[0x0]['language']==_0x2322b6(0x22c))var _0x574f58=users[_0x2322b6(0x22c)];else{if(_0x260230[0x0][_0x2322b6(0x21a)]==_0x2322b6(0x276))var _0x574f58=users[_0x2322b6(0x276)];else{if(_0x260230[0x0][_0x2322b6(0x21a)]==_0x2322b6(0x23a))var _0x574f58=users[_0x2322b6(0x23a)];else{if(_0x260230[0x0][_0x2322b6(0x21a)]==_0x2322b6(0x231))var _0x574f58=users[_0x2322b6(0x1cd)];else{if(_0x260230[0x0][_0x2322b6(0x21a)]==_0x2322b6(0x20d))var _0x574f58=users[_0x2322b6(0x20d)];else{if(_0x260230[0x0][_0x2322b6(0x21a)]=='Arabic\x20(ae)')var _0x574f58=users[_0x2322b6(0x291)];}}}}}}}_0x8b262c['render'](_0x2322b6(0x1b1),{'success':_0xdbe024[_0x2322b6(0x207)](_0x2322b6(0x235)),'errors':_0xdbe024[_0x2322b6(0x207)](_0x2322b6(0x279)),'role':_0x4cfce6,'profile':_0x2ecf28,'purchases':_0x5cdf32,'suppliers':_0x10086d,'warehouse':_0x3e38c0,'product':_0x2da770,'master_shop':_0x260230,'language':_0x574f58,'ed_fullDate':_0x3ff012,'dataSelected':_0x9ac62f});}catch(_0x337bac){console[_0x2322b6(0x26d)](_0x337bac);}}),router[a0_0x4bd3da(0x1a4)](a0_0x4bd3da(0x233),auth,async(_0x1f5245,_0x501392)=>{var _0xd5d212=a0_0x4bd3da;try{const {username:_0x17f7cc,email:_0x73e259,role:_0x476ccb}=_0x1f5245['user'],_0x5428df=_0x1f5245[_0xd5d212(0x1ec)],_0x35b49b=await profile[_0xd5d212(0x264)]({'email':_0x5428df[_0xd5d212(0x24c)]}),_0x3f989c=await master_shop[_0xd5d212(0x253)](),_0x5b3300=_0x1f5245[_0xd5d212(0x1c7)]['id'],_0x298c55=await purchases_finished['findById'](_0x5b3300),_0x22ce85=await suppliers[_0xd5d212(0x253)]({});let _0x2f0fb5;if(_0x5428df[_0xd5d212(0x1f1)]==_0xd5d212(0x20c)){const _0xefd36e=await staff[_0xd5d212(0x264)]({'email':_0x5428df['email']});_0x2f0fb5=await warehouse[_0xd5d212(0x253)]({'status':_0xd5d212(0x1cb),'name':_0xefd36e['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x2f0fb5=await warehouse[_0xd5d212(0x258)]([{'$match':{'status':_0xd5d212(0x1cb),'warehouse_category':_0xd5d212(0x26f)}},{'$group':{'_id':_0xd5d212(0x209),'name':{'$first':'$name'}}}]);const _0x2751e3=await product[_0xd5d212(0x253)]({}),_0x2aa562=BayBinSelected(_0x298c55['warehouse_name'],_0x298c55[_0xd5d212(0x26a)]);let _0x47d6ec=new Date(_0x298c55[_0xd5d212(0x239)]),_0x59abdc=('0'+_0x47d6ec['getDate']())[_0xd5d212(0x24b)](-0x2),_0x618f86=('0'+(_0x47d6ec[_0xd5d212(0x263)]()+0x1))[_0xd5d212(0x24b)](-0x2),_0x54af12=_0x47d6ec[_0xd5d212(0x199)](),_0x52a797=_0x54af12+'-'+_0x618f86+'-'+_0x59abdc;if(_0x3f989c[0x0][_0xd5d212(0x21a)]==_0xd5d212(0x248)){var _0x5e04ee=users[_0xd5d212(0x196)];console['log'](_0x5e04ee);}else{if(_0x3f989c[0x0][_0xd5d212(0x21a)]==_0xd5d212(0x277))var _0x5e04ee=users[_0xd5d212(0x277)];else{if(_0x3f989c[0x0][_0xd5d212(0x21a)]==_0xd5d212(0x22c))var _0x5e04ee=users[_0xd5d212(0x22c)];else{if(_0x3f989c[0x0][_0xd5d212(0x21a)]=='Spanish')var _0x5e04ee=users[_0xd5d212(0x276)];else{if(_0x3f989c[0x0][_0xd5d212(0x21a)]=='French')var _0x5e04ee=users[_0xd5d212(0x23a)];else{if(_0x3f989c[0x0]['language']==_0xd5d212(0x231))var _0x5e04ee=users[_0xd5d212(0x1cd)];else{if(_0x3f989c[0x0]['language']==_0xd5d212(0x20d))var _0x5e04ee=users[_0xd5d212(0x20d)];else{if(_0x3f989c[0x0]['language']==_0xd5d212(0x28f))var _0x5e04ee=users[_0xd5d212(0x291)];}}}}}}}_0x501392[_0xd5d212(0x19b)](_0xd5d212(0x24a),{'success':_0x1f5245['flash'](_0xd5d212(0x235)),'errors':_0x1f5245[_0xd5d212(0x207)]('errors'),'role':_0x5428df,'profile':_0x35b49b,'purchases':_0x298c55,'suppliers':_0x22ce85,'warehouse':_0x2f0fb5,'product':_0x2751e3,'master_shop':_0x3f989c,'language':_0x5e04ee,'ed_fullDate':_0x52a797,'dataSelected':_0x2aa562});}catch(_0x8451ac){console['log'](_0x8451ac);}}),router['post'](a0_0x4bd3da(0x233),auth,async(_0x1ae3e2,_0x3eac0a)=>{var _0x2c785a=a0_0x4bd3da;try{const _0x5024dd=_0x1ae3e2[_0x2c785a(0x1c7)]['id'],_0x190461=await purchases_finished[_0x2c785a(0x264)]({'_id':_0x1ae3e2[_0x2c785a(0x1c7)]['id']}),_0x5264c2=await warehouse[_0x2c785a(0x264)]({'name':_0x190461[_0x2c785a(0x1e0)],'room':_0x190461[_0x2c785a(0x26a)]});_0x190461['product'][_0x2c785a(0x238)](_0x5d922f=>{var _0x4cda89=_0x2c785a;const _0x202f62=_0x5264c2[_0x4cda89(0x227)][_0x4cda89(0x259)](_0x5e1702=>{var _0x3f8386=_0x4cda89;_0x5e1702['product_name']==_0x5d922f['product_name']&&_0x5e1702['bay']==_0x5d922f[_0x3f8386(0x261)]&&(_0x5e1702[_0x3f8386(0x1d6)]=parseInt(_0x5e1702[_0x3f8386(0x1d6)])-parseInt(_0x5d922f[_0x3f8386(0x257)]));});}),await _0x5264c2['save']();const {invoice:_0x54717a,suppliers:_0xbf4e50,date:_0x203f5c,warehouse_name:_0x472f6c,prod_name:_0x2749a4,prod_code:_0x2b8646,prod_qty:_0x38defa,prod_unit:_0x393514,prod_secondunit:_0x36ee64,prod_level:_0x1ddaff,prod_isle:_0x4529b7,prod_pallet:_0x3f3cd5,note:_0x2c6e84,expiry_date:_0x2746cb,batch_code:_0x16af2b,paid_amount:_0x4df874,due_amount:_0x59d4d0,Room_name:_0x8a1293,primary_code:_0x28fb95,secondary_code:_0x14a6db,PO_number:_0x5adf44,JO_number:_0x3cbfe7}=_0x1ae3e2[_0x2c785a(0x19a)];if(typeof _0x2749a4==_0x2c785a(0x206))var _0x4cd8a6=[_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x1c1)]],_0x431076=[_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x272)]],_0x3fb56d=[_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x1a0)]],_0x3072a7=[_0x1ae3e2[_0x2c785a(0x19a)]['prod_unit']],_0x43828a=[_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x218)]],_0x22f0cd=[_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x245)]],_0x501351=[_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x21e)]],_0x131448=[_0x1ae3e2['body'][_0x2c785a(0x27c)]],_0x2b9745=[_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x19f)]],_0x5abfa9=[_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x240)]],_0x1f3491=[_0x1ae3e2['body'][_0x2c785a(0x239)]];else var _0x4cd8a6=[..._0x1ae3e2[_0x2c785a(0x19a)]['prod_name']],_0x431076=[..._0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x272)]],_0x3fb56d=[..._0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x1a0)]],_0x3072a7=[..._0x1ae3e2['body'][_0x2c785a(0x1c6)]],_0x43828a=[..._0x1ae3e2['body'][_0x2c785a(0x218)]],_0x22f0cd=[..._0x1ae3e2[_0x2c785a(0x19a)]['prod_level']],_0x501351=[..._0x1ae3e2['body']['primary_code']],_0x131448=[..._0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x27c)]],_0x2b9745=[..._0x1ae3e2['body'][_0x2c785a(0x19f)]],_0x5abfa9=[..._0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x240)]],_0x1f3491=[..._0x1ae3e2[_0x2c785a(0x19a)]['expiry_date']];const _0xdacc46=_0x4cd8a6[_0x2c785a(0x259)](_0x9e039b=>{return _0x9e039b={'product_name':_0x9e039b};});_0x431076['forEach']((_0x20451f,_0x1a00fa)=>{_0xdacc46[_0x1a00fa]['product_code']=_0x20451f;}),_0x3fb56d[_0x2c785a(0x238)]((_0x14b8db,_0x34ad3d)=>{var _0x15578b=_0x2c785a;_0xdacc46[_0x34ad3d][_0x15578b(0x257)]=_0x14b8db;}),_0x3072a7['forEach']((_0x1ec0e0,_0x30f69c)=>{var _0x4b27ff=_0x2c785a;_0xdacc46[_0x30f69c][_0x4b27ff(0x1be)]=_0x1ec0e0;}),_0x43828a[_0x2c785a(0x238)]((_0x312849,_0x3127f5)=>{_0xdacc46[_0x3127f5]['secondary_unit']=_0x312849;}),_0x22f0cd['forEach']((_0x55c6c8,_0x6099a1)=>{_0xdacc46[_0x6099a1]['bay']=_0x55c6c8;}),_0x501351['forEach']((_0x43efb6,_0x5b71f1)=>{var _0x45b515=_0x2c785a;_0xdacc46[_0x5b71f1][_0x45b515(0x21e)]=_0x43efb6;}),_0x131448[_0x2c785a(0x238)]((_0x1b2515,_0x31cee3)=>{var _0xcc47a5=_0x2c785a;_0xdacc46[_0x31cee3][_0xcc47a5(0x27c)]=_0x1b2515;}),_0x2b9745[_0x2c785a(0x238)]((_0x2bc323,_0x36a847)=>{var _0x54fa2f=_0x2c785a;_0xdacc46[_0x36a847][_0x54fa2f(0x23c)]=_0x2bc323;}),_0x5abfa9[_0x2c785a(0x238)]((_0x1134d9,_0x23d81d)=>{var _0x3b6015=_0x2c785a;_0xdacc46[_0x23d81d][_0x3b6015(0x240)]=_0x1134d9;}),_0x1f3491[_0x2c785a(0x238)]((_0x1766f8,_0x4573a7)=>{_0xdacc46[_0x4573a7]['expiry_date']=_0x1766f8;});const _0x50d620=_0xdacc46[_0x2c785a(0x21d)](_0x44a81c=>_0x44a81c['quantity']!=='0'&&_0x44a81c[_0x2c785a(0x257)]!=='');_0x190461['invoice']=_0x54717a,_0x190461[_0x2c785a(0x1e6)]=_0xbf4e50,_0x190461['date']=_0x203f5c,_0x190461[_0x2c785a(0x1e0)]=_0x472f6c,_0x190461['product']=_0x50d620,_0x190461[_0x2c785a(0x23f)]=_0x2c6e84,_0x190461[_0x2c785a(0x216)]=_0x4df874,_0x190461['due_amount']=_0x59d4d0,_0x190461[_0x2c785a(0x26a)]=_0x8a1293,_0x190461[_0x2c785a(0x1f6)]=_0x5adf44,_0x190461['JO_number']=_0x3cbfe7;const _0x15de38=await _0x190461[_0x2c785a(0x224)](),_0x3a3ce7=await warehouse[_0x2c785a(0x264)]({'name':_0x1ae3e2[_0x2c785a(0x19a)]['warehouse_name'],'room':_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x28d)]});_0x190461[_0x2c785a(0x289)][_0x2c785a(0x238)](_0xcc03ef=>{var _0x3027c5=_0x2c785a,_0x5aacf5=0x0;const _0x219c50=_0x3a3ce7[_0x3027c5(0x227)][_0x3027c5(0x259)](_0x1abfe4=>{var _0x36c37d=_0x3027c5;_0x1abfe4[_0x36c37d(0x1ac)]==_0xcc03ef[_0x36c37d(0x1ac)]&&_0x1abfe4['bay']==_0xcc03ef[_0x36c37d(0x261)]&&(_0x1abfe4[_0x36c37d(0x1d6)]=parseInt(_0x1abfe4['product_stock'])+parseInt(_0xcc03ef[_0x36c37d(0x257)]),_0x5aacf5++);});_0x5aacf5=='0'&&(_0x3a3ce7[_0x3027c5(0x227)]=_0x3a3ce7[_0x3027c5(0x227)][_0x3027c5(0x212)]({'product_name':_0xcc03ef[_0x3027c5(0x1ac)],'product_stock':_0xcc03ef[_0x3027c5(0x257)],'primary_code':_0xcc03ef[_0x3027c5(0x21e)],'secondary_code':_0xcc03ef['secondary_code'],'product_code':_0xcc03ef[_0x3027c5(0x22d)],'bay':_0xcc03ef[_0x3027c5(0x261)],'maxProducts':_0xcc03ef[_0x3027c5(0x23c)],'unit':_0xcc03ef[_0x3027c5(0x1be)],'secondary_unit':_0xcc03ef[_0x3027c5(0x1b4)],'expiry_date':_0xcc03ef['expiry_date']}));}),await _0x3a3ce7[_0x2c785a(0x224)]();const _0x30f9fc=await s_payment_data[_0x2c785a(0x264)]({'invoice':_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x290)]});if(_0x30f9fc===null){}else console[_0x2c785a(0x26d)]('suppliers',_0x30f9fc,_0x1ae3e2[_0x2c785a(0x19a)]['invoice']),_0x30f9fc[_0x2c785a(0x1e6)]=_0x1ae3e2[_0x2c785a(0x19a)][_0x2c785a(0x1e6)],await _0x30f9fc[_0x2c785a(0x224)]();_0x1ae3e2[_0x2c785a(0x207)](_0x2c785a(0x235),_0x2c785a(0x1ae)),_0x3eac0a[_0x2c785a(0x1c0)]('/all_purchases_finished/view');}catch(_0x5ef1c8){console[_0x2c785a(0x26d)](_0x5ef1c8);}}),router[a0_0x4bd3da(0x1f5)](a0_0x4bd3da(0x246),auth,async(_0x5ba487,_0x38eca6)=>{var _0x425b0a=a0_0x4bd3da;try{const _0x1e316e=_0x5ba487[_0x425b0a(0x1c7)]['id'],{invoice:_0x4af44d,suppliers:_0x1d8151,payable:_0x112d5d,due_amount:_0x619230}=_0x5ba487[_0x425b0a(0x19a)],_0x5b4d35=await purchases[_0x425b0a(0x1de)](_0x1e316e);var _0x341dec=_0x112d5d-_0x619230;_0x5b4d35[_0x425b0a(0x216)]=parseFloat(_0x5b4d35[_0x425b0a(0x216)])+parseFloat(_0x619230),_0x5b4d35[_0x425b0a(0x25b)]=_0x341dec;const _0x1d8c15=await _0x5b4d35[_0x425b0a(0x224)]();console[_0x425b0a(0x26d)](_0x1d8c15);const _0x30213e=await s_payment_data[_0x425b0a(0x264)]({'invoice':_0x4af44d});_0x30213e[_0x425b0a(0x1a5)]=_0x341dec,await _0x30213e['save']();let _0x39e2ed=new Date(),_0x1c844b=('0'+_0x39e2ed['getDate']())[_0x425b0a(0x24b)](-0x2),_0x1bec81=('0'+(_0x39e2ed[_0x425b0a(0x263)]()+0x1))[_0x425b0a(0x24b)](-0x2),_0xddf9fe=_0x39e2ed[_0x425b0a(0x199)](),_0x2a3094=_0xddf9fe+'-'+_0x1bec81+'-'+_0x1c844b;const _0x52bd34=new suppliers_payment({'invoice':_0x4af44d,'date':_0xddf9fe+'-'+_0x1bec81+'-'+_0x1c844b,'suppliers':_0x1d8151,'reason':'Paid\x20For\x20Purchase','amount':_0x619230}),_0x49e920=await _0x52bd34[_0x425b0a(0x224)]();_0x5ba487[_0x425b0a(0x207)](_0x425b0a(0x235),_0x425b0a(0x26e)),_0x38eca6[_0x425b0a(0x1c0)](_0x425b0a(0x251));}catch(_0xb7ea6e){console['log'](_0xb7ea6e);}}),router[a0_0x4bd3da(0x1a4)](a0_0x4bd3da(0x191),auth,async(_0x548918,_0x2e79ca)=>{var _0x383018=a0_0x4bd3da;try{const {username:_0x4534e8,email:_0x57ec7b,role:_0xa6c35b}=_0x548918['user'],_0x2bf50c=_0x548918[_0x383018(0x1ec)],_0x402eb4=await profile[_0x383018(0x264)]({'email':_0x2bf50c[_0x383018(0x24c)]}),_0x47712d=await master_shop[_0x383018(0x253)]();console[_0x383018(0x26d)]('master',_0x47712d);const _0x48235f=_0x548918[_0x383018(0x1c7)]['id'],_0x10f352=await purchases['findById'](_0x48235f);console[_0x383018(0x26d)](_0x10f352);const _0x43f1ce=await suppliers[_0x383018(0x264)]({'name':_0x10f352[_0x383018(0x1e6)]});console[_0x383018(0x26d)](_0x43f1ce);if(_0x47712d[0x0][_0x383018(0x21a)]==_0x383018(0x248)){var _0x28c20e=users[_0x383018(0x196)];console[_0x383018(0x26d)](_0x28c20e);}else{if(_0x47712d[0x0][_0x383018(0x21a)]==_0x383018(0x277))var _0x28c20e=users[_0x383018(0x277)];else{if(_0x47712d[0x0][_0x383018(0x21a)]==_0x383018(0x22c))var _0x28c20e=users[_0x383018(0x22c)];else{if(_0x47712d[0x0][_0x383018(0x21a)]==_0x383018(0x276))var _0x28c20e=users[_0x383018(0x276)];else{if(_0x47712d[0x0][_0x383018(0x21a)]=='French')var _0x28c20e=users[_0x383018(0x23a)];else{if(_0x47712d[0x0][_0x383018(0x21a)]=='Portuguese\x20(BR)')var _0x28c20e=users[_0x383018(0x1cd)];else{if(_0x47712d[0x0]['language']==_0x383018(0x20d))var _0x28c20e=users[_0x383018(0x20d)];else{if(_0x47712d[0x0][_0x383018(0x21a)]==_0x383018(0x28f))var _0x28c20e=users[_0x383018(0x291)];}}}}}}}_0x2e79ca[_0x383018(0x19b)](_0x383018(0x1e4),{'success':_0x548918['flash'](_0x383018(0x235)),'errors':_0x548918[_0x383018(0x207)](_0x383018(0x279)),'role':_0x2bf50c,'profile':_0x402eb4,'master_shop':_0x47712d,'supplier':_0x43f1ce,'purchase':_0x10f352,'language':_0x28c20e});}catch(_0x22db36){console[_0x383018(0x26d)](_0x22db36);}}),router['get'](a0_0x4bd3da(0x18f),auth,async(_0x449ef1,_0x3ec33c)=>{var _0xbaed6e=a0_0x4bd3da;try{const {username:_0x21bf50,email:_0x23c9d5,role:_0x26ab53}=_0x449ef1['user'],_0x2d25f6=_0x449ef1[_0xbaed6e(0x1ec)],_0x40955d=await profile['findOne']({'email':_0x2d25f6['email']}),_0x4470c9=await master_shop[_0xbaed6e(0x253)]();console['log']('master',_0x4470c9);const _0x303266=_0x449ef1[_0xbaed6e(0x1c7)]['id'];console['log'](_0x303266);const _0x1141fc=await purchases_finished[_0xbaed6e(0x1de)](_0x303266);console[_0xbaed6e(0x26d)](_0xbaed6e(0x201),_0x1141fc);const _0x18b7f1=await product[_0xbaed6e(0x253)]({}),_0x5538ee=await warehouse[_0xbaed6e(0x258)]([{'$match':{'name':_0x1141fc[_0xbaed6e(0x1e0)],'room':_0x1141fc[_0xbaed6e(0x26a)]}},{'$unwind':_0xbaed6e(0x23e)},{'$group':{'_id':'$product_details._id','name':{'$first':_0xbaed6e(0x1f0)},'product_stock':{'$first':_0xbaed6e(0x225)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xbaed6e(0x1fd)},'type':{'$first':_0xbaed6e(0x22a)},'floorlevel':{'$first':_0xbaed6e(0x1b0)},'primary_code':{'$first':_0xbaed6e(0x262)},'secondary_code':{'$first':_0xbaed6e(0x20f)},'product_code':{'$first':_0xbaed6e(0x281)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xbaed6e(0x19d)}}}]);console[_0xbaed6e(0x26d)](_0xbaed6e(0x213),_0x5538ee);let _0x3ce1e8;if(_0x2d25f6['role']==_0xbaed6e(0x20c)){const _0x56c7fb=await staff[_0xbaed6e(0x264)]({'email':_0x2d25f6[_0xbaed6e(0x24c)]});_0x3ce1e8=await warehouse[_0xbaed6e(0x253)]({'status':_0xbaed6e(0x1cb),'name':_0x56c7fb[_0xbaed6e(0x1d3)],'warehouse_category':_0xbaed6e(0x26f),'name':_0xbaed6e(0x1ad)});}else _0x3ce1e8=await warehouse[_0xbaed6e(0x258)]([{'$match':{'status':_0xbaed6e(0x1cb),'warehouse_category':_0xbaed6e(0x26f),'name':'Return\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);if(_0x4470c9[0x0]['language']==_0xbaed6e(0x248)){var _0x4d75d7=users[_0xbaed6e(0x196)];console[_0xbaed6e(0x26d)](_0x4d75d7);}else{if(_0x4470c9[0x0][_0xbaed6e(0x21a)]==_0xbaed6e(0x277))var _0x4d75d7=users[_0xbaed6e(0x277)];else{if(_0x4470c9[0x0][_0xbaed6e(0x21a)]=='German')var _0x4d75d7=users[_0xbaed6e(0x22c)];else{if(_0x4470c9[0x0][_0xbaed6e(0x21a)]==_0xbaed6e(0x276))var _0x4d75d7=users[_0xbaed6e(0x276)];else{if(_0x4470c9[0x0][_0xbaed6e(0x21a)]==_0xbaed6e(0x23a))var _0x4d75d7=users[_0xbaed6e(0x23a)];else{if(_0x4470c9[0x0]['language']==_0xbaed6e(0x231))var _0x4d75d7=users['Portuguese'];else{if(_0x4470c9[0x0][_0xbaed6e(0x21a)]==_0xbaed6e(0x20d))var _0x4d75d7=users[_0xbaed6e(0x20d)];else{if(_0x4470c9[0x0][_0xbaed6e(0x21a)]==_0xbaed6e(0x28f))var _0x4d75d7=users[_0xbaed6e(0x291)];}}}}}}}_0x3ec33c[_0xbaed6e(0x19b)](_0xbaed6e(0x20a),{'success':_0x449ef1[_0xbaed6e(0x207)](_0xbaed6e(0x235)),'errors':_0x449ef1[_0xbaed6e(0x207)](_0xbaed6e(0x279)),'role':_0x2d25f6,'profile':_0x40955d,'user':_0x1141fc,'stock':_0x5538ee,'master_shop':_0x4470c9,'product':_0x18b7f1,'language':_0x4d75d7,'warehouse':_0x3ce1e8});}catch(_0x2cfd8d){console[_0xbaed6e(0x26d)](_0x2cfd8d);}}),router[a0_0x4bd3da(0x1f5)](a0_0x4bd3da(0x18f),auth,async(_0xc27546,_0x1b73c2)=>{var _0x12f8fb=a0_0x4bd3da;try{const {invoice:_0x302937,date:_0x4600f7,warehouse_name:_0xcd221c,Room_name:_0x36fe4e,product_name:_0x29e333,purchase_quantity:_0x526b4a,stocks:_0x1aaba8,return_qty:_0x37098b,note:_0x589ec1,level:_0xc16393,isle:_0x272e8a,pallet:_0x57326a,to_warehouse_name:_0x2efdaa,to_Room_name:_0x61cc89}=_0xc27546[_0x12f8fb(0x19a)],_0x4d77a8=await purchases_finished[_0x12f8fb(0x264)]({'_id':_0xc27546[_0x12f8fb(0x1c7)]['id']}),_0xbeeb31=await warehouse[_0x12f8fb(0x264)]({'name':_0xcd221c,'room':_0x36fe4e,'warehouse_category':_0x12f8fb(0x26f)});if(typeof _0x29e333==_0x12f8fb(0x206))var _0x50dad4=[_0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x1ac)]],_0x15c2e0=[_0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x265)]],_0x370eeb=[_0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x1e9)]],_0x473678=[_0xc27546['body'][_0x12f8fb(0x1c8)]],_0x2b3e84=[_0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x1d2)]],_0xa70345=[_0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x1ab)]],_0x3badaa=[_0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x23b)]],_0x130916=[_0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x273)]];else var _0x50dad4=[..._0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x1ac)]],_0x15c2e0=[..._0xc27546['body'][_0x12f8fb(0x265)]],_0x370eeb=[..._0xc27546[_0x12f8fb(0x19a)]['stocks']],_0x473678=[..._0xc27546['body']['return_qty']],_0x2b3e84=[..._0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x1d2)]],_0xa70345=[..._0xc27546['body'][_0x12f8fb(0x1ab)]],_0x3badaa=[..._0xc27546[_0x12f8fb(0x19a)]['primary_code_hide']],_0x130916=[..._0xc27546[_0x12f8fb(0x19a)]['secondary_code_hide']];const _0x55cbe1=_0x50dad4['map'](_0x167362=>{return _0x167362={'product_name':_0x167362};});_0x15c2e0['forEach']((_0x12dcb6,_0x4bf28d)=>{var _0x4a3929=_0x12f8fb;_0x55cbe1[_0x4bf28d][_0x4a3929(0x265)]=_0x12dcb6;}),_0x370eeb[_0x12f8fb(0x238)]((_0x585627,_0xfbf2f)=>{var _0x173552=_0x12f8fb;_0x55cbe1[_0xfbf2f][_0x173552(0x205)]=_0x585627;}),_0x473678[_0x12f8fb(0x238)]((_0x30d5e1,_0x5a6a60)=>{var _0x325ec3=_0x12f8fb;_0x55cbe1[_0x5a6a60][_0x325ec3(0x1c8)]=_0x30d5e1;}),_0x2b3e84[_0x12f8fb(0x238)]((_0xe9b488,_0x535626)=>{var _0x47672c=_0x12f8fb;_0x55cbe1[_0x535626][_0x47672c(0x261)]=_0xe9b488;}),_0xa70345[_0x12f8fb(0x238)]((_0x4ac010,_0x34f99c)=>{var _0x52b0af=_0x12f8fb;_0x55cbe1[_0x34f99c][_0x52b0af(0x22d)]=_0x4ac010;}),_0x3badaa['forEach']((_0x30522c,_0xea733c)=>{var _0x145ccb=_0x12f8fb;_0x55cbe1[_0xea733c][_0x145ccb(0x21e)]=_0x30522c;}),_0x130916['forEach']((_0x4e9e10,_0x196204)=>{var _0x46defd=_0x12f8fb;_0x55cbe1[_0x196204][_0x46defd(0x27c)]=_0x4e9e10;}),_0x55cbe1[_0x12f8fb(0x238)](_0x248d3e=>{var _0x25d12b=_0x12f8fb;console[_0x25d12b(0x26d)](_0x248d3e);const _0x30a60f=_0xbeeb31[_0x25d12b(0x227)][_0x25d12b(0x259)](_0x3043ba=>{var _0x40ab86=_0x25d12b;_0x3043ba[_0x40ab86(0x1ac)]==_0x248d3e[_0x40ab86(0x1ac)]&&_0x3043ba[_0x40ab86(0x261)]==_0x248d3e[_0x40ab86(0x261)]&&(console[_0x40ab86(0x26d)](parseInt(_0x3043ba[_0x40ab86(0x1d6)])+'\x20<>\x20'+parseInt(_0x248d3e['return_qty'])),_0x3043ba[_0x40ab86(0x1d6)]=parseInt(_0x3043ba[_0x40ab86(0x1d6)])-parseInt(_0x248d3e[_0x40ab86(0x1c8)]));});}),await _0xbeeb31[_0x12f8fb(0x224)]();var _0x37ffeb=0x0;_0x55cbe1[_0x12f8fb(0x238)](_0x298ec3=>{var _0x41c0c2=_0x12f8fb;(parseInt(_0x298ec3[_0x41c0c2(0x265)])<parseInt(_0x298ec3[_0x41c0c2(0x1c8)])||parseInt(_0x298ec3[_0x41c0c2(0x205)])<parseInt(_0x298ec3[_0x41c0c2(0x1c8)]))&&_0x37ffeb++;});if(_0x37ffeb!=0x0)return _0xc27546[_0x12f8fb(0x207)](_0x12f8fb(0x279),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x1b73c2[_0x12f8fb(0x1c0)](_0x12f8fb(0x228));const _0x258982=new purchases_return_finished({'invoice':_0x302937,'suppliers':_0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x1e6)],'date':_0x4600f7,'warehouse_name':_0xcd221c,'return_product':_0x55cbe1,'note':_0x589ec1,'room':_0x36fe4e,'to_warehouse_name':_0x2efdaa,'to_room':_0x61cc89}),_0x4e3e63=await _0x258982[_0x12f8fb(0x224)](),_0x5d4859=await purchases_return_finished[_0x12f8fb(0x264)]({'invoice':_0x302937}),_0x31391c=await warehouse['findOne']({'name':_0x2efdaa,'room':_0x61cc89,'warehouse_category':_0x12f8fb(0x26f)});_0x5d4859[_0x12f8fb(0x1bb)][_0x12f8fb(0x238)](_0x3472f1=>{var _0x351704=_0x12f8fb,_0x49b7e7=0x0;const _0x18067f=_0x31391c[_0x351704(0x227)][_0x351704(0x259)](_0x46ed13=>{var _0x4f8ccb=_0x351704;console[_0x4f8ccb(0x26d)](_0x46ed13[_0x4f8ccb(0x1ac)]+'=='+_0x3472f1[_0x4f8ccb(0x1ac)]+'&&'+_0x46ed13['bay']+'=='+_0x3472f1[_0x4f8ccb(0x261)]),_0x46ed13['product_name']==_0x3472f1[_0x4f8ccb(0x1ac)]&&_0x46ed13['bay']==_0x3472f1[_0x4f8ccb(0x261)]&&(_0x46ed13[_0x4f8ccb(0x1d6)]=parseInt(_0x46ed13[_0x4f8ccb(0x1d6)])-parseInt(_0x3472f1['return_qty']),_0x49b7e7++);});_0x49b7e7=='0'&&(_0x31391c[_0x351704(0x227)]=_0x31391c[_0x351704(0x227)]['concat']({'product_name':_0x3472f1[_0x351704(0x1ac)],'product_stock':_0x3472f1['return_qty'],'primary_code':_0x3472f1['primary_code'],'secondary_code':_0x3472f1[_0x351704(0x27c)],'product_code':_0x3472f1[_0x351704(0x22d)],'bay':_0x3472f1[_0x351704(0x261)],'maxProducts':0xf423f}));}),await _0x31391c[_0x12f8fb(0x224)]();const _0x2a8c46=await purchases_finished[_0x12f8fb(0x264)]({'invoice':_0x302937});_0x2a8c46['return_data']=_0x12f8fb(0x1db);const _0x4aca88=await _0x2a8c46['save'](),_0x5d8d71=new s_payment_data({'invoice':_0x302937,'suppliers':_0xc27546[_0x12f8fb(0x19a)]['suppliers'],'reason':_0x12f8fb(0x219)});await _0x5d8d71[_0x12f8fb(0x224)]();const _0x5c8fce=await master_shop[_0x12f8fb(0x253)](),_0x1d7458=await email_settings[_0x12f8fb(0x264)](),_0x47edea=await suppliers[_0x12f8fb(0x264)]({'name':_0xc27546[_0x12f8fb(0x19a)][_0x12f8fb(0x1e6)]});_0x5c8fce[0x0][_0x12f8fb(0x1e1)]==0x1?(right_currency=_0x5c8fce[0x0][_0x12f8fb(0x1da)],left_currency=''):(right_currency='',left_currency=_0x5c8fce[0x0][_0x12f8fb(0x1da)]);var _0x143069=_0x50dad4,_0x53bc2e=_0x473678,_0x4c4966='',_0x290580;for(_0x290580 in _0x143069){_0x4c4966+='<tr>'+_0x12f8fb(0x230)+_0x143069[_0x290580]+_0x12f8fb(0x243)+_0x12f8fb(0x230)+_0x53bc2e[_0x290580]+_0x12f8fb(0x243)+_0x12f8fb(0x271);}let _0x1f068a=nodemailer[_0x12f8fb(0x1bc)]({'service':'gmail','auth':{'user':_0x1d7458[_0x12f8fb(0x24c)],'pass':_0x1d7458['password']}}),_0x4ece91={'from':_0x1d7458[_0x12f8fb(0x24c)],'to':_0x47edea['email'],'subject':_0x12f8fb(0x25a),'attachments':[{'filename':_0x12f8fb(0x1b6),'path':__dirname+_0x12f8fb(0x1fe)+_0x12f8fb(0x194)+_0x5c8fce[0x0][_0x12f8fb(0x278)],'cid':'logo'}],'html':_0x12f8fb(0x22e)+_0x12f8fb(0x27d)+_0x12f8fb(0x287)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x12f8fb(0x237)+_0x12f8fb(0x28a)+_0x12f8fb(0x1ef)+'<div>'+'<h2>\x20'+_0x5c8fce[0x0][_0x12f8fb(0x24d)]+_0x12f8fb(0x1f8)+'</div>'+_0x12f8fb(0x1ef)+_0x12f8fb(0x247)+_0x12f8fb(0x237)+_0x12f8fb(0x1f7)+'\x20Order\x20Number\x20:\x20'+_0x302937+'\x20'+_0x12f8fb(0x1c5)+_0x12f8fb(0x28b)+_0x4600f7+'\x20'+'</span>'+_0x12f8fb(0x197)+_0x12f8fb(0x1ef)+_0x12f8fb(0x1a9)+_0x12f8fb(0x1eb)+'<tr>'+_0x12f8fb(0x274)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x12f8fb(0x22f)+_0x12f8fb(0x1c2)+_0x12f8fb(0x271)+_0x12f8fb(0x285)+_0x12f8fb(0x1ba)+'\x20'+_0x4c4966+'\x20'+_0x12f8fb(0x223)+_0x12f8fb(0x210)+'<div>'+_0x12f8fb(0x1cc)+_0x12f8fb(0x204)+_0x5c8fce[0x0][_0x12f8fb(0x24d)]+'</h5>'+_0x12f8fb(0x1ef)+'</div>'+'</body></html>'};_0x1f068a[_0x12f8fb(0x226)](_0x4ece91,function(_0x25f24b,_0x11b633){var _0x97a33=_0x12f8fb;_0x25f24b?console['log']('Error\x20Occurs'):console[_0x97a33(0x26d)](_0x97a33(0x1e2));}),_0xc27546['flash'](_0x12f8fb(0x235),'purchases\x20item\x20return\x20successfull'),_0x1b73c2[_0x12f8fb(0x1c0)](_0x12f8fb(0x241));}catch(_0x23790f){_0x1b73c2['status'](0xc8)[_0x12f8fb(0x198)]({'message':_0x23790f['message']});}}),router['get'](a0_0x4bd3da(0x1b9),auth,async(_0x3f4470,_0xca4e5f)=>{var _0x576255=a0_0x4bd3da;try{const {username:_0x4c4dd8,email:_0x202887,role:_0x4be136}=_0x3f4470[_0x576255(0x1ec)],_0x274987=_0x3f4470[_0x576255(0x1ec)],_0x3c126c=await profile[_0x576255(0x264)]({'email':_0x274987[_0x576255(0x24c)]}),_0x1cc0c1=await master_shop[_0x576255(0x253)](),_0x5d06e5=_0x3f4470[_0x576255(0x1c7)]['id'],_0x13691f=await purchases_finished[_0x576255(0x1de)](_0x5d06e5);if(_0x1cc0c1[0x0][_0x576255(0x21a)]==_0x576255(0x248))var _0x27910a=users[_0x576255(0x196)];else{if(_0x1cc0c1[0x0][_0x576255(0x21a)]==_0x576255(0x277))var _0x27910a=users['Hindi'];else{if(_0x1cc0c1[0x0][_0x576255(0x21a)]=='German')var _0x27910a=users[_0x576255(0x22c)];else{if(_0x1cc0c1[0x0][_0x576255(0x21a)]==_0x576255(0x276))var _0x27910a=users[_0x576255(0x276)];else{if(_0x1cc0c1[0x0][_0x576255(0x21a)]=='French')var _0x27910a=users[_0x576255(0x23a)];else{if(_0x1cc0c1[0x0]['language']==_0x576255(0x231))var _0x27910a=users['Portuguese'];else{if(_0x1cc0c1[0x0][_0x576255(0x21a)]==_0x576255(0x20d))var _0x27910a=users[_0x576255(0x20d)];else{if(_0x1cc0c1[0x0][_0x576255(0x21a)]==_0x576255(0x28f))var _0x27910a=users['Arabic'];}}}}}}}_0xca4e5f['render'](_0x576255(0x234),{'success':_0x3f4470[_0x576255(0x207)](_0x576255(0x235)),'errors':_0x3f4470[_0x576255(0x207)](_0x576255(0x279)),'role':_0x274987,'profile':_0x3c126c,'alldata':_0x13691f,'master_shop':_0x1cc0c1,'language':_0x27910a}),console['log'](alldata);}catch(_0x51044b){console[_0x576255(0x26d)](_0x51044b);}}),router[a0_0x4bd3da(0x1f5)](a0_0x4bd3da(0x193),async(_0x20818b,_0x4cea6a)=>{var _0x2dd9e7=a0_0x4bd3da;const {product_code:_0x49ec2b}=_0x20818b[_0x2dd9e7(0x19a)];var _0x17d1eb;const _0x3fc158=await product[_0x2dd9e7(0x258)]([{'$match':{'primary_code':_0x49ec2b,'product_category':_0x2dd9e7(0x26f)}},{'$group':{'_id':_0x2dd9e7(0x1dc),'name':{'$first':'$name'},'category':{'$first':_0x2dd9e7(0x25e)},'brand':{'$first':_0x2dd9e7(0x255)},'unit':{'$first':_0x2dd9e7(0x1c9)},'alertquantity':{'$first':_0x2dd9e7(0x1e3)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x2dd9e7(0x21b)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x2dd9e7(0x244)},'maxProdPerUnit':{'$first':_0x2dd9e7(0x256)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2dd9e7(0x1d0)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x573fe2=await product[_0x2dd9e7(0x258)]([{'$match':{'secondary_code':_0x49ec2b}},{'$group':{'_id':_0x2dd9e7(0x1dc),'name':{'$first':'$name'},'category':{'$first':_0x2dd9e7(0x25e)},'brand':{'$first':_0x2dd9e7(0x255)},'unit':{'$first':_0x2dd9e7(0x1c9)},'alertquantity':{'$first':_0x2dd9e7(0x1e3)},'product_code':{'$first':_0x2dd9e7(0x215)},'primary_code':{'$first':_0x2dd9e7(0x21b)},'secondary_code':{'$first':_0x2dd9e7(0x24f)},'maxStocks':{'$first':_0x2dd9e7(0x244)},'maxProdPerUnit':{'$first':_0x2dd9e7(0x256)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2dd9e7(0x1d0)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3fc158[_0x2dd9e7(0x192)]>0x0)_0x17d1eb=_0x3fc158;else _0x573fe2['length']>0x0&&(_0x17d1eb=_0x573fe2);_0x4cea6a[_0x2dd9e7(0x198)](_0x17d1eb);}),router['post'](a0_0x4bd3da(0x27b),async(_0x1aa35f,_0xbdc025)=>{var _0x55e300=a0_0x4bd3da;const {productCode:_0x49531e,bay:_0x170b2c,warehouses:_0x3704ad,room:_0x2ba334}=_0x1aa35f[_0x55e300(0x19a)];console['log'](_0x1aa35f['body']);try{const _0x1734b4=await warehouse['aggregate']([{'$match':{'name':_0x3704ad,'room':_0x2ba334}},{'$unwind':_0x55e300(0x23e)},{'$match':{'product_details.bay':parseInt(_0x170b2c)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x55e300(0x225)},'bay':{'$first':_0x55e300(0x25f)},'maxProducts':{'$first':_0x55e300(0x1d9)}}}]);_0xbdc025[_0x55e300(0x203)](0xc8)[_0x55e300(0x198)](_0x1734b4);}catch(_0x1c5157){_0xbdc025[_0x55e300(0x203)](0x194)[_0x55e300(0x198)]({'message':_0x1c5157[_0x55e300(0x254)]});}}),module[a0_0x4bd3da(0x1a8)]=router;