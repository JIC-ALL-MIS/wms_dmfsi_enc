var a0_0x461a23=a0_0x3018;(function(_0x1bca39,_0x5d2f28){var _0x322df4=a0_0x3018,_0x1de5b2=_0x1bca39();while(!![]){try{var _0x4926b3=-parseInt(_0x322df4(0x233))/0x1*(parseInt(_0x322df4(0x1bb))/0x2)+parseInt(_0x322df4(0x1a6))/0x3*(-parseInt(_0x322df4(0x178))/0x4)+-parseInt(_0x322df4(0x1de))/0x5*(parseInt(_0x322df4(0x1fa))/0x6)+parseInt(_0x322df4(0x200))/0x7*(-parseInt(_0x322df4(0x157))/0x8)+-parseInt(_0x322df4(0x1f2))/0x9+parseInt(_0x322df4(0x177))/0xa*(parseInt(_0x322df4(0x1f9))/0xb)+parseInt(_0x322df4(0x15e))/0xc;if(_0x4926b3===_0x5d2f28)break;else _0x1de5b2['push'](_0x1de5b2['shift']());}catch(_0x1e4fa6){_0x1de5b2['push'](_0x1de5b2['shift']());}}}(a0_0x4d0b,0xa11c1));function a0_0x4d0b(){var _0x5f0b01=['host','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','paid_amount','product_date','production_date','$batch_code','$date','35216QDnjYC','Router','primary_code_hide','$primary_code','$product.bay','Logo.png','return_qty','Spanish','prod_primunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','maxStocks','</td>','message','port','prod_cat','purchase\x20data\x20update\x20successfully','<tbody\x20style=\x22text-align:\x20center;\x22>','Error\x20Occurs','errors','all','due_amount','date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','toString','prod_level','product','$maxStocks','</table>','success','$invoice','/upload/','</thead>','find','</tr>','then','140TQTxFP','prod_unit','$warehouse_name','purchase_quantity','\x20Order\x20Date\x20:\x20','$expiry_date','French','edit_purchases_finished','<h5>','<h5\x20style=\x22text-align:\x20left;\x22>','Purchase\x20Return','English\x20(US)','master','Portuguese','<tr>','$category','getDate','<strong>\x20Regards\x20</strong>','DRY\x20GOODS','name','4854888RNlApw','$return_data','password','Purchase\x20Return\x20Mail','../middleware/auth','$product.quantity','level','4367iXRUKn','144084uJMgVi','room_name','exports','edit_purchases_finished_view','table\x20page','/invoice/:id','567rGIaIT','MaxStocks_data','json','Hindi','render','../models/all_models','English','$product_details.bin','$secondary_unit','Enclosed','language','purchases\x20item\x20return\x20successfull','$product.room_name','get','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','updateOne','German','gmail','<h2>\x20','$suppliers_docs','invoice','secondary_unit','$product_details.primary_code','staff','/all_purchases/view','$product_details.bay','\x20Order\x20Number\x20:\x20','nodemailer','prod_name','product_name','$product_code','length','note','$product.type','logo','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.product_stock','Purchase\x20Mail','$note','amount','$due_amount','room','slice','suppliers','$alertquantity','params','warehouse','</head><body>','body','getMonth','64jdTLLc','/give_payment/:id','QA\x20Warehouse','all_purchases_barcode','ejs','\x20</h2>','<span\x20style=\x22float:\x20right;\x22>','map','secondary_code','max_product_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$room','forEach','$product_details.maxProducts','$product','log','redirect','<div>','/view/add_purchases','INCF-','prod_qty','/view/add_purchases/:id','add_purchases\x20error','abs','return_purchase_finished','standard_unit','../public/language/languages.json','suppliers_docs','FROZEN\x20GOODS','path','product_code_hide','product_details','return_data','currency_placement','status','Rack\x201','$suppliers','True','maxperunit','Enabled','64504JMNSAA','bay','prod_invoice','findOne','save','</tbody>','string','45339264TrXVbm','date_data','/view/:id','$product_details','Portuguese\x20(BR)','$secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','site_title','image','post','RoomAssign','FGSEmail','user','Paid\x20For\x20Purchase','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$unit','flash','stock_data','currency','Return\x20Goods','</h5>','Email\x20sent\x20successfully','</div>','/../public','12010DiPiWP','100lWpuDx','Arabic','quantity','user_id','email','Rack\x202','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','sendMail','</body></html>','payment\x20successfull','createTransport','<html><head><title></title>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','stock_quantity','random','$product.floorlevel','$product_details.storage','getFullYear','Chinese','/barcode_scanner','$brand','Arabic\x20(ae)','\x20<>\x20','concat','product_cat','$name','stocks','_id','/view/return_purchase/:id','product_stock','findById','Finished\x20Goods','$maxProdPerUnit','prod_secondunit','warehouse_name','</span>','catch','$_id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','role','secondary_code_hide','filter','product_code','expiry_date','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','72399vPhnDF','prod_Qty','$product_details.rack','return_product','$product.bin','/all_purchases_finished/view','batch_code','prod_code','error','$product_details.type','primary_code','$product_details.product_name','/preview/:id','aggregate'];a0_0x4d0b=function(){return _0x5f0b01;};return a0_0x4d0b();}const express=require('express'),app=express(),router=express[a0_0x461a23(0x1bc)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x461a23(0x205)),auth=require(a0_0x461a23(0x1f6)),nodemailer=require(a0_0x461a23(0x21c));var ejs=require(a0_0x461a23(0x237));const path=require(a0_0x461a23(0x250)),users=require(a0_0x461a23(0x24d));router['get']('/view',auth,async(_0x4e3bf1,_0x27c43e)=>{var _0x59425f=a0_0x461a23;try{const {username:_0x9e98ec,email:_0x399cd8,role:_0x5c07ab}=_0x4e3bf1[_0x59425f(0x16b)],_0x1be2e5=_0x4e3bf1[_0x59425f(0x16b)],_0x56a8f9=await profile[_0x59425f(0x15a)]({'email':_0x1be2e5[_0x59425f(0x17c)]}),_0x4ff494=await staff[_0x59425f(0x15a)]({'email':_0x1be2e5[_0x59425f(0x17c)]});if(_0x1be2e5[_0x59425f(0x1a0)]=='staff'){const _0x3132eb=await staff[_0x59425f(0x15a)]({'email':_0x1be2e5[_0x59425f(0x17c)]});}const _0x57c40c=await master_shop[_0x59425f(0x1db)]();let _0x4f2eaa;if(_0x1be2e5[_0x59425f(0x1a0)]==_0x59425f(0x218)){const _0xd89c1d=await staff[_0x59425f(0x15a)]({'email':_0x1be2e5[_0x59425f(0x17c)]});_0x4f2eaa=await purchases_finished[_0x59425f(0x1b3)]([{'$match':{'warehouse_name':_0xd89c1d[_0x59425f(0x22f)]}},{'$lookup':{'from':'suppliers','localField':_0x59425f(0x22c),'foreignField':_0x59425f(0x1f1),'as':_0x59425f(0x24e)}},{'$unwind':_0x59425f(0x214)},{'$unwind':'$product'},{'$group':{'_id':_0x59425f(0x19e),'invoice':{'$first':_0x59425f(0x1d8)},'suppliers':{'$first':_0x59425f(0x153)},'date':{'$first':_0x59425f(0x1ba)},'warehouse_name':{'$first':_0x59425f(0x1e0)},'room':{'$first':_0x59425f(0x23e)},'product':{'$push':_0x59425f(0x241)},'note':{'$first':_0x59425f(0x227)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x59425f(0x229)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x59425f(0x1b9)},'expiry_date':{'$first':_0x59425f(0x1e3)},'suppliers_docs':{'$first':_0x59425f(0x214)},'total_product_quantity':{'$sum':_0x59425f(0x1f7)},'level':{'$addToSet':_0x59425f(0x1bf)},'isle':{'$addToSet':_0x59425f(0x1aa)},'type':{'$addToSet':_0x59425f(0x222)},'floorlevel':{'$addToSet':_0x59425f(0x188)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4f2eaa=await purchases_finished[_0x59425f(0x1b3)]([{'$unwind':_0x59425f(0x241)},{'$group':{'_id':_0x59425f(0x19e),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x59425f(0x1e0)},'room':{'$addToSet':_0x59425f(0x20c)},'product':{'$push':_0x59425f(0x241)},'note':{'$first':_0x59425f(0x227)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x59425f(0x229)},'return_data':{'$first':_0x59425f(0x1f3)},'batch_code':{'$first':_0x59425f(0x1b9)},'expiry_date':{'$first':_0x59425f(0x1e3)},'suppliers_docs':{'$first':_0x59425f(0x214)},'total_product_quantity':{'$sum':_0x59425f(0x1f7)},'level':{'$addToSet':_0x59425f(0x1bf)},'isle':{'$addToSet':_0x59425f(0x1aa)},'type':{'$addToSet':_0x59425f(0x222)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x57c40c[0x0][_0x59425f(0x20a)]==_0x59425f(0x1e9))var _0x23284b=users['English'];else{if(_0x57c40c[0x0][_0x59425f(0x20a)]==_0x59425f(0x203))var _0x23284b=users[_0x59425f(0x203)];else{if(_0x57c40c[0x0]['language']=='German')var _0x23284b=users[_0x59425f(0x211)];else{if(_0x57c40c[0x0]['language']==_0x59425f(0x1c2))var _0x23284b=users[_0x59425f(0x1c2)];else{if(_0x57c40c[0x0][_0x59425f(0x20a)]==_0x59425f(0x1e4))var _0x23284b=users[_0x59425f(0x1e4)];else{if(_0x57c40c[0x0][_0x59425f(0x20a)]=='Portuguese\x20(BR)')var _0x23284b=users[_0x59425f(0x1eb)];else{if(_0x57c40c[0x0][_0x59425f(0x20a)]==_0x59425f(0x18b))var _0x23284b=users[_0x59425f(0x18b)];else{if(_0x57c40c[0x0][_0x59425f(0x20a)]==_0x59425f(0x18e))var _0x23284b=users[_0x59425f(0x179)];}}}}}}}_0x27c43e[_0x59425f(0x204)]('all_purchases_finished',{'success':_0x4e3bf1[_0x59425f(0x16f)](_0x59425f(0x1d7)),'errors':_0x4e3bf1[_0x59425f(0x16f)](_0x59425f(0x1cd)),'purchases':_0x4f2eaa,'role':_0x1be2e5,'profile':_0x56a8f9,'master_shop':_0x57c40c,'language':_0x23284b});}catch(_0xa02df1){console[_0x59425f(0x242)](_0x59425f(0x1fe),_0xa02df1),_0x27c43e[_0x59425f(0x255)](0xc8)['json']({'message':_0xa02df1['message']});}});function BayBinSelected(_0x1d5b22,_0x3448bf){var _0x134df6=a0_0x461a23,_0x45028a=[],_0x1b6765=[];if(_0x1d5b22==_0x134df6(0x1f0)){switch(_0x3448bf){case _0x134df6(0x256):_0x45028a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x134df6(0x17d):_0x45028a=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1b6765=['DG'];}else{if(_0x1d5b22==_0x134df6(0x24f)){switch(_0x3448bf){case _0x134df6(0x256):_0x45028a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x134df6(0x17d):_0x45028a=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1b6765=['FG'];}}return{'levels':_0x45028a,'identify':_0x1b6765};}function a0_0x3018(_0x53adb7,_0x5057f8){var _0x4d0b9e=a0_0x4d0b();return a0_0x3018=function(_0x3018b0,_0x2dfe15){_0x3018b0=_0x3018b0-0x153;var _0x3852ca=_0x4d0b9e[_0x3018b0];return _0x3852ca;},a0_0x3018(_0x53adb7,_0x5057f8);}async function getRandom8DigitNumber(){var _0x49470b=a0_0x461a23;const _0x149c91=0x989680,_0x5ac76d=0x5f5e0ff,_0x403c40=Math['floor'](Math[_0x49470b(0x187)]()*(_0x5ac76d-_0x149c91+0x1))+_0x149c91;var _0xa0ef00;const _0x3a775f=await purchases_finished[_0x49470b(0x15a)]({'invoice':_0x49470b(0x246)+_0x403c40});return _0x3a775f&&_0x3a775f[_0x49470b(0x220)]>0x0?_0xa0ef00='INCF-'+_0x403c40:_0xa0ef00=_0x49470b(0x246)+_0x403c40,_0xa0ef00;}router[a0_0x461a23(0x20d)](a0_0x461a23(0x245),auth,async(_0x1ddb4f,_0x4b1eb5)=>{var _0x48c4c6=a0_0x461a23;try{const {username:_0x15b623,email:_0x360e53,role:_0x1dbf85}=_0x1ddb4f[_0x48c4c6(0x16b)],_0x588d03=_0x1ddb4f[_0x48c4c6(0x16b)],_0xc550c1=await profile['findOne']({'email':_0x588d03[_0x48c4c6(0x17c)]}),_0x1ad39a=await master_shop[_0x48c4c6(0x1db)](),_0x58565f=await staff[_0x48c4c6(0x15a)]({'email':_0x588d03[_0x48c4c6(0x17c)]}),_0x460609=await suppliers['find']({});let _0xf46346;if(_0x588d03['role']==_0x48c4c6(0x218)){const _0x98c9ef=await staff[_0x48c4c6(0x15a)]({'email':_0x588d03[_0x48c4c6(0x17c)]});_0xf46346=await warehouse[_0x48c4c6(0x1b3)]([{'$match':{'status':_0x48c4c6(0x156),'name':_0x98c9ef[_0x48c4c6(0x22f)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x48c4c6(0x192),'name':{'$first':_0x48c4c6(0x192)}}}]);}else _0xf46346=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x48c4c6(0x198),'name':{'$ne':_0x48c4c6(0x235)}}},{'$group':{'_id':_0x48c4c6(0x192),'name':{'$first':_0x48c4c6(0x192)}}}]);const _0x483770=await product['find']({}),_0x2d9b85=await warehouse[_0x48c4c6(0x1db)]({'status':'Enabled'}),_0xaccf7e=await purchases_finished[_0x48c4c6(0x1db)]({}),_0x1a8130=_0xaccf7e[_0x48c4c6(0x220)]+0x1,_0x44d2f2=_0x48c4c6(0x246)+_0x1a8130[_0x48c4c6(0x1d2)]()['padStart'](0x5,'0');var _0x4b9678=['Ambient',_0x48c4c6(0x209)];if(_0x1ad39a[0x0]['language']=='English\x20(US)')var _0x1dbd78=users[_0x48c4c6(0x206)];else{if(_0x1ad39a[0x0]['language']==_0x48c4c6(0x203))var _0x1dbd78=users[_0x48c4c6(0x203)];else{if(_0x1ad39a[0x0]['language']=='German')var _0x1dbd78=users[_0x48c4c6(0x211)];else{if(_0x1ad39a[0x0][_0x48c4c6(0x20a)]==_0x48c4c6(0x1c2))var _0x1dbd78=users[_0x48c4c6(0x1c2)];else{if(_0x1ad39a[0x0][_0x48c4c6(0x20a)]==_0x48c4c6(0x1e4))var _0x1dbd78=users[_0x48c4c6(0x1e4)];else{if(_0x1ad39a[0x0][_0x48c4c6(0x20a)]==_0x48c4c6(0x162))var _0x1dbd78=users[_0x48c4c6(0x1eb)];else{if(_0x1ad39a[0x0]['language']==_0x48c4c6(0x18b))var _0x1dbd78=users[_0x48c4c6(0x18b)];else{if(_0x1ad39a[0x0][_0x48c4c6(0x20a)]==_0x48c4c6(0x18e))var _0x1dbd78=users[_0x48c4c6(0x179)];}}}}}}}const _0x199311=getRandom8DigitNumber();_0x199311[_0x48c4c6(0x1dd)](_0x404cc0=>{var _0x34f1ee=_0x48c4c6;_0x4b1eb5['render']('add_purchases_finished',{'success':_0x1ddb4f[_0x34f1ee(0x16f)](_0x34f1ee(0x1d7)),'errors':_0x1ddb4f[_0x34f1ee(0x16f)](_0x34f1ee(0x1cd)),'role':_0x588d03,'profile':_0xc550c1,'suppliers':_0x460609,'warehouse':_0xf46346,'product':_0x483770,'invoice':_0x404cc0,'master_shop':_0x1ad39a,'language':_0x1dbd78,'find_data':_0x2d9b85,'rooms_data':_0x4b9678});})['catch'](_0x22740d=>{var _0x4f7cee=_0x48c4c6;_0x1ddb4f['flash']('errors',_0x4f7cee(0x1d1)),_0x4b1eb5[_0x4f7cee(0x243)](_0x4f7cee(0x1ab));});}catch(_0xc5c677){console[_0x48c4c6(0x242)](_0xc5c677);}}),router[a0_0x461a23(0x20d)](a0_0x461a23(0x248),auth,async(_0x30f667,_0xd11035)=>{var _0x52f2b1=a0_0x461a23;try{const _0x2816be=_0x30f667['params']['id'];console['log'](_0x2816be);const _0xf553be=await master_shop['find']();console[_0x52f2b1(0x242)](_0x52f2b1(0x1ea),_0xf553be);const _0x537ad4=await product['findOne']({'name':_0x2816be});console[_0x52f2b1(0x242)]('product',_0x537ad4),_0xd11035['status'](0xc8)[_0x52f2b1(0x202)]({'product_data':_0x537ad4,'master':_0xf553be});}catch(_0x28f1fe){console[_0x52f2b1(0x242)](_0x52f2b1(0x249),_0x28f1fe);}}),router['post'](a0_0x461a23(0x245),auth,async(_0xbd51d9,_0x52cfb8)=>{var _0x20d405=a0_0x461a23;try{const {invoice:_0x3f17a0,date:_0xc3b59f,warehouse_name:_0xfb513,prod_name:_0x39c7c6,prod_code:_0xad26cb,prod_qty:_0x37ae75,prod_unit:_0x2008bf,prod_secondunit:_0x13b898,prod_level:_0x5d0fa8,prod_isle:_0x18690e,prod_pallet:_0x195693,note:_0x577793,expiry_date:_0xf6f4f6,batch_code:_0xd1f4c6,payable:_0x26c5d1,due_amount:_0x3bb2c1,Room_name:_0x2aaed4,primary_code:_0x4e652b,secondary_code:_0x1b8bac,MaxStocks_data:_0x3b935f,PO_number:_0x2d366b,SCRN:_0x296986,JO_number:_0x5c7789}=_0xbd51d9[_0x20d405(0x231)];if(typeof _0x39c7c6==_0x20d405(0x15d))var _0x2b2e00=[_0xbd51d9[_0x20d405(0x231)]['prod_name']],_0x5b449e=[_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1ad)]],_0x15bae6=[_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1a7)]],_0x8c468a=[_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1c3)]],_0x31a126=[_0xbd51d9[_0x20d405(0x231)]['prod_secondunit']],_0x285100=[_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1d3)]],_0x6832aa=[_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1b0)]],_0x75c5ab=[_0xbd51d9['body']['secondary_code']],_0x16b9f0=[_0xbd51d9['body'][_0x20d405(0x201)]],_0x400ae6=[_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1ac)]],_0x39a9ee=[_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1a4)]],_0x577925=[_0xbd51d9['body']['product_date']],_0x1402dc=[_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x23c)]],_0x1d30d9=[_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1c9)]],_0xb02dc4=[_0xbd51d9['body'][_0x20d405(0x169)]],_0x5dd401=[_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x159)]];else var _0x2b2e00=[..._0xbd51d9['body'][_0x20d405(0x21d)]],_0x5b449e=[..._0xbd51d9[_0x20d405(0x231)]['prod_code']],_0x15bae6=[..._0xbd51d9['body']['prod_Qty']],_0x8c468a=[..._0xbd51d9['body'][_0x20d405(0x1c3)]],_0x31a126=[..._0xbd51d9[_0x20d405(0x231)][_0x20d405(0x19a)]],_0x285100=[..._0xbd51d9[_0x20d405(0x231)]['prod_level']],_0x6832aa=[..._0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1b0)]],_0x75c5ab=[..._0xbd51d9[_0x20d405(0x231)]['secondary_code']],_0x16b9f0=[..._0xbd51d9[_0x20d405(0x231)][_0x20d405(0x201)]],_0x400ae6=[..._0xbd51d9[_0x20d405(0x231)]['batch_code']],_0x39a9ee=[..._0xbd51d9['body']['expiry_date']],_0x577925=[..._0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1b7)]],_0x1402dc=[..._0xbd51d9[_0x20d405(0x231)]['max_product_unit']],_0x1d30d9=[..._0xbd51d9[_0x20d405(0x231)][_0x20d405(0x1c9)]],_0xb02dc4=[..._0xbd51d9[_0x20d405(0x231)][_0x20d405(0x169)]],_0x5dd401=[..._0xbd51d9[_0x20d405(0x231)]['prod_invoice']];const _0x2e3ab4=_0x2b2e00['map'](_0x350b44=>{return _0x350b44={'product_name':_0x350b44};});_0x5b449e[_0x20d405(0x23f)]((_0x14a932,_0x2d9957)=>{var _0x5d557d=_0x20d405;_0x2e3ab4[_0x2d9957][_0x5d557d(0x1a3)]=_0x14a932,_0x2e3ab4[_0x2d9957][_0x5d557d(0x15f)]=_0xc3b59f;}),_0x15bae6[_0x20d405(0x23f)]((_0x3c6a53,_0x1e5841)=>{var _0x237ef9=_0x20d405;_0x2e3ab4[_0x1e5841][_0x237ef9(0x17a)]=Math['abs'](_0x3c6a53);}),_0x8c468a[_0x20d405(0x23f)]((_0x535c59,_0x2c68ac)=>{var _0x3609fb=_0x20d405;_0x2e3ab4[_0x2c68ac][_0x3609fb(0x24c)]=_0x535c59;}),_0x31a126['forEach']((_0x2d8f60,_0x30668b)=>{var _0x2b01eb=_0x20d405;_0x2e3ab4[_0x30668b][_0x2b01eb(0x216)]=_0x2d8f60;}),_0x285100[_0x20d405(0x23f)]((_0x84edaf,_0x2ab579)=>{var _0x3ea566=_0x20d405;_0x2e3ab4[_0x2ab579][_0x3ea566(0x158)]=_0x84edaf;}),_0x6832aa['forEach']((_0x3c8298,_0xd26730)=>{var _0x185ed3=_0x20d405;_0x2e3ab4[_0xd26730][_0x185ed3(0x1b0)]=_0x3c8298;}),_0x75c5ab[_0x20d405(0x23f)]((_0x3e1ac0,_0x49bf13)=>{var _0x195930=_0x20d405;_0x2e3ab4[_0x49bf13][_0x195930(0x23b)]=_0x3e1ac0;}),_0x16b9f0[_0x20d405(0x23f)]((_0x19b250,_0x2c93bd)=>{var _0x331344=_0x20d405;_0x2e3ab4[_0x2c93bd][_0x331344(0x1c5)]=_0x19b250;}),_0x400ae6['forEach']((_0x83bb25,_0x476d9d)=>{var _0x290495=_0x20d405;_0x2e3ab4[_0x476d9d][_0x290495(0x1ac)]=_0x83bb25;}),_0x39a9ee['forEach']((_0x38f1b1,_0x46aca6)=>{var _0x1a07a4=_0x20d405;_0x2e3ab4[_0x46aca6][_0x1a07a4(0x1a4)]=_0x38f1b1;}),_0x577925[_0x20d405(0x23f)]((_0x501926,_0x3de4aa)=>{var _0x2d81a2=_0x20d405;_0x2e3ab4[_0x3de4aa][_0x2d81a2(0x1b8)]=_0x501926;}),_0x1402dc[_0x20d405(0x23f)]((_0x54883a,_0x549767)=>{var _0x16394f=_0x20d405;_0x2e3ab4[_0x549767][_0x16394f(0x155)]=_0x54883a;}),_0x1d30d9[_0x20d405(0x23f)]((_0xec718d,_0x1d0896)=>{var _0x361d24=_0x20d405;_0x2e3ab4[_0x1d0896][_0x361d24(0x191)]=_0xec718d;}),_0xb02dc4[_0x20d405(0x23f)]((_0x37a6dc,_0x5721bf)=>{var _0x1bfaa0=_0x20d405;_0x2e3ab4[_0x5721bf][_0x1bfaa0(0x1fb)]=_0x37a6dc;}),_0x5dd401['forEach']((_0x529d53,_0x58e4a9)=>{var _0xdb80f0=_0x20d405;_0x2e3ab4[_0x58e4a9][_0xdb80f0(0x215)]=_0x529d53;});const _0x349b5d=_0x2e3ab4['filter'](_0x408030=>_0x408030[_0x20d405(0x17a)]!=='0'&&_0x408030[_0x20d405(0x17a)]!==''),_0x534458=new purchases_finished({'invoice':_0x3f17a0,'suppliers':_0xbd51d9[_0x20d405(0x231)][_0x20d405(0x22c)],'date':_0xc3b59f,'warehouse_name':_0xfb513,'product':_0x349b5d,'note':_0x577793,'due_amount':_0x3bb2c1,'room':_0x2aaed4,'POnumber':_0x2d366b,'SCRN':_0x296986,'JO_number':_0x5c7789}),_0x120f31=await _0x534458[_0x20d405(0x15b)](),_0x494dbf=await purchases_finished['findOne']({'invoice':_0x3f17a0}),_0x50fc3e=_0x494dbf[_0x20d405(0x1d4)][_0x20d405(0x23a)](async _0x273382=>{var _0x1d5993=_0x20d405;try{var _0x498bb3=await warehouse['findOne']({'name':_0xfb513,'room':_0x273382[_0x1d5993(0x1fb)]}),_0xc89e81=0x0;const _0x3b63f5=_0x498bb3['product_details'][_0x1d5993(0x23a)](_0x416586=>{var _0xa99ebe=_0x1d5993;console[_0xa99ebe(0x242)](_0x416586[_0xa99ebe(0x21e)]+'=='+_0x273382[_0xa99ebe(0x21e)]+'&&'+_0x416586[_0xa99ebe(0x158)]+'=='+_0x273382[_0xa99ebe(0x158)]+'&&'+_0x416586[_0xa99ebe(0x1a4)]+'=='+_0x273382[_0xa99ebe(0x1a4)]+'&&'+_0x416586[_0xa99ebe(0x1b8)]+'=='+_0x273382[_0xa99ebe(0x1b8)]+'&&'+_0x416586['batch_code']+'=='+_0x273382['batch_code']+'&&'+_0x416586['invoice']+'=='+_0x494dbf[_0xa99ebe(0x215)]),_0x416586[_0xa99ebe(0x21e)]==_0x273382['product_name']&&_0x416586[_0xa99ebe(0x158)]==_0x273382[_0xa99ebe(0x158)]&&_0x416586[_0xa99ebe(0x1a4)]==_0x273382[_0xa99ebe(0x1a4)]&&_0x416586['production_date']==_0x273382[_0xa99ebe(0x1b8)]&&_0x416586[_0xa99ebe(0x1ac)]==_0x273382[_0xa99ebe(0x1ac)]&&_0x416586[_0xa99ebe(0x215)]==_0x494dbf[_0xa99ebe(0x215)]&&(_0x416586['product_stock']=Math['abs'](_0x416586['product_stock'])+Math['abs'](_0x273382['quantity']),_0xc89e81++);});return _0xc89e81==0x0&&(_0x498bb3[_0x1d5993(0x252)]=_0x498bb3[_0x1d5993(0x252)][_0x1d5993(0x190)]({'product_name':_0x273382['product_name'],'product_stock':Math[_0x1d5993(0x24a)](_0x273382[_0x1d5993(0x17a)]),'primary_code':_0x273382[_0x1d5993(0x1b0)],'secondary_code':_0x273382[_0x1d5993(0x23b)],'product_code':_0x273382[_0x1d5993(0x1a3)],'bay':_0x273382['bay'],'maxProducts':_0x273382[_0x1d5993(0x1c5)],'unit':_0x273382['standard_unit'],'secondary_unit':_0x273382[_0x1d5993(0x216)],'expiry_date':_0x273382['expiry_date'],'production_date':_0x273382[_0x1d5993(0x1b8)],'maxProducts':_0x273382[_0x1d5993(0x1c5)],'maxPerUnit':_0x273382[_0x1d5993(0x155)],'batch_code':_0x273382[_0x1d5993(0x1ac)],'product_cat':_0x273382[_0x1d5993(0x191)],'invoice':_0x273382[_0x1d5993(0x215)],'id_incoming':_0x273382[_0x1d5993(0x194)],'date_data':_0x273382[_0x1d5993(0x15f)]})),_0x498bb3;}catch(_0x4313fa){return console[_0x1d5993(0x1ae)]('Error\x20occurred\x20while\x20processing\x20product:',_0x4313fa),null;}});Promise[_0x20d405(0x1ce)](_0x50fc3e)[_0x20d405(0x1dd)](async _0x2d2076=>{var _0x3df9a7=_0x20d405;try{for(const _0x5c3cfb of _0x2d2076){await warehouse[_0x3df9a7(0x210)]({'_id':_0x5c3cfb[_0x3df9a7(0x194)]},{'$addToSet':{'product_details':{'$each':_0x5c3cfb[_0x3df9a7(0x252)]}}});}const _0x182b99=await master_shop[_0x3df9a7(0x1db)](),_0x5800a5=await email_settings[_0x3df9a7(0x15a)](),_0x3d2d51=await supervisor_settings[_0x3df9a7(0x1db)]();var _0x404986=_0x494dbf[_0x3df9a7(0x1d4)],_0x424a81='',_0x2f3d0c;for(_0x2f3d0c in _0x404986){var _0x509cfe='FG';_0x494dbf[_0x3df9a7(0x19b)]==_0x3df9a7(0x1f0)&&(_0x509cfe='DG'),_0x424a81+=_0x3df9a7(0x1ec)+_0x3df9a7(0x165)+_0x404986[_0x2f3d0c][_0x3df9a7(0x21e)]+_0x3df9a7(0x1c6)+_0x3df9a7(0x165)+_0x404986[_0x2f3d0c][_0x3df9a7(0x1a3)]+'</td>'+_0x3df9a7(0x165)+_0x404986[_0x2f3d0c][_0x3df9a7(0x17a)]+_0x3df9a7(0x1c6)+_0x3df9a7(0x165)+_0x404986[_0x2f3d0c]['standard_unit']+_0x3df9a7(0x1c6)+_0x3df9a7(0x165)+_0x404986[_0x2f3d0c][_0x3df9a7(0x216)]+_0x3df9a7(0x1c6)+_0x3df9a7(0x165)+_0x494dbf[_0x3df9a7(0x19b)]+'</td>'+_0x3df9a7(0x165)+_0x404986[_0x2f3d0c][_0x3df9a7(0x1fb)]+_0x3df9a7(0x1c6)+_0x3df9a7(0x165)+_0x509cfe+_0x404986[_0x2f3d0c][_0x3df9a7(0x158)]+_0x3df9a7(0x1c6),_0x3df9a7(0x1dc);}let _0x613fa7=nodemailer['createTransport']({'host':_0x5800a5[_0x3df9a7(0x1b4)],'port':Number(_0x5800a5[_0x3df9a7(0x1c8)]),'secure':![],'auth':{'user':_0x5800a5[_0x3df9a7(0x17c)],'pass':_0x5800a5[_0x3df9a7(0x1f4)]}}),_0x12b841={'from':_0x5800a5[_0x3df9a7(0x17c)],'to':_0x3d2d51[0x0][_0x3df9a7(0x16a)],'subject':_0x3df9a7(0x226),'attachments':[{'filename':_0x3df9a7(0x1c0),'path':__dirname+_0x3df9a7(0x176)+_0x3df9a7(0x1d9)+_0x182b99[0x0][_0x3df9a7(0x167)],'cid':_0x3df9a7(0x223)}],'html':'<!DOCTYPE\x20html>'+_0x3df9a7(0x184)+_0x3df9a7(0x230)+'<div>'+_0x3df9a7(0x16d)+_0x3df9a7(0x244)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3df9a7(0x175)+'<div>'+'<h2>\x20'+_0x182b99[0x0][_0x3df9a7(0x166)]+_0x3df9a7(0x238)+_0x3df9a7(0x175)+_0x3df9a7(0x175)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x3df9a7(0x1e7)+_0x3df9a7(0x21b)+_0x494dbf[_0x3df9a7(0x215)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3df9a7(0x1e2)+_0x494dbf[_0x3df9a7(0x1d0)]+'\x20'+_0x3df9a7(0x19c)+_0x3df9a7(0x173)+_0x3df9a7(0x175)+_0x3df9a7(0x20f)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3df9a7(0x1ec)+_0x3df9a7(0x1b5)+_0x3df9a7(0x20e)+_0x3df9a7(0x23d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x3df9a7(0x164)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x3df9a7(0x185)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3df9a7(0x1dc)+_0x3df9a7(0x1da)+_0x3df9a7(0x1cb)+'\x20'+_0x424a81+'\x20'+_0x3df9a7(0x15c)+'</table>'+_0x3df9a7(0x244)+'<strong>\x20Regards\x20</strong>'+_0x3df9a7(0x1e6)+_0x182b99[0x0][_0x3df9a7(0x166)]+'</h5>'+_0x3df9a7(0x175)+_0x3df9a7(0x175)+_0x3df9a7(0x181)};_0x613fa7[_0x3df9a7(0x180)](_0x12b841,function(_0x2f12a2,_0x487fd6){var _0x541436=_0x3df9a7;_0x2f12a2?(console[_0x541436(0x242)](_0x2f12a2),console[_0x541436(0x242)](_0x541436(0x1cc))):console[_0x541436(0x242)](_0x541436(0x174));});}catch(_0x5b5089){console[_0x3df9a7(0x1ae)](_0x5b5089),_0x52cfb8[_0x3df9a7(0x255)](0x1f4)[_0x3df9a7(0x202)]({'error':_0x3df9a7(0x224),'message':_0x5b5089[_0x3df9a7(0x1c7)]});}})[_0x20d405(0x19d)](_0x5b82b8=>{var _0x5e0c4d=_0x20d405;console[_0x5e0c4d(0x1ae)](_0x5b82b8);}),_0xbd51d9[_0x20d405(0x16f)](_0x20d405(0x1d7),'purchase\x20data\x20add\x20successfully'),_0x52cfb8[_0x20d405(0x243)](_0x20d405(0x1ab));}catch(_0xeb1759){console[_0x20d405(0x242)](_0xeb1759);}}),router[a0_0x461a23(0x20d)](a0_0x461a23(0x1b2),auth,async(_0x39c57a,_0x10a143)=>{var _0x3d1c50=a0_0x461a23;try{const {username:_0x5ed0a2,email:_0x4d2e67,role:_0xeeae23}=_0x39c57a[_0x3d1c50(0x16b)],_0x596d3c=_0x39c57a['user'],_0x4e039b=await profile[_0x3d1c50(0x15a)]({'email':_0x596d3c[_0x3d1c50(0x17c)]}),_0x2ec624=await master_shop[_0x3d1c50(0x1db)](),_0x78791d=_0x39c57a[_0x3d1c50(0x22e)]['id'],_0x177b1d=await purchases_finished[_0x3d1c50(0x197)](_0x78791d),_0x3b856d=await suppliers[_0x3d1c50(0x1db)]({});let _0x389610;if(_0x596d3c[_0x3d1c50(0x1a0)]=='staff'){const _0x4583b7=await staff[_0x3d1c50(0x15a)]({'email':_0x596d3c['email']});_0x389610=await warehouse['find']({'status':'Enabled','name':_0x4583b7[_0x3d1c50(0x22f)],'warehouse_category':_0x3d1c50(0x198)});}else _0x389610=await warehouse[_0x3d1c50(0x1b3)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x3d1c50(0x192),'name':{'$first':_0x3d1c50(0x192)}}}]);const _0x39a5d2=await product[_0x3d1c50(0x1db)]({}),_0x4b4639=BayBinSelected(_0x177b1d[_0x3d1c50(0x19b)],_0x177b1d[_0x3d1c50(0x22a)]);let _0x321286=new Date(_0x177b1d[_0x3d1c50(0x1a4)]),_0xaf9467=('0'+_0x321286[_0x3d1c50(0x1ee)]())[_0x3d1c50(0x22b)](-0x2),_0x4e8887=('0'+(_0x321286[_0x3d1c50(0x232)]()+0x1))['slice'](-0x2),_0x109e44=_0x321286[_0x3d1c50(0x18a)](),_0x128dfe=_0x109e44+'-'+_0x4e8887+'-'+_0xaf9467;if(_0x2ec624[0x0][_0x3d1c50(0x20a)]==_0x3d1c50(0x1e9)){var _0x43c89c=users['English'];console['log'](_0x43c89c);}else{if(_0x2ec624[0x0][_0x3d1c50(0x20a)]==_0x3d1c50(0x203))var _0x43c89c=users[_0x3d1c50(0x203)];else{if(_0x2ec624[0x0][_0x3d1c50(0x20a)]==_0x3d1c50(0x211))var _0x43c89c=users[_0x3d1c50(0x211)];else{if(_0x2ec624[0x0]['language']=='Spanish')var _0x43c89c=users[_0x3d1c50(0x1c2)];else{if(_0x2ec624[0x0][_0x3d1c50(0x20a)]=='French')var _0x43c89c=users[_0x3d1c50(0x1e4)];else{if(_0x2ec624[0x0]['language']=='Portuguese\x20(BR)')var _0x43c89c=users[_0x3d1c50(0x1eb)];else{if(_0x2ec624[0x0][_0x3d1c50(0x20a)]==_0x3d1c50(0x18b))var _0x43c89c=users[_0x3d1c50(0x18b)];else{if(_0x2ec624[0x0]['language']==_0x3d1c50(0x18e))var _0x43c89c=users['Arabic'];}}}}}}}_0x10a143[_0x3d1c50(0x204)](_0x3d1c50(0x1fd),{'success':_0x39c57a[_0x3d1c50(0x16f)](_0x3d1c50(0x1d7)),'errors':_0x39c57a['flash'](_0x3d1c50(0x1cd)),'role':_0x596d3c,'profile':_0x4e039b,'purchases':_0x177b1d,'suppliers':_0x3b856d,'warehouse':_0x389610,'product':_0x39a5d2,'master_shop':_0x2ec624,'language':_0x43c89c,'ed_fullDate':_0x128dfe,'dataSelected':_0x4b4639});}catch(_0x152ed5){console[_0x3d1c50(0x242)](_0x152ed5);}}),router[a0_0x461a23(0x20d)]('/view/:id',auth,async(_0x50afde,_0x21717e)=>{var _0x234e0c=a0_0x461a23;try{const {username:_0x25f53d,email:_0x5a8864,role:_0x55cef8}=_0x50afde['user'],_0x192a94=_0x50afde[_0x234e0c(0x16b)],_0xbed303=await profile['findOne']({'email':_0x192a94[_0x234e0c(0x17c)]}),_0x5e098a=await master_shop[_0x234e0c(0x1db)](),_0x298633=_0x50afde['params']['id'],_0x51c42a=await purchases_finished[_0x234e0c(0x197)](_0x298633),_0x3c3488=await suppliers[_0x234e0c(0x1db)]({});let _0x4ec67c;if(_0x192a94[_0x234e0c(0x1a0)]==_0x234e0c(0x218)){const _0x246997=await staff[_0x234e0c(0x15a)]({'email':_0x192a94[_0x234e0c(0x17c)]});_0x4ec67c=await warehouse['find']({'status':_0x234e0c(0x156),'name':_0x246997[_0x234e0c(0x22f)],'warehouse_category':_0x234e0c(0x198)});}else _0x4ec67c=await warehouse[_0x234e0c(0x1b3)]([{'$match':{'status':_0x234e0c(0x156),'warehouse_category':_0x234e0c(0x198)}},{'$group':{'_id':_0x234e0c(0x192),'name':{'$first':_0x234e0c(0x192)}}}]);const _0x293e4c=await product[_0x234e0c(0x1db)]({}),_0xe80c83=BayBinSelected(_0x51c42a[_0x234e0c(0x19b)],_0x51c42a[_0x234e0c(0x22a)]);let _0x2124f4=new Date(_0x51c42a[_0x234e0c(0x1a4)]),_0xc37f30=('0'+_0x2124f4[_0x234e0c(0x1ee)]())[_0x234e0c(0x22b)](-0x2),_0x54342f=('0'+(_0x2124f4[_0x234e0c(0x232)]()+0x1))[_0x234e0c(0x22b)](-0x2),_0x398077=_0x2124f4[_0x234e0c(0x18a)](),_0x27f12d=_0x398077+'-'+_0x54342f+'-'+_0xc37f30;if(_0x5e098a[0x0][_0x234e0c(0x20a)]==_0x234e0c(0x1e9)){var _0x2c94fe=users[_0x234e0c(0x206)];console[_0x234e0c(0x242)](_0x2c94fe);}else{if(_0x5e098a[0x0]['language']=='Hindi')var _0x2c94fe=users[_0x234e0c(0x203)];else{if(_0x5e098a[0x0]['language']==_0x234e0c(0x211))var _0x2c94fe=users[_0x234e0c(0x211)];else{if(_0x5e098a[0x0][_0x234e0c(0x20a)]==_0x234e0c(0x1c2))var _0x2c94fe=users[_0x234e0c(0x1c2)];else{if(_0x5e098a[0x0][_0x234e0c(0x20a)]==_0x234e0c(0x1e4))var _0x2c94fe=users[_0x234e0c(0x1e4)];else{if(_0x5e098a[0x0][_0x234e0c(0x20a)]==_0x234e0c(0x162))var _0x2c94fe=users[_0x234e0c(0x1eb)];else{if(_0x5e098a[0x0][_0x234e0c(0x20a)]=='Chinese')var _0x2c94fe=users['Chinese'];else{if(_0x5e098a[0x0][_0x234e0c(0x20a)]==_0x234e0c(0x18e))var _0x2c94fe=users[_0x234e0c(0x179)];}}}}}}}_0x21717e[_0x234e0c(0x204)](_0x234e0c(0x1e5),{'success':_0x50afde[_0x234e0c(0x16f)]('success'),'errors':_0x50afde[_0x234e0c(0x16f)](_0x234e0c(0x1cd)),'role':_0x192a94,'profile':_0xbed303,'purchases':_0x51c42a,'suppliers':_0x3c3488,'warehouse':_0x4ec67c,'product':_0x293e4c,'master_shop':_0x5e098a,'language':_0x2c94fe,'ed_fullDate':_0x27f12d,'dataSelected':_0xe80c83});}catch(_0x26c1ad){console[_0x234e0c(0x242)](_0x26c1ad);}}),router[a0_0x461a23(0x168)](a0_0x461a23(0x160),auth,async(_0x198b1f,_0x57cc88)=>{var _0x333e47=a0_0x461a23;try{const _0xd5978d=_0x198b1f[_0x333e47(0x22e)]['id'],_0x128f0d=await purchases_finished[_0x333e47(0x15a)]({'_id':_0x198b1f[_0x333e47(0x22e)]['id']}),_0x11a6bd=await warehouse[_0x333e47(0x15a)]({'name':_0x128f0d['warehouse_name'],'room':_0x128f0d[_0x333e47(0x22a)]});_0x128f0d[_0x333e47(0x1d4)][_0x333e47(0x23f)](_0x448b4=>{var _0x40db05=_0x333e47;const _0xc2f2f7=_0x11a6bd[_0x40db05(0x252)][_0x40db05(0x23a)](_0x8bc5c1=>{var _0x356d0a=_0x40db05;_0x8bc5c1['product_name']==_0x448b4[_0x356d0a(0x21e)]&&_0x8bc5c1['bay']==_0x448b4[_0x356d0a(0x158)]&&(_0x8bc5c1['product_stock']=parseInt(_0x8bc5c1[_0x356d0a(0x196)])-parseInt(_0x448b4['quantity']));});}),await _0x11a6bd[_0x333e47(0x15b)]();const {invoice:_0x5e59e5,suppliers:_0x531095,date:_0x23cc6f,warehouse_name:_0x3923ea,prod_name:_0x12383f,prod_code:_0x2eb931,prod_qty:_0x2005bd,prod_unit:_0x49ba8d,prod_secondunit:_0x461300,prod_level:_0x2a1dbb,prod_isle:_0x9820ea,prod_pallet:_0x175cc9,note:_0x3d5142,expiry_date:_0x2cdbe7,batch_code:_0x3f83b0,paid_amount:_0x829ec0,due_amount:_0x416130,Room_name:_0x1beb96,primary_code:_0xb8f7bc,secondary_code:_0x5d6fdf,PO_number:_0x3f8baa,JO_number:_0x35aaa1}=_0x198b1f['body'];if(typeof _0x12383f==_0x333e47(0x15d))var _0x30573f=[_0x198b1f['body'][_0x333e47(0x21d)]],_0x5731c2=[_0x198b1f['body']['prod_code']],_0x4dcff1=[_0x198b1f[_0x333e47(0x231)]['prod_qty']],_0x40969f=[_0x198b1f[_0x333e47(0x231)][_0x333e47(0x1df)]],_0x505a4d=[_0x198b1f[_0x333e47(0x231)][_0x333e47(0x19a)]],_0xfec3e0=[_0x198b1f[_0x333e47(0x231)][_0x333e47(0x1d3)]],_0x2d4b23=[_0x198b1f[_0x333e47(0x231)]['primary_code']],_0x40651c=[_0x198b1f[_0x333e47(0x231)][_0x333e47(0x23b)]],_0x3db859=[_0x198b1f[_0x333e47(0x231)][_0x333e47(0x201)]],_0x510820=[_0x198b1f[_0x333e47(0x231)][_0x333e47(0x1ac)]],_0x46d67e=[_0x198b1f[_0x333e47(0x231)]['expiry_date']];else var _0x30573f=[..._0x198b1f['body'][_0x333e47(0x21d)]],_0x5731c2=[..._0x198b1f[_0x333e47(0x231)][_0x333e47(0x1ad)]],_0x4dcff1=[..._0x198b1f['body'][_0x333e47(0x247)]],_0x40969f=[..._0x198b1f[_0x333e47(0x231)][_0x333e47(0x1df)]],_0x505a4d=[..._0x198b1f['body'][_0x333e47(0x19a)]],_0xfec3e0=[..._0x198b1f[_0x333e47(0x231)][_0x333e47(0x1d3)]],_0x2d4b23=[..._0x198b1f['body'][_0x333e47(0x1b0)]],_0x40651c=[..._0x198b1f[_0x333e47(0x231)][_0x333e47(0x23b)]],_0x3db859=[..._0x198b1f[_0x333e47(0x231)][_0x333e47(0x201)]],_0x510820=[..._0x198b1f[_0x333e47(0x231)][_0x333e47(0x1ac)]],_0x46d67e=[..._0x198b1f[_0x333e47(0x231)][_0x333e47(0x1a4)]];const _0x47022b=_0x30573f[_0x333e47(0x23a)](_0x7cf21c=>{return _0x7cf21c={'product_name':_0x7cf21c};});_0x5731c2[_0x333e47(0x23f)]((_0x1e694c,_0xf2e411)=>{var _0x3a4130=_0x333e47;_0x47022b[_0xf2e411][_0x3a4130(0x1a3)]=_0x1e694c;}),_0x4dcff1[_0x333e47(0x23f)]((_0x40f799,_0x38f0f8)=>{var _0x43d427=_0x333e47;_0x47022b[_0x38f0f8][_0x43d427(0x17a)]=_0x40f799;}),_0x40969f[_0x333e47(0x23f)]((_0x222cd4,_0x4951f3)=>{var _0x295203=_0x333e47;_0x47022b[_0x4951f3][_0x295203(0x24c)]=_0x222cd4;}),_0x505a4d[_0x333e47(0x23f)]((_0x589adc,_0x4e34f4)=>{var _0x3c279f=_0x333e47;_0x47022b[_0x4e34f4][_0x3c279f(0x216)]=_0x589adc;}),_0xfec3e0[_0x333e47(0x23f)]((_0x483ac5,_0x55fe35)=>{var _0x584c6a=_0x333e47;_0x47022b[_0x55fe35][_0x584c6a(0x158)]=_0x483ac5;}),_0x2d4b23[_0x333e47(0x23f)]((_0x3d1619,_0x5b4f56)=>{_0x47022b[_0x5b4f56]['primary_code']=_0x3d1619;}),_0x40651c[_0x333e47(0x23f)]((_0x58df77,_0x2ac26d)=>{_0x47022b[_0x2ac26d]['secondary_code']=_0x58df77;}),_0x3db859['forEach']((_0x184a71,_0x1aae27)=>{_0x47022b[_0x1aae27]['maxStocks']=_0x184a71;}),_0x510820[_0x333e47(0x23f)]((_0x460a9d,_0x38d1e6)=>{var _0x2d9a55=_0x333e47;_0x47022b[_0x38d1e6][_0x2d9a55(0x1ac)]=_0x460a9d;}),_0x46d67e[_0x333e47(0x23f)]((_0x1ffa74,_0xbac0ef)=>{var _0x1bcab5=_0x333e47;_0x47022b[_0xbac0ef][_0x1bcab5(0x1a4)]=_0x1ffa74;});const _0x5a8f2d=_0x47022b[_0x333e47(0x1a2)](_0x273875=>_0x273875[_0x333e47(0x17a)]!=='0'&&_0x273875[_0x333e47(0x17a)]!=='');_0x128f0d[_0x333e47(0x215)]=_0x5e59e5,_0x128f0d[_0x333e47(0x22c)]=_0x531095,_0x128f0d[_0x333e47(0x1d0)]=_0x23cc6f,_0x128f0d[_0x333e47(0x19b)]=_0x3923ea,_0x128f0d[_0x333e47(0x1d4)]=_0x5a8f2d,_0x128f0d[_0x333e47(0x221)]=_0x3d5142,_0x128f0d[_0x333e47(0x1b6)]=_0x829ec0,_0x128f0d[_0x333e47(0x1cf)]=_0x416130,_0x128f0d[_0x333e47(0x22a)]=_0x1beb96,_0x128f0d['POnumber']=_0x3f8baa,_0x128f0d['JO_number']=_0x35aaa1;const _0x260779=await _0x128f0d[_0x333e47(0x15b)](),_0x26ba27=await warehouse[_0x333e47(0x15a)]({'name':_0x198b1f[_0x333e47(0x231)][_0x333e47(0x19b)],'room':_0x198b1f[_0x333e47(0x231)]['Room_name']});_0x128f0d[_0x333e47(0x1d4)]['forEach'](_0x325672=>{var _0x329a2a=_0x333e47,_0x4791bf=0x0;const _0x14d811=_0x26ba27['product_details'][_0x329a2a(0x23a)](_0x5c1bfc=>{var _0x41e4ab=_0x329a2a;_0x5c1bfc[_0x41e4ab(0x21e)]==_0x325672['product_name']&&_0x5c1bfc['bay']==_0x325672[_0x41e4ab(0x158)]&&(_0x5c1bfc[_0x41e4ab(0x196)]=parseInt(_0x5c1bfc[_0x41e4ab(0x196)])+parseInt(_0x325672[_0x41e4ab(0x17a)]),_0x4791bf++);});_0x4791bf=='0'&&(_0x26ba27[_0x329a2a(0x252)]=_0x26ba27[_0x329a2a(0x252)][_0x329a2a(0x190)]({'product_name':_0x325672[_0x329a2a(0x21e)],'product_stock':_0x325672[_0x329a2a(0x17a)],'primary_code':_0x325672[_0x329a2a(0x1b0)],'secondary_code':_0x325672[_0x329a2a(0x23b)],'product_code':_0x325672[_0x329a2a(0x1a3)],'bay':_0x325672[_0x329a2a(0x158)],'maxProducts':_0x325672[_0x329a2a(0x1c5)],'unit':_0x325672[_0x329a2a(0x24c)],'secondary_unit':_0x325672[_0x329a2a(0x216)],'expiry_date':_0x325672[_0x329a2a(0x1a4)]}));}),await _0x26ba27['save']();const _0x5aaa64=await s_payment_data[_0x333e47(0x15a)]({'invoice':_0x198b1f[_0x333e47(0x231)][_0x333e47(0x215)]});if(_0x5aaa64===null){}else console[_0x333e47(0x242)]('suppliers',_0x5aaa64,_0x198b1f['body'][_0x333e47(0x215)]),_0x5aaa64[_0x333e47(0x22c)]=_0x198b1f[_0x333e47(0x231)][_0x333e47(0x22c)],await _0x5aaa64[_0x333e47(0x15b)]();_0x198b1f[_0x333e47(0x16f)](_0x333e47(0x1d7),_0x333e47(0x1ca)),_0x57cc88[_0x333e47(0x243)](_0x333e47(0x1ab));}catch(_0x282161){console[_0x333e47(0x242)](_0x282161);}}),router[a0_0x461a23(0x168)](a0_0x461a23(0x234),auth,async(_0x377e2b,_0xc36ec3)=>{var _0x1bd0ca=a0_0x461a23;try{const _0x50d197=_0x377e2b[_0x1bd0ca(0x22e)]['id'],{invoice:_0x52ca46,suppliers:_0x342a70,payable:_0x19bbf9,due_amount:_0x22d6d8}=_0x377e2b[_0x1bd0ca(0x231)],_0x59eb53=await purchases['findById'](_0x50d197);var _0x5e23fc=_0x19bbf9-_0x22d6d8;_0x59eb53['paid_amount']=parseFloat(_0x59eb53[_0x1bd0ca(0x1b6)])+parseFloat(_0x22d6d8),_0x59eb53[_0x1bd0ca(0x1cf)]=_0x5e23fc;const _0x5203bd=await _0x59eb53[_0x1bd0ca(0x15b)]();console[_0x1bd0ca(0x242)](_0x5203bd);const _0x41ce2c=await s_payment_data[_0x1bd0ca(0x15a)]({'invoice':_0x52ca46});_0x41ce2c[_0x1bd0ca(0x228)]=_0x5e23fc,await _0x41ce2c[_0x1bd0ca(0x15b)]();let _0x14a51=new Date(),_0x770e=('0'+_0x14a51[_0x1bd0ca(0x1ee)]())[_0x1bd0ca(0x22b)](-0x2),_0x2f84ad=('0'+(_0x14a51[_0x1bd0ca(0x232)]()+0x1))['slice'](-0x2),_0x6bed27=_0x14a51[_0x1bd0ca(0x18a)](),_0x45dac3=_0x6bed27+'-'+_0x2f84ad+'-'+_0x770e;const _0x4b960f=new suppliers_payment({'invoice':_0x52ca46,'date':_0x6bed27+'-'+_0x2f84ad+'-'+_0x770e,'suppliers':_0x342a70,'reason':_0x1bd0ca(0x16c),'amount':_0x22d6d8}),_0x49f3b2=await _0x4b960f['save']();_0x377e2b['flash'](_0x1bd0ca(0x1d7),_0x1bd0ca(0x182)),_0xc36ec3['redirect'](_0x1bd0ca(0x219));}catch(_0x438869){console['log'](_0x438869);}}),router[a0_0x461a23(0x20d)](a0_0x461a23(0x1ff),auth,async(_0x7ff37,_0x3df108)=>{var _0x140dc2=a0_0x461a23;try{const {username:_0x30ebcb,email:_0x2790ec,role:_0xe0e28}=_0x7ff37[_0x140dc2(0x16b)],_0x19c639=_0x7ff37[_0x140dc2(0x16b)],_0x33e7b6=await profile[_0x140dc2(0x15a)]({'email':_0x19c639[_0x140dc2(0x17c)]}),_0x520d85=await master_shop[_0x140dc2(0x1db)]();console[_0x140dc2(0x242)]('master',_0x520d85);const _0x3412c4=_0x7ff37[_0x140dc2(0x22e)]['id'],_0x3854d5=await purchases[_0x140dc2(0x197)](_0x3412c4);console[_0x140dc2(0x242)](_0x3854d5);const _0x422bf2=await suppliers['findOne']({'name':_0x3854d5[_0x140dc2(0x22c)]});console[_0x140dc2(0x242)](_0x422bf2);if(_0x520d85[0x0]['language']=='English\x20(US)'){var _0x150cd7=users[_0x140dc2(0x206)];console[_0x140dc2(0x242)](_0x150cd7);}else{if(_0x520d85[0x0][_0x140dc2(0x20a)]=='Hindi')var _0x150cd7=users['Hindi'];else{if(_0x520d85[0x0][_0x140dc2(0x20a)]=='German')var _0x150cd7=users['German'];else{if(_0x520d85[0x0]['language']==_0x140dc2(0x1c2))var _0x150cd7=users[_0x140dc2(0x1c2)];else{if(_0x520d85[0x0][_0x140dc2(0x20a)]==_0x140dc2(0x1e4))var _0x150cd7=users[_0x140dc2(0x1e4)];else{if(_0x520d85[0x0]['language']=='Portuguese\x20(BR)')var _0x150cd7=users[_0x140dc2(0x1eb)];else{if(_0x520d85[0x0]['language']=='Chinese')var _0x150cd7=users['Chinese'];else{if(_0x520d85[0x0][_0x140dc2(0x20a)]==_0x140dc2(0x18e))var _0x150cd7=users['Arabic'];}}}}}}}_0x3df108[_0x140dc2(0x204)]('purchase_invoice',{'success':_0x7ff37['flash'](_0x140dc2(0x1d7)),'errors':_0x7ff37['flash'](_0x140dc2(0x1cd)),'role':_0x19c639,'profile':_0x33e7b6,'master_shop':_0x520d85,'supplier':_0x422bf2,'purchase':_0x3854d5,'language':_0x150cd7});}catch(_0x449b2b){console['log'](_0x449b2b);}}),router[a0_0x461a23(0x20d)](a0_0x461a23(0x195),auth,async(_0x519aa9,_0x31bd34)=>{var _0xb12e97=a0_0x461a23;try{const {username:_0x26b5ba,email:_0x376c6d,role:_0x1ff88f}=_0x519aa9[_0xb12e97(0x16b)],_0x35b8b7=_0x519aa9[_0xb12e97(0x16b)],_0x5f48f5=await profile['findOne']({'email':_0x35b8b7['email']}),_0x3b7391=await master_shop[_0xb12e97(0x1db)]();console['log'](_0xb12e97(0x1ea),_0x3b7391);const _0x4d44d7=_0x519aa9[_0xb12e97(0x22e)]['id'];console[_0xb12e97(0x242)](_0x4d44d7);const _0x3ad9f0=await purchases_finished[_0xb12e97(0x197)](_0x4d44d7);console[_0xb12e97(0x242)](_0xb12e97(0x17b),_0x3ad9f0);const _0x4e944b=await product[_0xb12e97(0x1db)]({}),_0x1d83fd=await warehouse[_0xb12e97(0x1b3)]([{'$match':{'name':_0x3ad9f0[_0xb12e97(0x19b)],'room':_0x3ad9f0['room']}},{'$unwind':_0xb12e97(0x161)},{'$group':{'_id':'$product_details._id','name':{'$first':_0xb12e97(0x1b1)},'product_stock':{'$first':_0xb12e97(0x225)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xb12e97(0x207)},'type':{'$first':_0xb12e97(0x1af)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xb12e97(0x217)},'secondary_code':{'$first':_0xb12e97(0x17e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xb12e97(0x189)},'rack':{'$first':_0xb12e97(0x1a8)}}}]);console[_0xb12e97(0x242)](_0xb12e97(0x170),_0x1d83fd);let _0x5a220e;if(_0x35b8b7[_0xb12e97(0x1a0)]==_0xb12e97(0x218)){const _0x27b2e2=await staff[_0xb12e97(0x15a)]({'email':_0x35b8b7[_0xb12e97(0x17c)]});_0x5a220e=await warehouse['find']({'status':_0xb12e97(0x156),'name':_0x27b2e2[_0xb12e97(0x22f)],'warehouse_category':_0xb12e97(0x198),'name':_0xb12e97(0x172)});}else _0x5a220e=await warehouse[_0xb12e97(0x1b3)]([{'$match':{'status':_0xb12e97(0x156),'warehouse_category':'Finished\x20Goods','name':_0xb12e97(0x172)}},{'$group':{'_id':_0xb12e97(0x192),'name':{'$first':_0xb12e97(0x192)}}}]);if(_0x3b7391[0x0]['language']==_0xb12e97(0x1e9)){var _0x7c498a=users[_0xb12e97(0x206)];console[_0xb12e97(0x242)](_0x7c498a);}else{if(_0x3b7391[0x0][_0xb12e97(0x20a)]==_0xb12e97(0x203))var _0x7c498a=users['Hindi'];else{if(_0x3b7391[0x0]['language']==_0xb12e97(0x211))var _0x7c498a=users[_0xb12e97(0x211)];else{if(_0x3b7391[0x0][_0xb12e97(0x20a)]=='Spanish')var _0x7c498a=users[_0xb12e97(0x1c2)];else{if(_0x3b7391[0x0]['language']==_0xb12e97(0x1e4))var _0x7c498a=users['French'];else{if(_0x3b7391[0x0]['language']==_0xb12e97(0x162))var _0x7c498a=users[_0xb12e97(0x1eb)];else{if(_0x3b7391[0x0]['language']==_0xb12e97(0x18b))var _0x7c498a=users['Chinese'];else{if(_0x3b7391[0x0][_0xb12e97(0x20a)]==_0xb12e97(0x18e))var _0x7c498a=users['Arabic'];}}}}}}}_0x31bd34[_0xb12e97(0x204)](_0xb12e97(0x24b),{'success':_0x519aa9[_0xb12e97(0x16f)]('success'),'errors':_0x519aa9[_0xb12e97(0x16f)](_0xb12e97(0x1cd)),'role':_0x35b8b7,'profile':_0x5f48f5,'user':_0x3ad9f0,'stock':_0x1d83fd,'master_shop':_0x3b7391,'product':_0x4e944b,'language':_0x7c498a,'warehouse':_0x5a220e});}catch(_0x2bc41a){console[_0xb12e97(0x242)](_0x2bc41a);}}),router[a0_0x461a23(0x168)](a0_0x461a23(0x195),auth,async(_0x511a58,_0x34543e)=>{var _0x17e495=a0_0x461a23;try{const {invoice:_0x1a1cb5,date:_0x2eda4a,warehouse_name:_0x5ee345,Room_name:_0x1e0ae2,product_name:_0x367f23,purchase_quantity:_0x5ecf7c,stocks:_0x16e53a,return_qty:_0x1e1abc,note:_0x1c283e,level:_0x4ee701,isle:_0x40a574,pallet:_0x2e2b4c,to_warehouse_name:_0x52b0c0,to_Room_name:_0x3eeeca}=_0x511a58['body'],_0x5ec06d=await purchases_finished['findOne']({'_id':_0x511a58[_0x17e495(0x22e)]['id']}),_0x448f2a=await warehouse['findOne']({'name':_0x5ee345,'room':_0x1e0ae2,'warehouse_category':_0x17e495(0x198)});if(typeof _0x367f23==_0x17e495(0x15d))var _0x27ac51=[_0x511a58['body']['product_name']],_0x4a9b88=[_0x511a58[_0x17e495(0x231)]['purchase_quantity']],_0x33a1df=[_0x511a58[_0x17e495(0x231)][_0x17e495(0x193)]],_0x5778fb=[_0x511a58[_0x17e495(0x231)][_0x17e495(0x1c1)]],_0xa8de21=[_0x511a58[_0x17e495(0x231)][_0x17e495(0x1f8)]],_0x3152ab=[_0x511a58['body'][_0x17e495(0x251)]],_0x588756=[_0x511a58[_0x17e495(0x231)]['primary_code_hide']],_0x2733fa=[_0x511a58[_0x17e495(0x231)][_0x17e495(0x1a1)]];else var _0x27ac51=[..._0x511a58[_0x17e495(0x231)][_0x17e495(0x21e)]],_0x4a9b88=[..._0x511a58[_0x17e495(0x231)][_0x17e495(0x1e1)]],_0x33a1df=[..._0x511a58['body'][_0x17e495(0x193)]],_0x5778fb=[..._0x511a58[_0x17e495(0x231)][_0x17e495(0x1c1)]],_0xa8de21=[..._0x511a58['body'][_0x17e495(0x1f8)]],_0x3152ab=[..._0x511a58[_0x17e495(0x231)][_0x17e495(0x251)]],_0x588756=[..._0x511a58[_0x17e495(0x231)][_0x17e495(0x1bd)]],_0x2733fa=[..._0x511a58[_0x17e495(0x231)]['secondary_code_hide']];const _0x1d8cf7=_0x27ac51[_0x17e495(0x23a)](_0x2da2f4=>{return _0x2da2f4={'product_name':_0x2da2f4};});_0x4a9b88[_0x17e495(0x23f)]((_0x5ec571,_0xf4080b)=>{var _0x4cfa8a=_0x17e495;_0x1d8cf7[_0xf4080b][_0x4cfa8a(0x1e1)]=_0x5ec571;}),_0x33a1df[_0x17e495(0x23f)]((_0x4c9892,_0x55547f)=>{var _0x5bb8b9=_0x17e495;_0x1d8cf7[_0x55547f][_0x5bb8b9(0x186)]=_0x4c9892;}),_0x5778fb[_0x17e495(0x23f)]((_0x59ef61,_0x2e9671)=>{_0x1d8cf7[_0x2e9671]['return_qty']=_0x59ef61;}),_0xa8de21[_0x17e495(0x23f)]((_0x4736c2,_0x27d58a)=>{var _0x40401c=_0x17e495;_0x1d8cf7[_0x27d58a][_0x40401c(0x158)]=_0x4736c2;}),_0x3152ab[_0x17e495(0x23f)]((_0xd064b7,_0x11671f)=>{var _0x1a9204=_0x17e495;_0x1d8cf7[_0x11671f][_0x1a9204(0x1a3)]=_0xd064b7;}),_0x588756[_0x17e495(0x23f)]((_0x5c78ad,_0x16905e)=>{_0x1d8cf7[_0x16905e]['primary_code']=_0x5c78ad;}),_0x2733fa[_0x17e495(0x23f)]((_0x2ccc6c,_0x698813)=>{var _0x2928ed=_0x17e495;_0x1d8cf7[_0x698813][_0x2928ed(0x23b)]=_0x2ccc6c;}),_0x1d8cf7['forEach'](_0xb42d57=>{var _0x43f763=_0x17e495;console['log'](_0xb42d57);const _0x2ad860=_0x448f2a[_0x43f763(0x252)][_0x43f763(0x23a)](_0x5c3fd1=>{var _0x47cce5=_0x43f763;_0x5c3fd1[_0x47cce5(0x21e)]==_0xb42d57[_0x47cce5(0x21e)]&&_0x5c3fd1[_0x47cce5(0x158)]==_0xb42d57[_0x47cce5(0x158)]&&(console[_0x47cce5(0x242)](parseInt(_0x5c3fd1[_0x47cce5(0x196)])+_0x47cce5(0x18f)+parseInt(_0xb42d57[_0x47cce5(0x1c1)])),_0x5c3fd1[_0x47cce5(0x196)]=parseInt(_0x5c3fd1['product_stock'])-parseInt(_0xb42d57['return_qty']));});}),await _0x448f2a[_0x17e495(0x15b)]();var _0x3fabe9=0x0;_0x1d8cf7['forEach'](_0x28b1f2=>{var _0x1deb07=_0x17e495;(parseInt(_0x28b1f2[_0x1deb07(0x1e1)])<parseInt(_0x28b1f2[_0x1deb07(0x1c1)])||parseInt(_0x28b1f2[_0x1deb07(0x186)])<parseInt(_0x28b1f2[_0x1deb07(0x1c1)]))&&_0x3fabe9++;});if(_0x3fabe9!=0x0)return _0x511a58[_0x17e495(0x16f)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x34543e[_0x17e495(0x243)]('back');const _0x96051a=new purchases_return_finished({'invoice':_0x1a1cb5,'suppliers':_0x511a58[_0x17e495(0x231)][_0x17e495(0x22c)],'date':_0x2eda4a,'warehouse_name':_0x5ee345,'return_product':_0x1d8cf7,'note':_0x1c283e,'room':_0x1e0ae2,'to_warehouse_name':_0x52b0c0,'to_room':_0x3eeeca}),_0x3dc465=await _0x96051a[_0x17e495(0x15b)](),_0x26b088=await purchases_return_finished[_0x17e495(0x15a)]({'invoice':_0x1a1cb5}),_0x22d8f9=await warehouse[_0x17e495(0x15a)]({'name':_0x52b0c0,'room':_0x3eeeca,'warehouse_category':_0x17e495(0x198)});_0x26b088[_0x17e495(0x1a9)][_0x17e495(0x23f)](_0x13a5db=>{var _0x18a7c0=_0x17e495,_0x8c29e0=0x0;const _0x21e08a=_0x22d8f9[_0x18a7c0(0x252)][_0x18a7c0(0x23a)](_0x42c253=>{var _0x399f44=_0x18a7c0;console['log'](_0x42c253['product_name']+'=='+_0x13a5db[_0x399f44(0x21e)]+'&&'+_0x42c253['bay']+'=='+_0x13a5db[_0x399f44(0x158)]),_0x42c253[_0x399f44(0x21e)]==_0x13a5db[_0x399f44(0x21e)]&&_0x42c253[_0x399f44(0x158)]==_0x13a5db[_0x399f44(0x158)]&&(_0x42c253['product_stock']=parseInt(_0x42c253['product_stock'])-parseInt(_0x13a5db[_0x399f44(0x1c1)]),_0x8c29e0++);});_0x8c29e0=='0'&&(_0x22d8f9[_0x18a7c0(0x252)]=_0x22d8f9[_0x18a7c0(0x252)]['concat']({'product_name':_0x13a5db[_0x18a7c0(0x21e)],'product_stock':_0x13a5db[_0x18a7c0(0x1c1)],'primary_code':_0x13a5db[_0x18a7c0(0x1b0)],'secondary_code':_0x13a5db['secondary_code'],'product_code':_0x13a5db[_0x18a7c0(0x1a3)],'bay':_0x13a5db[_0x18a7c0(0x158)],'maxProducts':0xf423f}));}),await _0x22d8f9[_0x17e495(0x15b)]();const _0x441343=await purchases_finished[_0x17e495(0x15a)]({'invoice':_0x1a1cb5});_0x441343[_0x17e495(0x253)]=_0x17e495(0x154);const _0x214753=await _0x441343['save'](),_0x21b1a8=new s_payment_data({'invoice':_0x1a1cb5,'suppliers':_0x511a58[_0x17e495(0x231)]['suppliers'],'reason':_0x17e495(0x1e8)});await _0x21b1a8[_0x17e495(0x15b)]();const _0x33e722=await master_shop[_0x17e495(0x1db)](),_0x52d82d=await email_settings[_0x17e495(0x15a)](),_0x483601=await suppliers[_0x17e495(0x15a)]({'name':_0x511a58['body']['suppliers']});_0x33e722[0x0][_0x17e495(0x254)]==0x1?(right_currency=_0x33e722[0x0][_0x17e495(0x171)],left_currency=''):(right_currency='',left_currency=_0x33e722[0x0]['currency']);var _0x232e54=_0x27ac51,_0x410799=_0x5778fb,_0x280e64='',_0x1fdde8;for(_0x1fdde8 in _0x232e54){_0x280e64+=_0x17e495(0x1ec)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x232e54[_0x1fdde8]+'</td>'+_0x17e495(0x165)+_0x410799[_0x1fdde8]+_0x17e495(0x1c6)+_0x17e495(0x1dc);}let _0x1b3635=nodemailer[_0x17e495(0x183)]({'service':_0x17e495(0x212),'auth':{'user':_0x52d82d[_0x17e495(0x17c)],'pass':_0x52d82d[_0x17e495(0x1f4)]}}),_0x476422={'from':_0x52d82d[_0x17e495(0x17c)],'to':_0x483601[_0x17e495(0x17c)],'subject':_0x17e495(0x1f5),'attachments':[{'filename':_0x17e495(0x1c0),'path':__dirname+'/../public'+_0x17e495(0x1d9)+_0x33e722[0x0]['image'],'cid':_0x17e495(0x223)}],'html':'<!DOCTYPE\x20html>'+_0x17e495(0x184)+'</head><body>'+_0x17e495(0x244)+_0x17e495(0x16d)+_0x17e495(0x244)+_0x17e495(0x1a5)+_0x17e495(0x175)+_0x17e495(0x244)+_0x17e495(0x213)+_0x33e722[0x0][_0x17e495(0x166)]+'\x20</h2>'+_0x17e495(0x175)+_0x17e495(0x175)+'<hr\x20class=\x22my-3\x22>'+_0x17e495(0x244)+_0x17e495(0x1e7)+_0x17e495(0x21b)+_0x1a1cb5+'\x20'+_0x17e495(0x239)+_0x17e495(0x1e2)+_0x2eda4a+'\x20'+'</span>'+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x17e495(0x19f)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x17e495(0x1c4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x17e495(0x17f)+_0x17e495(0x1dc)+'</thead>'+_0x17e495(0x1cb)+'\x20'+_0x280e64+'\x20'+'</tbody>'+_0x17e495(0x1d6)+_0x17e495(0x244)+_0x17e495(0x1ef)+_0x17e495(0x1e6)+_0x33e722[0x0][_0x17e495(0x166)]+'</h5>'+'</div>'+_0x17e495(0x175)+_0x17e495(0x181)};_0x1b3635[_0x17e495(0x180)](_0x476422,function(_0x2613a2,_0xc826fb){var _0x27af41=_0x17e495;_0x2613a2?console[_0x27af41(0x242)](_0x27af41(0x1cc)):console[_0x27af41(0x242)](_0x27af41(0x174));}),_0x511a58[_0x17e495(0x16f)]('success',_0x17e495(0x20b)),_0x34543e['redirect'](_0x17e495(0x1ab));}catch(_0x443f13){_0x34543e[_0x17e495(0x255)](0xc8)[_0x17e495(0x202)]({'message':_0x443f13[_0x17e495(0x1c7)]});}}),router[a0_0x461a23(0x20d)]('/barcode/:id',auth,async(_0x26bb5c,_0x3377ed)=>{var _0x4286b1=a0_0x461a23;try{const {username:_0x2680eb,email:_0x42aaa0,role:_0x46694c}=_0x26bb5c[_0x4286b1(0x16b)],_0x40e597=_0x26bb5c[_0x4286b1(0x16b)],_0x5242bf=await profile['findOne']({'email':_0x40e597[_0x4286b1(0x17c)]}),_0x3ef442=await master_shop[_0x4286b1(0x1db)](),_0x130e68=_0x26bb5c['params']['id'],_0x101bf1=await purchases_finished['findById'](_0x130e68);if(_0x3ef442[0x0][_0x4286b1(0x20a)]==_0x4286b1(0x1e9))var _0x115efd=users[_0x4286b1(0x206)];else{if(_0x3ef442[0x0][_0x4286b1(0x20a)]==_0x4286b1(0x203))var _0x115efd=users[_0x4286b1(0x203)];else{if(_0x3ef442[0x0][_0x4286b1(0x20a)]==_0x4286b1(0x211))var _0x115efd=users[_0x4286b1(0x211)];else{if(_0x3ef442[0x0][_0x4286b1(0x20a)]==_0x4286b1(0x1c2))var _0x115efd=users['Spanish'];else{if(_0x3ef442[0x0][_0x4286b1(0x20a)]==_0x4286b1(0x1e4))var _0x115efd=users['French'];else{if(_0x3ef442[0x0][_0x4286b1(0x20a)]=='Portuguese\x20(BR)')var _0x115efd=users[_0x4286b1(0x1eb)];else{if(_0x3ef442[0x0][_0x4286b1(0x20a)]==_0x4286b1(0x18b))var _0x115efd=users[_0x4286b1(0x18b)];else{if(_0x3ef442[0x0]['language']==_0x4286b1(0x18e))var _0x115efd=users[_0x4286b1(0x179)];}}}}}}}_0x3377ed[_0x4286b1(0x204)](_0x4286b1(0x236),{'success':_0x26bb5c[_0x4286b1(0x16f)]('success'),'errors':_0x26bb5c[_0x4286b1(0x16f)]('errors'),'role':_0x40e597,'profile':_0x5242bf,'alldata':_0x101bf1,'master_shop':_0x3ef442,'language':_0x115efd}),console['log'](alldata);}catch(_0x3c199f){console[_0x4286b1(0x242)](_0x3c199f);}}),router[a0_0x461a23(0x168)](a0_0x461a23(0x18c),async(_0x4e0adc,_0x5c0016)=>{var _0x18e869=a0_0x461a23;const {product_code:_0x47c737}=_0x4e0adc[_0x18e869(0x231)];var _0x92433c;const _0x49e26c=await product[_0x18e869(0x1b3)]([{'$match':{'primary_code':_0x47c737,'product_category':_0x18e869(0x198)}},{'$group':{'_id':_0x18e869(0x19e),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x18e869(0x18d)},'unit':{'$first':_0x18e869(0x16e)},'alertquantity':{'$first':_0x18e869(0x22d)},'product_code':{'$first':_0x18e869(0x21f)},'primary_code':{'$first':_0x18e869(0x1be)},'secondary_code':{'$first':_0x18e869(0x163)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x18e869(0x199)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x18e869(0x208)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x33663d=await product[_0x18e869(0x1b3)]([{'$match':{'secondary_code':_0x47c737}},{'$group':{'_id':_0x18e869(0x19e),'name':{'$first':'$name'},'category':{'$first':_0x18e869(0x1ed)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x18e869(0x22d)},'product_code':{'$first':_0x18e869(0x21f)},'primary_code':{'$first':_0x18e869(0x1be)},'secondary_code':{'$first':_0x18e869(0x163)},'maxStocks':{'$first':_0x18e869(0x1d5)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x49e26c[_0x18e869(0x220)]>0x0)_0x92433c=_0x49e26c;else _0x33663d[_0x18e869(0x220)]>0x0&&(_0x92433c=_0x33663d);_0x5c0016[_0x18e869(0x202)](_0x92433c);}),router['post']('/CheckingWarehouse',async(_0x1a55f3,_0x141496)=>{var _0x373ad5=a0_0x461a23;const {productCode:_0x2e5a13,bay:_0x3704d7,warehouses:_0x544fac,room:_0x47953a}=_0x1a55f3['body'];console[_0x373ad5(0x242)](_0x1a55f3[_0x373ad5(0x231)]);try{const _0x5ba294=await warehouse[_0x373ad5(0x1b3)]([{'$match':{'name':_0x544fac,'room':_0x47953a}},{'$unwind':_0x373ad5(0x161)},{'$match':{'product_details.bay':parseInt(_0x3704d7)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x373ad5(0x1b1)},'product_stock':{'$first':_0x373ad5(0x225)},'bay':{'$first':_0x373ad5(0x21a)},'maxProducts':{'$first':_0x373ad5(0x240)}}}]);_0x141496[_0x373ad5(0x255)](0xc8)[_0x373ad5(0x202)](_0x5ba294);}catch(_0x5d46a9){_0x141496[_0x373ad5(0x255)](0x194)['json']({'message':_0x5d46a9['message']});}}),module[a0_0x461a23(0x1fc)]=router;