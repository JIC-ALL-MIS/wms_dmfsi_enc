var a0_0x3caaed=a0_0x20ed;(function(_0x5ec11c,_0x2f7e7c){var _0x15aaf0=a0_0x20ed,_0x437a44=_0x5ec11c();while(!![]){try{var _0x5568de=parseInt(_0x15aaf0(0x23e))/0x1*(parseInt(_0x15aaf0(0x1c4))/0x2)+parseInt(_0x15aaf0(0x23c))/0x3*(-parseInt(_0x15aaf0(0x26b))/0x4)+-parseInt(_0x15aaf0(0x2a2))/0x5*(parseInt(_0x15aaf0(0x1da))/0x6)+parseInt(_0x15aaf0(0x1dd))/0x7+parseInt(_0x15aaf0(0x290))/0x8*(-parseInt(_0x15aaf0(0x1e8))/0x9)+parseInt(_0x15aaf0(0x1cc))/0xa+-parseInt(_0x15aaf0(0x27c))/0xb*(-parseInt(_0x15aaf0(0x2a7))/0xc);if(_0x5568de===_0x2f7e7c)break;else _0x437a44['push'](_0x437a44['shift']());}catch(_0x3792a6){_0x437a44['push'](_0x437a44['shift']());}}}(a0_0x7e2a,0x9535c));const express=require(a0_0x3caaed(0x23f)),app=express(),router=express[a0_0x3caaed(0x24d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x3caaed(0x27f)),auth=require('../middleware/auth'),nodemailer=require('nodemailer');function a0_0x7e2a(){var _0x5dec64=['return_qty','$category','/view/add_purchases/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','edit_purchases_finished','prod_level','$secondary_code','suppliers','Error\x20Occurs','English','Arabic\x20(ae)','staff','/give_payment/:id','prod_unit','$product.bay','createTransport','$_id','get','suppliers_docs','$product_details.floorlevel','errors','Hindi','secondary_code','back','getDate','FROZEN\x20GOODS','return_data','product_name','flash','logo','/all_purchases/view','room_name','body','MaxStocks_data','<h2>\x20','Spanish','prod_qty','/invoice/:id','\x20Order\x20Date\x20:\x20','</td>','English\x20(US)','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<h5>','/all_purchases_finished/view','$product.type','/CheckingWarehouse','all_purchases_finished','French','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','edit_purchases_finished_view','max_product_unit','POnumber','secondary_unit','602220CbSZVc','language','1095TbItmo','express','$product.room_name','$product_code','return_product','Portuguese\x20(BR)','filter','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.type','$warehouse_name','Room_name','return_purchase_finished','Rack\x201','$suppliers_docs','$expiry_date','Router','bay','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.secondary_code','add_purchases\x20error','Enclosed','RoomAssign','<!DOCTYPE\x20html>','password','An\x20error\x20occurred.','success','<span\x20style=\x22float:\x20right;\x22>','user_id','$product.floorlevel','ejs','Purchase\x20Return\x20Mail','due_amount','slice','string','user','image','product_cat','forEach','primary_code_hide','$invoice','stock_quantity','secondary_code_hide','warehouse_name','$product','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','20mhTXdn','/barcode/:id','<tr>','stock_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</h5>','$primary_code','product','prod_secondunit','product_date','gmail','redirect','Arabic','/view/add_purchases','warehouse','site_title','Ambient','13725701pTDmgX','prod_cat','</tbody>','../models/all_models','../public/language/languages.json','$product_details','<hr\x20class=\x22my-3\x22>','table\x20page','</head><body>','<tbody\x20style=\x22text-align:\x20center;\x22>','</span>','$product_details.product_name','$name','post','$batch_code','add_purchases_finished','Paid\x20For\x20Purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details._id','amount','144992TNNbkM','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','purchase_quantity','concat','Email\x20sent\x20successfully','getMonth','$maxProdPerUnit','maxperunit','currency','role','FGSEmail','payment\x20successfull','then','render','log','<h5\x20style=\x22text-align:\x20left;\x22>','Portuguese','$product_details.bay','686110POQMiZ','$product_details.product_stock','_id','Logo.png','padStart','12ImmkzX','error','prod_name','/view/:id','DRY\x20GOODS','purchase\x20data\x20update\x20successfully','length','$product_details.storage','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Chinese','floor','purchase_invoice','product_code','message','German','prod_Qty','Purchase\x20Mail','$return_data','Enabled','purchase\x20data\x20add\x20successfully','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','name','random','$note','$paid_amount','$product.bin','host','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','\x20Order\x20Number\x20:\x20','Purchase\x20Return','550KNpppU','/view/return_purchase/:id','</tr>','prod_code','/preview/:id','primary_code','master','save','4974170DcQQqk','Return\x20Goods','JO_number','maxStocks','params','status','updateOne','invoice','all_purchases_barcode','<html><head><title></title>','<strong>\x20Regards\x20</strong>','</div>','stocks','aggregate','24YVaGih','$maxStocks','</table>','4374237NIdogn','<div>','production_date','prod_primunit','note','catch','prod_invoice','/upload/','map','currency_placement','$date','252ljcqMk','find','json','quantity','getFullYear','product_stock','product_details','True','INCF-','</thead>','email','$suppliers','findById','batch_code','purchases\x20item\x20return\x20successfull','expiry_date','$brand','product_code_hide','sendMail','paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','room','standard_unit','path','Finished\x20Goods','findOne','/../public','$unit','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'];a0_0x7e2a=function(){return _0x5dec64;};return a0_0x7e2a();}var ejs=require(a0_0x3caaed(0x25b));const path=require(a0_0x3caaed(0x200)),users=require(a0_0x3caaed(0x280));router[a0_0x3caaed(0x218)]('/view',auth,async(_0x52ab14,_0x1126e9)=>{var _0x489f77=a0_0x3caaed;try{const {username:_0x88e041,email:_0x1564f7,role:_0x454176}=_0x52ab14[_0x489f77(0x260)],_0x11c558=_0x52ab14[_0x489f77(0x260)],_0x513ec0=await profile['findOne']({'email':_0x11c558[_0x489f77(0x1f2)]}),_0x5ecea0=await staff[_0x489f77(0x202)]({'email':_0x11c558['email']});if(_0x11c558['role']==_0x489f77(0x212)){const _0x390578=await staff[_0x489f77(0x202)]({'email':_0x11c558[_0x489f77(0x1f2)]});}const _0xa09e8d=await master_shop[_0x489f77(0x1e9)]();let _0x177604;if(_0x11c558[_0x489f77(0x299)]==_0x489f77(0x212)){const _0x2278e6=await staff[_0x489f77(0x202)]({'email':_0x11c558[_0x489f77(0x1f2)]});_0x177604=await purchases_finished[_0x489f77(0x1d9)]([{'$match':{'warehouse_name':_0x2278e6['warehouse']}},{'$lookup':{'from':_0x489f77(0x20e),'localField':'suppliers','foreignField':_0x489f77(0x2bd),'as':_0x489f77(0x219)}},{'$unwind':_0x489f77(0x24b)},{'$unwind':_0x489f77(0x269)},{'$group':{'_id':_0x489f77(0x217),'invoice':{'$first':_0x489f77(0x265)},'suppliers':{'$first':_0x489f77(0x1f3)},'date':{'$first':_0x489f77(0x1e7)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':_0x489f77(0x269)},'note':{'$first':_0x489f77(0x1bd)},'paid_amount':{'$first':_0x489f77(0x1be)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x489f77(0x2b8)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x489f77(0x215)},'isle':{'$addToSet':_0x489f77(0x1bf)},'type':{'$addToSet':_0x489f77(0x233)},'floorlevel':{'$addToSet':_0x489f77(0x25a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x177604=await purchases_finished[_0x489f77(0x1d9)]([{'$unwind':_0x489f77(0x269)},{'$group':{'_id':_0x489f77(0x217),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x489f77(0x1f3)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x489f77(0x247)},'room':{'$addToSet':_0x489f77(0x240)},'product':{'$push':_0x489f77(0x269)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x489f77(0x2b8)},'batch_code':{'$first':_0x489f77(0x28a)},'expiry_date':{'$first':_0x489f77(0x24c)},'suppliers_docs':{'$first':_0x489f77(0x24b)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x489f77(0x215)},'isle':{'$addToSet':_0x489f77(0x1bf)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0xa09e8d[0x0][_0x489f77(0x23d)]==_0x489f77(0x22f))var _0x3dc3a1=users[_0x489f77(0x210)];else{if(_0xa09e8d[0x0][_0x489f77(0x23d)]==_0x489f77(0x21c))var _0x3dc3a1=users[_0x489f77(0x21c)];else{if(_0xa09e8d[0x0][_0x489f77(0x23d)]=='German')var _0x3dc3a1=users[_0x489f77(0x2b5)];else{if(_0xa09e8d[0x0][_0x489f77(0x23d)]==_0x489f77(0x22a))var _0x3dc3a1=users[_0x489f77(0x22a)];else{if(_0xa09e8d[0x0][_0x489f77(0x23d)]==_0x489f77(0x236))var _0x3dc3a1=users[_0x489f77(0x236)];else{if(_0xa09e8d[0x0][_0x489f77(0x23d)]=='Portuguese\x20(BR)')var _0x3dc3a1=users[_0x489f77(0x2a0)];else{if(_0xa09e8d[0x0][_0x489f77(0x23d)]==_0x489f77(0x2b0))var _0x3dc3a1=users[_0x489f77(0x2b0)];else{if(_0xa09e8d[0x0]['language']==_0x489f77(0x211))var _0x3dc3a1=users['Arabic'];}}}}}}}_0x1126e9['render'](_0x489f77(0x235),{'success':_0x52ab14[_0x489f77(0x223)]('success'),'errors':_0x52ab14[_0x489f77(0x223)](_0x489f77(0x21b)),'purchases':_0x177604,'role':_0x11c558,'profile':_0x513ec0,'master_shop':_0xa09e8d,'language':_0x3dc3a1});}catch(_0x9ab0fa){console[_0x489f77(0x29e)](_0x489f77(0x283),_0x9ab0fa),_0x1126e9['status'](0xc8)[_0x489f77(0x1ea)]({'message':_0x9ab0fa['message']});}});function BayBinSelected(_0xce1114,_0x491977){var _0x12e1a1=a0_0x3caaed,_0x5ae03f=[],_0x411ffa=[];if(_0xce1114==_0x12e1a1(0x2ab)){switch(_0x491977){case _0x12e1a1(0x24a):_0x5ae03f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x5ae03f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x411ffa=['DG'];}else{if(_0xce1114==_0x12e1a1(0x220)){switch(_0x491977){case'Rack\x201':_0x5ae03f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x5ae03f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x411ffa=['FG'];}}return{'levels':_0x5ae03f,'identify':_0x411ffa};}async function getRandom8DigitNumber(){var _0xb50666=a0_0x3caaed;const _0x403acf=0x989680,_0x107e65=0x5f5e0ff,_0x589834=Math[_0xb50666(0x2b1)](Math[_0xb50666(0x2be)]()*(_0x107e65-_0x403acf+0x1))+_0x403acf;var _0x27d2bb;const _0x573843=await purchases_finished['findOne']({'invoice':'INCF-'+_0x589834});return _0x573843&&_0x573843[_0xb50666(0x2ad)]>0x0?_0x27d2bb=_0xb50666(0x1f0)+_0x589834:_0x27d2bb=_0xb50666(0x1f0)+_0x589834,_0x27d2bb;}function a0_0x20ed(_0x996181,_0x3901ef){var _0x7e2af2=a0_0x7e2a();return a0_0x20ed=function(_0x20ed22,_0x24afa8){_0x20ed22=_0x20ed22-0x1bd;var _0x28d4f8=_0x7e2af2[_0x20ed22];return _0x28d4f8;},a0_0x20ed(_0x996181,_0x3901ef);}router[a0_0x3caaed(0x218)]('/view/add_purchases',auth,async(_0x1f513c,_0x586128)=>{var _0x27a33f=a0_0x3caaed;try{const {username:_0x2c69b2,email:_0x1bf424,role:_0x31171e}=_0x1f513c[_0x27a33f(0x260)],_0x8f7955=_0x1f513c[_0x27a33f(0x260)],_0x5b8937=await profile[_0x27a33f(0x202)]({'email':_0x8f7955[_0x27a33f(0x1f2)]}),_0x56e4d6=await master_shop[_0x27a33f(0x1e9)](),_0x4363ec=await staff[_0x27a33f(0x202)]({'email':_0x8f7955[_0x27a33f(0x1f2)]}),_0x23ea68=await suppliers[_0x27a33f(0x1e9)]({});let _0x399d0c;if(_0x8f7955['role']==_0x27a33f(0x212)){const _0x947793=await staff[_0x27a33f(0x202)]({'email':_0x8f7955[_0x27a33f(0x1f2)]});_0x399d0c=await warehouse[_0x27a33f(0x1d9)]([{'$match':{'status':_0x27a33f(0x2b9),'name':_0x947793[_0x27a33f(0x279)],'warehouse_category':_0x27a33f(0x201)}},{'$group':{'_id':'$name','name':{'$first':_0x27a33f(0x288)}}}]);}else _0x399d0c=await warehouse[_0x27a33f(0x1d9)]([{'$match':{'status':'Enabled','warehouse_category':_0x27a33f(0x201),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x27a33f(0x288),'name':{'$first':_0x27a33f(0x288)}}}]);const _0xdef927=await product[_0x27a33f(0x1e9)]({}),_0xd95967=await warehouse[_0x27a33f(0x1e9)]({'status':'Enabled'}),_0x156e6b=await purchases_finished[_0x27a33f(0x1e9)]({}),_0x5792d7=_0x156e6b[_0x27a33f(0x2ad)]+0x1,_0x20ab8c=_0x27a33f(0x1f0)+_0x5792d7['toString']()[_0x27a33f(0x2a6)](0x5,'0');var _0x50e050=[_0x27a33f(0x27b),_0x27a33f(0x252)];if(_0x56e4d6[0x0][_0x27a33f(0x23d)]==_0x27a33f(0x22f))var _0x3c01ed=users['English'];else{if(_0x56e4d6[0x0][_0x27a33f(0x23d)]==_0x27a33f(0x21c))var _0x3c01ed=users[_0x27a33f(0x21c)];else{if(_0x56e4d6[0x0]['language']==_0x27a33f(0x2b5))var _0x3c01ed=users['German'];else{if(_0x56e4d6[0x0]['language']==_0x27a33f(0x22a))var _0x3c01ed=users[_0x27a33f(0x22a)];else{if(_0x56e4d6[0x0][_0x27a33f(0x23d)]=='French')var _0x3c01ed=users[_0x27a33f(0x236)];else{if(_0x56e4d6[0x0][_0x27a33f(0x23d)]=='Portuguese\x20(BR)')var _0x3c01ed=users[_0x27a33f(0x2a0)];else{if(_0x56e4d6[0x0][_0x27a33f(0x23d)]==_0x27a33f(0x2b0))var _0x3c01ed=users[_0x27a33f(0x2b0)];else{if(_0x56e4d6[0x0][_0x27a33f(0x23d)]=='Arabic\x20(ae)')var _0x3c01ed=users[_0x27a33f(0x277)];}}}}}}}const _0x517d80=getRandom8DigitNumber();_0x517d80['then'](_0x566989=>{var _0x3e5710=_0x27a33f;_0x586128['render'](_0x3e5710(0x28b),{'success':_0x1f513c[_0x3e5710(0x223)](_0x3e5710(0x257)),'errors':_0x1f513c[_0x3e5710(0x223)](_0x3e5710(0x21b)),'role':_0x8f7955,'profile':_0x5b8937,'suppliers':_0x23ea68,'warehouse':_0x399d0c,'product':_0xdef927,'invoice':_0x566989,'master_shop':_0x56e4d6,'language':_0x3c01ed,'find_data':_0xd95967,'rooms_data':_0x50e050});})['catch'](_0x5c73b4=>{var _0x3487b6=_0x27a33f;_0x1f513c[_0x3487b6(0x223)]('errors',_0x3487b6(0x230)),_0x586128[_0x3487b6(0x276)](_0x3487b6(0x232));});}catch(_0x507777){console[_0x27a33f(0x29e)](_0x507777);}}),router[a0_0x3caaed(0x218)](a0_0x3caaed(0x209),auth,async(_0x1aad71,_0x2441ab)=>{var _0x1eba00=a0_0x3caaed;try{const _0x24c528=_0x1aad71[_0x1eba00(0x1d0)]['id'];console[_0x1eba00(0x29e)](_0x24c528);const _0x492484=await master_shop[_0x1eba00(0x1e9)]();console[_0x1eba00(0x29e)](_0x1eba00(0x1ca),_0x492484);const _0x5363d4=await product['findOne']({'name':_0x24c528});console[_0x1eba00(0x29e)](_0x1eba00(0x272),_0x5363d4),_0x2441ab[_0x1eba00(0x1d1)](0xc8)[_0x1eba00(0x1ea)]({'product_data':_0x5363d4,'master':_0x492484});}catch(_0x567cf7){console['log'](_0x1eba00(0x251),_0x567cf7);}}),router['post'](a0_0x3caaed(0x278),auth,async(_0x45bf3c,_0xa3a8b3)=>{var _0x332b73=a0_0x3caaed;try{const {invoice:_0x5e9010,date:_0x292575,warehouse_name:_0x27f334,prod_name:_0x42e012,prod_code:_0x3d9123,prod_qty:_0x274f80,prod_unit:_0x153f78,prod_secondunit:_0x2b72a2,prod_level:_0xc7d98,prod_isle:_0x323b9f,prod_pallet:_0x110c68,note:_0x301ae2,expiry_date:_0x4430da,batch_code:_0x525cde,payable:_0x3da00b,due_amount:_0x55359a,Room_name:_0x3e84f7,primary_code:_0x1de752,secondary_code:_0x425afb,MaxStocks_data:_0x3cd17a,PO_number:_0x54e9f3,SCRN:_0x38d33a,JO_number:_0x179f38}=_0x45bf3c['body'];if(typeof _0x42e012==_0x332b73(0x25f))var _0x1251d5=[_0x45bf3c[_0x332b73(0x227)]['prod_name']],_0x4a0241=[_0x45bf3c[_0x332b73(0x227)][_0x332b73(0x1c7)]],_0x4ebd6c=[_0x45bf3c['body'][_0x332b73(0x2b6)]],_0x3926af=[_0x45bf3c['body']['prod_primunit']],_0x4063c9=[_0x45bf3c[_0x332b73(0x227)]['prod_secondunit']],_0x5b9048=[_0x45bf3c[_0x332b73(0x227)]['prod_level']],_0x20ca5f=[_0x45bf3c[_0x332b73(0x227)][_0x332b73(0x1c9)]],_0x98ea47=[_0x45bf3c[_0x332b73(0x227)]['secondary_code']],_0x17f890=[_0x45bf3c['body'][_0x332b73(0x228)]],_0x3ebe77=[_0x45bf3c[_0x332b73(0x227)][_0x332b73(0x1f5)]],_0x2fd12a=[_0x45bf3c[_0x332b73(0x227)][_0x332b73(0x1f7)]],_0x3123ca=[_0x45bf3c['body'][_0x332b73(0x274)]],_0x76957f=[_0x45bf3c[_0x332b73(0x227)]['max_product_unit']],_0x54e022=[_0x45bf3c['body'][_0x332b73(0x27d)]],_0x128b26=[_0x45bf3c[_0x332b73(0x227)][_0x332b73(0x253)]],_0x397865=[_0x45bf3c[_0x332b73(0x227)][_0x332b73(0x1e3)]];else var _0x1251d5=[..._0x45bf3c['body'][_0x332b73(0x2a9)]],_0x4a0241=[..._0x45bf3c[_0x332b73(0x227)]['prod_code']],_0x4ebd6c=[..._0x45bf3c[_0x332b73(0x227)][_0x332b73(0x2b6)]],_0x3926af=[..._0x45bf3c[_0x332b73(0x227)][_0x332b73(0x1e0)]],_0x4063c9=[..._0x45bf3c[_0x332b73(0x227)][_0x332b73(0x273)]],_0x5b9048=[..._0x45bf3c[_0x332b73(0x227)][_0x332b73(0x20c)]],_0x20ca5f=[..._0x45bf3c['body'][_0x332b73(0x1c9)]],_0x98ea47=[..._0x45bf3c['body'][_0x332b73(0x21d)]],_0x17f890=[..._0x45bf3c['body'][_0x332b73(0x228)]],_0x3ebe77=[..._0x45bf3c['body'][_0x332b73(0x1f5)]],_0x2fd12a=[..._0x45bf3c['body']['expiry_date']],_0x3123ca=[..._0x45bf3c[_0x332b73(0x227)][_0x332b73(0x274)]],_0x76957f=[..._0x45bf3c[_0x332b73(0x227)][_0x332b73(0x239)]],_0x54e022=[..._0x45bf3c[_0x332b73(0x227)][_0x332b73(0x27d)]],_0x128b26=[..._0x45bf3c['body']['RoomAssign']],_0x397865=[..._0x45bf3c['body'][_0x332b73(0x1e3)]];const _0x325ddb=_0x1251d5['map'](_0x5e2858=>{return _0x5e2858={'product_name':_0x5e2858};});_0x4a0241['forEach']((_0x3e7a31,_0x505a5f)=>{var _0x46e398=_0x332b73;_0x325ddb[_0x505a5f][_0x46e398(0x2b3)]=_0x3e7a31;}),_0x4ebd6c['forEach']((_0x329cb0,_0x16ccfc)=>{var _0x519a8f=_0x332b73;_0x325ddb[_0x16ccfc][_0x519a8f(0x1eb)]=_0x329cb0;}),_0x3926af[_0x332b73(0x263)]((_0x587216,_0x18745a)=>{_0x325ddb[_0x18745a]['standard_unit']=_0x587216;}),_0x4063c9[_0x332b73(0x263)]((_0x459b69,_0x5d7699)=>{var _0xab15cc=_0x332b73;_0x325ddb[_0x5d7699][_0xab15cc(0x23b)]=_0x459b69;}),_0x5b9048[_0x332b73(0x263)]((_0x44be18,_0x453647)=>{var _0x3e3c82=_0x332b73;_0x325ddb[_0x453647][_0x3e3c82(0x24e)]=_0x44be18;}),_0x20ca5f['forEach']((_0x5e5219,_0x42ffa8)=>{var _0xeed2ef=_0x332b73;_0x325ddb[_0x42ffa8][_0xeed2ef(0x1c9)]=_0x5e5219;}),_0x98ea47['forEach']((_0x4e7223,_0x535a0f)=>{var _0x5aced6=_0x332b73;_0x325ddb[_0x535a0f][_0x5aced6(0x21d)]=_0x4e7223;}),_0x17f890[_0x332b73(0x263)]((_0x5d7805,_0x44fbf6)=>{var _0x529851=_0x332b73;_0x325ddb[_0x44fbf6][_0x529851(0x1cf)]=_0x5d7805;}),_0x3ebe77[_0x332b73(0x263)]((_0x3e24d6,_0x3fe8c1)=>{var _0x4463e3=_0x332b73;_0x325ddb[_0x3fe8c1][_0x4463e3(0x1f5)]=_0x3e24d6;}),_0x2fd12a['forEach']((_0x294279,_0x428c46)=>{var _0x5da088=_0x332b73;_0x325ddb[_0x428c46][_0x5da088(0x1f7)]=_0x294279;}),_0x3123ca[_0x332b73(0x263)]((_0x412d0d,_0x56db2f)=>{var _0xc7ebe2=_0x332b73;_0x325ddb[_0x56db2f][_0xc7ebe2(0x1df)]=_0x412d0d;}),_0x76957f[_0x332b73(0x263)]((_0x525926,_0x170b60)=>{var _0x18a22b=_0x332b73;_0x325ddb[_0x170b60][_0x18a22b(0x297)]=_0x525926;}),_0x54e022[_0x332b73(0x263)]((_0x1fd9c8,_0x58bd5d)=>{_0x325ddb[_0x58bd5d]['product_cat']=_0x1fd9c8;}),_0x128b26['forEach']((_0x181b02,_0x17ae57)=>{var _0x2771d3=_0x332b73;_0x325ddb[_0x17ae57][_0x2771d3(0x226)]=_0x181b02;}),_0x397865[_0x332b73(0x263)]((_0x18e74e,_0x565353)=>{var _0xd7026b=_0x332b73;_0x325ddb[_0x565353][_0xd7026b(0x1d3)]=_0x18e74e;});const _0x4d278e=_0x325ddb[_0x332b73(0x244)](_0x400be0=>_0x400be0['quantity']!=='0'&&_0x400be0['quantity']!==''),_0x4c8f9b=new purchases_finished({'invoice':_0x5e9010,'suppliers':_0x45bf3c[_0x332b73(0x227)][_0x332b73(0x20e)],'date':_0x292575,'warehouse_name':_0x27f334,'product':_0x4d278e,'note':_0x301ae2,'due_amount':_0x55359a,'room':_0x3e84f7,'POnumber':_0x54e9f3,'SCRN':_0x38d33a,'JO_number':_0x179f38}),_0x2d3dad=await _0x4c8f9b['save'](),_0x45585f=await purchases_finished[_0x332b73(0x202)]({'invoice':_0x5e9010}),_0x480ad7=_0x45585f[_0x332b73(0x272)][_0x332b73(0x1e5)](async _0x4280e1=>{var _0x47e110=_0x332b73,_0x34dc62=await warehouse[_0x47e110(0x202)]({'name':_0x27f334,'room':_0x4280e1[_0x47e110(0x226)]}),_0x587ae5=0x0;const _0x898464=_0x34dc62['product_details'][_0x47e110(0x1e5)](_0x4512cc=>{var _0x4e9c97=_0x47e110;console['log'](_0x4512cc[_0x4e9c97(0x222)]+'=='+_0x4280e1[_0x4e9c97(0x222)]+'&&'+_0x4512cc[_0x4e9c97(0x24e)]+'=='+_0x4280e1[_0x4e9c97(0x24e)]+'&&'+_0x4512cc[_0x4e9c97(0x1f7)]+'=='+_0x4280e1['expiry_date']+'&&'+_0x4512cc[_0x4e9c97(0x1df)]+'=='+_0x4280e1['production_date']+'&&'+_0x4512cc['batch_code']+'=='+_0x4280e1[_0x4e9c97(0x1f5)]+'&&'+_0x4512cc[_0x4e9c97(0x1d3)]+'=='+_0x45585f['invoice']),_0x4512cc[_0x4e9c97(0x222)]==_0x4280e1[_0x4e9c97(0x222)]&&_0x4512cc[_0x4e9c97(0x24e)]==_0x4280e1['bay']&&_0x4512cc[_0x4e9c97(0x1f7)]==_0x4280e1[_0x4e9c97(0x1f7)]&&_0x4512cc[_0x4e9c97(0x1df)]==_0x4280e1[_0x4e9c97(0x1df)]&&_0x4512cc[_0x4e9c97(0x1f5)]==_0x4280e1['batch_code']&&_0x4512cc[_0x4e9c97(0x1d3)]==_0x45585f[_0x4e9c97(0x1d3)]&&(_0x4512cc[_0x4e9c97(0x1ed)]=_0x4512cc['product_stock']+_0x4280e1[_0x4e9c97(0x1eb)],_0x587ae5++);});return _0x587ae5=='0'&&(_0x34dc62['product_details']=_0x34dc62[_0x47e110(0x1ee)][_0x47e110(0x293)]({'product_name':_0x4280e1['product_name'],'product_stock':_0x4280e1[_0x47e110(0x1eb)],'primary_code':_0x4280e1[_0x47e110(0x1c9)],'secondary_code':_0x4280e1[_0x47e110(0x21d)],'product_code':_0x4280e1[_0x47e110(0x2b3)],'bay':_0x4280e1[_0x47e110(0x24e)],'maxProducts':_0x4280e1[_0x47e110(0x1cf)],'unit':_0x4280e1[_0x47e110(0x1ff)],'secondary_unit':_0x4280e1[_0x47e110(0x23b)],'expiry_date':_0x4280e1[_0x47e110(0x1f7)],'production_date':_0x4280e1[_0x47e110(0x1df)],'maxProducts':_0x4280e1[_0x47e110(0x1cf)],'maxPerUnit':_0x4280e1[_0x47e110(0x297)],'batch_code':_0x4280e1[_0x47e110(0x1f5)],'product_cat':_0x4280e1[_0x47e110(0x262)],'invoice':_0x4280e1['invoice']})),_0x34dc62;});Promise['all'](_0x480ad7)[_0x332b73(0x29c)](async _0x388b41=>{var _0x289535=_0x332b73;try{for(const _0x78584a of _0x388b41){await warehouse[_0x289535(0x1d2)]({'_id':_0x78584a[_0x289535(0x2a4)]},{'$addToSet':{'product_details':{'$each':_0x78584a[_0x289535(0x1ee)]}}});}const _0x5e948b=await master_shop['find'](),_0x5c097a=await email_settings[_0x289535(0x202)](),_0x52fcd5=await supervisor_settings[_0x289535(0x1e9)]();var _0x229743=_0x45585f['product'],_0x2ffde3='',_0x3dd9eb;for(_0x3dd9eb in _0x229743){var _0x18749d='FG';_0x45585f[_0x289535(0x268)]==_0x289535(0x2ab)&&(_0x18749d='DG'),_0x2ffde3+=_0x289535(0x26d)+_0x289535(0x1c1)+_0x229743[_0x3dd9eb][_0x289535(0x222)]+_0x289535(0x22e)+_0x289535(0x1c1)+_0x229743[_0x3dd9eb][_0x289535(0x2b3)]+_0x289535(0x22e)+_0x289535(0x1c1)+_0x229743[_0x3dd9eb][_0x289535(0x1eb)]+_0x289535(0x22e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x229743[_0x3dd9eb][_0x289535(0x1ff)]+'</td>'+_0x289535(0x1c1)+_0x229743[_0x3dd9eb]['secondary_unit']+_0x289535(0x22e)+_0x289535(0x1c1)+_0x45585f['warehouse_name']+_0x289535(0x22e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x229743[_0x3dd9eb][_0x289535(0x226)]+'</td>'+_0x289535(0x1c1)+_0x18749d+_0x229743[_0x3dd9eb][_0x289535(0x24e)]+'</td>',_0x289535(0x1c6);}let _0x30731b=nodemailer[_0x289535(0x216)]({'host':_0x5c097a[_0x289535(0x1c0)],'port':Number(_0x5c097a['port']),'secure':![],'auth':{'user':_0x5c097a['email'],'pass':_0x5c097a[_0x289535(0x255)]}}),_0x15a795={'from':_0x5c097a['email'],'to':_0x52fcd5[0x0][_0x289535(0x29a)],'subject':_0x289535(0x2b7),'attachments':[{'filename':_0x289535(0x2a5),'path':__dirname+_0x289535(0x203)+_0x289535(0x1e4)+_0x5e948b[0x0][_0x289535(0x261)],'cid':_0x289535(0x224)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x289535(0x284)+_0x289535(0x1de)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x289535(0x1de)+_0x289535(0x26a)+'</div>'+'<div>'+_0x289535(0x229)+_0x5e948b[0x0]['site_title']+_0x289535(0x2bb)+_0x289535(0x1d7)+_0x289535(0x1d7)+'<hr\x20class=\x22my-3\x22>'+_0x289535(0x1de)+_0x289535(0x29f)+_0x289535(0x1c2)+_0x45585f[_0x289535(0x1d3)]+'\x20'+_0x289535(0x258)+_0x289535(0x22d)+_0x45585f['date']+'\x20'+'</span>'+_0x289535(0x270)+_0x289535(0x1d7)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x289535(0x2af)+_0x289535(0x26d)+_0x289535(0x26f)+_0x289535(0x2bc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x289535(0x237)+_0x289535(0x1fc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x289535(0x28d)+_0x289535(0x291)+_0x289535(0x1c6)+_0x289535(0x1f1)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2ffde3+'\x20'+'</tbody>'+'</table>'+_0x289535(0x1de)+_0x289535(0x1d6)+_0x289535(0x231)+_0x5e948b[0x0][_0x289535(0x27a)]+_0x289535(0x270)+_0x289535(0x1d7)+'</div>'+'</body></html>'};_0x30731b[_0x289535(0x1fa)](_0x15a795,function(_0x52c67c,_0x4ba862){var _0x2fded3=_0x289535;_0x52c67c?(console[_0x2fded3(0x29e)](_0x52c67c),console[_0x2fded3(0x29e)](_0x2fded3(0x20f))):console['log'](_0x2fded3(0x294));});}catch(_0x3b8694){console[_0x289535(0x2a8)](_0x3b8694),_0xa3a8b3[_0x289535(0x1d1)](0x1f4)['json']({'error':_0x289535(0x24f),'message':_0x3b8694[_0x289535(0x2b4)]});}})[_0x332b73(0x1e2)](_0x251b01=>{var _0x3bcbce=_0x332b73;console[_0x3bcbce(0x2a8)](_0x251b01),_0xa3a8b3[_0x3bcbce(0x1d1)](0x1f4)[_0x3bcbce(0x1ea)]({'error':_0x3bcbce(0x256)});}),_0x45bf3c['flash']('success',_0x332b73(0x2ba)),_0xa3a8b3[_0x332b73(0x276)](_0x332b73(0x232));}catch(_0x14ef33){console[_0x332b73(0x29e)](_0x14ef33);}}),router[a0_0x3caaed(0x218)](a0_0x3caaed(0x1c8),auth,async(_0x418129,_0x3222a6)=>{var _0x581b01=a0_0x3caaed;try{const {username:_0x5518e7,email:_0x2d987f,role:_0x230691}=_0x418129[_0x581b01(0x260)],_0x188ef0=_0x418129[_0x581b01(0x260)],_0xd9e712=await profile[_0x581b01(0x202)]({'email':_0x188ef0[_0x581b01(0x1f2)]}),_0x44242e=await master_shop[_0x581b01(0x1e9)](),_0x322cff=_0x418129[_0x581b01(0x1d0)]['id'],_0x3632b5=await purchases_finished[_0x581b01(0x1f4)](_0x322cff),_0x2d1b9d=await suppliers[_0x581b01(0x1e9)]({});let _0x50d7a0;if(_0x188ef0[_0x581b01(0x299)]==_0x581b01(0x212)){const _0x5b640b=await staff[_0x581b01(0x202)]({'email':_0x188ef0['email']});_0x50d7a0=await warehouse[_0x581b01(0x1e9)]({'status':_0x581b01(0x2b9),'name':_0x5b640b[_0x581b01(0x279)],'warehouse_category':_0x581b01(0x201)});}else _0x50d7a0=await warehouse[_0x581b01(0x1d9)]([{'$match':{'status':_0x581b01(0x2b9),'warehouse_category':_0x581b01(0x201)}},{'$group':{'_id':'$name','name':{'$first':_0x581b01(0x288)}}}]);const _0x1e704d=await product['find']({}),_0x1d5613=BayBinSelected(_0x3632b5[_0x581b01(0x268)],_0x3632b5[_0x581b01(0x1fe)]);let _0xe5dee=new Date(_0x3632b5['expiry_date']),_0x5ec51b=('0'+_0xe5dee[_0x581b01(0x21f)]())[_0x581b01(0x25e)](-0x2),_0x1b5315=('0'+(_0xe5dee['getMonth']()+0x1))[_0x581b01(0x25e)](-0x2),_0x333dcc=_0xe5dee[_0x581b01(0x1ec)](),_0x396603=_0x333dcc+'-'+_0x1b5315+'-'+_0x5ec51b;if(_0x44242e[0x0][_0x581b01(0x23d)]=='English\x20(US)'){var _0x4ec2df=users['English'];console[_0x581b01(0x29e)](_0x4ec2df);}else{if(_0x44242e[0x0][_0x581b01(0x23d)]==_0x581b01(0x21c))var _0x4ec2df=users[_0x581b01(0x21c)];else{if(_0x44242e[0x0][_0x581b01(0x23d)]==_0x581b01(0x2b5))var _0x4ec2df=users['German'];else{if(_0x44242e[0x0][_0x581b01(0x23d)]==_0x581b01(0x22a))var _0x4ec2df=users[_0x581b01(0x22a)];else{if(_0x44242e[0x0][_0x581b01(0x23d)]==_0x581b01(0x236))var _0x4ec2df=users[_0x581b01(0x236)];else{if(_0x44242e[0x0][_0x581b01(0x23d)]=='Portuguese\x20(BR)')var _0x4ec2df=users[_0x581b01(0x2a0)];else{if(_0x44242e[0x0]['language']==_0x581b01(0x2b0))var _0x4ec2df=users[_0x581b01(0x2b0)];else{if(_0x44242e[0x0]['language']==_0x581b01(0x211))var _0x4ec2df=users['Arabic'];}}}}}}}_0x3222a6[_0x581b01(0x29d)](_0x581b01(0x238),{'success':_0x418129['flash'](_0x581b01(0x257)),'errors':_0x418129['flash']('errors'),'role':_0x188ef0,'profile':_0xd9e712,'purchases':_0x3632b5,'suppliers':_0x2d1b9d,'warehouse':_0x50d7a0,'product':_0x1e704d,'master_shop':_0x44242e,'language':_0x4ec2df,'ed_fullDate':_0x396603,'dataSelected':_0x1d5613});}catch(_0x33f788){console[_0x581b01(0x29e)](_0x33f788);}}),router['get']('/view/:id',auth,async(_0x191251,_0x3c65c7)=>{var _0x2838f9=a0_0x3caaed;try{const {username:_0x3a606a,email:_0xfe518e,role:_0x5e6cd6}=_0x191251['user'],_0x47ba8b=_0x191251['user'],_0x32e2cb=await profile[_0x2838f9(0x202)]({'email':_0x47ba8b['email']}),_0xbdc35f=await master_shop[_0x2838f9(0x1e9)](),_0x5b4b4e=_0x191251['params']['id'],_0x38c5fa=await purchases_finished[_0x2838f9(0x1f4)](_0x5b4b4e),_0x1c9620=await suppliers[_0x2838f9(0x1e9)]({});let _0x523b30;if(_0x47ba8b[_0x2838f9(0x299)]==_0x2838f9(0x212)){const _0x261de0=await staff[_0x2838f9(0x202)]({'email':_0x47ba8b['email']});_0x523b30=await warehouse[_0x2838f9(0x1e9)]({'status':_0x2838f9(0x2b9),'name':_0x261de0[_0x2838f9(0x279)],'warehouse_category':'Finished\x20Goods'});}else _0x523b30=await warehouse[_0x2838f9(0x1d9)]([{'$match':{'status':_0x2838f9(0x2b9),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x2838f9(0x288),'name':{'$first':_0x2838f9(0x288)}}}]);const _0xe92dae=await product[_0x2838f9(0x1e9)]({}),_0x40747e=BayBinSelected(_0x38c5fa[_0x2838f9(0x268)],_0x38c5fa[_0x2838f9(0x1fe)]);let _0x28e87e=new Date(_0x38c5fa['expiry_date']),_0x3b6672=('0'+_0x28e87e[_0x2838f9(0x21f)]())[_0x2838f9(0x25e)](-0x2),_0x1729f9=('0'+(_0x28e87e['getMonth']()+0x1))[_0x2838f9(0x25e)](-0x2),_0x36b599=_0x28e87e[_0x2838f9(0x1ec)](),_0x4a2ab9=_0x36b599+'-'+_0x1729f9+'-'+_0x3b6672;if(_0xbdc35f[0x0][_0x2838f9(0x23d)]==_0x2838f9(0x22f)){var _0x24fe0c=users[_0x2838f9(0x210)];console[_0x2838f9(0x29e)](_0x24fe0c);}else{if(_0xbdc35f[0x0]['language']==_0x2838f9(0x21c))var _0x24fe0c=users[_0x2838f9(0x21c)];else{if(_0xbdc35f[0x0][_0x2838f9(0x23d)]=='German')var _0x24fe0c=users[_0x2838f9(0x2b5)];else{if(_0xbdc35f[0x0][_0x2838f9(0x23d)]==_0x2838f9(0x22a))var _0x24fe0c=users[_0x2838f9(0x22a)];else{if(_0xbdc35f[0x0][_0x2838f9(0x23d)]=='French')var _0x24fe0c=users[_0x2838f9(0x236)];else{if(_0xbdc35f[0x0][_0x2838f9(0x23d)]=='Portuguese\x20(BR)')var _0x24fe0c=users[_0x2838f9(0x2a0)];else{if(_0xbdc35f[0x0][_0x2838f9(0x23d)]=='Chinese')var _0x24fe0c=users[_0x2838f9(0x2b0)];else{if(_0xbdc35f[0x0]['language']==_0x2838f9(0x211))var _0x24fe0c=users[_0x2838f9(0x277)];}}}}}}}_0x3c65c7[_0x2838f9(0x29d)](_0x2838f9(0x20b),{'success':_0x191251[_0x2838f9(0x223)](_0x2838f9(0x257)),'errors':_0x191251[_0x2838f9(0x223)](_0x2838f9(0x21b)),'role':_0x47ba8b,'profile':_0x32e2cb,'purchases':_0x38c5fa,'suppliers':_0x1c9620,'warehouse':_0x523b30,'product':_0xe92dae,'master_shop':_0xbdc35f,'language':_0x24fe0c,'ed_fullDate':_0x4a2ab9,'dataSelected':_0x40747e});}catch(_0x22f1a2){console[_0x2838f9(0x29e)](_0x22f1a2);}}),router[a0_0x3caaed(0x289)](a0_0x3caaed(0x2aa),auth,async(_0x70b13f,_0x4fe606)=>{var _0x4a6c8e=a0_0x3caaed;try{const _0x5186ab=_0x70b13f['params']['id'],_0x4e2af2=await purchases_finished['findOne']({'_id':_0x70b13f['params']['id']}),_0x5a5827=await warehouse[_0x4a6c8e(0x202)]({'name':_0x4e2af2[_0x4a6c8e(0x268)],'room':_0x4e2af2[_0x4a6c8e(0x1fe)]});_0x4e2af2[_0x4a6c8e(0x272)][_0x4a6c8e(0x263)](_0x240957=>{var _0x5df8b5=_0x4a6c8e;const _0x45015b=_0x5a5827['product_details'][_0x5df8b5(0x1e5)](_0x391ab3=>{var _0x13d5b0=_0x5df8b5;_0x391ab3['product_name']==_0x240957[_0x13d5b0(0x222)]&&_0x391ab3[_0x13d5b0(0x24e)]==_0x240957[_0x13d5b0(0x24e)]&&(_0x391ab3[_0x13d5b0(0x1ed)]=parseInt(_0x391ab3[_0x13d5b0(0x1ed)])-parseInt(_0x240957[_0x13d5b0(0x1eb)]));});}),await _0x5a5827[_0x4a6c8e(0x1cb)]();const {invoice:_0x13969b,suppliers:_0x2695df,date:_0x62bfe5,warehouse_name:_0x866ccb,prod_name:_0x4dfeab,prod_code:_0x1b0253,prod_qty:_0x3153da,prod_unit:_0x332d35,prod_secondunit:_0x2e1442,prod_level:_0x2bf13e,prod_isle:_0x975e2d,prod_pallet:_0xab963b,note:_0x2ba0b7,expiry_date:_0x27a0d6,batch_code:_0x2b3e37,paid_amount:_0x2898e0,due_amount:_0x3d22c3,Room_name:_0x43d48b,primary_code:_0x32330e,secondary_code:_0x3e7839,PO_number:_0x7f131b,JO_number:_0x2f3ef1}=_0x70b13f['body'];if(typeof _0x4dfeab==_0x4a6c8e(0x25f))var _0x555e8d=[_0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x2a9)]],_0x1df27a=[_0x70b13f['body'][_0x4a6c8e(0x1c7)]],_0x52cfac=[_0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x22b)]],_0x1035c7=[_0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x214)]],_0x2af402=[_0x70b13f[_0x4a6c8e(0x227)]['prod_secondunit']],_0x7e4494=[_0x70b13f[_0x4a6c8e(0x227)]['prod_level']],_0x2598f0=[_0x70b13f['body']['primary_code']],_0x272106=[_0x70b13f[_0x4a6c8e(0x227)]['secondary_code']],_0x3fd759=[_0x70b13f[_0x4a6c8e(0x227)]['MaxStocks_data']],_0x1f12c3=[_0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x1f5)]],_0x5916e0=[_0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x1f7)]];else var _0x555e8d=[..._0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x2a9)]],_0x1df27a=[..._0x70b13f[_0x4a6c8e(0x227)]['prod_code']],_0x52cfac=[..._0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x22b)]],_0x1035c7=[..._0x70b13f['body'][_0x4a6c8e(0x214)]],_0x2af402=[..._0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x273)]],_0x7e4494=[..._0x70b13f['body'][_0x4a6c8e(0x20c)]],_0x2598f0=[..._0x70b13f['body'][_0x4a6c8e(0x1c9)]],_0x272106=[..._0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x21d)]],_0x3fd759=[..._0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x228)]],_0x1f12c3=[..._0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x1f5)]],_0x5916e0=[..._0x70b13f['body'][_0x4a6c8e(0x1f7)]];const _0x39836f=_0x555e8d['map'](_0x516a8b=>{return _0x516a8b={'product_name':_0x516a8b};});_0x1df27a[_0x4a6c8e(0x263)]((_0x322cc5,_0x105b12)=>{var _0xf58c2c=_0x4a6c8e;_0x39836f[_0x105b12][_0xf58c2c(0x2b3)]=_0x322cc5;}),_0x52cfac[_0x4a6c8e(0x263)]((_0x48d76a,_0x2cfafc)=>{var _0x3e7dac=_0x4a6c8e;_0x39836f[_0x2cfafc][_0x3e7dac(0x1eb)]=_0x48d76a;}),_0x1035c7[_0x4a6c8e(0x263)]((_0x4c92b1,_0x586f58)=>{var _0x44ddc4=_0x4a6c8e;_0x39836f[_0x586f58][_0x44ddc4(0x1ff)]=_0x4c92b1;}),_0x2af402[_0x4a6c8e(0x263)]((_0x4f10df,_0xdf0307)=>{var _0x2a9054=_0x4a6c8e;_0x39836f[_0xdf0307][_0x2a9054(0x23b)]=_0x4f10df;}),_0x7e4494[_0x4a6c8e(0x263)]((_0x22e3bd,_0x41087e)=>{_0x39836f[_0x41087e]['bay']=_0x22e3bd;}),_0x2598f0['forEach']((_0x3f58c8,_0x292c6f)=>{var _0x2a3b87=_0x4a6c8e;_0x39836f[_0x292c6f][_0x2a3b87(0x1c9)]=_0x3f58c8;}),_0x272106[_0x4a6c8e(0x263)]((_0x3c5a4a,_0x404b0f)=>{var _0x2fe54e=_0x4a6c8e;_0x39836f[_0x404b0f][_0x2fe54e(0x21d)]=_0x3c5a4a;}),_0x3fd759[_0x4a6c8e(0x263)]((_0x12e164,_0x3b0a8c)=>{_0x39836f[_0x3b0a8c]['maxStocks']=_0x12e164;}),_0x1f12c3[_0x4a6c8e(0x263)]((_0x2eac3e,_0x1ec87d)=>{_0x39836f[_0x1ec87d]['batch_code']=_0x2eac3e;}),_0x5916e0[_0x4a6c8e(0x263)]((_0x29af7c,_0x424102)=>{var _0x51a8df=_0x4a6c8e;_0x39836f[_0x424102][_0x51a8df(0x1f7)]=_0x29af7c;});const _0x2fde5c=_0x39836f[_0x4a6c8e(0x244)](_0x27b172=>_0x27b172[_0x4a6c8e(0x1eb)]!=='0'&&_0x27b172[_0x4a6c8e(0x1eb)]!=='');_0x4e2af2[_0x4a6c8e(0x1d3)]=_0x13969b,_0x4e2af2[_0x4a6c8e(0x20e)]=_0x2695df,_0x4e2af2['date']=_0x62bfe5,_0x4e2af2[_0x4a6c8e(0x268)]=_0x866ccb,_0x4e2af2[_0x4a6c8e(0x272)]=_0x2fde5c,_0x4e2af2[_0x4a6c8e(0x1e1)]=_0x2ba0b7,_0x4e2af2[_0x4a6c8e(0x1fb)]=_0x2898e0,_0x4e2af2[_0x4a6c8e(0x25d)]=_0x3d22c3,_0x4e2af2[_0x4a6c8e(0x1fe)]=_0x43d48b,_0x4e2af2[_0x4a6c8e(0x23a)]=_0x7f131b,_0x4e2af2[_0x4a6c8e(0x1ce)]=_0x2f3ef1;const _0xae509c=await _0x4e2af2[_0x4a6c8e(0x1cb)](),_0x16fcce=await warehouse['findOne']({'name':_0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x268)],'room':_0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x248)]});_0x4e2af2[_0x4a6c8e(0x272)][_0x4a6c8e(0x263)](_0x105988=>{var _0x57635a=_0x4a6c8e,_0x5a2bd9=0x0;const _0x117ed5=_0x16fcce[_0x57635a(0x1ee)][_0x57635a(0x1e5)](_0x49a964=>{var _0x1840b4=_0x57635a;_0x49a964[_0x1840b4(0x222)]==_0x105988[_0x1840b4(0x222)]&&_0x49a964[_0x1840b4(0x24e)]==_0x105988[_0x1840b4(0x24e)]&&(_0x49a964['product_stock']=parseInt(_0x49a964[_0x1840b4(0x1ed)])+parseInt(_0x105988[_0x1840b4(0x1eb)]),_0x5a2bd9++);});_0x5a2bd9=='0'&&(_0x16fcce[_0x57635a(0x1ee)]=_0x16fcce['product_details'][_0x57635a(0x293)]({'product_name':_0x105988[_0x57635a(0x222)],'product_stock':_0x105988[_0x57635a(0x1eb)],'primary_code':_0x105988[_0x57635a(0x1c9)],'secondary_code':_0x105988[_0x57635a(0x21d)],'product_code':_0x105988[_0x57635a(0x2b3)],'bay':_0x105988[_0x57635a(0x24e)],'maxProducts':_0x105988[_0x57635a(0x1cf)],'unit':_0x105988[_0x57635a(0x1ff)],'secondary_unit':_0x105988['secondary_unit'],'expiry_date':_0x105988['expiry_date']}));}),await _0x16fcce[_0x4a6c8e(0x1cb)]();const _0x351b49=await s_payment_data[_0x4a6c8e(0x202)]({'invoice':_0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x1d3)]});if(_0x351b49===null){}else console[_0x4a6c8e(0x29e)](_0x4a6c8e(0x20e),_0x351b49,_0x70b13f[_0x4a6c8e(0x227)][_0x4a6c8e(0x1d3)]),_0x351b49[_0x4a6c8e(0x20e)]=_0x70b13f[_0x4a6c8e(0x227)]['suppliers'],await _0x351b49[_0x4a6c8e(0x1cb)]();_0x70b13f[_0x4a6c8e(0x223)](_0x4a6c8e(0x257),_0x4a6c8e(0x2ac)),_0x4fe606[_0x4a6c8e(0x276)](_0x4a6c8e(0x232));}catch(_0x221787){console[_0x4a6c8e(0x29e)](_0x221787);}}),router['post'](a0_0x3caaed(0x213),auth,async(_0x1961f0,_0x268cb0)=>{var _0x2289ec=a0_0x3caaed;try{const _0x268223=_0x1961f0[_0x2289ec(0x1d0)]['id'],{invoice:_0x528de4,suppliers:_0xdb07f6,payable:_0x3ffc0c,due_amount:_0x1524da}=_0x1961f0[_0x2289ec(0x227)],_0x1daaad=await purchases[_0x2289ec(0x1f4)](_0x268223);var _0x1225b0=_0x3ffc0c-_0x1524da;_0x1daaad[_0x2289ec(0x1fb)]=parseFloat(_0x1daaad[_0x2289ec(0x1fb)])+parseFloat(_0x1524da),_0x1daaad[_0x2289ec(0x25d)]=_0x1225b0;const _0x474df7=await _0x1daaad[_0x2289ec(0x1cb)]();console['log'](_0x474df7);const _0x5d4a96=await s_payment_data[_0x2289ec(0x202)]({'invoice':_0x528de4});_0x5d4a96[_0x2289ec(0x28f)]=_0x1225b0,await _0x5d4a96[_0x2289ec(0x1cb)]();let _0x39f05e=new Date(),_0x17c0e4=('0'+_0x39f05e[_0x2289ec(0x21f)]())[_0x2289ec(0x25e)](-0x2),_0x141748=('0'+(_0x39f05e[_0x2289ec(0x295)]()+0x1))[_0x2289ec(0x25e)](-0x2),_0x863a81=_0x39f05e[_0x2289ec(0x1ec)](),_0x40fedf=_0x863a81+'-'+_0x141748+'-'+_0x17c0e4;const _0x2147b1=new suppliers_payment({'invoice':_0x528de4,'date':_0x863a81+'-'+_0x141748+'-'+_0x17c0e4,'suppliers':_0xdb07f6,'reason':_0x2289ec(0x28c),'amount':_0x1524da}),_0x49716a=await _0x2147b1[_0x2289ec(0x1cb)]();_0x1961f0[_0x2289ec(0x223)](_0x2289ec(0x257),_0x2289ec(0x29b)),_0x268cb0['redirect'](_0x2289ec(0x225));}catch(_0x534207){console[_0x2289ec(0x29e)](_0x534207);}}),router[a0_0x3caaed(0x218)](a0_0x3caaed(0x22c),auth,async(_0x19cf71,_0x576df3)=>{var _0x2d5ea2=a0_0x3caaed;try{const {username:_0x125cc2,email:_0x460ec4,role:_0xf0e39c}=_0x19cf71[_0x2d5ea2(0x260)],_0xee47f6=_0x19cf71['user'],_0x57eb4a=await profile[_0x2d5ea2(0x202)]({'email':_0xee47f6[_0x2d5ea2(0x1f2)]}),_0x2d3afe=await master_shop[_0x2d5ea2(0x1e9)]();console['log'](_0x2d5ea2(0x1ca),_0x2d3afe);const _0xb257c0=_0x19cf71[_0x2d5ea2(0x1d0)]['id'],_0x51d714=await purchases['findById'](_0xb257c0);console['log'](_0x51d714);const _0x8aec0f=await suppliers['findOne']({'name':_0x51d714[_0x2d5ea2(0x20e)]});console[_0x2d5ea2(0x29e)](_0x8aec0f);if(_0x2d3afe[0x0][_0x2d5ea2(0x23d)]==_0x2d5ea2(0x22f)){var _0x16c620=users['English'];console[_0x2d5ea2(0x29e)](_0x16c620);}else{if(_0x2d3afe[0x0]['language']==_0x2d5ea2(0x21c))var _0x16c620=users[_0x2d5ea2(0x21c)];else{if(_0x2d3afe[0x0][_0x2d5ea2(0x23d)]==_0x2d5ea2(0x2b5))var _0x16c620=users['German'];else{if(_0x2d3afe[0x0][_0x2d5ea2(0x23d)]=='Spanish')var _0x16c620=users[_0x2d5ea2(0x22a)];else{if(_0x2d3afe[0x0][_0x2d5ea2(0x23d)]=='French')var _0x16c620=users[_0x2d5ea2(0x236)];else{if(_0x2d3afe[0x0][_0x2d5ea2(0x23d)]==_0x2d5ea2(0x243))var _0x16c620=users[_0x2d5ea2(0x2a0)];else{if(_0x2d3afe[0x0][_0x2d5ea2(0x23d)]==_0x2d5ea2(0x2b0))var _0x16c620=users[_0x2d5ea2(0x2b0)];else{if(_0x2d3afe[0x0][_0x2d5ea2(0x23d)]=='Arabic\x20(ae)')var _0x16c620=users[_0x2d5ea2(0x277)];}}}}}}}_0x576df3['render'](_0x2d5ea2(0x2b2),{'success':_0x19cf71['flash']('success'),'errors':_0x19cf71['flash']('errors'),'role':_0xee47f6,'profile':_0x57eb4a,'master_shop':_0x2d3afe,'supplier':_0x8aec0f,'purchase':_0x51d714,'language':_0x16c620});}catch(_0x5b308e){console[_0x2d5ea2(0x29e)](_0x5b308e);}}),router[a0_0x3caaed(0x218)](a0_0x3caaed(0x1c5),auth,async(_0x3ce41a,_0x492e7e)=>{var _0x2f69e3=a0_0x3caaed;try{const {username:_0x42a828,email:_0xb53774,role:_0x222d7f}=_0x3ce41a[_0x2f69e3(0x260)],_0x5dc780=_0x3ce41a['user'],_0x56acb4=await profile['findOne']({'email':_0x5dc780[_0x2f69e3(0x1f2)]}),_0x1c79be=await master_shop['find']();console[_0x2f69e3(0x29e)]('master',_0x1c79be);const _0x266d20=_0x3ce41a[_0x2f69e3(0x1d0)]['id'];console[_0x2f69e3(0x29e)](_0x266d20);const _0x1c40b0=await purchases_finished['findById'](_0x266d20);console[_0x2f69e3(0x29e)](_0x2f69e3(0x259),_0x1c40b0);const _0x276cb8=await product[_0x2f69e3(0x1e9)]({}),_0x540e01=await warehouse['aggregate']([{'$match':{'name':_0x1c40b0['warehouse_name'],'room':_0x1c40b0[_0x2f69e3(0x1fe)]}},{'$unwind':_0x2f69e3(0x281)},{'$group':{'_id':_0x2f69e3(0x28e),'name':{'$first':_0x2f69e3(0x287)},'product_stock':{'$first':_0x2f69e3(0x2a3)},'bay':{'$first':_0x2f69e3(0x2a1)},'bin':{'$first':_0x2f69e3(0x205)},'type':{'$first':_0x2f69e3(0x246)},'floorlevel':{'$first':_0x2f69e3(0x21a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2f69e3(0x250)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2f69e3(0x2ae)},'rack':{'$first':'$product_details.rack'}}}]);console['log'](_0x2f69e3(0x26e),_0x540e01);let _0x2961bb;if(_0x5dc780['role']=='staff'){const _0xf32a11=await staff[_0x2f69e3(0x202)]({'email':_0x5dc780[_0x2f69e3(0x1f2)]});_0x2961bb=await warehouse['find']({'status':'Enabled','name':_0xf32a11[_0x2f69e3(0x279)],'warehouse_category':_0x2f69e3(0x201),'name':_0x2f69e3(0x1cd)});}else _0x2961bb=await warehouse['aggregate']([{'$match':{'status':_0x2f69e3(0x2b9),'warehouse_category':_0x2f69e3(0x201),'name':_0x2f69e3(0x1cd)}},{'$group':{'_id':_0x2f69e3(0x288),'name':{'$first':_0x2f69e3(0x288)}}}]);if(_0x1c79be[0x0]['language']=='English\x20(US)'){var _0x4f4c20=users[_0x2f69e3(0x210)];console['log'](_0x4f4c20);}else{if(_0x1c79be[0x0][_0x2f69e3(0x23d)]==_0x2f69e3(0x21c))var _0x4f4c20=users[_0x2f69e3(0x21c)];else{if(_0x1c79be[0x0][_0x2f69e3(0x23d)]==_0x2f69e3(0x2b5))var _0x4f4c20=users[_0x2f69e3(0x2b5)];else{if(_0x1c79be[0x0][_0x2f69e3(0x23d)]==_0x2f69e3(0x22a))var _0x4f4c20=users[_0x2f69e3(0x22a)];else{if(_0x1c79be[0x0][_0x2f69e3(0x23d)]==_0x2f69e3(0x236))var _0x4f4c20=users[_0x2f69e3(0x236)];else{if(_0x1c79be[0x0][_0x2f69e3(0x23d)]=='Portuguese\x20(BR)')var _0x4f4c20=users[_0x2f69e3(0x2a0)];else{if(_0x1c79be[0x0][_0x2f69e3(0x23d)]==_0x2f69e3(0x2b0))var _0x4f4c20=users[_0x2f69e3(0x2b0)];else{if(_0x1c79be[0x0][_0x2f69e3(0x23d)]==_0x2f69e3(0x211))var _0x4f4c20=users[_0x2f69e3(0x277)];}}}}}}}_0x492e7e['render'](_0x2f69e3(0x249),{'success':_0x3ce41a[_0x2f69e3(0x223)]('success'),'errors':_0x3ce41a[_0x2f69e3(0x223)]('errors'),'role':_0x5dc780,'profile':_0x56acb4,'user':_0x1c40b0,'stock':_0x540e01,'master_shop':_0x1c79be,'product':_0x276cb8,'language':_0x4f4c20,'warehouse':_0x2961bb});}catch(_0x12c679){console[_0x2f69e3(0x29e)](_0x12c679);}}),router[a0_0x3caaed(0x289)](a0_0x3caaed(0x1c5),auth,async(_0xfb37f0,_0x4e0907)=>{var _0x490195=a0_0x3caaed;try{const {invoice:_0x383738,date:_0x50d958,warehouse_name:_0x1b6284,Room_name:_0x3568bf,product_name:_0x51df4b,purchase_quantity:_0x4e86b0,stocks:_0x175e45,return_qty:_0x4881d9,note:_0x19e4b8,level:_0x4ee64b,isle:_0x30b8e0,pallet:_0xaed8fa,to_warehouse_name:_0x40cf69,to_Room_name:_0x4cb305}=_0xfb37f0['body'],_0x17de9b=await purchases_finished[_0x490195(0x202)]({'_id':_0xfb37f0[_0x490195(0x1d0)]['id']}),_0x1d7a41=await warehouse['findOne']({'name':_0x1b6284,'room':_0x3568bf,'warehouse_category':_0x490195(0x201)});if(typeof _0x51df4b==_0x490195(0x25f))var _0x57a5c5=[_0xfb37f0[_0x490195(0x227)][_0x490195(0x222)]],_0x2df2b5=[_0xfb37f0[_0x490195(0x227)]['purchase_quantity']],_0x2d61e8=[_0xfb37f0[_0x490195(0x227)][_0x490195(0x1d8)]],_0x2b85d9=[_0xfb37f0[_0x490195(0x227)][_0x490195(0x207)]],_0x1c117c=[_0xfb37f0[_0x490195(0x227)]['level']],_0x44bfe6=[_0xfb37f0[_0x490195(0x227)]['product_code_hide']],_0x266e92=[_0xfb37f0[_0x490195(0x227)][_0x490195(0x264)]],_0x52dfa8=[_0xfb37f0[_0x490195(0x227)][_0x490195(0x267)]];else var _0x57a5c5=[..._0xfb37f0[_0x490195(0x227)][_0x490195(0x222)]],_0x2df2b5=[..._0xfb37f0[_0x490195(0x227)][_0x490195(0x292)]],_0x2d61e8=[..._0xfb37f0[_0x490195(0x227)]['stocks']],_0x2b85d9=[..._0xfb37f0[_0x490195(0x227)][_0x490195(0x207)]],_0x1c117c=[..._0xfb37f0[_0x490195(0x227)]['level']],_0x44bfe6=[..._0xfb37f0[_0x490195(0x227)][_0x490195(0x1f9)]],_0x266e92=[..._0xfb37f0[_0x490195(0x227)]['primary_code_hide']],_0x52dfa8=[..._0xfb37f0[_0x490195(0x227)]['secondary_code_hide']];const _0x554ba7=_0x57a5c5[_0x490195(0x1e5)](_0x591a0d=>{return _0x591a0d={'product_name':_0x591a0d};});_0x2df2b5[_0x490195(0x263)]((_0x12e4f1,_0x36a2b2)=>{_0x554ba7[_0x36a2b2]['purchase_quantity']=_0x12e4f1;}),_0x2d61e8[_0x490195(0x263)]((_0x3faf98,_0x128f48)=>{var _0x3fb9d9=_0x490195;_0x554ba7[_0x128f48][_0x3fb9d9(0x266)]=_0x3faf98;}),_0x2b85d9['forEach']((_0x27994d,_0x3a4940)=>{_0x554ba7[_0x3a4940]['return_qty']=_0x27994d;}),_0x1c117c[_0x490195(0x263)]((_0x5249dc,_0x3edb24)=>{_0x554ba7[_0x3edb24]['bay']=_0x5249dc;}),_0x44bfe6['forEach']((_0x3101ac,_0x1aeede)=>{var _0x1181e5=_0x490195;_0x554ba7[_0x1aeede][_0x1181e5(0x2b3)]=_0x3101ac;}),_0x266e92[_0x490195(0x263)]((_0x47a7ee,_0x24aa52)=>{var _0x32fbcb=_0x490195;_0x554ba7[_0x24aa52][_0x32fbcb(0x1c9)]=_0x47a7ee;}),_0x52dfa8[_0x490195(0x263)]((_0x28bf12,_0x302e4c)=>{var _0x433464=_0x490195;_0x554ba7[_0x302e4c][_0x433464(0x21d)]=_0x28bf12;}),_0x554ba7[_0x490195(0x263)](_0x4c8138=>{var _0x3901fd=_0x490195;console[_0x3901fd(0x29e)](_0x4c8138);const _0x2e5a79=_0x1d7a41['product_details']['map'](_0x3c221b=>{var _0x1d032d=_0x3901fd;_0x3c221b[_0x1d032d(0x222)]==_0x4c8138['product_name']&&_0x3c221b['bay']==_0x4c8138[_0x1d032d(0x24e)]&&(console[_0x1d032d(0x29e)](parseInt(_0x3c221b[_0x1d032d(0x1ed)])+'\x20<>\x20'+parseInt(_0x4c8138[_0x1d032d(0x207)])),_0x3c221b['product_stock']=parseInt(_0x3c221b[_0x1d032d(0x1ed)])-parseInt(_0x4c8138[_0x1d032d(0x207)]));});}),await _0x1d7a41[_0x490195(0x1cb)]();var _0x5b8f1d=0x0;_0x554ba7['forEach'](_0x44265a=>{var _0x4b4bc2=_0x490195;(parseInt(_0x44265a['purchase_quantity'])<parseInt(_0x44265a[_0x4b4bc2(0x207)])||parseInt(_0x44265a['stock_quantity'])<parseInt(_0x44265a[_0x4b4bc2(0x207)]))&&_0x5b8f1d++;});if(_0x5b8f1d!=0x0)return _0xfb37f0['flash'](_0x490195(0x21b),_0x490195(0x1fd)),_0x4e0907[_0x490195(0x276)](_0x490195(0x21e));const _0x440cab=new purchases_return_finished({'invoice':_0x383738,'suppliers':_0xfb37f0[_0x490195(0x227)][_0x490195(0x20e)],'date':_0x50d958,'warehouse_name':_0x1b6284,'return_product':_0x554ba7,'note':_0x19e4b8,'room':_0x3568bf,'to_warehouse_name':_0x40cf69,'to_room':_0x4cb305}),_0x54b84e=await _0x440cab['save'](),_0x475288=await purchases_return_finished['findOne']({'invoice':_0x383738}),_0x273129=await warehouse[_0x490195(0x202)]({'name':_0x40cf69,'room':_0x4cb305,'warehouse_category':_0x490195(0x201)});_0x475288[_0x490195(0x242)]['forEach'](_0x5ecd0c=>{var _0xfd6fb6=_0x490195,_0x456718=0x0;const _0x17fe5d=_0x273129[_0xfd6fb6(0x1ee)]['map'](_0x2de591=>{var _0x5c4d73=_0xfd6fb6;console[_0x5c4d73(0x29e)](_0x2de591['product_name']+'=='+_0x5ecd0c[_0x5c4d73(0x222)]+'&&'+_0x2de591[_0x5c4d73(0x24e)]+'=='+_0x5ecd0c[_0x5c4d73(0x24e)]),_0x2de591[_0x5c4d73(0x222)]==_0x5ecd0c[_0x5c4d73(0x222)]&&_0x2de591[_0x5c4d73(0x24e)]==_0x5ecd0c[_0x5c4d73(0x24e)]&&(_0x2de591[_0x5c4d73(0x1ed)]=parseInt(_0x2de591[_0x5c4d73(0x1ed)])-parseInt(_0x5ecd0c['return_qty']),_0x456718++);});_0x456718=='0'&&(_0x273129[_0xfd6fb6(0x1ee)]=_0x273129[_0xfd6fb6(0x1ee)][_0xfd6fb6(0x293)]({'product_name':_0x5ecd0c[_0xfd6fb6(0x222)],'product_stock':_0x5ecd0c['return_qty'],'primary_code':_0x5ecd0c['primary_code'],'secondary_code':_0x5ecd0c[_0xfd6fb6(0x21d)],'product_code':_0x5ecd0c[_0xfd6fb6(0x2b3)],'bay':_0x5ecd0c[_0xfd6fb6(0x24e)],'maxProducts':0xf423f}));}),await _0x273129[_0x490195(0x1cb)]();const _0x9591b=await purchases_finished[_0x490195(0x202)]({'invoice':_0x383738});_0x9591b[_0x490195(0x221)]=_0x490195(0x1ef);const _0x30479c=await _0x9591b[_0x490195(0x1cb)](),_0x684efa=new s_payment_data({'invoice':_0x383738,'suppliers':_0xfb37f0[_0x490195(0x227)]['suppliers'],'reason':_0x490195(0x1c3)});await _0x684efa[_0x490195(0x1cb)]();const _0x501e7=await master_shop[_0x490195(0x1e9)](),_0x57113d=await email_settings[_0x490195(0x202)](),_0x55446e=await suppliers[_0x490195(0x202)]({'name':_0xfb37f0[_0x490195(0x227)][_0x490195(0x20e)]});_0x501e7[0x0][_0x490195(0x1e6)]==0x1?(right_currency=_0x501e7[0x0][_0x490195(0x298)],left_currency=''):(right_currency='',left_currency=_0x501e7[0x0]['currency']);var _0xa1d54a=_0x57a5c5,_0x6fdfb0=_0x2b85d9,_0x22fbf1='',_0x1193ab;for(_0x1193ab in _0xa1d54a){_0x22fbf1+=_0x490195(0x26d)+_0x490195(0x1c1)+_0xa1d54a[_0x1193ab]+_0x490195(0x22e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x6fdfb0[_0x1193ab]+_0x490195(0x22e)+_0x490195(0x1c6);}let _0x30e3a7=nodemailer['createTransport']({'service':_0x490195(0x275),'auth':{'user':_0x57113d[_0x490195(0x1f2)],'pass':_0x57113d['password']}}),_0x11ebf5={'from':_0x57113d['email'],'to':_0x55446e[_0x490195(0x1f2)],'subject':_0x490195(0x25c),'attachments':[{'filename':_0x490195(0x2a5),'path':__dirname+_0x490195(0x203)+_0x490195(0x1e4)+_0x501e7[0x0][_0x490195(0x261)],'cid':_0x490195(0x224)}],'html':_0x490195(0x254)+_0x490195(0x1d5)+_0x490195(0x284)+_0x490195(0x1de)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x490195(0x1de)+_0x490195(0x26a)+_0x490195(0x1d7)+'<div>'+'<h2>\x20'+_0x501e7[0x0][_0x490195(0x27a)]+_0x490195(0x2bb)+_0x490195(0x1d7)+_0x490195(0x1d7)+_0x490195(0x282)+_0x490195(0x1de)+_0x490195(0x29f)+_0x490195(0x1c2)+_0x383738+'\x20'+_0x490195(0x258)+_0x490195(0x22d)+_0x50d958+'\x20'+_0x490195(0x286)+_0x490195(0x270)+_0x490195(0x1d7)+_0x490195(0x245)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x490195(0x26f)+_0x490195(0x20a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x490195(0x206)+'</tr>'+'</thead>'+_0x490195(0x285)+'\x20'+_0x22fbf1+'\x20'+_0x490195(0x27e)+_0x490195(0x1dc)+_0x490195(0x1de)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x501e7[0x0][_0x490195(0x27a)]+_0x490195(0x270)+_0x490195(0x1d7)+_0x490195(0x1d7)+'</body></html>'};_0x30e3a7['sendMail'](_0x11ebf5,function(_0x554196,_0x1823da){var _0x5e9698=_0x490195;_0x554196?console[_0x5e9698(0x29e)](_0x5e9698(0x20f)):console['log'](_0x5e9698(0x294));}),_0xfb37f0[_0x490195(0x223)]('success',_0x490195(0x1f6)),_0x4e0907[_0x490195(0x276)]('/all_purchases_finished/view');}catch(_0x12e989){_0x4e0907[_0x490195(0x1d1)](0xc8)[_0x490195(0x1ea)]({'message':_0x12e989['message']});}}),router[a0_0x3caaed(0x218)](a0_0x3caaed(0x26c),auth,async(_0x12fdd6,_0x559744)=>{var _0x711798=a0_0x3caaed;try{const {username:_0x2e5bb2,email:_0x3bb696,role:_0x3f4667}=_0x12fdd6['user'],_0x5ad087=_0x12fdd6[_0x711798(0x260)],_0x2ec092=await profile[_0x711798(0x202)]({'email':_0x5ad087[_0x711798(0x1f2)]}),_0x1818fa=await master_shop['find'](),_0xdc11bc=_0x12fdd6['params']['id'],_0x526cda=await purchases_finished[_0x711798(0x1f4)](_0xdc11bc);if(_0x1818fa[0x0][_0x711798(0x23d)]=='English\x20(US)')var _0x270b3d=users[_0x711798(0x210)];else{if(_0x1818fa[0x0][_0x711798(0x23d)]==_0x711798(0x21c))var _0x270b3d=users[_0x711798(0x21c)];else{if(_0x1818fa[0x0][_0x711798(0x23d)]=='German')var _0x270b3d=users['German'];else{if(_0x1818fa[0x0][_0x711798(0x23d)]=='Spanish')var _0x270b3d=users[_0x711798(0x22a)];else{if(_0x1818fa[0x0][_0x711798(0x23d)]=='French')var _0x270b3d=users[_0x711798(0x236)];else{if(_0x1818fa[0x0][_0x711798(0x23d)]==_0x711798(0x243))var _0x270b3d=users['Portuguese'];else{if(_0x1818fa[0x0][_0x711798(0x23d)]=='Chinese')var _0x270b3d=users[_0x711798(0x2b0)];else{if(_0x1818fa[0x0][_0x711798(0x23d)]==_0x711798(0x211))var _0x270b3d=users[_0x711798(0x277)];}}}}}}}_0x559744[_0x711798(0x29d)](_0x711798(0x1d4),{'success':_0x12fdd6['flash'](_0x711798(0x257)),'errors':_0x12fdd6[_0x711798(0x223)](_0x711798(0x21b)),'role':_0x5ad087,'profile':_0x2ec092,'alldata':_0x526cda,'master_shop':_0x1818fa,'language':_0x270b3d}),console[_0x711798(0x29e)](alldata);}catch(_0x175b0e){console[_0x711798(0x29e)](_0x175b0e);}}),router[a0_0x3caaed(0x289)]('/barcode_scanner',async(_0x1d9d99,_0x4dcbe7)=>{var _0x1e84ba=a0_0x3caaed;const {product_code:_0x58f486}=_0x1d9d99[_0x1e84ba(0x227)];var _0x5073f9;const _0x18dd9a=await product[_0x1e84ba(0x1d9)]([{'$match':{'primary_code':_0x58f486,'product_category':_0x1e84ba(0x201)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x1e84ba(0x208)},'brand':{'$first':_0x1e84ba(0x1f8)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x1e84ba(0x241)},'primary_code':{'$first':_0x1e84ba(0x271)},'secondary_code':{'$first':_0x1e84ba(0x20d)},'maxStocks':{'$first':_0x1e84ba(0x1db)},'maxProdPerUnit':{'$first':_0x1e84ba(0x296)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3ee013=await product['aggregate']([{'$match':{'secondary_code':_0x58f486}},{'$group':{'_id':_0x1e84ba(0x217),'name':{'$first':_0x1e84ba(0x288)},'category':{'$first':_0x1e84ba(0x208)},'brand':{'$first':_0x1e84ba(0x1f8)},'unit':{'$first':_0x1e84ba(0x204)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x1e84ba(0x241)},'primary_code':{'$first':_0x1e84ba(0x271)},'secondary_code':{'$first':_0x1e84ba(0x20d)},'maxStocks':{'$first':_0x1e84ba(0x1db)},'maxProdPerUnit':{'$first':_0x1e84ba(0x296)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x18dd9a['length']>0x0)_0x5073f9=_0x18dd9a;else _0x3ee013[_0x1e84ba(0x2ad)]>0x0&&(_0x5073f9=_0x3ee013);_0x4dcbe7[_0x1e84ba(0x1ea)](_0x5073f9);}),router[a0_0x3caaed(0x289)](a0_0x3caaed(0x234),async(_0x17a29c,_0x6bbc2c)=>{var _0xba6b9b=a0_0x3caaed;const {productCode:_0x273432,bay:_0x4a8282,warehouses:_0x4037bb,room:_0x32dcb6}=_0x17a29c[_0xba6b9b(0x227)];console['log'](_0x17a29c['body']);try{const _0x5e9fd8=await warehouse[_0xba6b9b(0x1d9)]([{'$match':{'name':_0x4037bb,'room':_0x32dcb6}},{'$unwind':_0xba6b9b(0x281)},{'$match':{'product_details.bay':parseInt(_0x4a8282)}},{'$group':{'_id':_0xba6b9b(0x28e),'name':{'$first':_0xba6b9b(0x287)},'product_stock':{'$first':_0xba6b9b(0x2a3)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x6bbc2c['status'](0xc8)[_0xba6b9b(0x1ea)](_0x5e9fd8);}catch(_0x3c6b29){_0x6bbc2c['status'](0x194)[_0xba6b9b(0x1ea)]({'message':_0x3c6b29[_0xba6b9b(0x2b4)]});}}),module['exports']=router;