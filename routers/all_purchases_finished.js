var a0_0xacf369=a0_0x1325;function a0_0x2a95(){var _0x9be18c=['$product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','getFullYear','$primary_code','Purchase\x20Mail','site_title','$alertquantity','$_id','Purchase\x20Return','prod_name','status','MaxStocks_data','purchase\x20data\x20add\x20successfully','expiry_date','QA\x20Warehouse','4366818bJyMIg','<strong>\x20Regards\x20</strong>','/../public','getMonth','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</table>','$product.bin','/view/add_purchases/:id','$warehouse_name','params','$product_details.product_name','$room','max_product_unit','sendMail','warehouse','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</h5>','currency_placement','flash','23436ZEfFAB','$return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','image','updateOne','36170WopUNQ','$product_details.primary_code','stock_quantity','path','/all_purchases_finished/view','Arabic','$name','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','_id','../middleware/auth','catch','<h2>\x20','stocks','$product_details','$batch_code','secondary_code_hide','$secondary_unit','$product_details.product_stock','/view/:id','product_code','prod_secondunit','English','\x20</h2>','/upload/','Paid\x20For\x20Purchase','message','filter','return_data','</td>','1343528mITdvF','edit_purchases_finished','room','$unit','prod_primunit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','render','post','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','warehouse_name','$product_details.bay','92VuSVCY','Enabled','findOne','getDate','primary_code_hide','date','Rack\x202','then','</tbody>','errors','purchase\x20data\x20update\x20successfully','table\x20page','json','master','$note','product_code_hide','$category','$product_details.floorlevel','prod_level','gmail','purchases\x20item\x20return\x20successfull','product_date','$maxStocks','slice','RoomAssign','password','ejs','DRY\x20GOODS','concat','paid_amount','<span\x20style=\x22float:\x20right;\x22>','<tr>','redirect','$product.quantity','$maxProdPerUnit','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','body','prod_code','maxperunit','maxStocks','product_cat','<div>','</body></html>','../models/all_models','$product','production_date','$product_details._id','product_name','$invoice','success','/view/return_purchase/:id','toString','currency','/view/add_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Arabic\x20(ae)','Hindi','INCF-','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.bin','Enclosed','prod_invoice','$product.type','Spanish','<!DOCTYPE\x20html>','createTransport','Ambient','POnumber','$brand','Chinese','/barcode_scanner','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_cat','$product.floorlevel','/give_payment/:id','758AqgVNM','$secondary_code','<html><head><title></title>','staff','\x20Order\x20Date\x20:\x20','An\x20error\x20occurred.','note','save','Purchase\x20Return\x20Mail','email','log','payment\x20successfull','Portuguese\x20(BR)','$paid_amount','all','$product_details.secondary_code','primary_code','secondary_code','random','add_purchases\x20error','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','find','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$expiry_date','<hr\x20class=\x22my-3\x22>','return_qty','all_purchases_finished','$date','language','add_purchases_finished','edit_purchases_finished_view','/CheckingWarehouse','1494Fbxrdf','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Return\x20Goods','level','abs','\x20Order\x20Number\x20:\x20','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','\x20<>\x20','purchase_quantity','length','floor','get','string','English\x20(US)','name','$product_details.product_code','purchase_invoice','back','</tr>','secondary_unit','product','Error\x20Occurs','</head><body>','aggregate','<h5>','FROZEN\x20GOODS','French','prod_Qty','Room_name','prod_qty','Portuguese','$suppliers_docs','suppliers','/all_purchases/view','room_name','bay','all_purchases_barcode','batch_code','$product_details.storage','product_stock','invoice','prod_unit','padStart','user','forEach','express','120120kYDfxU','standard_unit','German','error','</span>','findById','port','quantity','stock_data','1159890lNWFWS','../public/language/languages.json','/view','$suppliers','due_amount','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</div>','$product_details.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Logo.png','role','$product.room_name'];a0_0x2a95=function(){return _0x9be18c;};return a0_0x2a95();}function a0_0x1325(_0x12e285,_0x5598f9){var _0x2a9531=a0_0x2a95();return a0_0x1325=function(_0x132584,_0x5cfddf){_0x132584=_0x132584-0x87;var _0x307a08=_0x2a9531[_0x132584];return _0x307a08;},a0_0x1325(_0x12e285,_0x5598f9);}(function(_0x1d4708,_0x33b6ff){var _0x14e999=a0_0x1325,_0x305763=_0x1d4708();while(!![]){try{var _0x310d76=-parseInt(_0x14e999(0x129))/0x1+parseInt(_0x14e999(0xa0))/0x2*(parseInt(_0x14e999(0xc1))/0x3)+-parseInt(_0x14e999(0x157))/0x4*(parseInt(_0x14e999(0x12e))/0x5)+-parseInt(_0x14e999(0xfa))/0x6+-parseInt(_0x14e999(0xf1))/0x7+-parseInt(_0x14e999(0x14b))/0x8+parseInt(_0x14e999(0x115))/0x9;if(_0x310d76===_0x33b6ff)break;else _0x305763['push'](_0x305763['shift']());}catch(_0x3da207){_0x305763['push'](_0x305763['shift']());}}}(a0_0x2a95,0x19cee));const express=require(a0_0xacf369(0xf0)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0xacf369(0x182)),auth=require(a0_0xacf369(0x137)),nodemailer=require('nodemailer');var ejs=require(a0_0xacf369(0x171));const path=require(a0_0xacf369(0x131)),users=require(a0_0xacf369(0xfb));router['get'](a0_0xacf369(0xfc),auth,async(_0xd1b0d1,_0x3933a5)=>{var _0x2dadc1=a0_0xacf369;try{const {username:_0xf63a6b,email:_0xfc7855,role:_0x381779}=_0xd1b0d1['user'],_0x590c38=_0xd1b0d1[_0x2dadc1(0xee)],_0x1c10f7=await profile[_0x2dadc1(0x159)]({'email':_0x590c38[_0x2dadc1(0xa9)]}),_0x402585=await staff[_0x2dadc1(0x159)]({'email':_0x590c38[_0x2dadc1(0xa9)]});if(_0x590c38[_0x2dadc1(0x104)]=='staff'){const _0x1890c9=await staff['findOne']({'email':_0x590c38[_0x2dadc1(0xa9)]});}const _0x192eef=await master_shop['find']();let _0x3322f0;if(_0x590c38[_0x2dadc1(0x104)]==_0x2dadc1(0xa3)){const _0x2b4e06=await staff[_0x2dadc1(0x159)]({'email':_0x590c38[_0x2dadc1(0xa9)]});_0x3322f0=await purchases_finished[_0x2dadc1(0xda)]([{'$match':{'warehouse_name':_0x2b4e06[_0x2dadc1(0x124)]}},{'$lookup':{'from':'suppliers','localField':_0x2dadc1(0xe3),'foreignField':_0x2dadc1(0xd1),'as':'suppliers_docs'}},{'$unwind':_0x2dadc1(0xe2)},{'$unwind':_0x2dadc1(0x183)},{'$group':{'_id':_0x2dadc1(0x10d),'invoice':{'$first':_0x2dadc1(0x187)},'suppliers':{'$first':_0x2dadc1(0xfd)},'date':{'$first':_0x2dadc1(0xbc)},'warehouse_name':{'$first':_0x2dadc1(0x11e)},'room':{'$first':_0x2dadc1(0x121)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2dadc1(0xad)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x2dadc1(0x12a)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2dadc1(0xb8)},'suppliers_docs':{'$first':_0x2dadc1(0xe2)},'total_product_quantity':{'$sum':_0x2dadc1(0x178)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x2dadc1(0x11c)},'type':{'$addToSet':_0x2dadc1(0x93)},'floorlevel':{'$addToSet':_0x2dadc1(0x9e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3322f0=await purchases_finished[_0x2dadc1(0xda)]([{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x2dadc1(0xfd)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x2dadc1(0x105)},'product':{'$push':_0x2dadc1(0x183)},'note':{'$first':_0x2dadc1(0x165)},'paid_amount':{'$first':_0x2dadc1(0xad)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x2dadc1(0x12a)},'batch_code':{'$first':_0x2dadc1(0x13c)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2dadc1(0xe2)},'total_product_quantity':{'$sum':_0x2dadc1(0x178)},'level':{'$addToSet':_0x2dadc1(0x106)},'isle':{'$addToSet':_0x2dadc1(0x11c)},'type':{'$addToSet':_0x2dadc1(0x93)},'floorlevel':{'$addToSet':_0x2dadc1(0x9e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x192eef[0x0][_0x2dadc1(0xbd)]==_0x2dadc1(0xd0))var _0x540f66=users[_0x2dadc1(0x143)];else{if(_0x192eef[0x0]['language']=='Hindi')var _0x540f66=users[_0x2dadc1(0x8d)];else{if(_0x192eef[0x0][_0x2dadc1(0xbd)]==_0x2dadc1(0xf3))var _0x540f66=users[_0x2dadc1(0xf3)];else{if(_0x192eef[0x0][_0x2dadc1(0xbd)]==_0x2dadc1(0x94))var _0x540f66=users[_0x2dadc1(0x94)];else{if(_0x192eef[0x0][_0x2dadc1(0xbd)]==_0x2dadc1(0xdd))var _0x540f66=users[_0x2dadc1(0xdd)];else{if(_0x192eef[0x0][_0x2dadc1(0xbd)]==_0x2dadc1(0xac))var _0x540f66=users['Portuguese'];else{if(_0x192eef[0x0][_0x2dadc1(0xbd)]==_0x2dadc1(0x9a))var _0x540f66=users['Chinese'];else{if(_0x192eef[0x0]['language']==_0x2dadc1(0x8c))var _0x540f66=users[_0x2dadc1(0x133)];}}}}}}}_0x3933a5['render'](_0x2dadc1(0xbb),{'success':_0xd1b0d1[_0x2dadc1(0x128)](_0x2dadc1(0x188)),'errors':_0xd1b0d1[_0x2dadc1(0x128)](_0x2dadc1(0x160)),'purchases':_0x3322f0,'role':_0x590c38,'profile':_0x1c10f7,'master_shop':_0x192eef,'language':_0x540f66});}catch(_0x346010){console[_0x2dadc1(0xaa)](_0x2dadc1(0x162),_0x346010),_0x3933a5[_0x2dadc1(0x110)](0xc8)[_0x2dadc1(0x163)]({'message':_0x346010[_0x2dadc1(0x147)]});}});function BayBinSelected(_0x57efab,_0x3cbc3f){var _0x35f70d=a0_0xacf369,_0x6337cf=[],_0x3f302b=[];if(_0x57efab==_0x35f70d(0x172)){switch(_0x3cbc3f){case'Rack\x201':_0x6337cf=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x35f70d(0x15d):_0x6337cf=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3f302b=['DG'];}else{if(_0x57efab==_0x35f70d(0xdc)){switch(_0x3cbc3f){case'Rack\x201':_0x6337cf=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x6337cf=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3f302b=['FG'];}}return{'levels':_0x6337cf,'identify':_0x3f302b};}async function getRandom8DigitNumber(){var _0x1cc446=a0_0xacf369;const _0x51225b=0x989680,_0x12d030=0x5f5e0ff,_0x396e14=Math[_0x1cc446(0xcd)](Math[_0x1cc446(0xb2)]()*(_0x12d030-_0x51225b+0x1))+_0x51225b;var _0x3ecaa8;const _0x4fe4a3=await purchases_finished[_0x1cc446(0x159)]({'invoice':_0x1cc446(0x8e)+_0x396e14});return _0x4fe4a3&&_0x4fe4a3[_0x1cc446(0xcc)]>0x0?_0x3ecaa8=_0x1cc446(0x8e)+_0x396e14:_0x3ecaa8='INCF-'+_0x396e14,_0x3ecaa8;}router['get'](a0_0xacf369(0x8a),auth,async(_0x1dbcb0,_0x51ace7)=>{var _0x21ed48=a0_0xacf369;try{const {username:_0x135714,email:_0x2d9aef,role:_0x1a7540}=_0x1dbcb0['user'],_0x4edb3c=_0x1dbcb0[_0x21ed48(0xee)],_0x58e313=await profile['findOne']({'email':_0x4edb3c[_0x21ed48(0xa9)]}),_0x114a62=await master_shop[_0x21ed48(0xb6)](),_0x1dc1ef=await staff['findOne']({'email':_0x4edb3c[_0x21ed48(0xa9)]}),_0x2eedf1=await suppliers[_0x21ed48(0xb6)]({});let _0x1e87c3;if(_0x4edb3c['role']=='staff'){const _0x353d2d=await staff[_0x21ed48(0x159)]({'email':_0x4edb3c['email']});_0x1e87c3=await warehouse[_0x21ed48(0xda)]([{'$match':{'status':_0x21ed48(0x158),'name':_0x353d2d[_0x21ed48(0x124)],'warehouse_category':_0x21ed48(0xb4)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x1e87c3=await warehouse[_0x21ed48(0xda)]([{'$match':{'status':_0x21ed48(0x158),'warehouse_category':_0x21ed48(0xb4),'name':{'$ne':_0x21ed48(0x114)}}},{'$group':{'_id':'$name','name':{'$first':_0x21ed48(0x134)}}}]);const _0x236688=await product['find']({}),_0x533f10=await warehouse[_0x21ed48(0xb6)]({'status':_0x21ed48(0x158)}),_0x1693ab=await purchases_finished[_0x21ed48(0xb6)]({}),_0x2c8b7c=_0x1693ab[_0x21ed48(0xcc)]+0x1,_0x23a9b4=_0x21ed48(0x8e)+_0x2c8b7c[_0x21ed48(0x88)]()[_0x21ed48(0xed)](0x5,'0');var _0x3372d6=[_0x21ed48(0x97),_0x21ed48(0x91)];if(_0x114a62[0x0][_0x21ed48(0xbd)]=='English\x20(US)')var _0x1fa653=users[_0x21ed48(0x143)];else{if(_0x114a62[0x0][_0x21ed48(0xbd)]==_0x21ed48(0x8d))var _0x1fa653=users['Hindi'];else{if(_0x114a62[0x0]['language']==_0x21ed48(0xf3))var _0x1fa653=users[_0x21ed48(0xf3)];else{if(_0x114a62[0x0]['language']=='Spanish')var _0x1fa653=users['Spanish'];else{if(_0x114a62[0x0][_0x21ed48(0xbd)]==_0x21ed48(0xdd))var _0x1fa653=users['French'];else{if(_0x114a62[0x0][_0x21ed48(0xbd)]==_0x21ed48(0xac))var _0x1fa653=users['Portuguese'];else{if(_0x114a62[0x0][_0x21ed48(0xbd)]==_0x21ed48(0x9a))var _0x1fa653=users[_0x21ed48(0x9a)];else{if(_0x114a62[0x0][_0x21ed48(0xbd)]==_0x21ed48(0x8c))var _0x1fa653=users[_0x21ed48(0x133)];}}}}}}}const _0x18319d=getRandom8DigitNumber();_0x18319d[_0x21ed48(0x15e)](_0x550903=>{var _0x165253=_0x21ed48;_0x51ace7[_0x165253(0x151)](_0x165253(0xbe),{'success':_0x1dbcb0[_0x165253(0x128)](_0x165253(0x188)),'errors':_0x1dbcb0['flash'](_0x165253(0x160)),'role':_0x4edb3c,'profile':_0x58e313,'suppliers':_0x2eedf1,'warehouse':_0x1e87c3,'product':_0x236688,'invoice':_0x550903,'master_shop':_0x114a62,'language':_0x1fa653,'find_data':_0x533f10,'rooms_data':_0x3372d6});})[_0x21ed48(0x138)](_0x1bb738=>{var _0x4eb434=_0x21ed48;_0x1dbcb0[_0x4eb434(0x128)](_0x4eb434(0x160),_0x4eb434(0x125)),_0x51ace7[_0x4eb434(0x177)](_0x4eb434(0x132));});}catch(_0x38e719){console[_0x21ed48(0xaa)](_0x38e719);}}),router['get'](a0_0xacf369(0x11d),auth,async(_0x19adb9,_0xc2e16b)=>{var _0x4eac99=a0_0xacf369;try{const _0x41bed7=_0x19adb9['params']['id'];console[_0x4eac99(0xaa)](_0x41bed7);const _0x45d584=await master_shop['find']();console[_0x4eac99(0xaa)]('master',_0x45d584);const _0x1d1b97=await product[_0x4eac99(0x159)]({'name':_0x41bed7});console[_0x4eac99(0xaa)](_0x4eac99(0xd7),_0x1d1b97),_0xc2e16b[_0x4eac99(0x110)](0xc8)[_0x4eac99(0x163)]({'product_data':_0x1d1b97,'master':_0x45d584});}catch(_0x1ccd09){console[_0x4eac99(0xaa)](_0x4eac99(0xb3),_0x1ccd09);}}),router[a0_0xacf369(0x152)](a0_0xacf369(0x8a),auth,async(_0x4ac4bf,_0xa1a996)=>{var _0x4deae5=a0_0xacf369;try{const {invoice:_0x39ef6d,date:_0x4910d2,warehouse_name:_0x1d8a2c,prod_name:_0x1941f6,prod_code:_0x5d2ce3,prod_qty:_0x3c31b8,prod_unit:_0x4f550b,prod_secondunit:_0x896cd9,prod_level:_0x20e271,prod_isle:_0x1fd6a9,prod_pallet:_0x25e533,note:_0x2afd5e,expiry_date:_0x1d2e34,batch_code:_0x3791dd,payable:_0x7c7ab1,due_amount:_0x2f8a16,Room_name:_0x701b28,primary_code:_0x958b70,secondary_code:_0x54de69,MaxStocks_data:_0xceec31,PO_number:_0x22b825,SCRN:_0x559a4c,JO_number:_0x235448}=_0x4ac4bf[_0x4deae5(0x17b)];if(typeof _0x1941f6==_0x4deae5(0xcf))var _0x58a437=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x10f)]],_0xe60099=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x17c)]],_0x1ab554=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0xde)]],_0x49b4a2=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x14f)]],_0xb4d651=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x142)]],_0x20ca67=[_0x4ac4bf['body'][_0x4deae5(0x169)]],_0x155dd7=[_0x4ac4bf[_0x4deae5(0x17b)]['primary_code']],_0x30af7d=[_0x4ac4bf[_0x4deae5(0x17b)]['secondary_code']],_0xa99e70=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x111)]],_0x112a90=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0xe8)]],_0x114b1c=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x113)]],_0x5cdbbf=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x16c)]],_0x4c4a47=[_0x4ac4bf['body'][_0x4deae5(0x122)]],_0x3d615f=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x9d)]],_0x23fe6c=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x16f)]],_0x40db81=[_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x92)]];else var _0x58a437=[..._0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x10f)]],_0xe60099=[..._0x4ac4bf['body'][_0x4deae5(0x17c)]],_0x1ab554=[..._0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0xde)]],_0x49b4a2=[..._0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x14f)]],_0xb4d651=[..._0x4ac4bf[_0x4deae5(0x17b)]['prod_secondunit']],_0x20ca67=[..._0x4ac4bf['body']['prod_level']],_0x155dd7=[..._0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0xb0)]],_0x30af7d=[..._0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0xb1)]],_0xa99e70=[..._0x4ac4bf[_0x4deae5(0x17b)]['MaxStocks_data']],_0x112a90=[..._0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0xe8)]],_0x114b1c=[..._0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x113)]],_0x5cdbbf=[..._0x4ac4bf['body'][_0x4deae5(0x16c)]],_0x4c4a47=[..._0x4ac4bf['body']['max_product_unit']],_0x3d615f=[..._0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x9d)]],_0x23fe6c=[..._0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0x16f)]],_0x40db81=[..._0x4ac4bf['body']['prod_invoice']];const _0x440cfc=_0x58a437[_0x4deae5(0x153)](_0x321693=>{return _0x321693={'product_name':_0x321693};});_0xe60099[_0x4deae5(0xef)]((_0xc5bb4d,_0xac5221)=>{var _0x536e9f=_0x4deae5;_0x440cfc[_0xac5221][_0x536e9f(0x141)]=_0xc5bb4d;}),_0x1ab554[_0x4deae5(0xef)]((_0x37bcc2,_0x3f77bb)=>{var _0x82ee81=_0x4deae5;_0x440cfc[_0x3f77bb]['quantity']=Math[_0x82ee81(0xc6)](_0x37bcc2);}),_0x49b4a2[_0x4deae5(0xef)]((_0x376990,_0x19a8a2)=>{var _0x28b790=_0x4deae5;_0x440cfc[_0x19a8a2][_0x28b790(0xf2)]=_0x376990;}),_0xb4d651[_0x4deae5(0xef)]((_0x45621f,_0x283944)=>{var _0x5adca4=_0x4deae5;_0x440cfc[_0x283944][_0x5adca4(0xd6)]=_0x45621f;}),_0x20ca67[_0x4deae5(0xef)]((_0x151906,_0x2faf57)=>{var _0x195c87=_0x4deae5;_0x440cfc[_0x2faf57][_0x195c87(0xe6)]=_0x151906;}),_0x155dd7[_0x4deae5(0xef)]((_0x41fee5,_0x3d8327)=>{var _0x53f168=_0x4deae5;_0x440cfc[_0x3d8327][_0x53f168(0xb0)]=_0x41fee5;}),_0x30af7d[_0x4deae5(0xef)]((_0x8d206a,_0x55989a)=>{var _0x50e0f0=_0x4deae5;_0x440cfc[_0x55989a][_0x50e0f0(0xb1)]=_0x8d206a;}),_0xa99e70[_0x4deae5(0xef)]((_0x51e040,_0xf8f11e)=>{var _0x4bb54a=_0x4deae5;_0x440cfc[_0xf8f11e][_0x4bb54a(0x17e)]=_0x51e040;}),_0x112a90[_0x4deae5(0xef)]((_0x552339,_0x5c468a)=>{var _0x3fef6a=_0x4deae5;_0x440cfc[_0x5c468a][_0x3fef6a(0xe8)]=_0x552339;}),_0x114b1c[_0x4deae5(0xef)]((_0x2996e0,_0x25f919)=>{var _0x40e555=_0x4deae5;_0x440cfc[_0x25f919][_0x40e555(0x113)]=_0x2996e0;}),_0x5cdbbf[_0x4deae5(0xef)]((_0xc6bbf8,_0x4ca991)=>{var _0x390948=_0x4deae5;_0x440cfc[_0x4ca991][_0x390948(0x184)]=_0xc6bbf8;}),_0x4c4a47[_0x4deae5(0xef)]((_0x11ae3c,_0x475cd8)=>{var _0x5d5142=_0x4deae5;_0x440cfc[_0x475cd8][_0x5d5142(0x17d)]=_0x11ae3c;}),_0x3d615f[_0x4deae5(0xef)]((_0x2d7304,_0x4d0104)=>{var _0x401193=_0x4deae5;_0x440cfc[_0x4d0104][_0x401193(0x17f)]=_0x2d7304;}),_0x23fe6c[_0x4deae5(0xef)]((_0x38dc52,_0x19bf60)=>{var _0x1cc4da=_0x4deae5;_0x440cfc[_0x19bf60][_0x1cc4da(0xe5)]=_0x38dc52;}),_0x40db81[_0x4deae5(0xef)]((_0x5804da,_0x889ae4)=>{var _0x5a7188=_0x4deae5;_0x440cfc[_0x889ae4][_0x5a7188(0xeb)]=_0x5804da;});const _0x1ce137=_0x440cfc[_0x4deae5(0x148)](_0x581261=>_0x581261[_0x4deae5(0xf8)]!=='0'&&_0x581261[_0x4deae5(0xf8)]!==''),_0x240419=new purchases_finished({'invoice':_0x39ef6d,'suppliers':_0x4ac4bf[_0x4deae5(0x17b)][_0x4deae5(0xe3)],'date':_0x4910d2,'warehouse_name':_0x1d8a2c,'product':_0x1ce137,'note':_0x2afd5e,'due_amount':_0x2f8a16,'room':_0x701b28,'POnumber':_0x22b825,'SCRN':_0x559a4c,'JO_number':_0x235448}),_0x214407=await _0x240419[_0x4deae5(0xa7)](),_0x2f0ffe=await purchases_finished[_0x4deae5(0x159)]({'invoice':_0x39ef6d}),_0x7324c3=_0x2f0ffe[_0x4deae5(0xd7)][_0x4deae5(0x153)](async _0x22ad86=>{var _0x25155f=_0x4deae5,_0x415ff0=await warehouse[_0x25155f(0x159)]({'name':_0x1d8a2c,'room':_0x22ad86[_0x25155f(0xe5)]}),_0x3a2634=0x0;const _0x5bba12=_0x415ff0['product_details'][_0x25155f(0x153)](_0x513181=>{var _0x2cc4de=_0x25155f;console[_0x2cc4de(0xaa)](_0x513181[_0x2cc4de(0x186)]+'=='+_0x22ad86[_0x2cc4de(0x186)]+'&&'+_0x513181[_0x2cc4de(0xe6)]+'=='+_0x22ad86[_0x2cc4de(0xe6)]+'&&'+_0x513181[_0x2cc4de(0x113)]+'=='+_0x22ad86['expiry_date']+'&&'+_0x513181[_0x2cc4de(0x184)]+'=='+_0x22ad86[_0x2cc4de(0x184)]+'&&'+_0x513181[_0x2cc4de(0xe8)]+'=='+_0x22ad86[_0x2cc4de(0xe8)]+'&&'+_0x513181[_0x2cc4de(0xeb)]+'=='+_0x2f0ffe[_0x2cc4de(0xeb)]),_0x513181[_0x2cc4de(0x186)]==_0x22ad86[_0x2cc4de(0x186)]&&_0x513181['bay']==_0x22ad86[_0x2cc4de(0xe6)]&&_0x513181[_0x2cc4de(0x113)]==_0x22ad86['expiry_date']&&_0x513181['production_date']==_0x22ad86[_0x2cc4de(0x184)]&&_0x513181[_0x2cc4de(0xe8)]==_0x22ad86['batch_code']&&_0x513181['invoice']==_0x2f0ffe['invoice']&&(_0x513181['product_stock']=Math[_0x2cc4de(0xc6)](_0x513181['product_stock'])+Math[_0x2cc4de(0xc6)](_0x22ad86[_0x2cc4de(0xf8)]),_0x3a2634++);});return _0x3a2634=='0'&&(_0x415ff0[_0x25155f(0xc2)]=_0x415ff0['product_details'][_0x25155f(0x173)]({'product_name':_0x22ad86[_0x25155f(0x186)],'product_stock':Math['abs'](_0x22ad86['quantity']),'primary_code':_0x22ad86[_0x25155f(0xb0)],'secondary_code':_0x22ad86[_0x25155f(0xb1)],'product_code':_0x22ad86[_0x25155f(0x141)],'bay':_0x22ad86[_0x25155f(0xe6)],'maxProducts':_0x22ad86[_0x25155f(0x17e)],'unit':_0x22ad86[_0x25155f(0xf2)],'secondary_unit':_0x22ad86['secondary_unit'],'expiry_date':_0x22ad86[_0x25155f(0x113)],'production_date':_0x22ad86['production_date'],'maxProducts':_0x22ad86[_0x25155f(0x17e)],'maxPerUnit':_0x22ad86[_0x25155f(0x17d)],'batch_code':_0x22ad86['batch_code'],'product_cat':_0x22ad86['product_cat'],'invoice':_0x22ad86[_0x25155f(0xeb)]})),_0x415ff0;});Promise[_0x4deae5(0xae)](_0x7324c3)[_0x4deae5(0x15e)](async _0x4314e3=>{var _0x4d41c4=_0x4deae5;try{for(const _0x553d70 of _0x4314e3){await warehouse[_0x4d41c4(0x12d)]({'_id':_0x553d70[_0x4d41c4(0x136)]},{'$addToSet':{'product_details':{'$each':_0x553d70[_0x4d41c4(0xc2)]}}});}const _0x48ef01=await master_shop[_0x4d41c4(0xb6)](),_0x2f1861=await email_settings[_0x4d41c4(0x159)](),_0x1b3ea9=await supervisor_settings[_0x4d41c4(0xb6)]();var _0x57e654=_0x2f0ffe[_0x4d41c4(0xd7)],_0x32e4bb='',_0x3d8de3;for(_0x3d8de3 in _0x57e654){var _0x57e4f6='FG';_0x2f0ffe[_0x4d41c4(0x155)]==_0x4d41c4(0x172)&&(_0x57e4f6='DG'),_0x32e4bb+=_0x4d41c4(0x176)+_0x4d41c4(0x8f)+_0x57e654[_0x3d8de3][_0x4d41c4(0x186)]+_0x4d41c4(0x14a)+_0x4d41c4(0x8f)+_0x57e654[_0x3d8de3]['product_code']+_0x4d41c4(0x14a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57e654[_0x3d8de3]['quantity']+_0x4d41c4(0x14a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57e654[_0x3d8de3][_0x4d41c4(0xf2)]+_0x4d41c4(0x14a)+_0x4d41c4(0x8f)+_0x57e654[_0x3d8de3][_0x4d41c4(0xd6)]+_0x4d41c4(0x14a)+_0x4d41c4(0x8f)+_0x2f0ffe['warehouse_name']+'</td>'+_0x4d41c4(0x8f)+_0x57e654[_0x3d8de3][_0x4d41c4(0xe5)]+_0x4d41c4(0x14a)+_0x4d41c4(0x8f)+_0x57e4f6+_0x57e654[_0x3d8de3]['bay']+_0x4d41c4(0x14a),_0x4d41c4(0xd5);}let _0x41db3=nodemailer[_0x4d41c4(0x96)]({'host':_0x2f1861['host'],'port':Number(_0x2f1861[_0x4d41c4(0xf7)]),'secure':![],'auth':{'user':_0x2f1861[_0x4d41c4(0xa9)],'pass':_0x2f1861[_0x4d41c4(0x170)]}}),_0x503000={'from':_0x2f1861['email'],'to':_0x1b3ea9[0x0]['FGSEmail'],'subject':_0x4d41c4(0x10a),'attachments':[{'filename':_0x4d41c4(0x103),'path':__dirname+_0x4d41c4(0x117)+_0x4d41c4(0x145)+_0x48ef01[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x4d41c4(0xa2)+_0x4d41c4(0xd9)+_0x4d41c4(0x180)+_0x4d41c4(0x17a)+_0x4d41c4(0x180)+_0x4d41c4(0x135)+_0x4d41c4(0x100)+_0x4d41c4(0x180)+_0x4d41c4(0x139)+_0x48ef01[0x0][_0x4d41c4(0x10b)]+_0x4d41c4(0x144)+_0x4d41c4(0x100)+_0x4d41c4(0x100)+_0x4d41c4(0xb9)+_0x4d41c4(0x180)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4d41c4(0xc7)+_0x2f0ffe[_0x4d41c4(0xeb)]+'\x20'+_0x4d41c4(0x175)+_0x4d41c4(0xa4)+_0x2f0ffe[_0x4d41c4(0x15c)]+'\x20'+_0x4d41c4(0xf5)+'</h5>'+_0x4d41c4(0x100)+_0x4d41c4(0x150)+_0x4d41c4(0xff)+_0x4d41c4(0x176)+_0x4d41c4(0x11a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x4d41c4(0xc3)+_0x4d41c4(0x102)+_0x4d41c4(0x12b)+_0x4d41c4(0x154)+_0x4d41c4(0xc9)+_0x4d41c4(0x107)+'</tr>'+'</thead>'+_0x4d41c4(0x9c)+'\x20'+_0x32e4bb+'\x20'+_0x4d41c4(0x15f)+_0x4d41c4(0x11b)+_0x4d41c4(0x180)+'<strong>\x20Regards\x20</strong>'+_0x4d41c4(0xdb)+_0x48ef01[0x0][_0x4d41c4(0x10b)]+_0x4d41c4(0x126)+_0x4d41c4(0x100)+_0x4d41c4(0x100)+_0x4d41c4(0x181)};_0x41db3['sendMail'](_0x503000,function(_0x268c50,_0x195603){var _0x17cc00=_0x4d41c4;_0x268c50?(console['log'](_0x268c50),console['log'](_0x17cc00(0xd8))):console[_0x17cc00(0xaa)]('Email\x20sent\x20successfully');});}catch(_0x17c37c){console[_0x4d41c4(0xf4)](_0x17c37c),_0xa1a996[_0x4d41c4(0x110)](0x1f4)[_0x4d41c4(0x163)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x17c37c[_0x4d41c4(0x147)]});}})[_0x4deae5(0x138)](_0x1ea62d=>{var _0x10076b=_0x4deae5;console[_0x10076b(0xf4)](_0x1ea62d),_0xa1a996['status'](0x1f4)[_0x10076b(0x163)]({'error':_0x10076b(0xa5)});}),_0x4ac4bf[_0x4deae5(0x128)](_0x4deae5(0x188),_0x4deae5(0x112)),_0xa1a996[_0x4deae5(0x177)](_0x4deae5(0x132));}catch(_0x4402ec){console['log'](_0x4402ec);}}),router[a0_0xacf369(0xce)]('/preview/:id',auth,async(_0x5308c4,_0x3561b8)=>{var _0x506e3c=a0_0xacf369;try{const {username:_0xaeff5c,email:_0x29e9f4,role:_0x5e03a8}=_0x5308c4[_0x506e3c(0xee)],_0xac55a=_0x5308c4[_0x506e3c(0xee)],_0x5e7b07=await profile[_0x506e3c(0x159)]({'email':_0xac55a[_0x506e3c(0xa9)]}),_0x56a27c=await master_shop[_0x506e3c(0xb6)](),_0x46a5ea=_0x5308c4[_0x506e3c(0x11f)]['id'],_0x402d05=await purchases_finished[_0x506e3c(0xf6)](_0x46a5ea),_0x2fa5de=await suppliers[_0x506e3c(0xb6)]({});let _0x4c45ff;if(_0xac55a[_0x506e3c(0x104)]==_0x506e3c(0xa3)){const _0x18303b=await staff[_0x506e3c(0x159)]({'email':_0xac55a[_0x506e3c(0xa9)]});_0x4c45ff=await warehouse[_0x506e3c(0xb6)]({'status':_0x506e3c(0x158),'name':_0x18303b['warehouse'],'warehouse_category':_0x506e3c(0xb4)});}else _0x4c45ff=await warehouse[_0x506e3c(0xda)]([{'$match':{'status':_0x506e3c(0x158),'warehouse_category':_0x506e3c(0xb4)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x1eeb96=await product[_0x506e3c(0xb6)]({}),_0x5bfa41=BayBinSelected(_0x402d05['warehouse_name'],_0x402d05[_0x506e3c(0x14d)]);let _0x7c398e=new Date(_0x402d05[_0x506e3c(0x113)]),_0x277f2d=('0'+_0x7c398e[_0x506e3c(0x15a)]())['slice'](-0x2),_0x15e6d4=('0'+(_0x7c398e[_0x506e3c(0x118)]()+0x1))[_0x506e3c(0x16e)](-0x2),_0x2cb3a1=_0x7c398e[_0x506e3c(0x108)](),_0x4a797a=_0x2cb3a1+'-'+_0x15e6d4+'-'+_0x277f2d;if(_0x56a27c[0x0][_0x506e3c(0xbd)]==_0x506e3c(0xd0)){var _0x4e6915=users[_0x506e3c(0x143)];console[_0x506e3c(0xaa)](_0x4e6915);}else{if(_0x56a27c[0x0][_0x506e3c(0xbd)]==_0x506e3c(0x8d))var _0x4e6915=users[_0x506e3c(0x8d)];else{if(_0x56a27c[0x0][_0x506e3c(0xbd)]==_0x506e3c(0xf3))var _0x4e6915=users[_0x506e3c(0xf3)];else{if(_0x56a27c[0x0][_0x506e3c(0xbd)]==_0x506e3c(0x94))var _0x4e6915=users[_0x506e3c(0x94)];else{if(_0x56a27c[0x0][_0x506e3c(0xbd)]==_0x506e3c(0xdd))var _0x4e6915=users[_0x506e3c(0xdd)];else{if(_0x56a27c[0x0][_0x506e3c(0xbd)]=='Portuguese\x20(BR)')var _0x4e6915=users[_0x506e3c(0xe1)];else{if(_0x56a27c[0x0][_0x506e3c(0xbd)]==_0x506e3c(0x9a))var _0x4e6915=users[_0x506e3c(0x9a)];else{if(_0x56a27c[0x0][_0x506e3c(0xbd)]=='Arabic\x20(ae)')var _0x4e6915=users['Arabic'];}}}}}}}_0x3561b8['render'](_0x506e3c(0xbf),{'success':_0x5308c4[_0x506e3c(0x128)](_0x506e3c(0x188)),'errors':_0x5308c4['flash']('errors'),'role':_0xac55a,'profile':_0x5e7b07,'purchases':_0x402d05,'suppliers':_0x2fa5de,'warehouse':_0x4c45ff,'product':_0x1eeb96,'master_shop':_0x56a27c,'language':_0x4e6915,'ed_fullDate':_0x4a797a,'dataSelected':_0x5bfa41});}catch(_0x18f8f8){console[_0x506e3c(0xaa)](_0x18f8f8);}}),router[a0_0xacf369(0xce)](a0_0xacf369(0x140),auth,async(_0x5b59d0,_0x337f4a)=>{var _0x3a77b5=a0_0xacf369;try{const {username:_0x2b1dfa,email:_0x316c43,role:_0x312d87}=_0x5b59d0[_0x3a77b5(0xee)],_0x39744c=_0x5b59d0['user'],_0x337bc2=await profile[_0x3a77b5(0x159)]({'email':_0x39744c[_0x3a77b5(0xa9)]}),_0x3d6f96=await master_shop[_0x3a77b5(0xb6)](),_0x4af733=_0x5b59d0[_0x3a77b5(0x11f)]['id'],_0x521d16=await purchases_finished[_0x3a77b5(0xf6)](_0x4af733),_0x504ff2=await suppliers[_0x3a77b5(0xb6)]({});let _0xaa07d2;if(_0x39744c['role']==_0x3a77b5(0xa3)){const _0x1a512d=await staff[_0x3a77b5(0x159)]({'email':_0x39744c[_0x3a77b5(0xa9)]});_0xaa07d2=await warehouse['find']({'status':_0x3a77b5(0x158),'name':_0x1a512d[_0x3a77b5(0x124)],'warehouse_category':_0x3a77b5(0xb4)});}else _0xaa07d2=await warehouse[_0x3a77b5(0xda)]([{'$match':{'status':_0x3a77b5(0x158),'warehouse_category':_0x3a77b5(0xb4)}},{'$group':{'_id':_0x3a77b5(0x134),'name':{'$first':_0x3a77b5(0x134)}}}]);const _0x1bcd33=await product['find']({}),_0x10fea8=BayBinSelected(_0x521d16[_0x3a77b5(0x155)],_0x521d16[_0x3a77b5(0x14d)]);let _0x280032=new Date(_0x521d16[_0x3a77b5(0x113)]),_0x17c849=('0'+_0x280032['getDate']())[_0x3a77b5(0x16e)](-0x2),_0x447491=('0'+(_0x280032[_0x3a77b5(0x118)]()+0x1))[_0x3a77b5(0x16e)](-0x2),_0x49fcc1=_0x280032[_0x3a77b5(0x108)](),_0x404521=_0x49fcc1+'-'+_0x447491+'-'+_0x17c849;if(_0x3d6f96[0x0][_0x3a77b5(0xbd)]==_0x3a77b5(0xd0)){var _0x9a5b8a=users[_0x3a77b5(0x143)];console['log'](_0x9a5b8a);}else{if(_0x3d6f96[0x0][_0x3a77b5(0xbd)]==_0x3a77b5(0x8d))var _0x9a5b8a=users[_0x3a77b5(0x8d)];else{if(_0x3d6f96[0x0][_0x3a77b5(0xbd)]==_0x3a77b5(0xf3))var _0x9a5b8a=users[_0x3a77b5(0xf3)];else{if(_0x3d6f96[0x0]['language']=='Spanish')var _0x9a5b8a=users[_0x3a77b5(0x94)];else{if(_0x3d6f96[0x0]['language']==_0x3a77b5(0xdd))var _0x9a5b8a=users[_0x3a77b5(0xdd)];else{if(_0x3d6f96[0x0][_0x3a77b5(0xbd)]==_0x3a77b5(0xac))var _0x9a5b8a=users[_0x3a77b5(0xe1)];else{if(_0x3d6f96[0x0][_0x3a77b5(0xbd)]==_0x3a77b5(0x9a))var _0x9a5b8a=users[_0x3a77b5(0x9a)];else{if(_0x3d6f96[0x0]['language']==_0x3a77b5(0x8c))var _0x9a5b8a=users[_0x3a77b5(0x133)];}}}}}}}_0x337f4a[_0x3a77b5(0x151)](_0x3a77b5(0x14c),{'success':_0x5b59d0[_0x3a77b5(0x128)](_0x3a77b5(0x188)),'errors':_0x5b59d0['flash']('errors'),'role':_0x39744c,'profile':_0x337bc2,'purchases':_0x521d16,'suppliers':_0x504ff2,'warehouse':_0xaa07d2,'product':_0x1bcd33,'master_shop':_0x3d6f96,'language':_0x9a5b8a,'ed_fullDate':_0x404521,'dataSelected':_0x10fea8});}catch(_0x9eb964){console['log'](_0x9eb964);}}),router[a0_0xacf369(0x152)](a0_0xacf369(0x140),auth,async(_0x196495,_0x396103)=>{var _0x43227b=a0_0xacf369;try{const _0x29f411=_0x196495[_0x43227b(0x11f)]['id'],_0x376859=await purchases_finished[_0x43227b(0x159)]({'_id':_0x196495[_0x43227b(0x11f)]['id']}),_0x1c1328=await warehouse[_0x43227b(0x159)]({'name':_0x376859[_0x43227b(0x155)],'room':_0x376859['room']});_0x376859[_0x43227b(0xd7)][_0x43227b(0xef)](_0x46dac7=>{var _0xf746ac=_0x43227b;const _0x1213a1=_0x1c1328[_0xf746ac(0xc2)]['map'](_0x46a67e=>{var _0x2d70ac=_0xf746ac;_0x46a67e['product_name']==_0x46dac7['product_name']&&_0x46a67e[_0x2d70ac(0xe6)]==_0x46dac7[_0x2d70ac(0xe6)]&&(_0x46a67e[_0x2d70ac(0xea)]=parseInt(_0x46a67e['product_stock'])-parseInt(_0x46dac7[_0x2d70ac(0xf8)]));});}),await _0x1c1328[_0x43227b(0xa7)]();const {invoice:_0x203383,suppliers:_0x1c3ea5,date:_0x16a4cf,warehouse_name:_0x5c3159,prod_name:_0x13f45c,prod_code:_0xec00f,prod_qty:_0x349fd6,prod_unit:_0xb4ce55,prod_secondunit:_0x25de28,prod_level:_0x4e782b,prod_isle:_0x37ac9c,prod_pallet:_0xe9d579,note:_0x3efe67,expiry_date:_0x29d3cb,batch_code:_0x40dc65,paid_amount:_0x21a0b0,due_amount:_0x2fd6eb,Room_name:_0x267145,primary_code:_0x10b398,secondary_code:_0x4cb9eb,PO_number:_0x328f63,JO_number:_0x16a648}=_0x196495[_0x43227b(0x17b)];if(typeof _0x13f45c=='string')var _0x39bd09=[_0x196495[_0x43227b(0x17b)][_0x43227b(0x10f)]],_0x32466f=[_0x196495[_0x43227b(0x17b)]['prod_code']],_0x1b2548=[_0x196495[_0x43227b(0x17b)][_0x43227b(0xe0)]],_0x5b01a8=[_0x196495[_0x43227b(0x17b)][_0x43227b(0xec)]],_0x422d1b=[_0x196495[_0x43227b(0x17b)][_0x43227b(0x142)]],_0x832e04=[_0x196495['body'][_0x43227b(0x169)]],_0x48efd9=[_0x196495[_0x43227b(0x17b)][_0x43227b(0xb0)]],_0x200736=[_0x196495[_0x43227b(0x17b)]['secondary_code']],_0x86b1aa=[_0x196495[_0x43227b(0x17b)][_0x43227b(0x111)]],_0x527ef8=[_0x196495[_0x43227b(0x17b)][_0x43227b(0xe8)]],_0x41711f=[_0x196495[_0x43227b(0x17b)][_0x43227b(0x113)]];else var _0x39bd09=[..._0x196495[_0x43227b(0x17b)][_0x43227b(0x10f)]],_0x32466f=[..._0x196495[_0x43227b(0x17b)][_0x43227b(0x17c)]],_0x1b2548=[..._0x196495[_0x43227b(0x17b)][_0x43227b(0xe0)]],_0x5b01a8=[..._0x196495[_0x43227b(0x17b)]['prod_unit']],_0x422d1b=[..._0x196495['body'][_0x43227b(0x142)]],_0x832e04=[..._0x196495[_0x43227b(0x17b)][_0x43227b(0x169)]],_0x48efd9=[..._0x196495['body']['primary_code']],_0x200736=[..._0x196495[_0x43227b(0x17b)][_0x43227b(0xb1)]],_0x86b1aa=[..._0x196495[_0x43227b(0x17b)][_0x43227b(0x111)]],_0x527ef8=[..._0x196495[_0x43227b(0x17b)][_0x43227b(0xe8)]],_0x41711f=[..._0x196495[_0x43227b(0x17b)][_0x43227b(0x113)]];const _0x2cbde8=_0x39bd09[_0x43227b(0x153)](_0x50f49c=>{return _0x50f49c={'product_name':_0x50f49c};});_0x32466f[_0x43227b(0xef)]((_0x49b10e,_0x36d395)=>{var _0x28b4a8=_0x43227b;_0x2cbde8[_0x36d395][_0x28b4a8(0x141)]=_0x49b10e;}),_0x1b2548[_0x43227b(0xef)]((_0xba53c5,_0x1f4ce0)=>{var _0x3ea12c=_0x43227b;_0x2cbde8[_0x1f4ce0][_0x3ea12c(0xf8)]=_0xba53c5;}),_0x5b01a8[_0x43227b(0xef)]((_0x3b0ac4,_0x577664)=>{var _0x4d4d72=_0x43227b;_0x2cbde8[_0x577664][_0x4d4d72(0xf2)]=_0x3b0ac4;}),_0x422d1b[_0x43227b(0xef)]((_0x3cd81e,_0x2afe50)=>{var _0x3fc843=_0x43227b;_0x2cbde8[_0x2afe50][_0x3fc843(0xd6)]=_0x3cd81e;}),_0x832e04['forEach']((_0xb0a4aa,_0x39ab34)=>{_0x2cbde8[_0x39ab34]['bay']=_0xb0a4aa;}),_0x48efd9[_0x43227b(0xef)]((_0x3bcbe3,_0xd5ac73)=>{var _0x2c0552=_0x43227b;_0x2cbde8[_0xd5ac73][_0x2c0552(0xb0)]=_0x3bcbe3;}),_0x200736[_0x43227b(0xef)]((_0x59d171,_0x4e68f1)=>{var _0x20179c=_0x43227b;_0x2cbde8[_0x4e68f1][_0x20179c(0xb1)]=_0x59d171;}),_0x86b1aa[_0x43227b(0xef)]((_0x2f1e5b,_0x418889)=>{var _0x3ab98f=_0x43227b;_0x2cbde8[_0x418889][_0x3ab98f(0x17e)]=_0x2f1e5b;}),_0x527ef8[_0x43227b(0xef)]((_0x137422,_0x147b8f)=>{var _0xdded02=_0x43227b;_0x2cbde8[_0x147b8f][_0xdded02(0xe8)]=_0x137422;}),_0x41711f[_0x43227b(0xef)]((_0x49f6e0,_0x4203e5)=>{var _0x341226=_0x43227b;_0x2cbde8[_0x4203e5][_0x341226(0x113)]=_0x49f6e0;});const _0x1ee3ea=_0x2cbde8[_0x43227b(0x148)](_0x10de02=>_0x10de02['quantity']!=='0'&&_0x10de02[_0x43227b(0xf8)]!=='');_0x376859['invoice']=_0x203383,_0x376859[_0x43227b(0xe3)]=_0x1c3ea5,_0x376859[_0x43227b(0x15c)]=_0x16a4cf,_0x376859[_0x43227b(0x155)]=_0x5c3159,_0x376859[_0x43227b(0xd7)]=_0x1ee3ea,_0x376859[_0x43227b(0xa6)]=_0x3efe67,_0x376859['paid_amount']=_0x21a0b0,_0x376859[_0x43227b(0xfe)]=_0x2fd6eb,_0x376859[_0x43227b(0x14d)]=_0x267145,_0x376859[_0x43227b(0x98)]=_0x328f63,_0x376859['JO_number']=_0x16a648;const _0x27c029=await _0x376859[_0x43227b(0xa7)](),_0x53a50c=await warehouse[_0x43227b(0x159)]({'name':_0x196495['body'][_0x43227b(0x155)],'room':_0x196495['body'][_0x43227b(0xdf)]});_0x376859['product'][_0x43227b(0xef)](_0x1e77b7=>{var _0x39d8fd=_0x43227b,_0x77f072=0x0;const _0x383c3c=_0x53a50c['product_details'][_0x39d8fd(0x153)](_0x14b3fe=>{var _0x26764e=_0x39d8fd;_0x14b3fe[_0x26764e(0x186)]==_0x1e77b7[_0x26764e(0x186)]&&_0x14b3fe[_0x26764e(0xe6)]==_0x1e77b7[_0x26764e(0xe6)]&&(_0x14b3fe['product_stock']=parseInt(_0x14b3fe[_0x26764e(0xea)])+parseInt(_0x1e77b7[_0x26764e(0xf8)]),_0x77f072++);});_0x77f072=='0'&&(_0x53a50c[_0x39d8fd(0xc2)]=_0x53a50c[_0x39d8fd(0xc2)]['concat']({'product_name':_0x1e77b7[_0x39d8fd(0x186)],'product_stock':_0x1e77b7[_0x39d8fd(0xf8)],'primary_code':_0x1e77b7[_0x39d8fd(0xb0)],'secondary_code':_0x1e77b7[_0x39d8fd(0xb1)],'product_code':_0x1e77b7[_0x39d8fd(0x141)],'bay':_0x1e77b7[_0x39d8fd(0xe6)],'maxProducts':_0x1e77b7[_0x39d8fd(0x17e)],'unit':_0x1e77b7[_0x39d8fd(0xf2)],'secondary_unit':_0x1e77b7[_0x39d8fd(0xd6)],'expiry_date':_0x1e77b7[_0x39d8fd(0x113)]}));}),await _0x53a50c[_0x43227b(0xa7)]();const _0x29f53f=await s_payment_data[_0x43227b(0x159)]({'invoice':_0x196495[_0x43227b(0x17b)][_0x43227b(0xeb)]});if(_0x29f53f===null){}else console['log']('suppliers',_0x29f53f,_0x196495[_0x43227b(0x17b)][_0x43227b(0xeb)]),_0x29f53f['suppliers']=_0x196495[_0x43227b(0x17b)][_0x43227b(0xe3)],await _0x29f53f[_0x43227b(0xa7)]();_0x196495['flash'](_0x43227b(0x188),_0x43227b(0x161)),_0x396103[_0x43227b(0x177)]('/all_purchases_finished/view');}catch(_0x51fc4d){console['log'](_0x51fc4d);}}),router['post'](a0_0xacf369(0x9f),auth,async(_0x53b075,_0x32308d)=>{var _0x3a4b7c=a0_0xacf369;try{const _0x1b3215=_0x53b075[_0x3a4b7c(0x11f)]['id'],{invoice:_0x321503,suppliers:_0x1a4a4a,payable:_0x49f9bd,due_amount:_0x9aebb5}=_0x53b075[_0x3a4b7c(0x17b)],_0x92b6e6=await purchases[_0x3a4b7c(0xf6)](_0x1b3215);var _0x8cbb9c=_0x49f9bd-_0x9aebb5;_0x92b6e6[_0x3a4b7c(0x174)]=parseFloat(_0x92b6e6['paid_amount'])+parseFloat(_0x9aebb5),_0x92b6e6[_0x3a4b7c(0xfe)]=_0x8cbb9c;const _0x74865=await _0x92b6e6['save']();console[_0x3a4b7c(0xaa)](_0x74865);const _0x41da36=await s_payment_data['findOne']({'invoice':_0x321503});_0x41da36['amount']=_0x8cbb9c,await _0x41da36[_0x3a4b7c(0xa7)]();let _0x402bcb=new Date(),_0x25dc5e=('0'+_0x402bcb[_0x3a4b7c(0x15a)]())[_0x3a4b7c(0x16e)](-0x2),_0x39fcde=('0'+(_0x402bcb[_0x3a4b7c(0x118)]()+0x1))[_0x3a4b7c(0x16e)](-0x2),_0x3f0631=_0x402bcb['getFullYear'](),_0x143c1b=_0x3f0631+'-'+_0x39fcde+'-'+_0x25dc5e;const _0x1e0e05=new suppliers_payment({'invoice':_0x321503,'date':_0x3f0631+'-'+_0x39fcde+'-'+_0x25dc5e,'suppliers':_0x1a4a4a,'reason':_0x3a4b7c(0x146),'amount':_0x9aebb5}),_0x169615=await _0x1e0e05[_0x3a4b7c(0xa7)]();_0x53b075[_0x3a4b7c(0x128)](_0x3a4b7c(0x188),_0x3a4b7c(0xab)),_0x32308d['redirect'](_0x3a4b7c(0xe4));}catch(_0x304c78){console[_0x3a4b7c(0xaa)](_0x304c78);}}),router['get']('/invoice/:id',auth,async(_0x301407,_0x1d0c98)=>{var _0x5e3e42=a0_0xacf369;try{const {username:_0x39bd21,email:_0x92bdd0,role:_0x40c2bd}=_0x301407[_0x5e3e42(0xee)],_0x4b1028=_0x301407[_0x5e3e42(0xee)],_0x5ea469=await profile[_0x5e3e42(0x159)]({'email':_0x4b1028[_0x5e3e42(0xa9)]}),_0x4cda5e=await master_shop[_0x5e3e42(0xb6)]();console['log'](_0x5e3e42(0x164),_0x4cda5e);const _0x21cb1e=_0x301407[_0x5e3e42(0x11f)]['id'],_0x5ea8a5=await purchases[_0x5e3e42(0xf6)](_0x21cb1e);console[_0x5e3e42(0xaa)](_0x5ea8a5);const _0x278270=await suppliers[_0x5e3e42(0x159)]({'name':_0x5ea8a5[_0x5e3e42(0xe3)]});console[_0x5e3e42(0xaa)](_0x278270);if(_0x4cda5e[0x0][_0x5e3e42(0xbd)]=='English\x20(US)'){var _0x39c5f5=users['English'];console[_0x5e3e42(0xaa)](_0x39c5f5);}else{if(_0x4cda5e[0x0][_0x5e3e42(0xbd)]==_0x5e3e42(0x8d))var _0x39c5f5=users[_0x5e3e42(0x8d)];else{if(_0x4cda5e[0x0][_0x5e3e42(0xbd)]==_0x5e3e42(0xf3))var _0x39c5f5=users[_0x5e3e42(0xf3)];else{if(_0x4cda5e[0x0][_0x5e3e42(0xbd)]==_0x5e3e42(0x94))var _0x39c5f5=users['Spanish'];else{if(_0x4cda5e[0x0][_0x5e3e42(0xbd)]==_0x5e3e42(0xdd))var _0x39c5f5=users[_0x5e3e42(0xdd)];else{if(_0x4cda5e[0x0][_0x5e3e42(0xbd)]==_0x5e3e42(0xac))var _0x39c5f5=users[_0x5e3e42(0xe1)];else{if(_0x4cda5e[0x0][_0x5e3e42(0xbd)]==_0x5e3e42(0x9a))var _0x39c5f5=users[_0x5e3e42(0x9a)];else{if(_0x4cda5e[0x0][_0x5e3e42(0xbd)]==_0x5e3e42(0x8c))var _0x39c5f5=users[_0x5e3e42(0x133)];}}}}}}}_0x1d0c98[_0x5e3e42(0x151)](_0x5e3e42(0xd3),{'success':_0x301407[_0x5e3e42(0x128)](_0x5e3e42(0x188)),'errors':_0x301407['flash'](_0x5e3e42(0x160)),'role':_0x4b1028,'profile':_0x5ea469,'master_shop':_0x4cda5e,'supplier':_0x278270,'purchase':_0x5ea8a5,'language':_0x39c5f5});}catch(_0x53beb9){console[_0x5e3e42(0xaa)](_0x53beb9);}}),router[a0_0xacf369(0xce)]('/view/return_purchase/:id',auth,async(_0x49b9e3,_0x4d4f94)=>{var _0x44b355=a0_0xacf369;try{const {username:_0x395e32,email:_0x21384d,role:_0x45e49d}=_0x49b9e3[_0x44b355(0xee)],_0xbbae06=_0x49b9e3[_0x44b355(0xee)],_0x5c5ecd=await profile[_0x44b355(0x159)]({'email':_0xbbae06[_0x44b355(0xa9)]}),_0x461418=await master_shop['find']();console[_0x44b355(0xaa)](_0x44b355(0x164),_0x461418);const _0x3a98b2=_0x49b9e3['params']['id'];console[_0x44b355(0xaa)](_0x3a98b2);const _0x41b3d3=await purchases_finished[_0x44b355(0xf6)](_0x3a98b2);console['log']('user_id',_0x41b3d3);const _0x273bd9=await product['find']({}),_0x906d77=await warehouse[_0x44b355(0xda)]([{'$match':{'name':_0x41b3d3[_0x44b355(0x155)],'room':_0x41b3d3['room']}},{'$unwind':_0x44b355(0x13b)},{'$group':{'_id':_0x44b355(0x185),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x44b355(0x13f)},'bay':{'$first':_0x44b355(0x156)},'bin':{'$first':_0x44b355(0x90)},'type':{'$first':_0x44b355(0x101)},'floorlevel':{'$first':_0x44b355(0x168)},'primary_code':{'$first':_0x44b355(0x12f)},'secondary_code':{'$first':_0x44b355(0xaf)},'product_code':{'$first':_0x44b355(0xd2)},'storage':{'$first':_0x44b355(0xe9)},'rack':{'$first':'$product_details.rack'}}}]);console[_0x44b355(0xaa)](_0x44b355(0xf9),_0x906d77);let _0x53bab2;if(_0xbbae06['role']==_0x44b355(0xa3)){const _0x3f5f08=await staff[_0x44b355(0x159)]({'email':_0xbbae06[_0x44b355(0xa9)]});_0x53bab2=await warehouse[_0x44b355(0xb6)]({'status':'Enabled','name':_0x3f5f08['warehouse'],'warehouse_category':_0x44b355(0xb4),'name':_0x44b355(0xc4)});}else _0x53bab2=await warehouse[_0x44b355(0xda)]([{'$match':{'status':_0x44b355(0x158),'warehouse_category':'Finished\x20Goods','name':_0x44b355(0xc4)}},{'$group':{'_id':_0x44b355(0x134),'name':{'$first':'$name'}}}]);if(_0x461418[0x0]['language']==_0x44b355(0xd0)){var _0x5666b9=users[_0x44b355(0x143)];console[_0x44b355(0xaa)](_0x5666b9);}else{if(_0x461418[0x0][_0x44b355(0xbd)]==_0x44b355(0x8d))var _0x5666b9=users[_0x44b355(0x8d)];else{if(_0x461418[0x0][_0x44b355(0xbd)]==_0x44b355(0xf3))var _0x5666b9=users[_0x44b355(0xf3)];else{if(_0x461418[0x0][_0x44b355(0xbd)]==_0x44b355(0x94))var _0x5666b9=users[_0x44b355(0x94)];else{if(_0x461418[0x0][_0x44b355(0xbd)]=='French')var _0x5666b9=users['French'];else{if(_0x461418[0x0][_0x44b355(0xbd)]=='Portuguese\x20(BR)')var _0x5666b9=users['Portuguese'];else{if(_0x461418[0x0][_0x44b355(0xbd)]==_0x44b355(0x9a))var _0x5666b9=users['Chinese'];else{if(_0x461418[0x0]['language']==_0x44b355(0x8c))var _0x5666b9=users[_0x44b355(0x133)];}}}}}}}_0x4d4f94['render']('return_purchase_finished',{'success':_0x49b9e3['flash'](_0x44b355(0x188)),'errors':_0x49b9e3[_0x44b355(0x128)](_0x44b355(0x160)),'role':_0xbbae06,'profile':_0x5c5ecd,'user':_0x41b3d3,'stock':_0x906d77,'master_shop':_0x461418,'product':_0x273bd9,'language':_0x5666b9,'warehouse':_0x53bab2});}catch(_0x5ee4ad){console[_0x44b355(0xaa)](_0x5ee4ad);}}),router[a0_0xacf369(0x152)](a0_0xacf369(0x87),auth,async(_0x2ec4c7,_0x31706e)=>{var _0x102148=a0_0xacf369;try{const {invoice:_0xcba9ab,date:_0xdd9290,warehouse_name:_0x1333a0,Room_name:_0x24d0f5,product_name:_0x2cfd6b,purchase_quantity:_0x189942,stocks:_0x49a197,return_qty:_0x415e44,note:_0x20095b,level:_0x3f1d69,isle:_0x344c58,pallet:_0x4a2577,to_warehouse_name:_0x2f3a55,to_Room_name:_0xcbf058}=_0x2ec4c7['body'],_0x37f6cf=await purchases_finished['findOne']({'_id':_0x2ec4c7[_0x102148(0x11f)]['id']}),_0x10c7ee=await warehouse[_0x102148(0x159)]({'name':_0x1333a0,'room':_0x24d0f5,'warehouse_category':'Finished\x20Goods'});if(typeof _0x2cfd6b==_0x102148(0xcf))var _0x350d28=[_0x2ec4c7[_0x102148(0x17b)]['product_name']],_0x1db42c=[_0x2ec4c7[_0x102148(0x17b)][_0x102148(0xcb)]],_0xd60af4=[_0x2ec4c7[_0x102148(0x17b)][_0x102148(0x13a)]],_0x9431b7=[_0x2ec4c7[_0x102148(0x17b)]['return_qty']],_0x5a8ddd=[_0x2ec4c7[_0x102148(0x17b)][_0x102148(0xc5)]],_0x2b5adb=[_0x2ec4c7[_0x102148(0x17b)][_0x102148(0x166)]],_0x1bc161=[_0x2ec4c7[_0x102148(0x17b)][_0x102148(0x15b)]],_0x3665ac=[_0x2ec4c7['body'][_0x102148(0x13d)]];else var _0x350d28=[..._0x2ec4c7[_0x102148(0x17b)][_0x102148(0x186)]],_0x1db42c=[..._0x2ec4c7[_0x102148(0x17b)][_0x102148(0xcb)]],_0xd60af4=[..._0x2ec4c7[_0x102148(0x17b)][_0x102148(0x13a)]],_0x9431b7=[..._0x2ec4c7['body'][_0x102148(0xba)]],_0x5a8ddd=[..._0x2ec4c7['body']['level']],_0x2b5adb=[..._0x2ec4c7[_0x102148(0x17b)][_0x102148(0x166)]],_0x1bc161=[..._0x2ec4c7['body'][_0x102148(0x15b)]],_0x3665ac=[..._0x2ec4c7[_0x102148(0x17b)][_0x102148(0x13d)]];const _0x4a6c03=_0x350d28[_0x102148(0x153)](_0xbfd890=>{return _0xbfd890={'product_name':_0xbfd890};});_0x1db42c[_0x102148(0xef)]((_0x5c3822,_0x582fdd)=>{var _0x3c548c=_0x102148;_0x4a6c03[_0x582fdd][_0x3c548c(0xcb)]=_0x5c3822;}),_0xd60af4[_0x102148(0xef)]((_0x50bb61,_0x4b1685)=>{var _0x20ca8e=_0x102148;_0x4a6c03[_0x4b1685][_0x20ca8e(0x130)]=_0x50bb61;}),_0x9431b7[_0x102148(0xef)]((_0x2be93f,_0x50ae27)=>{var _0x4cf949=_0x102148;_0x4a6c03[_0x50ae27][_0x4cf949(0xba)]=_0x2be93f;}),_0x5a8ddd[_0x102148(0xef)]((_0x4fee14,_0x4e4124)=>{_0x4a6c03[_0x4e4124]['bay']=_0x4fee14;}),_0x2b5adb['forEach']((_0x46d1d0,_0x3b3be9)=>{var _0x5a4adc=_0x102148;_0x4a6c03[_0x3b3be9][_0x5a4adc(0x141)]=_0x46d1d0;}),_0x1bc161[_0x102148(0xef)]((_0x51a81c,_0x2a78dc)=>{_0x4a6c03[_0x2a78dc]['primary_code']=_0x51a81c;}),_0x3665ac['forEach']((_0xde5e81,_0x48296e)=>{var _0xba1559=_0x102148;_0x4a6c03[_0x48296e][_0xba1559(0xb1)]=_0xde5e81;}),_0x4a6c03[_0x102148(0xef)](_0x49b274=>{var _0x3cc941=_0x102148;console[_0x3cc941(0xaa)](_0x49b274);const _0x121aa9=_0x10c7ee[_0x3cc941(0xc2)][_0x3cc941(0x153)](_0x1eafca=>{var _0x36f753=_0x3cc941;_0x1eafca[_0x36f753(0x186)]==_0x49b274[_0x36f753(0x186)]&&_0x1eafca['bay']==_0x49b274[_0x36f753(0xe6)]&&(console[_0x36f753(0xaa)](parseInt(_0x1eafca[_0x36f753(0xea)])+_0x36f753(0xca)+parseInt(_0x49b274[_0x36f753(0xba)])),_0x1eafca['product_stock']=parseInt(_0x1eafca['product_stock'])-parseInt(_0x49b274[_0x36f753(0xba)]));});}),await _0x10c7ee['save']();var _0x33241c=0x0;_0x4a6c03['forEach'](_0x26c3f9=>{var _0x323b96=_0x102148;(parseInt(_0x26c3f9[_0x323b96(0xcb)])<parseInt(_0x26c3f9[_0x323b96(0xba)])||parseInt(_0x26c3f9['stock_quantity'])<parseInt(_0x26c3f9['return_qty']))&&_0x33241c++;});if(_0x33241c!=0x0)return _0x2ec4c7['flash'](_0x102148(0x160),_0x102148(0xb7)),_0x31706e[_0x102148(0x177)](_0x102148(0xd4));const _0x56f4c9=new purchases_return_finished({'invoice':_0xcba9ab,'suppliers':_0x2ec4c7[_0x102148(0x17b)][_0x102148(0xe3)],'date':_0xdd9290,'warehouse_name':_0x1333a0,'return_product':_0x4a6c03,'note':_0x20095b,'room':_0x24d0f5,'to_warehouse_name':_0x2f3a55,'to_room':_0xcbf058}),_0x2f0d4f=await _0x56f4c9['save'](),_0x951694=await purchases_return_finished[_0x102148(0x159)]({'invoice':_0xcba9ab}),_0x15d45d=await warehouse['findOne']({'name':_0x2f3a55,'room':_0xcbf058,'warehouse_category':_0x102148(0xb4)});_0x951694['return_product']['forEach'](_0x417570=>{var _0x11b8bc=_0x102148,_0x1aa923=0x0;const _0x5e6985=_0x15d45d[_0x11b8bc(0xc2)][_0x11b8bc(0x153)](_0x23420b=>{var _0x35f66c=_0x11b8bc;console[_0x35f66c(0xaa)](_0x23420b[_0x35f66c(0x186)]+'=='+_0x417570[_0x35f66c(0x186)]+'&&'+_0x23420b['bay']+'=='+_0x417570[_0x35f66c(0xe6)]),_0x23420b[_0x35f66c(0x186)]==_0x417570[_0x35f66c(0x186)]&&_0x23420b[_0x35f66c(0xe6)]==_0x417570[_0x35f66c(0xe6)]&&(_0x23420b[_0x35f66c(0xea)]=parseInt(_0x23420b['product_stock'])-parseInt(_0x417570[_0x35f66c(0xba)]),_0x1aa923++);});_0x1aa923=='0'&&(_0x15d45d[_0x11b8bc(0xc2)]=_0x15d45d[_0x11b8bc(0xc2)][_0x11b8bc(0x173)]({'product_name':_0x417570[_0x11b8bc(0x186)],'product_stock':_0x417570['return_qty'],'primary_code':_0x417570[_0x11b8bc(0xb0)],'secondary_code':_0x417570[_0x11b8bc(0xb1)],'product_code':_0x417570[_0x11b8bc(0x141)],'bay':_0x417570[_0x11b8bc(0xe6)],'maxProducts':0xf423f}));}),await _0x15d45d[_0x102148(0xa7)]();const _0x3f0481=await purchases_finished[_0x102148(0x159)]({'invoice':_0xcba9ab});_0x3f0481[_0x102148(0x149)]='True';const _0x12f4a5=await _0x3f0481[_0x102148(0xa7)](),_0xc72d39=new s_payment_data({'invoice':_0xcba9ab,'suppliers':_0x2ec4c7[_0x102148(0x17b)][_0x102148(0xe3)],'reason':_0x102148(0x10e)});await _0xc72d39[_0x102148(0xa7)]();const _0x4e4370=await master_shop[_0x102148(0xb6)](),_0xa6090f=await email_settings['findOne'](),_0x580c74=await suppliers['findOne']({'name':_0x2ec4c7[_0x102148(0x17b)]['suppliers']});_0x4e4370[0x0][_0x102148(0x127)]==0x1?(right_currency=_0x4e4370[0x0][_0x102148(0x89)],left_currency=''):(right_currency='',left_currency=_0x4e4370[0x0][_0x102148(0x89)]);var _0x6a8643=_0x350d28,_0x5d74a9=_0x9431b7,_0x42e75d='',_0x4f3df5;for(_0x4f3df5 in _0x6a8643){_0x42e75d+=_0x102148(0x176)+_0x102148(0x8f)+_0x6a8643[_0x4f3df5]+_0x102148(0x14a)+_0x102148(0x8f)+_0x5d74a9[_0x4f3df5]+_0x102148(0x14a)+_0x102148(0xd5);}let _0x30ebb3=nodemailer[_0x102148(0x96)]({'service':_0x102148(0x16a),'auth':{'user':_0xa6090f[_0x102148(0xa9)],'pass':_0xa6090f['password']}}),_0x229bb7={'from':_0xa6090f[_0x102148(0xa9)],'to':_0x580c74[_0x102148(0xa9)],'subject':_0x102148(0xa8),'attachments':[{'filename':_0x102148(0x103),'path':__dirname+'/../public'+_0x102148(0x145)+_0x4e4370[0x0][_0x102148(0x12c)],'cid':'logo'}],'html':_0x102148(0x95)+_0x102148(0xa2)+_0x102148(0xd9)+_0x102148(0x180)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x102148(0x180)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+'<h2>\x20'+_0x4e4370[0x0][_0x102148(0x10b)]+_0x102148(0x144)+'</div>'+_0x102148(0x100)+_0x102148(0xb9)+_0x102148(0x180)+_0x102148(0x119)+_0x102148(0xc7)+_0xcba9ab+'\x20'+_0x102148(0x175)+_0x102148(0xa4)+_0xdd9290+'\x20'+'</span>'+_0x102148(0x126)+_0x102148(0x100)+_0x102148(0x150)+_0x102148(0xff)+_0x102148(0x176)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x102148(0x8b)+_0x102148(0xb5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x102148(0xd5)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x42e75d+'\x20'+_0x102148(0x15f)+_0x102148(0x11b)+_0x102148(0x180)+_0x102148(0x116)+_0x102148(0xdb)+_0x4e4370[0x0][_0x102148(0x10b)]+_0x102148(0x126)+_0x102148(0x100)+'</div>'+'</body></html>'};_0x30ebb3[_0x102148(0x123)](_0x229bb7,function(_0xcbdb91,_0x43803a){var _0x2469d0=_0x102148;_0xcbdb91?console[_0x2469d0(0xaa)](_0x2469d0(0xd8)):console[_0x2469d0(0xaa)]('Email\x20sent\x20successfully');}),_0x2ec4c7[_0x102148(0x128)](_0x102148(0x188),_0x102148(0x16b)),_0x31706e[_0x102148(0x177)](_0x102148(0x132));}catch(_0x2b3ccf){_0x31706e['status'](0xc8)[_0x102148(0x163)]({'message':_0x2b3ccf['message']});}}),router['get']('/barcode/:id',auth,async(_0x23aa4f,_0x574409)=>{var _0xfcfe56=a0_0xacf369;try{const {username:_0x4d0a5e,email:_0x33d761,role:_0x1bb416}=_0x23aa4f[_0xfcfe56(0xee)],_0x4e69b9=_0x23aa4f['user'],_0x2b7ee4=await profile[_0xfcfe56(0x159)]({'email':_0x4e69b9[_0xfcfe56(0xa9)]}),_0x5463f5=await master_shop[_0xfcfe56(0xb6)](),_0x58cafb=_0x23aa4f['params']['id'],_0x2941c9=await purchases_finished['findById'](_0x58cafb);if(_0x5463f5[0x0]['language']==_0xfcfe56(0xd0))var _0x5a231e=users[_0xfcfe56(0x143)];else{if(_0x5463f5[0x0][_0xfcfe56(0xbd)]==_0xfcfe56(0x8d))var _0x5a231e=users[_0xfcfe56(0x8d)];else{if(_0x5463f5[0x0][_0xfcfe56(0xbd)]==_0xfcfe56(0xf3))var _0x5a231e=users['German'];else{if(_0x5463f5[0x0]['language']==_0xfcfe56(0x94))var _0x5a231e=users[_0xfcfe56(0x94)];else{if(_0x5463f5[0x0][_0xfcfe56(0xbd)]==_0xfcfe56(0xdd))var _0x5a231e=users[_0xfcfe56(0xdd)];else{if(_0x5463f5[0x0][_0xfcfe56(0xbd)]==_0xfcfe56(0xac))var _0x5a231e=users[_0xfcfe56(0xe1)];else{if(_0x5463f5[0x0][_0xfcfe56(0xbd)]==_0xfcfe56(0x9a))var _0x5a231e=users[_0xfcfe56(0x9a)];else{if(_0x5463f5[0x0][_0xfcfe56(0xbd)]==_0xfcfe56(0x8c))var _0x5a231e=users[_0xfcfe56(0x133)];}}}}}}}_0x574409['render'](_0xfcfe56(0xe7),{'success':_0x23aa4f[_0xfcfe56(0x128)](_0xfcfe56(0x188)),'errors':_0x23aa4f[_0xfcfe56(0x128)](_0xfcfe56(0x160)),'role':_0x4e69b9,'profile':_0x2b7ee4,'alldata':_0x2941c9,'master_shop':_0x5463f5,'language':_0x5a231e}),console[_0xfcfe56(0xaa)](alldata);}catch(_0x5cdec7){console[_0xfcfe56(0xaa)](_0x5cdec7);}}),router['post'](a0_0xacf369(0x9b),async(_0x119872,_0x4e8833)=>{var _0x2153d1=a0_0xacf369;const {product_code:_0x260d1e}=_0x119872[_0x2153d1(0x17b)];var _0x217cb1;const _0x8ddc67=await product[_0x2153d1(0xda)]([{'$match':{'primary_code':_0x260d1e,'product_category':_0x2153d1(0xb4)}},{'$group':{'_id':_0x2153d1(0x10d),'name':{'$first':_0x2153d1(0x134)},'category':{'$first':'$category'},'brand':{'$first':_0x2153d1(0x99)},'unit':{'$first':_0x2153d1(0x14e)},'alertquantity':{'$first':_0x2153d1(0x10c)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x2153d1(0x109)},'secondary_code':{'$first':_0x2153d1(0xa1)},'maxStocks':{'$first':_0x2153d1(0x16d)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2153d1(0x13e)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x35adf4=await product[_0x2153d1(0xda)]([{'$match':{'secondary_code':_0x260d1e}},{'$group':{'_id':_0x2153d1(0x10d),'name':{'$first':'$name'},'category':{'$first':_0x2153d1(0x167)},'brand':{'$first':'$brand'},'unit':{'$first':_0x2153d1(0x14e)},'alertquantity':{'$first':_0x2153d1(0x10c)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x2153d1(0x109)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x2153d1(0x16d)},'maxProdPerUnit':{'$first':_0x2153d1(0x179)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2153d1(0x13e)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x8ddc67[_0x2153d1(0xcc)]>0x0)_0x217cb1=_0x8ddc67;else _0x35adf4[_0x2153d1(0xcc)]>0x0&&(_0x217cb1=_0x35adf4);_0x4e8833[_0x2153d1(0x163)](_0x217cb1);}),router[a0_0xacf369(0x152)](a0_0xacf369(0xc0),async(_0x110194,_0x567201)=>{var _0x3a6abe=a0_0xacf369;const {productCode:_0x3eedd2,bay:_0x38df8e,warehouses:_0x39a61c,room:_0x3741b0}=_0x110194['body'];console[_0x3a6abe(0xaa)](_0x110194[_0x3a6abe(0x17b)]);try{const _0x1b2d94=await warehouse[_0x3a6abe(0xda)]([{'$match':{'name':_0x39a61c,'room':_0x3741b0}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x38df8e)}},{'$group':{'_id':_0x3a6abe(0x185),'name':{'$first':_0x3a6abe(0x120)},'product_stock':{'$first':_0x3a6abe(0x13f)},'bay':{'$first':_0x3a6abe(0x156)},'maxProducts':{'$first':_0x3a6abe(0xc8)}}}]);_0x567201['status'](0xc8)[_0x3a6abe(0x163)](_0x1b2d94);}catch(_0x23c42a){_0x567201[_0x3a6abe(0x110)](0x194)[_0x3a6abe(0x163)]({'message':_0x23c42a[_0x3a6abe(0x147)]});}}),module['exports']=router;