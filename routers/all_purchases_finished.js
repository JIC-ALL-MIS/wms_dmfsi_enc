var a0_0x2d20ab=a0_0x4e73;(function(_0x39c366,_0x25b8bb){var _0x3e29a7=a0_0x4e73,_0x376b1f=_0x39c366();while(!![]){try{var _0x4fa9d1=-parseInt(_0x3e29a7(0x1e2))/0x1*(-parseInt(_0x3e29a7(0x135))/0x2)+-parseInt(_0x3e29a7(0x211))/0x3+-parseInt(_0x3e29a7(0x130))/0x4+-parseInt(_0x3e29a7(0x181))/0x5+parseInt(_0x3e29a7(0x159))/0x6*(parseInt(_0x3e29a7(0x1d5))/0x7)+-parseInt(_0x3e29a7(0x1e3))/0x8+parseInt(_0x3e29a7(0x1d1))/0x9;if(_0x4fa9d1===_0x25b8bb)break;else _0x376b1f['push'](_0x376b1f['shift']());}catch(_0x59157e){_0x376b1f['push'](_0x376b1f['shift']());}}}(a0_0x23a1,0xf1336));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x2d20ab(0x1e9)),auth=require(a0_0x2d20ab(0x136)),nodemailer=require(a0_0x2d20ab(0x1f2));var ejs=require(a0_0x2d20ab(0x19a));const path=require(a0_0x2d20ab(0x186)),users=require('../public/language/languages.json');function a0_0x23a1(){var _0xb616f9=['return_purchase_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','role','</head><body>','$product_code','add_purchases_finished','prod_name','JO_number','Purchase\x20Return\x20Mail','QA\x20Warehouse','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Return\x20Goods','batch_code','True','FGSEmail','Portuguese\x20(BR)','product_details','back','<h5\x20style=\x22text-align:\x20left;\x22>','secondary_unit','$note','/view/:id','2868795GqiKrG','$product.type','prod_secondunit','room_name','</td>','path','Chinese','$product_details.bin','<tr>','purchase\x20data\x20update\x20successfully','$product.room_name','abs','\x20Order\x20Number\x20:\x20','note','Purchase\x20Return','$product_details.storage','random','maxperunit','$maxStocks','aggregate','Logo.png','max_product_unit','<strong>\x20Regards\x20</strong>','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.floorlevel','ejs','flash','</table>','primary_code_hide','Portuguese','$_id','secondary_code_hide','message','/barcode/:id','string','stock_data','find','/upload/','RoomAssign','$warehouse_name','$due_amount','$unit','Finished\x20Goods','An\x20error\x20occurred\x20while\x20saving\x20data.','expiry_date','Arabic\x20(ae)','prod_qty','concat','level','\x20<>\x20','</body></html>','$date','$suppliers_docs','purchases\x20item\x20return\x20successfull','user_id','port','json','$product_details.secondary_code','stocks','Email\x20sent\x20successfully','$category','padStart','$name','/view','product_cat','An\x20error\x20occurred.','<html><head><title></title>','map','/view/add_purchases','prod_Qty','all','getMonth','<span\x20style=\x22float:\x20right;\x22>','$product_details','currency','Enabled','Rack\x201','product_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product_details.maxProducts','26640468WwVWlG','floor','warehouse_name','/preview/:id','112jobYBE','DRY\x20GOODS','suppliers_docs','$maxProdPerUnit','\x20Order\x20Date\x20:\x20','product_name','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','secondary_code','</tr>','Arabic','product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','30267ujKnfo','15471616GvekEj','<hr\x20class=\x22my-3\x22>','INCF-','return_data','$secondary_unit','/barcode_scanner','../models/all_models','prod_code','$room','English\x20(US)','prod_cat','$product_details.product_name','</thead>','getFullYear','user','nodemailer','room','$product_details.product_stock','body','maxStocks','status','due_amount','primary_code','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','suppliers','host','<!DOCTYPE\x20html>','$alertquantity','sendMail','$invoice','$product_details.type','$secondary_code','forEach','</h5>','Spanish','/invoice/:id','$product.bin','$product','paid_amount','stock_quantity','prod_primunit','$product_details.bay','$product.quantity','prod_unit','catch','error','162762mrMOsx','</tbody>','$product.floorlevel','params','$brand','purchase_quantity','errors','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','findById','logo','$product_details._id','/view/return_purchase/:id','site_title','image','filter','redirect','/../public','quantity','purchase_invoice','return_qty','prod_level','save','Hindi','findOne','4801716uzNeBw','standard_unit','then','slice','</div>','8CfoLqZ','../middleware/auth','$primary_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/add_purchases/:id','\x20</h2>','$product_details.rack','length','Purchase\x20Mail','get','language','email','MaxStocks_data','render','product_stock','$expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','French','$suppliers','<table\x20style=\x22width:\x20100%\x20!important;\x22>','payment\x20successfull','post','German','production_date','exports','product','/all_purchases_finished/view','<h2>\x20','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','amount','$return_data','getDate','log','warehouse','prod_invoice','625962pOxyMT','</span>','master','product_date','edit_purchases_finished_view','Rack\x202','bay','success','$batch_code','password','Error\x20Occurs','createTransport','English','return_product','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<div>','<h5>'];a0_0x23a1=function(){return _0xb616f9;};return a0_0x23a1();}router[a0_0x2d20ab(0x13f)](a0_0x2d20ab(0x1c0),auth,async(_0x44a481,_0x22ee41)=>{var _0x8a8889=a0_0x2d20ab;try{const {username:_0x12af27,email:_0x3145b9,role:_0x324311}=_0x44a481[_0x8a8889(0x1f1)],_0xe252cc=_0x44a481[_0x8a8889(0x1f1)],_0x3d7ab3=await profile[_0x8a8889(0x12f)]({'email':_0xe252cc[_0x8a8889(0x141)]}),_0xb057e9=await staff[_0x8a8889(0x12f)]({'email':_0xe252cc['email']});if(_0xe252cc[_0x8a8889(0x16d)]=='staff'){const _0x44a6fc=await staff['findOne']({'email':_0xe252cc[_0x8a8889(0x141)]});}const _0x12a5d7=await master_shop['find']();let _0x18f69f;if(_0xe252cc[_0x8a8889(0x16d)]=='staff'){const _0x547ce7=await staff['findOne']({'email':_0xe252cc[_0x8a8889(0x141)]});_0x18f69f=await purchases_finished[_0x8a8889(0x194)]([{'$match':{'warehouse_name':_0x547ce7['warehouse']}},{'$lookup':{'from':_0x8a8889(0x1fb),'localField':_0x8a8889(0x1fb),'foreignField':'name','as':_0x8a8889(0x1d7)}},{'$unwind':_0x8a8889(0x1b5)},{'$unwind':_0x8a8889(0x208)},{'$group':{'_id':_0x8a8889(0x19f),'invoice':{'$first':_0x8a8889(0x200)},'suppliers':{'$first':_0x8a8889(0x148)},'date':{'$first':_0x8a8889(0x1b4)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x8a8889(0x1eb)},'product':{'$push':_0x8a8889(0x208)},'note':{'$first':_0x8a8889(0x17f)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x8a8889(0x1a9)},'return_data':{'$first':_0x8a8889(0x154)},'batch_code':{'$first':_0x8a8889(0x161)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x8a8889(0x20d)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x8a8889(0x182)},'floorlevel':{'$addToSet':_0x8a8889(0x117)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x18f69f=await purchases_finished[_0x8a8889(0x194)]([{'$unwind':_0x8a8889(0x208)},{'$group':{'_id':'$_id','invoice':{'$first':_0x8a8889(0x200)},'suppliers':{'$first':_0x8a8889(0x148)},'date':{'$first':_0x8a8889(0x1b4)},'warehouse_name':{'$first':_0x8a8889(0x1a8)},'room':{'$addToSet':_0x8a8889(0x18b)},'product':{'$push':_0x8a8889(0x208)},'note':{'$first':_0x8a8889(0x17f)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x8a8889(0x154)},'batch_code':{'$first':_0x8a8889(0x161)},'expiry_date':{'$first':_0x8a8889(0x145)},'suppliers_docs':{'$first':_0x8a8889(0x1b5)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x8a8889(0x11e)},'isle':{'$addToSet':_0x8a8889(0x207)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x8a8889(0x117)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x12a5d7[0x0][_0x8a8889(0x140)]==_0x8a8889(0x1ec))var _0x49347f=users[_0x8a8889(0x165)];else{if(_0x12a5d7[0x0][_0x8a8889(0x140)]=='Hindi')var _0x49347f=users['Hindi'];else{if(_0x12a5d7[0x0][_0x8a8889(0x140)]==_0x8a8889(0x14c))var _0x49347f=users[_0x8a8889(0x14c)];else{if(_0x12a5d7[0x0][_0x8a8889(0x140)]==_0x8a8889(0x205))var _0x49347f=users[_0x8a8889(0x205)];else{if(_0x12a5d7[0x0]['language']==_0x8a8889(0x147))var _0x49347f=users[_0x8a8889(0x147)];else{if(_0x12a5d7[0x0][_0x8a8889(0x140)]==_0x8a8889(0x17a))var _0x49347f=users['Portuguese'];else{if(_0x12a5d7[0x0]['language']==_0x8a8889(0x187))var _0x49347f=users['Chinese'];else{if(_0x12a5d7[0x0][_0x8a8889(0x140)]=='Arabic\x20(ae)')var _0x49347f=users[_0x8a8889(0x1df)];}}}}}}}_0x22ee41[_0x8a8889(0x143)]('all_purchases_finished',{'success':_0x44a481[_0x8a8889(0x19b)](_0x8a8889(0x160)),'errors':_0x44a481[_0x8a8889(0x19b)]('errors'),'purchases':_0x18f69f,'role':_0xe252cc,'profile':_0x3d7ab3,'master_shop':_0x12a5d7,'language':_0x49347f});}catch(_0x2c61da){console[_0x8a8889(0x156)]('table\x20page',_0x2c61da),_0x22ee41['status'](0xc8)[_0x8a8889(0x1b9)]({'message':_0x2c61da[_0x8a8889(0x1a1)]});}});function BayBinSelected(_0x5931b5,_0x388bfa){var _0x48df82=a0_0x2d20ab,_0x28a234=[],_0x465390=[];if(_0x5931b5==_0x48df82(0x1d6)){switch(_0x388bfa){case'Rack\x201':_0x28a234=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x48df82(0x15e):_0x28a234=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x465390=['DG'];}else{if(_0x5931b5=='FROZEN\x20GOODS'){switch(_0x388bfa){case _0x48df82(0x1cd):_0x28a234=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x48df82(0x15e):_0x28a234=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x465390=['FG'];}}return{'levels':_0x28a234,'identify':_0x465390};}function a0_0x4e73(_0x49b4a7,_0x34e8ce){var _0x23a1ca=a0_0x23a1();return a0_0x4e73=function(_0x4e73f9,_0x57d0c){_0x4e73f9=_0x4e73f9-0x117;var _0x5d973f=_0x23a1ca[_0x4e73f9];return _0x5d973f;},a0_0x4e73(_0x49b4a7,_0x34e8ce);}async function getRandom8DigitNumber(){var _0x97a992=a0_0x2d20ab;const _0x23f123=0x989680,_0x58b533=0x5f5e0ff,_0x1ebf52=Math[_0x97a992(0x1d2)](Math[_0x97a992(0x191)]()*(_0x58b533-_0x23f123+0x1))+_0x23f123;var _0x343e53;const _0x55b5a1=await purchases_finished[_0x97a992(0x12f)]({'invoice':_0x97a992(0x1e5)+_0x1ebf52});return _0x55b5a1&&_0x55b5a1[_0x97a992(0x13d)]>0x0?_0x343e53='INCF-'+_0x1ebf52:_0x343e53=_0x97a992(0x1e5)+_0x1ebf52,_0x343e53;}router[a0_0x2d20ab(0x13f)](a0_0x2d20ab(0x1c5),auth,async(_0x46ed97,_0x5a4884)=>{var _0x300a8c=a0_0x2d20ab;try{const {username:_0xcf5369,email:_0x609db,role:_0x217562}=_0x46ed97['user'],_0x38abca=_0x46ed97[_0x300a8c(0x1f1)],_0x881a7a=await profile[_0x300a8c(0x12f)]({'email':_0x38abca[_0x300a8c(0x141)]}),_0x37dd08=await master_shop[_0x300a8c(0x1a5)](),_0x158123=await staff[_0x300a8c(0x12f)]({'email':_0x38abca[_0x300a8c(0x141)]}),_0x1ddaf6=await suppliers['find']({});let _0x49cd3e;if(_0x38abca['role']==_0x300a8c(0x167)){const _0x2bf652=await staff[_0x300a8c(0x12f)]({'email':_0x38abca['email']});_0x49cd3e=await warehouse['aggregate']([{'$match':{'status':_0x300a8c(0x1cc),'name':_0x2bf652[_0x300a8c(0x157)],'warehouse_category':_0x300a8c(0x1ab)}},{'$group':{'_id':_0x300a8c(0x1bf),'name':{'$first':_0x300a8c(0x1bf)}}}]);}else _0x49cd3e=await warehouse[_0x300a8c(0x194)]([{'$match':{'status':_0x300a8c(0x1cc),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x300a8c(0x174)}}},{'$group':{'_id':_0x300a8c(0x1bf),'name':{'$first':'$name'}}}]);const _0x10c829=await product[_0x300a8c(0x1a5)]({}),_0x56ce99=await warehouse[_0x300a8c(0x1a5)]({'status':'Enabled'}),_0x26367d=await purchases_finished['find']({}),_0x49bf08=_0x26367d['length']+0x1,_0x5cee8d=_0x300a8c(0x1e5)+_0x49bf08['toString']()[_0x300a8c(0x1be)](0x5,'0');var _0x384a86=['Ambient','Enclosed'];if(_0x37dd08[0x0][_0x300a8c(0x140)]==_0x300a8c(0x1ec))var _0x35018a=users[_0x300a8c(0x165)];else{if(_0x37dd08[0x0][_0x300a8c(0x140)]==_0x300a8c(0x12e))var _0x35018a=users['Hindi'];else{if(_0x37dd08[0x0][_0x300a8c(0x140)]=='German')var _0x35018a=users['German'];else{if(_0x37dd08[0x0][_0x300a8c(0x140)]==_0x300a8c(0x205))var _0x35018a=users[_0x300a8c(0x205)];else{if(_0x37dd08[0x0][_0x300a8c(0x140)]==_0x300a8c(0x147))var _0x35018a=users[_0x300a8c(0x147)];else{if(_0x37dd08[0x0][_0x300a8c(0x140)]==_0x300a8c(0x17a))var _0x35018a=users['Portuguese'];else{if(_0x37dd08[0x0][_0x300a8c(0x140)]==_0x300a8c(0x187))var _0x35018a=users[_0x300a8c(0x187)];else{if(_0x37dd08[0x0][_0x300a8c(0x140)]==_0x300a8c(0x1ae))var _0x35018a=users[_0x300a8c(0x1df)];}}}}}}}const _0x548c32=getRandom8DigitNumber();_0x548c32[_0x300a8c(0x132)](_0x2cfe69=>{var _0xffecb9=_0x300a8c;_0x5a4884[_0xffecb9(0x143)](_0xffecb9(0x170),{'success':_0x46ed97[_0xffecb9(0x19b)](_0xffecb9(0x160)),'errors':_0x46ed97[_0xffecb9(0x19b)]('errors'),'role':_0x38abca,'profile':_0x881a7a,'suppliers':_0x1ddaf6,'warehouse':_0x49cd3e,'product':_0x10c829,'invoice':_0x2cfe69,'master_shop':_0x37dd08,'language':_0x35018a,'find_data':_0x56ce99,'rooms_data':_0x384a86});})[_0x300a8c(0x20f)](_0x4e9741=>{var _0x563334=_0x300a8c;_0x46ed97[_0x563334(0x19b)](_0x563334(0x11b),_0x563334(0x138)),_0x5a4884[_0x563334(0x127)](_0x563334(0x150));});}catch(_0x4daa6f){console[_0x300a8c(0x156)](_0x4daa6f);}}),router['get'](a0_0x2d20ab(0x13a),auth,async(_0x2c813f,_0x5951d0)=>{var _0x30bcf6=a0_0x2d20ab;try{const _0xdc4f81=_0x2c813f[_0x30bcf6(0x118)]['id'];console['log'](_0xdc4f81);const _0x3bfac7=await master_shop[_0x30bcf6(0x1a5)]();console['log'](_0x30bcf6(0x15b),_0x3bfac7);const _0x198764=await product[_0x30bcf6(0x12f)]({'name':_0xdc4f81});console[_0x30bcf6(0x156)](_0x30bcf6(0x14f),_0x198764),_0x5951d0[_0x30bcf6(0x1f7)](0xc8)[_0x30bcf6(0x1b9)]({'product_data':_0x198764,'master':_0x3bfac7});}catch(_0x5cdfdf){console['log']('add_purchases\x20error',_0x5cdfdf);}}),router[a0_0x2d20ab(0x14b)]('/view/add_purchases',auth,async(_0x566423,_0x5507d8)=>{var _0x1a1892=a0_0x2d20ab;try{const {invoice:_0x3f67cb,date:_0x1aa3ea,warehouse_name:_0x30d284,prod_name:_0x40a1f7,prod_code:_0x40f2e3,prod_qty:_0x11ffc7,prod_unit:_0x1ab41,prod_secondunit:_0x514793,prod_level:_0x3d7ebb,prod_isle:_0x2d4796,prod_pallet:_0x1d6e49,note:_0x4c079a,expiry_date:_0x534894,batch_code:_0x25c67,payable:_0x5ae616,due_amount:_0x201fd1,Room_name:_0x204da5,primary_code:_0x51c81c,secondary_code:_0xa2c03a,MaxStocks_data:_0x2e0f1f,PO_number:_0x2f9578,SCRN:_0x5b4a32,JO_number:_0x5e3f99}=_0x566423[_0x1a1892(0x1f5)];if(typeof _0x40a1f7=='string')var _0x26bcf6=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x171)]],_0x3de79f=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x1ea)]],_0x1dd228=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x1c6)]],_0x5b67ef=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x20b)]],_0x3d440f=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x183)]],_0x41f7d0=[_0x566423['body']['prod_level']],_0x302132=[_0x566423['body'][_0x1a1892(0x1f9)]],_0x31ff0b=[_0x566423[_0x1a1892(0x1f5)]['secondary_code']],_0x47b0bc=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x142)]],_0x392198=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x177)]],_0x34c12d=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x1ad)]],_0x480b6a=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x15c)]],_0x262658=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x196)]],_0x3d9b8f=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x1ed)]],_0x3d2137=[_0x566423[_0x1a1892(0x1f5)]['RoomAssign']],_0x4dff0a=[_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x158)]];else var _0x26bcf6=[..._0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x171)]],_0x3de79f=[..._0x566423[_0x1a1892(0x1f5)]['prod_code']],_0x1dd228=[..._0x566423['body'][_0x1a1892(0x1c6)]],_0x5b67ef=[..._0x566423[_0x1a1892(0x1f5)]['prod_primunit']],_0x3d440f=[..._0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x183)]],_0x41f7d0=[..._0x566423[_0x1a1892(0x1f5)]['prod_level']],_0x302132=[..._0x566423['body'][_0x1a1892(0x1f9)]],_0x31ff0b=[..._0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x1dd)]],_0x47b0bc=[..._0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x142)]],_0x392198=[..._0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x177)]],_0x34c12d=[..._0x566423['body']['expiry_date']],_0x480b6a=[..._0x566423[_0x1a1892(0x1f5)]['product_date']],_0x262658=[..._0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x196)]],_0x3d9b8f=[..._0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x1ed)]],_0x3d2137=[..._0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x1a7)]],_0x4dff0a=[..._0x566423['body']['prod_invoice']];const _0x539f78=_0x26bcf6[_0x1a1892(0x1c4)](_0x503c1c=>{return _0x503c1c={'product_name':_0x503c1c};});_0x3de79f[_0x1a1892(0x203)]((_0x43b778,_0x5b8b1b)=>{var _0x2ebf64=_0x1a1892;_0x539f78[_0x5b8b1b][_0x2ebf64(0x1e0)]=_0x43b778;}),_0x1dd228[_0x1a1892(0x203)]((_0x425504,_0xe4d0a)=>{var _0x2ee6f2=_0x1a1892;_0x539f78[_0xe4d0a][_0x2ee6f2(0x129)]=Math[_0x2ee6f2(0x18c)](_0x425504);}),_0x5b67ef[_0x1a1892(0x203)]((_0x5c3487,_0x434e8c)=>{var _0x538e81=_0x1a1892;_0x539f78[_0x434e8c][_0x538e81(0x131)]=_0x5c3487;}),_0x3d440f['forEach']((_0x59710e,_0x1bb31e)=>{var _0x376d34=_0x1a1892;_0x539f78[_0x1bb31e][_0x376d34(0x17e)]=_0x59710e;}),_0x41f7d0[_0x1a1892(0x203)]((_0xf6898d,_0x47a5c2)=>{_0x539f78[_0x47a5c2]['bay']=_0xf6898d;}),_0x302132[_0x1a1892(0x203)]((_0x36ff95,_0x2e67a2)=>{var _0x2aec41=_0x1a1892;_0x539f78[_0x2e67a2][_0x2aec41(0x1f9)]=_0x36ff95;}),_0x31ff0b[_0x1a1892(0x203)]((_0xe16e4e,_0x55a9ca)=>{var _0x5a65f2=_0x1a1892;_0x539f78[_0x55a9ca][_0x5a65f2(0x1dd)]=_0xe16e4e;}),_0x47b0bc['forEach']((_0xaa937,_0x2588a3)=>{_0x539f78[_0x2588a3]['maxStocks']=_0xaa937;}),_0x392198[_0x1a1892(0x203)]((_0xe6399e,_0x29eeed)=>{var _0x1882d8=_0x1a1892;_0x539f78[_0x29eeed][_0x1882d8(0x177)]=_0xe6399e;}),_0x34c12d['forEach']((_0x4f6594,_0x46131c)=>{var _0x1f16f6=_0x1a1892;_0x539f78[_0x46131c][_0x1f16f6(0x1ad)]=_0x4f6594;}),_0x480b6a['forEach']((_0x5a971d,_0x366bf2)=>{var _0x3608b4=_0x1a1892;_0x539f78[_0x366bf2][_0x3608b4(0x14d)]=_0x5a971d;}),_0x262658[_0x1a1892(0x203)]((_0x5b540a,_0x5c97c5)=>{_0x539f78[_0x5c97c5]['maxperunit']=_0x5b540a;}),_0x3d9b8f[_0x1a1892(0x203)]((_0x588163,_0x3825d6)=>{var _0x39f4de=_0x1a1892;_0x539f78[_0x3825d6][_0x39f4de(0x1c1)]=_0x588163;}),_0x3d2137[_0x1a1892(0x203)]((_0x49d646,_0x32f4a2)=>{var _0x312c35=_0x1a1892;_0x539f78[_0x32f4a2][_0x312c35(0x184)]=_0x49d646;}),_0x4dff0a[_0x1a1892(0x203)]((_0x48196d,_0x478a7c)=>{_0x539f78[_0x478a7c]['invoice']=_0x48196d;});const _0x205232=_0x539f78[_0x1a1892(0x126)](_0x40f618=>_0x40f618[_0x1a1892(0x129)]!=='0'&&_0x40f618['quantity']!==''),_0xb62ee7=new purchases_finished({'invoice':_0x3f67cb,'suppliers':_0x566423[_0x1a1892(0x1f5)][_0x1a1892(0x1fb)],'date':_0x1aa3ea,'warehouse_name':_0x30d284,'product':_0x205232,'note':_0x4c079a,'due_amount':_0x201fd1,'room':_0x204da5,'POnumber':_0x2f9578,'SCRN':_0x5b4a32,'JO_number':_0x5e3f99}),_0x20de01=await _0xb62ee7[_0x1a1892(0x12d)](),_0x293098=await purchases_finished[_0x1a1892(0x12f)]({'invoice':_0x3f67cb}),_0x787979=_0x293098[_0x1a1892(0x14f)]['map'](async _0x592dff=>{var _0x8d5837=_0x1a1892,_0xc13faa=await warehouse['findOne']({'name':_0x30d284,'room':_0x592dff['room_name']}),_0x2fafeb=0x0;const _0x35fe59=_0xc13faa[_0x8d5837(0x17b)][_0x8d5837(0x1c4)](_0x4da6fa=>{var _0xc02747=_0x8d5837;console['log'](_0x4da6fa[_0xc02747(0x1da)]+'=='+_0x592dff['product_name']+'&&'+_0x4da6fa[_0xc02747(0x15f)]+'=='+_0x592dff[_0xc02747(0x15f)]+'&&'+_0x4da6fa['expiry_date']+'=='+_0x592dff['expiry_date']+'&&'+_0x4da6fa['production_date']+'=='+_0x592dff[_0xc02747(0x14d)]+'&&'+_0x4da6fa[_0xc02747(0x177)]+'=='+_0x592dff[_0xc02747(0x177)]+'&&'+_0x4da6fa[_0xc02747(0x1db)]+'=='+_0x293098['invoice']),_0x4da6fa[_0xc02747(0x1da)]==_0x592dff[_0xc02747(0x1da)]&&_0x4da6fa[_0xc02747(0x15f)]==_0x592dff[_0xc02747(0x15f)]&&_0x4da6fa[_0xc02747(0x1ad)]==_0x592dff['expiry_date']&&_0x4da6fa[_0xc02747(0x14d)]==_0x592dff[_0xc02747(0x14d)]&&_0x4da6fa['batch_code']==_0x592dff[_0xc02747(0x177)]&&_0x4da6fa[_0xc02747(0x1db)]==_0x293098['invoice']&&(_0x4da6fa[_0xc02747(0x144)]=Math['abs'](_0x4da6fa['product_stock'])+Math[_0xc02747(0x18c)](_0x592dff[_0xc02747(0x129)]),_0x2fafeb++);});return _0x2fafeb=='0'&&(_0xc13faa[_0x8d5837(0x17b)]=_0xc13faa[_0x8d5837(0x17b)][_0x8d5837(0x1b0)]({'product_name':_0x592dff['product_name'],'product_stock':Math[_0x8d5837(0x18c)](_0x592dff[_0x8d5837(0x129)]),'primary_code':_0x592dff[_0x8d5837(0x1f9)],'secondary_code':_0x592dff[_0x8d5837(0x1dd)],'product_code':_0x592dff[_0x8d5837(0x1e0)],'bay':_0x592dff['bay'],'maxProducts':_0x592dff[_0x8d5837(0x1f6)],'unit':_0x592dff[_0x8d5837(0x131)],'secondary_unit':_0x592dff['secondary_unit'],'expiry_date':_0x592dff['expiry_date'],'production_date':_0x592dff[_0x8d5837(0x14d)],'maxProducts':_0x592dff['maxStocks'],'maxPerUnit':_0x592dff[_0x8d5837(0x192)],'batch_code':_0x592dff[_0x8d5837(0x177)],'product_cat':_0x592dff[_0x8d5837(0x1c1)],'invoice':_0x592dff[_0x8d5837(0x1db)]})),_0xc13faa;});Promise[_0x1a1892(0x1c7)](_0x787979)[_0x1a1892(0x132)](async _0x19443e=>{var _0x3b8bcb=_0x1a1892;try{for(const _0x3aeab3 of _0x19443e){await warehouse['updateOne']({'_id':_0x3aeab3['_id']},{'$addToSet':{'product_details':{'$each':_0x3aeab3['product_details']}}});}const _0x3a81c1=await master_shop['find'](),_0x30de35=await email_settings[_0x3b8bcb(0x12f)](),_0x112ec6=await supervisor_settings[_0x3b8bcb(0x1a5)]();var _0xa95f00=_0x293098[_0x3b8bcb(0x14f)],_0x4a4a50='',_0x3b91af;for(_0x3b91af in _0xa95f00){var _0x516ad4='FG';_0x293098['warehouse_name']==_0x3b8bcb(0x1d6)&&(_0x516ad4='DG'),_0x4a4a50+=_0x3b8bcb(0x189)+_0x3b8bcb(0x175)+_0xa95f00[_0x3b91af][_0x3b8bcb(0x1da)]+_0x3b8bcb(0x185)+_0x3b8bcb(0x175)+_0xa95f00[_0x3b91af][_0x3b8bcb(0x1e0)]+_0x3b8bcb(0x185)+_0x3b8bcb(0x175)+_0xa95f00[_0x3b91af][_0x3b8bcb(0x129)]+_0x3b8bcb(0x185)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xa95f00[_0x3b91af]['standard_unit']+_0x3b8bcb(0x185)+_0x3b8bcb(0x175)+_0xa95f00[_0x3b91af][_0x3b8bcb(0x17e)]+'</td>'+_0x3b8bcb(0x175)+_0x293098['warehouse_name']+_0x3b8bcb(0x185)+_0x3b8bcb(0x175)+_0xa95f00[_0x3b91af]['room_name']+_0x3b8bcb(0x185)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x516ad4+_0xa95f00[_0x3b91af][_0x3b8bcb(0x15f)]+_0x3b8bcb(0x185),_0x3b8bcb(0x1de);}let _0x1f102c=nodemailer[_0x3b8bcb(0x164)]({'host':_0x30de35[_0x3b8bcb(0x1fc)],'port':Number(_0x30de35[_0x3b8bcb(0x1b8)]),'secure':![],'auth':{'user':_0x30de35[_0x3b8bcb(0x141)],'pass':_0x30de35[_0x3b8bcb(0x162)]}}),_0x586e95={'from':_0x30de35['email'],'to':_0x112ec6[0x0][_0x3b8bcb(0x179)],'subject':_0x3b8bcb(0x13e),'attachments':[{'filename':_0x3b8bcb(0x195),'path':__dirname+_0x3b8bcb(0x128)+'/upload/'+_0x3a81c1[0x0][_0x3b8bcb(0x125)],'cid':_0x3b8bcb(0x121)}],'html':_0x3b8bcb(0x1fd)+_0x3b8bcb(0x1c3)+_0x3b8bcb(0x16e)+_0x3b8bcb(0x169)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3b8bcb(0x169)+_0x3b8bcb(0x139)+_0x3b8bcb(0x134)+_0x3b8bcb(0x169)+_0x3b8bcb(0x151)+_0x3a81c1[0x0][_0x3b8bcb(0x124)]+_0x3b8bcb(0x13b)+_0x3b8bcb(0x134)+_0x3b8bcb(0x134)+_0x3b8bcb(0x1e4)+_0x3b8bcb(0x169)+_0x3b8bcb(0x17d)+_0x3b8bcb(0x18d)+_0x293098[_0x3b8bcb(0x1db)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x293098['date']+'\x20'+_0x3b8bcb(0x15a)+_0x3b8bcb(0x204)+_0x3b8bcb(0x134)+_0x3b8bcb(0x149)+_0x3b8bcb(0x152)+_0x3b8bcb(0x189)+_0x3b8bcb(0x1dc)+_0x3b8bcb(0x11d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x3b8bcb(0x1e1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x3b8bcb(0x168)+_0x3b8bcb(0x146)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x3b8bcb(0x1ef)+_0x3b8bcb(0x198)+'\x20'+_0x4a4a50+'\x20'+_0x3b8bcb(0x212)+_0x3b8bcb(0x19c)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x3b8bcb(0x16a)+_0x3a81c1[0x0][_0x3b8bcb(0x124)]+_0x3b8bcb(0x204)+_0x3b8bcb(0x134)+'</div>'+_0x3b8bcb(0x1b3)};_0x1f102c[_0x3b8bcb(0x1ff)](_0x586e95,function(_0x3a791c,_0x1889bb){var _0x157d47=_0x3b8bcb;_0x3a791c?(console[_0x157d47(0x156)](_0x3a791c),console['log'](_0x157d47(0x163))):console[_0x157d47(0x156)](_0x157d47(0x1bc));});}catch(_0x10840e){console[_0x3b8bcb(0x210)](_0x10840e),_0x5507d8['status'](0x1f4)['json']({'error':_0x3b8bcb(0x1ac),'message':_0x10840e[_0x3b8bcb(0x1a1)]});}})[_0x1a1892(0x20f)](_0xa21167=>{var _0x25c4e4=_0x1a1892;console[_0x25c4e4(0x210)](_0xa21167),_0x5507d8[_0x25c4e4(0x1f7)](0x1f4)['json']({'error':_0x25c4e4(0x1c2)});}),_0x566423[_0x1a1892(0x19b)](_0x1a1892(0x160),'purchase\x20data\x20add\x20successfully'),_0x5507d8[_0x1a1892(0x127)](_0x1a1892(0x150));}catch(_0x20ff95){console[_0x1a1892(0x156)](_0x20ff95);}}),router['get'](a0_0x2d20ab(0x1d4),auth,async(_0x4e59d7,_0x311192)=>{var _0x51b616=a0_0x2d20ab;try{const {username:_0x1d5132,email:_0x17cbb6,role:_0x33aace}=_0x4e59d7[_0x51b616(0x1f1)],_0x399be6=_0x4e59d7[_0x51b616(0x1f1)],_0xb45e58=await profile[_0x51b616(0x12f)]({'email':_0x399be6[_0x51b616(0x141)]}),_0x10a36b=await master_shop['find'](),_0x5d67fb=_0x4e59d7['params']['id'],_0x266948=await purchases_finished[_0x51b616(0x120)](_0x5d67fb),_0x3d47e9=await suppliers['find']({});let _0x6fade6;if(_0x399be6[_0x51b616(0x16d)]==_0x51b616(0x167)){const _0x11616b=await staff['findOne']({'email':_0x399be6['email']});_0x6fade6=await warehouse[_0x51b616(0x1a5)]({'status':_0x51b616(0x1cc),'name':_0x11616b[_0x51b616(0x157)],'warehouse_category':'Finished\x20Goods'});}else _0x6fade6=await warehouse['aggregate']([{'$match':{'status':_0x51b616(0x1cc),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x51b616(0x1bf),'name':{'$first':'$name'}}}]);const _0x4968db=await product[_0x51b616(0x1a5)]({}),_0x27f0a9=BayBinSelected(_0x266948[_0x51b616(0x1d3)],_0x266948[_0x51b616(0x1f3)]);let _0x189dd5=new Date(_0x266948['expiry_date']),_0xdfbb51=('0'+_0x189dd5[_0x51b616(0x155)]())[_0x51b616(0x133)](-0x2),_0x4ada09=('0'+(_0x189dd5[_0x51b616(0x1c8)]()+0x1))['slice'](-0x2),_0x4e7137=_0x189dd5[_0x51b616(0x1f0)](),_0x38bd90=_0x4e7137+'-'+_0x4ada09+'-'+_0xdfbb51;if(_0x10a36b[0x0][_0x51b616(0x140)]==_0x51b616(0x1ec)){var _0x670644=users[_0x51b616(0x165)];console[_0x51b616(0x156)](_0x670644);}else{if(_0x10a36b[0x0][_0x51b616(0x140)]==_0x51b616(0x12e))var _0x670644=users['Hindi'];else{if(_0x10a36b[0x0]['language']=='German')var _0x670644=users[_0x51b616(0x14c)];else{if(_0x10a36b[0x0][_0x51b616(0x140)]==_0x51b616(0x205))var _0x670644=users[_0x51b616(0x205)];else{if(_0x10a36b[0x0][_0x51b616(0x140)]==_0x51b616(0x147))var _0x670644=users[_0x51b616(0x147)];else{if(_0x10a36b[0x0]['language']==_0x51b616(0x17a))var _0x670644=users[_0x51b616(0x19e)];else{if(_0x10a36b[0x0][_0x51b616(0x140)]==_0x51b616(0x187))var _0x670644=users[_0x51b616(0x187)];else{if(_0x10a36b[0x0][_0x51b616(0x140)]==_0x51b616(0x1ae))var _0x670644=users[_0x51b616(0x1df)];}}}}}}}_0x311192[_0x51b616(0x143)](_0x51b616(0x15d),{'success':_0x4e59d7[_0x51b616(0x19b)]('success'),'errors':_0x4e59d7['flash']('errors'),'role':_0x399be6,'profile':_0xb45e58,'purchases':_0x266948,'suppliers':_0x3d47e9,'warehouse':_0x6fade6,'product':_0x4968db,'master_shop':_0x10a36b,'language':_0x670644,'ed_fullDate':_0x38bd90,'dataSelected':_0x27f0a9});}catch(_0x5ad4c8){console['log'](_0x5ad4c8);}}),router['get'](a0_0x2d20ab(0x180),auth,async(_0x5b8e2e,_0x2f9275)=>{var _0x3a5d4f=a0_0x2d20ab;try{const {username:_0x55811,email:_0x3a5b8f,role:_0x5554c6}=_0x5b8e2e[_0x3a5d4f(0x1f1)],_0x4a37ef=_0x5b8e2e[_0x3a5d4f(0x1f1)],_0x5e1d63=await profile['findOne']({'email':_0x4a37ef[_0x3a5d4f(0x141)]}),_0x20eb15=await master_shop[_0x3a5d4f(0x1a5)](),_0x24bd7e=_0x5b8e2e[_0x3a5d4f(0x118)]['id'],_0x404f16=await purchases_finished['findById'](_0x24bd7e),_0x8af560=await suppliers[_0x3a5d4f(0x1a5)]({});let _0x5e1267;if(_0x4a37ef[_0x3a5d4f(0x16d)]=='staff'){const _0x2177f2=await staff[_0x3a5d4f(0x12f)]({'email':_0x4a37ef[_0x3a5d4f(0x141)]});_0x5e1267=await warehouse[_0x3a5d4f(0x1a5)]({'status':_0x3a5d4f(0x1cc),'name':_0x2177f2[_0x3a5d4f(0x157)],'warehouse_category':_0x3a5d4f(0x1ab)});}else _0x5e1267=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x3a5d4f(0x1ab)}},{'$group':{'_id':_0x3a5d4f(0x1bf),'name':{'$first':_0x3a5d4f(0x1bf)}}}]);const _0x1cc18f=await product[_0x3a5d4f(0x1a5)]({}),_0x33a6b2=BayBinSelected(_0x404f16[_0x3a5d4f(0x1d3)],_0x404f16['room']);let _0x1287cc=new Date(_0x404f16[_0x3a5d4f(0x1ad)]),_0x586c18=('0'+_0x1287cc[_0x3a5d4f(0x155)]())[_0x3a5d4f(0x133)](-0x2),_0xe4cdd6=('0'+(_0x1287cc[_0x3a5d4f(0x1c8)]()+0x1))[_0x3a5d4f(0x133)](-0x2),_0x30e8c7=_0x1287cc[_0x3a5d4f(0x1f0)](),_0x3d4e98=_0x30e8c7+'-'+_0xe4cdd6+'-'+_0x586c18;if(_0x20eb15[0x0]['language']=='English\x20(US)'){var _0x5c588e=users[_0x3a5d4f(0x165)];console[_0x3a5d4f(0x156)](_0x5c588e);}else{if(_0x20eb15[0x0][_0x3a5d4f(0x140)]=='Hindi')var _0x5c588e=users[_0x3a5d4f(0x12e)];else{if(_0x20eb15[0x0][_0x3a5d4f(0x140)]==_0x3a5d4f(0x14c))var _0x5c588e=users[_0x3a5d4f(0x14c)];else{if(_0x20eb15[0x0][_0x3a5d4f(0x140)]==_0x3a5d4f(0x205))var _0x5c588e=users[_0x3a5d4f(0x205)];else{if(_0x20eb15[0x0][_0x3a5d4f(0x140)]==_0x3a5d4f(0x147))var _0x5c588e=users[_0x3a5d4f(0x147)];else{if(_0x20eb15[0x0][_0x3a5d4f(0x140)]==_0x3a5d4f(0x17a))var _0x5c588e=users[_0x3a5d4f(0x19e)];else{if(_0x20eb15[0x0][_0x3a5d4f(0x140)]==_0x3a5d4f(0x187))var _0x5c588e=users[_0x3a5d4f(0x187)];else{if(_0x20eb15[0x0][_0x3a5d4f(0x140)]==_0x3a5d4f(0x1ae))var _0x5c588e=users['Arabic'];}}}}}}}_0x2f9275[_0x3a5d4f(0x143)]('edit_purchases_finished',{'success':_0x5b8e2e[_0x3a5d4f(0x19b)](_0x3a5d4f(0x160)),'errors':_0x5b8e2e['flash'](_0x3a5d4f(0x11b)),'role':_0x4a37ef,'profile':_0x5e1d63,'purchases':_0x404f16,'suppliers':_0x8af560,'warehouse':_0x5e1267,'product':_0x1cc18f,'master_shop':_0x20eb15,'language':_0x5c588e,'ed_fullDate':_0x3d4e98,'dataSelected':_0x33a6b2});}catch(_0x41d3da){console[_0x3a5d4f(0x156)](_0x41d3da);}}),router[a0_0x2d20ab(0x14b)]('/view/:id',auth,async(_0x524d32,_0x4c44fb)=>{var _0x2c1dfe=a0_0x2d20ab;try{const _0x5ef266=_0x524d32['params']['id'],_0x2176a7=await purchases_finished[_0x2c1dfe(0x12f)]({'_id':_0x524d32[_0x2c1dfe(0x118)]['id']}),_0x4e22a1=await warehouse[_0x2c1dfe(0x12f)]({'name':_0x2176a7['warehouse_name'],'room':_0x2176a7['room']});_0x2176a7['product']['forEach'](_0xcc35d5=>{var _0x163153=_0x2c1dfe;const _0x1f5f38=_0x4e22a1[_0x163153(0x17b)][_0x163153(0x1c4)](_0x12a898=>{var _0x185ef0=_0x163153;_0x12a898[_0x185ef0(0x1da)]==_0xcc35d5[_0x185ef0(0x1da)]&&_0x12a898[_0x185ef0(0x15f)]==_0xcc35d5[_0x185ef0(0x15f)]&&(_0x12a898['product_stock']=parseInt(_0x12a898[_0x185ef0(0x144)])-parseInt(_0xcc35d5[_0x185ef0(0x129)]));});}),await _0x4e22a1[_0x2c1dfe(0x12d)]();const {invoice:_0x55583b,suppliers:_0x2ce3e0,date:_0xa7ffa0,warehouse_name:_0x16c2ac,prod_name:_0x51b8d2,prod_code:_0x40ef9c,prod_qty:_0x54f81d,prod_unit:_0x59b1d3,prod_secondunit:_0x54e6e3,prod_level:_0x69e24a,prod_isle:_0xbb2453,prod_pallet:_0x152ac1,note:_0x3e8b2b,expiry_date:_0x290537,batch_code:_0x3a1538,paid_amount:_0x1447a6,due_amount:_0x20992e,Room_name:_0x46b898,primary_code:_0x4e5c32,secondary_code:_0x58a341,PO_number:_0x554472,JO_number:_0x4f8861}=_0x524d32[_0x2c1dfe(0x1f5)];if(typeof _0x51b8d2==_0x2c1dfe(0x1a3))var _0x242bad=[_0x524d32['body'][_0x2c1dfe(0x171)]],_0x17a983=[_0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x1ea)]],_0x3cdb76=[_0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x1af)]],_0x55e2c4=[_0x524d32['body'][_0x2c1dfe(0x20e)]],_0x391d65=[_0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x183)]],_0x235349=[_0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x12c)]],_0x25eee4=[_0x524d32[_0x2c1dfe(0x1f5)]['primary_code']],_0x45379b=[_0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x1dd)]],_0x1549cd=[_0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x142)]],_0xd54025=[_0x524d32['body'][_0x2c1dfe(0x177)]],_0x577df4=[_0x524d32[_0x2c1dfe(0x1f5)]['expiry_date']];else var _0x242bad=[..._0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x171)]],_0x17a983=[..._0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x1ea)]],_0x3cdb76=[..._0x524d32[_0x2c1dfe(0x1f5)]['prod_qty']],_0x55e2c4=[..._0x524d32[_0x2c1dfe(0x1f5)]['prod_unit']],_0x391d65=[..._0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x183)]],_0x235349=[..._0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x12c)]],_0x25eee4=[..._0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x1f9)]],_0x45379b=[..._0x524d32[_0x2c1dfe(0x1f5)]['secondary_code']],_0x1549cd=[..._0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x142)]],_0xd54025=[..._0x524d32[_0x2c1dfe(0x1f5)]['batch_code']],_0x577df4=[..._0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x1ad)]];const _0x21fda1=_0x242bad['map'](_0x23a69d=>{return _0x23a69d={'product_name':_0x23a69d};});_0x17a983[_0x2c1dfe(0x203)]((_0xfab536,_0x44654e)=>{var _0x5bb310=_0x2c1dfe;_0x21fda1[_0x44654e][_0x5bb310(0x1e0)]=_0xfab536;}),_0x3cdb76[_0x2c1dfe(0x203)]((_0x130f21,_0x342d45)=>{var _0x52f759=_0x2c1dfe;_0x21fda1[_0x342d45][_0x52f759(0x129)]=_0x130f21;}),_0x55e2c4[_0x2c1dfe(0x203)]((_0x27516f,_0x1aea71)=>{var _0x2f0223=_0x2c1dfe;_0x21fda1[_0x1aea71][_0x2f0223(0x131)]=_0x27516f;}),_0x391d65[_0x2c1dfe(0x203)]((_0x2d4405,_0x383573)=>{var _0x14bc82=_0x2c1dfe;_0x21fda1[_0x383573][_0x14bc82(0x17e)]=_0x2d4405;}),_0x235349['forEach']((_0x383d02,_0x3db07f)=>{var _0x35843a=_0x2c1dfe;_0x21fda1[_0x3db07f][_0x35843a(0x15f)]=_0x383d02;}),_0x25eee4[_0x2c1dfe(0x203)]((_0x53f42f,_0x47029f)=>{var _0x46c444=_0x2c1dfe;_0x21fda1[_0x47029f][_0x46c444(0x1f9)]=_0x53f42f;}),_0x45379b[_0x2c1dfe(0x203)]((_0x5db088,_0x12c739)=>{var _0x34cd94=_0x2c1dfe;_0x21fda1[_0x12c739][_0x34cd94(0x1dd)]=_0x5db088;}),_0x1549cd['forEach']((_0x35052f,_0x562508)=>{var _0x263aa4=_0x2c1dfe;_0x21fda1[_0x562508][_0x263aa4(0x1f6)]=_0x35052f;}),_0xd54025['forEach']((_0x48a650,_0x151d1e)=>{var _0x4f9a95=_0x2c1dfe;_0x21fda1[_0x151d1e][_0x4f9a95(0x177)]=_0x48a650;}),_0x577df4[_0x2c1dfe(0x203)]((_0x20d039,_0x1c38a2)=>{var _0x59061a=_0x2c1dfe;_0x21fda1[_0x1c38a2][_0x59061a(0x1ad)]=_0x20d039;});const _0x4f93a9=_0x21fda1[_0x2c1dfe(0x126)](_0x1d60e5=>_0x1d60e5[_0x2c1dfe(0x129)]!=='0'&&_0x1d60e5['quantity']!=='');_0x2176a7[_0x2c1dfe(0x1db)]=_0x55583b,_0x2176a7[_0x2c1dfe(0x1fb)]=_0x2ce3e0,_0x2176a7['date']=_0xa7ffa0,_0x2176a7[_0x2c1dfe(0x1d3)]=_0x16c2ac,_0x2176a7['product']=_0x4f93a9,_0x2176a7[_0x2c1dfe(0x18e)]=_0x3e8b2b,_0x2176a7[_0x2c1dfe(0x209)]=_0x1447a6,_0x2176a7[_0x2c1dfe(0x1f8)]=_0x20992e,_0x2176a7[_0x2c1dfe(0x1f3)]=_0x46b898,_0x2176a7['POnumber']=_0x554472,_0x2176a7[_0x2c1dfe(0x172)]=_0x4f8861;const _0x34e6c0=await _0x2176a7['save'](),_0x751ee1=await warehouse[_0x2c1dfe(0x12f)]({'name':_0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x1d3)],'room':_0x524d32[_0x2c1dfe(0x1f5)]['Room_name']});_0x2176a7[_0x2c1dfe(0x14f)][_0x2c1dfe(0x203)](_0x57b68f=>{var _0x745a30=_0x2c1dfe,_0x368d50=0x0;const _0xccfcb2=_0x751ee1[_0x745a30(0x17b)]['map'](_0x337941=>{var _0x4ab1dc=_0x745a30;_0x337941['product_name']==_0x57b68f['product_name']&&_0x337941['bay']==_0x57b68f['bay']&&(_0x337941[_0x4ab1dc(0x144)]=parseInt(_0x337941[_0x4ab1dc(0x144)])+parseInt(_0x57b68f[_0x4ab1dc(0x129)]),_0x368d50++);});_0x368d50=='0'&&(_0x751ee1[_0x745a30(0x17b)]=_0x751ee1[_0x745a30(0x17b)][_0x745a30(0x1b0)]({'product_name':_0x57b68f[_0x745a30(0x1da)],'product_stock':_0x57b68f[_0x745a30(0x129)],'primary_code':_0x57b68f[_0x745a30(0x1f9)],'secondary_code':_0x57b68f['secondary_code'],'product_code':_0x57b68f[_0x745a30(0x1e0)],'bay':_0x57b68f[_0x745a30(0x15f)],'maxProducts':_0x57b68f[_0x745a30(0x1f6)],'unit':_0x57b68f[_0x745a30(0x131)],'secondary_unit':_0x57b68f[_0x745a30(0x17e)],'expiry_date':_0x57b68f[_0x745a30(0x1ad)]}));}),await _0x751ee1['save']();const _0x2b441b=await s_payment_data[_0x2c1dfe(0x12f)]({'invoice':_0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x1db)]});if(_0x2b441b===null){}else console['log'](_0x2c1dfe(0x1fb),_0x2b441b,_0x524d32[_0x2c1dfe(0x1f5)][_0x2c1dfe(0x1db)]),_0x2b441b['suppliers']=_0x524d32['body'][_0x2c1dfe(0x1fb)],await _0x2b441b[_0x2c1dfe(0x12d)]();_0x524d32['flash']('success',_0x2c1dfe(0x18a)),_0x4c44fb['redirect'](_0x2c1dfe(0x150));}catch(_0x4f3907){console[_0x2c1dfe(0x156)](_0x4f3907);}}),router[a0_0x2d20ab(0x14b)]('/give_payment/:id',auth,async(_0x21a0d7,_0x59c736)=>{var _0x5bfb86=a0_0x2d20ab;try{const _0x5087ab=_0x21a0d7[_0x5bfb86(0x118)]['id'],{invoice:_0x4776f3,suppliers:_0x264fbb,payable:_0x4a123a,due_amount:_0x215c30}=_0x21a0d7[_0x5bfb86(0x1f5)],_0x4a87f3=await purchases[_0x5bfb86(0x120)](_0x5087ab);var _0x26846d=_0x4a123a-_0x215c30;_0x4a87f3['paid_amount']=parseFloat(_0x4a87f3[_0x5bfb86(0x209)])+parseFloat(_0x215c30),_0x4a87f3[_0x5bfb86(0x1f8)]=_0x26846d;const _0x3d55e4=await _0x4a87f3[_0x5bfb86(0x12d)]();console[_0x5bfb86(0x156)](_0x3d55e4);const _0xe1b606=await s_payment_data[_0x5bfb86(0x12f)]({'invoice':_0x4776f3});_0xe1b606[_0x5bfb86(0x153)]=_0x26846d,await _0xe1b606[_0x5bfb86(0x12d)]();let _0x4272ae=new Date(),_0xb68019=('0'+_0x4272ae[_0x5bfb86(0x155)]())[_0x5bfb86(0x133)](-0x2),_0x392d49=('0'+(_0x4272ae[_0x5bfb86(0x1c8)]()+0x1))[_0x5bfb86(0x133)](-0x2),_0x331a31=_0x4272ae[_0x5bfb86(0x1f0)](),_0xb571ba=_0x331a31+'-'+_0x392d49+'-'+_0xb68019;const _0x1919c9=new suppliers_payment({'invoice':_0x4776f3,'date':_0x331a31+'-'+_0x392d49+'-'+_0xb68019,'suppliers':_0x264fbb,'reason':'Paid\x20For\x20Purchase','amount':_0x215c30}),_0x374f01=await _0x1919c9[_0x5bfb86(0x12d)]();_0x21a0d7[_0x5bfb86(0x19b)](_0x5bfb86(0x160),_0x5bfb86(0x14a)),_0x59c736[_0x5bfb86(0x127)]('/all_purchases/view');}catch(_0x51061d){console['log'](_0x51061d);}}),router[a0_0x2d20ab(0x13f)](a0_0x2d20ab(0x206),auth,async(_0x45ceb3,_0x29a558)=>{var _0x51c769=a0_0x2d20ab;try{const {username:_0x43d418,email:_0x31aa7e,role:_0xd8509a}=_0x45ceb3[_0x51c769(0x1f1)],_0x5b0581=_0x45ceb3['user'],_0xf30d04=await profile[_0x51c769(0x12f)]({'email':_0x5b0581[_0x51c769(0x141)]}),_0x2ff1ca=await master_shop['find']();console['log'](_0x51c769(0x15b),_0x2ff1ca);const _0x30022a=_0x45ceb3[_0x51c769(0x118)]['id'],_0x42bbdc=await purchases[_0x51c769(0x120)](_0x30022a);console[_0x51c769(0x156)](_0x42bbdc);const _0x5947be=await suppliers[_0x51c769(0x12f)]({'name':_0x42bbdc[_0x51c769(0x1fb)]});console['log'](_0x5947be);if(_0x2ff1ca[0x0][_0x51c769(0x140)]==_0x51c769(0x1ec)){var _0x1d378c=users[_0x51c769(0x165)];console[_0x51c769(0x156)](_0x1d378c);}else{if(_0x2ff1ca[0x0][_0x51c769(0x140)]=='Hindi')var _0x1d378c=users[_0x51c769(0x12e)];else{if(_0x2ff1ca[0x0][_0x51c769(0x140)]==_0x51c769(0x14c))var _0x1d378c=users[_0x51c769(0x14c)];else{if(_0x2ff1ca[0x0][_0x51c769(0x140)]==_0x51c769(0x205))var _0x1d378c=users[_0x51c769(0x205)];else{if(_0x2ff1ca[0x0][_0x51c769(0x140)]==_0x51c769(0x147))var _0x1d378c=users[_0x51c769(0x147)];else{if(_0x2ff1ca[0x0][_0x51c769(0x140)]==_0x51c769(0x17a))var _0x1d378c=users['Portuguese'];else{if(_0x2ff1ca[0x0]['language']==_0x51c769(0x187))var _0x1d378c=users[_0x51c769(0x187)];else{if(_0x2ff1ca[0x0][_0x51c769(0x140)]==_0x51c769(0x1ae))var _0x1d378c=users[_0x51c769(0x1df)];}}}}}}}_0x29a558[_0x51c769(0x143)](_0x51c769(0x12a),{'success':_0x45ceb3[_0x51c769(0x19b)](_0x51c769(0x160)),'errors':_0x45ceb3[_0x51c769(0x19b)](_0x51c769(0x11b)),'role':_0x5b0581,'profile':_0xf30d04,'master_shop':_0x2ff1ca,'supplier':_0x5947be,'purchase':_0x42bbdc,'language':_0x1d378c});}catch(_0x318dd3){console['log'](_0x318dd3);}}),router[a0_0x2d20ab(0x13f)](a0_0x2d20ab(0x123),auth,async(_0x61969d,_0x236c2b)=>{var _0x46e8fd=a0_0x2d20ab;try{const {username:_0x47baff,email:_0x6758ff,role:_0x25b5ae}=_0x61969d[_0x46e8fd(0x1f1)],_0x303b05=_0x61969d['user'],_0x31c24b=await profile[_0x46e8fd(0x12f)]({'email':_0x303b05[_0x46e8fd(0x141)]}),_0x455c7b=await master_shop[_0x46e8fd(0x1a5)]();console[_0x46e8fd(0x156)](_0x46e8fd(0x15b),_0x455c7b);const _0x15a3d2=_0x61969d[_0x46e8fd(0x118)]['id'];console['log'](_0x15a3d2);const _0x1ae806=await purchases_finished[_0x46e8fd(0x120)](_0x15a3d2);console['log'](_0x46e8fd(0x1b7),_0x1ae806);const _0x3d420b=await product[_0x46e8fd(0x1a5)]({}),_0x22cc71=await warehouse[_0x46e8fd(0x194)]([{'$match':{'name':_0x1ae806[_0x46e8fd(0x1d3)],'room':_0x1ae806['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x46e8fd(0x122),'name':{'$first':_0x46e8fd(0x1ee)},'product_stock':{'$first':_0x46e8fd(0x1f4)},'bay':{'$first':_0x46e8fd(0x20c)},'bin':{'$first':_0x46e8fd(0x188)},'type':{'$first':_0x46e8fd(0x201)},'floorlevel':{'$first':_0x46e8fd(0x199)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x46e8fd(0x1ba)},'product_code':{'$first':_0x46e8fd(0x11c)},'storage':{'$first':_0x46e8fd(0x190)},'rack':{'$first':_0x46e8fd(0x13c)}}}]);console[_0x46e8fd(0x156)](_0x46e8fd(0x1a4),_0x22cc71);let _0x198cb4;if(_0x303b05[_0x46e8fd(0x16d)]==_0x46e8fd(0x167)){const _0x331ddf=await staff['findOne']({'email':_0x303b05['email']});_0x198cb4=await warehouse[_0x46e8fd(0x1a5)]({'status':_0x46e8fd(0x1cc),'name':_0x331ddf[_0x46e8fd(0x157)],'warehouse_category':'Finished\x20Goods','name':_0x46e8fd(0x176)});}else _0x198cb4=await warehouse[_0x46e8fd(0x194)]([{'$match':{'status':_0x46e8fd(0x1cc),'warehouse_category':'Finished\x20Goods','name':_0x46e8fd(0x176)}},{'$group':{'_id':_0x46e8fd(0x1bf),'name':{'$first':_0x46e8fd(0x1bf)}}}]);if(_0x455c7b[0x0][_0x46e8fd(0x140)]==_0x46e8fd(0x1ec)){var _0x695bdb=users[_0x46e8fd(0x165)];console[_0x46e8fd(0x156)](_0x695bdb);}else{if(_0x455c7b[0x0][_0x46e8fd(0x140)]==_0x46e8fd(0x12e))var _0x695bdb=users[_0x46e8fd(0x12e)];else{if(_0x455c7b[0x0]['language']=='German')var _0x695bdb=users[_0x46e8fd(0x14c)];else{if(_0x455c7b[0x0]['language']==_0x46e8fd(0x205))var _0x695bdb=users['Spanish'];else{if(_0x455c7b[0x0][_0x46e8fd(0x140)]==_0x46e8fd(0x147))var _0x695bdb=users['French'];else{if(_0x455c7b[0x0]['language']==_0x46e8fd(0x17a))var _0x695bdb=users[_0x46e8fd(0x19e)];else{if(_0x455c7b[0x0][_0x46e8fd(0x140)]=='Chinese')var _0x695bdb=users[_0x46e8fd(0x187)];else{if(_0x455c7b[0x0]['language']==_0x46e8fd(0x1ae))var _0x695bdb=users[_0x46e8fd(0x1df)];}}}}}}}_0x236c2b[_0x46e8fd(0x143)](_0x46e8fd(0x16b),{'success':_0x61969d['flash'](_0x46e8fd(0x160)),'errors':_0x61969d[_0x46e8fd(0x19b)]('errors'),'role':_0x303b05,'profile':_0x31c24b,'user':_0x1ae806,'stock':_0x22cc71,'master_shop':_0x455c7b,'product':_0x3d420b,'language':_0x695bdb,'warehouse':_0x198cb4});}catch(_0x3f5b78){console[_0x46e8fd(0x156)](_0x3f5b78);}}),router[a0_0x2d20ab(0x14b)](a0_0x2d20ab(0x123),auth,async(_0x204c60,_0x5a7e4c)=>{var _0x44f978=a0_0x2d20ab;try{const {invoice:_0x3ced42,date:_0x3b4f8e,warehouse_name:_0x19bea4,Room_name:_0x47ef19,product_name:_0x412813,purchase_quantity:_0xace6a9,stocks:_0x5a1e5a,return_qty:_0x34ded0,note:_0x3861d2,level:_0x35d773,isle:_0x2fe7ec,pallet:_0x314a35,to_warehouse_name:_0x1129dd,to_Room_name:_0xd59201}=_0x204c60[_0x44f978(0x1f5)],_0x26f9a6=await purchases_finished['findOne']({'_id':_0x204c60[_0x44f978(0x118)]['id']}),_0xa0e60d=await warehouse[_0x44f978(0x12f)]({'name':_0x19bea4,'room':_0x47ef19,'warehouse_category':_0x44f978(0x1ab)});if(typeof _0x412813==_0x44f978(0x1a3))var _0x221d93=[_0x204c60['body'][_0x44f978(0x1da)]],_0x352c80=[_0x204c60[_0x44f978(0x1f5)]['purchase_quantity']],_0x39c8b8=[_0x204c60['body'][_0x44f978(0x1bb)]],_0xefdd1b=[_0x204c60[_0x44f978(0x1f5)][_0x44f978(0x12b)]],_0x148e68=[_0x204c60[_0x44f978(0x1f5)][_0x44f978(0x1b1)]],_0x19b4e1=[_0x204c60[_0x44f978(0x1f5)]['product_code_hide']],_0x145af3=[_0x204c60[_0x44f978(0x1f5)][_0x44f978(0x19d)]],_0x491d0d=[_0x204c60[_0x44f978(0x1f5)][_0x44f978(0x1a0)]];else var _0x221d93=[..._0x204c60[_0x44f978(0x1f5)]['product_name']],_0x352c80=[..._0x204c60[_0x44f978(0x1f5)][_0x44f978(0x11a)]],_0x39c8b8=[..._0x204c60[_0x44f978(0x1f5)][_0x44f978(0x1bb)]],_0xefdd1b=[..._0x204c60[_0x44f978(0x1f5)][_0x44f978(0x12b)]],_0x148e68=[..._0x204c60['body']['level']],_0x19b4e1=[..._0x204c60[_0x44f978(0x1f5)][_0x44f978(0x1ce)]],_0x145af3=[..._0x204c60[_0x44f978(0x1f5)][_0x44f978(0x19d)]],_0x491d0d=[..._0x204c60[_0x44f978(0x1f5)][_0x44f978(0x1a0)]];const _0x441c89=_0x221d93[_0x44f978(0x1c4)](_0x53db56=>{return _0x53db56={'product_name':_0x53db56};});_0x352c80['forEach']((_0x2bc32f,_0x512702)=>{var _0x517104=_0x44f978;_0x441c89[_0x512702][_0x517104(0x11a)]=_0x2bc32f;}),_0x39c8b8[_0x44f978(0x203)]((_0x452f31,_0x163802)=>{var _0x5a5500=_0x44f978;_0x441c89[_0x163802][_0x5a5500(0x20a)]=_0x452f31;}),_0xefdd1b[_0x44f978(0x203)]((_0x2561d1,_0x5ce46c)=>{_0x441c89[_0x5ce46c]['return_qty']=_0x2561d1;}),_0x148e68[_0x44f978(0x203)]((_0x577352,_0x499a65)=>{var _0x8c3a5e=_0x44f978;_0x441c89[_0x499a65][_0x8c3a5e(0x15f)]=_0x577352;}),_0x19b4e1[_0x44f978(0x203)]((_0x5781ac,_0x399ffd)=>{var _0x263318=_0x44f978;_0x441c89[_0x399ffd][_0x263318(0x1e0)]=_0x5781ac;}),_0x145af3[_0x44f978(0x203)]((_0x79680f,_0x5319d5)=>{var _0xbca0c5=_0x44f978;_0x441c89[_0x5319d5][_0xbca0c5(0x1f9)]=_0x79680f;}),_0x491d0d[_0x44f978(0x203)]((_0x1aaf6b,_0x17fcc4)=>{var _0x5665c9=_0x44f978;_0x441c89[_0x17fcc4][_0x5665c9(0x1dd)]=_0x1aaf6b;}),_0x441c89[_0x44f978(0x203)](_0x3dfddf=>{var _0x3235e4=_0x44f978;console['log'](_0x3dfddf);const _0x377a6f=_0xa0e60d[_0x3235e4(0x17b)]['map'](_0x77a624=>{var _0x4bc971=_0x3235e4;_0x77a624['product_name']==_0x3dfddf[_0x4bc971(0x1da)]&&_0x77a624[_0x4bc971(0x15f)]==_0x3dfddf[_0x4bc971(0x15f)]&&(console[_0x4bc971(0x156)](parseInt(_0x77a624[_0x4bc971(0x144)])+_0x4bc971(0x1b2)+parseInt(_0x3dfddf[_0x4bc971(0x12b)])),_0x77a624[_0x4bc971(0x144)]=parseInt(_0x77a624['product_stock'])-parseInt(_0x3dfddf[_0x4bc971(0x12b)]));});}),await _0xa0e60d[_0x44f978(0x12d)]();var _0x116f53=0x0;_0x441c89[_0x44f978(0x203)](_0x8631d8=>{var _0x5d6240=_0x44f978;(parseInt(_0x8631d8[_0x5d6240(0x11a)])<parseInt(_0x8631d8[_0x5d6240(0x12b)])||parseInt(_0x8631d8[_0x5d6240(0x20a)])<parseInt(_0x8631d8[_0x5d6240(0x12b)]))&&_0x116f53++;});if(_0x116f53!=0x0)return _0x204c60[_0x44f978(0x19b)](_0x44f978(0x11b),_0x44f978(0x1fa)),_0x5a7e4c['redirect'](_0x44f978(0x17c));const _0x1ac402=new purchases_return_finished({'invoice':_0x3ced42,'suppliers':_0x204c60[_0x44f978(0x1f5)][_0x44f978(0x1fb)],'date':_0x3b4f8e,'warehouse_name':_0x19bea4,'return_product':_0x441c89,'note':_0x3861d2,'room':_0x47ef19,'to_warehouse_name':_0x1129dd,'to_room':_0xd59201}),_0x5b96f2=await _0x1ac402[_0x44f978(0x12d)](),_0x21643e=await purchases_return_finished[_0x44f978(0x12f)]({'invoice':_0x3ced42}),_0x2dceba=await warehouse[_0x44f978(0x12f)]({'name':_0x1129dd,'room':_0xd59201,'warehouse_category':_0x44f978(0x1ab)});_0x21643e[_0x44f978(0x166)]['forEach'](_0x5a51a0=>{var _0x1b3747=_0x44f978,_0x2c2977=0x0;const _0x38ce30=_0x2dceba[_0x1b3747(0x17b)]['map'](_0x55fbb5=>{var _0x51b91c=_0x1b3747;console[_0x51b91c(0x156)](_0x55fbb5['product_name']+'=='+_0x5a51a0[_0x51b91c(0x1da)]+'&&'+_0x55fbb5[_0x51b91c(0x15f)]+'=='+_0x5a51a0['bay']),_0x55fbb5[_0x51b91c(0x1da)]==_0x5a51a0[_0x51b91c(0x1da)]&&_0x55fbb5[_0x51b91c(0x15f)]==_0x5a51a0['bay']&&(_0x55fbb5[_0x51b91c(0x144)]=parseInt(_0x55fbb5['product_stock'])-parseInt(_0x5a51a0[_0x51b91c(0x12b)]),_0x2c2977++);});_0x2c2977=='0'&&(_0x2dceba[_0x1b3747(0x17b)]=_0x2dceba[_0x1b3747(0x17b)][_0x1b3747(0x1b0)]({'product_name':_0x5a51a0[_0x1b3747(0x1da)],'product_stock':_0x5a51a0[_0x1b3747(0x12b)],'primary_code':_0x5a51a0[_0x1b3747(0x1f9)],'secondary_code':_0x5a51a0['secondary_code'],'product_code':_0x5a51a0[_0x1b3747(0x1e0)],'bay':_0x5a51a0[_0x1b3747(0x15f)],'maxProducts':0xf423f}));}),await _0x2dceba['save']();const _0x4e9025=await purchases_finished[_0x44f978(0x12f)]({'invoice':_0x3ced42});_0x4e9025[_0x44f978(0x1e6)]=_0x44f978(0x178);const _0x5de3f2=await _0x4e9025[_0x44f978(0x12d)](),_0x1c5012=new s_payment_data({'invoice':_0x3ced42,'suppliers':_0x204c60[_0x44f978(0x1f5)][_0x44f978(0x1fb)],'reason':_0x44f978(0x18f)});await _0x1c5012[_0x44f978(0x12d)]();const _0x43c94c=await master_shop[_0x44f978(0x1a5)](),_0xf94c22=await email_settings[_0x44f978(0x12f)](),_0x1f8adc=await suppliers[_0x44f978(0x12f)]({'name':_0x204c60[_0x44f978(0x1f5)][_0x44f978(0x1fb)]});_0x43c94c[0x0]['currency_placement']==0x1?(right_currency=_0x43c94c[0x0][_0x44f978(0x1cb)],left_currency=''):(right_currency='',left_currency=_0x43c94c[0x0][_0x44f978(0x1cb)]);var _0x2ced14=_0x221d93,_0x3ed6ed=_0xefdd1b,_0x3ee862='',_0xca75a7;for(_0xca75a7 in _0x2ced14){_0x3ee862+=_0x44f978(0x189)+_0x44f978(0x175)+_0x2ced14[_0xca75a7]+_0x44f978(0x185)+_0x44f978(0x175)+_0x3ed6ed[_0xca75a7]+_0x44f978(0x185)+_0x44f978(0x1de);}let _0x1f859b=nodemailer[_0x44f978(0x164)]({'service':'gmail','auth':{'user':_0xf94c22[_0x44f978(0x141)],'pass':_0xf94c22[_0x44f978(0x162)]}}),_0x1234ed={'from':_0xf94c22['email'],'to':_0x1f8adc[_0x44f978(0x141)],'subject':_0x44f978(0x173),'attachments':[{'filename':_0x44f978(0x195),'path':__dirname+_0x44f978(0x128)+_0x44f978(0x1a6)+_0x43c94c[0x0][_0x44f978(0x125)],'cid':_0x44f978(0x121)}],'html':_0x44f978(0x1fd)+'<html><head><title></title>'+_0x44f978(0x16e)+_0x44f978(0x169)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x44f978(0x169)+_0x44f978(0x139)+_0x44f978(0x134)+_0x44f978(0x169)+_0x44f978(0x151)+_0x43c94c[0x0][_0x44f978(0x124)]+_0x44f978(0x13b)+_0x44f978(0x134)+_0x44f978(0x134)+_0x44f978(0x1e4)+_0x44f978(0x169)+_0x44f978(0x17d)+'\x20Order\x20Number\x20:\x20'+_0x3ced42+'\x20'+_0x44f978(0x1c9)+_0x44f978(0x1d9)+_0x3b4f8e+'\x20'+_0x44f978(0x15a)+_0x44f978(0x204)+'</div>'+_0x44f978(0x149)+_0x44f978(0x152)+_0x44f978(0x189)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x44f978(0x11f)+_0x44f978(0x1cf)+_0x44f978(0x16c)+_0x44f978(0x1de)+_0x44f978(0x1ef)+_0x44f978(0x198)+'\x20'+_0x3ee862+'\x20'+'</tbody>'+_0x44f978(0x19c)+_0x44f978(0x169)+_0x44f978(0x197)+_0x44f978(0x16a)+_0x43c94c[0x0][_0x44f978(0x124)]+_0x44f978(0x204)+_0x44f978(0x134)+_0x44f978(0x134)+_0x44f978(0x1b3)};_0x1f859b['sendMail'](_0x1234ed,function(_0x4c93ae,_0x3e9740){var _0x5bb4dc=_0x44f978;_0x4c93ae?console[_0x5bb4dc(0x156)]('Error\x20Occurs'):console[_0x5bb4dc(0x156)](_0x5bb4dc(0x1bc));}),_0x204c60[_0x44f978(0x19b)](_0x44f978(0x160),_0x44f978(0x1b6)),_0x5a7e4c[_0x44f978(0x127)](_0x44f978(0x150));}catch(_0x3f52a7){_0x5a7e4c[_0x44f978(0x1f7)](0xc8)[_0x44f978(0x1b9)]({'message':_0x3f52a7[_0x44f978(0x1a1)]});}}),router[a0_0x2d20ab(0x13f)](a0_0x2d20ab(0x1a2),auth,async(_0x5c8a74,_0x4e72d8)=>{var _0x68e592=a0_0x2d20ab;try{const {username:_0x1d6272,email:_0x447ef9,role:_0x5a9db3}=_0x5c8a74[_0x68e592(0x1f1)],_0x51e6da=_0x5c8a74[_0x68e592(0x1f1)],_0xf3be7b=await profile['findOne']({'email':_0x51e6da[_0x68e592(0x141)]}),_0x3d539b=await master_shop[_0x68e592(0x1a5)](),_0xc3d90=_0x5c8a74[_0x68e592(0x118)]['id'],_0xcf6cdc=await purchases_finished[_0x68e592(0x120)](_0xc3d90);if(_0x3d539b[0x0][_0x68e592(0x140)]==_0x68e592(0x1ec))var _0x4c20b8=users[_0x68e592(0x165)];else{if(_0x3d539b[0x0][_0x68e592(0x140)]=='Hindi')var _0x4c20b8=users[_0x68e592(0x12e)];else{if(_0x3d539b[0x0]['language']=='German')var _0x4c20b8=users[_0x68e592(0x14c)];else{if(_0x3d539b[0x0][_0x68e592(0x140)]==_0x68e592(0x205))var _0x4c20b8=users[_0x68e592(0x205)];else{if(_0x3d539b[0x0][_0x68e592(0x140)]=='French')var _0x4c20b8=users[_0x68e592(0x147)];else{if(_0x3d539b[0x0][_0x68e592(0x140)]==_0x68e592(0x17a))var _0x4c20b8=users[_0x68e592(0x19e)];else{if(_0x3d539b[0x0][_0x68e592(0x140)]==_0x68e592(0x187))var _0x4c20b8=users[_0x68e592(0x187)];else{if(_0x3d539b[0x0]['language']==_0x68e592(0x1ae))var _0x4c20b8=users['Arabic'];}}}}}}}_0x4e72d8[_0x68e592(0x143)]('all_purchases_barcode',{'success':_0x5c8a74['flash'](_0x68e592(0x160)),'errors':_0x5c8a74[_0x68e592(0x19b)](_0x68e592(0x11b)),'role':_0x51e6da,'profile':_0xf3be7b,'alldata':_0xcf6cdc,'master_shop':_0x3d539b,'language':_0x4c20b8}),console[_0x68e592(0x156)](alldata);}catch(_0x4f0714){console[_0x68e592(0x156)](_0x4f0714);}}),router[a0_0x2d20ab(0x14b)](a0_0x2d20ab(0x1e8),async(_0x594003,_0x2559e9)=>{var _0x23ad9d=a0_0x2d20ab;const {product_code:_0x4a525e}=_0x594003[_0x23ad9d(0x1f5)];var _0x10aa58;const _0x360261=await product[_0x23ad9d(0x194)]([{'$match':{'primary_code':_0x4a525e,'product_category':_0x23ad9d(0x1ab)}},{'$group':{'_id':_0x23ad9d(0x19f),'name':{'$first':_0x23ad9d(0x1bf)},'category':{'$first':_0x23ad9d(0x1bd)},'brand':{'$first':_0x23ad9d(0x119)},'unit':{'$first':_0x23ad9d(0x1aa)},'alertquantity':{'$first':_0x23ad9d(0x1fe)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x23ad9d(0x137)},'secondary_code':{'$first':_0x23ad9d(0x202)},'maxStocks':{'$first':_0x23ad9d(0x193)},'maxProdPerUnit':{'$first':_0x23ad9d(0x1d8)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x23ad9d(0x1e7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1c55b0=await product[_0x23ad9d(0x194)]([{'$match':{'secondary_code':_0x4a525e}},{'$group':{'_id':_0x23ad9d(0x19f),'name':{'$first':_0x23ad9d(0x1bf)},'category':{'$first':_0x23ad9d(0x1bd)},'brand':{'$first':'$brand'},'unit':{'$first':_0x23ad9d(0x1aa)},'alertquantity':{'$first':_0x23ad9d(0x1fe)},'product_code':{'$first':_0x23ad9d(0x16f)},'primary_code':{'$first':_0x23ad9d(0x137)},'secondary_code':{'$first':_0x23ad9d(0x202)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x23ad9d(0x1d8)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x360261[_0x23ad9d(0x13d)]>0x0)_0x10aa58=_0x360261;else _0x1c55b0[_0x23ad9d(0x13d)]>0x0&&(_0x10aa58=_0x1c55b0);_0x2559e9[_0x23ad9d(0x1b9)](_0x10aa58);}),router['post']('/CheckingWarehouse',async(_0x37f016,_0x552931)=>{var _0x4b9c21=a0_0x2d20ab;const {productCode:_0x5789fc,bay:_0x3e48e7,warehouses:_0x20c373,room:_0x45e8c3}=_0x37f016[_0x4b9c21(0x1f5)];console[_0x4b9c21(0x156)](_0x37f016['body']);try{const _0x44f21e=await warehouse['aggregate']([{'$match':{'name':_0x20c373,'room':_0x45e8c3}},{'$unwind':_0x4b9c21(0x1ca)},{'$match':{'product_details.bay':parseInt(_0x3e48e7)}},{'$group':{'_id':_0x4b9c21(0x122),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4b9c21(0x20c)},'maxProducts':{'$first':_0x4b9c21(0x1d0)}}}]);_0x552931[_0x4b9c21(0x1f7)](0xc8)[_0x4b9c21(0x1b9)](_0x44f21e);}catch(_0x312568){_0x552931[_0x4b9c21(0x1f7)](0x194)[_0x4b9c21(0x1b9)]({'message':_0x312568[_0x4b9c21(0x1a1)]});}}),module[a0_0x2d20ab(0x14e)]=router;