function a0_0x1b6c(_0x256b64,_0x1abe03){var _0x4414de=a0_0x4414();return a0_0x1b6c=function(_0x1b6cce,_0x247fbe){_0x1b6cce=_0x1b6cce-0x18b;var _0x5e1d1e=_0x4414de[_0x1b6cce];return _0x5e1d1e;},a0_0x1b6c(_0x256b64,_0x1abe03);}var a0_0x316e4e=a0_0x1b6c;(function(_0x57321a,_0x1bf921){var _0x282271=a0_0x1b6c,_0x38ebef=_0x57321a();while(!![]){try{var _0x5cffbb=parseInt(_0x282271(0x1a3))/0x1+parseInt(_0x282271(0x1bd))/0x2+-parseInt(_0x282271(0x214))/0x3+parseInt(_0x282271(0x1e0))/0x4*(-parseInt(_0x282271(0x259))/0x5)+parseInt(_0x282271(0x1f5))/0x6*(parseInt(_0x282271(0x27a))/0x7)+-parseInt(_0x282271(0x194))/0x8*(parseInt(_0x282271(0x199))/0x9)+-parseInt(_0x282271(0x1b5))/0xa;if(_0x5cffbb===_0x1bf921)break;else _0x38ebef['push'](_0x38ebef['shift']());}catch(_0x130e0f){_0x38ebef['push'](_0x38ebef['shift']());}}}(a0_0x4414,0x680c7));const express=require(a0_0x316e4e(0x208)),app=express(),router=express[a0_0x316e4e(0x1ce)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x316e4e(0x280)),auth=require(a0_0x316e4e(0x1a8)),nodemailer=require(a0_0x316e4e(0x1a9));var ejs=require('ejs');function a0_0x4414(){var _0x3f227b=['json','../middleware/auth','nodemailer','An\x20error\x20occurred\x20while\x20saving\x20data.','_id','MaxStocks_data','room_name','$suppliers_docs','$_id','prod_primunit','prod_Qty','$primary_code','<tbody\x20style=\x22text-align:\x20center;\x22>','secondary_code_hide','8335740iegwLO','forEach','flash','purchase\x20data\x20add\x20successfully','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','currency','German','1133660VmFdhu','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','</td>','updateOne','../public/language/languages.json','/../public','Purchase\x20Return','$secondary_code','sendMail','$product.type','staff','getDate','level','<h2>\x20','$product_details.rack','$room','return_data','Router','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.product_code','bay','$product_details.maxProducts','<h5\x20style=\x22text-align:\x20left;\x22>','production_date','product_cat','Paid\x20For\x20Purchase','then','Rack\x202','/invoice/:id','<tr>','/view/add_purchases/:id','invoice','Chinese','$unit','body','144aQYscY','<span\x20style=\x22float:\x20right;\x22>','$product.bin','$expiry_date','params','redirect','Arabic\x20(ae)','prod_qty','get','product_name','warehouse','product','<!DOCTYPE\x20html>','post','string','slice','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','payment\x20successfull','amount','return_qty','$batch_code','3493194fmSlOT','concat','$product.quantity','/barcode_scanner','find','/CheckingWarehouse','DRY\x20GOODS','suppliers','primary_code_hide','findById','$suppliers','$date','FGSEmail','port','/view/add_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/all_purchases/view','Logo.png','abs','express','RoomAssign','paid_amount','getFullYear','back','</table>','\x20Order\x20Number\x20:\x20','<div>','standard_unit','room','product_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','837267WkOiEx','table\x20page','name','max_product_unit','product_details','prod_invoice','prod_name','$product_details.floorlevel','/give_payment/:id','$return_data','<h5>','/all_purchases_finished/view','prod_secondunit','date','$product_details._id','Error\x20Occurs','Room_name','batch_code','toString','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.secondary_code','\x20<>\x20','length','$invoice','</tr>','all_purchases_finished','$alertquantity','$product_details.primary_code','/view/return_purchase/:id','log','<strong>\x20Regards\x20</strong>','due_amount','Purchase\x20Mail','\x20Order\x20Date\x20:\x20','prod_code','Return\x20Goods','/barcode/:id','product_date','edit_purchases_finished','save','English\x20(US)','suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','success','secondary_code','user','French','maxStocks','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product.bay','$product_details','path','purchase\x20data\x20update\x20successfully','\x20</h2>','render','</tbody>','Enabled','$brand','$product_details.bin','prod_cat','quantity','catch','site_title','maxperunit','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','purchase_quantity','aggregate','getMonth','FROZEN\x20GOODS','4135jYsgsA','Arabic','$product_details.product_stock','$maxStocks','error','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','email','password','QA\x20Warehouse','status','True','edit_purchases_finished_view','secondary_unit','$name','Purchase\x20Return\x20Mail','prod_level','</h5>','warehouse_name','INCF-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','currency_placement','<hr\x20class=\x22my-3\x22>','/upload/','add_purchases_finished','/view','Hindi','$maxProdPerUnit','Finished\x20Goods','stock_quantity','stocks','</head><body>','$note','$secondary_unit','7ngbJQn','filter','Portuguese','prod_unit','host','purchases\x20item\x20return\x20successfull','../models/all_models','role','image','</span>','$product','findOne','$due_amount','product_code','user_id','$paid_amount','$product_details.product_name','$product.floorlevel','primary_code','map','English','message','Email\x20sent\x20successfully','random','Spanish','6808KwKASh','$category','expiry_date','POnumber','</div>','603LdsODV','Ambient','product_stock','Portuguese\x20(BR)','/view/:id','errors','</thead>','gmail','</body></html>','$product_details.bay','476606GeqQBl','language','$product_code','<html><head><title></title>'];a0_0x4414=function(){return _0x3f227b;};return a0_0x4414();}const path=require(a0_0x316e4e(0x247)),users=require(a0_0x316e4e(0x1c1));router[a0_0x316e4e(0x1e8)](a0_0x316e4e(0x271),auth,async(_0x4a829e,_0x4599bb)=>{var _0x1956e3=a0_0x316e4e;try{const {username:_0x5346e5,email:_0x4197cf,role:_0x37b029}=_0x4a829e[_0x1956e3(0x241)],_0x52423f=_0x4a829e[_0x1956e3(0x241)],_0x56122a=await profile[_0x1956e3(0x285)]({'email':_0x52423f[_0x1956e3(0x25f)]}),_0x5d3aa0=await staff['findOne']({'email':_0x52423f['email']});if(_0x52423f['role']==_0x1956e3(0x1c7)){const _0x5691aa=await staff[_0x1956e3(0x285)]({'email':_0x52423f[_0x1956e3(0x25f)]});}const _0x26ce1d=await master_shop[_0x1956e3(0x1f9)]();let _0xe5aa87;if(_0x52423f['role']==_0x1956e3(0x1c7)){const _0x1cfe69=await staff[_0x1956e3(0x285)]({'email':_0x52423f[_0x1956e3(0x25f)]});_0xe5aa87=await purchases_finished[_0x1956e3(0x256)]([{'$match':{'warehouse_name':_0x1cfe69[_0x1956e3(0x1ea)]}},{'$lookup':{'from':_0x1956e3(0x1fc),'localField':_0x1956e3(0x1fc),'foreignField':_0x1956e3(0x216),'as':_0x1956e3(0x23d)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x1956e3(0x284)},{'$group':{'_id':_0x1956e3(0x1af),'invoice':{'$first':_0x1956e3(0x22b)},'suppliers':{'$first':_0x1956e3(0x1ff)},'date':{'$first':_0x1956e3(0x200)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x1956e3(0x1cc)},'product':{'$push':'$product'},'note':{'$first':_0x1956e3(0x278)},'paid_amount':{'$first':_0x1956e3(0x289)},'due_amount':{'$first':_0x1956e3(0x286)},'return_data':{'$first':_0x1956e3(0x21d)},'batch_code':{'$first':_0x1956e3(0x1f4)},'expiry_date':{'$first':_0x1956e3(0x1e3)},'suppliers_docs':{'$first':_0x1956e3(0x1ae)},'total_product_quantity':{'$sum':_0x1956e3(0x1f7)},'level':{'$addToSet':_0x1956e3(0x245)},'isle':{'$addToSet':_0x1956e3(0x1e2)},'type':{'$addToSet':_0x1956e3(0x1c6)},'floorlevel':{'$addToSet':_0x1956e3(0x18c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xe5aa87=await purchases_finished['aggregate']([{'$unwind':_0x1956e3(0x284)},{'$group':{'_id':_0x1956e3(0x1af),'invoice':{'$first':_0x1956e3(0x22b)},'suppliers':{'$first':_0x1956e3(0x1ff)},'date':{'$first':_0x1956e3(0x200)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x1956e3(0x278)},'paid_amount':{'$first':_0x1956e3(0x289)},'due_amount':{'$first':_0x1956e3(0x286)},'return_data':{'$first':_0x1956e3(0x21d)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x1956e3(0x1e3)},'suppliers_docs':{'$first':_0x1956e3(0x1ae)},'total_product_quantity':{'$sum':_0x1956e3(0x1f7)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x1956e3(0x1e2)},'type':{'$addToSet':_0x1956e3(0x1c6)},'floorlevel':{'$addToSet':_0x1956e3(0x18c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x26ce1d[0x0]['language']==_0x1956e3(0x23c))var _0x279640=users[_0x1956e3(0x18f)];else{if(_0x26ce1d[0x0][_0x1956e3(0x1a4)]==_0x1956e3(0x272))var _0x279640=users[_0x1956e3(0x272)];else{if(_0x26ce1d[0x0]['language']==_0x1956e3(0x1bc))var _0x279640=users[_0x1956e3(0x1bc)];else{if(_0x26ce1d[0x0][_0x1956e3(0x1a4)]==_0x1956e3(0x193))var _0x279640=users[_0x1956e3(0x193)];else{if(_0x26ce1d[0x0]['language']==_0x1956e3(0x242))var _0x279640=users[_0x1956e3(0x242)];else{if(_0x26ce1d[0x0][_0x1956e3(0x1a4)]==_0x1956e3(0x19c))var _0x279640=users[_0x1956e3(0x27c)];else{if(_0x26ce1d[0x0][_0x1956e3(0x1a4)]==_0x1956e3(0x1dd))var _0x279640=users['Chinese'];else{if(_0x26ce1d[0x0]['language']==_0x1956e3(0x1e6))var _0x279640=users[_0x1956e3(0x25a)];}}}}}}}_0x4599bb[_0x1956e3(0x24a)](_0x1956e3(0x22d),{'success':_0x4a829e[_0x1956e3(0x1b7)](_0x1956e3(0x23f)),'errors':_0x4a829e[_0x1956e3(0x1b7)](_0x1956e3(0x19e)),'purchases':_0xe5aa87,'role':_0x52423f,'profile':_0x56122a,'master_shop':_0x26ce1d,'language':_0x279640});}catch(_0x5dde87){console[_0x1956e3(0x231)](_0x1956e3(0x215),_0x5dde87),_0x4599bb[_0x1956e3(0x262)](0xc8)['json']({'message':_0x5dde87[_0x1956e3(0x190)]});}});function BayBinSelected(_0x46228c,_0x5b89f3){var _0xdab573=a0_0x316e4e,_0x354e95=[],_0x22e78f=[];if(_0x46228c==_0xdab573(0x1fb)){switch(_0x5b89f3){case'Rack\x201':_0x354e95=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0xdab573(0x1d8):_0x354e95=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x22e78f=['DG'];}else{if(_0x46228c==_0xdab573(0x258)){switch(_0x5b89f3){case'Rack\x201':_0x354e95=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0xdab573(0x1d8):_0x354e95=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x22e78f=['FG'];}}return{'levels':_0x354e95,'identify':_0x22e78f};}async function getRandom8DigitNumber(){var _0x725217=a0_0x316e4e;const _0x30d2e5=0x989680,_0x3c73a7=0x5f5e0ff,_0x59f053=Math['floor'](Math[_0x725217(0x192)]()*(_0x3c73a7-_0x30d2e5+0x1))+_0x30d2e5;var _0x4239dc;const _0x4d1aff=await purchases_finished[_0x725217(0x285)]({'invoice':_0x725217(0x26b)+_0x59f053});return _0x4d1aff&&_0x4d1aff[_0x725217(0x22a)]>0x0?_0x4239dc='INCF-'+_0x59f053:_0x4239dc=_0x725217(0x26b)+_0x59f053,_0x4239dc;}router['get'](a0_0x316e4e(0x203),auth,async(_0x205059,_0x4458c0)=>{var _0x20ad67=a0_0x316e4e;try{const {username:_0x4cd4fc,email:_0x35135c,role:_0x400098}=_0x205059['user'],_0x504b44=_0x205059[_0x20ad67(0x241)],_0x2ff0c1=await profile[_0x20ad67(0x285)]({'email':_0x504b44[_0x20ad67(0x25f)]}),_0x24a427=await master_shop['find'](),_0x29659c=await staff[_0x20ad67(0x285)]({'email':_0x504b44[_0x20ad67(0x25f)]}),_0x49ef52=await suppliers['find']({});let _0x59ef39;if(_0x504b44[_0x20ad67(0x281)]==_0x20ad67(0x1c7)){const _0x487811=await staff['findOne']({'email':_0x504b44[_0x20ad67(0x25f)]});_0x59ef39=await warehouse[_0x20ad67(0x256)]([{'$match':{'status':_0x20ad67(0x24c),'name':_0x487811[_0x20ad67(0x1ea)],'warehouse_category':_0x20ad67(0x274)}},{'$group':{'_id':_0x20ad67(0x266),'name':{'$first':_0x20ad67(0x266)}}}]);}else _0x59ef39=await warehouse['aggregate']([{'$match':{'status':_0x20ad67(0x24c),'warehouse_category':_0x20ad67(0x274),'name':{'$ne':_0x20ad67(0x261)}}},{'$group':{'_id':'$name','name':{'$first':_0x20ad67(0x266)}}}]);const _0x2dda72=await product[_0x20ad67(0x1f9)]({}),_0xd12393=await warehouse[_0x20ad67(0x1f9)]({'status':_0x20ad67(0x24c)}),_0x43043c=await purchases_finished['find']({}),_0x4fc551=_0x43043c[_0x20ad67(0x22a)]+0x1,_0x4dcb38='INCF-'+_0x4fc551[_0x20ad67(0x226)]()['padStart'](0x5,'0');var _0x38c15b=[_0x20ad67(0x19a),'Enclosed'];if(_0x24a427[0x0][_0x20ad67(0x1a4)]==_0x20ad67(0x23c))var _0x2425d5=users[_0x20ad67(0x18f)];else{if(_0x24a427[0x0][_0x20ad67(0x1a4)]==_0x20ad67(0x272))var _0x2425d5=users['Hindi'];else{if(_0x24a427[0x0][_0x20ad67(0x1a4)]==_0x20ad67(0x1bc))var _0x2425d5=users[_0x20ad67(0x1bc)];else{if(_0x24a427[0x0][_0x20ad67(0x1a4)]=='Spanish')var _0x2425d5=users[_0x20ad67(0x193)];else{if(_0x24a427[0x0][_0x20ad67(0x1a4)]==_0x20ad67(0x242))var _0x2425d5=users[_0x20ad67(0x242)];else{if(_0x24a427[0x0][_0x20ad67(0x1a4)]==_0x20ad67(0x19c))var _0x2425d5=users[_0x20ad67(0x27c)];else{if(_0x24a427[0x0][_0x20ad67(0x1a4)]=='Chinese')var _0x2425d5=users['Chinese'];else{if(_0x24a427[0x0][_0x20ad67(0x1a4)]==_0x20ad67(0x1e6))var _0x2425d5=users[_0x20ad67(0x25a)];}}}}}}}const _0x294925=getRandom8DigitNumber();_0x294925[_0x20ad67(0x1d7)](_0x55cce2=>{var _0x2036d6=_0x20ad67;_0x4458c0[_0x2036d6(0x24a)](_0x2036d6(0x270),{'success':_0x205059[_0x2036d6(0x1b7)](_0x2036d6(0x23f)),'errors':_0x205059[_0x2036d6(0x1b7)](_0x2036d6(0x19e)),'role':_0x504b44,'profile':_0x2ff0c1,'suppliers':_0x49ef52,'warehouse':_0x59ef39,'product':_0x2dda72,'invoice':_0x55cce2,'master_shop':_0x24a427,'language':_0x2425d5,'find_data':_0xd12393,'rooms_data':_0x38c15b});})[_0x20ad67(0x251)](_0x3031d3=>{var _0xd2634d=_0x20ad67;_0x205059[_0xd2634d(0x1b7)](_0xd2634d(0x19e),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x4458c0[_0xd2634d(0x1e5)](_0xd2634d(0x21f));});}catch(_0x4851c8){console[_0x20ad67(0x231)](_0x4851c8);}}),router[a0_0x316e4e(0x1e8)](a0_0x316e4e(0x1db),auth,async(_0x19e6c8,_0x276dcf)=>{var _0x4e6b80=a0_0x316e4e;try{const _0x1271cd=_0x19e6c8[_0x4e6b80(0x1e4)]['id'];console[_0x4e6b80(0x231)](_0x1271cd);const _0x597b79=await master_shop[_0x4e6b80(0x1f9)]();console[_0x4e6b80(0x231)]('master',_0x597b79);const _0x58954e=await product[_0x4e6b80(0x285)]({'name':_0x1271cd});console[_0x4e6b80(0x231)](_0x4e6b80(0x1eb),_0x58954e),_0x276dcf[_0x4e6b80(0x262)](0xc8)['json']({'product_data':_0x58954e,'master':_0x597b79});}catch(_0x1df7bb){console[_0x4e6b80(0x231)]('add_purchases\x20error',_0x1df7bb);}}),router[a0_0x316e4e(0x1ed)]('/view/add_purchases',auth,async(_0x26e3a7,_0x2a755b)=>{var _0xffa5db=a0_0x316e4e;try{const {invoice:_0x580cc3,date:_0xca19dc,warehouse_name:_0x527975,prod_name:_0x48e2bb,prod_code:_0x3605d8,prod_qty:_0x5e6de6,prod_unit:_0x2c5d71,prod_secondunit:_0x5512ce,prod_level:_0x11c56b,prod_isle:_0xc7bb8e,prod_pallet:_0x46d660,note:_0x4029e6,expiry_date:_0x4d896c,batch_code:_0x339309,payable:_0x471d4c,due_amount:_0x56fe71,Room_name:_0x47a1d6,primary_code:_0x19b3d2,secondary_code:_0x2c3d6a,MaxStocks_data:_0x54bde3,PO_number:_0x3bff18,SCRN:_0x9dcc05,JO_number:_0x56df8a}=_0x26e3a7[_0xffa5db(0x1df)];if(typeof _0x48e2bb=='string')var _0x38a450=[_0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x21a)]],_0x1f9275=[_0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x236)]],_0x2aab1c=[_0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x1b1)]],_0x3d0bb3=[_0x26e3a7['body'][_0xffa5db(0x1b0)]],_0x383aaa=[_0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x220)]],_0x30f515=[_0x26e3a7[_0xffa5db(0x1df)]['prod_level']],_0x5239d4=[_0x26e3a7[_0xffa5db(0x1df)]['primary_code']],_0x3f50f9=[_0x26e3a7['body'][_0xffa5db(0x240)]],_0x234b15=[_0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x1ac)]],_0x2b01f3=[_0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x225)]],_0x237a48=[_0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x196)]],_0x325f87=[_0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x239)]],_0x5e67a1=[_0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x217)]],_0x522aed=[_0x26e3a7['body'][_0xffa5db(0x24f)]],_0x129eb3=[_0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x209)]],_0x37c4ed=[_0x26e3a7['body'][_0xffa5db(0x219)]];else var _0x38a450=[..._0x26e3a7['body'][_0xffa5db(0x21a)]],_0x1f9275=[..._0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x236)]],_0x2aab1c=[..._0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x1b1)]],_0x3d0bb3=[..._0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x1b0)]],_0x383aaa=[..._0x26e3a7[_0xffa5db(0x1df)]['prod_secondunit']],_0x30f515=[..._0x26e3a7[_0xffa5db(0x1df)]['prod_level']],_0x5239d4=[..._0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x18d)]],_0x3f50f9=[..._0x26e3a7['body'][_0xffa5db(0x240)]],_0x234b15=[..._0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x1ac)]],_0x2b01f3=[..._0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x225)]],_0x237a48=[..._0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x196)]],_0x325f87=[..._0x26e3a7[_0xffa5db(0x1df)]['product_date']],_0x5e67a1=[..._0x26e3a7[_0xffa5db(0x1df)]['max_product_unit']],_0x522aed=[..._0x26e3a7['body'][_0xffa5db(0x24f)]],_0x129eb3=[..._0x26e3a7[_0xffa5db(0x1df)][_0xffa5db(0x209)]],_0x37c4ed=[..._0x26e3a7['body'][_0xffa5db(0x219)]];const _0xa96aa3=_0x38a450['map'](_0x16e614=>{return _0x16e614={'product_name':_0x16e614};});_0x1f9275['forEach']((_0x288968,_0x309d55)=>{var _0x102bfa=_0xffa5db;_0xa96aa3[_0x309d55][_0x102bfa(0x287)]=_0x288968;}),_0x2aab1c[_0xffa5db(0x1b6)]((_0x46377e,_0x45cc4e)=>{var _0x128871=_0xffa5db;_0xa96aa3[_0x45cc4e][_0x128871(0x250)]=Math['abs'](_0x46377e);}),_0x3d0bb3['forEach']((_0xc53e13,_0x377a97)=>{var _0x441f5a=_0xffa5db;_0xa96aa3[_0x377a97][_0x441f5a(0x210)]=_0xc53e13;}),_0x383aaa[_0xffa5db(0x1b6)]((_0x1f5781,_0x47e067)=>{_0xa96aa3[_0x47e067]['secondary_unit']=_0x1f5781;}),_0x30f515[_0xffa5db(0x1b6)]((_0x51e81d,_0x45ffbc)=>{var _0x426753=_0xffa5db;_0xa96aa3[_0x45ffbc][_0x426753(0x1d1)]=_0x51e81d;}),_0x5239d4['forEach']((_0x5747f3,_0x4833ab)=>{var _0x6d6e83=_0xffa5db;_0xa96aa3[_0x4833ab][_0x6d6e83(0x18d)]=_0x5747f3;}),_0x3f50f9[_0xffa5db(0x1b6)]((_0x48b1a1,_0x5dcfa6)=>{_0xa96aa3[_0x5dcfa6]['secondary_code']=_0x48b1a1;}),_0x234b15[_0xffa5db(0x1b6)]((_0xd55b38,_0xb26ab1)=>{var _0x3a280e=_0xffa5db;_0xa96aa3[_0xb26ab1][_0x3a280e(0x243)]=_0xd55b38;}),_0x2b01f3[_0xffa5db(0x1b6)]((_0x4443d8,_0x693ea6)=>{var _0x28bb94=_0xffa5db;_0xa96aa3[_0x693ea6][_0x28bb94(0x225)]=_0x4443d8;}),_0x237a48[_0xffa5db(0x1b6)]((_0x4739f6,_0x42b0bc)=>{_0xa96aa3[_0x42b0bc]['expiry_date']=_0x4739f6;}),_0x325f87[_0xffa5db(0x1b6)]((_0x1a7381,_0x4d64b8)=>{_0xa96aa3[_0x4d64b8]['production_date']=_0x1a7381;}),_0x5e67a1[_0xffa5db(0x1b6)]((_0x57f475,_0x4bcca6)=>{var _0x23cd4e=_0xffa5db;_0xa96aa3[_0x4bcca6][_0x23cd4e(0x253)]=_0x57f475;}),_0x522aed[_0xffa5db(0x1b6)]((_0xf1a6e0,_0x124c71)=>{var _0x15e231=_0xffa5db;_0xa96aa3[_0x124c71][_0x15e231(0x1d5)]=_0xf1a6e0;}),_0x129eb3[_0xffa5db(0x1b6)]((_0x4c1183,_0xe6761b)=>{var _0x5b63f7=_0xffa5db;_0xa96aa3[_0xe6761b][_0x5b63f7(0x1ad)]=_0x4c1183;}),_0x37c4ed[_0xffa5db(0x1b6)]((_0xd1fa26,_0x2039a1)=>{var _0x2b0a1f=_0xffa5db;_0xa96aa3[_0x2039a1][_0x2b0a1f(0x1dc)]=_0xd1fa26;});const _0x462e17=_0xa96aa3[_0xffa5db(0x27b)](_0x5c649c=>_0x5c649c['quantity']!=='0'&&_0x5c649c['quantity']!==''),_0x22a2f5=new purchases_finished({'invoice':_0x580cc3,'suppliers':_0x26e3a7['body'][_0xffa5db(0x1fc)],'date':_0xca19dc,'warehouse_name':_0x527975,'product':_0x462e17,'note':_0x4029e6,'due_amount':_0x56fe71,'room':_0x47a1d6,'POnumber':_0x3bff18,'SCRN':_0x9dcc05,'JO_number':_0x56df8a}),_0x20e39c=await _0x22a2f5[_0xffa5db(0x23b)](),_0x29b783=await purchases_finished[_0xffa5db(0x285)]({'invoice':_0x580cc3}),_0x434005=_0x29b783['product'][_0xffa5db(0x18e)](async _0x1eeaff=>{var _0x106fa1=_0xffa5db;try{var _0x4b0d70=await warehouse['findOne']({'name':_0x527975,'room':_0x1eeaff[_0x106fa1(0x1ad)]}),_0x484d78=0x0;const _0x244a9c=_0x4b0d70[_0x106fa1(0x218)]['map'](_0x257062=>{var _0x3ecbb5=_0x106fa1;console[_0x3ecbb5(0x231)](_0x257062['product_name']+'=='+_0x1eeaff[_0x3ecbb5(0x1e9)]+'&&'+_0x257062[_0x3ecbb5(0x1d1)]+'=='+_0x1eeaff[_0x3ecbb5(0x1d1)]+'&&'+_0x257062[_0x3ecbb5(0x196)]+'=='+_0x1eeaff[_0x3ecbb5(0x196)]+'&&'+_0x257062['production_date']+'=='+_0x1eeaff[_0x3ecbb5(0x1d4)]+'&&'+_0x257062[_0x3ecbb5(0x225)]+'=='+_0x1eeaff['batch_code']+'&&'+_0x257062[_0x3ecbb5(0x1dc)]+'=='+_0x29b783[_0x3ecbb5(0x1dc)]),_0x257062[_0x3ecbb5(0x1e9)]==_0x1eeaff[_0x3ecbb5(0x1e9)]&&_0x257062[_0x3ecbb5(0x1d1)]==_0x1eeaff[_0x3ecbb5(0x1d1)]&&_0x257062[_0x3ecbb5(0x196)]==_0x1eeaff[_0x3ecbb5(0x196)]&&_0x257062[_0x3ecbb5(0x1d4)]==_0x1eeaff[_0x3ecbb5(0x1d4)]&&_0x257062['batch_code']==_0x1eeaff[_0x3ecbb5(0x225)]&&_0x257062[_0x3ecbb5(0x1dc)]==_0x29b783[_0x3ecbb5(0x1dc)]&&(_0x257062[_0x3ecbb5(0x19b)]=Math[_0x3ecbb5(0x207)](_0x257062[_0x3ecbb5(0x19b)])+Math[_0x3ecbb5(0x207)](_0x1eeaff['quantity']),_0x484d78++);});return _0x484d78==0x0&&(_0x4b0d70[_0x106fa1(0x218)]=_0x4b0d70[_0x106fa1(0x218)][_0x106fa1(0x1f6)]({'product_name':_0x1eeaff[_0x106fa1(0x1e9)],'product_stock':Math[_0x106fa1(0x207)](_0x1eeaff['quantity']),'primary_code':_0x1eeaff['primary_code'],'secondary_code':_0x1eeaff[_0x106fa1(0x240)],'product_code':_0x1eeaff[_0x106fa1(0x287)],'bay':_0x1eeaff[_0x106fa1(0x1d1)],'maxProducts':_0x1eeaff[_0x106fa1(0x243)],'unit':_0x1eeaff[_0x106fa1(0x210)],'secondary_unit':_0x1eeaff[_0x106fa1(0x265)],'expiry_date':_0x1eeaff[_0x106fa1(0x196)],'production_date':_0x1eeaff[_0x106fa1(0x1d4)],'maxProducts':_0x1eeaff[_0x106fa1(0x243)],'maxPerUnit':_0x1eeaff['maxperunit'],'batch_code':_0x1eeaff[_0x106fa1(0x225)],'product_cat':_0x1eeaff[_0x106fa1(0x1d5)],'invoice':_0x1eeaff[_0x106fa1(0x1dc)],'id_incoming':_0x1eeaff[_0x106fa1(0x1ab)]})),_0x4b0d70;}catch(_0x36c3f0){return console[_0x106fa1(0x25d)]('Error\x20occurred\x20while\x20processing\x20product:',_0x36c3f0),null;}});Promise['all'](_0x434005)['then'](async _0x1df655=>{var _0x3c77e1=_0xffa5db;try{for(const _0x29795f of _0x1df655){await warehouse[_0x3c77e1(0x1c0)]({'_id':_0x29795f['_id']},{'$addToSet':{'product_details':{'$each':_0x29795f[_0x3c77e1(0x218)]}}});}const _0x4f87ed=await master_shop['find'](),_0x5a0975=await email_settings['findOne'](),_0x4bfff3=await supervisor_settings[_0x3c77e1(0x1f9)]();var _0x389b8c=_0x29b783[_0x3c77e1(0x1eb)],_0xbc8541='',_0x447b1e;for(_0x447b1e in _0x389b8c){var _0x16bc40='FG';_0x29b783[_0x3c77e1(0x26a)]==_0x3c77e1(0x1fb)&&(_0x16bc40='DG'),_0xbc8541+=_0x3c77e1(0x1da)+_0x3c77e1(0x227)+_0x389b8c[_0x447b1e]['product_name']+_0x3c77e1(0x1bf)+_0x3c77e1(0x227)+_0x389b8c[_0x447b1e]['product_code']+'</td>'+_0x3c77e1(0x227)+_0x389b8c[_0x447b1e][_0x3c77e1(0x250)]+_0x3c77e1(0x1bf)+_0x3c77e1(0x227)+_0x389b8c[_0x447b1e][_0x3c77e1(0x210)]+'</td>'+_0x3c77e1(0x227)+_0x389b8c[_0x447b1e][_0x3c77e1(0x265)]+_0x3c77e1(0x1bf)+_0x3c77e1(0x227)+_0x29b783['warehouse_name']+'</td>'+_0x3c77e1(0x227)+_0x389b8c[_0x447b1e][_0x3c77e1(0x1ad)]+_0x3c77e1(0x1bf)+_0x3c77e1(0x227)+_0x16bc40+_0x389b8c[_0x447b1e]['bay']+_0x3c77e1(0x1bf),'</tr>';}let _0x15199c=nodemailer['createTransport']({'host':_0x5a0975[_0x3c77e1(0x27e)],'port':Number(_0x5a0975[_0x3c77e1(0x202)]),'secure':![],'auth':{'user':_0x5a0975[_0x3c77e1(0x25f)],'pass':_0x5a0975[_0x3c77e1(0x260)]}}),_0x12c32b={'from':_0x5a0975[_0x3c77e1(0x25f)],'to':_0x4bfff3[0x0][_0x3c77e1(0x201)],'subject':_0x3c77e1(0x234),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3c77e1(0x1c2)+_0x3c77e1(0x26f)+_0x4f87ed[0x0][_0x3c77e1(0x282)],'cid':'logo'}],'html':_0x3c77e1(0x1ec)+_0x3c77e1(0x1a6)+_0x3c77e1(0x277)+_0x3c77e1(0x20f)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3c77e1(0x20f)+_0x3c77e1(0x25e)+_0x3c77e1(0x198)+_0x3c77e1(0x20f)+_0x3c77e1(0x1ca)+_0x4f87ed[0x0][_0x3c77e1(0x252)]+_0x3c77e1(0x249)+_0x3c77e1(0x198)+_0x3c77e1(0x198)+'<hr\x20class=\x22my-3\x22>'+_0x3c77e1(0x20f)+_0x3c77e1(0x1d3)+_0x3c77e1(0x20e)+_0x29b783['invoice']+'\x20'+_0x3c77e1(0x1e1)+_0x3c77e1(0x235)+_0x29b783[_0x3c77e1(0x221)]+'\x20'+'</span>'+_0x3c77e1(0x269)+_0x3c77e1(0x198)+_0x3c77e1(0x244)+_0x3c77e1(0x1f0)+_0x3c77e1(0x1da)+_0x3c77e1(0x1cf)+_0x3c77e1(0x1ba)+_0x3c77e1(0x23e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x3c77e1(0x1be)+_0x3c77e1(0x26c)+_0x3c77e1(0x22c)+_0x3c77e1(0x19f)+_0x3c77e1(0x1b3)+'\x20'+_0xbc8541+'\x20'+_0x3c77e1(0x24b)+'</table>'+'<div>'+_0x3c77e1(0x232)+_0x3c77e1(0x21e)+_0x4f87ed[0x0][_0x3c77e1(0x252)]+_0x3c77e1(0x269)+_0x3c77e1(0x198)+'</div>'+_0x3c77e1(0x1a1)};_0x15199c[_0x3c77e1(0x1c5)](_0x12c32b,function(_0x5c2206,_0x21c463){var _0x1046b4=_0x3c77e1;_0x5c2206?(console['log'](_0x5c2206),console[_0x1046b4(0x231)](_0x1046b4(0x223))):console[_0x1046b4(0x231)](_0x1046b4(0x191));});}catch(_0x59f98e){console['error'](_0x59f98e),_0x2a755b[_0x3c77e1(0x262)](0x1f4)[_0x3c77e1(0x1a7)]({'error':_0x3c77e1(0x1aa),'message':_0x59f98e[_0x3c77e1(0x190)]});}})[_0xffa5db(0x251)](_0x1d7ec7=>{var _0x383158=_0xffa5db;console[_0x383158(0x25d)](_0x1d7ec7);}),_0x26e3a7['flash'](_0xffa5db(0x23f),_0xffa5db(0x1b8)),_0x2a755b[_0xffa5db(0x1e5)](_0xffa5db(0x21f));}catch(_0x17f21d){console[_0xffa5db(0x231)](_0x17f21d);}}),router['get']('/preview/:id',auth,async(_0x5a5be5,_0x219a96)=>{var _0x155b3d=a0_0x316e4e;try{const {username:_0x7a37ff,email:_0x413d56,role:_0x474f87}=_0x5a5be5[_0x155b3d(0x241)],_0x470ceb=_0x5a5be5[_0x155b3d(0x241)],_0x101813=await profile[_0x155b3d(0x285)]({'email':_0x470ceb[_0x155b3d(0x25f)]}),_0x5583a6=await master_shop[_0x155b3d(0x1f9)](),_0x2ff5ef=_0x5a5be5[_0x155b3d(0x1e4)]['id'],_0x43ea48=await purchases_finished[_0x155b3d(0x1fe)](_0x2ff5ef),_0x493ea0=await suppliers[_0x155b3d(0x1f9)]({});let _0x19bca8;if(_0x470ceb[_0x155b3d(0x281)]==_0x155b3d(0x1c7)){const _0x53b299=await staff[_0x155b3d(0x285)]({'email':_0x470ceb['email']});_0x19bca8=await warehouse[_0x155b3d(0x1f9)]({'status':_0x155b3d(0x24c),'name':_0x53b299[_0x155b3d(0x1ea)],'warehouse_category':'Finished\x20Goods'});}else _0x19bca8=await warehouse[_0x155b3d(0x256)]([{'$match':{'status':_0x155b3d(0x24c),'warehouse_category':_0x155b3d(0x274)}},{'$group':{'_id':_0x155b3d(0x266),'name':{'$first':'$name'}}}]);const _0x2bd2ca=await product['find']({}),_0x49ab98=BayBinSelected(_0x43ea48[_0x155b3d(0x26a)],_0x43ea48[_0x155b3d(0x211)]);let _0x1846ec=new Date(_0x43ea48[_0x155b3d(0x196)]),_0x5a31d8=('0'+_0x1846ec[_0x155b3d(0x1c8)]())[_0x155b3d(0x1ef)](-0x2),_0xec6749=('0'+(_0x1846ec['getMonth']()+0x1))[_0x155b3d(0x1ef)](-0x2),_0x362c6f=_0x1846ec[_0x155b3d(0x20b)](),_0x461a4c=_0x362c6f+'-'+_0xec6749+'-'+_0x5a31d8;if(_0x5583a6[0x0][_0x155b3d(0x1a4)]==_0x155b3d(0x23c)){var _0x3df760=users[_0x155b3d(0x18f)];console[_0x155b3d(0x231)](_0x3df760);}else{if(_0x5583a6[0x0]['language']==_0x155b3d(0x272))var _0x3df760=users[_0x155b3d(0x272)];else{if(_0x5583a6[0x0][_0x155b3d(0x1a4)]==_0x155b3d(0x1bc))var _0x3df760=users['German'];else{if(_0x5583a6[0x0][_0x155b3d(0x1a4)]==_0x155b3d(0x193))var _0x3df760=users['Spanish'];else{if(_0x5583a6[0x0][_0x155b3d(0x1a4)]==_0x155b3d(0x242))var _0x3df760=users['French'];else{if(_0x5583a6[0x0][_0x155b3d(0x1a4)]==_0x155b3d(0x19c))var _0x3df760=users[_0x155b3d(0x27c)];else{if(_0x5583a6[0x0][_0x155b3d(0x1a4)]==_0x155b3d(0x1dd))var _0x3df760=users[_0x155b3d(0x1dd)];else{if(_0x5583a6[0x0]['language']==_0x155b3d(0x1e6))var _0x3df760=users[_0x155b3d(0x25a)];}}}}}}}_0x219a96['render'](_0x155b3d(0x264),{'success':_0x5a5be5[_0x155b3d(0x1b7)](_0x155b3d(0x23f)),'errors':_0x5a5be5['flash'](_0x155b3d(0x19e)),'role':_0x470ceb,'profile':_0x101813,'purchases':_0x43ea48,'suppliers':_0x493ea0,'warehouse':_0x19bca8,'product':_0x2bd2ca,'master_shop':_0x5583a6,'language':_0x3df760,'ed_fullDate':_0x461a4c,'dataSelected':_0x49ab98});}catch(_0x1f868b){console[_0x155b3d(0x231)](_0x1f868b);}}),router[a0_0x316e4e(0x1e8)](a0_0x316e4e(0x19d),auth,async(_0x14a043,_0x292cb9)=>{var _0x15573a=a0_0x316e4e;try{const {username:_0x5253c3,email:_0x251894,role:_0x5e1271}=_0x14a043[_0x15573a(0x241)],_0x79ec86=_0x14a043[_0x15573a(0x241)],_0x4e861c=await profile['findOne']({'email':_0x79ec86[_0x15573a(0x25f)]}),_0x3ca488=await master_shop['find'](),_0x7275c6=_0x14a043[_0x15573a(0x1e4)]['id'],_0x19b2d0=await purchases_finished[_0x15573a(0x1fe)](_0x7275c6),_0x253008=await suppliers[_0x15573a(0x1f9)]({});let _0x1d134c;if(_0x79ec86[_0x15573a(0x281)]=='staff'){const _0x2691a5=await staff['findOne']({'email':_0x79ec86['email']});_0x1d134c=await warehouse[_0x15573a(0x1f9)]({'status':_0x15573a(0x24c),'name':_0x2691a5[_0x15573a(0x1ea)],'warehouse_category':'Finished\x20Goods'});}else _0x1d134c=await warehouse[_0x15573a(0x256)]([{'$match':{'status':'Enabled','warehouse_category':_0x15573a(0x274)}},{'$group':{'_id':_0x15573a(0x266),'name':{'$first':_0x15573a(0x266)}}}]);const _0x291fbe=await product['find']({}),_0x4b7144=BayBinSelected(_0x19b2d0[_0x15573a(0x26a)],_0x19b2d0[_0x15573a(0x211)]);let _0x133c59=new Date(_0x19b2d0[_0x15573a(0x196)]),_0x1ff297=('0'+_0x133c59[_0x15573a(0x1c8)]())[_0x15573a(0x1ef)](-0x2),_0x564485=('0'+(_0x133c59[_0x15573a(0x257)]()+0x1))[_0x15573a(0x1ef)](-0x2),_0x21b39d=_0x133c59['getFullYear'](),_0x51a191=_0x21b39d+'-'+_0x564485+'-'+_0x1ff297;if(_0x3ca488[0x0]['language']==_0x15573a(0x23c)){var _0x2a6407=users['English'];console[_0x15573a(0x231)](_0x2a6407);}else{if(_0x3ca488[0x0][_0x15573a(0x1a4)]==_0x15573a(0x272))var _0x2a6407=users['Hindi'];else{if(_0x3ca488[0x0]['language']==_0x15573a(0x1bc))var _0x2a6407=users['German'];else{if(_0x3ca488[0x0][_0x15573a(0x1a4)]==_0x15573a(0x193))var _0x2a6407=users['Spanish'];else{if(_0x3ca488[0x0][_0x15573a(0x1a4)]=='French')var _0x2a6407=users['French'];else{if(_0x3ca488[0x0][_0x15573a(0x1a4)]=='Portuguese\x20(BR)')var _0x2a6407=users['Portuguese'];else{if(_0x3ca488[0x0]['language']=='Chinese')var _0x2a6407=users['Chinese'];else{if(_0x3ca488[0x0][_0x15573a(0x1a4)]==_0x15573a(0x1e6))var _0x2a6407=users[_0x15573a(0x25a)];}}}}}}}_0x292cb9[_0x15573a(0x24a)](_0x15573a(0x23a),{'success':_0x14a043[_0x15573a(0x1b7)](_0x15573a(0x23f)),'errors':_0x14a043[_0x15573a(0x1b7)]('errors'),'role':_0x79ec86,'profile':_0x4e861c,'purchases':_0x19b2d0,'suppliers':_0x253008,'warehouse':_0x1d134c,'product':_0x291fbe,'master_shop':_0x3ca488,'language':_0x2a6407,'ed_fullDate':_0x51a191,'dataSelected':_0x4b7144});}catch(_0x12560c){console['log'](_0x12560c);}}),router[a0_0x316e4e(0x1ed)]('/view/:id',auth,async(_0x532be2,_0x38ba0b)=>{var _0x55bcab=a0_0x316e4e;try{const _0x29d745=_0x532be2[_0x55bcab(0x1e4)]['id'],_0x58eadd=await purchases_finished[_0x55bcab(0x285)]({'_id':_0x532be2[_0x55bcab(0x1e4)]['id']}),_0xcc8874=await warehouse['findOne']({'name':_0x58eadd[_0x55bcab(0x26a)],'room':_0x58eadd[_0x55bcab(0x211)]});_0x58eadd['product'][_0x55bcab(0x1b6)](_0x3edb7d=>{var _0x16c9cf=_0x55bcab;const _0x3a21c8=_0xcc8874[_0x16c9cf(0x218)][_0x16c9cf(0x18e)](_0x1d5bc7=>{var _0x13f2a=_0x16c9cf;_0x1d5bc7[_0x13f2a(0x1e9)]==_0x3edb7d[_0x13f2a(0x1e9)]&&_0x1d5bc7['bay']==_0x3edb7d[_0x13f2a(0x1d1)]&&(_0x1d5bc7[_0x13f2a(0x19b)]=parseInt(_0x1d5bc7[_0x13f2a(0x19b)])-parseInt(_0x3edb7d[_0x13f2a(0x250)]));});}),await _0xcc8874[_0x55bcab(0x23b)]();const {invoice:_0x1c8a97,suppliers:_0x59ee8a,date:_0xda8ddc,warehouse_name:_0x35c3b6,prod_name:_0x2bffe9,prod_code:_0x3036a3,prod_qty:_0x39cab2,prod_unit:_0x551d94,prod_secondunit:_0x2bb35f,prod_level:_0x8a3bd5,prod_isle:_0x3a020c,prod_pallet:_0x50ff8a,note:_0x5a8a86,expiry_date:_0x3ec514,batch_code:_0x4cfdfd,paid_amount:_0xaeaf80,due_amount:_0xcb0ba,Room_name:_0x2184ff,primary_code:_0x109dfe,secondary_code:_0x56ca8f,PO_number:_0x2df64d,JO_number:_0x3b50b8}=_0x532be2[_0x55bcab(0x1df)];if(typeof _0x2bffe9==_0x55bcab(0x1ee))var _0xcb6640=[_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x21a)]],_0x51b484=[_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x236)]],_0x48da45=[_0x532be2[_0x55bcab(0x1df)]['prod_qty']],_0x48c958=[_0x532be2['body'][_0x55bcab(0x27d)]],_0x5b559b=[_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x220)]],_0x4bcac0=[_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x268)]],_0x3378e9=[_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x18d)]],_0x58e609=[_0x532be2['body'][_0x55bcab(0x240)]],_0x21800c=[_0x532be2[_0x55bcab(0x1df)]['MaxStocks_data']],_0x34f8ff=[_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x225)]],_0x38715b=[_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x196)]];else var _0xcb6640=[..._0x532be2[_0x55bcab(0x1df)]['prod_name']],_0x51b484=[..._0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x236)]],_0x48da45=[..._0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x1e7)]],_0x48c958=[..._0x532be2['body']['prod_unit']],_0x5b559b=[..._0x532be2['body'][_0x55bcab(0x220)]],_0x4bcac0=[..._0x532be2[_0x55bcab(0x1df)]['prod_level']],_0x3378e9=[..._0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x18d)]],_0x58e609=[..._0x532be2[_0x55bcab(0x1df)]['secondary_code']],_0x21800c=[..._0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x1ac)]],_0x34f8ff=[..._0x532be2['body'][_0x55bcab(0x225)]],_0x38715b=[..._0x532be2[_0x55bcab(0x1df)]['expiry_date']];const _0x46e3b6=_0xcb6640['map'](_0xab831d=>{return _0xab831d={'product_name':_0xab831d};});_0x51b484[_0x55bcab(0x1b6)]((_0x1fb615,_0x4c4b2b)=>{_0x46e3b6[_0x4c4b2b]['product_code']=_0x1fb615;}),_0x48da45['forEach']((_0x595ec6,_0x847701)=>{var _0x4f25b2=_0x55bcab;_0x46e3b6[_0x847701][_0x4f25b2(0x250)]=_0x595ec6;}),_0x48c958['forEach']((_0x523e34,_0x17ba34)=>{var _0x3d13da=_0x55bcab;_0x46e3b6[_0x17ba34][_0x3d13da(0x210)]=_0x523e34;}),_0x5b559b['forEach']((_0x41d2f9,_0x2aecee)=>{var _0x34898c=_0x55bcab;_0x46e3b6[_0x2aecee][_0x34898c(0x265)]=_0x41d2f9;}),_0x4bcac0[_0x55bcab(0x1b6)]((_0x235a57,_0x345830)=>{var _0x5854ce=_0x55bcab;_0x46e3b6[_0x345830][_0x5854ce(0x1d1)]=_0x235a57;}),_0x3378e9['forEach']((_0x87c912,_0x2a282f)=>{var _0x49dd73=_0x55bcab;_0x46e3b6[_0x2a282f][_0x49dd73(0x18d)]=_0x87c912;}),_0x58e609[_0x55bcab(0x1b6)]((_0x375709,_0x4e1097)=>{_0x46e3b6[_0x4e1097]['secondary_code']=_0x375709;}),_0x21800c[_0x55bcab(0x1b6)]((_0x5b1018,_0x2b59aa)=>{var _0xb284be=_0x55bcab;_0x46e3b6[_0x2b59aa][_0xb284be(0x243)]=_0x5b1018;}),_0x34f8ff[_0x55bcab(0x1b6)]((_0x123790,_0x107f55)=>{var _0x36c91d=_0x55bcab;_0x46e3b6[_0x107f55][_0x36c91d(0x225)]=_0x123790;}),_0x38715b[_0x55bcab(0x1b6)]((_0xbbaff4,_0x25f53a)=>{var _0x34109e=_0x55bcab;_0x46e3b6[_0x25f53a][_0x34109e(0x196)]=_0xbbaff4;});const _0x49e7c6=_0x46e3b6[_0x55bcab(0x27b)](_0xd24a4b=>_0xd24a4b['quantity']!=='0'&&_0xd24a4b[_0x55bcab(0x250)]!=='');_0x58eadd[_0x55bcab(0x1dc)]=_0x1c8a97,_0x58eadd['suppliers']=_0x59ee8a,_0x58eadd[_0x55bcab(0x221)]=_0xda8ddc,_0x58eadd[_0x55bcab(0x26a)]=_0x35c3b6,_0x58eadd[_0x55bcab(0x1eb)]=_0x49e7c6,_0x58eadd['note']=_0x5a8a86,_0x58eadd[_0x55bcab(0x20a)]=_0xaeaf80,_0x58eadd[_0x55bcab(0x233)]=_0xcb0ba,_0x58eadd['room']=_0x2184ff,_0x58eadd[_0x55bcab(0x197)]=_0x2df64d,_0x58eadd['JO_number']=_0x3b50b8;const _0x596164=await _0x58eadd['save'](),_0x191af2=await warehouse['findOne']({'name':_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x26a)],'room':_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x224)]});_0x58eadd[_0x55bcab(0x1eb)][_0x55bcab(0x1b6)](_0x13a239=>{var _0xf89d08=_0x55bcab,_0x20b8a6=0x0;const _0x4a126e=_0x191af2['product_details'][_0xf89d08(0x18e)](_0xaef6a1=>{var _0x582d5c=_0xf89d08;_0xaef6a1[_0x582d5c(0x1e9)]==_0x13a239[_0x582d5c(0x1e9)]&&_0xaef6a1[_0x582d5c(0x1d1)]==_0x13a239[_0x582d5c(0x1d1)]&&(_0xaef6a1['product_stock']=parseInt(_0xaef6a1['product_stock'])+parseInt(_0x13a239['quantity']),_0x20b8a6++);});_0x20b8a6=='0'&&(_0x191af2[_0xf89d08(0x218)]=_0x191af2[_0xf89d08(0x218)]['concat']({'product_name':_0x13a239[_0xf89d08(0x1e9)],'product_stock':_0x13a239[_0xf89d08(0x250)],'primary_code':_0x13a239[_0xf89d08(0x18d)],'secondary_code':_0x13a239['secondary_code'],'product_code':_0x13a239[_0xf89d08(0x287)],'bay':_0x13a239[_0xf89d08(0x1d1)],'maxProducts':_0x13a239[_0xf89d08(0x243)],'unit':_0x13a239[_0xf89d08(0x210)],'secondary_unit':_0x13a239['secondary_unit'],'expiry_date':_0x13a239[_0xf89d08(0x196)]}));}),await _0x191af2[_0x55bcab(0x23b)]();const _0x4a3ff4=await s_payment_data[_0x55bcab(0x285)]({'invoice':_0x532be2[_0x55bcab(0x1df)]['invoice']});if(_0x4a3ff4===null){}else console[_0x55bcab(0x231)]('suppliers',_0x4a3ff4,_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x1dc)]),_0x4a3ff4['suppliers']=_0x532be2[_0x55bcab(0x1df)][_0x55bcab(0x1fc)],await _0x4a3ff4[_0x55bcab(0x23b)]();_0x532be2['flash']('success',_0x55bcab(0x248)),_0x38ba0b[_0x55bcab(0x1e5)]('/all_purchases_finished/view');}catch(_0x263dd7){console['log'](_0x263dd7);}}),router[a0_0x316e4e(0x1ed)](a0_0x316e4e(0x21c),auth,async(_0x188b5d,_0x1b2861)=>{var _0x2b38dd=a0_0x316e4e;try{const _0xd2abbb=_0x188b5d[_0x2b38dd(0x1e4)]['id'],{invoice:_0x515734,suppliers:_0x3dd7cd,payable:_0x230e32,due_amount:_0x4c5763}=_0x188b5d[_0x2b38dd(0x1df)],_0x528244=await purchases[_0x2b38dd(0x1fe)](_0xd2abbb);var _0x448ece=_0x230e32-_0x4c5763;_0x528244[_0x2b38dd(0x20a)]=parseFloat(_0x528244[_0x2b38dd(0x20a)])+parseFloat(_0x4c5763),_0x528244[_0x2b38dd(0x233)]=_0x448ece;const _0x4225f9=await _0x528244[_0x2b38dd(0x23b)]();console['log'](_0x4225f9);const _0x238c27=await s_payment_data[_0x2b38dd(0x285)]({'invoice':_0x515734});_0x238c27[_0x2b38dd(0x1f2)]=_0x448ece,await _0x238c27['save']();let _0xd40b2f=new Date(),_0x2b3b6c=('0'+_0xd40b2f[_0x2b38dd(0x1c8)]())[_0x2b38dd(0x1ef)](-0x2),_0x431190=('0'+(_0xd40b2f['getMonth']()+0x1))[_0x2b38dd(0x1ef)](-0x2),_0x46bff8=_0xd40b2f[_0x2b38dd(0x20b)](),_0x4f0dd2=_0x46bff8+'-'+_0x431190+'-'+_0x2b3b6c;const _0x16edee=new suppliers_payment({'invoice':_0x515734,'date':_0x46bff8+'-'+_0x431190+'-'+_0x2b3b6c,'suppliers':_0x3dd7cd,'reason':_0x2b38dd(0x1d6),'amount':_0x4c5763}),_0x3eca5c=await _0x16edee[_0x2b38dd(0x23b)]();_0x188b5d['flash'](_0x2b38dd(0x23f),_0x2b38dd(0x1f1)),_0x1b2861[_0x2b38dd(0x1e5)](_0x2b38dd(0x205));}catch(_0x56d8dc){console[_0x2b38dd(0x231)](_0x56d8dc);}}),router[a0_0x316e4e(0x1e8)](a0_0x316e4e(0x1d9),auth,async(_0x2447c1,_0x28f467)=>{var _0x34bba1=a0_0x316e4e;try{const {username:_0x5b2261,email:_0x2ab1db,role:_0xab6a54}=_0x2447c1['user'],_0x28a52e=_0x2447c1[_0x34bba1(0x241)],_0x5a00b3=await profile[_0x34bba1(0x285)]({'email':_0x28a52e[_0x34bba1(0x25f)]}),_0x345f7b=await master_shop['find']();console[_0x34bba1(0x231)]('master',_0x345f7b);const _0x5c4974=_0x2447c1[_0x34bba1(0x1e4)]['id'],_0x4ac399=await purchases[_0x34bba1(0x1fe)](_0x5c4974);console[_0x34bba1(0x231)](_0x4ac399);const _0x1dcb25=await suppliers[_0x34bba1(0x285)]({'name':_0x4ac399[_0x34bba1(0x1fc)]});console[_0x34bba1(0x231)](_0x1dcb25);if(_0x345f7b[0x0][_0x34bba1(0x1a4)]==_0x34bba1(0x23c)){var _0x181c1f=users[_0x34bba1(0x18f)];console[_0x34bba1(0x231)](_0x181c1f);}else{if(_0x345f7b[0x0][_0x34bba1(0x1a4)]==_0x34bba1(0x272))var _0x181c1f=users[_0x34bba1(0x272)];else{if(_0x345f7b[0x0][_0x34bba1(0x1a4)]==_0x34bba1(0x1bc))var _0x181c1f=users['German'];else{if(_0x345f7b[0x0][_0x34bba1(0x1a4)]==_0x34bba1(0x193))var _0x181c1f=users['Spanish'];else{if(_0x345f7b[0x0]['language']==_0x34bba1(0x242))var _0x181c1f=users[_0x34bba1(0x242)];else{if(_0x345f7b[0x0][_0x34bba1(0x1a4)]=='Portuguese\x20(BR)')var _0x181c1f=users[_0x34bba1(0x27c)];else{if(_0x345f7b[0x0][_0x34bba1(0x1a4)]==_0x34bba1(0x1dd))var _0x181c1f=users[_0x34bba1(0x1dd)];else{if(_0x345f7b[0x0][_0x34bba1(0x1a4)]==_0x34bba1(0x1e6))var _0x181c1f=users['Arabic'];}}}}}}}_0x28f467['render']('purchase_invoice',{'success':_0x2447c1[_0x34bba1(0x1b7)](_0x34bba1(0x23f)),'errors':_0x2447c1[_0x34bba1(0x1b7)](_0x34bba1(0x19e)),'role':_0x28a52e,'profile':_0x5a00b3,'master_shop':_0x345f7b,'supplier':_0x1dcb25,'purchase':_0x4ac399,'language':_0x181c1f});}catch(_0x3c15c1){console[_0x34bba1(0x231)](_0x3c15c1);}}),router[a0_0x316e4e(0x1e8)](a0_0x316e4e(0x230),auth,async(_0x12acd2,_0x5441aa)=>{var _0x2b7db4=a0_0x316e4e;try{const {username:_0x5d4e86,email:_0x154f59,role:_0x42d709}=_0x12acd2[_0x2b7db4(0x241)],_0x125ed7=_0x12acd2['user'],_0x23f5a4=await profile[_0x2b7db4(0x285)]({'email':_0x125ed7[_0x2b7db4(0x25f)]}),_0x4b1e84=await master_shop[_0x2b7db4(0x1f9)]();console[_0x2b7db4(0x231)]('master',_0x4b1e84);const _0xf1fbf4=_0x12acd2[_0x2b7db4(0x1e4)]['id'];console[_0x2b7db4(0x231)](_0xf1fbf4);const _0x575532=await purchases_finished['findById'](_0xf1fbf4);console[_0x2b7db4(0x231)](_0x2b7db4(0x288),_0x575532);const _0xa56d87=await product[_0x2b7db4(0x1f9)]({}),_0x334af0=await warehouse[_0x2b7db4(0x256)]([{'$match':{'name':_0x575532[_0x2b7db4(0x26a)],'room':_0x575532[_0x2b7db4(0x211)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2b7db4(0x222),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x2b7db4(0x1a2)},'bin':{'$first':_0x2b7db4(0x24e)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2b7db4(0x21b)},'primary_code':{'$first':_0x2b7db4(0x22f)},'secondary_code':{'$first':_0x2b7db4(0x228)},'product_code':{'$first':_0x2b7db4(0x1d0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2b7db4(0x1cb)}}}]);console[_0x2b7db4(0x231)]('stock_data',_0x334af0);let _0x3d13b1;if(_0x125ed7[_0x2b7db4(0x281)]=='staff'){const _0x32bf47=await staff[_0x2b7db4(0x285)]({'email':_0x125ed7[_0x2b7db4(0x25f)]});_0x3d13b1=await warehouse[_0x2b7db4(0x1f9)]({'status':'Enabled','name':_0x32bf47[_0x2b7db4(0x1ea)],'warehouse_category':_0x2b7db4(0x274),'name':_0x2b7db4(0x237)});}else _0x3d13b1=await warehouse[_0x2b7db4(0x256)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':_0x2b7db4(0x237)}},{'$group':{'_id':_0x2b7db4(0x266),'name':{'$first':_0x2b7db4(0x266)}}}]);if(_0x4b1e84[0x0][_0x2b7db4(0x1a4)]==_0x2b7db4(0x23c)){var _0x9ee184=users[_0x2b7db4(0x18f)];console[_0x2b7db4(0x231)](_0x9ee184);}else{if(_0x4b1e84[0x0][_0x2b7db4(0x1a4)]=='Hindi')var _0x9ee184=users[_0x2b7db4(0x272)];else{if(_0x4b1e84[0x0][_0x2b7db4(0x1a4)]==_0x2b7db4(0x1bc))var _0x9ee184=users[_0x2b7db4(0x1bc)];else{if(_0x4b1e84[0x0][_0x2b7db4(0x1a4)]==_0x2b7db4(0x193))var _0x9ee184=users[_0x2b7db4(0x193)];else{if(_0x4b1e84[0x0][_0x2b7db4(0x1a4)]=='French')var _0x9ee184=users[_0x2b7db4(0x242)];else{if(_0x4b1e84[0x0][_0x2b7db4(0x1a4)]==_0x2b7db4(0x19c))var _0x9ee184=users[_0x2b7db4(0x27c)];else{if(_0x4b1e84[0x0]['language']==_0x2b7db4(0x1dd))var _0x9ee184=users[_0x2b7db4(0x1dd)];else{if(_0x4b1e84[0x0]['language']=='Arabic\x20(ae)')var _0x9ee184=users[_0x2b7db4(0x25a)];}}}}}}}_0x5441aa[_0x2b7db4(0x24a)]('return_purchase_finished',{'success':_0x12acd2['flash'](_0x2b7db4(0x23f)),'errors':_0x12acd2[_0x2b7db4(0x1b7)](_0x2b7db4(0x19e)),'role':_0x125ed7,'profile':_0x23f5a4,'user':_0x575532,'stock':_0x334af0,'master_shop':_0x4b1e84,'product':_0xa56d87,'language':_0x9ee184,'warehouse':_0x3d13b1});}catch(_0x51b3d4){console[_0x2b7db4(0x231)](_0x51b3d4);}}),router[a0_0x316e4e(0x1ed)](a0_0x316e4e(0x230),auth,async(_0x204a57,_0x4cc808)=>{var _0x163853=a0_0x316e4e;try{const {invoice:_0x4c6407,date:_0x29fe8f,warehouse_name:_0x3836d2,Room_name:_0x4de396,product_name:_0x54bd56,purchase_quantity:_0x52cbb8,stocks:_0x5e62ce,return_qty:_0x111149,note:_0x234fb5,level:_0x5c9967,isle:_0x5e64e2,pallet:_0x545c8f,to_warehouse_name:_0xb39393,to_Room_name:_0x2a5d33}=_0x204a57[_0x163853(0x1df)],_0x404ca7=await purchases_finished[_0x163853(0x285)]({'_id':_0x204a57[_0x163853(0x1e4)]['id']}),_0xadfab7=await warehouse[_0x163853(0x285)]({'name':_0x3836d2,'room':_0x4de396,'warehouse_category':'Finished\x20Goods'});if(typeof _0x54bd56==_0x163853(0x1ee))var _0x1a95f3=[_0x204a57['body']['product_name']],_0x1b9733=[_0x204a57[_0x163853(0x1df)]['purchase_quantity']],_0x2fced4=[_0x204a57[_0x163853(0x1df)][_0x163853(0x276)]],_0x8ba889=[_0x204a57['body']['return_qty']],_0x453dd4=[_0x204a57[_0x163853(0x1df)]['level']],_0x2c85b5=[_0x204a57[_0x163853(0x1df)][_0x163853(0x212)]],_0x32b475=[_0x204a57[_0x163853(0x1df)]['primary_code_hide']],_0x464fe1=[_0x204a57['body'][_0x163853(0x1b4)]];else var _0x1a95f3=[..._0x204a57[_0x163853(0x1df)][_0x163853(0x1e9)]],_0x1b9733=[..._0x204a57[_0x163853(0x1df)]['purchase_quantity']],_0x2fced4=[..._0x204a57['body'][_0x163853(0x276)]],_0x8ba889=[..._0x204a57['body'][_0x163853(0x1f3)]],_0x453dd4=[..._0x204a57[_0x163853(0x1df)][_0x163853(0x1c9)]],_0x2c85b5=[..._0x204a57[_0x163853(0x1df)]['product_code_hide']],_0x32b475=[..._0x204a57[_0x163853(0x1df)][_0x163853(0x1fd)]],_0x464fe1=[..._0x204a57[_0x163853(0x1df)][_0x163853(0x1b4)]];const _0x18a578=_0x1a95f3[_0x163853(0x18e)](_0x277f36=>{return _0x277f36={'product_name':_0x277f36};});_0x1b9733[_0x163853(0x1b6)]((_0x3b2e90,_0x14ae03)=>{var _0x2bfd9a=_0x163853;_0x18a578[_0x14ae03][_0x2bfd9a(0x255)]=_0x3b2e90;}),_0x2fced4[_0x163853(0x1b6)]((_0xea620a,_0x45b8fe)=>{var _0x49d160=_0x163853;_0x18a578[_0x45b8fe][_0x49d160(0x275)]=_0xea620a;}),_0x8ba889['forEach']((_0x5eb4cf,_0x20cb5c)=>{_0x18a578[_0x20cb5c]['return_qty']=_0x5eb4cf;}),_0x453dd4[_0x163853(0x1b6)]((_0x49d9d3,_0x519059)=>{_0x18a578[_0x519059]['bay']=_0x49d9d3;}),_0x2c85b5[_0x163853(0x1b6)]((_0x2999d0,_0x130ba3)=>{_0x18a578[_0x130ba3]['product_code']=_0x2999d0;}),_0x32b475['forEach']((_0x3a3ba5,_0x40146c)=>{_0x18a578[_0x40146c]['primary_code']=_0x3a3ba5;}),_0x464fe1[_0x163853(0x1b6)]((_0x473c3c,_0x370307)=>{var _0x4fd70f=_0x163853;_0x18a578[_0x370307][_0x4fd70f(0x240)]=_0x473c3c;}),_0x18a578[_0x163853(0x1b6)](_0x5d50f5=>{var _0x56e1c2=_0x163853;console[_0x56e1c2(0x231)](_0x5d50f5);const _0x3a5e7a=_0xadfab7[_0x56e1c2(0x218)][_0x56e1c2(0x18e)](_0x5d7699=>{var _0x2207bb=_0x56e1c2;_0x5d7699[_0x2207bb(0x1e9)]==_0x5d50f5[_0x2207bb(0x1e9)]&&_0x5d7699['bay']==_0x5d50f5[_0x2207bb(0x1d1)]&&(console[_0x2207bb(0x231)](parseInt(_0x5d7699[_0x2207bb(0x19b)])+_0x2207bb(0x229)+parseInt(_0x5d50f5[_0x2207bb(0x1f3)])),_0x5d7699['product_stock']=parseInt(_0x5d7699[_0x2207bb(0x19b)])-parseInt(_0x5d50f5[_0x2207bb(0x1f3)]));});}),await _0xadfab7['save']();var _0x3212d8=0x0;_0x18a578['forEach'](_0x45229b=>{var _0x29280d=_0x163853;(parseInt(_0x45229b['purchase_quantity'])<parseInt(_0x45229b[_0x29280d(0x1f3)])||parseInt(_0x45229b[_0x29280d(0x275)])<parseInt(_0x45229b['return_qty']))&&_0x3212d8++;});if(_0x3212d8!=0x0)return _0x204a57['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x4cc808['redirect'](_0x163853(0x20c));const _0x3443b1=new purchases_return_finished({'invoice':_0x4c6407,'suppliers':_0x204a57['body'][_0x163853(0x1fc)],'date':_0x29fe8f,'warehouse_name':_0x3836d2,'return_product':_0x18a578,'note':_0x234fb5,'room':_0x4de396,'to_warehouse_name':_0xb39393,'to_room':_0x2a5d33}),_0x46c9d7=await _0x3443b1['save'](),_0x6e8683=await purchases_return_finished['findOne']({'invoice':_0x4c6407}),_0x35921b=await warehouse['findOne']({'name':_0xb39393,'room':_0x2a5d33,'warehouse_category':_0x163853(0x274)});_0x6e8683['return_product'][_0x163853(0x1b6)](_0x1ea7e5=>{var _0x51e610=_0x163853,_0x5d66ab=0x0;const _0x3e047a=_0x35921b[_0x51e610(0x218)][_0x51e610(0x18e)](_0x260ccb=>{var _0x44a9ba=_0x51e610;console['log'](_0x260ccb['product_name']+'=='+_0x1ea7e5[_0x44a9ba(0x1e9)]+'&&'+_0x260ccb[_0x44a9ba(0x1d1)]+'=='+_0x1ea7e5[_0x44a9ba(0x1d1)]),_0x260ccb['product_name']==_0x1ea7e5[_0x44a9ba(0x1e9)]&&_0x260ccb[_0x44a9ba(0x1d1)]==_0x1ea7e5['bay']&&(_0x260ccb[_0x44a9ba(0x19b)]=parseInt(_0x260ccb[_0x44a9ba(0x19b)])-parseInt(_0x1ea7e5[_0x44a9ba(0x1f3)]),_0x5d66ab++);});_0x5d66ab=='0'&&(_0x35921b['product_details']=_0x35921b[_0x51e610(0x218)][_0x51e610(0x1f6)]({'product_name':_0x1ea7e5[_0x51e610(0x1e9)],'product_stock':_0x1ea7e5[_0x51e610(0x1f3)],'primary_code':_0x1ea7e5[_0x51e610(0x18d)],'secondary_code':_0x1ea7e5[_0x51e610(0x240)],'product_code':_0x1ea7e5[_0x51e610(0x287)],'bay':_0x1ea7e5[_0x51e610(0x1d1)],'maxProducts':0xf423f}));}),await _0x35921b[_0x163853(0x23b)]();const _0x4a10e9=await purchases_finished[_0x163853(0x285)]({'invoice':_0x4c6407});_0x4a10e9[_0x163853(0x1cd)]=_0x163853(0x263);const _0x2507bf=await _0x4a10e9[_0x163853(0x23b)](),_0x158b22=new s_payment_data({'invoice':_0x4c6407,'suppliers':_0x204a57['body'][_0x163853(0x1fc)],'reason':_0x163853(0x1c3)});await _0x158b22[_0x163853(0x23b)]();const _0x254e24=await master_shop[_0x163853(0x1f9)](),_0x2abb21=await email_settings[_0x163853(0x285)](),_0x10b3bb=await suppliers[_0x163853(0x285)]({'name':_0x204a57[_0x163853(0x1df)][_0x163853(0x1fc)]});_0x254e24[0x0][_0x163853(0x26d)]==0x1?(right_currency=_0x254e24[0x0][_0x163853(0x1bb)],left_currency=''):(right_currency='',left_currency=_0x254e24[0x0][_0x163853(0x1bb)]);var _0x24bbe4=_0x1a95f3,_0x4e9985=_0x8ba889,_0x4a3793='',_0x49473c;for(_0x49473c in _0x24bbe4){_0x4a3793+='<tr>'+_0x163853(0x227)+_0x24bbe4[_0x49473c]+_0x163853(0x1bf)+_0x163853(0x227)+_0x4e9985[_0x49473c]+_0x163853(0x1bf)+_0x163853(0x22c);}let _0x44ade4=nodemailer['createTransport']({'service':_0x163853(0x1a0),'auth':{'user':_0x2abb21[_0x163853(0x25f)],'pass':_0x2abb21['password']}}),_0x34f3a9={'from':_0x2abb21['email'],'to':_0x10b3bb[_0x163853(0x25f)],'subject':_0x163853(0x267),'attachments':[{'filename':_0x163853(0x206),'path':__dirname+_0x163853(0x1c2)+_0x163853(0x26f)+_0x254e24[0x0][_0x163853(0x282)],'cid':_0x163853(0x1b9)}],'html':_0x163853(0x1ec)+_0x163853(0x1a6)+_0x163853(0x277)+'<div>'+_0x163853(0x254)+'<div>'+_0x163853(0x25e)+'</div>'+_0x163853(0x20f)+_0x163853(0x1ca)+_0x254e24[0x0][_0x163853(0x252)]+'\x20</h2>'+_0x163853(0x198)+_0x163853(0x198)+_0x163853(0x26e)+'<div>'+_0x163853(0x1d3)+_0x163853(0x20e)+_0x4c6407+'\x20'+_0x163853(0x1e1)+'\x20Order\x20Date\x20:\x20'+_0x29fe8f+'\x20'+_0x163853(0x283)+_0x163853(0x269)+_0x163853(0x198)+_0x163853(0x244)+_0x163853(0x1f0)+'<tr>'+_0x163853(0x1cf)+_0x163853(0x204)+_0x163853(0x213)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x163853(0x22c)+_0x163853(0x19f)+_0x163853(0x1b3)+'\x20'+_0x4a3793+'\x20'+_0x163853(0x24b)+_0x163853(0x20d)+_0x163853(0x20f)+_0x163853(0x232)+_0x163853(0x21e)+_0x254e24[0x0]['site_title']+'</h5>'+'</div>'+_0x163853(0x198)+'</body></html>'};_0x44ade4[_0x163853(0x1c5)](_0x34f3a9,function(_0x3eb42c,_0x22001c){var _0x5bed52=_0x163853;_0x3eb42c?console[_0x5bed52(0x231)](_0x5bed52(0x223)):console[_0x5bed52(0x231)](_0x5bed52(0x191));}),_0x204a57[_0x163853(0x1b7)](_0x163853(0x23f),_0x163853(0x27f)),_0x4cc808['redirect'](_0x163853(0x21f));}catch(_0x46ac7e){_0x4cc808[_0x163853(0x262)](0xc8)[_0x163853(0x1a7)]({'message':_0x46ac7e[_0x163853(0x190)]});}}),router['get'](a0_0x316e4e(0x238),auth,async(_0x2cfcce,_0x53fb93)=>{var _0x2716f9=a0_0x316e4e;try{const {username:_0x2e0808,email:_0x41b237,role:_0x5011f6}=_0x2cfcce['user'],_0x3712db=_0x2cfcce[_0x2716f9(0x241)],_0x55a0aa=await profile['findOne']({'email':_0x3712db['email']}),_0x3e7152=await master_shop[_0x2716f9(0x1f9)](),_0x547175=_0x2cfcce[_0x2716f9(0x1e4)]['id'],_0x3459ed=await purchases_finished[_0x2716f9(0x1fe)](_0x547175);if(_0x3e7152[0x0]['language']==_0x2716f9(0x23c))var _0x3afd89=users[_0x2716f9(0x18f)];else{if(_0x3e7152[0x0]['language']==_0x2716f9(0x272))var _0x3afd89=users[_0x2716f9(0x272)];else{if(_0x3e7152[0x0][_0x2716f9(0x1a4)]==_0x2716f9(0x1bc))var _0x3afd89=users['German'];else{if(_0x3e7152[0x0][_0x2716f9(0x1a4)]==_0x2716f9(0x193))var _0x3afd89=users[_0x2716f9(0x193)];else{if(_0x3e7152[0x0][_0x2716f9(0x1a4)]==_0x2716f9(0x242))var _0x3afd89=users[_0x2716f9(0x242)];else{if(_0x3e7152[0x0][_0x2716f9(0x1a4)]==_0x2716f9(0x19c))var _0x3afd89=users['Portuguese'];else{if(_0x3e7152[0x0][_0x2716f9(0x1a4)]=='Chinese')var _0x3afd89=users[_0x2716f9(0x1dd)];else{if(_0x3e7152[0x0]['language']==_0x2716f9(0x1e6))var _0x3afd89=users[_0x2716f9(0x25a)];}}}}}}}_0x53fb93[_0x2716f9(0x24a)]('all_purchases_barcode',{'success':_0x2cfcce[_0x2716f9(0x1b7)](_0x2716f9(0x23f)),'errors':_0x2cfcce['flash'](_0x2716f9(0x19e)),'role':_0x3712db,'profile':_0x55a0aa,'alldata':_0x3459ed,'master_shop':_0x3e7152,'language':_0x3afd89}),console[_0x2716f9(0x231)](alldata);}catch(_0x3abe8c){console[_0x2716f9(0x231)](_0x3abe8c);}}),router['post'](a0_0x316e4e(0x1f8),async(_0x3d6f6b,_0x59d1b6)=>{var _0x261e74=a0_0x316e4e;const {product_code:_0x2407b3}=_0x3d6f6b['body'];var _0x2a8494;const _0x32a657=await product[_0x261e74(0x256)]([{'$match':{'primary_code':_0x2407b3,'product_category':_0x261e74(0x274)}},{'$group':{'_id':_0x261e74(0x1af),'name':{'$first':'$name'},'category':{'$first':_0x261e74(0x195)},'brand':{'$first':_0x261e74(0x24d)},'unit':{'$first':_0x261e74(0x1de)},'alertquantity':{'$first':_0x261e74(0x22e)},'product_code':{'$first':_0x261e74(0x1a5)},'primary_code':{'$first':_0x261e74(0x1b2)},'secondary_code':{'$first':_0x261e74(0x1c4)},'maxStocks':{'$first':_0x261e74(0x25c)},'maxProdPerUnit':{'$first':_0x261e74(0x273)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x261e74(0x279)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x409ae0=await product['aggregate']([{'$match':{'secondary_code':_0x2407b3}},{'$group':{'_id':'$_id','name':{'$first':_0x261e74(0x266)},'category':{'$first':_0x261e74(0x195)},'brand':{'$first':_0x261e74(0x24d)},'unit':{'$first':_0x261e74(0x1de)},'alertquantity':{'$first':_0x261e74(0x22e)},'product_code':{'$first':_0x261e74(0x1a5)},'primary_code':{'$first':_0x261e74(0x1b2)},'secondary_code':{'$first':_0x261e74(0x1c4)},'maxStocks':{'$first':_0x261e74(0x25c)},'maxProdPerUnit':{'$first':_0x261e74(0x273)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x261e74(0x279)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x32a657['length']>0x0)_0x2a8494=_0x32a657;else _0x409ae0[_0x261e74(0x22a)]>0x0&&(_0x2a8494=_0x409ae0);_0x59d1b6[_0x261e74(0x1a7)](_0x2a8494);}),router[a0_0x316e4e(0x1ed)](a0_0x316e4e(0x1fa),async(_0x5a9e8e,_0x593b6a)=>{var _0x2107cf=a0_0x316e4e;const {productCode:_0x45fc11,bay:_0x45e2e3,warehouses:_0x5481e0,room:_0x5d6032}=_0x5a9e8e[_0x2107cf(0x1df)];console['log'](_0x5a9e8e['body']);try{const _0x5b4de8=await warehouse[_0x2107cf(0x256)]([{'$match':{'name':_0x5481e0,'room':_0x5d6032}},{'$unwind':_0x2107cf(0x246)},{'$match':{'product_details.bay':parseInt(_0x45e2e3)}},{'$group':{'_id':_0x2107cf(0x222),'name':{'$first':_0x2107cf(0x18b)},'product_stock':{'$first':_0x2107cf(0x25b)},'bay':{'$first':_0x2107cf(0x1a2)},'maxProducts':{'$first':_0x2107cf(0x1d2)}}}]);_0x593b6a['status'](0xc8)[_0x2107cf(0x1a7)](_0x5b4de8);}catch(_0xbefe8a){_0x593b6a[_0x2107cf(0x262)](0x194)[_0x2107cf(0x1a7)]({'message':_0xbefe8a[_0x2107cf(0x190)]});}}),module['exports']=router;