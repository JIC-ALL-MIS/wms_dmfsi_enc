var a0_0x40ea51=a0_0x53e1;(function(_0x84d324,_0x187437){var _0x373525=a0_0x53e1,_0x4af1be=_0x84d324();while(!![]){try{var _0x1acd37=parseInt(_0x373525(0x21c))/0x1+-parseInt(_0x373525(0x1eb))/0x2*(-parseInt(_0x373525(0x235))/0x3)+-parseInt(_0x373525(0x1f3))/0x4*(parseInt(_0x373525(0x14e))/0x5)+-parseInt(_0x373525(0x213))/0x6+parseInt(_0x373525(0x21b))/0x7*(-parseInt(_0x373525(0x216))/0x8)+parseInt(_0x373525(0x18b))/0x9*(-parseInt(_0x373525(0x1c9))/0xa)+-parseInt(_0x373525(0x1ca))/0xb*(-parseInt(_0x373525(0x22a))/0xc);if(_0x1acd37===_0x187437)break;else _0x4af1be['push'](_0x4af1be['shift']());}catch(_0x17c587){_0x4af1be['push'](_0x4af1be['shift']());}}}(a0_0x3c05,0x566c0));const express=require(a0_0x40ea51(0x195)),app=express(),router=express[a0_0x40ea51(0x1fd)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x40ea51(0x166)),auth=require('../middleware/auth'),nodemailer=require(a0_0x40ea51(0x221));var ejs=require(a0_0x40ea51(0x1d0));const path=require(a0_0x40ea51(0x1f7)),users=require(a0_0x40ea51(0x184));router[a0_0x40ea51(0x167)](a0_0x40ea51(0x1bb),auth,async(_0x1c06ce,_0x31cb7f)=>{var _0x28e688=a0_0x40ea51;try{const {username:_0x21e6ca,email:_0x1594ef,role:_0x3b7540}=_0x1c06ce[_0x28e688(0x1c7)],_0x4f6700=_0x1c06ce['user'],_0x184a18=await profile['findOne']({'email':_0x4f6700[_0x28e688(0x215)]}),_0xe8567f=await staff[_0x28e688(0x1c3)]({'email':_0x4f6700['email']});if(_0x4f6700[_0x28e688(0x230)]==_0x28e688(0x164)){const _0x46d148=await staff[_0x28e688(0x1c3)]({'email':_0x4f6700[_0x28e688(0x215)]});}const _0x12750f=await master_shop['find']();let _0x33de59;if(_0x4f6700[_0x28e688(0x230)]==_0x28e688(0x164)){const _0x5edf8c=await staff['findOne']({'email':_0x4f6700[_0x28e688(0x215)]});_0x33de59=await purchases_finished[_0x28e688(0x1ba)]([{'$match':{'warehouse_name':_0x5edf8c['warehouse']}},{'$lookup':{'from':_0x28e688(0x1df),'localField':_0x28e688(0x1df),'foreignField':_0x28e688(0x21a),'as':_0x28e688(0x200)}},{'$unwind':_0x28e688(0x1b3)},{'$unwind':'$product'},{'$group':{'_id':_0x28e688(0x1d5),'invoice':{'$first':_0x28e688(0x15d)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x28e688(0x228)},'room':{'$first':_0x28e688(0x19f)},'product':{'$push':_0x28e688(0x204)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x28e688(0x22e)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x28e688(0x162)},'suppliers_docs':{'$first':_0x28e688(0x1b3)},'total_product_quantity':{'$sum':_0x28e688(0x15f)},'level':{'$addToSet':_0x28e688(0x22b)},'isle':{'$addToSet':_0x28e688(0x1dd)},'type':{'$addToSet':_0x28e688(0x16c)},'floorlevel':{'$addToSet':_0x28e688(0x197)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x33de59=await purchases_finished[_0x28e688(0x1ba)]([{'$unwind':_0x28e688(0x204)},{'$group':{'_id':_0x28e688(0x1d5),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x28e688(0x207)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x28e688(0x228)},'room':{'$addToSet':_0x28e688(0x14a)},'product':{'$push':_0x28e688(0x204)},'note':{'$first':_0x28e688(0x176)},'paid_amount':{'$first':_0x28e688(0x206)},'due_amount':{'$first':_0x28e688(0x22e)},'return_data':{'$first':_0x28e688(0x187)},'batch_code':{'$first':_0x28e688(0x18f)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x28e688(0x1b3)},'total_product_quantity':{'$sum':_0x28e688(0x15f)},'level':{'$addToSet':_0x28e688(0x22b)},'isle':{'$addToSet':_0x28e688(0x1dd)},'type':{'$addToSet':_0x28e688(0x16c)},'floorlevel':{'$addToSet':_0x28e688(0x197)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x12750f[0x0][_0x28e688(0x1da)]==_0x28e688(0x214))var _0x23bc67=users['English'];else{if(_0x12750f[0x0][_0x28e688(0x1da)]==_0x28e688(0x21e))var _0x23bc67=users[_0x28e688(0x21e)];else{if(_0x12750f[0x0]['language']==_0x28e688(0x1b0))var _0x23bc67=users[_0x28e688(0x1b0)];else{if(_0x12750f[0x0][_0x28e688(0x1da)]==_0x28e688(0x202))var _0x23bc67=users['Spanish'];else{if(_0x12750f[0x0]['language']==_0x28e688(0x203))var _0x23bc67=users[_0x28e688(0x203)];else{if(_0x12750f[0x0][_0x28e688(0x1da)]==_0x28e688(0x150))var _0x23bc67=users[_0x28e688(0x22f)];else{if(_0x12750f[0x0][_0x28e688(0x1da)]==_0x28e688(0x1f6))var _0x23bc67=users[_0x28e688(0x1f6)];else{if(_0x12750f[0x0][_0x28e688(0x1da)]=='Arabic\x20(ae)')var _0x23bc67=users[_0x28e688(0x158)];}}}}}}}_0x31cb7f[_0x28e688(0x1f8)](_0x28e688(0x1d2),{'success':_0x1c06ce['flash'](_0x28e688(0x1af)),'errors':_0x1c06ce[_0x28e688(0x19e)]('errors'),'purchases':_0x33de59,'role':_0x4f6700,'profile':_0x184a18,'master_shop':_0x12750f,'language':_0x23bc67});}catch(_0x23b0a2){console['log'](_0x28e688(0x1e2),_0x23b0a2),_0x31cb7f[_0x28e688(0x223)](0xc8)['json']({'message':_0x23b0a2[_0x28e688(0x1db)]});}});function BayBinSelected(_0x43ebca,_0x5a2cf7){var _0x4b97d3=a0_0x40ea51,_0x532b9b=[],_0x2755ca=[];if(_0x43ebca==_0x4b97d3(0x14b)){switch(_0x5a2cf7){case _0x4b97d3(0x17f):_0x532b9b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x4b97d3(0x234):_0x532b9b=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2755ca=['DG'];}else{if(_0x43ebca==_0x4b97d3(0x1c2)){switch(_0x5a2cf7){case _0x4b97d3(0x17f):_0x532b9b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4b97d3(0x234):_0x532b9b=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2755ca=['FG'];}}return{'levels':_0x532b9b,'identify':_0x2755ca};}function a0_0x3c05(){var _0x2514ef=['/view/return_purchase/:id','name','1310204tFlNrG','626968utIsqc','getMonth','Hindi','product_name','/view/add_purchases/:id','nodemailer','Error\x20Occurs','status','$name','</td>','log','/invoice/:id','$warehouse_name','<strong>\x20Regards\x20</strong>','33780gNpaFU','$product.bay','$product_details.secondary_code','product','$due_amount','Portuguese','role','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</div>','room','Rack\x202','15uIJBSd','amount','post','</tr>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_date','$maxStocks','stock_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Purchase\x20Return','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','room_name','currency','error','<h5>','maxStocks','date','prod_secondunit','<html><head><title></title>','Email\x20sent\x20successfully','Enabled','/view/:id','site_title','$product.room_name','DRY\x20GOODS','slice','prod_unit','233515lmHTiy','prod_code','Portuguese\x20(BR)','paid_amount','\x20Order\x20Number\x20:\x20','$alertquantity','standard_unit','warehouse_name','prod_cat','product_details','Arabic','random','<tr>','</thead>','sendMail','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product.quantity','/CheckingWarehouse','updateOne','$expiry_date','MaxStocks_data','staff','/../public','../models/all_models','get','\x20</h2>','invoice','Return\x20Goods','prod_primunit','$product.type','due_amount','bay','$maxProdPerUnit','<hr\x20class=\x22my-3\x22>','$secondary_code','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','abs','Error\x20occurred\x20while\x20processing\x20product:','$note','forEach','Purchase\x20Mail','expiry_date','Arabic\x20(ae)','product_cat','secondary_code','$category','$product_details.rack','Rack\x201','exports','</table>','string','purchase_quantity','../public/language/languages.json','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$return_data','floor','maxperunit','save','2403oADvnQ','\x20Order\x20Date\x20:\x20','$product_details.bin','secondary_code_hide','$batch_code','getDate','$product_details._id','createTransport','<h2>\x20','/barcode_scanner','express','/preview/:id','$product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.floorlevel','body','$product_details.product_name','Enclosed','params','flash','$room','product_code','getFullYear','catch','/view/add_purchases','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','max_product_unit','$product_details.type','English','stocks','$product_details.maxProducts','redirect','\x20<>\x20','An\x20error\x20occurred\x20while\x20saving\x20data.','findById','production_date','success','German','concat','Purchase\x20Return\x20Mail','$suppliers_docs','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','currency_placement','length','image','then','aggregate','/view','master','INCF-','prod_Qty','errors','payment\x20successfull','<!DOCTYPE\x20html>','FROZEN\x20GOODS','findOne','purchases\x20item\x20return\x20successfull','prod_name','</body></html>','user','warehouse','25470GGqNxD','4631TvJKLB','product_stock','$product_details','$product_details.bay','prod_level','$product_details.product_stock','ejs','edit_purchases_finished','all_purchases_finished','filter','True','$_id','add_purchases_finished','find','QA\x20Warehouse','password','language','message','/all_purchases/view','$product.bin','back','suppliers','$unit','prod_invoice','table\x20page','/upload/','primary_code','$product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$brand','logo','</tbody>','Logo.png','133702uXfXvq','return_product','Paid\x20For\x20Purchase','return_purchase_finished','add_purchases\x20error','</h5>','</head><body>','/all_purchases_finished/view','4nwvrKs','secondary_unit','JO_number','Chinese','path','render','quantity','RoomAssign','<div>','prod_qty','Router','<h5\x20style=\x22text-align:\x20left;\x22>','product_code_hide','suppliers_docs','all','Spanish','French','$product','$product_details.storage','$paid_amount','$suppliers','user_id','host','/barcode/:id','$secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','primary_code_hide','<span\x20style=\x22float:\x20right;\x22>','$product_details.primary_code','</span>','return_qty','json','3024516qXLLkD','English\x20(US)','email','24tJUPhD','map','Room_name'];a0_0x3c05=function(){return _0x2514ef;};return a0_0x3c05();}function a0_0x53e1(_0x4e3b67,_0x2df9eb){var _0x3c056f=a0_0x3c05();return a0_0x53e1=function(_0x53e17a,_0x23612d){_0x53e17a=_0x53e17a-0x13d;var _0x2a83b0=_0x3c056f[_0x53e17a];return _0x2a83b0;},a0_0x53e1(_0x4e3b67,_0x2df9eb);}async function getRandom8DigitNumber(){var _0x58515f=a0_0x40ea51;const _0x2d25ac=0x989680,_0x44423a=0x5f5e0ff,_0x3d3291=Math[_0x58515f(0x188)](Math[_0x58515f(0x159)]()*(_0x44423a-_0x2d25ac+0x1))+_0x2d25ac;var _0x16ee23;const _0x5dc8a9=await purchases_finished[_0x58515f(0x1c3)]({'invoice':_0x58515f(0x1bd)+_0x3d3291});return _0x5dc8a9&&_0x5dc8a9[_0x58515f(0x1b7)]>0x0?_0x16ee23=_0x58515f(0x1bd)+_0x3d3291:_0x16ee23=_0x58515f(0x1bd)+_0x3d3291,_0x16ee23;}router['get'](a0_0x40ea51(0x1a3),auth,async(_0x4fa86a,_0x463951)=>{var _0x48cfce=a0_0x40ea51;try{const {username:_0x46c6a8,email:_0x1b37ee,role:_0xe64366}=_0x4fa86a[_0x48cfce(0x1c7)],_0x2403a4=_0x4fa86a[_0x48cfce(0x1c7)],_0x12b5ae=await profile[_0x48cfce(0x1c3)]({'email':_0x2403a4[_0x48cfce(0x215)]}),_0x790469=await master_shop[_0x48cfce(0x1d7)](),_0x584bb8=await staff[_0x48cfce(0x1c3)]({'email':_0x2403a4[_0x48cfce(0x215)]}),_0x2a5c0d=await suppliers[_0x48cfce(0x1d7)]({});let _0x8419ca;if(_0x2403a4[_0x48cfce(0x230)]==_0x48cfce(0x164)){const _0x9030fb=await staff[_0x48cfce(0x1c3)]({'email':_0x2403a4['email']});_0x8419ca=await warehouse[_0x48cfce(0x1ba)]([{'$match':{'status':_0x48cfce(0x147),'name':_0x9030fb[_0x48cfce(0x1c8)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x48cfce(0x224)}}}]);}else _0x8419ca=await warehouse[_0x48cfce(0x1ba)]([{'$match':{'status':_0x48cfce(0x147),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x48cfce(0x1d8)}}},{'$group':{'_id':'$name','name':{'$first':_0x48cfce(0x224)}}}]);const _0x4d8daf=await product[_0x48cfce(0x1d7)]({}),_0x1cf0bc=await warehouse['find']({'status':_0x48cfce(0x147)}),_0x2fa55e=await purchases_finished[_0x48cfce(0x1d7)]({}),_0x1a8853=_0x2fa55e['length']+0x1,_0x5ed750=_0x48cfce(0x1bd)+_0x1a8853['toString']()['padStart'](0x5,'0');var _0x2c510a=['Ambient',_0x48cfce(0x19c)];if(_0x790469[0x0][_0x48cfce(0x1da)]==_0x48cfce(0x214))var _0x213fff=users['English'];else{if(_0x790469[0x0][_0x48cfce(0x1da)]==_0x48cfce(0x21e))var _0x213fff=users[_0x48cfce(0x21e)];else{if(_0x790469[0x0]['language']=='German')var _0x213fff=users['German'];else{if(_0x790469[0x0][_0x48cfce(0x1da)]=='Spanish')var _0x213fff=users[_0x48cfce(0x202)];else{if(_0x790469[0x0]['language']==_0x48cfce(0x203))var _0x213fff=users[_0x48cfce(0x203)];else{if(_0x790469[0x0]['language']=='Portuguese\x20(BR)')var _0x213fff=users['Portuguese'];else{if(_0x790469[0x0][_0x48cfce(0x1da)]==_0x48cfce(0x1f6))var _0x213fff=users['Chinese'];else{if(_0x790469[0x0][_0x48cfce(0x1da)]==_0x48cfce(0x17a))var _0x213fff=users[_0x48cfce(0x158)];}}}}}}}const _0x4fd421=getRandom8DigitNumber();_0x4fd421[_0x48cfce(0x1b9)](_0x5c05e7=>{var _0x3622b6=_0x48cfce;_0x463951['render'](_0x3622b6(0x1d6),{'success':_0x4fa86a[_0x3622b6(0x19e)](_0x3622b6(0x1af)),'errors':_0x4fa86a[_0x3622b6(0x19e)]('errors'),'role':_0x2403a4,'profile':_0x12b5ae,'suppliers':_0x2a5c0d,'warehouse':_0x8419ca,'product':_0x4d8daf,'invoice':_0x5c05e7,'master_shop':_0x790469,'language':_0x213fff,'find_data':_0x1cf0bc,'rooms_data':_0x2c510a});})[_0x48cfce(0x1a2)](_0x1170ca=>{var _0x32aa06=_0x48cfce;_0x4fa86a['flash'](_0x32aa06(0x1bf),_0x32aa06(0x231)),_0x463951[_0x32aa06(0x1aa)](_0x32aa06(0x1f2));});}catch(_0x1a22e6){console[_0x48cfce(0x226)](_0x1a22e6);}}),router[a0_0x40ea51(0x167)](a0_0x40ea51(0x220),auth,async(_0xa5edaa,_0x45d838)=>{var _0x917dd4=a0_0x40ea51;try{const _0x230016=_0xa5edaa[_0x917dd4(0x19d)]['id'];console[_0x917dd4(0x226)](_0x230016);const _0x4776f7=await master_shop[_0x917dd4(0x1d7)]();console[_0x917dd4(0x226)](_0x917dd4(0x1bc),_0x4776f7);const _0x4565b8=await product[_0x917dd4(0x1c3)]({'name':_0x230016});console[_0x917dd4(0x226)](_0x917dd4(0x22d),_0x4565b8),_0x45d838[_0x917dd4(0x223)](0xc8)[_0x917dd4(0x212)]({'product_data':_0x4565b8,'master':_0x4776f7});}catch(_0x168fba){console[_0x917dd4(0x226)](_0x917dd4(0x1ef),_0x168fba);}}),router[a0_0x40ea51(0x237)]('/view/add_purchases',auth,async(_0x4ed4d0,_0x19fdb0)=>{var _0xf7d4f7=a0_0x40ea51;try{const {invoice:_0x30f992,date:_0x5e7fe2,warehouse_name:_0xbec067,prod_name:_0x3119fb,prod_code:_0x4b026b,prod_qty:_0x5ca971,prod_unit:_0x4c9ecc,prod_secondunit:_0x2b5436,prod_level:_0x86fadc,prod_isle:_0x41765c,prod_pallet:_0x59a7e5,note:_0x33c928,expiry_date:_0x50a0cf,batch_code:_0x142477,payable:_0x14f774,due_amount:_0x3a122a,Room_name:_0x1f189a,primary_code:_0x449bc7,secondary_code:_0x22b031,MaxStocks_data:_0x3b25b0,PO_number:_0x3152d2,SCRN:_0x36b6d1,JO_number:_0x11b8fd}=_0x4ed4d0[_0xf7d4f7(0x19a)];if(typeof _0x3119fb=='string')var _0x3b1a3d=[_0x4ed4d0['body'][_0xf7d4f7(0x1c5)]],_0x4e0ea9=[_0x4ed4d0['body'][_0xf7d4f7(0x14f)]],_0x22d5fa=[_0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1be)]],_0x4361a8=[_0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x16b)]],_0x112983=[_0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x144)]],_0x4fd871=[_0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1ce)]],_0x32cd93=[_0x4ed4d0[_0xf7d4f7(0x19a)]['primary_code']],_0x57b890=[_0x4ed4d0['body'][_0xf7d4f7(0x17c)]],_0x457ae0=[_0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x163)]],_0x2b1159=[_0x4ed4d0[_0xf7d4f7(0x19a)]['batch_code']],_0x525ddc=[_0x4ed4d0[_0xf7d4f7(0x19a)]['expiry_date']],_0x459903=[_0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x23a)]],_0x417aff=[_0x4ed4d0['body'][_0xf7d4f7(0x1a5)]],_0x5c21da=[_0x4ed4d0['body']['prod_cat']],_0x3af040=[_0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1fa)]],_0xb118e8=[_0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1e1)]];else var _0x3b1a3d=[..._0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1c5)]],_0x4e0ea9=[..._0x4ed4d0['body'][_0xf7d4f7(0x14f)]],_0x22d5fa=[..._0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1be)]],_0x4361a8=[..._0x4ed4d0['body']['prod_primunit']],_0x112983=[..._0x4ed4d0[_0xf7d4f7(0x19a)]['prod_secondunit']],_0x4fd871=[..._0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1ce)]],_0x32cd93=[..._0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1e4)]],_0x57b890=[..._0x4ed4d0[_0xf7d4f7(0x19a)]['secondary_code']],_0x457ae0=[..._0x4ed4d0[_0xf7d4f7(0x19a)]['MaxStocks_data']],_0x2b1159=[..._0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1b4)]],_0x525ddc=[..._0x4ed4d0[_0xf7d4f7(0x19a)]['expiry_date']],_0x459903=[..._0x4ed4d0[_0xf7d4f7(0x19a)]['product_date']],_0x417aff=[..._0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1a5)]],_0x5c21da=[..._0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x156)]],_0x3af040=[..._0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1fa)]],_0xb118e8=[..._0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1e1)]];const _0x23ee8f=_0x3b1a3d[_0xf7d4f7(0x217)](_0x21467a=>{return _0x21467a={'product_name':_0x21467a};});_0x4e0ea9[_0xf7d4f7(0x177)]((_0x440e40,_0x4c1cf7)=>{var _0x2bcac0=_0xf7d4f7;_0x23ee8f[_0x4c1cf7][_0x2bcac0(0x1a0)]=_0x440e40;}),_0x22d5fa[_0xf7d4f7(0x177)]((_0x4af482,_0x5304f2)=>{var _0x21987d=_0xf7d4f7;_0x23ee8f[_0x5304f2][_0x21987d(0x1f9)]=Math[_0x21987d(0x174)](_0x4af482);}),_0x4361a8['forEach']((_0x17a262,_0x2bb7fe)=>{var _0xfc7f8b=_0xf7d4f7;_0x23ee8f[_0x2bb7fe][_0xfc7f8b(0x154)]=_0x17a262;}),_0x112983[_0xf7d4f7(0x177)]((_0x555370,_0x58b881)=>{var _0x299e8b=_0xf7d4f7;_0x23ee8f[_0x58b881][_0x299e8b(0x1f4)]=_0x555370;}),_0x4fd871[_0xf7d4f7(0x177)]((_0x144a59,_0x137f08)=>{_0x23ee8f[_0x137f08]['bay']=_0x144a59;}),_0x32cd93[_0xf7d4f7(0x177)]((_0x21b9df,_0x3b6db8)=>{var _0x3f9eee=_0xf7d4f7;_0x23ee8f[_0x3b6db8][_0x3f9eee(0x1e4)]=_0x21b9df;}),_0x57b890[_0xf7d4f7(0x177)]((_0x103e0d,_0x566990)=>{_0x23ee8f[_0x566990]['secondary_code']=_0x103e0d;}),_0x457ae0[_0xf7d4f7(0x177)]((_0x5d06a4,_0xae0c49)=>{var _0x31c52f=_0xf7d4f7;_0x23ee8f[_0xae0c49][_0x31c52f(0x142)]=_0x5d06a4;}),_0x2b1159[_0xf7d4f7(0x177)]((_0x177659,_0x54f52f)=>{var _0x387f8b=_0xf7d4f7;_0x23ee8f[_0x54f52f][_0x387f8b(0x1b4)]=_0x177659;}),_0x525ddc['forEach']((_0x2e97bc,_0x5f0172)=>{var _0x311e71=_0xf7d4f7;_0x23ee8f[_0x5f0172][_0x311e71(0x179)]=_0x2e97bc;}),_0x459903[_0xf7d4f7(0x177)]((_0x511795,_0x47e438)=>{var _0x207158=_0xf7d4f7;_0x23ee8f[_0x47e438][_0x207158(0x1ae)]=_0x511795;}),_0x417aff['forEach']((_0x13e4ff,_0x1c91c0)=>{var _0x1c1ae4=_0xf7d4f7;_0x23ee8f[_0x1c91c0][_0x1c1ae4(0x189)]=_0x13e4ff;}),_0x5c21da[_0xf7d4f7(0x177)]((_0x5ac200,_0x75d6ea)=>{var _0x367e5a=_0xf7d4f7;_0x23ee8f[_0x75d6ea][_0x367e5a(0x17b)]=_0x5ac200;}),_0x3af040[_0xf7d4f7(0x177)]((_0x4b0edd,_0x33fdf9)=>{_0x23ee8f[_0x33fdf9]['room_name']=_0x4b0edd;}),_0xb118e8[_0xf7d4f7(0x177)]((_0x4bcba9,_0x384006)=>{var _0x1d52f6=_0xf7d4f7;_0x23ee8f[_0x384006][_0x1d52f6(0x169)]=_0x4bcba9;});const _0x3bacf2=_0x23ee8f[_0xf7d4f7(0x1d3)](_0xe8e2c5=>_0xe8e2c5['quantity']!=='0'&&_0xe8e2c5['quantity']!==''),_0x17734b=new purchases_finished({'invoice':_0x30f992,'suppliers':_0x4ed4d0[_0xf7d4f7(0x19a)][_0xf7d4f7(0x1df)],'date':_0x5e7fe2,'warehouse_name':_0xbec067,'product':_0x3bacf2,'note':_0x33c928,'due_amount':_0x3a122a,'room':_0x1f189a,'POnumber':_0x3152d2,'SCRN':_0x36b6d1,'JO_number':_0x11b8fd}),_0x4431de=await _0x17734b['save'](),_0x1cf269=await purchases_finished['findOne']({'invoice':_0x30f992}),_0x3fc41c=_0x1cf269[_0xf7d4f7(0x22d)][_0xf7d4f7(0x217)](async _0x58de9b=>{var _0x4936cb=_0xf7d4f7;try{var _0x325771=await warehouse[_0x4936cb(0x1c3)]({'name':_0xbec067,'room':_0x58de9b[_0x4936cb(0x13e)]}),_0x1e4cf9=0x0;const _0x34d5a1=_0x325771['product_details'][_0x4936cb(0x217)](_0x17f32e=>{var _0x5c091d=_0x4936cb;console[_0x5c091d(0x226)](_0x17f32e[_0x5c091d(0x21f)]+'=='+_0x58de9b['product_name']+'&&'+_0x17f32e[_0x5c091d(0x16e)]+'=='+_0x58de9b[_0x5c091d(0x16e)]+'&&'+_0x17f32e[_0x5c091d(0x179)]+'=='+_0x58de9b['expiry_date']+'&&'+_0x17f32e['production_date']+'=='+_0x58de9b[_0x5c091d(0x1ae)]+'&&'+_0x17f32e[_0x5c091d(0x1b4)]+'=='+_0x58de9b[_0x5c091d(0x1b4)]+'&&'+_0x17f32e[_0x5c091d(0x169)]+'=='+_0x1cf269[_0x5c091d(0x169)]),_0x17f32e[_0x5c091d(0x21f)]==_0x58de9b[_0x5c091d(0x21f)]&&_0x17f32e[_0x5c091d(0x16e)]==_0x58de9b[_0x5c091d(0x16e)]&&_0x17f32e['expiry_date']==_0x58de9b['expiry_date']&&_0x17f32e[_0x5c091d(0x1ae)]==_0x58de9b['production_date']&&_0x17f32e[_0x5c091d(0x1b4)]==_0x58de9b[_0x5c091d(0x1b4)]&&_0x17f32e[_0x5c091d(0x169)]==_0x1cf269[_0x5c091d(0x169)]&&(_0x17f32e[_0x5c091d(0x1cb)]=Math['abs'](_0x17f32e['product_stock'])+Math[_0x5c091d(0x174)](_0x58de9b[_0x5c091d(0x1f9)]),_0x1e4cf9++);});return _0x1e4cf9==0x0&&(_0x325771['product_details']=_0x325771['product_details'][_0x4936cb(0x1b1)]({'product_name':_0x58de9b[_0x4936cb(0x21f)],'product_stock':Math[_0x4936cb(0x174)](_0x58de9b['quantity']),'primary_code':_0x58de9b[_0x4936cb(0x1e4)],'secondary_code':_0x58de9b['secondary_code'],'product_code':_0x58de9b[_0x4936cb(0x1a0)],'bay':_0x58de9b[_0x4936cb(0x16e)],'maxProducts':_0x58de9b['maxStocks'],'unit':_0x58de9b['standard_unit'],'secondary_unit':_0x58de9b[_0x4936cb(0x1f4)],'expiry_date':_0x58de9b[_0x4936cb(0x179)],'production_date':_0x58de9b[_0x4936cb(0x1ae)],'maxProducts':_0x58de9b[_0x4936cb(0x142)],'maxPerUnit':_0x58de9b['maxperunit'],'batch_code':_0x58de9b[_0x4936cb(0x1b4)],'product_cat':_0x58de9b[_0x4936cb(0x17b)],'invoice':_0x58de9b['invoice'],'id_incoming':_0x58de9b[_0x4936cb(0x172)]})),_0x325771;}catch(_0x43cebf){return console['error'](_0x4936cb(0x175),_0x43cebf),null;}});Promise[_0xf7d4f7(0x201)](_0x3fc41c)['then'](async _0x27fa81=>{var _0x1e6120=_0xf7d4f7;try{for(const _0x94a0c3 of _0x27fa81){await warehouse[_0x1e6120(0x161)]({'_id':_0x94a0c3[_0x1e6120(0x172)]},{'$addToSet':{'product_details':{'$each':_0x94a0c3[_0x1e6120(0x157)]}}});}const _0xb05260=await master_shop[_0x1e6120(0x1d7)](),_0x2fa0ed=await email_settings[_0x1e6120(0x1c3)](),_0x1f1fbd=await supervisor_settings[_0x1e6120(0x1d7)]();var _0xb097fb=_0x1cf269['product'],_0x24a48d='',_0x50f500;for(_0x50f500 in _0xb097fb){var _0xb48fbb='FG';_0x1cf269[_0x1e6120(0x155)]==_0x1e6120(0x14b)&&(_0xb48fbb='DG'),_0x24a48d+='<tr>'+_0x1e6120(0x23f)+_0xb097fb[_0x50f500][_0x1e6120(0x21f)]+'</td>'+_0x1e6120(0x23f)+_0xb097fb[_0x50f500]['product_code']+_0x1e6120(0x225)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xb097fb[_0x50f500][_0x1e6120(0x1f9)]+_0x1e6120(0x225)+_0x1e6120(0x23f)+_0xb097fb[_0x50f500]['standard_unit']+'</td>'+_0x1e6120(0x23f)+_0xb097fb[_0x50f500]['secondary_unit']+_0x1e6120(0x225)+_0x1e6120(0x23f)+_0x1cf269[_0x1e6120(0x155)]+_0x1e6120(0x225)+_0x1e6120(0x23f)+_0xb097fb[_0x50f500]['room_name']+'</td>'+_0x1e6120(0x23f)+_0xb48fbb+_0xb097fb[_0x50f500][_0x1e6120(0x16e)]+_0x1e6120(0x225),'</tr>';}let _0x22a87a=nodemailer['createTransport']({'host':_0x2fa0ed[_0x1e6120(0x209)],'port':Number(_0x2fa0ed['port']),'secure':![],'auth':{'user':_0x2fa0ed[_0x1e6120(0x215)],'pass':_0x2fa0ed[_0x1e6120(0x1d9)]}}),_0x4a3256={'from':_0x2fa0ed['email'],'to':_0x1f1fbd[0x0]['FGSEmail'],'subject':_0x1e6120(0x178),'attachments':[{'filename':_0x1e6120(0x1ea),'path':__dirname+'/../public'+_0x1e6120(0x1e3)+_0xb05260[0x0][_0x1e6120(0x1b8)],'cid':_0x1e6120(0x1e8)}],'html':_0x1e6120(0x1c1)+_0x1e6120(0x145)+'</head><body>'+'<div>'+_0x1e6120(0x1a4)+_0x1e6120(0x1fb)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1e6120(0x232)+_0x1e6120(0x1fb)+_0x1e6120(0x193)+_0xb05260[0x0][_0x1e6120(0x149)]+_0x1e6120(0x168)+'</div>'+_0x1e6120(0x232)+_0x1e6120(0x170)+_0x1e6120(0x1fb)+_0x1e6120(0x1fe)+'\x20Order\x20Number\x20:\x20'+_0x1cf269[_0x1e6120(0x169)]+'\x20'+_0x1e6120(0x20e)+_0x1e6120(0x18c)+_0x1cf269['date']+'\x20'+_0x1e6120(0x210)+_0x1e6120(0x1f0)+_0x1e6120(0x232)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1e6120(0x239)+_0x1e6120(0x15a)+_0x1e6120(0x20c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x1e6120(0x1e6)+_0x1e6120(0x198)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x1e6120(0x186)+_0x1e6120(0x15e)+_0x1e6120(0x238)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x24a48d+'\x20'+_0x1e6120(0x1e9)+_0x1e6120(0x181)+_0x1e6120(0x1fb)+_0x1e6120(0x229)+_0x1e6120(0x141)+_0xb05260[0x0][_0x1e6120(0x149)]+_0x1e6120(0x1f0)+_0x1e6120(0x232)+_0x1e6120(0x232)+_0x1e6120(0x1c6)};_0x22a87a[_0x1e6120(0x15c)](_0x4a3256,function(_0x256b17,_0x5abead){var _0x4d9297=_0x1e6120;_0x256b17?(console['log'](_0x256b17),console['log'](_0x4d9297(0x222))):console[_0x4d9297(0x226)](_0x4d9297(0x146));});}catch(_0x596488){console[_0x1e6120(0x140)](_0x596488),_0x19fdb0['status'](0x1f4)[_0x1e6120(0x212)]({'error':_0x1e6120(0x1ac),'message':_0x596488['message']});}})[_0xf7d4f7(0x1a2)](_0x19a463=>{var _0x32f6db=_0xf7d4f7;console[_0x32f6db(0x140)](_0x19a463);}),_0x4ed4d0[_0xf7d4f7(0x19e)](_0xf7d4f7(0x1af),'purchase\x20data\x20add\x20successfully'),_0x19fdb0[_0xf7d4f7(0x1aa)]('/all_purchases_finished/view');}catch(_0x2ae724){console[_0xf7d4f7(0x226)](_0x2ae724);}}),router['get'](a0_0x40ea51(0x196),auth,async(_0x2dc49e,_0x4e1cd1)=>{var _0x41076c=a0_0x40ea51;try{const {username:_0x40dd9d,email:_0x13b243,role:_0x584c32}=_0x2dc49e[_0x41076c(0x1c7)],_0x197c3f=_0x2dc49e[_0x41076c(0x1c7)],_0x5e54d7=await profile[_0x41076c(0x1c3)]({'email':_0x197c3f[_0x41076c(0x215)]}),_0x5532db=await master_shop[_0x41076c(0x1d7)](),_0x37bf5a=_0x2dc49e[_0x41076c(0x19d)]['id'],_0x164820=await purchases_finished[_0x41076c(0x1ad)](_0x37bf5a),_0x16c4f7=await suppliers[_0x41076c(0x1d7)]({});let _0x281626;if(_0x197c3f[_0x41076c(0x230)]==_0x41076c(0x164)){const _0x48c867=await staff[_0x41076c(0x1c3)]({'email':_0x197c3f[_0x41076c(0x215)]});_0x281626=await warehouse[_0x41076c(0x1d7)]({'status':'Enabled','name':_0x48c867[_0x41076c(0x1c8)],'warehouse_category':_0x41076c(0x185)});}else _0x281626=await warehouse[_0x41076c(0x1ba)]([{'$match':{'status':'Enabled','warehouse_category':_0x41076c(0x185)}},{'$group':{'_id':_0x41076c(0x224),'name':{'$first':_0x41076c(0x224)}}}]);const _0x4af06a=await product[_0x41076c(0x1d7)]({}),_0x510de8=BayBinSelected(_0x164820[_0x41076c(0x155)],_0x164820[_0x41076c(0x233)]);let _0xa89661=new Date(_0x164820[_0x41076c(0x179)]),_0x14dfe1=('0'+_0xa89661[_0x41076c(0x190)]())['slice'](-0x2),_0x5b1f75=('0'+(_0xa89661[_0x41076c(0x21d)]()+0x1))[_0x41076c(0x14c)](-0x2),_0x5af961=_0xa89661['getFullYear'](),_0x4b40ac=_0x5af961+'-'+_0x5b1f75+'-'+_0x14dfe1;if(_0x5532db[0x0][_0x41076c(0x1da)]==_0x41076c(0x214)){var _0x59969b=users[_0x41076c(0x1a7)];console[_0x41076c(0x226)](_0x59969b);}else{if(_0x5532db[0x0][_0x41076c(0x1da)]==_0x41076c(0x21e))var _0x59969b=users[_0x41076c(0x21e)];else{if(_0x5532db[0x0]['language']==_0x41076c(0x1b0))var _0x59969b=users[_0x41076c(0x1b0)];else{if(_0x5532db[0x0][_0x41076c(0x1da)]=='Spanish')var _0x59969b=users[_0x41076c(0x202)];else{if(_0x5532db[0x0][_0x41076c(0x1da)]==_0x41076c(0x203))var _0x59969b=users[_0x41076c(0x203)];else{if(_0x5532db[0x0][_0x41076c(0x1da)]==_0x41076c(0x150))var _0x59969b=users[_0x41076c(0x22f)];else{if(_0x5532db[0x0][_0x41076c(0x1da)]==_0x41076c(0x1f6))var _0x59969b=users['Chinese'];else{if(_0x5532db[0x0]['language']=='Arabic\x20(ae)')var _0x59969b=users[_0x41076c(0x158)];}}}}}}}_0x4e1cd1[_0x41076c(0x1f8)]('edit_purchases_finished_view',{'success':_0x2dc49e[_0x41076c(0x19e)](_0x41076c(0x1af)),'errors':_0x2dc49e[_0x41076c(0x19e)](_0x41076c(0x1bf)),'role':_0x197c3f,'profile':_0x5e54d7,'purchases':_0x164820,'suppliers':_0x16c4f7,'warehouse':_0x281626,'product':_0x4af06a,'master_shop':_0x5532db,'language':_0x59969b,'ed_fullDate':_0x4b40ac,'dataSelected':_0x510de8});}catch(_0x507cef){console[_0x41076c(0x226)](_0x507cef);}}),router[a0_0x40ea51(0x167)](a0_0x40ea51(0x148),auth,async(_0x5ec4e8,_0x152a2d)=>{var _0x13c792=a0_0x40ea51;try{const {username:_0x10f05b,email:_0xce447c,role:_0x46e39c}=_0x5ec4e8[_0x13c792(0x1c7)],_0x3f1733=_0x5ec4e8[_0x13c792(0x1c7)],_0x4074ce=await profile[_0x13c792(0x1c3)]({'email':_0x3f1733[_0x13c792(0x215)]}),_0x539a4a=await master_shop[_0x13c792(0x1d7)](),_0xf81ba4=_0x5ec4e8[_0x13c792(0x19d)]['id'],_0x6d15c5=await purchases_finished[_0x13c792(0x1ad)](_0xf81ba4),_0x3f8710=await suppliers['find']({});let _0x12ac2f;if(_0x3f1733[_0x13c792(0x230)]==_0x13c792(0x164)){const _0x2bc72d=await staff[_0x13c792(0x1c3)]({'email':_0x3f1733[_0x13c792(0x215)]});_0x12ac2f=await warehouse[_0x13c792(0x1d7)]({'status':'Enabled','name':_0x2bc72d[_0x13c792(0x1c8)],'warehouse_category':_0x13c792(0x185)});}else _0x12ac2f=await warehouse['aggregate']([{'$match':{'status':_0x13c792(0x147),'warehouse_category':_0x13c792(0x185)}},{'$group':{'_id':'$name','name':{'$first':_0x13c792(0x224)}}}]);const _0x4c94c0=await product[_0x13c792(0x1d7)]({}),_0x52583b=BayBinSelected(_0x6d15c5['warehouse_name'],_0x6d15c5[_0x13c792(0x233)]);let _0x17801e=new Date(_0x6d15c5['expiry_date']),_0x25ebdb=('0'+_0x17801e[_0x13c792(0x190)]())[_0x13c792(0x14c)](-0x2),_0x5f1c53=('0'+(_0x17801e[_0x13c792(0x21d)]()+0x1))['slice'](-0x2),_0x1529d2=_0x17801e['getFullYear'](),_0x1dfeff=_0x1529d2+'-'+_0x5f1c53+'-'+_0x25ebdb;if(_0x539a4a[0x0][_0x13c792(0x1da)]==_0x13c792(0x214)){var _0x401980=users['English'];console[_0x13c792(0x226)](_0x401980);}else{if(_0x539a4a[0x0][_0x13c792(0x1da)]==_0x13c792(0x21e))var _0x401980=users[_0x13c792(0x21e)];else{if(_0x539a4a[0x0][_0x13c792(0x1da)]==_0x13c792(0x1b0))var _0x401980=users[_0x13c792(0x1b0)];else{if(_0x539a4a[0x0][_0x13c792(0x1da)]=='Spanish')var _0x401980=users[_0x13c792(0x202)];else{if(_0x539a4a[0x0][_0x13c792(0x1da)]==_0x13c792(0x203))var _0x401980=users[_0x13c792(0x203)];else{if(_0x539a4a[0x0]['language']=='Portuguese\x20(BR)')var _0x401980=users[_0x13c792(0x22f)];else{if(_0x539a4a[0x0][_0x13c792(0x1da)]=='Chinese')var _0x401980=users[_0x13c792(0x1f6)];else{if(_0x539a4a[0x0][_0x13c792(0x1da)]==_0x13c792(0x17a))var _0x401980=users[_0x13c792(0x158)];}}}}}}}_0x152a2d[_0x13c792(0x1f8)](_0x13c792(0x1d1),{'success':_0x5ec4e8['flash'](_0x13c792(0x1af)),'errors':_0x5ec4e8[_0x13c792(0x19e)](_0x13c792(0x1bf)),'role':_0x3f1733,'profile':_0x4074ce,'purchases':_0x6d15c5,'suppliers':_0x3f8710,'warehouse':_0x12ac2f,'product':_0x4c94c0,'master_shop':_0x539a4a,'language':_0x401980,'ed_fullDate':_0x1dfeff,'dataSelected':_0x52583b});}catch(_0x1a3739){console[_0x13c792(0x226)](_0x1a3739);}}),router[a0_0x40ea51(0x237)](a0_0x40ea51(0x148),auth,async(_0x5a0c7d,_0x3901e9)=>{var _0x129263=a0_0x40ea51;try{const _0x22c02b=_0x5a0c7d['params']['id'],_0x1e79eb=await purchases_finished[_0x129263(0x1c3)]({'_id':_0x5a0c7d[_0x129263(0x19d)]['id']}),_0x137aa1=await warehouse[_0x129263(0x1c3)]({'name':_0x1e79eb[_0x129263(0x155)],'room':_0x1e79eb[_0x129263(0x233)]});_0x1e79eb[_0x129263(0x22d)][_0x129263(0x177)](_0x3d8983=>{var _0x4fc5d6=_0x129263;const _0x50d560=_0x137aa1['product_details'][_0x4fc5d6(0x217)](_0x2aad41=>{var _0x46f2b9=_0x4fc5d6;_0x2aad41[_0x46f2b9(0x21f)]==_0x3d8983[_0x46f2b9(0x21f)]&&_0x2aad41[_0x46f2b9(0x16e)]==_0x3d8983['bay']&&(_0x2aad41[_0x46f2b9(0x1cb)]=parseInt(_0x2aad41[_0x46f2b9(0x1cb)])-parseInt(_0x3d8983[_0x46f2b9(0x1f9)]));});}),await _0x137aa1[_0x129263(0x18a)]();const {invoice:_0x27111e,suppliers:_0x36ba20,date:_0x3c5202,warehouse_name:_0x41f84c,prod_name:_0x34be92,prod_code:_0x25a53c,prod_qty:_0x14c54c,prod_unit:_0x52ec2c,prod_secondunit:_0x4bcd4a,prod_level:_0x4140b4,prod_isle:_0x4afdc7,prod_pallet:_0x3133e1,note:_0x4cf9a3,expiry_date:_0x4bd893,batch_code:_0x42febb,paid_amount:_0x20a13c,due_amount:_0x5cc17e,Room_name:_0x52fd1f,primary_code:_0x1cae3c,secondary_code:_0x4bb47b,PO_number:_0x175cd8,JO_number:_0x1cd62b}=_0x5a0c7d['body'];if(typeof _0x34be92==_0x129263(0x182))var _0x6cfac6=[_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x1c5)]],_0xf9f12a=[_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x14f)]],_0x3bb06f=[_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x1fc)]],_0x24e114=[_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x14d)]],_0x3e016e=[_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x144)]],_0x56ae7e=[_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x1ce)]],_0x433c45=[_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x1e4)]],_0x2392f2=[_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x17c)]],_0x510b62=[_0x5a0c7d[_0x129263(0x19a)]['MaxStocks_data']],_0xa9497b=[_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x1b4)]],_0x48bbb4=[_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x179)]];else var _0x6cfac6=[..._0x5a0c7d[_0x129263(0x19a)]['prod_name']],_0xf9f12a=[..._0x5a0c7d[_0x129263(0x19a)]['prod_code']],_0x3bb06f=[..._0x5a0c7d[_0x129263(0x19a)][_0x129263(0x1fc)]],_0x24e114=[..._0x5a0c7d['body']['prod_unit']],_0x3e016e=[..._0x5a0c7d[_0x129263(0x19a)][_0x129263(0x144)]],_0x56ae7e=[..._0x5a0c7d[_0x129263(0x19a)][_0x129263(0x1ce)]],_0x433c45=[..._0x5a0c7d[_0x129263(0x19a)][_0x129263(0x1e4)]],_0x2392f2=[..._0x5a0c7d[_0x129263(0x19a)]['secondary_code']],_0x510b62=[..._0x5a0c7d[_0x129263(0x19a)]['MaxStocks_data']],_0xa9497b=[..._0x5a0c7d[_0x129263(0x19a)][_0x129263(0x1b4)]],_0x48bbb4=[..._0x5a0c7d[_0x129263(0x19a)][_0x129263(0x179)]];const _0x45646a=_0x6cfac6[_0x129263(0x217)](_0x24076c=>{return _0x24076c={'product_name':_0x24076c};});_0xf9f12a[_0x129263(0x177)]((_0x1d1fc0,_0x3091ca)=>{var _0xba37cf=_0x129263;_0x45646a[_0x3091ca][_0xba37cf(0x1a0)]=_0x1d1fc0;}),_0x3bb06f[_0x129263(0x177)]((_0x284963,_0x342655)=>{_0x45646a[_0x342655]['quantity']=_0x284963;}),_0x24e114[_0x129263(0x177)]((_0x3c9559,_0x5a1b3c)=>{var _0x22ad2c=_0x129263;_0x45646a[_0x5a1b3c][_0x22ad2c(0x154)]=_0x3c9559;}),_0x3e016e[_0x129263(0x177)]((_0xa635dd,_0x529b19)=>{_0x45646a[_0x529b19]['secondary_unit']=_0xa635dd;}),_0x56ae7e[_0x129263(0x177)]((_0x384f5f,_0x420737)=>{_0x45646a[_0x420737]['bay']=_0x384f5f;}),_0x433c45['forEach']((_0x3ba99c,_0x3e4d79)=>{var _0x5025d2=_0x129263;_0x45646a[_0x3e4d79][_0x5025d2(0x1e4)]=_0x3ba99c;}),_0x2392f2['forEach']((_0x59aec1,_0x45df9f)=>{var _0x33d9e4=_0x129263;_0x45646a[_0x45df9f][_0x33d9e4(0x17c)]=_0x59aec1;}),_0x510b62[_0x129263(0x177)]((_0x3fa02b,_0x33bf3d)=>{var _0x263043=_0x129263;_0x45646a[_0x33bf3d][_0x263043(0x142)]=_0x3fa02b;}),_0xa9497b[_0x129263(0x177)]((_0x4e68ed,_0x41b9bc)=>{var _0x5d52a1=_0x129263;_0x45646a[_0x41b9bc][_0x5d52a1(0x1b4)]=_0x4e68ed;}),_0x48bbb4[_0x129263(0x177)]((_0x5a34b2,_0x36002d)=>{_0x45646a[_0x36002d]['expiry_date']=_0x5a34b2;});const _0x342431=_0x45646a[_0x129263(0x1d3)](_0x14a79e=>_0x14a79e['quantity']!=='0'&&_0x14a79e[_0x129263(0x1f9)]!=='');_0x1e79eb[_0x129263(0x169)]=_0x27111e,_0x1e79eb['suppliers']=_0x36ba20,_0x1e79eb[_0x129263(0x143)]=_0x3c5202,_0x1e79eb['warehouse_name']=_0x41f84c,_0x1e79eb[_0x129263(0x22d)]=_0x342431,_0x1e79eb['note']=_0x4cf9a3,_0x1e79eb[_0x129263(0x151)]=_0x20a13c,_0x1e79eb[_0x129263(0x16d)]=_0x5cc17e,_0x1e79eb[_0x129263(0x233)]=_0x52fd1f,_0x1e79eb['POnumber']=_0x175cd8,_0x1e79eb[_0x129263(0x1f5)]=_0x1cd62b;const _0x3c43dd=await _0x1e79eb[_0x129263(0x18a)](),_0x558212=await warehouse[_0x129263(0x1c3)]({'name':_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x155)],'room':_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x218)]});_0x1e79eb[_0x129263(0x22d)][_0x129263(0x177)](_0x4b98bd=>{var _0x49a94b=_0x129263,_0x55b3d3=0x0;const _0x1bd485=_0x558212['product_details'][_0x49a94b(0x217)](_0x364fbb=>{var _0x4c40d5=_0x49a94b;_0x364fbb[_0x4c40d5(0x21f)]==_0x4b98bd[_0x4c40d5(0x21f)]&&_0x364fbb[_0x4c40d5(0x16e)]==_0x4b98bd['bay']&&(_0x364fbb[_0x4c40d5(0x1cb)]=parseInt(_0x364fbb['product_stock'])+parseInt(_0x4b98bd['quantity']),_0x55b3d3++);});_0x55b3d3=='0'&&(_0x558212['product_details']=_0x558212['product_details'][_0x49a94b(0x1b1)]({'product_name':_0x4b98bd[_0x49a94b(0x21f)],'product_stock':_0x4b98bd[_0x49a94b(0x1f9)],'primary_code':_0x4b98bd[_0x49a94b(0x1e4)],'secondary_code':_0x4b98bd[_0x49a94b(0x17c)],'product_code':_0x4b98bd['product_code'],'bay':_0x4b98bd[_0x49a94b(0x16e)],'maxProducts':_0x4b98bd['maxStocks'],'unit':_0x4b98bd['standard_unit'],'secondary_unit':_0x4b98bd[_0x49a94b(0x1f4)],'expiry_date':_0x4b98bd['expiry_date']}));}),await _0x558212[_0x129263(0x18a)]();const _0x3ed72a=await s_payment_data[_0x129263(0x1c3)]({'invoice':_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x169)]});if(_0x3ed72a===null){}else console[_0x129263(0x226)](_0x129263(0x1df),_0x3ed72a,_0x5a0c7d[_0x129263(0x19a)][_0x129263(0x169)]),_0x3ed72a[_0x129263(0x1df)]=_0x5a0c7d['body']['suppliers'],await _0x3ed72a['save']();_0x5a0c7d[_0x129263(0x19e)](_0x129263(0x1af),'purchase\x20data\x20update\x20successfully'),_0x3901e9[_0x129263(0x1aa)](_0x129263(0x1f2));}catch(_0x2ee719){console['log'](_0x2ee719);}}),router[a0_0x40ea51(0x237)]('/give_payment/:id',auth,async(_0x5b3a2e,_0x480121)=>{var _0xc6d04c=a0_0x40ea51;try{const _0x7ea411=_0x5b3a2e[_0xc6d04c(0x19d)]['id'],{invoice:_0x3685ae,suppliers:_0x548fe3,payable:_0x5c1101,due_amount:_0x33517e}=_0x5b3a2e[_0xc6d04c(0x19a)],_0x94ebf0=await purchases[_0xc6d04c(0x1ad)](_0x7ea411);var _0x787bb9=_0x5c1101-_0x33517e;_0x94ebf0[_0xc6d04c(0x151)]=parseFloat(_0x94ebf0['paid_amount'])+parseFloat(_0x33517e),_0x94ebf0['due_amount']=_0x787bb9;const _0x15d4a5=await _0x94ebf0[_0xc6d04c(0x18a)]();console[_0xc6d04c(0x226)](_0x15d4a5);const _0x47f989=await s_payment_data[_0xc6d04c(0x1c3)]({'invoice':_0x3685ae});_0x47f989[_0xc6d04c(0x236)]=_0x787bb9,await _0x47f989['save']();let _0xb89cd0=new Date(),_0x47fde6=('0'+_0xb89cd0[_0xc6d04c(0x190)]())[_0xc6d04c(0x14c)](-0x2),_0x539984=('0'+(_0xb89cd0['getMonth']()+0x1))[_0xc6d04c(0x14c)](-0x2),_0x5550bb=_0xb89cd0[_0xc6d04c(0x1a1)](),_0x4afbcd=_0x5550bb+'-'+_0x539984+'-'+_0x47fde6;const _0x396f94=new suppliers_payment({'invoice':_0x3685ae,'date':_0x5550bb+'-'+_0x539984+'-'+_0x47fde6,'suppliers':_0x548fe3,'reason':_0xc6d04c(0x1ed),'amount':_0x33517e}),_0xea2f27=await _0x396f94[_0xc6d04c(0x18a)]();_0x5b3a2e[_0xc6d04c(0x19e)](_0xc6d04c(0x1af),_0xc6d04c(0x1c0)),_0x480121[_0xc6d04c(0x1aa)](_0xc6d04c(0x1dc));}catch(_0x220828){console[_0xc6d04c(0x226)](_0x220828);}}),router[a0_0x40ea51(0x167)](a0_0x40ea51(0x227),auth,async(_0x514f85,_0x17d782)=>{var _0x5c6fa9=a0_0x40ea51;try{const {username:_0x9f2371,email:_0x398e1d,role:_0x5c1138}=_0x514f85['user'],_0x510c80=_0x514f85['user'],_0x15c30e=await profile[_0x5c6fa9(0x1c3)]({'email':_0x510c80['email']}),_0x5d43a5=await master_shop[_0x5c6fa9(0x1d7)]();console[_0x5c6fa9(0x226)](_0x5c6fa9(0x1bc),_0x5d43a5);const _0x4d6b77=_0x514f85['params']['id'],_0xfac445=await purchases[_0x5c6fa9(0x1ad)](_0x4d6b77);console['log'](_0xfac445);const _0x58f4ff=await suppliers[_0x5c6fa9(0x1c3)]({'name':_0xfac445['suppliers']});console['log'](_0x58f4ff);if(_0x5d43a5[0x0][_0x5c6fa9(0x1da)]==_0x5c6fa9(0x214)){var _0x3effdd=users[_0x5c6fa9(0x1a7)];console['log'](_0x3effdd);}else{if(_0x5d43a5[0x0][_0x5c6fa9(0x1da)]==_0x5c6fa9(0x21e))var _0x3effdd=users[_0x5c6fa9(0x21e)];else{if(_0x5d43a5[0x0][_0x5c6fa9(0x1da)]==_0x5c6fa9(0x1b0))var _0x3effdd=users[_0x5c6fa9(0x1b0)];else{if(_0x5d43a5[0x0][_0x5c6fa9(0x1da)]=='Spanish')var _0x3effdd=users[_0x5c6fa9(0x202)];else{if(_0x5d43a5[0x0]['language']==_0x5c6fa9(0x203))var _0x3effdd=users[_0x5c6fa9(0x203)];else{if(_0x5d43a5[0x0][_0x5c6fa9(0x1da)]==_0x5c6fa9(0x150))var _0x3effdd=users[_0x5c6fa9(0x22f)];else{if(_0x5d43a5[0x0][_0x5c6fa9(0x1da)]==_0x5c6fa9(0x1f6))var _0x3effdd=users[_0x5c6fa9(0x1f6)];else{if(_0x5d43a5[0x0][_0x5c6fa9(0x1da)]==_0x5c6fa9(0x17a))var _0x3effdd=users[_0x5c6fa9(0x158)];}}}}}}}_0x17d782['render']('purchase_invoice',{'success':_0x514f85[_0x5c6fa9(0x19e)](_0x5c6fa9(0x1af)),'errors':_0x514f85[_0x5c6fa9(0x19e)]('errors'),'role':_0x510c80,'profile':_0x15c30e,'master_shop':_0x5d43a5,'supplier':_0x58f4ff,'purchase':_0xfac445,'language':_0x3effdd});}catch(_0x1387e0){console['log'](_0x1387e0);}}),router[a0_0x40ea51(0x167)](a0_0x40ea51(0x219),auth,async(_0x3d73d4,_0x14434a)=>{var _0x44bf36=a0_0x40ea51;try{const {username:_0x4c0958,email:_0x1b294a,role:_0x349374}=_0x3d73d4[_0x44bf36(0x1c7)],_0x35b711=_0x3d73d4[_0x44bf36(0x1c7)],_0x1027b0=await profile[_0x44bf36(0x1c3)]({'email':_0x35b711[_0x44bf36(0x215)]}),_0x415a82=await master_shop[_0x44bf36(0x1d7)]();console[_0x44bf36(0x226)](_0x44bf36(0x1bc),_0x415a82);const _0x5dbbbb=_0x3d73d4[_0x44bf36(0x19d)]['id'];console[_0x44bf36(0x226)](_0x5dbbbb);const _0x25d149=await purchases_finished['findById'](_0x5dbbbb);console[_0x44bf36(0x226)](_0x44bf36(0x208),_0x25d149);const _0x137d59=await product[_0x44bf36(0x1d7)]({}),_0x41ce43=await warehouse[_0x44bf36(0x1ba)]([{'$match':{'name':_0x25d149[_0x44bf36(0x155)],'room':_0x25d149[_0x44bf36(0x233)]}},{'$unwind':_0x44bf36(0x1cc)},{'$group':{'_id':_0x44bf36(0x191),'name':{'$first':_0x44bf36(0x19b)},'product_stock':{'$first':_0x44bf36(0x1cf)},'bay':{'$first':_0x44bf36(0x1cd)},'bin':{'$first':_0x44bf36(0x18d)},'type':{'$first':_0x44bf36(0x1a6)},'floorlevel':{'$first':_0x44bf36(0x199)},'primary_code':{'$first':_0x44bf36(0x20f)},'secondary_code':{'$first':_0x44bf36(0x22c)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x44bf36(0x205)},'rack':{'$first':_0x44bf36(0x17e)}}}]);console[_0x44bf36(0x226)]('stock_data',_0x41ce43);let _0x4d2710;if(_0x35b711[_0x44bf36(0x230)]==_0x44bf36(0x164)){const _0x158bcf=await staff[_0x44bf36(0x1c3)]({'email':_0x35b711[_0x44bf36(0x215)]});_0x4d2710=await warehouse[_0x44bf36(0x1d7)]({'status':'Enabled','name':_0x158bcf[_0x44bf36(0x1c8)],'warehouse_category':_0x44bf36(0x185),'name':_0x44bf36(0x16a)});}else _0x4d2710=await warehouse[_0x44bf36(0x1ba)]([{'$match':{'status':_0x44bf36(0x147),'warehouse_category':_0x44bf36(0x185),'name':_0x44bf36(0x16a)}},{'$group':{'_id':_0x44bf36(0x224),'name':{'$first':_0x44bf36(0x224)}}}]);if(_0x415a82[0x0][_0x44bf36(0x1da)]==_0x44bf36(0x214)){var _0x347cd8=users[_0x44bf36(0x1a7)];console[_0x44bf36(0x226)](_0x347cd8);}else{if(_0x415a82[0x0][_0x44bf36(0x1da)]==_0x44bf36(0x21e))var _0x347cd8=users[_0x44bf36(0x21e)];else{if(_0x415a82[0x0][_0x44bf36(0x1da)]==_0x44bf36(0x1b0))var _0x347cd8=users[_0x44bf36(0x1b0)];else{if(_0x415a82[0x0][_0x44bf36(0x1da)]==_0x44bf36(0x202))var _0x347cd8=users[_0x44bf36(0x202)];else{if(_0x415a82[0x0]['language']==_0x44bf36(0x203))var _0x347cd8=users[_0x44bf36(0x203)];else{if(_0x415a82[0x0][_0x44bf36(0x1da)]==_0x44bf36(0x150))var _0x347cd8=users[_0x44bf36(0x22f)];else{if(_0x415a82[0x0][_0x44bf36(0x1da)]==_0x44bf36(0x1f6))var _0x347cd8=users[_0x44bf36(0x1f6)];else{if(_0x415a82[0x0]['language']=='Arabic\x20(ae)')var _0x347cd8=users['Arabic'];}}}}}}}_0x14434a['render'](_0x44bf36(0x1ee),{'success':_0x3d73d4[_0x44bf36(0x19e)](_0x44bf36(0x1af)),'errors':_0x3d73d4[_0x44bf36(0x19e)](_0x44bf36(0x1bf)),'role':_0x35b711,'profile':_0x1027b0,'user':_0x25d149,'stock':_0x41ce43,'master_shop':_0x415a82,'product':_0x137d59,'language':_0x347cd8,'warehouse':_0x4d2710});}catch(_0x193765){console[_0x44bf36(0x226)](_0x193765);}}),router[a0_0x40ea51(0x237)]('/view/return_purchase/:id',auth,async(_0x3a45ff,_0x4b76a0)=>{var _0x329b20=a0_0x40ea51;try{const {invoice:_0x1b2dd9,date:_0x38c527,warehouse_name:_0x5099a1,Room_name:_0x38d0c0,product_name:_0x10f201,purchase_quantity:_0x192002,stocks:_0x24cc6f,return_qty:_0x368abf,note:_0x5f4206,level:_0x13e1df,isle:_0x56b81a,pallet:_0x1034b8,to_warehouse_name:_0xe5e0d2,to_Room_name:_0x11c9f0}=_0x3a45ff[_0x329b20(0x19a)],_0x57b5f0=await purchases_finished[_0x329b20(0x1c3)]({'_id':_0x3a45ff[_0x329b20(0x19d)]['id']}),_0x1c37dc=await warehouse['findOne']({'name':_0x5099a1,'room':_0x38d0c0,'warehouse_category':_0x329b20(0x185)});if(typeof _0x10f201==_0x329b20(0x182))var _0x4d7507=[_0x3a45ff['body']['product_name']],_0x34057b=[_0x3a45ff[_0x329b20(0x19a)]['purchase_quantity']],_0x4a6522=[_0x3a45ff[_0x329b20(0x19a)][_0x329b20(0x1a8)]],_0x5701c0=[_0x3a45ff[_0x329b20(0x19a)][_0x329b20(0x211)]],_0x3b6f3f=[_0x3a45ff[_0x329b20(0x19a)]['level']],_0xbdf873=[_0x3a45ff['body'][_0x329b20(0x1ff)]],_0x33ab34=[_0x3a45ff['body'][_0x329b20(0x20d)]],_0x1ff386=[_0x3a45ff['body']['secondary_code_hide']];else var _0x4d7507=[..._0x3a45ff['body']['product_name']],_0x34057b=[..._0x3a45ff[_0x329b20(0x19a)][_0x329b20(0x183)]],_0x4a6522=[..._0x3a45ff[_0x329b20(0x19a)][_0x329b20(0x1a8)]],_0x5701c0=[..._0x3a45ff['body'][_0x329b20(0x211)]],_0x3b6f3f=[..._0x3a45ff[_0x329b20(0x19a)]['level']],_0xbdf873=[..._0x3a45ff[_0x329b20(0x19a)][_0x329b20(0x1ff)]],_0x33ab34=[..._0x3a45ff[_0x329b20(0x19a)][_0x329b20(0x20d)]],_0x1ff386=[..._0x3a45ff[_0x329b20(0x19a)][_0x329b20(0x18e)]];const _0x1e527a=_0x4d7507[_0x329b20(0x217)](_0x1bbfd1=>{return _0x1bbfd1={'product_name':_0x1bbfd1};});_0x34057b[_0x329b20(0x177)]((_0x42aecc,_0xdeac91)=>{var _0x468d74=_0x329b20;_0x1e527a[_0xdeac91][_0x468d74(0x183)]=_0x42aecc;}),_0x4a6522[_0x329b20(0x177)]((_0x369a6e,_0x35c8f3)=>{var _0x2cb0c6=_0x329b20;_0x1e527a[_0x35c8f3][_0x2cb0c6(0x23c)]=_0x369a6e;}),_0x5701c0[_0x329b20(0x177)]((_0x4bcda2,_0x5da384)=>{var _0x25b0b8=_0x329b20;_0x1e527a[_0x5da384][_0x25b0b8(0x211)]=_0x4bcda2;}),_0x3b6f3f['forEach']((_0x1dacd3,_0x48d6a0)=>{var _0x180b7d=_0x329b20;_0x1e527a[_0x48d6a0][_0x180b7d(0x16e)]=_0x1dacd3;}),_0xbdf873[_0x329b20(0x177)]((_0x1c0ef9,_0x259618)=>{var _0x252db3=_0x329b20;_0x1e527a[_0x259618][_0x252db3(0x1a0)]=_0x1c0ef9;}),_0x33ab34[_0x329b20(0x177)]((_0x21673e,_0x3719bb)=>{_0x1e527a[_0x3719bb]['primary_code']=_0x21673e;}),_0x1ff386[_0x329b20(0x177)]((_0x4aec8a,_0x20e8d4)=>{var _0x3a4971=_0x329b20;_0x1e527a[_0x20e8d4][_0x3a4971(0x17c)]=_0x4aec8a;}),_0x1e527a[_0x329b20(0x177)](_0x2c2a50=>{var _0x2dce7b=_0x329b20;console['log'](_0x2c2a50);const _0x2ab932=_0x1c37dc['product_details'][_0x2dce7b(0x217)](_0x57f275=>{var _0x1a76d4=_0x2dce7b;_0x57f275[_0x1a76d4(0x21f)]==_0x2c2a50[_0x1a76d4(0x21f)]&&_0x57f275[_0x1a76d4(0x16e)]==_0x2c2a50[_0x1a76d4(0x16e)]&&(console[_0x1a76d4(0x226)](parseInt(_0x57f275[_0x1a76d4(0x1cb)])+_0x1a76d4(0x1ab)+parseInt(_0x2c2a50['return_qty'])),_0x57f275[_0x1a76d4(0x1cb)]=parseInt(_0x57f275[_0x1a76d4(0x1cb)])-parseInt(_0x2c2a50[_0x1a76d4(0x211)]));});}),await _0x1c37dc[_0x329b20(0x18a)]();var _0x4b8afb=0x0;_0x1e527a[_0x329b20(0x177)](_0x53d6d3=>{var _0x13787b=_0x329b20;(parseInt(_0x53d6d3[_0x13787b(0x183)])<parseInt(_0x53d6d3[_0x13787b(0x211)])||parseInt(_0x53d6d3[_0x13787b(0x23c)])<parseInt(_0x53d6d3['return_qty']))&&_0x4b8afb++;});if(_0x4b8afb!=0x0)return _0x3a45ff[_0x329b20(0x19e)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x4b76a0[_0x329b20(0x1aa)](_0x329b20(0x1de));const _0x4a0d80=new purchases_return_finished({'invoice':_0x1b2dd9,'suppliers':_0x3a45ff['body'][_0x329b20(0x1df)],'date':_0x38c527,'warehouse_name':_0x5099a1,'return_product':_0x1e527a,'note':_0x5f4206,'room':_0x38d0c0,'to_warehouse_name':_0xe5e0d2,'to_room':_0x11c9f0}),_0x1e807b=await _0x4a0d80[_0x329b20(0x18a)](),_0x5878a4=await purchases_return_finished['findOne']({'invoice':_0x1b2dd9}),_0x25c2a2=await warehouse[_0x329b20(0x1c3)]({'name':_0xe5e0d2,'room':_0x11c9f0,'warehouse_category':'Finished\x20Goods'});_0x5878a4[_0x329b20(0x1ec)][_0x329b20(0x177)](_0x1a2f95=>{var _0x4ad027=_0x329b20,_0x4a8874=0x0;const _0x513989=_0x25c2a2[_0x4ad027(0x157)][_0x4ad027(0x217)](_0x21659e=>{var _0x253a7d=_0x4ad027;console[_0x253a7d(0x226)](_0x21659e[_0x253a7d(0x21f)]+'=='+_0x1a2f95[_0x253a7d(0x21f)]+'&&'+_0x21659e[_0x253a7d(0x16e)]+'=='+_0x1a2f95[_0x253a7d(0x16e)]),_0x21659e[_0x253a7d(0x21f)]==_0x1a2f95[_0x253a7d(0x21f)]&&_0x21659e['bay']==_0x1a2f95['bay']&&(_0x21659e[_0x253a7d(0x1cb)]=parseInt(_0x21659e[_0x253a7d(0x1cb)])-parseInt(_0x1a2f95['return_qty']),_0x4a8874++);});_0x4a8874=='0'&&(_0x25c2a2[_0x4ad027(0x157)]=_0x25c2a2['product_details'][_0x4ad027(0x1b1)]({'product_name':_0x1a2f95['product_name'],'product_stock':_0x1a2f95[_0x4ad027(0x211)],'primary_code':_0x1a2f95[_0x4ad027(0x1e4)],'secondary_code':_0x1a2f95['secondary_code'],'product_code':_0x1a2f95[_0x4ad027(0x1a0)],'bay':_0x1a2f95[_0x4ad027(0x16e)],'maxProducts':0xf423f}));}),await _0x25c2a2['save']();const _0x61a495=await purchases_finished[_0x329b20(0x1c3)]({'invoice':_0x1b2dd9});_0x61a495['return_data']=_0x329b20(0x1d4);const _0x53a38=await _0x61a495[_0x329b20(0x18a)](),_0xf49a16=new s_payment_data({'invoice':_0x1b2dd9,'suppliers':_0x3a45ff[_0x329b20(0x19a)][_0x329b20(0x1df)],'reason':_0x329b20(0x23e)});await _0xf49a16[_0x329b20(0x18a)]();const _0x3abd42=await master_shop['find'](),_0x2b7d86=await email_settings['findOne'](),_0x20275e=await suppliers[_0x329b20(0x1c3)]({'name':_0x3a45ff[_0x329b20(0x19a)][_0x329b20(0x1df)]});_0x3abd42[0x0][_0x329b20(0x1b6)]==0x1?(right_currency=_0x3abd42[0x0][_0x329b20(0x13f)],left_currency=''):(right_currency='',left_currency=_0x3abd42[0x0][_0x329b20(0x13f)]);var _0x52ee62=_0x4d7507,_0x3817ae=_0x5701c0,_0x15d00c='',_0xfb3a04;for(_0xfb3a04 in _0x52ee62){_0x15d00c+=_0x329b20(0x15a)+_0x329b20(0x23f)+_0x52ee62[_0xfb3a04]+_0x329b20(0x225)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3817ae[_0xfb3a04]+_0x329b20(0x225)+'</tr>';}let _0xe4355c=nodemailer[_0x329b20(0x192)]({'service':'gmail','auth':{'user':_0x2b7d86[_0x329b20(0x215)],'pass':_0x2b7d86[_0x329b20(0x1d9)]}}),_0x5f8137={'from':_0x2b7d86['email'],'to':_0x20275e[_0x329b20(0x215)],'subject':_0x329b20(0x1b2),'attachments':[{'filename':'Logo.png','path':__dirname+_0x329b20(0x165)+_0x329b20(0x1e3)+_0x3abd42[0x0]['image'],'cid':'logo'}],'html':_0x329b20(0x1c1)+'<html><head><title></title>'+_0x329b20(0x1f1)+_0x329b20(0x1fb)+_0x329b20(0x1a4)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x329b20(0x232)+_0x329b20(0x1fb)+'<h2>\x20'+_0x3abd42[0x0][_0x329b20(0x149)]+_0x329b20(0x168)+_0x329b20(0x232)+_0x329b20(0x232)+_0x329b20(0x170)+_0x329b20(0x1fb)+_0x329b20(0x1fe)+_0x329b20(0x152)+_0x1b2dd9+'\x20'+_0x329b20(0x20e)+_0x329b20(0x18c)+_0x38c527+'\x20'+_0x329b20(0x210)+_0x329b20(0x1f0)+_0x329b20(0x232)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x329b20(0x239)+_0x329b20(0x15a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x329b20(0x1b5)+_0x329b20(0x173)+_0x329b20(0x23d)+_0x329b20(0x238)+_0x329b20(0x15b)+_0x329b20(0x13d)+'\x20'+_0x15d00c+'\x20'+_0x329b20(0x1e9)+_0x329b20(0x181)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x3abd42[0x0][_0x329b20(0x149)]+_0x329b20(0x1f0)+_0x329b20(0x232)+_0x329b20(0x232)+'</body></html>'};_0xe4355c['sendMail'](_0x5f8137,function(_0x6fbb20,_0x242cc0){var _0x279f57=_0x329b20;_0x6fbb20?console[_0x279f57(0x226)](_0x279f57(0x222)):console['log']('Email\x20sent\x20successfully');}),_0x3a45ff[_0x329b20(0x19e)]('success',_0x329b20(0x1c4)),_0x4b76a0['redirect'](_0x329b20(0x1f2));}catch(_0x236fbd){_0x4b76a0[_0x329b20(0x223)](0xc8)[_0x329b20(0x212)]({'message':_0x236fbd[_0x329b20(0x1db)]});}}),router[a0_0x40ea51(0x167)](a0_0x40ea51(0x20a),auth,async(_0x30cd30,_0x44601d)=>{var _0x3b04e2=a0_0x40ea51;try{const {username:_0x1b94ba,email:_0x37d7a,role:_0x3afa8f}=_0x30cd30[_0x3b04e2(0x1c7)],_0x4648e0=_0x30cd30[_0x3b04e2(0x1c7)],_0x546cd0=await profile[_0x3b04e2(0x1c3)]({'email':_0x4648e0[_0x3b04e2(0x215)]}),_0x91f6d4=await master_shop[_0x3b04e2(0x1d7)](),_0x2930cd=_0x30cd30[_0x3b04e2(0x19d)]['id'],_0x133f64=await purchases_finished['findById'](_0x2930cd);if(_0x91f6d4[0x0][_0x3b04e2(0x1da)]==_0x3b04e2(0x214))var _0x29e771=users[_0x3b04e2(0x1a7)];else{if(_0x91f6d4[0x0]['language']==_0x3b04e2(0x21e))var _0x29e771=users[_0x3b04e2(0x21e)];else{if(_0x91f6d4[0x0][_0x3b04e2(0x1da)]=='German')var _0x29e771=users[_0x3b04e2(0x1b0)];else{if(_0x91f6d4[0x0][_0x3b04e2(0x1da)]==_0x3b04e2(0x202))var _0x29e771=users[_0x3b04e2(0x202)];else{if(_0x91f6d4[0x0][_0x3b04e2(0x1da)]=='French')var _0x29e771=users[_0x3b04e2(0x203)];else{if(_0x91f6d4[0x0]['language']==_0x3b04e2(0x150))var _0x29e771=users[_0x3b04e2(0x22f)];else{if(_0x91f6d4[0x0][_0x3b04e2(0x1da)]==_0x3b04e2(0x1f6))var _0x29e771=users[_0x3b04e2(0x1f6)];else{if(_0x91f6d4[0x0][_0x3b04e2(0x1da)]==_0x3b04e2(0x17a))var _0x29e771=users['Arabic'];}}}}}}}_0x44601d[_0x3b04e2(0x1f8)]('all_purchases_barcode',{'success':_0x30cd30[_0x3b04e2(0x19e)]('success'),'errors':_0x30cd30[_0x3b04e2(0x19e)](_0x3b04e2(0x1bf)),'role':_0x4648e0,'profile':_0x546cd0,'alldata':_0x133f64,'master_shop':_0x91f6d4,'language':_0x29e771}),console['log'](alldata);}catch(_0x104fdb){console[_0x3b04e2(0x226)](_0x104fdb);}}),router[a0_0x40ea51(0x237)](a0_0x40ea51(0x194),async(_0x3557e3,_0xf3f78c)=>{var _0x2c4a9b=a0_0x40ea51;const {product_code:_0x3c9996}=_0x3557e3[_0x2c4a9b(0x19a)];var _0x477494;const _0x50e8b8=await product['aggregate']([{'$match':{'primary_code':_0x3c9996,'product_category':_0x2c4a9b(0x185)}},{'$group':{'_id':_0x2c4a9b(0x1d5),'name':{'$first':_0x2c4a9b(0x224)},'category':{'$first':'$category'},'brand':{'$first':_0x2c4a9b(0x1e7)},'unit':{'$first':_0x2c4a9b(0x1e0)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x2c4a9b(0x1e5)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x2c4a9b(0x23b)},'maxProdPerUnit':{'$first':_0x2c4a9b(0x16f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2c4a9b(0x20b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4924c0=await product[_0x2c4a9b(0x1ba)]([{'$match':{'secondary_code':_0x3c9996}},{'$group':{'_id':_0x2c4a9b(0x1d5),'name':{'$first':'$name'},'category':{'$first':_0x2c4a9b(0x17d)},'brand':{'$first':'$brand'},'unit':{'$first':_0x2c4a9b(0x1e0)},'alertquantity':{'$first':_0x2c4a9b(0x153)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2c4a9b(0x171)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x2c4a9b(0x16f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2c4a9b(0x20b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x50e8b8['length']>0x0)_0x477494=_0x50e8b8;else _0x4924c0[_0x2c4a9b(0x1b7)]>0x0&&(_0x477494=_0x4924c0);_0xf3f78c[_0x2c4a9b(0x212)](_0x477494);}),router[a0_0x40ea51(0x237)](a0_0x40ea51(0x160),async(_0x198135,_0x5e960a)=>{var _0x1da027=a0_0x40ea51;const {productCode:_0x537e02,bay:_0x3e39c3,warehouses:_0x42e6eb,room:_0x5013cc}=_0x198135[_0x1da027(0x19a)];console[_0x1da027(0x226)](_0x198135[_0x1da027(0x19a)]);try{const _0xe987a2=await warehouse[_0x1da027(0x1ba)]([{'$match':{'name':_0x42e6eb,'room':_0x5013cc}},{'$unwind':_0x1da027(0x1cc)},{'$match':{'product_details.bay':parseInt(_0x3e39c3)}},{'$group':{'_id':_0x1da027(0x191),'name':{'$first':_0x1da027(0x19b)},'product_stock':{'$first':_0x1da027(0x1cf)},'bay':{'$first':_0x1da027(0x1cd)},'maxProducts':{'$first':_0x1da027(0x1a9)}}}]);_0x5e960a[_0x1da027(0x223)](0xc8)['json'](_0xe987a2);}catch(_0x674684){_0x5e960a[_0x1da027(0x223)](0x194)[_0x1da027(0x212)]({'message':_0x674684[_0x1da027(0x1db)]});}}),module[a0_0x40ea51(0x180)]=router;