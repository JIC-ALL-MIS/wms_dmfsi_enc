function a0_0x45a2(){var _0xc9ec1d=['product_stock','QA\x20Warehouse','French','<strong>\x20Regards\x20</strong>','Ambient','product','$paid_amount','\x20</h2>','warehouse','$product.bay','\x20Order\x20Number\x20:\x20','catch','/all_purchases_finished/view','room','<html><head><title></title>','getDate','202614SRcXcq','12863270XuHYSa','$batch_code','batch_code','7316136KIIaAK','aggregate','room_name','RoomAssign','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','port','/view','prod_level','purchase_invoice','back','$name','$secondary_unit','success','$room','map','$brand','INCF-','findById','nodemailer','return_purchase_finished','product_code','$secondary_code','Arabic','user_id','Error\x20Occurs','</head><body>','prod_cat','level','expiry_date','Room_name','suppliers_docs','log','params','bay','$product.type','$warehouse_name','$suppliers_docs','invoice','$suppliers','<h5>','Paid\x20For\x20Purchase','errors','payment\x20successfull','$category','<tbody\x20style=\x22text-align:\x20center;\x22>','ejs','Arabic\x20(ae)','$product_details.type','currency','edit_purchases_finished_view','prod_name','product_date','Spanish','/CheckingWarehouse','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','True','user','purchase\x20data\x20update\x20successfully','all_purchases_finished','render','POnumber','3VBmZQu','Purchase\x20Return','$product_details._id','Rack\x202','/view/add_purchases/:id','gmail','name','$unit','prod_unit','flash','JO_number','Error\x20occurred\x20while\x20processing\x20product:','staff','<h2>\x20','toString','primary_code','Router','prod_code','$product_details.primary_code','updateOne','filter','$alertquantity','prod_primunit','Enabled','site_title','stock_quantity','Hindi','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','createTransport','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$_id','save','Portuguese\x20(BR)','floor','maxStocks','secondary_code_hide','<table\x20style=\x22width:\x20100%\x20!important;\x22>','path','return_qty','image','<!DOCTYPE\x20html>','../public/language/languages.json','Purchase\x20Mail','</thead>','getMonth','abs','$maxStocks','_id','amount','then','$date','Logo.png','</h5>','Chinese','paid_amount','product_cat','77BCbHZH','$product_code','due_amount','post','627352YicaOc','English','</td>','FROZEN\x20GOODS','<hr\x20class=\x22my-3\x22>','json','exports','language','slice','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','warehouse_name','$product_details.product_code','/view/return_purchase/:id','prod_qty','$product_details','</tr>','1550886hGkldq','purchases\x20item\x20return\x20successfull','Rack\x201','purchase\x20data\x20add\x20successfully','</tbody>','date','email','product_details','maxperunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','\x20<>\x20','$product_details.floorlevel','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','5SsOXlH','stock_data','$maxProdPerUnit','$product.floorlevel','$expiry_date','<span\x20style=\x22float:\x20right;\x22>','$due_amount','/view/add_purchases','findOne','Finished\x20Goods','product_code_hide','suppliers','Purchase\x20Return\x20Mail','purchase_quantity','table\x20page','role','$invoice','$product_details.product_stock','quantity','logo','express','$product_details.secondary_code','</div>','$product_details.storage','121518HuRxFE','random','../middleware/auth','all_purchases_barcode','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Portuguese','sendMail','FGSEmail','</span>','primary_code_hide','German','$product_details.bay','/give_payment/:id','/all_purchases/view','master','Email\x20sent\x20successfully','$product.quantity','</table>','English\x20(US)','MaxStocks_data','prod_secondunit','/invoice/:id','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<tr>','product_name','$note','return_product','/preview/:id','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','edit_purchases_finished','Return\x20Goods','DRY\x20GOODS','$primary_code','\x20Order\x20Date\x20:\x20','status','secondary_unit','prod_invoice','note','error','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<div>','string','getFullYear','$product_details.maxProducts','secondary_code','message','</body></html>','forEach','prod_Qty','body','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/view/:id','find','add_purchases\x20error','padStart','standard_unit','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','131848kooyYz','/barcode_scanner','/upload/','production_date','11cJoXgP','$product','Enclosed','get','/../public','$product.bin'];a0_0x45a2=function(){return _0xc9ec1d;};return a0_0x45a2();}var a0_0x1035b3=a0_0x58ac;(function(_0x1805e6,_0xbcd63e){var _0x186013=a0_0x58ac,_0x3022e6=_0x1805e6();while(!![]){try{var _0x2ba3a1=-parseInt(_0x186013(0x27f))/0x1+-parseInt(_0x186013(0x1cb))/0x2*(-parseInt(_0x186013(0x20d))/0x3)+parseInt(_0x186013(0x24a))/0x4*(parseInt(_0x186013(0x267))/0x5)+-parseInt(_0x186013(0x25a))/0x6+parseInt(_0x186013(0x246))/0x7*(parseInt(_0x186013(0x1b1))/0x8)+-parseInt(_0x186013(0x1cf))/0x9+parseInt(_0x186013(0x1cc))/0xa*(parseInt(_0x186013(0x1b5))/0xb);if(_0x2ba3a1===_0xbcd63e)break;else _0x3022e6['push'](_0x3022e6['shift']());}catch(_0x5396fd){_0x3022e6['push'](_0x3022e6['shift']());}}}(a0_0x45a2,0x8217c));const express=require(a0_0x1035b3(0x27b)),app=express(),router=express[a0_0x1035b3(0x21d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x1035b3(0x281)),nodemailer=require(a0_0x1035b3(0x1e1));function a0_0x58ac(_0x30bd69,_0x5d5ebb){var _0x45a22d=a0_0x45a2();return a0_0x58ac=function(_0x58acff,_0x52efa5){_0x58acff=_0x58acff-0x190;var _0x2dd5e2=_0x45a22d[_0x58acff];return _0x2dd5e2;},a0_0x58ac(_0x30bd69,_0x5d5ebb);}var ejs=require(a0_0x1035b3(0x1fc));const path=require(a0_0x1035b3(0x233)),users=require(a0_0x1035b3(0x237));router[a0_0x1035b3(0x1b8)](a0_0x1035b3(0x1d5),auth,async(_0x447194,_0x2ccc5c)=>{var _0x5c5be7=a0_0x1035b3;try{const {username:_0xddd062,email:_0xdd1f0b,role:_0x36304c}=_0x447194['user'],_0x24830d=_0x447194[_0x5c5be7(0x208)],_0x3f86ab=await profile[_0x5c5be7(0x26f)]({'email':_0x24830d[_0x5c5be7(0x260)]}),_0x2a00e9=await staff[_0x5c5be7(0x26f)]({'email':_0x24830d['email']});if(_0x24830d[_0x5c5be7(0x276)]==_0x5c5be7(0x219)){const _0x5cbfa5=await staff[_0x5c5be7(0x26f)]({'email':_0x24830d[_0x5c5be7(0x260)]});}const _0x44139a=await master_shop[_0x5c5be7(0x1ab)]();let _0x22ef57;if(_0x24830d[_0x5c5be7(0x276)]==_0x5c5be7(0x219)){const _0x3cd3cb=await staff[_0x5c5be7(0x26f)]({'email':_0x24830d[_0x5c5be7(0x260)]});_0x22ef57=await purchases_finished['aggregate']([{'$match':{'warehouse_name':_0x3cd3cb[_0x5c5be7(0x1c3)]}},{'$lookup':{'from':_0x5c5be7(0x272),'localField':_0x5c5be7(0x272),'foreignField':_0x5c5be7(0x213),'as':_0x5c5be7(0x1ed)}},{'$unwind':_0x5c5be7(0x1f3)},{'$unwind':_0x5c5be7(0x1b6)},{'$group':{'_id':_0x5c5be7(0x22c),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x5c5be7(0x1f5)},'date':{'$first':_0x5c5be7(0x240)},'warehouse_name':{'$first':_0x5c5be7(0x1f2)},'room':{'$first':_0x5c5be7(0x1dc)},'product':{'$push':'$product'},'note':{'$first':_0x5c5be7(0x29a)},'paid_amount':{'$first':_0x5c5be7(0x1c1)},'due_amount':{'$first':_0x5c5be7(0x26d)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x5c5be7(0x1cd)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x5c5be7(0x290)},'level':{'$addToSet':_0x5c5be7(0x1c4)},'isle':{'$addToSet':_0x5c5be7(0x1ba)},'type':{'$addToSet':_0x5c5be7(0x1f1)},'floorlevel':{'$addToSet':_0x5c5be7(0x26a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x22ef57=await purchases_finished['aggregate']([{'$unwind':_0x5c5be7(0x1b6)},{'$group':{'_id':_0x5c5be7(0x22c),'invoice':{'$first':_0x5c5be7(0x277)},'suppliers':{'$first':_0x5c5be7(0x1f5)},'date':{'$first':_0x5c5be7(0x240)},'warehouse_name':{'$first':_0x5c5be7(0x1f2)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x5c5be7(0x1b6)},'note':{'$first':_0x5c5be7(0x29a)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x5c5be7(0x26d)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x5c5be7(0x1cd)},'expiry_date':{'$first':_0x5c5be7(0x26b)},'suppliers_docs':{'$first':_0x5c5be7(0x1f3)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x5c5be7(0x1c4)},'isle':{'$addToSet':_0x5c5be7(0x1ba)},'type':{'$addToSet':_0x5c5be7(0x1f1)},'floorlevel':{'$addToSet':_0x5c5be7(0x26a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x44139a[0x0][_0x5c5be7(0x251)]==_0x5c5be7(0x292))var _0x2b52d5=users['English'];else{if(_0x44139a[0x0][_0x5c5be7(0x251)]==_0x5c5be7(0x227))var _0x2b52d5=users[_0x5c5be7(0x227)];else{if(_0x44139a[0x0]['language']=='German')var _0x2b52d5=users['German'];else{if(_0x44139a[0x0][_0x5c5be7(0x251)]==_0x5c5be7(0x203))var _0x2b52d5=users['Spanish'];else{if(_0x44139a[0x0][_0x5c5be7(0x251)]==_0x5c5be7(0x1bd))var _0x2b52d5=users[_0x5c5be7(0x1bd)];else{if(_0x44139a[0x0]['language']=='Portuguese\x20(BR)')var _0x2b52d5=users[_0x5c5be7(0x285)];else{if(_0x44139a[0x0][_0x5c5be7(0x251)]==_0x5c5be7(0x243))var _0x2b52d5=users[_0x5c5be7(0x243)];else{if(_0x44139a[0x0][_0x5c5be7(0x251)]==_0x5c5be7(0x1fd))var _0x2b52d5=users[_0x5c5be7(0x1e5)];}}}}}}}_0x2ccc5c[_0x5c5be7(0x20b)](_0x5c5be7(0x20a),{'success':_0x447194[_0x5c5be7(0x216)](_0x5c5be7(0x1db)),'errors':_0x447194[_0x5c5be7(0x216)](_0x5c5be7(0x1f8)),'purchases':_0x22ef57,'role':_0x24830d,'profile':_0x3f86ab,'master_shop':_0x44139a,'language':_0x2b52d5});}catch(_0x41443d){console[_0x5c5be7(0x1ee)](_0x5c5be7(0x275),_0x41443d),_0x2ccc5c['status'](0xc8)[_0x5c5be7(0x24f)]({'message':_0x41443d[_0x5c5be7(0x1a4)]});}});function BayBinSelected(_0x14c038,_0x3ca6dc){var _0x144e72=a0_0x1035b3,_0x13e845=[],_0x14d13d=[];if(_0x14c038=='DRY\x20GOODS'){switch(_0x3ca6dc){case _0x144e72(0x25c):_0x13e845=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x13e845=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x14d13d=['DG'];}else{if(_0x14c038==_0x144e72(0x24d)){switch(_0x3ca6dc){case'Rack\x201':_0x13e845=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x144e72(0x210):_0x13e845=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x14d13d=['FG'];}}return{'levels':_0x13e845,'identify':_0x14d13d};}async function getRandom8DigitNumber(){var _0x35cd72=a0_0x1035b3;const _0x398ec2=0x989680,_0x32488c=0x5f5e0ff,_0x157917=Math[_0x35cd72(0x22f)](Math[_0x35cd72(0x280)]()*(_0x32488c-_0x398ec2+0x1))+_0x398ec2;var _0x388735;const _0x3dc835=await purchases_finished[_0x35cd72(0x26f)]({'invoice':_0x35cd72(0x1df)+_0x157917});return _0x3dc835&&_0x3dc835[_0x35cd72(0x283)]>0x0?_0x388735=_0x35cd72(0x1df)+_0x157917:_0x388735=_0x35cd72(0x1df)+_0x157917,_0x388735;}router[a0_0x1035b3(0x1b8)]('/view/add_purchases',auth,async(_0x128a3e,_0x393042)=>{var _0x5e13c9=a0_0x1035b3;try{const {username:_0x2ba356,email:_0x46eaf4,role:_0x341f30}=_0x128a3e[_0x5e13c9(0x208)],_0x52a92d=_0x128a3e['user'],_0x399864=await profile[_0x5e13c9(0x26f)]({'email':_0x52a92d[_0x5e13c9(0x260)]}),_0x51b079=await master_shop[_0x5e13c9(0x1ab)](),_0x2a7eeb=await staff['findOne']({'email':_0x52a92d[_0x5e13c9(0x260)]}),_0x20f350=await suppliers['find']({});let _0x5930fe;if(_0x52a92d[_0x5e13c9(0x276)]==_0x5e13c9(0x219)){const _0x5dda8d=await staff[_0x5e13c9(0x26f)]({'email':_0x52a92d[_0x5e13c9(0x260)]});_0x5930fe=await warehouse[_0x5e13c9(0x1d0)]([{'$match':{'status':_0x5e13c9(0x224),'name':_0x5dda8d[_0x5e13c9(0x1c3)],'warehouse_category':_0x5e13c9(0x270)}},{'$group':{'_id':_0x5e13c9(0x1d9),'name':{'$first':_0x5e13c9(0x1d9)}}}]);}else _0x5930fe=await warehouse[_0x5e13c9(0x1d0)]([{'$match':{'status':_0x5e13c9(0x224),'warehouse_category':_0x5e13c9(0x270),'name':{'$ne':_0x5e13c9(0x1bc)}}},{'$group':{'_id':_0x5e13c9(0x1d9),'name':{'$first':_0x5e13c9(0x1d9)}}}]);const _0x29fdfe=await product[_0x5e13c9(0x1ab)]({}),_0x1a9669=await warehouse['find']({'status':'Enabled'}),_0xd364da=await purchases_finished[_0x5e13c9(0x1ab)]({}),_0x681147=_0xd364da[_0x5e13c9(0x283)]+0x1,_0x1403ac=_0x5e13c9(0x1df)+_0x681147[_0x5e13c9(0x21b)]()[_0x5e13c9(0x1ad)](0x5,'0');var _0x3e4536=[_0x5e13c9(0x1bf),_0x5e13c9(0x1b7)];if(_0x51b079[0x0][_0x5e13c9(0x251)]==_0x5e13c9(0x292))var _0xe8856c=users['English'];else{if(_0x51b079[0x0]['language']=='Hindi')var _0xe8856c=users['Hindi'];else{if(_0x51b079[0x0]['language']==_0x5e13c9(0x28a))var _0xe8856c=users[_0x5e13c9(0x28a)];else{if(_0x51b079[0x0][_0x5e13c9(0x251)]==_0x5e13c9(0x203))var _0xe8856c=users[_0x5e13c9(0x203)];else{if(_0x51b079[0x0][_0x5e13c9(0x251)]==_0x5e13c9(0x1bd))var _0xe8856c=users[_0x5e13c9(0x1bd)];else{if(_0x51b079[0x0][_0x5e13c9(0x251)]=='Portuguese\x20(BR)')var _0xe8856c=users[_0x5e13c9(0x285)];else{if(_0x51b079[0x0][_0x5e13c9(0x251)]==_0x5e13c9(0x243))var _0xe8856c=users[_0x5e13c9(0x243)];else{if(_0x51b079[0x0][_0x5e13c9(0x251)]==_0x5e13c9(0x1fd))var _0xe8856c=users[_0x5e13c9(0x1e5)];}}}}}}}const _0x443e99=getRandom8DigitNumber();_0x443e99['then'](_0xfa408f=>{var _0x5744b1=_0x5e13c9;_0x393042[_0x5744b1(0x20b)]('add_purchases_finished',{'success':_0x128a3e[_0x5744b1(0x216)](_0x5744b1(0x1db)),'errors':_0x128a3e[_0x5744b1(0x216)](_0x5744b1(0x1f8)),'role':_0x52a92d,'profile':_0x399864,'suppliers':_0x20f350,'warehouse':_0x5930fe,'product':_0x29fdfe,'invoice':_0xfa408f,'master_shop':_0x51b079,'language':_0xe8856c,'find_data':_0x1a9669,'rooms_data':_0x3e4536});})[_0x5e13c9(0x1c6)](_0x384423=>{var _0x165999=_0x5e13c9;_0x128a3e[_0x165999(0x216)](_0x165999(0x1f8),_0x165999(0x22b)),_0x393042[_0x165999(0x296)](_0x165999(0x1c7));});}catch(_0x1e0dc7){console[_0x5e13c9(0x1ee)](_0x1e0dc7);}}),router[a0_0x1035b3(0x1b8)](a0_0x1035b3(0x211),auth,async(_0xb348e2,_0x322cb3)=>{var _0x2b94db=a0_0x1035b3;try{const _0x12b54d=_0xb348e2[_0x2b94db(0x1ef)]['id'];console[_0x2b94db(0x1ee)](_0x12b54d);const _0xcd2b9c=await master_shop['find']();console[_0x2b94db(0x1ee)](_0x2b94db(0x28e),_0xcd2b9c);const _0x355202=await product[_0x2b94db(0x26f)]({'name':_0x12b54d});console[_0x2b94db(0x1ee)](_0x2b94db(0x1c0),_0x355202),_0x322cb3[_0x2b94db(0x198)](0xc8)[_0x2b94db(0x24f)]({'product_data':_0x355202,'master':_0xcd2b9c});}catch(_0x3ed787){console['log'](_0x2b94db(0x1ac),_0x3ed787);}}),router[a0_0x1035b3(0x249)](a0_0x1035b3(0x26e),auth,async(_0x4a91ee,_0x33cbec)=>{var _0x41389e=a0_0x1035b3;try{const {invoice:_0x5f0b53,date:_0xdd6348,warehouse_name:_0x3b4fe8,prod_name:_0x27acf8,prod_code:_0x16f4be,prod_qty:_0x114e08,prod_unit:_0x205879,prod_secondunit:_0x1d949b,prod_level:_0x377630,prod_isle:_0x5a605d,prod_pallet:_0x5e392b,note:_0x512f2f,expiry_date:_0x20ce86,batch_code:_0x43b8ee,payable:_0x3320fb,due_amount:_0x259a79,Room_name:_0x451963,primary_code:_0x345dc4,secondary_code:_0x1edace,MaxStocks_data:_0x23653d,PO_number:_0x54b262,SCRN:_0x44e1eb,JO_number:_0x31cc8b}=_0x4a91ee['body'];if(typeof _0x27acf8==_0x41389e(0x1a0))var _0x5dd45f=[_0x4a91ee[_0x41389e(0x1a8)]['prod_name']],_0x3804a6=[_0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x21e)]],_0xfdb6c3=[_0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x1a7)]],_0x2de537=[_0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x223)]],_0x530428=[_0x4a91ee['body'][_0x41389e(0x294)]],_0x3b4217=[_0x4a91ee['body'][_0x41389e(0x1d6)]],_0x5f398d=[_0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x21c)]],_0xbfcf17=[_0x4a91ee[_0x41389e(0x1a8)]['secondary_code']],_0x5e61ac=[_0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x293)]],_0x27918a=[_0x4a91ee[_0x41389e(0x1a8)]['batch_code']],_0x3d9b0e=[_0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x1eb)]],_0x162924=[_0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x202)]],_0x4bc5fe=[_0x4a91ee['body']['max_product_unit']],_0x4405e3=[_0x4a91ee[_0x41389e(0x1a8)]['prod_cat']],_0x3da1fa=[_0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x1d2)]],_0x25ab4e=[_0x4a91ee[_0x41389e(0x1a8)]['prod_invoice']];else var _0x5dd45f=[..._0x4a91ee['body']['prod_name']],_0x3804a6=[..._0x4a91ee[_0x41389e(0x1a8)]['prod_code']],_0xfdb6c3=[..._0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x1a7)]],_0x2de537=[..._0x4a91ee[_0x41389e(0x1a8)]['prod_primunit']],_0x530428=[..._0x4a91ee[_0x41389e(0x1a8)]['prod_secondunit']],_0x3b4217=[..._0x4a91ee['body'][_0x41389e(0x1d6)]],_0x5f398d=[..._0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x21c)]],_0xbfcf17=[..._0x4a91ee['body'][_0x41389e(0x1a3)]],_0x5e61ac=[..._0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x293)]],_0x27918a=[..._0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x1ce)]],_0x3d9b0e=[..._0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x1eb)]],_0x162924=[..._0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x202)]],_0x4bc5fe=[..._0x4a91ee[_0x41389e(0x1a8)]['max_product_unit']],_0x4405e3=[..._0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x1e9)]],_0x3da1fa=[..._0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x1d2)]],_0x25ab4e=[..._0x4a91ee['body'][_0x41389e(0x19a)]];const _0x5836de=_0x5dd45f[_0x41389e(0x1dd)](_0x4dc43b=>{return _0x4dc43b={'product_name':_0x4dc43b};});_0x3804a6[_0x41389e(0x1a6)]((_0x1e1897,_0x4f7ec0)=>{var _0x430636=_0x41389e;_0x5836de[_0x4f7ec0][_0x430636(0x1e3)]=_0x1e1897;}),_0xfdb6c3[_0x41389e(0x1a6)]((_0x29aefa,_0x590880)=>{var _0x1e2488=_0x41389e;_0x5836de[_0x590880][_0x1e2488(0x279)]=Math[_0x1e2488(0x23b)](_0x29aefa);}),_0x2de537[_0x41389e(0x1a6)]((_0x220179,_0x85b0b)=>{var _0x6491f1=_0x41389e;_0x5836de[_0x85b0b][_0x6491f1(0x1ae)]=_0x220179;}),_0x530428[_0x41389e(0x1a6)]((_0x2d134f,_0x57bd43)=>{var _0x57b63e=_0x41389e;_0x5836de[_0x57bd43][_0x57b63e(0x199)]=_0x2d134f;}),_0x3b4217[_0x41389e(0x1a6)]((_0x876b78,_0x4695fc)=>{_0x5836de[_0x4695fc]['bay']=_0x876b78;}),_0x5f398d['forEach']((_0x422c0f,_0x4db801)=>{var _0x1f44bb=_0x41389e;_0x5836de[_0x4db801][_0x1f44bb(0x21c)]=_0x422c0f;}),_0xbfcf17['forEach']((_0x1144cb,_0x543f58)=>{var _0x407b25=_0x41389e;_0x5836de[_0x543f58][_0x407b25(0x1a3)]=_0x1144cb;}),_0x5e61ac['forEach']((_0x2546ab,_0x59e520)=>{var _0x2dfbf9=_0x41389e;_0x5836de[_0x59e520][_0x2dfbf9(0x230)]=_0x2546ab;}),_0x27918a[_0x41389e(0x1a6)]((_0x1888bb,_0x4badac)=>{var _0x4d98e5=_0x41389e;_0x5836de[_0x4badac][_0x4d98e5(0x1ce)]=_0x1888bb;}),_0x3d9b0e['forEach']((_0x18fc2d,_0x1f0eb3)=>{var _0x19dd85=_0x41389e;_0x5836de[_0x1f0eb3][_0x19dd85(0x1eb)]=_0x18fc2d;}),_0x162924[_0x41389e(0x1a6)]((_0x335878,_0x428836)=>{var _0x5a173c=_0x41389e;_0x5836de[_0x428836][_0x5a173c(0x1b4)]=_0x335878;}),_0x4bc5fe[_0x41389e(0x1a6)]((_0x32e715,_0xde9759)=>{var _0x3f2012=_0x41389e;_0x5836de[_0xde9759][_0x3f2012(0x262)]=_0x32e715;}),_0x4405e3[_0x41389e(0x1a6)]((_0x15bca4,_0x9f6d35)=>{var _0x4a6970=_0x41389e;_0x5836de[_0x9f6d35][_0x4a6970(0x245)]=_0x15bca4;}),_0x3da1fa['forEach']((_0x3c2ae6,_0x23d822)=>{var _0x5d4c66=_0x41389e;_0x5836de[_0x23d822][_0x5d4c66(0x1d1)]=_0x3c2ae6;}),_0x25ab4e[_0x41389e(0x1a6)]((_0x4061ab,_0x12f428)=>{var _0x46f4f6=_0x41389e;_0x5836de[_0x12f428][_0x46f4f6(0x1f4)]=_0x4061ab;});const _0x165ec0=_0x5836de[_0x41389e(0x221)](_0x35b126=>_0x35b126[_0x41389e(0x279)]!=='0'&&_0x35b126[_0x41389e(0x279)]!==''),_0x29f038=new purchases_finished({'invoice':_0x5f0b53,'suppliers':_0x4a91ee[_0x41389e(0x1a8)][_0x41389e(0x272)],'date':_0xdd6348,'warehouse_name':_0x3b4fe8,'product':_0x165ec0,'note':_0x512f2f,'due_amount':_0x259a79,'room':_0x451963,'POnumber':_0x54b262,'SCRN':_0x44e1eb,'JO_number':_0x31cc8b}),_0x2cb05e=await _0x29f038[_0x41389e(0x22d)](),_0x5210a0=await purchases_finished['findOne']({'invoice':_0x5f0b53}),_0x22b1b5=_0x5210a0[_0x41389e(0x1c0)][_0x41389e(0x1dd)](async _0x32c591=>{var _0x59200d=_0x41389e;try{var _0x2bd4e5=await warehouse[_0x59200d(0x26f)]({'name':_0x3b4fe8,'room':_0x32c591['room_name']}),_0x4aef4b=0x0;const _0x18fed0=_0x2bd4e5[_0x59200d(0x261)]['map'](_0x2dd89d=>{var _0x14a710=_0x59200d;console[_0x14a710(0x1ee)](_0x2dd89d[_0x14a710(0x299)]+'=='+_0x32c591['product_name']+'&&'+_0x2dd89d[_0x14a710(0x1f0)]+'=='+_0x32c591[_0x14a710(0x1f0)]+'&&'+_0x2dd89d['expiry_date']+'=='+_0x32c591[_0x14a710(0x1eb)]+'&&'+_0x2dd89d['production_date']+'=='+_0x32c591[_0x14a710(0x1b4)]+'&&'+_0x2dd89d[_0x14a710(0x1ce)]+'=='+_0x32c591[_0x14a710(0x1ce)]+'&&'+_0x2dd89d[_0x14a710(0x1f4)]+'=='+_0x5210a0[_0x14a710(0x1f4)]),_0x2dd89d[_0x14a710(0x299)]==_0x32c591[_0x14a710(0x299)]&&_0x2dd89d[_0x14a710(0x1f0)]==_0x32c591[_0x14a710(0x1f0)]&&_0x2dd89d[_0x14a710(0x1eb)]==_0x32c591['expiry_date']&&_0x2dd89d[_0x14a710(0x1b4)]==_0x32c591['production_date']&&_0x2dd89d[_0x14a710(0x1ce)]==_0x32c591[_0x14a710(0x1ce)]&&_0x2dd89d[_0x14a710(0x1f4)]==_0x5210a0[_0x14a710(0x1f4)]&&(_0x2dd89d[_0x14a710(0x1bb)]=Math[_0x14a710(0x23b)](_0x2dd89d['product_stock'])+Math[_0x14a710(0x23b)](_0x32c591[_0x14a710(0x279)]),_0x4aef4b++);});return _0x4aef4b==0x0&&(_0x2bd4e5['product_details']=_0x2bd4e5[_0x59200d(0x261)]['concat']({'product_name':_0x32c591[_0x59200d(0x299)],'product_stock':Math[_0x59200d(0x23b)](_0x32c591['quantity']),'primary_code':_0x32c591['primary_code'],'secondary_code':_0x32c591[_0x59200d(0x1a3)],'product_code':_0x32c591[_0x59200d(0x1e3)],'bay':_0x32c591[_0x59200d(0x1f0)],'maxProducts':_0x32c591['maxStocks'],'unit':_0x32c591[_0x59200d(0x1ae)],'secondary_unit':_0x32c591['secondary_unit'],'expiry_date':_0x32c591[_0x59200d(0x1eb)],'production_date':_0x32c591['production_date'],'maxProducts':_0x32c591[_0x59200d(0x230)],'maxPerUnit':_0x32c591[_0x59200d(0x262)],'batch_code':_0x32c591[_0x59200d(0x1ce)],'product_cat':_0x32c591[_0x59200d(0x245)],'invoice':_0x32c591[_0x59200d(0x1f4)],'id_incoming':_0x32c591[_0x59200d(0x23d)]})),_0x2bd4e5;}catch(_0x2e01f3){return console[_0x59200d(0x19c)](_0x59200d(0x218),_0x2e01f3),null;}});Promise['all'](_0x22b1b5)[_0x41389e(0x23f)](async _0x4befef=>{var _0x3555c2=_0x41389e;try{for(const _0x1c1a6 of _0x4befef){await warehouse[_0x3555c2(0x220)]({'_id':_0x1c1a6[_0x3555c2(0x23d)]},{'$addToSet':{'product_details':{'$each':_0x1c1a6[_0x3555c2(0x261)]}}});}const _0xa421b8=await master_shop[_0x3555c2(0x1ab)](),_0x52c8a1=await email_settings[_0x3555c2(0x26f)](),_0x29ce21=await supervisor_settings[_0x3555c2(0x1ab)]();var _0x45b94a=_0x5210a0[_0x3555c2(0x1c0)],_0x227ba9='',_0x139a02;for(_0x139a02 in _0x45b94a){var _0x383075='FG';_0x5210a0[_0x3555c2(0x254)]==_0x3555c2(0x195)&&(_0x383075='DG'),_0x227ba9+=_0x3555c2(0x298)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x45b94a[_0x139a02]['product_name']+'</td>'+_0x3555c2(0x1a9)+_0x45b94a[_0x139a02][_0x3555c2(0x1e3)]+_0x3555c2(0x24c)+_0x3555c2(0x1a9)+_0x45b94a[_0x139a02]['quantity']+_0x3555c2(0x24c)+_0x3555c2(0x1a9)+_0x45b94a[_0x139a02][_0x3555c2(0x1ae)]+_0x3555c2(0x24c)+_0x3555c2(0x1a9)+_0x45b94a[_0x139a02][_0x3555c2(0x199)]+_0x3555c2(0x24c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5210a0[_0x3555c2(0x254)]+_0x3555c2(0x24c)+_0x3555c2(0x1a9)+_0x45b94a[_0x139a02][_0x3555c2(0x1d1)]+_0x3555c2(0x24c)+_0x3555c2(0x1a9)+_0x383075+_0x45b94a[_0x139a02][_0x3555c2(0x1f0)]+_0x3555c2(0x24c),_0x3555c2(0x259);}let _0x3b1bf6=nodemailer[_0x3555c2(0x22a)]({'host':_0x52c8a1['host'],'port':Number(_0x52c8a1[_0x3555c2(0x1d4)]),'secure':![],'auth':{'user':_0x52c8a1[_0x3555c2(0x260)],'pass':_0x52c8a1[_0x3555c2(0x19d)]}}),_0x1c91fe={'from':_0x52c8a1[_0x3555c2(0x260)],'to':_0x29ce21[0x0][_0x3555c2(0x287)],'subject':_0x3555c2(0x238),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3555c2(0x1b9)+'/upload/'+_0xa421b8[0x0][_0x3555c2(0x235)],'cid':_0x3555c2(0x27a)}],'html':'<!DOCTYPE\x20html>'+_0x3555c2(0x1c9)+_0x3555c2(0x1e8)+_0x3555c2(0x19f)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3555c2(0x19f)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3555c2(0x27d)+_0x3555c2(0x19f)+_0x3555c2(0x21a)+_0xa421b8[0x0]['site_title']+_0x3555c2(0x1c2)+_0x3555c2(0x27d)+_0x3555c2(0x27d)+_0x3555c2(0x24e)+_0x3555c2(0x19f)+_0x3555c2(0x228)+'\x20Order\x20Number\x20:\x20'+_0x5210a0['invoice']+'\x20'+_0x3555c2(0x26c)+_0x3555c2(0x197)+_0x5210a0['date']+'\x20'+_0x3555c2(0x288)+'</h5>'+_0x3555c2(0x27d)+_0x3555c2(0x232)+_0x3555c2(0x266)+_0x3555c2(0x298)+_0x3555c2(0x19e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x3555c2(0x229)+_0x3555c2(0x1d3)+_0x3555c2(0x206)+_0x3555c2(0x1b0)+_0x3555c2(0x284)+_0x3555c2(0x263)+_0x3555c2(0x259)+_0x3555c2(0x239)+_0x3555c2(0x1fb)+'\x20'+_0x227ba9+'\x20'+_0x3555c2(0x25e)+'</table>'+_0x3555c2(0x19f)+_0x3555c2(0x1be)+'<h5>'+_0xa421b8[0x0][_0x3555c2(0x225)]+_0x3555c2(0x242)+_0x3555c2(0x27d)+'</div>'+'</body></html>'};_0x3b1bf6[_0x3555c2(0x286)](_0x1c91fe,function(_0x885b18,_0x706f89){var _0x468b59=_0x3555c2;_0x885b18?(console['log'](_0x885b18),console[_0x468b59(0x1ee)](_0x468b59(0x1e7))):console[_0x468b59(0x1ee)](_0x468b59(0x28f));});}catch(_0x1d5f86){console[_0x3555c2(0x19c)](_0x1d5f86),_0x33cbec['status'](0x1f4)[_0x3555c2(0x24f)]({'error':_0x3555c2(0x1af),'message':_0x1d5f86[_0x3555c2(0x1a4)]});}})['catch'](_0x56854f=>{console['error'](_0x56854f);}),_0x4a91ee[_0x41389e(0x216)]('success',_0x41389e(0x25d)),_0x33cbec[_0x41389e(0x296)](_0x41389e(0x1c7));}catch(_0x27f42b){console['log'](_0x27f42b);}}),router[a0_0x1035b3(0x1b8)](a0_0x1035b3(0x191),auth,async(_0x19d741,_0x239302)=>{var _0x28966d=a0_0x1035b3;try{const {username:_0x1c1699,email:_0x54a092,role:_0x3f294b}=_0x19d741[_0x28966d(0x208)],_0x42c9c4=_0x19d741['user'],_0x74d6ee=await profile[_0x28966d(0x26f)]({'email':_0x42c9c4[_0x28966d(0x260)]}),_0x4bbe1a=await master_shop[_0x28966d(0x1ab)](),_0x508b9b=_0x19d741[_0x28966d(0x1ef)]['id'],_0x2cdbc=await purchases_finished[_0x28966d(0x1e0)](_0x508b9b),_0x570380=await suppliers[_0x28966d(0x1ab)]({});let _0x3d0a92;if(_0x42c9c4[_0x28966d(0x276)]==_0x28966d(0x219)){const _0xf48c3e=await staff[_0x28966d(0x26f)]({'email':_0x42c9c4[_0x28966d(0x260)]});_0x3d0a92=await warehouse['find']({'status':'Enabled','name':_0xf48c3e[_0x28966d(0x1c3)],'warehouse_category':_0x28966d(0x270)});}else _0x3d0a92=await warehouse[_0x28966d(0x1d0)]([{'$match':{'status':_0x28966d(0x224),'warehouse_category':_0x28966d(0x270)}},{'$group':{'_id':_0x28966d(0x1d9),'name':{'$first':_0x28966d(0x1d9)}}}]);const _0x37f16f=await product[_0x28966d(0x1ab)]({}),_0x13b9f3=BayBinSelected(_0x2cdbc[_0x28966d(0x254)],_0x2cdbc['room']);let _0x52b26a=new Date(_0x2cdbc[_0x28966d(0x1eb)]),_0x3d40af=('0'+_0x52b26a[_0x28966d(0x1ca)]())['slice'](-0x2),_0xd64086=('0'+(_0x52b26a[_0x28966d(0x23a)]()+0x1))[_0x28966d(0x252)](-0x2),_0x5132fe=_0x52b26a['getFullYear'](),_0xa65e07=_0x5132fe+'-'+_0xd64086+'-'+_0x3d40af;if(_0x4bbe1a[0x0][_0x28966d(0x251)]==_0x28966d(0x292)){var _0x4bb745=users[_0x28966d(0x24b)];console['log'](_0x4bb745);}else{if(_0x4bbe1a[0x0][_0x28966d(0x251)]==_0x28966d(0x227))var _0x4bb745=users[_0x28966d(0x227)];else{if(_0x4bbe1a[0x0][_0x28966d(0x251)]==_0x28966d(0x28a))var _0x4bb745=users[_0x28966d(0x28a)];else{if(_0x4bbe1a[0x0][_0x28966d(0x251)]==_0x28966d(0x203))var _0x4bb745=users[_0x28966d(0x203)];else{if(_0x4bbe1a[0x0][_0x28966d(0x251)]=='French')var _0x4bb745=users[_0x28966d(0x1bd)];else{if(_0x4bbe1a[0x0][_0x28966d(0x251)]=='Portuguese\x20(BR)')var _0x4bb745=users['Portuguese'];else{if(_0x4bbe1a[0x0][_0x28966d(0x251)]==_0x28966d(0x243))var _0x4bb745=users[_0x28966d(0x243)];else{if(_0x4bbe1a[0x0]['language']==_0x28966d(0x1fd))var _0x4bb745=users[_0x28966d(0x1e5)];}}}}}}}_0x239302[_0x28966d(0x20b)](_0x28966d(0x200),{'success':_0x19d741[_0x28966d(0x216)](_0x28966d(0x1db)),'errors':_0x19d741[_0x28966d(0x216)](_0x28966d(0x1f8)),'role':_0x42c9c4,'profile':_0x74d6ee,'purchases':_0x2cdbc,'suppliers':_0x570380,'warehouse':_0x3d0a92,'product':_0x37f16f,'master_shop':_0x4bbe1a,'language':_0x4bb745,'ed_fullDate':_0xa65e07,'dataSelected':_0x13b9f3});}catch(_0x5b369b){console[_0x28966d(0x1ee)](_0x5b369b);}}),router['get']('/view/:id',auth,async(_0x3f0bed,_0x46f9b7)=>{var _0x2f9a5d=a0_0x1035b3;try{const {username:_0x3f2a37,email:_0x43c001,role:_0xc6edb9}=_0x3f0bed[_0x2f9a5d(0x208)],_0x32d629=_0x3f0bed[_0x2f9a5d(0x208)],_0x292f7c=await profile[_0x2f9a5d(0x26f)]({'email':_0x32d629[_0x2f9a5d(0x260)]}),_0xb50391=await master_shop[_0x2f9a5d(0x1ab)](),_0x3e6765=_0x3f0bed['params']['id'],_0x4cb8ef=await purchases_finished[_0x2f9a5d(0x1e0)](_0x3e6765),_0x31dbae=await suppliers[_0x2f9a5d(0x1ab)]({});let _0x5bce9d;if(_0x32d629[_0x2f9a5d(0x276)]=='staff'){const _0x5803f7=await staff['findOne']({'email':_0x32d629[_0x2f9a5d(0x260)]});_0x5bce9d=await warehouse[_0x2f9a5d(0x1ab)]({'status':_0x2f9a5d(0x224),'name':_0x5803f7['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x5bce9d=await warehouse[_0x2f9a5d(0x1d0)]([{'$match':{'status':'Enabled','warehouse_category':_0x2f9a5d(0x270)}},{'$group':{'_id':'$name','name':{'$first':_0x2f9a5d(0x1d9)}}}]);const _0x4f85ad=await product[_0x2f9a5d(0x1ab)]({}),_0xa5c6d5=BayBinSelected(_0x4cb8ef[_0x2f9a5d(0x254)],_0x4cb8ef[_0x2f9a5d(0x1c8)]);let _0x1f6157=new Date(_0x4cb8ef[_0x2f9a5d(0x1eb)]),_0x357aab=('0'+_0x1f6157[_0x2f9a5d(0x1ca)]())[_0x2f9a5d(0x252)](-0x2),_0x56d00b=('0'+(_0x1f6157['getMonth']()+0x1))['slice'](-0x2),_0xebb48b=_0x1f6157[_0x2f9a5d(0x1a1)](),_0x441b08=_0xebb48b+'-'+_0x56d00b+'-'+_0x357aab;if(_0xb50391[0x0]['language']==_0x2f9a5d(0x292)){var _0x3ab49f=users[_0x2f9a5d(0x24b)];console['log'](_0x3ab49f);}else{if(_0xb50391[0x0][_0x2f9a5d(0x251)]==_0x2f9a5d(0x227))var _0x3ab49f=users[_0x2f9a5d(0x227)];else{if(_0xb50391[0x0][_0x2f9a5d(0x251)]==_0x2f9a5d(0x28a))var _0x3ab49f=users['German'];else{if(_0xb50391[0x0][_0x2f9a5d(0x251)]==_0x2f9a5d(0x203))var _0x3ab49f=users[_0x2f9a5d(0x203)];else{if(_0xb50391[0x0][_0x2f9a5d(0x251)]==_0x2f9a5d(0x1bd))var _0x3ab49f=users[_0x2f9a5d(0x1bd)];else{if(_0xb50391[0x0][_0x2f9a5d(0x251)]=='Portuguese\x20(BR)')var _0x3ab49f=users['Portuguese'];else{if(_0xb50391[0x0][_0x2f9a5d(0x251)]==_0x2f9a5d(0x243))var _0x3ab49f=users['Chinese'];else{if(_0xb50391[0x0]['language']=='Arabic\x20(ae)')var _0x3ab49f=users['Arabic'];}}}}}}}_0x46f9b7[_0x2f9a5d(0x20b)](_0x2f9a5d(0x193),{'success':_0x3f0bed['flash'](_0x2f9a5d(0x1db)),'errors':_0x3f0bed[_0x2f9a5d(0x216)](_0x2f9a5d(0x1f8)),'role':_0x32d629,'profile':_0x292f7c,'purchases':_0x4cb8ef,'suppliers':_0x31dbae,'warehouse':_0x5bce9d,'product':_0x4f85ad,'master_shop':_0xb50391,'language':_0x3ab49f,'ed_fullDate':_0x441b08,'dataSelected':_0xa5c6d5});}catch(_0x599da9){console[_0x2f9a5d(0x1ee)](_0x599da9);}}),router[a0_0x1035b3(0x249)](a0_0x1035b3(0x1aa),auth,async(_0x441f08,_0x7ad0b0)=>{var _0x487da3=a0_0x1035b3;try{const _0x316d6a=_0x441f08[_0x487da3(0x1ef)]['id'],_0x3c14d1=await purchases_finished[_0x487da3(0x26f)]({'_id':_0x441f08['params']['id']}),_0x3f639a=await warehouse[_0x487da3(0x26f)]({'name':_0x3c14d1['warehouse_name'],'room':_0x3c14d1['room']});_0x3c14d1[_0x487da3(0x1c0)]['forEach'](_0x42567d=>{var _0x31849f=_0x487da3;const _0x284b93=_0x3f639a[_0x31849f(0x261)][_0x31849f(0x1dd)](_0x596c21=>{var _0x464299=_0x31849f;_0x596c21['product_name']==_0x42567d[_0x464299(0x299)]&&_0x596c21[_0x464299(0x1f0)]==_0x42567d[_0x464299(0x1f0)]&&(_0x596c21[_0x464299(0x1bb)]=parseInt(_0x596c21['product_stock'])-parseInt(_0x42567d['quantity']));});}),await _0x3f639a[_0x487da3(0x22d)]();const {invoice:_0xfa21b5,suppliers:_0x37c719,date:_0x3322a3,warehouse_name:_0x25c924,prod_name:_0x4c7922,prod_code:_0x120cfb,prod_qty:_0x21f3f2,prod_unit:_0x2847a5,prod_secondunit:_0x3caafe,prod_level:_0x28232b,prod_isle:_0x1f4db9,prod_pallet:_0x32f5a0,note:_0x55c657,expiry_date:_0x490625,batch_code:_0x5f585c,paid_amount:_0xef1674,due_amount:_0x4df931,Room_name:_0x55af27,primary_code:_0x59ab92,secondary_code:_0x52e703,PO_number:_0x22c414,JO_number:_0x23dcc6}=_0x441f08['body'];if(typeof _0x4c7922==_0x487da3(0x1a0))var _0x4f32a0=[_0x441f08['body']['prod_name']],_0x446ba5=[_0x441f08[_0x487da3(0x1a8)][_0x487da3(0x21e)]],_0x2a9544=[_0x441f08['body'][_0x487da3(0x257)]],_0x5c9161=[_0x441f08[_0x487da3(0x1a8)]['prod_unit']],_0x57688f=[_0x441f08['body'][_0x487da3(0x294)]],_0x16b259=[_0x441f08['body'][_0x487da3(0x1d6)]],_0x2b64bb=[_0x441f08[_0x487da3(0x1a8)]['primary_code']],_0x238951=[_0x441f08['body'][_0x487da3(0x1a3)]],_0x1b402d=[_0x441f08[_0x487da3(0x1a8)][_0x487da3(0x293)]],_0x1dbcea=[_0x441f08['body'][_0x487da3(0x1ce)]],_0x284c63=[_0x441f08[_0x487da3(0x1a8)][_0x487da3(0x1eb)]];else var _0x4f32a0=[..._0x441f08[_0x487da3(0x1a8)][_0x487da3(0x201)]],_0x446ba5=[..._0x441f08['body'][_0x487da3(0x21e)]],_0x2a9544=[..._0x441f08[_0x487da3(0x1a8)]['prod_qty']],_0x5c9161=[..._0x441f08[_0x487da3(0x1a8)][_0x487da3(0x215)]],_0x57688f=[..._0x441f08['body'][_0x487da3(0x294)]],_0x16b259=[..._0x441f08[_0x487da3(0x1a8)][_0x487da3(0x1d6)]],_0x2b64bb=[..._0x441f08['body'][_0x487da3(0x21c)]],_0x238951=[..._0x441f08[_0x487da3(0x1a8)]['secondary_code']],_0x1b402d=[..._0x441f08['body'][_0x487da3(0x293)]],_0x1dbcea=[..._0x441f08[_0x487da3(0x1a8)][_0x487da3(0x1ce)]],_0x284c63=[..._0x441f08['body'][_0x487da3(0x1eb)]];const _0x516072=_0x4f32a0[_0x487da3(0x1dd)](_0x623a77=>{return _0x623a77={'product_name':_0x623a77};});_0x446ba5['forEach']((_0x7af814,_0x537a36)=>{_0x516072[_0x537a36]['product_code']=_0x7af814;}),_0x2a9544[_0x487da3(0x1a6)]((_0x398bc8,_0x22c6c0)=>{var _0x4c1de0=_0x487da3;_0x516072[_0x22c6c0][_0x4c1de0(0x279)]=_0x398bc8;}),_0x5c9161[_0x487da3(0x1a6)]((_0x36ca74,_0x1003fe)=>{var _0x279674=_0x487da3;_0x516072[_0x1003fe][_0x279674(0x1ae)]=_0x36ca74;}),_0x57688f[_0x487da3(0x1a6)]((_0xa5a726,_0xd7991a)=>{var _0x8f2b30=_0x487da3;_0x516072[_0xd7991a][_0x8f2b30(0x199)]=_0xa5a726;}),_0x16b259[_0x487da3(0x1a6)]((_0x56b868,_0x3ab530)=>{var _0x3352b0=_0x487da3;_0x516072[_0x3ab530][_0x3352b0(0x1f0)]=_0x56b868;}),_0x2b64bb[_0x487da3(0x1a6)]((_0x54f46d,_0x4cac36)=>{_0x516072[_0x4cac36]['primary_code']=_0x54f46d;}),_0x238951[_0x487da3(0x1a6)]((_0x239b48,_0x2a0731)=>{var _0x5a0f3c=_0x487da3;_0x516072[_0x2a0731][_0x5a0f3c(0x1a3)]=_0x239b48;}),_0x1b402d[_0x487da3(0x1a6)]((_0x55751c,_0xa5be67)=>{var _0x104e3f=_0x487da3;_0x516072[_0xa5be67][_0x104e3f(0x230)]=_0x55751c;}),_0x1dbcea[_0x487da3(0x1a6)]((_0x1d08ff,_0x5d6256)=>{var _0x5c4106=_0x487da3;_0x516072[_0x5d6256][_0x5c4106(0x1ce)]=_0x1d08ff;}),_0x284c63[_0x487da3(0x1a6)]((_0x305bbc,_0x4e23e7)=>{var _0x1a64a6=_0x487da3;_0x516072[_0x4e23e7][_0x1a64a6(0x1eb)]=_0x305bbc;});const _0x3247a6=_0x516072[_0x487da3(0x221)](_0x409d18=>_0x409d18['quantity']!=='0'&&_0x409d18['quantity']!=='');_0x3c14d1['invoice']=_0xfa21b5,_0x3c14d1[_0x487da3(0x272)]=_0x37c719,_0x3c14d1[_0x487da3(0x25f)]=_0x3322a3,_0x3c14d1[_0x487da3(0x254)]=_0x25c924,_0x3c14d1[_0x487da3(0x1c0)]=_0x3247a6,_0x3c14d1[_0x487da3(0x19b)]=_0x55c657,_0x3c14d1[_0x487da3(0x244)]=_0xef1674,_0x3c14d1[_0x487da3(0x248)]=_0x4df931,_0x3c14d1['room']=_0x55af27,_0x3c14d1[_0x487da3(0x20c)]=_0x22c414,_0x3c14d1[_0x487da3(0x217)]=_0x23dcc6;const _0x260f56=await _0x3c14d1[_0x487da3(0x22d)](),_0x3dedbe=await warehouse[_0x487da3(0x26f)]({'name':_0x441f08[_0x487da3(0x1a8)][_0x487da3(0x254)],'room':_0x441f08[_0x487da3(0x1a8)][_0x487da3(0x1ec)]});_0x3c14d1[_0x487da3(0x1c0)][_0x487da3(0x1a6)](_0x17809a=>{var _0x2aa1e2=_0x487da3,_0x438683=0x0;const _0x50b80e=_0x3dedbe['product_details']['map'](_0x1d47b2=>{var _0x4d85fd=a0_0x58ac;_0x1d47b2['product_name']==_0x17809a[_0x4d85fd(0x299)]&&_0x1d47b2[_0x4d85fd(0x1f0)]==_0x17809a[_0x4d85fd(0x1f0)]&&(_0x1d47b2['product_stock']=parseInt(_0x1d47b2[_0x4d85fd(0x1bb)])+parseInt(_0x17809a[_0x4d85fd(0x279)]),_0x438683++);});_0x438683=='0'&&(_0x3dedbe['product_details']=_0x3dedbe[_0x2aa1e2(0x261)]['concat']({'product_name':_0x17809a[_0x2aa1e2(0x299)],'product_stock':_0x17809a[_0x2aa1e2(0x279)],'primary_code':_0x17809a[_0x2aa1e2(0x21c)],'secondary_code':_0x17809a['secondary_code'],'product_code':_0x17809a[_0x2aa1e2(0x1e3)],'bay':_0x17809a[_0x2aa1e2(0x1f0)],'maxProducts':_0x17809a[_0x2aa1e2(0x230)],'unit':_0x17809a[_0x2aa1e2(0x1ae)],'secondary_unit':_0x17809a[_0x2aa1e2(0x199)],'expiry_date':_0x17809a[_0x2aa1e2(0x1eb)]}));}),await _0x3dedbe[_0x487da3(0x22d)]();const _0xd663ed=await s_payment_data[_0x487da3(0x26f)]({'invoice':_0x441f08[_0x487da3(0x1a8)]['invoice']});if(_0xd663ed===null){}else console[_0x487da3(0x1ee)](_0x487da3(0x272),_0xd663ed,_0x441f08[_0x487da3(0x1a8)][_0x487da3(0x1f4)]),_0xd663ed[_0x487da3(0x272)]=_0x441f08[_0x487da3(0x1a8)][_0x487da3(0x272)],await _0xd663ed[_0x487da3(0x22d)]();_0x441f08[_0x487da3(0x216)](_0x487da3(0x1db),_0x487da3(0x209)),_0x7ad0b0['redirect'](_0x487da3(0x1c7));}catch(_0x25d2a4){console[_0x487da3(0x1ee)](_0x25d2a4);}}),router[a0_0x1035b3(0x249)](a0_0x1035b3(0x28c),auth,async(_0x36897d,_0x1f0fa6)=>{var _0x39b1e2=a0_0x1035b3;try{const _0x1c392e=_0x36897d[_0x39b1e2(0x1ef)]['id'],{invoice:_0x5a2be1,suppliers:_0x2d0b75,payable:_0x3bc2f1,due_amount:_0x339b5f}=_0x36897d['body'],_0x25fdb8=await purchases[_0x39b1e2(0x1e0)](_0x1c392e);var _0x394f13=_0x3bc2f1-_0x339b5f;_0x25fdb8[_0x39b1e2(0x244)]=parseFloat(_0x25fdb8[_0x39b1e2(0x244)])+parseFloat(_0x339b5f),_0x25fdb8[_0x39b1e2(0x248)]=_0x394f13;const _0x5e8b63=await _0x25fdb8['save']();console[_0x39b1e2(0x1ee)](_0x5e8b63);const _0x3b4193=await s_payment_data[_0x39b1e2(0x26f)]({'invoice':_0x5a2be1});_0x3b4193[_0x39b1e2(0x23e)]=_0x394f13,await _0x3b4193['save']();let _0x318d56=new Date(),_0x34c3aa=('0'+_0x318d56['getDate']())[_0x39b1e2(0x252)](-0x2),_0x554a16=('0'+(_0x318d56[_0x39b1e2(0x23a)]()+0x1))['slice'](-0x2),_0x8c02a9=_0x318d56[_0x39b1e2(0x1a1)](),_0x55f7be=_0x8c02a9+'-'+_0x554a16+'-'+_0x34c3aa;const _0x948a5=new suppliers_payment({'invoice':_0x5a2be1,'date':_0x8c02a9+'-'+_0x554a16+'-'+_0x34c3aa,'suppliers':_0x2d0b75,'reason':_0x39b1e2(0x1f7),'amount':_0x339b5f}),_0x415ae4=await _0x948a5['save']();_0x36897d[_0x39b1e2(0x216)](_0x39b1e2(0x1db),_0x39b1e2(0x1f9)),_0x1f0fa6[_0x39b1e2(0x296)](_0x39b1e2(0x28d));}catch(_0x5039c5){console['log'](_0x5039c5);}}),router['get'](a0_0x1035b3(0x295),auth,async(_0x1a80a5,_0x210823)=>{var _0x2d6dbc=a0_0x1035b3;try{const {username:_0x182156,email:_0x399808,role:_0x453db1}=_0x1a80a5['user'],_0x8e34be=_0x1a80a5[_0x2d6dbc(0x208)],_0x4aa99e=await profile['findOne']({'email':_0x8e34be[_0x2d6dbc(0x260)]}),_0x5bdabf=await master_shop[_0x2d6dbc(0x1ab)]();console['log'](_0x2d6dbc(0x28e),_0x5bdabf);const _0x4cddc8=_0x1a80a5[_0x2d6dbc(0x1ef)]['id'],_0x1ec86d=await purchases['findById'](_0x4cddc8);console[_0x2d6dbc(0x1ee)](_0x1ec86d);const _0x51887d=await suppliers[_0x2d6dbc(0x26f)]({'name':_0x1ec86d[_0x2d6dbc(0x272)]});console[_0x2d6dbc(0x1ee)](_0x51887d);if(_0x5bdabf[0x0]['language']=='English\x20(US)'){var _0x502728=users['English'];console[_0x2d6dbc(0x1ee)](_0x502728);}else{if(_0x5bdabf[0x0]['language']==_0x2d6dbc(0x227))var _0x502728=users[_0x2d6dbc(0x227)];else{if(_0x5bdabf[0x0][_0x2d6dbc(0x251)]==_0x2d6dbc(0x28a))var _0x502728=users[_0x2d6dbc(0x28a)];else{if(_0x5bdabf[0x0][_0x2d6dbc(0x251)]=='Spanish')var _0x502728=users[_0x2d6dbc(0x203)];else{if(_0x5bdabf[0x0][_0x2d6dbc(0x251)]==_0x2d6dbc(0x1bd))var _0x502728=users['French'];else{if(_0x5bdabf[0x0][_0x2d6dbc(0x251)]==_0x2d6dbc(0x22e))var _0x502728=users[_0x2d6dbc(0x285)];else{if(_0x5bdabf[0x0]['language']==_0x2d6dbc(0x243))var _0x502728=users['Chinese'];else{if(_0x5bdabf[0x0][_0x2d6dbc(0x251)]=='Arabic\x20(ae)')var _0x502728=users[_0x2d6dbc(0x1e5)];}}}}}}}_0x210823[_0x2d6dbc(0x20b)](_0x2d6dbc(0x1d7),{'success':_0x1a80a5[_0x2d6dbc(0x216)](_0x2d6dbc(0x1db)),'errors':_0x1a80a5[_0x2d6dbc(0x216)](_0x2d6dbc(0x1f8)),'role':_0x8e34be,'profile':_0x4aa99e,'master_shop':_0x5bdabf,'supplier':_0x51887d,'purchase':_0x1ec86d,'language':_0x502728});}catch(_0xd50632){console[_0x2d6dbc(0x1ee)](_0xd50632);}}),router[a0_0x1035b3(0x1b8)]('/view/return_purchase/:id',auth,async(_0x17e376,_0x49f19c)=>{var _0x580e22=a0_0x1035b3;try{const {username:_0x5d6b83,email:_0x5a80fe,role:_0x2a61f3}=_0x17e376[_0x580e22(0x208)],_0x3cb24c=_0x17e376[_0x580e22(0x208)],_0x570684=await profile[_0x580e22(0x26f)]({'email':_0x3cb24c['email']}),_0xbeb62c=await master_shop['find']();console[_0x580e22(0x1ee)](_0x580e22(0x28e),_0xbeb62c);const _0x580b82=_0x17e376[_0x580e22(0x1ef)]['id'];console[_0x580e22(0x1ee)](_0x580b82);const _0x20f9f2=await purchases_finished[_0x580e22(0x1e0)](_0x580b82);console[_0x580e22(0x1ee)](_0x580e22(0x1e6),_0x20f9f2);const _0x7d8e=await product[_0x580e22(0x1ab)]({}),_0x95ea75=await warehouse['aggregate']([{'$match':{'name':_0x20f9f2['warehouse_name'],'room':_0x20f9f2[_0x580e22(0x1c8)]}},{'$unwind':_0x580e22(0x258)},{'$group':{'_id':_0x580e22(0x20f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x580e22(0x278)},'bay':{'$first':_0x580e22(0x28b)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x580e22(0x1fe)},'floorlevel':{'$first':_0x580e22(0x265)},'primary_code':{'$first':_0x580e22(0x21f)},'secondary_code':{'$first':_0x580e22(0x27c)},'product_code':{'$first':_0x580e22(0x255)},'storage':{'$first':_0x580e22(0x27e)},'rack':{'$first':'$product_details.rack'}}}]);console['log'](_0x580e22(0x268),_0x95ea75);let _0x321d9e;if(_0x3cb24c[_0x580e22(0x276)]==_0x580e22(0x219)){const _0x1c7d6b=await staff[_0x580e22(0x26f)]({'email':_0x3cb24c[_0x580e22(0x260)]});_0x321d9e=await warehouse[_0x580e22(0x1ab)]({'status':_0x580e22(0x224),'name':_0x1c7d6b['warehouse'],'warehouse_category':_0x580e22(0x270),'name':_0x580e22(0x194)});}else _0x321d9e=await warehouse[_0x580e22(0x1d0)]([{'$match':{'status':_0x580e22(0x224),'warehouse_category':_0x580e22(0x270),'name':_0x580e22(0x194)}},{'$group':{'_id':_0x580e22(0x1d9),'name':{'$first':_0x580e22(0x1d9)}}}]);if(_0xbeb62c[0x0][_0x580e22(0x251)]==_0x580e22(0x292)){var _0x25d84a=users['English'];console[_0x580e22(0x1ee)](_0x25d84a);}else{if(_0xbeb62c[0x0][_0x580e22(0x251)]=='Hindi')var _0x25d84a=users[_0x580e22(0x227)];else{if(_0xbeb62c[0x0][_0x580e22(0x251)]=='German')var _0x25d84a=users[_0x580e22(0x28a)];else{if(_0xbeb62c[0x0][_0x580e22(0x251)]==_0x580e22(0x203))var _0x25d84a=users['Spanish'];else{if(_0xbeb62c[0x0][_0x580e22(0x251)]==_0x580e22(0x1bd))var _0x25d84a=users['French'];else{if(_0xbeb62c[0x0][_0x580e22(0x251)]==_0x580e22(0x22e))var _0x25d84a=users['Portuguese'];else{if(_0xbeb62c[0x0][_0x580e22(0x251)]=='Chinese')var _0x25d84a=users[_0x580e22(0x243)];else{if(_0xbeb62c[0x0]['language']=='Arabic\x20(ae)')var _0x25d84a=users['Arabic'];}}}}}}}_0x49f19c[_0x580e22(0x20b)](_0x580e22(0x1e2),{'success':_0x17e376[_0x580e22(0x216)](_0x580e22(0x1db)),'errors':_0x17e376[_0x580e22(0x216)]('errors'),'role':_0x3cb24c,'profile':_0x570684,'user':_0x20f9f2,'stock':_0x95ea75,'master_shop':_0xbeb62c,'product':_0x7d8e,'language':_0x25d84a,'warehouse':_0x321d9e});}catch(_0x336361){console[_0x580e22(0x1ee)](_0x336361);}}),router[a0_0x1035b3(0x249)](a0_0x1035b3(0x256),auth,async(_0x24e326,_0x2bf16a)=>{var _0x1218c2=a0_0x1035b3;try{const {invoice:_0x205a5b,date:_0x3e0aed,warehouse_name:_0x2ccb46,Room_name:_0x540e38,product_name:_0xed407c,purchase_quantity:_0x45b7e1,stocks:_0x3daf47,return_qty:_0x41231a,note:_0x3d1de4,level:_0x88b532,isle:_0x2c888c,pallet:_0x184f68,to_warehouse_name:_0x1ed6f7,to_Room_name:_0x3c1850}=_0x24e326[_0x1218c2(0x1a8)],_0x16bcc0=await purchases_finished[_0x1218c2(0x26f)]({'_id':_0x24e326[_0x1218c2(0x1ef)]['id']}),_0x1683d0=await warehouse[_0x1218c2(0x26f)]({'name':_0x2ccb46,'room':_0x540e38,'warehouse_category':_0x1218c2(0x270)});if(typeof _0xed407c==_0x1218c2(0x1a0))var _0x73dfe4=[_0x24e326['body'][_0x1218c2(0x299)]],_0x1dafee=[_0x24e326[_0x1218c2(0x1a8)][_0x1218c2(0x274)]],_0x15ad37=[_0x24e326[_0x1218c2(0x1a8)]['stocks']],_0x4c0583=[_0x24e326[_0x1218c2(0x1a8)]['return_qty']],_0x560511=[_0x24e326['body'][_0x1218c2(0x1ea)]],_0x5e8993=[_0x24e326[_0x1218c2(0x1a8)][_0x1218c2(0x271)]],_0x4249bf=[_0x24e326['body'][_0x1218c2(0x289)]],_0x1bdab1=[_0x24e326[_0x1218c2(0x1a8)]['secondary_code_hide']];else var _0x73dfe4=[..._0x24e326[_0x1218c2(0x1a8)][_0x1218c2(0x299)]],_0x1dafee=[..._0x24e326[_0x1218c2(0x1a8)]['purchase_quantity']],_0x15ad37=[..._0x24e326[_0x1218c2(0x1a8)]['stocks']],_0x4c0583=[..._0x24e326[_0x1218c2(0x1a8)][_0x1218c2(0x234)]],_0x560511=[..._0x24e326[_0x1218c2(0x1a8)]['level']],_0x5e8993=[..._0x24e326['body'][_0x1218c2(0x271)]],_0x4249bf=[..._0x24e326[_0x1218c2(0x1a8)][_0x1218c2(0x289)]],_0x1bdab1=[..._0x24e326[_0x1218c2(0x1a8)][_0x1218c2(0x231)]];const _0x17ab6e=_0x73dfe4[_0x1218c2(0x1dd)](_0x2188dd=>{return _0x2188dd={'product_name':_0x2188dd};});_0x1dafee[_0x1218c2(0x1a6)]((_0x5e19f0,_0x131b2d)=>{var _0x2ef9f2=_0x1218c2;_0x17ab6e[_0x131b2d][_0x2ef9f2(0x274)]=_0x5e19f0;}),_0x15ad37[_0x1218c2(0x1a6)]((_0xf485d6,_0x23a2ce)=>{var _0x49b71e=_0x1218c2;_0x17ab6e[_0x23a2ce][_0x49b71e(0x226)]=_0xf485d6;}),_0x4c0583[_0x1218c2(0x1a6)]((_0x5152a1,_0x542108)=>{var _0x41185e=_0x1218c2;_0x17ab6e[_0x542108][_0x41185e(0x234)]=_0x5152a1;}),_0x560511[_0x1218c2(0x1a6)]((_0x410238,_0x1f1b66)=>{var _0x12205f=_0x1218c2;_0x17ab6e[_0x1f1b66][_0x12205f(0x1f0)]=_0x410238;}),_0x5e8993[_0x1218c2(0x1a6)]((_0x2d507b,_0x28ac98)=>{var _0x5c9aa0=_0x1218c2;_0x17ab6e[_0x28ac98][_0x5c9aa0(0x1e3)]=_0x2d507b;}),_0x4249bf['forEach']((_0x44218f,_0x300f6b)=>{var _0x38bdb3=_0x1218c2;_0x17ab6e[_0x300f6b][_0x38bdb3(0x21c)]=_0x44218f;}),_0x1bdab1[_0x1218c2(0x1a6)]((_0x476efe,_0x42eabe)=>{var _0x4ff687=_0x1218c2;_0x17ab6e[_0x42eabe][_0x4ff687(0x1a3)]=_0x476efe;}),_0x17ab6e[_0x1218c2(0x1a6)](_0x2d9e10=>{var _0x2e8bd3=_0x1218c2;console[_0x2e8bd3(0x1ee)](_0x2d9e10);const _0x28cb7e=_0x1683d0[_0x2e8bd3(0x261)][_0x2e8bd3(0x1dd)](_0x299d2a=>{var _0x4d844c=_0x2e8bd3;_0x299d2a[_0x4d844c(0x299)]==_0x2d9e10[_0x4d844c(0x299)]&&_0x299d2a[_0x4d844c(0x1f0)]==_0x2d9e10[_0x4d844c(0x1f0)]&&(console['log'](parseInt(_0x299d2a['product_stock'])+_0x4d844c(0x264)+parseInt(_0x2d9e10[_0x4d844c(0x234)])),_0x299d2a[_0x4d844c(0x1bb)]=parseInt(_0x299d2a['product_stock'])-parseInt(_0x2d9e10[_0x4d844c(0x234)]));});}),await _0x1683d0[_0x1218c2(0x22d)]();var _0xd18dd0=0x0;_0x17ab6e['forEach'](_0x2ce25e=>{var _0x28a99e=_0x1218c2;(parseInt(_0x2ce25e[_0x28a99e(0x274)])<parseInt(_0x2ce25e['return_qty'])||parseInt(_0x2ce25e['stock_quantity'])<parseInt(_0x2ce25e[_0x28a99e(0x234)]))&&_0xd18dd0++;});if(_0xd18dd0!=0x0)return _0x24e326[_0x1218c2(0x216)]('errors',_0x1218c2(0x192)),_0x2bf16a[_0x1218c2(0x296)](_0x1218c2(0x1d8));const _0x20a8b7=new purchases_return_finished({'invoice':_0x205a5b,'suppliers':_0x24e326[_0x1218c2(0x1a8)][_0x1218c2(0x272)],'date':_0x3e0aed,'warehouse_name':_0x2ccb46,'return_product':_0x17ab6e,'note':_0x3d1de4,'room':_0x540e38,'to_warehouse_name':_0x1ed6f7,'to_room':_0x3c1850}),_0x8efd11=await _0x20a8b7['save'](),_0x47640a=await purchases_return_finished['findOne']({'invoice':_0x205a5b}),_0x2adc38=await warehouse[_0x1218c2(0x26f)]({'name':_0x1ed6f7,'room':_0x3c1850,'warehouse_category':_0x1218c2(0x270)});_0x47640a[_0x1218c2(0x190)][_0x1218c2(0x1a6)](_0x38a17a=>{var _0x58e5b0=_0x1218c2,_0x1c5289=0x0;const _0x2b0ee8=_0x2adc38[_0x58e5b0(0x261)][_0x58e5b0(0x1dd)](_0x470cf6=>{var _0x5d37be=_0x58e5b0;console[_0x5d37be(0x1ee)](_0x470cf6[_0x5d37be(0x299)]+'=='+_0x38a17a[_0x5d37be(0x299)]+'&&'+_0x470cf6['bay']+'=='+_0x38a17a[_0x5d37be(0x1f0)]),_0x470cf6['product_name']==_0x38a17a[_0x5d37be(0x299)]&&_0x470cf6[_0x5d37be(0x1f0)]==_0x38a17a[_0x5d37be(0x1f0)]&&(_0x470cf6[_0x5d37be(0x1bb)]=parseInt(_0x470cf6[_0x5d37be(0x1bb)])-parseInt(_0x38a17a[_0x5d37be(0x234)]),_0x1c5289++);});_0x1c5289=='0'&&(_0x2adc38[_0x58e5b0(0x261)]=_0x2adc38[_0x58e5b0(0x261)][_0x58e5b0(0x205)]({'product_name':_0x38a17a[_0x58e5b0(0x299)],'product_stock':_0x38a17a[_0x58e5b0(0x234)],'primary_code':_0x38a17a[_0x58e5b0(0x21c)],'secondary_code':_0x38a17a[_0x58e5b0(0x1a3)],'product_code':_0x38a17a['product_code'],'bay':_0x38a17a[_0x58e5b0(0x1f0)],'maxProducts':0xf423f}));}),await _0x2adc38[_0x1218c2(0x22d)]();const _0x4ea7f4=await purchases_finished['findOne']({'invoice':_0x205a5b});_0x4ea7f4['return_data']=_0x1218c2(0x207);const _0x1c8559=await _0x4ea7f4[_0x1218c2(0x22d)](),_0xeb42d4=new s_payment_data({'invoice':_0x205a5b,'suppliers':_0x24e326['body']['suppliers'],'reason':_0x1218c2(0x20e)});await _0xeb42d4[_0x1218c2(0x22d)]();const _0x255b5a=await master_shop[_0x1218c2(0x1ab)](),_0x31157e=await email_settings[_0x1218c2(0x26f)](),_0x1509a5=await suppliers['findOne']({'name':_0x24e326[_0x1218c2(0x1a8)][_0x1218c2(0x272)]});_0x255b5a[0x0]['currency_placement']==0x1?(right_currency=_0x255b5a[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x255b5a[0x0][_0x1218c2(0x1ff)]);var _0x51da34=_0x73dfe4,_0x1088c7=_0x4c0583,_0x14ea85='',_0x3966c8;for(_0x3966c8 in _0x51da34){_0x14ea85+=_0x1218c2(0x298)+_0x1218c2(0x1a9)+_0x51da34[_0x3966c8]+_0x1218c2(0x24c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1088c7[_0x3966c8]+_0x1218c2(0x24c)+_0x1218c2(0x259);}let _0x58b29e=nodemailer[_0x1218c2(0x22a)]({'service':_0x1218c2(0x212),'auth':{'user':_0x31157e[_0x1218c2(0x260)],'pass':_0x31157e[_0x1218c2(0x19d)]}}),_0x36fbaf={'from':_0x31157e[_0x1218c2(0x260)],'to':_0x1509a5[_0x1218c2(0x260)],'subject':_0x1218c2(0x273),'attachments':[{'filename':_0x1218c2(0x241),'path':__dirname+_0x1218c2(0x1b9)+_0x1218c2(0x1b3)+_0x255b5a[0x0]['image'],'cid':_0x1218c2(0x27a)}],'html':_0x1218c2(0x236)+'<html><head><title></title>'+_0x1218c2(0x1e8)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1218c2(0x19f)+_0x1218c2(0x253)+_0x1218c2(0x27d)+'<div>'+_0x1218c2(0x21a)+_0x255b5a[0x0][_0x1218c2(0x225)]+_0x1218c2(0x1c2)+_0x1218c2(0x27d)+_0x1218c2(0x27d)+_0x1218c2(0x24e)+_0x1218c2(0x19f)+_0x1218c2(0x228)+_0x1218c2(0x1c5)+_0x205a5b+'\x20'+_0x1218c2(0x26c)+_0x1218c2(0x197)+_0x3e0aed+'\x20'+_0x1218c2(0x288)+'</h5>'+'</div>'+_0x1218c2(0x232)+_0x1218c2(0x266)+'<tr>'+_0x1218c2(0x19e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x1218c2(0x297)+_0x1218c2(0x259)+_0x1218c2(0x239)+_0x1218c2(0x1fb)+'\x20'+_0x14ea85+'\x20'+'</tbody>'+_0x1218c2(0x291)+_0x1218c2(0x19f)+_0x1218c2(0x1be)+_0x1218c2(0x1f6)+_0x255b5a[0x0]['site_title']+'</h5>'+_0x1218c2(0x27d)+_0x1218c2(0x27d)+_0x1218c2(0x1a5)};_0x58b29e[_0x1218c2(0x286)](_0x36fbaf,function(_0x71d90e,_0x23c913){var _0x12027c=_0x1218c2;_0x71d90e?console[_0x12027c(0x1ee)](_0x12027c(0x1e7)):console[_0x12027c(0x1ee)](_0x12027c(0x28f));}),_0x24e326[_0x1218c2(0x216)](_0x1218c2(0x1db),_0x1218c2(0x25b)),_0x2bf16a[_0x1218c2(0x296)](_0x1218c2(0x1c7));}catch(_0x8cbba6){_0x2bf16a[_0x1218c2(0x198)](0xc8)['json']({'message':_0x8cbba6[_0x1218c2(0x1a4)]});}}),router[a0_0x1035b3(0x1b8)]('/barcode/:id',auth,async(_0x4e671f,_0x3b0656)=>{var _0x23def7=a0_0x1035b3;try{const {username:_0x41a3c4,email:_0x1cb16,role:_0xf7be31}=_0x4e671f[_0x23def7(0x208)],_0x657157=_0x4e671f['user'],_0x2acfd4=await profile[_0x23def7(0x26f)]({'email':_0x657157[_0x23def7(0x260)]}),_0x3735e0=await master_shop['find'](),_0x4e6df9=_0x4e671f[_0x23def7(0x1ef)]['id'],_0x513f3c=await purchases_finished['findById'](_0x4e6df9);if(_0x3735e0[0x0]['language']==_0x23def7(0x292))var _0x234698=users[_0x23def7(0x24b)];else{if(_0x3735e0[0x0][_0x23def7(0x251)]==_0x23def7(0x227))var _0x234698=users['Hindi'];else{if(_0x3735e0[0x0][_0x23def7(0x251)]==_0x23def7(0x28a))var _0x234698=users['German'];else{if(_0x3735e0[0x0][_0x23def7(0x251)]=='Spanish')var _0x234698=users[_0x23def7(0x203)];else{if(_0x3735e0[0x0]['language']==_0x23def7(0x1bd))var _0x234698=users['French'];else{if(_0x3735e0[0x0][_0x23def7(0x251)]==_0x23def7(0x22e))var _0x234698=users[_0x23def7(0x285)];else{if(_0x3735e0[0x0]['language']==_0x23def7(0x243))var _0x234698=users['Chinese'];else{if(_0x3735e0[0x0]['language']==_0x23def7(0x1fd))var _0x234698=users[_0x23def7(0x1e5)];}}}}}}}_0x3b0656[_0x23def7(0x20b)](_0x23def7(0x282),{'success':_0x4e671f['flash'](_0x23def7(0x1db)),'errors':_0x4e671f[_0x23def7(0x216)](_0x23def7(0x1f8)),'role':_0x657157,'profile':_0x2acfd4,'alldata':_0x513f3c,'master_shop':_0x3735e0,'language':_0x234698}),console['log'](alldata);}catch(_0x5307e2){console['log'](_0x5307e2);}}),router[a0_0x1035b3(0x249)](a0_0x1035b3(0x1b2),async(_0x2ef11f,_0x10a6bd)=>{var _0x454226=a0_0x1035b3;const {product_code:_0x4298ed}=_0x2ef11f['body'];var _0x562ec0;const _0x5b0b9d=await product['aggregate']([{'$match':{'primary_code':_0x4298ed,'product_category':_0x454226(0x270)}},{'$group':{'_id':_0x454226(0x22c),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x454226(0x222)},'product_code':{'$first':_0x454226(0x247)},'primary_code':{'$first':_0x454226(0x196)},'secondary_code':{'$first':_0x454226(0x1e4)},'maxStocks':{'$first':_0x454226(0x23c)},'maxProdPerUnit':{'$first':_0x454226(0x269)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x454226(0x1da)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5d4a23=await product[_0x454226(0x1d0)]([{'$match':{'secondary_code':_0x4298ed}},{'$group':{'_id':'$_id','name':{'$first':_0x454226(0x1d9)},'category':{'$first':_0x454226(0x1fa)},'brand':{'$first':_0x454226(0x1de)},'unit':{'$first':_0x454226(0x214)},'alertquantity':{'$first':_0x454226(0x222)},'product_code':{'$first':_0x454226(0x247)},'primary_code':{'$first':_0x454226(0x196)},'secondary_code':{'$first':_0x454226(0x1e4)},'maxStocks':{'$first':_0x454226(0x23c)},'maxProdPerUnit':{'$first':_0x454226(0x269)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5b0b9d['length']>0x0)_0x562ec0=_0x5b0b9d;else _0x5d4a23[_0x454226(0x283)]>0x0&&(_0x562ec0=_0x5d4a23);_0x10a6bd[_0x454226(0x24f)](_0x562ec0);}),router[a0_0x1035b3(0x249)](a0_0x1035b3(0x204),async(_0x408c3b,_0x534f5d)=>{var _0x1af8cc=a0_0x1035b3;const {productCode:_0x1f94d2,bay:_0x1d43fc,warehouses:_0x4ad8e3,room:_0x13b3f8}=_0x408c3b[_0x1af8cc(0x1a8)];console[_0x1af8cc(0x1ee)](_0x408c3b[_0x1af8cc(0x1a8)]);try{const _0x5b8a43=await warehouse[_0x1af8cc(0x1d0)]([{'$match':{'name':_0x4ad8e3,'room':_0x13b3f8}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x1d43fc)}},{'$group':{'_id':_0x1af8cc(0x20f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1af8cc(0x278)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x1af8cc(0x1a2)}}}]);_0x534f5d[_0x1af8cc(0x198)](0xc8)[_0x1af8cc(0x24f)](_0x5b8a43);}catch(_0x440b1b){_0x534f5d[_0x1af8cc(0x198)](0x194)['json']({'message':_0x440b1b[_0x1af8cc(0x1a4)]});}}),module[a0_0x1035b3(0x250)]=router;