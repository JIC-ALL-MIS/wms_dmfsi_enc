var a0_0x3f1295=a0_0x3a6a;(function(_0x5d5506,_0x3c462f){var _0x1a46e8=a0_0x3a6a,_0x14a59c=_0x5d5506();while(!![]){try{var _0x45e67c=parseInt(_0x1a46e8(0xf1))/0x1+-parseInt(_0x1a46e8(0xdb))/0x2*(-parseInt(_0x1a46e8(0x13b))/0x3)+-parseInt(_0x1a46e8(0x141))/0x4+-parseInt(_0x1a46e8(0x158))/0x5+-parseInt(_0x1a46e8(0x87))/0x6*(parseInt(_0x1a46e8(0xbe))/0x7)+-parseInt(_0x1a46e8(0x160))/0x8+parseInt(_0x1a46e8(0x170))/0x9;if(_0x45e67c===_0x3c462f)break;else _0x14a59c['push'](_0x14a59c['shift']());}catch(_0x476e0e){_0x14a59c['push'](_0x14a59c['shift']());}}}(a0_0x23eb,0xeec09));const express=require(a0_0x3f1295(0x9a)),app=express(),router=express[a0_0x3f1295(0x130)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require(a0_0x3f1295(0x10a)),auth=require(a0_0x3f1295(0x91)),nodemailer=require(a0_0x3f1295(0x168));var ejs=require(a0_0x3f1295(0x93));function a0_0x3a6a(_0x336ca2,_0x18b1dd){var _0x23eb4c=a0_0x23eb();return a0_0x3a6a=function(_0x3a6a2c,_0x4228ca){_0x3a6a2c=_0x3a6a2c-0x87;var _0x1ed40d=_0x23eb4c[_0x3a6a2c];return _0x1ed40d;},a0_0x3a6a(_0x336ca2,_0x18b1dd);}const path=require(a0_0x3f1295(0x123)),users=require(a0_0x3f1295(0x15c));router[a0_0x3f1295(0xf3)](a0_0x3f1295(0xa8),auth,async(_0x7ea937,_0x1ee774)=>{var _0x5c9379=a0_0x3f1295;try{const {username:_0x2d44f3,email:_0x40ff72,role:_0x2af732}=_0x7ea937[_0x5c9379(0x95)],_0x33456f=_0x7ea937['user'],_0x1dc4f8=await profile[_0x5c9379(0x8a)]({'email':_0x33456f[_0x5c9379(0x12e)]}),_0x52a014=await staff[_0x5c9379(0x8a)]({'email':_0x33456f[_0x5c9379(0x12e)]});if(_0x33456f[_0x5c9379(0xd6)]=='staff'){const _0x2beca1=await staff['findOne']({'email':_0x33456f['email']});}const _0x224ee4=await master_shop[_0x5c9379(0x16b)]();let _0x5c2050;if(_0x33456f[_0x5c9379(0xd6)]=='staff'){const _0x3c577e=await staff[_0x5c9379(0x8a)]({'email':_0x33456f[_0x5c9379(0x12e)]});_0x5c2050=await purchases_finished[_0x5c9379(0xae)]([{'$match':{'warehouse_name':_0x3c577e['warehouse']}},{'$lookup':{'from':_0x5c9379(0xe7),'localField':'suppliers','foreignField':_0x5c9379(0x150),'as':'suppliers_docs'}},{'$unwind':_0x5c9379(0xcc)},{'$unwind':_0x5c9379(0x14f)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5c9379(0xe6)},'suppliers':{'$first':_0x5c9379(0xd9)},'date':{'$first':_0x5c9379(0xde)},'warehouse_name':{'$first':_0x5c9379(0xc9)},'room':{'$first':_0x5c9379(0xa2)},'product':{'$push':_0x5c9379(0x14f)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x5c9379(0xe3)},'due_amount':{'$first':_0x5c9379(0xe9)},'return_data':{'$first':_0x5c9379(0x149)},'batch_code':{'$first':_0x5c9379(0xd2)},'expiry_date':{'$first':_0x5c9379(0x164)},'suppliers_docs':{'$first':_0x5c9379(0xcc)},'total_product_quantity':{'$sum':_0x5c9379(0xd8)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x5c9379(0xe0)},'type':{'$addToSet':_0x5c9379(0xa1)},'floorlevel':{'$addToSet':_0x5c9379(0xbb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5c2050=await purchases_finished[_0x5c9379(0xae)]([{'$unwind':_0x5c9379(0x14f)},{'$group':{'_id':_0x5c9379(0x135),'invoice':{'$first':_0x5c9379(0xe6)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x5c9379(0xde)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x5c9379(0x107)},'product':{'$push':_0x5c9379(0x14f)},'note':{'$first':_0x5c9379(0x176)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x5c9379(0x149)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x5c9379(0xd8)},'level':{'$addToSet':_0x5c9379(0x99)},'isle':{'$addToSet':_0x5c9379(0xe0)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x5c9379(0xbb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x224ee4[0x0][_0x5c9379(0x169)]==_0x5c9379(0xc3))var _0x4593b5=users['English'];else{if(_0x224ee4[0x0]['language']==_0x5c9379(0x129))var _0x4593b5=users[_0x5c9379(0x129)];else{if(_0x224ee4[0x0][_0x5c9379(0x169)]=='German')var _0x4593b5=users[_0x5c9379(0x14e)];else{if(_0x224ee4[0x0]['language']==_0x5c9379(0x9b))var _0x4593b5=users['Spanish'];else{if(_0x224ee4[0x0][_0x5c9379(0x169)]==_0x5c9379(0x112))var _0x4593b5=users['French'];else{if(_0x224ee4[0x0][_0x5c9379(0x169)]==_0x5c9379(0x15e))var _0x4593b5=users['Portuguese'];else{if(_0x224ee4[0x0][_0x5c9379(0x169)]=='Chinese')var _0x4593b5=users[_0x5c9379(0x17e)];else{if(_0x224ee4[0x0]['language']==_0x5c9379(0x17c))var _0x4593b5=users[_0x5c9379(0xc8)];}}}}}}}_0x1ee774[_0x5c9379(0x108)](_0x5c9379(0x119),{'success':_0x7ea937['flash'](_0x5c9379(0xad)),'errors':_0x7ea937[_0x5c9379(0xa7)](_0x5c9379(0xfd)),'purchases':_0x5c2050,'role':_0x33456f,'profile':_0x1dc4f8,'master_shop':_0x224ee4,'language':_0x4593b5});}catch(_0x30b0af){console[_0x5c9379(0x163)]('table\x20page',_0x30b0af),_0x1ee774['status'](0xc8)['json']({'message':_0x30b0af[_0x5c9379(0x15b)]});}});function a0_0x23eb(){var _0xd02f89=['</tbody>','6VHkPVs','purchase_invoice','Finished\x20Goods','max_product_unit','\x20<>\x20','production_date','94892Jjolwx','getMonth','maxStocks','<hr\x20class=\x22my-3\x22>','prod_Qty','floor','FGSEmail','slice','$return_data','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','staff','</div>','FROZEN\x20GOODS','German','$product','name','$product_details.bay','/upload/','getDate','return_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','warehouse','primary_code_hide','906990nxGBJf','product_date','Return\x20Goods','message','../public/language/languages.json','RoomAssign','Portuguese\x20(BR)','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','7110144elDbez','abs','prod_cat','log','$expiry_date','$product_details.product_code','status','<table\x20style=\x22width:\x20100%\x20!important;\x22>','nodemailer','language','</h5>','find','catch','$unit','product_details','/barcode_scanner','23821209fzhJql','</span>','port','redirect','English','add_purchases_finished','$note','</body></html>','error','secondary_unit','$category','$product_code','Arabic\x20(ae)','return_qty','Chinese','quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<html><head><title></title>','$name','save','Enabled','42ZiQjOV','updateOne','/view/:id','findOne','<h5\x20style=\x22text-align:\x20left;\x22>','expiry_date','/preview/:id','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</td>','../middleware/auth','master','ejs','getFullYear','user','<tr>','findById','sendMail','$product.bay','express','Spanish','\x20Order\x20Date\x20:\x20','POnumber','host','$product_details.secondary_code','stocks','$product.type','$room','edit_purchases_finished_view','paid_amount','/invoice/:id','product_cat','flash','/view','<tbody\x20style=\x22text-align:\x20center;\x22>','$maxProdPerUnit','$alertquantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','success','aggregate','purchase\x20data\x20add\x20successfully','Purchase\x20Return\x20Mail','<h2>\x20','<strong>\x20Regards\x20</strong>','$product_details.rack','/barcode/:id','<h5>','\x20Order\x20Number\x20:\x20','<span\x20style=\x22float:\x20right;\x22>','padStart','room','True','$product.floorlevel','$brand','prod_level','1321117lufUrw','json','QA\x20Warehouse','secondary_code_hide','secondary_code','English\x20(US)','$secondary_unit','standard_unit','An\x20error\x20occurred\x20while\x20saving\x20data.','Logo.png','Arabic','$warehouse_name','product_code_hide','<div>','$suppliers_docs','filter','/all_purchases/view','\x20</h2>','/view/add_purchases','all_purchases_barcode','$batch_code','forEach','Email\x20sent\x20successfully','prod_primunit','role','product_name','$product.quantity','$suppliers','$product_details','440528iQOrUn','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$date','</tr>','$product.bin','return_data','user_id','$paid_amount','body','post','$invoice','suppliers','Error\x20Occurs','$due_amount','return_purchase_finished','JO_number','MaxStocks_data','prod_secondunit','Paid\x20For\x20Purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','createTransport','305606vAjyWR','logo','get','edit_purchases_finished','map','currency','$product_details.product_name','Rack\x202','site_title','maxperunit','$primary_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','errors','then','$secondary_code','date','Purchase\x20Return','warehouse_name','primary_code','Enclosed','batch_code','string','$product.room_name','render','$product_details.product_stock','../models/all_models','Portuguese','prod_name','DRY\x20GOODS','$maxStocks','_id','add_purchases\x20error','all','French','Rack\x201','length','password','stock_quantity','purchase\x20data\x20update\x20successfully','concat','all_purchases_finished','</table>','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details._id','prod_code','/all_purchases_finished/view','room_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','amount','path','params','purchase_quantity','product_code','prod_invoice','payment\x20successfull','Hindi','note','product_stock','/give_payment/:id','random','email','Ambient','Router','image','prod_qty','/../public','$product_details.primary_code','$_id','toString','prod_unit','bay','/view/return_purchase/:id'];a0_0x23eb=function(){return _0xd02f89;};return a0_0x23eb();}function BayBinSelected(_0x5eead7,_0xa13767){var _0x5e7231=a0_0x3f1295,_0x4b75cf=[],_0x2516e7=[];if(_0x5eead7==_0x5e7231(0x10d)){switch(_0xa13767){case _0x5e7231(0x113):_0x4b75cf=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x5e7231(0xf8):_0x4b75cf=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2516e7=['DG'];}else{if(_0x5eead7==_0x5e7231(0x14d)){switch(_0xa13767){case _0x5e7231(0x113):_0x4b75cf=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x5e7231(0xf8):_0x4b75cf=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2516e7=['FG'];}}return{'levels':_0x4b75cf,'identify':_0x2516e7};}async function getRandom8DigitNumber(){var _0x8c5bcb=a0_0x3f1295;const _0x35c473=0x989680,_0x141972=0x5f5e0ff,_0x391f94=Math[_0x8c5bcb(0x146)](Math[_0x8c5bcb(0x12d)]()*(_0x141972-_0x35c473+0x1))+_0x35c473;var _0x2c318f;const _0x420a7b=await purchases_finished[_0x8c5bcb(0x8a)]({'invoice':'INCF-'+_0x391f94});return _0x420a7b&&_0x420a7b[_0x8c5bcb(0x114)]>0x0?_0x2c318f='INCF-'+_0x391f94:_0x2c318f='INCF-'+_0x391f94,_0x2c318f;}router[a0_0x3f1295(0xf3)](a0_0x3f1295(0xd0),auth,async(_0x2d5bb7,_0x2044ae)=>{var _0x53e6a3=a0_0x3f1295;try{const {username:_0x1ee0a3,email:_0x5a745a,role:_0x2a0e62}=_0x2d5bb7[_0x53e6a3(0x95)],_0x16eb92=_0x2d5bb7['user'],_0x26b9ba=await profile[_0x53e6a3(0x8a)]({'email':_0x16eb92['email']}),_0x33f73f=await master_shop[_0x53e6a3(0x16b)](),_0x5ac8a9=await staff[_0x53e6a3(0x8a)]({'email':_0x16eb92['email']}),_0x4a04c2=await suppliers[_0x53e6a3(0x16b)]({});let _0x2c578e;if(_0x16eb92[_0x53e6a3(0xd6)]==_0x53e6a3(0x14b)){const _0x50000f=await staff[_0x53e6a3(0x8a)]({'email':_0x16eb92[_0x53e6a3(0x12e)]});_0x2c578e=await warehouse['aggregate']([{'$match':{'status':_0x53e6a3(0x184),'name':_0x50000f[_0x53e6a3(0x156)],'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x53e6a3(0x182)}}}]);}else _0x2c578e=await warehouse[_0x53e6a3(0xae)]([{'$match':{'status':_0x53e6a3(0x184),'warehouse_category':_0x53e6a3(0x13d),'name':{'$ne':_0x53e6a3(0xc0)}}},{'$group':{'_id':_0x53e6a3(0x182),'name':{'$first':'$name'}}}]);const _0x5f531f=await product[_0x53e6a3(0x16b)]({}),_0x3ef463=await warehouse[_0x53e6a3(0x16b)]({'status':'Enabled'}),_0x417f1b=await purchases_finished['find']({}),_0x22ee54=_0x417f1b['length']+0x1,_0xfd916='INCF-'+_0x22ee54[_0x53e6a3(0x136)]()[_0x53e6a3(0xb8)](0x5,'0');var _0x4e6cc7=[_0x53e6a3(0x12f),_0x53e6a3(0x104)];if(_0x33f73f[0x0][_0x53e6a3(0x169)]=='English\x20(US)')var _0xb2ad3f=users[_0x53e6a3(0x174)];else{if(_0x33f73f[0x0][_0x53e6a3(0x169)]=='Hindi')var _0xb2ad3f=users['Hindi'];else{if(_0x33f73f[0x0][_0x53e6a3(0x169)]==_0x53e6a3(0x14e))var _0xb2ad3f=users[_0x53e6a3(0x14e)];else{if(_0x33f73f[0x0][_0x53e6a3(0x169)]==_0x53e6a3(0x9b))var _0xb2ad3f=users[_0x53e6a3(0x9b)];else{if(_0x33f73f[0x0]['language']=='French')var _0xb2ad3f=users[_0x53e6a3(0x112)];else{if(_0x33f73f[0x0][_0x53e6a3(0x169)]==_0x53e6a3(0x15e))var _0xb2ad3f=users['Portuguese'];else{if(_0x33f73f[0x0]['language']==_0x53e6a3(0x17e))var _0xb2ad3f=users[_0x53e6a3(0x17e)];else{if(_0x33f73f[0x0][_0x53e6a3(0x169)]==_0x53e6a3(0x17c))var _0xb2ad3f=users[_0x53e6a3(0xc8)];}}}}}}}const _0x213b7e=getRandom8DigitNumber();_0x213b7e[_0x53e6a3(0xfe)](_0x3ce88f=>{var _0x5c9c0e=_0x53e6a3;_0x2044ae[_0x5c9c0e(0x108)](_0x5c9c0e(0x175),{'success':_0x2d5bb7['flash']('success'),'errors':_0x2d5bb7['flash'](_0x5c9c0e(0xfd)),'role':_0x16eb92,'profile':_0x26b9ba,'suppliers':_0x4a04c2,'warehouse':_0x2c578e,'product':_0x5f531f,'invoice':_0x3ce88f,'master_shop':_0x33f73f,'language':_0xb2ad3f,'find_data':_0x3ef463,'rooms_data':_0x4e6cc7});})[_0x53e6a3(0x16c)](_0xcc5c76=>{var _0xd35c4e=_0x53e6a3;_0x2d5bb7[_0xd35c4e(0xa7)](_0xd35c4e(0xfd),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x2044ae[_0xd35c4e(0x173)]('/all_purchases_finished/view');});}catch(_0x194b74){console[_0x53e6a3(0x163)](_0x194b74);}}),router[a0_0x3f1295(0xf3)]('/view/add_purchases/:id',auth,async(_0x435401,_0x5b7496)=>{var _0x18825b=a0_0x3f1295;try{const _0x328805=_0x435401[_0x18825b(0x124)]['id'];console[_0x18825b(0x163)](_0x328805);const _0x622f01=await master_shop['find']();console[_0x18825b(0x163)](_0x18825b(0x92),_0x622f01);const _0x385128=await product['findOne']({'name':_0x328805});console[_0x18825b(0x163)](_0x18825b(0x11b),_0x385128),_0x5b7496[_0x18825b(0x166)](0xc8)['json']({'product_data':_0x385128,'master':_0x622f01});}catch(_0x505b06){console[_0x18825b(0x163)](_0x18825b(0x110),_0x505b06);}}),router[a0_0x3f1295(0xe5)](a0_0x3f1295(0xd0),auth,async(_0x2d70b2,_0x4975c2)=>{var _0x51beb5=a0_0x3f1295;try{const {invoice:_0x271ede,date:_0x3dcf0d,warehouse_name:_0x8dec37,prod_name:_0x212495,prod_code:_0x41f0e0,prod_qty:_0x5d80b3,prod_unit:_0x3f044d,prod_secondunit:_0xf739b8,prod_level:_0x33aa60,prod_isle:_0x2869c0,prod_pallet:_0x572b88,note:_0x39bdc6,expiry_date:_0x45c428,batch_code:_0x5f278d,payable:_0xefafa3,due_amount:_0x5adacb,Room_name:_0x4bcf9d,primary_code:_0x78dcb1,secondary_code:_0x28975b,MaxStocks_data:_0x3ebb5d,PO_number:_0x38e550,SCRN:_0x2e06a3,JO_number:_0x16c55c}=_0x2d70b2[_0x51beb5(0xe4)];if(typeof _0x212495==_0x51beb5(0x106))var _0x37774f=[_0x2d70b2[_0x51beb5(0xe4)]['prod_name']],_0x1acdda=[_0x2d70b2[_0x51beb5(0xe4)]['prod_code']],_0xc86e41=[_0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x145)]],_0x45d4d8=[_0x2d70b2['body'][_0x51beb5(0xd5)]],_0x5eab20=[_0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0xed)]],_0x584081=[_0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0xbd)]],_0x55ccb8=[_0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x103)]],_0x4b66dd=[_0x2d70b2['body'][_0x51beb5(0xc2)]],_0x4b51a6=[_0x2d70b2['body'][_0x51beb5(0xec)]],_0x5ba84d=[_0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x105)]],_0xd050f0=[_0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x8c)]],_0xdd5089=[_0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x159)]],_0x1e28aa=[_0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x13e)]],_0x3dcd7c=[_0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x162)]],_0x3e501e=[_0x2d70b2[_0x51beb5(0xe4)]['RoomAssign']],_0x50005c=[_0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x127)]];else var _0x37774f=[..._0x2d70b2[_0x51beb5(0xe4)]['prod_name']],_0x1acdda=[..._0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x11e)]],_0xc86e41=[..._0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x145)]],_0x45d4d8=[..._0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0xd5)]],_0x5eab20=[..._0x2d70b2[_0x51beb5(0xe4)]['prod_secondunit']],_0x584081=[..._0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0xbd)]],_0x55ccb8=[..._0x2d70b2['body']['primary_code']],_0x4b66dd=[..._0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0xc2)]],_0x4b51a6=[..._0x2d70b2[_0x51beb5(0xe4)]['MaxStocks_data']],_0x5ba84d=[..._0x2d70b2['body'][_0x51beb5(0x105)]],_0xd050f0=[..._0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x8c)]],_0xdd5089=[..._0x2d70b2['body'][_0x51beb5(0x159)]],_0x1e28aa=[..._0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x13e)]],_0x3dcd7c=[..._0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x162)]],_0x3e501e=[..._0x2d70b2['body'][_0x51beb5(0x15d)]],_0x50005c=[..._0x2d70b2[_0x51beb5(0xe4)][_0x51beb5(0x127)]];const _0x573452=_0x37774f['map'](_0x448a7d=>{return _0x448a7d={'product_name':_0x448a7d};});_0x1acdda[_0x51beb5(0xd3)]((_0x9ecec1,_0x385a7a)=>{var _0x23d45f=_0x51beb5;_0x573452[_0x385a7a][_0x23d45f(0x126)]=_0x9ecec1;}),_0xc86e41[_0x51beb5(0xd3)]((_0x146de5,_0x32a987)=>{_0x573452[_0x32a987]['quantity']=Math['abs'](_0x146de5);}),_0x45d4d8[_0x51beb5(0xd3)]((_0x4cf2e3,_0x159a8b)=>{var _0x4384ca=_0x51beb5;_0x573452[_0x159a8b][_0x4384ca(0xc5)]=_0x4cf2e3;}),_0x5eab20[_0x51beb5(0xd3)]((_0x2bbba2,_0xb32343)=>{var _0xa2b14=_0x51beb5;_0x573452[_0xb32343][_0xa2b14(0x179)]=_0x2bbba2;}),_0x584081['forEach']((_0x1de528,_0x419e6a)=>{var _0x5cda57=_0x51beb5;_0x573452[_0x419e6a][_0x5cda57(0x138)]=_0x1de528;}),_0x55ccb8[_0x51beb5(0xd3)]((_0x29c309,_0x2f0648)=>{var _0x411de5=_0x51beb5;_0x573452[_0x2f0648][_0x411de5(0x103)]=_0x29c309;}),_0x4b66dd['forEach']((_0x3c79a6,_0x720902)=>{var _0x2bc238=_0x51beb5;_0x573452[_0x720902][_0x2bc238(0xc2)]=_0x3c79a6;}),_0x4b51a6[_0x51beb5(0xd3)]((_0x2ee9d0,_0x4f3d08)=>{_0x573452[_0x4f3d08]['maxStocks']=_0x2ee9d0;}),_0x5ba84d['forEach']((_0x2b3492,_0x121511)=>{var _0x845563=_0x51beb5;_0x573452[_0x121511][_0x845563(0x105)]=_0x2b3492;}),_0xd050f0[_0x51beb5(0xd3)]((_0x1d80fb,_0x2828e2)=>{var _0x505081=_0x51beb5;_0x573452[_0x2828e2][_0x505081(0x8c)]=_0x1d80fb;}),_0xdd5089[_0x51beb5(0xd3)]((_0x57889a,_0x4e23a3)=>{var _0x20b9ae=_0x51beb5;_0x573452[_0x4e23a3][_0x20b9ae(0x140)]=_0x57889a;}),_0x1e28aa[_0x51beb5(0xd3)]((_0x53381d,_0x1fd9b3)=>{_0x573452[_0x1fd9b3]['maxperunit']=_0x53381d;}),_0x3dcd7c['forEach']((_0x2bbfd6,_0x3056bd)=>{var _0x5797bf=_0x51beb5;_0x573452[_0x3056bd][_0x5797bf(0xa6)]=_0x2bbfd6;}),_0x3e501e[_0x51beb5(0xd3)]((_0x1ff40e,_0x23ccbd)=>{var _0xc74e20=_0x51beb5;_0x573452[_0x23ccbd][_0xc74e20(0x120)]=_0x1ff40e;}),_0x50005c[_0x51beb5(0xd3)]((_0x16721a,_0x2337fd)=>{var _0xa3694a=_0x51beb5;_0x573452[_0x2337fd][_0xa3694a(0x8e)]=_0x16721a;});const _0x17bbf2=_0x573452[_0x51beb5(0xcd)](_0x27920c=>_0x27920c[_0x51beb5(0x17f)]!=='0'&&_0x27920c[_0x51beb5(0x17f)]!==''),_0x1a1e30=new purchases_finished({'invoice':_0x271ede,'suppliers':_0x2d70b2['body'][_0x51beb5(0xe7)],'date':_0x3dcf0d,'warehouse_name':_0x8dec37,'product':_0x17bbf2,'note':_0x39bdc6,'due_amount':_0x5adacb,'room':_0x4bcf9d,'POnumber':_0x38e550,'SCRN':_0x2e06a3,'JO_number':_0x16c55c}),_0x3befb8=await _0x1a1e30[_0x51beb5(0x183)](),_0x211577=await purchases_finished['findOne']({'invoice':_0x271ede}),_0x1a8199=_0x211577['product'][_0x51beb5(0xf5)](async _0x954726=>{var _0x40d799=_0x51beb5;try{var _0x138a4d=await warehouse[_0x40d799(0x8a)]({'name':_0x8dec37,'room':_0x954726['room_name']}),_0x1223f5=0x0;const _0x42b918=_0x138a4d['product_details'][_0x40d799(0xf5)](_0xfae398=>{var _0x3f9c21=_0x40d799;console['log'](_0xfae398[_0x3f9c21(0xd7)]+'=='+_0x954726['product_name']+'&&'+_0xfae398['bay']+'=='+_0x954726[_0x3f9c21(0x138)]+'&&'+_0xfae398['expiry_date']+'=='+_0x954726['expiry_date']+'&&'+_0xfae398[_0x3f9c21(0x140)]+'=='+_0x954726[_0x3f9c21(0x140)]+'&&'+_0xfae398[_0x3f9c21(0x105)]+'=='+_0x954726[_0x3f9c21(0x105)]+'&&'+_0xfae398[_0x3f9c21(0x8e)]+'=='+_0x211577['invoice']),_0xfae398[_0x3f9c21(0xd7)]==_0x954726[_0x3f9c21(0xd7)]&&_0xfae398[_0x3f9c21(0x138)]==_0x954726[_0x3f9c21(0x138)]&&_0xfae398['expiry_date']==_0x954726[_0x3f9c21(0x8c)]&&_0xfae398[_0x3f9c21(0x140)]==_0x954726[_0x3f9c21(0x140)]&&_0xfae398[_0x3f9c21(0x105)]==_0x954726[_0x3f9c21(0x105)]&&_0xfae398[_0x3f9c21(0x8e)]==_0x211577[_0x3f9c21(0x8e)]&&(_0xfae398[_0x3f9c21(0x12b)]=Math['abs'](_0xfae398[_0x3f9c21(0x12b)])+Math[_0x3f9c21(0x161)](_0x954726['quantity']),_0x1223f5++);});return _0x1223f5==0x0&&(_0x138a4d['product_details']=_0x138a4d[_0x40d799(0x16e)][_0x40d799(0x118)]({'product_name':_0x954726[_0x40d799(0xd7)],'product_stock':Math['abs'](_0x954726['quantity']),'primary_code':_0x954726['primary_code'],'secondary_code':_0x954726[_0x40d799(0xc2)],'product_code':_0x954726[_0x40d799(0x126)],'bay':_0x954726[_0x40d799(0x138)],'maxProducts':_0x954726[_0x40d799(0x143)],'unit':_0x954726[_0x40d799(0xc5)],'secondary_unit':_0x954726[_0x40d799(0x179)],'expiry_date':_0x954726[_0x40d799(0x8c)],'production_date':_0x954726[_0x40d799(0x140)],'maxProducts':_0x954726[_0x40d799(0x143)],'maxPerUnit':_0x954726[_0x40d799(0xfa)],'batch_code':_0x954726[_0x40d799(0x105)],'product_cat':_0x954726['product_cat'],'invoice':_0x954726[_0x40d799(0x8e)],'id_incoming':_0x954726[_0x40d799(0x10f)]})),_0x138a4d;}catch(_0x46a9f1){return console[_0x40d799(0x178)]('Error\x20occurred\x20while\x20processing\x20product:',_0x46a9f1),null;}});Promise[_0x51beb5(0x111)](_0x1a8199)['then'](async _0x5e9177=>{var _0x421d6d=_0x51beb5;try{for(const _0x5b644c of _0x5e9177){await warehouse[_0x421d6d(0x88)]({'_id':_0x5b644c[_0x421d6d(0x10f)]},{'$addToSet':{'product_details':{'$each':_0x5b644c[_0x421d6d(0x16e)]}}});}const _0x3f2d28=await master_shop[_0x421d6d(0x16b)](),_0x16b491=await email_settings[_0x421d6d(0x8a)](),_0x1d517b=await supervisor_settings[_0x421d6d(0x16b)]();var _0x3f69e9=_0x211577[_0x421d6d(0x11b)],_0x5a2160='',_0x593184;for(_0x593184 in _0x3f69e9){var _0x503f7a='FG';_0x211577[_0x421d6d(0x102)]==_0x421d6d(0x10d)&&(_0x503f7a='DG'),_0x5a2160+='<tr>'+_0x421d6d(0x121)+_0x3f69e9[_0x593184][_0x421d6d(0xd7)]+_0x421d6d(0x90)+_0x421d6d(0x121)+_0x3f69e9[_0x593184][_0x421d6d(0x126)]+_0x421d6d(0x90)+_0x421d6d(0x121)+_0x3f69e9[_0x593184]['quantity']+_0x421d6d(0x90)+_0x421d6d(0x121)+_0x3f69e9[_0x593184]['standard_unit']+_0x421d6d(0x90)+_0x421d6d(0x121)+_0x3f69e9[_0x593184][_0x421d6d(0x179)]+_0x421d6d(0x90)+_0x421d6d(0x121)+_0x211577[_0x421d6d(0x102)]+'</td>'+_0x421d6d(0x121)+_0x3f69e9[_0x593184][_0x421d6d(0x120)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x503f7a+_0x3f69e9[_0x593184][_0x421d6d(0x138)]+_0x421d6d(0x90),_0x421d6d(0xdf);}let _0x133693=nodemailer[_0x421d6d(0xf0)]({'host':_0x16b491[_0x421d6d(0x9e)],'port':Number(_0x16b491[_0x421d6d(0x172)]),'secure':![],'auth':{'user':_0x16b491[_0x421d6d(0x12e)],'pass':_0x16b491[_0x421d6d(0x115)]}}),_0x32a1dc={'from':_0x16b491[_0x421d6d(0x12e)],'to':_0x1d517b[0x0][_0x421d6d(0x147)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x421d6d(0xc7),'path':__dirname+_0x421d6d(0x133)+_0x421d6d(0x152)+_0x3f2d28[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x421d6d(0x181)+_0x421d6d(0xdc)+_0x421d6d(0xcb)+_0x421d6d(0x14a)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x421d6d(0x14c)+_0x421d6d(0xcb)+_0x421d6d(0xb1)+_0x3f2d28[0x0][_0x421d6d(0xf9)]+'\x20</h2>'+_0x421d6d(0x14c)+_0x421d6d(0x14c)+_0x421d6d(0x144)+'<div>'+_0x421d6d(0x8b)+_0x421d6d(0xb6)+_0x211577[_0x421d6d(0x8e)]+'\x20'+_0x421d6d(0xb7)+_0x421d6d(0x9c)+_0x211577[_0x421d6d(0x100)]+'\x20'+'</span>'+_0x421d6d(0x16a)+_0x421d6d(0x14c)+_0x421d6d(0x167)+_0x421d6d(0xfc)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x421d6d(0x8f)+_0x421d6d(0x180)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x421d6d(0x11c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x421d6d(0x155)+_0x421d6d(0xdf)+'</thead>'+_0x421d6d(0xa9)+'\x20'+_0x5a2160+'\x20'+_0x421d6d(0x13a)+_0x421d6d(0x11a)+_0x421d6d(0xcb)+_0x421d6d(0xb2)+_0x421d6d(0xb5)+_0x3f2d28[0x0][_0x421d6d(0xf9)]+_0x421d6d(0x16a)+_0x421d6d(0x14c)+'</div>'+_0x421d6d(0x177)};_0x133693[_0x421d6d(0x98)](_0x32a1dc,function(_0x5f1cbd,_0x4ef870){var _0x1df0fa=_0x421d6d;_0x5f1cbd?(console[_0x1df0fa(0x163)](_0x5f1cbd),console['log'](_0x1df0fa(0xe8))):console[_0x1df0fa(0x163)](_0x1df0fa(0xd4));});}catch(_0x298325){console[_0x421d6d(0x178)](_0x298325),_0x4975c2['status'](0x1f4)['json']({'error':_0x421d6d(0xc6),'message':_0x298325[_0x421d6d(0x15b)]});}})[_0x51beb5(0x16c)](_0x42babc=>{var _0x4bb634=_0x51beb5;console[_0x4bb634(0x178)](_0x42babc);}),_0x2d70b2[_0x51beb5(0xa7)](_0x51beb5(0xad),_0x51beb5(0xaf)),_0x4975c2[_0x51beb5(0x173)]('/all_purchases_finished/view');}catch(_0x527046){console[_0x51beb5(0x163)](_0x527046);}}),router['get'](a0_0x3f1295(0x8d),auth,async(_0x5f47e7,_0x31efb9)=>{var _0x59aa7a=a0_0x3f1295;try{const {username:_0x56fd64,email:_0x440710,role:_0x6dcb09}=_0x5f47e7[_0x59aa7a(0x95)],_0x4d8c52=_0x5f47e7['user'],_0x471f7f=await profile[_0x59aa7a(0x8a)]({'email':_0x4d8c52[_0x59aa7a(0x12e)]}),_0x38a715=await master_shop[_0x59aa7a(0x16b)](),_0x5ec237=_0x5f47e7[_0x59aa7a(0x124)]['id'],_0x1306fc=await purchases_finished[_0x59aa7a(0x97)](_0x5ec237),_0xd70966=await suppliers[_0x59aa7a(0x16b)]({});let _0x3ce72c;if(_0x4d8c52[_0x59aa7a(0xd6)]==_0x59aa7a(0x14b)){const _0x4ad9b3=await staff['findOne']({'email':_0x4d8c52['email']});_0x3ce72c=await warehouse[_0x59aa7a(0x16b)]({'status':_0x59aa7a(0x184),'name':_0x4ad9b3[_0x59aa7a(0x156)],'warehouse_category':'Finished\x20Goods'});}else _0x3ce72c=await warehouse[_0x59aa7a(0xae)]([{'$match':{'status':_0x59aa7a(0x184),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x59aa7a(0x182),'name':{'$first':_0x59aa7a(0x182)}}}]);const _0x9ff686=await product[_0x59aa7a(0x16b)]({}),_0x327e2f=BayBinSelected(_0x1306fc[_0x59aa7a(0x102)],_0x1306fc[_0x59aa7a(0xb9)]);let _0x30e9bd=new Date(_0x1306fc['expiry_date']),_0x4689aa=('0'+_0x30e9bd[_0x59aa7a(0x153)]())['slice'](-0x2),_0x3294ee=('0'+(_0x30e9bd[_0x59aa7a(0x142)]()+0x1))[_0x59aa7a(0x148)](-0x2),_0x388921=_0x30e9bd['getFullYear'](),_0x29adb4=_0x388921+'-'+_0x3294ee+'-'+_0x4689aa;if(_0x38a715[0x0][_0x59aa7a(0x169)]==_0x59aa7a(0xc3)){var _0x55ef41=users[_0x59aa7a(0x174)];console[_0x59aa7a(0x163)](_0x55ef41);}else{if(_0x38a715[0x0]['language']=='Hindi')var _0x55ef41=users[_0x59aa7a(0x129)];else{if(_0x38a715[0x0][_0x59aa7a(0x169)]==_0x59aa7a(0x14e))var _0x55ef41=users['German'];else{if(_0x38a715[0x0][_0x59aa7a(0x169)]=='Spanish')var _0x55ef41=users[_0x59aa7a(0x9b)];else{if(_0x38a715[0x0][_0x59aa7a(0x169)]==_0x59aa7a(0x112))var _0x55ef41=users[_0x59aa7a(0x112)];else{if(_0x38a715[0x0][_0x59aa7a(0x169)]==_0x59aa7a(0x15e))var _0x55ef41=users[_0x59aa7a(0x10b)];else{if(_0x38a715[0x0]['language']==_0x59aa7a(0x17e))var _0x55ef41=users[_0x59aa7a(0x17e)];else{if(_0x38a715[0x0][_0x59aa7a(0x169)]==_0x59aa7a(0x17c))var _0x55ef41=users[_0x59aa7a(0xc8)];}}}}}}}_0x31efb9[_0x59aa7a(0x108)](_0x59aa7a(0xa3),{'success':_0x5f47e7[_0x59aa7a(0xa7)](_0x59aa7a(0xad)),'errors':_0x5f47e7[_0x59aa7a(0xa7)](_0x59aa7a(0xfd)),'role':_0x4d8c52,'profile':_0x471f7f,'purchases':_0x1306fc,'suppliers':_0xd70966,'warehouse':_0x3ce72c,'product':_0x9ff686,'master_shop':_0x38a715,'language':_0x55ef41,'ed_fullDate':_0x29adb4,'dataSelected':_0x327e2f});}catch(_0x4567b5){console['log'](_0x4567b5);}}),router[a0_0x3f1295(0xf3)]('/view/:id',auth,async(_0x4259e5,_0x434b4a)=>{var _0x384f4b=a0_0x3f1295;try{const {username:_0x563261,email:_0x56a1d1,role:_0x324113}=_0x4259e5['user'],_0xe91e36=_0x4259e5[_0x384f4b(0x95)],_0x402337=await profile[_0x384f4b(0x8a)]({'email':_0xe91e36[_0x384f4b(0x12e)]}),_0xb0b50=await master_shop['find'](),_0x2e23c5=_0x4259e5[_0x384f4b(0x124)]['id'],_0x191456=await purchases_finished[_0x384f4b(0x97)](_0x2e23c5),_0x3d2bdb=await suppliers[_0x384f4b(0x16b)]({});let _0x2cbb0f;if(_0xe91e36[_0x384f4b(0xd6)]=='staff'){const _0x2b66af=await staff['findOne']({'email':_0xe91e36[_0x384f4b(0x12e)]});_0x2cbb0f=await warehouse[_0x384f4b(0x16b)]({'status':'Enabled','name':_0x2b66af[_0x384f4b(0x156)],'warehouse_category':_0x384f4b(0x13d)});}else _0x2cbb0f=await warehouse[_0x384f4b(0xae)]([{'$match':{'status':_0x384f4b(0x184),'warehouse_category':_0x384f4b(0x13d)}},{'$group':{'_id':_0x384f4b(0x182),'name':{'$first':_0x384f4b(0x182)}}}]);const _0x49e678=await product[_0x384f4b(0x16b)]({}),_0x2f47e1=BayBinSelected(_0x191456[_0x384f4b(0x102)],_0x191456[_0x384f4b(0xb9)]);let _0x54bb70=new Date(_0x191456[_0x384f4b(0x8c)]),_0x45b173=('0'+_0x54bb70[_0x384f4b(0x153)]())['slice'](-0x2),_0x1b75e6=('0'+(_0x54bb70[_0x384f4b(0x142)]()+0x1))[_0x384f4b(0x148)](-0x2),_0x4d0eef=_0x54bb70[_0x384f4b(0x94)](),_0x10a545=_0x4d0eef+'-'+_0x1b75e6+'-'+_0x45b173;if(_0xb0b50[0x0][_0x384f4b(0x169)]=='English\x20(US)'){var _0x4dcea1=users[_0x384f4b(0x174)];console[_0x384f4b(0x163)](_0x4dcea1);}else{if(_0xb0b50[0x0][_0x384f4b(0x169)]==_0x384f4b(0x129))var _0x4dcea1=users['Hindi'];else{if(_0xb0b50[0x0]['language']=='German')var _0x4dcea1=users[_0x384f4b(0x14e)];else{if(_0xb0b50[0x0]['language']==_0x384f4b(0x9b))var _0x4dcea1=users[_0x384f4b(0x9b)];else{if(_0xb0b50[0x0][_0x384f4b(0x169)]=='French')var _0x4dcea1=users[_0x384f4b(0x112)];else{if(_0xb0b50[0x0][_0x384f4b(0x169)]==_0x384f4b(0x15e))var _0x4dcea1=users[_0x384f4b(0x10b)];else{if(_0xb0b50[0x0][_0x384f4b(0x169)]=='Chinese')var _0x4dcea1=users[_0x384f4b(0x17e)];else{if(_0xb0b50[0x0][_0x384f4b(0x169)]=='Arabic\x20(ae)')var _0x4dcea1=users[_0x384f4b(0xc8)];}}}}}}}_0x434b4a[_0x384f4b(0x108)](_0x384f4b(0xf4),{'success':_0x4259e5['flash']('success'),'errors':_0x4259e5[_0x384f4b(0xa7)](_0x384f4b(0xfd)),'role':_0xe91e36,'profile':_0x402337,'purchases':_0x191456,'suppliers':_0x3d2bdb,'warehouse':_0x2cbb0f,'product':_0x49e678,'master_shop':_0xb0b50,'language':_0x4dcea1,'ed_fullDate':_0x10a545,'dataSelected':_0x2f47e1});}catch(_0xfd7e28){console[_0x384f4b(0x163)](_0xfd7e28);}}),router[a0_0x3f1295(0xe5)](a0_0x3f1295(0x89),auth,async(_0x6c1430,_0x426fcc)=>{var _0x255acd=a0_0x3f1295;try{const _0x2df01e=_0x6c1430[_0x255acd(0x124)]['id'],_0x35a83b=await purchases_finished[_0x255acd(0x8a)]({'_id':_0x6c1430[_0x255acd(0x124)]['id']}),_0x3f41e6=await warehouse['findOne']({'name':_0x35a83b[_0x255acd(0x102)],'room':_0x35a83b['room']});_0x35a83b[_0x255acd(0x11b)][_0x255acd(0xd3)](_0xbca7f5=>{var _0x296848=_0x255acd;const _0x2503a4=_0x3f41e6[_0x296848(0x16e)]['map'](_0x456f3e=>{var _0x36e954=_0x296848;_0x456f3e[_0x36e954(0xd7)]==_0xbca7f5['product_name']&&_0x456f3e[_0x36e954(0x138)]==_0xbca7f5[_0x36e954(0x138)]&&(_0x456f3e[_0x36e954(0x12b)]=parseInt(_0x456f3e[_0x36e954(0x12b)])-parseInt(_0xbca7f5[_0x36e954(0x17f)]));});}),await _0x3f41e6['save']();const {invoice:_0x1b1508,suppliers:_0x153e00,date:_0x27caba,warehouse_name:_0x32d27e,prod_name:_0x2ec24b,prod_code:_0xaa79fa,prod_qty:_0x1fe18f,prod_unit:_0x85187e,prod_secondunit:_0x52da4a,prod_level:_0x2cdb54,prod_isle:_0x3bc313,prod_pallet:_0x3286c0,note:_0x11c85e,expiry_date:_0x472cab,batch_code:_0x4a25b9,paid_amount:_0x15b6a1,due_amount:_0x276d3f,Room_name:_0x4aac1e,primary_code:_0x33683b,secondary_code:_0x13e0ea,PO_number:_0xd09795,JO_number:_0x4773dd}=_0x6c1430['body'];if(typeof _0x2ec24b=='string')var _0x2bef9c=[_0x6c1430[_0x255acd(0xe4)][_0x255acd(0x10c)]],_0x538695=[_0x6c1430[_0x255acd(0xe4)][_0x255acd(0x11e)]],_0x272143=[_0x6c1430[_0x255acd(0xe4)][_0x255acd(0x132)]],_0x51f6c2=[_0x6c1430[_0x255acd(0xe4)][_0x255acd(0x137)]],_0x3a294b=[_0x6c1430['body'][_0x255acd(0xed)]],_0x373c3d=[_0x6c1430[_0x255acd(0xe4)][_0x255acd(0xbd)]],_0x12454a=[_0x6c1430[_0x255acd(0xe4)][_0x255acd(0x103)]],_0x45a295=[_0x6c1430['body'][_0x255acd(0xc2)]],_0x5e913d=[_0x6c1430['body'][_0x255acd(0xec)]],_0x38b4e4=[_0x6c1430[_0x255acd(0xe4)][_0x255acd(0x105)]],_0x5182d3=[_0x6c1430['body'][_0x255acd(0x8c)]];else var _0x2bef9c=[..._0x6c1430[_0x255acd(0xe4)][_0x255acd(0x10c)]],_0x538695=[..._0x6c1430['body'][_0x255acd(0x11e)]],_0x272143=[..._0x6c1430[_0x255acd(0xe4)][_0x255acd(0x132)]],_0x51f6c2=[..._0x6c1430[_0x255acd(0xe4)]['prod_unit']],_0x3a294b=[..._0x6c1430[_0x255acd(0xe4)][_0x255acd(0xed)]],_0x373c3d=[..._0x6c1430[_0x255acd(0xe4)][_0x255acd(0xbd)]],_0x12454a=[..._0x6c1430[_0x255acd(0xe4)]['primary_code']],_0x45a295=[..._0x6c1430[_0x255acd(0xe4)][_0x255acd(0xc2)]],_0x5e913d=[..._0x6c1430[_0x255acd(0xe4)]['MaxStocks_data']],_0x38b4e4=[..._0x6c1430[_0x255acd(0xe4)][_0x255acd(0x105)]],_0x5182d3=[..._0x6c1430['body'][_0x255acd(0x8c)]];const _0x4215e7=_0x2bef9c[_0x255acd(0xf5)](_0x1d23c3=>{return _0x1d23c3={'product_name':_0x1d23c3};});_0x538695[_0x255acd(0xd3)]((_0x2c3470,_0x44bdf6)=>{var _0x4c2e23=_0x255acd;_0x4215e7[_0x44bdf6][_0x4c2e23(0x126)]=_0x2c3470;}),_0x272143[_0x255acd(0xd3)]((_0x4ddbd4,_0x10458a)=>{var _0x252f3c=_0x255acd;_0x4215e7[_0x10458a][_0x252f3c(0x17f)]=_0x4ddbd4;}),_0x51f6c2[_0x255acd(0xd3)]((_0xcef4e8,_0xdaeea5)=>{var _0x518662=_0x255acd;_0x4215e7[_0xdaeea5][_0x518662(0xc5)]=_0xcef4e8;}),_0x3a294b[_0x255acd(0xd3)]((_0x514968,_0x21c2c1)=>{var _0x20f9a3=_0x255acd;_0x4215e7[_0x21c2c1][_0x20f9a3(0x179)]=_0x514968;}),_0x373c3d['forEach']((_0x3cf02c,_0x57a845)=>{var _0x38dfd7=_0x255acd;_0x4215e7[_0x57a845][_0x38dfd7(0x138)]=_0x3cf02c;}),_0x12454a['forEach']((_0x2a0072,_0x839e0)=>{var _0x3cea35=_0x255acd;_0x4215e7[_0x839e0][_0x3cea35(0x103)]=_0x2a0072;}),_0x45a295[_0x255acd(0xd3)]((_0x3942d1,_0x35f47b)=>{var _0x12a13a=_0x255acd;_0x4215e7[_0x35f47b][_0x12a13a(0xc2)]=_0x3942d1;}),_0x5e913d[_0x255acd(0xd3)]((_0x332ec0,_0x173801)=>{_0x4215e7[_0x173801]['maxStocks']=_0x332ec0;}),_0x38b4e4[_0x255acd(0xd3)]((_0x47f46d,_0x50488c)=>{var _0x5cffc6=_0x255acd;_0x4215e7[_0x50488c][_0x5cffc6(0x105)]=_0x47f46d;}),_0x5182d3[_0x255acd(0xd3)]((_0x174ac3,_0x2b79c1)=>{var _0x139cc0=_0x255acd;_0x4215e7[_0x2b79c1][_0x139cc0(0x8c)]=_0x174ac3;});const _0x156816=_0x4215e7[_0x255acd(0xcd)](_0x23f91f=>_0x23f91f[_0x255acd(0x17f)]!=='0'&&_0x23f91f[_0x255acd(0x17f)]!=='');_0x35a83b[_0x255acd(0x8e)]=_0x1b1508,_0x35a83b[_0x255acd(0xe7)]=_0x153e00,_0x35a83b[_0x255acd(0x100)]=_0x27caba,_0x35a83b[_0x255acd(0x102)]=_0x32d27e,_0x35a83b[_0x255acd(0x11b)]=_0x156816,_0x35a83b[_0x255acd(0x12a)]=_0x11c85e,_0x35a83b['paid_amount']=_0x15b6a1,_0x35a83b['due_amount']=_0x276d3f,_0x35a83b[_0x255acd(0xb9)]=_0x4aac1e,_0x35a83b[_0x255acd(0x9d)]=_0xd09795,_0x35a83b[_0x255acd(0xeb)]=_0x4773dd;const _0x482a7f=await _0x35a83b['save'](),_0x30aaae=await warehouse['findOne']({'name':_0x6c1430[_0x255acd(0xe4)][_0x255acd(0x102)],'room':_0x6c1430[_0x255acd(0xe4)]['Room_name']});_0x35a83b[_0x255acd(0x11b)]['forEach'](_0x334af7=>{var _0x381a3c=_0x255acd,_0x3b8410=0x0;const _0x18210e=_0x30aaae[_0x381a3c(0x16e)]['map'](_0x244450=>{var _0x1fd08b=_0x381a3c;_0x244450[_0x1fd08b(0xd7)]==_0x334af7[_0x1fd08b(0xd7)]&&_0x244450[_0x1fd08b(0x138)]==_0x334af7['bay']&&(_0x244450[_0x1fd08b(0x12b)]=parseInt(_0x244450[_0x1fd08b(0x12b)])+parseInt(_0x334af7[_0x1fd08b(0x17f)]),_0x3b8410++);});_0x3b8410=='0'&&(_0x30aaae['product_details']=_0x30aaae['product_details'][_0x381a3c(0x118)]({'product_name':_0x334af7[_0x381a3c(0xd7)],'product_stock':_0x334af7[_0x381a3c(0x17f)],'primary_code':_0x334af7['primary_code'],'secondary_code':_0x334af7['secondary_code'],'product_code':_0x334af7['product_code'],'bay':_0x334af7[_0x381a3c(0x138)],'maxProducts':_0x334af7['maxStocks'],'unit':_0x334af7[_0x381a3c(0xc5)],'secondary_unit':_0x334af7[_0x381a3c(0x179)],'expiry_date':_0x334af7[_0x381a3c(0x8c)]}));}),await _0x30aaae[_0x255acd(0x183)]();const _0x46077b=await s_payment_data['findOne']({'invoice':_0x6c1430['body']['invoice']});if(_0x46077b===null){}else console[_0x255acd(0x163)]('suppliers',_0x46077b,_0x6c1430[_0x255acd(0xe4)]['invoice']),_0x46077b[_0x255acd(0xe7)]=_0x6c1430[_0x255acd(0xe4)][_0x255acd(0xe7)],await _0x46077b['save']();_0x6c1430['flash'](_0x255acd(0xad),_0x255acd(0x117)),_0x426fcc['redirect'](_0x255acd(0x11f));}catch(_0x429bc9){console[_0x255acd(0x163)](_0x429bc9);}}),router[a0_0x3f1295(0xe5)](a0_0x3f1295(0x12c),auth,async(_0x15da88,_0x340e2b)=>{var _0x14a28b=a0_0x3f1295;try{const _0xc29f05=_0x15da88['params']['id'],{invoice:_0x215014,suppliers:_0x146683,payable:_0x5b0355,due_amount:_0xe1dedd}=_0x15da88[_0x14a28b(0xe4)],_0x13c834=await purchases[_0x14a28b(0x97)](_0xc29f05);var _0x1865b9=_0x5b0355-_0xe1dedd;_0x13c834['paid_amount']=parseFloat(_0x13c834[_0x14a28b(0xa4)])+parseFloat(_0xe1dedd),_0x13c834['due_amount']=_0x1865b9;const _0x27d629=await _0x13c834[_0x14a28b(0x183)]();console[_0x14a28b(0x163)](_0x27d629);const _0x1f4734=await s_payment_data[_0x14a28b(0x8a)]({'invoice':_0x215014});_0x1f4734[_0x14a28b(0x122)]=_0x1865b9,await _0x1f4734[_0x14a28b(0x183)]();let _0x28c1c8=new Date(),_0x4b83a1=('0'+_0x28c1c8[_0x14a28b(0x153)]())[_0x14a28b(0x148)](-0x2),_0x450bab=('0'+(_0x28c1c8[_0x14a28b(0x142)]()+0x1))[_0x14a28b(0x148)](-0x2),_0xd36f9a=_0x28c1c8[_0x14a28b(0x94)](),_0x55a584=_0xd36f9a+'-'+_0x450bab+'-'+_0x4b83a1;const _0x2ee082=new suppliers_payment({'invoice':_0x215014,'date':_0xd36f9a+'-'+_0x450bab+'-'+_0x4b83a1,'suppliers':_0x146683,'reason':_0x14a28b(0xee),'amount':_0xe1dedd}),_0x51f757=await _0x2ee082[_0x14a28b(0x183)]();_0x15da88[_0x14a28b(0xa7)]('success',_0x14a28b(0x128)),_0x340e2b[_0x14a28b(0x173)](_0x14a28b(0xce));}catch(_0x54a6e6){console[_0x14a28b(0x163)](_0x54a6e6);}}),router[a0_0x3f1295(0xf3)](a0_0x3f1295(0xa5),auth,async(_0x4918cd,_0x3e7321)=>{var _0x40ea39=a0_0x3f1295;try{const {username:_0x5275cd,email:_0x2de7ce,role:_0x1b8e03}=_0x4918cd['user'],_0x49e231=_0x4918cd[_0x40ea39(0x95)],_0x1546a1=await profile[_0x40ea39(0x8a)]({'email':_0x49e231[_0x40ea39(0x12e)]}),_0xa2e082=await master_shop[_0x40ea39(0x16b)]();console[_0x40ea39(0x163)]('master',_0xa2e082);const _0x4ce4bc=_0x4918cd['params']['id'],_0x94d1a6=await purchases[_0x40ea39(0x97)](_0x4ce4bc);console[_0x40ea39(0x163)](_0x94d1a6);const _0x51c025=await suppliers[_0x40ea39(0x8a)]({'name':_0x94d1a6[_0x40ea39(0xe7)]});console[_0x40ea39(0x163)](_0x51c025);if(_0xa2e082[0x0][_0x40ea39(0x169)]==_0x40ea39(0xc3)){var _0x18177e=users['English'];console['log'](_0x18177e);}else{if(_0xa2e082[0x0]['language']==_0x40ea39(0x129))var _0x18177e=users[_0x40ea39(0x129)];else{if(_0xa2e082[0x0][_0x40ea39(0x169)]=='German')var _0x18177e=users[_0x40ea39(0x14e)];else{if(_0xa2e082[0x0][_0x40ea39(0x169)]==_0x40ea39(0x9b))var _0x18177e=users[_0x40ea39(0x9b)];else{if(_0xa2e082[0x0][_0x40ea39(0x169)]==_0x40ea39(0x112))var _0x18177e=users[_0x40ea39(0x112)];else{if(_0xa2e082[0x0][_0x40ea39(0x169)]=='Portuguese\x20(BR)')var _0x18177e=users['Portuguese'];else{if(_0xa2e082[0x0][_0x40ea39(0x169)]==_0x40ea39(0x17e))var _0x18177e=users[_0x40ea39(0x17e)];else{if(_0xa2e082[0x0]['language']==_0x40ea39(0x17c))var _0x18177e=users['Arabic'];}}}}}}}_0x3e7321[_0x40ea39(0x108)](_0x40ea39(0x13c),{'success':_0x4918cd[_0x40ea39(0xa7)](_0x40ea39(0xad)),'errors':_0x4918cd[_0x40ea39(0xa7)](_0x40ea39(0xfd)),'role':_0x49e231,'profile':_0x1546a1,'master_shop':_0xa2e082,'supplier':_0x51c025,'purchase':_0x94d1a6,'language':_0x18177e});}catch(_0x2c0326){console[_0x40ea39(0x163)](_0x2c0326);}}),router[a0_0x3f1295(0xf3)](a0_0x3f1295(0x139),auth,async(_0x978472,_0x7573c)=>{var _0xec68fa=a0_0x3f1295;try{const {username:_0x1ad702,email:_0x212064,role:_0x6eb74}=_0x978472[_0xec68fa(0x95)],_0x4020f4=_0x978472[_0xec68fa(0x95)],_0x40cebe=await profile[_0xec68fa(0x8a)]({'email':_0x4020f4['email']}),_0x291d4e=await master_shop[_0xec68fa(0x16b)]();console[_0xec68fa(0x163)](_0xec68fa(0x92),_0x291d4e);const _0x369637=_0x978472[_0xec68fa(0x124)]['id'];console['log'](_0x369637);const _0x5ae3b5=await purchases_finished[_0xec68fa(0x97)](_0x369637);console[_0xec68fa(0x163)](_0xec68fa(0xe2),_0x5ae3b5);const _0x81e902=await product[_0xec68fa(0x16b)]({}),_0x33a64a=await warehouse[_0xec68fa(0xae)]([{'$match':{'name':_0x5ae3b5[_0xec68fa(0x102)],'room':_0x5ae3b5[_0xec68fa(0xb9)]}},{'$unwind':_0xec68fa(0xda)},{'$group':{'_id':_0xec68fa(0x11d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xec68fa(0x109)},'bay':{'$first':_0xec68fa(0x151)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xec68fa(0x134)},'secondary_code':{'$first':_0xec68fa(0x9f)},'product_code':{'$first':_0xec68fa(0x165)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xec68fa(0xb3)}}}]);console[_0xec68fa(0x163)]('stock_data',_0x33a64a);let _0x48c378;if(_0x4020f4[_0xec68fa(0xd6)]==_0xec68fa(0x14b)){const _0x35be6b=await staff[_0xec68fa(0x8a)]({'email':_0x4020f4[_0xec68fa(0x12e)]});_0x48c378=await warehouse[_0xec68fa(0x16b)]({'status':_0xec68fa(0x184),'name':_0x35be6b['warehouse'],'warehouse_category':_0xec68fa(0x13d),'name':'Return\x20Goods'});}else _0x48c378=await warehouse[_0xec68fa(0xae)]([{'$match':{'status':'Enabled','warehouse_category':_0xec68fa(0x13d),'name':_0xec68fa(0x15a)}},{'$group':{'_id':_0xec68fa(0x182),'name':{'$first':'$name'}}}]);if(_0x291d4e[0x0][_0xec68fa(0x169)]==_0xec68fa(0xc3)){var _0xff46e=users['English'];console[_0xec68fa(0x163)](_0xff46e);}else{if(_0x291d4e[0x0][_0xec68fa(0x169)]==_0xec68fa(0x129))var _0xff46e=users[_0xec68fa(0x129)];else{if(_0x291d4e[0x0][_0xec68fa(0x169)]==_0xec68fa(0x14e))var _0xff46e=users[_0xec68fa(0x14e)];else{if(_0x291d4e[0x0]['language']==_0xec68fa(0x9b))var _0xff46e=users[_0xec68fa(0x9b)];else{if(_0x291d4e[0x0][_0xec68fa(0x169)]=='French')var _0xff46e=users['French'];else{if(_0x291d4e[0x0][_0xec68fa(0x169)]==_0xec68fa(0x15e))var _0xff46e=users[_0xec68fa(0x10b)];else{if(_0x291d4e[0x0]['language']=='Chinese')var _0xff46e=users[_0xec68fa(0x17e)];else{if(_0x291d4e[0x0][_0xec68fa(0x169)]==_0xec68fa(0x17c))var _0xff46e=users[_0xec68fa(0xc8)];}}}}}}}_0x7573c[_0xec68fa(0x108)](_0xec68fa(0xea),{'success':_0x978472[_0xec68fa(0xa7)]('success'),'errors':_0x978472['flash'](_0xec68fa(0xfd)),'role':_0x4020f4,'profile':_0x40cebe,'user':_0x5ae3b5,'stock':_0x33a64a,'master_shop':_0x291d4e,'product':_0x81e902,'language':_0xff46e,'warehouse':_0x48c378});}catch(_0x15a671){console[_0xec68fa(0x163)](_0x15a671);}}),router[a0_0x3f1295(0xe5)](a0_0x3f1295(0x139),auth,async(_0x502f2a,_0x4bf5da)=>{var _0x299a77=a0_0x3f1295;try{const {invoice:_0x203a7e,date:_0x8232c,warehouse_name:_0x2ac618,Room_name:_0x29e9ab,product_name:_0x50ce9d,purchase_quantity:_0xe9c04,stocks:_0x5b8743,return_qty:_0x3edabb,note:_0x344cec,level:_0xd40401,isle:_0x2b0cce,pallet:_0x3a141d,to_warehouse_name:_0x291756,to_Room_name:_0x4adc8e}=_0x502f2a[_0x299a77(0xe4)],_0x1e2995=await purchases_finished[_0x299a77(0x8a)]({'_id':_0x502f2a[_0x299a77(0x124)]['id']}),_0x441537=await warehouse['findOne']({'name':_0x2ac618,'room':_0x29e9ab,'warehouse_category':'Finished\x20Goods'});if(typeof _0x50ce9d==_0x299a77(0x106))var _0xa49d70=[_0x502f2a[_0x299a77(0xe4)][_0x299a77(0xd7)]],_0x55f8e0=[_0x502f2a[_0x299a77(0xe4)][_0x299a77(0x125)]],_0x2a49f8=[_0x502f2a[_0x299a77(0xe4)][_0x299a77(0xa0)]],_0x2c7014=[_0x502f2a[_0x299a77(0xe4)][_0x299a77(0x17d)]],_0x31ccc1=[_0x502f2a['body']['level']],_0xb7b063=[_0x502f2a[_0x299a77(0xe4)][_0x299a77(0xca)]],_0x515dcc=[_0x502f2a[_0x299a77(0xe4)][_0x299a77(0x157)]],_0x19cf1e=[_0x502f2a['body']['secondary_code_hide']];else var _0xa49d70=[..._0x502f2a[_0x299a77(0xe4)][_0x299a77(0xd7)]],_0x55f8e0=[..._0x502f2a[_0x299a77(0xe4)][_0x299a77(0x125)]],_0x2a49f8=[..._0x502f2a['body'][_0x299a77(0xa0)]],_0x2c7014=[..._0x502f2a[_0x299a77(0xe4)][_0x299a77(0x17d)]],_0x31ccc1=[..._0x502f2a[_0x299a77(0xe4)]['level']],_0xb7b063=[..._0x502f2a[_0x299a77(0xe4)][_0x299a77(0xca)]],_0x515dcc=[..._0x502f2a['body']['primary_code_hide']],_0x19cf1e=[..._0x502f2a['body'][_0x299a77(0xc1)]];const _0x549674=_0xa49d70[_0x299a77(0xf5)](_0x1407a5=>{return _0x1407a5={'product_name':_0x1407a5};});_0x55f8e0[_0x299a77(0xd3)]((_0x1ca60c,_0x23a5d7)=>{var _0x302b0f=_0x299a77;_0x549674[_0x23a5d7][_0x302b0f(0x125)]=_0x1ca60c;}),_0x2a49f8[_0x299a77(0xd3)]((_0x31ec9b,_0x36fb27)=>{var _0x8ef273=_0x299a77;_0x549674[_0x36fb27][_0x8ef273(0x116)]=_0x31ec9b;}),_0x2c7014[_0x299a77(0xd3)]((_0x564b60,_0x2cecfb)=>{var _0x274cf4=_0x299a77;_0x549674[_0x2cecfb][_0x274cf4(0x17d)]=_0x564b60;}),_0x31ccc1[_0x299a77(0xd3)]((_0x3ea549,_0x54259e)=>{var _0xd0e42b=_0x299a77;_0x549674[_0x54259e][_0xd0e42b(0x138)]=_0x3ea549;}),_0xb7b063[_0x299a77(0xd3)]((_0x28de02,_0x1945c1)=>{var _0x9404c2=_0x299a77;_0x549674[_0x1945c1][_0x9404c2(0x126)]=_0x28de02;}),_0x515dcc['forEach']((_0x11844e,_0x78bbf5)=>{var _0x1cf84f=_0x299a77;_0x549674[_0x78bbf5][_0x1cf84f(0x103)]=_0x11844e;}),_0x19cf1e['forEach']((_0x441e45,_0x5a982d)=>{var _0xc25ec1=_0x299a77;_0x549674[_0x5a982d][_0xc25ec1(0xc2)]=_0x441e45;}),_0x549674[_0x299a77(0xd3)](_0x3809eb=>{var _0x2ad7ec=_0x299a77;console[_0x2ad7ec(0x163)](_0x3809eb);const _0x34913f=_0x441537[_0x2ad7ec(0x16e)][_0x2ad7ec(0xf5)](_0x23cde5=>{var _0x5b01e1=_0x2ad7ec;_0x23cde5[_0x5b01e1(0xd7)]==_0x3809eb['product_name']&&_0x23cde5['bay']==_0x3809eb[_0x5b01e1(0x138)]&&(console['log'](parseInt(_0x23cde5[_0x5b01e1(0x12b)])+_0x5b01e1(0x13f)+parseInt(_0x3809eb[_0x5b01e1(0x17d)])),_0x23cde5['product_stock']=parseInt(_0x23cde5['product_stock'])-parseInt(_0x3809eb[_0x5b01e1(0x17d)]));});}),await _0x441537[_0x299a77(0x183)]();var _0x358be0=0x0;_0x549674['forEach'](_0x59a281=>{var _0x32386b=_0x299a77;(parseInt(_0x59a281['purchase_quantity'])<parseInt(_0x59a281['return_qty'])||parseInt(_0x59a281[_0x32386b(0x116)])<parseInt(_0x59a281[_0x32386b(0x17d)]))&&_0x358be0++;});if(_0x358be0!=0x0)return _0x502f2a[_0x299a77(0xa7)](_0x299a77(0xfd),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x4bf5da[_0x299a77(0x173)]('back');const _0x4c8b51=new purchases_return_finished({'invoice':_0x203a7e,'suppliers':_0x502f2a['body'][_0x299a77(0xe7)],'date':_0x8232c,'warehouse_name':_0x2ac618,'return_product':_0x549674,'note':_0x344cec,'room':_0x29e9ab,'to_warehouse_name':_0x291756,'to_room':_0x4adc8e}),_0x3822ac=await _0x4c8b51['save'](),_0x1336bc=await purchases_return_finished['findOne']({'invoice':_0x203a7e}),_0x42b622=await warehouse[_0x299a77(0x8a)]({'name':_0x291756,'room':_0x4adc8e,'warehouse_category':_0x299a77(0x13d)});_0x1336bc[_0x299a77(0x154)][_0x299a77(0xd3)](_0x2aba2c=>{var _0x4d541f=_0x299a77,_0x58c455=0x0;const _0x4cd4e9=_0x42b622[_0x4d541f(0x16e)][_0x4d541f(0xf5)](_0x5e6996=>{var _0x57978e=_0x4d541f;console[_0x57978e(0x163)](_0x5e6996[_0x57978e(0xd7)]+'=='+_0x2aba2c['product_name']+'&&'+_0x5e6996[_0x57978e(0x138)]+'=='+_0x2aba2c[_0x57978e(0x138)]),_0x5e6996['product_name']==_0x2aba2c[_0x57978e(0xd7)]&&_0x5e6996[_0x57978e(0x138)]==_0x2aba2c[_0x57978e(0x138)]&&(_0x5e6996['product_stock']=parseInt(_0x5e6996[_0x57978e(0x12b)])-parseInt(_0x2aba2c['return_qty']),_0x58c455++);});_0x58c455=='0'&&(_0x42b622['product_details']=_0x42b622[_0x4d541f(0x16e)][_0x4d541f(0x118)]({'product_name':_0x2aba2c[_0x4d541f(0xd7)],'product_stock':_0x2aba2c[_0x4d541f(0x17d)],'primary_code':_0x2aba2c[_0x4d541f(0x103)],'secondary_code':_0x2aba2c[_0x4d541f(0xc2)],'product_code':_0x2aba2c[_0x4d541f(0x126)],'bay':_0x2aba2c['bay'],'maxProducts':0xf423f}));}),await _0x42b622['save']();const _0x49e18d=await purchases_finished['findOne']({'invoice':_0x203a7e});_0x49e18d[_0x299a77(0xe1)]=_0x299a77(0xba);const _0x2622c7=await _0x49e18d[_0x299a77(0x183)](),_0x51f311=new s_payment_data({'invoice':_0x203a7e,'suppliers':_0x502f2a[_0x299a77(0xe4)][_0x299a77(0xe7)],'reason':_0x299a77(0x101)});await _0x51f311[_0x299a77(0x183)]();const _0x5a79fc=await master_shop[_0x299a77(0x16b)](),_0x394a67=await email_settings[_0x299a77(0x8a)](),_0x2a6735=await suppliers[_0x299a77(0x8a)]({'name':_0x502f2a[_0x299a77(0xe4)]['suppliers']});_0x5a79fc[0x0]['currency_placement']==0x1?(right_currency=_0x5a79fc[0x0][_0x299a77(0xf6)],left_currency=''):(right_currency='',left_currency=_0x5a79fc[0x0]['currency']);var _0x2753e1=_0xa49d70,_0xa6e71d=_0x2c7014,_0x38cd81='',_0x20e096;for(_0x20e096 in _0x2753e1){_0x38cd81+=_0x299a77(0x96)+_0x299a77(0x121)+_0x2753e1[_0x20e096]+_0x299a77(0x90)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xa6e71d[_0x20e096]+_0x299a77(0x90)+'</tr>';}let _0xdac755=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x394a67[_0x299a77(0x12e)],'pass':_0x394a67['password']}}),_0x4b5866={'from':_0x394a67['email'],'to':_0x2a6735[_0x299a77(0x12e)],'subject':_0x299a77(0xb0),'attachments':[{'filename':_0x299a77(0xc7),'path':__dirname+'/../public'+_0x299a77(0x152)+_0x5a79fc[0x0][_0x299a77(0x131)],'cid':_0x299a77(0xf2)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x299a77(0xdc)+_0x299a77(0xcb)+_0x299a77(0x14a)+'<div>'+_0x299a77(0x15f)+_0x299a77(0x14c)+'<div>'+_0x299a77(0xb1)+_0x5a79fc[0x0][_0x299a77(0xf9)]+_0x299a77(0xcf)+_0x299a77(0x14c)+'</div>'+_0x299a77(0x144)+_0x299a77(0xcb)+_0x299a77(0x8b)+_0x299a77(0xb6)+_0x203a7e+'\x20'+_0x299a77(0xb7)+_0x299a77(0x9c)+_0x8232c+'\x20'+_0x299a77(0x171)+'</h5>'+_0x299a77(0x14c)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x299a77(0xfc)+_0x299a77(0x96)+_0x299a77(0xef)+_0x299a77(0xdd)+_0x299a77(0xac)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+_0x299a77(0xa9)+'\x20'+_0x38cd81+'\x20'+_0x299a77(0x13a)+_0x299a77(0x11a)+_0x299a77(0xcb)+_0x299a77(0xb2)+_0x299a77(0xb5)+_0x5a79fc[0x0]['site_title']+_0x299a77(0x16a)+_0x299a77(0x14c)+'</div>'+_0x299a77(0x177)};_0xdac755[_0x299a77(0x98)](_0x4b5866,function(_0x5522bf,_0x37852b){var _0x56be50=_0x299a77;_0x5522bf?console[_0x56be50(0x163)](_0x56be50(0xe8)):console[_0x56be50(0x163)]('Email\x20sent\x20successfully');}),_0x502f2a[_0x299a77(0xa7)](_0x299a77(0xad),'purchases\x20item\x20return\x20successfull'),_0x4bf5da[_0x299a77(0x173)](_0x299a77(0x11f));}catch(_0x3150d2){_0x4bf5da['status'](0xc8)[_0x299a77(0xbf)]({'message':_0x3150d2[_0x299a77(0x15b)]});}}),router[a0_0x3f1295(0xf3)](a0_0x3f1295(0xb4),auth,async(_0x5a2c0c,_0x1147e0)=>{var _0x24c3c4=a0_0x3f1295;try{const {username:_0x580b2d,email:_0x4f5186,role:_0x465d0b}=_0x5a2c0c[_0x24c3c4(0x95)],_0x101234=_0x5a2c0c['user'],_0xa79ec=await profile[_0x24c3c4(0x8a)]({'email':_0x101234['email']}),_0x503d5f=await master_shop[_0x24c3c4(0x16b)](),_0x5596f2=_0x5a2c0c[_0x24c3c4(0x124)]['id'],_0x7f65d8=await purchases_finished[_0x24c3c4(0x97)](_0x5596f2);if(_0x503d5f[0x0][_0x24c3c4(0x169)]==_0x24c3c4(0xc3))var _0x486263=users[_0x24c3c4(0x174)];else{if(_0x503d5f[0x0][_0x24c3c4(0x169)]==_0x24c3c4(0x129))var _0x486263=users[_0x24c3c4(0x129)];else{if(_0x503d5f[0x0]['language']==_0x24c3c4(0x14e))var _0x486263=users[_0x24c3c4(0x14e)];else{if(_0x503d5f[0x0][_0x24c3c4(0x169)]==_0x24c3c4(0x9b))var _0x486263=users[_0x24c3c4(0x9b)];else{if(_0x503d5f[0x0]['language']=='French')var _0x486263=users[_0x24c3c4(0x112)];else{if(_0x503d5f[0x0][_0x24c3c4(0x169)]==_0x24c3c4(0x15e))var _0x486263=users[_0x24c3c4(0x10b)];else{if(_0x503d5f[0x0]['language']==_0x24c3c4(0x17e))var _0x486263=users[_0x24c3c4(0x17e)];else{if(_0x503d5f[0x0]['language']==_0x24c3c4(0x17c))var _0x486263=users[_0x24c3c4(0xc8)];}}}}}}}_0x1147e0['render'](_0x24c3c4(0xd1),{'success':_0x5a2c0c[_0x24c3c4(0xa7)](_0x24c3c4(0xad)),'errors':_0x5a2c0c[_0x24c3c4(0xa7)](_0x24c3c4(0xfd)),'role':_0x101234,'profile':_0xa79ec,'alldata':_0x7f65d8,'master_shop':_0x503d5f,'language':_0x486263}),console[_0x24c3c4(0x163)](alldata);}catch(_0x42e860){console[_0x24c3c4(0x163)](_0x42e860);}}),router[a0_0x3f1295(0xe5)](a0_0x3f1295(0x16f),async(_0x10bbff,_0x483637)=>{var _0x2263e7=a0_0x3f1295;const {product_code:_0xc9465a}=_0x10bbff[_0x2263e7(0xe4)];var _0x1d3e12;const _0x2a0b98=await product[_0x2263e7(0xae)]([{'$match':{'primary_code':_0xc9465a,'product_category':_0x2263e7(0x13d)}},{'$group':{'_id':_0x2263e7(0x135),'name':{'$first':_0x2263e7(0x182)},'category':{'$first':_0x2263e7(0x17a)},'brand':{'$first':_0x2263e7(0xbc)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x2263e7(0x17b)},'primary_code':{'$first':_0x2263e7(0xfb)},'secondary_code':{'$first':_0x2263e7(0xff)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2263e7(0xc4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3a81e3=await product[_0x2263e7(0xae)]([{'$match':{'secondary_code':_0xc9465a}},{'$group':{'_id':'$_id','name':{'$first':_0x2263e7(0x182)},'category':{'$first':_0x2263e7(0x17a)},'brand':{'$first':_0x2263e7(0xbc)},'unit':{'$first':_0x2263e7(0x16d)},'alertquantity':{'$first':_0x2263e7(0xab)},'product_code':{'$first':_0x2263e7(0x17b)},'primary_code':{'$first':_0x2263e7(0xfb)},'secondary_code':{'$first':_0x2263e7(0xff)},'maxStocks':{'$first':_0x2263e7(0x10e)},'maxProdPerUnit':{'$first':_0x2263e7(0xaa)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2263e7(0xc4)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2a0b98[_0x2263e7(0x114)]>0x0)_0x1d3e12=_0x2a0b98;else _0x3a81e3[_0x2263e7(0x114)]>0x0&&(_0x1d3e12=_0x3a81e3);_0x483637['json'](_0x1d3e12);}),router[a0_0x3f1295(0xe5)]('/CheckingWarehouse',async(_0x3936a6,_0x1cacf3)=>{var _0x26cbc9=a0_0x3f1295;const {productCode:_0x56666f,bay:_0x990be5,warehouses:_0x19e124,room:_0x55abfe}=_0x3936a6['body'];console[_0x26cbc9(0x163)](_0x3936a6[_0x26cbc9(0xe4)]);try{const _0x424828=await warehouse[_0x26cbc9(0xae)]([{'$match':{'name':_0x19e124,'room':_0x55abfe}},{'$unwind':_0x26cbc9(0xda)},{'$match':{'product_details.bay':parseInt(_0x990be5)}},{'$group':{'_id':_0x26cbc9(0x11d),'name':{'$first':_0x26cbc9(0xf7)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x26cbc9(0x151)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x1cacf3[_0x26cbc9(0x166)](0xc8)['json'](_0x424828);}catch(_0x16f86a){_0x1cacf3[_0x26cbc9(0x166)](0x194)[_0x26cbc9(0xbf)]({'message':_0x16f86a[_0x26cbc9(0x15b)]});}}),module['exports']=router;