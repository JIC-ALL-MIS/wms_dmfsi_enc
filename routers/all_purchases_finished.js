var a0_0x303ae7=a0_0x19fe;(function(_0x4e4785,_0x3a8808){var _0x4bae6e=a0_0x19fe,_0x4b98e6=_0x4e4785();while(!![]){try{var _0x597645=-parseInt(_0x4bae6e(0x1ff))/0x1+parseInt(_0x4bae6e(0x260))/0x2+-parseInt(_0x4bae6e(0x1c0))/0x3+-parseInt(_0x4bae6e(0x1fd))/0x4*(-parseInt(_0x4bae6e(0x253))/0x5)+-parseInt(_0x4bae6e(0x1a2))/0x6+-parseInt(_0x4bae6e(0x239))/0x7*(parseInt(_0x4bae6e(0x25f))/0x8)+parseInt(_0x4bae6e(0x1c1))/0x9;if(_0x597645===_0x3a8808)break;else _0x4b98e6['push'](_0x4b98e6['shift']());}catch(_0x3966fc){_0x4b98e6['push'](_0x4b98e6['shift']());}}}(a0_0x2a96,0x4b5ce));const express=require(a0_0x303ae7(0x1ab)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,purchases_finished,purchases_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x303ae7(0x209)),nodemailer=require(a0_0x303ae7(0x1a7));var ejs=require(a0_0x303ae7(0x1ea));const path=require('path'),users=require(a0_0x303ae7(0x243));router[a0_0x303ae7(0x22b)]('/view',auth,async(_0x10420e,_0x64de7e)=>{var _0x1e401a=a0_0x303ae7;try{const {username:_0x53e702,email:_0xb67f72,role:_0x170c74}=_0x10420e[_0x1e401a(0x1f2)],_0x227d60=_0x10420e[_0x1e401a(0x1f2)],_0xd78cb1=await profile[_0x1e401a(0x196)]({'email':_0x227d60[_0x1e401a(0x1aa)]}),_0x51241c=await staff[_0x1e401a(0x196)]({'email':_0x227d60[_0x1e401a(0x1aa)]});if(_0x227d60[_0x1e401a(0x176)]==_0x1e401a(0x222)){const _0x487f03=await staff['findOne']({'email':_0x227d60[_0x1e401a(0x1aa)]});}const _0x47fe4d=await master_shop[_0x1e401a(0x246)]();let _0x33bcc3;if(_0x227d60[_0x1e401a(0x176)]==_0x1e401a(0x222)){const _0x52bff2=await staff['findOne']({'email':_0x227d60[_0x1e401a(0x1aa)]});_0x33bcc3=await purchases_finished[_0x1e401a(0x1b3)]([{'$match':{'warehouse_name':_0x52bff2[_0x1e401a(0x1e2)]}},{'$lookup':{'from':_0x1e401a(0x203),'localField':'suppliers','foreignField':_0x1e401a(0x1ce),'as':_0x1e401a(0x1d5)}},{'$unwind':_0x1e401a(0x23e)},{'$unwind':_0x1e401a(0x1af)},{'$group':{'_id':_0x1e401a(0x24e),'invoice':{'$first':_0x1e401a(0x232)},'suppliers':{'$first':_0x1e401a(0x24c)},'date':{'$first':_0x1e401a(0x214)},'warehouse_name':{'$first':_0x1e401a(0x233)},'room':{'$first':_0x1e401a(0x267)},'product':{'$push':'$product'},'note':{'$first':_0x1e401a(0x1db)},'paid_amount':{'$first':_0x1e401a(0x1d4)},'due_amount':{'$first':_0x1e401a(0x205)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x1e401a(0x1eb)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x1e401a(0x263)},'level':{'$addToSet':_0x1e401a(0x1a5)},'isle':{'$addToSet':_0x1e401a(0x238)},'type':{'$addToSet':_0x1e401a(0x187)},'floorlevel':{'$addToSet':_0x1e401a(0x17d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x33bcc3=await purchases_finished['aggregate']([{'$unwind':_0x1e401a(0x1af)},{'$group':{'_id':_0x1e401a(0x24e),'invoice':{'$first':_0x1e401a(0x232)},'suppliers':{'$first':_0x1e401a(0x24c)},'date':{'$first':_0x1e401a(0x214)},'warehouse_name':{'$first':_0x1e401a(0x233)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x1e401a(0x1af)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x1e401a(0x1d4)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x1e401a(0x1eb)},'suppliers_docs':{'$first':_0x1e401a(0x23e)},'total_product_quantity':{'$sum':_0x1e401a(0x263)},'level':{'$addToSet':_0x1e401a(0x1a5)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x1e401a(0x187)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);if(_0x47fe4d[0x0][_0x1e401a(0x218)]=='English\x20(US)')var _0x2317a8=users[_0x1e401a(0x237)];else{if(_0x47fe4d[0x0]['language']==_0x1e401a(0x1e4))var _0x2317a8=users[_0x1e401a(0x1e4)];else{if(_0x47fe4d[0x0][_0x1e401a(0x218)]=='German')var _0x2317a8=users[_0x1e401a(0x255)];else{if(_0x47fe4d[0x0]['language']==_0x1e401a(0x204))var _0x2317a8=users['Spanish'];else{if(_0x47fe4d[0x0][_0x1e401a(0x218)]==_0x1e401a(0x1a1))var _0x2317a8=users[_0x1e401a(0x1a1)];else{if(_0x47fe4d[0x0][_0x1e401a(0x218)]==_0x1e401a(0x230))var _0x2317a8=users[_0x1e401a(0x24a)];else{if(_0x47fe4d[0x0]['language']=='Chinese')var _0x2317a8=users[_0x1e401a(0x1f7)];else{if(_0x47fe4d[0x0]['language']=='Arabic\x20(ae)')var _0x2317a8=users[_0x1e401a(0x191)];}}}}}}}_0x64de7e[_0x1e401a(0x229)](_0x1e401a(0x20e),{'success':_0x10420e[_0x1e401a(0x215)](_0x1e401a(0x174)),'errors':_0x10420e[_0x1e401a(0x215)](_0x1e401a(0x236)),'purchases':_0x33bcc3,'role':_0x227d60,'profile':_0xd78cb1,'master_shop':_0x47fe4d,'language':_0x2317a8});}catch(_0x1cc388){console[_0x1e401a(0x1ae)]('table\x20page',_0x1cc388),_0x64de7e[_0x1e401a(0x22d)](0xc8)[_0x1e401a(0x1bc)]({'message':_0x1cc388['message']});}});function a0_0x2a96(){var _0x198f14=['/view/return_purchase/:id','<strong>\x20Regards\x20</strong>','body','<h2>\x20','invoice','Arabic','room_name','<tbody\x20style=\x22text-align:\x20center;\x22>','exports','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','findOne','/preview/:id','$product_code','stocks','Room_name','An\x20error\x20occurred.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','An\x20error\x20occurred\x20while\x20saving\x20data.','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</body></html>','French','2266530hWjRFE','DRY\x20GOODS','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product.bay','Enclosed','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/upload/','email','express','$alertquantity','\x20Order\x20Date\x20:\x20','log','$product','MaxStocks_data','site_title','product','aggregate','INCF-','logo','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','product_stock','prod_Qty','</span>','params','prod_qty','json','add_purchases_finished','add_purchases\x20error','edit_purchases_finished','1843194nbDaMM','14602770nUXJfY','<html><head><title></title>','room','maxperunit','createTransport','<tr>','save','product_date','note','Rack\x201','master','$product_details.primary_code','/invoice/:id','name','<span\x20style=\x22float:\x20right;\x22>','production_date','/give_payment/:id','</td>','error','$paid_amount','suppliers_docs','English\x20(US)','filter','product_code_hide','then','paid_amount','$note','</div>','product_code','redirect','</tbody>','Logo.png','prod_invoice','warehouse','\x20</h2>','Hindi','<div>','purchase\x20data\x20add\x20successfully','Return\x20Goods','Purchase\x20Return','$product_details.product_code','ejs','$expiry_date','FGSEmail','$product_details._id','</tr>','/all_purchases_finished/view','date','prod_primunit','user','expiry_date','\x20Order\x20Number\x20:\x20','RoomAssign','edit_purchases_finished_view','Chinese','post','/view/:id','$product_details.maxProducts','prod_secondunit','return_product','292CuKjTn','updateOne','292513KCQuAz','$product_details.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','suppliers','Spanish','$due_amount','</h5>','Ambient','gmail','../middleware/auth','Paid\x20For\x20Purchase','prod_unit','Rack\x202','\x20<>\x20','all_purchases_finished','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','True','$brand','/view/add_purchases','$secondary_code','$date','flash','<!DOCTYPE\x20html>','purchase_quantity','language','/barcode_scanner','/CheckingWarehouse','JO_number','Email\x20sent\x20successfully','user_id','$product_details.secondary_code','back','purchase\x20data\x20update\x20successfully','currency','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','quantity','prod_cat','level','$primary_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','render','POnumber','get','slice','status','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details','Portuguese\x20(BR)','forEach','$invoice','$warehouse_name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','map','errors','English','$product.bin','2786GhsnBp','Finished\x20Goods','warehouse_name','</thead>','Purchase\x20Mail','$suppliers_docs','max_product_unit','product_name','Arabic\x20(ae)','<h5\x20style=\x22text-align:\x20left;\x22>','../public/language/languages.json','length','$unit','find','prod_code','batch_code','due_amount','Portuguese','primary_code','$suppliers','return_qty','$_id','getDate','$product_details.product_stock','standard_unit','message','32455bxcHUT','Error\x20Occurs','German','$maxStocks','password','bay','payment\x20successfull','$name','currency_placement','concat','secondary_unit','primary_code_hide','11960CslwOH','183978kfCWmK','secondary_code','findById','$product.quantity','/all_purchases/view','$secondary_unit','product_cat','$room','stock_quantity','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.rack','catch','amount','success','maxStocks','role','getMonth','$category','</table>','sendMail','$product_details.floorlevel','prod_level','$product.floorlevel','return_data','$maxProdPerUnit','<hr\x20class=\x22my-3\x22>','FROZEN\x20GOODS','$product_details.storage','abs','<h5>','$product_details.product_name','secondary_code_hide','$product.type','Enabled','string','product_details','getFullYear'];a0_0x2a96=function(){return _0x198f14;};return a0_0x2a96();}function BayBinSelected(_0x40362d,_0x521a37){var _0x12ee3c=a0_0x303ae7,_0xb23675=[],_0x3938e0=[];if(_0x40362d==_0x12ee3c(0x1a3)){switch(_0x521a37){case _0x12ee3c(0x1ca):_0xb23675=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0xb23675=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3938e0=['DG'];}else{if(_0x40362d==_0x12ee3c(0x181)){switch(_0x521a37){case _0x12ee3c(0x1ca):_0xb23675=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x12ee3c(0x20c):_0xb23675=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3938e0=['FG'];}}return{'levels':_0xb23675,'identify':_0x3938e0};}async function getRandom8DigitNumber(){var _0x41ae46=a0_0x303ae7;const _0x46e484=0x989680,_0x1fa384=0x5f5e0ff,_0x3ad1c1=Math['floor'](Math['random']()*(_0x1fa384-_0x46e484+0x1))+_0x46e484;var _0x401bfc;const _0x3fa4cf=await purchases_finished[_0x41ae46(0x196)]({'invoice':_0x41ae46(0x1b4)+_0x3ad1c1});return _0x3fa4cf&&_0x3fa4cf[_0x41ae46(0x244)]>0x0?_0x401bfc=_0x41ae46(0x1b4)+_0x3ad1c1:_0x401bfc=_0x41ae46(0x1b4)+_0x3ad1c1,_0x401bfc;}function a0_0x19fe(_0x5bbdcf,_0x57889b){var _0x2a966f=a0_0x2a96();return a0_0x19fe=function(_0x19feef,_0x170c18){_0x19feef=_0x19feef-0x171;var _0x3563c8=_0x2a966f[_0x19feef];return _0x3563c8;},a0_0x19fe(_0x5bbdcf,_0x57889b);}router[a0_0x303ae7(0x22b)]('/view/add_purchases',auth,async(_0x542fa5,_0x1d9f1c)=>{var _0x1235af=a0_0x303ae7;try{const {username:_0x3825f7,email:_0x260193,role:_0x31325d}=_0x542fa5['user'],_0xfb4c7a=_0x542fa5[_0x1235af(0x1f2)],_0x249ee4=await profile[_0x1235af(0x196)]({'email':_0xfb4c7a['email']}),_0x3d3716=await master_shop[_0x1235af(0x246)](),_0x33c37d=await staff['findOne']({'email':_0xfb4c7a[_0x1235af(0x1aa)]}),_0x4072f1=await suppliers[_0x1235af(0x246)]({});let _0x4b323b;if(_0xfb4c7a[_0x1235af(0x176)]==_0x1235af(0x222)){const _0x59dcd9=await staff[_0x1235af(0x196)]({'email':_0xfb4c7a[_0x1235af(0x1aa)]});_0x4b323b=await warehouse[_0x1235af(0x1b3)]([{'$match':{'status':_0x1235af(0x188),'name':_0x59dcd9[_0x1235af(0x1e2)],'warehouse_category':_0x1235af(0x23a)}},{'$group':{'_id':_0x1235af(0x25a),'name':{'$first':_0x1235af(0x25a)}}}]);}else _0x4b323b=await warehouse[_0x1235af(0x1b3)]([{'$match':{'status':_0x1235af(0x188),'warehouse_category':_0x1235af(0x23a),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x1235af(0x25a),'name':{'$first':_0x1235af(0x25a)}}}]);const _0x8a55f=await product[_0x1235af(0x246)]({}),_0x3067d8=await warehouse['find']({'status':_0x1235af(0x188)}),_0x3961e9=await purchases_finished['find']({}),_0x5ef593=_0x3961e9[_0x1235af(0x244)]+0x1,_0x5e32ac=_0x1235af(0x1b4)+_0x5ef593['toString']()['padStart'](0x5,'0');var _0x38bf21=[_0x1235af(0x207),_0x1235af(0x1a6)];if(_0x3d3716[0x0][_0x1235af(0x218)]=='English\x20(US)')var _0x47d634=users['English'];else{if(_0x3d3716[0x0]['language']=='Hindi')var _0x47d634=users['Hindi'];else{if(_0x3d3716[0x0][_0x1235af(0x218)]==_0x1235af(0x255))var _0x47d634=users['German'];else{if(_0x3d3716[0x0][_0x1235af(0x218)]==_0x1235af(0x204))var _0x47d634=users[_0x1235af(0x204)];else{if(_0x3d3716[0x0]['language']==_0x1235af(0x1a1))var _0x47d634=users['French'];else{if(_0x3d3716[0x0][_0x1235af(0x218)]==_0x1235af(0x230))var _0x47d634=users['Portuguese'];else{if(_0x3d3716[0x0][_0x1235af(0x218)]==_0x1235af(0x1f7))var _0x47d634=users[_0x1235af(0x1f7)];else{if(_0x3d3716[0x0][_0x1235af(0x218)]=='Arabic\x20(ae)')var _0x47d634=users[_0x1235af(0x191)];}}}}}}}const _0x27387f=getRandom8DigitNumber();_0x27387f['then'](_0x9f86fe=>{var _0x48c8f8=_0x1235af;_0x1d9f1c[_0x48c8f8(0x229)](_0x48c8f8(0x1bd),{'success':_0x542fa5[_0x48c8f8(0x215)](_0x48c8f8(0x174)),'errors':_0x542fa5['flash'](_0x48c8f8(0x236)),'role':_0xfb4c7a,'profile':_0x249ee4,'suppliers':_0x4072f1,'warehouse':_0x4b323b,'product':_0x8a55f,'invoice':_0x9f86fe,'master_shop':_0x3d3716,'language':_0x47d634,'find_data':_0x3067d8,'rooms_data':_0x38bf21});})[_0x1235af(0x172)](_0x311bea=>{var _0x319d6a=_0x1235af;_0x542fa5[_0x319d6a(0x215)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1d9f1c[_0x319d6a(0x1de)](_0x319d6a(0x1ef));});}catch(_0x23060a){console[_0x1235af(0x1ae)](_0x23060a);}}),router[a0_0x303ae7(0x22b)]('/view/add_purchases/:id',auth,async(_0x3ef3c0,_0x1a00e4)=>{var _0x16c4c0=a0_0x303ae7;try{const _0x725dd0=_0x3ef3c0['params']['id'];console['log'](_0x725dd0);const _0x404a27=await master_shop[_0x16c4c0(0x246)]();console[_0x16c4c0(0x1ae)]('master',_0x404a27);const _0x567bf5=await product[_0x16c4c0(0x196)]({'name':_0x725dd0});console[_0x16c4c0(0x1ae)](_0x16c4c0(0x1b2),_0x567bf5),_0x1a00e4[_0x16c4c0(0x22d)](0xc8)['json']({'product_data':_0x567bf5,'master':_0x404a27});}catch(_0x1800b3){console[_0x16c4c0(0x1ae)](_0x16c4c0(0x1be),_0x1800b3);}}),router[a0_0x303ae7(0x1f8)](a0_0x303ae7(0x212),auth,async(_0x105426,_0x37d740)=>{var _0x12a5c0=a0_0x303ae7;try{const {invoice:_0x1b3313,date:_0x5bf73e,warehouse_name:_0x55ffa7,prod_name:_0x1a2cd7,prod_code:_0x1aa7a3,prod_qty:_0x4783be,prod_unit:_0x55cc6d,prod_secondunit:_0x23db4f,prod_level:_0x27fb10,prod_isle:_0xbf5094,prod_pallet:_0x10672c,note:_0x21bd75,expiry_date:_0x425ce3,batch_code:_0x160067,payable:_0x2ccf74,due_amount:_0x4eef0d,Room_name:_0x1a3eb9,primary_code:_0x69cdb,secondary_code:_0x12c334,MaxStocks_data:_0x40ef9e,PO_number:_0x41e187,SCRN:_0x5c4617,JO_number:_0x1cc886}=_0x105426['body'];if(typeof _0x1a2cd7==_0x12a5c0(0x189))var _0x380a79=[_0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x19e)]],_0x1cdb5a=[_0x105426['body'][_0x12a5c0(0x247)]],_0x47546c=[_0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1b8)]],_0x3195f8=[_0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1f1)]],_0x23d167=[_0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1fb)]],_0xff37c0=[_0x105426[_0x12a5c0(0x18e)]['prod_level']],_0x2f3c79=[_0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x24b)]],_0xd9ad6e=[_0x105426['body'][_0x12a5c0(0x261)]],_0x5c4036=[_0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1b0)]],_0x4d5d4f=[_0x105426['body']['batch_code']],_0x322120=[_0x105426['body']['expiry_date']],_0x3c02a7=[_0x105426['body'][_0x12a5c0(0x1c8)]],_0x442097=[_0x105426['body'][_0x12a5c0(0x23f)]],_0x1e3821=[_0x105426['body']['prod_cat']],_0x588136=[_0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1f5)]],_0x45874d=[_0x105426['body'][_0x12a5c0(0x1e1)]];else var _0x380a79=[..._0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x19e)]],_0x1cdb5a=[..._0x105426[_0x12a5c0(0x18e)]['prod_code']],_0x47546c=[..._0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1b8)]],_0x3195f8=[..._0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1f1)]],_0x23d167=[..._0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1fb)]],_0xff37c0=[..._0x105426['body'][_0x12a5c0(0x17c)]],_0x2f3c79=[..._0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x24b)]],_0xd9ad6e=[..._0x105426[_0x12a5c0(0x18e)]['secondary_code']],_0x5c4036=[..._0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1b0)]],_0x4d5d4f=[..._0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x248)]],_0x322120=[..._0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1f3)]],_0x3c02a7=[..._0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1c8)]],_0x442097=[..._0x105426['body'][_0x12a5c0(0x23f)]],_0x1e3821=[..._0x105426['body'][_0x12a5c0(0x225)]],_0x588136=[..._0x105426[_0x12a5c0(0x18e)][_0x12a5c0(0x1f5)]],_0x45874d=[..._0x105426['body'][_0x12a5c0(0x1e1)]];const _0x1d5107=_0x380a79[_0x12a5c0(0x235)](_0x5b879f=>{return _0x5b879f={'product_name':_0x5b879f};});_0x1cdb5a['forEach']((_0xb25d81,_0x322cfc)=>{var _0x30c021=_0x12a5c0;_0x1d5107[_0x322cfc][_0x30c021(0x1dd)]=_0xb25d81;}),_0x47546c[_0x12a5c0(0x231)]((_0x10ff67,_0x42f2a4)=>{var _0x170a01=_0x12a5c0;_0x1d5107[_0x42f2a4][_0x170a01(0x224)]=Math['abs'](_0x10ff67);}),_0x3195f8['forEach']((_0x3c8fab,_0x59d0fc)=>{_0x1d5107[_0x59d0fc]['standard_unit']=_0x3c8fab;}),_0x23d167[_0x12a5c0(0x231)]((_0x511195,_0x120fe4)=>{var _0x3a5038=_0x12a5c0;_0x1d5107[_0x120fe4][_0x3a5038(0x25d)]=_0x511195;}),_0xff37c0['forEach']((_0x3ccdce,_0x552446)=>{var _0x1fd88a=_0x12a5c0;_0x1d5107[_0x552446][_0x1fd88a(0x258)]=_0x3ccdce;}),_0x2f3c79[_0x12a5c0(0x231)]((_0x5948a9,_0x150c85)=>{_0x1d5107[_0x150c85]['primary_code']=_0x5948a9;}),_0xd9ad6e[_0x12a5c0(0x231)]((_0x544b89,_0x5840c6)=>{var _0x2b87a3=_0x12a5c0;_0x1d5107[_0x5840c6][_0x2b87a3(0x261)]=_0x544b89;}),_0x5c4036['forEach']((_0x3948e1,_0x2d874e)=>{_0x1d5107[_0x2d874e]['maxStocks']=_0x3948e1;}),_0x4d5d4f['forEach']((_0x46a366,_0x2fccee)=>{var _0x141755=_0x12a5c0;_0x1d5107[_0x2fccee][_0x141755(0x248)]=_0x46a366;}),_0x322120[_0x12a5c0(0x231)]((_0x54ba90,_0x84f28e)=>{_0x1d5107[_0x84f28e]['expiry_date']=_0x54ba90;}),_0x3c02a7[_0x12a5c0(0x231)]((_0x8a7bef,_0x152b63)=>{_0x1d5107[_0x152b63]['production_date']=_0x8a7bef;}),_0x442097[_0x12a5c0(0x231)]((_0x4c87ad,_0x207a31)=>{var _0x528338=_0x12a5c0;_0x1d5107[_0x207a31][_0x528338(0x1c4)]=_0x4c87ad;}),_0x1e3821['forEach']((_0x811937,_0x61506b)=>{_0x1d5107[_0x61506b]['product_cat']=_0x811937;}),_0x588136[_0x12a5c0(0x231)]((_0x23a36f,_0x3aab09)=>{var _0x57dcd1=_0x12a5c0;_0x1d5107[_0x3aab09][_0x57dcd1(0x192)]=_0x23a36f;}),_0x45874d[_0x12a5c0(0x231)]((_0x978f95,_0x1589ff)=>{var _0x167ec0=_0x12a5c0;_0x1d5107[_0x1589ff][_0x167ec0(0x190)]=_0x978f95;});const _0x1229da=_0x1d5107[_0x12a5c0(0x1d7)](_0x5beb73=>_0x5beb73[_0x12a5c0(0x224)]!=='0'&&_0x5beb73[_0x12a5c0(0x224)]!==''),_0x18a3fd=new purchases_finished({'invoice':_0x1b3313,'suppliers':_0x105426[_0x12a5c0(0x18e)]['suppliers'],'date':_0x5bf73e,'warehouse_name':_0x55ffa7,'product':_0x1229da,'note':_0x21bd75,'due_amount':_0x4eef0d,'room':_0x1a3eb9,'POnumber':_0x41e187,'SCRN':_0x5c4617,'JO_number':_0x1cc886}),_0x3b0a8b=await _0x18a3fd['save'](),_0x1c06c1=await purchases_finished[_0x12a5c0(0x196)]({'invoice':_0x1b3313}),_0x30982f=_0x1c06c1[_0x12a5c0(0x1b2)]['map'](async _0x1a649e=>{var _0x265d09=_0x12a5c0,_0x4a0495=await warehouse[_0x265d09(0x196)]({'name':_0x55ffa7,'room':_0x1a649e[_0x265d09(0x192)]}),_0x50cc67=0x0;const _0x278c15=_0x4a0495[_0x265d09(0x18a)][_0x265d09(0x235)](_0x42eb0e=>{var _0x565296=_0x265d09;console['log'](_0x42eb0e[_0x565296(0x240)]+'=='+_0x1a649e[_0x565296(0x240)]+'&&'+_0x42eb0e['bay']+'=='+_0x1a649e['bay']+'&&'+_0x42eb0e['expiry_date']+'=='+_0x1a649e[_0x565296(0x1f3)]+'&&'+_0x42eb0e['production_date']+'=='+_0x1a649e[_0x565296(0x1d0)]+'&&'+_0x42eb0e[_0x565296(0x248)]+'=='+_0x1a649e[_0x565296(0x248)]+'&&'+_0x42eb0e['invoice']+'=='+_0x1c06c1[_0x565296(0x190)]),_0x42eb0e['product_name']==_0x1a649e[_0x565296(0x240)]&&_0x42eb0e[_0x565296(0x258)]==_0x1a649e['bay']&&_0x42eb0e[_0x565296(0x1f3)]==_0x1a649e[_0x565296(0x1f3)]&&_0x42eb0e[_0x565296(0x1d0)]==_0x1a649e[_0x565296(0x1d0)]&&_0x42eb0e[_0x565296(0x248)]==_0x1a649e['batch_code']&&_0x42eb0e[_0x565296(0x190)]==_0x1c06c1[_0x565296(0x190)]&&(_0x42eb0e['product_stock']=Math[_0x565296(0x183)](_0x42eb0e['product_stock'])+Math[_0x565296(0x183)](_0x1a649e['quantity']),_0x50cc67++);});return _0x50cc67=='0'&&(_0x4a0495[_0x265d09(0x18a)]=_0x4a0495[_0x265d09(0x18a)][_0x265d09(0x25c)]({'product_name':_0x1a649e[_0x265d09(0x240)],'product_stock':Math[_0x265d09(0x183)](_0x1a649e[_0x265d09(0x224)]),'primary_code':_0x1a649e[_0x265d09(0x24b)],'secondary_code':_0x1a649e[_0x265d09(0x261)],'product_code':_0x1a649e['product_code'],'bay':_0x1a649e[_0x265d09(0x258)],'maxProducts':_0x1a649e[_0x265d09(0x175)],'unit':_0x1a649e['standard_unit'],'secondary_unit':_0x1a649e[_0x265d09(0x25d)],'expiry_date':_0x1a649e[_0x265d09(0x1f3)],'production_date':_0x1a649e[_0x265d09(0x1d0)],'maxProducts':_0x1a649e[_0x265d09(0x175)],'maxPerUnit':_0x1a649e[_0x265d09(0x1c4)],'batch_code':_0x1a649e[_0x265d09(0x248)],'product_cat':_0x1a649e[_0x265d09(0x266)],'invoice':_0x1a649e[_0x265d09(0x190)]})),_0x4a0495;});Promise['all'](_0x30982f)[_0x12a5c0(0x1d9)](async _0x3d6171=>{var _0x3d2a62=_0x12a5c0;try{for(const _0x17cc03 of _0x3d6171){await warehouse[_0x3d2a62(0x1fe)]({'_id':_0x17cc03['_id']},{'$addToSet':{'product_details':{'$each':_0x17cc03[_0x3d2a62(0x18a)]}}});}const _0xdeffb5=await master_shop[_0x3d2a62(0x246)](),_0x4860e5=await email_settings[_0x3d2a62(0x196)](),_0xb733c4=await supervisor_settings[_0x3d2a62(0x246)]();var _0x11c48d=_0x1c06c1[_0x3d2a62(0x1b2)],_0x4a1315='',_0x42b8ea;for(_0x42b8ea in _0x11c48d){var _0x414aec='FG';_0x1c06c1[_0x3d2a62(0x23b)]==_0x3d2a62(0x1a3)&&(_0x414aec='DG'),_0x4a1315+=_0x3d2a62(0x1c6)+_0x3d2a62(0x269)+_0x11c48d[_0x42b8ea][_0x3d2a62(0x240)]+_0x3d2a62(0x1d2)+_0x3d2a62(0x269)+_0x11c48d[_0x42b8ea]['product_code']+_0x3d2a62(0x1d2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x11c48d[_0x42b8ea][_0x3d2a62(0x224)]+_0x3d2a62(0x1d2)+_0x3d2a62(0x269)+_0x11c48d[_0x42b8ea]['standard_unit']+'</td>'+_0x3d2a62(0x269)+_0x11c48d[_0x42b8ea]['secondary_unit']+_0x3d2a62(0x1d2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1c06c1[_0x3d2a62(0x23b)]+_0x3d2a62(0x1d2)+_0x3d2a62(0x269)+_0x11c48d[_0x42b8ea][_0x3d2a62(0x192)]+_0x3d2a62(0x1d2)+_0x3d2a62(0x269)+_0x414aec+_0x11c48d[_0x42b8ea][_0x3d2a62(0x258)]+'</td>',_0x3d2a62(0x1ee);}let _0x460122=nodemailer['createTransport']({'host':_0x4860e5['host'],'port':Number(_0x4860e5['port']),'secure':![],'auth':{'user':_0x4860e5[_0x3d2a62(0x1aa)],'pass':_0x4860e5[_0x3d2a62(0x257)]}}),_0x2de96d={'from':_0x4860e5[_0x3d2a62(0x1aa)],'to':_0xb733c4[0x0][_0x3d2a62(0x1ec)],'subject':_0x3d2a62(0x23d),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x3d2a62(0x1a9)+_0xdeffb5[0x0]['image'],'cid':_0x3d2a62(0x1b5)}],'html':_0x3d2a62(0x216)+'<html><head><title></title>'+'</head><body>'+_0x3d2a62(0x1e5)+_0x3d2a62(0x228)+_0x3d2a62(0x1e5)+_0x3d2a62(0x20f)+_0x3d2a62(0x1dc)+_0x3d2a62(0x1e5)+_0x3d2a62(0x18f)+_0xdeffb5[0x0]['site_title']+_0x3d2a62(0x1e3)+'</div>'+_0x3d2a62(0x1dc)+_0x3d2a62(0x180)+_0x3d2a62(0x1e5)+_0x3d2a62(0x242)+_0x3d2a62(0x1f4)+_0x1c06c1['invoice']+'\x20'+_0x3d2a62(0x1cf)+_0x3d2a62(0x1ad)+_0x1c06c1[_0x3d2a62(0x1f0)]+'\x20'+_0x3d2a62(0x1b9)+'</h5>'+_0x3d2a62(0x1dc)+_0x3d2a62(0x22e)+_0x3d2a62(0x234)+'<tr>'+_0x3d2a62(0x1a4)+_0x3d2a62(0x1a8)+_0x3d2a62(0x19c)+_0x3d2a62(0x195)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x3d2a62(0x202)+_0x3d2a62(0x223)+_0x3d2a62(0x1ee)+_0x3d2a62(0x23c)+_0x3d2a62(0x193)+'\x20'+_0x4a1315+'\x20'+_0x3d2a62(0x1df)+'</table>'+_0x3d2a62(0x1e5)+'<strong>\x20Regards\x20</strong>'+_0x3d2a62(0x184)+_0xdeffb5[0x0]['site_title']+_0x3d2a62(0x206)+_0x3d2a62(0x1dc)+_0x3d2a62(0x1dc)+_0x3d2a62(0x1a0)};_0x460122['sendMail'](_0x2de96d,function(_0x120033,_0x120eee){var _0x4115b7=_0x3d2a62;_0x120033?(console[_0x4115b7(0x1ae)](_0x120033),console[_0x4115b7(0x1ae)]('Error\x20Occurs')):console[_0x4115b7(0x1ae)](_0x4115b7(0x21c));});}catch(_0x3bf45a){console['error'](_0x3bf45a),_0x37d740[_0x3d2a62(0x22d)](0x1f4)[_0x3d2a62(0x1bc)]({'error':_0x3d2a62(0x19d),'message':_0x3bf45a[_0x3d2a62(0x252)]});}})[_0x12a5c0(0x172)](_0x5016dc=>{var _0x3b85d9=_0x12a5c0;console[_0x3b85d9(0x1d3)](_0x5016dc),_0x37d740['status'](0x1f4)[_0x3b85d9(0x1bc)]({'error':_0x3b85d9(0x19b)});}),_0x105426[_0x12a5c0(0x215)](_0x12a5c0(0x174),_0x12a5c0(0x1e6)),_0x37d740[_0x12a5c0(0x1de)](_0x12a5c0(0x1ef));}catch(_0x456923){console[_0x12a5c0(0x1ae)](_0x456923);}}),router[a0_0x303ae7(0x22b)](a0_0x303ae7(0x197),auth,async(_0x2c63ee,_0xef2cd0)=>{var _0x5e46e3=a0_0x303ae7;try{const {username:_0x435da4,email:_0x39e053,role:_0x310d2b}=_0x2c63ee[_0x5e46e3(0x1f2)],_0x4bef1e=_0x2c63ee['user'],_0x154f7e=await profile[_0x5e46e3(0x196)]({'email':_0x4bef1e[_0x5e46e3(0x1aa)]}),_0x50c23b=await master_shop[_0x5e46e3(0x246)](),_0x5b71a4=_0x2c63ee[_0x5e46e3(0x1ba)]['id'],_0xfb3c83=await purchases_finished['findById'](_0x5b71a4),_0x4f958b=await suppliers[_0x5e46e3(0x246)]({});let _0x38409e;if(_0x4bef1e[_0x5e46e3(0x176)]==_0x5e46e3(0x222)){const _0x44359d=await staff[_0x5e46e3(0x196)]({'email':_0x4bef1e[_0x5e46e3(0x1aa)]});_0x38409e=await warehouse[_0x5e46e3(0x246)]({'status':_0x5e46e3(0x188),'name':_0x44359d[_0x5e46e3(0x1e2)],'warehouse_category':_0x5e46e3(0x23a)});}else _0x38409e=await warehouse[_0x5e46e3(0x1b3)]([{'$match':{'status':_0x5e46e3(0x188),'warehouse_category':_0x5e46e3(0x23a)}},{'$group':{'_id':_0x5e46e3(0x25a),'name':{'$first':_0x5e46e3(0x25a)}}}]);const _0x5828fa=await product['find']({}),_0x3cf742=BayBinSelected(_0xfb3c83['warehouse_name'],_0xfb3c83[_0x5e46e3(0x1c3)]);let _0x422069=new Date(_0xfb3c83['expiry_date']),_0x41f7cd=('0'+_0x422069[_0x5e46e3(0x24f)]())[_0x5e46e3(0x22c)](-0x2),_0x294289=('0'+(_0x422069[_0x5e46e3(0x177)]()+0x1))[_0x5e46e3(0x22c)](-0x2),_0x57ac60=_0x422069['getFullYear'](),_0x43b863=_0x57ac60+'-'+_0x294289+'-'+_0x41f7cd;if(_0x50c23b[0x0]['language']==_0x5e46e3(0x1d6)){var _0x26fcac=users['English'];console[_0x5e46e3(0x1ae)](_0x26fcac);}else{if(_0x50c23b[0x0]['language']==_0x5e46e3(0x1e4))var _0x26fcac=users[_0x5e46e3(0x1e4)];else{if(_0x50c23b[0x0]['language']==_0x5e46e3(0x255))var _0x26fcac=users[_0x5e46e3(0x255)];else{if(_0x50c23b[0x0][_0x5e46e3(0x218)]==_0x5e46e3(0x204))var _0x26fcac=users['Spanish'];else{if(_0x50c23b[0x0][_0x5e46e3(0x218)]==_0x5e46e3(0x1a1))var _0x26fcac=users['French'];else{if(_0x50c23b[0x0]['language']=='Portuguese\x20(BR)')var _0x26fcac=users[_0x5e46e3(0x24a)];else{if(_0x50c23b[0x0][_0x5e46e3(0x218)]=='Chinese')var _0x26fcac=users[_0x5e46e3(0x1f7)];else{if(_0x50c23b[0x0][_0x5e46e3(0x218)]=='Arabic\x20(ae)')var _0x26fcac=users[_0x5e46e3(0x191)];}}}}}}}_0xef2cd0[_0x5e46e3(0x229)](_0x5e46e3(0x1f6),{'success':_0x2c63ee[_0x5e46e3(0x215)]('success'),'errors':_0x2c63ee[_0x5e46e3(0x215)](_0x5e46e3(0x236)),'role':_0x4bef1e,'profile':_0x154f7e,'purchases':_0xfb3c83,'suppliers':_0x4f958b,'warehouse':_0x38409e,'product':_0x5828fa,'master_shop':_0x50c23b,'language':_0x26fcac,'ed_fullDate':_0x43b863,'dataSelected':_0x3cf742});}catch(_0x3cbd65){console[_0x5e46e3(0x1ae)](_0x3cbd65);}}),router[a0_0x303ae7(0x22b)]('/view/:id',auth,async(_0x15823d,_0x4adbec)=>{var _0x554295=a0_0x303ae7;try{const {username:_0x430319,email:_0x6504f2,role:_0x17e2e9}=_0x15823d[_0x554295(0x1f2)],_0x515b6c=_0x15823d[_0x554295(0x1f2)],_0x2c2b65=await profile['findOne']({'email':_0x515b6c[_0x554295(0x1aa)]}),_0x5b3a85=await master_shop[_0x554295(0x246)](),_0x4905a0=_0x15823d[_0x554295(0x1ba)]['id'],_0x30f2f9=await purchases_finished[_0x554295(0x262)](_0x4905a0),_0x38c1d9=await suppliers[_0x554295(0x246)]({});let _0x125226;if(_0x515b6c[_0x554295(0x176)]==_0x554295(0x222)){const _0x2a4148=await staff[_0x554295(0x196)]({'email':_0x515b6c[_0x554295(0x1aa)]});_0x125226=await warehouse[_0x554295(0x246)]({'status':_0x554295(0x188),'name':_0x2a4148['warehouse'],'warehouse_category':_0x554295(0x23a)});}else _0x125226=await warehouse[_0x554295(0x1b3)]([{'$match':{'status':_0x554295(0x188),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':'$name','name':{'$first':_0x554295(0x25a)}}}]);const _0x2f0cfa=await product[_0x554295(0x246)]({}),_0xa31f84=BayBinSelected(_0x30f2f9['warehouse_name'],_0x30f2f9[_0x554295(0x1c3)]);let _0x26dabd=new Date(_0x30f2f9[_0x554295(0x1f3)]),_0x1136cd=('0'+_0x26dabd[_0x554295(0x24f)]())[_0x554295(0x22c)](-0x2),_0x38e54b=('0'+(_0x26dabd[_0x554295(0x177)]()+0x1))[_0x554295(0x22c)](-0x2),_0xb19ce3=_0x26dabd[_0x554295(0x18b)](),_0x954425=_0xb19ce3+'-'+_0x38e54b+'-'+_0x1136cd;if(_0x5b3a85[0x0][_0x554295(0x218)]=='English\x20(US)'){var _0xceb3c=users[_0x554295(0x237)];console[_0x554295(0x1ae)](_0xceb3c);}else{if(_0x5b3a85[0x0][_0x554295(0x218)]==_0x554295(0x1e4))var _0xceb3c=users[_0x554295(0x1e4)];else{if(_0x5b3a85[0x0][_0x554295(0x218)]==_0x554295(0x255))var _0xceb3c=users['German'];else{if(_0x5b3a85[0x0][_0x554295(0x218)]==_0x554295(0x204))var _0xceb3c=users[_0x554295(0x204)];else{if(_0x5b3a85[0x0]['language']==_0x554295(0x1a1))var _0xceb3c=users[_0x554295(0x1a1)];else{if(_0x5b3a85[0x0]['language']==_0x554295(0x230))var _0xceb3c=users[_0x554295(0x24a)];else{if(_0x5b3a85[0x0][_0x554295(0x218)]==_0x554295(0x1f7))var _0xceb3c=users['Chinese'];else{if(_0x5b3a85[0x0][_0x554295(0x218)]==_0x554295(0x241))var _0xceb3c=users[_0x554295(0x191)];}}}}}}}_0x4adbec[_0x554295(0x229)](_0x554295(0x1bf),{'success':_0x15823d[_0x554295(0x215)](_0x554295(0x174)),'errors':_0x15823d[_0x554295(0x215)]('errors'),'role':_0x515b6c,'profile':_0x2c2b65,'purchases':_0x30f2f9,'suppliers':_0x38c1d9,'warehouse':_0x125226,'product':_0x2f0cfa,'master_shop':_0x5b3a85,'language':_0xceb3c,'ed_fullDate':_0x954425,'dataSelected':_0xa31f84});}catch(_0x3a6825){console[_0x554295(0x1ae)](_0x3a6825);}}),router[a0_0x303ae7(0x1f8)](a0_0x303ae7(0x1f9),auth,async(_0x404f96,_0x2d8280)=>{var _0x478fde=a0_0x303ae7;try{const _0x5d37d2=_0x404f96[_0x478fde(0x1ba)]['id'],_0x5523ac=await purchases_finished['findOne']({'_id':_0x404f96['params']['id']}),_0x47030c=await warehouse[_0x478fde(0x196)]({'name':_0x5523ac['warehouse_name'],'room':_0x5523ac['room']});_0x5523ac[_0x478fde(0x1b2)][_0x478fde(0x231)](_0x2c74e6=>{var _0x5ce34d=_0x478fde;const _0x260328=_0x47030c[_0x5ce34d(0x18a)][_0x5ce34d(0x235)](_0x407240=>{var _0x29e848=_0x5ce34d;_0x407240[_0x29e848(0x240)]==_0x2c74e6[_0x29e848(0x240)]&&_0x407240['bay']==_0x2c74e6['bay']&&(_0x407240['product_stock']=parseInt(_0x407240[_0x29e848(0x1b7)])-parseInt(_0x2c74e6[_0x29e848(0x224)]));});}),await _0x47030c[_0x478fde(0x1c7)]();const {invoice:_0x156192,suppliers:_0x5ce6b4,date:_0x92ba3d,warehouse_name:_0x5bdb92,prod_name:_0x2e3328,prod_code:_0x4d24ba,prod_qty:_0x100ffa,prod_unit:_0x149911,prod_secondunit:_0x286b72,prod_level:_0x31bdaa,prod_isle:_0x2dfbc2,prod_pallet:_0x4a5204,note:_0x4a15a8,expiry_date:_0x5dbf7d,batch_code:_0x2899dd,paid_amount:_0x5a9241,due_amount:_0x45bdf8,Room_name:_0x28051a,primary_code:_0x5820f5,secondary_code:_0x244365,PO_number:_0x221728,JO_number:_0x3d0f63}=_0x404f96['body'];if(typeof _0x2e3328=='string')var _0x2406b8=[_0x404f96[_0x478fde(0x18e)][_0x478fde(0x19e)]],_0x14211a=[_0x404f96[_0x478fde(0x18e)][_0x478fde(0x247)]],_0x9868ad=[_0x404f96[_0x478fde(0x18e)][_0x478fde(0x1bb)]],_0x1fb87a=[_0x404f96['body']['prod_unit']],_0x15f624=[_0x404f96[_0x478fde(0x18e)][_0x478fde(0x1fb)]],_0x146ead=[_0x404f96[_0x478fde(0x18e)][_0x478fde(0x17c)]],_0x31c872=[_0x404f96[_0x478fde(0x18e)][_0x478fde(0x24b)]],_0x3c7b3e=[_0x404f96[_0x478fde(0x18e)][_0x478fde(0x261)]],_0x3bc928=[_0x404f96[_0x478fde(0x18e)]['MaxStocks_data']],_0x52693b=[_0x404f96['body']['batch_code']],_0x22e869=[_0x404f96['body'][_0x478fde(0x1f3)]];else var _0x2406b8=[..._0x404f96['body'][_0x478fde(0x19e)]],_0x14211a=[..._0x404f96[_0x478fde(0x18e)]['prod_code']],_0x9868ad=[..._0x404f96[_0x478fde(0x18e)]['prod_qty']],_0x1fb87a=[..._0x404f96[_0x478fde(0x18e)][_0x478fde(0x20b)]],_0x15f624=[..._0x404f96['body'][_0x478fde(0x1fb)]],_0x146ead=[..._0x404f96['body'][_0x478fde(0x17c)]],_0x31c872=[..._0x404f96[_0x478fde(0x18e)]['primary_code']],_0x3c7b3e=[..._0x404f96[_0x478fde(0x18e)]['secondary_code']],_0x3bc928=[..._0x404f96['body']['MaxStocks_data']],_0x52693b=[..._0x404f96['body'][_0x478fde(0x248)]],_0x22e869=[..._0x404f96[_0x478fde(0x18e)][_0x478fde(0x1f3)]];const _0x3cff58=_0x2406b8[_0x478fde(0x235)](_0x53a5ef=>{return _0x53a5ef={'product_name':_0x53a5ef};});_0x14211a['forEach']((_0x13baaf,_0xc5a88a)=>{_0x3cff58[_0xc5a88a]['product_code']=_0x13baaf;}),_0x9868ad[_0x478fde(0x231)]((_0x1adddc,_0xac18b5)=>{_0x3cff58[_0xac18b5]['quantity']=_0x1adddc;}),_0x1fb87a['forEach']((_0x3b3494,_0x2496f4)=>{var _0xbdc863=_0x478fde;_0x3cff58[_0x2496f4][_0xbdc863(0x251)]=_0x3b3494;}),_0x15f624[_0x478fde(0x231)]((_0x1921c5,_0x16fd27)=>{var _0xfbb0aa=_0x478fde;_0x3cff58[_0x16fd27][_0xfbb0aa(0x25d)]=_0x1921c5;}),_0x146ead[_0x478fde(0x231)]((_0x3aab2c,_0x543111)=>{var _0x42eed3=_0x478fde;_0x3cff58[_0x543111][_0x42eed3(0x258)]=_0x3aab2c;}),_0x31c872[_0x478fde(0x231)]((_0x36bfb3,_0x9285d8)=>{_0x3cff58[_0x9285d8]['primary_code']=_0x36bfb3;}),_0x3c7b3e[_0x478fde(0x231)]((_0x1a2b2c,_0x3ce652)=>{var _0x36c2e5=_0x478fde;_0x3cff58[_0x3ce652][_0x36c2e5(0x261)]=_0x1a2b2c;}),_0x3bc928[_0x478fde(0x231)]((_0x3fc7ac,_0x622930)=>{var _0x10542e=_0x478fde;_0x3cff58[_0x622930][_0x10542e(0x175)]=_0x3fc7ac;}),_0x52693b[_0x478fde(0x231)]((_0x14ff89,_0x11fd9b)=>{var _0x568991=_0x478fde;_0x3cff58[_0x11fd9b][_0x568991(0x248)]=_0x14ff89;}),_0x22e869[_0x478fde(0x231)]((_0x46b73a,_0x370495)=>{var _0xefbd95=_0x478fde;_0x3cff58[_0x370495][_0xefbd95(0x1f3)]=_0x46b73a;});const _0x4de30b=_0x3cff58[_0x478fde(0x1d7)](_0x5c456b=>_0x5c456b[_0x478fde(0x224)]!=='0'&&_0x5c456b[_0x478fde(0x224)]!=='');_0x5523ac[_0x478fde(0x190)]=_0x156192,_0x5523ac[_0x478fde(0x203)]=_0x5ce6b4,_0x5523ac[_0x478fde(0x1f0)]=_0x92ba3d,_0x5523ac[_0x478fde(0x23b)]=_0x5bdb92,_0x5523ac[_0x478fde(0x1b2)]=_0x4de30b,_0x5523ac[_0x478fde(0x1c9)]=_0x4a15a8,_0x5523ac[_0x478fde(0x1da)]=_0x5a9241,_0x5523ac[_0x478fde(0x249)]=_0x45bdf8,_0x5523ac[_0x478fde(0x1c3)]=_0x28051a,_0x5523ac[_0x478fde(0x22a)]=_0x221728,_0x5523ac[_0x478fde(0x21b)]=_0x3d0f63;const _0x5ca865=await _0x5523ac[_0x478fde(0x1c7)](),_0x343391=await warehouse[_0x478fde(0x196)]({'name':_0x404f96['body']['warehouse_name'],'room':_0x404f96['body'][_0x478fde(0x19a)]});_0x5523ac[_0x478fde(0x1b2)][_0x478fde(0x231)](_0x23d523=>{var _0x2477db=_0x478fde,_0x4f5587=0x0;const _0x2a4aa4=_0x343391['product_details'][_0x2477db(0x235)](_0x46b0a1=>{var _0x543e50=_0x2477db;_0x46b0a1[_0x543e50(0x240)]==_0x23d523['product_name']&&_0x46b0a1[_0x543e50(0x258)]==_0x23d523[_0x543e50(0x258)]&&(_0x46b0a1[_0x543e50(0x1b7)]=parseInt(_0x46b0a1['product_stock'])+parseInt(_0x23d523[_0x543e50(0x224)]),_0x4f5587++);});_0x4f5587=='0'&&(_0x343391[_0x2477db(0x18a)]=_0x343391[_0x2477db(0x18a)][_0x2477db(0x25c)]({'product_name':_0x23d523[_0x2477db(0x240)],'product_stock':_0x23d523[_0x2477db(0x224)],'primary_code':_0x23d523[_0x2477db(0x24b)],'secondary_code':_0x23d523[_0x2477db(0x261)],'product_code':_0x23d523['product_code'],'bay':_0x23d523[_0x2477db(0x258)],'maxProducts':_0x23d523[_0x2477db(0x175)],'unit':_0x23d523[_0x2477db(0x251)],'secondary_unit':_0x23d523['secondary_unit'],'expiry_date':_0x23d523[_0x2477db(0x1f3)]}));}),await _0x343391[_0x478fde(0x1c7)]();const _0x56f84a=await s_payment_data[_0x478fde(0x196)]({'invoice':_0x404f96[_0x478fde(0x18e)][_0x478fde(0x190)]});if(_0x56f84a===null){}else console[_0x478fde(0x1ae)](_0x478fde(0x203),_0x56f84a,_0x404f96[_0x478fde(0x18e)][_0x478fde(0x190)]),_0x56f84a['suppliers']=_0x404f96[_0x478fde(0x18e)]['suppliers'],await _0x56f84a[_0x478fde(0x1c7)]();_0x404f96[_0x478fde(0x215)]('success',_0x478fde(0x220)),_0x2d8280['redirect'](_0x478fde(0x1ef));}catch(_0x1a1a57){console['log'](_0x1a1a57);}}),router[a0_0x303ae7(0x1f8)](a0_0x303ae7(0x1d1),auth,async(_0x3e6034,_0x69c598)=>{var _0x418b90=a0_0x303ae7;try{const _0xdf1dbf=_0x3e6034[_0x418b90(0x1ba)]['id'],{invoice:_0x5a2b03,suppliers:_0x2ffbd,payable:_0x15355a,due_amount:_0x3e274f}=_0x3e6034[_0x418b90(0x18e)],_0x446d25=await purchases[_0x418b90(0x262)](_0xdf1dbf);var _0xb1910=_0x15355a-_0x3e274f;_0x446d25[_0x418b90(0x1da)]=parseFloat(_0x446d25[_0x418b90(0x1da)])+parseFloat(_0x3e274f),_0x446d25[_0x418b90(0x249)]=_0xb1910;const _0x26f044=await _0x446d25['save']();console[_0x418b90(0x1ae)](_0x26f044);const _0x5e39ca=await s_payment_data[_0x418b90(0x196)]({'invoice':_0x5a2b03});_0x5e39ca[_0x418b90(0x173)]=_0xb1910,await _0x5e39ca[_0x418b90(0x1c7)]();let _0x92535a=new Date(),_0x451fce=('0'+_0x92535a[_0x418b90(0x24f)]())[_0x418b90(0x22c)](-0x2),_0x4a5137=('0'+(_0x92535a['getMonth']()+0x1))[_0x418b90(0x22c)](-0x2),_0x14a307=_0x92535a[_0x418b90(0x18b)](),_0x86e372=_0x14a307+'-'+_0x4a5137+'-'+_0x451fce;const _0x165d38=new suppliers_payment({'invoice':_0x5a2b03,'date':_0x14a307+'-'+_0x4a5137+'-'+_0x451fce,'suppliers':_0x2ffbd,'reason':_0x418b90(0x20a),'amount':_0x3e274f}),_0x173672=await _0x165d38[_0x418b90(0x1c7)]();_0x3e6034[_0x418b90(0x215)](_0x418b90(0x174),_0x418b90(0x259)),_0x69c598[_0x418b90(0x1de)](_0x418b90(0x264));}catch(_0x306f3d){console['log'](_0x306f3d);}}),router[a0_0x303ae7(0x22b)](a0_0x303ae7(0x1cd),auth,async(_0x7228ce,_0x498c85)=>{var _0x524049=a0_0x303ae7;try{const {username:_0x61a02a,email:_0x2d9c22,role:_0x349be1}=_0x7228ce['user'],_0xed3205=_0x7228ce[_0x524049(0x1f2)],_0x149374=await profile[_0x524049(0x196)]({'email':_0xed3205[_0x524049(0x1aa)]}),_0xdee22b=await master_shop['find']();console[_0x524049(0x1ae)](_0x524049(0x1cb),_0xdee22b);const _0x1f044e=_0x7228ce[_0x524049(0x1ba)]['id'],_0x4b5f0e=await purchases[_0x524049(0x262)](_0x1f044e);console[_0x524049(0x1ae)](_0x4b5f0e);const _0x59f990=await suppliers[_0x524049(0x196)]({'name':_0x4b5f0e[_0x524049(0x203)]});console[_0x524049(0x1ae)](_0x59f990);if(_0xdee22b[0x0][_0x524049(0x218)]=='English\x20(US)'){var _0x54d1dd=users[_0x524049(0x237)];console[_0x524049(0x1ae)](_0x54d1dd);}else{if(_0xdee22b[0x0]['language']==_0x524049(0x1e4))var _0x54d1dd=users[_0x524049(0x1e4)];else{if(_0xdee22b[0x0][_0x524049(0x218)]=='German')var _0x54d1dd=users[_0x524049(0x255)];else{if(_0xdee22b[0x0]['language']=='Spanish')var _0x54d1dd=users[_0x524049(0x204)];else{if(_0xdee22b[0x0][_0x524049(0x218)]==_0x524049(0x1a1))var _0x54d1dd=users[_0x524049(0x1a1)];else{if(_0xdee22b[0x0][_0x524049(0x218)]=='Portuguese\x20(BR)')var _0x54d1dd=users['Portuguese'];else{if(_0xdee22b[0x0][_0x524049(0x218)]==_0x524049(0x1f7))var _0x54d1dd=users[_0x524049(0x1f7)];else{if(_0xdee22b[0x0][_0x524049(0x218)]==_0x524049(0x241))var _0x54d1dd=users['Arabic'];}}}}}}}_0x498c85[_0x524049(0x229)]('purchase_invoice',{'success':_0x7228ce[_0x524049(0x215)]('success'),'errors':_0x7228ce[_0x524049(0x215)](_0x524049(0x236)),'role':_0xed3205,'profile':_0x149374,'master_shop':_0xdee22b,'supplier':_0x59f990,'purchase':_0x4b5f0e,'language':_0x54d1dd});}catch(_0x5da0f1){console[_0x524049(0x1ae)](_0x5da0f1);}}),router['get']('/view/return_purchase/:id',auth,async(_0x32a90d,_0x42ee19)=>{var _0x32639e=a0_0x303ae7;try{const {username:_0xbefc84,email:_0x591948,role:_0x321dfd}=_0x32a90d[_0x32639e(0x1f2)],_0x3f6578=_0x32a90d[_0x32639e(0x1f2)],_0x2becfe=await profile[_0x32639e(0x196)]({'email':_0x3f6578[_0x32639e(0x1aa)]}),_0x541b67=await master_shop['find']();console[_0x32639e(0x1ae)](_0x32639e(0x1cb),_0x541b67);const _0x2c3736=_0x32a90d[_0x32639e(0x1ba)]['id'];console[_0x32639e(0x1ae)](_0x2c3736);const _0x26b5d8=await purchases_finished[_0x32639e(0x262)](_0x2c3736);console[_0x32639e(0x1ae)](_0x32639e(0x21d),_0x26b5d8);const _0x4bb76a=await product['find']({}),_0x31d6e2=await warehouse['aggregate']([{'$match':{'name':_0x26b5d8['warehouse_name'],'room':_0x26b5d8[_0x32639e(0x1c3)]}},{'$unwind':_0x32639e(0x22f)},{'$group':{'_id':_0x32639e(0x1ed),'name':{'$first':_0x32639e(0x185)},'product_stock':{'$first':_0x32639e(0x250)},'bay':{'$first':_0x32639e(0x200)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x32639e(0x17b)},'primary_code':{'$first':_0x32639e(0x1cc)},'secondary_code':{'$first':_0x32639e(0x21e)},'product_code':{'$first':_0x32639e(0x1e9)},'storage':{'$first':_0x32639e(0x182)},'rack':{'$first':_0x32639e(0x171)}}}]);console[_0x32639e(0x1ae)]('stock_data',_0x31d6e2);let _0x972549;if(_0x3f6578[_0x32639e(0x176)]=='staff'){const _0x4d2752=await staff[_0x32639e(0x196)]({'email':_0x3f6578['email']});_0x972549=await warehouse[_0x32639e(0x246)]({'status':_0x32639e(0x188),'name':_0x4d2752['warehouse'],'warehouse_category':_0x32639e(0x23a),'name':_0x32639e(0x1e7)});}else _0x972549=await warehouse[_0x32639e(0x1b3)]([{'$match':{'status':_0x32639e(0x188),'warehouse_category':'Finished\x20Goods','name':_0x32639e(0x1e7)}},{'$group':{'_id':_0x32639e(0x25a),'name':{'$first':'$name'}}}]);if(_0x541b67[0x0]['language']==_0x32639e(0x1d6)){var _0xf3a65b=users[_0x32639e(0x237)];console[_0x32639e(0x1ae)](_0xf3a65b);}else{if(_0x541b67[0x0][_0x32639e(0x218)]==_0x32639e(0x1e4))var _0xf3a65b=users['Hindi'];else{if(_0x541b67[0x0][_0x32639e(0x218)]==_0x32639e(0x255))var _0xf3a65b=users['German'];else{if(_0x541b67[0x0][_0x32639e(0x218)]==_0x32639e(0x204))var _0xf3a65b=users[_0x32639e(0x204)];else{if(_0x541b67[0x0][_0x32639e(0x218)]==_0x32639e(0x1a1))var _0xf3a65b=users[_0x32639e(0x1a1)];else{if(_0x541b67[0x0][_0x32639e(0x218)]=='Portuguese\x20(BR)')var _0xf3a65b=users[_0x32639e(0x24a)];else{if(_0x541b67[0x0][_0x32639e(0x218)]==_0x32639e(0x1f7))var _0xf3a65b=users[_0x32639e(0x1f7)];else{if(_0x541b67[0x0]['language']==_0x32639e(0x241))var _0xf3a65b=users[_0x32639e(0x191)];}}}}}}}_0x42ee19[_0x32639e(0x229)]('return_purchase_finished',{'success':_0x32a90d[_0x32639e(0x215)](_0x32639e(0x174)),'errors':_0x32a90d[_0x32639e(0x215)]('errors'),'role':_0x3f6578,'profile':_0x2becfe,'user':_0x26b5d8,'stock':_0x31d6e2,'master_shop':_0x541b67,'product':_0x4bb76a,'language':_0xf3a65b,'warehouse':_0x972549});}catch(_0x398043){console[_0x32639e(0x1ae)](_0x398043);}}),router[a0_0x303ae7(0x1f8)](a0_0x303ae7(0x18c),auth,async(_0x2c201b,_0x27a294)=>{var _0x1fa7b0=a0_0x303ae7;try{const {invoice:_0x1b4b10,date:_0x4b7ca3,warehouse_name:_0x139c4e,Room_name:_0x51f7ea,product_name:_0x28150f,purchase_quantity:_0x394bee,stocks:_0x58ab17,return_qty:_0x244798,note:_0x3b95a9,level:_0x3c923d,isle:_0x2668f2,pallet:_0x4383cd,to_warehouse_name:_0x2ce9a3,to_Room_name:_0x9aec53}=_0x2c201b[_0x1fa7b0(0x18e)],_0x18d74e=await purchases_finished[_0x1fa7b0(0x196)]({'_id':_0x2c201b['params']['id']}),_0x12a5fa=await warehouse['findOne']({'name':_0x139c4e,'room':_0x51f7ea,'warehouse_category':_0x1fa7b0(0x23a)});if(typeof _0x28150f==_0x1fa7b0(0x189))var _0x243d4a=[_0x2c201b['body']['product_name']],_0x3726fd=[_0x2c201b[_0x1fa7b0(0x18e)][_0x1fa7b0(0x217)]],_0x330368=[_0x2c201b[_0x1fa7b0(0x18e)][_0x1fa7b0(0x199)]],_0x4fd09a=[_0x2c201b['body'][_0x1fa7b0(0x24d)]],_0x123b47=[_0x2c201b['body']['level']],_0x4fe7ab=[_0x2c201b[_0x1fa7b0(0x18e)][_0x1fa7b0(0x1d8)]],_0x12186a=[_0x2c201b[_0x1fa7b0(0x18e)][_0x1fa7b0(0x25e)]],_0x210a54=[_0x2c201b[_0x1fa7b0(0x18e)][_0x1fa7b0(0x186)]];else var _0x243d4a=[..._0x2c201b['body']['product_name']],_0x3726fd=[..._0x2c201b[_0x1fa7b0(0x18e)][_0x1fa7b0(0x217)]],_0x330368=[..._0x2c201b[_0x1fa7b0(0x18e)]['stocks']],_0x4fd09a=[..._0x2c201b['body'][_0x1fa7b0(0x24d)]],_0x123b47=[..._0x2c201b[_0x1fa7b0(0x18e)][_0x1fa7b0(0x226)]],_0x4fe7ab=[..._0x2c201b[_0x1fa7b0(0x18e)]['product_code_hide']],_0x12186a=[..._0x2c201b[_0x1fa7b0(0x18e)]['primary_code_hide']],_0x210a54=[..._0x2c201b[_0x1fa7b0(0x18e)]['secondary_code_hide']];const _0x1ad15d=_0x243d4a[_0x1fa7b0(0x235)](_0x3fec33=>{return _0x3fec33={'product_name':_0x3fec33};});_0x3726fd[_0x1fa7b0(0x231)]((_0x4c06fb,_0x3f1df2)=>{_0x1ad15d[_0x3f1df2]['purchase_quantity']=_0x4c06fb;}),_0x330368[_0x1fa7b0(0x231)]((_0x1693f2,_0x43b0cf)=>{_0x1ad15d[_0x43b0cf]['stock_quantity']=_0x1693f2;}),_0x4fd09a[_0x1fa7b0(0x231)]((_0x1b1352,_0x563a0f)=>{var _0x112355=_0x1fa7b0;_0x1ad15d[_0x563a0f][_0x112355(0x24d)]=_0x1b1352;}),_0x123b47[_0x1fa7b0(0x231)]((_0x38ef53,_0x338c4c)=>{var _0xe19511=_0x1fa7b0;_0x1ad15d[_0x338c4c][_0xe19511(0x258)]=_0x38ef53;}),_0x4fe7ab[_0x1fa7b0(0x231)]((_0x2a2651,_0x550839)=>{_0x1ad15d[_0x550839]['product_code']=_0x2a2651;}),_0x12186a[_0x1fa7b0(0x231)]((_0x48982a,_0x4e6acb)=>{var _0x1b3398=_0x1fa7b0;_0x1ad15d[_0x4e6acb][_0x1b3398(0x24b)]=_0x48982a;}),_0x210a54[_0x1fa7b0(0x231)]((_0x50f80f,_0x394cd3)=>{var _0x398423=_0x1fa7b0;_0x1ad15d[_0x394cd3][_0x398423(0x261)]=_0x50f80f;}),_0x1ad15d['forEach'](_0x831e40=>{var _0x2037e0=_0x1fa7b0;console['log'](_0x831e40);const _0x4c4172=_0x12a5fa[_0x2037e0(0x18a)]['map'](_0x500dbe=>{var _0x1d58a8=_0x2037e0;_0x500dbe[_0x1d58a8(0x240)]==_0x831e40['product_name']&&_0x500dbe[_0x1d58a8(0x258)]==_0x831e40[_0x1d58a8(0x258)]&&(console[_0x1d58a8(0x1ae)](parseInt(_0x500dbe['product_stock'])+_0x1d58a8(0x20d)+parseInt(_0x831e40[_0x1d58a8(0x24d)])),_0x500dbe[_0x1d58a8(0x1b7)]=parseInt(_0x500dbe[_0x1d58a8(0x1b7)])-parseInt(_0x831e40['return_qty']));});}),await _0x12a5fa['save']();var _0x3289c4=0x0;_0x1ad15d[_0x1fa7b0(0x231)](_0x248f28=>{var _0x86bbbf=_0x1fa7b0;(parseInt(_0x248f28[_0x86bbbf(0x217)])<parseInt(_0x248f28[_0x86bbbf(0x24d)])||parseInt(_0x248f28[_0x86bbbf(0x268)])<parseInt(_0x248f28['return_qty']))&&_0x3289c4++;});if(_0x3289c4!=0x0)return _0x2c201b[_0x1fa7b0(0x215)](_0x1fa7b0(0x236),_0x1fa7b0(0x1b6)),_0x27a294[_0x1fa7b0(0x1de)](_0x1fa7b0(0x21f));const _0x167807=new purchases_return_finished({'invoice':_0x1b4b10,'suppliers':_0x2c201b[_0x1fa7b0(0x18e)][_0x1fa7b0(0x203)],'date':_0x4b7ca3,'warehouse_name':_0x139c4e,'return_product':_0x1ad15d,'note':_0x3b95a9,'room':_0x51f7ea,'to_warehouse_name':_0x2ce9a3,'to_room':_0x9aec53}),_0x3c9fe3=await _0x167807['save'](),_0x30c28e=await purchases_return_finished[_0x1fa7b0(0x196)]({'invoice':_0x1b4b10}),_0x50c364=await warehouse['findOne']({'name':_0x2ce9a3,'room':_0x9aec53,'warehouse_category':_0x1fa7b0(0x23a)});_0x30c28e[_0x1fa7b0(0x1fc)][_0x1fa7b0(0x231)](_0x2f6e54=>{var _0x460628=_0x1fa7b0,_0x23fdaf=0x0;const _0x1f591d=_0x50c364[_0x460628(0x18a)]['map'](_0x20dcaf=>{var _0x10a2b7=_0x460628;console['log'](_0x20dcaf[_0x10a2b7(0x240)]+'=='+_0x2f6e54[_0x10a2b7(0x240)]+'&&'+_0x20dcaf[_0x10a2b7(0x258)]+'=='+_0x2f6e54[_0x10a2b7(0x258)]),_0x20dcaf['product_name']==_0x2f6e54[_0x10a2b7(0x240)]&&_0x20dcaf['bay']==_0x2f6e54[_0x10a2b7(0x258)]&&(_0x20dcaf[_0x10a2b7(0x1b7)]=parseInt(_0x20dcaf['product_stock'])-parseInt(_0x2f6e54[_0x10a2b7(0x24d)]),_0x23fdaf++);});_0x23fdaf=='0'&&(_0x50c364[_0x460628(0x18a)]=_0x50c364[_0x460628(0x18a)][_0x460628(0x25c)]({'product_name':_0x2f6e54[_0x460628(0x240)],'product_stock':_0x2f6e54[_0x460628(0x24d)],'primary_code':_0x2f6e54['primary_code'],'secondary_code':_0x2f6e54[_0x460628(0x261)],'product_code':_0x2f6e54[_0x460628(0x1dd)],'bay':_0x2f6e54[_0x460628(0x258)],'maxProducts':0xf423f}));}),await _0x50c364[_0x1fa7b0(0x1c7)]();const _0x4b0f03=await purchases_finished[_0x1fa7b0(0x196)]({'invoice':_0x1b4b10});_0x4b0f03[_0x1fa7b0(0x17e)]=_0x1fa7b0(0x210);const _0x4559c7=await _0x4b0f03['save'](),_0x4fc0b4=new s_payment_data({'invoice':_0x1b4b10,'suppliers':_0x2c201b[_0x1fa7b0(0x18e)][_0x1fa7b0(0x203)],'reason':_0x1fa7b0(0x1e8)});await _0x4fc0b4['save']();const _0x1feb1c=await master_shop[_0x1fa7b0(0x246)](),_0x1458a2=await email_settings[_0x1fa7b0(0x196)](),_0xaa795b=await suppliers[_0x1fa7b0(0x196)]({'name':_0x2c201b['body'][_0x1fa7b0(0x203)]});_0x1feb1c[0x0][_0x1fa7b0(0x25b)]==0x1?(right_currency=_0x1feb1c[0x0][_0x1fa7b0(0x221)],left_currency=''):(right_currency='',left_currency=_0x1feb1c[0x0][_0x1fa7b0(0x221)]);var _0x47a59b=_0x243d4a,_0x46bfb2=_0x4fd09a,_0x7ade9b='',_0x284074;for(_0x284074 in _0x47a59b){_0x7ade9b+=_0x1fa7b0(0x1c6)+_0x1fa7b0(0x269)+_0x47a59b[_0x284074]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x46bfb2[_0x284074]+'</td>'+_0x1fa7b0(0x1ee);}let _0xf5a061=nodemailer[_0x1fa7b0(0x1c5)]({'service':_0x1fa7b0(0x208),'auth':{'user':_0x1458a2[_0x1fa7b0(0x1aa)],'pass':_0x1458a2[_0x1fa7b0(0x257)]}}),_0x5d72da={'from':_0x1458a2[_0x1fa7b0(0x1aa)],'to':_0xaa795b[_0x1fa7b0(0x1aa)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x1fa7b0(0x1e0),'path':__dirname+'/../public'+'/upload/'+_0x1feb1c[0x0]['image'],'cid':_0x1fa7b0(0x1b5)}],'html':_0x1fa7b0(0x216)+_0x1fa7b0(0x1c2)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1fa7b0(0x1e5)+_0x1fa7b0(0x20f)+'</div>'+'<div>'+_0x1fa7b0(0x18f)+_0x1feb1c[0x0][_0x1fa7b0(0x1b1)]+_0x1fa7b0(0x1e3)+_0x1fa7b0(0x1dc)+'</div>'+_0x1fa7b0(0x180)+_0x1fa7b0(0x1e5)+_0x1fa7b0(0x242)+_0x1fa7b0(0x1f4)+_0x1b4b10+'\x20'+_0x1fa7b0(0x1cf)+_0x1fa7b0(0x1ad)+_0x4b7ca3+'\x20'+_0x1fa7b0(0x1b9)+'</h5>'+_0x1fa7b0(0x1dc)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1fa7b0(0x234)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1fa7b0(0x19f)+_0x1fa7b0(0x201)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x1fa7b0(0x1ee)+_0x1fa7b0(0x23c)+_0x1fa7b0(0x193)+'\x20'+_0x7ade9b+'\x20'+_0x1fa7b0(0x1df)+_0x1fa7b0(0x179)+'<div>'+_0x1fa7b0(0x18d)+_0x1fa7b0(0x184)+_0x1feb1c[0x0][_0x1fa7b0(0x1b1)]+_0x1fa7b0(0x206)+'</div>'+_0x1fa7b0(0x1dc)+_0x1fa7b0(0x1a0)};_0xf5a061[_0x1fa7b0(0x17a)](_0x5d72da,function(_0x4e9140,_0x38fc5f){var _0x25de40=_0x1fa7b0;_0x4e9140?console[_0x25de40(0x1ae)](_0x25de40(0x254)):console['log'](_0x25de40(0x21c));}),_0x2c201b[_0x1fa7b0(0x215)]('success','purchases\x20item\x20return\x20successfull'),_0x27a294['redirect'](_0x1fa7b0(0x1ef));}catch(_0x2e846e){_0x27a294[_0x1fa7b0(0x22d)](0xc8)[_0x1fa7b0(0x1bc)]({'message':_0x2e846e[_0x1fa7b0(0x252)]});}}),router[a0_0x303ae7(0x22b)]('/barcode/:id',auth,async(_0x5529b3,_0x492061)=>{var _0x269724=a0_0x303ae7;try{const {username:_0x535c2a,email:_0x3837ed,role:_0x18ca74}=_0x5529b3[_0x269724(0x1f2)],_0xd7181c=_0x5529b3[_0x269724(0x1f2)],_0x360b91=await profile[_0x269724(0x196)]({'email':_0xd7181c[_0x269724(0x1aa)]}),_0xdfeaa8=await master_shop[_0x269724(0x246)](),_0x324740=_0x5529b3['params']['id'],_0x196dba=await purchases_finished['findById'](_0x324740);if(_0xdfeaa8[0x0]['language']==_0x269724(0x1d6))var _0x1d4125=users[_0x269724(0x237)];else{if(_0xdfeaa8[0x0][_0x269724(0x218)]=='Hindi')var _0x1d4125=users[_0x269724(0x1e4)];else{if(_0xdfeaa8[0x0][_0x269724(0x218)]==_0x269724(0x255))var _0x1d4125=users[_0x269724(0x255)];else{if(_0xdfeaa8[0x0][_0x269724(0x218)]==_0x269724(0x204))var _0x1d4125=users['Spanish'];else{if(_0xdfeaa8[0x0][_0x269724(0x218)]==_0x269724(0x1a1))var _0x1d4125=users[_0x269724(0x1a1)];else{if(_0xdfeaa8[0x0][_0x269724(0x218)]==_0x269724(0x230))var _0x1d4125=users[_0x269724(0x24a)];else{if(_0xdfeaa8[0x0][_0x269724(0x218)]=='Chinese')var _0x1d4125=users[_0x269724(0x1f7)];else{if(_0xdfeaa8[0x0]['language']==_0x269724(0x241))var _0x1d4125=users[_0x269724(0x191)];}}}}}}}_0x492061[_0x269724(0x229)]('all_purchases_barcode',{'success':_0x5529b3[_0x269724(0x215)](_0x269724(0x174)),'errors':_0x5529b3['flash']('errors'),'role':_0xd7181c,'profile':_0x360b91,'alldata':_0x196dba,'master_shop':_0xdfeaa8,'language':_0x1d4125}),console[_0x269724(0x1ae)](alldata);}catch(_0x34cb0a){console[_0x269724(0x1ae)](_0x34cb0a);}}),router[a0_0x303ae7(0x1f8)](a0_0x303ae7(0x219),async(_0x235ece,_0x49bc45)=>{var _0x2ba1fd=a0_0x303ae7;const {product_code:_0x2d0453}=_0x235ece[_0x2ba1fd(0x18e)];var _0x52a115;const _0x7ef76b=await product[_0x2ba1fd(0x1b3)]([{'$match':{'primary_code':_0x2d0453,'product_category':'Finished\x20Goods'}},{'$group':{'_id':'$_id','name':{'$first':_0x2ba1fd(0x25a)},'category':{'$first':_0x2ba1fd(0x178)},'brand':{'$first':_0x2ba1fd(0x211)},'unit':{'$first':_0x2ba1fd(0x245)},'alertquantity':{'$first':_0x2ba1fd(0x1ac)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2ba1fd(0x213)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x2ba1fd(0x17f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x56a71b=await product['aggregate']([{'$match':{'secondary_code':_0x2d0453}},{'$group':{'_id':'$_id','name':{'$first':_0x2ba1fd(0x25a)},'category':{'$first':_0x2ba1fd(0x178)},'brand':{'$first':_0x2ba1fd(0x211)},'unit':{'$first':_0x2ba1fd(0x245)},'alertquantity':{'$first':_0x2ba1fd(0x1ac)},'product_code':{'$first':_0x2ba1fd(0x198)},'primary_code':{'$first':_0x2ba1fd(0x227)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x2ba1fd(0x256)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2ba1fd(0x265)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x7ef76b[_0x2ba1fd(0x244)]>0x0)_0x52a115=_0x7ef76b;else _0x56a71b['length']>0x0&&(_0x52a115=_0x56a71b);_0x49bc45[_0x2ba1fd(0x1bc)](_0x52a115);}),router[a0_0x303ae7(0x1f8)](a0_0x303ae7(0x21a),async(_0x164080,_0x31b485)=>{var _0x4eddeb=a0_0x303ae7;const {productCode:_0x54ee10,bay:_0x35d630,warehouses:_0xfdd24e,room:_0x5c6816}=_0x164080['body'];console['log'](_0x164080[_0x4eddeb(0x18e)]);try{const _0x2a6d7c=await warehouse[_0x4eddeb(0x1b3)]([{'$match':{'name':_0xfdd24e,'room':_0x5c6816}},{'$unwind':_0x4eddeb(0x22f)},{'$match':{'product_details.bay':parseInt(_0x35d630)}},{'$group':{'_id':_0x4eddeb(0x1ed),'name':{'$first':_0x4eddeb(0x185)},'product_stock':{'$first':_0x4eddeb(0x250)},'bay':{'$first':_0x4eddeb(0x200)},'maxProducts':{'$first':_0x4eddeb(0x1fa)}}}]);_0x31b485[_0x4eddeb(0x22d)](0xc8)[_0x4eddeb(0x1bc)](_0x2a6d7c);}catch(_0x30a9f4){_0x31b485[_0x4eddeb(0x22d)](0x194)[_0x4eddeb(0x1bc)]({'message':_0x30a9f4[_0x4eddeb(0x252)]});}}),module[a0_0x303ae7(0x194)]=router;