const a0_0x283231=a0_0x4fe9;(function(_0x453034,_0xa3a9ed){const _0x1f95f4=a0_0x4fe9,_0x31b084=_0x453034();while(!![]){try{const _0x41e484=-parseInt(_0x1f95f4(0x139))/0x1+parseInt(_0x1f95f4(0x167))/0x2+parseInt(_0x1f95f4(0x156))/0x3*(parseInt(_0x1f95f4(0x11b))/0x4)+-parseInt(_0x1f95f4(0x16b))/0x5*(-parseInt(_0x1f95f4(0x110))/0x6)+-parseInt(_0x1f95f4(0x15a))/0x7*(-parseInt(_0x1f95f4(0x136))/0x8)+-parseInt(_0x1f95f4(0x12a))/0x9*(parseInt(_0x1f95f4(0x120))/0xa)+parseInt(_0x1f95f4(0x10d))/0xb*(-parseInt(_0x1f95f4(0x101))/0xc);if(_0x41e484===_0xa3a9ed)break;else _0x31b084['push'](_0x31b084['shift']());}catch(_0x4257c4){_0x31b084['push'](_0x31b084['shift']());}}}(a0_0x49f3,0x1d984));function a0_0x49f3(){const _0xebad65=['c_payments','diskStorage','save','address','log','write','language','/view/payment/:id','Customers','34320NvxjMQ','utils','\x20Failed','116779esZeUl','user','name','Router','reason','errors','redirect','mobile','/customer_import_migrate_file','German','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','Arabic\x20(ae)','findOne','$amount','$reason','attachment;\x20filename=customer_Migration_File.xlsx','find','addWorksheet','customer_product_fule','customer\x20add\x20successfully','flash','receivable','element','customer','get','readFile','post','SalesmanCode','success','3KFmviz','../middleware/auth','English','map','168nJJfuJ','PUnits','exceljs','French','now','findById','then','Content-Type','params','json','payment_data','file','SalesmanName','368992JVSemk','originalname','contactperson','/view/:id','1082765KaElKQ','amount','sale','xlsx','data','customer_data','payable','3024660nQlqGr','Portuguese\x20(BR)','Chinese','single','public/Migration/','body','sheet_to_json','columns','../public/language/languages.json','forEach','status','customer_payment','11pGBAex','Arabic','English\x20(US)','6CuInLC','render','error','landline','public/Migration','customer_docs','customer\x20update\x20successfully','setHeader','/customer/view','master','email','810868XbwiFj','filename','aggregate','/products_export_migrate_file','receivable_sum','270840NVJQYa','message','Sale','Spanish','Hindi','\x20added\x20successfully','PBrands','/view','payable_sum','Name','72DiRqAI','Workbook','Portuguese'];a0_0x49f3=function(){return _0xebad65;};return a0_0x49f3();}const express=require('express'),app=express(),router=express[a0_0x283231(0x13c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x283231(0x157)),users=require(a0_0x283231(0x109)),excelJS=require(a0_0x283231(0x15c)),xlsx=require(a0_0x283231(0xfd)),multer=require('multer');router[a0_0x283231(0x151)](a0_0x283231(0x127),auth,async(_0xe2ff6d,_0x469568)=>{const _0x2b9344=a0_0x283231;try{const {username:_0x41b09c,email:_0x3399dc,role:_0x23de49}=_0xe2ff6d[_0x2b9344(0x13a)],_0x211143=_0xe2ff6d[_0x2b9344(0x13a)],_0x2b575d=await profile['findOne']({'email':_0x211143['email']}),_0x3c9b10=await master_shop[_0x2b9344(0x149)]();console[_0x2b9344(0x131)](_0x2b9344(0x119),_0x3c9b10);const _0xe961b0=await customer[_0x2b9344(0x149)](),_0x2badba=await customer[_0x2b9344(0x11d)]([{'$lookup':{'from':_0x2b9344(0x12d),'localField':'name','foreignField':_0x2b9344(0x150),'as':_0x2b9344(0x115)}}]);console[_0x2b9344(0x131)](_0x2badba);const _0x552ba7=_0x2badba[_0x2b9344(0x159)](_0x30b729=>{const _0x559a5d=_0x2b9344;console[_0x559a5d(0x131)](_0x559a5d(0xfe),_0x30b729);var _0x5cba01=0x0,_0x3fa09b=0x0;return _0x30b729[_0x559a5d(0x115)][_0x559a5d(0x10a)](_0x568f8b=>{const _0x256051=_0x559a5d;console[_0x256051(0x131)](_0x256051(0x14f),_0x568f8b),_0x568f8b[_0x256051(0x13d)]=='Sale'?_0x5cba01+=_0x568f8b['amount']:_0x3fa09b+=_0x568f8b[_0x256051(0xfb)];}),_0x30b729[_0x559a5d(0xfc)]=parseFloat(_0x5cba01)+0x0,_0x30b729['sale_return']=parseFloat(_0x3fa09b)+0x0,_0x30b729;});console['log'](_0x2b9344(0x164),_0x552ba7);if(_0x3c9b10[0x0][_0x2b9344(0x133)]==_0x2b9344(0x10f)){var _0x49750=users['English'];console['log'](_0x49750);}else{if(_0x3c9b10[0x0][_0x2b9344(0x133)]==_0x2b9344(0x124))var _0x49750=users['Hindi'];else{if(_0x3c9b10[0x0][_0x2b9344(0x133)]==_0x2b9344(0x142))var _0x49750=users['German'];else{if(_0x3c9b10[0x0][_0x2b9344(0x133)]==_0x2b9344(0x123))var _0x49750=users[_0x2b9344(0x123)];else{if(_0x3c9b10[0x0][_0x2b9344(0x133)]==_0x2b9344(0x15d))var _0x49750=users['French'];else{if(_0x3c9b10[0x0][_0x2b9344(0x133)]=='Portuguese\x20(BR)')var _0x49750=users[_0x2b9344(0x12c)];else{if(_0x3c9b10[0x0]['language']=='Chinese')var _0x49750=users[_0x2b9344(0x103)];else{if(_0x3c9b10[0x0][_0x2b9344(0x133)]==_0x2b9344(0x144))var _0x49750=users['Arabic'];}}}}}}}_0x469568[_0x2b9344(0x111)](_0x2b9344(0x150),{'success':_0xe2ff6d[_0x2b9344(0x14d)](_0x2b9344(0x155)),'errors':_0xe2ff6d[_0x2b9344(0x14d)](_0x2b9344(0x13e)),'user':_0xe961b0,'role':_0x211143,'profile':_0x2b575d,'payment':_0x552ba7,'master_shop':_0x3c9b10,'language':_0x49750});}catch(_0x312f89){console[_0x2b9344(0x131)](_0x312f89);}}),router['post'](a0_0x283231(0x127),auth,async(_0x48693a,_0x5a52c8)=>{const _0xd3f10b=a0_0x283231;try{const {name:_0x4e711f,address:_0x4751e0,mobile:_0x15ffe,email:_0x33d855,receivable:_0x4e6d11,payable:_0x169609,contactperson:_0x165b81,landline:_0x246b65}=_0x48693a[_0xd3f10b(0x106)],_0x4e8bd2=new customer({'name':_0x4e711f,'address':_0x4751e0,'mobile':_0x15ffe,'email':_0x33d855,'receivable':_0x4e6d11,'payable':_0x169609,'contactperson':_0x165b81,'landline':_0x246b65}),_0x4fb12c=await _0x4e8bd2[_0xd3f10b(0x12f)]();_0x48693a['flash']('success',_0xd3f10b(0x14c)),_0x5a52c8['redirect'](_0xd3f10b(0x118));}catch(_0x3bfd47){console[_0xd3f10b(0x131)](_0x3bfd47);}}),router[a0_0x283231(0x151)](a0_0x283231(0x16a),auth,async(_0x5fddc6,_0xbfab2b)=>{const _0x3c4f4f=a0_0x283231;try{const {username:_0x4f8def,email:_0x4f87fb,role:_0x48820e}=_0x5fddc6['user'],_0x13347e=_0x5fddc6[_0x3c4f4f(0x13a)],_0x407647=await profile[_0x3c4f4f(0x145)]({'email':_0x13347e[_0x3c4f4f(0x11a)]}),_0x2f4b0f=await master_shop['find']();console[_0x3c4f4f(0x131)](_0x3c4f4f(0x119),_0x2f4b0f);const _0x29b938=_0x5fddc6[_0x3c4f4f(0x162)]['id'],_0x3ae61b=await customer[_0x3c4f4f(0x15f)](_0x29b938);if(_0x2f4b0f[0x0][_0x3c4f4f(0x133)]=='English\x20(US)'){var _0x21e958=users[_0x3c4f4f(0x158)];console['log'](_0x21e958);}else{if(_0x2f4b0f[0x0][_0x3c4f4f(0x133)]==_0x3c4f4f(0x124))var _0x21e958=users[_0x3c4f4f(0x124)];else{if(_0x2f4b0f[0x0][_0x3c4f4f(0x133)]==_0x3c4f4f(0x142))var _0x21e958=users[_0x3c4f4f(0x142)];else{if(_0x2f4b0f[0x0][_0x3c4f4f(0x133)]==_0x3c4f4f(0x123))var _0x21e958=users[_0x3c4f4f(0x123)];else{if(_0x2f4b0f[0x0][_0x3c4f4f(0x133)]==_0x3c4f4f(0x15d))var _0x21e958=users[_0x3c4f4f(0x15d)];else{if(_0x2f4b0f[0x0]['language']==_0x3c4f4f(0x102))var _0x21e958=users[_0x3c4f4f(0x12c)];else{if(_0x2f4b0f[0x0][_0x3c4f4f(0x133)]==_0x3c4f4f(0x103))var _0x21e958=users[_0x3c4f4f(0x103)];else{if(_0x2f4b0f[0x0][_0x3c4f4f(0x133)]=='Arabic\x20(ae)')var _0x21e958=users[_0x3c4f4f(0x10e)];}}}}}}}_0xbfab2b[_0x3c4f4f(0x111)]('customer',{'success':_0x5fddc6[_0x3c4f4f(0x14d)](_0x3c4f4f(0x155)),'errors':_0x5fddc6[_0x3c4f4f(0x14d)]('errors'),'role':_0x13347e,'profile':_0x407647,'user':_0x3ae61b,'master_shop':_0x2f4b0f,'language':_0x21e958});}catch(_0x5b9340){console[_0x3c4f4f(0x131)](_0x5b9340);}}),router[a0_0x283231(0x153)](a0_0x283231(0x16a),auth,async(_0x11de0f,_0x2b6caa)=>{const _0x43bf5c=a0_0x283231;try{const _0x369bc0=_0x11de0f['params']['id'],_0x3dc3ad=await customer[_0x43bf5c(0x15f)](_0x369bc0),{name:_0x106976,address:_0x33bbba,mobile:_0x44e976,email:_0x11af23,receivable:_0x5daa85,payable:_0x21d643,contactperson:_0x15af66,landline:_0xf10ef0}=_0x11de0f['body'];_0x3dc3ad[_0x43bf5c(0x13b)]=_0x106976,_0x3dc3ad[_0x43bf5c(0x130)]=_0x33bbba,_0x3dc3ad['mobile']=_0x44e976,_0x3dc3ad[_0x43bf5c(0x11a)]=_0x11af23,_0x3dc3ad[_0x43bf5c(0x14e)]=_0x5daa85,_0x3dc3ad[_0x43bf5c(0x100)]=_0x21d643,_0x3dc3ad[_0x43bf5c(0x169)]=_0x15af66,_0x3dc3ad[_0x43bf5c(0x113)]=_0xf10ef0;const _0x95a6e9=await _0x3dc3ad['save']();_0x11de0f['flash'](_0x43bf5c(0x155),_0x43bf5c(0x116)),_0x2b6caa['redirect'](_0x43bf5c(0x118));}catch(_0x413d44){console[_0x43bf5c(0x131)](_0x413d44);}}),router[a0_0x283231(0x151)](a0_0x283231(0x134),auth,async(_0x10faf8,_0x33e189)=>{const _0x3fdbb5=a0_0x283231;try{const {username:_0x274c96,email:_0x345c89,role:_0x3cd16a}=_0x10faf8['user'],_0xf900a=_0x10faf8[_0x3fdbb5(0x13a)],_0x209357=await profile['findOne']({'email':_0xf900a[_0x3fdbb5(0x11a)]}),_0x1d72d7=await master_shop[_0x3fdbb5(0x149)]();console[_0x3fdbb5(0x131)](_0x3fdbb5(0x119),_0x1d72d7),console[_0x3fdbb5(0x131)](_0x10faf8[_0x3fdbb5(0x162)]['id']);const _0x1e136f=await customer[_0x3fdbb5(0x145)]({'_id':_0x10faf8[_0x3fdbb5(0x162)]['id']});console['log'](_0x3fdbb5(0xff),_0x1e136f);const _0x2dff90=await c_payment_data['find']({'customer':_0x1e136f['name']});console[_0x3fdbb5(0x131)](_0x2dff90);const _0x5dff6b=await c_payment_data[_0x3fdbb5(0x11d)]([{'$match':{'customer':_0x1e136f[_0x3fdbb5(0x13b)]}},{'$match':{'reason':_0x3fdbb5(0x122)}},{'$group':{'_id':_0x3fdbb5(0x147),'sum':{'$sum':_0x3fdbb5(0x146)}}}]);console[_0x3fdbb5(0x131)](_0x3fdbb5(0x128),_0x5dff6b);const _0x4bac8e=await c_payment_data['aggregate']([{'$match':{'customer':_0x1e136f[_0x3fdbb5(0x13b)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x3fdbb5(0x147),'sum':{'$sum':'$amount'}}}]);console['log'](_0x3fdbb5(0x11f),_0x4bac8e);if(_0x1d72d7[0x0][_0x3fdbb5(0x133)]==_0x3fdbb5(0x10f)){var _0x1ce4da=users[_0x3fdbb5(0x158)];console[_0x3fdbb5(0x131)](_0x1ce4da);}else{if(_0x1d72d7[0x0][_0x3fdbb5(0x133)]==_0x3fdbb5(0x124))var _0x1ce4da=users[_0x3fdbb5(0x124)];else{if(_0x1d72d7[0x0][_0x3fdbb5(0x133)]==_0x3fdbb5(0x142))var _0x1ce4da=users['German'];else{if(_0x1d72d7[0x0][_0x3fdbb5(0x133)]=='Spanish')var _0x1ce4da=users[_0x3fdbb5(0x123)];else{if(_0x1d72d7[0x0][_0x3fdbb5(0x133)]==_0x3fdbb5(0x15d))var _0x1ce4da=users[_0x3fdbb5(0x15d)];else{if(_0x1d72d7[0x0][_0x3fdbb5(0x133)]==_0x3fdbb5(0x102))var _0x1ce4da=users[_0x3fdbb5(0x12c)];else{if(_0x1d72d7[0x0][_0x3fdbb5(0x133)]==_0x3fdbb5(0x103))var _0x1ce4da=users[_0x3fdbb5(0x103)];else{if(_0x1d72d7[0x0][_0x3fdbb5(0x133)]==_0x3fdbb5(0x144))var _0x1ce4da=users[_0x3fdbb5(0x10e)];}}}}}}}_0x33e189[_0x3fdbb5(0x111)](_0x3fdbb5(0x10c),{'success':_0x10faf8[_0x3fdbb5(0x14d)](_0x3fdbb5(0x155)),'errors':_0x10faf8[_0x3fdbb5(0x14d)](_0x3fdbb5(0x13e)),'role':_0xf900a,'profile':_0x209357,'payment':_0x2dff90,'payable':_0x5dff6b,'receivable':_0x4bac8e,'master_shop':_0x1d72d7,'language':_0x1ce4da});}catch(_0x661c3c){console[_0x3fdbb5(0x131)](_0x661c3c);}}),router['get'](a0_0x283231(0x11e),auth,async(_0x299a33,_0x2a640e)=>{const _0x3a30da=a0_0x283231;try{const _0xc9f66f=new excelJS[(_0x3a30da(0x12b))](),_0x208b0b=_0xc9f66f[_0x3a30da(0x14a)](_0x3a30da(0x135));return _0x208b0b[_0x3a30da(0x108)]=[{'header':'ID','key':'PName','width':0xa},{'header':'Name','key':_0x3a30da(0x126),'width':0xa},{'header':_0x3a30da(0x154),'key':_0x3a30da(0x15b),'width':0xa},{'header':_0x3a30da(0x166),'key':_0x3a30da(0x166),'width':0xa},{'header':_0x3a30da(0x130),'key':'address','width':0xa},{'header':_0x3a30da(0x140),'key':_0x3a30da(0x140),'width':0xa},{'header':_0x3a30da(0x11a),'key':_0x3a30da(0x11a),'width':0xa}],_0x2a640e[_0x3a30da(0x117)](_0x3a30da(0x161),_0x3a30da(0x143)),_0x2a640e['setHeader']('Content-Disposition',_0x3a30da(0x148)),_0xc9f66f[_0x3a30da(0xfd)][_0x3a30da(0x132)](_0x2a640e)[_0x3a30da(0x160)](()=>{const _0xcb8581=_0x3a30da;_0x2a640e[_0xcb8581(0x10b)](0xc8);});}catch(_0xd5ab01){_0x2a640e['status'](0x190)['send']({'errors':_0xd5ab01['message']});}});function a0_0x4fe9(_0xa6f48c,_0x1252a9){const _0x49f3b9=a0_0x49f3();return a0_0x4fe9=function(_0x4fe9aa,_0x488c9f){_0x4fe9aa=_0x4fe9aa-0xfb;let _0x3c3731=_0x49f3b9[_0x4fe9aa];return _0x3c3731;},a0_0x4fe9(_0xa6f48c,_0x1252a9);}const storage1=multer[a0_0x283231(0x12e)]({'destination':(_0x30efbf,_0xb79e94,_0x1df933)=>{const _0x57e468=a0_0x283231;_0x1df933(null,_0x57e468(0x114));},'filename':(_0x21654c,_0x423c0f,_0x3d2b1f)=>{const _0xd59268=a0_0x283231;_0x3d2b1f(null,Date[_0xd59268(0x15e)]()+_0x423c0f[_0xd59268(0x168)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x283231(0x153)](a0_0x283231(0x141),auth,uploadMigrate[a0_0x283231(0x104)](a0_0x283231(0x14b)),async(_0x16c806,_0x24c451)=>{const _0x325fdc=a0_0x283231,_0x48501f=_0x16c806[_0x325fdc(0x165)][_0x325fdc(0x11c)],_0x3e514b=await xlsx[_0x325fdc(0x152)](_0x325fdc(0x105)+_0x48501f);let _0xd04f46=_0x3e514b['SheetNames'],_0x54cdee=xlsx[_0x325fdc(0x137)][_0x325fdc(0x107)](_0x3e514b['Sheets'][_0xd04f46[0x0]]);for(const _0x245ba6 of _0x54cdee){const _0x20bda5=_0x245ba6['ID'],_0x376151=_0x245ba6[_0x325fdc(0x129)],_0x418e05=_0x245ba6[_0x325fdc(0x154)],_0x2e2e5b=_0x245ba6['SalesmanName'],_0x33a0cc=_0x245ba6[_0x325fdc(0x130)],_0x494ae0=_0x245ba6['mobile'],_0x613d2a=_0x245ba6[_0x325fdc(0x11a)];try{let _0xd7d57b=await customer['findOne']({'name':_0x376151});if(!_0xd7d57b){const _0x5ac62a=new customer({'name':_0x376151,'ID':_0x20bda5,'SalesmanCode':_0x418e05,'SalesmanName':_0x2e2e5b,'address':_0x33a0cc,'mobile':_0x494ae0,'email':_0x613d2a});_0xd7d57b=await _0x5ac62a['save'](),_0x16c806['flash']('success',_0x376151+_0x325fdc(0x125));}else _0x16c806[_0x325fdc(0x14d)](_0x325fdc(0x112),_0x376151+_0x325fdc(0x138));}catch(_0x10e1fb){_0x24c451[_0x325fdc(0x10b)](0x1f4)[_0x325fdc(0x163)]({'proderror':_0x10e1fb[_0x325fdc(0x121)],'aproduct':ProductName});}}_0x24c451[_0x325fdc(0x13f)](_0x325fdc(0x118));}),module['exports']=router;