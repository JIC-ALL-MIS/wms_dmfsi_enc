const a0_0x46c131=a0_0x400a;function a0_0x231e(){const _0x58eb83=['Arabic','Router','English\x20(US)','Hindi','../middleware/auth','readFile','Portuguese','mobile','flash','setHeader','10yCqdDW','714084AMTTXN','3088ZxXmKs','file','save','customer_payment','945BlzatM','then','element','findById','$amount','German','Arabic\x20(ae)','sale','English','75283bJxDOA','Customers','customer','master','params','30BlqijT','json','addWorksheet','French','sheet_to_json','get','utils','contactperson','success','name','xlsx','find','public/Migration/','/view/payment/:id','email','originalname','receivable_sum','$reason','\x20added\x20successfully','aggregate','10668141vkyWkF','attachment;\x20filename=customer_Migration_File.xlsx','multer','Sale','single','Portuguese\x20(BR)','log','error','send','exceljs','findOne','body','PBrands','columns','payable','Chinese','write','language','1446164ANvtla','redirect','/products_export_migrate_file','/customer/view','Content-Type','Spanish','Name','public/Migration','now','exports','2044MtEHnJ','reason','diskStorage','post','Sale\x20Return','Sheets','filename','customer\x20update\x20successfully','3253230LrpQEg','address','message','SalesmanName','customer_product_fule','customer_docs','/view','/view/:id','SalesmanCode','payable_sum','customer\x20add\x20successfully','errors','/customer_import_migrate_file','render','3UyTucU','Workbook','c_payments','receivable','../models/all_models','customer_data','user','status'];a0_0x231e=function(){return _0x58eb83;};return a0_0x231e();}(function(_0x5760e3,_0x26285f){const _0x3ecab5=a0_0x400a,_0x3751ca=_0x5760e3();while(!![]){try{const _0x5488c9=parseInt(_0x3ecab5(0x210))/0x1*(-parseInt(_0x3ecab5(0x201))/0x2)+parseInt(_0x3ecab5(0x1ef))/0x3*(parseInt(_0x3ecab5(0x1cf))/0x4)+parseInt(_0x3ecab5(0x215))/0x5*(-parseInt(_0x3ecab5(0x202))/0x6)+-parseInt(_0x3ecab5(0x1d9))/0x7+-parseInt(_0x3ecab5(0x203))/0x8*(parseInt(_0x3ecab5(0x207))/0x9)+parseInt(_0x3ecab5(0x1e1))/0xa+parseInt(_0x3ecab5(0x1bd))/0xb;if(_0x5488c9===_0x26285f)break;else _0x3751ca['push'](_0x3751ca['shift']());}catch(_0xc5d3f8){_0x3751ca['push'](_0x3751ca['shift']());}}}(a0_0x231e,0x8043e));const express=require('express'),app=express(),router=express[a0_0x46c131(0x1f8)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x46c131(0x1f3)),auth=require(a0_0x46c131(0x1fb)),users=require('../public/language/languages.json'),excelJS=require(a0_0x46c131(0x1c6)),xlsx=require(a0_0x46c131(0x1b3)),multer=require(a0_0x46c131(0x1bf));function a0_0x400a(_0x6ac7bc,_0x11ca52){const _0x231edf=a0_0x231e();return a0_0x400a=function(_0x400aa8,_0x2290c8){_0x400aa8=_0x400aa8-0x1ac;let _0x89df44=_0x231edf[_0x400aa8];return _0x89df44;},a0_0x400a(_0x6ac7bc,_0x11ca52);}router[a0_0x46c131(0x1ae)](a0_0x46c131(0x1e7),auth,async(_0x2e201d,_0xda8e4)=>{const _0xb95003=a0_0x46c131;try{const {username:_0x539ac8,email:_0x286012,role:_0x4c3bd9}=_0x2e201d[_0xb95003(0x1f5)],_0x5551dd=_0x2e201d[_0xb95003(0x1f5)],_0x2e2da7=await profile['findOne']({'email':_0x5551dd[_0xb95003(0x1b7)]}),_0x24a5ea=await master_shop['find']();console[_0xb95003(0x1c3)](_0xb95003(0x213),_0x24a5ea);const _0x1a5230=await customer[_0xb95003(0x1b4)](),_0x307682=await customer[_0xb95003(0x1bc)]([{'$lookup':{'from':_0xb95003(0x1f1),'localField':_0xb95003(0x1b2),'foreignField':_0xb95003(0x212),'as':'customer_docs'}}]);console['log'](_0x307682);const _0x2bcf23=_0x307682['map'](_0x3cca6b=>{const _0x212b5a=_0xb95003;console['log']('data',_0x3cca6b);var _0x3972d4=0x0,_0x1e356f=0x0;return _0x3cca6b[_0x212b5a(0x1e6)]['forEach'](_0x6ab9fb=>{const _0x127247=_0x212b5a;console[_0x127247(0x1c3)](_0x127247(0x209),_0x6ab9fb),_0x6ab9fb[_0x127247(0x1da)]==_0x127247(0x1c0)?_0x3972d4+=_0x6ab9fb['amount']:_0x1e356f+=_0x6ab9fb['amount'];}),_0x3cca6b[_0x212b5a(0x20e)]=parseFloat(_0x3972d4)+0x0,_0x3cca6b['sale_return']=parseFloat(_0x1e356f)+0x0,_0x3cca6b;});console[_0xb95003(0x1c3)]('payment_data',_0x2bcf23);if(_0x24a5ea[0x0][_0xb95003(0x1ce)]==_0xb95003(0x1f9)){var _0x41dee3=users[_0xb95003(0x20f)];console['log'](_0x41dee3);}else{if(_0x24a5ea[0x0][_0xb95003(0x1ce)]=='Hindi')var _0x41dee3=users[_0xb95003(0x1fa)];else{if(_0x24a5ea[0x0][_0xb95003(0x1ce)]=='German')var _0x41dee3=users['German'];else{if(_0x24a5ea[0x0][_0xb95003(0x1ce)]==_0xb95003(0x1d4))var _0x41dee3=users[_0xb95003(0x1d4)];else{if(_0x24a5ea[0x0][_0xb95003(0x1ce)]==_0xb95003(0x1ac))var _0x41dee3=users['French'];else{if(_0x24a5ea[0x0][_0xb95003(0x1ce)]=='Portuguese\x20(BR)')var _0x41dee3=users['Portuguese'];else{if(_0x24a5ea[0x0]['language']==_0xb95003(0x1cc))var _0x41dee3=users[_0xb95003(0x1cc)];else{if(_0x24a5ea[0x0][_0xb95003(0x1ce)]==_0xb95003(0x20d))var _0x41dee3=users[_0xb95003(0x1f7)];}}}}}}}_0xda8e4[_0xb95003(0x1ee)](_0xb95003(0x212),{'success':_0x2e201d[_0xb95003(0x1ff)](_0xb95003(0x1b1)),'errors':_0x2e201d['flash'](_0xb95003(0x1ec)),'user':_0x1a5230,'role':_0x5551dd,'profile':_0x2e2da7,'payment':_0x2bcf23,'master_shop':_0x24a5ea,'language':_0x41dee3});}catch(_0x3d1469){console[_0xb95003(0x1c3)](_0x3d1469);}}),router['post'](a0_0x46c131(0x1e7),auth,async(_0x364795,_0x4dd871)=>{const _0x53f5f4=a0_0x46c131;try{const {name:_0x2e821d,address:_0x127a5b,mobile:_0x48dd97,email:_0x1c8ec8,receivable:_0x53c4fc,payable:_0x1743d7,contactperson:_0x10df14,landline:_0xd11963}=_0x364795[_0x53f5f4(0x1c8)],_0x36415d=new customer({'name':_0x2e821d,'address':_0x127a5b,'mobile':_0x48dd97,'email':_0x1c8ec8,'receivable':_0x53c4fc,'payable':_0x1743d7,'contactperson':_0x10df14,'landline':_0xd11963}),_0x52bb72=await _0x36415d[_0x53f5f4(0x205)]();_0x364795[_0x53f5f4(0x1ff)]('success',_0x53f5f4(0x1eb)),_0x4dd871[_0x53f5f4(0x1d0)](_0x53f5f4(0x1d2));}catch(_0x150f5a){console[_0x53f5f4(0x1c3)](_0x150f5a);}}),router[a0_0x46c131(0x1ae)](a0_0x46c131(0x1e8),auth,async(_0x41f5b7,_0x3c2656)=>{const _0x542d27=a0_0x46c131;try{const {username:_0xfeadbb,email:_0x2d98cd,role:_0x4a77f4}=_0x41f5b7[_0x542d27(0x1f5)],_0x1da854=_0x41f5b7[_0x542d27(0x1f5)],_0x4ca10f=await profile[_0x542d27(0x1c7)]({'email':_0x1da854[_0x542d27(0x1b7)]}),_0x572219=await master_shop[_0x542d27(0x1b4)]();console[_0x542d27(0x1c3)](_0x542d27(0x213),_0x572219);const _0xbd5e3d=_0x41f5b7[_0x542d27(0x214)]['id'],_0x32765e=await customer[_0x542d27(0x20a)](_0xbd5e3d);if(_0x572219[0x0][_0x542d27(0x1ce)]==_0x542d27(0x1f9)){var _0x194ea2=users[_0x542d27(0x20f)];console['log'](_0x194ea2);}else{if(_0x572219[0x0][_0x542d27(0x1ce)]==_0x542d27(0x1fa))var _0x194ea2=users[_0x542d27(0x1fa)];else{if(_0x572219[0x0][_0x542d27(0x1ce)]=='German')var _0x194ea2=users[_0x542d27(0x20c)];else{if(_0x572219[0x0][_0x542d27(0x1ce)]=='Spanish')var _0x194ea2=users[_0x542d27(0x1d4)];else{if(_0x572219[0x0][_0x542d27(0x1ce)]==_0x542d27(0x1ac))var _0x194ea2=users[_0x542d27(0x1ac)];else{if(_0x572219[0x0][_0x542d27(0x1ce)]==_0x542d27(0x1c2))var _0x194ea2=users[_0x542d27(0x1fd)];else{if(_0x572219[0x0][_0x542d27(0x1ce)]==_0x542d27(0x1cc))var _0x194ea2=users[_0x542d27(0x1cc)];else{if(_0x572219[0x0][_0x542d27(0x1ce)]==_0x542d27(0x20d))var _0x194ea2=users[_0x542d27(0x1f7)];}}}}}}}_0x3c2656[_0x542d27(0x1ee)](_0x542d27(0x212),{'success':_0x41f5b7[_0x542d27(0x1ff)](_0x542d27(0x1b1)),'errors':_0x41f5b7[_0x542d27(0x1ff)](_0x542d27(0x1ec)),'role':_0x1da854,'profile':_0x4ca10f,'user':_0x32765e,'master_shop':_0x572219,'language':_0x194ea2});}catch(_0x3896f5){console[_0x542d27(0x1c3)](_0x3896f5);}}),router['post'](a0_0x46c131(0x1e8),auth,async(_0x34b875,_0x19ff6c)=>{const _0x274670=a0_0x46c131;try{const _0x71345b=_0x34b875[_0x274670(0x214)]['id'],_0xc39fde=await customer[_0x274670(0x20a)](_0x71345b),{name:_0x1f59f3,address:_0x3ced57,mobile:_0x569190,email:_0x24f147,receivable:_0x37388d,payable:_0x13960f,contactperson:_0x1224ef,landline:_0xf3a9c6}=_0x34b875[_0x274670(0x1c8)];_0xc39fde['name']=_0x1f59f3,_0xc39fde[_0x274670(0x1e2)]=_0x3ced57,_0xc39fde[_0x274670(0x1fe)]=_0x569190,_0xc39fde[_0x274670(0x1b7)]=_0x24f147,_0xc39fde[_0x274670(0x1f2)]=_0x37388d,_0xc39fde[_0x274670(0x1cb)]=_0x13960f,_0xc39fde[_0x274670(0x1b0)]=_0x1224ef,_0xc39fde['landline']=_0xf3a9c6;const _0x3f72bc=await _0xc39fde[_0x274670(0x205)]();_0x34b875[_0x274670(0x1ff)](_0x274670(0x1b1),_0x274670(0x1e0)),_0x19ff6c[_0x274670(0x1d0)](_0x274670(0x1d2));}catch(_0x20c02d){console['log'](_0x20c02d);}}),router[a0_0x46c131(0x1ae)](a0_0x46c131(0x1b6),auth,async(_0x1539cd,_0x1fb597)=>{const _0x268e11=a0_0x46c131;try{const {username:_0x2a21c4,email:_0xd62bd8,role:_0x381a43}=_0x1539cd['user'],_0x58c89b=_0x1539cd[_0x268e11(0x1f5)],_0xf6f370=await profile[_0x268e11(0x1c7)]({'email':_0x58c89b[_0x268e11(0x1b7)]}),_0x4be004=await master_shop[_0x268e11(0x1b4)]();console['log'](_0x268e11(0x213),_0x4be004),console[_0x268e11(0x1c3)](_0x1539cd[_0x268e11(0x214)]['id']);const _0x43ad72=await customer[_0x268e11(0x1c7)]({'_id':_0x1539cd[_0x268e11(0x214)]['id']});console[_0x268e11(0x1c3)](_0x268e11(0x1f4),_0x43ad72);const _0x24319a=await c_payment_data['find']({'customer':_0x43ad72['name']});console[_0x268e11(0x1c3)](_0x24319a);const _0x395f3c=await c_payment_data[_0x268e11(0x1bc)]([{'$match':{'customer':_0x43ad72[_0x268e11(0x1b2)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x268e11(0x20b)}}}]);console[_0x268e11(0x1c3)](_0x268e11(0x1ea),_0x395f3c);const _0x92da40=await c_payment_data[_0x268e11(0x1bc)]([{'$match':{'customer':_0x43ad72['name']}},{'$match':{'reason':_0x268e11(0x1dd)}},{'$group':{'_id':_0x268e11(0x1ba),'sum':{'$sum':'$amount'}}}]);console[_0x268e11(0x1c3)](_0x268e11(0x1b9),_0x92da40);if(_0x4be004[0x0][_0x268e11(0x1ce)]=='English\x20(US)'){var _0x26e507=users[_0x268e11(0x20f)];console[_0x268e11(0x1c3)](_0x26e507);}else{if(_0x4be004[0x0][_0x268e11(0x1ce)]=='Hindi')var _0x26e507=users[_0x268e11(0x1fa)];else{if(_0x4be004[0x0][_0x268e11(0x1ce)]=='German')var _0x26e507=users['German'];else{if(_0x4be004[0x0][_0x268e11(0x1ce)]==_0x268e11(0x1d4))var _0x26e507=users[_0x268e11(0x1d4)];else{if(_0x4be004[0x0][_0x268e11(0x1ce)]==_0x268e11(0x1ac))var _0x26e507=users[_0x268e11(0x1ac)];else{if(_0x4be004[0x0][_0x268e11(0x1ce)]==_0x268e11(0x1c2))var _0x26e507=users[_0x268e11(0x1fd)];else{if(_0x4be004[0x0][_0x268e11(0x1ce)]==_0x268e11(0x1cc))var _0x26e507=users[_0x268e11(0x1cc)];else{if(_0x4be004[0x0][_0x268e11(0x1ce)]==_0x268e11(0x20d))var _0x26e507=users[_0x268e11(0x1f7)];}}}}}}}_0x1fb597['render'](_0x268e11(0x206),{'success':_0x1539cd[_0x268e11(0x1ff)]('success'),'errors':_0x1539cd[_0x268e11(0x1ff)]('errors'),'role':_0x58c89b,'profile':_0xf6f370,'payment':_0x24319a,'payable':_0x395f3c,'receivable':_0x92da40,'master_shop':_0x4be004,'language':_0x26e507});}catch(_0x45ed50){console['log'](_0x45ed50);}}),router[a0_0x46c131(0x1ae)](a0_0x46c131(0x1d1),auth,async(_0x435019,_0x4c7c71)=>{const _0x500d96=a0_0x46c131;try{const _0x37d2e4=new excelJS[(_0x500d96(0x1f0))](),_0x579dbf=_0x37d2e4[_0x500d96(0x217)](_0x500d96(0x211));return _0x579dbf[_0x500d96(0x1ca)]=[{'header':'ID','key':'PName','width':0xa},{'header':_0x500d96(0x1d5),'key':_0x500d96(0x1c9),'width':0xa},{'header':_0x500d96(0x1e9),'key':'PUnits','width':0xa},{'header':_0x500d96(0x1e4),'key':_0x500d96(0x1e4),'width':0xa},{'header':'address','key':'address','width':0xa},{'header':_0x500d96(0x1fe),'key':_0x500d96(0x1fe),'width':0xa},{'header':_0x500d96(0x1b7),'key':_0x500d96(0x1b7),'width':0xa}],_0x4c7c71[_0x500d96(0x200)](_0x500d96(0x1d3),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x4c7c71[_0x500d96(0x200)]('Content-Disposition',_0x500d96(0x1be)),_0x37d2e4['xlsx'][_0x500d96(0x1cd)](_0x4c7c71)[_0x500d96(0x208)](()=>{const _0x43b138=_0x500d96;_0x4c7c71[_0x43b138(0x1f6)](0xc8);});}catch(_0x366832){_0x4c7c71[_0x500d96(0x1f6)](0x190)[_0x500d96(0x1c5)]({'errors':_0x366832[_0x500d96(0x1e3)]});}});const storage1=multer[a0_0x46c131(0x1db)]({'destination':(_0x18fa33,_0x5619c8,_0x5e2766)=>{const _0x105cd4=a0_0x46c131;_0x5e2766(null,_0x105cd4(0x1d6));},'filename':(_0x26850a,_0x35e1b5,_0x1648cc)=>{const _0x3033b2=a0_0x46c131;_0x1648cc(null,Date[_0x3033b2(0x1d7)]()+_0x35e1b5[_0x3033b2(0x1b8)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x46c131(0x1dc)](a0_0x46c131(0x1ed),auth,uploadMigrate[a0_0x46c131(0x1c1)](a0_0x46c131(0x1e5)),async(_0x363619,_0x33416d)=>{const _0x39bc79=a0_0x46c131,_0x175aa4=_0x363619[_0x39bc79(0x204)][_0x39bc79(0x1df)],_0x557552=await xlsx[_0x39bc79(0x1fc)](_0x39bc79(0x1b5)+_0x175aa4);let _0x3db8d5=_0x557552['SheetNames'],_0x524787=xlsx[_0x39bc79(0x1af)][_0x39bc79(0x1ad)](_0x557552[_0x39bc79(0x1de)][_0x3db8d5[0x0]]);for(const _0x438a1a of _0x524787){const _0x4def0d=_0x438a1a['ID'],_0x2004be=_0x438a1a['Name'],_0x5b92ff=_0x438a1a[_0x39bc79(0x1e9)],_0x389249=_0x438a1a[_0x39bc79(0x1e4)],_0x12b0a3=_0x438a1a[_0x39bc79(0x1e2)],_0x1e464a=_0x438a1a['mobile'],_0x57662e=_0x438a1a[_0x39bc79(0x1b7)];try{let _0x202913=await customer['findOne']({'name':_0x2004be});if(!_0x202913){const _0x3a2be0=new customer({'name':_0x2004be,'ID':_0x4def0d,'SalesmanCode':_0x5b92ff,'SalesmanName':_0x389249,'address':_0x12b0a3,'mobile':_0x1e464a,'email':_0x57662e});_0x202913=await _0x3a2be0[_0x39bc79(0x205)](),_0x363619[_0x39bc79(0x1ff)](_0x39bc79(0x1b1),_0x2004be+_0x39bc79(0x1bb));}else _0x363619[_0x39bc79(0x1ff)](_0x39bc79(0x1c4),_0x2004be+'\x20Failed');}catch(_0x209280){_0x33416d[_0x39bc79(0x1f6)](0x1f4)[_0x39bc79(0x216)]({'proderror':_0x209280[_0x39bc79(0x1e3)],'aproduct':ProductName});}}_0x33416d[_0x39bc79(0x1d0)]('/customer/view');}),module[a0_0x46c131(0x1d8)]=router;