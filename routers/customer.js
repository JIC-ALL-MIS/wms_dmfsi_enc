const a0_0x2f4151=a0_0x25a0;function a0_0x2bb7(){const _0x58aedf=['save','Portuguese\x20(BR)','amount','$reason','addWorksheet','Portuguese','setHeader','message','/view/payment/:id','customer\x20add\x20successfully','public/Migration','1428310KwJaoh','SalesmanName','../middleware/auth','Arabic\x20(ae)','Spanish','address','then','utils','SheetNames','aggregate','findOne','German','\x20added\x20successfully','Name','PName','sale','single','6qJEkum','/customer/view','Sheets','name','2855139qQdbcW','json','body','columns','render','params','diskStorage','/view','data','Sale','Hindi','email','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','Workbook','error','multer','map','payable_sum','public/Migration/','flash','sale_return','receivable','SalesmanCode','contactperson','payable','exceljs','2964008VavSmJ','post','French','success','sheet_to_json','customer_product_fule','language','readFile','write','find','send','Content-Type','forEach','Sale\x20Return','English','findById','attachment;\x20filename=customer_Migration_File.xlsx','xlsx','status','redirect','receivable_sum','customer_docs','8ixSGXY','155620SEYWXU','mobile','originalname','payment_data','Content-Disposition','Arabic','exports','master','user','customer','Chinese','679575HdNvsg','errors','log','English\x20(US)','get','$amount','../models/all_models','/view/:id','/customer_import_migrate_file','c_payments','5391585ZjgguF','376678NyatVK','element','PUnits','../public/language/languages.json','Customers','/products_export_migrate_file','258BmmmHM','143IymplU','reason'];a0_0x2bb7=function(){return _0x58aedf;};return a0_0x2bb7();}(function(_0x2e14d1,_0x552b95){const _0x305470=a0_0x25a0,_0x9a25b=_0x2e14d1();while(!![]){try{const _0x550027=-parseInt(_0x305470(0x1f7))/0x1*(-parseInt(_0x305470(0x1d2))/0x2)+parseInt(_0x305470(0x1c7))/0x3+-parseInt(_0x305470(0x1a5))/0x4+parseInt(_0x305470(0x1bc))/0x5*(-parseInt(_0x305470(0x1d8))/0x6)+parseInt(_0x305470(0x1fb))/0x7*(parseInt(_0x305470(0x1bb))/0x8)+-parseInt(_0x305470(0x1d1))/0x9+parseInt(_0x305470(0x1e6))/0xa*(parseInt(_0x305470(0x1d9))/0xb);if(_0x550027===_0x552b95)break;else _0x9a25b['push'](_0x9a25b['shift']());}catch(_0x41f575){_0x9a25b['push'](_0x9a25b['shift']());}}}(a0_0x2bb7,0xe62f8));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x2f4151(0x1cd)),auth=require(a0_0x2f4151(0x1e8)),users=require(a0_0x2f4151(0x1d5)),excelJS=require(a0_0x2f4151(0x1a4)),xlsx=require(a0_0x2f4151(0x1b6)),multer=require(a0_0x2f4151(0x19a));router[a0_0x2f4151(0x1cb)](a0_0x2f4151(0x202),auth,async(_0x339ba7,_0x100e73)=>{const _0x58979f=a0_0x2f4151;try{const {username:_0x3618ee,email:_0x2f67c0,role:_0x1fbe9a}=_0x339ba7[_0x58979f(0x1c4)],_0x5604cc=_0x339ba7['user'],_0x211179=await profile[_0x58979f(0x1f0)]({'email':_0x5604cc['email']}),_0x1ac62c=await master_shop[_0x58979f(0x1ae)]();console[_0x58979f(0x1c9)](_0x58979f(0x1c3),_0x1ac62c);const _0x85e4c7=await customer[_0x58979f(0x1ae)](),_0x4dd4c3=await customer[_0x58979f(0x1ef)]([{'$lookup':{'from':_0x58979f(0x1d0),'localField':_0x58979f(0x1fa),'foreignField':_0x58979f(0x1c5),'as':_0x58979f(0x1ba)}}]);console[_0x58979f(0x1c9)](_0x4dd4c3);const _0x5c567e=_0x4dd4c3[_0x58979f(0x19b)](_0x1e1e52=>{const _0x2bdcae=_0x58979f;console['log'](_0x2bdcae(0x203),_0x1e1e52);var _0x18f59c=0x0,_0x231336=0x0;return _0x1e1e52['customer_docs'][_0x2bdcae(0x1b1)](_0x3f17c8=>{const _0x475f79=_0x2bdcae;console[_0x475f79(0x1c9)](_0x475f79(0x1d3),_0x3f17c8),_0x3f17c8[_0x475f79(0x1da)]==_0x475f79(0x194)?_0x18f59c+=_0x3f17c8[_0x475f79(0x1dd)]:_0x231336+=_0x3f17c8[_0x475f79(0x1dd)];}),_0x1e1e52[_0x2bdcae(0x1f5)]=parseFloat(_0x18f59c)+0x0,_0x1e1e52[_0x2bdcae(0x19f)]=parseFloat(_0x231336)+0x0,_0x1e1e52;});console[_0x58979f(0x1c9)](_0x58979f(0x1bf),_0x5c567e);if(_0x1ac62c[0x0][_0x58979f(0x1ab)]==_0x58979f(0x1ca)){var _0x226b2d=users['English'];console[_0x58979f(0x1c9)](_0x226b2d);}else{if(_0x1ac62c[0x0][_0x58979f(0x1ab)]=='Hindi')var _0x226b2d=users['Hindi'];else{if(_0x1ac62c[0x0][_0x58979f(0x1ab)]=='German')var _0x226b2d=users['German'];else{if(_0x1ac62c[0x0][_0x58979f(0x1ab)]==_0x58979f(0x1ea))var _0x226b2d=users[_0x58979f(0x1ea)];else{if(_0x1ac62c[0x0]['language']==_0x58979f(0x1a7))var _0x226b2d=users[_0x58979f(0x1a7)];else{if(_0x1ac62c[0x0][_0x58979f(0x1ab)]==_0x58979f(0x1dc))var _0x226b2d=users[_0x58979f(0x1e0)];else{if(_0x1ac62c[0x0][_0x58979f(0x1ab)]==_0x58979f(0x1c6))var _0x226b2d=users['Chinese'];else{if(_0x1ac62c[0x0]['language']=='Arabic\x20(ae)')var _0x226b2d=users[_0x58979f(0x1c1)];}}}}}}}_0x100e73[_0x58979f(0x1ff)](_0x58979f(0x1c5),{'success':_0x339ba7[_0x58979f(0x19e)](_0x58979f(0x1a8)),'errors':_0x339ba7['flash'](_0x58979f(0x1c8)),'user':_0x85e4c7,'role':_0x5604cc,'profile':_0x211179,'payment':_0x5c567e,'master_shop':_0x1ac62c,'language':_0x226b2d});}catch(_0x1562bf){console[_0x58979f(0x1c9)](_0x1562bf);}}),router[a0_0x2f4151(0x1a6)](a0_0x2f4151(0x202),auth,async(_0xe9851e,_0x28cbc4)=>{const _0x14b20f=a0_0x2f4151;try{const {name:_0x3e5e0f,address:_0x2fa757,mobile:_0xded264,email:_0x3308d0,receivable:_0x55e700,payable:_0x2bae36,contactperson:_0x380b37,landline:_0x47a03b}=_0xe9851e[_0x14b20f(0x1fd)],_0xa753d8=new customer({'name':_0x3e5e0f,'address':_0x2fa757,'mobile':_0xded264,'email':_0x3308d0,'receivable':_0x55e700,'payable':_0x2bae36,'contactperson':_0x380b37,'landline':_0x47a03b}),_0xf1e2c4=await _0xa753d8[_0x14b20f(0x1db)]();_0xe9851e[_0x14b20f(0x19e)](_0x14b20f(0x1a8),_0x14b20f(0x1e4)),_0x28cbc4['redirect'](_0x14b20f(0x1f8));}catch(_0x4ffc8a){console['log'](_0x4ffc8a);}}),router[a0_0x2f4151(0x1cb)](a0_0x2f4151(0x1ce),auth,async(_0x338433,_0xe6e96f)=>{const _0x5c62f0=a0_0x2f4151;try{const {username:_0x14f326,email:_0x54e302,role:_0x5e815f}=_0x338433[_0x5c62f0(0x1c4)],_0x4ca74e=_0x338433[_0x5c62f0(0x1c4)],_0x1d5046=await profile['findOne']({'email':_0x4ca74e[_0x5c62f0(0x196)]}),_0x2b1dde=await master_shop[_0x5c62f0(0x1ae)]();console[_0x5c62f0(0x1c9)](_0x5c62f0(0x1c3),_0x2b1dde);const _0x4a6b0a=_0x338433[_0x5c62f0(0x200)]['id'],_0x1afefc=await customer[_0x5c62f0(0x1b4)](_0x4a6b0a);if(_0x2b1dde[0x0][_0x5c62f0(0x1ab)]==_0x5c62f0(0x1ca)){var _0x2d9b54=users['English'];console[_0x5c62f0(0x1c9)](_0x2d9b54);}else{if(_0x2b1dde[0x0][_0x5c62f0(0x1ab)]==_0x5c62f0(0x195))var _0x2d9b54=users['Hindi'];else{if(_0x2b1dde[0x0]['language']==_0x5c62f0(0x1f1))var _0x2d9b54=users[_0x5c62f0(0x1f1)];else{if(_0x2b1dde[0x0][_0x5c62f0(0x1ab)]==_0x5c62f0(0x1ea))var _0x2d9b54=users[_0x5c62f0(0x1ea)];else{if(_0x2b1dde[0x0][_0x5c62f0(0x1ab)]==_0x5c62f0(0x1a7))var _0x2d9b54=users[_0x5c62f0(0x1a7)];else{if(_0x2b1dde[0x0]['language']==_0x5c62f0(0x1dc))var _0x2d9b54=users[_0x5c62f0(0x1e0)];else{if(_0x2b1dde[0x0][_0x5c62f0(0x1ab)]==_0x5c62f0(0x1c6))var _0x2d9b54=users[_0x5c62f0(0x1c6)];else{if(_0x2b1dde[0x0][_0x5c62f0(0x1ab)]==_0x5c62f0(0x1e9))var _0x2d9b54=users[_0x5c62f0(0x1c1)];}}}}}}}_0xe6e96f[_0x5c62f0(0x1ff)]('customer',{'success':_0x338433['flash'](_0x5c62f0(0x1a8)),'errors':_0x338433[_0x5c62f0(0x19e)](_0x5c62f0(0x1c8)),'role':_0x4ca74e,'profile':_0x1d5046,'user':_0x1afefc,'master_shop':_0x2b1dde,'language':_0x2d9b54});}catch(_0x5a4941){console[_0x5c62f0(0x1c9)](_0x5a4941);}}),router[a0_0x2f4151(0x1a6)](a0_0x2f4151(0x1ce),auth,async(_0x25f556,_0x574d0d)=>{const _0x1b4c2b=a0_0x2f4151;try{const _0x511748=_0x25f556['params']['id'],_0x3b4e0b=await customer[_0x1b4c2b(0x1b4)](_0x511748),{name:_0x5f4950,address:_0x59bf6d,mobile:_0x25414e,email:_0x4d0e87,receivable:_0x3cd48e,payable:_0x51d9ea,contactperson:_0x23f0a7,landline:_0x585385}=_0x25f556['body'];_0x3b4e0b['name']=_0x5f4950,_0x3b4e0b[_0x1b4c2b(0x1eb)]=_0x59bf6d,_0x3b4e0b[_0x1b4c2b(0x1bd)]=_0x25414e,_0x3b4e0b[_0x1b4c2b(0x196)]=_0x4d0e87,_0x3b4e0b[_0x1b4c2b(0x1a0)]=_0x3cd48e,_0x3b4e0b[_0x1b4c2b(0x1a3)]=_0x51d9ea,_0x3b4e0b[_0x1b4c2b(0x1a2)]=_0x23f0a7,_0x3b4e0b['landline']=_0x585385;const _0x385500=await _0x3b4e0b[_0x1b4c2b(0x1db)]();_0x25f556[_0x1b4c2b(0x19e)](_0x1b4c2b(0x1a8),'customer\x20update\x20successfully'),_0x574d0d[_0x1b4c2b(0x1b8)]('/customer/view');}catch(_0x4e2ffe){console[_0x1b4c2b(0x1c9)](_0x4e2ffe);}}),router[a0_0x2f4151(0x1cb)](a0_0x2f4151(0x1e3),auth,async(_0x3fbf06,_0x6cd7e6)=>{const _0x3aa0b9=a0_0x2f4151;try{const {username:_0x411d5e,email:_0x88bb07,role:_0x17dbba}=_0x3fbf06[_0x3aa0b9(0x1c4)],_0x124a3f=_0x3fbf06[_0x3aa0b9(0x1c4)],_0x59f260=await profile[_0x3aa0b9(0x1f0)]({'email':_0x124a3f['email']}),_0x1a8815=await master_shop[_0x3aa0b9(0x1ae)]();console[_0x3aa0b9(0x1c9)](_0x3aa0b9(0x1c3),_0x1a8815),console[_0x3aa0b9(0x1c9)](_0x3fbf06[_0x3aa0b9(0x200)]['id']);const _0x20c039=await customer[_0x3aa0b9(0x1f0)]({'_id':_0x3fbf06[_0x3aa0b9(0x200)]['id']});console[_0x3aa0b9(0x1c9)]('customer_data',_0x20c039);const _0x56b3f7=await c_payment_data[_0x3aa0b9(0x1ae)]({'customer':_0x20c039[_0x3aa0b9(0x1fa)]});console[_0x3aa0b9(0x1c9)](_0x56b3f7);const _0x1e573b=await c_payment_data[_0x3aa0b9(0x1ef)]([{'$match':{'customer':_0x20c039[_0x3aa0b9(0x1fa)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':_0x3aa0b9(0x1de),'sum':{'$sum':_0x3aa0b9(0x1cc)}}}]);console[_0x3aa0b9(0x1c9)](_0x3aa0b9(0x19c),_0x1e573b);const _0x1243f7=await c_payment_data[_0x3aa0b9(0x1ef)]([{'$match':{'customer':_0x20c039['name']}},{'$match':{'reason':_0x3aa0b9(0x1b2)}},{'$group':{'_id':_0x3aa0b9(0x1de),'sum':{'$sum':_0x3aa0b9(0x1cc)}}}]);console[_0x3aa0b9(0x1c9)](_0x3aa0b9(0x1b9),_0x1243f7);if(_0x1a8815[0x0][_0x3aa0b9(0x1ab)]==_0x3aa0b9(0x1ca)){var _0x4b4dab=users[_0x3aa0b9(0x1b3)];console[_0x3aa0b9(0x1c9)](_0x4b4dab);}else{if(_0x1a8815[0x0][_0x3aa0b9(0x1ab)]==_0x3aa0b9(0x195))var _0x4b4dab=users['Hindi'];else{if(_0x1a8815[0x0][_0x3aa0b9(0x1ab)]==_0x3aa0b9(0x1f1))var _0x4b4dab=users['German'];else{if(_0x1a8815[0x0]['language']=='Spanish')var _0x4b4dab=users[_0x3aa0b9(0x1ea)];else{if(_0x1a8815[0x0]['language']==_0x3aa0b9(0x1a7))var _0x4b4dab=users[_0x3aa0b9(0x1a7)];else{if(_0x1a8815[0x0][_0x3aa0b9(0x1ab)]==_0x3aa0b9(0x1dc))var _0x4b4dab=users[_0x3aa0b9(0x1e0)];else{if(_0x1a8815[0x0]['language']==_0x3aa0b9(0x1c6))var _0x4b4dab=users[_0x3aa0b9(0x1c6)];else{if(_0x1a8815[0x0][_0x3aa0b9(0x1ab)]=='Arabic\x20(ae)')var _0x4b4dab=users['Arabic'];}}}}}}}_0x6cd7e6[_0x3aa0b9(0x1ff)]('customer_payment',{'success':_0x3fbf06['flash']('success'),'errors':_0x3fbf06[_0x3aa0b9(0x19e)](_0x3aa0b9(0x1c8)),'role':_0x124a3f,'profile':_0x59f260,'payment':_0x56b3f7,'payable':_0x1e573b,'receivable':_0x1243f7,'master_shop':_0x1a8815,'language':_0x4b4dab});}catch(_0x598b1e){console[_0x3aa0b9(0x1c9)](_0x598b1e);}}),router[a0_0x2f4151(0x1cb)](a0_0x2f4151(0x1d7),auth,async(_0x3d468f,_0x233e4a)=>{const _0x6491d8=a0_0x2f4151;try{const _0x16b647=new excelJS[(_0x6491d8(0x198))](),_0x30e70f=_0x16b647[_0x6491d8(0x1df)](_0x6491d8(0x1d6));return _0x30e70f[_0x6491d8(0x1fe)]=[{'header':'ID','key':_0x6491d8(0x1f4),'width':0xa},{'header':_0x6491d8(0x1f3),'key':'PBrands','width':0xa},{'header':_0x6491d8(0x1a1),'key':_0x6491d8(0x1d4),'width':0xa},{'header':_0x6491d8(0x1e7),'key':_0x6491d8(0x1e7),'width':0xa},{'header':_0x6491d8(0x1eb),'key':_0x6491d8(0x1eb),'width':0xa},{'header':_0x6491d8(0x1bd),'key':_0x6491d8(0x1bd),'width':0xa},{'header':_0x6491d8(0x196),'key':_0x6491d8(0x196),'width':0xa}],_0x233e4a[_0x6491d8(0x1e1)](_0x6491d8(0x1b0),_0x6491d8(0x197)),_0x233e4a['setHeader'](_0x6491d8(0x1c0),_0x6491d8(0x1b5)),_0x16b647[_0x6491d8(0x1b6)][_0x6491d8(0x1ad)](_0x233e4a)[_0x6491d8(0x1ec)](()=>{const _0x5da875=_0x6491d8;_0x233e4a[_0x5da875(0x1b7)](0xc8);});}catch(_0x489c5a){_0x233e4a['status'](0x190)[_0x6491d8(0x1af)]({'errors':_0x489c5a[_0x6491d8(0x1e2)]});}});function a0_0x25a0(_0x2c7e29,_0x3902cb){const _0x2bb72c=a0_0x2bb7();return a0_0x25a0=function(_0x25a00a,_0x763330){_0x25a00a=_0x25a00a-0x194;let _0x6bc3a9=_0x2bb72c[_0x25a00a];return _0x6bc3a9;},a0_0x25a0(_0x2c7e29,_0x3902cb);}const storage1=multer[a0_0x2f4151(0x201)]({'destination':(_0x3e22c9,_0x23c472,_0x3fac5a)=>{const _0x30d2eb=a0_0x2f4151;_0x3fac5a(null,_0x30d2eb(0x1e5));},'filename':(_0xa7706b,_0x51e30a,_0x38e254)=>{const _0x44a2d8=a0_0x2f4151;_0x38e254(null,Date['now']()+_0x51e30a[_0x44a2d8(0x1be)]);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x2f4151(0x1cf),auth,uploadMigrate[a0_0x2f4151(0x1f6)](a0_0x2f4151(0x1aa)),async(_0x247dd7,_0xba406c)=>{const _0x4c09ca=a0_0x2f4151,_0x393eb3=_0x247dd7['file']['filename'],_0x13e842=await xlsx[_0x4c09ca(0x1ac)](_0x4c09ca(0x19d)+_0x393eb3);let _0x2bf00d=_0x13e842[_0x4c09ca(0x1ee)],_0x8105c4=xlsx[_0x4c09ca(0x1ed)][_0x4c09ca(0x1a9)](_0x13e842[_0x4c09ca(0x1f9)][_0x2bf00d[0x0]]);for(const _0x112024 of _0x8105c4){const _0x1ec78c=_0x112024['ID'],_0x5618f8=_0x112024[_0x4c09ca(0x1f3)],_0x4328c1=_0x112024[_0x4c09ca(0x1a1)],_0x19bfbd=_0x112024[_0x4c09ca(0x1e7)],_0x201651=_0x112024[_0x4c09ca(0x1eb)],_0x5c4e70=_0x112024[_0x4c09ca(0x1bd)],_0x4e779e=_0x112024[_0x4c09ca(0x196)];try{let _0x353053=await customer[_0x4c09ca(0x1f0)]({'name':_0x5618f8});if(!_0x353053){const _0x433680=new customer({'name':_0x5618f8,'ID':_0x1ec78c,'SalesmanCode':_0x4328c1,'SalesmanName':_0x19bfbd,'address':_0x201651,'mobile':_0x5c4e70,'email':_0x4e779e});_0x353053=await _0x433680['save'](),_0x247dd7['flash']('success',_0x5618f8+_0x4c09ca(0x1f2));}else _0x247dd7[_0x4c09ca(0x19e)](_0x4c09ca(0x199),_0x5618f8+'\x20Failed');}catch(_0x4c66f7){_0xba406c[_0x4c09ca(0x1b7)](0x1f4)[_0x4c09ca(0x1fc)]({'proderror':_0x4c66f7['message'],'aproduct':ProductName});}}_0xba406c[_0x4c09ca(0x1b8)]('/customer/view');}),module[a0_0x2f4151(0x1c2)]=router;