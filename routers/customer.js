const a0_0x11799e=a0_0x182c;(function(_0x301b50,_0x1b0a66){const _0x556e2c=a0_0x182c,_0x2b345d=_0x301b50();while(!![]){try{const _0x4cd000=-parseInt(_0x556e2c(0x131))/0x1*(-parseInt(_0x556e2c(0x13e))/0x2)+parseInt(_0x556e2c(0x138))/0x3*(parseInt(_0x556e2c(0x135))/0x4)+parseInt(_0x556e2c(0x104))/0x5*(parseInt(_0x556e2c(0xe2))/0x6)+-parseInt(_0x556e2c(0x10a))/0x7+-parseInt(_0x556e2c(0xf6))/0x8*(parseInt(_0x556e2c(0x10f))/0x9)+parseInt(_0x556e2c(0x13c))/0xa*(-parseInt(_0x556e2c(0xf3))/0xb)+-parseInt(_0x556e2c(0x112))/0xc*(-parseInt(_0x556e2c(0xe8))/0xd);if(_0x4cd000===_0x1b0a66)break;else _0x2b345d['push'](_0x2b345d['shift']());}catch(_0xdef3d5){_0x2b345d['push'](_0x2b345d['shift']());}}}(a0_0x61e4,0x6a972));const express=require('express'),app=express(),router=express[a0_0x11799e(0xf5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x11799e(0x123)),auth=require(a0_0x11799e(0x146)),users=require(a0_0x11799e(0x11d)),excelJS=require(a0_0x11799e(0x136)),xlsx=require('xlsx'),multer=require(a0_0x11799e(0xf9));function a0_0x182c(_0x1a68c7,_0xb00439){const _0x61e4a3=a0_0x61e4();return a0_0x182c=function(_0x182c52,_0x12b0ae){_0x182c52=_0x182c52-0xe1;let _0x191dd0=_0x61e4a3[_0x182c52];return _0x191dd0;},a0_0x182c(_0x1a68c7,_0xb00439);}router[a0_0x11799e(0x145)](a0_0x11799e(0x13b),auth,async(_0x213e42,_0x36a78e)=>{const _0x7f7eed=a0_0x11799e;try{const {username:_0x390b2c,email:_0x359063,role:_0x57d3e6}=_0x213e42[_0x7f7eed(0x132)],_0x140f06=_0x213e42[_0x7f7eed(0x132)],_0x5216d5=await profile[_0x7f7eed(0x133)]({'email':_0x140f06['email']}),_0x139dc6=await master_shop['find']();console[_0x7f7eed(0x12a)](_0x7f7eed(0xe1),_0x139dc6);const _0x362a78=await customer[_0x7f7eed(0x116)](),_0x43a206=await customer[_0x7f7eed(0xee)]([{'$lookup':{'from':'c_payments','localField':_0x7f7eed(0x118),'foreignField':_0x7f7eed(0xf4),'as':'customer_docs'}}]);console['log'](_0x43a206);const _0x44a7a1=_0x43a206['map'](_0x136120=>{const _0x5f11a2=_0x7f7eed;console['log'](_0x5f11a2(0x142),_0x136120);var _0x20a36c=0x0,_0x2e9b12=0x0;return _0x136120[_0x5f11a2(0x103)]['forEach'](_0x58b0f2=>{const _0x2aa493=_0x5f11a2;console[_0x2aa493(0x12a)](_0x2aa493(0xe4),_0x58b0f2),_0x58b0f2['reason']==_0x2aa493(0x125)?_0x20a36c+=_0x58b0f2[_0x2aa493(0x126)]:_0x2e9b12+=_0x58b0f2['amount'];}),_0x136120['sale']=parseFloat(_0x20a36c)+0x0,_0x136120['sale_return']=parseFloat(_0x2e9b12)+0x0,_0x136120;});console[_0x7f7eed(0x12a)](_0x7f7eed(0x141),_0x44a7a1);if(_0x139dc6[0x0]['language']=='English\x20(US)'){var _0x202b17=users[_0x7f7eed(0x137)];console[_0x7f7eed(0x12a)](_0x202b17);}else{if(_0x139dc6[0x0][_0x7f7eed(0x114)]==_0x7f7eed(0x147))var _0x202b17=users[_0x7f7eed(0x147)];else{if(_0x139dc6[0x0][_0x7f7eed(0x114)]==_0x7f7eed(0xf1))var _0x202b17=users['German'];else{if(_0x139dc6[0x0][_0x7f7eed(0x114)]==_0x7f7eed(0xf0))var _0x202b17=users['Spanish'];else{if(_0x139dc6[0x0][_0x7f7eed(0x114)]==_0x7f7eed(0x12c))var _0x202b17=users['French'];else{if(_0x139dc6[0x0][_0x7f7eed(0x114)]==_0x7f7eed(0xfc))var _0x202b17=users[_0x7f7eed(0xeb)];else{if(_0x139dc6[0x0][_0x7f7eed(0x114)]==_0x7f7eed(0x12b))var _0x202b17=users[_0x7f7eed(0x12b)];else{if(_0x139dc6[0x0][_0x7f7eed(0x114)]==_0x7f7eed(0x11e))var _0x202b17=users[_0x7f7eed(0xe6)];}}}}}}}_0x36a78e[_0x7f7eed(0x128)](_0x7f7eed(0xf4),{'success':_0x213e42[_0x7f7eed(0x127)]('success'),'errors':_0x213e42['flash']('errors'),'user':_0x362a78,'role':_0x140f06,'profile':_0x5216d5,'payment':_0x44a7a1,'master_shop':_0x139dc6,'language':_0x202b17});}catch(_0x67e633){console[_0x7f7eed(0x12a)](_0x67e633);}}),router['post'](a0_0x11799e(0x13b),auth,async(_0x2f968e,_0x3d316a)=>{const _0x80311c=a0_0x11799e;try{const {name:_0x5d5972,address:_0x5af5cc,mobile:_0x2a1179,email:_0xf2717d,receivable:_0x4932fc,payable:_0x8fbe53,contactperson:_0x6ce203,landline:_0xe7e870}=_0x2f968e['body'],_0x10b4c9=new customer({'name':_0x5d5972,'address':_0x5af5cc,'mobile':_0x2a1179,'email':_0xf2717d,'receivable':_0x4932fc,'payable':_0x8fbe53,'contactperson':_0x6ce203,'landline':_0xe7e870}),_0x1ccc9c=await _0x10b4c9[_0x80311c(0x134)]();_0x2f968e['flash']('success','customer\x20add\x20successfully'),_0x3d316a[_0x80311c(0xfe)](_0x80311c(0xf7));}catch(_0x50497d){console[_0x80311c(0x12a)](_0x50497d);}}),router[a0_0x11799e(0x145)](a0_0x11799e(0x120),auth,async(_0x396d3d,_0x4494c4)=>{const _0x1a0ae5=a0_0x11799e;try{const {username:_0x427317,email:_0x2b826e,role:_0x4f3f23}=_0x396d3d['user'],_0x7e792b=_0x396d3d['user'],_0x5140eb=await profile[_0x1a0ae5(0x133)]({'email':_0x7e792b['email']}),_0x2766df=await master_shop['find']();console[_0x1a0ae5(0x12a)]('master',_0x2766df);const _0x1e4a33=_0x396d3d['params']['id'],_0x27aeb8=await customer[_0x1a0ae5(0xed)](_0x1e4a33);if(_0x2766df[0x0][_0x1a0ae5(0x114)]==_0x1a0ae5(0xf8)){var _0x14c187=users['English'];console[_0x1a0ae5(0x12a)](_0x14c187);}else{if(_0x2766df[0x0][_0x1a0ae5(0x114)]==_0x1a0ae5(0x147))var _0x14c187=users[_0x1a0ae5(0x147)];else{if(_0x2766df[0x0][_0x1a0ae5(0x114)]==_0x1a0ae5(0xf1))var _0x14c187=users[_0x1a0ae5(0xf1)];else{if(_0x2766df[0x0][_0x1a0ae5(0x114)]==_0x1a0ae5(0xf0))var _0x14c187=users[_0x1a0ae5(0xf0)];else{if(_0x2766df[0x0][_0x1a0ae5(0x114)]==_0x1a0ae5(0x12c))var _0x14c187=users[_0x1a0ae5(0x12c)];else{if(_0x2766df[0x0]['language']==_0x1a0ae5(0xfc))var _0x14c187=users[_0x1a0ae5(0xeb)];else{if(_0x2766df[0x0][_0x1a0ae5(0x114)]==_0x1a0ae5(0x12b))var _0x14c187=users[_0x1a0ae5(0x12b)];else{if(_0x2766df[0x0][_0x1a0ae5(0x114)]==_0x1a0ae5(0x11e))var _0x14c187=users[_0x1a0ae5(0xe6)];}}}}}}}_0x4494c4['render'](_0x1a0ae5(0xf4),{'success':_0x396d3d[_0x1a0ae5(0x127)](_0x1a0ae5(0x149)),'errors':_0x396d3d[_0x1a0ae5(0x127)]('errors'),'role':_0x7e792b,'profile':_0x5140eb,'user':_0x27aeb8,'master_shop':_0x2766df,'language':_0x14c187});}catch(_0x126cae){console[_0x1a0ae5(0x12a)](_0x126cae);}}),router[a0_0x11799e(0xe5)](a0_0x11799e(0x120),auth,async(_0x3c5ea3,_0x2d4c68)=>{const _0xb310d6=a0_0x11799e;try{const _0xc12cbc=_0x3c5ea3[_0xb310d6(0x119)]['id'],_0x2c3436=await customer[_0xb310d6(0xed)](_0xc12cbc),{name:_0x45babe,address:_0x529e4b,mobile:_0x16a017,email:_0x35a786,receivable:_0x1b20a8,payable:_0x2971ba,contactperson:_0x3ccc59,landline:_0xa7aff2}=_0x3c5ea3['body'];_0x2c3436['name']=_0x45babe,_0x2c3436[_0xb310d6(0x111)]=_0x529e4b,_0x2c3436[_0xb310d6(0x129)]=_0x16a017,_0x2c3436[_0xb310d6(0xe3)]=_0x35a786,_0x2c3436['receivable']=_0x1b20a8,_0x2c3436[_0xb310d6(0x105)]=_0x2971ba,_0x2c3436['contactperson']=_0x3ccc59,_0x2c3436[_0xb310d6(0x109)]=_0xa7aff2;const _0x1f8d15=await _0x2c3436['save']();_0x3c5ea3['flash']('success',_0xb310d6(0xfd)),_0x2d4c68['redirect'](_0xb310d6(0xf7));}catch(_0x421610){console['log'](_0x421610);}}),router[a0_0x11799e(0x145)](a0_0x11799e(0x11b),auth,async(_0x2b55c6,_0x1cd5df)=>{const _0x42627c=a0_0x11799e;try{const {username:_0x46baed,email:_0x538379,role:_0x53ad49}=_0x2b55c6['user'],_0x1c2bbf=_0x2b55c6[_0x42627c(0x132)],_0x1185a8=await profile[_0x42627c(0x133)]({'email':_0x1c2bbf[_0x42627c(0xe3)]}),_0x24b8f5=await master_shop[_0x42627c(0x116)]();console[_0x42627c(0x12a)](_0x42627c(0xe1),_0x24b8f5),console[_0x42627c(0x12a)](_0x2b55c6['params']['id']);const _0x28ac34=await customer[_0x42627c(0x133)]({'_id':_0x2b55c6[_0x42627c(0x119)]['id']});console[_0x42627c(0x12a)]('customer_data',_0x28ac34);const _0x388d3e=await c_payment_data['find']({'customer':_0x28ac34[_0x42627c(0x118)]});console[_0x42627c(0x12a)](_0x388d3e);const _0x1052aa=await c_payment_data[_0x42627c(0xee)]([{'$match':{'customer':_0x28ac34[_0x42627c(0x118)]}},{'$match':{'reason':_0x42627c(0x125)}},{'$group':{'_id':_0x42627c(0x143),'sum':{'$sum':_0x42627c(0xf2)}}}]);console['log'](_0x42627c(0x122),_0x1052aa);const _0x3e2ccb=await c_payment_data[_0x42627c(0xee)]([{'$match':{'customer':_0x28ac34[_0x42627c(0x118)]}},{'$match':{'reason':_0x42627c(0x121)}},{'$group':{'_id':_0x42627c(0x143),'sum':{'$sum':_0x42627c(0xf2)}}}]);console[_0x42627c(0x12a)](_0x42627c(0xe9),_0x3e2ccb);if(_0x24b8f5[0x0]['language']==_0x42627c(0xf8)){var _0xbbcb5b=users[_0x42627c(0x137)];console[_0x42627c(0x12a)](_0xbbcb5b);}else{if(_0x24b8f5[0x0][_0x42627c(0x114)]==_0x42627c(0x147))var _0xbbcb5b=users[_0x42627c(0x147)];else{if(_0x24b8f5[0x0][_0x42627c(0x114)]==_0x42627c(0xf1))var _0xbbcb5b=users[_0x42627c(0xf1)];else{if(_0x24b8f5[0x0][_0x42627c(0x114)]==_0x42627c(0xf0))var _0xbbcb5b=users['Spanish'];else{if(_0x24b8f5[0x0][_0x42627c(0x114)]==_0x42627c(0x12c))var _0xbbcb5b=users[_0x42627c(0x12c)];else{if(_0x24b8f5[0x0][_0x42627c(0x114)]==_0x42627c(0xfc))var _0xbbcb5b=users[_0x42627c(0xeb)];else{if(_0x24b8f5[0x0][_0x42627c(0x114)]=='Chinese')var _0xbbcb5b=users[_0x42627c(0x12b)];else{if(_0x24b8f5[0x0][_0x42627c(0x114)]==_0x42627c(0x11e))var _0xbbcb5b=users[_0x42627c(0xe6)];}}}}}}}_0x1cd5df[_0x42627c(0x128)](_0x42627c(0xef),{'success':_0x2b55c6[_0x42627c(0x127)](_0x42627c(0x149)),'errors':_0x2b55c6['flash'](_0x42627c(0x107)),'role':_0x1c2bbf,'profile':_0x1185a8,'payment':_0x388d3e,'payable':_0x1052aa,'receivable':_0x3e2ccb,'master_shop':_0x24b8f5,'language':_0xbbcb5b});}catch(_0x29913b){console[_0x42627c(0x12a)](_0x29913b);}}),router['get'](a0_0x11799e(0x113),auth,async(_0x35b3f3,_0x3ab70c)=>{const _0x38dab4=a0_0x11799e;try{const _0x42afa6=new excelJS['Workbook'](),_0x33d40b=_0x42afa6['addWorksheet']('Customers');return _0x33d40b[_0x38dab4(0xec)]=[{'header':'ID','key':_0x38dab4(0x13f),'width':0xa},{'header':_0x38dab4(0x130),'key':_0x38dab4(0x148),'width':0xa},{'header':_0x38dab4(0x108),'key':_0x38dab4(0x10d),'width':0xa},{'header':'SalesmanName','key':_0x38dab4(0x117),'width':0xa},{'header':_0x38dab4(0x111),'key':'address','width':0xa},{'header':_0x38dab4(0x129),'key':'mobile','width':0xa},{'header':_0x38dab4(0xe3),'key':_0x38dab4(0xe3),'width':0xa}],_0x3ab70c[_0x38dab4(0x11f)](_0x38dab4(0x10e),_0x38dab4(0x13d)),_0x3ab70c['setHeader'](_0x38dab4(0x11c),_0x38dab4(0xff)),_0x42afa6[_0x38dab4(0x140)][_0x38dab4(0xe7)](_0x3ab70c)['then'](()=>{_0x3ab70c['status'](0xc8);});}catch(_0xe0fbc3){_0x3ab70c[_0x38dab4(0x102)](0x190)[_0x38dab4(0x12f)]({'errors':_0xe0fbc3[_0x38dab4(0x110)]});}});const storage1=multer[a0_0x11799e(0xea)]({'destination':(_0x2c635b,_0x22e15e,_0x30212c)=>{_0x30212c(null,'public/Migration');},'filename':(_0x368210,_0x1a58e3,_0x165496)=>{const _0x5f0324=a0_0x11799e;_0x165496(null,Date[_0x5f0324(0xfb)]()+_0x1a58e3[_0x5f0324(0x12e)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x61e4(){const _0x5509a9=['flash','render','mobile','log','Chinese','French','error','originalname','send','Name','2539tyfWIz','user','findOne','save','1655436eadoxX','exceljs','English','3YmHccn','json','file','/view','10lOEAoy','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','68InDjwQ','PName','xlsx','payment_data','data','$reason','utils','get','../middleware/auth','Hindi','PBrands','success','master','30oFgwJD','email','element','post','Arabic','write','39ddSvxs','receivable_sum','diskStorage','Portuguese','columns','findById','aggregate','customer_payment','Spanish','German','$amount','5477417VkCVpB','customer','Router','13816AeaHhe','/customer/view','English\x20(US)','multer','readFile','now','Portuguese\x20(BR)','customer\x20update\x20successfully','redirect','attachment;\x20filename=customer_Migration_File.xlsx','\x20Failed','\x20added\x20successfully','status','customer_docs','210950ngeCkB','payable','SheetNames','errors','SalesmanCode','landline','4517576SkHWSC','Sheets','exports','PUnits','Content-Type','3465KoHvMm','message','address','6134676QDhgtU','/products_export_migrate_file','language','filename','find','SalesmanName','name','params','customer_product_fule','/view/payment/:id','Content-Disposition','../public/language/languages.json','Arabic\x20(ae)','setHeader','/view/:id','Sale\x20Return','payable_sum','../models/all_models','single','Sale','amount'];a0_0x61e4=function(){return _0x5509a9;};return a0_0x61e4();}router[a0_0x11799e(0xe5)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0x11799e(0x124)](a0_0x11799e(0x11a)),async(_0x5d6ef8,_0x2f10d4)=>{const _0x3b9932=a0_0x11799e,_0x1bf56f=_0x5d6ef8[_0x3b9932(0x13a)][_0x3b9932(0x115)],_0x1a8cd1=await xlsx[_0x3b9932(0xfa)]('public/Migration/'+_0x1bf56f);let _0x5bc5e1=_0x1a8cd1[_0x3b9932(0x106)],_0x3e8b16=xlsx[_0x3b9932(0x144)]['sheet_to_json'](_0x1a8cd1[_0x3b9932(0x10b)][_0x5bc5e1[0x0]]);for(const _0xeffd53 of _0x3e8b16){const _0x513b4f=_0xeffd53['ID'],_0x345e30=_0xeffd53[_0x3b9932(0x130)],_0x5a1ad7=_0xeffd53[_0x3b9932(0x108)],_0x13897b=_0xeffd53[_0x3b9932(0x117)],_0x51939c=_0xeffd53[_0x3b9932(0x111)],_0x2c5793=_0xeffd53[_0x3b9932(0x129)],_0x26bd70=_0xeffd53[_0x3b9932(0xe3)];try{let _0x52bf20=await customer[_0x3b9932(0x133)]({'name':_0x345e30});if(!_0x52bf20){const _0x2b7db2=new customer({'name':_0x345e30,'ID':_0x513b4f,'SalesmanCode':_0x5a1ad7,'SalesmanName':_0x13897b,'address':_0x51939c,'mobile':_0x2c5793,'email':_0x26bd70});_0x52bf20=await _0x2b7db2['save'](),_0x5d6ef8[_0x3b9932(0x127)](_0x3b9932(0x149),_0x345e30+_0x3b9932(0x101));}else _0x5d6ef8[_0x3b9932(0x127)](_0x3b9932(0x12d),_0x345e30+_0x3b9932(0x100));}catch(_0x319eef){_0x2f10d4[_0x3b9932(0x102)](0x1f4)[_0x3b9932(0x139)]({'proderror':_0x319eef[_0x3b9932(0x110)],'aproduct':ProductName});}}_0x2f10d4[_0x3b9932(0xfe)](_0x3b9932(0xf7));}),module[a0_0x11799e(0x10c)]=router;