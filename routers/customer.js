const a0_0x102055=a0_0x94ca;(function(_0x2f34a3,_0x5d5c2c){const _0x415194=a0_0x94ca,_0x58ee59=_0x2f34a3();while(!![]){try{const _0xa533d4=-parseInt(_0x415194(0x133))/0x1*(parseInt(_0x415194(0x142))/0x2)+-parseInt(_0x415194(0x10d))/0x3+parseInt(_0x415194(0x10e))/0x4*(parseInt(_0x415194(0x14e))/0x5)+parseInt(_0x415194(0xff))/0x6+parseInt(_0x415194(0xf6))/0x7+parseInt(_0x415194(0x119))/0x8+parseInt(_0x415194(0x126))/0x9;if(_0xa533d4===_0x5d5c2c)break;else _0x58ee59['push'](_0x58ee59['shift']());}catch(_0xa29ff4){_0x58ee59['push'](_0x58ee59['shift']());}}}(a0_0x47c9,0x295f7));function a0_0x94ca(_0x5978a6,_0x7d8569){const _0x47c9ac=a0_0x47c9();return a0_0x94ca=function(_0x94ca3a,_0x4de27f){_0x94ca3a=_0x94ca3a-0xe3;let _0xa6e10c=_0x47c9ac[_0x94ca3a];return _0xa6e10c;},a0_0x94ca(_0x5978a6,_0x7d8569);}const express=require(a0_0x102055(0x129)),app=express(),router=express[a0_0x102055(0x123)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x102055(0x11e)),auth=require(a0_0x102055(0x11d)),users=require(a0_0x102055(0x137)),excelJS=require('exceljs'),xlsx=require(a0_0x102055(0x120)),multer=require(a0_0x102055(0x114));function a0_0x47c9(){const _0x9323cd=['flash','PName','file','element','Content-Type','user','write','save','583766YgFuib','/view/:id','columns','Portuguese','send','public/Migration','English\x20(US)','json','body','find','/view','aggregate','45ptcBrf','payable','customer','receivable','$reason','originalname','email','customer_product_fule','customer\x20update\x20successfully','$amount','errors','\x20Failed','Arabic','French','status','exports','customer_docs','receivable_sum','reason','master','490343PXSmhZ','render','Spanish','customer_payment','\x20added\x20successfully','findOne','sheet_to_json','Name','redirect','998658CLshuN','customer_data','PUnits','PBrands','language','Hindi','attachment;\x20filename=customer_Migration_File.xlsx','name','SheetNames','German','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','customer\x20add\x20successfully','utils','landline','961332CePxtA','97084LnKSzt','Customers','log','post','/customer/view','error','multer','Chinese','diskStorage','data','success','217648ebMzRZ','Sale\x20Return','get','map','../middleware/auth','../models/all_models','filename','xlsx','Sheets','params','Router','addWorksheet','English','2696877VqUows','now','single','express','sale_return','Portuguese\x20(BR)','/products_export_migrate_file','Sale','mobile','/view/payment/:id','setHeader','address','findById','1ymPDiN','amount','SalesmanName','Arabic\x20(ae)','../public/language/languages.json','sale','payable_sum'];a0_0x47c9=function(){return _0x9323cd;};return a0_0x47c9();}router['get']('/view',auth,async(_0x5a8f01,_0xed3ea2)=>{const _0x392197=a0_0x102055;try{const {username:_0x5a63e2,email:_0x56a99f,role:_0x1ec897}=_0x5a8f01[_0x392197(0x13f)],_0x316b26=_0x5a8f01['user'],_0x553220=await profile[_0x392197(0xfb)]({'email':_0x316b26['email']}),_0x17d917=await master_shop[_0x392197(0x14b)]();console['log'](_0x392197(0xf5),_0x17d917);const _0x4fbdb3=await customer[_0x392197(0x14b)](),_0x7b9d04=await customer[_0x392197(0x14d)]([{'$lookup':{'from':'c_payments','localField':_0x392197(0x106),'foreignField':'customer','as':_0x392197(0xf2)}}]);console[_0x392197(0x110)](_0x7b9d04);const _0x1f6748=_0x7b9d04[_0x392197(0x11c)](_0x2981c3=>{const _0x284975=_0x392197;console['log'](_0x284975(0x117),_0x2981c3);var _0x439de6=0x0,_0x42d1d1=0x0;return _0x2981c3['customer_docs']['forEach'](_0x292d70=>{const _0x2a9223=_0x284975;console['log'](_0x2a9223(0x13d),_0x292d70),_0x292d70[_0x2a9223(0xf4)]==_0x2a9223(0x12d)?_0x439de6+=_0x292d70[_0x2a9223(0x134)]:_0x42d1d1+=_0x292d70[_0x2a9223(0x134)];}),_0x2981c3[_0x284975(0x138)]=parseFloat(_0x439de6)+0x0,_0x2981c3[_0x284975(0x12a)]=parseFloat(_0x42d1d1)+0x0,_0x2981c3;});console[_0x392197(0x110)]('payment_data',_0x1f6748);if(_0x17d917[0x0][_0x392197(0x103)]==_0x392197(0x148)){var _0x15aa30=users[_0x392197(0x125)];console['log'](_0x15aa30);}else{if(_0x17d917[0x0][_0x392197(0x103)]=='Hindi')var _0x15aa30=users[_0x392197(0x104)];else{if(_0x17d917[0x0]['language']==_0x392197(0x108))var _0x15aa30=users[_0x392197(0x108)];else{if(_0x17d917[0x0][_0x392197(0x103)]==_0x392197(0xf8))var _0x15aa30=users[_0x392197(0xf8)];else{if(_0x17d917[0x0]['language']==_0x392197(0xef))var _0x15aa30=users[_0x392197(0xef)];else{if(_0x17d917[0x0][_0x392197(0x103)]=='Portuguese\x20(BR)')var _0x15aa30=users[_0x392197(0x145)];else{if(_0x17d917[0x0][_0x392197(0x103)]==_0x392197(0x115))var _0x15aa30=users[_0x392197(0x115)];else{if(_0x17d917[0x0]['language']==_0x392197(0x136))var _0x15aa30=users['Arabic'];}}}}}}}_0xed3ea2[_0x392197(0xf7)](_0x392197(0xe4),{'success':_0x5a8f01[_0x392197(0x13a)](_0x392197(0x118)),'errors':_0x5a8f01[_0x392197(0x13a)](_0x392197(0xec)),'user':_0x4fbdb3,'role':_0x316b26,'profile':_0x553220,'payment':_0x1f6748,'master_shop':_0x17d917,'language':_0x15aa30});}catch(_0xcbb7f4){console[_0x392197(0x110)](_0xcbb7f4);}}),router[a0_0x102055(0x111)](a0_0x102055(0x14c),auth,async(_0x16a11f,_0x36cb4e)=>{const _0xe27dd1=a0_0x102055;try{const {name:_0x3adf01,address:_0x3d64b5,mobile:_0x6e3a59,email:_0x2792a7,receivable:_0x29e25b,payable:_0x2dd94e,contactperson:_0x9c6d27,landline:_0x25401b}=_0x16a11f[_0xe27dd1(0x14a)],_0x54ea16=new customer({'name':_0x3adf01,'address':_0x3d64b5,'mobile':_0x6e3a59,'email':_0x2792a7,'receivable':_0x29e25b,'payable':_0x2dd94e,'contactperson':_0x9c6d27,'landline':_0x25401b}),_0x4ce24a=await _0x54ea16[_0xe27dd1(0x141)]();_0x16a11f[_0xe27dd1(0x13a)](_0xe27dd1(0x118),_0xe27dd1(0x10a)),_0x36cb4e[_0xe27dd1(0xfe)](_0xe27dd1(0x112));}catch(_0x2b36da){console[_0xe27dd1(0x110)](_0x2b36da);}}),router[a0_0x102055(0x11b)](a0_0x102055(0x143),auth,async(_0x47195f,_0x5d3688)=>{const _0x2558dc=a0_0x102055;try{const {username:_0xbfa6ce,email:_0xb6377,role:_0x59e5b7}=_0x47195f['user'],_0x157478=_0x47195f[_0x2558dc(0x13f)],_0x3d71db=await profile['findOne']({'email':_0x157478[_0x2558dc(0xe8)]}),_0x33773f=await master_shop[_0x2558dc(0x14b)]();console['log'](_0x2558dc(0xf5),_0x33773f);const _0xf55ec1=_0x47195f[_0x2558dc(0x122)]['id'],_0xcc9532=await customer[_0x2558dc(0x132)](_0xf55ec1);if(_0x33773f[0x0][_0x2558dc(0x103)]=='English\x20(US)'){var _0x4ad540=users[_0x2558dc(0x125)];console[_0x2558dc(0x110)](_0x4ad540);}else{if(_0x33773f[0x0]['language']=='Hindi')var _0x4ad540=users['Hindi'];else{if(_0x33773f[0x0]['language']==_0x2558dc(0x108))var _0x4ad540=users['German'];else{if(_0x33773f[0x0]['language']==_0x2558dc(0xf8))var _0x4ad540=users[_0x2558dc(0xf8)];else{if(_0x33773f[0x0][_0x2558dc(0x103)]=='French')var _0x4ad540=users[_0x2558dc(0xef)];else{if(_0x33773f[0x0]['language']==_0x2558dc(0x12b))var _0x4ad540=users['Portuguese'];else{if(_0x33773f[0x0][_0x2558dc(0x103)]=='Chinese')var _0x4ad540=users[_0x2558dc(0x115)];else{if(_0x33773f[0x0]['language']==_0x2558dc(0x136))var _0x4ad540=users['Arabic'];}}}}}}}_0x5d3688[_0x2558dc(0xf7)](_0x2558dc(0xe4),{'success':_0x47195f[_0x2558dc(0x13a)](_0x2558dc(0x118)),'errors':_0x47195f['flash'](_0x2558dc(0xec)),'role':_0x157478,'profile':_0x3d71db,'user':_0xcc9532,'master_shop':_0x33773f,'language':_0x4ad540});}catch(_0x5acc92){console[_0x2558dc(0x110)](_0x5acc92);}}),router[a0_0x102055(0x111)](a0_0x102055(0x143),auth,async(_0x5555e1,_0x30e5de)=>{const _0x1fb390=a0_0x102055;try{const _0x53204e=_0x5555e1[_0x1fb390(0x122)]['id'],_0x212219=await customer[_0x1fb390(0x132)](_0x53204e),{name:_0x5546f6,address:_0x1c8dcf,mobile:_0x79f961,email:_0x47aab1,receivable:_0x289f56,payable:_0x5da285,contactperson:_0x380108,landline:_0x347313}=_0x5555e1['body'];_0x212219[_0x1fb390(0x106)]=_0x5546f6,_0x212219[_0x1fb390(0x131)]=_0x1c8dcf,_0x212219[_0x1fb390(0x12e)]=_0x79f961,_0x212219[_0x1fb390(0xe8)]=_0x47aab1,_0x212219[_0x1fb390(0xe5)]=_0x289f56,_0x212219[_0x1fb390(0xe3)]=_0x5da285,_0x212219['contactperson']=_0x380108,_0x212219[_0x1fb390(0x10c)]=_0x347313;const _0x94e7be=await _0x212219[_0x1fb390(0x141)]();_0x5555e1[_0x1fb390(0x13a)](_0x1fb390(0x118),_0x1fb390(0xea)),_0x30e5de[_0x1fb390(0xfe)](_0x1fb390(0x112));}catch(_0x5259bc){console['log'](_0x5259bc);}}),router[a0_0x102055(0x11b)](a0_0x102055(0x12f),auth,async(_0x440a04,_0x1586e2)=>{const _0x1623f6=a0_0x102055;try{const {username:_0x58b347,email:_0x598f70,role:_0x23b476}=_0x440a04[_0x1623f6(0x13f)],_0x447d4e=_0x440a04[_0x1623f6(0x13f)],_0x35356c=await profile[_0x1623f6(0xfb)]({'email':_0x447d4e['email']}),_0x35dd03=await master_shop[_0x1623f6(0x14b)]();console[_0x1623f6(0x110)](_0x1623f6(0xf5),_0x35dd03),console['log'](_0x440a04[_0x1623f6(0x122)]['id']);const _0x24ea95=await customer[_0x1623f6(0xfb)]({'_id':_0x440a04[_0x1623f6(0x122)]['id']});console[_0x1623f6(0x110)](_0x1623f6(0x100),_0x24ea95);const _0x290705=await c_payment_data[_0x1623f6(0x14b)]({'customer':_0x24ea95[_0x1623f6(0x106)]});console[_0x1623f6(0x110)](_0x290705);const _0x37c129=await c_payment_data['aggregate']([{'$match':{'customer':_0x24ea95[_0x1623f6(0x106)]}},{'$match':{'reason':_0x1623f6(0x12d)}},{'$group':{'_id':_0x1623f6(0xe6),'sum':{'$sum':_0x1623f6(0xeb)}}}]);console[_0x1623f6(0x110)](_0x1623f6(0x139),_0x37c129);const _0x4fcddb=await c_payment_data['aggregate']([{'$match':{'customer':_0x24ea95[_0x1623f6(0x106)]}},{'$match':{'reason':_0x1623f6(0x11a)}},{'$group':{'_id':_0x1623f6(0xe6),'sum':{'$sum':_0x1623f6(0xeb)}}}]);console['log'](_0x1623f6(0xf3),_0x4fcddb);if(_0x35dd03[0x0][_0x1623f6(0x103)]==_0x1623f6(0x148)){var _0x26c719=users[_0x1623f6(0x125)];console['log'](_0x26c719);}else{if(_0x35dd03[0x0][_0x1623f6(0x103)]==_0x1623f6(0x104))var _0x26c719=users[_0x1623f6(0x104)];else{if(_0x35dd03[0x0]['language']==_0x1623f6(0x108))var _0x26c719=users[_0x1623f6(0x108)];else{if(_0x35dd03[0x0][_0x1623f6(0x103)]==_0x1623f6(0xf8))var _0x26c719=users[_0x1623f6(0xf8)];else{if(_0x35dd03[0x0][_0x1623f6(0x103)]==_0x1623f6(0xef))var _0x26c719=users[_0x1623f6(0xef)];else{if(_0x35dd03[0x0]['language']==_0x1623f6(0x12b))var _0x26c719=users[_0x1623f6(0x145)];else{if(_0x35dd03[0x0]['language']==_0x1623f6(0x115))var _0x26c719=users[_0x1623f6(0x115)];else{if(_0x35dd03[0x0][_0x1623f6(0x103)]==_0x1623f6(0x136))var _0x26c719=users[_0x1623f6(0xee)];}}}}}}}_0x1586e2[_0x1623f6(0xf7)](_0x1623f6(0xf9),{'success':_0x440a04[_0x1623f6(0x13a)]('success'),'errors':_0x440a04[_0x1623f6(0x13a)]('errors'),'role':_0x447d4e,'profile':_0x35356c,'payment':_0x290705,'payable':_0x37c129,'receivable':_0x4fcddb,'master_shop':_0x35dd03,'language':_0x26c719});}catch(_0x1b84f8){console['log'](_0x1b84f8);}}),router['get'](a0_0x102055(0x12c),auth,async(_0x375eb1,_0x342f09)=>{const _0x44c746=a0_0x102055;try{const _0x243fa0=new excelJS['Workbook'](),_0x3930f4=_0x243fa0[_0x44c746(0x124)](_0x44c746(0x10f));return _0x3930f4[_0x44c746(0x144)]=[{'header':'ID','key':_0x44c746(0x13b),'width':0xa},{'header':_0x44c746(0xfd),'key':_0x44c746(0x102),'width':0xa},{'header':'SalesmanCode','key':_0x44c746(0x101),'width':0xa},{'header':'SalesmanName','key':'SalesmanName','width':0xa},{'header':_0x44c746(0x131),'key':_0x44c746(0x131),'width':0xa},{'header':_0x44c746(0x12e),'key':_0x44c746(0x12e),'width':0xa},{'header':_0x44c746(0xe8),'key':_0x44c746(0xe8),'width':0xa}],_0x342f09[_0x44c746(0x130)](_0x44c746(0x13e),_0x44c746(0x109)),_0x342f09[_0x44c746(0x130)]('Content-Disposition',_0x44c746(0x105)),_0x243fa0[_0x44c746(0x120)][_0x44c746(0x140)](_0x342f09)['then'](()=>{const _0x482a28=_0x44c746;_0x342f09[_0x482a28(0xf0)](0xc8);});}catch(_0x591425){_0x342f09[_0x44c746(0xf0)](0x190)[_0x44c746(0x146)]({'errors':_0x591425['message']});}});const storage1=multer[a0_0x102055(0x116)]({'destination':(_0x134d89,_0x22efc7,_0x1e4f2c)=>{const _0x52e163=a0_0x102055;_0x1e4f2c(null,_0x52e163(0x147));},'filename':(_0x4e5239,_0x50442e,_0x3854da)=>{const _0xac3570=a0_0x102055;_0x3854da(null,Date[_0xac3570(0x127)]()+_0x50442e[_0xac3570(0xe7)]);}}),uploadMigrate=multer({'storage':storage1});router['post']('/customer_import_migrate_file',auth,uploadMigrate[a0_0x102055(0x128)](a0_0x102055(0xe9)),async(_0x221be2,_0x420cb7)=>{const _0x5744c7=a0_0x102055,_0x3258ac=_0x221be2[_0x5744c7(0x13c)][_0x5744c7(0x11f)],_0x5ac7f3=await xlsx['readFile']('public/Migration/'+_0x3258ac);let _0x254238=_0x5ac7f3[_0x5744c7(0x107)],_0x3c0276=xlsx[_0x5744c7(0x10b)][_0x5744c7(0xfc)](_0x5ac7f3[_0x5744c7(0x121)][_0x254238[0x0]]);for(const _0x29ca23 of _0x3c0276){const _0x5af8ea=_0x29ca23['ID'],_0x4a4cc8=_0x29ca23['Name'],_0x15b572=_0x29ca23['SalesmanCode'],_0x55e361=_0x29ca23[_0x5744c7(0x135)],_0x21e85a=_0x29ca23[_0x5744c7(0x131)],_0x3e1457=_0x29ca23[_0x5744c7(0x12e)],_0x5c5c44=_0x29ca23[_0x5744c7(0xe8)];try{let _0x4c6360=await customer[_0x5744c7(0xfb)]({'name':_0x4a4cc8});if(!_0x4c6360){const _0x326d61=new customer({'name':_0x4a4cc8,'ID':_0x5af8ea,'SalesmanCode':_0x15b572,'SalesmanName':_0x55e361,'address':_0x21e85a,'mobile':_0x3e1457,'email':_0x5c5c44});_0x4c6360=await _0x326d61[_0x5744c7(0x141)](),_0x221be2[_0x5744c7(0x13a)]('success',_0x4a4cc8+_0x5744c7(0xfa));}else _0x221be2['flash'](_0x5744c7(0x113),_0x4a4cc8+_0x5744c7(0xed));}catch(_0x450b3c){_0x420cb7['status'](0x1f4)[_0x5744c7(0x149)]({'proderror':_0x450b3c['message'],'aproduct':ProductName});}}_0x420cb7[_0x5744c7(0xfe)](_0x5744c7(0x112));}),module[a0_0x102055(0xf1)]=router;