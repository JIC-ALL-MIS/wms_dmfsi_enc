const a0_0x2d0987=a0_0x4add;(function(_0x19cd4a,_0x343811){const _0x1548af=a0_0x4add,_0x273e8d=_0x19cd4a();while(!![]){try{const _0x40180e=-parseInt(_0x1548af(0x1ae))/0x1*(parseInt(_0x1548af(0x177))/0x2)+parseInt(_0x1548af(0x1a0))/0x3*(parseInt(_0x1548af(0x160))/0x4)+parseInt(_0x1548af(0x150))/0x5+-parseInt(_0x1548af(0x180))/0x6+-parseInt(_0x1548af(0x19c))/0x7*(-parseInt(_0x1548af(0x183))/0x8)+parseInt(_0x1548af(0x16a))/0x9*(-parseInt(_0x1548af(0x1b5))/0xa)+-parseInt(_0x1548af(0x18f))/0xb*(-parseInt(_0x1548af(0x1ad))/0xc);if(_0x40180e===_0x343811)break;else _0x273e8d['push'](_0x273e8d['shift']());}catch(_0x5b2093){_0x273e8d['push'](_0x273e8d['shift']());}}}(a0_0xcf50,0xd611a));function a0_0xcf50(){const _0x2cf601=['success','$amount','data','Router','/customer_import_migrate_file','English\x20(US)','amount','findOne','sheet_to_json','12MePRhz','392059ScVCGf','readFile','\x20added\x20successfully','PUnits','findById','attachment;\x20filename=customer_Migration_File.xlsx','utils','4269170qiMPiq','Hindi','SalesmanCode','customer_payment','user','email','address','landline','payable','body','4841680JtrfUF','originalname','/customer/view','public/Migration/','customer_docs','render','redirect','SalesmanName','German','Portuguese','error','multer','save','payable_sum','get','../public/language/languages.json','20PIfzhf','Arabic\x20(ae)','Chinese','Sheets','master','status','mobile','receivable_sum','Arabic','/products_export_migrate_file','18SVFFdO','Spanish','public/Migration','filename','/view/payment/:id','Sale','then','aggregate','Workbook','payment_data','customer\x20update\x20successfully','/view','language','8bBuMqV','Name','params','json','../models/all_models','Customers','flash','SheetNames','write','7076838WfhWRY','\x20Failed','English','8bqWbrL','element','Portuguese\x20(BR)','name','c_payments','xlsx','customer','sale','setHeader','message','find','$reason','17120587BnCzJh','Content-Disposition','/view/:id','send','addWorksheet','errors','French','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','log','reason','sale_return','post','single','9579507VcuCfp','now','PName','columns','351069QHLcZB','forEach','customer_product_fule','Sale\x20Return'];a0_0xcf50=function(){return _0x2cf601;};return a0_0xcf50();}const express=require('express'),app=express(),router=express[a0_0x2d0987(0x1a7)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x2d0987(0x17b)),auth=require('../middleware/auth'),users=require(a0_0x2d0987(0x15f)),excelJS=require('exceljs'),xlsx=require(a0_0x2d0987(0x188)),multer=require(a0_0x2d0987(0x15b));router[a0_0x2d0987(0x15e)](a0_0x2d0987(0x175),auth,async(_0xf40a16,_0x15e223)=>{const _0x3493ae=a0_0x2d0987;try{const {username:_0x5679d6,email:_0x4229b9,role:_0x1e66c0}=_0xf40a16[_0x3493ae(0x1b9)],_0x2bcf68=_0xf40a16[_0x3493ae(0x1b9)],_0x48530c=await profile[_0x3493ae(0x1ab)]({'email':_0x2bcf68[_0x3493ae(0x1ba)]}),_0x207c3a=await master_shop['find']();console[_0x3493ae(0x197)](_0x3493ae(0x164),_0x207c3a);const _0x3010e9=await customer[_0x3493ae(0x18d)](),_0x1f10f7=await customer[_0x3493ae(0x171)]([{'$lookup':{'from':_0x3493ae(0x187),'localField':_0x3493ae(0x186),'foreignField':_0x3493ae(0x189),'as':_0x3493ae(0x154)}}]);console['log'](_0x1f10f7);const _0x2cbf11=_0x1f10f7['map'](_0x1a1a56=>{const _0x12c9f1=_0x3493ae;console[_0x12c9f1(0x197)](_0x12c9f1(0x1a6),_0x1a1a56);var _0x216c36=0x0,_0x197650=0x0;return _0x1a1a56[_0x12c9f1(0x154)][_0x12c9f1(0x1a1)](_0x17f413=>{const _0x49f9d8=_0x12c9f1;console['log'](_0x49f9d8(0x184),_0x17f413),_0x17f413[_0x49f9d8(0x198)]==_0x49f9d8(0x16f)?_0x216c36+=_0x17f413[_0x49f9d8(0x1aa)]:_0x197650+=_0x17f413['amount'];}),_0x1a1a56[_0x12c9f1(0x18a)]=parseFloat(_0x216c36)+0x0,_0x1a1a56[_0x12c9f1(0x199)]=parseFloat(_0x197650)+0x0,_0x1a1a56;});console[_0x3493ae(0x197)](_0x3493ae(0x173),_0x2cbf11);if(_0x207c3a[0x0][_0x3493ae(0x176)]==_0x3493ae(0x1a9)){var _0x102618=users[_0x3493ae(0x182)];console[_0x3493ae(0x197)](_0x102618);}else{if(_0x207c3a[0x0][_0x3493ae(0x176)]=='Hindi')var _0x102618=users[_0x3493ae(0x1b6)];else{if(_0x207c3a[0x0][_0x3493ae(0x176)]==_0x3493ae(0x158))var _0x102618=users[_0x3493ae(0x158)];else{if(_0x207c3a[0x0][_0x3493ae(0x176)]==_0x3493ae(0x16b))var _0x102618=users['Spanish'];else{if(_0x207c3a[0x0][_0x3493ae(0x176)]==_0x3493ae(0x195))var _0x102618=users['French'];else{if(_0x207c3a[0x0]['language']=='Portuguese\x20(BR)')var _0x102618=users[_0x3493ae(0x159)];else{if(_0x207c3a[0x0][_0x3493ae(0x176)]=='Chinese')var _0x102618=users[_0x3493ae(0x162)];else{if(_0x207c3a[0x0][_0x3493ae(0x176)]==_0x3493ae(0x161))var _0x102618=users['Arabic'];}}}}}}}_0x15e223[_0x3493ae(0x155)](_0x3493ae(0x189),{'success':_0xf40a16[_0x3493ae(0x17d)](_0x3493ae(0x1a4)),'errors':_0xf40a16[_0x3493ae(0x17d)]('errors'),'user':_0x3010e9,'role':_0x2bcf68,'profile':_0x48530c,'payment':_0x2cbf11,'master_shop':_0x207c3a,'language':_0x102618});}catch(_0x357445){console[_0x3493ae(0x197)](_0x357445);}}),router[a0_0x2d0987(0x19a)](a0_0x2d0987(0x175),auth,async(_0x2e3102,_0x57ffc8)=>{const _0x1fea92=a0_0x2d0987;try{const {name:_0x40828e,address:_0x5e0602,mobile:_0x293859,email:_0x48451e,receivable:_0x4a4b36,payable:_0x1d5026,contactperson:_0x23f7ee,landline:_0x5724a3}=_0x2e3102[_0x1fea92(0x14f)],_0x57cad6=new customer({'name':_0x40828e,'address':_0x5e0602,'mobile':_0x293859,'email':_0x48451e,'receivable':_0x4a4b36,'payable':_0x1d5026,'contactperson':_0x23f7ee,'landline':_0x5724a3}),_0x5b69e5=await _0x57cad6[_0x1fea92(0x15c)]();_0x2e3102[_0x1fea92(0x17d)](_0x1fea92(0x1a4),'customer\x20add\x20successfully'),_0x57ffc8[_0x1fea92(0x156)](_0x1fea92(0x152));}catch(_0x4aaff9){console[_0x1fea92(0x197)](_0x4aaff9);}}),router[a0_0x2d0987(0x15e)](a0_0x2d0987(0x191),auth,async(_0x5d5d6a,_0x857c42)=>{const _0x5326e8=a0_0x2d0987;try{const {username:_0x10fea2,email:_0x5bcbb0,role:_0x13a2c5}=_0x5d5d6a[_0x5326e8(0x1b9)],_0x5ed09a=_0x5d5d6a[_0x5326e8(0x1b9)],_0x2782d7=await profile[_0x5326e8(0x1ab)]({'email':_0x5ed09a[_0x5326e8(0x1ba)]}),_0x17e836=await master_shop[_0x5326e8(0x18d)]();console[_0x5326e8(0x197)](_0x5326e8(0x164),_0x17e836);const _0xd22486=_0x5d5d6a[_0x5326e8(0x179)]['id'],_0x5c5f2d=await customer[_0x5326e8(0x1b2)](_0xd22486);if(_0x17e836[0x0][_0x5326e8(0x176)]=='English\x20(US)'){var _0x33d0a2=users[_0x5326e8(0x182)];console[_0x5326e8(0x197)](_0x33d0a2);}else{if(_0x17e836[0x0][_0x5326e8(0x176)]==_0x5326e8(0x1b6))var _0x33d0a2=users['Hindi'];else{if(_0x17e836[0x0]['language']=='German')var _0x33d0a2=users[_0x5326e8(0x158)];else{if(_0x17e836[0x0][_0x5326e8(0x176)]=='Spanish')var _0x33d0a2=users[_0x5326e8(0x16b)];else{if(_0x17e836[0x0][_0x5326e8(0x176)]=='French')var _0x33d0a2=users['French'];else{if(_0x17e836[0x0][_0x5326e8(0x176)]==_0x5326e8(0x185))var _0x33d0a2=users[_0x5326e8(0x159)];else{if(_0x17e836[0x0]['language']==_0x5326e8(0x162))var _0x33d0a2=users[_0x5326e8(0x162)];else{if(_0x17e836[0x0]['language']=='Arabic\x20(ae)')var _0x33d0a2=users[_0x5326e8(0x168)];}}}}}}}_0x857c42['render']('customer',{'success':_0x5d5d6a['flash'](_0x5326e8(0x1a4)),'errors':_0x5d5d6a[_0x5326e8(0x17d)](_0x5326e8(0x194)),'role':_0x5ed09a,'profile':_0x2782d7,'user':_0x5c5f2d,'master_shop':_0x17e836,'language':_0x33d0a2});}catch(_0x703893){console[_0x5326e8(0x197)](_0x703893);}}),router[a0_0x2d0987(0x19a)]('/view/:id',auth,async(_0x3ae4b3,_0x5d783e)=>{const _0x510b5a=a0_0x2d0987;try{const _0x834485=_0x3ae4b3['params']['id'],_0x1f00da=await customer[_0x510b5a(0x1b2)](_0x834485),{name:_0x34556a,address:_0x8170b2,mobile:_0x45e6b9,email:_0xa51b38,receivable:_0x396cbc,payable:_0x219461,contactperson:_0x114782,landline:_0x242316}=_0x3ae4b3[_0x510b5a(0x14f)];_0x1f00da[_0x510b5a(0x186)]=_0x34556a,_0x1f00da[_0x510b5a(0x1bb)]=_0x8170b2,_0x1f00da[_0x510b5a(0x166)]=_0x45e6b9,_0x1f00da[_0x510b5a(0x1ba)]=_0xa51b38,_0x1f00da['receivable']=_0x396cbc,_0x1f00da[_0x510b5a(0x14e)]=_0x219461,_0x1f00da['contactperson']=_0x114782,_0x1f00da[_0x510b5a(0x1bc)]=_0x242316;const _0x20d69e=await _0x1f00da[_0x510b5a(0x15c)]();_0x3ae4b3['flash']('success',_0x510b5a(0x174)),_0x5d783e[_0x510b5a(0x156)](_0x510b5a(0x152));}catch(_0x2f6487){console[_0x510b5a(0x197)](_0x2f6487);}}),router[a0_0x2d0987(0x15e)](a0_0x2d0987(0x16e),auth,async(_0x433f12,_0x422fd8)=>{const _0x36858b=a0_0x2d0987;try{const {username:_0xf8cc62,email:_0x494a0d,role:_0x15573c}=_0x433f12['user'],_0x33c8e7=_0x433f12['user'],_0x1d0ee9=await profile[_0x36858b(0x1ab)]({'email':_0x33c8e7['email']}),_0x11fb84=await master_shop[_0x36858b(0x18d)]();console[_0x36858b(0x197)](_0x36858b(0x164),_0x11fb84),console['log'](_0x433f12[_0x36858b(0x179)]['id']);const _0x2115fd=await customer['findOne']({'_id':_0x433f12[_0x36858b(0x179)]['id']});console['log']('customer_data',_0x2115fd);const _0x324b4a=await c_payment_data[_0x36858b(0x18d)]({'customer':_0x2115fd[_0x36858b(0x186)]});console[_0x36858b(0x197)](_0x324b4a);const _0x250a2a=await c_payment_data['aggregate']([{'$match':{'customer':_0x2115fd['name']}},{'$match':{'reason':_0x36858b(0x16f)}},{'$group':{'_id':_0x36858b(0x18e),'sum':{'$sum':_0x36858b(0x1a5)}}}]);console[_0x36858b(0x197)](_0x36858b(0x15d),_0x250a2a);const _0x1af11e=await c_payment_data[_0x36858b(0x171)]([{'$match':{'customer':_0x2115fd[_0x36858b(0x186)]}},{'$match':{'reason':_0x36858b(0x1a3)}},{'$group':{'_id':_0x36858b(0x18e),'sum':{'$sum':'$amount'}}}]);console[_0x36858b(0x197)](_0x36858b(0x167),_0x1af11e);if(_0x11fb84[0x0]['language']==_0x36858b(0x1a9)){var _0x5400cc=users[_0x36858b(0x182)];console[_0x36858b(0x197)](_0x5400cc);}else{if(_0x11fb84[0x0]['language']==_0x36858b(0x1b6))var _0x5400cc=users['Hindi'];else{if(_0x11fb84[0x0][_0x36858b(0x176)]==_0x36858b(0x158))var _0x5400cc=users[_0x36858b(0x158)];else{if(_0x11fb84[0x0][_0x36858b(0x176)]=='Spanish')var _0x5400cc=users[_0x36858b(0x16b)];else{if(_0x11fb84[0x0]['language']==_0x36858b(0x195))var _0x5400cc=users[_0x36858b(0x195)];else{if(_0x11fb84[0x0][_0x36858b(0x176)]=='Portuguese\x20(BR)')var _0x5400cc=users[_0x36858b(0x159)];else{if(_0x11fb84[0x0]['language']==_0x36858b(0x162))var _0x5400cc=users['Chinese'];else{if(_0x11fb84[0x0][_0x36858b(0x176)]=='Arabic\x20(ae)')var _0x5400cc=users[_0x36858b(0x168)];}}}}}}}_0x422fd8[_0x36858b(0x155)](_0x36858b(0x1b8),{'success':_0x433f12[_0x36858b(0x17d)]('success'),'errors':_0x433f12[_0x36858b(0x17d)](_0x36858b(0x194)),'role':_0x33c8e7,'profile':_0x1d0ee9,'payment':_0x324b4a,'payable':_0x250a2a,'receivable':_0x1af11e,'master_shop':_0x11fb84,'language':_0x5400cc});}catch(_0xefd6a8){console[_0x36858b(0x197)](_0xefd6a8);}}),router[a0_0x2d0987(0x15e)](a0_0x2d0987(0x169),auth,async(_0x217acd,_0x537b95)=>{const _0x1141f5=a0_0x2d0987;try{const _0x40b432=new excelJS[(_0x1141f5(0x172))](),_0x497aa6=_0x40b432[_0x1141f5(0x193)](_0x1141f5(0x17c));return _0x497aa6[_0x1141f5(0x19f)]=[{'header':'ID','key':_0x1141f5(0x19e),'width':0xa},{'header':_0x1141f5(0x178),'key':'PBrands','width':0xa},{'header':_0x1141f5(0x1b7),'key':_0x1141f5(0x1b1),'width':0xa},{'header':_0x1141f5(0x157),'key':_0x1141f5(0x157),'width':0xa},{'header':_0x1141f5(0x1bb),'key':_0x1141f5(0x1bb),'width':0xa},{'header':_0x1141f5(0x166),'key':_0x1141f5(0x166),'width':0xa},{'header':'email','key':_0x1141f5(0x1ba),'width':0xa}],_0x537b95[_0x1141f5(0x18b)]('Content-Type',_0x1141f5(0x196)),_0x537b95[_0x1141f5(0x18b)](_0x1141f5(0x190),_0x1141f5(0x1b3)),_0x40b432['xlsx'][_0x1141f5(0x17f)](_0x537b95)[_0x1141f5(0x170)](()=>{_0x537b95['status'](0xc8);});}catch(_0xd85028){_0x537b95['status'](0x190)[_0x1141f5(0x192)]({'errors':_0xd85028['message']});}});const storage1=multer['diskStorage']({'destination':(_0x22eda8,_0x3f4ec6,_0x3574c0)=>{const _0x164f49=a0_0x2d0987;_0x3574c0(null,_0x164f49(0x16c));},'filename':(_0x5067fc,_0x2b8b24,_0x15f53f)=>{const _0x357803=a0_0x2d0987;_0x15f53f(null,Date[_0x357803(0x19d)]()+_0x2b8b24[_0x357803(0x151)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x4add(_0x31a8c0,_0x1e6f3a){const _0xcf502c=a0_0xcf50();return a0_0x4add=function(_0x4add44,_0x45bc8d){_0x4add44=_0x4add44-0x14e;let _0x5f4031=_0xcf502c[_0x4add44];return _0x5f4031;},a0_0x4add(_0x31a8c0,_0x1e6f3a);}router[a0_0x2d0987(0x19a)](a0_0x2d0987(0x1a8),auth,uploadMigrate[a0_0x2d0987(0x19b)](a0_0x2d0987(0x1a2)),async(_0x1077a5,_0x14973a)=>{const _0x2952ab=a0_0x2d0987,_0x28bdd9=_0x1077a5['file'][_0x2952ab(0x16d)],_0x3f102b=await xlsx[_0x2952ab(0x1af)](_0x2952ab(0x153)+_0x28bdd9);let _0x13dbd8=_0x3f102b[_0x2952ab(0x17e)],_0x3bce1d=xlsx[_0x2952ab(0x1b4)][_0x2952ab(0x1ac)](_0x3f102b[_0x2952ab(0x163)][_0x13dbd8[0x0]]);for(const _0x37af46 of _0x3bce1d){const _0x51c600=_0x37af46['ID'],_0x5a74e7=_0x37af46[_0x2952ab(0x178)],_0x209671=_0x37af46[_0x2952ab(0x1b7)],_0x4c2573=_0x37af46['SalesmanName'],_0x1f1ed0=_0x37af46['address'],_0x42cb20=_0x37af46[_0x2952ab(0x166)],_0x436901=_0x37af46[_0x2952ab(0x1ba)];try{let _0x537cad=await customer[_0x2952ab(0x1ab)]({'name':_0x5a74e7});if(!_0x537cad){const _0x35fa1f=new customer({'name':_0x5a74e7,'ID':_0x51c600,'SalesmanCode':_0x209671,'SalesmanName':_0x4c2573,'address':_0x1f1ed0,'mobile':_0x42cb20,'email':_0x436901});_0x537cad=await _0x35fa1f[_0x2952ab(0x15c)](),_0x1077a5[_0x2952ab(0x17d)](_0x2952ab(0x1a4),_0x5a74e7+_0x2952ab(0x1b0));}else _0x1077a5['flash'](_0x2952ab(0x15a),_0x5a74e7+_0x2952ab(0x181));}catch(_0x28e213){_0x14973a[_0x2952ab(0x165)](0x1f4)[_0x2952ab(0x17a)]({'proderror':_0x28e213[_0x2952ab(0x18c)],'aproduct':ProductName});}}_0x14973a['redirect']('/customer/view');}),module['exports']=router;