const a0_0x17034e=a0_0x26f6;(function(_0x36e71f,_0x3758de){const _0x11d921=a0_0x26f6,_0x555b52=_0x36e71f();while(!![]){try{const _0x1bc890=parseInt(_0x11d921(0x141))/0x1+parseInt(_0x11d921(0xf1))/0x2+parseInt(_0x11d921(0xe9))/0x3*(parseInt(_0x11d921(0xed))/0x4)+-parseInt(_0x11d921(0x10f))/0x5+parseInt(_0x11d921(0x112))/0x6*(-parseInt(_0x11d921(0x133))/0x7)+parseInt(_0x11d921(0x10e))/0x8+-parseInt(_0x11d921(0xe5))/0x9*(parseInt(_0x11d921(0x109))/0xa);if(_0x1bc890===_0x3758de)break;else _0x555b52['push'](_0x555b52['shift']());}catch(_0x12699f){_0x555b52['push'](_0x555b52['shift']());}}}(a0_0x6b1e,0x42a14));const express=require('express'),app=express(),router=express[a0_0x17034e(0x115)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x17034e(0xfe)),users=require(a0_0x17034e(0xeb)),excelJS=require(a0_0x17034e(0xef)),xlsx=require('xlsx'),multer=require(a0_0x17034e(0x107));function a0_0x6b1e(){const _0x48ca07=['addWorksheet','params','post','render','redirect','findById','payment_data','Content-Disposition','address','/products_export_migrate_file','27btCFCb','Hindi','originalname','message','6eDjIEd','customer\x20update\x20successfully','../public/language/languages.json','forEach','964460DNIFDa','language','exceljs','Portuguese\x20(BR)','65594flxhMG','user','save','get','Name','then','customer\x20add\x20successfully','Chinese','mobile','Sale\x20Return','English','/customer/view','\x20added\x20successfully','../middleware/auth','contactperson','Arabic','flash','SalesmanName','single','public/Migration/','Workbook','sheet_to_json','multer','utils','1901590krGVQD','Customers','write','SheetNames','payable','3942712ZAYdhy','1500830CKmUIX','SalesmanCode','success','48rRpzKH','email','map','Router','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','data','amount','/view/payment/:id','Sale','findOne','/view/:id','master','customer_docs','Spanish','errors','now','aggregate','/view','receivable','log','$reason','columns','customer','sale_return','send','PUnits','French','Portuguese','name','Content-Type','status','PBrands','payable_sum','151235EvYZdB','$amount','German','readFile','json','xlsx','sale','setHeader','Arabic\x20(ae)','\x20Failed','body','find','element','English\x20(US)','308533sShmNh','reason','/customer_import_migrate_file','customer_data','receivable_sum','Sheets'];a0_0x6b1e=function(){return _0x48ca07;};return a0_0x6b1e();}router[a0_0x17034e(0xf4)](a0_0x17034e(0x123),auth,async(_0x3e7684,_0x519321)=>{const _0x439717=a0_0x17034e;try{const {username:_0x4452ff,email:_0x54853d,role:_0x20d874}=_0x3e7684[_0x439717(0xf2)],_0x111217=_0x3e7684[_0x439717(0xf2)],_0x1312bb=await profile[_0x439717(0x11b)]({'email':_0x111217[_0x439717(0x113)]}),_0xdfacb1=await master_shop[_0x439717(0x13e)]();console[_0x439717(0x125)]('master',_0xdfacb1);const _0x1fad59=await customer[_0x439717(0x13e)](),_0x5d6592=await customer[_0x439717(0x122)]([{'$lookup':{'from':'c_payments','localField':_0x439717(0x12e),'foreignField':_0x439717(0x128),'as':_0x439717(0x11e)}}]);console[_0x439717(0x125)](_0x5d6592);const _0x248e4d=_0x5d6592[_0x439717(0x114)](_0x114f37=>{const _0xde1993=_0x439717;console[_0xde1993(0x125)](_0xde1993(0x117),_0x114f37);var _0xe2c88c=0x0,_0x186008=0x0;return _0x114f37[_0xde1993(0x11e)][_0xde1993(0xec)](_0x152e82=>{const _0x5ca482=_0xde1993;console[_0x5ca482(0x125)](_0x5ca482(0x13f),_0x152e82),_0x152e82[_0x5ca482(0x142)]==_0x5ca482(0x11a)?_0xe2c88c+=_0x152e82[_0x5ca482(0x118)]:_0x186008+=_0x152e82[_0x5ca482(0x118)];}),_0x114f37[_0xde1993(0x139)]=parseFloat(_0xe2c88c)+0x0,_0x114f37[_0xde1993(0x129)]=parseFloat(_0x186008)+0x0,_0x114f37;});console[_0x439717(0x125)](_0x439717(0xe1),_0x248e4d);if(_0xdfacb1[0x0][_0x439717(0xee)]==_0x439717(0x140)){var _0x17d2cd=users[_0x439717(0xfb)];console[_0x439717(0x125)](_0x17d2cd);}else{if(_0xdfacb1[0x0][_0x439717(0xee)]==_0x439717(0xe6))var _0x17d2cd=users[_0x439717(0xe6)];else{if(_0xdfacb1[0x0]['language']==_0x439717(0x135))var _0x17d2cd=users[_0x439717(0x135)];else{if(_0xdfacb1[0x0][_0x439717(0xee)]==_0x439717(0x11f))var _0x17d2cd=users[_0x439717(0x11f)];else{if(_0xdfacb1[0x0][_0x439717(0xee)]==_0x439717(0x12c))var _0x17d2cd=users[_0x439717(0x12c)];else{if(_0xdfacb1[0x0][_0x439717(0xee)]==_0x439717(0xf0))var _0x17d2cd=users[_0x439717(0x12d)];else{if(_0xdfacb1[0x0][_0x439717(0xee)]==_0x439717(0xf8))var _0x17d2cd=users[_0x439717(0xf8)];else{if(_0xdfacb1[0x0][_0x439717(0xee)]==_0x439717(0x13b))var _0x17d2cd=users[_0x439717(0x100)];}}}}}}}_0x519321[_0x439717(0xde)]('customer',{'success':_0x3e7684[_0x439717(0x101)]('success'),'errors':_0x3e7684[_0x439717(0x101)]('errors'),'user':_0x1fad59,'role':_0x111217,'profile':_0x1312bb,'payment':_0x248e4d,'master_shop':_0xdfacb1,'language':_0x17d2cd});}catch(_0x49dc10){console[_0x439717(0x125)](_0x49dc10);}}),router[a0_0x17034e(0xdd)](a0_0x17034e(0x123),auth,async(_0x736d4d,_0x58ff74)=>{const _0x57717d=a0_0x17034e;try{const {name:_0x4c061f,address:_0x620cf9,mobile:_0x1e2ba4,email:_0x3e7317,receivable:_0x2f7b12,payable:_0x48579f,contactperson:_0x24a7ac,landline:_0x3d6bdd}=_0x736d4d[_0x57717d(0x13d)],_0xb79143=new customer({'name':_0x4c061f,'address':_0x620cf9,'mobile':_0x1e2ba4,'email':_0x3e7317,'receivable':_0x2f7b12,'payable':_0x48579f,'contactperson':_0x24a7ac,'landline':_0x3d6bdd}),_0x336a0a=await _0xb79143[_0x57717d(0xf3)]();_0x736d4d['flash']('success',_0x57717d(0xf7)),_0x58ff74[_0x57717d(0xdf)](_0x57717d(0xfc));}catch(_0x59bf8d){console['log'](_0x59bf8d);}}),router[a0_0x17034e(0xf4)]('/view/:id',auth,async(_0x261a4a,_0x31e5b4)=>{const _0xf7803c=a0_0x17034e;try{const {username:_0xed80a4,email:_0x38b088,role:_0x4cd5dc}=_0x261a4a[_0xf7803c(0xf2)],_0x3bd447=_0x261a4a[_0xf7803c(0xf2)],_0x5167eb=await profile[_0xf7803c(0x11b)]({'email':_0x3bd447['email']}),_0x3a3245=await master_shop['find']();console[_0xf7803c(0x125)](_0xf7803c(0x11d),_0x3a3245);const _0x4ea540=_0x261a4a[_0xf7803c(0xdc)]['id'],_0x322b93=await customer[_0xf7803c(0xe0)](_0x4ea540);if(_0x3a3245[0x0][_0xf7803c(0xee)]==_0xf7803c(0x140)){var _0xbee2a9=users[_0xf7803c(0xfb)];console[_0xf7803c(0x125)](_0xbee2a9);}else{if(_0x3a3245[0x0][_0xf7803c(0xee)]==_0xf7803c(0xe6))var _0xbee2a9=users['Hindi'];else{if(_0x3a3245[0x0][_0xf7803c(0xee)]==_0xf7803c(0x135))var _0xbee2a9=users[_0xf7803c(0x135)];else{if(_0x3a3245[0x0]['language']==_0xf7803c(0x11f))var _0xbee2a9=users['Spanish'];else{if(_0x3a3245[0x0][_0xf7803c(0xee)]==_0xf7803c(0x12c))var _0xbee2a9=users[_0xf7803c(0x12c)];else{if(_0x3a3245[0x0][_0xf7803c(0xee)]==_0xf7803c(0xf0))var _0xbee2a9=users[_0xf7803c(0x12d)];else{if(_0x3a3245[0x0][_0xf7803c(0xee)]=='Chinese')var _0xbee2a9=users[_0xf7803c(0xf8)];else{if(_0x3a3245[0x0][_0xf7803c(0xee)]==_0xf7803c(0x13b))var _0xbee2a9=users[_0xf7803c(0x100)];}}}}}}}_0x31e5b4['render'](_0xf7803c(0x128),{'success':_0x261a4a[_0xf7803c(0x101)](_0xf7803c(0x111)),'errors':_0x261a4a['flash']('errors'),'role':_0x3bd447,'profile':_0x5167eb,'user':_0x322b93,'master_shop':_0x3a3245,'language':_0xbee2a9});}catch(_0x4256a8){console[_0xf7803c(0x125)](_0x4256a8);}}),router[a0_0x17034e(0xdd)](a0_0x17034e(0x11c),auth,async(_0x59028b,_0x5dc4b8)=>{const _0x217d60=a0_0x17034e;try{const _0x27ad7a=_0x59028b[_0x217d60(0xdc)]['id'],_0x52e57d=await customer[_0x217d60(0xe0)](_0x27ad7a),{name:_0xe09ecc,address:_0x3e6bf8,mobile:_0x457b40,email:_0x2cf054,receivable:_0x132931,payable:_0x305d19,contactperson:_0x2d38e4,landline:_0x3bd2eb}=_0x59028b[_0x217d60(0x13d)];_0x52e57d[_0x217d60(0x12e)]=_0xe09ecc,_0x52e57d[_0x217d60(0xe3)]=_0x3e6bf8,_0x52e57d[_0x217d60(0xf9)]=_0x457b40,_0x52e57d[_0x217d60(0x113)]=_0x2cf054,_0x52e57d[_0x217d60(0x124)]=_0x132931,_0x52e57d[_0x217d60(0x10d)]=_0x305d19,_0x52e57d[_0x217d60(0xff)]=_0x2d38e4,_0x52e57d['landline']=_0x3bd2eb;const _0x2ec567=await _0x52e57d['save']();_0x59028b[_0x217d60(0x101)](_0x217d60(0x111),_0x217d60(0xea)),_0x5dc4b8[_0x217d60(0xdf)](_0x217d60(0xfc));}catch(_0x1bc003){console[_0x217d60(0x125)](_0x1bc003);}}),router[a0_0x17034e(0xf4)](a0_0x17034e(0x119),auth,async(_0x188481,_0x49a724)=>{const _0x15d181=a0_0x17034e;try{const {username:_0x50ae1b,email:_0x4d891b,role:_0xe8c910}=_0x188481['user'],_0x2a0a6b=_0x188481[_0x15d181(0xf2)],_0x18c4f3=await profile['findOne']({'email':_0x2a0a6b[_0x15d181(0x113)]}),_0x8c5cd5=await master_shop[_0x15d181(0x13e)]();console[_0x15d181(0x125)](_0x15d181(0x11d),_0x8c5cd5),console[_0x15d181(0x125)](_0x188481[_0x15d181(0xdc)]['id']);const _0x315d10=await customer[_0x15d181(0x11b)]({'_id':_0x188481[_0x15d181(0xdc)]['id']});console['log'](_0x15d181(0xd8),_0x315d10);const _0x265a0f=await c_payment_data['find']({'customer':_0x315d10[_0x15d181(0x12e)]});console['log'](_0x265a0f);const _0x16924d=await c_payment_data[_0x15d181(0x122)]([{'$match':{'customer':_0x315d10[_0x15d181(0x12e)]}},{'$match':{'reason':_0x15d181(0x11a)}},{'$group':{'_id':_0x15d181(0x126),'sum':{'$sum':_0x15d181(0x134)}}}]);console[_0x15d181(0x125)](_0x15d181(0x132),_0x16924d);const _0xca050=await c_payment_data[_0x15d181(0x122)]([{'$match':{'customer':_0x315d10[_0x15d181(0x12e)]}},{'$match':{'reason':_0x15d181(0xfa)}},{'$group':{'_id':'$reason','sum':{'$sum':'$amount'}}}]);console[_0x15d181(0x125)](_0x15d181(0xd9),_0xca050);if(_0x8c5cd5[0x0]['language']==_0x15d181(0x140)){var _0x3dd256=users['English'];console['log'](_0x3dd256);}else{if(_0x8c5cd5[0x0]['language']==_0x15d181(0xe6))var _0x3dd256=users['Hindi'];else{if(_0x8c5cd5[0x0][_0x15d181(0xee)]=='German')var _0x3dd256=users[_0x15d181(0x135)];else{if(_0x8c5cd5[0x0][_0x15d181(0xee)]=='Spanish')var _0x3dd256=users[_0x15d181(0x11f)];else{if(_0x8c5cd5[0x0][_0x15d181(0xee)]=='French')var _0x3dd256=users[_0x15d181(0x12c)];else{if(_0x8c5cd5[0x0][_0x15d181(0xee)]=='Portuguese\x20(BR)')var _0x3dd256=users['Portuguese'];else{if(_0x8c5cd5[0x0][_0x15d181(0xee)]==_0x15d181(0xf8))var _0x3dd256=users[_0x15d181(0xf8)];else{if(_0x8c5cd5[0x0][_0x15d181(0xee)]=='Arabic\x20(ae)')var _0x3dd256=users['Arabic'];}}}}}}}_0x49a724[_0x15d181(0xde)]('customer_payment',{'success':_0x188481[_0x15d181(0x101)](_0x15d181(0x111)),'errors':_0x188481[_0x15d181(0x101)](_0x15d181(0x120)),'role':_0x2a0a6b,'profile':_0x18c4f3,'payment':_0x265a0f,'payable':_0x16924d,'receivable':_0xca050,'master_shop':_0x8c5cd5,'language':_0x3dd256});}catch(_0x43225c){console[_0x15d181(0x125)](_0x43225c);}}),router['get'](a0_0x17034e(0xe4),auth,async(_0x3fbf18,_0x5811e8)=>{const _0x3a1360=a0_0x17034e;try{const _0x9d5cd5=new excelJS[(_0x3a1360(0x105))](),_0x177c07=_0x9d5cd5[_0x3a1360(0xdb)](_0x3a1360(0x10a));return _0x177c07[_0x3a1360(0x127)]=[{'header':'ID','key':'PName','width':0xa},{'header':_0x3a1360(0xf5),'key':_0x3a1360(0x131),'width':0xa},{'header':_0x3a1360(0x110),'key':_0x3a1360(0x12b),'width':0xa},{'header':_0x3a1360(0x102),'key':_0x3a1360(0x102),'width':0xa},{'header':_0x3a1360(0xe3),'key':_0x3a1360(0xe3),'width':0xa},{'header':_0x3a1360(0xf9),'key':_0x3a1360(0xf9),'width':0xa},{'header':_0x3a1360(0x113),'key':_0x3a1360(0x113),'width':0xa}],_0x5811e8[_0x3a1360(0x13a)](_0x3a1360(0x12f),_0x3a1360(0x116)),_0x5811e8[_0x3a1360(0x13a)](_0x3a1360(0xe2),'attachment;\x20filename=customer_Migration_File.xlsx'),_0x9d5cd5[_0x3a1360(0x138)][_0x3a1360(0x10b)](_0x5811e8)[_0x3a1360(0xf6)](()=>{const _0x3b9cf0=_0x3a1360;_0x5811e8[_0x3b9cf0(0x130)](0xc8);});}catch(_0x19de67){_0x5811e8[_0x3a1360(0x130)](0x190)[_0x3a1360(0x12a)]({'errors':_0x19de67[_0x3a1360(0xe8)]});}});function a0_0x26f6(_0x1131ba,_0x135282){const _0x6b1e4a=a0_0x6b1e();return a0_0x26f6=function(_0x26f61d,_0x1dd027){_0x26f61d=_0x26f61d-0xd8;let _0x53e521=_0x6b1e4a[_0x26f61d];return _0x53e521;},a0_0x26f6(_0x1131ba,_0x135282);}const storage1=multer['diskStorage']({'destination':(_0x529d7f,_0x23998b,_0x400b6f)=>{_0x400b6f(null,'public/Migration');},'filename':(_0x2a75ac,_0x12b255,_0x5d02a4)=>{const _0x35cfb0=a0_0x17034e;_0x5d02a4(null,Date[_0x35cfb0(0x121)]()+_0x12b255[_0x35cfb0(0xe7)]);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x17034e(0x143),auth,uploadMigrate[a0_0x17034e(0x103)]('customer_product_fule'),async(_0x1eda66,_0x4cf5f5)=>{const _0x4bee6b=a0_0x17034e,_0x46000e=_0x1eda66['file']['filename'],_0x7ef56c=await xlsx[_0x4bee6b(0x136)](_0x4bee6b(0x104)+_0x46000e);let _0x5c8e2d=_0x7ef56c[_0x4bee6b(0x10c)],_0x58087b=xlsx[_0x4bee6b(0x108)][_0x4bee6b(0x106)](_0x7ef56c[_0x4bee6b(0xda)][_0x5c8e2d[0x0]]);for(const _0x4d5706 of _0x58087b){const _0xba2973=_0x4d5706['ID'],_0xff49a9=_0x4d5706[_0x4bee6b(0xf5)],_0x273311=_0x4d5706[_0x4bee6b(0x110)],_0x12f77d=_0x4d5706[_0x4bee6b(0x102)],_0x3ed56a=_0x4d5706['address'],_0x19d084=_0x4d5706[_0x4bee6b(0xf9)],_0x558a55=_0x4d5706[_0x4bee6b(0x113)];try{let _0x43c3e2=await customer['findOne']({'name':_0xff49a9});if(!_0x43c3e2){const _0x7540c8=new customer({'name':_0xff49a9,'ID':_0xba2973,'SalesmanCode':_0x273311,'SalesmanName':_0x12f77d,'address':_0x3ed56a,'mobile':_0x19d084,'email':_0x558a55});_0x43c3e2=await _0x7540c8[_0x4bee6b(0xf3)](),_0x1eda66[_0x4bee6b(0x101)](_0x4bee6b(0x111),_0xff49a9+_0x4bee6b(0xfd));}else _0x1eda66['flash']('error',_0xff49a9+_0x4bee6b(0x13c));}catch(_0x51d475){_0x4cf5f5[_0x4bee6b(0x130)](0x1f4)[_0x4bee6b(0x137)]({'proderror':_0x51d475[_0x4bee6b(0xe8)],'aproduct':ProductName});}}_0x4cf5f5[_0x4bee6b(0xdf)](_0x4bee6b(0xfc));}),module['exports']=router;