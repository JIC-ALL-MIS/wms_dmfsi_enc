const a0_0x34beb7=a0_0x1e9c;(function(_0x247b41,_0x133b25){const _0x2eca1b=a0_0x1e9c,_0x3325e2=_0x247b41();while(!![]){try{const _0xb65bf8=-parseInt(_0x2eca1b(0xec))/0x1+-parseInt(_0x2eca1b(0xab))/0x2*(-parseInt(_0x2eca1b(0xe5))/0x3)+parseInt(_0x2eca1b(0xc6))/0x4*(-parseInt(_0x2eca1b(0x99))/0x5)+-parseInt(_0x2eca1b(0xf2))/0x6*(-parseInt(_0x2eca1b(0xa5))/0x7)+-parseInt(_0x2eca1b(0x89))/0x8+parseInt(_0x2eca1b(0xe9))/0x9+-parseInt(_0x2eca1b(0xdf))/0xa*(-parseInt(_0x2eca1b(0xa2))/0xb);if(_0xb65bf8===_0x133b25)break;else _0x3325e2['push'](_0x3325e2['shift']());}catch(_0x191591){_0x3325e2['push'](_0x3325e2['shift']());}}}(a0_0x2bec,0xc9a74));const express=require(a0_0x34beb7(0xa1)),app=express(),router=express[a0_0x34beb7(0xb6)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x34beb7(0xb7)),auth=require(a0_0x34beb7(0xe3)),users=require(a0_0x34beb7(0xcd)),excelJS=require(a0_0x34beb7(0xda)),xlsx=require(a0_0x34beb7(0x8f)),multer=require(a0_0x34beb7(0xea));router['get'](a0_0x34beb7(0xce),auth,async(_0x46afe2,_0x28cb62)=>{const _0x3d19a3=a0_0x34beb7;try{const {username:_0x137fa2,email:_0x404bfd,role:_0x50e413}=_0x46afe2[_0x3d19a3(0xf0)],_0x2f135a=_0x46afe2['user'],_0x283c0a=await profile[_0x3d19a3(0xed)]({'email':_0x2f135a['email']}),_0x63b1cd=await master_shop[_0x3d19a3(0xbd)]();console[_0x3d19a3(0xa6)](_0x3d19a3(0xb8),_0x63b1cd);const _0x41e46d=await customer[_0x3d19a3(0xbd)](),_0x299fad=await customer['aggregate']([{'$lookup':{'from':_0x3d19a3(0xa3),'localField':'name','foreignField':'customer','as':_0x3d19a3(0xba)}}]);console[_0x3d19a3(0xa6)](_0x299fad);const _0x1ede5d=_0x299fad[_0x3d19a3(0x9f)](_0x2080df=>{const _0x55baa9=_0x3d19a3;console[_0x55baa9(0xa6)](_0x55baa9(0xbf),_0x2080df);var _0x3b0303=0x0,_0x4fa1f3=0x0;return _0x2080df['customer_docs']['forEach'](_0x2ebc6c=>{const _0xd61ae0=_0x55baa9;console[_0xd61ae0(0xa6)]('element',_0x2ebc6c),_0x2ebc6c[_0xd61ae0(0x95)]==_0xd61ae0(0xcc)?_0x3b0303+=_0x2ebc6c[_0xd61ae0(0xc7)]:_0x4fa1f3+=_0x2ebc6c[_0xd61ae0(0xc7)];}),_0x2080df[_0x55baa9(0xe8)]=parseFloat(_0x3b0303)+0x0,_0x2080df[_0x55baa9(0x9b)]=parseFloat(_0x4fa1f3)+0x0,_0x2080df;});console['log'](_0x3d19a3(0x93),_0x1ede5d);if(_0x63b1cd[0x0][_0x3d19a3(0xee)]==_0x3d19a3(0xd1)){var _0x24085a=users[_0x3d19a3(0xd4)];console[_0x3d19a3(0xa6)](_0x24085a);}else{if(_0x63b1cd[0x0][_0x3d19a3(0xee)]==_0x3d19a3(0x98))var _0x24085a=users[_0x3d19a3(0x98)];else{if(_0x63b1cd[0x0][_0x3d19a3(0xee)]=='German')var _0x24085a=users[_0x3d19a3(0xd8)];else{if(_0x63b1cd[0x0][_0x3d19a3(0xee)]==_0x3d19a3(0xc3))var _0x24085a=users[_0x3d19a3(0xc3)];else{if(_0x63b1cd[0x0][_0x3d19a3(0xee)]==_0x3d19a3(0xe0))var _0x24085a=users[_0x3d19a3(0xe0)];else{if(_0x63b1cd[0x0][_0x3d19a3(0xee)]==_0x3d19a3(0xe2))var _0x24085a=users[_0x3d19a3(0xa7)];else{if(_0x63b1cd[0x0][_0x3d19a3(0xee)]==_0x3d19a3(0xdd))var _0x24085a=users[_0x3d19a3(0xdd)];else{if(_0x63b1cd[0x0]['language']=='Arabic\x20(ae)')var _0x24085a=users[_0x3d19a3(0xe7)];}}}}}}}_0x28cb62[_0x3d19a3(0xc8)]('customer',{'success':_0x46afe2['flash'](_0x3d19a3(0xaf)),'errors':_0x46afe2['flash']('errors'),'user':_0x41e46d,'role':_0x2f135a,'profile':_0x283c0a,'payment':_0x1ede5d,'master_shop':_0x63b1cd,'language':_0x24085a});}catch(_0x39e73){console[_0x3d19a3(0xa6)](_0x39e73);}}),router[a0_0x34beb7(0x8d)](a0_0x34beb7(0xce),auth,async(_0x29b6c0,_0x3db785)=>{const _0x4b1dca=a0_0x34beb7;try{const {name:_0x39b10e,address:_0x4b97b6,mobile:_0x3efe31,email:_0x49d27d,receivable:_0x77929,payable:_0x1310ef,contactperson:_0xe0fe31,landline:_0x216749}=_0x29b6c0[_0x4b1dca(0xb0)],_0x1d9561=new customer({'name':_0x39b10e,'address':_0x4b97b6,'mobile':_0x3efe31,'email':_0x49d27d,'receivable':_0x77929,'payable':_0x1310ef,'contactperson':_0xe0fe31,'landline':_0x216749}),_0x4e2c9f=await _0x1d9561[_0x4b1dca(0xeb)]();_0x29b6c0[_0x4b1dca(0xdb)](_0x4b1dca(0xaf),'customer\x20add\x20successfully'),_0x3db785[_0x4b1dca(0xde)]('/customer/view');}catch(_0x25bcf7){console[_0x4b1dca(0xa6)](_0x25bcf7);}}),router[a0_0x34beb7(0x9c)]('/view/:id',auth,async(_0x157847,_0x4766a0)=>{const _0x52ce4a=a0_0x34beb7;try{const {username:_0x418911,email:_0x2367cf,role:_0x5f9513}=_0x157847[_0x52ce4a(0xf0)],_0x51c7d9=_0x157847[_0x52ce4a(0xf0)],_0x59a23c=await profile[_0x52ce4a(0xed)]({'email':_0x51c7d9[_0x52ce4a(0xbb)]}),_0x59ba08=await master_shop[_0x52ce4a(0xbd)]();console[_0x52ce4a(0xa6)]('master',_0x59ba08);const _0x255b42=_0x157847[_0x52ce4a(0xf4)]['id'],_0x324582=await customer[_0x52ce4a(0xb2)](_0x255b42);if(_0x59ba08[0x0]['language']==_0x52ce4a(0xd1)){var _0xec3a2d=users[_0x52ce4a(0xd4)];console['log'](_0xec3a2d);}else{if(_0x59ba08[0x0][_0x52ce4a(0xee)]==_0x52ce4a(0x98))var _0xec3a2d=users[_0x52ce4a(0x98)];else{if(_0x59ba08[0x0]['language']=='German')var _0xec3a2d=users[_0x52ce4a(0xd8)];else{if(_0x59ba08[0x0][_0x52ce4a(0xee)]==_0x52ce4a(0xc3))var _0xec3a2d=users[_0x52ce4a(0xc3)];else{if(_0x59ba08[0x0]['language']==_0x52ce4a(0xe0))var _0xec3a2d=users[_0x52ce4a(0xe0)];else{if(_0x59ba08[0x0]['language']==_0x52ce4a(0xe2))var _0xec3a2d=users[_0x52ce4a(0xa7)];else{if(_0x59ba08[0x0][_0x52ce4a(0xee)]=='Chinese')var _0xec3a2d=users[_0x52ce4a(0xdd)];else{if(_0x59ba08[0x0]['language']==_0x52ce4a(0xf3))var _0xec3a2d=users[_0x52ce4a(0xe7)];}}}}}}}_0x4766a0[_0x52ce4a(0xc8)](_0x52ce4a(0xc9),{'success':_0x157847[_0x52ce4a(0xdb)](_0x52ce4a(0xaf)),'errors':_0x157847['flash'](_0x52ce4a(0x8e)),'role':_0x51c7d9,'profile':_0x59a23c,'user':_0x324582,'master_shop':_0x59ba08,'language':_0xec3a2d});}catch(_0x206e5f){console[_0x52ce4a(0xa6)](_0x206e5f);}}),router[a0_0x34beb7(0x8d)](a0_0x34beb7(0xb5),auth,async(_0x228866,_0x630a59)=>{const _0xc1b9b1=a0_0x34beb7;try{const _0x3f2705=_0x228866[_0xc1b9b1(0xf4)]['id'],_0x521e15=await customer[_0xc1b9b1(0xb2)](_0x3f2705),{name:_0x10fd3d,address:_0xf7664d,mobile:_0xfdb8d9,email:_0x190686,receivable:_0x3a018c,payable:_0x3686df,contactperson:_0x4a09f6,landline:_0x52c4e1}=_0x228866[_0xc1b9b1(0xb0)];_0x521e15[_0xc1b9b1(0xf1)]=_0x10fd3d,_0x521e15[_0xc1b9b1(0xaa)]=_0xf7664d,_0x521e15['mobile']=_0xfdb8d9,_0x521e15[_0xc1b9b1(0xbb)]=_0x190686,_0x521e15[_0xc1b9b1(0xbc)]=_0x3a018c,_0x521e15['payable']=_0x3686df,_0x521e15[_0xc1b9b1(0xe1)]=_0x4a09f6,_0x521e15[_0xc1b9b1(0xe6)]=_0x52c4e1;const _0xe34bf9=await _0x521e15[_0xc1b9b1(0xeb)]();_0x228866[_0xc1b9b1(0xdb)](_0xc1b9b1(0xaf),'customer\x20update\x20successfully'),_0x630a59['redirect'](_0xc1b9b1(0xb9));}catch(_0x2f870b){console[_0xc1b9b1(0xa6)](_0x2f870b);}}),router[a0_0x34beb7(0x9c)](a0_0x34beb7(0xca),auth,async(_0x2c421a,_0x3b9a03)=>{const _0x339102=a0_0x34beb7;try{const {username:_0x16a18e,email:_0x58430f,role:_0x167a22}=_0x2c421a[_0x339102(0xf0)],_0x15f2f9=_0x2c421a['user'],_0x79760d=await profile[_0x339102(0xed)]({'email':_0x15f2f9[_0x339102(0xbb)]}),_0x2457e7=await master_shop[_0x339102(0xbd)]();console[_0x339102(0xa6)](_0x339102(0xb8),_0x2457e7),console[_0x339102(0xa6)](_0x2c421a[_0x339102(0xf4)]['id']);const _0xd73a36=await customer[_0x339102(0xed)]({'_id':_0x2c421a[_0x339102(0xf4)]['id']});console[_0x339102(0xa6)](_0x339102(0x8b),_0xd73a36);const _0x268b45=await c_payment_data[_0x339102(0xbd)]({'customer':_0xd73a36[_0x339102(0xf1)]});console[_0x339102(0xa6)](_0x268b45);const _0x5693af=await c_payment_data[_0x339102(0xad)]([{'$match':{'customer':_0xd73a36['name']}},{'$match':{'reason':'Sale'}},{'$group':{'_id':_0x339102(0xc5),'sum':{'$sum':'$amount'}}}]);console[_0x339102(0xa6)]('payable_sum',_0x5693af);const _0x37a534=await c_payment_data[_0x339102(0xad)]([{'$match':{'customer':_0xd73a36[_0x339102(0xf1)]}},{'$match':{'reason':_0x339102(0x96)}},{'$group':{'_id':_0x339102(0xc5),'sum':{'$sum':'$amount'}}}]);console[_0x339102(0xa6)](_0x339102(0x9e),_0x37a534);if(_0x2457e7[0x0][_0x339102(0xee)]=='English\x20(US)'){var _0x14963d=users[_0x339102(0xd4)];console['log'](_0x14963d);}else{if(_0x2457e7[0x0][_0x339102(0xee)]=='Hindi')var _0x14963d=users['Hindi'];else{if(_0x2457e7[0x0][_0x339102(0xee)]==_0x339102(0xd8))var _0x14963d=users[_0x339102(0xd8)];else{if(_0x2457e7[0x0][_0x339102(0xee)]==_0x339102(0xc3))var _0x14963d=users['Spanish'];else{if(_0x2457e7[0x0][_0x339102(0xee)]=='French')var _0x14963d=users[_0x339102(0xe0)];else{if(_0x2457e7[0x0][_0x339102(0xee)]==_0x339102(0xe2))var _0x14963d=users[_0x339102(0xa7)];else{if(_0x2457e7[0x0][_0x339102(0xee)]==_0x339102(0xdd))var _0x14963d=users[_0x339102(0xdd)];else{if(_0x2457e7[0x0]['language']=='Arabic\x20(ae)')var _0x14963d=users[_0x339102(0xe7)];}}}}}}}_0x3b9a03['render'](_0x339102(0xa8),{'success':_0x2c421a['flash']('success'),'errors':_0x2c421a[_0x339102(0xdb)](_0x339102(0x8e)),'role':_0x15f2f9,'profile':_0x79760d,'payment':_0x268b45,'payable':_0x5693af,'receivable':_0x37a534,'master_shop':_0x2457e7,'language':_0x14963d});}catch(_0x5a5b90){console[_0x339102(0xa6)](_0x5a5b90);}}),router['get'](a0_0x34beb7(0x97),auth,async(_0x5bde31,_0x3246a4)=>{const _0x5ed0cf=a0_0x34beb7;try{const _0x57ba8b=new excelJS[(_0x5ed0cf(0xac))](),_0x42f7aa=_0x57ba8b[_0x5ed0cf(0x94)](_0x5ed0cf(0xdc));return _0x42f7aa[_0x5ed0cf(0x92)]=[{'header':'ID','key':_0x5ed0cf(0xd0),'width':0xa},{'header':_0x5ed0cf(0xc0),'key':_0x5ed0cf(0xcf),'width':0xa},{'header':_0x5ed0cf(0xef),'key':_0x5ed0cf(0xa0),'width':0xa},{'header':_0x5ed0cf(0x91),'key':_0x5ed0cf(0x91),'width':0xa},{'header':_0x5ed0cf(0xaa),'key':'address','width':0xa},{'header':_0x5ed0cf(0xe4),'key':_0x5ed0cf(0xe4),'width':0xa},{'header':_0x5ed0cf(0xbb),'key':_0x5ed0cf(0xbb),'width':0xa}],_0x3246a4[_0x5ed0cf(0xcb)](_0x5ed0cf(0x8c),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x3246a4[_0x5ed0cf(0xcb)]('Content-Disposition',_0x5ed0cf(0xd2)),_0x57ba8b[_0x5ed0cf(0x8f)][_0x5ed0cf(0xb3)](_0x3246a4)[_0x5ed0cf(0xae)](()=>{const _0x4167e8=_0x5ed0cf;_0x3246a4[_0x4167e8(0xc1)](0xc8);});}catch(_0x241fca){_0x3246a4[_0x5ed0cf(0xc1)](0x190)[_0x5ed0cf(0xd7)]({'errors':_0x241fca['message']});}});function a0_0x1e9c(_0x1de254,_0x503956){const _0x2bec16=a0_0x2bec();return a0_0x1e9c=function(_0x1e9c9d,_0x50f907){_0x1e9c9d=_0x1e9c9d-0x88;let _0x5d58ad=_0x2bec16[_0x1e9c9d];return _0x5d58ad;},a0_0x1e9c(_0x1de254,_0x503956);}const storage1=multer[a0_0x34beb7(0xd3)]({'destination':(_0x4db46d,_0x55ee6d,_0x136bc4)=>{const _0x40ba11=a0_0x34beb7;_0x136bc4(null,_0x40ba11(0xb1));},'filename':(_0x559705,_0x56a8cb,_0x7d0a04)=>{const _0x3cdebd=a0_0x34beb7;_0x7d0a04(null,Date['now']()+_0x56a8cb[_0x3cdebd(0x88)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x2bec(){const _0x1bd045=['PBrands','PName','English\x20(US)','attachment;\x20filename=customer_Migration_File.xlsx','diskStorage','English','customer_product_fule','json','send','German','exports','exceljs','flash','Customers','Chinese','redirect','1960PUofTM','French','contactperson','Portuguese\x20(BR)','../middleware/auth','mobile','3839343hOzWnl','landline','Arabic','sale','4846203XXWFGF','multer','save','896171PSLtQT','findOne','language','SalesmanCode','user','name','89448AKoPFo','Arabic\x20(ae)','params','originalname','3185096BBGpnn','filename','customer_data','Content-Type','post','errors','xlsx','message','SalesmanName','columns','payment_data','addWorksheet','reason','Sale\x20Return','/products_export_migrate_file','Hindi','5aEPNIw','\x20Failed','sale_return','get','file','receivable_sum','map','PUnits','express','34584ZAAUUN','c_payments','sheet_to_json','42VhyWDT','log','Portuguese','customer_payment','readFile','address','2WmqXbw','Workbook','aggregate','then','success','body','public/Migration','findById','write','utils','/view/:id','Router','../models/all_models','master','/customer/view','customer_docs','email','receivable','find','\x20added\x20successfully','data','Name','status','error','Spanish','SheetNames','$reason','1614560igmxSF','amount','render','customer','/view/payment/:id','setHeader','Sale','../public/language/languages.json','/view'];a0_0x2bec=function(){return _0x1bd045;};return a0_0x2bec();}router['post']('/customer_import_migrate_file',auth,uploadMigrate['single'](a0_0x34beb7(0xd5)),async(_0x5e467d,_0x53e57c)=>{const _0x5e6948=a0_0x34beb7,_0x43fb14=_0x5e467d[_0x5e6948(0x9d)][_0x5e6948(0x8a)],_0x616e8e=await xlsx[_0x5e6948(0xa9)]('public/Migration/'+_0x43fb14);let _0x4f4a41=_0x616e8e[_0x5e6948(0xc4)],_0xe5f88=xlsx[_0x5e6948(0xb4)][_0x5e6948(0xa4)](_0x616e8e['Sheets'][_0x4f4a41[0x0]]);for(const _0x1ce7ea of _0xe5f88){const _0x1fcd89=_0x1ce7ea['ID'],_0x4eb011=_0x1ce7ea['Name'],_0x5e82c4=_0x1ce7ea['SalesmanCode'],_0x13b55f=_0x1ce7ea[_0x5e6948(0x91)],_0x53cd71=_0x1ce7ea[_0x5e6948(0xaa)],_0x4f613c=_0x1ce7ea[_0x5e6948(0xe4)],_0x34b42c=_0x1ce7ea[_0x5e6948(0xbb)];try{let _0x68abf9=await customer['findOne']({'name':_0x4eb011});if(!_0x68abf9){const _0x492ec5=new customer({'name':_0x4eb011,'ID':_0x1fcd89,'SalesmanCode':_0x5e82c4,'SalesmanName':_0x13b55f,'address':_0x53cd71,'mobile':_0x4f613c,'email':_0x34b42c});_0x68abf9=await _0x492ec5['save'](),_0x5e467d['flash'](_0x5e6948(0xaf),_0x4eb011+_0x5e6948(0xbe));}else _0x5e467d[_0x5e6948(0xdb)](_0x5e6948(0xc2),_0x4eb011+_0x5e6948(0x9a));}catch(_0xf7fa7b){_0x53e57c[_0x5e6948(0xc1)](0x1f4)[_0x5e6948(0xd6)]({'proderror':_0xf7fa7b[_0x5e6948(0x90)],'aproduct':ProductName});}}_0x53e57c['redirect'](_0x5e6948(0xb9));}),module[a0_0x34beb7(0xd9)]=router;