const a0_0x3134af=a0_0x2897;(function(_0x5297c2,_0x209e99){const _0x65f119=a0_0x2897,_0x39a12c=_0x5297c2();while(!![]){try{const _0x140552=parseInt(_0x65f119(0xa5))/0x1*(parseInt(_0x65f119(0xe4))/0x2)+parseInt(_0x65f119(0xdb))/0x3+-parseInt(_0x65f119(0xcc))/0x4+-parseInt(_0x65f119(0xd0))/0x5*(-parseInt(_0x65f119(0x99))/0x6)+-parseInt(_0x65f119(0xa3))/0x7*(-parseInt(_0x65f119(0xba))/0x8)+-parseInt(_0x65f119(0xd8))/0x9+-parseInt(_0x65f119(0xdf))/0xa;if(_0x140552===_0x209e99)break;else _0x39a12c['push'](_0x39a12c['shift']());}catch(_0xe3e719){_0x39a12c['push'](_0x39a12c['shift']());}}}(a0_0x49f1,0xc5c95));const express=require(a0_0x3134af(0x9c)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x3134af(0xa9)),auth=require('../middleware/auth'),users=require(a0_0x3134af(0xc4)),excelJS=require(a0_0x3134af(0xf1)),xlsx=require(a0_0x3134af(0x92)),multer=require(a0_0x3134af(0x91));router[a0_0x3134af(0xab)]('/view',auth,async(_0x2ad6f9,_0x272160)=>{const _0x41fb98=a0_0x3134af;try{const {username:_0x489174,email:_0x47b8c1,role:_0x5ca8fe}=_0x2ad6f9['user'],_0x17300f=_0x2ad6f9[_0x41fb98(0xaa)],_0x5c0ab5=await profile[_0x41fb98(0x95)]({'email':_0x17300f[_0x41fb98(0xdc)]}),_0x34ec7d=await master_shop[_0x41fb98(0x9a)]();console[_0x41fb98(0xbe)](_0x41fb98(0xf0),_0x34ec7d);const _0x525160=await customer[_0x41fb98(0x9a)](),_0x420033=await customer['aggregate']([{'$lookup':{'from':'c_payments','localField':_0x41fb98(0xa2),'foreignField':'customer','as':_0x41fb98(0x97)}}]);console[_0x41fb98(0xbe)](_0x420033);const _0x3c60f4=_0x420033[_0x41fb98(0xd6)](_0x9c2929=>{const _0x56c227=_0x41fb98;console[_0x56c227(0xbe)](_0x56c227(0xe7),_0x9c2929);var _0x337a95=0x0,_0x398779=0x0;return _0x9c2929[_0x56c227(0x97)][_0x56c227(0xa4)](_0x575521=>{const _0x2db03e=_0x56c227;console[_0x2db03e(0xbe)](_0x2db03e(0xcd),_0x575521),_0x575521['reason']==_0x2db03e(0xc3)?_0x337a95+=_0x575521[_0x2db03e(0xe2)]:_0x398779+=_0x575521['amount'];}),_0x9c2929['sale']=parseFloat(_0x337a95)+0x0,_0x9c2929[_0x56c227(0xd9)]=parseFloat(_0x398779)+0x0,_0x9c2929;});console[_0x41fb98(0xbe)](_0x41fb98(0x9d),_0x3c60f4);if(_0x34ec7d[0x0][_0x41fb98(0xe6)]==_0x41fb98(0xb1)){var _0x39f8f5=users[_0x41fb98(0x9b)];console['log'](_0x39f8f5);}else{if(_0x34ec7d[0x0][_0x41fb98(0xe6)]==_0x41fb98(0x9f))var _0x39f8f5=users[_0x41fb98(0x9f)];else{if(_0x34ec7d[0x0]['language']=='German')var _0x39f8f5=users['German'];else{if(_0x34ec7d[0x0][_0x41fb98(0xe6)]==_0x41fb98(0xcb))var _0x39f8f5=users[_0x41fb98(0xcb)];else{if(_0x34ec7d[0x0]['language']=='French')var _0x39f8f5=users[_0x41fb98(0xb2)];else{if(_0x34ec7d[0x0][_0x41fb98(0xe6)]==_0x41fb98(0xa0))var _0x39f8f5=users[_0x41fb98(0xe9)];else{if(_0x34ec7d[0x0][_0x41fb98(0xe6)]==_0x41fb98(0xbd))var _0x39f8f5=users[_0x41fb98(0xbd)];else{if(_0x34ec7d[0x0][_0x41fb98(0xe6)]==_0x41fb98(0xe5))var _0x39f8f5=users[_0x41fb98(0xae)];}}}}}}}_0x272160[_0x41fb98(0xec)](_0x41fb98(0xe1),{'success':_0x2ad6f9[_0x41fb98(0xb6)](_0x41fb98(0xa1)),'errors':_0x2ad6f9[_0x41fb98(0xb6)](_0x41fb98(0xda)),'user':_0x525160,'role':_0x17300f,'profile':_0x5c0ab5,'payment':_0x3c60f4,'master_shop':_0x34ec7d,'language':_0x39f8f5});}catch(_0x20ce23){console[_0x41fb98(0xbe)](_0x20ce23);}}),router[a0_0x3134af(0xac)](a0_0x3134af(0xc1),auth,async(_0x4d7724,_0x5d13dc)=>{const _0x1bf0b3=a0_0x3134af;try{const {name:_0x2740b5,address:_0x594805,mobile:_0x46867f,email:_0x477e28,receivable:_0x19199b,payable:_0x30b56a,contactperson:_0x2b5edd,landline:_0xb92a3}=_0x4d7724['body'],_0x23230f=new customer({'name':_0x2740b5,'address':_0x594805,'mobile':_0x46867f,'email':_0x477e28,'receivable':_0x19199b,'payable':_0x30b56a,'contactperson':_0x2b5edd,'landline':_0xb92a3}),_0x4c830b=await _0x23230f[_0x1bf0b3(0xaf)]();_0x4d7724[_0x1bf0b3(0xb6)]('success',_0x1bf0b3(0xb8)),_0x5d13dc[_0x1bf0b3(0xcf)](_0x1bf0b3(0xbc));}catch(_0x575404){console[_0x1bf0b3(0xbe)](_0x575404);}}),router['get'](a0_0x3134af(0xb9),auth,async(_0x2d2577,_0x40172b)=>{const _0x296188=a0_0x3134af;try{const {username:_0x160281,email:_0x4c5789,role:_0x4b8057}=_0x2d2577['user'],_0x32460f=_0x2d2577[_0x296188(0xaa)],_0xcfd36c=await profile[_0x296188(0x95)]({'email':_0x32460f[_0x296188(0xdc)]}),_0x149466=await master_shop[_0x296188(0x9a)]();console['log']('master',_0x149466);const _0x5dfec9=_0x2d2577[_0x296188(0xce)]['id'],_0x390ea3=await customer[_0x296188(0xa8)](_0x5dfec9);if(_0x149466[0x0][_0x296188(0xe6)]=='English\x20(US)'){var _0x2bd2f5=users[_0x296188(0x9b)];console[_0x296188(0xbe)](_0x2bd2f5);}else{if(_0x149466[0x0][_0x296188(0xe6)]==_0x296188(0x9f))var _0x2bd2f5=users[_0x296188(0x9f)];else{if(_0x149466[0x0][_0x296188(0xe6)]==_0x296188(0xef))var _0x2bd2f5=users['German'];else{if(_0x149466[0x0][_0x296188(0xe6)]==_0x296188(0xcb))var _0x2bd2f5=users[_0x296188(0xcb)];else{if(_0x149466[0x0][_0x296188(0xe6)]==_0x296188(0xb2))var _0x2bd2f5=users[_0x296188(0xb2)];else{if(_0x149466[0x0][_0x296188(0xe6)]=='Portuguese\x20(BR)')var _0x2bd2f5=users[_0x296188(0xe9)];else{if(_0x149466[0x0][_0x296188(0xe6)]==_0x296188(0xbd))var _0x2bd2f5=users[_0x296188(0xbd)];else{if(_0x149466[0x0][_0x296188(0xe6)]==_0x296188(0xe5))var _0x2bd2f5=users['Arabic'];}}}}}}}_0x40172b[_0x296188(0xec)]('customer',{'success':_0x2d2577[_0x296188(0xb6)]('success'),'errors':_0x2d2577['flash']('errors'),'role':_0x32460f,'profile':_0xcfd36c,'user':_0x390ea3,'master_shop':_0x149466,'language':_0x2bd2f5});}catch(_0x4eb600){console[_0x296188(0xbe)](_0x4eb600);}}),router[a0_0x3134af(0xac)](a0_0x3134af(0xb9),auth,async(_0x2065aa,_0x567fe0)=>{const _0x13ed93=a0_0x3134af;try{const _0x403ffa=_0x2065aa['params']['id'],_0x209d60=await customer[_0x13ed93(0xa8)](_0x403ffa),{name:_0x3d5e40,address:_0x519b77,mobile:_0x510c70,email:_0x4ce062,receivable:_0x50d75b,payable:_0x2c55f5,contactperson:_0x2f6d32,landline:_0x2bef68}=_0x2065aa['body'];_0x209d60[_0x13ed93(0xa2)]=_0x3d5e40,_0x209d60[_0x13ed93(0xf2)]=_0x519b77,_0x209d60[_0x13ed93(0xc0)]=_0x510c70,_0x209d60['email']=_0x4ce062,_0x209d60[_0x13ed93(0xed)]=_0x50d75b,_0x209d60['payable']=_0x2c55f5,_0x209d60['contactperson']=_0x2f6d32,_0x209d60[_0x13ed93(0xeb)]=_0x2bef68;const _0x3f47c1=await _0x209d60[_0x13ed93(0xaf)]();_0x2065aa[_0x13ed93(0xb6)](_0x13ed93(0xa1),'customer\x20update\x20successfully'),_0x567fe0[_0x13ed93(0xcf)]('/customer/view');}catch(_0x471287){console[_0x13ed93(0xbe)](_0x471287);}}),router[a0_0x3134af(0xab)](a0_0x3134af(0xc6),auth,async(_0x3779d2,_0x11fc7c)=>{const _0x3ac9d7=a0_0x3134af;try{const {username:_0x2cafbe,email:_0x1e8c6c,role:_0x153de0}=_0x3779d2[_0x3ac9d7(0xaa)],_0x4df6ce=_0x3779d2[_0x3ac9d7(0xaa)],_0x5f3721=await profile[_0x3ac9d7(0x95)]({'email':_0x4df6ce[_0x3ac9d7(0xdc)]}),_0x596521=await master_shop['find']();console[_0x3ac9d7(0xbe)](_0x3ac9d7(0xf0),_0x596521),console[_0x3ac9d7(0xbe)](_0x3779d2[_0x3ac9d7(0xce)]['id']);const _0x26e9c0=await customer[_0x3ac9d7(0x95)]({'_id':_0x3779d2[_0x3ac9d7(0xce)]['id']});console['log'](_0x3ac9d7(0xc5),_0x26e9c0);const _0xc3efdb=await c_payment_data[_0x3ac9d7(0x9a)]({'customer':_0x26e9c0[_0x3ac9d7(0xa2)]});console['log'](_0xc3efdb);const _0x35b161=await c_payment_data[_0x3ac9d7(0xd4)]([{'$match':{'customer':_0x26e9c0['name']}},{'$match':{'reason':'Sale'}},{'$group':{'_id':_0x3ac9d7(0xde),'sum':{'$sum':_0x3ac9d7(0x98)}}}]);console[_0x3ac9d7(0xbe)]('payable_sum',_0x35b161);const _0x51c0e2=await c_payment_data['aggregate']([{'$match':{'customer':_0x26e9c0[_0x3ac9d7(0xa2)]}},{'$match':{'reason':_0x3ac9d7(0xc2)}},{'$group':{'_id':_0x3ac9d7(0xde),'sum':{'$sum':_0x3ac9d7(0x98)}}}]);console[_0x3ac9d7(0xbe)](_0x3ac9d7(0xe8),_0x51c0e2);if(_0x596521[0x0][_0x3ac9d7(0xe6)]==_0x3ac9d7(0xb1)){var _0x3e97a6=users[_0x3ac9d7(0x9b)];console['log'](_0x3e97a6);}else{if(_0x596521[0x0][_0x3ac9d7(0xe6)]=='Hindi')var _0x3e97a6=users[_0x3ac9d7(0x9f)];else{if(_0x596521[0x0][_0x3ac9d7(0xe6)]==_0x3ac9d7(0xef))var _0x3e97a6=users['German'];else{if(_0x596521[0x0][_0x3ac9d7(0xe6)]==_0x3ac9d7(0xcb))var _0x3e97a6=users[_0x3ac9d7(0xcb)];else{if(_0x596521[0x0][_0x3ac9d7(0xe6)]=='French')var _0x3e97a6=users[_0x3ac9d7(0xb2)];else{if(_0x596521[0x0][_0x3ac9d7(0xe6)]==_0x3ac9d7(0xa0))var _0x3e97a6=users[_0x3ac9d7(0xe9)];else{if(_0x596521[0x0][_0x3ac9d7(0xe6)]==_0x3ac9d7(0xbd))var _0x3e97a6=users[_0x3ac9d7(0xbd)];else{if(_0x596521[0x0]['language']==_0x3ac9d7(0xe5))var _0x3e97a6=users[_0x3ac9d7(0xae)];}}}}}}}_0x11fc7c[_0x3ac9d7(0xec)](_0x3ac9d7(0xad),{'success':_0x3779d2[_0x3ac9d7(0xb6)](_0x3ac9d7(0xa1)),'errors':_0x3779d2[_0x3ac9d7(0xb6)](_0x3ac9d7(0xda)),'role':_0x4df6ce,'profile':_0x5f3721,'payment':_0xc3efdb,'payable':_0x35b161,'receivable':_0x51c0e2,'master_shop':_0x596521,'language':_0x3e97a6});}catch(_0x461f25){console[_0x3ac9d7(0xbe)](_0x461f25);}}),router['get'](a0_0x3134af(0xbf),auth,async(_0x161921,_0x56b2dd)=>{const _0x5a17cb=a0_0x3134af;try{const _0x45fadc=new excelJS[(_0x5a17cb(0xd7))](),_0x1bce38=_0x45fadc[_0x5a17cb(0xdd)](_0x5a17cb(0xbb));return _0x1bce38['columns']=[{'header':'ID','key':'PName','width':0xa},{'header':'Name','key':_0x5a17cb(0x96),'width':0xa},{'header':_0x5a17cb(0xd5),'key':_0x5a17cb(0xa6),'width':0xa},{'header':'SalesmanName','key':_0x5a17cb(0xd2),'width':0xa},{'header':_0x5a17cb(0xf2),'key':'address','width':0xa},{'header':_0x5a17cb(0xc0),'key':_0x5a17cb(0xc0),'width':0xa},{'header':_0x5a17cb(0xdc),'key':'email','width':0xa}],_0x56b2dd[_0x5a17cb(0xca)]('Content-Type',_0x5a17cb(0xd3)),_0x56b2dd[_0x5a17cb(0xca)]('Content-Disposition','attachment;\x20filename=customer_Migration_File.xlsx'),_0x45fadc[_0x5a17cb(0x92)][_0x5a17cb(0x93)](_0x56b2dd)['then'](()=>{_0x56b2dd['status'](0xc8);});}catch(_0x5a1eb2){_0x56b2dd[_0x5a17cb(0xb0)](0x190)[_0x5a17cb(0xb4)]({'errors':_0x5a1eb2['message']});}});function a0_0x2897(_0x5d29af,_0xed999f){const _0x49f12e=a0_0x49f1();return a0_0x2897=function(_0x289731,_0x54ce56){_0x289731=_0x289731-0x91;let _0x272ba6=_0x49f12e[_0x289731];return _0x272ba6;},a0_0x2897(_0x5d29af,_0xed999f);}const storage1=multer['diskStorage']({'destination':(_0x300f98,_0x1f1dd4,_0x68c94)=>{const _0x2f0536=a0_0x3134af;_0x68c94(null,_0x2f0536(0xb7));},'filename':(_0x441c07,_0x4c1b69,_0x347e86)=>{const _0x2a2ec3=a0_0x3134af;_0x347e86(null,Date[_0x2a2ec3(0xb5)]()+_0x4c1b69[_0x2a2ec3(0xb3)]);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x3134af(0xc9),auth,uploadMigrate[a0_0x3134af(0xc7)](a0_0x3134af(0xd1)),async(_0xf25ca3,_0x58d519)=>{const _0x1886f0=a0_0x3134af,_0x58af26=_0xf25ca3['file']['filename'],_0xc160d5=await xlsx[_0x1886f0(0xee)](_0x1886f0(0xe3)+_0x58af26);let _0x14faaf=_0xc160d5['SheetNames'],_0x352e62=xlsx[_0x1886f0(0xc8)]['sheet_to_json'](_0xc160d5[_0x1886f0(0x9e)][_0x14faaf[0x0]]);for(const _0x128efd of _0x352e62){const _0x4e3757=_0x128efd['ID'],_0x118f76=_0x128efd['Name'],_0x2f1f0d=_0x128efd[_0x1886f0(0xd5)],_0x189ff7=_0x128efd[_0x1886f0(0xd2)],_0x599c3b=_0x128efd[_0x1886f0(0xf2)],_0x5be013=_0x128efd[_0x1886f0(0xc0)],_0x2ba38e=_0x128efd[_0x1886f0(0xdc)];try{let _0x25af3b=await customer['findOne']({'name':_0x118f76});if(!_0x25af3b){const _0x27a07b=new customer({'name':_0x118f76,'ID':_0x4e3757,'SalesmanCode':_0x2f1f0d,'SalesmanName':_0x189ff7,'address':_0x599c3b,'mobile':_0x5be013,'email':_0x2ba38e});_0x25af3b=await _0x27a07b[_0x1886f0(0xaf)](),_0xf25ca3[_0x1886f0(0xb6)](_0x1886f0(0xa1),_0x118f76+'\x20added\x20successfully');}else _0xf25ca3[_0x1886f0(0xb6)](_0x1886f0(0xa7),_0x118f76+_0x1886f0(0xe0));}catch(_0x4b21bd){_0x58d519['status'](0x1f4)[_0x1886f0(0xf3)]({'proderror':_0x4b21bd[_0x1886f0(0x94)],'aproduct':ProductName});}}_0x58d519[_0x1886f0(0xcf)](_0x1886f0(0xbc));}),module[a0_0x3134af(0xea)]=router;function a0_0x49f1(){const _0x288e34=['save','status','English\x20(US)','French','originalname','send','now','flash','public/Migration','customer\x20add\x20successfully','/view/:id','16JkSjwx','Customers','/customer/view','Chinese','log','/products_export_migrate_file','mobile','/view','Sale\x20Return','Sale','../public/language/languages.json','customer_data','/view/payment/:id','single','utils','/customer_import_migrate_file','setHeader','Spanish','1872064SuXGET','element','params','redirect','205zheBwM','customer_product_fule','SalesmanName','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','aggregate','SalesmanCode','map','Workbook','13539573WrRhiu','sale_return','errors','2449269FggzxZ','email','addWorksheet','$reason','2031230srjJrz','\x20Failed','customer','amount','public/Migration/','14ipxiTC','Arabic\x20(ae)','language','data','receivable_sum','Portuguese','exports','landline','render','receivable','readFile','German','master','exceljs','address','json','multer','xlsx','write','message','findOne','PBrands','customer_docs','$amount','132654kHkeUW','find','English','express','payment_data','Sheets','Hindi','Portuguese\x20(BR)','success','name','3106593bDRCmu','forEach','53597VlNGFv','PUnits','error','findById','../models/all_models','user','get','post','customer_payment','Arabic'];a0_0x49f1=function(){return _0x288e34;};return a0_0x49f1();}