const a0_0x278508=a0_0x5d2d;function a0_0x536f(){const _0x3fbe05=['contactperson','columns','\x20added\x20successfully','../models/all_models','express','/view/:id','customer_docs','6074920bSPsPt','aggregate','get','88791frTbdF','SalesmanName','142672vQihpP','success','flash','language','/customer_import_migrate_file','Chinese','body','customer_product_fule','public/Migration','Arabic\x20(ae)','Sale\x20Return','$reason','user','message','/products_export_migrate_file','mobile','$amount','German','sale','Arabic','English\x20(US)','sheet_to_json','2849385iJdvui','single','Sale','Portuguese','xlsx','sale_return','English','find','customer_payment','multer','payment_data','then','findOne','Customers','attachment;\x20filename=customer_Migration_File.xlsx','render','165936rsmMhD','save','filename','post','PName','status','1152165KnagNN','receivable_sum','Spanish','landline','customer\x20update\x20successfully','customer\x20add\x20successfully','Workbook','reason','PUnits','findById','Sheets','master','address','French','/view/payment/:id','c_payments','params','Hindi','/customer/view','errors','file','4185504cBgmVU','PBrands','log','setHeader','../public/language/languages.json','redirect','customer','payable_sum','email','exports','Portuguese\x20(BR)','element','8mndtBn','forEach','\x20Failed','name','Content-Disposition','originalname','payable','Router','customer_data','/view','Content-Type','diskStorage','SalesmanCode','Name','receivable','now'];a0_0x536f=function(){return _0x3fbe05;};return a0_0x536f();}(function(_0x2c664d,_0x521888){const _0xcba1a6=a0_0x5d2d,_0x41a0e6=_0x2c664d();while(!![]){try{const _0x2d6d84=-parseInt(_0xcba1a6(0xf9))/0x1+-parseInt(_0xcba1a6(0xdf))/0x2*(parseInt(_0xcba1a6(0x121))/0x3)+-parseInt(_0xcba1a6(0xfb))/0x4+parseInt(_0xcba1a6(0x127))/0x5+-parseInt(_0xcba1a6(0xd3))/0x6+parseInt(_0xcba1a6(0x111))/0x7+parseInt(_0xcba1a6(0xf6))/0x8;if(_0x2d6d84===_0x521888)break;else _0x41a0e6['push'](_0x41a0e6['shift']());}catch(_0x258e4e){_0x41a0e6['push'](_0x41a0e6['shift']());}}}(a0_0x536f,0x5651a));function a0_0x5d2d(_0x541c05,_0x3ea4d7){const _0x536fc5=a0_0x536f();return a0_0x5d2d=function(_0x5d2d4c,_0x591909){_0x5d2d4c=_0x5d2d4c-0xce;let _0x5eb62d=_0x536fc5[_0x5d2d4c];return _0x5eb62d;},a0_0x5d2d(_0x541c05,_0x3ea4d7);}const express=require(a0_0x278508(0xf3)),app=express(),router=express[a0_0x278508(0xe6)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x278508(0xf2)),auth=require('../middleware/auth'),users=require(a0_0x278508(0xd7)),excelJS=require('exceljs'),xlsx=require(a0_0x278508(0x115)),multer=require(a0_0x278508(0x11a));router[a0_0x278508(0xf8)](a0_0x278508(0xe8),auth,async(_0x208858,_0x385a1b)=>{const _0x3e110b=a0_0x278508;try{const {username:_0x156956,email:_0x3d3fbe,role:_0x5b410b}=_0x208858['user'],_0x19e31b=_0x208858[_0x3e110b(0x107)],_0x16855=await profile[_0x3e110b(0x11d)]({'email':_0x19e31b[_0x3e110b(0xdb)]}),_0x234bab=await master_shop['find']();console[_0x3e110b(0xd5)](_0x3e110b(0x132),_0x234bab);const _0x3f55b0=await customer['find'](),_0x1dd5d9=await customer[_0x3e110b(0xf7)]([{'$lookup':{'from':_0x3e110b(0x136),'localField':'name','foreignField':_0x3e110b(0xd9),'as':'customer_docs'}}]);console['log'](_0x1dd5d9);const _0x3449a9=_0x1dd5d9['map'](_0x2bbc4a=>{const _0x284715=_0x3e110b;console[_0x284715(0xd5)]('data',_0x2bbc4a);var _0x405339=0x0,_0x22d567=0x0;return _0x2bbc4a[_0x284715(0xf5)][_0x284715(0xe0)](_0x676a98=>{const _0x6e18b6=_0x284715;console[_0x6e18b6(0xd5)](_0x6e18b6(0xde),_0x676a98),_0x676a98[_0x6e18b6(0x12e)]==_0x6e18b6(0x113)?_0x405339+=_0x676a98['amount']:_0x22d567+=_0x676a98['amount'];}),_0x2bbc4a[_0x284715(0x10d)]=parseFloat(_0x405339)+0x0,_0x2bbc4a[_0x284715(0x116)]=parseFloat(_0x22d567)+0x0,_0x2bbc4a;});console[_0x3e110b(0xd5)](_0x3e110b(0x11b),_0x3449a9);if(_0x234bab[0x0][_0x3e110b(0xfe)]==_0x3e110b(0x10f)){var _0x34de98=users[_0x3e110b(0x117)];console[_0x3e110b(0xd5)](_0x34de98);}else{if(_0x234bab[0x0][_0x3e110b(0xfe)]==_0x3e110b(0xcf))var _0x34de98=users[_0x3e110b(0xcf)];else{if(_0x234bab[0x0][_0x3e110b(0xfe)]==_0x3e110b(0x10c))var _0x34de98=users[_0x3e110b(0x10c)];else{if(_0x234bab[0x0][_0x3e110b(0xfe)]==_0x3e110b(0x129))var _0x34de98=users[_0x3e110b(0x129)];else{if(_0x234bab[0x0][_0x3e110b(0xfe)]==_0x3e110b(0x134))var _0x34de98=users['French'];else{if(_0x234bab[0x0][_0x3e110b(0xfe)]==_0x3e110b(0xdd))var _0x34de98=users[_0x3e110b(0x114)];else{if(_0x234bab[0x0][_0x3e110b(0xfe)]==_0x3e110b(0x100))var _0x34de98=users['Chinese'];else{if(_0x234bab[0x0][_0x3e110b(0xfe)]==_0x3e110b(0x104))var _0x34de98=users['Arabic'];}}}}}}}_0x385a1b['render'](_0x3e110b(0xd9),{'success':_0x208858[_0x3e110b(0xfd)](_0x3e110b(0xfc)),'errors':_0x208858[_0x3e110b(0xfd)]('errors'),'user':_0x3f55b0,'role':_0x19e31b,'profile':_0x16855,'payment':_0x3449a9,'master_shop':_0x234bab,'language':_0x34de98});}catch(_0xb71ac9){console[_0x3e110b(0xd5)](_0xb71ac9);}}),router[a0_0x278508(0x124)]('/view',auth,async(_0x20caea,_0x285d34)=>{const _0x39dd9e=a0_0x278508;try{const {name:_0x1ede14,address:_0x5587e5,mobile:_0xe97eb9,email:_0x2a744b,receivable:_0x3e1482,payable:_0x231b0e,contactperson:_0x24a507,landline:_0x4e419e}=_0x20caea['body'],_0x223f77=new customer({'name':_0x1ede14,'address':_0x5587e5,'mobile':_0xe97eb9,'email':_0x2a744b,'receivable':_0x3e1482,'payable':_0x231b0e,'contactperson':_0x24a507,'landline':_0x4e419e}),_0x4394b3=await _0x223f77[_0x39dd9e(0x122)]();_0x20caea['flash'](_0x39dd9e(0xfc),_0x39dd9e(0x12c)),_0x285d34[_0x39dd9e(0xd8)](_0x39dd9e(0xd0));}catch(_0x10ce5a){console[_0x39dd9e(0xd5)](_0x10ce5a);}}),router['get'](a0_0x278508(0xf4),auth,async(_0x3e1e98,_0x2d19fc)=>{const _0x4c5eeb=a0_0x278508;try{const {username:_0x759a56,email:_0x54f488,role:_0x2fe128}=_0x3e1e98['user'],_0x165bd3=_0x3e1e98[_0x4c5eeb(0x107)],_0x576014=await profile[_0x4c5eeb(0x11d)]({'email':_0x165bd3['email']}),_0x4e630d=await master_shop[_0x4c5eeb(0x118)]();console['log'](_0x4c5eeb(0x132),_0x4e630d);const _0x57bdde=_0x3e1e98[_0x4c5eeb(0xce)]['id'],_0x54d8ce=await customer[_0x4c5eeb(0x130)](_0x57bdde);if(_0x4e630d[0x0][_0x4c5eeb(0xfe)]==_0x4c5eeb(0x10f)){var _0x294723=users['English'];console[_0x4c5eeb(0xd5)](_0x294723);}else{if(_0x4e630d[0x0][_0x4c5eeb(0xfe)]=='Hindi')var _0x294723=users[_0x4c5eeb(0xcf)];else{if(_0x4e630d[0x0][_0x4c5eeb(0xfe)]==_0x4c5eeb(0x10c))var _0x294723=users[_0x4c5eeb(0x10c)];else{if(_0x4e630d[0x0][_0x4c5eeb(0xfe)]==_0x4c5eeb(0x129))var _0x294723=users[_0x4c5eeb(0x129)];else{if(_0x4e630d[0x0][_0x4c5eeb(0xfe)]==_0x4c5eeb(0x134))var _0x294723=users[_0x4c5eeb(0x134)];else{if(_0x4e630d[0x0][_0x4c5eeb(0xfe)]==_0x4c5eeb(0xdd))var _0x294723=users[_0x4c5eeb(0x114)];else{if(_0x4e630d[0x0][_0x4c5eeb(0xfe)]==_0x4c5eeb(0x100))var _0x294723=users[_0x4c5eeb(0x100)];else{if(_0x4e630d[0x0][_0x4c5eeb(0xfe)]=='Arabic\x20(ae)')var _0x294723=users[_0x4c5eeb(0x10e)];}}}}}}}_0x2d19fc['render'](_0x4c5eeb(0xd9),{'success':_0x3e1e98[_0x4c5eeb(0xfd)]('success'),'errors':_0x3e1e98[_0x4c5eeb(0xfd)](_0x4c5eeb(0xd1)),'role':_0x165bd3,'profile':_0x576014,'user':_0x54d8ce,'master_shop':_0x4e630d,'language':_0x294723});}catch(_0x247409){console[_0x4c5eeb(0xd5)](_0x247409);}}),router[a0_0x278508(0x124)](a0_0x278508(0xf4),auth,async(_0x3dbd35,_0x3e1017)=>{const _0x19f874=a0_0x278508;try{const _0x25bf7d=_0x3dbd35[_0x19f874(0xce)]['id'],_0xa4e562=await customer['findById'](_0x25bf7d),{name:_0x48afc6,address:_0x584675,mobile:_0x52bd38,email:_0x458b27,receivable:_0x135bd0,payable:_0x3402e1,contactperson:_0x1c15ce,landline:_0x16fc28}=_0x3dbd35[_0x19f874(0x101)];_0xa4e562['name']=_0x48afc6,_0xa4e562[_0x19f874(0x133)]=_0x584675,_0xa4e562['mobile']=_0x52bd38,_0xa4e562[_0x19f874(0xdb)]=_0x458b27,_0xa4e562[_0x19f874(0xed)]=_0x135bd0,_0xa4e562[_0x19f874(0xe5)]=_0x3402e1,_0xa4e562[_0x19f874(0xef)]=_0x1c15ce,_0xa4e562[_0x19f874(0x12a)]=_0x16fc28;const _0x4dc4b3=await _0xa4e562[_0x19f874(0x122)]();_0x3dbd35[_0x19f874(0xfd)]('success',_0x19f874(0x12b)),_0x3e1017[_0x19f874(0xd8)]('/customer/view');}catch(_0xbbc3ed){console['log'](_0xbbc3ed);}}),router['get'](a0_0x278508(0x135),auth,async(_0x577fe1,_0x58a566)=>{const _0x40b9f6=a0_0x278508;try{const {username:_0x4fc81e,email:_0x4c5da4,role:_0x240b23}=_0x577fe1[_0x40b9f6(0x107)],_0x2372b5=_0x577fe1[_0x40b9f6(0x107)],_0x208aa3=await profile[_0x40b9f6(0x11d)]({'email':_0x2372b5[_0x40b9f6(0xdb)]}),_0x1eaaec=await master_shop['find']();console[_0x40b9f6(0xd5)](_0x40b9f6(0x132),_0x1eaaec),console['log'](_0x577fe1[_0x40b9f6(0xce)]['id']);const _0x56e394=await customer['findOne']({'_id':_0x577fe1[_0x40b9f6(0xce)]['id']});console[_0x40b9f6(0xd5)](_0x40b9f6(0xe7),_0x56e394);const _0x505a21=await c_payment_data[_0x40b9f6(0x118)]({'customer':_0x56e394[_0x40b9f6(0xe2)]});console[_0x40b9f6(0xd5)](_0x505a21);const _0x19d335=await c_payment_data[_0x40b9f6(0xf7)]([{'$match':{'customer':_0x56e394['name']}},{'$match':{'reason':_0x40b9f6(0x113)}},{'$group':{'_id':_0x40b9f6(0x106),'sum':{'$sum':_0x40b9f6(0x10b)}}}]);console[_0x40b9f6(0xd5)](_0x40b9f6(0xda),_0x19d335);const _0xe09f32=await c_payment_data['aggregate']([{'$match':{'customer':_0x56e394[_0x40b9f6(0xe2)]}},{'$match':{'reason':_0x40b9f6(0x105)}},{'$group':{'_id':_0x40b9f6(0x106),'sum':{'$sum':_0x40b9f6(0x10b)}}}]);console[_0x40b9f6(0xd5)](_0x40b9f6(0x128),_0xe09f32);if(_0x1eaaec[0x0][_0x40b9f6(0xfe)]==_0x40b9f6(0x10f)){var _0x4bc2bf=users[_0x40b9f6(0x117)];console[_0x40b9f6(0xd5)](_0x4bc2bf);}else{if(_0x1eaaec[0x0][_0x40b9f6(0xfe)]==_0x40b9f6(0xcf))var _0x4bc2bf=users[_0x40b9f6(0xcf)];else{if(_0x1eaaec[0x0][_0x40b9f6(0xfe)]==_0x40b9f6(0x10c))var _0x4bc2bf=users[_0x40b9f6(0x10c)];else{if(_0x1eaaec[0x0][_0x40b9f6(0xfe)]==_0x40b9f6(0x129))var _0x4bc2bf=users[_0x40b9f6(0x129)];else{if(_0x1eaaec[0x0][_0x40b9f6(0xfe)]==_0x40b9f6(0x134))var _0x4bc2bf=users[_0x40b9f6(0x134)];else{if(_0x1eaaec[0x0][_0x40b9f6(0xfe)]=='Portuguese\x20(BR)')var _0x4bc2bf=users['Portuguese'];else{if(_0x1eaaec[0x0][_0x40b9f6(0xfe)]==_0x40b9f6(0x100))var _0x4bc2bf=users[_0x40b9f6(0x100)];else{if(_0x1eaaec[0x0][_0x40b9f6(0xfe)]==_0x40b9f6(0x104))var _0x4bc2bf=users[_0x40b9f6(0x10e)];}}}}}}}_0x58a566[_0x40b9f6(0x120)](_0x40b9f6(0x119),{'success':_0x577fe1[_0x40b9f6(0xfd)](_0x40b9f6(0xfc)),'errors':_0x577fe1[_0x40b9f6(0xfd)]('errors'),'role':_0x2372b5,'profile':_0x208aa3,'payment':_0x505a21,'payable':_0x19d335,'receivable':_0xe09f32,'master_shop':_0x1eaaec,'language':_0x4bc2bf});}catch(_0x10eaec){console[_0x40b9f6(0xd5)](_0x10eaec);}}),router[a0_0x278508(0xf8)](a0_0x278508(0x109),auth,async(_0x231e88,_0x217181)=>{const _0x2f5d02=a0_0x278508;try{const _0xe1b19c=new excelJS[(_0x2f5d02(0x12d))](),_0x5cbbdb=_0xe1b19c['addWorksheet'](_0x2f5d02(0x11e));return _0x5cbbdb[_0x2f5d02(0xf0)]=[{'header':'ID','key':_0x2f5d02(0x125),'width':0xa},{'header':_0x2f5d02(0xec),'key':_0x2f5d02(0xd4),'width':0xa},{'header':_0x2f5d02(0xeb),'key':_0x2f5d02(0x12f),'width':0xa},{'header':_0x2f5d02(0xfa),'key':_0x2f5d02(0xfa),'width':0xa},{'header':_0x2f5d02(0x133),'key':_0x2f5d02(0x133),'width':0xa},{'header':'mobile','key':_0x2f5d02(0x10a),'width':0xa},{'header':_0x2f5d02(0xdb),'key':_0x2f5d02(0xdb),'width':0xa}],_0x217181[_0x2f5d02(0xd6)](_0x2f5d02(0xe9),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x217181['setHeader'](_0x2f5d02(0xe3),_0x2f5d02(0x11f)),_0xe1b19c['xlsx']['write'](_0x217181)[_0x2f5d02(0x11c)](()=>{const _0x53f1e4=_0x2f5d02;_0x217181[_0x53f1e4(0x126)](0xc8);});}catch(_0x121fcf){_0x217181['status'](0x190)['send']({'errors':_0x121fcf[_0x2f5d02(0x108)]});}});const storage1=multer[a0_0x278508(0xea)]({'destination':(_0x33183c,_0x4d4c10,_0x1deb10)=>{const _0x21c854=a0_0x278508;_0x1deb10(null,_0x21c854(0x103));},'filename':(_0x57fc96,_0x425069,_0x44ece1)=>{const _0x5317cf=a0_0x278508;_0x44ece1(null,Date[_0x5317cf(0xee)]()+_0x425069[_0x5317cf(0xe4)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x278508(0x124)](a0_0x278508(0xff),auth,uploadMigrate[a0_0x278508(0x112)](a0_0x278508(0x102)),async(_0x2ad2ca,_0x1703a5)=>{const _0x35746d=a0_0x278508,_0x4fdb3f=_0x2ad2ca[_0x35746d(0xd2)][_0x35746d(0x123)],_0x18684a=await xlsx['readFile']('public/Migration/'+_0x4fdb3f);let _0xee3311=_0x18684a['SheetNames'],_0x3ddea9=xlsx['utils'][_0x35746d(0x110)](_0x18684a[_0x35746d(0x131)][_0xee3311[0x0]]);for(const _0x3935dd of _0x3ddea9){const _0x52054a=_0x3935dd['ID'],_0x6c0462=_0x3935dd[_0x35746d(0xec)],_0x391a4d=_0x3935dd[_0x35746d(0xeb)],_0x115890=_0x3935dd[_0x35746d(0xfa)],_0x375796=_0x3935dd[_0x35746d(0x133)],_0x5a91f6=_0x3935dd['mobile'],_0x497cdf=_0x3935dd[_0x35746d(0xdb)];try{let _0x150625=await customer['findOne']({'name':_0x6c0462});if(!_0x150625){const _0x2ed807=new customer({'name':_0x6c0462,'ID':_0x52054a,'SalesmanCode':_0x391a4d,'SalesmanName':_0x115890,'address':_0x375796,'mobile':_0x5a91f6,'email':_0x497cdf});_0x150625=await _0x2ed807['save'](),_0x2ad2ca[_0x35746d(0xfd)]('success',_0x6c0462+_0x35746d(0xf1));}else _0x2ad2ca['flash']('error',_0x6c0462+_0x35746d(0xe1));}catch(_0x5e81a2){_0x1703a5[_0x35746d(0x126)](0x1f4)['json']({'proderror':_0x5e81a2[_0x35746d(0x108)],'aproduct':ProductName});}}_0x1703a5[_0x35746d(0xd8)]('/customer/view');}),module[a0_0x278508(0xdc)]=router;