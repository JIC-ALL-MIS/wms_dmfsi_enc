const a0_0x2af76d=a0_0x4c02;(function(_0x339c28,_0x207717){const _0x569039=a0_0x4c02,_0x1b472b=_0x339c28();while(!![]){try{const _0x48f678=parseInt(_0x569039(0x1a7))/0x1+parseInt(_0x569039(0x1b3))/0x2*(parseInt(_0x569039(0x1aa))/0x3)+-parseInt(_0x569039(0x184))/0x4*(parseInt(_0x569039(0x1c8))/0x5)+-parseInt(_0x569039(0x19f))/0x6+-parseInt(_0x569039(0x1c5))/0x7+-parseInt(_0x569039(0x179))/0x8+parseInt(_0x569039(0x18a))/0x9;if(_0x48f678===_0x207717)break;else _0x1b472b['push'](_0x1b472b['shift']());}catch(_0x2be45e){_0x1b472b['push'](_0x1b472b['shift']());}}}(a0_0x5b59,0x9d433));function a0_0x5b59(){const _0x3c0174=['findOne','$amount','German','log','save','data','customer_product_fule','json','Customers','amount','get','express','contactperson','Sheets','/view/:id','now','landline','Name','5176164jNhaPh','customer_docs','customer','Router','English','../models/all_models','flash','addWorksheet','510521BGNqnb','address','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','6MQtIrw','errors','status','aggregate','name','email','Content-Type','sheet_to_json','multer','840588SGgzAX','find','customer\x20update\x20successfully','Chinese','exceljs','send','filename','message','/view','diskStorage','payment_data','element','Portuguese\x20(BR)','setHeader','exports','success','Hindi','SalesmanCode','3149790aiViKC','../public/language/languages.json','$reason','70205GgvzVC','payable_sum','mobile','customer\x20add\x20successfully','file','PUnits','\x20added\x20successfully','Sale','originalname','English\x20(US)','utils','Workbook','Arabic','customer_payment','params','user','redirect','Content-Disposition','PName','receivable_sum','/customer_import_migrate_file','map','French','554112cYSXrV','Arabic\x20(ae)','receivable','body','language','Sale\x20Return','\x20Failed','post','SalesmanName','PBrands','master','364kehNxf','Spanish','error','forEach','xlsx','/customer/view','17574273aZRzpQ','then','Portuguese'];a0_0x5b59=function(){return _0x3c0174;};return a0_0x5b59();}const express=require(a0_0x2af76d(0x198)),app=express(),router=express[a0_0x2af76d(0x1a2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x2af76d(0x1a4)),auth=require('../middleware/auth'),users=require(a0_0x2af76d(0x1c6)),excelJS=require(a0_0x2af76d(0x1b7)),xlsx=require(a0_0x2af76d(0x188)),multer=require(a0_0x2af76d(0x1b2));function a0_0x4c02(_0x277af5,_0x163c0a){const _0x5b5997=a0_0x5b59();return a0_0x4c02=function(_0x4c02a9,_0x5c7257){_0x4c02a9=_0x4c02a9-0x167;let _0x11b187=_0x5b5997[_0x4c02a9];return _0x11b187;},a0_0x4c02(_0x277af5,_0x163c0a);}router[a0_0x2af76d(0x197)](a0_0x2af76d(0x1bb),auth,async(_0x37420d,_0xf0093b)=>{const _0x2c2953=a0_0x2af76d;try{const {username:_0x3eb6c8,email:_0x4b64fa,role:_0x210515}=_0x37420d[_0x2c2953(0x171)],_0x3e188f=_0x37420d[_0x2c2953(0x171)],_0x4df516=await profile[_0x2c2953(0x18d)]({'email':_0x3e188f[_0x2c2953(0x1af)]}),_0x5d0d38=await master_shop[_0x2c2953(0x1b4)]();console[_0x2c2953(0x190)](_0x2c2953(0x183),_0x5d0d38);const _0x1dcbd7=await customer['find'](),_0x1656bf=await customer[_0x2c2953(0x1ad)]([{'$lookup':{'from':'c_payments','localField':'name','foreignField':_0x2c2953(0x1a1),'as':_0x2c2953(0x1a0)}}]);console[_0x2c2953(0x190)](_0x1656bf);const _0x374181=_0x1656bf[_0x2c2953(0x177)](_0x5a011e=>{const _0x33b367=_0x2c2953;console[_0x33b367(0x190)](_0x33b367(0x192),_0x5a011e);var _0x2235b0=0x0,_0x31bf7a=0x0;return _0x5a011e[_0x33b367(0x1a0)][_0x33b367(0x187)](_0x3d57d6=>{const _0x5817ce=_0x33b367;console[_0x5817ce(0x190)](_0x5817ce(0x1be),_0x3d57d6),_0x3d57d6['reason']=='Sale'?_0x2235b0+=_0x3d57d6[_0x5817ce(0x196)]:_0x31bf7a+=_0x3d57d6[_0x5817ce(0x196)];}),_0x5a011e['sale']=parseFloat(_0x2235b0)+0x0,_0x5a011e['sale_return']=parseFloat(_0x31bf7a)+0x0,_0x5a011e;});console[_0x2c2953(0x190)](_0x2c2953(0x1bd),_0x374181);if(_0x5d0d38[0x0]['language']==_0x2c2953(0x16b)){var _0x4ff648=users[_0x2c2953(0x1a3)];console[_0x2c2953(0x190)](_0x4ff648);}else{if(_0x5d0d38[0x0]['language']=='Hindi')var _0x4ff648=users[_0x2c2953(0x1c3)];else{if(_0x5d0d38[0x0][_0x2c2953(0x17d)]==_0x2c2953(0x18f))var _0x4ff648=users[_0x2c2953(0x18f)];else{if(_0x5d0d38[0x0][_0x2c2953(0x17d)]=='Spanish')var _0x4ff648=users['Spanish'];else{if(_0x5d0d38[0x0][_0x2c2953(0x17d)]==_0x2c2953(0x178))var _0x4ff648=users[_0x2c2953(0x178)];else{if(_0x5d0d38[0x0][_0x2c2953(0x17d)]==_0x2c2953(0x1bf))var _0x4ff648=users[_0x2c2953(0x18c)];else{if(_0x5d0d38[0x0][_0x2c2953(0x17d)]==_0x2c2953(0x1b6))var _0x4ff648=users['Chinese'];else{if(_0x5d0d38[0x0][_0x2c2953(0x17d)]=='Arabic\x20(ae)')var _0x4ff648=users[_0x2c2953(0x16e)];}}}}}}}_0xf0093b['render']('customer',{'success':_0x37420d[_0x2c2953(0x1a5)](_0x2c2953(0x1c2)),'errors':_0x37420d[_0x2c2953(0x1a5)](_0x2c2953(0x1ab)),'user':_0x1dcbd7,'role':_0x3e188f,'profile':_0x4df516,'payment':_0x374181,'master_shop':_0x5d0d38,'language':_0x4ff648});}catch(_0x8d713c){console[_0x2c2953(0x190)](_0x8d713c);}}),router[a0_0x2af76d(0x180)](a0_0x2af76d(0x1bb),auth,async(_0xd430cc,_0xa2f8c4)=>{const _0x4f5d7a=a0_0x2af76d;try{const {name:_0x5e30de,address:_0x4e69dc,mobile:_0x2890c0,email:_0x3a7a5d,receivable:_0x4cad16,payable:_0x323dcf,contactperson:_0x3c90fc,landline:_0xa48040}=_0xd430cc['body'],_0x359cc6=new customer({'name':_0x5e30de,'address':_0x4e69dc,'mobile':_0x2890c0,'email':_0x3a7a5d,'receivable':_0x4cad16,'payable':_0x323dcf,'contactperson':_0x3c90fc,'landline':_0xa48040}),_0x35ccf9=await _0x359cc6['save']();_0xd430cc['flash']('success',_0x4f5d7a(0x1cb)),_0xa2f8c4[_0x4f5d7a(0x172)]('/customer/view');}catch(_0x2fcebd){console[_0x4f5d7a(0x190)](_0x2fcebd);}}),router[a0_0x2af76d(0x197)](a0_0x2af76d(0x19b),auth,async(_0x5c47dc,_0x18d61d)=>{const _0x51ce09=a0_0x2af76d;try{const {username:_0x3fd271,email:_0x300d3f,role:_0x44d523}=_0x5c47dc[_0x51ce09(0x171)],_0x5b0e58=_0x5c47dc['user'],_0x4cef4e=await profile['findOne']({'email':_0x5b0e58[_0x51ce09(0x1af)]}),_0x4d3789=await master_shop[_0x51ce09(0x1b4)]();console[_0x51ce09(0x190)](_0x51ce09(0x183),_0x4d3789);const _0x4afb9a=_0x5c47dc['params']['id'],_0x502e47=await customer['findById'](_0x4afb9a);if(_0x4d3789[0x0][_0x51ce09(0x17d)]==_0x51ce09(0x16b)){var _0x4b29e3=users[_0x51ce09(0x1a3)];console['log'](_0x4b29e3);}else{if(_0x4d3789[0x0][_0x51ce09(0x17d)]==_0x51ce09(0x1c3))var _0x4b29e3=users[_0x51ce09(0x1c3)];else{if(_0x4d3789[0x0][_0x51ce09(0x17d)]==_0x51ce09(0x18f))var _0x4b29e3=users[_0x51ce09(0x18f)];else{if(_0x4d3789[0x0][_0x51ce09(0x17d)]==_0x51ce09(0x185))var _0x4b29e3=users[_0x51ce09(0x185)];else{if(_0x4d3789[0x0][_0x51ce09(0x17d)]=='French')var _0x4b29e3=users['French'];else{if(_0x4d3789[0x0][_0x51ce09(0x17d)]==_0x51ce09(0x1bf))var _0x4b29e3=users[_0x51ce09(0x18c)];else{if(_0x4d3789[0x0][_0x51ce09(0x17d)]==_0x51ce09(0x1b6))var _0x4b29e3=users[_0x51ce09(0x1b6)];else{if(_0x4d3789[0x0][_0x51ce09(0x17d)]==_0x51ce09(0x17a))var _0x4b29e3=users[_0x51ce09(0x16e)];}}}}}}}_0x18d61d['render']('customer',{'success':_0x5c47dc[_0x51ce09(0x1a5)](_0x51ce09(0x1c2)),'errors':_0x5c47dc[_0x51ce09(0x1a5)](_0x51ce09(0x1ab)),'role':_0x5b0e58,'profile':_0x4cef4e,'user':_0x502e47,'master_shop':_0x4d3789,'language':_0x4b29e3});}catch(_0x170b12){console['log'](_0x170b12);}}),router[a0_0x2af76d(0x180)]('/view/:id',auth,async(_0x2b0ef2,_0x177b00)=>{const _0x6535a=a0_0x2af76d;try{const _0x1ea58b=_0x2b0ef2[_0x6535a(0x170)]['id'],_0x5506a2=await customer['findById'](_0x1ea58b),{name:_0x582483,address:_0x126511,mobile:_0x233f5a,email:_0x42a56d,receivable:_0x4107a3,payable:_0x32c6cb,contactperson:_0x303e87,landline:_0x415612}=_0x2b0ef2[_0x6535a(0x17c)];_0x5506a2['name']=_0x582483,_0x5506a2['address']=_0x126511,_0x5506a2[_0x6535a(0x1ca)]=_0x233f5a,_0x5506a2[_0x6535a(0x1af)]=_0x42a56d,_0x5506a2[_0x6535a(0x17b)]=_0x4107a3,_0x5506a2['payable']=_0x32c6cb,_0x5506a2[_0x6535a(0x199)]=_0x303e87,_0x5506a2[_0x6535a(0x19d)]=_0x415612;const _0x18410d=await _0x5506a2[_0x6535a(0x191)]();_0x2b0ef2[_0x6535a(0x1a5)]('success',_0x6535a(0x1b5)),_0x177b00['redirect']('/customer/view');}catch(_0x3b7aa7){console[_0x6535a(0x190)](_0x3b7aa7);}}),router['get']('/view/payment/:id',auth,async(_0xe70e93,_0x2d99d7)=>{const _0x2b7620=a0_0x2af76d;try{const {username:_0x375388,email:_0x3f44a1,role:_0x1ccf30}=_0xe70e93[_0x2b7620(0x171)],_0x4a2200=_0xe70e93[_0x2b7620(0x171)],_0x111e9c=await profile['findOne']({'email':_0x4a2200[_0x2b7620(0x1af)]}),_0x597367=await master_shop['find']();console[_0x2b7620(0x190)](_0x2b7620(0x183),_0x597367),console[_0x2b7620(0x190)](_0xe70e93[_0x2b7620(0x170)]['id']);const _0x46c430=await customer['findOne']({'_id':_0xe70e93[_0x2b7620(0x170)]['id']});console[_0x2b7620(0x190)]('customer_data',_0x46c430);const _0xef3898=await c_payment_data[_0x2b7620(0x1b4)]({'customer':_0x46c430[_0x2b7620(0x1ae)]});console[_0x2b7620(0x190)](_0xef3898);const _0x3280bb=await c_payment_data[_0x2b7620(0x1ad)]([{'$match':{'customer':_0x46c430['name']}},{'$match':{'reason':_0x2b7620(0x169)}},{'$group':{'_id':_0x2b7620(0x1c7),'sum':{'$sum':_0x2b7620(0x18e)}}}]);console[_0x2b7620(0x190)](_0x2b7620(0x1c9),_0x3280bb);const _0x6e63bf=await c_payment_data['aggregate']([{'$match':{'customer':_0x46c430['name']}},{'$match':{'reason':_0x2b7620(0x17e)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x2b7620(0x18e)}}}]);console[_0x2b7620(0x190)](_0x2b7620(0x175),_0x6e63bf);if(_0x597367[0x0][_0x2b7620(0x17d)]==_0x2b7620(0x16b)){var _0x3a6b01=users[_0x2b7620(0x1a3)];console[_0x2b7620(0x190)](_0x3a6b01);}else{if(_0x597367[0x0][_0x2b7620(0x17d)]=='Hindi')var _0x3a6b01=users[_0x2b7620(0x1c3)];else{if(_0x597367[0x0][_0x2b7620(0x17d)]==_0x2b7620(0x18f))var _0x3a6b01=users[_0x2b7620(0x18f)];else{if(_0x597367[0x0][_0x2b7620(0x17d)]==_0x2b7620(0x185))var _0x3a6b01=users[_0x2b7620(0x185)];else{if(_0x597367[0x0][_0x2b7620(0x17d)]==_0x2b7620(0x178))var _0x3a6b01=users[_0x2b7620(0x178)];else{if(_0x597367[0x0]['language']=='Portuguese\x20(BR)')var _0x3a6b01=users[_0x2b7620(0x18c)];else{if(_0x597367[0x0][_0x2b7620(0x17d)]==_0x2b7620(0x1b6))var _0x3a6b01=users['Chinese'];else{if(_0x597367[0x0][_0x2b7620(0x17d)]==_0x2b7620(0x17a))var _0x3a6b01=users[_0x2b7620(0x16e)];}}}}}}}_0x2d99d7['render'](_0x2b7620(0x16f),{'success':_0xe70e93[_0x2b7620(0x1a5)]('success'),'errors':_0xe70e93[_0x2b7620(0x1a5)](_0x2b7620(0x1ab)),'role':_0x4a2200,'profile':_0x111e9c,'payment':_0xef3898,'payable':_0x3280bb,'receivable':_0x6e63bf,'master_shop':_0x597367,'language':_0x3a6b01});}catch(_0x36b395){console[_0x2b7620(0x190)](_0x36b395);}}),router[a0_0x2af76d(0x197)]('/products_export_migrate_file',auth,async(_0x780ac2,_0x193ec8)=>{const _0x1bb7ee=a0_0x2af76d;try{const _0x2f73be=new excelJS[(_0x1bb7ee(0x16d))](),_0x15d1a8=_0x2f73be[_0x1bb7ee(0x1a6)](_0x1bb7ee(0x195));return _0x15d1a8['columns']=[{'header':'ID','key':_0x1bb7ee(0x174),'width':0xa},{'header':_0x1bb7ee(0x19e),'key':_0x1bb7ee(0x182),'width':0xa},{'header':'SalesmanCode','key':_0x1bb7ee(0x167),'width':0xa},{'header':_0x1bb7ee(0x181),'key':'SalesmanName','width':0xa},{'header':_0x1bb7ee(0x1a8),'key':_0x1bb7ee(0x1a8),'width':0xa},{'header':_0x1bb7ee(0x1ca),'key':_0x1bb7ee(0x1ca),'width':0xa},{'header':_0x1bb7ee(0x1af),'key':'email','width':0xa}],_0x193ec8[_0x1bb7ee(0x1c0)](_0x1bb7ee(0x1b0),_0x1bb7ee(0x1a9)),_0x193ec8[_0x1bb7ee(0x1c0)](_0x1bb7ee(0x173),'attachment;\x20filename=customer_Migration_File.xlsx'),_0x2f73be[_0x1bb7ee(0x188)]['write'](_0x193ec8)[_0x1bb7ee(0x18b)](()=>{const _0x3ffade=_0x1bb7ee;_0x193ec8[_0x3ffade(0x1ac)](0xc8);});}catch(_0x21eef6){_0x193ec8[_0x1bb7ee(0x1ac)](0x190)[_0x1bb7ee(0x1b8)]({'errors':_0x21eef6[_0x1bb7ee(0x1ba)]});}});const storage1=multer[a0_0x2af76d(0x1bc)]({'destination':(_0x1d5773,_0x277b26,_0x1b5f52)=>{_0x1b5f52(null,'public/Migration');},'filename':(_0x16fc34,_0x37892d,_0x4d15ae)=>{const _0x1e76a9=a0_0x2af76d;_0x4d15ae(null,Date[_0x1e76a9(0x19c)]()+_0x37892d[_0x1e76a9(0x16a)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x2af76d(0x180)](a0_0x2af76d(0x176),auth,uploadMigrate['single'](a0_0x2af76d(0x193)),async(_0x1ff3b5,_0x26177a)=>{const _0xe8a0bd=a0_0x2af76d,_0x2d4560=_0x1ff3b5[_0xe8a0bd(0x1cc)][_0xe8a0bd(0x1b9)],_0x8929ad=await xlsx['readFile']('public/Migration/'+_0x2d4560);let _0x4bd902=_0x8929ad['SheetNames'],_0xc32308=xlsx[_0xe8a0bd(0x16c)][_0xe8a0bd(0x1b1)](_0x8929ad[_0xe8a0bd(0x19a)][_0x4bd902[0x0]]);for(const _0x2888bf of _0xc32308){const _0x3c90bd=_0x2888bf['ID'],_0x466b6e=_0x2888bf[_0xe8a0bd(0x19e)],_0x1878f5=_0x2888bf[_0xe8a0bd(0x1c4)],_0x5d2de2=_0x2888bf[_0xe8a0bd(0x181)],_0x43dba2=_0x2888bf[_0xe8a0bd(0x1a8)],_0x913607=_0x2888bf[_0xe8a0bd(0x1ca)],_0x2e5155=_0x2888bf[_0xe8a0bd(0x1af)];try{let _0x2040b4=await customer[_0xe8a0bd(0x18d)]({'name':_0x466b6e});if(!_0x2040b4){const _0x3d7f6f=new customer({'name':_0x466b6e,'ID':_0x3c90bd,'SalesmanCode':_0x1878f5,'SalesmanName':_0x5d2de2,'address':_0x43dba2,'mobile':_0x913607,'email':_0x2e5155});_0x2040b4=await _0x3d7f6f['save'](),_0x1ff3b5[_0xe8a0bd(0x1a5)](_0xe8a0bd(0x1c2),_0x466b6e+_0xe8a0bd(0x168));}else _0x1ff3b5[_0xe8a0bd(0x1a5)](_0xe8a0bd(0x186),_0x466b6e+_0xe8a0bd(0x17f));}catch(_0x39763b){_0x26177a[_0xe8a0bd(0x1ac)](0x1f4)[_0xe8a0bd(0x194)]({'proderror':_0x39763b[_0xe8a0bd(0x1ba)],'aproduct':ProductName});}}_0x26177a['redirect'](_0xe8a0bd(0x189));}),module[a0_0x2af76d(0x1c1)]=router;