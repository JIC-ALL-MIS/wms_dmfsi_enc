const a0_0x495fa6=a0_0x17ac;(function(_0x1cc356,_0x39f2b1){const _0x102efc=a0_0x17ac,_0x117e5d=_0x1cc356();while(!![]){try{const _0x3b9e8a=-parseInt(_0x102efc(0x174))/0x1*(parseInt(_0x102efc(0x13e))/0x2)+-parseInt(_0x102efc(0x142))/0x3*(-parseInt(_0x102efc(0x15b))/0x4)+-parseInt(_0x102efc(0x155))/0x5+parseInt(_0x102efc(0x151))/0x6*(parseInt(_0x102efc(0x19c))/0x7)+parseInt(_0x102efc(0x19b))/0x8+-parseInt(_0x102efc(0x18c))/0x9*(parseInt(_0x102efc(0x181))/0xa)+parseInt(_0x102efc(0x161))/0xb;if(_0x3b9e8a===_0x39f2b1)break;else _0x117e5d['push'](_0x117e5d['shift']());}catch(_0x33cfca){_0x117e5d['push'](_0x117e5d['shift']());}}}(a0_0x2e34,0x76c31));function a0_0x2e34(){const _0xe66415=['sale','render','../middleware/auth','customer_docs','findOne','redirect','payable','../public/language/languages.json','Router','single','/customer_import_migrate_file','columns','attachment;\x20filename=customer_Migration_File.xlsx','filename','Sale','user','Portuguese\x20(BR)','4OgWbwf','success','English','exceljs','amount','flash','message','utils','addWorksheet','language','\x20added\x20successfully','/customer/view','save','50CPpCaP','address','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','landline','/view','readFile','file','status','$amount','public/Migration','find','1242576fDuGFO','Workbook','email','mobile','SalesmanCode','customer\x20add\x20successfully','customer','map','Portuguese','error','exports','French','errors','Sale\x20Return','public/Migration/','2192136IQtfXZ','7CuTfhI','SheetNames','data','Name','English\x20(US)','customer_payment','findById','sheet_to_json','/view/payment/:id','now','aggregate','10618KAWcfl','../models/all_models','Arabic\x20(ae)','sale_return','12OphqVh','customer_data','json','PBrands','get','element','SalesmanName','customer\x20update\x20successfully','Content-Type','Spanish','Arabic','body','receivable_sum','forEach','originalname','488286BakiEM','/products_export_migrate_file','Hindi','Sheets','4009465BDBUJE','/view/:id','Chinese','name','Customers','log','422804FPFowK','setHeader','German','write','params','$reason','13438656vegoFe','send'];a0_0x2e34=function(){return _0xe66415;};return a0_0x2e34();}const express=require('express'),app=express(),router=express[a0_0x495fa6(0x16b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x495fa6(0x13f)),auth=require(a0_0x495fa6(0x165)),users=require(a0_0x495fa6(0x16a)),excelJS=require(a0_0x495fa6(0x177)),xlsx=require('xlsx'),multer=require('multer');function a0_0x17ac(_0xf731ae,_0x31fdd7){const _0x2e342e=a0_0x2e34();return a0_0x17ac=function(_0x17ac89,_0x2e2c17){_0x17ac89=_0x17ac89-0x13d;let _0x3fe29c=_0x2e342e[_0x17ac89];return _0x3fe29c;},a0_0x17ac(_0xf731ae,_0x31fdd7);}router[a0_0x495fa6(0x146)](a0_0x495fa6(0x185),auth,async(_0x266f88,_0x40e167)=>{const _0x135e94=a0_0x495fa6;try{const {username:_0xc39612,email:_0x111eab,role:_0xdd5544}=_0x266f88[_0x135e94(0x172)],_0x3614e0=_0x266f88[_0x135e94(0x172)],_0x575312=await profile[_0x135e94(0x167)]({'email':_0x3614e0[_0x135e94(0x18e)]}),_0x1d3490=await master_shop['find']();console[_0x135e94(0x15a)]('master',_0x1d3490);const _0x1ccd2b=await customer[_0x135e94(0x18b)](),_0x5dbec9=await customer['aggregate']([{'$lookup':{'from':'c_payments','localField':_0x135e94(0x158),'foreignField':_0x135e94(0x192),'as':_0x135e94(0x166)}}]);console[_0x135e94(0x15a)](_0x5dbec9);const _0x1036cb=_0x5dbec9[_0x135e94(0x193)](_0x3925a5=>{const _0x3ad2d0=_0x135e94;console['log'](_0x3ad2d0(0x19e),_0x3925a5);var _0x4e357e=0x0,_0x5df798=0x0;return _0x3925a5[_0x3ad2d0(0x166)][_0x3ad2d0(0x14f)](_0x4fc98c=>{const _0x2737b5=_0x3ad2d0;console[_0x2737b5(0x15a)](_0x2737b5(0x147),_0x4fc98c),_0x4fc98c['reason']==_0x2737b5(0x171)?_0x4e357e+=_0x4fc98c['amount']:_0x5df798+=_0x4fc98c[_0x2737b5(0x178)];}),_0x3925a5[_0x3ad2d0(0x163)]=parseFloat(_0x4e357e)+0x0,_0x3925a5[_0x3ad2d0(0x141)]=parseFloat(_0x5df798)+0x0,_0x3925a5;});console[_0x135e94(0x15a)]('payment_data',_0x1036cb);if(_0x1d3490[0x0]['language']==_0x135e94(0x1a0)){var _0x28b4cf=users[_0x135e94(0x176)];console[_0x135e94(0x15a)](_0x28b4cf);}else{if(_0x1d3490[0x0][_0x135e94(0x17d)]=='Hindi')var _0x28b4cf=users[_0x135e94(0x153)];else{if(_0x1d3490[0x0][_0x135e94(0x17d)]=='German')var _0x28b4cf=users[_0x135e94(0x15d)];else{if(_0x1d3490[0x0][_0x135e94(0x17d)]==_0x135e94(0x14b))var _0x28b4cf=users[_0x135e94(0x14b)];else{if(_0x1d3490[0x0][_0x135e94(0x17d)]==_0x135e94(0x197))var _0x28b4cf=users[_0x135e94(0x197)];else{if(_0x1d3490[0x0][_0x135e94(0x17d)]=='Portuguese\x20(BR)')var _0x28b4cf=users[_0x135e94(0x194)];else{if(_0x1d3490[0x0][_0x135e94(0x17d)]==_0x135e94(0x157))var _0x28b4cf=users[_0x135e94(0x157)];else{if(_0x1d3490[0x0]['language']=='Arabic\x20(ae)')var _0x28b4cf=users['Arabic'];}}}}}}}_0x40e167[_0x135e94(0x164)](_0x135e94(0x192),{'success':_0x266f88[_0x135e94(0x179)]('success'),'errors':_0x266f88['flash'](_0x135e94(0x198)),'user':_0x1ccd2b,'role':_0x3614e0,'profile':_0x575312,'payment':_0x1036cb,'master_shop':_0x1d3490,'language':_0x28b4cf});}catch(_0x3daf90){console[_0x135e94(0x15a)](_0x3daf90);}}),router['post'](a0_0x495fa6(0x185),auth,async(_0x4abefc,_0xfe3406)=>{const _0x45f50c=a0_0x495fa6;try{const {name:_0x36f57b,address:_0x55b90d,mobile:_0x386200,email:_0x5be8ce,receivable:_0x32893b,payable:_0x487f4b,contactperson:_0x46481d,landline:_0x4f7c83}=_0x4abefc[_0x45f50c(0x14d)],_0x561936=new customer({'name':_0x36f57b,'address':_0x55b90d,'mobile':_0x386200,'email':_0x5be8ce,'receivable':_0x32893b,'payable':_0x487f4b,'contactperson':_0x46481d,'landline':_0x4f7c83}),_0x15cefa=await _0x561936[_0x45f50c(0x180)]();_0x4abefc['flash'](_0x45f50c(0x175),_0x45f50c(0x191)),_0xfe3406[_0x45f50c(0x168)](_0x45f50c(0x17f));}catch(_0x3ad10d){console[_0x45f50c(0x15a)](_0x3ad10d);}}),router['get'](a0_0x495fa6(0x156),auth,async(_0x91eb13,_0x14f476)=>{const _0x4fdfcb=a0_0x495fa6;try{const {username:_0x349491,email:_0x3d7eab,role:_0x400828}=_0x91eb13['user'],_0x38f410=_0x91eb13[_0x4fdfcb(0x172)],_0x2ead41=await profile[_0x4fdfcb(0x167)]({'email':_0x38f410['email']}),_0x562089=await master_shop[_0x4fdfcb(0x18b)]();console[_0x4fdfcb(0x15a)]('master',_0x562089);const _0x324128=_0x91eb13[_0x4fdfcb(0x15f)]['id'],_0x12e04c=await customer[_0x4fdfcb(0x1a2)](_0x324128);if(_0x562089[0x0][_0x4fdfcb(0x17d)]==_0x4fdfcb(0x1a0)){var _0x4ba28f=users[_0x4fdfcb(0x176)];console[_0x4fdfcb(0x15a)](_0x4ba28f);}else{if(_0x562089[0x0][_0x4fdfcb(0x17d)]==_0x4fdfcb(0x153))var _0x4ba28f=users['Hindi'];else{if(_0x562089[0x0][_0x4fdfcb(0x17d)]==_0x4fdfcb(0x15d))var _0x4ba28f=users[_0x4fdfcb(0x15d)];else{if(_0x562089[0x0][_0x4fdfcb(0x17d)]==_0x4fdfcb(0x14b))var _0x4ba28f=users[_0x4fdfcb(0x14b)];else{if(_0x562089[0x0][_0x4fdfcb(0x17d)]==_0x4fdfcb(0x197))var _0x4ba28f=users[_0x4fdfcb(0x197)];else{if(_0x562089[0x0]['language']==_0x4fdfcb(0x173))var _0x4ba28f=users[_0x4fdfcb(0x194)];else{if(_0x562089[0x0][_0x4fdfcb(0x17d)]==_0x4fdfcb(0x157))var _0x4ba28f=users[_0x4fdfcb(0x157)];else{if(_0x562089[0x0][_0x4fdfcb(0x17d)]==_0x4fdfcb(0x140))var _0x4ba28f=users[_0x4fdfcb(0x14c)];}}}}}}}_0x14f476[_0x4fdfcb(0x164)](_0x4fdfcb(0x192),{'success':_0x91eb13['flash'](_0x4fdfcb(0x175)),'errors':_0x91eb13[_0x4fdfcb(0x179)](_0x4fdfcb(0x198)),'role':_0x38f410,'profile':_0x2ead41,'user':_0x12e04c,'master_shop':_0x562089,'language':_0x4ba28f});}catch(_0x436b46){console[_0x4fdfcb(0x15a)](_0x436b46);}}),router['post'](a0_0x495fa6(0x156),auth,async(_0x6bcf3d,_0x430f58)=>{const _0x18bef5=a0_0x495fa6;try{const _0x2888c4=_0x6bcf3d[_0x18bef5(0x15f)]['id'],_0x82f8b=await customer['findById'](_0x2888c4),{name:_0x2c5010,address:_0x56f1b4,mobile:_0x467a12,email:_0x5ab28f,receivable:_0x3278a8,payable:_0x26cc55,contactperson:_0xc7e595,landline:_0x31b130}=_0x6bcf3d['body'];_0x82f8b[_0x18bef5(0x158)]=_0x2c5010,_0x82f8b['address']=_0x56f1b4,_0x82f8b['mobile']=_0x467a12,_0x82f8b[_0x18bef5(0x18e)]=_0x5ab28f,_0x82f8b['receivable']=_0x3278a8,_0x82f8b[_0x18bef5(0x169)]=_0x26cc55,_0x82f8b['contactperson']=_0xc7e595,_0x82f8b[_0x18bef5(0x184)]=_0x31b130;const _0x2987c2=await _0x82f8b[_0x18bef5(0x180)]();_0x6bcf3d[_0x18bef5(0x179)](_0x18bef5(0x175),_0x18bef5(0x149)),_0x430f58[_0x18bef5(0x168)]('/customer/view');}catch(_0x409438){console[_0x18bef5(0x15a)](_0x409438);}}),router['get'](a0_0x495fa6(0x1a4),auth,async(_0x2e77ae,_0x137a3b)=>{const _0x528d6d=a0_0x495fa6;try{const {username:_0x44e338,email:_0x5840ea,role:_0x38c4c0}=_0x2e77ae['user'],_0x539ae4=_0x2e77ae[_0x528d6d(0x172)],_0x24c695=await profile[_0x528d6d(0x167)]({'email':_0x539ae4[_0x528d6d(0x18e)]}),_0x27d705=await master_shop[_0x528d6d(0x18b)]();console[_0x528d6d(0x15a)]('master',_0x27d705),console[_0x528d6d(0x15a)](_0x2e77ae[_0x528d6d(0x15f)]['id']);const _0x3c6d21=await customer[_0x528d6d(0x167)]({'_id':_0x2e77ae[_0x528d6d(0x15f)]['id']});console['log'](_0x528d6d(0x143),_0x3c6d21);const _0x4044c2=await c_payment_data['find']({'customer':_0x3c6d21[_0x528d6d(0x158)]});console['log'](_0x4044c2);const _0x59287b=await c_payment_data[_0x528d6d(0x13d)]([{'$match':{'customer':_0x3c6d21[_0x528d6d(0x158)]}},{'$match':{'reason':_0x528d6d(0x171)}},{'$group':{'_id':_0x528d6d(0x160),'sum':{'$sum':_0x528d6d(0x189)}}}]);console[_0x528d6d(0x15a)]('payable_sum',_0x59287b);const _0xc51fbf=await c_payment_data[_0x528d6d(0x13d)]([{'$match':{'customer':_0x3c6d21['name']}},{'$match':{'reason':_0x528d6d(0x199)}},{'$group':{'_id':_0x528d6d(0x160),'sum':{'$sum':'$amount'}}}]);console[_0x528d6d(0x15a)](_0x528d6d(0x14e),_0xc51fbf);if(_0x27d705[0x0][_0x528d6d(0x17d)]==_0x528d6d(0x1a0)){var _0x25f9c4=users[_0x528d6d(0x176)];console['log'](_0x25f9c4);}else{if(_0x27d705[0x0][_0x528d6d(0x17d)]==_0x528d6d(0x153))var _0x25f9c4=users[_0x528d6d(0x153)];else{if(_0x27d705[0x0][_0x528d6d(0x17d)]==_0x528d6d(0x15d))var _0x25f9c4=users[_0x528d6d(0x15d)];else{if(_0x27d705[0x0][_0x528d6d(0x17d)]=='Spanish')var _0x25f9c4=users['Spanish'];else{if(_0x27d705[0x0][_0x528d6d(0x17d)]==_0x528d6d(0x197))var _0x25f9c4=users['French'];else{if(_0x27d705[0x0][_0x528d6d(0x17d)]==_0x528d6d(0x173))var _0x25f9c4=users[_0x528d6d(0x194)];else{if(_0x27d705[0x0][_0x528d6d(0x17d)]==_0x528d6d(0x157))var _0x25f9c4=users[_0x528d6d(0x157)];else{if(_0x27d705[0x0]['language']=='Arabic\x20(ae)')var _0x25f9c4=users[_0x528d6d(0x14c)];}}}}}}}_0x137a3b[_0x528d6d(0x164)](_0x528d6d(0x1a1),{'success':_0x2e77ae[_0x528d6d(0x179)](_0x528d6d(0x175)),'errors':_0x2e77ae['flash'](_0x528d6d(0x198)),'role':_0x539ae4,'profile':_0x24c695,'payment':_0x4044c2,'payable':_0x59287b,'receivable':_0xc51fbf,'master_shop':_0x27d705,'language':_0x25f9c4});}catch(_0x44f6ba){console[_0x528d6d(0x15a)](_0x44f6ba);}}),router[a0_0x495fa6(0x146)](a0_0x495fa6(0x152),auth,async(_0x54e802,_0x478937)=>{const _0x498039=a0_0x495fa6;try{const _0xe90d20=new excelJS[(_0x498039(0x18d))](),_0x4a640c=_0xe90d20[_0x498039(0x17c)](_0x498039(0x159));return _0x4a640c[_0x498039(0x16e)]=[{'header':'ID','key':'PName','width':0xa},{'header':_0x498039(0x19f),'key':_0x498039(0x145),'width':0xa},{'header':'SalesmanCode','key':'PUnits','width':0xa},{'header':'SalesmanName','key':_0x498039(0x148),'width':0xa},{'header':'address','key':'address','width':0xa},{'header':_0x498039(0x18f),'key':_0x498039(0x18f),'width':0xa},{'header':_0x498039(0x18e),'key':_0x498039(0x18e),'width':0xa}],_0x478937[_0x498039(0x15c)](_0x498039(0x14a),_0x498039(0x183)),_0x478937[_0x498039(0x15c)]('Content-Disposition',_0x498039(0x16f)),_0xe90d20['xlsx'][_0x498039(0x15e)](_0x478937)['then'](()=>{const _0x3a1de5=_0x498039;_0x478937[_0x3a1de5(0x188)](0xc8);});}catch(_0x3738f2){_0x478937[_0x498039(0x188)](0x190)[_0x498039(0x162)]({'errors':_0x3738f2[_0x498039(0x17a)]});}});const storage1=multer['diskStorage']({'destination':(_0x39bac5,_0x21df19,_0x161eab)=>{const _0x3666b4=a0_0x495fa6;_0x161eab(null,_0x3666b4(0x18a));},'filename':(_0x297b21,_0x2f163f,_0x3a4527)=>{const _0x39d033=a0_0x495fa6;_0x3a4527(null,Date[_0x39d033(0x1a5)]()+_0x2f163f[_0x39d033(0x150)]);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x495fa6(0x16d),auth,uploadMigrate[a0_0x495fa6(0x16c)]('customer_product_fule'),async(_0x238a6e,_0x2be5f7)=>{const _0x503b0f=a0_0x495fa6,_0x19aa47=_0x238a6e[_0x503b0f(0x187)][_0x503b0f(0x170)],_0x445a6b=await xlsx[_0x503b0f(0x186)](_0x503b0f(0x19a)+_0x19aa47);let _0x214157=_0x445a6b[_0x503b0f(0x19d)],_0x3265a2=xlsx[_0x503b0f(0x17b)][_0x503b0f(0x1a3)](_0x445a6b[_0x503b0f(0x154)][_0x214157[0x0]]);for(const _0x2fea7d of _0x3265a2){const _0x365300=_0x2fea7d['ID'],_0xe00b73=_0x2fea7d['Name'],_0x34d08a=_0x2fea7d[_0x503b0f(0x190)],_0x4407eb=_0x2fea7d['SalesmanName'],_0x5eb9f1=_0x2fea7d[_0x503b0f(0x182)],_0x28f1b9=_0x2fea7d['mobile'],_0x34da43=_0x2fea7d[_0x503b0f(0x18e)];try{let _0x230f50=await customer['findOne']({'name':_0xe00b73});if(!_0x230f50){const _0x22a377=new customer({'name':_0xe00b73,'ID':_0x365300,'SalesmanCode':_0x34d08a,'SalesmanName':_0x4407eb,'address':_0x5eb9f1,'mobile':_0x28f1b9,'email':_0x34da43});_0x230f50=await _0x22a377[_0x503b0f(0x180)](),_0x238a6e[_0x503b0f(0x179)]('success',_0xe00b73+_0x503b0f(0x17e));}else _0x238a6e[_0x503b0f(0x179)](_0x503b0f(0x195),_0xe00b73+'\x20Failed');}catch(_0x11afb7){_0x2be5f7[_0x503b0f(0x188)](0x1f4)[_0x503b0f(0x144)]({'proderror':_0x11afb7[_0x503b0f(0x17a)],'aproduct':ProductName});}}_0x2be5f7['redirect'](_0x503b0f(0x17f));}),module[a0_0x495fa6(0x196)]=router;