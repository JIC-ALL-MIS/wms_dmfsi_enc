const a0_0x2af981=a0_0xbebb;function a0_0x330d(){const _0x20d0ef=['body','columns','exceljs','setHeader','/customer/view','Name','86cscfCZ','name','474KrOika','params','Arabic\x20(ae)','customer_data','customer_docs','master','get','Spanish','attachment;\x20filename=customer_Migration_File.xlsx','language','reason','error','Portuguese\x20(BR)','9402VQWTMt','flash','../public/language/languages.json','post','single','PUnits','English\x20(US)','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','sheet_to_json','save','findById','address','/customer_import_migrate_file','German','findOne','22896XfpbWd','sale_return','Hindi','SalesmanName','925595MAxfMM','Customers','/view/:id','SalesmanCode','1737CWLsuV','mobile','3907JswggB','/view','public/Migration/','email','$amount','exports','file','aggregate','PName','184gxpVXY','amount','user','PBrands','customer\x20update\x20successfully','find','errors','Portuguese','../models/all_models','success','customer','log','write','receivable','\x20added\x20successfully','payment_data','addWorksheet','readFile','/products_export_migrate_file','filename','status','Content-Type','10973580sjrhdL','12PHLwdA','then','Chinese','16218444xHBIpe','/view/payment/:id','Content-Disposition','message','element','xlsx','map','contactperson','render','multer','redirect','customer_product_fule','json','Arabic','English','Router','141365kdAfMF','$reason','Sale','French'];a0_0x330d=function(){return _0x20d0ef;};return a0_0x330d();}(function(_0x30a50d,_0x48093c){const _0x2199dd=a0_0xbebb,_0x143a9c=_0x30a50d();while(!![]){try{const _0x51a037=parseInt(_0x2199dd(0x17a))/0x1*(-parseInt(_0x2199dd(0x1b7))/0x2)+parseInt(_0x2199dd(0x1c6))/0x3*(parseInt(_0x2199dd(0x183))/0x4)+parseInt(_0x2199dd(0x174))/0x5+-parseInt(_0x2199dd(0x1b9))/0x6*(-parseInt(_0x2199dd(0x1ad))/0x7)+parseInt(_0x2199dd(0x1d5))/0x8*(-parseInt(_0x2199dd(0x178))/0x9)+parseInt(_0x2199dd(0x199))/0xa+parseInt(_0x2199dd(0x19d))/0xb*(-parseInt(_0x2199dd(0x19a))/0xc);if(_0x51a037===_0x48093c)break;else _0x143a9c['push'](_0x143a9c['shift']());}catch(_0x568f52){_0x143a9c['push'](_0x143a9c['shift']());}}}(a0_0x330d,0xc9f8b));const express=require('express'),app=express(),router=express[a0_0x2af981(0x1ac)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x2af981(0x18b)),auth=require('../middleware/auth'),users=require(a0_0x2af981(0x1c8)),excelJS=require(a0_0x2af981(0x1b3)),xlsx=require(a0_0x2af981(0x1a2)),multer=require(a0_0x2af981(0x1a6));router[a0_0x2af981(0x1bf)](a0_0x2af981(0x17b),auth,async(_0x26c1ed,_0x464323)=>{const _0x48d83c=a0_0x2af981;try{const {username:_0x2f9db1,email:_0x5a5cdb,role:_0x274534}=_0x26c1ed[_0x48d83c(0x185)],_0x2aca8d=_0x26c1ed[_0x48d83c(0x185)],_0x3abc8d=await profile[_0x48d83c(0x1d4)]({'email':_0x2aca8d['email']}),_0x15dabd=await master_shop['find']();console['log'](_0x48d83c(0x1be),_0x15dabd);const _0x434f9e=await customer['find'](),_0x43be8e=await customer[_0x48d83c(0x181)]([{'$lookup':{'from':'c_payments','localField':'name','foreignField':_0x48d83c(0x18d),'as':_0x48d83c(0x1bd)}}]);console[_0x48d83c(0x18e)](_0x43be8e);const _0x37325b=_0x43be8e[_0x48d83c(0x1a3)](_0x4ec7a6=>{const _0x2b391d=_0x48d83c;console[_0x2b391d(0x18e)]('data',_0x4ec7a6);var _0x2c4cde=0x0,_0x216675=0x0;return _0x4ec7a6[_0x2b391d(0x1bd)]['forEach'](_0x1b0496=>{const _0x267874=_0x2b391d;console[_0x267874(0x18e)](_0x267874(0x1a1),_0x1b0496),_0x1b0496[_0x267874(0x1c3)]==_0x267874(0x1af)?_0x2c4cde+=_0x1b0496[_0x267874(0x184)]:_0x216675+=_0x1b0496[_0x267874(0x184)];}),_0x4ec7a6['sale']=parseFloat(_0x2c4cde)+0x0,_0x4ec7a6[_0x2b391d(0x171)]=parseFloat(_0x216675)+0x0,_0x4ec7a6;});console[_0x48d83c(0x18e)](_0x48d83c(0x192),_0x37325b);if(_0x15dabd[0x0]['language']==_0x48d83c(0x1cc)){var _0x148c59=users[_0x48d83c(0x1ab)];console[_0x48d83c(0x18e)](_0x148c59);}else{if(_0x15dabd[0x0][_0x48d83c(0x1c2)]=='Hindi')var _0x148c59=users['Hindi'];else{if(_0x15dabd[0x0][_0x48d83c(0x1c2)]==_0x48d83c(0x1d3))var _0x148c59=users[_0x48d83c(0x1d3)];else{if(_0x15dabd[0x0][_0x48d83c(0x1c2)]==_0x48d83c(0x1c0))var _0x148c59=users[_0x48d83c(0x1c0)];else{if(_0x15dabd[0x0]['language']==_0x48d83c(0x1b0))var _0x148c59=users[_0x48d83c(0x1b0)];else{if(_0x15dabd[0x0][_0x48d83c(0x1c2)]==_0x48d83c(0x1c5))var _0x148c59=users['Portuguese'];else{if(_0x15dabd[0x0][_0x48d83c(0x1c2)]==_0x48d83c(0x19c))var _0x148c59=users[_0x48d83c(0x19c)];else{if(_0x15dabd[0x0][_0x48d83c(0x1c2)]=='Arabic\x20(ae)')var _0x148c59=users['Arabic'];}}}}}}}_0x464323[_0x48d83c(0x1a5)](_0x48d83c(0x18d),{'success':_0x26c1ed['flash'](_0x48d83c(0x18c)),'errors':_0x26c1ed[_0x48d83c(0x1c7)]('errors'),'user':_0x434f9e,'role':_0x2aca8d,'profile':_0x3abc8d,'payment':_0x37325b,'master_shop':_0x15dabd,'language':_0x148c59});}catch(_0x360529){console[_0x48d83c(0x18e)](_0x360529);}}),router[a0_0x2af981(0x1c9)](a0_0x2af981(0x17b),auth,async(_0x524bea,_0x37a476)=>{const _0x52d9a=a0_0x2af981;try{const {name:_0xeaea13,address:_0x1ce37d,mobile:_0x1e8e9e,email:_0x36aafe,receivable:_0x548cd2,payable:_0x3c906a,contactperson:_0x3dfb95,landline:_0x65ac14}=_0x524bea[_0x52d9a(0x1b1)],_0xef7a45=new customer({'name':_0xeaea13,'address':_0x1ce37d,'mobile':_0x1e8e9e,'email':_0x36aafe,'receivable':_0x548cd2,'payable':_0x3c906a,'contactperson':_0x3dfb95,'landline':_0x65ac14}),_0x46af96=await _0xef7a45[_0x52d9a(0x1cf)]();_0x524bea['flash'](_0x52d9a(0x18c),'customer\x20add\x20successfully'),_0x37a476[_0x52d9a(0x1a7)](_0x52d9a(0x1b5));}catch(_0x239c9b){console[_0x52d9a(0x18e)](_0x239c9b);}}),router[a0_0x2af981(0x1bf)](a0_0x2af981(0x176),auth,async(_0x461817,_0x21316c)=>{const _0x58b2d7=a0_0x2af981;try{const {username:_0x68f480,email:_0x3de004,role:_0x392b69}=_0x461817[_0x58b2d7(0x185)],_0x423313=_0x461817['user'],_0x4c482d=await profile[_0x58b2d7(0x1d4)]({'email':_0x423313[_0x58b2d7(0x17d)]}),_0x35c358=await master_shop['find']();console[_0x58b2d7(0x18e)]('master',_0x35c358);const _0x561c2a=_0x461817[_0x58b2d7(0x1ba)]['id'],_0x6dd96e=await customer[_0x58b2d7(0x1d0)](_0x561c2a);if(_0x35c358[0x0][_0x58b2d7(0x1c2)]==_0x58b2d7(0x1cc)){var _0x52ac93=users['English'];console[_0x58b2d7(0x18e)](_0x52ac93);}else{if(_0x35c358[0x0][_0x58b2d7(0x1c2)]==_0x58b2d7(0x172))var _0x52ac93=users['Hindi'];else{if(_0x35c358[0x0][_0x58b2d7(0x1c2)]==_0x58b2d7(0x1d3))var _0x52ac93=users[_0x58b2d7(0x1d3)];else{if(_0x35c358[0x0][_0x58b2d7(0x1c2)]==_0x58b2d7(0x1c0))var _0x52ac93=users[_0x58b2d7(0x1c0)];else{if(_0x35c358[0x0]['language']==_0x58b2d7(0x1b0))var _0x52ac93=users['French'];else{if(_0x35c358[0x0][_0x58b2d7(0x1c2)]==_0x58b2d7(0x1c5))var _0x52ac93=users[_0x58b2d7(0x18a)];else{if(_0x35c358[0x0]['language']==_0x58b2d7(0x19c))var _0x52ac93=users[_0x58b2d7(0x19c)];else{if(_0x35c358[0x0][_0x58b2d7(0x1c2)]==_0x58b2d7(0x1bb))var _0x52ac93=users['Arabic'];}}}}}}}_0x21316c['render']('customer',{'success':_0x461817['flash']('success'),'errors':_0x461817[_0x58b2d7(0x1c7)](_0x58b2d7(0x189)),'role':_0x423313,'profile':_0x4c482d,'user':_0x6dd96e,'master_shop':_0x35c358,'language':_0x52ac93});}catch(_0x457309){console['log'](_0x457309);}}),router['post'](a0_0x2af981(0x176),auth,async(_0x18da3f,_0x1ce556)=>{const _0x1cb759=a0_0x2af981;try{const _0x1c8356=_0x18da3f[_0x1cb759(0x1ba)]['id'],_0x1b35d5=await customer[_0x1cb759(0x1d0)](_0x1c8356),{name:_0x2c2635,address:_0x67811a,mobile:_0xeef68d,email:_0x449fc3,receivable:_0xe9d36a,payable:_0x4e5eb7,contactperson:_0x140dde,landline:_0xfd0dd4}=_0x18da3f[_0x1cb759(0x1b1)];_0x1b35d5[_0x1cb759(0x1b8)]=_0x2c2635,_0x1b35d5[_0x1cb759(0x1d1)]=_0x67811a,_0x1b35d5['mobile']=_0xeef68d,_0x1b35d5[_0x1cb759(0x17d)]=_0x449fc3,_0x1b35d5[_0x1cb759(0x190)]=_0xe9d36a,_0x1b35d5['payable']=_0x4e5eb7,_0x1b35d5[_0x1cb759(0x1a4)]=_0x140dde,_0x1b35d5['landline']=_0xfd0dd4;const _0x403474=await _0x1b35d5[_0x1cb759(0x1cf)]();_0x18da3f[_0x1cb759(0x1c7)](_0x1cb759(0x18c),_0x1cb759(0x187)),_0x1ce556['redirect'](_0x1cb759(0x1b5));}catch(_0x5e3776){console[_0x1cb759(0x18e)](_0x5e3776);}}),router[a0_0x2af981(0x1bf)](a0_0x2af981(0x19e),auth,async(_0x4a543d,_0x2a5d4d)=>{const _0x47f725=a0_0x2af981;try{const {username:_0x365b73,email:_0x1d3688,role:_0x3a380a}=_0x4a543d[_0x47f725(0x185)],_0x3a164f=_0x4a543d['user'],_0x51cdd7=await profile['findOne']({'email':_0x3a164f[_0x47f725(0x17d)]}),_0x4cacfa=await master_shop['find']();console['log'](_0x47f725(0x1be),_0x4cacfa),console[_0x47f725(0x18e)](_0x4a543d['params']['id']);const _0x447a67=await customer[_0x47f725(0x1d4)]({'_id':_0x4a543d[_0x47f725(0x1ba)]['id']});console['log'](_0x47f725(0x1bc),_0x447a67);const _0x3d0013=await c_payment_data[_0x47f725(0x188)]({'customer':_0x447a67[_0x47f725(0x1b8)]});console['log'](_0x3d0013);const _0x2b0568=await c_payment_data[_0x47f725(0x181)]([{'$match':{'customer':_0x447a67['name']}},{'$match':{'reason':_0x47f725(0x1af)}},{'$group':{'_id':_0x47f725(0x1ae),'sum':{'$sum':_0x47f725(0x17e)}}}]);console[_0x47f725(0x18e)]('payable_sum',_0x2b0568);const _0x204986=await c_payment_data[_0x47f725(0x181)]([{'$match':{'customer':_0x447a67[_0x47f725(0x1b8)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x47f725(0x17e)}}}]);console['log']('receivable_sum',_0x204986);if(_0x4cacfa[0x0]['language']=='English\x20(US)'){var _0x9a0271=users['English'];console[_0x47f725(0x18e)](_0x9a0271);}else{if(_0x4cacfa[0x0][_0x47f725(0x1c2)]==_0x47f725(0x172))var _0x9a0271=users['Hindi'];else{if(_0x4cacfa[0x0][_0x47f725(0x1c2)]==_0x47f725(0x1d3))var _0x9a0271=users['German'];else{if(_0x4cacfa[0x0][_0x47f725(0x1c2)]==_0x47f725(0x1c0))var _0x9a0271=users[_0x47f725(0x1c0)];else{if(_0x4cacfa[0x0][_0x47f725(0x1c2)]==_0x47f725(0x1b0))var _0x9a0271=users[_0x47f725(0x1b0)];else{if(_0x4cacfa[0x0][_0x47f725(0x1c2)]=='Portuguese\x20(BR)')var _0x9a0271=users[_0x47f725(0x18a)];else{if(_0x4cacfa[0x0][_0x47f725(0x1c2)]=='Chinese')var _0x9a0271=users['Chinese'];else{if(_0x4cacfa[0x0]['language']==_0x47f725(0x1bb))var _0x9a0271=users[_0x47f725(0x1aa)];}}}}}}}_0x2a5d4d[_0x47f725(0x1a5)]('customer_payment',{'success':_0x4a543d[_0x47f725(0x1c7)](_0x47f725(0x18c)),'errors':_0x4a543d[_0x47f725(0x1c7)]('errors'),'role':_0x3a164f,'profile':_0x51cdd7,'payment':_0x3d0013,'payable':_0x2b0568,'receivable':_0x204986,'master_shop':_0x4cacfa,'language':_0x9a0271});}catch(_0x50dd1a){console['log'](_0x50dd1a);}}),router[a0_0x2af981(0x1bf)](a0_0x2af981(0x195),auth,async(_0x5b5e05,_0x376625)=>{const _0x296dcd=a0_0x2af981;try{const _0x5e89d4=new excelJS['Workbook'](),_0xdf3515=_0x5e89d4[_0x296dcd(0x193)](_0x296dcd(0x175));return _0xdf3515[_0x296dcd(0x1b2)]=[{'header':'ID','key':_0x296dcd(0x182),'width':0xa},{'header':_0x296dcd(0x1b6),'key':_0x296dcd(0x186),'width':0xa},{'header':_0x296dcd(0x177),'key':_0x296dcd(0x1cb),'width':0xa},{'header':'SalesmanName','key':_0x296dcd(0x173),'width':0xa},{'header':_0x296dcd(0x1d1),'key':_0x296dcd(0x1d1),'width':0xa},{'header':_0x296dcd(0x179),'key':_0x296dcd(0x179),'width':0xa},{'header':_0x296dcd(0x17d),'key':_0x296dcd(0x17d),'width':0xa}],_0x376625[_0x296dcd(0x1b4)](_0x296dcd(0x198),_0x296dcd(0x1cd)),_0x376625['setHeader'](_0x296dcd(0x19f),_0x296dcd(0x1c1)),_0x5e89d4['xlsx'][_0x296dcd(0x18f)](_0x376625)[_0x296dcd(0x19b)](()=>{const _0x16c477=_0x296dcd;_0x376625[_0x16c477(0x197)](0xc8);});}catch(_0x17e3a6){_0x376625[_0x296dcd(0x197)](0x190)['send']({'errors':_0x17e3a6[_0x296dcd(0x1a0)]});}});const storage1=multer['diskStorage']({'destination':(_0x5e7453,_0x3fe0fe,_0x39b935)=>{_0x39b935(null,'public/Migration');},'filename':(_0x3a8e9c,_0x27dfff,_0x559b17)=>{_0x559b17(null,Date['now']()+_0x27dfff['originalname']);}}),uploadMigrate=multer({'storage':storage1});function a0_0xbebb(_0x6dc691,_0x5cad1c){const _0x330d40=a0_0x330d();return a0_0xbebb=function(_0xbebbb8,_0x4dfe71){_0xbebbb8=_0xbebbb8-0x171;let _0x4c5189=_0x330d40[_0xbebbb8];return _0x4c5189;},a0_0xbebb(_0x6dc691,_0x5cad1c);}router['post'](a0_0x2af981(0x1d2),auth,uploadMigrate[a0_0x2af981(0x1ca)](a0_0x2af981(0x1a8)),async(_0x589ba8,_0x341625)=>{const _0x1d4f04=a0_0x2af981,_0x3ea5d0=_0x589ba8[_0x1d4f04(0x180)][_0x1d4f04(0x196)],_0x128b22=await xlsx[_0x1d4f04(0x194)](_0x1d4f04(0x17c)+_0x3ea5d0);let _0x1f7ffc=_0x128b22['SheetNames'],_0x3a9ae9=xlsx['utils'][_0x1d4f04(0x1ce)](_0x128b22['Sheets'][_0x1f7ffc[0x0]]);for(const _0x36d085 of _0x3a9ae9){const _0x4eac03=_0x36d085['ID'],_0x5fa65f=_0x36d085[_0x1d4f04(0x1b6)],_0x1bfd88=_0x36d085[_0x1d4f04(0x177)],_0x5d881f=_0x36d085['SalesmanName'],_0x243081=_0x36d085[_0x1d4f04(0x1d1)],_0x1febfd=_0x36d085['mobile'],_0x2b29fa=_0x36d085['email'];try{let _0x2d72ef=await customer[_0x1d4f04(0x1d4)]({'name':_0x5fa65f});if(!_0x2d72ef){const _0x393d86=new customer({'name':_0x5fa65f,'ID':_0x4eac03,'SalesmanCode':_0x1bfd88,'SalesmanName':_0x5d881f,'address':_0x243081,'mobile':_0x1febfd,'email':_0x2b29fa});_0x2d72ef=await _0x393d86[_0x1d4f04(0x1cf)](),_0x589ba8[_0x1d4f04(0x1c7)](_0x1d4f04(0x18c),_0x5fa65f+_0x1d4f04(0x191));}else _0x589ba8['flash'](_0x1d4f04(0x1c4),_0x5fa65f+'\x20Failed');}catch(_0x2e2a78){_0x341625[_0x1d4f04(0x197)](0x1f4)[_0x1d4f04(0x1a9)]({'proderror':_0x2e2a78['message'],'aproduct':ProductName});}}_0x341625[_0x1d4f04(0x1a7)](_0x1d4f04(0x1b5));}),module[a0_0x2af981(0x17f)]=router;