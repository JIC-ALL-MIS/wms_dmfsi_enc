const a0_0xcb5579=a0_0x97a1;function a0_0x532a(){const _0x5873d2=['English\x20(US)','customer','$amount','language','message','send','13270QBjOAN','26216tRMUqv','customer_product_fule','forEach','get','\x20Failed','customer\x20add\x20successfully','1132347uCGHJP','French','/customer/view','utils','log','diskStorage','post','payable_sum','file','aggregate','English','German','findOne','Sale','327qvmtag','readFile','email','Sheets','Arabic\x20(ae)','/products_export_migrate_file','sale','2280278bJvdOe','Name','exports','Hindi','Router','customer_docs','attachment;\x20filename=customer_Migration_File.xlsx','PName','element','5225346LqdiLe','findById','body','xlsx','Portuguese','express','address','addWorksheet','$reason','filename','setHeader','304090KtibxC','sale_return','Sale\x20Return','1165616EqsOPj','public/Migration','\x20added\x20successfully','single','json','../models/all_models','Customers','find','customer_payment','multer','payable','PUnits','Content-Disposition','SalesmanCode','success','master','1818JwjfPB','../middleware/auth','/view/:id','Content-Type','params','30QcmPbH','Portuguese\x20(BR)','Workbook','mobile','SalesmanName','save','name','map','status','Chinese','render','redirect','Arabic','errors','user','receivable','exceljs','originalname','flash','payment_data','/view','Spanish','../public/language/languages.json','landline','public/Migration/'];a0_0x532a=function(){return _0x5873d2;};return a0_0x532a();}(function(_0x57bcde,_0x3a70ef){const _0x43a90f=a0_0x97a1,_0xc1633=_0x57bcde();while(!![]){try{const _0x1665e0=-parseInt(_0x43a90f(0x182))/0x1+parseInt(_0x43a90f(0x197))/0x2+parseInt(_0x43a90f(0x190))/0x3*(parseInt(_0x43a90f(0x17c))/0x4)+-parseInt(_0x43a90f(0x1ab))/0x5*(parseInt(_0x43a90f(0x1c3))/0x6)+parseInt(_0x43a90f(0x1a0))/0x7+-parseInt(_0x43a90f(0x1ae))/0x8+-parseInt(_0x43a90f(0x1be))/0x9*(parseInt(_0x43a90f(0x17b))/0xa);if(_0x1665e0===_0x3a70ef)break;else _0xc1633['push'](_0xc1633['shift']());}catch(_0x34eef2){_0xc1633['push'](_0xc1633['shift']());}}}(a0_0x532a,0xb74da));const express=require(a0_0xcb5579(0x1a5)),app=express(),router=express[a0_0xcb5579(0x19b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0xcb5579(0x1b3)),auth=require(a0_0xcb5579(0x1bf)),users=require(a0_0xcb5579(0x172)),excelJS=require(a0_0xcb5579(0x16c)),xlsx=require('xlsx'),multer=require(a0_0xcb5579(0x1b7));router[a0_0xcb5579(0x17f)](a0_0xcb5579(0x170),auth,async(_0x492059,_0x763a9d)=>{const _0x15f77a=a0_0xcb5579;try{const {username:_0x6c3e2a,email:_0x2d69da,role:_0x15ed93}=_0x492059[_0x15f77a(0x1d1)],_0x3d4b9b=_0x492059['user'],_0x245a34=await profile[_0x15f77a(0x18e)]({'email':_0x3d4b9b[_0x15f77a(0x192)]}),_0x23b305=await master_shop[_0x15f77a(0x1b5)]();console[_0x15f77a(0x186)]('master',_0x23b305);const _0x517a27=await customer[_0x15f77a(0x1b5)](),_0x41251c=await customer[_0x15f77a(0x18b)]([{'$lookup':{'from':'c_payments','localField':_0x15f77a(0x1c9),'foreignField':_0x15f77a(0x176),'as':_0x15f77a(0x19c)}}]);console[_0x15f77a(0x186)](_0x41251c);const _0x1cec97=_0x41251c[_0x15f77a(0x1ca)](_0x48f01a=>{const _0x14ad25=_0x15f77a;console['log']('data',_0x48f01a);var _0x23c26f=0x0,_0x516d02=0x0;return _0x48f01a[_0x14ad25(0x19c)][_0x14ad25(0x17e)](_0x3aeb82=>{const _0x5b0f95=_0x14ad25;console['log'](_0x5b0f95(0x19f),_0x3aeb82),_0x3aeb82['reason']==_0x5b0f95(0x18f)?_0x23c26f+=_0x3aeb82['amount']:_0x516d02+=_0x3aeb82['amount'];}),_0x48f01a[_0x14ad25(0x196)]=parseFloat(_0x23c26f)+0x0,_0x48f01a[_0x14ad25(0x1ac)]=parseFloat(_0x516d02)+0x0,_0x48f01a;});console[_0x15f77a(0x186)](_0x15f77a(0x16f),_0x1cec97);if(_0x23b305[0x0]['language']==_0x15f77a(0x175)){var _0x4fd441=users[_0x15f77a(0x18c)];console[_0x15f77a(0x186)](_0x4fd441);}else{if(_0x23b305[0x0]['language']=='Hindi')var _0x4fd441=users['Hindi'];else{if(_0x23b305[0x0][_0x15f77a(0x178)]==_0x15f77a(0x18d))var _0x4fd441=users[_0x15f77a(0x18d)];else{if(_0x23b305[0x0]['language']=='Spanish')var _0x4fd441=users['Spanish'];else{if(_0x23b305[0x0][_0x15f77a(0x178)]==_0x15f77a(0x183))var _0x4fd441=users[_0x15f77a(0x183)];else{if(_0x23b305[0x0][_0x15f77a(0x178)]==_0x15f77a(0x1c4))var _0x4fd441=users[_0x15f77a(0x1a4)];else{if(_0x23b305[0x0][_0x15f77a(0x178)]=='Chinese')var _0x4fd441=users[_0x15f77a(0x1cc)];else{if(_0x23b305[0x0]['language']==_0x15f77a(0x194))var _0x4fd441=users[_0x15f77a(0x1cf)];}}}}}}}_0x763a9d['render'](_0x15f77a(0x176),{'success':_0x492059[_0x15f77a(0x16e)](_0x15f77a(0x1bc)),'errors':_0x492059[_0x15f77a(0x16e)](_0x15f77a(0x1d0)),'user':_0x517a27,'role':_0x3d4b9b,'profile':_0x245a34,'payment':_0x1cec97,'master_shop':_0x23b305,'language':_0x4fd441});}catch(_0xd746e3){console[_0x15f77a(0x186)](_0xd746e3);}}),router[a0_0xcb5579(0x188)](a0_0xcb5579(0x170),auth,async(_0x2cb110,_0x584a18)=>{const _0x56757d=a0_0xcb5579;try{const {name:_0x9802d9,address:_0x52da75,mobile:_0x25573d,email:_0x360ce2,receivable:_0x32709a,payable:_0x3ac995,contactperson:_0x410348,landline:_0xfb129c}=_0x2cb110['body'],_0x6fd0ce=new customer({'name':_0x9802d9,'address':_0x52da75,'mobile':_0x25573d,'email':_0x360ce2,'receivable':_0x32709a,'payable':_0x3ac995,'contactperson':_0x410348,'landline':_0xfb129c}),_0x3f7b7c=await _0x6fd0ce['save']();_0x2cb110[_0x56757d(0x16e)]('success',_0x56757d(0x181)),_0x584a18[_0x56757d(0x1ce)](_0x56757d(0x184));}catch(_0x3d29a4){console[_0x56757d(0x186)](_0x3d29a4);}}),router[a0_0xcb5579(0x17f)](a0_0xcb5579(0x1c0),auth,async(_0xbde7d0,_0x13b919)=>{const _0x4bfa36=a0_0xcb5579;try{const {username:_0x331513,email:_0x4cc45c,role:_0x418f5e}=_0xbde7d0[_0x4bfa36(0x1d1)],_0x1af055=_0xbde7d0[_0x4bfa36(0x1d1)],_0x1784ed=await profile[_0x4bfa36(0x18e)]({'email':_0x1af055[_0x4bfa36(0x192)]}),_0xb23731=await master_shop['find']();console[_0x4bfa36(0x186)](_0x4bfa36(0x1bd),_0xb23731);const _0xee72d1=_0xbde7d0[_0x4bfa36(0x1c2)]['id'],_0x357e22=await customer[_0x4bfa36(0x1a1)](_0xee72d1);if(_0xb23731[0x0]['language']==_0x4bfa36(0x175)){var _0x149e16=users[_0x4bfa36(0x18c)];console[_0x4bfa36(0x186)](_0x149e16);}else{if(_0xb23731[0x0][_0x4bfa36(0x178)]=='Hindi')var _0x149e16=users[_0x4bfa36(0x19a)];else{if(_0xb23731[0x0][_0x4bfa36(0x178)]==_0x4bfa36(0x18d))var _0x149e16=users[_0x4bfa36(0x18d)];else{if(_0xb23731[0x0]['language']==_0x4bfa36(0x171))var _0x149e16=users['Spanish'];else{if(_0xb23731[0x0][_0x4bfa36(0x178)]==_0x4bfa36(0x183))var _0x149e16=users[_0x4bfa36(0x183)];else{if(_0xb23731[0x0]['language']=='Portuguese\x20(BR)')var _0x149e16=users[_0x4bfa36(0x1a4)];else{if(_0xb23731[0x0]['language']==_0x4bfa36(0x1cc))var _0x149e16=users[_0x4bfa36(0x1cc)];else{if(_0xb23731[0x0][_0x4bfa36(0x178)]=='Arabic\x20(ae)')var _0x149e16=users[_0x4bfa36(0x1cf)];}}}}}}}_0x13b919['render']('customer',{'success':_0xbde7d0[_0x4bfa36(0x16e)]('success'),'errors':_0xbde7d0[_0x4bfa36(0x16e)](_0x4bfa36(0x1d0)),'role':_0x1af055,'profile':_0x1784ed,'user':_0x357e22,'master_shop':_0xb23731,'language':_0x149e16});}catch(_0x2080a3){console[_0x4bfa36(0x186)](_0x2080a3);}}),router[a0_0xcb5579(0x188)](a0_0xcb5579(0x1c0),auth,async(_0x5b5495,_0x153a2e)=>{const _0x9d6fd5=a0_0xcb5579;try{const _0x57a642=_0x5b5495[_0x9d6fd5(0x1c2)]['id'],_0x3ae53d=await customer[_0x9d6fd5(0x1a1)](_0x57a642),{name:_0x43341f,address:_0x25db1d,mobile:_0x1924fc,email:_0x1063db,receivable:_0x23c2bb,payable:_0x13c6a7,contactperson:_0x1ddeb5,landline:_0x586abc}=_0x5b5495[_0x9d6fd5(0x1a2)];_0x3ae53d[_0x9d6fd5(0x1c9)]=_0x43341f,_0x3ae53d[_0x9d6fd5(0x1a6)]=_0x25db1d,_0x3ae53d[_0x9d6fd5(0x1c6)]=_0x1924fc,_0x3ae53d[_0x9d6fd5(0x192)]=_0x1063db,_0x3ae53d[_0x9d6fd5(0x1d2)]=_0x23c2bb,_0x3ae53d[_0x9d6fd5(0x1b8)]=_0x13c6a7,_0x3ae53d['contactperson']=_0x1ddeb5,_0x3ae53d[_0x9d6fd5(0x173)]=_0x586abc;const _0xbf05ff=await _0x3ae53d[_0x9d6fd5(0x1c8)]();_0x5b5495[_0x9d6fd5(0x16e)]('success','customer\x20update\x20successfully'),_0x153a2e[_0x9d6fd5(0x1ce)](_0x9d6fd5(0x184));}catch(_0x208272){console[_0x9d6fd5(0x186)](_0x208272);}}),router[a0_0xcb5579(0x17f)]('/view/payment/:id',auth,async(_0x1a7dac,_0x4a0de1)=>{const _0x2463ec=a0_0xcb5579;try{const {username:_0x2b050e,email:_0x1b5af0,role:_0x78a456}=_0x1a7dac[_0x2463ec(0x1d1)],_0x26e5f4=_0x1a7dac[_0x2463ec(0x1d1)],_0xeedc0e=await profile['findOne']({'email':_0x26e5f4[_0x2463ec(0x192)]}),_0x282319=await master_shop[_0x2463ec(0x1b5)]();console[_0x2463ec(0x186)]('master',_0x282319),console[_0x2463ec(0x186)](_0x1a7dac[_0x2463ec(0x1c2)]['id']);const _0x55f2a3=await customer[_0x2463ec(0x18e)]({'_id':_0x1a7dac[_0x2463ec(0x1c2)]['id']});console[_0x2463ec(0x186)]('customer_data',_0x55f2a3);const _0x20c7ff=await c_payment_data[_0x2463ec(0x1b5)]({'customer':_0x55f2a3[_0x2463ec(0x1c9)]});console[_0x2463ec(0x186)](_0x20c7ff);const _0x239fcf=await c_payment_data[_0x2463ec(0x18b)]([{'$match':{'customer':_0x55f2a3[_0x2463ec(0x1c9)]}},{'$match':{'reason':_0x2463ec(0x18f)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x2463ec(0x177)}}}]);console['log'](_0x2463ec(0x189),_0x239fcf);const _0x2084ce=await c_payment_data[_0x2463ec(0x18b)]([{'$match':{'customer':_0x55f2a3[_0x2463ec(0x1c9)]}},{'$match':{'reason':_0x2463ec(0x1ad)}},{'$group':{'_id':_0x2463ec(0x1a8),'sum':{'$sum':_0x2463ec(0x177)}}}]);console['log']('receivable_sum',_0x2084ce);if(_0x282319[0x0][_0x2463ec(0x178)]=='English\x20(US)'){var _0x56271e=users[_0x2463ec(0x18c)];console[_0x2463ec(0x186)](_0x56271e);}else{if(_0x282319[0x0][_0x2463ec(0x178)]==_0x2463ec(0x19a))var _0x56271e=users['Hindi'];else{if(_0x282319[0x0][_0x2463ec(0x178)]=='German')var _0x56271e=users['German'];else{if(_0x282319[0x0][_0x2463ec(0x178)]=='Spanish')var _0x56271e=users[_0x2463ec(0x171)];else{if(_0x282319[0x0]['language']=='French')var _0x56271e=users[_0x2463ec(0x183)];else{if(_0x282319[0x0][_0x2463ec(0x178)]==_0x2463ec(0x1c4))var _0x56271e=users['Portuguese'];else{if(_0x282319[0x0]['language']==_0x2463ec(0x1cc))var _0x56271e=users['Chinese'];else{if(_0x282319[0x0]['language']==_0x2463ec(0x194))var _0x56271e=users[_0x2463ec(0x1cf)];}}}}}}}_0x4a0de1[_0x2463ec(0x1cd)](_0x2463ec(0x1b6),{'success':_0x1a7dac[_0x2463ec(0x16e)](_0x2463ec(0x1bc)),'errors':_0x1a7dac[_0x2463ec(0x16e)](_0x2463ec(0x1d0)),'role':_0x26e5f4,'profile':_0xeedc0e,'payment':_0x20c7ff,'payable':_0x239fcf,'receivable':_0x2084ce,'master_shop':_0x282319,'language':_0x56271e});}catch(_0x4708cc){console['log'](_0x4708cc);}}),router[a0_0xcb5579(0x17f)](a0_0xcb5579(0x195),auth,async(_0x2e9937,_0x1cf3c7)=>{const _0x5aef1e=a0_0xcb5579;try{const _0x575be0=new excelJS[(_0x5aef1e(0x1c5))](),_0xe69eb9=_0x575be0[_0x5aef1e(0x1a7)](_0x5aef1e(0x1b4));return _0xe69eb9['columns']=[{'header':'ID','key':_0x5aef1e(0x19e),'width':0xa},{'header':'Name','key':'PBrands','width':0xa},{'header':_0x5aef1e(0x1bb),'key':_0x5aef1e(0x1b9),'width':0xa},{'header':'SalesmanName','key':'SalesmanName','width':0xa},{'header':_0x5aef1e(0x1a6),'key':_0x5aef1e(0x1a6),'width':0xa},{'header':_0x5aef1e(0x1c6),'key':_0x5aef1e(0x1c6),'width':0xa},{'header':_0x5aef1e(0x192),'key':_0x5aef1e(0x192),'width':0xa}],_0x1cf3c7[_0x5aef1e(0x1aa)](_0x5aef1e(0x1c1),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x1cf3c7[_0x5aef1e(0x1aa)](_0x5aef1e(0x1ba),_0x5aef1e(0x19d)),_0x575be0[_0x5aef1e(0x1a3)]['write'](_0x1cf3c7)['then'](()=>{const _0x3acf2c=_0x5aef1e;_0x1cf3c7[_0x3acf2c(0x1cb)](0xc8);});}catch(_0x260538){_0x1cf3c7[_0x5aef1e(0x1cb)](0x190)[_0x5aef1e(0x17a)]({'errors':_0x260538[_0x5aef1e(0x179)]});}});const storage1=multer[a0_0xcb5579(0x187)]({'destination':(_0x4c1297,_0x5c2ae0,_0x14587b)=>{const _0x3b3acd=a0_0xcb5579;_0x14587b(null,_0x3b3acd(0x1af));},'filename':(_0x3406ac,_0x2cf183,_0x4da2bb)=>{const _0x581e29=a0_0xcb5579;_0x4da2bb(null,Date['now']()+_0x2cf183[_0x581e29(0x16d)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x97a1(_0x1e7222,_0x580f3c){const _0x532a6f=a0_0x532a();return a0_0x97a1=function(_0x97a114,_0x16cb4a){_0x97a114=_0x97a114-0x16c;let _0x227456=_0x532a6f[_0x97a114];return _0x227456;},a0_0x97a1(_0x1e7222,_0x580f3c);}router[a0_0xcb5579(0x188)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0xcb5579(0x1b1)](a0_0xcb5579(0x17d)),async(_0x48567a,_0x28aaba)=>{const _0x5cd8d4=a0_0xcb5579,_0x4c4fb5=_0x48567a[_0x5cd8d4(0x18a)][_0x5cd8d4(0x1a9)],_0x5e6667=await xlsx[_0x5cd8d4(0x191)](_0x5cd8d4(0x174)+_0x4c4fb5);let _0x254855=_0x5e6667['SheetNames'],_0x420833=xlsx[_0x5cd8d4(0x185)]['sheet_to_json'](_0x5e6667[_0x5cd8d4(0x193)][_0x254855[0x0]]);for(const _0x3cd447 of _0x420833){const _0x3f960d=_0x3cd447['ID'],_0x4d722f=_0x3cd447[_0x5cd8d4(0x198)],_0x1ae508=_0x3cd447[_0x5cd8d4(0x1bb)],_0x4f26de=_0x3cd447[_0x5cd8d4(0x1c7)],_0x481813=_0x3cd447[_0x5cd8d4(0x1a6)],_0x50a11e=_0x3cd447[_0x5cd8d4(0x1c6)],_0x131cc6=_0x3cd447['email'];try{let _0x381a00=await customer[_0x5cd8d4(0x18e)]({'name':_0x4d722f});if(!_0x381a00){const _0x52217a=new customer({'name':_0x4d722f,'ID':_0x3f960d,'SalesmanCode':_0x1ae508,'SalesmanName':_0x4f26de,'address':_0x481813,'mobile':_0x50a11e,'email':_0x131cc6});_0x381a00=await _0x52217a[_0x5cd8d4(0x1c8)](),_0x48567a['flash'](_0x5cd8d4(0x1bc),_0x4d722f+_0x5cd8d4(0x1b0));}else _0x48567a[_0x5cd8d4(0x16e)]('error',_0x4d722f+_0x5cd8d4(0x180));}catch(_0x352446){_0x28aaba[_0x5cd8d4(0x1cb)](0x1f4)[_0x5cd8d4(0x1b2)]({'proderror':_0x352446[_0x5cd8d4(0x179)],'aproduct':ProductName});}}_0x28aaba[_0x5cd8d4(0x1ce)](_0x5cd8d4(0x184));}),module[a0_0xcb5579(0x199)]=router;