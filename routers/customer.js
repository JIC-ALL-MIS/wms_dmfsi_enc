const a0_0x51feb8=a0_0x40b2;(function(_0x2d47a4,_0xc2e586){const _0x6a51c8=a0_0x40b2,_0x292cf7=_0x2d47a4();while(!![]){try{const _0x52b381=-parseInt(_0x6a51c8(0xc9))/0x1+parseInt(_0x6a51c8(0xb9))/0x2*(parseInt(_0x6a51c8(0x99))/0x3)+parseInt(_0x6a51c8(0xaa))/0x4+-parseInt(_0x6a51c8(0xf2))/0x5*(-parseInt(_0x6a51c8(0x8e))/0x6)+-parseInt(_0x6a51c8(0xa3))/0x7+-parseInt(_0x6a51c8(0xbe))/0x8*(parseInt(_0x6a51c8(0xdc))/0x9)+parseInt(_0x6a51c8(0xa2))/0xa;if(_0x52b381===_0xc2e586)break;else _0x292cf7['push'](_0x292cf7['shift']());}catch(_0x355bed){_0x292cf7['push'](_0x292cf7['shift']());}}}(a0_0x3eef,0x7987b));const express=require(a0_0x51feb8(0xf0)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x51feb8(0xc0)),auth=require(a0_0x51feb8(0xdd)),users=require('../public/language/languages.json'),excelJS=require(a0_0x51feb8(0xc5)),xlsx=require(a0_0x51feb8(0xdf)),multer=require('multer');router[a0_0x51feb8(0xca)](a0_0x51feb8(0xed),auth,async(_0x584f73,_0x126ccc)=>{const _0x256c43=a0_0x51feb8;try{const {username:_0xb0b9df,email:_0x83f89d,role:_0x11cdbd}=_0x584f73[_0x256c43(0xd2)],_0x5d065f=_0x584f73[_0x256c43(0xd2)],_0x40a280=await profile[_0x256c43(0xb8)]({'email':_0x5d065f['email']}),_0x2914d9=await master_shop[_0x256c43(0xf4)]();console[_0x256c43(0xc1)](_0x256c43(0x8d),_0x2914d9);const _0x269b47=await customer[_0x256c43(0xf4)](),_0x42e2ef=await customer[_0x256c43(0xc2)]([{'$lookup':{'from':_0x256c43(0xb5),'localField':_0x256c43(0xda),'foreignField':'customer','as':'customer_docs'}}]);console['log'](_0x42e2ef);const _0x47cb20=_0x42e2ef[_0x256c43(0xe2)](_0x150e9e=>{const _0x327777=_0x256c43;console['log'](_0x327777(0xd9),_0x150e9e);var _0x4f8cc9=0x0,_0x355788=0x0;return _0x150e9e[_0x327777(0xea)]['forEach'](_0x933747=>{const _0x3fc127=_0x327777;console[_0x3fc127(0xc1)](_0x3fc127(0xb3),_0x933747),_0x933747[_0x3fc127(0xc6)]==_0x3fc127(0xcb)?_0x4f8cc9+=_0x933747[_0x3fc127(0xe4)]:_0x355788+=_0x933747[_0x3fc127(0xe4)];}),_0x150e9e[_0x327777(0xec)]=parseFloat(_0x4f8cc9)+0x0,_0x150e9e[_0x327777(0xd3)]=parseFloat(_0x355788)+0x0,_0x150e9e;});console['log'](_0x256c43(0xa4),_0x47cb20);if(_0x2914d9[0x0][_0x256c43(0xc7)]==_0x256c43(0xe0)){var _0x301d28=users[_0x256c43(0xa1)];console[_0x256c43(0xc1)](_0x301d28);}else{if(_0x2914d9[0x0]['language']=='Hindi')var _0x301d28=users['Hindi'];else{if(_0x2914d9[0x0][_0x256c43(0xc7)]==_0x256c43(0xeb))var _0x301d28=users[_0x256c43(0xeb)];else{if(_0x2914d9[0x0]['language']==_0x256c43(0x8f))var _0x301d28=users[_0x256c43(0x8f)];else{if(_0x2914d9[0x0][_0x256c43(0xc7)]==_0x256c43(0xb2))var _0x301d28=users['French'];else{if(_0x2914d9[0x0]['language']=='Portuguese\x20(BR)')var _0x301d28=users[_0x256c43(0xcf)];else{if(_0x2914d9[0x0][_0x256c43(0xc7)]==_0x256c43(0xd7))var _0x301d28=users[_0x256c43(0xd7)];else{if(_0x2914d9[0x0][_0x256c43(0xc7)]==_0x256c43(0xe9))var _0x301d28=users[_0x256c43(0xdb)];}}}}}}}_0x126ccc[_0x256c43(0x90)](_0x256c43(0x9a),{'success':_0x584f73[_0x256c43(0xa0)](_0x256c43(0xc8)),'errors':_0x584f73[_0x256c43(0xa0)](_0x256c43(0x91)),'user':_0x269b47,'role':_0x5d065f,'profile':_0x40a280,'payment':_0x47cb20,'master_shop':_0x2914d9,'language':_0x301d28});}catch(_0x3eaccd){console[_0x256c43(0xc1)](_0x3eaccd);}}),router[a0_0x51feb8(0xa9)](a0_0x51feb8(0xed),auth,async(_0x516e97,_0x1307c8)=>{const _0x236902=a0_0x51feb8;try{const {name:_0x18113d,address:_0x22d902,mobile:_0x4e5491,email:_0x211530,receivable:_0x4f51ce,payable:_0x315801,contactperson:_0x144aec,landline:_0x1a6816}=_0x516e97['body'],_0x50834d=new customer({'name':_0x18113d,'address':_0x22d902,'mobile':_0x4e5491,'email':_0x211530,'receivable':_0x4f51ce,'payable':_0x315801,'contactperson':_0x144aec,'landline':_0x1a6816}),_0xe2dc70=await _0x50834d['save']();_0x516e97[_0x236902(0xa0)]('success',_0x236902(0xa6)),_0x1307c8[_0x236902(0xd5)]('/customer/view');}catch(_0x12a085){console[_0x236902(0xc1)](_0x12a085);}}),router[a0_0x51feb8(0xca)](a0_0x51feb8(0x9b),auth,async(_0x4d978c,_0x12a0d7)=>{const _0x3d536d=a0_0x51feb8;try{const {username:_0x5aba12,email:_0x1f2fa6,role:_0x25cfa7}=_0x4d978c[_0x3d536d(0xd2)],_0x42f03d=_0x4d978c['user'],_0x39692a=await profile[_0x3d536d(0xb8)]({'email':_0x42f03d['email']}),_0x391290=await master_shop[_0x3d536d(0xf4)]();console[_0x3d536d(0xc1)](_0x3d536d(0x8d),_0x391290);const _0x264a46=_0x4d978c[_0x3d536d(0xba)]['id'],_0x3b5419=await customer[_0x3d536d(0xcc)](_0x264a46);if(_0x391290[0x0]['language']==_0x3d536d(0xe0)){var _0x15b881=users[_0x3d536d(0xa1)];console[_0x3d536d(0xc1)](_0x15b881);}else{if(_0x391290[0x0][_0x3d536d(0xc7)]==_0x3d536d(0xd8))var _0x15b881=users['Hindi'];else{if(_0x391290[0x0]['language']==_0x3d536d(0xeb))var _0x15b881=users[_0x3d536d(0xeb)];else{if(_0x391290[0x0][_0x3d536d(0xc7)]==_0x3d536d(0x8f))var _0x15b881=users['Spanish'];else{if(_0x391290[0x0]['language']=='French')var _0x15b881=users[_0x3d536d(0xb2)];else{if(_0x391290[0x0]['language']==_0x3d536d(0xc3))var _0x15b881=users[_0x3d536d(0xcf)];else{if(_0x391290[0x0]['language']==_0x3d536d(0xd7))var _0x15b881=users[_0x3d536d(0xd7)];else{if(_0x391290[0x0]['language']=='Arabic\x20(ae)')var _0x15b881=users[_0x3d536d(0xdb)];}}}}}}}_0x12a0d7[_0x3d536d(0x90)]('customer',{'success':_0x4d978c['flash'](_0x3d536d(0xc8)),'errors':_0x4d978c[_0x3d536d(0xa0)]('errors'),'role':_0x42f03d,'profile':_0x39692a,'user':_0x3b5419,'master_shop':_0x391290,'language':_0x15b881});}catch(_0x4beb05){console[_0x3d536d(0xc1)](_0x4beb05);}}),router[a0_0x51feb8(0xa9)](a0_0x51feb8(0x9b),auth,async(_0x57f71e,_0xe30dde)=>{const _0x4556d0=a0_0x51feb8;try{const _0x32acc7=_0x57f71e[_0x4556d0(0xba)]['id'],_0x3b86cf=await customer[_0x4556d0(0xcc)](_0x32acc7),{name:_0x4ae334,address:_0x29a3e3,mobile:_0x314514,email:_0x4b78bc,receivable:_0x24fea9,payable:_0x4f8073,contactperson:_0x5c85d3,landline:_0x8e3e19}=_0x57f71e[_0x4556d0(0xf1)];_0x3b86cf[_0x4556d0(0xda)]=_0x4ae334,_0x3b86cf[_0x4556d0(0xb0)]=_0x29a3e3,_0x3b86cf[_0x4556d0(0xad)]=_0x314514,_0x3b86cf[_0x4556d0(0x9e)]=_0x4b78bc,_0x3b86cf[_0x4556d0(0xce)]=_0x24fea9,_0x3b86cf[_0x4556d0(0xcd)]=_0x4f8073,_0x3b86cf[_0x4556d0(0xbc)]=_0x5c85d3,_0x3b86cf[_0x4556d0(0xbb)]=_0x8e3e19;const _0xd89599=await _0x3b86cf[_0x4556d0(0xe7)]();_0x57f71e[_0x4556d0(0xa0)](_0x4556d0(0xc8),_0x4556d0(0xe1)),_0xe30dde[_0x4556d0(0xd5)](_0x4556d0(0x95));}catch(_0x5c6669){console[_0x4556d0(0xc1)](_0x5c6669);}}),router[a0_0x51feb8(0xca)](a0_0x51feb8(0x96),auth,async(_0xa523eb,_0x2607d5)=>{const _0x130bc1=a0_0x51feb8;try{const {username:_0x4fbc6f,email:_0x5ae13d,role:_0x2c4899}=_0xa523eb['user'],_0x594b50=_0xa523eb[_0x130bc1(0xd2)],_0xfa7fba=await profile[_0x130bc1(0xb8)]({'email':_0x594b50[_0x130bc1(0x9e)]}),_0x8c90a3=await master_shop[_0x130bc1(0xf4)]();console[_0x130bc1(0xc1)](_0x130bc1(0x8d),_0x8c90a3),console[_0x130bc1(0xc1)](_0xa523eb[_0x130bc1(0xba)]['id']);const _0x5ed709=await customer[_0x130bc1(0xb8)]({'_id':_0xa523eb[_0x130bc1(0xba)]['id']});console[_0x130bc1(0xc1)](_0x130bc1(0x9c),_0x5ed709);const _0x39e432=await c_payment_data['find']({'customer':_0x5ed709[_0x130bc1(0xda)]});console[_0x130bc1(0xc1)](_0x39e432);const _0x3c1eb1=await c_payment_data[_0x130bc1(0xc2)]([{'$match':{'customer':_0x5ed709[_0x130bc1(0xda)]}},{'$match':{'reason':_0x130bc1(0xcb)}},{'$group':{'_id':_0x130bc1(0xa7),'sum':{'$sum':'$amount'}}}]);console['log']('payable_sum',_0x3c1eb1);const _0x2828fd=await c_payment_data[_0x130bc1(0xc2)]([{'$match':{'customer':_0x5ed709[_0x130bc1(0xda)]}},{'$match':{'reason':_0x130bc1(0xaf)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x130bc1(0xd1)}}}]);console[_0x130bc1(0xc1)]('receivable_sum',_0x2828fd);if(_0x8c90a3[0x0][_0x130bc1(0xc7)]=='English\x20(US)'){var _0x133828=users[_0x130bc1(0xa1)];console[_0x130bc1(0xc1)](_0x133828);}else{if(_0x8c90a3[0x0][_0x130bc1(0xc7)]==_0x130bc1(0xd8))var _0x133828=users['Hindi'];else{if(_0x8c90a3[0x0]['language']==_0x130bc1(0xeb))var _0x133828=users['German'];else{if(_0x8c90a3[0x0][_0x130bc1(0xc7)]=='Spanish')var _0x133828=users[_0x130bc1(0x8f)];else{if(_0x8c90a3[0x0][_0x130bc1(0xc7)]==_0x130bc1(0xb2))var _0x133828=users['French'];else{if(_0x8c90a3[0x0][_0x130bc1(0xc7)]==_0x130bc1(0xc3))var _0x133828=users[_0x130bc1(0xcf)];else{if(_0x8c90a3[0x0]['language']=='Chinese')var _0x133828=users[_0x130bc1(0xd7)];else{if(_0x8c90a3[0x0][_0x130bc1(0xc7)]==_0x130bc1(0xe9))var _0x133828=users[_0x130bc1(0xdb)];}}}}}}}_0x2607d5['render'](_0x130bc1(0xef),{'success':_0xa523eb[_0x130bc1(0xa0)](_0x130bc1(0xc8)),'errors':_0xa523eb[_0x130bc1(0xa0)]('errors'),'role':_0x594b50,'profile':_0xfa7fba,'payment':_0x39e432,'payable':_0x3c1eb1,'receivable':_0x2828fd,'master_shop':_0x8c90a3,'language':_0x133828});}catch(_0x480348){console[_0x130bc1(0xc1)](_0x480348);}}),router[a0_0x51feb8(0xca)](a0_0x51feb8(0xe5),auth,async(_0xd0800c,_0x4f30be)=>{const _0x52338d=a0_0x51feb8;try{const _0x3ac7a4=new excelJS[(_0x52338d(0x97))](),_0x4cb4d3=_0x3ac7a4[_0x52338d(0xac)]('Customers');return _0x4cb4d3[_0x52338d(0xc4)]=[{'header':'ID','key':'PName','width':0xa},{'header':_0x52338d(0x93),'key':_0x52338d(0xe3),'width':0xa},{'header':_0x52338d(0xbf),'key':_0x52338d(0xab),'width':0xa},{'header':_0x52338d(0xf3),'key':_0x52338d(0xf3),'width':0xa},{'header':_0x52338d(0xb0),'key':_0x52338d(0xb0),'width':0xa},{'header':'mobile','key':_0x52338d(0xad),'width':0xa},{'header':_0x52338d(0x9e),'key':_0x52338d(0x9e),'width':0xa}],_0x4f30be[_0x52338d(0xb6)](_0x52338d(0x9f),_0x52338d(0xb1)),_0x4f30be[_0x52338d(0xb6)]('Content-Disposition',_0x52338d(0xd6)),_0x3ac7a4[_0x52338d(0xdf)][_0x52338d(0xb7)](_0x4f30be)[_0x52338d(0xe6)](()=>{const _0x5bae15=_0x52338d;_0x4f30be[_0x5bae15(0xd4)](0xc8);});}catch(_0x3807db){_0x4f30be[_0x52338d(0xd4)](0x190)['send']({'errors':_0x3807db[_0x52338d(0x92)]});}});function a0_0x3eef(){const _0x16953c=['map','PBrands','amount','/products_export_migrate_file','then','save','\x20added\x20successfully','Arabic\x20(ae)','customer_docs','German','sale','/view','single','customer_payment','express','body','5ZeCtkt','SalesmanName','find','/customer_import_migrate_file','master','2380578ZVWYYX','Spanish','render','errors','message','Name','originalname','/customer/view','/view/payment/:id','Workbook','utils','669993YeRWWg','customer','/view/:id','customer_data','customer_product_fule','email','Content-Type','flash','English','4764280MXGndo','4413843sENhzQ','payment_data','public/Migration/','customer\x20add\x20successfully','$reason','filename','post','1817820xLrMFu','PUnits','addWorksheet','mobile','now','Sale\x20Return','address','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','French','element','exports','c_payments','setHeader','write','findOne','6NQKcdz','params','landline','contactperson','Sheets','3172984FtYcXU','SalesmanCode','../models/all_models','log','aggregate','Portuguese\x20(BR)','columns','exceljs','reason','language','success','76057loWGvA','get','Sale','findById','payable','receivable','Portuguese','error','$amount','user','sale_return','status','redirect','attachment;\x20filename=customer_Migration_File.xlsx','Chinese','Hindi','data','name','Arabic','18kWcdhb','../middleware/auth','public/Migration','xlsx','English\x20(US)','customer\x20update\x20successfully'];a0_0x3eef=function(){return _0x16953c;};return a0_0x3eef();}function a0_0x40b2(_0x2f2a17,_0x2df719){const _0x3eef3f=a0_0x3eef();return a0_0x40b2=function(_0x40b2d9,_0x30c10e){_0x40b2d9=_0x40b2d9-0x8c;let _0x5c0647=_0x3eef3f[_0x40b2d9];return _0x5c0647;},a0_0x40b2(_0x2f2a17,_0x2df719);}const storage1=multer['diskStorage']({'destination':(_0x44f061,_0x595d34,_0x1c3ad6)=>{const _0x1f119b=a0_0x51feb8;_0x1c3ad6(null,_0x1f119b(0xde));},'filename':(_0x3f6259,_0x5c56bc,_0x1b5daa)=>{const _0x30923c=a0_0x51feb8;_0x1b5daa(null,Date[_0x30923c(0xae)]()+_0x5c56bc[_0x30923c(0x94)]);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x51feb8(0x8c),auth,uploadMigrate[a0_0x51feb8(0xee)](a0_0x51feb8(0x9d)),async(_0x1d9a19,_0x2645a8)=>{const _0xc7f2c=a0_0x51feb8,_0x56070d=_0x1d9a19['file'][_0xc7f2c(0xa8)],_0x5401b7=await xlsx['readFile'](_0xc7f2c(0xa5)+_0x56070d);let _0x1d8060=_0x5401b7['SheetNames'],_0x44d8d6=xlsx[_0xc7f2c(0x98)]['sheet_to_json'](_0x5401b7[_0xc7f2c(0xbd)][_0x1d8060[0x0]]);for(const _0x4ea015 of _0x44d8d6){const _0x52c2c6=_0x4ea015['ID'],_0x4fd86e=_0x4ea015[_0xc7f2c(0x93)],_0x2d28d2=_0x4ea015[_0xc7f2c(0xbf)],_0x967461=_0x4ea015[_0xc7f2c(0xf3)],_0x104042=_0x4ea015[_0xc7f2c(0xb0)],_0x5484bc=_0x4ea015[_0xc7f2c(0xad)],_0x41c41d=_0x4ea015[_0xc7f2c(0x9e)];try{let _0xf437a3=await customer[_0xc7f2c(0xb8)]({'name':_0x4fd86e});if(!_0xf437a3){const _0x550390=new customer({'name':_0x4fd86e,'ID':_0x52c2c6,'SalesmanCode':_0x2d28d2,'SalesmanName':_0x967461,'address':_0x104042,'mobile':_0x5484bc,'email':_0x41c41d});_0xf437a3=await _0x550390['save'](),_0x1d9a19[_0xc7f2c(0xa0)](_0xc7f2c(0xc8),_0x4fd86e+_0xc7f2c(0xe8));}else _0x1d9a19[_0xc7f2c(0xa0)](_0xc7f2c(0xd0),_0x4fd86e+'\x20Failed');}catch(_0x380949){_0x2645a8['status'](0x1f4)['json']({'proderror':_0x380949['message'],'aproduct':ProductName});}}_0x2645a8[_0xc7f2c(0xd5)](_0xc7f2c(0x95));}),module[a0_0x51feb8(0xb4)]=router;