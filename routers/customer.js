const a0_0x4807d1=a0_0x1941;(function(_0x2fb029,_0x24759f){const _0x1d9943=a0_0x1941,_0x293312=_0x2fb029();while(!![]){try{const _0x57e3f1=-parseInt(_0x1d9943(0x122))/0x1*(-parseInt(_0x1d9943(0x10f))/0x2)+parseInt(_0x1d9943(0x116))/0x3*(-parseInt(_0x1d9943(0xd8))/0x4)+-parseInt(_0x1d9943(0xe4))/0x5*(-parseInt(_0x1d9943(0x101))/0x6)+-parseInt(_0x1d9943(0xe5))/0x7+parseInt(_0x1d9943(0x124))/0x8+parseInt(_0x1d9943(0x127))/0x9*(parseInt(_0x1d9943(0xc9))/0xa)+parseInt(_0x1d9943(0xea))/0xb;if(_0x57e3f1===_0x24759f)break;else _0x293312['push'](_0x293312['shift']());}catch(_0x155510){_0x293312['push'](_0x293312['shift']());}}}(a0_0x8f79,0x6b2fa));const express=require(a0_0x4807d1(0xde)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require('../middleware/auth'),users=require(a0_0x4807d1(0xe2)),excelJS=require(a0_0x4807d1(0xdb)),xlsx=require(a0_0x4807d1(0x128)),multer=require('multer');function a0_0x1941(_0x189d8e,_0x26681f){const _0x8f79cd=a0_0x8f79();return a0_0x1941=function(_0x194127,_0x305923){_0x194127=_0x194127-0xc9;let _0x5131c6=_0x8f79cd[_0x194127];return _0x5131c6;},a0_0x1941(_0x189d8e,_0x26681f);}router['get'](a0_0x4807d1(0xfc),auth,async(_0x5df11d,_0x44ad24)=>{const _0x546ad9=a0_0x4807d1;try{const {username:_0x1629bc,email:_0x5b7cdf,role:_0x1785b8}=_0x5df11d[_0x546ad9(0x112)],_0x367de5=_0x5df11d[_0x546ad9(0x112)],_0x4321a8=await profile[_0x546ad9(0xf4)]({'email':_0x367de5[_0x546ad9(0xfb)]}),_0x22c163=await master_shop['find']();console[_0x546ad9(0xed)](_0x546ad9(0xdf),_0x22c163);const _0x583216=await customer['find'](),_0x12c746=await customer['aggregate']([{'$lookup':{'from':_0x546ad9(0xd2),'localField':'name','foreignField':_0x546ad9(0x113),'as':_0x546ad9(0x107)}}]);console[_0x546ad9(0xed)](_0x12c746);const _0x1ad3dd=_0x12c746['map'](_0x18bb04=>{const _0x50135a=_0x546ad9;console['log']('data',_0x18bb04);var _0x4d7b36=0x0,_0xdc1e9c=0x0;return _0x18bb04[_0x50135a(0x107)][_0x50135a(0x106)](_0x397ac5=>{const _0x274084=_0x50135a;console[_0x274084(0xed)](_0x274084(0x11c),_0x397ac5),_0x397ac5[_0x274084(0x104)]==_0x274084(0xd3)?_0x4d7b36+=_0x397ac5[_0x274084(0x12f)]:_0xdc1e9c+=_0x397ac5[_0x274084(0x12f)];}),_0x18bb04['sale']=parseFloat(_0x4d7b36)+0x0,_0x18bb04[_0x50135a(0x118)]=parseFloat(_0xdc1e9c)+0x0,_0x18bb04;});console[_0x546ad9(0xed)](_0x546ad9(0x12e),_0x1ad3dd);if(_0x22c163[0x0][_0x546ad9(0xdd)]==_0x546ad9(0xf9)){var _0x28bc35=users[_0x546ad9(0xcc)];console['log'](_0x28bc35);}else{if(_0x22c163[0x0][_0x546ad9(0xdd)]=='Hindi')var _0x28bc35=users[_0x546ad9(0xdc)];else{if(_0x22c163[0x0][_0x546ad9(0xdd)]=='German')var _0x28bc35=users[_0x546ad9(0xcf)];else{if(_0x22c163[0x0][_0x546ad9(0xdd)]==_0x546ad9(0xd1))var _0x28bc35=users['Spanish'];else{if(_0x22c163[0x0]['language']==_0x546ad9(0xf7))var _0x28bc35=users['French'];else{if(_0x22c163[0x0][_0x546ad9(0xdd)]=='Portuguese\x20(BR)')var _0x28bc35=users[_0x546ad9(0xfd)];else{if(_0x22c163[0x0][_0x546ad9(0xdd)]==_0x546ad9(0xec))var _0x28bc35=users[_0x546ad9(0xec)];else{if(_0x22c163[0x0]['language']==_0x546ad9(0xff))var _0x28bc35=users[_0x546ad9(0x12a)];}}}}}}}_0x44ad24['render']('customer',{'success':_0x5df11d['flash'](_0x546ad9(0xee)),'errors':_0x5df11d[_0x546ad9(0x12c)]('errors'),'user':_0x583216,'role':_0x367de5,'profile':_0x4321a8,'payment':_0x1ad3dd,'master_shop':_0x22c163,'language':_0x28bc35});}catch(_0x2a83d9){console[_0x546ad9(0xed)](_0x2a83d9);}}),router[a0_0x4807d1(0x129)](a0_0x4807d1(0xfc),auth,async(_0x3bf75a,_0x37f6ab)=>{const _0x579c33=a0_0x4807d1;try{const {name:_0x5b9cc8,address:_0x1aba1b,mobile:_0x10acac,email:_0x56ebfd,receivable:_0x24828b,payable:_0x510f24,contactperson:_0x2f541a,landline:_0x50bc0a}=_0x3bf75a['body'],_0x135b2f=new customer({'name':_0x5b9cc8,'address':_0x1aba1b,'mobile':_0x10acac,'email':_0x56ebfd,'receivable':_0x24828b,'payable':_0x510f24,'contactperson':_0x2f541a,'landline':_0x50bc0a}),_0x29a232=await _0x135b2f[_0x579c33(0xd0)]();_0x3bf75a[_0x579c33(0x12c)](_0x579c33(0xee),_0x579c33(0xe7)),_0x37f6ab['redirect'](_0x579c33(0x110));}catch(_0x1930c5){console[_0x579c33(0xed)](_0x1930c5);}}),router[a0_0x4807d1(0x115)]('/view/:id',auth,async(_0xbf65c8,_0x4e4e04)=>{const _0x186048=a0_0x4807d1;try{const {username:_0x35ca83,email:_0x3c1e8f,role:_0x45a679}=_0xbf65c8[_0x186048(0x112)],_0x12564d=_0xbf65c8['user'],_0x2abaa9=await profile[_0x186048(0xf4)]({'email':_0x12564d['email']}),_0x48079a=await master_shop[_0x186048(0xf0)]();console[_0x186048(0xed)]('master',_0x48079a);const _0x1dbc76=_0xbf65c8['params']['id'],_0x1ae825=await customer[_0x186048(0xf1)](_0x1dbc76);if(_0x48079a[0x0][_0x186048(0xdd)]==_0x186048(0xf9)){var _0x1e0e14=users[_0x186048(0xcc)];console[_0x186048(0xed)](_0x1e0e14);}else{if(_0x48079a[0x0]['language']==_0x186048(0xdc))var _0x1e0e14=users[_0x186048(0xdc)];else{if(_0x48079a[0x0][_0x186048(0xdd)]==_0x186048(0xcf))var _0x1e0e14=users[_0x186048(0xcf)];else{if(_0x48079a[0x0]['language']=='Spanish')var _0x1e0e14=users[_0x186048(0xd1)];else{if(_0x48079a[0x0]['language']==_0x186048(0xf7))var _0x1e0e14=users[_0x186048(0xf7)];else{if(_0x48079a[0x0][_0x186048(0xdd)]=='Portuguese\x20(BR)')var _0x1e0e14=users[_0x186048(0xfd)];else{if(_0x48079a[0x0]['language']=='Chinese')var _0x1e0e14=users[_0x186048(0xec)];else{if(_0x48079a[0x0][_0x186048(0xdd)]=='Arabic\x20(ae)')var _0x1e0e14=users['Arabic'];}}}}}}}_0x4e4e04[_0x186048(0x10d)](_0x186048(0x113),{'success':_0xbf65c8['flash'](_0x186048(0xee)),'errors':_0xbf65c8[_0x186048(0x12c)](_0x186048(0xeb)),'role':_0x12564d,'profile':_0x2abaa9,'user':_0x1ae825,'master_shop':_0x48079a,'language':_0x1e0e14});}catch(_0x36e26b){console[_0x186048(0xed)](_0x36e26b);}}),router['post']('/view/:id',auth,async(_0x320437,_0x20f417)=>{const _0x12c4af=a0_0x4807d1;try{const _0x4c876b=_0x320437[_0x12c4af(0x10c)]['id'],_0x5b4acb=await customer[_0x12c4af(0xf1)](_0x4c876b),{name:_0x47e6f4,address:_0x46cf13,mobile:_0xc47675,email:_0x5aa687,receivable:_0x589205,payable:_0x480cbf,contactperson:_0x24adad,landline:_0x556d9c}=_0x320437[_0x12c4af(0x103)];_0x5b4acb['name']=_0x47e6f4,_0x5b4acb[_0x12c4af(0xd5)]=_0x46cf13,_0x5b4acb[_0x12c4af(0xf8)]=_0xc47675,_0x5b4acb[_0x12c4af(0xfb)]=_0x5aa687,_0x5b4acb[_0x12c4af(0xca)]=_0x589205,_0x5b4acb[_0x12c4af(0x121)]=_0x480cbf,_0x5b4acb[_0x12c4af(0x105)]=_0x24adad,_0x5b4acb[_0x12c4af(0x123)]=_0x556d9c;const _0x2bf2b8=await _0x5b4acb[_0x12c4af(0xd0)]();_0x320437['flash']('success',_0x12c4af(0x11b)),_0x20f417['redirect'](_0x12c4af(0x110));}catch(_0x54ec1b){console[_0x12c4af(0xed)](_0x54ec1b);}}),router[a0_0x4807d1(0x115)](a0_0x4807d1(0x10a),auth,async(_0x5c7c30,_0x45b578)=>{const _0x34e35e=a0_0x4807d1;try{const {username:_0x3fddb5,email:_0x26c88e,role:_0x22877d}=_0x5c7c30[_0x34e35e(0x112)],_0x22dc18=_0x5c7c30['user'],_0x7d0911=await profile['findOne']({'email':_0x22dc18[_0x34e35e(0xfb)]}),_0x73fd0f=await master_shop[_0x34e35e(0xf0)]();console[_0x34e35e(0xed)]('master',_0x73fd0f),console['log'](_0x5c7c30[_0x34e35e(0x10c)]['id']);const _0x333c1f=await customer[_0x34e35e(0xf4)]({'_id':_0x5c7c30['params']['id']});console[_0x34e35e(0xed)](_0x34e35e(0xd7),_0x333c1f);const _0xf1c91c=await c_payment_data[_0x34e35e(0xf0)]({'customer':_0x333c1f['name']});console[_0x34e35e(0xed)](_0xf1c91c);const _0x57cc76=await c_payment_data['aggregate']([{'$match':{'customer':_0x333c1f[_0x34e35e(0xf3)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':_0x34e35e(0xd9),'sum':{'$sum':_0x34e35e(0x120)}}}]);console[_0x34e35e(0xed)](_0x34e35e(0xfe),_0x57cc76);const _0x29cc1f=await c_payment_data[_0x34e35e(0x109)]([{'$match':{'customer':_0x333c1f[_0x34e35e(0xf3)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':'$reason','sum':{'$sum':'$amount'}}}]);console[_0x34e35e(0xed)](_0x34e35e(0xe9),_0x29cc1f);if(_0x73fd0f[0x0][_0x34e35e(0xdd)]==_0x34e35e(0xf9)){var _0x4ee0c1=users[_0x34e35e(0xcc)];console[_0x34e35e(0xed)](_0x4ee0c1);}else{if(_0x73fd0f[0x0][_0x34e35e(0xdd)]=='Hindi')var _0x4ee0c1=users[_0x34e35e(0xdc)];else{if(_0x73fd0f[0x0][_0x34e35e(0xdd)]==_0x34e35e(0xcf))var _0x4ee0c1=users['German'];else{if(_0x73fd0f[0x0][_0x34e35e(0xdd)]==_0x34e35e(0xd1))var _0x4ee0c1=users[_0x34e35e(0xd1)];else{if(_0x73fd0f[0x0][_0x34e35e(0xdd)]=='French')var _0x4ee0c1=users[_0x34e35e(0xf7)];else{if(_0x73fd0f[0x0][_0x34e35e(0xdd)]==_0x34e35e(0xe0))var _0x4ee0c1=users[_0x34e35e(0xfd)];else{if(_0x73fd0f[0x0]['language']==_0x34e35e(0xec))var _0x4ee0c1=users['Chinese'];else{if(_0x73fd0f[0x0][_0x34e35e(0xdd)]==_0x34e35e(0xff))var _0x4ee0c1=users[_0x34e35e(0x12a)];}}}}}}}_0x45b578[_0x34e35e(0x10d)]('customer_payment',{'success':_0x5c7c30['flash'](_0x34e35e(0xee)),'errors':_0x5c7c30[_0x34e35e(0x12c)](_0x34e35e(0xeb)),'role':_0x22dc18,'profile':_0x7d0911,'payment':_0xf1c91c,'payable':_0x57cc76,'receivable':_0x29cc1f,'master_shop':_0x73fd0f,'language':_0x4ee0c1});}catch(_0x13f638){console['log'](_0x13f638);}}),router['get'](a0_0x4807d1(0x12b),auth,async(_0x1cb0af,_0x38ec9e)=>{const _0x4c9d6b=a0_0x4807d1;try{const _0x577abe=new excelJS['Workbook'](),_0x487e23=_0x577abe['addWorksheet'](_0x4c9d6b(0x11a));return _0x487e23[_0x4c9d6b(0x102)]=[{'header':'ID','key':_0x4c9d6b(0xe1),'width':0xa},{'header':_0x4c9d6b(0x10b),'key':_0x4c9d6b(0xe3),'width':0xa},{'header':_0x4c9d6b(0x100),'key':_0x4c9d6b(0x131),'width':0xa},{'header':_0x4c9d6b(0x11d),'key':_0x4c9d6b(0x11d),'width':0xa},{'header':_0x4c9d6b(0xd5),'key':_0x4c9d6b(0xd5),'width':0xa},{'header':_0x4c9d6b(0xf8),'key':_0x4c9d6b(0xf8),'width':0xa},{'header':_0x4c9d6b(0xfb),'key':_0x4c9d6b(0xfb),'width':0xa}],_0x38ec9e[_0x4c9d6b(0x117)](_0x4c9d6b(0xef),_0x4c9d6b(0x130)),_0x38ec9e['setHeader']('Content-Disposition',_0x4c9d6b(0xf6)),_0x577abe['xlsx'][_0x4c9d6b(0x119)](_0x38ec9e)[_0x4c9d6b(0xda)](()=>{const _0x103013=_0x4c9d6b;_0x38ec9e[_0x103013(0xf2)](0xc8);});}catch(_0x30ed74){_0x38ec9e[_0x4c9d6b(0xf2)](0x190)[_0x4c9d6b(0xd4)]({'errors':_0x30ed74[_0x4c9d6b(0x126)]});}});function a0_0x8f79(){const _0x149c80=['26nnjHAz','/customer/view','\x20Failed','user','customer','exports','get','525qmOYED','setHeader','sale_return','write','Customers','customer\x20update\x20successfully','element','SalesmanName','originalname','Sheets','$amount','payable','15964nLdomC','landline','1070760iXBqDH','public/Migration/','message','15237iMpGpg','xlsx','post','Arabic','/products_export_migrate_file','flash','redirect','payment_data','amount','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','PUnits','670BlqnEC','receivable','now','English','\x20added\x20successfully','SheetNames','German','save','Spanish','c_payments','Sale','send','address','single','customer_data','8252VrFngJ','$reason','then','exceljs','Hindi','language','express','master','Portuguese\x20(BR)','PName','../public/language/languages.json','PBrands','425MdwBhO','5258631eirOXB','json','customer\x20add\x20successfully','file','receivable_sum','11745294VEiZTh','errors','Chinese','log','success','Content-Type','find','findById','status','name','findOne','utils','attachment;\x20filename=customer_Migration_File.xlsx','French','mobile','English\x20(US)','/customer_import_migrate_file','email','/view','Portuguese','payable_sum','Arabic\x20(ae)','SalesmanCode','2028kZBPvk','columns','body','reason','contactperson','forEach','customer_docs','filename','aggregate','/view/payment/:id','Name','params','render','public/Migration'];a0_0x8f79=function(){return _0x149c80;};return a0_0x8f79();}const storage1=multer['diskStorage']({'destination':(_0x3888b7,_0x1617c9,_0x5a073c)=>{const _0xdb5c5e=a0_0x4807d1;_0x5a073c(null,_0xdb5c5e(0x10e));},'filename':(_0x4c5581,_0x4072ab,_0x121289)=>{const _0xf35d07=a0_0x4807d1;_0x121289(null,Date[_0xf35d07(0xcb)]()+_0x4072ab[_0xf35d07(0x11e)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x4807d1(0x129)](a0_0x4807d1(0xfa),auth,uploadMigrate[a0_0x4807d1(0xd6)]('customer_product_fule'),async(_0x445e09,_0x21c746)=>{const _0x3af1bc=a0_0x4807d1,_0x295e64=_0x445e09[_0x3af1bc(0xe8)][_0x3af1bc(0x108)],_0x53c41a=await xlsx['readFile'](_0x3af1bc(0x125)+_0x295e64);let _0x29e6da=_0x53c41a[_0x3af1bc(0xce)],_0x306cdd=xlsx[_0x3af1bc(0xf5)]['sheet_to_json'](_0x53c41a[_0x3af1bc(0x11f)][_0x29e6da[0x0]]);for(const _0x3dcad9 of _0x306cdd){const _0x329437=_0x3dcad9['ID'],_0x3aa02d=_0x3dcad9[_0x3af1bc(0x10b)],_0xc9741=_0x3dcad9['SalesmanCode'],_0x18a513=_0x3dcad9[_0x3af1bc(0x11d)],_0x5c871b=_0x3dcad9[_0x3af1bc(0xd5)],_0x354af1=_0x3dcad9[_0x3af1bc(0xf8)],_0x55d1e5=_0x3dcad9[_0x3af1bc(0xfb)];try{let _0x3d6cb7=await customer['findOne']({'name':_0x3aa02d});if(!_0x3d6cb7){const _0x587a18=new customer({'name':_0x3aa02d,'ID':_0x329437,'SalesmanCode':_0xc9741,'SalesmanName':_0x18a513,'address':_0x5c871b,'mobile':_0x354af1,'email':_0x55d1e5});_0x3d6cb7=await _0x587a18['save'](),_0x445e09[_0x3af1bc(0x12c)](_0x3af1bc(0xee),_0x3aa02d+_0x3af1bc(0xcd));}else _0x445e09[_0x3af1bc(0x12c)]('error',_0x3aa02d+_0x3af1bc(0x111));}catch(_0x5cfa33){_0x21c746[_0x3af1bc(0xf2)](0x1f4)[_0x3af1bc(0xe6)]({'proderror':_0x5cfa33[_0x3af1bc(0x126)],'aproduct':ProductName});}}_0x21c746[_0x3af1bc(0x12d)](_0x3af1bc(0x110));}),module[a0_0x4807d1(0x114)]=router;