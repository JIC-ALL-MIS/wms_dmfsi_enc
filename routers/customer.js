const a0_0x412c49=a0_0x4511;(function(_0x233fe7,_0x4e6fa8){const _0x43165f=a0_0x4511,_0x47bfc1=_0x233fe7();while(!![]){try{const _0x1b44ee=-parseInt(_0x43165f(0xa8))/0x1+-parseInt(_0x43165f(0xb3))/0x2*(parseInt(_0x43165f(0xab))/0x3)+-parseInt(_0x43165f(0xdf))/0x4*(parseInt(_0x43165f(0xd7))/0x5)+-parseInt(_0x43165f(0x8f))/0x6*(-parseInt(_0x43165f(0xb4))/0x7)+parseInt(_0x43165f(0xe5))/0x8*(-parseInt(_0x43165f(0xef))/0x9)+-parseInt(_0x43165f(0xa0))/0xa*(-parseInt(_0x43165f(0x8e))/0xb)+parseInt(_0x43165f(0x94))/0xc*(parseInt(_0x43165f(0xb9))/0xd);if(_0x1b44ee===_0x4e6fa8)break;else _0x47bfc1['push'](_0x47bfc1['shift']());}catch(_0x3f82b7){_0x47bfc1['push'](_0x47bfc1['shift']());}}}(a0_0x1b15,0x8824f));const express=require(a0_0x412c49(0xb7)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x412c49(0xc9)),auth=require(a0_0x412c49(0x9a)),users=require(a0_0x412c49(0xb2)),excelJS=require(a0_0x412c49(0xf0)),xlsx=require(a0_0x412c49(0x88)),multer=require(a0_0x412c49(0x93));router['get'](a0_0x412c49(0xe6),auth,async(_0x1c4a66,_0x5c873b)=>{const _0x1700b9=a0_0x412c49;try{const {username:_0x317c04,email:_0x46c159,role:_0x2e11c1}=_0x1c4a66[_0x1700b9(0xb1)],_0x22b203=_0x1c4a66['user'],_0x392058=await profile[_0x1700b9(0xc7)]({'email':_0x22b203['email']}),_0x14dc67=await master_shop[_0x1700b9(0xda)]();console[_0x1700b9(0xeb)](_0x1700b9(0xe2),_0x14dc67);const _0x34f1a3=await customer[_0x1700b9(0xda)](),_0x431843=await customer['aggregate']([{'$lookup':{'from':_0x1700b9(0xf1),'localField':_0x1700b9(0xed),'foreignField':_0x1700b9(0xc4),'as':_0x1700b9(0xde)}}]);console[_0x1700b9(0xeb)](_0x431843);const _0x1c7a40=_0x431843[_0x1700b9(0xa4)](_0x7589f6=>{const _0x52d0ed=_0x1700b9;console[_0x52d0ed(0xeb)](_0x52d0ed(0xad),_0x7589f6);var _0x3f084c=0x0,_0x59b6d0=0x0;return _0x7589f6['customer_docs'][_0x52d0ed(0x9c)](_0x2e6f7d=>{const _0x562f5b=_0x52d0ed;console[_0x562f5b(0xeb)](_0x562f5b(0xc1),_0x2e6f7d),_0x2e6f7d['reason']==_0x562f5b(0xc2)?_0x3f084c+=_0x2e6f7d[_0x562f5b(0xbb)]:_0x59b6d0+=_0x2e6f7d[_0x562f5b(0xbb)];}),_0x7589f6[_0x52d0ed(0xcd)]=parseFloat(_0x3f084c)+0x0,_0x7589f6['sale_return']=parseFloat(_0x59b6d0)+0x0,_0x7589f6;});console[_0x1700b9(0xeb)](_0x1700b9(0xf7),_0x1c7a40);if(_0x14dc67[0x0]['language']=='English\x20(US)'){var _0x1f2ccc=users['English'];console['log'](_0x1f2ccc);}else{if(_0x14dc67[0x0][_0x1700b9(0xb5)]==_0x1700b9(0x95))var _0x1f2ccc=users[_0x1700b9(0x95)];else{if(_0x14dc67[0x0][_0x1700b9(0xb5)]==_0x1700b9(0x87))var _0x1f2ccc=users[_0x1700b9(0x87)];else{if(_0x14dc67[0x0][_0x1700b9(0xb5)]==_0x1700b9(0xb8))var _0x1f2ccc=users[_0x1700b9(0xb8)];else{if(_0x14dc67[0x0][_0x1700b9(0xb5)]==_0x1700b9(0xa2))var _0x1f2ccc=users[_0x1700b9(0xa2)];else{if(_0x14dc67[0x0]['language']==_0x1700b9(0xaa))var _0x1f2ccc=users[_0x1700b9(0xbe)];else{if(_0x14dc67[0x0]['language']=='Chinese')var _0x1f2ccc=users[_0x1700b9(0xd2)];else{if(_0x14dc67[0x0][_0x1700b9(0xb5)]=='Arabic\x20(ae)')var _0x1f2ccc=users[_0x1700b9(0xa9)];}}}}}}}_0x5c873b[_0x1700b9(0xc0)](_0x1700b9(0xc4),{'success':_0x1c4a66[_0x1700b9(0xd8)](_0x1700b9(0xa7)),'errors':_0x1c4a66[_0x1700b9(0xd8)]('errors'),'user':_0x34f1a3,'role':_0x22b203,'profile':_0x392058,'payment':_0x1c7a40,'master_shop':_0x14dc67,'language':_0x1f2ccc});}catch(_0x16f33c){console[_0x1700b9(0xeb)](_0x16f33c);}}),router[a0_0x412c49(0xe8)]('/view',auth,async(_0x8d22b0,_0x485239)=>{const _0x167199=a0_0x412c49;try{const {name:_0x448707,address:_0x21ea16,mobile:_0x425cfd,email:_0x32f755,receivable:_0x535ce2,payable:_0x13b5f2,contactperson:_0x5e8cf6,landline:_0x5cbbbc}=_0x8d22b0['body'],_0x20a1b7=new customer({'name':_0x448707,'address':_0x21ea16,'mobile':_0x425cfd,'email':_0x32f755,'receivable':_0x535ce2,'payable':_0x13b5f2,'contactperson':_0x5e8cf6,'landline':_0x5cbbbc}),_0x3e0ac8=await _0x20a1b7[_0x167199(0x89)]();_0x8d22b0[_0x167199(0xd8)](_0x167199(0xa7),_0x167199(0x97)),_0x485239[_0x167199(0xe0)](_0x167199(0xea));}catch(_0x305b07){console[_0x167199(0xeb)](_0x305b07);}}),router[a0_0x412c49(0xd9)](a0_0x412c49(0xf3),auth,async(_0x11b552,_0x269039)=>{const _0x1116a5=a0_0x412c49;try{const {username:_0x481503,email:_0x2f645f,role:_0x108ba3}=_0x11b552[_0x1116a5(0xb1)],_0x355336=_0x11b552[_0x1116a5(0xb1)],_0x4ba081=await profile[_0x1116a5(0xc7)]({'email':_0x355336[_0x1116a5(0x91)]}),_0x5375d0=await master_shop[_0x1116a5(0xda)]();console[_0x1116a5(0xeb)](_0x1116a5(0xe2),_0x5375d0);const _0x1ccd4b=_0x11b552[_0x1116a5(0xe9)]['id'],_0x57a403=await customer[_0x1116a5(0xc8)](_0x1ccd4b);if(_0x5375d0[0x0]['language']=='English\x20(US)'){var _0x57dc01=users['English'];console[_0x1116a5(0xeb)](_0x57dc01);}else{if(_0x5375d0[0x0][_0x1116a5(0xb5)]==_0x1116a5(0x95))var _0x57dc01=users['Hindi'];else{if(_0x5375d0[0x0][_0x1116a5(0xb5)]==_0x1116a5(0x87))var _0x57dc01=users[_0x1116a5(0x87)];else{if(_0x5375d0[0x0][_0x1116a5(0xb5)]==_0x1116a5(0xb8))var _0x57dc01=users[_0x1116a5(0xb8)];else{if(_0x5375d0[0x0][_0x1116a5(0xb5)]=='French')var _0x57dc01=users['French'];else{if(_0x5375d0[0x0]['language']==_0x1116a5(0xaa))var _0x57dc01=users[_0x1116a5(0xbe)];else{if(_0x5375d0[0x0]['language']==_0x1116a5(0xd2))var _0x57dc01=users[_0x1116a5(0xd2)];else{if(_0x5375d0[0x0][_0x1116a5(0xb5)]=='Arabic\x20(ae)')var _0x57dc01=users[_0x1116a5(0xa9)];}}}}}}}_0x269039[_0x1116a5(0xc0)](_0x1116a5(0xc4),{'success':_0x11b552[_0x1116a5(0xd8)]('success'),'errors':_0x11b552[_0x1116a5(0xd8)](_0x1116a5(0xc6)),'role':_0x355336,'profile':_0x4ba081,'user':_0x57a403,'master_shop':_0x5375d0,'language':_0x57dc01});}catch(_0x2e7284){console[_0x1116a5(0xeb)](_0x2e7284);}}),router[a0_0x412c49(0xe8)]('/view/:id',auth,async(_0x14d543,_0x17a9a7)=>{const _0x31af5f=a0_0x412c49;try{const _0x2e6f49=_0x14d543[_0x31af5f(0xe9)]['id'],_0x463e98=await customer[_0x31af5f(0xc8)](_0x2e6f49),{name:_0x53c9d6,address:_0x20744f,mobile:_0x33aeae,email:_0x3e43e5,receivable:_0x23d2bb,payable:_0x2fa02b,contactperson:_0x400763,landline:_0x6c7603}=_0x14d543[_0x31af5f(0xbc)];_0x463e98[_0x31af5f(0xed)]=_0x53c9d6,_0x463e98[_0x31af5f(0xd4)]=_0x20744f,_0x463e98[_0x31af5f(0x8b)]=_0x33aeae,_0x463e98[_0x31af5f(0x91)]=_0x3e43e5,_0x463e98['receivable']=_0x23d2bb,_0x463e98[_0x31af5f(0xa6)]=_0x2fa02b,_0x463e98[_0x31af5f(0xb0)]=_0x400763,_0x463e98[_0x31af5f(0xcf)]=_0x6c7603;const _0x2805ab=await _0x463e98[_0x31af5f(0x89)]();_0x14d543[_0x31af5f(0xd8)](_0x31af5f(0xa7),_0x31af5f(0xcb)),_0x17a9a7[_0x31af5f(0xe0)]('/customer/view');}catch(_0x35a5fc){console[_0x31af5f(0xeb)](_0x35a5fc);}}),router[a0_0x412c49(0xd9)](a0_0x412c49(0x86),auth,async(_0x61b44f,_0x1f38c4)=>{const _0x223e72=a0_0x412c49;try{const {username:_0x44b531,email:_0x22fd15,role:_0x13ec00}=_0x61b44f[_0x223e72(0xb1)],_0x55e534=_0x61b44f[_0x223e72(0xb1)],_0x21b2f6=await profile[_0x223e72(0xc7)]({'email':_0x55e534[_0x223e72(0x91)]}),_0x504953=await master_shop['find']();console[_0x223e72(0xeb)](_0x223e72(0xe2),_0x504953),console[_0x223e72(0xeb)](_0x61b44f['params']['id']);const _0x3a4129=await customer[_0x223e72(0xc7)]({'_id':_0x61b44f[_0x223e72(0xe9)]['id']});console['log'](_0x223e72(0xba),_0x3a4129);const _0x38b938=await c_payment_data[_0x223e72(0xda)]({'customer':_0x3a4129['name']});console[_0x223e72(0xeb)](_0x38b938);const _0x5dbb0e=await c_payment_data[_0x223e72(0xf5)]([{'$match':{'customer':_0x3a4129[_0x223e72(0xed)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x223e72(0xdc)}}}]);console[_0x223e72(0xeb)](_0x223e72(0xac),_0x5dbb0e);const _0x11a0e5=await c_payment_data['aggregate']([{'$match':{'customer':_0x3a4129[_0x223e72(0xed)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x223e72(0xc5),'sum':{'$sum':_0x223e72(0xdc)}}}]);console['log'](_0x223e72(0xf4),_0x11a0e5);if(_0x504953[0x0][_0x223e72(0xb5)]==_0x223e72(0xae)){var _0x4c7a04=users[_0x223e72(0x90)];console[_0x223e72(0xeb)](_0x4c7a04);}else{if(_0x504953[0x0][_0x223e72(0xb5)]==_0x223e72(0x95))var _0x4c7a04=users[_0x223e72(0x95)];else{if(_0x504953[0x0]['language']==_0x223e72(0x87))var _0x4c7a04=users['German'];else{if(_0x504953[0x0][_0x223e72(0xb5)]=='Spanish')var _0x4c7a04=users['Spanish'];else{if(_0x504953[0x0]['language']==_0x223e72(0xa2))var _0x4c7a04=users[_0x223e72(0xa2)];else{if(_0x504953[0x0][_0x223e72(0xb5)]==_0x223e72(0xaa))var _0x4c7a04=users['Portuguese'];else{if(_0x504953[0x0][_0x223e72(0xb5)]==_0x223e72(0xd2))var _0x4c7a04=users[_0x223e72(0xd2)];else{if(_0x504953[0x0][_0x223e72(0xb5)]==_0x223e72(0x8a))var _0x4c7a04=users['Arabic'];}}}}}}}_0x1f38c4[_0x223e72(0xc0)](_0x223e72(0xf2),{'success':_0x61b44f[_0x223e72(0xd8)](_0x223e72(0xa7)),'errors':_0x61b44f[_0x223e72(0xd8)]('errors'),'role':_0x55e534,'profile':_0x21b2f6,'payment':_0x38b938,'payable':_0x5dbb0e,'receivable':_0x11a0e5,'master_shop':_0x504953,'language':_0x4c7a04});}catch(_0x237e3d){console[_0x223e72(0xeb)](_0x237e3d);}}),router[a0_0x412c49(0xd9)](a0_0x412c49(0xdb),auth,async(_0x120665,_0x22ad82)=>{const _0x97c814=a0_0x412c49;try{const _0x5d9584=new excelJS[(_0x97c814(0xbf))](),_0x5b098f=_0x5d9584[_0x97c814(0x8d)](_0x97c814(0xa1));return _0x5b098f[_0x97c814(0xa3)]=[{'header':'ID','key':_0x97c814(0xaf),'width':0xa},{'header':_0x97c814(0xa5),'key':'PBrands','width':0xa},{'header':_0x97c814(0xe1),'key':_0x97c814(0x99),'width':0xa},{'header':_0x97c814(0xe3),'key':_0x97c814(0xe3),'width':0xa},{'header':_0x97c814(0xd4),'key':_0x97c814(0xd4),'width':0xa},{'header':_0x97c814(0x8b),'key':_0x97c814(0x8b),'width':0xa},{'header':_0x97c814(0x91),'key':'email','width':0xa}],_0x22ad82[_0x97c814(0x84)](_0x97c814(0xce),_0x97c814(0xf6)),_0x22ad82[_0x97c814(0x84)](_0x97c814(0x85),_0x97c814(0xb6)),_0x5d9584[_0x97c814(0x88)][_0x97c814(0xd3)](_0x22ad82)[_0x97c814(0xcc)](()=>{const _0x209ecf=_0x97c814;_0x22ad82[_0x209ecf(0xe7)](0xc8);});}catch(_0x54635e){_0x22ad82[_0x97c814(0xe7)](0x190)[_0x97c814(0x9f)]({'errors':_0x54635e[_0x97c814(0xca)]});}});function a0_0x1b15(){const _0x5b66bf=['render','element','Sale','diskStorage','customer','$reason','errors','findOne','findById','../models/all_models','message','customer\x20update\x20successfully','then','sale','Content-Type','landline','filename','error','Chinese','write','address','SheetNames','public/Migration','110vETFaH','flash','get','find','/products_export_migrate_file','$amount','originalname','customer_docs','104720vkwUmG','redirect','SalesmanCode','master','SalesmanName','utils','22424WOHTuB','/view','status','post','params','/customer/view','log','readFile','name','\x20Failed','3429gIbbjY','exceljs','c_payments','customer_payment','/view/:id','receivable_sum','aggregate','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','payment_data','setHeader','Content-Disposition','/view/payment/:id','German','xlsx','save','Arabic\x20(ae)','mobile','\x20added\x20successfully','addWorksheet','6083AaBiln','73092qprCmr','English','email','public/Migration/','multer','120iUrCfn','Hindi','json','customer\x20add\x20successfully','file','PUnits','../middleware/auth','sheet_to_json','forEach','single','customer_product_fule','send','1030QQZhzE','Customers','French','columns','map','Name','payable','success','406109tLBHpa','Arabic','Portuguese\x20(BR)','1893hRMFyo','payable_sum','data','English\x20(US)','PName','contactperson','user','../public/language/languages.json','480uMSIQe','175YfqbcZ','language','attachment;\x20filename=customer_Migration_File.xlsx','express','Spanish','3116867urGxqb','customer_data','amount','body','exports','Portuguese','Workbook'];a0_0x1b15=function(){return _0x5b66bf;};return a0_0x1b15();}const storage1=multer[a0_0x412c49(0xc3)]({'destination':(_0x1cae2a,_0x22eee5,_0x261284)=>{const _0x250096=a0_0x412c49;_0x261284(null,_0x250096(0xd6));},'filename':(_0x3c9e1b,_0x5bcbd0,_0x38f7c5)=>{const _0x1f6426=a0_0x412c49;_0x38f7c5(null,Date['now']()+_0x5bcbd0[_0x1f6426(0xdd)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x4511(_0x5c9454,_0xe319ba){const _0x1b1537=a0_0x1b15();return a0_0x4511=function(_0x451134,_0x2e9ae1){_0x451134=_0x451134-0x84;let _0x7b5424=_0x1b1537[_0x451134];return _0x7b5424;},a0_0x4511(_0x5c9454,_0xe319ba);}router[a0_0x412c49(0xe8)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0x412c49(0x9d)](a0_0x412c49(0x9e)),async(_0xb41353,_0x55fe94)=>{const _0x4c97c6=a0_0x412c49,_0x135e51=_0xb41353[_0x4c97c6(0x98)][_0x4c97c6(0xd0)],_0x2d2258=await xlsx[_0x4c97c6(0xec)](_0x4c97c6(0x92)+_0x135e51);let _0x4ecb36=_0x2d2258[_0x4c97c6(0xd5)],_0x3fda17=xlsx[_0x4c97c6(0xe4)][_0x4c97c6(0x9b)](_0x2d2258['Sheets'][_0x4ecb36[0x0]]);for(const _0x274ca8 of _0x3fda17){const _0x33be1b=_0x274ca8['ID'],_0xb606ad=_0x274ca8[_0x4c97c6(0xa5)],_0x2e0b45=_0x274ca8[_0x4c97c6(0xe1)],_0x588d76=_0x274ca8[_0x4c97c6(0xe3)],_0x27eaea=_0x274ca8['address'],_0x458682=_0x274ca8[_0x4c97c6(0x8b)],_0x447fe8=_0x274ca8['email'];try{let _0x3ea8c4=await customer[_0x4c97c6(0xc7)]({'name':_0xb606ad});if(!_0x3ea8c4){const _0x1dc58b=new customer({'name':_0xb606ad,'ID':_0x33be1b,'SalesmanCode':_0x2e0b45,'SalesmanName':_0x588d76,'address':_0x27eaea,'mobile':_0x458682,'email':_0x447fe8});_0x3ea8c4=await _0x1dc58b['save'](),_0xb41353['flash']('success',_0xb606ad+_0x4c97c6(0x8c));}else _0xb41353[_0x4c97c6(0xd8)](_0x4c97c6(0xd1),_0xb606ad+_0x4c97c6(0xee));}catch(_0x5b8d02){_0x55fe94['status'](0x1f4)[_0x4c97c6(0x96)]({'proderror':_0x5b8d02['message'],'aproduct':ProductName});}}_0x55fe94[_0x4c97c6(0xe0)](_0x4c97c6(0xea));}),module[a0_0x412c49(0xbd)]=router;