const a0_0x3311bb=a0_0x193f;(function(_0x105d5,_0x32edf7){const _0x2a532d=a0_0x193f,_0x3a2166=_0x105d5();while(!![]){try{const _0x3c2fc7=parseInt(_0x2a532d(0x1e1))/0x1+parseInt(_0x2a532d(0x204))/0x2+parseInt(_0x2a532d(0x1da))/0x3*(parseInt(_0x2a532d(0x1ba))/0x4)+parseInt(_0x2a532d(0x1d4))/0x5*(parseInt(_0x2a532d(0x208))/0x6)+parseInt(_0x2a532d(0x20d))/0x7*(parseInt(_0x2a532d(0x1ee))/0x8)+-parseInt(_0x2a532d(0x1f4))/0x9*(-parseInt(_0x2a532d(0x1bb))/0xa)+-parseInt(_0x2a532d(0x20e))/0xb;if(_0x3c2fc7===_0x32edf7)break;else _0x3a2166['push'](_0x3a2166['shift']());}catch(_0x58c672){_0x3a2166['push'](_0x3a2166['shift']());}}}(a0_0x3659,0xab7b1));function a0_0x193f(_0x1ec1b9,_0x2a7e87){const _0x365949=a0_0x3659();return a0_0x193f=function(_0x193ffc,_0x45de0c){_0x193ffc=_0x193ffc-0x1b9;let _0x4ed8cc=_0x365949[_0x193ffc];return _0x4ed8cc;},a0_0x193f(_0x1ec1b9,_0x2a7e87);}const express=require(a0_0x3311bb(0x1ea)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x3311bb(0x1d6)),auth=require(a0_0x3311bb(0x213)),users=require(a0_0x3311bb(0x202)),excelJS=require('exceljs'),xlsx=require('xlsx'),multer=require('multer');router[a0_0x3311bb(0x1c2)](a0_0x3311bb(0x201),auth,async(_0xe71eb5,_0x105e98)=>{const _0x32e4ba=a0_0x3311bb;try{const {username:_0x53c009,email:_0x43969b,role:_0x58e300}=_0xe71eb5[_0x32e4ba(0x1f7)],_0x6f822e=_0xe71eb5['user'],_0x240ee7=await profile[_0x32e4ba(0x216)]({'email':_0x6f822e[_0x32e4ba(0x1c0)]}),_0x1221db=await master_shop[_0x32e4ba(0x1fd)]();console[_0x32e4ba(0x1c1)](_0x32e4ba(0x1c9),_0x1221db);const _0x48567a=await customer[_0x32e4ba(0x1fd)](),_0x525a25=await customer[_0x32e4ba(0x1fe)]([{'$lookup':{'from':_0x32e4ba(0x1d3),'localField':_0x32e4ba(0x1f5),'foreignField':_0x32e4ba(0x1d8),'as':_0x32e4ba(0x1ed)}}]);console[_0x32e4ba(0x1c1)](_0x525a25);const _0x165074=_0x525a25[_0x32e4ba(0x1f2)](_0x2bf2aa=>{const _0x54946e=_0x32e4ba;console[_0x54946e(0x1c1)](_0x54946e(0x1c8),_0x2bf2aa);var _0x3fa918=0x0,_0x1be566=0x0;return _0x2bf2aa[_0x54946e(0x1ed)][_0x54946e(0x1e4)](_0x2ecd7c=>{const _0x66526e=_0x54946e;console[_0x66526e(0x1c1)]('element',_0x2ecd7c),_0x2ecd7c['reason']=='Sale'?_0x3fa918+=_0x2ecd7c[_0x66526e(0x1d1)]:_0x1be566+=_0x2ecd7c[_0x66526e(0x1d1)];}),_0x2bf2aa[_0x54946e(0x1ef)]=parseFloat(_0x3fa918)+0x0,_0x2bf2aa[_0x54946e(0x200)]=parseFloat(_0x1be566)+0x0,_0x2bf2aa;});console[_0x32e4ba(0x1c1)]('payment_data',_0x165074);if(_0x1221db[0x0][_0x32e4ba(0x1bf)]==_0x32e4ba(0x21a)){var _0x25ecd7=users[_0x32e4ba(0x207)];console[_0x32e4ba(0x1c1)](_0x25ecd7);}else{if(_0x1221db[0x0]['language']==_0x32e4ba(0x1d5))var _0x25ecd7=users[_0x32e4ba(0x1d5)];else{if(_0x1221db[0x0][_0x32e4ba(0x1bf)]=='German')var _0x25ecd7=users['German'];else{if(_0x1221db[0x0]['language']==_0x32e4ba(0x1e3))var _0x25ecd7=users[_0x32e4ba(0x1e3)];else{if(_0x1221db[0x0][_0x32e4ba(0x1bf)]==_0x32e4ba(0x1fb))var _0x25ecd7=users['French'];else{if(_0x1221db[0x0][_0x32e4ba(0x1bf)]==_0x32e4ba(0x205))var _0x25ecd7=users[_0x32e4ba(0x209)];else{if(_0x1221db[0x0][_0x32e4ba(0x1bf)]==_0x32e4ba(0x1dc))var _0x25ecd7=users[_0x32e4ba(0x1dc)];else{if(_0x1221db[0x0][_0x32e4ba(0x1bf)]=='Arabic\x20(ae)')var _0x25ecd7=users[_0x32e4ba(0x21c)];}}}}}}}_0x105e98[_0x32e4ba(0x218)](_0x32e4ba(0x1d8),{'success':_0xe71eb5[_0x32e4ba(0x214)](_0x32e4ba(0x1cc)),'errors':_0xe71eb5[_0x32e4ba(0x214)](_0x32e4ba(0x20f)),'user':_0x48567a,'role':_0x6f822e,'profile':_0x240ee7,'payment':_0x165074,'master_shop':_0x1221db,'language':_0x25ecd7});}catch(_0x397f86){console['log'](_0x397f86);}}),router['post'](a0_0x3311bb(0x201),auth,async(_0x3c047e,_0x44bca7)=>{const _0x3ec4e0=a0_0x3311bb;try{const {name:_0xfbca35,address:_0x4e9504,mobile:_0xf2ca52,email:_0x371d7e,receivable:_0x22f76b,payable:_0x3e7da3,contactperson:_0x2828d0,landline:_0x5c9983}=_0x3c047e[_0x3ec4e0(0x1e5)],_0x2f63a7=new customer({'name':_0xfbca35,'address':_0x4e9504,'mobile':_0xf2ca52,'email':_0x371d7e,'receivable':_0x22f76b,'payable':_0x3e7da3,'contactperson':_0x2828d0,'landline':_0x5c9983}),_0x59cf4e=await _0x2f63a7['save']();_0x3c047e[_0x3ec4e0(0x214)](_0x3ec4e0(0x1cc),_0x3ec4e0(0x1db)),_0x44bca7[_0x3ec4e0(0x1fa)](_0x3ec4e0(0x1ce));}catch(_0x5da654){console[_0x3ec4e0(0x1c1)](_0x5da654);}}),router[a0_0x3311bb(0x1c2)]('/view/:id',auth,async(_0x3c99af,_0x549731)=>{const _0x506239=a0_0x3311bb;try{const {username:_0x1c2ec1,email:_0x1e56a8,role:_0x3249ae}=_0x3c99af[_0x506239(0x1f7)],_0x56b8d9=_0x3c99af[_0x506239(0x1f7)],_0x3af46a=await profile['findOne']({'email':_0x56b8d9[_0x506239(0x1c0)]}),_0x3ce317=await master_shop[_0x506239(0x1fd)]();console[_0x506239(0x1c1)](_0x506239(0x1c9),_0x3ce317);const _0x149103=_0x3c99af[_0x506239(0x1c3)]['id'],_0x191ea6=await customer[_0x506239(0x21d)](_0x149103);if(_0x3ce317[0x0][_0x506239(0x1bf)]=='English\x20(US)'){var _0x4ede5e=users[_0x506239(0x207)];console[_0x506239(0x1c1)](_0x4ede5e);}else{if(_0x3ce317[0x0][_0x506239(0x1bf)]==_0x506239(0x1d5))var _0x4ede5e=users['Hindi'];else{if(_0x3ce317[0x0][_0x506239(0x1bf)]==_0x506239(0x1d7))var _0x4ede5e=users[_0x506239(0x1d7)];else{if(_0x3ce317[0x0][_0x506239(0x1bf)]==_0x506239(0x1e3))var _0x4ede5e=users['Spanish'];else{if(_0x3ce317[0x0]['language']=='French')var _0x4ede5e=users[_0x506239(0x1fb)];else{if(_0x3ce317[0x0][_0x506239(0x1bf)]==_0x506239(0x205))var _0x4ede5e=users[_0x506239(0x209)];else{if(_0x3ce317[0x0][_0x506239(0x1bf)]==_0x506239(0x1dc))var _0x4ede5e=users[_0x506239(0x1dc)];else{if(_0x3ce317[0x0]['language']==_0x506239(0x1ff))var _0x4ede5e=users['Arabic'];}}}}}}}_0x549731[_0x506239(0x218)](_0x506239(0x1d8),{'success':_0x3c99af[_0x506239(0x214)]('success'),'errors':_0x3c99af[_0x506239(0x214)]('errors'),'role':_0x56b8d9,'profile':_0x3af46a,'user':_0x191ea6,'master_shop':_0x3ce317,'language':_0x4ede5e});}catch(_0x1af548){console[_0x506239(0x1c1)](_0x1af548);}}),router['post'](a0_0x3311bb(0x1bd),auth,async(_0xe4c05c,_0x1ce671)=>{const _0x25e9a9=a0_0x3311bb;try{const _0x4767ad=_0xe4c05c[_0x25e9a9(0x1c3)]['id'],_0x231f09=await customer['findById'](_0x4767ad),{name:_0xdd6116,address:_0x166d54,mobile:_0x46748a,email:_0x448ab0,receivable:_0x39479d,payable:_0x48eb03,contactperson:_0x36ac85,landline:_0x2c420d}=_0xe4c05c[_0x25e9a9(0x1e5)];_0x231f09[_0x25e9a9(0x1f5)]=_0xdd6116,_0x231f09[_0x25e9a9(0x1e7)]=_0x166d54,_0x231f09[_0x25e9a9(0x215)]=_0x46748a,_0x231f09[_0x25e9a9(0x1c0)]=_0x448ab0,_0x231f09['receivable']=_0x39479d,_0x231f09[_0x25e9a9(0x1e2)]=_0x48eb03,_0x231f09[_0x25e9a9(0x210)]=_0x36ac85,_0x231f09[_0x25e9a9(0x1c4)]=_0x2c420d;const _0x5ee935=await _0x231f09[_0x25e9a9(0x206)]();_0xe4c05c[_0x25e9a9(0x214)]('success','customer\x20update\x20successfully'),_0x1ce671['redirect'](_0x25e9a9(0x1ce));}catch(_0x295a1e){console['log'](_0x295a1e);}}),router['get'](a0_0x3311bb(0x219),auth,async(_0x205a03,_0x41cc7e)=>{const _0x3b5086=a0_0x3311bb;try{const {username:_0x5c6858,email:_0x4eb074,role:_0x344c79}=_0x205a03['user'],_0x1b054d=_0x205a03[_0x3b5086(0x1f7)],_0x129fb0=await profile[_0x3b5086(0x216)]({'email':_0x1b054d['email']}),_0x34b7e6=await master_shop['find']();console[_0x3b5086(0x1c1)](_0x3b5086(0x1c9),_0x34b7e6),console[_0x3b5086(0x1c1)](_0x205a03[_0x3b5086(0x1c3)]['id']);const _0x1f2ece=await customer['findOne']({'_id':_0x205a03[_0x3b5086(0x1c3)]['id']});console[_0x3b5086(0x1c1)](_0x3b5086(0x1be),_0x1f2ece);const _0x12c326=await c_payment_data[_0x3b5086(0x1fd)]({'customer':_0x1f2ece[_0x3b5086(0x1f5)]});console[_0x3b5086(0x1c1)](_0x12c326);const _0x27cac6=await c_payment_data[_0x3b5086(0x1fe)]([{'$match':{'customer':_0x1f2ece['name']}},{'$match':{'reason':_0x3b5086(0x21e)}},{'$group':{'_id':_0x3b5086(0x1cb),'sum':{'$sum':_0x3b5086(0x1ec)}}}]);console['log'](_0x3b5086(0x1e6),_0x27cac6);const _0x6c7d15=await c_payment_data['aggregate']([{'$match':{'customer':_0x1f2ece[_0x3b5086(0x1f5)]}},{'$match':{'reason':_0x3b5086(0x1cf)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x3b5086(0x1ec)}}}]);console[_0x3b5086(0x1c1)](_0x3b5086(0x211),_0x6c7d15);if(_0x34b7e6[0x0][_0x3b5086(0x1bf)]==_0x3b5086(0x21a)){var _0x5d4695=users[_0x3b5086(0x207)];console['log'](_0x5d4695);}else{if(_0x34b7e6[0x0][_0x3b5086(0x1bf)]==_0x3b5086(0x1d5))var _0x5d4695=users[_0x3b5086(0x1d5)];else{if(_0x34b7e6[0x0][_0x3b5086(0x1bf)]==_0x3b5086(0x1d7))var _0x5d4695=users[_0x3b5086(0x1d7)];else{if(_0x34b7e6[0x0][_0x3b5086(0x1bf)]=='Spanish')var _0x5d4695=users[_0x3b5086(0x1e3)];else{if(_0x34b7e6[0x0][_0x3b5086(0x1bf)]=='French')var _0x5d4695=users[_0x3b5086(0x1fb)];else{if(_0x34b7e6[0x0][_0x3b5086(0x1bf)]==_0x3b5086(0x205))var _0x5d4695=users['Portuguese'];else{if(_0x34b7e6[0x0][_0x3b5086(0x1bf)]==_0x3b5086(0x1dc))var _0x5d4695=users[_0x3b5086(0x1dc)];else{if(_0x34b7e6[0x0][_0x3b5086(0x1bf)]=='Arabic\x20(ae)')var _0x5d4695=users['Arabic'];}}}}}}}_0x41cc7e['render'](_0x3b5086(0x1f1),{'success':_0x205a03['flash'](_0x3b5086(0x1cc)),'errors':_0x205a03[_0x3b5086(0x214)](_0x3b5086(0x20f)),'role':_0x1b054d,'profile':_0x129fb0,'payment':_0x12c326,'payable':_0x27cac6,'receivable':_0x6c7d15,'master_shop':_0x34b7e6,'language':_0x5d4695});}catch(_0x41fa3a){console['log'](_0x41fa3a);}}),router['get'](a0_0x3311bb(0x1b9),auth,async(_0x5b0a68,_0x506265)=>{const _0x5bd0e3=a0_0x3311bb;try{const _0x4ccc0e=new excelJS[(_0x5bd0e3(0x1f3))](),_0x2d62b2=_0x4ccc0e[_0x5bd0e3(0x1cd)]('Customers');return _0x2d62b2['columns']=[{'header':'ID','key':_0x5bd0e3(0x1de),'width':0xa},{'header':_0x5bd0e3(0x1dd),'key':_0x5bd0e3(0x1d9),'width':0xa},{'header':_0x5bd0e3(0x1f0),'key':_0x5bd0e3(0x1d2),'width':0xa},{'header':_0x5bd0e3(0x1fc),'key':'SalesmanName','width':0xa},{'header':_0x5bd0e3(0x1e7),'key':_0x5bd0e3(0x1e7),'width':0xa},{'header':_0x5bd0e3(0x215),'key':_0x5bd0e3(0x215),'width':0xa},{'header':_0x5bd0e3(0x1c0),'key':_0x5bd0e3(0x1c0),'width':0xa}],_0x506265[_0x5bd0e3(0x1f9)](_0x5bd0e3(0x1df),_0x5bd0e3(0x1f8)),_0x506265['setHeader'](_0x5bd0e3(0x1e8),'attachment;\x20filename=customer_Migration_File.xlsx'),_0x4ccc0e['xlsx'][_0x5bd0e3(0x1f6)](_0x506265)['then'](()=>{const _0x522a26=_0x5bd0e3;_0x506265[_0x522a26(0x1d0)](0xc8);});}catch(_0x5596d1){_0x506265[_0x5bd0e3(0x1d0)](0x190)['send']({'errors':_0x5596d1[_0x5bd0e3(0x1eb)]});}});const storage1=multer[a0_0x3311bb(0x1c6)]({'destination':(_0x4747a9,_0x58284d,_0x4e3e23)=>{_0x4e3e23(null,'public/Migration');},'filename':(_0xfea182,_0x49138f,_0x2002cf)=>{const _0x3c0d03=a0_0x3311bb;_0x2002cf(null,Date['now']()+_0x49138f[_0x3c0d03(0x1e0)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x3311bb(0x1bc)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0x3311bb(0x217)](a0_0x3311bb(0x203)),async(_0xb29cef,_0x1b5f3b)=>{const _0x54ef14=a0_0x3311bb,_0x46d639=_0xb29cef[_0x54ef14(0x1c7)]['filename'],_0x32f1bc=await xlsx[_0x54ef14(0x20c)](_0x54ef14(0x21b)+_0x46d639);let _0x18f3d4=_0x32f1bc[_0x54ef14(0x1ca)],_0x3d0f55=xlsx['utils'][_0x54ef14(0x1c5)](_0x32f1bc['Sheets'][_0x18f3d4[0x0]]);for(const _0x248667 of _0x3d0f55){const _0x5860e6=_0x248667['ID'],_0x4f8fdd=_0x248667[_0x54ef14(0x1dd)],_0x1479c9=_0x248667[_0x54ef14(0x1f0)],_0x2b702d=_0x248667[_0x54ef14(0x1fc)],_0x424646=_0x248667[_0x54ef14(0x1e7)],_0x24e13c=_0x248667['mobile'],_0x20c7dd=_0x248667[_0x54ef14(0x1c0)];try{let _0xd1ad71=await customer[_0x54ef14(0x216)]({'name':_0x4f8fdd});if(!_0xd1ad71){const _0x430c27=new customer({'name':_0x4f8fdd,'ID':_0x5860e6,'SalesmanCode':_0x1479c9,'SalesmanName':_0x2b702d,'address':_0x424646,'mobile':_0x24e13c,'email':_0x20c7dd});_0xd1ad71=await _0x430c27[_0x54ef14(0x206)](),_0xb29cef[_0x54ef14(0x214)]('success',_0x4f8fdd+_0x54ef14(0x1e9));}else _0xb29cef[_0x54ef14(0x214)](_0x54ef14(0x20b),_0x4f8fdd+'\x20Failed');}catch(_0x3f109e){_0x1b5f3b[_0x54ef14(0x1d0)](0x1f4)[_0x54ef14(0x212)]({'proderror':_0x3f109e[_0x54ef14(0x1eb)],'aproduct':ProductName});}}_0x1b5f3b[_0x54ef14(0x1fa)]('/customer/view');}),module[a0_0x3311bb(0x20a)]=router;function a0_0x3659(){const _0x9a2a23=['setHeader','redirect','French','SalesmanName','find','aggregate','Arabic\x20(ae)','sale_return','/view','../public/language/languages.json','customer_product_fule','1620190JDcQfk','Portuguese\x20(BR)','save','English','162sfYHJy','Portuguese','exports','error','readFile','434txzkMv','32591086NtBFtd','errors','contactperson','receivable_sum','json','../middleware/auth','flash','mobile','findOne','single','render','/view/payment/:id','English\x20(US)','public/Migration/','Arabic','findById','Sale','/products_export_migrate_file','543880GDbQZp','10ZEyWdi','post','/view/:id','customer_data','language','email','log','get','params','landline','sheet_to_json','diskStorage','file','data','master','SheetNames','$reason','success','addWorksheet','/customer/view','Sale\x20Return','status','amount','PUnits','c_payments','50345YtLoBO','Hindi','../models/all_models','German','customer','PBrands','6HhVcQf','customer\x20add\x20successfully','Chinese','Name','PName','Content-Type','originalname','1123483RaHtvZ','payable','Spanish','forEach','body','payable_sum','address','Content-Disposition','\x20added\x20successfully','express','message','$amount','customer_docs','121288ohxMSn','sale','SalesmanCode','customer_payment','map','Workbook','2230632adPsxW','name','write','user','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'];a0_0x3659=function(){return _0x9a2a23;};return a0_0x3659();}