const a0_0x2507f8=a0_0x5426;(function(_0x15fa9a,_0x202905){const _0x1f6012=a0_0x5426,_0x1cbbba=_0x15fa9a();while(!![]){try{const _0xce07fe=-parseInt(_0x1f6012(0xac))/0x1+parseInt(_0x1f6012(0x84))/0x2*(-parseInt(_0x1f6012(0x95))/0x3)+parseInt(_0x1f6012(0xc3))/0x4*(parseInt(_0x1f6012(0x98))/0x5)+-parseInt(_0x1f6012(0xa0))/0x6+-parseInt(_0x1f6012(0xd8))/0x7*(parseInt(_0x1f6012(0xb0))/0x8)+parseInt(_0x1f6012(0xb3))/0x9*(-parseInt(_0x1f6012(0x7a))/0xa)+parseInt(_0x1f6012(0xcf))/0xb;if(_0xce07fe===_0x202905)break;else _0x1cbbba['push'](_0x1cbbba['shift']());}catch(_0x44374c){_0x1cbbba['push'](_0x1cbbba['shift']());}}}(a0_0xebb4,0xd8043));function a0_0x5426(_0x564c13,_0x3f32be){const _0xebb46a=a0_0xebb4();return a0_0x5426=function(_0x5426f5,_0x417a1c){_0x5426f5=_0x5426f5-0x73;let _0x5a381b=_0xebb46a[_0x5426f5];return _0x5a381b;},a0_0x5426(_0x564c13,_0x3f32be);}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x2507f8(0x85)),users=require(a0_0x2507f8(0x74)),excelJS=require('exceljs'),xlsx=require('xlsx'),multer=require('multer');router['get'](a0_0x2507f8(0xb8),auth,async(_0x3a3292,_0x413195)=>{const _0x30cc51=a0_0x2507f8;try{const {username:_0x1b5b9a,email:_0x34f872,role:_0x5c80c5}=_0x3a3292['user'],_0x54dd45=_0x3a3292[_0x30cc51(0x82)],_0x1129df=await profile[_0x30cc51(0xc7)]({'email':_0x54dd45[_0x30cc51(0xd2)]}),_0x1328cc=await master_shop[_0x30cc51(0x91)]();console[_0x30cc51(0x80)](_0x30cc51(0xbc),_0x1328cc);const _0x1105af=await customer['find'](),_0x2ad084=await customer[_0x30cc51(0xd1)]([{'$lookup':{'from':'c_payments','localField':'name','foreignField':_0x30cc51(0xa2),'as':_0x30cc51(0xad)}}]);console[_0x30cc51(0x80)](_0x2ad084);const _0x1adecd=_0x2ad084['map'](_0x174675=>{const _0x4204c8=_0x30cc51;console[_0x4204c8(0x80)](_0x4204c8(0xb7),_0x174675);var _0x119064=0x0,_0x3e162c=0x0;return _0x174675[_0x4204c8(0xad)]['forEach'](_0x392867=>{const _0x147541=_0x4204c8;console[_0x147541(0x80)](_0x147541(0xc4),_0x392867),_0x392867[_0x147541(0x9e)]==_0x147541(0x7f)?_0x119064+=_0x392867[_0x147541(0x86)]:_0x3e162c+=_0x392867[_0x147541(0x86)];}),_0x174675['sale']=parseFloat(_0x119064)+0x0,_0x174675[_0x4204c8(0xcb)]=parseFloat(_0x3e162c)+0x0,_0x174675;});console[_0x30cc51(0x80)](_0x30cc51(0xcd),_0x1adecd);if(_0x1328cc[0x0][_0x30cc51(0xb6)]=='English\x20(US)'){var _0x1a3589=users[_0x30cc51(0x7b)];console[_0x30cc51(0x80)](_0x1a3589);}else{if(_0x1328cc[0x0][_0x30cc51(0xb6)]==_0x30cc51(0xab))var _0x1a3589=users[_0x30cc51(0xab)];else{if(_0x1328cc[0x0][_0x30cc51(0xb6)]=='German')var _0x1a3589=users[_0x30cc51(0x7e)];else{if(_0x1328cc[0x0]['language']==_0x30cc51(0x9f))var _0x1a3589=users[_0x30cc51(0x9f)];else{if(_0x1328cc[0x0][_0x30cc51(0xb6)]==_0x30cc51(0xc1))var _0x1a3589=users[_0x30cc51(0xc1)];else{if(_0x1328cc[0x0]['language']==_0x30cc51(0xba))var _0x1a3589=users['Portuguese'];else{if(_0x1328cc[0x0]['language']==_0x30cc51(0x81))var _0x1a3589=users[_0x30cc51(0x81)];else{if(_0x1328cc[0x0][_0x30cc51(0xb6)]=='Arabic\x20(ae)')var _0x1a3589=users[_0x30cc51(0xd3)];}}}}}}}_0x413195[_0x30cc51(0x93)](_0x30cc51(0xa2),{'success':_0x3a3292['flash'](_0x30cc51(0xd6)),'errors':_0x3a3292['flash'](_0x30cc51(0xa4)),'user':_0x1105af,'role':_0x54dd45,'profile':_0x1129df,'payment':_0x1adecd,'master_shop':_0x1328cc,'language':_0x1a3589});}catch(_0x1b7db7){console[_0x30cc51(0x80)](_0x1b7db7);}}),router['post'](a0_0x2507f8(0xb8),auth,async(_0x1d8bb3,_0x29db59)=>{const _0x385c38=a0_0x2507f8;try{const {name:_0x4893ea,address:_0x491e03,mobile:_0x20ede7,email:_0x31fb46,receivable:_0x2281a0,payable:_0x5509ea,contactperson:_0xb70f44,landline:_0x5c1023}=_0x1d8bb3[_0x385c38(0x87)],_0x285d28=new customer({'name':_0x4893ea,'address':_0x491e03,'mobile':_0x20ede7,'email':_0x31fb46,'receivable':_0x2281a0,'payable':_0x5509ea,'contactperson':_0xb70f44,'landline':_0x5c1023}),_0x1e66be=await _0x285d28[_0x385c38(0xa3)]();_0x1d8bb3[_0x385c38(0xa8)](_0x385c38(0xd6),_0x385c38(0xcc)),_0x29db59['redirect'](_0x385c38(0xc8));}catch(_0x17580e){console[_0x385c38(0x80)](_0x17580e);}}),router['get'](a0_0x2507f8(0xa5),auth,async(_0x67e45e,_0x16881d)=>{const _0xc5e51c=a0_0x2507f8;try{const {username:_0x570ba7,email:_0x37acf2,role:_0x4e601e}=_0x67e45e[_0xc5e51c(0x82)],_0x213398=_0x67e45e[_0xc5e51c(0x82)],_0x52afed=await profile[_0xc5e51c(0xc7)]({'email':_0x213398[_0xc5e51c(0xd2)]}),_0x5f31dd=await master_shop[_0xc5e51c(0x91)]();console[_0xc5e51c(0x80)](_0xc5e51c(0xbc),_0x5f31dd);const _0x2a45d=_0x67e45e[_0xc5e51c(0xa7)]['id'],_0xb5eba6=await customer[_0xc5e51c(0xc5)](_0x2a45d);if(_0x5f31dd[0x0][_0xc5e51c(0xb6)]==_0xc5e51c(0xce)){var _0x292229=users['English'];console[_0xc5e51c(0x80)](_0x292229);}else{if(_0x5f31dd[0x0][_0xc5e51c(0xb6)]==_0xc5e51c(0xab))var _0x292229=users[_0xc5e51c(0xab)];else{if(_0x5f31dd[0x0]['language']==_0xc5e51c(0x7e))var _0x292229=users['German'];else{if(_0x5f31dd[0x0][_0xc5e51c(0xb6)]==_0xc5e51c(0x9f))var _0x292229=users[_0xc5e51c(0x9f)];else{if(_0x5f31dd[0x0][_0xc5e51c(0xb6)]=='French')var _0x292229=users['French'];else{if(_0x5f31dd[0x0][_0xc5e51c(0xb6)]==_0xc5e51c(0xba))var _0x292229=users['Portuguese'];else{if(_0x5f31dd[0x0][_0xc5e51c(0xb6)]=='Chinese')var _0x292229=users[_0xc5e51c(0x81)];else{if(_0x5f31dd[0x0][_0xc5e51c(0xb6)]==_0xc5e51c(0x7c))var _0x292229=users[_0xc5e51c(0xd3)];}}}}}}}_0x16881d[_0xc5e51c(0x93)](_0xc5e51c(0xa2),{'success':_0x67e45e[_0xc5e51c(0xa8)](_0xc5e51c(0xd6)),'errors':_0x67e45e[_0xc5e51c(0xa8)](_0xc5e51c(0xa4)),'role':_0x213398,'profile':_0x52afed,'user':_0xb5eba6,'master_shop':_0x5f31dd,'language':_0x292229});}catch(_0x26267f){console[_0xc5e51c(0x80)](_0x26267f);}}),router[a0_0x2507f8(0xaa)](a0_0x2507f8(0xa5),auth,async(_0x3c823b,_0x35f12e)=>{const _0x541524=a0_0x2507f8;try{const _0x294e2d=_0x3c823b['params']['id'],_0x5b3bc0=await customer['findById'](_0x294e2d),{name:_0x23a6f4,address:_0x14a5a0,mobile:_0x7fd9f7,email:_0x208d28,receivable:_0x57db7d,payable:_0x55bc5f,contactperson:_0x134147,landline:_0xa545ef}=_0x3c823b[_0x541524(0x87)];_0x5b3bc0[_0x541524(0xa1)]=_0x23a6f4,_0x5b3bc0['address']=_0x14a5a0,_0x5b3bc0['mobile']=_0x7fd9f7,_0x5b3bc0[_0x541524(0xd2)]=_0x208d28,_0x5b3bc0[_0x541524(0x9b)]=_0x57db7d,_0x5b3bc0[_0x541524(0x83)]=_0x55bc5f,_0x5b3bc0['contactperson']=_0x134147,_0x5b3bc0['landline']=_0xa545ef;const _0x4fe8b2=await _0x5b3bc0['save']();_0x3c823b[_0x541524(0xa8)](_0x541524(0xd6),_0x541524(0xc9)),_0x35f12e['redirect'](_0x541524(0xc8));}catch(_0x4f84bb){console[_0x541524(0x80)](_0x4f84bb);}}),router['get']('/view/payment/:id',auth,async(_0x2b82a4,_0x376258)=>{const _0x353c7e=a0_0x2507f8;try{const {username:_0x30c971,email:_0x1c5bfd,role:_0x59592e}=_0x2b82a4[_0x353c7e(0x82)],_0x5adb8c=_0x2b82a4[_0x353c7e(0x82)],_0x3d4209=await profile[_0x353c7e(0xc7)]({'email':_0x5adb8c[_0x353c7e(0xd2)]}),_0x24a76b=await master_shop[_0x353c7e(0x91)]();console[_0x353c7e(0x80)](_0x353c7e(0xbc),_0x24a76b),console[_0x353c7e(0x80)](_0x2b82a4['params']['id']);const _0x18dd7e=await customer[_0x353c7e(0xc7)]({'_id':_0x2b82a4[_0x353c7e(0xa7)]['id']});console[_0x353c7e(0x80)](_0x353c7e(0x89),_0x18dd7e);const _0x1c43a2=await c_payment_data[_0x353c7e(0x91)]({'customer':_0x18dd7e['name']});console[_0x353c7e(0x80)](_0x1c43a2);const _0x3a8785=await c_payment_data['aggregate']([{'$match':{'customer':_0x18dd7e['name']}},{'$match':{'reason':'Sale'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x353c7e(0xd7)}}}]);console[_0x353c7e(0x80)](_0x353c7e(0xb5),_0x3a8785);const _0x360b35=await c_payment_data[_0x353c7e(0xd1)]([{'$match':{'customer':_0x18dd7e[_0x353c7e(0xa1)]}},{'$match':{'reason':'Sale\x20Return'}},{'$group':{'_id':_0x353c7e(0xb1),'sum':{'$sum':_0x353c7e(0xd7)}}}]);console['log']('receivable_sum',_0x360b35);if(_0x24a76b[0x0][_0x353c7e(0xb6)]==_0x353c7e(0xce)){var _0x22fd82=users['English'];console[_0x353c7e(0x80)](_0x22fd82);}else{if(_0x24a76b[0x0]['language']==_0x353c7e(0xab))var _0x22fd82=users[_0x353c7e(0xab)];else{if(_0x24a76b[0x0][_0x353c7e(0xb6)]==_0x353c7e(0x7e))var _0x22fd82=users[_0x353c7e(0x7e)];else{if(_0x24a76b[0x0][_0x353c7e(0xb6)]==_0x353c7e(0x9f))var _0x22fd82=users[_0x353c7e(0x9f)];else{if(_0x24a76b[0x0][_0x353c7e(0xb6)]==_0x353c7e(0xc1))var _0x22fd82=users[_0x353c7e(0xc1)];else{if(_0x24a76b[0x0][_0x353c7e(0xb6)]==_0x353c7e(0xba))var _0x22fd82=users[_0x353c7e(0x8c)];else{if(_0x24a76b[0x0]['language']==_0x353c7e(0x81))var _0x22fd82=users[_0x353c7e(0x81)];else{if(_0x24a76b[0x0][_0x353c7e(0xb6)]==_0x353c7e(0x7c))var _0x22fd82=users[_0x353c7e(0xd3)];}}}}}}}_0x376258[_0x353c7e(0x93)](_0x353c7e(0x88),{'success':_0x2b82a4[_0x353c7e(0xa8)](_0x353c7e(0xd6)),'errors':_0x2b82a4[_0x353c7e(0xa8)](_0x353c7e(0xa4)),'role':_0x5adb8c,'profile':_0x3d4209,'payment':_0x1c43a2,'payable':_0x3a8785,'receivable':_0x360b35,'master_shop':_0x24a76b,'language':_0x22fd82});}catch(_0x2d8b68){console[_0x353c7e(0x80)](_0x2d8b68);}}),router[a0_0x2507f8(0x8b)](a0_0x2507f8(0x96),auth,async(_0x10bca0,_0x231fc2)=>{const _0x39e9fa=a0_0x2507f8;try{const _0x14d513=new excelJS[(_0x39e9fa(0xd5))](),_0x1f6872=_0x14d513[_0x39e9fa(0x76)]('Customers');return _0x1f6872[_0x39e9fa(0x9d)]=[{'header':'ID','key':_0x39e9fa(0x8e),'width':0xa},{'header':_0x39e9fa(0x99),'key':'PBrands','width':0xa},{'header':'SalesmanCode','key':_0x39e9fa(0xaf),'width':0xa},{'header':_0x39e9fa(0x9a),'key':_0x39e9fa(0x9a),'width':0xa},{'header':_0x39e9fa(0x7d),'key':_0x39e9fa(0x7d),'width':0xa},{'header':_0x39e9fa(0xca),'key':_0x39e9fa(0xca),'width':0xa},{'header':_0x39e9fa(0xd2),'key':_0x39e9fa(0xd2),'width':0xa}],_0x231fc2['setHeader'](_0x39e9fa(0x8a),_0x39e9fa(0xa6)),_0x231fc2[_0x39e9fa(0x75)](_0x39e9fa(0x73),_0x39e9fa(0x90)),_0x14d513[_0x39e9fa(0x79)][_0x39e9fa(0xd4)](_0x231fc2)[_0x39e9fa(0xb4)](()=>{const _0x12dcfa=_0x39e9fa;_0x231fc2[_0x12dcfa(0xbf)](0xc8);});}catch(_0x47b9e4){_0x231fc2[_0x39e9fa(0xbf)](0x190)[_0x39e9fa(0xd0)]({'errors':_0x47b9e4['message']});}});function a0_0xebb4(){const _0x5831b1=['customer_product_fule','findOne','/customer/view','customer\x20update\x20successfully','mobile','sale_return','customer\x20add\x20successfully','payment_data','English\x20(US)','56904089YzQwgy','send','aggregate','email','Arabic','write','Workbook','success','$amount','209391KxUicI','Content-Disposition','../public/language/languages.json','setHeader','addWorksheet','public/Migration/','exports','xlsx','10SSNHQz','English','Arabic\x20(ae)','address','German','Sale','log','Chinese','user','payable','578jWpTAy','../middleware/auth','amount','body','customer_payment','customer_data','Content-Type','get','Portuguese','originalname','PName','sheet_to_json','attachment;\x20filename=customer_Migration_File.xlsx','find','diskStorage','render','single','13848RDqwJq','/products_export_migrate_file','json','9050tddXyV','Name','SalesmanName','receivable','file','columns','reason','Spanish','3614586hcXvJs','name','customer','save','errors','/view/:id','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','params','flash','readFile','post','Hindi','979551EsmiTo','customer_docs','Sheets','PUnits','408HbVvLz','$reason','public/Migration','5446053VOzVoA','then','payable_sum','language','data','/view','error','Portuguese\x20(BR)','/customer_import_migrate_file','master','\x20added\x20successfully','utils','status','filename','French','\x20Failed','1676xhXpos','element','findById'];a0_0xebb4=function(){return _0x5831b1;};return a0_0xebb4();}const storage1=multer[a0_0x2507f8(0x92)]({'destination':(_0x5b35ec,_0x3d68b1,_0x38855e)=>{const _0xe3dda=a0_0x2507f8;_0x38855e(null,_0xe3dda(0xb2));},'filename':(_0x44f080,_0x474ced,_0x21e552)=>{const _0x236de1=a0_0x2507f8;_0x21e552(null,Date['now']()+_0x474ced[_0x236de1(0x8d)]);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x2507f8(0xbb),auth,uploadMigrate[a0_0x2507f8(0x94)](a0_0x2507f8(0xc6)),async(_0x51af43,_0x388c83)=>{const _0x34b48a=a0_0x2507f8,_0x4910bf=_0x51af43[_0x34b48a(0x9c)][_0x34b48a(0xc0)],_0x60273b=await xlsx[_0x34b48a(0xa9)](_0x34b48a(0x77)+_0x4910bf);let _0x23b524=_0x60273b['SheetNames'],_0x83ea3a=xlsx[_0x34b48a(0xbe)][_0x34b48a(0x8f)](_0x60273b[_0x34b48a(0xae)][_0x23b524[0x0]]);for(const _0x466f05 of _0x83ea3a){const _0x28dbe9=_0x466f05['ID'],_0x2fc13a=_0x466f05[_0x34b48a(0x99)],_0x55a386=_0x466f05['SalesmanCode'],_0x29b667=_0x466f05[_0x34b48a(0x9a)],_0x294123=_0x466f05['address'],_0x39c159=_0x466f05[_0x34b48a(0xca)],_0x2bac89=_0x466f05[_0x34b48a(0xd2)];try{let _0x5c0d81=await customer[_0x34b48a(0xc7)]({'name':_0x2fc13a});if(!_0x5c0d81){const _0x216d07=new customer({'name':_0x2fc13a,'ID':_0x28dbe9,'SalesmanCode':_0x55a386,'SalesmanName':_0x29b667,'address':_0x294123,'mobile':_0x39c159,'email':_0x2bac89});_0x5c0d81=await _0x216d07[_0x34b48a(0xa3)](),_0x51af43[_0x34b48a(0xa8)](_0x34b48a(0xd6),_0x2fc13a+_0x34b48a(0xbd));}else _0x51af43[_0x34b48a(0xa8)](_0x34b48a(0xb9),_0x2fc13a+_0x34b48a(0xc2));}catch(_0x5cf2c9){_0x388c83['status'](0x1f4)[_0x34b48a(0x97)]({'proderror':_0x5cf2c9['message'],'aproduct':ProductName});}}_0x388c83['redirect'](_0x34b48a(0xc8));}),module[a0_0x2507f8(0x78)]=router;