const a0_0x412a6d=a0_0xe308;(function(_0x477a24,_0x149b85){const _0x5914f1=a0_0xe308,_0x4a9e2b=_0x477a24();while(!![]){try{const _0x2ca226=parseInt(_0x5914f1(0x235))/0x1*(parseInt(_0x5914f1(0x1f9))/0x2)+-parseInt(_0x5914f1(0x227))/0x3+parseInt(_0x5914f1(0x22d))/0x4*(-parseInt(_0x5914f1(0x205))/0x5)+-parseInt(_0x5914f1(0x1dc))/0x6*(parseInt(_0x5914f1(0x1e5))/0x7)+-parseInt(_0x5914f1(0x1db))/0x8+-parseInt(_0x5914f1(0x22a))/0x9*(-parseInt(_0x5914f1(0x233))/0xa)+-parseInt(_0x5914f1(0x237))/0xb*(-parseInt(_0x5914f1(0x1ee))/0xc);if(_0x2ca226===_0x149b85)break;else _0x4a9e2b['push'](_0x4a9e2b['shift']());}catch(_0x205601){_0x4a9e2b['push'](_0x4a9e2b['shift']());}}}(a0_0x575d,0x193e8));const express=require(a0_0x412a6d(0x1fe)),app=express(),router=express[a0_0x412a6d(0x21b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x412a6d(0x1fb)),auth=require('../middleware/auth'),users=require(a0_0x412a6d(0x206)),excelJS=require(a0_0x412a6d(0x1f8)),xlsx=require(a0_0x412a6d(0x1e7)),multer=require(a0_0x412a6d(0x201));function a0_0x575d(){const _0x3fb463=['../public/language/languages.json','render','customer','sale','SalesmanName','utils','Content-Type','columns','customer_data','sale_return','redirect','originalname','customer\x20add\x20successfully','\x20added\x20successfully','error','data','then','mobile','payable','receivable_sum','/view','Router','language','get','Arabic','/customer_import_migrate_file','body','payable_sum','/view/:id','json','sheet_to_json','filename','/customer/view','551292SyhdGW','send','\x20Failed','425421iYxQAG','message','Arabic\x20(ae)','8kGjJUx','flash','diskStorage','public/Migration','exports','SalesmanCode','10WhEhzQ','aggregate','33VGUoUM','forEach','83457GuZnvj','single','address','reason','/products_export_migrate_file','log','user','French','email','success','params','1132704VDvPzG','11442yllLsr','find','Chinese','amount','addWorksheet','post','file','write','master','14uomCBV','PBrands','xlsx','Sale\x20Return','English','customer_docs','Portuguese','Portuguese\x20(BR)','Spanish','696qtvfhG','readFile','German','English\x20(US)','errors','payment_data','setHeader','$reason','findOne','customer_payment','exceljs','4542lTUgbF','save','../models/all_models','Name','status','express','Hindi','name','multer','Sale','public/Migration/','$amount','324230tFlfTm'];a0_0x575d=function(){return _0x3fb463;};return a0_0x575d();}router[a0_0x412a6d(0x21d)](a0_0x412a6d(0x21a),auth,async(_0x58992f,_0x1a3e46)=>{const _0x517025=a0_0x412a6d;try{const {username:_0x3dec74,email:_0x36977d,role:_0x293c6b}=_0x58992f['user'],_0x44e1fe=_0x58992f[_0x517025(0x23d)],_0x5e0726=await profile[_0x517025(0x1f6)]({'email':_0x44e1fe[_0x517025(0x23f)]}),_0xc7fa8b=await master_shop['find']();console[_0x517025(0x23c)](_0x517025(0x1e4),_0xc7fa8b);const _0xb588f1=await customer[_0x517025(0x1dd)](),_0x31d88e=await customer['aggregate']([{'$lookup':{'from':'c_payments','localField':_0x517025(0x200),'foreignField':'customer','as':_0x517025(0x1ea)}}]);console[_0x517025(0x23c)](_0x31d88e);const _0xfac171=_0x31d88e['map'](_0x423623=>{const _0x37b21f=_0x517025;console[_0x37b21f(0x23c)](_0x37b21f(0x215),_0x423623);var _0x14aae3=0x0,_0x13213d=0x0;return _0x423623[_0x37b21f(0x1ea)][_0x37b21f(0x236)](_0xedd9ee=>{const _0x4eb208=_0x37b21f;console[_0x4eb208(0x23c)]('element',_0xedd9ee),_0xedd9ee[_0x4eb208(0x23a)]==_0x4eb208(0x202)?_0x14aae3+=_0xedd9ee[_0x4eb208(0x1df)]:_0x13213d+=_0xedd9ee[_0x4eb208(0x1df)];}),_0x423623[_0x37b21f(0x209)]=parseFloat(_0x14aae3)+0x0,_0x423623[_0x37b21f(0x20f)]=parseFloat(_0x13213d)+0x0,_0x423623;});console[_0x517025(0x23c)](_0x517025(0x1f3),_0xfac171);if(_0xc7fa8b[0x0][_0x517025(0x21c)]==_0x517025(0x1f1)){var _0x31eff2=users[_0x517025(0x1e9)];console['log'](_0x31eff2);}else{if(_0xc7fa8b[0x0]['language']==_0x517025(0x1ff))var _0x31eff2=users['Hindi'];else{if(_0xc7fa8b[0x0]['language']=='German')var _0x31eff2=users['German'];else{if(_0xc7fa8b[0x0][_0x517025(0x21c)]==_0x517025(0x1ed))var _0x31eff2=users[_0x517025(0x1ed)];else{if(_0xc7fa8b[0x0]['language']==_0x517025(0x23e))var _0x31eff2=users['French'];else{if(_0xc7fa8b[0x0][_0x517025(0x21c)]=='Portuguese\x20(BR)')var _0x31eff2=users[_0x517025(0x1eb)];else{if(_0xc7fa8b[0x0][_0x517025(0x21c)]==_0x517025(0x1de))var _0x31eff2=users[_0x517025(0x1de)];else{if(_0xc7fa8b[0x0][_0x517025(0x21c)]==_0x517025(0x22c))var _0x31eff2=users[_0x517025(0x21e)];}}}}}}}_0x1a3e46[_0x517025(0x207)]('customer',{'success':_0x58992f[_0x517025(0x22e)]('success'),'errors':_0x58992f[_0x517025(0x22e)](_0x517025(0x1f2)),'user':_0xb588f1,'role':_0x44e1fe,'profile':_0x5e0726,'payment':_0xfac171,'master_shop':_0xc7fa8b,'language':_0x31eff2});}catch(_0x336817){console['log'](_0x336817);}}),router[a0_0x412a6d(0x1e1)](a0_0x412a6d(0x21a),auth,async(_0x4dccdc,_0xf90ae0)=>{const _0x288337=a0_0x412a6d;try{const {name:_0x3aeef2,address:_0xef926e,mobile:_0x8bb845,email:_0x526a22,receivable:_0x401db6,payable:_0x3bd26f,contactperson:_0x43902d,landline:_0x2fe0cf}=_0x4dccdc[_0x288337(0x220)],_0x302614=new customer({'name':_0x3aeef2,'address':_0xef926e,'mobile':_0x8bb845,'email':_0x526a22,'receivable':_0x401db6,'payable':_0x3bd26f,'contactperson':_0x43902d,'landline':_0x2fe0cf}),_0x3ac76a=await _0x302614['save']();_0x4dccdc[_0x288337(0x22e)]('success',_0x288337(0x212)),_0xf90ae0[_0x288337(0x210)](_0x288337(0x226));}catch(_0x34d8f9){console[_0x288337(0x23c)](_0x34d8f9);}}),router[a0_0x412a6d(0x21d)](a0_0x412a6d(0x222),auth,async(_0x213a0f,_0x3477da)=>{const _0x261f3a=a0_0x412a6d;try{const {username:_0x4851ee,email:_0x39eb9d,role:_0x278f08}=_0x213a0f[_0x261f3a(0x23d)],_0x39f894=_0x213a0f[_0x261f3a(0x23d)],_0x2a3c7e=await profile[_0x261f3a(0x1f6)]({'email':_0x39f894[_0x261f3a(0x23f)]}),_0x115cea=await master_shop['find']();console[_0x261f3a(0x23c)]('master',_0x115cea);const _0x2bf5be=_0x213a0f[_0x261f3a(0x1da)]['id'],_0xaad4bc=await customer['findById'](_0x2bf5be);if(_0x115cea[0x0][_0x261f3a(0x21c)]==_0x261f3a(0x1f1)){var _0x2766a5=users['English'];console['log'](_0x2766a5);}else{if(_0x115cea[0x0][_0x261f3a(0x21c)]=='Hindi')var _0x2766a5=users['Hindi'];else{if(_0x115cea[0x0][_0x261f3a(0x21c)]=='German')var _0x2766a5=users[_0x261f3a(0x1f0)];else{if(_0x115cea[0x0][_0x261f3a(0x21c)]==_0x261f3a(0x1ed))var _0x2766a5=users[_0x261f3a(0x1ed)];else{if(_0x115cea[0x0][_0x261f3a(0x21c)]==_0x261f3a(0x23e))var _0x2766a5=users[_0x261f3a(0x23e)];else{if(_0x115cea[0x0][_0x261f3a(0x21c)]==_0x261f3a(0x1ec))var _0x2766a5=users['Portuguese'];else{if(_0x115cea[0x0][_0x261f3a(0x21c)]==_0x261f3a(0x1de))var _0x2766a5=users[_0x261f3a(0x1de)];else{if(_0x115cea[0x0][_0x261f3a(0x21c)]==_0x261f3a(0x22c))var _0x2766a5=users[_0x261f3a(0x21e)];}}}}}}}_0x3477da[_0x261f3a(0x207)](_0x261f3a(0x208),{'success':_0x213a0f[_0x261f3a(0x22e)](_0x261f3a(0x240)),'errors':_0x213a0f[_0x261f3a(0x22e)](_0x261f3a(0x1f2)),'role':_0x39f894,'profile':_0x2a3c7e,'user':_0xaad4bc,'master_shop':_0x115cea,'language':_0x2766a5});}catch(_0x5be0e6){console[_0x261f3a(0x23c)](_0x5be0e6);}}),router[a0_0x412a6d(0x1e1)](a0_0x412a6d(0x222),auth,async(_0x1625b8,_0x5aed43)=>{const _0x13acd8=a0_0x412a6d;try{const _0x2bc9a6=_0x1625b8[_0x13acd8(0x1da)]['id'],_0x221fde=await customer['findById'](_0x2bc9a6),{name:_0x20ee8a,address:_0x2f6dc3,mobile:_0x2af014,email:_0x1d6b53,receivable:_0x285a80,payable:_0x3d56d4,contactperson:_0x2f7d34,landline:_0x35e969}=_0x1625b8['body'];_0x221fde[_0x13acd8(0x200)]=_0x20ee8a,_0x221fde[_0x13acd8(0x239)]=_0x2f6dc3,_0x221fde[_0x13acd8(0x217)]=_0x2af014,_0x221fde[_0x13acd8(0x23f)]=_0x1d6b53,_0x221fde['receivable']=_0x285a80,_0x221fde[_0x13acd8(0x218)]=_0x3d56d4,_0x221fde['contactperson']=_0x2f7d34,_0x221fde['landline']=_0x35e969;const _0x3424dd=await _0x221fde[_0x13acd8(0x1fa)]();_0x1625b8[_0x13acd8(0x22e)](_0x13acd8(0x240),'customer\x20update\x20successfully'),_0x5aed43[_0x13acd8(0x210)](_0x13acd8(0x226));}catch(_0x2633b9){console['log'](_0x2633b9);}}),router[a0_0x412a6d(0x21d)]('/view/payment/:id',auth,async(_0x47fe78,_0x3cdc60)=>{const _0x2b3246=a0_0x412a6d;try{const {username:_0x3be0cd,email:_0x23d051,role:_0x3c484d}=_0x47fe78[_0x2b3246(0x23d)],_0x2b62e6=_0x47fe78[_0x2b3246(0x23d)],_0x5b8747=await profile['findOne']({'email':_0x2b62e6[_0x2b3246(0x23f)]}),_0x27921b=await master_shop[_0x2b3246(0x1dd)]();console[_0x2b3246(0x23c)](_0x2b3246(0x1e4),_0x27921b),console[_0x2b3246(0x23c)](_0x47fe78['params']['id']);const _0x3dd4b7=await customer[_0x2b3246(0x1f6)]({'_id':_0x47fe78[_0x2b3246(0x1da)]['id']});console[_0x2b3246(0x23c)](_0x2b3246(0x20e),_0x3dd4b7);const _0x5a2707=await c_payment_data[_0x2b3246(0x1dd)]({'customer':_0x3dd4b7[_0x2b3246(0x200)]});console['log'](_0x5a2707);const _0x36b32b=await c_payment_data[_0x2b3246(0x234)]([{'$match':{'customer':_0x3dd4b7[_0x2b3246(0x200)]}},{'$match':{'reason':_0x2b3246(0x202)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x2b3246(0x204)}}}]);console[_0x2b3246(0x23c)](_0x2b3246(0x221),_0x36b32b);const _0x31600d=await c_payment_data[_0x2b3246(0x234)]([{'$match':{'customer':_0x3dd4b7['name']}},{'$match':{'reason':_0x2b3246(0x1e8)}},{'$group':{'_id':_0x2b3246(0x1f5),'sum':{'$sum':_0x2b3246(0x204)}}}]);console[_0x2b3246(0x23c)](_0x2b3246(0x219),_0x31600d);if(_0x27921b[0x0][_0x2b3246(0x21c)]==_0x2b3246(0x1f1)){var _0x9e4a27=users[_0x2b3246(0x1e9)];console['log'](_0x9e4a27);}else{if(_0x27921b[0x0][_0x2b3246(0x21c)]==_0x2b3246(0x1ff))var _0x9e4a27=users[_0x2b3246(0x1ff)];else{if(_0x27921b[0x0]['language']==_0x2b3246(0x1f0))var _0x9e4a27=users['German'];else{if(_0x27921b[0x0][_0x2b3246(0x21c)]=='Spanish')var _0x9e4a27=users[_0x2b3246(0x1ed)];else{if(_0x27921b[0x0][_0x2b3246(0x21c)]==_0x2b3246(0x23e))var _0x9e4a27=users[_0x2b3246(0x23e)];else{if(_0x27921b[0x0][_0x2b3246(0x21c)]==_0x2b3246(0x1ec))var _0x9e4a27=users[_0x2b3246(0x1eb)];else{if(_0x27921b[0x0][_0x2b3246(0x21c)]==_0x2b3246(0x1de))var _0x9e4a27=users[_0x2b3246(0x1de)];else{if(_0x27921b[0x0][_0x2b3246(0x21c)]==_0x2b3246(0x22c))var _0x9e4a27=users[_0x2b3246(0x21e)];}}}}}}}_0x3cdc60[_0x2b3246(0x207)](_0x2b3246(0x1f7),{'success':_0x47fe78['flash']('success'),'errors':_0x47fe78[_0x2b3246(0x22e)](_0x2b3246(0x1f2)),'role':_0x2b62e6,'profile':_0x5b8747,'payment':_0x5a2707,'payable':_0x36b32b,'receivable':_0x31600d,'master_shop':_0x27921b,'language':_0x9e4a27});}catch(_0x5c5213){console[_0x2b3246(0x23c)](_0x5c5213);}}),router[a0_0x412a6d(0x21d)](a0_0x412a6d(0x23b),auth,async(_0x31f93e,_0x1cf4c5)=>{const _0x5486b2=a0_0x412a6d;try{const _0x424a7b=new excelJS['Workbook'](),_0x5d37ea=_0x424a7b[_0x5486b2(0x1e0)]('Customers');return _0x5d37ea[_0x5486b2(0x20d)]=[{'header':'ID','key':'PName','width':0xa},{'header':'Name','key':_0x5486b2(0x1e6),'width':0xa},{'header':_0x5486b2(0x232),'key':'PUnits','width':0xa},{'header':_0x5486b2(0x20a),'key':_0x5486b2(0x20a),'width':0xa},{'header':_0x5486b2(0x239),'key':'address','width':0xa},{'header':_0x5486b2(0x217),'key':_0x5486b2(0x217),'width':0xa},{'header':'email','key':_0x5486b2(0x23f),'width':0xa}],_0x1cf4c5[_0x5486b2(0x1f4)](_0x5486b2(0x20c),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x1cf4c5['setHeader']('Content-Disposition','attachment;\x20filename=customer_Migration_File.xlsx'),_0x424a7b[_0x5486b2(0x1e7)][_0x5486b2(0x1e3)](_0x1cf4c5)[_0x5486b2(0x216)](()=>{const _0x2acc37=_0x5486b2;_0x1cf4c5[_0x2acc37(0x1fd)](0xc8);});}catch(_0x23c6d0){_0x1cf4c5[_0x5486b2(0x1fd)](0x190)[_0x5486b2(0x228)]({'errors':_0x23c6d0['message']});}});function a0_0xe308(_0x1972f8,_0x2f43a3){const _0x575d3a=a0_0x575d();return a0_0xe308=function(_0xe3089d,_0x562beb){_0xe3089d=_0xe3089d-0x1da;let _0x2fb865=_0x575d3a[_0xe3089d];return _0x2fb865;},a0_0xe308(_0x1972f8,_0x2f43a3);}const storage1=multer[a0_0x412a6d(0x22f)]({'destination':(_0x5f1eea,_0x1bd5dd,_0x51c08e)=>{const _0x3f5061=a0_0x412a6d;_0x51c08e(null,_0x3f5061(0x230));},'filename':(_0x1b25a7,_0x13302a,_0x2fb54f)=>{const _0x56fd5f=a0_0x412a6d;_0x2fb54f(null,Date['now']()+_0x13302a[_0x56fd5f(0x211)]);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x412a6d(0x21f),auth,uploadMigrate[a0_0x412a6d(0x238)]('customer_product_fule'),async(_0x3cdbcb,_0x3a8eb4)=>{const _0x4999c7=a0_0x412a6d,_0x43cd12=_0x3cdbcb[_0x4999c7(0x1e2)][_0x4999c7(0x225)],_0x4bb957=await xlsx[_0x4999c7(0x1ef)](_0x4999c7(0x203)+_0x43cd12);let _0x4afaeb=_0x4bb957['SheetNames'],_0xa6aabd=xlsx[_0x4999c7(0x20b)][_0x4999c7(0x224)](_0x4bb957['Sheets'][_0x4afaeb[0x0]]);for(const _0x2caa8f of _0xa6aabd){const _0x203357=_0x2caa8f['ID'],_0x44a44c=_0x2caa8f[_0x4999c7(0x1fc)],_0x58631e=_0x2caa8f[_0x4999c7(0x232)],_0x4bec0f=_0x2caa8f[_0x4999c7(0x20a)],_0x24bb65=_0x2caa8f['address'],_0x51906c=_0x2caa8f['mobile'],_0x468691=_0x2caa8f['email'];try{let _0x5cda92=await customer[_0x4999c7(0x1f6)]({'name':_0x44a44c});if(!_0x5cda92){const _0x4e9000=new customer({'name':_0x44a44c,'ID':_0x203357,'SalesmanCode':_0x58631e,'SalesmanName':_0x4bec0f,'address':_0x24bb65,'mobile':_0x51906c,'email':_0x468691});_0x5cda92=await _0x4e9000[_0x4999c7(0x1fa)](),_0x3cdbcb[_0x4999c7(0x22e)](_0x4999c7(0x240),_0x44a44c+_0x4999c7(0x213));}else _0x3cdbcb['flash'](_0x4999c7(0x214),_0x44a44c+_0x4999c7(0x229));}catch(_0x4d41df){_0x3a8eb4[_0x4999c7(0x1fd)](0x1f4)[_0x4999c7(0x223)]({'proderror':_0x4d41df[_0x4999c7(0x22b)],'aproduct':ProductName});}}_0x3a8eb4[_0x4999c7(0x210)]('/customer/view');}),module[a0_0x412a6d(0x231)]=router;