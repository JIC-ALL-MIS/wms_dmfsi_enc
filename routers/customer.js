const a0_0x1e9e82=a0_0x36da;function a0_0x5661(){const _0x5edbd6=['name','attachment;\x20filename=customer_Migration_File.xlsx','../middleware/auth','966832wSojTO','then','language','landline','params','customer\x20add\x20successfully','customer','English','receivable_sum','originalname','post','3729620GiwvTC','filename','/customer_import_migrate_file','5394osJOZP','PBrands','now','../public/language/languages.json','Arabic','render','express','Arabic\x20(ae)','Hindi','../models/all_models','/view/:id','address','user','reason','c_payments','findById','4McaVuo','English\x20(US)','status','redirect','master','2604fvUcrw','/view','contactperson','amount','Spanish','Chinese','German','readFile','email','\x20Failed','Workbook','xlsx','4etzjIC','$amount','81akeRhI','Name','sale_return','customer_data','message','findOne','errors','setHeader','808821ixcJva','SalesmanCode','customer_product_fule','/view/payment/:id','body','Customers','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','customer_payment','SalesmanName','10571980XYitZF','$reason','send','mobile','PUnits','payable','Portuguese\x20(BR)','sale','French','customer_docs','element','aggregate','payment_data','Sale','public/Migration/','12292522ZSIVRo','error','217729MUplQI','log','find','Sale\x20Return','diskStorage','multer','forEach','Content-Disposition','utils','Portuguese','get','success','/customer/view','flash','save','PName','customer\x20update\x20successfully'];a0_0x5661=function(){return _0x5edbd6;};return a0_0x5661();}(function(_0x26c97d,_0x244f9d){const _0x4ec348=a0_0x36da,_0xc8cdcb=_0x26c97d();while(!![]){try{const _0x3ffd68=parseInt(_0x4ec348(0x15f))/0x1*(-parseInt(_0x4ec348(0x13b))/0x2)+-parseInt(_0x4ec348(0x145))/0x3+-parseInt(_0x4ec348(0x191))/0x4*(-parseInt(_0x4ec348(0x17e))/0x5)+-parseInt(_0x4ec348(0x181))/0x6*(parseInt(_0x4ec348(0x196))/0x7)+parseInt(_0x4ec348(0x173))/0x8*(parseInt(_0x4ec348(0x13d))/0x9)+-parseInt(_0x4ec348(0x14e))/0xa+parseInt(_0x4ec348(0x15d))/0xb;if(_0x3ffd68===_0x244f9d)break;else _0xc8cdcb['push'](_0xc8cdcb['shift']());}catch(_0x5d1c37){_0xc8cdcb['push'](_0xc8cdcb['shift']());}}}(a0_0x5661,0xd0995));const express=require(a0_0x1e9e82(0x187)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x1e9e82(0x18a)),auth=require(a0_0x1e9e82(0x172)),users=require(a0_0x1e9e82(0x184)),excelJS=require('exceljs'),xlsx=require(a0_0x1e9e82(0x13a)),multer=require(a0_0x1e9e82(0x164));router[a0_0x1e9e82(0x169)]('/view',auth,async(_0x47c40d,_0x6835e2)=>{const _0x35b53c=a0_0x1e9e82;try{const {username:_0x52ae19,email:_0x8c8b38,role:_0x2b3215}=_0x47c40d[_0x35b53c(0x18d)],_0x2b2b14=_0x47c40d[_0x35b53c(0x18d)],_0x33dcaa=await profile[_0x35b53c(0x142)]({'email':_0x2b2b14['email']}),_0x1a9c40=await master_shop['find']();console[_0x35b53c(0x160)](_0x35b53c(0x195),_0x1a9c40);const _0x1c7094=await customer[_0x35b53c(0x161)](),_0x1a814e=await customer[_0x35b53c(0x159)]([{'$lookup':{'from':_0x35b53c(0x18f),'localField':_0x35b53c(0x170),'foreignField':_0x35b53c(0x179),'as':_0x35b53c(0x157)}}]);console[_0x35b53c(0x160)](_0x1a814e);const _0x4ae8ca=_0x1a814e['map'](_0x260f2c=>{const _0x4c9f4e=_0x35b53c;console[_0x4c9f4e(0x160)]('data',_0x260f2c);var _0x54f87c=0x0,_0x226416=0x0;return _0x260f2c[_0x4c9f4e(0x157)][_0x4c9f4e(0x165)](_0x57d182=>{const _0x5780f4=_0x4c9f4e;console[_0x5780f4(0x160)](_0x5780f4(0x158),_0x57d182),_0x57d182[_0x5780f4(0x18e)]=='Sale'?_0x54f87c+=_0x57d182['amount']:_0x226416+=_0x57d182[_0x5780f4(0x199)];}),_0x260f2c[_0x4c9f4e(0x155)]=parseFloat(_0x54f87c)+0x0,_0x260f2c[_0x4c9f4e(0x13f)]=parseFloat(_0x226416)+0x0,_0x260f2c;});console[_0x35b53c(0x160)](_0x35b53c(0x15a),_0x4ae8ca);if(_0x1a9c40[0x0]['language']==_0x35b53c(0x192)){var _0xb2a443=users[_0x35b53c(0x17a)];console['log'](_0xb2a443);}else{if(_0x1a9c40[0x0][_0x35b53c(0x175)]==_0x35b53c(0x189))var _0xb2a443=users[_0x35b53c(0x189)];else{if(_0x1a9c40[0x0][_0x35b53c(0x175)]==_0x35b53c(0x19c))var _0xb2a443=users[_0x35b53c(0x19c)];else{if(_0x1a9c40[0x0][_0x35b53c(0x175)]==_0x35b53c(0x19a))var _0xb2a443=users[_0x35b53c(0x19a)];else{if(_0x1a9c40[0x0]['language']==_0x35b53c(0x156))var _0xb2a443=users['French'];else{if(_0x1a9c40[0x0][_0x35b53c(0x175)]=='Portuguese\x20(BR)')var _0xb2a443=users['Portuguese'];else{if(_0x1a9c40[0x0][_0x35b53c(0x175)]=='Chinese')var _0xb2a443=users[_0x35b53c(0x19b)];else{if(_0x1a9c40[0x0][_0x35b53c(0x175)]==_0x35b53c(0x188))var _0xb2a443=users[_0x35b53c(0x185)];}}}}}}}_0x6835e2[_0x35b53c(0x186)](_0x35b53c(0x179),{'success':_0x47c40d[_0x35b53c(0x16c)]('success'),'errors':_0x47c40d[_0x35b53c(0x16c)](_0x35b53c(0x143)),'user':_0x1c7094,'role':_0x2b2b14,'profile':_0x33dcaa,'payment':_0x4ae8ca,'master_shop':_0x1a9c40,'language':_0xb2a443});}catch(_0x61588c){console[_0x35b53c(0x160)](_0x61588c);}}),router['post'](a0_0x1e9e82(0x197),auth,async(_0x5e5cb0,_0x42412b)=>{const _0x116654=a0_0x1e9e82;try{const {name:_0xe63e70,address:_0x15af1a,mobile:_0x4b66c9,email:_0x3a7db3,receivable:_0x3d257c,payable:_0x13bce0,contactperson:_0x5dba8d,landline:_0x27b32c}=_0x5e5cb0[_0x116654(0x149)],_0x41f86c=new customer({'name':_0xe63e70,'address':_0x15af1a,'mobile':_0x4b66c9,'email':_0x3a7db3,'receivable':_0x3d257c,'payable':_0x13bce0,'contactperson':_0x5dba8d,'landline':_0x27b32c}),_0x5b6573=await _0x41f86c[_0x116654(0x16d)]();_0x5e5cb0[_0x116654(0x16c)](_0x116654(0x16a),_0x116654(0x178)),_0x42412b[_0x116654(0x194)](_0x116654(0x16b));}catch(_0x392c2a){console[_0x116654(0x160)](_0x392c2a);}}),router[a0_0x1e9e82(0x169)](a0_0x1e9e82(0x18b),auth,async(_0x56fd1e,_0x285209)=>{const _0x49c2c1=a0_0x1e9e82;try{const {username:_0x1671f5,email:_0x3ec192,role:_0x313e11}=_0x56fd1e[_0x49c2c1(0x18d)],_0xba1483=_0x56fd1e[_0x49c2c1(0x18d)],_0x49b463=await profile[_0x49c2c1(0x142)]({'email':_0xba1483['email']}),_0x4f675f=await master_shop[_0x49c2c1(0x161)]();console[_0x49c2c1(0x160)](_0x49c2c1(0x195),_0x4f675f);const _0x156820=_0x56fd1e[_0x49c2c1(0x177)]['id'],_0x331d65=await customer[_0x49c2c1(0x190)](_0x156820);if(_0x4f675f[0x0][_0x49c2c1(0x175)]==_0x49c2c1(0x192)){var _0x40febf=users[_0x49c2c1(0x17a)];console[_0x49c2c1(0x160)](_0x40febf);}else{if(_0x4f675f[0x0][_0x49c2c1(0x175)]==_0x49c2c1(0x189))var _0x40febf=users[_0x49c2c1(0x189)];else{if(_0x4f675f[0x0]['language']=='German')var _0x40febf=users[_0x49c2c1(0x19c)];else{if(_0x4f675f[0x0]['language']==_0x49c2c1(0x19a))var _0x40febf=users[_0x49c2c1(0x19a)];else{if(_0x4f675f[0x0]['language']==_0x49c2c1(0x156))var _0x40febf=users[_0x49c2c1(0x156)];else{if(_0x4f675f[0x0][_0x49c2c1(0x175)]=='Portuguese\x20(BR)')var _0x40febf=users['Portuguese'];else{if(_0x4f675f[0x0]['language']==_0x49c2c1(0x19b))var _0x40febf=users[_0x49c2c1(0x19b)];else{if(_0x4f675f[0x0][_0x49c2c1(0x175)]=='Arabic\x20(ae)')var _0x40febf=users['Arabic'];}}}}}}}_0x285209[_0x49c2c1(0x186)]('customer',{'success':_0x56fd1e[_0x49c2c1(0x16c)]('success'),'errors':_0x56fd1e['flash']('errors'),'role':_0xba1483,'profile':_0x49b463,'user':_0x331d65,'master_shop':_0x4f675f,'language':_0x40febf});}catch(_0x992724){console[_0x49c2c1(0x160)](_0x992724);}}),router[a0_0x1e9e82(0x17d)]('/view/:id',auth,async(_0xa8a12a,_0x369d90)=>{const _0x1fd4fd=a0_0x1e9e82;try{const _0xe0282=_0xa8a12a[_0x1fd4fd(0x177)]['id'],_0x5aeda2=await customer[_0x1fd4fd(0x190)](_0xe0282),{name:_0x133201,address:_0xd33ea5,mobile:_0x3109c2,email:_0x53ac28,receivable:_0x13a0c1,payable:_0x1e6324,contactperson:_0x4e210a,landline:_0x32b59f}=_0xa8a12a[_0x1fd4fd(0x149)];_0x5aeda2[_0x1fd4fd(0x170)]=_0x133201,_0x5aeda2['address']=_0xd33ea5,_0x5aeda2[_0x1fd4fd(0x151)]=_0x3109c2,_0x5aeda2[_0x1fd4fd(0x137)]=_0x53ac28,_0x5aeda2['receivable']=_0x13a0c1,_0x5aeda2[_0x1fd4fd(0x153)]=_0x1e6324,_0x5aeda2[_0x1fd4fd(0x198)]=_0x4e210a,_0x5aeda2[_0x1fd4fd(0x176)]=_0x32b59f;const _0x3f9247=await _0x5aeda2['save']();_0xa8a12a[_0x1fd4fd(0x16c)]('success',_0x1fd4fd(0x16f)),_0x369d90[_0x1fd4fd(0x194)](_0x1fd4fd(0x16b));}catch(_0x4fdc1a){console['log'](_0x4fdc1a);}}),router[a0_0x1e9e82(0x169)](a0_0x1e9e82(0x148),auth,async(_0x51a8cb,_0xcc16ee)=>{const _0x5a44a7=a0_0x1e9e82;try{const {username:_0x34aae2,email:_0x31ebf6,role:_0x1cb131}=_0x51a8cb[_0x5a44a7(0x18d)],_0x161cbc=_0x51a8cb[_0x5a44a7(0x18d)],_0x5adb6b=await profile[_0x5a44a7(0x142)]({'email':_0x161cbc[_0x5a44a7(0x137)]}),_0x2a10a2=await master_shop['find']();console[_0x5a44a7(0x160)](_0x5a44a7(0x195),_0x2a10a2),console[_0x5a44a7(0x160)](_0x51a8cb[_0x5a44a7(0x177)]['id']);const _0x52ea4c=await customer[_0x5a44a7(0x142)]({'_id':_0x51a8cb[_0x5a44a7(0x177)]['id']});console[_0x5a44a7(0x160)](_0x5a44a7(0x140),_0x52ea4c);const _0x444854=await c_payment_data['find']({'customer':_0x52ea4c[_0x5a44a7(0x170)]});console[_0x5a44a7(0x160)](_0x444854);const _0x567bb5=await c_payment_data['aggregate']([{'$match':{'customer':_0x52ea4c[_0x5a44a7(0x170)]}},{'$match':{'reason':_0x5a44a7(0x15b)}},{'$group':{'_id':_0x5a44a7(0x14f),'sum':{'$sum':_0x5a44a7(0x13c)}}}]);console['log']('payable_sum',_0x567bb5);const _0x53331b=await c_payment_data['aggregate']([{'$match':{'customer':_0x52ea4c[_0x5a44a7(0x170)]}},{'$match':{'reason':_0x5a44a7(0x162)}},{'$group':{'_id':_0x5a44a7(0x14f),'sum':{'$sum':_0x5a44a7(0x13c)}}}]);console[_0x5a44a7(0x160)](_0x5a44a7(0x17b),_0x53331b);if(_0x2a10a2[0x0][_0x5a44a7(0x175)]==_0x5a44a7(0x192)){var _0x3dbd27=users[_0x5a44a7(0x17a)];console[_0x5a44a7(0x160)](_0x3dbd27);}else{if(_0x2a10a2[0x0][_0x5a44a7(0x175)]==_0x5a44a7(0x189))var _0x3dbd27=users[_0x5a44a7(0x189)];else{if(_0x2a10a2[0x0][_0x5a44a7(0x175)]==_0x5a44a7(0x19c))var _0x3dbd27=users[_0x5a44a7(0x19c)];else{if(_0x2a10a2[0x0][_0x5a44a7(0x175)]==_0x5a44a7(0x19a))var _0x3dbd27=users[_0x5a44a7(0x19a)];else{if(_0x2a10a2[0x0]['language']==_0x5a44a7(0x156))var _0x3dbd27=users['French'];else{if(_0x2a10a2[0x0][_0x5a44a7(0x175)]==_0x5a44a7(0x154))var _0x3dbd27=users[_0x5a44a7(0x168)];else{if(_0x2a10a2[0x0][_0x5a44a7(0x175)]==_0x5a44a7(0x19b))var _0x3dbd27=users['Chinese'];else{if(_0x2a10a2[0x0][_0x5a44a7(0x175)]==_0x5a44a7(0x188))var _0x3dbd27=users[_0x5a44a7(0x185)];}}}}}}}_0xcc16ee[_0x5a44a7(0x186)](_0x5a44a7(0x14c),{'success':_0x51a8cb[_0x5a44a7(0x16c)](_0x5a44a7(0x16a)),'errors':_0x51a8cb[_0x5a44a7(0x16c)](_0x5a44a7(0x143)),'role':_0x161cbc,'profile':_0x5adb6b,'payment':_0x444854,'payable':_0x567bb5,'receivable':_0x53331b,'master_shop':_0x2a10a2,'language':_0x3dbd27});}catch(_0x4ecbe8){console[_0x5a44a7(0x160)](_0x4ecbe8);}}),router[a0_0x1e9e82(0x169)]('/products_export_migrate_file',auth,async(_0x3ce74f,_0x1d2d23)=>{const _0x17e92e=a0_0x1e9e82;try{const _0x55975a=new excelJS[(_0x17e92e(0x139))](),_0x29fe56=_0x55975a['addWorksheet'](_0x17e92e(0x14a));return _0x29fe56['columns']=[{'header':'ID','key':_0x17e92e(0x16e),'width':0xa},{'header':_0x17e92e(0x13e),'key':_0x17e92e(0x182),'width':0xa},{'header':_0x17e92e(0x146),'key':_0x17e92e(0x152),'width':0xa},{'header':_0x17e92e(0x14d),'key':_0x17e92e(0x14d),'width':0xa},{'header':'address','key':_0x17e92e(0x18c),'width':0xa},{'header':'mobile','key':_0x17e92e(0x151),'width':0xa},{'header':'email','key':_0x17e92e(0x137),'width':0xa}],_0x1d2d23[_0x17e92e(0x144)]('Content-Type',_0x17e92e(0x14b)),_0x1d2d23[_0x17e92e(0x144)](_0x17e92e(0x166),_0x17e92e(0x171)),_0x55975a[_0x17e92e(0x13a)]['write'](_0x1d2d23)[_0x17e92e(0x174)](()=>{const _0x3ca4d8=_0x17e92e;_0x1d2d23[_0x3ca4d8(0x193)](0xc8);});}catch(_0x251d51){_0x1d2d23[_0x17e92e(0x193)](0x190)[_0x17e92e(0x150)]({'errors':_0x251d51[_0x17e92e(0x141)]});}});const storage1=multer[a0_0x1e9e82(0x163)]({'destination':(_0x554b65,_0x116602,_0x2d9425)=>{_0x2d9425(null,'public/Migration');},'filename':(_0x95830a,_0x5ed94d,_0x44779d)=>{const _0x441a64=a0_0x1e9e82;_0x44779d(null,Date[_0x441a64(0x183)]()+_0x5ed94d[_0x441a64(0x17c)]);}}),uploadMigrate=multer({'storage':storage1});function a0_0x36da(_0xbb0e21,_0x5ae920){const _0x566191=a0_0x5661();return a0_0x36da=function(_0x36da4b,_0x404be1){_0x36da4b=_0x36da4b-0x136;let _0xc5f894=_0x566191[_0x36da4b];return _0xc5f894;},a0_0x36da(_0xbb0e21,_0x5ae920);}router['post'](a0_0x1e9e82(0x180),auth,uploadMigrate['single'](a0_0x1e9e82(0x147)),async(_0x5b9bea,_0x5a9d41)=>{const _0x48310b=a0_0x1e9e82,_0x4ddd04=_0x5b9bea['file'][_0x48310b(0x17f)],_0x2384a9=await xlsx[_0x48310b(0x136)](_0x48310b(0x15c)+_0x4ddd04);let _0x4be842=_0x2384a9['SheetNames'],_0x117636=xlsx[_0x48310b(0x167)]['sheet_to_json'](_0x2384a9['Sheets'][_0x4be842[0x0]]);for(const _0x34adf9 of _0x117636){const _0x54f25c=_0x34adf9['ID'],_0x34ecf9=_0x34adf9[_0x48310b(0x13e)],_0x2c27b0=_0x34adf9['SalesmanCode'],_0x548c55=_0x34adf9[_0x48310b(0x14d)],_0x1b8da4=_0x34adf9[_0x48310b(0x18c)],_0x3072a8=_0x34adf9[_0x48310b(0x151)],_0x296022=_0x34adf9['email'];try{let _0x114900=await customer['findOne']({'name':_0x34ecf9});if(!_0x114900){const _0x3b9eff=new customer({'name':_0x34ecf9,'ID':_0x54f25c,'SalesmanCode':_0x2c27b0,'SalesmanName':_0x548c55,'address':_0x1b8da4,'mobile':_0x3072a8,'email':_0x296022});_0x114900=await _0x3b9eff[_0x48310b(0x16d)](),_0x5b9bea[_0x48310b(0x16c)](_0x48310b(0x16a),_0x34ecf9+'\x20added\x20successfully');}else _0x5b9bea[_0x48310b(0x16c)](_0x48310b(0x15e),_0x34ecf9+_0x48310b(0x138));}catch(_0x261006){_0x5a9d41['status'](0x1f4)['json']({'proderror':_0x261006[_0x48310b(0x141)],'aproduct':ProductName});}}_0x5a9d41[_0x48310b(0x194)](_0x48310b(0x16b));}),module['exports']=router;