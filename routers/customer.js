const a0_0x4e5e00=a0_0x4533;function a0_0x3220(){const _0x1229f5=['master','columns','English\x20(US)','24321FrlnRS','receivable_sum','/products_export_migrate_file','German','/customer/view','customer_docs','SheetNames','amount','535008qvnEpf','4454080epnQUJ','Spanish','log','message','reason','Router','sale_return','name','find','Content-Disposition','exceljs','originalname','setHeader','mobile','Customers','findOne','Sheets','English','params','18nvGfne','error','PBrands','email','Sale\x20Return','xlsx','status','json','Arabic','/view','element','errors','save','language','1616MTZtph','PName','single','../middleware/auth','\x20added\x20successfully','27050NwZUeX','aggregate','customer\x20add\x20successfully','15390SjpCdp','get','../models/all_models','/customer_import_migrate_file','attachment;\x20filename=customer_Migration_File.xlsx','../public/language/languages.json','multer','$amount','public/Migration/','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','user','send','Portuguese','forEach','then','payable','SalesmanCode','express','map','30QONwbj','Portuguese\x20(BR)','customer_data','$reason','filename','addWorksheet','Content-Type','/view/:id','188252uEMZvh','exports','findById','Name','success','Arabic\x20(ae)','French','diskStorage','PUnits','SalesmanName','484400GgDlno','Hindi','public/Migration','address','render','\x20Failed','redirect','payment_data','flash','data','Chinese','post','c_payments','readFile','Sale','customer'];a0_0x3220=function(){return _0x1229f5;};return a0_0x3220();}function a0_0x4533(_0xc1b971,_0x234a40){const _0x32202a=a0_0x3220();return a0_0x4533=function(_0x45333f,_0x4993e9){_0x45333f=_0x45333f-0x12f;let _0x7fd29f=_0x32202a[_0x45333f];return _0x7fd29f;},a0_0x4533(_0xc1b971,_0x234a40);}(function(_0x11fcc8,_0x1be61b){const _0x2bb497=a0_0x4533,_0x5d274b=_0x11fcc8();while(!![]){try{const _0x11c3c9=parseInt(_0x2bb497(0x16b))/0x1+-parseInt(_0x2bb497(0x163))/0x2*(parseInt(_0x2bb497(0x188))/0x3)+parseInt(_0x2bb497(0x190))/0x4+parseInt(_0x2bb497(0x14d))/0x5*(parseInt(_0x2bb497(0x13a))/0x6)+parseInt(_0x2bb497(0x175))/0x7+-parseInt(_0x2bb497(0x148))/0x8*(-parseInt(_0x2bb497(0x150))/0x9)+-parseInt(_0x2bb497(0x191))/0xa;if(_0x11c3c9===_0x1be61b)break;else _0x5d274b['push'](_0x5d274b['shift']());}catch(_0x3c13af){_0x5d274b['push'](_0x5d274b['shift']());}}}(a0_0x3220,0x2d5f1));const express=require(a0_0x4e5e00(0x161)),app=express(),router=express[a0_0x4e5e00(0x196)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x4e5e00(0x152)),auth=require(a0_0x4e5e00(0x14b)),users=require(a0_0x4e5e00(0x155)),excelJS=require(a0_0x4e5e00(0x131)),xlsx=require(a0_0x4e5e00(0x13f)),multer=require(a0_0x4e5e00(0x156));router[a0_0x4e5e00(0x151)](a0_0x4e5e00(0x143),auth,async(_0x1e09fd,_0x21bd1a)=>{const _0x1f5ec9=a0_0x4e5e00;try{const {username:_0x507657,email:_0x18913a,role:_0x551fec}=_0x1e09fd[_0x1f5ec9(0x15a)],_0x48e10f=_0x1e09fd[_0x1f5ec9(0x15a)],_0x1e81c5=await profile['findOne']({'email':_0x48e10f[_0x1f5ec9(0x13d)]}),_0x24ed0d=await master_shop[_0x1f5ec9(0x12f)]();console['log']('master',_0x24ed0d);const _0xb40b13=await customer[_0x1f5ec9(0x12f)](),_0x2eaa1e=await customer[_0x1f5ec9(0x14e)]([{'$lookup':{'from':_0x1f5ec9(0x181),'localField':_0x1f5ec9(0x198),'foreignField':_0x1f5ec9(0x184),'as':_0x1f5ec9(0x18d)}}]);console['log'](_0x2eaa1e);const _0x307cc7=_0x2eaa1e[_0x1f5ec9(0x162)](_0xf1c82d=>{const _0x491af0=_0x1f5ec9;console['log'](_0x491af0(0x17e),_0xf1c82d);var _0x337412=0x0,_0x5568d2=0x0;return _0xf1c82d[_0x491af0(0x18d)][_0x491af0(0x15d)](_0x3fe2de=>{const _0x8170d4=_0x491af0;console[_0x8170d4(0x193)](_0x8170d4(0x144),_0x3fe2de),_0x3fe2de[_0x8170d4(0x195)]==_0x8170d4(0x183)?_0x337412+=_0x3fe2de['amount']:_0x5568d2+=_0x3fe2de[_0x8170d4(0x18f)];}),_0xf1c82d['sale']=parseFloat(_0x337412)+0x0,_0xf1c82d[_0x491af0(0x197)]=parseFloat(_0x5568d2)+0x0,_0xf1c82d;});console['log'](_0x1f5ec9(0x17c),_0x307cc7);if(_0x24ed0d[0x0]['language']==_0x1f5ec9(0x187)){var _0x188734=users['English'];console['log'](_0x188734);}else{if(_0x24ed0d[0x0][_0x1f5ec9(0x147)]==_0x1f5ec9(0x176))var _0x188734=users[_0x1f5ec9(0x176)];else{if(_0x24ed0d[0x0][_0x1f5ec9(0x147)]==_0x1f5ec9(0x18b))var _0x188734=users[_0x1f5ec9(0x18b)];else{if(_0x24ed0d[0x0][_0x1f5ec9(0x147)]==_0x1f5ec9(0x192))var _0x188734=users[_0x1f5ec9(0x192)];else{if(_0x24ed0d[0x0][_0x1f5ec9(0x147)]==_0x1f5ec9(0x171))var _0x188734=users[_0x1f5ec9(0x171)];else{if(_0x24ed0d[0x0][_0x1f5ec9(0x147)]==_0x1f5ec9(0x164))var _0x188734=users[_0x1f5ec9(0x15c)];else{if(_0x24ed0d[0x0]['language']==_0x1f5ec9(0x17f))var _0x188734=users[_0x1f5ec9(0x17f)];else{if(_0x24ed0d[0x0][_0x1f5ec9(0x147)]==_0x1f5ec9(0x170))var _0x188734=users[_0x1f5ec9(0x142)];}}}}}}}_0x21bd1a[_0x1f5ec9(0x179)](_0x1f5ec9(0x184),{'success':_0x1e09fd[_0x1f5ec9(0x17d)](_0x1f5ec9(0x16f)),'errors':_0x1e09fd[_0x1f5ec9(0x17d)]('errors'),'user':_0xb40b13,'role':_0x48e10f,'profile':_0x1e81c5,'payment':_0x307cc7,'master_shop':_0x24ed0d,'language':_0x188734});}catch(_0x541c1a){console[_0x1f5ec9(0x193)](_0x541c1a);}}),router[a0_0x4e5e00(0x180)](a0_0x4e5e00(0x143),auth,async(_0x229886,_0x4ce079)=>{const _0x4b464e=a0_0x4e5e00;try{const {name:_0x13c1a6,address:_0x16199a,mobile:_0x2653bd,email:_0x8bfb39,receivable:_0x1c9789,payable:_0x5c967a,contactperson:_0x12a978,landline:_0x123d3f}=_0x229886['body'],_0x39da97=new customer({'name':_0x13c1a6,'address':_0x16199a,'mobile':_0x2653bd,'email':_0x8bfb39,'receivable':_0x1c9789,'payable':_0x5c967a,'contactperson':_0x12a978,'landline':_0x123d3f}),_0x2f1ceb=await _0x39da97['save']();_0x229886[_0x4b464e(0x17d)](_0x4b464e(0x16f),_0x4b464e(0x14f)),_0x4ce079[_0x4b464e(0x17b)](_0x4b464e(0x18c));}catch(_0x18933d){console[_0x4b464e(0x193)](_0x18933d);}}),router['get'](a0_0x4e5e00(0x16a),auth,async(_0x2073f8,_0x32955b)=>{const _0x5102d2=a0_0x4e5e00;try{const {username:_0x52cd22,email:_0x424d5e,role:_0x2c876f}=_0x2073f8[_0x5102d2(0x15a)],_0x1beee7=_0x2073f8[_0x5102d2(0x15a)],_0x48021e=await profile[_0x5102d2(0x136)]({'email':_0x1beee7[_0x5102d2(0x13d)]}),_0x16e36f=await master_shop[_0x5102d2(0x12f)]();console[_0x5102d2(0x193)](_0x5102d2(0x185),_0x16e36f);const _0x142d25=_0x2073f8[_0x5102d2(0x139)]['id'],_0x2f292b=await customer['findById'](_0x142d25);if(_0x16e36f[0x0][_0x5102d2(0x147)]==_0x5102d2(0x187)){var _0x14f32d=users[_0x5102d2(0x138)];console[_0x5102d2(0x193)](_0x14f32d);}else{if(_0x16e36f[0x0][_0x5102d2(0x147)]==_0x5102d2(0x176))var _0x14f32d=users[_0x5102d2(0x176)];else{if(_0x16e36f[0x0]['language']=='German')var _0x14f32d=users[_0x5102d2(0x18b)];else{if(_0x16e36f[0x0]['language']==_0x5102d2(0x192))var _0x14f32d=users[_0x5102d2(0x192)];else{if(_0x16e36f[0x0]['language']==_0x5102d2(0x171))var _0x14f32d=users[_0x5102d2(0x171)];else{if(_0x16e36f[0x0][_0x5102d2(0x147)]=='Portuguese\x20(BR)')var _0x14f32d=users[_0x5102d2(0x15c)];else{if(_0x16e36f[0x0][_0x5102d2(0x147)]=='Chinese')var _0x14f32d=users[_0x5102d2(0x17f)];else{if(_0x16e36f[0x0][_0x5102d2(0x147)]==_0x5102d2(0x170))var _0x14f32d=users['Arabic'];}}}}}}}_0x32955b[_0x5102d2(0x179)](_0x5102d2(0x184),{'success':_0x2073f8[_0x5102d2(0x17d)](_0x5102d2(0x16f)),'errors':_0x2073f8['flash']('errors'),'role':_0x1beee7,'profile':_0x48021e,'user':_0x2f292b,'master_shop':_0x16e36f,'language':_0x14f32d});}catch(_0x24f9dc){console[_0x5102d2(0x193)](_0x24f9dc);}}),router['post'](a0_0x4e5e00(0x16a),auth,async(_0x36d765,_0x26c2b7)=>{const _0x2cf897=a0_0x4e5e00;try{const _0x151cb6=_0x36d765[_0x2cf897(0x139)]['id'],_0x244c41=await customer[_0x2cf897(0x16d)](_0x151cb6),{name:_0x8b9088,address:_0x3e671d,mobile:_0x5bd43b,email:_0x46235d,receivable:_0x3bc1a1,payable:_0x5ad2f6,contactperson:_0x4ab3da,landline:_0x4462ba}=_0x36d765['body'];_0x244c41['name']=_0x8b9088,_0x244c41[_0x2cf897(0x178)]=_0x3e671d,_0x244c41[_0x2cf897(0x134)]=_0x5bd43b,_0x244c41[_0x2cf897(0x13d)]=_0x46235d,_0x244c41['receivable']=_0x3bc1a1,_0x244c41[_0x2cf897(0x15f)]=_0x5ad2f6,_0x244c41['contactperson']=_0x4ab3da,_0x244c41['landline']=_0x4462ba;const _0x1bf822=await _0x244c41[_0x2cf897(0x146)]();_0x36d765[_0x2cf897(0x17d)]('success','customer\x20update\x20successfully'),_0x26c2b7['redirect']('/customer/view');}catch(_0x372eb5){console['log'](_0x372eb5);}}),router['get']('/view/payment/:id',auth,async(_0x4410c5,_0x44ee0c)=>{const _0x30f3c8=a0_0x4e5e00;try{const {username:_0x258dcd,email:_0x3f30b1,role:_0x4e1bae}=_0x4410c5[_0x30f3c8(0x15a)],_0x509b7a=_0x4410c5[_0x30f3c8(0x15a)],_0x2df761=await profile[_0x30f3c8(0x136)]({'email':_0x509b7a[_0x30f3c8(0x13d)]}),_0x530690=await master_shop[_0x30f3c8(0x12f)]();console[_0x30f3c8(0x193)]('master',_0x530690),console['log'](_0x4410c5[_0x30f3c8(0x139)]['id']);const _0x50c8bd=await customer[_0x30f3c8(0x136)]({'_id':_0x4410c5['params']['id']});console['log'](_0x30f3c8(0x165),_0x50c8bd);const _0x3df847=await c_payment_data[_0x30f3c8(0x12f)]({'customer':_0x50c8bd['name']});console[_0x30f3c8(0x193)](_0x3df847);const _0xaa5234=await c_payment_data['aggregate']([{'$match':{'customer':_0x50c8bd['name']}},{'$match':{'reason':_0x30f3c8(0x183)}},{'$group':{'_id':_0x30f3c8(0x166),'sum':{'$sum':_0x30f3c8(0x157)}}}]);console[_0x30f3c8(0x193)]('payable_sum',_0xaa5234);const _0x283d8c=await c_payment_data[_0x30f3c8(0x14e)]([{'$match':{'customer':_0x50c8bd[_0x30f3c8(0x198)]}},{'$match':{'reason':_0x30f3c8(0x13e)}},{'$group':{'_id':_0x30f3c8(0x166),'sum':{'$sum':_0x30f3c8(0x157)}}}]);console[_0x30f3c8(0x193)](_0x30f3c8(0x189),_0x283d8c);if(_0x530690[0x0][_0x30f3c8(0x147)]==_0x30f3c8(0x187)){var _0x5a8fc5=users[_0x30f3c8(0x138)];console[_0x30f3c8(0x193)](_0x5a8fc5);}else{if(_0x530690[0x0][_0x30f3c8(0x147)]==_0x30f3c8(0x176))var _0x5a8fc5=users['Hindi'];else{if(_0x530690[0x0][_0x30f3c8(0x147)]==_0x30f3c8(0x18b))var _0x5a8fc5=users['German'];else{if(_0x530690[0x0][_0x30f3c8(0x147)]==_0x30f3c8(0x192))var _0x5a8fc5=users[_0x30f3c8(0x192)];else{if(_0x530690[0x0]['language']==_0x30f3c8(0x171))var _0x5a8fc5=users[_0x30f3c8(0x171)];else{if(_0x530690[0x0][_0x30f3c8(0x147)]==_0x30f3c8(0x164))var _0x5a8fc5=users[_0x30f3c8(0x15c)];else{if(_0x530690[0x0]['language']==_0x30f3c8(0x17f))var _0x5a8fc5=users[_0x30f3c8(0x17f)];else{if(_0x530690[0x0][_0x30f3c8(0x147)]=='Arabic\x20(ae)')var _0x5a8fc5=users[_0x30f3c8(0x142)];}}}}}}}_0x44ee0c[_0x30f3c8(0x179)]('customer_payment',{'success':_0x4410c5[_0x30f3c8(0x17d)](_0x30f3c8(0x16f)),'errors':_0x4410c5[_0x30f3c8(0x17d)](_0x30f3c8(0x145)),'role':_0x509b7a,'profile':_0x2df761,'payment':_0x3df847,'payable':_0xaa5234,'receivable':_0x283d8c,'master_shop':_0x530690,'language':_0x5a8fc5});}catch(_0x1aaa60){console['log'](_0x1aaa60);}}),router['get'](a0_0x4e5e00(0x18a),auth,async(_0x2263b3,_0x29f28e)=>{const _0x3341a7=a0_0x4e5e00;try{const _0x447a58=new excelJS['Workbook'](),_0x42a01c=_0x447a58[_0x3341a7(0x168)](_0x3341a7(0x135));return _0x42a01c[_0x3341a7(0x186)]=[{'header':'ID','key':_0x3341a7(0x149),'width':0xa},{'header':_0x3341a7(0x16e),'key':_0x3341a7(0x13c),'width':0xa},{'header':_0x3341a7(0x160),'key':_0x3341a7(0x173),'width':0xa},{'header':_0x3341a7(0x174),'key':_0x3341a7(0x174),'width':0xa},{'header':'address','key':_0x3341a7(0x178),'width':0xa},{'header':_0x3341a7(0x134),'key':'mobile','width':0xa},{'header':_0x3341a7(0x13d),'key':_0x3341a7(0x13d),'width':0xa}],_0x29f28e[_0x3341a7(0x133)](_0x3341a7(0x169),_0x3341a7(0x159)),_0x29f28e[_0x3341a7(0x133)](_0x3341a7(0x130),_0x3341a7(0x154)),_0x447a58['xlsx']['write'](_0x29f28e)[_0x3341a7(0x15e)](()=>{const _0x1cc844=_0x3341a7;_0x29f28e[_0x1cc844(0x140)](0xc8);});}catch(_0x4bfe47){_0x29f28e[_0x3341a7(0x140)](0x190)[_0x3341a7(0x15b)]({'errors':_0x4bfe47[_0x3341a7(0x194)]});}});const storage1=multer[a0_0x4e5e00(0x172)]({'destination':(_0x7afde8,_0x581eec,_0x169aa1)=>{const _0x76d458=a0_0x4e5e00;_0x169aa1(null,_0x76d458(0x177));},'filename':(_0x2931d4,_0x2b587d,_0x52a8a3)=>{const _0x3f2e23=a0_0x4e5e00;_0x52a8a3(null,Date['now']()+_0x2b587d[_0x3f2e23(0x132)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x4e5e00(0x180)](a0_0x4e5e00(0x153),auth,uploadMigrate[a0_0x4e5e00(0x14a)]('customer_product_fule'),async(_0xa693c3,_0x556dff)=>{const _0xfc6e1b=a0_0x4e5e00,_0x356452=_0xa693c3['file'][_0xfc6e1b(0x167)],_0x1a9869=await xlsx[_0xfc6e1b(0x182)](_0xfc6e1b(0x158)+_0x356452);let _0x3c3a7d=_0x1a9869[_0xfc6e1b(0x18e)],_0x20395f=xlsx['utils']['sheet_to_json'](_0x1a9869[_0xfc6e1b(0x137)][_0x3c3a7d[0x0]]);for(const _0x192f76 of _0x20395f){const _0x40efc7=_0x192f76['ID'],_0x2b1eed=_0x192f76['Name'],_0x1b75bf=_0x192f76[_0xfc6e1b(0x160)],_0x31e1d8=_0x192f76[_0xfc6e1b(0x174)],_0x17797a=_0x192f76[_0xfc6e1b(0x178)],_0x1d3e14=_0x192f76[_0xfc6e1b(0x134)],_0x487fb3=_0x192f76[_0xfc6e1b(0x13d)];try{let _0x2bd1bb=await customer['findOne']({'name':_0x2b1eed});if(!_0x2bd1bb){const _0x6b57a=new customer({'name':_0x2b1eed,'ID':_0x40efc7,'SalesmanCode':_0x1b75bf,'SalesmanName':_0x31e1d8,'address':_0x17797a,'mobile':_0x1d3e14,'email':_0x487fb3});_0x2bd1bb=await _0x6b57a[_0xfc6e1b(0x146)](),_0xa693c3['flash'](_0xfc6e1b(0x16f),_0x2b1eed+_0xfc6e1b(0x14c));}else _0xa693c3['flash'](_0xfc6e1b(0x13b),_0x2b1eed+_0xfc6e1b(0x17a));}catch(_0x3dc9d1){_0x556dff['status'](0x1f4)[_0xfc6e1b(0x141)]({'proderror':_0x3dc9d1[_0xfc6e1b(0x194)],'aproduct':ProductName});}}_0x556dff[_0xfc6e1b(0x17b)](_0xfc6e1b(0x18c));}),module[a0_0x4e5e00(0x16c)]=router;