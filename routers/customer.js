const a0_0x41a200=a0_0x4a4c;function a0_0x3f43(){const _0x47cf37=['errors','columns','receivable_sum','../public/language/languages.json','landline','flash','customer_docs','Portuguese','attachment;\x20filename=customer_Migration_File.xlsx','exports','Hindi','customer\x20update\x20successfully','Chinese','Content-Disposition','PBrands','send','payment_data','Customers','filename','amount','Portuguese\x20(BR)','sale','SalesmanName','2338812psCliD','status','render','2034cddxbc','receivable','customer_product_fule','2474549haTTSt','params','customer_payment','306CIvvOn','master','SheetNames','7ZmFcvE','c_payments','findById','contactperson','element','email','public/Migration/','English\x20(US)','name','addWorksheet','German','464967YnlTEz','../middleware/auth','English','/view/payment/:id','originalname','/products_export_migrate_file','save','10AgYYhm','aggregate','multer','Arabic','log','Name','$reason','PName','json','get','French','payable','forEach','xlsx','customer','Sale','Content-Type','18SEqsZx','find','message','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','1917873LFQFnd','mobile','body','Router','Sale\x20Return','Sheets','/view','Spanish','\x20Failed','success','language','redirect','sheet_to_json','PUnits','single','exceljs','/customer/view','setHeader','899565OTlNkN','post','address','findOne','../models/all_models','user','Arabic\x20(ae)','file','write','public/Migration','4605736fUgXWT'];a0_0x3f43=function(){return _0x47cf37;};return a0_0x3f43();}(function(_0x1a27f5,_0x5694c3){const _0x3caa0f=a0_0x4a4c,_0x3e8abf=_0x1a27f5();while(!![]){try{const _0x26b0d5=parseInt(_0x3caa0f(0x175))/0x1+parseInt(_0x3caa0f(0x167))/0x2*(-parseInt(_0x3caa0f(0x161))/0x3)+parseInt(_0x3caa0f(0x15e))/0x4+parseInt(_0x3caa0f(0x1a3))/0x5*(-parseInt(_0x3caa0f(0x18d))/0x6)+parseInt(_0x3caa0f(0x16a))/0x7*(parseInt(_0x3caa0f(0x146))/0x8)+-parseInt(_0x3caa0f(0x191))/0x9+-parseInt(_0x3caa0f(0x17c))/0xa*(parseInt(_0x3caa0f(0x164))/0xb);if(_0x26b0d5===_0x5694c3)break;else _0x3e8abf['push'](_0x3e8abf['shift']());}catch(_0x16dfc5){_0x3e8abf['push'](_0x3e8abf['shift']());}}}(a0_0x3f43,0x84c72));const express=require('express'),app=express(),router=express[a0_0x41a200(0x194)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x41a200(0x1a7)),auth=require(a0_0x41a200(0x176)),users=require(a0_0x41a200(0x14a)),excelJS=require(a0_0x41a200(0x1a0)),xlsx=require('xlsx'),multer=require(a0_0x41a200(0x17e));function a0_0x4a4c(_0x484055,_0x35a538){const _0x3f43cf=a0_0x3f43();return a0_0x4a4c=function(_0x4a4c7f,_0x148d07){_0x4a4c7f=_0x4a4c7f-0x144;let _0x52b50a=_0x3f43cf[_0x4a4c7f];return _0x52b50a;},a0_0x4a4c(_0x484055,_0x35a538);}router[a0_0x41a200(0x185)](a0_0x41a200(0x197),auth,async(_0x5c94fb,_0xc0dd31)=>{const _0x20263b=a0_0x41a200;try{const {username:_0x12a33e,email:_0x74aef2,role:_0xc3177d}=_0x5c94fb['user'],_0x9a554e=_0x5c94fb[_0x20263b(0x1a8)],_0x2498f8=await profile[_0x20263b(0x1a6)]({'email':_0x9a554e[_0x20263b(0x16f)]}),_0xedabd0=await master_shop[_0x20263b(0x18e)]();console[_0x20263b(0x180)]('master',_0xedabd0);const _0x258219=await customer[_0x20263b(0x18e)](),_0x249010=await customer[_0x20263b(0x17d)]([{'$lookup':{'from':_0x20263b(0x16b),'localField':'name','foreignField':_0x20263b(0x18a),'as':'customer_docs'}}]);console[_0x20263b(0x180)](_0x249010);const _0xc1423f=_0x249010['map'](_0x21a636=>{const _0x5d7bff=_0x20263b;console[_0x5d7bff(0x180)]('data',_0x21a636);var _0x461e12=0x0,_0x3bdbc=0x0;return _0x21a636[_0x5d7bff(0x14d)][_0x5d7bff(0x188)](_0x466487=>{const _0x332292=_0x5d7bff;console[_0x332292(0x180)](_0x332292(0x16e),_0x466487),_0x466487['reason']==_0x332292(0x18b)?_0x461e12+=_0x466487[_0x332292(0x15a)]:_0x3bdbc+=_0x466487[_0x332292(0x15a)];}),_0x21a636[_0x5d7bff(0x15c)]=parseFloat(_0x461e12)+0x0,_0x21a636['sale_return']=parseFloat(_0x3bdbc)+0x0,_0x21a636;});console[_0x20263b(0x180)](_0x20263b(0x157),_0xc1423f);if(_0xedabd0[0x0]['language']==_0x20263b(0x171)){var _0x477b24=users[_0x20263b(0x177)];console[_0x20263b(0x180)](_0x477b24);}else{if(_0xedabd0[0x0][_0x20263b(0x19b)]==_0x20263b(0x151))var _0x477b24=users[_0x20263b(0x151)];else{if(_0xedabd0[0x0]['language']==_0x20263b(0x174))var _0x477b24=users[_0x20263b(0x174)];else{if(_0xedabd0[0x0][_0x20263b(0x19b)]==_0x20263b(0x198))var _0x477b24=users[_0x20263b(0x198)];else{if(_0xedabd0[0x0][_0x20263b(0x19b)]==_0x20263b(0x186))var _0x477b24=users[_0x20263b(0x186)];else{if(_0xedabd0[0x0][_0x20263b(0x19b)]==_0x20263b(0x15b))var _0x477b24=users[_0x20263b(0x14e)];else{if(_0xedabd0[0x0][_0x20263b(0x19b)]==_0x20263b(0x153))var _0x477b24=users['Chinese'];else{if(_0xedabd0[0x0]['language']=='Arabic\x20(ae)')var _0x477b24=users[_0x20263b(0x17f)];}}}}}}}_0xc0dd31[_0x20263b(0x160)](_0x20263b(0x18a),{'success':_0x5c94fb[_0x20263b(0x14c)](_0x20263b(0x19a)),'errors':_0x5c94fb[_0x20263b(0x14c)]('errors'),'user':_0x258219,'role':_0x9a554e,'profile':_0x2498f8,'payment':_0xc1423f,'master_shop':_0xedabd0,'language':_0x477b24});}catch(_0x1aea08){console[_0x20263b(0x180)](_0x1aea08);}}),router[a0_0x41a200(0x1a4)](a0_0x41a200(0x197),auth,async(_0x24d5cc,_0x21155d)=>{const _0x3995e1=a0_0x41a200;try{const {name:_0x240a38,address:_0x1b784b,mobile:_0x146aa2,email:_0x5eb4f8,receivable:_0x127cd0,payable:_0x428746,contactperson:_0x5d8cf,landline:_0x1a01ce}=_0x24d5cc[_0x3995e1(0x193)],_0x4c7995=new customer({'name':_0x240a38,'address':_0x1b784b,'mobile':_0x146aa2,'email':_0x5eb4f8,'receivable':_0x127cd0,'payable':_0x428746,'contactperson':_0x5d8cf,'landline':_0x1a01ce}),_0x928a2e=await _0x4c7995[_0x3995e1(0x17b)]();_0x24d5cc['flash'](_0x3995e1(0x19a),'customer\x20add\x20successfully'),_0x21155d['redirect'](_0x3995e1(0x1a1));}catch(_0x226115){console['log'](_0x226115);}}),router['get']('/view/:id',auth,async(_0x56cbcd,_0x3e18c5)=>{const _0xa26c60=a0_0x41a200;try{const {username:_0x1e5cc8,email:_0x124507,role:_0x52a865}=_0x56cbcd[_0xa26c60(0x1a8)],_0x29b768=_0x56cbcd['user'],_0x3d5d82=await profile[_0xa26c60(0x1a6)]({'email':_0x29b768[_0xa26c60(0x16f)]}),_0x555c0f=await master_shop[_0xa26c60(0x18e)]();console['log']('master',_0x555c0f);const _0x39627d=_0x56cbcd[_0xa26c60(0x165)]['id'],_0x58823f=await customer[_0xa26c60(0x16c)](_0x39627d);if(_0x555c0f[0x0][_0xa26c60(0x19b)]=='English\x20(US)'){var _0x1ababa=users[_0xa26c60(0x177)];console[_0xa26c60(0x180)](_0x1ababa);}else{if(_0x555c0f[0x0][_0xa26c60(0x19b)]==_0xa26c60(0x151))var _0x1ababa=users[_0xa26c60(0x151)];else{if(_0x555c0f[0x0]['language']==_0xa26c60(0x174))var _0x1ababa=users[_0xa26c60(0x174)];else{if(_0x555c0f[0x0]['language']=='Spanish')var _0x1ababa=users['Spanish'];else{if(_0x555c0f[0x0]['language']==_0xa26c60(0x186))var _0x1ababa=users[_0xa26c60(0x186)];else{if(_0x555c0f[0x0][_0xa26c60(0x19b)]=='Portuguese\x20(BR)')var _0x1ababa=users[_0xa26c60(0x14e)];else{if(_0x555c0f[0x0][_0xa26c60(0x19b)]==_0xa26c60(0x153))var _0x1ababa=users[_0xa26c60(0x153)];else{if(_0x555c0f[0x0]['language']==_0xa26c60(0x1a9))var _0x1ababa=users[_0xa26c60(0x17f)];}}}}}}}_0x3e18c5[_0xa26c60(0x160)](_0xa26c60(0x18a),{'success':_0x56cbcd[_0xa26c60(0x14c)](_0xa26c60(0x19a)),'errors':_0x56cbcd[_0xa26c60(0x14c)](_0xa26c60(0x147)),'role':_0x29b768,'profile':_0x3d5d82,'user':_0x58823f,'master_shop':_0x555c0f,'language':_0x1ababa});}catch(_0x1dbedd){console[_0xa26c60(0x180)](_0x1dbedd);}}),router[a0_0x41a200(0x1a4)]('/view/:id',auth,async(_0x3f26f2,_0x28e15f)=>{const _0x51cc61=a0_0x41a200;try{const _0x30b34b=_0x3f26f2[_0x51cc61(0x165)]['id'],_0x339088=await customer[_0x51cc61(0x16c)](_0x30b34b),{name:_0x45dd94,address:_0x293fe8,mobile:_0x253ee8,email:_0x3e4b8c,receivable:_0x5154bd,payable:_0x410960,contactperson:_0x4ef86b,landline:_0x1bf4cb}=_0x3f26f2[_0x51cc61(0x193)];_0x339088[_0x51cc61(0x172)]=_0x45dd94,_0x339088[_0x51cc61(0x1a5)]=_0x293fe8,_0x339088[_0x51cc61(0x192)]=_0x253ee8,_0x339088['email']=_0x3e4b8c,_0x339088[_0x51cc61(0x162)]=_0x5154bd,_0x339088[_0x51cc61(0x187)]=_0x410960,_0x339088[_0x51cc61(0x16d)]=_0x4ef86b,_0x339088[_0x51cc61(0x14b)]=_0x1bf4cb;const _0x39fb48=await _0x339088['save']();_0x3f26f2['flash'](_0x51cc61(0x19a),_0x51cc61(0x152)),_0x28e15f[_0x51cc61(0x19c)](_0x51cc61(0x1a1));}catch(_0x12d4f0){console[_0x51cc61(0x180)](_0x12d4f0);}}),router['get'](a0_0x41a200(0x178),auth,async(_0x1ab353,_0x23bf00)=>{const _0x32ca20=a0_0x41a200;try{const {username:_0x5278e8,email:_0x1d3f46,role:_0x57f18d}=_0x1ab353[_0x32ca20(0x1a8)],_0x4bd446=_0x1ab353[_0x32ca20(0x1a8)],_0x142238=await profile[_0x32ca20(0x1a6)]({'email':_0x4bd446['email']}),_0x34bf60=await master_shop['find']();console['log'](_0x32ca20(0x168),_0x34bf60),console[_0x32ca20(0x180)](_0x1ab353[_0x32ca20(0x165)]['id']);const _0x451de8=await customer[_0x32ca20(0x1a6)]({'_id':_0x1ab353[_0x32ca20(0x165)]['id']});console[_0x32ca20(0x180)]('customer_data',_0x451de8);const _0x4c9b8e=await c_payment_data[_0x32ca20(0x18e)]({'customer':_0x451de8['name']});console[_0x32ca20(0x180)](_0x4c9b8e);const _0x3717ab=await c_payment_data[_0x32ca20(0x17d)]([{'$match':{'customer':_0x451de8[_0x32ca20(0x172)]}},{'$match':{'reason':_0x32ca20(0x18b)}},{'$group':{'_id':'$reason','sum':{'$sum':'$amount'}}}]);console[_0x32ca20(0x180)]('payable_sum',_0x3717ab);const _0x4ebcf2=await c_payment_data[_0x32ca20(0x17d)]([{'$match':{'customer':_0x451de8['name']}},{'$match':{'reason':_0x32ca20(0x195)}},{'$group':{'_id':_0x32ca20(0x182),'sum':{'$sum':'$amount'}}}]);console['log'](_0x32ca20(0x149),_0x4ebcf2);if(_0x34bf60[0x0]['language']==_0x32ca20(0x171)){var _0x2e2934=users[_0x32ca20(0x177)];console[_0x32ca20(0x180)](_0x2e2934);}else{if(_0x34bf60[0x0][_0x32ca20(0x19b)]==_0x32ca20(0x151))var _0x2e2934=users[_0x32ca20(0x151)];else{if(_0x34bf60[0x0][_0x32ca20(0x19b)]==_0x32ca20(0x174))var _0x2e2934=users[_0x32ca20(0x174)];else{if(_0x34bf60[0x0]['language']==_0x32ca20(0x198))var _0x2e2934=users[_0x32ca20(0x198)];else{if(_0x34bf60[0x0][_0x32ca20(0x19b)]=='French')var _0x2e2934=users[_0x32ca20(0x186)];else{if(_0x34bf60[0x0][_0x32ca20(0x19b)]==_0x32ca20(0x15b))var _0x2e2934=users[_0x32ca20(0x14e)];else{if(_0x34bf60[0x0][_0x32ca20(0x19b)]=='Chinese')var _0x2e2934=users[_0x32ca20(0x153)];else{if(_0x34bf60[0x0]['language']=='Arabic\x20(ae)')var _0x2e2934=users[_0x32ca20(0x17f)];}}}}}}}_0x23bf00[_0x32ca20(0x160)](_0x32ca20(0x166),{'success':_0x1ab353[_0x32ca20(0x14c)](_0x32ca20(0x19a)),'errors':_0x1ab353[_0x32ca20(0x14c)](_0x32ca20(0x147)),'role':_0x4bd446,'profile':_0x142238,'payment':_0x4c9b8e,'payable':_0x3717ab,'receivable':_0x4ebcf2,'master_shop':_0x34bf60,'language':_0x2e2934});}catch(_0x2b2bc0){console[_0x32ca20(0x180)](_0x2b2bc0);}}),router['get'](a0_0x41a200(0x17a),auth,async(_0x425934,_0xcb7a0d)=>{const _0xe30a26=a0_0x41a200;try{const _0x4c9cba=new excelJS['Workbook'](),_0x347011=_0x4c9cba[_0xe30a26(0x173)](_0xe30a26(0x158));return _0x347011[_0xe30a26(0x148)]=[{'header':'ID','key':_0xe30a26(0x183),'width':0xa},{'header':_0xe30a26(0x181),'key':_0xe30a26(0x155),'width':0xa},{'header':'SalesmanCode','key':_0xe30a26(0x19e),'width':0xa},{'header':_0xe30a26(0x15d),'key':'SalesmanName','width':0xa},{'header':'address','key':'address','width':0xa},{'header':_0xe30a26(0x192),'key':_0xe30a26(0x192),'width':0xa},{'header':'email','key':_0xe30a26(0x16f),'width':0xa}],_0xcb7a0d['setHeader'](_0xe30a26(0x18c),_0xe30a26(0x190)),_0xcb7a0d[_0xe30a26(0x1a2)](_0xe30a26(0x154),_0xe30a26(0x14f)),_0x4c9cba[_0xe30a26(0x189)][_0xe30a26(0x144)](_0xcb7a0d)['then'](()=>{const _0x38f333=_0xe30a26;_0xcb7a0d[_0x38f333(0x15f)](0xc8);});}catch(_0x3c47d6){_0xcb7a0d[_0xe30a26(0x15f)](0x190)[_0xe30a26(0x156)]({'errors':_0x3c47d6[_0xe30a26(0x18f)]});}});const storage1=multer['diskStorage']({'destination':(_0x374ce8,_0xb02268,_0x1b1248)=>{const _0x30a3b3=a0_0x41a200;_0x1b1248(null,_0x30a3b3(0x145));},'filename':(_0x18fcbc,_0x357a62,_0xe377df)=>{const _0x16accb=a0_0x41a200;_0xe377df(null,Date['now']()+_0x357a62[_0x16accb(0x179)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x41a200(0x1a4)]('/customer_import_migrate_file',auth,uploadMigrate[a0_0x41a200(0x19f)](a0_0x41a200(0x163)),async(_0x207343,_0x354b06)=>{const _0x3c6afa=a0_0x41a200,_0x5a853e=_0x207343[_0x3c6afa(0x1aa)][_0x3c6afa(0x159)],_0x1760b6=await xlsx['readFile'](_0x3c6afa(0x170)+_0x5a853e);let _0xbcbd36=_0x1760b6[_0x3c6afa(0x169)],_0x1b08ca=xlsx['utils'][_0x3c6afa(0x19d)](_0x1760b6[_0x3c6afa(0x196)][_0xbcbd36[0x0]]);for(const _0x1eee79 of _0x1b08ca){const _0x58e353=_0x1eee79['ID'],_0x2edbbc=_0x1eee79[_0x3c6afa(0x181)],_0x591198=_0x1eee79['SalesmanCode'],_0x19ed76=_0x1eee79[_0x3c6afa(0x15d)],_0x3c7482=_0x1eee79[_0x3c6afa(0x1a5)],_0x44748e=_0x1eee79['mobile'],_0x3ea5b6=_0x1eee79['email'];try{let _0xc0c7c9=await customer['findOne']({'name':_0x2edbbc});if(!_0xc0c7c9){const _0x510f1d=new customer({'name':_0x2edbbc,'ID':_0x58e353,'SalesmanCode':_0x591198,'SalesmanName':_0x19ed76,'address':_0x3c7482,'mobile':_0x44748e,'email':_0x3ea5b6});_0xc0c7c9=await _0x510f1d[_0x3c6afa(0x17b)](),_0x207343[_0x3c6afa(0x14c)](_0x3c6afa(0x19a),_0x2edbbc+'\x20added\x20successfully');}else _0x207343[_0x3c6afa(0x14c)]('error',_0x2edbbc+_0x3c6afa(0x199));}catch(_0x2f05ce){_0x354b06[_0x3c6afa(0x15f)](0x1f4)[_0x3c6afa(0x184)]({'proderror':_0x2f05ce[_0x3c6afa(0x18f)],'aproduct':ProductName});}}_0x354b06[_0x3c6afa(0x19c)](_0x3c6afa(0x1a1));}),module[a0_0x41a200(0x150)]=router;