const a0_0x4f4da4=a0_0x2d95;(function(_0x22baf8,_0x5e3405){const _0x5570a2=a0_0x2d95,_0x224fb9=_0x22baf8();while(!![]){try{const _0x969b42=parseInt(_0x5570a2(0x165))/0x1+parseInt(_0x5570a2(0x15e))/0x2+-parseInt(_0x5570a2(0x197))/0x3*(-parseInt(_0x5570a2(0x187))/0x4)+parseInt(_0x5570a2(0x15c))/0x5+parseInt(_0x5570a2(0x153))/0x6*(-parseInt(_0x5570a2(0x1b2))/0x7)+parseInt(_0x5570a2(0x162))/0x8+-parseInt(_0x5570a2(0x17e))/0x9;if(_0x969b42===_0x5e3405)break;else _0x224fb9['push'](_0x224fb9['shift']());}catch(_0x145b4e){_0x224fb9['push'](_0x224fb9['shift']());}}}(a0_0x313b,0x4ec2a));function a0_0x2d95(_0x1ad0d9,_0x35097c){const _0x313b71=a0_0x313b();return a0_0x2d95=function(_0x2d9536,_0x590cfe){_0x2d9536=_0x2d9536-0x151;let _0x2f66ed=_0x313b71[_0x2d9536];return _0x2f66ed;},a0_0x2d95(_0x1ad0d9,_0x35097c);}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x4f4da4(0x156)),users=require(a0_0x4f4da4(0x1a4)),excelJS=require(a0_0x4f4da4(0x188)),xlsx=require(a0_0x4f4da4(0x1aa)),multer=require('multer');router[a0_0x4f4da4(0x1a5)](a0_0x4f4da4(0x171),auth,async(_0x1838a6,_0x2d0e4e)=>{const _0x14fba5=a0_0x4f4da4;try{const {username:_0x123f41,email:_0x5de725,role:_0x2debbf}=_0x1838a6[_0x14fba5(0x16f)],_0x40fdd2=_0x1838a6[_0x14fba5(0x16f)],_0x561e91=await profile[_0x14fba5(0x189)]({'email':_0x40fdd2['email']}),_0x471905=await master_shop['find']();console[_0x14fba5(0x15b)]('master',_0x471905);const _0x4b43a8=await customer[_0x14fba5(0x152)](),_0x4acfbb=await customer[_0x14fba5(0x16b)]([{'$lookup':{'from':_0x14fba5(0x177),'localField':_0x14fba5(0x179),'foreignField':_0x14fba5(0x1b3),'as':'customer_docs'}}]);console[_0x14fba5(0x15b)](_0x4acfbb);const _0x3f9cea=_0x4acfbb['map'](_0x38608b=>{const _0x2516f1=_0x14fba5;console[_0x2516f1(0x15b)](_0x2516f1(0x1a0),_0x38608b);var _0x35a598=0x0,_0x2e7ec4=0x0;return _0x38608b[_0x2516f1(0x1b7)][_0x2516f1(0x195)](_0x12e90f=>{const _0x66f663=_0x2516f1;console['log']('element',_0x12e90f),_0x12e90f[_0x66f663(0x18e)]==_0x66f663(0x154)?_0x35a598+=_0x12e90f[_0x66f663(0x166)]:_0x2e7ec4+=_0x12e90f[_0x66f663(0x166)];}),_0x38608b[_0x2516f1(0x18a)]=parseFloat(_0x35a598)+0x0,_0x38608b[_0x2516f1(0x185)]=parseFloat(_0x2e7ec4)+0x0,_0x38608b;});console['log'](_0x14fba5(0x1ac),_0x3f9cea);if(_0x471905[0x0]['language']==_0x14fba5(0x186)){var _0xd89d2=users[_0x14fba5(0x1b5)];console[_0x14fba5(0x15b)](_0xd89d2);}else{if(_0x471905[0x0]['language']=='Hindi')var _0xd89d2=users[_0x14fba5(0x19a)];else{if(_0x471905[0x0]['language']=='German')var _0xd89d2=users['German'];else{if(_0x471905[0x0][_0x14fba5(0x173)]==_0x14fba5(0x17b))var _0xd89d2=users['Spanish'];else{if(_0x471905[0x0]['language']==_0x14fba5(0x15d))var _0xd89d2=users[_0x14fba5(0x15d)];else{if(_0x471905[0x0][_0x14fba5(0x173)]==_0x14fba5(0x18d))var _0xd89d2=users[_0x14fba5(0x192)];else{if(_0x471905[0x0][_0x14fba5(0x173)]==_0x14fba5(0x181))var _0xd89d2=users['Chinese'];else{if(_0x471905[0x0]['language']==_0x14fba5(0x160))var _0xd89d2=users['Arabic'];}}}}}}}_0x2d0e4e['render'](_0x14fba5(0x1b3),{'success':_0x1838a6[_0x14fba5(0x16e)]('success'),'errors':_0x1838a6[_0x14fba5(0x16e)](_0x14fba5(0x168)),'user':_0x4b43a8,'role':_0x40fdd2,'profile':_0x561e91,'payment':_0x3f9cea,'master_shop':_0x471905,'language':_0xd89d2});}catch(_0x412a3f){console[_0x14fba5(0x15b)](_0x412a3f);}}),router['post'](a0_0x4f4da4(0x171),auth,async(_0x5de51f,_0x4a3f08)=>{const _0x225484=a0_0x4f4da4;try{const {name:_0x1d0cd9,address:_0xc71a29,mobile:_0x40a53e,email:_0x151c8e,receivable:_0x2142b6,payable:_0x24d3a8,contactperson:_0x21b3cd,landline:_0x2fc24f}=_0x5de51f[_0x225484(0x1a1)],_0x44ba17=new customer({'name':_0x1d0cd9,'address':_0xc71a29,'mobile':_0x40a53e,'email':_0x151c8e,'receivable':_0x2142b6,'payable':_0x24d3a8,'contactperson':_0x21b3cd,'landline':_0x2fc24f}),_0x455da3=await _0x44ba17[_0x225484(0x163)]();_0x5de51f[_0x225484(0x16e)]('success',_0x225484(0x194)),_0x4a3f08[_0x225484(0x1b1)](_0x225484(0x182));}catch(_0x14dcd4){console['log'](_0x14dcd4);}}),router[a0_0x4f4da4(0x1a5)](a0_0x4f4da4(0x196),auth,async(_0x27cc9d,_0xc919bc)=>{const _0x3cf293=a0_0x4f4da4;try{const {username:_0x4d034d,email:_0x402d1d,role:_0x25e40e}=_0x27cc9d[_0x3cf293(0x16f)],_0x34d390=_0x27cc9d['user'],_0x27e751=await profile['findOne']({'email':_0x34d390[_0x3cf293(0x18c)]}),_0x5bf689=await master_shop['find']();console[_0x3cf293(0x15b)](_0x3cf293(0x180),_0x5bf689);const _0x3fce20=_0x27cc9d[_0x3cf293(0x17f)]['id'],_0x225d49=await customer[_0x3cf293(0x170)](_0x3fce20);if(_0x5bf689[0x0][_0x3cf293(0x173)]==_0x3cf293(0x186)){var _0x43bf69=users[_0x3cf293(0x1b5)];console[_0x3cf293(0x15b)](_0x43bf69);}else{if(_0x5bf689[0x0][_0x3cf293(0x173)]=='Hindi')var _0x43bf69=users['Hindi'];else{if(_0x5bf689[0x0][_0x3cf293(0x173)]==_0x3cf293(0x18b))var _0x43bf69=users[_0x3cf293(0x18b)];else{if(_0x5bf689[0x0][_0x3cf293(0x173)]=='Spanish')var _0x43bf69=users[_0x3cf293(0x17b)];else{if(_0x5bf689[0x0][_0x3cf293(0x173)]==_0x3cf293(0x15d))var _0x43bf69=users[_0x3cf293(0x15d)];else{if(_0x5bf689[0x0][_0x3cf293(0x173)]==_0x3cf293(0x18d))var _0x43bf69=users[_0x3cf293(0x192)];else{if(_0x5bf689[0x0]['language']=='Chinese')var _0x43bf69=users[_0x3cf293(0x181)];else{if(_0x5bf689[0x0]['language']==_0x3cf293(0x160))var _0x43bf69=users[_0x3cf293(0x1a6)];}}}}}}}_0xc919bc[_0x3cf293(0x199)](_0x3cf293(0x1b3),{'success':_0x27cc9d[_0x3cf293(0x16e)](_0x3cf293(0x174)),'errors':_0x27cc9d[_0x3cf293(0x16e)]('errors'),'role':_0x34d390,'profile':_0x27e751,'user':_0x225d49,'master_shop':_0x5bf689,'language':_0x43bf69});}catch(_0x3bfd54){console[_0x3cf293(0x15b)](_0x3bfd54);}}),router[a0_0x4f4da4(0x19f)]('/view/:id',auth,async(_0x3164ab,_0x3dde56)=>{const _0xef84d3=a0_0x4f4da4;try{const _0x1fcc56=_0x3164ab['params']['id'],_0x14e7c4=await customer['findById'](_0x1fcc56),{name:_0x57d1cb,address:_0x170128,mobile:_0x18b57e,email:_0x15252a,receivable:_0x29a46c,payable:_0x18ba4e,contactperson:_0x3d2b5a,landline:_0x354504}=_0x3164ab[_0xef84d3(0x1a1)];_0x14e7c4[_0xef84d3(0x179)]=_0x57d1cb,_0x14e7c4[_0xef84d3(0x19b)]=_0x170128,_0x14e7c4[_0xef84d3(0x183)]=_0x18b57e,_0x14e7c4[_0xef84d3(0x18c)]=_0x15252a,_0x14e7c4[_0xef84d3(0x167)]=_0x29a46c,_0x14e7c4[_0xef84d3(0x1ae)]=_0x18ba4e,_0x14e7c4[_0xef84d3(0x16a)]=_0x3d2b5a,_0x14e7c4['landline']=_0x354504;const _0x4931ba=await _0x14e7c4[_0xef84d3(0x163)]();_0x3164ab[_0xef84d3(0x16e)]('success',_0xef84d3(0x1a8)),_0x3dde56[_0xef84d3(0x1b1)](_0xef84d3(0x182));}catch(_0x3918e9){console[_0xef84d3(0x15b)](_0x3918e9);}}),router[a0_0x4f4da4(0x1a5)]('/view/payment/:id',auth,async(_0xcaa498,_0x4ce01b)=>{const _0x40dd03=a0_0x4f4da4;try{const {username:_0x43ca0c,email:_0x2dcc34,role:_0x56e53b}=_0xcaa498[_0x40dd03(0x16f)],_0x56c156=_0xcaa498[_0x40dd03(0x16f)],_0x139b05=await profile[_0x40dd03(0x189)]({'email':_0x56c156['email']}),_0x5b92d8=await master_shop[_0x40dd03(0x152)]();console['log']('master',_0x5b92d8),console[_0x40dd03(0x15b)](_0xcaa498['params']['id']);const _0x10022d=await customer['findOne']({'_id':_0xcaa498[_0x40dd03(0x17f)]['id']});console[_0x40dd03(0x15b)](_0x40dd03(0x176),_0x10022d);const _0x251df8=await c_payment_data['find']({'customer':_0x10022d['name']});console[_0x40dd03(0x15b)](_0x251df8);const _0xfc3a56=await c_payment_data[_0x40dd03(0x16b)]([{'$match':{'customer':_0x10022d[_0x40dd03(0x179)]}},{'$match':{'reason':_0x40dd03(0x154)}},{'$group':{'_id':_0x40dd03(0x164),'sum':{'$sum':_0x40dd03(0x169)}}}]);console[_0x40dd03(0x15b)]('payable_sum',_0xfc3a56);const _0x336263=await c_payment_data[_0x40dd03(0x16b)]([{'$match':{'customer':_0x10022d[_0x40dd03(0x179)]}},{'$match':{'reason':_0x40dd03(0x1a7)}},{'$group':{'_id':_0x40dd03(0x164),'sum':{'$sum':_0x40dd03(0x169)}}}]);console[_0x40dd03(0x15b)](_0x40dd03(0x161),_0x336263);if(_0x5b92d8[0x0][_0x40dd03(0x173)]==_0x40dd03(0x186)){var _0x495842=users[_0x40dd03(0x1b5)];console[_0x40dd03(0x15b)](_0x495842);}else{if(_0x5b92d8[0x0][_0x40dd03(0x173)]==_0x40dd03(0x19a))var _0x495842=users['Hindi'];else{if(_0x5b92d8[0x0][_0x40dd03(0x173)]==_0x40dd03(0x18b))var _0x495842=users['German'];else{if(_0x5b92d8[0x0][_0x40dd03(0x173)]=='Spanish')var _0x495842=users[_0x40dd03(0x17b)];else{if(_0x5b92d8[0x0][_0x40dd03(0x173)]==_0x40dd03(0x15d))var _0x495842=users[_0x40dd03(0x15d)];else{if(_0x5b92d8[0x0][_0x40dd03(0x173)]==_0x40dd03(0x18d))var _0x495842=users[_0x40dd03(0x192)];else{if(_0x5b92d8[0x0]['language']==_0x40dd03(0x181))var _0x495842=users[_0x40dd03(0x181)];else{if(_0x5b92d8[0x0][_0x40dd03(0x173)]==_0x40dd03(0x160))var _0x495842=users[_0x40dd03(0x1a6)];}}}}}}}_0x4ce01b['render'](_0x40dd03(0x191),{'success':_0xcaa498[_0x40dd03(0x16e)]('success'),'errors':_0xcaa498[_0x40dd03(0x16e)]('errors'),'role':_0x56c156,'profile':_0x139b05,'payment':_0x251df8,'payable':_0xfc3a56,'receivable':_0x336263,'master_shop':_0x5b92d8,'language':_0x495842});}catch(_0x5972a7){console[_0x40dd03(0x15b)](_0x5972a7);}}),router[a0_0x4f4da4(0x1a5)]('/products_export_migrate_file',auth,async(_0x4b4b42,_0x5a0faa)=>{const _0x555c15=a0_0x4f4da4;try{const _0x10670f=new excelJS[(_0x555c15(0x159))](),_0x5e363b=_0x10670f[_0x555c15(0x1b4)](_0x555c15(0x16c));return _0x5e363b[_0x555c15(0x15f)]=[{'header':'ID','key':_0x555c15(0x151),'width':0xa},{'header':_0x555c15(0x17d),'key':_0x555c15(0x19c),'width':0xa},{'header':_0x555c15(0x1a3),'key':_0x555c15(0x1b0),'width':0xa},{'header':_0x555c15(0x1b6),'key':'SalesmanName','width':0xa},{'header':_0x555c15(0x19b),'key':'address','width':0xa},{'header':_0x555c15(0x183),'key':_0x555c15(0x183),'width':0xa},{'header':_0x555c15(0x18c),'key':_0x555c15(0x18c),'width':0xa}],_0x5a0faa[_0x555c15(0x190)]('Content-Type',_0x555c15(0x15a)),_0x5a0faa[_0x555c15(0x190)](_0x555c15(0x19d),_0x555c15(0x155)),_0x10670f[_0x555c15(0x1aa)][_0x555c15(0x1ab)](_0x5a0faa)[_0x555c15(0x1ad)](()=>{const _0x3f8880=_0x555c15;_0x5a0faa[_0x3f8880(0x16d)](0xc8);});}catch(_0x25723a){_0x5a0faa[_0x555c15(0x16d)](0x190)['send']({'errors':_0x25723a['message']});}});function a0_0x313b(){const _0x157d80=['\x20added\x20successfully','setHeader','customer_payment','Portuguese','\x20Failed','customer\x20add\x20successfully','forEach','/view/:id','747TdUXQr','utils','render','Hindi','address','PBrands','Content-Disposition','single','post','data','body','now','SalesmanCode','../public/language/languages.json','get','Arabic','Sale\x20Return','customer\x20update\x20successfully','json','xlsx','write','payment_data','then','payable','file','PUnits','redirect','9513CPVSYQ','customer','addWorksheet','English','SalesmanName','customer_docs','PName','find','2682igOxoz','Sale','attachment;\x20filename=customer_Migration_File.xlsx','../middleware/auth','readFile','sheet_to_json','Workbook','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','log','2445435hBhvdC','French','307042Qfgrqc','columns','Arabic\x20(ae)','receivable_sum','2691856nedoZW','save','$reason','47652nBzuOz','amount','receivable','errors','$amount','contactperson','aggregate','Customers','status','flash','user','findById','/view','public/Migration/','language','success','diskStorage','customer_data','c_payments','public/Migration','name','error','Spanish','filename','Name','2933964jbzSYH','params','master','Chinese','/customer/view','mobile','/customer_import_migrate_file','sale_return','English\x20(US)','3684NUmCmb','exceljs','findOne','sale','German','email','Portuguese\x20(BR)','reason'];a0_0x313b=function(){return _0x157d80;};return a0_0x313b();}const storage1=multer[a0_0x4f4da4(0x175)]({'destination':(_0x585cb8,_0x170def,_0x5cd3ab)=>{const _0x33e62c=a0_0x4f4da4;_0x5cd3ab(null,_0x33e62c(0x178));},'filename':(_0x40a62e,_0x2b8937,_0x50641b)=>{const _0x3ca9ac=a0_0x4f4da4;_0x50641b(null,Date[_0x3ca9ac(0x1a2)]()+_0x2b8937['originalname']);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x4f4da4(0x184),auth,uploadMigrate[a0_0x4f4da4(0x19e)]('customer_product_fule'),async(_0x231b66,_0x520c9e)=>{const _0x3c24f3=a0_0x4f4da4,_0xba654d=_0x231b66[_0x3c24f3(0x1af)][_0x3c24f3(0x17c)],_0x49525c=await xlsx[_0x3c24f3(0x157)](_0x3c24f3(0x172)+_0xba654d);let _0x3258d0=_0x49525c['SheetNames'],_0x2afe82=xlsx[_0x3c24f3(0x198)][_0x3c24f3(0x158)](_0x49525c['Sheets'][_0x3258d0[0x0]]);for(const _0x2c41fc of _0x2afe82){const _0x2b7ee7=_0x2c41fc['ID'],_0x3cb5d7=_0x2c41fc['Name'],_0x2bef59=_0x2c41fc[_0x3c24f3(0x1a3)],_0x3695ad=_0x2c41fc[_0x3c24f3(0x1b6)],_0x4cd117=_0x2c41fc[_0x3c24f3(0x19b)],_0x2d170a=_0x2c41fc[_0x3c24f3(0x183)],_0x40630e=_0x2c41fc[_0x3c24f3(0x18c)];try{let _0x2c430e=await customer[_0x3c24f3(0x189)]({'name':_0x3cb5d7});if(!_0x2c430e){const _0x53c408=new customer({'name':_0x3cb5d7,'ID':_0x2b7ee7,'SalesmanCode':_0x2bef59,'SalesmanName':_0x3695ad,'address':_0x4cd117,'mobile':_0x2d170a,'email':_0x40630e});_0x2c430e=await _0x53c408['save'](),_0x231b66['flash'](_0x3c24f3(0x174),_0x3cb5d7+_0x3c24f3(0x18f));}else _0x231b66[_0x3c24f3(0x16e)](_0x3c24f3(0x17a),_0x3cb5d7+_0x3c24f3(0x193));}catch(_0x4baf2e){_0x520c9e[_0x3c24f3(0x16d)](0x1f4)[_0x3c24f3(0x1a9)]({'proderror':_0x4baf2e['message'],'aproduct':ProductName});}}_0x520c9e['redirect'](_0x3c24f3(0x182));}),module['exports']=router;