const a0_0x19db66=a0_0x2ed2;(function(_0x26aa8b,_0x2b8a6b){const _0x18bf1e=a0_0x2ed2,_0x4a1980=_0x26aa8b();while(!![]){try{const _0x22e38=-parseInt(_0x18bf1e(0x137))/0x1+-parseInt(_0x18bf1e(0xe6))/0x2+parseInt(_0x18bf1e(0x116))/0x3*(parseInt(_0x18bf1e(0x14a))/0x4)+parseInt(_0x18bf1e(0x106))/0x5*(parseInt(_0x18bf1e(0xfb))/0x6)+-parseInt(_0x18bf1e(0x10d))/0x7*(parseInt(_0x18bf1e(0xe3))/0x8)+parseInt(_0x18bf1e(0xf6))/0x9*(-parseInt(_0x18bf1e(0x11b))/0xa)+parseInt(_0x18bf1e(0x147))/0xb*(parseInt(_0x18bf1e(0x113))/0xc);if(_0x22e38===_0x2b8a6b)break;else _0x4a1980['push'](_0x4a1980['shift']());}catch(_0x6bd824){_0x4a1980['push'](_0x4a1980['shift']());}}}(a0_0x5361,0x2298c));const express=require(a0_0x19db66(0xe7)),app=express(),router=express[a0_0x19db66(0x109)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x19db66(0x120)),auth=require(a0_0x19db66(0x14c)),users=require(a0_0x19db66(0x128)),excelJS=require(a0_0x19db66(0xe5)),xlsx=require(a0_0x19db66(0x12a)),multer=require(a0_0x19db66(0x130));router[a0_0x19db66(0x10b)](a0_0x19db66(0x12c),auth,async(_0xcf184b,_0x196d5f)=>{const _0x3c4295=a0_0x19db66;try{const {username:_0x42ec72,email:_0x42d199,role:_0x368b1d}=_0xcf184b[_0x3c4295(0x115)],_0x440b28=_0xcf184b[_0x3c4295(0x115)],_0x22ef25=await profile[_0x3c4295(0xff)]({'email':_0x440b28[_0x3c4295(0x122)]}),_0x4cdbc5=await master_shop[_0x3c4295(0xe4)]();console[_0x3c4295(0x111)](_0x3c4295(0x12d),_0x4cdbc5);const _0xb0d1ff=await customer[_0x3c4295(0xe4)](),_0x338bf5=await customer[_0x3c4295(0x12e)]([{'$lookup':{'from':_0x3c4295(0xf4),'localField':_0x3c4295(0x13b),'foreignField':_0x3c4295(0x149),'as':'customer_docs'}}]);console['log'](_0x338bf5);const _0x47dc1d=_0x338bf5[_0x3c4295(0x104)](_0x5ee594=>{const _0x41fa64=_0x3c4295;console[_0x41fa64(0x111)](_0x41fa64(0x13d),_0x5ee594);var _0x1f314d=0x0,_0x4cf5bf=0x0;return _0x5ee594[_0x41fa64(0x119)][_0x41fa64(0xfe)](_0x5a36c9=>{const _0x4abf41=_0x41fa64;console[_0x4abf41(0x111)](_0x4abf41(0x11a),_0x5a36c9),_0x5a36c9['reason']==_0x4abf41(0x135)?_0x1f314d+=_0x5a36c9['amount']:_0x4cf5bf+=_0x5a36c9[_0x4abf41(0x10f)];}),_0x5ee594[_0x41fa64(0xf3)]=parseFloat(_0x1f314d)+0x0,_0x5ee594[_0x41fa64(0x14f)]=parseFloat(_0x4cf5bf)+0x0,_0x5ee594;});console['log'](_0x3c4295(0xfa),_0x47dc1d);if(_0x4cdbc5[0x0]['language']=='English\x20(US)'){var _0x4bea0f=users[_0x3c4295(0x121)];console[_0x3c4295(0x111)](_0x4bea0f);}else{if(_0x4cdbc5[0x0]['language']=='Hindi')var _0x4bea0f=users[_0x3c4295(0x125)];else{if(_0x4cdbc5[0x0]['language']==_0x3c4295(0x112))var _0x4bea0f=users[_0x3c4295(0x112)];else{if(_0x4cdbc5[0x0]['language']=='Spanish')var _0x4bea0f=users[_0x3c4295(0xf1)];else{if(_0x4cdbc5[0x0][_0x3c4295(0xee)]==_0x3c4295(0x10c))var _0x4bea0f=users[_0x3c4295(0x10c)];else{if(_0x4cdbc5[0x0][_0x3c4295(0xee)]==_0x3c4295(0x139))var _0x4bea0f=users[_0x3c4295(0x101)];else{if(_0x4cdbc5[0x0][_0x3c4295(0xee)]==_0x3c4295(0x12b))var _0x4bea0f=users['Chinese'];else{if(_0x4cdbc5[0x0][_0x3c4295(0xee)]==_0x3c4295(0x136))var _0x4bea0f=users[_0x3c4295(0xf2)];}}}}}}}_0x196d5f[_0x3c4295(0x133)](_0x3c4295(0x149),{'success':_0xcf184b[_0x3c4295(0x102)]('success'),'errors':_0xcf184b[_0x3c4295(0x102)](_0x3c4295(0x142)),'user':_0xb0d1ff,'role':_0x440b28,'profile':_0x22ef25,'payment':_0x47dc1d,'master_shop':_0x4cdbc5,'language':_0x4bea0f});}catch(_0x55e4cd){console[_0x3c4295(0x111)](_0x55e4cd);}}),router[a0_0x19db66(0x11d)](a0_0x19db66(0x12c),auth,async(_0x587e55,_0xc49319)=>{const _0x2132f1=a0_0x19db66;try{const {name:_0xfab163,address:_0x5c49d9,mobile:_0x43fbb4,email:_0x11f2df,receivable:_0x21474d,payable:_0x55eefa,contactperson:_0x55ba48,landline:_0x5c8dc0}=_0x587e55[_0x2132f1(0xed)],_0x364a3a=new customer({'name':_0xfab163,'address':_0x5c49d9,'mobile':_0x43fbb4,'email':_0x11f2df,'receivable':_0x21474d,'payable':_0x55eefa,'contactperson':_0x55ba48,'landline':_0x5c8dc0}),_0xf1c73a=await _0x364a3a[_0x2132f1(0x13a)]();_0x587e55['flash'](_0x2132f1(0x105),_0x2132f1(0x150)),_0xc49319[_0x2132f1(0x10e)](_0x2132f1(0x141));}catch(_0x323f78){console[_0x2132f1(0x111)](_0x323f78);}}),router['get'](a0_0x19db66(0x145),auth,async(_0xb9eab1,_0x4bb2ec)=>{const _0x2fbedd=a0_0x19db66;try{const {username:_0x47f62e,email:_0x49370f,role:_0x51e171}=_0xb9eab1[_0x2fbedd(0x115)],_0x5af802=_0xb9eab1[_0x2fbedd(0x115)],_0x5c2b9f=await profile[_0x2fbedd(0xff)]({'email':_0x5af802[_0x2fbedd(0x122)]}),_0x47510b=await master_shop[_0x2fbedd(0xe4)]();console[_0x2fbedd(0x111)](_0x2fbedd(0x12d),_0x47510b);const _0x3d6bfe=_0xb9eab1[_0x2fbedd(0x110)]['id'],_0x8f0f62=await customer[_0x2fbedd(0x146)](_0x3d6bfe);if(_0x47510b[0x0][_0x2fbedd(0xee)]==_0x2fbedd(0x123)){var _0x3f03b8=users[_0x2fbedd(0x121)];console['log'](_0x3f03b8);}else{if(_0x47510b[0x0][_0x2fbedd(0xee)]==_0x2fbedd(0x125))var _0x3f03b8=users[_0x2fbedd(0x125)];else{if(_0x47510b[0x0][_0x2fbedd(0xee)]==_0x2fbedd(0x112))var _0x3f03b8=users['German'];else{if(_0x47510b[0x0][_0x2fbedd(0xee)]==_0x2fbedd(0xf1))var _0x3f03b8=users[_0x2fbedd(0xf1)];else{if(_0x47510b[0x0][_0x2fbedd(0xee)]==_0x2fbedd(0x10c))var _0x3f03b8=users[_0x2fbedd(0x10c)];else{if(_0x47510b[0x0][_0x2fbedd(0xee)]==_0x2fbedd(0x139))var _0x3f03b8=users[_0x2fbedd(0x101)];else{if(_0x47510b[0x0]['language']=='Chinese')var _0x3f03b8=users['Chinese'];else{if(_0x47510b[0x0][_0x2fbedd(0xee)]=='Arabic\x20(ae)')var _0x3f03b8=users[_0x2fbedd(0xf2)];}}}}}}}_0x4bb2ec['render'](_0x2fbedd(0x149),{'success':_0xb9eab1[_0x2fbedd(0x102)]('success'),'errors':_0xb9eab1[_0x2fbedd(0x102)](_0x2fbedd(0x142)),'role':_0x5af802,'profile':_0x5c2b9f,'user':_0x8f0f62,'master_shop':_0x47510b,'language':_0x3f03b8});}catch(_0x36ad79){console['log'](_0x36ad79);}}),router[a0_0x19db66(0x11d)]('/view/:id',auth,async(_0x50c4db,_0x504a09)=>{const _0xe08efb=a0_0x19db66;try{const _0x23eaa6=_0x50c4db[_0xe08efb(0x110)]['id'],_0x3ad3e8=await customer[_0xe08efb(0x146)](_0x23eaa6),{name:_0x452a5c,address:_0x14e67d,mobile:_0xeee0d,email:_0x5ef90f,receivable:_0x47373b,payable:_0x2cf30c,contactperson:_0x21c4e5,landline:_0x18444c}=_0x50c4db[_0xe08efb(0xed)];_0x3ad3e8[_0xe08efb(0x13b)]=_0x452a5c,_0x3ad3e8[_0xe08efb(0x126)]=_0x14e67d,_0x3ad3e8[_0xe08efb(0x134)]=_0xeee0d,_0x3ad3e8[_0xe08efb(0x122)]=_0x5ef90f,_0x3ad3e8[_0xe08efb(0xf7)]=_0x47373b,_0x3ad3e8['payable']=_0x2cf30c,_0x3ad3e8[_0xe08efb(0x144)]=_0x21c4e5,_0x3ad3e8[_0xe08efb(0x100)]=_0x18444c;const _0x2c498c=await _0x3ad3e8['save']();_0x50c4db[_0xe08efb(0x102)](_0xe08efb(0x105),_0xe08efb(0x12f)),_0x504a09[_0xe08efb(0x10e)]('/customer/view');}catch(_0x2b5027){console[_0xe08efb(0x111)](_0x2b5027);}}),router[a0_0x19db66(0x10b)](a0_0x19db66(0xf0),auth,async(_0x33006d,_0x5ef6bd)=>{const _0x53e686=a0_0x19db66;try{const {username:_0x2f8606,email:_0x4f3536,role:_0x57777f}=_0x33006d[_0x53e686(0x115)],_0x58e88c=_0x33006d[_0x53e686(0x115)],_0x1e5799=await profile[_0x53e686(0xff)]({'email':_0x58e88c[_0x53e686(0x122)]}),_0x2e6cab=await master_shop[_0x53e686(0xe4)]();console[_0x53e686(0x111)]('master',_0x2e6cab),console[_0x53e686(0x111)](_0x33006d[_0x53e686(0x110)]['id']);const _0x20ff5c=await customer[_0x53e686(0xff)]({'_id':_0x33006d[_0x53e686(0x110)]['id']});console['log'](_0x53e686(0xf5),_0x20ff5c);const _0x56eb64=await c_payment_data['find']({'customer':_0x20ff5c['name']});console['log'](_0x56eb64);const _0x365306=await c_payment_data[_0x53e686(0x12e)]([{'$match':{'customer':_0x20ff5c[_0x53e686(0x13b)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x53e686(0xe2)}}}]);console[_0x53e686(0x111)](_0x53e686(0x14e),_0x365306);const _0x29c104=await c_payment_data[_0x53e686(0x12e)]([{'$match':{'customer':_0x20ff5c[_0x53e686(0x13b)]}},{'$match':{'reason':_0x53e686(0xef)}},{'$group':{'_id':'$reason','sum':{'$sum':'$amount'}}}]);console[_0x53e686(0x111)]('receivable_sum',_0x29c104);if(_0x2e6cab[0x0][_0x53e686(0xee)]=='English\x20(US)'){var _0x191f20=users[_0x53e686(0x121)];console['log'](_0x191f20);}else{if(_0x2e6cab[0x0][_0x53e686(0xee)]=='Hindi')var _0x191f20=users[_0x53e686(0x125)];else{if(_0x2e6cab[0x0][_0x53e686(0xee)]==_0x53e686(0x112))var _0x191f20=users[_0x53e686(0x112)];else{if(_0x2e6cab[0x0][_0x53e686(0xee)]==_0x53e686(0xf1))var _0x191f20=users[_0x53e686(0xf1)];else{if(_0x2e6cab[0x0]['language']=='French')var _0x191f20=users[_0x53e686(0x10c)];else{if(_0x2e6cab[0x0][_0x53e686(0xee)]==_0x53e686(0x139))var _0x191f20=users[_0x53e686(0x101)];else{if(_0x2e6cab[0x0][_0x53e686(0xee)]==_0x53e686(0x12b))var _0x191f20=users[_0x53e686(0x12b)];else{if(_0x2e6cab[0x0]['language']==_0x53e686(0x136))var _0x191f20=users[_0x53e686(0xf2)];}}}}}}}_0x5ef6bd[_0x53e686(0x133)]('customer_payment',{'success':_0x33006d[_0x53e686(0x102)](_0x53e686(0x105)),'errors':_0x33006d['flash'](_0x53e686(0x142)),'role':_0x58e88c,'profile':_0x1e5799,'payment':_0x56eb64,'payable':_0x365306,'receivable':_0x29c104,'master_shop':_0x2e6cab,'language':_0x191f20});}catch(_0x1a3722){console[_0x53e686(0x111)](_0x1a3722);}}),router[a0_0x19db66(0x10b)](a0_0x19db66(0x127),auth,async(_0x2aac65,_0xaaad91)=>{const _0x47d11f=a0_0x19db66;try{const _0x1167f4=new excelJS[(_0x47d11f(0x108))](),_0x5ee0da=_0x1167f4[_0x47d11f(0x117)](_0x47d11f(0xec));return _0x5ee0da[_0x47d11f(0x14d)]=[{'header':'ID','key':_0x47d11f(0x11c),'width':0xa},{'header':_0x47d11f(0xea),'key':_0x47d11f(0x10a),'width':0xa},{'header':_0x47d11f(0x140),'key':_0x47d11f(0xe8),'width':0xa},{'header':_0x47d11f(0x131),'key':'SalesmanName','width':0xa},{'header':_0x47d11f(0x126),'key':'address','width':0xa},{'header':_0x47d11f(0x134),'key':'mobile','width':0xa},{'header':_0x47d11f(0x122),'key':_0x47d11f(0x122),'width':0xa}],_0xaaad91['setHeader'](_0x47d11f(0x132),_0x47d11f(0x107)),_0xaaad91[_0x47d11f(0x114)](_0x47d11f(0xe9),_0x47d11f(0xf8)),_0x1167f4['xlsx'][_0x47d11f(0x151)](_0xaaad91)[_0x47d11f(0xfd)](()=>{const _0xa39e62=_0x47d11f;_0xaaad91[_0xa39e62(0x13c)](0xc8);});}catch(_0x2cc6de){_0xaaad91[_0x47d11f(0x13c)](0x190)[_0x47d11f(0x129)]({'errors':_0x2cc6de[_0x47d11f(0xf9)]});}});function a0_0x2ed2(_0x5e5de1,_0xcd8cb9){const _0x5361eb=a0_0x5361();return a0_0x2ed2=function(_0x2ed2b5,_0x388608){_0x2ed2b5=_0x2ed2b5-0xe2;let _0x28e17d=_0x5361eb[_0x2ed2b5];return _0x28e17d;},a0_0x2ed2(_0x5e5de1,_0xcd8cb9);}function a0_0x5361(){const _0x70f878=['377090YUEFyn','PName','post','originalname','json','../models/all_models','English','email','English\x20(US)','sheet_to_json','Hindi','address','/products_export_migrate_file','../public/language/languages.json','send','xlsx','Chinese','/view','master','aggregate','customer\x20update\x20successfully','multer','SalesmanName','Content-Type','render','mobile','Sale','Arabic\x20(ae)','88509Zijkzg','Sheets','Portuguese\x20(BR)','save','name','status','data','customer_product_fule','single','SalesmanCode','/customer/view','errors','exports','contactperson','/view/:id','findById','33UfCQbO','diskStorage','customer','1140qVEroc','/customer_import_migrate_file','../middleware/auth','columns','payable_sum','sale_return','customer\x20add\x20successfully','write','public/Migration','$amount','344EXIJSs','find','exceljs','284666eUKLjg','express','PUnits','Content-Disposition','Name','\x20Failed','Customers','body','language','Sale\x20Return','/view/payment/:id','Spanish','Arabic','sale','c_payments','customer_data','63PMwASU','receivable','attachment;\x20filename=customer_Migration_File.xlsx','message','payment_data','114toAOgl','public/Migration/','then','forEach','findOne','landline','Portuguese','flash','error','map','success','42125tIQZXo','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','Workbook','Router','PBrands','get','French','1603zeMgIS','redirect','amount','params','log','German','817680EemafD','setHeader','user','2967VcxxiL','addWorksheet','filename','customer_docs','element'];a0_0x5361=function(){return _0x70f878;};return a0_0x5361();}const storage1=multer[a0_0x19db66(0x148)]({'destination':(_0x5082b8,_0x2ea8e3,_0x297c0e)=>{const _0x2c8f0f=a0_0x19db66;_0x297c0e(null,_0x2c8f0f(0x152));},'filename':(_0x25967d,_0x10f67e,_0x229954)=>{const _0x367847=a0_0x19db66;_0x229954(null,Date['now']()+_0x10f67e[_0x367847(0x11e)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x19db66(0x11d)](a0_0x19db66(0x14b),auth,uploadMigrate[a0_0x19db66(0x13f)](a0_0x19db66(0x13e)),async(_0xacc254,_0x4b710f)=>{const _0x2a8266=a0_0x19db66,_0x3ba91e=_0xacc254['file'][_0x2a8266(0x118)],_0x328029=await xlsx['readFile'](_0x2a8266(0xfc)+_0x3ba91e);let _0x32992f=_0x328029['SheetNames'],_0x4ddadf=xlsx['utils'][_0x2a8266(0x124)](_0x328029[_0x2a8266(0x138)][_0x32992f[0x0]]);for(const _0x2db152 of _0x4ddadf){const _0x3881f5=_0x2db152['ID'],_0x535568=_0x2db152['Name'],_0x3d6ae4=_0x2db152[_0x2a8266(0x140)],_0x2bf02e=_0x2db152[_0x2a8266(0x131)],_0x53ca5d=_0x2db152[_0x2a8266(0x126)],_0x50f103=_0x2db152[_0x2a8266(0x134)],_0x4eee81=_0x2db152['email'];try{let _0x3f4ada=await customer[_0x2a8266(0xff)]({'name':_0x535568});if(!_0x3f4ada){const _0x3d2d30=new customer({'name':_0x535568,'ID':_0x3881f5,'SalesmanCode':_0x3d6ae4,'SalesmanName':_0x2bf02e,'address':_0x53ca5d,'mobile':_0x50f103,'email':_0x4eee81});_0x3f4ada=await _0x3d2d30[_0x2a8266(0x13a)](),_0xacc254[_0x2a8266(0x102)](_0x2a8266(0x105),_0x535568+'\x20added\x20successfully');}else _0xacc254[_0x2a8266(0x102)](_0x2a8266(0x103),_0x535568+_0x2a8266(0xeb));}catch(_0x28ccba){_0x4b710f[_0x2a8266(0x13c)](0x1f4)[_0x2a8266(0x11f)]({'proderror':_0x28ccba[_0x2a8266(0xf9)],'aproduct':ProductName});}}_0x4b710f[_0x2a8266(0x10e)](_0x2a8266(0x141));}),module[a0_0x19db66(0x143)]=router;