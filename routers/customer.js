const a0_0x3dc7ff=a0_0x489a;function a0_0x31af(){const _0xb75137=['body','Content-Type','Sale','element','Router','reason','email','Name','/view','Customers','Arabic\x20(ae)','find','17044CNyHWi','19804ZciavS','Workbook','/customer_import_migrate_file','write','Portuguese\x20(BR)','address','mobile','findById','customer\x20add\x20successfully','Spanish','SheetNames','success','aggregate','../middleware/auth','now','setHeader','\x20added\x20successfully','post','payment_data','sale_return','English','payable_sum','2637728oMODjz','$amount','customer_product_fule','/products_export_migrate_file','English\x20(US)','sale','flash','send','\x20Failed','Portuguese','readFile','601722bncwhO','PUnits','SalesmanCode','customer','/customer/view','exports','render','redirect','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','name','German','Arabic','Sale\x20Return','PBrands','utils','542420azHQOa','file','params','customer_docs','xlsx','/view/:id','6907820llaDQu','$reason','exceljs','errors','single','11SzFVYf','diskStorage','status','French','save','420NSAdlk','PName','originalname','log','columns','704745hqKgUQ','multer','public/Migration','69HNEKFn','customer\x20update\x20successfully','SalesmanName','sheet_to_json','language','Chinese','Hindi','json','express','get','filename','user','amount','63uFMLZc','customer_payment','c_payments','then','message','findOne'];a0_0x31af=function(){return _0xb75137;};return a0_0x31af();}function a0_0x489a(_0x2a270a,_0x5444a3){const _0x31afff=a0_0x31af();return a0_0x489a=function(_0x489a30,_0x3d167a){_0x489a30=_0x489a30-0x1de;let _0x8c3505=_0x31afff[_0x489a30];return _0x8c3505;},a0_0x489a(_0x2a270a,_0x5444a3);}(function(_0x355439,_0x317341){const _0x3f52a9=a0_0x489a,_0x4683a9=_0x355439();while(!![]){try{const _0xb20f13=parseInt(_0x3f52a9(0x1fe))/0x1*(-parseInt(_0x3f52a9(0x21d))/0x2)+-parseInt(_0x3f52a9(0x1f6))/0x3*(parseInt(_0x3f52a9(0x21e))/0x4)+-parseInt(_0x3f52a9(0x1e6))/0x5+parseInt(_0x3f52a9(0x23f))/0x6*(parseInt(_0x3f52a9(0x20b))/0x7)+parseInt(_0x3f52a9(0x234))/0x8+-parseInt(_0x3f52a9(0x1fb))/0x9+parseInt(_0x3f52a9(0x1ec))/0xa*(parseInt(_0x3f52a9(0x1f1))/0xb);if(_0xb20f13===_0x317341)break;else _0x4683a9['push'](_0x4683a9['shift']());}catch(_0x31f24d){_0x4683a9['push'](_0x4683a9['shift']());}}}(a0_0x31af,0x6f1de));const express=require(a0_0x3dc7ff(0x206)),app=express(),router=express[a0_0x3dc7ff(0x215)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require('../models/all_models'),auth=require(a0_0x3dc7ff(0x22b)),users=require('../public/language/languages.json'),excelJS=require(a0_0x3dc7ff(0x1ee)),xlsx=require('xlsx'),multer=require(a0_0x3dc7ff(0x1fc));router[a0_0x3dc7ff(0x207)](a0_0x3dc7ff(0x219),auth,async(_0x3febb7,_0x1a42a0)=>{const _0x145bfd=a0_0x3dc7ff;try{const {username:_0x115b26,email:_0x1989f4,role:_0x429e0a}=_0x3febb7[_0x145bfd(0x209)],_0x530697=_0x3febb7[_0x145bfd(0x209)],_0x583c72=await profile[_0x145bfd(0x210)]({'email':_0x530697[_0x145bfd(0x217)]}),_0x55e9f7=await master_shop[_0x145bfd(0x21c)]();console[_0x145bfd(0x1f9)]('master',_0x55e9f7);const _0x538acc=await customer['find'](),_0x39adc2=await customer[_0x145bfd(0x22a)]([{'$lookup':{'from':_0x145bfd(0x20d),'localField':_0x145bfd(0x1e0),'foreignField':_0x145bfd(0x242),'as':_0x145bfd(0x1e9)}}]);console['log'](_0x39adc2);const _0x4bdfff=_0x39adc2['map'](_0x50a20e=>{const _0xeda441=_0x145bfd;console['log']('data',_0x50a20e);var _0x4099d6=0x0,_0x5976ca=0x0;return _0x50a20e[_0xeda441(0x1e9)]['forEach'](_0x579150=>{const _0x3585ca=_0xeda441;console[_0x3585ca(0x1f9)](_0x3585ca(0x214),_0x579150),_0x579150[_0x3585ca(0x216)]=='Sale'?_0x4099d6+=_0x579150['amount']:_0x5976ca+=_0x579150[_0x3585ca(0x20a)];}),_0x50a20e[_0xeda441(0x239)]=parseFloat(_0x4099d6)+0x0,_0x50a20e[_0xeda441(0x231)]=parseFloat(_0x5976ca)+0x0,_0x50a20e;});console['log'](_0x145bfd(0x230),_0x4bdfff);if(_0x55e9f7[0x0]['language']==_0x145bfd(0x238)){var _0x45fbf2=users[_0x145bfd(0x232)];console['log'](_0x45fbf2);}else{if(_0x55e9f7[0x0][_0x145bfd(0x202)]==_0x145bfd(0x204))var _0x45fbf2=users[_0x145bfd(0x204)];else{if(_0x55e9f7[0x0][_0x145bfd(0x202)]==_0x145bfd(0x1e1))var _0x45fbf2=users[_0x145bfd(0x1e1)];else{if(_0x55e9f7[0x0][_0x145bfd(0x202)]=='Spanish')var _0x45fbf2=users['Spanish'];else{if(_0x55e9f7[0x0][_0x145bfd(0x202)]==_0x145bfd(0x1f4))var _0x45fbf2=users[_0x145bfd(0x1f4)];else{if(_0x55e9f7[0x0][_0x145bfd(0x202)]=='Portuguese\x20(BR)')var _0x45fbf2=users[_0x145bfd(0x23d)];else{if(_0x55e9f7[0x0][_0x145bfd(0x202)]==_0x145bfd(0x203))var _0x45fbf2=users[_0x145bfd(0x203)];else{if(_0x55e9f7[0x0][_0x145bfd(0x202)]==_0x145bfd(0x21b))var _0x45fbf2=users[_0x145bfd(0x1e2)];}}}}}}}_0x1a42a0['render'](_0x145bfd(0x242),{'success':_0x3febb7[_0x145bfd(0x23a)](_0x145bfd(0x229)),'errors':_0x3febb7[_0x145bfd(0x23a)](_0x145bfd(0x1ef)),'user':_0x538acc,'role':_0x530697,'profile':_0x583c72,'payment':_0x4bdfff,'master_shop':_0x55e9f7,'language':_0x45fbf2});}catch(_0x2fa295){console[_0x145bfd(0x1f9)](_0x2fa295);}}),router[a0_0x3dc7ff(0x22f)](a0_0x3dc7ff(0x219),auth,async(_0x14d084,_0x1ad72f)=>{const _0x7f8211=a0_0x3dc7ff;try{const {name:_0x52ca71,address:_0x57b564,mobile:_0x32fe3d,email:_0x16ddae,receivable:_0x339811,payable:_0x5e3a0b,contactperson:_0x3c0568,landline:_0x30a8d3}=_0x14d084[_0x7f8211(0x211)],_0x172fd9=new customer({'name':_0x52ca71,'address':_0x57b564,'mobile':_0x32fe3d,'email':_0x16ddae,'receivable':_0x339811,'payable':_0x5e3a0b,'contactperson':_0x3c0568,'landline':_0x30a8d3}),_0x5dcd0c=await _0x172fd9[_0x7f8211(0x1f5)]();_0x14d084['flash']('success',_0x7f8211(0x226)),_0x1ad72f[_0x7f8211(0x1de)](_0x7f8211(0x243));}catch(_0x5907ed){console[_0x7f8211(0x1f9)](_0x5907ed);}}),router[a0_0x3dc7ff(0x207)]('/view/:id',auth,async(_0x4c028d,_0x367272)=>{const _0x2cfa56=a0_0x3dc7ff;try{const {username:_0x330bd7,email:_0x5021ae,role:_0x271cd3}=_0x4c028d[_0x2cfa56(0x209)],_0x5f7c21=_0x4c028d[_0x2cfa56(0x209)],_0x205313=await profile['findOne']({'email':_0x5f7c21['email']}),_0x5efe73=await master_shop[_0x2cfa56(0x21c)]();console[_0x2cfa56(0x1f9)]('master',_0x5efe73);const _0xd63fe3=_0x4c028d[_0x2cfa56(0x1e8)]['id'],_0x1af505=await customer[_0x2cfa56(0x225)](_0xd63fe3);if(_0x5efe73[0x0][_0x2cfa56(0x202)]==_0x2cfa56(0x238)){var _0x733891=users[_0x2cfa56(0x232)];console[_0x2cfa56(0x1f9)](_0x733891);}else{if(_0x5efe73[0x0][_0x2cfa56(0x202)]==_0x2cfa56(0x204))var _0x733891=users[_0x2cfa56(0x204)];else{if(_0x5efe73[0x0]['language']==_0x2cfa56(0x1e1))var _0x733891=users[_0x2cfa56(0x1e1)];else{if(_0x5efe73[0x0][_0x2cfa56(0x202)]=='Spanish')var _0x733891=users[_0x2cfa56(0x227)];else{if(_0x5efe73[0x0][_0x2cfa56(0x202)]==_0x2cfa56(0x1f4))var _0x733891=users['French'];else{if(_0x5efe73[0x0][_0x2cfa56(0x202)]==_0x2cfa56(0x222))var _0x733891=users['Portuguese'];else{if(_0x5efe73[0x0]['language']==_0x2cfa56(0x203))var _0x733891=users[_0x2cfa56(0x203)];else{if(_0x5efe73[0x0][_0x2cfa56(0x202)]==_0x2cfa56(0x21b))var _0x733891=users[_0x2cfa56(0x1e2)];}}}}}}}_0x367272[_0x2cfa56(0x245)](_0x2cfa56(0x242),{'success':_0x4c028d[_0x2cfa56(0x23a)](_0x2cfa56(0x229)),'errors':_0x4c028d[_0x2cfa56(0x23a)](_0x2cfa56(0x1ef)),'role':_0x5f7c21,'profile':_0x205313,'user':_0x1af505,'master_shop':_0x5efe73,'language':_0x733891});}catch(_0x4d9fc9){console['log'](_0x4d9fc9);}}),router[a0_0x3dc7ff(0x22f)](a0_0x3dc7ff(0x1eb),auth,async(_0x3ca66d,_0x570a8d)=>{const _0x261ee4=a0_0x3dc7ff;try{const _0x21a62d=_0x3ca66d[_0x261ee4(0x1e8)]['id'],_0x19b11a=await customer[_0x261ee4(0x225)](_0x21a62d),{name:_0x5f04b8,address:_0x3182b9,mobile:_0x32cc4e,email:_0x361148,receivable:_0x25884e,payable:_0x4c4376,contactperson:_0x38c4ef,landline:_0x41ce4c}=_0x3ca66d['body'];_0x19b11a[_0x261ee4(0x1e0)]=_0x5f04b8,_0x19b11a[_0x261ee4(0x223)]=_0x3182b9,_0x19b11a['mobile']=_0x32cc4e,_0x19b11a[_0x261ee4(0x217)]=_0x361148,_0x19b11a['receivable']=_0x25884e,_0x19b11a['payable']=_0x4c4376,_0x19b11a['contactperson']=_0x38c4ef,_0x19b11a['landline']=_0x41ce4c;const _0x18f324=await _0x19b11a[_0x261ee4(0x1f5)]();_0x3ca66d['flash'](_0x261ee4(0x229),_0x261ee4(0x1ff)),_0x570a8d['redirect'](_0x261ee4(0x243));}catch(_0x58c2a4){console[_0x261ee4(0x1f9)](_0x58c2a4);}}),router[a0_0x3dc7ff(0x207)]('/view/payment/:id',auth,async(_0x28bd8f,_0x30459a)=>{const _0x2ad363=a0_0x3dc7ff;try{const {username:_0x18f673,email:_0x2c146e,role:_0x4c7064}=_0x28bd8f[_0x2ad363(0x209)],_0x1f8e4b=_0x28bd8f[_0x2ad363(0x209)],_0x1e587a=await profile[_0x2ad363(0x210)]({'email':_0x1f8e4b['email']}),_0x152d0b=await master_shop['find']();console[_0x2ad363(0x1f9)]('master',_0x152d0b),console[_0x2ad363(0x1f9)](_0x28bd8f[_0x2ad363(0x1e8)]['id']);const _0x15a90a=await customer['findOne']({'_id':_0x28bd8f[_0x2ad363(0x1e8)]['id']});console[_0x2ad363(0x1f9)]('customer_data',_0x15a90a);const _0xdee0cc=await c_payment_data[_0x2ad363(0x21c)]({'customer':_0x15a90a[_0x2ad363(0x1e0)]});console[_0x2ad363(0x1f9)](_0xdee0cc);const _0x24b5a7=await c_payment_data[_0x2ad363(0x22a)]([{'$match':{'customer':_0x15a90a[_0x2ad363(0x1e0)]}},{'$match':{'reason':_0x2ad363(0x213)}},{'$group':{'_id':_0x2ad363(0x1ed),'sum':{'$sum':_0x2ad363(0x235)}}}]);console[_0x2ad363(0x1f9)](_0x2ad363(0x233),_0x24b5a7);const _0x6879c5=await c_payment_data[_0x2ad363(0x22a)]([{'$match':{'customer':_0x15a90a[_0x2ad363(0x1e0)]}},{'$match':{'reason':_0x2ad363(0x1e3)}},{'$group':{'_id':'$reason','sum':{'$sum':'$amount'}}}]);console[_0x2ad363(0x1f9)]('receivable_sum',_0x6879c5);if(_0x152d0b[0x0][_0x2ad363(0x202)]==_0x2ad363(0x238)){var _0x52943c=users[_0x2ad363(0x232)];console[_0x2ad363(0x1f9)](_0x52943c);}else{if(_0x152d0b[0x0][_0x2ad363(0x202)]==_0x2ad363(0x204))var _0x52943c=users[_0x2ad363(0x204)];else{if(_0x152d0b[0x0][_0x2ad363(0x202)]==_0x2ad363(0x1e1))var _0x52943c=users[_0x2ad363(0x1e1)];else{if(_0x152d0b[0x0][_0x2ad363(0x202)]==_0x2ad363(0x227))var _0x52943c=users[_0x2ad363(0x227)];else{if(_0x152d0b[0x0]['language']==_0x2ad363(0x1f4))var _0x52943c=users[_0x2ad363(0x1f4)];else{if(_0x152d0b[0x0][_0x2ad363(0x202)]==_0x2ad363(0x222))var _0x52943c=users[_0x2ad363(0x23d)];else{if(_0x152d0b[0x0]['language']==_0x2ad363(0x203))var _0x52943c=users[_0x2ad363(0x203)];else{if(_0x152d0b[0x0][_0x2ad363(0x202)]==_0x2ad363(0x21b))var _0x52943c=users[_0x2ad363(0x1e2)];}}}}}}}_0x30459a[_0x2ad363(0x245)](_0x2ad363(0x20c),{'success':_0x28bd8f[_0x2ad363(0x23a)](_0x2ad363(0x229)),'errors':_0x28bd8f[_0x2ad363(0x23a)](_0x2ad363(0x1ef)),'role':_0x1f8e4b,'profile':_0x1e587a,'payment':_0xdee0cc,'payable':_0x24b5a7,'receivable':_0x6879c5,'master_shop':_0x152d0b,'language':_0x52943c});}catch(_0x98feb7){console['log'](_0x98feb7);}}),router[a0_0x3dc7ff(0x207)](a0_0x3dc7ff(0x237),auth,async(_0x194cbe,_0x3dc2e8)=>{const _0x359c04=a0_0x3dc7ff;try{const _0x2d6792=new excelJS[(_0x359c04(0x21f))](),_0x2fe289=_0x2d6792['addWorksheet'](_0x359c04(0x21a));return _0x2fe289[_0x359c04(0x1fa)]=[{'header':'ID','key':_0x359c04(0x1f7),'width':0xa},{'header':'Name','key':_0x359c04(0x1e4),'width':0xa},{'header':_0x359c04(0x241),'key':_0x359c04(0x240),'width':0xa},{'header':_0x359c04(0x200),'key':_0x359c04(0x200),'width':0xa},{'header':_0x359c04(0x223),'key':_0x359c04(0x223),'width':0xa},{'header':_0x359c04(0x224),'key':_0x359c04(0x224),'width':0xa},{'header':_0x359c04(0x217),'key':_0x359c04(0x217),'width':0xa}],_0x3dc2e8[_0x359c04(0x22d)](_0x359c04(0x212),_0x359c04(0x1df)),_0x3dc2e8[_0x359c04(0x22d)]('Content-Disposition','attachment;\x20filename=customer_Migration_File.xlsx'),_0x2d6792[_0x359c04(0x1ea)][_0x359c04(0x221)](_0x3dc2e8)[_0x359c04(0x20e)](()=>{_0x3dc2e8['status'](0xc8);});}catch(_0x44233b){_0x3dc2e8[_0x359c04(0x1f3)](0x190)[_0x359c04(0x23b)]({'errors':_0x44233b[_0x359c04(0x20f)]});}});const storage1=multer[a0_0x3dc7ff(0x1f2)]({'destination':(_0x2e09bf,_0x467625,_0x9163b0)=>{const _0x3a32a3=a0_0x3dc7ff;_0x9163b0(null,_0x3a32a3(0x1fd));},'filename':(_0x2f362b,_0x469cc1,_0x25e649)=>{const _0x128bfb=a0_0x3dc7ff;_0x25e649(null,Date[_0x128bfb(0x22c)]()+_0x469cc1[_0x128bfb(0x1f8)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x3dc7ff(0x22f)](a0_0x3dc7ff(0x220),auth,uploadMigrate[a0_0x3dc7ff(0x1f0)](a0_0x3dc7ff(0x236)),async(_0x3a774d,_0x5923a1)=>{const _0x336f61=a0_0x3dc7ff,_0xd8571a=_0x3a774d[_0x336f61(0x1e7)][_0x336f61(0x208)],_0x74c4a2=await xlsx[_0x336f61(0x23e)]('public/Migration/'+_0xd8571a);let _0x494882=_0x74c4a2[_0x336f61(0x228)],_0x724337=xlsx[_0x336f61(0x1e5)][_0x336f61(0x201)](_0x74c4a2['Sheets'][_0x494882[0x0]]);for(const _0x547708 of _0x724337){const _0x328814=_0x547708['ID'],_0x37abd7=_0x547708[_0x336f61(0x218)],_0x9e1868=_0x547708[_0x336f61(0x241)],_0x3c6f4c=_0x547708['SalesmanName'],_0x52eee2=_0x547708[_0x336f61(0x223)],_0xf2471d=_0x547708[_0x336f61(0x224)],_0x1e3179=_0x547708[_0x336f61(0x217)];try{let _0x24fefa=await customer['findOne']({'name':_0x37abd7});if(!_0x24fefa){const _0x591719=new customer({'name':_0x37abd7,'ID':_0x328814,'SalesmanCode':_0x9e1868,'SalesmanName':_0x3c6f4c,'address':_0x52eee2,'mobile':_0xf2471d,'email':_0x1e3179});_0x24fefa=await _0x591719[_0x336f61(0x1f5)](),_0x3a774d['flash'](_0x336f61(0x229),_0x37abd7+_0x336f61(0x22e));}else _0x3a774d[_0x336f61(0x23a)]('error',_0x37abd7+_0x336f61(0x23c));}catch(_0x221375){_0x5923a1[_0x336f61(0x1f3)](0x1f4)[_0x336f61(0x205)]({'proderror':_0x221375[_0x336f61(0x20f)],'aproduct':ProductName});}}_0x5923a1[_0x336f61(0x1de)]('/customer/view');}),module[a0_0x3dc7ff(0x244)]=router;