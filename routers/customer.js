const a0_0x260cbd=a0_0x41f6;function a0_0x465c(){const _0x398323=['public/Migration','status','Router','findById','success','/view/payment/:id','render','954522VslAVs','Portuguese\x20(BR)','post','flash','sale_return','utils','sheet_to_json','Arabic\x20(ae)','customer\x20add\x20successfully','\x20added\x20successfully','errors','amount','German','1059NeOYzh','json','then','PUnits','payment_data','exceljs','mobile','Workbook','Sale\x20Return','findOne','$amount','redirect','SalesmanCode','find','100Efqbws','map','message','express','readFile','filename','master','columns','write','7EXNyEV','../models/all_models','English','$reason','10XtnVzz','\x20Failed','landline','element','get','name','save','receivable_sum','customer_docs','address','customer_data','/customer/view','French','12256123fLXuXM','contactperson','Content-Type','2179265ehedgN','single','Arabic','6106626oykHVz','exports','file','log','12PfgurI','receivable','user','xlsx','66113ZaFQoG','payable_sum','Sheets','params','English\x20(US)','multer','Spanish','/view','setHeader','originalname','/view/:id','reason','email','/products_export_migrate_file','aggregate','c_payments','Content-Disposition','/customer_import_migrate_file','../middleware/auth','customer','Chinese','3486936mWNGUJ','language','Portuguese','addWorksheet','SalesmanName','Hindi','error','body','payable','diskStorage','public/Migration/','12560VVvcJV','Name'];a0_0x465c=function(){return _0x398323;};return a0_0x465c();}(function(_0x39bcbf,_0x13852b){const _0x281dac=a0_0x41f6,_0x574094=_0x39bcbf();while(!![]){try{const _0x5250b5=parseInt(_0x281dac(0x1ba))/0x1*(-parseInt(_0x281dac(0x19f))/0x2)+parseInt(_0x281dac(0x1f0))/0x3*(parseInt(_0x281dac(0x1da))/0x4)+parseInt(_0x281dac(0x1af))/0x5+-parseInt(_0x281dac(0x1b2))/0x6*(parseInt(_0x281dac(0x19b))/0x7)+parseInt(_0x281dac(0x1cf))/0x8+-parseInt(_0x281dac(0x1e3))/0x9*(-parseInt(_0x281dac(0x1fe))/0xa)+parseInt(_0x281dac(0x1ac))/0xb*(-parseInt(_0x281dac(0x1b6))/0xc);if(_0x5250b5===_0x13852b)break;else _0x574094['push'](_0x574094['shift']());}catch(_0x304900){_0x574094['push'](_0x574094['shift']());}}}(a0_0x465c,0x8d28f));function a0_0x41f6(_0x306814,_0x5df0ed){const _0x465c5a=a0_0x465c();return a0_0x41f6=function(_0x41f688,_0x4e036f){_0x41f688=_0x41f688-0x195;let _0x25e8ab=_0x465c5a[_0x41f688];return _0x25e8ab;},a0_0x41f6(_0x306814,_0x5df0ed);}const express=require(a0_0x260cbd(0x195)),app=express(),router=express[a0_0x260cbd(0x1de)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x260cbd(0x19c)),auth=require(a0_0x260cbd(0x1cc)),users=require('../public/language/languages.json'),excelJS=require(a0_0x260cbd(0x1f5)),xlsx=require('xlsx'),multer=require(a0_0x260cbd(0x1bf));router[a0_0x260cbd(0x1a3)](a0_0x260cbd(0x1c1),auth,async(_0x4f5c56,_0x5ee739)=>{const _0x361b57=a0_0x260cbd;try{const {username:_0x32bf0e,email:_0x4e3f28,role:_0x55d9fc}=_0x4f5c56['user'],_0x9e46bc=_0x4f5c56[_0x361b57(0x1b8)],_0x5e8971=await profile['findOne']({'email':_0x9e46bc[_0x361b57(0x1c6)]}),_0xc07402=await master_shop[_0x361b57(0x1fd)]();console[_0x361b57(0x1b5)](_0x361b57(0x198),_0xc07402);const _0x3c28c5=await customer['find'](),_0x3af4d5=await customer[_0x361b57(0x1c8)]([{'$lookup':{'from':_0x361b57(0x1c9),'localField':_0x361b57(0x1a4),'foreignField':'customer','as':_0x361b57(0x1a7)}}]);console[_0x361b57(0x1b5)](_0x3af4d5);const _0x46b633=_0x3af4d5[_0x361b57(0x1ff)](_0x26c36c=>{const _0x39e71a=_0x361b57;console[_0x39e71a(0x1b5)]('data',_0x26c36c);var _0x4c02a9=0x0,_0x130c93=0x0;return _0x26c36c[_0x39e71a(0x1a7)]['forEach'](_0x284de2=>{const _0x904e5d=_0x39e71a;console['log'](_0x904e5d(0x1a2),_0x284de2),_0x284de2[_0x904e5d(0x1c5)]=='Sale'?_0x4c02a9+=_0x284de2[_0x904e5d(0x1ee)]:_0x130c93+=_0x284de2['amount'];}),_0x26c36c['sale']=parseFloat(_0x4c02a9)+0x0,_0x26c36c[_0x39e71a(0x1e7)]=parseFloat(_0x130c93)+0x0,_0x26c36c;});console[_0x361b57(0x1b5)](_0x361b57(0x1f4),_0x46b633);if(_0xc07402[0x0]['language']==_0x361b57(0x1be)){var _0x543691=users['English'];console[_0x361b57(0x1b5)](_0x543691);}else{if(_0xc07402[0x0][_0x361b57(0x1d0)]==_0x361b57(0x1d4))var _0x543691=users[_0x361b57(0x1d4)];else{if(_0xc07402[0x0][_0x361b57(0x1d0)]==_0x361b57(0x1ef))var _0x543691=users[_0x361b57(0x1ef)];else{if(_0xc07402[0x0][_0x361b57(0x1d0)]==_0x361b57(0x1c0))var _0x543691=users['Spanish'];else{if(_0xc07402[0x0]['language']==_0x361b57(0x1ab))var _0x543691=users['French'];else{if(_0xc07402[0x0][_0x361b57(0x1d0)]=='Portuguese\x20(BR)')var _0x543691=users['Portuguese'];else{if(_0xc07402[0x0][_0x361b57(0x1d0)]==_0x361b57(0x1ce))var _0x543691=users[_0x361b57(0x1ce)];else{if(_0xc07402[0x0][_0x361b57(0x1d0)]=='Arabic\x20(ae)')var _0x543691=users[_0x361b57(0x1b1)];}}}}}}}_0x5ee739[_0x361b57(0x1e2)](_0x361b57(0x1cd),{'success':_0x4f5c56[_0x361b57(0x1e6)](_0x361b57(0x1e0)),'errors':_0x4f5c56[_0x361b57(0x1e6)]('errors'),'user':_0x3c28c5,'role':_0x9e46bc,'profile':_0x5e8971,'payment':_0x46b633,'master_shop':_0xc07402,'language':_0x543691});}catch(_0x51c012){console[_0x361b57(0x1b5)](_0x51c012);}}),router[a0_0x260cbd(0x1e5)]('/view',auth,async(_0x19b6ec,_0x42fbd5)=>{const _0x57fc3b=a0_0x260cbd;try{const {name:_0x53b18d,address:_0x292ea7,mobile:_0x3b6fdb,email:_0x3a7bf6,receivable:_0x172a79,payable:_0xf48630,contactperson:_0x1caf78,landline:_0x3b407a}=_0x19b6ec[_0x57fc3b(0x1d6)],_0x99f30e=new customer({'name':_0x53b18d,'address':_0x292ea7,'mobile':_0x3b6fdb,'email':_0x3a7bf6,'receivable':_0x172a79,'payable':_0xf48630,'contactperson':_0x1caf78,'landline':_0x3b407a}),_0x1f6f18=await _0x99f30e['save']();_0x19b6ec[_0x57fc3b(0x1e6)](_0x57fc3b(0x1e0),_0x57fc3b(0x1eb)),_0x42fbd5[_0x57fc3b(0x1fb)](_0x57fc3b(0x1aa));}catch(_0x98ef57){console[_0x57fc3b(0x1b5)](_0x98ef57);}}),router[a0_0x260cbd(0x1a3)]('/view/:id',auth,async(_0x141792,_0x4a3ee9)=>{const _0x20266d=a0_0x260cbd;try{const {username:_0x141940,email:_0x17030c,role:_0xbbf034}=_0x141792[_0x20266d(0x1b8)],_0x15fd19=_0x141792[_0x20266d(0x1b8)],_0x1a231e=await profile['findOne']({'email':_0x15fd19[_0x20266d(0x1c6)]}),_0x4f0cf9=await master_shop['find']();console[_0x20266d(0x1b5)](_0x20266d(0x198),_0x4f0cf9);const _0x1b4238=_0x141792[_0x20266d(0x1bd)]['id'],_0x8d88db=await customer[_0x20266d(0x1df)](_0x1b4238);if(_0x4f0cf9[0x0][_0x20266d(0x1d0)]==_0x20266d(0x1be)){var _0x41e0ce=users[_0x20266d(0x19d)];console['log'](_0x41e0ce);}else{if(_0x4f0cf9[0x0][_0x20266d(0x1d0)]==_0x20266d(0x1d4))var _0x41e0ce=users[_0x20266d(0x1d4)];else{if(_0x4f0cf9[0x0]['language']=='German')var _0x41e0ce=users['German'];else{if(_0x4f0cf9[0x0]['language']==_0x20266d(0x1c0))var _0x41e0ce=users[_0x20266d(0x1c0)];else{if(_0x4f0cf9[0x0][_0x20266d(0x1d0)]=='French')var _0x41e0ce=users[_0x20266d(0x1ab)];else{if(_0x4f0cf9[0x0]['language']==_0x20266d(0x1e4))var _0x41e0ce=users[_0x20266d(0x1d1)];else{if(_0x4f0cf9[0x0][_0x20266d(0x1d0)]==_0x20266d(0x1ce))var _0x41e0ce=users[_0x20266d(0x1ce)];else{if(_0x4f0cf9[0x0][_0x20266d(0x1d0)]=='Arabic\x20(ae)')var _0x41e0ce=users['Arabic'];}}}}}}}_0x4a3ee9[_0x20266d(0x1e2)](_0x20266d(0x1cd),{'success':_0x141792[_0x20266d(0x1e6)]('success'),'errors':_0x141792[_0x20266d(0x1e6)](_0x20266d(0x1ed)),'role':_0x15fd19,'profile':_0x1a231e,'user':_0x8d88db,'master_shop':_0x4f0cf9,'language':_0x41e0ce});}catch(_0x46771f){console[_0x20266d(0x1b5)](_0x46771f);}}),router[a0_0x260cbd(0x1e5)](a0_0x260cbd(0x1c4),auth,async(_0x4e8f1,_0x19e851)=>{const _0x94d9d5=a0_0x260cbd;try{const _0x573f90=_0x4e8f1['params']['id'],_0x38e541=await customer['findById'](_0x573f90),{name:_0x502b9a,address:_0x1a4fae,mobile:_0x364e82,email:_0x324407,receivable:_0x506a7c,payable:_0x2cd7c2,contactperson:_0x2e9b27,landline:_0x506d48}=_0x4e8f1[_0x94d9d5(0x1d6)];_0x38e541[_0x94d9d5(0x1a4)]=_0x502b9a,_0x38e541[_0x94d9d5(0x1a8)]=_0x1a4fae,_0x38e541[_0x94d9d5(0x1f6)]=_0x364e82,_0x38e541[_0x94d9d5(0x1c6)]=_0x324407,_0x38e541[_0x94d9d5(0x1b7)]=_0x506a7c,_0x38e541[_0x94d9d5(0x1d7)]=_0x2cd7c2,_0x38e541[_0x94d9d5(0x1ad)]=_0x2e9b27,_0x38e541[_0x94d9d5(0x1a1)]=_0x506d48;const _0x2c363a=await _0x38e541[_0x94d9d5(0x1a5)]();_0x4e8f1['flash']('success','customer\x20update\x20successfully'),_0x19e851[_0x94d9d5(0x1fb)]('/customer/view');}catch(_0x26db05){console[_0x94d9d5(0x1b5)](_0x26db05);}}),router[a0_0x260cbd(0x1a3)](a0_0x260cbd(0x1e1),auth,async(_0x165696,_0x19c2e2)=>{const _0x396cc1=a0_0x260cbd;try{const {username:_0x3a312d,email:_0x3f96eb,role:_0x4c365b}=_0x165696[_0x396cc1(0x1b8)],_0x581c18=_0x165696[_0x396cc1(0x1b8)],_0x2d4a0f=await profile['findOne']({'email':_0x581c18[_0x396cc1(0x1c6)]}),_0x141d87=await master_shop[_0x396cc1(0x1fd)]();console[_0x396cc1(0x1b5)](_0x396cc1(0x198),_0x141d87),console[_0x396cc1(0x1b5)](_0x165696[_0x396cc1(0x1bd)]['id']);const _0x389531=await customer[_0x396cc1(0x1f9)]({'_id':_0x165696[_0x396cc1(0x1bd)]['id']});console[_0x396cc1(0x1b5)](_0x396cc1(0x1a9),_0x389531);const _0x5bb91b=await c_payment_data[_0x396cc1(0x1fd)]({'customer':_0x389531[_0x396cc1(0x1a4)]});console[_0x396cc1(0x1b5)](_0x5bb91b);const _0x2b58c7=await c_payment_data[_0x396cc1(0x1c8)]([{'$match':{'customer':_0x389531[_0x396cc1(0x1a4)]}},{'$match':{'reason':'Sale'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x396cc1(0x1fa)}}}]);console[_0x396cc1(0x1b5)](_0x396cc1(0x1bb),_0x2b58c7);const _0x434afe=await c_payment_data[_0x396cc1(0x1c8)]([{'$match':{'customer':_0x389531['name']}},{'$match':{'reason':_0x396cc1(0x1f8)}},{'$group':{'_id':_0x396cc1(0x19e),'sum':{'$sum':'$amount'}}}]);console['log'](_0x396cc1(0x1a6),_0x434afe);if(_0x141d87[0x0][_0x396cc1(0x1d0)]=='English\x20(US)'){var _0x12f31f=users[_0x396cc1(0x19d)];console[_0x396cc1(0x1b5)](_0x12f31f);}else{if(_0x141d87[0x0]['language']==_0x396cc1(0x1d4))var _0x12f31f=users['Hindi'];else{if(_0x141d87[0x0][_0x396cc1(0x1d0)]==_0x396cc1(0x1ef))var _0x12f31f=users[_0x396cc1(0x1ef)];else{if(_0x141d87[0x0][_0x396cc1(0x1d0)]==_0x396cc1(0x1c0))var _0x12f31f=users['Spanish'];else{if(_0x141d87[0x0]['language']==_0x396cc1(0x1ab))var _0x12f31f=users[_0x396cc1(0x1ab)];else{if(_0x141d87[0x0]['language']==_0x396cc1(0x1e4))var _0x12f31f=users[_0x396cc1(0x1d1)];else{if(_0x141d87[0x0][_0x396cc1(0x1d0)]==_0x396cc1(0x1ce))var _0x12f31f=users[_0x396cc1(0x1ce)];else{if(_0x141d87[0x0][_0x396cc1(0x1d0)]==_0x396cc1(0x1ea))var _0x12f31f=users[_0x396cc1(0x1b1)];}}}}}}}_0x19c2e2[_0x396cc1(0x1e2)]('customer_payment',{'success':_0x165696[_0x396cc1(0x1e6)](_0x396cc1(0x1e0)),'errors':_0x165696[_0x396cc1(0x1e6)](_0x396cc1(0x1ed)),'role':_0x581c18,'profile':_0x2d4a0f,'payment':_0x5bb91b,'payable':_0x2b58c7,'receivable':_0x434afe,'master_shop':_0x141d87,'language':_0x12f31f});}catch(_0x1670de){console['log'](_0x1670de);}}),router[a0_0x260cbd(0x1a3)](a0_0x260cbd(0x1c7),auth,async(_0x14b78b,_0x311212)=>{const _0x1afe79=a0_0x260cbd;try{const _0x4a1a50=new excelJS[(_0x1afe79(0x1f7))](),_0x121e6b=_0x4a1a50[_0x1afe79(0x1d2)]('Customers');return _0x121e6b[_0x1afe79(0x199)]=[{'header':'ID','key':'PName','width':0xa},{'header':_0x1afe79(0x1db),'key':'PBrands','width':0xa},{'header':_0x1afe79(0x1fc),'key':_0x1afe79(0x1f3),'width':0xa},{'header':_0x1afe79(0x1d3),'key':_0x1afe79(0x1d3),'width':0xa},{'header':_0x1afe79(0x1a8),'key':_0x1afe79(0x1a8),'width':0xa},{'header':_0x1afe79(0x1f6),'key':_0x1afe79(0x1f6),'width':0xa},{'header':'email','key':'email','width':0xa}],_0x311212[_0x1afe79(0x1c2)](_0x1afe79(0x1ae),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x311212[_0x1afe79(0x1c2)](_0x1afe79(0x1ca),'attachment;\x20filename=customer_Migration_File.xlsx'),_0x4a1a50[_0x1afe79(0x1b9)][_0x1afe79(0x19a)](_0x311212)[_0x1afe79(0x1f2)](()=>{const _0xb3d6ef=_0x1afe79;_0x311212[_0xb3d6ef(0x1dd)](0xc8);});}catch(_0x297d55){_0x311212[_0x1afe79(0x1dd)](0x190)['send']({'errors':_0x297d55[_0x1afe79(0x200)]});}});const storage1=multer[a0_0x260cbd(0x1d8)]({'destination':(_0x5ad962,_0x1d1c45,_0x2f25f2)=>{const _0x19c2a0=a0_0x260cbd;_0x2f25f2(null,_0x19c2a0(0x1dc));},'filename':(_0x57c6b5,_0x59a41f,_0x442eaf)=>{const _0x145916=a0_0x260cbd;_0x442eaf(null,Date['now']()+_0x59a41f[_0x145916(0x1c3)]);}}),uploadMigrate=multer({'storage':storage1});router['post'](a0_0x260cbd(0x1cb),auth,uploadMigrate[a0_0x260cbd(0x1b0)]('customer_product_fule'),async(_0x2fa65d,_0x415452)=>{const _0x490552=a0_0x260cbd,_0x562dbc=_0x2fa65d[_0x490552(0x1b4)][_0x490552(0x197)],_0x33edc4=await xlsx[_0x490552(0x196)](_0x490552(0x1d9)+_0x562dbc);let _0x4b4458=_0x33edc4['SheetNames'],_0x28a57c=xlsx[_0x490552(0x1e8)][_0x490552(0x1e9)](_0x33edc4[_0x490552(0x1bc)][_0x4b4458[0x0]]);for(const _0x17971b of _0x28a57c){const _0x3d1f56=_0x17971b['ID'],_0x15d807=_0x17971b['Name'],_0x54fd26=_0x17971b['SalesmanCode'],_0x2dc917=_0x17971b['SalesmanName'],_0x3b57a1=_0x17971b[_0x490552(0x1a8)],_0x862f64=_0x17971b[_0x490552(0x1f6)],_0x4b97eb=_0x17971b['email'];try{let _0x3ffad7=await customer['findOne']({'name':_0x15d807});if(!_0x3ffad7){const _0x7f892d=new customer({'name':_0x15d807,'ID':_0x3d1f56,'SalesmanCode':_0x54fd26,'SalesmanName':_0x2dc917,'address':_0x3b57a1,'mobile':_0x862f64,'email':_0x4b97eb});_0x3ffad7=await _0x7f892d[_0x490552(0x1a5)](),_0x2fa65d[_0x490552(0x1e6)](_0x490552(0x1e0),_0x15d807+_0x490552(0x1ec));}else _0x2fa65d[_0x490552(0x1e6)](_0x490552(0x1d5),_0x15d807+_0x490552(0x1a0));}catch(_0x5da3d9){_0x415452[_0x490552(0x1dd)](0x1f4)[_0x490552(0x1f1)]({'proderror':_0x5da3d9[_0x490552(0x200)],'aproduct':ProductName});}}_0x415452[_0x490552(0x1fb)](_0x490552(0x1aa));}),module[a0_0x260cbd(0x1b3)]=router;