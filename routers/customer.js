const a0_0x1fed56=a0_0x564e;function a0_0x1b4e(){const _0x26656e=['status','address','99303xGaKSR','findById','383778sAurHf','attachment;\x20filename=customer_Migration_File.xlsx','post','Router','master','/view/payment/:id','sale_return','SalesmanCode','message','contactperson','customer_docs','/view','customer_payment','json','payable','public/Migration/','language','sheet_to_json','log','Sale','setHeader','name','/view/:id','/products_export_migrate_file','257528EVkCcy','originalname','receivable','Workbook','German','32GQkAwm','Hindi','redirect','67548sjrGLl','file','columns','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','success','9fEaSWw','77YTJteV','English\x20(US)','Content-Disposition','PName','$amount','Arabic','utils','Name','Portuguese\x20(BR)','$reason','errors','mobile','French','Sheets','forEach','single','Chinese','Sale\x20Return','../middleware/auth','element','xlsx','c_payments','write','amount','multer','get','/customer_import_migrate_file','then','20TGycgu','readFile','findOne','PBrands','2271070GblcYr','SheetNames','Arabic\x20(ae)','body','now','params','English','customer','payment_data','flash','data','customer\x20update\x20successfully','find','receivable_sum','email','../models/all_models','save','SalesmanName','filename','../public/language/languages.json','render','Spanish','/customer/view','exceljs','user','aggregate','public/Migration','6196452UWIyud','addWorksheet','customer_product_fule','Portuguese','payable_sum','11IfqoiW','544421ImBYtz'];a0_0x1b4e=function(){return _0x26656e;};return a0_0x1b4e();}function a0_0x564e(_0x202d42,_0x198ee3){const _0x1b4e30=a0_0x1b4e();return a0_0x564e=function(_0x564ec3,_0x57552b){_0x564ec3=_0x564ec3-0x105;let _0x4fd3b8=_0x1b4e30[_0x564ec3];return _0x4fd3b8;},a0_0x564e(_0x202d42,_0x198ee3);}(function(_0x2d6469,_0x38a0d4){const _0x834633=a0_0x564e,_0xcfdf19=_0x2d6469();while(!![]){try{const _0x4d1f34=parseInt(_0x834633(0x15c))/0x1+-parseInt(_0x834633(0x161))/0x2+-parseInt(_0x834633(0x15f))/0x3*(-parseInt(_0x834633(0x112))/0x4)+-parseInt(_0x834633(0x137))/0x5*(-parseInt(_0x834633(0x115))/0x6)+-parseInt(_0x834633(0x11b))/0x7*(-parseInt(_0x834633(0x10d))/0x8)+parseInt(_0x834633(0x11a))/0x9*(-parseInt(_0x834633(0x13b))/0xa)+-parseInt(_0x834633(0x15b))/0xb*(parseInt(_0x834633(0x156))/0xc);if(_0x4d1f34===_0x38a0d4)break;else _0xcfdf19['push'](_0xcfdf19['shift']());}catch(_0x2f45b1){_0xcfdf19['push'](_0xcfdf19['shift']());}}}(a0_0x1b4e,0x42a63));const express=require('express'),app=express(),router=express[a0_0x1fed56(0x164)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,customer_payment,c_payment_data,sing_up}=require(a0_0x1fed56(0x14a)),auth=require(a0_0x1fed56(0x12d)),users=require(a0_0x1fed56(0x14e)),excelJS=require(a0_0x1fed56(0x152)),xlsx=require('xlsx'),multer=require(a0_0x1fed56(0x133));router['get'](a0_0x1fed56(0x16c),auth,async(_0x3fc8a4,_0x50a517)=>{const _0x150e05=a0_0x1fed56;try{const {username:_0x508c41,email:_0x277b2d,role:_0x5dd770}=_0x3fc8a4[_0x150e05(0x153)],_0x173b01=_0x3fc8a4[_0x150e05(0x153)],_0x23c3d9=await profile[_0x150e05(0x139)]({'email':_0x173b01[_0x150e05(0x149)]}),_0x4115cd=await master_shop[_0x150e05(0x147)]();console['log'](_0x150e05(0x165),_0x4115cd);const _0xb08bf2=await customer[_0x150e05(0x147)](),_0x1bdc5f=await customer[_0x150e05(0x154)]([{'$lookup':{'from':_0x150e05(0x130),'localField':_0x150e05(0x10a),'foreignField':'customer','as':_0x150e05(0x16b)}}]);console[_0x150e05(0x107)](_0x1bdc5f);const _0x229535=_0x1bdc5f['map'](_0x1e8be7=>{const _0x1a57aa=_0x150e05;console[_0x1a57aa(0x107)](_0x1a57aa(0x145),_0x1e8be7);var _0x3bbd17=0x0,_0x4ca643=0x0;return _0x1e8be7[_0x1a57aa(0x16b)][_0x1a57aa(0x129)](_0xf904fa=>{const _0x39bf26=_0x1a57aa;console[_0x39bf26(0x107)](_0x39bf26(0x12e),_0xf904fa),_0xf904fa['reason']==_0x39bf26(0x108)?_0x3bbd17+=_0xf904fa[_0x39bf26(0x132)]:_0x4ca643+=_0xf904fa['amount'];}),_0x1e8be7['sale']=parseFloat(_0x3bbd17)+0x0,_0x1e8be7[_0x1a57aa(0x167)]=parseFloat(_0x4ca643)+0x0,_0x1e8be7;});console['log'](_0x150e05(0x143),_0x229535);if(_0x4115cd[0x0]['language']==_0x150e05(0x11c)){var _0x20af17=users[_0x150e05(0x141)];console[_0x150e05(0x107)](_0x20af17);}else{if(_0x4115cd[0x0]['language']==_0x150e05(0x113))var _0x20af17=users[_0x150e05(0x113)];else{if(_0x4115cd[0x0][_0x150e05(0x105)]=='German')var _0x20af17=users[_0x150e05(0x111)];else{if(_0x4115cd[0x0][_0x150e05(0x105)]==_0x150e05(0x150))var _0x20af17=users['Spanish'];else{if(_0x4115cd[0x0][_0x150e05(0x105)]==_0x150e05(0x127))var _0x20af17=users[_0x150e05(0x127)];else{if(_0x4115cd[0x0][_0x150e05(0x105)]=='Portuguese\x20(BR)')var _0x20af17=users['Portuguese'];else{if(_0x4115cd[0x0][_0x150e05(0x105)]=='Chinese')var _0x20af17=users[_0x150e05(0x12b)];else{if(_0x4115cd[0x0]['language']==_0x150e05(0x13d))var _0x20af17=users['Arabic'];}}}}}}}_0x50a517[_0x150e05(0x14f)](_0x150e05(0x142),{'success':_0x3fc8a4['flash'](_0x150e05(0x119)),'errors':_0x3fc8a4['flash'](_0x150e05(0x125)),'user':_0xb08bf2,'role':_0x173b01,'profile':_0x23c3d9,'payment':_0x229535,'master_shop':_0x4115cd,'language':_0x20af17});}catch(_0x496122){console[_0x150e05(0x107)](_0x496122);}}),router[a0_0x1fed56(0x163)](a0_0x1fed56(0x16c),auth,async(_0x4ebdef,_0x27c143)=>{const _0xc6b25=a0_0x1fed56;try{const {name:_0x3b9080,address:_0x5d4a96,mobile:_0x4c5539,email:_0x1524bc,receivable:_0x3bbc91,payable:_0x491f9f,contactperson:_0x43b74e,landline:_0x41a994}=_0x4ebdef[_0xc6b25(0x13e)],_0x38315d=new customer({'name':_0x3b9080,'address':_0x5d4a96,'mobile':_0x4c5539,'email':_0x1524bc,'receivable':_0x3bbc91,'payable':_0x491f9f,'contactperson':_0x43b74e,'landline':_0x41a994}),_0xf9a0fc=await _0x38315d[_0xc6b25(0x14b)]();_0x4ebdef[_0xc6b25(0x144)](_0xc6b25(0x119),'customer\x20add\x20successfully'),_0x27c143[_0xc6b25(0x114)](_0xc6b25(0x151));}catch(_0x13808e){console[_0xc6b25(0x107)](_0x13808e);}}),router['get'](a0_0x1fed56(0x10b),auth,async(_0x22b17a,_0x42f3a2)=>{const _0x3b8d99=a0_0x1fed56;try{const {username:_0x14a9e6,email:_0x1992cf,role:_0x422f66}=_0x22b17a[_0x3b8d99(0x153)],_0x4e8100=_0x22b17a[_0x3b8d99(0x153)],_0x38b088=await profile['findOne']({'email':_0x4e8100[_0x3b8d99(0x149)]}),_0x32cd41=await master_shop[_0x3b8d99(0x147)]();console['log'](_0x3b8d99(0x165),_0x32cd41);const _0x3b877b=_0x22b17a[_0x3b8d99(0x140)]['id'],_0x3217b9=await customer[_0x3b8d99(0x160)](_0x3b877b);if(_0x32cd41[0x0][_0x3b8d99(0x105)]==_0x3b8d99(0x11c)){var _0x2fc083=users['English'];console[_0x3b8d99(0x107)](_0x2fc083);}else{if(_0x32cd41[0x0][_0x3b8d99(0x105)]==_0x3b8d99(0x113))var _0x2fc083=users[_0x3b8d99(0x113)];else{if(_0x32cd41[0x0][_0x3b8d99(0x105)]==_0x3b8d99(0x111))var _0x2fc083=users[_0x3b8d99(0x111)];else{if(_0x32cd41[0x0][_0x3b8d99(0x105)]==_0x3b8d99(0x150))var _0x2fc083=users['Spanish'];else{if(_0x32cd41[0x0][_0x3b8d99(0x105)]==_0x3b8d99(0x127))var _0x2fc083=users[_0x3b8d99(0x127)];else{if(_0x32cd41[0x0]['language']==_0x3b8d99(0x123))var _0x2fc083=users[_0x3b8d99(0x159)];else{if(_0x32cd41[0x0][_0x3b8d99(0x105)]==_0x3b8d99(0x12b))var _0x2fc083=users['Chinese'];else{if(_0x32cd41[0x0][_0x3b8d99(0x105)]==_0x3b8d99(0x13d))var _0x2fc083=users[_0x3b8d99(0x120)];}}}}}}}_0x42f3a2['render']('customer',{'success':_0x22b17a[_0x3b8d99(0x144)](_0x3b8d99(0x119)),'errors':_0x22b17a[_0x3b8d99(0x144)]('errors'),'role':_0x4e8100,'profile':_0x38b088,'user':_0x3217b9,'master_shop':_0x32cd41,'language':_0x2fc083});}catch(_0x272853){console[_0x3b8d99(0x107)](_0x272853);}}),router[a0_0x1fed56(0x163)]('/view/:id',auth,async(_0x25a4f9,_0x28e72b)=>{const _0x32b01f=a0_0x1fed56;try{const _0x4677cf=_0x25a4f9['params']['id'],_0x2509e7=await customer['findById'](_0x4677cf),{name:_0x19187a,address:_0x5336ee,mobile:_0x269de7,email:_0x452311,receivable:_0xd1e317,payable:_0x406d04,contactperson:_0x7ddb34,landline:_0x55f1ef}=_0x25a4f9[_0x32b01f(0x13e)];_0x2509e7[_0x32b01f(0x10a)]=_0x19187a,_0x2509e7['address']=_0x5336ee,_0x2509e7[_0x32b01f(0x126)]=_0x269de7,_0x2509e7['email']=_0x452311,_0x2509e7[_0x32b01f(0x10f)]=_0xd1e317,_0x2509e7[_0x32b01f(0x16f)]=_0x406d04,_0x2509e7[_0x32b01f(0x16a)]=_0x7ddb34,_0x2509e7['landline']=_0x55f1ef;const _0x312a90=await _0x2509e7['save']();_0x25a4f9[_0x32b01f(0x144)](_0x32b01f(0x119),_0x32b01f(0x146)),_0x28e72b['redirect'](_0x32b01f(0x151));}catch(_0x4170e4){console[_0x32b01f(0x107)](_0x4170e4);}}),router[a0_0x1fed56(0x134)](a0_0x1fed56(0x166),auth,async(_0x51eb39,_0x205445)=>{const _0x3991d3=a0_0x1fed56;try{const {username:_0x2f6c1e,email:_0x35eab3,role:_0x1b088c}=_0x51eb39[_0x3991d3(0x153)],_0x5cb2c8=_0x51eb39['user'],_0x45fc72=await profile[_0x3991d3(0x139)]({'email':_0x5cb2c8[_0x3991d3(0x149)]}),_0x451ba9=await master_shop['find']();console['log'](_0x3991d3(0x165),_0x451ba9),console[_0x3991d3(0x107)](_0x51eb39[_0x3991d3(0x140)]['id']);const _0x1f18f5=await customer['findOne']({'_id':_0x51eb39['params']['id']});console['log']('customer_data',_0x1f18f5);const _0x51b60a=await c_payment_data[_0x3991d3(0x147)]({'customer':_0x1f18f5[_0x3991d3(0x10a)]});console[_0x3991d3(0x107)](_0x51b60a);const _0x3f872a=await c_payment_data[_0x3991d3(0x154)]([{'$match':{'customer':_0x1f18f5['name']}},{'$match':{'reason':_0x3991d3(0x108)}},{'$group':{'_id':_0x3991d3(0x124),'sum':{'$sum':'$amount'}}}]);console['log'](_0x3991d3(0x15a),_0x3f872a);const _0x43554c=await c_payment_data[_0x3991d3(0x154)]([{'$match':{'customer':_0x1f18f5[_0x3991d3(0x10a)]}},{'$match':{'reason':_0x3991d3(0x12c)}},{'$group':{'_id':'$reason','sum':{'$sum':_0x3991d3(0x11f)}}}]);console[_0x3991d3(0x107)](_0x3991d3(0x148),_0x43554c);if(_0x451ba9[0x0][_0x3991d3(0x105)]==_0x3991d3(0x11c)){var _0x38fa51=users['English'];console['log'](_0x38fa51);}else{if(_0x451ba9[0x0][_0x3991d3(0x105)]==_0x3991d3(0x113))var _0x38fa51=users[_0x3991d3(0x113)];else{if(_0x451ba9[0x0][_0x3991d3(0x105)]==_0x3991d3(0x111))var _0x38fa51=users[_0x3991d3(0x111)];else{if(_0x451ba9[0x0][_0x3991d3(0x105)]==_0x3991d3(0x150))var _0x38fa51=users[_0x3991d3(0x150)];else{if(_0x451ba9[0x0]['language']==_0x3991d3(0x127))var _0x38fa51=users[_0x3991d3(0x127)];else{if(_0x451ba9[0x0]['language']==_0x3991d3(0x123))var _0x38fa51=users[_0x3991d3(0x159)];else{if(_0x451ba9[0x0][_0x3991d3(0x105)]=='Chinese')var _0x38fa51=users[_0x3991d3(0x12b)];else{if(_0x451ba9[0x0][_0x3991d3(0x105)]=='Arabic\x20(ae)')var _0x38fa51=users[_0x3991d3(0x120)];}}}}}}}_0x205445[_0x3991d3(0x14f)](_0x3991d3(0x16d),{'success':_0x51eb39[_0x3991d3(0x144)](_0x3991d3(0x119)),'errors':_0x51eb39[_0x3991d3(0x144)](_0x3991d3(0x125)),'role':_0x5cb2c8,'profile':_0x45fc72,'payment':_0x51b60a,'payable':_0x3f872a,'receivable':_0x43554c,'master_shop':_0x451ba9,'language':_0x38fa51});}catch(_0x4dc902){console['log'](_0x4dc902);}}),router[a0_0x1fed56(0x134)](a0_0x1fed56(0x10c),auth,async(_0x4c6b71,_0x1d614c)=>{const _0x397c98=a0_0x1fed56;try{const _0x2ae2aa=new excelJS[(_0x397c98(0x110))](),_0x140312=_0x2ae2aa[_0x397c98(0x157)]('Customers');return _0x140312[_0x397c98(0x117)]=[{'header':'ID','key':_0x397c98(0x11e),'width':0xa},{'header':_0x397c98(0x122),'key':_0x397c98(0x13a),'width':0xa},{'header':_0x397c98(0x168),'key':'PUnits','width':0xa},{'header':'SalesmanName','key':_0x397c98(0x14c),'width':0xa},{'header':'address','key':_0x397c98(0x15e),'width':0xa},{'header':_0x397c98(0x126),'key':_0x397c98(0x126),'width':0xa},{'header':_0x397c98(0x149),'key':_0x397c98(0x149),'width':0xa}],_0x1d614c[_0x397c98(0x109)]('Content-Type',_0x397c98(0x118)),_0x1d614c[_0x397c98(0x109)](_0x397c98(0x11d),_0x397c98(0x162)),_0x2ae2aa[_0x397c98(0x12f)][_0x397c98(0x131)](_0x1d614c)[_0x397c98(0x136)](()=>{_0x1d614c['status'](0xc8);});}catch(_0x26750d){_0x1d614c['status'](0x190)['send']({'errors':_0x26750d[_0x397c98(0x169)]});}});const storage1=multer['diskStorage']({'destination':(_0x34093f,_0x3a5e16,_0x539805)=>{const _0x23e504=a0_0x1fed56;_0x539805(null,_0x23e504(0x155));},'filename':(_0x5b3bb9,_0x26f9d9,_0x42c28a)=>{const _0x4ab602=a0_0x1fed56;_0x42c28a(null,Date[_0x4ab602(0x13f)]()+_0x26f9d9[_0x4ab602(0x10e)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x1fed56(0x163)](a0_0x1fed56(0x135),auth,uploadMigrate[a0_0x1fed56(0x12a)](a0_0x1fed56(0x158)),async(_0x3e2b9f,_0x246430)=>{const _0xa3b332=a0_0x1fed56,_0x4255b5=_0x3e2b9f[_0xa3b332(0x116)][_0xa3b332(0x14d)],_0x3e46b1=await xlsx[_0xa3b332(0x138)](_0xa3b332(0x170)+_0x4255b5);let _0x592f2e=_0x3e46b1[_0xa3b332(0x13c)],_0x388a75=xlsx[_0xa3b332(0x121)][_0xa3b332(0x106)](_0x3e46b1[_0xa3b332(0x128)][_0x592f2e[0x0]]);for(const _0x2b228f of _0x388a75){const _0x1ebc8d=_0x2b228f['ID'],_0xe8ad89=_0x2b228f['Name'],_0x421fbf=_0x2b228f[_0xa3b332(0x168)],_0x26f59e=_0x2b228f[_0xa3b332(0x14c)],_0x33905a=_0x2b228f[_0xa3b332(0x15e)],_0x1ba97e=_0x2b228f[_0xa3b332(0x126)],_0x4a1ed2=_0x2b228f[_0xa3b332(0x149)];try{let _0x21df9b=await customer['findOne']({'name':_0xe8ad89});if(!_0x21df9b){const _0x227b20=new customer({'name':_0xe8ad89,'ID':_0x1ebc8d,'SalesmanCode':_0x421fbf,'SalesmanName':_0x26f59e,'address':_0x33905a,'mobile':_0x1ba97e,'email':_0x4a1ed2});_0x21df9b=await _0x227b20[_0xa3b332(0x14b)](),_0x3e2b9f[_0xa3b332(0x144)](_0xa3b332(0x119),_0xe8ad89+'\x20added\x20successfully');}else _0x3e2b9f[_0xa3b332(0x144)]('error',_0xe8ad89+'\x20Failed');}catch(_0x360a2d){_0x246430[_0xa3b332(0x15d)](0x1f4)[_0xa3b332(0x16e)]({'proderror':_0x360a2d[_0xa3b332(0x169)],'aproduct':ProductName});}}_0x246430['redirect'](_0xa3b332(0x151));}),module['exports']=router;