const a0_0x5660b7=a0_0x4702;function a0_0x4702(_0x3a57b9,_0xf22e42){const _0xffa331=a0_0xffa3();return a0_0x4702=function(_0x470242,_0x11fe4d){_0x470242=_0x470242-0x167;let _0x596f78=_0xffa331[_0x470242];return _0x596f78;},a0_0x4702(_0x3a57b9,_0xf22e42);}(function(_0x120489,_0xeeb143){const _0x43cf5b=a0_0x4702,_0x2258d4=_0x120489();while(!![]){try{const _0x13f1fd=parseInt(_0x43cf5b(0x1bc))/0x1+-parseInt(_0x43cf5b(0x198))/0x2*(parseInt(_0x43cf5b(0x1c1))/0x3)+parseInt(_0x43cf5b(0x197))/0x4+-parseInt(_0x43cf5b(0x1c0))/0x5+-parseInt(_0x43cf5b(0x1c7))/0x6+parseInt(_0x43cf5b(0x18e))/0x7+parseInt(_0x43cf5b(0x1bb))/0x8;if(_0x13f1fd===_0xeeb143)break;else _0x2258d4['push'](_0x2258d4['shift']());}catch(_0xf5974c){_0x2258d4['push'](_0x2258d4['shift']());}}}(a0_0xffa3,0x52c73));function a0_0xffa3(){const _0x3d8947=['Hindi','user','columns','success','German','/supplier/view','French','receivable_sum','readFile','Supplier_Code','data','Portuguese','/view','Purchase','log','addWorksheet','multer','English','purchase','utils','aggregate','reason','post','Router','flash','forEach','Portuguese\x20(BR)','xlsx','6456048cTqkPO','337986JOpppf','supplier.js\x20payment_data','language','Arabic','3213980qDHzrK','15pzvtDy','params','PUnits','payable_sum','suppliers_code','Content-Disposition','3706740QKuQZx','PBrands','company','get','errors','doc','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','Workbook','render','findOne','write','landline','Name','/products_export_migrate_file','suppliers_docs','name','amount','suppliers','$amount','public/Migration/','Chinese','payable','$reason','Spanish','supplier\x20data\x20update\x20successfully','exceljs','now','Arabic\x20(ae)','save','message','Company_Name','supplier','master','status','/view/payment/:id','contactperson','findById','\x20added\x20successfully','Purchase\x20Return','Email','single','supplier_payment','Mobile_number','email','s_payments','supplier\x20data\x20add\x20successfully','sheet_to_json','diskStorage','exports','Content-Type','then','Sheets','1429120MlabGd','file','originalname','\x20Failed','address','English\x20(US)','attachment;\x20filename=supplier_Migration_File.xlsx','setHeader','/supplier_import_migrate_file','2639152ZUPAvb','163718APInie','send','mobile','body','find','redirect','supplier_product_file'];a0_0xffa3=function(){return _0x3d8947;};return a0_0xffa3();}const express=require('express'),app=express(),router=express[a0_0x5660b7(0x1b6)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,s_payment_data}=require('../models/all_models'),auth=require('../middleware/auth'),users=require('../public/language/languages.json'),excelJS=require(a0_0x5660b7(0x173)),xlsx=require(a0_0x5660b7(0x1ba)),multer=require(a0_0x5660b7(0x1af));router['get']('/view',auth,async(_0x27ea50,_0x3a83c4)=>{const _0x336d71=a0_0x5660b7;try{const {username:_0x20901d,email:_0x401459,role:_0x289bec}=_0x27ea50[_0x336d71(0x1a0)],_0x566fdd=_0x27ea50['user'],_0x513f9e=await profile[_0x336d71(0x1d0)]({'email':_0x566fdd[_0x336d71(0x185)]}),_0x4346a3=await master_shop[_0x336d71(0x19c)]();console[_0x336d71(0x1ad)]('master',_0x4346a3);const _0x2d7e5a=await suppliers[_0x336d71(0x19c)]();console['log'](_0x2d7e5a);const _0x40be3a=await suppliers[_0x336d71(0x1b3)]([{'$lookup':{'from':_0x336d71(0x186),'localField':_0x336d71(0x169),'foreignField':_0x336d71(0x16b),'as':_0x336d71(0x168)}}]),_0x483aa5=_0x40be3a['map'](_0x56f62f=>{const _0x57c194=_0x336d71;console[_0x57c194(0x1ad)](_0x57c194(0x1a9),_0x56f62f);var _0x2e6105=0x0,_0x25d49b=0x0;return _0x56f62f[_0x57c194(0x168)][_0x57c194(0x1b8)](_0x1db807=>{const _0x315fb7=_0x57c194;console[_0x315fb7(0x1ad)](_0x315fb7(0x1cc),_0x1db807),_0x1db807[_0x315fb7(0x1b4)]==_0x315fb7(0x1ac)?_0x2e6105+=_0x1db807['amount']:_0x25d49b+=_0x1db807[_0x315fb7(0x16a)];}),_0x56f62f[_0x57c194(0x1b1)]=_0x2e6105,_0x56f62f['purchase_return']=_0x25d49b,_0x56f62f;});console[_0x336d71(0x1ad)](_0x336d71(0x1bd),_0x483aa5);if(_0x4346a3[0x0]['language']==_0x336d71(0x193)){var _0x45dd87=users['English'];console[_0x336d71(0x1ad)](_0x45dd87);}else{if(_0x4346a3[0x0][_0x336d71(0x1be)]==_0x336d71(0x19f))var _0x45dd87=users[_0x336d71(0x19f)];else{if(_0x4346a3[0x0][_0x336d71(0x1be)]==_0x336d71(0x1a3))var _0x45dd87=users[_0x336d71(0x1a3)];else{if(_0x4346a3[0x0]['language']==_0x336d71(0x171))var _0x45dd87=users['Spanish'];else{if(_0x4346a3[0x0][_0x336d71(0x1be)]==_0x336d71(0x1a5))var _0x45dd87=users[_0x336d71(0x1a5)];else{if(_0x4346a3[0x0][_0x336d71(0x1be)]==_0x336d71(0x1b9))var _0x45dd87=users['Portuguese'];else{if(_0x4346a3[0x0]['language']==_0x336d71(0x16e))var _0x45dd87=users[_0x336d71(0x16e)];else{if(_0x4346a3[0x0][_0x336d71(0x1be)]==_0x336d71(0x175))var _0x45dd87=users[_0x336d71(0x1bf)];}}}}}}}_0x3a83c4[_0x336d71(0x1cf)](_0x336d71(0x179),{'success':_0x27ea50[_0x336d71(0x1b7)]('success'),'errors':_0x27ea50[_0x336d71(0x1b7)]('errors'),'user':_0x2d7e5a,'profile':_0x513f9e,'master_shop':_0x4346a3,'role':_0x566fdd,'payment':_0x483aa5,'language':_0x45dd87});}catch(_0x31a18a){console[_0x336d71(0x1ad)](_0x31a18a);}}),router['post'](a0_0x5660b7(0x1ab),auth,async(_0x8b9247,_0x426510)=>{const _0x2209e1=a0_0x5660b7;try{const {name:_0x5d58c5,email:_0xa9dbb5,mobile:_0x2ebf58,company:_0x5d1745,address:_0x3d0d83,receivable:_0x5be8f4,payable:_0x420906,code:_0x20c5bf,contactperson:_0x1b31d1,landline:_0x32e1cd}=_0x8b9247[_0x2209e1(0x19b)],_0x4d4b33=new suppliers({'name':_0x5d58c5,'email':_0xa9dbb5,'mobile':_0x2ebf58,'company':_0x5d1745,'address':_0x3d0d83,'receivable':_0x5be8f4,'payable':_0x420906,'suppliers_code':_0x20c5bf,'contactperson':_0x1b31d1,'landline':_0x32e1cd}),_0x5409a7=await _0x4d4b33['save']();_0x8b9247[_0x2209e1(0x1b7)](_0x2209e1(0x1a2),_0x2209e1(0x187)),_0x426510[_0x2209e1(0x19d)](_0x2209e1(0x1a4));}catch(_0x2b1c66){console[_0x2209e1(0x1ad)](_0x2b1c66);}}),router[a0_0x5660b7(0x1ca)]('/view/:id',auth,async(_0x4c7f62,_0x31629a)=>{const _0x246121=a0_0x5660b7;try{const {username:_0x4fa2b3,email:_0x5112bf,role:_0x311d15}=_0x4c7f62[_0x246121(0x1a0)],_0xaf4877=_0x4c7f62[_0x246121(0x1a0)],_0x7f71f8=await profile[_0x246121(0x1d0)]({'email':_0xaf4877[_0x246121(0x185)]}),_0x97c51a=await master_shop[_0x246121(0x19c)]();console[_0x246121(0x1ad)](_0x246121(0x17a),_0x97c51a);const _0x213e70=_0x4c7f62['params']['id'],_0x2e8df4=await suppliers[_0x246121(0x17e)](_0x213e70);console['log'](_0x2e8df4);if(_0x97c51a[0x0][_0x246121(0x1be)]==_0x246121(0x193)){var _0x20e46a=users[_0x246121(0x1b0)];console[_0x246121(0x1ad)](_0x20e46a);}else{if(_0x97c51a[0x0][_0x246121(0x1be)]==_0x246121(0x19f))var _0x20e46a=users[_0x246121(0x19f)];else{if(_0x97c51a[0x0]['language']=='German')var _0x20e46a=users[_0x246121(0x1a3)];else{if(_0x97c51a[0x0]['language']==_0x246121(0x171))var _0x20e46a=users[_0x246121(0x171)];else{if(_0x97c51a[0x0][_0x246121(0x1be)]=='French')var _0x20e46a=users[_0x246121(0x1a5)];else{if(_0x97c51a[0x0]['language']=='Portuguese\x20(BR)')var _0x20e46a=users[_0x246121(0x1aa)];else{if(_0x97c51a[0x0][_0x246121(0x1be)]==_0x246121(0x16e))var _0x20e46a=users[_0x246121(0x16e)];else{if(_0x97c51a[0x0][_0x246121(0x1be)]==_0x246121(0x175))var _0x20e46a=users[_0x246121(0x1bf)];}}}}}}}_0x31629a[_0x246121(0x1cf)](_0x246121(0x179),{'success':_0x4c7f62[_0x246121(0x1b7)](_0x246121(0x1a2)),'errors':_0x4c7f62['flash'](_0x246121(0x1cb)),'role':_0xaf4877,'profile':_0x7f71f8,'master_shop':_0x97c51a,'user':_0x2e8df4,'language':_0x20e46a});}catch(_0x58e733){console[_0x246121(0x1ad)](_0x58e733);}}),router[a0_0x5660b7(0x1b5)]('/view/:id',auth,async(_0x4a514a,_0x50e384)=>{const _0x46db5e=a0_0x5660b7;try{const _0x558164=_0x4a514a[_0x46db5e(0x1c2)]['id'],_0x1fbcd4=await suppliers['findById'](_0x558164),{name:_0x5ad19a,email:_0xecfdae,mobile:_0xcead10,company:_0x34e661,address:_0x484e95,receivable:_0x598745,payable:_0x4b358d,code:_0x100e76,contactperson:_0x28a682,landline:_0x24f908}=_0x4a514a['body'];_0x1fbcd4['name']=_0x5ad19a,_0x1fbcd4[_0x46db5e(0x185)]=_0xecfdae,_0x1fbcd4[_0x46db5e(0x19a)]=_0xcead10,_0x1fbcd4[_0x46db5e(0x1c9)]=_0x34e661,_0x1fbcd4['address']=_0x484e95,_0x1fbcd4['receivable']=_0x598745,_0x1fbcd4[_0x46db5e(0x16f)]=_0x4b358d,_0x1fbcd4[_0x46db5e(0x1c5)]=_0x100e76,_0x1fbcd4[_0x46db5e(0x17d)]=_0x28a682,_0x1fbcd4[_0x46db5e(0x1d2)]=_0x24f908;const _0x160660=await _0x1fbcd4['save']();_0x4a514a[_0x46db5e(0x1b7)](_0x46db5e(0x1a2),_0x46db5e(0x172)),_0x50e384[_0x46db5e(0x19d)](_0x46db5e(0x1a4));}catch(_0x285705){console[_0x46db5e(0x1ad)](_0x285705);}}),router[a0_0x5660b7(0x1ca)](a0_0x5660b7(0x17c),auth,async(_0x1887f0,_0x37d087)=>{const _0x1a24ac=a0_0x5660b7;try{const {username:_0xbf125c,email:_0x53a28d,role:_0x472142}=_0x1887f0[_0x1a24ac(0x1a0)],_0xe365d8=_0x1887f0[_0x1a24ac(0x1a0)],_0x4d69a1=await profile[_0x1a24ac(0x1d0)]({'email':_0xe365d8[_0x1a24ac(0x185)]}),_0x262674=await master_shop[_0x1a24ac(0x19c)]();console[_0x1a24ac(0x1ad)](_0x1a24ac(0x17a),_0x262674),console['log'](_0x1887f0['params']['id']);const _0x5420e5=await suppliers[_0x1a24ac(0x1d0)]({'_id':_0x1887f0[_0x1a24ac(0x1c2)]['id']});console[_0x1a24ac(0x1ad)](_0x5420e5);const _0x1dd240=await s_payment_data[_0x1a24ac(0x19c)]({'suppliers':_0x5420e5[_0x1a24ac(0x169)]});console[_0x1a24ac(0x1ad)](_0x1dd240);const _0x3d4a7a=await s_payment_data[_0x1a24ac(0x1b3)]([{'$match':{'suppliers':_0x5420e5[_0x1a24ac(0x169)]}},{'$match':{'reason':'Purchase'}},{'$group':{'_id':_0x1a24ac(0x170),'sum':{'$sum':'$amount'}}}]);console[_0x1a24ac(0x1ad)](_0x1a24ac(0x1c4),_0x3d4a7a);const _0x3bfe46=await s_payment_data[_0x1a24ac(0x1b3)]([{'$match':{'suppliers':_0x5420e5[_0x1a24ac(0x169)]}},{'$match':{'reason':_0x1a24ac(0x180)}},{'$group':{'_id':_0x1a24ac(0x170),'sum':{'$sum':_0x1a24ac(0x16c)}}}]);console['log'](_0x1a24ac(0x1a6),_0x3bfe46);if(_0x262674[0x0][_0x1a24ac(0x1be)]==_0x1a24ac(0x193)){var _0x11a8e9=users[_0x1a24ac(0x1b0)];console[_0x1a24ac(0x1ad)](_0x11a8e9);}else{if(_0x262674[0x0][_0x1a24ac(0x1be)]=='Hindi')var _0x11a8e9=users['Hindi'];else{if(_0x262674[0x0][_0x1a24ac(0x1be)]==_0x1a24ac(0x1a3))var _0x11a8e9=users[_0x1a24ac(0x1a3)];else{if(_0x262674[0x0][_0x1a24ac(0x1be)]==_0x1a24ac(0x171))var _0x11a8e9=users[_0x1a24ac(0x171)];else{if(_0x262674[0x0]['language']==_0x1a24ac(0x1a5))var _0x11a8e9=users[_0x1a24ac(0x1a5)];else{if(_0x262674[0x0][_0x1a24ac(0x1be)]=='Portuguese\x20(BR)')var _0x11a8e9=users['Portuguese'];else{if(_0x262674[0x0][_0x1a24ac(0x1be)]=='Chinese')var _0x11a8e9=users['Chinese'];else{if(_0x262674[0x0][_0x1a24ac(0x1be)]=='Arabic\x20(ae)')var _0x11a8e9=users[_0x1a24ac(0x1bf)];}}}}}}}_0x37d087[_0x1a24ac(0x1cf)](_0x1a24ac(0x183),{'success':_0x1887f0[_0x1a24ac(0x1b7)](_0x1a24ac(0x1a2)),'errors':_0x1887f0[_0x1a24ac(0x1b7)](_0x1a24ac(0x1cb)),'role':_0xe365d8,'profile':_0x4d69a1,'master_shop':_0x262674,'payment':_0x1dd240,'payable':_0x3d4a7a,'receivable':_0x3bfe46,'language':_0x11a8e9});}catch(_0x2bd1f5){console[_0x1a24ac(0x1ad)](_0x2bd1f5);}}),router[a0_0x5660b7(0x1ca)](a0_0x5660b7(0x167),auth,async(_0x1730f6,_0x242f4a)=>{const _0x579e6e=a0_0x5660b7;try{const _0x2fed1b=new excelJS[(_0x579e6e(0x1ce))](),_0x43359d=_0x2fed1b[_0x579e6e(0x1ae)]('Customers');return _0x43359d[_0x579e6e(0x1a1)]=[{'header':'Name','key':_0x579e6e(0x1c8),'width':0xa},{'header':'Supplier_Code','key':_0x579e6e(0x1c3),'width':0xa},{'header':'Email','key':'SalesmanName','width':0xa},{'header':_0x579e6e(0x184),'key':_0x579e6e(0x192),'width':0xa},{'header':_0x579e6e(0x178),'key':'mobile','width':0xa},{'header':_0x579e6e(0x192),'key':_0x579e6e(0x185),'width':0xa}],_0x242f4a[_0x579e6e(0x195)](_0x579e6e(0x18b),_0x579e6e(0x1cd)),_0x242f4a[_0x579e6e(0x195)](_0x579e6e(0x1c6),_0x579e6e(0x194)),_0x2fed1b[_0x579e6e(0x1ba)][_0x579e6e(0x1d1)](_0x242f4a)[_0x579e6e(0x18c)](()=>{_0x242f4a['status'](0xc8);});}catch(_0x74fe88){_0x242f4a[_0x579e6e(0x17b)](0x190)[_0x579e6e(0x199)]({'errors':_0x74fe88[_0x579e6e(0x177)]});}});const storage1=multer[a0_0x5660b7(0x189)]({'destination':(_0x5d77ac,_0x2879d4,_0x57e1e2)=>{_0x57e1e2(null,'public/Migration');},'filename':(_0x206974,_0x1b2252,_0x1880fa)=>{const _0x26bb77=a0_0x5660b7;_0x1880fa(null,Date[_0x26bb77(0x174)]()+_0x1b2252[_0x26bb77(0x190)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x5660b7(0x1b5)](a0_0x5660b7(0x196),auth,uploadMigrate[a0_0x5660b7(0x182)](a0_0x5660b7(0x19e)),async(_0x29f96f,_0x3431d5)=>{const _0x1d2959=a0_0x5660b7,_0x29d3bc=_0x29f96f[_0x1d2959(0x18f)]['filename'],_0x5c4bb2=await xlsx[_0x1d2959(0x1a7)](_0x1d2959(0x16d)+_0x29d3bc);let _0x18e497=_0x5c4bb2['SheetNames'],_0x2d3395=xlsx[_0x1d2959(0x1b2)][_0x1d2959(0x188)](_0x5c4bb2[_0x1d2959(0x18d)][_0x18e497[0x0]]);for(const _0x555c77 of _0x2d3395){const _0x142d44=_0x555c77[_0x1d2959(0x1d3)],_0x36d154=_0x555c77[_0x1d2959(0x1a8)],_0x5f3bf6=_0x555c77[_0x1d2959(0x192)],_0x2b99b0=_0x555c77[_0x1d2959(0x184)],_0x3980e3=_0x555c77[_0x1d2959(0x181)],_0x5a1068=_0x555c77[_0x1d2959(0x178)];try{let _0x1ead8c=await suppliers[_0x1d2959(0x1d0)]({'name':_0x142d44});if(!_0x1ead8c){const _0x2c4387=new suppliers({'name':_0x142d44,'suppliers_code':_0x36d154,'address':_0x5f3bf6,'mobile':_0x2b99b0,'email':_0x3980e3,'company':_0x5a1068});_0x1ead8c=await _0x2c4387[_0x1d2959(0x176)](),_0x29f96f[_0x1d2959(0x1b7)]('success',_0x142d44+_0x1d2959(0x17f));}else _0x29f96f[_0x1d2959(0x1b7)]('error',_0x142d44+_0x1d2959(0x191));}catch(_0xb076f8){_0x3431d5[_0x1d2959(0x17b)](0x1f4)['json']({'proderror':_0xb076f8[_0x1d2959(0x177)],'aproduct':ProductName});}}_0x3431d5[_0x1d2959(0x19d)](_0x1d2959(0x1a4));}),module[a0_0x5660b7(0x18a)]=router;