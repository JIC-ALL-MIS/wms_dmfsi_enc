const a0_0x4d896b=a0_0x5db8;(function(_0x274320,_0x18562b){const _0x31264c=a0_0x5db8,_0x477b83=_0x274320();while(!![]){try{const _0x1e4844=-parseInt(_0x31264c(0x12e))/0x1+parseInt(_0x31264c(0xee))/0x2*(-parseInt(_0x31264c(0x12d))/0x3)+parseInt(_0x31264c(0xf1))/0x4+parseInt(_0x31264c(0x129))/0x5*(parseInt(_0x31264c(0x11c))/0x6)+parseInt(_0x31264c(0x134))/0x7+parseInt(_0x31264c(0x106))/0x8*(-parseInt(_0x31264c(0x14d))/0x9)+parseInt(_0x31264c(0x102))/0xa;if(_0x1e4844===_0x18562b)break;else _0x477b83['push'](_0x477b83['shift']());}catch(_0x4cf392){_0x477b83['push'](_0x477b83['shift']());}}}(a0_0x35bf,0xc5087));function a0_0x35bf(){const _0x5ca6c7=['then','suppliers_code','error','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','Supplier_Code','Name','payable','status','SheetNames','aggregate','payable_sum','German','email','/view/payment/:id','Portuguese\x20(BR)','forEach','/view/:id','columns','master','errors','368829HWNEBl','Portuguese','Sheets','\x20added\x20successfully','purchase_return','Hindi','Content-Type','multer','json','doc','public/Migration/','write','../middleware/auth','Purchase','2UyCiSn','landline','save','1747356BcAWRW','diskStorage','flash','addWorksheet','$reason','supplier','English','English\x20(US)','mobile','receivable','/view','Email','redirect','message','sheet_to_json','Chinese','file','29012990vyVaqe','suppliers','render','/products_export_migrate_file','200czndcb','../public/language/languages.json','suppliers_docs','exports','attachment;\x20filename=supplier_Migration_File.xlsx','/supplier/view','originalname','post','../models/all_models','PUnits','Arabic\x20(ae)','receivable_sum','language','purchase','filename','PBrands','get','find','send','Mobile_number','exceljs','name','58296QmXWIc','supplier\x20data\x20update\x20successfully','Purchase\x20Return','success','findById','xlsx','supplier_product_file','supplier\x20data\x20add\x20successfully','SalesmanName','Arabic','params','findOne','log','270VqhLMO','French','address','\x20Failed','2838921eTEDbP','1319983RTHQNn','Company_Name','Workbook','user','$amount','s_payments','1645420oMHflR','supplier_payment','map','Spanish','body'];a0_0x35bf=function(){return _0x5ca6c7;};return a0_0x35bf();}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,s_payment_data}=require(a0_0x4d896b(0x10e)),auth=require(a0_0x4d896b(0xec)),users=require(a0_0x4d896b(0x107)),excelJS=require(a0_0x4d896b(0x11a)),xlsx=require(a0_0x4d896b(0x121)),multer=require(a0_0x4d896b(0xe7));function a0_0x5db8(_0x38db85,_0x527aac){const _0x35bf72=a0_0x35bf();return a0_0x5db8=function(_0x5db86d,_0x2595e6){_0x5db86d=_0x5db86d-0xe2;let _0x219a1a=_0x35bf72[_0x5db86d];return _0x219a1a;},a0_0x5db8(_0x38db85,_0x527aac);}router[a0_0x4d896b(0x116)](a0_0x4d896b(0xfb),auth,async(_0x275420,_0x4424ae)=>{const _0x4aeb80=a0_0x4d896b;try{const {username:_0x219c95,email:_0x57818c,role:_0xad985f}=_0x275420[_0x4aeb80(0x131)],_0x23223d=_0x275420['user'],_0x1778b5=await profile['findOne']({'email':_0x23223d[_0x4aeb80(0x145)]}),_0xcd1dce=await master_shop[_0x4aeb80(0x117)]();console[_0x4aeb80(0x128)](_0x4aeb80(0x14b),_0xcd1dce);const _0x2c7f52=await suppliers['find']();console[_0x4aeb80(0x128)](_0x2c7f52);const _0x3e1180=await suppliers[_0x4aeb80(0x142)]([{'$lookup':{'from':_0x4aeb80(0x133),'localField':_0x4aeb80(0x11b),'foreignField':_0x4aeb80(0x103),'as':_0x4aeb80(0x108)}}]),_0x32212c=_0x3e1180[_0x4aeb80(0x136)](_0x525fdc=>{const _0x20fd14=_0x4aeb80;console[_0x20fd14(0x128)]('data',_0x525fdc);var _0x2da204=0x0,_0x468221=0x0;return _0x525fdc['suppliers_docs'][_0x20fd14(0x148)](_0x254f4f=>{const _0x4579db=_0x20fd14;console[_0x4579db(0x128)](_0x4579db(0xe9),_0x254f4f),_0x254f4f['reason']==_0x4579db(0xed)?_0x2da204+=_0x254f4f['amount']:_0x468221+=_0x254f4f['amount'];}),_0x525fdc[_0x20fd14(0x113)]=_0x2da204,_0x525fdc[_0x20fd14(0xe4)]=_0x468221,_0x525fdc;});console['log']('supplier.js\x20payment_data',_0x32212c);if(_0xcd1dce[0x0]['language']=='English\x20(US)'){var _0x178eaa=users[_0x4aeb80(0xf7)];console[_0x4aeb80(0x128)](_0x178eaa);}else{if(_0xcd1dce[0x0][_0x4aeb80(0x112)]==_0x4aeb80(0xe5))var _0x178eaa=users[_0x4aeb80(0xe5)];else{if(_0xcd1dce[0x0][_0x4aeb80(0x112)]=='German')var _0x178eaa=users['German'];else{if(_0xcd1dce[0x0][_0x4aeb80(0x112)]==_0x4aeb80(0x137))var _0x178eaa=users[_0x4aeb80(0x137)];else{if(_0xcd1dce[0x0]['language']==_0x4aeb80(0x12a))var _0x178eaa=users[_0x4aeb80(0x12a)];else{if(_0xcd1dce[0x0]['language']==_0x4aeb80(0x147))var _0x178eaa=users[_0x4aeb80(0x14e)];else{if(_0xcd1dce[0x0][_0x4aeb80(0x112)]=='Chinese')var _0x178eaa=users[_0x4aeb80(0x100)];else{if(_0xcd1dce[0x0]['language']==_0x4aeb80(0x110))var _0x178eaa=users[_0x4aeb80(0x125)];}}}}}}}_0x4424ae[_0x4aeb80(0x104)]('supplier',{'success':_0x275420['flash']('success'),'errors':_0x275420[_0x4aeb80(0xf3)]('errors'),'user':_0x2c7f52,'profile':_0x1778b5,'master_shop':_0xcd1dce,'role':_0x23223d,'payment':_0x32212c,'language':_0x178eaa});}catch(_0x44c9cc){console[_0x4aeb80(0x128)](_0x44c9cc);}}),router[a0_0x4d896b(0x10d)]('/view',auth,async(_0x2f2248,_0x574aa0)=>{const _0x2574fa=a0_0x4d896b;try{const {name:_0x55c3e4,email:_0x3d2629,mobile:_0x511912,company:_0x26f5a2,address:_0x53433,receivable:_0x5ace38,payable:_0x1719fd,code:_0x3ffdcd,contactperson:_0x4c5e13,landline:_0x1a9919}=_0x2f2248[_0x2574fa(0x138)],_0x178970=new suppliers({'name':_0x55c3e4,'email':_0x3d2629,'mobile':_0x511912,'company':_0x26f5a2,'address':_0x53433,'receivable':_0x5ace38,'payable':_0x1719fd,'suppliers_code':_0x3ffdcd,'contactperson':_0x4c5e13,'landline':_0x1a9919}),_0x26ce28=await _0x178970[_0x2574fa(0xf0)]();_0x2f2248[_0x2574fa(0xf3)](_0x2574fa(0x11f),_0x2574fa(0x123)),_0x574aa0[_0x2574fa(0xfd)](_0x2574fa(0x10b));}catch(_0x4f6921){console['log'](_0x4f6921);}}),router[a0_0x4d896b(0x116)]('/view/:id',auth,async(_0x5e9fe3,_0x543bf5)=>{const _0x2569b8=a0_0x4d896b;try{const {username:_0x15c00c,email:_0xe8c50,role:_0x26266d}=_0x5e9fe3[_0x2569b8(0x131)],_0x6a2cc0=_0x5e9fe3['user'],_0x526efa=await profile[_0x2569b8(0x127)]({'email':_0x6a2cc0['email']}),_0x3593db=await master_shop[_0x2569b8(0x117)]();console[_0x2569b8(0x128)]('master',_0x3593db);const _0x189dda=_0x5e9fe3['params']['id'],_0x220143=await suppliers[_0x2569b8(0x120)](_0x189dda);console[_0x2569b8(0x128)](_0x220143);if(_0x3593db[0x0]['language']==_0x2569b8(0xf8)){var _0x40a623=users[_0x2569b8(0xf7)];console[_0x2569b8(0x128)](_0x40a623);}else{if(_0x3593db[0x0][_0x2569b8(0x112)]==_0x2569b8(0xe5))var _0x40a623=users[_0x2569b8(0xe5)];else{if(_0x3593db[0x0]['language']==_0x2569b8(0x144))var _0x40a623=users['German'];else{if(_0x3593db[0x0][_0x2569b8(0x112)]==_0x2569b8(0x137))var _0x40a623=users['Spanish'];else{if(_0x3593db[0x0][_0x2569b8(0x112)]==_0x2569b8(0x12a))var _0x40a623=users['French'];else{if(_0x3593db[0x0][_0x2569b8(0x112)]==_0x2569b8(0x147))var _0x40a623=users['Portuguese'];else{if(_0x3593db[0x0][_0x2569b8(0x112)]==_0x2569b8(0x100))var _0x40a623=users[_0x2569b8(0x100)];else{if(_0x3593db[0x0][_0x2569b8(0x112)]==_0x2569b8(0x110))var _0x40a623=users['Arabic'];}}}}}}}_0x543bf5['render'](_0x2569b8(0xf6),{'success':_0x5e9fe3[_0x2569b8(0xf3)](_0x2569b8(0x11f)),'errors':_0x5e9fe3[_0x2569b8(0xf3)](_0x2569b8(0x14c)),'role':_0x6a2cc0,'profile':_0x526efa,'master_shop':_0x3593db,'user':_0x220143,'language':_0x40a623});}catch(_0x4a2690){console[_0x2569b8(0x128)](_0x4a2690);}}),router[a0_0x4d896b(0x10d)](a0_0x4d896b(0x149),auth,async(_0x3f329f,_0x573e98)=>{const _0x29c94a=a0_0x4d896b;try{const _0x4acdef=_0x3f329f[_0x29c94a(0x126)]['id'],_0x1b536f=await suppliers[_0x29c94a(0x120)](_0x4acdef),{name:_0x2c7c0d,email:_0x1a45d2,mobile:_0x515371,company:_0x3e9589,address:_0x932db0,receivable:_0x9a7217,payable:_0x348a61,code:_0x5ddf7f,contactperson:_0x1cd5e7,landline:_0x3edc88}=_0x3f329f[_0x29c94a(0x138)];_0x1b536f[_0x29c94a(0x11b)]=_0x2c7c0d,_0x1b536f[_0x29c94a(0x145)]=_0x1a45d2,_0x1b536f[_0x29c94a(0xf9)]=_0x515371,_0x1b536f['company']=_0x3e9589,_0x1b536f[_0x29c94a(0x12b)]=_0x932db0,_0x1b536f[_0x29c94a(0xfa)]=_0x9a7217,_0x1b536f[_0x29c94a(0x13f)]=_0x348a61,_0x1b536f[_0x29c94a(0x13a)]=_0x5ddf7f,_0x1b536f['contactperson']=_0x1cd5e7,_0x1b536f[_0x29c94a(0xef)]=_0x3edc88;const _0x23e2d8=await _0x1b536f[_0x29c94a(0xf0)]();_0x3f329f[_0x29c94a(0xf3)](_0x29c94a(0x11f),_0x29c94a(0x11d)),_0x573e98['redirect'](_0x29c94a(0x10b));}catch(_0x5c9ad0){console[_0x29c94a(0x128)](_0x5c9ad0);}}),router[a0_0x4d896b(0x116)](a0_0x4d896b(0x146),auth,async(_0x3d8653,_0x2e3cf2)=>{const _0x17ec0f=a0_0x4d896b;try{const {username:_0x227a48,email:_0x59162b,role:_0x37bd36}=_0x3d8653[_0x17ec0f(0x131)],_0x1a86f4=_0x3d8653[_0x17ec0f(0x131)],_0x495475=await profile[_0x17ec0f(0x127)]({'email':_0x1a86f4['email']}),_0x1b554a=await master_shop[_0x17ec0f(0x117)]();console[_0x17ec0f(0x128)](_0x17ec0f(0x14b),_0x1b554a),console['log'](_0x3d8653[_0x17ec0f(0x126)]['id']);const _0xc0552f=await suppliers['findOne']({'_id':_0x3d8653[_0x17ec0f(0x126)]['id']});console[_0x17ec0f(0x128)](_0xc0552f);const _0x129788=await s_payment_data[_0x17ec0f(0x117)]({'suppliers':_0xc0552f[_0x17ec0f(0x11b)]});console[_0x17ec0f(0x128)](_0x129788);const _0x5e9abe=await s_payment_data[_0x17ec0f(0x142)]([{'$match':{'suppliers':_0xc0552f['name']}},{'$match':{'reason':'Purchase'}},{'$group':{'_id':_0x17ec0f(0xf5),'sum':{'$sum':_0x17ec0f(0x132)}}}]);console[_0x17ec0f(0x128)](_0x17ec0f(0x143),_0x5e9abe);const _0x5c4fd9=await s_payment_data[_0x17ec0f(0x142)]([{'$match':{'suppliers':_0xc0552f[_0x17ec0f(0x11b)]}},{'$match':{'reason':_0x17ec0f(0x11e)}},{'$group':{'_id':'$reason','sum':{'$sum':'$amount'}}}]);console[_0x17ec0f(0x128)](_0x17ec0f(0x111),_0x5c4fd9);if(_0x1b554a[0x0][_0x17ec0f(0x112)]=='English\x20(US)'){var _0x1cbff8=users[_0x17ec0f(0xf7)];console[_0x17ec0f(0x128)](_0x1cbff8);}else{if(_0x1b554a[0x0]['language']==_0x17ec0f(0xe5))var _0x1cbff8=users[_0x17ec0f(0xe5)];else{if(_0x1b554a[0x0]['language']==_0x17ec0f(0x144))var _0x1cbff8=users[_0x17ec0f(0x144)];else{if(_0x1b554a[0x0][_0x17ec0f(0x112)]==_0x17ec0f(0x137))var _0x1cbff8=users['Spanish'];else{if(_0x1b554a[0x0][_0x17ec0f(0x112)]==_0x17ec0f(0x12a))var _0x1cbff8=users[_0x17ec0f(0x12a)];else{if(_0x1b554a[0x0]['language']==_0x17ec0f(0x147))var _0x1cbff8=users[_0x17ec0f(0x14e)];else{if(_0x1b554a[0x0][_0x17ec0f(0x112)]==_0x17ec0f(0x100))var _0x1cbff8=users[_0x17ec0f(0x100)];else{if(_0x1b554a[0x0][_0x17ec0f(0x112)]==_0x17ec0f(0x110))var _0x1cbff8=users[_0x17ec0f(0x125)];}}}}}}}_0x2e3cf2[_0x17ec0f(0x104)](_0x17ec0f(0x135),{'success':_0x3d8653[_0x17ec0f(0xf3)](_0x17ec0f(0x11f)),'errors':_0x3d8653[_0x17ec0f(0xf3)](_0x17ec0f(0x14c)),'role':_0x1a86f4,'profile':_0x495475,'master_shop':_0x1b554a,'payment':_0x129788,'payable':_0x5e9abe,'receivable':_0x5c4fd9,'language':_0x1cbff8});}catch(_0x2c4ffc){console[_0x17ec0f(0x128)](_0x2c4ffc);}}),router['get'](a0_0x4d896b(0x105),auth,async(_0x4fe095,_0x1fddcd)=>{const _0x100d07=a0_0x4d896b;try{const _0x404724=new excelJS[(_0x100d07(0x130))](),_0x3acd9f=_0x404724[_0x100d07(0xf4)]('Customers');return _0x3acd9f[_0x100d07(0x14a)]=[{'header':_0x100d07(0x13e),'key':_0x100d07(0x115),'width':0xa},{'header':_0x100d07(0x13d),'key':_0x100d07(0x10f),'width':0xa},{'header':'Email','key':_0x100d07(0x124),'width':0xa},{'header':'Mobile_number','key':'address','width':0xa},{'header':_0x100d07(0x12f),'key':_0x100d07(0xf9),'width':0xa},{'header':_0x100d07(0x12b),'key':_0x100d07(0x145),'width':0xa}],_0x1fddcd['setHeader'](_0x100d07(0xe6),_0x100d07(0x13c)),_0x1fddcd['setHeader']('Content-Disposition',_0x100d07(0x10a)),_0x404724[_0x100d07(0x121)][_0x100d07(0xeb)](_0x1fddcd)[_0x100d07(0x139)](()=>{_0x1fddcd['status'](0xc8);});}catch(_0x45f667){_0x1fddcd[_0x100d07(0x140)](0x190)[_0x100d07(0x118)]({'errors':_0x45f667[_0x100d07(0xfe)]});}});const storage1=multer[a0_0x4d896b(0xf2)]({'destination':(_0x1b146d,_0xacdd2f,_0x53dd01)=>{_0x53dd01(null,'public/Migration');},'filename':(_0x3ab2a9,_0x20ec31,_0x591c08)=>{const _0x39e1bf=a0_0x4d896b;_0x591c08(null,Date['now']()+_0x20ec31[_0x39e1bf(0x10c)]);}}),uploadMigrate=multer({'storage':storage1});router['post']('/supplier_import_migrate_file',auth,uploadMigrate['single'](a0_0x4d896b(0x122)),async(_0x37ca77,_0x2072bc)=>{const _0x4e7393=a0_0x4d896b,_0x3fa7ac=_0x37ca77[_0x4e7393(0x101)][_0x4e7393(0x114)],_0x178471=await xlsx['readFile'](_0x4e7393(0xea)+_0x3fa7ac);let _0x4f8090=_0x178471[_0x4e7393(0x141)],_0x2b7c56=xlsx['utils'][_0x4e7393(0xff)](_0x178471[_0x4e7393(0xe2)][_0x4f8090[0x0]]);for(const _0x1796a5 of _0x2b7c56){const _0x17888e=_0x1796a5['Name'],_0x1bef0b=_0x1796a5['Supplier_Code'],_0x13befd=_0x1796a5[_0x4e7393(0x12b)],_0x5923ad=_0x1796a5[_0x4e7393(0x119)],_0xc5852e=_0x1796a5[_0x4e7393(0xfc)],_0xd62f82=_0x1796a5[_0x4e7393(0x12f)];try{let _0x233470=await suppliers['findOne']({'name':_0x17888e});if(!_0x233470){const _0x461a66=new suppliers({'name':_0x17888e,'suppliers_code':_0x1bef0b,'address':_0x13befd,'mobile':_0x5923ad,'email':_0xc5852e,'company':_0xd62f82});_0x233470=await _0x461a66[_0x4e7393(0xf0)](),_0x37ca77[_0x4e7393(0xf3)](_0x4e7393(0x11f),_0x17888e+_0x4e7393(0xe3));}else _0x37ca77['flash'](_0x4e7393(0x13b),_0x17888e+_0x4e7393(0x12c));}catch(_0x77af67){_0x2072bc['status'](0x1f4)[_0x4e7393(0xe8)]({'proderror':_0x77af67[_0x4e7393(0xfe)],'aproduct':ProductName});}}_0x2072bc[_0x4e7393(0xfd)](_0x4e7393(0x10b));}),module[a0_0x4d896b(0x109)]=router;