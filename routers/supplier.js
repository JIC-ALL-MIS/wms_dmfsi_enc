const a0_0x571ec5=a0_0x2066;(function(_0x1c2ef7,_0x17e2cd){const _0x454929=a0_0x2066,_0x3feb05=_0x1c2ef7();while(!![]){try{const _0x5b780f=-parseInt(_0x454929(0x1c5))/0x1*(parseInt(_0x454929(0x1eb))/0x2)+-parseInt(_0x454929(0x1ee))/0x3+parseInt(_0x454929(0x1b5))/0x4+parseInt(_0x454929(0x1a2))/0x5+-parseInt(_0x454929(0x1bb))/0x6+parseInt(_0x454929(0x1dd))/0x7+-parseInt(_0x454929(0x1ef))/0x8*(parseInt(_0x454929(0x1d9))/0x9);if(_0x5b780f===_0x17e2cd)break;else _0x3feb05['push'](_0x3feb05['shift']());}catch(_0x54e5d1){_0x3feb05['push'](_0x3feb05['shift']());}}}(a0_0xb99b,0xd3868));function a0_0x2066(_0x457327,_0x4d5d2e){const _0xb99b5f=a0_0xb99b();return a0_0x2066=function(_0x20668c,_0xc6fbb1){_0x20668c=_0x20668c-0x19f;let _0x2b26e4=_0xb99b5f[_0x20668c];return _0x2b26e4;},a0_0x2066(_0x457327,_0x4d5d2e);}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,s_payment_data}=require('../models/all_models'),auth=require('../middleware/auth'),users=require(a0_0x571ec5(0x19f)),excelJS=require(a0_0x571ec5(0x1ae)),xlsx=require(a0_0x571ec5(0x1b9)),multer=require(a0_0x571ec5(0x1f2));router[a0_0x571ec5(0x1bc)](a0_0x571ec5(0x1d6),auth,async(_0x2f73e9,_0x19ad3d)=>{const _0x19ef77=a0_0x571ec5;try{const {username:_0x4978a4,email:_0x1d2891,role:_0x3f96d1}=_0x2f73e9[_0x19ef77(0x1a6)],_0x33ffd6=_0x2f73e9[_0x19ef77(0x1a6)],_0x4d9fc5=await profile[_0x19ef77(0x1be)]({'email':_0x33ffd6['email']}),_0x539770=await master_shop[_0x19ef77(0x1ba)]();console[_0x19ef77(0x1fc)]('master',_0x539770);const _0x5c6bca=await suppliers['find']();console[_0x19ef77(0x1fc)](_0x5c6bca);const _0x172b04=await suppliers['aggregate']([{'$lookup':{'from':_0x19ef77(0x1cc),'localField':_0x19ef77(0x1e9),'foreignField':_0x19ef77(0x1c4),'as':_0x19ef77(0x1ca)}}]),_0xb125b9=_0x172b04[_0x19ef77(0x1c7)](_0x39a160=>{const _0x39a2ed=_0x19ef77;console['log'](_0x39a2ed(0x1c8),_0x39a160);var _0x1721f8=0x0,_0x468238=0x0;return _0x39a160[_0x39a2ed(0x1ca)][_0x39a2ed(0x1c2)](_0x39effd=>{const _0x415432=_0x39a2ed;console['log'](_0x415432(0x1ad),_0x39effd),_0x39effd['reason']==_0x415432(0x1bd)?_0x1721f8+=_0x39effd[_0x415432(0x1ce)]:_0x468238+=_0x39effd['amount'];}),_0x39a160[_0x39a2ed(0x1f1)]=_0x1721f8,_0x39a160[_0x39a2ed(0x1a9)]=_0x468238,_0x39a160;});console[_0x19ef77(0x1fc)]('supplier.js\x20payment_data',_0xb125b9);if(_0x539770[0x0][_0x19ef77(0x1df)]=='English\x20(US)'){var _0x31b5f0=users['English'];console[_0x19ef77(0x1fc)](_0x31b5f0);}else{if(_0x539770[0x0][_0x19ef77(0x1df)]==_0x19ef77(0x1e3))var _0x31b5f0=users[_0x19ef77(0x1e3)];else{if(_0x539770[0x0][_0x19ef77(0x1df)]==_0x19ef77(0x1a3))var _0x31b5f0=users['German'];else{if(_0x539770[0x0][_0x19ef77(0x1df)]==_0x19ef77(0x1e1))var _0x31b5f0=users[_0x19ef77(0x1e1)];else{if(_0x539770[0x0][_0x19ef77(0x1df)]=='French')var _0x31b5f0=users[_0x19ef77(0x1ab)];else{if(_0x539770[0x0][_0x19ef77(0x1df)]=='Portuguese\x20(BR)')var _0x31b5f0=users[_0x19ef77(0x1b6)];else{if(_0x539770[0x0][_0x19ef77(0x1df)]=='Chinese')var _0x31b5f0=users['Chinese'];else{if(_0x539770[0x0][_0x19ef77(0x1df)]==_0x19ef77(0x1b4))var _0x31b5f0=users[_0x19ef77(0x1a4)];}}}}}}}_0x19ad3d['render'](_0x19ef77(0x1b1),{'success':_0x2f73e9['flash'](_0x19ef77(0x1cd)),'errors':_0x2f73e9[_0x19ef77(0x205)](_0x19ef77(0x1fa)),'user':_0x5c6bca,'profile':_0x4d9fc5,'master_shop':_0x539770,'role':_0x33ffd6,'payment':_0xb125b9,'language':_0x31b5f0});}catch(_0x5ee782){console['log'](_0x5ee782);}}),router[a0_0x571ec5(0x1fe)]('/view',auth,async(_0x4201e5,_0x4d5c92)=>{const _0x99889d=a0_0x571ec5;try{const {name:_0x3f09de,email:_0x356b2a,mobile:_0x41326c,company:_0x264cd3,address:_0x1ac12a,receivable:_0x2b6a76,payable:_0x33898f,code:_0x3232b1,contactperson:_0x2fefb8,landline:_0x27c563}=_0x4201e5[_0x99889d(0x1e2)],_0x21afca=new suppliers({'name':_0x3f09de,'email':_0x356b2a,'mobile':_0x41326c,'company':_0x264cd3,'address':_0x1ac12a,'receivable':_0x2b6a76,'payable':_0x33898f,'suppliers_code':_0x3232b1,'contactperson':_0x2fefb8,'landline':_0x27c563}),_0x3c2bb8=await _0x21afca[_0x99889d(0x200)]();_0x4201e5['flash'](_0x99889d(0x1cd),'supplier\x20data\x20add\x20successfully'),_0x4d5c92['redirect'](_0x99889d(0x1c3));}catch(_0x361268){console['log'](_0x361268);}}),router[a0_0x571ec5(0x1bc)]('/view/:id',auth,async(_0x123d38,_0x12a2f7)=>{const _0x255408=a0_0x571ec5;try{const {username:_0x1cb5c7,email:_0x5a0575,role:_0x59eba6}=_0x123d38[_0x255408(0x1a6)],_0x49fee7=_0x123d38[_0x255408(0x1a6)],_0x173388=await profile['findOne']({'email':_0x49fee7[_0x255408(0x1d5)]}),_0x49f914=await master_shop['find']();console['log']('master',_0x49f914);const _0xc2e8d7=_0x123d38[_0x255408(0x1db)]['id'],_0x452d39=await suppliers[_0x255408(0x1f8)](_0xc2e8d7);console[_0x255408(0x1fc)](_0x452d39);if(_0x49f914[0x0]['language']==_0x255408(0x1f6)){var _0x24a1a4=users[_0x255408(0x203)];console[_0x255408(0x1fc)](_0x24a1a4);}else{if(_0x49f914[0x0][_0x255408(0x1df)]==_0x255408(0x1e3))var _0x24a1a4=users[_0x255408(0x1e3)];else{if(_0x49f914[0x0][_0x255408(0x1df)]==_0x255408(0x1a3))var _0x24a1a4=users[_0x255408(0x1a3)];else{if(_0x49f914[0x0][_0x255408(0x1df)]=='Spanish')var _0x24a1a4=users['Spanish'];else{if(_0x49f914[0x0][_0x255408(0x1df)]==_0x255408(0x1ab))var _0x24a1a4=users[_0x255408(0x1ab)];else{if(_0x49f914[0x0][_0x255408(0x1df)]==_0x255408(0x1e4))var _0x24a1a4=users[_0x255408(0x1b6)];else{if(_0x49f914[0x0]['language']==_0x255408(0x1af))var _0x24a1a4=users[_0x255408(0x1af)];else{if(_0x49f914[0x0][_0x255408(0x1df)]==_0x255408(0x1b4))var _0x24a1a4=users['Arabic'];}}}}}}}_0x12a2f7['render'](_0x255408(0x1b1),{'success':_0x123d38['flash'](_0x255408(0x1cd)),'errors':_0x123d38[_0x255408(0x205)]('errors'),'role':_0x49fee7,'profile':_0x173388,'master_shop':_0x49f914,'user':_0x452d39,'language':_0x24a1a4});}catch(_0x5d521c){console[_0x255408(0x1fc)](_0x5d521c);}}),router[a0_0x571ec5(0x1fe)](a0_0x571ec5(0x1b3),auth,async(_0x316ec6,_0x907f4b)=>{const _0x47ed31=a0_0x571ec5;try{const _0x5da7cd=_0x316ec6[_0x47ed31(0x1db)]['id'],_0x11cab7=await suppliers[_0x47ed31(0x1f8)](_0x5da7cd),{name:_0x387eb5,email:_0x46e89b,mobile:_0x4b703d,company:_0x95495f,address:_0x20d8c4,receivable:_0x1d05b2,payable:_0x4b2760,code:_0x2cdc76,contactperson:_0x3f8c77,landline:_0x1590cd}=_0x316ec6['body'];_0x11cab7[_0x47ed31(0x1e9)]=_0x387eb5,_0x11cab7[_0x47ed31(0x1d5)]=_0x46e89b,_0x11cab7[_0x47ed31(0x206)]=_0x4b703d,_0x11cab7[_0x47ed31(0x1ff)]=_0x95495f,_0x11cab7['address']=_0x20d8c4,_0x11cab7[_0x47ed31(0x1b0)]=_0x1d05b2,_0x11cab7[_0x47ed31(0x201)]=_0x4b2760,_0x11cab7[_0x47ed31(0x1a0)]=_0x2cdc76,_0x11cab7[_0x47ed31(0x1a5)]=_0x3f8c77,_0x11cab7[_0x47ed31(0x1e5)]=_0x1590cd;const _0xdda065=await _0x11cab7[_0x47ed31(0x200)]();_0x316ec6[_0x47ed31(0x205)](_0x47ed31(0x1cd),'supplier\x20data\x20update\x20successfully'),_0x907f4b[_0x47ed31(0x1cf)](_0x47ed31(0x1c3));}catch(_0x123322){console[_0x47ed31(0x1fc)](_0x123322);}}),router[a0_0x571ec5(0x1bc)](a0_0x571ec5(0x1ec),auth,async(_0x4f7926,_0x5426c5)=>{const _0x5522ca=a0_0x571ec5;try{const {username:_0x1f630b,email:_0x186855,role:_0x178fd4}=_0x4f7926['user'],_0x1c5df8=_0x4f7926['user'],_0x3bd4ee=await profile[_0x5522ca(0x1be)]({'email':_0x1c5df8['email']}),_0x40a09b=await master_shop[_0x5522ca(0x1ba)]();console[_0x5522ca(0x1fc)](_0x5522ca(0x1c6),_0x40a09b),console[_0x5522ca(0x1fc)](_0x4f7926[_0x5522ca(0x1db)]['id']);const _0x12f669=await suppliers[_0x5522ca(0x1be)]({'_id':_0x4f7926['params']['id']});console[_0x5522ca(0x1fc)](_0x12f669);const _0x1617b6=await s_payment_data[_0x5522ca(0x1ba)]({'suppliers':_0x12f669[_0x5522ca(0x1e9)]});console['log'](_0x1617b6);const _0x18b8cd=await s_payment_data[_0x5522ca(0x208)]([{'$match':{'suppliers':_0x12f669[_0x5522ca(0x1e9)]}},{'$match':{'reason':_0x5522ca(0x1bd)}},{'$group':{'_id':_0x5522ca(0x1b2),'sum':{'$sum':_0x5522ca(0x1c9)}}}]);console[_0x5522ca(0x1fc)](_0x5522ca(0x1f4),_0x18b8cd);const _0x53536c=await s_payment_data[_0x5522ca(0x208)]([{'$match':{'suppliers':_0x12f669[_0x5522ca(0x1e9)]}},{'$match':{'reason':_0x5522ca(0x1bf)}},{'$group':{'_id':_0x5522ca(0x1b2),'sum':{'$sum':_0x5522ca(0x1c9)}}}]);console[_0x5522ca(0x1fc)]('receivable_sum',_0x53536c);if(_0x40a09b[0x0][_0x5522ca(0x1df)]==_0x5522ca(0x1f6)){var _0xd97807=users['English'];console[_0x5522ca(0x1fc)](_0xd97807);}else{if(_0x40a09b[0x0]['language']==_0x5522ca(0x1e3))var _0xd97807=users[_0x5522ca(0x1e3)];else{if(_0x40a09b[0x0][_0x5522ca(0x1df)]==_0x5522ca(0x1a3))var _0xd97807=users['German'];else{if(_0x40a09b[0x0][_0x5522ca(0x1df)]==_0x5522ca(0x1e1))var _0xd97807=users['Spanish'];else{if(_0x40a09b[0x0][_0x5522ca(0x1df)]==_0x5522ca(0x1ab))var _0xd97807=users[_0x5522ca(0x1ab)];else{if(_0x40a09b[0x0][_0x5522ca(0x1df)]==_0x5522ca(0x1e4))var _0xd97807=users[_0x5522ca(0x1b6)];else{if(_0x40a09b[0x0][_0x5522ca(0x1df)]==_0x5522ca(0x1af))var _0xd97807=users['Chinese'];else{if(_0x40a09b[0x0][_0x5522ca(0x1df)]==_0x5522ca(0x1b4))var _0xd97807=users['Arabic'];}}}}}}}_0x5426c5[_0x5522ca(0x1ac)](_0x5522ca(0x1ea),{'success':_0x4f7926[_0x5522ca(0x205)]('success'),'errors':_0x4f7926['flash'](_0x5522ca(0x1fa)),'role':_0x1c5df8,'profile':_0x3bd4ee,'master_shop':_0x40a09b,'payment':_0x1617b6,'payable':_0x18b8cd,'receivable':_0x53536c,'language':_0xd97807});}catch(_0x4abb85){console[_0x5522ca(0x1fc)](_0x4abb85);}}),router['get'](a0_0x571ec5(0x1de),auth,async(_0x2e03dc,_0x59cb5b)=>{const _0xb02b9d=a0_0x571ec5;try{const _0x11fc3f=new excelJS[(_0xb02b9d(0x1dc))](),_0x256cad=_0x11fc3f['addWorksheet'](_0xb02b9d(0x1a8));return _0x256cad[_0xb02b9d(0x1c1)]=[{'header':'Name','key':_0xb02b9d(0x1d8),'width':0xa},{'header':_0xb02b9d(0x1d4),'key':_0xb02b9d(0x1d3),'width':0xa},{'header':_0xb02b9d(0x1d7),'key':_0xb02b9d(0x1ed),'width':0xa},{'header':_0xb02b9d(0x1fb),'key':_0xb02b9d(0x1f7),'width':0xa},{'header':_0xb02b9d(0x1fd),'key':_0xb02b9d(0x206),'width':0xa},{'header':'address','key':_0xb02b9d(0x1d5),'width':0xa}],_0x59cb5b[_0xb02b9d(0x202)](_0xb02b9d(0x1f9),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x59cb5b[_0xb02b9d(0x202)](_0xb02b9d(0x1e8),_0xb02b9d(0x1f3)),_0x11fc3f[_0xb02b9d(0x1b9)][_0xb02b9d(0x1c0)](_0x59cb5b)[_0xb02b9d(0x1b8)](()=>{const _0x48a599=_0xb02b9d;_0x59cb5b[_0x48a599(0x1d2)](0xc8);});}catch(_0x27ab21){_0x59cb5b[_0xb02b9d(0x1d2)](0x190)[_0xb02b9d(0x1a1)]({'errors':_0x27ab21[_0xb02b9d(0x207)]});}});function a0_0xb99b(){const _0x4c858d=['Purchase','findOne','Purchase\x20Return','write','columns','forEach','/supplier/view','suppliers','27DuWixV','master','map','data','$amount','suppliers_docs','error','s_payments','success','amount','redirect','Name','json','status','PUnits','Supplier_Code','email','/view','Email','PBrands','25065lTIhWS','now','params','Workbook','6269627fdlCxY','/products_export_migrate_file','language','diskStorage','Spanish','body','Hindi','Portuguese\x20(BR)','landline','\x20Failed','supplier_product_file','Content-Disposition','name','supplier_payment','60626Erodan','/view/payment/:id','SalesmanName','214446FFBVOz','1336FPAqqP','\x20added\x20successfully','purchase','multer','attachment;\x20filename=supplier_Migration_File.xlsx','payable_sum','public/Migration/','English\x20(US)','address','findById','Content-Type','errors','Mobile_number','log','Company_Name','post','company','save','payable','setHeader','English','single','flash','mobile','message','aggregate','Sheets','../public/language/languages.json','suppliers_code','send','6132230MyFhNF','German','Arabic','contactperson','user','filename','Customers','purchase_return','readFile','French','render','doc','exceljs','Chinese','receivable','supplier','$reason','/view/:id','Arabic\x20(ae)','3657184PpbafU','Portuguese','sheet_to_json','then','xlsx','find','4889802PyVbTU','get'];a0_0xb99b=function(){return _0x4c858d;};return a0_0xb99b();}const storage1=multer[a0_0x571ec5(0x1e0)]({'destination':(_0x4ef524,_0x4d188c,_0x581c21)=>{_0x581c21(null,'public/Migration');},'filename':(_0x5928ae,_0x44c08c,_0x2ae8fd)=>{const _0xa300b4=a0_0x571ec5;_0x2ae8fd(null,Date[_0xa300b4(0x1da)]()+_0x44c08c['originalname']);}}),uploadMigrate=multer({'storage':storage1});router['post']('/supplier_import_migrate_file',auth,uploadMigrate[a0_0x571ec5(0x204)](a0_0x571ec5(0x1e7)),async(_0x2e108b,_0x387c34)=>{const _0x1419bd=a0_0x571ec5,_0x9b449=_0x2e108b['file'][_0x1419bd(0x1a7)],_0x39702f=await xlsx[_0x1419bd(0x1aa)](_0x1419bd(0x1f5)+_0x9b449);let _0x43a64a=_0x39702f['SheetNames'],_0x75d642=xlsx['utils'][_0x1419bd(0x1b7)](_0x39702f[_0x1419bd(0x209)][_0x43a64a[0x0]]);for(const _0x5220be of _0x75d642){const _0x5b027a=_0x5220be[_0x1419bd(0x1d0)],_0x4e4538=_0x5220be[_0x1419bd(0x1d4)],_0x585d32=_0x5220be[_0x1419bd(0x1f7)],_0x222890=_0x5220be[_0x1419bd(0x1fb)],_0x114207=_0x5220be[_0x1419bd(0x1d7)],_0xcfe059=_0x5220be[_0x1419bd(0x1fd)];try{let _0x382528=await suppliers[_0x1419bd(0x1be)]({'name':_0x5b027a});if(!_0x382528){const _0x31307f=new suppliers({'name':_0x5b027a,'suppliers_code':_0x4e4538,'address':_0x585d32,'mobile':_0x222890,'email':_0x114207,'company':_0xcfe059});_0x382528=await _0x31307f[_0x1419bd(0x200)](),_0x2e108b[_0x1419bd(0x205)](_0x1419bd(0x1cd),_0x5b027a+_0x1419bd(0x1f0));}else _0x2e108b['flash'](_0x1419bd(0x1cb),_0x5b027a+_0x1419bd(0x1e6));}catch(_0x30f332){_0x387c34[_0x1419bd(0x1d2)](0x1f4)[_0x1419bd(0x1d1)]({'proderror':_0x30f332[_0x1419bd(0x207)],'aproduct':ProductName});}}_0x387c34[_0x1419bd(0x1cf)]('/supplier/view');}),module['exports']=router;