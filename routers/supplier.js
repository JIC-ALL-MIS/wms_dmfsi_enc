const a0_0x24eff8=a0_0x25d2;function a0_0x5d61(){const _0x132b7b=['originalname','/view/:id','English\x20(US)','Portuguese\x20(BR)','1392520ITnjVq','xlsx','columns','master','Portuguese','suppliers_code','email','data','51770BjXWUL','utils','PUnits','forEach','Arabic','purchase_return','map','receivable_sum','Chinese','Content-Type','Company_Name','Content-Disposition','addWorksheet','payable','supplier','success','company','/supplier/view','find','landline','amount','readFile','/products_export_migrate_file','sheet_to_json','Supplier_Code','2961AyRhwD','supplier_payment','6fKHpdw','/view/payment/:id','user','single','French','render','../public/language/languages.json','body','22BNirCg','/view','mobile','get','../middleware/auth','file','message','findOne','supplier.js\x20payment_data','contactperson','Purchase','suppliers_docs','receivable','$amount','supplier\x20data\x20update\x20successfully','post','2144eEeBJC','suppliers','status','express','doc','Arabic\x20(ae)','flash','error','SheetNames','name','Mobile_number','diskStorage','$reason','save','then','English','384288clynki','Name','setHeader','address','../models/all_models','\x20added\x20successfully','German','redirect','Spanish','purchase','Hindi','aggregate','findById','log','Workbook','/supplier_import_migrate_file','public/Migration/','1568097Jnnwnl','SalesmanName','PBrands','Email','171936dLvHVp','errors','\x20Failed','19cKJbhM','attachment;\x20filename=supplier_Migration_File.xlsx','2870yZYYTS','language','params'];a0_0x5d61=function(){return _0x132b7b;};return a0_0x5d61();}(function(_0x5ef22f,_0x229c7f){const _0x54f1b5=a0_0x25d2,_0x560d67=_0x5ef22f();while(!![]){try{const _0x2b5047=-parseInt(_0x54f1b5(0x236))/0x1*(-parseInt(_0x54f1b5(0x238))/0x2)+parseInt(_0x54f1b5(0x233))/0x3+parseInt(_0x54f1b5(0x21e))/0x4+-parseInt(_0x54f1b5(0x23f))/0x5*(-parseInt(_0x54f1b5(0x1f6))/0x6)+-parseInt(_0x54f1b5(0x1f4))/0x7*(parseInt(_0x54f1b5(0x20e))/0x8)+-parseInt(_0x54f1b5(0x22f))/0x9+-parseInt(_0x54f1b5(0x247))/0xa*(parseInt(_0x54f1b5(0x1fe))/0xb);if(_0x2b5047===_0x229c7f)break;else _0x560d67['push'](_0x560d67['shift']());}catch(_0x1154ff){_0x560d67['push'](_0x560d67['shift']());}}}(a0_0x5d61,0x275b2));const express=require(a0_0x24eff8(0x211)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,s_payment_data}=require(a0_0x24eff8(0x222)),auth=require(a0_0x24eff8(0x202)),users=require(a0_0x24eff8(0x1fc)),excelJS=require('exceljs'),xlsx=require(a0_0x24eff8(0x240)),multer=require('multer');function a0_0x25d2(_0x14c01d,_0x2e2d53){const _0x5d6186=a0_0x5d61();return a0_0x25d2=function(_0x25d293,_0x26aed3){_0x25d293=_0x25d293-0x1e2;let _0x428dec=_0x5d6186[_0x25d293];return _0x428dec;},a0_0x25d2(_0x14c01d,_0x2e2d53);}router[a0_0x24eff8(0x201)](a0_0x24eff8(0x1ff),auth,async(_0x5e7dcb,_0x548ad9)=>{const _0x44b606=a0_0x24eff8;try{const {username:_0xcfd19d,email:_0xe43fd9,role:_0x49c916}=_0x5e7dcb[_0x44b606(0x1f8)],_0x3e8099=_0x5e7dcb[_0x44b606(0x1f8)],_0x5c7204=await profile[_0x44b606(0x205)]({'email':_0x3e8099[_0x44b606(0x245)]}),_0x35139c=await master_shop[_0x44b606(0x1ed)]();console[_0x44b606(0x22b)](_0x44b606(0x242),_0x35139c);const _0x51efe1=await suppliers['find']();console[_0x44b606(0x22b)](_0x51efe1);const _0x4c917d=await suppliers[_0x44b606(0x229)]([{'$lookup':{'from':'s_payments','localField':'name','foreignField':_0x44b606(0x20f),'as':_0x44b606(0x209)}}]),_0xd98514=_0x4c917d[_0x44b606(0x24d)](_0x38789e=>{const _0x2c72c7=_0x44b606;console['log'](_0x2c72c7(0x246),_0x38789e);var _0x2f8400=0x0,_0x18a2d5=0x0;return _0x38789e[_0x2c72c7(0x209)][_0x2c72c7(0x24a)](_0x1a9641=>{const _0x3ab021=_0x2c72c7;console[_0x3ab021(0x22b)](_0x3ab021(0x212),_0x1a9641),_0x1a9641['reason']==_0x3ab021(0x208)?_0x2f8400+=_0x1a9641['amount']:_0x18a2d5+=_0x1a9641[_0x3ab021(0x1ef)];}),_0x38789e[_0x2c72c7(0x227)]=_0x2f8400,_0x38789e[_0x2c72c7(0x24c)]=_0x18a2d5,_0x38789e;});console['log'](_0x44b606(0x206),_0xd98514);if(_0x35139c[0x0][_0x44b606(0x239)]==_0x44b606(0x23d)){var _0x5e02b7=users[_0x44b606(0x21d)];console[_0x44b606(0x22b)](_0x5e02b7);}else{if(_0x35139c[0x0][_0x44b606(0x239)]==_0x44b606(0x228))var _0x5e02b7=users[_0x44b606(0x228)];else{if(_0x35139c[0x0][_0x44b606(0x239)]==_0x44b606(0x224))var _0x5e02b7=users['German'];else{if(_0x35139c[0x0][_0x44b606(0x239)]==_0x44b606(0x226))var _0x5e02b7=users['Spanish'];else{if(_0x35139c[0x0][_0x44b606(0x239)]==_0x44b606(0x1fa))var _0x5e02b7=users[_0x44b606(0x1fa)];else{if(_0x35139c[0x0][_0x44b606(0x239)]==_0x44b606(0x23e))var _0x5e02b7=users[_0x44b606(0x243)];else{if(_0x35139c[0x0][_0x44b606(0x239)]==_0x44b606(0x1e3))var _0x5e02b7=users[_0x44b606(0x1e3)];else{if(_0x35139c[0x0][_0x44b606(0x239)]==_0x44b606(0x213))var _0x5e02b7=users['Arabic'];}}}}}}}_0x548ad9['render'](_0x44b606(0x1e9),{'success':_0x5e7dcb['flash'](_0x44b606(0x1ea)),'errors':_0x5e7dcb[_0x44b606(0x214)]('errors'),'user':_0x51efe1,'profile':_0x5c7204,'master_shop':_0x35139c,'role':_0x3e8099,'payment':_0xd98514,'language':_0x5e02b7});}catch(_0x488b6b){console['log'](_0x488b6b);}}),router[a0_0x24eff8(0x20d)](a0_0x24eff8(0x1ff),auth,async(_0x2b9561,_0x135b0d)=>{const _0x224a36=a0_0x24eff8;try{const {name:_0x5e48b5,email:_0x45d524,mobile:_0x5db0e1,company:_0x4f9d3f,address:_0x72c822,receivable:_0x3aa866,payable:_0x3ef1a3,code:_0x37366d,contactperson:_0x442829,landline:_0x4ddeb9}=_0x2b9561[_0x224a36(0x1fd)],_0x538f3a=new suppliers({'name':_0x5e48b5,'email':_0x45d524,'mobile':_0x5db0e1,'company':_0x4f9d3f,'address':_0x72c822,'receivable':_0x3aa866,'payable':_0x3ef1a3,'suppliers_code':_0x37366d,'contactperson':_0x442829,'landline':_0x4ddeb9}),_0x727029=await _0x538f3a[_0x224a36(0x21b)]();_0x2b9561[_0x224a36(0x214)](_0x224a36(0x1ea),'supplier\x20data\x20add\x20successfully'),_0x135b0d[_0x224a36(0x225)](_0x224a36(0x1ec));}catch(_0x4589dc){console[_0x224a36(0x22b)](_0x4589dc);}}),router[a0_0x24eff8(0x201)](a0_0x24eff8(0x23c),auth,async(_0x290e91,_0x28b36d)=>{const _0x98d614=a0_0x24eff8;try{const {username:_0x147359,email:_0x14fa3e,role:_0x4ff3c3}=_0x290e91[_0x98d614(0x1f8)],_0x22ced1=_0x290e91[_0x98d614(0x1f8)],_0x1e05f5=await profile[_0x98d614(0x205)]({'email':_0x22ced1[_0x98d614(0x245)]}),_0x3c271a=await master_shop[_0x98d614(0x1ed)]();console[_0x98d614(0x22b)](_0x98d614(0x242),_0x3c271a);const _0xd465aa=_0x290e91[_0x98d614(0x23a)]['id'],_0x5f38b7=await suppliers[_0x98d614(0x22a)](_0xd465aa);console['log'](_0x5f38b7);if(_0x3c271a[0x0][_0x98d614(0x239)]==_0x98d614(0x23d)){var _0x2d52e0=users['English'];console[_0x98d614(0x22b)](_0x2d52e0);}else{if(_0x3c271a[0x0][_0x98d614(0x239)]==_0x98d614(0x228))var _0x2d52e0=users[_0x98d614(0x228)];else{if(_0x3c271a[0x0][_0x98d614(0x239)]==_0x98d614(0x224))var _0x2d52e0=users[_0x98d614(0x224)];else{if(_0x3c271a[0x0][_0x98d614(0x239)]==_0x98d614(0x226))var _0x2d52e0=users[_0x98d614(0x226)];else{if(_0x3c271a[0x0][_0x98d614(0x239)]==_0x98d614(0x1fa))var _0x2d52e0=users[_0x98d614(0x1fa)];else{if(_0x3c271a[0x0][_0x98d614(0x239)]==_0x98d614(0x23e))var _0x2d52e0=users['Portuguese'];else{if(_0x3c271a[0x0][_0x98d614(0x239)]==_0x98d614(0x1e3))var _0x2d52e0=users[_0x98d614(0x1e3)];else{if(_0x3c271a[0x0]['language']==_0x98d614(0x213))var _0x2d52e0=users['Arabic'];}}}}}}}_0x28b36d['render']('supplier',{'success':_0x290e91[_0x98d614(0x214)](_0x98d614(0x1ea)),'errors':_0x290e91[_0x98d614(0x214)]('errors'),'role':_0x22ced1,'profile':_0x1e05f5,'master_shop':_0x3c271a,'user':_0x5f38b7,'language':_0x2d52e0});}catch(_0x226b13){console['log'](_0x226b13);}}),router[a0_0x24eff8(0x20d)](a0_0x24eff8(0x23c),auth,async(_0x59834a,_0x4c52f3)=>{const _0x5eab54=a0_0x24eff8;try{const _0x16cbb2=_0x59834a[_0x5eab54(0x23a)]['id'],_0x286b40=await suppliers[_0x5eab54(0x22a)](_0x16cbb2),{name:_0x4886b5,email:_0x570e95,mobile:_0x5b9445,company:_0x17679b,address:_0x568c3e,receivable:_0x28287c,payable:_0xf1adc3,code:_0x435dff,contactperson:_0x35f563,landline:_0x363d25}=_0x59834a[_0x5eab54(0x1fd)];_0x286b40[_0x5eab54(0x217)]=_0x4886b5,_0x286b40[_0x5eab54(0x245)]=_0x570e95,_0x286b40[_0x5eab54(0x200)]=_0x5b9445,_0x286b40[_0x5eab54(0x1eb)]=_0x17679b,_0x286b40[_0x5eab54(0x221)]=_0x568c3e,_0x286b40[_0x5eab54(0x20a)]=_0x28287c,_0x286b40[_0x5eab54(0x1e8)]=_0xf1adc3,_0x286b40[_0x5eab54(0x244)]=_0x435dff,_0x286b40[_0x5eab54(0x207)]=_0x35f563,_0x286b40[_0x5eab54(0x1ee)]=_0x363d25;const _0x401732=await _0x286b40[_0x5eab54(0x21b)]();_0x59834a[_0x5eab54(0x214)](_0x5eab54(0x1ea),_0x5eab54(0x20c)),_0x4c52f3[_0x5eab54(0x225)](_0x5eab54(0x1ec));}catch(_0x2f0e28){console[_0x5eab54(0x22b)](_0x2f0e28);}}),router[a0_0x24eff8(0x201)](a0_0x24eff8(0x1f7),auth,async(_0x3161ca,_0x36e238)=>{const _0x517815=a0_0x24eff8;try{const {username:_0x1e7985,email:_0x37969a,role:_0x495c14}=_0x3161ca['user'],_0x52f1e8=_0x3161ca[_0x517815(0x1f8)],_0x4a45b3=await profile[_0x517815(0x205)]({'email':_0x52f1e8['email']}),_0x23d46c=await master_shop[_0x517815(0x1ed)]();console[_0x517815(0x22b)]('master',_0x23d46c),console[_0x517815(0x22b)](_0x3161ca[_0x517815(0x23a)]['id']);const _0x4dea84=await suppliers['findOne']({'_id':_0x3161ca['params']['id']});console[_0x517815(0x22b)](_0x4dea84);const _0x36cb3c=await s_payment_data[_0x517815(0x1ed)]({'suppliers':_0x4dea84['name']});console[_0x517815(0x22b)](_0x36cb3c);const _0x3fe396=await s_payment_data[_0x517815(0x229)]([{'$match':{'suppliers':_0x4dea84[_0x517815(0x217)]}},{'$match':{'reason':'Purchase'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x517815(0x20b)}}}]);console[_0x517815(0x22b)]('payable_sum',_0x3fe396);const _0x85dd66=await s_payment_data['aggregate']([{'$match':{'suppliers':_0x4dea84[_0x517815(0x217)]}},{'$match':{'reason':'Purchase\x20Return'}},{'$group':{'_id':_0x517815(0x21a),'sum':{'$sum':'$amount'}}}]);console[_0x517815(0x22b)](_0x517815(0x1e2),_0x85dd66);if(_0x23d46c[0x0][_0x517815(0x239)]==_0x517815(0x23d)){var _0x2f7f22=users['English'];console[_0x517815(0x22b)](_0x2f7f22);}else{if(_0x23d46c[0x0][_0x517815(0x239)]==_0x517815(0x228))var _0x2f7f22=users[_0x517815(0x228)];else{if(_0x23d46c[0x0][_0x517815(0x239)]==_0x517815(0x224))var _0x2f7f22=users['German'];else{if(_0x23d46c[0x0]['language']==_0x517815(0x226))var _0x2f7f22=users['Spanish'];else{if(_0x23d46c[0x0][_0x517815(0x239)]==_0x517815(0x1fa))var _0x2f7f22=users['French'];else{if(_0x23d46c[0x0][_0x517815(0x239)]==_0x517815(0x23e))var _0x2f7f22=users[_0x517815(0x243)];else{if(_0x23d46c[0x0]['language']==_0x517815(0x1e3))var _0x2f7f22=users[_0x517815(0x1e3)];else{if(_0x23d46c[0x0][_0x517815(0x239)]==_0x517815(0x213))var _0x2f7f22=users[_0x517815(0x24b)];}}}}}}}_0x36e238[_0x517815(0x1fb)](_0x517815(0x1f5),{'success':_0x3161ca[_0x517815(0x214)](_0x517815(0x1ea)),'errors':_0x3161ca[_0x517815(0x214)](_0x517815(0x234)),'role':_0x52f1e8,'profile':_0x4a45b3,'master_shop':_0x23d46c,'payment':_0x36cb3c,'payable':_0x3fe396,'receivable':_0x85dd66,'language':_0x2f7f22});}catch(_0x138b8a){console[_0x517815(0x22b)](_0x138b8a);}}),router['get'](a0_0x24eff8(0x1f1),auth,async(_0x3f245d,_0x331d03)=>{const _0x51dd7d=a0_0x24eff8;try{const _0x345bc8=new excelJS[(_0x51dd7d(0x22c))](),_0x471703=_0x345bc8[_0x51dd7d(0x1e7)]('Customers');return _0x471703[_0x51dd7d(0x241)]=[{'header':_0x51dd7d(0x21f),'key':_0x51dd7d(0x231),'width':0xa},{'header':_0x51dd7d(0x1f3),'key':_0x51dd7d(0x249),'width':0xa},{'header':'Email','key':_0x51dd7d(0x230),'width':0xa},{'header':_0x51dd7d(0x218),'key':_0x51dd7d(0x221),'width':0xa},{'header':_0x51dd7d(0x1e5),'key':'mobile','width':0xa},{'header':_0x51dd7d(0x221),'key':_0x51dd7d(0x245),'width':0xa}],_0x331d03['setHeader'](_0x51dd7d(0x1e4),'application/vnd.openxmlformats-officedocument.spreadsheatml.sheet'),_0x331d03[_0x51dd7d(0x220)](_0x51dd7d(0x1e6),_0x51dd7d(0x237)),_0x345bc8[_0x51dd7d(0x240)]['write'](_0x331d03)[_0x51dd7d(0x21c)](()=>{_0x331d03['status'](0xc8);});}catch(_0x2cd725){_0x331d03[_0x51dd7d(0x210)](0x190)['send']({'errors':_0x2cd725[_0x51dd7d(0x204)]});}});const storage1=multer[a0_0x24eff8(0x219)]({'destination':(_0x21ac51,_0x55c0be,_0x4f0e5c)=>{_0x4f0e5c(null,'public/Migration');},'filename':(_0x1dec8d,_0x440a11,_0x1e613e)=>{const _0x537d2a=a0_0x24eff8;_0x1e613e(null,Date['now']()+_0x440a11[_0x537d2a(0x23b)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x24eff8(0x20d)](a0_0x24eff8(0x22d),auth,uploadMigrate[a0_0x24eff8(0x1f9)]('supplier_product_file'),async(_0x3c0d7f,_0xaa1960)=>{const _0x3755b4=a0_0x24eff8,_0x5b8ad6=_0x3c0d7f[_0x3755b4(0x203)]['filename'],_0x2f265e=await xlsx[_0x3755b4(0x1f0)](_0x3755b4(0x22e)+_0x5b8ad6);let _0x5eafb7=_0x2f265e[_0x3755b4(0x216)],_0x3f065e=xlsx[_0x3755b4(0x248)][_0x3755b4(0x1f2)](_0x2f265e['Sheets'][_0x5eafb7[0x0]]);for(const _0x5ea8ce of _0x3f065e){const _0x4c2c5b=_0x5ea8ce[_0x3755b4(0x21f)],_0x4c71cf=_0x5ea8ce[_0x3755b4(0x1f3)],_0xe84662=_0x5ea8ce[_0x3755b4(0x221)],_0x9e524d=_0x5ea8ce[_0x3755b4(0x218)],_0x171394=_0x5ea8ce[_0x3755b4(0x232)],_0x18a4da=_0x5ea8ce['Company_Name'];try{let _0x11e602=await suppliers[_0x3755b4(0x205)]({'name':_0x4c2c5b});if(!_0x11e602){const _0x200233=new suppliers({'name':_0x4c2c5b,'suppliers_code':_0x4c71cf,'address':_0xe84662,'mobile':_0x9e524d,'email':_0x171394,'company':_0x18a4da});_0x11e602=await _0x200233[_0x3755b4(0x21b)](),_0x3c0d7f[_0x3755b4(0x214)](_0x3755b4(0x1ea),_0x4c2c5b+_0x3755b4(0x223));}else _0x3c0d7f[_0x3755b4(0x214)](_0x3755b4(0x215),_0x4c2c5b+_0x3755b4(0x235));}catch(_0x128681){_0xaa1960['status'](0x1f4)['json']({'proderror':_0x128681['message'],'aproduct':ProductName});}}_0xaa1960[_0x3755b4(0x225)]('/supplier/view');}),module['exports']=router;