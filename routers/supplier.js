const a0_0x51e822=a0_0x1e17;(function(_0x18131f,_0x52d380){const _0x31c468=a0_0x1e17,_0x145158=_0x18131f();while(!![]){try{const _0x1f7e3e=parseInt(_0x31c468(0x101))/0x1+parseInt(_0x31c468(0x112))/0x2*(-parseInt(_0x31c468(0xd9))/0x3)+parseInt(_0x31c468(0xe2))/0x4*(parseInt(_0x31c468(0x116))/0x5)+parseInt(_0x31c468(0xfc))/0x6*(parseInt(_0x31c468(0x139))/0x7)+-parseInt(_0x31c468(0x10f))/0x8+-parseInt(_0x31c468(0xec))/0x9*(-parseInt(_0x31c468(0xe5))/0xa)+-parseInt(_0x31c468(0x100))/0xb*(parseInt(_0x31c468(0xf0))/0xc);if(_0x1f7e3e===_0x52d380)break;else _0x145158['push'](_0x145158['shift']());}catch(_0x519667){_0x145158['push'](_0x145158['shift']());}}}(a0_0x34ea,0x5624d));const express=require(a0_0x51e822(0x129)),app=express(),router=express[a0_0x51e822(0xfe)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,s_payment_data}=require(a0_0x51e822(0xe4)),auth=require(a0_0x51e822(0x12e)),users=require('../public/language/languages.json'),excelJS=require(a0_0x51e822(0xf3)),xlsx=require(a0_0x51e822(0x12c)),multer=require(a0_0x51e822(0x134));router[a0_0x51e822(0x11e)](a0_0x51e822(0x135),auth,async(_0x59a92d,_0x343a5d)=>{const _0x5da830=a0_0x51e822;try{const {username:_0x86ce19,email:_0x258b12,role:_0x4d738e}=_0x59a92d[_0x5da830(0x106)],_0x2f58bb=_0x59a92d['user'],_0x109590=await profile[_0x5da830(0x113)]({'email':_0x2f58bb['email']}),_0x398236=await master_shop[_0x5da830(0x126)]();console[_0x5da830(0xf4)](_0x5da830(0x130),_0x398236);const _0x402d73=await suppliers['find']();console[_0x5da830(0xf4)](_0x402d73);const _0x502d71=await suppliers['aggregate']([{'$lookup':{'from':_0x5da830(0x111),'localField':_0x5da830(0x140),'foreignField':'suppliers','as':_0x5da830(0x13b)}}]),_0x291151=_0x502d71[_0x5da830(0x125)](_0x3210c8=>{const _0x115545=_0x5da830;console[_0x115545(0xf4)]('data',_0x3210c8);var _0x3d6344=0x0,_0x551284=0x0;return _0x3210c8['suppliers_docs'][_0x115545(0x119)](_0xb30ba9=>{const _0x120c77=_0x115545;console[_0x120c77(0xf4)](_0x120c77(0x13d),_0xb30ba9),_0xb30ba9[_0x120c77(0xfd)]=='Purchase'?_0x3d6344+=_0xb30ba9['amount']:_0x551284+=_0xb30ba9['amount'];}),_0x3210c8[_0x115545(0x105)]=_0x3d6344,_0x3210c8['purchase_return']=_0x551284,_0x3210c8;});console[_0x5da830(0xf4)](_0x5da830(0x124),_0x291151);if(_0x398236[0x0]['language']==_0x5da830(0xe0)){var _0x2ddd8a=users[_0x5da830(0xee)];console['log'](_0x2ddd8a);}else{if(_0x398236[0x0]['language']==_0x5da830(0xef))var _0x2ddd8a=users[_0x5da830(0xef)];else{if(_0x398236[0x0][_0x5da830(0xdb)]==_0x5da830(0xf1))var _0x2ddd8a=users[_0x5da830(0xf1)];else{if(_0x398236[0x0][_0x5da830(0xdb)]==_0x5da830(0xd6))var _0x2ddd8a=users[_0x5da830(0xd6)];else{if(_0x398236[0x0]['language']==_0x5da830(0xda))var _0x2ddd8a=users[_0x5da830(0xda)];else{if(_0x398236[0x0][_0x5da830(0xdb)]==_0x5da830(0xdf))var _0x2ddd8a=users['Portuguese'];else{if(_0x398236[0x0][_0x5da830(0xdb)]==_0x5da830(0xf7))var _0x2ddd8a=users[_0x5da830(0xf7)];else{if(_0x398236[0x0][_0x5da830(0xdb)]=='Arabic\x20(ae)')var _0x2ddd8a=users[_0x5da830(0x137)];}}}}}}}_0x343a5d['render'](_0x5da830(0x10b),{'success':_0x59a92d[_0x5da830(0x114)](_0x5da830(0x11b)),'errors':_0x59a92d[_0x5da830(0x114)](_0x5da830(0x10a)),'user':_0x402d73,'profile':_0x109590,'master_shop':_0x398236,'role':_0x2f58bb,'payment':_0x291151,'language':_0x2ddd8a});}catch(_0x42437d){console[_0x5da830(0xf4)](_0x42437d);}}),router[a0_0x51e822(0xd8)]('/view',auth,async(_0x300b51,_0x110119)=>{const _0x33f988=a0_0x51e822;try{const {name:_0x4eb180,email:_0x28a395,mobile:_0x48cfc1,company:_0x369af4,address:_0x911718,receivable:_0x496e3c,payable:_0x8c0e6b,code:_0x42aed7,contactperson:_0x199d37,landline:_0x284575}=_0x300b51['body'],_0x1b9855=new suppliers({'name':_0x4eb180,'email':_0x28a395,'mobile':_0x48cfc1,'company':_0x369af4,'address':_0x911718,'receivable':_0x496e3c,'payable':_0x8c0e6b,'suppliers_code':_0x42aed7,'contactperson':_0x199d37,'landline':_0x284575}),_0x3207ff=await _0x1b9855[_0x33f988(0x128)]();_0x300b51[_0x33f988(0x114)](_0x33f988(0x11b),_0x33f988(0xf2)),_0x110119['redirect'](_0x33f988(0xeb));}catch(_0x49ee4f){console[_0x33f988(0xf4)](_0x49ee4f);}}),router[a0_0x51e822(0x11e)](a0_0x51e822(0x133),auth,async(_0x2421e3,_0x390e73)=>{const _0x2dcf20=a0_0x51e822;try{const {username:_0x313381,email:_0x457cf1,role:_0x3ec1c0}=_0x2421e3[_0x2dcf20(0x106)],_0x385253=_0x2421e3[_0x2dcf20(0x106)],_0x1fe342=await profile[_0x2dcf20(0x113)]({'email':_0x385253[_0x2dcf20(0x10c)]}),_0x362843=await master_shop['find']();console[_0x2dcf20(0xf4)](_0x2dcf20(0x130),_0x362843);const _0x29c733=_0x2421e3[_0x2dcf20(0x136)]['id'],_0x1564de=await suppliers[_0x2dcf20(0x11c)](_0x29c733);console[_0x2dcf20(0xf4)](_0x1564de);if(_0x362843[0x0][_0x2dcf20(0xdb)]=='English\x20(US)'){var _0x7a83bf=users[_0x2dcf20(0xee)];console[_0x2dcf20(0xf4)](_0x7a83bf);}else{if(_0x362843[0x0][_0x2dcf20(0xdb)]==_0x2dcf20(0xef))var _0x7a83bf=users['Hindi'];else{if(_0x362843[0x0]['language']==_0x2dcf20(0xf1))var _0x7a83bf=users['German'];else{if(_0x362843[0x0]['language']==_0x2dcf20(0xd6))var _0x7a83bf=users[_0x2dcf20(0xd6)];else{if(_0x362843[0x0][_0x2dcf20(0xdb)]==_0x2dcf20(0xda))var _0x7a83bf=users['French'];else{if(_0x362843[0x0]['language']==_0x2dcf20(0xdf))var _0x7a83bf=users[_0x2dcf20(0x10e)];else{if(_0x362843[0x0][_0x2dcf20(0xdb)]=='Chinese')var _0x7a83bf=users[_0x2dcf20(0xf7)];else{if(_0x362843[0x0]['language']==_0x2dcf20(0x131))var _0x7a83bf=users[_0x2dcf20(0x137)];}}}}}}}_0x390e73['render'](_0x2dcf20(0x10b),{'success':_0x2421e3['flash']('success'),'errors':_0x2421e3[_0x2dcf20(0x114)](_0x2dcf20(0x10a)),'role':_0x385253,'profile':_0x1fe342,'master_shop':_0x362843,'user':_0x1564de,'language':_0x7a83bf});}catch(_0x3dc238){console[_0x2dcf20(0xf4)](_0x3dc238);}}),router['post'](a0_0x51e822(0x133),auth,async(_0x5732d4,_0x14d89a)=>{const _0x5b2a0d=a0_0x51e822;try{const _0x1c729b=_0x5732d4[_0x5b2a0d(0x136)]['id'],_0x292931=await suppliers[_0x5b2a0d(0x11c)](_0x1c729b),{name:_0x130f49,email:_0x32ab53,mobile:_0x439913,company:_0x3bd615,address:_0x375ee4,receivable:_0x5138d2,payable:_0x304a9f,code:_0x22d955,contactperson:_0x14099b,landline:_0x238986}=_0x5732d4[_0x5b2a0d(0xe6)];_0x292931[_0x5b2a0d(0x140)]=_0x130f49,_0x292931[_0x5b2a0d(0x10c)]=_0x32ab53,_0x292931[_0x5b2a0d(0xdd)]=_0x439913,_0x292931[_0x5b2a0d(0x12f)]=_0x3bd615,_0x292931['address']=_0x375ee4,_0x292931[_0x5b2a0d(0x132)]=_0x5138d2,_0x292931[_0x5b2a0d(0x120)]=_0x304a9f,_0x292931[_0x5b2a0d(0xfb)]=_0x22d955,_0x292931[_0x5b2a0d(0x10d)]=_0x14099b,_0x292931['landline']=_0x238986;const _0x3c7fa7=await _0x292931[_0x5b2a0d(0x128)]();_0x5732d4[_0x5b2a0d(0x114)](_0x5b2a0d(0x11b),_0x5b2a0d(0xe9)),_0x14d89a[_0x5b2a0d(0xe1)]('/supplier/view');}catch(_0x23ca48){console[_0x5b2a0d(0xf4)](_0x23ca48);}}),router[a0_0x51e822(0x11e)](a0_0x51e822(0xff),auth,async(_0x7b607f,_0x3a6576)=>{const _0x554eb4=a0_0x51e822;try{const {username:_0x117b81,email:_0xbbe6fb,role:_0x27e916}=_0x7b607f[_0x554eb4(0x106)],_0x4be1bf=_0x7b607f[_0x554eb4(0x106)],_0x2bbf51=await profile[_0x554eb4(0x113)]({'email':_0x4be1bf[_0x554eb4(0x10c)]}),_0x54290d=await master_shop[_0x554eb4(0x126)]();console[_0x554eb4(0xf4)](_0x554eb4(0x130),_0x54290d),console[_0x554eb4(0xf4)](_0x7b607f[_0x554eb4(0x136)]['id']);const _0x16e7c0=await suppliers['findOne']({'_id':_0x7b607f['params']['id']});console['log'](_0x16e7c0);const _0xcbb82e=await s_payment_data[_0x554eb4(0x126)]({'suppliers':_0x16e7c0['name']});console[_0x554eb4(0xf4)](_0xcbb82e);const _0x51b8e6=await s_payment_data[_0x554eb4(0x102)]([{'$match':{'suppliers':_0x16e7c0[_0x554eb4(0x140)]}},{'$match':{'reason':_0x554eb4(0xd5)}},{'$group':{'_id':_0x554eb4(0xd7),'sum':{'$sum':_0x554eb4(0xe7)}}}]);console['log']('payable_sum',_0x51b8e6);const _0x30334e=await s_payment_data[_0x554eb4(0x102)]([{'$match':{'suppliers':_0x16e7c0[_0x554eb4(0x140)]}},{'$match':{'reason':'Purchase\x20Return'}},{'$group':{'_id':'$reason','sum':{'$sum':_0x554eb4(0xe7)}}}]);console[_0x554eb4(0xf4)]('receivable_sum',_0x30334e);if(_0x54290d[0x0]['language']==_0x554eb4(0xe0)){var _0x7a4c59=users[_0x554eb4(0xee)];console[_0x554eb4(0xf4)](_0x7a4c59);}else{if(_0x54290d[0x0]['language']==_0x554eb4(0xef))var _0x7a4c59=users[_0x554eb4(0xef)];else{if(_0x54290d[0x0][_0x554eb4(0xdb)]=='German')var _0x7a4c59=users[_0x554eb4(0xf1)];else{if(_0x54290d[0x0]['language']==_0x554eb4(0xd6))var _0x7a4c59=users['Spanish'];else{if(_0x54290d[0x0][_0x554eb4(0xdb)]==_0x554eb4(0xda))var _0x7a4c59=users[_0x554eb4(0xda)];else{if(_0x54290d[0x0][_0x554eb4(0xdb)]==_0x554eb4(0xdf))var _0x7a4c59=users[_0x554eb4(0x10e)];else{if(_0x54290d[0x0]['language']==_0x554eb4(0xf7))var _0x7a4c59=users[_0x554eb4(0xf7)];else{if(_0x54290d[0x0]['language']==_0x554eb4(0x131))var _0x7a4c59=users[_0x554eb4(0x137)];}}}}}}}_0x3a6576[_0x554eb4(0x12b)]('supplier_payment',{'success':_0x7b607f['flash'](_0x554eb4(0x11b)),'errors':_0x7b607f[_0x554eb4(0x114)](_0x554eb4(0x10a)),'role':_0x4be1bf,'profile':_0x2bbf51,'master_shop':_0x54290d,'payment':_0xcbb82e,'payable':_0x51b8e6,'receivable':_0x30334e,'language':_0x7a4c59});}catch(_0x9fdb51){console[_0x554eb4(0xf4)](_0x9fdb51);}}),router[a0_0x51e822(0x11e)](a0_0x51e822(0x11d),auth,async(_0x431f3e,_0x437f4e)=>{const _0x1bcd7a=a0_0x51e822;try{const _0x37a6d6=new excelJS[(_0x1bcd7a(0x123))](),_0x34e28b=_0x37a6d6[_0x1bcd7a(0x110)](_0x1bcd7a(0x115));return _0x34e28b['columns']=[{'header':'Name','key':_0x1bcd7a(0x12a),'width':0xa},{'header':'Supplier_Code','key':'PUnits','width':0xa},{'header':_0x1bcd7a(0x122),'key':_0x1bcd7a(0x138),'width':0xa},{'header':'Mobile_number','key':_0x1bcd7a(0xe8),'width':0xa},{'header':_0x1bcd7a(0xde),'key':_0x1bcd7a(0xdd),'width':0xa},{'header':'address','key':_0x1bcd7a(0x10c),'width':0xa}],_0x437f4e[_0x1bcd7a(0x108)]('Content-Type',_0x1bcd7a(0x104)),_0x437f4e[_0x1bcd7a(0x108)](_0x1bcd7a(0x118),_0x1bcd7a(0x13f)),_0x37a6d6['xlsx']['write'](_0x437f4e)[_0x1bcd7a(0x12d)](()=>{const _0x2a0398=_0x1bcd7a;_0x437f4e[_0x2a0398(0xe3)](0xc8);});}catch(_0x58d090){_0x437f4e[_0x1bcd7a(0xe3)](0x190)[_0x1bcd7a(0xf8)]({'errors':_0x58d090[_0x1bcd7a(0x121)]});}});function a0_0x1e17(_0x82b4aa,_0x5b673c){const _0x34eada=a0_0x34ea();return a0_0x1e17=function(_0x1e1767,_0x327ae6){_0x1e1767=_0x1e1767-0xd5;let _0x5bd695=_0x34eada[_0x1e1767];return _0x5bd695;},a0_0x1e17(_0x82b4aa,_0x5b673c);}function a0_0x34ea(){const _0x217e28=['xlsx','then','../middleware/auth','company','master','Arabic\x20(ae)','receivable','/view/:id','multer','/view','params','Arabic','SalesmanName','7RIypjf','Supplier_Code','suppliers_docs','utils','doc','json','attachment;\x20filename=supplier_Migration_File.xlsx','name','Purchase','Spanish','$reason','post','1599144nXRiOf','French','language','error','mobile','Company_Name','Portuguese\x20(BR)','English\x20(US)','redirect','604UpgmOg','status','../models/all_models','1139520AhaAaI','body','$amount','address','supplier\x20data\x20update\x20successfully','\x20added\x20successfully','/supplier/view','18GZVPex','readFile','English','Hindi','120mnlJZE','German','supplier\x20data\x20add\x20successfully','exceljs','log','public/Migration/','now','Chinese','send','Name','Sheets','suppliers_code','213936GDokPk','reason','Router','/view/payment/:id','42977DEoUgv','650907lmzbFA','aggregate','file','application/vnd.openxmlformats-officedocument.spreadsheatml.sheet','purchase','user','originalname','setHeader','SheetNames','errors','supplier','email','contactperson','Portuguese','5300088cQKNZn','addWorksheet','s_payments','2hjtNZM','findOne','flash','Customers','22285QUZMsP','public/Migration','Content-Disposition','forEach','Mobile_number','success','findById','/products_export_migrate_file','get','sheet_to_json','payable','message','Email','Workbook','supplier.js\x20payment_data','map','find','filename','save','express','PBrands','render'];a0_0x34ea=function(){return _0x217e28;};return a0_0x34ea();}const storage1=multer['diskStorage']({'destination':(_0x552abc,_0x28ff15,_0x484b97)=>{const _0x2c0e7d=a0_0x51e822;_0x484b97(null,_0x2c0e7d(0x117));},'filename':(_0x24de9f,_0x310c8f,_0x4c764f)=>{const _0x29c943=a0_0x51e822;_0x4c764f(null,Date[_0x29c943(0xf6)]()+_0x310c8f[_0x29c943(0x107)]);}}),uploadMigrate=multer({'storage':storage1});router[a0_0x51e822(0xd8)]('/supplier_import_migrate_file',auth,uploadMigrate['single']('supplier_product_file'),async(_0x24aa3d,_0x439600)=>{const _0x1a5ce4=a0_0x51e822,_0x524bf3=_0x24aa3d[_0x1a5ce4(0x103)][_0x1a5ce4(0x127)],_0x56b346=await xlsx[_0x1a5ce4(0xed)](_0x1a5ce4(0xf5)+_0x524bf3);let _0xee2a1e=_0x56b346[_0x1a5ce4(0x109)],_0x3e9c23=xlsx[_0x1a5ce4(0x13c)][_0x1a5ce4(0x11f)](_0x56b346[_0x1a5ce4(0xfa)][_0xee2a1e[0x0]]);for(const _0x24e5fc of _0x3e9c23){const _0x386cb6=_0x24e5fc[_0x1a5ce4(0xf9)],_0x1b31e5=_0x24e5fc[_0x1a5ce4(0x13a)],_0x561aa8=_0x24e5fc['address'],_0x270ab7=_0x24e5fc[_0x1a5ce4(0x11a)],_0x422a00=_0x24e5fc[_0x1a5ce4(0x122)],_0x5bfb11=_0x24e5fc[_0x1a5ce4(0xde)];try{let _0x5d9f3a=await suppliers[_0x1a5ce4(0x113)]({'name':_0x386cb6});if(!_0x5d9f3a){const _0x5e9455=new suppliers({'name':_0x386cb6,'suppliers_code':_0x1b31e5,'address':_0x561aa8,'mobile':_0x270ab7,'email':_0x422a00,'company':_0x5bfb11});_0x5d9f3a=await _0x5e9455[_0x1a5ce4(0x128)](),_0x24aa3d['flash'](_0x1a5ce4(0x11b),_0x386cb6+_0x1a5ce4(0xea));}else _0x24aa3d[_0x1a5ce4(0x114)](_0x1a5ce4(0xdc),_0x386cb6+'\x20Failed');}catch(_0xac47b8){_0x439600[_0x1a5ce4(0xe3)](0x1f4)[_0x1a5ce4(0x13e)]({'proderror':_0xac47b8[_0x1a5ce4(0x121)],'aproduct':ProductName});}}_0x439600[_0x1a5ce4(0xe1)](_0x1a5ce4(0xeb));}),module['exports']=router;