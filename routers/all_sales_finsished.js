var a0_0x10e5da=a0_0x2627;(function(_0x4e2b4d,_0x337d19){var _0x402055=a0_0x2627,_0x190517=_0x4e2b4d();while(!![]){try{var _0x1a41b9=parseInt(_0x402055(0x201))/0x1*(-parseInt(_0x402055(0x1fb))/0x2)+parseInt(_0x402055(0x282))/0x3*(parseInt(_0x402055(0x25f))/0x4)+-parseInt(_0x402055(0x27d))/0x5+parseInt(_0x402055(0x268))/0x6*(-parseInt(_0x402055(0x242))/0x7)+parseInt(_0x402055(0x2e0))/0x8+-parseInt(_0x402055(0x277))/0x9*(-parseInt(_0x402055(0x20b))/0xa)+-parseInt(_0x402055(0x2a0))/0xb*(-parseInt(_0x402055(0x2ba))/0xc);if(_0x1a41b9===_0x337d19)break;else _0x190517['push'](_0x190517['shift']());}catch(_0x3f2564){_0x190517['push'](_0x190517['shift']());}}}(a0_0x5ccb,0x6c926));const express=require('express'),app=express(),router=express[a0_0x10e5da(0x213)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x10e5da(0x235)),auth=require('../middleware/auth'),nodemailer=require(a0_0x10e5da(0x25c)),users=require(a0_0x10e5da(0x24a));function a0_0x5ccb(){var _0x101d3a=['../models/all_models','\x20Order\x20Number\x20:\x20','date','slice','payment\x20successfull','getDate','length','$note','back','room_name','stocks_QA','product_code','Hindi','2914933RZCXqe','get','aggregate','role','$sale_product.floorlevel','$product_details.secondary_code','$product_details.bin','site_title','../public/language/languages.json','stock_data','$customers_docs','max_per_unit','</table>','True','$product_details.production_date','product_data','/upload/','product_stock','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Quality\x20Inspection','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','save','findById','/view/add_sales/:id','note','nodemailer','\x20<>\x20','sendMail','1710392jhbsdE','map','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','sale_product','Arabic\x20(ae)','prod_cat','invoice','exports','then','6Rvyndi','$product_details.primary_code','foreach\x20newproduct','push','RoomAssigned','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','/view/return_sales/:id','Sale\x20Return\x20Mail','all_sales_barcode','$product_details.storage','\x20</h2>','sales_quantity','$sale_product.bay','Finished\x20Goods','product_name','44487jxGPmg','There\x27s\x20a\x20error\x20in\x20this\x20transaction','abs','user','<h2>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','352480iRguLR','$product_details.unit','string','quantity','log','3veDnXe','final','return_qty_QA','post','$product_details.expiry_date','unit_QA','Logo.png','product_name_QA1','\x20==\x20','OUTF-','padStart','warehouse','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','findOne','status','QA\x20Warehouse','/view/:id','room','$room','sales\x20item\x20return\x20successfull','$product_details.floorlevel','$product_details.product_code','$warehouse_name','expiry_date','errors','$invoice','forEach','secondary_code','Received\x20Payment\x20For\x20Sale','flash','11ZXQEYS','random','barcode\x20user_id','Enclosed','logo','toString','maxProducts_QA','adjust_qty','prod_invoice','\x20<<<==>>>\x20','currency_placement','Chinese','render','product_date','getFullYear','Error\x20Occurs','product_code_QA','sale_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Email\x20sent\x20successfully','json','Portuguese','product_list','</h5>','return_sale','production_date','11044812ZJMlfD','filter','amount','$product_details.bay','sales_quantity_QA','$product_details.product_name','_id','stock','return_sale_QA','image','bay','$customer','all','split','English','due_amount','$date','<!DOCTYPE\x20html>','production_date_QA','<h5>','password','product','$sale_product','level','$name','Ambient','batch_code_QA','name','all_sales_finished','Return\x20Goods','$product_details.product_stock','received_amount','Portuguese\x20(BR)','</head><body>','</thead>','language','return_data','createTransport','2261968tSzGYk','finalize','customer_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','return_qty','add\x20post','</div>','<span\x20style=\x22float:\x20right;\x22>','</tr>','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','English\x20(US)','Sale','$_id','Sales\x20Add\x20successfully','$sale_product.bin','<h5\x20style=\x22text-align:\x20left;\x22>','add_sales_finished','</tbody>','Arabic','$product_details.maxProducts','\x20&&\x20','/invoice/:id','An\x20error\x20occurred\x20while\x20saving\x20data.','maxPerUnit','currency','staff','</td>','French','$product_details._id','Sales\x20Mail','primary_code','/../public','getMonth','$finalize','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_details','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Sale\x20Return','maxProducts','max','master','prod_code','warehouse_name','success','barcode\x20Product\x20master','host','$product_details.invoice','secondary_unit_QA','maxPerUnit_QA','$product_details.type','\x20Order\x20Date\x20:\x20','/all_sales_finished/view','secondary_code_QA','Enabled','27128qIqtbs','$product_details.secondary_unit','secondary_unit','id_transaction_from','</span>','/all_sales_finished/preview/','53axPCNv','params','$sale_product.quantity','error','/view/add_sales','An\x20error\x20occurred.','$product_details.maxPerUnit','suppliers','customer','German','40SpWFOe','Sales\x20Update\x20successfully','find','$product_details.rack','Spanish','/all_sales/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Router','expiry_date_QA','unit','FGSEmail','$product_details','Add\x20Sales','catch','concat','carton','$product_details.batch_code','<tr>','$sale_product.type','maxperunit','<html><head><title></title>','/preview/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','False','primary_code_QA','customers_docs','port','edit_sales_finished_view','sales_invoice','<hr\x20class=\x22my-3\x22>','gmail','<strong>\x20Regards\x20</strong>','body','email','for_categorize','return_sale_finished','/picking_list/pdf/','<div>','primary_unit','</body></html>','floor'];a0_0x5ccb=function(){return _0x101d3a;};return a0_0x5ccb();}function a0_0x2627(_0x3a8f4a,_0x31109d){var _0x5ccb37=a0_0x5ccb();return a0_0x2627=function(_0x262721,_0xc685f6){_0x262721=_0x262721-0x1dc;var _0x4d1295=_0x5ccb37[_0x262721];return _0x4d1295;},a0_0x2627(_0x3a8f4a,_0x31109d);}router[a0_0x10e5da(0x243)]('/view',auth,async(_0x3cecb0,_0xbb8e8)=>{var _0x1d9911=a0_0x10e5da;try{const {username:_0x22915b,email:_0x54fe23,role:_0xc39c9c}=_0x3cecb0[_0x1d9911(0x27a)],_0x5c54be=_0x3cecb0['user'],_0x3773ce=await profile[_0x1d9911(0x28f)]({'email':_0x5c54be['email']}),_0x3221eb=await master_shop[_0x1d9911(0x20d)]();let _0x4a7f9f;if(_0x5c54be[_0x1d9911(0x245)]=='staff'){const _0x1192c4=await staff[_0x1d9911(0x28f)]({'email':_0x5c54be[_0x1d9911(0x22d)]});_0x4a7f9f=await sales_finished['aggregate']([{'$lookup':{'from':'customers','localField':_0x1d9911(0x209),'foreignField':_0x1d9911(0x2d5),'as':_0x1d9911(0x225)}},{'$unwind':_0x1d9911(0x24c)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x1d9911(0x2ed),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x1d9911(0x2c5)},'date':{'$first':_0x1d9911(0x2ca)},'warehouse_name':{'$first':_0x1d9911(0x298)},'sale_product':{'$push':_0x1d9911(0x2d0)},'note':{'$first':_0x1d9911(0x23c)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x1d9911(0x203)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x1d9911(0x2ef)},'type':{'$addToSet':_0x1d9911(0x21e)},'pallet':{'$addToSet':_0x1d9911(0x246)},'finalize':{'$first':_0x1d9911(0x1e5)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x4a7f9f=await sales_finished[_0x1d9911(0x244)]([{'$lookup':{'from':'customers','localField':_0x1d9911(0x209),'foreignField':_0x1d9911(0x2d5),'as':_0x1d9911(0x225)}},{'$unwind':_0x1d9911(0x24c)},{'$unwind':_0x1d9911(0x2d0)},{'$group':{'_id':_0x1d9911(0x2ed),'invoice':{'$first':_0x1d9911(0x29b)},'customers':{'$first':'$customer'},'date':{'$first':_0x1d9911(0x2ca)},'warehouse_name':{'$first':_0x1d9911(0x298)},'sale_product':{'$push':_0x1d9911(0x2d0)},'note':{'$first':_0x1d9911(0x23c)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x1d9911(0x24c)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x1d9911(0x274)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x1d9911(0x21e)},'pallet':{'$addToSet':_0x1d9911(0x246)},'finalize':{'$first':_0x1d9911(0x1e5)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x3221eb[0x0][_0x1d9911(0x2dd)]==_0x1d9911(0x2eb)){var _0x35b426=users[_0x1d9911(0x2c8)];console[_0x1d9911(0x281)](_0x35b426);}else{if(_0x3221eb[0x0][_0x1d9911(0x2dd)]==_0x1d9911(0x241))var _0x35b426=users[_0x1d9911(0x241)];else{if(_0x3221eb[0x0][_0x1d9911(0x2dd)]==_0x1d9911(0x20a))var _0x35b426=users[_0x1d9911(0x20a)];else{if(_0x3221eb[0x0]['language']==_0x1d9911(0x20f))var _0x35b426=users[_0x1d9911(0x20f)];else{if(_0x3221eb[0x0][_0x1d9911(0x2dd)]=='French')var _0x35b426=users[_0x1d9911(0x1df)];else{if(_0x3221eb[0x0][_0x1d9911(0x2dd)]==_0x1d9911(0x2da))var _0x35b426=users['Portuguese'];else{if(_0x3221eb[0x0][_0x1d9911(0x2dd)]=='Chinese')var _0x35b426=users[_0x1d9911(0x2ab)];else{if(_0x3221eb[0x0][_0x1d9911(0x2dd)]==_0x1d9911(0x263))var _0x35b426=users[_0x1d9911(0x2f3)];}}}}}}}_0xbb8e8[_0x1d9911(0x2ac)](_0x1d9911(0x2d6),{'success':_0x3cecb0['flash'](_0x1d9911(0x1f0)),'errors':_0x3cecb0['flash'](_0x1d9911(0x29a)),'sales':_0x4a7f9f,'profile':_0x3773ce,'role':_0x5c54be,'master_shop':_0x3221eb,'language':_0x35b426});}catch(_0x34de62){console[_0x1d9911(0x281)](_0x34de62);}});async function getRandom8DigitNumber(){var _0x50ef56=a0_0x10e5da;const _0x124edd=0x989680,_0xca82c5=0x5f5e0ff,_0x21b8f5=Math[_0x50ef56(0x234)](Math[_0x50ef56(0x2a1)]()*(_0xca82c5-_0x124edd+0x1))+_0x124edd;var _0x2c25b3;const _0x4beb9e=await sales_finished[_0x50ef56(0x28f)]({'invoice':_0x50ef56(0x28b)+_0x21b8f5});return _0x4beb9e&&_0x4beb9e[_0x50ef56(0x23b)]>0x0?_0x2c25b3='OUTF-'+_0x21b8f5:_0x2c25b3='OUTF-'+_0x21b8f5,_0x2c25b3;}router[a0_0x10e5da(0x243)](a0_0x10e5da(0x205),auth,async(_0x5caa80,_0x198b39)=>{var _0x269e59=a0_0x10e5da;try{const {username:_0x50ea9a,email:_0x4bd575,role:_0x5196ed}=_0x5caa80[_0x269e59(0x27a)],_0x5dbc06=_0x5caa80[_0x269e59(0x27a)],_0x15fef3=await profile[_0x269e59(0x28f)]({'email':_0x5dbc06[_0x269e59(0x22d)]}),_0x3a8a21=await master_shop['find'](),_0x32b569=await customer[_0x269e59(0x20d)]({});let _0x3077ff;if(_0x5dbc06[_0x269e59(0x245)]==_0x269e59(0x1dd)){const _0x235225=await staff[_0x269e59(0x28f)]({'email':_0x5dbc06[_0x269e59(0x22d)]});_0x3077ff=await warehouse[_0x269e59(0x244)]([{'$match':{'status':_0x269e59(0x1fa),'name':_0x235225[_0x269e59(0x28d)],'warehouse_category':_0x269e59(0x275),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x269e59(0x2d2)}}},{'$sort':{'name':0x1}}]);}else _0x3077ff=await warehouse[_0x269e59(0x244)]([{'$match':{'status':_0x269e59(0x1fa),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x269e59(0x291)}}},{'$group':{'_id':_0x269e59(0x2d2),'name':{'$first':_0x269e59(0x2d2)}}},{'$sort':{'name':0x1}}]);const _0x35cd34=await product[_0x269e59(0x20d)]({});var _0x4c0630=[_0x269e59(0x2d3),_0x269e59(0x2a3)];const _0x6ac59b=await sales_finished[_0x269e59(0x20d)]({}),_0x3432d5=_0x6ac59b[_0x269e59(0x23b)]+0x1,_0x1de438='OUTF-'+_0x3432d5[_0x269e59(0x2a5)]()[_0x269e59(0x28c)](0x5,'0');if(_0x3a8a21[0x0]['language']==_0x269e59(0x2eb)){var _0x3a971b=users[_0x269e59(0x2c8)];console[_0x269e59(0x281)](_0x3a971b);}else{if(_0x3a8a21[0x0]['language']==_0x269e59(0x241))var _0x3a971b=users[_0x269e59(0x241)];else{if(_0x3a8a21[0x0][_0x269e59(0x2dd)]==_0x269e59(0x20a))var _0x3a971b=users[_0x269e59(0x20a)];else{if(_0x3a8a21[0x0][_0x269e59(0x2dd)]==_0x269e59(0x20f))var _0x3a971b=users[_0x269e59(0x20f)];else{if(_0x3a8a21[0x0]['language']==_0x269e59(0x1df))var _0x3a971b=users[_0x269e59(0x1df)];else{if(_0x3a8a21[0x0][_0x269e59(0x2dd)]==_0x269e59(0x2da))var _0x3a971b=users['Portuguese'];else{if(_0x3a8a21[0x0][_0x269e59(0x2dd)]==_0x269e59(0x2ab))var _0x3a971b=users['Chinese'];else{if(_0x3a8a21[0x0][_0x269e59(0x2dd)]==_0x269e59(0x263))var _0x3a971b=users[_0x269e59(0x2f3)];}}}}}}}const _0x2a46c3=getRandom8DigitNumber();_0x2a46c3[_0x269e59(0x267)](_0x1bd0fd=>{var _0x48fcf8=_0x269e59;_0x198b39[_0x48fcf8(0x2ac)](_0x48fcf8(0x2f1),{'success':_0x5caa80['flash']('success'),'errors':_0x5caa80[_0x48fcf8(0x29f)](_0x48fcf8(0x29a)),'role':_0x5dbc06,'profile':_0x15fef3,'customer':_0x32b569,'warehouse':_0x3077ff,'product':_0x35cd34,'invoice':_0x1bd0fd,'master_shop':_0x3a8a21,'language':_0x3a971b,'rooms_data':_0x4c0630});})[_0x269e59(0x219)](_0x4d3686=>{var _0x35c66e=_0x269e59;_0x5caa80[_0x35c66e(0x29f)](_0x35c66e(0x29a),_0x35c66e(0x278)),_0x198b39[_0x35c66e(0x2e9)](_0x35c66e(0x1f8));});}catch(_0x4adf19){console[_0x269e59(0x281)](_0x4adf19);}}),router[a0_0x10e5da(0x243)](a0_0x10e5da(0x25a),auth,async(_0x2d27d8,_0x523a66)=>{var _0x430782=a0_0x10e5da;try{const _0x390097=_0x2d27d8['params']['id'];console[_0x430782(0x281)](_0x390097);const _0x3bb82c=await product[_0x430782(0x20d)](),_0x484fe8=await purchases[_0x430782(0x244)]([{'$match':{'warehouse_name':_0x390097}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x430782(0x281)]('purchases_data',_0x484fe8),_0x523a66['status'](0xc8)[_0x430782(0x2b4)]({'purchases_data':_0x484fe8,'product_data':_0x3bb82c});}catch(_0x17c2ca){console[_0x430782(0x281)](_0x17c2ca);}}),router['post']('/view/add_sale/product',auth,async(_0x4d2714,_0x1f2fd8)=>{var _0x46d723=a0_0x10e5da;try{const {warehouse_data:_0x451c16,product_data:_0x26ebd5}=_0x4d2714[_0x46d723(0x22c)];console[_0x46d723(0x281)](_0x4d2714[_0x46d723(0x22c)][_0x46d723(0x251)]);;const _0x1d8f7a=await master_shop['find']();console['log']('master',_0x1d8f7a);const _0x33b55f=await product[_0x46d723(0x28f)]({'name':_0x26ebd5});console[_0x46d723(0x281)](_0x46d723(0x2cf),_0x33b55f);const _0x180671=await warehouse[_0x46d723(0x244)]([{'$match':{'name':_0x451c16}},{'$unwind':_0x46d723(0x217)},{'$match':{'product_details.product_name':_0x26ebd5}},{'$group':{'_id':_0x46d723(0x2bf),'product_stock':{'$first':_0x46d723(0x2d8)}}}]);console[_0x46d723(0x281)](_0x46d723(0x24b),_0x180671),_0x1f2fd8[_0x46d723(0x290)](0xc8)[_0x46d723(0x2b4)]({'master':_0x1d8f7a,'new_product':_0x33b55f,'stock_data':_0x180671});}catch(_0x1c6ad1){console[_0x46d723(0x281)](_0x1c6ad1);}}),router['post'](a0_0x10e5da(0x205),auth,async(_0x1cbf43,_0x252885)=>{var _0x221bac=a0_0x10e5da;try{const {invoice:_0x248eae,date:_0x5d311c,warehouse_name:_0x1f4e3c,product_name:_0x44ce9c,stock:_0xc8be3b,quantity:_0x1554d3,note:_0x1d2df5,room:_0x3a3ea2,primary_code:_0x5729b0,secondary_code:_0x137d2c,prod_code:_0x5d2d2a,level:_0x482807,isle:_0x2f5c32,pallet:_0x4890fc,batch_code:_0x277055,SCRN:_0x54ab0c,expiry_date:_0x379624,mode_transpo:_0x272ff5,name_driver:_0x3f7611}=_0x1cbf43['body'];if(typeof _0x44ce9c==_0x221bac(0x27f))var _0x59a175=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x276)]],_0x5d9dcd=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x2c1)]],_0x3841fb=[_0x1cbf43['body'][_0x221bac(0x21b)]],_0x2105b1=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x1e2)]],_0x4a0d4d=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x29d)]],_0x46f9b7=[_0x1cbf43['body'][_0x221bac(0x1ee)]],_0x253ac2=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x2d1)]],_0x3f2418=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x232)]],_0x23c339=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x1fd)]],_0x2a28d2=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x1e8)]],_0x27f878=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x299)]],_0x1988d1=[_0x1cbf43[_0x221bac(0x22c)]['product_date']],_0x3e5a73=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x24d)]],_0x5447b9=[_0x1cbf43['body'][_0x221bac(0x264)]],_0x3bb826=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x26c)]],_0x11c7d4=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x2a8)]],_0x1eb051=[_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x1fe)]];else var _0x59a175=[..._0x1cbf43[_0x221bac(0x22c)]['product_name']],_0x5d9dcd=[..._0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x2c1)]],_0x3841fb=[..._0x1cbf43[_0x221bac(0x22c)]['carton']],_0x2105b1=[..._0x1cbf43[_0x221bac(0x22c)]['primary_code']],_0x4a0d4d=[..._0x1cbf43['body'][_0x221bac(0x29d)]],_0x46f9b7=[..._0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x1ee)]],_0x253ac2=[..._0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x2d1)]],_0x3f2418=[..._0x1cbf43['body']['primary_unit']],_0x23c339=[..._0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x1fd)]],_0x2a28d2=[..._0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x1e8)]],_0x27f878=[..._0x1cbf43[_0x221bac(0x22c)]['expiry_date']],_0x1988d1=[..._0x1cbf43['body'][_0x221bac(0x2ad)]],_0x3e5a73=[..._0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x24d)]],_0x5447b9=[..._0x1cbf43['body']['prod_cat']],_0x3bb826=[..._0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x26c)]],_0x11c7d4=[..._0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x2a8)]],_0x1eb051=[..._0x1cbf43['body']['id_transaction_from']];const _0x50d92f=_0x59a175['map'](_0x367e5a=>{return _0x367e5a={'product_name':_0x367e5a};});_0x5d9dcd[_0x221bac(0x29c)]((_0x86cd77,_0xbbf0d0)=>{var _0x264467=_0x221bac;_0x50d92f[_0xbbf0d0][_0x264467(0x2c1)]=_0x86cd77;}),_0x3841fb[_0x221bac(0x29c)]((_0x547a6b,_0x3ee6f2)=>{var _0x3931df=_0x221bac;_0x50d92f[_0x3ee6f2][_0x3931df(0x280)]=Math[_0x3931df(0x279)](_0x547a6b);}),_0x1eb051[_0x221bac(0x29c)]((_0x4d5497,_0x4ba33d)=>{var _0x36be37=_0x221bac;_0x50d92f[_0x4ba33d][_0x36be37(0x1fe)]=_0x4d5497;}),_0x2105b1[_0x221bac(0x29c)]((_0xbb2c66,_0x199f11)=>{var _0x140b76=_0x221bac;_0x50d92f[_0x199f11][_0x140b76(0x1e2)]=_0xbb2c66;}),_0x4a0d4d['forEach']((_0x544d39,_0x213538)=>{var _0x54819f=_0x221bac;_0x50d92f[_0x213538][_0x54819f(0x29d)]=_0x544d39;}),_0x46f9b7[_0x221bac(0x29c)]((_0x150264,_0x1c5582)=>{var _0x1e4286=_0x221bac;_0x50d92f[_0x1c5582][_0x1e4286(0x240)]=_0x150264;}),_0x253ac2[_0x221bac(0x29c)]((_0x24e29d,_0x4374c8)=>{var _0x40a782=_0x221bac;_0x50d92f[_0x4374c8][_0x40a782(0x2c4)]=_0x24e29d;}),_0x3f2418[_0x221bac(0x29c)]((_0x282741,_0x462cae)=>{_0x50d92f[_0x462cae]['unit']=_0x282741;}),_0x23c339[_0x221bac(0x29c)]((_0x44a270,_0x264cde)=>{var _0x862d42=_0x221bac;_0x50d92f[_0x264cde][_0x862d42(0x1fd)]=_0x44a270;}),_0x2a28d2[_0x221bac(0x29c)]((_0x574b6e,_0x136e88)=>{_0x50d92f[_0x136e88]['batch_code']=_0x574b6e;}),_0x27f878[_0x221bac(0x29c)]((_0x1c9fb3,_0x5f528f)=>{_0x50d92f[_0x5f528f]['expiry_date']=_0x1c9fb3;}),_0x1988d1[_0x221bac(0x29c)]((_0x2d05b4,_0x4b5241)=>{_0x50d92f[_0x4b5241]['production_date']=_0x2d05b4;}),_0x3e5a73[_0x221bac(0x29c)]((_0x3f49ce,_0x53d4fe)=>{var _0x52b713=_0x221bac;_0x50d92f[_0x53d4fe][_0x52b713(0x21f)]=_0x3f49ce;}),_0x5447b9[_0x221bac(0x29c)]((_0x40e38a,_0x9d8603)=>{var _0x38aeb1=_0x221bac;_0x50d92f[_0x9d8603][_0x38aeb1(0x264)]=_0x40e38a;}),_0x3bb826[_0x221bac(0x29c)]((_0x11981e,_0x4987e6)=>{var _0x210320=_0x221bac;_0x50d92f[_0x4987e6][_0x210320(0x23e)]=_0x11981e;}),_0x11c7d4[_0x221bac(0x29c)]((_0x299c57,_0x1fd811)=>{var _0x16237f=_0x221bac;_0x50d92f[_0x1fd811][_0x16237f(0x265)]=_0x299c57;});var _0x30564d=0x0;_0x50d92f[_0x221bac(0x29c)](_0x2cb445=>{var _0x332b5e=_0x221bac;parseFloat(_0x2cb445[_0x332b5e(0x2c1)])<parseFloat(_0x2cb445[_0x332b5e(0x280)])&&parseFloat(_0x2cb445[_0x332b5e(0x280)])>parseFloat(_0x2cb445[_0x332b5e(0x2c1)])&&(console[_0x332b5e(0x281)](_0x2cb445['stock']+_0x332b5e(0x25d)+_0x2cb445[_0x332b5e(0x280)]),_0x30564d++);});if(_0x30564d!=0x0)return _0x1cbf43['flash']('errors','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x252885[_0x221bac(0x2e9)](_0x221bac(0x23d));const _0x3fbeab=_0x50d92f[_0x221bac(0x2bb)](_0x43d78a=>_0x43d78a['quantity']!=='0'&&_0x43d78a['quantity']!==''),_0x21517f=new sales_finished({'invoice':_0x248eae,'customer':_0x1cbf43[_0x221bac(0x22c)]['customer'],'date':_0x5d311c,'warehouse_name':_0x1f4e3c,'sale_product':_0x3fbeab,'note':_0x1d2df5,'room':_0x3a3ea2,'primary_code':_0x5729b0,'secondary_code':_0x137d2c,'prod_code':_0x5d2d2a,'SCRN':_0x54ab0c,'finalize':_0x221bac(0x223),'mode_transpo':_0x272ff5,'name_driver':_0x3f7611}),_0x5589cb=await _0x21517f[_0x221bac(0x258)](),_0x443aa5=await sales_finished['findOne']({'invoice':_0x248eae}),_0x1f4cea=new c_payment_data({'invoice':_0x248eae,'customer':_0x1cbf43[_0x221bac(0x22c)]['customer'],'reason':_0x221bac(0x2ec)});await _0x1f4cea[_0x221bac(0x258)]();const _0x1843ac=await master_shop[_0x221bac(0x20d)](),_0x142d3c=await email_settings['findOne'](),_0x1f579b=await customer[_0x221bac(0x28f)]({'name':_0x1cbf43[_0x221bac(0x22c)][_0x221bac(0x209)]});_0x1843ac[0x0][_0x221bac(0x2aa)]==0x1?(right_currency=_0x1843ac[0x0][_0x221bac(0x1dc)],left_currency=''):(right_currency='',left_currency=_0x1843ac[0x0][_0x221bac(0x1dc)]);var _0x5e24e8=_0x59a175,_0x299ab4=_0x3841fb,_0x113bb0='',_0x3dcfd4;for(_0x3dcfd4 in _0x5e24e8){_0x113bb0+=_0x221bac(0x21d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5e24e8[_0x3dcfd4]+'</td>'+_0x221bac(0x28e)+_0x299ab4[_0x3dcfd4]+_0x221bac(0x1de)+_0x221bac(0x2e8);}console[_0x221bac(0x281)](_0x221bac(0x2b6),_0x113bb0);let _0x238086=nodemailer['createTransport']({'host':_0x142d3c['host'],'port':Number(_0x142d3c['port']),'secure':![],'service':_0x221bac(0x22a),'auth':{'user':_0x142d3c['email'],'pass':_0x142d3c[_0x221bac(0x2ce)]}}),_0x2dc4e0={'from':_0x142d3c[_0x221bac(0x22d)],'to':'christian.villamer@jakagroup.com','subject':_0x221bac(0x218),'attachments':[{'filename':_0x221bac(0x288),'path':__dirname+_0x221bac(0x1e3)+'/upload/'+_0x1843ac[0x0]['image'],'cid':_0x221bac(0x2a4)}],'html':'ADD\x20SALE'};_0x238086['sendMail'](_0x2dc4e0,function(_0x2ce4f2,_0xaf510d){var _0x378b80=_0x221bac;_0x2ce4f2?(console['log'](_0x2ce4f2),console[_0x378b80(0x281)](_0x378b80(0x2af))):console['log'](_0x378b80(0x2b3));}),_0x1cbf43['flash'](_0x221bac(0x1f0),_0x221bac(0x2ee)),_0x252885[_0x221bac(0x2e9)](_0x221bac(0x200)+_0x5589cb['_id']);}catch(_0x40e70c){console['log'](_0x40e70c);}}),router[a0_0x10e5da(0x243)](a0_0x10e5da(0x221),auth,async(_0x40f533,_0x3c54f8)=>{var _0xaa1891=a0_0x10e5da;try{const {username:_0x389297,email:_0x31ee42,role:_0x347d98}=_0x40f533[_0xaa1891(0x27a)],_0x5e78c5=_0x40f533[_0xaa1891(0x27a)],_0x42e773=await profile['findOne']({'email':_0x5e78c5[_0xaa1891(0x22d)]}),_0x5e0151=await master_shop[_0xaa1891(0x20d)](),_0x25bfa7=_0x40f533[_0xaa1891(0x202)]['id'],_0x37493c=await sales_finished[_0xaa1891(0x259)](_0x25bfa7),_0x1b30b6=await warehouse[_0xaa1891(0x244)]([{'$match':{'name':_0x37493c[_0xaa1891(0x1ef)]}},{'$unwind':_0xaa1891(0x217)},{'$group':{'_id':_0xaa1891(0x1e0),'name':{'$first':_0xaa1891(0x2bf)},'product_stock':{'$first':_0xaa1891(0x2d8)},'bay':{'$first':_0xaa1891(0x2bd)},'bin':{'$first':_0xaa1891(0x248)},'type':{'$first':_0xaa1891(0x1f6)},'floorlevel':{'$first':_0xaa1891(0x296)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xaa1891(0x20e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0xaa1891(0x250)},'batch_code':{'$first':_0xaa1891(0x21c)},'room':{'$first':_0xaa1891(0x294)},'room_data':{'$first':'$product_details.room_name'}}}]),_0x4cb234=await customer[_0xaa1891(0x20d)]({});let _0x4019eb;if(_0x5e78c5['role']==_0xaa1891(0x1dd)){const _0x5c8826=await staff['findOne']({'email':_0x5e78c5[_0xaa1891(0x22d)]});_0x4019eb=await warehouse[_0xaa1891(0x244)]([{'$match':{'status':_0xaa1891(0x1fa),'name':_0x5c8826[_0xaa1891(0x28d)]}},{'$group':{'_id':'$name','name':{'$first':_0xaa1891(0x2d2)}}}]);}else _0x4019eb=await warehouse[_0xaa1891(0x244)]([{'$match':{'status':_0xaa1891(0x1fa)}},{'$group':{'_id':_0xaa1891(0x2d2),'name':{'$first':_0xaa1891(0x2d2)}}}]);const _0x525cc1=await product[_0xaa1891(0x20d)]({});if(_0x5e0151[0x0][_0xaa1891(0x2dd)]==_0xaa1891(0x2eb)){var _0xa9f2b9=users[_0xaa1891(0x2c8)];console[_0xaa1891(0x281)](_0xa9f2b9);}else{if(_0x5e0151[0x0][_0xaa1891(0x2dd)]==_0xaa1891(0x241))var _0xa9f2b9=users['Hindi'];else{if(_0x5e0151[0x0][_0xaa1891(0x2dd)]==_0xaa1891(0x20a))var _0xa9f2b9=users[_0xaa1891(0x20a)];else{if(_0x5e0151[0x0]['language']==_0xaa1891(0x20f))var _0xa9f2b9=users[_0xaa1891(0x20f)];else{if(_0x5e0151[0x0][_0xaa1891(0x2dd)]=='French')var _0xa9f2b9=users[_0xaa1891(0x1df)];else{if(_0x5e0151[0x0]['language']=='Portuguese\x20(BR)')var _0xa9f2b9=users[_0xaa1891(0x2b5)];else{if(_0x5e0151[0x0][_0xaa1891(0x2dd)]==_0xaa1891(0x2ab))var _0xa9f2b9=users['Chinese'];else{if(_0x5e0151[0x0][_0xaa1891(0x2dd)]==_0xaa1891(0x263))var _0xa9f2b9=users[_0xaa1891(0x2f3)];}}}}}}}_0x3c54f8['render'](_0xaa1891(0x227),{'success':_0x40f533[_0xaa1891(0x29f)](_0xaa1891(0x1f0)),'errors':_0x40f533[_0xaa1891(0x29f)]('errors'),'role':_0x5e78c5,'profile':_0x42e773,'customer':_0x4cb234,'warehouse':_0x4019eb,'product':_0x1b30b6,'user':_0x37493c,'master_shop':_0x5e0151,'unit':_0x525cc1,'language':_0xa9f2b9});}catch(_0xe21382){console[_0xaa1891(0x281)](_0xe21382);}}),router['post'](a0_0x10e5da(0x221),auth,async(_0x203d27,_0x58f83a)=>{var _0x133148=a0_0x10e5da;try{const _0xeacf86=_0x203d27[_0x133148(0x202)]['id'],{invoice:_0x422004,warehouse_name:_0x3aa3ad,room:_0xd7cc44}=_0x203d27[_0x133148(0x22c)],_0x2580b9=await sales_finished[_0x133148(0x28f)]({'invoice':_0x422004}),_0x59b7a1=_0x2580b9[_0x133148(0x262)]['map'](async _0x3b759a=>{var _0x4e1f2b=_0x133148,_0x118dd7=await warehouse[_0x4e1f2b(0x28f)]({'name':_0x3aa3ad,'room':_0x3b759a[_0x4e1f2b(0x23e)],'warehouse_category':_0x4e1f2b(0x275)});const _0x33fe52=_0x118dd7['product_details'][_0x4e1f2b(0x260)](_0x3c1ea8=>{var _0x5ced88=_0x4e1f2b;(_0x3c1ea8[_0x5ced88(0x276)]==_0x3b759a[_0x5ced88(0x276)]&&_0x3c1ea8[_0x5ced88(0x2c4)]==_0x3b759a[_0x5ced88(0x2c4)]&&_0x3c1ea8[_0x5ced88(0x299)]==_0x3b759a[_0x5ced88(0x299)]&&_0x3c1ea8['production_date']==_0x3b759a[_0x5ced88(0x2b9)]&&_0x3c1ea8[_0x5ced88(0x1e8)]==_0x3b759a['batch_code']&&_0x3c1ea8[_0x5ced88(0x265)]==_0x3b759a['invoice']||_0x3c1ea8[_0x5ced88(0x2c0)]==_0x3b759a[_0x5ced88(0x1fe)])&&(_0x3c1ea8[_0x5ced88(0x253)]>0x0&&(console['log'](_0x3c1ea8[_0x5ced88(0x276)]+_0x5ced88(0x28a)+_0x3b759a[_0x5ced88(0x276)]+_0x5ced88(0x2f5)+_0x3c1ea8[_0x5ced88(0x2c4)]+'\x20==\x20'+_0x3b759a[_0x5ced88(0x2c4)]+_0x5ced88(0x2f5)+_0x3c1ea8['production_date']+_0x5ced88(0x28a)+_0x3b759a[_0x5ced88(0x2b9)]+_0x5ced88(0x2f5)+_0x3c1ea8['expiry_date']+'\x20==\x20'+_0x3b759a['expiry_date']+'\x20&&\x20'+_0x3c1ea8[_0x5ced88(0x1e8)]+_0x5ced88(0x28a)+_0x3b759a[_0x5ced88(0x1e8)]+_0x5ced88(0x2f5)+_0x3c1ea8['invoice']+_0x5ced88(0x28a)+_0x3b759a[_0x5ced88(0x265)]+_0x5ced88(0x2f5)+_0x3c1ea8[_0x5ced88(0x253)]+_0x5ced88(0x2a9)+_0x3b759a['quantity']+'\x20>>>\x20'+_0x3b759a[_0x5ced88(0x23e)]+'\x20&&\x20'+_0x3c1ea8[_0x5ced88(0x2c0)]+_0x5ced88(0x28a)+_0x3b759a[_0x5ced88(0x1fe)]),_0x3c1ea8[_0x5ced88(0x253)]=Math[_0x5ced88(0x1ec)](0x0,Math[_0x5ced88(0x279)](_0x3c1ea8[_0x5ced88(0x253)])-Math['abs'](_0x3b759a[_0x5ced88(0x280)]))));});return _0x118dd7;});Promise[_0x133148(0x2c6)](_0x59b7a1)['then'](async _0x2de7b1=>{var _0x12be39=_0x133148;try{for(const _0x5573f4 of _0x2de7b1){await _0x5573f4[_0x12be39(0x258)]();}_0x2580b9[_0x12be39(0x2e1)]=_0x12be39(0x24f);const _0x361f89=await _0x2580b9['save'](),_0x4b99af=await master_shop[_0x12be39(0x20d)](),_0x3b3a14=await email_settings[_0x12be39(0x28f)](),_0x3cfe4f=await supervisor_settings[_0x12be39(0x20d)]();var _0x36291f=_0x2580b9[_0x12be39(0x262)],_0x58e74c='',_0x295317;for(_0x295317 in _0x36291f){var _0xa394d5='FG';_0x2580b9[_0x12be39(0x1ef)]=='DRY\x20GOODS'&&(_0xa394d5='DG'),_0x58e74c+=_0x12be39(0x21d)+_0x12be39(0x28e)+_0x36291f[_0x295317][_0x12be39(0x276)]+_0x12be39(0x1de)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x36291f[_0x295317]['product_code']+_0x12be39(0x1de)+_0x12be39(0x28e)+_0x36291f[_0x295317][_0x12be39(0x280)]+_0x12be39(0x1de)+_0x12be39(0x28e)+_0x36291f[_0x295317][_0x12be39(0x215)]+_0x12be39(0x1de)+_0x12be39(0x28e)+_0x36291f[_0x295317]['secondary_unit']+_0x12be39(0x1de)+_0x12be39(0x28e)+_0x2580b9['warehouse_name']+_0x12be39(0x1de)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x36291f[_0x295317]['room_name']+_0x12be39(0x1de)+_0x12be39(0x28e)+_0xa394d5+_0x36291f[_0x295317][_0x12be39(0x2c4)]+_0x12be39(0x1de);}let _0x47fa8f=nodemailer[_0x12be39(0x2df)]({'host':_0x3b3a14[_0x12be39(0x1f2)],'port':Number(_0x3b3a14[_0x12be39(0x226)]),'secure':![],'auth':{'user':_0x3b3a14[_0x12be39(0x22d)],'pass':_0x3b3a14[_0x12be39(0x2ce)]}}),_0x46d96a={'from':_0x3b3a14[_0x12be39(0x22d)],'to':_0x3cfe4f[0x0][_0x12be39(0x216)],'subject':_0x12be39(0x1e1),'attachments':[{'filename':_0x12be39(0x288),'path':__dirname+_0x12be39(0x1e3)+_0x12be39(0x252)+_0x4b99af[0x0]['image'],'cid':'logo'}],'html':_0x12be39(0x2cb)+_0x12be39(0x220)+'</head><body>'+_0x12be39(0x231)+_0x12be39(0x1e6)+_0x12be39(0x231)+_0x12be39(0x2e3)+_0x12be39(0x2e6)+_0x12be39(0x231)+_0x12be39(0x27b)+_0x4b99af[0x0]['site_title']+_0x12be39(0x272)+'</div>'+'</div>'+_0x12be39(0x229)+_0x12be39(0x231)+_0x12be39(0x2f0)+_0x12be39(0x236)+_0x2580b9[_0x12be39(0x265)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x12be39(0x1f7)+_0x2580b9[_0x12be39(0x237)]+'\x20'+_0x12be39(0x1ff)+_0x12be39(0x2b7)+_0x12be39(0x2e6)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x12be39(0x261)+_0x12be39(0x21d)+_0x12be39(0x2b2)+_0x12be39(0x27c)+_0x12be39(0x1e9)+_0x12be39(0x211)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x12be39(0x257)+_0x12be39(0x212)+_0x12be39(0x2e8)+_0x12be39(0x2dc)+_0x12be39(0x222)+'\x20'+_0x58e74c+'\x20'+_0x12be39(0x2f2)+_0x12be39(0x24e)+'<div>'+_0x12be39(0x22b)+_0x12be39(0x2cd)+_0x4b99af[0x0][_0x12be39(0x249)]+'</h5>'+_0x12be39(0x2e6)+_0x12be39(0x2e6)+_0x12be39(0x233)};_0x47fa8f[_0x12be39(0x25e)](_0x46d96a,function(_0x5bf71d,_0x1bb0f9){var _0x276ec7=_0x12be39;_0x5bf71d?(console[_0x276ec7(0x281)](_0x5bf71d),console['log'](_0x276ec7(0x2af))):console['log'](_0x276ec7(0x2b3));}),_0x203d27[_0x12be39(0x29f)]('success',_0x12be39(0x20c)),_0x58f83a[_0x12be39(0x2e9)](_0x12be39(0x230)+_0xeacf86);}catch(_0x4563a9){console[_0x12be39(0x204)](_0x4563a9),_0x58f83a[_0x12be39(0x290)](0x1f4)['json']({'error':_0x12be39(0x2f7)});}})[_0x133148(0x219)](_0x1c1948=>{var _0x18eec6=_0x133148;console[_0x18eec6(0x204)](_0x1c1948),_0x58f83a[_0x18eec6(0x290)](0x1f4)[_0x18eec6(0x2b4)]({'error':_0x18eec6(0x206)});});}catch(_0x373976){console[_0x133148(0x281)](_0x373976);}}),router[a0_0x10e5da(0x243)](a0_0x10e5da(0x292),auth,async(_0x5ab83d,_0x1383df)=>{var _0x4771e2=a0_0x10e5da;try{const {username:_0x56a1ef,email:_0x5c43b7,role:_0x1fe4ea}=_0x5ab83d['user'],_0x5b03fb=_0x5ab83d[_0x4771e2(0x27a)],_0x37555a=await profile[_0x4771e2(0x28f)]({'email':_0x5b03fb[_0x4771e2(0x22d)]}),_0x42e1a6=await master_shop[_0x4771e2(0x20d)](),_0x543bb6=_0x5ab83d[_0x4771e2(0x202)]['id'],_0x186b35=await sales_finished['findById'](_0x543bb6);let _0x6de2e4=new Date(_0x186b35[_0x4771e2(0x299)]),_0x2f9244=('0'+_0x6de2e4[_0x4771e2(0x23a)]())[_0x4771e2(0x238)](-0x2),_0x5f2ab6=('0'+(_0x6de2e4[_0x4771e2(0x1e4)]()+0x1))['slice'](-0x2),_0x1827cd=_0x6de2e4[_0x4771e2(0x2ae)](),_0x4d6afc=_0x1827cd+'-'+_0x5f2ab6+'-'+_0x2f9244;var _0xd92ed=[_0x4771e2(0x2d3),_0x4771e2(0x2a3)];const _0x5744cf=await warehouse[_0x4771e2(0x244)]([{'$match':{'name':_0x186b35[_0x4771e2(0x1ef)],'room':_0x186b35[_0x4771e2(0x293)]}},{'$unwind':_0x4771e2(0x217)},{'$group':{'_id':_0x4771e2(0x1e0),'name':{'$first':_0x4771e2(0x2bf)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4771e2(0x2bd)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4771e2(0x1f6)},'floorlevel':{'$first':_0x4771e2(0x296)},'primary_code':{'$first':_0x4771e2(0x269)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4771e2(0x297)},'storage':{'$first':_0x4771e2(0x271)},'rack':{'$first':'$product_details.rack'}}}]),_0x5476bf=await customer['find']({});let _0x19ee07;if(_0x5b03fb[_0x4771e2(0x245)]=='staff'){const _0x51ab6e=await staff[_0x4771e2(0x28f)]({'email':_0x5b03fb[_0x4771e2(0x22d)]});_0x19ee07=await warehouse[_0x4771e2(0x244)]([{'$match':{'status':'Enabled','name':_0x51ab6e[_0x4771e2(0x28d)]}},{'$group':{'_id':_0x4771e2(0x2d2),'name':{'$first':_0x4771e2(0x2d2)}}}]);}else _0x19ee07=await warehouse[_0x4771e2(0x244)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x4771e2(0x2d2),'name':{'$first':_0x4771e2(0x2d2)}}}]);const _0x24a9b3=await product[_0x4771e2(0x20d)]({});if(_0x42e1a6[0x0]['language']==_0x4771e2(0x2eb)){var _0x427c3b=users[_0x4771e2(0x2c8)];console['log'](_0x427c3b);}else{if(_0x42e1a6[0x0][_0x4771e2(0x2dd)]==_0x4771e2(0x241))var _0x427c3b=users[_0x4771e2(0x241)];else{if(_0x42e1a6[0x0][_0x4771e2(0x2dd)]=='German')var _0x427c3b=users[_0x4771e2(0x20a)];else{if(_0x42e1a6[0x0][_0x4771e2(0x2dd)]==_0x4771e2(0x20f))var _0x427c3b=users[_0x4771e2(0x20f)];else{if(_0x42e1a6[0x0][_0x4771e2(0x2dd)]=='French')var _0x427c3b=users[_0x4771e2(0x1df)];else{if(_0x42e1a6[0x0][_0x4771e2(0x2dd)]==_0x4771e2(0x2da))var _0x427c3b=users['Portuguese'];else{if(_0x42e1a6[0x0]['language']==_0x4771e2(0x2ab))var _0x427c3b=users['Chinese'];else{if(_0x42e1a6[0x0][_0x4771e2(0x2dd)]==_0x4771e2(0x263))var _0x427c3b=users[_0x4771e2(0x2f3)];}}}}}}}_0x1383df[_0x4771e2(0x2ac)]('edit_sales_finished',{'success':_0x5ab83d['flash'](_0x4771e2(0x1f0)),'errors':_0x5ab83d[_0x4771e2(0x29f)]('errors'),'role':_0x5b03fb,'profile':_0x37555a,'customer':_0x5476bf,'warehouse':_0x19ee07,'product':_0x5744cf,'user':_0x186b35,'master_shop':_0x42e1a6,'unit':_0x24a9b3,'language':_0x427c3b,'rooms_data':_0xd92ed,'ed_fullDate':_0x4d6afc});}catch(_0x18f046){console[_0x4771e2(0x281)](_0x18f046);}}),router[a0_0x10e5da(0x285)](a0_0x10e5da(0x292),auth,async(_0x569e59,_0x38ac17)=>{var _0x1dd73b=a0_0x10e5da;try{const _0x5a012a=_0x569e59[_0x1dd73b(0x202)]['id'],_0x12b6cd=await sales_finished['findOne']({'_id':_0x569e59[_0x1dd73b(0x202)]['id']}),_0x5cad09=await warehouse['findOne']({'name':_0x12b6cd['warehouse_name'],'room':_0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x293)],'warehouse_category':_0x1dd73b(0x275)}),{invoice:_0x396c12,customer:_0x2a5cb5,date:_0x5c4c11,warehouse_name:_0x49db58,product_name:_0xee5692,stock:_0x4ad342,adjust_qty:_0x162046,note:_0x3eb505,room:_0x3f2985,primary_code:_0x479963,secondary_code:_0x482e28,prod_code:_0x4aa016,level:_0x5035d3,isle:_0x4016b9,pallet:_0x3cce08,expiry_date:_0xbd43e8}=_0x569e59[_0x1dd73b(0x22c)];if(typeof _0xee5692==_0x1dd73b(0x27f))var _0x2872d1=[_0x569e59[_0x1dd73b(0x22c)]['product_name']],_0x3d1ca7=[_0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x2c1)]],_0x15d927=[_0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x2a7)]],_0x3c4392=[_0x569e59[_0x1dd73b(0x22c)]['primary_code']],_0x3bc4f9=[_0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x29d)]],_0x197c3c=[_0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x1ee)]],_0x54b12a=[_0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x2d1)]],_0x414418=[_0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x299)]];else var _0x2872d1=[..._0x569e59[_0x1dd73b(0x22c)]['product_name']],_0x3d1ca7=[..._0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x2c1)]],_0x15d927=[..._0x569e59['body'][_0x1dd73b(0x2a7)]],_0x3c4392=[..._0x569e59['body'][_0x1dd73b(0x1e2)]],_0x3bc4f9=[..._0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x29d)]],_0x197c3c=[..._0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x1ee)]],_0x54b12a=[..._0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x2d1)]],_0x414418=[..._0x569e59['body'][_0x1dd73b(0x299)]];const _0x2f5ff1=_0x2872d1['map'](_0x307d70=>{return _0x307d70={'product_name':_0x307d70};});_0x3d1ca7[_0x1dd73b(0x29c)]((_0x2bc2fc,_0x300e2a)=>{var _0x11af40=_0x1dd73b;_0x2f5ff1[_0x300e2a][_0x11af40(0x2c1)]=_0x2bc2fc;}),_0x15d927[_0x1dd73b(0x29c)]((_0x3df471,_0xbdd539)=>{var _0x3e5131=_0x1dd73b;_0x2f5ff1[_0xbdd539][_0x3e5131(0x280)]=_0x3df471;}),_0x3c4392[_0x1dd73b(0x29c)]((_0x1b193f,_0x34be32)=>{var _0x2c8716=_0x1dd73b;_0x2f5ff1[_0x34be32][_0x2c8716(0x1e2)]=_0x1b193f;}),_0x3bc4f9[_0x1dd73b(0x29c)]((_0x21ab8d,_0x44ab2c)=>{_0x2f5ff1[_0x44ab2c]['secondary_code']=_0x21ab8d;}),_0x197c3c['forEach']((_0x11d465,_0x566cad)=>{_0x2f5ff1[_0x566cad]['product_code']=_0x11d465;}),_0x54b12a[_0x1dd73b(0x29c)]((_0x3cddbf,_0x1a6799)=>{var _0x34fbfc=_0x1dd73b;_0x2f5ff1[_0x1a6799][_0x34fbfc(0x2d1)]=_0x3cddbf;}),_0x414418[_0x1dd73b(0x29c)]((_0x39bbf4,_0x10578f)=>{var _0x2b691b=_0x1dd73b;_0x2f5ff1[_0x10578f][_0x2b691b(0x299)]=_0x39bbf4;});var _0x5aa6a9=0x0;_0x2f5ff1[_0x1dd73b(0x29c)](_0x5c9459=>{var _0x2424e9=_0x1dd73b;console['log'](_0x2424e9(0x26a),_0x5c9459),(parseInt(_0x5c9459[_0x2424e9(0x2c1)])<parseInt(_0x5c9459[_0x2424e9(0x280)])||parseInt(_0x5c9459[_0x2424e9(0x280)])==0x0)&&_0x5aa6a9++;});if(_0x5aa6a9!=0x0)return _0x569e59[_0x1dd73b(0x29f)](_0x1dd73b(0x29a),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x38ac17[_0x1dd73b(0x2e9)](_0x1dd73b(0x23d));_0x12b6cd[_0x1dd73b(0x262)][_0x1dd73b(0x29c)](_0xc84c23=>{var _0x2521ba=_0x1dd73b;const _0x3f0abc=_0x5cad09[_0x2521ba(0x1e7)]['map'](_0x4d55bc=>{var _0x157ec7=_0x2521ba;_0x4d55bc[_0x157ec7(0x276)]==_0xc84c23[_0x157ec7(0x276)]&&_0x4d55bc[_0x157ec7(0x2c4)]==_0xc84c23[_0x157ec7(0x2c4)]&&(_0x4d55bc[_0x157ec7(0x253)]=parseInt(_0x4d55bc[_0x157ec7(0x253)])+parseInt(_0xc84c23[_0x157ec7(0x280)]));});}),await _0x5cad09[_0x1dd73b(0x258)]();const _0xe50d1f=_0x2f5ff1[_0x1dd73b(0x2bb)](_0x5a620e=>_0x5a620e[_0x1dd73b(0x280)]!=='0'&&_0x5a620e[_0x1dd73b(0x280)]!=='');_0x12b6cd[_0x1dd73b(0x265)]=_0x396c12,_0x12b6cd[_0x1dd73b(0x209)]=_0x2a5cb5,_0x12b6cd['date']=_0x5c4c11,_0x12b6cd['warehouse_name']=_0x49db58,_0x12b6cd[_0x1dd73b(0x262)]=_0xe50d1f,_0x12b6cd[_0x1dd73b(0x25b)]=_0x3eb505,_0x12b6cd[_0x1dd73b(0x293)]=_0x3f2985;const _0xfdbd3d=await _0x12b6cd[_0x1dd73b(0x258)](),_0x4babbc=await sales_finished[_0x1dd73b(0x28f)]({'_id':_0x569e59[_0x1dd73b(0x202)]['id']}),_0x3f98d8=await warehouse[_0x1dd73b(0x28f)]({'name':_0x49db58,'room':_0x3f2985,'warehouse_category':_0x1dd73b(0x275)});_0x4babbc[_0x1dd73b(0x262)]['forEach'](_0xb90d60=>{var _0x1253c3=_0x1dd73b;const _0x48b682=_0x3f98d8['product_details'][_0x1253c3(0x260)](_0x1f7a28=>{var _0x1c273b=_0x1253c3;_0x1f7a28[_0x1c273b(0x276)]==_0xb90d60[_0x1c273b(0x276)]&&_0x1f7a28[_0x1c273b(0x2c4)]==_0xb90d60[_0x1c273b(0x2c4)]&&(_0x1f7a28[_0x1c273b(0x253)]=parseInt(_0x1f7a28[_0x1c273b(0x253)])-parseInt(_0xb90d60[_0x1c273b(0x280)]));});}),console[_0x1dd73b(0x281)](_0x1dd73b(0x283),_0x3f98d8),await _0x3f98d8[_0x1dd73b(0x258)]();const _0x48d705=await c_payment_data[_0x1dd73b(0x28f)]({'invoice':_0x569e59[_0x1dd73b(0x22c)][_0x1dd73b(0x265)]});_0x48d705[_0x1dd73b(0x208)]=_0x569e59['body']['suppliers'],await _0x48d705[_0x1dd73b(0x258)](),_0x569e59['flash'](_0x1dd73b(0x1f0),_0x1dd73b(0x20c)),_0x38ac17[_0x1dd73b(0x2e9)](_0x1dd73b(0x1f8));}catch(_0xc9d3c3){console[_0x1dd73b(0x281)](_0xc9d3c3);}}),router[a0_0x10e5da(0x285)]('/give_payment/:id',auth,async(_0x5d41f2,_0x28c2d2)=>{var _0x3de460=a0_0x10e5da;try{const _0x4cc08d=_0x5d41f2['params']['id'],{invoice:_0x538453,customer:_0x36ec47,receivable_amount:_0x4edd35,received_amount:_0x433a38}=_0x5d41f2[_0x3de460(0x22c)],_0x1497a3=await sales[_0x3de460(0x259)](_0x4cc08d);console[_0x3de460(0x281)](_0x1497a3);var _0x4f3818=_0x4edd35-_0x433a38;console['log'](_0x433a38),_0x1497a3['received_amount']=parseFloat(_0x433a38)+parseFloat(_0x1497a3[_0x3de460(0x2d9)]),_0x1497a3[_0x3de460(0x2c9)]=_0x4f3818,console[_0x3de460(0x281)](_0x1497a3);const _0x28bae4=await _0x1497a3['save'](),_0x4db6a3=await c_payment_data[_0x3de460(0x28f)]({'invoice':_0x538453});_0x4db6a3[_0x3de460(0x2bc)]=_0x4f3818,await _0x4db6a3[_0x3de460(0x258)]();let _0x25a12a=new Date(),_0x237fae=('0'+_0x25a12a['getDate']())[_0x3de460(0x238)](-0x2),_0xa52d44=('0'+(_0x25a12a[_0x3de460(0x1e4)]()+0x1))[_0x3de460(0x238)](-0x2),_0x2cd2fc=_0x25a12a['getFullYear'](),_0x5e00d2=_0x2cd2fc+'-'+_0xa52d44+'-'+_0x237fae;const _0x15e1de=new customer_payment({'invoice':_0x538453,'date':_0x2cd2fc+'-'+_0xa52d44+'-'+_0x237fae,'customer':_0x36ec47,'reason':_0x3de460(0x29e),'amount':_0x433a38}),_0x3af322=await _0x15e1de['save']();_0x5d41f2[_0x3de460(0x29f)](_0x3de460(0x1f0),_0x3de460(0x239)),_0x28c2d2[_0x3de460(0x2e9)](_0x3de460(0x210));}catch(_0xbdf2bb){console[_0x3de460(0x281)](_0xbdf2bb);}}),router['get'](a0_0x10e5da(0x2f6),auth,async(_0xc77d9d,_0x1cf816)=>{var _0xecf954=a0_0x10e5da;try{const {username:_0x801213,email:_0x34a120,role:_0x181e40}=_0xc77d9d[_0xecf954(0x27a)],_0x11be35=_0xc77d9d[_0xecf954(0x27a)],_0x464de4=await profile['findOne']({'email':_0x11be35[_0xecf954(0x22d)]}),_0x3634e9=await master_shop[_0xecf954(0x20d)]();console['log'](_0xecf954(0x1ed),_0x3634e9);const _0x5da88c=_0xc77d9d[_0xecf954(0x202)]['id'],_0x42993f=await sales[_0xecf954(0x259)](_0x5da88c);console[_0xecf954(0x281)](_0x42993f);const _0x5cc79a=await customer[_0xecf954(0x28f)]({'name':_0x42993f[_0xecf954(0x209)]});console[_0xecf954(0x281)](_0x5cc79a);if(_0x3634e9[0x0]['language']=='English\x20(US)'){var _0xe18db=users[_0xecf954(0x2c8)];console['log'](_0xe18db);}else{if(_0x3634e9[0x0][_0xecf954(0x2dd)]==_0xecf954(0x241))var _0xe18db=users['Hindi'];else{if(_0x3634e9[0x0][_0xecf954(0x2dd)]==_0xecf954(0x20a))var _0xe18db=users[_0xecf954(0x20a)];else{if(_0x3634e9[0x0][_0xecf954(0x2dd)]=='Spanish')var _0xe18db=users['Spanish'];else{if(_0x3634e9[0x0][_0xecf954(0x2dd)]==_0xecf954(0x1df))var _0xe18db=users['French'];else{if(_0x3634e9[0x0][_0xecf954(0x2dd)]==_0xecf954(0x2da))var _0xe18db=users[_0xecf954(0x2b5)];else{if(_0x3634e9[0x0][_0xecf954(0x2dd)]==_0xecf954(0x2ab))var _0xe18db=users[_0xecf954(0x2ab)];else{if(_0x3634e9[0x0][_0xecf954(0x2dd)]=='Arabic\x20(ae)')var _0xe18db=users[_0xecf954(0x2f3)];}}}}}}}_0x1cf816[_0xecf954(0x2ac)](_0xecf954(0x228),{'success':_0xc77d9d[_0xecf954(0x29f)](_0xecf954(0x1f0)),'errors':_0xc77d9d[_0xecf954(0x29f)](_0xecf954(0x29a)),'role':_0x11be35,'profile':_0x464de4,'master_shop':_0x3634e9,'customers':_0x5cc79a,'sales':_0x42993f,'language':_0xe18db});}catch(_0x11e20d){console[_0xecf954(0x281)](_0x11e20d);}}),router['get'](a0_0x10e5da(0x26e),auth,async(_0x13090d,_0x350268)=>{var _0x5984f1=a0_0x10e5da;try{const {username:_0x15d930,email:_0x4b9882,role:_0x265bf3}=_0x13090d[_0x5984f1(0x27a)],_0x3648f9=_0x13090d[_0x5984f1(0x27a)],_0x3bafa1=await profile[_0x5984f1(0x28f)]({'email':_0x3648f9[_0x5984f1(0x22d)]}),_0x42b9a4=await master_shop[_0x5984f1(0x20d)](),_0x3d9afe=_0x13090d[_0x5984f1(0x202)]['id'],_0x1866ab=await sales_finished[_0x5984f1(0x259)](_0x3d9afe),_0x4e6c99=await warehouse[_0x5984f1(0x244)]([{'$match':{'name':_0x1866ab[_0x5984f1(0x1ef)]}},{'$unwind':_0x5984f1(0x217)},{'$group':{'_id':_0x5984f1(0x1e0),'name':{'$first':_0x5984f1(0x2bf)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5984f1(0x2bd)},'bin':{'$first':_0x5984f1(0x248)},'type':{'$first':_0x5984f1(0x1f6)},'floorlevel':{'$first':_0x5984f1(0x296)},'primary_code':{'$first':_0x5984f1(0x269)},'secondary_code':{'$first':_0x5984f1(0x247)},'product_code':{'$first':_0x5984f1(0x297)},'storage':{'$first':_0x5984f1(0x271)},'rack':{'$first':_0x5984f1(0x20e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0x5984f1(0x27e)},'secondary_unit':{'$first':_0x5984f1(0x1fc)},'maxProducts':{'$first':_0x5984f1(0x2f4)},'batch_code':{'$first':_0x5984f1(0x21c)},'maxPerUnit':{'$first':_0x5984f1(0x207)}}}]),_0x2723a1=await product['find']({}),_0x51f410=await warehouse[_0x5984f1(0x244)]([{'$match':{'status':_0x5984f1(0x1fa),'warehouse_category':_0x5984f1(0x275),'name':{'$ne':_0x5984f1(0x2d7),'$ne':_0x5984f1(0x255)}}},{'$group':{'_id':_0x5984f1(0x2d2),'name':{'$first':_0x5984f1(0x2d2)}}},{'$sort':{'name':0x1}}]);var _0xd26200=['Return\x20Rooms'];const _0x1c711d=await warehouse['aggregate']([{'$match':{'status':_0x5984f1(0x1fa),'name':_0x5984f1(0x255)}},{'$group':{'_id':_0x5984f1(0x2d2),'name':{'$first':_0x5984f1(0x2d2)}}},{'$sort':{'name':0x1}}]);if(_0x42b9a4[0x0][_0x5984f1(0x2dd)]==_0x5984f1(0x2eb)){var _0xd9a740=users[_0x5984f1(0x2c8)];console['log'](_0xd9a740);}else{if(_0x42b9a4[0x0][_0x5984f1(0x2dd)]==_0x5984f1(0x241))var _0xd9a740=users['Hindi'];else{if(_0x42b9a4[0x0][_0x5984f1(0x2dd)]=='German')var _0xd9a740=users[_0x5984f1(0x20a)];else{if(_0x42b9a4[0x0]['language']==_0x5984f1(0x20f))var _0xd9a740=users[_0x5984f1(0x20f)];else{if(_0x42b9a4[0x0][_0x5984f1(0x2dd)]=='French')var _0xd9a740=users[_0x5984f1(0x1df)];else{if(_0x42b9a4[0x0][_0x5984f1(0x2dd)]==_0x5984f1(0x2da))var _0xd9a740=users[_0x5984f1(0x2b5)];else{if(_0x42b9a4[0x0]['language']=='Chinese')var _0xd9a740=users[_0x5984f1(0x2ab)];else{if(_0x42b9a4[0x0][_0x5984f1(0x2dd)]==_0x5984f1(0x263))var _0xd9a740=users[_0x5984f1(0x2f3)];}}}}}}}_0x350268[_0x5984f1(0x2ac)](_0x5984f1(0x22f),{'success':_0x13090d['flash'](_0x5984f1(0x1f0)),'errors':_0x13090d[_0x5984f1(0x29f)](_0x5984f1(0x29a)),'role':_0x3648f9,'profile':_0x3bafa1,'user':_0x1866ab,'stock':_0x4e6c99,'master_shop':_0x42b9a4,'unit':_0x2723a1,'language':_0xd9a740,'warehouses':_0x51f410,'rooms':_0xd26200,'warehouse_QA':_0x1c711d});}catch(_0x371867){console[_0x5984f1(0x281)](_0x371867),_0x350268[_0x5984f1(0x290)](0xc8)[_0x5984f1(0x2b4)]({'message':_0x371867[_0x5984f1(0x256)]});}}),router['post'](a0_0x10e5da(0x26e),auth,async(_0x275414,_0x1e2300)=>{var _0x2b3b33=a0_0x10e5da;if(_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x22e)]=='QA')try{const {invoice:_0x438381,date:_0x103ec6,warehouse_name:_0x5a3dbc,product_name:_0x4e5708,primary_code:_0x4b0632,secondary_code:_0x5396a4,product_code:_0xfddde0,sales_quantity:_0x3950c7,stocks:_0x260b03,return_qty:_0x1eadcd,Room_name:_0x195824,to_warehouse_name_QA:_0x37d946,to_Room_name_QA:_0x1e9cd6,note:_0x1ab5a0,for_categorize:_0x478949,product_name_QA1:_0x207826}=_0x275414[_0x2b3b33(0x22c)];if(typeof _0x207826==_0x2b3b33(0x27f))var _0x2f41cd=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x289)]],_0x2da001=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x224)]],_0x100e05=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x1f9)]],_0x371841=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x2b0)]],_0x42bcbf=[_0x275414['body']['sales_quantity_QA']],_0x219794=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x23f)]],_0x399bc9=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x284)]],_0x53b590=[_0x275414['body'][_0x2b3b33(0x1f5)]],_0x2ae3e3=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x2a6)]],_0xb0f8bf=[_0x275414[_0x2b3b33(0x22c)]['batch_code_QA']],_0x5937f6=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x1f4)]],_0x3112fd=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x287)]],_0x6142dd=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x2cc)]],_0x581af1=[_0x275414['body'][_0x2b3b33(0x214)]];else var _0x2f41cd=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x289)]],_0x2da001=[..._0x275414['body'][_0x2b3b33(0x224)]],_0x100e05=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x1f9)]],_0x371841=[..._0x275414['body'][_0x2b3b33(0x2b0)]],_0x42bcbf=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x2be)]],_0x219794=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x23f)]],_0x399bc9=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x284)]],_0x53b590=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x1f5)]],_0x2ae3e3=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x2a6)]],_0xb0f8bf=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x2d4)]],_0x5937f6=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x1f4)]],_0x3112fd=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x287)]],_0x6142dd=[..._0x275414['body']['production_date_QA']],_0x581af1=[..._0x275414['body'][_0x2b3b33(0x214)]];const _0x274a36=_0x2f41cd[_0x2b3b33(0x260)](_0xc71530=>{return _0xc71530={'product_name':_0xc71530};});_0x2da001['forEach']((_0x140950,_0x1366c8)=>{var _0x4f74ab=_0x2b3b33;_0x274a36[_0x1366c8][_0x4f74ab(0x1e2)]=_0x140950;}),_0x100e05[_0x2b3b33(0x29c)]((_0x7f039c,_0xff117c)=>{var _0x121f43=_0x2b3b33;_0x274a36[_0xff117c][_0x121f43(0x29d)]=_0x7f039c;}),_0x371841[_0x2b3b33(0x29c)]((_0x2b7a80,_0x1b8dd7)=>{var _0x4152ca=_0x2b3b33;_0x274a36[_0x1b8dd7][_0x4152ca(0x240)]=_0x2b7a80;}),_0x42bcbf['forEach']((_0x4d2d59,_0x392fd3)=>{var _0x2c55be=_0x2b3b33;_0x274a36[_0x392fd3][_0x2c55be(0x2b1)]=_0x4d2d59;}),_0x219794[_0x2b3b33(0x29c)]((_0x5942c3,_0x4414e5)=>{var _0x5e8b6b=_0x2b3b33;_0x274a36[_0x4414e5][_0x5e8b6b(0x2c1)]=_0x5942c3;}),_0x399bc9[_0x2b3b33(0x29c)]((_0x50a066,_0x33e4b0)=>{var _0x4b074c=_0x2b3b33;_0x274a36[_0x33e4b0][_0x4b074c(0x2e4)]=_0x50a066;}),_0x53b590[_0x2b3b33(0x29c)]((_0x1f7f1e,_0x7e488a)=>{var _0x5cde23=_0x2b3b33;_0x274a36[_0x7e488a][_0x5cde23(0x2f8)]=_0x1f7f1e;}),_0x2ae3e3[_0x2b3b33(0x29c)]((_0x5a0eba,_0x583d44)=>{var _0x5ac48b=_0x2b3b33;_0x274a36[_0x583d44][_0x5ac48b(0x1eb)]=_0x5a0eba;}),_0xb0f8bf[_0x2b3b33(0x29c)]((_0x5549e7,_0x302783)=>{var _0x4ad483=_0x2b3b33;_0x274a36[_0x302783][_0x4ad483(0x1e8)]=_0x5549e7;}),_0x5937f6['forEach']((_0x125ab3,_0x5f1db4)=>{var _0x5e1183=_0x2b3b33;_0x274a36[_0x5f1db4][_0x5e1183(0x1fd)]=_0x125ab3;}),_0x3112fd[_0x2b3b33(0x29c)]((_0x4df242,_0x506cfa)=>{_0x274a36[_0x506cfa]['unit']=_0x4df242;}),_0x6142dd['forEach']((_0x3570e3,_0x34a164)=>{_0x274a36[_0x34a164]['production_date']=_0x3570e3;}),_0x581af1['forEach']((_0x5263c5,_0x37b0c4)=>{var _0x11a7e4=_0x2b3b33;_0x274a36[_0x37b0c4][_0x11a7e4(0x299)]=_0x5263c5;});const _0x2709cb=await sales_finished[_0x2b3b33(0x28f)]({'invoice':_0x438381});_0x2709cb['return_data']=_0x2b3b33(0x24f);const _0x27ea2b=await _0x2709cb[_0x2b3b33(0x258)](),_0x4d2c04=new sales_return_finished({'invoice':_0x438381,'customer':_0x275414['body'][_0x2b3b33(0x209)],'date':_0x103ec6,'warehouse_name':_0x5a3dbc,'room':_0x195824,'ToWarehouse':_0x37d946,'ToRoom':_0x1e9cd6,'return_sale_QA':_0x274a36,'note':_0x1ab5a0,'warehouse_cat':_0x478949}),_0x975878=await _0x4d2c04['save'](),_0x44581e=await sales_return_finished['findOne']({'invoice':_0x438381}),_0x1cc97a=await warehouse[_0x2b3b33(0x28f)]({'name':_0x37d946,'room':_0x1e9cd6});_0x44581e[_0x2b3b33(0x2c2)][_0x2b3b33(0x29c)](_0x7d9450=>{var _0x145358=_0x2b3b33,_0x918c6e=0x0;const _0x3cbe37=_0x1cc97a[_0x145358(0x1e7)]['map'](_0x1b2d8a=>{var _0x5d699c=_0x145358;_0x1b2d8a[_0x5d699c(0x276)]==_0x7d9450['product_name']&&_0x1b2d8a[_0x5d699c(0x299)]==_0x7d9450[_0x5d699c(0x299)]&&_0x1b2d8a[_0x5d699c(0x2b9)]==_0x7d9450[_0x5d699c(0x2b9)]&&_0x1b2d8a[_0x5d699c(0x1e8)]==_0x7d9450[_0x5d699c(0x1e8)]&&(_0x1b2d8a[_0x5d699c(0x253)]=parseInt(_0x1b2d8a['product_stock'])+parseInt(_0x7d9450['return_qty']),_0x918c6e++);});_0x918c6e=='0'&&(_0x1cc97a[_0x145358(0x1e7)]=_0x1cc97a[_0x145358(0x1e7)][_0x145358(0x21a)]({'product_name':_0x7d9450[_0x145358(0x276)],'product_stock':_0x7d9450[_0x145358(0x2e4)],'primary_code':_0x7d9450[_0x145358(0x1e2)],'secondary_code':_0x7d9450['secondary_code'],'product_code':_0x7d9450[_0x145358(0x240)],'batch_code':_0x7d9450[_0x145358(0x1e8)],'maxPerUnit':_0x7d9450[_0x145358(0x2f8)],'production_date':_0x7d9450[_0x145358(0x2b9)],'expiry_date':_0x7d9450[_0x145358(0x299)],'secondary_unit':_0x7d9450[_0x145358(0x1fd)],'unit':_0x7d9450[_0x145358(0x215)],'maxProducts':_0x7d9450[_0x145358(0x1eb)],'bay':_0x7d9450[_0x145358(0x2c4)]}));}),await _0x1cc97a[_0x2b3b33(0x258)]();const _0x74a0a4=new c_payment_data({'invoice':_0x438381,'customer':_0x275414[_0x2b3b33(0x22c)]['customer'],'reason':_0x2b3b33(0x1ea)});await _0x74a0a4[_0x2b3b33(0x258)]();const _0x8a702e=await master_shop['find'](),_0x536a4e=await email_settings[_0x2b3b33(0x28f)](),_0x528ea5=await customer[_0x2b3b33(0x28f)]({'name':_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x209)]});_0x8a702e[0x0][_0x2b3b33(0x2aa)]==0x1?(right_currency=_0x8a702e[0x0][_0x2b3b33(0x1dc)],left_currency=''):(right_currency='',left_currency=_0x8a702e[0x0][_0x2b3b33(0x1dc)]);var _0x1d7715=_0x2f41cd,_0x4dfce4=_0x399bc9,_0x46a7de='',_0x669c31;for(_0x669c31 in _0x1d7715){_0x46a7de+='<tr>'+_0x2b3b33(0x28e)+_0x1d7715[_0x669c31]+_0x2b3b33(0x1de)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4dfce4[_0x669c31]+_0x2b3b33(0x1de)+_0x2b3b33(0x2e8);}console[_0x2b3b33(0x281)]('product_list',_0x46a7de);let _0x1a6560=nodemailer[_0x2b3b33(0x2df)]({'service':'gmail','auth':{'user':_0x536a4e['email'],'pass':_0x536a4e[_0x2b3b33(0x2ce)]}}),_0x1812c7={'from':_0x536a4e[_0x2b3b33(0x22d)],'to':_0x528ea5[_0x2b3b33(0x22d)],'subject':_0x2b3b33(0x26f),'attachments':[{'filename':_0x2b3b33(0x288),'path':__dirname+'/../public'+'/upload/'+_0x8a702e[0x0][_0x2b3b33(0x2c3)],'cid':_0x2b3b33(0x2a4)}],'html':_0x2b3b33(0x2cb)+_0x2b3b33(0x220)+'</head><body>'+_0x2b3b33(0x231)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2b3b33(0x231)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2b3b33(0x2e6)+_0x2b3b33(0x231)+_0x2b3b33(0x27b)+_0x8a702e[0x0][_0x2b3b33(0x249)]+_0x2b3b33(0x272)+_0x2b3b33(0x2e6)+_0x2b3b33(0x2e6)+_0x2b3b33(0x229)+'<div>'+_0x2b3b33(0x2f0)+_0x2b3b33(0x236)+_0x438381+'\x20'+_0x2b3b33(0x2e7)+_0x2b3b33(0x1f7)+_0x103ec6+'\x20'+_0x2b3b33(0x1ff)+_0x2b3b33(0x2b7)+_0x2b3b33(0x2e6)+_0x2b3b33(0x254)+_0x2b3b33(0x261)+'<tr>'+_0x2b3b33(0x2b2)+_0x2b3b33(0x2ea)+_0x2b3b33(0x26d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x2b3b33(0x2e8)+'</thead>'+_0x2b3b33(0x222)+'\x20'+_0x46a7de+'\x20'+_0x2b3b33(0x2f2)+_0x2b3b33(0x24e)+_0x2b3b33(0x231)+_0x2b3b33(0x22b)+_0x2b3b33(0x2cd)+_0x8a702e[0x0][_0x2b3b33(0x249)]+_0x2b3b33(0x2b7)+_0x2b3b33(0x2e6)+_0x2b3b33(0x2e6)+_0x2b3b33(0x233)};_0x1a6560[_0x2b3b33(0x25e)](_0x1812c7,function(_0x17c625,_0x572f04){var _0x892400=_0x2b3b33;_0x17c625?(console[_0x892400(0x281)](_0x17c625),console[_0x892400(0x281)](_0x892400(0x2af))):console[_0x892400(0x281)](_0x892400(0x2b3));}),_0x275414[_0x2b3b33(0x29f)](_0x2b3b33(0x1f0),_0x2b3b33(0x295)),_0x1e2300[_0x2b3b33(0x2e9)]('/all_sales_finished/view');}catch(_0x4b0481){_0x1e2300[_0x2b3b33(0x290)](0xc8)[_0x2b3b33(0x2b4)]({'message1':_0x4b0481[_0x2b3b33(0x256)]});}else{if(_0x275414['body']['for_categorize']=='GS')try{const {invoice:_0x2a5ff0,date:_0x5d512d,warehouse_name:_0x5d4ec9,product_name:_0x8c4026,primary_code:_0x395c7b,secondary_code:_0x21567a,product_code:_0x17d106,sales_quantity:_0x4aebb3,stocks:_0x8b47dd,return_qty:_0x7fb4f4,Room_name:_0x3018ab,to_warehouse_name:_0x32c7c8,to_Room_name:_0x50e400,note:_0x1de0ec,level:_0x49088c,isle:_0x4de0cb,pallet:_0x50f6eb,for_categorize:_0x1891a5}=_0x275414[_0x2b3b33(0x22c)];if(typeof _0x8c4026==_0x2b3b33(0x27f))var _0x2f41cd=[_0x275414[_0x2b3b33(0x22c)]['product_name']],_0x2da001=[_0x275414[_0x2b3b33(0x22c)]['primary_code']],_0x100e05=[_0x275414[_0x2b3b33(0x22c)]['secondary_code']],_0x371841=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x240)]],_0x42bcbf=[_0x275414['body'][_0x2b3b33(0x273)]],_0x399bc9=[_0x275414['body'][_0x2b3b33(0x2e4)]],_0x335a11=[_0x275414['body'][_0x2b3b33(0x2c4)]],_0x53b590=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x2f8)]],_0x2ae3e3=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x1eb)]],_0xb0f8bf=[_0x275414[_0x2b3b33(0x22c)]['batch_code']],_0x5937f6=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x1fd)]],_0x3112fd=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x215)]],_0x6142dd=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x2b9)]],_0x581af1=[_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x299)]];else var _0x2f41cd=[..._0x275414[_0x2b3b33(0x22c)]['product_name']],_0x2da001=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x1e2)]],_0x100e05=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x29d)]],_0x371841=[..._0x275414[_0x2b3b33(0x22c)]['product_code']],_0x42bcbf=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x273)]],_0x399bc9=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x2e4)]],_0x335a11=[..._0x275414['body']['bay']],_0x53b590=[..._0x275414['body'][_0x2b3b33(0x2f8)]],_0x2ae3e3=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x1eb)]],_0xb0f8bf=[..._0x275414['body'][_0x2b3b33(0x1e8)]],_0x5937f6=[..._0x275414['body']['secondary_unit']],_0x3112fd=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x215)]],_0x6142dd=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x2b9)]],_0x581af1=[..._0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x299)]];const _0x21c958=_0x2f41cd[_0x2b3b33(0x260)](_0x2f2704=>{return _0x2f2704={'product_name':_0x2f2704};});_0x2da001['forEach']((_0x3f11e5,_0x511848)=>{var _0xa9397a=_0x2b3b33;_0x21c958[_0x511848][_0xa9397a(0x1e2)]=_0x3f11e5;}),_0x100e05['forEach']((_0x1866aa,_0x3ee502)=>{var _0x2e827e=_0x2b3b33;_0x21c958[_0x3ee502][_0x2e827e(0x29d)]=_0x1866aa;}),_0x371841['forEach']((_0x59663a,_0x314e8b)=>{var _0xa87d6b=_0x2b3b33;_0x21c958[_0x314e8b][_0xa87d6b(0x240)]=_0x59663a;}),_0x42bcbf[_0x2b3b33(0x29c)]((_0x361ac8,_0x1e6a9c)=>{var _0x596ee3=_0x2b3b33;_0x21c958[_0x1e6a9c][_0x596ee3(0x2b1)]=_0x361ac8;}),_0x399bc9[_0x2b3b33(0x29c)]((_0x20824f,_0x353512)=>{_0x21c958[_0x353512]['return_qty']=_0x20824f;}),_0x335a11[_0x2b3b33(0x29c)]((_0x86da9e,_0x5dbb95)=>{var _0x1b8d47=_0x2b3b33;_0x21c958[_0x5dbb95][_0x1b8d47(0x2c4)]=_0x86da9e;}),_0x53b590[_0x2b3b33(0x29c)]((_0xda9bc0,_0xfdaebe)=>{var _0x4d9d7d=_0x2b3b33;_0x21c958[_0xfdaebe][_0x4d9d7d(0x2f8)]=_0xda9bc0;}),_0x2ae3e3[_0x2b3b33(0x29c)]((_0x18c113,_0x3e6f7f)=>{_0x21c958[_0x3e6f7f]['maxProducts']=_0x18c113;}),_0xb0f8bf[_0x2b3b33(0x29c)]((_0x22c151,_0x54a367)=>{var _0x6e9891=_0x2b3b33;_0x21c958[_0x54a367][_0x6e9891(0x1e8)]=_0x22c151;}),_0x5937f6[_0x2b3b33(0x29c)]((_0x59f0bf,_0x250582)=>{var _0xdc0b55=_0x2b3b33;_0x21c958[_0x250582][_0xdc0b55(0x1fd)]=_0x59f0bf;}),_0x3112fd[_0x2b3b33(0x29c)]((_0x3e1578,_0x151a49)=>{var _0x42b3b8=_0x2b3b33;_0x21c958[_0x151a49][_0x42b3b8(0x215)]=_0x3e1578;}),_0x6142dd[_0x2b3b33(0x29c)]((_0x3cf35e,_0x42556f)=>{var _0x29168f=_0x2b3b33;_0x21c958[_0x42556f][_0x29168f(0x2b9)]=_0x3cf35e;}),_0x581af1['forEach']((_0x3eeb0a,_0x1fa121)=>{var _0x4aaff5=_0x2b3b33;_0x21c958[_0x1fa121][_0x4aaff5(0x299)]=_0x3eeb0a;});var _0x1053a3=0x0;_0x21c958[_0x2b3b33(0x29c)](_0x1852cb=>{var _0x193e15=_0x2b3b33;(parseInt(_0x1852cb[_0x193e15(0x2b1)])<parseInt(_0x1852cb[_0x193e15(0x2e4)])||parseInt(_0x1852cb[_0x193e15(0x2c1)])<parseInt(_0x1852cb[_0x193e15(0x2e4)])&&parseInt(_0x1852cb[_0x193e15(0x2b1)])>parseInt(_0x1852cb[_0x193e15(0x2e4)])||parseInt(_0x1852cb['return_qty'])==0x0)&&_0x1053a3++;});if(_0x1053a3!=0x0)return _0x275414[_0x2b3b33(0x29f)](_0x2b3b33(0x29a),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x1e2300[_0x2b3b33(0x2e9)](_0x2b3b33(0x23d));const _0x45745c=await sales_finished[_0x2b3b33(0x28f)]({'invoice':_0x2a5ff0});_0x45745c[_0x2b3b33(0x2de)]='True';const _0x192f69=await _0x45745c['save'](),_0x5a83af=new sales_return_finished({'invoice':_0x2a5ff0,'customer':_0x275414['body']['customer'],'date':_0x5d512d,'warehouse_name':_0x5d4ec9,'room':_0x3018ab,'ToWarehouse':_0x32c7c8,'ToRoom':_0x50e400,'return_sale':_0x21c958,'note':_0x1de0ec,'warehouse_cat':_0x1891a5}),_0x3cc3c7=await _0x5a83af[_0x2b3b33(0x258)](),_0x2e2e79=await sales_return_finished[_0x2b3b33(0x28f)]({'invoice':_0x2a5ff0}),_0x5a1214=await warehouse[_0x2b3b33(0x28f)]({'name':_0x32c7c8,'room':_0x50e400,'warehouse_category':_0x2b3b33(0x275)});_0x2e2e79[_0x2b3b33(0x2b8)][_0x2b3b33(0x29c)](_0x113c4d=>{var _0x469360=_0x2b3b33,_0xd89b50=0x0;const _0x51a57d=_0x5a1214[_0x469360(0x1e7)][_0x469360(0x260)](_0x4617d8=>{var _0xf2f855=_0x469360;_0x4617d8[_0xf2f855(0x276)]==_0x113c4d[_0xf2f855(0x276)]&&_0x4617d8['bay']==_0x113c4d['bay']&&_0x4617d8[_0xf2f855(0x299)]==_0x113c4d['expiry_date']&&_0x4617d8['production_date']==_0x113c4d[_0xf2f855(0x2b9)]&&_0x4617d8[_0xf2f855(0x1e8)]==_0x113c4d[_0xf2f855(0x1e8)]&&(_0x4617d8[_0xf2f855(0x253)]=parseInt(_0x4617d8[_0xf2f855(0x253)])+parseInt(_0x113c4d[_0xf2f855(0x2e4)]),_0xd89b50++);});_0xd89b50=='0'&&(_0x5a1214['product_details']=_0x5a1214['product_details'][_0x469360(0x21a)]({'product_name':_0x113c4d['product_name'],'product_stock':_0x113c4d[_0x469360(0x2e4)],'primary_code':_0x113c4d[_0x469360(0x1e2)],'secondary_code':_0x113c4d[_0x469360(0x29d)],'product_code':_0x113c4d[_0x469360(0x240)],'bay':_0x113c4d['bay'],'batch_code':_0x113c4d['batch_code'],'maxPerUnit':_0x113c4d['maxPerUnit'],'production_date':_0x113c4d['production_date'],'expiry_date':_0x113c4d[_0x469360(0x299)],'secondary_unit':_0x113c4d[_0x469360(0x1fd)],'unit':_0x113c4d[_0x469360(0x215)],'maxProducts':_0x113c4d[_0x469360(0x1eb)]}));}),await _0x5a1214[_0x2b3b33(0x258)](),console[_0x2b3b33(0x281)](_0x275414[_0x2b3b33(0x22c)]);const _0x237187=new c_payment_data({'invoice':_0x2a5ff0,'customer':_0x275414[_0x2b3b33(0x22c)]['customer'],'reason':_0x2b3b33(0x1ea)});await _0x237187['save']();const _0x4074c4=await master_shop[_0x2b3b33(0x20d)]();console['log'](_0x2b3b33(0x2e5),_0x4074c4[0x0][_0x2b3b33(0x2c3)]);const _0x586810=await email_settings['findOne'](),_0x361ca0=await customer[_0x2b3b33(0x28f)]({'name':_0x275414[_0x2b3b33(0x22c)][_0x2b3b33(0x209)]});console[_0x2b3b33(0x281)](_0x2b3b33(0x2e2),_0x361ca0);_0x4074c4[0x0][_0x2b3b33(0x2aa)]==0x1?(right_currency=_0x4074c4[0x0][_0x2b3b33(0x1dc)],left_currency=''):(right_currency='',left_currency=_0x4074c4[0x0][_0x2b3b33(0x1dc)]);var _0x1d7715=_0x2f41cd,_0x4dfce4=_0x399bc9,_0x46a7de='',_0x669c31;for(_0x669c31 in _0x1d7715){_0x46a7de+=_0x2b3b33(0x21d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1d7715[_0x669c31]+_0x2b3b33(0x1de)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4dfce4[_0x669c31]+_0x2b3b33(0x1de)+_0x2b3b33(0x2e8);}console['log'](_0x2b3b33(0x2b6),_0x46a7de);let _0x2fa0b5=nodemailer[_0x2b3b33(0x2df)]({'service':_0x2b3b33(0x22a),'auth':{'user':_0x586810['email'],'pass':_0x586810[_0x2b3b33(0x2ce)]}}),_0x12dde4={'from':_0x586810[_0x2b3b33(0x22d)],'to':_0x361ca0[_0x2b3b33(0x22d)],'subject':_0x2b3b33(0x26f),'attachments':[{'filename':_0x2b3b33(0x288),'path':__dirname+'/../public'+_0x2b3b33(0x252)+_0x4074c4[0x0][_0x2b3b33(0x2c3)],'cid':_0x2b3b33(0x2a4)}],'html':_0x2b3b33(0x2cb)+_0x2b3b33(0x220)+_0x2b3b33(0x2db)+_0x2b3b33(0x231)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2b3b33(0x231)+_0x2b3b33(0x2e3)+_0x2b3b33(0x2e6)+_0x2b3b33(0x231)+_0x2b3b33(0x27b)+_0x4074c4[0x0][_0x2b3b33(0x249)]+_0x2b3b33(0x272)+_0x2b3b33(0x2e6)+_0x2b3b33(0x2e6)+'<hr\x20class=\x22my-3\x22>'+_0x2b3b33(0x231)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2b3b33(0x236)+_0x2a5ff0+'\x20'+_0x2b3b33(0x2e7)+_0x2b3b33(0x1f7)+_0x5d512d+'\x20'+_0x2b3b33(0x1ff)+_0x2b3b33(0x2b7)+_0x2b3b33(0x2e6)+_0x2b3b33(0x254)+_0x2b3b33(0x261)+_0x2b3b33(0x21d)+_0x2b3b33(0x2b2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x2b3b33(0x26d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x2b3b33(0x2e8)+_0x2b3b33(0x2dc)+_0x2b3b33(0x222)+'\x20'+_0x46a7de+'\x20'+_0x2b3b33(0x2f2)+'</table>'+_0x2b3b33(0x231)+_0x2b3b33(0x22b)+_0x2b3b33(0x2cd)+_0x4074c4[0x0]['site_title']+_0x2b3b33(0x2b7)+_0x2b3b33(0x2e6)+_0x2b3b33(0x2e6)+'</body></html>'};_0x2fa0b5[_0x2b3b33(0x25e)](_0x12dde4,function(_0x28f002,_0x1b3c22){var _0x44923a=_0x2b3b33;_0x28f002?(console[_0x44923a(0x281)](_0x28f002),console[_0x44923a(0x281)](_0x44923a(0x2af))):console[_0x44923a(0x281)](_0x44923a(0x2b3));}),_0x275414['flash'](_0x2b3b33(0x1f0),_0x2b3b33(0x295)),_0x1e2300[_0x2b3b33(0x2e9)](_0x2b3b33(0x1f8));}catch(_0x1707cf){console[_0x2b3b33(0x281)](_0x1707cf),_0x1e2300['status'](0xc8)[_0x2b3b33(0x2b4)]({'message1':_0x1707cf[_0x2b3b33(0x256)]});}}}),router['get']('/barcode/:id',auth,async(_0x5d1f6b,_0x1c4d6f)=>{var _0x2f9d4c=a0_0x10e5da;try{const {username:_0x52a02b,email:_0x41fa1d,role:_0x463cdd}=_0x5d1f6b[_0x2f9d4c(0x27a)],_0xae7c5a=_0x5d1f6b[_0x2f9d4c(0x27a)],_0xc63d9a=await profile[_0x2f9d4c(0x28f)]({'email':_0xae7c5a[_0x2f9d4c(0x22d)]}),_0xabd374=await master_shop[_0x2f9d4c(0x20d)]();console[_0x2f9d4c(0x281)](_0x2f9d4c(0x1f1),_0xabd374);const _0x35307d=_0x5d1f6b[_0x2f9d4c(0x202)]['id'],_0x4d3f5a=await sales[_0x2f9d4c(0x259)](_0x35307d);console[_0x2f9d4c(0x281)](_0x2f9d4c(0x2a2),_0x4d3f5a);if(_0xabd374[0x0][_0x2f9d4c(0x2dd)]=='English\x20(US)')var _0x32f4ca=users[_0x2f9d4c(0x2c8)];else{if(_0xabd374[0x0][_0x2f9d4c(0x2dd)]==_0x2f9d4c(0x241))var _0x32f4ca=users[_0x2f9d4c(0x241)];else{if(_0xabd374[0x0][_0x2f9d4c(0x2dd)]==_0x2f9d4c(0x20a))var _0x32f4ca=users[_0x2f9d4c(0x20a)];else{if(_0xabd374[0x0][_0x2f9d4c(0x2dd)]==_0x2f9d4c(0x20f))var _0x32f4ca=users[_0x2f9d4c(0x20f)];else{if(_0xabd374[0x0][_0x2f9d4c(0x2dd)]==_0x2f9d4c(0x1df))var _0x32f4ca=users[_0x2f9d4c(0x1df)];else{if(_0xabd374[0x0][_0x2f9d4c(0x2dd)]=='Portuguese\x20(BR)')var _0x32f4ca=users[_0x2f9d4c(0x2b5)];else{if(_0xabd374[0x0]['language']==_0x2f9d4c(0x2ab))var _0x32f4ca=users[_0x2f9d4c(0x2ab)];else{if(_0xabd374[0x0][_0x2f9d4c(0x2dd)]==_0x2f9d4c(0x263))var _0x32f4ca=users[_0x2f9d4c(0x2f3)];}}}}}}}_0x1c4d6f['render'](_0x2f9d4c(0x270),{'success':_0x5d1f6b[_0x2f9d4c(0x29f)](_0x2f9d4c(0x1f0)),'errors':_0x5d1f6b[_0x2f9d4c(0x29f)](_0x2f9d4c(0x29a)),'role':_0xae7c5a,'profile':_0xc63d9a,'alldata':_0x4d3f5a,'master_shop':_0xabd374,'language':_0x32f4ca});}catch(_0x11766a){console[_0x2f9d4c(0x281)](_0x11766a);}}),router[a0_0x10e5da(0x285)]('/barcode_scanner',async(_0xf5e7fa,_0x3e821c)=>{var _0xaab50e=a0_0x10e5da;const {product_code:_0x3214ca,warehouse_name:_0x118a84,rooms_data:_0x1b9e19,Roomslist:_0x2f5c2e}=_0xf5e7fa[_0xaab50e(0x22c)],_0x49d8ed=_0x2f5c2e[_0xaab50e(0x2c7)](','),_0x57a7ad=[];async function _0x285cc1(_0x2daec8){var _0x4e516b=_0xaab50e;const _0x54213d=await warehouse['aggregate']([{'$match':{'name':_0x118a84,'room':_0x2daec8}},{'$unwind':_0x4e516b(0x217)},{'$match':{'product_details.primary_code':_0x3214ca}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4e516b(0x2bf)},'product_stock':{'$first':_0x4e516b(0x2d8)},'primary_code':{'$first':_0x4e516b(0x269)},'secondary_code':{'$first':_0x4e516b(0x247)},'product_code':{'$first':_0x4e516b(0x297)},'level':{'$first':_0x4e516b(0x2bd)},'isle':{'$first':_0x4e516b(0x248)},'type':{'$first':_0x4e516b(0x1f6)},'pallet':{'$first':_0x4e516b(0x296)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x4e516b(0x1fc)},'storage':{'$first':_0x4e516b(0x271)},'rack':{'$first':_0x4e516b(0x20e)},'expiry_date':{'$first':_0x4e516b(0x286)},'production_date':{'$first':_0x4e516b(0x250)},'maxPerUnit':{'$first':_0x4e516b(0x207)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4e516b(0x294)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x268407=await warehouse[_0x4e516b(0x244)]([{'$match':{'name':_0x118a84,'room':_0x2daec8}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3214ca}},{'$group':{'_id':_0x4e516b(0x1e0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4e516b(0x2d8)},'primary_code':{'$first':_0x4e516b(0x269)},'secondary_code':{'$first':_0x4e516b(0x247)},'product_code':{'$first':_0x4e516b(0x297)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x4e516b(0x248)},'type':{'$first':_0x4e516b(0x1f6)},'pallet':{'$first':_0x4e516b(0x296)},'unit':{'$first':_0x4e516b(0x27e)},'secondary_unit':{'$first':_0x4e516b(0x1fc)},'storage':{'$first':_0x4e516b(0x271)},'rack':{'$first':_0x4e516b(0x20e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x4e516b(0x250)},'maxPerUnit':{'$first':_0x4e516b(0x207)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x4e516b(0x294)},'invoice':{'$first':_0x4e516b(0x1f3)}}}]);if(_0x54213d[_0x4e516b(0x23b)]>0x0)_0x57a7ad[_0x4e516b(0x26b)](_0x54213d);else _0x268407[_0x4e516b(0x23b)]>0x0&&_0x57a7ad[_0x4e516b(0x26b)](_0x268407);}const _0x5c4972=_0x49d8ed[_0xaab50e(0x260)](_0x132206=>_0x285cc1(_0x132206));await Promise['all'](_0x5c4972),_0x3e821c['json'](_0x57a7ad);}),module[a0_0x10e5da(0x266)]=router;