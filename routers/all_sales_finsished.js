var a0_0x2ef59f=a0_0x323c;function a0_0x323c(_0x2e817d,_0x3c6bbf){var _0x4c5bd9=a0_0x4c5b();return a0_0x323c=function(_0x323cd5,_0x423445){_0x323cd5=_0x323cd5-0x1c2;var _0x2b8e29=_0x4c5bd9[_0x323cd5];return _0x2b8e29;},a0_0x323c(_0x2e817d,_0x3c6bbf);}(function(_0x3adbe2,_0x3fb194){var _0x4864fd=a0_0x323c,_0x3956f9=_0x3adbe2();while(!![]){try{var _0x11a8dd=-parseInt(_0x4864fd(0x21e))/0x1*(-parseInt(_0x4864fd(0x1d1))/0x2)+parseInt(_0x4864fd(0x2d7))/0x3*(-parseInt(_0x4864fd(0x261))/0x4)+-parseInt(_0x4864fd(0x2a4))/0x5*(parseInt(_0x4864fd(0x28c))/0x6)+-parseInt(_0x4864fd(0x1d9))/0x7+-parseInt(_0x4864fd(0x27e))/0x8+parseInt(_0x4864fd(0x205))/0x9+parseInt(_0x4864fd(0x281))/0xa*(parseInt(_0x4864fd(0x282))/0xb);if(_0x11a8dd===_0x3fb194)break;else _0x3956f9['push'](_0x3956f9['shift']());}catch(_0x514fa3){_0x3956f9['push'](_0x3956f9['shift']());}}}(a0_0x4c5b,0x7beba));const express=require(a0_0x2ef59f(0x298)),app=express(),router=express[a0_0x2ef59f(0x28e)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x2ef59f(0x294)),auth=require(a0_0x2ef59f(0x2ad)),nodemailer=require(a0_0x2ef59f(0x266)),users=require(a0_0x2ef59f(0x224));router[a0_0x2ef59f(0x24e)](a0_0x2ef59f(0x25c),auth,async(_0x2dc83f,_0x746dc4)=>{var _0x535c67=a0_0x2ef59f;try{const {username:_0x1cf72d,email:_0x332447,role:_0x386263}=_0x2dc83f[_0x535c67(0x256)],_0x4ebba7=_0x2dc83f['user'],_0x2eb103=await profile[_0x535c67(0x263)]({'email':_0x4ebba7[_0x535c67(0x2d6)]}),_0x4cdbb3=await master_shop[_0x535c67(0x279)]();let _0x501357;if(_0x4ebba7[_0x535c67(0x2c1)]=='staff'){const _0xfec86d=await staff[_0x535c67(0x263)]({'email':_0x4ebba7[_0x535c67(0x2d6)]});_0x501357=await sales_finished[_0x535c67(0x1e0)]([{'$lookup':{'from':'customers','localField':_0x535c67(0x1ea),'foreignField':_0x535c67(0x1e2),'as':'customers_docs'}},{'$unwind':_0x535c67(0x28d)},{'$unwind':_0x535c67(0x1d2)},{'$group':{'_id':_0x535c67(0x207),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x535c67(0x1f5)},'date':{'$first':_0x535c67(0x223)},'warehouse_name':{'$first':_0x535c67(0x2b8)},'sale_product':{'$push':_0x535c67(0x1d2)},'note':{'$first':'$note'},'return_data':{'$first':_0x535c67(0x1ff)},'customers_docs':{'$first':_0x535c67(0x28d)},'total_saleproduct_quantity':{'$sum':_0x535c67(0x296)},'level':{'$addToSet':_0x535c67(0x257)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x535c67(0x272)},'pallet':{'$addToSet':_0x535c67(0x22d)},'finalize':{'$first':_0x535c67(0x24f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x501357=await sales_finished['aggregate']([{'$lookup':{'from':_0x535c67(0x1e8),'localField':_0x535c67(0x1ea),'foreignField':_0x535c67(0x1e2),'as':'customers_docs'}},{'$unwind':_0x535c67(0x28d)},{'$unwind':_0x535c67(0x1d2)},{'$group':{'_id':'$_id','invoice':{'$first':_0x535c67(0x24b)},'customers':{'$first':_0x535c67(0x1f5)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x535c67(0x1ff)},'customers_docs':{'$first':_0x535c67(0x28d)},'total_saleproduct_quantity':{'$sum':_0x535c67(0x296)},'level':{'$addToSet':_0x535c67(0x257)},'isle':{'$addToSet':_0x535c67(0x229)},'type':{'$addToSet':_0x535c67(0x272)},'pallet':{'$addToSet':_0x535c67(0x22d)},'finalize':{'$first':_0x535c67(0x24f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x4cdbb3[0x0][_0x535c67(0x1f8)]=='English\x20(US)'){var _0x11e596=users[_0x535c67(0x252)];console[_0x535c67(0x25a)](_0x11e596);}else{if(_0x4cdbb3[0x0][_0x535c67(0x1f8)]==_0x535c67(0x234))var _0x11e596=users[_0x535c67(0x234)];else{if(_0x4cdbb3[0x0][_0x535c67(0x1f8)]=='German')var _0x11e596=users['German'];else{if(_0x4cdbb3[0x0][_0x535c67(0x1f8)]==_0x535c67(0x1ec))var _0x11e596=users[_0x535c67(0x1ec)];else{if(_0x4cdbb3[0x0][_0x535c67(0x1f8)]==_0x535c67(0x2c6))var _0x11e596=users[_0x535c67(0x2c6)];else{if(_0x4cdbb3[0x0][_0x535c67(0x1f8)]==_0x535c67(0x273))var _0x11e596=users[_0x535c67(0x25b)];else{if(_0x4cdbb3[0x0][_0x535c67(0x1f8)]=='Chinese')var _0x11e596=users[_0x535c67(0x2ac)];else{if(_0x4cdbb3[0x0][_0x535c67(0x1f8)]=='Arabic\x20(ae)')var _0x11e596=users[_0x535c67(0x2ca)];}}}}}}}_0x746dc4[_0x535c67(0x258)](_0x535c67(0x25d),{'success':_0x2dc83f['flash']('success'),'errors':_0x2dc83f['flash'](_0x535c67(0x20a)),'sales':_0x501357,'profile':_0x2eb103,'role':_0x4ebba7,'master_shop':_0x4cdbb3,'language':_0x11e596});}catch(_0x1f83e2){console[_0x535c67(0x25a)](_0x1f83e2);}});async function getRandom8DigitNumber(){var _0x276181=a0_0x2ef59f;const _0xfd885b=0x989680,_0x1dae95=0x5f5e0ff,_0x2e10b6=Math[_0x276181(0x28a)](Math[_0x276181(0x247)]()*(_0x1dae95-_0xfd885b+0x1))+_0xfd885b;var _0x162d7a;const _0x582f88=await sales_finished[_0x276181(0x263)]({'invoice':_0x276181(0x2b3)+_0x2e10b6});return _0x582f88&&_0x582f88[_0x276181(0x2b4)]>0x0?_0x162d7a=_0x276181(0x2b3)+_0x2e10b6:_0x162d7a=_0x276181(0x2b3)+_0x2e10b6,_0x162d7a;}function a0_0x4c5b(){var _0x4e987c=['forEach','</thead>','due_amount','<!DOCTYPE\x20html>','return_qty_QA','bay','email','2949iZUxTn','English\x20(US)','</span>','$product_details.batch_code','Enclosed','return_sale_QA','batch_code_QA','exports','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_date','sale_qty','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','message','sales\x20item\x20return\x20successfull','currency_placement','1682yCKNBl','$sale_product','secondary_unit','$product_details.type','maxProducts','primary_code_QA','maxPerUnit_QA','/invoice/:id','2600346XarpUm','$product_details.storage','Return\x20Rooms','foreach\x20newproduct','concat','$product_details.maxPerUnit','quantity','aggregate','True','name','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','staff','/barcode/:id','<span\x20style=\x22float:\x20right;\x22>','return_qty','customers','customer_data','customer','getDate','Spanish','sales_quantity_QA','/give_payment/:id','prod_cat','all','received_amount','barcode\x20Product\x20master','<div>','</head><body>','$customer','push','$product_details.rack','language','primary_unit','map','$room','Sale','flash','</div>','$return_data','Quality\x20Inspection','maxPerUnit','</tbody>','/view/:id','/view/add_sales','77445KQzLuu','$name','$_id','product','product_details','errors','site_title','Sale\x20Return\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','status','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','sendMail','/all_sales/view','Error\x20Occurs','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','catch','</tr>','production_date','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_code','stocks_QA','213dIDWOm','toString','$product_details.unit','</h5>','slice','$date','../public/language/languages.json','production_date_QA','/upload/','Arabic\x20(ae)','</table>','$sale_product.bin','json','Ambient','/picking_list/pdf/','$sale_product.floorlevel','product_stock','$product_details.secondary_code','Received\x20Payment\x20For\x20Sale','secondary_unit_QA','<strong>\x20Regards\x20</strong>','master','Hindi','save','$product_details._id','findById','body','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product.product_name','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','room_name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','edit_sales_finished_view','$product_details.invoice','logo','gmail','secondary_code_QA','password','warehouse','string','random','/preview/:id','$product_details.product_code','</body></html>','$invoice','carton','/view/add_sale/product','get','$finalize','False','createTransport','English','stock','Return\x20Goods','final','user','$sale_product.bay','render','$product_details.product_cat','log','Portuguese','/view','all_sales_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','return_data','/all_sales_finished/preview/','1336ccPHEi','/all_sales_finished/view','findOne','error','unit','nodemailer','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Sales\x20Update\x20successfully','<h5\x20style=\x22text-align:\x20left;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','German','$product_details.product_stock','for_categorize','$product_details.secondary_unit','barcode\x20user_id','$product_details.bay','RoomAssigned','$sale_product.type','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.production_date','secondary_code','level','Sale\x20Return','find','<tbody\x20style=\x22text-align:\x20center;\x22>','return_sale','date','back','2023592wrjxiT','<tr>','post','21466570DqbBsh','11lCRDYK','</td>','<h2>\x20','params','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','\x20Order\x20Date\x20:\x20','room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','floor','payment\x20successfull','1014ZYugQM','$customers_docs','Router','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','success','$product_details.expiry_date','$product','unit_QA','../models/all_models','abs','$sale_product.quantity','stock_data','express','<h5>','primary_code','/view/add_sales/:id','prod_code','sales_quantity','expiry_date','suppliers','\x20Order\x20Number\x20:\x20','<html><head><title></title>','sale_product','product_list','25860tGWGCi','Logo.png','currency','Email\x20sent\x20successfully','$product_details.product_name','purchases_data','/../public','product_code_QA','Chinese','../middleware/auth','FGSEmail','split','adjust_qty','product_data','getFullYear','OUTF-','length','$product_details.maxProducts','DRY\x20GOODS','_id','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.bin','expiry_date_QA','maxProducts_QA','redirect','product_name','batch_code','role','product_name_QA1','\x20</h2>','Enabled','add\x20post','French','Sales\x20Add\x20successfully','$product_details','Finished\x20Goods','Arabic','invoice','edit_sales_finished','<hr\x20class=\x22my-3\x22>','QA\x20Warehouse','prod_invoice'];a0_0x4c5b=function(){return _0x4e987c;};return a0_0x4c5b();}router[a0_0x2ef59f(0x24e)](a0_0x2ef59f(0x204),auth,async(_0x458b3d,_0x5f3136)=>{var _0x100683=a0_0x2ef59f;try{const {username:_0x42d06e,email:_0x42208b,role:_0x5f2518}=_0x458b3d[_0x100683(0x256)],_0xbd5e80=_0x458b3d[_0x100683(0x256)],_0x292bf1=await profile[_0x100683(0x263)]({'email':_0xbd5e80['email']}),_0x57109f=await master_shop[_0x100683(0x279)](),_0x3af6aa=await customer['find']({});let _0x2b95a1;if(_0xbd5e80[_0x100683(0x2c1)]==_0x100683(0x1e4)){const _0xa2b004=await staff[_0x100683(0x263)]({'email':_0xbd5e80[_0x100683(0x2d6)]});_0x2b95a1=await warehouse[_0x100683(0x1e0)]([{'$match':{'status':_0x100683(0x2c4),'name':_0xa2b004[_0x100683(0x245)],'warehouse_category':_0x100683(0x2c9),'name':{'$ne':_0x100683(0x2ce)}}},{'$group':{'_id':_0x100683(0x206),'name':{'$first':_0x100683(0x206)}}},{'$sort':{'name':0x1}}]);}else _0x2b95a1=await warehouse['aggregate']([{'$match':{'status':_0x100683(0x2c4),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x100683(0x2ce)}}},{'$group':{'_id':_0x100683(0x206),'name':{'$first':_0x100683(0x206)}}},{'$sort':{'name':0x1}}]);const _0xce5353=await product[_0x100683(0x279)]({});var _0x2d4c79=['Ambient',_0x100683(0x1c5)];const _0x2223ae=await sales_finished[_0x100683(0x279)]({}),_0x5ea4c2=_0x2223ae[_0x100683(0x2b4)]+0x1,_0x5f4996=_0x100683(0x2b3)+_0x5ea4c2[_0x100683(0x21f)]()['padStart'](0x5,'0');if(_0x57109f[0x0][_0x100683(0x1f8)]=='English\x20(US)'){var _0x127a79=users[_0x100683(0x252)];console[_0x100683(0x25a)](_0x127a79);}else{if(_0x57109f[0x0][_0x100683(0x1f8)]==_0x100683(0x234))var _0x127a79=users[_0x100683(0x234)];else{if(_0x57109f[0x0][_0x100683(0x1f8)]=='German')var _0x127a79=users[_0x100683(0x26b)];else{if(_0x57109f[0x0][_0x100683(0x1f8)]==_0x100683(0x1ec))var _0x127a79=users['Spanish'];else{if(_0x57109f[0x0][_0x100683(0x1f8)]==_0x100683(0x2c6))var _0x127a79=users[_0x100683(0x2c6)];else{if(_0x57109f[0x0][_0x100683(0x1f8)]==_0x100683(0x273))var _0x127a79=users['Portuguese'];else{if(_0x57109f[0x0][_0x100683(0x1f8)]==_0x100683(0x2ac))var _0x127a79=users[_0x100683(0x2ac)];else{if(_0x57109f[0x0]['language']==_0x100683(0x227))var _0x127a79=users[_0x100683(0x2ca)];}}}}}}}const _0x3a6232=getRandom8DigitNumber();_0x3a6232['then'](_0x43bec7=>{var _0x3557db=_0x100683;_0x5f3136[_0x3557db(0x258)]('add_sales_finished',{'success':_0x458b3d[_0x3557db(0x1fd)](_0x3557db(0x290)),'errors':_0x458b3d[_0x3557db(0x1fd)](_0x3557db(0x20a)),'role':_0xbd5e80,'profile':_0x292bf1,'customer':_0x3af6aa,'warehouse':_0x2b95a1,'product':_0xce5353,'invoice':_0x43bec7,'master_shop':_0x57109f,'language':_0x127a79,'rooms_data':_0x2d4c79});})[_0x100683(0x217)](_0x3a84fb=>{var _0x12c3e5=_0x100683;_0x458b3d['flash'](_0x12c3e5(0x20a),_0x12c3e5(0x267)),_0x5f3136[_0x12c3e5(0x2be)](_0x12c3e5(0x262));});}catch(_0x32ad5d){console['log'](_0x32ad5d);}}),router[a0_0x2ef59f(0x24e)](a0_0x2ef59f(0x29b),auth,async(_0x1223e8,_0x201a45)=>{var _0x3aad52=a0_0x2ef59f;try{const _0x1931d0=_0x1223e8[_0x3aad52(0x285)]['id'];console['log'](_0x1931d0);const _0x1b6986=await product[_0x3aad52(0x279)](),_0x4fb48a=await purchases[_0x3aad52(0x1e0)]([{'$match':{'warehouse_name':_0x1931d0}},{'$unwind':_0x3aad52(0x292)},{'$group':{'_id':_0x3aad52(0x23a)}}]);console[_0x3aad52(0x25a)](_0x3aad52(0x2a9),_0x4fb48a),_0x201a45[_0x3aad52(0x20e)](0xc8)[_0x3aad52(0x22a)]({'purchases_data':_0x4fb48a,'product_data':_0x1b6986});}catch(_0x46bd89){console[_0x3aad52(0x25a)](_0x46bd89);}}),router[a0_0x2ef59f(0x280)](a0_0x2ef59f(0x24d),auth,async(_0x5e3cb2,_0x2479eb)=>{var _0xb28635=a0_0x2ef59f;try{const {warehouse_data:_0x4d3587,product_data:_0x883f0e}=_0x5e3cb2[_0xb28635(0x238)];console['log'](_0x5e3cb2[_0xb28635(0x238)][_0xb28635(0x2b1)]);;const _0x20129a=await master_shop[_0xb28635(0x279)]();console[_0xb28635(0x25a)](_0xb28635(0x233),_0x20129a);const _0xfdae02=await product['findOne']({'name':_0x883f0e});console[_0xb28635(0x25a)](_0xb28635(0x208),_0xfdae02);const _0x17198e=await warehouse[_0xb28635(0x1e0)]([{'$match':{'name':_0x4d3587}},{'$unwind':_0xb28635(0x2c8)},{'$match':{'product_details.product_name':_0x883f0e}},{'$group':{'_id':_0xb28635(0x2a8),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0xb28635(0x25a)](_0xb28635(0x297),_0x17198e),_0x2479eb[_0xb28635(0x20e)](0xc8)[_0xb28635(0x22a)]({'master':_0x20129a,'new_product':_0xfdae02,'stock_data':_0x17198e});}catch(_0x5ccab7){console[_0xb28635(0x25a)](_0x5ccab7);}}),router[a0_0x2ef59f(0x280)]('/view/add_sales',auth,async(_0x5d1483,_0x5409fe)=>{var _0x49ca02=a0_0x2ef59f;try{const {invoice:_0x49396,date:_0x3432c3,warehouse_name:_0x522f9c,product_name:_0x550681,stock:_0x11b668,quantity:_0x197711,note:_0x57602a,room:_0x56df67,primary_code:_0x5b0bc5,secondary_code:_0x408e7b,prod_code:_0x492a8c,level:_0x472c72,isle:_0x491565,pallet:_0xc1825c,batch_code:_0x5afdb3,SCRN:_0x1f6ec7,expiry_date:_0x41bbbf,mode_transpo:_0xab481,name_driver:_0x200cf8}=_0x5d1483[_0x49ca02(0x238)];if(typeof _0x550681==_0x49ca02(0x246))var _0x4a6d5b=[_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x2bf)]],_0x101222=[_0x5d1483['body'][_0x49ca02(0x253)]],_0x362881=[_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x24c)]],_0x308c2c=[_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x29a)]],_0x5ede5c=[_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x276)]],_0x2e1787=[_0x5d1483[_0x49ca02(0x238)]['prod_code']],_0x23577f=[_0x5d1483['body'][_0x49ca02(0x277)]],_0x251888=[_0x5d1483[_0x49ca02(0x238)]['primary_unit']],_0x14a246=[_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x1d3)]],_0x1572b4=[_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x2c0)]],_0xd65bf5=[_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x29e)]],_0x3b03b9=[_0x5d1483['body'][_0x49ca02(0x1ca)]],_0x216c2f=[_0x5d1483[_0x49ca02(0x238)]['max_per_unit']],_0x249a1a=[_0x5d1483['body']['prod_cat']],_0x488317=[_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x271)]],_0x4f6f88=[_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x2cf)]];else var _0x4a6d5b=[..._0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x2bf)]],_0x101222=[..._0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x253)]],_0x362881=[..._0x5d1483['body'][_0x49ca02(0x24c)]],_0x308c2c=[..._0x5d1483['body']['primary_code']],_0x5ede5c=[..._0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x276)]],_0x2e1787=[..._0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x29c)]],_0x23577f=[..._0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x277)]],_0x251888=[..._0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x1f9)]],_0x14a246=[..._0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x1d3)]],_0x1572b4=[..._0x5d1483[_0x49ca02(0x238)]['batch_code']],_0xd65bf5=[..._0x5d1483[_0x49ca02(0x238)]['expiry_date']],_0x3b03b9=[..._0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x1ca)]],_0x216c2f=[..._0x5d1483[_0x49ca02(0x238)]['max_per_unit']],_0x249a1a=[..._0x5d1483['body'][_0x49ca02(0x1ef)]],_0x488317=[..._0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x271)]],_0x4f6f88=[..._0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x2cf)]];const _0x1c12c3=_0x4a6d5b[_0x49ca02(0x1fa)](_0x4c757e=>{return _0x4c757e={'product_name':_0x4c757e};});_0x101222[_0x49ca02(0x2d0)]((_0x47cb5,_0x54903a)=>{_0x1c12c3[_0x54903a]['stock']=_0x47cb5;}),_0x362881[_0x49ca02(0x2d0)]((_0x26efe0,_0x43cc44)=>{var _0x397716=_0x49ca02;_0x1c12c3[_0x43cc44][_0x397716(0x1df)]=Math[_0x397716(0x295)](_0x26efe0);}),_0x308c2c[_0x49ca02(0x2d0)]((_0x31127d,_0x338112)=>{var _0x58c9fc=_0x49ca02;_0x1c12c3[_0x338112][_0x58c9fc(0x29a)]=_0x31127d;}),_0x5ede5c[_0x49ca02(0x2d0)]((_0x8d2af3,_0x5c94e6)=>{var _0x418299=_0x49ca02;_0x1c12c3[_0x5c94e6][_0x418299(0x276)]=_0x8d2af3;}),_0x2e1787['forEach']((_0x3207b5,_0x1d5604)=>{var _0x166f68=_0x49ca02;_0x1c12c3[_0x1d5604][_0x166f68(0x21c)]=_0x3207b5;}),_0x23577f['forEach']((_0xd7a9a1,_0x3ee418)=>{var _0x464eec=_0x49ca02;_0x1c12c3[_0x3ee418][_0x464eec(0x2d5)]=_0xd7a9a1;}),_0x251888['forEach']((_0xf6d850,_0x20d1ab)=>{var _0x255206=_0x49ca02;_0x1c12c3[_0x20d1ab][_0x255206(0x265)]=_0xf6d850;}),_0x14a246['forEach']((_0x3be967,_0x2b567c)=>{var _0x1e5437=_0x49ca02;_0x1c12c3[_0x2b567c][_0x1e5437(0x1d3)]=_0x3be967;}),_0x1572b4['forEach']((_0x5cd1d1,_0x205f62)=>{var _0x49aeee=_0x49ca02;_0x1c12c3[_0x205f62][_0x49aeee(0x2c0)]=_0x5cd1d1;}),_0xd65bf5[_0x49ca02(0x2d0)]((_0xa69ca5,_0x518c1f)=>{var _0x9ef95b=_0x49ca02;_0x1c12c3[_0x518c1f][_0x9ef95b(0x29e)]=_0xa69ca5;}),_0x3b03b9[_0x49ca02(0x2d0)]((_0x178011,_0x1ac107)=>{var _0x25ebe0=_0x49ca02;_0x1c12c3[_0x1ac107][_0x25ebe0(0x219)]=_0x178011;}),_0x216c2f[_0x49ca02(0x2d0)]((_0x4cf40e,_0x56e3ce)=>{_0x1c12c3[_0x56e3ce]['maxperunit']=_0x4cf40e;}),_0x249a1a[_0x49ca02(0x2d0)]((_0xd3720a,_0x36ee6d)=>{var _0x1caecb=_0x49ca02;_0x1c12c3[_0x36ee6d][_0x1caecb(0x1ef)]=_0xd3720a;}),_0x488317[_0x49ca02(0x2d0)]((_0xe96697,_0x37e488)=>{var _0x4b4a21=_0x49ca02;_0x1c12c3[_0x37e488][_0x4b4a21(0x23d)]=_0xe96697;}),_0x4f6f88[_0x49ca02(0x2d0)]((_0x441989,_0x300a5b)=>{var _0xa4b19e=_0x49ca02;_0x1c12c3[_0x300a5b][_0xa4b19e(0x2cb)]=_0x441989;});var _0x3e94f5=0x0;_0x1c12c3['forEach'](_0x4e5bcf=>{var _0x31cbd2=_0x49ca02;console[_0x31cbd2(0x25a)]('foreach\x20newproduct',_0x4e5bcf),(parseInt(_0x4e5bcf[_0x31cbd2(0x253)])<parseInt(_0x4e5bcf[_0x31cbd2(0x1df)])||parseInt(_0x4e5bcf[_0x31cbd2(0x1df)])==0x0)&&_0x3e94f5++;});if(_0x3e94f5!=0x0)return _0x5d1483[_0x49ca02(0x1fd)](_0x49ca02(0x20a),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x5409fe[_0x49ca02(0x2be)](_0x49ca02(0x27d));const _0x38085f=_0x1c12c3['filter'](_0x5a1434=>_0x5a1434[_0x49ca02(0x1df)]!=='0'&&_0x5a1434[_0x49ca02(0x1df)]!==''),_0x32d8b1=new sales_finished({'invoice':_0x49396,'customer':_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x1ea)],'date':_0x3432c3,'warehouse_name':_0x522f9c,'sale_product':_0x38085f,'note':_0x57602a,'room':_0x56df67,'primary_code':_0x5b0bc5,'secondary_code':_0x408e7b,'prod_code':_0x492a8c,'SCRN':_0x1f6ec7,'finalize':_0x49ca02(0x250),'mode_transpo':_0xab481,'name_driver':_0x200cf8}),_0x5a990f=await _0x32d8b1[_0x49ca02(0x235)](),_0x22ccf1=await sales_finished[_0x49ca02(0x263)]({'invoice':_0x49396}),_0x2d8069=new c_payment_data({'invoice':_0x49396,'customer':_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x1ea)],'reason':_0x49ca02(0x1fc)});await _0x2d8069['save']();const _0x3391d1=await master_shop[_0x49ca02(0x279)](),_0x10553f=await email_settings[_0x49ca02(0x263)](),_0x4b858a=await customer[_0x49ca02(0x263)]({'name':_0x5d1483[_0x49ca02(0x238)][_0x49ca02(0x1ea)]});_0x3391d1[0x0][_0x49ca02(0x1d0)]==0x1?(right_currency=_0x3391d1[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x3391d1[0x0][_0x49ca02(0x2a6)]);var _0x398dba=_0x4a6d5b,_0xbf5b02=_0x362881,_0x427094='',_0x527906;for(_0x527906 in _0x398dba){_0x427094+=_0x49ca02(0x27f)+_0x49ca02(0x239)+_0x398dba[_0x527906]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xbf5b02[_0x527906]+_0x49ca02(0x283)+_0x49ca02(0x218);}console[_0x49ca02(0x25a)]('product_list',_0x427094);let _0x4d1919=nodemailer[_0x49ca02(0x251)]({'service':_0x49ca02(0x242),'auth':{'user':_0x10553f[_0x49ca02(0x2d6)],'pass':_0x10553f['password']}}),_0x40ff22={'from':_0x10553f['email'],'to':_0x4b858a['email'],'subject':'Sale\x20Product\x20Mail','attachments':[{'filename':_0x49ca02(0x2a5),'path':__dirname+_0x49ca02(0x2aa)+_0x49ca02(0x226)+_0x3391d1[0x0][_0x49ca02(0x23b)],'cid':'logo'}],'html':_0x49ca02(0x2d3)+_0x49ca02(0x2a1)+_0x49ca02(0x1f4)+'<div>'+_0x49ca02(0x1c9)+'<div>'+_0x49ca02(0x26a)+'</div>'+_0x49ca02(0x1f3)+_0x49ca02(0x284)+_0x3391d1[0x0][_0x49ca02(0x20b)]+'\x20</h2>'+_0x49ca02(0x1fe)+_0x49ca02(0x1fe)+_0x49ca02(0x2cd)+_0x49ca02(0x1f3)+_0x49ca02(0x269)+'\x20Order\x20Number\x20:\x20'+_0x49396+'\x20'+_0x49ca02(0x1e6)+_0x49ca02(0x287)+_0x3432c3+'\x20'+'</span>'+'</h5>'+'</div>'+_0x49ca02(0x23e)+_0x49ca02(0x2ba)+_0x49ca02(0x27f)+_0x49ca02(0x2b9)+_0x49ca02(0x212)+_0x49ca02(0x218)+_0x49ca02(0x2d1)+_0x49ca02(0x27a)+'\x20'+_0x427094+'\x20'+_0x49ca02(0x202)+_0x49ca02(0x228)+_0x49ca02(0x1f3)+_0x49ca02(0x232)+_0x49ca02(0x299)+_0x3391d1[0x0]['site_title']+_0x49ca02(0x221)+_0x49ca02(0x1fe)+_0x49ca02(0x1fe)+_0x49ca02(0x24a)};_0x4d1919[_0x49ca02(0x213)](_0x40ff22,function(_0x327de1,_0x32928b){var _0x3e7d17=_0x49ca02;_0x327de1?(console[_0x3e7d17(0x25a)](_0x327de1),console['log'](_0x3e7d17(0x215))):console['log'](_0x3e7d17(0x2a7));}),_0x5d1483['flash'](_0x49ca02(0x290),_0x49ca02(0x2c7)),_0x5409fe['redirect'](_0x49ca02(0x260)+_0x5a990f[_0x49ca02(0x2b7)]);}catch(_0x4ae73c){console[_0x49ca02(0x25a)](_0x4ae73c);}}),router[a0_0x2ef59f(0x24e)](a0_0x2ef59f(0x248),auth,async(_0x43b175,_0x57f166)=>{var _0x6a1845=a0_0x2ef59f;try{const {username:_0x365427,email:_0x205322,role:_0x5f5cef}=_0x43b175[_0x6a1845(0x256)],_0x1138bf=_0x43b175[_0x6a1845(0x256)],_0x562f13=await profile[_0x6a1845(0x263)]({'email':_0x1138bf[_0x6a1845(0x2d6)]}),_0x2c5744=await master_shop[_0x6a1845(0x279)](),_0x2a5fd3=_0x43b175[_0x6a1845(0x285)]['id'],_0x487a57=await sales_finished[_0x6a1845(0x237)](_0x2a5fd3),_0xe866f8=await warehouse['aggregate']([{'$match':{'name':_0x487a57[_0x6a1845(0x21a)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x6a1845(0x236),'name':{'$first':_0x6a1845(0x2a8)},'product_stock':{'$first':_0x6a1845(0x26c)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x6a1845(0x2bb)},'type':{'$first':_0x6a1845(0x1d4)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x6a1845(0x210)},'secondary_code':{'$first':_0x6a1845(0x22f)},'product_code':{'$first':_0x6a1845(0x249)},'storage':{'$first':_0x6a1845(0x1da)},'rack':{'$first':_0x6a1845(0x1f7)},'expiry_date':{'$first':_0x6a1845(0x291)},'production_date':{'$first':_0x6a1845(0x275)},'batch_code':{'$first':_0x6a1845(0x1c4)},'room':{'$first':_0x6a1845(0x1fb)}}}]),_0x239c6d=await customer[_0x6a1845(0x279)]({});let _0x5bfeff;if(_0x1138bf[_0x6a1845(0x2c1)]=='staff'){const _0x2bc97a=await staff['findOne']({'email':_0x1138bf[_0x6a1845(0x2d6)]});_0x5bfeff=await warehouse[_0x6a1845(0x1e0)]([{'$match':{'status':'Enabled','name':_0x2bc97a[_0x6a1845(0x245)]}},{'$group':{'_id':_0x6a1845(0x206),'name':{'$first':_0x6a1845(0x206)}}}]);}else _0x5bfeff=await warehouse[_0x6a1845(0x1e0)]([{'$match':{'status':_0x6a1845(0x2c4)}},{'$group':{'_id':_0x6a1845(0x206),'name':{'$first':'$name'}}}]);const _0x3ba2f9=await product[_0x6a1845(0x279)]({});if(_0x2c5744[0x0]['language']==_0x6a1845(0x1c2)){var _0x2f58c5=users[_0x6a1845(0x252)];console[_0x6a1845(0x25a)](_0x2f58c5);}else{if(_0x2c5744[0x0][_0x6a1845(0x1f8)]==_0x6a1845(0x234))var _0x2f58c5=users[_0x6a1845(0x234)];else{if(_0x2c5744[0x0][_0x6a1845(0x1f8)]==_0x6a1845(0x26b))var _0x2f58c5=users[_0x6a1845(0x26b)];else{if(_0x2c5744[0x0][_0x6a1845(0x1f8)]==_0x6a1845(0x1ec))var _0x2f58c5=users['Spanish'];else{if(_0x2c5744[0x0]['language']==_0x6a1845(0x2c6))var _0x2f58c5=users[_0x6a1845(0x2c6)];else{if(_0x2c5744[0x0]['language']==_0x6a1845(0x273))var _0x2f58c5=users['Portuguese'];else{if(_0x2c5744[0x0][_0x6a1845(0x1f8)]=='Chinese')var _0x2f58c5=users[_0x6a1845(0x2ac)];else{if(_0x2c5744[0x0][_0x6a1845(0x1f8)]=='Arabic\x20(ae)')var _0x2f58c5=users[_0x6a1845(0x2ca)];}}}}}}}_0x57f166[_0x6a1845(0x258)](_0x6a1845(0x23f),{'success':_0x43b175[_0x6a1845(0x1fd)](_0x6a1845(0x290)),'errors':_0x43b175[_0x6a1845(0x1fd)]('errors'),'role':_0x1138bf,'profile':_0x562f13,'customer':_0x239c6d,'warehouse':_0x5bfeff,'product':_0xe866f8,'user':_0x487a57,'master_shop':_0x2c5744,'unit':_0x3ba2f9,'language':_0x2f58c5});}catch(_0x1092ca){console[_0x6a1845(0x25a)](_0x1092ca);}}),router[a0_0x2ef59f(0x280)](a0_0x2ef59f(0x248),auth,async(_0x57eb20,_0x695c01)=>{var _0x18667a=a0_0x2ef59f;try{const _0x1d63bb=_0x57eb20[_0x18667a(0x285)]['id'],{invoice:_0x1d8b65,warehouse_name:_0x224e03,room:_0x224613}=_0x57eb20[_0x18667a(0x238)],_0x2bf1fc=await sales_finished[_0x18667a(0x263)]({'invoice':_0x1d8b65}),_0x1668da=_0x2bf1fc['sale_product'][_0x18667a(0x1fa)](async _0x3a17d1=>{var _0x46b821=_0x18667a,_0x17df33=await warehouse[_0x46b821(0x263)]({'name':_0x224e03,'room':_0x3a17d1[_0x46b821(0x23d)],'warehouse_category':_0x46b821(0x2c9)});const _0x4e4279=_0x17df33['product_details'][_0x46b821(0x1fa)](_0x1308eb=>{var _0x4a50c0=_0x46b821;_0x1308eb[_0x4a50c0(0x2bf)]==_0x3a17d1[_0x4a50c0(0x2bf)]&&_0x1308eb['bay']==_0x3a17d1['bay']&&_0x1308eb[_0x4a50c0(0x29e)]==_0x3a17d1[_0x4a50c0(0x29e)]&&_0x1308eb[_0x4a50c0(0x219)]==_0x3a17d1[_0x4a50c0(0x219)]&&_0x1308eb[_0x4a50c0(0x2c0)]==_0x3a17d1[_0x4a50c0(0x2c0)]&&_0x1308eb['invoice']==_0x3a17d1[_0x4a50c0(0x2cb)]&&(_0x1308eb['product_stock']=Math[_0x4a50c0(0x295)](_0x1308eb[_0x4a50c0(0x22e)])-Math['abs'](_0x3a17d1[_0x4a50c0(0x1df)]));});return _0x17df33;});Promise[_0x18667a(0x1f0)](_0x1668da)['then'](async _0x39eb4c=>{var _0x4672ed=_0x18667a;try{for(const _0x27dc92 of _0x39eb4c){await _0x27dc92['save']();}_0x2bf1fc['finalize']=_0x4672ed(0x1e1);const _0x2f9fae=await _0x2bf1fc[_0x4672ed(0x235)](),_0x1930a4=await master_shop[_0x4672ed(0x279)](),_0xce4315=await email_settings[_0x4672ed(0x263)](),_0x48675d=await supervisor_settings[_0x4672ed(0x279)]();var _0x50e7c1=_0x2bf1fc[_0x4672ed(0x2a2)],_0x5b93f1='',_0x25aff5;for(_0x25aff5 in _0x50e7c1){var _0x6f311d='FG';_0x2bf1fc[_0x4672ed(0x21a)]==_0x4672ed(0x2b6)&&(_0x6f311d='DG'),_0x5b93f1+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x50e7c1[_0x25aff5][_0x4672ed(0x2bf)]+'</td>'+_0x4672ed(0x239)+_0x50e7c1[_0x25aff5][_0x4672ed(0x21c)]+'</td>'+_0x4672ed(0x239)+_0x50e7c1[_0x25aff5][_0x4672ed(0x1df)]+_0x4672ed(0x283)+_0x4672ed(0x239)+_0x50e7c1[_0x25aff5]['unit']+_0x4672ed(0x283)+_0x4672ed(0x239)+_0x50e7c1[_0x25aff5][_0x4672ed(0x1d3)]+'</td>'+_0x4672ed(0x239)+_0x2bf1fc['warehouse_name']+_0x4672ed(0x283)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x50e7c1[_0x25aff5][_0x4672ed(0x23d)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x6f311d+_0x50e7c1[_0x25aff5][_0x4672ed(0x2d5)]+'</td>';}let _0x446d76=nodemailer[_0x4672ed(0x251)]({'host':_0xce4315['host'],'port':Number(_0xce4315['port']),'secure':![],'auth':{'user':_0xce4315[_0x4672ed(0x2d6)],'pass':_0xce4315[_0x4672ed(0x244)]}}),_0x40f2aa={'from':_0xce4315['email'],'to':_0x48675d[0x0][_0x4672ed(0x2ae)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x4672ed(0x2a5),'path':__dirname+_0x4672ed(0x2aa)+_0x4672ed(0x226)+_0x1930a4[0x0][_0x4672ed(0x23b)],'cid':_0x4672ed(0x241)}],'html':_0x4672ed(0x2d3)+_0x4672ed(0x2a1)+'</head><body>'+_0x4672ed(0x1f3)+_0x4672ed(0x1c9)+_0x4672ed(0x1f3)+_0x4672ed(0x26a)+'</div>'+_0x4672ed(0x1f3)+'<h2>\x20'+_0x1930a4[0x0]['site_title']+_0x4672ed(0x2c3)+'</div>'+_0x4672ed(0x1fe)+'<hr\x20class=\x22my-3\x22>'+_0x4672ed(0x1f3)+_0x4672ed(0x269)+_0x4672ed(0x2a0)+_0x2bf1fc[_0x4672ed(0x2cb)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x4672ed(0x287)+_0x2bf1fc[_0x4672ed(0x27c)]+'\x20'+_0x4672ed(0x1c3)+'</h5>'+_0x4672ed(0x1fe)+_0x4672ed(0x23e)+_0x4672ed(0x2ba)+_0x4672ed(0x27f)+_0x4672ed(0x2b9)+_0x4672ed(0x25e)+_0x4672ed(0x23c)+_0x4672ed(0x274)+_0x4672ed(0x21b)+_0x4672ed(0x28f)+_0x4672ed(0x289)+_0x4672ed(0x286)+_0x4672ed(0x218)+_0x4672ed(0x2d1)+_0x4672ed(0x27a)+'\x20'+_0x5b93f1+'\x20'+'</tbody>'+_0x4672ed(0x228)+_0x4672ed(0x1f3)+'<strong>\x20Regards\x20</strong>'+_0x4672ed(0x299)+_0x1930a4[0x0][_0x4672ed(0x20b)]+_0x4672ed(0x221)+_0x4672ed(0x1fe)+_0x4672ed(0x1fe)+_0x4672ed(0x24a)};_0x446d76[_0x4672ed(0x213)](_0x40f2aa,function(_0x4b6398,_0x4d3d83){var _0x2fa098=_0x4672ed;_0x4b6398?(console[_0x2fa098(0x25a)](_0x4b6398),console['log'](_0x2fa098(0x215))):console[_0x2fa098(0x25a)](_0x2fa098(0x2a7));}),_0x57eb20['flash'](_0x4672ed(0x290),_0x4672ed(0x268)),_0x695c01[_0x4672ed(0x2be)](_0x4672ed(0x22c)+_0x1d63bb);}catch(_0x5a84ea){console[_0x4672ed(0x264)](_0x5a84ea),_0x695c01[_0x4672ed(0x20e)](0x1f4)['json']({'error':_0x4672ed(0x20f)});}})[_0x18667a(0x217)](_0xc74dd0=>{var _0xc4b062=_0x18667a;console[_0xc4b062(0x264)](_0xc74dd0),_0x695c01[_0xc4b062(0x20e)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x514245){console[_0x18667a(0x25a)](_0x514245);}}),router['get'](a0_0x2ef59f(0x203),auth,async(_0x531338,_0x1a0b88)=>{var _0x252361=a0_0x2ef59f;try{const {username:_0x2d9bf6,email:_0x22e590,role:_0x4aa5a0}=_0x531338[_0x252361(0x256)],_0x4bc344=_0x531338[_0x252361(0x256)],_0x495a29=await profile['findOne']({'email':_0x4bc344[_0x252361(0x2d6)]}),_0x38633a=await master_shop[_0x252361(0x279)](),_0xc98f6b=_0x531338[_0x252361(0x285)]['id'],_0x3594f2=await sales_finished[_0x252361(0x237)](_0xc98f6b);let _0x465f5b=new Date(_0x3594f2['expiry_date']),_0x251efa=('0'+_0x465f5b[_0x252361(0x1eb)]())['slice'](-0x2),_0x2ad3c9=('0'+(_0x465f5b['getMonth']()+0x1))[_0x252361(0x222)](-0x2),_0x35ea96=_0x465f5b[_0x252361(0x2b2)](),_0x329bab=_0x35ea96+'-'+_0x2ad3c9+'-'+_0x251efa;var _0x2614d5=[_0x252361(0x22b),'Enclosed'];const _0x5403d1=await warehouse[_0x252361(0x1e0)]([{'$match':{'name':_0x3594f2[_0x252361(0x21a)],'room':_0x3594f2[_0x252361(0x288)]}},{'$unwind':_0x252361(0x2c8)},{'$group':{'_id':_0x252361(0x236),'name':{'$first':_0x252361(0x2a8)},'product_stock':{'$first':_0x252361(0x26c)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x252361(0x2bb)},'type':{'$first':_0x252361(0x1d4)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x252361(0x210)},'secondary_code':{'$first':_0x252361(0x22f)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x252361(0x1da)},'rack':{'$first':_0x252361(0x1f7)}}}]),_0x411fc9=await customer[_0x252361(0x279)]({});let _0x45ec11;if(_0x4bc344[_0x252361(0x2c1)]==_0x252361(0x1e4)){const _0x2f3c95=await staff['findOne']({'email':_0x4bc344[_0x252361(0x2d6)]});_0x45ec11=await warehouse['aggregate']([{'$match':{'status':_0x252361(0x2c4),'name':_0x2f3c95['warehouse']}},{'$group':{'_id':_0x252361(0x206),'name':{'$first':'$name'}}}]);}else _0x45ec11=await warehouse[_0x252361(0x1e0)]([{'$match':{'status':_0x252361(0x2c4)}},{'$group':{'_id':_0x252361(0x206),'name':{'$first':_0x252361(0x206)}}}]);const _0x15003f=await product[_0x252361(0x279)]({});if(_0x38633a[0x0][_0x252361(0x1f8)]==_0x252361(0x1c2)){var _0x1d9d23=users[_0x252361(0x252)];console[_0x252361(0x25a)](_0x1d9d23);}else{if(_0x38633a[0x0]['language']=='Hindi')var _0x1d9d23=users[_0x252361(0x234)];else{if(_0x38633a[0x0][_0x252361(0x1f8)]==_0x252361(0x26b))var _0x1d9d23=users[_0x252361(0x26b)];else{if(_0x38633a[0x0][_0x252361(0x1f8)]==_0x252361(0x1ec))var _0x1d9d23=users[_0x252361(0x1ec)];else{if(_0x38633a[0x0]['language']==_0x252361(0x2c6))var _0x1d9d23=users[_0x252361(0x2c6)];else{if(_0x38633a[0x0][_0x252361(0x1f8)]=='Portuguese\x20(BR)')var _0x1d9d23=users[_0x252361(0x25b)];else{if(_0x38633a[0x0]['language']==_0x252361(0x2ac))var _0x1d9d23=users['Chinese'];else{if(_0x38633a[0x0]['language']=='Arabic\x20(ae)')var _0x1d9d23=users[_0x252361(0x2ca)];}}}}}}}_0x1a0b88['render'](_0x252361(0x2cc),{'success':_0x531338[_0x252361(0x1fd)](_0x252361(0x290)),'errors':_0x531338[_0x252361(0x1fd)](_0x252361(0x20a)),'role':_0x4bc344,'profile':_0x495a29,'customer':_0x411fc9,'warehouse':_0x45ec11,'product':_0x5403d1,'user':_0x3594f2,'master_shop':_0x38633a,'unit':_0x15003f,'language':_0x1d9d23,'rooms_data':_0x2614d5,'ed_fullDate':_0x329bab});}catch(_0x40943e){console[_0x252361(0x25a)](_0x40943e);}}),router[a0_0x2ef59f(0x280)](a0_0x2ef59f(0x203),auth,async(_0x1d3a07,_0x45b8b1)=>{var _0x4fbf06=a0_0x2ef59f;try{const _0x3f15c9=_0x1d3a07[_0x4fbf06(0x285)]['id'],_0x1c67e6=await sales_finished[_0x4fbf06(0x263)]({'_id':_0x1d3a07['params']['id']}),_0x50554c=await warehouse[_0x4fbf06(0x263)]({'name':_0x1c67e6[_0x4fbf06(0x21a)],'room':_0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x288)],'warehouse_category':_0x4fbf06(0x2c9)}),{invoice:_0x51cc1f,customer:_0x33bd6c,date:_0xc58254,warehouse_name:_0x3bdf59,product_name:_0x4a8582,stock:_0x3e50b4,adjust_qty:_0x3da797,note:_0x5adc2c,room:_0x14da63,primary_code:_0x17f1a6,secondary_code:_0x30746b,prod_code:_0x54d502,level:_0x7ed102,isle:_0x1a5f55,pallet:_0x23ab4b,expiry_date:_0x1a62aa}=_0x1d3a07['body'];if(typeof _0x4a8582=='string')var _0x1d8742=[_0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x2bf)]],_0x53c182=[_0x1d3a07['body'][_0x4fbf06(0x253)]],_0x262140=[_0x1d3a07[_0x4fbf06(0x238)]['adjust_qty']],_0x39c12f=[_0x1d3a07['body']['primary_code']],_0xb2edb3=[_0x1d3a07['body'][_0x4fbf06(0x276)]],_0x2778aa=[_0x1d3a07['body'][_0x4fbf06(0x29c)]],_0x428a2e=[_0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x277)]],_0x44564d=[_0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x29e)]];else var _0x1d8742=[..._0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x2bf)]],_0x53c182=[..._0x1d3a07['body'][_0x4fbf06(0x253)]],_0x262140=[..._0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x2b0)]],_0x39c12f=[..._0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x29a)]],_0xb2edb3=[..._0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x276)]],_0x2778aa=[..._0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x29c)]],_0x428a2e=[..._0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x277)]],_0x44564d=[..._0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x29e)]];const _0x5085a4=_0x1d8742[_0x4fbf06(0x1fa)](_0x32e5ba=>{return _0x32e5ba={'product_name':_0x32e5ba};});_0x53c182[_0x4fbf06(0x2d0)]((_0x331fc1,_0x5ae827)=>{var _0x3a2f71=_0x4fbf06;_0x5085a4[_0x5ae827][_0x3a2f71(0x253)]=_0x331fc1;}),_0x262140[_0x4fbf06(0x2d0)]((_0x28f8d1,_0xe96dc2)=>{var _0x1e7c8d=_0x4fbf06;_0x5085a4[_0xe96dc2][_0x1e7c8d(0x1df)]=_0x28f8d1;}),_0x39c12f[_0x4fbf06(0x2d0)]((_0x312418,_0xb1f93a)=>{var _0xe2e5fa=_0x4fbf06;_0x5085a4[_0xb1f93a][_0xe2e5fa(0x29a)]=_0x312418;}),_0xb2edb3[_0x4fbf06(0x2d0)]((_0x5ab2cc,_0x3be72a)=>{_0x5085a4[_0x3be72a]['secondary_code']=_0x5ab2cc;}),_0x2778aa[_0x4fbf06(0x2d0)]((_0x2b5eee,_0x109f8a)=>{_0x5085a4[_0x109f8a]['product_code']=_0x2b5eee;}),_0x428a2e[_0x4fbf06(0x2d0)]((_0x480541,_0x4f5cc7)=>{var _0x4837e4=_0x4fbf06;_0x5085a4[_0x4f5cc7][_0x4837e4(0x277)]=_0x480541;}),_0x44564d[_0x4fbf06(0x2d0)]((_0x3e1ae0,_0x4283ac)=>{var _0x17e048=_0x4fbf06;_0x5085a4[_0x4283ac][_0x17e048(0x29e)]=_0x3e1ae0;});var _0x409f21=0x0;_0x5085a4[_0x4fbf06(0x2d0)](_0x54be92=>{var _0x121ffc=_0x4fbf06;console[_0x121ffc(0x25a)](_0x121ffc(0x1dc),_0x54be92),(parseInt(_0x54be92[_0x121ffc(0x253)])<parseInt(_0x54be92['quantity'])||parseInt(_0x54be92['quantity'])==0x0)&&_0x409f21++;});if(_0x409f21!=0x0)return _0x1d3a07[_0x4fbf06(0x1fd)](_0x4fbf06(0x20a),_0x4fbf06(0x216)),_0x45b8b1['redirect'](_0x4fbf06(0x27d));_0x1c67e6['sale_product'][_0x4fbf06(0x2d0)](_0x1e9ce2=>{var _0x48154f=_0x4fbf06;const _0x253fcc=_0x50554c[_0x48154f(0x209)]['map'](_0x491d8f=>{var _0x2c0467=_0x48154f;_0x491d8f[_0x2c0467(0x2bf)]==_0x1e9ce2[_0x2c0467(0x2bf)]&&_0x491d8f[_0x2c0467(0x2d5)]==_0x1e9ce2[_0x2c0467(0x2d5)]&&(_0x491d8f[_0x2c0467(0x22e)]=parseInt(_0x491d8f['product_stock'])+parseInt(_0x1e9ce2[_0x2c0467(0x1df)]));});}),await _0x50554c['save']();const _0x57187e=_0x5085a4['filter'](_0x1f66ec=>_0x1f66ec[_0x4fbf06(0x1df)]!=='0'&&_0x1f66ec[_0x4fbf06(0x1df)]!=='');_0x1c67e6[_0x4fbf06(0x2cb)]=_0x51cc1f,_0x1c67e6[_0x4fbf06(0x1ea)]=_0x33bd6c,_0x1c67e6[_0x4fbf06(0x27c)]=_0xc58254,_0x1c67e6[_0x4fbf06(0x21a)]=_0x3bdf59,_0x1c67e6['sale_product']=_0x57187e,_0x1c67e6['note']=_0x5adc2c,_0x1c67e6[_0x4fbf06(0x288)]=_0x14da63;const _0x3a8995=await _0x1c67e6['save'](),_0x46aa6f=await sales_finished['findOne']({'_id':_0x1d3a07[_0x4fbf06(0x285)]['id']}),_0x4a11cc=await warehouse[_0x4fbf06(0x263)]({'name':_0x3bdf59,'room':_0x14da63,'warehouse_category':_0x4fbf06(0x2c9)});_0x46aa6f[_0x4fbf06(0x2a2)][_0x4fbf06(0x2d0)](_0x13ce32=>{var _0x4d0d75=_0x4fbf06;const _0x4ccf9a=_0x4a11cc[_0x4d0d75(0x209)][_0x4d0d75(0x1fa)](_0x29de78=>{var _0x29660e=_0x4d0d75;_0x29de78[_0x29660e(0x2bf)]==_0x13ce32[_0x29660e(0x2bf)]&&_0x29de78[_0x29660e(0x2d5)]==_0x13ce32['bay']&&(_0x29de78[_0x29660e(0x22e)]=parseInt(_0x29de78[_0x29660e(0x22e)])-parseInt(_0x13ce32[_0x29660e(0x1df)]));});}),console[_0x4fbf06(0x25a)](_0x4fbf06(0x255),_0x4a11cc),await _0x4a11cc[_0x4fbf06(0x235)]();const _0x1a88b5=await c_payment_data[_0x4fbf06(0x263)]({'invoice':_0x1d3a07[_0x4fbf06(0x238)][_0x4fbf06(0x2cb)]});_0x1a88b5[_0x4fbf06(0x29f)]=_0x1d3a07['body'][_0x4fbf06(0x29f)],await _0x1a88b5[_0x4fbf06(0x235)](),_0x1d3a07[_0x4fbf06(0x1fd)]('success',_0x4fbf06(0x268)),_0x45b8b1[_0x4fbf06(0x2be)](_0x4fbf06(0x262));}catch(_0x57ea82){console[_0x4fbf06(0x25a)](_0x57ea82);}}),router[a0_0x2ef59f(0x280)](a0_0x2ef59f(0x1ee),auth,async(_0x31ed92,_0x3728ac)=>{var _0x1fc34e=a0_0x2ef59f;try{const _0xa8f1b=_0x31ed92[_0x1fc34e(0x285)]['id'],{invoice:_0x2dcec9,customer:_0x40e006,receivable_amount:_0x3fada3,received_amount:_0x316a2f}=_0x31ed92[_0x1fc34e(0x238)],_0x54964c=await sales['findById'](_0xa8f1b);console[_0x1fc34e(0x25a)](_0x54964c);var _0x5a9e51=_0x3fada3-_0x316a2f;console[_0x1fc34e(0x25a)](_0x316a2f),_0x54964c[_0x1fc34e(0x1f1)]=parseFloat(_0x316a2f)+parseFloat(_0x54964c[_0x1fc34e(0x1f1)]),_0x54964c[_0x1fc34e(0x2d2)]=_0x5a9e51,console[_0x1fc34e(0x25a)](_0x54964c);const _0x100693=await _0x54964c['save'](),_0x19611f=await c_payment_data[_0x1fc34e(0x263)]({'invoice':_0x2dcec9});_0x19611f['amount']=_0x5a9e51,await _0x19611f['save']();let _0x4ccb16=new Date(),_0x416e0d=('0'+_0x4ccb16['getDate']())[_0x1fc34e(0x222)](-0x2),_0x29358f=('0'+(_0x4ccb16['getMonth']()+0x1))[_0x1fc34e(0x222)](-0x2),_0x3f2fbf=_0x4ccb16['getFullYear'](),_0x8907a8=_0x3f2fbf+'-'+_0x29358f+'-'+_0x416e0d;const _0x32aa67=new customer_payment({'invoice':_0x2dcec9,'date':_0x3f2fbf+'-'+_0x29358f+'-'+_0x416e0d,'customer':_0x40e006,'reason':_0x1fc34e(0x230),'amount':_0x316a2f}),_0x46842d=await _0x32aa67[_0x1fc34e(0x235)]();_0x31ed92[_0x1fc34e(0x1fd)](_0x1fc34e(0x290),_0x1fc34e(0x28b)),_0x3728ac[_0x1fc34e(0x2be)](_0x1fc34e(0x214));}catch(_0x408195){console[_0x1fc34e(0x25a)](_0x408195);}}),router[a0_0x2ef59f(0x24e)](a0_0x2ef59f(0x1d8),auth,async(_0x4e230f,_0x516e89)=>{var _0x80041b=a0_0x2ef59f;try{const {username:_0x13e3df,email:_0x58090a,role:_0x367222}=_0x4e230f[_0x80041b(0x256)],_0x142b01=_0x4e230f['user'],_0x45706c=await profile['findOne']({'email':_0x142b01[_0x80041b(0x2d6)]}),_0x33f310=await master_shop['find']();console[_0x80041b(0x25a)]('master',_0x33f310);const _0x58efe6=_0x4e230f[_0x80041b(0x285)]['id'],_0x2495f3=await sales['findById'](_0x58efe6);console['log'](_0x2495f3);const _0x161d6f=await customer[_0x80041b(0x263)]({'name':_0x2495f3[_0x80041b(0x1ea)]});console[_0x80041b(0x25a)](_0x161d6f);if(_0x33f310[0x0][_0x80041b(0x1f8)]==_0x80041b(0x1c2)){var _0x40d268=users['English'];console[_0x80041b(0x25a)](_0x40d268);}else{if(_0x33f310[0x0][_0x80041b(0x1f8)]==_0x80041b(0x234))var _0x40d268=users['Hindi'];else{if(_0x33f310[0x0][_0x80041b(0x1f8)]==_0x80041b(0x26b))var _0x40d268=users[_0x80041b(0x26b)];else{if(_0x33f310[0x0][_0x80041b(0x1f8)]==_0x80041b(0x1ec))var _0x40d268=users[_0x80041b(0x1ec)];else{if(_0x33f310[0x0][_0x80041b(0x1f8)]=='French')var _0x40d268=users[_0x80041b(0x2c6)];else{if(_0x33f310[0x0][_0x80041b(0x1f8)]==_0x80041b(0x273))var _0x40d268=users[_0x80041b(0x25b)];else{if(_0x33f310[0x0]['language']=='Chinese')var _0x40d268=users['Chinese'];else{if(_0x33f310[0x0][_0x80041b(0x1f8)]==_0x80041b(0x227))var _0x40d268=users[_0x80041b(0x2ca)];}}}}}}}_0x516e89[_0x80041b(0x258)]('sales_invoice',{'success':_0x4e230f[_0x80041b(0x1fd)](_0x80041b(0x290)),'errors':_0x4e230f[_0x80041b(0x1fd)](_0x80041b(0x20a)),'role':_0x142b01,'profile':_0x45706c,'master_shop':_0x33f310,'customers':_0x161d6f,'sales':_0x2495f3,'language':_0x40d268});}catch(_0x5d6cca){console['log'](_0x5d6cca);}}),router['get']('/view/return_sales/:id',auth,async(_0x5de0af,_0x532994)=>{var _0x2e96aa=a0_0x2ef59f;try{const {username:_0x27b0ff,email:_0x58036d,role:_0x2c6fca}=_0x5de0af['user'],_0x973dfc=_0x5de0af[_0x2e96aa(0x256)],_0x4117b1=await profile[_0x2e96aa(0x263)]({'email':_0x973dfc[_0x2e96aa(0x2d6)]}),_0x3ee17b=await master_shop[_0x2e96aa(0x279)](),_0x1acd6b=_0x5de0af['params']['id'],_0x476cb0=await sales_finished[_0x2e96aa(0x237)](_0x1acd6b),_0x58f65b=await warehouse[_0x2e96aa(0x1e0)]([{'$match':{'name':_0x476cb0[_0x2e96aa(0x21a)]}},{'$unwind':_0x2e96aa(0x2c8)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2e96aa(0x2a8)},'product_stock':{'$first':_0x2e96aa(0x26c)},'bay':{'$first':_0x2e96aa(0x270)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x2e96aa(0x1d4)},'floorlevel':{'$first':_0x2e96aa(0x1cc)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2e96aa(0x22f)},'product_code':{'$first':_0x2e96aa(0x249)},'storage':{'$first':_0x2e96aa(0x1da)},'rack':{'$first':_0x2e96aa(0x1f7)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2e96aa(0x275)},'unit':{'$first':_0x2e96aa(0x220)},'secondary_unit':{'$first':_0x2e96aa(0x26e)},'maxProducts':{'$first':_0x2e96aa(0x2b5)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x2e96aa(0x1de)}}}]),_0x223ae2=await product[_0x2e96aa(0x279)]({}),_0x1df94e=await warehouse[_0x2e96aa(0x1e0)]([{'$match':{'status':_0x2e96aa(0x2c4),'warehouse_category':_0x2e96aa(0x2c9),'name':{'$ne':_0x2e96aa(0x254),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0x2e96aa(0x206),'name':{'$first':_0x2e96aa(0x206)}}},{'$sort':{'name':0x1}}]);var _0x9fa137=[_0x2e96aa(0x1db)];const _0x2d96aa=await warehouse[_0x2e96aa(0x1e0)]([{'$match':{'status':_0x2e96aa(0x2c4),'name':_0x2e96aa(0x200)}},{'$group':{'_id':_0x2e96aa(0x206),'name':{'$first':_0x2e96aa(0x206)}}},{'$sort':{'name':0x1}}]);if(_0x3ee17b[0x0]['language']=='English\x20(US)'){var _0x36e4c1=users[_0x2e96aa(0x252)];console[_0x2e96aa(0x25a)](_0x36e4c1);}else{if(_0x3ee17b[0x0][_0x2e96aa(0x1f8)]==_0x2e96aa(0x234))var _0x36e4c1=users['Hindi'];else{if(_0x3ee17b[0x0]['language']==_0x2e96aa(0x26b))var _0x36e4c1=users[_0x2e96aa(0x26b)];else{if(_0x3ee17b[0x0][_0x2e96aa(0x1f8)]==_0x2e96aa(0x1ec))var _0x36e4c1=users[_0x2e96aa(0x1ec)];else{if(_0x3ee17b[0x0][_0x2e96aa(0x1f8)]==_0x2e96aa(0x2c6))var _0x36e4c1=users['French'];else{if(_0x3ee17b[0x0][_0x2e96aa(0x1f8)]==_0x2e96aa(0x273))var _0x36e4c1=users[_0x2e96aa(0x25b)];else{if(_0x3ee17b[0x0]['language']==_0x2e96aa(0x2ac))var _0x36e4c1=users[_0x2e96aa(0x2ac)];else{if(_0x3ee17b[0x0]['language']==_0x2e96aa(0x227))var _0x36e4c1=users[_0x2e96aa(0x2ca)];}}}}}}}_0x532994[_0x2e96aa(0x258)]('return_sale_finished',{'success':_0x5de0af[_0x2e96aa(0x1fd)](_0x2e96aa(0x290)),'errors':_0x5de0af[_0x2e96aa(0x1fd)](_0x2e96aa(0x20a)),'role':_0x973dfc,'profile':_0x4117b1,'user':_0x476cb0,'stock':_0x58f65b,'master_shop':_0x3ee17b,'unit':_0x223ae2,'language':_0x36e4c1,'warehouses':_0x1df94e,'rooms':_0x9fa137,'warehouse_QA':_0x2d96aa});}catch(_0x4780f4){console[_0x2e96aa(0x25a)](_0x4780f4),_0x532994[_0x2e96aa(0x20e)](0xc8)[_0x2e96aa(0x22a)]({'message':_0x4780f4[_0x2e96aa(0x1ce)]});}}),router[a0_0x2ef59f(0x280)]('/view/return_sales/:id',auth,async(_0xfe491f,_0x54d8c1)=>{var _0x2f2e56=a0_0x2ef59f;if(_0xfe491f[_0x2f2e56(0x238)]['for_categorize']=='QA')try{const {invoice:_0x236fc8,date:_0x7a2f51,warehouse_name:_0x1d5d9e,product_name:_0x3cf4df,primary_code:_0x355646,secondary_code:_0x224adb,product_code:_0x359f31,sales_quantity:_0x336205,stocks:_0x2ae9d0,return_qty:_0x3cd2d4,Room_name:_0x2f5a6f,to_warehouse_name_QA:_0x344bad,to_Room_name_QA:_0x295957,note:_0x292de8,for_categorize:_0x13111c,product_name_QA1:_0x46e14c}=_0xfe491f[_0x2f2e56(0x238)];if(typeof _0x46e14c==_0x2f2e56(0x246))var _0x1e7b83=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x2c2)]],_0x1adaa0=[_0xfe491f[_0x2f2e56(0x238)]['primary_code_QA']],_0x371063=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x243)]],_0x1d25eb=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x2ab)]],_0x48139f=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1ed)]],_0x5b5a15=[_0xfe491f[_0x2f2e56(0x238)]['stocks_QA']],_0x36b4c0=[_0xfe491f['body'][_0x2f2e56(0x2d4)]],_0x581d22=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1d7)]],_0x3aff4d=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x2bd)]],_0xf66f74=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1c7)]],_0x308642=[_0xfe491f['body'][_0x2f2e56(0x231)]],_0x556b7f=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x293)]],_0x3d251f=[_0xfe491f[_0x2f2e56(0x238)]['production_date_QA']],_0x4976b2=[_0xfe491f['body'][_0x2f2e56(0x2bc)]];else var _0x1e7b83=[..._0xfe491f[_0x2f2e56(0x238)]['product_name_QA1']],_0x1adaa0=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1d6)]],_0x371063=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x243)]],_0x1d25eb=[..._0xfe491f['body'][_0x2f2e56(0x2ab)]],_0x48139f=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1ed)]],_0x5b5a15=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x21d)]],_0x36b4c0=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x2d4)]],_0x581d22=[..._0xfe491f['body'][_0x2f2e56(0x1d7)]],_0x3aff4d=[..._0xfe491f[_0x2f2e56(0x238)]['maxProducts_QA']],_0xf66f74=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1c7)]],_0x308642=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x231)]],_0x556b7f=[..._0xfe491f['body'][_0x2f2e56(0x293)]],_0x3d251f=[..._0xfe491f['body'][_0x2f2e56(0x225)]],_0x4976b2=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x2bc)]];const _0x5417fd=_0x1e7b83[_0x2f2e56(0x1fa)](_0x4abed5=>{return _0x4abed5={'product_name':_0x4abed5};});_0x1adaa0[_0x2f2e56(0x2d0)]((_0x31d26b,_0x1c463b)=>{var _0x272cb2=_0x2f2e56;_0x5417fd[_0x1c463b][_0x272cb2(0x29a)]=_0x31d26b;}),_0x371063[_0x2f2e56(0x2d0)]((_0x4d2104,_0xd3e0b)=>{var _0x2cd75e=_0x2f2e56;_0x5417fd[_0xd3e0b][_0x2cd75e(0x276)]=_0x4d2104;}),_0x1d25eb[_0x2f2e56(0x2d0)]((_0x4fac77,_0x2151b8)=>{var _0x35b2a1=_0x2f2e56;_0x5417fd[_0x2151b8][_0x35b2a1(0x21c)]=_0x4fac77;}),_0x48139f[_0x2f2e56(0x2d0)]((_0x5b6bbd,_0x38543e)=>{var _0x3fd767=_0x2f2e56;_0x5417fd[_0x38543e][_0x3fd767(0x1cb)]=_0x5b6bbd;}),_0x5b5a15[_0x2f2e56(0x2d0)]((_0x4a7f3e,_0x110ce1)=>{var _0x41c300=_0x2f2e56;_0x5417fd[_0x110ce1][_0x41c300(0x253)]=_0x4a7f3e;}),_0x36b4c0[_0x2f2e56(0x2d0)]((_0x1934a4,_0x7805bf)=>{var _0x4b3da0=_0x2f2e56;_0x5417fd[_0x7805bf][_0x4b3da0(0x1e7)]=_0x1934a4;}),_0x581d22[_0x2f2e56(0x2d0)]((_0x34388f,_0x4a30c5)=>{var _0x1f2465=_0x2f2e56;_0x5417fd[_0x4a30c5][_0x1f2465(0x201)]=_0x34388f;}),_0x3aff4d[_0x2f2e56(0x2d0)]((_0x3ece21,_0xe9b7d8)=>{var _0x17817e=_0x2f2e56;_0x5417fd[_0xe9b7d8][_0x17817e(0x1d5)]=_0x3ece21;}),_0xf66f74[_0x2f2e56(0x2d0)]((_0x40858a,_0xba8358)=>{_0x5417fd[_0xba8358]['batch_code']=_0x40858a;}),_0x308642[_0x2f2e56(0x2d0)]((_0x2567c2,_0x1eff42)=>{var _0x5a4707=_0x2f2e56;_0x5417fd[_0x1eff42][_0x5a4707(0x1d3)]=_0x2567c2;}),_0x556b7f[_0x2f2e56(0x2d0)]((_0x3d40ae,_0x3675a0)=>{var _0x2cad73=_0x2f2e56;_0x5417fd[_0x3675a0][_0x2cad73(0x265)]=_0x3d40ae;}),_0x3d251f['forEach']((_0x3a8c87,_0x5da6c2)=>{var _0x10e3e3=_0x2f2e56;_0x5417fd[_0x5da6c2][_0x10e3e3(0x219)]=_0x3a8c87;}),_0x4976b2[_0x2f2e56(0x2d0)]((_0x3187e6,_0x52a56b)=>{var _0x1e1433=_0x2f2e56;_0x5417fd[_0x52a56b][_0x1e1433(0x29e)]=_0x3187e6;});const _0x2d4633=await sales_finished[_0x2f2e56(0x263)]({'invoice':_0x236fc8});_0x2d4633[_0x2f2e56(0x25f)]=_0x2f2e56(0x1e1);const _0x47c71f=await _0x2d4633[_0x2f2e56(0x235)](),_0x5e5b67=new sales_return_finished({'invoice':_0x236fc8,'customer':_0xfe491f['body'][_0x2f2e56(0x1ea)],'date':_0x7a2f51,'warehouse_name':_0x1d5d9e,'room':_0x2f5a6f,'ToWarehouse':_0x344bad,'ToRoom':_0x295957,'return_sale_QA':_0x5417fd,'note':_0x292de8,'warehouse_cat':_0x13111c}),_0x383ac5=await _0x5e5b67[_0x2f2e56(0x235)](),_0x30d48c=await sales_return_finished[_0x2f2e56(0x263)]({'invoice':_0x236fc8}),_0x14918d=await warehouse[_0x2f2e56(0x263)]({'name':_0x344bad,'room':_0x295957});_0x30d48c[_0x2f2e56(0x1c6)][_0x2f2e56(0x2d0)](_0x2e178c=>{var _0x4065f5=_0x2f2e56,_0x3d869c=0x0;const _0x286a52=_0x14918d[_0x4065f5(0x209)][_0x4065f5(0x1fa)](_0x5e517=>{var _0x3833f0=_0x4065f5;_0x5e517['product_name']==_0x2e178c[_0x3833f0(0x2bf)]&&_0x5e517[_0x3833f0(0x29e)]==_0x2e178c[_0x3833f0(0x29e)]&&_0x5e517[_0x3833f0(0x219)]==_0x2e178c[_0x3833f0(0x219)]&&_0x5e517[_0x3833f0(0x2c0)]==_0x2e178c[_0x3833f0(0x2c0)]&&(_0x5e517['product_stock']=parseInt(_0x5e517[_0x3833f0(0x22e)])+parseInt(_0x2e178c[_0x3833f0(0x1e7)]),_0x3d869c++);});_0x3d869c=='0'&&(_0x14918d[_0x4065f5(0x209)]=_0x14918d[_0x4065f5(0x209)][_0x4065f5(0x1dd)]({'product_name':_0x2e178c[_0x4065f5(0x2bf)],'product_stock':_0x2e178c[_0x4065f5(0x1e7)],'primary_code':_0x2e178c[_0x4065f5(0x29a)],'secondary_code':_0x2e178c['secondary_code'],'product_code':_0x2e178c[_0x4065f5(0x21c)],'batch_code':_0x2e178c[_0x4065f5(0x2c0)],'maxPerUnit':_0x2e178c[_0x4065f5(0x201)],'production_date':_0x2e178c['production_date'],'expiry_date':_0x2e178c['expiry_date'],'secondary_unit':_0x2e178c[_0x4065f5(0x1d3)],'unit':_0x2e178c['unit'],'maxProducts':_0x2e178c['maxProducts'],'bay':_0x2e178c[_0x4065f5(0x2d5)]}));}),await _0x14918d[_0x2f2e56(0x235)]();const _0x4e66b8=new c_payment_data({'invoice':_0x236fc8,'customer':_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1ea)],'reason':_0x2f2e56(0x278)});await _0x4e66b8['save']();const _0x5215e5=await master_shop['find'](),_0x5aa785=await email_settings[_0x2f2e56(0x263)](),_0x41937a=await customer[_0x2f2e56(0x263)]({'name':_0xfe491f['body'][_0x2f2e56(0x1ea)]});_0x5215e5[0x0][_0x2f2e56(0x1d0)]==0x1?(right_currency=_0x5215e5[0x0][_0x2f2e56(0x2a6)],left_currency=''):(right_currency='',left_currency=_0x5215e5[0x0][_0x2f2e56(0x2a6)]);var _0xfb889a=_0x1e7b83,_0x132761=_0x36b4c0,_0x4e6739='',_0x216984;for(_0x216984 in _0xfb889a){_0x4e6739+='<tr>'+_0x2f2e56(0x239)+_0xfb889a[_0x216984]+_0x2f2e56(0x283)+_0x2f2e56(0x239)+_0x132761[_0x216984]+_0x2f2e56(0x283)+'</tr>';}console[_0x2f2e56(0x25a)](_0x2f2e56(0x2a3),_0x4e6739);let _0x3b1a4d=nodemailer[_0x2f2e56(0x251)]({'service':_0x2f2e56(0x242),'auth':{'user':_0x5aa785[_0x2f2e56(0x2d6)],'pass':_0x5aa785[_0x2f2e56(0x244)]}}),_0xeb8306={'from':_0x5aa785[_0x2f2e56(0x2d6)],'to':_0x41937a['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x2f2e56(0x2a5),'path':__dirname+'/../public'+'/upload/'+_0x5215e5[0x0][_0x2f2e56(0x23b)],'cid':_0x2f2e56(0x241)}],'html':_0x2f2e56(0x2d3)+_0x2f2e56(0x2a1)+_0x2f2e56(0x1f4)+_0x2f2e56(0x1f3)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2f2e56(0x1f3)+_0x2f2e56(0x26a)+'</div>'+_0x2f2e56(0x1f3)+_0x2f2e56(0x284)+_0x5215e5[0x0][_0x2f2e56(0x20b)]+_0x2f2e56(0x2c3)+_0x2f2e56(0x1fe)+_0x2f2e56(0x1fe)+_0x2f2e56(0x2cd)+_0x2f2e56(0x1f3)+_0x2f2e56(0x269)+'\x20Order\x20Number\x20:\x20'+_0x236fc8+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2f2e56(0x287)+_0x7a2f51+'\x20'+'</span>'+_0x2f2e56(0x221)+_0x2f2e56(0x1fe)+_0x2f2e56(0x23e)+_0x2f2e56(0x2ba)+_0x2f2e56(0x27f)+_0x2f2e56(0x2b9)+_0x2f2e56(0x20d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x2f2e56(0x211)+_0x2f2e56(0x218)+_0x2f2e56(0x2d1)+_0x2f2e56(0x27a)+'\x20'+_0x4e6739+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x2f2e56(0x232)+_0x2f2e56(0x299)+_0x5215e5[0x0][_0x2f2e56(0x20b)]+_0x2f2e56(0x221)+_0x2f2e56(0x1fe)+_0x2f2e56(0x1fe)+'</body></html>'};_0x3b1a4d[_0x2f2e56(0x213)](_0xeb8306,function(_0x4a26d3,_0x57e47e){var _0x38db8c=_0x2f2e56;_0x4a26d3?(console[_0x38db8c(0x25a)](_0x4a26d3),console[_0x38db8c(0x25a)](_0x38db8c(0x215))):console[_0x38db8c(0x25a)](_0x38db8c(0x2a7));}),_0xfe491f['flash'](_0x2f2e56(0x290),_0x2f2e56(0x1cf)),_0x54d8c1[_0x2f2e56(0x2be)](_0x2f2e56(0x262));}catch(_0x5534a3){_0x54d8c1['status'](0xc8)[_0x2f2e56(0x22a)]({'message1':_0x5534a3['message']});}else{if(_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x26d)]=='GS')try{const {invoice:_0x2dab17,date:_0x2acce1,warehouse_name:_0x27eea1,product_name:_0x4cf7b4,primary_code:_0x4b24ff,secondary_code:_0x5983bb,product_code:_0x4c0efc,sales_quantity:_0x3e75b3,stocks:_0x27335e,return_qty:_0x285e9f,Room_name:_0x4394c8,to_warehouse_name:_0x1c997e,to_Room_name:_0x4159f9,note:_0x552706,level:_0x470e75,isle:_0x41cffa,pallet:_0x171676,for_categorize:_0x49ba88}=_0xfe491f[_0x2f2e56(0x238)];if(typeof _0x4cf7b4=='string')var _0x1e7b83=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x2bf)]],_0x1adaa0=[_0xfe491f[_0x2f2e56(0x238)]['primary_code']],_0x371063=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x276)]],_0x1d25eb=[_0xfe491f['body'][_0x2f2e56(0x21c)]],_0x48139f=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x29d)]],_0x36b4c0=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1e7)]],_0x2648c7=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x2d5)]],_0x581d22=[_0xfe491f[_0x2f2e56(0x238)]['maxPerUnit']],_0x3aff4d=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1d5)]],_0xf66f74=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x2c0)]],_0x308642=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1d3)]],_0x556b7f=[_0xfe491f[_0x2f2e56(0x238)]['unit']],_0x3d251f=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x219)]],_0x4976b2=[_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x29e)]];else var _0x1e7b83=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x2bf)]],_0x1adaa0=[..._0xfe491f[_0x2f2e56(0x238)]['primary_code']],_0x371063=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x276)]],_0x1d25eb=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x21c)]],_0x48139f=[..._0xfe491f['body'][_0x2f2e56(0x29d)]],_0x36b4c0=[..._0xfe491f['body'][_0x2f2e56(0x1e7)]],_0x2648c7=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x2d5)]],_0x581d22=[..._0xfe491f['body'][_0x2f2e56(0x201)]],_0x3aff4d=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1d5)]],_0xf66f74=[..._0xfe491f[_0x2f2e56(0x238)]['batch_code']],_0x308642=[..._0xfe491f['body']['secondary_unit']],_0x556b7f=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x265)]],_0x3d251f=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x219)]],_0x4976b2=[..._0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x29e)]];const _0x570cf3=_0x1e7b83['map'](_0x229da6=>{return _0x229da6={'product_name':_0x229da6};});_0x1adaa0[_0x2f2e56(0x2d0)]((_0x663972,_0x17a1a7)=>{var _0x48a323=_0x2f2e56;_0x570cf3[_0x17a1a7][_0x48a323(0x29a)]=_0x663972;}),_0x371063[_0x2f2e56(0x2d0)]((_0x1e363a,_0x22e12a)=>{var _0x420bda=_0x2f2e56;_0x570cf3[_0x22e12a][_0x420bda(0x276)]=_0x1e363a;}),_0x1d25eb[_0x2f2e56(0x2d0)]((_0x991a1e,_0x32139c)=>{var _0x2e12aa=_0x2f2e56;_0x570cf3[_0x32139c][_0x2e12aa(0x21c)]=_0x991a1e;}),_0x48139f[_0x2f2e56(0x2d0)]((_0x5393a3,_0x3d2dfb)=>{_0x570cf3[_0x3d2dfb]['sale_qty']=_0x5393a3;}),_0x36b4c0['forEach']((_0x5bb08e,_0x4f4971)=>{var _0x147cd1=_0x2f2e56;_0x570cf3[_0x4f4971][_0x147cd1(0x1e7)]=_0x5bb08e;}),_0x2648c7[_0x2f2e56(0x2d0)]((_0x3452df,_0x4e9f5a)=>{var _0x5d4836=_0x2f2e56;_0x570cf3[_0x4e9f5a][_0x5d4836(0x2d5)]=_0x3452df;}),_0x581d22[_0x2f2e56(0x2d0)]((_0x59b68b,_0x2f4bd8)=>{_0x570cf3[_0x2f4bd8]['maxPerUnit']=_0x59b68b;}),_0x3aff4d[_0x2f2e56(0x2d0)]((_0x5c65ba,_0x5530ab)=>{_0x570cf3[_0x5530ab]['maxProducts']=_0x5c65ba;}),_0xf66f74[_0x2f2e56(0x2d0)]((_0x4b28a8,_0x385151)=>{var _0x4e08bc=_0x2f2e56;_0x570cf3[_0x385151][_0x4e08bc(0x2c0)]=_0x4b28a8;}),_0x308642[_0x2f2e56(0x2d0)]((_0x277860,_0x3c437b)=>{var _0x216ab4=_0x2f2e56;_0x570cf3[_0x3c437b][_0x216ab4(0x1d3)]=_0x277860;}),_0x556b7f['forEach']((_0x5c7564,_0x129432)=>{var _0x577ae0=_0x2f2e56;_0x570cf3[_0x129432][_0x577ae0(0x265)]=_0x5c7564;}),_0x3d251f[_0x2f2e56(0x2d0)]((_0x17cb92,_0x2e62d1)=>{_0x570cf3[_0x2e62d1]['production_date']=_0x17cb92;}),_0x4976b2['forEach']((_0x5f57ba,_0x5a2af2)=>{var _0x187c2d=_0x2f2e56;_0x570cf3[_0x5a2af2][_0x187c2d(0x29e)]=_0x5f57ba;});var _0x430cdd=0x0;_0x570cf3[_0x2f2e56(0x2d0)](_0x4179dd=>{var _0x2d8613=_0x2f2e56;(parseInt(_0x4179dd[_0x2d8613(0x1cb)])<parseInt(_0x4179dd[_0x2d8613(0x1e7)])||parseInt(_0x4179dd[_0x2d8613(0x253)])<parseInt(_0x4179dd[_0x2d8613(0x1e7)])&&parseInt(_0x4179dd[_0x2d8613(0x1cb)])>parseInt(_0x4179dd['return_qty'])||parseInt(_0x4179dd[_0x2d8613(0x1e7)])==0x0)&&_0x430cdd++;});if(_0x430cdd!=0x0)return _0xfe491f[_0x2f2e56(0x1fd)](_0x2f2e56(0x20a),_0x2f2e56(0x1e3)),_0x54d8c1[_0x2f2e56(0x2be)]('back');const _0x2e5368=await sales_finished['findOne']({'invoice':_0x2dab17});_0x2e5368[_0x2f2e56(0x25f)]=_0x2f2e56(0x1e1);const _0x4faa68=await _0x2e5368[_0x2f2e56(0x235)](),_0x5649e6=new sales_return_finished({'invoice':_0x2dab17,'customer':_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1ea)],'date':_0x2acce1,'warehouse_name':_0x27eea1,'room':_0x4394c8,'ToWarehouse':_0x1c997e,'ToRoom':_0x4159f9,'return_sale':_0x570cf3,'note':_0x552706,'warehouse_cat':_0x49ba88}),_0x26d1ad=await _0x5649e6[_0x2f2e56(0x235)](),_0x42b6e1=await sales_return_finished[_0x2f2e56(0x263)]({'invoice':_0x2dab17}),_0x58633e=await warehouse['findOne']({'name':_0x1c997e,'room':_0x4159f9,'warehouse_category':_0x2f2e56(0x2c9)});_0x42b6e1[_0x2f2e56(0x27b)][_0x2f2e56(0x2d0)](_0x258761=>{var _0x5e38fc=_0x2f2e56,_0x4bef7e=0x0;const _0x1b866d=_0x58633e[_0x5e38fc(0x209)][_0x5e38fc(0x1fa)](_0x35d352=>{var _0x2a3004=_0x5e38fc;_0x35d352[_0x2a3004(0x2bf)]==_0x258761[_0x2a3004(0x2bf)]&&_0x35d352['bay']==_0x258761[_0x2a3004(0x2d5)]&&_0x35d352['expiry_date']==_0x258761[_0x2a3004(0x29e)]&&_0x35d352[_0x2a3004(0x219)]==_0x258761[_0x2a3004(0x219)]&&_0x35d352[_0x2a3004(0x2c0)]==_0x258761[_0x2a3004(0x2c0)]&&(_0x35d352[_0x2a3004(0x22e)]=parseInt(_0x35d352['product_stock'])+parseInt(_0x258761['return_qty']),_0x4bef7e++);});_0x4bef7e=='0'&&(_0x58633e[_0x5e38fc(0x209)]=_0x58633e['product_details']['concat']({'product_name':_0x258761[_0x5e38fc(0x2bf)],'product_stock':_0x258761[_0x5e38fc(0x1e7)],'primary_code':_0x258761[_0x5e38fc(0x29a)],'secondary_code':_0x258761[_0x5e38fc(0x276)],'product_code':_0x258761[_0x5e38fc(0x21c)],'bay':_0x258761['bay'],'batch_code':_0x258761[_0x5e38fc(0x2c0)],'maxPerUnit':_0x258761[_0x5e38fc(0x201)],'production_date':_0x258761['production_date'],'expiry_date':_0x258761[_0x5e38fc(0x29e)],'secondary_unit':_0x258761[_0x5e38fc(0x1d3)],'unit':_0x258761[_0x5e38fc(0x265)],'maxProducts':_0x258761['maxProducts']}));}),await _0x58633e[_0x2f2e56(0x235)](),console[_0x2f2e56(0x25a)](_0xfe491f['body']);const _0x96fdea=new c_payment_data({'invoice':_0x2dab17,'customer':_0xfe491f[_0x2f2e56(0x238)][_0x2f2e56(0x1ea)],'reason':'Sale\x20Return'});await _0x96fdea[_0x2f2e56(0x235)]();const _0x3cd8b7=await master_shop[_0x2f2e56(0x279)]();console[_0x2f2e56(0x25a)](_0x2f2e56(0x2c5),_0x3cd8b7[0x0][_0x2f2e56(0x23b)]);const _0x5cdc16=await email_settings['findOne'](),_0x4860b8=await customer['findOne']({'name':_0xfe491f['body'][_0x2f2e56(0x1ea)]});console['log'](_0x2f2e56(0x1e9),_0x4860b8);_0x3cd8b7[0x0][_0x2f2e56(0x1d0)]==0x1?(right_currency=_0x3cd8b7[0x0][_0x2f2e56(0x2a6)],left_currency=''):(right_currency='',left_currency=_0x3cd8b7[0x0]['currency']);var _0xfb889a=_0x1e7b83,_0x132761=_0x36b4c0,_0x4e6739='',_0x216984;for(_0x216984 in _0xfb889a){_0x4e6739+=_0x2f2e56(0x27f)+_0x2f2e56(0x239)+_0xfb889a[_0x216984]+_0x2f2e56(0x283)+_0x2f2e56(0x239)+_0x132761[_0x216984]+_0x2f2e56(0x283)+_0x2f2e56(0x218);}console[_0x2f2e56(0x25a)](_0x2f2e56(0x2a3),_0x4e6739);let _0x3e6fdf=nodemailer[_0x2f2e56(0x251)]({'service':_0x2f2e56(0x242),'auth':{'user':_0x5cdc16[_0x2f2e56(0x2d6)],'pass':_0x5cdc16['password']}}),_0x3c80ce={'from':_0x5cdc16[_0x2f2e56(0x2d6)],'to':_0x4860b8['email'],'subject':_0x2f2e56(0x20c),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2f2e56(0x2aa)+_0x2f2e56(0x226)+_0x3cd8b7[0x0][_0x2f2e56(0x23b)],'cid':_0x2f2e56(0x241)}],'html':_0x2f2e56(0x2d3)+_0x2f2e56(0x2a1)+'</head><body>'+'<div>'+_0x2f2e56(0x1c9)+_0x2f2e56(0x1f3)+_0x2f2e56(0x26a)+_0x2f2e56(0x1fe)+_0x2f2e56(0x1f3)+_0x2f2e56(0x284)+_0x3cd8b7[0x0]['site_title']+_0x2f2e56(0x2c3)+_0x2f2e56(0x1fe)+_0x2f2e56(0x1fe)+_0x2f2e56(0x2cd)+'<div>'+_0x2f2e56(0x269)+'\x20Order\x20Number\x20:\x20'+_0x2dab17+'\x20'+_0x2f2e56(0x1e6)+_0x2f2e56(0x287)+_0x2acce1+'\x20'+_0x2f2e56(0x1c3)+_0x2f2e56(0x221)+_0x2f2e56(0x1fe)+_0x2f2e56(0x23e)+_0x2f2e56(0x2ba)+_0x2f2e56(0x27f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x2f2e56(0x1cd)+_0x2f2e56(0x211)+_0x2f2e56(0x218)+_0x2f2e56(0x2d1)+_0x2f2e56(0x27a)+'\x20'+_0x4e6739+'\x20'+_0x2f2e56(0x202)+_0x2f2e56(0x228)+_0x2f2e56(0x1f3)+_0x2f2e56(0x232)+_0x2f2e56(0x299)+_0x3cd8b7[0x0][_0x2f2e56(0x20b)]+_0x2f2e56(0x221)+_0x2f2e56(0x1fe)+_0x2f2e56(0x1fe)+_0x2f2e56(0x24a)};_0x3e6fdf[_0x2f2e56(0x213)](_0x3c80ce,function(_0x553468,_0x1162c2){var _0x169682=_0x2f2e56;_0x553468?(console[_0x169682(0x25a)](_0x553468),console[_0x169682(0x25a)](_0x169682(0x215))):console[_0x169682(0x25a)](_0x169682(0x2a7));}),_0xfe491f[_0x2f2e56(0x1fd)](_0x2f2e56(0x290),_0x2f2e56(0x1cf)),_0x54d8c1[_0x2f2e56(0x2be)](_0x2f2e56(0x262));}catch(_0x33f214){console['log'](_0x33f214),_0x54d8c1['status'](0xc8)[_0x2f2e56(0x22a)]({'message1':_0x33f214[_0x2f2e56(0x1ce)]});}}}),router['get'](a0_0x2ef59f(0x1e5),auth,async(_0x3b018c,_0x47d416)=>{var _0x17f85e=a0_0x2ef59f;try{const {username:_0x45774d,email:_0x263fde,role:_0x16418c}=_0x3b018c['user'],_0xaad983=_0x3b018c[_0x17f85e(0x256)],_0x3b6f26=await profile[_0x17f85e(0x263)]({'email':_0xaad983[_0x17f85e(0x2d6)]}),_0x362a46=await master_shop[_0x17f85e(0x279)]();console[_0x17f85e(0x25a)](_0x17f85e(0x1f2),_0x362a46);const _0x241272=_0x3b018c[_0x17f85e(0x285)]['id'],_0x11cf24=await sales[_0x17f85e(0x237)](_0x241272);console[_0x17f85e(0x25a)](_0x17f85e(0x26f),_0x11cf24);if(_0x362a46[0x0][_0x17f85e(0x1f8)]==_0x17f85e(0x1c2))var _0xb0fec4=users['English'];else{if(_0x362a46[0x0][_0x17f85e(0x1f8)]==_0x17f85e(0x234))var _0xb0fec4=users['Hindi'];else{if(_0x362a46[0x0][_0x17f85e(0x1f8)]=='German')var _0xb0fec4=users[_0x17f85e(0x26b)];else{if(_0x362a46[0x0]['language']=='Spanish')var _0xb0fec4=users[_0x17f85e(0x1ec)];else{if(_0x362a46[0x0][_0x17f85e(0x1f8)]=='French')var _0xb0fec4=users[_0x17f85e(0x2c6)];else{if(_0x362a46[0x0][_0x17f85e(0x1f8)]==_0x17f85e(0x273))var _0xb0fec4=users['Portuguese'];else{if(_0x362a46[0x0]['language']==_0x17f85e(0x2ac))var _0xb0fec4=users[_0x17f85e(0x2ac)];else{if(_0x362a46[0x0][_0x17f85e(0x1f8)]==_0x17f85e(0x227))var _0xb0fec4=users[_0x17f85e(0x2ca)];}}}}}}}_0x47d416[_0x17f85e(0x258)]('all_sales_barcode',{'success':_0x3b018c[_0x17f85e(0x1fd)](_0x17f85e(0x290)),'errors':_0x3b018c[_0x17f85e(0x1fd)](_0x17f85e(0x20a)),'role':_0xaad983,'profile':_0x3b6f26,'alldata':_0x11cf24,'master_shop':_0x362a46,'language':_0xb0fec4});}catch(_0x50dbf9){console[_0x17f85e(0x25a)](_0x50dbf9);}}),router['post']('/barcode_scanner',async(_0x26e6a2,_0x2cf157)=>{var _0x30a578=a0_0x2ef59f;const {product_code:_0x474c6a,warehouse_name:_0x5711cd,rooms_data:_0x19f786,Roomslist:_0x5f05a6}=_0x26e6a2[_0x30a578(0x238)],_0x3d1627=_0x5f05a6[_0x30a578(0x2af)](','),_0x45b210=[];async function _0x5ef7da(_0x28a898){var _0x531233=_0x30a578;const _0x477bcc=await warehouse[_0x531233(0x1e0)]([{'$match':{'name':_0x5711cd,'room':_0x28a898}},{'$unwind':_0x531233(0x2c8)},{'$match':{'product_details.primary_code':_0x474c6a}},{'$group':{'_id':_0x531233(0x236),'name':{'$first':_0x531233(0x2a8)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x531233(0x210)},'secondary_code':{'$first':_0x531233(0x22f)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x531233(0x270)},'isle':{'$first':_0x531233(0x2bb)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x531233(0x1cc)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x531233(0x26e)},'storage':{'$first':_0x531233(0x1da)},'rack':{'$first':_0x531233(0x1f7)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x531233(0x1de)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x531233(0x259)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x531233(0x1fb)},'invoice':{'$first':_0x531233(0x240)}}}]),_0x4d7fd=await warehouse[_0x531233(0x1e0)]([{'$match':{'name':_0x5711cd,'room':_0x28a898}},{'$unwind':_0x531233(0x2c8)},{'$match':{'product_details.secondary_code':_0x474c6a}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x531233(0x26c)},'primary_code':{'$first':_0x531233(0x210)},'secondary_code':{'$first':_0x531233(0x22f)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x531233(0x270)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x531233(0x1d4)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x531233(0x220)},'secondary_unit':{'$first':_0x531233(0x26e)},'storage':{'$first':_0x531233(0x1da)},'rack':{'$first':_0x531233(0x1f7)},'expiry_date':{'$first':_0x531233(0x291)},'production_date':{'$first':_0x531233(0x275)},'maxPerUnit':{'$first':_0x531233(0x1de)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x531233(0x259)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x531233(0x1fb)},'invoice':{'$first':_0x531233(0x240)}}}]);if(_0x477bcc[_0x531233(0x2b4)]>0x0)_0x45b210[_0x531233(0x1f6)](_0x477bcc);else _0x4d7fd[_0x531233(0x2b4)]>0x0&&_0x45b210['push'](_0x4d7fd);}const _0x2f1aee=_0x3d1627[_0x30a578(0x1fa)](_0x9166e3=>_0x5ef7da(_0x9166e3));await Promise[_0x30a578(0x1f0)](_0x2f1aee),_0x2cf157[_0x30a578(0x22a)](_0x45b210);}),module[a0_0x2ef59f(0x1c8)]=router;