var a0_0x4254df=a0_0x549a;function a0_0x2179(){var _0x83fc07=['32ZKkGXU','suppliers','$name','product_details','$room','message','expiry_date_QA','\x20Order\x20Date\x20:\x20','purchases_data','$product_details.invoice','random','sales_quantity','\x20</h2>','1631333pOalhi','product','$sale_product.bin','product_code','product_stock','Quality\x20Inspection','secondary_unit','aggregate','abs','$invoice','staff','English\x20(US)','$product_details.production_date','unit_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','</tbody>','Sales\x20Add\x20successfully','warehouse','<!DOCTYPE\x20html>','batch_code_QA','<html><head><title></title>','$product','$warehouse_name','Chinese','warehouse_name','</div>','id_transaction_from','$sale_product.type','findById','user','Ambient','product_data','production_date_QA','$product_details._id','There\x27s\x20a\x20error\x20in\x20this\x20transaction','email','maxPerUnit_QA','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','QA\x20Warehouse','Email\x20sent\x20successfully','14348wMksRt','product_code_QA','prod_cat','render','room','<tbody\x20style=\x22text-align:\x20center;\x22>','5384580pYKObq','product_name_QA1','<div>','$product_details.bin','return_qty','<hr\x20class=\x22my-3\x22>','$product_details.expiry_date','stock','</body></html>','$product_details.unit','edit_sales_finished','secondary_code_QA','$sale_product','maxProducts_QA','<strong>\x20Regards\x20</strong>','return_data','return_sale_finished','get','Enclosed','back','payment\x20successfull','FGSEmail','currency_placement','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','find','/../public','<table\x20style=\x22width:\x20100%\x20!important;\x22>','logo','Portuguese','success','Sales\x20Update\x20successfully','/barcode_scanner','/barcode/:id','edit_sales_finished_view','name','error','$product_details.product_name','/view/:id','map','\x20==\x20','adjust_qty','maxPerUnit','../middleware/auth','Return\x20Goods','</h5>','bay','primary_code','level','length','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/all_sales_finished/view','<span\x20style=\x22float:\x20right;\x22>','concat','redirect','due_amount','</thead>','prod_invoice','/invoice/:id','</span>','$product_details.primary_code','<h5>','errors','\x20>>>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/all_sales_finished/preview/','Error\x20Occurs','Sale','</table>','English','quantity','prod_code','520ajaNMt','9NCqKUE','all','$product_details.storage','$product_details.product_stock','json','/picking_list/pdf/','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','customer_data','<h5\x20style=\x22text-align:\x20left;\x22>','/all_sales/view','$product_details.floorlevel','Finished\x20Goods','sale_qty','toString','then','floor','$product_details.maxPerUnit','/view/add_sale/product','Arabic','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','amount','857416mgamUN','Sale\x20Return\x20Mail','sendMail','An\x20error\x20occurred\x20while\x20saving\x20data.','/view/add_sales/:id','return_sale','/view/add_sales','product_list','$sale_product.quantity','password','OUTF-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','master','host','217858kCPYFw','gmail','sales_invoice','$finalize','$note','$customer','stock_data','port','$product_details.product_code','customer','currency','unit','Spanish','status','Sale\x20Return','batch_code','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','sale_product','ADD\x20SALE','slice','RoomAssigned','An\x20error\x20occurred.','post','French','push','received_amount','note','finalize','sales\x20item\x20return\x20successfull','findOne','$product_details.secondary_unit','<tr>','/upload/','Enabled','createTransport','expiry_date','True','forEach','return_qty_QA','$customers_docs','barcode\x20Product\x20master','$_id','site_title','stocks_QA','primary_unit','maxperunit','German','body','customers_docs','product_date','$product_details.type','$product_details.batch_code','</head><body>','production_date','role','product_name','\x20&&\x20','customers','</td>','save','getDate','15nxixOw','filter','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$return_data','5695240QPYmBx','all_sales_barcode','<h2>\x20','$product_details.secondary_code','primary_code_QA','add\x20post','115626jOwmQr','/preview/:id','for_categorize','False','$product_details.room_name','flash','params','invoice','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.rack','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','carton','language','$product_details','date','Hindi','nodemailer','maxProducts','Portuguese\x20(BR)','return_sale_QA','max_per_unit','image','</tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.bay','$date','christian.villamer@jakagroup.com','secondary_unit_QA','_id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Arabic\x20(ae)','log','$sale_product.bay','/view/return_sales/:id','string','$product_details.product_cat'];a0_0x2179=function(){return _0x83fc07;};return a0_0x2179();}function a0_0x549a(_0x493a1f,_0x21e6ec){var _0x2179ed=a0_0x2179();return a0_0x549a=function(_0x549a4d,_0xa16acd){_0x549a4d=_0x549a4d-0xda;var _0x5a6018=_0x2179ed[_0x549a4d];return _0x5a6018;},a0_0x549a(_0x493a1f,_0x21e6ec);}(function(_0x497ae5,_0x3409d8){var _0x4fa2f1=a0_0x549a,_0xe0c8e5=_0x497ae5();while(!![]){try{var _0x322d7a=-parseInt(_0x4fa2f1(0x1a4))/0x1+parseInt(_0x4fa2f1(0x1b2))/0x2*(-parseInt(_0x4fa2f1(0x1ef))/0x3)+-parseInt(_0x4fa2f1(0x13d))/0x4*(-parseInt(_0x4fa2f1(0x18e))/0x5)+parseInt(_0x4fa2f1(0x143))/0x6+-parseInt(_0x4fa2f1(0xe1))/0x7*(parseInt(_0x4fa2f1(0x107))/0x8)+parseInt(_0x4fa2f1(0x18f))/0x9*(parseInt(_0x4fa2f1(0xdb))/0xa)+parseInt(_0x4fa2f1(0x114))/0xb;if(_0x322d7a===_0x3409d8)break;else _0xe0c8e5['push'](_0xe0c8e5['shift']());}catch(_0x4ab56b){_0xe0c8e5['push'](_0xe0c8e5['shift']());}}}(a0_0x2179,0x7efec));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x4254df(0x177)),auth=require(a0_0x4254df(0x170)),nodemailer=require(a0_0x4254df(0xf3)),users=require('../public/language/languages.json');router[a0_0x4254df(0x154)]('/view',auth,async(_0xee67f,_0x36fdf6)=>{var _0x3c5063=a0_0x4254df;try{const {username:_0x2668ab,email:_0x45a13a,role:_0x4b6a90}=_0xee67f['user'],_0x4260f4=_0xee67f[_0x3c5063(0x132)],_0x527ad3=await profile['findOne']({'email':_0x4260f4['email']}),_0x4feb5b=await master_shop['find']();let _0x5dc0b8;if(_0x4260f4[_0x3c5063(0x1e8)]=='staff'){const _0x459e08=await staff[_0x3c5063(0x1cf)]({'email':_0x4260f4[_0x3c5063(0x138)]});_0x5dc0b8=await sales_finished[_0x3c5063(0x11b)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':'name','as':'customers_docs'}},{'$unwind':_0x3c5063(0x1d9)},{'$unwind':_0x3c5063(0x14f)},{'$group':{'_id':_0x3c5063(0x1db),'invoice':{'$first':_0x3c5063(0x11d)},'customers':{'$first':_0x3c5063(0x1b7)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3c5063(0x12b)},'sale_product':{'$push':_0x3c5063(0x14f)},'note':{'$first':_0x3c5063(0x1b6)},'return_data':{'$first':_0x3c5063(0xda)},'customers_docs':{'$first':_0x3c5063(0x1d9)},'total_saleproduct_quantity':{'$sum':_0x3c5063(0x1ac)},'level':{'$addToSet':_0x3c5063(0x103)},'isle':{'$addToSet':_0x3c5063(0x116)},'type':{'$addToSet':_0x3c5063(0x130)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3c5063(0x1b5)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x5dc0b8=await sales_finished['aggregate']([{'$lookup':{'from':_0x3c5063(0x1eb),'localField':_0x3c5063(0x1bb),'foreignField':_0x3c5063(0x168),'as':_0x3c5063(0x1e2)}},{'$unwind':_0x3c5063(0x1d9)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x3c5063(0x1db),'invoice':{'$first':_0x3c5063(0x11d)},'customers':{'$first':_0x3c5063(0x1b7)},'date':{'$first':_0x3c5063(0xfc)},'warehouse_name':{'$first':_0x3c5063(0x12b)},'sale_product':{'$push':_0x3c5063(0x14f)},'note':{'$first':_0x3c5063(0x1b6)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x3c5063(0x1d9)},'total_saleproduct_quantity':{'$sum':_0x3c5063(0x1ac)},'level':{'$addToSet':_0x3c5063(0x103)},'isle':{'$addToSet':_0x3c5063(0x116)},'type':{'$addToSet':_0x3c5063(0x130)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3c5063(0x1b5)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x4feb5b[0x0][_0x3c5063(0xef)]==_0x3c5063(0x11f)){var _0x37546e=users[_0x3c5063(0x18b)];console['log'](_0x37546e);}else{if(_0x4feb5b[0x0][_0x3c5063(0xef)]==_0x3c5063(0xf2))var _0x37546e=users[_0x3c5063(0xf2)];else{if(_0x4feb5b[0x0][_0x3c5063(0xef)]==_0x3c5063(0x1e0))var _0x37546e=users['German'];else{if(_0x4feb5b[0x0]['language']=='Spanish')var _0x37546e=users[_0x3c5063(0x1be)];else{if(_0x4feb5b[0x0]['language']=='French')var _0x37546e=users[_0x3c5063(0x1c9)];else{if(_0x4feb5b[0x0][_0x3c5063(0xef)]==_0x3c5063(0xf5))var _0x37546e=users[_0x3c5063(0x162)];else{if(_0x4feb5b[0x0][_0x3c5063(0xef)]==_0x3c5063(0x12c))var _0x37546e=users[_0x3c5063(0x12c)];else{if(_0x4feb5b[0x0][_0x3c5063(0xef)]==_0x3c5063(0x101))var _0x37546e=users[_0x3c5063(0x1a1)];}}}}}}}_0x36fdf6[_0x3c5063(0x140)]('all_sales_finished',{'success':_0xee67f[_0x3c5063(0xe6)](_0x3c5063(0x163)),'errors':_0xee67f[_0x3c5063(0xe6)](_0x3c5063(0x184)),'sales':_0x5dc0b8,'profile':_0x527ad3,'role':_0x4260f4,'master_shop':_0x4feb5b,'language':_0x37546e});}catch(_0x47f1cd){console[_0x3c5063(0x102)](_0x47f1cd);}});async function getRandom8DigitNumber(){var _0x2ca145=a0_0x4254df;const _0x4a3214=0x989680,_0x557e7f=0x5f5e0ff,_0x2d3af8=Math[_0x2ca145(0x19e)](Math[_0x2ca145(0x111)]()*(_0x557e7f-_0x4a3214+0x1))+_0x4a3214;var _0x438119;const _0x5f4c9f=await sales_finished['findOne']({'invoice':_0x2ca145(0x1ae)+_0x2d3af8});return _0x5f4c9f&&_0x5f4c9f[_0x2ca145(0x176)]>0x0?_0x438119=_0x2ca145(0x1ae)+_0x2d3af8:_0x438119=_0x2ca145(0x1ae)+_0x2d3af8,_0x438119;}router[a0_0x4254df(0x154)](a0_0x4254df(0x1aa),auth,async(_0x45c6c5,_0x39743b)=>{var _0x11fabb=a0_0x4254df;try{const {username:_0x2b93be,email:_0x1071e5,role:_0x100ec3}=_0x45c6c5[_0x11fabb(0x132)],_0x1f0f30=_0x45c6c5[_0x11fabb(0x132)],_0x22d734=await profile[_0x11fabb(0x1cf)]({'email':_0x1f0f30[_0x11fabb(0x138)]}),_0x313c50=await master_shop['find'](),_0x387b4d=await customer[_0x11fabb(0x15e)]({});let _0xca2c94;if(_0x1f0f30[_0x11fabb(0x1e8)]==_0x11fabb(0x11e)){const _0x3d0557=await staff['findOne']({'email':_0x1f0f30[_0x11fabb(0x138)]});_0xca2c94=await warehouse['aggregate']([{'$match':{'status':_0x11fabb(0x1d3),'name':_0x3d0557[_0x11fabb(0x126)],'warehouse_category':_0x11fabb(0x19a),'name':{'$ne':_0x11fabb(0x13b)}}},{'$group':{'_id':_0x11fabb(0x109),'name':{'$first':_0x11fabb(0x109)}}},{'$sort':{'name':0x1}}]);}else _0xca2c94=await warehouse[_0x11fabb(0x11b)]([{'$match':{'status':_0x11fabb(0x1d3),'warehouse_category':_0x11fabb(0x19a),'name':{'$ne':_0x11fabb(0x13b)}}},{'$group':{'_id':'$name','name':{'$first':_0x11fabb(0x109)}}},{'$sort':{'name':0x1}}]);const _0x1b0835=await product[_0x11fabb(0x15e)]({});var _0x575ac8=[_0x11fabb(0x133),'Enclosed'];const _0xf44b0a=await sales_finished[_0x11fabb(0x15e)]({}),_0x5ac88b=_0xf44b0a[_0x11fabb(0x176)]+0x1,_0x46a640=_0x11fabb(0x1ae)+_0x5ac88b[_0x11fabb(0x19c)]()['padStart'](0x5,'0');if(_0x313c50[0x0][_0x11fabb(0xef)]==_0x11fabb(0x11f)){var _0x23ca4b=users['English'];console[_0x11fabb(0x102)](_0x23ca4b);}else{if(_0x313c50[0x0][_0x11fabb(0xef)]==_0x11fabb(0xf2))var _0x23ca4b=users[_0x11fabb(0xf2)];else{if(_0x313c50[0x0][_0x11fabb(0xef)]==_0x11fabb(0x1e0))var _0x23ca4b=users[_0x11fabb(0x1e0)];else{if(_0x313c50[0x0][_0x11fabb(0xef)]=='Spanish')var _0x23ca4b=users[_0x11fabb(0x1be)];else{if(_0x313c50[0x0]['language']==_0x11fabb(0x1c9))var _0x23ca4b=users[_0x11fabb(0x1c9)];else{if(_0x313c50[0x0][_0x11fabb(0xef)]=='Portuguese\x20(BR)')var _0x23ca4b=users[_0x11fabb(0x162)];else{if(_0x313c50[0x0][_0x11fabb(0xef)]==_0x11fabb(0x12c))var _0x23ca4b=users[_0x11fabb(0x12c)];else{if(_0x313c50[0x0][_0x11fabb(0xef)]==_0x11fabb(0x101))var _0x23ca4b=users[_0x11fabb(0x1a1)];}}}}}}}const _0x225651=getRandom8DigitNumber();_0x225651[_0x11fabb(0x19d)](_0x27fc4a=>{var _0x45249d=_0x11fabb;_0x39743b['render']('add_sales_finished',{'success':_0x45c6c5[_0x45249d(0xe6)]('success'),'errors':_0x45c6c5[_0x45249d(0xe6)]('errors'),'role':_0x1f0f30,'profile':_0x22d734,'customer':_0x387b4d,'warehouse':_0xca2c94,'product':_0x1b0835,'invoice':_0x27fc4a,'master_shop':_0x313c50,'language':_0x23ca4b,'rooms_data':_0x575ac8});})['catch'](_0x2abeff=>{var _0x54c33e=_0x11fabb;_0x45c6c5[_0x54c33e(0xe6)](_0x54c33e(0x184),_0x54c33e(0x137)),_0x39743b[_0x54c33e(0x17c)](_0x54c33e(0x179));});}catch(_0x164712){console[_0x11fabb(0x102)](_0x164712);}}),router[a0_0x4254df(0x154)](a0_0x4254df(0x1a8),auth,async(_0x700ba3,_0x328fb4)=>{var _0x1f13e8=a0_0x4254df;try{const _0x2a46ba=_0x700ba3[_0x1f13e8(0xe7)]['id'];console[_0x1f13e8(0x102)](_0x2a46ba);const _0x485e5a=await product['find'](),_0x1ecd1d=await purchases['aggregate']([{'$match':{'warehouse_name':_0x2a46ba}},{'$unwind':_0x1f13e8(0x12a)},{'$group':{'_id':'$product.product_name'}}]);console[_0x1f13e8(0x102)](_0x1f13e8(0x10f),_0x1ecd1d),_0x328fb4[_0x1f13e8(0x1bf)](0xc8)[_0x1f13e8(0x193)]({'purchases_data':_0x1ecd1d,'product_data':_0x485e5a});}catch(_0x3c2fcd){console[_0x1f13e8(0x102)](_0x3c2fcd);}}),router['post'](a0_0x4254df(0x1a0),auth,async(_0xc6cdc7,_0x308836)=>{var _0x45318c=a0_0x4254df;try{const {warehouse_data:_0x18ab04,product_data:_0x30abfc}=_0xc6cdc7[_0x45318c(0x1e1)];console[_0x45318c(0x102)](_0xc6cdc7['body'][_0x45318c(0x134)]);;const _0x43547c=await master_shop[_0x45318c(0x15e)]();console[_0x45318c(0x102)]('master',_0x43547c);const _0x351b0d=await product[_0x45318c(0x1cf)]({'name':_0x30abfc});console[_0x45318c(0x102)](_0x45318c(0x115),_0x351b0d);const _0x18e9c7=await warehouse[_0x45318c(0x11b)]([{'$match':{'name':_0x18ab04}},{'$unwind':_0x45318c(0xf0)},{'$match':{'product_details.product_name':_0x30abfc}},{'$group':{'_id':_0x45318c(0x16a),'product_stock':{'$first':_0x45318c(0x192)}}}]);console[_0x45318c(0x102)](_0x45318c(0x1b8),_0x18e9c7),_0x308836[_0x45318c(0x1bf)](0xc8)[_0x45318c(0x193)]({'master':_0x43547c,'new_product':_0x351b0d,'stock_data':_0x18e9c7});}catch(_0x568946){console[_0x45318c(0x102)](_0x568946);}}),router[a0_0x4254df(0x1c8)](a0_0x4254df(0x1aa),auth,async(_0x3172fe,_0x432abd)=>{var _0x21d4f9=a0_0x4254df;try{const {invoice:_0x50c789,date:_0x21c90c,warehouse_name:_0x544629,product_name:_0x4a85e7,stock:_0x15e0ba,quantity:_0x1a6466,note:_0x378a29,room:_0x5dc253,primary_code:_0x496f9e,secondary_code:_0x2b3c8f,prod_code:_0x2b66ed,level:_0x305dba,isle:_0x21f686,pallet:_0x1174ef,batch_code:_0x5a90f4,SCRN:_0x19dfe9,expiry_date:_0x45b23e,mode_transpo:_0x5ceafa,name_driver:_0x29d8c0}=_0x3172fe['body'];if(typeof _0x4a85e7==_0x21d4f9(0x105))var _0x38f42c=[_0x3172fe[_0x21d4f9(0x1e1)]['product_name']],_0x56bb0a=[_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x14a)]],_0x492aa2=[_0x3172fe['body']['carton']],_0x2df4ab=[_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x174)]],_0x45b105=[_0x3172fe['body'][_0x21d4f9(0xe9)]],_0x107e1e=[_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x18d)]],_0x31b52f=[_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x175)]],_0xd06565=[_0x3172fe['body']['primary_unit']],_0xb9b749=[_0x3172fe['body']['secondary_unit']],_0x26f1dd=[_0x3172fe['body'][_0x21d4f9(0x1c1)]],_0x2242a1=[_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x1d5)]],_0x3aa194=[_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x1e3)]],_0x367048=[_0x3172fe['body']['max_per_unit']],_0x4c93ea=[_0x3172fe['body'][_0x21d4f9(0x13f)]],_0x217e2b=[_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x1c6)]],_0x337e55=[_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x17f)]],_0x2bcf30=[_0x3172fe['body'][_0x21d4f9(0x12f)]];else var _0x38f42c=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x1e9)]],_0x56bb0a=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x14a)]],_0x492aa2=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0xee)]],_0x2df4ab=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x174)]],_0x45b105=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0xe9)]],_0x107e1e=[..._0x3172fe[_0x21d4f9(0x1e1)]['prod_code']],_0x31b52f=[..._0x3172fe['body']['level']],_0xd06565=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x1de)]],_0xb9b749=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x11a)]],_0x26f1dd=[..._0x3172fe[_0x21d4f9(0x1e1)]['batch_code']],_0x2242a1=[..._0x3172fe[_0x21d4f9(0x1e1)]['expiry_date']],_0x3aa194=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x1e3)]],_0x367048=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0xf7)]],_0x4c93ea=[..._0x3172fe['body'][_0x21d4f9(0x13f)]],_0x217e2b=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x1c6)]],_0x337e55=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x17f)]],_0x2bcf30=[..._0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x12f)]];const _0x56b102=_0x38f42c['map'](_0x2fb020=>{return _0x2fb020={'product_name':_0x2fb020};});_0x56bb0a[_0x21d4f9(0x1d7)]((_0x39e01b,_0x925a71)=>{var _0x1df988=_0x21d4f9;_0x56b102[_0x925a71][_0x1df988(0x14a)]=_0x39e01b;}),_0x492aa2['forEach']((_0x724245,_0x38ea1d)=>{var _0xbbd349=_0x21d4f9;_0x56b102[_0x38ea1d][_0xbbd349(0x18c)]=Math['abs'](_0x724245);}),_0x2bcf30['forEach']((_0x10828a,_0x32d127)=>{var _0x3b9658=_0x21d4f9;_0x56b102[_0x32d127][_0x3b9658(0x12f)]=_0x10828a;}),_0x2df4ab[_0x21d4f9(0x1d7)]((_0x3b359c,_0x547e57)=>{_0x56b102[_0x547e57]['primary_code']=_0x3b359c;}),_0x45b105[_0x21d4f9(0x1d7)]((_0x36ef51,_0x4fc43d)=>{_0x56b102[_0x4fc43d]['secondary_code']=_0x36ef51;}),_0x107e1e[_0x21d4f9(0x1d7)]((_0x3906f4,_0x3d6b71)=>{var _0x290463=_0x21d4f9;_0x56b102[_0x3d6b71][_0x290463(0x117)]=_0x3906f4;}),_0x31b52f['forEach']((_0x341c7f,_0x1f6691)=>{var _0x3efef0=_0x21d4f9;_0x56b102[_0x1f6691][_0x3efef0(0x173)]=_0x341c7f;}),_0xd06565[_0x21d4f9(0x1d7)]((_0x51a212,_0x562596)=>{_0x56b102[_0x562596]['unit']=_0x51a212;}),_0xb9b749[_0x21d4f9(0x1d7)]((_0x18cfda,_0x14fd7d)=>{var _0x462c3f=_0x21d4f9;_0x56b102[_0x14fd7d][_0x462c3f(0x11a)]=_0x18cfda;}),_0x26f1dd[_0x21d4f9(0x1d7)]((_0x508ba6,_0x5e0ea2)=>{var _0xbb6716=_0x21d4f9;_0x56b102[_0x5e0ea2][_0xbb6716(0x1c1)]=_0x508ba6;}),_0x2242a1[_0x21d4f9(0x1d7)]((_0x17d1cb,_0x4c2608)=>{_0x56b102[_0x4c2608]['expiry_date']=_0x17d1cb;}),_0x3aa194[_0x21d4f9(0x1d7)]((_0x4f43b2,_0x102e8b)=>{_0x56b102[_0x102e8b]['production_date']=_0x4f43b2;}),_0x367048['forEach']((_0x2d8e43,_0xe5e621)=>{var _0x4c8913=_0x21d4f9;_0x56b102[_0xe5e621][_0x4c8913(0x1df)]=_0x2d8e43;}),_0x4c93ea[_0x21d4f9(0x1d7)]((_0x1acc0a,_0x52e33c)=>{var _0x5470bc=_0x21d4f9;_0x56b102[_0x52e33c][_0x5470bc(0x13f)]=_0x1acc0a;}),_0x217e2b[_0x21d4f9(0x1d7)]((_0x58f632,_0xeb57c)=>{var _0x4105b5=_0x21d4f9;_0x56b102[_0xeb57c][_0x4105b5(0x15c)]=_0x58f632;}),_0x337e55['forEach']((_0x72e7f3,_0x83a67)=>{_0x56b102[_0x83a67]['invoice']=_0x72e7f3;});var _0x127c37=0x0;_0x56b102['forEach'](_0x559617=>{var _0x1572f4=_0x21d4f9;parseFloat(_0x559617['stock'])<parseFloat(_0x559617['quantity'])&&parseFloat(_0x559617['quantity'])>parseFloat(_0x559617[_0x1572f4(0x14a)])&&(console[_0x1572f4(0x102)](_0x559617['stock']+'\x20<>\x20'+_0x559617[_0x1572f4(0x18c)]),_0x127c37++);});if(_0x127c37!=0x0)return _0x3172fe['flash'](_0x21d4f9(0x184),_0x21d4f9(0x1a2)),_0x432abd['redirect']('back');const _0x143bbc=_0x56b102[_0x21d4f9(0x1f0)](_0x5bab7c=>_0x5bab7c[_0x21d4f9(0x18c)]!=='0'&&_0x5bab7c[_0x21d4f9(0x18c)]!==''),_0x4ab4ea=new sales_finished({'invoice':_0x50c789,'customer':_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x1bb)],'date':_0x21c90c,'warehouse_name':_0x544629,'sale_product':_0x143bbc,'note':_0x378a29,'room':_0x5dc253,'primary_code':_0x496f9e,'secondary_code':_0x2b3c8f,'prod_code':_0x2b66ed,'SCRN':_0x19dfe9,'finalize':_0x21d4f9(0xe4),'mode_transpo':_0x5ceafa,'name_driver':_0x29d8c0}),_0x17ccfc=await _0x4ab4ea[_0x21d4f9(0x1ed)](),_0x2f707c=await sales_finished[_0x21d4f9(0x1cf)]({'invoice':_0x50c789}),_0x225d56=new c_payment_data({'invoice':_0x50c789,'customer':_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x1bb)],'reason':_0x21d4f9(0x189)});await _0x225d56[_0x21d4f9(0x1ed)]();const _0x23c2d8=await master_shop[_0x21d4f9(0x15e)](),_0x5a8aa5=await email_settings['findOne'](),_0x167064=await customer[_0x21d4f9(0x1cf)]({'name':_0x3172fe[_0x21d4f9(0x1e1)][_0x21d4f9(0x1bb)]});_0x23c2d8[0x0][_0x21d4f9(0x159)]==0x1?(right_currency=_0x23c2d8[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x23c2d8[0x0]['currency']);var _0x1505af=_0x38f42c,_0x4718e3=_0x492aa2,_0x1a9705='',_0x195cb8;for(_0x195cb8 in _0x1505af){_0x1a9705+=_0x21d4f9(0x1d1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1505af[_0x195cb8]+_0x21d4f9(0x1ec)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4718e3[_0x195cb8]+_0x21d4f9(0x1ec)+_0x21d4f9(0xf9);}console['log'](_0x21d4f9(0x1ab),_0x1a9705);let _0x2cc69f=nodemailer[_0x21d4f9(0x1d4)]({'host':_0x5a8aa5[_0x21d4f9(0x1b1)],'port':Number(_0x5a8aa5['port']),'secure':![],'service':_0x21d4f9(0x1b3),'auth':{'user':_0x5a8aa5[_0x21d4f9(0x138)],'pass':_0x5a8aa5[_0x21d4f9(0x1ad)]}}),_0x375339={'from':_0x5a8aa5[_0x21d4f9(0x138)],'to':_0x21d4f9(0xfd),'subject':'Add\x20Sales','attachments':[{'filename':_0x21d4f9(0x15a),'path':__dirname+_0x21d4f9(0x15f)+_0x21d4f9(0x1d2)+_0x23c2d8[0x0][_0x21d4f9(0xf8)],'cid':_0x21d4f9(0x161)}],'html':_0x21d4f9(0x1c4)};_0x2cc69f['sendMail'](_0x375339,function(_0x58a3db,_0x4fcb3d){var _0x3c6159=_0x21d4f9;_0x58a3db?(console['log'](_0x58a3db),console[_0x3c6159(0x102)](_0x3c6159(0x188))):console[_0x3c6159(0x102)](_0x3c6159(0x13c));}),_0x3172fe[_0x21d4f9(0xe6)](_0x21d4f9(0x163),_0x21d4f9(0x125)),_0x432abd[_0x21d4f9(0x17c)](_0x21d4f9(0x187)+_0x17ccfc[_0x21d4f9(0xff)]);}catch(_0x37d0bd){console[_0x21d4f9(0x102)](_0x37d0bd);}}),router[a0_0x4254df(0x154)](a0_0x4254df(0xe2),auth,async(_0x1e8f37,_0x3ec802)=>{var _0x4f2b5b=a0_0x4254df;try{const {username:_0x2c2439,email:_0x1be0be,role:_0x45154f}=_0x1e8f37[_0x4f2b5b(0x132)],_0x2f8a4f=_0x1e8f37[_0x4f2b5b(0x132)],_0x1957e4=await profile[_0x4f2b5b(0x1cf)]({'email':_0x2f8a4f[_0x4f2b5b(0x138)]}),_0x187a70=await master_shop[_0x4f2b5b(0x15e)](),_0x205803=_0x1e8f37[_0x4f2b5b(0xe7)]['id'],_0x23a4fa=await sales_finished[_0x4f2b5b(0x131)](_0x205803),_0x225745=await warehouse[_0x4f2b5b(0x11b)]([{'$match':{'name':_0x23a4fa['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4f2b5b(0x136),'name':{'$first':_0x4f2b5b(0x16a)},'product_stock':{'$first':_0x4f2b5b(0x192)},'bay':{'$first':_0x4f2b5b(0xfb)},'bin':{'$first':_0x4f2b5b(0x146)},'type':{'$first':_0x4f2b5b(0x1e4)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4f2b5b(0x182)},'secondary_code':{'$first':_0x4f2b5b(0xde)},'product_code':{'$first':_0x4f2b5b(0x1ba)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4f2b5b(0xeb)},'expiry_date':{'$first':_0x4f2b5b(0x149)},'production_date':{'$first':_0x4f2b5b(0x120)},'batch_code':{'$first':_0x4f2b5b(0x1e5)},'room':{'$first':_0x4f2b5b(0x10b)},'room_data':{'$first':_0x4f2b5b(0xe5)}}}]),_0x576dab=await customer[_0x4f2b5b(0x15e)]({});let _0x42dde3;if(_0x2f8a4f[_0x4f2b5b(0x1e8)]=='staff'){const _0x282d11=await staff['findOne']({'email':_0x2f8a4f[_0x4f2b5b(0x138)]});_0x42dde3=await warehouse[_0x4f2b5b(0x11b)]([{'$match':{'status':'Enabled','name':_0x282d11[_0x4f2b5b(0x126)]}},{'$group':{'_id':_0x4f2b5b(0x109),'name':{'$first':_0x4f2b5b(0x109)}}}]);}else _0x42dde3=await warehouse[_0x4f2b5b(0x11b)]([{'$match':{'status':_0x4f2b5b(0x1d3)}},{'$group':{'_id':_0x4f2b5b(0x109),'name':{'$first':'$name'}}}]);const _0x373ccb=await product[_0x4f2b5b(0x15e)]({});if(_0x187a70[0x0]['language']==_0x4f2b5b(0x11f)){var _0x368b49=users['English'];console[_0x4f2b5b(0x102)](_0x368b49);}else{if(_0x187a70[0x0][_0x4f2b5b(0xef)]==_0x4f2b5b(0xf2))var _0x368b49=users['Hindi'];else{if(_0x187a70[0x0][_0x4f2b5b(0xef)]=='German')var _0x368b49=users[_0x4f2b5b(0x1e0)];else{if(_0x187a70[0x0][_0x4f2b5b(0xef)]==_0x4f2b5b(0x1be))var _0x368b49=users[_0x4f2b5b(0x1be)];else{if(_0x187a70[0x0]['language']==_0x4f2b5b(0x1c9))var _0x368b49=users[_0x4f2b5b(0x1c9)];else{if(_0x187a70[0x0][_0x4f2b5b(0xef)]=='Portuguese\x20(BR)')var _0x368b49=users[_0x4f2b5b(0x162)];else{if(_0x187a70[0x0][_0x4f2b5b(0xef)]==_0x4f2b5b(0x12c))var _0x368b49=users[_0x4f2b5b(0x12c)];else{if(_0x187a70[0x0][_0x4f2b5b(0xef)]==_0x4f2b5b(0x101))var _0x368b49=users[_0x4f2b5b(0x1a1)];}}}}}}}_0x3ec802[_0x4f2b5b(0x140)](_0x4f2b5b(0x167),{'success':_0x1e8f37[_0x4f2b5b(0xe6)](_0x4f2b5b(0x163)),'errors':_0x1e8f37['flash']('errors'),'role':_0x2f8a4f,'profile':_0x1957e4,'customer':_0x576dab,'warehouse':_0x42dde3,'product':_0x225745,'user':_0x23a4fa,'master_shop':_0x187a70,'unit':_0x373ccb,'language':_0x368b49});}catch(_0x1be949){console[_0x4f2b5b(0x102)](_0x1be949);}}),router[a0_0x4254df(0x1c8)](a0_0x4254df(0xe2),auth,async(_0x51c3f3,_0x5ea505)=>{var _0x41b661=a0_0x4254df;try{const _0x2040d7=_0x51c3f3['params']['id'],{invoice:_0x3e40c5,warehouse_name:_0x428c68,room:_0xa3389c}=_0x51c3f3['body'],_0x5c54e7=await sales_finished[_0x41b661(0x1cf)]({'invoice':_0x3e40c5}),_0xf933d2=_0x5c54e7[_0x41b661(0x1c3)][_0x41b661(0x16c)](async _0x9a4424=>{var _0x16600d=_0x41b661,_0x72d43e=await warehouse[_0x16600d(0x1cf)]({'name':_0x428c68,'room':_0x9a4424[_0x16600d(0x15c)],'warehouse_category':'Finished\x20Goods'});const _0x117bf7=_0x72d43e[_0x16600d(0x10a)][_0x16600d(0x16c)](_0x461d5c=>{var _0x211548=_0x16600d;(_0x461d5c[_0x211548(0x1e9)]==_0x9a4424['product_name']&&_0x461d5c['bay']==_0x9a4424['bay']&&_0x461d5c[_0x211548(0x1d5)]==_0x9a4424[_0x211548(0x1d5)]&&_0x461d5c['production_date']==_0x9a4424['production_date']&&_0x461d5c[_0x211548(0x1c1)]==_0x9a4424[_0x211548(0x1c1)]&&_0x461d5c[_0x211548(0xe8)]==_0x9a4424[_0x211548(0xe8)]||_0x461d5c[_0x211548(0xff)]==_0x9a4424[_0x211548(0x12f)])&&(_0x461d5c[_0x211548(0x118)]>0x0&&(console[_0x211548(0x102)](_0x461d5c['product_name']+_0x211548(0x16d)+_0x9a4424[_0x211548(0x1e9)]+_0x211548(0x1ea)+_0x461d5c[_0x211548(0x173)]+_0x211548(0x16d)+_0x9a4424[_0x211548(0x173)]+_0x211548(0x1ea)+_0x461d5c[_0x211548(0x1e7)]+_0x211548(0x16d)+_0x9a4424[_0x211548(0x1e7)]+_0x211548(0x1ea)+_0x461d5c[_0x211548(0x1d5)]+'\x20==\x20'+_0x9a4424[_0x211548(0x1d5)]+_0x211548(0x1ea)+_0x461d5c[_0x211548(0x1c1)]+_0x211548(0x16d)+_0x9a4424['batch_code']+_0x211548(0x1ea)+_0x461d5c[_0x211548(0xe8)]+_0x211548(0x16d)+_0x9a4424[_0x211548(0xe8)]+'\x20&&\x20'+_0x461d5c[_0x211548(0x118)]+'\x20<<<==>>>\x20'+_0x9a4424[_0x211548(0x18c)]+_0x211548(0x185)+_0x9a4424[_0x211548(0x15c)]+'\x20&&\x20'+_0x461d5c[_0x211548(0xff)]+'\x20==\x20'+_0x9a4424[_0x211548(0x12f)]),_0x461d5c['product_stock']=Math['max'](0x0,Math[_0x211548(0x11c)](_0x461d5c[_0x211548(0x118)])-Math['abs'](_0x9a4424[_0x211548(0x18c)]))));});return _0x72d43e;});Promise[_0x41b661(0x190)](_0xf933d2)[_0x41b661(0x19d)](async _0x3da22a=>{var _0x23b0e5=_0x41b661;try{for(const _0x378528 of _0x3da22a){await _0x378528[_0x23b0e5(0x1ed)]();}_0x5c54e7[_0x23b0e5(0x1cd)]=_0x23b0e5(0x1d6);const _0x550ceb=await _0x5c54e7[_0x23b0e5(0x1ed)](),_0x223312=await master_shop[_0x23b0e5(0x15e)](),_0x459cff=await email_settings[_0x23b0e5(0x1cf)](),_0x132ea2=await supervisor_settings[_0x23b0e5(0x15e)]();var _0x2e29fc=_0x5c54e7[_0x23b0e5(0x1c3)],_0x2d90d4='',_0x2f7288;for(_0x2f7288 in _0x2e29fc){var _0x164ad='FG';_0x5c54e7[_0x23b0e5(0x12d)]=='DRY\x20GOODS'&&(_0x164ad='DG'),_0x2d90d4+=_0x23b0e5(0x1d1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2e29fc[_0x2f7288][_0x23b0e5(0x1e9)]+_0x23b0e5(0x1ec)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2e29fc[_0x2f7288][_0x23b0e5(0x117)]+_0x23b0e5(0x1ec)+_0x23b0e5(0x13a)+_0x2e29fc[_0x2f7288][_0x23b0e5(0x18c)]+_0x23b0e5(0x1ec)+_0x23b0e5(0x13a)+_0x2e29fc[_0x2f7288]['unit']+'</td>'+_0x23b0e5(0x13a)+_0x2e29fc[_0x2f7288]['secondary_unit']+_0x23b0e5(0x1ec)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c54e7[_0x23b0e5(0x12d)]+_0x23b0e5(0x1ec)+_0x23b0e5(0x13a)+_0x2e29fc[_0x2f7288][_0x23b0e5(0x15c)]+'</td>'+_0x23b0e5(0x13a)+_0x164ad+_0x2e29fc[_0x2f7288][_0x23b0e5(0x173)]+'</td>';}let _0x5a7fea=nodemailer[_0x23b0e5(0x1d4)]({'host':_0x459cff[_0x23b0e5(0x1b1)],'port':Number(_0x459cff[_0x23b0e5(0x1b9)]),'secure':![],'auth':{'user':_0x459cff['email'],'pass':_0x459cff[_0x23b0e5(0x1ad)]}}),_0x3fcd79={'from':_0x459cff[_0x23b0e5(0x138)],'to':_0x132ea2[0x0][_0x23b0e5(0x158)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x23b0e5(0x15a),'path':__dirname+_0x23b0e5(0x15f)+'/upload/'+_0x223312[0x0]['image'],'cid':'logo'}],'html':_0x23b0e5(0x127)+_0x23b0e5(0x129)+_0x23b0e5(0x1e6)+_0x23b0e5(0x145)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x23b0e5(0x145)+_0x23b0e5(0x100)+_0x23b0e5(0x12e)+_0x23b0e5(0x145)+'<h2>\x20'+_0x223312[0x0]['site_title']+'\x20</h2>'+_0x23b0e5(0x12e)+_0x23b0e5(0x12e)+_0x23b0e5(0x148)+_0x23b0e5(0x145)+_0x23b0e5(0x197)+_0x23b0e5(0xec)+_0x5c54e7[_0x23b0e5(0xe8)]+'\x20'+_0x23b0e5(0x17a)+_0x23b0e5(0x10e)+_0x5c54e7[_0x23b0e5(0xf1)]+'\x20'+_0x23b0e5(0x181)+_0x23b0e5(0x172)+_0x23b0e5(0x12e)+_0x23b0e5(0x160)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x23b0e5(0x186)+_0x23b0e5(0x122)+_0x23b0e5(0x15b)+_0x23b0e5(0x15d)+_0x23b0e5(0xea)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x23b0e5(0xf9)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2d90d4+'\x20'+_0x23b0e5(0x124)+_0x23b0e5(0x18a)+_0x23b0e5(0x145)+_0x23b0e5(0x151)+_0x23b0e5(0x183)+_0x223312[0x0][_0x23b0e5(0x1dc)]+'</h5>'+'</div>'+_0x23b0e5(0x12e)+_0x23b0e5(0x14b)};_0x5a7fea[_0x23b0e5(0x1a6)](_0x3fcd79,function(_0x41f380,_0x1e099b){var _0x19eb11=_0x23b0e5;_0x41f380?(console[_0x19eb11(0x102)](_0x41f380),console[_0x19eb11(0x102)](_0x19eb11(0x188))):console[_0x19eb11(0x102)](_0x19eb11(0x13c));}),_0x51c3f3[_0x23b0e5(0xe6)]('success',_0x23b0e5(0x164)),_0x5ea505[_0x23b0e5(0x17c)](_0x23b0e5(0x194)+_0x2040d7);}catch(_0x5582f9){console[_0x23b0e5(0x169)](_0x5582f9),_0x5ea505[_0x23b0e5(0x1bf)](0x1f4)[_0x23b0e5(0x193)]({'error':_0x23b0e5(0x1a7)});}})['catch'](_0x4ce61e=>{var _0x2d502b=_0x41b661;console['error'](_0x4ce61e),_0x5ea505[_0x2d502b(0x1bf)](0x1f4)[_0x2d502b(0x193)]({'error':_0x2d502b(0x1c7)});});}catch(_0x3e2c07){console[_0x41b661(0x102)](_0x3e2c07);}}),router[a0_0x4254df(0x154)](a0_0x4254df(0x16b),auth,async(_0x486730,_0x3ceb90)=>{var _0x2b5c9f=a0_0x4254df;try{const {username:_0x3abe6f,email:_0x5dde2a,role:_0x30f6b1}=_0x486730[_0x2b5c9f(0x132)],_0x263628=_0x486730[_0x2b5c9f(0x132)],_0x5aec15=await profile[_0x2b5c9f(0x1cf)]({'email':_0x263628[_0x2b5c9f(0x138)]}),_0x15b7da=await master_shop[_0x2b5c9f(0x15e)](),_0x241aa6=_0x486730[_0x2b5c9f(0xe7)]['id'],_0x41566f=await sales_finished[_0x2b5c9f(0x131)](_0x241aa6);let _0x397044=new Date(_0x41566f[_0x2b5c9f(0x1d5)]),_0xa0464c=('0'+_0x397044[_0x2b5c9f(0x1ee)]())[_0x2b5c9f(0x1c5)](-0x2),_0x4a0dfd=('0'+(_0x397044['getMonth']()+0x1))[_0x2b5c9f(0x1c5)](-0x2),_0x428bbd=_0x397044['getFullYear'](),_0x218693=_0x428bbd+'-'+_0x4a0dfd+'-'+_0xa0464c;var _0x430ad1=[_0x2b5c9f(0x133),_0x2b5c9f(0x155)];const _0x3f1753=await warehouse[_0x2b5c9f(0x11b)]([{'$match':{'name':_0x41566f[_0x2b5c9f(0x12d)],'room':_0x41566f['room']}},{'$unwind':_0x2b5c9f(0xf0)},{'$group':{'_id':_0x2b5c9f(0x136),'name':{'$first':_0x2b5c9f(0x16a)},'product_stock':{'$first':_0x2b5c9f(0x192)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2b5c9f(0x146)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2b5c9f(0x199)},'primary_code':{'$first':_0x2b5c9f(0x182)},'secondary_code':{'$first':_0x2b5c9f(0xde)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2b5c9f(0xeb)}}}]),_0x4ea6dc=await customer[_0x2b5c9f(0x15e)]({});let _0x1791ee;if(_0x263628[_0x2b5c9f(0x1e8)]=='staff'){const _0x15985c=await staff[_0x2b5c9f(0x1cf)]({'email':_0x263628[_0x2b5c9f(0x138)]});_0x1791ee=await warehouse[_0x2b5c9f(0x11b)]([{'$match':{'status':_0x2b5c9f(0x1d3),'name':_0x15985c['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x2b5c9f(0x109)}}}]);}else _0x1791ee=await warehouse[_0x2b5c9f(0x11b)]([{'$match':{'status':_0x2b5c9f(0x1d3)}},{'$group':{'_id':'$name','name':{'$first':_0x2b5c9f(0x109)}}}]);const _0x2f309f=await product['find']({});if(_0x15b7da[0x0]['language']==_0x2b5c9f(0x11f)){var _0x2f6b98=users['English'];console[_0x2b5c9f(0x102)](_0x2f6b98);}else{if(_0x15b7da[0x0][_0x2b5c9f(0xef)]==_0x2b5c9f(0xf2))var _0x2f6b98=users[_0x2b5c9f(0xf2)];else{if(_0x15b7da[0x0][_0x2b5c9f(0xef)]==_0x2b5c9f(0x1e0))var _0x2f6b98=users[_0x2b5c9f(0x1e0)];else{if(_0x15b7da[0x0][_0x2b5c9f(0xef)]==_0x2b5c9f(0x1be))var _0x2f6b98=users[_0x2b5c9f(0x1be)];else{if(_0x15b7da[0x0][_0x2b5c9f(0xef)]=='French')var _0x2f6b98=users[_0x2b5c9f(0x1c9)];else{if(_0x15b7da[0x0][_0x2b5c9f(0xef)]=='Portuguese\x20(BR)')var _0x2f6b98=users[_0x2b5c9f(0x162)];else{if(_0x15b7da[0x0][_0x2b5c9f(0xef)]==_0x2b5c9f(0x12c))var _0x2f6b98=users[_0x2b5c9f(0x12c)];else{if(_0x15b7da[0x0]['language']==_0x2b5c9f(0x101))var _0x2f6b98=users[_0x2b5c9f(0x1a1)];}}}}}}}_0x3ceb90[_0x2b5c9f(0x140)](_0x2b5c9f(0x14d),{'success':_0x486730[_0x2b5c9f(0xe6)](_0x2b5c9f(0x163)),'errors':_0x486730[_0x2b5c9f(0xe6)](_0x2b5c9f(0x184)),'role':_0x263628,'profile':_0x5aec15,'customer':_0x4ea6dc,'warehouse':_0x1791ee,'product':_0x3f1753,'user':_0x41566f,'master_shop':_0x15b7da,'unit':_0x2f309f,'language':_0x2f6b98,'rooms_data':_0x430ad1,'ed_fullDate':_0x218693});}catch(_0x5ea270){console[_0x2b5c9f(0x102)](_0x5ea270);}}),router['post'](a0_0x4254df(0x16b),auth,async(_0xbfb290,_0x1e9d56)=>{var _0x27a432=a0_0x4254df;try{const _0x3d98c3=_0xbfb290[_0x27a432(0xe7)]['id'],_0x2276ab=await sales_finished[_0x27a432(0x1cf)]({'_id':_0xbfb290[_0x27a432(0xe7)]['id']}),_0xec9560=await warehouse[_0x27a432(0x1cf)]({'name':_0x2276ab[_0x27a432(0x12d)],'room':_0xbfb290[_0x27a432(0x1e1)][_0x27a432(0x141)],'warehouse_category':_0x27a432(0x19a)}),{invoice:_0x57e0ee,customer:_0x31401a,date:_0x4e31cd,warehouse_name:_0xaad322,product_name:_0x37e3f1,stock:_0x1e4e94,adjust_qty:_0x35b653,note:_0x3d8ac1,room:_0x2b10ea,primary_code:_0xdfcbf5,secondary_code:_0x2e8a1a,prod_code:_0x52c1e2,level:_0x406fd7,isle:_0x32f8c5,pallet:_0x4961c0,expiry_date:_0x161077}=_0xbfb290['body'];if(typeof _0x37e3f1=='string')var _0x8f9a07=[_0xbfb290['body'][_0x27a432(0x1e9)]],_0x218a04=[_0xbfb290['body']['stock']],_0x5c912c=[_0xbfb290[_0x27a432(0x1e1)][_0x27a432(0x16e)]],_0xf485ab=[_0xbfb290[_0x27a432(0x1e1)][_0x27a432(0x174)]],_0x579946=[_0xbfb290[_0x27a432(0x1e1)][_0x27a432(0xe9)]],_0x1a3d1f=[_0xbfb290[_0x27a432(0x1e1)]['prod_code']],_0x49e7a5=[_0xbfb290[_0x27a432(0x1e1)][_0x27a432(0x175)]],_0x555940=[_0xbfb290[_0x27a432(0x1e1)]['expiry_date']];else var _0x8f9a07=[..._0xbfb290[_0x27a432(0x1e1)][_0x27a432(0x1e9)]],_0x218a04=[..._0xbfb290['body']['stock']],_0x5c912c=[..._0xbfb290[_0x27a432(0x1e1)][_0x27a432(0x16e)]],_0xf485ab=[..._0xbfb290['body']['primary_code']],_0x579946=[..._0xbfb290[_0x27a432(0x1e1)][_0x27a432(0xe9)]],_0x1a3d1f=[..._0xbfb290[_0x27a432(0x1e1)][_0x27a432(0x18d)]],_0x49e7a5=[..._0xbfb290['body']['level']],_0x555940=[..._0xbfb290['body'][_0x27a432(0x1d5)]];const _0x3202ff=_0x8f9a07['map'](_0x561899=>{return _0x561899={'product_name':_0x561899};});_0x218a04['forEach']((_0x1251de,_0x59f601)=>{var _0x2f52d7=_0x27a432;_0x3202ff[_0x59f601][_0x2f52d7(0x14a)]=_0x1251de;}),_0x5c912c[_0x27a432(0x1d7)]((_0xf597fe,_0x4f2274)=>{var _0x3fee70=_0x27a432;_0x3202ff[_0x4f2274][_0x3fee70(0x18c)]=_0xf597fe;}),_0xf485ab[_0x27a432(0x1d7)]((_0x1ddde4,_0x214235)=>{var _0x1d46ff=_0x27a432;_0x3202ff[_0x214235][_0x1d46ff(0x174)]=_0x1ddde4;}),_0x579946[_0x27a432(0x1d7)]((_0x2f5460,_0x4b6efe)=>{var _0x1777f8=_0x27a432;_0x3202ff[_0x4b6efe][_0x1777f8(0xe9)]=_0x2f5460;}),_0x1a3d1f[_0x27a432(0x1d7)]((_0x41ccec,_0x45c84e)=>{var _0x2eac6c=_0x27a432;_0x3202ff[_0x45c84e][_0x2eac6c(0x117)]=_0x41ccec;}),_0x49e7a5[_0x27a432(0x1d7)]((_0x56d555,_0x66d212)=>{var _0x439594=_0x27a432;_0x3202ff[_0x66d212][_0x439594(0x175)]=_0x56d555;}),_0x555940['forEach']((_0x5e936c,_0x31be57)=>{var _0x290dcb=_0x27a432;_0x3202ff[_0x31be57][_0x290dcb(0x1d5)]=_0x5e936c;});var _0x3b6ba5=0x0;_0x3202ff['forEach'](_0x3ff8d7=>{var _0xb536b9=_0x27a432;console[_0xb536b9(0x102)]('foreach\x20newproduct',_0x3ff8d7),(parseInt(_0x3ff8d7[_0xb536b9(0x14a)])<parseInt(_0x3ff8d7[_0xb536b9(0x18c)])||parseInt(_0x3ff8d7[_0xb536b9(0x18c)])==0x0)&&_0x3b6ba5++;});if(_0x3b6ba5!=0x0)return _0xbfb290[_0x27a432(0xe6)]('errors',_0x27a432(0x123)),_0x1e9d56[_0x27a432(0x17c)](_0x27a432(0x156));_0x2276ab['sale_product'][_0x27a432(0x1d7)](_0x46feba=>{var _0x162bcb=_0x27a432;const _0x43a6f8=_0xec9560[_0x162bcb(0x10a)][_0x162bcb(0x16c)](_0x2eb14a=>{var _0x10a402=_0x162bcb;_0x2eb14a['product_name']==_0x46feba[_0x10a402(0x1e9)]&&_0x2eb14a[_0x10a402(0x173)]==_0x46feba['bay']&&(_0x2eb14a[_0x10a402(0x118)]=parseInt(_0x2eb14a[_0x10a402(0x118)])+parseInt(_0x46feba[_0x10a402(0x18c)]));});}),await _0xec9560[_0x27a432(0x1ed)]();const _0x455681=_0x3202ff['filter'](_0x2c8afd=>_0x2c8afd[_0x27a432(0x18c)]!=='0'&&_0x2c8afd[_0x27a432(0x18c)]!=='');_0x2276ab[_0x27a432(0xe8)]=_0x57e0ee,_0x2276ab[_0x27a432(0x1bb)]=_0x31401a,_0x2276ab['date']=_0x4e31cd,_0x2276ab[_0x27a432(0x12d)]=_0xaad322,_0x2276ab['sale_product']=_0x455681,_0x2276ab[_0x27a432(0x1cc)]=_0x3d8ac1,_0x2276ab[_0x27a432(0x141)]=_0x2b10ea;const _0x25e7eb=await _0x2276ab[_0x27a432(0x1ed)](),_0x55d91d=await sales_finished['findOne']({'_id':_0xbfb290[_0x27a432(0xe7)]['id']}),_0x5911b7=await warehouse[_0x27a432(0x1cf)]({'name':_0xaad322,'room':_0x2b10ea,'warehouse_category':_0x27a432(0x19a)});_0x55d91d[_0x27a432(0x1c3)][_0x27a432(0x1d7)](_0x29ec30=>{var _0x591e74=_0x27a432;const _0x781c53=_0x5911b7[_0x591e74(0x10a)][_0x591e74(0x16c)](_0x5b562c=>{var _0x1f9d85=_0x591e74;_0x5b562c[_0x1f9d85(0x1e9)]==_0x29ec30[_0x1f9d85(0x1e9)]&&_0x5b562c['bay']==_0x29ec30[_0x1f9d85(0x173)]&&(_0x5b562c[_0x1f9d85(0x118)]=parseInt(_0x5b562c['product_stock'])-parseInt(_0x29ec30[_0x1f9d85(0x18c)]));});}),console[_0x27a432(0x102)]('final',_0x5911b7),await _0x5911b7[_0x27a432(0x1ed)]();const _0x5a1396=await c_payment_data[_0x27a432(0x1cf)]({'invoice':_0xbfb290[_0x27a432(0x1e1)][_0x27a432(0xe8)]});_0x5a1396[_0x27a432(0x108)]=_0xbfb290[_0x27a432(0x1e1)][_0x27a432(0x108)],await _0x5a1396['save'](),_0xbfb290[_0x27a432(0xe6)](_0x27a432(0x163),'Sales\x20Update\x20successfully'),_0x1e9d56[_0x27a432(0x17c)](_0x27a432(0x179));}catch(_0x439313){console[_0x27a432(0x102)](_0x439313);}}),router['post']('/give_payment/:id',auth,async(_0x1b69c6,_0x295de1)=>{var _0x124bd4=a0_0x4254df;try{const _0x3649dd=_0x1b69c6[_0x124bd4(0xe7)]['id'],{invoice:_0x4d289d,customer:_0x51b5df,receivable_amount:_0x146c89,received_amount:_0x1f3f84}=_0x1b69c6[_0x124bd4(0x1e1)],_0x2e75b6=await sales['findById'](_0x3649dd);console[_0x124bd4(0x102)](_0x2e75b6);var _0x4a04dc=_0x146c89-_0x1f3f84;console['log'](_0x1f3f84),_0x2e75b6['received_amount']=parseFloat(_0x1f3f84)+parseFloat(_0x2e75b6[_0x124bd4(0x1cb)]),_0x2e75b6[_0x124bd4(0x17d)]=_0x4a04dc,console[_0x124bd4(0x102)](_0x2e75b6);const _0x2c4456=await _0x2e75b6[_0x124bd4(0x1ed)](),_0x313408=await c_payment_data[_0x124bd4(0x1cf)]({'invoice':_0x4d289d});_0x313408[_0x124bd4(0x1a3)]=_0x4a04dc,await _0x313408['save']();let _0x3d142c=new Date(),_0x2067c3=('0'+_0x3d142c['getDate']())[_0x124bd4(0x1c5)](-0x2),_0x1367bb=('0'+(_0x3d142c['getMonth']()+0x1))[_0x124bd4(0x1c5)](-0x2),_0x50f1e2=_0x3d142c['getFullYear'](),_0x1281ee=_0x50f1e2+'-'+_0x1367bb+'-'+_0x2067c3;const _0x4b9b72=new customer_payment({'invoice':_0x4d289d,'date':_0x50f1e2+'-'+_0x1367bb+'-'+_0x2067c3,'customer':_0x51b5df,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x1f3f84}),_0x4cebcc=await _0x4b9b72[_0x124bd4(0x1ed)]();_0x1b69c6[_0x124bd4(0xe6)](_0x124bd4(0x163),_0x124bd4(0x157)),_0x295de1['redirect'](_0x124bd4(0x198));}catch(_0x37c3de){console['log'](_0x37c3de);}}),router['get'](a0_0x4254df(0x180),auth,async(_0x3bf391,_0x4fdfab)=>{var _0x2ecac3=a0_0x4254df;try{const {username:_0x4e2d2d,email:_0x1eb4fc,role:_0x19ca95}=_0x3bf391['user'],_0x42c91a=_0x3bf391[_0x2ecac3(0x132)],_0x29d60a=await profile[_0x2ecac3(0x1cf)]({'email':_0x42c91a[_0x2ecac3(0x138)]}),_0x4481e1=await master_shop[_0x2ecac3(0x15e)]();console['log'](_0x2ecac3(0x1b0),_0x4481e1);const _0x2f5444=_0x3bf391[_0x2ecac3(0xe7)]['id'],_0x3e1a23=await sales['findById'](_0x2f5444);console['log'](_0x3e1a23);const _0x3e0345=await customer[_0x2ecac3(0x1cf)]({'name':_0x3e1a23[_0x2ecac3(0x1bb)]});console[_0x2ecac3(0x102)](_0x3e0345);if(_0x4481e1[0x0][_0x2ecac3(0xef)]==_0x2ecac3(0x11f)){var _0x57f698=users[_0x2ecac3(0x18b)];console[_0x2ecac3(0x102)](_0x57f698);}else{if(_0x4481e1[0x0][_0x2ecac3(0xef)]==_0x2ecac3(0xf2))var _0x57f698=users[_0x2ecac3(0xf2)];else{if(_0x4481e1[0x0][_0x2ecac3(0xef)]=='German')var _0x57f698=users[_0x2ecac3(0x1e0)];else{if(_0x4481e1[0x0]['language']=='Spanish')var _0x57f698=users[_0x2ecac3(0x1be)];else{if(_0x4481e1[0x0][_0x2ecac3(0xef)]==_0x2ecac3(0x1c9))var _0x57f698=users['French'];else{if(_0x4481e1[0x0][_0x2ecac3(0xef)]==_0x2ecac3(0xf5))var _0x57f698=users[_0x2ecac3(0x162)];else{if(_0x4481e1[0x0][_0x2ecac3(0xef)]==_0x2ecac3(0x12c))var _0x57f698=users[_0x2ecac3(0x12c)];else{if(_0x4481e1[0x0][_0x2ecac3(0xef)]==_0x2ecac3(0x101))var _0x57f698=users[_0x2ecac3(0x1a1)];}}}}}}}_0x4fdfab['render'](_0x2ecac3(0x1b4),{'success':_0x3bf391[_0x2ecac3(0xe6)](_0x2ecac3(0x163)),'errors':_0x3bf391['flash'](_0x2ecac3(0x184)),'role':_0x42c91a,'profile':_0x29d60a,'master_shop':_0x4481e1,'customers':_0x3e0345,'sales':_0x3e1a23,'language':_0x57f698});}catch(_0x4e2feb){console['log'](_0x4e2feb);}}),router['get']('/view/return_sales/:id',auth,async(_0x21e602,_0x2b5ea7)=>{var _0x1a0c4c=a0_0x4254df;try{const {username:_0x2a42b8,email:_0x318230,role:_0x5b683c}=_0x21e602[_0x1a0c4c(0x132)],_0x519851=_0x21e602[_0x1a0c4c(0x132)],_0x25cc99=await profile['findOne']({'email':_0x519851[_0x1a0c4c(0x138)]}),_0x15af2b=await master_shop[_0x1a0c4c(0x15e)](),_0x450030=_0x21e602[_0x1a0c4c(0xe7)]['id'],_0x38c074=await sales_finished[_0x1a0c4c(0x131)](_0x450030),_0x2af76c=await warehouse[_0x1a0c4c(0x11b)]([{'$match':{'name':_0x38c074[_0x1a0c4c(0x12d)]}},{'$unwind':_0x1a0c4c(0xf0)},{'$group':{'_id':_0x1a0c4c(0x136),'name':{'$first':_0x1a0c4c(0x16a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1a0c4c(0xfb)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1a0c4c(0x199)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1a0c4c(0xde)},'product_code':{'$first':_0x1a0c4c(0x1ba)},'storage':{'$first':_0x1a0c4c(0x191)},'rack':{'$first':_0x1a0c4c(0xeb)},'expiry_date':{'$first':_0x1a0c4c(0x149)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0x1a0c4c(0x14c)},'secondary_unit':{'$first':_0x1a0c4c(0x1d0)},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x1a0c4c(0x19f)}}}]),_0x836ae3=await product['find']({}),_0x254251=await warehouse[_0x1a0c4c(0x11b)]([{'$match':{'status':_0x1a0c4c(0x1d3),'warehouse_category':_0x1a0c4c(0x19a),'name':{'$ne':_0x1a0c4c(0x171),'$ne':_0x1a0c4c(0x119)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x2f714a=['Return\x20Rooms'];const _0x588844=await warehouse[_0x1a0c4c(0x11b)]([{'$match':{'status':_0x1a0c4c(0x1d3),'name':'Quality\x20Inspection'}},{'$group':{'_id':_0x1a0c4c(0x109),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x15af2b[0x0][_0x1a0c4c(0xef)]==_0x1a0c4c(0x11f)){var _0x23e032=users[_0x1a0c4c(0x18b)];console[_0x1a0c4c(0x102)](_0x23e032);}else{if(_0x15af2b[0x0][_0x1a0c4c(0xef)]==_0x1a0c4c(0xf2))var _0x23e032=users['Hindi'];else{if(_0x15af2b[0x0][_0x1a0c4c(0xef)]=='German')var _0x23e032=users[_0x1a0c4c(0x1e0)];else{if(_0x15af2b[0x0][_0x1a0c4c(0xef)]==_0x1a0c4c(0x1be))var _0x23e032=users[_0x1a0c4c(0x1be)];else{if(_0x15af2b[0x0][_0x1a0c4c(0xef)]==_0x1a0c4c(0x1c9))var _0x23e032=users[_0x1a0c4c(0x1c9)];else{if(_0x15af2b[0x0][_0x1a0c4c(0xef)]==_0x1a0c4c(0xf5))var _0x23e032=users['Portuguese'];else{if(_0x15af2b[0x0][_0x1a0c4c(0xef)]==_0x1a0c4c(0x12c))var _0x23e032=users[_0x1a0c4c(0x12c)];else{if(_0x15af2b[0x0][_0x1a0c4c(0xef)]=='Arabic\x20(ae)')var _0x23e032=users[_0x1a0c4c(0x1a1)];}}}}}}}_0x2b5ea7['render'](_0x1a0c4c(0x153),{'success':_0x21e602[_0x1a0c4c(0xe6)]('success'),'errors':_0x21e602['flash']('errors'),'role':_0x519851,'profile':_0x25cc99,'user':_0x38c074,'stock':_0x2af76c,'master_shop':_0x15af2b,'unit':_0x836ae3,'language':_0x23e032,'warehouses':_0x254251,'rooms':_0x2f714a,'warehouse_QA':_0x588844});}catch(_0x173d77){console['log'](_0x173d77),_0x2b5ea7[_0x1a0c4c(0x1bf)](0xc8)['json']({'message':_0x173d77[_0x1a0c4c(0x10c)]});}}),router[a0_0x4254df(0x1c8)](a0_0x4254df(0x104),auth,async(_0x1373d5,_0x435ca9)=>{var _0x33bb1d=a0_0x4254df;if(_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0xe3)]=='QA')try{const {invoice:_0x31601d,date:_0x2486ea,warehouse_name:_0x48346c,product_name:_0xf82e3,primary_code:_0x5937d9,secondary_code:_0x9aa3fb,product_code:_0x1dcef4,sales_quantity:_0x2aaa10,stocks:_0xd992c4,return_qty:_0x27b671,Room_name:_0x42aa0c,to_warehouse_name_QA:_0x53f675,to_Room_name_QA:_0x39bc36,note:_0x3e5d17,for_categorize:_0x44bd4d,product_name_QA1:_0xa12c11}=_0x1373d5[_0x33bb1d(0x1e1)];if(typeof _0xa12c11==_0x33bb1d(0x105))var _0x424db1=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x144)]],_0x1edfa3=[_0x1373d5['body'][_0x33bb1d(0xdf)]],_0x4ef920=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x14e)]],_0x46a0a1=[_0x1373d5['body'][_0x33bb1d(0x13e)]],_0x5f74f=[_0x1373d5['body']['sales_quantity_QA']],_0x4c328=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1dd)]],_0x362821=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1d8)]],_0x1e044a=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x139)]],_0xdb96ce=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x150)]],_0x469720=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x128)]],_0x5a8e9a=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0xfe)]],_0x5d4b5d=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x121)]],_0x2d9648=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x135)]],_0xff5590=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x10d)]];else var _0x424db1=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x144)]],_0x1edfa3=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0xdf)]],_0x4ef920=[..._0x1373d5['body'][_0x33bb1d(0x14e)]],_0x46a0a1=[..._0x1373d5['body']['product_code_QA']],_0x5f74f=[..._0x1373d5[_0x33bb1d(0x1e1)]['sales_quantity_QA']],_0x4c328=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1dd)]],_0x362821=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1d8)]],_0x1e044a=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x139)]],_0xdb96ce=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x150)]],_0x469720=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x128)]],_0x5a8e9a=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0xfe)]],_0x5d4b5d=[..._0x1373d5['body'][_0x33bb1d(0x121)]],_0x2d9648=[..._0x1373d5[_0x33bb1d(0x1e1)]['production_date_QA']],_0xff5590=[..._0x1373d5['body'][_0x33bb1d(0x10d)]];const _0x493b60=_0x424db1['map'](_0xe9e8f=>{return _0xe9e8f={'product_name':_0xe9e8f};});_0x1edfa3[_0x33bb1d(0x1d7)]((_0x59c0f2,_0x13a17b)=>{var _0x6a4098=_0x33bb1d;_0x493b60[_0x13a17b][_0x6a4098(0x174)]=_0x59c0f2;}),_0x4ef920['forEach']((_0x5ba3b0,_0x4b48be)=>{var _0x38a3c3=_0x33bb1d;_0x493b60[_0x4b48be][_0x38a3c3(0xe9)]=_0x5ba3b0;}),_0x46a0a1[_0x33bb1d(0x1d7)]((_0x2a146b,_0x45be76)=>{var _0x2c4738=_0x33bb1d;_0x493b60[_0x45be76][_0x2c4738(0x117)]=_0x2a146b;}),_0x5f74f[_0x33bb1d(0x1d7)]((_0xa1c019,_0x20ddd8)=>{var _0x5e8dc3=_0x33bb1d;_0x493b60[_0x20ddd8][_0x5e8dc3(0x19b)]=_0xa1c019;}),_0x4c328['forEach']((_0x360698,_0x3bae25)=>{var _0x2be9ca=_0x33bb1d;_0x493b60[_0x3bae25][_0x2be9ca(0x14a)]=_0x360698;}),_0x362821[_0x33bb1d(0x1d7)]((_0x52933a,_0x11594f)=>{var _0x1e7acc=_0x33bb1d;_0x493b60[_0x11594f][_0x1e7acc(0x147)]=_0x52933a;}),_0x1e044a['forEach']((_0x9445cb,_0x8cc692)=>{_0x493b60[_0x8cc692]['maxPerUnit']=_0x9445cb;}),_0xdb96ce['forEach']((_0x7ca698,_0x48a78b)=>{var _0x35a70f=_0x33bb1d;_0x493b60[_0x48a78b][_0x35a70f(0xf4)]=_0x7ca698;}),_0x469720['forEach']((_0x34e832,_0xae69f4)=>{var _0x294faa=_0x33bb1d;_0x493b60[_0xae69f4][_0x294faa(0x1c1)]=_0x34e832;}),_0x5a8e9a[_0x33bb1d(0x1d7)]((_0x16ed2a,_0x134420)=>{var _0x2156a4=_0x33bb1d;_0x493b60[_0x134420][_0x2156a4(0x11a)]=_0x16ed2a;}),_0x5d4b5d[_0x33bb1d(0x1d7)]((_0x4402b2,_0x2df85b)=>{_0x493b60[_0x2df85b]['unit']=_0x4402b2;}),_0x2d9648[_0x33bb1d(0x1d7)]((_0x282b8c,_0x27ac28)=>{var _0x1353cb=_0x33bb1d;_0x493b60[_0x27ac28][_0x1353cb(0x1e7)]=_0x282b8c;}),_0xff5590[_0x33bb1d(0x1d7)]((_0x353bf3,_0x47f9c3)=>{var _0x17bbec=_0x33bb1d;_0x493b60[_0x47f9c3][_0x17bbec(0x1d5)]=_0x353bf3;});const _0x169710=await sales_finished['findOne']({'invoice':_0x31601d});_0x169710['return_data']=_0x33bb1d(0x1d6);const _0x141885=await _0x169710[_0x33bb1d(0x1ed)](),_0x51c462=new sales_return_finished({'invoice':_0x31601d,'customer':_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1bb)],'date':_0x2486ea,'warehouse_name':_0x48346c,'room':_0x42aa0c,'ToWarehouse':_0x53f675,'ToRoom':_0x39bc36,'return_sale_QA':_0x493b60,'note':_0x3e5d17,'warehouse_cat':_0x44bd4d}),_0x55405b=await _0x51c462[_0x33bb1d(0x1ed)](),_0x1fa99e=await sales_return_finished[_0x33bb1d(0x1cf)]({'invoice':_0x31601d}),_0x3fd4c9=await warehouse[_0x33bb1d(0x1cf)]({'name':_0x53f675,'room':_0x39bc36});_0x1fa99e[_0x33bb1d(0xf6)][_0x33bb1d(0x1d7)](_0x3a2573=>{var _0x2036b2=_0x33bb1d,_0x12685e=0x0;const _0x19b0ac=_0x3fd4c9[_0x2036b2(0x10a)][_0x2036b2(0x16c)](_0x4ab50c=>{var _0x9734ce=_0x2036b2;_0x4ab50c[_0x9734ce(0x1e9)]==_0x3a2573[_0x9734ce(0x1e9)]&&_0x4ab50c[_0x9734ce(0x1d5)]==_0x3a2573['expiry_date']&&_0x4ab50c['production_date']==_0x3a2573['production_date']&&_0x4ab50c['batch_code']==_0x3a2573[_0x9734ce(0x1c1)]&&(_0x4ab50c[_0x9734ce(0x118)]=parseInt(_0x4ab50c[_0x9734ce(0x118)])+parseInt(_0x3a2573[_0x9734ce(0x147)]),_0x12685e++);});_0x12685e=='0'&&(_0x3fd4c9['product_details']=_0x3fd4c9[_0x2036b2(0x10a)][_0x2036b2(0x17b)]({'product_name':_0x3a2573[_0x2036b2(0x1e9)],'product_stock':_0x3a2573[_0x2036b2(0x147)],'primary_code':_0x3a2573[_0x2036b2(0x174)],'secondary_code':_0x3a2573[_0x2036b2(0xe9)],'product_code':_0x3a2573[_0x2036b2(0x117)],'batch_code':_0x3a2573[_0x2036b2(0x1c1)],'maxPerUnit':_0x3a2573[_0x2036b2(0x16f)],'production_date':_0x3a2573[_0x2036b2(0x1e7)],'expiry_date':_0x3a2573[_0x2036b2(0x1d5)],'secondary_unit':_0x3a2573[_0x2036b2(0x11a)],'unit':_0x3a2573[_0x2036b2(0x1bd)],'maxProducts':_0x3a2573[_0x2036b2(0xf4)],'bay':_0x3a2573['bay']}));}),await _0x3fd4c9['save']();const _0x5e6eb5=new c_payment_data({'invoice':_0x31601d,'customer':_0x1373d5['body'][_0x33bb1d(0x1bb)],'reason':_0x33bb1d(0x1c0)});await _0x5e6eb5[_0x33bb1d(0x1ed)]();const _0x2d1719=await master_shop[_0x33bb1d(0x15e)](),_0x15ee21=await email_settings[_0x33bb1d(0x1cf)](),_0x1fbc9f=await customer[_0x33bb1d(0x1cf)]({'name':_0x1373d5['body'][_0x33bb1d(0x1bb)]});_0x2d1719[0x0]['currency_placement']==0x1?(right_currency=_0x2d1719[0x0][_0x33bb1d(0x1bc)],left_currency=''):(right_currency='',left_currency=_0x2d1719[0x0][_0x33bb1d(0x1bc)]);var _0x1b9f99=_0x424db1,_0x117b0e=_0x362821,_0x339520='',_0x14e170;for(_0x14e170 in _0x1b9f99){_0x339520+=_0x33bb1d(0x1d1)+_0x33bb1d(0x13a)+_0x1b9f99[_0x14e170]+_0x33bb1d(0x1ec)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x117b0e[_0x14e170]+_0x33bb1d(0x1ec)+_0x33bb1d(0xf9);}console[_0x33bb1d(0x102)](_0x33bb1d(0x1ab),_0x339520);let _0x34848d=nodemailer[_0x33bb1d(0x1d4)]({'service':_0x33bb1d(0x1b3),'auth':{'user':_0x15ee21[_0x33bb1d(0x138)],'pass':_0x15ee21[_0x33bb1d(0x1ad)]}}),_0x2ec2d3={'from':_0x15ee21[_0x33bb1d(0x138)],'to':_0x1fbc9f[_0x33bb1d(0x138)],'subject':_0x33bb1d(0x1a5),'attachments':[{'filename':'Logo.png','path':__dirname+_0x33bb1d(0x15f)+_0x33bb1d(0x1d2)+_0x2d1719[0x0]['image'],'cid':_0x33bb1d(0x161)}],'html':'<!DOCTYPE\x20html>'+_0x33bb1d(0x129)+_0x33bb1d(0x1e6)+_0x33bb1d(0x145)+_0x33bb1d(0x195)+_0x33bb1d(0x145)+_0x33bb1d(0x100)+_0x33bb1d(0x12e)+_0x33bb1d(0x145)+_0x33bb1d(0xdd)+_0x2d1719[0x0][_0x33bb1d(0x1dc)]+'\x20</h2>'+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x33bb1d(0x145)+_0x33bb1d(0x197)+_0x33bb1d(0xec)+_0x31601d+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x33bb1d(0x10e)+_0x2486ea+'\x20'+_0x33bb1d(0x181)+_0x33bb1d(0x172)+_0x33bb1d(0x12e)+_0x33bb1d(0x160)+_0x33bb1d(0x1f1)+_0x33bb1d(0x1d1)+_0x33bb1d(0x178)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+_0x33bb1d(0x142)+'\x20'+_0x339520+'\x20'+_0x33bb1d(0x124)+_0x33bb1d(0x18a)+_0x33bb1d(0x145)+_0x33bb1d(0x151)+_0x33bb1d(0x183)+_0x2d1719[0x0]['site_title']+_0x33bb1d(0x172)+_0x33bb1d(0x12e)+_0x33bb1d(0x12e)+_0x33bb1d(0x14b)};_0x34848d[_0x33bb1d(0x1a6)](_0x2ec2d3,function(_0x57ac16,_0x6c24){var _0x1d450e=_0x33bb1d;_0x57ac16?(console['log'](_0x57ac16),console['log'](_0x1d450e(0x188))):console[_0x1d450e(0x102)]('Email\x20sent\x20successfully');}),_0x1373d5[_0x33bb1d(0xe6)]('success',_0x33bb1d(0x1ce)),_0x435ca9[_0x33bb1d(0x17c)](_0x33bb1d(0x179));}catch(_0x477118){_0x435ca9[_0x33bb1d(0x1bf)](0xc8)[_0x33bb1d(0x193)]({'message1':_0x477118[_0x33bb1d(0x10c)]});}else{if(_0x1373d5['body'][_0x33bb1d(0xe3)]=='GS')try{const {invoice:_0xc1dd04,date:_0x3f493e,warehouse_name:_0x598980,product_name:_0x4841c3,primary_code:_0x344b4f,secondary_code:_0x4c8d08,product_code:_0x2b3be4,sales_quantity:_0x17b132,stocks:_0x20e02a,return_qty:_0xe5a39d,Room_name:_0x998dab,to_warehouse_name:_0x9104e2,to_Room_name:_0x255710,note:_0x5ee3c5,level:_0xcb441,isle:_0x42f3ac,pallet:_0x16035f,for_categorize:_0x21a94d}=_0x1373d5['body'];if(typeof _0x4841c3==_0x33bb1d(0x105))var _0x424db1=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1e9)]],_0x1edfa3=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x174)]],_0x4ef920=[_0x1373d5[_0x33bb1d(0x1e1)]['secondary_code']],_0x46a0a1=[_0x1373d5['body'][_0x33bb1d(0x117)]],_0x5f74f=[_0x1373d5['body']['sales_quantity']],_0x362821=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x147)]],_0x5433b2=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x173)]],_0x1e044a=[_0x1373d5['body'][_0x33bb1d(0x16f)]],_0xdb96ce=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0xf4)]],_0x469720=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1c1)]],_0x5a8e9a=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x11a)]],_0x5d4b5d=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1bd)]],_0x2d9648=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1e7)]],_0xff5590=[_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1d5)]];else var _0x424db1=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1e9)]],_0x1edfa3=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x174)]],_0x4ef920=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0xe9)]],_0x46a0a1=[..._0x1373d5['body'][_0x33bb1d(0x117)]],_0x5f74f=[..._0x1373d5['body'][_0x33bb1d(0x112)]],_0x362821=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x147)]],_0x5433b2=[..._0x1373d5['body'][_0x33bb1d(0x173)]],_0x1e044a=[..._0x1373d5[_0x33bb1d(0x1e1)]['maxPerUnit']],_0xdb96ce=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0xf4)]],_0x469720=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1c1)]],_0x5a8e9a=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x11a)]],_0x5d4b5d=[..._0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1bd)]],_0x2d9648=[..._0x1373d5['body'][_0x33bb1d(0x1e7)]],_0xff5590=[..._0x1373d5[_0x33bb1d(0x1e1)]['expiry_date']];const _0x353ea3=_0x424db1['map'](_0x2766b1=>{return _0x2766b1={'product_name':_0x2766b1};});_0x1edfa3[_0x33bb1d(0x1d7)]((_0x35d1d9,_0x34aff5)=>{var _0x2027e=_0x33bb1d;_0x353ea3[_0x34aff5][_0x2027e(0x174)]=_0x35d1d9;}),_0x4ef920['forEach']((_0x340301,_0x2e2c54)=>{var _0x116f52=_0x33bb1d;_0x353ea3[_0x2e2c54][_0x116f52(0xe9)]=_0x340301;}),_0x46a0a1[_0x33bb1d(0x1d7)]((_0x45e21b,_0x28193e)=>{var _0x5bffe6=_0x33bb1d;_0x353ea3[_0x28193e][_0x5bffe6(0x117)]=_0x45e21b;}),_0x5f74f[_0x33bb1d(0x1d7)]((_0x387799,_0x421147)=>{var _0xc69f45=_0x33bb1d;_0x353ea3[_0x421147][_0xc69f45(0x19b)]=_0x387799;}),_0x362821[_0x33bb1d(0x1d7)]((_0x4cf1fa,_0x25db6d)=>{var _0x42eb3f=_0x33bb1d;_0x353ea3[_0x25db6d][_0x42eb3f(0x147)]=_0x4cf1fa;}),_0x5433b2['forEach']((_0x34756e,_0x2a98e6)=>{var _0x1e0f92=_0x33bb1d;_0x353ea3[_0x2a98e6][_0x1e0f92(0x173)]=_0x34756e;}),_0x1e044a[_0x33bb1d(0x1d7)]((_0x3a99aa,_0xae7c31)=>{var _0x269c28=_0x33bb1d;_0x353ea3[_0xae7c31][_0x269c28(0x16f)]=_0x3a99aa;}),_0xdb96ce[_0x33bb1d(0x1d7)]((_0x7ec958,_0x5bd21b)=>{_0x353ea3[_0x5bd21b]['maxProducts']=_0x7ec958;}),_0x469720[_0x33bb1d(0x1d7)]((_0x120c7f,_0x56a0f6)=>{var _0x138a09=_0x33bb1d;_0x353ea3[_0x56a0f6][_0x138a09(0x1c1)]=_0x120c7f;}),_0x5a8e9a[_0x33bb1d(0x1d7)]((_0x20f93a,_0x2c1829)=>{var _0x35f982=_0x33bb1d;_0x353ea3[_0x2c1829][_0x35f982(0x11a)]=_0x20f93a;}),_0x5d4b5d[_0x33bb1d(0x1d7)]((_0x325ddf,_0x3a914e)=>{var _0x40ba00=_0x33bb1d;_0x353ea3[_0x3a914e][_0x40ba00(0x1bd)]=_0x325ddf;}),_0x2d9648[_0x33bb1d(0x1d7)]((_0x2324cc,_0xf80ec4)=>{var _0x52c2e0=_0x33bb1d;_0x353ea3[_0xf80ec4][_0x52c2e0(0x1e7)]=_0x2324cc;}),_0xff5590['forEach']((_0x4f0eeb,_0x17056e)=>{var _0x24c586=_0x33bb1d;_0x353ea3[_0x17056e][_0x24c586(0x1d5)]=_0x4f0eeb;});var _0x5aa64c=0x0;_0x353ea3[_0x33bb1d(0x1d7)](_0x95f836=>{var _0x13aa8d=_0x33bb1d;(parseInt(_0x95f836[_0x13aa8d(0x19b)])<parseInt(_0x95f836[_0x13aa8d(0x147)])||parseInt(_0x95f836[_0x13aa8d(0x14a)])<parseInt(_0x95f836[_0x13aa8d(0x147)])&&parseInt(_0x95f836[_0x13aa8d(0x19b)])>parseInt(_0x95f836[_0x13aa8d(0x147)])||parseInt(_0x95f836['return_qty'])==0x0)&&_0x5aa64c++;});if(_0x5aa64c!=0x0)return _0x1373d5['flash'](_0x33bb1d(0x184),_0x33bb1d(0x1c2)),_0x435ca9['redirect']('back');const _0x53b85d=await sales_finished[_0x33bb1d(0x1cf)]({'invoice':_0xc1dd04});_0x53b85d[_0x33bb1d(0x152)]='True';const _0x57bcae=await _0x53b85d[_0x33bb1d(0x1ed)](),_0x5866be=new sales_return_finished({'invoice':_0xc1dd04,'customer':_0x1373d5[_0x33bb1d(0x1e1)]['customer'],'date':_0x3f493e,'warehouse_name':_0x598980,'room':_0x998dab,'ToWarehouse':_0x9104e2,'ToRoom':_0x255710,'return_sale':_0x353ea3,'note':_0x5ee3c5,'warehouse_cat':_0x21a94d}),_0x2f8d3d=await _0x5866be[_0x33bb1d(0x1ed)](),_0x192f46=await sales_return_finished[_0x33bb1d(0x1cf)]({'invoice':_0xc1dd04}),_0x447a65=await warehouse[_0x33bb1d(0x1cf)]({'name':_0x9104e2,'room':_0x255710,'warehouse_category':_0x33bb1d(0x19a)});_0x192f46[_0x33bb1d(0x1a9)][_0x33bb1d(0x1d7)](_0x4d48bd=>{var _0xa550d4=_0x33bb1d,_0x3f1699=0x0;const _0x127e1d=_0x447a65[_0xa550d4(0x10a)][_0xa550d4(0x16c)](_0xabfd04=>{var _0x4605a2=_0xa550d4;_0xabfd04[_0x4605a2(0x1e9)]==_0x4d48bd[_0x4605a2(0x1e9)]&&_0xabfd04[_0x4605a2(0x173)]==_0x4d48bd[_0x4605a2(0x173)]&&_0xabfd04[_0x4605a2(0x1d5)]==_0x4d48bd[_0x4605a2(0x1d5)]&&_0xabfd04[_0x4605a2(0x1e7)]==_0x4d48bd['production_date']&&_0xabfd04[_0x4605a2(0x1c1)]==_0x4d48bd['batch_code']&&(_0xabfd04[_0x4605a2(0x118)]=parseInt(_0xabfd04['product_stock'])+parseInt(_0x4d48bd['return_qty']),_0x3f1699++);});_0x3f1699=='0'&&(_0x447a65['product_details']=_0x447a65[_0xa550d4(0x10a)]['concat']({'product_name':_0x4d48bd[_0xa550d4(0x1e9)],'product_stock':_0x4d48bd[_0xa550d4(0x147)],'primary_code':_0x4d48bd['primary_code'],'secondary_code':_0x4d48bd[_0xa550d4(0xe9)],'product_code':_0x4d48bd[_0xa550d4(0x117)],'bay':_0x4d48bd['bay'],'batch_code':_0x4d48bd['batch_code'],'maxPerUnit':_0x4d48bd[_0xa550d4(0x16f)],'production_date':_0x4d48bd[_0xa550d4(0x1e7)],'expiry_date':_0x4d48bd[_0xa550d4(0x1d5)],'secondary_unit':_0x4d48bd['secondary_unit'],'unit':_0x4d48bd[_0xa550d4(0x1bd)],'maxProducts':_0x4d48bd['maxProducts']}));}),await _0x447a65[_0x33bb1d(0x1ed)](),console[_0x33bb1d(0x102)](_0x1373d5['body']);const _0x4942bb=new c_payment_data({'invoice':_0xc1dd04,'customer':_0x1373d5[_0x33bb1d(0x1e1)][_0x33bb1d(0x1bb)],'reason':'Sale\x20Return'});await _0x4942bb[_0x33bb1d(0x1ed)]();const _0x2bfb54=await master_shop[_0x33bb1d(0x15e)]();console['log'](_0x33bb1d(0xe0),_0x2bfb54[0x0][_0x33bb1d(0xf8)]);const _0x15679e=await email_settings[_0x33bb1d(0x1cf)](),_0xfa301c=await customer['findOne']({'name':_0x1373d5[_0x33bb1d(0x1e1)]['customer']});console['log'](_0x33bb1d(0x196),_0xfa301c);_0x2bfb54[0x0][_0x33bb1d(0x159)]==0x1?(right_currency=_0x2bfb54[0x0][_0x33bb1d(0x1bc)],left_currency=''):(right_currency='',left_currency=_0x2bfb54[0x0][_0x33bb1d(0x1bc)]);var _0x1b9f99=_0x424db1,_0x117b0e=_0x362821,_0x339520='',_0x14e170;for(_0x14e170 in _0x1b9f99){_0x339520+=_0x33bb1d(0x1d1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b9f99[_0x14e170]+_0x33bb1d(0x1ec)+_0x33bb1d(0x13a)+_0x117b0e[_0x14e170]+_0x33bb1d(0x1ec)+_0x33bb1d(0xf9);}console[_0x33bb1d(0x102)]('product_list',_0x339520);let _0x41fc60=nodemailer[_0x33bb1d(0x1d4)]({'service':_0x33bb1d(0x1b3),'auth':{'user':_0x15679e[_0x33bb1d(0x138)],'pass':_0x15679e[_0x33bb1d(0x1ad)]}}),_0x3df2b2={'from':_0x15679e[_0x33bb1d(0x138)],'to':_0xfa301c['email'],'subject':_0x33bb1d(0x1a5),'attachments':[{'filename':'Logo.png','path':__dirname+_0x33bb1d(0x15f)+_0x33bb1d(0x1d2)+_0x2bfb54[0x0][_0x33bb1d(0xf8)],'cid':'logo'}],'html':_0x33bb1d(0x127)+'<html><head><title></title>'+_0x33bb1d(0x1e6)+_0x33bb1d(0x145)+_0x33bb1d(0x195)+'<div>'+_0x33bb1d(0x100)+'</div>'+_0x33bb1d(0x145)+_0x33bb1d(0xdd)+_0x2bfb54[0x0]['site_title']+_0x33bb1d(0x113)+_0x33bb1d(0x12e)+_0x33bb1d(0x12e)+_0x33bb1d(0x148)+_0x33bb1d(0x145)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x33bb1d(0xec)+_0xc1dd04+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x33bb1d(0x10e)+_0x3f493e+'\x20'+_0x33bb1d(0x181)+_0x33bb1d(0x172)+_0x33bb1d(0x12e)+_0x33bb1d(0x160)+_0x33bb1d(0x1f1)+'<tr>'+_0x33bb1d(0x178)+_0x33bb1d(0xfa)+_0x33bb1d(0x1af)+_0x33bb1d(0xed)+'</tr>'+_0x33bb1d(0x17e)+_0x33bb1d(0x142)+'\x20'+_0x339520+'\x20'+'</tbody>'+_0x33bb1d(0x18a)+'<div>'+_0x33bb1d(0x151)+'<h5>'+_0x2bfb54[0x0][_0x33bb1d(0x1dc)]+_0x33bb1d(0x172)+_0x33bb1d(0x12e)+_0x33bb1d(0x12e)+_0x33bb1d(0x14b)};_0x41fc60[_0x33bb1d(0x1a6)](_0x3df2b2,function(_0x16e192,_0x1996fe){var _0x4c6db8=_0x33bb1d;_0x16e192?(console['log'](_0x16e192),console['log'](_0x4c6db8(0x188))):console[_0x4c6db8(0x102)](_0x4c6db8(0x13c));}),_0x1373d5[_0x33bb1d(0xe6)](_0x33bb1d(0x163),_0x33bb1d(0x1ce)),_0x435ca9[_0x33bb1d(0x17c)]('/all_sales_finished/view');}catch(_0x4b393e){console[_0x33bb1d(0x102)](_0x4b393e),_0x435ca9['status'](0xc8)[_0x33bb1d(0x193)]({'message1':_0x4b393e[_0x33bb1d(0x10c)]});}}}),router[a0_0x4254df(0x154)](a0_0x4254df(0x166),auth,async(_0x3a1f5c,_0x5b2e77)=>{var _0x2a207f=a0_0x4254df;try{const {username:_0x14801f,email:_0x5381a3,role:_0x293ec7}=_0x3a1f5c[_0x2a207f(0x132)],_0x333a53=_0x3a1f5c[_0x2a207f(0x132)],_0x3f5f1a=await profile[_0x2a207f(0x1cf)]({'email':_0x333a53[_0x2a207f(0x138)]}),_0x117898=await master_shop[_0x2a207f(0x15e)]();console['log'](_0x2a207f(0x1da),_0x117898);const _0x4a27f8=_0x3a1f5c[_0x2a207f(0xe7)]['id'],_0x2cee35=await sales[_0x2a207f(0x131)](_0x4a27f8);console[_0x2a207f(0x102)]('barcode\x20user_id',_0x2cee35);if(_0x117898[0x0][_0x2a207f(0xef)]==_0x2a207f(0x11f))var _0x338239=users[_0x2a207f(0x18b)];else{if(_0x117898[0x0]['language']==_0x2a207f(0xf2))var _0x338239=users['Hindi'];else{if(_0x117898[0x0][_0x2a207f(0xef)]==_0x2a207f(0x1e0))var _0x338239=users[_0x2a207f(0x1e0)];else{if(_0x117898[0x0][_0x2a207f(0xef)]=='Spanish')var _0x338239=users[_0x2a207f(0x1be)];else{if(_0x117898[0x0][_0x2a207f(0xef)]==_0x2a207f(0x1c9))var _0x338239=users[_0x2a207f(0x1c9)];else{if(_0x117898[0x0][_0x2a207f(0xef)]=='Portuguese\x20(BR)')var _0x338239=users['Portuguese'];else{if(_0x117898[0x0][_0x2a207f(0xef)]==_0x2a207f(0x12c))var _0x338239=users['Chinese'];else{if(_0x117898[0x0][_0x2a207f(0xef)]==_0x2a207f(0x101))var _0x338239=users[_0x2a207f(0x1a1)];}}}}}}}_0x5b2e77[_0x2a207f(0x140)](_0x2a207f(0xdc),{'success':_0x3a1f5c[_0x2a207f(0xe6)]('success'),'errors':_0x3a1f5c[_0x2a207f(0xe6)](_0x2a207f(0x184)),'role':_0x333a53,'profile':_0x3f5f1a,'alldata':_0x2cee35,'master_shop':_0x117898,'language':_0x338239});}catch(_0x4ff4e4){console[_0x2a207f(0x102)](_0x4ff4e4);}}),router['post'](a0_0x4254df(0x165),async(_0x45a891,_0x439e41)=>{var _0xe36d44=a0_0x4254df;const {product_code:_0x3b7718,warehouse_name:_0x4ac34a,rooms_data:_0x55ac41,Roomslist:_0xca9b74}=_0x45a891['body'],_0x5c0475=_0xca9b74['split'](','),_0x17ec59=[];async function _0x2c16bb(_0x2ee2fc){var _0x57f1c6=a0_0x549a;const _0x54944d=await warehouse['aggregate']([{'$match':{'name':_0x4ac34a,'room':_0x2ee2fc}},{'$unwind':_0x57f1c6(0xf0)},{'$match':{'product_details.primary_code':_0x3b7718}},{'$group':{'_id':_0x57f1c6(0x136),'name':{'$first':_0x57f1c6(0x16a)},'product_stock':{'$first':_0x57f1c6(0x192)},'primary_code':{'$first':_0x57f1c6(0x182)},'secondary_code':{'$first':_0x57f1c6(0xde)},'product_code':{'$first':_0x57f1c6(0x1ba)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x57f1c6(0x146)},'type':{'$first':_0x57f1c6(0x1e4)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x57f1c6(0x1d0)},'storage':{'$first':_0x57f1c6(0x191)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x57f1c6(0x149)},'production_date':{'$first':_0x57f1c6(0x120)},'maxPerUnit':{'$first':_0x57f1c6(0x19f)},'batch_code':{'$first':_0x57f1c6(0x1e5)},'product_cat':{'$first':_0x57f1c6(0x106)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x57f1c6(0x10b)},'invoice':{'$first':_0x57f1c6(0x110)}}}]),_0x4ae286=await warehouse['aggregate']([{'$match':{'name':_0x4ac34a,'room':_0x2ee2fc}},{'$unwind':_0x57f1c6(0xf0)},{'$match':{'product_details.secondary_code':_0x3b7718}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x57f1c6(0x192)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x57f1c6(0x1e4)},'pallet':{'$first':_0x57f1c6(0x199)},'unit':{'$first':_0x57f1c6(0x14c)},'secondary_unit':{'$first':_0x57f1c6(0x1d0)},'storage':{'$first':_0x57f1c6(0x191)},'rack':{'$first':_0x57f1c6(0xeb)},'expiry_date':{'$first':_0x57f1c6(0x149)},'production_date':{'$first':_0x57f1c6(0x120)},'maxPerUnit':{'$first':_0x57f1c6(0x19f)},'batch_code':{'$first':_0x57f1c6(0x1e5)},'product_cat':{'$first':_0x57f1c6(0x106)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x57f1c6(0x10b)},'invoice':{'$first':_0x57f1c6(0x110)}}}]);if(_0x54944d[_0x57f1c6(0x176)]>0x0)_0x17ec59[_0x57f1c6(0x1ca)](_0x54944d);else _0x4ae286[_0x57f1c6(0x176)]>0x0&&_0x17ec59['push'](_0x4ae286);}const _0x378160=_0x5c0475[_0xe36d44(0x16c)](_0x15db02=>_0x2c16bb(_0x15db02));await Promise[_0xe36d44(0x190)](_0x378160),_0x439e41['json'](_0x17ec59);}),module['exports']=router;