function a0_0x1ff3(){var _0x484dea=['1155400ejngiM','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','id_transaction_from','$product_details.primary_code','$product_details.product_code','$product_details.maxPerUnit','/upload/','sales_quantity','_id','expiry_date_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','json','for_categorize','$product_details.product_name','\x20Order\x20Date\x20:\x20','</head><body>','product_stock','/view/add_sales/:id','maxPerUnit','return_qty','$product_details.unit','RoomAssigned','get','Sales\x20Update\x20successfully','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','secondary_code','port','secondary_unit_QA','params','$name','master','/view/add_sale/product','maxProducts_QA','$product_details.floorlevel','14333130xeECLF','Arabic','password','return_data','findById','abs','product_code','log','return_qty_QA','Sales\x20Mail','product_data','staff','due_amount','\x20<>\x20','/give_payment/:id','</thead>','product_name_QA1','max','barcode\x20user_id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Enclosed','Sales\x20Add\x20successfully','maxPerUnit_QA','/../public','note','English\x20(US)','sales\x20item\x20return\x20successfull','customers','product','$sale_product.floorlevel','payment\x20successfull','$product_details.rack','</tr>','primary_code','$customer','slice','foreach\x20newproduct','/all_sales/view','\x20Order\x20Number\x20:\x20','gmail','secondary_code_QA','email','/view/return_sales/:id','level','$finalize','product_list','$warehouse_name','redirect','$date','edit_sales_finished_view','logo','product_name','/all_sales_finished/view','$invoice','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','$sale_product.bay','French','$sale_product.quantity','quantity','$product_details.bay','<span\x20style=\x22float:\x20right;\x22>','unit','Logo.png','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_stock','Received\x20Payment\x20For\x20Sale','barcode\x20Product\x20master','currency_placement','../middleware/auth','max_per_unit','split','Portuguese','</h5>','unit_QA','/all_sales_finished/preview/','createTransport','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','5449908jGVNnb','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details._id','</td>','Finished\x20Goods','primary_code_QA','$sale_product','express','674330UEuclQ','5mYGhGl','purchases_data','stock_data','$product_details','production_date','errors','adjust_qty','$product','filter','<h5>','all_sales_finished','$_id','return_sale_finished','production_date_QA','$product.product_name','currency','secondary_unit','room_name','$product_details.secondary_code','batch_code','<tr>','name','image','Sale','warehouse','user','/barcode_scanner','render','653268rhbdDB','$product_details.bin','<strong>\x20Regards\x20</strong>','Chinese','</table>','suppliers','carton','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','customer','/invoice/:id','Hindi','$room','sale_product','$sale_product.bin','$product_details.production_date','$product_details.storage','forEach','length','invoice','<h2>\x20','body','room','flash','$product_details.maxProducts','catch','bay','out_invoice','then','customer_data','save','product_code_QA','message','Sale\x20Return\x20Mail','finalize','random','<tbody\x20style=\x22text-align:\x20center;\x22>','sales_quantity_QA','sales_invoice','received_amount','status','German','\x20</h2>','padStart','expiry_date','push','/picking_list/pdf/','sale_qty','batch_code_QA','FGSEmail','Sale\x20Return','</div>','success','customers_docs','</span>','prod_invoice','/barcode/:id','$product_details.product_cat','</tbody>','$product_details.type','product_details','/view','final','Enabled','An\x20error\x20occurred.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/preview/:id','aggregate','False','$customers_docs','prod_code','map','True','<hr\x20class=\x22my-3\x22>','prod_cat','find','language','maxProducts','sendMail','$note','<html><head><title></title>','stock','Portuguese\x20(BR)','Ambient','site_title','error','/view/:id','concat','back','Quality\x20Inspection','Arabic\x20(ae)','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','warehouse_name','findOne','Spanish','Error\x20Occurs','toString','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.expiry_date','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<!DOCTYPE\x20html>','exports','124dbhoYD','/view/add_sales','getFullYear','$product_details.invoice','Email\x20sent\x20successfully','5974084PqGUTb','$product_details.room_name','$return_data','Return\x20Rooms','OUTF-','<div>','English','getMonth','$product_details.batch_code','maxperunit','$product_details.secondary_unit','42486iwPVts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','product_date','post','QA\x20Warehouse','</body></html>','primary_unit','string'];a0_0x1ff3=function(){return _0x484dea;};return a0_0x1ff3();}var a0_0x40c111=a0_0x281b;(function(_0x4599af,_0x1e837b){var _0x5dea30=a0_0x281b,_0x567971=_0x4599af();while(!![]){try{var _0x4eff33=-parseInt(_0x5dea30(0xa0))/0x1+-parseInt(_0x5dea30(0x124))/0x2*(-parseInt(_0x5dea30(0x134))/0x3)+-parseInt(_0x5dea30(0x129))/0x4+parseInt(_0x5dea30(0xa1))/0x5*(parseInt(_0x5dea30(0x97))/0x6)+-parseInt(_0x5dea30(0xbd))/0x7+-parseInt(_0x5dea30(0x13c))/0x8+parseInt(_0x5dea30(0x15e))/0x9;if(_0x4eff33===_0x1e837b)break;else _0x567971['push'](_0x567971['shift']());}catch(_0x3abb50){_0x567971['push'](_0x567971['shift']());}}}(a0_0x1ff3,0xeda14));const express=require(a0_0x40c111(0x9f)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x40c111(0x8d)),nodemailer=require('nodemailer'),users=require('../public/language/languages.json');router['get'](a0_0x40c111(0xf9),auth,async(_0x1e66c5,_0x10fe6b)=>{var _0x1f0e68=a0_0x40c111;try{const {username:_0x3a0271,email:_0x1ec495,role:_0x31ced9}=_0x1e66c5['user'],_0x1aa877=_0x1e66c5[_0x1f0e68(0xba)],_0x3a228b=await profile[_0x1f0e68(0x119)]({'email':_0x1aa877[_0x1f0e68(0x187)]}),_0x5cf085=await master_shop[_0x1f0e68(0x107)]();let _0x51fbfd;if(_0x1aa877[_0x1f0e68(0x98)]==_0x1f0e68(0x169)){const _0x4f7dac=await staff['findOne']({'email':_0x1aa877[_0x1f0e68(0x187)]});_0x51fbfd=await sales_finished['aggregate']([{'$lookup':{'from':'customers','localField':_0x1f0e68(0xc5),'foreignField':_0x1f0e68(0xb6),'as':_0x1f0e68(0xf1)}},{'$unwind':_0x1f0e68(0x101)},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x1f0e68(0x180)},'date':{'$first':_0x1f0e68(0x79)},'warehouse_name':{'$first':_0x1f0e68(0x77)},'sale_product':{'$push':_0x1f0e68(0x9e)},'note':{'$first':_0x1f0e68(0x10b)},'return_data':{'$first':_0x1f0e68(0x12b)},'customers_docs':{'$first':_0x1f0e68(0x101)},'total_saleproduct_quantity':{'$sum':_0x1f0e68(0x82)},'level':{'$addToSet':_0x1f0e68(0x80)},'isle':{'$addToSet':_0x1f0e68(0xca)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x1f0e68(0x17b)},'finalize':{'$first':_0x1f0e68(0x18a)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x51fbfd=await sales_finished[_0x1f0e68(0xff)]([{'$lookup':{'from':_0x1f0e68(0x179),'localField':_0x1f0e68(0xc5),'foreignField':_0x1f0e68(0xb6),'as':_0x1f0e68(0xf1)}},{'$unwind':_0x1f0e68(0x101)},{'$unwind':_0x1f0e68(0x9e)},{'$group':{'_id':_0x1f0e68(0xac),'invoice':{'$first':_0x1f0e68(0x7e)},'customers':{'$first':_0x1f0e68(0x180)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1f0e68(0x77)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x1f0e68(0x10b)},'return_data':{'$first':_0x1f0e68(0x12b)},'customers_docs':{'$first':_0x1f0e68(0x101)},'total_saleproduct_quantity':{'$sum':_0x1f0e68(0x82)},'level':{'$addToSet':_0x1f0e68(0x80)},'isle':{'$addToSet':_0x1f0e68(0xca)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x1f0e68(0x18a)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x5cf085[0x0]['language']==_0x1f0e68(0x177)){var _0x25068f=users[_0x1f0e68(0x12f)];console['log'](_0x25068f);}else{if(_0x5cf085[0x0][_0x1f0e68(0x108)]==_0x1f0e68(0xc7))var _0x25068f=users[_0x1f0e68(0xc7)];else{if(_0x5cf085[0x0][_0x1f0e68(0x108)]=='German')var _0x25068f=users['German'];else{if(_0x5cf085[0x0]['language']==_0x1f0e68(0x11a))var _0x25068f=users['Spanish'];else{if(_0x5cf085[0x0][_0x1f0e68(0x108)]==_0x1f0e68(0x81))var _0x25068f=users['French'];else{if(_0x5cf085[0x0]['language']==_0x1f0e68(0x10e))var _0x25068f=users[_0x1f0e68(0x90)];else{if(_0x5cf085[0x0][_0x1f0e68(0x108)]==_0x1f0e68(0xc0))var _0x25068f=users[_0x1f0e68(0xc0)];else{if(_0x5cf085[0x0][_0x1f0e68(0x108)]=='Arabic\x20(ae)')var _0x25068f=users[_0x1f0e68(0x15f)];}}}}}}}_0x10fe6b['render'](_0x1f0e68(0xab),{'success':_0x1e66c5[_0x1f0e68(0xd3)](_0x1f0e68(0xf0)),'errors':_0x1e66c5[_0x1f0e68(0xd3)](_0x1f0e68(0xa6)),'sales':_0x51fbfd,'profile':_0x3a228b,'role':_0x1aa877,'master_shop':_0x5cf085,'language':_0x25068f});}catch(_0x1555cc){console[_0x1f0e68(0x165)](_0x1555cc);}});async function getRandom8DigitNumber(){var _0x49af68=a0_0x40c111;const _0x498fac=0x989680,_0x10d80b=0x5f5e0ff,_0x7645f=Math['floor'](Math[_0x49af68(0xdf)]()*(_0x10d80b-_0x498fac+0x1))+_0x498fac;var _0x50a98f;const _0x147fe8=await sales_finished[_0x49af68(0x119)]({'invoice':_0x49af68(0x12d)+_0x7645f});return _0x147fe8&&_0x147fe8[_0x49af68(0xce)]>0x0?_0x50a98f=_0x49af68(0x12d)+_0x7645f:_0x50a98f=_0x49af68(0x12d)+_0x7645f,_0x50a98f;}function a0_0x281b(_0x1f5962,_0xe1a4e9){var _0x1ff3c8=a0_0x1ff3();return a0_0x281b=function(_0x281baf,_0x1bdc40){_0x281baf=_0x281baf-0x77;var _0x3014c4=_0x1ff3c8[_0x281baf];return _0x3014c4;},a0_0x281b(_0x1f5962,_0xe1a4e9);}router['get'](a0_0x40c111(0x125),auth,async(_0x265c94,_0x1c4c4a)=>{var _0x15fa9f=a0_0x40c111;try{const {username:_0x29a678,email:_0x55d2ca,role:_0x5270c6}=_0x265c94[_0x15fa9f(0xba)],_0x524032=_0x265c94[_0x15fa9f(0xba)],_0x5ce82f=await profile[_0x15fa9f(0x119)]({'email':_0x524032[_0x15fa9f(0x187)]}),_0x126b74=await master_shop[_0x15fa9f(0x107)](),_0x16ab94=await customer['find']({});let _0x235a5f;if(_0x524032['role']==_0x15fa9f(0x169)){const _0x3f39b4=await staff[_0x15fa9f(0x119)]({'email':_0x524032[_0x15fa9f(0x187)]});_0x235a5f=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x3f39b4['warehouse'],'warehouse_category':_0x15fa9f(0x9c),'name':{'$ne':_0x15fa9f(0x138)}}},{'$group':{'_id':_0x15fa9f(0x159),'name':{'$first':_0x15fa9f(0x159)}}},{'$sort':{'name':0x1}}]);}else _0x235a5f=await warehouse[_0x15fa9f(0xff)]([{'$match':{'status':_0x15fa9f(0xfb),'warehouse_category':_0x15fa9f(0x9c),'name':{'$ne':_0x15fa9f(0x138)}}},{'$group':{'_id':_0x15fa9f(0x159),'name':{'$first':_0x15fa9f(0x159)}}},{'$sort':{'name':0x1}}]);const _0x519ccc=await product[_0x15fa9f(0x107)]({});var _0x8b629c=[_0x15fa9f(0x10f),_0x15fa9f(0x172)];const _0x47d66e=await sales_finished[_0x15fa9f(0x107)]({}),_0x1d12c3=_0x47d66e[_0x15fa9f(0xce)]+0x1,_0x5502a9=_0x15fa9f(0x12d)+_0x1d12c3[_0x15fa9f(0x11c)]()[_0x15fa9f(0xe7)](0x5,'0');if(_0x126b74[0x0][_0x15fa9f(0x108)]==_0x15fa9f(0x177)){var _0x46c1f2=users[_0x15fa9f(0x12f)];console[_0x15fa9f(0x165)](_0x46c1f2);}else{if(_0x126b74[0x0][_0x15fa9f(0x108)]=='Hindi')var _0x46c1f2=users[_0x15fa9f(0xc7)];else{if(_0x126b74[0x0][_0x15fa9f(0x108)]==_0x15fa9f(0xe5))var _0x46c1f2=users[_0x15fa9f(0xe5)];else{if(_0x126b74[0x0][_0x15fa9f(0x108)]==_0x15fa9f(0x11a))var _0x46c1f2=users[_0x15fa9f(0x11a)];else{if(_0x126b74[0x0][_0x15fa9f(0x108)]==_0x15fa9f(0x81))var _0x46c1f2=users[_0x15fa9f(0x81)];else{if(_0x126b74[0x0][_0x15fa9f(0x108)]==_0x15fa9f(0x10e))var _0x46c1f2=users[_0x15fa9f(0x90)];else{if(_0x126b74[0x0][_0x15fa9f(0x108)]==_0x15fa9f(0xc0))var _0x46c1f2=users[_0x15fa9f(0xc0)];else{if(_0x126b74[0x0][_0x15fa9f(0x108)]==_0x15fa9f(0x116))var _0x46c1f2=users['Arabic'];}}}}}}}const _0x781a70=getRandom8DigitNumber();_0x781a70[_0x15fa9f(0xd8)](_0x28a85d=>{var _0x284fe4=_0x15fa9f;_0x1c4c4a[_0x284fe4(0xbc)]('add_sales_finished',{'success':_0x265c94[_0x284fe4(0xd3)](_0x284fe4(0xf0)),'errors':_0x265c94[_0x284fe4(0xd3)](_0x284fe4(0xa6)),'role':_0x524032,'profile':_0x5ce82f,'customer':_0x16ab94,'warehouse':_0x235a5f,'product':_0x519ccc,'invoice':_0x28a85d,'master_shop':_0x126b74,'language':_0x46c1f2,'rooms_data':_0x8b629c});})[_0x15fa9f(0xd5)](_0x547d1a=>{var _0x401484=_0x15fa9f;_0x265c94[_0x401484(0xd3)](_0x401484(0xa6),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1c4c4a['redirect'](_0x401484(0x7d));});}catch(_0x1e3180){console['log'](_0x1e3180);}}),router[a0_0x40c111(0x152)](a0_0x40c111(0x14d),auth,async(_0x54cd00,_0x4f3c2d)=>{var _0x455bb3=a0_0x40c111;try{const _0x27207a=_0x54cd00[_0x455bb3(0x158)]['id'];console['log'](_0x27207a);const _0x198130=await product[_0x455bb3(0x107)](),_0x24e35a=await purchases['aggregate']([{'$match':{'warehouse_name':_0x27207a}},{'$unwind':_0x455bb3(0xa8)},{'$group':{'_id':_0x455bb3(0xaf)}}]);console[_0x455bb3(0x165)](_0x455bb3(0xa2),_0x24e35a),_0x4f3c2d['status'](0xc8)[_0x455bb3(0x147)]({'purchases_data':_0x24e35a,'product_data':_0x198130});}catch(_0x48daa0){console[_0x455bb3(0x165)](_0x48daa0);}}),router['post'](a0_0x40c111(0x15b),auth,async(_0x3c7a99,_0x5603ca)=>{var _0x57a7e7=a0_0x40c111;try{const {warehouse_data:_0x4078ce,product_data:_0x45a882}=_0x3c7a99['body'];console[_0x57a7e7(0x165)](_0x3c7a99[_0x57a7e7(0xd1)][_0x57a7e7(0x168)]);;const _0x18f1f4=await master_shop[_0x57a7e7(0x107)]();console['log'](_0x57a7e7(0x15a),_0x18f1f4);const _0x1a1d38=await product[_0x57a7e7(0x119)]({'name':_0x45a882});console['log'](_0x57a7e7(0x17a),_0x1a1d38);const _0xde1fae=await warehouse[_0x57a7e7(0xff)]([{'$match':{'name':_0x4078ce}},{'$unwind':_0x57a7e7(0xa4)},{'$match':{'product_details.product_name':_0x45a882}},{'$group':{'_id':_0x57a7e7(0x149),'product_stock':{'$first':_0x57a7e7(0x89)}}}]);console[_0x57a7e7(0x165)](_0x57a7e7(0xa3),_0xde1fae),_0x5603ca[_0x57a7e7(0xe4)](0xc8)[_0x57a7e7(0x147)]({'master':_0x18f1f4,'new_product':_0x1a1d38,'stock_data':_0xde1fae});}catch(_0x9bc7e){console[_0x57a7e7(0x165)](_0x9bc7e);}}),router['post'](a0_0x40c111(0x125),auth,async(_0x589058,_0xe1dbc9)=>{var _0x5d73ad=a0_0x40c111;try{const {invoice:_0x4fe5fc,date:_0x20be95,warehouse_name:_0x7e6d63,product_name:_0x2415d0,stock:_0x988621,quantity:_0x138491,note:_0x3f929e,room:_0x41d401,primary_code:_0x3f487c,secondary_code:_0x5c8290,prod_code:_0x170eca,level:_0x4da8a7,isle:_0x49e83f,pallet:_0x1507da,batch_code:_0x1f844f,SCRN:_0x56500e,expiry_date:_0x1ce113,mode_transpo:_0x58a258,name_driver:_0x44ef79}=_0x589058[_0x5d73ad(0xd1)];if(typeof _0x2415d0=='string')var _0xb40589=[_0x589058[_0x5d73ad(0xd1)]['product_name']],_0x220c2c=[_0x589058[_0x5d73ad(0xd1)]['stock']],_0x4878f4=[_0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0xc3)]],_0x446af7=[_0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x17f)]],_0x1ff4a1=[_0x589058['body']['secondary_code']],_0x2d247e=[_0x589058[_0x5d73ad(0xd1)]['prod_code']],_0x12f084=[_0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x189)]],_0x40eb80=[_0x589058['body']['primary_unit']],_0x193420=[_0x589058['body'][_0x5d73ad(0xb1)]],_0x2d0b1b=[_0x589058['body'][_0x5d73ad(0xb4)]],_0x43e31c=[_0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0xe8)]],_0x25dcbf=[_0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x136)]],_0x11d835=[_0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x8e)]],_0x4c0cf3=[_0x589058[_0x5d73ad(0xd1)]['prod_cat']],_0x3802db=[_0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x151)]],_0x2c8e15=[_0x589058[_0x5d73ad(0xd1)]['prod_invoice']],_0x350f75=[_0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x13e)]];else var _0xb40589=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x7c)]],_0x220c2c=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x10d)]],_0x4878f4=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0xc3)]],_0x446af7=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x17f)]],_0x1ff4a1=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x155)]],_0x2d247e=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x102)]],_0x12f084=[..._0x589058[_0x5d73ad(0xd1)]['level']],_0x40eb80=[..._0x589058['body'][_0x5d73ad(0x13a)]],_0x193420=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0xb1)]],_0x2d0b1b=[..._0x589058[_0x5d73ad(0xd1)]['batch_code']],_0x43e31c=[..._0x589058['body'][_0x5d73ad(0xe8)]],_0x25dcbf=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x136)]],_0x11d835=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x8e)]],_0x4c0cf3=[..._0x589058['body'][_0x5d73ad(0x106)]],_0x3802db=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x151)]],_0x2c8e15=[..._0x589058['body'][_0x5d73ad(0xf3)]],_0x350f75=[..._0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0x13e)]];const _0x59e379=_0xb40589[_0x5d73ad(0x103)](_0x33972a=>{return _0x33972a={'product_name':_0x33972a};});_0x220c2c[_0x5d73ad(0xcd)]((_0x51c5a8,_0x1b68c7)=>{var _0x317689=_0x5d73ad;_0x59e379[_0x1b68c7][_0x317689(0x10d)]=_0x51c5a8;}),_0x4878f4[_0x5d73ad(0xcd)]((_0x14b16c,_0x1a7a02)=>{var _0x2a3625=_0x5d73ad;_0x59e379[_0x1a7a02][_0x2a3625(0x83)]=Math[_0x2a3625(0x163)](_0x14b16c);}),_0x350f75[_0x5d73ad(0xcd)]((_0x349ced,_0x132daa)=>{var _0xb264f1=_0x5d73ad;_0x59e379[_0x132daa][_0xb264f1(0x13e)]=_0x349ced;}),_0x446af7['forEach']((_0x29e3fc,_0x1f16b7)=>{var _0x3e5681=_0x5d73ad;_0x59e379[_0x1f16b7][_0x3e5681(0x17f)]=_0x29e3fc;}),_0x1ff4a1[_0x5d73ad(0xcd)]((_0x5b64dc,_0x45efbb)=>{var _0x32a033=_0x5d73ad;_0x59e379[_0x45efbb][_0x32a033(0x155)]=_0x5b64dc;}),_0x2d247e[_0x5d73ad(0xcd)]((_0x45263e,_0x5097ff)=>{var _0x58fa6f=_0x5d73ad;_0x59e379[_0x5097ff][_0x58fa6f(0x164)]=_0x45263e,_0x59e379[_0x5097ff]['date_data']=_0x20be95;}),_0x12f084['forEach']((_0x3d0ec5,_0x415f07)=>{var _0x36d903=_0x5d73ad;_0x59e379[_0x415f07][_0x36d903(0xd6)]=_0x3d0ec5;}),_0x40eb80[_0x5d73ad(0xcd)]((_0x47bc2d,_0x188cb8)=>{_0x59e379[_0x188cb8]['unit']=_0x47bc2d;}),_0x193420[_0x5d73ad(0xcd)]((_0x4bed1d,_0x43236)=>{_0x59e379[_0x43236]['secondary_unit']=_0x4bed1d;}),_0x2d0b1b['forEach']((_0x3e7239,_0x3d6f77)=>{var _0x528aaa=_0x5d73ad;_0x59e379[_0x3d6f77][_0x528aaa(0xb4)]=_0x3e7239;}),_0x43e31c['forEach']((_0x2154cd,_0x3190f4)=>{_0x59e379[_0x3190f4]['expiry_date']=_0x2154cd;}),_0x25dcbf[_0x5d73ad(0xcd)]((_0x29e0ca,_0x49fe19)=>{_0x59e379[_0x49fe19]['production_date']=_0x29e0ca;}),_0x11d835['forEach']((_0x31d8e8,_0x326fb2)=>{var _0xebe292=_0x5d73ad;_0x59e379[_0x326fb2][_0xebe292(0x132)]=_0x31d8e8;}),_0x4c0cf3[_0x5d73ad(0xcd)]((_0x5a9dc4,_0x5616fd)=>{_0x59e379[_0x5616fd]['prod_cat']=_0x5a9dc4;}),_0x3802db[_0x5d73ad(0xcd)]((_0x49904d,_0x19682c)=>{var _0x42ed78=_0x5d73ad;_0x59e379[_0x19682c][_0x42ed78(0xb2)]=_0x49904d;}),_0x2c8e15[_0x5d73ad(0xcd)]((_0x2e6944,_0x175a43)=>{var _0x551e83=_0x5d73ad;_0x59e379[_0x175a43][_0x551e83(0xcf)]=_0x2e6944;});var _0x32f6c0=0x0;_0x59e379[_0x5d73ad(0xcd)](_0x590469=>{var _0x563911=_0x5d73ad;parseFloat(_0x590469[_0x563911(0x10d)])<parseFloat(_0x590469[_0x563911(0x83)])&&parseFloat(_0x590469[_0x563911(0x83)])>parseFloat(_0x590469['stock'])&&(console[_0x563911(0x165)](_0x590469[_0x563911(0x10d)]+_0x563911(0x16b)+_0x590469[_0x563911(0x83)]),_0x32f6c0++);});if(_0x32f6c0!=0x0)return _0x589058[_0x5d73ad(0xd3)]('errors',_0x5d73ad(0x7f)),_0xe1dbc9[_0x5d73ad(0x78)](_0x5d73ad(0x114));const _0x18ae1e=_0x59e379[_0x5d73ad(0xa9)](_0x10e68d=>_0x10e68d[_0x5d73ad(0x83)]!=='0'&&_0x10e68d['quantity']!==''),_0x47cccf=new sales_finished({'invoice':_0x4fe5fc,'customer':_0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0xc5)],'date':_0x20be95,'warehouse_name':_0x7e6d63,'sale_product':_0x18ae1e,'note':_0x3f929e,'room':_0x41d401,'primary_code':_0x3f487c,'secondary_code':_0x5c8290,'prod_code':_0x170eca,'SCRN':_0x56500e,'finalize':_0x5d73ad(0x100),'mode_transpo':_0x58a258,'name_driver':_0x44ef79}),_0x4cd41e=await _0x47cccf[_0x5d73ad(0xda)](),_0xc9f90c=await sales_finished['findOne']({'invoice':_0x4fe5fc}),_0x8f8041=new c_payment_data({'invoice':_0x4fe5fc,'customer':_0x589058[_0x5d73ad(0xd1)][_0x5d73ad(0xc5)],'reason':_0x5d73ad(0xb8)});await _0x8f8041[_0x5d73ad(0xda)]();const _0xb8e599=await master_shop[_0x5d73ad(0x107)](),_0x5771e5=await email_settings[_0x5d73ad(0x119)](),_0x2f2627=await customer['findOne']({'name':_0x589058['body'][_0x5d73ad(0xc5)]});_0xb8e599[0x0][_0x5d73ad(0x8c)]==0x1?(right_currency=_0xb8e599[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0xb8e599[0x0][_0x5d73ad(0xb0)]);var _0x351332=_0xb40589,_0x46d0fa=_0x4878f4,_0x20ca40='',_0x442dde;for(_0x442dde in _0x351332){_0x20ca40+='<tr>'+_0x5d73ad(0x88)+_0x351332[_0x442dde]+'</td>'+_0x5d73ad(0x88)+_0x46d0fa[_0x442dde]+'</td>'+'</tr>';}console['log'](_0x5d73ad(0x18b),_0x20ca40),_0x589058['flash'](_0x5d73ad(0xf0),_0x5d73ad(0x173)),_0xe1dbc9[_0x5d73ad(0x78)](_0x5d73ad(0x93)+_0x4cd41e[_0x5d73ad(0x144)]);}catch(_0x5862fa){console[_0x5d73ad(0x165)](_0x5862fa);}}),router[a0_0x40c111(0x152)](a0_0x40c111(0xfe),auth,async(_0xa893e5,_0xa13b4c)=>{var _0x1343a5=a0_0x40c111;try{const {username:_0x3c6c6f,email:_0x4a55d2,role:_0x1118ea}=_0xa893e5[_0x1343a5(0xba)],_0x4c9b6a=_0xa893e5[_0x1343a5(0xba)],_0xad5cc1=await profile['findOne']({'email':_0x4c9b6a[_0x1343a5(0x187)]}),_0x56038a=await master_shop['find'](),_0x2357fa=_0xa893e5['params']['id'],_0x5a4e81=await sales_finished[_0x1343a5(0x162)](_0x2357fa),_0x53d675=await warehouse['aggregate']([{'$match':{'name':_0x5a4e81['warehouse_name']}},{'$unwind':_0x1343a5(0xa4)},{'$group':{'_id':_0x1343a5(0x9a),'name':{'$first':_0x1343a5(0x149)},'product_stock':{'$first':_0x1343a5(0x89)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1343a5(0xbe)},'type':{'$first':_0x1343a5(0xf7)},'floorlevel':{'$first':_0x1343a5(0x15d)},'primary_code':{'$first':_0x1343a5(0x13f)},'secondary_code':{'$first':_0x1343a5(0xb3)},'product_code':{'$first':_0x1343a5(0x140)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1343a5(0x17d)},'expiry_date':{'$first':_0x1343a5(0x120)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x1343a5(0x131)},'room':{'$first':_0x1343a5(0xc8)},'room_data':{'$first':_0x1343a5(0x12a)}}}]),_0x3de863=await customer[_0x1343a5(0x107)]({});let _0x3d38ae;if(_0x4c9b6a[_0x1343a5(0x98)]==_0x1343a5(0x169)){const _0x47dd23=await staff[_0x1343a5(0x119)]({'email':_0x4c9b6a['email']});_0x3d38ae=await warehouse[_0x1343a5(0xff)]([{'$match':{'status':_0x1343a5(0xfb),'name':_0x47dd23[_0x1343a5(0xb9)]}},{'$group':{'_id':_0x1343a5(0x159),'name':{'$first':'$name'}}}]);}else _0x3d38ae=await warehouse[_0x1343a5(0xff)]([{'$match':{'status':_0x1343a5(0xfb)}},{'$group':{'_id':_0x1343a5(0x159),'name':{'$first':_0x1343a5(0x159)}}}]);const _0x1d56de=await product[_0x1343a5(0x107)]({});if(_0x56038a[0x0][_0x1343a5(0x108)]==_0x1343a5(0x177)){var _0x3dd71f=users['English'];console[_0x1343a5(0x165)](_0x3dd71f);}else{if(_0x56038a[0x0][_0x1343a5(0x108)]==_0x1343a5(0xc7))var _0x3dd71f=users[_0x1343a5(0xc7)];else{if(_0x56038a[0x0][_0x1343a5(0x108)]==_0x1343a5(0xe5))var _0x3dd71f=users[_0x1343a5(0xe5)];else{if(_0x56038a[0x0][_0x1343a5(0x108)]==_0x1343a5(0x11a))var _0x3dd71f=users[_0x1343a5(0x11a)];else{if(_0x56038a[0x0][_0x1343a5(0x108)]==_0x1343a5(0x81))var _0x3dd71f=users[_0x1343a5(0x81)];else{if(_0x56038a[0x0]['language']==_0x1343a5(0x10e))var _0x3dd71f=users[_0x1343a5(0x90)];else{if(_0x56038a[0x0]['language']==_0x1343a5(0xc0))var _0x3dd71f=users[_0x1343a5(0xc0)];else{if(_0x56038a[0x0]['language']==_0x1343a5(0x116))var _0x3dd71f=users[_0x1343a5(0x15f)];}}}}}}}_0xa13b4c[_0x1343a5(0xbc)](_0x1343a5(0x7a),{'success':_0xa893e5[_0x1343a5(0xd3)](_0x1343a5(0xf0)),'errors':_0xa893e5[_0x1343a5(0xd3)](_0x1343a5(0xa6)),'role':_0x4c9b6a,'profile':_0xad5cc1,'customer':_0x3de863,'warehouse':_0x3d38ae,'product':_0x53d675,'user':_0x5a4e81,'master_shop':_0x56038a,'unit':_0x1d56de,'language':_0x3dd71f});}catch(_0x58f82e){console[_0x1343a5(0x165)](_0x58f82e);}}),router['post'](a0_0x40c111(0xfe),auth,async(_0x18f154,_0x3e8528)=>{var _0x52a9c7=a0_0x40c111;try{const _0x1e4e8a=_0x18f154['params']['id'],{invoice:_0x712d46,warehouse_name:_0xeb70d2,room:_0x3c5b5f}=_0x18f154[_0x52a9c7(0xd1)],_0x52aac8=await sales_finished['findOne']({'invoice':_0x712d46}),_0x23af61=_0x52aac8[_0x52a9c7(0xc9)][_0x52a9c7(0x103)](async _0x38b575=>{var _0x3ada38=_0x52a9c7,_0x109803=await warehouse[_0x3ada38(0x119)]({'name':_0xeb70d2,'room':_0x38b575[_0x3ada38(0xb2)],'warehouse_category':'Finished\x20Goods'});const _0x37ea1e=_0x109803[_0x3ada38(0xf8)][_0x3ada38(0x103)](_0x5429e5=>{var _0x4d025e=_0x3ada38;if(_0x5429e5[_0x4d025e(0x7c)]==_0x38b575[_0x4d025e(0x7c)]&&_0x5429e5[_0x4d025e(0xd6)]==_0x38b575['bay']&&_0x5429e5[_0x4d025e(0xe8)]==_0x38b575[_0x4d025e(0xe8)]&&_0x5429e5[_0x4d025e(0xa5)]==_0x38b575['production_date']&&_0x5429e5['batch_code']==_0x38b575[_0x4d025e(0xb4)]&&_0x5429e5[_0x4d025e(0x144)]==_0x38b575[_0x4d025e(0x13e)]){if(_0x5429e5[_0x4d025e(0x14c)]>0x0){_0x5429e5[_0x4d025e(0x14c)]=Math[_0x4d025e(0x16f)](0x0,Math[_0x4d025e(0x163)](_0x5429e5['product_stock'])-Math['abs'](_0x38b575['quantity']));if(_0x5429e5['out_invoice']==undefined)_0x5429e5[_0x4d025e(0xd7)]=_0x712d46+'~';else{var _0x3bd981=_0x5429e5['out_invoice']['split']('~'),_0x3c76be='';for(let _0x304134=0x0;_0x304134<=_0x3bd981['length']-0x1;_0x304134++){const _0xd8501c=_0x3bd981[_0x304134];_0xd8501c['length']>0x0&&(_0x3c76be+=_0xd8501c+'~');}_0x5429e5[_0x4d025e(0xd7)]=_0x3c76be;}}}});return console[_0x3ada38(0x165)](_0x109803),_0x109803;});Promise['all'](_0x23af61)['then'](async _0xb0235a=>{var _0x10948c=_0x52a9c7;try{for(const _0x243fa4 of _0xb0235a){await _0x243fa4[_0x10948c(0xda)]();}_0x52aac8[_0x10948c(0xde)]=_0x10948c(0x104);const _0x5ad284=await _0x52aac8[_0x10948c(0xda)](),_0x16078c=await master_shop['find'](),_0x2856cf=await email_settings[_0x10948c(0x119)](),_0x527946=await supervisor_settings[_0x10948c(0x107)]();var _0x4bc039=_0x52aac8[_0x10948c(0xc9)],_0x1356bb='',_0x10271b;for(_0x10271b in _0x4bc039){var _0x37c9bf='FG';_0x52aac8[_0x10948c(0x118)]=='DRY\x20GOODS'&&(_0x37c9bf='DG'),_0x1356bb+=_0x10948c(0xb5)+_0x10948c(0x88)+_0x4bc039[_0x10271b][_0x10948c(0x7c)]+'</td>'+_0x10948c(0x88)+_0x4bc039[_0x10271b][_0x10948c(0x164)]+_0x10948c(0x9b)+_0x10948c(0x88)+_0x4bc039[_0x10271b][_0x10948c(0x83)]+_0x10948c(0x9b)+_0x10948c(0x88)+_0x4bc039[_0x10271b][_0x10948c(0x86)]+_0x10948c(0x9b)+_0x10948c(0x88)+_0x4bc039[_0x10271b][_0x10948c(0xb1)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x52aac8[_0x10948c(0x118)]+_0x10948c(0x9b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4bc039[_0x10271b][_0x10948c(0xb2)]+_0x10948c(0x9b)+_0x10948c(0x88)+_0x37c9bf+_0x4bc039[_0x10271b][_0x10948c(0xd6)]+_0x10948c(0x9b);}let _0x317da6=nodemailer[_0x10948c(0x94)]({'host':_0x2856cf['host'],'port':Number(_0x2856cf[_0x10948c(0x156)]),'secure':![],'auth':{'user':_0x2856cf[_0x10948c(0x187)],'pass':_0x2856cf[_0x10948c(0x160)]}}),_0x4f8ac9={'from':_0x2856cf['email'],'to':_0x527946[0x0][_0x10948c(0xed)],'subject':_0x10948c(0x167),'attachments':[{'filename':_0x10948c(0x87),'path':__dirname+_0x10948c(0x175)+_0x10948c(0x142)+_0x16078c[0x0][_0x10948c(0xb7)],'cid':_0x10948c(0x7b)}],'html':_0x10948c(0x122)+'<html><head><title></title>'+_0x10948c(0x14b)+_0x10948c(0x12e)+_0x10948c(0x121)+_0x10948c(0x12e)+_0x10948c(0x117)+_0x10948c(0xef)+_0x10948c(0x12e)+_0x10948c(0xd0)+_0x16078c[0x0][_0x10948c(0x110)]+_0x10948c(0xe6)+_0x10948c(0xef)+'</div>'+_0x10948c(0x105)+_0x10948c(0x12e)+_0x10948c(0x95)+'\x20Order\x20Number\x20:\x20'+_0x52aac8['invoice']+'\x20'+_0x10948c(0x85)+_0x10948c(0x14a)+_0x52aac8[_0x10948c(0x11d)]+'\x20'+_0x10948c(0xf2)+_0x10948c(0x91)+'</div>'+_0x10948c(0x171)+_0x10948c(0x13d)+_0x10948c(0xb5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x10948c(0x96)+_0x10948c(0xfd)+_0x10948c(0x11f)+_0x10948c(0x11e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x10948c(0x17e)+_0x10948c(0x16d)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1356bb+'\x20'+_0x10948c(0xf6)+_0x10948c(0xc1)+'<div>'+_0x10948c(0xbf)+_0x10948c(0xaa)+_0x16078c[0x0][_0x10948c(0x110)]+'</h5>'+_0x10948c(0xef)+_0x10948c(0xef)+'</body></html>'};_0x317da6[_0x10948c(0x10a)](_0x4f8ac9,function(_0x215270,_0x4859e3){var _0x462fef=_0x10948c;_0x215270?(console[_0x462fef(0x165)](_0x215270),console[_0x462fef(0x165)]('Error\x20Occurs')):console[_0x462fef(0x165)](_0x462fef(0x128));}),_0x18f154[_0x10948c(0xd3)]('success',_0x10948c(0x153)),_0x3e8528['redirect'](_0x10948c(0xea)+_0x1e4e8a);}catch(_0x58e184){console[_0x10948c(0x111)](_0x58e184),_0x3e8528[_0x10948c(0xe4)](0x1f4)[_0x10948c(0x147)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x52a9c7(0xd5)](_0x436a7e=>{var _0xb55f4a=_0x52a9c7;console[_0xb55f4a(0x111)](_0x436a7e),_0x3e8528[_0xb55f4a(0xe4)](0x1f4)[_0xb55f4a(0x147)]({'error':_0xb55f4a(0xfc)});});}catch(_0x193964){console[_0x52a9c7(0x165)](_0x193964);}}),router[a0_0x40c111(0x152)](a0_0x40c111(0x112),auth,async(_0x4ca7fc,_0x108d6f)=>{var _0x4a33d2=a0_0x40c111;try{const {username:_0x10f4cd,email:_0x462888,role:_0x32973e}=_0x4ca7fc[_0x4a33d2(0xba)],_0x43c1af=_0x4ca7fc[_0x4a33d2(0xba)],_0x1de3ee=await profile[_0x4a33d2(0x119)]({'email':_0x43c1af[_0x4a33d2(0x187)]}),_0x7b7879=await master_shop[_0x4a33d2(0x107)](),_0x59c045=_0x4ca7fc[_0x4a33d2(0x158)]['id'],_0x5823c0=await sales_finished[_0x4a33d2(0x162)](_0x59c045);let _0x3093db=new Date(_0x5823c0[_0x4a33d2(0xe8)]),_0x386f7a=('0'+_0x3093db['getDate']())[_0x4a33d2(0x181)](-0x2),_0x45dc4b=('0'+(_0x3093db[_0x4a33d2(0x130)]()+0x1))['slice'](-0x2),_0x548b7d=_0x3093db[_0x4a33d2(0x126)](),_0x177075=_0x548b7d+'-'+_0x45dc4b+'-'+_0x386f7a;var _0x3c87b0=[_0x4a33d2(0x10f),_0x4a33d2(0x172)];const _0x529ee0=await warehouse['aggregate']([{'$match':{'name':_0x5823c0[_0x4a33d2(0x118)],'room':_0x5823c0[_0x4a33d2(0xd2)]}},{'$unwind':_0x4a33d2(0xa4)},{'$group':{'_id':_0x4a33d2(0x9a),'name':{'$first':_0x4a33d2(0x149)},'product_stock':{'$first':_0x4a33d2(0x89)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4a33d2(0xbe)},'type':{'$first':_0x4a33d2(0xf7)},'floorlevel':{'$first':_0x4a33d2(0x15d)},'primary_code':{'$first':_0x4a33d2(0x13f)},'secondary_code':{'$first':_0x4a33d2(0xb3)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x4a33d2(0xcc)},'rack':{'$first':_0x4a33d2(0x17d)}}}]),_0x69ec3=await customer[_0x4a33d2(0x107)]({});let _0x1ca2a1;if(_0x43c1af[_0x4a33d2(0x98)]==_0x4a33d2(0x169)){const _0x32632c=await staff[_0x4a33d2(0x119)]({'email':_0x43c1af[_0x4a33d2(0x187)]});_0x1ca2a1=await warehouse['aggregate']([{'$match':{'status':_0x4a33d2(0xfb),'name':_0x32632c[_0x4a33d2(0xb9)]}},{'$group':{'_id':_0x4a33d2(0x159),'name':{'$first':'$name'}}}]);}else _0x1ca2a1=await warehouse[_0x4a33d2(0xff)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x4a33d2(0x159)}}}]);const _0x51ccad=await product[_0x4a33d2(0x107)]({});if(_0x7b7879[0x0][_0x4a33d2(0x108)]==_0x4a33d2(0x177)){var _0x51444e=users[_0x4a33d2(0x12f)];console['log'](_0x51444e);}else{if(_0x7b7879[0x0]['language']=='Hindi')var _0x51444e=users['Hindi'];else{if(_0x7b7879[0x0][_0x4a33d2(0x108)]==_0x4a33d2(0xe5))var _0x51444e=users[_0x4a33d2(0xe5)];else{if(_0x7b7879[0x0][_0x4a33d2(0x108)]=='Spanish')var _0x51444e=users[_0x4a33d2(0x11a)];else{if(_0x7b7879[0x0][_0x4a33d2(0x108)]==_0x4a33d2(0x81))var _0x51444e=users[_0x4a33d2(0x81)];else{if(_0x7b7879[0x0]['language']==_0x4a33d2(0x10e))var _0x51444e=users[_0x4a33d2(0x90)];else{if(_0x7b7879[0x0]['language']==_0x4a33d2(0xc0))var _0x51444e=users['Chinese'];else{if(_0x7b7879[0x0][_0x4a33d2(0x108)]==_0x4a33d2(0x116))var _0x51444e=users[_0x4a33d2(0x15f)];}}}}}}}_0x108d6f[_0x4a33d2(0xbc)]('edit_sales_finished',{'success':_0x4ca7fc[_0x4a33d2(0xd3)](_0x4a33d2(0xf0)),'errors':_0x4ca7fc['flash'](_0x4a33d2(0xa6)),'role':_0x43c1af,'profile':_0x1de3ee,'customer':_0x69ec3,'warehouse':_0x1ca2a1,'product':_0x529ee0,'user':_0x5823c0,'master_shop':_0x7b7879,'unit':_0x51ccad,'language':_0x51444e,'rooms_data':_0x3c87b0,'ed_fullDate':_0x177075});}catch(_0x3e6f63){console[_0x4a33d2(0x165)](_0x3e6f63);}}),router[a0_0x40c111(0x137)](a0_0x40c111(0x112),auth,async(_0x521315,_0x251d38)=>{var _0x33e44b=a0_0x40c111;try{const _0x545e9b=_0x521315[_0x33e44b(0x158)]['id'],_0xfc3be6=await sales_finished[_0x33e44b(0x119)]({'_id':_0x521315['params']['id']}),_0x39d89b=await warehouse[_0x33e44b(0x119)]({'name':_0xfc3be6[_0x33e44b(0x118)],'room':_0x521315[_0x33e44b(0xd1)][_0x33e44b(0xd2)],'warehouse_category':_0x33e44b(0x9c)}),{invoice:_0x2cc7af,customer:_0x4b6693,date:_0x3ea63c,warehouse_name:_0x13a9b5,product_name:_0x5a32a8,stock:_0x5b81b4,adjust_qty:_0x22c110,note:_0x5b658a,room:_0x45d7f9,primary_code:_0x3c0da1,secondary_code:_0x310a13,prod_code:_0xf9a77a,level:_0x22e309,isle:_0x22ca17,pallet:_0x40e628,expiry_date:_0x22f4c0}=_0x521315['body'];if(typeof _0x5a32a8==_0x33e44b(0x13b))var _0x2e3882=[_0x521315[_0x33e44b(0xd1)][_0x33e44b(0x7c)]],_0x56d61a=[_0x521315[_0x33e44b(0xd1)][_0x33e44b(0x10d)]],_0x451081=[_0x521315['body'][_0x33e44b(0xa7)]],_0x2c3461=[_0x521315[_0x33e44b(0xd1)][_0x33e44b(0x17f)]],_0xdec107=[_0x521315[_0x33e44b(0xd1)]['secondary_code']],_0x5b0f18=[_0x521315[_0x33e44b(0xd1)][_0x33e44b(0x102)]],_0x1e31fc=[_0x521315['body'][_0x33e44b(0x189)]],_0x2883f7=[_0x521315['body'][_0x33e44b(0xe8)]];else var _0x2e3882=[..._0x521315[_0x33e44b(0xd1)]['product_name']],_0x56d61a=[..._0x521315['body'][_0x33e44b(0x10d)]],_0x451081=[..._0x521315[_0x33e44b(0xd1)][_0x33e44b(0xa7)]],_0x2c3461=[..._0x521315[_0x33e44b(0xd1)]['primary_code']],_0xdec107=[..._0x521315[_0x33e44b(0xd1)][_0x33e44b(0x155)]],_0x5b0f18=[..._0x521315['body'][_0x33e44b(0x102)]],_0x1e31fc=[..._0x521315[_0x33e44b(0xd1)]['level']],_0x2883f7=[..._0x521315[_0x33e44b(0xd1)]['expiry_date']];const _0x2d16be=_0x2e3882['map'](_0x5c0f1a=>{return _0x5c0f1a={'product_name':_0x5c0f1a};});_0x56d61a['forEach']((_0x41a4ac,_0x22a466)=>{var _0xa26e86=_0x33e44b;_0x2d16be[_0x22a466][_0xa26e86(0x10d)]=_0x41a4ac;}),_0x451081[_0x33e44b(0xcd)]((_0x91e283,_0x488e82)=>{_0x2d16be[_0x488e82]['quantity']=_0x91e283;}),_0x2c3461[_0x33e44b(0xcd)]((_0x4bba5b,_0x43dc2c)=>{_0x2d16be[_0x43dc2c]['primary_code']=_0x4bba5b;}),_0xdec107[_0x33e44b(0xcd)]((_0x5a1e08,_0x4ddbfb)=>{var _0x3a5051=_0x33e44b;_0x2d16be[_0x4ddbfb][_0x3a5051(0x155)]=_0x5a1e08;}),_0x5b0f18[_0x33e44b(0xcd)]((_0x119f32,_0x5ebe36)=>{_0x2d16be[_0x5ebe36]['product_code']=_0x119f32;}),_0x1e31fc[_0x33e44b(0xcd)]((_0x2d0903,_0x1bae06)=>{var _0x3f3b81=_0x33e44b;_0x2d16be[_0x1bae06][_0x3f3b81(0x189)]=_0x2d0903;}),_0x2883f7[_0x33e44b(0xcd)]((_0x63ee96,_0x562c3d)=>{var _0x3dba93=_0x33e44b;_0x2d16be[_0x562c3d][_0x3dba93(0xe8)]=_0x63ee96;});var _0x378db7=0x0;_0x2d16be['forEach'](_0x3d5855=>{var _0x2dbca8=_0x33e44b;console[_0x2dbca8(0x165)](_0x2dbca8(0x182),_0x3d5855),(parseInt(_0x3d5855['stock'])<parseInt(_0x3d5855[_0x2dbca8(0x83)])||parseInt(_0x3d5855[_0x2dbca8(0x83)])==0x0)&&_0x378db7++;});if(_0x378db7!=0x0)return _0x521315[_0x33e44b(0xd3)](_0x33e44b(0xa6),_0x33e44b(0x154)),_0x251d38[_0x33e44b(0x78)](_0x33e44b(0x114));_0xfc3be6[_0x33e44b(0xc9)][_0x33e44b(0xcd)](_0x514023=>{var _0x29b27e=_0x33e44b;const _0x241235=_0x39d89b[_0x29b27e(0xf8)][_0x29b27e(0x103)](_0x35086c=>{var _0x1c8944=_0x29b27e;_0x35086c['product_name']==_0x514023['product_name']&&_0x35086c[_0x1c8944(0xd6)]==_0x514023[_0x1c8944(0xd6)]&&(_0x35086c[_0x1c8944(0x14c)]=parseInt(_0x35086c['product_stock'])+parseInt(_0x514023[_0x1c8944(0x83)]));});}),await _0x39d89b[_0x33e44b(0xda)]();const _0x2c5c24=_0x2d16be[_0x33e44b(0xa9)](_0x42f2f2=>_0x42f2f2['quantity']!=='0'&&_0x42f2f2[_0x33e44b(0x83)]!=='');_0xfc3be6[_0x33e44b(0xcf)]=_0x2cc7af,_0xfc3be6[_0x33e44b(0xc5)]=_0x4b6693,_0xfc3be6[_0x33e44b(0x11d)]=_0x3ea63c,_0xfc3be6['warehouse_name']=_0x13a9b5,_0xfc3be6[_0x33e44b(0xc9)]=_0x2c5c24,_0xfc3be6[_0x33e44b(0x176)]=_0x5b658a,_0xfc3be6[_0x33e44b(0xd2)]=_0x45d7f9;const _0x2aa75b=await _0xfc3be6[_0x33e44b(0xda)](),_0x566110=await sales_finished['findOne']({'_id':_0x521315['params']['id']}),_0x38cb69=await warehouse[_0x33e44b(0x119)]({'name':_0x13a9b5,'room':_0x45d7f9,'warehouse_category':'Finished\x20Goods'});_0x566110[_0x33e44b(0xc9)][_0x33e44b(0xcd)](_0x4c100a=>{var _0x5cfa32=_0x33e44b;const _0x8d00ef=_0x38cb69[_0x5cfa32(0xf8)][_0x5cfa32(0x103)](_0x41d568=>{var _0x4326d5=_0x5cfa32;_0x41d568[_0x4326d5(0x7c)]==_0x4c100a[_0x4326d5(0x7c)]&&_0x41d568[_0x4326d5(0xd6)]==_0x4c100a[_0x4326d5(0xd6)]&&(_0x41d568[_0x4326d5(0x14c)]=parseInt(_0x41d568[_0x4326d5(0x14c)])-parseInt(_0x4c100a[_0x4326d5(0x83)]));});}),console[_0x33e44b(0x165)](_0x33e44b(0xfa),_0x38cb69),await _0x38cb69[_0x33e44b(0xda)]();const _0x448338=await c_payment_data[_0x33e44b(0x119)]({'invoice':_0x521315['body'][_0x33e44b(0xcf)]});_0x448338[_0x33e44b(0xc2)]=_0x521315[_0x33e44b(0xd1)]['suppliers'],await _0x448338[_0x33e44b(0xda)](),_0x521315[_0x33e44b(0xd3)](_0x33e44b(0xf0),_0x33e44b(0x153)),_0x251d38[_0x33e44b(0x78)](_0x33e44b(0x7d));}catch(_0x77353d){console[_0x33e44b(0x165)](_0x77353d);}}),router[a0_0x40c111(0x137)](a0_0x40c111(0x16c),auth,async(_0x1af5b6,_0x397704)=>{var _0x4b3cce=a0_0x40c111;try{const _0x57b97b=_0x1af5b6['params']['id'],{invoice:_0x37aed5,customer:_0x83934a,receivable_amount:_0x4fe044,received_amount:_0xaf8f37}=_0x1af5b6['body'],_0x5873ff=await sales['findById'](_0x57b97b);console[_0x4b3cce(0x165)](_0x5873ff);var _0x322c8e=_0x4fe044-_0xaf8f37;console[_0x4b3cce(0x165)](_0xaf8f37),_0x5873ff[_0x4b3cce(0xe3)]=parseFloat(_0xaf8f37)+parseFloat(_0x5873ff[_0x4b3cce(0xe3)]),_0x5873ff[_0x4b3cce(0x16a)]=_0x322c8e,console['log'](_0x5873ff);const _0x169df5=await _0x5873ff['save'](),_0x37a54e=await c_payment_data[_0x4b3cce(0x119)]({'invoice':_0x37aed5});_0x37a54e['amount']=_0x322c8e,await _0x37a54e[_0x4b3cce(0xda)]();let _0x509f76=new Date(),_0x2b67ca=('0'+_0x509f76['getDate']())[_0x4b3cce(0x181)](-0x2),_0x2538e0=('0'+(_0x509f76['getMonth']()+0x1))[_0x4b3cce(0x181)](-0x2),_0x3c4ec9=_0x509f76[_0x4b3cce(0x126)](),_0x149de2=_0x3c4ec9+'-'+_0x2538e0+'-'+_0x2b67ca;const _0x53807d=new customer_payment({'invoice':_0x37aed5,'date':_0x3c4ec9+'-'+_0x2538e0+'-'+_0x2b67ca,'customer':_0x83934a,'reason':_0x4b3cce(0x8a),'amount':_0xaf8f37}),_0x27eb90=await _0x53807d[_0x4b3cce(0xda)]();_0x1af5b6[_0x4b3cce(0xd3)]('success',_0x4b3cce(0x17c)),_0x397704[_0x4b3cce(0x78)](_0x4b3cce(0x183));}catch(_0x1929cb){console[_0x4b3cce(0x165)](_0x1929cb);}}),router[a0_0x40c111(0x152)](a0_0x40c111(0xc6),auth,async(_0x236e22,_0x43df4f)=>{var _0x17f962=a0_0x40c111;try{const {username:_0x1ddfb6,email:_0x22fa57,role:_0x187b79}=_0x236e22['user'],_0x50d9a8=_0x236e22['user'],_0x206180=await profile[_0x17f962(0x119)]({'email':_0x50d9a8['email']}),_0x5dd788=await master_shop[_0x17f962(0x107)]();console[_0x17f962(0x165)](_0x17f962(0x15a),_0x5dd788);const _0x1d2913=_0x236e22[_0x17f962(0x158)]['id'],_0x3d3c6f=await sales[_0x17f962(0x162)](_0x1d2913);console[_0x17f962(0x165)](_0x3d3c6f);const _0x18e10=await customer['findOne']({'name':_0x3d3c6f[_0x17f962(0xc5)]});console[_0x17f962(0x165)](_0x18e10);if(_0x5dd788[0x0][_0x17f962(0x108)]=='English\x20(US)'){var _0x41983f=users[_0x17f962(0x12f)];console[_0x17f962(0x165)](_0x41983f);}else{if(_0x5dd788[0x0][_0x17f962(0x108)]=='Hindi')var _0x41983f=users[_0x17f962(0xc7)];else{if(_0x5dd788[0x0][_0x17f962(0x108)]==_0x17f962(0xe5))var _0x41983f=users['German'];else{if(_0x5dd788[0x0]['language']==_0x17f962(0x11a))var _0x41983f=users['Spanish'];else{if(_0x5dd788[0x0][_0x17f962(0x108)]==_0x17f962(0x81))var _0x41983f=users[_0x17f962(0x81)];else{if(_0x5dd788[0x0][_0x17f962(0x108)]=='Portuguese\x20(BR)')var _0x41983f=users[_0x17f962(0x90)];else{if(_0x5dd788[0x0]['language']=='Chinese')var _0x41983f=users['Chinese'];else{if(_0x5dd788[0x0]['language']==_0x17f962(0x116))var _0x41983f=users['Arabic'];}}}}}}}_0x43df4f['render'](_0x17f962(0xe2),{'success':_0x236e22['flash'](_0x17f962(0xf0)),'errors':_0x236e22[_0x17f962(0xd3)](_0x17f962(0xa6)),'role':_0x50d9a8,'profile':_0x206180,'master_shop':_0x5dd788,'customers':_0x18e10,'sales':_0x3d3c6f,'language':_0x41983f});}catch(_0x434bab){console[_0x17f962(0x165)](_0x434bab);}}),router[a0_0x40c111(0x152)](a0_0x40c111(0x188),auth,async(_0x498114,_0x2b9860)=>{var _0x310fbf=a0_0x40c111;try{const {username:_0x2cfc70,email:_0x1d91ce,role:_0x498ee2}=_0x498114[_0x310fbf(0xba)],_0x259dbf=_0x498114[_0x310fbf(0xba)],_0x3bba74=await profile[_0x310fbf(0x119)]({'email':_0x259dbf['email']}),_0x23e7fe=await master_shop[_0x310fbf(0x107)](),_0x564f90=_0x498114[_0x310fbf(0x158)]['id'],_0x22a6c8=await sales_finished[_0x310fbf(0x162)](_0x564f90),_0x4fde28=await warehouse[_0x310fbf(0xff)]([{'$match':{'name':_0x22a6c8[_0x310fbf(0x118)]}},{'$unwind':_0x310fbf(0xa4)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x310fbf(0x89)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x310fbf(0xbe)},'type':{'$first':_0x310fbf(0xf7)},'floorlevel':{'$first':_0x310fbf(0x15d)},'primary_code':{'$first':_0x310fbf(0x13f)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x310fbf(0x140)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x310fbf(0x17d)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x310fbf(0xcb)},'unit':{'$first':_0x310fbf(0x150)},'secondary_unit':{'$first':_0x310fbf(0x133)},'maxProducts':{'$first':_0x310fbf(0xd4)},'batch_code':{'$first':_0x310fbf(0x131)},'maxPerUnit':{'$first':_0x310fbf(0x141)}}}]),_0x222d55=await product[_0x310fbf(0x107)]({}),_0x4476c0=await warehouse[_0x310fbf(0xff)]([{'$match':{'status':_0x310fbf(0xfb),'warehouse_category':_0x310fbf(0x9c),'name':{'$ne':'Return\x20Goods','$ne':_0x310fbf(0x115)}}},{'$group':{'_id':'$name','name':{'$first':_0x310fbf(0x159)}}},{'$sort':{'name':0x1}}]);var _0x3c89ee=[_0x310fbf(0x12c)];const _0x207c0c=await warehouse['aggregate']([{'$match':{'status':_0x310fbf(0xfb),'name':_0x310fbf(0x115)}},{'$group':{'_id':'$name','name':{'$first':_0x310fbf(0x159)}}},{'$sort':{'name':0x1}}]);if(_0x23e7fe[0x0]['language']==_0x310fbf(0x177)){var _0x836907=users[_0x310fbf(0x12f)];console[_0x310fbf(0x165)](_0x836907);}else{if(_0x23e7fe[0x0]['language']==_0x310fbf(0xc7))var _0x836907=users[_0x310fbf(0xc7)];else{if(_0x23e7fe[0x0][_0x310fbf(0x108)]==_0x310fbf(0xe5))var _0x836907=users[_0x310fbf(0xe5)];else{if(_0x23e7fe[0x0][_0x310fbf(0x108)]==_0x310fbf(0x11a))var _0x836907=users[_0x310fbf(0x11a)];else{if(_0x23e7fe[0x0][_0x310fbf(0x108)]=='French')var _0x836907=users['French'];else{if(_0x23e7fe[0x0]['language']==_0x310fbf(0x10e))var _0x836907=users[_0x310fbf(0x90)];else{if(_0x23e7fe[0x0]['language']==_0x310fbf(0xc0))var _0x836907=users[_0x310fbf(0xc0)];else{if(_0x23e7fe[0x0]['language']==_0x310fbf(0x116))var _0x836907=users[_0x310fbf(0x15f)];}}}}}}}_0x2b9860[_0x310fbf(0xbc)](_0x310fbf(0xad),{'success':_0x498114[_0x310fbf(0xd3)](_0x310fbf(0xf0)),'errors':_0x498114[_0x310fbf(0xd3)](_0x310fbf(0xa6)),'role':_0x259dbf,'profile':_0x3bba74,'user':_0x22a6c8,'stock':_0x4fde28,'master_shop':_0x23e7fe,'unit':_0x222d55,'language':_0x836907,'warehouses':_0x4476c0,'rooms':_0x3c89ee,'warehouse_QA':_0x207c0c});}catch(_0x2388c2){console[_0x310fbf(0x165)](_0x2388c2),_0x2b9860[_0x310fbf(0xe4)](0xc8)[_0x310fbf(0x147)]({'message':_0x2388c2[_0x310fbf(0xdc)]});}}),router[a0_0x40c111(0x137)]('/view/return_sales/:id',auth,async(_0xdbcb71,_0x39706b)=>{var _0x1f9d23=a0_0x40c111;if(_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x148)]=='QA')try{const {invoice:_0x41b372,date:_0x5f53d9,warehouse_name:_0x44b0ff,product_name:_0x56be00,primary_code:_0x4154b3,secondary_code:_0x52d5a9,product_code:_0x40dc44,sales_quantity:_0x88e3c7,stocks:_0xf9c254,return_qty:_0x2abc09,Room_name:_0x245e7e,to_warehouse_name_QA:_0x247e29,to_Room_name_QA:_0xae3582,note:_0x8b3407,for_categorize:_0x341945,product_name_QA1:_0x47d35c}=_0xdbcb71[_0x1f9d23(0xd1)];if(typeof _0x47d35c==_0x1f9d23(0x13b))var _0x584e74=[_0xdbcb71['body'][_0x1f9d23(0x16e)]],_0x28b486=[_0xdbcb71['body'][_0x1f9d23(0x9d)]],_0x58c65d=[_0xdbcb71['body']['secondary_code_QA']],_0x123c5f=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xdb)]],_0x4682e2=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xe1)]],_0x5ad07e=[_0xdbcb71[_0x1f9d23(0xd1)]['stocks_QA']],_0xf30243=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x166)]],_0xa7cf64=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x174)]],_0x349d51=[_0xdbcb71['body'][_0x1f9d23(0x15c)]],_0x567509=[_0xdbcb71[_0x1f9d23(0xd1)]['batch_code_QA']],_0x537a46=[_0xdbcb71['body']['secondary_unit_QA']],_0x40c537=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x92)]],_0x45e8a4=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xae)]],_0x160e4e=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x145)]];else var _0x584e74=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x16e)]],_0x28b486=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x9d)]],_0x58c65d=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x186)]],_0x123c5f=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xdb)]],_0x4682e2=[..._0xdbcb71['body'][_0x1f9d23(0xe1)]],_0x5ad07e=[..._0xdbcb71[_0x1f9d23(0xd1)]['stocks_QA']],_0xf30243=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x166)]],_0xa7cf64=[..._0xdbcb71[_0x1f9d23(0xd1)]['maxPerUnit_QA']],_0x349d51=[..._0xdbcb71['body']['maxProducts_QA']],_0x567509=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xec)]],_0x537a46=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x157)]],_0x40c537=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x92)]],_0x45e8a4=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xae)]],_0x160e4e=[..._0xdbcb71[_0x1f9d23(0xd1)]['expiry_date_QA']];const _0x84b2d7=_0x584e74[_0x1f9d23(0x103)](_0x493af9=>{return _0x493af9={'product_name':_0x493af9};});_0x28b486[_0x1f9d23(0xcd)]((_0x464dd8,_0x55729a)=>{var _0x40bde4=_0x1f9d23;_0x84b2d7[_0x55729a][_0x40bde4(0x17f)]=_0x464dd8;}),_0x58c65d[_0x1f9d23(0xcd)]((_0x4e8608,_0x51b8c0)=>{_0x84b2d7[_0x51b8c0]['secondary_code']=_0x4e8608;}),_0x123c5f[_0x1f9d23(0xcd)]((_0x5b91f9,_0x8a6a50)=>{var _0x35b392=_0x1f9d23;_0x84b2d7[_0x8a6a50][_0x35b392(0x164)]=_0x5b91f9;}),_0x4682e2[_0x1f9d23(0xcd)]((_0x316519,_0x28a01d)=>{_0x84b2d7[_0x28a01d]['sale_qty']=_0x316519;}),_0x5ad07e[_0x1f9d23(0xcd)]((_0x57684c,_0x124426)=>{_0x84b2d7[_0x124426]['stock']=_0x57684c;}),_0xf30243[_0x1f9d23(0xcd)]((_0x2e59d8,_0x435d21)=>{var _0x216c9d=_0x1f9d23;_0x84b2d7[_0x435d21][_0x216c9d(0x14f)]=_0x2e59d8;}),_0xa7cf64[_0x1f9d23(0xcd)]((_0xcbfed2,_0x67d570)=>{var _0x251292=_0x1f9d23;_0x84b2d7[_0x67d570][_0x251292(0x14e)]=_0xcbfed2;}),_0x349d51[_0x1f9d23(0xcd)]((_0xc06f0d,_0x3f95aa)=>{var _0x18e5ed=_0x1f9d23;_0x84b2d7[_0x3f95aa][_0x18e5ed(0x109)]=_0xc06f0d;}),_0x567509[_0x1f9d23(0xcd)]((_0x151b34,_0x226b27)=>{var _0x27e43d=_0x1f9d23;_0x84b2d7[_0x226b27][_0x27e43d(0xb4)]=_0x151b34;}),_0x537a46[_0x1f9d23(0xcd)]((_0x16fae5,_0x47cb04)=>{var _0x2824ca=_0x1f9d23;_0x84b2d7[_0x47cb04][_0x2824ca(0xb1)]=_0x16fae5;}),_0x40c537[_0x1f9d23(0xcd)]((_0x39e080,_0x3929e0)=>{_0x84b2d7[_0x3929e0]['unit']=_0x39e080;}),_0x45e8a4[_0x1f9d23(0xcd)]((_0xf492c7,_0x2d84a4)=>{var _0x4b3fe4=_0x1f9d23;_0x84b2d7[_0x2d84a4][_0x4b3fe4(0xa5)]=_0xf492c7;}),_0x160e4e['forEach']((_0x3f251c,_0x36e578)=>{var _0x178d70=_0x1f9d23;_0x84b2d7[_0x36e578][_0x178d70(0xe8)]=_0x3f251c;});const _0x28e1e5=await sales_finished['findOne']({'invoice':_0x41b372});_0x28e1e5[_0x1f9d23(0x161)]='True';const _0x115595=await _0x28e1e5['save'](),_0x3321a1=new sales_return_finished({'invoice':_0x41b372,'customer':_0xdbcb71[_0x1f9d23(0xd1)]['customer'],'date':_0x5f53d9,'warehouse_name':_0x44b0ff,'room':_0x245e7e,'ToWarehouse':_0x247e29,'ToRoom':_0xae3582,'return_sale_QA':_0x84b2d7,'note':_0x8b3407,'warehouse_cat':_0x341945}),_0x522cb2=await _0x3321a1[_0x1f9d23(0xda)](),_0x1114be=await sales_return_finished[_0x1f9d23(0x119)]({'invoice':_0x41b372}),_0x186f3d=await warehouse[_0x1f9d23(0x119)]({'name':_0x247e29,'room':_0xae3582});_0x1114be['return_sale_QA'][_0x1f9d23(0xcd)](_0x476a34=>{var _0x42891c=_0x1f9d23,_0x5e140e=0x0;const _0x61e261=_0x186f3d[_0x42891c(0xf8)]['map'](_0x328bbe=>{var _0x1916b8=_0x42891c;_0x328bbe[_0x1916b8(0x7c)]==_0x476a34[_0x1916b8(0x7c)]&&_0x328bbe[_0x1916b8(0xe8)]==_0x476a34[_0x1916b8(0xe8)]&&_0x328bbe['production_date']==_0x476a34['production_date']&&_0x328bbe['batch_code']==_0x476a34[_0x1916b8(0xb4)]&&(_0x328bbe[_0x1916b8(0x14c)]=parseInt(_0x328bbe[_0x1916b8(0x14c)])+parseInt(_0x476a34[_0x1916b8(0x14f)]),_0x5e140e++);});_0x5e140e=='0'&&(_0x186f3d[_0x42891c(0xf8)]=_0x186f3d['product_details'][_0x42891c(0x113)]({'product_name':_0x476a34[_0x42891c(0x7c)],'product_stock':_0x476a34[_0x42891c(0x14f)],'primary_code':_0x476a34[_0x42891c(0x17f)],'secondary_code':_0x476a34[_0x42891c(0x155)],'product_code':_0x476a34[_0x42891c(0x164)],'batch_code':_0x476a34['batch_code'],'maxPerUnit':_0x476a34[_0x42891c(0x14e)],'production_date':_0x476a34[_0x42891c(0xa5)],'expiry_date':_0x476a34[_0x42891c(0xe8)],'secondary_unit':_0x476a34['secondary_unit'],'unit':_0x476a34['unit'],'maxProducts':_0x476a34[_0x42891c(0x109)],'bay':_0x476a34['bay']}));}),await _0x186f3d['save']();const _0x43f19d=new c_payment_data({'invoice':_0x41b372,'customer':_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xc5)],'reason':_0x1f9d23(0xee)});await _0x43f19d[_0x1f9d23(0xda)]();const _0x1ab625=await master_shop[_0x1f9d23(0x107)](),_0x2505eb=await email_settings[_0x1f9d23(0x119)](),_0x1ccd2f=await customer['findOne']({'name':_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xc5)]});_0x1ab625[0x0][_0x1f9d23(0x8c)]==0x1?(right_currency=_0x1ab625[0x0][_0x1f9d23(0xb0)],left_currency=''):(right_currency='',left_currency=_0x1ab625[0x0][_0x1f9d23(0xb0)]);var _0x1d9fce=_0x584e74,_0x37cd4a=_0xf30243,_0x9a0bdc='',_0x59a120;for(_0x59a120 in _0x1d9fce){_0x9a0bdc+=_0x1f9d23(0xb5)+_0x1f9d23(0x88)+_0x1d9fce[_0x59a120]+_0x1f9d23(0x9b)+_0x1f9d23(0x88)+_0x37cd4a[_0x59a120]+'</td>'+_0x1f9d23(0x17e);}console[_0x1f9d23(0x165)](_0x1f9d23(0x18b),_0x9a0bdc);let _0x520598=nodemailer[_0x1f9d23(0x94)]({'service':_0x1f9d23(0x185),'auth':{'user':_0x2505eb[_0x1f9d23(0x187)],'pass':_0x2505eb[_0x1f9d23(0x160)]}}),_0xde9b04={'from':_0x2505eb[_0x1f9d23(0x187)],'to':_0x1ccd2f[_0x1f9d23(0x187)],'subject':_0x1f9d23(0xdd),'attachments':[{'filename':_0x1f9d23(0x87),'path':__dirname+_0x1f9d23(0x175)+'/upload/'+_0x1ab625[0x0][_0x1f9d23(0xb7)],'cid':_0x1f9d23(0x7b)}],'html':_0x1f9d23(0x122)+'<html><head><title></title>'+_0x1f9d23(0x14b)+'<div>'+_0x1f9d23(0x121)+'<div>'+_0x1f9d23(0x117)+'</div>'+_0x1f9d23(0x12e)+'<h2>\x20'+_0x1ab625[0x0][_0x1f9d23(0x110)]+_0x1f9d23(0xe6)+_0x1f9d23(0xef)+_0x1f9d23(0xef)+_0x1f9d23(0x105)+_0x1f9d23(0x12e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1f9d23(0x184)+_0x41b372+'\x20'+_0x1f9d23(0x85)+_0x1f9d23(0x14a)+_0x5f53d9+'\x20'+_0x1f9d23(0xf2)+_0x1f9d23(0x91)+_0x1f9d23(0xef)+_0x1f9d23(0x171)+_0x1f9d23(0x13d)+_0x1f9d23(0xb5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1f9d23(0xc4)+_0x1f9d23(0x146)+_0x1f9d23(0x135)+_0x1f9d23(0x17e)+_0x1f9d23(0x16d)+_0x1f9d23(0xe0)+'\x20'+_0x9a0bdc+'\x20'+_0x1f9d23(0xf6)+_0x1f9d23(0xc1)+_0x1f9d23(0x12e)+_0x1f9d23(0xbf)+_0x1f9d23(0xaa)+_0x1ab625[0x0][_0x1f9d23(0x110)]+'</h5>'+_0x1f9d23(0xef)+_0x1f9d23(0xef)+_0x1f9d23(0x139)};_0x520598[_0x1f9d23(0x10a)](_0xde9b04,function(_0x309029,_0x131173){var _0x248215=_0x1f9d23;_0x309029?(console[_0x248215(0x165)](_0x309029),console[_0x248215(0x165)](_0x248215(0x11b))):console[_0x248215(0x165)](_0x248215(0x128));}),_0xdbcb71[_0x1f9d23(0xd3)]('success',_0x1f9d23(0x178)),_0x39706b['redirect'](_0x1f9d23(0x7d));}catch(_0x32b458){_0x39706b['status'](0xc8)[_0x1f9d23(0x147)]({'message1':_0x32b458['message']});}else{if(_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x148)]=='GS')try{const {invoice:_0x1ecb7a,date:_0x3cdebd,warehouse_name:_0x3f189d,product_name:_0x3296bb,primary_code:_0x42f297,secondary_code:_0x575b04,product_code:_0x3e4981,sales_quantity:_0x54fdcf,stocks:_0x3f65b0,return_qty:_0x5df6ab,Room_name:_0xc111c5,to_warehouse_name:_0x3dde09,to_Room_name:_0x16889c,note:_0x264fca,level:_0x376bc6,isle:_0x26e17c,pallet:_0xf9d734,for_categorize:_0x1e65a0}=_0xdbcb71[_0x1f9d23(0xd1)];if(typeof _0x3296bb==_0x1f9d23(0x13b))var _0x584e74=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x7c)]],_0x28b486=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x17f)]],_0x58c65d=[_0xdbcb71[_0x1f9d23(0xd1)]['secondary_code']],_0x123c5f=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x164)]],_0x4682e2=[_0xdbcb71['body'][_0x1f9d23(0x143)]],_0xf30243=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x14f)]],_0x4e77c3=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xd6)]],_0xa7cf64=[_0xdbcb71[_0x1f9d23(0xd1)]['maxPerUnit']],_0x349d51=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x109)]],_0x567509=[_0xdbcb71['body'][_0x1f9d23(0xb4)]],_0x537a46=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xb1)]],_0x40c537=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x86)]],_0x45e8a4=[_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xa5)]],_0x160e4e=[_0xdbcb71['body'][_0x1f9d23(0xe8)]];else var _0x584e74=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x7c)]],_0x28b486=[..._0xdbcb71[_0x1f9d23(0xd1)]['primary_code']],_0x58c65d=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x155)]],_0x123c5f=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x164)]],_0x4682e2=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x143)]],_0xf30243=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x14f)]],_0x4e77c3=[..._0xdbcb71['body'][_0x1f9d23(0xd6)]],_0xa7cf64=[..._0xdbcb71[_0x1f9d23(0xd1)]['maxPerUnit']],_0x349d51=[..._0xdbcb71['body']['maxProducts']],_0x567509=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xb4)]],_0x537a46=[..._0xdbcb71[_0x1f9d23(0xd1)]['secondary_unit']],_0x40c537=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0x86)]],_0x45e8a4=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xa5)]],_0x160e4e=[..._0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xe8)]];const _0x5a3f1a=_0x584e74[_0x1f9d23(0x103)](_0xce06e8=>{return _0xce06e8={'product_name':_0xce06e8};});_0x28b486[_0x1f9d23(0xcd)]((_0xd9e1cc,_0x36ed64)=>{var _0x8157a5=_0x1f9d23;_0x5a3f1a[_0x36ed64][_0x8157a5(0x17f)]=_0xd9e1cc;}),_0x58c65d[_0x1f9d23(0xcd)]((_0x389e17,_0x1f9aa9)=>{_0x5a3f1a[_0x1f9aa9]['secondary_code']=_0x389e17;}),_0x123c5f[_0x1f9d23(0xcd)]((_0x36bb6d,_0x2d9f1b)=>{var _0x453a85=_0x1f9d23;_0x5a3f1a[_0x2d9f1b][_0x453a85(0x164)]=_0x36bb6d;}),_0x4682e2[_0x1f9d23(0xcd)]((_0x269390,_0xf3a8b8)=>{var _0x5ac2fe=_0x1f9d23;_0x5a3f1a[_0xf3a8b8][_0x5ac2fe(0xeb)]=_0x269390;}),_0xf30243[_0x1f9d23(0xcd)]((_0x27a205,_0x207c82)=>{var _0x1899bf=_0x1f9d23;_0x5a3f1a[_0x207c82][_0x1899bf(0x14f)]=_0x27a205;}),_0x4e77c3[_0x1f9d23(0xcd)]((_0x48ffc2,_0x5d6c7c)=>{var _0x3a5e32=_0x1f9d23;_0x5a3f1a[_0x5d6c7c][_0x3a5e32(0xd6)]=_0x48ffc2;}),_0xa7cf64[_0x1f9d23(0xcd)]((_0x24030c,_0x56e81d)=>{var _0x122ff6=_0x1f9d23;_0x5a3f1a[_0x56e81d][_0x122ff6(0x14e)]=_0x24030c;}),_0x349d51[_0x1f9d23(0xcd)]((_0x23019a,_0x458de7)=>{var _0x303ad5=_0x1f9d23;_0x5a3f1a[_0x458de7][_0x303ad5(0x109)]=_0x23019a;}),_0x567509[_0x1f9d23(0xcd)]((_0x1f1bd8,_0x5297b1)=>{var _0x1ba7c2=_0x1f9d23;_0x5a3f1a[_0x5297b1][_0x1ba7c2(0xb4)]=_0x1f1bd8;}),_0x537a46[_0x1f9d23(0xcd)]((_0x4427b2,_0x41a900)=>{_0x5a3f1a[_0x41a900]['secondary_unit']=_0x4427b2;}),_0x40c537[_0x1f9d23(0xcd)]((_0x4e6460,_0x186000)=>{var _0x1c88dc=_0x1f9d23;_0x5a3f1a[_0x186000][_0x1c88dc(0x86)]=_0x4e6460;}),_0x45e8a4[_0x1f9d23(0xcd)]((_0x290bff,_0x2e3824)=>{var _0x71edc8=_0x1f9d23;_0x5a3f1a[_0x2e3824][_0x71edc8(0xa5)]=_0x290bff;}),_0x160e4e[_0x1f9d23(0xcd)]((_0x18a391,_0x4a2d39)=>{_0x5a3f1a[_0x4a2d39]['expiry_date']=_0x18a391;});var _0x4a0721=0x0;_0x5a3f1a[_0x1f9d23(0xcd)](_0x39e1ba=>{var _0xdffa05=_0x1f9d23;(parseInt(_0x39e1ba[_0xdffa05(0xeb)])<parseInt(_0x39e1ba['return_qty'])||parseInt(_0x39e1ba[_0xdffa05(0x10d)])<parseInt(_0x39e1ba['return_qty'])&&parseInt(_0x39e1ba[_0xdffa05(0xeb)])>parseInt(_0x39e1ba[_0xdffa05(0x14f)])||parseInt(_0x39e1ba[_0xdffa05(0x14f)])==0x0)&&_0x4a0721++;});if(_0x4a0721!=0x0)return _0xdbcb71[_0x1f9d23(0xd3)](_0x1f9d23(0xa6),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x39706b[_0x1f9d23(0x78)]('back');const _0xfc29b7=await sales_finished['findOne']({'invoice':_0x1ecb7a});_0xfc29b7[_0x1f9d23(0x161)]=_0x1f9d23(0x104);const _0x102eb7=await _0xfc29b7[_0x1f9d23(0xda)](),_0x296ef6=new sales_return_finished({'invoice':_0x1ecb7a,'customer':_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xc5)],'date':_0x3cdebd,'warehouse_name':_0x3f189d,'room':_0xc111c5,'ToWarehouse':_0x3dde09,'ToRoom':_0x16889c,'return_sale':_0x5a3f1a,'note':_0x264fca,'warehouse_cat':_0x1e65a0}),_0x1ae8f3=await _0x296ef6[_0x1f9d23(0xda)](),_0x55509e=await sales_return_finished[_0x1f9d23(0x119)]({'invoice':_0x1ecb7a}),_0x5cd316=await warehouse['findOne']({'name':_0x3dde09,'room':_0x16889c,'warehouse_category':_0x1f9d23(0x9c)});_0x55509e['return_sale'][_0x1f9d23(0xcd)](_0x4bc0eb=>{var _0x2a5068=_0x1f9d23,_0x2ab0fd=0x0;const _0x527853=_0x5cd316[_0x2a5068(0xf8)][_0x2a5068(0x103)](_0x701b4c=>{var _0x56f82e=_0x2a5068;_0x701b4c[_0x56f82e(0x7c)]==_0x4bc0eb[_0x56f82e(0x7c)]&&_0x701b4c[_0x56f82e(0xd6)]==_0x4bc0eb[_0x56f82e(0xd6)]&&_0x701b4c[_0x56f82e(0xe8)]==_0x4bc0eb[_0x56f82e(0xe8)]&&_0x701b4c[_0x56f82e(0xa5)]==_0x4bc0eb['production_date']&&_0x701b4c[_0x56f82e(0xb4)]==_0x4bc0eb[_0x56f82e(0xb4)]&&(_0x701b4c[_0x56f82e(0x14c)]=parseInt(_0x701b4c['product_stock'])+parseInt(_0x4bc0eb[_0x56f82e(0x14f)]),_0x2ab0fd++);});_0x2ab0fd=='0'&&(_0x5cd316[_0x2a5068(0xf8)]=_0x5cd316[_0x2a5068(0xf8)][_0x2a5068(0x113)]({'product_name':_0x4bc0eb[_0x2a5068(0x7c)],'product_stock':_0x4bc0eb['return_qty'],'primary_code':_0x4bc0eb[_0x2a5068(0x17f)],'secondary_code':_0x4bc0eb[_0x2a5068(0x155)],'product_code':_0x4bc0eb['product_code'],'bay':_0x4bc0eb['bay'],'batch_code':_0x4bc0eb['batch_code'],'maxPerUnit':_0x4bc0eb[_0x2a5068(0x14e)],'production_date':_0x4bc0eb[_0x2a5068(0xa5)],'expiry_date':_0x4bc0eb[_0x2a5068(0xe8)],'secondary_unit':_0x4bc0eb[_0x2a5068(0xb1)],'unit':_0x4bc0eb['unit'],'maxProducts':_0x4bc0eb[_0x2a5068(0x109)]}));}),await _0x5cd316[_0x1f9d23(0xda)](),console[_0x1f9d23(0x165)](_0xdbcb71[_0x1f9d23(0xd1)]);const _0x1e08a0=new c_payment_data({'invoice':_0x1ecb7a,'customer':_0xdbcb71[_0x1f9d23(0xd1)]['customer'],'reason':'Sale\x20Return'});await _0x1e08a0['save']();const _0x2a8a92=await master_shop[_0x1f9d23(0x107)]();console[_0x1f9d23(0x165)]('add\x20post',_0x2a8a92[0x0][_0x1f9d23(0xb7)]);const _0x3ddc99=await email_settings[_0x1f9d23(0x119)](),_0x32af7d=await customer[_0x1f9d23(0x119)]({'name':_0xdbcb71[_0x1f9d23(0xd1)][_0x1f9d23(0xc5)]});console[_0x1f9d23(0x165)](_0x1f9d23(0xd9),_0x32af7d);_0x2a8a92[0x0][_0x1f9d23(0x8c)]==0x1?(right_currency=_0x2a8a92[0x0][_0x1f9d23(0xb0)],left_currency=''):(right_currency='',left_currency=_0x2a8a92[0x0]['currency']);var _0x1d9fce=_0x584e74,_0x37cd4a=_0xf30243,_0x9a0bdc='',_0x59a120;for(_0x59a120 in _0x1d9fce){_0x9a0bdc+='<tr>'+_0x1f9d23(0x88)+_0x1d9fce[_0x59a120]+'</td>'+_0x1f9d23(0x88)+_0x37cd4a[_0x59a120]+'</td>'+'</tr>';}console['log'](_0x1f9d23(0x18b),_0x9a0bdc);let _0x46df41=nodemailer[_0x1f9d23(0x94)]({'service':_0x1f9d23(0x185),'auth':{'user':_0x3ddc99['email'],'pass':_0x3ddc99['password']}}),_0x41c58d={'from':_0x3ddc99[_0x1f9d23(0x187)],'to':_0x32af7d[_0x1f9d23(0x187)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x1f9d23(0x87),'path':__dirname+_0x1f9d23(0x175)+_0x1f9d23(0x142)+_0x2a8a92[0x0]['image'],'cid':_0x1f9d23(0x7b)}],'html':_0x1f9d23(0x122)+_0x1f9d23(0x10c)+_0x1f9d23(0x14b)+'<div>'+_0x1f9d23(0x121)+'<div>'+_0x1f9d23(0x117)+_0x1f9d23(0xef)+'<div>'+_0x1f9d23(0xd0)+_0x2a8a92[0x0][_0x1f9d23(0x110)]+'\x20</h2>'+_0x1f9d23(0xef)+_0x1f9d23(0xef)+'<hr\x20class=\x22my-3\x22>'+_0x1f9d23(0x12e)+_0x1f9d23(0x95)+_0x1f9d23(0x184)+_0x1ecb7a+'\x20'+_0x1f9d23(0x85)+_0x1f9d23(0x14a)+_0x3cdebd+'\x20'+_0x1f9d23(0xf2)+_0x1f9d23(0x91)+_0x1f9d23(0xef)+_0x1f9d23(0x171)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1f9d23(0xb5)+_0x1f9d23(0x99)+_0x1f9d23(0xc4)+_0x1f9d23(0x146)+_0x1f9d23(0x135)+_0x1f9d23(0x17e)+'</thead>'+_0x1f9d23(0xe0)+'\x20'+_0x9a0bdc+'\x20'+'</tbody>'+_0x1f9d23(0xc1)+'<div>'+_0x1f9d23(0xbf)+_0x1f9d23(0xaa)+_0x2a8a92[0x0][_0x1f9d23(0x110)]+_0x1f9d23(0x91)+_0x1f9d23(0xef)+_0x1f9d23(0xef)+_0x1f9d23(0x139)};_0x46df41[_0x1f9d23(0x10a)](_0x41c58d,function(_0x4f6836,_0xaaa3d1){var _0x11c029=_0x1f9d23;_0x4f6836?(console['log'](_0x4f6836),console[_0x11c029(0x165)]('Error\x20Occurs')):console[_0x11c029(0x165)](_0x11c029(0x128));}),_0xdbcb71[_0x1f9d23(0xd3)](_0x1f9d23(0xf0),_0x1f9d23(0x178)),_0x39706b['redirect'](_0x1f9d23(0x7d));}catch(_0x44c9e4){console[_0x1f9d23(0x165)](_0x44c9e4),_0x39706b[_0x1f9d23(0xe4)](0xc8)['json']({'message1':_0x44c9e4['message']});}}}),router[a0_0x40c111(0x152)](a0_0x40c111(0xf4),auth,async(_0x4caa06,_0x33ac6b)=>{var _0x24a6ac=a0_0x40c111;try{const {username:_0xd95c6f,email:_0x2166f3,role:_0x6e36a3}=_0x4caa06[_0x24a6ac(0xba)],_0x4c8a30=_0x4caa06['user'],_0x1d6d85=await profile[_0x24a6ac(0x119)]({'email':_0x4c8a30['email']}),_0x3dc572=await master_shop[_0x24a6ac(0x107)]();console[_0x24a6ac(0x165)](_0x24a6ac(0x8b),_0x3dc572);const _0x2150da=_0x4caa06[_0x24a6ac(0x158)]['id'],_0xbeb38c=await sales['findById'](_0x2150da);console[_0x24a6ac(0x165)](_0x24a6ac(0x170),_0xbeb38c);if(_0x3dc572[0x0]['language']==_0x24a6ac(0x177))var _0x867f2d=users[_0x24a6ac(0x12f)];else{if(_0x3dc572[0x0][_0x24a6ac(0x108)]==_0x24a6ac(0xc7))var _0x867f2d=users[_0x24a6ac(0xc7)];else{if(_0x3dc572[0x0][_0x24a6ac(0x108)]=='German')var _0x867f2d=users['German'];else{if(_0x3dc572[0x0][_0x24a6ac(0x108)]=='Spanish')var _0x867f2d=users[_0x24a6ac(0x11a)];else{if(_0x3dc572[0x0][_0x24a6ac(0x108)]==_0x24a6ac(0x81))var _0x867f2d=users[_0x24a6ac(0x81)];else{if(_0x3dc572[0x0][_0x24a6ac(0x108)]==_0x24a6ac(0x10e))var _0x867f2d=users[_0x24a6ac(0x90)];else{if(_0x3dc572[0x0][_0x24a6ac(0x108)]==_0x24a6ac(0xc0))var _0x867f2d=users[_0x24a6ac(0xc0)];else{if(_0x3dc572[0x0][_0x24a6ac(0x108)]=='Arabic\x20(ae)')var _0x867f2d=users[_0x24a6ac(0x15f)];}}}}}}}_0x33ac6b[_0x24a6ac(0xbc)]('all_sales_barcode',{'success':_0x4caa06[_0x24a6ac(0xd3)](_0x24a6ac(0xf0)),'errors':_0x4caa06[_0x24a6ac(0xd3)]('errors'),'role':_0x4c8a30,'profile':_0x1d6d85,'alldata':_0xbeb38c,'master_shop':_0x3dc572,'language':_0x867f2d});}catch(_0x9ad03a){console[_0x24a6ac(0x165)](_0x9ad03a);}}),router[a0_0x40c111(0x137)](a0_0x40c111(0xbb),async(_0x42bf6c,_0x524e2d)=>{var _0x5811bb=a0_0x40c111;const {product_code:_0x3501b7,warehouse_name:_0x1f43d2,rooms_data:_0x40935d,Roomslist:_0x20d58f}=_0x42bf6c['body'],_0xe1d196=_0x20d58f[_0x5811bb(0x8f)](','),_0x219dc8=[];async function _0x1c786d(_0x5059f3){var _0x170481=_0x5811bb;const _0xc7b52d=await warehouse[_0x170481(0xff)]([{'$match':{'name':_0x1f43d2,'room':_0x5059f3}},{'$unwind':_0x170481(0xa4)},{'$match':{'product_details.primary_code':_0x3501b7}},{'$group':{'_id':_0x170481(0x9a),'name':{'$first':_0x170481(0x149)},'product_stock':{'$first':_0x170481(0x89)},'primary_code':{'$first':_0x170481(0x13f)},'secondary_code':{'$first':_0x170481(0xb3)},'product_code':{'$first':_0x170481(0x140)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x170481(0xbe)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x170481(0x15d)},'unit':{'$first':_0x170481(0x150)},'secondary_unit':{'$first':_0x170481(0x133)},'storage':{'$first':_0x170481(0xcc)},'rack':{'$first':_0x170481(0x17d)},'expiry_date':{'$first':_0x170481(0x120)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x170481(0x141)},'batch_code':{'$first':_0x170481(0x131)},'product_cat':{'$first':_0x170481(0xf5)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x170481(0xc8)},'invoice':{'$first':_0x170481(0x127)}}}]),_0xd19853=await warehouse[_0x170481(0xff)]([{'$match':{'name':_0x1f43d2,'room':_0x5059f3}},{'$unwind':_0x170481(0xa4)},{'$match':{'product_details.secondary_code':_0x3501b7}},{'$group':{'_id':_0x170481(0x9a),'name':{'$first':_0x170481(0x149)},'product_stock':{'$first':_0x170481(0x89)},'primary_code':{'$first':_0x170481(0x13f)},'secondary_code':{'$first':_0x170481(0xb3)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x170481(0x84)},'isle':{'$first':_0x170481(0xbe)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x170481(0x15d)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x170481(0x133)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x170481(0x17d)},'expiry_date':{'$first':_0x170481(0x120)},'production_date':{'$first':_0x170481(0xcb)},'maxPerUnit':{'$first':_0x170481(0x141)},'batch_code':{'$first':_0x170481(0x131)},'product_cat':{'$first':_0x170481(0xf5)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x170481(0xc8)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0xc7b52d[_0x170481(0xce)]>0x0)_0x219dc8['push'](_0xc7b52d);else _0xd19853[_0x170481(0xce)]>0x0&&_0x219dc8[_0x170481(0xe9)](_0xd19853);}const _0xffcd53=_0xe1d196[_0x5811bb(0x103)](_0x3e9048=>_0x1c786d(_0x3e9048));await Promise['all'](_0xffcd53),_0x524e2d['json'](_0x219dc8);}),module[a0_0x40c111(0x123)]=router;