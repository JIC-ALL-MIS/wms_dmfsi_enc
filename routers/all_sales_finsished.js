var a0_0x2ea595=a0_0x102b;(function(_0x8eb568,_0x6c4ced){var _0x554dc7=a0_0x102b,_0x1e3ea0=_0x8eb568();while(!![]){try{var _0x350292=-parseInt(_0x554dc7(0x14a))/0x1+-parseInt(_0x554dc7(0x1d8))/0x2*(parseInt(_0x554dc7(0x11c))/0x3)+parseInt(_0x554dc7(0x19d))/0x4*(-parseInt(_0x554dc7(0x182))/0x5)+-parseInt(_0x554dc7(0x1c8))/0x6+parseInt(_0x554dc7(0xe5))/0x7+parseInt(_0x554dc7(0x141))/0x8+parseInt(_0x554dc7(0x199))/0x9;if(_0x350292===_0x6c4ced)break;else _0x1e3ea0['push'](_0x1e3ea0['shift']());}catch(_0x6e9cc4){_0x1e3ea0['push'](_0x1e3ea0['shift']());}}}(a0_0x1d68,0x83184));const express=require(a0_0x2ea595(0x10e)),app=express(),router=express[a0_0x2ea595(0x1c5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x2ea595(0x1a8)),auth=require('../middleware/auth'),nodemailer=require(a0_0x2ea595(0x153)),users=require(a0_0x2ea595(0x148));router[a0_0x2ea595(0x138)](a0_0x2ea595(0x1af),auth,async(_0x28de64,_0x399512)=>{var _0x48c0d5=a0_0x2ea595;try{const {username:_0xd7d6f8,email:_0x3ddab2,role:_0x4a1d3c}=_0x28de64[_0x48c0d5(0x195)],_0x56ad25=_0x28de64['user'],_0x19e225=await profile[_0x48c0d5(0x127)]({'email':_0x56ad25[_0x48c0d5(0x121)]}),_0x117d29=await master_shop[_0x48c0d5(0x125)]();let _0x2ea400;if(_0x56ad25[_0x48c0d5(0x132)]==_0x48c0d5(0x119)){const _0x33b5f3=await staff[_0x48c0d5(0x127)]({'email':_0x56ad25['email']});_0x2ea400=await sales_finished[_0x48c0d5(0x1df)]([{'$lookup':{'from':_0x48c0d5(0x175),'localField':_0x48c0d5(0x1b2),'foreignField':_0x48c0d5(0xdc),'as':_0x48c0d5(0x1ca)}},{'$unwind':_0x48c0d5(0xd3)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x48c0d5(0xea),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x48c0d5(0x1e5)},'date':{'$first':_0x48c0d5(0x1b4)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x48c0d5(0x15d)},'customers_docs':{'$first':_0x48c0d5(0xd3)},'total_saleproduct_quantity':{'$sum':_0x48c0d5(0x15b)},'level':{'$addToSet':_0x48c0d5(0x1ac)},'isle':{'$addToSet':_0x48c0d5(0x158)},'type':{'$addToSet':_0x48c0d5(0x106)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x48c0d5(0x1dc)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x2ea400=await sales_finished[_0x48c0d5(0x1df)]([{'$lookup':{'from':'customers','localField':_0x48c0d5(0x1b2),'foreignField':'name','as':_0x48c0d5(0x1ca)}},{'$unwind':_0x48c0d5(0xd3)},{'$unwind':_0x48c0d5(0x1a9)},{'$group':{'_id':_0x48c0d5(0xea),'invoice':{'$first':_0x48c0d5(0x111)},'customers':{'$first':_0x48c0d5(0x1e5)},'date':{'$first':_0x48c0d5(0x1b4)},'warehouse_name':{'$first':_0x48c0d5(0x18a)},'sale_product':{'$push':_0x48c0d5(0x1a9)},'note':{'$first':_0x48c0d5(0x161)},'return_data':{'$first':_0x48c0d5(0x15d)},'customers_docs':{'$first':_0x48c0d5(0xd3)},'total_saleproduct_quantity':{'$sum':_0x48c0d5(0x15b)},'level':{'$addToSet':_0x48c0d5(0x1ac)},'isle':{'$addToSet':_0x48c0d5(0x158)},'type':{'$addToSet':_0x48c0d5(0x106)},'pallet':{'$addToSet':_0x48c0d5(0x1ba)},'finalize':{'$first':_0x48c0d5(0x1dc)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x117d29[0x0][_0x48c0d5(0x126)]=='English\x20(US)'){var _0x39da75=users[_0x48c0d5(0xfa)];console[_0x48c0d5(0x19a)](_0x39da75);}else{if(_0x117d29[0x0][_0x48c0d5(0x126)]==_0x48c0d5(0xe7))var _0x39da75=users['Hindi'];else{if(_0x117d29[0x0][_0x48c0d5(0x126)]==_0x48c0d5(0x167))var _0x39da75=users[_0x48c0d5(0x167)];else{if(_0x117d29[0x0][_0x48c0d5(0x126)]==_0x48c0d5(0x169))var _0x39da75=users[_0x48c0d5(0x169)];else{if(_0x117d29[0x0][_0x48c0d5(0x126)]==_0x48c0d5(0x1ad))var _0x39da75=users[_0x48c0d5(0x1ad)];else{if(_0x117d29[0x0][_0x48c0d5(0x126)]=='Portuguese\x20(BR)')var _0x39da75=users[_0x48c0d5(0xf8)];else{if(_0x117d29[0x0]['language']==_0x48c0d5(0x163))var _0x39da75=users[_0x48c0d5(0x163)];else{if(_0x117d29[0x0]['language']=='Arabic\x20(ae)')var _0x39da75=users[_0x48c0d5(0x1d3)];}}}}}}}_0x399512[_0x48c0d5(0x16a)]('all_sales_finished',{'success':_0x28de64['flash'](_0x48c0d5(0x110)),'errors':_0x28de64['flash'](_0x48c0d5(0x1bb)),'sales':_0x2ea400,'profile':_0x19e225,'role':_0x56ad25,'master_shop':_0x117d29,'language':_0x39da75});}catch(_0x208b1f){console[_0x48c0d5(0x19a)](_0x208b1f);}});function a0_0x1d68(){var _0x498d80=['$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','payment\x20successfull','False','user','English\x20(US)','/view/:id','\x20</h2>','7448346UtNLAi','log','sales_quantity_QA','return_qty','8DHYVqi','<tbody\x20style=\x22text-align:\x20center;\x22>','<tr>','all','</div>','warehouse_name','save','maxPerUnit_QA','True','/barcode_scanner','Sale\x20Product\x20Mail','../models/all_models','$sale_product','received_amount','flash','$sale_product.bay','French','password','/view','$product.product_name','string','customer','</head><body>','$date','primary_code_QA','$product_details._id','$product_details.maxPerUnit','unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$sale_product.floorlevel','errors','/view/add_sale/product','Logo.png','sale_product','gmail','<table\x20style=\x22width:\x20100%\x20!important;\x22>','production_date_QA','json','Email\x20sent\x20successfully','$product_details.bay','Router','<h5\x20style=\x22text-align:\x20left;\x22>','batch_code','973200PkOUqI','maxProducts','customers_docs','</table>','$product','product_list','batch_code_QA','Sale\x20Return','back','prod_cat','return_sale','Arabic','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','suppliers','_id','14WhAerM','host','DRY\x20GOODS','Enabled','$finalize','prod_invoice','</tr>','aggregate','$product_details.floorlevel','expiry_date_QA','prod_code','\x20Order\x20Number\x20:\x20','/upload/','$customer','$customers_docs','Sales\x20Add\x20successfully','port','currency','Sale\x20Return\x20Mail','<strong>\x20Regards\x20</strong>','product_data','</thead>','$product_details.primary_code','name','sendMail','Error\x20Occurs','<div>','room_name','</body></html>','note','carton','<h2>\x20','1475880OuSMwN','redirect','Hindi','currency_placement','product_code_QA','$_id','unit_QA','product_stock','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','primary_unit','Ambient','return_qty_QA','<h5>','filter','sales\x20item\x20return\x20successfull','$product_details.secondary_code','sales_quantity','secondary_unit_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Portuguese','amount','English','floor','due_amount','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Sale','message','findById','Portuguese\x20(BR)','$product_details.type','createTransport','\x20Order\x20Date\x20:\x20','OUTF-','$sale_product.type','finalize','$product_details.product_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<html><head><title></title>','product_details','$product_details.rack','$product_details.invoice','express','getMonth','success','$invoice','maxPerUnit','return_data','date','return_sale_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','production_date','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','staff','concat','<!DOCTYPE\x20html>','20037EkSbre','padStart','room','sale_qty','An\x20error\x20occurred\x20while\x20saving\x20data.','email','stock','exports','$room','find','language','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','</h5>','</span>','</td>','Enclosed','$product_details.batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','expiry_date','quantity','image','role','Finished\x20Goods','/view/add_sales/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','edit_sales_finished_view','/view/return_sales/:id','get','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','post','/all_sales_finished/preview/','random','Sales\x20Update\x20successfully','/../public','foreach\x20newproduct','6818768FwUhBc','sales_invoice','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','length','secondary_code','status','error','../public/language/languages.json','add_sales_finished','650497BDFfTM','slice','then','$product_details.maxProducts','FGSEmail','<hr\x20class=\x22my-3\x22>','product_code','primary_code','$product_details.production_date','nodemailer','/preview/:id','$product_details.product_cat','push','level','$sale_product.bin','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$sale_product.quantity','all_sales_barcode','$return_data','params','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$note','/invoice/:id','Chinese','secondary_code_QA','body','for_categorize','German','$name','Spanish','render','product_date','toString','/give_payment/:id','maxProducts_QA','$product_details.unit','$product_details','Quality\x20Inspection','invoice','site_title','warehouse','customers','<span\x20style=\x22float:\x20right;\x22>','Arabic\x20(ae)','/view/add_sales','stocks_QA','/all_sales_finished/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','</tbody>','purchases_data','product_name','product','$product_details.expiry_date','secondary_unit','1235915XgrbUH','map','$product_details.secondary_unit','Sales\x20Mail','$product_details.product_stock','catch','barcode\x20user_id','forEach','$warehouse_name','stock_data','product_name_QA1','bay','Received\x20Payment\x20For\x20Sale','Return\x20Goods'];a0_0x1d68=function(){return _0x498d80;};return a0_0x1d68();}async function getRandom8DigitNumber(){var _0x5d66eb=a0_0x2ea595;const _0x52ec3a=0x989680,_0x531531=0x5f5e0ff,_0x51d701=Math[_0x5d66eb(0xfb)](Math[_0x5d66eb(0x13d)]()*(_0x531531-_0x52ec3a+0x1))+_0x52ec3a;var _0x3dec6f;const _0x12fe17=await sales_finished[_0x5d66eb(0x127)]({'invoice':_0x5d66eb(0x105)+_0x51d701});return _0x12fe17&&_0x12fe17[_0x5d66eb(0x144)]>0x0?_0x3dec6f='OUTF-'+_0x51d701:_0x3dec6f=_0x5d66eb(0x105)+_0x51d701,_0x3dec6f;}function a0_0x102b(_0x16dc5c,_0x2db104){var _0x1d6861=a0_0x1d68();return a0_0x102b=function(_0x102bc2,_0x52f172){_0x102bc2=_0x102bc2-0xd3;var _0x1eaf19=_0x1d6861[_0x102bc2];return _0x1eaf19;},a0_0x102b(_0x16dc5c,_0x2db104);}router[a0_0x2ea595(0x138)](a0_0x2ea595(0x178),auth,async(_0x1f8672,_0x24eef5)=>{var _0x426ba5=a0_0x2ea595;try{const {username:_0x4478c4,email:_0x1ec99e,role:_0x44ee66}=_0x1f8672[_0x426ba5(0x195)],_0x2be690=_0x1f8672[_0x426ba5(0x195)],_0x2d8c3e=await profile[_0x426ba5(0x127)]({'email':_0x2be690[_0x426ba5(0x121)]}),_0x21d095=await master_shop[_0x426ba5(0x125)](),_0xe794c8=await customer[_0x426ba5(0x125)]({});let _0x1fab2a;if(_0x2be690['role']==_0x426ba5(0x119)){const _0x24ec0d=await staff[_0x426ba5(0x127)]({'email':_0x2be690[_0x426ba5(0x121)]});_0x1fab2a=await warehouse[_0x426ba5(0x1df)]([{'$match':{'status':'Enabled','name':_0x24ec0d['warehouse'],'warehouse_category':_0x426ba5(0x133),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x426ba5(0x168),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x1fab2a=await warehouse[_0x426ba5(0x1df)]([{'$match':{'status':_0x426ba5(0x1db),'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x6b66ed=await product[_0x426ba5(0x125)]({});var _0x6430ca=[_0x426ba5(0xef),'Enclosed'];const _0x5dcb39=await sales_finished[_0x426ba5(0x125)]({}),_0x1e7d68=_0x5dcb39[_0x426ba5(0x144)]+0x1,_0x162651=_0x426ba5(0x105)+_0x1e7d68[_0x426ba5(0x16c)]()[_0x426ba5(0x11d)](0x5,'0');if(_0x21d095[0x0]['language']=='English\x20(US)'){var _0x294ecb=users[_0x426ba5(0xfa)];console[_0x426ba5(0x19a)](_0x294ecb);}else{if(_0x21d095[0x0][_0x426ba5(0x126)]==_0x426ba5(0xe7))var _0x294ecb=users[_0x426ba5(0xe7)];else{if(_0x21d095[0x0][_0x426ba5(0x126)]=='German')var _0x294ecb=users['German'];else{if(_0x21d095[0x0][_0x426ba5(0x126)]==_0x426ba5(0x169))var _0x294ecb=users[_0x426ba5(0x169)];else{if(_0x21d095[0x0][_0x426ba5(0x126)]==_0x426ba5(0x1ad))var _0x294ecb=users[_0x426ba5(0x1ad)];else{if(_0x21d095[0x0][_0x426ba5(0x126)]==_0x426ba5(0x101))var _0x294ecb=users[_0x426ba5(0xf8)];else{if(_0x21d095[0x0]['language']==_0x426ba5(0x163))var _0x294ecb=users[_0x426ba5(0x163)];else{if(_0x21d095[0x0][_0x426ba5(0x126)]==_0x426ba5(0x177))var _0x294ecb=users[_0x426ba5(0x1d3)];}}}}}}}const _0x1bc362=getRandom8DigitNumber();_0x1bc362['then'](_0x3ca3f9=>{var _0x4ede27=_0x426ba5;_0x24eef5[_0x4ede27(0x16a)](_0x4ede27(0x149),{'success':_0x1f8672['flash'](_0x4ede27(0x110)),'errors':_0x1f8672[_0x4ede27(0x1ab)]('errors'),'role':_0x2be690,'profile':_0x2d8c3e,'customer':_0xe794c8,'warehouse':_0x1fab2a,'product':_0x6b66ed,'invoice':_0x3ca3f9,'master_shop':_0x21d095,'language':_0x294ecb,'rooms_data':_0x6430ca});})[_0x426ba5(0x187)](_0x50e129=>{var _0x44e378=_0x426ba5;_0x1f8672[_0x44e378(0x1ab)](_0x44e378(0x1bb),_0x44e378(0x109)),_0x24eef5[_0x44e378(0xe6)](_0x44e378(0x17a));});}catch(_0x29edc7){console[_0x426ba5(0x19a)](_0x29edc7);}}),router[a0_0x2ea595(0x138)](a0_0x2ea595(0x134),auth,async(_0x3e34aa,_0x3534d5)=>{var _0x5f0a5c=a0_0x2ea595;try{const _0x521c3b=_0x3e34aa[_0x5f0a5c(0x15e)]['id'];console[_0x5f0a5c(0x19a)](_0x521c3b);const _0x99ed80=await product['find'](),_0x1fceb4=await purchases['aggregate']([{'$match':{'warehouse_name':_0x521c3b}},{'$unwind':_0x5f0a5c(0x1cc)},{'$group':{'_id':_0x5f0a5c(0x1b0)}}]);console[_0x5f0a5c(0x19a)](_0x5f0a5c(0x17d),_0x1fceb4),_0x3534d5[_0x5f0a5c(0x146)](0xc8)[_0x5f0a5c(0x1c2)]({'purchases_data':_0x1fceb4,'product_data':_0x99ed80});}catch(_0xb33f91){console[_0x5f0a5c(0x19a)](_0xb33f91);}}),router[a0_0x2ea595(0x13b)](a0_0x2ea595(0x1bc),auth,async(_0x636f9f,_0x3580be)=>{var _0x50dccb=a0_0x2ea595;try{const {warehouse_data:_0x21f6bf,product_data:_0x4a8210}=_0x636f9f[_0x50dccb(0x165)];console['log'](_0x636f9f[_0x50dccb(0x165)][_0x50dccb(0xd9)]);;const _0x3e0997=await master_shop[_0x50dccb(0x125)]();console[_0x50dccb(0x19a)]('master',_0x3e0997);const _0x4aaabd=await product[_0x50dccb(0x127)]({'name':_0x4a8210});console['log'](_0x50dccb(0x17f),_0x4aaabd);const _0x4f401a=await warehouse[_0x50dccb(0x1df)]([{'$match':{'name':_0x21f6bf}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x4a8210}},{'$group':{'_id':_0x50dccb(0x108),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x50dccb(0x19a)](_0x50dccb(0x18b),_0x4f401a),_0x3580be['status'](0xc8)['json']({'master':_0x3e0997,'new_product':_0x4aaabd,'stock_data':_0x4f401a});}catch(_0x219642){console['log'](_0x219642);}}),router[a0_0x2ea595(0x13b)]('/view/add_sales',auth,async(_0x5a5d4b,_0x5c0bdd)=>{var _0x2b2c25=a0_0x2ea595;try{const {invoice:_0xaf90ab,date:_0x485a2f,warehouse_name:_0x39947f,product_name:_0x2d7b42,stock:_0x36c614,quantity:_0x55e134,note:_0x384507,room:_0x51ef96,primary_code:_0x9ccc6f,secondary_code:_0x5ad261,prod_code:_0x204095,level:_0x2152e1,isle:_0x4a1085,pallet:_0x3069c7,batch_code:_0x47550e,SCRN:_0x49f706,expiry_date:_0x333c12,mode_transpo:_0x508dff,name_driver:_0x10746d}=_0x5a5d4b[_0x2b2c25(0x165)];if(typeof _0x2d7b42=='string')var _0x46905a=[_0x5a5d4b[_0x2b2c25(0x165)]['product_name']],_0x4d9d0c=[_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x122)]],_0x36ee50=[_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0xe3)]],_0x29e118=[_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x151)]],_0x1d96b7=[_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x145)]],_0x3b0336=[_0x5a5d4b[_0x2b2c25(0x165)]['prod_code']],_0x4b5db8=[_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x157)]],_0x4547ec=[_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0xee)]],_0x35ae38=[_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x181)]],_0x3fd694=[_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x1c7)]],_0x4bd586=[_0x5a5d4b['body'][_0x2b2c25(0x12f)]],_0x1814bf=[_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x16b)]],_0x3b378e=[_0x5a5d4b[_0x2b2c25(0x165)]['max_per_unit']],_0x1d0686=[_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x1d1)]],_0x38c0aa=[_0x5a5d4b[_0x2b2c25(0x165)]['RoomAssigned']],_0x561fd8=[_0x5a5d4b['body'][_0x2b2c25(0x1dd)]];else var _0x46905a=[..._0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x17e)]],_0x4d9d0c=[..._0x5a5d4b['body'][_0x2b2c25(0x122)]],_0x36ee50=[..._0x5a5d4b['body']['carton']],_0x29e118=[..._0x5a5d4b[_0x2b2c25(0x165)]['primary_code']],_0x1d96b7=[..._0x5a5d4b[_0x2b2c25(0x165)]['secondary_code']],_0x3b0336=[..._0x5a5d4b[_0x2b2c25(0x165)]['prod_code']],_0x4b5db8=[..._0x5a5d4b[_0x2b2c25(0x165)]['level']],_0x4547ec=[..._0x5a5d4b[_0x2b2c25(0x165)]['primary_unit']],_0x35ae38=[..._0x5a5d4b[_0x2b2c25(0x165)]['secondary_unit']],_0x3fd694=[..._0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x1c7)]],_0x4bd586=[..._0x5a5d4b['body']['expiry_date']],_0x1814bf=[..._0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x16b)]],_0x3b378e=[..._0x5a5d4b[_0x2b2c25(0x165)]['max_per_unit']],_0x1d0686=[..._0x5a5d4b[_0x2b2c25(0x165)]['prod_cat']],_0x38c0aa=[..._0x5a5d4b[_0x2b2c25(0x165)]['RoomAssigned']],_0x561fd8=[..._0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x1dd)]];const _0x3b651b=_0x46905a['map'](_0x712eac=>{return _0x712eac={'product_name':_0x712eac};});_0x4d9d0c[_0x2b2c25(0x189)]((_0x2e46e7,_0x144ae4)=>{var _0x1dad26=_0x2b2c25;_0x3b651b[_0x144ae4][_0x1dad26(0x122)]=_0x2e46e7;}),_0x36ee50[_0x2b2c25(0x189)]((_0x488294,_0x394bd4)=>{var _0x2519b5=_0x2b2c25;_0x3b651b[_0x394bd4][_0x2519b5(0x130)]=_0x488294;}),_0x29e118['forEach']((_0x3f70a9,_0x21f453)=>{var _0x151d4b=_0x2b2c25;_0x3b651b[_0x21f453][_0x151d4b(0x151)]=_0x3f70a9;}),_0x1d96b7[_0x2b2c25(0x189)]((_0x23291d,_0x8ee2da)=>{var _0x29fa19=_0x2b2c25;_0x3b651b[_0x8ee2da][_0x29fa19(0x145)]=_0x23291d;}),_0x3b0336[_0x2b2c25(0x189)]((_0x503a0d,_0x38861f)=>{_0x3b651b[_0x38861f]['product_code']=_0x503a0d;}),_0x4b5db8[_0x2b2c25(0x189)]((_0x1dbf4b,_0x401a74)=>{var _0x54897f=_0x2b2c25;_0x3b651b[_0x401a74][_0x54897f(0x18d)]=_0x1dbf4b;}),_0x4547ec[_0x2b2c25(0x189)]((_0x4bb873,_0x345367)=>{var _0x3880c1=_0x2b2c25;_0x3b651b[_0x345367][_0x3880c1(0x1b8)]=_0x4bb873;}),_0x35ae38[_0x2b2c25(0x189)]((_0x548931,_0x443b1f)=>{var _0x2c595e=_0x2b2c25;_0x3b651b[_0x443b1f][_0x2c595e(0x181)]=_0x548931;}),_0x3fd694[_0x2b2c25(0x189)]((_0x18d22d,_0xb2215)=>{var _0x3a5be2=_0x2b2c25;_0x3b651b[_0xb2215][_0x3a5be2(0x1c7)]=_0x18d22d;}),_0x4bd586[_0x2b2c25(0x189)]((_0x4a27dc,_0x21b4b0)=>{var _0x4311c7=_0x2b2c25;_0x3b651b[_0x21b4b0][_0x4311c7(0x12f)]=_0x4a27dc;}),_0x1814bf[_0x2b2c25(0x189)]((_0xa87b3a,_0x4c8e45)=>{var _0x5c3fd0=_0x2b2c25;_0x3b651b[_0x4c8e45][_0x5c3fd0(0x117)]=_0xa87b3a;}),_0x3b378e[_0x2b2c25(0x189)]((_0x2f3a4f,_0x394996)=>{_0x3b651b[_0x394996]['maxperunit']=_0x2f3a4f;}),_0x1d0686[_0x2b2c25(0x189)]((_0x169c78,_0x41a4a7)=>{var _0x1247a2=_0x2b2c25;_0x3b651b[_0x41a4a7][_0x1247a2(0x1d1)]=_0x169c78;}),_0x38c0aa[_0x2b2c25(0x189)]((_0x3f711e,_0x5c22b8)=>{var _0x377483=_0x2b2c25;_0x3b651b[_0x5c22b8][_0x377483(0xe0)]=_0x3f711e;}),_0x561fd8['forEach']((_0x2558bd,_0x5b9b9e)=>{var _0x1e2d75=_0x2b2c25;_0x3b651b[_0x5b9b9e][_0x1e2d75(0x172)]=_0x2558bd;});var _0x4ad81f=0x0;_0x3b651b[_0x2b2c25(0x189)](_0x23e4f6=>{var _0x4c40e4=_0x2b2c25;console[_0x4c40e4(0x19a)](_0x4c40e4(0x140),_0x23e4f6),(parseInt(_0x23e4f6[_0x4c40e4(0x122)])<parseInt(_0x23e4f6[_0x4c40e4(0x130)])||parseInt(_0x23e4f6[_0x4c40e4(0x130)])==0x0)&&_0x4ad81f++;});if(_0x4ad81f!=0x0)return _0x5a5d4b[_0x2b2c25(0x1ab)]('errors',_0x2b2c25(0xfd)),_0x5c0bdd['redirect'](_0x2b2c25(0x1d0));const _0x427b97=_0x3b651b[_0x2b2c25(0xf2)](_0x533789=>_0x533789[_0x2b2c25(0x130)]!=='0'&&_0x533789[_0x2b2c25(0x130)]!==''),_0x53dc22=new sales_finished({'invoice':_0xaf90ab,'customer':_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x1b2)],'date':_0x485a2f,'warehouse_name':_0x39947f,'sale_product':_0x427b97,'note':_0x384507,'room':_0x51ef96,'primary_code':_0x9ccc6f,'secondary_code':_0x5ad261,'prod_code':_0x204095,'SCRN':_0x49f706,'finalize':_0x2b2c25(0x194),'mode_transpo':_0x508dff,'name_driver':_0x10746d}),_0x45ded3=await _0x53dc22[_0x2b2c25(0x1a3)](),_0x18cd4f=await sales_finished[_0x2b2c25(0x127)]({'invoice':_0xaf90ab}),_0x120694=new c_payment_data({'invoice':_0xaf90ab,'customer':_0x5a5d4b[_0x2b2c25(0x165)]['customer'],'reason':_0x2b2c25(0xfe)});await _0x120694[_0x2b2c25(0x1a3)]();const _0x30a253=await master_shop['find'](),_0x1c3235=await email_settings[_0x2b2c25(0x127)](),_0x2b0c57=await customer[_0x2b2c25(0x127)]({'name':_0x5a5d4b[_0x2b2c25(0x165)][_0x2b2c25(0x1b2)]});_0x30a253[0x0][_0x2b2c25(0xe8)]==0x1?(right_currency=_0x30a253[0x0][_0x2b2c25(0xd6)],left_currency=''):(right_currency='',left_currency=_0x30a253[0x0][_0x2b2c25(0xd6)]);var _0xf4ac58=_0x46905a,_0x4ac2f6=_0x36ee50,_0x242a55='',_0x2dee32;for(_0x2dee32 in _0xf4ac58){_0x242a55+=_0x2b2c25(0x19f)+_0x2b2c25(0x139)+_0xf4ac58[_0x2dee32]+_0x2b2c25(0x12b)+_0x2b2c25(0x139)+_0x4ac2f6[_0x2dee32]+_0x2b2c25(0x12b)+_0x2b2c25(0x1de);}console['log'](_0x2b2c25(0x1cd),_0x242a55);let _0x2710a7=nodemailer['createTransport']({'service':_0x2b2c25(0x1bf),'auth':{'user':_0x1c3235[_0x2b2c25(0x121)],'pass':_0x1c3235[_0x2b2c25(0x1ae)]}}),_0x754aa8={'from':_0x1c3235[_0x2b2c25(0x121)],'to':_0x2b0c57[_0x2b2c25(0x121)],'subject':_0x2b2c25(0x1a7),'attachments':[{'filename':_0x2b2c25(0x1bd),'path':__dirname+_0x2b2c25(0x13f)+'/upload/'+_0x30a253[0x0][_0x2b2c25(0x131)],'cid':'logo'}],'html':_0x2b2c25(0x11b)+_0x2b2c25(0x10a)+_0x2b2c25(0x1b3)+_0x2b2c25(0xdf)+_0x2b2c25(0x192)+'<div>'+_0x2b2c25(0xed)+'</div>'+_0x2b2c25(0xdf)+_0x2b2c25(0xe4)+_0x30a253[0x0]['site_title']+_0x2b2c25(0x198)+_0x2b2c25(0x1a1)+_0x2b2c25(0x1a1)+_0x2b2c25(0x14f)+_0x2b2c25(0xdf)+_0x2b2c25(0x1c6)+'\x20Order\x20Number\x20:\x20'+_0xaf90ab+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2b2c25(0x104)+_0x485a2f+'\x20'+'</span>'+'</h5>'+_0x2b2c25(0x1a1)+_0x2b2c25(0x1c0)+_0x2b2c25(0x143)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2b2c25(0x128)+_0x2b2c25(0x1de)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x242a55+'\x20'+_0x2b2c25(0x17c)+_0x2b2c25(0x1cb)+_0x2b2c25(0xdf)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x30a253[0x0]['site_title']+'</h5>'+_0x2b2c25(0x1a1)+_0x2b2c25(0x1a1)+_0x2b2c25(0xe1)};_0x2710a7['sendMail'](_0x754aa8,function(_0x3c35a7,_0x51cdf1){var _0x1e0d6e=_0x2b2c25;_0x3c35a7?(console[_0x1e0d6e(0x19a)](_0x3c35a7),console[_0x1e0d6e(0x19a)](_0x1e0d6e(0xde))):console[_0x1e0d6e(0x19a)](_0x1e0d6e(0x1c3));}),_0x5a5d4b[_0x2b2c25(0x1ab)](_0x2b2c25(0x110),_0x2b2c25(0xd4)),_0x5c0bdd['redirect'](_0x2b2c25(0x13c)+_0x45ded3[_0x2b2c25(0x1d7)]);}catch(_0x28b552){console[_0x2b2c25(0x19a)](_0x28b552);}}),router[a0_0x2ea595(0x138)]('/preview/:id',auth,async(_0x4a24b2,_0x4fc1b7)=>{var _0x14fca6=a0_0x2ea595;try{const {username:_0x3bdf0f,email:_0x3123b5,role:_0x92f96e}=_0x4a24b2['user'],_0x39c210=_0x4a24b2[_0x14fca6(0x195)],_0x484291=await profile[_0x14fca6(0x127)]({'email':_0x39c210[_0x14fca6(0x121)]}),_0x504df7=await master_shop[_0x14fca6(0x125)](),_0x429705=_0x4a24b2['params']['id'],_0x43fa5b=await sales_finished['findById'](_0x429705),_0x17edf6=await warehouse['aggregate']([{'$match':{'name':_0x43fa5b[_0x14fca6(0x1a2)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x14fca6(0x108)},'product_stock':{'$first':_0x14fca6(0x186)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x14fca6(0x1d4)},'type':{'$first':_0x14fca6(0x102)},'floorlevel':{'$first':_0x14fca6(0x1e0)},'primary_code':{'$first':_0x14fca6(0xdb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x14fca6(0x15f)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x14fca6(0x10c)},'expiry_date':{'$first':_0x14fca6(0x180)},'production_date':{'$first':_0x14fca6(0x152)},'batch_code':{'$first':_0x14fca6(0x12d)},'room':{'$first':_0x14fca6(0x124)}}}]),_0x215691=await customer[_0x14fca6(0x125)]({});let _0x49b42a;if(_0x39c210[_0x14fca6(0x132)]==_0x14fca6(0x119)){const _0x595834=await staff[_0x14fca6(0x127)]({'email':_0x39c210[_0x14fca6(0x121)]});_0x49b42a=await warehouse[_0x14fca6(0x1df)]([{'$match':{'status':'Enabled','name':_0x595834[_0x14fca6(0x174)]}},{'$group':{'_id':_0x14fca6(0x168),'name':{'$first':'$name'}}}]);}else _0x49b42a=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x14fca6(0x168),'name':{'$first':'$name'}}}]);const _0x507e14=await product['find']({});if(_0x504df7[0x0][_0x14fca6(0x126)]==_0x14fca6(0x196)){var _0x341eba=users[_0x14fca6(0xfa)];console['log'](_0x341eba);}else{if(_0x504df7[0x0][_0x14fca6(0x126)]==_0x14fca6(0xe7))var _0x341eba=users[_0x14fca6(0xe7)];else{if(_0x504df7[0x0][_0x14fca6(0x126)]==_0x14fca6(0x167))var _0x341eba=users[_0x14fca6(0x167)];else{if(_0x504df7[0x0][_0x14fca6(0x126)]=='Spanish')var _0x341eba=users['Spanish'];else{if(_0x504df7[0x0][_0x14fca6(0x126)]==_0x14fca6(0x1ad))var _0x341eba=users['French'];else{if(_0x504df7[0x0][_0x14fca6(0x126)]==_0x14fca6(0x101))var _0x341eba=users['Portuguese'];else{if(_0x504df7[0x0][_0x14fca6(0x126)]=='Chinese')var _0x341eba=users[_0x14fca6(0x163)];else{if(_0x504df7[0x0][_0x14fca6(0x126)]==_0x14fca6(0x177))var _0x341eba=users[_0x14fca6(0x1d3)];}}}}}}}_0x4fc1b7['render'](_0x14fca6(0x136),{'success':_0x4a24b2[_0x14fca6(0x1ab)](_0x14fca6(0x110)),'errors':_0x4a24b2[_0x14fca6(0x1ab)](_0x14fca6(0x1bb)),'role':_0x39c210,'profile':_0x484291,'customer':_0x215691,'warehouse':_0x49b42a,'product':_0x17edf6,'user':_0x43fa5b,'master_shop':_0x504df7,'unit':_0x507e14,'language':_0x341eba});}catch(_0x40706e){console[_0x14fca6(0x19a)](_0x40706e);}}),router[a0_0x2ea595(0x13b)](a0_0x2ea595(0x154),auth,async(_0x42f32e,_0x140570)=>{var _0xbd8366=a0_0x2ea595;try{const _0x314b01=_0x42f32e[_0xbd8366(0x15e)]['id'],{invoice:_0x41ef08,warehouse_name:_0x4ae820,room:_0x570968}=_0x42f32e[_0xbd8366(0x165)],_0x102ec9=await sales_finished['findOne']({'invoice':_0x41ef08}),_0x1d29c7=_0x102ec9[_0xbd8366(0x1be)][_0xbd8366(0x183)](async _0x553c91=>{var _0x3c2ec8=_0xbd8366,_0x12a618=await warehouse[_0x3c2ec8(0x127)]({'name':_0x4ae820,'room':_0x553c91[_0x3c2ec8(0xe0)],'warehouse_category':_0x3c2ec8(0x133)});const _0x50a7c2=_0x12a618[_0x3c2ec8(0x10b)][_0x3c2ec8(0x183)](_0x2cb1e2=>{var _0x56f062=_0x3c2ec8;_0x2cb1e2[_0x56f062(0x17e)]==_0x553c91['product_name']&&_0x2cb1e2[_0x56f062(0x18d)]==_0x553c91[_0x56f062(0x18d)]&&_0x2cb1e2[_0x56f062(0x12f)]==_0x553c91[_0x56f062(0x12f)]&&_0x2cb1e2[_0x56f062(0x117)]==_0x553c91[_0x56f062(0x117)]&&_0x2cb1e2['batch_code']==_0x553c91[_0x56f062(0x1c7)]&&_0x2cb1e2[_0x56f062(0x172)]==_0x553c91[_0x56f062(0x172)]&&(_0x2cb1e2[_0x56f062(0xec)]=_0x2cb1e2[_0x56f062(0xec)]-_0x553c91[_0x56f062(0x130)]);});return _0x12a618;});Promise[_0xbd8366(0x1a0)](_0x1d29c7)[_0xbd8366(0x14c)](async _0x2d3e9c=>{var _0x17951e=_0xbd8366;try{for(const _0x417a11 of _0x2d3e9c){await _0x417a11['save']();}_0x102ec9[_0x17951e(0x107)]=_0x17951e(0x1a5);const _0x177ec1=await _0x102ec9[_0x17951e(0x1a3)](),_0x1327eb=await master_shop[_0x17951e(0x125)](),_0x39c93d=await email_settings[_0x17951e(0x127)](),_0x1d4b67=await supervisor_settings[_0x17951e(0x125)]();var _0x5d0821=_0x102ec9[_0x17951e(0x1be)],_0x48ff01='',_0x3993c2;for(_0x3993c2 in _0x5d0821){var _0x1a303e='FG';_0x102ec9[_0x17951e(0x1a2)]==_0x17951e(0x1da)&&(_0x1a303e='DG'),_0x48ff01+=_0x17951e(0x19f)+_0x17951e(0x139)+_0x5d0821[_0x3993c2][_0x17951e(0x17e)]+_0x17951e(0x12b)+_0x17951e(0x139)+_0x5d0821[_0x3993c2][_0x17951e(0x150)]+_0x17951e(0x12b)+_0x17951e(0x139)+_0x5d0821[_0x3993c2][_0x17951e(0x130)]+_0x17951e(0x12b)+_0x17951e(0x139)+_0x5d0821[_0x3993c2]['unit']+_0x17951e(0x12b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5d0821[_0x3993c2]['secondary_unit']+'</td>'+_0x17951e(0x139)+_0x102ec9['warehouse_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5d0821[_0x3993c2][_0x17951e(0xe0)]+_0x17951e(0x12b)+_0x17951e(0x139)+_0x1a303e+_0x5d0821[_0x3993c2][_0x17951e(0x18d)]+_0x17951e(0x12b);}let _0x5d8199=nodemailer[_0x17951e(0x103)]({'host':_0x39c93d[_0x17951e(0x1d9)],'port':Number(_0x39c93d[_0x17951e(0xd5)]),'secure':![],'auth':{'user':_0x39c93d[_0x17951e(0x121)],'pass':_0x39c93d['password']}}),_0x519835={'from':_0x39c93d[_0x17951e(0x121)],'to':_0x1d4b67[0x0][_0x17951e(0x14e)],'subject':_0x17951e(0x185),'attachments':[{'filename':'Logo.png','path':__dirname+_0x17951e(0x13f)+_0x17951e(0x1e4)+_0x1327eb[0x0][_0x17951e(0x131)],'cid':_0x17951e(0x159)}],'html':_0x17951e(0x11b)+_0x17951e(0x10a)+_0x17951e(0x1b3)+_0x17951e(0xdf)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x17951e(0xdf)+_0x17951e(0xed)+_0x17951e(0x1a1)+_0x17951e(0xdf)+_0x17951e(0xe4)+_0x1327eb[0x0][_0x17951e(0x173)]+_0x17951e(0x198)+_0x17951e(0x1a1)+'</div>'+_0x17951e(0x14f)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x17951e(0x1e3)+_0x102ec9[_0x17951e(0x172)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x17951e(0x104)+_0x102ec9[_0x17951e(0x114)]+'\x20'+_0x17951e(0x12a)+_0x17951e(0x129)+_0x17951e(0x1a1)+_0x17951e(0x1c0)+_0x17951e(0x143)+_0x17951e(0x19f)+_0x17951e(0x12e)+_0x17951e(0x191)+_0x17951e(0x160)+_0x17951e(0x116)+_0x17951e(0x17b)+_0x17951e(0x1b9)+_0x17951e(0xf7)+_0x17951e(0x135)+_0x17951e(0x1de)+'</thead>'+_0x17951e(0x19e)+'\x20'+_0x48ff01+'\x20'+_0x17951e(0x17c)+_0x17951e(0x1cb)+_0x17951e(0xdf)+_0x17951e(0xd8)+_0x17951e(0xf1)+_0x1327eb[0x0]['site_title']+_0x17951e(0x129)+_0x17951e(0x1a1)+'</div>'+_0x17951e(0xe1)};_0x5d8199[_0x17951e(0xdd)](_0x519835,function(_0x3b71a6,_0x4be3f7){var _0x3dc950=_0x17951e;_0x3b71a6?(console[_0x3dc950(0x19a)](_0x3b71a6),console[_0x3dc950(0x19a)](_0x3dc950(0xde))):console[_0x3dc950(0x19a)](_0x3dc950(0x1c3));}),_0x42f32e['flash'](_0x17951e(0x110),'Sales\x20Update\x20successfully'),_0x140570['redirect']('/picking_list/pdf/'+_0x314b01);}catch(_0x3eab08){console[_0x17951e(0x147)](_0x3eab08),_0x140570[_0x17951e(0x146)](0x1f4)['json']({'error':_0x17951e(0x120)});}})['catch'](_0x3a0921=>{var _0x37c5f8=_0xbd8366;console[_0x37c5f8(0x147)](_0x3a0921),_0x140570[_0x37c5f8(0x146)](0x1f4)[_0x37c5f8(0x1c2)]({'error':'An\x20error\x20occurred.'});});}catch(_0x36f71f){console[_0xbd8366(0x19a)](_0x36f71f);}}),router[a0_0x2ea595(0x138)](a0_0x2ea595(0x197),auth,async(_0x519d63,_0x50f24a)=>{var _0x2e24c7=a0_0x2ea595;try{const {username:_0x38b491,email:_0x5603b4,role:_0x3b5643}=_0x519d63[_0x2e24c7(0x195)],_0x44cf88=_0x519d63[_0x2e24c7(0x195)],_0x4316fb=await profile['findOne']({'email':_0x44cf88[_0x2e24c7(0x121)]}),_0x2458af=await master_shop['find'](),_0x1c77a8=_0x519d63[_0x2e24c7(0x15e)]['id'],_0x50ec89=await sales_finished[_0x2e24c7(0x100)](_0x1c77a8);let _0x1fafb1=new Date(_0x50ec89[_0x2e24c7(0x12f)]),_0x45472d=('0'+_0x1fafb1['getDate']())[_0x2e24c7(0x14b)](-0x2),_0x49c05e=('0'+(_0x1fafb1[_0x2e24c7(0x10f)]()+0x1))[_0x2e24c7(0x14b)](-0x2),_0x5c184a=_0x1fafb1['getFullYear'](),_0x3b53db=_0x5c184a+'-'+_0x49c05e+'-'+_0x45472d;var _0x2de606=[_0x2e24c7(0xef),_0x2e24c7(0x12c)];const _0x4c4461=await warehouse['aggregate']([{'$match':{'name':_0x50ec89[_0x2e24c7(0x1a2)],'room':_0x50ec89[_0x2e24c7(0x11e)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2e24c7(0x1b6),'name':{'$first':_0x2e24c7(0x108)},'product_stock':{'$first':_0x2e24c7(0x186)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2e24c7(0x1d4)},'type':{'$first':_0x2e24c7(0x102)},'floorlevel':{'$first':_0x2e24c7(0x1e0)},'primary_code':{'$first':_0x2e24c7(0xdb)},'secondary_code':{'$first':_0x2e24c7(0xf4)},'product_code':{'$first':_0x2e24c7(0x15f)},'storage':{'$first':_0x2e24c7(0x190)},'rack':{'$first':_0x2e24c7(0x10c)}}}]),_0x347070=await customer[_0x2e24c7(0x125)]({});let _0x41ed78;if(_0x44cf88['role']==_0x2e24c7(0x119)){const _0x41fb38=await staff[_0x2e24c7(0x127)]({'email':_0x44cf88[_0x2e24c7(0x121)]});_0x41ed78=await warehouse[_0x2e24c7(0x1df)]([{'$match':{'status':_0x2e24c7(0x1db),'name':_0x41fb38[_0x2e24c7(0x174)]}},{'$group':{'_id':_0x2e24c7(0x168),'name':{'$first':_0x2e24c7(0x168)}}}]);}else _0x41ed78=await warehouse['aggregate']([{'$match':{'status':_0x2e24c7(0x1db)}},{'$group':{'_id':_0x2e24c7(0x168),'name':{'$first':_0x2e24c7(0x168)}}}]);const _0x435bb4=await product[_0x2e24c7(0x125)]({});if(_0x2458af[0x0][_0x2e24c7(0x126)]==_0x2e24c7(0x196)){var _0x2d33ad=users[_0x2e24c7(0xfa)];console[_0x2e24c7(0x19a)](_0x2d33ad);}else{if(_0x2458af[0x0][_0x2e24c7(0x126)]==_0x2e24c7(0xe7))var _0x2d33ad=users[_0x2e24c7(0xe7)];else{if(_0x2458af[0x0]['language']==_0x2e24c7(0x167))var _0x2d33ad=users[_0x2e24c7(0x167)];else{if(_0x2458af[0x0]['language']=='Spanish')var _0x2d33ad=users[_0x2e24c7(0x169)];else{if(_0x2458af[0x0][_0x2e24c7(0x126)]=='French')var _0x2d33ad=users[_0x2e24c7(0x1ad)];else{if(_0x2458af[0x0][_0x2e24c7(0x126)]==_0x2e24c7(0x101))var _0x2d33ad=users[_0x2e24c7(0xf8)];else{if(_0x2458af[0x0][_0x2e24c7(0x126)]=='Chinese')var _0x2d33ad=users[_0x2e24c7(0x163)];else{if(_0x2458af[0x0]['language']==_0x2e24c7(0x177))var _0x2d33ad=users['Arabic'];}}}}}}}_0x50f24a[_0x2e24c7(0x16a)]('edit_sales_finished',{'success':_0x519d63[_0x2e24c7(0x1ab)](_0x2e24c7(0x110)),'errors':_0x519d63[_0x2e24c7(0x1ab)]('errors'),'role':_0x44cf88,'profile':_0x4316fb,'customer':_0x347070,'warehouse':_0x41ed78,'product':_0x4c4461,'user':_0x50ec89,'master_shop':_0x2458af,'unit':_0x435bb4,'language':_0x2d33ad,'rooms_data':_0x2de606,'ed_fullDate':_0x3b53db});}catch(_0x362d19){console[_0x2e24c7(0x19a)](_0x362d19);}}),router[a0_0x2ea595(0x13b)]('/view/:id',auth,async(_0x35b107,_0x467925)=>{var _0x24c925=a0_0x2ea595;try{const _0x28232c=_0x35b107[_0x24c925(0x15e)]['id'],_0x1a296e=await sales_finished[_0x24c925(0x127)]({'_id':_0x35b107[_0x24c925(0x15e)]['id']}),_0x117ea0=await warehouse[_0x24c925(0x127)]({'name':_0x1a296e[_0x24c925(0x1a2)],'room':_0x35b107[_0x24c925(0x165)][_0x24c925(0x11e)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x28e0df,customer:_0x56057a,date:_0x2bf05f,warehouse_name:_0x44a2d5,product_name:_0x19e6e0,stock:_0x3ca42b,adjust_qty:_0x291fe5,note:_0x2afbff,room:_0x4a3663,primary_code:_0x149307,secondary_code:_0x134150,prod_code:_0x5dbf99,level:_0x51cd19,isle:_0x53bcc4,pallet:_0x31dc09,expiry_date:_0x423f22}=_0x35b107[_0x24c925(0x165)];if(typeof _0x19e6e0=='string')var _0x4148cf=[_0x35b107[_0x24c925(0x165)][_0x24c925(0x17e)]],_0x3475a8=[_0x35b107[_0x24c925(0x165)][_0x24c925(0x122)]],_0x6159a3=[_0x35b107[_0x24c925(0x165)]['adjust_qty']],_0x5df4ae=[_0x35b107['body'][_0x24c925(0x151)]],_0x2c8795=[_0x35b107[_0x24c925(0x165)]['secondary_code']],_0x605a30=[_0x35b107[_0x24c925(0x165)][_0x24c925(0x1e2)]],_0x5b4017=[_0x35b107[_0x24c925(0x165)][_0x24c925(0x157)]],_0x3c00be=[_0x35b107[_0x24c925(0x165)]['expiry_date']];else var _0x4148cf=[..._0x35b107[_0x24c925(0x165)][_0x24c925(0x17e)]],_0x3475a8=[..._0x35b107[_0x24c925(0x165)]['stock']],_0x6159a3=[..._0x35b107[_0x24c925(0x165)]['adjust_qty']],_0x5df4ae=[..._0x35b107['body'][_0x24c925(0x151)]],_0x2c8795=[..._0x35b107[_0x24c925(0x165)][_0x24c925(0x145)]],_0x605a30=[..._0x35b107[_0x24c925(0x165)]['prod_code']],_0x5b4017=[..._0x35b107[_0x24c925(0x165)][_0x24c925(0x157)]],_0x3c00be=[..._0x35b107[_0x24c925(0x165)][_0x24c925(0x12f)]];const _0x4f41ed=_0x4148cf['map'](_0x3d2b58=>{return _0x3d2b58={'product_name':_0x3d2b58};});_0x3475a8[_0x24c925(0x189)]((_0x19fcf9,_0x4eff60)=>{_0x4f41ed[_0x4eff60]['stock']=_0x19fcf9;}),_0x6159a3[_0x24c925(0x189)]((_0x571cd6,_0x183dd8)=>{var _0x3e13b3=_0x24c925;_0x4f41ed[_0x183dd8][_0x3e13b3(0x130)]=_0x571cd6;}),_0x5df4ae[_0x24c925(0x189)]((_0x154ae3,_0x114890)=>{var _0xf25a8c=_0x24c925;_0x4f41ed[_0x114890][_0xf25a8c(0x151)]=_0x154ae3;}),_0x2c8795[_0x24c925(0x189)]((_0x246bca,_0x5968c0)=>{var _0x176417=_0x24c925;_0x4f41ed[_0x5968c0][_0x176417(0x145)]=_0x246bca;}),_0x605a30[_0x24c925(0x189)]((_0x43f455,_0xee8adb)=>{var _0x123e49=_0x24c925;_0x4f41ed[_0xee8adb][_0x123e49(0x150)]=_0x43f455;}),_0x5b4017[_0x24c925(0x189)]((_0x1cb653,_0x286b02)=>{var _0x5828ab=_0x24c925;_0x4f41ed[_0x286b02][_0x5828ab(0x157)]=_0x1cb653;}),_0x3c00be[_0x24c925(0x189)]((_0x3e8848,_0x12a1fe)=>{var _0x412800=_0x24c925;_0x4f41ed[_0x12a1fe][_0x412800(0x12f)]=_0x3e8848;});var _0x2eec1a=0x0;_0x4f41ed[_0x24c925(0x189)](_0x3543bd=>{var _0x346333=_0x24c925;console[_0x346333(0x19a)](_0x346333(0x140),_0x3543bd),(parseInt(_0x3543bd[_0x346333(0x122)])<parseInt(_0x3543bd[_0x346333(0x130)])||parseInt(_0x3543bd[_0x346333(0x130)])==0x0)&&_0x2eec1a++;});if(_0x2eec1a!=0x0)return _0x35b107['flash']('errors',_0x24c925(0xfd)),_0x467925[_0x24c925(0xe6)](_0x24c925(0x1d0));_0x1a296e['sale_product'][_0x24c925(0x189)](_0x3bae1d=>{var _0x191f4a=_0x24c925;const _0x55653f=_0x117ea0[_0x191f4a(0x10b)][_0x191f4a(0x183)](_0x2df696=>{var _0x59093b=_0x191f4a;_0x2df696[_0x59093b(0x17e)]==_0x3bae1d[_0x59093b(0x17e)]&&_0x2df696[_0x59093b(0x18d)]==_0x3bae1d[_0x59093b(0x18d)]&&(_0x2df696[_0x59093b(0xec)]=parseInt(_0x2df696['product_stock'])+parseInt(_0x3bae1d[_0x59093b(0x130)]));});}),await _0x117ea0[_0x24c925(0x1a3)]();const _0x294a5d=_0x4f41ed[_0x24c925(0xf2)](_0x497857=>_0x497857[_0x24c925(0x130)]!=='0'&&_0x497857['quantity']!=='');_0x1a296e[_0x24c925(0x172)]=_0x28e0df,_0x1a296e[_0x24c925(0x1b2)]=_0x56057a,_0x1a296e[_0x24c925(0x114)]=_0x2bf05f,_0x1a296e[_0x24c925(0x1a2)]=_0x44a2d5,_0x1a296e[_0x24c925(0x1be)]=_0x294a5d,_0x1a296e[_0x24c925(0xe2)]=_0x2afbff,_0x1a296e['room']=_0x4a3663;const _0x4211a6=await _0x1a296e['save'](),_0x485460=await sales_finished[_0x24c925(0x127)]({'_id':_0x35b107[_0x24c925(0x15e)]['id']}),_0x35bf0c=await warehouse[_0x24c925(0x127)]({'name':_0x44a2d5,'room':_0x4a3663,'warehouse_category':'Finished\x20Goods'});_0x485460[_0x24c925(0x1be)][_0x24c925(0x189)](_0x13c766=>{var _0x523145=_0x24c925;const _0x485464=_0x35bf0c[_0x523145(0x10b)][_0x523145(0x183)](_0x340495=>{var _0x3854b8=_0x523145;_0x340495[_0x3854b8(0x17e)]==_0x13c766[_0x3854b8(0x17e)]&&_0x340495['bay']==_0x13c766[_0x3854b8(0x18d)]&&(_0x340495[_0x3854b8(0xec)]=parseInt(_0x340495[_0x3854b8(0xec)])-parseInt(_0x13c766['quantity']));});}),console['log']('final',_0x35bf0c),await _0x35bf0c['save']();const _0x180b31=await c_payment_data['findOne']({'invoice':_0x35b107['body'][_0x24c925(0x172)]});_0x180b31[_0x24c925(0x1d6)]=_0x35b107['body']['suppliers'],await _0x180b31[_0x24c925(0x1a3)](),_0x35b107['flash'](_0x24c925(0x110),_0x24c925(0x13e)),_0x467925['redirect'](_0x24c925(0x17a));}catch(_0x48633d){console['log'](_0x48633d);}}),router['post'](a0_0x2ea595(0x16d),auth,async(_0x33fc33,_0x534481)=>{var _0x41b41c=a0_0x2ea595;try{const _0x5c61b8=_0x33fc33['params']['id'],{invoice:_0x10cc35,customer:_0x92887c,receivable_amount:_0x98dcb9,received_amount:_0x16b496}=_0x33fc33['body'],_0x3b8b0b=await sales[_0x41b41c(0x100)](_0x5c61b8);console[_0x41b41c(0x19a)](_0x3b8b0b);var _0x1c47fa=_0x98dcb9-_0x16b496;console['log'](_0x16b496),_0x3b8b0b[_0x41b41c(0x1aa)]=parseFloat(_0x16b496)+parseFloat(_0x3b8b0b['received_amount']),_0x3b8b0b[_0x41b41c(0xfc)]=_0x1c47fa,console[_0x41b41c(0x19a)](_0x3b8b0b);const _0x48680e=await _0x3b8b0b[_0x41b41c(0x1a3)](),_0x4c13c7=await c_payment_data['findOne']({'invoice':_0x10cc35});_0x4c13c7[_0x41b41c(0xf9)]=_0x1c47fa,await _0x4c13c7[_0x41b41c(0x1a3)]();let _0x1fe63b=new Date(),_0x2a777a=('0'+_0x1fe63b['getDate']())[_0x41b41c(0x14b)](-0x2),_0xde709c=('0'+(_0x1fe63b[_0x41b41c(0x10f)]()+0x1))[_0x41b41c(0x14b)](-0x2),_0x1bf563=_0x1fe63b['getFullYear'](),_0x4f6ba5=_0x1bf563+'-'+_0xde709c+'-'+_0x2a777a;const _0x3ed186=new customer_payment({'invoice':_0x10cc35,'date':_0x1bf563+'-'+_0xde709c+'-'+_0x2a777a,'customer':_0x92887c,'reason':_0x41b41c(0x18e),'amount':_0x16b496}),_0x3406ab=await _0x3ed186[_0x41b41c(0x1a3)]();_0x33fc33[_0x41b41c(0x1ab)]('success',_0x41b41c(0x193)),_0x534481['redirect']('/all_sales/view');}catch(_0x14c07b){console['log'](_0x14c07b);}}),router[a0_0x2ea595(0x138)](a0_0x2ea595(0x162),auth,async(_0x1dfe1c,_0x5d0f19)=>{var _0xda5886=a0_0x2ea595;try{const {username:_0x59bce4,email:_0x32ccbf,role:_0x981189}=_0x1dfe1c['user'],_0x11f2ca=_0x1dfe1c[_0xda5886(0x195)],_0x3084b3=await profile['findOne']({'email':_0x11f2ca['email']}),_0x4a88ab=await master_shop['find']();console[_0xda5886(0x19a)]('master',_0x4a88ab);const _0x31dce1=_0x1dfe1c[_0xda5886(0x15e)]['id'],_0x382340=await sales[_0xda5886(0x100)](_0x31dce1);console[_0xda5886(0x19a)](_0x382340);const _0x2dbe8f=await customer[_0xda5886(0x127)]({'name':_0x382340[_0xda5886(0x1b2)]});console[_0xda5886(0x19a)](_0x2dbe8f);if(_0x4a88ab[0x0][_0xda5886(0x126)]==_0xda5886(0x196)){var _0x76c5e1=users['English'];console[_0xda5886(0x19a)](_0x76c5e1);}else{if(_0x4a88ab[0x0][_0xda5886(0x126)]==_0xda5886(0xe7))var _0x76c5e1=users['Hindi'];else{if(_0x4a88ab[0x0]['language']==_0xda5886(0x167))var _0x76c5e1=users[_0xda5886(0x167)];else{if(_0x4a88ab[0x0][_0xda5886(0x126)]==_0xda5886(0x169))var _0x76c5e1=users[_0xda5886(0x169)];else{if(_0x4a88ab[0x0][_0xda5886(0x126)]==_0xda5886(0x1ad))var _0x76c5e1=users[_0xda5886(0x1ad)];else{if(_0x4a88ab[0x0][_0xda5886(0x126)]==_0xda5886(0x101))var _0x76c5e1=users[_0xda5886(0xf8)];else{if(_0x4a88ab[0x0][_0xda5886(0x126)]=='Chinese')var _0x76c5e1=users[_0xda5886(0x163)];else{if(_0x4a88ab[0x0]['language']=='Arabic\x20(ae)')var _0x76c5e1=users[_0xda5886(0x1d3)];}}}}}}}_0x5d0f19[_0xda5886(0x16a)](_0xda5886(0x142),{'success':_0x1dfe1c[_0xda5886(0x1ab)](_0xda5886(0x110)),'errors':_0x1dfe1c[_0xda5886(0x1ab)]('errors'),'role':_0x11f2ca,'profile':_0x3084b3,'master_shop':_0x4a88ab,'customers':_0x2dbe8f,'sales':_0x382340,'language':_0x76c5e1});}catch(_0x41010f){console['log'](_0x41010f);}}),router[a0_0x2ea595(0x138)](a0_0x2ea595(0x137),auth,async(_0x53ecc1,_0x1ca6c5)=>{var _0x1052b0=a0_0x2ea595;try{const {username:_0x16563a,email:_0x52d118,role:_0x2c5205}=_0x53ecc1[_0x1052b0(0x195)],_0x48df98=_0x53ecc1[_0x1052b0(0x195)],_0x1dd856=await profile[_0x1052b0(0x127)]({'email':_0x48df98[_0x1052b0(0x121)]}),_0x195ce5=await master_shop[_0x1052b0(0x125)](),_0x370696=_0x53ecc1[_0x1052b0(0x15e)]['id'],_0x366f59=await sales_finished[_0x1052b0(0x100)](_0x370696),_0x50aa39=await warehouse[_0x1052b0(0x1df)]([{'$match':{'name':_0x366f59[_0x1052b0(0x1a2)]}},{'$unwind':_0x1052b0(0x170)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1052b0(0x186)},'bay':{'$first':_0x1052b0(0x1c4)},'bin':{'$first':_0x1052b0(0x1d4)},'type':{'$first':_0x1052b0(0x102)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1052b0(0xdb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1052b0(0x15f)},'storage':{'$first':_0x1052b0(0x190)},'rack':{'$first':_0x1052b0(0x10c)},'expiry_date':{'$first':_0x1052b0(0x180)},'production_date':{'$first':_0x1052b0(0x152)},'unit':{'$first':_0x1052b0(0x16f)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0x1052b0(0x14d)},'batch_code':{'$first':_0x1052b0(0x12d)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x457196=await product[_0x1052b0(0x125)]({}),_0x3029a9=await warehouse[_0x1052b0(0x1df)]([{'$match':{'status':_0x1052b0(0x1db),'warehouse_category':_0x1052b0(0x133),'name':{'$ne':_0x1052b0(0x18f),'$ne':_0x1052b0(0x171)}}},{'$group':{'_id':'$name','name':{'$first':_0x1052b0(0x168)}}},{'$sort':{'name':0x1}}]);var _0x2aee96=['Return\x20Rooms'];const _0x4f5fdd=await warehouse[_0x1052b0(0x1df)]([{'$match':{'status':'Enabled','name':'Quality\x20Inspection'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x195ce5[0x0][_0x1052b0(0x126)]=='English\x20(US)'){var _0x55df1d=users[_0x1052b0(0xfa)];console[_0x1052b0(0x19a)](_0x55df1d);}else{if(_0x195ce5[0x0][_0x1052b0(0x126)]==_0x1052b0(0xe7))var _0x55df1d=users[_0x1052b0(0xe7)];else{if(_0x195ce5[0x0][_0x1052b0(0x126)]==_0x1052b0(0x167))var _0x55df1d=users[_0x1052b0(0x167)];else{if(_0x195ce5[0x0][_0x1052b0(0x126)]==_0x1052b0(0x169))var _0x55df1d=users[_0x1052b0(0x169)];else{if(_0x195ce5[0x0][_0x1052b0(0x126)]==_0x1052b0(0x1ad))var _0x55df1d=users[_0x1052b0(0x1ad)];else{if(_0x195ce5[0x0]['language']==_0x1052b0(0x101))var _0x55df1d=users[_0x1052b0(0xf8)];else{if(_0x195ce5[0x0][_0x1052b0(0x126)]==_0x1052b0(0x163))var _0x55df1d=users[_0x1052b0(0x163)];else{if(_0x195ce5[0x0][_0x1052b0(0x126)]==_0x1052b0(0x177))var _0x55df1d=users[_0x1052b0(0x1d3)];}}}}}}}_0x1ca6c5[_0x1052b0(0x16a)](_0x1052b0(0x115),{'success':_0x53ecc1[_0x1052b0(0x1ab)](_0x1052b0(0x110)),'errors':_0x53ecc1[_0x1052b0(0x1ab)](_0x1052b0(0x1bb)),'role':_0x48df98,'profile':_0x1dd856,'user':_0x366f59,'stock':_0x50aa39,'master_shop':_0x195ce5,'unit':_0x457196,'language':_0x55df1d,'warehouses':_0x3029a9,'rooms':_0x2aee96,'warehouse_QA':_0x4f5fdd});}catch(_0x38ca35){console[_0x1052b0(0x19a)](_0x38ca35),_0x1ca6c5['status'](0xc8)[_0x1052b0(0x1c2)]({'message':_0x38ca35[_0x1052b0(0xff)]});}}),router['post'](a0_0x2ea595(0x137),auth,async(_0x50d72d,_0x26fc37)=>{var _0x4156a7=a0_0x2ea595;if(_0x50d72d['body']['for_categorize']=='QA')try{const {invoice:_0x3fe739,date:_0x373a22,warehouse_name:_0x5df431,product_name:_0x30e8e8,primary_code:_0x1666e2,secondary_code:_0x90fe5c,product_code:_0x42bd5e,sales_quantity:_0x2a4ac4,stocks:_0x350341,return_qty:_0x3b90bb,Room_name:_0x4e7b08,to_warehouse_name_QA:_0xb33c47,to_Room_name_QA:_0x3b7e67,note:_0x204a88,for_categorize:_0x17e46f,product_name_QA1:_0x5b7918}=_0x50d72d['body'];if(typeof _0x5b7918==_0x4156a7(0x1b1))var _0x1d1be0=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x18c)]],_0x404c86=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1b5)]],_0x1f1172=[_0x50d72d[_0x4156a7(0x165)]['secondary_code_QA']],_0x3c2dc3=[_0x50d72d['body']['product_code_QA']],_0xa19bfa=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x19b)]],_0x4a0b24=[_0x50d72d['body'][_0x4156a7(0x179)]],_0x37c47d=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0xf0)]],_0x59afc3=[_0x50d72d['body'][_0x4156a7(0x1a4)]],_0x2c8344=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x16e)]],_0xc9fa01=[_0x50d72d['body'][_0x4156a7(0x1ce)]],_0x5b3e72=[_0x50d72d['body'][_0x4156a7(0xf6)]],_0x87b262=[_0x50d72d[_0x4156a7(0x165)]['unit_QA']],_0x565df4=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1c1)]],_0x409b44=[_0x50d72d[_0x4156a7(0x165)]['expiry_date_QA']];else var _0x1d1be0=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x18c)]],_0x404c86=[..._0x50d72d['body'][_0x4156a7(0x1b5)]],_0x1f1172=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x164)]],_0x3c2dc3=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0xe9)]],_0xa19bfa=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x19b)]],_0x4a0b24=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x179)]],_0x37c47d=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0xf0)]],_0x59afc3=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1a4)]],_0x2c8344=[..._0x50d72d[_0x4156a7(0x165)]['maxProducts_QA']],_0xc9fa01=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1ce)]],_0x5b3e72=[..._0x50d72d['body'][_0x4156a7(0xf6)]],_0x87b262=[..._0x50d72d['body'][_0x4156a7(0xeb)]],_0x565df4=[..._0x50d72d['body'][_0x4156a7(0x1c1)]],_0x409b44=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1e1)]];const _0x3d6135=_0x1d1be0[_0x4156a7(0x183)](_0x445ffe=>{return _0x445ffe={'product_name':_0x445ffe};});_0x404c86[_0x4156a7(0x189)]((_0x2edd5c,_0x908761)=>{var _0x40bea1=_0x4156a7;_0x3d6135[_0x908761][_0x40bea1(0x151)]=_0x2edd5c;}),_0x1f1172[_0x4156a7(0x189)]((_0x1da74c,_0x16404f)=>{var _0x593d14=_0x4156a7;_0x3d6135[_0x16404f][_0x593d14(0x145)]=_0x1da74c;}),_0x3c2dc3[_0x4156a7(0x189)]((_0x37974f,_0x3b4930)=>{var _0x4cecff=_0x4156a7;_0x3d6135[_0x3b4930][_0x4cecff(0x150)]=_0x37974f;}),_0xa19bfa[_0x4156a7(0x189)]((_0x3109f2,_0x4c7b71)=>{_0x3d6135[_0x4c7b71]['sale_qty']=_0x3109f2;}),_0x4a0b24[_0x4156a7(0x189)]((_0x14dab8,_0x39f8cc)=>{_0x3d6135[_0x39f8cc]['stock']=_0x14dab8;}),_0x37c47d['forEach']((_0x31b8bd,_0x571208)=>{var _0x75b68=_0x4156a7;_0x3d6135[_0x571208][_0x75b68(0x19c)]=_0x31b8bd;}),_0x59afc3[_0x4156a7(0x189)]((_0x54bc7d,_0x24340d)=>{_0x3d6135[_0x24340d]['maxPerUnit']=_0x54bc7d;}),_0x2c8344[_0x4156a7(0x189)]((_0x3afa13,_0x13cba3)=>{var _0xc5dce7=_0x4156a7;_0x3d6135[_0x13cba3][_0xc5dce7(0x1c9)]=_0x3afa13;}),_0xc9fa01[_0x4156a7(0x189)]((_0x2bf8ca,_0x26256b)=>{var _0x3032a2=_0x4156a7;_0x3d6135[_0x26256b][_0x3032a2(0x1c7)]=_0x2bf8ca;}),_0x5b3e72[_0x4156a7(0x189)]((_0x58cc90,_0x106c67)=>{var _0x1115c1=_0x4156a7;_0x3d6135[_0x106c67][_0x1115c1(0x181)]=_0x58cc90;}),_0x87b262[_0x4156a7(0x189)]((_0x59c269,_0x4e3df4)=>{var _0x388b89=_0x4156a7;_0x3d6135[_0x4e3df4][_0x388b89(0x1b8)]=_0x59c269;}),_0x565df4[_0x4156a7(0x189)]((_0x136810,_0x54b85f)=>{var _0x24cd2c=_0x4156a7;_0x3d6135[_0x54b85f][_0x24cd2c(0x117)]=_0x136810;}),_0x409b44[_0x4156a7(0x189)]((_0x189b9f,_0x529a95)=>{var _0x227eac=_0x4156a7;_0x3d6135[_0x529a95][_0x227eac(0x12f)]=_0x189b9f;});const _0x4d82d7=await sales_finished[_0x4156a7(0x127)]({'invoice':_0x3fe739});_0x4d82d7[_0x4156a7(0x113)]='True';const _0x20fc7d=await _0x4d82d7['save'](),_0x1b216d=new sales_return_finished({'invoice':_0x3fe739,'customer':_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1b2)],'date':_0x373a22,'warehouse_name':_0x5df431,'room':_0x4e7b08,'ToWarehouse':_0xb33c47,'ToRoom':_0x3b7e67,'return_sale_QA':_0x3d6135,'note':_0x204a88,'warehouse_cat':_0x17e46f}),_0x1e66fc=await _0x1b216d[_0x4156a7(0x1a3)](),_0x18d07f=await sales_return_finished[_0x4156a7(0x127)]({'invoice':_0x3fe739}),_0x25dda3=await warehouse['findOne']({'name':_0xb33c47,'room':_0x3b7e67});_0x18d07f['return_sale_QA']['forEach'](_0xa7df5e=>{var _0x1bcdb6=_0x4156a7,_0x466f0f=0x0;const _0x4b7262=_0x25dda3[_0x1bcdb6(0x10b)][_0x1bcdb6(0x183)](_0x229b14=>{var _0x25a826=_0x1bcdb6;_0x229b14[_0x25a826(0x17e)]==_0xa7df5e['product_name']&&_0x229b14[_0x25a826(0x12f)]==_0xa7df5e['expiry_date']&&_0x229b14[_0x25a826(0x117)]==_0xa7df5e[_0x25a826(0x117)]&&_0x229b14[_0x25a826(0x1c7)]==_0xa7df5e[_0x25a826(0x1c7)]&&(_0x229b14['product_stock']=parseInt(_0x229b14['product_stock'])+parseInt(_0xa7df5e[_0x25a826(0x19c)]),_0x466f0f++);});_0x466f0f=='0'&&(_0x25dda3[_0x1bcdb6(0x10b)]=_0x25dda3[_0x1bcdb6(0x10b)]['concat']({'product_name':_0xa7df5e['product_name'],'product_stock':_0xa7df5e[_0x1bcdb6(0x19c)],'primary_code':_0xa7df5e['primary_code'],'secondary_code':_0xa7df5e[_0x1bcdb6(0x145)],'product_code':_0xa7df5e[_0x1bcdb6(0x150)],'batch_code':_0xa7df5e[_0x1bcdb6(0x1c7)],'maxPerUnit':_0xa7df5e[_0x1bcdb6(0x112)],'production_date':_0xa7df5e['production_date'],'expiry_date':_0xa7df5e[_0x1bcdb6(0x12f)],'secondary_unit':_0xa7df5e['secondary_unit'],'unit':_0xa7df5e[_0x1bcdb6(0x1b8)],'maxProducts':_0xa7df5e['maxProducts'],'bay':_0xa7df5e['bay']}));}),await _0x25dda3[_0x4156a7(0x1a3)]();const _0x265082=new c_payment_data({'invoice':_0x3fe739,'customer':_0x50d72d['body'][_0x4156a7(0x1b2)],'reason':_0x4156a7(0x1cf)});await _0x265082['save']();const _0x5932a1=await master_shop['find'](),_0x35668c=await email_settings[_0x4156a7(0x127)](),_0x1a700e=await customer[_0x4156a7(0x127)]({'name':_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1b2)]});_0x5932a1[0x0][_0x4156a7(0xe8)]==0x1?(right_currency=_0x5932a1[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5932a1[0x0][_0x4156a7(0xd6)]);var _0x4f03e1=_0x1d1be0,_0x49193e=_0x37c47d,_0x2750c9='',_0x342e0b;for(_0x342e0b in _0x4f03e1){_0x2750c9+='<tr>'+_0x4156a7(0x139)+_0x4f03e1[_0x342e0b]+'</td>'+_0x4156a7(0x139)+_0x49193e[_0x342e0b]+_0x4156a7(0x12b)+_0x4156a7(0x1de);}console['log'](_0x4156a7(0x1cd),_0x2750c9);let _0x20f3e5=nodemailer[_0x4156a7(0x103)]({'service':_0x4156a7(0x1bf),'auth':{'user':_0x35668c[_0x4156a7(0x121)],'pass':_0x35668c[_0x4156a7(0x1ae)]}}),_0x30c554={'from':_0x35668c['email'],'to':_0x1a700e['email'],'subject':_0x4156a7(0xd7),'attachments':[{'filename':_0x4156a7(0x1bd),'path':__dirname+'/../public'+_0x4156a7(0x1e4)+_0x5932a1[0x0][_0x4156a7(0x131)],'cid':_0x4156a7(0x159)}],'html':_0x4156a7(0x11b)+_0x4156a7(0x10a)+_0x4156a7(0x1b3)+_0x4156a7(0xdf)+_0x4156a7(0x192)+_0x4156a7(0xdf)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4156a7(0x1a1)+_0x4156a7(0xdf)+_0x4156a7(0xe4)+_0x5932a1[0x0][_0x4156a7(0x173)]+_0x4156a7(0x198)+_0x4156a7(0x1a1)+_0x4156a7(0x1a1)+_0x4156a7(0x14f)+_0x4156a7(0xdf)+_0x4156a7(0x1c6)+'\x20Order\x20Number\x20:\x20'+_0x3fe739+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x4156a7(0x104)+_0x373a22+'\x20'+'</span>'+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4156a7(0x143)+_0x4156a7(0x19f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x4156a7(0x13a)+_0x4156a7(0x1de)+_0x4156a7(0xda)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2750c9+'\x20'+_0x4156a7(0x17c)+_0x4156a7(0x1cb)+_0x4156a7(0xdf)+_0x4156a7(0xd8)+_0x4156a7(0xf1)+_0x5932a1[0x0][_0x4156a7(0x173)]+_0x4156a7(0x129)+_0x4156a7(0x1a1)+'</div>'+'</body></html>'};_0x20f3e5[_0x4156a7(0xdd)](_0x30c554,function(_0x5b4947,_0x2e698e){var _0x456e51=_0x4156a7;_0x5b4947?(console[_0x456e51(0x19a)](_0x5b4947),console[_0x456e51(0x19a)](_0x456e51(0xde))):console[_0x456e51(0x19a)](_0x456e51(0x1c3));}),_0x50d72d[_0x4156a7(0x1ab)](_0x4156a7(0x110),_0x4156a7(0xf3)),_0x26fc37[_0x4156a7(0xe6)]('/all_sales_finished/view');}catch(_0x18ad76){_0x26fc37[_0x4156a7(0x146)](0xc8)['json']({'message1':_0x18ad76[_0x4156a7(0xff)]});}else{if(_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x166)]=='GS')try{const {invoice:_0x4c974c,date:_0x244044,warehouse_name:_0x15ec51,product_name:_0x2e5cb2,primary_code:_0x1d1f53,secondary_code:_0x8d9847,product_code:_0x391aab,sales_quantity:_0x2fa980,stocks:_0x31d5d3,return_qty:_0x189dc2,Room_name:_0x68ce71,to_warehouse_name:_0x118032,to_Room_name:_0x1fa9eb,note:_0x4bae38,level:_0x39976f,isle:_0x871ea6,pallet:_0xad0113,for_categorize:_0x570ddb}=_0x50d72d[_0x4156a7(0x165)];if(typeof _0x2e5cb2=='string')var _0x1d1be0=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x17e)]],_0x404c86=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x151)]],_0x1f1172=[_0x50d72d['body'][_0x4156a7(0x145)]],_0x3c2dc3=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x150)]],_0xa19bfa=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0xf5)]],_0x37c47d=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x19c)]],_0x47ef58=[_0x50d72d[_0x4156a7(0x165)]['bay']],_0x59afc3=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x112)]],_0x2c8344=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1c9)]],_0xc9fa01=[_0x50d72d[_0x4156a7(0x165)]['batch_code']],_0x5b3e72=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x181)]],_0x87b262=[_0x50d72d['body'][_0x4156a7(0x1b8)]],_0x565df4=[_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x117)]],_0x409b44=[_0x50d72d[_0x4156a7(0x165)]['expiry_date']];else var _0x1d1be0=[..._0x50d72d['body'][_0x4156a7(0x17e)]],_0x404c86=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x151)]],_0x1f1172=[..._0x50d72d['body']['secondary_code']],_0x3c2dc3=[..._0x50d72d[_0x4156a7(0x165)]['product_code']],_0xa19bfa=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0xf5)]],_0x37c47d=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x19c)]],_0x47ef58=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x18d)]],_0x59afc3=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x112)]],_0x2c8344=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1c9)]],_0xc9fa01=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1c7)]],_0x5b3e72=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x181)]],_0x87b262=[..._0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1b8)]],_0x565df4=[..._0x50d72d[_0x4156a7(0x165)]['production_date']],_0x409b44=[..._0x50d72d[_0x4156a7(0x165)]['expiry_date']];const _0x82e9e1=_0x1d1be0[_0x4156a7(0x183)](_0x3d2c52=>{return _0x3d2c52={'product_name':_0x3d2c52};});_0x404c86[_0x4156a7(0x189)]((_0x3ba21a,_0x40dd5f)=>{var _0x5dc3bc=_0x4156a7;_0x82e9e1[_0x40dd5f][_0x5dc3bc(0x151)]=_0x3ba21a;}),_0x1f1172[_0x4156a7(0x189)]((_0x312b4e,_0x5b73fc)=>{var _0x50057c=_0x4156a7;_0x82e9e1[_0x5b73fc][_0x50057c(0x145)]=_0x312b4e;}),_0x3c2dc3['forEach']((_0x2b6fdf,_0x2a08a7)=>{_0x82e9e1[_0x2a08a7]['product_code']=_0x2b6fdf;}),_0xa19bfa['forEach']((_0x1e28a2,_0x4284a0)=>{var _0x29b5e2=_0x4156a7;_0x82e9e1[_0x4284a0][_0x29b5e2(0x11f)]=_0x1e28a2;}),_0x37c47d['forEach']((_0x23d45c,_0x36f65b)=>{var _0x4a9c5e=_0x4156a7;_0x82e9e1[_0x36f65b][_0x4a9c5e(0x19c)]=_0x23d45c;}),_0x47ef58['forEach']((_0x2b98a2,_0x3c9082)=>{_0x82e9e1[_0x3c9082]['bay']=_0x2b98a2;}),_0x59afc3[_0x4156a7(0x189)]((_0x32efd7,_0xbe8795)=>{_0x82e9e1[_0xbe8795]['maxPerUnit']=_0x32efd7;}),_0x2c8344['forEach']((_0x920220,_0x53489e)=>{var _0x32e15e=_0x4156a7;_0x82e9e1[_0x53489e][_0x32e15e(0x1c9)]=_0x920220;}),_0xc9fa01[_0x4156a7(0x189)]((_0x5420db,_0x251437)=>{_0x82e9e1[_0x251437]['batch_code']=_0x5420db;}),_0x5b3e72[_0x4156a7(0x189)]((_0x48d496,_0x5c5445)=>{var _0x453a91=_0x4156a7;_0x82e9e1[_0x5c5445][_0x453a91(0x181)]=_0x48d496;}),_0x87b262[_0x4156a7(0x189)]((_0x3e8a64,_0x4803c4)=>{var _0x2336f9=_0x4156a7;_0x82e9e1[_0x4803c4][_0x2336f9(0x1b8)]=_0x3e8a64;}),_0x565df4['forEach']((_0x5c2c9b,_0x4d38d9)=>{var _0x57f8d0=_0x4156a7;_0x82e9e1[_0x4d38d9][_0x57f8d0(0x117)]=_0x5c2c9b;}),_0x409b44[_0x4156a7(0x189)]((_0x4121d2,_0x41dcc4)=>{_0x82e9e1[_0x41dcc4]['expiry_date']=_0x4121d2;});var _0x221aee=0x0;_0x82e9e1[_0x4156a7(0x189)](_0xd60e8=>{var _0x5e8bb2=_0x4156a7;(parseInt(_0xd60e8[_0x5e8bb2(0x11f)])<parseInt(_0xd60e8[_0x5e8bb2(0x19c)])||parseInt(_0xd60e8[_0x5e8bb2(0x122)])<parseInt(_0xd60e8[_0x5e8bb2(0x19c)])&&parseInt(_0xd60e8[_0x5e8bb2(0x11f)])>parseInt(_0xd60e8[_0x5e8bb2(0x19c)])||parseInt(_0xd60e8['return_qty'])==0x0)&&_0x221aee++;});if(_0x221aee!=0x0)return _0x50d72d[_0x4156a7(0x1ab)]('errors',_0x4156a7(0x118)),_0x26fc37[_0x4156a7(0xe6)](_0x4156a7(0x1d0));const _0x1f54ce=await sales_finished[_0x4156a7(0x127)]({'invoice':_0x4c974c});_0x1f54ce[_0x4156a7(0x113)]=_0x4156a7(0x1a5);const _0x2273ff=await _0x1f54ce[_0x4156a7(0x1a3)](),_0x2075ff=new sales_return_finished({'invoice':_0x4c974c,'customer':_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1b2)],'date':_0x244044,'warehouse_name':_0x15ec51,'room':_0x68ce71,'ToWarehouse':_0x118032,'ToRoom':_0x1fa9eb,'return_sale':_0x82e9e1,'note':_0x4bae38,'warehouse_cat':_0x570ddb}),_0x3d8cc4=await _0x2075ff[_0x4156a7(0x1a3)](),_0x7a648b=await sales_return_finished['findOne']({'invoice':_0x4c974c}),_0x3aad3d=await warehouse['findOne']({'name':_0x118032,'room':_0x1fa9eb,'warehouse_category':_0x4156a7(0x133)});_0x7a648b[_0x4156a7(0x1d2)][_0x4156a7(0x189)](_0x108440=>{var _0x472c56=_0x4156a7,_0x3a6484=0x0;const _0x266873=_0x3aad3d[_0x472c56(0x10b)][_0x472c56(0x183)](_0x5bd437=>{var _0x17d8b2=_0x472c56;_0x5bd437['product_name']==_0x108440[_0x17d8b2(0x17e)]&&_0x5bd437[_0x17d8b2(0x18d)]==_0x108440[_0x17d8b2(0x18d)]&&_0x5bd437['expiry_date']==_0x108440[_0x17d8b2(0x12f)]&&_0x5bd437['production_date']==_0x108440[_0x17d8b2(0x117)]&&_0x5bd437[_0x17d8b2(0x1c7)]==_0x108440[_0x17d8b2(0x1c7)]&&(_0x5bd437[_0x17d8b2(0xec)]=parseInt(_0x5bd437['product_stock'])+parseInt(_0x108440[_0x17d8b2(0x19c)]),_0x3a6484++);});_0x3a6484=='0'&&(_0x3aad3d[_0x472c56(0x10b)]=_0x3aad3d[_0x472c56(0x10b)][_0x472c56(0x11a)]({'product_name':_0x108440[_0x472c56(0x17e)],'product_stock':_0x108440[_0x472c56(0x19c)],'primary_code':_0x108440[_0x472c56(0x151)],'secondary_code':_0x108440[_0x472c56(0x145)],'product_code':_0x108440['product_code'],'bay':_0x108440[_0x472c56(0x18d)],'batch_code':_0x108440['batch_code'],'maxPerUnit':_0x108440['maxPerUnit'],'production_date':_0x108440['production_date'],'expiry_date':_0x108440['expiry_date'],'secondary_unit':_0x108440[_0x472c56(0x181)],'unit':_0x108440['unit'],'maxProducts':_0x108440[_0x472c56(0x1c9)]}));}),await _0x3aad3d['save'](),console['log'](_0x50d72d[_0x4156a7(0x165)]);const _0x12c9ea=new c_payment_data({'invoice':_0x4c974c,'customer':_0x50d72d[_0x4156a7(0x165)]['customer'],'reason':'Sale\x20Return'});await _0x12c9ea[_0x4156a7(0x1a3)]();const _0x30f478=await master_shop[_0x4156a7(0x125)]();console[_0x4156a7(0x19a)]('add\x20post',_0x30f478[0x0][_0x4156a7(0x131)]);const _0x4daf2e=await email_settings[_0x4156a7(0x127)](),_0x551248=await customer[_0x4156a7(0x127)]({'name':_0x50d72d[_0x4156a7(0x165)][_0x4156a7(0x1b2)]});console[_0x4156a7(0x19a)]('customer_data',_0x551248);_0x30f478[0x0]['currency_placement']==0x1?(right_currency=_0x30f478[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x30f478[0x0][_0x4156a7(0xd6)]);var _0x4f03e1=_0x1d1be0,_0x49193e=_0x37c47d,_0x2750c9='',_0x342e0b;for(_0x342e0b in _0x4f03e1){_0x2750c9+=_0x4156a7(0x19f)+_0x4156a7(0x139)+_0x4f03e1[_0x342e0b]+_0x4156a7(0x12b)+_0x4156a7(0x139)+_0x49193e[_0x342e0b]+_0x4156a7(0x12b)+'</tr>';}console[_0x4156a7(0x19a)]('product_list',_0x2750c9);let _0x50d2c2=nodemailer[_0x4156a7(0x103)]({'service':'gmail','auth':{'user':_0x4daf2e[_0x4156a7(0x121)],'pass':_0x4daf2e[_0x4156a7(0x1ae)]}}),_0x399ecf={'from':_0x4daf2e[_0x4156a7(0x121)],'to':_0x551248[_0x4156a7(0x121)],'subject':_0x4156a7(0xd7),'attachments':[{'filename':'Logo.png','path':__dirname+_0x4156a7(0x13f)+_0x4156a7(0x1e4)+_0x30f478[0x0][_0x4156a7(0x131)],'cid':_0x4156a7(0x159)}],'html':_0x4156a7(0x11b)+_0x4156a7(0x10a)+_0x4156a7(0x1b3)+_0x4156a7(0xdf)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4156a7(0x1a1)+_0x4156a7(0xdf)+_0x4156a7(0xe4)+_0x30f478[0x0][_0x4156a7(0x173)]+_0x4156a7(0x198)+_0x4156a7(0x1a1)+_0x4156a7(0x1a1)+'<hr\x20class=\x22my-3\x22>'+_0x4156a7(0xdf)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4156a7(0x1e3)+_0x4c974c+'\x20'+_0x4156a7(0x176)+_0x4156a7(0x104)+_0x244044+'\x20'+'</span>'+'</h5>'+'</div>'+_0x4156a7(0x1c0)+_0x4156a7(0x143)+'<tr>'+_0x4156a7(0x12e)+_0x4156a7(0x1d5)+_0x4156a7(0x15a)+_0x4156a7(0x13a)+_0x4156a7(0x1de)+_0x4156a7(0xda)+_0x4156a7(0x19e)+'\x20'+_0x2750c9+'\x20'+'</tbody>'+_0x4156a7(0x1cb)+_0x4156a7(0xdf)+_0x4156a7(0xd8)+_0x4156a7(0xf1)+_0x30f478[0x0][_0x4156a7(0x173)]+_0x4156a7(0x129)+_0x4156a7(0x1a1)+_0x4156a7(0x1a1)+_0x4156a7(0xe1)};_0x50d2c2['sendMail'](_0x399ecf,function(_0x4108b4,_0xad9fee){var _0x801abd=_0x4156a7;_0x4108b4?(console[_0x801abd(0x19a)](_0x4108b4),console[_0x801abd(0x19a)](_0x801abd(0xde))):console[_0x801abd(0x19a)](_0x801abd(0x1c3));}),_0x50d72d[_0x4156a7(0x1ab)]('success','sales\x20item\x20return\x20successfull'),_0x26fc37['redirect']('/all_sales_finished/view');}catch(_0x237dd3){console[_0x4156a7(0x19a)](_0x237dd3),_0x26fc37['status'](0xc8)['json']({'message1':_0x237dd3['message']});}}}),router['get']('/barcode/:id',auth,async(_0x3699e7,_0x46aa2e)=>{var _0x57c8f5=a0_0x2ea595;try{const {username:_0x290256,email:_0x2fe028,role:_0x2f4e95}=_0x3699e7[_0x57c8f5(0x195)],_0x1769e9=_0x3699e7[_0x57c8f5(0x195)],_0x5ec476=await profile[_0x57c8f5(0x127)]({'email':_0x1769e9['email']}),_0x5215ce=await master_shop[_0x57c8f5(0x125)]();console['log']('barcode\x20Product\x20master',_0x5215ce);const _0x393929=_0x3699e7[_0x57c8f5(0x15e)]['id'],_0x4ce587=await sales[_0x57c8f5(0x100)](_0x393929);console['log'](_0x57c8f5(0x188),_0x4ce587);if(_0x5215ce[0x0]['language']==_0x57c8f5(0x196))var _0xfc8db5=users[_0x57c8f5(0xfa)];else{if(_0x5215ce[0x0]['language']==_0x57c8f5(0xe7))var _0xfc8db5=users[_0x57c8f5(0xe7)];else{if(_0x5215ce[0x0][_0x57c8f5(0x126)]==_0x57c8f5(0x167))var _0xfc8db5=users['German'];else{if(_0x5215ce[0x0][_0x57c8f5(0x126)]=='Spanish')var _0xfc8db5=users[_0x57c8f5(0x169)];else{if(_0x5215ce[0x0]['language']==_0x57c8f5(0x1ad))var _0xfc8db5=users[_0x57c8f5(0x1ad)];else{if(_0x5215ce[0x0]['language']=='Portuguese\x20(BR)')var _0xfc8db5=users[_0x57c8f5(0xf8)];else{if(_0x5215ce[0x0]['language']=='Chinese')var _0xfc8db5=users[_0x57c8f5(0x163)];else{if(_0x5215ce[0x0]['language']==_0x57c8f5(0x177))var _0xfc8db5=users['Arabic'];}}}}}}}_0x46aa2e[_0x57c8f5(0x16a)](_0x57c8f5(0x15c),{'success':_0x3699e7[_0x57c8f5(0x1ab)](_0x57c8f5(0x110)),'errors':_0x3699e7[_0x57c8f5(0x1ab)](_0x57c8f5(0x1bb)),'role':_0x1769e9,'profile':_0x5ec476,'alldata':_0x4ce587,'master_shop':_0x5215ce,'language':_0xfc8db5});}catch(_0x2b60ee){console['log'](_0x2b60ee);}}),router[a0_0x2ea595(0x13b)](a0_0x2ea595(0x1a6),async(_0x2fa0bf,_0x4e20cc)=>{var _0x472801=a0_0x2ea595;const {product_code:_0x579a6f,warehouse_name:_0x1c897f,rooms_data:_0x440bde,Roomslist:_0x56f8f9}=_0x2fa0bf[_0x472801(0x165)],_0x461da3=_0x56f8f9['split'](','),_0x3a0a67=[];async function _0xc1f195(_0x31a5aa){var _0x1e3f6c=_0x472801;const _0x51f8e7=await warehouse[_0x1e3f6c(0x1df)]([{'$match':{'name':_0x1c897f,'room':_0x31a5aa}},{'$unwind':_0x1e3f6c(0x170)},{'$match':{'product_details.primary_code':_0x579a6f}},{'$group':{'_id':_0x1e3f6c(0x1b6),'name':{'$first':_0x1e3f6c(0x108)},'product_stock':{'$first':_0x1e3f6c(0x186)},'primary_code':{'$first':_0x1e3f6c(0xdb)},'secondary_code':{'$first':_0x1e3f6c(0xf4)},'product_code':{'$first':_0x1e3f6c(0x15f)},'level':{'$first':_0x1e3f6c(0x1c4)},'isle':{'$first':_0x1e3f6c(0x1d4)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1e3f6c(0x16f)},'secondary_unit':{'$first':_0x1e3f6c(0x184)},'storage':{'$first':_0x1e3f6c(0x190)},'rack':{'$first':_0x1e3f6c(0x10c)},'expiry_date':{'$first':_0x1e3f6c(0x180)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x1e3f6c(0x1b7)},'batch_code':{'$first':_0x1e3f6c(0x12d)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1e3f6c(0x10d)}}}]),_0x330549=await warehouse[_0x1e3f6c(0x1df)]([{'$match':{'name':_0x1c897f,'room':_0x31a5aa}},{'$unwind':_0x1e3f6c(0x170)},{'$match':{'product_details.secondary_code':_0x579a6f}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1e3f6c(0x108)},'product_stock':{'$first':_0x1e3f6c(0x186)},'primary_code':{'$first':_0x1e3f6c(0xdb)},'secondary_code':{'$first':_0x1e3f6c(0xf4)},'product_code':{'$first':_0x1e3f6c(0x15f)},'level':{'$first':_0x1e3f6c(0x1c4)},'isle':{'$first':_0x1e3f6c(0x1d4)},'type':{'$first':_0x1e3f6c(0x102)},'pallet':{'$first':_0x1e3f6c(0x1e0)},'unit':{'$first':_0x1e3f6c(0x16f)},'secondary_unit':{'$first':_0x1e3f6c(0x184)},'storage':{'$first':_0x1e3f6c(0x190)},'rack':{'$first':_0x1e3f6c(0x10c)},'expiry_date':{'$first':_0x1e3f6c(0x180)},'production_date':{'$first':_0x1e3f6c(0x152)},'maxPerUnit':{'$first':_0x1e3f6c(0x1b7)},'batch_code':{'$first':_0x1e3f6c(0x12d)},'product_cat':{'$first':_0x1e3f6c(0x155)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1e3f6c(0x124)},'invoice':{'$first':_0x1e3f6c(0x10d)}}}]);if(_0x51f8e7[_0x1e3f6c(0x144)]>0x0)_0x3a0a67['push'](_0x51f8e7);else _0x330549['length']>0x0&&_0x3a0a67[_0x1e3f6c(0x156)](_0x330549);}const _0x4ea3a3=_0x461da3['map'](_0x37ec92=>_0xc1f195(_0x37ec92));await Promise[_0x472801(0x1a0)](_0x4ea3a3),_0x4e20cc[_0x472801(0x1c2)](_0x3a0a67);}),module[a0_0x2ea595(0x123)]=router;