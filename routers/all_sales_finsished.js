var a0_0x5c8559=a0_0x3190;(function(_0x340f65,_0x2b8196){var _0xe7fba8=a0_0x3190,_0x7686cd=_0x340f65();while(!![]){try{var _0x51ddab=parseInt(_0xe7fba8(0x240))/0x1*(-parseInt(_0xe7fba8(0x1fc))/0x2)+-parseInt(_0xe7fba8(0x18a))/0x3*(-parseInt(_0xe7fba8(0x16d))/0x4)+parseInt(_0xe7fba8(0x17d))/0x5+-parseInt(_0xe7fba8(0x1b0))/0x6+parseInt(_0xe7fba8(0x1bc))/0x7+-parseInt(_0xe7fba8(0x19d))/0x8*(-parseInt(_0xe7fba8(0x18e))/0x9)+-parseInt(_0xe7fba8(0x242))/0xa;if(_0x51ddab===_0x2b8196)break;else _0x7686cd['push'](_0x7686cd['shift']());}catch(_0x241674){_0x7686cd['push'](_0x7686cd['shift']());}}}(a0_0x1e1f,0x82e5b));const express=require(a0_0x5c8559(0x1d0)),app=express(),router=express[a0_0x5c8559(0x191)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x5c8559(0x203)),nodemailer=require(a0_0x5c8559(0x1b9)),users=require(a0_0x5c8559(0x24c));function a0_0x3190(_0x8cb29f,_0x20d363){var _0x1e1fd4=a0_0x1e1f();return a0_0x3190=function(_0x319000,_0x519104){_0x319000=_0x319000-0x154;var _0x805c16=_0x1e1fd4[_0x319000];return _0x805c16;},a0_0x3190(_0x8cb29f,_0x20d363);}router[a0_0x5c8559(0x1e8)](a0_0x5c8559(0x185),auth,async(_0x432f85,_0x2fc378)=>{var _0x340539=a0_0x5c8559;try{const {username:_0xfb7c24,email:_0x487360,role:_0x57f013}=_0x432f85[_0x340539(0x1c6)],_0x5adf97=_0x432f85[_0x340539(0x1c6)],_0x291d44=await profile['findOne']({'email':_0x5adf97[_0x340539(0x1ea)]}),_0x2e6e18=await master_shop[_0x340539(0x1e7)]();let _0x522392;if(_0x5adf97[_0x340539(0x241)]==_0x340539(0x1ed)){const _0x3ea1d8=await staff[_0x340539(0x17a)]({'email':_0x5adf97[_0x340539(0x1ea)]});_0x522392=await sales_finished[_0x340539(0x15d)]([{'$lookup':{'from':_0x340539(0x1fa),'localField':'customer','foreignField':'name','as':'customers_docs'}},{'$unwind':_0x340539(0x1d7)},{'$unwind':_0x340539(0x227)},{'$group':{'_id':_0x340539(0x24e),'invoice':{'$first':_0x340539(0x1da)},'customers':{'$first':_0x340539(0x158)},'date':{'$first':_0x340539(0x1b5)},'warehouse_name':{'$first':_0x340539(0x1db)},'sale_product':{'$push':_0x340539(0x227)},'note':{'$first':'$note'},'return_data':{'$first':_0x340539(0x179)},'customers_docs':{'$first':_0x340539(0x1d7)},'total_saleproduct_quantity':{'$sum':_0x340539(0x1df)},'level':{'$addToSet':_0x340539(0x1e9)},'isle':{'$addToSet':_0x340539(0x216)},'type':{'$addToSet':_0x340539(0x165)},'pallet':{'$addToSet':_0x340539(0x262)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x522392=await sales_finished['aggregate']([{'$lookup':{'from':_0x340539(0x1fa),'localField':_0x340539(0x1a6),'foreignField':'name','as':_0x340539(0x223)}},{'$unwind':'$customers_docs'},{'$unwind':_0x340539(0x227)},{'$group':{'_id':'$_id','invoice':{'$first':_0x340539(0x1da)},'customers':{'$first':_0x340539(0x158)},'date':{'$first':_0x340539(0x1b5)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x340539(0x227)},'note':{'$first':_0x340539(0x1cb)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x340539(0x1df)},'level':{'$addToSet':_0x340539(0x1e9)},'isle':{'$addToSet':_0x340539(0x216)},'type':{'$addToSet':_0x340539(0x165)},'pallet':{'$addToSet':_0x340539(0x262)},'finalize':{'$first':_0x340539(0x198)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x2e6e18[0x0][_0x340539(0x1ab)]==_0x340539(0x183)){var _0x50c97d=users[_0x340539(0x1f5)];console[_0x340539(0x1d2)](_0x50c97d);}else{if(_0x2e6e18[0x0][_0x340539(0x1ab)]==_0x340539(0x1d5))var _0x50c97d=users[_0x340539(0x1d5)];else{if(_0x2e6e18[0x0][_0x340539(0x1ab)]==_0x340539(0x219))var _0x50c97d=users[_0x340539(0x219)];else{if(_0x2e6e18[0x0][_0x340539(0x1ab)]==_0x340539(0x244))var _0x50c97d=users['Spanish'];else{if(_0x2e6e18[0x0][_0x340539(0x1ab)]==_0x340539(0x181))var _0x50c97d=users[_0x340539(0x181)];else{if(_0x2e6e18[0x0][_0x340539(0x1ab)]==_0x340539(0x1a8))var _0x50c97d=users[_0x340539(0x19e)];else{if(_0x2e6e18[0x0][_0x340539(0x1ab)]==_0x340539(0x19a))var _0x50c97d=users[_0x340539(0x19a)];else{if(_0x2e6e18[0x0][_0x340539(0x1ab)]==_0x340539(0x1b6))var _0x50c97d=users[_0x340539(0x197)];}}}}}}}_0x2fc378[_0x340539(0x209)](_0x340539(0x253),{'success':_0x432f85[_0x340539(0x1dc)]('success'),'errors':_0x432f85['flash'](_0x340539(0x16b)),'sales':_0x522392,'profile':_0x291d44,'role':_0x5adf97,'master_shop':_0x2e6e18,'language':_0x50c97d});}catch(_0x58d07e){console['log'](_0x58d07e);}});async function getRandom8DigitNumber(){var _0x149e11=a0_0x5c8559;const _0xa410b4=0x989680,_0x31e174=0x5f5e0ff,_0x47673f=Math[_0x149e11(0x1a2)](Math[_0x149e11(0x1b1)]()*(_0x31e174-_0xa410b4+0x1))+_0xa410b4;var _0x27670c;const _0x49d974=await sales_finished[_0x149e11(0x17a)]({'invoice':'OUTF-'+_0x47673f});return _0x49d974&&_0x49d974[_0x149e11(0x1d8)]>0x0?_0x27670c=_0x149e11(0x22b)+_0x47673f:_0x27670c=_0x149e11(0x22b)+_0x47673f,_0x27670c;}function a0_0x1e1f(){var _0x12d910=['<tr>','<div>','Router','primary_code','primary_unit','$product.product_name','for_categorize','master','Arabic','$finalize','An\x20error\x20occurred.','Chinese','$product_details.storage','gmail','1605896lJZviE','Portuguese','Logo.png','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','floor','<tbody\x20style=\x22text-align:\x20center;\x22>','Sale\x20Return\x20Mail','Sale\x20Return','customer','slice','Portuguese\x20(BR)','sale_qty','primary_code_QA','language','/upload/','status','maxPerUnit','params','4313184QuOhcb','random','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</div>','$date','Arabic\x20(ae)','Received\x20Payment\x20For\x20Sale','split','nodemailer','/preview/:id','sendMail','5835137MffVxo','/view/add_sales','$product_details.expiry_date','stock','back','sales_quantity_QA','Error\x20Occurs','/../public','json','adjust_qty','user','unit','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','batch_code_QA','$note','/view/:id','/barcode_scanner','finalize','$product_details.bay','express','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','log','carton','getMonth','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$customers_docs','length','</td>','$invoice','$warehouse_name','flash','maxPerUnit_QA','$product_details.product_code','$sale_product.quantity','warehouse','$product_details.rack','False','toString','$product_details.product_cat','</tr>','message','find','get','$sale_product.bay','email','$product_details.unit','/view/return_sales/:id','staff','filter','edit_sales_finished','Sale\x20Product\x20Mail','amount','</thead>','product_name','</span>','English','product_data','success','findById','\x20</h2>','customers','/view/add_sales/:id','8434DjmlBE','map','product_stock','date','add_sales_finished','product_date','final','../middleware/auth','push','createTransport','product_list','Enclosed','Sales\x20Update\x20successfully','render','<span\x20style=\x22float:\x20right;\x22>','getDate','bay','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Sale','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','expiry_date_QA','return_data','room_name','$room','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Quality\x20Inspection','$sale_product.bin','max_per_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','German','/picking_list/pdf/','add\x20post','<h5>','\x20Order\x20Date\x20:\x20','$product_details','RoomAssigned','Email\x20sent\x20successfully','$product_details.production_date','product_code_QA','customers_docs','Return\x20Rooms','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','edit_sales_finished_view','$sale_product','foreach\x20newproduct','maxProducts_QA','</table>','OUTF-','<h5\x20style=\x22text-align:\x20left;\x22>','secondary_code_QA','room','production_date','<strong>\x20Regards\x20</strong>','error','unit_QA','product_code','sale_product','post','prod_cat','$product_details._id','all_sales_barcode','Finished\x20Goods','product_name_QA1','maxProducts','product_details','batch_code','sales\x20item\x20return\x20successfull','return_qty','101CGyjuV','role','2385540YsNhEE','/view/add_sale/product','Spanish','exports','$product_details.maxPerUnit','</head><body>','image','currency','<hr\x20class=\x22my-3\x22>','host','../public/language/languages.json','secondary_code','$_id','forEach','warehouse_name','body','prod_invoice','all_sales_finished','production_date_QA','/all_sales_finished/view','True','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','</h5>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Enabled','</tbody>','FGSEmail','$product','redirect','save','$product_details.invoice','$product_details.secondary_unit','$sale_product.floorlevel','sales_quantity','<html><head><title></title>','secondary_unit_QA','all','</body></html>','customer_data','$customer','getFullYear','$product_details.batch_code','sales_invoice','\x20Order\x20Number\x20:\x20','aggregate','secondary_unit','barcode\x20user_id','$product_details.type','site_title','$product_details.bin','$product_details.product_stock','Sales\x20Add\x20successfully','$sale_product.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','barcode\x20Product\x20master','QA\x20Warehouse','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Return\x20Goods','errors','concat','8980OUemKd','due_amount','quantity','payment\x20successfull','note','string','<!DOCTYPE\x20html>','level','received_amount','Ambient','$product_details.floorlevel','_id','$return_data','findOne','currency_placement','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','137860wCouxu','Sales\x20Mail','$name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','French','logo','English\x20(US)','then','/view','$product_details.secondary_code','<h2>\x20','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','1146iSHVZf','$product_details.product_name','catch','expiry_date','9ccGUKW'];a0_0x1e1f=function(){return _0x12d910;};return a0_0x1e1f();}router[a0_0x5c8559(0x1e8)](a0_0x5c8559(0x1bd),auth,async(_0x2b49be,_0x597a55)=>{var _0x3c992c=a0_0x5c8559;try{const {username:_0x245655,email:_0x5810bb,role:_0x273952}=_0x2b49be[_0x3c992c(0x1c6)],_0x4edc56=_0x2b49be[_0x3c992c(0x1c6)],_0x4a6e41=await profile[_0x3c992c(0x17a)]({'email':_0x4edc56[_0x3c992c(0x1ea)]}),_0x5a174d=await master_shop['find'](),_0x3989a1=await customer['find']({});let _0x1a7064;if(_0x4edc56['role']==_0x3c992c(0x1ed)){const _0x562698=await staff['findOne']({'email':_0x4edc56['email']});_0x1a7064=await warehouse[_0x3c992c(0x15d)]([{'$match':{'status':'Enabled','name':_0x562698[_0x3c992c(0x1e0)],'warehouse_category':_0x3c992c(0x239),'name':{'$ne':_0x3c992c(0x168)}}},{'$group':{'_id':_0x3c992c(0x17f),'name':{'$first':_0x3c992c(0x17f)}}},{'$sort':{'name':0x1}}]);}else _0x1a7064=await warehouse['aggregate']([{'$match':{'status':_0x3c992c(0x25a),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x3c992c(0x168)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x52a5d2=await product[_0x3c992c(0x1e7)]({});var _0x2d6775=['Ambient',_0x3c992c(0x207)];const _0x7bab03=await sales_finished[_0x3c992c(0x1e7)]({}),_0x1f6b40=_0x7bab03[_0x3c992c(0x1d8)]+0x1,_0x4ec178=_0x3c992c(0x22b)+_0x1f6b40[_0x3c992c(0x1e3)]()['padStart'](0x5,'0');if(_0x5a174d[0x0][_0x3c992c(0x1ab)]==_0x3c992c(0x183)){var _0x4dbcda=users[_0x3c992c(0x1f5)];console[_0x3c992c(0x1d2)](_0x4dbcda);}else{if(_0x5a174d[0x0][_0x3c992c(0x1ab)]==_0x3c992c(0x1d5))var _0x4dbcda=users[_0x3c992c(0x1d5)];else{if(_0x5a174d[0x0][_0x3c992c(0x1ab)]==_0x3c992c(0x219))var _0x4dbcda=users['German'];else{if(_0x5a174d[0x0]['language']==_0x3c992c(0x244))var _0x4dbcda=users[_0x3c992c(0x244)];else{if(_0x5a174d[0x0][_0x3c992c(0x1ab)]==_0x3c992c(0x181))var _0x4dbcda=users[_0x3c992c(0x181)];else{if(_0x5a174d[0x0][_0x3c992c(0x1ab)]==_0x3c992c(0x1a8))var _0x4dbcda=users[_0x3c992c(0x19e)];else{if(_0x5a174d[0x0][_0x3c992c(0x1ab)]=='Chinese')var _0x4dbcda=users[_0x3c992c(0x19a)];else{if(_0x5a174d[0x0]['language']==_0x3c992c(0x1b6))var _0x4dbcda=users[_0x3c992c(0x197)];}}}}}}}const _0x4b4030=getRandom8DigitNumber();_0x4b4030['then'](_0x32d82c=>{var _0x1e2ea6=_0x3c992c;_0x597a55[_0x1e2ea6(0x209)](_0x1e2ea6(0x200),{'success':_0x2b49be[_0x1e2ea6(0x1dc)]('success'),'errors':_0x2b49be[_0x1e2ea6(0x1dc)](_0x1e2ea6(0x16b)),'role':_0x4edc56,'profile':_0x4a6e41,'customer':_0x3989a1,'warehouse':_0x1a7064,'product':_0x52a5d2,'invoice':_0x32d82c,'master_shop':_0x5a174d,'language':_0x4dbcda,'rooms_data':_0x2d6775});})['catch'](_0x37d113=>{var _0x3ee46d=_0x3c992c;_0x2b49be[_0x3ee46d(0x1dc)](_0x3ee46d(0x16b),_0x3ee46d(0x214)),_0x597a55[_0x3ee46d(0x25e)]('/all_sales_finished/view');});}catch(_0x27be50){console['log'](_0x27be50);}}),router[a0_0x5c8559(0x1e8)](a0_0x5c8559(0x1fb),auth,async(_0x2c2a6b,_0x3b0763)=>{var _0x70bfd1=a0_0x5c8559;try{const _0x409b05=_0x2c2a6b[_0x70bfd1(0x1af)]['id'];console[_0x70bfd1(0x1d2)](_0x409b05);const _0xb673bc=await product[_0x70bfd1(0x1e7)](),_0x4677d5=await purchases[_0x70bfd1(0x15d)]([{'$match':{'warehouse_name':_0x409b05}},{'$unwind':_0x70bfd1(0x25d)},{'$group':{'_id':_0x70bfd1(0x194)}}]);console[_0x70bfd1(0x1d2)]('purchases_data',_0x4677d5),_0x3b0763[_0x70bfd1(0x1ad)](0xc8)['json']({'purchases_data':_0x4677d5,'product_data':_0xb673bc});}catch(_0x47f24e){console[_0x70bfd1(0x1d2)](_0x47f24e);}}),router[a0_0x5c8559(0x235)](a0_0x5c8559(0x243),auth,async(_0x2ca044,_0x28dae3)=>{var _0x4975c4=a0_0x5c8559;try{const {warehouse_data:_0x20a6f8,product_data:_0x5d2494}=_0x2ca044[_0x4975c4(0x251)];console[_0x4975c4(0x1d2)](_0x2ca044[_0x4975c4(0x251)][_0x4975c4(0x1f6)]);;const _0x550963=await master_shop[_0x4975c4(0x1e7)]();console[_0x4975c4(0x1d2)](_0x4975c4(0x196),_0x550963);const _0x4ef046=await product[_0x4975c4(0x17a)]({'name':_0x5d2494});console[_0x4975c4(0x1d2)]('product',_0x4ef046);const _0x5c8289=await warehouse[_0x4975c4(0x15d)]([{'$match':{'name':_0x20a6f8}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x5d2494}},{'$group':{'_id':_0x4975c4(0x18b),'product_stock':{'$first':_0x4975c4(0x163)}}}]);console[_0x4975c4(0x1d2)]('stock_data',_0x5c8289),_0x28dae3[_0x4975c4(0x1ad)](0xc8)['json']({'master':_0x550963,'new_product':_0x4ef046,'stock_data':_0x5c8289});}catch(_0x4cad01){console[_0x4975c4(0x1d2)](_0x4cad01);}}),router['post']('/view/add_sales',auth,async(_0x5089ec,_0x230bbd)=>{var _0x1a2d0b=a0_0x5c8559;try{const {invoice:_0x25daf8,date:_0x22c892,warehouse_name:_0x10e384,product_name:_0x585286,stock:_0x344863,quantity:_0x597202,note:_0x276605,room:_0x22ef5c,primary_code:_0x3b41cd,secondary_code:_0x2e8e02,prod_code:_0x19348a,level:_0x541792,isle:_0x499adf,pallet:_0x4812e7,batch_code:_0x5dc1a1,SCRN:_0x14ebfe,expiry_date:_0x24d4f1,mode_transpo:_0x5626ea,name_driver:_0x451d7c}=_0x5089ec[_0x1a2d0b(0x251)];if(typeof _0x585286=='string')var _0x17766a=[_0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x1f3)]],_0x10df0c=[_0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x1bf)]],_0x32fb10=[_0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x1d3)]],_0x1baf93=[_0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x192)]],_0x2ceac3=[_0x5089ec['body'][_0x1a2d0b(0x24d)]],_0x1fe9d1=[_0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x188)]],_0x4c8af=[_0x5089ec[_0x1a2d0b(0x251)]['level']],_0x1f231f=[_0x5089ec['body'][_0x1a2d0b(0x193)]],_0x130517=[_0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x15e)]],_0x161f24=[_0x5089ec['body'][_0x1a2d0b(0x23d)]],_0x13054d=[_0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x18d)]],_0x2fcc9c=[_0x5089ec[_0x1a2d0b(0x251)]['product_date']],_0x1993e4=[_0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x217)]],_0x1497e0=[_0x5089ec[_0x1a2d0b(0x251)]['prod_cat']],_0x555daa=[_0x5089ec['body'][_0x1a2d0b(0x21f)]],_0x1a5398=[_0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x252)]];else var _0x17766a=[..._0x5089ec['body'][_0x1a2d0b(0x1f3)]],_0x10df0c=[..._0x5089ec['body'][_0x1a2d0b(0x1bf)]],_0x32fb10=[..._0x5089ec[_0x1a2d0b(0x251)]['carton']],_0x1baf93=[..._0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x192)]],_0x2ceac3=[..._0x5089ec['body'][_0x1a2d0b(0x24d)]],_0x1fe9d1=[..._0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x188)]],_0x4c8af=[..._0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x174)]],_0x1f231f=[..._0x5089ec['body']['primary_unit']],_0x130517=[..._0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x15e)]],_0x161f24=[..._0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x23d)]],_0x13054d=[..._0x5089ec['body']['expiry_date']],_0x2fcc9c=[..._0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x201)]],_0x1993e4=[..._0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x217)]],_0x1497e0=[..._0x5089ec[_0x1a2d0b(0x251)][_0x1a2d0b(0x236)]],_0x555daa=[..._0x5089ec[_0x1a2d0b(0x251)]['RoomAssigned']],_0x1a5398=[..._0x5089ec['body'][_0x1a2d0b(0x252)]];const _0x156468=_0x17766a[_0x1a2d0b(0x1fd)](_0xa2aa12=>{return _0xa2aa12={'product_name':_0xa2aa12};});_0x10df0c[_0x1a2d0b(0x24f)]((_0x1161ed,_0x4bcc75)=>{var _0x531ecf=_0x1a2d0b;_0x156468[_0x4bcc75][_0x531ecf(0x1bf)]=_0x1161ed;}),_0x32fb10['forEach']((_0x457b50,_0x2e03b6)=>{var _0x5c90d1=_0x1a2d0b;_0x156468[_0x2e03b6][_0x5c90d1(0x16f)]=_0x457b50;}),_0x1baf93['forEach']((_0x1b2d6b,_0x2afc26)=>{_0x156468[_0x2afc26]['primary_code']=_0x1b2d6b;}),_0x2ceac3['forEach']((_0xeadc40,_0x3176f8)=>{var _0x2d23af=_0x1a2d0b;_0x156468[_0x3176f8][_0x2d23af(0x24d)]=_0xeadc40;}),_0x1fe9d1[_0x1a2d0b(0x24f)]((_0x2fac82,_0x3a986a)=>{var _0x3564ec=_0x1a2d0b;_0x156468[_0x3a986a][_0x3564ec(0x233)]=_0x2fac82;}),_0x4c8af[_0x1a2d0b(0x24f)]((_0x20c412,_0x1bbfc8)=>{var _0x4b6ce7=_0x1a2d0b;_0x156468[_0x1bbfc8][_0x4b6ce7(0x20c)]=_0x20c412;}),_0x1f231f[_0x1a2d0b(0x24f)]((_0x4b4c36,_0x63632d)=>{var _0x3ae745=_0x1a2d0b;_0x156468[_0x63632d][_0x3ae745(0x1c7)]=_0x4b4c36;}),_0x130517[_0x1a2d0b(0x24f)]((_0x2db03d,_0x2a25a0)=>{_0x156468[_0x2a25a0]['secondary_unit']=_0x2db03d;}),_0x161f24[_0x1a2d0b(0x24f)]((_0x53f584,_0x34b385)=>{var _0x551b1d=_0x1a2d0b;_0x156468[_0x34b385][_0x551b1d(0x23d)]=_0x53f584;}),_0x13054d[_0x1a2d0b(0x24f)]((_0x296a6b,_0x3a06c0)=>{var _0x1e0072=_0x1a2d0b;_0x156468[_0x3a06c0][_0x1e0072(0x18d)]=_0x296a6b;}),_0x2fcc9c[_0x1a2d0b(0x24f)]((_0xac4045,_0x10ae4a)=>{_0x156468[_0x10ae4a]['production_date']=_0xac4045;}),_0x1993e4[_0x1a2d0b(0x24f)]((_0x2c5dad,_0x38ce7d)=>{_0x156468[_0x38ce7d]['maxperunit']=_0x2c5dad;}),_0x1497e0[_0x1a2d0b(0x24f)]((_0x433129,_0x358dca)=>{_0x156468[_0x358dca]['prod_cat']=_0x433129;}),_0x555daa[_0x1a2d0b(0x24f)]((_0x4e6604,_0x27a2bf)=>{var _0x482616=_0x1a2d0b;_0x156468[_0x27a2bf][_0x482616(0x212)]=_0x4e6604;}),_0x1a5398[_0x1a2d0b(0x24f)]((_0x2d6b07,_0x9c616)=>{_0x156468[_0x9c616]['invoice']=_0x2d6b07;});var _0x3b594e=0x0;_0x156468[_0x1a2d0b(0x24f)](_0x1c1b35=>{var _0x1e4014=_0x1a2d0b;console[_0x1e4014(0x1d2)](_0x1e4014(0x228),_0x1c1b35),(parseInt(_0x1c1b35[_0x1e4014(0x1bf)])<parseInt(_0x1c1b35[_0x1e4014(0x16f)])||parseInt(_0x1c1b35[_0x1e4014(0x16f)])==0x0)&&_0x3b594e++;});if(_0x3b594e!=0x0)return _0x5089ec[_0x1a2d0b(0x1dc)](_0x1a2d0b(0x16b),_0x1a2d0b(0x20f)),_0x230bbd[_0x1a2d0b(0x25e)]('back');const _0x44bd32=_0x156468[_0x1a2d0b(0x1ee)](_0x4ad552=>_0x4ad552[_0x1a2d0b(0x16f)]!=='0'&&_0x4ad552['quantity']!==''),_0x3ed167=new sales_finished({'invoice':_0x25daf8,'customer':_0x5089ec[_0x1a2d0b(0x251)]['customer'],'date':_0x22c892,'warehouse_name':_0x10e384,'sale_product':_0x44bd32,'note':_0x276605,'room':_0x22ef5c,'primary_code':_0x3b41cd,'secondary_code':_0x2e8e02,'prod_code':_0x19348a,'SCRN':_0x14ebfe,'finalize':_0x1a2d0b(0x1e2),'mode_transpo':_0x5626ea,'name_driver':_0x451d7c}),_0x39017a=await _0x3ed167[_0x1a2d0b(0x25f)](),_0x2ec76d=await sales_finished[_0x1a2d0b(0x17a)]({'invoice':_0x25daf8}),_0x323d89=new c_payment_data({'invoice':_0x25daf8,'customer':_0x5089ec[_0x1a2d0b(0x251)]['customer'],'reason':_0x1a2d0b(0x20e)});await _0x323d89['save']();const _0x376523=await master_shop[_0x1a2d0b(0x1e7)](),_0x2a0946=await email_settings[_0x1a2d0b(0x17a)](),_0x3cd79c=await customer[_0x1a2d0b(0x17a)]({'name':_0x5089ec['body']['customer']});_0x376523[0x0][_0x1a2d0b(0x17b)]==0x1?(right_currency=_0x376523[0x0][_0x1a2d0b(0x249)],left_currency=''):(right_currency='',left_currency=_0x376523[0x0][_0x1a2d0b(0x249)]);var _0x4d0cab=_0x17766a,_0x192a1f=_0x32fb10,_0xd3ec6='',_0x515a0f;for(_0x515a0f in _0x4d0cab){_0xd3ec6+=_0x1a2d0b(0x18f)+_0x1a2d0b(0x169)+_0x4d0cab[_0x515a0f]+_0x1a2d0b(0x1d9)+_0x1a2d0b(0x169)+_0x192a1f[_0x515a0f]+'</td>'+_0x1a2d0b(0x1e5);}console[_0x1a2d0b(0x1d2)](_0x1a2d0b(0x206),_0xd3ec6);let _0x144e9d=nodemailer[_0x1a2d0b(0x205)]({'service':'gmail','auth':{'user':_0x2a0946[_0x1a2d0b(0x1ea)],'pass':_0x2a0946[_0x1a2d0b(0x1c8)]}}),_0x421c0c={'from':_0x2a0946[_0x1a2d0b(0x1ea)],'to':_0x3cd79c[_0x1a2d0b(0x1ea)],'subject':_0x1a2d0b(0x1f0),'attachments':[{'filename':_0x1a2d0b(0x19f),'path':__dirname+_0x1a2d0b(0x1c3)+'/upload/'+_0x376523[0x0][_0x1a2d0b(0x248)],'cid':'logo'}],'html':_0x1a2d0b(0x173)+_0x1a2d0b(0x264)+_0x1a2d0b(0x247)+_0x1a2d0b(0x190)+_0x1a2d0b(0x20d)+_0x1a2d0b(0x190)+_0x1a2d0b(0x17c)+_0x1a2d0b(0x1b4)+_0x1a2d0b(0x190)+_0x1a2d0b(0x187)+_0x376523[0x0][_0x1a2d0b(0x161)]+_0x1a2d0b(0x1f9)+_0x1a2d0b(0x1b4)+_0x1a2d0b(0x1b4)+_0x1a2d0b(0x24a)+_0x1a2d0b(0x190)+_0x1a2d0b(0x22c)+_0x1a2d0b(0x15c)+_0x25daf8+'\x20'+_0x1a2d0b(0x20a)+_0x1a2d0b(0x21d)+_0x22c892+'\x20'+_0x1a2d0b(0x1f4)+_0x1a2d0b(0x258)+'</div>'+_0x1a2d0b(0x259)+_0x1a2d0b(0x180)+_0x1a2d0b(0x18f)+_0x1a2d0b(0x218)+_0x1a2d0b(0x1c9)+'</tr>'+'</thead>'+_0x1a2d0b(0x1a3)+'\x20'+_0xd3ec6+'\x20'+_0x1a2d0b(0x25b)+_0x1a2d0b(0x22a)+_0x1a2d0b(0x190)+_0x1a2d0b(0x230)+_0x1a2d0b(0x21c)+_0x376523[0x0][_0x1a2d0b(0x161)]+_0x1a2d0b(0x258)+'</div>'+_0x1a2d0b(0x1b4)+'</body></html>'};_0x144e9d['sendMail'](_0x421c0c,function(_0x3da0d0,_0x18837e){var _0x2137f6=_0x1a2d0b;_0x3da0d0?(console[_0x2137f6(0x1d2)](_0x3da0d0),console[_0x2137f6(0x1d2)](_0x2137f6(0x1c2))):console['log']('Email\x20sent\x20successfully');}),_0x5089ec[_0x1a2d0b(0x1dc)]('success',_0x1a2d0b(0x164)),_0x230bbd['redirect']('/all_sales_finished/preview/'+_0x39017a[_0x1a2d0b(0x178)]);}catch(_0x40bf08){console[_0x1a2d0b(0x1d2)](_0x40bf08);}}),router[a0_0x5c8559(0x1e8)](a0_0x5c8559(0x1ba),auth,async(_0xf06a5c,_0x41a235)=>{var _0x20bbe6=a0_0x5c8559;try{const {username:_0x15b84a,email:_0x4b703f,role:_0x3e025b}=_0xf06a5c[_0x20bbe6(0x1c6)],_0x1b21c7=_0xf06a5c['user'],_0x308b00=await profile['findOne']({'email':_0x1b21c7[_0x20bbe6(0x1ea)]}),_0x265beb=await master_shop[_0x20bbe6(0x1e7)](),_0x57b428=_0xf06a5c['params']['id'],_0x369777=await sales_finished[_0x20bbe6(0x1f8)](_0x57b428),_0x4247a3=await warehouse[_0x20bbe6(0x15d)]([{'$match':{'name':_0x369777[_0x20bbe6(0x250)]}},{'$unwind':_0x20bbe6(0x21e)},{'$group':{'_id':_0x20bbe6(0x237),'name':{'$first':_0x20bbe6(0x18b)},'product_stock':{'$first':_0x20bbe6(0x163)},'bay':{'$first':_0x20bbe6(0x1cf)},'bin':{'$first':_0x20bbe6(0x162)},'type':{'$first':_0x20bbe6(0x160)},'floorlevel':{'$first':_0x20bbe6(0x177)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x20bbe6(0x186)},'product_code':{'$first':_0x20bbe6(0x1de)},'storage':{'$first':_0x20bbe6(0x19b)},'rack':{'$first':_0x20bbe6(0x1e1)},'expiry_date':{'$first':_0x20bbe6(0x1be)},'production_date':{'$first':_0x20bbe6(0x221)},'batch_code':{'$first':_0x20bbe6(0x15a)},'room':{'$first':'$room'}}}]),_0x194f54=await customer[_0x20bbe6(0x1e7)]({});let _0x2578e1;if(_0x1b21c7[_0x20bbe6(0x241)]=='staff'){const _0x5939a9=await staff[_0x20bbe6(0x17a)]({'email':_0x1b21c7[_0x20bbe6(0x1ea)]});_0x2578e1=await warehouse[_0x20bbe6(0x15d)]([{'$match':{'status':_0x20bbe6(0x25a),'name':_0x5939a9[_0x20bbe6(0x1e0)]}},{'$group':{'_id':_0x20bbe6(0x17f),'name':{'$first':'$name'}}}]);}else _0x2578e1=await warehouse[_0x20bbe6(0x15d)]([{'$match':{'status':_0x20bbe6(0x25a)}},{'$group':{'_id':_0x20bbe6(0x17f),'name':{'$first':_0x20bbe6(0x17f)}}}]);const _0x1fa3e3=await product['find']({});if(_0x265beb[0x0][_0x20bbe6(0x1ab)]==_0x20bbe6(0x183)){var _0x4107e2=users[_0x20bbe6(0x1f5)];console['log'](_0x4107e2);}else{if(_0x265beb[0x0][_0x20bbe6(0x1ab)]==_0x20bbe6(0x1d5))var _0x4107e2=users[_0x20bbe6(0x1d5)];else{if(_0x265beb[0x0][_0x20bbe6(0x1ab)]==_0x20bbe6(0x219))var _0x4107e2=users[_0x20bbe6(0x219)];else{if(_0x265beb[0x0][_0x20bbe6(0x1ab)]==_0x20bbe6(0x244))var _0x4107e2=users[_0x20bbe6(0x244)];else{if(_0x265beb[0x0][_0x20bbe6(0x1ab)]==_0x20bbe6(0x181))var _0x4107e2=users['French'];else{if(_0x265beb[0x0][_0x20bbe6(0x1ab)]==_0x20bbe6(0x1a8))var _0x4107e2=users[_0x20bbe6(0x19e)];else{if(_0x265beb[0x0][_0x20bbe6(0x1ab)]=='Chinese')var _0x4107e2=users[_0x20bbe6(0x19a)];else{if(_0x265beb[0x0][_0x20bbe6(0x1ab)]=='Arabic\x20(ae)')var _0x4107e2=users[_0x20bbe6(0x197)];}}}}}}}_0x41a235[_0x20bbe6(0x209)](_0x20bbe6(0x226),{'success':_0xf06a5c[_0x20bbe6(0x1dc)](_0x20bbe6(0x1f7)),'errors':_0xf06a5c[_0x20bbe6(0x1dc)]('errors'),'role':_0x1b21c7,'profile':_0x308b00,'customer':_0x194f54,'warehouse':_0x2578e1,'product':_0x4247a3,'user':_0x369777,'master_shop':_0x265beb,'unit':_0x1fa3e3,'language':_0x4107e2});}catch(_0xa995e0){console[_0x20bbe6(0x1d2)](_0xa995e0);}}),router[a0_0x5c8559(0x235)](a0_0x5c8559(0x1ba),auth,async(_0x4815aa,_0x2cfe2c)=>{var _0x5626dd=a0_0x5c8559;try{const _0x2932d4=_0x4815aa[_0x5626dd(0x1af)]['id'],{invoice:_0x1233e7,warehouse_name:_0x557922,room:_0x3df63e}=_0x4815aa[_0x5626dd(0x251)],_0x4e6b80=await sales_finished[_0x5626dd(0x17a)]({'invoice':_0x1233e7}),_0x5a2005=_0x4e6b80[_0x5626dd(0x234)][_0x5626dd(0x1fd)](async _0x3fbb01=>{var _0x30a6bc=_0x5626dd,_0x357e1f=await warehouse[_0x30a6bc(0x17a)]({'name':_0x557922,'room':_0x3fbb01['room_name'],'warehouse_category':_0x30a6bc(0x239)});const _0x24217a=_0x357e1f[_0x30a6bc(0x23c)][_0x30a6bc(0x1fd)](_0xff0a83=>{var _0x3dc021=_0x30a6bc;_0xff0a83[_0x3dc021(0x1f3)]==_0x3fbb01[_0x3dc021(0x1f3)]&&_0xff0a83['bay']==_0x3fbb01['bay']&&_0xff0a83[_0x3dc021(0x18d)]==_0x3fbb01[_0x3dc021(0x18d)]&&_0xff0a83[_0x3dc021(0x22f)]==_0x3fbb01[_0x3dc021(0x22f)]&&_0xff0a83[_0x3dc021(0x23d)]==_0x3fbb01[_0x3dc021(0x23d)]&&_0xff0a83['invoice']==_0x3fbb01[_0x3dc021(0x1b2)]&&(_0xff0a83[_0x3dc021(0x1fe)]=_0xff0a83[_0x3dc021(0x1fe)]-_0x3fbb01[_0x3dc021(0x16f)]);});return _0x357e1f;});Promise[_0x5626dd(0x155)](_0x5a2005)[_0x5626dd(0x184)](async _0x18b68b=>{var _0x37909d=_0x5626dd;try{for(const _0x400704 of _0x18b68b){await _0x400704[_0x37909d(0x25f)]();}_0x4e6b80[_0x37909d(0x1ce)]=_0x37909d(0x256);const _0x4d8305=await _0x4e6b80['save'](),_0x459e35=await master_shop[_0x37909d(0x1e7)](),_0x17e896=await email_settings['findOne'](),_0x49e3fc=await supervisor_settings[_0x37909d(0x1e7)]();var _0x521302=_0x4e6b80['sale_product'],_0x230799='',_0x20c553;for(_0x20c553 in _0x521302){var _0x1ee843='FG';_0x4e6b80[_0x37909d(0x250)]=='DRY\x20GOODS'&&(_0x1ee843='DG'),_0x230799+=_0x37909d(0x18f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x521302[_0x20c553][_0x37909d(0x1f3)]+_0x37909d(0x1d9)+_0x37909d(0x169)+_0x521302[_0x20c553][_0x37909d(0x233)]+'</td>'+_0x37909d(0x169)+_0x521302[_0x20c553][_0x37909d(0x16f)]+_0x37909d(0x1d9)+_0x37909d(0x169)+_0x521302[_0x20c553]['unit']+_0x37909d(0x1d9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x521302[_0x20c553][_0x37909d(0x15e)]+_0x37909d(0x1d9)+_0x37909d(0x169)+_0x4e6b80['warehouse_name']+_0x37909d(0x1d9)+_0x37909d(0x169)+_0x521302[_0x20c553][_0x37909d(0x212)]+_0x37909d(0x1d9)+_0x37909d(0x169)+_0x1ee843+_0x521302[_0x20c553][_0x37909d(0x20c)]+_0x37909d(0x1d9);}let _0xf47816=nodemailer[_0x37909d(0x205)]({'host':_0x17e896[_0x37909d(0x24b)],'port':Number(_0x17e896['port']),'secure':![],'auth':{'user':_0x17e896['email'],'pass':_0x17e896['password']}}),_0x1e48e7={'from':_0x17e896['email'],'to':_0x49e3fc[0x0][_0x37909d(0x25c)],'subject':_0x37909d(0x17e),'attachments':[{'filename':'Logo.png','path':__dirname+_0x37909d(0x1c3)+_0x37909d(0x1ac)+_0x459e35[0x0]['image'],'cid':_0x37909d(0x182)}],'html':_0x37909d(0x173)+_0x37909d(0x264)+'</head><body>'+_0x37909d(0x190)+_0x37909d(0x20d)+_0x37909d(0x190)+_0x37909d(0x17c)+_0x37909d(0x1b4)+_0x37909d(0x190)+_0x37909d(0x187)+_0x459e35[0x0]['site_title']+_0x37909d(0x1f9)+_0x37909d(0x1b4)+'</div>'+_0x37909d(0x24a)+_0x37909d(0x190)+_0x37909d(0x22c)+_0x37909d(0x15c)+_0x4e6b80[_0x37909d(0x1b2)]+'\x20'+_0x37909d(0x20a)+'\x20Order\x20Date\x20:\x20'+_0x4e6b80[_0x37909d(0x1ff)]+'\x20'+'</span>'+_0x37909d(0x258)+_0x37909d(0x1b4)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x37909d(0x180)+_0x37909d(0x18f)+_0x37909d(0x218)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x37909d(0x1b3)+_0x37909d(0x189)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x37909d(0x166)+_0x37909d(0x1d6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x37909d(0x1e5)+_0x37909d(0x1f2)+_0x37909d(0x1a3)+'\x20'+_0x230799+'\x20'+_0x37909d(0x25b)+'</table>'+_0x37909d(0x190)+_0x37909d(0x230)+_0x37909d(0x21c)+_0x459e35[0x0]['site_title']+_0x37909d(0x258)+_0x37909d(0x1b4)+_0x37909d(0x1b4)+_0x37909d(0x156)};_0xf47816[_0x37909d(0x1bb)](_0x1e48e7,function(_0x22843d,_0x12f396){var _0x5d583e=_0x37909d;_0x22843d?(console[_0x5d583e(0x1d2)](_0x22843d),console[_0x5d583e(0x1d2)](_0x5d583e(0x1c2))):console['log'](_0x5d583e(0x220));}),_0x4815aa[_0x37909d(0x1dc)]('success','Sales\x20Update\x20successfully'),_0x2cfe2c[_0x37909d(0x25e)](_0x37909d(0x21a)+_0x2932d4);}catch(_0x555372){console[_0x37909d(0x231)](_0x555372),_0x2cfe2c[_0x37909d(0x1ad)](0x1f4)[_0x37909d(0x1c4)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x5626dd(0x18c)](_0x51bed3=>{var _0xc0b059=_0x5626dd;console[_0xc0b059(0x231)](_0x51bed3),_0x2cfe2c['status'](0x1f4)[_0xc0b059(0x1c4)]({'error':_0xc0b059(0x199)});});}catch(_0x5f8219){console[_0x5626dd(0x1d2)](_0x5f8219);}}),router[a0_0x5c8559(0x1e8)](a0_0x5c8559(0x1cc),auth,async(_0x1c2039,_0x4bc924)=>{var _0x56740d=a0_0x5c8559;try{const {username:_0x4cc66c,email:_0x50c839,role:_0x2320f0}=_0x1c2039['user'],_0x2d90dc=_0x1c2039[_0x56740d(0x1c6)],_0x2f29ef=await profile['findOne']({'email':_0x2d90dc[_0x56740d(0x1ea)]}),_0x4c3f5c=await master_shop[_0x56740d(0x1e7)](),_0x2af868=_0x1c2039[_0x56740d(0x1af)]['id'],_0x513373=await sales_finished[_0x56740d(0x1f8)](_0x2af868);let _0x293c5d=new Date(_0x513373[_0x56740d(0x18d)]),_0x26be5a=('0'+_0x293c5d[_0x56740d(0x20b)]())[_0x56740d(0x1a7)](-0x2),_0x51800f=('0'+(_0x293c5d[_0x56740d(0x1d4)]()+0x1))[_0x56740d(0x1a7)](-0x2),_0x5e1317=_0x293c5d[_0x56740d(0x159)](),_0x493c42=_0x5e1317+'-'+_0x51800f+'-'+_0x26be5a;var _0x146071=[_0x56740d(0x176),_0x56740d(0x207)];const _0x2ecb79=await warehouse[_0x56740d(0x15d)]([{'$match':{'name':_0x513373[_0x56740d(0x250)],'room':_0x513373[_0x56740d(0x22e)]}},{'$unwind':_0x56740d(0x21e)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x56740d(0x18b)},'product_stock':{'$first':_0x56740d(0x163)},'bay':{'$first':_0x56740d(0x1cf)},'bin':{'$first':_0x56740d(0x162)},'type':{'$first':_0x56740d(0x160)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x56740d(0x1a0)},'secondary_code':{'$first':_0x56740d(0x186)},'product_code':{'$first':_0x56740d(0x1de)},'storage':{'$first':_0x56740d(0x19b)},'rack':{'$first':_0x56740d(0x1e1)}}}]),_0x4ce797=await customer[_0x56740d(0x1e7)]({});let _0x5d43ec;if(_0x2d90dc[_0x56740d(0x241)]==_0x56740d(0x1ed)){const _0x2ae6ae=await staff[_0x56740d(0x17a)]({'email':_0x2d90dc[_0x56740d(0x1ea)]});_0x5d43ec=await warehouse[_0x56740d(0x15d)]([{'$match':{'status':_0x56740d(0x25a),'name':_0x2ae6ae[_0x56740d(0x1e0)]}},{'$group':{'_id':_0x56740d(0x17f),'name':{'$first':_0x56740d(0x17f)}}}]);}else _0x5d43ec=await warehouse['aggregate']([{'$match':{'status':_0x56740d(0x25a)}},{'$group':{'_id':'$name','name':{'$first':_0x56740d(0x17f)}}}]);const _0x57f132=await product['find']({});if(_0x4c3f5c[0x0][_0x56740d(0x1ab)]==_0x56740d(0x183)){var _0x22d5cb=users[_0x56740d(0x1f5)];console[_0x56740d(0x1d2)](_0x22d5cb);}else{if(_0x4c3f5c[0x0][_0x56740d(0x1ab)]=='Hindi')var _0x22d5cb=users[_0x56740d(0x1d5)];else{if(_0x4c3f5c[0x0][_0x56740d(0x1ab)]==_0x56740d(0x219))var _0x22d5cb=users[_0x56740d(0x219)];else{if(_0x4c3f5c[0x0][_0x56740d(0x1ab)]==_0x56740d(0x244))var _0x22d5cb=users[_0x56740d(0x244)];else{if(_0x4c3f5c[0x0]['language']==_0x56740d(0x181))var _0x22d5cb=users[_0x56740d(0x181)];else{if(_0x4c3f5c[0x0][_0x56740d(0x1ab)]==_0x56740d(0x1a8))var _0x22d5cb=users[_0x56740d(0x19e)];else{if(_0x4c3f5c[0x0][_0x56740d(0x1ab)]=='Chinese')var _0x22d5cb=users[_0x56740d(0x19a)];else{if(_0x4c3f5c[0x0][_0x56740d(0x1ab)]==_0x56740d(0x1b6))var _0x22d5cb=users[_0x56740d(0x197)];}}}}}}}_0x4bc924[_0x56740d(0x209)](_0x56740d(0x1ef),{'success':_0x1c2039[_0x56740d(0x1dc)]('success'),'errors':_0x1c2039['flash'](_0x56740d(0x16b)),'role':_0x2d90dc,'profile':_0x2f29ef,'customer':_0x4ce797,'warehouse':_0x5d43ec,'product':_0x2ecb79,'user':_0x513373,'master_shop':_0x4c3f5c,'unit':_0x57f132,'language':_0x22d5cb,'rooms_data':_0x146071,'ed_fullDate':_0x493c42});}catch(_0x3a2499){console[_0x56740d(0x1d2)](_0x3a2499);}}),router[a0_0x5c8559(0x235)](a0_0x5c8559(0x1cc),auth,async(_0x3ff7a8,_0x27575c)=>{var _0x5e50c4=a0_0x5c8559;try{const _0x234eb5=_0x3ff7a8[_0x5e50c4(0x1af)]['id'],_0x5cb789=await sales_finished['findOne']({'_id':_0x3ff7a8['params']['id']}),_0x4cfcd5=await warehouse['findOne']({'name':_0x5cb789[_0x5e50c4(0x250)],'room':_0x3ff7a8[_0x5e50c4(0x251)]['room'],'warehouse_category':_0x5e50c4(0x239)}),{invoice:_0xab107f,customer:_0x240534,date:_0x30818e,warehouse_name:_0xd9ba85,product_name:_0x27ec52,stock:_0x526ada,adjust_qty:_0x40587c,note:_0x2e0084,room:_0xae9236,primary_code:_0x14000b,secondary_code:_0xdd8e43,prod_code:_0x4825d7,level:_0x15e2d4,isle:_0x180285,pallet:_0x1d782c,expiry_date:_0x4e086e}=_0x3ff7a8[_0x5e50c4(0x251)];if(typeof _0x27ec52==_0x5e50c4(0x172))var _0x1628a2=[_0x3ff7a8['body']['product_name']],_0x37ba16=[_0x3ff7a8[_0x5e50c4(0x251)][_0x5e50c4(0x1bf)]],_0x2c338a=[_0x3ff7a8['body'][_0x5e50c4(0x1c5)]],_0x4ba2af=[_0x3ff7a8[_0x5e50c4(0x251)][_0x5e50c4(0x192)]],_0x38d14a=[_0x3ff7a8[_0x5e50c4(0x251)][_0x5e50c4(0x24d)]],_0x2ec69c=[_0x3ff7a8['body'][_0x5e50c4(0x188)]],_0x5499ce=[_0x3ff7a8['body'][_0x5e50c4(0x174)]],_0x46477f=[_0x3ff7a8[_0x5e50c4(0x251)][_0x5e50c4(0x18d)]];else var _0x1628a2=[..._0x3ff7a8[_0x5e50c4(0x251)][_0x5e50c4(0x1f3)]],_0x37ba16=[..._0x3ff7a8[_0x5e50c4(0x251)][_0x5e50c4(0x1bf)]],_0x2c338a=[..._0x3ff7a8[_0x5e50c4(0x251)][_0x5e50c4(0x1c5)]],_0x4ba2af=[..._0x3ff7a8[_0x5e50c4(0x251)]['primary_code']],_0x38d14a=[..._0x3ff7a8[_0x5e50c4(0x251)][_0x5e50c4(0x24d)]],_0x2ec69c=[..._0x3ff7a8[_0x5e50c4(0x251)]['prod_code']],_0x5499ce=[..._0x3ff7a8['body']['level']],_0x46477f=[..._0x3ff7a8[_0x5e50c4(0x251)][_0x5e50c4(0x18d)]];const _0x2243cc=_0x1628a2[_0x5e50c4(0x1fd)](_0x2196bb=>{return _0x2196bb={'product_name':_0x2196bb};});_0x37ba16[_0x5e50c4(0x24f)]((_0x317be1,_0xc4572d)=>{var _0x45f225=_0x5e50c4;_0x2243cc[_0xc4572d][_0x45f225(0x1bf)]=_0x317be1;}),_0x2c338a[_0x5e50c4(0x24f)]((_0x2fcef1,_0x2ae8af)=>{var _0x41d5cd=_0x5e50c4;_0x2243cc[_0x2ae8af][_0x41d5cd(0x16f)]=_0x2fcef1;}),_0x4ba2af[_0x5e50c4(0x24f)]((_0x4eade9,_0x5b92a3)=>{var _0x3987e0=_0x5e50c4;_0x2243cc[_0x5b92a3][_0x3987e0(0x192)]=_0x4eade9;}),_0x38d14a[_0x5e50c4(0x24f)]((_0x902db,_0x570507)=>{var _0x59274c=_0x5e50c4;_0x2243cc[_0x570507][_0x59274c(0x24d)]=_0x902db;}),_0x2ec69c[_0x5e50c4(0x24f)]((_0x46bc21,_0x3c3998)=>{_0x2243cc[_0x3c3998]['product_code']=_0x46bc21;}),_0x5499ce[_0x5e50c4(0x24f)]((_0x108916,_0x11cdfa)=>{_0x2243cc[_0x11cdfa]['level']=_0x108916;}),_0x46477f[_0x5e50c4(0x24f)]((_0x2a86ca,_0x51fa11)=>{var _0x484da8=_0x5e50c4;_0x2243cc[_0x51fa11][_0x484da8(0x18d)]=_0x2a86ca;});var _0x4fa9e5=0x0;_0x2243cc[_0x5e50c4(0x24f)](_0x1c03e0=>{var _0x300f8c=_0x5e50c4;console[_0x300f8c(0x1d2)](_0x300f8c(0x228),_0x1c03e0),(parseInt(_0x1c03e0[_0x300f8c(0x1bf)])<parseInt(_0x1c03e0['quantity'])||parseInt(_0x1c03e0[_0x300f8c(0x16f)])==0x0)&&_0x4fa9e5++;});if(_0x4fa9e5!=0x0)return _0x3ff7a8[_0x5e50c4(0x1dc)](_0x5e50c4(0x16b),_0x5e50c4(0x20f)),_0x27575c['redirect']('back');_0x5cb789[_0x5e50c4(0x234)][_0x5e50c4(0x24f)](_0xc474d0=>{var _0x183690=_0x5e50c4;const _0x49b8c5=_0x4cfcd5['product_details'][_0x183690(0x1fd)](_0x1bc5a4=>{var _0x1243f1=_0x183690;_0x1bc5a4[_0x1243f1(0x1f3)]==_0xc474d0[_0x1243f1(0x1f3)]&&_0x1bc5a4['bay']==_0xc474d0[_0x1243f1(0x20c)]&&(_0x1bc5a4[_0x1243f1(0x1fe)]=parseInt(_0x1bc5a4['product_stock'])+parseInt(_0xc474d0['quantity']));});}),await _0x4cfcd5[_0x5e50c4(0x25f)]();const _0x2197c=_0x2243cc['filter'](_0x561363=>_0x561363[_0x5e50c4(0x16f)]!=='0'&&_0x561363[_0x5e50c4(0x16f)]!=='');_0x5cb789[_0x5e50c4(0x1b2)]=_0xab107f,_0x5cb789[_0x5e50c4(0x1a6)]=_0x240534,_0x5cb789[_0x5e50c4(0x1ff)]=_0x30818e,_0x5cb789[_0x5e50c4(0x250)]=_0xd9ba85,_0x5cb789[_0x5e50c4(0x234)]=_0x2197c,_0x5cb789[_0x5e50c4(0x171)]=_0x2e0084,_0x5cb789[_0x5e50c4(0x22e)]=_0xae9236;const _0x558c27=await _0x5cb789[_0x5e50c4(0x25f)](),_0x556065=await sales_finished[_0x5e50c4(0x17a)]({'_id':_0x3ff7a8[_0x5e50c4(0x1af)]['id']}),_0x1dd803=await warehouse[_0x5e50c4(0x17a)]({'name':_0xd9ba85,'room':_0xae9236,'warehouse_category':'Finished\x20Goods'});_0x556065[_0x5e50c4(0x234)][_0x5e50c4(0x24f)](_0x500462=>{var _0x571a5d=_0x5e50c4;const _0x1ccbdb=_0x1dd803[_0x571a5d(0x23c)][_0x571a5d(0x1fd)](_0x10fbb7=>{var _0x3aa67a=_0x571a5d;_0x10fbb7[_0x3aa67a(0x1f3)]==_0x500462['product_name']&&_0x10fbb7['bay']==_0x500462[_0x3aa67a(0x20c)]&&(_0x10fbb7[_0x3aa67a(0x1fe)]=parseInt(_0x10fbb7[_0x3aa67a(0x1fe)])-parseInt(_0x500462[_0x3aa67a(0x16f)]));});}),console['log'](_0x5e50c4(0x202),_0x1dd803),await _0x1dd803[_0x5e50c4(0x25f)]();const _0x329c11=await c_payment_data['findOne']({'invoice':_0x3ff7a8[_0x5e50c4(0x251)][_0x5e50c4(0x1b2)]});_0x329c11['suppliers']=_0x3ff7a8[_0x5e50c4(0x251)]['suppliers'],await _0x329c11[_0x5e50c4(0x25f)](),_0x3ff7a8[_0x5e50c4(0x1dc)](_0x5e50c4(0x1f7),_0x5e50c4(0x208)),_0x27575c[_0x5e50c4(0x25e)](_0x5e50c4(0x255));}catch(_0x43e1f2){console[_0x5e50c4(0x1d2)](_0x43e1f2);}}),router[a0_0x5c8559(0x235)]('/give_payment/:id',auth,async(_0x414ef3,_0x15e0c3)=>{var _0x3ccfcd=a0_0x5c8559;try{const _0x549356=_0x414ef3[_0x3ccfcd(0x1af)]['id'],{invoice:_0x1d92d7,customer:_0x34e3c8,receivable_amount:_0x1c8588,received_amount:_0xe64bc}=_0x414ef3[_0x3ccfcd(0x251)],_0x2e0c86=await sales[_0x3ccfcd(0x1f8)](_0x549356);console['log'](_0x2e0c86);var _0x4bb853=_0x1c8588-_0xe64bc;console[_0x3ccfcd(0x1d2)](_0xe64bc),_0x2e0c86[_0x3ccfcd(0x175)]=parseFloat(_0xe64bc)+parseFloat(_0x2e0c86[_0x3ccfcd(0x175)]),_0x2e0c86[_0x3ccfcd(0x16e)]=_0x4bb853,console[_0x3ccfcd(0x1d2)](_0x2e0c86);const _0x4d1481=await _0x2e0c86['save'](),_0x326264=await c_payment_data[_0x3ccfcd(0x17a)]({'invoice':_0x1d92d7});_0x326264[_0x3ccfcd(0x1f1)]=_0x4bb853,await _0x326264[_0x3ccfcd(0x25f)]();let _0x92bcb6=new Date(),_0xcdae32=('0'+_0x92bcb6[_0x3ccfcd(0x20b)]())[_0x3ccfcd(0x1a7)](-0x2),_0x18571a=('0'+(_0x92bcb6['getMonth']()+0x1))['slice'](-0x2),_0x506d41=_0x92bcb6['getFullYear'](),_0x465783=_0x506d41+'-'+_0x18571a+'-'+_0xcdae32;const _0x2aa35c=new customer_payment({'invoice':_0x1d92d7,'date':_0x506d41+'-'+_0x18571a+'-'+_0xcdae32,'customer':_0x34e3c8,'reason':_0x3ccfcd(0x1b7),'amount':_0xe64bc}),_0x2ce453=await _0x2aa35c[_0x3ccfcd(0x25f)]();_0x414ef3[_0x3ccfcd(0x1dc)](_0x3ccfcd(0x1f7),_0x3ccfcd(0x170)),_0x15e0c3['redirect']('/all_sales/view');}catch(_0x254f44){console['log'](_0x254f44);}}),router['get']('/invoice/:id',auth,async(_0x4d9b07,_0x466bd7)=>{var _0x8a7ad1=a0_0x5c8559;try{const {username:_0x3ac948,email:_0x32f501,role:_0x5bddc7}=_0x4d9b07[_0x8a7ad1(0x1c6)],_0x4aa23b=_0x4d9b07[_0x8a7ad1(0x1c6)],_0x454393=await profile[_0x8a7ad1(0x17a)]({'email':_0x4aa23b[_0x8a7ad1(0x1ea)]}),_0x26da51=await master_shop[_0x8a7ad1(0x1e7)]();console[_0x8a7ad1(0x1d2)](_0x8a7ad1(0x196),_0x26da51);const _0x16fe4e=_0x4d9b07[_0x8a7ad1(0x1af)]['id'],_0x152572=await sales[_0x8a7ad1(0x1f8)](_0x16fe4e);console[_0x8a7ad1(0x1d2)](_0x152572);const _0x40279a=await customer['findOne']({'name':_0x152572[_0x8a7ad1(0x1a6)]});console['log'](_0x40279a);if(_0x26da51[0x0][_0x8a7ad1(0x1ab)]==_0x8a7ad1(0x183)){var _0x29875d=users[_0x8a7ad1(0x1f5)];console[_0x8a7ad1(0x1d2)](_0x29875d);}else{if(_0x26da51[0x0][_0x8a7ad1(0x1ab)]=='Hindi')var _0x29875d=users[_0x8a7ad1(0x1d5)];else{if(_0x26da51[0x0][_0x8a7ad1(0x1ab)]=='German')var _0x29875d=users[_0x8a7ad1(0x219)];else{if(_0x26da51[0x0][_0x8a7ad1(0x1ab)]=='Spanish')var _0x29875d=users['Spanish'];else{if(_0x26da51[0x0][_0x8a7ad1(0x1ab)]==_0x8a7ad1(0x181))var _0x29875d=users[_0x8a7ad1(0x181)];else{if(_0x26da51[0x0][_0x8a7ad1(0x1ab)]==_0x8a7ad1(0x1a8))var _0x29875d=users[_0x8a7ad1(0x19e)];else{if(_0x26da51[0x0][_0x8a7ad1(0x1ab)]=='Chinese')var _0x29875d=users['Chinese'];else{if(_0x26da51[0x0][_0x8a7ad1(0x1ab)]=='Arabic\x20(ae)')var _0x29875d=users[_0x8a7ad1(0x197)];}}}}}}}_0x466bd7[_0x8a7ad1(0x209)](_0x8a7ad1(0x15b),{'success':_0x4d9b07[_0x8a7ad1(0x1dc)](_0x8a7ad1(0x1f7)),'errors':_0x4d9b07[_0x8a7ad1(0x1dc)](_0x8a7ad1(0x16b)),'role':_0x4aa23b,'profile':_0x454393,'master_shop':_0x26da51,'customers':_0x40279a,'sales':_0x152572,'language':_0x29875d});}catch(_0x5951a0){console[_0x8a7ad1(0x1d2)](_0x5951a0);}}),router[a0_0x5c8559(0x1e8)](a0_0x5c8559(0x1ec),auth,async(_0x49f4b1,_0x14e9ef)=>{var _0x2644e8=a0_0x5c8559;try{const {username:_0x4b8e30,email:_0xc7ced9,role:_0x4b52b3}=_0x49f4b1[_0x2644e8(0x1c6)],_0x50c013=_0x49f4b1['user'],_0x3529a4=await profile[_0x2644e8(0x17a)]({'email':_0x50c013[_0x2644e8(0x1ea)]}),_0x4cbb6a=await master_shop[_0x2644e8(0x1e7)](),_0x1928a9=_0x49f4b1['params']['id'],_0x163b7b=await sales_finished[_0x2644e8(0x1f8)](_0x1928a9),_0x3542d3=await warehouse[_0x2644e8(0x15d)]([{'$match':{'name':_0x163b7b['warehouse_name']}},{'$unwind':_0x2644e8(0x21e)},{'$group':{'_id':_0x2644e8(0x237),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2644e8(0x163)},'bay':{'$first':_0x2644e8(0x1cf)},'bin':{'$first':_0x2644e8(0x162)},'type':{'$first':_0x2644e8(0x160)},'floorlevel':{'$first':_0x2644e8(0x177)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2644e8(0x186)},'product_code':{'$first':_0x2644e8(0x1de)},'storage':{'$first':_0x2644e8(0x19b)},'rack':{'$first':_0x2644e8(0x1e1)},'expiry_date':{'$first':_0x2644e8(0x1be)},'production_date':{'$first':_0x2644e8(0x221)},'unit':{'$first':_0x2644e8(0x1eb)},'secondary_unit':{'$first':_0x2644e8(0x261)},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':_0x2644e8(0x15a)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x2ac2d7=await product[_0x2644e8(0x1e7)]({}),_0x50435d=await warehouse[_0x2644e8(0x15d)]([{'$match':{'status':_0x2644e8(0x25a),'warehouse_category':_0x2644e8(0x239),'name':{'$ne':_0x2644e8(0x16a),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':'$name','name':{'$first':_0x2644e8(0x17f)}}},{'$sort':{'name':0x1}}]);var _0x4d17d0=[_0x2644e8(0x224)];const _0x2d6cd4=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x2644e8(0x215)}},{'$group':{'_id':_0x2644e8(0x17f),'name':{'$first':_0x2644e8(0x17f)}}},{'$sort':{'name':0x1}}]);if(_0x4cbb6a[0x0]['language']==_0x2644e8(0x183)){var _0x55b3a9=users[_0x2644e8(0x1f5)];console[_0x2644e8(0x1d2)](_0x55b3a9);}else{if(_0x4cbb6a[0x0]['language']=='Hindi')var _0x55b3a9=users[_0x2644e8(0x1d5)];else{if(_0x4cbb6a[0x0][_0x2644e8(0x1ab)]==_0x2644e8(0x219))var _0x55b3a9=users[_0x2644e8(0x219)];else{if(_0x4cbb6a[0x0]['language']=='Spanish')var _0x55b3a9=users['Spanish'];else{if(_0x4cbb6a[0x0][_0x2644e8(0x1ab)]==_0x2644e8(0x181))var _0x55b3a9=users['French'];else{if(_0x4cbb6a[0x0][_0x2644e8(0x1ab)]=='Portuguese\x20(BR)')var _0x55b3a9=users[_0x2644e8(0x19e)];else{if(_0x4cbb6a[0x0][_0x2644e8(0x1ab)]==_0x2644e8(0x19a))var _0x55b3a9=users[_0x2644e8(0x19a)];else{if(_0x4cbb6a[0x0][_0x2644e8(0x1ab)]==_0x2644e8(0x1b6))var _0x55b3a9=users['Arabic'];}}}}}}}_0x14e9ef['render']('return_sale_finished',{'success':_0x49f4b1['flash'](_0x2644e8(0x1f7)),'errors':_0x49f4b1[_0x2644e8(0x1dc)]('errors'),'role':_0x50c013,'profile':_0x3529a4,'user':_0x163b7b,'stock':_0x3542d3,'master_shop':_0x4cbb6a,'unit':_0x2ac2d7,'language':_0x55b3a9,'warehouses':_0x50435d,'rooms':_0x4d17d0,'warehouse_QA':_0x2d6cd4});}catch(_0x4046ad){console[_0x2644e8(0x1d2)](_0x4046ad),_0x14e9ef['status'](0xc8)['json']({'message':_0x4046ad[_0x2644e8(0x1e6)]});}}),router[a0_0x5c8559(0x235)](a0_0x5c8559(0x1ec),auth,async(_0xd3944d,_0xeb0efb)=>{var _0x146739=a0_0x5c8559;if(_0xd3944d[_0x146739(0x251)][_0x146739(0x195)]=='QA')try{const {invoice:_0x263d0b,date:_0x20e58e,warehouse_name:_0x2cb93b,product_name:_0x33d3c2,primary_code:_0x277c71,secondary_code:_0x27920b,product_code:_0x3addbb,sales_quantity:_0x43aa8f,stocks:_0x427b50,return_qty:_0x1ddb9a,Room_name:_0x33b4e2,to_warehouse_name_QA:_0x150e01,to_Room_name_QA:_0x389924,note:_0x222c8a,for_categorize:_0x115658,product_name_QA1:_0x48ee39}=_0xd3944d[_0x146739(0x251)];if(typeof _0x48ee39==_0x146739(0x172))var _0x112046=[_0xd3944d['body'][_0x146739(0x23a)]],_0x4d0805=[_0xd3944d[_0x146739(0x251)][_0x146739(0x1aa)]],_0x264c83=[_0xd3944d[_0x146739(0x251)][_0x146739(0x22d)]],_0x2f020d=[_0xd3944d[_0x146739(0x251)][_0x146739(0x222)]],_0xef30c1=[_0xd3944d[_0x146739(0x251)][_0x146739(0x1c1)]],_0x2c6bac=[_0xd3944d['body']['stocks_QA']],_0x53692=[_0xd3944d[_0x146739(0x251)]['return_qty_QA']],_0x3d8bee=[_0xd3944d[_0x146739(0x251)][_0x146739(0x1dd)]],_0x430915=[_0xd3944d[_0x146739(0x251)][_0x146739(0x229)]],_0x3ec7da=[_0xd3944d['body'][_0x146739(0x1ca)]],_0x11632c=[_0xd3944d['body']['secondary_unit_QA']],_0x4aaa5b=[_0xd3944d['body'][_0x146739(0x232)]],_0x558018=[_0xd3944d[_0x146739(0x251)][_0x146739(0x254)]],_0x330e5b=[_0xd3944d[_0x146739(0x251)][_0x146739(0x210)]];else var _0x112046=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x23a)]],_0x4d0805=[..._0xd3944d[_0x146739(0x251)]['primary_code_QA']],_0x264c83=[..._0xd3944d['body'][_0x146739(0x22d)]],_0x2f020d=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x222)]],_0xef30c1=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x1c1)]],_0x2c6bac=[..._0xd3944d['body']['stocks_QA']],_0x53692=[..._0xd3944d[_0x146739(0x251)]['return_qty_QA']],_0x3d8bee=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x1dd)]],_0x430915=[..._0xd3944d['body']['maxProducts_QA']],_0x3ec7da=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x1ca)]],_0x11632c=[..._0xd3944d['body'][_0x146739(0x154)]],_0x4aaa5b=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x232)]],_0x558018=[..._0xd3944d[_0x146739(0x251)]['production_date_QA']],_0x330e5b=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x210)]];const _0x5bc6a6=_0x112046[_0x146739(0x1fd)](_0x2efdad=>{return _0x2efdad={'product_name':_0x2efdad};});_0x4d0805[_0x146739(0x24f)]((_0xf02756,_0x360c6f)=>{var _0x4aa71a=_0x146739;_0x5bc6a6[_0x360c6f][_0x4aa71a(0x192)]=_0xf02756;}),_0x264c83[_0x146739(0x24f)]((_0x4f8285,_0x66d86b)=>{var _0x915e1e=_0x146739;_0x5bc6a6[_0x66d86b][_0x915e1e(0x24d)]=_0x4f8285;}),_0x2f020d[_0x146739(0x24f)]((_0x4bdae1,_0x1dce50)=>{_0x5bc6a6[_0x1dce50]['product_code']=_0x4bdae1;}),_0xef30c1['forEach']((_0x314f11,_0x51e2af)=>{var _0x5edcc1=_0x146739;_0x5bc6a6[_0x51e2af][_0x5edcc1(0x1a9)]=_0x314f11;}),_0x2c6bac['forEach']((_0xf445d1,_0x2e88d2)=>{_0x5bc6a6[_0x2e88d2]['stock']=_0xf445d1;}),_0x53692['forEach']((_0x4a10bb,_0x39fe7f)=>{var _0x225992=_0x146739;_0x5bc6a6[_0x39fe7f][_0x225992(0x23f)]=_0x4a10bb;}),_0x3d8bee[_0x146739(0x24f)]((_0x8f1212,_0x43cbf1)=>{var _0x367fb1=_0x146739;_0x5bc6a6[_0x43cbf1][_0x367fb1(0x1ae)]=_0x8f1212;}),_0x430915[_0x146739(0x24f)]((_0x35d8ec,_0x1e1f47)=>{var _0x4851f5=_0x146739;_0x5bc6a6[_0x1e1f47][_0x4851f5(0x23b)]=_0x35d8ec;}),_0x3ec7da[_0x146739(0x24f)]((_0x22c4e6,_0xa1d859)=>{var _0x373250=_0x146739;_0x5bc6a6[_0xa1d859][_0x373250(0x23d)]=_0x22c4e6;}),_0x11632c[_0x146739(0x24f)]((_0x56b732,_0x489b8c)=>{_0x5bc6a6[_0x489b8c]['secondary_unit']=_0x56b732;}),_0x4aaa5b[_0x146739(0x24f)]((_0x2de8b8,_0x1c3365)=>{var _0xa084b9=_0x146739;_0x5bc6a6[_0x1c3365][_0xa084b9(0x1c7)]=_0x2de8b8;}),_0x558018[_0x146739(0x24f)]((_0xd21b9f,_0x17ab32)=>{var _0x1db1b8=_0x146739;_0x5bc6a6[_0x17ab32][_0x1db1b8(0x22f)]=_0xd21b9f;}),_0x330e5b[_0x146739(0x24f)]((_0x26acff,_0x48ab9b)=>{var _0x3dbaef=_0x146739;_0x5bc6a6[_0x48ab9b][_0x3dbaef(0x18d)]=_0x26acff;});const _0xd12c2b=await sales_finished[_0x146739(0x17a)]({'invoice':_0x263d0b});_0xd12c2b['return_data']=_0x146739(0x256);const _0x31e8f7=await _0xd12c2b['save'](),_0x5ee2f8=new sales_return_finished({'invoice':_0x263d0b,'customer':_0xd3944d[_0x146739(0x251)][_0x146739(0x1a6)],'date':_0x20e58e,'warehouse_name':_0x2cb93b,'room':_0x33b4e2,'ToWarehouse':_0x150e01,'ToRoom':_0x389924,'return_sale_QA':_0x5bc6a6,'note':_0x222c8a,'warehouse_cat':_0x115658}),_0x42e81d=await _0x5ee2f8['save'](),_0x293d5=await sales_return_finished[_0x146739(0x17a)]({'invoice':_0x263d0b}),_0x1beae9=await warehouse[_0x146739(0x17a)]({'name':_0x150e01,'room':_0x389924});_0x293d5['return_sale_QA'][_0x146739(0x24f)](_0x2cd188=>{var _0x4ec4a2=_0x146739,_0x1017e8=0x0;const _0x293714=_0x1beae9[_0x4ec4a2(0x23c)][_0x4ec4a2(0x1fd)](_0x165c9e=>{var _0x4c1050=_0x4ec4a2;_0x165c9e[_0x4c1050(0x1f3)]==_0x2cd188[_0x4c1050(0x1f3)]&&_0x165c9e[_0x4c1050(0x18d)]==_0x2cd188[_0x4c1050(0x18d)]&&_0x165c9e[_0x4c1050(0x22f)]==_0x2cd188[_0x4c1050(0x22f)]&&_0x165c9e['batch_code']==_0x2cd188[_0x4c1050(0x23d)]&&(_0x165c9e[_0x4c1050(0x1fe)]=parseInt(_0x165c9e[_0x4c1050(0x1fe)])+parseInt(_0x2cd188[_0x4c1050(0x23f)]),_0x1017e8++);});_0x1017e8=='0'&&(_0x1beae9[_0x4ec4a2(0x23c)]=_0x1beae9[_0x4ec4a2(0x23c)][_0x4ec4a2(0x16c)]({'product_name':_0x2cd188[_0x4ec4a2(0x1f3)],'product_stock':_0x2cd188['return_qty'],'primary_code':_0x2cd188['primary_code'],'secondary_code':_0x2cd188['secondary_code'],'product_code':_0x2cd188[_0x4ec4a2(0x233)],'batch_code':_0x2cd188[_0x4ec4a2(0x23d)],'maxPerUnit':_0x2cd188[_0x4ec4a2(0x1ae)],'production_date':_0x2cd188[_0x4ec4a2(0x22f)],'expiry_date':_0x2cd188[_0x4ec4a2(0x18d)],'secondary_unit':_0x2cd188[_0x4ec4a2(0x15e)],'unit':_0x2cd188['unit'],'maxProducts':_0x2cd188[_0x4ec4a2(0x23b)],'bay':_0x2cd188[_0x4ec4a2(0x20c)]}));}),await _0x1beae9[_0x146739(0x25f)]();const _0x5a23ee=new c_payment_data({'invoice':_0x263d0b,'customer':_0xd3944d[_0x146739(0x251)][_0x146739(0x1a6)],'reason':'Sale\x20Return'});await _0x5a23ee[_0x146739(0x25f)]();const _0x4bffb2=await master_shop[_0x146739(0x1e7)](),_0x3e993f=await email_settings[_0x146739(0x17a)](),_0xcd945f=await customer['findOne']({'name':_0xd3944d[_0x146739(0x251)]['customer']});_0x4bffb2[0x0][_0x146739(0x17b)]==0x1?(right_currency=_0x4bffb2[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4bffb2[0x0]['currency']);var _0x3d7f13=_0x112046,_0x56c0bb=_0x53692,_0x50c5f3='',_0x410216;for(_0x410216 in _0x3d7f13){_0x50c5f3+=_0x146739(0x18f)+_0x146739(0x169)+_0x3d7f13[_0x410216]+'</td>'+_0x146739(0x169)+_0x56c0bb[_0x410216]+_0x146739(0x1d9)+'</tr>';}console[_0x146739(0x1d2)](_0x146739(0x206),_0x50c5f3);let _0x422307=nodemailer[_0x146739(0x205)]({'service':_0x146739(0x19c),'auth':{'user':_0x3e993f[_0x146739(0x1ea)],'pass':_0x3e993f[_0x146739(0x1c8)]}}),_0x40b9ab={'from':_0x3e993f[_0x146739(0x1ea)],'to':_0xcd945f[_0x146739(0x1ea)],'subject':_0x146739(0x1a4),'attachments':[{'filename':_0x146739(0x19f),'path':__dirname+_0x146739(0x1c3)+_0x146739(0x1ac)+_0x4bffb2[0x0][_0x146739(0x248)],'cid':'logo'}],'html':_0x146739(0x173)+_0x146739(0x264)+_0x146739(0x247)+_0x146739(0x190)+_0x146739(0x20d)+_0x146739(0x190)+_0x146739(0x17c)+_0x146739(0x1b4)+_0x146739(0x190)+'<h2>\x20'+_0x4bffb2[0x0][_0x146739(0x161)]+_0x146739(0x1f9)+_0x146739(0x1b4)+_0x146739(0x1b4)+_0x146739(0x24a)+_0x146739(0x190)+_0x146739(0x22c)+'\x20Order\x20Number\x20:\x20'+_0x263d0b+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x146739(0x21d)+_0x20e58e+'\x20'+_0x146739(0x1f4)+_0x146739(0x258)+_0x146739(0x1b4)+_0x146739(0x259)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x146739(0x218)+_0x146739(0x1a1)+_0x146739(0x225)+_0x146739(0x1d1)+_0x146739(0x1e5)+_0x146739(0x1f2)+_0x146739(0x1a3)+'\x20'+_0x50c5f3+'\x20'+'</tbody>'+_0x146739(0x22a)+_0x146739(0x190)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x4bffb2[0x0][_0x146739(0x161)]+'</h5>'+_0x146739(0x1b4)+_0x146739(0x1b4)+'</body></html>'};_0x422307[_0x146739(0x1bb)](_0x40b9ab,function(_0x1a9300,_0x55bb97){var _0x39aee6=_0x146739;_0x1a9300?(console['log'](_0x1a9300),console[_0x39aee6(0x1d2)](_0x39aee6(0x1c2))):console[_0x39aee6(0x1d2)](_0x39aee6(0x220));}),_0xd3944d[_0x146739(0x1dc)]('success','sales\x20item\x20return\x20successfull'),_0xeb0efb[_0x146739(0x25e)](_0x146739(0x255));}catch(_0x2818f2){_0xeb0efb[_0x146739(0x1ad)](0xc8)[_0x146739(0x1c4)]({'message1':_0x2818f2[_0x146739(0x1e6)]});}else{if(_0xd3944d[_0x146739(0x251)][_0x146739(0x195)]=='GS')try{const {invoice:_0x53431d,date:_0x9e3dbf,warehouse_name:_0x358eb4,product_name:_0x1e19bc,primary_code:_0x67ed65,secondary_code:_0x1cb116,product_code:_0x35909a,sales_quantity:_0x4269ee,stocks:_0x4eaa4d,return_qty:_0x40cbd4,Room_name:_0x260086,to_warehouse_name:_0x4b03f5,to_Room_name:_0x5b00de,note:_0x549342,level:_0x4b760d,isle:_0x42a911,pallet:_0x45d9ff,for_categorize:_0x4b3b59}=_0xd3944d['body'];if(typeof _0x1e19bc==_0x146739(0x172))var _0x112046=[_0xd3944d[_0x146739(0x251)][_0x146739(0x1f3)]],_0x4d0805=[_0xd3944d[_0x146739(0x251)][_0x146739(0x192)]],_0x264c83=[_0xd3944d['body'][_0x146739(0x24d)]],_0x2f020d=[_0xd3944d[_0x146739(0x251)][_0x146739(0x233)]],_0xef30c1=[_0xd3944d[_0x146739(0x251)][_0x146739(0x263)]],_0x53692=[_0xd3944d[_0x146739(0x251)][_0x146739(0x23f)]],_0x8f807f=[_0xd3944d[_0x146739(0x251)][_0x146739(0x20c)]],_0x3d8bee=[_0xd3944d[_0x146739(0x251)]['maxPerUnit']],_0x430915=[_0xd3944d[_0x146739(0x251)]['maxProducts']],_0x3ec7da=[_0xd3944d[_0x146739(0x251)][_0x146739(0x23d)]],_0x11632c=[_0xd3944d[_0x146739(0x251)][_0x146739(0x15e)]],_0x4aaa5b=[_0xd3944d[_0x146739(0x251)]['unit']],_0x558018=[_0xd3944d['body'][_0x146739(0x22f)]],_0x330e5b=[_0xd3944d[_0x146739(0x251)]['expiry_date']];else var _0x112046=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x1f3)]],_0x4d0805=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x192)]],_0x264c83=[..._0xd3944d['body'][_0x146739(0x24d)]],_0x2f020d=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x233)]],_0xef30c1=[..._0xd3944d['body'][_0x146739(0x263)]],_0x53692=[..._0xd3944d[_0x146739(0x251)]['return_qty']],_0x8f807f=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x20c)]],_0x3d8bee=[..._0xd3944d[_0x146739(0x251)]['maxPerUnit']],_0x430915=[..._0xd3944d['body'][_0x146739(0x23b)]],_0x3ec7da=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x23d)]],_0x11632c=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x15e)]],_0x4aaa5b=[..._0xd3944d['body'][_0x146739(0x1c7)]],_0x558018=[..._0xd3944d[_0x146739(0x251)][_0x146739(0x22f)]],_0x330e5b=[..._0xd3944d[_0x146739(0x251)]['expiry_date']];const _0x582030=_0x112046['map'](_0x15a942=>{return _0x15a942={'product_name':_0x15a942};});_0x4d0805[_0x146739(0x24f)]((_0x54e48e,_0x10b635)=>{var _0x16ea7c=_0x146739;_0x582030[_0x10b635][_0x16ea7c(0x192)]=_0x54e48e;}),_0x264c83['forEach']((_0x1cb290,_0x15532a)=>{var _0x48de78=_0x146739;_0x582030[_0x15532a][_0x48de78(0x24d)]=_0x1cb290;}),_0x2f020d['forEach']((_0x416084,_0x1954c0)=>{var _0x5d1be4=_0x146739;_0x582030[_0x1954c0][_0x5d1be4(0x233)]=_0x416084;}),_0xef30c1[_0x146739(0x24f)]((_0x3fba2e,_0x3e9f9b)=>{_0x582030[_0x3e9f9b]['sale_qty']=_0x3fba2e;}),_0x53692[_0x146739(0x24f)]((_0x1d950e,_0x46384c)=>{_0x582030[_0x46384c]['return_qty']=_0x1d950e;}),_0x8f807f[_0x146739(0x24f)]((_0x2568c3,_0x18987c)=>{var _0x51e323=_0x146739;_0x582030[_0x18987c][_0x51e323(0x20c)]=_0x2568c3;}),_0x3d8bee[_0x146739(0x24f)]((_0x4f4700,_0x1c66c2)=>{_0x582030[_0x1c66c2]['maxPerUnit']=_0x4f4700;}),_0x430915[_0x146739(0x24f)]((_0x226725,_0x41491a)=>{var _0x45d8de=_0x146739;_0x582030[_0x41491a][_0x45d8de(0x23b)]=_0x226725;}),_0x3ec7da[_0x146739(0x24f)]((_0x515766,_0x358f9c)=>{var _0x111922=_0x146739;_0x582030[_0x358f9c][_0x111922(0x23d)]=_0x515766;}),_0x11632c['forEach']((_0x4840af,_0x18a5ec)=>{var _0x106242=_0x146739;_0x582030[_0x18a5ec][_0x106242(0x15e)]=_0x4840af;}),_0x4aaa5b[_0x146739(0x24f)]((_0x2a895b,_0x3edf59)=>{var _0x1b319f=_0x146739;_0x582030[_0x3edf59][_0x1b319f(0x1c7)]=_0x2a895b;}),_0x558018[_0x146739(0x24f)]((_0xaafe36,_0x482afb)=>{var _0x5cc29b=_0x146739;_0x582030[_0x482afb][_0x5cc29b(0x22f)]=_0xaafe36;}),_0x330e5b[_0x146739(0x24f)]((_0x4b8c35,_0x582964)=>{var _0xe29e0e=_0x146739;_0x582030[_0x582964][_0xe29e0e(0x18d)]=_0x4b8c35;});var _0x24bc5e=0x0;_0x582030['forEach'](_0x2d8b48=>{var _0x562ab6=_0x146739;(parseInt(_0x2d8b48[_0x562ab6(0x1a9)])<parseInt(_0x2d8b48[_0x562ab6(0x23f)])||parseInt(_0x2d8b48[_0x562ab6(0x1bf)])<parseInt(_0x2d8b48['return_qty'])&&parseInt(_0x2d8b48[_0x562ab6(0x1a9)])>parseInt(_0x2d8b48[_0x562ab6(0x23f)])||parseInt(_0x2d8b48[_0x562ab6(0x23f)])==0x0)&&_0x24bc5e++;});if(_0x24bc5e!=0x0)return _0xd3944d[_0x146739(0x1dc)]('errors',_0x146739(0x257)),_0xeb0efb[_0x146739(0x25e)](_0x146739(0x1c0));const _0x2e0f2c=await sales_finished[_0x146739(0x17a)]({'invoice':_0x53431d});_0x2e0f2c[_0x146739(0x211)]=_0x146739(0x256);const _0x411d0c=await _0x2e0f2c[_0x146739(0x25f)](),_0x707124=new sales_return_finished({'invoice':_0x53431d,'customer':_0xd3944d[_0x146739(0x251)][_0x146739(0x1a6)],'date':_0x9e3dbf,'warehouse_name':_0x358eb4,'room':_0x260086,'ToWarehouse':_0x4b03f5,'ToRoom':_0x5b00de,'return_sale':_0x582030,'note':_0x549342,'warehouse_cat':_0x4b3b59}),_0x502a94=await _0x707124[_0x146739(0x25f)](),_0x365989=await sales_return_finished[_0x146739(0x17a)]({'invoice':_0x53431d}),_0xd27274=await warehouse[_0x146739(0x17a)]({'name':_0x4b03f5,'room':_0x5b00de,'warehouse_category':_0x146739(0x239)});_0x365989['return_sale'][_0x146739(0x24f)](_0x45850c=>{var _0x5329a3=_0x146739,_0x132958=0x0;const _0x40633f=_0xd27274[_0x5329a3(0x23c)]['map'](_0xde5829=>{var _0x1e78b3=_0x5329a3;_0xde5829['product_name']==_0x45850c['product_name']&&_0xde5829[_0x1e78b3(0x20c)]==_0x45850c[_0x1e78b3(0x20c)]&&_0xde5829['expiry_date']==_0x45850c[_0x1e78b3(0x18d)]&&_0xde5829[_0x1e78b3(0x22f)]==_0x45850c[_0x1e78b3(0x22f)]&&_0xde5829['batch_code']==_0x45850c[_0x1e78b3(0x23d)]&&(_0xde5829[_0x1e78b3(0x1fe)]=parseInt(_0xde5829[_0x1e78b3(0x1fe)])+parseInt(_0x45850c['return_qty']),_0x132958++);});_0x132958=='0'&&(_0xd27274[_0x5329a3(0x23c)]=_0xd27274[_0x5329a3(0x23c)][_0x5329a3(0x16c)]({'product_name':_0x45850c[_0x5329a3(0x1f3)],'product_stock':_0x45850c[_0x5329a3(0x23f)],'primary_code':_0x45850c[_0x5329a3(0x192)],'secondary_code':_0x45850c[_0x5329a3(0x24d)],'product_code':_0x45850c['product_code'],'bay':_0x45850c[_0x5329a3(0x20c)],'batch_code':_0x45850c[_0x5329a3(0x23d)],'maxPerUnit':_0x45850c[_0x5329a3(0x1ae)],'production_date':_0x45850c['production_date'],'expiry_date':_0x45850c[_0x5329a3(0x18d)],'secondary_unit':_0x45850c[_0x5329a3(0x15e)],'unit':_0x45850c[_0x5329a3(0x1c7)],'maxProducts':_0x45850c[_0x5329a3(0x23b)]}));}),await _0xd27274[_0x146739(0x25f)](),console[_0x146739(0x1d2)](_0xd3944d[_0x146739(0x251)]);const _0x53ca44=new c_payment_data({'invoice':_0x53431d,'customer':_0xd3944d['body'][_0x146739(0x1a6)],'reason':_0x146739(0x1a5)});await _0x53ca44[_0x146739(0x25f)]();const _0xb08f99=await master_shop[_0x146739(0x1e7)]();console[_0x146739(0x1d2)](_0x146739(0x21b),_0xb08f99[0x0][_0x146739(0x248)]);const _0x449bc2=await email_settings[_0x146739(0x17a)](),_0x18e762=await customer[_0x146739(0x17a)]({'name':_0xd3944d['body'][_0x146739(0x1a6)]});console['log'](_0x146739(0x157),_0x18e762);_0xb08f99[0x0][_0x146739(0x17b)]==0x1?(right_currency=_0xb08f99[0x0][_0x146739(0x249)],left_currency=''):(right_currency='',left_currency=_0xb08f99[0x0][_0x146739(0x249)]);var _0x3d7f13=_0x112046,_0x56c0bb=_0x53692,_0x50c5f3='',_0x410216;for(_0x410216 in _0x3d7f13){_0x50c5f3+=_0x146739(0x18f)+_0x146739(0x169)+_0x3d7f13[_0x410216]+'</td>'+_0x146739(0x169)+_0x56c0bb[_0x410216]+_0x146739(0x1d9)+_0x146739(0x1e5);}console[_0x146739(0x1d2)]('product_list',_0x50c5f3);let _0x358b4a=nodemailer[_0x146739(0x205)]({'service':'gmail','auth':{'user':_0x449bc2[_0x146739(0x1ea)],'pass':_0x449bc2['password']}}),_0x2f980e={'from':_0x449bc2[_0x146739(0x1ea)],'to':_0x18e762[_0x146739(0x1ea)],'subject':_0x146739(0x1a4),'attachments':[{'filename':_0x146739(0x19f),'path':__dirname+'/../public'+_0x146739(0x1ac)+_0xb08f99[0x0][_0x146739(0x248)],'cid':_0x146739(0x182)}],'html':_0x146739(0x173)+_0x146739(0x264)+_0x146739(0x247)+_0x146739(0x190)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x146739(0x190)+_0x146739(0x17c)+'</div>'+'<div>'+_0x146739(0x187)+_0xb08f99[0x0][_0x146739(0x161)]+'\x20</h2>'+'</div>'+_0x146739(0x1b4)+_0x146739(0x24a)+_0x146739(0x190)+_0x146739(0x22c)+_0x146739(0x15c)+_0x53431d+'\x20'+_0x146739(0x20a)+'\x20Order\x20Date\x20:\x20'+_0x9e3dbf+'\x20'+_0x146739(0x1f4)+_0x146739(0x258)+_0x146739(0x1b4)+_0x146739(0x259)+_0x146739(0x180)+_0x146739(0x18f)+_0x146739(0x218)+_0x146739(0x1a1)+_0x146739(0x225)+_0x146739(0x1d1)+_0x146739(0x1e5)+_0x146739(0x1f2)+_0x146739(0x1a3)+'\x20'+_0x50c5f3+'\x20'+_0x146739(0x25b)+_0x146739(0x22a)+_0x146739(0x190)+'<strong>\x20Regards\x20</strong>'+_0x146739(0x21c)+_0xb08f99[0x0][_0x146739(0x161)]+_0x146739(0x258)+_0x146739(0x1b4)+_0x146739(0x1b4)+_0x146739(0x156)};_0x358b4a[_0x146739(0x1bb)](_0x2f980e,function(_0x4f99d2,_0x58c225){var _0x629a65=_0x146739;_0x4f99d2?(console[_0x629a65(0x1d2)](_0x4f99d2),console['log'](_0x629a65(0x1c2))):console[_0x629a65(0x1d2)](_0x629a65(0x220));}),_0xd3944d[_0x146739(0x1dc)]('success',_0x146739(0x23e)),_0xeb0efb[_0x146739(0x25e)](_0x146739(0x255));}catch(_0x3c65e5){console['log'](_0x3c65e5),_0xeb0efb['status'](0xc8)[_0x146739(0x1c4)]({'message1':_0x3c65e5[_0x146739(0x1e6)]});}}}),router[a0_0x5c8559(0x1e8)]('/barcode/:id',auth,async(_0x32e635,_0x4123d4)=>{var _0x24563b=a0_0x5c8559;try{const {username:_0x120b40,email:_0xc7dcdf,role:_0x2f51ec}=_0x32e635[_0x24563b(0x1c6)],_0x688de7=_0x32e635[_0x24563b(0x1c6)],_0x2fdf1c=await profile[_0x24563b(0x17a)]({'email':_0x688de7[_0x24563b(0x1ea)]}),_0x42ef7b=await master_shop['find']();console[_0x24563b(0x1d2)](_0x24563b(0x167),_0x42ef7b);const _0x56577b=_0x32e635[_0x24563b(0x1af)]['id'],_0x48991a=await sales[_0x24563b(0x1f8)](_0x56577b);console[_0x24563b(0x1d2)](_0x24563b(0x15f),_0x48991a);if(_0x42ef7b[0x0][_0x24563b(0x1ab)]=='English\x20(US)')var _0x1ef527=users[_0x24563b(0x1f5)];else{if(_0x42ef7b[0x0]['language']==_0x24563b(0x1d5))var _0x1ef527=users[_0x24563b(0x1d5)];else{if(_0x42ef7b[0x0][_0x24563b(0x1ab)]==_0x24563b(0x219))var _0x1ef527=users[_0x24563b(0x219)];else{if(_0x42ef7b[0x0][_0x24563b(0x1ab)]==_0x24563b(0x244))var _0x1ef527=users['Spanish'];else{if(_0x42ef7b[0x0][_0x24563b(0x1ab)]==_0x24563b(0x181))var _0x1ef527=users[_0x24563b(0x181)];else{if(_0x42ef7b[0x0][_0x24563b(0x1ab)]==_0x24563b(0x1a8))var _0x1ef527=users[_0x24563b(0x19e)];else{if(_0x42ef7b[0x0][_0x24563b(0x1ab)]==_0x24563b(0x19a))var _0x1ef527=users['Chinese'];else{if(_0x42ef7b[0x0]['language']=='Arabic\x20(ae)')var _0x1ef527=users['Arabic'];}}}}}}}_0x4123d4[_0x24563b(0x209)](_0x24563b(0x238),{'success':_0x32e635['flash']('success'),'errors':_0x32e635[_0x24563b(0x1dc)](_0x24563b(0x16b)),'role':_0x688de7,'profile':_0x2fdf1c,'alldata':_0x48991a,'master_shop':_0x42ef7b,'language':_0x1ef527});}catch(_0x1569d8){console[_0x24563b(0x1d2)](_0x1569d8);}}),router[a0_0x5c8559(0x235)](a0_0x5c8559(0x1cd),async(_0x57cbb3,_0x583ef8)=>{var _0x43c87d=a0_0x5c8559;const {product_code:_0x589257,warehouse_name:_0x500664,rooms_data:_0x3ed70e,Roomslist:_0x538bad}=_0x57cbb3[_0x43c87d(0x251)],_0x28254b=_0x538bad[_0x43c87d(0x1b8)](','),_0x411655=[];async function _0x540917(_0x21ef9b){var _0x3b86a7=_0x43c87d;const _0x3a6691=await warehouse['aggregate']([{'$match':{'name':_0x500664,'room':_0x21ef9b}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x589257}},{'$group':{'_id':_0x3b86a7(0x237),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3b86a7(0x163)},'primary_code':{'$first':_0x3b86a7(0x1a0)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3b86a7(0x1de)},'level':{'$first':_0x3b86a7(0x1cf)},'isle':{'$first':_0x3b86a7(0x162)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x3b86a7(0x177)},'unit':{'$first':_0x3b86a7(0x1eb)},'secondary_unit':{'$first':_0x3b86a7(0x261)},'storage':{'$first':_0x3b86a7(0x19b)},'rack':{'$first':_0x3b86a7(0x1e1)},'expiry_date':{'$first':_0x3b86a7(0x1be)},'production_date':{'$first':_0x3b86a7(0x221)},'maxPerUnit':{'$first':_0x3b86a7(0x246)},'batch_code':{'$first':_0x3b86a7(0x15a)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x3b86a7(0x213)},'invoice':{'$first':_0x3b86a7(0x260)}}}]),_0x11c38e=await warehouse[_0x3b86a7(0x15d)]([{'$match':{'name':_0x500664,'room':_0x21ef9b}},{'$unwind':_0x3b86a7(0x21e)},{'$match':{'product_details.secondary_code':_0x589257}},{'$group':{'_id':_0x3b86a7(0x237),'name':{'$first':_0x3b86a7(0x18b)},'product_stock':{'$first':_0x3b86a7(0x163)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3b86a7(0x1de)},'level':{'$first':_0x3b86a7(0x1cf)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x3b86a7(0x177)},'unit':{'$first':_0x3b86a7(0x1eb)},'secondary_unit':{'$first':_0x3b86a7(0x261)},'storage':{'$first':_0x3b86a7(0x19b)},'rack':{'$first':_0x3b86a7(0x1e1)},'expiry_date':{'$first':_0x3b86a7(0x1be)},'production_date':{'$first':_0x3b86a7(0x221)},'maxPerUnit':{'$first':_0x3b86a7(0x246)},'batch_code':{'$first':_0x3b86a7(0x15a)},'product_cat':{'$first':_0x3b86a7(0x1e4)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x3b86a7(0x260)}}}]);if(_0x3a6691[_0x3b86a7(0x1d8)]>0x0)_0x411655['push'](_0x3a6691);else _0x11c38e['length']>0x0&&_0x411655[_0x3b86a7(0x204)](_0x11c38e);}const _0x4d7447=_0x28254b[_0x43c87d(0x1fd)](_0x2d9746=>_0x540917(_0x2d9746));await Promise[_0x43c87d(0x155)](_0x4d7447),_0x583ef8['json'](_0x411655);}),module[a0_0x5c8559(0x245)]=router;