var a0_0x5da05f=a0_0x1e3b;function a0_0x1e3b(_0x137bdc,_0x4c5b30){var _0x450909=a0_0x4509();return a0_0x1e3b=function(_0x1e3ba2,_0x541892){_0x1e3ba2=_0x1e3ba2-0xe3;var _0x134081=_0x450909[_0x1e3ba2];return _0x134081;},a0_0x1e3b(_0x137bdc,_0x4c5b30);}(function(_0x27b40b,_0x5b3178){var _0x59596e=a0_0x1e3b,_0x290990=_0x27b40b();while(!![]){try{var _0xdc34aa=parseInt(_0x59596e(0x21a))/0x1+-parseInt(_0x59596e(0x111))/0x2*(-parseInt(_0x59596e(0x1be))/0x3)+-parseInt(_0x59596e(0x1ce))/0x4*(parseInt(_0x59596e(0x1f1))/0x5)+-parseInt(_0x59596e(0x1c3))/0x6+parseInt(_0x59596e(0x1dc))/0x7+-parseInt(_0x59596e(0x18d))/0x8*(parseInt(_0x59596e(0x101))/0x9)+parseInt(_0x59596e(0xf0))/0xa*(-parseInt(_0x59596e(0x105))/0xb);if(_0xdc34aa===_0x5b3178)break;else _0x290990['push'](_0x290990['shift']());}catch(_0x5a48f3){_0x290990['push'](_0x290990['shift']());}}}(a0_0x4509,0x925cf));const express=require('express'),app=express(),router=express[a0_0x5da05f(0x170)](),{profile,master_shop,sales_spmx,invoice_for_outgoing,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x5da05f(0x198)),auth=require(a0_0x5da05f(0xe4)),nodemailer=require(a0_0x5da05f(0x202)),users=require(a0_0x5da05f(0x1e4)),e=require(a0_0x5da05f(0xec));function a0_0x4509(){var _0x3bc4cd=['split','date_data','$product_details_spmx.spicemix_spmx_qty','save','$product_details.product_cat','Router','table\x20page','$product_details.product_stock','$sale_product.spicemix_spmx_qty','status','body','$customer','all','curing_spmx','string','/view/return_sales/:id','$sale_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','OUTF-','$product_details.maxProducts','stock_data','staff','Finished\x20Goods','currency','secondary_code_QA','return_qty_QA','site_title','Arabic\x20(ae)','$return_data','$product_details.secondary_unit','$sale_product.bay','<div>','German','adjust_qty','25456vrzInx','filter','findOne','</body></html>','Sale','toString','Ambient','length','post','Enabled','FGSEmail','../models/all_models','Arabic','$sale_product.type','role','sales_quantity_QA','Return\x20Rooms','port','customer_data','Enclosed','$product_details.unit','<tr>','brand_spmx','prod_cat','OUT-','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_invoice','out_going_id','room_name','$product_details_spmx.extenders_spmx','$product_details.rack','An\x20error\x20occurred\x20while\x20saving\x20data.','$date','sales\x20item\x20return\x20successfull','redirect','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','/preview/:id','QA\x20Warehouse','<!DOCTYPE\x20html>','expiry_date_QA','host','</tr>','getDate','$sale_product.quantity','incoming_invoice','$sale_product.extenders_spmx','spicemix_spmx','product_name','183UZwAxa','floor','English\x20(US)','$sale_product.curing_spmx','$product_details_spmx.unit_spmx','2706558aAgKZh','$product_details','language','room','$note','note','DRY\x20GOODS','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details_spmx.curing_spmx','return_qty','category_spmx','4UzjOHi','$name','/give_payment/:id','$product_details.bin','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','$finalize','Logo.png','max_per_unit','invoice','barcode\x20user_id','id_transaction_from','maxperunit','$product_details.floorlevel','slice','6804560CCxhso','Sale\x20Return\x20Mail','$sale_product.extenders_spmx_qty','log','/upload/','for_categorize','<hr\x20class=\x22my-3\x22>','product_list','../public/language/languages.json','curing_spmx_qty_stock','gmail','$sale_product.floorlevel','English','Spanish','aggregate','$product_details_spmx._id','$warehouse_name','$product','message','</h5>','product','1501710ClWzdo','$product_details.primary_code','production_date','product_code_QA','/view/add_sales_spmx','product_name_QA1','find','Outgoing\x20Successfully\x20Added\x20and\x20Finalized','curing_spmx_qty','</thead>','logo','edit_sales_finished','There\x27s\x20a\x20error\x20in\x20this\x20transaction','maxProducts_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','errors','Outgoing\x20Successfully\x20Added\x20but\x20not\x20Finalized','nodemailer','$room','suppliers','<strong>\x20Regards\x20</strong>','<span\x20style=\x22float:\x20right;\x22>','batch_code_QA','<h5>','barcode\x20Product\x20master','return_sale_QA','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details._id','stock','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','</tbody>','$product_details.room_name','/barcode_scanner_spmx','product_details','<h5\x20style=\x22text-align:\x20left;\x22>','spicemix_spmx_qty_stock','secondary_code','unit','_id','$_id','1118437aZUnyD','\x20Order\x20Date\x20:\x20','exports','/view','/view_sales_spmx/:id','customer','unit_spmx','../middleware/auth','spicemix_spmx_qty','stocks_QA','extenders_spmx','/view/add_sales/:id','quantity','expiry_date','sale_qty','connect-flash','due_amount','$product_details.expiry_date','</div>','10OsHxXd','getFullYear','product_date','Sales\x20Update\x20successfully','$product_details.bay','Quality\x20Inspection','findById','SPMX','</td>','primary_code_QA','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<html><head><title></title>','$product_details_spmx','password','Hindi','Portuguese','477EwPTUJ','map','back','email','18732681PkauSD','$product_details.product_name','maxProducts','level','currency_placement','user','success','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/all_sales/view','secondary_unit_QA','return_sale','RoomAssigned','37116UVVqDX','add\x20post','createTransport','batch_code','room_spmx','Chinese','$product_details.maxPerUnit','French','bay','Return\x20Goods','product_stock','</table>','sale_product','then','/invoice/:id','sales_quantity','/picking_list/pdf/','/process/:id','$sale_product.spicemix_spmx','product_code','prod_code','add_sales_finished_spmx','$product_details_spmx.spicemix_spmx','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<h2>\x20','out_invoice','/view/add_sale/product','extenders_spmx_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','padStart','push','$product_details.production_date','extenders_spmx_qty_stock','Email\x20sent\x20successfully','$product_details_spmx.extenders_spmx_qty','\x20Order\x20Number\x20:\x20','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.batch_code','params','date','received_amount','concat','$product_details.type','Error\x20Occurs','updateOne','maxPerUnit_QA','payment\x20successfull','sendMail','\x20<>\x20','$sale_product.bin','Portuguese\x20(BR)','$product_details_spmx.brand_spmx','primary_code','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','</span>','warehouse_name','abs','/view/add_sales','secondary_unit','$invoice','sales_invoice','primary_unit','$product_details.secondary_code','image','error','maxPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$product_details.product_code','get','production_date_QA','unit_QA','master','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','final','$product_details_spmx.category_spmx','render','<table\x20style=\x22width:\x20100%\x20!important;\x22>','amount','/all_sales_finished/view','product_details_spmx','json','flash','</head><body>','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','edit_sales_finished_view','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'];a0_0x4509=function(){return _0x3bc4cd;};return a0_0x4509();}router['get']('/view_spmx',auth,async(_0x379127,_0x27594f)=>{var _0x1b59d8=a0_0x5da05f;try{const {username:_0x4c02b4,email:_0x3cae8b,role:_0xd580b3}=_0x379127['user'],_0x520912=_0x379127[_0x1b59d8(0x10a)],_0x5bc23f=await profile['findOne']({'email':_0x520912['email']}),_0x2f8762=await staff[_0x1b59d8(0x18f)]({'email':_0x520912[_0x1b59d8(0x104)]});if(_0x520912[_0x1b59d8(0x19b)]==_0x1b59d8(0x180)){const _0x64dd51=await staff[_0x1b59d8(0x18f)]({'email':_0x520912['email']});}const _0x1ea4e7=await master_shop[_0x1b59d8(0x1f7)](),_0x98c267=await sales_spmx['aggregate']([{'$unwind':_0x1b59d8(0x17b)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1b59d8(0x14e)},'date':{'$first':_0x1b59d8(0x1ad)},'finalize':{'$first':_0x1b59d8(0x1d3)},'warehouse_name':{'$first':_0x1b59d8(0x1ec)},'room_spmx':{'$addToSet':'$sale_product.room_spmx'},'sale_product':{'$push':_0x1b59d8(0x17b)},'note':{'$first':_0x1b59d8(0x1c7)},'spicemix_spmx_qty':{'$sum':_0x1b59d8(0x173)},'extenders_spmx_qty':{'$sum':_0x1b59d8(0x1de)},'curing_spmx_qty':{'$sum':'$sale_product.curing_spmx_qty'},'spicemix_spmx':{'$addToSet':_0x1b59d8(0x123)},'extenders_spmx':{'$addToSet':_0x1b59d8(0x1bb)},'curing_spmx':{'$addToSet':_0x1b59d8(0x1c1)},'product_code':{'$addToSet':'$sale_product.product_code'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'warehouse_name':0x1,'room_spmx':0x1,'sale_product':0x1,'note':0x1,'spicemix_spmx_qty':0x1,'extenders_spmx_qty':0x1,'curing_spmx_qty':0x1,'spicemix_spmx':0x1,'extenders_spmx':0x1,'curing_spmx':0x1,'product_code':0x1,'finalize':0x1}}]);if(_0x1ea4e7[0x0][_0x1b59d8(0x1c5)]==_0x1b59d8(0x1c0))var _0x5e0d41=users['English'];else{if(_0x1ea4e7[0x0]['language']==_0x1b59d8(0xff))var _0x5e0d41=users[_0x1b59d8(0xff)];else{if(_0x1ea4e7[0x0][_0x1b59d8(0x1c5)]=='German')var _0x5e0d41=users[_0x1b59d8(0x18b)];else{if(_0x1ea4e7[0x0][_0x1b59d8(0x1c5)]==_0x1b59d8(0x1e9))var _0x5e0d41=users['Spanish'];else{if(_0x1ea4e7[0x0]['language']==_0x1b59d8(0x118))var _0x5e0d41=users[_0x1b59d8(0x118)];else{if(_0x1ea4e7[0x0]['language']==_0x1b59d8(0x145))var _0x5e0d41=users[_0x1b59d8(0x100)];else{if(_0x1ea4e7[0x0][_0x1b59d8(0x1c5)]=='Chinese')var _0x5e0d41=users[_0x1b59d8(0x116)];else{if(_0x1ea4e7[0x0][_0x1b59d8(0x1c5)]=='Arabic\x20(ae)')var _0x5e0d41=users[_0x1b59d8(0x199)];}}}}}}}_0x27594f['render']('all_sales_finished_spmx',{'success':_0x379127['flash'](_0x1b59d8(0x10b)),'errors':_0x379127[_0x1b59d8(0x164)](_0x1b59d8(0x200)),'data':_0x98c267,'role':_0x520912,'profile':_0x5bc23f,'master_shop':_0x1ea4e7,'language':_0x5e0d41});}catch(_0x3e126a){console['log'](_0x1b59d8(0x171),_0x3e126a),_0x27594f['status'](0xc8)['json']({'message':_0x3e126a[_0x1b59d8(0x1ee)]});}}),router[a0_0x5da05f(0x157)](a0_0x5da05f(0x1f5),auth,async(_0x485f42,_0x833b59)=>{var _0xf5ec2c=a0_0x5da05f;try{const {username:_0x4b4e3e,email:_0x4c583f,role:_0x2bb2a3}=_0x485f42[_0xf5ec2c(0x10a)],_0x4fabb8=_0x485f42[_0xf5ec2c(0x10a)],_0x4efc33=await profile[_0xf5ec2c(0x18f)]({'email':_0x4fabb8[_0xf5ec2c(0x104)]}),_0x27117b=await staff['findOne']({'email':_0x4fabb8[_0xf5ec2c(0x104)]});if(_0x4fabb8['role']==_0xf5ec2c(0x180)){const _0x5aaed8=await staff['findOne']({'email':_0x4fabb8[_0xf5ec2c(0x104)]});}const _0x53df23=await warehouse[_0xf5ec2c(0x1ea)]([{'$match':{'status':_0xf5ec2c(0x196),'warehouse_category':_0xf5ec2c(0xf7),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0xf5ec2c(0x1cf),'name':{'$first':_0xf5ec2c(0x1cf)}}}]),_0x54de38=await master_shop[_0xf5ec2c(0x1f7)]();if(_0x54de38[0x0][_0xf5ec2c(0x1c5)]=='English\x20(US)')var _0x89c65c=users['English'];else{if(_0x54de38[0x0][_0xf5ec2c(0x1c5)]=='Hindi')var _0x89c65c=users['Hindi'];else{if(_0x54de38[0x0][_0xf5ec2c(0x1c5)]==_0xf5ec2c(0x18b))var _0x89c65c=users[_0xf5ec2c(0x18b)];else{if(_0x54de38[0x0][_0xf5ec2c(0x1c5)]==_0xf5ec2c(0x1e9))var _0x89c65c=users[_0xf5ec2c(0x1e9)];else{if(_0x54de38[0x0][_0xf5ec2c(0x1c5)]==_0xf5ec2c(0x118))var _0x89c65c=users[_0xf5ec2c(0x118)];else{if(_0x54de38[0x0][_0xf5ec2c(0x1c5)]==_0xf5ec2c(0x145))var _0x89c65c=users[_0xf5ec2c(0x100)];else{if(_0x54de38[0x0][_0xf5ec2c(0x1c5)]==_0xf5ec2c(0x116))var _0x89c65c=users[_0xf5ec2c(0x116)];else{if(_0x54de38[0x0]['language']==_0xf5ec2c(0x186))var _0x89c65c=users[_0xf5ec2c(0x199)];}}}}}}}_0x833b59['render'](_0xf5ec2c(0x126),{'success':_0x485f42[_0xf5ec2c(0x164)]('success'),'errors':_0x485f42[_0xf5ec2c(0x164)](_0xf5ec2c(0x200)),'role':_0x4fabb8,'profile':_0x4efc33,'master_shop':_0x54de38,'warehouse':_0x53df23,'language':_0x89c65c});}catch(_0x9b5ebe){console[_0xf5ec2c(0x1df)]('table\x20page',_0x9b5ebe),_0x833b59['status'](0xc8)['json']({'message':_0x9b5ebe[_0xf5ec2c(0x1ee)]});}}),router[a0_0x5da05f(0x195)](a0_0x5da05f(0x1f5),auth,async(_0x5ee78e,_0x3c1f94)=>{var _0xf695f7=a0_0x5da05f;try{const {date:_0x2dd900,SCRN:_0x1089a2,PO_number:_0x40c228,warehouse_name:_0x73479c,to_room_name:_0x2ce8fd,prod_code:_0x5e43be,note:_0x293a23,req_by:_0x45972f,app_by:_0x4bc8d4,rec_by:_0x556779}=_0x5ee78e[_0xf695f7(0x175)];if(typeof _0x5e43be==_0xf695f7(0x179))var _0x1afe56=[_0x5ee78e['body'][_0xf695f7(0x125)]],_0x4fb7cd=[_0x5ee78e[_0xf695f7(0x175)]['spicemix_spmx']],_0x2c5f2b=[_0x5ee78e[_0xf695f7(0x175)]['spicemix_spmx_qty']],_0x104249=[_0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x215)]],_0x232dfe=[_0x5ee78e[_0xf695f7(0x175)]['extenders_spmx']],_0x1323e3=[_0x5ee78e[_0xf695f7(0x175)]['extenders_spmx_qty']],_0x43dfd9=[_0x5ee78e[_0xf695f7(0x175)]['extenders_spmx_qty_stock']],_0x18572e=[_0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x178)]],_0x4f10e7=[_0x5ee78e[_0xf695f7(0x175)]['curing_spmx_qty']],_0x3c709b=[_0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x1e5)]],_0x32b0d5=[_0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x115)]],_0x1507ca=[_0x5ee78e[_0xf695f7(0x175)]['unit_spmx']],_0x500d3f=[_0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x1a3)]],_0x32632c=[_0x5ee78e['body'][_0xf695f7(0x1cd)]],_0x298a3e=[_0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x1a8)]],_0x26f430=[_0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x1ba)]];else var _0x1afe56=[..._0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x125)]],_0x4fb7cd=[..._0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x1bc)]],_0x2c5f2b=[..._0x5ee78e[_0xf695f7(0x175)]['spicemix_spmx_qty']],_0x104249=[..._0x5ee78e['body']['spicemix_spmx_qty_stock']],_0x232dfe=[..._0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0xe7)]],_0x1323e3=[..._0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x12c)]],_0x43dfd9=[..._0x5ee78e['body'][_0xf695f7(0x131)]],_0x18572e=[..._0x5ee78e['body'][_0xf695f7(0x178)]],_0x4f10e7=[..._0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x1f9)]],_0x3c709b=[..._0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x1e5)]],_0x32b0d5=[..._0x5ee78e['body']['room_spmx']],_0x1507ca=[..._0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0xe3)]],_0x500d3f=[..._0x5ee78e['body'][_0xf695f7(0x1a3)]],_0x32632c=[..._0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x1cd)]],_0x298a3e=[..._0x5ee78e[_0xf695f7(0x175)][_0xf695f7(0x1a8)]],_0x26f430=[..._0x5ee78e[_0xf695f7(0x175)]['incoming_invoice']];const _0x4cbc6c=_0x1afe56['map'](_0x29f25b=>{return _0x29f25b={'product_code':_0x29f25b};});_0x4fb7cd[_0xf695f7(0x166)]((_0xe027bc,_0x25a9dd)=>{var _0x5a40e2=_0xf695f7;_0x4cbc6c[_0x25a9dd][_0x5a40e2(0x1bc)]=_0xe027bc;}),_0x2c5f2b['forEach']((_0x1b88c4,_0x5b921d)=>{var _0x5af0c4=_0xf695f7;_0x4cbc6c[_0x5b921d][_0x5af0c4(0xe5)]=_0x1b88c4;}),_0x104249[_0xf695f7(0x166)]((_0x9dfdb0,_0x3e9be7)=>{var _0x57a9b9=_0xf695f7;_0x4cbc6c[_0x3e9be7][_0x57a9b9(0x215)]=_0x9dfdb0;}),_0x232dfe[_0xf695f7(0x166)]((_0x3044ba,_0x4d4f38)=>{_0x4cbc6c[_0x4d4f38]['extenders_spmx']=_0x3044ba;}),_0x1323e3[_0xf695f7(0x166)]((_0x395866,_0x14040d)=>{var _0x1582b2=_0xf695f7;_0x4cbc6c[_0x14040d][_0x1582b2(0x12c)]=_0x395866;}),_0x43dfd9[_0xf695f7(0x166)]((_0x4616b0,_0x4d3d79)=>{var _0x3cff82=_0xf695f7;_0x4cbc6c[_0x4d3d79][_0x3cff82(0x131)]=_0x4616b0;}),_0x18572e['forEach']((_0x50de08,_0x46a6d0)=>{var _0x21e0c5=_0xf695f7;_0x4cbc6c[_0x46a6d0][_0x21e0c5(0x178)]=_0x50de08;}),_0x4f10e7[_0xf695f7(0x166)]((_0x4743d6,_0x3978a6)=>{_0x4cbc6c[_0x3978a6]['curing_spmx_qty']=_0x4743d6;}),_0x3c709b[_0xf695f7(0x166)]((_0xc2a998,_0x544016)=>{var _0x1c00c9=_0xf695f7;_0x4cbc6c[_0x544016][_0x1c00c9(0x1e5)]=_0xc2a998;}),_0x32b0d5[_0xf695f7(0x166)]((_0x313ce7,_0x58c248)=>{var _0x3afb58=_0xf695f7;_0x4cbc6c[_0x58c248][_0x3afb58(0x115)]=_0x313ce7;}),_0x1507ca[_0xf695f7(0x166)]((_0x5dc0c6,_0x154dfc)=>{var _0x56752f=_0xf695f7;_0x4cbc6c[_0x154dfc][_0x56752f(0xe3)]=_0x5dc0c6;}),_0x500d3f[_0xf695f7(0x166)]((_0x224cbc,_0x8343c1)=>{var _0x1371ff=_0xf695f7;_0x4cbc6c[_0x8343c1][_0x1371ff(0x1a3)]=_0x224cbc;}),_0x32632c['forEach']((_0xe4a1eb,_0x283786)=>{var _0x57bd3f=_0xf695f7;_0x4cbc6c[_0x283786][_0x57bd3f(0x1cd)]=_0xe4a1eb;}),_0x298a3e[_0xf695f7(0x166)]((_0x37828e,_0x5d68b0)=>{var _0x16f799=_0xf695f7;_0x4cbc6c[_0x5d68b0][_0x16f799(0x1d8)]=_0x37828e;}),_0x26f430[_0xf695f7(0x166)]((_0x322a67,_0x56f5c5)=>{var _0x45e453=_0xf695f7;_0x4cbc6c[_0x56f5c5][_0x45e453(0x1ba)]=_0x322a67;});const _0xbf3400=new invoice_for_outgoing();await _0xbf3400[_0xf695f7(0x16e)]();const _0x5ecb79=new sales_spmx({'invoice':_0xf695f7(0x1a5)+_0xbf3400['invoice_init'][_0xf695f7(0x192)]()[_0xf695f7(0x12e)](0x8,'0'),'date':_0x2dd900,'warehouse_name':_0x73479c,'sale_product':_0x4cbc6c,'note':_0x293a23,'POnumber':_0x40c228,'SCRN':_0x1089a2,'req_by':_0x45972f,'appr_by':_0x4bc8d4,'rec_by':_0x556779}),_0x4c03bd=await _0x5ecb79[_0xf695f7(0x16e)]();_0x5ee78e[_0xf695f7(0x164)](_0xf695f7(0x10b),_0xf695f7(0x201)),_0x3c1f94[_0xf695f7(0x1af)]('/all_sales_finished/view_sales_spmx/'+_0x4c03bd[_0xf695f7(0x218)]);}catch(_0x3b61fa){console['log'](_0xf695f7(0x171),_0x3b61fa),_0x3c1f94[_0xf695f7(0x174)](0xc8)[_0xf695f7(0x163)]({'message':_0x3b61fa[_0xf695f7(0x1ee)]});}}),router[a0_0x5da05f(0x157)](a0_0x5da05f(0x21e),auth,async(_0x21e0ab,_0x5822ea)=>{var _0x5857ee=a0_0x5da05f;try{const _0x526476=_0x21e0ab['params']['id'],_0x39a223=await sales_spmx[_0x5857ee(0xf6)](_0x526476),_0x196863=await master_shop['find'](),_0x50341b=_0x21e0ab[_0x5857ee(0x10a)],_0x49fa03=await profile[_0x5857ee(0x18f)]({'email':_0x50341b[_0x5857ee(0x104)]}),_0x14ea53=await staff[_0x5857ee(0x18f)]({'email':_0x50341b['email']});if(_0x196863[0x0]['language']==_0x5857ee(0x1c0))var _0x38df34=users[_0x5857ee(0x1e8)];else{if(_0x196863[0x0][_0x5857ee(0x1c5)]==_0x5857ee(0xff))var _0x38df34=users[_0x5857ee(0xff)];else{if(_0x196863[0x0][_0x5857ee(0x1c5)]==_0x5857ee(0x18b))var _0x38df34=users[_0x5857ee(0x18b)];else{if(_0x196863[0x0][_0x5857ee(0x1c5)]==_0x5857ee(0x1e9))var _0x38df34=users[_0x5857ee(0x1e9)];else{if(_0x196863[0x0][_0x5857ee(0x1c5)]==_0x5857ee(0x118))var _0x38df34=users[_0x5857ee(0x118)];else{if(_0x196863[0x0]['language']==_0x5857ee(0x145))var _0x38df34=users[_0x5857ee(0x100)];else{if(_0x196863[0x0][_0x5857ee(0x1c5)]==_0x5857ee(0x116))var _0x38df34=users[_0x5857ee(0x116)];else{if(_0x196863[0x0][_0x5857ee(0x1c5)]==_0x5857ee(0x186))var _0x38df34=users[_0x5857ee(0x199)];}}}}}}}_0x5822ea[_0x5857ee(0x15e)]('view_sales_finished_spmx',{'success':_0x21e0ab[_0x5857ee(0x164)](_0x5857ee(0x10b)),'errors':_0x21e0ab[_0x5857ee(0x164)]('errors'),'role':_0x50341b,'profile':_0x49fa03,'master_shop':_0x196863,'language':_0x38df34,'data':_0x39a223});}catch(_0x4696bb){;_0x5822ea['status'](0xc8)[_0x5857ee(0x163)]({'message':_0x4696bb['message']});}}),router['post'](a0_0x5da05f(0x122),auth,async(_0x5d7548,_0x5449e1)=>{var _0x25b285=a0_0x5da05f;try{const _0xc2cad5=_0x5d7548[_0x25b285(0x139)]['id'],_0x40a7d9=await sales_spmx[_0x25b285(0xf6)](_0xc2cad5);_0x40a7d9[_0x25b285(0x11d)][_0x25b285(0x166)](async _0x1ef6c1=>{var _0x58ef67=_0x25b285;const _0x4353c7=await warehouse[_0x58ef67(0x18f)]({'name':_0x40a7d9[_0x58ef67(0x14a)],'room':_0x1ef6c1[_0x58ef67(0x115)],'warehouse_category':_0x58ef67(0xf7),'product_details_spmx._id':_0x1ef6c1[_0x58ef67(0x1d8)]});if(_0x4353c7){const _0x1638d1=_0x4353c7[_0x58ef67(0x162)][_0x58ef67(0x1f7)](_0x3e44af=>_0x3e44af[_0x58ef67(0x218)][_0x58ef67(0x192)]()===_0x1ef6c1[_0x58ef67(0x1d8)]);_0x1638d1[_0x58ef67(0xe5)]=_0x1638d1[_0x58ef67(0xe5)]-_0x1ef6c1[_0x58ef67(0xe5)],_0x1638d1[_0x58ef67(0x12c)]=_0x1638d1[_0x58ef67(0x12c)]-_0x1ef6c1[_0x58ef67(0x12c)],_0x1638d1[_0x58ef67(0x1f9)]=_0x1638d1[_0x58ef67(0x1f9)]-_0x1ef6c1['curing_spmx_qty'],await warehouse[_0x58ef67(0x13f)]({'name':_0x40a7d9[_0x58ef67(0x14a)],'room':_0x1ef6c1[_0x58ef67(0x115)],'warehouse_category':_0x58ef67(0xf7),'product_details_spmx._id':_0x1ef6c1[_0x58ef67(0x1d8)]},{'$set':{'product_details_spmx.$.spicemix_spmx_qty':_0x1638d1[_0x58ef67(0xe5)],'product_details_spmx.$.extenders_spmx_qty':_0x1638d1[_0x58ef67(0x12c)],'product_details_spmx.$.curing_spmx_qty':_0x1638d1[_0x58ef67(0x1f9)]}});}}),_0x40a7d9['finalize']=_0x25b285(0x135),_0x40a7d9[_0x25b285(0x16e)](),_0x5d7548[_0x25b285(0x164)]('success',_0x25b285(0x1f8)),_0x5449e1[_0x25b285(0x1af)]('/all_sales_finished/view_sales_spmx/'+_0x40a7d9[_0x25b285(0x218)]);return;}catch(_0x36d379){_0x5449e1[_0x25b285(0x163)]({'message':_0x36d379[_0x25b285(0x1ee)]});}}),router['get'](a0_0x5da05f(0x21d),auth,async(_0x8ae929,_0x38c7de)=>{var _0x440dd9=a0_0x5da05f;try{const {username:_0x4d6f2c,email:_0x4817bf,role:_0x442a67}=_0x8ae929[_0x440dd9(0x10a)],_0x3882ae=_0x8ae929[_0x440dd9(0x10a)],_0x58e686=await profile[_0x440dd9(0x18f)]({'email':_0x3882ae[_0x440dd9(0x104)]}),_0x255268=await master_shop[_0x440dd9(0x1f7)]();let _0x2f4d83;if(_0x3882ae[_0x440dd9(0x19b)]==_0x440dd9(0x180)){const _0x9623fa=await staff[_0x440dd9(0x18f)]({'email':_0x3882ae['email']});_0x2f4d83=await sales_finished['aggregate']([{'$unwind':_0x440dd9(0x17b)},{'$group':{'_id':'$_id','invoice':{'$first':_0x440dd9(0x14e)},'customers':{'$first':_0x440dd9(0x176)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'note':{'$first':_0x440dd9(0x1c7)},'return_data':{'$first':_0x440dd9(0x187)},'total_saleproduct_quantity':{'$sum':_0x440dd9(0x1b9)},'level':{'$addToSet':_0x440dd9(0x189)},'isle':{'$addToSet':_0x440dd9(0x144)},'type':{'$addToSet':_0x440dd9(0x19a)},'pallet':{'$addToSet':_0x440dd9(0x1e7)},'finalize':{'$first':_0x440dd9(0x1d3)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'note':0x1,'return_data':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x2f4d83=await sales_finished[_0x440dd9(0x1ea)]([{'$unwind':_0x440dd9(0x17b)},{'$group':{'_id':_0x440dd9(0x219),'invoice':{'$first':_0x440dd9(0x14e)},'customers':{'$first':_0x440dd9(0x176)},'date':{'$first':_0x440dd9(0x1ad)},'warehouse_name':{'$first':_0x440dd9(0x1ec)},'note':{'$first':'$note'},'return_data':{'$first':_0x440dd9(0x187)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x440dd9(0x189)},'isle':{'$addToSet':_0x440dd9(0x144)},'type':{'$addToSet':_0x440dd9(0x19a)},'pallet':{'$addToSet':_0x440dd9(0x1e7)},'finalize':{'$first':_0x440dd9(0x1d3)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'note':0x1,'return_data':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x255268[0x0]['language']==_0x440dd9(0x1c0)){var _0x4d1d82=users[_0x440dd9(0x1e8)];console[_0x440dd9(0x1df)](_0x4d1d82);}else{if(_0x255268[0x0][_0x440dd9(0x1c5)]==_0x440dd9(0xff))var _0x4d1d82=users[_0x440dd9(0xff)];else{if(_0x255268[0x0][_0x440dd9(0x1c5)]=='German')var _0x4d1d82=users['German'];else{if(_0x255268[0x0][_0x440dd9(0x1c5)]=='Spanish')var _0x4d1d82=users[_0x440dd9(0x1e9)];else{if(_0x255268[0x0][_0x440dd9(0x1c5)]==_0x440dd9(0x118))var _0x4d1d82=users[_0x440dd9(0x118)];else{if(_0x255268[0x0]['language']==_0x440dd9(0x145))var _0x4d1d82=users[_0x440dd9(0x100)];else{if(_0x255268[0x0][_0x440dd9(0x1c5)]==_0x440dd9(0x116))var _0x4d1d82=users[_0x440dd9(0x116)];else{if(_0x255268[0x0][_0x440dd9(0x1c5)]==_0x440dd9(0x186))var _0x4d1d82=users[_0x440dd9(0x199)];}}}}}}}_0x38c7de[_0x440dd9(0x15e)]('all_sales_finished',{'success':_0x8ae929[_0x440dd9(0x164)](_0x440dd9(0x10b)),'errors':_0x8ae929['flash'](_0x440dd9(0x200)),'sales':_0x2f4d83,'profile':_0x58e686,'role':_0x3882ae,'master_shop':_0x255268,'language':_0x4d1d82});}catch(_0x5e0a41){console[_0x440dd9(0x1df)](_0x5e0a41);}});async function getRandom8DigitNumber(){var _0x3f4f74=a0_0x5da05f;const _0x3b1d00=0x989680,_0x24ee8d=0x5f5e0ff,_0x5b5402=Math[_0x3f4f74(0x1bf)](Math['random']()*(_0x24ee8d-_0x3b1d00+0x1))+_0x3b1d00;var _0x40b56b;const _0x38909b=await sales_finished[_0x3f4f74(0x18f)]({'invoice':'OUTF-'+_0x5b5402});return _0x38909b&&_0x38909b[_0x3f4f74(0x194)]>0x0?_0x40b56b=_0x3f4f74(0x17d)+_0x5b5402:_0x40b56b=_0x3f4f74(0x17d)+_0x5b5402,_0x40b56b;}router[a0_0x5da05f(0x157)]('/view/add_sales',auth,async(_0x49903a,_0x2efd14)=>{var _0x4ea6e9=a0_0x5da05f;try{const {username:_0x5deed7,email:_0x215ef7,role:_0x53b748}=_0x49903a[_0x4ea6e9(0x10a)],_0x3b4069=_0x49903a[_0x4ea6e9(0x10a)],_0x3cef13=await profile[_0x4ea6e9(0x18f)]({'email':_0x3b4069[_0x4ea6e9(0x104)]}),_0x42738f=await master_shop[_0x4ea6e9(0x1f7)](),_0x5482c7=await customer[_0x4ea6e9(0x1f7)]({});let _0x5e8319;if(_0x3b4069['role']==_0x4ea6e9(0x180)){const _0x11e7cb=await staff['findOne']({'email':_0x3b4069[_0x4ea6e9(0x104)]});_0x5e8319=await warehouse[_0x4ea6e9(0x1ea)]([{'$match':{'status':_0x4ea6e9(0x196),'name':_0x11e7cb['warehouse'],'warehouse_category':_0x4ea6e9(0x181),'name':{'$ne':_0x4ea6e9(0x1b3)}}},{'$group':{'_id':'$name','name':{'$first':_0x4ea6e9(0x1cf)}}},{'$sort':{'name':0x1}}]);}else _0x5e8319=await warehouse[_0x4ea6e9(0x1ea)]([{'$match':{'status':_0x4ea6e9(0x196),'warehouse_category':_0x4ea6e9(0x181),'name':{'$ne':_0x4ea6e9(0x1b3)}}},{'$group':{'_id':_0x4ea6e9(0x1cf),'name':{'$first':_0x4ea6e9(0x1cf)}}},{'$sort':{'name':0x1}}]);const _0x5f4943=await product[_0x4ea6e9(0x1f7)]({});var _0x522be0=[_0x4ea6e9(0x193),'Enclosed'];const _0x1bb30d=await sales_finished[_0x4ea6e9(0x1f7)]({}),_0x28b8f4=_0x1bb30d[_0x4ea6e9(0x194)]+0x1,_0x25236d=_0x4ea6e9(0x17d)+_0x28b8f4[_0x4ea6e9(0x192)]()[_0x4ea6e9(0x12e)](0x5,'0');if(_0x42738f[0x0][_0x4ea6e9(0x1c5)]=='English\x20(US)'){var _0xc163ba=users[_0x4ea6e9(0x1e8)];console[_0x4ea6e9(0x1df)](_0xc163ba);}else{if(_0x42738f[0x0][_0x4ea6e9(0x1c5)]==_0x4ea6e9(0xff))var _0xc163ba=users[_0x4ea6e9(0xff)];else{if(_0x42738f[0x0]['language']==_0x4ea6e9(0x18b))var _0xc163ba=users[_0x4ea6e9(0x18b)];else{if(_0x42738f[0x0][_0x4ea6e9(0x1c5)]=='Spanish')var _0xc163ba=users[_0x4ea6e9(0x1e9)];else{if(_0x42738f[0x0][_0x4ea6e9(0x1c5)]==_0x4ea6e9(0x118))var _0xc163ba=users['French'];else{if(_0x42738f[0x0][_0x4ea6e9(0x1c5)]=='Portuguese\x20(BR)')var _0xc163ba=users[_0x4ea6e9(0x100)];else{if(_0x42738f[0x0]['language']=='Chinese')var _0xc163ba=users[_0x4ea6e9(0x116)];else{if(_0x42738f[0x0]['language']==_0x4ea6e9(0x186))var _0xc163ba=users['Arabic'];}}}}}}}const _0x15a49d=getRandom8DigitNumber();_0x15a49d[_0x4ea6e9(0x11e)](_0x4f3240=>{var _0x1c5425=_0x4ea6e9;_0x2efd14[_0x1c5425(0x15e)]('add_sales_finished',{'success':_0x49903a[_0x1c5425(0x164)](_0x1c5425(0x10b)),'errors':_0x49903a[_0x1c5425(0x164)](_0x1c5425(0x200)),'role':_0x3b4069,'profile':_0x3cef13,'customer':_0x5482c7,'warehouse':_0x5e8319,'product':_0x5f4943,'invoice':_0x4f3240,'master_shop':_0x42738f,'language':_0xc163ba,'rooms_data':_0x522be0});})['catch'](_0x50b41f=>{var _0x49d21c=_0x4ea6e9;_0x49903a[_0x49d21c(0x164)](_0x49d21c(0x200),_0x49d21c(0x1fd)),_0x2efd14[_0x49d21c(0x1af)](_0x49d21c(0x161));});}catch(_0x538a99){console[_0x4ea6e9(0x1df)](_0x538a99);}}),router[a0_0x5da05f(0x157)](a0_0x5da05f(0xe8),auth,async(_0x44ade2,_0x334039)=>{var _0x5b05ee=a0_0x5da05f;try{const _0x1b5e6a=_0x44ade2[_0x5b05ee(0x139)]['id'];console[_0x5b05ee(0x1df)](_0x1b5e6a);const _0x443542=await product[_0x5b05ee(0x1f7)](),_0x5099f0=await purchases[_0x5b05ee(0x1ea)]([{'$match':{'warehouse_name':_0x1b5e6a}},{'$unwind':_0x5b05ee(0x1ed)},{'$group':{'_id':'$product.product_name'}}]);console['log']('purchases_data',_0x5099f0),_0x334039[_0x5b05ee(0x174)](0xc8)[_0x5b05ee(0x163)]({'purchases_data':_0x5099f0,'product_data':_0x443542});}catch(_0x4c0c59){console[_0x5b05ee(0x1df)](_0x4c0c59);}}),router[a0_0x5da05f(0x195)](a0_0x5da05f(0x12b),auth,async(_0x2bcef7,_0x239e75)=>{var _0x4a21f1=a0_0x5da05f;try{const {warehouse_data:_0x8b366e,product_data:_0xe0c84e}=_0x2bcef7[_0x4a21f1(0x175)];console[_0x4a21f1(0x1df)](_0x2bcef7['body']['product_data']);;const _0x51aaf0=await master_shop['find']();console[_0x4a21f1(0x1df)](_0x4a21f1(0x15a),_0x51aaf0);const _0x3d6cf6=await product[_0x4a21f1(0x18f)]({'name':_0xe0c84e});console[_0x4a21f1(0x1df)](_0x4a21f1(0x1f0),_0x3d6cf6);const _0x7bc6e8=await warehouse['aggregate']([{'$match':{'name':_0x8b366e}},{'$unwind':_0x4a21f1(0x1c4)},{'$match':{'product_details.product_name':_0xe0c84e}},{'$group':{'_id':_0x4a21f1(0x106),'product_stock':{'$first':_0x4a21f1(0x172)}}}]);console['log'](_0x4a21f1(0x17f),_0x7bc6e8),_0x239e75[_0x4a21f1(0x174)](0xc8)[_0x4a21f1(0x163)]({'master':_0x51aaf0,'new_product':_0x3d6cf6,'stock_data':_0x7bc6e8});}catch(_0x192911){console[_0x4a21f1(0x1df)](_0x192911);}}),router[a0_0x5da05f(0x195)](a0_0x5da05f(0x14c),auth,async(_0x57a517,_0x4fada1)=>{var _0x29906b=a0_0x5da05f;try{const {invoice:_0x368a85,date:_0x1639df,warehouse_name:_0x1f9af0,product_name:_0x17b754,stock:_0x114cb9,quantity:_0x91981f,note:_0x5efb6b,room:_0x7b2400,primary_code:_0xddcd24,secondary_code:_0x302686,prod_code:_0xc3a052,level:_0x2149e7,isle:_0x2c7930,pallet:_0x2525e9,batch_code:_0x570c01,SCRN:_0x1123fe,expiry_date:_0x24cd77,mode_transpo:_0x14fb97,name_driver:_0x291bb7}=_0x57a517[_0x29906b(0x175)];if(typeof _0x17b754==_0x29906b(0x179))var _0x512287=[_0x57a517[_0x29906b(0x175)][_0x29906b(0x1bd)]],_0x5940a1=[_0x57a517[_0x29906b(0x175)][_0x29906b(0x20e)]],_0x11524b=[_0x57a517[_0x29906b(0x175)]['carton']],_0x16d926=[_0x57a517[_0x29906b(0x175)][_0x29906b(0x147)]],_0x57a144=[_0x57a517[_0x29906b(0x175)][_0x29906b(0x216)]],_0x8273a=[_0x57a517[_0x29906b(0x175)]['prod_code']],_0x49c784=[_0x57a517['body'][_0x29906b(0x108)]],_0x1a2354=[_0x57a517['body'][_0x29906b(0x150)]],_0xe83ea7=[_0x57a517[_0x29906b(0x175)][_0x29906b(0x14d)]],_0x2f41a6=[_0x57a517['body'][_0x29906b(0x114)]],_0x57ff56=[_0x57a517['body'][_0x29906b(0xea)]],_0x5eec8a=[_0x57a517['body'][_0x29906b(0xf2)]],_0xb541e9=[_0x57a517[_0x29906b(0x175)][_0x29906b(0x1d5)]],_0xbd2845=[_0x57a517[_0x29906b(0x175)][_0x29906b(0x1a4)]],_0x2a480c=[_0x57a517['body'][_0x29906b(0x110)]],_0x1e9b76=[_0x57a517[_0x29906b(0x175)]['prod_invoice']],_0xc70af6=[_0x57a517['body']['id_transaction_from']];else var _0x512287=[..._0x57a517[_0x29906b(0x175)]['product_name']],_0x5940a1=[..._0x57a517[_0x29906b(0x175)][_0x29906b(0x20e)]],_0x11524b=[..._0x57a517[_0x29906b(0x175)]['carton']],_0x16d926=[..._0x57a517['body']['primary_code']],_0x57a144=[..._0x57a517['body']['secondary_code']],_0x8273a=[..._0x57a517[_0x29906b(0x175)]['prod_code']],_0x49c784=[..._0x57a517[_0x29906b(0x175)][_0x29906b(0x108)]],_0x1a2354=[..._0x57a517[_0x29906b(0x175)]['primary_unit']],_0xe83ea7=[..._0x57a517[_0x29906b(0x175)][_0x29906b(0x14d)]],_0x2f41a6=[..._0x57a517['body'][_0x29906b(0x114)]],_0x57ff56=[..._0x57a517[_0x29906b(0x175)][_0x29906b(0xea)]],_0x5eec8a=[..._0x57a517['body'][_0x29906b(0xf2)]],_0xb541e9=[..._0x57a517[_0x29906b(0x175)][_0x29906b(0x1d5)]],_0xbd2845=[..._0x57a517[_0x29906b(0x175)][_0x29906b(0x1a4)]],_0x2a480c=[..._0x57a517[_0x29906b(0x175)][_0x29906b(0x110)]],_0x1e9b76=[..._0x57a517['body'][_0x29906b(0x1a7)]],_0xc70af6=[..._0x57a517[_0x29906b(0x175)]['id_transaction_from']];const _0x478677=_0x512287[_0x29906b(0x102)](_0xd39c7=>{return _0xd39c7={'product_name':_0xd39c7};});_0x5940a1[_0x29906b(0x166)]((_0x5e958d,_0x260d4b)=>{var _0x3d017d=_0x29906b;_0x478677[_0x260d4b][_0x3d017d(0x20e)]=_0x5e958d;}),_0x11524b[_0x29906b(0x166)]((_0x3087a2,_0x4adf49)=>{var _0x32b1cf=_0x29906b;_0x478677[_0x4adf49][_0x32b1cf(0xe9)]=Math['abs'](_0x3087a2);}),_0xc70af6['forEach']((_0x12385d,_0x14b820)=>{var _0x1ffb8a=_0x29906b;_0x478677[_0x14b820][_0x1ffb8a(0x1d8)]=_0x12385d;}),_0x16d926[_0x29906b(0x166)]((_0x5ea1ad,_0xc854c9)=>{var _0x4f342b=_0x29906b;_0x478677[_0xc854c9][_0x4f342b(0x147)]=_0x5ea1ad;}),_0x57a144[_0x29906b(0x166)]((_0x349cba,_0x3dce5a)=>{var _0x4225dc=_0x29906b;_0x478677[_0x3dce5a][_0x4225dc(0x216)]=_0x349cba;}),_0x8273a[_0x29906b(0x166)]((_0x2638be,_0x5edf1c)=>{var _0x52057c=_0x29906b;_0x478677[_0x5edf1c]['product_code']=_0x2638be,_0x478677[_0x5edf1c][_0x52057c(0x16c)]=_0x1639df;}),_0x49c784[_0x29906b(0x166)]((_0x2ffa78,_0xd7c62d)=>{var _0x4dd7dc=_0x29906b;_0x478677[_0xd7c62d][_0x4dd7dc(0x119)]=_0x2ffa78;}),_0x1a2354[_0x29906b(0x166)]((_0x1d6729,_0x3c89f9)=>{var _0x5014e2=_0x29906b;_0x478677[_0x3c89f9][_0x5014e2(0x217)]=_0x1d6729;}),_0xe83ea7[_0x29906b(0x166)]((_0x11c77e,_0x374130)=>{_0x478677[_0x374130]['secondary_unit']=_0x11c77e;}),_0x2f41a6['forEach']((_0x19f597,_0x2cebf9)=>{var _0x5259a4=_0x29906b;_0x478677[_0x2cebf9][_0x5259a4(0x114)]=_0x19f597;}),_0x57ff56[_0x29906b(0x166)]((_0x435f8a,_0xe20314)=>{var _0x45d9c7=_0x29906b;_0x478677[_0xe20314][_0x45d9c7(0xea)]=_0x435f8a;}),_0x5eec8a['forEach']((_0x5d8537,_0x493efc)=>{var _0x822ea9=_0x29906b;_0x478677[_0x493efc][_0x822ea9(0x1f3)]=_0x5d8537;}),_0xb541e9['forEach']((_0x90897a,_0x5175f9)=>{var _0x5a5213=_0x29906b;_0x478677[_0x5175f9][_0x5a5213(0x1d9)]=_0x90897a;}),_0xbd2845[_0x29906b(0x166)]((_0x10342c,_0x160f22)=>{_0x478677[_0x160f22]['prod_cat']=_0x10342c;}),_0x2a480c[_0x29906b(0x166)]((_0x34f3f9,_0x2310ec)=>{_0x478677[_0x2310ec]['room_name']=_0x34f3f9;}),_0x1e9b76['forEach']((_0x338d34,_0x124ab1)=>{var _0x39fe18=_0x29906b;_0x478677[_0x124ab1][_0x39fe18(0x1d6)]=_0x338d34;});var _0x40e66f=0x0;_0x478677[_0x29906b(0x166)](_0x2ad011=>{var _0x31bae9=_0x29906b;parseFloat(_0x2ad011['stock'])<parseFloat(_0x2ad011[_0x31bae9(0xe9)])&&parseFloat(_0x2ad011[_0x31bae9(0xe9)])>parseFloat(_0x2ad011[_0x31bae9(0x20e)])&&(console[_0x31bae9(0x1df)](_0x2ad011['stock']+_0x31bae9(0x143)+_0x2ad011[_0x31bae9(0xe9)]),_0x40e66f++);});if(_0x40e66f!=0x0)return _0x57a517[_0x29906b(0x164)]('errors',_0x29906b(0x1d2)),_0x4fada1[_0x29906b(0x1af)]('back');const _0x31bedd=_0x478677[_0x29906b(0x18e)](_0xcd1b87=>_0xcd1b87[_0x29906b(0xe9)]!=='0'&&_0xcd1b87['quantity']!==''),_0x3d0cce=new sales_finished({'invoice':_0x368a85,'customer':_0x57a517[_0x29906b(0x175)]['customer'],'date':_0x1639df,'warehouse_name':_0x1f9af0,'sale_product':_0x31bedd,'note':_0x5efb6b,'room':_0x7b2400,'primary_code':_0xddcd24,'secondary_code':_0x302686,'prod_code':_0xc3a052,'SCRN':_0x1123fe,'finalize':'False','mode_transpo':_0x14fb97,'name_driver':_0x291bb7}),_0x4046be=await _0x3d0cce[_0x29906b(0x16e)](),_0x283650=await sales_finished['findOne']({'invoice':_0x368a85}),_0x21357c=new c_payment_data({'invoice':_0x368a85,'customer':_0x57a517[_0x29906b(0x175)][_0x29906b(0x21f)],'reason':_0x29906b(0x191)});await _0x21357c[_0x29906b(0x16e)]();const _0x46af29=await master_shop['find'](),_0x335a3b=await email_settings[_0x29906b(0x18f)](),_0x57b06b=await customer[_0x29906b(0x18f)]({'name':_0x57a517[_0x29906b(0x175)]['customer']});_0x46af29[0x0]['currency_placement']==0x1?(right_currency=_0x46af29[0x0][_0x29906b(0x182)],left_currency=''):(right_currency='',left_currency=_0x46af29[0x0][_0x29906b(0x182)]);var _0x3139f5=_0x512287,_0x134f0f=_0x11524b,_0x340c05='',_0x19bb14;for(_0x19bb14 in _0x3139f5){_0x340c05+=_0x29906b(0x1a2)+_0x29906b(0x137)+_0x3139f5[_0x19bb14]+_0x29906b(0xf8)+_0x29906b(0x137)+_0x134f0f[_0x19bb14]+_0x29906b(0xf8)+_0x29906b(0x1b7);}console[_0x29906b(0x1df)]('product_list',_0x340c05),_0x57a517[_0x29906b(0x164)]('success','Sales\x20Add\x20successfully'),_0x4fada1['redirect']('/all_sales_finished/preview/'+_0x4046be[_0x29906b(0x218)]);}catch(_0x5b935a){console['log'](_0x5b935a);}}),router[a0_0x5da05f(0x157)](a0_0x5da05f(0x1b2),auth,async(_0x1e066b,_0x297db9)=>{var _0x38927a=a0_0x5da05f;try{const {username:_0x391859,email:_0x26a69c,role:_0x2b01a6}=_0x1e066b[_0x38927a(0x10a)],_0x5d7f6b=_0x1e066b[_0x38927a(0x10a)],_0x2aa64c=await profile['findOne']({'email':_0x5d7f6b['email']}),_0x400fde=await master_shop['find'](),_0x2eeb8b=_0x1e066b[_0x38927a(0x139)]['id'],_0x5051ba=await sales_finished[_0x38927a(0xf6)](_0x2eeb8b),_0x8b0090=await warehouse[_0x38927a(0x1ea)]([{'$match':{'name':_0x5051ba[_0x38927a(0x14a)]}},{'$unwind':_0x38927a(0x1c4)},{'$group':{'_id':_0x38927a(0x20d),'name':{'$first':_0x38927a(0x106)},'product_stock':{'$first':_0x38927a(0x172)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x38927a(0x1d1)},'type':{'$first':_0x38927a(0x13d)},'floorlevel':{'$first':_0x38927a(0x1da)},'primary_code':{'$first':_0x38927a(0x1f2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x38927a(0x156)},'storage':{'$first':_0x38927a(0x20b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x38927a(0xee)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x38927a(0x138)},'room':{'$first':_0x38927a(0x203)},'room_data':{'$first':_0x38927a(0x211)}}}]),_0x3d7e48=await customer['find']({});let _0x1cfdb3;if(_0x5d7f6b[_0x38927a(0x19b)]==_0x38927a(0x180)){const _0xf5660=await staff[_0x38927a(0x18f)]({'email':_0x5d7f6b['email']});_0x1cfdb3=await warehouse[_0x38927a(0x1ea)]([{'$match':{'status':_0x38927a(0x196),'name':_0xf5660['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x38927a(0x1cf)}}}]);}else _0x1cfdb3=await warehouse[_0x38927a(0x1ea)]([{'$match':{'status':_0x38927a(0x196)}},{'$group':{'_id':_0x38927a(0x1cf),'name':{'$first':_0x38927a(0x1cf)}}}]);const _0x1496ea=await product[_0x38927a(0x1f7)]({});if(_0x400fde[0x0][_0x38927a(0x1c5)]==_0x38927a(0x1c0)){var _0x3bcd25=users[_0x38927a(0x1e8)];console[_0x38927a(0x1df)](_0x3bcd25);}else{if(_0x400fde[0x0][_0x38927a(0x1c5)]==_0x38927a(0xff))var _0x3bcd25=users[_0x38927a(0xff)];else{if(_0x400fde[0x0][_0x38927a(0x1c5)]==_0x38927a(0x18b))var _0x3bcd25=users[_0x38927a(0x18b)];else{if(_0x400fde[0x0]['language']=='Spanish')var _0x3bcd25=users['Spanish'];else{if(_0x400fde[0x0][_0x38927a(0x1c5)]=='French')var _0x3bcd25=users[_0x38927a(0x118)];else{if(_0x400fde[0x0]['language']==_0x38927a(0x145))var _0x3bcd25=users[_0x38927a(0x100)];else{if(_0x400fde[0x0][_0x38927a(0x1c5)]==_0x38927a(0x116))var _0x3bcd25=users['Chinese'];else{if(_0x400fde[0x0][_0x38927a(0x1c5)]==_0x38927a(0x186))var _0x3bcd25=users[_0x38927a(0x199)];}}}}}}}_0x297db9[_0x38927a(0x15e)](_0x38927a(0x168),{'success':_0x1e066b[_0x38927a(0x164)](_0x38927a(0x10b)),'errors':_0x1e066b['flash'](_0x38927a(0x200)),'role':_0x5d7f6b,'profile':_0x2aa64c,'customer':_0x3d7e48,'warehouse':_0x1cfdb3,'product':_0x8b0090,'user':_0x5051ba,'master_shop':_0x400fde,'unit':_0x1496ea,'language':_0x3bcd25});}catch(_0x598264){console[_0x38927a(0x1df)](_0x598264);}}),router['post'](a0_0x5da05f(0x1b2),auth,async(_0x1b9c0a,_0x569b8a)=>{var _0x41860a=a0_0x5da05f;try{const _0x3de550=_0x1b9c0a[_0x41860a(0x139)]['id'],{invoice:_0x6d67c7,warehouse_name:_0x5c5239,room:_0x488aff}=_0x1b9c0a[_0x41860a(0x175)],_0xbe6888=await sales_finished['findOne']({'invoice':_0x6d67c7}),_0x369e79=_0xbe6888[_0x41860a(0x11d)][_0x41860a(0x102)](async _0x1356ce=>{var _0x558e59=_0x41860a,_0x16c2a9=await warehouse['findOne']({'name':_0x5c5239,'room':_0x1356ce[_0x558e59(0x1a9)],'warehouse_category':_0x558e59(0x181)});const _0x2fc334=_0x16c2a9['product_details'][_0x558e59(0x102)](_0x47da15=>{var _0x149b2d=_0x558e59;if(_0x47da15[_0x149b2d(0x1bd)]==_0x1356ce[_0x149b2d(0x1bd)]&&_0x47da15[_0x149b2d(0x119)]==_0x1356ce[_0x149b2d(0x119)]&&_0x47da15[_0x149b2d(0xea)]==_0x1356ce[_0x149b2d(0xea)]&&_0x47da15['production_date']==_0x1356ce[_0x149b2d(0x1f3)]&&_0x47da15[_0x149b2d(0x114)]==_0x1356ce[_0x149b2d(0x114)]&&_0x47da15[_0x149b2d(0x218)]==_0x1356ce[_0x149b2d(0x1d8)]){if(_0x47da15[_0x149b2d(0x11b)]>0x0){_0x47da15[_0x149b2d(0x11b)]=Math['max'](0x0,Math['abs'](_0x47da15[_0x149b2d(0x11b)])-Math[_0x149b2d(0x14b)](_0x1356ce[_0x149b2d(0xe9)]));if(_0x47da15[_0x149b2d(0x12a)]==undefined)_0x47da15[_0x149b2d(0x12a)]=_0x6d67c7+'~';else{var _0x517067=_0x47da15[_0x149b2d(0x12a)]['split']('~'),_0x107f3b='';for(let _0x1e85d4=0x0;_0x1e85d4<=_0x517067['length']-0x1;_0x1e85d4++){const _0x516d35=_0x517067[_0x1e85d4];_0x516d35['length']>0x0&&(_0x107f3b+=_0x516d35+'~');}_0x47da15[_0x149b2d(0x12a)]=_0x107f3b;}}}});return console[_0x558e59(0x1df)](_0x16c2a9),_0x16c2a9;});Promise[_0x41860a(0x177)](_0x369e79)[_0x41860a(0x11e)](async _0x2b329f=>{var _0xab3764=_0x41860a;try{for(const _0x5aef64 of _0x2b329f){await _0x5aef64['save']();}_0xbe6888['finalize']=_0xab3764(0x135);const _0x8b0781=await _0xbe6888[_0xab3764(0x16e)](),_0x408cbf=await master_shop[_0xab3764(0x1f7)](),_0x4f1caf=await email_settings['findOne'](),_0x104e02=await supervisor_settings[_0xab3764(0x1f7)]();var _0x338336=_0xbe6888[_0xab3764(0x11d)],_0x4544c2='',_0x35c848;for(_0x35c848 in _0x338336){var _0x279283='FG';_0xbe6888[_0xab3764(0x14a)]==_0xab3764(0x1c9)&&(_0x279283='DG'),_0x4544c2+=_0xab3764(0x1a2)+_0xab3764(0x137)+_0x338336[_0x35c848][_0xab3764(0x1bd)]+_0xab3764(0xf8)+_0xab3764(0x137)+_0x338336[_0x35c848][_0xab3764(0x124)]+_0xab3764(0xf8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x338336[_0x35c848][_0xab3764(0xe9)]+_0xab3764(0xf8)+_0xab3764(0x137)+_0x338336[_0x35c848]['unit']+_0xab3764(0xf8)+_0xab3764(0x137)+_0x338336[_0x35c848]['secondary_unit']+_0xab3764(0xf8)+_0xab3764(0x137)+_0xbe6888[_0xab3764(0x14a)]+_0xab3764(0xf8)+_0xab3764(0x137)+_0x338336[_0x35c848][_0xab3764(0x1a9)]+_0xab3764(0xf8)+_0xab3764(0x137)+_0x279283+_0x338336[_0x35c848][_0xab3764(0x119)]+_0xab3764(0xf8);}let _0xc897c8=nodemailer['createTransport']({'host':_0x4f1caf[_0xab3764(0x1b6)],'port':Number(_0x4f1caf[_0xab3764(0x19e)]),'secure':![],'auth':{'user':_0x4f1caf['email'],'pass':_0x4f1caf[_0xab3764(0xfe)]}}),_0x2c8ae7={'from':_0x4f1caf[_0xab3764(0x104)],'to':_0x104e02[0x0][_0xab3764(0x197)],'subject':'Sales\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0xab3764(0x169)+_0xab3764(0x1e0)+_0x408cbf[0x0]['image'],'cid':'logo'}],'html':_0xab3764(0x1b4)+_0xab3764(0xfc)+_0xab3764(0x165)+'<div>'+_0xab3764(0x15b)+_0xab3764(0x18a)+_0xab3764(0x10c)+_0xab3764(0xef)+_0xab3764(0x18a)+_0xab3764(0x129)+_0x408cbf[0x0][_0xab3764(0x185)]+_0xab3764(0xfa)+_0xab3764(0xef)+_0xab3764(0xef)+_0xab3764(0x1e2)+_0xab3764(0x18a)+_0xab3764(0x214)+'\x20Order\x20Number\x20:\x20'+_0xbe6888[_0xab3764(0x1d6)]+'\x20'+_0xab3764(0x206)+_0xab3764(0x21b)+_0xbe6888['date']+'\x20'+_0xab3764(0x149)+'</h5>'+_0xab3764(0xef)+_0xab3764(0x15f)+_0xab3764(0x128)+_0xab3764(0x1a2)+_0xab3764(0xfb)+_0xab3764(0x1ca)+_0xab3764(0x136)+_0xab3764(0x1ff)+_0xab3764(0x167)+_0xab3764(0x16a)+_0xab3764(0x17c)+_0xab3764(0x12d)+_0xab3764(0x1b7)+_0xab3764(0x1fa)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4544c2+'\x20'+_0xab3764(0x210)+_0xab3764(0x11c)+_0xab3764(0x18a)+_0xab3764(0x205)+'<h5>'+_0x408cbf[0x0]['site_title']+_0xab3764(0x1ef)+_0xab3764(0xef)+_0xab3764(0xef)+_0xab3764(0x190)};_0xc897c8[_0xab3764(0x142)](_0x2c8ae7,function(_0x1a51b5,_0x43b395){var _0x273c14=_0xab3764;_0x1a51b5?(console[_0x273c14(0x1df)](_0x1a51b5),console[_0x273c14(0x1df)](_0x273c14(0x13e))):console[_0x273c14(0x1df)](_0x273c14(0x132));}),_0x1b9c0a[_0xab3764(0x164)]('success',_0xab3764(0xf3)),_0x569b8a[_0xab3764(0x1af)](_0xab3764(0x121)+_0x3de550);}catch(_0x431248){console['error'](_0x431248),_0x569b8a[_0xab3764(0x174)](0x1f4)[_0xab3764(0x163)]({'error':_0xab3764(0x1ac)});}})['catch'](_0x4c60ac=>{var _0x30be48=_0x41860a;console[_0x30be48(0x153)](_0x4c60ac),_0x569b8a[_0x30be48(0x174)](0x1f4)[_0x30be48(0x163)]({'error':'An\x20error\x20occurred.'});});}catch(_0xd8d4ce){console['log'](_0xd8d4ce);}}),router['get']('/view/:id',auth,async(_0x197a45,_0x35c0f5)=>{var _0x205504=a0_0x5da05f;try{const {username:_0x1958f5,email:_0xe6a37b,role:_0x1b3978}=_0x197a45[_0x205504(0x10a)],_0x3417fc=_0x197a45['user'],_0x52d4c6=await profile[_0x205504(0x18f)]({'email':_0x3417fc[_0x205504(0x104)]}),_0x372731=await master_shop[_0x205504(0x1f7)](),_0x560721=_0x197a45['params']['id'],_0x59e4d1=await sales_finished['findById'](_0x560721);let _0x317aac=new Date(_0x59e4d1[_0x205504(0xea)]),_0x596a18=('0'+_0x317aac[_0x205504(0x1b8)]())[_0x205504(0x1db)](-0x2),_0x1246ad=('0'+(_0x317aac[_0x205504(0x1b0)]()+0x1))['slice'](-0x2),_0x3018d9=_0x317aac[_0x205504(0xf1)](),_0x3db023=_0x3018d9+'-'+_0x1246ad+'-'+_0x596a18;var _0x4a0988=['Ambient',_0x205504(0x1a0)];const _0xd74b30=await warehouse[_0x205504(0x1ea)]([{'$match':{'name':_0x59e4d1[_0x205504(0x14a)],'room':_0x59e4d1[_0x205504(0x1c6)]}},{'$unwind':_0x205504(0x1c4)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x205504(0x172)},'bay':{'$first':_0x205504(0xf4)},'bin':{'$first':_0x205504(0x1d1)},'type':{'$first':_0x205504(0x13d)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x205504(0x1f2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x205504(0x156)},'storage':{'$first':_0x205504(0x20b)},'rack':{'$first':'$product_details.rack'}}}]),_0x2a62ab=await customer[_0x205504(0x1f7)]({});let _0x49b7a0;if(_0x3417fc['role']=='staff'){const _0x57bd1f=await staff[_0x205504(0x18f)]({'email':_0x3417fc[_0x205504(0x104)]});_0x49b7a0=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x57bd1f['warehouse']}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x49b7a0=await warehouse[_0x205504(0x1ea)]([{'$match':{'status':_0x205504(0x196)}},{'$group':{'_id':_0x205504(0x1cf),'name':{'$first':'$name'}}}]);const _0x121441=await product[_0x205504(0x1f7)]({});if(_0x372731[0x0]['language']==_0x205504(0x1c0)){var _0xe8d3b4=users[_0x205504(0x1e8)];console[_0x205504(0x1df)](_0xe8d3b4);}else{if(_0x372731[0x0][_0x205504(0x1c5)]==_0x205504(0xff))var _0xe8d3b4=users['Hindi'];else{if(_0x372731[0x0][_0x205504(0x1c5)]==_0x205504(0x18b))var _0xe8d3b4=users[_0x205504(0x18b)];else{if(_0x372731[0x0][_0x205504(0x1c5)]=='Spanish')var _0xe8d3b4=users['Spanish'];else{if(_0x372731[0x0]['language']==_0x205504(0x118))var _0xe8d3b4=users[_0x205504(0x118)];else{if(_0x372731[0x0][_0x205504(0x1c5)]==_0x205504(0x145))var _0xe8d3b4=users[_0x205504(0x100)];else{if(_0x372731[0x0]['language']==_0x205504(0x116))var _0xe8d3b4=users[_0x205504(0x116)];else{if(_0x372731[0x0][_0x205504(0x1c5)]==_0x205504(0x186))var _0xe8d3b4=users[_0x205504(0x199)];}}}}}}}_0x35c0f5[_0x205504(0x15e)](_0x205504(0x1fc),{'success':_0x197a45['flash'](_0x205504(0x10b)),'errors':_0x197a45[_0x205504(0x164)](_0x205504(0x200)),'role':_0x3417fc,'profile':_0x52d4c6,'customer':_0x2a62ab,'warehouse':_0x49b7a0,'product':_0xd74b30,'user':_0x59e4d1,'master_shop':_0x372731,'unit':_0x121441,'language':_0xe8d3b4,'rooms_data':_0x4a0988,'ed_fullDate':_0x3db023});}catch(_0x4f8626){console['log'](_0x4f8626);}}),router[a0_0x5da05f(0x195)]('/view/:id',auth,async(_0x3ee42b,_0x5c591e)=>{var _0x430754=a0_0x5da05f;try{const _0x2c1cea=_0x3ee42b[_0x430754(0x139)]['id'],_0x29664f=await sales_finished[_0x430754(0x18f)]({'_id':_0x3ee42b[_0x430754(0x139)]['id']}),_0xc51eba=await warehouse['findOne']({'name':_0x29664f[_0x430754(0x14a)],'room':_0x3ee42b['body'][_0x430754(0x1c6)],'warehouse_category':_0x430754(0x181)}),{invoice:_0x4c512d,customer:_0x3eb074,date:_0x26e43f,warehouse_name:_0x52f04d,product_name:_0x2c937d,stock:_0x5adff5,adjust_qty:_0x12e3fd,note:_0xe4c4d2,room:_0x11d285,primary_code:_0xb1b72b,secondary_code:_0x2d79dc,prod_code:_0x4dd771,level:_0x19adef,isle:_0x5660ca,pallet:_0xdeff1,expiry_date:_0x2cd812}=_0x3ee42b['body'];if(typeof _0x2c937d=='string')var _0x113767=[_0x3ee42b[_0x430754(0x175)][_0x430754(0x1bd)]],_0x2e7cae=[_0x3ee42b[_0x430754(0x175)]['stock']],_0x241a45=[_0x3ee42b['body'][_0x430754(0x18c)]],_0x5e6f37=[_0x3ee42b[_0x430754(0x175)][_0x430754(0x147)]],_0x4041b9=[_0x3ee42b['body'][_0x430754(0x216)]],_0x3b312a=[_0x3ee42b['body'][_0x430754(0x125)]],_0xaaa584=[_0x3ee42b[_0x430754(0x175)][_0x430754(0x108)]],_0x418d52=[_0x3ee42b['body'][_0x430754(0xea)]];else var _0x113767=[..._0x3ee42b[_0x430754(0x175)][_0x430754(0x1bd)]],_0x2e7cae=[..._0x3ee42b[_0x430754(0x175)]['stock']],_0x241a45=[..._0x3ee42b[_0x430754(0x175)][_0x430754(0x18c)]],_0x5e6f37=[..._0x3ee42b[_0x430754(0x175)][_0x430754(0x147)]],_0x4041b9=[..._0x3ee42b[_0x430754(0x175)][_0x430754(0x216)]],_0x3b312a=[..._0x3ee42b['body'][_0x430754(0x125)]],_0xaaa584=[..._0x3ee42b[_0x430754(0x175)][_0x430754(0x108)]],_0x418d52=[..._0x3ee42b[_0x430754(0x175)][_0x430754(0xea)]];const _0x4b101d=_0x113767[_0x430754(0x102)](_0x574834=>{return _0x574834={'product_name':_0x574834};});_0x2e7cae['forEach']((_0x5db991,_0x592a27)=>{_0x4b101d[_0x592a27]['stock']=_0x5db991;}),_0x241a45[_0x430754(0x166)]((_0x66d7a6,_0x40f2f6)=>{var _0x3a865d=_0x430754;_0x4b101d[_0x40f2f6][_0x3a865d(0xe9)]=_0x66d7a6;}),_0x5e6f37[_0x430754(0x166)]((_0x5a5de1,_0x1be899)=>{var _0x310535=_0x430754;_0x4b101d[_0x1be899][_0x310535(0x147)]=_0x5a5de1;}),_0x4041b9[_0x430754(0x166)]((_0x2a7682,_0x5af84a)=>{var _0x1cd184=_0x430754;_0x4b101d[_0x5af84a][_0x1cd184(0x216)]=_0x2a7682;}),_0x3b312a[_0x430754(0x166)]((_0x3c0069,_0x1758c9)=>{_0x4b101d[_0x1758c9]['product_code']=_0x3c0069;}),_0xaaa584[_0x430754(0x166)]((_0x361aef,_0x572729)=>{_0x4b101d[_0x572729]['level']=_0x361aef;}),_0x418d52[_0x430754(0x166)]((_0xa67394,_0x1626db)=>{_0x4b101d[_0x1626db]['expiry_date']=_0xa67394;});var _0x4e3986=0x0;_0x4b101d['forEach'](_0x54ca9c=>{var _0x49c822=_0x430754;console[_0x49c822(0x1df)]('foreach\x20newproduct',_0x54ca9c),(parseInt(_0x54ca9c[_0x49c822(0x20e)])<parseInt(_0x54ca9c[_0x49c822(0xe9)])||parseInt(_0x54ca9c[_0x49c822(0xe9)])==0x0)&&_0x4e3986++;});if(_0x4e3986!=0x0)return _0x3ee42b[_0x430754(0x164)](_0x430754(0x200),_0x430754(0x148)),_0x5c591e['redirect'](_0x430754(0x103));_0x29664f[_0x430754(0x11d)][_0x430754(0x166)](_0x4b3696=>{var _0x2d08b7=_0x430754;const _0x57e2ae=_0xc51eba[_0x2d08b7(0x213)][_0x2d08b7(0x102)](_0x2eb5cc=>{var _0x4622f2=_0x2d08b7;_0x2eb5cc[_0x4622f2(0x1bd)]==_0x4b3696[_0x4622f2(0x1bd)]&&_0x2eb5cc[_0x4622f2(0x119)]==_0x4b3696[_0x4622f2(0x119)]&&(_0x2eb5cc[_0x4622f2(0x11b)]=parseInt(_0x2eb5cc[_0x4622f2(0x11b)])+parseInt(_0x4b3696[_0x4622f2(0xe9)]));});}),await _0xc51eba[_0x430754(0x16e)]();const _0x2838d2=_0x4b101d[_0x430754(0x18e)](_0x2b76b9=>_0x2b76b9[_0x430754(0xe9)]!=='0'&&_0x2b76b9[_0x430754(0xe9)]!=='');_0x29664f[_0x430754(0x1d6)]=_0x4c512d,_0x29664f[_0x430754(0x21f)]=_0x3eb074,_0x29664f[_0x430754(0x13a)]=_0x26e43f,_0x29664f[_0x430754(0x14a)]=_0x52f04d,_0x29664f['sale_product']=_0x2838d2,_0x29664f[_0x430754(0x1c8)]=_0xe4c4d2,_0x29664f[_0x430754(0x1c6)]=_0x11d285;const _0x4c1679=await _0x29664f[_0x430754(0x16e)](),_0x29e3a2=await sales_finished[_0x430754(0x18f)]({'_id':_0x3ee42b[_0x430754(0x139)]['id']}),_0xd71007=await warehouse[_0x430754(0x18f)]({'name':_0x52f04d,'room':_0x11d285,'warehouse_category':_0x430754(0x181)});_0x29e3a2[_0x430754(0x11d)][_0x430754(0x166)](_0xa772dc=>{var _0x46650a=_0x430754;const _0x2271aa=_0xd71007[_0x46650a(0x213)][_0x46650a(0x102)](_0x31403f=>{var _0x5846c2=_0x46650a;_0x31403f[_0x5846c2(0x1bd)]==_0xa772dc[_0x5846c2(0x1bd)]&&_0x31403f[_0x5846c2(0x119)]==_0xa772dc[_0x5846c2(0x119)]&&(_0x31403f[_0x5846c2(0x11b)]=parseInt(_0x31403f[_0x5846c2(0x11b)])-parseInt(_0xa772dc['quantity']));});}),console[_0x430754(0x1df)](_0x430754(0x15c),_0xd71007),await _0xd71007[_0x430754(0x16e)]();const _0xe13991=await c_payment_data[_0x430754(0x18f)]({'invoice':_0x3ee42b[_0x430754(0x175)]['invoice']});_0xe13991[_0x430754(0x204)]=_0x3ee42b[_0x430754(0x175)][_0x430754(0x204)],await _0xe13991[_0x430754(0x16e)](),_0x3ee42b['flash'](_0x430754(0x10b),_0x430754(0xf3)),_0x5c591e[_0x430754(0x1af)](_0x430754(0x161));}catch(_0x57c205){console[_0x430754(0x1df)](_0x57c205);}}),router[a0_0x5da05f(0x195)](a0_0x5da05f(0x1d0),auth,async(_0x167541,_0x28e391)=>{var _0x398b17=a0_0x5da05f;try{const _0x56218a=_0x167541[_0x398b17(0x139)]['id'],{invoice:_0x41b8f6,customer:_0x291db8,receivable_amount:_0x3687b4,received_amount:_0x5dec02}=_0x167541[_0x398b17(0x175)],_0x5aba8a=await sales[_0x398b17(0xf6)](_0x56218a);console[_0x398b17(0x1df)](_0x5aba8a);var _0x574f4b=_0x3687b4-_0x5dec02;console[_0x398b17(0x1df)](_0x5dec02),_0x5aba8a[_0x398b17(0x13b)]=parseFloat(_0x5dec02)+parseFloat(_0x5aba8a[_0x398b17(0x13b)]),_0x5aba8a[_0x398b17(0xed)]=_0x574f4b,console[_0x398b17(0x1df)](_0x5aba8a);const _0x1ddf9a=await _0x5aba8a[_0x398b17(0x16e)](),_0xbe7456=await c_payment_data[_0x398b17(0x18f)]({'invoice':_0x41b8f6});_0xbe7456[_0x398b17(0x160)]=_0x574f4b,await _0xbe7456[_0x398b17(0x16e)]();let _0x2ba14a=new Date(),_0x4f50c0=('0'+_0x2ba14a[_0x398b17(0x1b8)]())[_0x398b17(0x1db)](-0x2),_0x12a823=('0'+(_0x2ba14a[_0x398b17(0x1b0)]()+0x1))[_0x398b17(0x1db)](-0x2),_0x4f5045=_0x2ba14a[_0x398b17(0xf1)](),_0x368f01=_0x4f5045+'-'+_0x12a823+'-'+_0x4f50c0;const _0x102e08=new customer_payment({'invoice':_0x41b8f6,'date':_0x4f5045+'-'+_0x12a823+'-'+_0x4f50c0,'customer':_0x291db8,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x5dec02}),_0x1ea223=await _0x102e08[_0x398b17(0x16e)]();_0x167541['flash'](_0x398b17(0x10b),_0x398b17(0x141)),_0x28e391[_0x398b17(0x1af)](_0x398b17(0x10d));}catch(_0x35fb48){console[_0x398b17(0x1df)](_0x35fb48);}}),router[a0_0x5da05f(0x157)](a0_0x5da05f(0x11f),auth,async(_0x565bc2,_0x3c22c0)=>{var _0x4da17b=a0_0x5da05f;try{const {username:_0x84f493,email:_0x371dd5,role:_0xa5bb9}=_0x565bc2['user'],_0x5df25f=_0x565bc2[_0x4da17b(0x10a)],_0x1dcc60=await profile[_0x4da17b(0x18f)]({'email':_0x5df25f[_0x4da17b(0x104)]}),_0x206cff=await master_shop[_0x4da17b(0x1f7)]();console[_0x4da17b(0x1df)](_0x4da17b(0x15a),_0x206cff);const _0x50cdcb=_0x565bc2[_0x4da17b(0x139)]['id'],_0x3718c8=await sales[_0x4da17b(0xf6)](_0x50cdcb);console[_0x4da17b(0x1df)](_0x3718c8);const _0x3c40cb=await customer[_0x4da17b(0x18f)]({'name':_0x3718c8[_0x4da17b(0x21f)]});console['log'](_0x3c40cb);if(_0x206cff[0x0]['language']==_0x4da17b(0x1c0)){var _0x514e3b=users[_0x4da17b(0x1e8)];console[_0x4da17b(0x1df)](_0x514e3b);}else{if(_0x206cff[0x0][_0x4da17b(0x1c5)]=='Hindi')var _0x514e3b=users['Hindi'];else{if(_0x206cff[0x0][_0x4da17b(0x1c5)]==_0x4da17b(0x18b))var _0x514e3b=users[_0x4da17b(0x18b)];else{if(_0x206cff[0x0]['language']==_0x4da17b(0x1e9))var _0x514e3b=users[_0x4da17b(0x1e9)];else{if(_0x206cff[0x0]['language']=='French')var _0x514e3b=users[_0x4da17b(0x118)];else{if(_0x206cff[0x0]['language']==_0x4da17b(0x145))var _0x514e3b=users[_0x4da17b(0x100)];else{if(_0x206cff[0x0][_0x4da17b(0x1c5)]==_0x4da17b(0x116))var _0x514e3b=users['Chinese'];else{if(_0x206cff[0x0][_0x4da17b(0x1c5)]==_0x4da17b(0x186))var _0x514e3b=users[_0x4da17b(0x199)];}}}}}}}_0x3c22c0[_0x4da17b(0x15e)](_0x4da17b(0x14f),{'success':_0x565bc2[_0x4da17b(0x164)]('success'),'errors':_0x565bc2['flash']('errors'),'role':_0x5df25f,'profile':_0x1dcc60,'master_shop':_0x206cff,'customers':_0x3c40cb,'sales':_0x3718c8,'language':_0x514e3b});}catch(_0x168fe4){console[_0x4da17b(0x1df)](_0x168fe4);}}),router[a0_0x5da05f(0x157)](a0_0x5da05f(0x17a),auth,async(_0x4dfeb7,_0x5937c7)=>{var _0x57ad34=a0_0x5da05f;try{const {username:_0x225640,email:_0x5e35e7,role:_0x4268f1}=_0x4dfeb7['user'],_0x3bba99=_0x4dfeb7[_0x57ad34(0x10a)],_0x9e4448=await profile[_0x57ad34(0x18f)]({'email':_0x3bba99['email']}),_0x2ac85e=await master_shop[_0x57ad34(0x1f7)](),_0x3856e0=_0x4dfeb7[_0x57ad34(0x139)]['id'],_0x3f0b64=await sales_finished[_0x57ad34(0xf6)](_0x3856e0),_0x3354da=await warehouse[_0x57ad34(0x1ea)]([{'$match':{'name':_0x3f0b64[_0x57ad34(0x14a)]}},{'$unwind':_0x57ad34(0x1c4)},{'$group':{'_id':_0x57ad34(0x20d),'name':{'$first':_0x57ad34(0x106)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x57ad34(0xf4)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x57ad34(0x13d)},'floorlevel':{'$first':_0x57ad34(0x1da)},'primary_code':{'$first':_0x57ad34(0x1f2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x57ad34(0x156)},'storage':{'$first':_0x57ad34(0x20b)},'rack':{'$first':_0x57ad34(0x1ab)},'expiry_date':{'$first':_0x57ad34(0xee)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x57ad34(0x188)},'maxProducts':{'$first':_0x57ad34(0x17e)},'batch_code':{'$first':_0x57ad34(0x138)},'maxPerUnit':{'$first':_0x57ad34(0x117)}}}]),_0x2bca04=await product[_0x57ad34(0x1f7)]({}),_0x495ffc=await warehouse[_0x57ad34(0x1ea)]([{'$match':{'status':_0x57ad34(0x196),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x57ad34(0x11a),'$ne':_0x57ad34(0xf5)}}},{'$group':{'_id':'$name','name':{'$first':_0x57ad34(0x1cf)}}},{'$sort':{'name':0x1}}]);var _0x2560c2=[_0x57ad34(0x19d)];const _0x3db3e0=await warehouse['aggregate']([{'$match':{'status':_0x57ad34(0x196),'name':'Quality\x20Inspection'}},{'$group':{'_id':_0x57ad34(0x1cf),'name':{'$first':_0x57ad34(0x1cf)}}},{'$sort':{'name':0x1}}]);if(_0x2ac85e[0x0][_0x57ad34(0x1c5)]==_0x57ad34(0x1c0)){var _0x5812b6=users['English'];console[_0x57ad34(0x1df)](_0x5812b6);}else{if(_0x2ac85e[0x0][_0x57ad34(0x1c5)]==_0x57ad34(0xff))var _0x5812b6=users[_0x57ad34(0xff)];else{if(_0x2ac85e[0x0]['language']==_0x57ad34(0x18b))var _0x5812b6=users[_0x57ad34(0x18b)];else{if(_0x2ac85e[0x0]['language']==_0x57ad34(0x1e9))var _0x5812b6=users[_0x57ad34(0x1e9)];else{if(_0x2ac85e[0x0][_0x57ad34(0x1c5)]==_0x57ad34(0x118))var _0x5812b6=users[_0x57ad34(0x118)];else{if(_0x2ac85e[0x0][_0x57ad34(0x1c5)]=='Portuguese\x20(BR)')var _0x5812b6=users[_0x57ad34(0x100)];else{if(_0x2ac85e[0x0]['language']=='Chinese')var _0x5812b6=users[_0x57ad34(0x116)];else{if(_0x2ac85e[0x0][_0x57ad34(0x1c5)]==_0x57ad34(0x186))var _0x5812b6=users[_0x57ad34(0x199)];}}}}}}}_0x5937c7[_0x57ad34(0x15e)]('return_sale_finished',{'success':_0x4dfeb7[_0x57ad34(0x164)](_0x57ad34(0x10b)),'errors':_0x4dfeb7[_0x57ad34(0x164)](_0x57ad34(0x200)),'role':_0x3bba99,'profile':_0x9e4448,'user':_0x3f0b64,'stock':_0x3354da,'master_shop':_0x2ac85e,'unit':_0x2bca04,'language':_0x5812b6,'warehouses':_0x495ffc,'rooms':_0x2560c2,'warehouse_QA':_0x3db3e0});}catch(_0xf8afac){console['log'](_0xf8afac),_0x5937c7[_0x57ad34(0x174)](0xc8)[_0x57ad34(0x163)]({'message':_0xf8afac[_0x57ad34(0x1ee)]});}}),router[a0_0x5da05f(0x195)]('/view/return_sales/:id',auth,async(_0x1536bd,_0x215c2a)=>{var _0x35243f=a0_0x5da05f;if(_0x1536bd[_0x35243f(0x175)][_0x35243f(0x1e1)]=='QA')try{const {invoice:_0x1e213e,date:_0x5ae54b,warehouse_name:_0xfbc6ef,product_name:_0x2a5766,primary_code:_0x3c09a0,secondary_code:_0x3ca134,product_code:_0x5a64d5,sales_quantity:_0x125999,stocks:_0x2a7941,return_qty:_0x29beb7,Room_name:_0x446e35,to_warehouse_name_QA:_0x2ccdbd,to_Room_name_QA:_0x2e856c,note:_0x43ff3d,for_categorize:_0x202633,product_name_QA1:_0x2561f7}=_0x1536bd[_0x35243f(0x175)];if(typeof _0x2561f7==_0x35243f(0x179))var _0x271144=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x1f6)]],_0x21b72c=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0xf9)]],_0x191b90=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x183)]],_0x3957a3=[_0x1536bd['body'][_0x35243f(0x1f4)]],_0xf7716b=[_0x1536bd[_0x35243f(0x175)]['sales_quantity_QA']],_0x4c93da=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0xe6)]],_0xfea30a=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x184)]],_0x4adf83=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x140)]],_0x18efdc=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x1fe)]],_0x49cac4=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x207)]],_0x1e994b=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x10e)]],_0x137db8=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x159)]],_0xaca5f6=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x158)]],_0x16e746=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x1b5)]];else var _0x271144=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x1f6)]],_0x21b72c=[..._0x1536bd['body'][_0x35243f(0xf9)]],_0x191b90=[..._0x1536bd[_0x35243f(0x175)]['secondary_code_QA']],_0x3957a3=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x1f4)]],_0xf7716b=[..._0x1536bd['body'][_0x35243f(0x19c)]],_0x4c93da=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0xe6)]],_0xfea30a=[..._0x1536bd['body']['return_qty_QA']],_0x4adf83=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x140)]],_0x18efdc=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x1fe)]],_0x49cac4=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x207)]],_0x1e994b=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x10e)]],_0x137db8=[..._0x1536bd['body'][_0x35243f(0x159)]],_0xaca5f6=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x158)]],_0x16e746=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x1b5)]];const _0x28572c=_0x271144[_0x35243f(0x102)](_0x5e0c13=>{return _0x5e0c13={'product_name':_0x5e0c13};});_0x21b72c[_0x35243f(0x166)]((_0xea0d6d,_0x537204)=>{var _0x2bdff9=_0x35243f;_0x28572c[_0x537204][_0x2bdff9(0x147)]=_0xea0d6d;}),_0x191b90[_0x35243f(0x166)]((_0x332264,_0x12e910)=>{var _0x807982=_0x35243f;_0x28572c[_0x12e910][_0x807982(0x216)]=_0x332264;}),_0x3957a3[_0x35243f(0x166)]((_0x4bbbdd,_0x5a4a22)=>{var _0x49d401=_0x35243f;_0x28572c[_0x5a4a22][_0x49d401(0x124)]=_0x4bbbdd;}),_0xf7716b[_0x35243f(0x166)]((_0x446487,_0x2b380a)=>{var _0x12c11e=_0x35243f;_0x28572c[_0x2b380a][_0x12c11e(0xeb)]=_0x446487;}),_0x4c93da[_0x35243f(0x166)]((_0x535e7d,_0x51139a)=>{var _0x28ea43=_0x35243f;_0x28572c[_0x51139a][_0x28ea43(0x20e)]=_0x535e7d;}),_0xfea30a[_0x35243f(0x166)]((_0x36a16f,_0x568b52)=>{var _0x3ead29=_0x35243f;_0x28572c[_0x568b52][_0x3ead29(0x1cc)]=_0x36a16f;}),_0x4adf83['forEach']((_0x5e484d,_0x30ad03)=>{var _0x317aba=_0x35243f;_0x28572c[_0x30ad03][_0x317aba(0x154)]=_0x5e484d;}),_0x18efdc['forEach']((_0x379429,_0x35a54f)=>{_0x28572c[_0x35a54f]['maxProducts']=_0x379429;}),_0x49cac4[_0x35243f(0x166)]((_0x4d6b08,_0xf5db31)=>{var _0x39d836=_0x35243f;_0x28572c[_0xf5db31][_0x39d836(0x114)]=_0x4d6b08;}),_0x1e994b[_0x35243f(0x166)]((_0x76bf66,_0x119bfa)=>{var _0x6d486f=_0x35243f;_0x28572c[_0x119bfa][_0x6d486f(0x14d)]=_0x76bf66;}),_0x137db8[_0x35243f(0x166)]((_0x151def,_0x2814aa)=>{var _0x2a0682=_0x35243f;_0x28572c[_0x2814aa][_0x2a0682(0x217)]=_0x151def;}),_0xaca5f6[_0x35243f(0x166)]((_0x545482,_0x4e2b6a)=>{var _0x4bb664=_0x35243f;_0x28572c[_0x4e2b6a][_0x4bb664(0x1f3)]=_0x545482;}),_0x16e746[_0x35243f(0x166)]((_0x4d274a,_0x2831e3)=>{_0x28572c[_0x2831e3]['expiry_date']=_0x4d274a;});const _0x213b3c=await sales_finished[_0x35243f(0x18f)]({'invoice':_0x1e213e});_0x213b3c['return_data']=_0x35243f(0x135);const _0x475c7d=await _0x213b3c[_0x35243f(0x16e)](),_0x5a58a7=new sales_return_finished({'invoice':_0x1e213e,'customer':_0x1536bd[_0x35243f(0x175)][_0x35243f(0x21f)],'date':_0x5ae54b,'warehouse_name':_0xfbc6ef,'room':_0x446e35,'ToWarehouse':_0x2ccdbd,'ToRoom':_0x2e856c,'return_sale_QA':_0x28572c,'note':_0x43ff3d,'warehouse_cat':_0x202633}),_0x169451=await _0x5a58a7[_0x35243f(0x16e)](),_0x422a41=await sales_return_finished[_0x35243f(0x18f)]({'invoice':_0x1e213e}),_0xf2af38=await warehouse[_0x35243f(0x18f)]({'name':_0x2ccdbd,'room':_0x2e856c});_0x422a41[_0x35243f(0x20a)][_0x35243f(0x166)](_0x4479c7=>{var _0x2a712b=_0x35243f,_0xb85ef7=0x0;const _0x216f43=_0xf2af38['product_details'][_0x2a712b(0x102)](_0x17d781=>{var _0x3489d8=_0x2a712b;_0x17d781[_0x3489d8(0x1bd)]==_0x4479c7['product_name']&&_0x17d781['expiry_date']==_0x4479c7[_0x3489d8(0xea)]&&_0x17d781[_0x3489d8(0x1f3)]==_0x4479c7[_0x3489d8(0x1f3)]&&_0x17d781[_0x3489d8(0x114)]==_0x4479c7['batch_code']&&(_0x17d781[_0x3489d8(0x11b)]=parseInt(_0x17d781[_0x3489d8(0x11b)])+parseInt(_0x4479c7[_0x3489d8(0x1cc)]),_0xb85ef7++);});_0xb85ef7=='0'&&(_0xf2af38[_0x2a712b(0x213)]=_0xf2af38['product_details'][_0x2a712b(0x13c)]({'product_name':_0x4479c7[_0x2a712b(0x1bd)],'product_stock':_0x4479c7[_0x2a712b(0x1cc)],'primary_code':_0x4479c7['primary_code'],'secondary_code':_0x4479c7[_0x2a712b(0x216)],'product_code':_0x4479c7[_0x2a712b(0x124)],'batch_code':_0x4479c7['batch_code'],'maxPerUnit':_0x4479c7[_0x2a712b(0x154)],'production_date':_0x4479c7[_0x2a712b(0x1f3)],'expiry_date':_0x4479c7[_0x2a712b(0xea)],'secondary_unit':_0x4479c7[_0x2a712b(0x14d)],'unit':_0x4479c7[_0x2a712b(0x217)],'maxProducts':_0x4479c7[_0x2a712b(0x107)],'bay':_0x4479c7[_0x2a712b(0x119)]}));}),await _0xf2af38[_0x35243f(0x16e)]();const _0x4fcac7=new c_payment_data({'invoice':_0x1e213e,'customer':_0x1536bd[_0x35243f(0x175)]['customer'],'reason':'Sale\x20Return'});await _0x4fcac7[_0x35243f(0x16e)]();const _0x2ccfce=await master_shop[_0x35243f(0x1f7)](),_0x52f723=await email_settings['findOne'](),_0x20369b=await customer[_0x35243f(0x18f)]({'name':_0x1536bd['body'][_0x35243f(0x21f)]});_0x2ccfce[0x0][_0x35243f(0x109)]==0x1?(right_currency=_0x2ccfce[0x0][_0x35243f(0x182)],left_currency=''):(right_currency='',left_currency=_0x2ccfce[0x0][_0x35243f(0x182)]);var _0x2c2140=_0x271144,_0x32c6e4=_0xfea30a,_0xacddec='',_0x22a081;for(_0x22a081 in _0x2c2140){_0xacddec+=_0x35243f(0x1a2)+_0x35243f(0x137)+_0x2c2140[_0x22a081]+_0x35243f(0xf8)+_0x35243f(0x137)+_0x32c6e4[_0x22a081]+_0x35243f(0xf8)+'</tr>';}console[_0x35243f(0x1df)](_0x35243f(0x1e3),_0xacddec);let _0x3958a8=nodemailer[_0x35243f(0x113)]({'service':_0x35243f(0x1e6),'auth':{'user':_0x52f723[_0x35243f(0x104)],'pass':_0x52f723[_0x35243f(0xfe)]}}),_0x463d82={'from':_0x52f723[_0x35243f(0x104)],'to':_0x20369b[_0x35243f(0x104)],'subject':_0x35243f(0x1dd),'attachments':[{'filename':_0x35243f(0x1d4),'path':__dirname+'/../public'+_0x35243f(0x1e0)+_0x2ccfce[0x0][_0x35243f(0x152)],'cid':_0x35243f(0x1fb)}],'html':_0x35243f(0x1b4)+_0x35243f(0xfc)+_0x35243f(0x165)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x35243f(0x18a)+_0x35243f(0x10c)+_0x35243f(0xef)+_0x35243f(0x18a)+_0x35243f(0x129)+_0x2ccfce[0x0][_0x35243f(0x185)]+_0x35243f(0xfa)+'</div>'+'</div>'+_0x35243f(0x1e2)+_0x35243f(0x18a)+_0x35243f(0x214)+_0x35243f(0x134)+_0x1e213e+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x35243f(0x21b)+_0x5ae54b+'\x20'+_0x35243f(0x149)+_0x35243f(0x1ef)+_0x35243f(0xef)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x35243f(0x128)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x35243f(0x20c)+_0x35243f(0x155)+_0x35243f(0x1b1)+_0x35243f(0x1b7)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xacddec+'\x20'+_0x35243f(0x210)+_0x35243f(0x11c)+_0x35243f(0x18a)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x2ccfce[0x0][_0x35243f(0x185)]+_0x35243f(0x1ef)+_0x35243f(0xef)+'</div>'+_0x35243f(0x190)};_0x3958a8[_0x35243f(0x142)](_0x463d82,function(_0x5194e6,_0x10330d){var _0x575dac=_0x35243f;_0x5194e6?(console[_0x575dac(0x1df)](_0x5194e6),console[_0x575dac(0x1df)](_0x575dac(0x13e))):console['log'](_0x575dac(0x132));}),_0x1536bd[_0x35243f(0x164)]('success',_0x35243f(0x1ae)),_0x215c2a[_0x35243f(0x1af)](_0x35243f(0x161));}catch(_0x334d74){_0x215c2a['status'](0xc8)['json']({'message1':_0x334d74['message']});}else{if(_0x1536bd[_0x35243f(0x175)][_0x35243f(0x1e1)]=='GS')try{const {invoice:_0x1b71c9,date:_0x4cc268,warehouse_name:_0x406dc0,product_name:_0xd7fc46,primary_code:_0x38121d,secondary_code:_0xbbc984,product_code:_0x1bc679,sales_quantity:_0x5da87e,stocks:_0x25ca1c,return_qty:_0x100348,Room_name:_0x222e59,to_warehouse_name:_0x17f852,to_Room_name:_0x3cbbbb,note:_0x59d000,level:_0x1a6419,isle:_0x15b1b4,pallet:_0x39e1e8,for_categorize:_0x695f44}=_0x1536bd[_0x35243f(0x175)];if(typeof _0xd7fc46==_0x35243f(0x179))var _0x271144=[_0x1536bd[_0x35243f(0x175)]['product_name']],_0x21b72c=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x147)]],_0x191b90=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x216)]],_0x3957a3=[_0x1536bd[_0x35243f(0x175)]['product_code']],_0xf7716b=[_0x1536bd[_0x35243f(0x175)]['sales_quantity']],_0xfea30a=[_0x1536bd['body'][_0x35243f(0x1cc)]],_0x32c6f4=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x119)]],_0x4adf83=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x154)]],_0x18efdc=[_0x1536bd['body'][_0x35243f(0x107)]],_0x49cac4=[_0x1536bd['body'][_0x35243f(0x114)]],_0x1e994b=[_0x1536bd['body'][_0x35243f(0x14d)]],_0x137db8=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0x217)]],_0xaca5f6=[_0x1536bd[_0x35243f(0x175)]['production_date']],_0x16e746=[_0x1536bd[_0x35243f(0x175)][_0x35243f(0xea)]];else var _0x271144=[..._0x1536bd['body'][_0x35243f(0x1bd)]],_0x21b72c=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x147)]],_0x191b90=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x216)]],_0x3957a3=[..._0x1536bd['body'][_0x35243f(0x124)]],_0xf7716b=[..._0x1536bd['body'][_0x35243f(0x120)]],_0xfea30a=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x1cc)]],_0x32c6f4=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x119)]],_0x4adf83=[..._0x1536bd[_0x35243f(0x175)]['maxPerUnit']],_0x18efdc=[..._0x1536bd['body']['maxProducts']],_0x49cac4=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x114)]],_0x1e994b=[..._0x1536bd[_0x35243f(0x175)]['secondary_unit']],_0x137db8=[..._0x1536bd['body'][_0x35243f(0x217)]],_0xaca5f6=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0x1f3)]],_0x16e746=[..._0x1536bd[_0x35243f(0x175)][_0x35243f(0xea)]];const _0x4ed69f=_0x271144[_0x35243f(0x102)](_0x513e9c=>{return _0x513e9c={'product_name':_0x513e9c};});_0x21b72c[_0x35243f(0x166)]((_0x169314,_0x3eb2e3)=>{var _0x21c1c3=_0x35243f;_0x4ed69f[_0x3eb2e3][_0x21c1c3(0x147)]=_0x169314;}),_0x191b90[_0x35243f(0x166)]((_0x2bb1da,_0x5a4305)=>{var _0x1f6401=_0x35243f;_0x4ed69f[_0x5a4305][_0x1f6401(0x216)]=_0x2bb1da;}),_0x3957a3[_0x35243f(0x166)]((_0x4f2ad1,_0x49ca9e)=>{var _0x107e70=_0x35243f;_0x4ed69f[_0x49ca9e][_0x107e70(0x124)]=_0x4f2ad1;}),_0xf7716b[_0x35243f(0x166)]((_0x2c0f19,_0x16d809)=>{var _0x287009=_0x35243f;_0x4ed69f[_0x16d809][_0x287009(0xeb)]=_0x2c0f19;}),_0xfea30a[_0x35243f(0x166)]((_0x2919aa,_0x465867)=>{var _0x55cfb8=_0x35243f;_0x4ed69f[_0x465867][_0x55cfb8(0x1cc)]=_0x2919aa;}),_0x32c6f4[_0x35243f(0x166)]((_0x3f80d3,_0x370bbf)=>{_0x4ed69f[_0x370bbf]['bay']=_0x3f80d3;}),_0x4adf83[_0x35243f(0x166)]((_0x12e89e,_0x99aa70)=>{var _0x10c5ac=_0x35243f;_0x4ed69f[_0x99aa70][_0x10c5ac(0x154)]=_0x12e89e;}),_0x18efdc[_0x35243f(0x166)]((_0x25b927,_0x1dc004)=>{_0x4ed69f[_0x1dc004]['maxProducts']=_0x25b927;}),_0x49cac4['forEach']((_0x3b5345,_0x268dd5)=>{var _0x31a043=_0x35243f;_0x4ed69f[_0x268dd5][_0x31a043(0x114)]=_0x3b5345;}),_0x1e994b[_0x35243f(0x166)]((_0x233793,_0x49e687)=>{var _0x3daff0=_0x35243f;_0x4ed69f[_0x49e687][_0x3daff0(0x14d)]=_0x233793;}),_0x137db8[_0x35243f(0x166)]((_0x1de590,_0x3fd191)=>{var _0x2df710=_0x35243f;_0x4ed69f[_0x3fd191][_0x2df710(0x217)]=_0x1de590;}),_0xaca5f6[_0x35243f(0x166)]((_0x31c872,_0x4e7b91)=>{var _0x8a8780=_0x35243f;_0x4ed69f[_0x4e7b91][_0x8a8780(0x1f3)]=_0x31c872;}),_0x16e746[_0x35243f(0x166)]((_0x520a92,_0x1b6331)=>{var _0x59cc3e=_0x35243f;_0x4ed69f[_0x1b6331][_0x59cc3e(0xea)]=_0x520a92;});var _0x45bc08=0x0;_0x4ed69f[_0x35243f(0x166)](_0x290da7=>{var _0x3a1aba=_0x35243f;(parseInt(_0x290da7[_0x3a1aba(0xeb)])<parseInt(_0x290da7[_0x3a1aba(0x1cc)])||parseInt(_0x290da7[_0x3a1aba(0x20e)])<parseInt(_0x290da7[_0x3a1aba(0x1cc)])&&parseInt(_0x290da7['sale_qty'])>parseInt(_0x290da7[_0x3a1aba(0x1cc)])||parseInt(_0x290da7['return_qty'])==0x0)&&_0x45bc08++;});if(_0x45bc08!=0x0)return _0x1536bd[_0x35243f(0x164)]('errors',_0x35243f(0x20f)),_0x215c2a[_0x35243f(0x1af)]('back');const _0xed4957=await sales_finished[_0x35243f(0x18f)]({'invoice':_0x1b71c9});_0xed4957['return_data']=_0x35243f(0x135);const _0x452c65=await _0xed4957[_0x35243f(0x16e)](),_0xfae6d8=new sales_return_finished({'invoice':_0x1b71c9,'customer':_0x1536bd[_0x35243f(0x175)][_0x35243f(0x21f)],'date':_0x4cc268,'warehouse_name':_0x406dc0,'room':_0x222e59,'ToWarehouse':_0x17f852,'ToRoom':_0x3cbbbb,'return_sale':_0x4ed69f,'note':_0x59d000,'warehouse_cat':_0x695f44}),_0x5a1448=await _0xfae6d8[_0x35243f(0x16e)](),_0x134125=await sales_return_finished[_0x35243f(0x18f)]({'invoice':_0x1b71c9}),_0x5693b2=await warehouse['findOne']({'name':_0x17f852,'room':_0x3cbbbb,'warehouse_category':_0x35243f(0x181)});_0x134125[_0x35243f(0x10f)][_0x35243f(0x166)](_0x1f3446=>{var _0x160155=_0x35243f,_0x5d0c34=0x0;const _0x26690b=_0x5693b2['product_details']['map'](_0x548bdc=>{var _0x233d2e=a0_0x1e3b;_0x548bdc['product_name']==_0x1f3446['product_name']&&_0x548bdc[_0x233d2e(0x119)]==_0x1f3446['bay']&&_0x548bdc[_0x233d2e(0xea)]==_0x1f3446[_0x233d2e(0xea)]&&_0x548bdc[_0x233d2e(0x1f3)]==_0x1f3446[_0x233d2e(0x1f3)]&&_0x548bdc[_0x233d2e(0x114)]==_0x1f3446['batch_code']&&(_0x548bdc['product_stock']=parseInt(_0x548bdc[_0x233d2e(0x11b)])+parseInt(_0x1f3446[_0x233d2e(0x1cc)]),_0x5d0c34++);});_0x5d0c34=='0'&&(_0x5693b2[_0x160155(0x213)]=_0x5693b2[_0x160155(0x213)]['concat']({'product_name':_0x1f3446[_0x160155(0x1bd)],'product_stock':_0x1f3446['return_qty'],'primary_code':_0x1f3446[_0x160155(0x147)],'secondary_code':_0x1f3446[_0x160155(0x216)],'product_code':_0x1f3446['product_code'],'bay':_0x1f3446[_0x160155(0x119)],'batch_code':_0x1f3446[_0x160155(0x114)],'maxPerUnit':_0x1f3446['maxPerUnit'],'production_date':_0x1f3446[_0x160155(0x1f3)],'expiry_date':_0x1f3446['expiry_date'],'secondary_unit':_0x1f3446['secondary_unit'],'unit':_0x1f3446[_0x160155(0x217)],'maxProducts':_0x1f3446[_0x160155(0x107)]}));}),await _0x5693b2[_0x35243f(0x16e)](),console['log'](_0x1536bd[_0x35243f(0x175)]);const _0x2a4fa8=new c_payment_data({'invoice':_0x1b71c9,'customer':_0x1536bd['body'][_0x35243f(0x21f)],'reason':'Sale\x20Return'});await _0x2a4fa8[_0x35243f(0x16e)]();const _0x4bf1c2=await master_shop[_0x35243f(0x1f7)]();console[_0x35243f(0x1df)](_0x35243f(0x112),_0x4bf1c2[0x0][_0x35243f(0x152)]);const _0x2e7a86=await email_settings[_0x35243f(0x18f)](),_0x2d2cff=await customer[_0x35243f(0x18f)]({'name':_0x1536bd[_0x35243f(0x175)][_0x35243f(0x21f)]});console[_0x35243f(0x1df)](_0x35243f(0x19f),_0x2d2cff);_0x4bf1c2[0x0][_0x35243f(0x109)]==0x1?(right_currency=_0x4bf1c2[0x0][_0x35243f(0x182)],left_currency=''):(right_currency='',left_currency=_0x4bf1c2[0x0]['currency']);var _0x2c2140=_0x271144,_0x32c6e4=_0xfea30a,_0xacddec='',_0x22a081;for(_0x22a081 in _0x2c2140){_0xacddec+=_0x35243f(0x1a2)+_0x35243f(0x137)+_0x2c2140[_0x22a081]+_0x35243f(0xf8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32c6e4[_0x22a081]+'</td>'+_0x35243f(0x1b7);}console[_0x35243f(0x1df)](_0x35243f(0x1e3),_0xacddec);let _0xdf68df=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x2e7a86[_0x35243f(0x104)],'pass':_0x2e7a86[_0x35243f(0xfe)]}}),_0x2f8fdf={'from':_0x2e7a86[_0x35243f(0x104)],'to':_0x2d2cff[_0x35243f(0x104)],'subject':_0x35243f(0x1dd),'attachments':[{'filename':_0x35243f(0x1d4),'path':__dirname+_0x35243f(0x169)+_0x35243f(0x1e0)+_0x4bf1c2[0x0]['image'],'cid':'logo'}],'html':_0x35243f(0x1b4)+'<html><head><title></title>'+_0x35243f(0x165)+_0x35243f(0x18a)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x35243f(0x18a)+_0x35243f(0x10c)+_0x35243f(0xef)+'<div>'+_0x35243f(0x129)+_0x4bf1c2[0x0]['site_title']+'\x20</h2>'+_0x35243f(0xef)+_0x35243f(0xef)+_0x35243f(0x1e2)+_0x35243f(0x18a)+_0x35243f(0x214)+_0x35243f(0x134)+_0x1b71c9+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x35243f(0x21b)+_0x4cc268+'\x20'+'</span>'+_0x35243f(0x1ef)+_0x35243f(0xef)+_0x35243f(0x15f)+_0x35243f(0x128)+_0x35243f(0x1a2)+_0x35243f(0xfb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x35243f(0x155)+_0x35243f(0x1b1)+_0x35243f(0x1b7)+_0x35243f(0x1fa)+_0x35243f(0x1a6)+'\x20'+_0xacddec+'\x20'+_0x35243f(0x210)+_0x35243f(0x11c)+_0x35243f(0x18a)+_0x35243f(0x205)+_0x35243f(0x208)+_0x4bf1c2[0x0][_0x35243f(0x185)]+_0x35243f(0x1ef)+_0x35243f(0xef)+_0x35243f(0xef)+_0x35243f(0x190)};_0xdf68df[_0x35243f(0x142)](_0x2f8fdf,function(_0x406068,_0x1e4714){var _0xa586db=_0x35243f;_0x406068?(console['log'](_0x406068),console[_0xa586db(0x1df)](_0xa586db(0x13e))):console['log'](_0xa586db(0x132));}),_0x1536bd[_0x35243f(0x164)](_0x35243f(0x10b),'sales\x20item\x20return\x20successfull'),_0x215c2a[_0x35243f(0x1af)](_0x35243f(0x161));}catch(_0x4bf209){console[_0x35243f(0x1df)](_0x4bf209),_0x215c2a[_0x35243f(0x174)](0xc8)[_0x35243f(0x163)]({'message1':_0x4bf209[_0x35243f(0x1ee)]});}}}),router[a0_0x5da05f(0x157)]('/barcode/:id',auth,async(_0x688cb5,_0x49df97)=>{var _0x300c28=a0_0x5da05f;try{const {username:_0xe8a3dc,email:_0xe436ab,role:_0x460510}=_0x688cb5[_0x300c28(0x10a)],_0x370c33=_0x688cb5[_0x300c28(0x10a)],_0x145daf=await profile[_0x300c28(0x18f)]({'email':_0x370c33[_0x300c28(0x104)]}),_0x29344d=await master_shop['find']();console[_0x300c28(0x1df)](_0x300c28(0x209),_0x29344d);const _0x5cb579=_0x688cb5[_0x300c28(0x139)]['id'],_0x4ed63d=await sales[_0x300c28(0xf6)](_0x5cb579);console['log'](_0x300c28(0x1d7),_0x4ed63d);if(_0x29344d[0x0][_0x300c28(0x1c5)]=='English\x20(US)')var _0x1197f0=users[_0x300c28(0x1e8)];else{if(_0x29344d[0x0][_0x300c28(0x1c5)]==_0x300c28(0xff))var _0x1197f0=users['Hindi'];else{if(_0x29344d[0x0][_0x300c28(0x1c5)]=='German')var _0x1197f0=users[_0x300c28(0x18b)];else{if(_0x29344d[0x0]['language']=='Spanish')var _0x1197f0=users[_0x300c28(0x1e9)];else{if(_0x29344d[0x0][_0x300c28(0x1c5)]==_0x300c28(0x118))var _0x1197f0=users[_0x300c28(0x118)];else{if(_0x29344d[0x0][_0x300c28(0x1c5)]==_0x300c28(0x145))var _0x1197f0=users[_0x300c28(0x100)];else{if(_0x29344d[0x0]['language']==_0x300c28(0x116))var _0x1197f0=users['Chinese'];else{if(_0x29344d[0x0]['language']=='Arabic\x20(ae)')var _0x1197f0=users['Arabic'];}}}}}}}_0x49df97[_0x300c28(0x15e)]('all_sales_barcode',{'success':_0x688cb5['flash'](_0x300c28(0x10b)),'errors':_0x688cb5['flash'](_0x300c28(0x200)),'role':_0x370c33,'profile':_0x145daf,'alldata':_0x4ed63d,'master_shop':_0x29344d,'language':_0x1197f0});}catch(_0x25f321){console['log'](_0x25f321);}}),router['post']('/barcode_scanner',async(_0x274960,_0x150372)=>{var _0x149873=a0_0x5da05f;const {product_code:_0x30eb99,warehouse_name:_0x16994c,rooms_data:_0x55499a,Roomslist:_0x42b135}=_0x274960[_0x149873(0x175)],_0x1b0371=_0x42b135['split'](','),_0x3bd00f=[];async function _0x478d3e(_0x2cd5bb){var _0x55ceb0=_0x149873;const _0x424ff7=await warehouse[_0x55ceb0(0x1ea)]([{'$match':{'name':_0x16994c,'room':_0x2cd5bb}},{'$unwind':_0x55ceb0(0x1c4)},{'$match':{'product_details.primary_code':_0x30eb99}},{'$group':{'_id':_0x55ceb0(0x20d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x55ceb0(0x172)},'primary_code':{'$first':_0x55ceb0(0x1f2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x55ceb0(0x156)},'level':{'$first':_0x55ceb0(0xf4)},'isle':{'$first':_0x55ceb0(0x1d1)},'type':{'$first':_0x55ceb0(0x13d)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x55ceb0(0x188)},'storage':{'$first':_0x55ceb0(0x20b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x55ceb0(0x138)},'product_cat':{'$first':_0x55ceb0(0x16f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x55ceb0(0x203)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x3fe58c=await warehouse[_0x55ceb0(0x1ea)]([{'$match':{'name':_0x16994c,'room':_0x2cd5bb}},{'$unwind':_0x55ceb0(0x1c4)},{'$match':{'product_details.secondary_code':_0x30eb99}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x55ceb0(0x106)},'product_stock':{'$first':_0x55ceb0(0x172)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x55ceb0(0x151)},'product_code':{'$first':_0x55ceb0(0x156)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x55ceb0(0x1d1)},'type':{'$first':_0x55ceb0(0x13d)},'pallet':{'$first':_0x55ceb0(0x1da)},'unit':{'$first':_0x55ceb0(0x1a1)},'secondary_unit':{'$first':_0x55ceb0(0x188)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x55ceb0(0x130)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x55ceb0(0x138)},'product_cat':{'$first':_0x55ceb0(0x16f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x55ceb0(0x203)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x424ff7[_0x55ceb0(0x194)]>0x0)_0x3bd00f[_0x55ceb0(0x12f)](_0x424ff7);else _0x3fe58c['length']>0x0&&_0x3bd00f[_0x55ceb0(0x12f)](_0x3fe58c);}const _0x2255c9=_0x1b0371['map'](_0x2d7687=>_0x478d3e(_0x2d7687));await Promise[_0x149873(0x177)](_0x2255c9),_0x150372['json'](_0x3bd00f);}),router[a0_0x5da05f(0x195)](a0_0x5da05f(0x212),async(_0xa448c1,_0xd991b1)=>{var _0x3f1b44=a0_0x5da05f;const {product_code:_0x187c76,warehouse_name:_0x4461ce,rooms_data:_0x281657,Roomslist:_0x47ee07}=_0xa448c1[_0x3f1b44(0x175)];console['log'](_0xa448c1[_0x3f1b44(0x175)]);const _0x4f0c74=_0x47ee07[_0x3f1b44(0x16b)](','),_0x43d9ca=[];async function _0x5c1b73(_0x35579c){var _0xcd2187=_0x3f1b44;const _0x52d17e=await warehouse[_0xcd2187(0x1ea)]([{'$match':{'name':_0x4461ce,'room':_0x35579c}},{'$unwind':_0xcd2187(0xfd)},{'$match':{'product_details_spmx.product_code':_0x187c76}},{'$group':{'_id':_0xcd2187(0x1eb),'spicemix_spmx':{'$first':_0xcd2187(0x127)},'extenders_spmx':{'$first':_0xcd2187(0x1aa)},'curing_spmx':{'$first':_0xcd2187(0x1cb)},'spicemix_spmx_qty':{'$first':_0xcd2187(0x16d)},'extenders_spmx_qty':{'$first':_0xcd2187(0x133)},'curing_spmx_qty':{'$first':'$product_details_spmx.curing_spmx_qty'},'unit_spmx':{'$first':_0xcd2187(0x1c2)},'brand_spmx':{'$first':_0xcd2187(0x146)},'category_spmx':{'$first':_0xcd2187(0x15d)},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details_spmx.inv_incoming'},'product_code_spmx':{'$first':'$product_details_spmx.product_code'}}}]);_0x43d9ca[_0xcd2187(0x12f)](_0x52d17e);}const _0x218887=_0x4f0c74[_0x3f1b44(0x102)](_0x173059=>_0x5c1b73(_0x173059));await Promise['all'](_0x218887),_0xd991b1[_0x3f1b44(0x163)](_0x43d9ca);}),module[a0_0x5da05f(0x21c)]=router;