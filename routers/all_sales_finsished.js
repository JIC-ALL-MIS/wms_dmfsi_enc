var a0_0x566b94=a0_0x10e0;(function(_0x1eb1f0,_0x48cd53){var _0x1a3e51=a0_0x10e0,_0x2af462=_0x1eb1f0();while(!![]){try{var _0x359138=parseInt(_0x1a3e51(0x22d))/0x1*(-parseInt(_0x1a3e51(0x280))/0x2)+parseInt(_0x1a3e51(0x218))/0x3+-parseInt(_0x1a3e51(0x1ef))/0x4*(-parseInt(_0x1a3e51(0x209))/0x5)+parseInt(_0x1a3e51(0x276))/0x6*(parseInt(_0x1a3e51(0x271))/0x7)+-parseInt(_0x1a3e51(0x220))/0x8*(-parseInt(_0x1a3e51(0x19c))/0x9)+parseInt(_0x1a3e51(0x1a1))/0xa+parseInt(_0x1a3e51(0x1d8))/0xb*(-parseInt(_0x1a3e51(0x205))/0xc);if(_0x359138===_0x48cd53)break;else _0x2af462['push'](_0x2af462['shift']());}catch(_0x239565){_0x2af462['push'](_0x2af462['shift']());}}}(a0_0x22ef,0xc2aee));function a0_0x22ef(){var _0x3c5a4b=['4984gsBYVT','$product_details','$sale_product.floorlevel','RoomAssigned','findById','/all_sales_finished/preview/','Spanish','params','<h5\x20style=\x22text-align:\x20left;\x22>','Return\x20Rooms','Arabic','errors','adjust_qty','377lPVjfo','customer_data','sale_product','success','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<strong>\x20Regards\x20</strong>','filter','</thead>','/barcode/:id','carton','production_date_QA','createTransport','Sales\x20Update\x20successfully','post','$finalize','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','concat','secondary_unit','prod_code','note','aggregate','\x20Order\x20Date\x20:\x20','padStart','<tr>','currency','findOne','product_name_QA1','room','/give_payment/:id','</h5>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','primary_code','$product_details.storage','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_cat','$customer','error','/upload/','staff','warehouse','French','<!DOCTYPE\x20html>','logo','gmail','Router','name','maxPerUnit','return_sale','$_id','Sale','language','string','<table\x20style=\x22width:\x20100%\x20!important;\x22>','\x20Order\x20Number\x20:\x20','/all_sales_finished/view','product_stock','$sale_product.bay','all','return_sale_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','expiry_date_QA','Return\x20Goods','$warehouse_name','Enabled','for_categorize','</td>','host','</table>','713279quADut','QA\x20Warehouse','/view','/preview/:id','maxPerUnit_QA','6DLiFxP','status','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.production_date','then','Logo.png','English\x20(US)','\x20<>\x20','</head><body>','add_sales_finished','1948ZtETIl','sale_qty','secondary_code_QA','stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Chinese','add\x20post','split','currency_placement','$room','Sales\x20Add\x20successfully','date','$product_details.type','/../public','primary_unit','product_list','Hindi','English','$product_details.secondary_unit','$sale_product.type','unit_QA','$product_details.product_name','/view/return_sales/:id','Received\x20Payment\x20For\x20Sale','barcode\x20Product\x20master','slice','flash','warehouse_name','render','/invoice/:id','Sale\x20Return','prod_invoice','FGSEmail','Arabic\x20(ae)','product_date','all_sales_finished','sendMail','$date','save','Sale\x20Return\x20Mail','barcode\x20user_id','$product_details.product_code','DRY\x20GOODS','production_date','getDate','$product_details.bay','$product_details.unit','German','\x20</h2>','Quality\x20Inspection','return_data','</tr>','<span\x20style=\x22float:\x20right;\x22>','abs','find','387Foysnh','$invoice','customer','product','quantity','7275280LaVvUM','password','Email\x20sent\x20successfully','amount','toString','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<h5>','room_name','get','Finished\x20Goods','$product_details.rack','</tbody>','sales_invoice','\x20&&\x20','../public/language/languages.json','level','customers','OUTF-','<hr\x20class=\x22my-3\x22>','$product_details.bin','</div>','return_qty_QA','sales_quantity','<div>','stocks_QA','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','length','master','maxperunit','batch_code_QA','$product_details.secondary_code','catch','/all_sales/view','return_qty','image','return_sale_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$name','$note','/view/add_sales','redirect','getFullYear','Ambient','An\x20error\x20occurred.','/barcode_scanner','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','max_per_unit','suppliers','False','../middleware/auth','product_details','$product_details.primary_code','due_amount','product_name','<h2>\x20','157751LSAgHs','foreach\x20newproduct','Portuguese','invoice','email','$product_details.floorlevel','body','expiry_date','$customers_docs','<html><head><title></title>','site_title','finalize','</span>','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$product_details.expiry_date','</body></html>','exports','express','role','\x20>>>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_code_QA','4KeTmss','back','$product_details._id','$product_details.room_name','forEach','bay','log','batch_code','$sale_product.quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Error\x20Occurs','edit_sales_finished','received_amount','$product_details.product_cat','secondary_code','$product_details.invoice','sales_quantity_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Sales\x20Mail','json','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','900LrowQK','random','floor','user','6042860INzDns','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','product_code','sales\x20item\x20return\x20successfull','$product_details.batch_code','True','payment\x20successfull','/picking_list/pdf/','$return_data','unit','\x20==\x20','$product_details.maxPerUnit','customers_docs','maxProducts_QA','map','526227zHhHAR','/view/add_sale/product','maxProducts','push','/view/:id','primary_code_QA','$product_details.product_stock','message'];a0_0x22ef=function(){return _0x3c5a4b;};return a0_0x22ef();}const express=require(a0_0x566b94(0x1ea)),app=express(),router=express[a0_0x566b94(0x259)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x566b94(0x1d2)),nodemailer=require(a0_0x566b94(0x203)),users=require(a0_0x566b94(0x1af));function a0_0x10e0(_0x25b07c,_0xeadcbf){var _0x22effd=a0_0x22ef();return a0_0x10e0=function(_0x10e01b,_0x150a27){_0x10e01b=_0x10e01b-0x187;var _0x11a806=_0x22effd[_0x10e01b];return _0x11a806;},a0_0x10e0(_0x25b07c,_0xeadcbf);}router[a0_0x566b94(0x1a9)](a0_0x566b94(0x273),auth,async(_0xf7d5eb,_0xdc2c71)=>{var _0x542e44=a0_0x566b94;try{const {username:_0x545d29,email:_0x19286c,role:_0x200b55}=_0xf7d5eb[_0x542e44(0x208)],_0x49f6b5=_0xf7d5eb['user'],_0x39fa5e=await profile[_0x542e44(0x246)]({'email':_0x49f6b5[_0x542e44(0x1dc)]}),_0x57303f=await master_shop['find']();let _0x290e2f;if(_0x49f6b5['role']==_0x542e44(0x253)){const _0x16b441=await staff[_0x542e44(0x246)]({'email':_0x49f6b5['email']});_0x290e2f=await sales_finished['aggregate']([{'$lookup':{'from':_0x542e44(0x1b1),'localField':_0x542e44(0x19e),'foreignField':_0x542e44(0x25a),'as':_0x542e44(0x215)}},{'$unwind':_0x542e44(0x1e0)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x542e44(0x25d),'invoice':{'$first':_0x542e44(0x19d)},'customers':{'$first':_0x542e44(0x250)},'date':{'$first':_0x542e44(0x18a)},'warehouse_name':{'$first':_0x542e44(0x26b)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x542e44(0x1c7)},'return_data':{'$first':_0x542e44(0x211)},'customers_docs':{'$first':_0x542e44(0x1e0)},'total_saleproduct_quantity':{'$sum':_0x542e44(0x1f7)},'level':{'$addToSet':_0x542e44(0x265)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x542e44(0x293)},'pallet':{'$addToSet':_0x542e44(0x222)},'finalize':{'$first':_0x542e44(0x23b)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x290e2f=await sales_finished['aggregate']([{'$lookup':{'from':_0x542e44(0x1b1),'localField':_0x542e44(0x19e),'foreignField':_0x542e44(0x25a),'as':_0x542e44(0x215)}},{'$unwind':_0x542e44(0x1e0)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x542e44(0x25d),'invoice':{'$first':_0x542e44(0x19d)},'customers':{'$first':_0x542e44(0x250)},'date':{'$first':_0x542e44(0x18a)},'warehouse_name':{'$first':_0x542e44(0x26b)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x542e44(0x1e0)},'total_saleproduct_quantity':{'$sum':_0x542e44(0x1f7)},'level':{'$addToSet':_0x542e44(0x265)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x542e44(0x293)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x57303f[0x0]['language']=='English\x20(US)'){var _0x54c575=users[_0x542e44(0x291)];console[_0x542e44(0x1f5)](_0x54c575);}else{if(_0x57303f[0x0]['language']=='Hindi')var _0x54c575=users[_0x542e44(0x290)];else{if(_0x57303f[0x0]['language']==_0x542e44(0x194))var _0x54c575=users[_0x542e44(0x194)];else{if(_0x57303f[0x0][_0x542e44(0x25f)]==_0x542e44(0x226))var _0x54c575=users[_0x542e44(0x226)];else{if(_0x57303f[0x0][_0x542e44(0x25f)]==_0x542e44(0x255))var _0x54c575=users[_0x542e44(0x255)];else{if(_0x57303f[0x0][_0x542e44(0x25f)]==_0x542e44(0x1e5))var _0x54c575=users['Portuguese'];else{if(_0x57303f[0x0][_0x542e44(0x25f)]==_0x542e44(0x285))var _0x54c575=users[_0x542e44(0x285)];else{if(_0x57303f[0x0][_0x542e44(0x25f)]=='Arabic\x20(ae)')var _0x54c575=users['Arabic'];}}}}}}}_0xdc2c71[_0x542e44(0x29c)](_0x542e44(0x188),{'success':_0xf7d5eb['flash'](_0x542e44(0x230)),'errors':_0xf7d5eb[_0x542e44(0x29a)](_0x542e44(0x22b)),'sales':_0x290e2f,'profile':_0x39fa5e,'role':_0x49f6b5,'master_shop':_0x57303f,'language':_0x54c575});}catch(_0x239f0f){console['log'](_0x239f0f);}});async function getRandom8DigitNumber(){var _0x578fc7=a0_0x566b94;const _0x154f1f=0x989680,_0x18ce56=0x5f5e0ff,_0x42d3b3=Math[_0x578fc7(0x207)](Math[_0x578fc7(0x206)]()*(_0x18ce56-_0x154f1f+0x1))+_0x154f1f;var _0x13e0c6;const _0x13dd3a=await sales_finished['findOne']({'invoice':_0x578fc7(0x1b2)+_0x42d3b3});return _0x13dd3a&&_0x13dd3a[_0x578fc7(0x1bb)]>0x0?_0x13e0c6='OUTF-'+_0x42d3b3:_0x13e0c6='OUTF-'+_0x42d3b3,_0x13e0c6;}router[a0_0x566b94(0x1a9)]('/view/add_sales',auth,async(_0x30246c,_0x2a58c5)=>{var _0x583c2d=a0_0x566b94;try{const {username:_0x3e2e96,email:_0x47476d,role:_0x5aeda8}=_0x30246c[_0x583c2d(0x208)],_0x5efc7e=_0x30246c['user'],_0x1d8f9f=await profile[_0x583c2d(0x246)]({'email':_0x5efc7e[_0x583c2d(0x1dc)]}),_0x7c0b1b=await master_shop[_0x583c2d(0x19b)](),_0x3ade4d=await customer[_0x583c2d(0x19b)]({});let _0x3237ac;if(_0x5efc7e[_0x583c2d(0x1eb)]==_0x583c2d(0x253)){const _0x398b84=await staff[_0x583c2d(0x246)]({'email':_0x5efc7e[_0x583c2d(0x1dc)]});_0x3237ac=await warehouse[_0x583c2d(0x241)]([{'$match':{'status':_0x583c2d(0x26c),'name':_0x398b84['warehouse'],'warehouse_category':_0x583c2d(0x1aa),'name':{'$ne':_0x583c2d(0x272)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x3237ac=await warehouse[_0x583c2d(0x241)]([{'$match':{'status':_0x583c2d(0x26c),'warehouse_category':_0x583c2d(0x1aa),'name':{'$ne':_0x583c2d(0x272)}}},{'$group':{'_id':_0x583c2d(0x1c6),'name':{'$first':_0x583c2d(0x1c6)}}},{'$sort':{'name':0x1}}]);const _0x295e98=await product[_0x583c2d(0x19b)]({});var _0x17afde=[_0x583c2d(0x1cb),'Enclosed'];const _0x335ba6=await sales_finished[_0x583c2d(0x19b)]({}),_0x3e721b=_0x335ba6[_0x583c2d(0x1bb)]+0x1,_0x24b81c='OUTF-'+_0x3e721b[_0x583c2d(0x1a5)]()[_0x583c2d(0x243)](0x5,'0');if(_0x7c0b1b[0x0]['language']==_0x583c2d(0x27c)){var _0x331476=users[_0x583c2d(0x291)];console[_0x583c2d(0x1f5)](_0x331476);}else{if(_0x7c0b1b[0x0]['language']==_0x583c2d(0x290))var _0x331476=users[_0x583c2d(0x290)];else{if(_0x7c0b1b[0x0][_0x583c2d(0x25f)]==_0x583c2d(0x194))var _0x331476=users[_0x583c2d(0x194)];else{if(_0x7c0b1b[0x0][_0x583c2d(0x25f)]==_0x583c2d(0x226))var _0x331476=users[_0x583c2d(0x226)];else{if(_0x7c0b1b[0x0][_0x583c2d(0x25f)]=='French')var _0x331476=users[_0x583c2d(0x255)];else{if(_0x7c0b1b[0x0][_0x583c2d(0x25f)]==_0x583c2d(0x1e5))var _0x331476=users[_0x583c2d(0x1da)];else{if(_0x7c0b1b[0x0][_0x583c2d(0x25f)]=='Chinese')var _0x331476=users['Chinese'];else{if(_0x7c0b1b[0x0][_0x583c2d(0x25f)]==_0x583c2d(0x2a1))var _0x331476=users[_0x583c2d(0x22a)];}}}}}}}const _0x1e82ff=getRandom8DigitNumber();_0x1e82ff['then'](_0x5042bf=>{var _0x266742=_0x583c2d;_0x2a58c5[_0x266742(0x29c)](_0x266742(0x27f),{'success':_0x30246c[_0x266742(0x29a)](_0x266742(0x230)),'errors':_0x30246c['flash'](_0x266742(0x22b)),'role':_0x5efc7e,'profile':_0x1d8f9f,'customer':_0x3ade4d,'warehouse':_0x3237ac,'product':_0x295e98,'invoice':_0x5042bf,'master_shop':_0x7c0b1b,'language':_0x331476,'rooms_data':_0x17afde});})[_0x583c2d(0x1c0)](_0x233964=>{var _0x2ebed5=_0x583c2d;_0x30246c[_0x2ebed5(0x29a)](_0x2ebed5(0x22b),_0x2ebed5(0x1a6)),_0x2a58c5['redirect'](_0x2ebed5(0x263));});}catch(_0x1a23d9){console[_0x583c2d(0x1f5)](_0x1a23d9);}}),router[a0_0x566b94(0x1a9)]('/view/add_sales/:id',auth,async(_0x17e827,_0x74ac5f)=>{var _0x4b12df=a0_0x566b94;try{const _0x14a29a=_0x17e827[_0x4b12df(0x227)]['id'];console[_0x4b12df(0x1f5)](_0x14a29a);const _0x511e95=await product['find'](),_0x5745a9=await purchases[_0x4b12df(0x241)]([{'$match':{'warehouse_name':_0x14a29a}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x4b12df(0x1f5)]('purchases_data',_0x5745a9),_0x74ac5f[_0x4b12df(0x277)](0xc8)[_0x4b12df(0x202)]({'purchases_data':_0x5745a9,'product_data':_0x511e95});}catch(_0x5beae5){console[_0x4b12df(0x1f5)](_0x5beae5);}}),router['post'](a0_0x566b94(0x219),auth,async(_0x2fbae2,_0x60c3ed)=>{var _0x1d84f9=a0_0x566b94;try{const {warehouse_data:_0x262a5c,product_data:_0x153458}=_0x2fbae2[_0x1d84f9(0x1de)];console['log'](_0x2fbae2[_0x1d84f9(0x1de)]['product_data']);;const _0x5eec01=await master_shop[_0x1d84f9(0x19b)]();console[_0x1d84f9(0x1f5)](_0x1d84f9(0x1bc),_0x5eec01);const _0x5bca90=await product[_0x1d84f9(0x246)]({'name':_0x153458});console[_0x1d84f9(0x1f5)](_0x1d84f9(0x19f),_0x5bca90);const _0xf4c58=await warehouse[_0x1d84f9(0x241)]([{'$match':{'name':_0x262a5c}},{'$unwind':_0x1d84f9(0x221)},{'$match':{'product_details.product_name':_0x153458}},{'$group':{'_id':_0x1d84f9(0x295),'product_stock':{'$first':_0x1d84f9(0x21e)}}}]);console[_0x1d84f9(0x1f5)]('stock_data',_0xf4c58),_0x60c3ed['status'](0xc8)['json']({'master':_0x5eec01,'new_product':_0x5bca90,'stock_data':_0xf4c58});}catch(_0x586326){console[_0x1d84f9(0x1f5)](_0x586326);}}),router[a0_0x566b94(0x23a)](a0_0x566b94(0x1c8),auth,async(_0x38f505,_0x434a59)=>{var _0x3fd3e1=a0_0x566b94;try{const {invoice:_0x3c3203,date:_0x33965a,warehouse_name:_0x348460,product_name:_0x449988,stock:_0x482c4c,quantity:_0x54f41e,note:_0xbdc2a0,room:_0x3a1d5a,primary_code:_0xa669cf,secondary_code:_0x5a854b,prod_code:_0x462547,level:_0x18934c,isle:_0x340c0f,pallet:_0x4e2fb4,batch_code:_0x3cb6fb,SCRN:_0x55d63c,expiry_date:_0x5bb9d8,mode_transpo:_0x21ba62,name_driver:_0xae014}=_0x38f505['body'];if(typeof _0x449988=='string')var _0x571c16=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x1d6)]],_0x5034a2=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x283)]],_0x361318=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x236)]],_0x57d2b5=[_0x38f505['body'][_0x3fd3e1(0x24c)]],_0x4d8c52=[_0x38f505['body'][_0x3fd3e1(0x1fd)]],_0x11e641=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x23f)]],_0x2f6cdb=[_0x38f505[_0x3fd3e1(0x1de)]['level']],_0x585c15=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x28e)]],_0x2e899a=[_0x38f505['body']['secondary_unit']],_0x24ac10=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x1f6)]],_0x53acb7=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x1df)]],_0x22045a=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x187)]],_0x127f1a=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x1cf)]],_0x446879=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x24f)]],_0x4d1437=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x223)]],_0x42bded=[_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x29f)]];else var _0x571c16=[..._0x38f505[_0x3fd3e1(0x1de)]['product_name']],_0x5034a2=[..._0x38f505['body'][_0x3fd3e1(0x283)]],_0x361318=[..._0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x236)]],_0x57d2b5=[..._0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x24c)]],_0x4d8c52=[..._0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x1fd)]],_0x11e641=[..._0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x23f)]],_0x2f6cdb=[..._0x38f505[_0x3fd3e1(0x1de)]['level']],_0x585c15=[..._0x38f505['body'][_0x3fd3e1(0x28e)]],_0x2e899a=[..._0x38f505['body'][_0x3fd3e1(0x23e)]],_0x24ac10=[..._0x38f505['body'][_0x3fd3e1(0x1f6)]],_0x53acb7=[..._0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x1df)]],_0x22045a=[..._0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x187)]],_0x127f1a=[..._0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x1cf)]],_0x446879=[..._0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x24f)]],_0x4d1437=[..._0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x223)]],_0x42bded=[..._0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x29f)]];const _0x2d4304=_0x571c16[_0x3fd3e1(0x217)](_0x2dd5d5=>{return _0x2dd5d5={'product_name':_0x2dd5d5};});_0x5034a2[_0x3fd3e1(0x1f3)]((_0x2e6861,_0x382787)=>{_0x2d4304[_0x382787]['stock']=_0x2e6861;}),_0x361318[_0x3fd3e1(0x1f3)]((_0x5df76f,_0x194f10)=>{var _0x43a066=_0x3fd3e1;_0x2d4304[_0x194f10]['quantity']=Math[_0x43a066(0x19a)](_0x5df76f);}),_0x57d2b5[_0x3fd3e1(0x1f3)]((_0x10e968,_0x5e09aa)=>{var _0x284fb3=_0x3fd3e1;_0x2d4304[_0x5e09aa][_0x284fb3(0x24c)]=_0x10e968;}),_0x4d8c52[_0x3fd3e1(0x1f3)]((_0x52a325,_0x156764)=>{var _0x1b7a0d=_0x3fd3e1;_0x2d4304[_0x156764][_0x1b7a0d(0x1fd)]=_0x52a325;}),_0x11e641[_0x3fd3e1(0x1f3)]((_0x5b7cc3,_0x43c000)=>{_0x2d4304[_0x43c000]['product_code']=_0x5b7cc3;}),_0x2f6cdb[_0x3fd3e1(0x1f3)]((_0x45a574,_0x1b31d9)=>{var _0x46047d=_0x3fd3e1;_0x2d4304[_0x1b31d9][_0x46047d(0x1f4)]=_0x45a574;}),_0x585c15[_0x3fd3e1(0x1f3)]((_0x19ea19,_0x4be5f5)=>{_0x2d4304[_0x4be5f5]['unit']=_0x19ea19;}),_0x2e899a[_0x3fd3e1(0x1f3)]((_0x59efca,_0x31c8a9)=>{_0x2d4304[_0x31c8a9]['secondary_unit']=_0x59efca;}),_0x24ac10[_0x3fd3e1(0x1f3)]((_0x3739b7,_0x4cabfa)=>{_0x2d4304[_0x4cabfa]['batch_code']=_0x3739b7;}),_0x53acb7[_0x3fd3e1(0x1f3)]((_0x1d9fdf,_0x2263de)=>{_0x2d4304[_0x2263de]['expiry_date']=_0x1d9fdf;}),_0x22045a[_0x3fd3e1(0x1f3)]((_0x1fc5ea,_0xc89749)=>{var _0x45db44=_0x3fd3e1;_0x2d4304[_0xc89749][_0x45db44(0x190)]=_0x1fc5ea;}),_0x127f1a[_0x3fd3e1(0x1f3)]((_0x5e8d04,_0x1ced5b)=>{var _0x7ba2b=_0x3fd3e1;_0x2d4304[_0x1ced5b][_0x7ba2b(0x1bd)]=_0x5e8d04;}),_0x446879[_0x3fd3e1(0x1f3)]((_0xb17451,_0x2809d6)=>{var _0x23c080=_0x3fd3e1;_0x2d4304[_0x2809d6][_0x23c080(0x24f)]=_0xb17451;}),_0x4d1437['forEach']((_0x1f530c,_0x43eb57)=>{var _0x535dba=_0x3fd3e1;_0x2d4304[_0x43eb57][_0x535dba(0x1a8)]=_0x1f530c;}),_0x42bded['forEach']((_0x13b1b2,_0x5af6b6)=>{var _0x497672=_0x3fd3e1;_0x2d4304[_0x5af6b6][_0x497672(0x1db)]=_0x13b1b2;});var _0x1cfdb7=0x0;_0x2d4304[_0x3fd3e1(0x1f3)](_0x2b1bdc=>{var _0x48b778=_0x3fd3e1;parseFloat(_0x2b1bdc[_0x48b778(0x283)])<parseFloat(_0x2b1bdc['quantity'])&&parseFloat(_0x2b1bdc[_0x48b778(0x1a0)])>parseFloat(_0x2b1bdc['stock'])&&(console[_0x48b778(0x1f5)](_0x2b1bdc['stock']+_0x48b778(0x27d)+_0x2b1bdc[_0x48b778(0x1a0)]),_0x1cfdb7++);});if(_0x1cfdb7!=0x0)return _0x38f505[_0x3fd3e1(0x29a)]('errors',_0x3fd3e1(0x20a)),_0x434a59['redirect'](_0x3fd3e1(0x1f0));const _0x4dd161=_0x2d4304[_0x3fd3e1(0x233)](_0x23b58f=>_0x23b58f[_0x3fd3e1(0x1a0)]!=='0'&&_0x23b58f[_0x3fd3e1(0x1a0)]!==''),_0x602a3b=new sales_finished({'invoice':_0x3c3203,'customer':_0x38f505[_0x3fd3e1(0x1de)]['customer'],'date':_0x33965a,'warehouse_name':_0x348460,'sale_product':_0x4dd161,'note':_0xbdc2a0,'room':_0x3a1d5a,'primary_code':_0xa669cf,'secondary_code':_0x5a854b,'prod_code':_0x462547,'SCRN':_0x55d63c,'finalize':_0x3fd3e1(0x1d1),'mode_transpo':_0x21ba62,'name_driver':_0xae014}),_0x2cdace=await _0x602a3b[_0x3fd3e1(0x18b)](),_0x3d616a=await sales_finished[_0x3fd3e1(0x246)]({'invoice':_0x3c3203}),_0x596d8f=new c_payment_data({'invoice':_0x3c3203,'customer':_0x38f505[_0x3fd3e1(0x1de)]['customer'],'reason':_0x3fd3e1(0x25e)});await _0x596d8f[_0x3fd3e1(0x18b)]();const _0x35bd14=await master_shop['find'](),_0x506a25=await email_settings['findOne'](),_0x37ca9f=await customer[_0x3fd3e1(0x246)]({'name':_0x38f505[_0x3fd3e1(0x1de)][_0x3fd3e1(0x19e)]});_0x35bd14[0x0][_0x3fd3e1(0x288)]==0x1?(right_currency=_0x35bd14[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x35bd14[0x0]['currency']);var _0x558ba7=_0x571c16,_0x21f024=_0x361318,_0x6db186='',_0x59e1e7;for(_0x59e1e7 in _0x558ba7){_0x6db186+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x558ba7[_0x59e1e7]+_0x3fd3e1(0x26e)+_0x3fd3e1(0x278)+_0x21f024[_0x59e1e7]+_0x3fd3e1(0x26e)+_0x3fd3e1(0x198);}console[_0x3fd3e1(0x1f5)]('product_list',_0x6db186);let _0x2042c7=nodemailer[_0x3fd3e1(0x238)]({'service':'gmail','auth':{'user':_0x506a25[_0x3fd3e1(0x1dc)],'pass':_0x506a25[_0x3fd3e1(0x1a2)]}}),_0x18ea6e={'from':_0x506a25[_0x3fd3e1(0x1dc)],'to':_0x37ca9f[_0x3fd3e1(0x1dc)],'subject':'Sale\x20Product\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x3fd3e1(0x28d)+_0x3fd3e1(0x252)+_0x35bd14[0x0][_0x3fd3e1(0x1c3)],'cid':_0x3fd3e1(0x257)}],'html':_0x3fd3e1(0x256)+'<html><head><title></title>'+'</head><body>'+_0x3fd3e1(0x1b8)+_0x3fd3e1(0x1ba)+'<div>'+_0x3fd3e1(0x24b)+_0x3fd3e1(0x1b5)+'<div>'+'<h2>\x20'+_0x35bd14[0x0][_0x3fd3e1(0x1e2)]+_0x3fd3e1(0x195)+_0x3fd3e1(0x1b5)+_0x3fd3e1(0x1b5)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x3fd3e1(0x228)+_0x3fd3e1(0x262)+_0x3c3203+'\x20'+_0x3fd3e1(0x199)+'\x20Order\x20Date\x20:\x20'+_0x33965a+'\x20'+_0x3fd3e1(0x1e4)+_0x3fd3e1(0x24a)+_0x3fd3e1(0x1b5)+_0x3fd3e1(0x261)+_0x3fd3e1(0x1ce)+_0x3fd3e1(0x244)+_0x3fd3e1(0x1ed)+_0x3fd3e1(0x268)+'</tr>'+_0x3fd3e1(0x234)+_0x3fd3e1(0x24e)+'\x20'+_0x6db186+'\x20'+_0x3fd3e1(0x1ac)+_0x3fd3e1(0x270)+_0x3fd3e1(0x1b8)+'<strong>\x20Regards\x20</strong>'+_0x3fd3e1(0x1a7)+_0x35bd14[0x0]['site_title']+_0x3fd3e1(0x24a)+_0x3fd3e1(0x1b5)+_0x3fd3e1(0x1b5)+_0x3fd3e1(0x1e8)};_0x2042c7[_0x3fd3e1(0x189)](_0x18ea6e,function(_0x3d222e,_0x26606d){var _0x5a9ad0=_0x3fd3e1;_0x3d222e?(console[_0x5a9ad0(0x1f5)](_0x3d222e),console[_0x5a9ad0(0x1f5)](_0x5a9ad0(0x1f9))):console[_0x5a9ad0(0x1f5)](_0x5a9ad0(0x1a3));}),_0x38f505[_0x3fd3e1(0x29a)](_0x3fd3e1(0x230),_0x3fd3e1(0x28a)),_0x434a59['redirect'](_0x3fd3e1(0x225)+_0x2cdace['_id']);}catch(_0x4d8734){console[_0x3fd3e1(0x1f5)](_0x4d8734);}}),router[a0_0x566b94(0x1a9)](a0_0x566b94(0x274),auth,async(_0xbb310b,_0x3c3537)=>{var _0x1bbe7d=a0_0x566b94;try{const {username:_0x55761f,email:_0x5a2555,role:_0x6719bf}=_0xbb310b[_0x1bbe7d(0x208)],_0x52e01d=_0xbb310b['user'],_0x4e9925=await profile['findOne']({'email':_0x52e01d['email']}),_0x18a9ae=await master_shop[_0x1bbe7d(0x19b)](),_0x47a4e3=_0xbb310b[_0x1bbe7d(0x227)]['id'],_0x25cc44=await sales_finished[_0x1bbe7d(0x224)](_0x47a4e3),_0x17d0d8=await warehouse[_0x1bbe7d(0x241)]([{'$match':{'name':_0x25cc44['warehouse_name']}},{'$unwind':_0x1bbe7d(0x221)},{'$group':{'_id':_0x1bbe7d(0x1f1),'name':{'$first':_0x1bbe7d(0x295)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1bbe7d(0x192)},'bin':{'$first':_0x1bbe7d(0x1b4)},'type':{'$first':_0x1bbe7d(0x28c)},'floorlevel':{'$first':_0x1bbe7d(0x1dd)},'primary_code':{'$first':_0x1bbe7d(0x1d4)},'secondary_code':{'$first':_0x1bbe7d(0x1bf)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1bbe7d(0x1ab)},'expiry_date':{'$first':_0x1bbe7d(0x1e7)},'production_date':{'$first':_0x1bbe7d(0x279)},'batch_code':{'$first':_0x1bbe7d(0x20d)},'room':{'$first':_0x1bbe7d(0x289)},'room_data':{'$first':_0x1bbe7d(0x1f2)}}}]),_0x3d07d6=await customer[_0x1bbe7d(0x19b)]({});let _0x27cca1;if(_0x52e01d[_0x1bbe7d(0x1eb)]=='staff'){const _0x4d9613=await staff[_0x1bbe7d(0x246)]({'email':_0x52e01d['email']});_0x27cca1=await warehouse[_0x1bbe7d(0x241)]([{'$match':{'status':_0x1bbe7d(0x26c),'name':_0x4d9613[_0x1bbe7d(0x254)]}},{'$group':{'_id':_0x1bbe7d(0x1c6),'name':{'$first':_0x1bbe7d(0x1c6)}}}]);}else _0x27cca1=await warehouse['aggregate']([{'$match':{'status':_0x1bbe7d(0x26c)}},{'$group':{'_id':_0x1bbe7d(0x1c6),'name':{'$first':_0x1bbe7d(0x1c6)}}}]);const _0x35b12c=await product[_0x1bbe7d(0x19b)]({});if(_0x18a9ae[0x0][_0x1bbe7d(0x25f)]==_0x1bbe7d(0x27c)){var _0x545cf2=users[_0x1bbe7d(0x291)];console[_0x1bbe7d(0x1f5)](_0x545cf2);}else{if(_0x18a9ae[0x0][_0x1bbe7d(0x25f)]==_0x1bbe7d(0x290))var _0x545cf2=users[_0x1bbe7d(0x290)];else{if(_0x18a9ae[0x0][_0x1bbe7d(0x25f)]=='German')var _0x545cf2=users['German'];else{if(_0x18a9ae[0x0][_0x1bbe7d(0x25f)]==_0x1bbe7d(0x226))var _0x545cf2=users[_0x1bbe7d(0x226)];else{if(_0x18a9ae[0x0]['language']==_0x1bbe7d(0x255))var _0x545cf2=users[_0x1bbe7d(0x255)];else{if(_0x18a9ae[0x0]['language']==_0x1bbe7d(0x1e5))var _0x545cf2=users[_0x1bbe7d(0x1da)];else{if(_0x18a9ae[0x0][_0x1bbe7d(0x25f)]==_0x1bbe7d(0x285))var _0x545cf2=users[_0x1bbe7d(0x285)];else{if(_0x18a9ae[0x0][_0x1bbe7d(0x25f)]==_0x1bbe7d(0x2a1))var _0x545cf2=users[_0x1bbe7d(0x22a)];}}}}}}}_0x3c3537[_0x1bbe7d(0x29c)]('edit_sales_finished_view',{'success':_0xbb310b['flash'](_0x1bbe7d(0x230)),'errors':_0xbb310b[_0x1bbe7d(0x29a)](_0x1bbe7d(0x22b)),'role':_0x52e01d,'profile':_0x4e9925,'customer':_0x3d07d6,'warehouse':_0x27cca1,'product':_0x17d0d8,'user':_0x25cc44,'master_shop':_0x18a9ae,'unit':_0x35b12c,'language':_0x545cf2});}catch(_0xb022c4){console[_0x1bbe7d(0x1f5)](_0xb022c4);}}),router['post']('/preview/:id',auth,async(_0x3e4db2,_0x3a57d9)=>{var _0x3b95f2=a0_0x566b94;try{const _0x4aae1f=_0x3e4db2[_0x3b95f2(0x227)]['id'],{invoice:_0x527b19,warehouse_name:_0x5126c4,room:_0x40f4d7}=_0x3e4db2[_0x3b95f2(0x1de)],_0x574c78=await sales_finished[_0x3b95f2(0x246)]({'invoice':_0x527b19}),_0x40f1ee=_0x574c78['sale_product'][_0x3b95f2(0x217)](async _0x1a1e42=>{var _0xf0c0ab=_0x3b95f2,_0x3b27c7=await warehouse[_0xf0c0ab(0x246)]({'name':_0x5126c4,'room':_0x1a1e42['room_name'],'warehouse_category':_0xf0c0ab(0x1aa)});const _0x1e7c1a=_0x3b27c7['product_details'][_0xf0c0ab(0x217)](_0x5c2275=>{var _0x5095a3=_0xf0c0ab;_0x5c2275[_0x5095a3(0x1d6)]==_0x1a1e42[_0x5095a3(0x1d6)]&&_0x5c2275[_0x5095a3(0x1f4)]==_0x1a1e42[_0x5095a3(0x1f4)]&&_0x5c2275[_0x5095a3(0x1df)]==_0x1a1e42['expiry_date']&&_0x5c2275[_0x5095a3(0x190)]==_0x1a1e42[_0x5095a3(0x190)]&&_0x5c2275[_0x5095a3(0x1f6)]==_0x1a1e42[_0x5095a3(0x1f6)]&&_0x5c2275['invoice']==_0x1a1e42[_0x5095a3(0x1db)]&&(console[_0x5095a3(0x1f5)](_0x5c2275['product_name']+_0x5095a3(0x213)+_0x1a1e42[_0x5095a3(0x1d6)]+'\x20&&\x20'+_0x5c2275[_0x5095a3(0x1f4)]+_0x5095a3(0x213)+_0x1a1e42[_0x5095a3(0x1f4)]+'\x20&&\x20'+_0x5c2275['production_date']+_0x5095a3(0x213)+_0x1a1e42[_0x5095a3(0x190)]+_0x5095a3(0x1ae)+_0x5c2275['expiry_date']+'\x20==\x20'+_0x1a1e42[_0x5095a3(0x1df)]+_0x5095a3(0x1ae)+_0x5c2275['batch_code']+_0x5095a3(0x213)+_0x1a1e42['batch_code']+_0x5095a3(0x1ae)+_0x5c2275[_0x5095a3(0x1db)]+_0x5095a3(0x213)+_0x1a1e42[_0x5095a3(0x1db)]+'\x20&&\x20'+_0x5c2275[_0x5095a3(0x264)]+'\x20==\x20'+_0x1a1e42[_0x5095a3(0x1a0)]+_0x5095a3(0x1ec)+_0x1a1e42[_0x5095a3(0x1a8)]),_0x5c2275[_0x5095a3(0x264)]>0x0&&(_0x5c2275['product_stock']=Math['abs'](Math[_0x5095a3(0x19a)](_0x5c2275[_0x5095a3(0x264)])-Math[_0x5095a3(0x19a)](_0x1a1e42['quantity']))));});return _0x3b27c7;});Promise[_0x3b95f2(0x266)](_0x40f1ee)[_0x3b95f2(0x27a)](async _0x554b75=>{var _0x4b26ef=_0x3b95f2;try{_0x3a57d9[_0x4b26ef(0x202)](_0x554b75);return;for(const _0x58f218 of _0x554b75){await _0x58f218[_0x4b26ef(0x18b)]();}_0x574c78[_0x4b26ef(0x1e3)]='True';const _0x50ded4=await _0x574c78['save'](),_0x32e326=await master_shop[_0x4b26ef(0x19b)](),_0x526343=await email_settings[_0x4b26ef(0x246)](),_0x30cb31=await supervisor_settings[_0x4b26ef(0x19b)]();var _0x3e9a8e=_0x574c78[_0x4b26ef(0x22f)],_0x4733ed='',_0x4a3b11;for(_0x4a3b11 in _0x3e9a8e){var _0x4593bf='FG';_0x574c78[_0x4b26ef(0x29b)]==_0x4b26ef(0x18f)&&(_0x4593bf='DG'),_0x4733ed+=_0x4b26ef(0x244)+_0x4b26ef(0x278)+_0x3e9a8e[_0x4a3b11][_0x4b26ef(0x1d6)]+_0x4b26ef(0x26e)+_0x4b26ef(0x278)+_0x3e9a8e[_0x4a3b11][_0x4b26ef(0x20b)]+_0x4b26ef(0x26e)+_0x4b26ef(0x278)+_0x3e9a8e[_0x4a3b11][_0x4b26ef(0x1a0)]+_0x4b26ef(0x26e)+_0x4b26ef(0x278)+_0x3e9a8e[_0x4a3b11][_0x4b26ef(0x212)]+_0x4b26ef(0x26e)+_0x4b26ef(0x278)+_0x3e9a8e[_0x4a3b11]['secondary_unit']+_0x4b26ef(0x26e)+_0x4b26ef(0x278)+_0x574c78[_0x4b26ef(0x29b)]+_0x4b26ef(0x26e)+_0x4b26ef(0x278)+_0x3e9a8e[_0x4a3b11][_0x4b26ef(0x1a8)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4593bf+_0x3e9a8e[_0x4a3b11][_0x4b26ef(0x1f4)]+_0x4b26ef(0x26e);}let _0x5a7db0=nodemailer[_0x4b26ef(0x238)]({'host':_0x526343[_0x4b26ef(0x26f)],'port':Number(_0x526343['port']),'secure':![],'auth':{'user':_0x526343['email'],'pass':_0x526343['password']}}),_0x441831={'from':_0x526343[_0x4b26ef(0x1dc)],'to':_0x30cb31[0x0][_0x4b26ef(0x2a0)],'subject':_0x4b26ef(0x201),'attachments':[{'filename':_0x4b26ef(0x27b),'path':__dirname+_0x4b26ef(0x28d)+_0x4b26ef(0x252)+_0x32e326[0x0][_0x4b26ef(0x1c3)],'cid':_0x4b26ef(0x257)}],'html':'<!DOCTYPE\x20html>'+_0x4b26ef(0x1e1)+'</head><body>'+_0x4b26ef(0x1b8)+_0x4b26ef(0x1ba)+_0x4b26ef(0x1b8)+_0x4b26ef(0x24b)+_0x4b26ef(0x1b5)+_0x4b26ef(0x1b8)+_0x4b26ef(0x1d7)+_0x32e326[0x0]['site_title']+_0x4b26ef(0x195)+_0x4b26ef(0x1b5)+'</div>'+_0x4b26ef(0x1b3)+_0x4b26ef(0x1b8)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4b26ef(0x262)+_0x574c78[_0x4b26ef(0x1db)]+'\x20'+_0x4b26ef(0x199)+_0x4b26ef(0x242)+_0x574c78[_0x4b26ef(0x28b)]+'\x20'+_0x4b26ef(0x1e4)+'</h5>'+_0x4b26ef(0x1b5)+_0x4b26ef(0x261)+_0x4b26ef(0x1ce)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x4b26ef(0x23c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x4b26ef(0x204)+_0x4b26ef(0x284)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x4b26ef(0x1f8)+_0x4b26ef(0x198)+_0x4b26ef(0x234)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4733ed+'\x20'+_0x4b26ef(0x1ac)+_0x4b26ef(0x270)+_0x4b26ef(0x1b8)+_0x4b26ef(0x232)+'<h5>'+_0x32e326[0x0]['site_title']+_0x4b26ef(0x24a)+_0x4b26ef(0x1b5)+'</div>'+_0x4b26ef(0x1e8)};_0x5a7db0[_0x4b26ef(0x189)](_0x441831,function(_0x19d784,_0x4582ad){var _0x8bb46a=_0x4b26ef;_0x19d784?(console[_0x8bb46a(0x1f5)](_0x19d784),console[_0x8bb46a(0x1f5)](_0x8bb46a(0x1f9))):console['log'](_0x8bb46a(0x1a3));}),_0x3e4db2[_0x4b26ef(0x29a)]('success','Sales\x20Update\x20successfully'),_0x3a57d9[_0x4b26ef(0x1c9)](_0x4b26ef(0x210)+_0x4aae1f);}catch(_0x34918b){console[_0x4b26ef(0x251)](_0x34918b),_0x3a57d9[_0x4b26ef(0x277)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x2bcebc=>{var _0x196f0b=_0x3b95f2;console[_0x196f0b(0x251)](_0x2bcebc),_0x3a57d9[_0x196f0b(0x277)](0x1f4)[_0x196f0b(0x202)]({'error':_0x196f0b(0x1cc)});});}catch(_0x146151){console[_0x3b95f2(0x1f5)](_0x146151);}}),router[a0_0x566b94(0x1a9)](a0_0x566b94(0x21c),auth,async(_0x2e55f2,_0x440578)=>{var _0x1970b5=a0_0x566b94;try{const {username:_0x4f3dd3,email:_0x22db8a,role:_0x4ce4d6}=_0x2e55f2[_0x1970b5(0x208)],_0x29e947=_0x2e55f2[_0x1970b5(0x208)],_0x2d212f=await profile[_0x1970b5(0x246)]({'email':_0x29e947[_0x1970b5(0x1dc)]}),_0x13c213=await master_shop[_0x1970b5(0x19b)](),_0xbcbd1a=_0x2e55f2[_0x1970b5(0x227)]['id'],_0x315952=await sales_finished['findById'](_0xbcbd1a);let _0x577852=new Date(_0x315952[_0x1970b5(0x1df)]),_0x13fbb8=('0'+_0x577852[_0x1970b5(0x191)]())['slice'](-0x2),_0x1bdbc4=('0'+(_0x577852['getMonth']()+0x1))['slice'](-0x2),_0x5cf340=_0x577852[_0x1970b5(0x1ca)](),_0x4f49e1=_0x5cf340+'-'+_0x1bdbc4+'-'+_0x13fbb8;var _0x132184=[_0x1970b5(0x1cb),'Enclosed'];const _0x13e31d=await warehouse[_0x1970b5(0x241)]([{'$match':{'name':_0x315952[_0x1970b5(0x29b)],'room':_0x315952[_0x1970b5(0x248)]}},{'$unwind':_0x1970b5(0x221)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1970b5(0x295)},'product_stock':{'$first':_0x1970b5(0x21e)},'bay':{'$first':_0x1970b5(0x192)},'bin':{'$first':_0x1970b5(0x1b4)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1970b5(0x1dd)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1970b5(0x1bf)},'product_code':{'$first':_0x1970b5(0x18e)},'storage':{'$first':_0x1970b5(0x24d)},'rack':{'$first':_0x1970b5(0x1ab)}}}]),_0x102065=await customer[_0x1970b5(0x19b)]({});let _0x3d078c;if(_0x29e947[_0x1970b5(0x1eb)]==_0x1970b5(0x253)){const _0x5ae837=await staff[_0x1970b5(0x246)]({'email':_0x29e947['email']});_0x3d078c=await warehouse[_0x1970b5(0x241)]([{'$match':{'status':_0x1970b5(0x26c),'name':_0x5ae837['warehouse']}},{'$group':{'_id':_0x1970b5(0x1c6),'name':{'$first':_0x1970b5(0x1c6)}}}]);}else _0x3d078c=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x5e1946=await product['find']({});if(_0x13c213[0x0][_0x1970b5(0x25f)]=='English\x20(US)'){var _0x39e52c=users[_0x1970b5(0x291)];console[_0x1970b5(0x1f5)](_0x39e52c);}else{if(_0x13c213[0x0]['language']==_0x1970b5(0x290))var _0x39e52c=users[_0x1970b5(0x290)];else{if(_0x13c213[0x0][_0x1970b5(0x25f)]=='German')var _0x39e52c=users[_0x1970b5(0x194)];else{if(_0x13c213[0x0][_0x1970b5(0x25f)]==_0x1970b5(0x226))var _0x39e52c=users[_0x1970b5(0x226)];else{if(_0x13c213[0x0][_0x1970b5(0x25f)]==_0x1970b5(0x255))var _0x39e52c=users['French'];else{if(_0x13c213[0x0]['language']==_0x1970b5(0x1e5))var _0x39e52c=users[_0x1970b5(0x1da)];else{if(_0x13c213[0x0]['language']=='Chinese')var _0x39e52c=users[_0x1970b5(0x285)];else{if(_0x13c213[0x0][_0x1970b5(0x25f)]==_0x1970b5(0x2a1))var _0x39e52c=users['Arabic'];}}}}}}}_0x440578[_0x1970b5(0x29c)](_0x1970b5(0x1fa),{'success':_0x2e55f2[_0x1970b5(0x29a)](_0x1970b5(0x230)),'errors':_0x2e55f2[_0x1970b5(0x29a)]('errors'),'role':_0x29e947,'profile':_0x2d212f,'customer':_0x102065,'warehouse':_0x3d078c,'product':_0x13e31d,'user':_0x315952,'master_shop':_0x13c213,'unit':_0x5e1946,'language':_0x39e52c,'rooms_data':_0x132184,'ed_fullDate':_0x4f49e1});}catch(_0x467cd2){console[_0x1970b5(0x1f5)](_0x467cd2);}}),router[a0_0x566b94(0x23a)](a0_0x566b94(0x21c),auth,async(_0x211315,_0x4502a8)=>{var _0x1fa27b=a0_0x566b94;try{const _0x49b82a=_0x211315['params']['id'],_0x14166d=await sales_finished[_0x1fa27b(0x246)]({'_id':_0x211315['params']['id']}),_0x18d18a=await warehouse[_0x1fa27b(0x246)]({'name':_0x14166d['warehouse_name'],'room':_0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x248)],'warehouse_category':_0x1fa27b(0x1aa)}),{invoice:_0xbbd71d,customer:_0x35c663,date:_0x59b064,warehouse_name:_0x4a4cfc,product_name:_0x4fd354,stock:_0x39b745,adjust_qty:_0x4abbb5,note:_0xf02795,room:_0x3936d3,primary_code:_0x3c30e9,secondary_code:_0x1ba794,prod_code:_0x260ab6,level:_0x2b97c2,isle:_0x32b1b0,pallet:_0x526c12,expiry_date:_0x4c4b52}=_0x211315['body'];if(typeof _0x4fd354==_0x1fa27b(0x260))var _0x2d5bdb=[_0x211315['body'][_0x1fa27b(0x1d6)]],_0x2f07d3=[_0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x283)]],_0x49422d=[_0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x22c)]],_0xd3cd2f=[_0x211315['body'][_0x1fa27b(0x24c)]],_0x331a5d=[_0x211315['body']['secondary_code']],_0x482491=[_0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x23f)]],_0x2ff0de=[_0x211315['body'][_0x1fa27b(0x1b0)]],_0x500d19=[_0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x1df)]];else var _0x2d5bdb=[..._0x211315['body']['product_name']],_0x2f07d3=[..._0x211315[_0x1fa27b(0x1de)]['stock']],_0x49422d=[..._0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x22c)]],_0xd3cd2f=[..._0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x24c)]],_0x331a5d=[..._0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x1fd)]],_0x482491=[..._0x211315['body'][_0x1fa27b(0x23f)]],_0x2ff0de=[..._0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x1b0)]],_0x500d19=[..._0x211315[_0x1fa27b(0x1de)]['expiry_date']];const _0x5c35a3=_0x2d5bdb[_0x1fa27b(0x217)](_0x438bb1=>{return _0x438bb1={'product_name':_0x438bb1};});_0x2f07d3[_0x1fa27b(0x1f3)]((_0x34fa23,_0xd8e7ce)=>{_0x5c35a3[_0xd8e7ce]['stock']=_0x34fa23;}),_0x49422d['forEach']((_0x17bc29,_0x268eaf)=>{var _0x424b3c=_0x1fa27b;_0x5c35a3[_0x268eaf][_0x424b3c(0x1a0)]=_0x17bc29;}),_0xd3cd2f[_0x1fa27b(0x1f3)]((_0x20675e,_0x4762ca)=>{var _0x39f558=_0x1fa27b;_0x5c35a3[_0x4762ca][_0x39f558(0x24c)]=_0x20675e;}),_0x331a5d[_0x1fa27b(0x1f3)]((_0x3dd130,_0x3e9c24)=>{var _0x4859f7=_0x1fa27b;_0x5c35a3[_0x3e9c24][_0x4859f7(0x1fd)]=_0x3dd130;}),_0x482491[_0x1fa27b(0x1f3)]((_0x1f7fb8,_0x3ed173)=>{_0x5c35a3[_0x3ed173]['product_code']=_0x1f7fb8;}),_0x2ff0de['forEach']((_0x49e308,_0x3bae8e)=>{var _0x3ac99c=_0x1fa27b;_0x5c35a3[_0x3bae8e][_0x3ac99c(0x1b0)]=_0x49e308;}),_0x500d19['forEach']((_0x49ae43,_0x20dd49)=>{var _0x5a4bf2=_0x1fa27b;_0x5c35a3[_0x20dd49][_0x5a4bf2(0x1df)]=_0x49ae43;});var _0x54a030=0x0;_0x5c35a3['forEach'](_0x5d21cc=>{var _0x297608=_0x1fa27b;console[_0x297608(0x1f5)](_0x297608(0x1d9),_0x5d21cc),(parseInt(_0x5d21cc[_0x297608(0x283)])<parseInt(_0x5d21cc[_0x297608(0x1a0)])||parseInt(_0x5d21cc[_0x297608(0x1a0)])==0x0)&&_0x54a030++;});if(_0x54a030!=0x0)return _0x211315[_0x1fa27b(0x29a)]('errors',_0x1fa27b(0x231)),_0x4502a8[_0x1fa27b(0x1c9)](_0x1fa27b(0x1f0));_0x14166d[_0x1fa27b(0x22f)][_0x1fa27b(0x1f3)](_0xaffbbc=>{var _0x2b5ce0=_0x1fa27b;const _0x24e87d=_0x18d18a[_0x2b5ce0(0x1d3)][_0x2b5ce0(0x217)](_0x383d92=>{var _0xd0bdf2=_0x2b5ce0;_0x383d92['product_name']==_0xaffbbc[_0xd0bdf2(0x1d6)]&&_0x383d92['bay']==_0xaffbbc[_0xd0bdf2(0x1f4)]&&(_0x383d92['product_stock']=parseInt(_0x383d92[_0xd0bdf2(0x264)])+parseInt(_0xaffbbc[_0xd0bdf2(0x1a0)]));});}),await _0x18d18a['save']();const _0x3837b7=_0x5c35a3[_0x1fa27b(0x233)](_0x3598ad=>_0x3598ad[_0x1fa27b(0x1a0)]!=='0'&&_0x3598ad['quantity']!=='');_0x14166d[_0x1fa27b(0x1db)]=_0xbbd71d,_0x14166d[_0x1fa27b(0x19e)]=_0x35c663,_0x14166d[_0x1fa27b(0x28b)]=_0x59b064,_0x14166d[_0x1fa27b(0x29b)]=_0x4a4cfc,_0x14166d['sale_product']=_0x3837b7,_0x14166d[_0x1fa27b(0x240)]=_0xf02795,_0x14166d['room']=_0x3936d3;const _0x4f8834=await _0x14166d['save'](),_0x48fa5b=await sales_finished['findOne']({'_id':_0x211315[_0x1fa27b(0x227)]['id']}),_0x2fe727=await warehouse[_0x1fa27b(0x246)]({'name':_0x4a4cfc,'room':_0x3936d3,'warehouse_category':_0x1fa27b(0x1aa)});_0x48fa5b[_0x1fa27b(0x22f)]['forEach'](_0x2dfebd=>{var _0x597739=_0x1fa27b;const _0x47f884=_0x2fe727[_0x597739(0x1d3)][_0x597739(0x217)](_0x3a120c=>{var _0x437c4b=_0x597739;_0x3a120c[_0x437c4b(0x1d6)]==_0x2dfebd[_0x437c4b(0x1d6)]&&_0x3a120c[_0x437c4b(0x1f4)]==_0x2dfebd[_0x437c4b(0x1f4)]&&(_0x3a120c[_0x437c4b(0x264)]=parseInt(_0x3a120c['product_stock'])-parseInt(_0x2dfebd[_0x437c4b(0x1a0)]));});}),console[_0x1fa27b(0x1f5)]('final',_0x2fe727),await _0x2fe727[_0x1fa27b(0x18b)]();const _0xec958d=await c_payment_data[_0x1fa27b(0x246)]({'invoice':_0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x1db)]});_0xec958d[_0x1fa27b(0x1d0)]=_0x211315[_0x1fa27b(0x1de)][_0x1fa27b(0x1d0)],await _0xec958d[_0x1fa27b(0x18b)](),_0x211315[_0x1fa27b(0x29a)]('success',_0x1fa27b(0x239)),_0x4502a8[_0x1fa27b(0x1c9)](_0x1fa27b(0x263));}catch(_0x18a185){console['log'](_0x18a185);}}),router['post'](a0_0x566b94(0x249),auth,async(_0x4537a0,_0x595347)=>{var _0x3bf54c=a0_0x566b94;try{const _0x133c49=_0x4537a0[_0x3bf54c(0x227)]['id'],{invoice:_0x3eb4b1,customer:_0xb70999,receivable_amount:_0x4a946,received_amount:_0x379c89}=_0x4537a0[_0x3bf54c(0x1de)],_0x3de9f4=await sales[_0x3bf54c(0x224)](_0x133c49);console[_0x3bf54c(0x1f5)](_0x3de9f4);var _0x4931c0=_0x4a946-_0x379c89;console[_0x3bf54c(0x1f5)](_0x379c89),_0x3de9f4[_0x3bf54c(0x1fb)]=parseFloat(_0x379c89)+parseFloat(_0x3de9f4[_0x3bf54c(0x1fb)]),_0x3de9f4[_0x3bf54c(0x1d5)]=_0x4931c0,console['log'](_0x3de9f4);const _0x51db8d=await _0x3de9f4[_0x3bf54c(0x18b)](),_0xe25484=await c_payment_data[_0x3bf54c(0x246)]({'invoice':_0x3eb4b1});_0xe25484[_0x3bf54c(0x1a4)]=_0x4931c0,await _0xe25484[_0x3bf54c(0x18b)]();let _0x59c6c7=new Date(),_0x10bfcd=('0'+_0x59c6c7['getDate']())[_0x3bf54c(0x299)](-0x2),_0x45f4d1=('0'+(_0x59c6c7['getMonth']()+0x1))[_0x3bf54c(0x299)](-0x2),_0x1911c7=_0x59c6c7['getFullYear'](),_0x27f9b7=_0x1911c7+'-'+_0x45f4d1+'-'+_0x10bfcd;const _0x573af5=new customer_payment({'invoice':_0x3eb4b1,'date':_0x1911c7+'-'+_0x45f4d1+'-'+_0x10bfcd,'customer':_0xb70999,'reason':_0x3bf54c(0x297),'amount':_0x379c89}),_0x1c2008=await _0x573af5[_0x3bf54c(0x18b)]();_0x4537a0[_0x3bf54c(0x29a)](_0x3bf54c(0x230),_0x3bf54c(0x20f)),_0x595347['redirect'](_0x3bf54c(0x1c1));}catch(_0x2a3464){console[_0x3bf54c(0x1f5)](_0x2a3464);}}),router['get'](a0_0x566b94(0x29d),auth,async(_0x5c9d27,_0x5d293d)=>{var _0x5d8260=a0_0x566b94;try{const {username:_0x3e0af6,email:_0x495a16,role:_0x436e9c}=_0x5c9d27['user'],_0x19fe4b=_0x5c9d27[_0x5d8260(0x208)],_0x1fdf55=await profile[_0x5d8260(0x246)]({'email':_0x19fe4b[_0x5d8260(0x1dc)]}),_0x15f55d=await master_shop[_0x5d8260(0x19b)]();console[_0x5d8260(0x1f5)](_0x5d8260(0x1bc),_0x15f55d);const _0x3dcbfc=_0x5c9d27[_0x5d8260(0x227)]['id'],_0x4a8a9d=await sales[_0x5d8260(0x224)](_0x3dcbfc);console[_0x5d8260(0x1f5)](_0x4a8a9d);const _0x15c59a=await customer[_0x5d8260(0x246)]({'name':_0x4a8a9d['customer']});console[_0x5d8260(0x1f5)](_0x15c59a);if(_0x15f55d[0x0][_0x5d8260(0x25f)]=='English\x20(US)'){var _0x5ea5d7=users[_0x5d8260(0x291)];console[_0x5d8260(0x1f5)](_0x5ea5d7);}else{if(_0x15f55d[0x0]['language']==_0x5d8260(0x290))var _0x5ea5d7=users[_0x5d8260(0x290)];else{if(_0x15f55d[0x0][_0x5d8260(0x25f)]=='German')var _0x5ea5d7=users[_0x5d8260(0x194)];else{if(_0x15f55d[0x0][_0x5d8260(0x25f)]=='Spanish')var _0x5ea5d7=users[_0x5d8260(0x226)];else{if(_0x15f55d[0x0][_0x5d8260(0x25f)]=='French')var _0x5ea5d7=users['French'];else{if(_0x15f55d[0x0][_0x5d8260(0x25f)]=='Portuguese\x20(BR)')var _0x5ea5d7=users['Portuguese'];else{if(_0x15f55d[0x0][_0x5d8260(0x25f)]==_0x5d8260(0x285))var _0x5ea5d7=users[_0x5d8260(0x285)];else{if(_0x15f55d[0x0][_0x5d8260(0x25f)]==_0x5d8260(0x2a1))var _0x5ea5d7=users[_0x5d8260(0x22a)];}}}}}}}_0x5d293d[_0x5d8260(0x29c)](_0x5d8260(0x1ad),{'success':_0x5c9d27['flash']('success'),'errors':_0x5c9d27[_0x5d8260(0x29a)](_0x5d8260(0x22b)),'role':_0x19fe4b,'profile':_0x1fdf55,'master_shop':_0x15f55d,'customers':_0x15c59a,'sales':_0x4a8a9d,'language':_0x5ea5d7});}catch(_0x2a4189){console[_0x5d8260(0x1f5)](_0x2a4189);}}),router[a0_0x566b94(0x1a9)](a0_0x566b94(0x296),auth,async(_0x362f33,_0x2aca87)=>{var _0x3e294f=a0_0x566b94;try{const {username:_0x39618c,email:_0x7e1766,role:_0x25b706}=_0x362f33[_0x3e294f(0x208)],_0x2d4e57=_0x362f33['user'],_0x3f5b88=await profile['findOne']({'email':_0x2d4e57[_0x3e294f(0x1dc)]}),_0x496844=await master_shop['find'](),_0xd39590=_0x362f33[_0x3e294f(0x227)]['id'],_0x13e97d=await sales_finished[_0x3e294f(0x224)](_0xd39590),_0x2a97c2=await warehouse[_0x3e294f(0x241)]([{'$match':{'name':_0x13e97d[_0x3e294f(0x29b)]}},{'$unwind':_0x3e294f(0x221)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3e294f(0x295)},'product_stock':{'$first':_0x3e294f(0x21e)},'bay':{'$first':_0x3e294f(0x192)},'bin':{'$first':_0x3e294f(0x1b4)},'type':{'$first':_0x3e294f(0x28c)},'floorlevel':{'$first':_0x3e294f(0x1dd)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3e294f(0x1bf)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3e294f(0x1ab)},'expiry_date':{'$first':_0x3e294f(0x1e7)},'production_date':{'$first':_0x3e294f(0x279)},'unit':{'$first':_0x3e294f(0x193)},'secondary_unit':{'$first':_0x3e294f(0x292)},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':_0x3e294f(0x20d)},'maxPerUnit':{'$first':_0x3e294f(0x214)}}}]),_0x246095=await product[_0x3e294f(0x19b)]({}),_0x465da3=await warehouse[_0x3e294f(0x241)]([{'$match':{'status':_0x3e294f(0x26c),'warehouse_category':_0x3e294f(0x1aa),'name':{'$ne':_0x3e294f(0x26a),'$ne':_0x3e294f(0x196)}}},{'$group':{'_id':_0x3e294f(0x1c6),'name':{'$first':_0x3e294f(0x1c6)}}},{'$sort':{'name':0x1}}]);var _0x531ae2=[_0x3e294f(0x229)];const _0x1bb984=await warehouse[_0x3e294f(0x241)]([{'$match':{'status':_0x3e294f(0x26c),'name':'Quality\x20Inspection'}},{'$group':{'_id':_0x3e294f(0x1c6),'name':{'$first':_0x3e294f(0x1c6)}}},{'$sort':{'name':0x1}}]);if(_0x496844[0x0][_0x3e294f(0x25f)]==_0x3e294f(0x27c)){var _0x5180d0=users[_0x3e294f(0x291)];console[_0x3e294f(0x1f5)](_0x5180d0);}else{if(_0x496844[0x0]['language']==_0x3e294f(0x290))var _0x5180d0=users[_0x3e294f(0x290)];else{if(_0x496844[0x0][_0x3e294f(0x25f)]==_0x3e294f(0x194))var _0x5180d0=users[_0x3e294f(0x194)];else{if(_0x496844[0x0][_0x3e294f(0x25f)]==_0x3e294f(0x226))var _0x5180d0=users[_0x3e294f(0x226)];else{if(_0x496844[0x0][_0x3e294f(0x25f)]==_0x3e294f(0x255))var _0x5180d0=users[_0x3e294f(0x255)];else{if(_0x496844[0x0][_0x3e294f(0x25f)]==_0x3e294f(0x1e5))var _0x5180d0=users[_0x3e294f(0x1da)];else{if(_0x496844[0x0]['language']=='Chinese')var _0x5180d0=users[_0x3e294f(0x285)];else{if(_0x496844[0x0][_0x3e294f(0x25f)]==_0x3e294f(0x2a1))var _0x5180d0=users['Arabic'];}}}}}}}_0x2aca87[_0x3e294f(0x29c)](_0x3e294f(0x267),{'success':_0x362f33['flash'](_0x3e294f(0x230)),'errors':_0x362f33[_0x3e294f(0x29a)](_0x3e294f(0x22b)),'role':_0x2d4e57,'profile':_0x3f5b88,'user':_0x13e97d,'stock':_0x2a97c2,'master_shop':_0x496844,'unit':_0x246095,'language':_0x5180d0,'warehouses':_0x465da3,'rooms':_0x531ae2,'warehouse_QA':_0x1bb984});}catch(_0x592915){console[_0x3e294f(0x1f5)](_0x592915),_0x2aca87[_0x3e294f(0x277)](0xc8)['json']({'message':_0x592915[_0x3e294f(0x21f)]});}}),router['post'](a0_0x566b94(0x296),auth,async(_0x2f15c8,_0x272f46)=>{var _0x353c73=a0_0x566b94;if(_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x26d)]=='QA')try{const {invoice:_0x5de4a4,date:_0x47254b,warehouse_name:_0x32070f,product_name:_0x5bc17d,primary_code:_0x151eb9,secondary_code:_0x5e6da0,product_code:_0x5178e8,sales_quantity:_0xcea85a,stocks:_0xa79d77,return_qty:_0x337722,Room_name:_0x3e4714,to_warehouse_name_QA:_0x444f08,to_Room_name_QA:_0x20de46,note:_0x1a9c57,for_categorize:_0x18910b,product_name_QA1:_0x2fb0dd}=_0x2f15c8['body'];if(typeof _0x2fb0dd==_0x353c73(0x260))var _0x32e0d8=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x247)]],_0x3d6c46=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x21d)]],_0x263817=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x282)]],_0x369691=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1ee)]],_0x24bd86=[_0x2f15c8['body'][_0x353c73(0x1ff)]],_0x1c312f=[_0x2f15c8['body'][_0x353c73(0x1b9)]],_0x439251=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1b6)]],_0x2cbe85=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x275)]],_0x38ff5a=[_0x2f15c8['body'][_0x353c73(0x216)]],_0x2718e2=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1be)]],_0x5314f5=[_0x2f15c8[_0x353c73(0x1de)]['secondary_unit_QA']],_0x5140d9=[_0x2f15c8['body'][_0x353c73(0x294)]],_0x76cfa2=[_0x2f15c8['body'][_0x353c73(0x237)]],_0x49b01c=[_0x2f15c8[_0x353c73(0x1de)]['expiry_date_QA']];else var _0x32e0d8=[..._0x2f15c8[_0x353c73(0x1de)]['product_name_QA1']],_0x3d6c46=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x21d)]],_0x263817=[..._0x2f15c8['body'][_0x353c73(0x282)]],_0x369691=[..._0x2f15c8[_0x353c73(0x1de)]['product_code_QA']],_0x24bd86=[..._0x2f15c8[_0x353c73(0x1de)]['sales_quantity_QA']],_0x1c312f=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1b9)]],_0x439251=[..._0x2f15c8['body']['return_qty_QA']],_0x2cbe85=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x275)]],_0x38ff5a=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x216)]],_0x2718e2=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1be)]],_0x5314f5=[..._0x2f15c8[_0x353c73(0x1de)]['secondary_unit_QA']],_0x5140d9=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x294)]],_0x76cfa2=[..._0x2f15c8[_0x353c73(0x1de)]['production_date_QA']],_0x49b01c=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x269)]];const _0x28d163=_0x32e0d8[_0x353c73(0x217)](_0x4c0fd9=>{return _0x4c0fd9={'product_name':_0x4c0fd9};});_0x3d6c46[_0x353c73(0x1f3)]((_0x791cb,_0x4f0dce)=>{_0x28d163[_0x4f0dce]['primary_code']=_0x791cb;}),_0x263817[_0x353c73(0x1f3)]((_0x306584,_0x538a37)=>{_0x28d163[_0x538a37]['secondary_code']=_0x306584;}),_0x369691[_0x353c73(0x1f3)]((_0x1b6183,_0x5eae64)=>{var _0x19617e=_0x353c73;_0x28d163[_0x5eae64][_0x19617e(0x20b)]=_0x1b6183;}),_0x24bd86[_0x353c73(0x1f3)]((_0x7adb5,_0x8cf87c)=>{var _0x1d5f54=_0x353c73;_0x28d163[_0x8cf87c][_0x1d5f54(0x281)]=_0x7adb5;}),_0x1c312f[_0x353c73(0x1f3)]((_0x2de22a,_0x754d2e)=>{var _0x75da77=_0x353c73;_0x28d163[_0x754d2e][_0x75da77(0x283)]=_0x2de22a;}),_0x439251[_0x353c73(0x1f3)]((_0x223874,_0x5d7c09)=>{_0x28d163[_0x5d7c09]['return_qty']=_0x223874;}),_0x2cbe85[_0x353c73(0x1f3)]((_0x65d65c,_0x3d2681)=>{var _0xa1496d=_0x353c73;_0x28d163[_0x3d2681][_0xa1496d(0x25b)]=_0x65d65c;}),_0x38ff5a[_0x353c73(0x1f3)]((_0xf4dc4e,_0x37fd08)=>{_0x28d163[_0x37fd08]['maxProducts']=_0xf4dc4e;}),_0x2718e2[_0x353c73(0x1f3)]((_0x36e958,_0x37accc)=>{var _0xbeb7de=_0x353c73;_0x28d163[_0x37accc][_0xbeb7de(0x1f6)]=_0x36e958;}),_0x5314f5[_0x353c73(0x1f3)]((_0x56cf31,_0x4d1424)=>{var _0x523b58=_0x353c73;_0x28d163[_0x4d1424][_0x523b58(0x23e)]=_0x56cf31;}),_0x5140d9['forEach']((_0x4d9783,_0x1855e5)=>{var _0x33bcae=_0x353c73;_0x28d163[_0x1855e5][_0x33bcae(0x212)]=_0x4d9783;}),_0x76cfa2[_0x353c73(0x1f3)]((_0x4ef201,_0x59eed3)=>{var _0x2684b8=_0x353c73;_0x28d163[_0x59eed3][_0x2684b8(0x190)]=_0x4ef201;}),_0x49b01c[_0x353c73(0x1f3)]((_0x998481,_0x135d18)=>{var _0x5484ad=_0x353c73;_0x28d163[_0x135d18][_0x5484ad(0x1df)]=_0x998481;});const _0x2a4e9a=await sales_finished['findOne']({'invoice':_0x5de4a4});_0x2a4e9a[_0x353c73(0x197)]=_0x353c73(0x20e);const _0x237a38=await _0x2a4e9a[_0x353c73(0x18b)](),_0x163720=new sales_return_finished({'invoice':_0x5de4a4,'customer':_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x19e)],'date':_0x47254b,'warehouse_name':_0x32070f,'room':_0x3e4714,'ToWarehouse':_0x444f08,'ToRoom':_0x20de46,'return_sale_QA':_0x28d163,'note':_0x1a9c57,'warehouse_cat':_0x18910b}),_0x5cc549=await _0x163720[_0x353c73(0x18b)](),_0x52854b=await sales_return_finished[_0x353c73(0x246)]({'invoice':_0x5de4a4}),_0x5d3f49=await warehouse[_0x353c73(0x246)]({'name':_0x444f08,'room':_0x20de46});_0x52854b[_0x353c73(0x1c4)][_0x353c73(0x1f3)](_0x4f5aad=>{var _0x3d3ba4=_0x353c73,_0x2c13b2=0x0;const _0x2ba0f2=_0x5d3f49['product_details'][_0x3d3ba4(0x217)](_0x51306e=>{var _0x43bbf0=_0x3d3ba4;_0x51306e['product_name']==_0x4f5aad[_0x43bbf0(0x1d6)]&&_0x51306e[_0x43bbf0(0x1df)]==_0x4f5aad[_0x43bbf0(0x1df)]&&_0x51306e[_0x43bbf0(0x190)]==_0x4f5aad[_0x43bbf0(0x190)]&&_0x51306e[_0x43bbf0(0x1f6)]==_0x4f5aad[_0x43bbf0(0x1f6)]&&(_0x51306e['product_stock']=parseInt(_0x51306e['product_stock'])+parseInt(_0x4f5aad['return_qty']),_0x2c13b2++);});_0x2c13b2=='0'&&(_0x5d3f49['product_details']=_0x5d3f49[_0x3d3ba4(0x1d3)][_0x3d3ba4(0x23d)]({'product_name':_0x4f5aad[_0x3d3ba4(0x1d6)],'product_stock':_0x4f5aad[_0x3d3ba4(0x1c2)],'primary_code':_0x4f5aad[_0x3d3ba4(0x24c)],'secondary_code':_0x4f5aad[_0x3d3ba4(0x1fd)],'product_code':_0x4f5aad[_0x3d3ba4(0x20b)],'batch_code':_0x4f5aad[_0x3d3ba4(0x1f6)],'maxPerUnit':_0x4f5aad[_0x3d3ba4(0x25b)],'production_date':_0x4f5aad[_0x3d3ba4(0x190)],'expiry_date':_0x4f5aad[_0x3d3ba4(0x1df)],'secondary_unit':_0x4f5aad[_0x3d3ba4(0x23e)],'unit':_0x4f5aad[_0x3d3ba4(0x212)],'maxProducts':_0x4f5aad[_0x3d3ba4(0x21a)],'bay':_0x4f5aad[_0x3d3ba4(0x1f4)]}));}),await _0x5d3f49[_0x353c73(0x18b)]();const _0x3ede20=new c_payment_data({'invoice':_0x5de4a4,'customer':_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x19e)],'reason':_0x353c73(0x29e)});await _0x3ede20[_0x353c73(0x18b)]();const _0x186534=await master_shop[_0x353c73(0x19b)](),_0x41ea4a=await email_settings[_0x353c73(0x246)](),_0x4f198a=await customer[_0x353c73(0x246)]({'name':_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x19e)]});_0x186534[0x0]['currency_placement']==0x1?(right_currency=_0x186534[0x0][_0x353c73(0x245)],left_currency=''):(right_currency='',left_currency=_0x186534[0x0][_0x353c73(0x245)]);var _0x5891d8=_0x32e0d8,_0x9b41c5=_0x439251,_0x23a012='',_0x323a2d;for(_0x323a2d in _0x5891d8){_0x23a012+=_0x353c73(0x244)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5891d8[_0x323a2d]+_0x353c73(0x26e)+_0x353c73(0x278)+_0x9b41c5[_0x323a2d]+'</td>'+_0x353c73(0x198);}console[_0x353c73(0x1f5)](_0x353c73(0x28f),_0x23a012);let _0x2548cc=nodemailer[_0x353c73(0x238)]({'service':'gmail','auth':{'user':_0x41ea4a['email'],'pass':_0x41ea4a[_0x353c73(0x1a2)]}}),_0x3eb28e={'from':_0x41ea4a[_0x353c73(0x1dc)],'to':_0x4f198a[_0x353c73(0x1dc)],'subject':_0x353c73(0x18c),'attachments':[{'filename':'Logo.png','path':__dirname+_0x353c73(0x28d)+_0x353c73(0x252)+_0x186534[0x0]['image'],'cid':_0x353c73(0x257)}],'html':'<!DOCTYPE\x20html>'+_0x353c73(0x1e1)+_0x353c73(0x27e)+_0x353c73(0x1b8)+_0x353c73(0x1ba)+'<div>'+_0x353c73(0x24b)+_0x353c73(0x1b5)+'<div>'+'<h2>\x20'+_0x186534[0x0]['site_title']+_0x353c73(0x195)+_0x353c73(0x1b5)+'</div>'+_0x353c73(0x1b3)+_0x353c73(0x1b8)+_0x353c73(0x228)+_0x353c73(0x262)+_0x5de4a4+'\x20'+_0x353c73(0x199)+_0x353c73(0x242)+_0x47254b+'\x20'+_0x353c73(0x1e4)+_0x353c73(0x24a)+_0x353c73(0x1b5)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x353c73(0x1ce)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x353c73(0x200)+_0x353c73(0x198)+_0x353c73(0x234)+_0x353c73(0x24e)+'\x20'+_0x23a012+'\x20'+_0x353c73(0x1ac)+_0x353c73(0x270)+_0x353c73(0x1b8)+_0x353c73(0x232)+_0x353c73(0x1a7)+_0x186534[0x0][_0x353c73(0x1e2)]+_0x353c73(0x24a)+_0x353c73(0x1b5)+_0x353c73(0x1b5)+_0x353c73(0x1e8)};_0x2548cc[_0x353c73(0x189)](_0x3eb28e,function(_0x1107b2,_0x2e20db){var _0x3375ca=_0x353c73;_0x1107b2?(console['log'](_0x1107b2),console[_0x3375ca(0x1f5)](_0x3375ca(0x1f9))):console['log'](_0x3375ca(0x1a3));}),_0x2f15c8[_0x353c73(0x29a)](_0x353c73(0x230),_0x353c73(0x20c)),_0x272f46[_0x353c73(0x1c9)](_0x353c73(0x263));}catch(_0xf32e1e){_0x272f46[_0x353c73(0x277)](0xc8)[_0x353c73(0x202)]({'message1':_0xf32e1e[_0x353c73(0x21f)]});}else{if(_0x2f15c8[_0x353c73(0x1de)]['for_categorize']=='GS')try{const {invoice:_0x39b7b2,date:_0x153bab,warehouse_name:_0xfcc1a2,product_name:_0x1cd367,primary_code:_0x499be9,secondary_code:_0x388625,product_code:_0xe8c95b,sales_quantity:_0x1fc4e6,stocks:_0x475ef3,return_qty:_0x211f9b,Room_name:_0x10e75d,to_warehouse_name:_0x54005c,to_Room_name:_0x583ddf,note:_0x47936a,level:_0xb30f16,isle:_0xe65200,pallet:_0x1180a0,for_categorize:_0x24c176}=_0x2f15c8[_0x353c73(0x1de)];if(typeof _0x1cd367==_0x353c73(0x260))var _0x32e0d8=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1d6)]],_0x3d6c46=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x24c)]],_0x263817=[_0x2f15c8['body'][_0x353c73(0x1fd)]],_0x369691=[_0x2f15c8['body'][_0x353c73(0x20b)]],_0x24bd86=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1b7)]],_0x439251=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1c2)]],_0x4a079=[_0x2f15c8['body'][_0x353c73(0x1f4)]],_0x2cbe85=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x25b)]],_0x38ff5a=[_0x2f15c8['body']['maxProducts']],_0x2718e2=[_0x2f15c8[_0x353c73(0x1de)]['batch_code']],_0x5314f5=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x23e)]],_0x5140d9=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x212)]],_0x76cfa2=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x190)]],_0x49b01c=[_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1df)]];else var _0x32e0d8=[..._0x2f15c8['body'][_0x353c73(0x1d6)]],_0x3d6c46=[..._0x2f15c8['body']['primary_code']],_0x263817=[..._0x2f15c8[_0x353c73(0x1de)]['secondary_code']],_0x369691=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x20b)]],_0x24bd86=[..._0x2f15c8['body'][_0x353c73(0x1b7)]],_0x439251=[..._0x2f15c8['body']['return_qty']],_0x4a079=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1f4)]],_0x2cbe85=[..._0x2f15c8[_0x353c73(0x1de)]['maxPerUnit']],_0x38ff5a=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x21a)]],_0x2718e2=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1f6)]],_0x5314f5=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x23e)]],_0x5140d9=[..._0x2f15c8['body'][_0x353c73(0x212)]],_0x76cfa2=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x190)]],_0x49b01c=[..._0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x1df)]];const _0x14985d=_0x32e0d8[_0x353c73(0x217)](_0x5b7254=>{return _0x5b7254={'product_name':_0x5b7254};});_0x3d6c46[_0x353c73(0x1f3)]((_0x452b98,_0x453d79)=>{_0x14985d[_0x453d79]['primary_code']=_0x452b98;}),_0x263817[_0x353c73(0x1f3)]((_0x3c6fa2,_0x20897e)=>{_0x14985d[_0x20897e]['secondary_code']=_0x3c6fa2;}),_0x369691[_0x353c73(0x1f3)]((_0xa30c1,_0x492fd1)=>{var _0x55aa53=_0x353c73;_0x14985d[_0x492fd1][_0x55aa53(0x20b)]=_0xa30c1;}),_0x24bd86[_0x353c73(0x1f3)]((_0x29c83c,_0x40f66b)=>{var _0x58f1e8=_0x353c73;_0x14985d[_0x40f66b][_0x58f1e8(0x281)]=_0x29c83c;}),_0x439251[_0x353c73(0x1f3)]((_0x4a0c70,_0x545fdc)=>{var _0x1089f6=_0x353c73;_0x14985d[_0x545fdc][_0x1089f6(0x1c2)]=_0x4a0c70;}),_0x4a079[_0x353c73(0x1f3)]((_0x5bc742,_0x892d5)=>{var _0x109fbb=_0x353c73;_0x14985d[_0x892d5][_0x109fbb(0x1f4)]=_0x5bc742;}),_0x2cbe85[_0x353c73(0x1f3)]((_0x521daf,_0x1ad02e)=>{var _0xece91a=_0x353c73;_0x14985d[_0x1ad02e][_0xece91a(0x25b)]=_0x521daf;}),_0x38ff5a['forEach']((_0x9a588c,_0x506e65)=>{var _0x18f592=_0x353c73;_0x14985d[_0x506e65][_0x18f592(0x21a)]=_0x9a588c;}),_0x2718e2[_0x353c73(0x1f3)]((_0x593c3e,_0xd11d94)=>{var _0x35a056=_0x353c73;_0x14985d[_0xd11d94][_0x35a056(0x1f6)]=_0x593c3e;}),_0x5314f5[_0x353c73(0x1f3)]((_0x5f1835,_0x13f158)=>{var _0x517039=_0x353c73;_0x14985d[_0x13f158][_0x517039(0x23e)]=_0x5f1835;}),_0x5140d9[_0x353c73(0x1f3)]((_0x2f3e2e,_0x4d5a20)=>{_0x14985d[_0x4d5a20]['unit']=_0x2f3e2e;}),_0x76cfa2[_0x353c73(0x1f3)]((_0x1c28fa,_0x2423ff)=>{var _0x2171ed=_0x353c73;_0x14985d[_0x2423ff][_0x2171ed(0x190)]=_0x1c28fa;}),_0x49b01c[_0x353c73(0x1f3)]((_0x3f8abb,_0x93fee1)=>{var _0x153874=_0x353c73;_0x14985d[_0x93fee1][_0x153874(0x1df)]=_0x3f8abb;});var _0x228b9b=0x0;_0x14985d[_0x353c73(0x1f3)](_0x3227ef=>{var _0x18299c=_0x353c73;(parseInt(_0x3227ef[_0x18299c(0x281)])<parseInt(_0x3227ef['return_qty'])||parseInt(_0x3227ef[_0x18299c(0x283)])<parseInt(_0x3227ef[_0x18299c(0x1c2)])&&parseInt(_0x3227ef['sale_qty'])>parseInt(_0x3227ef[_0x18299c(0x1c2)])||parseInt(_0x3227ef[_0x18299c(0x1c2)])==0x0)&&_0x228b9b++;});if(_0x228b9b!=0x0)return _0x2f15c8[_0x353c73(0x29a)](_0x353c73(0x22b),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x272f46[_0x353c73(0x1c9)]('back');const _0x184b60=await sales_finished[_0x353c73(0x246)]({'invoice':_0x39b7b2});_0x184b60[_0x353c73(0x197)]=_0x353c73(0x20e);const _0x395d39=await _0x184b60[_0x353c73(0x18b)](),_0x3e01dd=new sales_return_finished({'invoice':_0x39b7b2,'customer':_0x2f15c8['body'][_0x353c73(0x19e)],'date':_0x153bab,'warehouse_name':_0xfcc1a2,'room':_0x10e75d,'ToWarehouse':_0x54005c,'ToRoom':_0x583ddf,'return_sale':_0x14985d,'note':_0x47936a,'warehouse_cat':_0x24c176}),_0x435caa=await _0x3e01dd['save'](),_0x490e61=await sales_return_finished['findOne']({'invoice':_0x39b7b2}),_0x28b232=await warehouse[_0x353c73(0x246)]({'name':_0x54005c,'room':_0x583ddf,'warehouse_category':_0x353c73(0x1aa)});_0x490e61[_0x353c73(0x25c)][_0x353c73(0x1f3)](_0x37cbdd=>{var _0x8635f6=_0x353c73,_0x2b6472=0x0;const _0x2415dc=_0x28b232['product_details'][_0x8635f6(0x217)](_0x298049=>{var _0x21eee9=_0x8635f6;_0x298049['product_name']==_0x37cbdd[_0x21eee9(0x1d6)]&&_0x298049[_0x21eee9(0x1f4)]==_0x37cbdd[_0x21eee9(0x1f4)]&&_0x298049[_0x21eee9(0x1df)]==_0x37cbdd[_0x21eee9(0x1df)]&&_0x298049[_0x21eee9(0x190)]==_0x37cbdd[_0x21eee9(0x190)]&&_0x298049[_0x21eee9(0x1f6)]==_0x37cbdd[_0x21eee9(0x1f6)]&&(_0x298049[_0x21eee9(0x264)]=parseInt(_0x298049[_0x21eee9(0x264)])+parseInt(_0x37cbdd[_0x21eee9(0x1c2)]),_0x2b6472++);});_0x2b6472=='0'&&(_0x28b232[_0x8635f6(0x1d3)]=_0x28b232[_0x8635f6(0x1d3)][_0x8635f6(0x23d)]({'product_name':_0x37cbdd[_0x8635f6(0x1d6)],'product_stock':_0x37cbdd[_0x8635f6(0x1c2)],'primary_code':_0x37cbdd[_0x8635f6(0x24c)],'secondary_code':_0x37cbdd[_0x8635f6(0x1fd)],'product_code':_0x37cbdd['product_code'],'bay':_0x37cbdd[_0x8635f6(0x1f4)],'batch_code':_0x37cbdd[_0x8635f6(0x1f6)],'maxPerUnit':_0x37cbdd[_0x8635f6(0x25b)],'production_date':_0x37cbdd[_0x8635f6(0x190)],'expiry_date':_0x37cbdd[_0x8635f6(0x1df)],'secondary_unit':_0x37cbdd[_0x8635f6(0x23e)],'unit':_0x37cbdd[_0x8635f6(0x212)],'maxProducts':_0x37cbdd[_0x8635f6(0x21a)]}));}),await _0x28b232['save'](),console[_0x353c73(0x1f5)](_0x2f15c8[_0x353c73(0x1de)]);const _0x41d56e=new c_payment_data({'invoice':_0x39b7b2,'customer':_0x2f15c8[_0x353c73(0x1de)]['customer'],'reason':_0x353c73(0x29e)});await _0x41d56e[_0x353c73(0x18b)]();const _0x4da52d=await master_shop['find']();console['log'](_0x353c73(0x286),_0x4da52d[0x0][_0x353c73(0x1c3)]);const _0x3bd109=await email_settings['findOne'](),_0x3e20ba=await customer[_0x353c73(0x246)]({'name':_0x2f15c8[_0x353c73(0x1de)][_0x353c73(0x19e)]});console[_0x353c73(0x1f5)](_0x353c73(0x22e),_0x3e20ba);_0x4da52d[0x0]['currency_placement']==0x1?(right_currency=_0x4da52d[0x0][_0x353c73(0x245)],left_currency=''):(right_currency='',left_currency=_0x4da52d[0x0][_0x353c73(0x245)]);var _0x5891d8=_0x32e0d8,_0x9b41c5=_0x439251,_0x23a012='',_0x323a2d;for(_0x323a2d in _0x5891d8){_0x23a012+=_0x353c73(0x244)+_0x353c73(0x278)+_0x5891d8[_0x323a2d]+_0x353c73(0x26e)+_0x353c73(0x278)+_0x9b41c5[_0x323a2d]+_0x353c73(0x26e)+'</tr>';}console['log']('product_list',_0x23a012);let _0x345840=nodemailer[_0x353c73(0x238)]({'service':_0x353c73(0x258),'auth':{'user':_0x3bd109[_0x353c73(0x1dc)],'pass':_0x3bd109['password']}}),_0x5d02f0={'from':_0x3bd109[_0x353c73(0x1dc)],'to':_0x3e20ba['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x353c73(0x27b),'path':__dirname+_0x353c73(0x28d)+'/upload/'+_0x4da52d[0x0]['image'],'cid':_0x353c73(0x257)}],'html':'<!DOCTYPE\x20html>'+_0x353c73(0x1e1)+_0x353c73(0x27e)+_0x353c73(0x1b8)+_0x353c73(0x1ba)+_0x353c73(0x1b8)+_0x353c73(0x24b)+_0x353c73(0x1b5)+'<div>'+'<h2>\x20'+_0x4da52d[0x0][_0x353c73(0x1e2)]+_0x353c73(0x195)+'</div>'+_0x353c73(0x1b5)+_0x353c73(0x1b3)+_0x353c73(0x1b8)+_0x353c73(0x228)+_0x353c73(0x262)+_0x39b7b2+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x353c73(0x242)+_0x153bab+'\x20'+_0x353c73(0x1e4)+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x353c73(0x1ce)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x353c73(0x1c5)+_0x353c73(0x1e6)+_0x353c73(0x200)+_0x353c73(0x198)+_0x353c73(0x234)+_0x353c73(0x24e)+'\x20'+_0x23a012+'\x20'+_0x353c73(0x1ac)+_0x353c73(0x270)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x353c73(0x1a7)+_0x4da52d[0x0][_0x353c73(0x1e2)]+'</h5>'+'</div>'+_0x353c73(0x1b5)+'</body></html>'};_0x345840[_0x353c73(0x189)](_0x5d02f0,function(_0x1064e5,_0x2487cd){var _0x2245ae=_0x353c73;_0x1064e5?(console[_0x2245ae(0x1f5)](_0x1064e5),console[_0x2245ae(0x1f5)](_0x2245ae(0x1f9))):console[_0x2245ae(0x1f5)](_0x2245ae(0x1a3));}),_0x2f15c8[_0x353c73(0x29a)](_0x353c73(0x230),_0x353c73(0x20c)),_0x272f46['redirect'](_0x353c73(0x263));}catch(_0x86cae6){console[_0x353c73(0x1f5)](_0x86cae6),_0x272f46[_0x353c73(0x277)](0xc8)['json']({'message1':_0x86cae6['message']});}}}),router['get'](a0_0x566b94(0x235),auth,async(_0x626c0e,_0x1d4c99)=>{var _0x24ca5d=a0_0x566b94;try{const {username:_0x113d99,email:_0x415604,role:_0x4ff57d}=_0x626c0e[_0x24ca5d(0x208)],_0x34484a=_0x626c0e['user'],_0x1439b6=await profile[_0x24ca5d(0x246)]({'email':_0x34484a['email']}),_0x7c4625=await master_shop[_0x24ca5d(0x19b)]();console[_0x24ca5d(0x1f5)](_0x24ca5d(0x298),_0x7c4625);const _0x4f9b38=_0x626c0e[_0x24ca5d(0x227)]['id'],_0x54b73b=await sales['findById'](_0x4f9b38);console[_0x24ca5d(0x1f5)](_0x24ca5d(0x18d),_0x54b73b);if(_0x7c4625[0x0][_0x24ca5d(0x25f)]==_0x24ca5d(0x27c))var _0x203195=users[_0x24ca5d(0x291)];else{if(_0x7c4625[0x0][_0x24ca5d(0x25f)]=='Hindi')var _0x203195=users[_0x24ca5d(0x290)];else{if(_0x7c4625[0x0][_0x24ca5d(0x25f)]=='German')var _0x203195=users[_0x24ca5d(0x194)];else{if(_0x7c4625[0x0]['language']==_0x24ca5d(0x226))var _0x203195=users['Spanish'];else{if(_0x7c4625[0x0]['language']==_0x24ca5d(0x255))var _0x203195=users[_0x24ca5d(0x255)];else{if(_0x7c4625[0x0]['language']==_0x24ca5d(0x1e5))var _0x203195=users[_0x24ca5d(0x1da)];else{if(_0x7c4625[0x0]['language']==_0x24ca5d(0x285))var _0x203195=users[_0x24ca5d(0x285)];else{if(_0x7c4625[0x0][_0x24ca5d(0x25f)]=='Arabic\x20(ae)')var _0x203195=users['Arabic'];}}}}}}}_0x1d4c99['render']('all_sales_barcode',{'success':_0x626c0e[_0x24ca5d(0x29a)]('success'),'errors':_0x626c0e[_0x24ca5d(0x29a)](_0x24ca5d(0x22b)),'role':_0x34484a,'profile':_0x1439b6,'alldata':_0x54b73b,'master_shop':_0x7c4625,'language':_0x203195});}catch(_0x547c92){console[_0x24ca5d(0x1f5)](_0x547c92);}}),router[a0_0x566b94(0x23a)](a0_0x566b94(0x1cd),async(_0x528ac2,_0x5385de)=>{var _0x41a354=a0_0x566b94;const {product_code:_0x1d8629,warehouse_name:_0x1ff62e,rooms_data:_0xde76b8,Roomslist:_0x36da74}=_0x528ac2['body'],_0x2b6b7b=_0x36da74[_0x41a354(0x287)](','),_0xcbc565=[];async function _0xd8fd0b(_0x2dd78e){var _0x567bb5=_0x41a354;const _0x17fff7=await warehouse[_0x567bb5(0x241)]([{'$match':{'name':_0x1ff62e,'room':_0x2dd78e}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1d8629}},{'$group':{'_id':_0x567bb5(0x1f1),'name':{'$first':_0x567bb5(0x295)},'product_stock':{'$first':_0x567bb5(0x21e)},'primary_code':{'$first':_0x567bb5(0x1d4)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x567bb5(0x18e)},'level':{'$first':_0x567bb5(0x192)},'isle':{'$first':_0x567bb5(0x1b4)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x567bb5(0x1dd)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x567bb5(0x292)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x567bb5(0x1ab)},'expiry_date':{'$first':_0x567bb5(0x1e7)},'production_date':{'$first':_0x567bb5(0x279)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x567bb5(0x20d)},'product_cat':{'$first':_0x567bb5(0x1fc)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x567bb5(0x289)},'invoice':{'$first':_0x567bb5(0x1fe)}}}]),_0x512f5f=await warehouse[_0x567bb5(0x241)]([{'$match':{'name':_0x1ff62e,'room':_0x2dd78e}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x1d8629}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x567bb5(0x295)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x567bb5(0x1d4)},'secondary_code':{'$first':_0x567bb5(0x1bf)},'product_code':{'$first':_0x567bb5(0x18e)},'level':{'$first':_0x567bb5(0x192)},'isle':{'$first':_0x567bb5(0x1b4)},'type':{'$first':_0x567bb5(0x28c)},'pallet':{'$first':_0x567bb5(0x1dd)},'unit':{'$first':_0x567bb5(0x193)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x567bb5(0x24d)},'rack':{'$first':_0x567bb5(0x1ab)},'expiry_date':{'$first':_0x567bb5(0x1e7)},'production_date':{'$first':_0x567bb5(0x279)},'maxPerUnit':{'$first':_0x567bb5(0x214)},'batch_code':{'$first':_0x567bb5(0x20d)},'product_cat':{'$first':_0x567bb5(0x1fc)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x567bb5(0x289)},'invoice':{'$first':_0x567bb5(0x1fe)}}}]);if(_0x17fff7['length']>0x0)_0xcbc565[_0x567bb5(0x21b)](_0x17fff7);else _0x512f5f[_0x567bb5(0x1bb)]>0x0&&_0xcbc565['push'](_0x512f5f);}const _0x22e48e=_0x2b6b7b['map'](_0x550556=>_0xd8fd0b(_0x550556));await Promise[_0x41a354(0x266)](_0x22e48e),_0x5385de[_0x41a354(0x202)](_0xcbc565);}),module[a0_0x566b94(0x1e9)]=router;