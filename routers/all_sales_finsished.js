var a0_0xd8bb59=a0_0x3d1f;function a0_0x3d1f(_0xa148ea,_0x5d70f4){var _0x13d87a=a0_0x13d8();return a0_0x3d1f=function(_0x3d1f63,_0x193119){_0x3d1f63=_0x3d1f63-0x65;var _0x597397=_0x13d87a[_0x3d1f63];return _0x597397;},a0_0x3d1f(_0xa148ea,_0x5d70f4);}(function(_0x3f4316,_0x3fdb40){var _0x508da1=a0_0x3d1f,_0x17c96b=_0x3f4316();while(!![]){try{var _0x8ae389=parseInt(_0x508da1(0x6f))/0x1*(parseInt(_0x508da1(0xd8))/0x2)+parseInt(_0x508da1(0x150))/0x3+parseInt(_0x508da1(0x145))/0x4*(parseInt(_0x508da1(0x13a))/0x5)+-parseInt(_0x508da1(0x12a))/0x6+-parseInt(_0x508da1(0x176))/0x7*(-parseInt(_0x508da1(0x151))/0x8)+parseInt(_0x508da1(0xc9))/0x9+-parseInt(_0x508da1(0x132))/0xa;if(_0x8ae389===_0x3fdb40)break;else _0x17c96b['push'](_0x17c96b['shift']());}catch(_0x2008e3){_0x17c96b['push'](_0x17c96b['shift']());}}}(a0_0x13d8,0x1c723));const express=require(a0_0xd8bb59(0x101)),app=express(),router=express[a0_0xd8bb59(0xc3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0xd8bb59(0x96)),auth=require(a0_0xd8bb59(0xf1)),nodemailer=require('nodemailer'),users=require('../public/language/languages.json');function a0_0x13d8(){var _0x494a03=['room_name','$product_details.secondary_unit','random','$product.product_name','\x20<>\x20','Chinese','payment\x20successfull','max','Ambient','date','Enclosed','findById','sales\x20item\x20return\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','</thead>','../middleware/auth','gmail','product_list','<h5>','primary_code','Finished\x20Goods','$product_details.invoice','$product_details.product_name','/view/:id','logo','log','/all_sales_finished/view','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','secondary_code_QA','Hindi','secondary_unit','express','length','barcode\x20Product\x20master','DRY\x20GOODS','expiry_date_QA','getDate','$product_details.storage','Error\x20Occurs','product_code','due_amount','Sale\x20Return\x20Mail','secondary_unit_QA','production_date','product_date','customers','string','barcode\x20user_id','/upload/','sale_qty','sales_invoice','redirect','Sales\x20Mail','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','sale_product','master','$sale_product.type','bay','edit_sales_finished_view','forEach','staff','adjust_qty','An\x20error\x20occurred.','push','image','site_title','Arabic','return_sale_QA','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','maxProducts_QA','$sale_product.bin','add_sales_finished','958770iSCSfh','message','production_date_QA','product_code_QA','Sale\x20Return','$product_details.unit','exports','final','4964480iUFhsf','</body></html>','French','$finalize','There\x27s\x20a\x20error\x20in\x20this\x20transaction','sendMail','Portuguese','$date','15ROQKzo','name','params','secondary_code','</tr>','$product_details._id','room','$return_data','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','findOne','foreach\x20newproduct','251864XiXtTW','suppliers','return_sale','/barcode_scanner','<!DOCTYPE\x20html>','password','status','carton','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','prod_code','269691YlXLny','8voBTRZ','Add\x20Sales','\x20Order\x20Date\x20:\x20','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','prod_invoice','level','get','\x20==\x20','<strong>\x20Regards\x20</strong>','all_sales_barcode','<tr>','flash','<div>','ADD\x20SALE','currency','sales_quantity','Portuguese\x20(BR)','$product_details.maxProducts','port','invoice','/all_sales_finished/preview/','$customers_docs','filter','OUTF-','$product_details.primary_code','concat','Arabic\x20(ae)','finalize','product_name','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product_details','customers_docs','json','$product_details.bay','/view/add_sale/product','1489033CvyNZA','<hr\x20class=\x22my-3\x22>','language','product_stock','<tbody\x20style=\x22text-align:\x20center;\x22>','then','\x20</h2>','createTransport','render','stocks_QA','<span\x20style=\x22float:\x20right;\x22>','\x20Order\x20Number\x20:\x20','return_data','Quality\x20Inspection','$sale_product.floorlevel','$warehouse_name','</div>','all_sales_finished','quantity','2sxqsVn','id_transaction_from','back','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','abs','error','</h5>','product_name_QA1','<table\x20style=\x22width:\x20100%\x20!important;\x22>','getFullYear','catch','primary_code_QA','expiry_date','$invoice','body','Sales\x20Update\x20successfully','host','\x20>>>\x20','role','/all_sales/view','max_per_unit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','maxperunit','maxProducts','$product_details.secondary_code','prod_cat','$product_details.production_date','return_qty','find','received_amount','all','$room','True','return_qty_QA','add\x20post','$product_details.rack','success','Enabled','../models/all_models','$product_details.maxPerUnit','$product_details.bin','_id','\x20&&\x20','$customer','\x20<<<==>>>\x20','$product_details.product_cat','post','email','warehouse_name','/view/return_sales/:id','Return\x20Goods','currency_placement','$sale_product.quantity','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','</table>','aggregate','customer','$name','unit_QA','slice','German','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product','batch_code','$_id','Email\x20sent\x20successfully','$note','batch_code_QA','unit','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.batch_code','$product_details.expiry_date','Received\x20Payment\x20For\x20Sale','</span>','/view/add_sales','$product_details.type','Return\x20Rooms','$product_details.product_code','English\x20(US)','primary_unit','/preview/:id','Logo.png','Router','$product_details','$product_details.floorlevel','maxPerUnit_QA','/give_payment/:id','/../public','1665792sEnwiI','$sale_product.bay','maxPerUnit','split','user','$sale_product','RoomAssigned','<html><head><title></title>','False','stock','</head><body>','christian.villamer@jakagroup.com','save','/view','edit_sales_finished','96156YEBxIc','<h2>\x20','/view/add_sales/:id','Spanish','errors','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.product_stock','An\x20error\x20occurred\x20while\x20saving\x20data.','warehouse'];a0_0x13d8=function(){return _0x494a03;};return a0_0x13d8();}router[a0_0xd8bb59(0x158)](a0_0xd8bb59(0xd6),auth,async(_0x5bab91,_0x562492)=>{var _0xcfaed4=a0_0xd8bb59;try{const {username:_0x25f369,email:_0x111807,role:_0x3c7818}=_0x5bab91[_0xcfaed4(0xcd)],_0x13828e=_0x5bab91[_0xcfaed4(0xcd)],_0x53df3d=await profile[_0xcfaed4(0x143)]({'email':_0x13828e[_0xcfaed4(0x9f)]}),_0x131574=await master_shop[_0xcfaed4(0x8c)]();let _0x4fd33e;if(_0x13828e['role']=='staff'){const _0x38f0fc=await staff[_0xcfaed4(0x143)]({'email':_0x13828e[_0xcfaed4(0x9f)]});_0x4fd33e=await sales_finished[_0xcfaed4(0xa7)]([{'$lookup':{'from':_0xcfaed4(0x10f),'localField':'customer','foreignField':_0xcfaed4(0x13b),'as':_0xcfaed4(0x172)}},{'$unwind':_0xcfaed4(0x167)},{'$unwind':_0xcfaed4(0xce)},{'$group':{'_id':_0xcfaed4(0xb0),'invoice':{'$first':_0xcfaed4(0x7d)},'customers':{'$first':_0xcfaed4(0x9b)},'date':{'$first':_0xcfaed4(0x139)},'warehouse_name':{'$first':_0xcfaed4(0x6b)},'sale_product':{'$push':_0xcfaed4(0xce)},'note':{'$first':_0xcfaed4(0xb2)},'return_data':{'$first':_0xcfaed4(0x141)},'customers_docs':{'$first':_0xcfaed4(0x167)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0xcfaed4(0xca)},'isle':{'$addToSet':_0xcfaed4(0x128)},'type':{'$addToSet':_0xcfaed4(0x11a)},'pallet':{'$addToSet':_0xcfaed4(0x6a)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x4fd33e=await sales_finished[_0xcfaed4(0xa7)]([{'$lookup':{'from':_0xcfaed4(0x10f),'localField':_0xcfaed4(0xa8),'foreignField':_0xcfaed4(0x13b),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0xcfaed4(0xce)},{'$group':{'_id':'$_id','invoice':{'$first':_0xcfaed4(0x7d)},'customers':{'$first':_0xcfaed4(0x9b)},'date':{'$first':_0xcfaed4(0x139)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0xcfaed4(0xce)},'note':{'$first':'$note'},'return_data':{'$first':_0xcfaed4(0x141)},'customers_docs':{'$first':_0xcfaed4(0x167)},'total_saleproduct_quantity':{'$sum':_0xcfaed4(0xa4)},'level':{'$addToSet':_0xcfaed4(0xca)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0xcfaed4(0x11a)},'pallet':{'$addToSet':_0xcfaed4(0x6a)},'finalize':{'$first':_0xcfaed4(0x135)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x131574[0x0]['language']==_0xcfaed4(0xbf)){var _0x1c3fe3=users['English'];console[_0xcfaed4(0xfb)](_0x1c3fe3);}else{if(_0x131574[0x0][_0xcfaed4(0x178)]=='Hindi')var _0x1c3fe3=users[_0xcfaed4(0xff)];else{if(_0x131574[0x0]['language']==_0xcfaed4(0xac))var _0x1c3fe3=users['German'];else{if(_0x131574[0x0]['language']=='Spanish')var _0x1c3fe3=users[_0xcfaed4(0xdb)];else{if(_0x131574[0x0][_0xcfaed4(0x178)]==_0xcfaed4(0x134))var _0x1c3fe3=users['French'];else{if(_0x131574[0x0][_0xcfaed4(0x178)]==_0xcfaed4(0x162))var _0x1c3fe3=users[_0xcfaed4(0x138)];else{if(_0x131574[0x0][_0xcfaed4(0x178)]==_0xcfaed4(0xe7))var _0x1c3fe3=users[_0xcfaed4(0xe7)];else{if(_0x131574[0x0][_0xcfaed4(0x178)]==_0xcfaed4(0x16c))var _0x1c3fe3=users[_0xcfaed4(0x124)];}}}}}}}_0x562492[_0xcfaed4(0x17e)](_0xcfaed4(0x6d),{'success':_0x5bab91[_0xcfaed4(0x15d)](_0xcfaed4(0x94)),'errors':_0x5bab91[_0xcfaed4(0x15d)]('errors'),'sales':_0x4fd33e,'profile':_0x53df3d,'role':_0x13828e,'master_shop':_0x131574,'language':_0x1c3fe3});}catch(_0x4c29ee){console[_0xcfaed4(0xfb)](_0x4c29ee);}});async function getRandom8DigitNumber(){var _0x28b781=a0_0xd8bb59;const _0x594b7e=0x989680,_0x4a826c=0x5f5e0ff,_0x2311a9=Math['floor'](Math[_0x28b781(0xe4)]()*(_0x4a826c-_0x594b7e+0x1))+_0x594b7e;var _0xb82f0d;const _0x221a1f=await sales_finished[_0x28b781(0x143)]({'invoice':_0x28b781(0x169)+_0x2311a9});return _0x221a1f&&_0x221a1f[_0x28b781(0x102)]>0x0?_0xb82f0d=_0x28b781(0x169)+_0x2311a9:_0xb82f0d=_0x28b781(0x169)+_0x2311a9,_0xb82f0d;}router[a0_0xd8bb59(0x158)](a0_0xd8bb59(0xbb),auth,async(_0x117b86,_0x3706fa)=>{var _0x29fcec=a0_0xd8bb59;try{const {username:_0x100177,email:_0x304544,role:_0x4cf40a}=_0x117b86[_0x29fcec(0xcd)],_0x15cfaa=_0x117b86[_0x29fcec(0xcd)],_0x4530db=await profile[_0x29fcec(0x143)]({'email':_0x15cfaa[_0x29fcec(0x9f)]}),_0x3405e9=await master_shop[_0x29fcec(0x8c)](),_0x3e9a2b=await customer[_0x29fcec(0x8c)]({});let _0x181c62;if(_0x15cfaa['role']==_0x29fcec(0x11e)){const _0x25e1ad=await staff[_0x29fcec(0x143)]({'email':_0x15cfaa[_0x29fcec(0x9f)]});_0x181c62=await warehouse[_0x29fcec(0xa7)]([{'$match':{'status':_0x29fcec(0x95),'name':_0x25e1ad[_0x29fcec(0xe1)],'warehouse_category':_0x29fcec(0xf6),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x29fcec(0xa9),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x181c62=await warehouse[_0x29fcec(0xa7)]([{'$match':{'status':_0x29fcec(0x95),'warehouse_category':_0x29fcec(0xf6),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x29fcec(0xa9),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x7b4e43=await product[_0x29fcec(0x8c)]({});var _0x2e7384=[_0x29fcec(0xea),_0x29fcec(0xec)];const _0x66f55c=await sales_finished[_0x29fcec(0x8c)]({}),_0x3d8770=_0x66f55c[_0x29fcec(0x102)]+0x1,_0x276120=_0x29fcec(0x169)+_0x3d8770['toString']()['padStart'](0x5,'0');if(_0x3405e9[0x0][_0x29fcec(0x178)]==_0x29fcec(0xbf)){var _0x2325a3=users[_0x29fcec(0x14d)];console[_0x29fcec(0xfb)](_0x2325a3);}else{if(_0x3405e9[0x0][_0x29fcec(0x178)]==_0x29fcec(0xff))var _0x2325a3=users[_0x29fcec(0xff)];else{if(_0x3405e9[0x0][_0x29fcec(0x178)]==_0x29fcec(0xac))var _0x2325a3=users[_0x29fcec(0xac)];else{if(_0x3405e9[0x0]['language']==_0x29fcec(0xdb))var _0x2325a3=users[_0x29fcec(0xdb)];else{if(_0x3405e9[0x0]['language']==_0x29fcec(0x134))var _0x2325a3=users['French'];else{if(_0x3405e9[0x0][_0x29fcec(0x178)]=='Portuguese\x20(BR)')var _0x2325a3=users[_0x29fcec(0x138)];else{if(_0x3405e9[0x0]['language']=='Chinese')var _0x2325a3=users[_0x29fcec(0xe7)];else{if(_0x3405e9[0x0][_0x29fcec(0x178)]==_0x29fcec(0x16c))var _0x2325a3=users[_0x29fcec(0x124)];}}}}}}}const _0x4d2ad4=getRandom8DigitNumber();_0x4d2ad4['then'](_0x2ec961=>{var _0x141cc1=_0x29fcec;_0x3706fa['render'](_0x141cc1(0x129),{'success':_0x117b86[_0x141cc1(0x15d)](_0x141cc1(0x94)),'errors':_0x117b86[_0x141cc1(0x15d)]('errors'),'role':_0x15cfaa,'profile':_0x4530db,'customer':_0x3e9a2b,'warehouse':_0x181c62,'product':_0x7b4e43,'invoice':_0x2ec961,'master_shop':_0x3405e9,'language':_0x2325a3,'rooms_data':_0x2e7384});})[_0x29fcec(0x7a)](_0x3f7451=>{var _0x3661ee=_0x29fcec;_0x117b86['flash'](_0x3661ee(0xdc),_0x3661ee(0x136)),_0x3706fa[_0x3661ee(0x115)]('/all_sales_finished/view');});}catch(_0x21ea7b){console[_0x29fcec(0xfb)](_0x21ea7b);}}),router[a0_0xd8bb59(0x158)](a0_0xd8bb59(0xda),auth,async(_0x463358,_0x1fca5d)=>{var _0x296ef5=a0_0xd8bb59;try{const _0x1109f8=_0x463358[_0x296ef5(0x13c)]['id'];console[_0x296ef5(0xfb)](_0x1109f8);const _0x4290d0=await product['find'](),_0x42f9aa=await purchases[_0x296ef5(0xa7)]([{'$match':{'warehouse_name':_0x1109f8}},{'$unwind':'$product'},{'$group':{'_id':_0x296ef5(0xe5)}}]);console['log']('purchases_data',_0x42f9aa),_0x1fca5d[_0x296ef5(0x14b)](0xc8)[_0x296ef5(0x173)]({'purchases_data':_0x42f9aa,'product_data':_0x4290d0});}catch(_0x333994){console['log'](_0x333994);}}),router[a0_0xd8bb59(0x9e)](a0_0xd8bb59(0x175),auth,async(_0xc77317,_0xea1852)=>{var _0x2220a4=a0_0xd8bb59;try{const {warehouse_data:_0x3f1df3,product_data:_0x77c7c1}=_0xc77317[_0x2220a4(0x7e)];console['log'](_0xc77317[_0x2220a4(0x7e)]['product_data']);;const _0x5313ac=await master_shop[_0x2220a4(0x8c)]();console[_0x2220a4(0xfb)]('master',_0x5313ac);const _0xb6d5df=await product[_0x2220a4(0x143)]({'name':_0x77c7c1});console['log'](_0x2220a4(0xae),_0xb6d5df);const _0x1ff379=await warehouse[_0x2220a4(0xa7)]([{'$match':{'name':_0x3f1df3}},{'$unwind':_0x2220a4(0xc4)},{'$match':{'product_details.product_name':_0x77c7c1}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x2220a4(0xdf)}}}]);console[_0x2220a4(0xfb)]('stock_data',_0x1ff379),_0xea1852[_0x2220a4(0x14b)](0xc8)[_0x2220a4(0x173)]({'master':_0x5313ac,'new_product':_0xb6d5df,'stock_data':_0x1ff379});}catch(_0x45143d){console[_0x2220a4(0xfb)](_0x45143d);}}),router[a0_0xd8bb59(0x9e)](a0_0xd8bb59(0xbb),auth,async(_0x595b1e,_0x4e6143)=>{var _0x2aff41=a0_0xd8bb59;try{const {invoice:_0x2bd7d9,date:_0x3b2c13,warehouse_name:_0x2c4baa,product_name:_0x32f5bb,stock:_0x5c012a,quantity:_0x4d1da3,note:_0x43ba06,room:_0x47d7df,primary_code:_0x351e96,secondary_code:_0x5779b2,prod_code:_0x58ed32,level:_0x5a0f42,isle:_0x118f79,pallet:_0x262069,batch_code:_0x5236ef,SCRN:_0x14d173,expiry_date:_0x242a9d,mode_transpo:_0x159e89,name_driver:_0x1467cb}=_0x595b1e[_0x2aff41(0x7e)];if(typeof _0x32f5bb==_0x2aff41(0x110))var _0x2fe30a=[_0x595b1e[_0x2aff41(0x7e)]['product_name']],_0x2f1f77=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0xd2)]],_0x3da62e=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x14c)]],_0x134747=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0xf5)]],_0x57b709=[_0x595b1e['body'][_0x2aff41(0x13d)]],_0x124dd6=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x14f)]],_0x32d8c7=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x157)]],_0x4adc50=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0xc0)]],_0x5def3f=[_0x595b1e['body'][_0x2aff41(0x100)]],_0x204c02=[_0x595b1e[_0x2aff41(0x7e)]['batch_code']],_0x500d90=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x7c)]],_0x4d621e=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x10e)]],_0x55324a=[_0x595b1e['body'][_0x2aff41(0x84)]],_0x5d4354=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x89)]],_0x17e897=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0xcf)]],_0x26e831=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x156)]],_0x2328df=[_0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x70)]];else var _0x2fe30a=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x16e)]],_0x2f1f77=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0xd2)]],_0x3da62e=[..._0x595b1e[_0x2aff41(0x7e)]['carton']],_0x134747=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0xf5)]],_0x57b709=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x13d)]],_0x124dd6=[..._0x595b1e['body'][_0x2aff41(0x14f)]],_0x32d8c7=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x157)]],_0x4adc50=[..._0x595b1e['body'][_0x2aff41(0xc0)]],_0x5def3f=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x100)]],_0x204c02=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0xaf)]],_0x500d90=[..._0x595b1e['body'][_0x2aff41(0x7c)]],_0x4d621e=[..._0x595b1e[_0x2aff41(0x7e)]['product_date']],_0x55324a=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x84)]],_0x5d4354=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x89)]],_0x17e897=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0xcf)]],_0x26e831=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x156)]],_0x2328df=[..._0x595b1e[_0x2aff41(0x7e)][_0x2aff41(0x70)]];const _0x2cff91=_0x2fe30a[_0x2aff41(0xdd)](_0xf88980=>{return _0xf88980={'product_name':_0xf88980};});_0x2f1f77[_0x2aff41(0x11d)]((_0x35ce58,_0x59ecff)=>{var _0x3ae2f4=_0x2aff41;_0x2cff91[_0x59ecff][_0x3ae2f4(0xd2)]=_0x35ce58;}),_0x3da62e[_0x2aff41(0x11d)]((_0x3dcddd,_0x2f3b47)=>{var _0x215106=_0x2aff41;_0x2cff91[_0x2f3b47][_0x215106(0x6e)]=Math[_0x215106(0x74)](_0x3dcddd);}),_0x2328df[_0x2aff41(0x11d)]((_0x5d5ef8,_0x2397a8)=>{var _0x1a3756=_0x2aff41;_0x2cff91[_0x2397a8][_0x1a3756(0x70)]=_0x5d5ef8;}),_0x134747[_0x2aff41(0x11d)]((_0x4b4c0a,_0xfb1d23)=>{var _0xb452f4=_0x2aff41;_0x2cff91[_0xfb1d23][_0xb452f4(0xf5)]=_0x4b4c0a;}),_0x57b709[_0x2aff41(0x11d)]((_0xd1a1f6,_0x5227f8)=>{var _0x4d973a=_0x2aff41;_0x2cff91[_0x5227f8][_0x4d973a(0x13d)]=_0xd1a1f6;}),_0x124dd6[_0x2aff41(0x11d)]((_0x8b8199,_0x135f54)=>{var _0x128850=_0x2aff41;_0x2cff91[_0x135f54][_0x128850(0x109)]=_0x8b8199;}),_0x32d8c7[_0x2aff41(0x11d)]((_0x512fcc,_0x522b0c)=>{_0x2cff91[_0x522b0c]['bay']=_0x512fcc;}),_0x4adc50['forEach']((_0x354b46,_0x423621)=>{var _0x1397e8=_0x2aff41;_0x2cff91[_0x423621][_0x1397e8(0xb4)]=_0x354b46;}),_0x5def3f[_0x2aff41(0x11d)]((_0x458398,_0x467d65)=>{_0x2cff91[_0x467d65]['secondary_unit']=_0x458398;}),_0x204c02['forEach']((_0x5ef854,_0x467dce)=>{_0x2cff91[_0x467dce]['batch_code']=_0x5ef854;}),_0x500d90[_0x2aff41(0x11d)]((_0x12dabb,_0x3d9a43)=>{var _0x114ce3=_0x2aff41;_0x2cff91[_0x3d9a43][_0x114ce3(0x7c)]=_0x12dabb;}),_0x4d621e[_0x2aff41(0x11d)]((_0x416298,_0x8a3390)=>{var _0x23b4d1=_0x2aff41;_0x2cff91[_0x8a3390][_0x23b4d1(0x10d)]=_0x416298;}),_0x55324a[_0x2aff41(0x11d)]((_0x350c5f,_0x143666)=>{var _0x5805da=_0x2aff41;_0x2cff91[_0x143666][_0x5805da(0x86)]=_0x350c5f;}),_0x5d4354['forEach']((_0x2b1584,_0x5aaad2)=>{var _0x54f808=_0x2aff41;_0x2cff91[_0x5aaad2][_0x54f808(0x89)]=_0x2b1584;}),_0x17e897['forEach']((_0x5b5d82,_0x4c79f7)=>{var _0x384449=_0x2aff41;_0x2cff91[_0x4c79f7][_0x384449(0xe2)]=_0x5b5d82;}),_0x26e831[_0x2aff41(0x11d)]((_0x51c41e,_0x45def5)=>{_0x2cff91[_0x45def5]['invoice']=_0x51c41e;});var _0x80e0=0x0;_0x2cff91['forEach'](_0x2f2dda=>{var _0x5ab081=_0x2aff41;parseFloat(_0x2f2dda[_0x5ab081(0xd2)])<parseFloat(_0x2f2dda['quantity'])&&parseFloat(_0x2f2dda['quantity'])>parseFloat(_0x2f2dda['stock'])&&(console['log'](_0x2f2dda[_0x5ab081(0xd2)]+_0x5ab081(0xe6)+_0x2f2dda[_0x5ab081(0x6e)]),_0x80e0++);});if(_0x80e0!=0x0)return _0x595b1e[_0x2aff41(0x15d)](_0x2aff41(0xdc),_0x2aff41(0x126)),_0x4e6143['redirect']('back');const _0x453ab1=_0x2cff91['filter'](_0x5521a1=>_0x5521a1[_0x2aff41(0x6e)]!=='0'&&_0x5521a1[_0x2aff41(0x6e)]!==''),_0x9231de=new sales_finished({'invoice':_0x2bd7d9,'customer':_0x595b1e['body'][_0x2aff41(0xa8)],'date':_0x3b2c13,'warehouse_name':_0x2c4baa,'sale_product':_0x453ab1,'note':_0x43ba06,'room':_0x47d7df,'primary_code':_0x351e96,'secondary_code':_0x5779b2,'prod_code':_0x58ed32,'SCRN':_0x14d173,'finalize':_0x2aff41(0xd1),'mode_transpo':_0x159e89,'name_driver':_0x1467cb}),_0x39e072=await _0x9231de['save'](),_0x5d2938=await sales_finished['findOne']({'invoice':_0x2bd7d9}),_0x47c85e=new c_payment_data({'invoice':_0x2bd7d9,'customer':_0x595b1e[_0x2aff41(0x7e)]['customer'],'reason':'Sale'});await _0x47c85e[_0x2aff41(0xd5)]();const _0x4cafb5=await master_shop[_0x2aff41(0x8c)](),_0x25571e=await email_settings[_0x2aff41(0x143)](),_0x7f7862=await customer[_0x2aff41(0x143)]({'name':_0x595b1e['body'][_0x2aff41(0xa8)]});_0x4cafb5[0x0][_0x2aff41(0xa3)]==0x1?(right_currency=_0x4cafb5[0x0][_0x2aff41(0x160)],left_currency=''):(right_currency='',left_currency=_0x4cafb5[0x0][_0x2aff41(0x160)]);var _0x499ac3=_0x2fe30a,_0x57f122=_0x3da62e,_0x1cb904='',_0xa7f989;for(_0xa7f989 in _0x499ac3){_0x1cb904+=_0x2aff41(0x15c)+_0x2aff41(0x117)+_0x499ac3[_0xa7f989]+_0x2aff41(0x154)+_0x2aff41(0x117)+_0x57f122[_0xa7f989]+_0x2aff41(0x154)+_0x2aff41(0x13e);}console[_0x2aff41(0xfb)](_0x2aff41(0xf3),_0x1cb904);let _0x238a26=nodemailer[_0x2aff41(0x17d)]({'host':_0x25571e[_0x2aff41(0x80)],'port':Number(_0x25571e[_0x2aff41(0x164)]),'secure':![],'service':_0x2aff41(0xf2),'auth':{'user':_0x25571e[_0x2aff41(0x9f)],'pass':_0x25571e['password']}}),_0x3b82df={'from':_0x25571e[_0x2aff41(0x9f)],'to':_0x2aff41(0xd4),'subject':_0x2aff41(0x152),'attachments':[{'filename':_0x2aff41(0xc2),'path':__dirname+_0x2aff41(0xc8)+_0x2aff41(0x112)+_0x4cafb5[0x0]['image'],'cid':'logo'}],'html':_0x2aff41(0x15f)};_0x238a26['sendMail'](_0x3b82df,function(_0x261a98,_0x408fbe){var _0x4a4fe8=_0x2aff41;_0x261a98?(console['log'](_0x261a98),console[_0x4a4fe8(0xfb)](_0x4a4fe8(0x108))):console[_0x4a4fe8(0xfb)](_0x4a4fe8(0xb1));}),_0x595b1e[_0x2aff41(0x15d)](_0x2aff41(0x94),'Sales\x20Add\x20successfully'),_0x4e6143[_0x2aff41(0x115)](_0x2aff41(0x166)+_0x39e072[_0x2aff41(0x99)]);}catch(_0x1ff05f){console['log'](_0x1ff05f);}}),router[a0_0xd8bb59(0x158)](a0_0xd8bb59(0xc1),auth,async(_0x3902e2,_0xb3384d)=>{var _0x55991a=a0_0xd8bb59;try{const {username:_0x228778,email:_0x307306,role:_0x1be24c}=_0x3902e2[_0x55991a(0xcd)],_0x4d8c79=_0x3902e2[_0x55991a(0xcd)],_0x3e9b45=await profile[_0x55991a(0x143)]({'email':_0x4d8c79[_0x55991a(0x9f)]}),_0x3d01c8=await master_shop[_0x55991a(0x8c)](),_0x2f519d=_0x3902e2[_0x55991a(0x13c)]['id'],_0x1b7ffe=await sales_finished[_0x55991a(0xed)](_0x2f519d),_0x241d5f=await warehouse['aggregate']([{'$match':{'name':_0x1b7ffe[_0x55991a(0xa0)]}},{'$unwind':_0x55991a(0xc4)},{'$group':{'_id':_0x55991a(0x13f),'name':{'$first':_0x55991a(0xf8)},'product_stock':{'$first':_0x55991a(0xdf)},'bay':{'$first':_0x55991a(0x174)},'bin':{'$first':_0x55991a(0x98)},'type':{'$first':_0x55991a(0xbc)},'floorlevel':{'$first':_0x55991a(0xc5)},'primary_code':{'$first':_0x55991a(0x16a)},'secondary_code':{'$first':_0x55991a(0x88)},'product_code':{'$first':_0x55991a(0xbe)},'storage':{'$first':_0x55991a(0x107)},'rack':{'$first':_0x55991a(0x93)},'expiry_date':{'$first':_0x55991a(0xb8)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':'$room'},'room_data':{'$first':'$product_details.room_name'}}}]),_0x3081f7=await customer[_0x55991a(0x8c)]({});let _0x2f2641;if(_0x4d8c79[_0x55991a(0x82)]==_0x55991a(0x11e)){const _0x2e7739=await staff[_0x55991a(0x143)]({'email':_0x4d8c79[_0x55991a(0x9f)]});_0x2f2641=await warehouse[_0x55991a(0xa7)]([{'$match':{'status':_0x55991a(0x95),'name':_0x2e7739[_0x55991a(0xe1)]}},{'$group':{'_id':'$name','name':{'$first':_0x55991a(0xa9)}}}]);}else _0x2f2641=await warehouse[_0x55991a(0xa7)]([{'$match':{'status':_0x55991a(0x95)}},{'$group':{'_id':_0x55991a(0xa9),'name':{'$first':_0x55991a(0xa9)}}}]);const _0x236269=await product['find']({});if(_0x3d01c8[0x0][_0x55991a(0x178)]==_0x55991a(0xbf)){var _0x222758=users[_0x55991a(0x14d)];console[_0x55991a(0xfb)](_0x222758);}else{if(_0x3d01c8[0x0][_0x55991a(0x178)]=='Hindi')var _0x222758=users[_0x55991a(0xff)];else{if(_0x3d01c8[0x0][_0x55991a(0x178)]==_0x55991a(0xac))var _0x222758=users[_0x55991a(0xac)];else{if(_0x3d01c8[0x0][_0x55991a(0x178)]==_0x55991a(0xdb))var _0x222758=users[_0x55991a(0xdb)];else{if(_0x3d01c8[0x0][_0x55991a(0x178)]=='French')var _0x222758=users[_0x55991a(0x134)];else{if(_0x3d01c8[0x0]['language']==_0x55991a(0x162))var _0x222758=users['Portuguese'];else{if(_0x3d01c8[0x0][_0x55991a(0x178)]=='Chinese')var _0x222758=users['Chinese'];else{if(_0x3d01c8[0x0]['language']=='Arabic\x20(ae)')var _0x222758=users[_0x55991a(0x124)];}}}}}}}_0xb3384d[_0x55991a(0x17e)](_0x55991a(0x11c),{'success':_0x3902e2[_0x55991a(0x15d)](_0x55991a(0x94)),'errors':_0x3902e2[_0x55991a(0x15d)](_0x55991a(0xdc)),'role':_0x4d8c79,'profile':_0x3e9b45,'customer':_0x3081f7,'warehouse':_0x2f2641,'product':_0x241d5f,'user':_0x1b7ffe,'master_shop':_0x3d01c8,'unit':_0x236269,'language':_0x222758});}catch(_0x460085){console[_0x55991a(0xfb)](_0x460085);}}),router[a0_0xd8bb59(0x9e)]('/preview/:id',auth,async(_0x5bcd9b,_0x18e571)=>{var _0x66d501=a0_0xd8bb59;try{const _0x43ddb0=_0x5bcd9b[_0x66d501(0x13c)]['id'],{invoice:_0x26cb42,warehouse_name:_0x144643,room:_0xb58a2c}=_0x5bcd9b[_0x66d501(0x7e)],_0xdf1be9=await sales_finished[_0x66d501(0x143)]({'invoice':_0x26cb42}),_0x520b17=_0xdf1be9[_0x66d501(0x118)]['map'](async _0x4ba654=>{var _0x406da7=_0x66d501,_0x348086=await warehouse[_0x406da7(0x143)]({'name':_0x144643,'room':_0x4ba654['room_name'],'warehouse_category':_0x406da7(0xf6)});const _0x2fa147=_0x348086[_0x406da7(0x171)][_0x406da7(0xdd)](_0x1307e3=>{var _0x2bb1e3=_0x406da7;(_0x1307e3[_0x2bb1e3(0x16e)]==_0x4ba654[_0x2bb1e3(0x16e)]&&_0x1307e3[_0x2bb1e3(0x11b)]==_0x4ba654[_0x2bb1e3(0x11b)]&&_0x1307e3[_0x2bb1e3(0x7c)]==_0x4ba654[_0x2bb1e3(0x7c)]&&_0x1307e3['production_date']==_0x4ba654[_0x2bb1e3(0x10d)]&&_0x1307e3[_0x2bb1e3(0xaf)]==_0x4ba654[_0x2bb1e3(0xaf)]&&_0x1307e3['invoice']==_0x4ba654[_0x2bb1e3(0x165)]||_0x1307e3['_id']==_0x4ba654[_0x2bb1e3(0x70)])&&(_0x1307e3[_0x2bb1e3(0x179)]>0x0&&(console[_0x2bb1e3(0xfb)](_0x1307e3[_0x2bb1e3(0x16e)]+_0x2bb1e3(0x159)+_0x4ba654['product_name']+_0x2bb1e3(0x9a)+_0x1307e3[_0x2bb1e3(0x11b)]+_0x2bb1e3(0x159)+_0x4ba654[_0x2bb1e3(0x11b)]+_0x2bb1e3(0x9a)+_0x1307e3[_0x2bb1e3(0x10d)]+_0x2bb1e3(0x159)+_0x4ba654[_0x2bb1e3(0x10d)]+_0x2bb1e3(0x9a)+_0x1307e3['expiry_date']+_0x2bb1e3(0x159)+_0x4ba654[_0x2bb1e3(0x7c)]+_0x2bb1e3(0x9a)+_0x1307e3[_0x2bb1e3(0xaf)]+_0x2bb1e3(0x159)+_0x4ba654[_0x2bb1e3(0xaf)]+'\x20&&\x20'+_0x1307e3[_0x2bb1e3(0x165)]+_0x2bb1e3(0x159)+_0x4ba654[_0x2bb1e3(0x165)]+_0x2bb1e3(0x9a)+_0x1307e3[_0x2bb1e3(0x179)]+_0x2bb1e3(0x9c)+_0x4ba654[_0x2bb1e3(0x6e)]+_0x2bb1e3(0x81)+_0x4ba654['room_name']+'\x20&&\x20'+_0x1307e3[_0x2bb1e3(0x99)]+_0x2bb1e3(0x159)+_0x4ba654[_0x2bb1e3(0x70)]),_0x1307e3[_0x2bb1e3(0x179)]=Math[_0x2bb1e3(0xe9)](0x0,Math[_0x2bb1e3(0x74)](_0x1307e3[_0x2bb1e3(0x179)])-Math[_0x2bb1e3(0x74)](_0x4ba654[_0x2bb1e3(0x6e)]))));});return _0x348086;});Promise[_0x66d501(0x8e)](_0x520b17)[_0x66d501(0x17b)](async _0x5cc011=>{var _0x2369bb=_0x66d501;try{for(const _0x235d0c of _0x5cc011){await _0x235d0c[_0x2369bb(0xd5)]();}_0xdf1be9[_0x2369bb(0x16d)]=_0x2369bb(0x90);const _0x2c56c9=await _0xdf1be9['save'](),_0x319600=await master_shop[_0x2369bb(0x8c)](),_0x30c238=await email_settings[_0x2369bb(0x143)](),_0x3a2db2=await supervisor_settings['find']();var _0x13b22b=_0xdf1be9['sale_product'],_0x3bc55c='',_0x37f9df;for(_0x37f9df in _0x13b22b){var _0x2cd5f5='FG';_0xdf1be9[_0x2369bb(0xa0)]==_0x2369bb(0x104)&&(_0x2cd5f5='DG'),_0x3bc55c+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x13b22b[_0x37f9df][_0x2369bb(0x16e)]+_0x2369bb(0x154)+_0x2369bb(0x117)+_0x13b22b[_0x37f9df]['product_code']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x13b22b[_0x37f9df][_0x2369bb(0x6e)]+_0x2369bb(0x154)+_0x2369bb(0x117)+_0x13b22b[_0x37f9df][_0x2369bb(0xb4)]+'</td>'+_0x2369bb(0x117)+_0x13b22b[_0x37f9df][_0x2369bb(0x100)]+_0x2369bb(0x154)+_0x2369bb(0x117)+_0xdf1be9[_0x2369bb(0xa0)]+_0x2369bb(0x154)+_0x2369bb(0x117)+_0x13b22b[_0x37f9df][_0x2369bb(0xe2)]+_0x2369bb(0x154)+_0x2369bb(0x117)+_0x2cd5f5+_0x13b22b[_0x37f9df][_0x2369bb(0x11b)]+_0x2369bb(0x154);}let _0x2d1ec8=nodemailer[_0x2369bb(0x17d)]({'host':_0x30c238[_0x2369bb(0x80)],'port':Number(_0x30c238['port']),'secure':![],'auth':{'user':_0x30c238['email'],'pass':_0x30c238['password']}}),_0x4a82c3={'from':_0x30c238[_0x2369bb(0x9f)],'to':_0x3a2db2[0x0]['FGSEmail'],'subject':_0x2369bb(0x116),'attachments':[{'filename':_0x2369bb(0xc2),'path':__dirname+'/../public'+_0x2369bb(0x112)+_0x319600[0x0][_0x2369bb(0x122)],'cid':_0x2369bb(0xfa)}],'html':_0x2369bb(0x149)+_0x2369bb(0xd0)+_0x2369bb(0xd3)+'<div>'+_0x2369bb(0xfd)+_0x2369bb(0x15e)+_0x2369bb(0x85)+_0x2369bb(0x6c)+_0x2369bb(0x15e)+_0x2369bb(0xd9)+_0x319600[0x0][_0x2369bb(0x123)]+_0x2369bb(0x17c)+_0x2369bb(0x6c)+_0x2369bb(0x6c)+_0x2369bb(0x177)+'<div>'+_0x2369bb(0x16f)+'\x20Order\x20Number\x20:\x20'+_0xdf1be9['invoice']+'\x20'+_0x2369bb(0x66)+_0x2369bb(0x153)+_0xdf1be9['date']+'\x20'+_0x2369bb(0xba)+_0x2369bb(0x76)+_0x2369bb(0x6c)+_0x2369bb(0x78)+_0x2369bb(0xad)+_0x2369bb(0x15c)+_0x2369bb(0x72)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x2369bb(0x170)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x2369bb(0x14e)+_0x2369bb(0x155)+_0x2369bb(0x73)+_0x2369bb(0x13e)+_0x2369bb(0xf0)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3bc55c+'\x20'+'</tbody>'+_0x2369bb(0xa6)+_0x2369bb(0x15e)+'<strong>\x20Regards\x20</strong>'+_0x2369bb(0xf4)+_0x319600[0x0][_0x2369bb(0x123)]+_0x2369bb(0x76)+'</div>'+'</div>'+_0x2369bb(0x133)};_0x2d1ec8['sendMail'](_0x4a82c3,function(_0x5ee9e7,_0x5cf00b){var _0x1ee76b=_0x2369bb;_0x5ee9e7?(console[_0x1ee76b(0xfb)](_0x5ee9e7),console[_0x1ee76b(0xfb)](_0x1ee76b(0x108))):console[_0x1ee76b(0xfb)](_0x1ee76b(0xb1));}),_0x5bcd9b['flash'](_0x2369bb(0x94),'Sales\x20Update\x20successfully'),_0x18e571[_0x2369bb(0x115)]('/picking_list/pdf/'+_0x43ddb0);}catch(_0x5a4e5e){console['error'](_0x5a4e5e),_0x18e571[_0x2369bb(0x14b)](0x1f4)[_0x2369bb(0x173)]({'error':_0x2369bb(0xe0)});}})[_0x66d501(0x7a)](_0x3d00c6=>{var _0x10e293=_0x66d501;console[_0x10e293(0x75)](_0x3d00c6),_0x18e571[_0x10e293(0x14b)](0x1f4)['json']({'error':_0x10e293(0x120)});});}catch(_0x17fc04){console[_0x66d501(0xfb)](_0x17fc04);}}),router[a0_0xd8bb59(0x158)](a0_0xd8bb59(0xf9),auth,async(_0x3c4588,_0x596441)=>{var _0x36bcc9=a0_0xd8bb59;try{const {username:_0x416adb,email:_0x57a9b2,role:_0x28048d}=_0x3c4588[_0x36bcc9(0xcd)],_0x5aacef=_0x3c4588[_0x36bcc9(0xcd)],_0x105ee8=await profile[_0x36bcc9(0x143)]({'email':_0x5aacef[_0x36bcc9(0x9f)]}),_0x41af4b=await master_shop['find'](),_0x4dbdb1=_0x3c4588[_0x36bcc9(0x13c)]['id'],_0x503dc8=await sales_finished[_0x36bcc9(0xed)](_0x4dbdb1);let _0x183904=new Date(_0x503dc8[_0x36bcc9(0x7c)]),_0x38868c=('0'+_0x183904[_0x36bcc9(0x106)]())[_0x36bcc9(0xab)](-0x2),_0x37ea33=('0'+(_0x183904['getMonth']()+0x1))[_0x36bcc9(0xab)](-0x2),_0x34a2ab=_0x183904[_0x36bcc9(0x79)](),_0x140a2e=_0x34a2ab+'-'+_0x37ea33+'-'+_0x38868c;var _0x577d34=['Ambient',_0x36bcc9(0xec)];const _0x2d741b=await warehouse[_0x36bcc9(0xa7)]([{'$match':{'name':_0x503dc8['warehouse_name'],'room':_0x503dc8[_0x36bcc9(0x140)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x36bcc9(0x13f),'name':{'$first':_0x36bcc9(0xf8)},'product_stock':{'$first':_0x36bcc9(0xdf)},'bay':{'$first':_0x36bcc9(0x174)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x36bcc9(0xc5)},'primary_code':{'$first':_0x36bcc9(0x16a)},'secondary_code':{'$first':_0x36bcc9(0x88)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x36bcc9(0x107)},'rack':{'$first':_0x36bcc9(0x93)}}}]),_0x25d008=await customer['find']({});let _0x1bbec4;if(_0x5aacef[_0x36bcc9(0x82)]==_0x36bcc9(0x11e)){const _0x100d82=await staff['findOne']({'email':_0x5aacef[_0x36bcc9(0x9f)]});_0x1bbec4=await warehouse[_0x36bcc9(0xa7)]([{'$match':{'status':'Enabled','name':_0x100d82[_0x36bcc9(0xe1)]}},{'$group':{'_id':_0x36bcc9(0xa9),'name':{'$first':_0x36bcc9(0xa9)}}}]);}else _0x1bbec4=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x36bcc9(0xa9),'name':{'$first':_0x36bcc9(0xa9)}}}]);const _0x34d522=await product[_0x36bcc9(0x8c)]({});if(_0x41af4b[0x0]['language']==_0x36bcc9(0xbf)){var _0x13c44d=users[_0x36bcc9(0x14d)];console[_0x36bcc9(0xfb)](_0x13c44d);}else{if(_0x41af4b[0x0]['language']=='Hindi')var _0x13c44d=users[_0x36bcc9(0xff)];else{if(_0x41af4b[0x0][_0x36bcc9(0x178)]==_0x36bcc9(0xac))var _0x13c44d=users[_0x36bcc9(0xac)];else{if(_0x41af4b[0x0][_0x36bcc9(0x178)]==_0x36bcc9(0xdb))var _0x13c44d=users[_0x36bcc9(0xdb)];else{if(_0x41af4b[0x0]['language']==_0x36bcc9(0x134))var _0x13c44d=users[_0x36bcc9(0x134)];else{if(_0x41af4b[0x0][_0x36bcc9(0x178)]==_0x36bcc9(0x162))var _0x13c44d=users['Portuguese'];else{if(_0x41af4b[0x0]['language']==_0x36bcc9(0xe7))var _0x13c44d=users[_0x36bcc9(0xe7)];else{if(_0x41af4b[0x0][_0x36bcc9(0x178)]=='Arabic\x20(ae)')var _0x13c44d=users[_0x36bcc9(0x124)];}}}}}}}_0x596441['render'](_0x36bcc9(0xd7),{'success':_0x3c4588['flash']('success'),'errors':_0x3c4588[_0x36bcc9(0x15d)](_0x36bcc9(0xdc)),'role':_0x5aacef,'profile':_0x105ee8,'customer':_0x25d008,'warehouse':_0x1bbec4,'product':_0x2d741b,'user':_0x503dc8,'master_shop':_0x41af4b,'unit':_0x34d522,'language':_0x13c44d,'rooms_data':_0x577d34,'ed_fullDate':_0x140a2e});}catch(_0xf5f464){console['log'](_0xf5f464);}}),router[a0_0xd8bb59(0x9e)](a0_0xd8bb59(0xf9),auth,async(_0x2e22ef,_0x370b32)=>{var _0x4a96ec=a0_0xd8bb59;try{const _0x549dfc=_0x2e22ef['params']['id'],_0x5a8353=await sales_finished['findOne']({'_id':_0x2e22ef[_0x4a96ec(0x13c)]['id']}),_0x4d2f43=await warehouse[_0x4a96ec(0x143)]({'name':_0x5a8353['warehouse_name'],'room':_0x2e22ef['body']['room'],'warehouse_category':_0x4a96ec(0xf6)}),{invoice:_0x4b1bcb,customer:_0x1108a6,date:_0x4d7d74,warehouse_name:_0x2932be,product_name:_0x4b9b89,stock:_0x819696,adjust_qty:_0x36a759,note:_0x574db3,room:_0x2bd7fc,primary_code:_0x1f92ef,secondary_code:_0x1f52a3,prod_code:_0x196c85,level:_0x46c0a0,isle:_0x374e64,pallet:_0x3a4d47,expiry_date:_0x137b6a}=_0x2e22ef[_0x4a96ec(0x7e)];if(typeof _0x4b9b89=='string')var _0x349f3f=[_0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0x16e)]],_0x57cc9b=[_0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0xd2)]],_0xd3b27d=[_0x2e22ef[_0x4a96ec(0x7e)]['adjust_qty']],_0x1180eb=[_0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0xf5)]],_0x128757=[_0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0x13d)]],_0x5044b4=[_0x2e22ef[_0x4a96ec(0x7e)]['prod_code']],_0x2759cf=[_0x2e22ef[_0x4a96ec(0x7e)]['level']],_0x46ae1b=[_0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0x7c)]];else var _0x349f3f=[..._0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0x16e)]],_0x57cc9b=[..._0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0xd2)]],_0xd3b27d=[..._0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0x11f)]],_0x1180eb=[..._0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0xf5)]],_0x128757=[..._0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0x13d)]],_0x5044b4=[..._0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0x14f)]],_0x2759cf=[..._0x2e22ef[_0x4a96ec(0x7e)]['level']],_0x46ae1b=[..._0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0x7c)]];const _0x22bc07=_0x349f3f[_0x4a96ec(0xdd)](_0x3119f1=>{return _0x3119f1={'product_name':_0x3119f1};});_0x57cc9b[_0x4a96ec(0x11d)]((_0x4de38c,_0x3ef506)=>{var _0x53e8d8=_0x4a96ec;_0x22bc07[_0x3ef506][_0x53e8d8(0xd2)]=_0x4de38c;}),_0xd3b27d[_0x4a96ec(0x11d)]((_0x309ece,_0x3f7126)=>{_0x22bc07[_0x3f7126]['quantity']=_0x309ece;}),_0x1180eb['forEach']((_0xcdbd8e,_0x39be97)=>{var _0x56e8ac=_0x4a96ec;_0x22bc07[_0x39be97][_0x56e8ac(0xf5)]=_0xcdbd8e;}),_0x128757['forEach']((_0xbdc8c5,_0x2c6112)=>{var _0x31099b=_0x4a96ec;_0x22bc07[_0x2c6112][_0x31099b(0x13d)]=_0xbdc8c5;}),_0x5044b4[_0x4a96ec(0x11d)]((_0x194e2b,_0x468c78)=>{var _0x4e13f8=_0x4a96ec;_0x22bc07[_0x468c78][_0x4e13f8(0x109)]=_0x194e2b;}),_0x2759cf[_0x4a96ec(0x11d)]((_0x1b5902,_0x4eb693)=>{var _0x3a63cf=_0x4a96ec;_0x22bc07[_0x4eb693][_0x3a63cf(0x157)]=_0x1b5902;}),_0x46ae1b['forEach']((_0x251d71,_0x2d9941)=>{var _0x132e82=_0x4a96ec;_0x22bc07[_0x2d9941][_0x132e82(0x7c)]=_0x251d71;});var _0x35bafd=0x0;_0x22bc07[_0x4a96ec(0x11d)](_0x1bf7f1=>{var _0x242e75=_0x4a96ec;console[_0x242e75(0xfb)](_0x242e75(0x144),_0x1bf7f1),(parseInt(_0x1bf7f1[_0x242e75(0xd2)])<parseInt(_0x1bf7f1['quantity'])||parseInt(_0x1bf7f1[_0x242e75(0x6e)])==0x0)&&_0x35bafd++;});if(_0x35bafd!=0x0)return _0x2e22ef['flash'](_0x4a96ec(0xdc),_0x4a96ec(0x142)),_0x370b32[_0x4a96ec(0x115)](_0x4a96ec(0x71));_0x5a8353[_0x4a96ec(0x118)][_0x4a96ec(0x11d)](_0x587b7c=>{var _0x3791b9=_0x4a96ec;const _0x48cc7a=_0x4d2f43[_0x3791b9(0x171)][_0x3791b9(0xdd)](_0x321008=>{var _0x58584c=_0x3791b9;_0x321008[_0x58584c(0x16e)]==_0x587b7c[_0x58584c(0x16e)]&&_0x321008[_0x58584c(0x11b)]==_0x587b7c['bay']&&(_0x321008[_0x58584c(0x179)]=parseInt(_0x321008[_0x58584c(0x179)])+parseInt(_0x587b7c[_0x58584c(0x6e)]));});}),await _0x4d2f43[_0x4a96ec(0xd5)]();const _0x1d6175=_0x22bc07[_0x4a96ec(0x168)](_0x3a29e4=>_0x3a29e4[_0x4a96ec(0x6e)]!=='0'&&_0x3a29e4[_0x4a96ec(0x6e)]!=='');_0x5a8353[_0x4a96ec(0x165)]=_0x4b1bcb,_0x5a8353['customer']=_0x1108a6,_0x5a8353[_0x4a96ec(0xeb)]=_0x4d7d74,_0x5a8353['warehouse_name']=_0x2932be,_0x5a8353[_0x4a96ec(0x118)]=_0x1d6175,_0x5a8353['note']=_0x574db3,_0x5a8353[_0x4a96ec(0x140)]=_0x2bd7fc;const _0x1735e6=await _0x5a8353[_0x4a96ec(0xd5)](),_0x50514e=await sales_finished[_0x4a96ec(0x143)]({'_id':_0x2e22ef[_0x4a96ec(0x13c)]['id']}),_0x17987d=await warehouse[_0x4a96ec(0x143)]({'name':_0x2932be,'room':_0x2bd7fc,'warehouse_category':_0x4a96ec(0xf6)});_0x50514e[_0x4a96ec(0x118)][_0x4a96ec(0x11d)](_0x46bdf6=>{var _0x38f67e=_0x4a96ec;const _0x752922=_0x17987d[_0x38f67e(0x171)][_0x38f67e(0xdd)](_0x23c0f7=>{var _0x15b255=_0x38f67e;_0x23c0f7['product_name']==_0x46bdf6[_0x15b255(0x16e)]&&_0x23c0f7['bay']==_0x46bdf6[_0x15b255(0x11b)]&&(_0x23c0f7['product_stock']=parseInt(_0x23c0f7[_0x15b255(0x179)])-parseInt(_0x46bdf6[_0x15b255(0x6e)]));});}),console[_0x4a96ec(0xfb)](_0x4a96ec(0x131),_0x17987d),await _0x17987d[_0x4a96ec(0xd5)]();const _0x209e17=await c_payment_data[_0x4a96ec(0x143)]({'invoice':_0x2e22ef['body']['invoice']});_0x209e17[_0x4a96ec(0x146)]=_0x2e22ef[_0x4a96ec(0x7e)][_0x4a96ec(0x146)],await _0x209e17[_0x4a96ec(0xd5)](),_0x2e22ef['flash'](_0x4a96ec(0x94),_0x4a96ec(0x7f)),_0x370b32['redirect'](_0x4a96ec(0xfc));}catch(_0xe0b960){console[_0x4a96ec(0xfb)](_0xe0b960);}}),router[a0_0xd8bb59(0x9e)](a0_0xd8bb59(0xc7),auth,async(_0x575f9c,_0x3bda9e)=>{var _0x21dc8d=a0_0xd8bb59;try{const _0x503f2f=_0x575f9c[_0x21dc8d(0x13c)]['id'],{invoice:_0x3feb65,customer:_0x3296e9,receivable_amount:_0x197365,received_amount:_0x1fd5af}=_0x575f9c[_0x21dc8d(0x7e)],_0x2b8495=await sales[_0x21dc8d(0xed)](_0x503f2f);console['log'](_0x2b8495);var _0x2e9329=_0x197365-_0x1fd5af;console[_0x21dc8d(0xfb)](_0x1fd5af),_0x2b8495[_0x21dc8d(0x8d)]=parseFloat(_0x1fd5af)+parseFloat(_0x2b8495['received_amount']),_0x2b8495[_0x21dc8d(0x10a)]=_0x2e9329,console['log'](_0x2b8495);const _0x5a81a5=await _0x2b8495[_0x21dc8d(0xd5)](),_0x3873ec=await c_payment_data[_0x21dc8d(0x143)]({'invoice':_0x3feb65});_0x3873ec['amount']=_0x2e9329,await _0x3873ec[_0x21dc8d(0xd5)]();let _0x241ff4=new Date(),_0x26b314=('0'+_0x241ff4[_0x21dc8d(0x106)]())[_0x21dc8d(0xab)](-0x2),_0x570633=('0'+(_0x241ff4['getMonth']()+0x1))[_0x21dc8d(0xab)](-0x2),_0x22a780=_0x241ff4[_0x21dc8d(0x79)](),_0x38932f=_0x22a780+'-'+_0x570633+'-'+_0x26b314;const _0x466f34=new customer_payment({'invoice':_0x3feb65,'date':_0x22a780+'-'+_0x570633+'-'+_0x26b314,'customer':_0x3296e9,'reason':_0x21dc8d(0xb9),'amount':_0x1fd5af}),_0xab657f=await _0x466f34['save']();_0x575f9c[_0x21dc8d(0x15d)]('success',_0x21dc8d(0xe8)),_0x3bda9e[_0x21dc8d(0x115)](_0x21dc8d(0x83));}catch(_0x59fb3d){console[_0x21dc8d(0xfb)](_0x59fb3d);}}),router[a0_0xd8bb59(0x158)]('/invoice/:id',auth,async(_0x972da6,_0x4faa4f)=>{var _0x4cd739=a0_0xd8bb59;try{const {username:_0x1b187a,email:_0xd056b0,role:_0x1d31fd}=_0x972da6[_0x4cd739(0xcd)],_0x5deb03=_0x972da6[_0x4cd739(0xcd)],_0x56bd69=await profile[_0x4cd739(0x143)]({'email':_0x5deb03[_0x4cd739(0x9f)]}),_0x521258=await master_shop[_0x4cd739(0x8c)]();console[_0x4cd739(0xfb)](_0x4cd739(0x119),_0x521258);const _0x1e5fb7=_0x972da6[_0x4cd739(0x13c)]['id'],_0x998da0=await sales[_0x4cd739(0xed)](_0x1e5fb7);console[_0x4cd739(0xfb)](_0x998da0);const _0x1d3724=await customer[_0x4cd739(0x143)]({'name':_0x998da0[_0x4cd739(0xa8)]});console[_0x4cd739(0xfb)](_0x1d3724);if(_0x521258[0x0][_0x4cd739(0x178)]==_0x4cd739(0xbf)){var _0x59285f=users[_0x4cd739(0x14d)];console['log'](_0x59285f);}else{if(_0x521258[0x0][_0x4cd739(0x178)]=='Hindi')var _0x59285f=users[_0x4cd739(0xff)];else{if(_0x521258[0x0][_0x4cd739(0x178)]==_0x4cd739(0xac))var _0x59285f=users[_0x4cd739(0xac)];else{if(_0x521258[0x0]['language']=='Spanish')var _0x59285f=users['Spanish'];else{if(_0x521258[0x0][_0x4cd739(0x178)]==_0x4cd739(0x134))var _0x59285f=users['French'];else{if(_0x521258[0x0][_0x4cd739(0x178)]==_0x4cd739(0x162))var _0x59285f=users['Portuguese'];else{if(_0x521258[0x0][_0x4cd739(0x178)]==_0x4cd739(0xe7))var _0x59285f=users[_0x4cd739(0xe7)];else{if(_0x521258[0x0][_0x4cd739(0x178)]==_0x4cd739(0x16c))var _0x59285f=users[_0x4cd739(0x124)];}}}}}}}_0x4faa4f['render'](_0x4cd739(0x114),{'success':_0x972da6[_0x4cd739(0x15d)](_0x4cd739(0x94)),'errors':_0x972da6[_0x4cd739(0x15d)]('errors'),'role':_0x5deb03,'profile':_0x56bd69,'master_shop':_0x521258,'customers':_0x1d3724,'sales':_0x998da0,'language':_0x59285f});}catch(_0x3f7f14){console[_0x4cd739(0xfb)](_0x3f7f14);}}),router[a0_0xd8bb59(0x158)]('/view/return_sales/:id',auth,async(_0xa6cad0,_0x360ce7)=>{var _0x5e76e2=a0_0xd8bb59;try{const {username:_0xf69a43,email:_0x5e2d0b,role:_0x1620da}=_0xa6cad0['user'],_0x27dbf6=_0xa6cad0[_0x5e76e2(0xcd)],_0x43c114=await profile[_0x5e76e2(0x143)]({'email':_0x27dbf6[_0x5e76e2(0x9f)]}),_0x553a80=await master_shop[_0x5e76e2(0x8c)](),_0x418ac8=_0xa6cad0['params']['id'],_0x49700a=await sales_finished[_0x5e76e2(0xed)](_0x418ac8),_0x2d30bd=await warehouse[_0x5e76e2(0xa7)]([{'$match':{'name':_0x49700a[_0x5e76e2(0xa0)]}},{'$unwind':_0x5e76e2(0xc4)},{'$group':{'_id':_0x5e76e2(0x13f),'name':{'$first':_0x5e76e2(0xf8)},'product_stock':{'$first':_0x5e76e2(0xdf)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5e76e2(0x98)},'type':{'$first':_0x5e76e2(0xbc)},'floorlevel':{'$first':_0x5e76e2(0xc5)},'primary_code':{'$first':_0x5e76e2(0x16a)},'secondary_code':{'$first':_0x5e76e2(0x88)},'product_code':{'$first':_0x5e76e2(0xbe)},'storage':{'$first':_0x5e76e2(0x107)},'rack':{'$first':_0x5e76e2(0x93)},'expiry_date':{'$first':_0x5e76e2(0xb8)},'production_date':{'$first':_0x5e76e2(0x8a)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x5e76e2(0xe3)},'maxProducts':{'$first':_0x5e76e2(0x163)},'batch_code':{'$first':_0x5e76e2(0xb7)},'maxPerUnit':{'$first':_0x5e76e2(0x97)}}}]),_0x3557f2=await product[_0x5e76e2(0x8c)]({}),_0x3d6095=await warehouse[_0x5e76e2(0xa7)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0x5e76e2(0xa2),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0xc73db0=[_0x5e76e2(0xbd)];const _0x5f399e=await warehouse[_0x5e76e2(0xa7)]([{'$match':{'status':_0x5e76e2(0x95),'name':_0x5e76e2(0x69)}},{'$group':{'_id':_0x5e76e2(0xa9),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x553a80[0x0]['language']==_0x5e76e2(0xbf)){var _0x3481ae=users[_0x5e76e2(0x14d)];console['log'](_0x3481ae);}else{if(_0x553a80[0x0]['language']==_0x5e76e2(0xff))var _0x3481ae=users[_0x5e76e2(0xff)];else{if(_0x553a80[0x0][_0x5e76e2(0x178)]==_0x5e76e2(0xac))var _0x3481ae=users['German'];else{if(_0x553a80[0x0][_0x5e76e2(0x178)]==_0x5e76e2(0xdb))var _0x3481ae=users[_0x5e76e2(0xdb)];else{if(_0x553a80[0x0]['language']==_0x5e76e2(0x134))var _0x3481ae=users['French'];else{if(_0x553a80[0x0]['language']==_0x5e76e2(0x162))var _0x3481ae=users[_0x5e76e2(0x138)];else{if(_0x553a80[0x0][_0x5e76e2(0x178)]==_0x5e76e2(0xe7))var _0x3481ae=users[_0x5e76e2(0xe7)];else{if(_0x553a80[0x0][_0x5e76e2(0x178)]=='Arabic\x20(ae)')var _0x3481ae=users[_0x5e76e2(0x124)];}}}}}}}_0x360ce7[_0x5e76e2(0x17e)]('return_sale_finished',{'success':_0xa6cad0[_0x5e76e2(0x15d)]('success'),'errors':_0xa6cad0['flash'](_0x5e76e2(0xdc)),'role':_0x27dbf6,'profile':_0x43c114,'user':_0x49700a,'stock':_0x2d30bd,'master_shop':_0x553a80,'unit':_0x3557f2,'language':_0x3481ae,'warehouses':_0x3d6095,'rooms':_0xc73db0,'warehouse_QA':_0x5f399e});}catch(_0x547d24){console[_0x5e76e2(0xfb)](_0x547d24),_0x360ce7[_0x5e76e2(0x14b)](0xc8)['json']({'message':_0x547d24[_0x5e76e2(0x12b)]});}}),router[a0_0xd8bb59(0x9e)](a0_0xd8bb59(0xa1),auth,async(_0x83d2be,_0x4f84a6)=>{var _0x5bd9fc=a0_0xd8bb59;if(_0x83d2be[_0x5bd9fc(0x7e)]['for_categorize']=='QA')try{const {invoice:_0x5a7e06,date:_0x27bacb,warehouse_name:_0x1c9d93,product_name:_0x5e0373,primary_code:_0x5c4918,secondary_code:_0x11742f,product_code:_0x5e3042,sales_quantity:_0x419eef,stocks:_0x13680d,return_qty:_0x42833c,Room_name:_0x21c815,to_warehouse_name_QA:_0x31cc75,to_Room_name_QA:_0x1cb070,note:_0x4062d0,for_categorize:_0x3a35cc,product_name_QA1:_0x14d16e}=_0x83d2be[_0x5bd9fc(0x7e)];if(typeof _0x14d16e==_0x5bd9fc(0x110))var _0x2a41dd=[_0x83d2be['body'][_0x5bd9fc(0x77)]],_0x2d3d04=[_0x83d2be[_0x5bd9fc(0x7e)]['primary_code_QA']],_0x289fd8=[_0x83d2be['body'][_0x5bd9fc(0xfe)]],_0x2ec85c=[_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x12d)]],_0x3ca3ac=[_0x83d2be['body']['sales_quantity_QA']],_0x5d97ae=[_0x83d2be[_0x5bd9fc(0x7e)]['stocks_QA']],_0x4f27c1=[_0x83d2be[_0x5bd9fc(0x7e)]['return_qty_QA']],_0x1adefe=[_0x83d2be[_0x5bd9fc(0x7e)]['maxPerUnit_QA']],_0x3d34a5=[_0x83d2be['body'][_0x5bd9fc(0x127)]],_0x76df4e=[_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0xb3)]],_0x54bbb9=[_0x83d2be[_0x5bd9fc(0x7e)]['secondary_unit_QA']],_0x3e02f8=[_0x83d2be['body'][_0x5bd9fc(0xaa)]],_0x214843=[_0x83d2be['body'][_0x5bd9fc(0x12c)]],_0xd2a2ba=[_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x105)]];else var _0x2a41dd=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x77)]],_0x2d3d04=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x7b)]],_0x289fd8=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0xfe)]],_0x2ec85c=[..._0x83d2be['body'][_0x5bd9fc(0x12d)]],_0x3ca3ac=[..._0x83d2be[_0x5bd9fc(0x7e)]['sales_quantity_QA']],_0x5d97ae=[..._0x83d2be['body'][_0x5bd9fc(0x65)]],_0x4f27c1=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x91)]],_0x1adefe=[..._0x83d2be['body'][_0x5bd9fc(0xc6)]],_0x3d34a5=[..._0x83d2be['body']['maxProducts_QA']],_0x76df4e=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0xb3)]],_0x54bbb9=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x10c)]],_0x3e02f8=[..._0x83d2be['body'][_0x5bd9fc(0xaa)]],_0x214843=[..._0x83d2be['body'][_0x5bd9fc(0x12c)]],_0xd2a2ba=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x105)]];const _0x4cd187=_0x2a41dd['map'](_0x3fb60a=>{return _0x3fb60a={'product_name':_0x3fb60a};});_0x2d3d04[_0x5bd9fc(0x11d)]((_0x21c7ba,_0x23af43)=>{var _0x38f774=_0x5bd9fc;_0x4cd187[_0x23af43][_0x38f774(0xf5)]=_0x21c7ba;}),_0x289fd8['forEach']((_0x42e545,_0x4ef17a)=>{_0x4cd187[_0x4ef17a]['secondary_code']=_0x42e545;}),_0x2ec85c['forEach']((_0xf17317,_0x298421)=>{_0x4cd187[_0x298421]['product_code']=_0xf17317;}),_0x3ca3ac[_0x5bd9fc(0x11d)]((_0x16e123,_0x2f42df)=>{var _0x315f02=_0x5bd9fc;_0x4cd187[_0x2f42df][_0x315f02(0x113)]=_0x16e123;}),_0x5d97ae['forEach']((_0x5cc2d4,_0x2b0d62)=>{var _0x7770e7=_0x5bd9fc;_0x4cd187[_0x2b0d62][_0x7770e7(0xd2)]=_0x5cc2d4;}),_0x4f27c1[_0x5bd9fc(0x11d)]((_0x24a04f,_0x4c37aa)=>{var _0x520974=_0x5bd9fc;_0x4cd187[_0x4c37aa][_0x520974(0x8b)]=_0x24a04f;}),_0x1adefe['forEach']((_0x50a89c,_0x3dc644)=>{var _0x25e36b=_0x5bd9fc;_0x4cd187[_0x3dc644][_0x25e36b(0xcb)]=_0x50a89c;}),_0x3d34a5[_0x5bd9fc(0x11d)]((_0x4bb76d,_0x46f00e)=>{var _0x127781=_0x5bd9fc;_0x4cd187[_0x46f00e][_0x127781(0x87)]=_0x4bb76d;}),_0x76df4e['forEach']((_0x590695,_0x248836)=>{var _0x1acbef=_0x5bd9fc;_0x4cd187[_0x248836][_0x1acbef(0xaf)]=_0x590695;}),_0x54bbb9[_0x5bd9fc(0x11d)]((_0xcf574,_0x2cce86)=>{_0x4cd187[_0x2cce86]['secondary_unit']=_0xcf574;}),_0x3e02f8[_0x5bd9fc(0x11d)]((_0x134fe4,_0x2c1f66)=>{var _0x4239a5=_0x5bd9fc;_0x4cd187[_0x2c1f66][_0x4239a5(0xb4)]=_0x134fe4;}),_0x214843['forEach']((_0x23e25b,_0x590778)=>{var _0x1daed5=_0x5bd9fc;_0x4cd187[_0x590778][_0x1daed5(0x10d)]=_0x23e25b;}),_0xd2a2ba[_0x5bd9fc(0x11d)]((_0x2ffac2,_0x2c8503)=>{_0x4cd187[_0x2c8503]['expiry_date']=_0x2ffac2;});const _0x230600=await sales_finished[_0x5bd9fc(0x143)]({'invoice':_0x5a7e06});_0x230600[_0x5bd9fc(0x68)]=_0x5bd9fc(0x90);const _0x33558d=await _0x230600['save'](),_0x55312a=new sales_return_finished({'invoice':_0x5a7e06,'customer':_0x83d2be['body']['customer'],'date':_0x27bacb,'warehouse_name':_0x1c9d93,'room':_0x21c815,'ToWarehouse':_0x31cc75,'ToRoom':_0x1cb070,'return_sale_QA':_0x4cd187,'note':_0x4062d0,'warehouse_cat':_0x3a35cc}),_0x28963e=await _0x55312a[_0x5bd9fc(0xd5)](),_0x146912=await sales_return_finished[_0x5bd9fc(0x143)]({'invoice':_0x5a7e06}),_0xbbe9a0=await warehouse[_0x5bd9fc(0x143)]({'name':_0x31cc75,'room':_0x1cb070});_0x146912[_0x5bd9fc(0x125)]['forEach'](_0x5332a6=>{var _0x46941d=_0x5bd9fc,_0x3e7286=0x0;const _0x6e407a=_0xbbe9a0[_0x46941d(0x171)][_0x46941d(0xdd)](_0x44209f=>{var _0xdd78b0=_0x46941d;_0x44209f[_0xdd78b0(0x16e)]==_0x5332a6[_0xdd78b0(0x16e)]&&_0x44209f['expiry_date']==_0x5332a6[_0xdd78b0(0x7c)]&&_0x44209f['production_date']==_0x5332a6[_0xdd78b0(0x10d)]&&_0x44209f['batch_code']==_0x5332a6['batch_code']&&(_0x44209f['product_stock']=parseInt(_0x44209f[_0xdd78b0(0x179)])+parseInt(_0x5332a6[_0xdd78b0(0x8b)]),_0x3e7286++);});_0x3e7286=='0'&&(_0xbbe9a0[_0x46941d(0x171)]=_0xbbe9a0[_0x46941d(0x171)]['concat']({'product_name':_0x5332a6[_0x46941d(0x16e)],'product_stock':_0x5332a6[_0x46941d(0x8b)],'primary_code':_0x5332a6[_0x46941d(0xf5)],'secondary_code':_0x5332a6[_0x46941d(0x13d)],'product_code':_0x5332a6['product_code'],'batch_code':_0x5332a6['batch_code'],'maxPerUnit':_0x5332a6[_0x46941d(0xcb)],'production_date':_0x5332a6[_0x46941d(0x10d)],'expiry_date':_0x5332a6['expiry_date'],'secondary_unit':_0x5332a6[_0x46941d(0x100)],'unit':_0x5332a6[_0x46941d(0xb4)],'maxProducts':_0x5332a6[_0x46941d(0x87)],'bay':_0x5332a6[_0x46941d(0x11b)]}));}),await _0xbbe9a0['save']();const _0x9f1b55=new c_payment_data({'invoice':_0x5a7e06,'customer':_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0xa8)],'reason':'Sale\x20Return'});await _0x9f1b55[_0x5bd9fc(0xd5)]();const _0x8d7c7c=await master_shop[_0x5bd9fc(0x8c)](),_0x4e6d40=await email_settings['findOne'](),_0x57eb35=await customer[_0x5bd9fc(0x143)]({'name':_0x83d2be[_0x5bd9fc(0x7e)]['customer']});_0x8d7c7c[0x0]['currency_placement']==0x1?(right_currency=_0x8d7c7c[0x0][_0x5bd9fc(0x160)],left_currency=''):(right_currency='',left_currency=_0x8d7c7c[0x0][_0x5bd9fc(0x160)]);var _0x54799d=_0x2a41dd,_0x214554=_0x4f27c1,_0x1f6413='',_0x18b264;for(_0x18b264 in _0x54799d){_0x1f6413+='<tr>'+_0x5bd9fc(0x117)+_0x54799d[_0x18b264]+_0x5bd9fc(0x154)+_0x5bd9fc(0x117)+_0x214554[_0x18b264]+_0x5bd9fc(0x154)+_0x5bd9fc(0x13e);}console[_0x5bd9fc(0xfb)](_0x5bd9fc(0xf3),_0x1f6413);let _0x1db318=nodemailer[_0x5bd9fc(0x17d)]({'service':_0x5bd9fc(0xf2),'auth':{'user':_0x4e6d40[_0x5bd9fc(0x9f)],'pass':_0x4e6d40[_0x5bd9fc(0x14a)]}}),_0x1ae56b={'from':_0x4e6d40[_0x5bd9fc(0x9f)],'to':_0x57eb35['email'],'subject':_0x5bd9fc(0x10b),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5bd9fc(0xc8)+_0x5bd9fc(0x112)+_0x8d7c7c[0x0][_0x5bd9fc(0x122)],'cid':_0x5bd9fc(0xfa)}],'html':_0x5bd9fc(0x149)+_0x5bd9fc(0xd0)+'</head><body>'+_0x5bd9fc(0x15e)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x5bd9fc(0x15e)+_0x5bd9fc(0x85)+_0x5bd9fc(0x6c)+'<div>'+_0x5bd9fc(0xd9)+_0x8d7c7c[0x0]['site_title']+_0x5bd9fc(0x17c)+_0x5bd9fc(0x6c)+_0x5bd9fc(0x6c)+_0x5bd9fc(0x177)+'<div>'+_0x5bd9fc(0x16f)+_0x5bd9fc(0x67)+_0x5a7e06+'\x20'+_0x5bd9fc(0x66)+_0x5bd9fc(0x153)+_0x27bacb+'\x20'+_0x5bd9fc(0xba)+_0x5bd9fc(0x76)+_0x5bd9fc(0x6c)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5bd9fc(0xad)+_0x5bd9fc(0x15c)+_0x5bd9fc(0x72)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x5bd9fc(0xef)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x5bd9fc(0xf0)+_0x5bd9fc(0x17a)+'\x20'+_0x1f6413+'\x20'+_0x5bd9fc(0xb5)+_0x5bd9fc(0xa6)+'<div>'+_0x5bd9fc(0x15a)+_0x5bd9fc(0xf4)+_0x8d7c7c[0x0]['site_title']+_0x5bd9fc(0x76)+_0x5bd9fc(0x6c)+_0x5bd9fc(0x6c)+_0x5bd9fc(0x133)};_0x1db318[_0x5bd9fc(0x137)](_0x1ae56b,function(_0x982cb4,_0x337fcd){var _0x24f8ec=_0x5bd9fc;_0x982cb4?(console['log'](_0x982cb4),console[_0x24f8ec(0xfb)]('Error\x20Occurs')):console[_0x24f8ec(0xfb)](_0x24f8ec(0xb1));}),_0x83d2be[_0x5bd9fc(0x15d)](_0x5bd9fc(0x94),_0x5bd9fc(0xee)),_0x4f84a6['redirect'](_0x5bd9fc(0xfc));}catch(_0x2991db){_0x4f84a6[_0x5bd9fc(0x14b)](0xc8)['json']({'message1':_0x2991db['message']});}else{if(_0x83d2be[_0x5bd9fc(0x7e)]['for_categorize']=='GS')try{const {invoice:_0x12cd0e,date:_0x49fc61,warehouse_name:_0x1242d8,product_name:_0x3b8c5c,primary_code:_0x106af2,secondary_code:_0x56235c,product_code:_0x1caece,sales_quantity:_0x54169a,stocks:_0x71eeff,return_qty:_0xf76c3c,Room_name:_0x1f6e7e,to_warehouse_name:_0x4eacf7,to_Room_name:_0xe8f122,note:_0x241fce,level:_0x418470,isle:_0x16c4e0,pallet:_0x2b227b,for_categorize:_0x2d41ec}=_0x83d2be[_0x5bd9fc(0x7e)];if(typeof _0x3b8c5c==_0x5bd9fc(0x110))var _0x2a41dd=[_0x83d2be['body'][_0x5bd9fc(0x16e)]],_0x2d3d04=[_0x83d2be['body'][_0x5bd9fc(0xf5)]],_0x289fd8=[_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x13d)]],_0x2ec85c=[_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x109)]],_0x3ca3ac=[_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x161)]],_0x4f27c1=[_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x8b)]],_0x5c62be=[_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x11b)]],_0x1adefe=[_0x83d2be['body'][_0x5bd9fc(0xcb)]],_0x3d34a5=[_0x83d2be['body']['maxProducts']],_0x76df4e=[_0x83d2be[_0x5bd9fc(0x7e)]['batch_code']],_0x54bbb9=[_0x83d2be['body'][_0x5bd9fc(0x100)]],_0x3e02f8=[_0x83d2be[_0x5bd9fc(0x7e)]['unit']],_0x214843=[_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x10d)]],_0xd2a2ba=[_0x83d2be['body']['expiry_date']];else var _0x2a41dd=[..._0x83d2be['body'][_0x5bd9fc(0x16e)]],_0x2d3d04=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0xf5)]],_0x289fd8=[..._0x83d2be[_0x5bd9fc(0x7e)]['secondary_code']],_0x2ec85c=[..._0x83d2be['body']['product_code']],_0x3ca3ac=[..._0x83d2be[_0x5bd9fc(0x7e)]['sales_quantity']],_0x4f27c1=[..._0x83d2be[_0x5bd9fc(0x7e)]['return_qty']],_0x5c62be=[..._0x83d2be[_0x5bd9fc(0x7e)]['bay']],_0x1adefe=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0xcb)]],_0x3d34a5=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x87)]],_0x76df4e=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0xaf)]],_0x54bbb9=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x100)]],_0x3e02f8=[..._0x83d2be[_0x5bd9fc(0x7e)]['unit']],_0x214843=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x10d)]],_0xd2a2ba=[..._0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0x7c)]];const _0x1211bc=_0x2a41dd[_0x5bd9fc(0xdd)](_0x2ea7b5=>{return _0x2ea7b5={'product_name':_0x2ea7b5};});_0x2d3d04[_0x5bd9fc(0x11d)]((_0x58bbbf,_0x30c8ab)=>{var _0x4ac04f=_0x5bd9fc;_0x1211bc[_0x30c8ab][_0x4ac04f(0xf5)]=_0x58bbbf;}),_0x289fd8[_0x5bd9fc(0x11d)]((_0x2d1151,_0x4c3b78)=>{var _0x4186c8=_0x5bd9fc;_0x1211bc[_0x4c3b78][_0x4186c8(0x13d)]=_0x2d1151;}),_0x2ec85c['forEach']((_0x46687a,_0x46512e)=>{var _0x4355b9=_0x5bd9fc;_0x1211bc[_0x46512e][_0x4355b9(0x109)]=_0x46687a;}),_0x3ca3ac[_0x5bd9fc(0x11d)]((_0x122b40,_0x2265e6)=>{var _0x40b6e2=_0x5bd9fc;_0x1211bc[_0x2265e6][_0x40b6e2(0x113)]=_0x122b40;}),_0x4f27c1[_0x5bd9fc(0x11d)]((_0x41ba0e,_0x28c694)=>{var _0x26c058=_0x5bd9fc;_0x1211bc[_0x28c694][_0x26c058(0x8b)]=_0x41ba0e;}),_0x5c62be[_0x5bd9fc(0x11d)]((_0x1dc06e,_0x50c239)=>{var _0x3b6b79=_0x5bd9fc;_0x1211bc[_0x50c239][_0x3b6b79(0x11b)]=_0x1dc06e;}),_0x1adefe[_0x5bd9fc(0x11d)]((_0x55dfe8,_0x5c2099)=>{var _0x1035f3=_0x5bd9fc;_0x1211bc[_0x5c2099][_0x1035f3(0xcb)]=_0x55dfe8;}),_0x3d34a5[_0x5bd9fc(0x11d)]((_0x17e262,_0x12cd3d)=>{var _0x52e0ca=_0x5bd9fc;_0x1211bc[_0x12cd3d][_0x52e0ca(0x87)]=_0x17e262;}),_0x76df4e[_0x5bd9fc(0x11d)]((_0x5de411,_0x8c0421)=>{_0x1211bc[_0x8c0421]['batch_code']=_0x5de411;}),_0x54bbb9[_0x5bd9fc(0x11d)]((_0x4b7f17,_0x3d10a3)=>{var _0x1f3684=_0x5bd9fc;_0x1211bc[_0x3d10a3][_0x1f3684(0x100)]=_0x4b7f17;}),_0x3e02f8[_0x5bd9fc(0x11d)]((_0x524a8f,_0x3e534b)=>{var _0x153299=_0x5bd9fc;_0x1211bc[_0x3e534b][_0x153299(0xb4)]=_0x524a8f;}),_0x214843[_0x5bd9fc(0x11d)]((_0x6bbbf3,_0x4b5b62)=>{var _0x39d0c0=_0x5bd9fc;_0x1211bc[_0x4b5b62][_0x39d0c0(0x10d)]=_0x6bbbf3;}),_0xd2a2ba[_0x5bd9fc(0x11d)]((_0x570bec,_0x27c9e9)=>{var _0x3c7f24=_0x5bd9fc;_0x1211bc[_0x27c9e9][_0x3c7f24(0x7c)]=_0x570bec;});var _0x51b248=0x0;_0x1211bc['forEach'](_0x54589f=>{var _0x200d40=_0x5bd9fc;(parseInt(_0x54589f[_0x200d40(0x113)])<parseInt(_0x54589f[_0x200d40(0x8b)])||parseInt(_0x54589f[_0x200d40(0xd2)])<parseInt(_0x54589f['return_qty'])&&parseInt(_0x54589f[_0x200d40(0x113)])>parseInt(_0x54589f[_0x200d40(0x8b)])||parseInt(_0x54589f['return_qty'])==0x0)&&_0x51b248++;});if(_0x51b248!=0x0)return _0x83d2be[_0x5bd9fc(0x15d)](_0x5bd9fc(0xdc),_0x5bd9fc(0xa5)),_0x4f84a6[_0x5bd9fc(0x115)](_0x5bd9fc(0x71));const _0x33a549=await sales_finished[_0x5bd9fc(0x143)]({'invoice':_0x12cd0e});_0x33a549['return_data']=_0x5bd9fc(0x90);const _0x575e76=await _0x33a549[_0x5bd9fc(0xd5)](),_0x125f0f=new sales_return_finished({'invoice':_0x12cd0e,'customer':_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0xa8)],'date':_0x49fc61,'warehouse_name':_0x1242d8,'room':_0x1f6e7e,'ToWarehouse':_0x4eacf7,'ToRoom':_0xe8f122,'return_sale':_0x1211bc,'note':_0x241fce,'warehouse_cat':_0x2d41ec}),_0x5496eb=await _0x125f0f[_0x5bd9fc(0xd5)](),_0x375557=await sales_return_finished['findOne']({'invoice':_0x12cd0e}),_0x56df99=await warehouse[_0x5bd9fc(0x143)]({'name':_0x4eacf7,'room':_0xe8f122,'warehouse_category':'Finished\x20Goods'});_0x375557[_0x5bd9fc(0x147)][_0x5bd9fc(0x11d)](_0x13c6b1=>{var _0x56d4c9=_0x5bd9fc,_0xdf3645=0x0;const _0x406e4a=_0x56df99['product_details'][_0x56d4c9(0xdd)](_0x108e8d=>{var _0x1fa890=_0x56d4c9;_0x108e8d[_0x1fa890(0x16e)]==_0x13c6b1[_0x1fa890(0x16e)]&&_0x108e8d[_0x1fa890(0x11b)]==_0x13c6b1[_0x1fa890(0x11b)]&&_0x108e8d[_0x1fa890(0x7c)]==_0x13c6b1[_0x1fa890(0x7c)]&&_0x108e8d[_0x1fa890(0x10d)]==_0x13c6b1['production_date']&&_0x108e8d['batch_code']==_0x13c6b1[_0x1fa890(0xaf)]&&(_0x108e8d[_0x1fa890(0x179)]=parseInt(_0x108e8d[_0x1fa890(0x179)])+parseInt(_0x13c6b1[_0x1fa890(0x8b)]),_0xdf3645++);});_0xdf3645=='0'&&(_0x56df99['product_details']=_0x56df99['product_details'][_0x56d4c9(0x16b)]({'product_name':_0x13c6b1[_0x56d4c9(0x16e)],'product_stock':_0x13c6b1[_0x56d4c9(0x8b)],'primary_code':_0x13c6b1[_0x56d4c9(0xf5)],'secondary_code':_0x13c6b1['secondary_code'],'product_code':_0x13c6b1['product_code'],'bay':_0x13c6b1[_0x56d4c9(0x11b)],'batch_code':_0x13c6b1[_0x56d4c9(0xaf)],'maxPerUnit':_0x13c6b1[_0x56d4c9(0xcb)],'production_date':_0x13c6b1[_0x56d4c9(0x10d)],'expiry_date':_0x13c6b1['expiry_date'],'secondary_unit':_0x13c6b1[_0x56d4c9(0x100)],'unit':_0x13c6b1['unit'],'maxProducts':_0x13c6b1[_0x56d4c9(0x87)]}));}),await _0x56df99[_0x5bd9fc(0xd5)](),console[_0x5bd9fc(0xfb)](_0x83d2be['body']);const _0x777b20=new c_payment_data({'invoice':_0x12cd0e,'customer':_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0xa8)],'reason':_0x5bd9fc(0x12e)});await _0x777b20['save']();const _0x44be88=await master_shop[_0x5bd9fc(0x8c)]();console[_0x5bd9fc(0xfb)](_0x5bd9fc(0x92),_0x44be88[0x0][_0x5bd9fc(0x122)]);const _0x10a1e1=await email_settings[_0x5bd9fc(0x143)](),_0x2ae3fc=await customer[_0x5bd9fc(0x143)]({'name':_0x83d2be[_0x5bd9fc(0x7e)][_0x5bd9fc(0xa8)]});console[_0x5bd9fc(0xfb)]('customer_data',_0x2ae3fc);_0x44be88[0x0][_0x5bd9fc(0xa3)]==0x1?(right_currency=_0x44be88[0x0][_0x5bd9fc(0x160)],left_currency=''):(right_currency='',left_currency=_0x44be88[0x0][_0x5bd9fc(0x160)]);var _0x54799d=_0x2a41dd,_0x214554=_0x4f27c1,_0x1f6413='',_0x18b264;for(_0x18b264 in _0x54799d){_0x1f6413+=_0x5bd9fc(0x15c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x54799d[_0x18b264]+'</td>'+_0x5bd9fc(0x117)+_0x214554[_0x18b264]+'</td>'+_0x5bd9fc(0x13e);}console[_0x5bd9fc(0xfb)](_0x5bd9fc(0xf3),_0x1f6413);let _0x11ea17=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x10a1e1['email'],'pass':_0x10a1e1['password']}}),_0x4ed4e6={'from':_0x10a1e1['email'],'to':_0x2ae3fc[_0x5bd9fc(0x9f)],'subject':_0x5bd9fc(0x10b),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5bd9fc(0xc8)+_0x5bd9fc(0x112)+_0x44be88[0x0][_0x5bd9fc(0x122)],'cid':'logo'}],'html':_0x5bd9fc(0x149)+_0x5bd9fc(0xd0)+_0x5bd9fc(0xd3)+'<div>'+_0x5bd9fc(0xfd)+_0x5bd9fc(0x15e)+_0x5bd9fc(0x85)+_0x5bd9fc(0x6c)+_0x5bd9fc(0x15e)+_0x5bd9fc(0xd9)+_0x44be88[0x0][_0x5bd9fc(0x123)]+_0x5bd9fc(0x17c)+_0x5bd9fc(0x6c)+_0x5bd9fc(0x6c)+_0x5bd9fc(0x177)+'<div>'+_0x5bd9fc(0x16f)+'\x20Order\x20Number\x20:\x20'+_0x12cd0e+'\x20'+_0x5bd9fc(0x66)+'\x20Order\x20Date\x20:\x20'+_0x49fc61+'\x20'+_0x5bd9fc(0xba)+_0x5bd9fc(0x76)+_0x5bd9fc(0x6c)+_0x5bd9fc(0x78)+_0x5bd9fc(0xad)+_0x5bd9fc(0x15c)+_0x5bd9fc(0x72)+_0x5bd9fc(0xde)+_0x5bd9fc(0xef)+_0x5bd9fc(0xb6)+_0x5bd9fc(0x13e)+_0x5bd9fc(0xf0)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1f6413+'\x20'+'</tbody>'+_0x5bd9fc(0xa6)+_0x5bd9fc(0x15e)+'<strong>\x20Regards\x20</strong>'+_0x5bd9fc(0xf4)+_0x44be88[0x0][_0x5bd9fc(0x123)]+_0x5bd9fc(0x76)+_0x5bd9fc(0x6c)+_0x5bd9fc(0x6c)+_0x5bd9fc(0x133)};_0x11ea17['sendMail'](_0x4ed4e6,function(_0x520215,_0x36bb58){var _0x3e2821=_0x5bd9fc;_0x520215?(console['log'](_0x520215),console[_0x3e2821(0xfb)](_0x3e2821(0x108))):console['log'](_0x3e2821(0xb1));}),_0x83d2be[_0x5bd9fc(0x15d)](_0x5bd9fc(0x94),'sales\x20item\x20return\x20successfull'),_0x4f84a6[_0x5bd9fc(0x115)](_0x5bd9fc(0xfc));}catch(_0x316647){console[_0x5bd9fc(0xfb)](_0x316647),_0x4f84a6[_0x5bd9fc(0x14b)](0xc8)[_0x5bd9fc(0x173)]({'message1':_0x316647[_0x5bd9fc(0x12b)]});}}}),router[a0_0xd8bb59(0x158)]('/barcode/:id',auth,async(_0x39b614,_0x4b3f75)=>{var _0x46eb8d=a0_0xd8bb59;try{const {username:_0x5e5d97,email:_0x418542,role:_0x1d20ad}=_0x39b614[_0x46eb8d(0xcd)],_0x3b5a94=_0x39b614[_0x46eb8d(0xcd)],_0x58a769=await profile[_0x46eb8d(0x143)]({'email':_0x3b5a94[_0x46eb8d(0x9f)]}),_0x4fcfcf=await master_shop[_0x46eb8d(0x8c)]();console[_0x46eb8d(0xfb)](_0x46eb8d(0x103),_0x4fcfcf);const _0x1cbbb8=_0x39b614[_0x46eb8d(0x13c)]['id'],_0x32ec87=await sales[_0x46eb8d(0xed)](_0x1cbbb8);console['log'](_0x46eb8d(0x111),_0x32ec87);if(_0x4fcfcf[0x0][_0x46eb8d(0x178)]=='English\x20(US)')var _0x2c888f=users[_0x46eb8d(0x14d)];else{if(_0x4fcfcf[0x0][_0x46eb8d(0x178)]==_0x46eb8d(0xff))var _0x2c888f=users[_0x46eb8d(0xff)];else{if(_0x4fcfcf[0x0][_0x46eb8d(0x178)]==_0x46eb8d(0xac))var _0x2c888f=users['German'];else{if(_0x4fcfcf[0x0][_0x46eb8d(0x178)]==_0x46eb8d(0xdb))var _0x2c888f=users[_0x46eb8d(0xdb)];else{if(_0x4fcfcf[0x0][_0x46eb8d(0x178)]==_0x46eb8d(0x134))var _0x2c888f=users[_0x46eb8d(0x134)];else{if(_0x4fcfcf[0x0][_0x46eb8d(0x178)]==_0x46eb8d(0x162))var _0x2c888f=users[_0x46eb8d(0x138)];else{if(_0x4fcfcf[0x0][_0x46eb8d(0x178)]==_0x46eb8d(0xe7))var _0x2c888f=users[_0x46eb8d(0xe7)];else{if(_0x4fcfcf[0x0][_0x46eb8d(0x178)]==_0x46eb8d(0x16c))var _0x2c888f=users['Arabic'];}}}}}}}_0x4b3f75[_0x46eb8d(0x17e)](_0x46eb8d(0x15b),{'success':_0x39b614[_0x46eb8d(0x15d)]('success'),'errors':_0x39b614[_0x46eb8d(0x15d)]('errors'),'role':_0x3b5a94,'profile':_0x58a769,'alldata':_0x32ec87,'master_shop':_0x4fcfcf,'language':_0x2c888f});}catch(_0x1c57ad){console[_0x46eb8d(0xfb)](_0x1c57ad);}}),router['post'](a0_0xd8bb59(0x148),async(_0x430fcd,_0x230f51)=>{var _0x5ab6f5=a0_0xd8bb59;const {product_code:_0x62633d,warehouse_name:_0xebf73f,rooms_data:_0x35e9e6,Roomslist:_0x49ea8a}=_0x430fcd['body'],_0x4445f6=_0x49ea8a[_0x5ab6f5(0xcc)](','),_0x38815a=[];async function _0x59557a(_0x477679){var _0x2bd013=_0x5ab6f5;const _0x4e2cc9=await warehouse[_0x2bd013(0xa7)]([{'$match':{'name':_0xebf73f,'room':_0x477679}},{'$unwind':_0x2bd013(0xc4)},{'$match':{'product_details.primary_code':_0x62633d}},{'$group':{'_id':_0x2bd013(0x13f),'name':{'$first':_0x2bd013(0xf8)},'product_stock':{'$first':_0x2bd013(0xdf)},'primary_code':{'$first':_0x2bd013(0x16a)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2bd013(0xbe)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2bd013(0x98)},'type':{'$first':_0x2bd013(0xbc)},'pallet':{'$first':_0x2bd013(0xc5)},'unit':{'$first':_0x2bd013(0x12f)},'secondary_unit':{'$first':_0x2bd013(0xe3)},'storage':{'$first':_0x2bd013(0x107)},'rack':{'$first':_0x2bd013(0x93)},'expiry_date':{'$first':_0x2bd013(0xb8)},'production_date':{'$first':_0x2bd013(0x8a)},'maxPerUnit':{'$first':_0x2bd013(0x97)},'batch_code':{'$first':_0x2bd013(0xb7)},'product_cat':{'$first':_0x2bd013(0x9d)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2bd013(0x8f)},'invoice':{'$first':_0x2bd013(0xf7)}}}]),_0x4bf600=await warehouse[_0x2bd013(0xa7)]([{'$match':{'name':_0xebf73f,'room':_0x477679}},{'$unwind':_0x2bd013(0xc4)},{'$match':{'product_details.secondary_code':_0x62633d}},{'$group':{'_id':_0x2bd013(0x13f),'name':{'$first':_0x2bd013(0xf8)},'product_stock':{'$first':_0x2bd013(0xdf)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2bd013(0x88)},'product_code':{'$first':_0x2bd013(0xbe)},'level':{'$first':_0x2bd013(0x174)},'isle':{'$first':_0x2bd013(0x98)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2bd013(0xc5)},'unit':{'$first':_0x2bd013(0x12f)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2bd013(0x107)},'rack':{'$first':_0x2bd013(0x93)},'expiry_date':{'$first':_0x2bd013(0xb8)},'production_date':{'$first':_0x2bd013(0x8a)},'maxPerUnit':{'$first':_0x2bd013(0x97)},'batch_code':{'$first':_0x2bd013(0xb7)},'product_cat':{'$first':_0x2bd013(0x9d)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2bd013(0x8f)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x4e2cc9[_0x2bd013(0x102)]>0x0)_0x38815a[_0x2bd013(0x121)](_0x4e2cc9);else _0x4bf600[_0x2bd013(0x102)]>0x0&&_0x38815a[_0x2bd013(0x121)](_0x4bf600);}const _0x19385c=_0x4445f6[_0x5ab6f5(0xdd)](_0x39433c=>_0x59557a(_0x39433c));await Promise[_0x5ab6f5(0x8e)](_0x19385c),_0x230f51[_0x5ab6f5(0x173)](_0x38815a);}),module[a0_0xd8bb59(0x130)]=router;