var a0_0x3827f5=a0_0x4d1e;function a0_0x2c41(){var _0x28bde2=['</tbody>','Hindi','floor','$sale_product.type','<div>','False','warehouse','batch_code','abs','4467110NvyNPX','name','$product_details.product_cat','$product_details.maxProducts','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','sale_qty','max_per_unit','prod_cat','\x20<<<==>>>\x20','all','/barcode/:id','getDate','return_sale','/give_payment/:id','stock_data','French','$product_details.expiry_date','bay','5adVfRb','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','QA\x20Warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.batch_code','An\x20error\x20occurred.','note','unit','$product_details.product_stock','</tr>','all_sales_barcode','save','slice','Router','\x20&&\x20','Sales\x20Update\x20successfully','14byWvlv','for_categorize','$return_data','765200DFkeCo','status','product_code','date','length','currency','<html><head><title></title>','/upload/','find','German','\x20==\x20','product_data','warehouse_name','English\x20(US)','room','nodemailer','Sale','carton','\x20</h2>','then','finalize','$date','</head><body>','Sale\x20Return','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.product_code','render','<span\x20style=\x22float:\x20right;\x22>','$product_details.room_name','sale_product','id_transaction_from','foreach\x20newproduct','$name','room_name','Sales\x20Mail','adjust_qty','</div>','role','Sales\x20Add\x20successfully','filter','master','staff','Logo.png','$product_details._id','payment\x20successfull','$product_details','maxPerUnit','ADD\x20SALE','Portuguese\x20(BR)','prod_code','Ambient','$sale_product','currency_placement','../public/language/languages.json','/all_sales_finished/preview/','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/view/add_sales','$product_details.rack','Sale\x20Return\x20Mail','body','product_date','Quality\x20Inspection','due_amount','primary_code','sales_quantity_QA','port','error','secondary_unit_QA','random','310533tIANrx','secondary_code','language','/all_sales/view','product_code_QA','$product_details.unit','production_date','/invoice/:id','<h5\x20style=\x22text-align:\x20left;\x22>','Arabic','gmail','host','return_sale_finished','Enabled','user','<h2>\x20','product_details','toString','production_date_QA','createTransport','$finalize','$warehouse_name','390312EALqhq','getFullYear','$product','image','$product_details.invoice','quantity','suppliers','maxProducts','purchases_data','$product_details.product_name','params','$sale_product.floorlevel','/../public','received_amount','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Received\x20Payment\x20For\x20Sale','/view','/view/:id','$product_details.production_date','$customers_docs','Error\x20Occurs','</table>','add_sales_finished','return_data','<!DOCTYPE\x20html>','</h5>','customer','sendMail','259nmPuDz','amount','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Enclosed','$customer','secondary_unit','max','../middleware/auth','423cnPQio','_id','return_qty_QA','push','$product_details.secondary_code','<tr>','English','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Arabic\x20(ae)','level','customers_docs','$sale_product.quantity','</td>','RoomAssigned','logo','True','map','</body></html>','<strong>\x20Regards\x20</strong>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Return\x20Goods','maxperunit','<h5>','edit_sales_finished_view','password','\x20Order\x20Number\x20:\x20','135992tkKXVE','\x20Order\x20Date\x20:\x20','concat','product_name_QA1','FGSEmail','maxProducts_QA','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','/all_sales_finished/view','forEach','flash','site_title','$product_details.type','stock','post','/view/add_sale/product','$product_details.maxPerUnit','OUTF-','invoice','findById','product_stock','Finished\x20Goods','add\x20post','express','$product_details.secondary_unit','$product_details.bin','unit_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','split','</span>','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','../models/all_models','return_qty','product_name','message','expiry_date_QA','barcode\x20Product\x20master','back','log','An\x20error\x20occurred\x20while\x20saving\x20data.','errors','$sale_product.bin','maxPerUnit_QA','</thead>','aggregate','\x20<>\x20','get','return_sale_QA','sales\x20item\x20return\x20successfull','stocks_QA','expiry_date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$_id','success','redirect','catch','/preview/:id','$product_details.bay','$product_details.primary_code','22pTKxmP','batch_code_QA','103926OzhWOg','customers','primary_unit','Portuguese','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','969212atTqwT','$product_details.floorlevel','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','exports','product_list','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<hr\x20class=\x22my-3\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','primary_code_QA','Spanish','string','$invoice','json','padStart','$sale_product.bay','Chinese','email','prod_invoice'];a0_0x2c41=function(){return _0x28bde2;};return a0_0x2c41();}(function(_0x24b715,_0x3167d2){var _0x5aa291=a0_0x4d1e,_0x18d344=_0x24b715();while(!![]){try{var _0x203f46=parseInt(_0x5aa291(0x1bb))/0x1+parseInt(_0x5aa291(0x1b8))/0x2*(-parseInt(_0x5aa291(0xe2))/0x3)+-parseInt(_0x5aa291(0x17a))/0x4*(parseInt(_0x5aa291(0x1a8))/0x5)+parseInt(_0x5aa291(0x175))/0x6*(parseInt(_0x5aa291(0x115))/0x7)+parseInt(_0x5aa291(0x138))/0x8*(-parseInt(_0x5aa291(0x11d))/0x9)+parseInt(_0x5aa291(0x196))/0xa*(parseInt(_0x5aa291(0x173))/0xb)+-parseInt(_0x5aa291(0xf8))/0xc;if(_0x203f46===_0x3167d2)break;else _0x18d344['push'](_0x18d344['shift']());}catch(_0x38fde4){_0x18d344['push'](_0x18d344['shift']());}}}(a0_0x2c41,0x7a594));function a0_0x4d1e(_0x2116d3,_0x35d6ef){var _0x2c4149=a0_0x2c41();return a0_0x4d1e=function(_0x4d1ee5,_0x313881){_0x4d1ee5=_0x4d1ee5-0xbe;var _0x11077a=_0x2c4149[_0x4d1ee5];return _0x11077a;},a0_0x4d1e(_0x2116d3,_0x35d6ef);}const express=require(a0_0x3827f5(0x14f)),app=express(),router=express[a0_0x3827f5(0x1b5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x3827f5(0x157)),auth=require(a0_0x3827f5(0x11c)),nodemailer=require(a0_0x3827f5(0x1ca)),users=require(a0_0x3827f5(0xd1));router[a0_0x3827f5(0x166)](a0_0x3827f5(0x109),auth,async(_0x955894,_0x2b3736)=>{var _0x19d334=a0_0x3827f5;try{const {username:_0x18431d,email:_0x314c27,role:_0x4cf8b7}=_0x955894[_0x19d334(0xf0)],_0x363417=_0x955894[_0x19d334(0xf0)],_0x347776=await profile[_0x19d334(0x124)]({'email':_0x363417[_0x19d334(0x18b)]}),_0x25218a=await master_shop['find']();let _0xcec3df;if(_0x363417[_0x19d334(0xc1)]==_0x19d334(0xc5)){const _0x1da566=await staff[_0x19d334(0x124)]({'email':_0x363417[_0x19d334(0x18b)]});_0xcec3df=await sales_finished[_0x19d334(0x164)]([{'$lookup':{'from':'customers','localField':_0x19d334(0x113),'foreignField':_0x19d334(0x197),'as':_0x19d334(0x128)}},{'$unwind':_0x19d334(0x10c)},{'$unwind':_0x19d334(0xcf)},{'$group':{'_id':_0x19d334(0x16c),'invoice':{'$first':_0x19d334(0x186)},'customers':{'$first':_0x19d334(0x119)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x19d334(0xcf)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x19d334(0x10c)},'total_saleproduct_quantity':{'$sum':_0x19d334(0x129)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x19d334(0x190)},'pallet':{'$addToSet':_0x19d334(0x103)},'finalize':{'$first':_0x19d334(0xf6)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0xcec3df=await sales_finished[_0x19d334(0x164)]([{'$lookup':{'from':_0x19d334(0x176),'localField':_0x19d334(0x113),'foreignField':_0x19d334(0x197),'as':_0x19d334(0x128)}},{'$unwind':'$customers_docs'},{'$unwind':_0x19d334(0xcf)},{'$group':{'_id':_0x19d334(0x16c),'invoice':{'$first':_0x19d334(0x186)},'customers':{'$first':_0x19d334(0x119)},'date':{'$first':_0x19d334(0x1d0)},'warehouse_name':{'$first':_0x19d334(0xf7)},'sale_product':{'$push':_0x19d334(0xcf)},'note':{'$first':'$note'},'return_data':{'$first':_0x19d334(0x1ba)},'customers_docs':{'$first':_0x19d334(0x10c)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x19d334(0x189)},'isle':{'$addToSet':_0x19d334(0x161)},'type':{'$addToSet':_0x19d334(0x190)},'pallet':{'$addToSet':_0x19d334(0x103)},'finalize':{'$first':_0x19d334(0xf6)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x25218a[0x0]['language']==_0x19d334(0x1c8)){var _0x21f6a4=users[_0x19d334(0x123)];console[_0x19d334(0x15e)](_0x21f6a4);}else{if(_0x25218a[0x0][_0x19d334(0xe4)]=='Hindi')var _0x21f6a4=users[_0x19d334(0x18e)];else{if(_0x25218a[0x0][_0x19d334(0xe4)]==_0x19d334(0x1c4))var _0x21f6a4=users[_0x19d334(0x1c4)];else{if(_0x25218a[0x0][_0x19d334(0xe4)]=='Spanish')var _0x21f6a4=users['Spanish'];else{if(_0x25218a[0x0][_0x19d334(0xe4)]=='French')var _0x21f6a4=users[_0x19d334(0x1a5)];else{if(_0x25218a[0x0]['language']==_0x19d334(0xcc))var _0x21f6a4=users[_0x19d334(0x178)];else{if(_0x25218a[0x0]['language']==_0x19d334(0x18a))var _0x21f6a4=users['Chinese'];else{if(_0x25218a[0x0][_0x19d334(0xe4)]==_0x19d334(0x126))var _0x21f6a4=users[_0x19d334(0xeb)];}}}}}}}_0x2b3736[_0x19d334(0x1d5)]('all_sales_finished',{'success':_0x955894[_0x19d334(0x142)]('success'),'errors':_0x955894[_0x19d334(0x142)](_0x19d334(0x160)),'sales':_0xcec3df,'profile':_0x347776,'role':_0x363417,'master_shop':_0x25218a,'language':_0x21f6a4});}catch(_0x43b573){console['log'](_0x43b573);}});async function getRandom8DigitNumber(){var _0x1674aa=a0_0x3827f5;const _0x1e96a2=0x989680,_0x4ef90f=0x5f5e0ff,_0x376104=Math[_0x1674aa(0x18f)](Math[_0x1674aa(0xe1)]()*(_0x4ef90f-_0x1e96a2+0x1))+_0x1e96a2;var _0xb5e376;const _0x21e1af=await sales_finished[_0x1674aa(0x124)]({'invoice':_0x1674aa(0x149)+_0x376104});return _0x21e1af&&_0x21e1af['length']>0x0?_0xb5e376=_0x1674aa(0x149)+_0x376104:_0xb5e376='OUTF-'+_0x376104,_0xb5e376;}router['get']('/view/add_sales',auth,async(_0x594ab2,_0x3a5df4)=>{var _0x33e2dd=a0_0x3827f5;try{const {username:_0x16f451,email:_0x140a0e,role:_0x249c44}=_0x594ab2[_0x33e2dd(0xf0)],_0x56d645=_0x594ab2[_0x33e2dd(0xf0)],_0x3c569e=await profile[_0x33e2dd(0x124)]({'email':_0x56d645['email']}),_0x5ad0e6=await master_shop[_0x33e2dd(0x1c3)](),_0x154fed=await customer['find']({});let _0x12a205;if(_0x56d645['role']==_0x33e2dd(0xc5)){const _0x58c420=await staff[_0x33e2dd(0x124)]({'email':_0x56d645[_0x33e2dd(0x18b)]});_0x12a205=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x58c420[_0x33e2dd(0x193)],'warehouse_category':_0x33e2dd(0x14d),'name':{'$ne':_0x33e2dd(0x1aa)}}},{'$group':{'_id':'$name','name':{'$first':_0x33e2dd(0x1db)}}},{'$sort':{'name':0x1}}]);}else _0x12a205=await warehouse[_0x33e2dd(0x164)]([{'$match':{'status':_0x33e2dd(0xef),'warehouse_category':_0x33e2dd(0x14d),'name':{'$ne':_0x33e2dd(0x1aa)}}},{'$group':{'_id':_0x33e2dd(0x1db),'name':{'$first':_0x33e2dd(0x1db)}}},{'$sort':{'name':0x1}}]);const _0x1e8ea3=await product[_0x33e2dd(0x1c3)]({});var _0x4b882b=[_0x33e2dd(0xce),_0x33e2dd(0x118)];const _0x282e8d=await sales_finished[_0x33e2dd(0x1c3)]({}),_0x4c76cc=_0x282e8d[_0x33e2dd(0x1bf)]+0x1,_0x5622b3=_0x33e2dd(0x149)+_0x4c76cc[_0x33e2dd(0xf3)]()[_0x33e2dd(0x188)](0x5,'0');if(_0x5ad0e6[0x0][_0x33e2dd(0xe4)]==_0x33e2dd(0x1c8)){var _0xa5e2a0=users[_0x33e2dd(0x123)];console[_0x33e2dd(0x15e)](_0xa5e2a0);}else{if(_0x5ad0e6[0x0][_0x33e2dd(0xe4)]=='Hindi')var _0xa5e2a0=users[_0x33e2dd(0x18e)];else{if(_0x5ad0e6[0x0][_0x33e2dd(0xe4)]=='German')var _0xa5e2a0=users[_0x33e2dd(0x1c4)];else{if(_0x5ad0e6[0x0]['language']==_0x33e2dd(0x184))var _0xa5e2a0=users['Spanish'];else{if(_0x5ad0e6[0x0][_0x33e2dd(0xe4)]==_0x33e2dd(0x1a5))var _0xa5e2a0=users['French'];else{if(_0x5ad0e6[0x0]['language']==_0x33e2dd(0xcc))var _0xa5e2a0=users['Portuguese'];else{if(_0x5ad0e6[0x0]['language']==_0x33e2dd(0x18a))var _0xa5e2a0=users['Chinese'];else{if(_0x5ad0e6[0x0][_0x33e2dd(0xe4)]==_0x33e2dd(0x126))var _0xa5e2a0=users[_0x33e2dd(0xeb)];}}}}}}}const _0x144eb7=getRandom8DigitNumber();_0x144eb7['then'](_0x505cff=>{var _0x171d62=_0x33e2dd;_0x3a5df4['render'](_0x171d62(0x10f),{'success':_0x594ab2[_0x171d62(0x142)](_0x171d62(0x16d)),'errors':_0x594ab2['flash'](_0x171d62(0x160)),'role':_0x56d645,'profile':_0x3c569e,'customer':_0x154fed,'warehouse':_0x12a205,'product':_0x1e8ea3,'invoice':_0x505cff,'master_shop':_0x5ad0e6,'language':_0xa5e2a0,'rooms_data':_0x4b882b});})[_0x33e2dd(0x16f)](_0x5c0f24=>{var _0xa6e79a=_0x33e2dd;_0x594ab2[_0xa6e79a(0x142)](_0xa6e79a(0x160),_0xa6e79a(0x16b)),_0x3a5df4[_0xa6e79a(0x16e)]('/all_sales_finished/view');});}catch(_0x8f319a){console[_0x33e2dd(0x15e)](_0x8f319a);}}),router[a0_0x3827f5(0x166)]('/view/add_sales/:id',auth,async(_0x4757a0,_0x26e039)=>{var _0x3ee8cf=a0_0x3827f5;try{const _0x36856f=_0x4757a0[_0x3ee8cf(0x102)]['id'];console[_0x3ee8cf(0x15e)](_0x36856f);const _0x1e1a37=await product[_0x3ee8cf(0x1c3)](),_0x48be3e=await purchases[_0x3ee8cf(0x164)]([{'$match':{'warehouse_name':_0x36856f}},{'$unwind':_0x3ee8cf(0xfa)},{'$group':{'_id':'$product.product_name'}}]);console[_0x3ee8cf(0x15e)](_0x3ee8cf(0x100),_0x48be3e),_0x26e039[_0x3ee8cf(0x1bc)](0xc8)[_0x3ee8cf(0x187)]({'purchases_data':_0x48be3e,'product_data':_0x1e1a37});}catch(_0x40b608){console[_0x3ee8cf(0x15e)](_0x40b608);}}),router['post'](a0_0x3827f5(0x147),auth,async(_0x535348,_0x3fb04b)=>{var _0x2379d5=a0_0x3827f5;try{const {warehouse_data:_0x55e8c0,product_data:_0xc5f880}=_0x535348[_0x2379d5(0xd8)];console['log'](_0x535348[_0x2379d5(0xd8)][_0x2379d5(0x1c6)]);;const _0x2c26fc=await master_shop[_0x2379d5(0x1c3)]();console[_0x2379d5(0x15e)]('master',_0x2c26fc);const _0x35383f=await product[_0x2379d5(0x124)]({'name':_0xc5f880});console[_0x2379d5(0x15e)]('product',_0x35383f);const _0x4753e9=await warehouse[_0x2379d5(0x164)]([{'$match':{'name':_0x55e8c0}},{'$unwind':_0x2379d5(0xc9)},{'$match':{'product_details.product_name':_0xc5f880}},{'$group':{'_id':_0x2379d5(0x101),'product_stock':{'$first':_0x2379d5(0x1b0)}}}]);console[_0x2379d5(0x15e)](_0x2379d5(0x1a4),_0x4753e9),_0x3fb04b[_0x2379d5(0x1bc)](0xc8)[_0x2379d5(0x187)]({'master':_0x2c26fc,'new_product':_0x35383f,'stock_data':_0x4753e9});}catch(_0x599452){console['log'](_0x599452);}}),router['post'](a0_0x3827f5(0xd5),auth,async(_0x3e1403,_0x22b7c1)=>{var _0x1a49f4=a0_0x3827f5;try{const {invoice:_0x3262fb,date:_0x2c38ab,warehouse_name:_0x4a0ebd,product_name:_0x4b3d3f,stock:_0x498404,quantity:_0x5577bf,note:_0x36e4da,room:_0x57d4f7,primary_code:_0x267fb9,secondary_code:_0x423b76,prod_code:_0x15c235,level:_0x4fa1b0,isle:_0x279c4f,pallet:_0x44dc97,batch_code:_0x59c7f7,SCRN:_0x1a0f54,expiry_date:_0x2cad95,mode_transpo:_0x2f3508,name_driver:_0x1d1e4b}=_0x3e1403[_0x1a49f4(0xd8)];if(typeof _0x4b3d3f==_0x1a49f4(0x185))var _0x1a48fe=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x159)]],_0x3e1b75=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x145)]],_0x32d43a=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x1cc)]],_0x103232=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0xdc)]],_0x3de7f3=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0xe3)]],_0x44892d=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0xcd)]],_0x5c5641=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x127)]],_0x3c0d5c=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x177)]],_0x267e1c=[_0x3e1403[_0x1a49f4(0xd8)]['secondary_unit']],_0x25b750=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x194)]],_0x5ac4e8=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x16a)]],_0x5b07f2=[_0x3e1403['body'][_0x1a49f4(0xd9)]],_0x34069c=[_0x3e1403[_0x1a49f4(0xd8)]['max_per_unit']],_0x4ebfc8=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x19d)]],_0x31503d=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x12b)]],_0x3a9639=[_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x18c)]],_0x59bfbc=[_0x3e1403[_0x1a49f4(0xd8)]['id_transaction_from']];else var _0x1a48fe=[..._0x3e1403['body'][_0x1a49f4(0x159)]],_0x3e1b75=[..._0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x145)]],_0x32d43a=[..._0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x1cc)]],_0x103232=[..._0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0xdc)]],_0x3de7f3=[..._0x3e1403['body'][_0x1a49f4(0xe3)]],_0x44892d=[..._0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0xcd)]],_0x5c5641=[..._0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x127)]],_0x3c0d5c=[..._0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x177)]],_0x267e1c=[..._0x3e1403[_0x1a49f4(0xd8)]['secondary_unit']],_0x25b750=[..._0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x194)]],_0x5ac4e8=[..._0x3e1403['body'][_0x1a49f4(0x16a)]],_0x5b07f2=[..._0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0xd9)]],_0x34069c=[..._0x3e1403['body'][_0x1a49f4(0x19c)]],_0x4ebfc8=[..._0x3e1403[_0x1a49f4(0xd8)]['prod_cat']],_0x31503d=[..._0x3e1403[_0x1a49f4(0xd8)]['RoomAssigned']],_0x3a9639=[..._0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x18c)]],_0x59bfbc=[..._0x3e1403['body']['id_transaction_from']];const _0x5987d3=_0x1a48fe['map'](_0x171661=>{return _0x171661={'product_name':_0x171661};});_0x3e1b75[_0x1a49f4(0x141)]((_0x3ca7ae,_0x1e5309)=>{_0x5987d3[_0x1e5309]['stock']=_0x3ca7ae;}),_0x32d43a[_0x1a49f4(0x141)]((_0x31d16e,_0x4316ca)=>{var _0x9bec1b=_0x1a49f4;_0x5987d3[_0x4316ca]['quantity']=Math[_0x9bec1b(0x195)](_0x31d16e);}),_0x59bfbc['forEach']((_0x4f0351,_0x3bb8c7)=>{_0x5987d3[_0x3bb8c7]['id_transaction_from']=_0x4f0351;}),_0x103232[_0x1a49f4(0x141)]((_0x1f1997,_0x7f03c4)=>{var _0x5075fc=_0x1a49f4;_0x5987d3[_0x7f03c4][_0x5075fc(0xdc)]=_0x1f1997;}),_0x3de7f3[_0x1a49f4(0x141)]((_0x34b631,_0x1ebdf9)=>{_0x5987d3[_0x1ebdf9]['secondary_code']=_0x34b631;}),_0x44892d[_0x1a49f4(0x141)]((_0x1d7dde,_0x5f46b5)=>{var _0xf724f2=_0x1a49f4;_0x5987d3[_0x5f46b5][_0xf724f2(0x1bd)]=_0x1d7dde;}),_0x5c5641[_0x1a49f4(0x141)]((_0x452601,_0x5b4032)=>{var _0x399640=_0x1a49f4;_0x5987d3[_0x5b4032][_0x399640(0x1a7)]=_0x452601;}),_0x3c0d5c['forEach']((_0x4003a1,_0x275b3d)=>{var _0x1c5078=_0x1a49f4;_0x5987d3[_0x275b3d][_0x1c5078(0x1af)]=_0x4003a1;}),_0x267e1c[_0x1a49f4(0x141)]((_0x100183,_0x4c36ae)=>{var _0x44e9ac=_0x1a49f4;_0x5987d3[_0x4c36ae][_0x44e9ac(0x11a)]=_0x100183;}),_0x25b750[_0x1a49f4(0x141)]((_0x4d390a,_0x4eaf97)=>{var _0x22db48=_0x1a49f4;_0x5987d3[_0x4eaf97][_0x22db48(0x194)]=_0x4d390a;}),_0x5ac4e8['forEach']((_0x3de175,_0x4653b0)=>{var _0x268847=_0x1a49f4;_0x5987d3[_0x4653b0][_0x268847(0x16a)]=_0x3de175;}),_0x5b07f2[_0x1a49f4(0x141)]((_0x570772,_0x2093cc)=>{var _0x5e4765=_0x1a49f4;_0x5987d3[_0x2093cc][_0x5e4765(0xe8)]=_0x570772;}),_0x34069c[_0x1a49f4(0x141)]((_0x3f2854,_0x31b2d8)=>{var _0x2390e3=_0x1a49f4;_0x5987d3[_0x31b2d8][_0x2390e3(0x133)]=_0x3f2854;}),_0x4ebfc8[_0x1a49f4(0x141)]((_0x4c1bd7,_0x438a52)=>{var _0x35a90e=_0x1a49f4;_0x5987d3[_0x438a52][_0x35a90e(0x19d)]=_0x4c1bd7;}),_0x31503d[_0x1a49f4(0x141)]((_0x2184f4,_0x20094d)=>{var _0x141be7=_0x1a49f4;_0x5987d3[_0x20094d][_0x141be7(0x1dc)]=_0x2184f4;}),_0x3a9639[_0x1a49f4(0x141)]((_0x1c10eb,_0x59d30e)=>{_0x5987d3[_0x59d30e]['invoice']=_0x1c10eb;});var _0xc35466=0x0;_0x5987d3[_0x1a49f4(0x141)](_0x1e5266=>{var _0x3a6b4c=_0x1a49f4;parseFloat(_0x1e5266[_0x3a6b4c(0x145)])<parseFloat(_0x1e5266[_0x3a6b4c(0xfd)])&&parseFloat(_0x1e5266[_0x3a6b4c(0xfd)])>parseFloat(_0x1e5266[_0x3a6b4c(0x145)])&&(console[_0x3a6b4c(0x15e)](_0x1e5266[_0x3a6b4c(0x145)]+_0x3a6b4c(0x165)+_0x1e5266[_0x3a6b4c(0xfd)]),_0xc35466++);});if(_0xc35466!=0x0)return _0x3e1403[_0x1a49f4(0x142)](_0x1a49f4(0x160),_0x1a49f4(0x19a)),_0x22b7c1[_0x1a49f4(0x16e)](_0x1a49f4(0x15d));const _0x5bed9a=_0x5987d3[_0x1a49f4(0xc3)](_0x56b806=>_0x56b806['quantity']!=='0'&&_0x56b806[_0x1a49f4(0xfd)]!==''),_0x48117d=new sales_finished({'invoice':_0x3262fb,'customer':_0x3e1403['body'][_0x1a49f4(0x113)],'date':_0x2c38ab,'warehouse_name':_0x4a0ebd,'sale_product':_0x5bed9a,'note':_0x36e4da,'room':_0x57d4f7,'primary_code':_0x267fb9,'secondary_code':_0x423b76,'prod_code':_0x15c235,'SCRN':_0x1a0f54,'finalize':_0x1a49f4(0x192),'mode_transpo':_0x2f3508,'name_driver':_0x1d1e4b}),_0xe5cb16=await _0x48117d['save'](),_0x58f7af=await sales_finished['findOne']({'invoice':_0x3262fb}),_0x49d63c=new c_payment_data({'invoice':_0x3262fb,'customer':_0x3e1403[_0x1a49f4(0xd8)][_0x1a49f4(0x113)],'reason':_0x1a49f4(0x1cb)});await _0x49d63c['save']();const _0x51ffab=await master_shop[_0x1a49f4(0x1c3)](),_0x44082c=await email_settings[_0x1a49f4(0x124)](),_0x509ac0=await customer[_0x1a49f4(0x124)]({'name':_0x3e1403[_0x1a49f4(0xd8)]['customer']});_0x51ffab[0x0][_0x1a49f4(0xd0)]==0x1?(right_currency=_0x51ffab[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x51ffab[0x0][_0x1a49f4(0x1c0)]);var _0x4a51e4=_0x1a48fe,_0x134c55=_0x32d43a,_0xaf1b4b='',_0x2e89bc;for(_0x2e89bc in _0x4a51e4){_0xaf1b4b+=_0x1a49f4(0x122)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4a51e4[_0x2e89bc]+'</td>'+_0x1a49f4(0x179)+_0x134c55[_0x2e89bc]+_0x1a49f4(0x12a)+'</tr>';}console[_0x1a49f4(0x15e)](_0x1a49f4(0x17f),_0xaf1b4b);let _0x5c6399=nodemailer[_0x1a49f4(0xf5)]({'host':_0x44082c['host'],'port':Number(_0x44082c[_0x1a49f4(0xde)]),'secure':![],'service':'gmail','auth':{'user':_0x44082c[_0x1a49f4(0x18b)],'pass':_0x44082c[_0x1a49f4(0x136)]}}),_0x7435af={'from':_0x44082c[_0x1a49f4(0x18b)],'to':'christian.villamer@jakagroup.com','subject':'Add\x20Sales','attachments':[{'filename':'Logo.png','path':__dirname+_0x1a49f4(0x104)+'/upload/'+_0x51ffab[0x0][_0x1a49f4(0xfb)],'cid':_0x1a49f4(0x12c)}],'html':_0x1a49f4(0xcb)};_0x5c6399[_0x1a49f4(0x114)](_0x7435af,function(_0x53b264,_0x2d4e9f){var _0x45f573=_0x1a49f4;_0x53b264?(console[_0x45f573(0x15e)](_0x53b264),console[_0x45f573(0x15e)](_0x45f573(0x10d))):console['log'](_0x45f573(0xd3));}),_0x3e1403[_0x1a49f4(0x142)](_0x1a49f4(0x16d),_0x1a49f4(0xc2)),_0x22b7c1[_0x1a49f4(0x16e)](_0x1a49f4(0xd2)+_0xe5cb16[_0x1a49f4(0x11e)]);}catch(_0x4c0fd0){console[_0x1a49f4(0x15e)](_0x4c0fd0);}}),router[a0_0x3827f5(0x166)](a0_0x3827f5(0x170),auth,async(_0x1d996c,_0x5da627)=>{var _0x4d7ee7=a0_0x3827f5;try{const {username:_0x46da06,email:_0x444473,role:_0xed8dba}=_0x1d996c['user'],_0x16bd57=_0x1d996c[_0x4d7ee7(0xf0)],_0x273e67=await profile[_0x4d7ee7(0x124)]({'email':_0x16bd57[_0x4d7ee7(0x18b)]}),_0x253d79=await master_shop[_0x4d7ee7(0x1c3)](),_0xe16278=_0x1d996c[_0x4d7ee7(0x102)]['id'],_0xd55625=await sales_finished[_0x4d7ee7(0x14b)](_0xe16278),_0xd48f9d=await warehouse['aggregate']([{'$match':{'name':_0xd55625[_0x4d7ee7(0x1c7)]}},{'$unwind':_0x4d7ee7(0xc9)},{'$group':{'_id':_0x4d7ee7(0xc7),'name':{'$first':_0x4d7ee7(0x101)},'product_stock':{'$first':_0x4d7ee7(0x1b0)},'bay':{'$first':_0x4d7ee7(0x171)},'bin':{'$first':_0x4d7ee7(0x151)},'type':{'$first':_0x4d7ee7(0x144)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4d7ee7(0x172)},'secondary_code':{'$first':_0x4d7ee7(0x121)},'product_code':{'$first':_0x4d7ee7(0x1d4)},'storage':{'$first':_0x4d7ee7(0x13e)},'rack':{'$first':_0x4d7ee7(0xd6)},'expiry_date':{'$first':_0x4d7ee7(0x1a6)},'production_date':{'$first':_0x4d7ee7(0x10b)},'batch_code':{'$first':_0x4d7ee7(0x1ac)},'room':{'$first':'$room'},'room_data':{'$first':_0x4d7ee7(0x1d7)}}}]),_0x232671=await customer[_0x4d7ee7(0x1c3)]({});let _0x8c3abf;if(_0x16bd57[_0x4d7ee7(0xc1)]==_0x4d7ee7(0xc5)){const _0x56ee51=await staff[_0x4d7ee7(0x124)]({'email':_0x16bd57[_0x4d7ee7(0x18b)]});_0x8c3abf=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x56ee51[_0x4d7ee7(0x193)]}},{'$group':{'_id':_0x4d7ee7(0x1db),'name':{'$first':'$name'}}}]);}else _0x8c3abf=await warehouse[_0x4d7ee7(0x164)]([{'$match':{'status':_0x4d7ee7(0xef)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x5ee4f1=await product[_0x4d7ee7(0x1c3)]({});if(_0x253d79[0x0][_0x4d7ee7(0xe4)]=='English\x20(US)'){var _0xdd9c45=users[_0x4d7ee7(0x123)];console[_0x4d7ee7(0x15e)](_0xdd9c45);}else{if(_0x253d79[0x0][_0x4d7ee7(0xe4)]==_0x4d7ee7(0x18e))var _0xdd9c45=users[_0x4d7ee7(0x18e)];else{if(_0x253d79[0x0][_0x4d7ee7(0xe4)]==_0x4d7ee7(0x1c4))var _0xdd9c45=users[_0x4d7ee7(0x1c4)];else{if(_0x253d79[0x0][_0x4d7ee7(0xe4)]==_0x4d7ee7(0x184))var _0xdd9c45=users[_0x4d7ee7(0x184)];else{if(_0x253d79[0x0][_0x4d7ee7(0xe4)]=='French')var _0xdd9c45=users[_0x4d7ee7(0x1a5)];else{if(_0x253d79[0x0][_0x4d7ee7(0xe4)]=='Portuguese\x20(BR)')var _0xdd9c45=users['Portuguese'];else{if(_0x253d79[0x0][_0x4d7ee7(0xe4)]==_0x4d7ee7(0x18a))var _0xdd9c45=users[_0x4d7ee7(0x18a)];else{if(_0x253d79[0x0][_0x4d7ee7(0xe4)]==_0x4d7ee7(0x126))var _0xdd9c45=users[_0x4d7ee7(0xeb)];}}}}}}}_0x5da627[_0x4d7ee7(0x1d5)](_0x4d7ee7(0x135),{'success':_0x1d996c[_0x4d7ee7(0x142)](_0x4d7ee7(0x16d)),'errors':_0x1d996c[_0x4d7ee7(0x142)](_0x4d7ee7(0x160)),'role':_0x16bd57,'profile':_0x273e67,'customer':_0x232671,'warehouse':_0x8c3abf,'product':_0xd48f9d,'user':_0xd55625,'master_shop':_0x253d79,'unit':_0x5ee4f1,'language':_0xdd9c45});}catch(_0x4e7851){console[_0x4d7ee7(0x15e)](_0x4e7851);}}),router[a0_0x3827f5(0x146)](a0_0x3827f5(0x170),auth,async(_0x312d63,_0x3e6fde)=>{var _0x2545ef=a0_0x3827f5;try{const _0x442948=_0x312d63[_0x2545ef(0x102)]['id'],{invoice:_0x1a891e,warehouse_name:_0x8c223,room:_0x4ddd5a}=_0x312d63[_0x2545ef(0xd8)],_0x3906b7=await sales_finished[_0x2545ef(0x124)]({'invoice':_0x1a891e}),_0x379e79=_0x3906b7['sale_product'][_0x2545ef(0x12e)](async _0x127c33=>{var _0x5430b0=_0x2545ef,_0x47e056=await warehouse[_0x5430b0(0x124)]({'name':_0x8c223,'room':_0x127c33['room_name'],'warehouse_category':_0x5430b0(0x14d)});const _0x3e7204=_0x47e056[_0x5430b0(0xf2)]['map'](_0x442c1b=>{var _0x2866fc=_0x5430b0;_0x442c1b[_0x2866fc(0x159)]==_0x127c33['product_name']&&_0x442c1b[_0x2866fc(0x1a7)]==_0x127c33[_0x2866fc(0x1a7)]&&_0x442c1b[_0x2866fc(0x16a)]==_0x127c33[_0x2866fc(0x16a)]&&_0x442c1b[_0x2866fc(0xe8)]==_0x127c33[_0x2866fc(0xe8)]&&_0x442c1b[_0x2866fc(0x194)]==_0x127c33[_0x2866fc(0x194)]&&_0x442c1b[_0x2866fc(0x11e)]==_0x127c33[_0x2866fc(0x1d9)]&&(_0x442c1b[_0x2866fc(0x14c)]>0x0&&(console[_0x2866fc(0x15e)](_0x442c1b[_0x2866fc(0x159)]+'\x20==\x20'+_0x127c33[_0x2866fc(0x159)]+_0x2866fc(0x1b6)+_0x442c1b[_0x2866fc(0x1a7)]+_0x2866fc(0x1c5)+_0x127c33[_0x2866fc(0x1a7)]+_0x2866fc(0x1b6)+_0x442c1b[_0x2866fc(0xe8)]+_0x2866fc(0x1c5)+_0x127c33[_0x2866fc(0xe8)]+_0x2866fc(0x1b6)+_0x442c1b[_0x2866fc(0x16a)]+_0x2866fc(0x1c5)+_0x127c33[_0x2866fc(0x16a)]+'\x20&&\x20'+_0x442c1b[_0x2866fc(0x194)]+_0x2866fc(0x1c5)+_0x127c33[_0x2866fc(0x194)]+_0x2866fc(0x1b6)+_0x442c1b['invoice']+_0x2866fc(0x1c5)+_0x127c33[_0x2866fc(0x14a)]+_0x2866fc(0x1b6)+_0x442c1b[_0x2866fc(0x14c)]+_0x2866fc(0x19e)+_0x127c33['quantity']+'\x20>>>\x20'+_0x127c33['room_name']+_0x2866fc(0x1b6)+_0x442c1b['_id']+_0x2866fc(0x1c5)+_0x127c33['id_transaction_from']),_0x442c1b[_0x2866fc(0x14c)]=Math[_0x2866fc(0x11b)](0x0,Math[_0x2866fc(0x195)](_0x442c1b[_0x2866fc(0x14c)])-Math[_0x2866fc(0x195)](_0x127c33['quantity']))));});return _0x47e056;});Promise['all'](_0x379e79)[_0x2545ef(0x1ce)](async _0x57912e=>{var _0x1be909=_0x2545ef;try{for(const _0x840137 of _0x57912e){await _0x840137[_0x1be909(0x1b3)]();}_0x3906b7[_0x1be909(0x1cf)]=_0x1be909(0x12d);const _0x59fb70=await _0x3906b7[_0x1be909(0x1b3)](),_0x69d902=await master_shop[_0x1be909(0x1c3)](),_0x58e8c0=await email_settings[_0x1be909(0x124)](),_0x4f4bf0=await supervisor_settings[_0x1be909(0x1c3)]();var _0x5f27e1=_0x3906b7[_0x1be909(0x1d8)],_0x43f2af='',_0x50d3e5;for(_0x50d3e5 in _0x5f27e1){var _0x1f1cf0='FG';_0x3906b7[_0x1be909(0x1c7)]=='DRY\x20GOODS'&&(_0x1f1cf0='DG'),_0x43f2af+=_0x1be909(0x122)+_0x1be909(0x179)+_0x5f27e1[_0x50d3e5][_0x1be909(0x159)]+'</td>'+_0x1be909(0x179)+_0x5f27e1[_0x50d3e5][_0x1be909(0x1bd)]+_0x1be909(0x12a)+_0x1be909(0x179)+_0x5f27e1[_0x50d3e5]['quantity']+_0x1be909(0x12a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5f27e1[_0x50d3e5][_0x1be909(0x1af)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5f27e1[_0x50d3e5][_0x1be909(0x11a)]+_0x1be909(0x12a)+_0x1be909(0x179)+_0x3906b7[_0x1be909(0x1c7)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5f27e1[_0x50d3e5][_0x1be909(0x1dc)]+_0x1be909(0x12a)+_0x1be909(0x179)+_0x1f1cf0+_0x5f27e1[_0x50d3e5]['bay']+_0x1be909(0x12a);}let _0x558c01=nodemailer[_0x1be909(0xf5)]({'host':_0x58e8c0[_0x1be909(0xed)],'port':Number(_0x58e8c0[_0x1be909(0xde)]),'secure':![],'auth':{'user':_0x58e8c0[_0x1be909(0x18b)],'pass':_0x58e8c0['password']}}),_0x4746c5={'from':_0x58e8c0[_0x1be909(0x18b)],'to':_0x4f4bf0[0x0][_0x1be909(0x13c)],'subject':_0x1be909(0xbe),'attachments':[{'filename':_0x1be909(0xc6),'path':__dirname+'/../public'+_0x1be909(0x1c2)+_0x69d902[0x0]['image'],'cid':_0x1be909(0x12c)}],'html':_0x1be909(0x111)+_0x1be909(0x1c1)+_0x1be909(0x1d1)+_0x1be909(0x191)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1be909(0x191)+_0x1be909(0x17c)+_0x1be909(0xc0)+_0x1be909(0x191)+_0x1be909(0xf1)+_0x69d902[0x0][_0x1be909(0x143)]+_0x1be909(0x1cd)+'</div>'+_0x1be909(0xc0)+_0x1be909(0x181)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x3906b7[_0x1be909(0x14a)]+'\x20'+_0x1be909(0x1d6)+'\x20Order\x20Date\x20:\x20'+_0x3906b7[_0x1be909(0x1be)]+'\x20'+_0x1be909(0x155)+'</h5>'+_0x1be909(0xc0)+_0x1be909(0x17d)+_0x1be909(0x131)+'<tr>'+_0x1be909(0x1d3)+_0x1be909(0x180)+_0x1be909(0x153)+_0x1be909(0x1ab)+_0x1be909(0x125)+_0x1be909(0x107)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x1be909(0xd4)+_0x1be909(0x1b1)+_0x1be909(0x163)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x43f2af+'\x20'+'</tbody>'+_0x1be909(0x10e)+_0x1be909(0x191)+_0x1be909(0x130)+_0x1be909(0x134)+_0x69d902[0x0][_0x1be909(0x143)]+'</h5>'+_0x1be909(0xc0)+_0x1be909(0xc0)+_0x1be909(0x12f)};_0x558c01[_0x1be909(0x114)](_0x4746c5,function(_0x3ade66,_0x1b9a01){var _0x5e413a=_0x1be909;_0x3ade66?(console[_0x5e413a(0x15e)](_0x3ade66),console[_0x5e413a(0x15e)](_0x5e413a(0x10d))):console[_0x5e413a(0x15e)](_0x5e413a(0xd3));}),_0x312d63[_0x1be909(0x142)](_0x1be909(0x16d),_0x1be909(0x1b7)),_0x3e6fde[_0x1be909(0x16e)]('/picking_list/pdf/'+_0x442948);}catch(_0x1ec7a5){console[_0x1be909(0xdf)](_0x1ec7a5),_0x3e6fde[_0x1be909(0x1bc)](0x1f4)[_0x1be909(0x187)]({'error':_0x1be909(0x15f)});}})['catch'](_0x495da4=>{var _0x3a5b15=_0x2545ef;console['error'](_0x495da4),_0x3e6fde[_0x3a5b15(0x1bc)](0x1f4)[_0x3a5b15(0x187)]({'error':_0x3a5b15(0x1ad)});});}catch(_0x3891f3){console[_0x2545ef(0x15e)](_0x3891f3);}}),router[a0_0x3827f5(0x166)](a0_0x3827f5(0x10a),auth,async(_0x274ee5,_0x10f590)=>{var _0x2e1968=a0_0x3827f5;try{const {username:_0x3ac769,email:_0x4841d6,role:_0x2fd574}=_0x274ee5[_0x2e1968(0xf0)],_0x3450fc=_0x274ee5[_0x2e1968(0xf0)],_0x45ad45=await profile[_0x2e1968(0x124)]({'email':_0x3450fc[_0x2e1968(0x18b)]}),_0x34526c=await master_shop[_0x2e1968(0x1c3)](),_0x37acf2=_0x274ee5[_0x2e1968(0x102)]['id'],_0x5489c2=await sales_finished[_0x2e1968(0x14b)](_0x37acf2);let _0x14b354=new Date(_0x5489c2[_0x2e1968(0x16a)]),_0x1014a1=('0'+_0x14b354[_0x2e1968(0x1a1)]())[_0x2e1968(0x1b4)](-0x2),_0xde01b0=('0'+(_0x14b354['getMonth']()+0x1))[_0x2e1968(0x1b4)](-0x2),_0x44dd42=_0x14b354['getFullYear'](),_0x15935a=_0x44dd42+'-'+_0xde01b0+'-'+_0x1014a1;var _0x476f0a=[_0x2e1968(0xce),'Enclosed'];const _0x45d0b8=await warehouse[_0x2e1968(0x164)]([{'$match':{'name':_0x5489c2[_0x2e1968(0x1c7)],'room':_0x5489c2[_0x2e1968(0x1c9)]}},{'$unwind':_0x2e1968(0xc9)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2e1968(0x101)},'product_stock':{'$first':_0x2e1968(0x1b0)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2e1968(0x151)},'type':{'$first':_0x2e1968(0x144)},'floorlevel':{'$first':_0x2e1968(0x17b)},'primary_code':{'$first':_0x2e1968(0x172)},'secondary_code':{'$first':_0x2e1968(0x121)},'product_code':{'$first':_0x2e1968(0x1d4)},'storage':{'$first':_0x2e1968(0x13e)},'rack':{'$first':_0x2e1968(0xd6)}}}]),_0x4e87d4=await customer[_0x2e1968(0x1c3)]({});let _0x23ea25;if(_0x3450fc[_0x2e1968(0xc1)]==_0x2e1968(0xc5)){const _0x28c280=await staff['findOne']({'email':_0x3450fc[_0x2e1968(0x18b)]});_0x23ea25=await warehouse[_0x2e1968(0x164)]([{'$match':{'status':_0x2e1968(0xef),'name':_0x28c280[_0x2e1968(0x193)]}},{'$group':{'_id':_0x2e1968(0x1db),'name':{'$first':_0x2e1968(0x1db)}}}]);}else _0x23ea25=await warehouse[_0x2e1968(0x164)]([{'$match':{'status':_0x2e1968(0xef)}},{'$group':{'_id':_0x2e1968(0x1db),'name':{'$first':_0x2e1968(0x1db)}}}]);const _0x13ebfd=await product[_0x2e1968(0x1c3)]({});if(_0x34526c[0x0]['language']==_0x2e1968(0x1c8)){var _0x3e4cf1=users[_0x2e1968(0x123)];console[_0x2e1968(0x15e)](_0x3e4cf1);}else{if(_0x34526c[0x0]['language']==_0x2e1968(0x18e))var _0x3e4cf1=users[_0x2e1968(0x18e)];else{if(_0x34526c[0x0][_0x2e1968(0xe4)]==_0x2e1968(0x1c4))var _0x3e4cf1=users['German'];else{if(_0x34526c[0x0]['language']==_0x2e1968(0x184))var _0x3e4cf1=users['Spanish'];else{if(_0x34526c[0x0]['language']==_0x2e1968(0x1a5))var _0x3e4cf1=users[_0x2e1968(0x1a5)];else{if(_0x34526c[0x0][_0x2e1968(0xe4)]=='Portuguese\x20(BR)')var _0x3e4cf1=users[_0x2e1968(0x178)];else{if(_0x34526c[0x0][_0x2e1968(0xe4)]==_0x2e1968(0x18a))var _0x3e4cf1=users['Chinese'];else{if(_0x34526c[0x0][_0x2e1968(0xe4)]==_0x2e1968(0x126))var _0x3e4cf1=users['Arabic'];}}}}}}}_0x10f590[_0x2e1968(0x1d5)]('edit_sales_finished',{'success':_0x274ee5[_0x2e1968(0x142)](_0x2e1968(0x16d)),'errors':_0x274ee5[_0x2e1968(0x142)](_0x2e1968(0x160)),'role':_0x3450fc,'profile':_0x45ad45,'customer':_0x4e87d4,'warehouse':_0x23ea25,'product':_0x45d0b8,'user':_0x5489c2,'master_shop':_0x34526c,'unit':_0x13ebfd,'language':_0x3e4cf1,'rooms_data':_0x476f0a,'ed_fullDate':_0x15935a});}catch(_0x15510e){console[_0x2e1968(0x15e)](_0x15510e);}}),router[a0_0x3827f5(0x146)](a0_0x3827f5(0x10a),auth,async(_0x297c4,_0x6ed7ad)=>{var _0x21842c=a0_0x3827f5;try{const _0x1b5368=_0x297c4[_0x21842c(0x102)]['id'],_0x102640=await sales_finished[_0x21842c(0x124)]({'_id':_0x297c4['params']['id']}),_0x1b8a46=await warehouse[_0x21842c(0x124)]({'name':_0x102640['warehouse_name'],'room':_0x297c4['body'][_0x21842c(0x1c9)],'warehouse_category':_0x21842c(0x14d)}),{invoice:_0x18db5a,customer:_0x566c12,date:_0x1e5af6,warehouse_name:_0x3308a6,product_name:_0x2a89ee,stock:_0x49ff9c,adjust_qty:_0x47c0e9,note:_0x3109df,room:_0x2cb3fa,primary_code:_0x2e55ec,secondary_code:_0x3ee9c5,prod_code:_0x49acc1,level:_0x1d2e75,isle:_0x1cb2d7,pallet:_0x12c40c,expiry_date:_0x1b3f1f}=_0x297c4[_0x21842c(0xd8)];if(typeof _0x2a89ee=='string')var _0x38c1b1=[_0x297c4['body'][_0x21842c(0x159)]],_0x262b7f=[_0x297c4[_0x21842c(0xd8)][_0x21842c(0x145)]],_0x1150cf=[_0x297c4['body'][_0x21842c(0xbf)]],_0x56283e=[_0x297c4[_0x21842c(0xd8)]['primary_code']],_0xdff45a=[_0x297c4['body'][_0x21842c(0xe3)]],_0x2c157f=[_0x297c4['body'][_0x21842c(0xcd)]],_0x19d77b=[_0x297c4[_0x21842c(0xd8)][_0x21842c(0x127)]],_0x4b854d=[_0x297c4[_0x21842c(0xd8)][_0x21842c(0x16a)]];else var _0x38c1b1=[..._0x297c4[_0x21842c(0xd8)][_0x21842c(0x159)]],_0x262b7f=[..._0x297c4['body'][_0x21842c(0x145)]],_0x1150cf=[..._0x297c4[_0x21842c(0xd8)]['adjust_qty']],_0x56283e=[..._0x297c4[_0x21842c(0xd8)][_0x21842c(0xdc)]],_0xdff45a=[..._0x297c4['body'][_0x21842c(0xe3)]],_0x2c157f=[..._0x297c4[_0x21842c(0xd8)][_0x21842c(0xcd)]],_0x19d77b=[..._0x297c4[_0x21842c(0xd8)][_0x21842c(0x127)]],_0x4b854d=[..._0x297c4[_0x21842c(0xd8)][_0x21842c(0x16a)]];const _0x497804=_0x38c1b1[_0x21842c(0x12e)](_0x22a1c8=>{return _0x22a1c8={'product_name':_0x22a1c8};});_0x262b7f[_0x21842c(0x141)]((_0x4dd469,_0x1de81d)=>{var _0x438834=_0x21842c;_0x497804[_0x1de81d][_0x438834(0x145)]=_0x4dd469;}),_0x1150cf[_0x21842c(0x141)]((_0x5ab959,_0x35d6c8)=>{var _0x4d927e=_0x21842c;_0x497804[_0x35d6c8][_0x4d927e(0xfd)]=_0x5ab959;}),_0x56283e[_0x21842c(0x141)]((_0x58a2d5,_0x3d09ec)=>{var _0x3a9414=_0x21842c;_0x497804[_0x3d09ec][_0x3a9414(0xdc)]=_0x58a2d5;}),_0xdff45a['forEach']((_0x303ed5,_0x485b47)=>{_0x497804[_0x485b47]['secondary_code']=_0x303ed5;}),_0x2c157f['forEach']((_0x1717fa,_0x57addd)=>{var _0x1dfcfb=_0x21842c;_0x497804[_0x57addd][_0x1dfcfb(0x1bd)]=_0x1717fa;}),_0x19d77b[_0x21842c(0x141)]((_0x192d35,_0x120869)=>{var _0x2b6cdb=_0x21842c;_0x497804[_0x120869][_0x2b6cdb(0x127)]=_0x192d35;}),_0x4b854d[_0x21842c(0x141)]((_0x327e5b,_0x39fd84)=>{var _0x251edc=_0x21842c;_0x497804[_0x39fd84][_0x251edc(0x16a)]=_0x327e5b;});var _0x41b0c4=0x0;_0x497804[_0x21842c(0x141)](_0x4e071f=>{var _0x42b6c2=_0x21842c;console[_0x42b6c2(0x15e)](_0x42b6c2(0x1da),_0x4e071f),(parseInt(_0x4e071f['stock'])<parseInt(_0x4e071f['quantity'])||parseInt(_0x4e071f[_0x42b6c2(0xfd)])==0x0)&&_0x41b0c4++;});if(_0x41b0c4!=0x0)return _0x297c4[_0x21842c(0x142)](_0x21842c(0x160),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x6ed7ad[_0x21842c(0x16e)](_0x21842c(0x15d));_0x102640[_0x21842c(0x1d8)][_0x21842c(0x141)](_0x7dbc2c=>{var _0x16bc82=_0x21842c;const _0x50bc72=_0x1b8a46[_0x16bc82(0xf2)][_0x16bc82(0x12e)](_0x40402a=>{var _0x33d408=_0x16bc82;_0x40402a[_0x33d408(0x159)]==_0x7dbc2c[_0x33d408(0x159)]&&_0x40402a[_0x33d408(0x1a7)]==_0x7dbc2c[_0x33d408(0x1a7)]&&(_0x40402a[_0x33d408(0x14c)]=parseInt(_0x40402a[_0x33d408(0x14c)])+parseInt(_0x7dbc2c[_0x33d408(0xfd)]));});}),await _0x1b8a46[_0x21842c(0x1b3)]();const _0x360e01=_0x497804[_0x21842c(0xc3)](_0x3e8f08=>_0x3e8f08[_0x21842c(0xfd)]!=='0'&&_0x3e8f08[_0x21842c(0xfd)]!=='');_0x102640[_0x21842c(0x14a)]=_0x18db5a,_0x102640[_0x21842c(0x113)]=_0x566c12,_0x102640[_0x21842c(0x1be)]=_0x1e5af6,_0x102640[_0x21842c(0x1c7)]=_0x3308a6,_0x102640[_0x21842c(0x1d8)]=_0x360e01,_0x102640[_0x21842c(0x1ae)]=_0x3109df,_0x102640[_0x21842c(0x1c9)]=_0x2cb3fa;const _0x4d1b5d=await _0x102640[_0x21842c(0x1b3)](),_0x4713c1=await sales_finished['findOne']({'_id':_0x297c4[_0x21842c(0x102)]['id']}),_0x49970f=await warehouse[_0x21842c(0x124)]({'name':_0x3308a6,'room':_0x2cb3fa,'warehouse_category':'Finished\x20Goods'});_0x4713c1[_0x21842c(0x1d8)][_0x21842c(0x141)](_0x3f4811=>{var _0x555259=_0x21842c;const _0x22605c=_0x49970f[_0x555259(0xf2)]['map'](_0x2cc96f=>{var _0x58969e=_0x555259;_0x2cc96f['product_name']==_0x3f4811[_0x58969e(0x159)]&&_0x2cc96f['bay']==_0x3f4811[_0x58969e(0x1a7)]&&(_0x2cc96f[_0x58969e(0x14c)]=parseInt(_0x2cc96f[_0x58969e(0x14c)])-parseInt(_0x3f4811[_0x58969e(0xfd)]));});}),console[_0x21842c(0x15e)]('final',_0x49970f),await _0x49970f[_0x21842c(0x1b3)]();const _0x236ed6=await c_payment_data[_0x21842c(0x124)]({'invoice':_0x297c4[_0x21842c(0xd8)]['invoice']});_0x236ed6[_0x21842c(0xfe)]=_0x297c4['body'][_0x21842c(0xfe)],await _0x236ed6[_0x21842c(0x1b3)](),_0x297c4[_0x21842c(0x142)]('success','Sales\x20Update\x20successfully'),_0x6ed7ad[_0x21842c(0x16e)](_0x21842c(0x140));}catch(_0x451ab4){console[_0x21842c(0x15e)](_0x451ab4);}}),router['post'](a0_0x3827f5(0x1a3),auth,async(_0x144fa8,_0x58eab5)=>{var _0x57cef5=a0_0x3827f5;try{const _0x1a17ee=_0x144fa8[_0x57cef5(0x102)]['id'],{invoice:_0x38ffd8,customer:_0x37fc30,receivable_amount:_0x3655c0,received_amount:_0x47f652}=_0x144fa8[_0x57cef5(0xd8)],_0x380c38=await sales[_0x57cef5(0x14b)](_0x1a17ee);console[_0x57cef5(0x15e)](_0x380c38);var _0x204027=_0x3655c0-_0x47f652;console['log'](_0x47f652),_0x380c38[_0x57cef5(0x105)]=parseFloat(_0x47f652)+parseFloat(_0x380c38[_0x57cef5(0x105)]),_0x380c38[_0x57cef5(0xdb)]=_0x204027,console[_0x57cef5(0x15e)](_0x380c38);const _0x50e269=await _0x380c38[_0x57cef5(0x1b3)](),_0x3312f6=await c_payment_data['findOne']({'invoice':_0x38ffd8});_0x3312f6[_0x57cef5(0x116)]=_0x204027,await _0x3312f6[_0x57cef5(0x1b3)]();let _0x31f70f=new Date(),_0x1f14d6=('0'+_0x31f70f['getDate']())[_0x57cef5(0x1b4)](-0x2),_0x2eb93d=('0'+(_0x31f70f[_0x57cef5(0x106)]()+0x1))[_0x57cef5(0x1b4)](-0x2),_0x560db1=_0x31f70f[_0x57cef5(0xf9)](),_0x5797c2=_0x560db1+'-'+_0x2eb93d+'-'+_0x1f14d6;const _0x265a03=new customer_payment({'invoice':_0x38ffd8,'date':_0x560db1+'-'+_0x2eb93d+'-'+_0x1f14d6,'customer':_0x37fc30,'reason':_0x57cef5(0x108),'amount':_0x47f652}),_0x451a7c=await _0x265a03[_0x57cef5(0x1b3)]();_0x144fa8[_0x57cef5(0x142)](_0x57cef5(0x16d),_0x57cef5(0xc8)),_0x58eab5[_0x57cef5(0x16e)](_0x57cef5(0xe5));}catch(_0x22e36f){console[_0x57cef5(0x15e)](_0x22e36f);}}),router[a0_0x3827f5(0x166)](a0_0x3827f5(0xe9),auth,async(_0x124a5c,_0x483607)=>{var _0x45433a=a0_0x3827f5;try{const {username:_0xd07004,email:_0x44f6cd,role:_0x21a865}=_0x124a5c['user'],_0x36701b=_0x124a5c[_0x45433a(0xf0)],_0x322251=await profile['findOne']({'email':_0x36701b[_0x45433a(0x18b)]}),_0x77367f=await master_shop[_0x45433a(0x1c3)]();console[_0x45433a(0x15e)](_0x45433a(0xc4),_0x77367f);const _0xdc9693=_0x124a5c[_0x45433a(0x102)]['id'],_0x544cf4=await sales[_0x45433a(0x14b)](_0xdc9693);console[_0x45433a(0x15e)](_0x544cf4);const _0x30c6e3=await customer[_0x45433a(0x124)]({'name':_0x544cf4[_0x45433a(0x113)]});console[_0x45433a(0x15e)](_0x30c6e3);if(_0x77367f[0x0][_0x45433a(0xe4)]==_0x45433a(0x1c8)){var _0x3d6d83=users[_0x45433a(0x123)];console[_0x45433a(0x15e)](_0x3d6d83);}else{if(_0x77367f[0x0][_0x45433a(0xe4)]==_0x45433a(0x18e))var _0x3d6d83=users['Hindi'];else{if(_0x77367f[0x0][_0x45433a(0xe4)]==_0x45433a(0x1c4))var _0x3d6d83=users[_0x45433a(0x1c4)];else{if(_0x77367f[0x0][_0x45433a(0xe4)]=='Spanish')var _0x3d6d83=users[_0x45433a(0x184)];else{if(_0x77367f[0x0][_0x45433a(0xe4)]=='French')var _0x3d6d83=users['French'];else{if(_0x77367f[0x0][_0x45433a(0xe4)]==_0x45433a(0xcc))var _0x3d6d83=users[_0x45433a(0x178)];else{if(_0x77367f[0x0][_0x45433a(0xe4)]==_0x45433a(0x18a))var _0x3d6d83=users[_0x45433a(0x18a)];else{if(_0x77367f[0x0][_0x45433a(0xe4)]==_0x45433a(0x126))var _0x3d6d83=users[_0x45433a(0xeb)];}}}}}}}_0x483607[_0x45433a(0x1d5)]('sales_invoice',{'success':_0x124a5c[_0x45433a(0x142)](_0x45433a(0x16d)),'errors':_0x124a5c[_0x45433a(0x142)]('errors'),'role':_0x36701b,'profile':_0x322251,'master_shop':_0x77367f,'customers':_0x30c6e3,'sales':_0x544cf4,'language':_0x3d6d83});}catch(_0x35f6b3){console[_0x45433a(0x15e)](_0x35f6b3);}}),router[a0_0x3827f5(0x166)]('/view/return_sales/:id',auth,async(_0x1caca2,_0xf8b31b)=>{var _0x45c68e=a0_0x3827f5;try{const {username:_0x1fa965,email:_0x10f9b6,role:_0x2cd6bf}=_0x1caca2['user'],_0x56048f=_0x1caca2[_0x45c68e(0xf0)],_0x453fc4=await profile['findOne']({'email':_0x56048f[_0x45c68e(0x18b)]}),_0x32caad=await master_shop[_0x45c68e(0x1c3)](),_0x138b5a=_0x1caca2[_0x45c68e(0x102)]['id'],_0x186a33=await sales_finished[_0x45c68e(0x14b)](_0x138b5a),_0x2446d5=await warehouse[_0x45c68e(0x164)]([{'$match':{'name':_0x186a33[_0x45c68e(0x1c7)]}},{'$unwind':_0x45c68e(0xc9)},{'$group':{'_id':_0x45c68e(0xc7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x45c68e(0x1b0)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x45c68e(0x151)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x45c68e(0x172)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x45c68e(0x1d4)},'storage':{'$first':_0x45c68e(0x13e)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x45c68e(0x1a6)},'production_date':{'$first':_0x45c68e(0x10b)},'unit':{'$first':_0x45c68e(0xe7)},'secondary_unit':{'$first':_0x45c68e(0x150)},'maxProducts':{'$first':_0x45c68e(0x199)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x2524a4=await product[_0x45c68e(0x1c3)]({}),_0x562bf4=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x45c68e(0x14d),'name':{'$ne':_0x45c68e(0x132),'$ne':_0x45c68e(0xda)}}},{'$group':{'_id':_0x45c68e(0x1db),'name':{'$first':_0x45c68e(0x1db)}}},{'$sort':{'name':0x1}}]);var _0x588b87=['Return\x20Rooms'];const _0x362403=await warehouse[_0x45c68e(0x164)]([{'$match':{'status':_0x45c68e(0xef),'name':'Quality\x20Inspection'}},{'$group':{'_id':'$name','name':{'$first':_0x45c68e(0x1db)}}},{'$sort':{'name':0x1}}]);if(_0x32caad[0x0]['language']=='English\x20(US)'){var _0x420f30=users[_0x45c68e(0x123)];console[_0x45c68e(0x15e)](_0x420f30);}else{if(_0x32caad[0x0][_0x45c68e(0xe4)]==_0x45c68e(0x18e))var _0x420f30=users[_0x45c68e(0x18e)];else{if(_0x32caad[0x0][_0x45c68e(0xe4)]==_0x45c68e(0x1c4))var _0x420f30=users[_0x45c68e(0x1c4)];else{if(_0x32caad[0x0]['language']==_0x45c68e(0x184))var _0x420f30=users[_0x45c68e(0x184)];else{if(_0x32caad[0x0]['language']=='French')var _0x420f30=users[_0x45c68e(0x1a5)];else{if(_0x32caad[0x0]['language']==_0x45c68e(0xcc))var _0x420f30=users['Portuguese'];else{if(_0x32caad[0x0]['language']==_0x45c68e(0x18a))var _0x420f30=users[_0x45c68e(0x18a)];else{if(_0x32caad[0x0][_0x45c68e(0xe4)]=='Arabic\x20(ae)')var _0x420f30=users['Arabic'];}}}}}}}_0xf8b31b[_0x45c68e(0x1d5)](_0x45c68e(0xee),{'success':_0x1caca2[_0x45c68e(0x142)]('success'),'errors':_0x1caca2[_0x45c68e(0x142)]('errors'),'role':_0x56048f,'profile':_0x453fc4,'user':_0x186a33,'stock':_0x2446d5,'master_shop':_0x32caad,'unit':_0x2524a4,'language':_0x420f30,'warehouses':_0x562bf4,'rooms':_0x588b87,'warehouse_QA':_0x362403});}catch(_0x46aa24){console[_0x45c68e(0x15e)](_0x46aa24),_0xf8b31b[_0x45c68e(0x1bc)](0xc8)[_0x45c68e(0x187)]({'message':_0x46aa24['message']});}}),router[a0_0x3827f5(0x146)]('/view/return_sales/:id',auth,async(_0x1361c9,_0x4bb067)=>{var _0x8c3033=a0_0x3827f5;if(_0x1361c9['body']['for_categorize']=='QA')try{const {invoice:_0x5ca6c3,date:_0x130f19,warehouse_name:_0x44194d,product_name:_0x481197,primary_code:_0x5734a9,secondary_code:_0x58c1c2,product_code:_0xf95ef1,sales_quantity:_0x4bf2ab,stocks:_0x4c334a,return_qty:_0x2bcf55,Room_name:_0x1a97fc,to_warehouse_name_QA:_0x157ea6,to_Room_name_QA:_0x9c27ea,note:_0x55c1ac,for_categorize:_0x4a507c,product_name_QA1:_0x2ee321}=_0x1361c9[_0x8c3033(0xd8)];if(typeof _0x2ee321==_0x8c3033(0x185))var _0x248dd0=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x13b)]],_0x334569=[_0x1361c9['body'][_0x8c3033(0x183)]],_0x5c84f4=[_0x1361c9['body']['secondary_code_QA']],_0x3c16d7=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xe6)]],_0x4a2a51=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xdd)]],_0x37c7c8=[_0x1361c9['body'][_0x8c3033(0x169)]],_0x496748=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x11f)]],_0x28ce31=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x162)]],_0x1601c8=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x13d)]],_0x21a1b5=[_0x1361c9['body'][_0x8c3033(0x174)]],_0x45ded1=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xe0)]],_0x52bfc2=[_0x1361c9[_0x8c3033(0xd8)]['unit_QA']],_0x5a2620=[_0x1361c9[_0x8c3033(0xd8)]['production_date_QA']],_0x5249f8=[_0x1361c9['body'][_0x8c3033(0x15b)]];else var _0x248dd0=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x13b)]],_0x334569=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x183)]],_0x5c84f4=[..._0x1361c9[_0x8c3033(0xd8)]['secondary_code_QA']],_0x3c16d7=[..._0x1361c9['body'][_0x8c3033(0xe6)]],_0x4a2a51=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xdd)]],_0x37c7c8=[..._0x1361c9['body'][_0x8c3033(0x169)]],_0x496748=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x11f)]],_0x28ce31=[..._0x1361c9['body'][_0x8c3033(0x162)]],_0x1601c8=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x13d)]],_0x21a1b5=[..._0x1361c9['body'][_0x8c3033(0x174)]],_0x45ded1=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xe0)]],_0x52bfc2=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x152)]],_0x5a2620=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xf4)]],_0x5249f8=[..._0x1361c9['body']['expiry_date_QA']];const _0x53a1ac=_0x248dd0['map'](_0x329a39=>{return _0x329a39={'product_name':_0x329a39};});_0x334569[_0x8c3033(0x141)]((_0x51312e,_0x2a0354)=>{var _0x2cbaff=_0x8c3033;_0x53a1ac[_0x2a0354][_0x2cbaff(0xdc)]=_0x51312e;}),_0x5c84f4[_0x8c3033(0x141)]((_0x44526e,_0x4783cf)=>{var _0x1a22df=_0x8c3033;_0x53a1ac[_0x4783cf][_0x1a22df(0xe3)]=_0x44526e;}),_0x3c16d7[_0x8c3033(0x141)]((_0x4aabdb,_0x40bf37)=>{var _0x4c4cfc=_0x8c3033;_0x53a1ac[_0x40bf37][_0x4c4cfc(0x1bd)]=_0x4aabdb;}),_0x4a2a51[_0x8c3033(0x141)]((_0xd570de,_0x5bb0c7)=>{var _0x421828=_0x8c3033;_0x53a1ac[_0x5bb0c7][_0x421828(0x19b)]=_0xd570de;}),_0x37c7c8['forEach']((_0x2a503e,_0x3eccc2)=>{var _0x224d0a=_0x8c3033;_0x53a1ac[_0x3eccc2][_0x224d0a(0x145)]=_0x2a503e;}),_0x496748[_0x8c3033(0x141)]((_0x1c7520,_0x883d31)=>{var _0x43376a=_0x8c3033;_0x53a1ac[_0x883d31][_0x43376a(0x158)]=_0x1c7520;}),_0x28ce31[_0x8c3033(0x141)]((_0x378e96,_0x1a54a6)=>{_0x53a1ac[_0x1a54a6]['maxPerUnit']=_0x378e96;}),_0x1601c8[_0x8c3033(0x141)]((_0x2be80a,_0x518a30)=>{_0x53a1ac[_0x518a30]['maxProducts']=_0x2be80a;}),_0x21a1b5[_0x8c3033(0x141)]((_0x41465d,_0x3027d6)=>{var _0x5371ef=_0x8c3033;_0x53a1ac[_0x3027d6][_0x5371ef(0x194)]=_0x41465d;}),_0x45ded1[_0x8c3033(0x141)]((_0x254b6b,_0x3b1803)=>{var _0x2a51a7=_0x8c3033;_0x53a1ac[_0x3b1803][_0x2a51a7(0x11a)]=_0x254b6b;}),_0x52bfc2['forEach']((_0x3b6ddf,_0x2e6f4a)=>{var _0xbbec4c=_0x8c3033;_0x53a1ac[_0x2e6f4a][_0xbbec4c(0x1af)]=_0x3b6ddf;}),_0x5a2620[_0x8c3033(0x141)]((_0x33c3bd,_0x4c955c)=>{var _0x37a5a0=_0x8c3033;_0x53a1ac[_0x4c955c][_0x37a5a0(0xe8)]=_0x33c3bd;}),_0x5249f8['forEach']((_0x11931b,_0x34a716)=>{var _0x1ae294=_0x8c3033;_0x53a1ac[_0x34a716][_0x1ae294(0x16a)]=_0x11931b;});const _0x3cf8c0=await sales_finished[_0x8c3033(0x124)]({'invoice':_0x5ca6c3});_0x3cf8c0[_0x8c3033(0x110)]=_0x8c3033(0x12d);const _0x2631a0=await _0x3cf8c0[_0x8c3033(0x1b3)](),_0x4f6c53=new sales_return_finished({'invoice':_0x5ca6c3,'customer':_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x113)],'date':_0x130f19,'warehouse_name':_0x44194d,'room':_0x1a97fc,'ToWarehouse':_0x157ea6,'ToRoom':_0x9c27ea,'return_sale_QA':_0x53a1ac,'note':_0x55c1ac,'warehouse_cat':_0x4a507c}),_0xa41a2b=await _0x4f6c53[_0x8c3033(0x1b3)](),_0x38d78a=await sales_return_finished[_0x8c3033(0x124)]({'invoice':_0x5ca6c3}),_0x476517=await warehouse[_0x8c3033(0x124)]({'name':_0x157ea6,'room':_0x9c27ea});_0x38d78a[_0x8c3033(0x167)][_0x8c3033(0x141)](_0x230b11=>{var _0x479fad=_0x8c3033,_0xf1e4a3=0x0;const _0x3bed9b=_0x476517[_0x479fad(0xf2)][_0x479fad(0x12e)](_0x35dcf8=>{var _0x4af62a=_0x479fad;_0x35dcf8['product_name']==_0x230b11[_0x4af62a(0x159)]&&_0x35dcf8[_0x4af62a(0x16a)]==_0x230b11[_0x4af62a(0x16a)]&&_0x35dcf8['production_date']==_0x230b11[_0x4af62a(0xe8)]&&_0x35dcf8[_0x4af62a(0x194)]==_0x230b11[_0x4af62a(0x194)]&&(_0x35dcf8[_0x4af62a(0x14c)]=parseInt(_0x35dcf8[_0x4af62a(0x14c)])+parseInt(_0x230b11[_0x4af62a(0x158)]),_0xf1e4a3++);});_0xf1e4a3=='0'&&(_0x476517[_0x479fad(0xf2)]=_0x476517[_0x479fad(0xf2)][_0x479fad(0x13a)]({'product_name':_0x230b11[_0x479fad(0x159)],'product_stock':_0x230b11[_0x479fad(0x158)],'primary_code':_0x230b11['primary_code'],'secondary_code':_0x230b11[_0x479fad(0xe3)],'product_code':_0x230b11[_0x479fad(0x1bd)],'batch_code':_0x230b11[_0x479fad(0x194)],'maxPerUnit':_0x230b11[_0x479fad(0xca)],'production_date':_0x230b11[_0x479fad(0xe8)],'expiry_date':_0x230b11[_0x479fad(0x16a)],'secondary_unit':_0x230b11[_0x479fad(0x11a)],'unit':_0x230b11[_0x479fad(0x1af)],'maxProducts':_0x230b11[_0x479fad(0xff)],'bay':_0x230b11[_0x479fad(0x1a7)]}));}),await _0x476517[_0x8c3033(0x1b3)]();const _0x4b409f=new c_payment_data({'invoice':_0x5ca6c3,'customer':_0x1361c9[_0x8c3033(0xd8)]['customer'],'reason':_0x8c3033(0x1d2)});await _0x4b409f[_0x8c3033(0x1b3)]();const _0x386214=await master_shop[_0x8c3033(0x1c3)](),_0x216620=await email_settings['findOne'](),_0x43a3cd=await customer[_0x8c3033(0x124)]({'name':_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x113)]});_0x386214[0x0]['currency_placement']==0x1?(right_currency=_0x386214[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x386214[0x0][_0x8c3033(0x1c0)]);var _0x2a88dd=_0x248dd0,_0x418e87=_0x496748,_0x54ef66='',_0x6fca6;for(_0x6fca6 in _0x2a88dd){_0x54ef66+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a88dd[_0x6fca6]+'</td>'+_0x8c3033(0x179)+_0x418e87[_0x6fca6]+_0x8c3033(0x12a)+_0x8c3033(0x1b1);}console[_0x8c3033(0x15e)](_0x8c3033(0x17f),_0x54ef66);let _0x55d17e=nodemailer[_0x8c3033(0xf5)]({'service':_0x8c3033(0xec),'auth':{'user':_0x216620['email'],'pass':_0x216620[_0x8c3033(0x136)]}}),_0x496025={'from':_0x216620[_0x8c3033(0x18b)],'to':_0x43a3cd[_0x8c3033(0x18b)],'subject':_0x8c3033(0xd7),'attachments':[{'filename':_0x8c3033(0xc6),'path':__dirname+_0x8c3033(0x104)+_0x8c3033(0x1c2)+_0x386214[0x0][_0x8c3033(0xfb)],'cid':_0x8c3033(0x12c)}],'html':_0x8c3033(0x111)+_0x8c3033(0x1c1)+_0x8c3033(0x1d1)+_0x8c3033(0x191)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x8c3033(0x191)+_0x8c3033(0x17c)+'</div>'+_0x8c3033(0x191)+_0x8c3033(0xf1)+_0x386214[0x0]['site_title']+'\x20</h2>'+'</div>'+_0x8c3033(0xc0)+_0x8c3033(0x181)+_0x8c3033(0x191)+_0x8c3033(0xea)+_0x8c3033(0x137)+_0x5ca6c3+'\x20'+_0x8c3033(0x1d6)+'\x20Order\x20Date\x20:\x20'+_0x130f19+'\x20'+_0x8c3033(0x155)+'</h5>'+'</div>'+_0x8c3033(0x17d)+_0x8c3033(0x131)+_0x8c3033(0x122)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x8c3033(0x1a9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x8c3033(0x1b1)+'</thead>'+_0x8c3033(0x182)+'\x20'+_0x54ef66+'\x20'+_0x8c3033(0x18d)+_0x8c3033(0x10e)+_0x8c3033(0x191)+_0x8c3033(0x130)+'<h5>'+_0x386214[0x0][_0x8c3033(0x143)]+_0x8c3033(0x112)+_0x8c3033(0xc0)+_0x8c3033(0xc0)+_0x8c3033(0x12f)};_0x55d17e['sendMail'](_0x496025,function(_0x406888,_0x5f1267){var _0x398573=_0x8c3033;_0x406888?(console['log'](_0x406888),console[_0x398573(0x15e)](_0x398573(0x10d))):console[_0x398573(0x15e)]('Email\x20sent\x20successfully');}),_0x1361c9[_0x8c3033(0x142)]('success',_0x8c3033(0x168)),_0x4bb067['redirect'](_0x8c3033(0x140));}catch(_0x2e0fd6){_0x4bb067[_0x8c3033(0x1bc)](0xc8)[_0x8c3033(0x187)]({'message1':_0x2e0fd6[_0x8c3033(0x15a)]});}else{if(_0x1361c9['body'][_0x8c3033(0x1b9)]=='GS')try{const {invoice:_0x39aeaf,date:_0x41910f,warehouse_name:_0x5b1b74,product_name:_0x1aabe2,primary_code:_0x28208f,secondary_code:_0x27c538,product_code:_0x4647da,sales_quantity:_0x2aafe1,stocks:_0x47625c,return_qty:_0x104c67,Room_name:_0x3f70f2,to_warehouse_name:_0x10ea33,to_Room_name:_0x431598,note:_0x30a422,level:_0xfa5f32,isle:_0x393e0f,pallet:_0x3ca575,for_categorize:_0x592002}=_0x1361c9[_0x8c3033(0xd8)];if(typeof _0x1aabe2=='string')var _0x248dd0=[_0x1361c9['body'][_0x8c3033(0x159)]],_0x334569=[_0x1361c9[_0x8c3033(0xd8)]['primary_code']],_0x5c84f4=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xe3)]],_0x3c16d7=[_0x1361c9['body'][_0x8c3033(0x1bd)]],_0x4a2a51=[_0x1361c9[_0x8c3033(0xd8)]['sales_quantity']],_0x496748=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x158)]],_0xdfcb6f=[_0x1361c9['body'][_0x8c3033(0x1a7)]],_0x28ce31=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xca)]],_0x1601c8=[_0x1361c9[_0x8c3033(0xd8)]['maxProducts']],_0x21a1b5=[_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x194)]],_0x45ded1=[_0x1361c9['body']['secondary_unit']],_0x52bfc2=[_0x1361c9['body'][_0x8c3033(0x1af)]],_0x5a2620=[_0x1361c9['body'][_0x8c3033(0xe8)]],_0x5249f8=[_0x1361c9['body'][_0x8c3033(0x16a)]];else var _0x248dd0=[..._0x1361c9[_0x8c3033(0xd8)]['product_name']],_0x334569=[..._0x1361c9['body'][_0x8c3033(0xdc)]],_0x5c84f4=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xe3)]],_0x3c16d7=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x1bd)]],_0x4a2a51=[..._0x1361c9[_0x8c3033(0xd8)]['sales_quantity']],_0x496748=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x158)]],_0xdfcb6f=[..._0x1361c9['body']['bay']],_0x28ce31=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xca)]],_0x1601c8=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xff)]],_0x21a1b5=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x194)]],_0x45ded1=[..._0x1361c9['body'][_0x8c3033(0x11a)]],_0x52bfc2=[..._0x1361c9['body'][_0x8c3033(0x1af)]],_0x5a2620=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0xe8)]],_0x5249f8=[..._0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x16a)]];const _0x23b3e1=_0x248dd0[_0x8c3033(0x12e)](_0x5dd519=>{return _0x5dd519={'product_name':_0x5dd519};});_0x334569[_0x8c3033(0x141)]((_0x704571,_0x1ec62c)=>{var _0x6faad9=_0x8c3033;_0x23b3e1[_0x1ec62c][_0x6faad9(0xdc)]=_0x704571;}),_0x5c84f4[_0x8c3033(0x141)]((_0x5d2a48,_0x856e6e)=>{_0x23b3e1[_0x856e6e]['secondary_code']=_0x5d2a48;}),_0x3c16d7['forEach']((_0x3b8627,_0x54dff7)=>{var _0x4b5fb1=_0x8c3033;_0x23b3e1[_0x54dff7][_0x4b5fb1(0x1bd)]=_0x3b8627;}),_0x4a2a51[_0x8c3033(0x141)]((_0x1b72c8,_0x3dd71c)=>{var _0x215e56=_0x8c3033;_0x23b3e1[_0x3dd71c][_0x215e56(0x19b)]=_0x1b72c8;}),_0x496748['forEach']((_0x4ff9e0,_0x4668db)=>{_0x23b3e1[_0x4668db]['return_qty']=_0x4ff9e0;}),_0xdfcb6f['forEach']((_0xea05db,_0x3d9f2e)=>{var _0x4bf2d5=_0x8c3033;_0x23b3e1[_0x3d9f2e][_0x4bf2d5(0x1a7)]=_0xea05db;}),_0x28ce31[_0x8c3033(0x141)]((_0x31c880,_0x3f16ac)=>{_0x23b3e1[_0x3f16ac]['maxPerUnit']=_0x31c880;}),_0x1601c8[_0x8c3033(0x141)]((_0x55bb2f,_0x4ad63e)=>{_0x23b3e1[_0x4ad63e]['maxProducts']=_0x55bb2f;}),_0x21a1b5['forEach']((_0x1edea5,_0x1e273b)=>{var _0x241e66=_0x8c3033;_0x23b3e1[_0x1e273b][_0x241e66(0x194)]=_0x1edea5;}),_0x45ded1[_0x8c3033(0x141)]((_0xfa0242,_0x5c8100)=>{var _0x576cf8=_0x8c3033;_0x23b3e1[_0x5c8100][_0x576cf8(0x11a)]=_0xfa0242;}),_0x52bfc2[_0x8c3033(0x141)]((_0x2e3ad9,_0x1532fb)=>{var _0x349e07=_0x8c3033;_0x23b3e1[_0x1532fb][_0x349e07(0x1af)]=_0x2e3ad9;}),_0x5a2620['forEach']((_0x3cc5db,_0x3c0473)=>{var _0x125b92=_0x8c3033;_0x23b3e1[_0x3c0473][_0x125b92(0xe8)]=_0x3cc5db;}),_0x5249f8[_0x8c3033(0x141)]((_0x2a6bac,_0x282473)=>{var _0x578e2c=_0x8c3033;_0x23b3e1[_0x282473][_0x578e2c(0x16a)]=_0x2a6bac;});var _0x5e9b0f=0x0;_0x23b3e1[_0x8c3033(0x141)](_0x1b6175=>{var _0x3ab875=_0x8c3033;(parseInt(_0x1b6175['sale_qty'])<parseInt(_0x1b6175[_0x3ab875(0x158)])||parseInt(_0x1b6175[_0x3ab875(0x145)])<parseInt(_0x1b6175['return_qty'])&&parseInt(_0x1b6175['sale_qty'])>parseInt(_0x1b6175[_0x3ab875(0x158)])||parseInt(_0x1b6175['return_qty'])==0x0)&&_0x5e9b0f++;});if(_0x5e9b0f!=0x0)return _0x1361c9['flash'](_0x8c3033(0x160),_0x8c3033(0x156)),_0x4bb067['redirect'](_0x8c3033(0x15d));const _0x4d8645=await sales_finished[_0x8c3033(0x124)]({'invoice':_0x39aeaf});_0x4d8645[_0x8c3033(0x110)]=_0x8c3033(0x12d);const _0x5a159c=await _0x4d8645['save'](),_0x5b0334=new sales_return_finished({'invoice':_0x39aeaf,'customer':_0x1361c9[_0x8c3033(0xd8)]['customer'],'date':_0x41910f,'warehouse_name':_0x5b1b74,'room':_0x3f70f2,'ToWarehouse':_0x10ea33,'ToRoom':_0x431598,'return_sale':_0x23b3e1,'note':_0x30a422,'warehouse_cat':_0x592002}),_0x1a7766=await _0x5b0334['save'](),_0x43cf39=await sales_return_finished[_0x8c3033(0x124)]({'invoice':_0x39aeaf}),_0x3b3c42=await warehouse['findOne']({'name':_0x10ea33,'room':_0x431598,'warehouse_category':_0x8c3033(0x14d)});_0x43cf39[_0x8c3033(0x1a2)]['forEach'](_0x15fafe=>{var _0x41a60f=_0x8c3033,_0x2f1fb9=0x0;const _0x1502b5=_0x3b3c42[_0x41a60f(0xf2)]['map'](_0x32318c=>{var _0x356a75=_0x41a60f;_0x32318c['product_name']==_0x15fafe[_0x356a75(0x159)]&&_0x32318c[_0x356a75(0x1a7)]==_0x15fafe[_0x356a75(0x1a7)]&&_0x32318c['expiry_date']==_0x15fafe['expiry_date']&&_0x32318c['production_date']==_0x15fafe['production_date']&&_0x32318c[_0x356a75(0x194)]==_0x15fafe[_0x356a75(0x194)]&&(_0x32318c['product_stock']=parseInt(_0x32318c[_0x356a75(0x14c)])+parseInt(_0x15fafe['return_qty']),_0x2f1fb9++);});_0x2f1fb9=='0'&&(_0x3b3c42[_0x41a60f(0xf2)]=_0x3b3c42[_0x41a60f(0xf2)][_0x41a60f(0x13a)]({'product_name':_0x15fafe['product_name'],'product_stock':_0x15fafe[_0x41a60f(0x158)],'primary_code':_0x15fafe[_0x41a60f(0xdc)],'secondary_code':_0x15fafe['secondary_code'],'product_code':_0x15fafe[_0x41a60f(0x1bd)],'bay':_0x15fafe[_0x41a60f(0x1a7)],'batch_code':_0x15fafe['batch_code'],'maxPerUnit':_0x15fafe[_0x41a60f(0xca)],'production_date':_0x15fafe[_0x41a60f(0xe8)],'expiry_date':_0x15fafe[_0x41a60f(0x16a)],'secondary_unit':_0x15fafe[_0x41a60f(0x11a)],'unit':_0x15fafe[_0x41a60f(0x1af)],'maxProducts':_0x15fafe[_0x41a60f(0xff)]}));}),await _0x3b3c42['save'](),console['log'](_0x1361c9[_0x8c3033(0xd8)]);const _0x2d1149=new c_payment_data({'invoice':_0x39aeaf,'customer':_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x113)],'reason':_0x8c3033(0x1d2)});await _0x2d1149[_0x8c3033(0x1b3)]();const _0x5e687d=await master_shop[_0x8c3033(0x1c3)]();console[_0x8c3033(0x15e)](_0x8c3033(0x14e),_0x5e687d[0x0][_0x8c3033(0xfb)]);const _0x5263ba=await email_settings['findOne'](),_0x2432e4=await customer[_0x8c3033(0x124)]({'name':_0x1361c9[_0x8c3033(0xd8)][_0x8c3033(0x113)]});console[_0x8c3033(0x15e)]('customer_data',_0x2432e4);_0x5e687d[0x0][_0x8c3033(0xd0)]==0x1?(right_currency=_0x5e687d[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5e687d[0x0][_0x8c3033(0x1c0)]);var _0x2a88dd=_0x248dd0,_0x418e87=_0x496748,_0x54ef66='',_0x6fca6;for(_0x6fca6 in _0x2a88dd){_0x54ef66+=_0x8c3033(0x122)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a88dd[_0x6fca6]+_0x8c3033(0x12a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x418e87[_0x6fca6]+'</td>'+_0x8c3033(0x1b1);}console[_0x8c3033(0x15e)](_0x8c3033(0x17f),_0x54ef66);let _0xee23b2=nodemailer[_0x8c3033(0xf5)]({'service':_0x8c3033(0xec),'auth':{'user':_0x5263ba[_0x8c3033(0x18b)],'pass':_0x5263ba[_0x8c3033(0x136)]}}),_0x4f822d={'from':_0x5263ba[_0x8c3033(0x18b)],'to':_0x2432e4[_0x8c3033(0x18b)],'subject':_0x8c3033(0xd7),'attachments':[{'filename':_0x8c3033(0xc6),'path':__dirname+_0x8c3033(0x104)+'/upload/'+_0x5e687d[0x0][_0x8c3033(0xfb)],'cid':'logo'}],'html':_0x8c3033(0x111)+'<html><head><title></title>'+'</head><body>'+'<div>'+_0x8c3033(0x117)+_0x8c3033(0x191)+_0x8c3033(0x17c)+_0x8c3033(0xc0)+_0x8c3033(0x191)+_0x8c3033(0xf1)+_0x5e687d[0x0][_0x8c3033(0x143)]+'\x20</h2>'+_0x8c3033(0xc0)+'</div>'+_0x8c3033(0x181)+_0x8c3033(0x191)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x8c3033(0x137)+_0x39aeaf+'\x20'+_0x8c3033(0x1d6)+_0x8c3033(0x139)+_0x41910f+'\x20'+_0x8c3033(0x155)+_0x8c3033(0x112)+_0x8c3033(0xc0)+_0x8c3033(0x17d)+_0x8c3033(0x131)+_0x8c3033(0x122)+_0x8c3033(0x1d3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x8c3033(0x13f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x8c3033(0x1b1)+_0x8c3033(0x163)+_0x8c3033(0x182)+'\x20'+_0x54ef66+'\x20'+_0x8c3033(0x18d)+_0x8c3033(0x10e)+_0x8c3033(0x191)+_0x8c3033(0x130)+_0x8c3033(0x134)+_0x5e687d[0x0][_0x8c3033(0x143)]+'</h5>'+_0x8c3033(0xc0)+_0x8c3033(0xc0)+_0x8c3033(0x12f)};_0xee23b2[_0x8c3033(0x114)](_0x4f822d,function(_0x478c0a,_0x3c86c7){var _0x53fff9=_0x8c3033;_0x478c0a?(console[_0x53fff9(0x15e)](_0x478c0a),console[_0x53fff9(0x15e)](_0x53fff9(0x10d))):console[_0x53fff9(0x15e)]('Email\x20sent\x20successfully');}),_0x1361c9[_0x8c3033(0x142)](_0x8c3033(0x16d),'sales\x20item\x20return\x20successfull'),_0x4bb067[_0x8c3033(0x16e)]('/all_sales_finished/view');}catch(_0x240cac){console['log'](_0x240cac),_0x4bb067[_0x8c3033(0x1bc)](0xc8)[_0x8c3033(0x187)]({'message1':_0x240cac[_0x8c3033(0x15a)]});}}}),router[a0_0x3827f5(0x166)](a0_0x3827f5(0x1a0),auth,async(_0x145470,_0x5b3e7b)=>{var _0x48744f=a0_0x3827f5;try{const {username:_0x132bc9,email:_0xd5315b,role:_0x21e673}=_0x145470[_0x48744f(0xf0)],_0x13f55b=_0x145470[_0x48744f(0xf0)],_0x1573f6=await profile[_0x48744f(0x124)]({'email':_0x13f55b[_0x48744f(0x18b)]}),_0x164373=await master_shop[_0x48744f(0x1c3)]();console['log'](_0x48744f(0x15c),_0x164373);const _0x21fb41=_0x145470['params']['id'],_0x56ba0d=await sales[_0x48744f(0x14b)](_0x21fb41);console[_0x48744f(0x15e)]('barcode\x20user_id',_0x56ba0d);if(_0x164373[0x0][_0x48744f(0xe4)]==_0x48744f(0x1c8))var _0x21090f=users[_0x48744f(0x123)];else{if(_0x164373[0x0]['language']==_0x48744f(0x18e))var _0x21090f=users[_0x48744f(0x18e)];else{if(_0x164373[0x0][_0x48744f(0xe4)]==_0x48744f(0x1c4))var _0x21090f=users[_0x48744f(0x1c4)];else{if(_0x164373[0x0][_0x48744f(0xe4)]==_0x48744f(0x184))var _0x21090f=users[_0x48744f(0x184)];else{if(_0x164373[0x0][_0x48744f(0xe4)]==_0x48744f(0x1a5))var _0x21090f=users['French'];else{if(_0x164373[0x0]['language']=='Portuguese\x20(BR)')var _0x21090f=users[_0x48744f(0x178)];else{if(_0x164373[0x0][_0x48744f(0xe4)]==_0x48744f(0x18a))var _0x21090f=users[_0x48744f(0x18a)];else{if(_0x164373[0x0]['language']==_0x48744f(0x126))var _0x21090f=users[_0x48744f(0xeb)];}}}}}}}_0x5b3e7b[_0x48744f(0x1d5)](_0x48744f(0x1b2),{'success':_0x145470[_0x48744f(0x142)]('success'),'errors':_0x145470[_0x48744f(0x142)](_0x48744f(0x160)),'role':_0x13f55b,'profile':_0x1573f6,'alldata':_0x56ba0d,'master_shop':_0x164373,'language':_0x21090f});}catch(_0x2f4ee2){console[_0x48744f(0x15e)](_0x2f4ee2);}}),router[a0_0x3827f5(0x146)]('/barcode_scanner',async(_0x242422,_0x41ae91)=>{var _0xb3447=a0_0x3827f5;const {product_code:_0x210f64,warehouse_name:_0x53e075,rooms_data:_0x45a3e0,Roomslist:_0x37d554}=_0x242422['body'],_0xb9d22b=_0x37d554[_0xb3447(0x154)](','),_0x4814aa=[];async function _0x59bc01(_0x1bd9ba){var _0x625d5=_0xb3447;const _0x2f8816=await warehouse[_0x625d5(0x164)]([{'$match':{'name':_0x53e075,'room':_0x1bd9ba}},{'$unwind':_0x625d5(0xc9)},{'$match':{'product_details.primary_code':_0x210f64}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x625d5(0x101)},'product_stock':{'$first':_0x625d5(0x1b0)},'primary_code':{'$first':_0x625d5(0x172)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x625d5(0x1d4)},'level':{'$first':_0x625d5(0x171)},'isle':{'$first':_0x625d5(0x151)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x625d5(0x17b)},'unit':{'$first':_0x625d5(0xe7)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x625d5(0x13e)},'rack':{'$first':_0x625d5(0xd6)},'expiry_date':{'$first':_0x625d5(0x1a6)},'production_date':{'$first':_0x625d5(0x10b)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x625d5(0x1ac)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x12e17f=await warehouse[_0x625d5(0x164)]([{'$match':{'name':_0x53e075,'room':_0x1bd9ba}},{'$unwind':_0x625d5(0xc9)},{'$match':{'product_details.secondary_code':_0x210f64}},{'$group':{'_id':_0x625d5(0xc7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x625d5(0x1b0)},'primary_code':{'$first':_0x625d5(0x172)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x625d5(0x1d4)},'level':{'$first':_0x625d5(0x171)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x625d5(0x17b)},'unit':{'$first':_0x625d5(0xe7)},'secondary_unit':{'$first':_0x625d5(0x150)},'storage':{'$first':_0x625d5(0x13e)},'rack':{'$first':_0x625d5(0xd6)},'expiry_date':{'$first':_0x625d5(0x1a6)},'production_date':{'$first':_0x625d5(0x10b)},'maxPerUnit':{'$first':_0x625d5(0x148)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x625d5(0x198)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x625d5(0xfc)}}}]);if(_0x2f8816[_0x625d5(0x1bf)]>0x0)_0x4814aa['push'](_0x2f8816);else _0x12e17f[_0x625d5(0x1bf)]>0x0&&_0x4814aa[_0x625d5(0x120)](_0x12e17f);}const _0x4a9250=_0xb9d22b[_0xb3447(0x12e)](_0x497e39=>_0x59bc01(_0x497e39));await Promise[_0xb3447(0x19f)](_0x4a9250),_0x41ae91['json'](_0x4814aa);}),module[a0_0x3827f5(0x17e)]=router;