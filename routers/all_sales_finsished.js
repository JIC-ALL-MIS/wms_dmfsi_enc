var a0_0x2afbb8=a0_0x3a22;(function(_0x116782,_0x24e3a3){var _0x191c66=a0_0x3a22,_0x11a2a4=_0x116782();while(!![]){try{var _0x31f36d=parseInt(_0x191c66(0x18e))/0x1+parseInt(_0x191c66(0x1f5))/0x2*(parseInt(_0x191c66(0x1f3))/0x3)+parseInt(_0x191c66(0xfe))/0x4*(parseInt(_0x191c66(0xf7))/0x5)+-parseInt(_0x191c66(0x182))/0x6+parseInt(_0x191c66(0x15a))/0x7+-parseInt(_0x191c66(0x1d4))/0x8+-parseInt(_0x191c66(0x1c9))/0x9*(parseInt(_0x191c66(0x1e0))/0xa);if(_0x31f36d===_0x24e3a3)break;else _0x11a2a4['push'](_0x11a2a4['shift']());}catch(_0x458bae){_0x11a2a4['push'](_0x11a2a4['shift']());}}}(a0_0x4f23,0xf121c));const express=require(a0_0x2afbb8(0x16c)),app=express(),router=express[a0_0x2afbb8(0x1ed)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x2afbb8(0x134)),users=require(a0_0x2afbb8(0x125));function a0_0x4f23(){var _0x1b8201=['express','\x20&&\x20','batch_code_QA','French','all_sales_finished','$product_details.type','currency_placement','edit_sales_finished','customer_data','$product_details.storage','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<html><head><title></title>','Received\x20Payment\x20For\x20Sale','Arabic\x20(ae)','batch_code','$product_details.primary_code','slice','Sale\x20Return','catch','<hr\x20class=\x22my-3\x22>','sale_qty','primary_unit','4638738YgszHv','English\x20(US)','language','/upload/','all','$product_details','getFullYear','return_qty_QA','body','<div>','<strong>\x20Regards\x20</strong>','Hindi','226574bnzrfk','then','back','$product_details.bay','prod_code','RoomAssigned','$product_details.floorlevel','return_data','error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','for_categorize','staff','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$customer','$product.product_name','secondary_code_QA','product_details','secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','date','</head><body>','An\x20error\x20occurred.','$product_details.product_name','exports','</body></html>','payment\x20successfull','invoice','string','christian.villamer@jakagroup.com','user','\x20Order\x20Date\x20:\x20','maxperunit','</thead>','maxProducts_QA','/barcode_scanner','English','production_date_QA','flash','unit_QA','customer','filter','Spanish','/view/add_sales','image','$product_details.product_cat','params','Quality\x20Inspection','/view/:id','product_code_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','findById','/all_sales_finished/preview/','maxPerUnit_QA','$product_details.secondary_unit','sales_invoice','QA\x20Warehouse','add\x20post','</h5>','2007FXnVUb','$sale_product.bay','$product_details.secondary_code','max_per_unit','push','$sale_product.quantity','return_sale_finished','product_stock','product_data','$product_details.invoice','logo','7846232YkAfpK','$product_details.rack','<!DOCTYPE\x20html>','Sale\x20Return\x20Mail','$product_details._id','Add\x20Sales','<span\x20style=\x22float:\x20right;\x22>','stock','json','FGSEmail','forEach','warehouse_name','72530KfuMjr','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','site_title','expiry_date_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','status','$product_details.bin','$product_details.product_code','amount','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','add_sales_finished','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Router','return_qty','message','$date','production_date','True','846aRmFdC','random','11324EuMxxN','/preview/:id','Portuguese','redirect','stocks_QA','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product','\x20</h2>','length','quantity','product_name','$product_details.maxProducts','errors','\x20Order\x20Number\x20:\x20','master','\x20==\x20','finalize','</tr>','OUTF-','<h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/all_sales/view','Chinese','</tbody>','<h5\x20style=\x22text-align:\x20left;\x22>','<h2>\x20','received_amount','\x20<>\x20','gmail','maxPerUnit','$product_details.production_date','Return\x20Rooms','secondary_unit_QA','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$sale_product.floorlevel','return_sale','Arabic','5TWOHRu','</table>','$name','post','level','render','sales_quantity','3421156BkspSe','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','password','map','purchases_data','id_transaction_from','$product_details.room_name','sales_quantity_QA','split','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.unit','Finished\x20Goods','room','email','$sale_product.bin','prod_cat','warehouse','Enclosed','primary_code_QA','suppliers','ADD\x20SALE','edit_sales_finished_view','German','room_name','product_code','return_sale_QA','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Portuguese\x20(BR)','customers_docs','get','barcode\x20user_id','name','product_list','\x20<<<==>>>\x20','$product_details.batch_code','Sales\x20Mail','$warehouse_name','currency','abs','../public/language/languages.json','bay','maxProducts','False','Error\x20Occurs','$product_details.maxPerUnit','Email\x20sent\x20successfully','/view/add_sale/product','carton','expiry_date','/give_payment/:id','secondary_code','$product_details.expiry_date','aggregate','$room','nodemailer','all_sales_barcode','</td>','$product_details.product_stock','getMonth','createTransport','save','Ambient','/view/return_sales/:id','/invoice/:id','log','padStart','port','concat','$return_data','host','$finalize','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$sale_product.type','stock_data','$_id','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','</span>','unit','findOne','/view/add_sales/:id','/all_sales_finished/view','</div>','$note','$customers_docs','find','Enabled','product','product_name_QA1','role','Sales\x20Update\x20successfully','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','sales\x20item\x20return\x20successfull','11763150GUJFNn','foreach\x20newproduct','/picking_list/pdf/','DRY\x20GOODS','max','final','$sale_product','/../public','product_date','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','sendMail','_id','$invoice','sale_product','customers','Sale','<tr>','success'];a0_0x4f23=function(){return _0x1b8201;};return a0_0x4f23();}function a0_0x3a22(_0x4770b5,_0x2a1a4c){var _0x4f2314=a0_0x4f23();return a0_0x3a22=function(_0x3a226e,_0x113a7a){_0x3a226e=_0x3a226e-0xe2;var _0x3c5b91=_0x4f2314[_0x3a226e];return _0x3c5b91;},a0_0x3a22(_0x4770b5,_0x2a1a4c);}router[a0_0x2afbb8(0x11b)]('/view',auth,async(_0x37d8cd,_0x218eb8)=>{var _0x1c4722=a0_0x2afbb8;try{const {username:_0x2bc9e4,email:_0x287d79,role:_0x28dd0f}=_0x37d8cd[_0x1c4722(0x1ac)],_0xb6ec29=_0x37d8cd['user'],_0x18089d=await profile[_0x1c4722(0x14c)]({'email':_0xb6ec29['email']}),_0x3b71f2=await master_shop[_0x1c4722(0x152)]();let _0x4e735c;if(_0xb6ec29[_0x1c4722(0x156)]=='staff'){const _0x2d115b=await staff[_0x1c4722(0x14c)]({'email':_0xb6ec29[_0x1c4722(0x10b)]});_0x4e735c=await sales_finished[_0x1c4722(0x132)]([{'$lookup':{'from':_0x1c4722(0x168),'localField':'customer','foreignField':'name','as':'customers_docs'}},{'$unwind':_0x1c4722(0x151)},{'$unwind':_0x1c4722(0x160)},{'$group':{'_id':_0x1c4722(0x148),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x1c4722(0x19c)},'date':{'$first':_0x1c4722(0x1f0)},'warehouse_name':{'$first':_0x1c4722(0x122)},'sale_product':{'$push':_0x1c4722(0x160)},'note':{'$first':_0x1c4722(0x150)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x1c4722(0x1ca)},'isle':{'$addToSet':_0x1c4722(0x10c)},'type':{'$addToSet':_0x1c4722(0x146)},'pallet':{'$addToSet':_0x1c4722(0xf4)},'finalize':{'$first':_0x1c4722(0x144)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x4e735c=await sales_finished[_0x1c4722(0x132)]([{'$lookup':{'from':_0x1c4722(0x168),'localField':_0x1c4722(0x1b6),'foreignField':_0x1c4722(0x11d),'as':_0x1c4722(0x11a)}},{'$unwind':'$customers_docs'},{'$unwind':_0x1c4722(0x160)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1c4722(0x166)},'customers':{'$first':_0x1c4722(0x19c)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1c4722(0x122)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x1c4722(0x150)},'return_data':{'$first':_0x1c4722(0x142)},'customers_docs':{'$first':_0x1c4722(0x151)},'total_saleproduct_quantity':{'$sum':_0x1c4722(0x1ce)},'level':{'$addToSet':_0x1c4722(0x1ca)},'isle':{'$addToSet':_0x1c4722(0x10c)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x1c4722(0xf4)},'finalize':{'$first':_0x1c4722(0x144)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x3b71f2[0x0][_0x1c4722(0x184)]==_0x1c4722(0x183)){var _0x4d1eea=users['English'];console[_0x1c4722(0x13e)](_0x4d1eea);}else{if(_0x3b71f2[0x0][_0x1c4722(0x184)]=='Hindi')var _0x4d1eea=users[_0x1c4722(0x18d)];else{if(_0x3b71f2[0x0][_0x1c4722(0x184)]==_0x1c4722(0x114))var _0x4d1eea=users[_0x1c4722(0x114)];else{if(_0x3b71f2[0x0][_0x1c4722(0x184)]=='Spanish')var _0x4d1eea=users[_0x1c4722(0x1b8)];else{if(_0x3b71f2[0x0][_0x1c4722(0x184)]==_0x1c4722(0x16f))var _0x4d1eea=users[_0x1c4722(0x16f)];else{if(_0x3b71f2[0x0]['language']==_0x1c4722(0x119))var _0x4d1eea=users[_0x1c4722(0x1f7)];else{if(_0x3b71f2[0x0]['language']=='Chinese')var _0x4d1eea=users[_0x1c4722(0xe7)];else{if(_0x3b71f2[0x0][_0x1c4722(0x184)]==_0x1c4722(0x179))var _0x4d1eea=users[_0x1c4722(0xf6)];}}}}}}}_0x218eb8[_0x1c4722(0xfc)](_0x1c4722(0x170),{'success':_0x37d8cd[_0x1c4722(0x1b4)]('success'),'errors':_0x37d8cd[_0x1c4722(0x1b4)](_0x1c4722(0x201)),'sales':_0x4e735c,'profile':_0x18089d,'role':_0xb6ec29,'master_shop':_0x3b71f2,'language':_0x4d1eea});}catch(_0x4d34d6){console[_0x1c4722(0x13e)](_0x4d34d6);}});async function getRandom8DigitNumber(){var _0x4b99f6=a0_0x2afbb8;const _0x3fa0b1=0x989680,_0x35bec8=0x5f5e0ff,_0x365b64=Math['floor'](Math[_0x4b99f6(0x1f4)]()*(_0x35bec8-_0x3fa0b1+0x1))+_0x3fa0b1;var _0x370e08;const _0x1fc42d=await sales_finished['findOne']({'invoice':_0x4b99f6(0xe3)+_0x365b64});return _0x1fc42d&&_0x1fc42d[_0x4b99f6(0x1fd)]>0x0?_0x370e08=_0x4b99f6(0xe3)+_0x365b64:_0x370e08=_0x4b99f6(0xe3)+_0x365b64,_0x370e08;}router[a0_0x2afbb8(0x11b)]('/view/add_sales',auth,async(_0x43de2f,_0x40b1be)=>{var _0x17fbad=a0_0x2afbb8;try{const {username:_0x135940,email:_0xb39a8e,role:_0x57407a}=_0x43de2f['user'],_0x476764=_0x43de2f[_0x17fbad(0x1ac)],_0x156ae0=await profile['findOne']({'email':_0x476764[_0x17fbad(0x10b)]}),_0x537207=await master_shop[_0x17fbad(0x152)](),_0x24cc74=await customer[_0x17fbad(0x152)]({});let _0x371bfe;if(_0x476764[_0x17fbad(0x156)]=='staff'){const _0xd3a68a=await staff[_0x17fbad(0x14c)]({'email':_0x476764[_0x17fbad(0x10b)]});_0x371bfe=await warehouse[_0x17fbad(0x132)]([{'$match':{'status':_0x17fbad(0x153),'name':_0xd3a68a[_0x17fbad(0x10e)],'warehouse_category':_0x17fbad(0x109),'name':{'$ne':_0x17fbad(0x1c6)}}},{'$group':{'_id':_0x17fbad(0xf9),'name':{'$first':_0x17fbad(0xf9)}}},{'$sort':{'name':0x1}}]);}else _0x371bfe=await warehouse[_0x17fbad(0x132)]([{'$match':{'status':'Enabled','warehouse_category':_0x17fbad(0x109),'name':{'$ne':_0x17fbad(0x1c6)}}},{'$group':{'_id':_0x17fbad(0xf9),'name':{'$first':_0x17fbad(0xf9)}}},{'$sort':{'name':0x1}}]);const _0x5117a0=await product['find']({});var _0x511b3b=[_0x17fbad(0x13b),_0x17fbad(0x10f)];const _0x396423=await sales_finished[_0x17fbad(0x152)]({}),_0x55420f=_0x396423[_0x17fbad(0x1fd)]+0x1,_0x533229=_0x17fbad(0xe3)+_0x55420f['toString']()[_0x17fbad(0x13f)](0x5,'0');if(_0x537207[0x0][_0x17fbad(0x184)]=='English\x20(US)'){var _0x342bcf=users[_0x17fbad(0x1b2)];console[_0x17fbad(0x13e)](_0x342bcf);}else{if(_0x537207[0x0][_0x17fbad(0x184)]==_0x17fbad(0x18d))var _0x342bcf=users['Hindi'];else{if(_0x537207[0x0][_0x17fbad(0x184)]==_0x17fbad(0x114))var _0x342bcf=users[_0x17fbad(0x114)];else{if(_0x537207[0x0]['language']==_0x17fbad(0x1b8))var _0x342bcf=users[_0x17fbad(0x1b8)];else{if(_0x537207[0x0]['language']=='French')var _0x342bcf=users['French'];else{if(_0x537207[0x0][_0x17fbad(0x184)]==_0x17fbad(0x119))var _0x342bcf=users[_0x17fbad(0x1f7)];else{if(_0x537207[0x0][_0x17fbad(0x184)]==_0x17fbad(0xe7))var _0x342bcf=users['Chinese'];else{if(_0x537207[0x0][_0x17fbad(0x184)]=='Arabic\x20(ae)')var _0x342bcf=users[_0x17fbad(0xf6)];}}}}}}}const _0x56e961=getRandom8DigitNumber();_0x56e961[_0x17fbad(0x18f)](_0x1a7fdd=>{var _0x43c2c3=_0x17fbad;_0x40b1be[_0x43c2c3(0xfc)](_0x43c2c3(0x1eb),{'success':_0x43de2f[_0x43c2c3(0x1b4)]('success'),'errors':_0x43de2f['flash'](_0x43c2c3(0x201)),'role':_0x476764,'profile':_0x156ae0,'customer':_0x24cc74,'warehouse':_0x371bfe,'product':_0x5117a0,'invoice':_0x1a7fdd,'master_shop':_0x537207,'language':_0x342bcf,'rooms_data':_0x511b3b});})['catch'](_0x480e65=>{var _0x833dd=_0x17fbad;_0x43de2f[_0x833dd(0x1b4)](_0x833dd(0x201),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x40b1be[_0x833dd(0x1f8)](_0x833dd(0x14e));});}catch(_0x15371b){console[_0x17fbad(0x13e)](_0x15371b);}}),router[a0_0x2afbb8(0x11b)](a0_0x2afbb8(0x14d),auth,async(_0x2a529e,_0x37b2cf)=>{var _0x322428=a0_0x2afbb8;try{const _0x55f702=_0x2a529e['params']['id'];console[_0x322428(0x13e)](_0x55f702);const _0x56132c=await product[_0x322428(0x152)](),_0x1d2432=await purchases[_0x322428(0x132)]([{'$match':{'warehouse_name':_0x55f702}},{'$unwind':_0x322428(0x1fb)},{'$group':{'_id':_0x322428(0x19d)}}]);console[_0x322428(0x13e)](_0x322428(0x102),_0x1d2432),_0x37b2cf['status'](0xc8)[_0x322428(0x1dc)]({'purchases_data':_0x1d2432,'product_data':_0x56132c});}catch(_0x491e33){console['log'](_0x491e33);}}),router['post'](a0_0x2afbb8(0x12c),auth,async(_0x1e8a16,_0x1c00db)=>{var _0x2adc57=a0_0x2afbb8;try{const {warehouse_data:_0x148790,product_data:_0x59094c}=_0x1e8a16[_0x2adc57(0x18a)];console[_0x2adc57(0x13e)](_0x1e8a16[_0x2adc57(0x18a)][_0x2adc57(0x1d1)]);;const _0x3e63cb=await master_shop['find']();console[_0x2adc57(0x13e)]('master',_0x3e63cb);const _0x1c0b3a=await product[_0x2adc57(0x14c)]({'name':_0x59094c});console[_0x2adc57(0x13e)](_0x2adc57(0x154),_0x1c0b3a);const _0x2651f8=await warehouse[_0x2adc57(0x132)]([{'$match':{'name':_0x148790}},{'$unwind':_0x2adc57(0x187)},{'$match':{'product_details.product_name':_0x59094c}},{'$group':{'_id':_0x2adc57(0x1a5),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x2adc57(0x13e)](_0x2adc57(0x147),_0x2651f8),_0x1c00db[_0x2adc57(0x1e5)](0xc8)[_0x2adc57(0x1dc)]({'master':_0x3e63cb,'new_product':_0x1c0b3a,'stock_data':_0x2651f8});}catch(_0x5da773){console['log'](_0x5da773);}}),router[a0_0x2afbb8(0xfa)](a0_0x2afbb8(0x1b9),auth,async(_0x12ce52,_0x126be1)=>{var _0x10df4f=a0_0x2afbb8;try{const {invoice:_0x1ade3a,date:_0x4db81c,warehouse_name:_0x110208,product_name:_0x1d0c03,stock:_0x14b6c2,quantity:_0x43885e,note:_0x4253b8,room:_0x4cfc1e,primary_code:_0x4f0c15,secondary_code:_0x51caa7,prod_code:_0xb36f77,level:_0x50e923,isle:_0x903580,pallet:_0x3e7a6b,batch_code:_0x3673ba,SCRN:_0x1bc025,expiry_date:_0x46dbdf,mode_transpo:_0x3e08d4,name_driver:_0x1aa065}=_0x12ce52[_0x10df4f(0x18a)];if(typeof _0x1d0c03==_0x10df4f(0x1aa))var _0x3e7f5f=[_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x1ff)]],_0x14fd8d=[_0x12ce52[_0x10df4f(0x18a)]['stock']],_0x106a47=[_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x12d)]],_0x461d27=[_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0xf2)]],_0x2c67d7=[_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x130)]],_0x37dd8d=[_0x12ce52[_0x10df4f(0x18a)]['prod_code']],_0x54ccfb=[_0x12ce52[_0x10df4f(0x18a)]['level']],_0x458ac6=[_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x181)]],_0x2a7132=[_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x1a0)]],_0x473baf=[_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x17a)]],_0x5824ea=[_0x12ce52['body'][_0x10df4f(0x12e)]],_0x20e8a7=[_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x162)]],_0x3a0723=[_0x12ce52['body'][_0x10df4f(0x1cc)]],_0xd6b8=[_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x10d)]],_0x1bca39=[_0x12ce52['body'][_0x10df4f(0x193)]],_0x3ac99c=[_0x12ce52[_0x10df4f(0x18a)]['prod_invoice']],_0x21374=[_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x103)]];else var _0x3e7f5f=[..._0x12ce52['body'][_0x10df4f(0x1ff)]],_0x14fd8d=[..._0x12ce52['body'][_0x10df4f(0x1db)]],_0x106a47=[..._0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x12d)]],_0x461d27=[..._0x12ce52[_0x10df4f(0x18a)]['primary_code']],_0x2c67d7=[..._0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x130)]],_0x37dd8d=[..._0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x192)]],_0x54ccfb=[..._0x12ce52[_0x10df4f(0x18a)]['level']],_0x458ac6=[..._0x12ce52['body'][_0x10df4f(0x181)]],_0x2a7132=[..._0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x1a0)]],_0x473baf=[..._0x12ce52['body'][_0x10df4f(0x17a)]],_0x5824ea=[..._0x12ce52['body'][_0x10df4f(0x12e)]],_0x20e8a7=[..._0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x162)]],_0x3a0723=[..._0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x1cc)]],_0xd6b8=[..._0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x10d)]],_0x1bca39=[..._0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x193)]],_0x3ac99c=[..._0x12ce52[_0x10df4f(0x18a)]['prod_invoice']],_0x21374=[..._0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x103)]];const _0x40662a=_0x3e7f5f[_0x10df4f(0x101)](_0x2c70ec=>{return _0x2c70ec={'product_name':_0x2c70ec};});_0x14fd8d[_0x10df4f(0x1de)]((_0x16ea55,_0x462b94)=>{_0x40662a[_0x462b94]['stock']=_0x16ea55;}),_0x106a47[_0x10df4f(0x1de)]((_0x15b1a4,_0x1259d9)=>{var _0x2d51ea=_0x10df4f;_0x40662a[_0x1259d9][_0x2d51ea(0x1fe)]=Math[_0x2d51ea(0x124)](_0x15b1a4);}),_0x21374[_0x10df4f(0x1de)]((_0xc553a5,_0x5adf72)=>{var _0x1da556=_0x10df4f;_0x40662a[_0x5adf72][_0x1da556(0x103)]=_0xc553a5;}),_0x461d27[_0x10df4f(0x1de)]((_0x50f153,_0x203d62)=>{var _0x4ca807=_0x10df4f;_0x40662a[_0x203d62][_0x4ca807(0xf2)]=_0x50f153;}),_0x2c67d7[_0x10df4f(0x1de)]((_0x414031,_0x3defd2)=>{var _0x499dc8=_0x10df4f;_0x40662a[_0x3defd2][_0x499dc8(0x130)]=_0x414031;}),_0x37dd8d[_0x10df4f(0x1de)]((_0x360ea9,_0x210876)=>{var _0x116f08=_0x10df4f;_0x40662a[_0x210876][_0x116f08(0x116)]=_0x360ea9;}),_0x54ccfb['forEach']((_0x25a36f,_0x1c0b0b)=>{_0x40662a[_0x1c0b0b]['bay']=_0x25a36f;}),_0x458ac6['forEach']((_0x5ebca0,_0x5e6ee4)=>{var _0x5f093a=_0x10df4f;_0x40662a[_0x5e6ee4][_0x5f093a(0x14b)]=_0x5ebca0;}),_0x2a7132[_0x10df4f(0x1de)]((_0x2b8cae,_0x5f5804)=>{var _0x2898a4=_0x10df4f;_0x40662a[_0x5f5804][_0x2898a4(0x1a0)]=_0x2b8cae;}),_0x473baf[_0x10df4f(0x1de)]((_0x290bd0,_0x42e5f0)=>{var _0x40fa24=_0x10df4f;_0x40662a[_0x42e5f0][_0x40fa24(0x17a)]=_0x290bd0;}),_0x5824ea[_0x10df4f(0x1de)]((_0x17b2f6,_0x5814e5)=>{var _0x1c2b3a=_0x10df4f;_0x40662a[_0x5814e5][_0x1c2b3a(0x12e)]=_0x17b2f6;}),_0x20e8a7['forEach']((_0x115a38,_0x1ecaa5)=>{var _0x5bbda1=_0x10df4f;_0x40662a[_0x1ecaa5][_0x5bbda1(0x1f1)]=_0x115a38;}),_0x3a0723['forEach']((_0x20f4bc,_0x3d49f8)=>{var _0x2ea068=_0x10df4f;_0x40662a[_0x3d49f8][_0x2ea068(0x1ae)]=_0x20f4bc;}),_0xd6b8[_0x10df4f(0x1de)]((_0x57a31d,_0x2c0ba2)=>{var _0x33a749=_0x10df4f;_0x40662a[_0x2c0ba2][_0x33a749(0x10d)]=_0x57a31d;}),_0x1bca39['forEach']((_0x22e477,_0x6f110a)=>{var _0x2bceff=_0x10df4f;_0x40662a[_0x6f110a][_0x2bceff(0x115)]=_0x22e477;}),_0x3ac99c[_0x10df4f(0x1de)]((_0x4608fa,_0x2167a9)=>{_0x40662a[_0x2167a9]['invoice']=_0x4608fa;});var _0x3cf877=0x0;_0x40662a[_0x10df4f(0x1de)](_0x377e20=>{var _0x1e2eb3=_0x10df4f;parseFloat(_0x377e20[_0x1e2eb3(0x1db)])<parseFloat(_0x377e20[_0x1e2eb3(0x1fe)])&&parseFloat(_0x377e20['quantity'])>parseFloat(_0x377e20[_0x1e2eb3(0x1db)])&&(console[_0x1e2eb3(0x13e)](_0x377e20[_0x1e2eb3(0x1db)]+_0x1e2eb3(0xec)+_0x377e20[_0x1e2eb3(0x1fe)]),_0x3cf877++);});if(_0x3cf877!=0x0)return _0x12ce52[_0x10df4f(0x1b4)](_0x10df4f(0x201),_0x10df4f(0x149)),_0x126be1[_0x10df4f(0x1f8)](_0x10df4f(0x190));const _0x1d1d40=_0x40662a[_0x10df4f(0x1b7)](_0x68e00b=>_0x68e00b[_0x10df4f(0x1fe)]!=='0'&&_0x68e00b[_0x10df4f(0x1fe)]!==''),_0x5e5b6d=new sales_finished({'invoice':_0x1ade3a,'customer':_0x12ce52[_0x10df4f(0x18a)][_0x10df4f(0x1b6)],'date':_0x4db81c,'warehouse_name':_0x110208,'sale_product':_0x1d1d40,'note':_0x4253b8,'room':_0x4cfc1e,'primary_code':_0x4f0c15,'secondary_code':_0x51caa7,'prod_code':_0xb36f77,'SCRN':_0x1bc025,'finalize':_0x10df4f(0x128),'mode_transpo':_0x3e08d4,'name_driver':_0x1aa065}),_0x1af9d1=await _0x5e5b6d['save'](),_0x468892=await sales_finished[_0x10df4f(0x14c)]({'invoice':_0x1ade3a}),_0x31448a=new c_payment_data({'invoice':_0x1ade3a,'customer':_0x12ce52[_0x10df4f(0x18a)]['customer'],'reason':_0x10df4f(0x169)});await _0x31448a[_0x10df4f(0x13a)]();const _0x3a1414=await master_shop['find'](),_0x23b233=await email_settings[_0x10df4f(0x14c)](),_0x1fb365=await customer['findOne']({'name':_0x12ce52['body'][_0x10df4f(0x1b6)]});_0x3a1414[0x0][_0x10df4f(0x172)]==0x1?(right_currency=_0x3a1414[0x0][_0x10df4f(0x123)],left_currency=''):(right_currency='',left_currency=_0x3a1414[0x0]['currency']);var _0x38557a=_0x3e7f5f,_0x2ae9c0=_0x106a47,_0x5dd8ba='',_0x657b3c;for(_0x657b3c in _0x38557a){_0x5dd8ba+=_0x10df4f(0x16a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x38557a[_0x657b3c]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2ae9c0[_0x657b3c]+_0x10df4f(0x136)+_0x10df4f(0xe2);}console[_0x10df4f(0x13e)](_0x10df4f(0x11e),_0x5dd8ba);let _0x2ed877=nodemailer[_0x10df4f(0x139)]({'host':_0x23b233[_0x10df4f(0x143)],'port':Number(_0x23b233[_0x10df4f(0x140)]),'secure':![],'service':_0x10df4f(0xed),'auth':{'user':_0x23b233[_0x10df4f(0x10b)],'pass':_0x23b233[_0x10df4f(0x100)]}}),_0x3e4e90={'from':_0x23b233[_0x10df4f(0x10b)],'to':_0x10df4f(0x1ab),'subject':_0x10df4f(0x1d9),'attachments':[{'filename':_0x10df4f(0x1e9),'path':__dirname+_0x10df4f(0x161)+_0x10df4f(0x185)+_0x3a1414[0x0]['image'],'cid':_0x10df4f(0x1d3)}],'html':_0x10df4f(0x112)};_0x2ed877[_0x10df4f(0x164)](_0x3e4e90,function(_0x23ccf7,_0xd4334a){var _0x4f033e=_0x10df4f;_0x23ccf7?(console['log'](_0x23ccf7),console['log'](_0x4f033e(0x129))):console['log'](_0x4f033e(0x12b));}),_0x12ce52[_0x10df4f(0x1b4)]('success','Sales\x20Add\x20successfully'),_0x126be1['redirect'](_0x10df4f(0x1c2)+_0x1af9d1['_id']);}catch(_0x2a1727){console['log'](_0x2a1727);}}),router['get'](a0_0x2afbb8(0x1f6),auth,async(_0x1511b0,_0x28f401)=>{var _0x38b2cb=a0_0x2afbb8;try{const {username:_0x2f875d,email:_0x2cbdfe,role:_0x51f025}=_0x1511b0[_0x38b2cb(0x1ac)],_0xf55917=_0x1511b0[_0x38b2cb(0x1ac)],_0xd80a7d=await profile['findOne']({'email':_0xf55917[_0x38b2cb(0x10b)]}),_0x2dffa5=await master_shop[_0x38b2cb(0x152)](),_0x321483=_0x1511b0['params']['id'],_0x23a635=await sales_finished['findById'](_0x321483),_0x5a4d29=await warehouse['aggregate']([{'$match':{'name':_0x23a635[_0x38b2cb(0x1df)]}},{'$unwind':_0x38b2cb(0x187)},{'$group':{'_id':_0x38b2cb(0x1d8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x38b2cb(0x137)},'bay':{'$first':_0x38b2cb(0x191)},'bin':{'$first':_0x38b2cb(0x1e6)},'type':{'$first':_0x38b2cb(0x171)},'floorlevel':{'$first':_0x38b2cb(0x194)},'primary_code':{'$first':_0x38b2cb(0x17b)},'secondary_code':{'$first':_0x38b2cb(0x1cb)},'product_code':{'$first':_0x38b2cb(0x1e7)},'storage':{'$first':_0x38b2cb(0x175)},'rack':{'$first':_0x38b2cb(0x1d5)},'expiry_date':{'$first':_0x38b2cb(0x131)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x38b2cb(0x120)},'room':{'$first':_0x38b2cb(0x133)},'room_data':{'$first':_0x38b2cb(0x104)}}}]),_0x344160=await customer['find']({});let _0xf250b2;if(_0xf55917[_0x38b2cb(0x156)]==_0x38b2cb(0x199)){const _0x14de74=await staff['findOne']({'email':_0xf55917[_0x38b2cb(0x10b)]});_0xf250b2=await warehouse[_0x38b2cb(0x132)]([{'$match':{'status':_0x38b2cb(0x153),'name':_0x14de74[_0x38b2cb(0x10e)]}},{'$group':{'_id':_0x38b2cb(0xf9),'name':{'$first':_0x38b2cb(0xf9)}}}]);}else _0xf250b2=await warehouse['aggregate']([{'$match':{'status':_0x38b2cb(0x153)}},{'$group':{'_id':_0x38b2cb(0xf9),'name':{'$first':_0x38b2cb(0xf9)}}}]);const _0x385bae=await product[_0x38b2cb(0x152)]({});if(_0x2dffa5[0x0]['language']=='English\x20(US)'){var _0x191cb3=users[_0x38b2cb(0x1b2)];console[_0x38b2cb(0x13e)](_0x191cb3);}else{if(_0x2dffa5[0x0]['language']==_0x38b2cb(0x18d))var _0x191cb3=users[_0x38b2cb(0x18d)];else{if(_0x2dffa5[0x0]['language']==_0x38b2cb(0x114))var _0x191cb3=users['German'];else{if(_0x2dffa5[0x0][_0x38b2cb(0x184)]==_0x38b2cb(0x1b8))var _0x191cb3=users[_0x38b2cb(0x1b8)];else{if(_0x2dffa5[0x0]['language']==_0x38b2cb(0x16f))var _0x191cb3=users['French'];else{if(_0x2dffa5[0x0]['language']==_0x38b2cb(0x119))var _0x191cb3=users[_0x38b2cb(0x1f7)];else{if(_0x2dffa5[0x0][_0x38b2cb(0x184)]=='Chinese')var _0x191cb3=users[_0x38b2cb(0xe7)];else{if(_0x2dffa5[0x0][_0x38b2cb(0x184)]==_0x38b2cb(0x179))var _0x191cb3=users[_0x38b2cb(0xf6)];}}}}}}}_0x28f401[_0x38b2cb(0xfc)](_0x38b2cb(0x113),{'success':_0x1511b0['flash']('success'),'errors':_0x1511b0[_0x38b2cb(0x1b4)](_0x38b2cb(0x201)),'role':_0xf55917,'profile':_0xd80a7d,'customer':_0x344160,'warehouse':_0xf250b2,'product':_0x5a4d29,'user':_0x23a635,'master_shop':_0x2dffa5,'unit':_0x385bae,'language':_0x191cb3});}catch(_0x4aed34){console['log'](_0x4aed34);}}),router[a0_0x2afbb8(0xfa)](a0_0x2afbb8(0x1f6),auth,async(_0x3f08ee,_0x3d2275)=>{var _0x335bb1=a0_0x2afbb8;try{const _0x296f54=_0x3f08ee[_0x335bb1(0x1bc)]['id'],{invoice:_0x409e2c,warehouse_name:_0x260108,room:_0x21b053}=_0x3f08ee[_0x335bb1(0x18a)],_0x306c0c=await sales_finished[_0x335bb1(0x14c)]({'invoice':_0x409e2c}),_0x5780ab=_0x306c0c['sale_product']['map'](async _0x47b118=>{var _0x387554=_0x335bb1,_0x488b30=await warehouse[_0x387554(0x14c)]({'name':_0x260108,'room':_0x47b118[_0x387554(0x115)],'warehouse_category':_0x387554(0x109)});const _0x35d324=_0x488b30[_0x387554(0x19f)][_0x387554(0x101)](_0x471101=>{var _0x467b74=_0x387554;_0x471101[_0x467b74(0x1ff)]==_0x47b118[_0x467b74(0x1ff)]&&_0x471101[_0x467b74(0x126)]==_0x47b118['bay']&&_0x471101['expiry_date']==_0x47b118[_0x467b74(0x12e)]&&_0x471101[_0x467b74(0x1f1)]==_0x47b118['production_date']&&_0x471101[_0x467b74(0x17a)]==_0x47b118[_0x467b74(0x17a)]&&_0x471101[_0x467b74(0x165)]==_0x47b118[_0x467b74(0x103)]&&(_0x471101[_0x467b74(0x1d0)]>0x0&&(console[_0x467b74(0x13e)](_0x471101['product_name']+_0x467b74(0x204)+_0x47b118[_0x467b74(0x1ff)]+_0x467b74(0x16d)+_0x471101[_0x467b74(0x126)]+_0x467b74(0x204)+_0x47b118[_0x467b74(0x126)]+_0x467b74(0x16d)+_0x471101[_0x467b74(0x1f1)]+'\x20==\x20'+_0x47b118[_0x467b74(0x1f1)]+_0x467b74(0x16d)+_0x471101['expiry_date']+_0x467b74(0x204)+_0x47b118[_0x467b74(0x12e)]+'\x20&&\x20'+_0x471101[_0x467b74(0x17a)]+_0x467b74(0x204)+_0x47b118['batch_code']+_0x467b74(0x16d)+_0x471101[_0x467b74(0x1a9)]+_0x467b74(0x204)+_0x47b118[_0x467b74(0x1a9)]+_0x467b74(0x16d)+_0x471101[_0x467b74(0x1d0)]+_0x467b74(0x11f)+_0x47b118['quantity']+'\x20>>>\x20'+_0x47b118[_0x467b74(0x115)]+_0x467b74(0x16d)+_0x471101[_0x467b74(0x165)]+_0x467b74(0x204)+_0x47b118[_0x467b74(0x103)]),_0x471101['product_stock']=Math[_0x467b74(0x15e)](0x0,Math[_0x467b74(0x124)](_0x471101[_0x467b74(0x1d0)])-Math['abs'](_0x47b118[_0x467b74(0x1fe)]))));});return _0x488b30;});Promise[_0x335bb1(0x186)](_0x5780ab)['then'](async _0x5f0399=>{var _0x4f8782=_0x335bb1;try{for(const _0x221d2a of _0x5f0399){await _0x221d2a['save']();}_0x306c0c[_0x4f8782(0x205)]='True';const _0x1083bc=await _0x306c0c['save'](),_0x51147a=await master_shop[_0x4f8782(0x152)](),_0x17f77a=await email_settings[_0x4f8782(0x14c)](),_0x10a4a9=await supervisor_settings[_0x4f8782(0x152)]();var _0x27a125=_0x306c0c[_0x4f8782(0x167)],_0x4dc8fb='',_0x5499d1;for(_0x5499d1 in _0x27a125){var _0x37b089='FG';_0x306c0c['warehouse_name']==_0x4f8782(0x15d)&&(_0x37b089='DG'),_0x4dc8fb+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x27a125[_0x5499d1][_0x4f8782(0x1ff)]+_0x4f8782(0x136)+_0x4f8782(0x1fa)+_0x27a125[_0x5499d1][_0x4f8782(0x116)]+_0x4f8782(0x136)+_0x4f8782(0x1fa)+_0x27a125[_0x5499d1][_0x4f8782(0x1fe)]+_0x4f8782(0x136)+_0x4f8782(0x1fa)+_0x27a125[_0x5499d1][_0x4f8782(0x14b)]+_0x4f8782(0x136)+_0x4f8782(0x1fa)+_0x27a125[_0x5499d1][_0x4f8782(0x1a0)]+_0x4f8782(0x136)+_0x4f8782(0x1fa)+_0x306c0c[_0x4f8782(0x1df)]+_0x4f8782(0x136)+_0x4f8782(0x1fa)+_0x27a125[_0x5499d1][_0x4f8782(0x115)]+_0x4f8782(0x136)+_0x4f8782(0x1fa)+_0x37b089+_0x27a125[_0x5499d1][_0x4f8782(0x126)]+'</td>';}let _0x2a4d4a=nodemailer[_0x4f8782(0x139)]({'host':_0x17f77a[_0x4f8782(0x143)],'port':Number(_0x17f77a[_0x4f8782(0x140)]),'secure':![],'auth':{'user':_0x17f77a['email'],'pass':_0x17f77a[_0x4f8782(0x100)]}}),_0x50cad3={'from':_0x17f77a['email'],'to':_0x10a4a9[0x0][_0x4f8782(0x1dd)],'subject':_0x4f8782(0x121),'attachments':[{'filename':_0x4f8782(0x1e9),'path':__dirname+_0x4f8782(0x161)+_0x4f8782(0x185)+_0x51147a[0x0][_0x4f8782(0x1ba)],'cid':_0x4f8782(0x1d3)}],'html':_0x4f8782(0x1d6)+_0x4f8782(0x177)+_0x4f8782(0x1a3)+_0x4f8782(0x18b)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4f8782(0x18b)+_0x4f8782(0x163)+_0x4f8782(0x14f)+'<div>'+'<h2>\x20'+_0x51147a[0x0]['site_title']+_0x4f8782(0x1fc)+_0x4f8782(0x14f)+_0x4f8782(0x14f)+'<hr\x20class=\x22my-3\x22>'+_0x4f8782(0x18b)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x306c0c[_0x4f8782(0x1a9)]+'\x20'+_0x4f8782(0x1da)+_0x4f8782(0x1ad)+_0x306c0c[_0x4f8782(0x1a2)]+'\x20'+'</span>'+_0x4f8782(0x1c8)+_0x4f8782(0x14f)+_0x4f8782(0x145)+_0x4f8782(0x158)+_0x4f8782(0x16a)+_0x4f8782(0xff)+_0x4f8782(0x197)+_0x4f8782(0x1e4)+_0x4f8782(0x1e1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x4f8782(0x1c0)+_0x4f8782(0x19b)+_0x4f8782(0xf3)+'</tr>'+'</thead>'+_0x4f8782(0x107)+'\x20'+_0x4dc8fb+'\x20'+_0x4f8782(0xe8)+'</table>'+_0x4f8782(0x18b)+'<strong>\x20Regards\x20</strong>'+_0x4f8782(0xe4)+_0x51147a[0x0][_0x4f8782(0x1e2)]+_0x4f8782(0x1c8)+_0x4f8782(0x14f)+_0x4f8782(0x14f)+'</body></html>'};_0x2a4d4a[_0x4f8782(0x164)](_0x50cad3,function(_0x5613fd,_0x55b6b3){var _0x493719=_0x4f8782;_0x5613fd?(console['log'](_0x5613fd),console[_0x493719(0x13e)](_0x493719(0x129))):console[_0x493719(0x13e)]('Email\x20sent\x20successfully');}),_0x3f08ee[_0x4f8782(0x1b4)]('success','Sales\x20Update\x20successfully'),_0x3d2275[_0x4f8782(0x1f8)](_0x4f8782(0x15c)+_0x296f54);}catch(_0xf47ffd){console[_0x4f8782(0x196)](_0xf47ffd),_0x3d2275[_0x4f8782(0x1e5)](0x1f4)[_0x4f8782(0x1dc)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x335bb1(0x17e)](_0x1322e3=>{var _0x4dc4bd=_0x335bb1;console['error'](_0x1322e3),_0x3d2275['status'](0x1f4)[_0x4dc4bd(0x1dc)]({'error':_0x4dc4bd(0x1a4)});});}catch(_0x47552b){console[_0x335bb1(0x13e)](_0x47552b);}}),router[a0_0x2afbb8(0x11b)](a0_0x2afbb8(0x1be),auth,async(_0x16fe03,_0x2a757a)=>{var _0x3a12e4=a0_0x2afbb8;try{const {username:_0xa3fccc,email:_0x4b537d,role:_0x49a6b1}=_0x16fe03[_0x3a12e4(0x1ac)],_0x22323c=_0x16fe03[_0x3a12e4(0x1ac)],_0x23d92f=await profile[_0x3a12e4(0x14c)]({'email':_0x22323c['email']}),_0x3422a6=await master_shop[_0x3a12e4(0x152)](),_0x593017=_0x16fe03[_0x3a12e4(0x1bc)]['id'],_0x1acd5b=await sales_finished[_0x3a12e4(0x1c1)](_0x593017);let _0x208b5d=new Date(_0x1acd5b[_0x3a12e4(0x12e)]),_0x4ba1a4=('0'+_0x208b5d['getDate']())[_0x3a12e4(0x17c)](-0x2),_0x4e7397=('0'+(_0x208b5d[_0x3a12e4(0x138)]()+0x1))[_0x3a12e4(0x17c)](-0x2),_0xaa4e6d=_0x208b5d[_0x3a12e4(0x188)](),_0xa1adfe=_0xaa4e6d+'-'+_0x4e7397+'-'+_0x4ba1a4;var _0x4778ca=[_0x3a12e4(0x13b),'Enclosed'];const _0x14c480=await warehouse[_0x3a12e4(0x132)]([{'$match':{'name':_0x1acd5b[_0x3a12e4(0x1df)],'room':_0x1acd5b[_0x3a12e4(0x10a)]}},{'$unwind':_0x3a12e4(0x187)},{'$group':{'_id':_0x3a12e4(0x1d8),'name':{'$first':_0x3a12e4(0x1a5)},'product_stock':{'$first':_0x3a12e4(0x137)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x3a12e4(0x1e6)},'type':{'$first':_0x3a12e4(0x171)},'floorlevel':{'$first':_0x3a12e4(0x194)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3a12e4(0x1cb)},'product_code':{'$first':_0x3a12e4(0x1e7)},'storage':{'$first':_0x3a12e4(0x175)},'rack':{'$first':_0x3a12e4(0x1d5)}}}]),_0x33bb4e=await customer[_0x3a12e4(0x152)]({});let _0x11316e;if(_0x22323c[_0x3a12e4(0x156)]==_0x3a12e4(0x199)){const _0xd7d9b2=await staff[_0x3a12e4(0x14c)]({'email':_0x22323c[_0x3a12e4(0x10b)]});_0x11316e=await warehouse[_0x3a12e4(0x132)]([{'$match':{'status':'Enabled','name':_0xd7d9b2[_0x3a12e4(0x10e)]}},{'$group':{'_id':_0x3a12e4(0xf9),'name':{'$first':_0x3a12e4(0xf9)}}}]);}else _0x11316e=await warehouse[_0x3a12e4(0x132)]([{'$match':{'status':_0x3a12e4(0x153)}},{'$group':{'_id':_0x3a12e4(0xf9),'name':{'$first':_0x3a12e4(0xf9)}}}]);const _0x2a3867=await product[_0x3a12e4(0x152)]({});if(_0x3422a6[0x0][_0x3a12e4(0x184)]==_0x3a12e4(0x183)){var _0x3685de=users['English'];console['log'](_0x3685de);}else{if(_0x3422a6[0x0]['language']==_0x3a12e4(0x18d))var _0x3685de=users[_0x3a12e4(0x18d)];else{if(_0x3422a6[0x0][_0x3a12e4(0x184)]==_0x3a12e4(0x114))var _0x3685de=users[_0x3a12e4(0x114)];else{if(_0x3422a6[0x0][_0x3a12e4(0x184)]==_0x3a12e4(0x1b8))var _0x3685de=users[_0x3a12e4(0x1b8)];else{if(_0x3422a6[0x0][_0x3a12e4(0x184)]==_0x3a12e4(0x16f))var _0x3685de=users['French'];else{if(_0x3422a6[0x0][_0x3a12e4(0x184)]==_0x3a12e4(0x119))var _0x3685de=users[_0x3a12e4(0x1f7)];else{if(_0x3422a6[0x0][_0x3a12e4(0x184)]=='Chinese')var _0x3685de=users[_0x3a12e4(0xe7)];else{if(_0x3422a6[0x0][_0x3a12e4(0x184)]=='Arabic\x20(ae)')var _0x3685de=users['Arabic'];}}}}}}}_0x2a757a['render'](_0x3a12e4(0x173),{'success':_0x16fe03['flash'](_0x3a12e4(0x16b)),'errors':_0x16fe03[_0x3a12e4(0x1b4)](_0x3a12e4(0x201)),'role':_0x22323c,'profile':_0x23d92f,'customer':_0x33bb4e,'warehouse':_0x11316e,'product':_0x14c480,'user':_0x1acd5b,'master_shop':_0x3422a6,'unit':_0x2a3867,'language':_0x3685de,'rooms_data':_0x4778ca,'ed_fullDate':_0xa1adfe});}catch(_0x2dfec4){console[_0x3a12e4(0x13e)](_0x2dfec4);}}),router[a0_0x2afbb8(0xfa)](a0_0x2afbb8(0x1be),auth,async(_0x43ba5d,_0x17ddc7)=>{var _0x3ab043=a0_0x2afbb8;try{const _0x443342=_0x43ba5d['params']['id'],_0x5792a5=await sales_finished['findOne']({'_id':_0x43ba5d['params']['id']}),_0x39175d=await warehouse['findOne']({'name':_0x5792a5['warehouse_name'],'room':_0x43ba5d[_0x3ab043(0x18a)]['room'],'warehouse_category':_0x3ab043(0x109)}),{invoice:_0x421383,customer:_0x5bf59e,date:_0x49bb77,warehouse_name:_0x238088,product_name:_0x3e6dc1,stock:_0x1e48ae,adjust_qty:_0x36ffbf,note:_0x3f2572,room:_0x456d79,primary_code:_0x45646a,secondary_code:_0x169c84,prod_code:_0xcc4451,level:_0x3222b0,isle:_0xeeb5ae,pallet:_0x57043e,expiry_date:_0x240fc7}=_0x43ba5d[_0x3ab043(0x18a)];if(typeof _0x3e6dc1==_0x3ab043(0x1aa))var _0x3609ee=[_0x43ba5d[_0x3ab043(0x18a)][_0x3ab043(0x1ff)]],_0x442c85=[_0x43ba5d[_0x3ab043(0x18a)][_0x3ab043(0x1db)]],_0xe3b054=[_0x43ba5d[_0x3ab043(0x18a)]['adjust_qty']],_0x47bac8=[_0x43ba5d[_0x3ab043(0x18a)]['primary_code']],_0x1f5257=[_0x43ba5d[_0x3ab043(0x18a)][_0x3ab043(0x130)]],_0x2669b7=[_0x43ba5d[_0x3ab043(0x18a)]['prod_code']],_0x4b5a95=[_0x43ba5d[_0x3ab043(0x18a)][_0x3ab043(0xfb)]],_0x588051=[_0x43ba5d['body'][_0x3ab043(0x12e)]];else var _0x3609ee=[..._0x43ba5d['body'][_0x3ab043(0x1ff)]],_0x442c85=[..._0x43ba5d[_0x3ab043(0x18a)]['stock']],_0xe3b054=[..._0x43ba5d[_0x3ab043(0x18a)]['adjust_qty']],_0x47bac8=[..._0x43ba5d[_0x3ab043(0x18a)][_0x3ab043(0xf2)]],_0x1f5257=[..._0x43ba5d[_0x3ab043(0x18a)][_0x3ab043(0x130)]],_0x2669b7=[..._0x43ba5d['body'][_0x3ab043(0x192)]],_0x4b5a95=[..._0x43ba5d[_0x3ab043(0x18a)]['level']],_0x588051=[..._0x43ba5d[_0x3ab043(0x18a)][_0x3ab043(0x12e)]];const _0x4f1967=_0x3609ee[_0x3ab043(0x101)](_0x3f33c0=>{return _0x3f33c0={'product_name':_0x3f33c0};});_0x442c85['forEach']((_0x1536a3,_0x3b9ef2)=>{var _0x142ab2=_0x3ab043;_0x4f1967[_0x3b9ef2][_0x142ab2(0x1db)]=_0x1536a3;}),_0xe3b054[_0x3ab043(0x1de)]((_0x40f820,_0x5de6da)=>{_0x4f1967[_0x5de6da]['quantity']=_0x40f820;}),_0x47bac8[_0x3ab043(0x1de)]((_0x5e400e,_0x170c27)=>{var _0x11bda8=_0x3ab043;_0x4f1967[_0x170c27][_0x11bda8(0xf2)]=_0x5e400e;}),_0x1f5257['forEach']((_0x17dc51,_0x2e0235)=>{var _0xd19992=_0x3ab043;_0x4f1967[_0x2e0235][_0xd19992(0x130)]=_0x17dc51;}),_0x2669b7[_0x3ab043(0x1de)]((_0x3680d0,_0x3e838f)=>{_0x4f1967[_0x3e838f]['product_code']=_0x3680d0;}),_0x4b5a95['forEach']((_0x345552,_0x8c9245)=>{var _0x3ad18c=_0x3ab043;_0x4f1967[_0x8c9245][_0x3ad18c(0xfb)]=_0x345552;}),_0x588051[_0x3ab043(0x1de)]((_0x196eef,_0x56f601)=>{var _0x70b87=_0x3ab043;_0x4f1967[_0x56f601][_0x70b87(0x12e)]=_0x196eef;});var _0x11aeef=0x0;_0x4f1967[_0x3ab043(0x1de)](_0x5e2a70=>{var _0x2b3fb3=_0x3ab043;console[_0x2b3fb3(0x13e)](_0x2b3fb3(0x15b),_0x5e2a70),(parseInt(_0x5e2a70[_0x2b3fb3(0x1db)])<parseInt(_0x5e2a70[_0x2b3fb3(0x1fe)])||parseInt(_0x5e2a70[_0x2b3fb3(0x1fe)])==0x0)&&_0x11aeef++;});if(_0x11aeef!=0x0)return _0x43ba5d[_0x3ab043(0x1b4)]('errors',_0x3ab043(0x1ec)),_0x17ddc7[_0x3ab043(0x1f8)](_0x3ab043(0x190));_0x5792a5[_0x3ab043(0x167)][_0x3ab043(0x1de)](_0x4714ff=>{const _0x2ceea3=_0x39175d['product_details']['map'](_0x1aa6c9=>{var _0x1f0c62=a0_0x3a22;_0x1aa6c9['product_name']==_0x4714ff['product_name']&&_0x1aa6c9[_0x1f0c62(0x126)]==_0x4714ff[_0x1f0c62(0x126)]&&(_0x1aa6c9[_0x1f0c62(0x1d0)]=parseInt(_0x1aa6c9['product_stock'])+parseInt(_0x4714ff[_0x1f0c62(0x1fe)]));});}),await _0x39175d[_0x3ab043(0x13a)]();const _0x2d87c3=_0x4f1967['filter'](_0x49fc83=>_0x49fc83[_0x3ab043(0x1fe)]!=='0'&&_0x49fc83['quantity']!=='');_0x5792a5['invoice']=_0x421383,_0x5792a5[_0x3ab043(0x1b6)]=_0x5bf59e,_0x5792a5[_0x3ab043(0x1a2)]=_0x49bb77,_0x5792a5[_0x3ab043(0x1df)]=_0x238088,_0x5792a5[_0x3ab043(0x167)]=_0x2d87c3,_0x5792a5['note']=_0x3f2572,_0x5792a5[_0x3ab043(0x10a)]=_0x456d79;const _0x1c6731=await _0x5792a5[_0x3ab043(0x13a)](),_0x23d4ee=await sales_finished[_0x3ab043(0x14c)]({'_id':_0x43ba5d[_0x3ab043(0x1bc)]['id']}),_0x20d0c9=await warehouse[_0x3ab043(0x14c)]({'name':_0x238088,'room':_0x456d79,'warehouse_category':_0x3ab043(0x109)});_0x23d4ee['sale_product'][_0x3ab043(0x1de)](_0x3df3f9=>{var _0x523aa1=_0x3ab043;const _0x1ccae9=_0x20d0c9[_0x523aa1(0x19f)]['map'](_0x310994=>{var _0x11019f=_0x523aa1;_0x310994[_0x11019f(0x1ff)]==_0x3df3f9[_0x11019f(0x1ff)]&&_0x310994[_0x11019f(0x126)]==_0x3df3f9[_0x11019f(0x126)]&&(_0x310994[_0x11019f(0x1d0)]=parseInt(_0x310994[_0x11019f(0x1d0)])-parseInt(_0x3df3f9[_0x11019f(0x1fe)]));});}),console['log'](_0x3ab043(0x15f),_0x20d0c9),await _0x20d0c9[_0x3ab043(0x13a)]();const _0x1b1361=await c_payment_data[_0x3ab043(0x14c)]({'invoice':_0x43ba5d[_0x3ab043(0x18a)][_0x3ab043(0x1a9)]});_0x1b1361[_0x3ab043(0x111)]=_0x43ba5d[_0x3ab043(0x18a)]['suppliers'],await _0x1b1361[_0x3ab043(0x13a)](),_0x43ba5d[_0x3ab043(0x1b4)](_0x3ab043(0x16b),_0x3ab043(0x157)),_0x17ddc7[_0x3ab043(0x1f8)]('/all_sales_finished/view');}catch(_0x2f8a0d){console[_0x3ab043(0x13e)](_0x2f8a0d);}}),router[a0_0x2afbb8(0xfa)](a0_0x2afbb8(0x12f),auth,async(_0x388dc9,_0x271519)=>{var _0x410054=a0_0x2afbb8;try{const _0x27b190=_0x388dc9[_0x410054(0x1bc)]['id'],{invoice:_0x4bee29,customer:_0x4a0a24,receivable_amount:_0x409e19,received_amount:_0x552e31}=_0x388dc9[_0x410054(0x18a)],_0x5d3cf7=await sales[_0x410054(0x1c1)](_0x27b190);console[_0x410054(0x13e)](_0x5d3cf7);var _0x16c4e4=_0x409e19-_0x552e31;console['log'](_0x552e31),_0x5d3cf7[_0x410054(0xeb)]=parseFloat(_0x552e31)+parseFloat(_0x5d3cf7[_0x410054(0xeb)]),_0x5d3cf7['due_amount']=_0x16c4e4,console['log'](_0x5d3cf7);const _0x218d6d=await _0x5d3cf7[_0x410054(0x13a)](),_0x284989=await c_payment_data[_0x410054(0x14c)]({'invoice':_0x4bee29});_0x284989[_0x410054(0x1e8)]=_0x16c4e4,await _0x284989[_0x410054(0x13a)]();let _0x5d2841=new Date(),_0x548760=('0'+_0x5d2841['getDate']())[_0x410054(0x17c)](-0x2),_0xa41f7c=('0'+(_0x5d2841[_0x410054(0x138)]()+0x1))[_0x410054(0x17c)](-0x2),_0xa38734=_0x5d2841['getFullYear'](),_0x5620fc=_0xa38734+'-'+_0xa41f7c+'-'+_0x548760;const _0x37b93c=new customer_payment({'invoice':_0x4bee29,'date':_0xa38734+'-'+_0xa41f7c+'-'+_0x548760,'customer':_0x4a0a24,'reason':_0x410054(0x178),'amount':_0x552e31}),_0x49b88a=await _0x37b93c[_0x410054(0x13a)]();_0x388dc9['flash'](_0x410054(0x16b),_0x410054(0x1a8)),_0x271519[_0x410054(0x1f8)](_0x410054(0xe6));}catch(_0x226767){console['log'](_0x226767);}}),router[a0_0x2afbb8(0x11b)](a0_0x2afbb8(0x13d),auth,async(_0x9bddd0,_0x1363f8)=>{var _0x3ed436=a0_0x2afbb8;try{const {username:_0x48fe8e,email:_0x362eb3,role:_0x450ac8}=_0x9bddd0[_0x3ed436(0x1ac)],_0x11f1c9=_0x9bddd0['user'],_0x31f42e=await profile[_0x3ed436(0x14c)]({'email':_0x11f1c9[_0x3ed436(0x10b)]}),_0x57b98e=await master_shop[_0x3ed436(0x152)]();console[_0x3ed436(0x13e)](_0x3ed436(0x203),_0x57b98e);const _0x1657bd=_0x9bddd0[_0x3ed436(0x1bc)]['id'],_0xde2476=await sales[_0x3ed436(0x1c1)](_0x1657bd);console[_0x3ed436(0x13e)](_0xde2476);const _0x5d1678=await customer[_0x3ed436(0x14c)]({'name':_0xde2476['customer']});console[_0x3ed436(0x13e)](_0x5d1678);if(_0x57b98e[0x0][_0x3ed436(0x184)]=='English\x20(US)'){var _0x281680=users[_0x3ed436(0x1b2)];console['log'](_0x281680);}else{if(_0x57b98e[0x0][_0x3ed436(0x184)]==_0x3ed436(0x18d))var _0x281680=users['Hindi'];else{if(_0x57b98e[0x0][_0x3ed436(0x184)]==_0x3ed436(0x114))var _0x281680=users[_0x3ed436(0x114)];else{if(_0x57b98e[0x0][_0x3ed436(0x184)]==_0x3ed436(0x1b8))var _0x281680=users[_0x3ed436(0x1b8)];else{if(_0x57b98e[0x0]['language']==_0x3ed436(0x16f))var _0x281680=users[_0x3ed436(0x16f)];else{if(_0x57b98e[0x0]['language']==_0x3ed436(0x119))var _0x281680=users[_0x3ed436(0x1f7)];else{if(_0x57b98e[0x0][_0x3ed436(0x184)]==_0x3ed436(0xe7))var _0x281680=users[_0x3ed436(0xe7)];else{if(_0x57b98e[0x0][_0x3ed436(0x184)]==_0x3ed436(0x179))var _0x281680=users[_0x3ed436(0xf6)];}}}}}}}_0x1363f8[_0x3ed436(0xfc)](_0x3ed436(0x1c5),{'success':_0x9bddd0['flash'](_0x3ed436(0x16b)),'errors':_0x9bddd0['flash']('errors'),'role':_0x11f1c9,'profile':_0x31f42e,'master_shop':_0x57b98e,'customers':_0x5d1678,'sales':_0xde2476,'language':_0x281680});}catch(_0x331bde){console[_0x3ed436(0x13e)](_0x331bde);}}),router[a0_0x2afbb8(0x11b)](a0_0x2afbb8(0x13c),auth,async(_0x5a4e76,_0xfdb6b9)=>{var _0x45e683=a0_0x2afbb8;try{const {username:_0x507d4e,email:_0x1904c2,role:_0x2fca21}=_0x5a4e76[_0x45e683(0x1ac)],_0xf55bde=_0x5a4e76['user'],_0x58d248=await profile[_0x45e683(0x14c)]({'email':_0xf55bde['email']}),_0x3c3410=await master_shop[_0x45e683(0x152)](),_0x2ce48c=_0x5a4e76[_0x45e683(0x1bc)]['id'],_0x399807=await sales_finished[_0x45e683(0x1c1)](_0x2ce48c),_0x1325c4=await warehouse[_0x45e683(0x132)]([{'$match':{'name':_0x399807[_0x45e683(0x1df)]}},{'$unwind':_0x45e683(0x187)},{'$group':{'_id':_0x45e683(0x1d8),'name':{'$first':_0x45e683(0x1a5)},'product_stock':{'$first':_0x45e683(0x137)},'bay':{'$first':_0x45e683(0x191)},'bin':{'$first':_0x45e683(0x1e6)},'type':{'$first':_0x45e683(0x171)},'floorlevel':{'$first':_0x45e683(0x194)},'primary_code':{'$first':_0x45e683(0x17b)},'secondary_code':{'$first':_0x45e683(0x1cb)},'product_code':{'$first':_0x45e683(0x1e7)},'storage':{'$first':_0x45e683(0x175)},'rack':{'$first':_0x45e683(0x1d5)},'expiry_date':{'$first':_0x45e683(0x131)},'production_date':{'$first':_0x45e683(0xef)},'unit':{'$first':_0x45e683(0x108)},'secondary_unit':{'$first':_0x45e683(0x1c4)},'maxProducts':{'$first':_0x45e683(0x200)},'batch_code':{'$first':_0x45e683(0x120)},'maxPerUnit':{'$first':_0x45e683(0x12a)}}}]),_0x3b4763=await product[_0x45e683(0x152)]({}),_0x528c1d=await warehouse[_0x45e683(0x132)]([{'$match':{'status':_0x45e683(0x153),'warehouse_category':_0x45e683(0x109),'name':{'$ne':'Return\x20Goods','$ne':_0x45e683(0x1bd)}}},{'$group':{'_id':_0x45e683(0xf9),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x2ec237=[_0x45e683(0xf0)];const _0x46863f=await warehouse[_0x45e683(0x132)]([{'$match':{'status':_0x45e683(0x153),'name':'Quality\x20Inspection'}},{'$group':{'_id':'$name','name':{'$first':_0x45e683(0xf9)}}},{'$sort':{'name':0x1}}]);if(_0x3c3410[0x0]['language']==_0x45e683(0x183)){var _0x5db510=users[_0x45e683(0x1b2)];console[_0x45e683(0x13e)](_0x5db510);}else{if(_0x3c3410[0x0][_0x45e683(0x184)]==_0x45e683(0x18d))var _0x5db510=users[_0x45e683(0x18d)];else{if(_0x3c3410[0x0][_0x45e683(0x184)]==_0x45e683(0x114))var _0x5db510=users[_0x45e683(0x114)];else{if(_0x3c3410[0x0][_0x45e683(0x184)]==_0x45e683(0x1b8))var _0x5db510=users['Spanish'];else{if(_0x3c3410[0x0][_0x45e683(0x184)]==_0x45e683(0x16f))var _0x5db510=users[_0x45e683(0x16f)];else{if(_0x3c3410[0x0]['language']=='Portuguese\x20(BR)')var _0x5db510=users[_0x45e683(0x1f7)];else{if(_0x3c3410[0x0][_0x45e683(0x184)]=='Chinese')var _0x5db510=users[_0x45e683(0xe7)];else{if(_0x3c3410[0x0][_0x45e683(0x184)]==_0x45e683(0x179))var _0x5db510=users['Arabic'];}}}}}}}_0xfdb6b9[_0x45e683(0xfc)](_0x45e683(0x1cf),{'success':_0x5a4e76[_0x45e683(0x1b4)](_0x45e683(0x16b)),'errors':_0x5a4e76[_0x45e683(0x1b4)]('errors'),'role':_0xf55bde,'profile':_0x58d248,'user':_0x399807,'stock':_0x1325c4,'master_shop':_0x3c3410,'unit':_0x3b4763,'language':_0x5db510,'warehouses':_0x528c1d,'rooms':_0x2ec237,'warehouse_QA':_0x46863f});}catch(_0x1e01ef){console[_0x45e683(0x13e)](_0x1e01ef),_0xfdb6b9[_0x45e683(0x1e5)](0xc8)[_0x45e683(0x1dc)]({'message':_0x1e01ef[_0x45e683(0x1ef)]});}}),router[a0_0x2afbb8(0xfa)](a0_0x2afbb8(0x13c),auth,async(_0x367e09,_0x530a39)=>{var _0x1e96af=a0_0x2afbb8;if(_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x198)]=='QA')try{const {invoice:_0x5c4157,date:_0x216342,warehouse_name:_0x4beb0f,product_name:_0x47775f,primary_code:_0x5b4b14,secondary_code:_0xffa4bb,product_code:_0x103e32,sales_quantity:_0x9b1e79,stocks:_0x3ad6a5,return_qty:_0x2bb010,Room_name:_0x397017,to_warehouse_name_QA:_0x3d61e1,to_Room_name_QA:_0x448f8f,note:_0x34c183,for_categorize:_0x351b09,product_name_QA1:_0x355a94}=_0x367e09['body'];if(typeof _0x355a94==_0x1e96af(0x1aa))var _0x3b5886=[_0x367e09['body'][_0x1e96af(0x155)]],_0x20fd68=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x110)]],_0x2a40e6=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x19e)]],_0x3b9d59=[_0x367e09['body'][_0x1e96af(0x1bf)]],_0xd14671=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x105)]],_0x36da76=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1f9)]],_0xe2d411=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x189)]],_0x2b9659=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1c3)]],_0x487f49=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1b0)]],_0x4caa09=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x16e)]],_0x54609d=[_0x367e09[_0x1e96af(0x18a)]['secondary_unit_QA']],_0x2484f5=[_0x367e09['body'][_0x1e96af(0x1b5)]],_0x4dc6cd=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1b3)]],_0x4d9098=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1e3)]];else var _0x3b5886=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x155)]],_0x20fd68=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x110)]],_0x2a40e6=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x19e)]],_0x3b9d59=[..._0x367e09['body']['product_code_QA']],_0xd14671=[..._0x367e09['body'][_0x1e96af(0x105)]],_0x36da76=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1f9)]],_0xe2d411=[..._0x367e09[_0x1e96af(0x18a)]['return_qty_QA']],_0x2b9659=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1c3)]],_0x487f49=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1b0)]],_0x4caa09=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x16e)]],_0x54609d=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0xf1)]],_0x2484f5=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1b5)]],_0x4dc6cd=[..._0x367e09[_0x1e96af(0x18a)]['production_date_QA']],_0x4d9098=[..._0x367e09['body']['expiry_date_QA']];const _0x4d833d=_0x3b5886[_0x1e96af(0x101)](_0x4bbe55=>{return _0x4bbe55={'product_name':_0x4bbe55};});_0x20fd68[_0x1e96af(0x1de)]((_0x5ed59f,_0x1f2351)=>{var _0x4d3933=_0x1e96af;_0x4d833d[_0x1f2351][_0x4d3933(0xf2)]=_0x5ed59f;}),_0x2a40e6[_0x1e96af(0x1de)]((_0x5439a3,_0x58b2d5)=>{_0x4d833d[_0x58b2d5]['secondary_code']=_0x5439a3;}),_0x3b9d59[_0x1e96af(0x1de)]((_0x210627,_0x56a822)=>{_0x4d833d[_0x56a822]['product_code']=_0x210627;}),_0xd14671['forEach']((_0x2dc883,_0x24b494)=>{_0x4d833d[_0x24b494]['sale_qty']=_0x2dc883;}),_0x36da76[_0x1e96af(0x1de)]((_0x424b05,_0x218617)=>{var _0x2f8f44=_0x1e96af;_0x4d833d[_0x218617][_0x2f8f44(0x1db)]=_0x424b05;}),_0xe2d411['forEach']((_0x3cdce3,_0x1ac4e2)=>{_0x4d833d[_0x1ac4e2]['return_qty']=_0x3cdce3;}),_0x2b9659[_0x1e96af(0x1de)]((_0x2453f4,_0x1d5475)=>{var _0x186030=_0x1e96af;_0x4d833d[_0x1d5475][_0x186030(0xee)]=_0x2453f4;}),_0x487f49[_0x1e96af(0x1de)]((_0xda8a34,_0x1447cb)=>{var _0x27d083=_0x1e96af;_0x4d833d[_0x1447cb][_0x27d083(0x127)]=_0xda8a34;}),_0x4caa09['forEach']((_0xc89596,_0xce946f)=>{var _0x5425a1=_0x1e96af;_0x4d833d[_0xce946f][_0x5425a1(0x17a)]=_0xc89596;}),_0x54609d[_0x1e96af(0x1de)]((_0x39c67b,_0x23a326)=>{var _0x5e340a=_0x1e96af;_0x4d833d[_0x23a326][_0x5e340a(0x1a0)]=_0x39c67b;}),_0x2484f5['forEach']((_0x4474ee,_0x1f7848)=>{_0x4d833d[_0x1f7848]['unit']=_0x4474ee;}),_0x4dc6cd[_0x1e96af(0x1de)]((_0x25ca4b,_0x2ebdf5)=>{_0x4d833d[_0x2ebdf5]['production_date']=_0x25ca4b;}),_0x4d9098[_0x1e96af(0x1de)]((_0x3c6105,_0x53ba2e)=>{var _0x463fe5=_0x1e96af;_0x4d833d[_0x53ba2e][_0x463fe5(0x12e)]=_0x3c6105;});const _0x3291e4=await sales_finished[_0x1e96af(0x14c)]({'invoice':_0x5c4157});_0x3291e4[_0x1e96af(0x195)]=_0x1e96af(0x1f2);const _0x414ea3=await _0x3291e4[_0x1e96af(0x13a)](),_0x5aff6b=new sales_return_finished({'invoice':_0x5c4157,'customer':_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1b6)],'date':_0x216342,'warehouse_name':_0x4beb0f,'room':_0x397017,'ToWarehouse':_0x3d61e1,'ToRoom':_0x448f8f,'return_sale_QA':_0x4d833d,'note':_0x34c183,'warehouse_cat':_0x351b09}),_0x484766=await _0x5aff6b['save'](),_0x580b57=await sales_return_finished['findOne']({'invoice':_0x5c4157}),_0x26abf7=await warehouse[_0x1e96af(0x14c)]({'name':_0x3d61e1,'room':_0x448f8f});_0x580b57[_0x1e96af(0x117)]['forEach'](_0x47f798=>{var _0xfd06a7=_0x1e96af,_0x282192=0x0;const _0x5c85e7=_0x26abf7[_0xfd06a7(0x19f)][_0xfd06a7(0x101)](_0x42b562=>{var _0x58982e=_0xfd06a7;_0x42b562['product_name']==_0x47f798[_0x58982e(0x1ff)]&&_0x42b562[_0x58982e(0x12e)]==_0x47f798[_0x58982e(0x12e)]&&_0x42b562[_0x58982e(0x1f1)]==_0x47f798[_0x58982e(0x1f1)]&&_0x42b562[_0x58982e(0x17a)]==_0x47f798[_0x58982e(0x17a)]&&(_0x42b562[_0x58982e(0x1d0)]=parseInt(_0x42b562[_0x58982e(0x1d0)])+parseInt(_0x47f798[_0x58982e(0x1ee)]),_0x282192++);});_0x282192=='0'&&(_0x26abf7[_0xfd06a7(0x19f)]=_0x26abf7[_0xfd06a7(0x19f)][_0xfd06a7(0x141)]({'product_name':_0x47f798[_0xfd06a7(0x1ff)],'product_stock':_0x47f798[_0xfd06a7(0x1ee)],'primary_code':_0x47f798[_0xfd06a7(0xf2)],'secondary_code':_0x47f798[_0xfd06a7(0x130)],'product_code':_0x47f798['product_code'],'batch_code':_0x47f798[_0xfd06a7(0x17a)],'maxPerUnit':_0x47f798['maxPerUnit'],'production_date':_0x47f798[_0xfd06a7(0x1f1)],'expiry_date':_0x47f798[_0xfd06a7(0x12e)],'secondary_unit':_0x47f798[_0xfd06a7(0x1a0)],'unit':_0x47f798[_0xfd06a7(0x14b)],'maxProducts':_0x47f798['maxProducts'],'bay':_0x47f798[_0xfd06a7(0x126)]}));}),await _0x26abf7[_0x1e96af(0x13a)]();const _0x353b53=new c_payment_data({'invoice':_0x5c4157,'customer':_0x367e09[_0x1e96af(0x18a)]['customer'],'reason':'Sale\x20Return'});await _0x353b53[_0x1e96af(0x13a)]();const _0x15b294=await master_shop[_0x1e96af(0x152)](),_0x339f9e=await email_settings[_0x1e96af(0x14c)](),_0x130348=await customer[_0x1e96af(0x14c)]({'name':_0x367e09['body']['customer']});_0x15b294[0x0]['currency_placement']==0x1?(right_currency=_0x15b294[0x0][_0x1e96af(0x123)],left_currency=''):(right_currency='',left_currency=_0x15b294[0x0]['currency']);var _0x3bbece=_0x3b5886,_0xa07f0c=_0xe2d411,_0x562806='',_0xc66c99;for(_0xc66c99 in _0x3bbece){_0x562806+=_0x1e96af(0x16a)+_0x1e96af(0x1fa)+_0x3bbece[_0xc66c99]+_0x1e96af(0x136)+_0x1e96af(0x1fa)+_0xa07f0c[_0xc66c99]+_0x1e96af(0x136)+_0x1e96af(0xe2);}console[_0x1e96af(0x13e)](_0x1e96af(0x11e),_0x562806);let _0x37ec07=nodemailer[_0x1e96af(0x139)]({'service':_0x1e96af(0xed),'auth':{'user':_0x339f9e[_0x1e96af(0x10b)],'pass':_0x339f9e[_0x1e96af(0x100)]}}),_0x1bc9b4={'from':_0x339f9e['email'],'to':_0x130348[_0x1e96af(0x10b)],'subject':_0x1e96af(0x1d7),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x1e96af(0x185)+_0x15b294[0x0][_0x1e96af(0x1ba)],'cid':_0x1e96af(0x1d3)}],'html':_0x1e96af(0x1d6)+'<html><head><title></title>'+'</head><body>'+_0x1e96af(0x18b)+_0x1e96af(0x176)+_0x1e96af(0x18b)+_0x1e96af(0x163)+_0x1e96af(0x14f)+_0x1e96af(0x18b)+_0x1e96af(0xea)+_0x15b294[0x0]['site_title']+'\x20</h2>'+_0x1e96af(0x14f)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x1e96af(0xe9)+_0x1e96af(0x202)+_0x5c4157+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1e96af(0x1ad)+_0x216342+'\x20'+_0x1e96af(0x14a)+_0x1e96af(0x1c8)+_0x1e96af(0x14f)+_0x1e96af(0x145)+_0x1e96af(0x158)+_0x1e96af(0x16a)+_0x1e96af(0xff)+_0x1e96af(0xe5)+_0x1e96af(0x1a1)+_0x1e96af(0x1ea)+'</tr>'+_0x1e96af(0x1af)+_0x1e96af(0x107)+'\x20'+_0x562806+'\x20'+'</tbody>'+'</table>'+_0x1e96af(0x18b)+_0x1e96af(0x18c)+'<h5>'+_0x15b294[0x0][_0x1e96af(0x1e2)]+_0x1e96af(0x1c8)+'</div>'+_0x1e96af(0x14f)+_0x1e96af(0x1a7)};_0x37ec07[_0x1e96af(0x164)](_0x1bc9b4,function(_0x185290,_0x59d036){var _0x16cbb9=_0x1e96af;_0x185290?(console[_0x16cbb9(0x13e)](_0x185290),console['log']('Error\x20Occurs')):console[_0x16cbb9(0x13e)](_0x16cbb9(0x12b));}),_0x367e09[_0x1e96af(0x1b4)](_0x1e96af(0x16b),_0x1e96af(0x159)),_0x530a39[_0x1e96af(0x1f8)]('/all_sales_finished/view');}catch(_0x538f59){_0x530a39[_0x1e96af(0x1e5)](0xc8)[_0x1e96af(0x1dc)]({'message1':_0x538f59[_0x1e96af(0x1ef)]});}else{if(_0x367e09['body'][_0x1e96af(0x198)]=='GS')try{const {invoice:_0x36a2ab,date:_0x1e31d8,warehouse_name:_0x227153,product_name:_0x2f5ed1,primary_code:_0x4b8dad,secondary_code:_0x5f9304,product_code:_0x582c76,sales_quantity:_0x210ceb,stocks:_0x21cfda,return_qty:_0x5dafd4,Room_name:_0x2ee37d,to_warehouse_name:_0x5dc4f5,to_Room_name:_0x25ecfa,note:_0xd10a47,level:_0x4b96e5,isle:_0xcd5710,pallet:_0x584595,for_categorize:_0x507be5}=_0x367e09['body'];if(typeof _0x2f5ed1==_0x1e96af(0x1aa))var _0x3b5886=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1ff)]],_0x20fd68=[_0x367e09[_0x1e96af(0x18a)]['primary_code']],_0x2a40e6=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x130)]],_0x3b9d59=[_0x367e09[_0x1e96af(0x18a)]['product_code']],_0xd14671=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0xfd)]],_0xe2d411=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1ee)]],_0x56101a=[_0x367e09['body']['bay']],_0x2b9659=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0xee)]],_0x487f49=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x127)]],_0x4caa09=[_0x367e09['body'][_0x1e96af(0x17a)]],_0x54609d=[_0x367e09[_0x1e96af(0x18a)]['secondary_unit']],_0x2484f5=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x14b)]],_0x4dc6cd=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1f1)]],_0x4d9098=[_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x12e)]];else var _0x3b5886=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1ff)]],_0x20fd68=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0xf2)]],_0x2a40e6=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x130)]],_0x3b9d59=[..._0x367e09['body'][_0x1e96af(0x116)]],_0xd14671=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0xfd)]],_0xe2d411=[..._0x367e09[_0x1e96af(0x18a)]['return_qty']],_0x56101a=[..._0x367e09['body']['bay']],_0x2b9659=[..._0x367e09[_0x1e96af(0x18a)]['maxPerUnit']],_0x487f49=[..._0x367e09[_0x1e96af(0x18a)]['maxProducts']],_0x4caa09=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x17a)]],_0x54609d=[..._0x367e09[_0x1e96af(0x18a)]['secondary_unit']],_0x2484f5=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x14b)]],_0x4dc6cd=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1f1)]],_0x4d9098=[..._0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x12e)]];const _0x342a34=_0x3b5886[_0x1e96af(0x101)](_0xf6cf5e=>{return _0xf6cf5e={'product_name':_0xf6cf5e};});_0x20fd68[_0x1e96af(0x1de)]((_0x4adde9,_0x592428)=>{_0x342a34[_0x592428]['primary_code']=_0x4adde9;}),_0x2a40e6['forEach']((_0x19919a,_0x217cf5)=>{var _0x3cc4db=_0x1e96af;_0x342a34[_0x217cf5][_0x3cc4db(0x130)]=_0x19919a;}),_0x3b9d59[_0x1e96af(0x1de)]((_0x5c41b3,_0x266bab)=>{var _0x5b82a8=_0x1e96af;_0x342a34[_0x266bab][_0x5b82a8(0x116)]=_0x5c41b3;}),_0xd14671[_0x1e96af(0x1de)]((_0x4a51cc,_0x3a89f2)=>{var _0x52579d=_0x1e96af;_0x342a34[_0x3a89f2][_0x52579d(0x180)]=_0x4a51cc;}),_0xe2d411['forEach']((_0x4a6439,_0x1e571b)=>{var _0x492df7=_0x1e96af;_0x342a34[_0x1e571b][_0x492df7(0x1ee)]=_0x4a6439;}),_0x56101a['forEach']((_0x520228,_0x52dafd)=>{_0x342a34[_0x52dafd]['bay']=_0x520228;}),_0x2b9659[_0x1e96af(0x1de)]((_0x3fbe63,_0x3e63fa)=>{var _0x43f05a=_0x1e96af;_0x342a34[_0x3e63fa][_0x43f05a(0xee)]=_0x3fbe63;}),_0x487f49[_0x1e96af(0x1de)]((_0x62fa87,_0x55c6ac)=>{var _0x29c88b=_0x1e96af;_0x342a34[_0x55c6ac][_0x29c88b(0x127)]=_0x62fa87;}),_0x4caa09[_0x1e96af(0x1de)]((_0x38bc17,_0x4f62db)=>{_0x342a34[_0x4f62db]['batch_code']=_0x38bc17;}),_0x54609d[_0x1e96af(0x1de)]((_0x3d52f9,_0x4807a5)=>{var _0x28f6bb=_0x1e96af;_0x342a34[_0x4807a5][_0x28f6bb(0x1a0)]=_0x3d52f9;}),_0x2484f5[_0x1e96af(0x1de)]((_0xf2d826,_0x12b01a)=>{var _0x502624=_0x1e96af;_0x342a34[_0x12b01a][_0x502624(0x14b)]=_0xf2d826;}),_0x4dc6cd['forEach']((_0x28c6a7,_0x558ff6)=>{_0x342a34[_0x558ff6]['production_date']=_0x28c6a7;}),_0x4d9098[_0x1e96af(0x1de)]((_0x584995,_0x1f6d04)=>{var _0x149370=_0x1e96af;_0x342a34[_0x1f6d04][_0x149370(0x12e)]=_0x584995;});var _0x1aa659=0x0;_0x342a34[_0x1e96af(0x1de)](_0x5dec34=>{var _0x406808=_0x1e96af;(parseInt(_0x5dec34[_0x406808(0x180)])<parseInt(_0x5dec34['return_qty'])||parseInt(_0x5dec34[_0x406808(0x1db)])<parseInt(_0x5dec34['return_qty'])&&parseInt(_0x5dec34[_0x406808(0x180)])>parseInt(_0x5dec34[_0x406808(0x1ee)])||parseInt(_0x5dec34[_0x406808(0x1ee)])==0x0)&&_0x1aa659++;});if(_0x1aa659!=0x0)return _0x367e09[_0x1e96af(0x1b4)](_0x1e96af(0x201),_0x1e96af(0x118)),_0x530a39['redirect'](_0x1e96af(0x190));const _0x2cf2d0=await sales_finished[_0x1e96af(0x14c)]({'invoice':_0x36a2ab});_0x2cf2d0[_0x1e96af(0x195)]=_0x1e96af(0x1f2);const _0x6a4147=await _0x2cf2d0[_0x1e96af(0x13a)](),_0x7be5aa=new sales_return_finished({'invoice':_0x36a2ab,'customer':_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1b6)],'date':_0x1e31d8,'warehouse_name':_0x227153,'room':_0x2ee37d,'ToWarehouse':_0x5dc4f5,'ToRoom':_0x25ecfa,'return_sale':_0x342a34,'note':_0xd10a47,'warehouse_cat':_0x507be5}),_0x1b1eb2=await _0x7be5aa['save'](),_0x19f296=await sales_return_finished[_0x1e96af(0x14c)]({'invoice':_0x36a2ab}),_0x4b0b04=await warehouse[_0x1e96af(0x14c)]({'name':_0x5dc4f5,'room':_0x25ecfa,'warehouse_category':_0x1e96af(0x109)});_0x19f296[_0x1e96af(0xf5)][_0x1e96af(0x1de)](_0x502649=>{var _0x17d3db=_0x1e96af,_0x42fabd=0x0;const _0xf61a6a=_0x4b0b04[_0x17d3db(0x19f)][_0x17d3db(0x101)](_0x2d863d=>{var _0x3b3f32=_0x17d3db;_0x2d863d[_0x3b3f32(0x1ff)]==_0x502649[_0x3b3f32(0x1ff)]&&_0x2d863d[_0x3b3f32(0x126)]==_0x502649[_0x3b3f32(0x126)]&&_0x2d863d[_0x3b3f32(0x12e)]==_0x502649[_0x3b3f32(0x12e)]&&_0x2d863d['production_date']==_0x502649[_0x3b3f32(0x1f1)]&&_0x2d863d[_0x3b3f32(0x17a)]==_0x502649[_0x3b3f32(0x17a)]&&(_0x2d863d[_0x3b3f32(0x1d0)]=parseInt(_0x2d863d[_0x3b3f32(0x1d0)])+parseInt(_0x502649[_0x3b3f32(0x1ee)]),_0x42fabd++);});_0x42fabd=='0'&&(_0x4b0b04[_0x17d3db(0x19f)]=_0x4b0b04['product_details'][_0x17d3db(0x141)]({'product_name':_0x502649['product_name'],'product_stock':_0x502649[_0x17d3db(0x1ee)],'primary_code':_0x502649[_0x17d3db(0xf2)],'secondary_code':_0x502649['secondary_code'],'product_code':_0x502649[_0x17d3db(0x116)],'bay':_0x502649[_0x17d3db(0x126)],'batch_code':_0x502649[_0x17d3db(0x17a)],'maxPerUnit':_0x502649[_0x17d3db(0xee)],'production_date':_0x502649[_0x17d3db(0x1f1)],'expiry_date':_0x502649['expiry_date'],'secondary_unit':_0x502649[_0x17d3db(0x1a0)],'unit':_0x502649['unit'],'maxProducts':_0x502649[_0x17d3db(0x127)]}));}),await _0x4b0b04[_0x1e96af(0x13a)](),console['log'](_0x367e09[_0x1e96af(0x18a)]);const _0x58c77a=new c_payment_data({'invoice':_0x36a2ab,'customer':_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1b6)],'reason':_0x1e96af(0x17d)});await _0x58c77a[_0x1e96af(0x13a)]();const _0x29684d=await master_shop[_0x1e96af(0x152)]();console[_0x1e96af(0x13e)](_0x1e96af(0x1c7),_0x29684d[0x0][_0x1e96af(0x1ba)]);const _0x9d8cf1=await email_settings['findOne'](),_0x132ddc=await customer['findOne']({'name':_0x367e09[_0x1e96af(0x18a)][_0x1e96af(0x1b6)]});console[_0x1e96af(0x13e)](_0x1e96af(0x174),_0x132ddc);_0x29684d[0x0][_0x1e96af(0x172)]==0x1?(right_currency=_0x29684d[0x0][_0x1e96af(0x123)],left_currency=''):(right_currency='',left_currency=_0x29684d[0x0][_0x1e96af(0x123)]);var _0x3bbece=_0x3b5886,_0xa07f0c=_0xe2d411,_0x562806='',_0xc66c99;for(_0xc66c99 in _0x3bbece){_0x562806+=_0x1e96af(0x16a)+_0x1e96af(0x1fa)+_0x3bbece[_0xc66c99]+'</td>'+_0x1e96af(0x1fa)+_0xa07f0c[_0xc66c99]+'</td>'+_0x1e96af(0xe2);}console[_0x1e96af(0x13e)](_0x1e96af(0x11e),_0x562806);let _0x14916d=nodemailer[_0x1e96af(0x139)]({'service':_0x1e96af(0xed),'auth':{'user':_0x9d8cf1[_0x1e96af(0x10b)],'pass':_0x9d8cf1[_0x1e96af(0x100)]}}),_0x7df364={'from':_0x9d8cf1['email'],'to':_0x132ddc[_0x1e96af(0x10b)],'subject':_0x1e96af(0x1d7),'attachments':[{'filename':_0x1e96af(0x1e9),'path':__dirname+_0x1e96af(0x161)+_0x1e96af(0x185)+_0x29684d[0x0][_0x1e96af(0x1ba)],'cid':_0x1e96af(0x1d3)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x1e96af(0x1a3)+'<div>'+_0x1e96af(0x176)+_0x1e96af(0x18b)+_0x1e96af(0x163)+_0x1e96af(0x14f)+_0x1e96af(0x18b)+_0x1e96af(0xea)+_0x29684d[0x0]['site_title']+_0x1e96af(0x1fc)+_0x1e96af(0x14f)+_0x1e96af(0x14f)+_0x1e96af(0x17f)+_0x1e96af(0x18b)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1e96af(0x202)+_0x36a2ab+'\x20'+_0x1e96af(0x1da)+_0x1e96af(0x1ad)+_0x1e31d8+'\x20'+_0x1e96af(0x14a)+_0x1e96af(0x1c8)+_0x1e96af(0x14f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1e96af(0x158)+_0x1e96af(0x16a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x1e96af(0x1a1)+_0x1e96af(0x1ea)+_0x1e96af(0xe2)+_0x1e96af(0x1af)+_0x1e96af(0x107)+'\x20'+_0x562806+'\x20'+_0x1e96af(0xe8)+_0x1e96af(0xf8)+_0x1e96af(0x18b)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x29684d[0x0][_0x1e96af(0x1e2)]+_0x1e96af(0x1c8)+_0x1e96af(0x14f)+'</div>'+_0x1e96af(0x1a7)};_0x14916d[_0x1e96af(0x164)](_0x7df364,function(_0x24026b,_0x19c304){var _0x235b70=_0x1e96af;_0x24026b?(console[_0x235b70(0x13e)](_0x24026b),console['log'](_0x235b70(0x129))):console[_0x235b70(0x13e)]('Email\x20sent\x20successfully');}),_0x367e09[_0x1e96af(0x1b4)](_0x1e96af(0x16b),_0x1e96af(0x159)),_0x530a39[_0x1e96af(0x1f8)]('/all_sales_finished/view');}catch(_0x24380b){console[_0x1e96af(0x13e)](_0x24380b),_0x530a39[_0x1e96af(0x1e5)](0xc8)[_0x1e96af(0x1dc)]({'message1':_0x24380b['message']});}}}),router[a0_0x2afbb8(0x11b)](a0_0x2afbb8(0x19a),auth,async(_0x14839c,_0x2138bf)=>{var _0x44adcb=a0_0x2afbb8;try{const {username:_0x13f386,email:_0x55c1e0,role:_0x275237}=_0x14839c['user'],_0x458175=_0x14839c[_0x44adcb(0x1ac)],_0x208dc1=await profile[_0x44adcb(0x14c)]({'email':_0x458175[_0x44adcb(0x10b)]}),_0x3b97bb=await master_shop['find']();console[_0x44adcb(0x13e)]('barcode\x20Product\x20master',_0x3b97bb);const _0x3a69a2=_0x14839c[_0x44adcb(0x1bc)]['id'],_0x5b7dbb=await sales[_0x44adcb(0x1c1)](_0x3a69a2);console['log'](_0x44adcb(0x11c),_0x5b7dbb);if(_0x3b97bb[0x0][_0x44adcb(0x184)]==_0x44adcb(0x183))var _0x10c213=users[_0x44adcb(0x1b2)];else{if(_0x3b97bb[0x0][_0x44adcb(0x184)]==_0x44adcb(0x18d))var _0x10c213=users[_0x44adcb(0x18d)];else{if(_0x3b97bb[0x0][_0x44adcb(0x184)]==_0x44adcb(0x114))var _0x10c213=users[_0x44adcb(0x114)];else{if(_0x3b97bb[0x0][_0x44adcb(0x184)]=='Spanish')var _0x10c213=users['Spanish'];else{if(_0x3b97bb[0x0]['language']==_0x44adcb(0x16f))var _0x10c213=users['French'];else{if(_0x3b97bb[0x0][_0x44adcb(0x184)]==_0x44adcb(0x119))var _0x10c213=users['Portuguese'];else{if(_0x3b97bb[0x0][_0x44adcb(0x184)]==_0x44adcb(0xe7))var _0x10c213=users[_0x44adcb(0xe7)];else{if(_0x3b97bb[0x0][_0x44adcb(0x184)]==_0x44adcb(0x179))var _0x10c213=users['Arabic'];}}}}}}}_0x2138bf[_0x44adcb(0xfc)](_0x44adcb(0x135),{'success':_0x14839c[_0x44adcb(0x1b4)]('success'),'errors':_0x14839c[_0x44adcb(0x1b4)]('errors'),'role':_0x458175,'profile':_0x208dc1,'alldata':_0x5b7dbb,'master_shop':_0x3b97bb,'language':_0x10c213});}catch(_0x3c7180){console[_0x44adcb(0x13e)](_0x3c7180);}}),router[a0_0x2afbb8(0xfa)](a0_0x2afbb8(0x1b1),async(_0x56c2fa,_0x268b77)=>{var _0x576e7c=a0_0x2afbb8;const {product_code:_0x5ecdd9,warehouse_name:_0x2cdc7a,rooms_data:_0x18dee6,Roomslist:_0x490a5b}=_0x56c2fa[_0x576e7c(0x18a)],_0x15738d=_0x490a5b[_0x576e7c(0x106)](','),_0x1edf0c=[];async function _0x20764c(_0x124df0){var _0x4d866a=_0x576e7c;const _0x29ab4b=await warehouse[_0x4d866a(0x132)]([{'$match':{'name':_0x2cdc7a,'room':_0x124df0}},{'$unwind':_0x4d866a(0x187)},{'$match':{'product_details.primary_code':_0x5ecdd9}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4d866a(0x137)},'primary_code':{'$first':_0x4d866a(0x17b)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x4d866a(0x1e6)},'type':{'$first':_0x4d866a(0x171)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x4d866a(0x1c4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4d866a(0x1d5)},'expiry_date':{'$first':_0x4d866a(0x131)},'production_date':{'$first':_0x4d866a(0xef)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x4d866a(0x120)},'product_cat':{'$first':_0x4d866a(0x1bb)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4d866a(0x133)},'invoice':{'$first':_0x4d866a(0x1d2)}}}]),_0x4bcffa=await warehouse[_0x4d866a(0x132)]([{'$match':{'name':_0x2cdc7a,'room':_0x124df0}},{'$unwind':_0x4d866a(0x187)},{'$match':{'product_details.secondary_code':_0x5ecdd9}},{'$group':{'_id':_0x4d866a(0x1d8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x4d866a(0x17b)},'secondary_code':{'$first':_0x4d866a(0x1cb)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x4d866a(0x191)},'isle':{'$first':_0x4d866a(0x1e6)},'type':{'$first':_0x4d866a(0x171)},'pallet':{'$first':_0x4d866a(0x194)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x4d866a(0x1c4)},'storage':{'$first':_0x4d866a(0x175)},'rack':{'$first':_0x4d866a(0x1d5)},'expiry_date':{'$first':_0x4d866a(0x131)},'production_date':{'$first':_0x4d866a(0xef)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x4d866a(0x120)},'product_cat':{'$first':_0x4d866a(0x1bb)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x4d866a(0x133)},'invoice':{'$first':_0x4d866a(0x1d2)}}}]);if(_0x29ab4b[_0x4d866a(0x1fd)]>0x0)_0x1edf0c[_0x4d866a(0x1cd)](_0x29ab4b);else _0x4bcffa['length']>0x0&&_0x1edf0c[_0x4d866a(0x1cd)](_0x4bcffa);}const _0x4e8770=_0x15738d[_0x576e7c(0x101)](_0x3e1e41=>_0x20764c(_0x3e1e41));await Promise[_0x576e7c(0x186)](_0x4e8770),_0x268b77[_0x576e7c(0x1dc)](_0x1edf0c);}),module[a0_0x2afbb8(0x1a6)]=router;