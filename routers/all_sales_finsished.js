function a0_0x51b4(_0x2e1cd2,_0x16e8d9){var _0x462b9d=a0_0x462b();return a0_0x51b4=function(_0x51b484,_0xb035bb){_0x51b484=_0x51b484-0x10a;var _0x4aa6b9=_0x462b9d[_0x51b484];return _0x4aa6b9;},a0_0x51b4(_0x2e1cd2,_0x16e8d9);}var a0_0x19bcca=a0_0x51b4;(function(_0x408036,_0x4f1c11){var _0x3df8cd=a0_0x51b4,_0x22fd78=_0x408036();while(!![]){try{var _0x55b8f7=-parseInt(_0x3df8cd(0x130))/0x1*(parseInt(_0x3df8cd(0x126))/0x2)+-parseInt(_0x3df8cd(0x1dd))/0x3+-parseInt(_0x3df8cd(0x138))/0x4*(parseInt(_0x3df8cd(0x1b3))/0x5)+parseInt(_0x3df8cd(0x1c2))/0x6*(-parseInt(_0x3df8cd(0x166))/0x7)+-parseInt(_0x3df8cd(0x121))/0x8*(parseInt(_0x3df8cd(0x12a))/0x9)+parseInt(_0x3df8cd(0x217))/0xa+parseInt(_0x3df8cd(0x12d))/0xb;if(_0x55b8f7===_0x4f1c11)break;else _0x22fd78['push'](_0x22fd78['shift']());}catch(_0x3270ce){_0x22fd78['push'](_0x22fd78['shift']());}}}(a0_0x462b,0xc736e));const express=require('express'),app=express(),router=express[a0_0x19bcca(0x1a6)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x19bcca(0x1cc)),nodemailer=require('nodemailer'),users=require(a0_0x19bcca(0x192));function a0_0x462b(){var _0x286b4b=['purchases_data','Logo.png','<html><head><title></title>','date','</body></html>','/all_sales/view','<h5\x20style=\x22text-align:\x20left;\x22>','customers_docs','</tr>','Spanish','secondary_code_QA','../public/language/languages.json','Hindi','/view/return_sales/:id','stocks_QA','Portuguese','prod_invoice','final','OUTF-','$room','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','maxProducts','id_transaction_from','$product_details','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$warehouse_name','render','post','<tr>','currency_placement','$product_details.batch_code','Router','product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','level','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$product_details.product_cat','product_name_QA1','gmail','$date','customer','image','primary_code','51455AQqEBL','<strong>\x20Regards\x20</strong>','room_name','Quality\x20Inspection','$product_details.production_date','map','<span\x20style=\x22float:\x20right;\x22>','/all_sales_finished/view','Sales\x20Update\x20successfully','Sale\x20Return\x20Mail','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','string','expiry_date_QA','batch_code','8628xcUgqv','RoomAssigned','$note','primary_code_QA','catch','Sale\x20Return','</table>','$product_details.product_code','sale_qty','barcode\x20Product\x20master','../middleware/auth','Enabled','Chinese','$finalize','$product_details.maxPerUnit','$product_details.storage','prod_cat','$sale_product','$product_details.bay','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','flash','aggregate','production_date_QA','</tbody>','$return_data','return_sale_QA','port','2439048jJbwgk','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','carton','return_sale_finished','Arabic\x20(ae)','$sale_product.type','$_id','<tbody\x20style=\x22text-align:\x20center;\x22>','\x20<<<==>>>\x20','return_qty','abs','warehouse_name','prod_code','unit_QA','$product_details.product_stock','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','An\x20error\x20occurred.','\x20</h2>','/../public','sales_quantity_QA','product_list','Arabic','then','unit','English','filter','Return\x20Goods','message','findOne','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/view','maxPerUnit','success','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','host','forEach','redirect','$product_details.floorlevel','production_date','due_amount','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','\x20==\x20','findById','status','add_sales_finished','batch_code_QA','/picking_list/pdf/','$invoice','FGSEmail','quantity','return_qty_QA','return_data','Received\x20Payment\x20For\x20Sale','add\x20post','stock_data','maxperunit','10338980xiKOMn','slice','/view/add_sales','Email\x20sent\x20successfully','$product_details.bin','password','</div>','</h5>','getFullYear','site_title','get','$product_details.expiry_date','sendMail','invoice','True','sale_product','$sale_product.bay','\x20Order\x20Number\x20:\x20','product_code','warehouse','product_date','</head><body>','$product_details.type','German','user','</span>','barcode\x20user_id','product_code_QA','$product_details.invoice','$customer','_id','$product','role','secondary_unit_QA','toString','8StmDVh','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','find','sales_invoice','sales\x20item\x20return\x20successfull','1424266DjnRFH','$product_details.secondary_code','received_amount','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','9149481bccPHT','\x20&&\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','44521268IZpGhs','$name','$product_details.unit','1ZmBnIE','$product_details.rack','$product_details.product_name','adjust_qty','log','$product_details._id','Add\x20Sales','There\x27s\x20a\x20error\x20in\x20this\x20transaction','168xxmxME','name','staff','$product_details.primary_code','<!DOCTYPE\x20html>','Enclosed','$product_details.secondary_unit','maxPerUnit_QA','note','primary_unit','$customers_docs','floor','expiry_date','/preview/:id','concat','all_sales_finished','push','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','\x20Order\x20Date\x20:\x20','language','bay','maxProducts_QA','False','$product_details.room_name','params','json','An\x20error\x20occurred\x20while\x20saving\x20data.','English\x20(US)','christian.villamer@jakagroup.com','</thead>','customer_data','$sale_product.bin','logo','secondary_unit','product_data','return_sale','getMonth','customers','</td>','createTransport','master','stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','errors','secondary_code','/upload/','6286MJxtYA','/give_payment/:id','back','<h2>\x20','random','amount','sales_quantity','/all_sales_finished/preview/','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$sale_product.quantity','error','save','Sale','product','currency','edit_sales_finished_view','product_stock','Portuguese\x20(BR)','getDate','product_details','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','length','body','$sale_product.floorlevel','<div>','/view/add_sale/product','/view/:id','max','<h5>','French','email','for_categorize'];a0_0x462b=function(){return _0x286b4b;};return a0_0x462b();}router[a0_0x19bcca(0x221)](a0_0x19bcca(0x1fd),auth,async(_0x536f8d,_0x2f5b15)=>{var _0x565d7a=a0_0x19bcca;try{const {username:_0x4b44fc,email:_0x42eefc,role:_0x3a5939}=_0x536f8d[_0x565d7a(0x116)],_0x34fafe=_0x536f8d[_0x565d7a(0x116)],_0x14e65f=await profile[_0x565d7a(0x1fa)]({'email':_0x34fafe[_0x565d7a(0x185)]}),_0x1ce925=await master_shop['find']();let _0x3ac2fd;if(_0x34fafe[_0x565d7a(0x11e)]=='staff'){const _0x560d04=await staff[_0x565d7a(0x1fa)]({'email':_0x34fafe[_0x565d7a(0x185)]});_0x3ac2fd=await sales_finished['aggregate']([{'$lookup':{'from':_0x565d7a(0x15d),'localField':_0x565d7a(0x1b0),'foreignField':_0x565d7a(0x139),'as':_0x565d7a(0x18e)}},{'$unwind':_0x565d7a(0x142)},{'$unwind':_0x565d7a(0x1d3)},{'$group':{'_id':_0x565d7a(0x1e4),'invoice':{'$first':_0x565d7a(0x20e)},'customers':{'$first':_0x565d7a(0x11b)},'date':{'$first':_0x565d7a(0x1af)},'warehouse_name':{'$first':_0x565d7a(0x1a0)},'sale_product':{'$push':_0x565d7a(0x1d3)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x565d7a(0x10e)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x565d7a(0x1e3)},'pallet':{'$addToSet':_0x565d7a(0x17e)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x3ac2fd=await sales_finished['aggregate']([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x565d7a(0x139),'as':_0x565d7a(0x18e)}},{'$unwind':_0x565d7a(0x142)},{'$unwind':_0x565d7a(0x1d3)},{'$group':{'_id':_0x565d7a(0x1e4),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x565d7a(0x1af)},'warehouse_name':{'$first':_0x565d7a(0x1a0)},'sale_product':{'$push':_0x565d7a(0x1d3)},'note':{'$first':_0x565d7a(0x1c4)},'return_data':{'$first':_0x565d7a(0x1da)},'customers_docs':{'$first':_0x565d7a(0x142)},'total_saleproduct_quantity':{'$sum':_0x565d7a(0x170)},'level':{'$addToSet':_0x565d7a(0x10e)},'isle':{'$addToSet':_0x565d7a(0x157)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x565d7a(0x17e)},'finalize':{'$first':_0x565d7a(0x1cf)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x1ce925[0x0][_0x565d7a(0x14b)]=='English\x20(US)'){var _0x74e6b8=users['English'];console[_0x565d7a(0x134)](_0x74e6b8);}else{if(_0x1ce925[0x0]['language']=='Hindi')var _0x74e6b8=users['Hindi'];else{if(_0x1ce925[0x0][_0x565d7a(0x14b)]=='German')var _0x74e6b8=users['German'];else{if(_0x1ce925[0x0]['language']==_0x565d7a(0x190))var _0x74e6b8=users['Spanish'];else{if(_0x1ce925[0x0]['language']==_0x565d7a(0x184))var _0x74e6b8=users[_0x565d7a(0x184)];else{if(_0x1ce925[0x0][_0x565d7a(0x14b)]==_0x565d7a(0x178))var _0x74e6b8=users[_0x565d7a(0x196)];else{if(_0x1ce925[0x0]['language']=='Chinese')var _0x74e6b8=users[_0x565d7a(0x1ce)];else{if(_0x1ce925[0x0][_0x565d7a(0x14b)]==_0x565d7a(0x1e2))var _0x74e6b8=users[_0x565d7a(0x1f3)];}}}}}}}_0x2f5b15['render'](_0x565d7a(0x147),{'success':_0x536f8d[_0x565d7a(0x1d6)](_0x565d7a(0x1ff)),'errors':_0x536f8d[_0x565d7a(0x1d6)](_0x565d7a(0x163)),'sales':_0x3ac2fd,'profile':_0x14e65f,'role':_0x34fafe,'master_shop':_0x1ce925,'language':_0x74e6b8});}catch(_0x79440c){console[_0x565d7a(0x134)](_0x79440c);}});async function getRandom8DigitNumber(){var _0x280f40=a0_0x19bcca;const _0x3126c9=0x989680,_0x2664de=0x5f5e0ff,_0x11ab98=Math[_0x280f40(0x143)](Math[_0x280f40(0x16a)]()*(_0x2664de-_0x3126c9+0x1))+_0x3126c9;var _0x53ecb6;const _0x31121b=await sales_finished['findOne']({'invoice':'OUTF-'+_0x11ab98});return _0x31121b&&_0x31121b[_0x280f40(0x17c)]>0x0?_0x53ecb6=_0x280f40(0x199)+_0x11ab98:_0x53ecb6=_0x280f40(0x199)+_0x11ab98,_0x53ecb6;}router['get'](a0_0x19bcca(0x219),auth,async(_0x1dda77,_0x421838)=>{var _0x1bb70d=a0_0x19bcca;try{const {username:_0xe97be3,email:_0x119813,role:_0x1241af}=_0x1dda77[_0x1bb70d(0x116)],_0xc9f47a=_0x1dda77[_0x1bb70d(0x116)],_0x1fba2e=await profile['findOne']({'email':_0xc9f47a[_0x1bb70d(0x185)]}),_0x5b2477=await master_shop[_0x1bb70d(0x123)](),_0x4b8060=await customer[_0x1bb70d(0x123)]({});let _0x12a464;if(_0xc9f47a[_0x1bb70d(0x11e)]==_0x1bb70d(0x13a)){const _0x366750=await staff[_0x1bb70d(0x1fa)]({'email':_0xc9f47a[_0x1bb70d(0x185)]});_0x12a464=await warehouse[_0x1bb70d(0x1d7)]([{'$match':{'status':'Enabled','name':_0x366750[_0x1bb70d(0x111)],'warehouse_category':_0x1bb70d(0x1de),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x1bb70d(0x12e),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x12a464=await warehouse[_0x1bb70d(0x1d7)]([{'$match':{'status':'Enabled','warehouse_category':_0x1bb70d(0x1de),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x1bb70d(0x12e),'name':{'$first':_0x1bb70d(0x12e)}}},{'$sort':{'name':0x1}}]);const _0x285321=await product[_0x1bb70d(0x123)]({});var _0x30bc31=['Ambient',_0x1bb70d(0x13d)];const _0x43f2ce=await sales_finished[_0x1bb70d(0x123)]({}),_0x2d243d=_0x43f2ce[_0x1bb70d(0x17c)]+0x1,_0x4fde38='OUTF-'+_0x2d243d[_0x1bb70d(0x120)]()['padStart'](0x5,'0');if(_0x5b2477[0x0][_0x1bb70d(0x14b)]==_0x1bb70d(0x153)){var _0x37f260=users[_0x1bb70d(0x1f6)];console[_0x1bb70d(0x134)](_0x37f260);}else{if(_0x5b2477[0x0][_0x1bb70d(0x14b)]=='Hindi')var _0x37f260=users[_0x1bb70d(0x193)];else{if(_0x5b2477[0x0][_0x1bb70d(0x14b)]==_0x1bb70d(0x115))var _0x37f260=users[_0x1bb70d(0x115)];else{if(_0x5b2477[0x0][_0x1bb70d(0x14b)]==_0x1bb70d(0x190))var _0x37f260=users[_0x1bb70d(0x190)];else{if(_0x5b2477[0x0][_0x1bb70d(0x14b)]=='French')var _0x37f260=users[_0x1bb70d(0x184)];else{if(_0x5b2477[0x0][_0x1bb70d(0x14b)]==_0x1bb70d(0x178))var _0x37f260=users[_0x1bb70d(0x196)];else{if(_0x5b2477[0x0][_0x1bb70d(0x14b)]==_0x1bb70d(0x1ce))var _0x37f260=users['Chinese'];else{if(_0x5b2477[0x0][_0x1bb70d(0x14b)]==_0x1bb70d(0x1e2))var _0x37f260=users[_0x1bb70d(0x1f3)];}}}}}}}const _0x2019a1=getRandom8DigitNumber();_0x2019a1[_0x1bb70d(0x1f4)](_0x50f3bb=>{var _0x5d70cf=_0x1bb70d;_0x421838[_0x5d70cf(0x1a1)](_0x5d70cf(0x20b),{'success':_0x1dda77['flash']('success'),'errors':_0x1dda77[_0x5d70cf(0x1d6)](_0x5d70cf(0x163)),'role':_0xc9f47a,'profile':_0x1fba2e,'customer':_0x4b8060,'warehouse':_0x12a464,'product':_0x285321,'invoice':_0x50f3bb,'master_shop':_0x5b2477,'language':_0x37f260,'rooms_data':_0x30bc31});})[_0x1bb70d(0x1c6)](_0x3ad7bf=>{var _0x2ea453=_0x1bb70d;_0x1dda77[_0x2ea453(0x1d6)]('errors',_0x2ea453(0x137)),_0x421838[_0x2ea453(0x203)](_0x2ea453(0x1ba));});}catch(_0x2da246){console[_0x1bb70d(0x134)](_0x2da246);}}),router[a0_0x19bcca(0x221)]('/view/add_sales/:id',auth,async(_0x18de95,_0x4e9edd)=>{var _0x2d39c2=a0_0x19bcca;try{const _0x3526dc=_0x18de95[_0x2d39c2(0x150)]['id'];console[_0x2d39c2(0x134)](_0x3526dc);const _0x1da2f5=await product[_0x2d39c2(0x123)](),_0xf4e130=await purchases[_0x2d39c2(0x1d7)]([{'$match':{'warehouse_name':_0x3526dc}},{'$unwind':_0x2d39c2(0x11d)},{'$group':{'_id':'$product.product_name'}}]);console[_0x2d39c2(0x134)](_0x2d39c2(0x187),_0xf4e130),_0x4e9edd[_0x2d39c2(0x20a)](0xc8)['json']({'purchases_data':_0xf4e130,'product_data':_0x1da2f5});}catch(_0x557241){console[_0x2d39c2(0x134)](_0x557241);}}),router[a0_0x19bcca(0x1a2)](a0_0x19bcca(0x180),auth,async(_0x4d36b6,_0x35610f)=>{var _0xd1ee17=a0_0x19bcca;try{const {warehouse_data:_0xb831a9,product_data:_0xda0ddb}=_0x4d36b6[_0xd1ee17(0x17d)];console[_0xd1ee17(0x134)](_0x4d36b6[_0xd1ee17(0x17d)][_0xd1ee17(0x15a)]);;const _0x5bb0c7=await master_shop[_0xd1ee17(0x123)]();console[_0xd1ee17(0x134)](_0xd1ee17(0x160),_0x5bb0c7);const _0x32bda7=await product[_0xd1ee17(0x1fa)]({'name':_0xda0ddb});console['log'](_0xd1ee17(0x174),_0x32bda7);const _0x3ed072=await warehouse[_0xd1ee17(0x1d7)]([{'$match':{'name':_0xb831a9}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0xda0ddb}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0xd1ee17(0x134)](_0xd1ee17(0x215),_0x3ed072),_0x35610f['status'](0xc8)['json']({'master':_0x5bb0c7,'new_product':_0x32bda7,'stock_data':_0x3ed072});}catch(_0x4cfa7d){console['log'](_0x4cfa7d);}}),router[a0_0x19bcca(0x1a2)](a0_0x19bcca(0x219),auth,async(_0x375b15,_0x45efa7)=>{var _0x33ef2c=a0_0x19bcca;try{const {invoice:_0x6980a3,date:_0x5986e1,warehouse_name:_0xc5f370,product_name:_0x3e1f01,stock:_0x197e72,quantity:_0x396ef7,note:_0x18f958,room:_0x13f070,primary_code:_0xd3e24e,secondary_code:_0x4f97ab,prod_code:_0x4ecf9e,level:_0x3b078c,isle:_0x1fc8da,pallet:_0x44cb41,batch_code:_0xf27847,SCRN:_0x222780,expiry_date:_0x6a69a4,mode_transpo:_0x4f2586,name_driver:_0xa57011}=_0x375b15[_0x33ef2c(0x17d)];if(typeof _0x3e1f01==_0x33ef2c(0x1bf))var _0x5a9146=[_0x375b15[_0x33ef2c(0x17d)]['product_name']],_0x129aea=[_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x161)]],_0x46877b=[_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x1e0)]],_0x5c09db=[_0x375b15['body']['primary_code']],_0xa14c5a=[_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x164)]],_0x4910f9=[_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x1ea)]],_0x316677=[_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x1a9)]],_0x21c624=[_0x375b15[_0x33ef2c(0x17d)]['primary_unit']],_0x478b7a=[_0x375b15[_0x33ef2c(0x17d)]['secondary_unit']],_0x2ac09c=[_0x375b15[_0x33ef2c(0x17d)]['batch_code']],_0x1a10bf=[_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x144)]],_0x36f906=[_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x112)]],_0x4240de=[_0x375b15[_0x33ef2c(0x17d)]['max_per_unit']],_0xc38883=[_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x1d2)]],_0xe2244=[_0x375b15['body']['RoomAssigned']],_0x1475f6=[_0x375b15['body']['prod_invoice']],_0x1b9526=[_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x19d)]];else var _0x5a9146=[..._0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x1a7)]],_0x129aea=[..._0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x161)]],_0x46877b=[..._0x375b15['body'][_0x33ef2c(0x1e0)]],_0x5c09db=[..._0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x1b2)]],_0xa14c5a=[..._0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x164)]],_0x4910f9=[..._0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x1ea)]],_0x316677=[..._0x375b15[_0x33ef2c(0x17d)]['level']],_0x21c624=[..._0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x141)]],_0x478b7a=[..._0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x159)]],_0x2ac09c=[..._0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x1c1)]],_0x1a10bf=[..._0x375b15['body']['expiry_date']],_0x36f906=[..._0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x112)]],_0x4240de=[..._0x375b15['body']['max_per_unit']],_0xc38883=[..._0x375b15['body'][_0x33ef2c(0x1d2)]],_0xe2244=[..._0x375b15['body'][_0x33ef2c(0x1c3)]],_0x1475f6=[..._0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x197)]],_0x1b9526=[..._0x375b15['body'][_0x33ef2c(0x19d)]];const _0x42c28c=_0x5a9146[_0x33ef2c(0x1b8)](_0x31272e=>{return _0x31272e={'product_name':_0x31272e};});_0x129aea[_0x33ef2c(0x202)]((_0x59da85,_0x2ba4af)=>{var _0x2c6a25=_0x33ef2c;_0x42c28c[_0x2ba4af][_0x2c6a25(0x161)]=_0x59da85;}),_0x46877b[_0x33ef2c(0x202)]((_0x311223,_0xb5b836)=>{var _0x278dfd=_0x33ef2c;_0x42c28c[_0xb5b836][_0x278dfd(0x210)]=Math[_0x278dfd(0x1e8)](_0x311223);}),_0x1b9526[_0x33ef2c(0x202)]((_0x1858a4,_0x6f0f45)=>{var _0x2f4db0=_0x33ef2c;_0x42c28c[_0x6f0f45][_0x2f4db0(0x19d)]=_0x1858a4;}),_0x5c09db[_0x33ef2c(0x202)]((_0xc5c32,_0x23fb47)=>{_0x42c28c[_0x23fb47]['primary_code']=_0xc5c32;}),_0xa14c5a['forEach']((_0x1c885b,_0x1f8d4d)=>{_0x42c28c[_0x1f8d4d]['secondary_code']=_0x1c885b;}),_0x4910f9[_0x33ef2c(0x202)]((_0x1e0e3d,_0x5a4ae9)=>{var _0x49c529=_0x33ef2c;_0x42c28c[_0x5a4ae9][_0x49c529(0x110)]=_0x1e0e3d;}),_0x316677[_0x33ef2c(0x202)]((_0xd3e880,_0x17df55)=>{var _0x271b73=_0x33ef2c;_0x42c28c[_0x17df55][_0x271b73(0x14c)]=_0xd3e880;}),_0x21c624[_0x33ef2c(0x202)]((_0x42e4ab,_0x48e21f)=>{_0x42c28c[_0x48e21f]['unit']=_0x42e4ab;}),_0x478b7a[_0x33ef2c(0x202)]((_0x125a45,_0x208a4a)=>{var _0x3b7cd7=_0x33ef2c;_0x42c28c[_0x208a4a][_0x3b7cd7(0x159)]=_0x125a45;}),_0x2ac09c[_0x33ef2c(0x202)]((_0x2ec993,_0x470920)=>{_0x42c28c[_0x470920]['batch_code']=_0x2ec993;}),_0x1a10bf['forEach']((_0x2d990c,_0xbb3fc)=>{var _0x36e719=_0x33ef2c;_0x42c28c[_0xbb3fc][_0x36e719(0x144)]=_0x2d990c;}),_0x36f906['forEach']((_0x81ff4a,_0x25d74c)=>{var _0x1c311b=_0x33ef2c;_0x42c28c[_0x25d74c][_0x1c311b(0x205)]=_0x81ff4a;}),_0x4240de['forEach']((_0x2f86a5,_0x52f5d3)=>{var _0x1979d7=_0x33ef2c;_0x42c28c[_0x52f5d3][_0x1979d7(0x216)]=_0x2f86a5;}),_0xc38883[_0x33ef2c(0x202)]((_0x266f1d,_0x398b37)=>{var _0x4c33dc=_0x33ef2c;_0x42c28c[_0x398b37][_0x4c33dc(0x1d2)]=_0x266f1d;}),_0xe2244[_0x33ef2c(0x202)]((_0x9d623f,_0x5e2982)=>{var _0x2bac51=_0x33ef2c;_0x42c28c[_0x5e2982][_0x2bac51(0x1b5)]=_0x9d623f;}),_0x1475f6[_0x33ef2c(0x202)]((_0x4335c3,_0x6bbe64)=>{var _0x4921a8=_0x33ef2c;_0x42c28c[_0x6bbe64][_0x4921a8(0x10b)]=_0x4335c3;});var _0x36ae0c=0x0;_0x42c28c[_0x33ef2c(0x202)](_0x532bab=>{var _0x4cdfb5=_0x33ef2c;parseFloat(_0x532bab['stock'])<parseFloat(_0x532bab['quantity'])&&parseFloat(_0x532bab[_0x4cdfb5(0x210)])>parseFloat(_0x532bab[_0x4cdfb5(0x161)])&&(console[_0x4cdfb5(0x134)](_0x532bab['stock']+'\x20<>\x20'+_0x532bab[_0x4cdfb5(0x210)]),_0x36ae0c++);});if(_0x36ae0c!=0x0)return _0x375b15['flash']('errors',_0x33ef2c(0x200)),_0x45efa7['redirect'](_0x33ef2c(0x168));const _0x487711=_0x42c28c['filter'](_0x132c19=>_0x132c19[_0x33ef2c(0x210)]!=='0'&&_0x132c19[_0x33ef2c(0x210)]!==''),_0x39a045=new sales_finished({'invoice':_0x6980a3,'customer':_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x1b0)],'date':_0x5986e1,'warehouse_name':_0xc5f370,'sale_product':_0x487711,'note':_0x18f958,'room':_0x13f070,'primary_code':_0xd3e24e,'secondary_code':_0x4f97ab,'prod_code':_0x4ecf9e,'SCRN':_0x222780,'finalize':_0x33ef2c(0x14e),'mode_transpo':_0x4f2586,'name_driver':_0xa57011}),_0x482319=await _0x39a045[_0x33ef2c(0x172)](),_0x565fee=await sales_finished[_0x33ef2c(0x1fa)]({'invoice':_0x6980a3}),_0x15ed7b=new c_payment_data({'invoice':_0x6980a3,'customer':_0x375b15[_0x33ef2c(0x17d)]['customer'],'reason':_0x33ef2c(0x173)});await _0x15ed7b['save']();const _0x5231fc=await master_shop[_0x33ef2c(0x123)](),_0x13b2f9=await email_settings[_0x33ef2c(0x1fa)](),_0x31dea2=await customer[_0x33ef2c(0x1fa)]({'name':_0x375b15[_0x33ef2c(0x17d)][_0x33ef2c(0x1b0)]});_0x5231fc[0x0][_0x33ef2c(0x1a4)]==0x1?(right_currency=_0x5231fc[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5231fc[0x0]['currency']);var _0x49de9a=_0x5a9146,_0x124396=_0x46877b,_0x46edfb='',_0x31fdce;for(_0x31fdce in _0x49de9a){_0x46edfb+=_0x33ef2c(0x1a3)+_0x33ef2c(0x207)+_0x49de9a[_0x31fdce]+'</td>'+_0x33ef2c(0x207)+_0x124396[_0x31fdce]+_0x33ef2c(0x15e)+_0x33ef2c(0x18f);}console[_0x33ef2c(0x134)](_0x33ef2c(0x1f2),_0x46edfb);let _0x2cec6f=nodemailer[_0x33ef2c(0x15f)]({'host':_0x13b2f9[_0x33ef2c(0x201)],'port':Number(_0x13b2f9['port']),'secure':![],'service':_0x33ef2c(0x1ae),'auth':{'user':_0x13b2f9[_0x33ef2c(0x185)],'pass':_0x13b2f9['password']}}),_0xb4bd0e={'from':_0x13b2f9[_0x33ef2c(0x185)],'to':_0x33ef2c(0x154),'subject':_0x33ef2c(0x136),'attachments':[{'filename':_0x33ef2c(0x188),'path':__dirname+_0x33ef2c(0x1f0)+_0x33ef2c(0x165)+_0x5231fc[0x0][_0x33ef2c(0x1b1)],'cid':'logo'}],'html':'ADD\x20SALE'};_0x2cec6f['sendMail'](_0xb4bd0e,function(_0x4ff3a9,_0x30be15){var _0x3c566a=_0x33ef2c;_0x4ff3a9?(console['log'](_0x4ff3a9),console[_0x3c566a(0x134)](_0x3c566a(0x16e))):console[_0x3c566a(0x134)]('Email\x20sent\x20successfully');}),_0x375b15['flash']('success','Sales\x20Add\x20successfully'),_0x45efa7[_0x33ef2c(0x203)](_0x33ef2c(0x16d)+_0x482319[_0x33ef2c(0x11c)]);}catch(_0x1e6a96){console[_0x33ef2c(0x134)](_0x1e6a96);}}),router['get'](a0_0x19bcca(0x145),auth,async(_0x2d74ab,_0x48b0d8)=>{var _0x42f7ab=a0_0x19bcca;try{const {username:_0x56e768,email:_0x36f13b,role:_0x1439f2}=_0x2d74ab[_0x42f7ab(0x116)],_0x47053a=_0x2d74ab[_0x42f7ab(0x116)],_0x167f52=await profile[_0x42f7ab(0x1fa)]({'email':_0x47053a['email']}),_0x1928d1=await master_shop[_0x42f7ab(0x123)](),_0x28a9f2=_0x2d74ab[_0x42f7ab(0x150)]['id'],_0x3684ee=await sales_finished['findById'](_0x28a9f2),_0x5681bf=await warehouse[_0x42f7ab(0x1d7)]([{'$match':{'name':_0x3684ee['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x42f7ab(0x135),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x42f7ab(0x1ec)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x42f7ab(0x21b)},'type':{'$first':_0x42f7ab(0x114)},'floorlevel':{'$first':_0x42f7ab(0x204)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x42f7ab(0x127)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x42f7ab(0x1d1)},'rack':{'$first':_0x42f7ab(0x131)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x42f7ab(0x1b7)},'batch_code':{'$first':_0x42f7ab(0x1a5)},'room':{'$first':'$room'},'room_data':{'$first':_0x42f7ab(0x14f)}}}]),_0x2d5a47=await customer[_0x42f7ab(0x123)]({});let _0x2aa03e;if(_0x47053a[_0x42f7ab(0x11e)]==_0x42f7ab(0x13a)){const _0xf2b5f2=await staff[_0x42f7ab(0x1fa)]({'email':_0x47053a[_0x42f7ab(0x185)]});_0x2aa03e=await warehouse[_0x42f7ab(0x1d7)]([{'$match':{'status':_0x42f7ab(0x1cd),'name':_0xf2b5f2['warehouse']}},{'$group':{'_id':_0x42f7ab(0x12e),'name':{'$first':_0x42f7ab(0x12e)}}}]);}else _0x2aa03e=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x42f7ab(0x12e),'name':{'$first':_0x42f7ab(0x12e)}}}]);const _0xb9dd82=await product[_0x42f7ab(0x123)]({});if(_0x1928d1[0x0][_0x42f7ab(0x14b)]==_0x42f7ab(0x153)){var _0x3d7f11=users[_0x42f7ab(0x1f6)];console[_0x42f7ab(0x134)](_0x3d7f11);}else{if(_0x1928d1[0x0][_0x42f7ab(0x14b)]==_0x42f7ab(0x193))var _0x3d7f11=users[_0x42f7ab(0x193)];else{if(_0x1928d1[0x0][_0x42f7ab(0x14b)]=='German')var _0x3d7f11=users['German'];else{if(_0x1928d1[0x0][_0x42f7ab(0x14b)]==_0x42f7ab(0x190))var _0x3d7f11=users[_0x42f7ab(0x190)];else{if(_0x1928d1[0x0]['language']==_0x42f7ab(0x184))var _0x3d7f11=users[_0x42f7ab(0x184)];else{if(_0x1928d1[0x0][_0x42f7ab(0x14b)]==_0x42f7ab(0x178))var _0x3d7f11=users[_0x42f7ab(0x196)];else{if(_0x1928d1[0x0]['language']==_0x42f7ab(0x1ce))var _0x3d7f11=users['Chinese'];else{if(_0x1928d1[0x0][_0x42f7ab(0x14b)]==_0x42f7ab(0x1e2))var _0x3d7f11=users[_0x42f7ab(0x1f3)];}}}}}}}_0x48b0d8[_0x42f7ab(0x1a1)](_0x42f7ab(0x176),{'success':_0x2d74ab[_0x42f7ab(0x1d6)](_0x42f7ab(0x1ff)),'errors':_0x2d74ab[_0x42f7ab(0x1d6)](_0x42f7ab(0x163)),'role':_0x47053a,'profile':_0x167f52,'customer':_0x2d5a47,'warehouse':_0x2aa03e,'product':_0x5681bf,'user':_0x3684ee,'master_shop':_0x1928d1,'unit':_0xb9dd82,'language':_0x3d7f11});}catch(_0x19634c){console[_0x42f7ab(0x134)](_0x19634c);}}),router['post'](a0_0x19bcca(0x145),auth,async(_0x2cc866,_0x5d6361)=>{var _0x37bad8=a0_0x19bcca;try{const _0x10da61=_0x2cc866[_0x37bad8(0x150)]['id'],{invoice:_0x36599d,warehouse_name:_0x513612,room:_0x3513e3}=_0x2cc866[_0x37bad8(0x17d)],_0x18909e=await sales_finished[_0x37bad8(0x1fa)]({'invoice':_0x36599d}),_0x31a7aa=_0x18909e[_0x37bad8(0x10d)][_0x37bad8(0x1b8)](async _0x5963d4=>{var _0x4972a4=_0x37bad8,_0x347dc3=await warehouse[_0x4972a4(0x1fa)]({'name':_0x513612,'room':_0x5963d4[_0x4972a4(0x1b5)],'warehouse_category':_0x4972a4(0x1de)});const _0x390157=_0x347dc3[_0x4972a4(0x17a)][_0x4972a4(0x1b8)](_0x4822f2=>{var _0x422bbf=_0x4972a4;(_0x4822f2[_0x422bbf(0x1a7)]==_0x5963d4[_0x422bbf(0x1a7)]&&_0x4822f2[_0x422bbf(0x14c)]==_0x5963d4['bay']&&_0x4822f2[_0x422bbf(0x144)]==_0x5963d4[_0x422bbf(0x144)]&&_0x4822f2[_0x422bbf(0x205)]==_0x5963d4[_0x422bbf(0x205)]&&_0x4822f2['batch_code']==_0x5963d4[_0x422bbf(0x1c1)]&&_0x4822f2[_0x422bbf(0x10b)]==_0x5963d4['invoice']||_0x4822f2[_0x422bbf(0x11c)]==_0x5963d4[_0x422bbf(0x19d)])&&(_0x4822f2['product_stock']>0x0&&(console[_0x422bbf(0x134)](_0x4822f2[_0x422bbf(0x1a7)]+_0x422bbf(0x208)+_0x5963d4[_0x422bbf(0x1a7)]+_0x422bbf(0x12b)+_0x4822f2[_0x422bbf(0x14c)]+_0x422bbf(0x208)+_0x5963d4[_0x422bbf(0x14c)]+_0x422bbf(0x12b)+_0x4822f2[_0x422bbf(0x205)]+_0x422bbf(0x208)+_0x5963d4[_0x422bbf(0x205)]+_0x422bbf(0x12b)+_0x4822f2[_0x422bbf(0x144)]+_0x422bbf(0x208)+_0x5963d4[_0x422bbf(0x144)]+'\x20&&\x20'+_0x4822f2[_0x422bbf(0x1c1)]+_0x422bbf(0x208)+_0x5963d4[_0x422bbf(0x1c1)]+_0x422bbf(0x12b)+_0x4822f2[_0x422bbf(0x10b)]+'\x20==\x20'+_0x5963d4[_0x422bbf(0x10b)]+_0x422bbf(0x12b)+_0x4822f2[_0x422bbf(0x177)]+_0x422bbf(0x1e6)+_0x5963d4[_0x422bbf(0x210)]+'\x20>>>\x20'+_0x5963d4[_0x422bbf(0x1b5)]+'\x20&&\x20'+_0x4822f2[_0x422bbf(0x11c)]+_0x422bbf(0x208)+_0x5963d4[_0x422bbf(0x19d)]),_0x4822f2[_0x422bbf(0x177)]=Math[_0x422bbf(0x182)](0x0,Math[_0x422bbf(0x1e8)](_0x4822f2[_0x422bbf(0x177)])-Math['abs'](_0x5963d4['quantity']))));});return _0x347dc3;});Promise['all'](_0x31a7aa)[_0x37bad8(0x1f4)](async _0x2c9c5c=>{var _0x50bc22=_0x37bad8;try{for(const _0x47df80 of _0x2c9c5c){await _0x47df80[_0x50bc22(0x172)]();}_0x18909e['finalize']=_0x50bc22(0x10c);const _0x56fcb5=await _0x18909e[_0x50bc22(0x172)](),_0x5ad109=await master_shop['find'](),_0x27f9cb=await email_settings[_0x50bc22(0x1fa)](),_0x2c4603=await supervisor_settings[_0x50bc22(0x123)]();var _0x3e2b88=_0x18909e[_0x50bc22(0x10d)],_0x420051='',_0x2360cd;for(_0x2360cd in _0x3e2b88){var _0x53be25='FG';_0x18909e[_0x50bc22(0x1e9)]=='DRY\x20GOODS'&&(_0x53be25='DG'),_0x420051+='<tr>'+_0x50bc22(0x207)+_0x3e2b88[_0x2360cd][_0x50bc22(0x1a7)]+_0x50bc22(0x15e)+_0x50bc22(0x207)+_0x3e2b88[_0x2360cd][_0x50bc22(0x110)]+_0x50bc22(0x15e)+_0x50bc22(0x207)+_0x3e2b88[_0x2360cd]['quantity']+_0x50bc22(0x15e)+_0x50bc22(0x207)+_0x3e2b88[_0x2360cd][_0x50bc22(0x1f5)]+'</td>'+_0x50bc22(0x207)+_0x3e2b88[_0x2360cd][_0x50bc22(0x159)]+_0x50bc22(0x15e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x18909e[_0x50bc22(0x1e9)]+_0x50bc22(0x15e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3e2b88[_0x2360cd][_0x50bc22(0x1b5)]+_0x50bc22(0x15e)+_0x50bc22(0x207)+_0x53be25+_0x3e2b88[_0x2360cd][_0x50bc22(0x14c)]+'</td>';}let _0x441c29=nodemailer[_0x50bc22(0x15f)]({'host':_0x27f9cb[_0x50bc22(0x201)],'port':Number(_0x27f9cb[_0x50bc22(0x1dc)]),'secure':![],'auth':{'user':_0x27f9cb[_0x50bc22(0x185)],'pass':_0x27f9cb[_0x50bc22(0x21c)]}}),_0x1a1441={'from':_0x27f9cb[_0x50bc22(0x185)],'to':_0x2c4603[0x0][_0x50bc22(0x20f)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x50bc22(0x188),'path':__dirname+_0x50bc22(0x1f0)+_0x50bc22(0x165)+_0x5ad109[0x0][_0x50bc22(0x1b1)],'cid':_0x50bc22(0x158)}],'html':_0x50bc22(0x13c)+_0x50bc22(0x189)+_0x50bc22(0x113)+_0x50bc22(0x17f)+_0x50bc22(0x1ed)+_0x50bc22(0x17f)+_0x50bc22(0x129)+_0x50bc22(0x21d)+_0x50bc22(0x17f)+_0x50bc22(0x169)+_0x5ad109[0x0][_0x50bc22(0x220)]+_0x50bc22(0x1ef)+_0x50bc22(0x21d)+_0x50bc22(0x21d)+_0x50bc22(0x1aa)+_0x50bc22(0x17f)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x50bc22(0x10f)+_0x18909e[_0x50bc22(0x10b)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x50bc22(0x14a)+_0x18909e[_0x50bc22(0x18a)]+'\x20'+_0x50bc22(0x117)+_0x50bc22(0x21e)+_0x50bc22(0x21d)+_0x50bc22(0x19f)+_0x50bc22(0x19b)+_0x50bc22(0x1a3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x50bc22(0x162)+_0x50bc22(0x149)+_0x50bc22(0x16f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x50bc22(0x12c)+_0x50bc22(0x1df)+_0x50bc22(0x1fc)+_0x50bc22(0x18f)+'</thead>'+_0x50bc22(0x1e5)+'\x20'+_0x420051+'\x20'+_0x50bc22(0x1d9)+_0x50bc22(0x1c8)+_0x50bc22(0x17f)+_0x50bc22(0x1b4)+_0x50bc22(0x183)+_0x5ad109[0x0][_0x50bc22(0x220)]+'</h5>'+_0x50bc22(0x21d)+_0x50bc22(0x21d)+_0x50bc22(0x18b)};_0x441c29['sendMail'](_0x1a1441,function(_0x5bc7e2,_0x2cfa4c){var _0x3c61ab=_0x50bc22;_0x5bc7e2?(console[_0x3c61ab(0x134)](_0x5bc7e2),console[_0x3c61ab(0x134)](_0x3c61ab(0x16e))):console[_0x3c61ab(0x134)](_0x3c61ab(0x21a));}),_0x2cc866[_0x50bc22(0x1d6)](_0x50bc22(0x1ff),_0x50bc22(0x1bb)),_0x5d6361['redirect'](_0x50bc22(0x20d)+_0x10da61);}catch(_0x5758c9){console[_0x50bc22(0x171)](_0x5758c9),_0x5d6361[_0x50bc22(0x20a)](0x1f4)[_0x50bc22(0x151)]({'error':_0x50bc22(0x152)});}})[_0x37bad8(0x1c6)](_0x262ccf=>{var _0x5535c2=_0x37bad8;console['error'](_0x262ccf),_0x5d6361['status'](0x1f4)['json']({'error':_0x5535c2(0x1ee)});});}catch(_0x2ad223){console[_0x37bad8(0x134)](_0x2ad223);}}),router[a0_0x19bcca(0x221)](a0_0x19bcca(0x181),auth,async(_0x6f96bd,_0x2d4295)=>{var _0x10dc69=a0_0x19bcca;try{const {username:_0x41f1e0,email:_0xc07019,role:_0x3ffb85}=_0x6f96bd[_0x10dc69(0x116)],_0x4d2055=_0x6f96bd[_0x10dc69(0x116)],_0xa07bf5=await profile[_0x10dc69(0x1fa)]({'email':_0x4d2055[_0x10dc69(0x185)]}),_0x1b140f=await master_shop[_0x10dc69(0x123)](),_0x12ce3e=_0x6f96bd[_0x10dc69(0x150)]['id'],_0x414f8b=await sales_finished['findById'](_0x12ce3e);let _0x206b37=new Date(_0x414f8b[_0x10dc69(0x144)]),_0x424cf9=('0'+_0x206b37[_0x10dc69(0x179)]())['slice'](-0x2),_0x3a0446=('0'+(_0x206b37[_0x10dc69(0x15c)]()+0x1))[_0x10dc69(0x218)](-0x2),_0x3239ec=_0x206b37[_0x10dc69(0x21f)](),_0x28c071=_0x3239ec+'-'+_0x3a0446+'-'+_0x424cf9;var _0x4c01a2=['Ambient','Enclosed'];const _0xee9791=await warehouse['aggregate']([{'$match':{'name':_0x414f8b[_0x10dc69(0x1e9)],'room':_0x414f8b['room']}},{'$unwind':_0x10dc69(0x19e)},{'$group':{'_id':_0x10dc69(0x135),'name':{'$first':_0x10dc69(0x132)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x10dc69(0x1d4)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x10dc69(0x114)},'floorlevel':{'$first':_0x10dc69(0x204)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x10dc69(0x127)},'product_code':{'$first':_0x10dc69(0x1c9)},'storage':{'$first':_0x10dc69(0x1d1)},'rack':{'$first':_0x10dc69(0x131)}}}]),_0x45a1bd=await customer[_0x10dc69(0x123)]({});let _0x85ef76;if(_0x4d2055['role']=='staff'){const _0x422c4d=await staff[_0x10dc69(0x1fa)]({'email':_0x4d2055[_0x10dc69(0x185)]});_0x85ef76=await warehouse['aggregate']([{'$match':{'status':_0x10dc69(0x1cd),'name':_0x422c4d[_0x10dc69(0x111)]}},{'$group':{'_id':'$name','name':{'$first':_0x10dc69(0x12e)}}}]);}else _0x85ef76=await warehouse[_0x10dc69(0x1d7)]([{'$match':{'status':_0x10dc69(0x1cd)}},{'$group':{'_id':'$name','name':{'$first':_0x10dc69(0x12e)}}}]);const _0x384890=await product[_0x10dc69(0x123)]({});if(_0x1b140f[0x0]['language']==_0x10dc69(0x153)){var _0x4bb76c=users[_0x10dc69(0x1f6)];console[_0x10dc69(0x134)](_0x4bb76c);}else{if(_0x1b140f[0x0][_0x10dc69(0x14b)]=='Hindi')var _0x4bb76c=users[_0x10dc69(0x193)];else{if(_0x1b140f[0x0]['language']==_0x10dc69(0x115))var _0x4bb76c=users['German'];else{if(_0x1b140f[0x0][_0x10dc69(0x14b)]==_0x10dc69(0x190))var _0x4bb76c=users['Spanish'];else{if(_0x1b140f[0x0][_0x10dc69(0x14b)]=='French')var _0x4bb76c=users[_0x10dc69(0x184)];else{if(_0x1b140f[0x0][_0x10dc69(0x14b)]==_0x10dc69(0x178))var _0x4bb76c=users['Portuguese'];else{if(_0x1b140f[0x0][_0x10dc69(0x14b)]==_0x10dc69(0x1ce))var _0x4bb76c=users['Chinese'];else{if(_0x1b140f[0x0]['language']==_0x10dc69(0x1e2))var _0x4bb76c=users[_0x10dc69(0x1f3)];}}}}}}}_0x2d4295[_0x10dc69(0x1a1)]('edit_sales_finished',{'success':_0x6f96bd[_0x10dc69(0x1d6)](_0x10dc69(0x1ff)),'errors':_0x6f96bd[_0x10dc69(0x1d6)](_0x10dc69(0x163)),'role':_0x4d2055,'profile':_0xa07bf5,'customer':_0x45a1bd,'warehouse':_0x85ef76,'product':_0xee9791,'user':_0x414f8b,'master_shop':_0x1b140f,'unit':_0x384890,'language':_0x4bb76c,'rooms_data':_0x4c01a2,'ed_fullDate':_0x28c071});}catch(_0x4eb052){console[_0x10dc69(0x134)](_0x4eb052);}}),router[a0_0x19bcca(0x1a2)](a0_0x19bcca(0x181),auth,async(_0x2aec15,_0x1f99e2)=>{var _0x5c9a68=a0_0x19bcca;try{const _0xeaee84=_0x2aec15[_0x5c9a68(0x150)]['id'],_0x9e2d39=await sales_finished[_0x5c9a68(0x1fa)]({'_id':_0x2aec15[_0x5c9a68(0x150)]['id']}),_0x51c75f=await warehouse[_0x5c9a68(0x1fa)]({'name':_0x9e2d39[_0x5c9a68(0x1e9)],'room':_0x2aec15[_0x5c9a68(0x17d)]['room'],'warehouse_category':_0x5c9a68(0x1de)}),{invoice:_0x9eea36,customer:_0x5909ab,date:_0x5ee892,warehouse_name:_0xd0c158,product_name:_0x15c141,stock:_0x52b021,adjust_qty:_0x12b5ad,note:_0x1165f3,room:_0x3cb148,primary_code:_0x1a97a1,secondary_code:_0x47d414,prod_code:_0x1cd54a,level:_0x277a42,isle:_0x4321e9,pallet:_0x44b667,expiry_date:_0x5f3dec}=_0x2aec15['body'];if(typeof _0x15c141==_0x5c9a68(0x1bf))var _0xfa1a2a=[_0x2aec15[_0x5c9a68(0x17d)][_0x5c9a68(0x1a7)]],_0x281646=[_0x2aec15['body'][_0x5c9a68(0x161)]],_0xf9795=[_0x2aec15['body'][_0x5c9a68(0x133)]],_0x3fb00f=[_0x2aec15['body'][_0x5c9a68(0x1b2)]],_0x4793dd=[_0x2aec15[_0x5c9a68(0x17d)][_0x5c9a68(0x164)]],_0x380362=[_0x2aec15['body']['prod_code']],_0x298af1=[_0x2aec15[_0x5c9a68(0x17d)][_0x5c9a68(0x1a9)]],_0x30552d=[_0x2aec15[_0x5c9a68(0x17d)][_0x5c9a68(0x144)]];else var _0xfa1a2a=[..._0x2aec15[_0x5c9a68(0x17d)]['product_name']],_0x281646=[..._0x2aec15[_0x5c9a68(0x17d)][_0x5c9a68(0x161)]],_0xf9795=[..._0x2aec15['body'][_0x5c9a68(0x133)]],_0x3fb00f=[..._0x2aec15[_0x5c9a68(0x17d)][_0x5c9a68(0x1b2)]],_0x4793dd=[..._0x2aec15['body']['secondary_code']],_0x380362=[..._0x2aec15['body'][_0x5c9a68(0x1ea)]],_0x298af1=[..._0x2aec15[_0x5c9a68(0x17d)][_0x5c9a68(0x1a9)]],_0x30552d=[..._0x2aec15[_0x5c9a68(0x17d)][_0x5c9a68(0x144)]];const _0x1fbb8b=_0xfa1a2a[_0x5c9a68(0x1b8)](_0x2c47f5=>{return _0x2c47f5={'product_name':_0x2c47f5};});_0x281646[_0x5c9a68(0x202)]((_0x4f198b,_0x190774)=>{_0x1fbb8b[_0x190774]['stock']=_0x4f198b;}),_0xf9795[_0x5c9a68(0x202)]((_0x3186e5,_0x481002)=>{var _0x4ebc14=_0x5c9a68;_0x1fbb8b[_0x481002][_0x4ebc14(0x210)]=_0x3186e5;}),_0x3fb00f[_0x5c9a68(0x202)]((_0x94cebd,_0xdff190)=>{var _0x28de45=_0x5c9a68;_0x1fbb8b[_0xdff190][_0x28de45(0x1b2)]=_0x94cebd;}),_0x4793dd[_0x5c9a68(0x202)]((_0x15cd04,_0xba25ad)=>{_0x1fbb8b[_0xba25ad]['secondary_code']=_0x15cd04;}),_0x380362[_0x5c9a68(0x202)]((_0x2684a5,_0x1b403d)=>{var _0x2d37bd=_0x5c9a68;_0x1fbb8b[_0x1b403d][_0x2d37bd(0x110)]=_0x2684a5;}),_0x298af1['forEach']((_0x49452d,_0x44b7d9)=>{var _0x43a1f0=_0x5c9a68;_0x1fbb8b[_0x44b7d9][_0x43a1f0(0x1a9)]=_0x49452d;}),_0x30552d[_0x5c9a68(0x202)]((_0x36992e,_0x4e85ec)=>{var _0x458dc4=_0x5c9a68;_0x1fbb8b[_0x4e85ec][_0x458dc4(0x144)]=_0x36992e;});var _0x5d2774=0x0;_0x1fbb8b[_0x5c9a68(0x202)](_0x20ef65=>{var _0x31d28a=_0x5c9a68;console[_0x31d28a(0x134)]('foreach\x20newproduct',_0x20ef65),(parseInt(_0x20ef65['stock'])<parseInt(_0x20ef65['quantity'])||parseInt(_0x20ef65[_0x31d28a(0x210)])==0x0)&&_0x5d2774++;});if(_0x5d2774!=0x0)return _0x2aec15['flash'](_0x5c9a68(0x163),_0x5c9a68(0x17b)),_0x1f99e2['redirect'](_0x5c9a68(0x168));_0x9e2d39[_0x5c9a68(0x10d)][_0x5c9a68(0x202)](_0x4778f4=>{var _0x4b8d26=_0x5c9a68;const _0x5a263c=_0x51c75f[_0x4b8d26(0x17a)]['map'](_0x1d0692=>{var _0x116f84=_0x4b8d26;_0x1d0692[_0x116f84(0x1a7)]==_0x4778f4['product_name']&&_0x1d0692[_0x116f84(0x14c)]==_0x4778f4[_0x116f84(0x14c)]&&(_0x1d0692[_0x116f84(0x177)]=parseInt(_0x1d0692[_0x116f84(0x177)])+parseInt(_0x4778f4[_0x116f84(0x210)]));});}),await _0x51c75f['save']();const _0x3ca317=_0x1fbb8b[_0x5c9a68(0x1f7)](_0x123ed6=>_0x123ed6[_0x5c9a68(0x210)]!=='0'&&_0x123ed6[_0x5c9a68(0x210)]!=='');_0x9e2d39[_0x5c9a68(0x10b)]=_0x9eea36,_0x9e2d39[_0x5c9a68(0x1b0)]=_0x5909ab,_0x9e2d39[_0x5c9a68(0x18a)]=_0x5ee892,_0x9e2d39[_0x5c9a68(0x1e9)]=_0xd0c158,_0x9e2d39['sale_product']=_0x3ca317,_0x9e2d39[_0x5c9a68(0x140)]=_0x1165f3,_0x9e2d39['room']=_0x3cb148;const _0x966e97=await _0x9e2d39[_0x5c9a68(0x172)](),_0x1b82d5=await sales_finished[_0x5c9a68(0x1fa)]({'_id':_0x2aec15['params']['id']}),_0x57beea=await warehouse['findOne']({'name':_0xd0c158,'room':_0x3cb148,'warehouse_category':_0x5c9a68(0x1de)});_0x1b82d5['sale_product']['forEach'](_0x1b6fb4=>{var _0x531dd5=_0x5c9a68;const _0x39b043=_0x57beea[_0x531dd5(0x17a)][_0x531dd5(0x1b8)](_0x3e0efc=>{var _0x907434=_0x531dd5;_0x3e0efc[_0x907434(0x1a7)]==_0x1b6fb4[_0x907434(0x1a7)]&&_0x3e0efc[_0x907434(0x14c)]==_0x1b6fb4[_0x907434(0x14c)]&&(_0x3e0efc[_0x907434(0x177)]=parseInt(_0x3e0efc[_0x907434(0x177)])-parseInt(_0x1b6fb4[_0x907434(0x210)]));});}),console[_0x5c9a68(0x134)](_0x5c9a68(0x198),_0x57beea),await _0x57beea[_0x5c9a68(0x172)]();const _0x589cee=await c_payment_data['findOne']({'invoice':_0x2aec15[_0x5c9a68(0x17d)]['invoice']});_0x589cee['suppliers']=_0x2aec15[_0x5c9a68(0x17d)]['suppliers'],await _0x589cee['save'](),_0x2aec15[_0x5c9a68(0x1d6)](_0x5c9a68(0x1ff),_0x5c9a68(0x1bb)),_0x1f99e2['redirect'](_0x5c9a68(0x1ba));}catch(_0x56972d){console[_0x5c9a68(0x134)](_0x56972d);}}),router[a0_0x19bcca(0x1a2)](a0_0x19bcca(0x167),auth,async(_0x218a2b,_0x42f2e9)=>{var _0x36d092=a0_0x19bcca;try{const _0x52d9a7=_0x218a2b[_0x36d092(0x150)]['id'],{invoice:_0x64ca82,customer:_0x17296c,receivable_amount:_0x48463c,received_amount:_0x5737dd}=_0x218a2b[_0x36d092(0x17d)],_0xeb8f27=await sales['findById'](_0x52d9a7);console[_0x36d092(0x134)](_0xeb8f27);var _0x509fc5=_0x48463c-_0x5737dd;console['log'](_0x5737dd),_0xeb8f27['received_amount']=parseFloat(_0x5737dd)+parseFloat(_0xeb8f27[_0x36d092(0x128)]),_0xeb8f27[_0x36d092(0x206)]=_0x509fc5,console[_0x36d092(0x134)](_0xeb8f27);const _0x55e22a=await _0xeb8f27[_0x36d092(0x172)](),_0x5ccc27=await c_payment_data[_0x36d092(0x1fa)]({'invoice':_0x64ca82});_0x5ccc27[_0x36d092(0x16b)]=_0x509fc5,await _0x5ccc27[_0x36d092(0x172)]();let _0x304619=new Date(),_0x455e18=('0'+_0x304619[_0x36d092(0x179)]())[_0x36d092(0x218)](-0x2),_0x1ce7c2=('0'+(_0x304619['getMonth']()+0x1))[_0x36d092(0x218)](-0x2),_0x2ee0bf=_0x304619[_0x36d092(0x21f)](),_0x539646=_0x2ee0bf+'-'+_0x1ce7c2+'-'+_0x455e18;const _0x37a2dc=new customer_payment({'invoice':_0x64ca82,'date':_0x2ee0bf+'-'+_0x1ce7c2+'-'+_0x455e18,'customer':_0x17296c,'reason':_0x36d092(0x213),'amount':_0x5737dd}),_0x24318d=await _0x37a2dc['save']();_0x218a2b[_0x36d092(0x1d6)]('success','payment\x20successfull'),_0x42f2e9[_0x36d092(0x203)](_0x36d092(0x18c));}catch(_0x2cbaa3){console[_0x36d092(0x134)](_0x2cbaa3);}}),router[a0_0x19bcca(0x221)]('/invoice/:id',auth,async(_0x5c804a,_0x24a312)=>{var _0x1b9e90=a0_0x19bcca;try{const {username:_0x4450fc,email:_0x2546f9,role:_0x28c012}=_0x5c804a[_0x1b9e90(0x116)],_0x12a6f6=_0x5c804a[_0x1b9e90(0x116)],_0x45f1f8=await profile['findOne']({'email':_0x12a6f6[_0x1b9e90(0x185)]}),_0x507b1a=await master_shop[_0x1b9e90(0x123)]();console[_0x1b9e90(0x134)](_0x1b9e90(0x160),_0x507b1a);const _0x363d6e=_0x5c804a[_0x1b9e90(0x150)]['id'],_0x3f5d5b=await sales[_0x1b9e90(0x209)](_0x363d6e);console['log'](_0x3f5d5b);const _0x5dc42c=await customer[_0x1b9e90(0x1fa)]({'name':_0x3f5d5b['customer']});console[_0x1b9e90(0x134)](_0x5dc42c);if(_0x507b1a[0x0][_0x1b9e90(0x14b)]==_0x1b9e90(0x153)){var _0xe88041=users[_0x1b9e90(0x1f6)];console[_0x1b9e90(0x134)](_0xe88041);}else{if(_0x507b1a[0x0][_0x1b9e90(0x14b)]==_0x1b9e90(0x193))var _0xe88041=users[_0x1b9e90(0x193)];else{if(_0x507b1a[0x0]['language']==_0x1b9e90(0x115))var _0xe88041=users[_0x1b9e90(0x115)];else{if(_0x507b1a[0x0]['language']=='Spanish')var _0xe88041=users[_0x1b9e90(0x190)];else{if(_0x507b1a[0x0][_0x1b9e90(0x14b)]==_0x1b9e90(0x184))var _0xe88041=users[_0x1b9e90(0x184)];else{if(_0x507b1a[0x0][_0x1b9e90(0x14b)]==_0x1b9e90(0x178))var _0xe88041=users[_0x1b9e90(0x196)];else{if(_0x507b1a[0x0][_0x1b9e90(0x14b)]=='Chinese')var _0xe88041=users[_0x1b9e90(0x1ce)];else{if(_0x507b1a[0x0][_0x1b9e90(0x14b)]=='Arabic\x20(ae)')var _0xe88041=users[_0x1b9e90(0x1f3)];}}}}}}}_0x24a312[_0x1b9e90(0x1a1)](_0x1b9e90(0x124),{'success':_0x5c804a[_0x1b9e90(0x1d6)](_0x1b9e90(0x1ff)),'errors':_0x5c804a[_0x1b9e90(0x1d6)](_0x1b9e90(0x163)),'role':_0x12a6f6,'profile':_0x45f1f8,'master_shop':_0x507b1a,'customers':_0x5dc42c,'sales':_0x3f5d5b,'language':_0xe88041});}catch(_0x52ecd8){console[_0x1b9e90(0x134)](_0x52ecd8);}}),router['get'](a0_0x19bcca(0x194),auth,async(_0xd1653e,_0x1ae7b4)=>{var _0x2d2ac7=a0_0x19bcca;try{const {username:_0x1a0500,email:_0x578b3d,role:_0x541803}=_0xd1653e[_0x2d2ac7(0x116)],_0x46e8fe=_0xd1653e[_0x2d2ac7(0x116)],_0x29abd5=await profile[_0x2d2ac7(0x1fa)]({'email':_0x46e8fe[_0x2d2ac7(0x185)]}),_0x329184=await master_shop[_0x2d2ac7(0x123)](),_0x131773=_0xd1653e['params']['id'],_0x346372=await sales_finished[_0x2d2ac7(0x209)](_0x131773),_0x535203=await warehouse['aggregate']([{'$match':{'name':_0x346372['warehouse_name']}},{'$unwind':_0x2d2ac7(0x19e)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2d2ac7(0x132)},'product_stock':{'$first':_0x2d2ac7(0x1ec)},'bay':{'$first':_0x2d2ac7(0x1d4)},'bin':{'$first':_0x2d2ac7(0x21b)},'type':{'$first':_0x2d2ac7(0x114)},'floorlevel':{'$first':_0x2d2ac7(0x204)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2d2ac7(0x127)},'product_code':{'$first':_0x2d2ac7(0x1c9)},'storage':{'$first':_0x2d2ac7(0x1d1)},'rack':{'$first':_0x2d2ac7(0x131)},'expiry_date':{'$first':_0x2d2ac7(0x222)},'production_date':{'$first':_0x2d2ac7(0x1b7)},'unit':{'$first':_0x2d2ac7(0x12f)},'secondary_unit':{'$first':_0x2d2ac7(0x13e)},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x29c85a=await product[_0x2d2ac7(0x123)]({}),_0xdd0a90=await warehouse['aggregate']([{'$match':{'status':_0x2d2ac7(0x1cd),'warehouse_category':_0x2d2ac7(0x1de),'name':{'$ne':_0x2d2ac7(0x1f8),'$ne':_0x2d2ac7(0x1b6)}}},{'$group':{'_id':_0x2d2ac7(0x12e),'name':{'$first':_0x2d2ac7(0x12e)}}},{'$sort':{'name':0x1}}]);var _0xb09e1e=['Return\x20Rooms'];const _0xe1497a=await warehouse[_0x2d2ac7(0x1d7)]([{'$match':{'status':_0x2d2ac7(0x1cd),'name':_0x2d2ac7(0x1b6)}},{'$group':{'_id':_0x2d2ac7(0x12e),'name':{'$first':_0x2d2ac7(0x12e)}}},{'$sort':{'name':0x1}}]);if(_0x329184[0x0][_0x2d2ac7(0x14b)]==_0x2d2ac7(0x153)){var _0x56ada8=users[_0x2d2ac7(0x1f6)];console[_0x2d2ac7(0x134)](_0x56ada8);}else{if(_0x329184[0x0]['language']=='Hindi')var _0x56ada8=users['Hindi'];else{if(_0x329184[0x0][_0x2d2ac7(0x14b)]==_0x2d2ac7(0x115))var _0x56ada8=users[_0x2d2ac7(0x115)];else{if(_0x329184[0x0][_0x2d2ac7(0x14b)]==_0x2d2ac7(0x190))var _0x56ada8=users[_0x2d2ac7(0x190)];else{if(_0x329184[0x0][_0x2d2ac7(0x14b)]=='French')var _0x56ada8=users[_0x2d2ac7(0x184)];else{if(_0x329184[0x0][_0x2d2ac7(0x14b)]==_0x2d2ac7(0x178))var _0x56ada8=users[_0x2d2ac7(0x196)];else{if(_0x329184[0x0][_0x2d2ac7(0x14b)]=='Chinese')var _0x56ada8=users[_0x2d2ac7(0x1ce)];else{if(_0x329184[0x0][_0x2d2ac7(0x14b)]==_0x2d2ac7(0x1e2))var _0x56ada8=users['Arabic'];}}}}}}}_0x1ae7b4[_0x2d2ac7(0x1a1)](_0x2d2ac7(0x1e1),{'success':_0xd1653e[_0x2d2ac7(0x1d6)](_0x2d2ac7(0x1ff)),'errors':_0xd1653e[_0x2d2ac7(0x1d6)](_0x2d2ac7(0x163)),'role':_0x46e8fe,'profile':_0x29abd5,'user':_0x346372,'stock':_0x535203,'master_shop':_0x329184,'unit':_0x29c85a,'language':_0x56ada8,'warehouses':_0xdd0a90,'rooms':_0xb09e1e,'warehouse_QA':_0xe1497a});}catch(_0x1d981b){console[_0x2d2ac7(0x134)](_0x1d981b),_0x1ae7b4[_0x2d2ac7(0x20a)](0xc8)['json']({'message':_0x1d981b[_0x2d2ac7(0x1f9)]});}}),router['post'](a0_0x19bcca(0x194),auth,async(_0x3824e5,_0x5839ab)=>{var _0x4719e0=a0_0x19bcca;if(_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x186)]=='QA')try{const {invoice:_0xc53002,date:_0x2edaa6,warehouse_name:_0x181862,product_name:_0x18151e,primary_code:_0x2c1259,secondary_code:_0x11bf6c,product_code:_0x9f8f4b,sales_quantity:_0x219863,stocks:_0x2ec046,return_qty:_0x8ce6d7,Room_name:_0x5857b9,to_warehouse_name_QA:_0x172701,to_Room_name_QA:_0x399798,note:_0x29c8df,for_categorize:_0x500d30,product_name_QA1:_0x580330}=_0x3824e5[_0x4719e0(0x17d)];if(typeof _0x580330==_0x4719e0(0x1bf))var _0x26d84f=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1ad)]],_0x1e65a9=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1c5)]],_0x2ff20b=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x191)]],_0x5f4666=[_0x3824e5['body'][_0x4719e0(0x119)]],_0x547061=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1f1)]],_0x1327cd=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x195)]],_0x3a7dca=[_0x3824e5['body'][_0x4719e0(0x211)]],_0x15c5f5=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x13f)]],_0x5e286e=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x14d)]],_0x446760=[_0x3824e5['body'][_0x4719e0(0x20c)]],_0x2c6dfc=[_0x3824e5[_0x4719e0(0x17d)]['secondary_unit_QA']],_0x1a6db4=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1eb)]],_0x1e4da9=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1d8)]],_0x482d5a=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1c0)]];else var _0x26d84f=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1ad)]],_0x1e65a9=[..._0x3824e5['body']['primary_code_QA']],_0x2ff20b=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x191)]],_0x5f4666=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x119)]],_0x547061=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1f1)]],_0x1327cd=[..._0x3824e5[_0x4719e0(0x17d)]['stocks_QA']],_0x3a7dca=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x211)]],_0x15c5f5=[..._0x3824e5['body'][_0x4719e0(0x13f)]],_0x5e286e=[..._0x3824e5['body'][_0x4719e0(0x14d)]],_0x446760=[..._0x3824e5['body'][_0x4719e0(0x20c)]],_0x2c6dfc=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x11f)]],_0x1a6db4=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1eb)]],_0x1e4da9=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1d8)]],_0x482d5a=[..._0x3824e5[_0x4719e0(0x17d)]['expiry_date_QA']];const _0xcb69bb=_0x26d84f['map'](_0x364775=>{return _0x364775={'product_name':_0x364775};});_0x1e65a9[_0x4719e0(0x202)]((_0x347d67,_0x2953be)=>{var _0x1c1141=_0x4719e0;_0xcb69bb[_0x2953be][_0x1c1141(0x1b2)]=_0x347d67;}),_0x2ff20b[_0x4719e0(0x202)]((_0x576987,_0x15b993)=>{var _0x13f51c=_0x4719e0;_0xcb69bb[_0x15b993][_0x13f51c(0x164)]=_0x576987;}),_0x5f4666[_0x4719e0(0x202)]((_0x309667,_0x476053)=>{_0xcb69bb[_0x476053]['product_code']=_0x309667;}),_0x547061[_0x4719e0(0x202)]((_0xd73168,_0x6b225d)=>{var _0x5fbc87=_0x4719e0;_0xcb69bb[_0x6b225d][_0x5fbc87(0x1ca)]=_0xd73168;}),_0x1327cd[_0x4719e0(0x202)]((_0x635019,_0x337832)=>{var _0x141c90=_0x4719e0;_0xcb69bb[_0x337832][_0x141c90(0x161)]=_0x635019;}),_0x3a7dca[_0x4719e0(0x202)]((_0x386f2e,_0x389f48)=>{_0xcb69bb[_0x389f48]['return_qty']=_0x386f2e;}),_0x15c5f5[_0x4719e0(0x202)]((_0xb13b4,_0x1f3680)=>{var _0x577c6b=_0x4719e0;_0xcb69bb[_0x1f3680][_0x577c6b(0x1fe)]=_0xb13b4;}),_0x5e286e['forEach']((_0x15d484,_0x3d8ecc)=>{var _0xffbb1e=_0x4719e0;_0xcb69bb[_0x3d8ecc][_0xffbb1e(0x19c)]=_0x15d484;}),_0x446760[_0x4719e0(0x202)]((_0x529f63,_0x572130)=>{var _0x4e3f88=_0x4719e0;_0xcb69bb[_0x572130][_0x4e3f88(0x1c1)]=_0x529f63;}),_0x2c6dfc[_0x4719e0(0x202)]((_0x533ddd,_0x4c96de)=>{var _0x346ca6=_0x4719e0;_0xcb69bb[_0x4c96de][_0x346ca6(0x159)]=_0x533ddd;}),_0x1a6db4[_0x4719e0(0x202)]((_0x45f184,_0x15a5cb)=>{var _0x5958e3=_0x4719e0;_0xcb69bb[_0x15a5cb][_0x5958e3(0x1f5)]=_0x45f184;}),_0x1e4da9[_0x4719e0(0x202)]((_0x39b84f,_0x3a04f5)=>{var _0x498d38=_0x4719e0;_0xcb69bb[_0x3a04f5][_0x498d38(0x205)]=_0x39b84f;}),_0x482d5a[_0x4719e0(0x202)]((_0x1e9e35,_0x538bfb)=>{var _0x2fd751=_0x4719e0;_0xcb69bb[_0x538bfb][_0x2fd751(0x144)]=_0x1e9e35;});const _0x2ec5fb=await sales_finished[_0x4719e0(0x1fa)]({'invoice':_0xc53002});_0x2ec5fb[_0x4719e0(0x212)]=_0x4719e0(0x10c);const _0x15257b=await _0x2ec5fb[_0x4719e0(0x172)](),_0x4f56e=new sales_return_finished({'invoice':_0xc53002,'customer':_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1b0)],'date':_0x2edaa6,'warehouse_name':_0x181862,'room':_0x5857b9,'ToWarehouse':_0x172701,'ToRoom':_0x399798,'return_sale_QA':_0xcb69bb,'note':_0x29c8df,'warehouse_cat':_0x500d30}),_0x52c215=await _0x4f56e['save'](),_0x4e72e1=await sales_return_finished[_0x4719e0(0x1fa)]({'invoice':_0xc53002}),_0x441088=await warehouse[_0x4719e0(0x1fa)]({'name':_0x172701,'room':_0x399798});_0x4e72e1[_0x4719e0(0x1db)][_0x4719e0(0x202)](_0x13eb12=>{var _0x5e992d=_0x4719e0,_0x4ed40a=0x0;const _0x3e8244=_0x441088[_0x5e992d(0x17a)][_0x5e992d(0x1b8)](_0x5dc560=>{var _0xf021be=_0x5e992d;_0x5dc560[_0xf021be(0x1a7)]==_0x13eb12['product_name']&&_0x5dc560['expiry_date']==_0x13eb12[_0xf021be(0x144)]&&_0x5dc560[_0xf021be(0x205)]==_0x13eb12[_0xf021be(0x205)]&&_0x5dc560['batch_code']==_0x13eb12[_0xf021be(0x1c1)]&&(_0x5dc560[_0xf021be(0x177)]=parseInt(_0x5dc560[_0xf021be(0x177)])+parseInt(_0x13eb12[_0xf021be(0x1e7)]),_0x4ed40a++);});_0x4ed40a=='0'&&(_0x441088[_0x5e992d(0x17a)]=_0x441088[_0x5e992d(0x17a)][_0x5e992d(0x146)]({'product_name':_0x13eb12[_0x5e992d(0x1a7)],'product_stock':_0x13eb12[_0x5e992d(0x1e7)],'primary_code':_0x13eb12[_0x5e992d(0x1b2)],'secondary_code':_0x13eb12['secondary_code'],'product_code':_0x13eb12[_0x5e992d(0x110)],'batch_code':_0x13eb12[_0x5e992d(0x1c1)],'maxPerUnit':_0x13eb12[_0x5e992d(0x1fe)],'production_date':_0x13eb12[_0x5e992d(0x205)],'expiry_date':_0x13eb12[_0x5e992d(0x144)],'secondary_unit':_0x13eb12[_0x5e992d(0x159)],'unit':_0x13eb12[_0x5e992d(0x1f5)],'maxProducts':_0x13eb12[_0x5e992d(0x19c)],'bay':_0x13eb12[_0x5e992d(0x14c)]}));}),await _0x441088[_0x4719e0(0x172)]();const _0x46ae65=new c_payment_data({'invoice':_0xc53002,'customer':_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1b0)],'reason':_0x4719e0(0x1c7)});await _0x46ae65[_0x4719e0(0x172)]();const _0x57b51a=await master_shop[_0x4719e0(0x123)](),_0x373fd8=await email_settings[_0x4719e0(0x1fa)](),_0x2105f9=await customer['findOne']({'name':_0x3824e5['body'][_0x4719e0(0x1b0)]});_0x57b51a[0x0][_0x4719e0(0x1a4)]==0x1?(right_currency=_0x57b51a[0x0][_0x4719e0(0x175)],left_currency=''):(right_currency='',left_currency=_0x57b51a[0x0]['currency']);var _0x52aace=_0x26d84f,_0x5950f6=_0x3a7dca,_0x5572be='',_0x4175da;for(_0x4175da in _0x52aace){_0x5572be+='<tr>'+_0x4719e0(0x207)+_0x52aace[_0x4175da]+_0x4719e0(0x15e)+_0x4719e0(0x207)+_0x5950f6[_0x4175da]+_0x4719e0(0x15e)+_0x4719e0(0x18f);}console[_0x4719e0(0x134)]('product_list',_0x5572be);let _0x5e01f2=nodemailer[_0x4719e0(0x15f)]({'service':_0x4719e0(0x1ae),'auth':{'user':_0x373fd8[_0x4719e0(0x185)],'pass':_0x373fd8['password']}}),_0x4c7b28={'from':_0x373fd8[_0x4719e0(0x185)],'to':_0x2105f9[_0x4719e0(0x185)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x4719e0(0x188),'path':__dirname+'/../public'+_0x4719e0(0x165)+_0x57b51a[0x0]['image'],'cid':'logo'}],'html':_0x4719e0(0x13c)+'<html><head><title></title>'+_0x4719e0(0x113)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4719e0(0x17f)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4719e0(0x21d)+_0x4719e0(0x17f)+_0x4719e0(0x169)+_0x57b51a[0x0][_0x4719e0(0x220)]+_0x4719e0(0x1ef)+_0x4719e0(0x21d)+'</div>'+_0x4719e0(0x1aa)+_0x4719e0(0x17f)+_0x4719e0(0x18d)+_0x4719e0(0x10f)+_0xc53002+'\x20'+_0x4719e0(0x1b9)+_0x4719e0(0x14a)+_0x2edaa6+'\x20'+_0x4719e0(0x117)+_0x4719e0(0x21e)+'</div>'+_0x4719e0(0x19f)+_0x4719e0(0x19b)+_0x4719e0(0x1a3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x4719e0(0x1ab)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x4719e0(0x155)+_0x4719e0(0x1e5)+'\x20'+_0x5572be+'\x20'+_0x4719e0(0x1d9)+_0x4719e0(0x1c8)+_0x4719e0(0x17f)+_0x4719e0(0x1b4)+_0x4719e0(0x183)+_0x57b51a[0x0][_0x4719e0(0x220)]+_0x4719e0(0x21e)+'</div>'+_0x4719e0(0x21d)+_0x4719e0(0x18b)};_0x5e01f2[_0x4719e0(0x10a)](_0x4c7b28,function(_0x5b5dfb,_0x1f1c1d){var _0x1d068d=_0x4719e0;_0x5b5dfb?(console[_0x1d068d(0x134)](_0x5b5dfb),console[_0x1d068d(0x134)](_0x1d068d(0x16e))):console[_0x1d068d(0x134)](_0x1d068d(0x21a));}),_0x3824e5[_0x4719e0(0x1d6)](_0x4719e0(0x1ff),_0x4719e0(0x125)),_0x5839ab[_0x4719e0(0x203)](_0x4719e0(0x1ba));}catch(_0x2fa43b){_0x5839ab['status'](0xc8)[_0x4719e0(0x151)]({'message1':_0x2fa43b['message']});}else{if(_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x186)]=='GS')try{const {invoice:_0x223ef6,date:_0x21dd20,warehouse_name:_0x162489,product_name:_0x222a4e,primary_code:_0x7790d,secondary_code:_0x68c94f,product_code:_0x29ebcf,sales_quantity:_0x2e6b90,stocks:_0x5853b9,return_qty:_0x1c917e,Room_name:_0x40e25f,to_warehouse_name:_0x558fde,to_Room_name:_0x5657b0,note:_0x42dbd7,level:_0x3149da,isle:_0x41cd44,pallet:_0x3ac9da,for_categorize:_0x8d4672}=_0x3824e5[_0x4719e0(0x17d)];if(typeof _0x222a4e==_0x4719e0(0x1bf))var _0x26d84f=[_0x3824e5['body'][_0x4719e0(0x1a7)]],_0x1e65a9=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1b2)]],_0x2ff20b=[_0x3824e5[_0x4719e0(0x17d)]['secondary_code']],_0x5f4666=[_0x3824e5['body']['product_code']],_0x547061=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x16c)]],_0x3a7dca=[_0x3824e5[_0x4719e0(0x17d)]['return_qty']],_0x7c6612=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x14c)]],_0x15c5f5=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1fe)]],_0x5e286e=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x19c)]],_0x446760=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1c1)]],_0x2c6dfc=[_0x3824e5[_0x4719e0(0x17d)]['secondary_unit']],_0x1a6db4=[_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1f5)]],_0x1e4da9=[_0x3824e5[_0x4719e0(0x17d)]['production_date']],_0x482d5a=[_0x3824e5[_0x4719e0(0x17d)]['expiry_date']];else var _0x26d84f=[..._0x3824e5[_0x4719e0(0x17d)]['product_name']],_0x1e65a9=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1b2)]],_0x2ff20b=[..._0x3824e5['body']['secondary_code']],_0x5f4666=[..._0x3824e5[_0x4719e0(0x17d)]['product_code']],_0x547061=[..._0x3824e5['body'][_0x4719e0(0x16c)]],_0x3a7dca=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1e7)]],_0x7c6612=[..._0x3824e5['body'][_0x4719e0(0x14c)]],_0x15c5f5=[..._0x3824e5['body'][_0x4719e0(0x1fe)]],_0x5e286e=[..._0x3824e5[_0x4719e0(0x17d)]['maxProducts']],_0x446760=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1c1)]],_0x2c6dfc=[..._0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x159)]],_0x1a6db4=[..._0x3824e5['body'][_0x4719e0(0x1f5)]],_0x1e4da9=[..._0x3824e5[_0x4719e0(0x17d)]['production_date']],_0x482d5a=[..._0x3824e5[_0x4719e0(0x17d)]['expiry_date']];const _0x361d12=_0x26d84f['map'](_0x3aa196=>{return _0x3aa196={'product_name':_0x3aa196};});_0x1e65a9['forEach']((_0x497ca4,_0x34f24e)=>{var _0x4edcbb=_0x4719e0;_0x361d12[_0x34f24e][_0x4edcbb(0x1b2)]=_0x497ca4;}),_0x2ff20b['forEach']((_0xeae7f7,_0x5f1550)=>{_0x361d12[_0x5f1550]['secondary_code']=_0xeae7f7;}),_0x5f4666[_0x4719e0(0x202)]((_0xe5e9f4,_0x51e32a)=>{var _0x56d77a=_0x4719e0;_0x361d12[_0x51e32a][_0x56d77a(0x110)]=_0xe5e9f4;}),_0x547061[_0x4719e0(0x202)]((_0x4da2db,_0x1bb18e)=>{var _0x2d2ff5=_0x4719e0;_0x361d12[_0x1bb18e][_0x2d2ff5(0x1ca)]=_0x4da2db;}),_0x3a7dca[_0x4719e0(0x202)]((_0x30fd46,_0x307e22)=>{_0x361d12[_0x307e22]['return_qty']=_0x30fd46;}),_0x7c6612['forEach']((_0x2ad24c,_0x5f2d93)=>{var _0xea6ee2=_0x4719e0;_0x361d12[_0x5f2d93][_0xea6ee2(0x14c)]=_0x2ad24c;}),_0x15c5f5[_0x4719e0(0x202)]((_0x45c568,_0x1024fb)=>{_0x361d12[_0x1024fb]['maxPerUnit']=_0x45c568;}),_0x5e286e[_0x4719e0(0x202)]((_0x26c4b4,_0xf12062)=>{var _0x179c77=_0x4719e0;_0x361d12[_0xf12062][_0x179c77(0x19c)]=_0x26c4b4;}),_0x446760[_0x4719e0(0x202)]((_0x4d613a,_0x248f55)=>{_0x361d12[_0x248f55]['batch_code']=_0x4d613a;}),_0x2c6dfc['forEach']((_0x9073aa,_0x17aa88)=>{_0x361d12[_0x17aa88]['secondary_unit']=_0x9073aa;}),_0x1a6db4['forEach']((_0x3e4cac,_0x4797a8)=>{var _0x40a5c4=_0x4719e0;_0x361d12[_0x4797a8][_0x40a5c4(0x1f5)]=_0x3e4cac;}),_0x1e4da9[_0x4719e0(0x202)]((_0x3f2c88,_0x3c5cd)=>{var _0x1497be=_0x4719e0;_0x361d12[_0x3c5cd][_0x1497be(0x205)]=_0x3f2c88;}),_0x482d5a[_0x4719e0(0x202)]((_0x3a533c,_0x3dcce6)=>{var _0x15b3ad=_0x4719e0;_0x361d12[_0x3dcce6][_0x15b3ad(0x144)]=_0x3a533c;});var _0x52adcb=0x0;_0x361d12['forEach'](_0x52c374=>{var _0x3f018d=_0x4719e0;(parseInt(_0x52c374[_0x3f018d(0x1ca)])<parseInt(_0x52c374[_0x3f018d(0x1e7)])||parseInt(_0x52c374[_0x3f018d(0x161)])<parseInt(_0x52c374[_0x3f018d(0x1e7)])&&parseInt(_0x52c374[_0x3f018d(0x1ca)])>parseInt(_0x52c374['return_qty'])||parseInt(_0x52c374['return_qty'])==0x0)&&_0x52adcb++;});if(_0x52adcb!=0x0)return _0x3824e5['flash'](_0x4719e0(0x163),_0x4719e0(0x1d5)),_0x5839ab[_0x4719e0(0x203)](_0x4719e0(0x168));const _0xc440fe=await sales_finished['findOne']({'invoice':_0x223ef6});_0xc440fe[_0x4719e0(0x212)]=_0x4719e0(0x10c);const _0x51a7ba=await _0xc440fe[_0x4719e0(0x172)](),_0x3f4f8d=new sales_return_finished({'invoice':_0x223ef6,'customer':_0x3824e5[_0x4719e0(0x17d)]['customer'],'date':_0x21dd20,'warehouse_name':_0x162489,'room':_0x40e25f,'ToWarehouse':_0x558fde,'ToRoom':_0x5657b0,'return_sale':_0x361d12,'note':_0x42dbd7,'warehouse_cat':_0x8d4672}),_0x23d47f=await _0x3f4f8d['save'](),_0x12946b=await sales_return_finished['findOne']({'invoice':_0x223ef6}),_0x274d35=await warehouse[_0x4719e0(0x1fa)]({'name':_0x558fde,'room':_0x5657b0,'warehouse_category':_0x4719e0(0x1de)});_0x12946b[_0x4719e0(0x15b)][_0x4719e0(0x202)](_0x1e7f76=>{var _0x49757e=_0x4719e0,_0x29deae=0x0;const _0x176218=_0x274d35[_0x49757e(0x17a)][_0x49757e(0x1b8)](_0x27f091=>{var _0x1fc942=_0x49757e;_0x27f091['product_name']==_0x1e7f76['product_name']&&_0x27f091['bay']==_0x1e7f76['bay']&&_0x27f091[_0x1fc942(0x144)]==_0x1e7f76[_0x1fc942(0x144)]&&_0x27f091['production_date']==_0x1e7f76['production_date']&&_0x27f091[_0x1fc942(0x1c1)]==_0x1e7f76['batch_code']&&(_0x27f091[_0x1fc942(0x177)]=parseInt(_0x27f091['product_stock'])+parseInt(_0x1e7f76['return_qty']),_0x29deae++);});_0x29deae=='0'&&(_0x274d35[_0x49757e(0x17a)]=_0x274d35[_0x49757e(0x17a)][_0x49757e(0x146)]({'product_name':_0x1e7f76[_0x49757e(0x1a7)],'product_stock':_0x1e7f76[_0x49757e(0x1e7)],'primary_code':_0x1e7f76[_0x49757e(0x1b2)],'secondary_code':_0x1e7f76['secondary_code'],'product_code':_0x1e7f76[_0x49757e(0x110)],'bay':_0x1e7f76[_0x49757e(0x14c)],'batch_code':_0x1e7f76['batch_code'],'maxPerUnit':_0x1e7f76['maxPerUnit'],'production_date':_0x1e7f76['production_date'],'expiry_date':_0x1e7f76[_0x49757e(0x144)],'secondary_unit':_0x1e7f76[_0x49757e(0x159)],'unit':_0x1e7f76[_0x49757e(0x1f5)],'maxProducts':_0x1e7f76[_0x49757e(0x19c)]}));}),await _0x274d35[_0x4719e0(0x172)](),console[_0x4719e0(0x134)](_0x3824e5['body']);const _0x3d25f2=new c_payment_data({'invoice':_0x223ef6,'customer':_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1b0)],'reason':'Sale\x20Return'});await _0x3d25f2['save']();const _0x364829=await master_shop[_0x4719e0(0x123)]();console[_0x4719e0(0x134)](_0x4719e0(0x214),_0x364829[0x0][_0x4719e0(0x1b1)]);const _0x4a53c5=await email_settings[_0x4719e0(0x1fa)](),_0xd163a8=await customer['findOne']({'name':_0x3824e5[_0x4719e0(0x17d)][_0x4719e0(0x1b0)]});console[_0x4719e0(0x134)](_0x4719e0(0x156),_0xd163a8);_0x364829[0x0][_0x4719e0(0x1a4)]==0x1?(right_currency=_0x364829[0x0][_0x4719e0(0x175)],left_currency=''):(right_currency='',left_currency=_0x364829[0x0][_0x4719e0(0x175)]);var _0x52aace=_0x26d84f,_0x5950f6=_0x3a7dca,_0x5572be='',_0x4175da;for(_0x4175da in _0x52aace){_0x5572be+=_0x4719e0(0x1a3)+_0x4719e0(0x207)+_0x52aace[_0x4175da]+'</td>'+_0x4719e0(0x207)+_0x5950f6[_0x4175da]+_0x4719e0(0x15e)+_0x4719e0(0x18f);}console[_0x4719e0(0x134)]('product_list',_0x5572be);let _0x3d78df=nodemailer[_0x4719e0(0x15f)]({'service':'gmail','auth':{'user':_0x4a53c5[_0x4719e0(0x185)],'pass':_0x4a53c5[_0x4719e0(0x21c)]}}),_0x24903a={'from':_0x4a53c5[_0x4719e0(0x185)],'to':_0xd163a8[_0x4719e0(0x185)],'subject':_0x4719e0(0x1bc),'attachments':[{'filename':_0x4719e0(0x188),'path':__dirname+_0x4719e0(0x1f0)+_0x4719e0(0x165)+_0x364829[0x0][_0x4719e0(0x1b1)],'cid':_0x4719e0(0x158)}],'html':'<!DOCTYPE\x20html>'+_0x4719e0(0x189)+_0x4719e0(0x113)+_0x4719e0(0x17f)+_0x4719e0(0x1ed)+'<div>'+_0x4719e0(0x129)+_0x4719e0(0x21d)+_0x4719e0(0x17f)+'<h2>\x20'+_0x364829[0x0][_0x4719e0(0x220)]+_0x4719e0(0x1ef)+_0x4719e0(0x21d)+'</div>'+_0x4719e0(0x1aa)+_0x4719e0(0x17f)+_0x4719e0(0x18d)+_0x4719e0(0x10f)+_0x223ef6+'\x20'+_0x4719e0(0x1b9)+_0x4719e0(0x14a)+_0x21dd20+'\x20'+_0x4719e0(0x117)+_0x4719e0(0x21e)+_0x4719e0(0x21d)+_0x4719e0(0x19f)+_0x4719e0(0x19b)+_0x4719e0(0x1a3)+_0x4719e0(0x1a8)+_0x4719e0(0x1be)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x4719e0(0x122)+_0x4719e0(0x18f)+_0x4719e0(0x155)+_0x4719e0(0x1e5)+'\x20'+_0x5572be+'\x20'+_0x4719e0(0x1d9)+_0x4719e0(0x1c8)+_0x4719e0(0x17f)+_0x4719e0(0x1b4)+'<h5>'+_0x364829[0x0][_0x4719e0(0x220)]+_0x4719e0(0x21e)+_0x4719e0(0x21d)+'</div>'+_0x4719e0(0x18b)};_0x3d78df[_0x4719e0(0x10a)](_0x24903a,function(_0x4a8705,_0x158f9a){var _0x1f30ba=_0x4719e0;_0x4a8705?(console[_0x1f30ba(0x134)](_0x4a8705),console['log'](_0x1f30ba(0x16e))):console[_0x1f30ba(0x134)]('Email\x20sent\x20successfully');}),_0x3824e5[_0x4719e0(0x1d6)]('success',_0x4719e0(0x125)),_0x5839ab[_0x4719e0(0x203)](_0x4719e0(0x1ba));}catch(_0x434e5b){console[_0x4719e0(0x134)](_0x434e5b),_0x5839ab[_0x4719e0(0x20a)](0xc8)['json']({'message1':_0x434e5b['message']});}}}),router[a0_0x19bcca(0x221)](a0_0x19bcca(0x1fb),auth,async(_0x3127b7,_0x4ca3f0)=>{var _0x76674c=a0_0x19bcca;try{const {username:_0x1db3db,email:_0xac01fe,role:_0x550a2a}=_0x3127b7[_0x76674c(0x116)],_0x448bbf=_0x3127b7[_0x76674c(0x116)],_0x54eb5b=await profile['findOne']({'email':_0x448bbf['email']}),_0x1d39ef=await master_shop['find']();console[_0x76674c(0x134)](_0x76674c(0x1cb),_0x1d39ef);const _0x3c68ec=_0x3127b7[_0x76674c(0x150)]['id'],_0x58c217=await sales[_0x76674c(0x209)](_0x3c68ec);console[_0x76674c(0x134)](_0x76674c(0x118),_0x58c217);if(_0x1d39ef[0x0][_0x76674c(0x14b)]==_0x76674c(0x153))var _0xfe89c0=users[_0x76674c(0x1f6)];else{if(_0x1d39ef[0x0]['language']==_0x76674c(0x193))var _0xfe89c0=users[_0x76674c(0x193)];else{if(_0x1d39ef[0x0]['language']==_0x76674c(0x115))var _0xfe89c0=users[_0x76674c(0x115)];else{if(_0x1d39ef[0x0]['language']==_0x76674c(0x190))var _0xfe89c0=users[_0x76674c(0x190)];else{if(_0x1d39ef[0x0]['language']=='French')var _0xfe89c0=users[_0x76674c(0x184)];else{if(_0x1d39ef[0x0][_0x76674c(0x14b)]==_0x76674c(0x178))var _0xfe89c0=users['Portuguese'];else{if(_0x1d39ef[0x0][_0x76674c(0x14b)]=='Chinese')var _0xfe89c0=users['Chinese'];else{if(_0x1d39ef[0x0]['language']==_0x76674c(0x1e2))var _0xfe89c0=users['Arabic'];}}}}}}}_0x4ca3f0[_0x76674c(0x1a1)]('all_sales_barcode',{'success':_0x3127b7[_0x76674c(0x1d6)](_0x76674c(0x1ff)),'errors':_0x3127b7['flash'](_0x76674c(0x163)),'role':_0x448bbf,'profile':_0x54eb5b,'alldata':_0x58c217,'master_shop':_0x1d39ef,'language':_0xfe89c0});}catch(_0x4f9ede){console[_0x76674c(0x134)](_0x4f9ede);}}),router[a0_0x19bcca(0x1a2)](a0_0x19bcca(0x1bd),async(_0x3266e9,_0xaf2e63)=>{var _0x48fe96=a0_0x19bcca;const {product_code:_0x4bfd2e,warehouse_name:_0x4aa2a5,rooms_data:_0x494876,Roomslist:_0x33eeee}=_0x3266e9[_0x48fe96(0x17d)],_0x351af5=_0x33eeee['split'](','),_0x12e77d=[];async function _0x43cbc3(_0x499c3b){var _0x2d7c1d=_0x48fe96;const _0x20a8b0=await warehouse[_0x2d7c1d(0x1d7)]([{'$match':{'name':_0x4aa2a5,'room':_0x499c3b}},{'$unwind':_0x2d7c1d(0x19e)},{'$match':{'product_details.primary_code':_0x4bfd2e}},{'$group':{'_id':_0x2d7c1d(0x135),'name':{'$first':_0x2d7c1d(0x132)},'product_stock':{'$first':_0x2d7c1d(0x1ec)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2d7c1d(0x127)},'product_code':{'$first':_0x2d7c1d(0x1c9)},'level':{'$first':_0x2d7c1d(0x1d4)},'isle':{'$first':_0x2d7c1d(0x21b)},'type':{'$first':_0x2d7c1d(0x114)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2d7c1d(0x12f)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2d7c1d(0x1d1)},'rack':{'$first':_0x2d7c1d(0x131)},'expiry_date':{'$first':_0x2d7c1d(0x222)},'production_date':{'$first':_0x2d7c1d(0x1b7)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2d7c1d(0x1a5)},'product_cat':{'$first':_0x2d7c1d(0x1ac)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2d7c1d(0x19a)},'invoice':{'$first':_0x2d7c1d(0x11a)}}}]),_0x5c7914=await warehouse[_0x2d7c1d(0x1d7)]([{'$match':{'name':_0x4aa2a5,'room':_0x499c3b}},{'$unwind':_0x2d7c1d(0x19e)},{'$match':{'product_details.secondary_code':_0x4bfd2e}},{'$group':{'_id':_0x2d7c1d(0x135),'name':{'$first':_0x2d7c1d(0x132)},'product_stock':{'$first':_0x2d7c1d(0x1ec)},'primary_code':{'$first':_0x2d7c1d(0x13b)},'secondary_code':{'$first':_0x2d7c1d(0x127)},'product_code':{'$first':_0x2d7c1d(0x1c9)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2d7c1d(0x21b)},'type':{'$first':_0x2d7c1d(0x114)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2d7c1d(0x12f)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2d7c1d(0x1d1)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2d7c1d(0x1b7)},'maxPerUnit':{'$first':_0x2d7c1d(0x1d0)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x2d7c1d(0x1ac)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2d7c1d(0x19a)},'invoice':{'$first':_0x2d7c1d(0x11a)}}}]);if(_0x20a8b0[_0x2d7c1d(0x17c)]>0x0)_0x12e77d[_0x2d7c1d(0x148)](_0x20a8b0);else _0x5c7914[_0x2d7c1d(0x17c)]>0x0&&_0x12e77d[_0x2d7c1d(0x148)](_0x5c7914);}const _0x43d889=_0x351af5[_0x48fe96(0x1b8)](_0x4be4c6=>_0x43cbc3(_0x4be4c6));await Promise['all'](_0x43d889),_0xaf2e63[_0x48fe96(0x151)](_0x12e77d);}),module['exports']=router;