var a0_0x2c9cf0=a0_0x1421;function a0_0x1421(_0x1b8ac2,_0x378e05){var _0x44e450=a0_0x44e4();return a0_0x1421=function(_0x142106,_0xbf1163){_0x142106=_0x142106-0x1c0;var _0x29f5c9=_0x44e450[_0x142106];return _0x29f5c9;},a0_0x1421(_0x1b8ac2,_0x378e05);}(function(_0xf7d36,_0x5bcd07){var _0x62397f=a0_0x1421,_0x188eb9=_0xf7d36();while(!![]){try{var _0x40709e=parseInt(_0x62397f(0x275))/0x1+parseInt(_0x62397f(0x1ee))/0x2*(-parseInt(_0x62397f(0x1cb))/0x3)+parseInt(_0x62397f(0x259))/0x4+-parseInt(_0x62397f(0x2a0))/0x5+parseInt(_0x62397f(0x27e))/0x6+-parseInt(_0x62397f(0x2a4))/0x7*(parseInt(_0x62397f(0x291))/0x8)+parseInt(_0x62397f(0x1cd))/0x9;if(_0x40709e===_0x5bcd07)break;else _0x188eb9['push'](_0x188eb9['shift']());}catch(_0x111cd0){_0x188eb9['push'](_0x188eb9['shift']());}}}(a0_0x44e4,0xe6ecb));const express=require(a0_0x2c9cf0(0x1da)),app=express(),router=express[a0_0x2c9cf0(0x28e)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x2c9cf0(0x253)),auth=require(a0_0x2c9cf0(0x284)),nodemailer=require('nodemailer'),users=require(a0_0x2c9cf0(0x221));function a0_0x44e4(){var _0x45ab67=['ADD\x20SALE','warehouse','primary_unit','Arabic\x20(ae)','Sale','sales_invoice','\x20&&\x20','expiry_date_QA','<div>','body','<!DOCTYPE\x20html>','$warehouse_name','max_per_unit','createTransport','Quality\x20Inspection','id_transaction_from','\x20</h2>','</tr>','$product_details.type','</td>','flash','\x20<>\x20','padStart','$return_data','An\x20error\x20occurred.','unit','../public/language/languages.json','edit_sales_finished_view','render','/invoice/:id','Sales\x20Update\x20successfully','</h5>','primary_code','$product_details.invoice','save','production_date_QA','$product_details.room_name','</table>','$sale_product.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$_id','params','$invoice','DRY\x20GOODS','product_code_QA','port','$product_details.expiry_date','language','getMonth','Hindi','Finished\x20Goods','sales\x20item\x20return\x20successfull','sale_product','$product_details.product_cat','</span>','batch_code','invoice','quantity','Enclosed','maxProducts','French','error','$product_details.storage','redirect','/barcode_scanner','sale_qty','push','Received\x20Payment\x20For\x20Sale','return_data','payment\x20successfull','\x20Order\x20Date\x20:\x20','warehouse_name','customers','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product','../models/all_models','barcode\x20user_id','logo','$product_details.rack','product_list','_id','7165832BYiyGj','$product_details.maxPerUnit','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','master','$product_details.bay','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','amount','/all_sales_finished/view','$customer','</tbody>','</thead>','secondary_code','$product_details.floorlevel','<h5>','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','return_sale_QA','stock','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Email\x20sent\x20successfully','user','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','OUTF-','$product_details.production_date','product_name_QA1','1700804jseHQl','<strong>\x20Regards\x20</strong>','production_date','\x20<<<==>>>\x20','/preview/:id','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.primary_code','$product_details.secondary_unit','Spanish','5025774edoJRT','foreach\x20newproduct','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','due_amount','product_code','product_data','../middleware/auth','slice','name','return_sale_finished','$product_details.maxProducts','floor','$product_details.product_stock','<html><head><title></title>','sales_quantity','get','Router','$product_details._id','/view/add_sales/:id','64cFkmWB','catch','<h5\x20style=\x22text-align:\x20left;\x22>','level','primary_code_QA','for_categorize','\x20==\x20','sales_quantity_QA','Chinese','English','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','\x20>>>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','room','role','1693870YaUbCL','then','date','status','1318380nmKsTk','product_details','Arabic','sendMail','currency_placement','$product_details.secondary_code','log','</div>','getDate','$room','QA\x20Warehouse','post','True','product_name','<span\x20style=\x22float:\x20right;\x22>','$product_details.bin','return_qty','unit_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','find','stocks_QA','Sales\x20Mail','FGSEmail','staff','prod_invoice','RoomAssigned','carton','Ambient','gmail','secondary_unit_QA','Enabled','abs','customer','$sale_product.bin','<h2>\x20','suppliers','success','<tr>','room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','back','$product_details.product_name','maxPerUnit_QA','findOne','<tbody\x20style=\x22text-align:\x20center;\x22>','random','received_amount','host','$date','/../public','Return\x20Goods','maxProducts_QA','German','$product_details','Add\x20Sales','Sale\x20Return\x20Mail','all','$sale_product.quantity','/upload/','add\x20post','customer_data','<hr\x20class=\x22my-3\x22>','secondary_unit','</body></html>','toString','filter','$product_details.unit','maxPerUnit','150YIepOO','/all_sales/view','1568430dFkRao','/view/return_sales/:id','prod_cat','English\x20(US)','json','$product_details.batch_code','$product.product_name','length','$note','Logo.png','return_sale','expiry_date','note','express','$customers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','adjust_qty','purchases_data','email','product_date','map','currency','/all_sales_finished/preview/','product','return_qty_QA','Sale\x20Return','customers_docs','$sale_product','Return\x20Rooms','message','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','secondary_code_QA','68512HJoNHY','</head><body>','findById','An\x20error\x20occurred\x20while\x20saving\x20data.','split','prod_code','$sale_product.bay','password','string','forEach','/view','errors','site_title','barcode\x20Product\x20master','/view/:id','getFullYear','product_stock','aggregate','$product_details.product_code','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$sale_product.floorlevel','batch_code_QA','bay','Portuguese\x20(BR)'];a0_0x44e4=function(){return _0x45ab67;};return a0_0x44e4();}router['get'](a0_0x2c9cf0(0x1f8),auth,async(_0x4e3a2d,_0x2b7898)=>{var _0x1c27be=a0_0x2c9cf0;try{const {username:_0x1fcb9a,email:_0x2efdbc,role:_0x170fe5}=_0x4e3a2d[_0x1c27be(0x270)],_0x4f8c56=_0x4e3a2d['user'],_0x229823=await profile[_0x1c27be(0x2cf)]({'email':_0x4f8c56[_0x1c27be(0x1df)]}),_0x20d330=await master_shop[_0x1c27be(0x2b7)]();let _0x464125;if(_0x4f8c56['role']==_0x1c27be(0x2bb)){const _0x3fb2fb=await staff['findOne']({'email':_0x4f8c56[_0x1c27be(0x1df)]});_0x464125=await sales_finished[_0x1c27be(0x1ff)]([{'$lookup':{'from':_0x1c27be(0x250),'localField':_0x1c27be(0x2c4),'foreignField':_0x1c27be(0x286),'as':_0x1c27be(0x1e7)}},{'$unwind':_0x1c27be(0x1db)},{'$unwind':_0x1c27be(0x1e8)},{'$group':{'_id':_0x1c27be(0x230),'invoice':{'$first':_0x1c27be(0x232)},'customers':{'$first':_0x1c27be(0x263)},'date':{'$first':_0x1c27be(0x2d4)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x1c27be(0x1d5)},'return_data':{'$first':_0x1c27be(0x21e)},'customers_docs':{'$first':_0x1c27be(0x1db)},'total_saleproduct_quantity':{'$sum':_0x1c27be(0x1c0)},'level':{'$addToSet':_0x1c27be(0x1f4)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x1c27be(0x22d)},'pallet':{'$addToSet':_0x1c27be(0x203)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x464125=await sales_finished[_0x1c27be(0x1ff)]([{'$lookup':{'from':'customers','localField':_0x1c27be(0x2c4),'foreignField':'name','as':_0x1c27be(0x1e7)}},{'$unwind':_0x1c27be(0x1db)},{'$unwind':_0x1c27be(0x1e8)},{'$group':{'_id':_0x1c27be(0x230),'invoice':{'$first':_0x1c27be(0x232)},'customers':{'$first':'$customer'},'date':{'$first':_0x1c27be(0x2d4)},'warehouse_name':{'$first':_0x1c27be(0x212)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x1c27be(0x1d5)},'return_data':{'$first':_0x1c27be(0x21e)},'customers_docs':{'$first':_0x1c27be(0x1db)},'total_saleproduct_quantity':{'$sum':_0x1c27be(0x1c0)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x1c27be(0x2c5)},'type':{'$addToSet':_0x1c27be(0x22d)},'pallet':{'$addToSet':_0x1c27be(0x203)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x20d330[0x0][_0x1c27be(0x237)]==_0x1c27be(0x1d0)){var _0x1f45f6=users[_0x1c27be(0x29a)];console[_0x1c27be(0x2aa)](_0x1f45f6);}else{if(_0x20d330[0x0][_0x1c27be(0x237)]==_0x1c27be(0x239))var _0x1f45f6=users[_0x1c27be(0x239)];else{if(_0x20d330[0x0][_0x1c27be(0x237)]==_0x1c27be(0x2d8))var _0x1f45f6=users[_0x1c27be(0x2d8)];else{if(_0x20d330[0x0][_0x1c27be(0x237)]=='Spanish')var _0x1f45f6=users[_0x1c27be(0x27d)];else{if(_0x20d330[0x0][_0x1c27be(0x237)]==_0x1c27be(0x244))var _0x1f45f6=users['French'];else{if(_0x20d330[0x0][_0x1c27be(0x237)]==_0x1c27be(0x206))var _0x1f45f6=users[_0x1c27be(0x1eb)];else{if(_0x20d330[0x0]['language']=='Chinese')var _0x1f45f6=users[_0x1c27be(0x299)];else{if(_0x20d330[0x0][_0x1c27be(0x237)]=='Arabic\x20(ae)')var _0x1f45f6=users[_0x1c27be(0x2a6)];}}}}}}}_0x2b7898[_0x1c27be(0x223)]('all_sales_finished',{'success':_0x4e3a2d[_0x1c27be(0x21b)](_0x1c27be(0x2c8)),'errors':_0x4e3a2d[_0x1c27be(0x21b)]('errors'),'sales':_0x464125,'profile':_0x229823,'role':_0x4f8c56,'master_shop':_0x20d330,'language':_0x1f45f6});}catch(_0x4b968f){console[_0x1c27be(0x2aa)](_0x4b968f);}});async function getRandom8DigitNumber(){var _0x1f4001=a0_0x2c9cf0;const _0x5d3691=0x989680,_0x36a47b=0x5f5e0ff,_0x4a2d28=Math[_0x1f4001(0x289)](Math[_0x1f4001(0x2d1)]()*(_0x36a47b-_0x5d3691+0x1))+_0x5d3691;var _0x347790;const _0x171cf9=await sales_finished[_0x1f4001(0x2cf)]({'invoice':_0x1f4001(0x272)+_0x4a2d28});return _0x171cf9&&_0x171cf9['length']>0x0?_0x347790=_0x1f4001(0x272)+_0x4a2d28:_0x347790=_0x1f4001(0x272)+_0x4a2d28,_0x347790;}router['get']('/view/add_sales',auth,async(_0x35c8fd,_0x37dbc1)=>{var _0x217085=a0_0x2c9cf0;try{const {username:_0x449a7b,email:_0x10e559,role:_0x52321e}=_0x35c8fd[_0x217085(0x270)],_0x2d39b4=_0x35c8fd[_0x217085(0x270)],_0x40523e=await profile[_0x217085(0x2cf)]({'email':_0x2d39b4[_0x217085(0x1df)]}),_0x58f9d0=await master_shop[_0x217085(0x2b7)](),_0x45cbc6=await customer[_0x217085(0x2b7)]({});let _0x4fecb3;if(_0x2d39b4[_0x217085(0x29f)]==_0x217085(0x2bb)){const _0x4826e3=await staff['findOne']({'email':_0x2d39b4[_0x217085(0x1df)]});_0x4fecb3=await warehouse[_0x217085(0x1ff)]([{'$match':{'status':_0x217085(0x2c2),'name':_0x4826e3[_0x217085(0x208)],'warehouse_category':_0x217085(0x23a),'name':{'$ne':_0x217085(0x2ae)}}},{'$group':{'_id':_0x217085(0x26d),'name':{'$first':_0x217085(0x26d)}}},{'$sort':{'name':0x1}}]);}else _0x4fecb3=await warehouse[_0x217085(0x1ff)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x523205=await product[_0x217085(0x2b7)]({});var _0x526375=[_0x217085(0x2bf),_0x217085(0x242)];const _0x3671b6=await sales_finished[_0x217085(0x2b7)]({}),_0x4841c5=_0x3671b6['length']+0x1,_0x4cd348='OUTF-'+_0x4841c5[_0x217085(0x1c7)]()[_0x217085(0x21d)](0x5,'0');if(_0x58f9d0[0x0][_0x217085(0x237)]==_0x217085(0x1d0)){var _0x3b668c=users[_0x217085(0x29a)];console[_0x217085(0x2aa)](_0x3b668c);}else{if(_0x58f9d0[0x0][_0x217085(0x237)]==_0x217085(0x239))var _0x3b668c=users[_0x217085(0x239)];else{if(_0x58f9d0[0x0]['language']==_0x217085(0x2d8))var _0x3b668c=users[_0x217085(0x2d8)];else{if(_0x58f9d0[0x0]['language']=='Spanish')var _0x3b668c=users[_0x217085(0x27d)];else{if(_0x58f9d0[0x0]['language']=='French')var _0x3b668c=users[_0x217085(0x244)];else{if(_0x58f9d0[0x0][_0x217085(0x237)]==_0x217085(0x206))var _0x3b668c=users[_0x217085(0x1eb)];else{if(_0x58f9d0[0x0][_0x217085(0x237)]==_0x217085(0x299))var _0x3b668c=users['Chinese'];else{if(_0x58f9d0[0x0]['language']==_0x217085(0x20a))var _0x3b668c=users['Arabic'];}}}}}}}const _0x43a0d6=getRandom8DigitNumber();_0x43a0d6[_0x217085(0x2a1)](_0x5dc35d=>{var _0x58dc9f=_0x217085;_0x37dbc1[_0x58dc9f(0x223)]('add_sales_finished',{'success':_0x35c8fd[_0x58dc9f(0x21b)](_0x58dc9f(0x2c8)),'errors':_0x35c8fd[_0x58dc9f(0x21b)]('errors'),'role':_0x2d39b4,'profile':_0x40523e,'customer':_0x45cbc6,'warehouse':_0x4fecb3,'product':_0x523205,'invoice':_0x5dc35d,'master_shop':_0x58f9d0,'language':_0x3b668c,'rooms_data':_0x526375});})[_0x217085(0x292)](_0x2ac671=>{var _0x31766c=_0x217085;_0x35c8fd[_0x31766c(0x21b)](_0x31766c(0x1f9),_0x31766c(0x25f)),_0x37dbc1[_0x31766c(0x247)](_0x31766c(0x262));});}catch(_0x344752){console[_0x217085(0x2aa)](_0x344752);}}),router[a0_0x2c9cf0(0x28d)](a0_0x2c9cf0(0x290),auth,async(_0x5697fc,_0x565198)=>{var _0x43995e=a0_0x2c9cf0;try{const _0x31755c=_0x5697fc[_0x43995e(0x231)]['id'];console[_0x43995e(0x2aa)](_0x31755c);const _0x5f4a6c=await product[_0x43995e(0x2b7)](),_0x3b4aac=await purchases[_0x43995e(0x1ff)]([{'$match':{'warehouse_name':_0x31755c}},{'$unwind':_0x43995e(0x252)},{'$group':{'_id':_0x43995e(0x1d3)}}]);console[_0x43995e(0x2aa)](_0x43995e(0x1de),_0x3b4aac),_0x565198[_0x43995e(0x2a3)](0xc8)[_0x43995e(0x1d1)]({'purchases_data':_0x3b4aac,'product_data':_0x5f4a6c});}catch(_0x1f7b52){console[_0x43995e(0x2aa)](_0x1f7b52);}}),router[a0_0x2c9cf0(0x2af)]('/view/add_sale/product',auth,async(_0x4e38d9,_0x229f87)=>{var _0x717c33=a0_0x2c9cf0;try{const {warehouse_data:_0x16f530,product_data:_0x4a82e8}=_0x4e38d9[_0x717c33(0x210)];console['log'](_0x4e38d9[_0x717c33(0x210)][_0x717c33(0x283)]);;const _0x239a9b=await master_shop[_0x717c33(0x2b7)]();console[_0x717c33(0x2aa)](_0x717c33(0x25d),_0x239a9b);const _0x5c7141=await product[_0x717c33(0x2cf)]({'name':_0x4a82e8});console['log'](_0x717c33(0x1e4),_0x5c7141);const _0x5b1931=await warehouse['aggregate']([{'$match':{'name':_0x16f530}},{'$unwind':_0x717c33(0x2d9)},{'$match':{'product_details.product_name':_0x4a82e8}},{'$group':{'_id':_0x717c33(0x2cd),'product_stock':{'$first':_0x717c33(0x28a)}}}]);console['log']('stock_data',_0x5b1931),_0x229f87[_0x717c33(0x2a3)](0xc8)['json']({'master':_0x239a9b,'new_product':_0x5c7141,'stock_data':_0x5b1931});}catch(_0x491cd8){console[_0x717c33(0x2aa)](_0x491cd8);}}),router[a0_0x2c9cf0(0x2af)]('/view/add_sales',auth,async(_0x1b1467,_0x2997aa)=>{var _0x514267=a0_0x2c9cf0;try{const {invoice:_0x9b2e5b,date:_0x193359,warehouse_name:_0xbfa246,product_name:_0x484c83,stock:_0x2cf76c,quantity:_0x22a421,note:_0xb62a0b,room:_0x2d8625,primary_code:_0x3b1b27,secondary_code:_0x18d992,prod_code:_0x4cdf9c,level:_0x31a19f,isle:_0x1848ad,pallet:_0x47df1c,batch_code:_0x832158,SCRN:_0x294fd8,expiry_date:_0x4161e1,mode_transpo:_0x128eac,name_driver:_0xab47ab}=_0x1b1467[_0x514267(0x210)];if(typeof _0x484c83=='string')var _0x335388=[_0x1b1467[_0x514267(0x210)][_0x514267(0x2b1)]],_0x392dca=[_0x1b1467[_0x514267(0x210)]['stock']],_0x391fce=[_0x1b1467[_0x514267(0x210)][_0x514267(0x2be)]],_0x351ad0=[_0x1b1467['body']['primary_code']],_0x4f060d=[_0x1b1467[_0x514267(0x210)][_0x514267(0x266)]],_0x3ef060=[_0x1b1467[_0x514267(0x210)][_0x514267(0x1f3)]],_0x1aa4c2=[_0x1b1467[_0x514267(0x210)][_0x514267(0x294)]],_0x2a07d6=[_0x1b1467[_0x514267(0x210)][_0x514267(0x209)]],_0x4ceb62=[_0x1b1467[_0x514267(0x210)][_0x514267(0x1c5)]],_0x7f4b38=[_0x1b1467[_0x514267(0x210)][_0x514267(0x23f)]],_0x26b6bb=[_0x1b1467[_0x514267(0x210)]['expiry_date']],_0x5d53d0=[_0x1b1467[_0x514267(0x210)][_0x514267(0x1e0)]],_0x5ca363=[_0x1b1467[_0x514267(0x210)][_0x514267(0x213)]],_0x1b721f=[_0x1b1467['body'][_0x514267(0x1cf)]],_0x5558b8=[_0x1b1467['body'][_0x514267(0x2bd)]],_0x5379b9=[_0x1b1467[_0x514267(0x210)]['prod_invoice']],_0x589b0d=[_0x1b1467[_0x514267(0x210)][_0x514267(0x216)]];else var _0x335388=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x2b1)]],_0x392dca=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x26c)]],_0x391fce=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x2be)]],_0x351ad0=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x227)]],_0x4f060d=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x266)]],_0x3ef060=[..._0x1b1467['body'][_0x514267(0x1f3)]],_0x1aa4c2=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x294)]],_0x2a07d6=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x209)]],_0x4ceb62=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x1c5)]],_0x7f4b38=[..._0x1b1467[_0x514267(0x210)]['batch_code']],_0x26b6bb=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x1d8)]],_0x5d53d0=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x1e0)]],_0x5ca363=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x213)]],_0x1b721f=[..._0x1b1467['body'][_0x514267(0x1cf)]],_0x5558b8=[..._0x1b1467[_0x514267(0x210)]['RoomAssigned']],_0x5379b9=[..._0x1b1467[_0x514267(0x210)][_0x514267(0x2bc)]],_0x589b0d=[..._0x1b1467[_0x514267(0x210)]['id_transaction_from']];const _0x10cec6=_0x335388[_0x514267(0x1e1)](_0x2cd953=>{return _0x2cd953={'product_name':_0x2cd953};});_0x392dca[_0x514267(0x1f7)]((_0x2d7f6c,_0xa25f63)=>{var _0x9c7ba6=_0x514267;_0x10cec6[_0xa25f63][_0x9c7ba6(0x26c)]=_0x2d7f6c;}),_0x391fce[_0x514267(0x1f7)]((_0x3899fe,_0x4ecddb)=>{var _0x4ff624=_0x514267;_0x10cec6[_0x4ecddb]['quantity']=Math[_0x4ff624(0x2c3)](_0x3899fe);}),_0x589b0d['forEach']((_0x1218f0,_0x3c1b5f)=>{var _0x2faed0=_0x514267;_0x10cec6[_0x3c1b5f][_0x2faed0(0x216)]=_0x1218f0;}),_0x351ad0['forEach']((_0x104a8a,_0x2765c9)=>{var _0x222718=_0x514267;_0x10cec6[_0x2765c9][_0x222718(0x227)]=_0x104a8a;}),_0x4f060d[_0x514267(0x1f7)]((_0x1c6a48,_0x814a4)=>{var _0x26d796=_0x514267;_0x10cec6[_0x814a4][_0x26d796(0x266)]=_0x1c6a48;}),_0x3ef060['forEach']((_0x42a0c6,_0x10b68d)=>{_0x10cec6[_0x10b68d]['product_code']=_0x42a0c6;}),_0x1aa4c2[_0x514267(0x1f7)]((_0x244295,_0x415512)=>{_0x10cec6[_0x415512]['bay']=_0x244295;}),_0x2a07d6[_0x514267(0x1f7)]((_0x4a5fa8,_0x456b23)=>{var _0x199047=_0x514267;_0x10cec6[_0x456b23][_0x199047(0x220)]=_0x4a5fa8;}),_0x4ceb62[_0x514267(0x1f7)]((_0x5f5426,_0x201c67)=>{_0x10cec6[_0x201c67]['secondary_unit']=_0x5f5426;}),_0x7f4b38[_0x514267(0x1f7)]((_0x520f87,_0x510ebe)=>{var _0xe1b3b2=_0x514267;_0x10cec6[_0x510ebe][_0xe1b3b2(0x23f)]=_0x520f87;}),_0x26b6bb[_0x514267(0x1f7)]((_0x1c5692,_0x2a6e8d)=>{var _0x4d679b=_0x514267;_0x10cec6[_0x2a6e8d][_0x4d679b(0x1d8)]=_0x1c5692;}),_0x5d53d0[_0x514267(0x1f7)]((_0x1aefad,_0xde2b9e)=>{var _0x2eb7de=_0x514267;_0x10cec6[_0xde2b9e][_0x2eb7de(0x277)]=_0x1aefad;}),_0x5ca363[_0x514267(0x1f7)]((_0xf0a19e,_0x3c03fd)=>{_0x10cec6[_0x3c03fd]['maxperunit']=_0xf0a19e;}),_0x1b721f[_0x514267(0x1f7)]((_0x2024bf,_0xd7f88c)=>{var _0x29feb4=_0x514267;_0x10cec6[_0xd7f88c][_0x29feb4(0x1cf)]=_0x2024bf;}),_0x5558b8[_0x514267(0x1f7)]((_0x320e22,_0xa116db)=>{var _0x2e40a1=_0x514267;_0x10cec6[_0xa116db][_0x2e40a1(0x2ca)]=_0x320e22;}),_0x5379b9['forEach']((_0x178803,_0x3fd386)=>{var _0x5beab3=_0x514267;_0x10cec6[_0x3fd386][_0x5beab3(0x240)]=_0x178803;});var _0x298ead=0x0;_0x10cec6[_0x514267(0x1f7)](_0x476c9b=>{var _0x166be7=_0x514267;parseFloat(_0x476c9b[_0x166be7(0x26c)])<parseFloat(_0x476c9b['quantity'])&&parseFloat(_0x476c9b['quantity'])>parseFloat(_0x476c9b[_0x166be7(0x26c)])&&(console[_0x166be7(0x2aa)](_0x476c9b[_0x166be7(0x26c)]+_0x166be7(0x21c)+_0x476c9b['quantity']),_0x298ead++);});if(_0x298ead!=0x0)return _0x1b1467[_0x514267(0x21b)]('errors','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x2997aa[_0x514267(0x247)](_0x514267(0x2cc));const _0x3790e9=_0x10cec6[_0x514267(0x1c8)](_0x2248d4=>_0x2248d4['quantity']!=='0'&&_0x2248d4['quantity']!==''),_0x2a144c=new sales_finished({'invoice':_0x9b2e5b,'customer':_0x1b1467[_0x514267(0x210)][_0x514267(0x2c4)],'date':_0x193359,'warehouse_name':_0xbfa246,'sale_product':_0x3790e9,'note':_0xb62a0b,'room':_0x2d8625,'primary_code':_0x3b1b27,'secondary_code':_0x18d992,'prod_code':_0x4cdf9c,'SCRN':_0x294fd8,'finalize':'False','mode_transpo':_0x128eac,'name_driver':_0xab47ab}),_0x509896=await _0x2a144c[_0x514267(0x229)](),_0x2b5f47=await sales_finished[_0x514267(0x2cf)]({'invoice':_0x9b2e5b}),_0x304fc2=new c_payment_data({'invoice':_0x9b2e5b,'customer':_0x1b1467[_0x514267(0x210)][_0x514267(0x2c4)],'reason':_0x514267(0x20b)});await _0x304fc2['save']();const _0x429bcd=await master_shop[_0x514267(0x2b7)](),_0x259e49=await email_settings[_0x514267(0x2cf)](),_0x2717ca=await customer[_0x514267(0x2cf)]({'name':_0x1b1467[_0x514267(0x210)]['customer']});_0x429bcd[0x0]['currency_placement']==0x1?(right_currency=_0x429bcd[0x0][_0x514267(0x1e2)],left_currency=''):(right_currency='',left_currency=_0x429bcd[0x0][_0x514267(0x1e2)]);var _0x230a4f=_0x335388,_0x5f015d=_0x391fce,_0x5f2f5e='',_0x4c74ff;for(_0x4c74ff in _0x230a4f){_0x5f2f5e+='<tr>'+_0x514267(0x29b)+_0x230a4f[_0x4c74ff]+_0x514267(0x21a)+_0x514267(0x29b)+_0x5f015d[_0x4c74ff]+_0x514267(0x21a)+_0x514267(0x218);}console[_0x514267(0x2aa)](_0x514267(0x257),_0x5f2f5e);let _0x33f64a=nodemailer[_0x514267(0x214)]({'host':_0x259e49[_0x514267(0x2d3)],'port':Number(_0x259e49[_0x514267(0x235)]),'secure':![],'service':_0x514267(0x2c0),'auth':{'user':_0x259e49[_0x514267(0x1df)],'pass':_0x259e49['password']}}),_0x45e2bf={'from':_0x259e49[_0x514267(0x1df)],'to':'christian.villamer@jakagroup.com','subject':_0x514267(0x2da),'attachments':[{'filename':_0x514267(0x1d6),'path':__dirname+_0x514267(0x2d5)+_0x514267(0x1c1)+_0x429bcd[0x0][_0x514267(0x25b)],'cid':'logo'}],'html':_0x514267(0x207)};_0x33f64a[_0x514267(0x2a7)](_0x45e2bf,function(_0xd25919,_0xd43577){var _0x326241=_0x514267;_0xd25919?(console['log'](_0xd25919),console[_0x326241(0x2aa)](_0x326241(0x201))):console[_0x326241(0x2aa)](_0x326241(0x26f));}),_0x1b1467[_0x514267(0x21b)]('success','Sales\x20Add\x20successfully'),_0x2997aa[_0x514267(0x247)](_0x514267(0x1e3)+_0x509896[_0x514267(0x258)]);}catch(_0x48e2c7){console[_0x514267(0x2aa)](_0x48e2c7);}}),router['get'](a0_0x2c9cf0(0x279),auth,async(_0x53e6c8,_0x4bea13)=>{var _0x19b8f=a0_0x2c9cf0;try{const {username:_0x6d245,email:_0x502371,role:_0x4c696a}=_0x53e6c8[_0x19b8f(0x270)],_0x757df6=_0x53e6c8[_0x19b8f(0x270)],_0x422f70=await profile[_0x19b8f(0x2cf)]({'email':_0x757df6[_0x19b8f(0x1df)]}),_0x152415=await master_shop['find'](),_0x4eb108=_0x53e6c8['params']['id'],_0x40969f=await sales_finished[_0x19b8f(0x1f0)](_0x4eb108),_0x33636d=await warehouse['aggregate']([{'$match':{'name':_0x40969f[_0x19b8f(0x24f)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x19b8f(0x28f),'name':{'$first':_0x19b8f(0x2cd)},'product_stock':{'$first':_0x19b8f(0x28a)},'bay':{'$first':_0x19b8f(0x25e)},'bin':{'$first':_0x19b8f(0x2b3)},'type':{'$first':_0x19b8f(0x219)},'floorlevel':{'$first':_0x19b8f(0x267)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x19b8f(0x2a9)},'product_code':{'$first':_0x19b8f(0x200)},'storage':{'$first':_0x19b8f(0x246)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x19b8f(0x236)},'production_date':{'$first':_0x19b8f(0x273)},'batch_code':{'$first':_0x19b8f(0x1d2)},'room':{'$first':'$room'},'room_data':{'$first':_0x19b8f(0x22b)}}}]),_0x36b550=await customer[_0x19b8f(0x2b7)]({});let _0x29bd11;if(_0x757df6[_0x19b8f(0x29f)]=='staff'){const _0x390459=await staff[_0x19b8f(0x2cf)]({'email':_0x757df6[_0x19b8f(0x1df)]});_0x29bd11=await warehouse['aggregate']([{'$match':{'status':_0x19b8f(0x2c2),'name':_0x390459[_0x19b8f(0x208)]}},{'$group':{'_id':_0x19b8f(0x26d),'name':{'$first':_0x19b8f(0x26d)}}}]);}else _0x29bd11=await warehouse['aggregate']([{'$match':{'status':_0x19b8f(0x2c2)}},{'$group':{'_id':_0x19b8f(0x26d),'name':{'$first':_0x19b8f(0x26d)}}}]);const _0x5e0266=await product['find']({});if(_0x152415[0x0]['language']==_0x19b8f(0x1d0)){var _0x118b75=users[_0x19b8f(0x29a)];console[_0x19b8f(0x2aa)](_0x118b75);}else{if(_0x152415[0x0][_0x19b8f(0x237)]==_0x19b8f(0x239))var _0x118b75=users[_0x19b8f(0x239)];else{if(_0x152415[0x0]['language']==_0x19b8f(0x2d8))var _0x118b75=users[_0x19b8f(0x2d8)];else{if(_0x152415[0x0][_0x19b8f(0x237)]==_0x19b8f(0x27d))var _0x118b75=users[_0x19b8f(0x27d)];else{if(_0x152415[0x0][_0x19b8f(0x237)]==_0x19b8f(0x244))var _0x118b75=users['French'];else{if(_0x152415[0x0][_0x19b8f(0x237)]==_0x19b8f(0x206))var _0x118b75=users[_0x19b8f(0x1eb)];else{if(_0x152415[0x0][_0x19b8f(0x237)]==_0x19b8f(0x299))var _0x118b75=users['Chinese'];else{if(_0x152415[0x0][_0x19b8f(0x237)]=='Arabic\x20(ae)')var _0x118b75=users[_0x19b8f(0x2a6)];}}}}}}}_0x4bea13[_0x19b8f(0x223)](_0x19b8f(0x222),{'success':_0x53e6c8[_0x19b8f(0x21b)](_0x19b8f(0x2c8)),'errors':_0x53e6c8[_0x19b8f(0x21b)](_0x19b8f(0x1f9)),'role':_0x757df6,'profile':_0x422f70,'customer':_0x36b550,'warehouse':_0x29bd11,'product':_0x33636d,'user':_0x40969f,'master_shop':_0x152415,'unit':_0x5e0266,'language':_0x118b75});}catch(_0x4ec882){console[_0x19b8f(0x2aa)](_0x4ec882);}}),router[a0_0x2c9cf0(0x2af)](a0_0x2c9cf0(0x279),auth,async(_0x10aef9,_0x3a6eb0)=>{var _0x51593b=a0_0x2c9cf0;try{const _0x458ab9=_0x10aef9[_0x51593b(0x231)]['id'],{invoice:_0x328f3f,warehouse_name:_0x52ea9a,room:_0x25b711}=_0x10aef9['body'],_0x1e6e90=await sales_finished['findOne']({'invoice':_0x328f3f}),_0x31fba3=_0x1e6e90[_0x51593b(0x23c)][_0x51593b(0x1e1)](async _0x4a0bb0=>{var _0x58ce1f=_0x51593b,_0x17c024=await warehouse[_0x58ce1f(0x2cf)]({'name':_0x52ea9a,'room':_0x4a0bb0[_0x58ce1f(0x2ca)],'warehouse_category':_0x58ce1f(0x23a)});const _0x1f80d1=_0x17c024[_0x58ce1f(0x2a5)][_0x58ce1f(0x1e1)](_0x4953ef=>{var _0x4ec7fc=_0x58ce1f;(_0x4953ef[_0x4ec7fc(0x2b1)]==_0x4a0bb0[_0x4ec7fc(0x2b1)]&&_0x4953ef['bay']==_0x4a0bb0[_0x4ec7fc(0x205)]&&_0x4953ef[_0x4ec7fc(0x1d8)]==_0x4a0bb0[_0x4ec7fc(0x1d8)]&&_0x4953ef[_0x4ec7fc(0x277)]==_0x4a0bb0[_0x4ec7fc(0x277)]&&_0x4953ef['batch_code']==_0x4a0bb0[_0x4ec7fc(0x23f)]&&_0x4953ef[_0x4ec7fc(0x240)]==_0x4a0bb0[_0x4ec7fc(0x240)]||_0x4953ef[_0x4ec7fc(0x258)]==_0x4a0bb0[_0x4ec7fc(0x216)])&&(_0x4953ef[_0x4ec7fc(0x1fe)]>0x0&&(console[_0x4ec7fc(0x2aa)](_0x4953ef[_0x4ec7fc(0x2b1)]+_0x4ec7fc(0x297)+_0x4a0bb0['product_name']+_0x4ec7fc(0x20d)+_0x4953ef[_0x4ec7fc(0x205)]+_0x4ec7fc(0x297)+_0x4a0bb0[_0x4ec7fc(0x205)]+_0x4ec7fc(0x20d)+_0x4953ef[_0x4ec7fc(0x277)]+_0x4ec7fc(0x297)+_0x4a0bb0[_0x4ec7fc(0x277)]+'\x20&&\x20'+_0x4953ef[_0x4ec7fc(0x1d8)]+_0x4ec7fc(0x297)+_0x4a0bb0[_0x4ec7fc(0x1d8)]+'\x20&&\x20'+_0x4953ef['batch_code']+_0x4ec7fc(0x297)+_0x4a0bb0[_0x4ec7fc(0x23f)]+_0x4ec7fc(0x20d)+_0x4953ef[_0x4ec7fc(0x240)]+_0x4ec7fc(0x297)+_0x4a0bb0[_0x4ec7fc(0x240)]+_0x4ec7fc(0x20d)+_0x4953ef[_0x4ec7fc(0x1fe)]+_0x4ec7fc(0x278)+_0x4a0bb0[_0x4ec7fc(0x241)]+_0x4ec7fc(0x29c)+_0x4a0bb0[_0x4ec7fc(0x2ca)]+_0x4ec7fc(0x20d)+_0x4953ef[_0x4ec7fc(0x258)]+_0x4ec7fc(0x297)+_0x4a0bb0[_0x4ec7fc(0x216)]),_0x4953ef['product_stock']=Math['max'](0x0,Math[_0x4ec7fc(0x2c3)](_0x4953ef['product_stock'])-Math[_0x4ec7fc(0x2c3)](_0x4a0bb0[_0x4ec7fc(0x241)]))));});return _0x17c024;});Promise['all'](_0x31fba3)[_0x51593b(0x2a1)](async _0xd4b889=>{var _0x4cda21=_0x51593b;try{for(const _0x2d2f1f of _0xd4b889){await _0x2d2f1f[_0x4cda21(0x229)]();}_0x1e6e90['finalize']=_0x4cda21(0x2b0);const _0x3b53e9=await _0x1e6e90[_0x4cda21(0x229)](),_0x1dca46=await master_shop['find'](),_0x43b2c5=await email_settings[_0x4cda21(0x2cf)](),_0x1c1769=await supervisor_settings['find']();var _0x3a0609=_0x1e6e90[_0x4cda21(0x23c)],_0x4b057a='',_0x59a861;for(_0x59a861 in _0x3a0609){var _0x170b28='FG';_0x1e6e90[_0x4cda21(0x24f)]==_0x4cda21(0x233)&&(_0x170b28='DG'),_0x4b057a+='<tr>'+_0x4cda21(0x29b)+_0x3a0609[_0x59a861][_0x4cda21(0x2b1)]+_0x4cda21(0x21a)+_0x4cda21(0x29b)+_0x3a0609[_0x59a861][_0x4cda21(0x282)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a0609[_0x59a861][_0x4cda21(0x241)]+_0x4cda21(0x21a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a0609[_0x59a861][_0x4cda21(0x220)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a0609[_0x59a861][_0x4cda21(0x1c5)]+_0x4cda21(0x21a)+_0x4cda21(0x29b)+_0x1e6e90[_0x4cda21(0x24f)]+_0x4cda21(0x21a)+_0x4cda21(0x29b)+_0x3a0609[_0x59a861][_0x4cda21(0x2ca)]+_0x4cda21(0x21a)+_0x4cda21(0x29b)+_0x170b28+_0x3a0609[_0x59a861]['bay']+_0x4cda21(0x21a);}let _0x5cd416=nodemailer['createTransport']({'host':_0x43b2c5['host'],'port':Number(_0x43b2c5[_0x4cda21(0x235)]),'secure':![],'auth':{'user':_0x43b2c5[_0x4cda21(0x1df)],'pass':_0x43b2c5['password']}}),_0xfe4111={'from':_0x43b2c5[_0x4cda21(0x1df)],'to':_0x1c1769[0x0][_0x4cda21(0x2ba)],'subject':_0x4cda21(0x2b9),'attachments':[{'filename':'Logo.png','path':__dirname+_0x4cda21(0x2d5)+_0x4cda21(0x1c1)+_0x1dca46[0x0][_0x4cda21(0x25b)],'cid':_0x4cda21(0x255)}],'html':'<!DOCTYPE\x20html>'+_0x4cda21(0x28b)+_0x4cda21(0x1ef)+_0x4cda21(0x20f)+_0x4cda21(0x271)+_0x4cda21(0x20f)+_0x4cda21(0x251)+'</div>'+_0x4cda21(0x20f)+_0x4cda21(0x2c6)+_0x1dca46[0x0][_0x4cda21(0x1fa)]+_0x4cda21(0x217)+_0x4cda21(0x2ab)+_0x4cda21(0x2ab)+_0x4cda21(0x1c4)+_0x4cda21(0x20f)+_0x4cda21(0x293)+'\x20Order\x20Number\x20:\x20'+_0x1e6e90[_0x4cda21(0x240)]+'\x20'+_0x4cda21(0x2b2)+'\x20Order\x20Date\x20:\x20'+_0x1e6e90['date']+'\x20'+_0x4cda21(0x23e)+_0x4cda21(0x226)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4cda21(0x280)+_0x4cda21(0x2c9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4cda21(0x26e)+_0x4cda21(0x260)+_0x4cda21(0x26a)+_0x4cda21(0x1ec)+_0x4cda21(0x25c)+_0x4cda21(0x2b6)+_0x4cda21(0x22e)+_0x4cda21(0x218)+_0x4cda21(0x265)+_0x4cda21(0x2d0)+'\x20'+_0x4b057a+'\x20'+_0x4cda21(0x264)+_0x4cda21(0x22c)+_0x4cda21(0x20f)+_0x4cda21(0x276)+_0x4cda21(0x268)+_0x1dca46[0x0][_0x4cda21(0x1fa)]+_0x4cda21(0x226)+_0x4cda21(0x2ab)+_0x4cda21(0x2ab)+_0x4cda21(0x1c6)};_0x5cd416['sendMail'](_0xfe4111,function(_0x35062d,_0x5f5699){var _0x3868f3=_0x4cda21;_0x35062d?(console[_0x3868f3(0x2aa)](_0x35062d),console['log'](_0x3868f3(0x201))):console[_0x3868f3(0x2aa)]('Email\x20sent\x20successfully');}),_0x10aef9[_0x4cda21(0x21b)](_0x4cda21(0x2c8),_0x4cda21(0x225)),_0x3a6eb0[_0x4cda21(0x247)]('/picking_list/pdf/'+_0x458ab9);}catch(_0x5a5db0){console[_0x4cda21(0x245)](_0x5a5db0),_0x3a6eb0[_0x4cda21(0x2a3)](0x1f4)[_0x4cda21(0x1d1)]({'error':_0x4cda21(0x1f1)});}})[_0x51593b(0x292)](_0x475f4a=>{var _0x802163=_0x51593b;console[_0x802163(0x245)](_0x475f4a),_0x3a6eb0[_0x802163(0x2a3)](0x1f4)['json']({'error':_0x802163(0x21f)});});}catch(_0x4f6819){console['log'](_0x4f6819);}}),router['get']('/view/:id',auth,async(_0x49c7a5,_0x5b67ff)=>{var _0x793ca0=a0_0x2c9cf0;try{const {username:_0x51ebcd,email:_0x483939,role:_0x45f2f9}=_0x49c7a5['user'],_0x518337=_0x49c7a5['user'],_0x43021c=await profile['findOne']({'email':_0x518337[_0x793ca0(0x1df)]}),_0x578113=await master_shop['find'](),_0x5da7a4=_0x49c7a5[_0x793ca0(0x231)]['id'],_0xb9d8ca=await sales_finished[_0x793ca0(0x1f0)](_0x5da7a4);let _0xae6f49=new Date(_0xb9d8ca[_0x793ca0(0x1d8)]),_0x348ceb=('0'+_0xae6f49[_0x793ca0(0x2ac)]())[_0x793ca0(0x285)](-0x2),_0x154d4a=('0'+(_0xae6f49[_0x793ca0(0x238)]()+0x1))[_0x793ca0(0x285)](-0x2),_0x3b4794=_0xae6f49[_0x793ca0(0x1fd)](),_0x47cf69=_0x3b4794+'-'+_0x154d4a+'-'+_0x348ceb;var _0x85e25a=['Ambient',_0x793ca0(0x242)];const _0x15005e=await warehouse['aggregate']([{'$match':{'name':_0xb9d8ca[_0x793ca0(0x24f)],'room':_0xb9d8ca[_0x793ca0(0x29e)]}},{'$unwind':_0x793ca0(0x2d9)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x793ca0(0x2cd)},'product_stock':{'$first':_0x793ca0(0x28a)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x793ca0(0x2b3)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x793ca0(0x267)},'primary_code':{'$first':_0x793ca0(0x27b)},'secondary_code':{'$first':_0x793ca0(0x2a9)},'product_code':{'$first':_0x793ca0(0x200)},'storage':{'$first':_0x793ca0(0x246)},'rack':{'$first':_0x793ca0(0x256)}}}]),_0x5c292d=await customer[_0x793ca0(0x2b7)]({});let _0x5a395b;if(_0x518337[_0x793ca0(0x29f)]==_0x793ca0(0x2bb)){const _0x519024=await staff[_0x793ca0(0x2cf)]({'email':_0x518337[_0x793ca0(0x1df)]});_0x5a395b=await warehouse['aggregate']([{'$match':{'status':_0x793ca0(0x2c2),'name':_0x519024[_0x793ca0(0x208)]}},{'$group':{'_id':_0x793ca0(0x26d),'name':{'$first':_0x793ca0(0x26d)}}}]);}else _0x5a395b=await warehouse[_0x793ca0(0x1ff)]([{'$match':{'status':_0x793ca0(0x2c2)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x197f53=await product[_0x793ca0(0x2b7)]({});if(_0x578113[0x0][_0x793ca0(0x237)]==_0x793ca0(0x1d0)){var _0x182994=users[_0x793ca0(0x29a)];console[_0x793ca0(0x2aa)](_0x182994);}else{if(_0x578113[0x0]['language']==_0x793ca0(0x239))var _0x182994=users[_0x793ca0(0x239)];else{if(_0x578113[0x0][_0x793ca0(0x237)]==_0x793ca0(0x2d8))var _0x182994=users['German'];else{if(_0x578113[0x0][_0x793ca0(0x237)]==_0x793ca0(0x27d))var _0x182994=users[_0x793ca0(0x27d)];else{if(_0x578113[0x0]['language']==_0x793ca0(0x244))var _0x182994=users[_0x793ca0(0x244)];else{if(_0x578113[0x0]['language']=='Portuguese\x20(BR)')var _0x182994=users[_0x793ca0(0x1eb)];else{if(_0x578113[0x0][_0x793ca0(0x237)]=='Chinese')var _0x182994=users[_0x793ca0(0x299)];else{if(_0x578113[0x0][_0x793ca0(0x237)]==_0x793ca0(0x20a))var _0x182994=users[_0x793ca0(0x2a6)];}}}}}}}_0x5b67ff[_0x793ca0(0x223)]('edit_sales_finished',{'success':_0x49c7a5['flash']('success'),'errors':_0x49c7a5[_0x793ca0(0x21b)](_0x793ca0(0x1f9)),'role':_0x518337,'profile':_0x43021c,'customer':_0x5c292d,'warehouse':_0x5a395b,'product':_0x15005e,'user':_0xb9d8ca,'master_shop':_0x578113,'unit':_0x197f53,'language':_0x182994,'rooms_data':_0x85e25a,'ed_fullDate':_0x47cf69});}catch(_0x3ef1bd){console[_0x793ca0(0x2aa)](_0x3ef1bd);}}),router[a0_0x2c9cf0(0x2af)](a0_0x2c9cf0(0x1fc),auth,async(_0xafe005,_0x123096)=>{var _0x19fc08=a0_0x2c9cf0;try{const _0xf57150=_0xafe005['params']['id'],_0x569bf3=await sales_finished[_0x19fc08(0x2cf)]({'_id':_0xafe005[_0x19fc08(0x231)]['id']}),_0x3c7e96=await warehouse['findOne']({'name':_0x569bf3['warehouse_name'],'room':_0xafe005[_0x19fc08(0x210)][_0x19fc08(0x29e)],'warehouse_category':_0x19fc08(0x23a)}),{invoice:_0x42f208,customer:_0x546cfe,date:_0x2e5d41,warehouse_name:_0x270165,product_name:_0xc2d049,stock:_0x4c34a4,adjust_qty:_0x3f8029,note:_0x173f23,room:_0x1d5abe,primary_code:_0x572794,secondary_code:_0x1ff9a2,prod_code:_0x57deb2,level:_0x5c5cf2,isle:_0x10cdfd,pallet:_0x3a6170,expiry_date:_0x4fdf0e}=_0xafe005[_0x19fc08(0x210)];if(typeof _0xc2d049==_0x19fc08(0x1f6))var _0x11d8a0=[_0xafe005[_0x19fc08(0x210)][_0x19fc08(0x2b1)]],_0x14c06=[_0xafe005[_0x19fc08(0x210)]['stock']],_0x17c621=[_0xafe005['body'][_0x19fc08(0x1dd)]],_0x15a936=[_0xafe005[_0x19fc08(0x210)][_0x19fc08(0x227)]],_0x5b7699=[_0xafe005[_0x19fc08(0x210)][_0x19fc08(0x266)]],_0x2d08b0=[_0xafe005[_0x19fc08(0x210)][_0x19fc08(0x1f3)]],_0x27ccbf=[_0xafe005[_0x19fc08(0x210)]['level']],_0x4ef307=[_0xafe005[_0x19fc08(0x210)][_0x19fc08(0x1d8)]];else var _0x11d8a0=[..._0xafe005[_0x19fc08(0x210)][_0x19fc08(0x2b1)]],_0x14c06=[..._0xafe005[_0x19fc08(0x210)][_0x19fc08(0x26c)]],_0x17c621=[..._0xafe005[_0x19fc08(0x210)][_0x19fc08(0x1dd)]],_0x15a936=[..._0xafe005['body']['primary_code']],_0x5b7699=[..._0xafe005[_0x19fc08(0x210)][_0x19fc08(0x266)]],_0x2d08b0=[..._0xafe005[_0x19fc08(0x210)]['prod_code']],_0x27ccbf=[..._0xafe005[_0x19fc08(0x210)][_0x19fc08(0x294)]],_0x4ef307=[..._0xafe005[_0x19fc08(0x210)][_0x19fc08(0x1d8)]];const _0x268618=_0x11d8a0[_0x19fc08(0x1e1)](_0x53d7d=>{return _0x53d7d={'product_name':_0x53d7d};});_0x14c06['forEach']((_0x47f2b8,_0x5f4ef8)=>{var _0x5f379a=_0x19fc08;_0x268618[_0x5f4ef8][_0x5f379a(0x26c)]=_0x47f2b8;}),_0x17c621['forEach']((_0x551636,_0x274a13)=>{var _0x3879b2=_0x19fc08;_0x268618[_0x274a13][_0x3879b2(0x241)]=_0x551636;}),_0x15a936['forEach']((_0x855ffb,_0xd3389b)=>{_0x268618[_0xd3389b]['primary_code']=_0x855ffb;}),_0x5b7699['forEach']((_0x2ee823,_0x7f8cc8)=>{_0x268618[_0x7f8cc8]['secondary_code']=_0x2ee823;}),_0x2d08b0[_0x19fc08(0x1f7)]((_0x396432,_0x393e80)=>{var _0x45e45c=_0x19fc08;_0x268618[_0x393e80][_0x45e45c(0x282)]=_0x396432;}),_0x27ccbf[_0x19fc08(0x1f7)]((_0x483eca,_0x5ca9ca)=>{var _0x599e15=_0x19fc08;_0x268618[_0x5ca9ca][_0x599e15(0x294)]=_0x483eca;}),_0x4ef307[_0x19fc08(0x1f7)]((_0x214a0a,_0x2fedb7)=>{var _0x31ccd1=_0x19fc08;_0x268618[_0x2fedb7][_0x31ccd1(0x1d8)]=_0x214a0a;});var _0x198683=0x0;_0x268618[_0x19fc08(0x1f7)](_0x2eef62=>{var _0x5d10dc=_0x19fc08;console[_0x5d10dc(0x2aa)](_0x5d10dc(0x27f),_0x2eef62),(parseInt(_0x2eef62['stock'])<parseInt(_0x2eef62['quantity'])||parseInt(_0x2eef62[_0x5d10dc(0x241)])==0x0)&&_0x198683++;});if(_0x198683!=0x0)return _0xafe005[_0x19fc08(0x21b)](_0x19fc08(0x1f9),_0x19fc08(0x27a)),_0x123096[_0x19fc08(0x247)](_0x19fc08(0x2cc));_0x569bf3[_0x19fc08(0x23c)][_0x19fc08(0x1f7)](_0x1e5c70=>{const _0x1ced1c=_0x3c7e96['product_details']['map'](_0x1ef191=>{var _0x7b262a=a0_0x1421;_0x1ef191[_0x7b262a(0x2b1)]==_0x1e5c70[_0x7b262a(0x2b1)]&&_0x1ef191[_0x7b262a(0x205)]==_0x1e5c70[_0x7b262a(0x205)]&&(_0x1ef191[_0x7b262a(0x1fe)]=parseInt(_0x1ef191[_0x7b262a(0x1fe)])+parseInt(_0x1e5c70[_0x7b262a(0x241)]));});}),await _0x3c7e96[_0x19fc08(0x229)]();const _0x332394=_0x268618['filter'](_0x38e8a1=>_0x38e8a1['quantity']!=='0'&&_0x38e8a1[_0x19fc08(0x241)]!=='');_0x569bf3[_0x19fc08(0x240)]=_0x42f208,_0x569bf3[_0x19fc08(0x2c4)]=_0x546cfe,_0x569bf3[_0x19fc08(0x2a2)]=_0x2e5d41,_0x569bf3[_0x19fc08(0x24f)]=_0x270165,_0x569bf3[_0x19fc08(0x23c)]=_0x332394,_0x569bf3[_0x19fc08(0x1d9)]=_0x173f23,_0x569bf3['room']=_0x1d5abe;const _0x392e5e=await _0x569bf3[_0x19fc08(0x229)](),_0x590f28=await sales_finished[_0x19fc08(0x2cf)]({'_id':_0xafe005[_0x19fc08(0x231)]['id']}),_0xd60c5f=await warehouse['findOne']({'name':_0x270165,'room':_0x1d5abe,'warehouse_category':_0x19fc08(0x23a)});_0x590f28['sale_product'][_0x19fc08(0x1f7)](_0x18ab77=>{var _0xbb9936=_0x19fc08;const _0x7c3d2c=_0xd60c5f[_0xbb9936(0x2a5)][_0xbb9936(0x1e1)](_0x99f96e=>{var _0x3634db=_0xbb9936;_0x99f96e[_0x3634db(0x2b1)]==_0x18ab77[_0x3634db(0x2b1)]&&_0x99f96e['bay']==_0x18ab77[_0x3634db(0x205)]&&(_0x99f96e[_0x3634db(0x1fe)]=parseInt(_0x99f96e['product_stock'])-parseInt(_0x18ab77[_0x3634db(0x241)]));});}),console[_0x19fc08(0x2aa)]('final',_0xd60c5f),await _0xd60c5f[_0x19fc08(0x229)]();const _0x129e95=await c_payment_data[_0x19fc08(0x2cf)]({'invoice':_0xafe005['body'][_0x19fc08(0x240)]});_0x129e95[_0x19fc08(0x2c7)]=_0xafe005['body'][_0x19fc08(0x2c7)],await _0x129e95[_0x19fc08(0x229)](),_0xafe005[_0x19fc08(0x21b)]('success',_0x19fc08(0x225)),_0x123096[_0x19fc08(0x247)]('/all_sales_finished/view');}catch(_0x8ce667){console['log'](_0x8ce667);}}),router[a0_0x2c9cf0(0x2af)]('/give_payment/:id',auth,async(_0x1584a3,_0x311e2a)=>{var _0x3ded28=a0_0x2c9cf0;try{const _0x77e989=_0x1584a3[_0x3ded28(0x231)]['id'],{invoice:_0x17a83c,customer:_0x5863b8,receivable_amount:_0x149f83,received_amount:_0x541234}=_0x1584a3[_0x3ded28(0x210)],_0x9f6f1f=await sales[_0x3ded28(0x1f0)](_0x77e989);console[_0x3ded28(0x2aa)](_0x9f6f1f);var _0x469ba4=_0x149f83-_0x541234;console['log'](_0x541234),_0x9f6f1f[_0x3ded28(0x2d2)]=parseFloat(_0x541234)+parseFloat(_0x9f6f1f[_0x3ded28(0x2d2)]),_0x9f6f1f[_0x3ded28(0x281)]=_0x469ba4,console['log'](_0x9f6f1f);const _0x1ef43e=await _0x9f6f1f[_0x3ded28(0x229)](),_0x20fdda=await c_payment_data['findOne']({'invoice':_0x17a83c});_0x20fdda[_0x3ded28(0x261)]=_0x469ba4,await _0x20fdda[_0x3ded28(0x229)]();let _0x548579=new Date(),_0x11ade6=('0'+_0x548579[_0x3ded28(0x2ac)]())[_0x3ded28(0x285)](-0x2),_0x31d1b6=('0'+(_0x548579['getMonth']()+0x1))[_0x3ded28(0x285)](-0x2),_0x232463=_0x548579['getFullYear'](),_0x50be00=_0x232463+'-'+_0x31d1b6+'-'+_0x11ade6;const _0x52fbdf=new customer_payment({'invoice':_0x17a83c,'date':_0x232463+'-'+_0x31d1b6+'-'+_0x11ade6,'customer':_0x5863b8,'reason':_0x3ded28(0x24b),'amount':_0x541234}),_0x4e269b=await _0x52fbdf['save']();_0x1584a3[_0x3ded28(0x21b)]('success',_0x3ded28(0x24d)),_0x311e2a['redirect'](_0x3ded28(0x1cc));}catch(_0x2716cc){console[_0x3ded28(0x2aa)](_0x2716cc);}}),router[a0_0x2c9cf0(0x28d)](a0_0x2c9cf0(0x224),auth,async(_0xf7ca88,_0x141fe2)=>{var _0x4ea98f=a0_0x2c9cf0;try{const {username:_0x40e5a2,email:_0x3f3504,role:_0x560cee}=_0xf7ca88[_0x4ea98f(0x270)],_0x5a193f=_0xf7ca88[_0x4ea98f(0x270)],_0x51b420=await profile[_0x4ea98f(0x2cf)]({'email':_0x5a193f['email']}),_0x1b524b=await master_shop[_0x4ea98f(0x2b7)]();console[_0x4ea98f(0x2aa)](_0x4ea98f(0x25d),_0x1b524b);const _0x2dec91=_0xf7ca88[_0x4ea98f(0x231)]['id'],_0x1ec587=await sales[_0x4ea98f(0x1f0)](_0x2dec91);console[_0x4ea98f(0x2aa)](_0x1ec587);const _0x485a47=await customer[_0x4ea98f(0x2cf)]({'name':_0x1ec587[_0x4ea98f(0x2c4)]});console[_0x4ea98f(0x2aa)](_0x485a47);if(_0x1b524b[0x0][_0x4ea98f(0x237)]==_0x4ea98f(0x1d0)){var _0x3fd41b=users[_0x4ea98f(0x29a)];console['log'](_0x3fd41b);}else{if(_0x1b524b[0x0][_0x4ea98f(0x237)]=='Hindi')var _0x3fd41b=users[_0x4ea98f(0x239)];else{if(_0x1b524b[0x0][_0x4ea98f(0x237)]=='German')var _0x3fd41b=users[_0x4ea98f(0x2d8)];else{if(_0x1b524b[0x0][_0x4ea98f(0x237)]==_0x4ea98f(0x27d))var _0x3fd41b=users[_0x4ea98f(0x27d)];else{if(_0x1b524b[0x0][_0x4ea98f(0x237)]==_0x4ea98f(0x244))var _0x3fd41b=users[_0x4ea98f(0x244)];else{if(_0x1b524b[0x0]['language']==_0x4ea98f(0x206))var _0x3fd41b=users[_0x4ea98f(0x1eb)];else{if(_0x1b524b[0x0][_0x4ea98f(0x237)]==_0x4ea98f(0x299))var _0x3fd41b=users[_0x4ea98f(0x299)];else{if(_0x1b524b[0x0][_0x4ea98f(0x237)]==_0x4ea98f(0x20a))var _0x3fd41b=users[_0x4ea98f(0x2a6)];}}}}}}}_0x141fe2['render'](_0x4ea98f(0x20c),{'success':_0xf7ca88[_0x4ea98f(0x21b)](_0x4ea98f(0x2c8)),'errors':_0xf7ca88[_0x4ea98f(0x21b)](_0x4ea98f(0x1f9)),'role':_0x5a193f,'profile':_0x51b420,'master_shop':_0x1b524b,'customers':_0x485a47,'sales':_0x1ec587,'language':_0x3fd41b});}catch(_0x5cea16){console['log'](_0x5cea16);}}),router['get']('/view/return_sales/:id',auth,async(_0x1fd622,_0xf1f79c)=>{var _0x49c6f2=a0_0x2c9cf0;try{const {username:_0x122045,email:_0x2c6a50,role:_0x4d8fb2}=_0x1fd622[_0x49c6f2(0x270)],_0x30e229=_0x1fd622['user'],_0x18d68d=await profile[_0x49c6f2(0x2cf)]({'email':_0x30e229['email']}),_0x1f19d9=await master_shop[_0x49c6f2(0x2b7)](),_0x24bd92=_0x1fd622[_0x49c6f2(0x231)]['id'],_0x49c2df=await sales_finished['findById'](_0x24bd92),_0x33ce60=await warehouse[_0x49c6f2(0x1ff)]([{'$match':{'name':_0x49c2df[_0x49c6f2(0x24f)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x49c6f2(0x2cd)},'product_stock':{'$first':_0x49c6f2(0x28a)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x49c6f2(0x2b3)},'type':{'$first':_0x49c6f2(0x219)},'floorlevel':{'$first':_0x49c6f2(0x267)},'primary_code':{'$first':_0x49c6f2(0x27b)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x49c6f2(0x200)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x49c6f2(0x256)},'expiry_date':{'$first':_0x49c6f2(0x236)},'production_date':{'$first':_0x49c6f2(0x273)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0x49c6f2(0x288)},'batch_code':{'$first':_0x49c6f2(0x1d2)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x4e7509=await product[_0x49c6f2(0x2b7)]({}),_0x1827d9=await warehouse['aggregate']([{'$match':{'status':_0x49c6f2(0x2c2),'warehouse_category':_0x49c6f2(0x23a),'name':{'$ne':_0x49c6f2(0x2d6),'$ne':_0x49c6f2(0x215)}}},{'$group':{'_id':_0x49c6f2(0x26d),'name':{'$first':_0x49c6f2(0x26d)}}},{'$sort':{'name':0x1}}]);var _0x20c3df=[_0x49c6f2(0x1e9)];const _0x3b7c06=await warehouse[_0x49c6f2(0x1ff)]([{'$match':{'status':_0x49c6f2(0x2c2),'name':_0x49c6f2(0x215)}},{'$group':{'_id':_0x49c6f2(0x26d),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x1f19d9[0x0][_0x49c6f2(0x237)]==_0x49c6f2(0x1d0)){var _0x3d52f1=users['English'];console[_0x49c6f2(0x2aa)](_0x3d52f1);}else{if(_0x1f19d9[0x0][_0x49c6f2(0x237)]==_0x49c6f2(0x239))var _0x3d52f1=users[_0x49c6f2(0x239)];else{if(_0x1f19d9[0x0]['language']==_0x49c6f2(0x2d8))var _0x3d52f1=users[_0x49c6f2(0x2d8)];else{if(_0x1f19d9[0x0][_0x49c6f2(0x237)]=='Spanish')var _0x3d52f1=users[_0x49c6f2(0x27d)];else{if(_0x1f19d9[0x0][_0x49c6f2(0x237)]==_0x49c6f2(0x244))var _0x3d52f1=users[_0x49c6f2(0x244)];else{if(_0x1f19d9[0x0][_0x49c6f2(0x237)]==_0x49c6f2(0x206))var _0x3d52f1=users[_0x49c6f2(0x1eb)];else{if(_0x1f19d9[0x0]['language']==_0x49c6f2(0x299))var _0x3d52f1=users[_0x49c6f2(0x299)];else{if(_0x1f19d9[0x0][_0x49c6f2(0x237)]==_0x49c6f2(0x20a))var _0x3d52f1=users['Arabic'];}}}}}}}_0xf1f79c[_0x49c6f2(0x223)](_0x49c6f2(0x287),{'success':_0x1fd622[_0x49c6f2(0x21b)]('success'),'errors':_0x1fd622[_0x49c6f2(0x21b)](_0x49c6f2(0x1f9)),'role':_0x30e229,'profile':_0x18d68d,'user':_0x49c2df,'stock':_0x33ce60,'master_shop':_0x1f19d9,'unit':_0x4e7509,'language':_0x3d52f1,'warehouses':_0x1827d9,'rooms':_0x20c3df,'warehouse_QA':_0x3b7c06});}catch(_0x538379){console['log'](_0x538379),_0xf1f79c[_0x49c6f2(0x2a3)](0xc8)[_0x49c6f2(0x1d1)]({'message':_0x538379[_0x49c6f2(0x1ea)]});}}),router['post'](a0_0x2c9cf0(0x1ce),auth,async(_0x3b02a9,_0x508fe1)=>{var _0x474e24=a0_0x2c9cf0;if(_0x3b02a9['body'][_0x474e24(0x296)]=='QA')try{const {invoice:_0x129c29,date:_0x55c101,warehouse_name:_0x16590d,product_name:_0x381b6d,primary_code:_0x115b27,secondary_code:_0xee4ca9,product_code:_0x520664,sales_quantity:_0x53b4a3,stocks:_0x1d99c9,return_qty:_0x2fbc17,Room_name:_0xd3f819,to_warehouse_name_QA:_0x495192,to_Room_name_QA:_0x2d43b8,note:_0x28178b,for_categorize:_0x2a9bf9,product_name_QA1:_0x2b1cc1}=_0x3b02a9[_0x474e24(0x210)];if(typeof _0x2b1cc1==_0x474e24(0x1f6))var _0x26d338=[_0x3b02a9['body']['product_name_QA1']],_0xc777b2=[_0x3b02a9['body'][_0x474e24(0x295)]],_0xd4aa73=[_0x3b02a9[_0x474e24(0x210)]['secondary_code_QA']],_0x5ca8ce=[_0x3b02a9['body']['product_code_QA']],_0x1af7c8=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x298)]],_0x3e5f56=[_0x3b02a9[_0x474e24(0x210)]['stocks_QA']],_0x312302=[_0x3b02a9[_0x474e24(0x210)]['return_qty_QA']],_0x5159cf=[_0x3b02a9[_0x474e24(0x210)]['maxPerUnit_QA']],_0x575b48=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2d7)]],_0x518425=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x204)]],_0x170ced=[_0x3b02a9[_0x474e24(0x210)]['secondary_unit_QA']],_0xa836f5=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2b5)]],_0x28be64=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x22a)]],_0x16cca6=[_0x3b02a9[_0x474e24(0x210)]['expiry_date_QA']];else var _0x26d338=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x274)]],_0xc777b2=[..._0x3b02a9[_0x474e24(0x210)]['primary_code_QA']],_0xd4aa73=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x1ed)]],_0x5ca8ce=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x234)]],_0x1af7c8=[..._0x3b02a9['body'][_0x474e24(0x298)]],_0x3e5f56=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2b8)]],_0x312302=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x1e5)]],_0x5159cf=[..._0x3b02a9['body'][_0x474e24(0x2ce)]],_0x575b48=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2d7)]],_0x518425=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x204)]],_0x170ced=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2c1)]],_0xa836f5=[..._0x3b02a9['body']['unit_QA']],_0x28be64=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x22a)]],_0x16cca6=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x20e)]];const _0x41b74a=_0x26d338['map'](_0x298e56=>{return _0x298e56={'product_name':_0x298e56};});_0xc777b2[_0x474e24(0x1f7)]((_0x3c60ee,_0x507583)=>{var _0xbc2cf8=_0x474e24;_0x41b74a[_0x507583][_0xbc2cf8(0x227)]=_0x3c60ee;}),_0xd4aa73[_0x474e24(0x1f7)]((_0x4860b0,_0x1983d9)=>{var _0x487203=_0x474e24;_0x41b74a[_0x1983d9][_0x487203(0x266)]=_0x4860b0;}),_0x5ca8ce['forEach']((_0x173d5d,_0x1e0347)=>{_0x41b74a[_0x1e0347]['product_code']=_0x173d5d;}),_0x1af7c8[_0x474e24(0x1f7)]((_0x244351,_0x59a5df)=>{_0x41b74a[_0x59a5df]['sale_qty']=_0x244351;}),_0x3e5f56[_0x474e24(0x1f7)]((_0x3a6138,_0x50f3f9)=>{var _0x468043=_0x474e24;_0x41b74a[_0x50f3f9][_0x468043(0x26c)]=_0x3a6138;}),_0x312302[_0x474e24(0x1f7)]((_0x3e257b,_0xdd5b4c)=>{var _0x41fd6f=_0x474e24;_0x41b74a[_0xdd5b4c][_0x41fd6f(0x2b4)]=_0x3e257b;}),_0x5159cf['forEach']((_0x1dfdec,_0x5c2003)=>{var _0x49ffc6=_0x474e24;_0x41b74a[_0x5c2003][_0x49ffc6(0x1ca)]=_0x1dfdec;}),_0x575b48[_0x474e24(0x1f7)]((_0x6cc395,_0x32ec98)=>{var _0x2e47b5=_0x474e24;_0x41b74a[_0x32ec98][_0x2e47b5(0x243)]=_0x6cc395;}),_0x518425['forEach']((_0x4828ee,_0x173e08)=>{var _0x138632=_0x474e24;_0x41b74a[_0x173e08][_0x138632(0x23f)]=_0x4828ee;}),_0x170ced[_0x474e24(0x1f7)]((_0x283648,_0x3b9150)=>{var _0x53632a=_0x474e24;_0x41b74a[_0x3b9150][_0x53632a(0x1c5)]=_0x283648;}),_0xa836f5['forEach']((_0x41d341,_0x5be91f)=>{var _0x1eb527=_0x474e24;_0x41b74a[_0x5be91f][_0x1eb527(0x220)]=_0x41d341;}),_0x28be64[_0x474e24(0x1f7)]((_0x3f0f71,_0x2c5a0c)=>{var _0x51595f=_0x474e24;_0x41b74a[_0x2c5a0c][_0x51595f(0x277)]=_0x3f0f71;}),_0x16cca6[_0x474e24(0x1f7)]((_0x4a56b9,_0x37b2f2)=>{var _0x4458dd=_0x474e24;_0x41b74a[_0x37b2f2][_0x4458dd(0x1d8)]=_0x4a56b9;});const _0x3954db=await sales_finished[_0x474e24(0x2cf)]({'invoice':_0x129c29});_0x3954db[_0x474e24(0x24c)]=_0x474e24(0x2b0);const _0x5f3641=await _0x3954db[_0x474e24(0x229)](),_0x12fdfd=new sales_return_finished({'invoice':_0x129c29,'customer':_0x3b02a9['body'][_0x474e24(0x2c4)],'date':_0x55c101,'warehouse_name':_0x16590d,'room':_0xd3f819,'ToWarehouse':_0x495192,'ToRoom':_0x2d43b8,'return_sale_QA':_0x41b74a,'note':_0x28178b,'warehouse_cat':_0x2a9bf9}),_0x3bb38a=await _0x12fdfd[_0x474e24(0x229)](),_0x11c1d3=await sales_return_finished['findOne']({'invoice':_0x129c29}),_0xdbe8e0=await warehouse[_0x474e24(0x2cf)]({'name':_0x495192,'room':_0x2d43b8});_0x11c1d3[_0x474e24(0x26b)]['forEach'](_0x1eb9b2=>{var _0x3e8286=_0x474e24,_0x400eb4=0x0;const _0x480e99=_0xdbe8e0[_0x3e8286(0x2a5)][_0x3e8286(0x1e1)](_0x213ab9=>{var _0x5b69ec=_0x3e8286;_0x213ab9['product_name']==_0x1eb9b2[_0x5b69ec(0x2b1)]&&_0x213ab9['expiry_date']==_0x1eb9b2[_0x5b69ec(0x1d8)]&&_0x213ab9[_0x5b69ec(0x277)]==_0x1eb9b2[_0x5b69ec(0x277)]&&_0x213ab9['batch_code']==_0x1eb9b2[_0x5b69ec(0x23f)]&&(_0x213ab9[_0x5b69ec(0x1fe)]=parseInt(_0x213ab9[_0x5b69ec(0x1fe)])+parseInt(_0x1eb9b2[_0x5b69ec(0x2b4)]),_0x400eb4++);});_0x400eb4=='0'&&(_0xdbe8e0['product_details']=_0xdbe8e0[_0x3e8286(0x2a5)][_0x3e8286(0x269)]({'product_name':_0x1eb9b2[_0x3e8286(0x2b1)],'product_stock':_0x1eb9b2[_0x3e8286(0x2b4)],'primary_code':_0x1eb9b2['primary_code'],'secondary_code':_0x1eb9b2[_0x3e8286(0x266)],'product_code':_0x1eb9b2[_0x3e8286(0x282)],'batch_code':_0x1eb9b2['batch_code'],'maxPerUnit':_0x1eb9b2[_0x3e8286(0x1ca)],'production_date':_0x1eb9b2[_0x3e8286(0x277)],'expiry_date':_0x1eb9b2[_0x3e8286(0x1d8)],'secondary_unit':_0x1eb9b2[_0x3e8286(0x1c5)],'unit':_0x1eb9b2[_0x3e8286(0x220)],'maxProducts':_0x1eb9b2[_0x3e8286(0x243)],'bay':_0x1eb9b2[_0x3e8286(0x205)]}));}),await _0xdbe8e0['save']();const _0x26d234=new c_payment_data({'invoice':_0x129c29,'customer':_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2c4)],'reason':_0x474e24(0x1e6)});await _0x26d234['save']();const _0xb60f11=await master_shop['find'](),_0x515695=await email_settings['findOne'](),_0xbe5764=await customer[_0x474e24(0x2cf)]({'name':_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2c4)]});_0xb60f11[0x0][_0x474e24(0x2a8)]==0x1?(right_currency=_0xb60f11[0x0][_0x474e24(0x1e2)],left_currency=''):(right_currency='',left_currency=_0xb60f11[0x0]['currency']);var _0x3d1cc3=_0x26d338,_0x302d2c=_0x312302,_0x3697b0='',_0x2b846e;for(_0x2b846e in _0x3d1cc3){_0x3697b0+=_0x474e24(0x2c9)+_0x474e24(0x29b)+_0x3d1cc3[_0x2b846e]+_0x474e24(0x21a)+_0x474e24(0x29b)+_0x302d2c[_0x2b846e]+_0x474e24(0x21a)+_0x474e24(0x218);}console[_0x474e24(0x2aa)]('product_list',_0x3697b0);let _0x577899=nodemailer[_0x474e24(0x214)]({'service':_0x474e24(0x2c0),'auth':{'user':_0x515695[_0x474e24(0x1df)],'pass':_0x515695[_0x474e24(0x1f5)]}}),_0x395ed1={'from':_0x515695[_0x474e24(0x1df)],'to':_0xbe5764[_0x474e24(0x1df)],'subject':_0x474e24(0x2db),'attachments':[{'filename':_0x474e24(0x1d6),'path':__dirname+_0x474e24(0x2d5)+'/upload/'+_0xb60f11[0x0]['image'],'cid':_0x474e24(0x255)}],'html':'<!DOCTYPE\x20html>'+_0x474e24(0x28b)+_0x474e24(0x1ef)+'<div>'+_0x474e24(0x271)+'<div>'+_0x474e24(0x251)+'</div>'+_0x474e24(0x20f)+_0x474e24(0x2c6)+_0xb60f11[0x0][_0x474e24(0x1fa)]+'\x20</h2>'+_0x474e24(0x2ab)+_0x474e24(0x2ab)+_0x474e24(0x1c4)+_0x474e24(0x20f)+_0x474e24(0x293)+'\x20Order\x20Number\x20:\x20'+_0x129c29+'\x20'+_0x474e24(0x2b2)+_0x474e24(0x24e)+_0x55c101+'\x20'+_0x474e24(0x23e)+'</h5>'+_0x474e24(0x2ab)+_0x474e24(0x22f)+_0x474e24(0x280)+_0x474e24(0x2c9)+_0x474e24(0x202)+_0x474e24(0x29d)+_0x474e24(0x2cb)+_0x474e24(0x1dc)+_0x474e24(0x218)+'</thead>'+_0x474e24(0x2d0)+'\x20'+_0x3697b0+'\x20'+_0x474e24(0x264)+'</table>'+_0x474e24(0x20f)+_0x474e24(0x276)+'<h5>'+_0xb60f11[0x0][_0x474e24(0x1fa)]+'</h5>'+_0x474e24(0x2ab)+_0x474e24(0x2ab)+'</body></html>'};_0x577899[_0x474e24(0x2a7)](_0x395ed1,function(_0x131d22,_0x2d27c2){var _0x44ee52=_0x474e24;_0x131d22?(console[_0x44ee52(0x2aa)](_0x131d22),console[_0x44ee52(0x2aa)]('Error\x20Occurs')):console[_0x44ee52(0x2aa)](_0x44ee52(0x26f));}),_0x3b02a9[_0x474e24(0x21b)](_0x474e24(0x2c8),_0x474e24(0x23b)),_0x508fe1[_0x474e24(0x247)](_0x474e24(0x262));}catch(_0x43f65d){_0x508fe1['status'](0xc8)[_0x474e24(0x1d1)]({'message1':_0x43f65d[_0x474e24(0x1ea)]});}else{if(_0x3b02a9[_0x474e24(0x210)]['for_categorize']=='GS')try{const {invoice:_0x12d9b1,date:_0x44a32d,warehouse_name:_0x5a150f,product_name:_0x25f876,primary_code:_0x4a5ceb,secondary_code:_0x74f128,product_code:_0x2e0de5,sales_quantity:_0x5a676c,stocks:_0x1a554f,return_qty:_0x59051e,Room_name:_0xb0ad1e,to_warehouse_name:_0x2d6438,to_Room_name:_0x323faf,note:_0x4dbb5b,level:_0x8ea1fc,isle:_0x305375,pallet:_0x473844,for_categorize:_0x4b3110}=_0x3b02a9['body'];if(typeof _0x25f876=='string')var _0x26d338=[_0x3b02a9['body'][_0x474e24(0x2b1)]],_0xc777b2=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x227)]],_0xd4aa73=[_0x3b02a9[_0x474e24(0x210)]['secondary_code']],_0x5ca8ce=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x282)]],_0x1af7c8=[_0x3b02a9['body'][_0x474e24(0x28c)]],_0x312302=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2b4)]],_0x10aa81=[_0x3b02a9['body'][_0x474e24(0x205)]],_0x5159cf=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x1ca)]],_0x575b48=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x243)]],_0x518425=[_0x3b02a9[_0x474e24(0x210)]['batch_code']],_0x170ced=[_0x3b02a9['body'][_0x474e24(0x1c5)]],_0xa836f5=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x220)]],_0x28be64=[_0x3b02a9[_0x474e24(0x210)]['production_date']],_0x16cca6=[_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x1d8)]];else var _0x26d338=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2b1)]],_0xc777b2=[..._0x3b02a9['body'][_0x474e24(0x227)]],_0xd4aa73=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x266)]],_0x5ca8ce=[..._0x3b02a9['body'][_0x474e24(0x282)]],_0x1af7c8=[..._0x3b02a9[_0x474e24(0x210)]['sales_quantity']],_0x312302=[..._0x3b02a9['body'][_0x474e24(0x2b4)]],_0x10aa81=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x205)]],_0x5159cf=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x1ca)]],_0x575b48=[..._0x3b02a9[_0x474e24(0x210)]['maxProducts']],_0x518425=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x23f)]],_0x170ced=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x1c5)]],_0xa836f5=[..._0x3b02a9['body'][_0x474e24(0x220)]],_0x28be64=[..._0x3b02a9[_0x474e24(0x210)][_0x474e24(0x277)]],_0x16cca6=[..._0x3b02a9['body']['expiry_date']];const _0x201d5f=_0x26d338['map'](_0x38e22b=>{return _0x38e22b={'product_name':_0x38e22b};});_0xc777b2['forEach']((_0x151d76,_0x11e517)=>{var _0x3777b2=_0x474e24;_0x201d5f[_0x11e517][_0x3777b2(0x227)]=_0x151d76;}),_0xd4aa73[_0x474e24(0x1f7)]((_0x11b694,_0x103db4)=>{var _0x545f3d=_0x474e24;_0x201d5f[_0x103db4][_0x545f3d(0x266)]=_0x11b694;}),_0x5ca8ce['forEach']((_0x35e759,_0x4e0eec)=>{var _0x2c119b=_0x474e24;_0x201d5f[_0x4e0eec][_0x2c119b(0x282)]=_0x35e759;}),_0x1af7c8[_0x474e24(0x1f7)]((_0x425a90,_0x233686)=>{var _0x59b3e5=_0x474e24;_0x201d5f[_0x233686][_0x59b3e5(0x249)]=_0x425a90;}),_0x312302[_0x474e24(0x1f7)]((_0x471f4d,_0x320a0a)=>{var _0x2dd80a=_0x474e24;_0x201d5f[_0x320a0a][_0x2dd80a(0x2b4)]=_0x471f4d;}),_0x10aa81[_0x474e24(0x1f7)]((_0x1f5964,_0x193e32)=>{_0x201d5f[_0x193e32]['bay']=_0x1f5964;}),_0x5159cf[_0x474e24(0x1f7)]((_0x261041,_0x12c0ea)=>{_0x201d5f[_0x12c0ea]['maxPerUnit']=_0x261041;}),_0x575b48['forEach']((_0x570290,_0x33969b)=>{var _0x181d41=_0x474e24;_0x201d5f[_0x33969b][_0x181d41(0x243)]=_0x570290;}),_0x518425[_0x474e24(0x1f7)]((_0x1b943f,_0x193337)=>{_0x201d5f[_0x193337]['batch_code']=_0x1b943f;}),_0x170ced[_0x474e24(0x1f7)]((_0x37d461,_0x54d335)=>{var _0x3ec158=_0x474e24;_0x201d5f[_0x54d335][_0x3ec158(0x1c5)]=_0x37d461;}),_0xa836f5[_0x474e24(0x1f7)]((_0x129095,_0x5714dd)=>{_0x201d5f[_0x5714dd]['unit']=_0x129095;}),_0x28be64['forEach']((_0x4f1131,_0x3e0fab)=>{var _0x577edc=_0x474e24;_0x201d5f[_0x3e0fab][_0x577edc(0x277)]=_0x4f1131;}),_0x16cca6[_0x474e24(0x1f7)]((_0x16f3b0,_0x443640)=>{var _0xb56ef8=_0x474e24;_0x201d5f[_0x443640][_0xb56ef8(0x1d8)]=_0x16f3b0;});var _0x413ac3=0x0;_0x201d5f[_0x474e24(0x1f7)](_0x3c6b28=>{var _0x31f09d=_0x474e24;(parseInt(_0x3c6b28[_0x31f09d(0x249)])<parseInt(_0x3c6b28['return_qty'])||parseInt(_0x3c6b28[_0x31f09d(0x26c)])<parseInt(_0x3c6b28['return_qty'])&&parseInt(_0x3c6b28[_0x31f09d(0x249)])>parseInt(_0x3c6b28[_0x31f09d(0x2b4)])||parseInt(_0x3c6b28[_0x31f09d(0x2b4)])==0x0)&&_0x413ac3++;});if(_0x413ac3!=0x0)return _0x3b02a9[_0x474e24(0x21b)](_0x474e24(0x1f9),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x508fe1[_0x474e24(0x247)]('back');const _0x81bdd3=await sales_finished['findOne']({'invoice':_0x12d9b1});_0x81bdd3[_0x474e24(0x24c)]='True';const _0xebd62a=await _0x81bdd3[_0x474e24(0x229)](),_0xe2649b=new sales_return_finished({'invoice':_0x12d9b1,'customer':_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2c4)],'date':_0x44a32d,'warehouse_name':_0x5a150f,'room':_0xb0ad1e,'ToWarehouse':_0x2d6438,'ToRoom':_0x323faf,'return_sale':_0x201d5f,'note':_0x4dbb5b,'warehouse_cat':_0x4b3110}),_0x7f8fb2=await _0xe2649b[_0x474e24(0x229)](),_0x3e999f=await sales_return_finished[_0x474e24(0x2cf)]({'invoice':_0x12d9b1}),_0x85ced3=await warehouse['findOne']({'name':_0x2d6438,'room':_0x323faf,'warehouse_category':'Finished\x20Goods'});_0x3e999f[_0x474e24(0x1d7)]['forEach'](_0x5a290d=>{var _0x2ce4a0=_0x474e24,_0x1c9058=0x0;const _0x17991c=_0x85ced3['product_details'][_0x2ce4a0(0x1e1)](_0x186d74=>{var _0x5edb42=_0x2ce4a0;_0x186d74['product_name']==_0x5a290d[_0x5edb42(0x2b1)]&&_0x186d74[_0x5edb42(0x205)]==_0x5a290d['bay']&&_0x186d74[_0x5edb42(0x1d8)]==_0x5a290d[_0x5edb42(0x1d8)]&&_0x186d74[_0x5edb42(0x277)]==_0x5a290d['production_date']&&_0x186d74[_0x5edb42(0x23f)]==_0x5a290d[_0x5edb42(0x23f)]&&(_0x186d74[_0x5edb42(0x1fe)]=parseInt(_0x186d74[_0x5edb42(0x1fe)])+parseInt(_0x5a290d[_0x5edb42(0x2b4)]),_0x1c9058++);});_0x1c9058=='0'&&(_0x85ced3[_0x2ce4a0(0x2a5)]=_0x85ced3['product_details'][_0x2ce4a0(0x269)]({'product_name':_0x5a290d['product_name'],'product_stock':_0x5a290d[_0x2ce4a0(0x2b4)],'primary_code':_0x5a290d[_0x2ce4a0(0x227)],'secondary_code':_0x5a290d[_0x2ce4a0(0x266)],'product_code':_0x5a290d[_0x2ce4a0(0x282)],'bay':_0x5a290d[_0x2ce4a0(0x205)],'batch_code':_0x5a290d[_0x2ce4a0(0x23f)],'maxPerUnit':_0x5a290d[_0x2ce4a0(0x1ca)],'production_date':_0x5a290d[_0x2ce4a0(0x277)],'expiry_date':_0x5a290d[_0x2ce4a0(0x1d8)],'secondary_unit':_0x5a290d[_0x2ce4a0(0x1c5)],'unit':_0x5a290d[_0x2ce4a0(0x220)],'maxProducts':_0x5a290d[_0x2ce4a0(0x243)]}));}),await _0x85ced3['save'](),console[_0x474e24(0x2aa)](_0x3b02a9[_0x474e24(0x210)]);const _0x33f567=new c_payment_data({'invoice':_0x12d9b1,'customer':_0x3b02a9[_0x474e24(0x210)][_0x474e24(0x2c4)],'reason':_0x474e24(0x1e6)});await _0x33f567[_0x474e24(0x229)]();const _0x30696f=await master_shop[_0x474e24(0x2b7)]();console['log'](_0x474e24(0x1c2),_0x30696f[0x0][_0x474e24(0x25b)]);const _0x1a960e=await email_settings['findOne'](),_0x15e8ba=await customer[_0x474e24(0x2cf)]({'name':_0x3b02a9['body'][_0x474e24(0x2c4)]});console[_0x474e24(0x2aa)](_0x474e24(0x1c3),_0x15e8ba);_0x30696f[0x0][_0x474e24(0x2a8)]==0x1?(right_currency=_0x30696f[0x0][_0x474e24(0x1e2)],left_currency=''):(right_currency='',left_currency=_0x30696f[0x0]['currency']);var _0x3d1cc3=_0x26d338,_0x302d2c=_0x312302,_0x3697b0='',_0x2b846e;for(_0x2b846e in _0x3d1cc3){_0x3697b0+=_0x474e24(0x2c9)+_0x474e24(0x29b)+_0x3d1cc3[_0x2b846e]+_0x474e24(0x21a)+_0x474e24(0x29b)+_0x302d2c[_0x2b846e]+_0x474e24(0x21a)+_0x474e24(0x218);}console[_0x474e24(0x2aa)](_0x474e24(0x257),_0x3697b0);let _0x384f1e=nodemailer[_0x474e24(0x214)]({'service':_0x474e24(0x2c0),'auth':{'user':_0x1a960e['email'],'pass':_0x1a960e['password']}}),_0x340d7b={'from':_0x1a960e[_0x474e24(0x1df)],'to':_0x15e8ba[_0x474e24(0x1df)],'subject':_0x474e24(0x2db),'attachments':[{'filename':_0x474e24(0x1d6),'path':__dirname+_0x474e24(0x2d5)+_0x474e24(0x1c1)+_0x30696f[0x0][_0x474e24(0x25b)],'cid':'logo'}],'html':_0x474e24(0x211)+'<html><head><title></title>'+'</head><body>'+'<div>'+_0x474e24(0x271)+_0x474e24(0x20f)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x474e24(0x20f)+_0x474e24(0x2c6)+_0x30696f[0x0][_0x474e24(0x1fa)]+_0x474e24(0x217)+_0x474e24(0x2ab)+_0x474e24(0x2ab)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x474e24(0x293)+'\x20Order\x20Number\x20:\x20'+_0x12d9b1+'\x20'+_0x474e24(0x2b2)+_0x474e24(0x24e)+_0x44a32d+'\x20'+_0x474e24(0x23e)+_0x474e24(0x226)+'</div>'+_0x474e24(0x22f)+_0x474e24(0x280)+_0x474e24(0x2c9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x474e24(0x29d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x474e24(0x265)+_0x474e24(0x2d0)+'\x20'+_0x3697b0+'\x20'+_0x474e24(0x264)+_0x474e24(0x22c)+_0x474e24(0x20f)+_0x474e24(0x276)+'<h5>'+_0x30696f[0x0][_0x474e24(0x1fa)]+_0x474e24(0x226)+_0x474e24(0x2ab)+_0x474e24(0x2ab)+'</body></html>'};_0x384f1e[_0x474e24(0x2a7)](_0x340d7b,function(_0x425145,_0x4e17f0){var _0x4b5253=_0x474e24;_0x425145?(console[_0x4b5253(0x2aa)](_0x425145),console[_0x4b5253(0x2aa)]('Error\x20Occurs')):console[_0x4b5253(0x2aa)](_0x4b5253(0x26f));}),_0x3b02a9['flash'](_0x474e24(0x2c8),'sales\x20item\x20return\x20successfull'),_0x508fe1[_0x474e24(0x247)](_0x474e24(0x262));}catch(_0x4c4464){console[_0x474e24(0x2aa)](_0x4c4464),_0x508fe1[_0x474e24(0x2a3)](0xc8)[_0x474e24(0x1d1)]({'message1':_0x4c4464[_0x474e24(0x1ea)]});}}}),router[a0_0x2c9cf0(0x28d)]('/barcode/:id',auth,async(_0xa10163,_0x1f3371)=>{var _0x5c9d3c=a0_0x2c9cf0;try{const {username:_0x1c801f,email:_0x415d88,role:_0x218090}=_0xa10163[_0x5c9d3c(0x270)],_0x6e8be2=_0xa10163[_0x5c9d3c(0x270)],_0xaf83de=await profile[_0x5c9d3c(0x2cf)]({'email':_0x6e8be2[_0x5c9d3c(0x1df)]}),_0x7d2c76=await master_shop[_0x5c9d3c(0x2b7)]();console['log'](_0x5c9d3c(0x1fb),_0x7d2c76);const _0x5f8b2a=_0xa10163[_0x5c9d3c(0x231)]['id'],_0x4dd5ec=await sales[_0x5c9d3c(0x1f0)](_0x5f8b2a);console['log'](_0x5c9d3c(0x254),_0x4dd5ec);if(_0x7d2c76[0x0][_0x5c9d3c(0x237)]==_0x5c9d3c(0x1d0))var _0x2f80e5=users[_0x5c9d3c(0x29a)];else{if(_0x7d2c76[0x0][_0x5c9d3c(0x237)]==_0x5c9d3c(0x239))var _0x2f80e5=users[_0x5c9d3c(0x239)];else{if(_0x7d2c76[0x0]['language']==_0x5c9d3c(0x2d8))var _0x2f80e5=users['German'];else{if(_0x7d2c76[0x0][_0x5c9d3c(0x237)]==_0x5c9d3c(0x27d))var _0x2f80e5=users[_0x5c9d3c(0x27d)];else{if(_0x7d2c76[0x0]['language']==_0x5c9d3c(0x244))var _0x2f80e5=users[_0x5c9d3c(0x244)];else{if(_0x7d2c76[0x0][_0x5c9d3c(0x237)]==_0x5c9d3c(0x206))var _0x2f80e5=users[_0x5c9d3c(0x1eb)];else{if(_0x7d2c76[0x0][_0x5c9d3c(0x237)]=='Chinese')var _0x2f80e5=users[_0x5c9d3c(0x299)];else{if(_0x7d2c76[0x0][_0x5c9d3c(0x237)]==_0x5c9d3c(0x20a))var _0x2f80e5=users[_0x5c9d3c(0x2a6)];}}}}}}}_0x1f3371[_0x5c9d3c(0x223)]('all_sales_barcode',{'success':_0xa10163[_0x5c9d3c(0x21b)]('success'),'errors':_0xa10163[_0x5c9d3c(0x21b)](_0x5c9d3c(0x1f9)),'role':_0x6e8be2,'profile':_0xaf83de,'alldata':_0x4dd5ec,'master_shop':_0x7d2c76,'language':_0x2f80e5});}catch(_0x18b93f){console[_0x5c9d3c(0x2aa)](_0x18b93f);}}),router['post'](a0_0x2c9cf0(0x248),async(_0x2a0a81,_0x46a3d2)=>{var _0x228ab2=a0_0x2c9cf0;const {product_code:_0x1fbb37,warehouse_name:_0x37974d,rooms_data:_0x5f48b2,Roomslist:_0x5ea95d}=_0x2a0a81[_0x228ab2(0x210)],_0x30eb8b=_0x5ea95d[_0x228ab2(0x1f2)](','),_0x574186=[];async function _0x3be8cf(_0x3f382c){var _0x21d587=_0x228ab2;const _0x16dcc9=await warehouse[_0x21d587(0x1ff)]([{'$match':{'name':_0x37974d,'room':_0x3f382c}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1fbb37}},{'$group':{'_id':_0x21d587(0x28f),'name':{'$first':_0x21d587(0x2cd)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x21d587(0x27b)},'secondary_code':{'$first':_0x21d587(0x2a9)},'product_code':{'$first':_0x21d587(0x200)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x21d587(0x267)},'unit':{'$first':_0x21d587(0x1c9)},'secondary_unit':{'$first':_0x21d587(0x27c)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x21d587(0x256)},'expiry_date':{'$first':_0x21d587(0x236)},'production_date':{'$first':_0x21d587(0x273)},'maxPerUnit':{'$first':_0x21d587(0x25a)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x21d587(0x23d)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x21d587(0x228)}}}]),_0x235cc8=await warehouse[_0x21d587(0x1ff)]([{'$match':{'name':_0x37974d,'room':_0x3f382c}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x1fbb37}},{'$group':{'_id':_0x21d587(0x28f),'name':{'$first':_0x21d587(0x2cd)},'product_stock':{'$first':_0x21d587(0x28a)},'primary_code':{'$first':_0x21d587(0x27b)},'secondary_code':{'$first':_0x21d587(0x2a9)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x21d587(0x25e)},'isle':{'$first':_0x21d587(0x2b3)},'type':{'$first':_0x21d587(0x219)},'pallet':{'$first':_0x21d587(0x267)},'unit':{'$first':_0x21d587(0x1c9)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x21d587(0x256)},'expiry_date':{'$first':_0x21d587(0x236)},'production_date':{'$first':_0x21d587(0x273)},'maxPerUnit':{'$first':_0x21d587(0x25a)},'batch_code':{'$first':_0x21d587(0x1d2)},'product_cat':{'$first':_0x21d587(0x23d)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x21d587(0x2ad)},'invoice':{'$first':_0x21d587(0x228)}}}]);if(_0x16dcc9[_0x21d587(0x1d4)]>0x0)_0x574186['push'](_0x16dcc9);else _0x235cc8[_0x21d587(0x1d4)]>0x0&&_0x574186[_0x21d587(0x24a)](_0x235cc8);}const _0x45b512=_0x30eb8b[_0x228ab2(0x1e1)](_0x2a4687=>_0x3be8cf(_0x2a4687));await Promise[_0x228ab2(0x2dc)](_0x45b512),_0x46a3d2[_0x228ab2(0x1d1)](_0x574186);}),module['exports']=router;