var a0_0x3a8b9d=a0_0x3bdb;function a0_0x14c9(){var _0x35cab2=['currency_placement','product_list','level','6688206nzRFwu','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.expiry_date','id_transaction_from','sales_invoice','Hindi','nodemailer','OUTF-','</span>','<tr>','French','amount','findById','<tbody\x20style=\x22text-align:\x20center;\x22>','</td>','$product_details.rack','save','/picking_list/pdf/','</h5>','aggregate','foreach\x20newproduct','sales_quantity','An\x20error\x20occurred\x20while\x20saving\x20data.','site_title','warehouse_name','edit_sales_finished','$sale_product.bay','json','Enclosed','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','prod_cat','<h5\x20style=\x22text-align:\x20left;\x22>','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Logo.png','$product_details.batch_code','batch_code_QA','$customer','Sale','warehouse','getFullYear','barcode\x20Product\x20master','Sales\x20Add\x20successfully','<div>','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','maxPerUnit','<span\x20style=\x22float:\x20right;\x22>','purchases_data','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product.product_name','redirect','return_sale_finished','<!DOCTYPE\x20html>','return_sale','RoomAssigned','maxProducts','error','/all_sales/view','../models/all_models','password','\x20>>>\x20','gmail','2222904sdkOZs','bay','stock_data','prod_invoice','host','/give_payment/:id','flash','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','English','abs','/view/return_sales/:id','Arabic\x20(ae)','expiry_date','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.storage','filter','1588538tVTcfJ','for_categorize','return_sale_QA','<h2>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/view/add_sales','get','product_name','secondary_unit_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$name','Chinese','Arabic','$warehouse_name','$product_details.primary_code','errors','</tbody>','final','$room','/view','False','payment\x20successfull','floor','maxProducts_QA','35qQIwYX','$product_details.maxProducts','\x20==\x20','string','invoice','primary_code_QA','customers','map','product_code','language','name','status','add\x20post','\x20Order\x20Number\x20:\x20','createTransport','$sale_product.bin','$product_details.secondary_unit','expiry_date_QA','\x20&&\x20','body','$product_details.maxPerUnit','$finalize','exports','Sale\x20Return','getMonth','Enabled','customer','German','message','$date','$product_details.product_stock','logo','secondary_code_QA','add_sales_finished','batch_code','148035uKXloZ','$_id','customer_data','params','success','sendMail','catch','ADD\x20SALE','received_amount','/../public','</body></html>','6437920wIYCDM','Ambient','Return\x20Goods','secondary_unit','product_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','date','Finished\x20Goods','Portuguese\x20(BR)','sale_product','\x20</h2>','../public/language/languages.json','maxPerUnit_QA','\x20<>\x20','suppliers','slice','$product','concat','primary_unit','return_qty','secondary_code','/view/add_sale/product','product_code_QA','QA\x20Warehouse','all','post','adjust_qty','max_per_unit','$product_details.production_date','customers_docs','Quality\x20Inspection','$product_details.type','note','$sale_product.type','$sale_product','$invoice','toString','find','getDate','express','role','Error\x20Occurs','prod_code','quantity','Add\x20Sales','sales_quantity_QA','$product_details.product_cat','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','image','Router','carton','</div>','user','$customers_docs','production_date','room','$product_details.unit','English\x20(US)','return_qty_QA','</table>','$product_details.floorlevel','\x20Order\x20Date\x20:\x20','</thead>','push','Sale\x20Return\x20Mail','product_name_QA1','primary_code','$product_details.room_name','<strong>\x20Regards\x20</strong>','$return_data','34209243oWhzmJ','$sale_product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','stock','$product_details.product_name','$product_details','port','all_sales_finished','findOne','padStart','56xATAul','Spanish','unit_QA','currency','3138080UZAkvu','<h5>','/view/:id','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/all_sales_finished/preview/','random','/upload/','/all_sales_finished/view','then','production_date_QA','$product_details.product_code','Portuguese','_id','$product_details.bin','../middleware/auth','$sale_product.quantity','length','unit','stocks_QA','Sales\x20Update\x20successfully','$product_details._id','FGSEmail','product_date','room_name','<html><head><title></title>','/preview/:id','product_stock','Email\x20sent\x20successfully','<table\x20style=\x22width:\x20100%\x20!important;\x22>','sale_qty','sales\x20item\x20return\x20successfull','$product_details.bay','render','$note','product_details','staff','True','</head><body>','log','return_data','</tr>'];a0_0x14c9=function(){return _0x35cab2;};return a0_0x14c9();}(function(_0x15105d,_0x369d48){var _0x5bcbbd=a0_0x3bdb,_0x116398=_0x15105d();while(!![]){try{var _0x488ba8=parseInt(_0x5bcbbd(0x174))/0x1+-parseInt(_0x5bcbbd(0xf3))/0x2*(parseInt(_0x5bcbbd(0x1b0))/0x3)+parseInt(_0x5bcbbd(0xf7))/0x4+parseInt(_0x5bcbbd(0x1bb))/0x5+parseInt(_0x5bcbbd(0x124))/0x6+-parseInt(_0x5bcbbd(0x18d))/0x7*(-parseInt(_0x5bcbbd(0x164))/0x8)+-parseInt(_0x5bcbbd(0xe9))/0x9;if(_0x488ba8===_0x369d48)break;else _0x116398['push'](_0x116398['shift']());}catch(_0x27f2a7){_0x116398['push'](_0x116398['shift']());}}}(a0_0x14c9,0xefbd3));const express=require(a0_0x3a8b9d(0xc9)),app=express(),router=express[a0_0x3a8b9d(0xd4)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x3a8b9d(0x160)),auth=require(a0_0x3a8b9d(0x106)),nodemailer=require(a0_0x3a8b9d(0x12a)),users=require(a0_0x3a8b9d(0x1c6));router[a0_0x3a8b9d(0x17a)](a0_0x3a8b9d(0x188),auth,async(_0x4519d8,_0x5cc10c)=>{var _0x2df2cc=a0_0x3a8b9d;try{const {username:_0x239d26,email:_0x3b702f,role:_0x11d439}=_0x4519d8[_0x2df2cc(0xd7)],_0x1fee05=_0x4519d8['user'],_0xf9b4fd=await profile[_0x2df2cc(0xf1)]({'email':_0x1fee05[_0x2df2cc(0xfa)]}),_0xdd79c5=await master_shop[_0x2df2cc(0xc7)]();let _0x245b7;if(_0x1fee05[_0x2df2cc(0xca)]=='staff'){const _0x4b4a80=await staff['findOne']({'email':_0x1fee05['email']});_0x245b7=await sales_finished[_0x2df2cc(0x137)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x2df2cc(0x197),'as':'customers_docs'}},{'$unwind':_0x2df2cc(0xd8)},{'$unwind':_0x2df2cc(0xc4)},{'$group':{'_id':_0x2df2cc(0x1b1),'invoice':{'$first':_0x2df2cc(0xc5)},'customers':{'$first':_0x2df2cc(0x149)},'date':{'$first':_0x2df2cc(0x1aa)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x2df2cc(0x119)},'return_data':{'$first':_0x2df2cc(0xe8)},'customers_docs':{'$first':_0x2df2cc(0xd8)},'total_saleproduct_quantity':{'$sum':_0x2df2cc(0x107)},'level':{'$addToSet':_0x2df2cc(0x13e)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x2df2cc(0x1a2)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x245b7=await sales_finished['aggregate']([{'$lookup':{'from':_0x2df2cc(0x193),'localField':_0x2df2cc(0x1a7),'foreignField':_0x2df2cc(0x197),'as':_0x2df2cc(0xbf)}},{'$unwind':_0x2df2cc(0xd8)},{'$unwind':_0x2df2cc(0xc4)},{'$group':{'_id':_0x2df2cc(0x1b1),'invoice':{'$first':_0x2df2cc(0xc5)},'customers':{'$first':_0x2df2cc(0x149)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2df2cc(0x182)},'sale_product':{'$push':_0x2df2cc(0xc4)},'note':{'$first':_0x2df2cc(0x119)},'return_data':{'$first':_0x2df2cc(0xe8)},'customers_docs':{'$first':_0x2df2cc(0xd8)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x2df2cc(0x13e)},'isle':{'$addToSet':_0x2df2cc(0x19c)},'type':{'$addToSet':_0x2df2cc(0xc3)},'pallet':{'$addToSet':_0x2df2cc(0xea)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0xdd79c5[0x0][_0x2df2cc(0x196)]==_0x2df2cc(0xdc)){var _0x5a962e=users[_0x2df2cc(0x16c)];console[_0x2df2cc(0x11e)](_0x5a962e);}else{if(_0xdd79c5[0x0][_0x2df2cc(0x196)]==_0x2df2cc(0x129))var _0x5a962e=users['Hindi'];else{if(_0xdd79c5[0x0][_0x2df2cc(0x196)]==_0x2df2cc(0x1a8))var _0x5a962e=users['German'];else{if(_0xdd79c5[0x0][_0x2df2cc(0x196)]==_0x2df2cc(0xf4))var _0x5a962e=users[_0x2df2cc(0xf4)];else{if(_0xdd79c5[0x0][_0x2df2cc(0x196)]==_0x2df2cc(0x12e))var _0x5a962e=users[_0x2df2cc(0x12e)];else{if(_0xdd79c5[0x0][_0x2df2cc(0x196)]==_0x2df2cc(0x1c3))var _0x5a962e=users[_0x2df2cc(0x103)];else{if(_0xdd79c5[0x0][_0x2df2cc(0x196)]=='Chinese')var _0x5a962e=users['Chinese'];else{if(_0xdd79c5[0x0][_0x2df2cc(0x196)]==_0x2df2cc(0x16f))var _0x5a962e=users[_0x2df2cc(0x181)];}}}}}}}_0x5cc10c[_0x2df2cc(0x118)](_0x2df2cc(0xf0),{'success':_0x4519d8[_0x2df2cc(0x16a)](_0x2df2cc(0x1b4)),'errors':_0x4519d8[_0x2df2cc(0x16a)](_0x2df2cc(0x184)),'sales':_0x245b7,'profile':_0xf9b4fd,'role':_0x1fee05,'master_shop':_0xdd79c5,'language':_0x5a962e});}catch(_0x2c122c){console['log'](_0x2c122c);}});async function getRandom8DigitNumber(){var _0x26d0e2=a0_0x3a8b9d;const _0x504be0=0x989680,_0x406f93=0x5f5e0ff,_0x13046d=Math[_0x26d0e2(0x18b)](Math[_0x26d0e2(0xfd)]()*(_0x406f93-_0x504be0+0x1))+_0x504be0;var _0x550b34;const _0x69dfe9=await sales_finished[_0x26d0e2(0xf1)]({'invoice':_0x26d0e2(0x12b)+_0x13046d});return _0x69dfe9&&_0x69dfe9['length']>0x0?_0x550b34=_0x26d0e2(0x12b)+_0x13046d:_0x550b34='OUTF-'+_0x13046d,_0x550b34;}function a0_0x3bdb(_0x50af7d,_0x2fa725){var _0x14c907=a0_0x14c9();return a0_0x3bdb=function(_0x3bdb5b,_0x4be2b4){_0x3bdb5b=_0x3bdb5b-0xb1;var _0x11e8ad=_0x14c907[_0x3bdb5b];return _0x11e8ad;},a0_0x3bdb(_0x50af7d,_0x2fa725);}router[a0_0x3a8b9d(0x17a)](a0_0x3a8b9d(0x179),auth,async(_0x342aa3,_0x3073b5)=>{var _0x472a56=a0_0x3a8b9d;try{const {username:_0x204dfe,email:_0x4d0cbf,role:_0x1fca2c}=_0x342aa3['user'],_0x1aaa72=_0x342aa3['user'],_0xe91ff0=await profile[_0x472a56(0xf1)]({'email':_0x1aaa72[_0x472a56(0xfa)]}),_0x4987e9=await master_shop['find'](),_0x263685=await customer['find']({});let _0x1e99c5;if(_0x1aaa72[_0x472a56(0xca)]==_0x472a56(0x11b)){const _0x2f4c19=await staff[_0x472a56(0xf1)]({'email':_0x1aaa72[_0x472a56(0xfa)]});_0x1e99c5=await warehouse[_0x472a56(0x137)]([{'$match':{'status':_0x472a56(0x1a6),'name':_0x2f4c19[_0x472a56(0x14b)],'warehouse_category':_0x472a56(0x1c2),'name':{'$ne':_0x472a56(0xb9)}}},{'$group':{'_id':_0x472a56(0x17f),'name':{'$first':_0x472a56(0x17f)}}},{'$sort':{'name':0x1}}]);}else _0x1e99c5=await warehouse['aggregate']([{'$match':{'status':_0x472a56(0x1a6),'warehouse_category':_0x472a56(0x1c2),'name':{'$ne':_0x472a56(0xb9)}}},{'$group':{'_id':'$name','name':{'$first':_0x472a56(0x17f)}}},{'$sort':{'name':0x1}}]);const _0x4bbb75=await product[_0x472a56(0xc7)]({});var _0x191d44=[_0x472a56(0x1bc),_0x472a56(0x140)];const _0x1439a7=await sales_finished['find']({}),_0x289773=_0x1439a7[_0x472a56(0x108)]+0x1,_0x3068bd='OUTF-'+_0x289773[_0x472a56(0xc6)]()[_0x472a56(0xf2)](0x5,'0');if(_0x4987e9[0x0][_0x472a56(0x196)]=='English\x20(US)'){var _0x3ccab6=users[_0x472a56(0x16c)];console[_0x472a56(0x11e)](_0x3ccab6);}else{if(_0x4987e9[0x0]['language']==_0x472a56(0x129))var _0x3ccab6=users['Hindi'];else{if(_0x4987e9[0x0]['language']==_0x472a56(0x1a8))var _0x3ccab6=users[_0x472a56(0x1a8)];else{if(_0x4987e9[0x0][_0x472a56(0x196)]=='Spanish')var _0x3ccab6=users[_0x472a56(0xf4)];else{if(_0x4987e9[0x0][_0x472a56(0x196)]==_0x472a56(0x12e))var _0x3ccab6=users[_0x472a56(0x12e)];else{if(_0x4987e9[0x0][_0x472a56(0x196)]==_0x472a56(0x1c3))var _0x3ccab6=users[_0x472a56(0x103)];else{if(_0x4987e9[0x0][_0x472a56(0x196)]==_0x472a56(0x180))var _0x3ccab6=users[_0x472a56(0x180)];else{if(_0x4987e9[0x0][_0x472a56(0x196)]=='Arabic\x20(ae)')var _0x3ccab6=users[_0x472a56(0x181)];}}}}}}}const _0x570e80=getRandom8DigitNumber();_0x570e80[_0x472a56(0x100)](_0x53aa2a=>{var _0x563663=_0x472a56;_0x3073b5[_0x563663(0x118)](_0x563663(0x1ae),{'success':_0x342aa3[_0x563663(0x16a)](_0x563663(0x1b4)),'errors':_0x342aa3['flash']('errors'),'role':_0x1aaa72,'profile':_0xe91ff0,'customer':_0x263685,'warehouse':_0x1e99c5,'product':_0x4bbb75,'invoice':_0x53aa2a,'master_shop':_0x4987e9,'language':_0x3ccab6,'rooms_data':_0x191d44});})[_0x472a56(0x1b6)](_0x293e6a=>{var _0x3eb95b=_0x472a56;_0x342aa3[_0x3eb95b(0x16a)](_0x3eb95b(0x184),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3073b5[_0x3eb95b(0x158)](_0x3eb95b(0xff));});}catch(_0x4a3538){console[_0x472a56(0x11e)](_0x4a3538);}}),router['get']('/view/add_sales/:id',auth,async(_0x32cbed,_0xa95c37)=>{var _0x21830a=a0_0x3a8b9d;try{const _0x27dd14=_0x32cbed[_0x21830a(0x1b3)]['id'];console[_0x21830a(0x11e)](_0x27dd14);const _0x454d94=await product['find'](),_0x27a747=await purchases[_0x21830a(0x137)]([{'$match':{'warehouse_name':_0x27dd14}},{'$unwind':_0x21830a(0xb2)},{'$group':{'_id':_0x21830a(0x157)}}]);console['log'](_0x21830a(0x155),_0x27a747),_0xa95c37[_0x21830a(0x198)](0xc8)[_0x21830a(0x13f)]({'purchases_data':_0x27a747,'product_data':_0x454d94});}catch(_0x1b0224){console[_0x21830a(0x11e)](_0x1b0224);}}),router[a0_0x3a8b9d(0xbb)](a0_0x3a8b9d(0xb7),auth,async(_0x2a01ea,_0x4813a5)=>{var _0x479d03=a0_0x3a8b9d;try{const {warehouse_data:_0x5ee602,product_data:_0x2fcedc}=_0x2a01ea[_0x479d03(0x1a0)];console[_0x479d03(0x11e)](_0x2a01ea[_0x479d03(0x1a0)][_0x479d03(0x1bf)]);;const _0x463e77=await master_shop[_0x479d03(0xc7)]();console[_0x479d03(0x11e)]('master',_0x463e77);const _0x4ad524=await product[_0x479d03(0xf1)]({'name':_0x2fcedc});console['log']('product',_0x4ad524);const _0x1b32fa=await warehouse[_0x479d03(0x137)]([{'$match':{'name':_0x5ee602}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x2fcedc}},{'$group':{'_id':_0x479d03(0xed),'product_stock':{'$first':'$product_details.product_stock'}}}]);console['log'](_0x479d03(0x166),_0x1b32fa),_0x4813a5['status'](0xc8)['json']({'master':_0x463e77,'new_product':_0x4ad524,'stock_data':_0x1b32fa});}catch(_0xcc97b9){console[_0x479d03(0x11e)](_0xcc97b9);}}),router[a0_0x3a8b9d(0xbb)]('/view/add_sales',auth,async(_0x586c9e,_0x33f4fe)=>{var _0x43f6a9=a0_0x3a8b9d;try{const {invoice:_0x4ef048,date:_0x2a2296,warehouse_name:_0x571348,product_name:_0x4f997d,stock:_0x5f4581,quantity:_0x74aade,note:_0x513f45,room:_0x303325,primary_code:_0x26915a,secondary_code:_0x65e630,prod_code:_0x10673f,level:_0x2af1ab,isle:_0x2ecf04,pallet:_0x42e0c2,batch_code:_0x3646de,SCRN:_0x56ed35,expiry_date:_0x22928a,mode_transpo:_0x149c44,name_driver:_0x390a41}=_0x586c9e[_0x43f6a9(0x1a0)];if(typeof _0x4f997d==_0x43f6a9(0x190))var _0xc9f944=[_0x586c9e['body'][_0x43f6a9(0x17b)]],_0x30e1c8=[_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0xec)]],_0x40553b=[_0x586c9e['body'][_0x43f6a9(0xd5)]],_0x520b31=[_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0xe5)]],_0x18bb33=[_0x586c9e['body'][_0x43f6a9(0xb6)]],_0x41a17b=[_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0xcc)]],_0xb7e165=[_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x123)]],_0x3782d6=[_0x586c9e['body'][_0x43f6a9(0xb4)]],_0x42073f=[_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x1be)]],_0xfdd94f=[_0x586c9e['body']['batch_code']],_0x5db1c8=[_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x170)]],_0x25925f=[_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x10e)]],_0x203c1b=[_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0xbd)]],_0x3fdc0e=[_0x586c9e['body'][_0x43f6a9(0x142)]],_0x4cca96=[_0x586c9e['body'][_0x43f6a9(0x15c)]],_0x136f66=[_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x167)]],_0xc5bef3=[_0x586c9e['body'][_0x43f6a9(0x127)]];else var _0xc9f944=[..._0x586c9e['body'][_0x43f6a9(0x17b)]],_0x30e1c8=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0xec)]],_0x40553b=[..._0x586c9e['body'][_0x43f6a9(0xd5)]],_0x520b31=[..._0x586c9e[_0x43f6a9(0x1a0)]['primary_code']],_0x18bb33=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0xb6)]],_0x41a17b=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0xcc)]],_0xb7e165=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x123)]],_0x3782d6=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0xb4)]],_0x42073f=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x1be)]],_0xfdd94f=[..._0x586c9e['body'][_0x43f6a9(0x1af)]],_0x5db1c8=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x170)]],_0x25925f=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x10e)]],_0x203c1b=[..._0x586c9e[_0x43f6a9(0x1a0)]['max_per_unit']],_0x3fdc0e=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x142)]],_0x4cca96=[..._0x586c9e['body'][_0x43f6a9(0x15c)]],_0x136f66=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x167)]],_0xc5bef3=[..._0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x127)]];const _0x475f62=_0xc9f944[_0x43f6a9(0x194)](_0xc6d386=>{return _0xc6d386={'product_name':_0xc6d386};});_0x30e1c8[_0x43f6a9(0x144)]((_0x51c53d,_0x162bf3)=>{var _0x57e7cd=_0x43f6a9;_0x475f62[_0x162bf3][_0x57e7cd(0xec)]=_0x51c53d;}),_0x40553b[_0x43f6a9(0x144)]((_0x36f57c,_0x46dd10)=>{var _0x4eb911=_0x43f6a9;_0x475f62[_0x46dd10][_0x4eb911(0xcd)]=Math[_0x4eb911(0x16d)](_0x36f57c);}),_0xc5bef3['forEach']((_0x1a203d,_0x2e0f84)=>{var _0x35bb10=_0x43f6a9;_0x475f62[_0x2e0f84][_0x35bb10(0x127)]=_0x1a203d;}),_0x520b31['forEach']((_0x42d43b,_0x4096ed)=>{var _0x2a5519=_0x43f6a9;_0x475f62[_0x4096ed][_0x2a5519(0xe5)]=_0x42d43b;}),_0x18bb33[_0x43f6a9(0x144)]((_0xae4a24,_0x49bd7f)=>{var _0x34efdf=_0x43f6a9;_0x475f62[_0x49bd7f][_0x34efdf(0xb6)]=_0xae4a24;}),_0x41a17b[_0x43f6a9(0x144)]((_0x26042e,_0x395114)=>{_0x475f62[_0x395114]['product_code']=_0x26042e;}),_0xb7e165[_0x43f6a9(0x144)]((_0x3fc46d,_0x474e1b)=>{var _0x5ee5ef=_0x43f6a9;_0x475f62[_0x474e1b][_0x5ee5ef(0x165)]=_0x3fc46d;}),_0x3782d6[_0x43f6a9(0x144)]((_0x2139a0,_0x5a6356)=>{var _0x2f7c81=_0x43f6a9;_0x475f62[_0x5a6356][_0x2f7c81(0x109)]=_0x2139a0;}),_0x42073f['forEach']((_0x3e349f,_0x1a35fc)=>{var _0x41fdc6=_0x43f6a9;_0x475f62[_0x1a35fc][_0x41fdc6(0x1be)]=_0x3e349f;}),_0xfdd94f[_0x43f6a9(0x144)]((_0x3cf0f2,_0x5b26b1)=>{_0x475f62[_0x5b26b1]['batch_code']=_0x3cf0f2;}),_0x5db1c8[_0x43f6a9(0x144)]((_0x384900,_0x5df301)=>{_0x475f62[_0x5df301]['expiry_date']=_0x384900;}),_0x25925f['forEach']((_0x1e5ecd,_0x4595fc)=>{_0x475f62[_0x4595fc]['production_date']=_0x1e5ecd;}),_0x203c1b[_0x43f6a9(0x144)]((_0x39229b,_0x4a6e53)=>{_0x475f62[_0x4a6e53]['maxperunit']=_0x39229b;}),_0x3fdc0e[_0x43f6a9(0x144)]((_0x149b7e,_0x5c24bb)=>{var _0xfb9abe=_0x43f6a9;_0x475f62[_0x5c24bb][_0xfb9abe(0x142)]=_0x149b7e;}),_0x4cca96['forEach']((_0x2df0ae,_0x1db845)=>{_0x475f62[_0x1db845]['room_name']=_0x2df0ae;}),_0x136f66[_0x43f6a9(0x144)]((_0x381258,_0x4d8242)=>{_0x475f62[_0x4d8242]['invoice']=_0x381258;});var _0x252015=0x0;_0x475f62[_0x43f6a9(0x144)](_0x1fe7e5=>{var _0x383625=_0x43f6a9;parseFloat(_0x1fe7e5[_0x383625(0xec)])<parseFloat(_0x1fe7e5[_0x383625(0xcd)])&&parseFloat(_0x1fe7e5[_0x383625(0xcd)])>parseFloat(_0x1fe7e5[_0x383625(0xec)])&&(console['log'](_0x1fe7e5['stock']+_0x383625(0x1c8)+_0x1fe7e5['quantity']),_0x252015++);});if(_0x252015!=0x0)return _0x586c9e[_0x43f6a9(0x16a)](_0x43f6a9(0x184),_0x43f6a9(0x16b)),_0x33f4fe[_0x43f6a9(0x158)]('back');const _0x15a060=_0x475f62[_0x43f6a9(0x173)](_0x3e8433=>_0x3e8433[_0x43f6a9(0xcd)]!=='0'&&_0x3e8433[_0x43f6a9(0xcd)]!==''),_0x247f14=new sales_finished({'invoice':_0x4ef048,'customer':_0x586c9e['body']['customer'],'date':_0x2a2296,'warehouse_name':_0x571348,'sale_product':_0x15a060,'note':_0x513f45,'room':_0x303325,'primary_code':_0x26915a,'secondary_code':_0x65e630,'prod_code':_0x10673f,'SCRN':_0x56ed35,'finalize':_0x43f6a9(0x189),'mode_transpo':_0x149c44,'name_driver':_0x390a41}),_0x1cc408=await _0x247f14['save'](),_0x4f92c9=await sales_finished[_0x43f6a9(0xf1)]({'invoice':_0x4ef048}),_0x3cb89b=new c_payment_data({'invoice':_0x4ef048,'customer':_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x1a7)],'reason':_0x43f6a9(0x14a)});await _0x3cb89b[_0x43f6a9(0x134)]();const _0x4c8897=await master_shop[_0x43f6a9(0xc7)](),_0x53d32f=await email_settings['findOne'](),_0x12d473=await customer[_0x43f6a9(0xf1)]({'name':_0x586c9e[_0x43f6a9(0x1a0)][_0x43f6a9(0x1a7)]});_0x4c8897[0x0][_0x43f6a9(0x121)]==0x1?(right_currency=_0x4c8897[0x0][_0x43f6a9(0xf6)],left_currency=''):(right_currency='',left_currency=_0x4c8897[0x0][_0x43f6a9(0xf6)]);var _0x257944=_0xc9f944,_0x149b15=_0x40553b,_0xc953a7='',_0x2ec1bb;for(_0x2ec1bb in _0x257944){_0xc953a7+=_0x43f6a9(0x12d)+_0x43f6a9(0x171)+_0x257944[_0x2ec1bb]+_0x43f6a9(0x132)+_0x43f6a9(0x171)+_0x149b15[_0x2ec1bb]+_0x43f6a9(0x132)+_0x43f6a9(0x120);}console[_0x43f6a9(0x11e)]('product_list',_0xc953a7);let _0x300795=nodemailer[_0x43f6a9(0x19b)]({'host':_0x53d32f['host'],'port':Number(_0x53d32f['port']),'secure':![],'service':'gmail','auth':{'user':_0x53d32f['email'],'pass':_0x53d32f[_0x43f6a9(0x161)]}}),_0x3d41bd={'from':_0x53d32f[_0x43f6a9(0xfa)],'to':'christian.villamer@jakagroup.com','subject':_0x43f6a9(0xce),'attachments':[{'filename':_0x43f6a9(0x146),'path':__dirname+_0x43f6a9(0x1b9)+_0x43f6a9(0xfe)+_0x4c8897[0x0][_0x43f6a9(0xd3)],'cid':_0x43f6a9(0x1ac)}],'html':_0x43f6a9(0x1b7)};_0x300795[_0x43f6a9(0x1b5)](_0x3d41bd,function(_0x36acdf,_0x276c0f){var _0x4b97a7=_0x43f6a9;_0x36acdf?(console[_0x4b97a7(0x11e)](_0x36acdf),console[_0x4b97a7(0x11e)](_0x4b97a7(0xcb))):console[_0x4b97a7(0x11e)]('Email\x20sent\x20successfully');}),_0x586c9e[_0x43f6a9(0x16a)](_0x43f6a9(0x1b4),_0x43f6a9(0x14e)),_0x33f4fe[_0x43f6a9(0x158)](_0x43f6a9(0xfc)+_0x1cc408[_0x43f6a9(0x104)]);}catch(_0xf34faf){console[_0x43f6a9(0x11e)](_0xf34faf);}}),router[a0_0x3a8b9d(0x17a)](a0_0x3a8b9d(0x111),auth,async(_0xeac14f,_0xe5c905)=>{var _0x55307c=a0_0x3a8b9d;try{const {username:_0x539879,email:_0x58cffc,role:_0x292eae}=_0xeac14f['user'],_0x49cd1b=_0xeac14f['user'],_0x461254=await profile[_0x55307c(0xf1)]({'email':_0x49cd1b[_0x55307c(0xfa)]}),_0x4f48d5=await master_shop['find'](),_0x329b84=_0xeac14f[_0x55307c(0x1b3)]['id'],_0xe1c91d=await sales_finished[_0x55307c(0x130)](_0x329b84),_0x5f49e8=await warehouse['aggregate']([{'$match':{'name':_0xe1c91d[_0x55307c(0x13c)]}},{'$unwind':_0x55307c(0xee)},{'$group':{'_id':_0x55307c(0x10c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x55307c(0x117)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x55307c(0xc1)},'floorlevel':{'$first':_0x55307c(0xdf)},'primary_code':{'$first':_0x55307c(0x183)},'secondary_code':{'$first':_0x55307c(0x150)},'product_code':{'$first':_0x55307c(0x102)},'storage':{'$first':_0x55307c(0x172)},'rack':{'$first':_0x55307c(0x133)},'expiry_date':{'$first':_0x55307c(0x126)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':_0x55307c(0x187)},'room_data':{'$first':_0x55307c(0xe6)}}}]),_0x874d27=await customer['find']({});let _0x421f02;if(_0x49cd1b['role']==_0x55307c(0x11b)){const _0x4730af=await staff[_0x55307c(0xf1)]({'email':_0x49cd1b[_0x55307c(0xfa)]});_0x421f02=await warehouse['aggregate']([{'$match':{'status':_0x55307c(0x1a6),'name':_0x4730af[_0x55307c(0x14b)]}},{'$group':{'_id':_0x55307c(0x17f),'name':{'$first':_0x55307c(0x17f)}}}]);}else _0x421f02=await warehouse[_0x55307c(0x137)]([{'$match':{'status':_0x55307c(0x1a6)}},{'$group':{'_id':_0x55307c(0x17f),'name':{'$first':'$name'}}}]);const _0x5196a7=await product[_0x55307c(0xc7)]({});if(_0x4f48d5[0x0]['language']==_0x55307c(0xdc)){var _0x40dafc=users[_0x55307c(0x16c)];console[_0x55307c(0x11e)](_0x40dafc);}else{if(_0x4f48d5[0x0]['language']=='Hindi')var _0x40dafc=users[_0x55307c(0x129)];else{if(_0x4f48d5[0x0]['language']==_0x55307c(0x1a8))var _0x40dafc=users['German'];else{if(_0x4f48d5[0x0]['language']==_0x55307c(0xf4))var _0x40dafc=users[_0x55307c(0xf4)];else{if(_0x4f48d5[0x0][_0x55307c(0x196)]==_0x55307c(0x12e))var _0x40dafc=users['French'];else{if(_0x4f48d5[0x0][_0x55307c(0x196)]==_0x55307c(0x1c3))var _0x40dafc=users[_0x55307c(0x103)];else{if(_0x4f48d5[0x0][_0x55307c(0x196)]==_0x55307c(0x180))var _0x40dafc=users['Chinese'];else{if(_0x4f48d5[0x0][_0x55307c(0x196)]==_0x55307c(0x16f))var _0x40dafc=users['Arabic'];}}}}}}}_0xe5c905[_0x55307c(0x118)]('edit_sales_finished_view',{'success':_0xeac14f[_0x55307c(0x16a)](_0x55307c(0x1b4)),'errors':_0xeac14f['flash']('errors'),'role':_0x49cd1b,'profile':_0x461254,'customer':_0x874d27,'warehouse':_0x421f02,'product':_0x5f49e8,'user':_0xe1c91d,'master_shop':_0x4f48d5,'unit':_0x5196a7,'language':_0x40dafc});}catch(_0x3e0132){console['log'](_0x3e0132);}}),router[a0_0x3a8b9d(0xbb)]('/preview/:id',auth,async(_0x7b6eae,_0x18217a)=>{var _0x4bf38e=a0_0x3a8b9d;try{const _0x2d96bb=_0x7b6eae[_0x4bf38e(0x1b3)]['id'],{invoice:_0x46b775,warehouse_name:_0x4f6da6,room:_0xc6d525}=_0x7b6eae['body'],_0x3bf955=await sales_finished[_0x4bf38e(0xf1)]({'invoice':_0x46b775}),_0x4ec8e8=_0x3bf955[_0x4bf38e(0x1c4)][_0x4bf38e(0x194)](async _0xf8adb4=>{var _0x5671db=_0x4bf38e,_0x2c2910=await warehouse[_0x5671db(0xf1)]({'name':_0x4f6da6,'room':_0xf8adb4[_0x5671db(0x10f)],'warehouse_category':_0x5671db(0x1c2)});const _0x47e46b=_0x2c2910[_0x5671db(0x11a)]['map'](_0x218501=>{var _0x3e0960=_0x5671db;(_0x218501[_0x3e0960(0x17b)]==_0xf8adb4[_0x3e0960(0x17b)]&&_0x218501[_0x3e0960(0x165)]==_0xf8adb4[_0x3e0960(0x165)]&&_0x218501[_0x3e0960(0x170)]==_0xf8adb4[_0x3e0960(0x170)]&&_0x218501[_0x3e0960(0xd9)]==_0xf8adb4[_0x3e0960(0xd9)]&&_0x218501[_0x3e0960(0x1af)]==_0xf8adb4['batch_code']&&_0x218501[_0x3e0960(0x191)]==_0xf8adb4[_0x3e0960(0x191)]||_0x218501['_id']==_0xf8adb4['id_transaction_from'])&&(_0x218501['product_stock']>0x0&&(console['log'](_0x218501['product_name']+'\x20==\x20'+_0xf8adb4[_0x3e0960(0x17b)]+_0x3e0960(0x19f)+_0x218501[_0x3e0960(0x165)]+_0x3e0960(0x18f)+_0xf8adb4[_0x3e0960(0x165)]+'\x20&&\x20'+_0x218501[_0x3e0960(0xd9)]+_0x3e0960(0x18f)+_0xf8adb4[_0x3e0960(0xd9)]+_0x3e0960(0x19f)+_0x218501[_0x3e0960(0x170)]+'\x20==\x20'+_0xf8adb4[_0x3e0960(0x170)]+'\x20&&\x20'+_0x218501['batch_code']+_0x3e0960(0x18f)+_0xf8adb4[_0x3e0960(0x1af)]+_0x3e0960(0x19f)+_0x218501[_0x3e0960(0x191)]+'\x20==\x20'+_0xf8adb4[_0x3e0960(0x191)]+'\x20&&\x20'+_0x218501['product_stock']+'\x20<<<==>>>\x20'+_0xf8adb4[_0x3e0960(0xcd)]+_0x3e0960(0x162)+_0xf8adb4[_0x3e0960(0x10f)]+_0x3e0960(0x19f)+_0x218501[_0x3e0960(0x104)]+_0x3e0960(0x18f)+_0xf8adb4[_0x3e0960(0x127)]),_0x218501[_0x3e0960(0x112)]=Math['max'](0x0,Math[_0x3e0960(0x16d)](_0x218501[_0x3e0960(0x112)])-Math[_0x3e0960(0x16d)](_0xf8adb4['quantity']))));});return _0x2c2910;});Promise[_0x4bf38e(0xba)](_0x4ec8e8)['then'](async _0x19c9db=>{var _0xcc2c52=_0x4bf38e;try{for(const _0x27346b of _0x19c9db){await _0x27346b[_0xcc2c52(0x134)]();}_0x3bf955['finalize']=_0xcc2c52(0x11c);const _0x1546ad=await _0x3bf955[_0xcc2c52(0x134)](),_0x8f7890=await master_shop['find'](),_0x3d2ec4=await email_settings[_0xcc2c52(0xf1)](),_0x5ac2ca=await supervisor_settings[_0xcc2c52(0xc7)]();var _0xdf2839=_0x3bf955[_0xcc2c52(0x1c4)],_0x404719='',_0xbf7346;for(_0xbf7346 in _0xdf2839){var _0x359854='FG';_0x3bf955[_0xcc2c52(0x13c)]=='DRY\x20GOODS'&&(_0x359854='DG'),_0x404719+=_0xcc2c52(0x12d)+_0xcc2c52(0x171)+_0xdf2839[_0xbf7346][_0xcc2c52(0x17b)]+'</td>'+_0xcc2c52(0x171)+_0xdf2839[_0xbf7346]['product_code']+_0xcc2c52(0x132)+_0xcc2c52(0x171)+_0xdf2839[_0xbf7346][_0xcc2c52(0xcd)]+_0xcc2c52(0x132)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xdf2839[_0xbf7346][_0xcc2c52(0x109)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xdf2839[_0xbf7346]['secondary_unit']+_0xcc2c52(0x132)+_0xcc2c52(0x171)+_0x3bf955[_0xcc2c52(0x13c)]+_0xcc2c52(0x132)+_0xcc2c52(0x171)+_0xdf2839[_0xbf7346]['room_name']+_0xcc2c52(0x132)+_0xcc2c52(0x171)+_0x359854+_0xdf2839[_0xbf7346]['bay']+_0xcc2c52(0x132);}let _0x1bd4b8=nodemailer[_0xcc2c52(0x19b)]({'host':_0x3d2ec4[_0xcc2c52(0x168)],'port':Number(_0x3d2ec4[_0xcc2c52(0xef)]),'secure':![],'auth':{'user':_0x3d2ec4[_0xcc2c52(0xfa)],'pass':_0x3d2ec4['password']}}),_0xf4377b={'from':_0x3d2ec4[_0xcc2c52(0xfa)],'to':_0x5ac2ca[0x0][_0xcc2c52(0x10d)],'subject':'Sales\x20Mail','attachments':[{'filename':_0xcc2c52(0x146),'path':__dirname+_0xcc2c52(0x1b9)+_0xcc2c52(0xfe)+_0x8f7890[0x0]['image'],'cid':_0xcc2c52(0x1ac)}],'html':_0xcc2c52(0x15a)+_0xcc2c52(0x110)+'</head><body>'+_0xcc2c52(0x14f)+_0xcc2c52(0x17e)+_0xcc2c52(0x14f)+_0xcc2c52(0x152)+_0xcc2c52(0xd6)+_0xcc2c52(0x14f)+_0xcc2c52(0x177)+_0x8f7890[0x0][_0xcc2c52(0x13b)]+_0xcc2c52(0x1c5)+_0xcc2c52(0xd6)+'</div>'+_0xcc2c52(0xd1)+_0xcc2c52(0x14f)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0xcc2c52(0x19a)+_0x3bf955[_0xcc2c52(0x191)]+'\x20'+_0xcc2c52(0x154)+_0xcc2c52(0xe0)+_0x3bf955['date']+'\x20'+_0xcc2c52(0x12c)+_0xcc2c52(0x136)+'</div>'+_0xcc2c52(0x114)+_0xcc2c52(0x141)+'<tr>'+_0xcc2c52(0x1c0)+_0xcc2c52(0x125)+_0xcc2c52(0x151)+_0xcc2c52(0x145)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0xcc2c52(0xfb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0xcc2c52(0xeb)+_0xcc2c52(0x120)+'</thead>'+_0xcc2c52(0x131)+'\x20'+_0x404719+'\x20'+_0xcc2c52(0x185)+_0xcc2c52(0xde)+'<div>'+_0xcc2c52(0xe7)+'<h5>'+_0x8f7890[0x0][_0xcc2c52(0x13b)]+_0xcc2c52(0x136)+_0xcc2c52(0xd6)+_0xcc2c52(0xd6)+'</body></html>'};_0x1bd4b8[_0xcc2c52(0x1b5)](_0xf4377b,function(_0x54d5d1,_0x4f5b21){var _0x55c20a=_0xcc2c52;_0x54d5d1?(console[_0x55c20a(0x11e)](_0x54d5d1),console[_0x55c20a(0x11e)]('Error\x20Occurs')):console[_0x55c20a(0x11e)](_0x55c20a(0x113));}),_0x7b6eae[_0xcc2c52(0x16a)]('success','Sales\x20Update\x20successfully'),_0x18217a[_0xcc2c52(0x158)](_0xcc2c52(0x135)+_0x2d96bb);}catch(_0x31c84c){console[_0xcc2c52(0x15e)](_0x31c84c),_0x18217a['status'](0x1f4)[_0xcc2c52(0x13f)]({'error':_0xcc2c52(0x13a)});}})['catch'](_0x2cd8b2=>{var _0x681754=_0x4bf38e;console[_0x681754(0x15e)](_0x2cd8b2),_0x18217a[_0x681754(0x198)](0x1f4)[_0x681754(0x13f)]({'error':'An\x20error\x20occurred.'});});}catch(_0x3f5ab6){console[_0x4bf38e(0x11e)](_0x3f5ab6);}}),router['get']('/view/:id',auth,async(_0x1a8436,_0x42ec74)=>{var _0x1186a9=a0_0x3a8b9d;try{const {username:_0x24f5e2,email:_0x2bdafa,role:_0x318be0}=_0x1a8436['user'],_0x3b1123=_0x1a8436['user'],_0x296a18=await profile[_0x1186a9(0xf1)]({'email':_0x3b1123[_0x1186a9(0xfa)]}),_0x2ccfca=await master_shop['find'](),_0x2e195b=_0x1a8436[_0x1186a9(0x1b3)]['id'],_0x354155=await sales_finished[_0x1186a9(0x130)](_0x2e195b);let _0x420aaa=new Date(_0x354155[_0x1186a9(0x170)]),_0x1051d3=('0'+_0x420aaa[_0x1186a9(0xc8)]())[_0x1186a9(0xb1)](-0x2),_0x1743ce=('0'+(_0x420aaa[_0x1186a9(0x1a5)]()+0x1))[_0x1186a9(0xb1)](-0x2),_0x61396f=_0x420aaa[_0x1186a9(0x14c)](),_0x199abe=_0x61396f+'-'+_0x1743ce+'-'+_0x1051d3;var _0x1b1126=[_0x1186a9(0x1bc),_0x1186a9(0x140)];const _0x53796e=await warehouse[_0x1186a9(0x137)]([{'$match':{'name':_0x354155[_0x1186a9(0x13c)],'room':_0x354155['room']}},{'$unwind':_0x1186a9(0xee)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1186a9(0x1ab)},'bay':{'$first':_0x1186a9(0x117)},'bin':{'$first':_0x1186a9(0x105)},'type':{'$first':_0x1186a9(0xc1)},'floorlevel':{'$first':_0x1186a9(0xdf)},'primary_code':{'$first':_0x1186a9(0x183)},'secondary_code':{'$first':_0x1186a9(0x150)},'product_code':{'$first':_0x1186a9(0x102)},'storage':{'$first':_0x1186a9(0x172)},'rack':{'$first':_0x1186a9(0x133)}}}]),_0x4853a5=await customer[_0x1186a9(0xc7)]({});let _0x124bee;if(_0x3b1123['role']==_0x1186a9(0x11b)){const _0x5b3860=await staff[_0x1186a9(0xf1)]({'email':_0x3b1123['email']});_0x124bee=await warehouse[_0x1186a9(0x137)]([{'$match':{'status':'Enabled','name':_0x5b3860[_0x1186a9(0x14b)]}},{'$group':{'_id':_0x1186a9(0x17f),'name':{'$first':_0x1186a9(0x17f)}}}]);}else _0x124bee=await warehouse['aggregate']([{'$match':{'status':_0x1186a9(0x1a6)}},{'$group':{'_id':'$name','name':{'$first':_0x1186a9(0x17f)}}}]);const _0x4779c1=await product[_0x1186a9(0xc7)]({});if(_0x2ccfca[0x0][_0x1186a9(0x196)]==_0x1186a9(0xdc)){var _0x3b0fc6=users[_0x1186a9(0x16c)];console[_0x1186a9(0x11e)](_0x3b0fc6);}else{if(_0x2ccfca[0x0][_0x1186a9(0x196)]==_0x1186a9(0x129))var _0x3b0fc6=users[_0x1186a9(0x129)];else{if(_0x2ccfca[0x0][_0x1186a9(0x196)]==_0x1186a9(0x1a8))var _0x3b0fc6=users['German'];else{if(_0x2ccfca[0x0][_0x1186a9(0x196)]=='Spanish')var _0x3b0fc6=users[_0x1186a9(0xf4)];else{if(_0x2ccfca[0x0][_0x1186a9(0x196)]==_0x1186a9(0x12e))var _0x3b0fc6=users[_0x1186a9(0x12e)];else{if(_0x2ccfca[0x0][_0x1186a9(0x196)]==_0x1186a9(0x1c3))var _0x3b0fc6=users[_0x1186a9(0x103)];else{if(_0x2ccfca[0x0][_0x1186a9(0x196)]=='Chinese')var _0x3b0fc6=users['Chinese'];else{if(_0x2ccfca[0x0][_0x1186a9(0x196)]==_0x1186a9(0x16f))var _0x3b0fc6=users[_0x1186a9(0x181)];}}}}}}}_0x42ec74[_0x1186a9(0x118)](_0x1186a9(0x13d),{'success':_0x1a8436[_0x1186a9(0x16a)](_0x1186a9(0x1b4)),'errors':_0x1a8436['flash'](_0x1186a9(0x184)),'role':_0x3b1123,'profile':_0x296a18,'customer':_0x4853a5,'warehouse':_0x124bee,'product':_0x53796e,'user':_0x354155,'master_shop':_0x2ccfca,'unit':_0x4779c1,'language':_0x3b0fc6,'rooms_data':_0x1b1126,'ed_fullDate':_0x199abe});}catch(_0x4595e6){console['log'](_0x4595e6);}}),router[a0_0x3a8b9d(0xbb)](a0_0x3a8b9d(0xf9),auth,async(_0x4186f7,_0xe7bb12)=>{var _0x38141f=a0_0x3a8b9d;try{const _0x546e51=_0x4186f7[_0x38141f(0x1b3)]['id'],_0x165d80=await sales_finished[_0x38141f(0xf1)]({'_id':_0x4186f7[_0x38141f(0x1b3)]['id']}),_0x451b55=await warehouse[_0x38141f(0xf1)]({'name':_0x165d80['warehouse_name'],'room':_0x4186f7['body'][_0x38141f(0xda)],'warehouse_category':_0x38141f(0x1c2)}),{invoice:_0x51391a,customer:_0x303e53,date:_0x5a8da8,warehouse_name:_0x34d028,product_name:_0xbd3c41,stock:_0x1f72a7,adjust_qty:_0x4970d1,note:_0x28abfb,room:_0x1c4f19,primary_code:_0x17abb3,secondary_code:_0x928de7,prod_code:_0x5f4e32,level:_0x2ab392,isle:_0x2d64bb,pallet:_0x5d418a,expiry_date:_0x3918af}=_0x4186f7['body'];if(typeof _0xbd3c41==_0x38141f(0x190))var _0x14b287=[_0x4186f7[_0x38141f(0x1a0)][_0x38141f(0x17b)]],_0x163ff0=[_0x4186f7['body']['stock']],_0x4bc1d8=[_0x4186f7[_0x38141f(0x1a0)][_0x38141f(0xbc)]],_0x5dec4a=[_0x4186f7[_0x38141f(0x1a0)][_0x38141f(0xe5)]],_0xc7c36a=[_0x4186f7['body'][_0x38141f(0xb6)]],_0xc95f99=[_0x4186f7[_0x38141f(0x1a0)][_0x38141f(0xcc)]],_0x56b93b=[_0x4186f7[_0x38141f(0x1a0)][_0x38141f(0x123)]],_0x5af837=[_0x4186f7[_0x38141f(0x1a0)][_0x38141f(0x170)]];else var _0x14b287=[..._0x4186f7[_0x38141f(0x1a0)][_0x38141f(0x17b)]],_0x163ff0=[..._0x4186f7[_0x38141f(0x1a0)]['stock']],_0x4bc1d8=[..._0x4186f7['body'][_0x38141f(0xbc)]],_0x5dec4a=[..._0x4186f7[_0x38141f(0x1a0)][_0x38141f(0xe5)]],_0xc7c36a=[..._0x4186f7[_0x38141f(0x1a0)][_0x38141f(0xb6)]],_0xc95f99=[..._0x4186f7['body'][_0x38141f(0xcc)]],_0x56b93b=[..._0x4186f7['body'][_0x38141f(0x123)]],_0x5af837=[..._0x4186f7['body'][_0x38141f(0x170)]];const _0xc7433f=_0x14b287['map'](_0x41fc99=>{return _0x41fc99={'product_name':_0x41fc99};});_0x163ff0[_0x38141f(0x144)]((_0x213aa2,_0x1d86ad)=>{var _0x478e0e=_0x38141f;_0xc7433f[_0x1d86ad][_0x478e0e(0xec)]=_0x213aa2;}),_0x4bc1d8[_0x38141f(0x144)]((_0x53c4ab,_0x57f8db)=>{_0xc7433f[_0x57f8db]['quantity']=_0x53c4ab;}),_0x5dec4a['forEach']((_0x125bea,_0x3f18fc)=>{var _0x1cf38a=_0x38141f;_0xc7433f[_0x3f18fc][_0x1cf38a(0xe5)]=_0x125bea;}),_0xc7c36a[_0x38141f(0x144)]((_0x13093a,_0x478051)=>{var _0x3d7880=_0x38141f;_0xc7433f[_0x478051][_0x3d7880(0xb6)]=_0x13093a;}),_0xc95f99[_0x38141f(0x144)]((_0xf6854,_0x142c98)=>{var _0x4ea2be=_0x38141f;_0xc7433f[_0x142c98][_0x4ea2be(0x195)]=_0xf6854;}),_0x56b93b['forEach']((_0x305978,_0x2285ee)=>{var _0x505e31=_0x38141f;_0xc7433f[_0x2285ee][_0x505e31(0x123)]=_0x305978;}),_0x5af837[_0x38141f(0x144)]((_0x2518ac,_0x25cebd)=>{_0xc7433f[_0x25cebd]['expiry_date']=_0x2518ac;});var _0x51a0be=0x0;_0xc7433f[_0x38141f(0x144)](_0x3aca23=>{var _0x750918=_0x38141f;console[_0x750918(0x11e)](_0x750918(0x138),_0x3aca23),(parseInt(_0x3aca23[_0x750918(0xec)])<parseInt(_0x3aca23[_0x750918(0xcd)])||parseInt(_0x3aca23[_0x750918(0xcd)])==0x0)&&_0x51a0be++;});if(_0x51a0be!=0x0)return _0x4186f7['flash'](_0x38141f(0x184),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0xe7bb12[_0x38141f(0x158)]('back');_0x165d80['sale_product'][_0x38141f(0x144)](_0x46dd56=>{var _0x47f870=_0x38141f;const _0x131e0a=_0x451b55[_0x47f870(0x11a)]['map'](_0x33cd43=>{var _0x2d55a0=_0x47f870;_0x33cd43[_0x2d55a0(0x17b)]==_0x46dd56[_0x2d55a0(0x17b)]&&_0x33cd43[_0x2d55a0(0x165)]==_0x46dd56[_0x2d55a0(0x165)]&&(_0x33cd43[_0x2d55a0(0x112)]=parseInt(_0x33cd43[_0x2d55a0(0x112)])+parseInt(_0x46dd56['quantity']));});}),await _0x451b55[_0x38141f(0x134)]();const _0x1d99b7=_0xc7433f[_0x38141f(0x173)](_0x1b8e26=>_0x1b8e26['quantity']!=='0'&&_0x1b8e26['quantity']!=='');_0x165d80[_0x38141f(0x191)]=_0x51391a,_0x165d80['customer']=_0x303e53,_0x165d80[_0x38141f(0x1c1)]=_0x5a8da8,_0x165d80[_0x38141f(0x13c)]=_0x34d028,_0x165d80['sale_product']=_0x1d99b7,_0x165d80[_0x38141f(0xc2)]=_0x28abfb,_0x165d80[_0x38141f(0xda)]=_0x1c4f19;const _0x44ab66=await _0x165d80[_0x38141f(0x134)](),_0x5ba500=await sales_finished[_0x38141f(0xf1)]({'_id':_0x4186f7[_0x38141f(0x1b3)]['id']}),_0x457c14=await warehouse[_0x38141f(0xf1)]({'name':_0x34d028,'room':_0x1c4f19,'warehouse_category':_0x38141f(0x1c2)});_0x5ba500[_0x38141f(0x1c4)][_0x38141f(0x144)](_0x579c4a=>{var _0xf05c64=_0x38141f;const _0x399eb5=_0x457c14[_0xf05c64(0x11a)][_0xf05c64(0x194)](_0xad4f37=>{var _0x19e35a=_0xf05c64;_0xad4f37[_0x19e35a(0x17b)]==_0x579c4a['product_name']&&_0xad4f37[_0x19e35a(0x165)]==_0x579c4a[_0x19e35a(0x165)]&&(_0xad4f37[_0x19e35a(0x112)]=parseInt(_0xad4f37[_0x19e35a(0x112)])-parseInt(_0x579c4a['quantity']));});}),console[_0x38141f(0x11e)](_0x38141f(0x186),_0x457c14),await _0x457c14[_0x38141f(0x134)]();const _0x4986c7=await c_payment_data['findOne']({'invoice':_0x4186f7['body'][_0x38141f(0x191)]});_0x4986c7[_0x38141f(0x1c9)]=_0x4186f7[_0x38141f(0x1a0)][_0x38141f(0x1c9)],await _0x4986c7['save'](),_0x4186f7['flash'](_0x38141f(0x1b4),_0x38141f(0x10b)),_0xe7bb12[_0x38141f(0x158)](_0x38141f(0xff));}catch(_0x3a3696){console['log'](_0x3a3696);}}),router[a0_0x3a8b9d(0xbb)](a0_0x3a8b9d(0x169),auth,async(_0x2640f7,_0x129751)=>{var _0x151659=a0_0x3a8b9d;try{const _0x7c57be=_0x2640f7[_0x151659(0x1b3)]['id'],{invoice:_0x45e7d3,customer:_0x1296c6,receivable_amount:_0x219810,received_amount:_0xd78d5c}=_0x2640f7['body'],_0x1fb3ca=await sales[_0x151659(0x130)](_0x7c57be);console[_0x151659(0x11e)](_0x1fb3ca);var _0x4f8f7b=_0x219810-_0xd78d5c;console[_0x151659(0x11e)](_0xd78d5c),_0x1fb3ca[_0x151659(0x1b8)]=parseFloat(_0xd78d5c)+parseFloat(_0x1fb3ca[_0x151659(0x1b8)]),_0x1fb3ca['due_amount']=_0x4f8f7b,console['log'](_0x1fb3ca);const _0x4ecd41=await _0x1fb3ca[_0x151659(0x134)](),_0x42b2e4=await c_payment_data[_0x151659(0xf1)]({'invoice':_0x45e7d3});_0x42b2e4[_0x151659(0x12f)]=_0x4f8f7b,await _0x42b2e4[_0x151659(0x134)]();let _0xa6a5e0=new Date(),_0x2d8e18=('0'+_0xa6a5e0[_0x151659(0xc8)]())['slice'](-0x2),_0x1310c9=('0'+(_0xa6a5e0[_0x151659(0x1a5)]()+0x1))[_0x151659(0xb1)](-0x2),_0x227d9c=_0xa6a5e0[_0x151659(0x14c)](),_0x5b7534=_0x227d9c+'-'+_0x1310c9+'-'+_0x2d8e18;const _0x150709=new customer_payment({'invoice':_0x45e7d3,'date':_0x227d9c+'-'+_0x1310c9+'-'+_0x2d8e18,'customer':_0x1296c6,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0xd78d5c}),_0x3c2334=await _0x150709[_0x151659(0x134)]();_0x2640f7[_0x151659(0x16a)](_0x151659(0x1b4),_0x151659(0x18a)),_0x129751[_0x151659(0x158)](_0x151659(0x15f));}catch(_0x47f95d){console[_0x151659(0x11e)](_0x47f95d);}}),router[a0_0x3a8b9d(0x17a)]('/invoice/:id',auth,async(_0x1a6e83,_0x25eb77)=>{var _0x440c82=a0_0x3a8b9d;try{const {username:_0xa37a9a,email:_0x4ab30a,role:_0x247fd9}=_0x1a6e83[_0x440c82(0xd7)],_0x1c5599=_0x1a6e83[_0x440c82(0xd7)],_0x53f5bc=await profile[_0x440c82(0xf1)]({'email':_0x1c5599[_0x440c82(0xfa)]}),_0x27ca82=await master_shop[_0x440c82(0xc7)]();console[_0x440c82(0x11e)]('master',_0x27ca82);const _0x148c5a=_0x1a6e83[_0x440c82(0x1b3)]['id'],_0x35ee68=await sales[_0x440c82(0x130)](_0x148c5a);console['log'](_0x35ee68);const _0x583cee=await customer[_0x440c82(0xf1)]({'name':_0x35ee68[_0x440c82(0x1a7)]});console[_0x440c82(0x11e)](_0x583cee);if(_0x27ca82[0x0][_0x440c82(0x196)]==_0x440c82(0xdc)){var _0x21ada3=users[_0x440c82(0x16c)];console[_0x440c82(0x11e)](_0x21ada3);}else{if(_0x27ca82[0x0]['language']==_0x440c82(0x129))var _0x21ada3=users[_0x440c82(0x129)];else{if(_0x27ca82[0x0][_0x440c82(0x196)]==_0x440c82(0x1a8))var _0x21ada3=users[_0x440c82(0x1a8)];else{if(_0x27ca82[0x0][_0x440c82(0x196)]==_0x440c82(0xf4))var _0x21ada3=users[_0x440c82(0xf4)];else{if(_0x27ca82[0x0][_0x440c82(0x196)]=='French')var _0x21ada3=users[_0x440c82(0x12e)];else{if(_0x27ca82[0x0][_0x440c82(0x196)]=='Portuguese\x20(BR)')var _0x21ada3=users[_0x440c82(0x103)];else{if(_0x27ca82[0x0][_0x440c82(0x196)]==_0x440c82(0x180))var _0x21ada3=users[_0x440c82(0x180)];else{if(_0x27ca82[0x0]['language']==_0x440c82(0x16f))var _0x21ada3=users['Arabic'];}}}}}}}_0x25eb77[_0x440c82(0x118)](_0x440c82(0x128),{'success':_0x1a6e83[_0x440c82(0x16a)](_0x440c82(0x1b4)),'errors':_0x1a6e83[_0x440c82(0x16a)](_0x440c82(0x184)),'role':_0x1c5599,'profile':_0x53f5bc,'master_shop':_0x27ca82,'customers':_0x583cee,'sales':_0x35ee68,'language':_0x21ada3});}catch(_0x4600bd){console[_0x440c82(0x11e)](_0x4600bd);}}),router['get'](a0_0x3a8b9d(0x16e),auth,async(_0x818afb,_0x3061b5)=>{var _0x41cc07=a0_0x3a8b9d;try{const {username:_0x46b9b1,email:_0x14c0a4,role:_0x44b31f}=_0x818afb[_0x41cc07(0xd7)],_0x198c24=_0x818afb[_0x41cc07(0xd7)],_0x3db88b=await profile[_0x41cc07(0xf1)]({'email':_0x198c24[_0x41cc07(0xfa)]}),_0x5cf860=await master_shop[_0x41cc07(0xc7)](),_0x272b1c=_0x818afb[_0x41cc07(0x1b3)]['id'],_0x3074c8=await sales_finished[_0x41cc07(0x130)](_0x272b1c),_0x286232=await warehouse[_0x41cc07(0x137)]([{'$match':{'name':_0x3074c8[_0x41cc07(0x13c)]}},{'$unwind':_0x41cc07(0xee)},{'$group':{'_id':_0x41cc07(0x10c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x41cc07(0x1ab)},'bay':{'$first':_0x41cc07(0x117)},'bin':{'$first':_0x41cc07(0x105)},'type':{'$first':_0x41cc07(0xc1)},'floorlevel':{'$first':_0x41cc07(0xdf)},'primary_code':{'$first':_0x41cc07(0x183)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x41cc07(0x102)},'storage':{'$first':_0x41cc07(0x172)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x41cc07(0x126)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x41cc07(0x19d)},'maxProducts':{'$first':_0x41cc07(0x18e)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x483948=await product[_0x41cc07(0xc7)]({}),_0x281469=await warehouse[_0x41cc07(0x137)]([{'$match':{'status':_0x41cc07(0x1a6),'warehouse_category':_0x41cc07(0x1c2),'name':{'$ne':_0x41cc07(0x1bd),'$ne':_0x41cc07(0xc0)}}},{'$group':{'_id':_0x41cc07(0x17f),'name':{'$first':_0x41cc07(0x17f)}}},{'$sort':{'name':0x1}}]);var _0x216b41=['Return\x20Rooms'];const _0x1cb025=await warehouse[_0x41cc07(0x137)]([{'$match':{'status':_0x41cc07(0x1a6),'name':_0x41cc07(0xc0)}},{'$group':{'_id':'$name','name':{'$first':_0x41cc07(0x17f)}}},{'$sort':{'name':0x1}}]);if(_0x5cf860[0x0]['language']==_0x41cc07(0xdc)){var _0x28a365=users[_0x41cc07(0x16c)];console[_0x41cc07(0x11e)](_0x28a365);}else{if(_0x5cf860[0x0][_0x41cc07(0x196)]=='Hindi')var _0x28a365=users['Hindi'];else{if(_0x5cf860[0x0][_0x41cc07(0x196)]==_0x41cc07(0x1a8))var _0x28a365=users[_0x41cc07(0x1a8)];else{if(_0x5cf860[0x0][_0x41cc07(0x196)]=='Spanish')var _0x28a365=users['Spanish'];else{if(_0x5cf860[0x0][_0x41cc07(0x196)]==_0x41cc07(0x12e))var _0x28a365=users[_0x41cc07(0x12e)];else{if(_0x5cf860[0x0][_0x41cc07(0x196)]==_0x41cc07(0x1c3))var _0x28a365=users[_0x41cc07(0x103)];else{if(_0x5cf860[0x0]['language']==_0x41cc07(0x180))var _0x28a365=users[_0x41cc07(0x180)];else{if(_0x5cf860[0x0]['language']=='Arabic\x20(ae)')var _0x28a365=users[_0x41cc07(0x181)];}}}}}}}_0x3061b5[_0x41cc07(0x118)](_0x41cc07(0x159),{'success':_0x818afb[_0x41cc07(0x16a)](_0x41cc07(0x1b4)),'errors':_0x818afb[_0x41cc07(0x16a)](_0x41cc07(0x184)),'role':_0x198c24,'profile':_0x3db88b,'user':_0x3074c8,'stock':_0x286232,'master_shop':_0x5cf860,'unit':_0x483948,'language':_0x28a365,'warehouses':_0x281469,'rooms':_0x216b41,'warehouse_QA':_0x1cb025});}catch(_0x3f94d1){console[_0x41cc07(0x11e)](_0x3f94d1),_0x3061b5[_0x41cc07(0x198)](0xc8)[_0x41cc07(0x13f)]({'message':_0x3f94d1['message']});}}),router[a0_0x3a8b9d(0xbb)](a0_0x3a8b9d(0x16e),auth,async(_0x34d483,_0x4ba184)=>{var _0x2bf93b=a0_0x3a8b9d;if(_0x34d483[_0x2bf93b(0x1a0)]['for_categorize']=='QA')try{const {invoice:_0xb34b43,date:_0x334634,warehouse_name:_0x4fdedb,product_name:_0x2655bf,primary_code:_0x50d9a3,secondary_code:_0x34d29f,product_code:_0x3a6837,sales_quantity:_0x1b183d,stocks:_0x1450be,return_qty:_0xcb56d4,Room_name:_0x45c07b,to_warehouse_name_QA:_0x12549f,to_Room_name_QA:_0x2e9946,note:_0x316e80,for_categorize:_0x2349e5,product_name_QA1:_0x5cb868}=_0x34d483['body'];if(typeof _0x5cb868==_0x2bf93b(0x190))var _0x3f4243=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0xe4)]],_0x1e522d=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x192)]],_0x4cb22d=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x1ad)]],_0x539f06=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0xb8)]],_0x2e0969=[_0x34d483[_0x2bf93b(0x1a0)]['sales_quantity_QA']],_0x533445=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x10a)]],_0x4b4b8f=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0xdd)]],_0x2c6f05=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x1c7)]],_0x43ee0e=[_0x34d483[_0x2bf93b(0x1a0)]['maxProducts_QA']],_0xab927c=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x148)]],_0x3ebaee=[_0x34d483['body'][_0x2bf93b(0x17c)]],_0x1b5496=[_0x34d483['body'][_0x2bf93b(0xf5)]],_0x24e6ea=[_0x34d483[_0x2bf93b(0x1a0)]['production_date_QA']],_0x5c73f7=[_0x34d483['body'][_0x2bf93b(0x19e)]];else var _0x3f4243=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0xe4)]],_0x1e522d=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x192)]],_0x4cb22d=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x1ad)]],_0x539f06=[..._0x34d483[_0x2bf93b(0x1a0)]['product_code_QA']],_0x2e0969=[..._0x34d483['body'][_0x2bf93b(0xcf)]],_0x533445=[..._0x34d483[_0x2bf93b(0x1a0)]['stocks_QA']],_0x4b4b8f=[..._0x34d483['body'][_0x2bf93b(0xdd)]],_0x2c6f05=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x1c7)]],_0x43ee0e=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x18c)]],_0xab927c=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x148)]],_0x3ebaee=[..._0x34d483['body'][_0x2bf93b(0x17c)]],_0x1b5496=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0xf5)]],_0x24e6ea=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x101)]],_0x5c73f7=[..._0x34d483['body'][_0x2bf93b(0x19e)]];const _0x12e832=_0x3f4243[_0x2bf93b(0x194)](_0x3355ad=>{return _0x3355ad={'product_name':_0x3355ad};});_0x1e522d['forEach']((_0x44bbab,_0x3db0af)=>{var _0x5b5657=_0x2bf93b;_0x12e832[_0x3db0af][_0x5b5657(0xe5)]=_0x44bbab;}),_0x4cb22d[_0x2bf93b(0x144)]((_0x4b4fc5,_0x427663)=>{var _0x574ad3=_0x2bf93b;_0x12e832[_0x427663][_0x574ad3(0xb6)]=_0x4b4fc5;}),_0x539f06['forEach']((_0x92a527,_0x55861f)=>{_0x12e832[_0x55861f]['product_code']=_0x92a527;}),_0x2e0969[_0x2bf93b(0x144)]((_0x1514bb,_0x26ba3a)=>{var _0x2d9640=_0x2bf93b;_0x12e832[_0x26ba3a][_0x2d9640(0x115)]=_0x1514bb;}),_0x533445['forEach']((_0x358fb9,_0x445c17)=>{var _0x28ebc2=_0x2bf93b;_0x12e832[_0x445c17][_0x28ebc2(0xec)]=_0x358fb9;}),_0x4b4b8f[_0x2bf93b(0x144)]((_0x8a243,_0x160c9f)=>{_0x12e832[_0x160c9f]['return_qty']=_0x8a243;}),_0x2c6f05[_0x2bf93b(0x144)]((_0x5c0601,_0x250deb)=>{var _0x387a0c=_0x2bf93b;_0x12e832[_0x250deb][_0x387a0c(0x153)]=_0x5c0601;}),_0x43ee0e[_0x2bf93b(0x144)]((_0x30f5e9,_0x4ae8fd)=>{var _0x445856=_0x2bf93b;_0x12e832[_0x4ae8fd][_0x445856(0x15d)]=_0x30f5e9;}),_0xab927c['forEach']((_0x3b3143,_0x58d9c4)=>{var _0x9a88fa=_0x2bf93b;_0x12e832[_0x58d9c4][_0x9a88fa(0x1af)]=_0x3b3143;}),_0x3ebaee['forEach']((_0x5605b4,_0x1ce11c)=>{_0x12e832[_0x1ce11c]['secondary_unit']=_0x5605b4;}),_0x1b5496[_0x2bf93b(0x144)]((_0x250fe8,_0x311676)=>{var _0x2989f5=_0x2bf93b;_0x12e832[_0x311676][_0x2989f5(0x109)]=_0x250fe8;}),_0x24e6ea['forEach']((_0x5509e4,_0x350e6b)=>{var _0xd100a5=_0x2bf93b;_0x12e832[_0x350e6b][_0xd100a5(0xd9)]=_0x5509e4;}),_0x5c73f7[_0x2bf93b(0x144)]((_0x5055f7,_0x45d7ab)=>{var _0x5569c1=_0x2bf93b;_0x12e832[_0x45d7ab][_0x5569c1(0x170)]=_0x5055f7;});const _0x3f027a=await sales_finished[_0x2bf93b(0xf1)]({'invoice':_0xb34b43});_0x3f027a[_0x2bf93b(0x11f)]=_0x2bf93b(0x11c);const _0x3a45bb=await _0x3f027a[_0x2bf93b(0x134)](),_0x13187d=new sales_return_finished({'invoice':_0xb34b43,'customer':_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x1a7)],'date':_0x334634,'warehouse_name':_0x4fdedb,'room':_0x45c07b,'ToWarehouse':_0x12549f,'ToRoom':_0x2e9946,'return_sale_QA':_0x12e832,'note':_0x316e80,'warehouse_cat':_0x2349e5}),_0x187d64=await _0x13187d[_0x2bf93b(0x134)](),_0x5226df=await sales_return_finished[_0x2bf93b(0xf1)]({'invoice':_0xb34b43}),_0xe6e644=await warehouse['findOne']({'name':_0x12549f,'room':_0x2e9946});_0x5226df[_0x2bf93b(0x176)]['forEach'](_0xc49085=>{var _0x3ce64d=_0x2bf93b,_0xafafc=0x0;const _0x2f8c14=_0xe6e644[_0x3ce64d(0x11a)][_0x3ce64d(0x194)](_0x470a98=>{var _0x3428f9=_0x3ce64d;_0x470a98[_0x3428f9(0x17b)]==_0xc49085[_0x3428f9(0x17b)]&&_0x470a98[_0x3428f9(0x170)]==_0xc49085[_0x3428f9(0x170)]&&_0x470a98[_0x3428f9(0xd9)]==_0xc49085[_0x3428f9(0xd9)]&&_0x470a98[_0x3428f9(0x1af)]==_0xc49085[_0x3428f9(0x1af)]&&(_0x470a98[_0x3428f9(0x112)]=parseInt(_0x470a98[_0x3428f9(0x112)])+parseInt(_0xc49085['return_qty']),_0xafafc++);});_0xafafc=='0'&&(_0xe6e644['product_details']=_0xe6e644[_0x3ce64d(0x11a)][_0x3ce64d(0xb3)]({'product_name':_0xc49085[_0x3ce64d(0x17b)],'product_stock':_0xc49085[_0x3ce64d(0xb5)],'primary_code':_0xc49085[_0x3ce64d(0xe5)],'secondary_code':_0xc49085['secondary_code'],'product_code':_0xc49085[_0x3ce64d(0x195)],'batch_code':_0xc49085[_0x3ce64d(0x1af)],'maxPerUnit':_0xc49085['maxPerUnit'],'production_date':_0xc49085['production_date'],'expiry_date':_0xc49085[_0x3ce64d(0x170)],'secondary_unit':_0xc49085[_0x3ce64d(0x1be)],'unit':_0xc49085[_0x3ce64d(0x109)],'maxProducts':_0xc49085[_0x3ce64d(0x15d)],'bay':_0xc49085['bay']}));}),await _0xe6e644['save']();const _0x33633d=new c_payment_data({'invoice':_0xb34b43,'customer':_0x34d483['body']['customer'],'reason':_0x2bf93b(0x1a4)});await _0x33633d[_0x2bf93b(0x134)]();const _0x52e574=await master_shop[_0x2bf93b(0xc7)](),_0x4ffd14=await email_settings[_0x2bf93b(0xf1)](),_0x48b105=await customer['findOne']({'name':_0x34d483['body'][_0x2bf93b(0x1a7)]});_0x52e574[0x0][_0x2bf93b(0x121)]==0x1?(right_currency=_0x52e574[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x52e574[0x0][_0x2bf93b(0xf6)]);var _0x24fb85=_0x3f4243,_0x443885=_0x4b4b8f,_0x30f67d='',_0x563622;for(_0x563622 in _0x24fb85){_0x30f67d+=_0x2bf93b(0x12d)+_0x2bf93b(0x171)+_0x24fb85[_0x563622]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x443885[_0x563622]+_0x2bf93b(0x132)+_0x2bf93b(0x120);}console['log'](_0x2bf93b(0x122),_0x30f67d);let _0x3bfe7a=nodemailer['createTransport']({'service':_0x2bf93b(0x163),'auth':{'user':_0x4ffd14['email'],'pass':_0x4ffd14[_0x2bf93b(0x161)]}}),_0x3d7644={'from':_0x4ffd14[_0x2bf93b(0xfa)],'to':_0x48b105['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x2bf93b(0x146),'path':__dirname+_0x2bf93b(0x1b9)+_0x2bf93b(0xfe)+_0x52e574[0x0]['image'],'cid':_0x2bf93b(0x1ac)}],'html':_0x2bf93b(0x15a)+_0x2bf93b(0x110)+_0x2bf93b(0x11d)+_0x2bf93b(0x14f)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x2bf93b(0x152)+_0x2bf93b(0xd6)+_0x2bf93b(0x14f)+'<h2>\x20'+_0x52e574[0x0][_0x2bf93b(0x13b)]+'\x20</h2>'+'</div>'+_0x2bf93b(0xd6)+_0x2bf93b(0xd1)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0xb34b43+'\x20'+_0x2bf93b(0x154)+_0x2bf93b(0xe0)+_0x334634+'\x20'+_0x2bf93b(0x12c)+'</h5>'+_0x2bf93b(0xd6)+_0x2bf93b(0x114)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x2bf93b(0x1c0)+_0x2bf93b(0x178)+_0x2bf93b(0x17d)+_0x2bf93b(0xd2)+'</tr>'+_0x2bf93b(0xe1)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x30f67d+'\x20'+_0x2bf93b(0x185)+'</table>'+_0x2bf93b(0x14f)+_0x2bf93b(0xe7)+_0x2bf93b(0xf8)+_0x52e574[0x0][_0x2bf93b(0x13b)]+_0x2bf93b(0x136)+_0x2bf93b(0xd6)+'</div>'+_0x2bf93b(0x1ba)};_0x3bfe7a['sendMail'](_0x3d7644,function(_0x4dfd50,_0x22a872){var _0x598b49=_0x2bf93b;_0x4dfd50?(console[_0x598b49(0x11e)](_0x4dfd50),console[_0x598b49(0x11e)](_0x598b49(0xcb))):console[_0x598b49(0x11e)](_0x598b49(0x113));}),_0x34d483[_0x2bf93b(0x16a)](_0x2bf93b(0x1b4),_0x2bf93b(0x116)),_0x4ba184[_0x2bf93b(0x158)]('/all_sales_finished/view');}catch(_0x355af3){_0x4ba184[_0x2bf93b(0x198)](0xc8)['json']({'message1':_0x355af3[_0x2bf93b(0x1a9)]});}else{if(_0x34d483['body'][_0x2bf93b(0x175)]=='GS')try{const {invoice:_0x2d9650,date:_0x1f1878,warehouse_name:_0x38604d,product_name:_0x2862bb,primary_code:_0x13b38c,secondary_code:_0xd7cb39,product_code:_0x4a073a,sales_quantity:_0x3cf50f,stocks:_0x3c2025,return_qty:_0x250ae2,Room_name:_0xb1f12,to_warehouse_name:_0x2e2d8a,to_Room_name:_0x45d4ba,note:_0x1db97d,level:_0x4d867c,isle:_0xc8aaf4,pallet:_0x1188d2,for_categorize:_0x4a6743}=_0x34d483[_0x2bf93b(0x1a0)];if(typeof _0x2862bb==_0x2bf93b(0x190))var _0x3f4243=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x17b)]],_0x1e522d=[_0x34d483[_0x2bf93b(0x1a0)]['primary_code']],_0x4cb22d=[_0x34d483['body'][_0x2bf93b(0xb6)]],_0x539f06=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x195)]],_0x2e0969=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x139)]],_0x4b4b8f=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0xb5)]],_0x5057fb=[_0x34d483['body'][_0x2bf93b(0x165)]],_0x2c6f05=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x153)]],_0x43ee0e=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x15d)]],_0xab927c=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x1af)]],_0x3ebaee=[_0x34d483['body'][_0x2bf93b(0x1be)]],_0x1b5496=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x109)]],_0x24e6ea=[_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0xd9)]],_0x5c73f7=[_0x34d483['body']['expiry_date']];else var _0x3f4243=[..._0x34d483['body'][_0x2bf93b(0x17b)]],_0x1e522d=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0xe5)]],_0x4cb22d=[..._0x34d483[_0x2bf93b(0x1a0)]['secondary_code']],_0x539f06=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x195)]],_0x2e0969=[..._0x34d483['body'][_0x2bf93b(0x139)]],_0x4b4b8f=[..._0x34d483['body']['return_qty']],_0x5057fb=[..._0x34d483['body'][_0x2bf93b(0x165)]],_0x2c6f05=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x153)]],_0x43ee0e=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x15d)]],_0xab927c=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x1af)]],_0x3ebaee=[..._0x34d483[_0x2bf93b(0x1a0)]['secondary_unit']],_0x1b5496=[..._0x34d483[_0x2bf93b(0x1a0)]['unit']],_0x24e6ea=[..._0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0xd9)]],_0x5c73f7=[..._0x34d483[_0x2bf93b(0x1a0)]['expiry_date']];const _0x48e966=_0x3f4243['map'](_0x335659=>{return _0x335659={'product_name':_0x335659};});_0x1e522d[_0x2bf93b(0x144)]((_0x2b9d0b,_0x1c94ca)=>{var _0x5f1ab0=_0x2bf93b;_0x48e966[_0x1c94ca][_0x5f1ab0(0xe5)]=_0x2b9d0b;}),_0x4cb22d['forEach']((_0x311660,_0x547eed)=>{_0x48e966[_0x547eed]['secondary_code']=_0x311660;}),_0x539f06[_0x2bf93b(0x144)]((_0x411012,_0x38e3e6)=>{var _0x1b1995=_0x2bf93b;_0x48e966[_0x38e3e6][_0x1b1995(0x195)]=_0x411012;}),_0x2e0969['forEach']((_0x4a8617,_0x13b22d)=>{var _0x5e5db5=_0x2bf93b;_0x48e966[_0x13b22d][_0x5e5db5(0x115)]=_0x4a8617;}),_0x4b4b8f[_0x2bf93b(0x144)]((_0x21e746,_0x7283dc)=>{var _0x52821c=_0x2bf93b;_0x48e966[_0x7283dc][_0x52821c(0xb5)]=_0x21e746;}),_0x5057fb['forEach']((_0x7b4f80,_0x579f69)=>{var _0x3dda40=_0x2bf93b;_0x48e966[_0x579f69][_0x3dda40(0x165)]=_0x7b4f80;}),_0x2c6f05['forEach']((_0x12c8e2,_0x23e2d3)=>{var _0x5d496c=_0x2bf93b;_0x48e966[_0x23e2d3][_0x5d496c(0x153)]=_0x12c8e2;}),_0x43ee0e[_0x2bf93b(0x144)]((_0x5c0a6c,_0xb3e466)=>{var _0x506b32=_0x2bf93b;_0x48e966[_0xb3e466][_0x506b32(0x15d)]=_0x5c0a6c;}),_0xab927c[_0x2bf93b(0x144)]((_0x43e2f9,_0x49b8ef)=>{var _0x1d82c5=_0x2bf93b;_0x48e966[_0x49b8ef][_0x1d82c5(0x1af)]=_0x43e2f9;}),_0x3ebaee[_0x2bf93b(0x144)]((_0x2328d5,_0x55c2d4)=>{var _0x2e2c60=_0x2bf93b;_0x48e966[_0x55c2d4][_0x2e2c60(0x1be)]=_0x2328d5;}),_0x1b5496[_0x2bf93b(0x144)]((_0x5f1f19,_0x1df0aa)=>{var _0x3d1e26=_0x2bf93b;_0x48e966[_0x1df0aa][_0x3d1e26(0x109)]=_0x5f1f19;}),_0x24e6ea[_0x2bf93b(0x144)]((_0xd9932b,_0x1ab97d)=>{var _0x23e943=_0x2bf93b;_0x48e966[_0x1ab97d][_0x23e943(0xd9)]=_0xd9932b;}),_0x5c73f7[_0x2bf93b(0x144)]((_0x1b2eb0,_0x287d14)=>{var _0x39cbe4=_0x2bf93b;_0x48e966[_0x287d14][_0x39cbe4(0x170)]=_0x1b2eb0;});var _0x1dad03=0x0;_0x48e966[_0x2bf93b(0x144)](_0x2ee0b5=>{var _0x6dc6e9=_0x2bf93b;(parseInt(_0x2ee0b5['sale_qty'])<parseInt(_0x2ee0b5['return_qty'])||parseInt(_0x2ee0b5[_0x6dc6e9(0xec)])<parseInt(_0x2ee0b5[_0x6dc6e9(0xb5)])&&parseInt(_0x2ee0b5[_0x6dc6e9(0x115)])>parseInt(_0x2ee0b5[_0x6dc6e9(0xb5)])||parseInt(_0x2ee0b5[_0x6dc6e9(0xb5)])==0x0)&&_0x1dad03++;});if(_0x1dad03!=0x0)return _0x34d483[_0x2bf93b(0x16a)](_0x2bf93b(0x184),_0x2bf93b(0x156)),_0x4ba184['redirect']('back');const _0x2b9114=await sales_finished['findOne']({'invoice':_0x2d9650});_0x2b9114[_0x2bf93b(0x11f)]=_0x2bf93b(0x11c);const _0x1f7984=await _0x2b9114[_0x2bf93b(0x134)](),_0xe0af60=new sales_return_finished({'invoice':_0x2d9650,'customer':_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x1a7)],'date':_0x1f1878,'warehouse_name':_0x38604d,'room':_0xb1f12,'ToWarehouse':_0x2e2d8a,'ToRoom':_0x45d4ba,'return_sale':_0x48e966,'note':_0x1db97d,'warehouse_cat':_0x4a6743}),_0x35e97a=await _0xe0af60['save'](),_0x329bc4=await sales_return_finished['findOne']({'invoice':_0x2d9650}),_0x57da16=await warehouse['findOne']({'name':_0x2e2d8a,'room':_0x45d4ba,'warehouse_category':_0x2bf93b(0x1c2)});_0x329bc4[_0x2bf93b(0x15b)][_0x2bf93b(0x144)](_0x3aed79=>{var _0x198bd6=_0x2bf93b,_0x3df12a=0x0;const _0x15e587=_0x57da16[_0x198bd6(0x11a)][_0x198bd6(0x194)](_0x9858d0=>{var _0x75942c=_0x198bd6;_0x9858d0[_0x75942c(0x17b)]==_0x3aed79[_0x75942c(0x17b)]&&_0x9858d0[_0x75942c(0x165)]==_0x3aed79[_0x75942c(0x165)]&&_0x9858d0[_0x75942c(0x170)]==_0x3aed79['expiry_date']&&_0x9858d0[_0x75942c(0xd9)]==_0x3aed79[_0x75942c(0xd9)]&&_0x9858d0['batch_code']==_0x3aed79['batch_code']&&(_0x9858d0['product_stock']=parseInt(_0x9858d0[_0x75942c(0x112)])+parseInt(_0x3aed79[_0x75942c(0xb5)]),_0x3df12a++);});_0x3df12a=='0'&&(_0x57da16['product_details']=_0x57da16[_0x198bd6(0x11a)][_0x198bd6(0xb3)]({'product_name':_0x3aed79[_0x198bd6(0x17b)],'product_stock':_0x3aed79[_0x198bd6(0xb5)],'primary_code':_0x3aed79[_0x198bd6(0xe5)],'secondary_code':_0x3aed79[_0x198bd6(0xb6)],'product_code':_0x3aed79[_0x198bd6(0x195)],'bay':_0x3aed79[_0x198bd6(0x165)],'batch_code':_0x3aed79['batch_code'],'maxPerUnit':_0x3aed79['maxPerUnit'],'production_date':_0x3aed79[_0x198bd6(0xd9)],'expiry_date':_0x3aed79[_0x198bd6(0x170)],'secondary_unit':_0x3aed79[_0x198bd6(0x1be)],'unit':_0x3aed79['unit'],'maxProducts':_0x3aed79[_0x198bd6(0x15d)]}));}),await _0x57da16['save'](),console['log'](_0x34d483[_0x2bf93b(0x1a0)]);const _0x41222e=new c_payment_data({'invoice':_0x2d9650,'customer':_0x34d483[_0x2bf93b(0x1a0)][_0x2bf93b(0x1a7)],'reason':_0x2bf93b(0x1a4)});await _0x41222e[_0x2bf93b(0x134)]();const _0xcb788b=await master_shop[_0x2bf93b(0xc7)]();console[_0x2bf93b(0x11e)](_0x2bf93b(0x199),_0xcb788b[0x0]['image']);const _0x16b311=await email_settings['findOne'](),_0x1e89f0=await customer[_0x2bf93b(0xf1)]({'name':_0x34d483[_0x2bf93b(0x1a0)]['customer']});console[_0x2bf93b(0x11e)](_0x2bf93b(0x1b2),_0x1e89f0);_0xcb788b[0x0]['currency_placement']==0x1?(right_currency=_0xcb788b[0x0][_0x2bf93b(0xf6)],left_currency=''):(right_currency='',left_currency=_0xcb788b[0x0][_0x2bf93b(0xf6)]);var _0x24fb85=_0x3f4243,_0x443885=_0x4b4b8f,_0x30f67d='',_0x563622;for(_0x563622 in _0x24fb85){_0x30f67d+=_0x2bf93b(0x12d)+_0x2bf93b(0x171)+_0x24fb85[_0x563622]+_0x2bf93b(0x132)+_0x2bf93b(0x171)+_0x443885[_0x563622]+_0x2bf93b(0x132)+_0x2bf93b(0x120);}console['log']('product_list',_0x30f67d);let _0x39770f=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x16b311[_0x2bf93b(0xfa)],'pass':_0x16b311[_0x2bf93b(0x161)]}}),_0x296de3={'from':_0x16b311[_0x2bf93b(0xfa)],'to':_0x1e89f0[_0x2bf93b(0xfa)],'subject':_0x2bf93b(0xe3),'attachments':[{'filename':_0x2bf93b(0x146),'path':__dirname+_0x2bf93b(0x1b9)+'/upload/'+_0xcb788b[0x0]['image'],'cid':_0x2bf93b(0x1ac)}],'html':_0x2bf93b(0x15a)+_0x2bf93b(0x110)+_0x2bf93b(0x11d)+_0x2bf93b(0x14f)+_0x2bf93b(0x17e)+_0x2bf93b(0x14f)+_0x2bf93b(0x152)+_0x2bf93b(0xd6)+_0x2bf93b(0x14f)+_0x2bf93b(0x177)+_0xcb788b[0x0][_0x2bf93b(0x13b)]+'\x20</h2>'+_0x2bf93b(0xd6)+_0x2bf93b(0xd6)+_0x2bf93b(0xd1)+_0x2bf93b(0x14f)+_0x2bf93b(0x143)+'\x20Order\x20Number\x20:\x20'+_0x2d9650+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2bf93b(0xe0)+_0x1f1878+'\x20'+_0x2bf93b(0x12c)+_0x2bf93b(0x136)+'</div>'+_0x2bf93b(0x114)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x2bf93b(0x1c0)+_0x2bf93b(0x178)+_0x2bf93b(0x17d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x2bf93b(0xe1)+_0x2bf93b(0x131)+'\x20'+_0x30f67d+'\x20'+_0x2bf93b(0x185)+_0x2bf93b(0xde)+'<div>'+_0x2bf93b(0xe7)+_0x2bf93b(0xf8)+_0xcb788b[0x0]['site_title']+_0x2bf93b(0x136)+_0x2bf93b(0xd6)+_0x2bf93b(0xd6)+_0x2bf93b(0x1ba)};_0x39770f[_0x2bf93b(0x1b5)](_0x296de3,function(_0x38c4d3,_0x4d8e51){var _0x5ad929=_0x2bf93b;_0x38c4d3?(console[_0x5ad929(0x11e)](_0x38c4d3),console['log'](_0x5ad929(0xcb))):console[_0x5ad929(0x11e)](_0x5ad929(0x113));}),_0x34d483[_0x2bf93b(0x16a)](_0x2bf93b(0x1b4),'sales\x20item\x20return\x20successfull'),_0x4ba184[_0x2bf93b(0x158)](_0x2bf93b(0xff));}catch(_0x4feebb){console[_0x2bf93b(0x11e)](_0x4feebb),_0x4ba184['status'](0xc8)[_0x2bf93b(0x13f)]({'message1':_0x4feebb[_0x2bf93b(0x1a9)]});}}}),router[a0_0x3a8b9d(0x17a)]('/barcode/:id',auth,async(_0xaf456a,_0x1fb782)=>{var _0x644f12=a0_0x3a8b9d;try{const {username:_0x545b73,email:_0x2451f2,role:_0x50515b}=_0xaf456a['user'],_0x349dd8=_0xaf456a['user'],_0x15be32=await profile[_0x644f12(0xf1)]({'email':_0x349dd8['email']}),_0x4452f9=await master_shop[_0x644f12(0xc7)]();console['log'](_0x644f12(0x14d),_0x4452f9);const _0x2d9fb1=_0xaf456a['params']['id'],_0x1c3ace=await sales[_0x644f12(0x130)](_0x2d9fb1);console[_0x644f12(0x11e)]('barcode\x20user_id',_0x1c3ace);if(_0x4452f9[0x0][_0x644f12(0x196)]=='English\x20(US)')var _0x17cc42=users[_0x644f12(0x16c)];else{if(_0x4452f9[0x0]['language']==_0x644f12(0x129))var _0x17cc42=users[_0x644f12(0x129)];else{if(_0x4452f9[0x0][_0x644f12(0x196)]==_0x644f12(0x1a8))var _0x17cc42=users[_0x644f12(0x1a8)];else{if(_0x4452f9[0x0]['language']==_0x644f12(0xf4))var _0x17cc42=users[_0x644f12(0xf4)];else{if(_0x4452f9[0x0]['language']==_0x644f12(0x12e))var _0x17cc42=users[_0x644f12(0x12e)];else{if(_0x4452f9[0x0][_0x644f12(0x196)]==_0x644f12(0x1c3))var _0x17cc42=users[_0x644f12(0x103)];else{if(_0x4452f9[0x0][_0x644f12(0x196)]==_0x644f12(0x180))var _0x17cc42=users[_0x644f12(0x180)];else{if(_0x4452f9[0x0][_0x644f12(0x196)]==_0x644f12(0x16f))var _0x17cc42=users[_0x644f12(0x181)];}}}}}}}_0x1fb782[_0x644f12(0x118)]('all_sales_barcode',{'success':_0xaf456a['flash'](_0x644f12(0x1b4)),'errors':_0xaf456a[_0x644f12(0x16a)](_0x644f12(0x184)),'role':_0x349dd8,'profile':_0x15be32,'alldata':_0x1c3ace,'master_shop':_0x4452f9,'language':_0x17cc42});}catch(_0x245fc4){console[_0x644f12(0x11e)](_0x245fc4);}}),router[a0_0x3a8b9d(0xbb)]('/barcode_scanner',async(_0x39c135,_0x31519f)=>{var _0x4cce71=a0_0x3a8b9d;const {product_code:_0x64fcab,warehouse_name:_0x5e6af7,rooms_data:_0x536cf3,Roomslist:_0x165de2}=_0x39c135[_0x4cce71(0x1a0)],_0x4532e1=_0x165de2['split'](','),_0xb34a61=[];async function _0x13186c(_0x8406ef){var _0x104f21=_0x4cce71;const _0x364b30=await warehouse[_0x104f21(0x137)]([{'$match':{'name':_0x5e6af7,'room':_0x8406ef}},{'$unwind':_0x104f21(0xee)},{'$match':{'product_details.primary_code':_0x64fcab}},{'$group':{'_id':_0x104f21(0x10c),'name':{'$first':_0x104f21(0xed)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x104f21(0x183)},'secondary_code':{'$first':_0x104f21(0x150)},'product_code':{'$first':_0x104f21(0x102)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x104f21(0x105)},'type':{'$first':_0x104f21(0xc1)},'pallet':{'$first':_0x104f21(0xdf)},'unit':{'$first':_0x104f21(0xdb)},'secondary_unit':{'$first':_0x104f21(0x19d)},'storage':{'$first':_0x104f21(0x172)},'rack':{'$first':_0x104f21(0x133)},'expiry_date':{'$first':_0x104f21(0x126)},'production_date':{'$first':_0x104f21(0xbe)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x104f21(0x147)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x104f21(0x187)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x5c5a50=await warehouse[_0x104f21(0x137)]([{'$match':{'name':_0x5e6af7,'room':_0x8406ef}},{'$unwind':_0x104f21(0xee)},{'$match':{'product_details.secondary_code':_0x64fcab}},{'$group':{'_id':_0x104f21(0x10c),'name':{'$first':_0x104f21(0xed)},'product_stock':{'$first':_0x104f21(0x1ab)},'primary_code':{'$first':_0x104f21(0x183)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x104f21(0x102)},'level':{'$first':_0x104f21(0x117)},'isle':{'$first':_0x104f21(0x105)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x104f21(0xdf)},'unit':{'$first':_0x104f21(0xdb)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x104f21(0x172)},'rack':{'$first':_0x104f21(0x133)},'expiry_date':{'$first':_0x104f21(0x126)},'production_date':{'$first':_0x104f21(0xbe)},'maxPerUnit':{'$first':_0x104f21(0x1a1)},'batch_code':{'$first':_0x104f21(0x147)},'product_cat':{'$first':_0x104f21(0xd0)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x104f21(0x187)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x364b30[_0x104f21(0x108)]>0x0)_0xb34a61['push'](_0x364b30);else _0x5c5a50[_0x104f21(0x108)]>0x0&&_0xb34a61[_0x104f21(0xe2)](_0x5c5a50);}const _0x4066e6=_0x4532e1[_0x4cce71(0x194)](_0x2908f6=>_0x13186c(_0x2908f6));await Promise[_0x4cce71(0xba)](_0x4066e6),_0x31519f[_0x4cce71(0x13f)](_0xb34a61);}),module[a0_0x3a8b9d(0x1a3)]=router;