var a0_0x48eaef=a0_0xd7b7;(function(_0x342ad1,_0xd2a19){var _0x41a731=a0_0xd7b7,_0x4ee874=_0x342ad1();while(!![]){try{var _0x1d3319=-parseInt(_0x41a731(0x1b0))/0x1+-parseInt(_0x41a731(0x1c2))/0x2+parseInt(_0x41a731(0x15e))/0x3*(-parseInt(_0x41a731(0x20e))/0x4)+-parseInt(_0x41a731(0x1e5))/0x5*(parseInt(_0x41a731(0x1da))/0x6)+parseInt(_0x41a731(0x174))/0x7+-parseInt(_0x41a731(0x210))/0x8+-parseInt(_0x41a731(0x13f))/0x9*(-parseInt(_0x41a731(0x195))/0xa);if(_0x1d3319===_0xd2a19)break;else _0x4ee874['push'](_0x4ee874['shift']());}catch(_0x5f24ac){_0x4ee874['push'](_0x4ee874['shift']());}}}(a0_0x4a19,0xa57a3));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x48eaef(0x1f8)),auth=require(a0_0x48eaef(0x209)),nodemailer=require('nodemailer'),users=require(a0_0x48eaef(0x1ac));function a0_0xd7b7(_0x49ac11,_0x350fee){var _0x4a19c3=a0_0x4a19();return a0_0xd7b7=function(_0xd7b72e,_0x318129){_0xd7b72e=_0xd7b72e-0x100;var _0x498f96=_0x4a19c3[_0xd7b72e];return _0x498f96;},a0_0xd7b7(_0x49ac11,_0x350fee);}function a0_0x4a19(){var _0x323686=['$product_details.batch_code','bay','$product_details.product_stock','/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','prod_invoice','site_title','$product_details.floorlevel','$sale_product.quantity','level','<tbody\x20style=\x22text-align:\x20center;\x22>','aggregate','$sale_product','prod_cat','padStart','find','role','getMonth','post','$date','product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','QA\x20Warehouse','received_amount','product_data','user','4850xLUmKF','body','Spanish','json','/view/:id','There\x27s\x20a\x20error\x20in\x20this\x20transaction','product_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','invoice','$product_details.product_code','stocks_QA','$product_details.invoice','error','$product.product_name','primary_code','getFullYear','payment\x20successfull','</tbody>','$finalize','Portuguese\x20(BR)','product_list','secondary_code_QA','/../public','../public/language/languages.json','product_details','$invoice','Quality\x20Inspection','105395hFWeto','Portuguese','master','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','stock','currency_placement','$sale_product.bin','port','concat','carton','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.secondary_unit','maxProducts','<hr\x20class=\x22my-3\x22>','\x20</h2>','logo','date','1416308JBBPUt','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Enclosed','Received\x20Payment\x20For\x20Sale','$sale_product.floorlevel','for_categorize','length','room_name','$product_details','</head><body>','</tr>','</table>','maxProducts_QA','quantity','/view/return_sales/:id','all','$product_details.product_name','$product_details.storage','FGSEmail','customers_docs','secondary_unit','message','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','\x20Order\x20Date\x20:\x20','807114HYzbzX','createTransport','get','product','Hindi','return_sale_QA','</h5>','<h5\x20style=\x22text-align:\x20left;\x22>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$customers_docs','add_sales_finished','5hbMRCs','$note','$return_data','host','findById','product_date','<html><head><title></title>','product_code_QA','Sale\x20Return','primary_code_QA','product_name_QA1','Arabic\x20(ae)','password','Sale\x20Product\x20Mail','secondary_code','/all_sales_finished/view','sales\x20item\x20return\x20successfull','Error\x20Occurs','exports','../models/all_models','return_data','unit_QA','</div>','Arabic','$product','email','$product_details.bay','DRY\x20GOODS','Sales\x20Update\x20successfully','$room','Finished\x20Goods','$name','sale_qty','</td>','False','/give_payment/:id','../middleware/auth','params','$_id','production_date','<h5>','3914596bRnbsR','$product_details.production_date','93080gZoRhT','suppliers','string','$product_details.product_cat','production_date_QA','<tr>','save','maxPerUnit_QA','$product_details.type','all_sales_finished','German','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','/all_sales/view','product_stock','/picking_list/pdf/','\x20Order\x20Number\x20:\x20','warehouse_name','</thead>','$product_details.unit','<div>','/preview/:id','success','abs','language','French','$product_details.expiry_date','batch_code_QA','<!DOCTYPE\x20html>','status','gmail','getDate','$warehouse_name','$product_details.maxPerUnit','Sales\x20Mail','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','edit_sales_finished','<table\x20style=\x22width:\x20100%\x20!important;\x22>','sendMail','/barcode_scanner','back','finalize','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','batch_code','log','maxPerUnit','Sale\x20Return\x20Mail','expiry_date_QA','currency','add\x20post','$product_details.primary_code','staff','adjust_qty','English','$product_details.maxProducts','flash','warehouse','$product_details.rack','_id','</span>','sales_quantity_QA','render','then','edit_sales_finished_view','sales_invoice','return_sale','$sale_product.type','Logo.png','42489lxAEZn','/invoice/:id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/add_sale/product','note','amount','English\x20(US)','customers','return_qty_QA','Return\x20Rooms','/upload/','expiry_date','name','image','sales_quantity','$sale_product.bay','push','<h2>\x20','$product_details._id','redirect','customer_data','slice','Sales\x20Add\x20successfully','stock_data','primary_unit','customer','RoomAssigned','<span\x20style=\x22float:\x20right;\x22>','split','</body></html>','secondary_unit_QA','3IvyJNw','filter','$product_details.secondary_code','True','An\x20error\x20occurred\x20while\x20saving\x20data.','maxperunit','room','errors','sale_product','return_qty','forEach','\x20<>\x20','Sale','OUTF-','unit','Chinese','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','map','/view/add_sales/:id','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','2285234TLONEn','$product_details.bin','<strong>\x20Regards\x20</strong>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Enabled','all_sales_barcode','prod_code'];a0_0x4a19=function(){return _0x323686;};return a0_0x4a19();}router[a0_0x48eaef(0x1dc)](a0_0x48eaef(0x17e),auth,async(_0x531d51,_0x2d83b3)=>{var _0xf076a1=a0_0x48eaef;try{const {username:_0x1b7fcd,email:_0x2f7782,role:_0x155392}=_0x531d51[_0xf076a1(0x194)],_0x1ef4e5=_0x531d51[_0xf076a1(0x194)],_0x32838d=await profile[_0xf076a1(0x1b3)]({'email':_0x1ef4e5[_0xf076a1(0x1fe)]}),_0x279fa8=await master_shop[_0xf076a1(0x18a)]();let _0x385344;if(_0x1ef4e5[_0xf076a1(0x18b)]=='staff'){const _0x5aff83=await staff[_0xf076a1(0x1b3)]({'email':_0x1ef4e5['email']});_0x385344=await sales_finished[_0xf076a1(0x186)]([{'$lookup':{'from':_0xf076a1(0x146),'localField':_0xf076a1(0x158),'foreignField':_0xf076a1(0x14b),'as':_0xf076a1(0x1d5)}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':_0xf076a1(0x20b),'invoice':{'$first':_0xf076a1(0x1ae)},'customers':{'$first':'$customer'},'date':{'$first':_0xf076a1(0x18e)},'warehouse_name':{'$first':_0xf076a1(0x11a)},'sale_product':{'$push':_0xf076a1(0x187)},'note':{'$first':_0xf076a1(0x1e6)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0xf076a1(0x1e3)},'total_saleproduct_quantity':{'$sum':_0xf076a1(0x183)},'level':{'$addToSet':_0xf076a1(0x14e)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0xf076a1(0x13d)},'pallet':{'$addToSet':_0xf076a1(0x1c6)},'finalize':{'$first':_0xf076a1(0x1a7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x385344=await sales_finished[_0xf076a1(0x186)]([{'$lookup':{'from':_0xf076a1(0x146),'localField':_0xf076a1(0x158),'foreignField':_0xf076a1(0x14b),'as':_0xf076a1(0x1d5)}},{'$unwind':_0xf076a1(0x1e3)},{'$unwind':_0xf076a1(0x187)},{'$group':{'_id':_0xf076a1(0x20b),'invoice':{'$first':_0xf076a1(0x1ae)},'customers':{'$first':'$customer'},'date':{'$first':_0xf076a1(0x18e)},'warehouse_name':{'$first':_0xf076a1(0x11a)},'sale_product':{'$push':_0xf076a1(0x187)},'note':{'$first':_0xf076a1(0x1e6)},'return_data':{'$first':_0xf076a1(0x1e7)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0xf076a1(0x183)},'level':{'$addToSet':_0xf076a1(0x14e)},'isle':{'$addToSet':_0xf076a1(0x1b7)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0xf076a1(0x1c6)},'finalize':{'$first':_0xf076a1(0x1a7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x279fa8[0x0][_0xf076a1(0x112)]==_0xf076a1(0x145)){var _0x2ba83f=users['English'];console[_0xf076a1(0x127)](_0x2ba83f);}else{if(_0x279fa8[0x0]['language']=='Hindi')var _0x2ba83f=users[_0xf076a1(0x1de)];else{if(_0x279fa8[0x0]['language']=='German')var _0x2ba83f=users[_0xf076a1(0x105)];else{if(_0x279fa8[0x0][_0xf076a1(0x112)]==_0xf076a1(0x197))var _0x2ba83f=users['Spanish'];else{if(_0x279fa8[0x0][_0xf076a1(0x112)]==_0xf076a1(0x113))var _0x2ba83f=users[_0xf076a1(0x113)];else{if(_0x279fa8[0x0][_0xf076a1(0x112)]==_0xf076a1(0x1a8))var _0x2ba83f=users[_0xf076a1(0x1b1)];else{if(_0x279fa8[0x0][_0xf076a1(0x112)]=='Chinese')var _0x2ba83f=users[_0xf076a1(0x16d)];else{if(_0x279fa8[0x0][_0xf076a1(0x112)]==_0xf076a1(0x1f0))var _0x2ba83f=users[_0xf076a1(0x1fc)];}}}}}}}_0x2d83b3[_0xf076a1(0x138)](_0xf076a1(0x104),{'success':_0x531d51[_0xf076a1(0x132)](_0xf076a1(0x110)),'errors':_0x531d51['flash'](_0xf076a1(0x165)),'sales':_0x385344,'profile':_0x32838d,'role':_0x1ef4e5,'master_shop':_0x279fa8,'language':_0x2ba83f});}catch(_0x2358fe){console[_0xf076a1(0x127)](_0x2358fe);}});async function getRandom8DigitNumber(){var _0x10b833=a0_0x48eaef;const _0x208c91=0x989680,_0x2e24e6=0x5f5e0ff,_0x177fc5=Math['floor'](Math['random']()*(_0x2e24e6-_0x208c91+0x1))+_0x208c91;var _0x55751e;const _0xfd4e0=await sales_finished[_0x10b833(0x1b3)]({'invoice':'OUTF-'+_0x177fc5});return _0xfd4e0&&_0xfd4e0[_0x10b833(0x1c8)]>0x0?_0x55751e=_0x10b833(0x16b)+_0x177fc5:_0x55751e=_0x10b833(0x16b)+_0x177fc5,_0x55751e;}router[a0_0x48eaef(0x1dc)]('/view/add_sales',auth,async(_0x240471,_0x15bbed)=>{var _0x2f0ef0=a0_0x48eaef;try{const {username:_0x1df621,email:_0x214481,role:_0x237b45}=_0x240471[_0x2f0ef0(0x194)],_0x321b8d=_0x240471['user'],_0x2ad1ff=await profile[_0x2f0ef0(0x1b3)]({'email':_0x321b8d[_0x2f0ef0(0x1fe)]}),_0x3a4fa9=await master_shop[_0x2f0ef0(0x18a)](),_0x49cae9=await customer[_0x2f0ef0(0x18a)]({});let _0x39e089;if(_0x321b8d[_0x2f0ef0(0x18b)]==_0x2f0ef0(0x12e)){const _0x4dcff4=await staff[_0x2f0ef0(0x1b3)]({'email':_0x321b8d[_0x2f0ef0(0x1fe)]});_0x39e089=await warehouse[_0x2f0ef0(0x186)]([{'$match':{'status':_0x2f0ef0(0x178),'name':_0x4dcff4[_0x2f0ef0(0x133)],'warehouse_category':_0x2f0ef0(0x203),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x2f0ef0(0x204),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x39e089=await warehouse[_0x2f0ef0(0x186)]([{'$match':{'status':_0x2f0ef0(0x178),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x2f0ef0(0x191)}}},{'$group':{'_id':'$name','name':{'$first':_0x2f0ef0(0x204)}}},{'$sort':{'name':0x1}}]);const _0x307a85=await product[_0x2f0ef0(0x18a)]({});var _0x32ee86=['Ambient',_0x2f0ef0(0x1c4)];const _0x484e8c=await sales_finished[_0x2f0ef0(0x18a)]({}),_0x5042ea=_0x484e8c[_0x2f0ef0(0x1c8)]+0x1,_0x52e0c6=_0x2f0ef0(0x16b)+_0x5042ea['toString']()[_0x2f0ef0(0x189)](0x5,'0');if(_0x3a4fa9[0x0][_0x2f0ef0(0x112)]==_0x2f0ef0(0x145)){var _0x249c14=users[_0x2f0ef0(0x130)];console['log'](_0x249c14);}else{if(_0x3a4fa9[0x0]['language']==_0x2f0ef0(0x1de))var _0x249c14=users[_0x2f0ef0(0x1de)];else{if(_0x3a4fa9[0x0][_0x2f0ef0(0x112)]==_0x2f0ef0(0x105))var _0x249c14=users[_0x2f0ef0(0x105)];else{if(_0x3a4fa9[0x0][_0x2f0ef0(0x112)]==_0x2f0ef0(0x197))var _0x249c14=users[_0x2f0ef0(0x197)];else{if(_0x3a4fa9[0x0]['language']==_0x2f0ef0(0x113))var _0x249c14=users[_0x2f0ef0(0x113)];else{if(_0x3a4fa9[0x0][_0x2f0ef0(0x112)]==_0x2f0ef0(0x1a8))var _0x249c14=users['Portuguese'];else{if(_0x3a4fa9[0x0][_0x2f0ef0(0x112)]=='Chinese')var _0x249c14=users[_0x2f0ef0(0x16d)];else{if(_0x3a4fa9[0x0]['language']=='Arabic\x20(ae)')var _0x249c14=users[_0x2f0ef0(0x1fc)];}}}}}}}const _0x3108c8=getRandom8DigitNumber();_0x3108c8['then'](_0x4a2f4d=>{var _0x13b437=_0x2f0ef0;_0x15bbed[_0x13b437(0x138)](_0x13b437(0x1e4),{'success':_0x240471[_0x13b437(0x132)](_0x13b437(0x110)),'errors':_0x240471[_0x13b437(0x132)]('errors'),'role':_0x321b8d,'profile':_0x2ad1ff,'customer':_0x49cae9,'warehouse':_0x39e089,'product':_0x307a85,'invoice':_0x4a2f4d,'master_shop':_0x3a4fa9,'language':_0x249c14,'rooms_data':_0x32ee86});})['catch'](_0x25b5d9=>{var _0x536fb2=_0x2f0ef0;_0x240471[_0x536fb2(0x132)](_0x536fb2(0x165),_0x536fb2(0x19a)),_0x15bbed['redirect'](_0x536fb2(0x1f4));});}catch(_0x54cbed){console['log'](_0x54cbed);}}),router['get'](a0_0x48eaef(0x171),auth,async(_0x27ad65,_0x48ecd4)=>{var _0x1b13b8=a0_0x48eaef;try{const _0x478943=_0x27ad65[_0x1b13b8(0x20a)]['id'];console['log'](_0x478943);const _0xc4693a=await product['find'](),_0x50cb20=await purchases[_0x1b13b8(0x186)]([{'$match':{'warehouse_name':_0x478943}},{'$unwind':_0x1b13b8(0x1fd)},{'$group':{'_id':_0x1b13b8(0x1a2)}}]);console[_0x1b13b8(0x127)]('purchases_data',_0x50cb20),_0x48ecd4[_0x1b13b8(0x117)](0xc8)[_0x1b13b8(0x198)]({'purchases_data':_0x50cb20,'product_data':_0xc4693a});}catch(_0x3bacfe){console[_0x1b13b8(0x127)](_0x3bacfe);}}),router[a0_0x48eaef(0x18d)](a0_0x48eaef(0x142),auth,async(_0x2fda5e,_0x335456)=>{var _0x5ba912=a0_0x48eaef;try{const {warehouse_data:_0x4fd024,product_data:_0xc4509}=_0x2fda5e[_0x5ba912(0x196)];console[_0x5ba912(0x127)](_0x2fda5e[_0x5ba912(0x196)][_0x5ba912(0x193)]);;const _0x5186aa=await master_shop['find']();console[_0x5ba912(0x127)](_0x5ba912(0x1b2),_0x5186aa);const _0x12db0a=await product[_0x5ba912(0x1b3)]({'name':_0xc4509});console[_0x5ba912(0x127)](_0x5ba912(0x1dd),_0x12db0a);const _0x587f48=await warehouse[_0x5ba912(0x186)]([{'$match':{'name':_0x4fd024}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0xc4509}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x5ba912(0x17d)}}}]);console[_0x5ba912(0x127)](_0x5ba912(0x156),_0x587f48),_0x335456['status'](0xc8)['json']({'master':_0x5186aa,'new_product':_0x12db0a,'stock_data':_0x587f48});}catch(_0x518db9){console[_0x5ba912(0x127)](_0x518db9);}}),router[a0_0x48eaef(0x18d)]('/view/add_sales',auth,async(_0x50fbea,_0x15237e)=>{var _0x806cf4=a0_0x48eaef;try{const {invoice:_0x1c9ecb,date:_0x2db384,warehouse_name:_0x26a90f,product_name:_0x4e3712,stock:_0x391839,quantity:_0x220639,note:_0x2f2939,room:_0x1d0ee0,primary_code:_0x466750,secondary_code:_0x68e391,prod_code:_0x1f3902,level:_0x43b7c2,isle:_0x3171cc,pallet:_0x45cca,batch_code:_0x4ff1b5,SCRN:_0x24c640,expiry_date:_0x49cb04,mode_transpo:_0xccc0eb,name_driver:_0x19b5f2}=_0x50fbea[_0x806cf4(0x196)];if(typeof _0x4e3712==_0x806cf4(0x212))var _0x1b0567=[_0x50fbea['body'][_0x806cf4(0x19b)]],_0x588984=[_0x50fbea[_0x806cf4(0x196)]['stock']],_0xf5955a=[_0x50fbea['body'][_0x806cf4(0x1ba)]],_0x387c31=[_0x50fbea[_0x806cf4(0x196)]['primary_code']],_0x5cf462=[_0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x1f3)]],_0xfc2f8f=[_0x50fbea['body'][_0x806cf4(0x17a)]],_0x1d0f0f=[_0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x184)]],_0x227466=[_0x50fbea[_0x806cf4(0x196)]['primary_unit']],_0x1aff8b=[_0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x1d6)]],_0x359574=[_0x50fbea['body']['batch_code']],_0x42bafe=[_0x50fbea['body']['expiry_date']],_0x996e3=[_0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x1ea)]],_0xd041ee=[_0x50fbea[_0x806cf4(0x196)]['max_per_unit']],_0x1b68ad=[_0x50fbea[_0x806cf4(0x196)]['prod_cat']],_0x166861=[_0x50fbea['body']['RoomAssigned']],_0x43de49=[_0x50fbea['body'][_0x806cf4(0x180)]];else var _0x1b0567=[..._0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x19b)]],_0x588984=[..._0x50fbea[_0x806cf4(0x196)]['stock']],_0xf5955a=[..._0x50fbea[_0x806cf4(0x196)]['carton']],_0x387c31=[..._0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x1a3)]],_0x5cf462=[..._0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x1f3)]],_0xfc2f8f=[..._0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x17a)]],_0x1d0f0f=[..._0x50fbea['body']['level']],_0x227466=[..._0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x157)]],_0x1aff8b=[..._0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x1d6)]],_0x359574=[..._0x50fbea[_0x806cf4(0x196)]['batch_code']],_0x42bafe=[..._0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x14a)]],_0x996e3=[..._0x50fbea[_0x806cf4(0x196)]['product_date']],_0xd041ee=[..._0x50fbea['body']['max_per_unit']],_0x1b68ad=[..._0x50fbea['body'][_0x806cf4(0x188)]],_0x166861=[..._0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x159)]],_0x43de49=[..._0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x180)]];const _0x2fa1c7=_0x1b0567[_0x806cf4(0x170)](_0x5e14dc=>{return _0x5e14dc={'product_name':_0x5e14dc};});_0x588984[_0x806cf4(0x168)]((_0x37e87d,_0x518da9)=>{var _0x5bf406=_0x806cf4;_0x2fa1c7[_0x518da9][_0x5bf406(0x1b5)]=_0x37e87d;}),_0xf5955a[_0x806cf4(0x168)]((_0x1fce4d,_0x290e22)=>{_0x2fa1c7[_0x290e22]['quantity']=Math['abs'](_0x1fce4d);}),_0x387c31[_0x806cf4(0x168)]((_0x369fd9,_0x590b56)=>{var _0x56d4bf=_0x806cf4;_0x2fa1c7[_0x590b56][_0x56d4bf(0x1a3)]=_0x369fd9;}),_0x5cf462[_0x806cf4(0x168)]((_0x1f6089,_0x17c41a)=>{var _0x412430=_0x806cf4;_0x2fa1c7[_0x17c41a][_0x412430(0x1f3)]=_0x1f6089;}),_0xfc2f8f[_0x806cf4(0x168)]((_0x5f50dc,_0x5490e4)=>{_0x2fa1c7[_0x5490e4]['product_code']=_0x5f50dc;}),_0x1d0f0f[_0x806cf4(0x168)]((_0x4b7d2d,_0x4681c5)=>{var _0x257d73=_0x806cf4;_0x2fa1c7[_0x4681c5][_0x257d73(0x17c)]=_0x4b7d2d;}),_0x227466[_0x806cf4(0x168)]((_0x1fedba,_0x11968e)=>{_0x2fa1c7[_0x11968e]['unit']=_0x1fedba;}),_0x1aff8b[_0x806cf4(0x168)]((_0x1231b6,_0x1473f5)=>{_0x2fa1c7[_0x1473f5]['secondary_unit']=_0x1231b6;}),_0x359574[_0x806cf4(0x168)]((_0x38ddd5,_0x59be52)=>{var _0x4826e4=_0x806cf4;_0x2fa1c7[_0x59be52][_0x4826e4(0x126)]=_0x38ddd5;}),_0x42bafe[_0x806cf4(0x168)]((_0x1f68cd,_0x1767a2)=>{_0x2fa1c7[_0x1767a2]['expiry_date']=_0x1f68cd;}),_0x996e3[_0x806cf4(0x168)]((_0x10715,_0x10fcfd)=>{var _0x177561=_0x806cf4;_0x2fa1c7[_0x10fcfd][_0x177561(0x20c)]=_0x10715;}),_0xd041ee[_0x806cf4(0x168)]((_0x4ba8c6,_0x8054e3)=>{var _0x3ea0e2=_0x806cf4;_0x2fa1c7[_0x8054e3][_0x3ea0e2(0x163)]=_0x4ba8c6;}),_0x1b68ad['forEach']((_0x12e8b1,_0x1c4e02)=>{_0x2fa1c7[_0x1c4e02]['prod_cat']=_0x12e8b1;}),_0x166861[_0x806cf4(0x168)]((_0x37a35a,_0x239c1d)=>{_0x2fa1c7[_0x239c1d]['room_name']=_0x37a35a;}),_0x43de49[_0x806cf4(0x168)]((_0x2f12d2,_0x4954f0)=>{var _0x4183a1=_0x806cf4;_0x2fa1c7[_0x4954f0][_0x4183a1(0x19d)]=_0x2f12d2;});var _0x4fd040=0x0;_0x2fa1c7[_0x806cf4(0x168)](_0x535b00=>{var _0x34dac0=_0x806cf4;parseFloat(_0x535b00[_0x34dac0(0x1b5)])<parseFloat(_0x535b00['quantity'])&&parseFloat(_0x535b00['quantity'])>parseFloat(_0x535b00['stock'])&&(console[_0x34dac0(0x127)](_0x535b00['stock']+_0x34dac0(0x169)+_0x535b00[_0x34dac0(0x1cf)]),_0x4fd040++);});if(_0x4fd040!=0x0)return _0x50fbea[_0x806cf4(0x132)](_0x806cf4(0x165),_0x806cf4(0x1d8)),_0x15237e[_0x806cf4(0x152)](_0x806cf4(0x123));const _0x423123=_0x2fa1c7[_0x806cf4(0x15f)](_0x16a208=>_0x16a208[_0x806cf4(0x1cf)]!=='0'&&_0x16a208[_0x806cf4(0x1cf)]!==''),_0x1510c3=new sales_finished({'invoice':_0x1c9ecb,'customer':_0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x158)],'date':_0x2db384,'warehouse_name':_0x26a90f,'sale_product':_0x423123,'note':_0x2f2939,'room':_0x1d0ee0,'primary_code':_0x466750,'secondary_code':_0x68e391,'prod_code':_0x1f3902,'SCRN':_0x24c640,'finalize':_0x806cf4(0x207),'mode_transpo':_0xccc0eb,'name_driver':_0x19b5f2}),_0x468dd9=await _0x1510c3['save'](),_0x30e705=await sales_finished[_0x806cf4(0x1b3)]({'invoice':_0x1c9ecb}),_0x23fe4d=new c_payment_data({'invoice':_0x1c9ecb,'customer':_0x50fbea[_0x806cf4(0x196)][_0x806cf4(0x158)],'reason':_0x806cf4(0x16a)});await _0x23fe4d['save']();const _0x1eed4c=await master_shop[_0x806cf4(0x18a)](),_0x1ef16e=await email_settings[_0x806cf4(0x1b3)](),_0x2fbc80=await customer['findOne']({'name':_0x50fbea[_0x806cf4(0x196)]['customer']});_0x1eed4c[0x0][_0x806cf4(0x1b6)]==0x1?(right_currency=_0x1eed4c[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1eed4c[0x0][_0x806cf4(0x12b)]);var _0x38e0a6=_0x1b0567,_0x42b2ef=_0xf5955a,_0x6bdc5e='',_0x5ad113;for(_0x5ad113 in _0x38e0a6){_0x6bdc5e+=_0x806cf4(0x100)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x38e0a6[_0x5ad113]+_0x806cf4(0x206)+_0x806cf4(0x177)+_0x42b2ef[_0x5ad113]+'</td>'+_0x806cf4(0x1cc);}console[_0x806cf4(0x127)](_0x806cf4(0x1a9),_0x6bdc5e);let _0x59c2bd=nodemailer[_0x806cf4(0x1db)]({'service':_0x806cf4(0x118),'auth':{'user':_0x1ef16e[_0x806cf4(0x1fe)],'pass':_0x1ef16e[_0x806cf4(0x1f1)]}}),_0x303076={'from':_0x1ef16e[_0x806cf4(0x1fe)],'to':_0x2fbc80[_0x806cf4(0x1fe)],'subject':_0x806cf4(0x1f2),'attachments':[{'filename':_0x806cf4(0x13e),'path':__dirname+_0x806cf4(0x1ab)+_0x806cf4(0x149)+_0x1eed4c[0x0][_0x806cf4(0x14c)],'cid':'logo'}],'html':_0x806cf4(0x116)+_0x806cf4(0x1eb)+_0x806cf4(0x1cb)+'<div>'+_0x806cf4(0x19c)+'<div>'+_0x806cf4(0x141)+_0x806cf4(0x1fb)+_0x806cf4(0x10e)+_0x806cf4(0x150)+_0x1eed4c[0x0]['site_title']+_0x806cf4(0x1bf)+_0x806cf4(0x1fb)+_0x806cf4(0x1fb)+'<hr\x20class=\x22my-3\x22>'+_0x806cf4(0x10e)+_0x806cf4(0x1e1)+_0x806cf4(0x10a)+_0x1c9ecb+'\x20'+_0x806cf4(0x15a)+_0x806cf4(0x1d9)+_0x2db384+'\x20'+'</span>'+'</h5>'+_0x806cf4(0x1fb)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x806cf4(0x100)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x806cf4(0x11e)+'</tr>'+_0x806cf4(0x10c)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x6bdc5e+'\x20'+_0x806cf4(0x1a6)+'</table>'+_0x806cf4(0x10e)+_0x806cf4(0x176)+_0x806cf4(0x20d)+_0x1eed4c[0x0][_0x806cf4(0x181)]+_0x806cf4(0x1e0)+'</div>'+'</div>'+'</body></html>'};_0x59c2bd['sendMail'](_0x303076,function(_0x56905e,_0x3e1825){var _0x4aaf09=_0x806cf4;_0x56905e?(console[_0x4aaf09(0x127)](_0x56905e),console[_0x4aaf09(0x127)](_0x4aaf09(0x1f6))):console[_0x4aaf09(0x127)]('Email\x20sent\x20successfully');}),_0x50fbea[_0x806cf4(0x132)](_0x806cf4(0x110),_0x806cf4(0x155)),_0x15237e[_0x806cf4(0x152)]('/all_sales_finished/preview/'+_0x468dd9[_0x806cf4(0x135)]);}catch(_0x2b2511){console[_0x806cf4(0x127)](_0x2b2511);}}),router[a0_0x48eaef(0x1dc)](a0_0x48eaef(0x10f),auth,async(_0xbec43f,_0x2a9645)=>{var _0x193af7=a0_0x48eaef;try{const {username:_0x48833b,email:_0x479ec2,role:_0x15f783}=_0xbec43f['user'],_0x590251=_0xbec43f[_0x193af7(0x194)],_0x52aba1=await profile[_0x193af7(0x1b3)]({'email':_0x590251[_0x193af7(0x1fe)]}),_0x280a89=await master_shop[_0x193af7(0x18a)](),_0x4a8b55=_0xbec43f[_0x193af7(0x20a)]['id'],_0x165d69=await sales_finished[_0x193af7(0x1e9)](_0x4a8b55),_0x403a8a=await warehouse[_0x193af7(0x186)]([{'$match':{'name':_0x165d69[_0x193af7(0x10b)]}},{'$unwind':_0x193af7(0x1ca)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x193af7(0x1d2)},'product_stock':{'$first':_0x193af7(0x17d)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x193af7(0x103)},'floorlevel':{'$first':_0x193af7(0x182)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x193af7(0x19e)},'storage':{'$first':_0x193af7(0x1d3)},'rack':{'$first':_0x193af7(0x134)},'expiry_date':{'$first':_0x193af7(0x114)},'production_date':{'$first':_0x193af7(0x20f)},'batch_code':{'$first':_0x193af7(0x17b)},'room':{'$first':'$room'}}}]),_0x20b42a=await customer[_0x193af7(0x18a)]({});let _0x56ac36;if(_0x590251[_0x193af7(0x18b)]=='staff'){const _0x4ad42e=await staff[_0x193af7(0x1b3)]({'email':_0x590251[_0x193af7(0x1fe)]});_0x56ac36=await warehouse['aggregate']([{'$match':{'status':_0x193af7(0x178),'name':_0x4ad42e[_0x193af7(0x133)]}},{'$group':{'_id':_0x193af7(0x204),'name':{'$first':'$name'}}}]);}else _0x56ac36=await warehouse[_0x193af7(0x186)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x193af7(0x204)}}}]);const _0x510bd7=await product['find']({});if(_0x280a89[0x0][_0x193af7(0x112)]==_0x193af7(0x145)){var _0x1cee55=users[_0x193af7(0x130)];console[_0x193af7(0x127)](_0x1cee55);}else{if(_0x280a89[0x0][_0x193af7(0x112)]==_0x193af7(0x1de))var _0x1cee55=users[_0x193af7(0x1de)];else{if(_0x280a89[0x0][_0x193af7(0x112)]==_0x193af7(0x105))var _0x1cee55=users[_0x193af7(0x105)];else{if(_0x280a89[0x0][_0x193af7(0x112)]==_0x193af7(0x197))var _0x1cee55=users[_0x193af7(0x197)];else{if(_0x280a89[0x0][_0x193af7(0x112)]==_0x193af7(0x113))var _0x1cee55=users['French'];else{if(_0x280a89[0x0][_0x193af7(0x112)]=='Portuguese\x20(BR)')var _0x1cee55=users[_0x193af7(0x1b1)];else{if(_0x280a89[0x0][_0x193af7(0x112)]=='Chinese')var _0x1cee55=users[_0x193af7(0x16d)];else{if(_0x280a89[0x0][_0x193af7(0x112)]==_0x193af7(0x1f0))var _0x1cee55=users[_0x193af7(0x1fc)];}}}}}}}_0x2a9645[_0x193af7(0x138)](_0x193af7(0x13a),{'success':_0xbec43f[_0x193af7(0x132)](_0x193af7(0x110)),'errors':_0xbec43f['flash']('errors'),'role':_0x590251,'profile':_0x52aba1,'customer':_0x20b42a,'warehouse':_0x56ac36,'product':_0x403a8a,'user':_0x165d69,'master_shop':_0x280a89,'unit':_0x510bd7,'language':_0x1cee55});}catch(_0x344846){console[_0x193af7(0x127)](_0x344846);}}),router[a0_0x48eaef(0x18d)]('/preview/:id',auth,async(_0x826ff2,_0x42f66e)=>{var _0x2f65f8=a0_0x48eaef;try{const _0x2cc39b=_0x826ff2['params']['id'],{invoice:_0x25b6ac,warehouse_name:_0x44c2d0,room:_0x3ee44d}=_0x826ff2[_0x2f65f8(0x196)],_0x18bc1a=await sales_finished['findOne']({'invoice':_0x25b6ac}),_0x3f63fd=_0x18bc1a[_0x2f65f8(0x166)][_0x2f65f8(0x170)](async _0x682ec3=>{var _0x303fcc=_0x2f65f8,_0x4e5298=await warehouse[_0x303fcc(0x1b3)]({'name':_0x44c2d0,'room':_0x682ec3[_0x303fcc(0x1c9)],'warehouse_category':_0x303fcc(0x203)});const _0x306904=_0x4e5298['product_details']['map'](_0x2e4eb8=>{var _0x5d949e=_0x303fcc;_0x2e4eb8['product_name']==_0x682ec3['product_name']&&_0x2e4eb8['bay']==_0x682ec3['bay']&&_0x2e4eb8[_0x5d949e(0x14a)]==_0x682ec3[_0x5d949e(0x14a)]&&_0x2e4eb8['production_date']==_0x682ec3[_0x5d949e(0x20c)]&&_0x2e4eb8[_0x5d949e(0x126)]==_0x682ec3[_0x5d949e(0x126)]&&_0x2e4eb8[_0x5d949e(0x19d)]==_0x682ec3[_0x5d949e(0x19d)]&&(_0x2e4eb8[_0x5d949e(0x108)]=Math[_0x5d949e(0x111)](_0x2e4eb8[_0x5d949e(0x108)])-Math[_0x5d949e(0x111)](_0x682ec3[_0x5d949e(0x1cf)]));});return _0x4e5298;});Promise[_0x2f65f8(0x1d1)](_0x3f63fd)[_0x2f65f8(0x139)](async _0x2bf273=>{var _0x3e9611=_0x2f65f8;try{for(const _0x3b40c9 of _0x2bf273){await _0x3b40c9[_0x3e9611(0x101)]();}_0x18bc1a[_0x3e9611(0x124)]=_0x3e9611(0x161);const _0x22bb73=await _0x18bc1a[_0x3e9611(0x101)](),_0x370c75=await master_shop[_0x3e9611(0x18a)](),_0x36be15=await email_settings[_0x3e9611(0x1b3)](),_0x39d095=await supervisor_settings['find']();var _0x1c4ec1=_0x18bc1a['sale_product'],_0x5930e4='',_0x40a022;for(_0x40a022 in _0x1c4ec1){var _0x4b34d6='FG';_0x18bc1a[_0x3e9611(0x10b)]==_0x3e9611(0x200)&&(_0x4b34d6='DG'),_0x5930e4+=_0x3e9611(0x100)+_0x3e9611(0x177)+_0x1c4ec1[_0x40a022][_0x3e9611(0x19b)]+'</td>'+_0x3e9611(0x177)+_0x1c4ec1[_0x40a022][_0x3e9611(0x18f)]+_0x3e9611(0x206)+_0x3e9611(0x177)+_0x1c4ec1[_0x40a022][_0x3e9611(0x1cf)]+_0x3e9611(0x206)+_0x3e9611(0x177)+_0x1c4ec1[_0x40a022]['unit']+_0x3e9611(0x206)+_0x3e9611(0x177)+_0x1c4ec1[_0x40a022][_0x3e9611(0x1d6)]+_0x3e9611(0x206)+_0x3e9611(0x177)+_0x18bc1a[_0x3e9611(0x10b)]+_0x3e9611(0x206)+_0x3e9611(0x177)+_0x1c4ec1[_0x40a022][_0x3e9611(0x1c9)]+'</td>'+_0x3e9611(0x177)+_0x4b34d6+_0x1c4ec1[_0x40a022][_0x3e9611(0x17c)]+_0x3e9611(0x206);}let _0x4b452b=nodemailer[_0x3e9611(0x1db)]({'host':_0x36be15[_0x3e9611(0x1e8)],'port':Number(_0x36be15[_0x3e9611(0x1b8)]),'secure':![],'auth':{'user':_0x36be15[_0x3e9611(0x1fe)],'pass':_0x36be15[_0x3e9611(0x1f1)]}}),_0x165365={'from':_0x36be15[_0x3e9611(0x1fe)],'to':_0x39d095[0x0][_0x3e9611(0x1d4)],'subject':_0x3e9611(0x11c),'attachments':[{'filename':_0x3e9611(0x13e),'path':__dirname+'/../public'+_0x3e9611(0x149)+_0x370c75[0x0]['image'],'cid':_0x3e9611(0x1c0)}],'html':_0x3e9611(0x116)+_0x3e9611(0x1eb)+_0x3e9611(0x1cb)+_0x3e9611(0x10e)+_0x3e9611(0x19c)+'<div>'+_0x3e9611(0x141)+_0x3e9611(0x1fb)+'<div>'+'<h2>\x20'+_0x370c75[0x0][_0x3e9611(0x181)]+_0x3e9611(0x1bf)+_0x3e9611(0x1fb)+_0x3e9611(0x1fb)+_0x3e9611(0x1be)+'<div>'+_0x3e9611(0x1e1)+_0x3e9611(0x10a)+_0x18bc1a[_0x3e9611(0x19d)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x18bc1a[_0x3e9611(0x1c1)]+'\x20'+_0x3e9611(0x136)+_0x3e9611(0x1e0)+_0x3e9611(0x1fb)+_0x3e9611(0x120)+_0x3e9611(0x125)+_0x3e9611(0x100)+_0x3e9611(0x16f)+_0x3e9611(0x1c3)+_0x3e9611(0x1b4)+_0x3e9611(0x1bb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x3e9611(0x17f)+_0x3e9611(0x173)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3e9611(0x1cc)+_0x3e9611(0x10c)+_0x3e9611(0x185)+'\x20'+_0x5930e4+'\x20'+_0x3e9611(0x1a6)+_0x3e9611(0x1cd)+_0x3e9611(0x10e)+_0x3e9611(0x176)+'<h5>'+_0x370c75[0x0]['site_title']+_0x3e9611(0x1e0)+_0x3e9611(0x1fb)+'</div>'+'</body></html>'};_0x4b452b[_0x3e9611(0x121)](_0x165365,function(_0x1e71f9,_0x2326b1){var _0x3b759c=_0x3e9611;_0x1e71f9?(console[_0x3b759c(0x127)](_0x1e71f9),console['log'](_0x3b759c(0x1f6))):console[_0x3b759c(0x127)](_0x3b759c(0x172));}),_0x826ff2[_0x3e9611(0x132)](_0x3e9611(0x110),_0x3e9611(0x201)),_0x42f66e[_0x3e9611(0x152)](_0x3e9611(0x109)+_0x2cc39b);}catch(_0x416548){console[_0x3e9611(0x1a1)](_0x416548),_0x42f66e[_0x3e9611(0x117)](0x1f4)[_0x3e9611(0x198)]({'error':_0x3e9611(0x162)});}})[_0x2f65f8(0x16e)](_0x26c09e=>{var _0x20f641=_0x2f65f8;console[_0x20f641(0x1a1)](_0x26c09e),_0x42f66e[_0x20f641(0x117)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x2abd1c){console['log'](_0x2abd1c);}}),router[a0_0x48eaef(0x1dc)](a0_0x48eaef(0x199),auth,async(_0x509e87,_0x57a123)=>{var _0x48d580=a0_0x48eaef;try{const {username:_0x12d0b9,email:_0x588a69,role:_0x412884}=_0x509e87[_0x48d580(0x194)],_0x736e3d=_0x509e87[_0x48d580(0x194)],_0x45a984=await profile['findOne']({'email':_0x736e3d['email']}),_0xbc91ba=await master_shop[_0x48d580(0x18a)](),_0x1619d1=_0x509e87[_0x48d580(0x20a)]['id'],_0x42fbdf=await sales_finished[_0x48d580(0x1e9)](_0x1619d1);let _0x157e8f=new Date(_0x42fbdf['expiry_date']),_0x1b7db0=('0'+_0x157e8f[_0x48d580(0x119)]())[_0x48d580(0x154)](-0x2),_0x2bd92e=('0'+(_0x157e8f[_0x48d580(0x18c)]()+0x1))['slice'](-0x2),_0x3a9140=_0x157e8f[_0x48d580(0x1a4)](),_0xcb6751=_0x3a9140+'-'+_0x2bd92e+'-'+_0x1b7db0;var _0x435a24=[_0x48d580(0x11d),_0x48d580(0x1c4)];const _0x824c16=await warehouse[_0x48d580(0x186)]([{'$match':{'name':_0x42fbdf[_0x48d580(0x10b)],'room':_0x42fbdf['room']}},{'$unwind':_0x48d580(0x1ca)},{'$group':{'_id':_0x48d580(0x151),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x48d580(0x17d)},'bay':{'$first':_0x48d580(0x1ff)},'bin':{'$first':_0x48d580(0x175)},'type':{'$first':_0x48d580(0x103)},'floorlevel':{'$first':_0x48d580(0x182)},'primary_code':{'$first':_0x48d580(0x12d)},'secondary_code':{'$first':_0x48d580(0x160)},'product_code':{'$first':_0x48d580(0x19e)},'storage':{'$first':_0x48d580(0x1d3)},'rack':{'$first':_0x48d580(0x134)}}}]),_0x4dd6fc=await customer[_0x48d580(0x18a)]({});let _0x41768e;if(_0x736e3d[_0x48d580(0x18b)]=='staff'){const _0x37400e=await staff[_0x48d580(0x1b3)]({'email':_0x736e3d[_0x48d580(0x1fe)]});_0x41768e=await warehouse[_0x48d580(0x186)]([{'$match':{'status':_0x48d580(0x178),'name':_0x37400e[_0x48d580(0x133)]}},{'$group':{'_id':_0x48d580(0x204),'name':{'$first':_0x48d580(0x204)}}}]);}else _0x41768e=await warehouse[_0x48d580(0x186)]([{'$match':{'status':_0x48d580(0x178)}},{'$group':{'_id':_0x48d580(0x204),'name':{'$first':_0x48d580(0x204)}}}]);const _0x29a22b=await product[_0x48d580(0x18a)]({});if(_0xbc91ba[0x0][_0x48d580(0x112)]==_0x48d580(0x145)){var _0x23510c=users[_0x48d580(0x130)];console['log'](_0x23510c);}else{if(_0xbc91ba[0x0][_0x48d580(0x112)]==_0x48d580(0x1de))var _0x23510c=users[_0x48d580(0x1de)];else{if(_0xbc91ba[0x0][_0x48d580(0x112)]==_0x48d580(0x105))var _0x23510c=users[_0x48d580(0x105)];else{if(_0xbc91ba[0x0][_0x48d580(0x112)]==_0x48d580(0x197))var _0x23510c=users[_0x48d580(0x197)];else{if(_0xbc91ba[0x0]['language']==_0x48d580(0x113))var _0x23510c=users[_0x48d580(0x113)];else{if(_0xbc91ba[0x0][_0x48d580(0x112)]=='Portuguese\x20(BR)')var _0x23510c=users[_0x48d580(0x1b1)];else{if(_0xbc91ba[0x0][_0x48d580(0x112)]==_0x48d580(0x16d))var _0x23510c=users[_0x48d580(0x16d)];else{if(_0xbc91ba[0x0]['language']==_0x48d580(0x1f0))var _0x23510c=users['Arabic'];}}}}}}}_0x57a123['render'](_0x48d580(0x11f),{'success':_0x509e87[_0x48d580(0x132)]('success'),'errors':_0x509e87[_0x48d580(0x132)](_0x48d580(0x165)),'role':_0x736e3d,'profile':_0x45a984,'customer':_0x4dd6fc,'warehouse':_0x41768e,'product':_0x824c16,'user':_0x42fbdf,'master_shop':_0xbc91ba,'unit':_0x29a22b,'language':_0x23510c,'rooms_data':_0x435a24,'ed_fullDate':_0xcb6751});}catch(_0x319877){console[_0x48d580(0x127)](_0x319877);}}),router[a0_0x48eaef(0x18d)](a0_0x48eaef(0x199),auth,async(_0x2c41cb,_0x39b706)=>{var _0x21ed10=a0_0x48eaef;try{const _0xebf85b=_0x2c41cb[_0x21ed10(0x20a)]['id'],_0x4e865b=await sales_finished[_0x21ed10(0x1b3)]({'_id':_0x2c41cb[_0x21ed10(0x20a)]['id']}),_0x4dc986=await warehouse[_0x21ed10(0x1b3)]({'name':_0x4e865b[_0x21ed10(0x10b)],'room':_0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x164)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x442ba3,customer:_0x2638fe,date:_0x96f9c2,warehouse_name:_0x5de62e,product_name:_0x1ffb06,stock:_0x1ad453,adjust_qty:_0x499c5f,note:_0x54310b,room:_0x49b7a9,primary_code:_0x1dadce,secondary_code:_0x40f61e,prod_code:_0x125025,level:_0x3f7906,isle:_0x3ce08a,pallet:_0x27d6cd,expiry_date:_0xcd46b8}=_0x2c41cb[_0x21ed10(0x196)];if(typeof _0x1ffb06==_0x21ed10(0x212))var _0x3f7d36=[_0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x19b)]],_0x14c001=[_0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x1b5)]],_0x31404f=[_0x2c41cb['body'][_0x21ed10(0x12f)]],_0x5317f6=[_0x2c41cb['body']['primary_code']],_0x941a8a=[_0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x1f3)]],_0x3eaf4a=[_0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x17a)]],_0x432536=[_0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x184)]],_0x1a3f15=[_0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x14a)]];else var _0x3f7d36=[..._0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x19b)]],_0x14c001=[..._0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x1b5)]],_0x31404f=[..._0x2c41cb[_0x21ed10(0x196)]['adjust_qty']],_0x5317f6=[..._0x2c41cb['body'][_0x21ed10(0x1a3)]],_0x941a8a=[..._0x2c41cb['body'][_0x21ed10(0x1f3)]],_0x3eaf4a=[..._0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x17a)]],_0x432536=[..._0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x184)]],_0x1a3f15=[..._0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x14a)]];const _0x1708bd=_0x3f7d36['map'](_0x1083d4=>{return _0x1083d4={'product_name':_0x1083d4};});_0x14c001['forEach']((_0x1f241e,_0x587974)=>{var _0x25789b=_0x21ed10;_0x1708bd[_0x587974][_0x25789b(0x1b5)]=_0x1f241e;}),_0x31404f['forEach']((_0x484e44,_0x46c87f)=>{_0x1708bd[_0x46c87f]['quantity']=_0x484e44;}),_0x5317f6[_0x21ed10(0x168)]((_0x456ddc,_0xfb62f)=>{_0x1708bd[_0xfb62f]['primary_code']=_0x456ddc;}),_0x941a8a[_0x21ed10(0x168)]((_0x28cb9c,_0x1b80e)=>{var _0xed4dd1=_0x21ed10;_0x1708bd[_0x1b80e][_0xed4dd1(0x1f3)]=_0x28cb9c;}),_0x3eaf4a[_0x21ed10(0x168)]((_0x12f6fd,_0x4ad6ae)=>{var _0x2ac3b8=_0x21ed10;_0x1708bd[_0x4ad6ae][_0x2ac3b8(0x18f)]=_0x12f6fd;}),_0x432536[_0x21ed10(0x168)]((_0x3488d6,_0x53c43b)=>{_0x1708bd[_0x53c43b]['level']=_0x3488d6;}),_0x1a3f15[_0x21ed10(0x168)]((_0x3d52ee,_0x2a3694)=>{var _0x3d40a0=_0x21ed10;_0x1708bd[_0x2a3694][_0x3d40a0(0x14a)]=_0x3d52ee;});var _0x57fd40=0x0;_0x1708bd[_0x21ed10(0x168)](_0x4d2f65=>{var _0x1d9762=_0x21ed10;console[_0x1d9762(0x127)]('foreach\x20newproduct',_0x4d2f65),(parseInt(_0x4d2f65['stock'])<parseInt(_0x4d2f65[_0x1d9762(0x1cf)])||parseInt(_0x4d2f65['quantity'])==0x0)&&_0x57fd40++;});if(_0x57fd40!=0x0)return _0x2c41cb[_0x21ed10(0x132)](_0x21ed10(0x165),_0x21ed10(0x1e2)),_0x39b706['redirect']('back');_0x4e865b['sale_product'][_0x21ed10(0x168)](_0x3a5f1e=>{var _0x29b038=_0x21ed10;const _0xb47708=_0x4dc986[_0x29b038(0x1ad)]['map'](_0x2f0f25=>{var _0x193f24=_0x29b038;_0x2f0f25[_0x193f24(0x19b)]==_0x3a5f1e[_0x193f24(0x19b)]&&_0x2f0f25['bay']==_0x3a5f1e[_0x193f24(0x17c)]&&(_0x2f0f25[_0x193f24(0x108)]=parseInt(_0x2f0f25[_0x193f24(0x108)])+parseInt(_0x3a5f1e[_0x193f24(0x1cf)]));});}),await _0x4dc986[_0x21ed10(0x101)]();const _0x29a4cf=_0x1708bd['filter'](_0x223864=>_0x223864[_0x21ed10(0x1cf)]!=='0'&&_0x223864['quantity']!=='');_0x4e865b[_0x21ed10(0x19d)]=_0x442ba3,_0x4e865b[_0x21ed10(0x158)]=_0x2638fe,_0x4e865b['date']=_0x96f9c2,_0x4e865b[_0x21ed10(0x10b)]=_0x5de62e,_0x4e865b[_0x21ed10(0x166)]=_0x29a4cf,_0x4e865b[_0x21ed10(0x143)]=_0x54310b,_0x4e865b[_0x21ed10(0x164)]=_0x49b7a9;const _0x30a554=await _0x4e865b[_0x21ed10(0x101)](),_0x3b5d70=await sales_finished[_0x21ed10(0x1b3)]({'_id':_0x2c41cb[_0x21ed10(0x20a)]['id']}),_0x3baad9=await warehouse[_0x21ed10(0x1b3)]({'name':_0x5de62e,'room':_0x49b7a9,'warehouse_category':_0x21ed10(0x203)});_0x3b5d70['sale_product']['forEach'](_0x268787=>{var _0x4ee71b=_0x21ed10;const _0x561e96=_0x3baad9[_0x4ee71b(0x1ad)][_0x4ee71b(0x170)](_0x3ea72e=>{var _0x4dff60=_0x4ee71b;_0x3ea72e[_0x4dff60(0x19b)]==_0x268787[_0x4dff60(0x19b)]&&_0x3ea72e[_0x4dff60(0x17c)]==_0x268787[_0x4dff60(0x17c)]&&(_0x3ea72e[_0x4dff60(0x108)]=parseInt(_0x3ea72e[_0x4dff60(0x108)])-parseInt(_0x268787[_0x4dff60(0x1cf)]));});}),console[_0x21ed10(0x127)]('final',_0x3baad9),await _0x3baad9['save']();const _0x1ef57c=await c_payment_data[_0x21ed10(0x1b3)]({'invoice':_0x2c41cb[_0x21ed10(0x196)][_0x21ed10(0x19d)]});_0x1ef57c[_0x21ed10(0x211)]=_0x2c41cb['body'][_0x21ed10(0x211)],await _0x1ef57c['save'](),_0x2c41cb[_0x21ed10(0x132)]('success','Sales\x20Update\x20successfully'),_0x39b706[_0x21ed10(0x152)]('/all_sales_finished/view');}catch(_0x24a0b6){console['log'](_0x24a0b6);}}),router['post'](a0_0x48eaef(0x208),auth,async(_0xa0f0dd,_0x415e14)=>{var _0x758aa=a0_0x48eaef;try{const _0xce3834=_0xa0f0dd[_0x758aa(0x20a)]['id'],{invoice:_0x241448,customer:_0x335842,receivable_amount:_0x1569fa,received_amount:_0x42eb15}=_0xa0f0dd['body'],_0x394b27=await sales['findById'](_0xce3834);console[_0x758aa(0x127)](_0x394b27);var _0x1a9d4d=_0x1569fa-_0x42eb15;console[_0x758aa(0x127)](_0x42eb15),_0x394b27[_0x758aa(0x192)]=parseFloat(_0x42eb15)+parseFloat(_0x394b27[_0x758aa(0x192)]),_0x394b27['due_amount']=_0x1a9d4d,console['log'](_0x394b27);const _0x5a94be=await _0x394b27[_0x758aa(0x101)](),_0x317277=await c_payment_data[_0x758aa(0x1b3)]({'invoice':_0x241448});_0x317277[_0x758aa(0x144)]=_0x1a9d4d,await _0x317277[_0x758aa(0x101)]();let _0x520792=new Date(),_0x32c829=('0'+_0x520792[_0x758aa(0x119)]())['slice'](-0x2),_0x1b7ae4=('0'+(_0x520792['getMonth']()+0x1))[_0x758aa(0x154)](-0x2),_0x44caa4=_0x520792[_0x758aa(0x1a4)](),_0x838e10=_0x44caa4+'-'+_0x1b7ae4+'-'+_0x32c829;const _0x352c0f=new customer_payment({'invoice':_0x241448,'date':_0x44caa4+'-'+_0x1b7ae4+'-'+_0x32c829,'customer':_0x335842,'reason':_0x758aa(0x1c5),'amount':_0x42eb15}),_0x232a2b=await _0x352c0f[_0x758aa(0x101)]();_0xa0f0dd[_0x758aa(0x132)](_0x758aa(0x110),_0x758aa(0x1a5)),_0x415e14['redirect'](_0x758aa(0x107));}catch(_0x4be9d9){console[_0x758aa(0x127)](_0x4be9d9);}}),router[a0_0x48eaef(0x1dc)](a0_0x48eaef(0x140),auth,async(_0x361212,_0x100edf)=>{var _0x326ed0=a0_0x48eaef;try{const {username:_0x38ca0c,email:_0x304f74,role:_0x5444f6}=_0x361212[_0x326ed0(0x194)],_0x2df8fb=_0x361212[_0x326ed0(0x194)],_0x439a15=await profile[_0x326ed0(0x1b3)]({'email':_0x2df8fb[_0x326ed0(0x1fe)]}),_0x1d6db0=await master_shop['find']();console[_0x326ed0(0x127)]('master',_0x1d6db0);const _0x3c299c=_0x361212[_0x326ed0(0x20a)]['id'],_0x49907f=await sales['findById'](_0x3c299c);console['log'](_0x49907f);const _0x54e696=await customer[_0x326ed0(0x1b3)]({'name':_0x49907f['customer']});console[_0x326ed0(0x127)](_0x54e696);if(_0x1d6db0[0x0][_0x326ed0(0x112)]==_0x326ed0(0x145)){var _0x57a8c9=users[_0x326ed0(0x130)];console[_0x326ed0(0x127)](_0x57a8c9);}else{if(_0x1d6db0[0x0]['language']=='Hindi')var _0x57a8c9=users['Hindi'];else{if(_0x1d6db0[0x0]['language']==_0x326ed0(0x105))var _0x57a8c9=users[_0x326ed0(0x105)];else{if(_0x1d6db0[0x0][_0x326ed0(0x112)]=='Spanish')var _0x57a8c9=users[_0x326ed0(0x197)];else{if(_0x1d6db0[0x0][_0x326ed0(0x112)]=='French')var _0x57a8c9=users[_0x326ed0(0x113)];else{if(_0x1d6db0[0x0][_0x326ed0(0x112)]=='Portuguese\x20(BR)')var _0x57a8c9=users[_0x326ed0(0x1b1)];else{if(_0x1d6db0[0x0][_0x326ed0(0x112)]==_0x326ed0(0x16d))var _0x57a8c9=users['Chinese'];else{if(_0x1d6db0[0x0][_0x326ed0(0x112)]==_0x326ed0(0x1f0))var _0x57a8c9=users[_0x326ed0(0x1fc)];}}}}}}}_0x100edf['render'](_0x326ed0(0x13b),{'success':_0x361212[_0x326ed0(0x132)](_0x326ed0(0x110)),'errors':_0x361212[_0x326ed0(0x132)](_0x326ed0(0x165)),'role':_0x2df8fb,'profile':_0x439a15,'master_shop':_0x1d6db0,'customers':_0x54e696,'sales':_0x49907f,'language':_0x57a8c9});}catch(_0x1300d5){console[_0x326ed0(0x127)](_0x1300d5);}}),router[a0_0x48eaef(0x1dc)]('/view/return_sales/:id',auth,async(_0x48b15d,_0x1f9e99)=>{var _0x46d40d=a0_0x48eaef;try{const {username:_0x2dcee7,email:_0x106643,role:_0x47472a}=_0x48b15d['user'],_0x1f1766=_0x48b15d[_0x46d40d(0x194)],_0x4178f1=await profile[_0x46d40d(0x1b3)]({'email':_0x1f1766[_0x46d40d(0x1fe)]}),_0x58b074=await master_shop[_0x46d40d(0x18a)](),_0x1fa7ed=_0x48b15d[_0x46d40d(0x20a)]['id'],_0x5000bb=await sales_finished[_0x46d40d(0x1e9)](_0x1fa7ed),_0x5e5f3c=await warehouse['aggregate']([{'$match':{'name':_0x5000bb['warehouse_name']}},{'$unwind':_0x46d40d(0x1ca)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x46d40d(0x1d2)},'product_stock':{'$first':_0x46d40d(0x17d)},'bay':{'$first':_0x46d40d(0x1ff)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x46d40d(0x103)},'floorlevel':{'$first':_0x46d40d(0x182)},'primary_code':{'$first':_0x46d40d(0x12d)},'secondary_code':{'$first':_0x46d40d(0x160)},'product_code':{'$first':_0x46d40d(0x19e)},'storage':{'$first':_0x46d40d(0x1d3)},'rack':{'$first':_0x46d40d(0x134)},'expiry_date':{'$first':_0x46d40d(0x114)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0x46d40d(0x10d)},'secondary_unit':{'$first':_0x46d40d(0x1bc)},'maxProducts':{'$first':_0x46d40d(0x131)},'batch_code':{'$first':_0x46d40d(0x17b)},'maxPerUnit':{'$first':_0x46d40d(0x11b)}}}]),_0xf301a9=await product[_0x46d40d(0x18a)]({}),_0xd21e52=await warehouse['aggregate']([{'$match':{'status':_0x46d40d(0x178),'warehouse_category':_0x46d40d(0x203),'name':{'$ne':'Return\x20Goods','$ne':_0x46d40d(0x1af)}}},{'$group':{'_id':'$name','name':{'$first':_0x46d40d(0x204)}}},{'$sort':{'name':0x1}}]);var _0x3bde26=[_0x46d40d(0x148)];const _0x1ee03d=await warehouse[_0x46d40d(0x186)]([{'$match':{'status':_0x46d40d(0x178),'name':_0x46d40d(0x1af)}},{'$group':{'_id':_0x46d40d(0x204),'name':{'$first':_0x46d40d(0x204)}}},{'$sort':{'name':0x1}}]);if(_0x58b074[0x0]['language']==_0x46d40d(0x145)){var _0x595b68=users[_0x46d40d(0x130)];console['log'](_0x595b68);}else{if(_0x58b074[0x0][_0x46d40d(0x112)]==_0x46d40d(0x1de))var _0x595b68=users[_0x46d40d(0x1de)];else{if(_0x58b074[0x0]['language']==_0x46d40d(0x105))var _0x595b68=users[_0x46d40d(0x105)];else{if(_0x58b074[0x0][_0x46d40d(0x112)]==_0x46d40d(0x197))var _0x595b68=users[_0x46d40d(0x197)];else{if(_0x58b074[0x0][_0x46d40d(0x112)]==_0x46d40d(0x113))var _0x595b68=users[_0x46d40d(0x113)];else{if(_0x58b074[0x0]['language']==_0x46d40d(0x1a8))var _0x595b68=users[_0x46d40d(0x1b1)];else{if(_0x58b074[0x0]['language']==_0x46d40d(0x16d))var _0x595b68=users[_0x46d40d(0x16d)];else{if(_0x58b074[0x0][_0x46d40d(0x112)]==_0x46d40d(0x1f0))var _0x595b68=users['Arabic'];}}}}}}}_0x1f9e99[_0x46d40d(0x138)]('return_sale_finished',{'success':_0x48b15d[_0x46d40d(0x132)]('success'),'errors':_0x48b15d[_0x46d40d(0x132)]('errors'),'role':_0x1f1766,'profile':_0x4178f1,'user':_0x5000bb,'stock':_0x5e5f3c,'master_shop':_0x58b074,'unit':_0xf301a9,'language':_0x595b68,'warehouses':_0xd21e52,'rooms':_0x3bde26,'warehouse_QA':_0x1ee03d});}catch(_0x30319f){console['log'](_0x30319f),_0x1f9e99[_0x46d40d(0x117)](0xc8)[_0x46d40d(0x198)]({'message':_0x30319f[_0x46d40d(0x1d7)]});}}),router['post'](a0_0x48eaef(0x1d0),auth,async(_0x4ebe3c,_0x19c966)=>{var _0x4dfe20=a0_0x48eaef;if(_0x4ebe3c['body']['for_categorize']=='QA')try{const {invoice:_0x8f7741,date:_0x1b2378,warehouse_name:_0x4d215d,product_name:_0x298068,primary_code:_0x3ff0d5,secondary_code:_0x268071,product_code:_0x158b59,sales_quantity:_0x37a20f,stocks:_0x1628dd,return_qty:_0x120150,Room_name:_0x2246f5,to_warehouse_name_QA:_0x2a8d96,to_Room_name_QA:_0x5e98df,note:_0x51b47c,for_categorize:_0x3831fd,product_name_QA1:_0x4b6a9f}=_0x4ebe3c[_0x4dfe20(0x196)];if(typeof _0x4b6a9f==_0x4dfe20(0x212))var _0x22ac7e=[_0x4ebe3c[_0x4dfe20(0x196)]['product_name_QA1']],_0x6b817e=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1ee)]],_0x5798e8=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1aa)]],_0x5073c8=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1ec)]],_0x51ec65=[_0x4ebe3c[_0x4dfe20(0x196)]['sales_quantity_QA']],_0x4d52d0=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x19f)]],_0x3391f7=[_0x4ebe3c[_0x4dfe20(0x196)]['return_qty_QA']],_0x47967b=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x102)]],_0x1091b9=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1ce)]],_0x4db717=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x115)]],_0x482fa8=[_0x4ebe3c['body']['secondary_unit_QA']],_0x1339bf=[_0x4ebe3c['body'][_0x4dfe20(0x1fa)]],_0x2e39d2=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x214)]],_0x42cac7=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x12a)]];else var _0x22ac7e=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1ef)]],_0x6b817e=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1ee)]],_0x5798e8=[..._0x4ebe3c['body']['secondary_code_QA']],_0x5073c8=[..._0x4ebe3c['body'][_0x4dfe20(0x1ec)]],_0x51ec65=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x137)]],_0x4d52d0=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x19f)]],_0x3391f7=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x147)]],_0x47967b=[..._0x4ebe3c['body']['maxPerUnit_QA']],_0x1091b9=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1ce)]],_0x4db717=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x115)]],_0x482fa8=[..._0x4ebe3c['body'][_0x4dfe20(0x15d)]],_0x1339bf=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1fa)]],_0x2e39d2=[..._0x4ebe3c['body'][_0x4dfe20(0x214)]],_0x42cac7=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x12a)]];const _0x732d55=_0x22ac7e['map'](_0x3d9914=>{return _0x3d9914={'product_name':_0x3d9914};});_0x6b817e['forEach']((_0x2bf32c,_0x3961b0)=>{var _0x26b1e8=_0x4dfe20;_0x732d55[_0x3961b0][_0x26b1e8(0x1a3)]=_0x2bf32c;}),_0x5798e8['forEach']((_0x442b90,_0x197a35)=>{var _0x40a9d5=_0x4dfe20;_0x732d55[_0x197a35][_0x40a9d5(0x1f3)]=_0x442b90;}),_0x5073c8[_0x4dfe20(0x168)]((_0x33c000,_0x5cb4c7)=>{var _0x4d1aa8=_0x4dfe20;_0x732d55[_0x5cb4c7][_0x4d1aa8(0x18f)]=_0x33c000;}),_0x51ec65['forEach']((_0x411b83,_0x4725c0)=>{var _0xcda3ee=_0x4dfe20;_0x732d55[_0x4725c0][_0xcda3ee(0x205)]=_0x411b83;}),_0x4d52d0[_0x4dfe20(0x168)]((_0x3ccbf9,_0x4bb743)=>{var _0x5b599c=_0x4dfe20;_0x732d55[_0x4bb743][_0x5b599c(0x1b5)]=_0x3ccbf9;}),_0x3391f7[_0x4dfe20(0x168)]((_0xf4ace9,_0x236359)=>{var _0x13c0af=_0x4dfe20;_0x732d55[_0x236359][_0x13c0af(0x167)]=_0xf4ace9;}),_0x47967b[_0x4dfe20(0x168)]((_0x41976f,_0x3a50d0)=>{var _0x393a8e=_0x4dfe20;_0x732d55[_0x3a50d0][_0x393a8e(0x128)]=_0x41976f;}),_0x1091b9[_0x4dfe20(0x168)]((_0x2e59c8,_0x292c64)=>{var _0x5f1318=_0x4dfe20;_0x732d55[_0x292c64][_0x5f1318(0x1bd)]=_0x2e59c8;}),_0x4db717[_0x4dfe20(0x168)]((_0x369392,_0x3636c2)=>{var _0x11861e=_0x4dfe20;_0x732d55[_0x3636c2][_0x11861e(0x126)]=_0x369392;}),_0x482fa8[_0x4dfe20(0x168)]((_0x5a682e,_0x2990d3)=>{var _0x3f9fed=_0x4dfe20;_0x732d55[_0x2990d3][_0x3f9fed(0x1d6)]=_0x5a682e;}),_0x1339bf[_0x4dfe20(0x168)]((_0x37b184,_0x5af8eb)=>{var _0x188c5b=_0x4dfe20;_0x732d55[_0x5af8eb][_0x188c5b(0x16c)]=_0x37b184;}),_0x2e39d2['forEach']((_0x587231,_0x15068e)=>{var _0x51f929=_0x4dfe20;_0x732d55[_0x15068e][_0x51f929(0x20c)]=_0x587231;}),_0x42cac7[_0x4dfe20(0x168)]((_0x5587c8,_0x4b745b)=>{var _0x44ff89=_0x4dfe20;_0x732d55[_0x4b745b][_0x44ff89(0x14a)]=_0x5587c8;});const _0xbf1739=await sales_finished[_0x4dfe20(0x1b3)]({'invoice':_0x8f7741});_0xbf1739[_0x4dfe20(0x1f9)]='True';const _0x3afaa3=await _0xbf1739['save'](),_0x8b4264=new sales_return_finished({'invoice':_0x8f7741,'customer':_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x158)],'date':_0x1b2378,'warehouse_name':_0x4d215d,'room':_0x2246f5,'ToWarehouse':_0x2a8d96,'ToRoom':_0x5e98df,'return_sale_QA':_0x732d55,'note':_0x51b47c,'warehouse_cat':_0x3831fd}),_0x212963=await _0x8b4264[_0x4dfe20(0x101)](),_0x5a251b=await sales_return_finished[_0x4dfe20(0x1b3)]({'invoice':_0x8f7741}),_0x338f32=await warehouse['findOne']({'name':_0x2a8d96,'room':_0x5e98df});_0x5a251b[_0x4dfe20(0x1df)][_0x4dfe20(0x168)](_0x3894ae=>{var _0x4aabf5=_0x4dfe20,_0x2399b0=0x0;const _0x4bdfe8=_0x338f32[_0x4aabf5(0x1ad)]['map'](_0x2d2950=>{var _0x34c667=_0x4aabf5;_0x2d2950[_0x34c667(0x19b)]==_0x3894ae[_0x34c667(0x19b)]&&_0x2d2950[_0x34c667(0x14a)]==_0x3894ae[_0x34c667(0x14a)]&&_0x2d2950['production_date']==_0x3894ae[_0x34c667(0x20c)]&&_0x2d2950[_0x34c667(0x126)]==_0x3894ae[_0x34c667(0x126)]&&(_0x2d2950[_0x34c667(0x108)]=parseInt(_0x2d2950[_0x34c667(0x108)])+parseInt(_0x3894ae['return_qty']),_0x2399b0++);});_0x2399b0=='0'&&(_0x338f32[_0x4aabf5(0x1ad)]=_0x338f32[_0x4aabf5(0x1ad)][_0x4aabf5(0x1b9)]({'product_name':_0x3894ae[_0x4aabf5(0x19b)],'product_stock':_0x3894ae[_0x4aabf5(0x167)],'primary_code':_0x3894ae['primary_code'],'secondary_code':_0x3894ae['secondary_code'],'product_code':_0x3894ae[_0x4aabf5(0x18f)],'batch_code':_0x3894ae['batch_code'],'maxPerUnit':_0x3894ae[_0x4aabf5(0x128)],'production_date':_0x3894ae[_0x4aabf5(0x20c)],'expiry_date':_0x3894ae[_0x4aabf5(0x14a)],'secondary_unit':_0x3894ae[_0x4aabf5(0x1d6)],'unit':_0x3894ae[_0x4aabf5(0x16c)],'maxProducts':_0x3894ae['maxProducts'],'bay':_0x3894ae[_0x4aabf5(0x17c)]}));}),await _0x338f32['save']();const _0x5830c2=new c_payment_data({'invoice':_0x8f7741,'customer':_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x158)],'reason':_0x4dfe20(0x1ed)});await _0x5830c2[_0x4dfe20(0x101)]();const _0x1221d8=await master_shop[_0x4dfe20(0x18a)](),_0x1ca1f3=await email_settings[_0x4dfe20(0x1b3)](),_0x4fc0cb=await customer[_0x4dfe20(0x1b3)]({'name':_0x4ebe3c['body'][_0x4dfe20(0x158)]});_0x1221d8[0x0]['currency_placement']==0x1?(right_currency=_0x1221d8[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1221d8[0x0]['currency']);var _0x3de0ef=_0x22ac7e,_0x3c8767=_0x3391f7,_0x370e65='',_0xa4ae88;for(_0xa4ae88 in _0x3de0ef){_0x370e65+=_0x4dfe20(0x100)+_0x4dfe20(0x177)+_0x3de0ef[_0xa4ae88]+'</td>'+_0x4dfe20(0x177)+_0x3c8767[_0xa4ae88]+_0x4dfe20(0x206)+_0x4dfe20(0x1cc);}console[_0x4dfe20(0x127)](_0x4dfe20(0x1a9),_0x370e65);let _0x29b5c3=nodemailer[_0x4dfe20(0x1db)]({'service':_0x4dfe20(0x118),'auth':{'user':_0x1ca1f3[_0x4dfe20(0x1fe)],'pass':_0x1ca1f3[_0x4dfe20(0x1f1)]}}),_0x257841={'from':_0x1ca1f3['email'],'to':_0x4fc0cb[_0x4dfe20(0x1fe)],'subject':_0x4dfe20(0x129),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x4dfe20(0x149)+_0x1221d8[0x0][_0x4dfe20(0x14c)],'cid':_0x4dfe20(0x1c0)}],'html':'<!DOCTYPE\x20html>'+_0x4dfe20(0x1eb)+_0x4dfe20(0x1cb)+_0x4dfe20(0x10e)+_0x4dfe20(0x19c)+_0x4dfe20(0x10e)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4dfe20(0x1fb)+_0x4dfe20(0x10e)+'<h2>\x20'+_0x1221d8[0x0]['site_title']+_0x4dfe20(0x1bf)+_0x4dfe20(0x1fb)+_0x4dfe20(0x1fb)+_0x4dfe20(0x1be)+_0x4dfe20(0x10e)+_0x4dfe20(0x1e1)+_0x4dfe20(0x10a)+_0x8f7741+'\x20'+_0x4dfe20(0x15a)+_0x4dfe20(0x1d9)+_0x1b2378+'\x20'+_0x4dfe20(0x136)+_0x4dfe20(0x1e0)+_0x4dfe20(0x1fb)+_0x4dfe20(0x120)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x4dfe20(0x16f)+_0x4dfe20(0x190)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x4dfe20(0x106)+_0x4dfe20(0x1cc)+_0x4dfe20(0x10c)+_0x4dfe20(0x185)+'\x20'+_0x370e65+'\x20'+_0x4dfe20(0x1a6)+_0x4dfe20(0x1cd)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x4dfe20(0x20d)+_0x1221d8[0x0][_0x4dfe20(0x181)]+_0x4dfe20(0x1e0)+'</div>'+'</div>'+_0x4dfe20(0x15c)};_0x29b5c3[_0x4dfe20(0x121)](_0x257841,function(_0x229003,_0x35cfe4){var _0x3e467b=_0x4dfe20;_0x229003?(console['log'](_0x229003),console[_0x3e467b(0x127)]('Error\x20Occurs')):console['log'](_0x3e467b(0x172));}),_0x4ebe3c[_0x4dfe20(0x132)](_0x4dfe20(0x110),_0x4dfe20(0x1f5)),_0x19c966[_0x4dfe20(0x152)](_0x4dfe20(0x1f4));}catch(_0x2a305d){_0x19c966[_0x4dfe20(0x117)](0xc8)[_0x4dfe20(0x198)]({'message1':_0x2a305d[_0x4dfe20(0x1d7)]});}else{if(_0x4ebe3c['body'][_0x4dfe20(0x1c7)]=='GS')try{const {invoice:_0x2549a1,date:_0xc97644,warehouse_name:_0x6edc69,product_name:_0x1a9928,primary_code:_0x3e9840,secondary_code:_0x560a3f,product_code:_0x517ecf,sales_quantity:_0x242389,stocks:_0x4d9f19,return_qty:_0xbd67ed,Room_name:_0x294e30,to_warehouse_name:_0x563a9a,to_Room_name:_0x4c33ae,note:_0x7e4c88,level:_0x3a9a5e,isle:_0x4450a6,pallet:_0x3b2888,for_categorize:_0x2c6760}=_0x4ebe3c[_0x4dfe20(0x196)];if(typeof _0x1a9928=='string')var _0x22ac7e=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x19b)]],_0x6b817e=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1a3)]],_0x5798e8=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1f3)]],_0x5073c8=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x18f)]],_0x51ec65=[_0x4ebe3c[_0x4dfe20(0x196)]['sales_quantity']],_0x3391f7=[_0x4ebe3c['body'][_0x4dfe20(0x167)]],_0x14260b=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x17c)]],_0x47967b=[_0x4ebe3c['body'][_0x4dfe20(0x128)]],_0x1091b9=[_0x4ebe3c[_0x4dfe20(0x196)]['maxProducts']],_0x4db717=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x126)]],_0x482fa8=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1d6)]],_0x1339bf=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x16c)]],_0x2e39d2=[_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x20c)]],_0x42cac7=[_0x4ebe3c[_0x4dfe20(0x196)]['expiry_date']];else var _0x22ac7e=[..._0x4ebe3c[_0x4dfe20(0x196)]['product_name']],_0x6b817e=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1a3)]],_0x5798e8=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1f3)]],_0x5073c8=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x18f)]],_0x51ec65=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x14d)]],_0x3391f7=[..._0x4ebe3c['body'][_0x4dfe20(0x167)]],_0x14260b=[..._0x4ebe3c['body'][_0x4dfe20(0x17c)]],_0x47967b=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x128)]],_0x1091b9=[..._0x4ebe3c['body'][_0x4dfe20(0x1bd)]],_0x4db717=[..._0x4ebe3c[_0x4dfe20(0x196)]['batch_code']],_0x482fa8=[..._0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x1d6)]],_0x1339bf=[..._0x4ebe3c[_0x4dfe20(0x196)]['unit']],_0x2e39d2=[..._0x4ebe3c['body'][_0x4dfe20(0x20c)]],_0x42cac7=[..._0x4ebe3c[_0x4dfe20(0x196)]['expiry_date']];const _0x3d2642=_0x22ac7e[_0x4dfe20(0x170)](_0x47a094=>{return _0x47a094={'product_name':_0x47a094};});_0x6b817e[_0x4dfe20(0x168)]((_0x94928,_0x153a6d)=>{var _0x2803b6=_0x4dfe20;_0x3d2642[_0x153a6d][_0x2803b6(0x1a3)]=_0x94928;}),_0x5798e8[_0x4dfe20(0x168)]((_0x823f38,_0x107e94)=>{_0x3d2642[_0x107e94]['secondary_code']=_0x823f38;}),_0x5073c8[_0x4dfe20(0x168)]((_0x126a02,_0x3344e4)=>{var _0xa6164=_0x4dfe20;_0x3d2642[_0x3344e4][_0xa6164(0x18f)]=_0x126a02;}),_0x51ec65['forEach']((_0x2fd158,_0x3909ca)=>{_0x3d2642[_0x3909ca]['sale_qty']=_0x2fd158;}),_0x3391f7[_0x4dfe20(0x168)]((_0x2129b5,_0x35b0c6)=>{var _0xb633c2=_0x4dfe20;_0x3d2642[_0x35b0c6][_0xb633c2(0x167)]=_0x2129b5;}),_0x14260b['forEach']((_0x546392,_0x548302)=>{var _0x1ede4c=_0x4dfe20;_0x3d2642[_0x548302][_0x1ede4c(0x17c)]=_0x546392;}),_0x47967b[_0x4dfe20(0x168)]((_0x47c08b,_0x17e19f)=>{_0x3d2642[_0x17e19f]['maxPerUnit']=_0x47c08b;}),_0x1091b9['forEach']((_0x3863b2,_0x159fed)=>{var _0x18e3fa=_0x4dfe20;_0x3d2642[_0x159fed][_0x18e3fa(0x1bd)]=_0x3863b2;}),_0x4db717[_0x4dfe20(0x168)]((_0x41073f,_0x2b1c30)=>{var _0x414cb9=_0x4dfe20;_0x3d2642[_0x2b1c30][_0x414cb9(0x126)]=_0x41073f;}),_0x482fa8[_0x4dfe20(0x168)]((_0xa1aa7a,_0x5b5d0b)=>{_0x3d2642[_0x5b5d0b]['secondary_unit']=_0xa1aa7a;}),_0x1339bf[_0x4dfe20(0x168)]((_0x81b0ce,_0x4d3b02)=>{var _0x337d64=_0x4dfe20;_0x3d2642[_0x4d3b02][_0x337d64(0x16c)]=_0x81b0ce;}),_0x2e39d2[_0x4dfe20(0x168)]((_0x1eeee0,_0xbfdb32)=>{var _0x1ffcc7=_0x4dfe20;_0x3d2642[_0xbfdb32][_0x1ffcc7(0x20c)]=_0x1eeee0;}),_0x42cac7[_0x4dfe20(0x168)]((_0x36499e,_0x5099a7)=>{var _0x32e4fd=_0x4dfe20;_0x3d2642[_0x5099a7][_0x32e4fd(0x14a)]=_0x36499e;});var _0x23014a=0x0;_0x3d2642[_0x4dfe20(0x168)](_0x7db75e=>{var _0x43e488=_0x4dfe20;(parseInt(_0x7db75e[_0x43e488(0x205)])<parseInt(_0x7db75e[_0x43e488(0x167)])||parseInt(_0x7db75e[_0x43e488(0x1b5)])<parseInt(_0x7db75e[_0x43e488(0x167)])&&parseInt(_0x7db75e[_0x43e488(0x205)])>parseInt(_0x7db75e[_0x43e488(0x167)])||parseInt(_0x7db75e[_0x43e488(0x167)])==0x0)&&_0x23014a++;});if(_0x23014a!=0x0)return _0x4ebe3c['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x19c966[_0x4dfe20(0x152)](_0x4dfe20(0x123));const _0x58faf0=await sales_finished['findOne']({'invoice':_0x2549a1});_0x58faf0['return_data']=_0x4dfe20(0x161);const _0x2ca6c1=await _0x58faf0[_0x4dfe20(0x101)](),_0x260fcf=new sales_return_finished({'invoice':_0x2549a1,'customer':_0x4ebe3c[_0x4dfe20(0x196)]['customer'],'date':_0xc97644,'warehouse_name':_0x6edc69,'room':_0x294e30,'ToWarehouse':_0x563a9a,'ToRoom':_0x4c33ae,'return_sale':_0x3d2642,'note':_0x7e4c88,'warehouse_cat':_0x2c6760}),_0x270e62=await _0x260fcf['save'](),_0x58b32e=await sales_return_finished['findOne']({'invoice':_0x2549a1}),_0x531986=await warehouse['findOne']({'name':_0x563a9a,'room':_0x4c33ae,'warehouse_category':_0x4dfe20(0x203)});_0x58b32e[_0x4dfe20(0x13c)][_0x4dfe20(0x168)](_0x1e86df=>{var _0x10fca2=_0x4dfe20,_0x15dc61=0x0;const _0x11e3ae=_0x531986[_0x10fca2(0x1ad)][_0x10fca2(0x170)](_0x26bd29=>{var _0xae0bc5=_0x10fca2;_0x26bd29[_0xae0bc5(0x19b)]==_0x1e86df[_0xae0bc5(0x19b)]&&_0x26bd29[_0xae0bc5(0x17c)]==_0x1e86df[_0xae0bc5(0x17c)]&&_0x26bd29[_0xae0bc5(0x14a)]==_0x1e86df[_0xae0bc5(0x14a)]&&_0x26bd29['production_date']==_0x1e86df[_0xae0bc5(0x20c)]&&_0x26bd29['batch_code']==_0x1e86df[_0xae0bc5(0x126)]&&(_0x26bd29['product_stock']=parseInt(_0x26bd29[_0xae0bc5(0x108)])+parseInt(_0x1e86df[_0xae0bc5(0x167)]),_0x15dc61++);});_0x15dc61=='0'&&(_0x531986[_0x10fca2(0x1ad)]=_0x531986[_0x10fca2(0x1ad)][_0x10fca2(0x1b9)]({'product_name':_0x1e86df['product_name'],'product_stock':_0x1e86df[_0x10fca2(0x167)],'primary_code':_0x1e86df[_0x10fca2(0x1a3)],'secondary_code':_0x1e86df[_0x10fca2(0x1f3)],'product_code':_0x1e86df[_0x10fca2(0x18f)],'bay':_0x1e86df[_0x10fca2(0x17c)],'batch_code':_0x1e86df[_0x10fca2(0x126)],'maxPerUnit':_0x1e86df[_0x10fca2(0x128)],'production_date':_0x1e86df[_0x10fca2(0x20c)],'expiry_date':_0x1e86df[_0x10fca2(0x14a)],'secondary_unit':_0x1e86df[_0x10fca2(0x1d6)],'unit':_0x1e86df['unit'],'maxProducts':_0x1e86df['maxProducts']}));}),await _0x531986[_0x4dfe20(0x101)](),console['log'](_0x4ebe3c[_0x4dfe20(0x196)]);const _0x268bf6=new c_payment_data({'invoice':_0x2549a1,'customer':_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x158)],'reason':_0x4dfe20(0x1ed)});await _0x268bf6['save']();const _0x40a65b=await master_shop[_0x4dfe20(0x18a)]();console[_0x4dfe20(0x127)](_0x4dfe20(0x12c),_0x40a65b[0x0][_0x4dfe20(0x14c)]);const _0x3da60f=await email_settings['findOne'](),_0x490016=await customer[_0x4dfe20(0x1b3)]({'name':_0x4ebe3c[_0x4dfe20(0x196)][_0x4dfe20(0x158)]});console[_0x4dfe20(0x127)](_0x4dfe20(0x153),_0x490016);_0x40a65b[0x0]['currency_placement']==0x1?(right_currency=_0x40a65b[0x0][_0x4dfe20(0x12b)],left_currency=''):(right_currency='',left_currency=_0x40a65b[0x0][_0x4dfe20(0x12b)]);var _0x3de0ef=_0x22ac7e,_0x3c8767=_0x3391f7,_0x370e65='',_0xa4ae88;for(_0xa4ae88 in _0x3de0ef){_0x370e65+=_0x4dfe20(0x100)+_0x4dfe20(0x177)+_0x3de0ef[_0xa4ae88]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3c8767[_0xa4ae88]+_0x4dfe20(0x206)+_0x4dfe20(0x1cc);}console[_0x4dfe20(0x127)](_0x4dfe20(0x1a9),_0x370e65);let _0x291ac4=nodemailer[_0x4dfe20(0x1db)]({'service':_0x4dfe20(0x118),'auth':{'user':_0x3da60f[_0x4dfe20(0x1fe)],'pass':_0x3da60f[_0x4dfe20(0x1f1)]}}),_0x3dd2a5={'from':_0x3da60f[_0x4dfe20(0x1fe)],'to':_0x490016['email'],'subject':_0x4dfe20(0x129),'attachments':[{'filename':_0x4dfe20(0x13e),'path':__dirname+_0x4dfe20(0x1ab)+_0x4dfe20(0x149)+_0x40a65b[0x0][_0x4dfe20(0x14c)],'cid':_0x4dfe20(0x1c0)}],'html':_0x4dfe20(0x116)+_0x4dfe20(0x1eb)+'</head><body>'+'<div>'+_0x4dfe20(0x19c)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x4dfe20(0x10e)+_0x4dfe20(0x150)+_0x40a65b[0x0][_0x4dfe20(0x181)]+_0x4dfe20(0x1bf)+_0x4dfe20(0x1fb)+_0x4dfe20(0x1fb)+_0x4dfe20(0x1be)+'<div>'+_0x4dfe20(0x1e1)+_0x4dfe20(0x10a)+_0x2549a1+'\x20'+_0x4dfe20(0x15a)+'\x20Order\x20Date\x20:\x20'+_0xc97644+'\x20'+_0x4dfe20(0x136)+_0x4dfe20(0x1e0)+_0x4dfe20(0x1fb)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4dfe20(0x125)+_0x4dfe20(0x100)+_0x4dfe20(0x16f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x4dfe20(0x106)+'</tr>'+'</thead>'+_0x4dfe20(0x185)+'\x20'+_0x370e65+'\x20'+_0x4dfe20(0x1a6)+_0x4dfe20(0x1cd)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x4dfe20(0x20d)+_0x40a65b[0x0][_0x4dfe20(0x181)]+_0x4dfe20(0x1e0)+'</div>'+_0x4dfe20(0x1fb)+_0x4dfe20(0x15c)};_0x291ac4[_0x4dfe20(0x121)](_0x3dd2a5,function(_0x26b526,_0x735b06){var _0x5efef2=_0x4dfe20;_0x26b526?(console[_0x5efef2(0x127)](_0x26b526),console[_0x5efef2(0x127)](_0x5efef2(0x1f6))):console[_0x5efef2(0x127)](_0x5efef2(0x172));}),_0x4ebe3c[_0x4dfe20(0x132)](_0x4dfe20(0x110),_0x4dfe20(0x1f5)),_0x19c966[_0x4dfe20(0x152)](_0x4dfe20(0x1f4));}catch(_0x412264){console[_0x4dfe20(0x127)](_0x412264),_0x19c966[_0x4dfe20(0x117)](0xc8)[_0x4dfe20(0x198)]({'message1':_0x412264['message']});}}}),router['get']('/barcode/:id',auth,async(_0x6013e2,_0x4c1f8d)=>{var _0x3609d6=a0_0x48eaef;try{const {username:_0x180874,email:_0x4f4235,role:_0x6c3c0b}=_0x6013e2[_0x3609d6(0x194)],_0x44884d=_0x6013e2[_0x3609d6(0x194)],_0x5d77ac=await profile['findOne']({'email':_0x44884d[_0x3609d6(0x1fe)]}),_0x511bb9=await master_shop['find']();console['log']('barcode\x20Product\x20master',_0x511bb9);const _0x1f48f1=_0x6013e2[_0x3609d6(0x20a)]['id'],_0xf8e1ac=await sales['findById'](_0x1f48f1);console[_0x3609d6(0x127)]('barcode\x20user_id',_0xf8e1ac);if(_0x511bb9[0x0][_0x3609d6(0x112)]==_0x3609d6(0x145))var _0x5ddc6d=users['English'];else{if(_0x511bb9[0x0][_0x3609d6(0x112)]==_0x3609d6(0x1de))var _0x5ddc6d=users[_0x3609d6(0x1de)];else{if(_0x511bb9[0x0][_0x3609d6(0x112)]==_0x3609d6(0x105))var _0x5ddc6d=users[_0x3609d6(0x105)];else{if(_0x511bb9[0x0][_0x3609d6(0x112)]==_0x3609d6(0x197))var _0x5ddc6d=users[_0x3609d6(0x197)];else{if(_0x511bb9[0x0][_0x3609d6(0x112)]==_0x3609d6(0x113))var _0x5ddc6d=users['French'];else{if(_0x511bb9[0x0][_0x3609d6(0x112)]=='Portuguese\x20(BR)')var _0x5ddc6d=users['Portuguese'];else{if(_0x511bb9[0x0][_0x3609d6(0x112)]==_0x3609d6(0x16d))var _0x5ddc6d=users[_0x3609d6(0x16d)];else{if(_0x511bb9[0x0][_0x3609d6(0x112)]==_0x3609d6(0x1f0))var _0x5ddc6d=users[_0x3609d6(0x1fc)];}}}}}}}_0x4c1f8d[_0x3609d6(0x138)](_0x3609d6(0x179),{'success':_0x6013e2[_0x3609d6(0x132)](_0x3609d6(0x110)),'errors':_0x6013e2[_0x3609d6(0x132)](_0x3609d6(0x165)),'role':_0x44884d,'profile':_0x5d77ac,'alldata':_0xf8e1ac,'master_shop':_0x511bb9,'language':_0x5ddc6d});}catch(_0x4798e8){console[_0x3609d6(0x127)](_0x4798e8);}}),router['post'](a0_0x48eaef(0x122),async(_0x1599c4,_0x119ebf)=>{var _0x557190=a0_0x48eaef;const {product_code:_0xea1c92,warehouse_name:_0x450d0b,rooms_data:_0x56b07a,Roomslist:_0x34d77d}=_0x1599c4['body'],_0x42f9a9=_0x34d77d[_0x557190(0x15b)](','),_0x23ce8e=[];async function _0x3710ee(_0x4015a7){var _0x3dffff=_0x557190;const _0x5125fb=await warehouse[_0x3dffff(0x186)]([{'$match':{'name':_0x450d0b,'room':_0x4015a7}},{'$unwind':_0x3dffff(0x1ca)},{'$match':{'product_details.primary_code':_0xea1c92}},{'$group':{'_id':_0x3dffff(0x151),'name':{'$first':_0x3dffff(0x1d2)},'product_stock':{'$first':_0x3dffff(0x17d)},'primary_code':{'$first':_0x3dffff(0x12d)},'secondary_code':{'$first':_0x3dffff(0x160)},'product_code':{'$first':_0x3dffff(0x19e)},'level':{'$first':_0x3dffff(0x1ff)},'isle':{'$first':_0x3dffff(0x175)},'type':{'$first':_0x3dffff(0x103)},'pallet':{'$first':_0x3dffff(0x182)},'unit':{'$first':_0x3dffff(0x10d)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3dffff(0x1d3)},'rack':{'$first':_0x3dffff(0x134)},'expiry_date':{'$first':_0x3dffff(0x114)},'production_date':{'$first':_0x3dffff(0x20f)},'maxPerUnit':{'$first':_0x3dffff(0x11b)},'batch_code':{'$first':_0x3dffff(0x17b)},'product_cat':{'$first':_0x3dffff(0x213)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x3dffff(0x1a0)}}}]),_0x4e201d=await warehouse[_0x3dffff(0x186)]([{'$match':{'name':_0x450d0b,'room':_0x4015a7}},{'$unwind':_0x3dffff(0x1ca)},{'$match':{'product_details.secondary_code':_0xea1c92}},{'$group':{'_id':_0x3dffff(0x151),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3dffff(0x17d)},'primary_code':{'$first':_0x3dffff(0x12d)},'secondary_code':{'$first':_0x3dffff(0x160)},'product_code':{'$first':_0x3dffff(0x19e)},'level':{'$first':_0x3dffff(0x1ff)},'isle':{'$first':_0x3dffff(0x175)},'type':{'$first':_0x3dffff(0x103)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x3dffff(0x10d)},'secondary_unit':{'$first':_0x3dffff(0x1bc)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3dffff(0x134)},'expiry_date':{'$first':_0x3dffff(0x114)},'production_date':{'$first':_0x3dffff(0x20f)},'maxPerUnit':{'$first':_0x3dffff(0x11b)},'batch_code':{'$first':_0x3dffff(0x17b)},'product_cat':{'$first':_0x3dffff(0x213)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x3dffff(0x202)},'invoice':{'$first':_0x3dffff(0x1a0)}}}]);if(_0x5125fb[_0x3dffff(0x1c8)]>0x0)_0x23ce8e[_0x3dffff(0x14f)](_0x5125fb);else _0x4e201d[_0x3dffff(0x1c8)]>0x0&&_0x23ce8e[_0x3dffff(0x14f)](_0x4e201d);}const _0x120c57=_0x42f9a9[_0x557190(0x170)](_0x1f0da2=>_0x3710ee(_0x1f0da2));await Promise[_0x557190(0x1d1)](_0x120c57),_0x119ebf[_0x557190(0x198)](_0x23ce8e);}),module[a0_0x48eaef(0x1f7)]=router;