var a0_0x4a2edb=a0_0x33c8;(function(_0x56047e,_0x4c6a92){var _0x5ecab3=a0_0x33c8,_0x23a867=_0x56047e();while(!![]){try{var _0x2e2568=parseInt(_0x5ecab3(0x236))/0x1+parseInt(_0x5ecab3(0x2e9))/0x2*(-parseInt(_0x5ecab3(0x1fd))/0x3)+parseInt(_0x5ecab3(0x21d))/0x4*(-parseInt(_0x5ecab3(0x23f))/0x5)+parseInt(_0x5ecab3(0x291))/0x6*(parseInt(_0x5ecab3(0x240))/0x7)+-parseInt(_0x5ecab3(0x221))/0x8+-parseInt(_0x5ecab3(0x28e))/0x9*(-parseInt(_0x5ecab3(0x2bf))/0xa)+-parseInt(_0x5ecab3(0x262))/0xb*(-parseInt(_0x5ecab3(0x268))/0xc);if(_0x2e2568===_0x4c6a92)break;else _0x23a867['push'](_0x23a867['shift']());}catch(_0xa6507f){_0x23a867['push'](_0x23a867['shift']());}}}(a0_0xd4dd,0x365eb));const express=require(a0_0x4a2edb(0x2ea)),app=express(),router=express[a0_0x4a2edb(0x227)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x4a2edb(0x277)),auth=require(a0_0x4a2edb(0x2b7)),nodemailer=require(a0_0x4a2edb(0x2ac)),users=require(a0_0x4a2edb(0x258));function a0_0x33c8(_0x4c50ad,_0x12a286){var _0xd4dd9a=a0_0xd4dd();return a0_0x33c8=function(_0x33c861,_0x1d5663){_0x33c861=_0x33c861-0x1c9;var _0x25959b=_0xd4dd9a[_0x33c861];return _0x25959b;},a0_0x33c8(_0x4c50ad,_0x12a286);}router[a0_0x4a2edb(0x1cf)](a0_0x4a2edb(0x231),auth,async(_0x1d14ee,_0x31ff37)=>{var _0x414aa0=a0_0x4a2edb;try{const {username:_0x3e52f8,email:_0xee3784,role:_0x475928}=_0x1d14ee[_0x414aa0(0x1f4)],_0xf18db1=_0x1d14ee['user'],_0x28a28e=await profile[_0x414aa0(0x296)]({'email':_0xf18db1[_0x414aa0(0x253)]}),_0x2733b5=await master_shop[_0x414aa0(0x21a)]();let _0x172f4f;if(_0xf18db1['role']==_0x414aa0(0x2e8)){const _0x425415=await staff['findOne']({'email':_0xf18db1['email']});_0x172f4f=await sales_finished[_0x414aa0(0x1db)]([{'$lookup':{'from':_0x414aa0(0x27d),'localField':_0x414aa0(0x2e4),'foreignField':'name','as':_0x414aa0(0x235)}},{'$unwind':_0x414aa0(0x273)},{'$unwind':_0x414aa0(0x222)},{'$group':{'_id':_0x414aa0(0x1d3),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x414aa0(0x204)},'date':{'$first':_0x414aa0(0x2ae)},'warehouse_name':{'$first':_0x414aa0(0x213)},'sale_product':{'$push':_0x414aa0(0x222)},'note':{'$first':_0x414aa0(0x20a)},'return_data':{'$first':_0x414aa0(0x284)},'customers_docs':{'$first':_0x414aa0(0x273)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x414aa0(0x283)},'isle':{'$addToSet':_0x414aa0(0x210)},'type':{'$addToSet':_0x414aa0(0x1e5)},'pallet':{'$addToSet':_0x414aa0(0x2d6)},'finalize':{'$first':_0x414aa0(0x246)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x172f4f=await sales_finished[_0x414aa0(0x1db)]([{'$lookup':{'from':_0x414aa0(0x27d),'localField':_0x414aa0(0x2e4),'foreignField':_0x414aa0(0x1d2),'as':'customers_docs'}},{'$unwind':_0x414aa0(0x273)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x414aa0(0x1d3),'invoice':{'$first':_0x414aa0(0x237)},'customers':{'$first':_0x414aa0(0x204)},'date':{'$first':_0x414aa0(0x2ae)},'warehouse_name':{'$first':_0x414aa0(0x213)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x414aa0(0x20a)},'return_data':{'$first':_0x414aa0(0x284)},'customers_docs':{'$first':_0x414aa0(0x273)},'total_saleproduct_quantity':{'$sum':_0x414aa0(0x1ce)},'level':{'$addToSet':_0x414aa0(0x283)},'isle':{'$addToSet':_0x414aa0(0x210)},'type':{'$addToSet':_0x414aa0(0x1e5)},'pallet':{'$addToSet':_0x414aa0(0x2d6)},'finalize':{'$first':_0x414aa0(0x246)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x2733b5[0x0]['language']==_0x414aa0(0x1e7)){var _0x23f543=users['English'];console[_0x414aa0(0x202)](_0x23f543);}else{if(_0x2733b5[0x0]['language']=='Hindi')var _0x23f543=users[_0x414aa0(0x24d)];else{if(_0x2733b5[0x0][_0x414aa0(0x2bb)]==_0x414aa0(0x1de))var _0x23f543=users['German'];else{if(_0x2733b5[0x0][_0x414aa0(0x2bb)]==_0x414aa0(0x1e1))var _0x23f543=users['Spanish'];else{if(_0x2733b5[0x0][_0x414aa0(0x2bb)]==_0x414aa0(0x1c9))var _0x23f543=users[_0x414aa0(0x1c9)];else{if(_0x2733b5[0x0][_0x414aa0(0x2bb)]==_0x414aa0(0x2d0))var _0x23f543=users[_0x414aa0(0x2b4)];else{if(_0x2733b5[0x0][_0x414aa0(0x2bb)]==_0x414aa0(0x2b0))var _0x23f543=users[_0x414aa0(0x2b0)];else{if(_0x2733b5[0x0][_0x414aa0(0x2bb)]==_0x414aa0(0x278))var _0x23f543=users[_0x414aa0(0x206)];}}}}}}}_0x31ff37[_0x414aa0(0x2db)](_0x414aa0(0x2d7),{'success':_0x1d14ee[_0x414aa0(0x280)]('success'),'errors':_0x1d14ee[_0x414aa0(0x280)](_0x414aa0(0x2a1)),'sales':_0x172f4f,'profile':_0x28a28e,'role':_0xf18db1,'master_shop':_0x2733b5,'language':_0x23f543});}catch(_0x22f056){console[_0x414aa0(0x202)](_0x22f056);}});function a0_0xd4dd(){var _0x400c53=['\x20Order\x20Number\x20:\x20','return_qty_QA','$sale_product.floorlevel','all_sales_finished','<html><head><title></title>','exports','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','render','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</thead>','<strong>\x20Regards\x20</strong>','sales_invoice','map','quantity','</span>','status','customer','$product_details.expiry_date','prod_code','edit_sales_finished_view','staff','2TlBWzf','express','French','/view/:id','return_qty','production_date_QA','secondary_unit','$sale_product.quantity','get','/invoice/:id','length','name','$_id','$product_details.secondary_code','all','received_amount','maxProducts','currency','/view/add_sale/product','Sale\x20Product\x20Mail','aggregate','product_details','<h5>','German','Ambient','suppliers','Spanish','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_code','secondary_code_QA','$sale_product.type','warehouse','English\x20(US)','/upload/','</body></html>','<div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details._id','True','product_code_QA','$product_details.product_stock','product_data','sales_quantity','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','user','\x20Order\x20Date\x20:\x20','catch','/view/add_sales/:id','sale_product','<h2>\x20','$product_details.product_cat','Quality\x20Inspection','Received\x20Payment\x20For\x20Sale','642279dnASju','/preview/:id','$product_details.rack','product','image','log','body','$customer','slice','Arabic','English','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$room','$product_details.bin','prod_invoice','product_name_QA1','$sale_product.bin','sendMail','foreach\x20newproduct','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/view/add_sales','adjust_qty','$product_details.bay','Sale\x20Return\x20Mail','/all_sales_finished/preview/','find','error','/picking_list/pdf/','202148ivKRBW','$product_details.type','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','post','3328792QPLERL','$sale_product','port','gmail','product_date','Sale\x20Return','Router','batch_code','barcode\x20user_id','push','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Enabled','stocks_QA','Return\x20Rooms','filter','purchases_data','/view','</tbody>','host','</table>','customers_docs','212125xUozWA','$invoice','Sales\x20Mail','$product.product_name','/all_sales/view','level','<h5\x20style=\x22text-align:\x20left;\x22>','primary_code_QA','secondary_unit_QA','15YNBeNE','106911doYfEL','Enclosed','warehouse_name','concat','master','carton','$finalize','amount','bay','$product_details.batch_code','padStart','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','product_code','Hindi','$product_details.invoice','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','edit_sales_finished','</head><body>','payment\x20successfull','email','Sales\x20Add\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</h5>','save','../public/language/languages.json','site_title','/all_sales_finished/view','getMonth','<tbody\x20style=\x22text-align:\x20center;\x22>','barcode\x20Product\x20master','max_per_unit','password','$product_details.secondary_unit','OUTF-','1792791IUZyIi','findById','add\x20post','currency_placement','<hr\x20class=\x22my-3\x22>','maxProducts_QA','24gBfKFC','primary_unit','product_stock','back','sales\x20item\x20return\x20successfull','An\x20error\x20occurred.','then','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.product_name','redirect','$customers_docs','Logo.png','Sale','due_amount','../models/all_models','Arabic\x20(ae)','/view/return_sales/:id','$product','FGSEmail','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','customers','$product_details.unit','<!DOCTYPE\x20html>','flash','invoice','QA\x20Warehouse','$sale_product.bay','$return_data','maxPerUnit_QA','role','prod_cat','stock','/barcode/:id','string','<tr>','for_categorize','False','86031eKPRzE','message','Sales\x20Update\x20successfully','18qglsOL','room_name','$name','/give_payment/:id','</td>','findOne','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_name','unit_QA','sale_qty','<table\x20style=\x22width:\x20100%\x20!important;\x22>','secondary_code','return_sale_finished','stock_data','maxperunit','getDate','errors','createTransport','params','expiry_date_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','unit','batch_code_QA','/barcode_scanner','date','$product_details.storage','<span\x20style=\x22float:\x20right;\x22>','nodemailer','product_list','$date','$product_details.production_date','Chinese','\x20</h2>','production_date','</tr>','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','return_sale_QA','../middleware/auth','getFullYear','$product_details.floorlevel','$product_details.primary_code','language','toString','room','add_sales_finished','440yvErBP','logo','sales_quantity_QA','Email\x20sent\x20successfully','/../public','return_sale','success','$product_details.maxPerUnit','all_sales_barcode','</div>','RoomAssigned','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','final','maxPerUnit','primary_code','json','return_data','Portuguese\x20(BR)','floor','Error\x20Occurs','expiry_date'];a0_0xd4dd=function(){return _0x400c53;};return a0_0xd4dd();}async function getRandom8DigitNumber(){var _0x1631ce=a0_0x4a2edb;const _0x577d7b=0x989680,_0xbb83f=0x5f5e0ff,_0x3369a7=Math[_0x1631ce(0x2d1)](Math['random']()*(_0xbb83f-_0x577d7b+0x1))+_0x577d7b;var _0x445029;const _0x2aec23=await sales_finished['findOne']({'invoice':_0x1631ce(0x261)+_0x3369a7});return _0x2aec23&&_0x2aec23[_0x1631ce(0x1d1)]>0x0?_0x445029=_0x1631ce(0x261)+_0x3369a7:_0x445029=_0x1631ce(0x261)+_0x3369a7,_0x445029;}router['get'](a0_0x4a2edb(0x215),auth,async(_0x3b3a22,_0x2945f6)=>{var _0x1cba99=a0_0x4a2edb;try{const {username:_0x35f648,email:_0x51decc,role:_0x43cbd8}=_0x3b3a22[_0x1cba99(0x1f4)],_0x18e9ff=_0x3b3a22[_0x1cba99(0x1f4)],_0x4cd427=await profile['findOne']({'email':_0x18e9ff[_0x1cba99(0x253)]}),_0x16eef1=await master_shop[_0x1cba99(0x21a)](),_0x1f275b=await customer[_0x1cba99(0x21a)]({});let _0x582e2d;if(_0x18e9ff[_0x1cba99(0x286)]==_0x1cba99(0x2e8)){const _0x4b7ec2=await staff[_0x1cba99(0x296)]({'email':_0x18e9ff[_0x1cba99(0x253)]});_0x582e2d=await warehouse['aggregate']([{'$match':{'status':_0x1cba99(0x22c),'name':_0x4b7ec2[_0x1cba99(0x1e6)],'warehouse_category':_0x1cba99(0x26f),'name':{'$ne':_0x1cba99(0x282)}}},{'$group':{'_id':_0x1cba99(0x293),'name':{'$first':_0x1cba99(0x293)}}},{'$sort':{'name':0x1}}]);}else _0x582e2d=await warehouse[_0x1cba99(0x1db)]([{'$match':{'status':_0x1cba99(0x22c),'warehouse_category':_0x1cba99(0x26f),'name':{'$ne':_0x1cba99(0x282)}}},{'$group':{'_id':'$name','name':{'$first':_0x1cba99(0x293)}}},{'$sort':{'name':0x1}}]);const _0x1b6b8e=await product[_0x1cba99(0x21a)]({});var _0x52e6f0=[_0x1cba99(0x1df),_0x1cba99(0x241)];const _0x237b82=await sales_finished[_0x1cba99(0x21a)]({}),_0x37f3d7=_0x237b82['length']+0x1,_0x19fbb7=_0x1cba99(0x261)+_0x37f3d7[_0x1cba99(0x2bc)]()[_0x1cba99(0x24a)](0x5,'0');if(_0x16eef1[0x0]['language']=='English\x20(US)'){var _0xa8724b=users[_0x1cba99(0x207)];console[_0x1cba99(0x202)](_0xa8724b);}else{if(_0x16eef1[0x0][_0x1cba99(0x2bb)]==_0x1cba99(0x24d))var _0xa8724b=users[_0x1cba99(0x24d)];else{if(_0x16eef1[0x0][_0x1cba99(0x2bb)]=='German')var _0xa8724b=users['German'];else{if(_0x16eef1[0x0]['language']==_0x1cba99(0x1e1))var _0xa8724b=users['Spanish'];else{if(_0x16eef1[0x0][_0x1cba99(0x2bb)]=='French')var _0xa8724b=users[_0x1cba99(0x1c9)];else{if(_0x16eef1[0x0][_0x1cba99(0x2bb)]=='Portuguese\x20(BR)')var _0xa8724b=users[_0x1cba99(0x2b4)];else{if(_0x16eef1[0x0][_0x1cba99(0x2bb)]=='Chinese')var _0xa8724b=users[_0x1cba99(0x2b0)];else{if(_0x16eef1[0x0]['language']==_0x1cba99(0x278))var _0xa8724b=users[_0x1cba99(0x206)];}}}}}}}const _0xe6a260=getRandom8DigitNumber();_0xe6a260[_0x1cba99(0x26e)](_0x3f276d=>{var _0x270495=_0x1cba99;_0x2945f6[_0x270495(0x2db)](_0x270495(0x2be),{'success':_0x3b3a22[_0x270495(0x280)](_0x270495(0x2c5)),'errors':_0x3b3a22[_0x270495(0x280)](_0x270495(0x2a1)),'role':_0x18e9ff,'profile':_0x4cd427,'customer':_0x1f275b,'warehouse':_0x582e2d,'product':_0x1b6b8e,'invoice':_0x3f276d,'master_shop':_0x16eef1,'language':_0xa8724b,'rooms_data':_0x52e6f0});})[_0x1cba99(0x1f6)](_0x5c1c45=>{var _0x5c859a=_0x1cba99;_0x3b3a22['flash'](_0x5c859a(0x2a1),_0x5c859a(0x2dc)),_0x2945f6[_0x5c859a(0x272)](_0x5c859a(0x25a));});}catch(_0x1eb9bf){console['log'](_0x1eb9bf);}}),router[a0_0x4a2edb(0x1cf)](a0_0x4a2edb(0x1f7),auth,async(_0x25abc4,_0x1e52c1)=>{var _0x704d72=a0_0x4a2edb;try{const _0x566cce=_0x25abc4[_0x704d72(0x2a3)]['id'];console[_0x704d72(0x202)](_0x566cce);const _0x13af74=await product[_0x704d72(0x21a)](),_0x11e9f5=await purchases[_0x704d72(0x1db)]([{'$match':{'warehouse_name':_0x566cce}},{'$unwind':_0x704d72(0x27a)},{'$group':{'_id':_0x704d72(0x239)}}]);console['log'](_0x704d72(0x230),_0x11e9f5),_0x1e52c1[_0x704d72(0x2e3)](0xc8)['json']({'purchases_data':_0x11e9f5,'product_data':_0x13af74});}catch(_0x5b86ef){console[_0x704d72(0x202)](_0x5b86ef);}}),router['post'](a0_0x4a2edb(0x1d9),auth,async(_0x5166f5,_0x519617)=>{var _0x1fe7e9=a0_0x4a2edb;try{const {warehouse_data:_0x23b004,product_data:_0x2e583b}=_0x5166f5[_0x1fe7e9(0x203)];console[_0x1fe7e9(0x202)](_0x5166f5[_0x1fe7e9(0x203)][_0x1fe7e9(0x1f0)]);;const _0x138875=await master_shop[_0x1fe7e9(0x21a)]();console[_0x1fe7e9(0x202)](_0x1fe7e9(0x244),_0x138875);const _0x51dc7b=await product[_0x1fe7e9(0x296)]({'name':_0x2e583b});console[_0x1fe7e9(0x202)](_0x1fe7e9(0x200),_0x51dc7b);const _0x121e08=await warehouse[_0x1fe7e9(0x1db)]([{'$match':{'name':_0x23b004}},{'$unwind':_0x1fe7e9(0x1f2)},{'$match':{'product_details.product_name':_0x2e583b}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x1fe7e9(0x1ef)}}}]);console['log'](_0x1fe7e9(0x29e),_0x121e08),_0x519617[_0x1fe7e9(0x2e3)](0xc8)['json']({'master':_0x138875,'new_product':_0x51dc7b,'stock_data':_0x121e08});}catch(_0x2b430a){console[_0x1fe7e9(0x202)](_0x2b430a);}}),router[a0_0x4a2edb(0x220)]('/view/add_sales',auth,async(_0x982fa0,_0x2cfe9a)=>{var _0x1371ad=a0_0x4a2edb;try{const {invoice:_0xddfb5a,date:_0x4f3e7f,warehouse_name:_0x165c5c,product_name:_0x45076e,stock:_0x39fa57,quantity:_0x63a244,note:_0x5bfc59,room:_0x3f3a2e,primary_code:_0x477401,secondary_code:_0xb684e3,prod_code:_0x4cb8c9,level:_0x9cfb1b,isle:_0x1ebbc5,pallet:_0x391c82,batch_code:_0x2f209a,SCRN:_0x131d87,expiry_date:_0x3e78f1,mode_transpo:_0x25bcf0,name_driver:_0x3b2461}=_0x982fa0['body'];if(typeof _0x45076e=='string')var _0x5587e6=[_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x298)]],_0x1a34e0=[_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x288)]],_0x19132d=[_0x982fa0['body'][_0x1371ad(0x245)]],_0x53953a=[_0x982fa0['body']['primary_code']],_0x3ef33d=[_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x29c)]],_0x3dbcaf=[_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x2e6)]],_0x5711e2=[_0x982fa0[_0x1371ad(0x203)]['level']],_0x52dee7=[_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x269)]],_0x1270e9=[_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x1cd)]],_0x4f7666=[_0x982fa0[_0x1371ad(0x203)]['batch_code']],_0x5f2e14=[_0x982fa0['body']['expiry_date']],_0x1c8672=[_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x225)]],_0x4c1a76=[_0x982fa0['body'][_0x1371ad(0x25e)]],_0x4f27a9=[_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x287)]],_0x2e5fe1=[_0x982fa0['body']['RoomAssigned']],_0x3e0c25=[_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x20e)]];else var _0x5587e6=[..._0x982fa0[_0x1371ad(0x203)]['product_name']],_0x1a34e0=[..._0x982fa0[_0x1371ad(0x203)]['stock']],_0x19132d=[..._0x982fa0[_0x1371ad(0x203)]['carton']],_0x53953a=[..._0x982fa0[_0x1371ad(0x203)]['primary_code']],_0x3ef33d=[..._0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x29c)]],_0x3dbcaf=[..._0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x2e6)]],_0x5711e2=[..._0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x23b)]],_0x52dee7=[..._0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x269)]],_0x1270e9=[..._0x982fa0[_0x1371ad(0x203)]['secondary_unit']],_0x4f7666=[..._0x982fa0['body']['batch_code']],_0x5f2e14=[..._0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x2d3)]],_0x1c8672=[..._0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x225)]],_0x4c1a76=[..._0x982fa0['body'][_0x1371ad(0x25e)]],_0x4f27a9=[..._0x982fa0[_0x1371ad(0x203)]['prod_cat']],_0x2e5fe1=[..._0x982fa0['body'][_0x1371ad(0x2c9)]],_0x3e0c25=[..._0x982fa0['body'][_0x1371ad(0x20e)]];const _0x109a18=_0x5587e6['map'](_0x41bf8b=>{return _0x41bf8b={'product_name':_0x41bf8b};});_0x1a34e0[_0x1371ad(0x208)]((_0x3e2c5c,_0x1922ac)=>{_0x109a18[_0x1922ac]['stock']=_0x3e2c5c;}),_0x19132d[_0x1371ad(0x208)]((_0x589858,_0x366b9c)=>{var _0xd8aa7b=_0x1371ad;_0x109a18[_0x366b9c][_0xd8aa7b(0x2e1)]=_0x589858;}),_0x53953a[_0x1371ad(0x208)]((_0x3467e5,_0x4a086f)=>{var _0x26dab8=_0x1371ad;_0x109a18[_0x4a086f][_0x26dab8(0x2cd)]=_0x3467e5;}),_0x3ef33d[_0x1371ad(0x208)]((_0x2e36f8,_0x3db1dc)=>{var _0x43213d=_0x1371ad;_0x109a18[_0x3db1dc][_0x43213d(0x29c)]=_0x2e36f8;}),_0x3dbcaf[_0x1371ad(0x208)]((_0x3a401a,_0x447acd)=>{var _0x14558c=_0x1371ad;_0x109a18[_0x447acd][_0x14558c(0x24c)]=_0x3a401a;}),_0x5711e2['forEach']((_0x48670b,_0x146b9f)=>{var _0x38a5db=_0x1371ad;_0x109a18[_0x146b9f][_0x38a5db(0x248)]=_0x48670b;}),_0x52dee7['forEach']((_0x217383,_0xce5760)=>{var _0x35072c=_0x1371ad;_0x109a18[_0xce5760][_0x35072c(0x2a6)]=_0x217383;}),_0x1270e9[_0x1371ad(0x208)]((_0xbc37c2,_0x1d2245)=>{_0x109a18[_0x1d2245]['secondary_unit']=_0xbc37c2;}),_0x4f7666['forEach']((_0xefb793,_0x1340ca)=>{_0x109a18[_0x1340ca]['batch_code']=_0xefb793;}),_0x5f2e14['forEach']((_0x1ec16d,_0x17f750)=>{var _0x3af8d0=_0x1371ad;_0x109a18[_0x17f750][_0x3af8d0(0x2d3)]=_0x1ec16d;}),_0x1c8672[_0x1371ad(0x208)]((_0x46fa35,_0x1cf5b3)=>{var _0x2fc18a=_0x1371ad;_0x109a18[_0x1cf5b3][_0x2fc18a(0x2b2)]=_0x46fa35;}),_0x4c1a76[_0x1371ad(0x208)]((_0x3f862a,_0x5aa8ea)=>{var _0x1b62f6=_0x1371ad;_0x109a18[_0x5aa8ea][_0x1b62f6(0x29f)]=_0x3f862a;}),_0x4f27a9['forEach']((_0x5d5c75,_0xfeaea2)=>{var _0x40c94a=_0x1371ad;_0x109a18[_0xfeaea2][_0x40c94a(0x287)]=_0x5d5c75;}),_0x2e5fe1[_0x1371ad(0x208)]((_0x39e057,_0x2bb6f3)=>{var _0x54df14=_0x1371ad;_0x109a18[_0x2bb6f3][_0x54df14(0x292)]=_0x39e057;}),_0x3e0c25[_0x1371ad(0x208)]((_0x4befd6,_0x3d6758)=>{var _0x25bc23=_0x1371ad;_0x109a18[_0x3d6758][_0x25bc23(0x281)]=_0x4befd6;});var _0x5407ad=0x0;_0x109a18[_0x1371ad(0x208)](_0x5a746d=>{var _0x4850d2=_0x1371ad;console[_0x4850d2(0x202)]('foreach\x20newproduct',_0x5a746d),(parseInt(_0x5a746d[_0x4850d2(0x288)])<parseInt(_0x5a746d[_0x4850d2(0x2e1)])||parseInt(_0x5a746d['quantity'])==0x0)&&_0x5407ad++;});if(_0x5407ad!=0x0)return _0x982fa0[_0x1371ad(0x280)](_0x1371ad(0x2a1),_0x1371ad(0x24f)),_0x2cfe9a[_0x1371ad(0x272)](_0x1371ad(0x26b));const _0x3df182=_0x109a18[_0x1371ad(0x22f)](_0x18ca37=>_0x18ca37[_0x1371ad(0x2e1)]!=='0'&&_0x18ca37[_0x1371ad(0x2e1)]!==''),_0x433764=new sales_finished({'invoice':_0xddfb5a,'customer':_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x2e4)],'date':_0x4f3e7f,'warehouse_name':_0x165c5c,'sale_product':_0x3df182,'note':_0x5bfc59,'room':_0x3f3a2e,'primary_code':_0x477401,'secondary_code':_0xb684e3,'prod_code':_0x4cb8c9,'SCRN':_0x131d87,'finalize':_0x1371ad(0x28d),'mode_transpo':_0x25bcf0,'name_driver':_0x3b2461}),_0x5ec833=await _0x433764[_0x1371ad(0x257)](),_0x1f20ba=await sales_finished[_0x1371ad(0x296)]({'invoice':_0xddfb5a}),_0x337f3a=new c_payment_data({'invoice':_0xddfb5a,'customer':_0x982fa0[_0x1371ad(0x203)]['customer'],'reason':_0x1371ad(0x275)});await _0x337f3a[_0x1371ad(0x257)]();const _0xdb30b=await master_shop[_0x1371ad(0x21a)](),_0x10d9cb=await email_settings[_0x1371ad(0x296)](),_0x3c2ba3=await customer[_0x1371ad(0x296)]({'name':_0x982fa0[_0x1371ad(0x203)][_0x1371ad(0x2e4)]});_0xdb30b[0x0][_0x1371ad(0x265)]==0x1?(right_currency=_0xdb30b[0x0][_0x1371ad(0x1d8)],left_currency=''):(right_currency='',left_currency=_0xdb30b[0x0][_0x1371ad(0x1d8)]);var _0x5cb6c2=_0x5587e6,_0x10b4d8=_0x19132d,_0x26dd64='',_0x4d186a;for(_0x4d186a in _0x5cb6c2){_0x26dd64+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5cb6c2[_0x4d186a]+_0x1371ad(0x295)+_0x1371ad(0x1e2)+_0x10b4d8[_0x4d186a]+_0x1371ad(0x295)+_0x1371ad(0x2b3);}console[_0x1371ad(0x202)](_0x1371ad(0x2ad),_0x26dd64);let _0x44db6e=nodemailer[_0x1371ad(0x2a2)]({'service':_0x1371ad(0x224),'auth':{'user':_0x10d9cb[_0x1371ad(0x253)],'pass':_0x10d9cb[_0x1371ad(0x25f)]}}),_0x5b499f={'from':_0x10d9cb[_0x1371ad(0x253)],'to':_0x3c2ba3[_0x1371ad(0x253)],'subject':_0x1371ad(0x1da),'attachments':[{'filename':_0x1371ad(0x274),'path':__dirname+'/../public'+'/upload/'+_0xdb30b[0x0][_0x1371ad(0x201)],'cid':_0x1371ad(0x2c0)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x1371ad(0x251)+'<div>'+_0x1371ad(0x297)+'<div>'+_0x1371ad(0x27c)+'</div>'+_0x1371ad(0x1ea)+_0x1371ad(0x1f9)+_0xdb30b[0x0][_0x1371ad(0x259)]+_0x1371ad(0x2b1)+_0x1371ad(0x2c8)+_0x1371ad(0x2c8)+_0x1371ad(0x266)+_0x1371ad(0x1ea)+_0x1371ad(0x23c)+_0x1371ad(0x2d4)+_0xddfb5a+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1371ad(0x1f5)+_0x4f3e7f+'\x20'+_0x1371ad(0x2e2)+_0x1371ad(0x256)+'</div>'+_0x1371ad(0x29b)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1371ad(0x28b)+_0x1371ad(0x2b5)+_0x1371ad(0x2da)+_0x1371ad(0x2b3)+_0x1371ad(0x2dd)+_0x1371ad(0x25c)+'\x20'+_0x26dd64+'\x20'+_0x1371ad(0x232)+'</table>'+_0x1371ad(0x1ea)+_0x1371ad(0x2de)+_0x1371ad(0x1dd)+_0xdb30b[0x0][_0x1371ad(0x259)]+_0x1371ad(0x256)+_0x1371ad(0x2c8)+_0x1371ad(0x2c8)+_0x1371ad(0x1e9)};_0x44db6e[_0x1371ad(0x211)](_0x5b499f,function(_0x57676b,_0x52e704){var _0x46c4eb=_0x1371ad;_0x57676b?(console[_0x46c4eb(0x202)](_0x57676b),console[_0x46c4eb(0x202)]('Error\x20Occurs')):console[_0x46c4eb(0x202)](_0x46c4eb(0x2c2));}),_0x982fa0['flash'](_0x1371ad(0x2c5),_0x1371ad(0x254)),_0x2cfe9a['redirect'](_0x1371ad(0x219)+_0x5ec833['_id']);}catch(_0x5d758b){console[_0x1371ad(0x202)](_0x5d758b);}}),router[a0_0x4a2edb(0x1cf)](a0_0x4a2edb(0x1fe),auth,async(_0x359829,_0x47bd48)=>{var _0x3e7c6c=a0_0x4a2edb;try{const {username:_0x467376,email:_0x28cd50,role:_0x44a9e1}=_0x359829[_0x3e7c6c(0x1f4)],_0x40738b=_0x359829[_0x3e7c6c(0x1f4)],_0x583cbe=await profile['findOne']({'email':_0x40738b[_0x3e7c6c(0x253)]}),_0x246c75=await master_shop[_0x3e7c6c(0x21a)](),_0xcb5092=_0x359829[_0x3e7c6c(0x2a3)]['id'],_0x40c8ff=await sales_finished[_0x3e7c6c(0x263)](_0xcb5092),_0x2a2aba=await warehouse[_0x3e7c6c(0x1db)]([{'$match':{'name':_0x40c8ff['warehouse_name']}},{'$unwind':_0x3e7c6c(0x1f2)},{'$group':{'_id':_0x3e7c6c(0x1ec),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3e7c6c(0x217)},'bin':{'$first':_0x3e7c6c(0x20d)},'type':{'$first':_0x3e7c6c(0x21e)},'floorlevel':{'$first':_0x3e7c6c(0x2b9)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3e7c6c(0x1d4)},'product_code':{'$first':_0x3e7c6c(0x1e3)},'storage':{'$first':_0x3e7c6c(0x2aa)},'rack':{'$first':_0x3e7c6c(0x1ff)},'expiry_date':{'$first':_0x3e7c6c(0x2e5)},'production_date':{'$first':_0x3e7c6c(0x2af)},'batch_code':{'$first':_0x3e7c6c(0x249)},'room':{'$first':'$room'}}}]),_0x5d37de=await customer[_0x3e7c6c(0x21a)]({});let _0x3f71fa;if(_0x40738b[_0x3e7c6c(0x286)]=='staff'){const _0x1424ea=await staff['findOne']({'email':_0x40738b[_0x3e7c6c(0x253)]});_0x3f71fa=await warehouse['aggregate']([{'$match':{'status':_0x3e7c6c(0x22c),'name':_0x1424ea[_0x3e7c6c(0x1e6)]}},{'$group':{'_id':_0x3e7c6c(0x293),'name':{'$first':_0x3e7c6c(0x293)}}}]);}else _0x3f71fa=await warehouse['aggregate']([{'$match':{'status':_0x3e7c6c(0x22c)}},{'$group':{'_id':_0x3e7c6c(0x293),'name':{'$first':'$name'}}}]);const _0x674613=await product['find']({});if(_0x246c75[0x0][_0x3e7c6c(0x2bb)]==_0x3e7c6c(0x1e7)){var _0x8c5235=users[_0x3e7c6c(0x207)];console[_0x3e7c6c(0x202)](_0x8c5235);}else{if(_0x246c75[0x0][_0x3e7c6c(0x2bb)]==_0x3e7c6c(0x24d))var _0x8c5235=users[_0x3e7c6c(0x24d)];else{if(_0x246c75[0x0][_0x3e7c6c(0x2bb)]=='German')var _0x8c5235=users[_0x3e7c6c(0x1de)];else{if(_0x246c75[0x0][_0x3e7c6c(0x2bb)]==_0x3e7c6c(0x1e1))var _0x8c5235=users[_0x3e7c6c(0x1e1)];else{if(_0x246c75[0x0][_0x3e7c6c(0x2bb)]==_0x3e7c6c(0x1c9))var _0x8c5235=users[_0x3e7c6c(0x1c9)];else{if(_0x246c75[0x0][_0x3e7c6c(0x2bb)]==_0x3e7c6c(0x2d0))var _0x8c5235=users[_0x3e7c6c(0x2b4)];else{if(_0x246c75[0x0][_0x3e7c6c(0x2bb)]==_0x3e7c6c(0x2b0))var _0x8c5235=users[_0x3e7c6c(0x2b0)];else{if(_0x246c75[0x0]['language']==_0x3e7c6c(0x278))var _0x8c5235=users['Arabic'];}}}}}}}_0x47bd48[_0x3e7c6c(0x2db)](_0x3e7c6c(0x2e7),{'success':_0x359829[_0x3e7c6c(0x280)](_0x3e7c6c(0x2c5)),'errors':_0x359829[_0x3e7c6c(0x280)](_0x3e7c6c(0x2a1)),'role':_0x40738b,'profile':_0x583cbe,'customer':_0x5d37de,'warehouse':_0x3f71fa,'product':_0x2a2aba,'user':_0x40c8ff,'master_shop':_0x246c75,'unit':_0x674613,'language':_0x8c5235});}catch(_0xe22662){console[_0x3e7c6c(0x202)](_0xe22662);}}),router['post'](a0_0x4a2edb(0x1fe),auth,async(_0x456580,_0x5b76d6)=>{var _0x11d970=a0_0x4a2edb;try{const _0x5bd4aa=_0x456580['params']['id'],{invoice:_0x4db7c2,warehouse_name:_0x183166,room:_0xf30861}=_0x456580[_0x11d970(0x203)],_0x42ae80=await sales_finished[_0x11d970(0x296)]({'invoice':_0x4db7c2}),_0x382ab6=_0x42ae80[_0x11d970(0x1f8)]['map'](async _0x1ddf8c=>{var _0x69c39e=_0x11d970,_0x20f52e=await warehouse[_0x69c39e(0x296)]({'name':_0x183166,'room':_0x1ddf8c[_0x69c39e(0x292)],'warehouse_category':_0x69c39e(0x26f)});const _0x35ce94=_0x20f52e[_0x69c39e(0x1dc)][_0x69c39e(0x2e0)](_0x9672ac=>{var _0x19c233=_0x69c39e;_0x9672ac[_0x19c233(0x298)]==_0x1ddf8c[_0x19c233(0x298)]&&_0x9672ac[_0x19c233(0x248)]==_0x1ddf8c['bay']&&_0x9672ac['expiry_date']==_0x1ddf8c['expiry_date']&&_0x9672ac[_0x19c233(0x2b2)]==_0x1ddf8c[_0x19c233(0x2b2)]&&_0x9672ac['batch_code']==_0x1ddf8c[_0x19c233(0x228)]&&_0x9672ac['invoice']==_0x1ddf8c[_0x19c233(0x281)]&&(_0x9672ac['product_stock']=_0x9672ac[_0x19c233(0x26a)]-_0x1ddf8c[_0x19c233(0x2e1)]);});return _0x20f52e;});Promise['all'](_0x382ab6)[_0x11d970(0x26e)](async _0x474d12=>{var _0x246a09=_0x11d970;try{for(const _0x5eb5d8 of _0x474d12){await _0x5eb5d8[_0x246a09(0x257)]();}_0x42ae80['finalize']='True';const _0x497bd3=await _0x42ae80[_0x246a09(0x257)](),_0x782ccf=await master_shop['find'](),_0x5b9bfa=await email_settings[_0x246a09(0x296)](),_0x545978=await supervisor_settings[_0x246a09(0x21a)]();var _0xf849fd=_0x42ae80[_0x246a09(0x1f8)],_0x260d9d='',_0x3ffa50;for(_0x3ffa50 in _0xf849fd){var _0x3bf724='FG';_0x42ae80[_0x246a09(0x242)]=='DRY\x20GOODS'&&(_0x3bf724='DG'),_0x260d9d+=_0x246a09(0x28b)+_0x246a09(0x1e2)+_0xf849fd[_0x3ffa50][_0x246a09(0x298)]+'</td>'+_0x246a09(0x1e2)+_0xf849fd[_0x3ffa50][_0x246a09(0x24c)]+_0x246a09(0x295)+_0x246a09(0x1e2)+_0xf849fd[_0x3ffa50]['quantity']+_0x246a09(0x295)+_0x246a09(0x1e2)+_0xf849fd[_0x3ffa50][_0x246a09(0x2a6)]+_0x246a09(0x295)+_0x246a09(0x1e2)+_0xf849fd[_0x3ffa50][_0x246a09(0x1cd)]+_0x246a09(0x295)+_0x246a09(0x1e2)+_0x42ae80['warehouse_name']+_0x246a09(0x295)+_0x246a09(0x1e2)+_0xf849fd[_0x3ffa50]['room_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3bf724+_0xf849fd[_0x3ffa50][_0x246a09(0x248)]+_0x246a09(0x295);}let _0x3beafd=nodemailer[_0x246a09(0x2a2)]({'host':_0x5b9bfa[_0x246a09(0x233)],'port':Number(_0x5b9bfa[_0x246a09(0x223)]),'secure':![],'auth':{'user':_0x5b9bfa[_0x246a09(0x253)],'pass':_0x5b9bfa['password']}}),_0x42aae3={'from':_0x5b9bfa['email'],'to':_0x545978[0x0][_0x246a09(0x27b)],'subject':_0x246a09(0x238),'attachments':[{'filename':_0x246a09(0x274),'path':__dirname+_0x246a09(0x2c3)+_0x246a09(0x1e8)+_0x782ccf[0x0]['image'],'cid':'logo'}],'html':_0x246a09(0x27f)+'<html><head><title></title>'+_0x246a09(0x251)+_0x246a09(0x1ea)+_0x246a09(0x297)+_0x246a09(0x1ea)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x246a09(0x1f9)+_0x782ccf[0x0][_0x246a09(0x259)]+_0x246a09(0x2b1)+_0x246a09(0x2c8)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x246a09(0x1ea)+_0x246a09(0x23c)+_0x246a09(0x2d4)+_0x42ae80[_0x246a09(0x281)]+'\x20'+_0x246a09(0x2ab)+'\x20Order\x20Date\x20:\x20'+_0x42ae80[_0x246a09(0x2a9)]+'\x20'+_0x246a09(0x2e2)+_0x246a09(0x256)+_0x246a09(0x2c8)+_0x246a09(0x29b)+_0x246a09(0x2ca)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x246a09(0x209)+_0x246a09(0x1f3)+_0x246a09(0x2a5)+_0x246a09(0x1eb)+_0x246a09(0x214)+_0x246a09(0x270)+_0x246a09(0x22b)+_0x246a09(0x2b3)+_0x246a09(0x2dd)+_0x246a09(0x25c)+'\x20'+_0x260d9d+'\x20'+_0x246a09(0x232)+_0x246a09(0x234)+_0x246a09(0x1ea)+'<strong>\x20Regards\x20</strong>'+_0x246a09(0x1dd)+_0x782ccf[0x0][_0x246a09(0x259)]+_0x246a09(0x256)+'</div>'+_0x246a09(0x2c8)+_0x246a09(0x1e9)};_0x3beafd[_0x246a09(0x211)](_0x42aae3,function(_0x3765b2,_0x1fd933){var _0x4f42df=_0x246a09;_0x3765b2?(console['log'](_0x3765b2),console[_0x4f42df(0x202)](_0x4f42df(0x2d2))):console[_0x4f42df(0x202)](_0x4f42df(0x2c2));}),_0x456580[_0x246a09(0x280)]('success',_0x246a09(0x290)),_0x5b76d6[_0x246a09(0x272)](_0x246a09(0x21c)+_0x5bd4aa);}catch(_0x38f4f1){console[_0x246a09(0x21b)](_0x38f4f1),_0x5b76d6[_0x246a09(0x2e3)](0x1f4)[_0x246a09(0x2ce)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x38e362=>{var _0x57ccba=_0x11d970;console[_0x57ccba(0x21b)](_0x38e362),_0x5b76d6[_0x57ccba(0x2e3)](0x1f4)['json']({'error':_0x57ccba(0x26d)});});}catch(_0x2cbe7c){console[_0x11d970(0x202)](_0x2cbe7c);}}),router['get'](a0_0x4a2edb(0x1ca),auth,async(_0x3a3f0b,_0x3a83e2)=>{var _0x59c512=a0_0x4a2edb;try{const {username:_0x46e3fe,email:_0x98832c,role:_0xbfc335}=_0x3a3f0b[_0x59c512(0x1f4)],_0x531b65=_0x3a3f0b[_0x59c512(0x1f4)],_0x3728b3=await profile['findOne']({'email':_0x531b65[_0x59c512(0x253)]}),_0x395b7e=await master_shop['find'](),_0x35330d=_0x3a3f0b[_0x59c512(0x2a3)]['id'],_0x52df2b=await sales_finished[_0x59c512(0x263)](_0x35330d);let _0x3247ec=new Date(_0x52df2b['expiry_date']),_0x4c4ba2=('0'+_0x3247ec['getDate']())[_0x59c512(0x205)](-0x2),_0x27a635=('0'+(_0x3247ec[_0x59c512(0x25b)]()+0x1))[_0x59c512(0x205)](-0x2),_0x2283e1=_0x3247ec[_0x59c512(0x2b8)](),_0x378b7c=_0x2283e1+'-'+_0x27a635+'-'+_0x4c4ba2;var _0x3bbd3c=[_0x59c512(0x1df),_0x59c512(0x241)];const _0x2a4d84=await warehouse[_0x59c512(0x1db)]([{'$match':{'name':_0x52df2b[_0x59c512(0x242)],'room':_0x52df2b[_0x59c512(0x2bd)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x59c512(0x1ec),'name':{'$first':_0x59c512(0x271)},'product_stock':{'$first':_0x59c512(0x1ef)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x59c512(0x20d)},'type':{'$first':_0x59c512(0x21e)},'floorlevel':{'$first':_0x59c512(0x2b9)},'primary_code':{'$first':_0x59c512(0x2ba)},'secondary_code':{'$first':_0x59c512(0x1d4)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x59c512(0x1ff)}}}]),_0x195230=await customer[_0x59c512(0x21a)]({});let _0x2e4411;if(_0x531b65['role']=='staff'){const _0x5a18ee=await staff['findOne']({'email':_0x531b65[_0x59c512(0x253)]});_0x2e4411=await warehouse[_0x59c512(0x1db)]([{'$match':{'status':_0x59c512(0x22c),'name':_0x5a18ee[_0x59c512(0x1e6)]}},{'$group':{'_id':_0x59c512(0x293),'name':{'$first':_0x59c512(0x293)}}}]);}else _0x2e4411=await warehouse[_0x59c512(0x1db)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x59c512(0x293),'name':{'$first':_0x59c512(0x293)}}}]);const _0xad6c35=await product[_0x59c512(0x21a)]({});if(_0x395b7e[0x0][_0x59c512(0x2bb)]==_0x59c512(0x1e7)){var _0x41b100=users['English'];console[_0x59c512(0x202)](_0x41b100);}else{if(_0x395b7e[0x0][_0x59c512(0x2bb)]=='Hindi')var _0x41b100=users[_0x59c512(0x24d)];else{if(_0x395b7e[0x0][_0x59c512(0x2bb)]=='German')var _0x41b100=users[_0x59c512(0x1de)];else{if(_0x395b7e[0x0][_0x59c512(0x2bb)]=='Spanish')var _0x41b100=users[_0x59c512(0x1e1)];else{if(_0x395b7e[0x0][_0x59c512(0x2bb)]==_0x59c512(0x1c9))var _0x41b100=users['French'];else{if(_0x395b7e[0x0]['language']=='Portuguese\x20(BR)')var _0x41b100=users['Portuguese'];else{if(_0x395b7e[0x0][_0x59c512(0x2bb)]==_0x59c512(0x2b0))var _0x41b100=users[_0x59c512(0x2b0)];else{if(_0x395b7e[0x0]['language']==_0x59c512(0x278))var _0x41b100=users['Arabic'];}}}}}}}_0x3a83e2['render'](_0x59c512(0x250),{'success':_0x3a3f0b['flash'](_0x59c512(0x2c5)),'errors':_0x3a3f0b[_0x59c512(0x280)](_0x59c512(0x2a1)),'role':_0x531b65,'profile':_0x3728b3,'customer':_0x195230,'warehouse':_0x2e4411,'product':_0x2a4d84,'user':_0x52df2b,'master_shop':_0x395b7e,'unit':_0xad6c35,'language':_0x41b100,'rooms_data':_0x3bbd3c,'ed_fullDate':_0x378b7c});}catch(_0xc6bab0){console[_0x59c512(0x202)](_0xc6bab0);}}),router['post'](a0_0x4a2edb(0x1ca),auth,async(_0x1a9640,_0x2767d0)=>{var _0x25afa6=a0_0x4a2edb;try{const _0x597ad6=_0x1a9640[_0x25afa6(0x2a3)]['id'],_0x402e9b=await sales_finished[_0x25afa6(0x296)]({'_id':_0x1a9640[_0x25afa6(0x2a3)]['id']}),_0x57d8d2=await warehouse[_0x25afa6(0x296)]({'name':_0x402e9b[_0x25afa6(0x242)],'room':_0x1a9640['body'][_0x25afa6(0x2bd)],'warehouse_category':_0x25afa6(0x26f)}),{invoice:_0x142315,customer:_0x255241,date:_0x31aadf,warehouse_name:_0x51adec,product_name:_0x49d9d7,stock:_0x5a8326,adjust_qty:_0x34b273,note:_0x276f00,room:_0x2854bd,primary_code:_0x32d30b,secondary_code:_0x182ee0,prod_code:_0x4bd655,level:_0x36cb18,isle:_0x396a49,pallet:_0x36efba,expiry_date:_0x1e61e6}=_0x1a9640[_0x25afa6(0x203)];if(typeof _0x49d9d7==_0x25afa6(0x28a))var _0x3f8ddb=[_0x1a9640[_0x25afa6(0x203)][_0x25afa6(0x298)]],_0x1fe93e=[_0x1a9640[_0x25afa6(0x203)]['stock']],_0x379799=[_0x1a9640[_0x25afa6(0x203)][_0x25afa6(0x216)]],_0x4553b1=[_0x1a9640[_0x25afa6(0x203)][_0x25afa6(0x2cd)]],_0x15146b=[_0x1a9640[_0x25afa6(0x203)][_0x25afa6(0x29c)]],_0x4fa0b9=[_0x1a9640[_0x25afa6(0x203)]['prod_code']],_0x329f2a=[_0x1a9640[_0x25afa6(0x203)][_0x25afa6(0x23b)]],_0x56b284=[_0x1a9640[_0x25afa6(0x203)][_0x25afa6(0x2d3)]];else var _0x3f8ddb=[..._0x1a9640['body'][_0x25afa6(0x298)]],_0x1fe93e=[..._0x1a9640['body']['stock']],_0x379799=[..._0x1a9640['body'][_0x25afa6(0x216)]],_0x4553b1=[..._0x1a9640[_0x25afa6(0x203)][_0x25afa6(0x2cd)]],_0x15146b=[..._0x1a9640[_0x25afa6(0x203)]['secondary_code']],_0x4fa0b9=[..._0x1a9640[_0x25afa6(0x203)][_0x25afa6(0x2e6)]],_0x329f2a=[..._0x1a9640[_0x25afa6(0x203)][_0x25afa6(0x23b)]],_0x56b284=[..._0x1a9640[_0x25afa6(0x203)]['expiry_date']];const _0x5a3a00=_0x3f8ddb[_0x25afa6(0x2e0)](_0x2bf93c=>{return _0x2bf93c={'product_name':_0x2bf93c};});_0x1fe93e[_0x25afa6(0x208)]((_0x5a70b9,_0x254e40)=>{var _0xacaa2=_0x25afa6;_0x5a3a00[_0x254e40][_0xacaa2(0x288)]=_0x5a70b9;}),_0x379799[_0x25afa6(0x208)]((_0x1db53e,_0x551e18)=>{_0x5a3a00[_0x551e18]['quantity']=_0x1db53e;}),_0x4553b1[_0x25afa6(0x208)]((_0xbb0722,_0x129f38)=>{var _0x2a16b8=_0x25afa6;_0x5a3a00[_0x129f38][_0x2a16b8(0x2cd)]=_0xbb0722;}),_0x15146b['forEach']((_0x3b2b84,_0x5499fb)=>{var _0x1ad00d=_0x25afa6;_0x5a3a00[_0x5499fb][_0x1ad00d(0x29c)]=_0x3b2b84;}),_0x4fa0b9[_0x25afa6(0x208)]((_0x1354f1,_0x5960c7)=>{var _0x2b1c9c=_0x25afa6;_0x5a3a00[_0x5960c7][_0x2b1c9c(0x24c)]=_0x1354f1;}),_0x329f2a[_0x25afa6(0x208)]((_0x30f2c4,_0x744a4f)=>{_0x5a3a00[_0x744a4f]['level']=_0x30f2c4;}),_0x56b284['forEach']((_0x531758,_0x2e602c)=>{_0x5a3a00[_0x2e602c]['expiry_date']=_0x531758;});var _0x39888e=0x0;_0x5a3a00[_0x25afa6(0x208)](_0x580cbf=>{var _0x13339c=_0x25afa6;console['log'](_0x13339c(0x212),_0x580cbf),(parseInt(_0x580cbf['stock'])<parseInt(_0x580cbf[_0x13339c(0x2e1)])||parseInt(_0x580cbf[_0x13339c(0x2e1)])==0x0)&&_0x39888e++;});if(_0x39888e!=0x0)return _0x1a9640[_0x25afa6(0x280)](_0x25afa6(0x2a1),_0x25afa6(0x24f)),_0x2767d0[_0x25afa6(0x272)](_0x25afa6(0x26b));_0x402e9b[_0x25afa6(0x1f8)]['forEach'](_0x1201de=>{var _0x3ac187=_0x25afa6;const _0x398137=_0x57d8d2[_0x3ac187(0x1dc)][_0x3ac187(0x2e0)](_0x10eafb=>{var _0x1af5a1=_0x3ac187;_0x10eafb[_0x1af5a1(0x298)]==_0x1201de[_0x1af5a1(0x298)]&&_0x10eafb[_0x1af5a1(0x248)]==_0x1201de['bay']&&(_0x10eafb[_0x1af5a1(0x26a)]=parseInt(_0x10eafb['product_stock'])+parseInt(_0x1201de['quantity']));});}),await _0x57d8d2[_0x25afa6(0x257)]();const _0x4aeb51=_0x5a3a00[_0x25afa6(0x22f)](_0xa0ac60=>_0xa0ac60[_0x25afa6(0x2e1)]!=='0'&&_0xa0ac60[_0x25afa6(0x2e1)]!=='');_0x402e9b[_0x25afa6(0x281)]=_0x142315,_0x402e9b['customer']=_0x255241,_0x402e9b[_0x25afa6(0x2a9)]=_0x31aadf,_0x402e9b[_0x25afa6(0x242)]=_0x51adec,_0x402e9b['sale_product']=_0x4aeb51,_0x402e9b['note']=_0x276f00,_0x402e9b['room']=_0x2854bd;const _0x460af5=await _0x402e9b[_0x25afa6(0x257)](),_0x179644=await sales_finished[_0x25afa6(0x296)]({'_id':_0x1a9640[_0x25afa6(0x2a3)]['id']}),_0x1184ae=await warehouse[_0x25afa6(0x296)]({'name':_0x51adec,'room':_0x2854bd,'warehouse_category':_0x25afa6(0x26f)});_0x179644[_0x25afa6(0x1f8)][_0x25afa6(0x208)](_0x583cb9=>{var _0x28ffd0=_0x25afa6;const _0x597b4b=_0x1184ae[_0x28ffd0(0x1dc)][_0x28ffd0(0x2e0)](_0x16a755=>{var _0x559235=_0x28ffd0;_0x16a755[_0x559235(0x298)]==_0x583cb9['product_name']&&_0x16a755['bay']==_0x583cb9[_0x559235(0x248)]&&(_0x16a755[_0x559235(0x26a)]=parseInt(_0x16a755['product_stock'])-parseInt(_0x583cb9[_0x559235(0x2e1)]));});}),console[_0x25afa6(0x202)](_0x25afa6(0x2cb),_0x1184ae),await _0x1184ae['save']();const _0x452481=await c_payment_data[_0x25afa6(0x296)]({'invoice':_0x1a9640[_0x25afa6(0x203)]['invoice']});_0x452481[_0x25afa6(0x1e0)]=_0x1a9640[_0x25afa6(0x203)][_0x25afa6(0x1e0)],await _0x452481['save'](),_0x1a9640[_0x25afa6(0x280)](_0x25afa6(0x2c5),_0x25afa6(0x290)),_0x2767d0['redirect']('/all_sales_finished/view');}catch(_0x367468){console[_0x25afa6(0x202)](_0x367468);}}),router['post'](a0_0x4a2edb(0x294),auth,async(_0x3f6976,_0x16e27c)=>{var _0x564e47=a0_0x4a2edb;try{const _0x218d6b=_0x3f6976[_0x564e47(0x2a3)]['id'],{invoice:_0x2ac6c7,customer:_0x2aaa23,receivable_amount:_0x393a92,received_amount:_0x577112}=_0x3f6976[_0x564e47(0x203)],_0x14679f=await sales[_0x564e47(0x263)](_0x218d6b);console[_0x564e47(0x202)](_0x14679f);var _0x42280b=_0x393a92-_0x577112;console['log'](_0x577112),_0x14679f[_0x564e47(0x1d6)]=parseFloat(_0x577112)+parseFloat(_0x14679f[_0x564e47(0x1d6)]),_0x14679f[_0x564e47(0x276)]=_0x42280b,console['log'](_0x14679f);const _0x321823=await _0x14679f[_0x564e47(0x257)](),_0x3f53c8=await c_payment_data[_0x564e47(0x296)]({'invoice':_0x2ac6c7});_0x3f53c8[_0x564e47(0x247)]=_0x42280b,await _0x3f53c8[_0x564e47(0x257)]();let _0xaac9b1=new Date(),_0x1e0c7c=('0'+_0xaac9b1[_0x564e47(0x2a0)]())[_0x564e47(0x205)](-0x2),_0x4267f7=('0'+(_0xaac9b1[_0x564e47(0x25b)]()+0x1))['slice'](-0x2),_0xca3b4e=_0xaac9b1[_0x564e47(0x2b8)](),_0x10cb2f=_0xca3b4e+'-'+_0x4267f7+'-'+_0x1e0c7c;const _0x1bf05e=new customer_payment({'invoice':_0x2ac6c7,'date':_0xca3b4e+'-'+_0x4267f7+'-'+_0x1e0c7c,'customer':_0x2aaa23,'reason':_0x564e47(0x1fc),'amount':_0x577112}),_0x339523=await _0x1bf05e[_0x564e47(0x257)]();_0x3f6976[_0x564e47(0x280)](_0x564e47(0x2c5),_0x564e47(0x252)),_0x16e27c[_0x564e47(0x272)](_0x564e47(0x23a));}catch(_0x37e7e4){console[_0x564e47(0x202)](_0x37e7e4);}}),router['get'](a0_0x4a2edb(0x1d0),auth,async(_0x538ff4,_0x128286)=>{var _0xc6da91=a0_0x4a2edb;try{const {username:_0x185fc3,email:_0x428470,role:_0x40c50e}=_0x538ff4[_0xc6da91(0x1f4)],_0x4a8f9e=_0x538ff4[_0xc6da91(0x1f4)],_0x1d1c8d=await profile['findOne']({'email':_0x4a8f9e[_0xc6da91(0x253)]}),_0x22ec69=await master_shop[_0xc6da91(0x21a)]();console[_0xc6da91(0x202)](_0xc6da91(0x244),_0x22ec69);const _0xffe30f=_0x538ff4[_0xc6da91(0x2a3)]['id'],_0x2dd562=await sales['findById'](_0xffe30f);console[_0xc6da91(0x202)](_0x2dd562);const _0x4a1e1d=await customer[_0xc6da91(0x296)]({'name':_0x2dd562[_0xc6da91(0x2e4)]});console[_0xc6da91(0x202)](_0x4a1e1d);if(_0x22ec69[0x0]['language']=='English\x20(US)'){var _0x49dc43=users[_0xc6da91(0x207)];console['log'](_0x49dc43);}else{if(_0x22ec69[0x0][_0xc6da91(0x2bb)]==_0xc6da91(0x24d))var _0x49dc43=users[_0xc6da91(0x24d)];else{if(_0x22ec69[0x0][_0xc6da91(0x2bb)]==_0xc6da91(0x1de))var _0x49dc43=users[_0xc6da91(0x1de)];else{if(_0x22ec69[0x0]['language']=='Spanish')var _0x49dc43=users['Spanish'];else{if(_0x22ec69[0x0][_0xc6da91(0x2bb)]==_0xc6da91(0x1c9))var _0x49dc43=users[_0xc6da91(0x1c9)];else{if(_0x22ec69[0x0][_0xc6da91(0x2bb)]=='Portuguese\x20(BR)')var _0x49dc43=users['Portuguese'];else{if(_0x22ec69[0x0]['language']==_0xc6da91(0x2b0))var _0x49dc43=users[_0xc6da91(0x2b0)];else{if(_0x22ec69[0x0]['language']=='Arabic\x20(ae)')var _0x49dc43=users['Arabic'];}}}}}}}_0x128286[_0xc6da91(0x2db)](_0xc6da91(0x2df),{'success':_0x538ff4[_0xc6da91(0x280)](_0xc6da91(0x2c5)),'errors':_0x538ff4['flash'](_0xc6da91(0x2a1)),'role':_0x4a8f9e,'profile':_0x1d1c8d,'master_shop':_0x22ec69,'customers':_0x4a1e1d,'sales':_0x2dd562,'language':_0x49dc43});}catch(_0x5b866a){console[_0xc6da91(0x202)](_0x5b866a);}}),router[a0_0x4a2edb(0x1cf)](a0_0x4a2edb(0x279),auth,async(_0x2c3f7f,_0x2b8939)=>{var _0xdae749=a0_0x4a2edb;try{const {username:_0x2d6bf9,email:_0x530220,role:_0x2c89cb}=_0x2c3f7f[_0xdae749(0x1f4)],_0x35a4cf=_0x2c3f7f[_0xdae749(0x1f4)],_0x185da5=await profile[_0xdae749(0x296)]({'email':_0x35a4cf[_0xdae749(0x253)]}),_0x409084=await master_shop[_0xdae749(0x21a)](),_0x53293f=_0x2c3f7f[_0xdae749(0x2a3)]['id'],_0xc98fc8=await sales_finished['findById'](_0x53293f),_0x439672=await warehouse[_0xdae749(0x1db)]([{'$match':{'name':_0xc98fc8[_0xdae749(0x242)]}},{'$unwind':_0xdae749(0x1f2)},{'$group':{'_id':_0xdae749(0x1ec),'name':{'$first':_0xdae749(0x271)},'product_stock':{'$first':_0xdae749(0x1ef)},'bay':{'$first':_0xdae749(0x217)},'bin':{'$first':_0xdae749(0x20d)},'type':{'$first':_0xdae749(0x21e)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xdae749(0x2ba)},'secondary_code':{'$first':_0xdae749(0x1d4)},'product_code':{'$first':_0xdae749(0x1e3)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xdae749(0x2e5)},'production_date':{'$first':_0xdae749(0x2af)},'unit':{'$first':_0xdae749(0x27e)},'secondary_unit':{'$first':_0xdae749(0x260)},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':_0xdae749(0x249)},'maxPerUnit':{'$first':_0xdae749(0x2c6)}}}]),_0x13644c=await product[_0xdae749(0x21a)]({}),_0x485e29=await warehouse[_0xdae749(0x1db)]([{'$match':{'status':_0xdae749(0x22c),'warehouse_category':_0xdae749(0x26f),'name':{'$ne':'Return\x20Goods','$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0xdae749(0x293),'name':{'$first':_0xdae749(0x293)}}},{'$sort':{'name':0x1}}]);var _0x5f4e60=[_0xdae749(0x22e)];const _0x22297f=await warehouse[_0xdae749(0x1db)]([{'$match':{'status':'Enabled','name':_0xdae749(0x1fb)}},{'$group':{'_id':_0xdae749(0x293),'name':{'$first':_0xdae749(0x293)}}},{'$sort':{'name':0x1}}]);if(_0x409084[0x0][_0xdae749(0x2bb)]==_0xdae749(0x1e7)){var _0x5532ef=users[_0xdae749(0x207)];console['log'](_0x5532ef);}else{if(_0x409084[0x0][_0xdae749(0x2bb)]==_0xdae749(0x24d))var _0x5532ef=users['Hindi'];else{if(_0x409084[0x0][_0xdae749(0x2bb)]=='German')var _0x5532ef=users[_0xdae749(0x1de)];else{if(_0x409084[0x0][_0xdae749(0x2bb)]==_0xdae749(0x1e1))var _0x5532ef=users[_0xdae749(0x1e1)];else{if(_0x409084[0x0]['language']==_0xdae749(0x1c9))var _0x5532ef=users['French'];else{if(_0x409084[0x0][_0xdae749(0x2bb)]==_0xdae749(0x2d0))var _0x5532ef=users[_0xdae749(0x2b4)];else{if(_0x409084[0x0][_0xdae749(0x2bb)]==_0xdae749(0x2b0))var _0x5532ef=users[_0xdae749(0x2b0)];else{if(_0x409084[0x0][_0xdae749(0x2bb)]==_0xdae749(0x278))var _0x5532ef=users[_0xdae749(0x206)];}}}}}}}_0x2b8939[_0xdae749(0x2db)](_0xdae749(0x29d),{'success':_0x2c3f7f[_0xdae749(0x280)](_0xdae749(0x2c5)),'errors':_0x2c3f7f['flash'](_0xdae749(0x2a1)),'role':_0x35a4cf,'profile':_0x185da5,'user':_0xc98fc8,'stock':_0x439672,'master_shop':_0x409084,'unit':_0x13644c,'language':_0x5532ef,'warehouses':_0x485e29,'rooms':_0x5f4e60,'warehouse_QA':_0x22297f});}catch(_0x1f0db3){console[_0xdae749(0x202)](_0x1f0db3),_0x2b8939[_0xdae749(0x2e3)](0xc8)[_0xdae749(0x2ce)]({'message':_0x1f0db3[_0xdae749(0x28f)]});}}),router[a0_0x4a2edb(0x220)](a0_0x4a2edb(0x279),auth,async(_0x141f9f,_0x52e279)=>{var _0x33cc64=a0_0x4a2edb;if(_0x141f9f[_0x33cc64(0x203)]['for_categorize']=='QA')try{const {invoice:_0x538821,date:_0x1630f2,warehouse_name:_0x4418d7,product_name:_0x1eb293,primary_code:_0x26ce20,secondary_code:_0x5cb554,product_code:_0x434df0,sales_quantity:_0x5637c7,stocks:_0x387774,return_qty:_0x66e845,Room_name:_0x42d44d,to_warehouse_name_QA:_0x24c498,to_Room_name_QA:_0x233f90,note:_0x2745cf,for_categorize:_0x440d2c,product_name_QA1:_0x15fd0e}=_0x141f9f[_0x33cc64(0x203)];if(typeof _0x15fd0e=='string')var _0x437851=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x20f)]],_0x87b055=[_0x141f9f[_0x33cc64(0x203)]['primary_code_QA']],_0x2076a5=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1e4)]],_0x14ae1f=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1ee)]],_0x414ead=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2c1)]],_0x2151d7=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x22d)]],_0x3f758c=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2d5)]],_0x5512f4=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x285)]],_0x2617e5=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x267)]],_0x310e85=[_0x141f9f['body']['batch_code_QA']],_0xaf436a=[_0x141f9f[_0x33cc64(0x203)]['secondary_unit_QA']],_0xc71dd=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x299)]],_0xb5faa1=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1cc)]],_0x497216=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2a4)]];else var _0x437851=[..._0x141f9f['body'][_0x33cc64(0x20f)]],_0x87b055=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x23d)]],_0x2076a5=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1e4)]],_0x14ae1f=[..._0x141f9f['body']['product_code_QA']],_0x414ead=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2c1)]],_0x2151d7=[..._0x141f9f[_0x33cc64(0x203)]['stocks_QA']],_0x3f758c=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2d5)]],_0x5512f4=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x285)]],_0x2617e5=[..._0x141f9f['body'][_0x33cc64(0x267)]],_0x310e85=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2a7)]],_0xaf436a=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x23e)]],_0xc71dd=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x299)]],_0xb5faa1=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1cc)]],_0x497216=[..._0x141f9f['body'][_0x33cc64(0x2a4)]];const _0x5174ff=_0x437851[_0x33cc64(0x2e0)](_0x576638=>{return _0x576638={'product_name':_0x576638};});_0x87b055[_0x33cc64(0x208)]((_0x31d819,_0x1be916)=>{var _0x34e350=_0x33cc64;_0x5174ff[_0x1be916][_0x34e350(0x2cd)]=_0x31d819;}),_0x2076a5['forEach']((_0x5f252d,_0xd364b6)=>{var _0x4f9b09=_0x33cc64;_0x5174ff[_0xd364b6][_0x4f9b09(0x29c)]=_0x5f252d;}),_0x14ae1f[_0x33cc64(0x208)]((_0x4d0c0c,_0x3ee147)=>{_0x5174ff[_0x3ee147]['product_code']=_0x4d0c0c;}),_0x414ead[_0x33cc64(0x208)]((_0xec554f,_0x1f7a8a)=>{var _0x19ccb2=_0x33cc64;_0x5174ff[_0x1f7a8a][_0x19ccb2(0x29a)]=_0xec554f;}),_0x2151d7[_0x33cc64(0x208)]((_0x44d665,_0x18afbd)=>{var _0xe179af=_0x33cc64;_0x5174ff[_0x18afbd][_0xe179af(0x288)]=_0x44d665;}),_0x3f758c[_0x33cc64(0x208)]((_0x47c269,_0x43ca9b)=>{_0x5174ff[_0x43ca9b]['return_qty']=_0x47c269;}),_0x5512f4[_0x33cc64(0x208)]((_0xaf1334,_0x1c1a09)=>{var _0x3f0641=_0x33cc64;_0x5174ff[_0x1c1a09][_0x3f0641(0x2cc)]=_0xaf1334;}),_0x2617e5[_0x33cc64(0x208)]((_0x3d98d9,_0x27c93b)=>{var _0x4c5452=_0x33cc64;_0x5174ff[_0x27c93b][_0x4c5452(0x1d7)]=_0x3d98d9;}),_0x310e85[_0x33cc64(0x208)]((_0x1ebd29,_0xeaa93c)=>{var _0x503dfe=_0x33cc64;_0x5174ff[_0xeaa93c][_0x503dfe(0x228)]=_0x1ebd29;}),_0xaf436a[_0x33cc64(0x208)]((_0x3f3e33,_0x4d7d6a)=>{_0x5174ff[_0x4d7d6a]['secondary_unit']=_0x3f3e33;}),_0xc71dd[_0x33cc64(0x208)]((_0x549e1d,_0x21c544)=>{_0x5174ff[_0x21c544]['unit']=_0x549e1d;}),_0xb5faa1[_0x33cc64(0x208)]((_0x3a440e,_0x34767e)=>{var _0x9125c8=_0x33cc64;_0x5174ff[_0x34767e][_0x9125c8(0x2b2)]=_0x3a440e;}),_0x497216['forEach']((_0x2338a0,_0x48d657)=>{var _0x3185ce=_0x33cc64;_0x5174ff[_0x48d657][_0x3185ce(0x2d3)]=_0x2338a0;});const _0x26a044=await sales_finished[_0x33cc64(0x296)]({'invoice':_0x538821});_0x26a044[_0x33cc64(0x2cf)]=_0x33cc64(0x1ed);const _0x5da8e3=await _0x26a044[_0x33cc64(0x257)](),_0x2adef7=new sales_return_finished({'invoice':_0x538821,'customer':_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2e4)],'date':_0x1630f2,'warehouse_name':_0x4418d7,'room':_0x42d44d,'ToWarehouse':_0x24c498,'ToRoom':_0x233f90,'return_sale_QA':_0x5174ff,'note':_0x2745cf,'warehouse_cat':_0x440d2c}),_0x3756f3=await _0x2adef7[_0x33cc64(0x257)](),_0x3eea76=await sales_return_finished['findOne']({'invoice':_0x538821}),_0x22f113=await warehouse['findOne']({'name':_0x24c498,'room':_0x233f90});_0x3eea76[_0x33cc64(0x2b6)]['forEach'](_0x59db7b=>{var _0x3233a8=_0x33cc64,_0x564a82=0x0;const _0x5ea531=_0x22f113['product_details'][_0x3233a8(0x2e0)](_0x6ed457=>{var _0x2b53c6=_0x3233a8;_0x6ed457[_0x2b53c6(0x298)]==_0x59db7b[_0x2b53c6(0x298)]&&_0x6ed457['expiry_date']==_0x59db7b[_0x2b53c6(0x2d3)]&&_0x6ed457[_0x2b53c6(0x2b2)]==_0x59db7b[_0x2b53c6(0x2b2)]&&_0x6ed457[_0x2b53c6(0x228)]==_0x59db7b[_0x2b53c6(0x228)]&&(_0x6ed457[_0x2b53c6(0x26a)]=parseInt(_0x6ed457[_0x2b53c6(0x26a)])+parseInt(_0x59db7b[_0x2b53c6(0x1cb)]),_0x564a82++);});_0x564a82=='0'&&(_0x22f113[_0x3233a8(0x1dc)]=_0x22f113['product_details'][_0x3233a8(0x243)]({'product_name':_0x59db7b[_0x3233a8(0x298)],'product_stock':_0x59db7b[_0x3233a8(0x1cb)],'primary_code':_0x59db7b[_0x3233a8(0x2cd)],'secondary_code':_0x59db7b[_0x3233a8(0x29c)],'product_code':_0x59db7b[_0x3233a8(0x24c)],'batch_code':_0x59db7b[_0x3233a8(0x228)],'maxPerUnit':_0x59db7b['maxPerUnit'],'production_date':_0x59db7b[_0x3233a8(0x2b2)],'expiry_date':_0x59db7b[_0x3233a8(0x2d3)],'secondary_unit':_0x59db7b['secondary_unit'],'unit':_0x59db7b['unit'],'maxProducts':_0x59db7b[_0x3233a8(0x1d7)],'bay':_0x59db7b[_0x3233a8(0x248)]}));}),await _0x22f113['save']();const _0x30b122=new c_payment_data({'invoice':_0x538821,'customer':_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2e4)],'reason':_0x33cc64(0x226)});await _0x30b122[_0x33cc64(0x257)]();const _0xad4702=await master_shop['find'](),_0x30dd0c=await email_settings[_0x33cc64(0x296)](),_0x1269db=await customer[_0x33cc64(0x296)]({'name':_0x141f9f['body'][_0x33cc64(0x2e4)]});_0xad4702[0x0]['currency_placement']==0x1?(right_currency=_0xad4702[0x0][_0x33cc64(0x1d8)],left_currency=''):(right_currency='',left_currency=_0xad4702[0x0]['currency']);var _0x13d33d=_0x437851,_0x4b22d0=_0x3f758c,_0x16dee5='',_0x33cf3d;for(_0x33cf3d in _0x13d33d){_0x16dee5+=_0x33cc64(0x28b)+_0x33cc64(0x1e2)+_0x13d33d[_0x33cf3d]+'</td>'+_0x33cc64(0x1e2)+_0x4b22d0[_0x33cf3d]+_0x33cc64(0x295)+_0x33cc64(0x2b3);}console[_0x33cc64(0x202)]('product_list',_0x16dee5);let _0x547f80=nodemailer[_0x33cc64(0x2a2)]({'service':_0x33cc64(0x224),'auth':{'user':_0x30dd0c[_0x33cc64(0x253)],'pass':_0x30dd0c[_0x33cc64(0x25f)]}}),_0x40120f={'from':_0x30dd0c[_0x33cc64(0x253)],'to':_0x1269db['email'],'subject':_0x33cc64(0x218),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x33cc64(0x1e8)+_0xad4702[0x0][_0x33cc64(0x201)],'cid':_0x33cc64(0x2c0)}],'html':'<!DOCTYPE\x20html>'+_0x33cc64(0x2d8)+'</head><body>'+_0x33cc64(0x1ea)+_0x33cc64(0x297)+_0x33cc64(0x1ea)+_0x33cc64(0x27c)+_0x33cc64(0x2c8)+'<div>'+_0x33cc64(0x1f9)+_0xad4702[0x0][_0x33cc64(0x259)]+_0x33cc64(0x2b1)+_0x33cc64(0x2c8)+'</div>'+_0x33cc64(0x266)+_0x33cc64(0x1ea)+_0x33cc64(0x23c)+_0x33cc64(0x2d4)+_0x538821+'\x20'+_0x33cc64(0x2ab)+'\x20Order\x20Date\x20:\x20'+_0x1630f2+'\x20'+'</span>'+'</h5>'+_0x33cc64(0x2c8)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x33cc64(0x2ca)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x33cc64(0x255)+_0x33cc64(0x20b)+_0x33cc64(0x24b)+_0x33cc64(0x2b3)+_0x33cc64(0x2dd)+_0x33cc64(0x25c)+'\x20'+_0x16dee5+'\x20'+'</tbody>'+_0x33cc64(0x234)+'<div>'+_0x33cc64(0x2de)+_0x33cc64(0x1dd)+_0xad4702[0x0][_0x33cc64(0x259)]+_0x33cc64(0x256)+_0x33cc64(0x2c8)+'</div>'+_0x33cc64(0x1e9)};_0x547f80[_0x33cc64(0x211)](_0x40120f,function(_0x271bdb,_0x10274e){var _0x44a749=_0x33cc64;_0x271bdb?(console[_0x44a749(0x202)](_0x271bdb),console[_0x44a749(0x202)](_0x44a749(0x2d2))):console[_0x44a749(0x202)](_0x44a749(0x2c2));}),_0x141f9f[_0x33cc64(0x280)](_0x33cc64(0x2c5),_0x33cc64(0x26c)),_0x52e279['redirect'](_0x33cc64(0x25a));}catch(_0x3b829a){_0x52e279['status'](0xc8)[_0x33cc64(0x2ce)]({'message1':_0x3b829a['message']});}else{if(_0x141f9f['body'][_0x33cc64(0x28c)]=='GS')try{const {invoice:_0x2f302c,date:_0x1ed453,warehouse_name:_0x26145e,product_name:_0x2ffad6,primary_code:_0x6e6f85,secondary_code:_0x1c15d9,product_code:_0x14ca78,sales_quantity:_0xd75714,stocks:_0x1c7dc7,return_qty:_0x2907a6,Room_name:_0x51b332,to_warehouse_name:_0x32d62f,to_Room_name:_0x49f5b3,note:_0x2a5599,level:_0x220544,isle:_0x15915b,pallet:_0x46a314,for_categorize:_0x3505f5}=_0x141f9f[_0x33cc64(0x203)];if(typeof _0x2ffad6=='string')var _0x437851=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x298)]],_0x87b055=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2cd)]],_0x2076a5=[_0x141f9f['body'][_0x33cc64(0x29c)]],_0x14ae1f=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x24c)]],_0x414ead=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1f1)]],_0x3f758c=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1cb)]],_0x555bf0=[_0x141f9f[_0x33cc64(0x203)]['bay']],_0x5512f4=[_0x141f9f[_0x33cc64(0x203)]['maxPerUnit']],_0x2617e5=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1d7)]],_0x310e85=[_0x141f9f['body'][_0x33cc64(0x228)]],_0xaf436a=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1cd)]],_0xc71dd=[_0x141f9f[_0x33cc64(0x203)]['unit']],_0xb5faa1=[_0x141f9f['body']['production_date']],_0x497216=[_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2d3)]];else var _0x437851=[..._0x141f9f['body'][_0x33cc64(0x298)]],_0x87b055=[..._0x141f9f[_0x33cc64(0x203)]['primary_code']],_0x2076a5=[..._0x141f9f[_0x33cc64(0x203)]['secondary_code']],_0x14ae1f=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x24c)]],_0x414ead=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1f1)]],_0x3f758c=[..._0x141f9f['body']['return_qty']],_0x555bf0=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x248)]],_0x5512f4=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2cc)]],_0x2617e5=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x1d7)]],_0x310e85=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x228)]],_0xaf436a=[..._0x141f9f[_0x33cc64(0x203)]['secondary_unit']],_0xc71dd=[..._0x141f9f[_0x33cc64(0x203)]['unit']],_0xb5faa1=[..._0x141f9f[_0x33cc64(0x203)]['production_date']],_0x497216=[..._0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2d3)]];const _0x29c5e3=_0x437851[_0x33cc64(0x2e0)](_0x12fdf1=>{return _0x12fdf1={'product_name':_0x12fdf1};});_0x87b055[_0x33cc64(0x208)]((_0x68511c,_0x144e97)=>{var _0x41cf38=_0x33cc64;_0x29c5e3[_0x144e97][_0x41cf38(0x2cd)]=_0x68511c;}),_0x2076a5[_0x33cc64(0x208)]((_0x33b58a,_0x4ee052)=>{var _0x46a80a=_0x33cc64;_0x29c5e3[_0x4ee052][_0x46a80a(0x29c)]=_0x33b58a;}),_0x14ae1f[_0x33cc64(0x208)]((_0x327d49,_0x2ae34d)=>{var _0xf871b1=_0x33cc64;_0x29c5e3[_0x2ae34d][_0xf871b1(0x24c)]=_0x327d49;}),_0x414ead[_0x33cc64(0x208)]((_0xe1c12f,_0x116be2)=>{var _0x48f5c9=_0x33cc64;_0x29c5e3[_0x116be2][_0x48f5c9(0x29a)]=_0xe1c12f;}),_0x3f758c[_0x33cc64(0x208)]((_0x44f1e1,_0x4d55ef)=>{_0x29c5e3[_0x4d55ef]['return_qty']=_0x44f1e1;}),_0x555bf0['forEach']((_0x5ac50f,_0x42767a)=>{var _0x5499f9=_0x33cc64;_0x29c5e3[_0x42767a][_0x5499f9(0x248)]=_0x5ac50f;}),_0x5512f4['forEach']((_0x5dc8e6,_0x26c300)=>{var _0x4a9479=_0x33cc64;_0x29c5e3[_0x26c300][_0x4a9479(0x2cc)]=_0x5dc8e6;}),_0x2617e5[_0x33cc64(0x208)]((_0x51e3a4,_0x1882a7)=>{var _0x5f408b=_0x33cc64;_0x29c5e3[_0x1882a7][_0x5f408b(0x1d7)]=_0x51e3a4;}),_0x310e85[_0x33cc64(0x208)]((_0x4cf04d,_0x1f276)=>{var _0x3be50=_0x33cc64;_0x29c5e3[_0x1f276][_0x3be50(0x228)]=_0x4cf04d;}),_0xaf436a[_0x33cc64(0x208)]((_0x412646,_0x16efe9)=>{var _0xd353f1=_0x33cc64;_0x29c5e3[_0x16efe9][_0xd353f1(0x1cd)]=_0x412646;}),_0xc71dd[_0x33cc64(0x208)]((_0x21de26,_0x2533a4)=>{_0x29c5e3[_0x2533a4]['unit']=_0x21de26;}),_0xb5faa1['forEach']((_0x3a83af,_0x43e09e)=>{_0x29c5e3[_0x43e09e]['production_date']=_0x3a83af;}),_0x497216[_0x33cc64(0x208)]((_0x12f206,_0x2f63cb)=>{var _0x18fe9a=_0x33cc64;_0x29c5e3[_0x2f63cb][_0x18fe9a(0x2d3)]=_0x12f206;});var _0x1d75d1=0x0;_0x29c5e3[_0x33cc64(0x208)](_0x104403=>{var _0xf408c0=_0x33cc64;(parseInt(_0x104403[_0xf408c0(0x29a)])<parseInt(_0x104403['return_qty'])||parseInt(_0x104403['stock'])<parseInt(_0x104403[_0xf408c0(0x1cb)])&&parseInt(_0x104403[_0xf408c0(0x29a)])>parseInt(_0x104403['return_qty'])||parseInt(_0x104403['return_qty'])==0x0)&&_0x1d75d1++;});if(_0x1d75d1!=0x0)return _0x141f9f[_0x33cc64(0x280)](_0x33cc64(0x2a1),_0x33cc64(0x21f)),_0x52e279[_0x33cc64(0x272)](_0x33cc64(0x26b));const _0x6ef8da=await sales_finished['findOne']({'invoice':_0x2f302c});_0x6ef8da[_0x33cc64(0x2cf)]=_0x33cc64(0x1ed);const _0x535854=await _0x6ef8da[_0x33cc64(0x257)](),_0x3416e2=new sales_return_finished({'invoice':_0x2f302c,'customer':_0x141f9f['body']['customer'],'date':_0x1ed453,'warehouse_name':_0x26145e,'room':_0x51b332,'ToWarehouse':_0x32d62f,'ToRoom':_0x49f5b3,'return_sale':_0x29c5e3,'note':_0x2a5599,'warehouse_cat':_0x3505f5}),_0x27dd98=await _0x3416e2[_0x33cc64(0x257)](),_0x2c9e78=await sales_return_finished[_0x33cc64(0x296)]({'invoice':_0x2f302c}),_0x4f55fa=await warehouse[_0x33cc64(0x296)]({'name':_0x32d62f,'room':_0x49f5b3,'warehouse_category':_0x33cc64(0x26f)});_0x2c9e78[_0x33cc64(0x2c4)]['forEach'](_0x63c661=>{var _0x33797e=_0x33cc64,_0x1d0c0e=0x0;const _0x40d449=_0x4f55fa[_0x33797e(0x1dc)][_0x33797e(0x2e0)](_0x2ed0f8=>{var _0x4ba057=_0x33797e;_0x2ed0f8[_0x4ba057(0x298)]==_0x63c661[_0x4ba057(0x298)]&&_0x2ed0f8[_0x4ba057(0x248)]==_0x63c661[_0x4ba057(0x248)]&&_0x2ed0f8['expiry_date']==_0x63c661[_0x4ba057(0x2d3)]&&_0x2ed0f8[_0x4ba057(0x2b2)]==_0x63c661['production_date']&&_0x2ed0f8[_0x4ba057(0x228)]==_0x63c661[_0x4ba057(0x228)]&&(_0x2ed0f8[_0x4ba057(0x26a)]=parseInt(_0x2ed0f8[_0x4ba057(0x26a)])+parseInt(_0x63c661[_0x4ba057(0x1cb)]),_0x1d0c0e++);});_0x1d0c0e=='0'&&(_0x4f55fa[_0x33797e(0x1dc)]=_0x4f55fa['product_details'][_0x33797e(0x243)]({'product_name':_0x63c661['product_name'],'product_stock':_0x63c661[_0x33797e(0x1cb)],'primary_code':_0x63c661[_0x33797e(0x2cd)],'secondary_code':_0x63c661[_0x33797e(0x29c)],'product_code':_0x63c661[_0x33797e(0x24c)],'bay':_0x63c661[_0x33797e(0x248)],'batch_code':_0x63c661[_0x33797e(0x228)],'maxPerUnit':_0x63c661[_0x33797e(0x2cc)],'production_date':_0x63c661[_0x33797e(0x2b2)],'expiry_date':_0x63c661['expiry_date'],'secondary_unit':_0x63c661[_0x33797e(0x1cd)],'unit':_0x63c661['unit'],'maxProducts':_0x63c661['maxProducts']}));}),await _0x4f55fa[_0x33cc64(0x257)](),console[_0x33cc64(0x202)](_0x141f9f[_0x33cc64(0x203)]);const _0xca4a00=new c_payment_data({'invoice':_0x2f302c,'customer':_0x141f9f['body']['customer'],'reason':'Sale\x20Return'});await _0xca4a00[_0x33cc64(0x257)]();const _0x38f11c=await master_shop['find']();console[_0x33cc64(0x202)](_0x33cc64(0x264),_0x38f11c[0x0]['image']);const _0x3c6184=await email_settings[_0x33cc64(0x296)](),_0x4466ad=await customer[_0x33cc64(0x296)]({'name':_0x141f9f[_0x33cc64(0x203)][_0x33cc64(0x2e4)]});console[_0x33cc64(0x202)]('customer_data',_0x4466ad);_0x38f11c[0x0][_0x33cc64(0x265)]==0x1?(right_currency=_0x38f11c[0x0][_0x33cc64(0x1d8)],left_currency=''):(right_currency='',left_currency=_0x38f11c[0x0][_0x33cc64(0x1d8)]);var _0x13d33d=_0x437851,_0x4b22d0=_0x3f758c,_0x16dee5='',_0x33cf3d;for(_0x33cf3d in _0x13d33d){_0x16dee5+=_0x33cc64(0x28b)+_0x33cc64(0x1e2)+_0x13d33d[_0x33cf3d]+_0x33cc64(0x295)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b22d0[_0x33cf3d]+_0x33cc64(0x295)+'</tr>';}console[_0x33cc64(0x202)](_0x33cc64(0x2ad),_0x16dee5);let _0x459ab8=nodemailer[_0x33cc64(0x2a2)]({'service':_0x33cc64(0x224),'auth':{'user':_0x3c6184[_0x33cc64(0x253)],'pass':_0x3c6184[_0x33cc64(0x25f)]}}),_0x166c47={'from':_0x3c6184['email'],'to':_0x4466ad[_0x33cc64(0x253)],'subject':_0x33cc64(0x218),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x33cc64(0x1e8)+_0x38f11c[0x0][_0x33cc64(0x201)],'cid':_0x33cc64(0x2c0)}],'html':_0x33cc64(0x27f)+_0x33cc64(0x2d8)+_0x33cc64(0x251)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x33cc64(0x1ea)+_0x33cc64(0x27c)+_0x33cc64(0x2c8)+'<div>'+'<h2>\x20'+_0x38f11c[0x0][_0x33cc64(0x259)]+_0x33cc64(0x2b1)+_0x33cc64(0x2c8)+_0x33cc64(0x2c8)+_0x33cc64(0x266)+_0x33cc64(0x1ea)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x33cc64(0x2d4)+_0x2f302c+'\x20'+_0x33cc64(0x2ab)+'\x20Order\x20Date\x20:\x20'+_0x1ed453+'\x20'+_0x33cc64(0x2e2)+_0x33cc64(0x256)+_0x33cc64(0x2c8)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x33cc64(0x2ca)+_0x33cc64(0x28b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x33cc64(0x255)+_0x33cc64(0x20b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x33cc64(0x2b3)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x16dee5+'\x20'+'</tbody>'+_0x33cc64(0x234)+_0x33cc64(0x1ea)+_0x33cc64(0x2de)+_0x33cc64(0x1dd)+_0x38f11c[0x0][_0x33cc64(0x259)]+_0x33cc64(0x256)+_0x33cc64(0x2c8)+_0x33cc64(0x2c8)+'</body></html>'};_0x459ab8['sendMail'](_0x166c47,function(_0x5bd449,_0x4f376a){var _0x5bd0c=_0x33cc64;_0x5bd449?(console['log'](_0x5bd449),console[_0x5bd0c(0x202)]('Error\x20Occurs')):console[_0x5bd0c(0x202)](_0x5bd0c(0x2c2));}),_0x141f9f[_0x33cc64(0x280)](_0x33cc64(0x2c5),_0x33cc64(0x26c)),_0x52e279[_0x33cc64(0x272)](_0x33cc64(0x25a));}catch(_0x2c112a){console['log'](_0x2c112a),_0x52e279[_0x33cc64(0x2e3)](0xc8)['json']({'message1':_0x2c112a['message']});}}}),router['get'](a0_0x4a2edb(0x289),auth,async(_0x232492,_0x52d3a8)=>{var _0x48ba5a=a0_0x4a2edb;try{const {username:_0x492443,email:_0x1c7087,role:_0x108983}=_0x232492[_0x48ba5a(0x1f4)],_0x338b94=_0x232492[_0x48ba5a(0x1f4)],_0x5d27ad=await profile[_0x48ba5a(0x296)]({'email':_0x338b94[_0x48ba5a(0x253)]}),_0x503d9d=await master_shop[_0x48ba5a(0x21a)]();console['log'](_0x48ba5a(0x25d),_0x503d9d);const _0x5bce20=_0x232492[_0x48ba5a(0x2a3)]['id'],_0x40701d=await sales['findById'](_0x5bce20);console[_0x48ba5a(0x202)](_0x48ba5a(0x229),_0x40701d);if(_0x503d9d[0x0][_0x48ba5a(0x2bb)]==_0x48ba5a(0x1e7))var _0x128fca=users[_0x48ba5a(0x207)];else{if(_0x503d9d[0x0][_0x48ba5a(0x2bb)]==_0x48ba5a(0x24d))var _0x128fca=users['Hindi'];else{if(_0x503d9d[0x0]['language']==_0x48ba5a(0x1de))var _0x128fca=users['German'];else{if(_0x503d9d[0x0][_0x48ba5a(0x2bb)]=='Spanish')var _0x128fca=users[_0x48ba5a(0x1e1)];else{if(_0x503d9d[0x0][_0x48ba5a(0x2bb)]==_0x48ba5a(0x1c9))var _0x128fca=users[_0x48ba5a(0x1c9)];else{if(_0x503d9d[0x0][_0x48ba5a(0x2bb)]==_0x48ba5a(0x2d0))var _0x128fca=users[_0x48ba5a(0x2b4)];else{if(_0x503d9d[0x0][_0x48ba5a(0x2bb)]=='Chinese')var _0x128fca=users[_0x48ba5a(0x2b0)];else{if(_0x503d9d[0x0]['language']==_0x48ba5a(0x278))var _0x128fca=users[_0x48ba5a(0x206)];}}}}}}}_0x52d3a8[_0x48ba5a(0x2db)](_0x48ba5a(0x2c7),{'success':_0x232492[_0x48ba5a(0x280)](_0x48ba5a(0x2c5)),'errors':_0x232492[_0x48ba5a(0x280)](_0x48ba5a(0x2a1)),'role':_0x338b94,'profile':_0x5d27ad,'alldata':_0x40701d,'master_shop':_0x503d9d,'language':_0x128fca});}catch(_0x5506c1){console[_0x48ba5a(0x202)](_0x5506c1);}}),router['post'](a0_0x4a2edb(0x2a8),async(_0x32a19d,_0x3de2c3)=>{var _0x42eecf=a0_0x4a2edb;const {product_code:_0x49b7cf,warehouse_name:_0x5164c5,rooms_data:_0x29e5ae,Roomslist:_0x26c795}=_0x32a19d[_0x42eecf(0x203)],_0x587209=_0x26c795['split'](','),_0x2b3794=[];async function _0x552a4b(_0x3d177f){var _0x3584bb=_0x42eecf;const _0x396d31=await warehouse['aggregate']([{'$match':{'name':_0x5164c5,'room':_0x3d177f}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x49b7cf}},{'$group':{'_id':_0x3584bb(0x1ec),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3584bb(0x1ef)},'primary_code':{'$first':_0x3584bb(0x2ba)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3584bb(0x1e3)},'level':{'$first':_0x3584bb(0x217)},'isle':{'$first':_0x3584bb(0x20d)},'type':{'$first':_0x3584bb(0x21e)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x3584bb(0x260)},'storage':{'$first':_0x3584bb(0x2aa)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x3584bb(0x2af)},'maxPerUnit':{'$first':_0x3584bb(0x2c6)},'batch_code':{'$first':_0x3584bb(0x249)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x3584bb(0x20c)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x437032=await warehouse[_0x3584bb(0x1db)]([{'$match':{'name':_0x5164c5,'room':_0x3d177f}},{'$unwind':_0x3584bb(0x1f2)},{'$match':{'product_details.secondary_code':_0x49b7cf}},{'$group':{'_id':_0x3584bb(0x1ec),'name':{'$first':_0x3584bb(0x271)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3584bb(0x2ba)},'secondary_code':{'$first':_0x3584bb(0x1d4)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x3584bb(0x217)},'isle':{'$first':_0x3584bb(0x20d)},'type':{'$first':_0x3584bb(0x21e)},'pallet':{'$first':_0x3584bb(0x2b9)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x3584bb(0x260)},'storage':{'$first':_0x3584bb(0x2aa)},'rack':{'$first':_0x3584bb(0x1ff)},'expiry_date':{'$first':_0x3584bb(0x2e5)},'production_date':{'$first':_0x3584bb(0x2af)},'maxPerUnit':{'$first':_0x3584bb(0x2c6)},'batch_code':{'$first':_0x3584bb(0x249)},'product_cat':{'$first':_0x3584bb(0x1fa)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x3584bb(0x20c)},'invoice':{'$first':_0x3584bb(0x24e)}}}]);if(_0x396d31[_0x3584bb(0x1d1)]>0x0)_0x2b3794[_0x3584bb(0x22a)](_0x396d31);else _0x437032[_0x3584bb(0x1d1)]>0x0&&_0x2b3794['push'](_0x437032);}const _0x351e4c=_0x587209[_0x42eecf(0x2e0)](_0x27cf97=>_0x552a4b(_0x27cf97));await Promise[_0x42eecf(0x1d5)](_0x351e4c),_0x3de2c3[_0x42eecf(0x2ce)](_0x2b3794);}),module[a0_0x4a2edb(0x2d9)]=router;