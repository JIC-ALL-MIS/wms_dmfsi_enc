var a0_0x296db2=a0_0x5d2f;(function(_0x168afc,_0x41d5a6){var _0x5321cd=a0_0x5d2f,_0x561c0f=_0x168afc();while(!![]){try{var _0x5ed58b=parseInt(_0x5321cd(0x261))/0x1+-parseInt(_0x5321cd(0x290))/0x2+-parseInt(_0x5321cd(0x1e5))/0x3+-parseInt(_0x5321cd(0x2c2))/0x4*(-parseInt(_0x5321cd(0x254))/0x5)+parseInt(_0x5321cd(0x221))/0x6+-parseInt(_0x5321cd(0x289))/0x7*(parseInt(_0x5321cd(0x1da))/0x8)+-parseInt(_0x5321cd(0x244))/0x9*(parseInt(_0x5321cd(0x214))/0xa);if(_0x5ed58b===_0x41d5a6)break;else _0x561c0f['push'](_0x561c0f['shift']());}catch(_0x3679e7){_0x561c0f['push'](_0x561c0f['shift']());}}}(a0_0x378c,0xbd54b));const express=require(a0_0x296db2(0x2c5)),app=express(),router=express[a0_0x296db2(0x2a4)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x296db2(0x27a)),auth=require('../middleware/auth'),nodemailer=require(a0_0x296db2(0x205)),users=require(a0_0x296db2(0x20d));router[a0_0x296db2(0x2d5)](a0_0x296db2(0x1ff),auth,async(_0x1bad6f,_0x23261c)=>{var _0x5bb302=a0_0x296db2;try{const {username:_0x143e4b,email:_0x3356ca,role:_0x48da4a}=_0x1bad6f['user'],_0x2a0dfc=_0x1bad6f[_0x5bb302(0x2de)],_0x5266ec=await profile[_0x5bb302(0x230)]({'email':_0x2a0dfc['email']}),_0xa1e5df=await master_shop[_0x5bb302(0x25b)]();let _0x34ff44;if(_0x2a0dfc[_0x5bb302(0x1ee)]=='staff'){const _0x48e83f=await staff[_0x5bb302(0x230)]({'email':_0x2a0dfc[_0x5bb302(0x2a9)]});_0x34ff44=await sales_finished['aggregate']([{'$lookup':{'from':_0x5bb302(0x270),'localField':_0x5bb302(0x2a1),'foreignField':_0x5bb302(0x2dd),'as':_0x5bb302(0x1f4)}},{'$unwind':_0x5bb302(0x282)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x5bb302(0x279),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x5bb302(0x2b5)},'date':{'$first':_0x5bb302(0x23b)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x5bb302(0x216)},'note':{'$first':_0x5bb302(0x265)},'return_data':{'$first':_0x5bb302(0x27c)},'customers_docs':{'$first':_0x5bb302(0x282)},'total_saleproduct_quantity':{'$sum':_0x5bb302(0x2be)},'level':{'$addToSet':_0x5bb302(0x227)},'isle':{'$addToSet':_0x5bb302(0x25f)},'type':{'$addToSet':_0x5bb302(0x26a)},'pallet':{'$addToSet':_0x5bb302(0x25d)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x34ff44=await sales_finished['aggregate']([{'$lookup':{'from':_0x5bb302(0x270),'localField':_0x5bb302(0x2a1),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0x5bb302(0x282)},{'$unwind':_0x5bb302(0x216)},{'$group':{'_id':_0x5bb302(0x279),'invoice':{'$first':_0x5bb302(0x1f9)},'customers':{'$first':_0x5bb302(0x2b5)},'date':{'$first':_0x5bb302(0x23b)},'warehouse_name':{'$first':_0x5bb302(0x1e2)},'sale_product':{'$push':_0x5bb302(0x216)},'note':{'$first':_0x5bb302(0x265)},'return_data':{'$first':_0x5bb302(0x27c)},'customers_docs':{'$first':_0x5bb302(0x282)},'total_saleproduct_quantity':{'$sum':_0x5bb302(0x2be)},'level':{'$addToSet':_0x5bb302(0x227)},'isle':{'$addToSet':_0x5bb302(0x25f)},'type':{'$addToSet':_0x5bb302(0x26a)},'pallet':{'$addToSet':_0x5bb302(0x25d)},'finalize':{'$first':_0x5bb302(0x2cd)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0xa1e5df[0x0]['language']==_0x5bb302(0x267)){var _0x512e6d=users['English'];console['log'](_0x512e6d);}else{if(_0xa1e5df[0x0][_0x5bb302(0x1cc)]==_0x5bb302(0x2e2))var _0x512e6d=users[_0x5bb302(0x2e2)];else{if(_0xa1e5df[0x0][_0x5bb302(0x1cc)]==_0x5bb302(0x225))var _0x512e6d=users[_0x5bb302(0x225)];else{if(_0xa1e5df[0x0][_0x5bb302(0x1cc)]==_0x5bb302(0x275))var _0x512e6d=users['Spanish'];else{if(_0xa1e5df[0x0]['language']==_0x5bb302(0x202))var _0x512e6d=users[_0x5bb302(0x202)];else{if(_0xa1e5df[0x0][_0x5bb302(0x1cc)]==_0x5bb302(0x232))var _0x512e6d=users[_0x5bb302(0x1d9)];else{if(_0xa1e5df[0x0][_0x5bb302(0x1cc)]==_0x5bb302(0x228))var _0x512e6d=users[_0x5bb302(0x228)];else{if(_0xa1e5df[0x0][_0x5bb302(0x1cc)]==_0x5bb302(0x24e))var _0x512e6d=users[_0x5bb302(0x262)];}}}}}}}_0x23261c[_0x5bb302(0x2c7)](_0x5bb302(0x23c),{'success':_0x1bad6f[_0x5bb302(0x21e)](_0x5bb302(0x264)),'errors':_0x1bad6f[_0x5bb302(0x21e)](_0x5bb302(0x24c)),'sales':_0x34ff44,'profile':_0x5266ec,'role':_0x2a0dfc,'master_shop':_0xa1e5df,'language':_0x512e6d});}catch(_0x1dbf02){console[_0x5bb302(0x2b0)](_0x1dbf02);}});async function getRandom8DigitNumber(){var _0x53944d=a0_0x296db2;const _0xf45a41=0x989680,_0x559829=0x5f5e0ff,_0x6fd757=Math[_0x53944d(0x249)](Math[_0x53944d(0x24b)]()*(_0x559829-_0xf45a41+0x1))+_0xf45a41;var _0x145cde;const _0x722bb9=await sales_finished[_0x53944d(0x230)]({'invoice':_0x53944d(0x21f)+_0x6fd757});return _0x722bb9&&_0x722bb9['length']>0x0?_0x145cde=_0x53944d(0x21f)+_0x6fd757:_0x145cde=_0x53944d(0x21f)+_0x6fd757,_0x145cde;}function a0_0x378c(){var _0xf7e864=['date','</h5>','amount','$customer','$product_details.production_date','$product_details.product_cat','back','$product_details.product_name','maxProducts_QA','findById','\x20Order\x20Number\x20:\x20','primary_unit','$sale_product.quantity','stock_data','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','5854516IHyaMT','prod_code','batch_code_QA','express','product_stock','render','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','forEach','</body></html>','<h5>','$finalize','post','primary_code_QA','$product_details.storage','product_code','/view/:id','</tbody>','True','get','$product_details.bay','$name','$room','False','getMonth','padStart','unit_QA','name','user','<tbody\x20style=\x22text-align:\x20center;\x22>','maxPerUnit','An\x20error\x20occurred.','Hindi','$product_details.primary_code','Email\x20sent\x20successfully','max_per_unit','Sales\x20Add\x20successfully','language','<span\x20style=\x22float:\x20right;\x22>','return_data','length','product','final','Received\x20Payment\x20For\x20Sale','carton','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Enclosed','json','all','/view/add_sale/product','Portuguese','642272YrIJkA','<div>','Return\x20Goods','$product_details.type','DRY\x20GOODS','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','quantity','params','$warehouse_name','currency_placement','/upload/','790257XzBwRj','secondary_unit_QA','product_date','<strong>\x20Regards\x20</strong>','out_invoice','product_name_QA1','$product','$product_details.secondary_unit','product_details','role','return_sale_QA','site_title','<h2>\x20','stock','add_sales_finished','customers_docs','slice','filter','$product_details.product_code','Finished\x20Goods','$invoice','<!DOCTYPE\x20html>','Error\x20Occurs','RoomAssigned','sale_qty','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/view','$product.product_name','$product_details.rack','French','stocks_QA','note','nodemailer','batch_code','</thead>','$product_details.maxProducts','Return\x20Rooms','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','received_amount','staff','../public/language/languages.json','room','bay','warehouse','</div>','Sale\x20Return\x20Mail','host','7712940BDqGyD','save','$sale_product','maxPerUnit_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','password','barcode\x20Product\x20master','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','getFullYear','return_qty','flash','OUTF-','maxProducts','6592356kIKGhO','port','purchases_data','product_list','German','secondary_code_QA','$sale_product.bay','Chinese','$product_details','secondary_code','prod_invoice','$product_details.floorlevel','</tr>','sales\x20item\x20return\x20successfull','expiry_date','findOne','primary_code','Portuguese\x20(BR)','An\x20error\x20occurred\x20while\x20saving\x20data.','logo','QA\x20Warehouse','sales_invoice','finalize','/all_sales/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','date_data','$date','all_sales_finished','gmail','/give_payment/:id','Ambient','suppliers','$product_details.bin','add\x20post','<tr>','9EnrJGK','/all_sales_finished/preview/','/view/add_sales/:id','<html><head><title></title>','concat','floor','_id','random','errors','Sales\x20Mail','Arabic\x20(ae)','/view/add_sales','adjust_qty','production_date_QA','Enabled','room_name','5uXKiCu','split','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.secondary_code','warehouse_name','$product_details.batch_code','image','find','catch','$sale_product.floorlevel','string','$sale_product.bin','</td>','370696mazvKM','Arabic','return_qty_QA','success','$note','/view/return_sales/:id','English\x20(US)','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','\x20</h2>','$sale_product.type','sale_product','$product_details.maxPerUnit','barcode\x20user_id','master','$product_details.expiry_date','customers','all_sales_barcode','for_categorize','FGSEmail','prod_cat','Spanish','payment\x20successfull','aggregate','/preview/:id','$_id','../models/all_models','getDate','$return_data','level','body','Sale','secondary_unit','abs','$customers_docs','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','</span>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.invoice','invoice','14SZdzzW','product_code_QA','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/all_sales_finished/view','$product_details._id','message','sales_quantity','1924542Ruryxy','status','map','expiry_date_QA','/picking_list/pdf/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.unit','redirect','<h5\x20style=\x22text-align:\x20left;\x22>','max','sendMail','currency','Quality\x20Inspection','$product_details.product_stock','</head><body>','Logo.png','createTransport','customer','<hr\x20class=\x22my-3\x22>','error','Router','/../public','unit','id_transaction_from','product_name','email','push','\x20Order\x20Date\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/barcode/:id','sales_quantity_QA','English','log','Sales\x20Update\x20successfully'];a0_0x378c=function(){return _0xf7e864;};return a0_0x378c();}function a0_0x5d2f(_0x17e86d,_0x2dca51){var _0x378c09=a0_0x378c();return a0_0x5d2f=function(_0x5d2f6d,_0x2ea8a9){_0x5d2f6d=_0x5d2f6d-0x1cc;var _0x3c2fda=_0x378c09[_0x5d2f6d];return _0x3c2fda;},a0_0x5d2f(_0x17e86d,_0x2dca51);}router[a0_0x296db2(0x2d5)](a0_0x296db2(0x24f),auth,async(_0x5799e1,_0xbf5a76)=>{var _0x2baaa1=a0_0x296db2;try{const {username:_0x39892e,email:_0x5ca9ad,role:_0xd754cb}=_0x5799e1[_0x2baaa1(0x2de)],_0x1dc948=_0x5799e1[_0x2baaa1(0x2de)],_0xe515a4=await profile[_0x2baaa1(0x230)]({'email':_0x1dc948[_0x2baaa1(0x2a9)]}),_0x1051fa=await master_shop[_0x2baaa1(0x25b)](),_0x2d26b8=await customer[_0x2baaa1(0x25b)]({});let _0x20c900;if(_0x1dc948[_0x2baaa1(0x1ee)]=='staff'){const _0x598358=await staff[_0x2baaa1(0x230)]({'email':_0x1dc948[_0x2baaa1(0x2a9)]});_0x20c900=await warehouse[_0x2baaa1(0x277)]([{'$match':{'status':_0x2baaa1(0x252),'name':_0x598358[_0x2baaa1(0x210)],'warehouse_category':_0x2baaa1(0x1f8),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x2baaa1(0x2d7)}}},{'$sort':{'name':0x1}}]);}else _0x20c900=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x2baaa1(0x1f8),'name':{'$ne':_0x2baaa1(0x235)}}},{'$group':{'_id':_0x2baaa1(0x2d7),'name':{'$first':_0x2baaa1(0x2d7)}}},{'$sort':{'name':0x1}}]);const _0x16f8b0=await product[_0x2baaa1(0x25b)]({});var _0x29c323=['Ambient',_0x2baaa1(0x1d5)];const _0x40d0a1=await sales_finished[_0x2baaa1(0x25b)]({}),_0x49cc2d=_0x40d0a1[_0x2baaa1(0x1cf)]+0x1,_0x1e64d6=_0x2baaa1(0x21f)+_0x49cc2d['toString']()[_0x2baaa1(0x2db)](0x5,'0');if(_0x1051fa[0x0]['language']==_0x2baaa1(0x267)){var _0x446a30=users['English'];console[_0x2baaa1(0x2b0)](_0x446a30);}else{if(_0x1051fa[0x0]['language']==_0x2baaa1(0x2e2))var _0x446a30=users['Hindi'];else{if(_0x1051fa[0x0]['language']==_0x2baaa1(0x225))var _0x446a30=users[_0x2baaa1(0x225)];else{if(_0x1051fa[0x0][_0x2baaa1(0x1cc)]==_0x2baaa1(0x275))var _0x446a30=users[_0x2baaa1(0x275)];else{if(_0x1051fa[0x0][_0x2baaa1(0x1cc)]==_0x2baaa1(0x202))var _0x446a30=users[_0x2baaa1(0x202)];else{if(_0x1051fa[0x0][_0x2baaa1(0x1cc)]=='Portuguese\x20(BR)')var _0x446a30=users['Portuguese'];else{if(_0x1051fa[0x0]['language']==_0x2baaa1(0x228))var _0x446a30=users[_0x2baaa1(0x228)];else{if(_0x1051fa[0x0][_0x2baaa1(0x1cc)]==_0x2baaa1(0x24e))var _0x446a30=users[_0x2baaa1(0x262)];}}}}}}}const _0xee889f=getRandom8DigitNumber();_0xee889f['then'](_0x21ceff=>{var _0x519b10=_0x2baaa1;_0xbf5a76[_0x519b10(0x2c7)](_0x519b10(0x1f3),{'success':_0x5799e1[_0x519b10(0x21e)](_0x519b10(0x264)),'errors':_0x5799e1[_0x519b10(0x21e)](_0x519b10(0x24c)),'role':_0x1dc948,'profile':_0xe515a4,'customer':_0x2d26b8,'warehouse':_0x20c900,'product':_0x16f8b0,'invoice':_0x21ceff,'master_shop':_0x1051fa,'language':_0x446a30,'rooms_data':_0x29c323});})[_0x2baaa1(0x25c)](_0x51956a=>{var _0x4b9b4d=_0x2baaa1;_0x5799e1['flash']('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0xbf5a76[_0x4b9b4d(0x297)](_0x4b9b4d(0x28c));});}catch(_0x283421){console[_0x2baaa1(0x2b0)](_0x283421);}}),router[a0_0x296db2(0x2d5)](a0_0x296db2(0x246),auth,async(_0x58d643,_0x4af728)=>{var _0x25b083=a0_0x296db2;try{const _0x273c51=_0x58d643['params']['id'];console[_0x25b083(0x2b0)](_0x273c51);const _0x46804e=await product[_0x25b083(0x25b)](),_0x5986c2=await purchases[_0x25b083(0x277)]([{'$match':{'warehouse_name':_0x273c51}},{'$unwind':_0x25b083(0x1eb)},{'$group':{'_id':_0x25b083(0x200)}}]);console[_0x25b083(0x2b0)](_0x25b083(0x223),_0x5986c2),_0x4af728[_0x25b083(0x291)](0xc8)[_0x25b083(0x1d6)]({'purchases_data':_0x5986c2,'product_data':_0x46804e});}catch(_0x34f8e7){console[_0x25b083(0x2b0)](_0x34f8e7);}}),router['post'](a0_0x296db2(0x1d8),auth,async(_0x279fd8,_0x1c6a40)=>{var _0x1d97d3=a0_0x296db2;try{const {warehouse_data:_0x141762,product_data:_0x1184c0}=_0x279fd8[_0x1d97d3(0x27e)];console[_0x1d97d3(0x2b0)](_0x279fd8[_0x1d97d3(0x27e)]['product_data']);;const _0x1d1197=await master_shop[_0x1d97d3(0x25b)]();console[_0x1d97d3(0x2b0)](_0x1d97d3(0x26e),_0x1d1197);const _0x5db460=await product[_0x1d97d3(0x230)]({'name':_0x1184c0});console[_0x1d97d3(0x2b0)](_0x1d97d3(0x1d0),_0x5db460);const _0x4cd2c1=await warehouse[_0x1d97d3(0x277)]([{'$match':{'name':_0x141762}},{'$unwind':_0x1d97d3(0x229)},{'$match':{'product_details.product_name':_0x1184c0}},{'$group':{'_id':_0x1d97d3(0x2b9),'product_stock':{'$first':_0x1d97d3(0x29d)}}}]);console[_0x1d97d3(0x2b0)](_0x1d97d3(0x2bf),_0x4cd2c1),_0x1c6a40['status'](0xc8)[_0x1d97d3(0x1d6)]({'master':_0x1d1197,'new_product':_0x5db460,'stock_data':_0x4cd2c1});}catch(_0x24efe3){console[_0x1d97d3(0x2b0)](_0x24efe3);}}),router[a0_0x296db2(0x2ce)]('/view/add_sales',auth,async(_0x2603cf,_0x561fe7)=>{var _0x28b6a7=a0_0x296db2;try{const {invoice:_0x48ccd4,date:_0x12bdda,warehouse_name:_0x4ec361,product_name:_0x3c50f9,stock:_0x67df48,quantity:_0x26a9cb,note:_0x1ae316,room:_0x233a7c,primary_code:_0xf64ba4,secondary_code:_0x39fa91,prod_code:_0x3bad4d,level:_0x612f80,isle:_0x3dd82c,pallet:_0x184bfb,batch_code:_0x47a393,SCRN:_0x401f72,expiry_date:_0x72afba,mode_transpo:_0x4a2151,name_driver:_0x5099c8}=_0x2603cf['body'];if(typeof _0x3c50f9=='string')var _0x527157=[_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x2a8)]],_0x5b9a64=[_0x2603cf['body']['stock']],_0x3211c8=[_0x2603cf['body']['carton']],_0x5add75=[_0x2603cf[_0x28b6a7(0x27e)]['primary_code']],_0x49e7ce=[_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x22a)]],_0x28e7d3=[_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x2c3)]],_0x846e84=[_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x27d)]],_0x49b931=[_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x2bd)]],_0x1d201e=[_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x280)]],_0x23aeb4=[_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x206)]],_0x26fe90=[_0x2603cf['body'][_0x28b6a7(0x22f)]],_0x2672e6=[_0x2603cf['body'][_0x28b6a7(0x1e7)]],_0x55ec74=[_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x2e5)]],_0x4cd9be=[_0x2603cf['body'][_0x28b6a7(0x274)]],_0x29f664=[_0x2603cf[_0x28b6a7(0x27e)]['RoomAssigned']],_0x127651=[_0x2603cf[_0x28b6a7(0x27e)]['prod_invoice']],_0x5e229a=[_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x2a7)]];else var _0x527157=[..._0x2603cf['body']['product_name']],_0x5b9a64=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x1f2)]],_0x3211c8=[..._0x2603cf['body'][_0x28b6a7(0x1d3)]],_0x5add75=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x231)]],_0x49e7ce=[..._0x2603cf[_0x28b6a7(0x27e)]['secondary_code']],_0x28e7d3=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x2c3)]],_0x846e84=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x27d)]],_0x49b931=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x2bd)]],_0x1d201e=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x280)]],_0x23aeb4=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x206)]],_0x26fe90=[..._0x2603cf[_0x28b6a7(0x27e)]['expiry_date']],_0x2672e6=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x1e7)]],_0x55ec74=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x2e5)]],_0x4cd9be=[..._0x2603cf[_0x28b6a7(0x27e)]['prod_cat']],_0x29f664=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x1fc)]],_0x127651=[..._0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x22b)]],_0x5e229a=[..._0x2603cf[_0x28b6a7(0x27e)]['id_transaction_from']];const _0x18779c=_0x527157[_0x28b6a7(0x292)](_0x1d11b5=>{return _0x1d11b5={'product_name':_0x1d11b5};});_0x5b9a64[_0x28b6a7(0x2ca)]((_0x44cc8f,_0x279f1d)=>{var _0x2554be=_0x28b6a7;_0x18779c[_0x279f1d][_0x2554be(0x1f2)]=_0x44cc8f;}),_0x3211c8[_0x28b6a7(0x2ca)]((_0x257953,_0x5ed76b)=>{var _0x46851f=_0x28b6a7;_0x18779c[_0x5ed76b][_0x46851f(0x1e0)]=Math[_0x46851f(0x281)](_0x257953);}),_0x5e229a[_0x28b6a7(0x2ca)]((_0x1d684a,_0x373121)=>{_0x18779c[_0x373121]['id_transaction_from']=_0x1d684a;}),_0x5add75[_0x28b6a7(0x2ca)]((_0x3b8b59,_0x4ab5e2)=>{var _0x38e692=_0x28b6a7;_0x18779c[_0x4ab5e2][_0x38e692(0x231)]=_0x3b8b59;}),_0x49e7ce[_0x28b6a7(0x2ca)]((_0x363474,_0x308d9b)=>{var _0xd4433b=_0x28b6a7;_0x18779c[_0x308d9b][_0xd4433b(0x22a)]=_0x363474;}),_0x28e7d3[_0x28b6a7(0x2ca)]((_0x1c2964,_0x1689f6)=>{var _0x2ad3a1=_0x28b6a7;_0x18779c[_0x1689f6][_0x2ad3a1(0x2d1)]=_0x1c2964,_0x18779c[_0x1689f6][_0x2ad3a1(0x23a)]=_0x12bdda;}),_0x846e84[_0x28b6a7(0x2ca)]((_0x3a9426,_0x11e1d5)=>{var _0x224a74=_0x28b6a7;_0x18779c[_0x11e1d5][_0x224a74(0x20f)]=_0x3a9426;}),_0x49b931[_0x28b6a7(0x2ca)]((_0x31a8ac,_0x17571d)=>{var _0xae5e11=_0x28b6a7;_0x18779c[_0x17571d][_0xae5e11(0x2a6)]=_0x31a8ac;}),_0x1d201e[_0x28b6a7(0x2ca)]((_0x55e4c4,_0x320f0f)=>{var _0x4c9ce5=_0x28b6a7;_0x18779c[_0x320f0f][_0x4c9ce5(0x280)]=_0x55e4c4;}),_0x23aeb4[_0x28b6a7(0x2ca)]((_0x1c4d3f,_0x6c524a)=>{var _0x28d583=_0x28b6a7;_0x18779c[_0x6c524a][_0x28d583(0x206)]=_0x1c4d3f;}),_0x26fe90[_0x28b6a7(0x2ca)]((_0x54290f,_0xbb4fd4)=>{var _0x1bffee=_0x28b6a7;_0x18779c[_0xbb4fd4][_0x1bffee(0x22f)]=_0x54290f;}),_0x2672e6['forEach']((_0x3948cc,_0x14a82f)=>{_0x18779c[_0x14a82f]['production_date']=_0x3948cc;}),_0x55ec74[_0x28b6a7(0x2ca)]((_0x1bf2d5,_0x2d5db8)=>{_0x18779c[_0x2d5db8]['maxperunit']=_0x1bf2d5;}),_0x4cd9be['forEach']((_0x5f1a5c,_0x6bca30)=>{var _0x131845=_0x28b6a7;_0x18779c[_0x6bca30][_0x131845(0x274)]=_0x5f1a5c;}),_0x29f664['forEach']((_0x369e5b,_0x32bdf2)=>{var _0x1fc0cf=_0x28b6a7;_0x18779c[_0x32bdf2][_0x1fc0cf(0x253)]=_0x369e5b;}),_0x127651['forEach']((_0x184676,_0x191378)=>{var _0x2097d7=_0x28b6a7;_0x18779c[_0x191378][_0x2097d7(0x288)]=_0x184676;});var _0x141a3c=0x0;_0x18779c[_0x28b6a7(0x2ca)](_0x9d03e3=>{var _0x5f2aa9=_0x28b6a7;parseFloat(_0x9d03e3[_0x5f2aa9(0x1f2)])<parseFloat(_0x9d03e3[_0x5f2aa9(0x1e0)])&&parseFloat(_0x9d03e3['quantity'])>parseFloat(_0x9d03e3['stock'])&&(console[_0x5f2aa9(0x2b0)](_0x9d03e3['stock']+'\x20<>\x20'+_0x9d03e3[_0x5f2aa9(0x1e0)]),_0x141a3c++);});if(_0x141a3c!=0x0)return _0x2603cf['flash'](_0x28b6a7(0x24c),_0x28b6a7(0x1df)),_0x561fe7[_0x28b6a7(0x297)](_0x28b6a7(0x2b8));const _0x2a2396=_0x18779c['filter'](_0x31e1ae=>_0x31e1ae[_0x28b6a7(0x1e0)]!=='0'&&_0x31e1ae[_0x28b6a7(0x1e0)]!==''),_0x341f91=new sales_finished({'invoice':_0x48ccd4,'customer':_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x2a1)],'date':_0x12bdda,'warehouse_name':_0x4ec361,'sale_product':_0x2a2396,'note':_0x1ae316,'room':_0x233a7c,'primary_code':_0xf64ba4,'secondary_code':_0x39fa91,'prod_code':_0x3bad4d,'SCRN':_0x401f72,'finalize':_0x28b6a7(0x2d9),'mode_transpo':_0x4a2151,'name_driver':_0x5099c8}),_0x38fca4=await _0x341f91[_0x28b6a7(0x215)](),_0x5f30ff=await sales_finished[_0x28b6a7(0x230)]({'invoice':_0x48ccd4}),_0x10e558=new c_payment_data({'invoice':_0x48ccd4,'customer':_0x2603cf['body']['customer'],'reason':_0x28b6a7(0x27f)});await _0x10e558[_0x28b6a7(0x215)]();const _0x4b93ba=await master_shop[_0x28b6a7(0x25b)](),_0x4454f8=await email_settings[_0x28b6a7(0x230)](),_0x37ad7b=await customer['findOne']({'name':_0x2603cf[_0x28b6a7(0x27e)][_0x28b6a7(0x2a1)]});_0x4b93ba[0x0]['currency_placement']==0x1?(right_currency=_0x4b93ba[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4b93ba[0x0]['currency']);var _0x47fa88=_0x527157,_0x3df546=_0x3211c8,_0x2eaf13='',_0x1ee1cf;for(_0x1ee1cf in _0x47fa88){_0x2eaf13+=_0x28b6a7(0x243)+_0x28b6a7(0x21b)+_0x47fa88[_0x1ee1cf]+'</td>'+_0x28b6a7(0x21b)+_0x3df546[_0x1ee1cf]+'</td>'+_0x28b6a7(0x22d);}console[_0x28b6a7(0x2b0)]('product_list',_0x2eaf13),_0x2603cf[_0x28b6a7(0x21e)]('success',_0x28b6a7(0x2e6)),_0x561fe7[_0x28b6a7(0x297)](_0x28b6a7(0x245)+_0x38fca4[_0x28b6a7(0x24a)]);}catch(_0x25a62d){console[_0x28b6a7(0x2b0)](_0x25a62d);}}),router[a0_0x296db2(0x2d5)]('/preview/:id',auth,async(_0x14f5bc,_0x22dd3d)=>{var _0x197bd3=a0_0x296db2;try{const {username:_0x5afe16,email:_0x305401,role:_0x1eb86d}=_0x14f5bc['user'],_0x5b31a4=_0x14f5bc[_0x197bd3(0x2de)],_0x4d2dd6=await profile['findOne']({'email':_0x5b31a4[_0x197bd3(0x2a9)]}),_0x522846=await master_shop[_0x197bd3(0x25b)](),_0x2d1d7c=_0x14f5bc[_0x197bd3(0x1e1)]['id'],_0xdfb52=await sales_finished[_0x197bd3(0x2bb)](_0x2d1d7c),_0x5a9ffa=await warehouse[_0x197bd3(0x277)]([{'$match':{'name':_0xdfb52['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x197bd3(0x28d),'name':{'$first':_0x197bd3(0x2b9)},'product_stock':{'$first':_0x197bd3(0x29d)},'bay':{'$first':_0x197bd3(0x2d6)},'bin':{'$first':_0x197bd3(0x241)},'type':{'$first':_0x197bd3(0x1dd)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x197bd3(0x2e3)},'secondary_code':{'$first':_0x197bd3(0x257)},'product_code':{'$first':_0x197bd3(0x1f7)},'storage':{'$first':_0x197bd3(0x2d0)},'rack':{'$first':_0x197bd3(0x201)},'expiry_date':{'$first':_0x197bd3(0x26f)},'production_date':{'$first':_0x197bd3(0x2b6)},'batch_code':{'$first':_0x197bd3(0x259)},'room':{'$first':_0x197bd3(0x2d8)},'room_data':{'$first':'$product_details.room_name'}}}]),_0x237f29=await customer['find']({});let _0x59ec16;if(_0x5b31a4[_0x197bd3(0x1ee)]==_0x197bd3(0x20c)){const _0x587070=await staff[_0x197bd3(0x230)]({'email':_0x5b31a4[_0x197bd3(0x2a9)]});_0x59ec16=await warehouse[_0x197bd3(0x277)]([{'$match':{'status':'Enabled','name':_0x587070[_0x197bd3(0x210)]}},{'$group':{'_id':_0x197bd3(0x2d7),'name':{'$first':_0x197bd3(0x2d7)}}}]);}else _0x59ec16=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x197bd3(0x2d7),'name':{'$first':_0x197bd3(0x2d7)}}}]);const _0x5bd114=await product['find']({});if(_0x522846[0x0][_0x197bd3(0x1cc)]==_0x197bd3(0x267)){var _0x582e4a=users[_0x197bd3(0x2af)];console[_0x197bd3(0x2b0)](_0x582e4a);}else{if(_0x522846[0x0][_0x197bd3(0x1cc)]==_0x197bd3(0x2e2))var _0x582e4a=users[_0x197bd3(0x2e2)];else{if(_0x522846[0x0]['language']==_0x197bd3(0x225))var _0x582e4a=users[_0x197bd3(0x225)];else{if(_0x522846[0x0][_0x197bd3(0x1cc)]==_0x197bd3(0x275))var _0x582e4a=users[_0x197bd3(0x275)];else{if(_0x522846[0x0][_0x197bd3(0x1cc)]==_0x197bd3(0x202))var _0x582e4a=users[_0x197bd3(0x202)];else{if(_0x522846[0x0]['language']==_0x197bd3(0x232))var _0x582e4a=users['Portuguese'];else{if(_0x522846[0x0][_0x197bd3(0x1cc)]==_0x197bd3(0x228))var _0x582e4a=users[_0x197bd3(0x228)];else{if(_0x522846[0x0][_0x197bd3(0x1cc)]==_0x197bd3(0x24e))var _0x582e4a=users[_0x197bd3(0x262)];}}}}}}}_0x22dd3d['render']('edit_sales_finished_view',{'success':_0x14f5bc[_0x197bd3(0x21e)](_0x197bd3(0x264)),'errors':_0x14f5bc['flash']('errors'),'role':_0x5b31a4,'profile':_0x4d2dd6,'customer':_0x237f29,'warehouse':_0x59ec16,'product':_0x5a9ffa,'user':_0xdfb52,'master_shop':_0x522846,'unit':_0x5bd114,'language':_0x582e4a});}catch(_0x4383b3){console[_0x197bd3(0x2b0)](_0x4383b3);}}),router[a0_0x296db2(0x2ce)](a0_0x296db2(0x278),auth,async(_0x153750,_0x3e96ca)=>{var _0x84c10e=a0_0x296db2;try{const _0xb75b4e=_0x153750[_0x84c10e(0x1e1)]['id'],{invoice:_0x248284,warehouse_name:_0x4fd70e,room:_0x328f96}=_0x153750[_0x84c10e(0x27e)],_0xa8d65a=await sales_finished[_0x84c10e(0x230)]({'invoice':_0x248284}),_0x4755ce=_0xa8d65a[_0x84c10e(0x26b)]['map'](async _0x472619=>{var _0x3338fd=_0x84c10e,_0x2e396c=await warehouse[_0x3338fd(0x230)]({'name':_0x4fd70e,'room':_0x472619[_0x3338fd(0x253)],'warehouse_category':_0x3338fd(0x1f8)});const _0x5385da=_0x2e396c[_0x3338fd(0x1ed)][_0x3338fd(0x292)](_0x4cdbea=>{var _0x13010d=_0x3338fd;if(_0x4cdbea[_0x13010d(0x2a8)]==_0x472619[_0x13010d(0x2a8)]&&_0x4cdbea[_0x13010d(0x20f)]==_0x472619['bay']&&_0x4cdbea[_0x13010d(0x22f)]==_0x472619[_0x13010d(0x22f)]&&_0x4cdbea[_0x13010d(0x2c8)]==_0x472619[_0x13010d(0x2c8)]&&_0x4cdbea['batch_code']==_0x472619[_0x13010d(0x206)]&&_0x4cdbea['_id']==_0x472619['id_transaction_from']){if(_0x4cdbea[_0x13010d(0x2c6)]>0x0){_0x4cdbea[_0x13010d(0x2c6)]=Math[_0x13010d(0x299)](0x0,Math['abs'](_0x4cdbea[_0x13010d(0x2c6)])-Math[_0x13010d(0x281)](_0x472619['quantity']));if(_0x4cdbea[_0x13010d(0x1e9)]==undefined)_0x4cdbea['out_invoice']=_0x248284+'~';else{var _0x2cab7d=_0x4cdbea[_0x13010d(0x1e9)]['split']('~'),_0x65bc55='';for(let _0x9fb902=0x0;_0x9fb902<=_0x2cab7d[_0x13010d(0x1cf)]-0x1;_0x9fb902++){const _0x33353f=_0x2cab7d[_0x9fb902];_0x33353f[_0x13010d(0x1cf)]>0x0&&(_0x65bc55+=_0x33353f+'~');}_0x4cdbea['out_invoice']=_0x65bc55;}}}});return console[_0x3338fd(0x2b0)](_0x2e396c),_0x2e396c;});Promise[_0x84c10e(0x1d7)](_0x4755ce)[_0x84c10e(0x283)](async _0x19c52e=>{var _0x495932=_0x84c10e;try{for(const _0x10fdd8 of _0x19c52e){await _0x10fdd8[_0x495932(0x215)]();}_0xa8d65a[_0x495932(0x237)]='True';const _0x2e8779=await _0xa8d65a['save'](),_0x3c96f8=await master_shop['find'](),_0x1fdc4b=await email_settings[_0x495932(0x230)](),_0x44f6fa=await supervisor_settings[_0x495932(0x25b)]();var _0x3ca5a0=_0xa8d65a[_0x495932(0x26b)],_0x128f63='',_0x2e6497;for(_0x2e6497 in _0x3ca5a0){var _0x165fd1='FG';_0xa8d65a['warehouse_name']==_0x495932(0x1de)&&(_0x165fd1='DG'),_0x128f63+='<tr>'+_0x495932(0x21b)+_0x3ca5a0[_0x2e6497][_0x495932(0x2a8)]+_0x495932(0x260)+_0x495932(0x21b)+_0x3ca5a0[_0x2e6497]['product_code']+'</td>'+_0x495932(0x21b)+_0x3ca5a0[_0x2e6497][_0x495932(0x1e0)]+_0x495932(0x260)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3ca5a0[_0x2e6497][_0x495932(0x2a6)]+_0x495932(0x260)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3ca5a0[_0x2e6497][_0x495932(0x280)]+_0x495932(0x260)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xa8d65a[_0x495932(0x258)]+_0x495932(0x260)+_0x495932(0x21b)+_0x3ca5a0[_0x2e6497]['room_name']+_0x495932(0x260)+_0x495932(0x21b)+_0x165fd1+_0x3ca5a0[_0x2e6497][_0x495932(0x20f)]+_0x495932(0x260);}let _0x5265d5=nodemailer[_0x495932(0x2a0)]({'host':_0x1fdc4b[_0x495932(0x213)],'port':Number(_0x1fdc4b[_0x495932(0x222)]),'secure':![],'auth':{'user':_0x1fdc4b['email'],'pass':_0x1fdc4b[_0x495932(0x219)]}}),_0x427c2b={'from':_0x1fdc4b[_0x495932(0x2a9)],'to':_0x44f6fa[0x0][_0x495932(0x273)],'subject':_0x495932(0x24d),'attachments':[{'filename':'Logo.png','path':__dirname+_0x495932(0x2a5)+_0x495932(0x1e4)+_0x3c96f8[0x0][_0x495932(0x25a)],'cid':'logo'}],'html':_0x495932(0x1fa)+_0x495932(0x247)+_0x495932(0x29e)+_0x495932(0x1db)+_0x495932(0x28b)+_0x495932(0x1db)+_0x495932(0x20a)+_0x495932(0x211)+_0x495932(0x1db)+'<h2>\x20'+_0x3c96f8[0x0]['site_title']+_0x495932(0x269)+_0x495932(0x211)+_0x495932(0x211)+_0x495932(0x2a2)+_0x495932(0x1db)+_0x495932(0x298)+_0x495932(0x2bc)+_0xa8d65a['invoice']+'\x20'+_0x495932(0x1cd)+_0x495932(0x2ab)+_0xa8d65a[_0x495932(0x2b2)]+'\x20'+_0x495932(0x285)+_0x495932(0x2b3)+_0x495932(0x211)+_0x495932(0x286)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x495932(0x2c1)+_0x495932(0x1d4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x495932(0x256)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x495932(0x2ac)+_0x495932(0x2c9)+_0x495932(0x284)+_0x495932(0x22d)+_0x495932(0x207)+_0x495932(0x2df)+'\x20'+_0x128f63+'\x20'+_0x495932(0x2d3)+'</table>'+'<div>'+_0x495932(0x1e8)+_0x495932(0x2cc)+_0x3c96f8[0x0][_0x495932(0x1f0)]+_0x495932(0x2b3)+_0x495932(0x211)+_0x495932(0x211)+'</body></html>'};_0x5265d5[_0x495932(0x29a)](_0x427c2b,function(_0x120a1c,_0x584643){var _0x2df536=_0x495932;_0x120a1c?(console[_0x2df536(0x2b0)](_0x120a1c),console[_0x2df536(0x2b0)]('Error\x20Occurs')):console[_0x2df536(0x2b0)](_0x2df536(0x2e4));}),_0x153750[_0x495932(0x21e)](_0x495932(0x264),_0x495932(0x2b1)),_0x3e96ca[_0x495932(0x297)](_0x495932(0x294)+_0xb75b4e);}catch(_0x446413){console[_0x495932(0x2a3)](_0x446413),_0x3e96ca[_0x495932(0x291)](0x1f4)[_0x495932(0x1d6)]({'error':_0x495932(0x233)});}})[_0x84c10e(0x25c)](_0x3d256e=>{var _0x2a0c9a=_0x84c10e;console['error'](_0x3d256e),_0x3e96ca['status'](0x1f4)[_0x2a0c9a(0x1d6)]({'error':_0x2a0c9a(0x2e1)});});}catch(_0x297a80){console[_0x84c10e(0x2b0)](_0x297a80);}}),router[a0_0x296db2(0x2d5)](a0_0x296db2(0x2d2),auth,async(_0x56340e,_0x141a3b)=>{var _0x3cf0a8=a0_0x296db2;try{const {username:_0x3486d5,email:_0x4d3680,role:_0x26a770}=_0x56340e[_0x3cf0a8(0x2de)],_0x4705c5=_0x56340e[_0x3cf0a8(0x2de)],_0x458e87=await profile[_0x3cf0a8(0x230)]({'email':_0x4705c5[_0x3cf0a8(0x2a9)]}),_0x1333ef=await master_shop[_0x3cf0a8(0x25b)](),_0x454884=_0x56340e[_0x3cf0a8(0x1e1)]['id'],_0x39ee31=await sales_finished[_0x3cf0a8(0x2bb)](_0x454884);let _0x47bb8c=new Date(_0x39ee31[_0x3cf0a8(0x22f)]),_0x12b4fd=('0'+_0x47bb8c[_0x3cf0a8(0x27b)]())['slice'](-0x2),_0x3ef559=('0'+(_0x47bb8c[_0x3cf0a8(0x2da)]()+0x1))[_0x3cf0a8(0x1f5)](-0x2),_0x3484be=_0x47bb8c[_0x3cf0a8(0x21c)](),_0x5b132b=_0x3484be+'-'+_0x3ef559+'-'+_0x12b4fd;var _0x2f39b0=[_0x3cf0a8(0x23f),_0x3cf0a8(0x1d5)];const _0x397ddd=await warehouse[_0x3cf0a8(0x277)]([{'$match':{'name':_0x39ee31[_0x3cf0a8(0x258)],'room':_0x39ee31['room']}},{'$unwind':_0x3cf0a8(0x229)},{'$group':{'_id':_0x3cf0a8(0x28d),'name':{'$first':_0x3cf0a8(0x2b9)},'product_stock':{'$first':_0x3cf0a8(0x29d)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x3cf0a8(0x241)},'type':{'$first':_0x3cf0a8(0x1dd)},'floorlevel':{'$first':_0x3cf0a8(0x22c)},'primary_code':{'$first':_0x3cf0a8(0x2e3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3cf0a8(0x1f7)},'storage':{'$first':_0x3cf0a8(0x2d0)},'rack':{'$first':_0x3cf0a8(0x201)}}}]),_0x3065ef=await customer[_0x3cf0a8(0x25b)]({});let _0x1a7cd8;if(_0x4705c5[_0x3cf0a8(0x1ee)]=='staff'){const _0x284f56=await staff['findOne']({'email':_0x4705c5[_0x3cf0a8(0x2a9)]});_0x1a7cd8=await warehouse[_0x3cf0a8(0x277)]([{'$match':{'status':_0x3cf0a8(0x252),'name':_0x284f56[_0x3cf0a8(0x210)]}},{'$group':{'_id':_0x3cf0a8(0x2d7),'name':{'$first':_0x3cf0a8(0x2d7)}}}]);}else _0x1a7cd8=await warehouse[_0x3cf0a8(0x277)]([{'$match':{'status':_0x3cf0a8(0x252)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x408596=await product[_0x3cf0a8(0x25b)]({});if(_0x1333ef[0x0][_0x3cf0a8(0x1cc)]==_0x3cf0a8(0x267)){var _0x181abf=users[_0x3cf0a8(0x2af)];console[_0x3cf0a8(0x2b0)](_0x181abf);}else{if(_0x1333ef[0x0][_0x3cf0a8(0x1cc)]=='Hindi')var _0x181abf=users['Hindi'];else{if(_0x1333ef[0x0][_0x3cf0a8(0x1cc)]==_0x3cf0a8(0x225))var _0x181abf=users[_0x3cf0a8(0x225)];else{if(_0x1333ef[0x0][_0x3cf0a8(0x1cc)]==_0x3cf0a8(0x275))var _0x181abf=users[_0x3cf0a8(0x275)];else{if(_0x1333ef[0x0][_0x3cf0a8(0x1cc)]==_0x3cf0a8(0x202))var _0x181abf=users[_0x3cf0a8(0x202)];else{if(_0x1333ef[0x0][_0x3cf0a8(0x1cc)]=='Portuguese\x20(BR)')var _0x181abf=users['Portuguese'];else{if(_0x1333ef[0x0][_0x3cf0a8(0x1cc)]=='Chinese')var _0x181abf=users[_0x3cf0a8(0x228)];else{if(_0x1333ef[0x0][_0x3cf0a8(0x1cc)]=='Arabic\x20(ae)')var _0x181abf=users['Arabic'];}}}}}}}_0x141a3b['render']('edit_sales_finished',{'success':_0x56340e['flash']('success'),'errors':_0x56340e[_0x3cf0a8(0x21e)]('errors'),'role':_0x4705c5,'profile':_0x458e87,'customer':_0x3065ef,'warehouse':_0x1a7cd8,'product':_0x397ddd,'user':_0x39ee31,'master_shop':_0x1333ef,'unit':_0x408596,'language':_0x181abf,'rooms_data':_0x2f39b0,'ed_fullDate':_0x5b132b});}catch(_0x2cbf50){console[_0x3cf0a8(0x2b0)](_0x2cbf50);}}),router['post'](a0_0x296db2(0x2d2),auth,async(_0x53e2e7,_0xfc8822)=>{var _0x45d5c8=a0_0x296db2;try{const _0x42ea09=_0x53e2e7[_0x45d5c8(0x1e1)]['id'],_0x5848a5=await sales_finished[_0x45d5c8(0x230)]({'_id':_0x53e2e7['params']['id']}),_0x311fbf=await warehouse[_0x45d5c8(0x230)]({'name':_0x5848a5[_0x45d5c8(0x258)],'room':_0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x20e)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x226282,customer:_0x2e79fe,date:_0x103592,warehouse_name:_0x19b647,product_name:_0x10a762,stock:_0x59198f,adjust_qty:_0x30241d,note:_0x37aa09,room:_0x728588,primary_code:_0x29c31f,secondary_code:_0x3fd8a3,prod_code:_0x852f5e,level:_0x1e606d,isle:_0x408056,pallet:_0x386588,expiry_date:_0x265ac6}=_0x53e2e7[_0x45d5c8(0x27e)];if(typeof _0x10a762==_0x45d5c8(0x25e))var _0x60b09c=[_0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x2a8)]],_0x5243c7=[_0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x1f2)]],_0x37d199=[_0x53e2e7['body'][_0x45d5c8(0x250)]],_0x52e314=[_0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x231)]],_0x2ebc8=[_0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x22a)]],_0x35aba8=[_0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x2c3)]],_0x1131bf=[_0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x27d)]],_0x55c21e=[_0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x22f)]];else var _0x60b09c=[..._0x53e2e7['body'][_0x45d5c8(0x2a8)]],_0x5243c7=[..._0x53e2e7[_0x45d5c8(0x27e)]['stock']],_0x37d199=[..._0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x250)]],_0x52e314=[..._0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x231)]],_0x2ebc8=[..._0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x22a)]],_0x35aba8=[..._0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x2c3)]],_0x1131bf=[..._0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x27d)]],_0x55c21e=[..._0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x22f)]];const _0x5e6dcf=_0x60b09c['map'](_0x7f5930=>{return _0x7f5930={'product_name':_0x7f5930};});_0x5243c7[_0x45d5c8(0x2ca)]((_0x162c4a,_0x1bc7f4)=>{var _0xfe6329=_0x45d5c8;_0x5e6dcf[_0x1bc7f4][_0xfe6329(0x1f2)]=_0x162c4a;}),_0x37d199[_0x45d5c8(0x2ca)]((_0x36052c,_0x2b56a3)=>{var _0x9ecb91=_0x45d5c8;_0x5e6dcf[_0x2b56a3][_0x9ecb91(0x1e0)]=_0x36052c;}),_0x52e314[_0x45d5c8(0x2ca)]((_0x3e3309,_0xc8469a)=>{var _0x2897dc=_0x45d5c8;_0x5e6dcf[_0xc8469a][_0x2897dc(0x231)]=_0x3e3309;}),_0x2ebc8['forEach']((_0x4ecb8d,_0x16d9c2)=>{_0x5e6dcf[_0x16d9c2]['secondary_code']=_0x4ecb8d;}),_0x35aba8[_0x45d5c8(0x2ca)]((_0x50567b,_0x7c1186)=>{var _0x24ca24=_0x45d5c8;_0x5e6dcf[_0x7c1186][_0x24ca24(0x2d1)]=_0x50567b;}),_0x1131bf[_0x45d5c8(0x2ca)]((_0x8be7a0,_0x35576d)=>{var _0x39e8f0=_0x45d5c8;_0x5e6dcf[_0x35576d][_0x39e8f0(0x27d)]=_0x8be7a0;}),_0x55c21e['forEach']((_0x4eb1e0,_0x3b67e6)=>{_0x5e6dcf[_0x3b67e6]['expiry_date']=_0x4eb1e0;});var _0x29ab5d=0x0;_0x5e6dcf['forEach'](_0x2ef3ee=>{var _0x5f15bf=_0x45d5c8;console[_0x5f15bf(0x2b0)]('foreach\x20newproduct',_0x2ef3ee),(parseInt(_0x2ef3ee['stock'])<parseInt(_0x2ef3ee[_0x5f15bf(0x1e0)])||parseInt(_0x2ef3ee[_0x5f15bf(0x1e0)])==0x0)&&_0x29ab5d++;});if(_0x29ab5d!=0x0)return _0x53e2e7[_0x45d5c8(0x21e)](_0x45d5c8(0x24c),_0x45d5c8(0x268)),_0xfc8822[_0x45d5c8(0x297)]('back');_0x5848a5[_0x45d5c8(0x26b)][_0x45d5c8(0x2ca)](_0x2ec3ec=>{var _0x489275=_0x45d5c8;const _0x13d372=_0x311fbf[_0x489275(0x1ed)][_0x489275(0x292)](_0x13c88=>{var _0x5c59ec=_0x489275;_0x13c88[_0x5c59ec(0x2a8)]==_0x2ec3ec[_0x5c59ec(0x2a8)]&&_0x13c88['bay']==_0x2ec3ec['bay']&&(_0x13c88[_0x5c59ec(0x2c6)]=parseInt(_0x13c88[_0x5c59ec(0x2c6)])+parseInt(_0x2ec3ec[_0x5c59ec(0x1e0)]));});}),await _0x311fbf[_0x45d5c8(0x215)]();const _0x3fb0a3=_0x5e6dcf[_0x45d5c8(0x1f6)](_0x3d70cc=>_0x3d70cc['quantity']!=='0'&&_0x3d70cc[_0x45d5c8(0x1e0)]!=='');_0x5848a5[_0x45d5c8(0x288)]=_0x226282,_0x5848a5['customer']=_0x2e79fe,_0x5848a5[_0x45d5c8(0x2b2)]=_0x103592,_0x5848a5[_0x45d5c8(0x258)]=_0x19b647,_0x5848a5[_0x45d5c8(0x26b)]=_0x3fb0a3,_0x5848a5[_0x45d5c8(0x204)]=_0x37aa09,_0x5848a5[_0x45d5c8(0x20e)]=_0x728588;const _0x53d54f=await _0x5848a5[_0x45d5c8(0x215)](),_0x43064d=await sales_finished['findOne']({'_id':_0x53e2e7[_0x45d5c8(0x1e1)]['id']}),_0x51e5ae=await warehouse[_0x45d5c8(0x230)]({'name':_0x19b647,'room':_0x728588,'warehouse_category':'Finished\x20Goods'});_0x43064d[_0x45d5c8(0x26b)][_0x45d5c8(0x2ca)](_0x42ef60=>{var _0x1fca1e=_0x45d5c8;const _0x51b4ee=_0x51e5ae[_0x1fca1e(0x1ed)][_0x1fca1e(0x292)](_0x14f3e1=>{var _0x1d2193=_0x1fca1e;_0x14f3e1[_0x1d2193(0x2a8)]==_0x42ef60['product_name']&&_0x14f3e1[_0x1d2193(0x20f)]==_0x42ef60['bay']&&(_0x14f3e1[_0x1d2193(0x2c6)]=parseInt(_0x14f3e1['product_stock'])-parseInt(_0x42ef60[_0x1d2193(0x1e0)]));});}),console[_0x45d5c8(0x2b0)](_0x45d5c8(0x1d1),_0x51e5ae),await _0x51e5ae[_0x45d5c8(0x215)]();const _0x4c24f4=await c_payment_data['findOne']({'invoice':_0x53e2e7['body'][_0x45d5c8(0x288)]});_0x4c24f4[_0x45d5c8(0x240)]=_0x53e2e7[_0x45d5c8(0x27e)][_0x45d5c8(0x240)],await _0x4c24f4[_0x45d5c8(0x215)](),_0x53e2e7[_0x45d5c8(0x21e)](_0x45d5c8(0x264),_0x45d5c8(0x2b1)),_0xfc8822[_0x45d5c8(0x297)]('/all_sales_finished/view');}catch(_0x360a2a){console[_0x45d5c8(0x2b0)](_0x360a2a);}}),router['post'](a0_0x296db2(0x23e),auth,async(_0x3b5466,_0x43da59)=>{var _0x287c79=a0_0x296db2;try{const _0x4522df=_0x3b5466[_0x287c79(0x1e1)]['id'],{invoice:_0x301edb,customer:_0x16156a,receivable_amount:_0x5dd5cc,received_amount:_0x2bb62c}=_0x3b5466[_0x287c79(0x27e)],_0x4ad356=await sales['findById'](_0x4522df);console['log'](_0x4ad356);var _0x3508ec=_0x5dd5cc-_0x2bb62c;console[_0x287c79(0x2b0)](_0x2bb62c),_0x4ad356[_0x287c79(0x20b)]=parseFloat(_0x2bb62c)+parseFloat(_0x4ad356[_0x287c79(0x20b)]),_0x4ad356['due_amount']=_0x3508ec,console['log'](_0x4ad356);const _0x1396b0=await _0x4ad356[_0x287c79(0x215)](),_0x3bfef4=await c_payment_data[_0x287c79(0x230)]({'invoice':_0x301edb});_0x3bfef4[_0x287c79(0x2b4)]=_0x3508ec,await _0x3bfef4[_0x287c79(0x215)]();let _0x46902e=new Date(),_0x517ee8=('0'+_0x46902e[_0x287c79(0x27b)]())['slice'](-0x2),_0x28cd3b=('0'+(_0x46902e[_0x287c79(0x2da)]()+0x1))[_0x287c79(0x1f5)](-0x2),_0x15c7b7=_0x46902e['getFullYear'](),_0x517176=_0x15c7b7+'-'+_0x28cd3b+'-'+_0x517ee8;const _0xe0c8ea=new customer_payment({'invoice':_0x301edb,'date':_0x15c7b7+'-'+_0x28cd3b+'-'+_0x517ee8,'customer':_0x16156a,'reason':_0x287c79(0x1d2),'amount':_0x2bb62c}),_0x4b5d57=await _0xe0c8ea[_0x287c79(0x215)]();_0x3b5466['flash'](_0x287c79(0x264),_0x287c79(0x276)),_0x43da59[_0x287c79(0x297)](_0x287c79(0x238));}catch(_0x138b4b){console[_0x287c79(0x2b0)](_0x138b4b);}}),router['get']('/invoice/:id',auth,async(_0xca3391,_0x57e0b4)=>{var _0x4a31b1=a0_0x296db2;try{const {username:_0xce1799,email:_0x5f3efc,role:_0x4058c2}=_0xca3391[_0x4a31b1(0x2de)],_0x4331b7=_0xca3391[_0x4a31b1(0x2de)],_0xa83ff9=await profile['findOne']({'email':_0x4331b7[_0x4a31b1(0x2a9)]}),_0x244e08=await master_shop[_0x4a31b1(0x25b)]();console[_0x4a31b1(0x2b0)](_0x4a31b1(0x26e),_0x244e08);const _0x49ac1b=_0xca3391[_0x4a31b1(0x1e1)]['id'],_0x434dd8=await sales[_0x4a31b1(0x2bb)](_0x49ac1b);console[_0x4a31b1(0x2b0)](_0x434dd8);const _0x3486f5=await customer['findOne']({'name':_0x434dd8['customer']});console[_0x4a31b1(0x2b0)](_0x3486f5);if(_0x244e08[0x0][_0x4a31b1(0x1cc)]==_0x4a31b1(0x267)){var _0x1b0156=users[_0x4a31b1(0x2af)];console[_0x4a31b1(0x2b0)](_0x1b0156);}else{if(_0x244e08[0x0]['language']==_0x4a31b1(0x2e2))var _0x1b0156=users[_0x4a31b1(0x2e2)];else{if(_0x244e08[0x0][_0x4a31b1(0x1cc)]==_0x4a31b1(0x225))var _0x1b0156=users['German'];else{if(_0x244e08[0x0]['language']==_0x4a31b1(0x275))var _0x1b0156=users[_0x4a31b1(0x275)];else{if(_0x244e08[0x0][_0x4a31b1(0x1cc)]==_0x4a31b1(0x202))var _0x1b0156=users[_0x4a31b1(0x202)];else{if(_0x244e08[0x0][_0x4a31b1(0x1cc)]==_0x4a31b1(0x232))var _0x1b0156=users[_0x4a31b1(0x1d9)];else{if(_0x244e08[0x0]['language']==_0x4a31b1(0x228))var _0x1b0156=users[_0x4a31b1(0x228)];else{if(_0x244e08[0x0][_0x4a31b1(0x1cc)]=='Arabic\x20(ae)')var _0x1b0156=users[_0x4a31b1(0x262)];}}}}}}}_0x57e0b4[_0x4a31b1(0x2c7)](_0x4a31b1(0x236),{'success':_0xca3391[_0x4a31b1(0x21e)](_0x4a31b1(0x264)),'errors':_0xca3391['flash'](_0x4a31b1(0x24c)),'role':_0x4331b7,'profile':_0xa83ff9,'master_shop':_0x244e08,'customers':_0x3486f5,'sales':_0x434dd8,'language':_0x1b0156});}catch(_0x91184c){console[_0x4a31b1(0x2b0)](_0x91184c);}}),router[a0_0x296db2(0x2d5)]('/view/return_sales/:id',auth,async(_0x3ffa75,_0x3a84a6)=>{var _0x56b7d6=a0_0x296db2;try{const {username:_0x20a392,email:_0x4e5d17,role:_0x2bb940}=_0x3ffa75[_0x56b7d6(0x2de)],_0x1102c0=_0x3ffa75[_0x56b7d6(0x2de)],_0x45cf1c=await profile[_0x56b7d6(0x230)]({'email':_0x1102c0[_0x56b7d6(0x2a9)]}),_0x335825=await master_shop[_0x56b7d6(0x25b)](),_0x1dfc20=_0x3ffa75[_0x56b7d6(0x1e1)]['id'],_0x13b31e=await sales_finished[_0x56b7d6(0x2bb)](_0x1dfc20),_0x59171a=await warehouse[_0x56b7d6(0x277)]([{'$match':{'name':_0x13b31e[_0x56b7d6(0x258)]}},{'$unwind':_0x56b7d6(0x229)},{'$group':{'_id':_0x56b7d6(0x28d),'name':{'$first':_0x56b7d6(0x2b9)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x56b7d6(0x2d6)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x56b7d6(0x1f7)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x56b7d6(0x26f)},'production_date':{'$first':_0x56b7d6(0x2b6)},'unit':{'$first':_0x56b7d6(0x296)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0x56b7d6(0x208)},'batch_code':{'$first':_0x56b7d6(0x259)},'maxPerUnit':{'$first':_0x56b7d6(0x26c)}}}]),_0x2ae11a=await product[_0x56b7d6(0x25b)]({}),_0x270d52=await warehouse[_0x56b7d6(0x277)]([{'$match':{'status':'Enabled','warehouse_category':_0x56b7d6(0x1f8),'name':{'$ne':_0x56b7d6(0x1dc),'$ne':_0x56b7d6(0x29c)}}},{'$group':{'_id':_0x56b7d6(0x2d7),'name':{'$first':_0x56b7d6(0x2d7)}}},{'$sort':{'name':0x1}}]);var _0x43b21b=[_0x56b7d6(0x209)];const _0x3108af=await warehouse[_0x56b7d6(0x277)]([{'$match':{'status':_0x56b7d6(0x252),'name':'Quality\x20Inspection'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x335825[0x0]['language']==_0x56b7d6(0x267)){var _0x35a52b=users[_0x56b7d6(0x2af)];console[_0x56b7d6(0x2b0)](_0x35a52b);}else{if(_0x335825[0x0][_0x56b7d6(0x1cc)]=='Hindi')var _0x35a52b=users[_0x56b7d6(0x2e2)];else{if(_0x335825[0x0]['language']==_0x56b7d6(0x225))var _0x35a52b=users[_0x56b7d6(0x225)];else{if(_0x335825[0x0][_0x56b7d6(0x1cc)]==_0x56b7d6(0x275))var _0x35a52b=users[_0x56b7d6(0x275)];else{if(_0x335825[0x0][_0x56b7d6(0x1cc)]==_0x56b7d6(0x202))var _0x35a52b=users[_0x56b7d6(0x202)];else{if(_0x335825[0x0]['language']=='Portuguese\x20(BR)')var _0x35a52b=users[_0x56b7d6(0x1d9)];else{if(_0x335825[0x0][_0x56b7d6(0x1cc)]==_0x56b7d6(0x228))var _0x35a52b=users[_0x56b7d6(0x228)];else{if(_0x335825[0x0][_0x56b7d6(0x1cc)]==_0x56b7d6(0x24e))var _0x35a52b=users[_0x56b7d6(0x262)];}}}}}}}_0x3a84a6[_0x56b7d6(0x2c7)]('return_sale_finished',{'success':_0x3ffa75['flash']('success'),'errors':_0x3ffa75[_0x56b7d6(0x21e)](_0x56b7d6(0x24c)),'role':_0x1102c0,'profile':_0x45cf1c,'user':_0x13b31e,'stock':_0x59171a,'master_shop':_0x335825,'unit':_0x2ae11a,'language':_0x35a52b,'warehouses':_0x270d52,'rooms':_0x43b21b,'warehouse_QA':_0x3108af});}catch(_0xefb509){console[_0x56b7d6(0x2b0)](_0xefb509),_0x3a84a6[_0x56b7d6(0x291)](0xc8)['json']({'message':_0xefb509[_0x56b7d6(0x28e)]});}}),router['post'](a0_0x296db2(0x266),auth,async(_0xb5aaf9,_0x1444e7)=>{var _0x197f0b=a0_0x296db2;if(_0xb5aaf9['body'][_0x197f0b(0x272)]=='QA')try{const {invoice:_0x354138,date:_0x3bf0bb,warehouse_name:_0x442188,product_name:_0x492c49,primary_code:_0x2a55e0,secondary_code:_0x22361b,product_code:_0x6d87de,sales_quantity:_0x26c970,stocks:_0x1a1d91,return_qty:_0x23e02b,Room_name:_0x47082b,to_warehouse_name_QA:_0x4df2e2,to_Room_name_QA:_0x55e6d5,note:_0x55987e,for_categorize:_0x1c9d7e,product_name_QA1:_0x18f21d}=_0xb5aaf9[_0x197f0b(0x27e)];if(typeof _0x18f21d=='string')var _0x80b588=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x1ea)]],_0x2070f5=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2cf)]],_0x33619f=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x226)]],_0x27f525=[_0xb5aaf9['body'][_0x197f0b(0x28a)]],_0x498f6c=[_0xb5aaf9[_0x197f0b(0x27e)]['sales_quantity_QA']],_0x4e807f=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x203)]],_0x178867=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x263)]],_0x2fe219=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x217)]],_0x101ddb=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2ba)]],_0x261771=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2c4)]],_0x5d784e=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x1e6)]],_0x26b791=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2dc)]],_0x3137b4=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x251)]],_0x2a1320=[_0xb5aaf9[_0x197f0b(0x27e)]['expiry_date_QA']];else var _0x80b588=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x1ea)]],_0x2070f5=[..._0xb5aaf9[_0x197f0b(0x27e)]['primary_code_QA']],_0x33619f=[..._0xb5aaf9['body'][_0x197f0b(0x226)]],_0x27f525=[..._0xb5aaf9['body'][_0x197f0b(0x28a)]],_0x498f6c=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2ae)]],_0x4e807f=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x203)]],_0x178867=[..._0xb5aaf9[_0x197f0b(0x27e)]['return_qty_QA']],_0x2fe219=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x217)]],_0x101ddb=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2ba)]],_0x261771=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2c4)]],_0x5d784e=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x1e6)]],_0x26b791=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2dc)]],_0x3137b4=[..._0xb5aaf9[_0x197f0b(0x27e)]['production_date_QA']],_0x2a1320=[..._0xb5aaf9['body'][_0x197f0b(0x293)]];const _0x1db89b=_0x80b588['map'](_0x30a7d3=>{return _0x30a7d3={'product_name':_0x30a7d3};});_0x2070f5['forEach']((_0x1409ca,_0x57623d)=>{var _0x3de108=_0x197f0b;_0x1db89b[_0x57623d][_0x3de108(0x231)]=_0x1409ca;}),_0x33619f['forEach']((_0x49698f,_0x29daeb)=>{var _0x5bd9cb=_0x197f0b;_0x1db89b[_0x29daeb][_0x5bd9cb(0x22a)]=_0x49698f;}),_0x27f525[_0x197f0b(0x2ca)]((_0x3a9c83,_0x362b2e)=>{var _0x4f27b2=_0x197f0b;_0x1db89b[_0x362b2e][_0x4f27b2(0x2d1)]=_0x3a9c83;}),_0x498f6c['forEach']((_0x1e2cc3,_0x5a3234)=>{var _0xca5556=_0x197f0b;_0x1db89b[_0x5a3234][_0xca5556(0x1fd)]=_0x1e2cc3;}),_0x4e807f['forEach']((_0x1ad6ce,_0x18d123)=>{var _0x136141=_0x197f0b;_0x1db89b[_0x18d123][_0x136141(0x1f2)]=_0x1ad6ce;}),_0x178867[_0x197f0b(0x2ca)]((_0x44b63c,_0x337946)=>{var _0x5ce5cc=_0x197f0b;_0x1db89b[_0x337946][_0x5ce5cc(0x21d)]=_0x44b63c;}),_0x2fe219[_0x197f0b(0x2ca)]((_0x2f724d,_0x423a82)=>{var _0x54bdd3=_0x197f0b;_0x1db89b[_0x423a82][_0x54bdd3(0x2e0)]=_0x2f724d;}),_0x101ddb['forEach']((_0x4bf318,_0x377f6c)=>{_0x1db89b[_0x377f6c]['maxProducts']=_0x4bf318;}),_0x261771[_0x197f0b(0x2ca)]((_0x54c72a,_0x48783e)=>{var _0x11c0d3=_0x197f0b;_0x1db89b[_0x48783e][_0x11c0d3(0x206)]=_0x54c72a;}),_0x5d784e[_0x197f0b(0x2ca)]((_0x152eb6,_0x81153f)=>{var _0x6924e4=_0x197f0b;_0x1db89b[_0x81153f][_0x6924e4(0x280)]=_0x152eb6;}),_0x26b791[_0x197f0b(0x2ca)]((_0x356022,_0x2b40c4)=>{var _0x2f4182=_0x197f0b;_0x1db89b[_0x2b40c4][_0x2f4182(0x2a6)]=_0x356022;}),_0x3137b4['forEach']((_0x11177f,_0x265854)=>{_0x1db89b[_0x265854]['production_date']=_0x11177f;}),_0x2a1320['forEach']((_0x4c490b,_0x1621c2)=>{_0x1db89b[_0x1621c2]['expiry_date']=_0x4c490b;});const _0x4d4c93=await sales_finished[_0x197f0b(0x230)]({'invoice':_0x354138});_0x4d4c93['return_data']=_0x197f0b(0x2d4);const _0x2fcbce=await _0x4d4c93[_0x197f0b(0x215)](),_0x283933=new sales_return_finished({'invoice':_0x354138,'customer':_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2a1)],'date':_0x3bf0bb,'warehouse_name':_0x442188,'room':_0x47082b,'ToWarehouse':_0x4df2e2,'ToRoom':_0x55e6d5,'return_sale_QA':_0x1db89b,'note':_0x55987e,'warehouse_cat':_0x1c9d7e}),_0x584b13=await _0x283933[_0x197f0b(0x215)](),_0x1f69c9=await sales_return_finished[_0x197f0b(0x230)]({'invoice':_0x354138}),_0x1b9fb5=await warehouse[_0x197f0b(0x230)]({'name':_0x4df2e2,'room':_0x55e6d5});_0x1f69c9[_0x197f0b(0x1ef)][_0x197f0b(0x2ca)](_0x1b57cc=>{var _0x15fbae=_0x197f0b,_0x107c45=0x0;const _0x40057f=_0x1b9fb5[_0x15fbae(0x1ed)][_0x15fbae(0x292)](_0x383d2a=>{var _0xb8d273=_0x15fbae;_0x383d2a['product_name']==_0x1b57cc['product_name']&&_0x383d2a[_0xb8d273(0x22f)]==_0x1b57cc[_0xb8d273(0x22f)]&&_0x383d2a[_0xb8d273(0x2c8)]==_0x1b57cc[_0xb8d273(0x2c8)]&&_0x383d2a[_0xb8d273(0x206)]==_0x1b57cc[_0xb8d273(0x206)]&&(_0x383d2a['product_stock']=parseInt(_0x383d2a[_0xb8d273(0x2c6)])+parseInt(_0x1b57cc[_0xb8d273(0x21d)]),_0x107c45++);});_0x107c45=='0'&&(_0x1b9fb5['product_details']=_0x1b9fb5[_0x15fbae(0x1ed)][_0x15fbae(0x248)]({'product_name':_0x1b57cc['product_name'],'product_stock':_0x1b57cc[_0x15fbae(0x21d)],'primary_code':_0x1b57cc[_0x15fbae(0x231)],'secondary_code':_0x1b57cc[_0x15fbae(0x22a)],'product_code':_0x1b57cc[_0x15fbae(0x2d1)],'batch_code':_0x1b57cc[_0x15fbae(0x206)],'maxPerUnit':_0x1b57cc[_0x15fbae(0x2e0)],'production_date':_0x1b57cc[_0x15fbae(0x2c8)],'expiry_date':_0x1b57cc[_0x15fbae(0x22f)],'secondary_unit':_0x1b57cc[_0x15fbae(0x280)],'unit':_0x1b57cc[_0x15fbae(0x2a6)],'maxProducts':_0x1b57cc['maxProducts'],'bay':_0x1b57cc[_0x15fbae(0x20f)]}));}),await _0x1b9fb5['save']();const _0x40152e=new c_payment_data({'invoice':_0x354138,'customer':_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2a1)],'reason':'Sale\x20Return'});await _0x40152e[_0x197f0b(0x215)]();const _0x2735de=await master_shop[_0x197f0b(0x25b)](),_0xb62c0e=await email_settings[_0x197f0b(0x230)](),_0x3ea508=await customer[_0x197f0b(0x230)]({'name':_0xb5aaf9['body'][_0x197f0b(0x2a1)]});_0x2735de[0x0][_0x197f0b(0x1e3)]==0x1?(right_currency=_0x2735de[0x0][_0x197f0b(0x29b)],left_currency=''):(right_currency='',left_currency=_0x2735de[0x0][_0x197f0b(0x29b)]);var _0x134021=_0x80b588,_0x497c40=_0x178867,_0x4cb031='',_0x267b14;for(_0x267b14 in _0x134021){_0x4cb031+=_0x197f0b(0x243)+_0x197f0b(0x21b)+_0x134021[_0x267b14]+_0x197f0b(0x260)+_0x197f0b(0x21b)+_0x497c40[_0x267b14]+_0x197f0b(0x260)+'</tr>';}console[_0x197f0b(0x2b0)](_0x197f0b(0x224),_0x4cb031);let _0x52da03=nodemailer['createTransport']({'service':_0x197f0b(0x23d),'auth':{'user':_0xb62c0e['email'],'pass':_0xb62c0e['password']}}),_0x1cadf9={'from':_0xb62c0e['email'],'to':_0x3ea508[_0x197f0b(0x2a9)],'subject':_0x197f0b(0x212),'attachments':[{'filename':'Logo.png','path':__dirname+_0x197f0b(0x2a5)+_0x197f0b(0x1e4)+_0x2735de[0x0]['image'],'cid':_0x197f0b(0x234)}],'html':_0x197f0b(0x1fa)+_0x197f0b(0x247)+_0x197f0b(0x29e)+_0x197f0b(0x1db)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x197f0b(0x1db)+_0x197f0b(0x20a)+_0x197f0b(0x211)+'<div>'+_0x197f0b(0x1f1)+_0x2735de[0x0][_0x197f0b(0x1f0)]+_0x197f0b(0x269)+_0x197f0b(0x211)+_0x197f0b(0x211)+_0x197f0b(0x2a2)+_0x197f0b(0x1db)+_0x197f0b(0x298)+'\x20Order\x20Number\x20:\x20'+_0x354138+'\x20'+_0x197f0b(0x1cd)+'\x20Order\x20Date\x20:\x20'+_0x3bf0bb+'\x20'+_0x197f0b(0x285)+_0x197f0b(0x2b3)+'</div>'+_0x197f0b(0x286)+_0x197f0b(0x1fe)+_0x197f0b(0x243)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x197f0b(0x218)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x197f0b(0x22d)+'</thead>'+_0x197f0b(0x2df)+'\x20'+_0x4cb031+'\x20'+_0x197f0b(0x2d3)+_0x197f0b(0x2c0)+_0x197f0b(0x1db)+_0x197f0b(0x1e8)+_0x197f0b(0x2cc)+_0x2735de[0x0][_0x197f0b(0x1f0)]+_0x197f0b(0x2b3)+_0x197f0b(0x211)+_0x197f0b(0x211)+_0x197f0b(0x2cb)};_0x52da03['sendMail'](_0x1cadf9,function(_0x44994f,_0x54f783){var _0x52ecc9=_0x197f0b;_0x44994f?(console['log'](_0x44994f),console['log'](_0x52ecc9(0x1fb))):console[_0x52ecc9(0x2b0)]('Email\x20sent\x20successfully');}),_0xb5aaf9[_0x197f0b(0x21e)](_0x197f0b(0x264),_0x197f0b(0x22e)),_0x1444e7[_0x197f0b(0x297)](_0x197f0b(0x28c));}catch(_0x3bc053){_0x1444e7[_0x197f0b(0x291)](0xc8)['json']({'message1':_0x3bc053[_0x197f0b(0x28e)]});}else{if(_0xb5aaf9['body'][_0x197f0b(0x272)]=='GS')try{const {invoice:_0x4bde19,date:_0x176bd2,warehouse_name:_0x289685,product_name:_0x6427d9,primary_code:_0x1f9f22,secondary_code:_0x44915a,product_code:_0xf1171e,sales_quantity:_0x58acf1,stocks:_0x55d524,return_qty:_0x5ff0e1,Room_name:_0x1c3bb6,to_warehouse_name:_0x421d74,to_Room_name:_0x43e09d,note:_0x18d747,level:_0x5f28e0,isle:_0x3dd758,pallet:_0x5876c9,for_categorize:_0x1ab6c5}=_0xb5aaf9['body'];if(typeof _0x6427d9==_0x197f0b(0x25e))var _0x80b588=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2a8)]],_0x2070f5=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x231)]],_0x33619f=[_0xb5aaf9['body'][_0x197f0b(0x22a)]],_0x27f525=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2d1)]],_0x498f6c=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x28f)]],_0x178867=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x21d)]],_0x4ec269=[_0xb5aaf9[_0x197f0b(0x27e)]['bay']],_0x2fe219=[_0xb5aaf9['body'][_0x197f0b(0x2e0)]],_0x101ddb=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x220)]],_0x261771=[_0xb5aaf9['body'][_0x197f0b(0x206)]],_0x5d784e=[_0xb5aaf9['body']['secondary_unit']],_0x26b791=[_0xb5aaf9['body']['unit']],_0x3137b4=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2c8)]],_0x2a1320=[_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x22f)]];else var _0x80b588=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2a8)]],_0x2070f5=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x231)]],_0x33619f=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x22a)]],_0x27f525=[..._0xb5aaf9['body'][_0x197f0b(0x2d1)]],_0x498f6c=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x28f)]],_0x178867=[..._0xb5aaf9[_0x197f0b(0x27e)]['return_qty']],_0x4ec269=[..._0xb5aaf9[_0x197f0b(0x27e)]['bay']],_0x2fe219=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2e0)]],_0x101ddb=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x220)]],_0x261771=[..._0xb5aaf9[_0x197f0b(0x27e)]['batch_code']],_0x5d784e=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x280)]],_0x26b791=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2a6)]],_0x3137b4=[..._0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2c8)]],_0x2a1320=[..._0xb5aaf9['body'][_0x197f0b(0x22f)]];const _0x4ae789=_0x80b588[_0x197f0b(0x292)](_0x467711=>{return _0x467711={'product_name':_0x467711};});_0x2070f5[_0x197f0b(0x2ca)]((_0x5da4ed,_0x2c8d04)=>{_0x4ae789[_0x2c8d04]['primary_code']=_0x5da4ed;}),_0x33619f['forEach']((_0x45f7af,_0x109100)=>{var _0x2444f3=_0x197f0b;_0x4ae789[_0x109100][_0x2444f3(0x22a)]=_0x45f7af;}),_0x27f525[_0x197f0b(0x2ca)]((_0x4b1a51,_0x43a8a7)=>{_0x4ae789[_0x43a8a7]['product_code']=_0x4b1a51;}),_0x498f6c[_0x197f0b(0x2ca)]((_0x2eaefb,_0x342ed6)=>{var _0x231460=_0x197f0b;_0x4ae789[_0x342ed6][_0x231460(0x1fd)]=_0x2eaefb;}),_0x178867[_0x197f0b(0x2ca)]((_0xeadf68,_0x5eeda0)=>{_0x4ae789[_0x5eeda0]['return_qty']=_0xeadf68;}),_0x4ec269[_0x197f0b(0x2ca)]((_0x4ebde9,_0x4707a2)=>{var _0x4161f7=_0x197f0b;_0x4ae789[_0x4707a2][_0x4161f7(0x20f)]=_0x4ebde9;}),_0x2fe219['forEach']((_0x24ace4,_0x57b8c0)=>{var _0x3a1f4a=_0x197f0b;_0x4ae789[_0x57b8c0][_0x3a1f4a(0x2e0)]=_0x24ace4;}),_0x101ddb[_0x197f0b(0x2ca)]((_0x4289b2,_0x51eb6c)=>{var _0x39a453=_0x197f0b;_0x4ae789[_0x51eb6c][_0x39a453(0x220)]=_0x4289b2;}),_0x261771['forEach']((_0x929c2e,_0x710404)=>{var _0x2c111a=_0x197f0b;_0x4ae789[_0x710404][_0x2c111a(0x206)]=_0x929c2e;}),_0x5d784e[_0x197f0b(0x2ca)]((_0x40c9ed,_0x2e55ee)=>{var _0x2c02c7=_0x197f0b;_0x4ae789[_0x2e55ee][_0x2c02c7(0x280)]=_0x40c9ed;}),_0x26b791[_0x197f0b(0x2ca)]((_0x354b09,_0x719f85)=>{var _0x1ad707=_0x197f0b;_0x4ae789[_0x719f85][_0x1ad707(0x2a6)]=_0x354b09;}),_0x3137b4['forEach']((_0x1fe832,_0xa8dbc5)=>{_0x4ae789[_0xa8dbc5]['production_date']=_0x1fe832;}),_0x2a1320[_0x197f0b(0x2ca)]((_0x59e011,_0x5bb600)=>{var _0x26d334=_0x197f0b;_0x4ae789[_0x5bb600][_0x26d334(0x22f)]=_0x59e011;});var _0x537f7a=0x0;_0x4ae789[_0x197f0b(0x2ca)](_0x101a7a=>{var _0xc56b52=_0x197f0b;(parseInt(_0x101a7a[_0xc56b52(0x1fd)])<parseInt(_0x101a7a[_0xc56b52(0x21d)])||parseInt(_0x101a7a[_0xc56b52(0x1f2)])<parseInt(_0x101a7a[_0xc56b52(0x21d)])&&parseInt(_0x101a7a[_0xc56b52(0x1fd)])>parseInt(_0x101a7a[_0xc56b52(0x21d)])||parseInt(_0x101a7a[_0xc56b52(0x21d)])==0x0)&&_0x537f7a++;});if(_0x537f7a!=0x0)return _0xb5aaf9[_0x197f0b(0x21e)](_0x197f0b(0x24c),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x1444e7[_0x197f0b(0x297)](_0x197f0b(0x2b8));const _0x1ce4f6=await sales_finished[_0x197f0b(0x230)]({'invoice':_0x4bde19});_0x1ce4f6[_0x197f0b(0x1ce)]='True';const _0xe701e6=await _0x1ce4f6[_0x197f0b(0x215)](),_0x4a6742=new sales_return_finished({'invoice':_0x4bde19,'customer':_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2a1)],'date':_0x176bd2,'warehouse_name':_0x289685,'room':_0x1c3bb6,'ToWarehouse':_0x421d74,'ToRoom':_0x43e09d,'return_sale':_0x4ae789,'note':_0x18d747,'warehouse_cat':_0x1ab6c5}),_0xa4321c=await _0x4a6742[_0x197f0b(0x215)](),_0x30459c=await sales_return_finished[_0x197f0b(0x230)]({'invoice':_0x4bde19}),_0x17958d=await warehouse[_0x197f0b(0x230)]({'name':_0x421d74,'room':_0x43e09d,'warehouse_category':'Finished\x20Goods'});_0x30459c['return_sale'][_0x197f0b(0x2ca)](_0x12b7ca=>{var _0x1005b7=_0x197f0b,_0x4084ee=0x0;const _0x444f99=_0x17958d[_0x1005b7(0x1ed)][_0x1005b7(0x292)](_0xaa9293=>{var _0x142807=_0x1005b7;_0xaa9293[_0x142807(0x2a8)]==_0x12b7ca[_0x142807(0x2a8)]&&_0xaa9293['bay']==_0x12b7ca[_0x142807(0x20f)]&&_0xaa9293[_0x142807(0x22f)]==_0x12b7ca[_0x142807(0x22f)]&&_0xaa9293[_0x142807(0x2c8)]==_0x12b7ca[_0x142807(0x2c8)]&&_0xaa9293['batch_code']==_0x12b7ca[_0x142807(0x206)]&&(_0xaa9293[_0x142807(0x2c6)]=parseInt(_0xaa9293[_0x142807(0x2c6)])+parseInt(_0x12b7ca[_0x142807(0x21d)]),_0x4084ee++);});_0x4084ee=='0'&&(_0x17958d['product_details']=_0x17958d['product_details'][_0x1005b7(0x248)]({'product_name':_0x12b7ca[_0x1005b7(0x2a8)],'product_stock':_0x12b7ca[_0x1005b7(0x21d)],'primary_code':_0x12b7ca[_0x1005b7(0x231)],'secondary_code':_0x12b7ca[_0x1005b7(0x22a)],'product_code':_0x12b7ca['product_code'],'bay':_0x12b7ca[_0x1005b7(0x20f)],'batch_code':_0x12b7ca[_0x1005b7(0x206)],'maxPerUnit':_0x12b7ca[_0x1005b7(0x2e0)],'production_date':_0x12b7ca[_0x1005b7(0x2c8)],'expiry_date':_0x12b7ca[_0x1005b7(0x22f)],'secondary_unit':_0x12b7ca[_0x1005b7(0x280)],'unit':_0x12b7ca[_0x1005b7(0x2a6)],'maxProducts':_0x12b7ca['maxProducts']}));}),await _0x17958d[_0x197f0b(0x215)](),console[_0x197f0b(0x2b0)](_0xb5aaf9[_0x197f0b(0x27e)]);const _0x44c457=new c_payment_data({'invoice':_0x4bde19,'customer':_0xb5aaf9['body'][_0x197f0b(0x2a1)],'reason':'Sale\x20Return'});await _0x44c457[_0x197f0b(0x215)]();const _0x1ba9d3=await master_shop[_0x197f0b(0x25b)]();console[_0x197f0b(0x2b0)](_0x197f0b(0x242),_0x1ba9d3[0x0][_0x197f0b(0x25a)]);const _0x3369a5=await email_settings[_0x197f0b(0x230)](),_0x5eb9a9=await customer[_0x197f0b(0x230)]({'name':_0xb5aaf9[_0x197f0b(0x27e)][_0x197f0b(0x2a1)]});console['log']('customer_data',_0x5eb9a9);_0x1ba9d3[0x0][_0x197f0b(0x1e3)]==0x1?(right_currency=_0x1ba9d3[0x0][_0x197f0b(0x29b)],left_currency=''):(right_currency='',left_currency=_0x1ba9d3[0x0]['currency']);var _0x134021=_0x80b588,_0x497c40=_0x178867,_0x4cb031='',_0x267b14;for(_0x267b14 in _0x134021){_0x4cb031+=_0x197f0b(0x243)+_0x197f0b(0x21b)+_0x134021[_0x267b14]+_0x197f0b(0x260)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x497c40[_0x267b14]+_0x197f0b(0x260)+_0x197f0b(0x22d);}console[_0x197f0b(0x2b0)](_0x197f0b(0x224),_0x4cb031);let _0x4dae00=nodemailer[_0x197f0b(0x2a0)]({'service':'gmail','auth':{'user':_0x3369a5[_0x197f0b(0x2a9)],'pass':_0x3369a5['password']}}),_0x2d793e={'from':_0x3369a5[_0x197f0b(0x2a9)],'to':_0x5eb9a9[_0x197f0b(0x2a9)],'subject':_0x197f0b(0x212),'attachments':[{'filename':_0x197f0b(0x29f),'path':__dirname+'/../public'+_0x197f0b(0x1e4)+_0x1ba9d3[0x0][_0x197f0b(0x25a)],'cid':_0x197f0b(0x234)}],'html':_0x197f0b(0x1fa)+'<html><head><title></title>'+'</head><body>'+_0x197f0b(0x1db)+_0x197f0b(0x28b)+_0x197f0b(0x1db)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x197f0b(0x211)+'<div>'+_0x197f0b(0x1f1)+_0x1ba9d3[0x0]['site_title']+_0x197f0b(0x269)+_0x197f0b(0x211)+_0x197f0b(0x211)+_0x197f0b(0x2a2)+'<div>'+_0x197f0b(0x298)+_0x197f0b(0x2bc)+_0x4bde19+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x197f0b(0x2ab)+_0x176bd2+'\x20'+_0x197f0b(0x285)+_0x197f0b(0x2b3)+'</div>'+_0x197f0b(0x286)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x197f0b(0x243)+_0x197f0b(0x2c1)+_0x197f0b(0x239)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x197f0b(0x295)+_0x197f0b(0x22d)+'</thead>'+_0x197f0b(0x2df)+'\x20'+_0x4cb031+'\x20'+_0x197f0b(0x2d3)+'</table>'+'<div>'+_0x197f0b(0x1e8)+'<h5>'+_0x1ba9d3[0x0][_0x197f0b(0x1f0)]+_0x197f0b(0x2b3)+_0x197f0b(0x211)+_0x197f0b(0x211)+_0x197f0b(0x2cb)};_0x4dae00[_0x197f0b(0x29a)](_0x2d793e,function(_0x4640ad,_0x9f9ac2){var _0x53ff45=_0x197f0b;_0x4640ad?(console[_0x53ff45(0x2b0)](_0x4640ad),console[_0x53ff45(0x2b0)]('Error\x20Occurs')):console[_0x53ff45(0x2b0)](_0x53ff45(0x2e4));}),_0xb5aaf9[_0x197f0b(0x21e)](_0x197f0b(0x264),_0x197f0b(0x22e)),_0x1444e7['redirect']('/all_sales_finished/view');}catch(_0x331b98){console[_0x197f0b(0x2b0)](_0x331b98),_0x1444e7[_0x197f0b(0x291)](0xc8)[_0x197f0b(0x1d6)]({'message1':_0x331b98[_0x197f0b(0x28e)]});}}}),router[a0_0x296db2(0x2d5)](a0_0x296db2(0x2ad),auth,async(_0x5c0bd3,_0x4bf345)=>{var _0x47978e=a0_0x296db2;try{const {username:_0x1b2b3d,email:_0x3440d8,role:_0x5c8b9e}=_0x5c0bd3[_0x47978e(0x2de)],_0x3d3996=_0x5c0bd3[_0x47978e(0x2de)],_0x536b57=await profile['findOne']({'email':_0x3d3996['email']}),_0x5d6559=await master_shop[_0x47978e(0x25b)]();console[_0x47978e(0x2b0)](_0x47978e(0x21a),_0x5d6559);const _0x1e8a9d=_0x5c0bd3[_0x47978e(0x1e1)]['id'],_0xf5d7e8=await sales[_0x47978e(0x2bb)](_0x1e8a9d);console[_0x47978e(0x2b0)](_0x47978e(0x26d),_0xf5d7e8);if(_0x5d6559[0x0][_0x47978e(0x1cc)]==_0x47978e(0x267))var _0x39a9bb=users[_0x47978e(0x2af)];else{if(_0x5d6559[0x0][_0x47978e(0x1cc)]==_0x47978e(0x2e2))var _0x39a9bb=users[_0x47978e(0x2e2)];else{if(_0x5d6559[0x0]['language']==_0x47978e(0x225))var _0x39a9bb=users['German'];else{if(_0x5d6559[0x0]['language']=='Spanish')var _0x39a9bb=users['Spanish'];else{if(_0x5d6559[0x0][_0x47978e(0x1cc)]==_0x47978e(0x202))var _0x39a9bb=users['French'];else{if(_0x5d6559[0x0][_0x47978e(0x1cc)]==_0x47978e(0x232))var _0x39a9bb=users['Portuguese'];else{if(_0x5d6559[0x0][_0x47978e(0x1cc)]=='Chinese')var _0x39a9bb=users[_0x47978e(0x228)];else{if(_0x5d6559[0x0][_0x47978e(0x1cc)]=='Arabic\x20(ae)')var _0x39a9bb=users['Arabic'];}}}}}}}_0x4bf345['render'](_0x47978e(0x271),{'success':_0x5c0bd3[_0x47978e(0x21e)](_0x47978e(0x264)),'errors':_0x5c0bd3[_0x47978e(0x21e)](_0x47978e(0x24c)),'role':_0x3d3996,'profile':_0x536b57,'alldata':_0xf5d7e8,'master_shop':_0x5d6559,'language':_0x39a9bb});}catch(_0x4fefcd){console[_0x47978e(0x2b0)](_0x4fefcd);}}),router[a0_0x296db2(0x2ce)]('/barcode_scanner',async(_0x16f5fb,_0x493d7c)=>{var _0x4b539b=a0_0x296db2;const {product_code:_0x3dba6f,warehouse_name:_0x18c8d6,rooms_data:_0xc34f37,Roomslist:_0x2ae378}=_0x16f5fb[_0x4b539b(0x27e)],_0x37bdc2=_0x2ae378[_0x4b539b(0x255)](','),_0x206c62=[];async function _0x5501d9(_0x3cbdf0){var _0x84fff1=_0x4b539b;const _0x710ca6=await warehouse[_0x84fff1(0x277)]([{'$match':{'name':_0x18c8d6,'room':_0x3cbdf0}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x3dba6f}},{'$group':{'_id':_0x84fff1(0x28d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x84fff1(0x29d)},'primary_code':{'$first':_0x84fff1(0x2e3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x84fff1(0x1f7)},'level':{'$first':_0x84fff1(0x2d6)},'isle':{'$first':_0x84fff1(0x241)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x84fff1(0x22c)},'unit':{'$first':_0x84fff1(0x296)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x84fff1(0x2d0)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x84fff1(0x26f)},'production_date':{'$first':_0x84fff1(0x2b6)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x84fff1(0x259)},'product_cat':{'$first':_0x84fff1(0x2b7)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x84fff1(0x287)}}}]),_0x2850ca=await warehouse[_0x84fff1(0x277)]([{'$match':{'name':_0x18c8d6,'room':_0x3cbdf0}},{'$unwind':_0x84fff1(0x229)},{'$match':{'product_details.secondary_code':_0x3dba6f}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x84fff1(0x29d)},'primary_code':{'$first':_0x84fff1(0x2e3)},'secondary_code':{'$first':_0x84fff1(0x257)},'product_code':{'$first':_0x84fff1(0x1f7)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x84fff1(0x241)},'type':{'$first':_0x84fff1(0x1dd)},'pallet':{'$first':_0x84fff1(0x22c)},'unit':{'$first':_0x84fff1(0x296)},'secondary_unit':{'$first':_0x84fff1(0x1ec)},'storage':{'$first':_0x84fff1(0x2d0)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x84fff1(0x26f)},'production_date':{'$first':_0x84fff1(0x2b6)},'maxPerUnit':{'$first':_0x84fff1(0x26c)},'batch_code':{'$first':_0x84fff1(0x259)},'product_cat':{'$first':_0x84fff1(0x2b7)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x84fff1(0x2d8)},'invoice':{'$first':_0x84fff1(0x287)}}}]);if(_0x710ca6[_0x84fff1(0x1cf)]>0x0)_0x206c62[_0x84fff1(0x2aa)](_0x710ca6);else _0x2850ca['length']>0x0&&_0x206c62[_0x84fff1(0x2aa)](_0x2850ca);}const _0x221e93=_0x37bdc2['map'](_0x7264aa=>_0x5501d9(_0x7264aa));await Promise[_0x4b539b(0x1d7)](_0x221e93),_0x493d7c[_0x4b539b(0x1d6)](_0x206c62);}),module['exports']=router;