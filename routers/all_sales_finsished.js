var a0_0x27c054=a0_0x2992;(function(_0xfcc8aa,_0x4cc9db){var _0x3c675b=a0_0x2992,_0x5a4e14=_0xfcc8aa();while(!![]){try{var _0x40d00c=-parseInt(_0x3c675b(0x109))/0x1+parseInt(_0x3c675b(0x10c))/0x2+-parseInt(_0x3c675b(0x114))/0x3*(-parseInt(_0x3c675b(0x137))/0x4)+parseInt(_0x3c675b(0xe2))/0x5*(parseInt(_0x3c675b(0x77))/0x6)+parseInt(_0x3c675b(0x126))/0x7+-parseInt(_0x3c675b(0x71))/0x8+-parseInt(_0x3c675b(0xf8))/0x9*(parseInt(_0x3c675b(0xc1))/0xa);if(_0x40d00c===_0x4cc9db)break;else _0x5a4e14['push'](_0x5a4e14['shift']());}catch(_0x58e6fb){_0x5a4e14['push'](_0x5a4e14['shift']());}}}(a0_0x3de5,0x84d68));const express=require('express'),app=express(),router=express[a0_0x27c054(0xc3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x27c054(0x16d)),auth=require(a0_0x27c054(0xf2)),nodemailer=require(a0_0x27c054(0x185)),users=require('../public/language/languages.json');router[a0_0x27c054(0x181)](a0_0x27c054(0xe3),auth,async(_0x97563b,_0x3f0b2c)=>{var _0x4e2c16=a0_0x27c054;try{const {username:_0x14347c,email:_0x590716,role:_0x3cde5c}=_0x97563b[_0x4e2c16(0x179)],_0x2a1e93=_0x97563b['user'],_0x3c85ca=await profile[_0x4e2c16(0xaf)]({'email':_0x2a1e93[_0x4e2c16(0x13b)]}),_0x34d895=await master_shop[_0x4e2c16(0x158)]();let _0x2754e6;if(_0x2a1e93[_0x4e2c16(0x154)]==_0x4e2c16(0xce)){const _0x1ab93e=await staff[_0x4e2c16(0xaf)]({'email':_0x2a1e93[_0x4e2c16(0x13b)]});_0x2754e6=await sales_finished[_0x4e2c16(0x15a)]([{'$lookup':{'from':_0x4e2c16(0x162),'localField':_0x4e2c16(0x156),'foreignField':'name','as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':_0x4e2c16(0xa7),'invoice':{'$first':_0x4e2c16(0x115)},'customers':{'$first':'$customer'},'date':{'$first':_0x4e2c16(0xd8)},'warehouse_name':{'$first':_0x4e2c16(0x90)},'sale_product':{'$push':_0x4e2c16(0x175)},'note':{'$first':_0x4e2c16(0x16a)},'return_data':{'$first':_0x4e2c16(0x157)},'customers_docs':{'$first':_0x4e2c16(0x94)},'total_saleproduct_quantity':{'$sum':_0x4e2c16(0xf0)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x4e2c16(0x128)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x4e2c16(0x119)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x2754e6=await sales_finished[_0x4e2c16(0x15a)]([{'$lookup':{'from':_0x4e2c16(0x162),'localField':_0x4e2c16(0x156),'foreignField':_0x4e2c16(0x153),'as':_0x4e2c16(0x139)}},{'$unwind':'$customers_docs'},{'$unwind':_0x4e2c16(0x175)},{'$group':{'_id':_0x4e2c16(0xa7),'invoice':{'$first':_0x4e2c16(0x115)},'customers':{'$first':_0x4e2c16(0xcd)},'date':{'$first':_0x4e2c16(0xd8)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x4e2c16(0x175)},'note':{'$first':_0x4e2c16(0x16a)},'return_data':{'$first':_0x4e2c16(0x157)},'customers_docs':{'$first':_0x4e2c16(0x94)},'total_saleproduct_quantity':{'$sum':_0x4e2c16(0xf0)},'level':{'$addToSet':_0x4e2c16(0xf5)},'isle':{'$addToSet':_0x4e2c16(0x105)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x4e2c16(0xef)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x34d895[0x0]['language']=='English\x20(US)'){var _0x195291=users[_0x4e2c16(0x8b)];console['log'](_0x195291);}else{if(_0x34d895[0x0]['language']==_0x4e2c16(0x17c))var _0x195291=users[_0x4e2c16(0x17c)];else{if(_0x34d895[0x0][_0x4e2c16(0x121)]=='German')var _0x195291=users[_0x4e2c16(0xb2)];else{if(_0x34d895[0x0][_0x4e2c16(0x121)]==_0x4e2c16(0x131))var _0x195291=users[_0x4e2c16(0x131)];else{if(_0x34d895[0x0][_0x4e2c16(0x121)]==_0x4e2c16(0x145))var _0x195291=users[_0x4e2c16(0x145)];else{if(_0x34d895[0x0][_0x4e2c16(0x121)]==_0x4e2c16(0xd4))var _0x195291=users[_0x4e2c16(0x165)];else{if(_0x34d895[0x0][_0x4e2c16(0x121)]==_0x4e2c16(0xbf))var _0x195291=users[_0x4e2c16(0xbf)];else{if(_0x34d895[0x0][_0x4e2c16(0x121)]==_0x4e2c16(0xff))var _0x195291=users[_0x4e2c16(0xde)];}}}}}}}_0x3f0b2c[_0x4e2c16(0x168)](_0x4e2c16(0x10e),{'success':_0x97563b[_0x4e2c16(0x6f)]('success'),'errors':_0x97563b[_0x4e2c16(0x6f)]('errors'),'sales':_0x2754e6,'profile':_0x3c85ca,'role':_0x2a1e93,'master_shop':_0x34d895,'language':_0x195291});}catch(_0x14b3c0){console['log'](_0x14b3c0);}});function a0_0x3de5(){var _0x18b4a8=['Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$finalize','push','/view/return_sales/:id','$product_details.product_stock','final','expiry_date_QA','getMonth','adjust_qty','language','product','/picking_list/pdf/','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','6520304jAYpyO','concat','$sale_product.type','</span>','maxProducts_QA','then','<strong>\x20Regards\x20</strong>','maxPerUnit','date','production_date','$product_details.product_cat','Spanish','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','Sale\x20Return\x20Mail','/view/add_sales/:id','json','sales_quantity_QA','2021684mcMinU','primary_code_QA','customers_docs','product_list','email','carton','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','return_data','for_categorize','<h5\x20style=\x22text-align:\x20left;\x22>','Enclosed','English\x20(US)','room','product_name','French','/all_sales_finished/view','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.batch_code','unit','product_date','Sale\x20Return','stock','sale_product','\x20<>\x20','<hr\x20class=\x22my-3\x22>','batch_code','port','Quality\x20Inspection','name','role','length','customer','$return_data','find','False','aggregate','/view/add_sales','<tr>','FGSEmail','add\x20post','QA\x20Warehouse','redirect','floor','customers','</tr>','/../public','Portuguese','catch','currency','render','$product_details','$note','$product_details.type','exports','../models/all_models','Received\x20Payment\x20For\x20Sale','slice','/upload/','$room','prod_cat','secondary_unit_QA','</head><body>','$sale_product','gmail','$product_details.product_name','warehouse','user','stocks_QA','barcode\x20Product\x20master','Hindi','findById','product_name_QA1','success','</td>','get','log','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_code','nodemailer','flash','$product_details.bay','6640512aLpJHb','createTransport','$product_details.invoice','product_details','purchases_data','$product_details.secondary_code','42WZMdZi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','customer_data','/barcode_scanner','errors','master','</body></html>','$product_details.primary_code','$product_details.unit','getFullYear','<!DOCTYPE\x20html>','edit_sales_finished_view','<h2>\x20','finalize','add_sales_finished','$product_details.expiry_date','An\x20error\x20occurred\x20while\x20saving\x20data.','invoice','English','batch_code_QA','</table>','image','$product_details.rack','$warehouse_name','Sales\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','body','$customers_docs','save','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details._id','status','level','_id','$product_details.secondary_unit','\x20Order\x20Number\x20:\x20','toString','payment\x20successfull','OUTF-','$product_details.storage','Return\x20Rooms','secondary_unit','return_qty_QA','RoomAssigned','$_id','random','<span\x20style=\x22float:\x20right;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</h5>','barcode\x20user_id','$product_details.maxPerUnit','Logo.png','findOne','return_sale','back','German','prod_code','<tbody\x20style=\x22text-align:\x20center;\x22>','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','return_sale_finished','product_code','product_code_QA','/barcode/:id','edit_sales_finished','prod_invoice','Finished\x20Goods','message','Chinese','sendMail','3540KTircD','<html><head><title></title>','Router','params','\x20Order\x20Date\x20:\x20','map','</thead>','Return\x20Goods','expiry_date','Enabled','foreach\x20newproduct','$product_details.maxProducts','$customer','staff','bay','primary_unit','abs','sales_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Portuguese\x20(BR)','max_per_unit','sales\x20item\x20return\x20successfull','post','$date','/all_sales_finished/preview/','$product_details.floorlevel','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$name','Arabic','Sales\x20Update\x20successfully','<div>','suppliers','757520xOVVtl','/view','secondary_code','<h5>','sale_qty','quantity','room_name','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</tbody>','getDate','all_sales_barcode','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$sale_product.floorlevel','$sale_product.quantity','primary_code','../middleware/auth','currency_placement','return_sale_QA','$sale_product.bay','Sale\x20Product\x20Mail','received_amount','28863mnjtff','unit_QA','logo','forEach','secondary_code_QA','all','password','Arabic\x20(ae)','/give_payment/:id','$product_details.production_date','filter','Email\x20sent\x20successfully','error','$sale_product.bin','/all_sales/view','maxProducts','$product','681767VVGpVK','maxPerUnit_QA','warehouse_name','376742wyQkSv','return_qty','all_sales_finished','True','padStart','\x20</h2>','site_title','<table\x20style=\x22width:\x20100%\x20!important;\x22>','6ZGXNbh','$invoice','Error\x20Occurs','$product_details.bin'];a0_0x3de5=function(){return _0x18b4a8;};return a0_0x3de5();}function a0_0x2992(_0x27e55c,_0x4ec072){var _0x3de5d8=a0_0x3de5();return a0_0x2992=function(_0x299230,_0x261a70){_0x299230=_0x299230-0x6f;var _0xc6240a=_0x3de5d8[_0x299230];return _0xc6240a;},a0_0x2992(_0x27e55c,_0x4ec072);}async function getRandom8DigitNumber(){var _0x4e609f=a0_0x27c054;const _0x59c45f=0x989680,_0x2295de=0x5f5e0ff,_0x55b750=Math[_0x4e609f(0x161)](Math[_0x4e609f(0xa8)]()*(_0x2295de-_0x59c45f+0x1))+_0x59c45f;var _0x5b8675;const _0x4e6ca0=await sales_finished['findOne']({'invoice':_0x4e609f(0xa1)+_0x55b750});return _0x4e6ca0&&_0x4e6ca0[_0x4e609f(0x155)]>0x0?_0x5b8675=_0x4e609f(0xa1)+_0x55b750:_0x5b8675=_0x4e609f(0xa1)+_0x55b750,_0x5b8675;}router[a0_0x27c054(0x181)]('/view/add_sales',auth,async(_0x2596f6,_0x3271bc)=>{var _0x2a6bbd=a0_0x27c054;try{const {username:_0x192b6c,email:_0x5065d7,role:_0x5914e7}=_0x2596f6[_0x2a6bbd(0x179)],_0x79f42f=_0x2596f6[_0x2a6bbd(0x179)],_0x422ae2=await profile['findOne']({'email':_0x79f42f[_0x2a6bbd(0x13b)]}),_0x5dc968=await master_shop[_0x2a6bbd(0x158)](),_0x5f5621=await customer[_0x2a6bbd(0x158)]({});let _0x3836e1;if(_0x79f42f['role']==_0x2a6bbd(0xce)){const _0x185ff6=await staff['findOne']({'email':_0x79f42f['email']});_0x3836e1=await warehouse[_0x2a6bbd(0x15a)]([{'$match':{'status':_0x2a6bbd(0xca),'name':_0x185ff6[_0x2a6bbd(0x178)],'warehouse_category':_0x2a6bbd(0xbd),'name':{'$ne':_0x2a6bbd(0x15f)}}},{'$group':{'_id':'$name','name':{'$first':_0x2a6bbd(0xdd)}}},{'$sort':{'name':0x1}}]);}else _0x3836e1=await warehouse['aggregate']([{'$match':{'status':_0x2a6bbd(0xca),'warehouse_category':_0x2a6bbd(0xbd),'name':{'$ne':_0x2a6bbd(0x15f)}}},{'$group':{'_id':_0x2a6bbd(0xdd),'name':{'$first':_0x2a6bbd(0xdd)}}},{'$sort':{'name':0x1}}]);const _0x587f85=await product[_0x2a6bbd(0x158)]({});var _0x29f116=['Ambient',_0x2a6bbd(0x141)];const _0x13091d=await sales_finished[_0x2a6bbd(0x158)]({}),_0x4fa9f3=_0x13091d[_0x2a6bbd(0x155)]+0x1,_0x4753cc='OUTF-'+_0x4fa9f3[_0x2a6bbd(0x9f)]()[_0x2a6bbd(0x110)](0x5,'0');if(_0x5dc968[0x0][_0x2a6bbd(0x121)]==_0x2a6bbd(0x142)){var _0x5ea676=users[_0x2a6bbd(0x8b)];console['log'](_0x5ea676);}else{if(_0x5dc968[0x0][_0x2a6bbd(0x121)]==_0x2a6bbd(0x17c))var _0x5ea676=users['Hindi'];else{if(_0x5dc968[0x0][_0x2a6bbd(0x121)]==_0x2a6bbd(0xb2))var _0x5ea676=users['German'];else{if(_0x5dc968[0x0][_0x2a6bbd(0x121)]==_0x2a6bbd(0x131))var _0x5ea676=users[_0x2a6bbd(0x131)];else{if(_0x5dc968[0x0][_0x2a6bbd(0x121)]==_0x2a6bbd(0x145))var _0x5ea676=users[_0x2a6bbd(0x145)];else{if(_0x5dc968[0x0]['language']==_0x2a6bbd(0xd4))var _0x5ea676=users[_0x2a6bbd(0x165)];else{if(_0x5dc968[0x0]['language']==_0x2a6bbd(0xbf))var _0x5ea676=users['Chinese'];else{if(_0x5dc968[0x0][_0x2a6bbd(0x121)]=='Arabic\x20(ae)')var _0x5ea676=users['Arabic'];}}}}}}}const _0x3ecc57=getRandom8DigitNumber();_0x3ecc57['then'](_0x325a7b=>{var _0x935c65=_0x2a6bbd;_0x3271bc[_0x935c65(0x168)](_0x935c65(0x87),{'success':_0x2596f6[_0x935c65(0x6f)](_0x935c65(0x17f)),'errors':_0x2596f6[_0x935c65(0x6f)]('errors'),'role':_0x79f42f,'profile':_0x422ae2,'customer':_0x5f5621,'warehouse':_0x3836e1,'product':_0x587f85,'invoice':_0x325a7b,'master_shop':_0x5dc968,'language':_0x5ea676,'rooms_data':_0x29f116});})[_0x2a6bbd(0x166)](_0x8e4a26=>{var _0x4dc332=_0x2a6bbd;_0x2596f6['flash'](_0x4dc332(0x7d),_0x4dc332(0x124)),_0x3271bc[_0x4dc332(0x160)](_0x4dc332(0x146));});}catch(_0x5afc85){console['log'](_0x5afc85);}}),router[a0_0x27c054(0x181)](a0_0x27c054(0x134),auth,async(_0x39dd81,_0x41cfb0)=>{var _0x3522cf=a0_0x27c054;try{const _0x1f0f12=_0x39dd81['params']['id'];console['log'](_0x1f0f12);const _0x33c2d2=await product['find'](),_0x18a261=await purchases[_0x3522cf(0x15a)]([{'$match':{'warehouse_name':_0x1f0f12}},{'$unwind':_0x3522cf(0x108)},{'$group':{'_id':'$product.product_name'}}]);console[_0x3522cf(0x182)](_0x3522cf(0x75),_0x18a261),_0x41cfb0[_0x3522cf(0x9a)](0xc8)['json']({'purchases_data':_0x18a261,'product_data':_0x33c2d2});}catch(_0x4562a2){console['log'](_0x4562a2);}}),router[a0_0x27c054(0xd7)]('/view/add_sale/product',auth,async(_0x43075f,_0x62e7bc)=>{var _0x2592fe=a0_0x27c054;try{const {warehouse_data:_0x19396d,product_data:_0x30d9d9}=_0x43075f[_0x2592fe(0x93)];console[_0x2592fe(0x182)](_0x43075f[_0x2592fe(0x93)]['product_data']);;const _0x2a2060=await master_shop[_0x2592fe(0x158)]();console[_0x2592fe(0x182)](_0x2592fe(0x7e),_0x2a2060);const _0x33aa39=await product[_0x2592fe(0xaf)]({'name':_0x30d9d9});console['log'](_0x2592fe(0x122),_0x33aa39);const _0x422c2a=await warehouse[_0x2592fe(0x15a)]([{'$match':{'name':_0x19396d}},{'$unwind':_0x2592fe(0x169)},{'$match':{'product_details.product_name':_0x30d9d9}},{'$group':{'_id':_0x2592fe(0x177),'product_stock':{'$first':_0x2592fe(0x11c)}}}]);console[_0x2592fe(0x182)]('stock_data',_0x422c2a),_0x62e7bc[_0x2592fe(0x9a)](0xc8)['json']({'master':_0x2a2060,'new_product':_0x33aa39,'stock_data':_0x422c2a});}catch(_0x12d862){console['log'](_0x12d862);}}),router['post'](a0_0x27c054(0x15b),auth,async(_0x509500,_0x26a446)=>{var _0x4d295c=a0_0x27c054;try{const {invoice:_0x91f0a4,date:_0x3ed474,warehouse_name:_0x56076d,product_name:_0x4755a2,stock:_0x453b51,quantity:_0x458ccf,note:_0x35043d,room:_0x100c4b,primary_code:_0x392b9e,secondary_code:_0xd4eb04,prod_code:_0x1e18f9,level:_0x3bc067,isle:_0x3a5673,pallet:_0x47453e,batch_code:_0x42eb83,SCRN:_0x593401,expiry_date:_0x2218c7,mode_transpo:_0x227a61,name_driver:_0x4621ad}=_0x509500['body'];if(typeof _0x4755a2==_0x4d295c(0x96))var _0x21bc9c=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0x144)]],_0x2b0cda=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0x14c)]],_0x2eee35=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0x13c)]],_0xb7552f=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0xf1)]],_0x351b6f=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0xe4)]],_0xe8f0db=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0xb3)]],_0x4852ea=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0x9b)]],_0x3cd746=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0xd0)]],_0xee4b74=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0xa4)]],_0x2fd7af=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0x150)]],_0xf9c3ed=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0xc9)]],_0x260119=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0x14a)]],_0x5cb49b=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0xd5)]],_0xff75d6=[_0x509500[_0x4d295c(0x93)]['prod_cat']],_0x1feba0=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0xa6)]],_0x54a89a=[_0x509500[_0x4d295c(0x93)][_0x4d295c(0xbc)]];else var _0x21bc9c=[..._0x509500[_0x4d295c(0x93)][_0x4d295c(0x144)]],_0x2b0cda=[..._0x509500[_0x4d295c(0x93)][_0x4d295c(0x14c)]],_0x2eee35=[..._0x509500['body'][_0x4d295c(0x13c)]],_0xb7552f=[..._0x509500[_0x4d295c(0x93)]['primary_code']],_0x351b6f=[..._0x509500[_0x4d295c(0x93)][_0x4d295c(0xe4)]],_0xe8f0db=[..._0x509500[_0x4d295c(0x93)][_0x4d295c(0xb3)]],_0x4852ea=[..._0x509500['body'][_0x4d295c(0x9b)]],_0x3cd746=[..._0x509500[_0x4d295c(0x93)][_0x4d295c(0xd0)]],_0xee4b74=[..._0x509500[_0x4d295c(0x93)][_0x4d295c(0xa4)]],_0x2fd7af=[..._0x509500[_0x4d295c(0x93)][_0x4d295c(0x150)]],_0xf9c3ed=[..._0x509500['body'][_0x4d295c(0xc9)]],_0x260119=[..._0x509500[_0x4d295c(0x93)]['product_date']],_0x5cb49b=[..._0x509500[_0x4d295c(0x93)][_0x4d295c(0xd5)]],_0xff75d6=[..._0x509500[_0x4d295c(0x93)][_0x4d295c(0x172)]],_0x1feba0=[..._0x509500['body'][_0x4d295c(0xa6)]],_0x54a89a=[..._0x509500[_0x4d295c(0x93)][_0x4d295c(0xbc)]];const _0x2bd0d9=_0x21bc9c[_0x4d295c(0xc6)](_0x17b5b9=>{return _0x17b5b9={'product_name':_0x17b5b9};});_0x2b0cda[_0x4d295c(0xfb)]((_0x32a200,_0x2a1bb6)=>{var _0x1bbe2f=_0x4d295c;_0x2bd0d9[_0x2a1bb6][_0x1bbe2f(0x14c)]=_0x32a200;}),_0x2eee35[_0x4d295c(0xfb)]((_0x408db7,_0xd9213b)=>{var _0x372542=_0x4d295c;_0x2bd0d9[_0xd9213b][_0x372542(0xe7)]=Math[_0x372542(0xd1)](_0x408db7);}),_0xb7552f[_0x4d295c(0xfb)]((_0x38f76b,_0x4d2f93)=>{var _0x2ea530=_0x4d295c;_0x2bd0d9[_0x4d2f93][_0x2ea530(0xf1)]=_0x38f76b;}),_0x351b6f[_0x4d295c(0xfb)]((_0x85c373,_0x16e4c0)=>{var _0x343ec0=_0x4d295c;_0x2bd0d9[_0x16e4c0][_0x343ec0(0xe4)]=_0x85c373;}),_0xe8f0db[_0x4d295c(0xfb)]((_0x50fcf5,_0x563688)=>{var _0x543c0a=_0x4d295c;_0x2bd0d9[_0x563688][_0x543c0a(0xb8)]=_0x50fcf5;}),_0x4852ea['forEach']((_0x9f186d,_0x583ba3)=>{var _0x27e6fb=_0x4d295c;_0x2bd0d9[_0x583ba3][_0x27e6fb(0xcf)]=_0x9f186d;}),_0x3cd746['forEach']((_0x2875dd,_0xaa5f3d)=>{var _0x279a11=_0x4d295c;_0x2bd0d9[_0xaa5f3d][_0x279a11(0x149)]=_0x2875dd;}),_0xee4b74['forEach']((_0x1e6808,_0x44afb6)=>{var _0x434c7f=_0x4d295c;_0x2bd0d9[_0x44afb6][_0x434c7f(0xa4)]=_0x1e6808;}),_0x2fd7af['forEach']((_0x4cc452,_0x534954)=>{var _0x1f69f2=_0x4d295c;_0x2bd0d9[_0x534954][_0x1f69f2(0x150)]=_0x4cc452;}),_0xf9c3ed[_0x4d295c(0xfb)]((_0xa317d8,_0xd97558)=>{var _0x46bc82=_0x4d295c;_0x2bd0d9[_0xd97558][_0x46bc82(0xc9)]=_0xa317d8;}),_0x260119[_0x4d295c(0xfb)]((_0x187b7e,_0x2e4bd0)=>{var _0x2931c4=_0x4d295c;_0x2bd0d9[_0x2e4bd0][_0x2931c4(0x12f)]=_0x187b7e;}),_0x5cb49b[_0x4d295c(0xfb)]((_0x459dea,_0x159ff4)=>{_0x2bd0d9[_0x159ff4]['maxperunit']=_0x459dea;}),_0xff75d6['forEach']((_0xe442fc,_0x39baed)=>{var _0x490031=_0x4d295c;_0x2bd0d9[_0x39baed][_0x490031(0x172)]=_0xe442fc;}),_0x1feba0['forEach']((_0x1139f1,_0x1092a8)=>{var _0x3a9732=_0x4d295c;_0x2bd0d9[_0x1092a8][_0x3a9732(0xe8)]=_0x1139f1;}),_0x54a89a[_0x4d295c(0xfb)]((_0x2ac7da,_0xba8ec6)=>{var _0x4810c4=_0x4d295c;_0x2bd0d9[_0xba8ec6][_0x4810c4(0x8a)]=_0x2ac7da;});var _0x1a5664=0x0;_0x2bd0d9[_0x4d295c(0xfb)](_0x157834=>{var _0x5e396d=_0x4d295c;parseFloat(_0x157834['stock'])<parseFloat(_0x157834['quantity'])&&parseFloat(_0x157834[_0x5e396d(0xe7)])>parseFloat(_0x157834[_0x5e396d(0x14c)])&&(console['log'](_0x157834[_0x5e396d(0x14c)]+_0x5e396d(0x14e)+_0x157834['quantity']),_0x1a5664++);});if(_0x1a5664!=0x0)return _0x509500[_0x4d295c(0x6f)](_0x4d295c(0x7d),_0x4d295c(0x132)),_0x26a446[_0x4d295c(0x160)](_0x4d295c(0xb1));const _0xfeb8e8=_0x2bd0d9['filter'](_0x3e5648=>_0x3e5648[_0x4d295c(0xe7)]!=='0'&&_0x3e5648[_0x4d295c(0xe7)]!==''),_0xe1a473=new sales_finished({'invoice':_0x91f0a4,'customer':_0x509500[_0x4d295c(0x93)][_0x4d295c(0x156)],'date':_0x3ed474,'warehouse_name':_0x56076d,'sale_product':_0xfeb8e8,'note':_0x35043d,'room':_0x100c4b,'primary_code':_0x392b9e,'secondary_code':_0xd4eb04,'prod_code':_0x1e18f9,'SCRN':_0x593401,'finalize':_0x4d295c(0x159),'mode_transpo':_0x227a61,'name_driver':_0x4621ad}),_0x9919b9=await _0xe1a473['save'](),_0x419dfa=await sales_finished['findOne']({'invoice':_0x91f0a4}),_0x26742e=new c_payment_data({'invoice':_0x91f0a4,'customer':_0x509500['body']['customer'],'reason':'Sale'});await _0x26742e[_0x4d295c(0x95)]();const _0x89598c=await master_shop[_0x4d295c(0x158)](),_0x52c926=await email_settings['findOne'](),_0x526343=await customer['findOne']({'name':_0x509500[_0x4d295c(0x93)]['customer']});_0x89598c[0x0][_0x4d295c(0xf3)]==0x1?(right_currency=_0x89598c[0x0][_0x4d295c(0x167)],left_currency=''):(right_currency='',left_currency=_0x89598c[0x0][_0x4d295c(0x167)]);var _0x153017=_0x21bc9c,_0x5b97a7=_0x2eee35,_0x5d1e72='',_0x1d71ca;for(_0x1d71ca in _0x153017){_0x5d1e72+='<tr>'+_0x4d295c(0x183)+_0x153017[_0x1d71ca]+_0x4d295c(0x180)+_0x4d295c(0x183)+_0x5b97a7[_0x1d71ca]+_0x4d295c(0x180)+'</tr>';}console[_0x4d295c(0x182)](_0x4d295c(0x13a),_0x5d1e72);let _0x1fd995=nodemailer[_0x4d295c(0x72)]({'service':_0x4d295c(0x176),'auth':{'user':_0x52c926[_0x4d295c(0x13b)],'pass':_0x52c926['password']}}),_0x33d0e9={'from':_0x52c926['email'],'to':_0x526343[_0x4d295c(0x13b)],'subject':_0x4d295c(0xf6),'attachments':[{'filename':'Logo.png','path':__dirname+_0x4d295c(0x164)+'/upload/'+_0x89598c[0x0][_0x4d295c(0x8e)],'cid':'logo'}],'html':_0x4d295c(0x83)+'<html><head><title></title>'+'</head><body>'+_0x4d295c(0xe0)+_0x4d295c(0x147)+_0x4d295c(0xe0)+_0x4d295c(0xaa)+_0x4d295c(0xdb)+_0x4d295c(0xe0)+_0x4d295c(0x85)+_0x89598c[0x0][_0x4d295c(0x112)]+_0x4d295c(0x111)+_0x4d295c(0xdb)+_0x4d295c(0xdb)+_0x4d295c(0x14f)+_0x4d295c(0xe0)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4d295c(0x9e)+_0x91f0a4+'\x20'+_0x4d295c(0xa9)+_0x4d295c(0xc5)+_0x3ed474+'\x20'+_0x4d295c(0x129)+_0x4d295c(0xab)+_0x4d295c(0xdb)+_0x4d295c(0x113)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4d295c(0x15c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>'+_0x4d295c(0x163)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5d1e72+'\x20'+_0x4d295c(0xeb)+'</table>'+'<div>'+_0x4d295c(0x12c)+_0x4d295c(0xe5)+_0x89598c[0x0]['site_title']+'</h5>'+_0x4d295c(0xdb)+'</div>'+_0x4d295c(0x7f)};_0x1fd995[_0x4d295c(0xc0)](_0x33d0e9,function(_0x4a1444,_0x56563e){var _0x178ad9=_0x4d295c;_0x4a1444?(console['log'](_0x4a1444),console['log'](_0x178ad9(0x116))):console[_0x178ad9(0x182)](_0x178ad9(0x103));}),_0x509500['flash'](_0x4d295c(0x17f),'Sales\x20Add\x20successfully'),_0x26a446[_0x4d295c(0x160)](_0x4d295c(0xd9)+_0x9919b9[_0x4d295c(0x9c)]);}catch(_0x5276ed){console[_0x4d295c(0x182)](_0x5276ed);}}),router[a0_0x27c054(0x181)]('/preview/:id',auth,async(_0x212910,_0x4536f5)=>{var _0x44d16d=a0_0x27c054;try{const {username:_0x147b05,email:_0x48b24a,role:_0x2f1143}=_0x212910[_0x44d16d(0x179)],_0x49a548=_0x212910['user'],_0x1a7c0c=await profile['findOne']({'email':_0x49a548[_0x44d16d(0x13b)]}),_0x3de548=await master_shop['find'](),_0x2ad3ec=_0x212910[_0x44d16d(0xc4)]['id'],_0x83ade=await sales_finished[_0x44d16d(0x17d)](_0x2ad3ec),_0x5bed66=await warehouse[_0x44d16d(0x15a)]([{'$match':{'name':_0x83ade[_0x44d16d(0x10b)]}},{'$unwind':_0x44d16d(0x169)},{'$group':{'_id':_0x44d16d(0x99),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x44d16d(0x11c)},'bay':{'$first':_0x44d16d(0x70)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x44d16d(0xda)},'primary_code':{'$first':_0x44d16d(0x80)},'secondary_code':{'$first':_0x44d16d(0x76)},'product_code':{'$first':_0x44d16d(0x184)},'storage':{'$first':_0x44d16d(0xa2)},'rack':{'$first':_0x44d16d(0x8f)},'expiry_date':{'$first':_0x44d16d(0x88)},'production_date':{'$first':_0x44d16d(0x101)},'batch_code':{'$first':_0x44d16d(0x148)},'room':{'$first':'$room'}}}]),_0xb7d0d6=await customer['find']({});let _0xbca5e0;if(_0x49a548['role']==_0x44d16d(0xce)){const _0x3aa6d1=await staff[_0x44d16d(0xaf)]({'email':_0x49a548[_0x44d16d(0x13b)]});_0xbca5e0=await warehouse[_0x44d16d(0x15a)]([{'$match':{'status':_0x44d16d(0xca),'name':_0x3aa6d1[_0x44d16d(0x178)]}},{'$group':{'_id':'$name','name':{'$first':_0x44d16d(0xdd)}}}]);}else _0xbca5e0=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x44d16d(0xdd)}}}]);const _0x1f0867=await product[_0x44d16d(0x158)]({});if(_0x3de548[0x0]['language']==_0x44d16d(0x142)){var _0x24faa6=users[_0x44d16d(0x8b)];console['log'](_0x24faa6);}else{if(_0x3de548[0x0][_0x44d16d(0x121)]==_0x44d16d(0x17c))var _0x24faa6=users['Hindi'];else{if(_0x3de548[0x0][_0x44d16d(0x121)]==_0x44d16d(0xb2))var _0x24faa6=users[_0x44d16d(0xb2)];else{if(_0x3de548[0x0]['language']==_0x44d16d(0x131))var _0x24faa6=users['Spanish'];else{if(_0x3de548[0x0]['language']=='French')var _0x24faa6=users[_0x44d16d(0x145)];else{if(_0x3de548[0x0][_0x44d16d(0x121)]==_0x44d16d(0xd4))var _0x24faa6=users['Portuguese'];else{if(_0x3de548[0x0][_0x44d16d(0x121)]==_0x44d16d(0xbf))var _0x24faa6=users['Chinese'];else{if(_0x3de548[0x0][_0x44d16d(0x121)]==_0x44d16d(0xff))var _0x24faa6=users['Arabic'];}}}}}}}_0x4536f5['render'](_0x44d16d(0x84),{'success':_0x212910[_0x44d16d(0x6f)](_0x44d16d(0x17f)),'errors':_0x212910['flash']('errors'),'role':_0x49a548,'profile':_0x1a7c0c,'customer':_0xb7d0d6,'warehouse':_0xbca5e0,'product':_0x5bed66,'user':_0x83ade,'master_shop':_0x3de548,'unit':_0x1f0867,'language':_0x24faa6});}catch(_0x3bd2f3){console[_0x44d16d(0x182)](_0x3bd2f3);}}),router['post']('/preview/:id',auth,async(_0x296603,_0x508f46)=>{var _0xa46434=a0_0x27c054;try{const _0xd10a41=_0x296603[_0xa46434(0xc4)]['id'],{invoice:_0x42402b,warehouse_name:_0x2d682c,room:_0x3f35d2}=_0x296603[_0xa46434(0x93)],_0x4da5dd=await sales_finished[_0xa46434(0xaf)]({'invoice':_0x42402b}),_0x2cc873=_0x4da5dd[_0xa46434(0x14d)][_0xa46434(0xc6)](async _0x495032=>{var _0x523d6f=_0xa46434,_0x45f929=await warehouse[_0x523d6f(0xaf)]({'name':_0x2d682c,'room':_0x495032['room_name'],'warehouse_category':_0x523d6f(0xbd)});const _0x481759=_0x45f929['product_details'][_0x523d6f(0xc6)](_0x7a109f=>{var _0x5afaa5=_0x523d6f;_0x7a109f['product_name']==_0x495032[_0x5afaa5(0x144)]&&_0x7a109f['bay']==_0x495032['bay']&&_0x7a109f['expiry_date']==_0x495032[_0x5afaa5(0xc9)]&&_0x7a109f[_0x5afaa5(0x12f)]==_0x495032['production_date']&&_0x7a109f['batch_code']==_0x495032[_0x5afaa5(0x150)]&&_0x7a109f[_0x5afaa5(0x8a)]==_0x495032[_0x5afaa5(0x8a)]&&(_0x7a109f[_0x5afaa5(0xe9)]=Math[_0x5afaa5(0xd1)](_0x7a109f[_0x5afaa5(0xe9)])-Math[_0x5afaa5(0xd1)](_0x495032[_0x5afaa5(0xe7)]));});return _0x45f929;});Promise[_0xa46434(0xfd)](_0x2cc873)[_0xa46434(0x12b)](async _0x3d4c41=>{var _0x5c1541=_0xa46434;try{for(const _0x353b8d of _0x3d4c41){await _0x353b8d['save']();}_0x4da5dd[_0x5c1541(0x86)]=_0x5c1541(0x10f);const _0x43c185=await _0x4da5dd[_0x5c1541(0x95)](),_0x29a11a=await master_shop[_0x5c1541(0x158)](),_0x4c3da0=await email_settings[_0x5c1541(0xaf)](),_0xc185e6=await supervisor_settings['find']();var _0x594edc=_0x4da5dd[_0x5c1541(0x14d)],_0x159c0f='',_0x1d07a3;for(_0x1d07a3 in _0x594edc){var _0x53d14c='FG';_0x4da5dd[_0x5c1541(0x10b)]=='DRY\x20GOODS'&&(_0x53d14c='DG'),_0x159c0f+=_0x5c1541(0x15c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x594edc[_0x1d07a3][_0x5c1541(0x144)]+'</td>'+_0x5c1541(0x183)+_0x594edc[_0x1d07a3][_0x5c1541(0xb8)]+_0x5c1541(0x180)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x594edc[_0x1d07a3]['quantity']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x594edc[_0x1d07a3][_0x5c1541(0x149)]+_0x5c1541(0x180)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x594edc[_0x1d07a3][_0x5c1541(0xa4)]+_0x5c1541(0x180)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4da5dd['warehouse_name']+_0x5c1541(0x180)+_0x5c1541(0x183)+_0x594edc[_0x1d07a3][_0x5c1541(0xe8)]+_0x5c1541(0x180)+_0x5c1541(0x183)+_0x53d14c+_0x594edc[_0x1d07a3][_0x5c1541(0xcf)]+_0x5c1541(0x180);}let _0x5dfa7a=nodemailer[_0x5c1541(0x72)]({'host':_0x4c3da0['host'],'port':Number(_0x4c3da0[_0x5c1541(0x151)]),'secure':![],'auth':{'user':_0x4c3da0['email'],'pass':_0x4c3da0[_0x5c1541(0xfe)]}}),_0x1b2ae2={'from':_0x4c3da0[_0x5c1541(0x13b)],'to':_0xc185e6[0x0][_0x5c1541(0x15d)],'subject':_0x5c1541(0x91),'attachments':[{'filename':_0x5c1541(0xae),'path':__dirname+_0x5c1541(0x164)+'/upload/'+_0x29a11a[0x0][_0x5c1541(0x8e)],'cid':_0x5c1541(0xfa)}],'html':_0x5c1541(0x83)+_0x5c1541(0xc2)+_0x5c1541(0x174)+_0x5c1541(0xe0)+_0x5c1541(0x147)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x5c1541(0xe0)+_0x5c1541(0x85)+_0x29a11a[0x0][_0x5c1541(0x112)]+_0x5c1541(0x111)+_0x5c1541(0xdb)+_0x5c1541(0xdb)+_0x5c1541(0x14f)+_0x5c1541(0xe0)+_0x5c1541(0x140)+_0x5c1541(0x9e)+_0x4da5dd[_0x5c1541(0x8a)]+'\x20'+_0x5c1541(0xa9)+_0x5c1541(0xc5)+_0x4da5dd[_0x5c1541(0x12e)]+'\x20'+_0x5c1541(0x129)+_0x5c1541(0xab)+'</div>'+_0x5c1541(0x113)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5c1541(0x15c)+_0x5c1541(0x13d)+_0x5c1541(0xea)+_0x5c1541(0x7a)+_0x5c1541(0xdc)+_0x5c1541(0xd3)+_0x5c1541(0x97)+_0x5c1541(0xee)+_0x5c1541(0x98)+_0x5c1541(0x163)+_0x5c1541(0xc7)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x159c0f+'\x20'+_0x5c1541(0xeb)+'</table>'+_0x5c1541(0xe0)+_0x5c1541(0x12c)+_0x5c1541(0xe5)+_0x29a11a[0x0][_0x5c1541(0x112)]+_0x5c1541(0xab)+_0x5c1541(0xdb)+_0x5c1541(0xdb)+'</body></html>'};_0x5dfa7a[_0x5c1541(0xc0)](_0x1b2ae2,function(_0x4a1925,_0x2e2c12){var _0x57d3e1=_0x5c1541;_0x4a1925?(console['log'](_0x4a1925),console[_0x57d3e1(0x182)](_0x57d3e1(0x116))):console['log'](_0x57d3e1(0x103));}),_0x296603[_0x5c1541(0x6f)]('success',_0x5c1541(0xdf)),_0x508f46['redirect'](_0x5c1541(0x123)+_0xd10a41);}catch(_0x94ed10){console['error'](_0x94ed10),_0x508f46[_0x5c1541(0x9a)](0x1f4)[_0x5c1541(0x135)]({'error':_0x5c1541(0x89)});}})[_0xa46434(0x166)](_0x2e1d3e=>{var _0x340bb3=_0xa46434;console[_0x340bb3(0x104)](_0x2e1d3e),_0x508f46['status'](0x1f4)[_0x340bb3(0x135)]({'error':'An\x20error\x20occurred.'});});}catch(_0x307521){console[_0xa46434(0x182)](_0x307521);}}),router[a0_0x27c054(0x181)](a0_0x27c054(0xb5),auth,async(_0x443b27,_0x4fa1de)=>{var _0xce1929=a0_0x27c054;try{const {username:_0x32bfaf,email:_0x5f05b8,role:_0x353557}=_0x443b27[_0xce1929(0x179)],_0x473c00=_0x443b27[_0xce1929(0x179)],_0x538673=await profile['findOne']({'email':_0x473c00[_0xce1929(0x13b)]}),_0x237d6e=await master_shop['find'](),_0x3f856a=_0x443b27[_0xce1929(0xc4)]['id'],_0x39631d=await sales_finished[_0xce1929(0x17d)](_0x3f856a);let _0xf37b4a=new Date(_0x39631d[_0xce1929(0xc9)]),_0x15392f=('0'+_0xf37b4a[_0xce1929(0xec)]())[_0xce1929(0x16f)](-0x2),_0x2b6461=('0'+(_0xf37b4a['getMonth']()+0x1))[_0xce1929(0x16f)](-0x2),_0x54d840=_0xf37b4a[_0xce1929(0x82)](),_0x2d9a52=_0x54d840+'-'+_0x2b6461+'-'+_0x15392f;var _0x269182=['Ambient',_0xce1929(0x141)];const _0x497db9=await warehouse[_0xce1929(0x15a)]([{'$match':{'name':_0x39631d[_0xce1929(0x10b)],'room':_0x39631d[_0xce1929(0x143)]}},{'$unwind':_0xce1929(0x169)},{'$group':{'_id':_0xce1929(0x99),'name':{'$first':_0xce1929(0x177)},'product_stock':{'$first':_0xce1929(0x11c)},'bay':{'$first':_0xce1929(0x70)},'bin':{'$first':_0xce1929(0x117)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0xce1929(0xda)},'primary_code':{'$first':_0xce1929(0x80)},'secondary_code':{'$first':_0xce1929(0x76)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xce1929(0xa2)},'rack':{'$first':'$product_details.rack'}}}]),_0x5710c4=await customer[_0xce1929(0x158)]({});let _0x2552aa;if(_0x473c00[_0xce1929(0x154)]==_0xce1929(0xce)){const _0x4c9b54=await staff[_0xce1929(0xaf)]({'email':_0x473c00['email']});_0x2552aa=await warehouse[_0xce1929(0x15a)]([{'$match':{'status':_0xce1929(0xca),'name':_0x4c9b54['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0xce1929(0xdd)}}}]);}else _0x2552aa=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0xce1929(0xdd),'name':{'$first':'$name'}}}]);const _0xf7cb7=await product[_0xce1929(0x158)]({});if(_0x237d6e[0x0]['language']==_0xce1929(0x142)){var _0x4675bc=users[_0xce1929(0x8b)];console[_0xce1929(0x182)](_0x4675bc);}else{if(_0x237d6e[0x0]['language']==_0xce1929(0x17c))var _0x4675bc=users[_0xce1929(0x17c)];else{if(_0x237d6e[0x0][_0xce1929(0x121)]=='German')var _0x4675bc=users['German'];else{if(_0x237d6e[0x0][_0xce1929(0x121)]==_0xce1929(0x131))var _0x4675bc=users[_0xce1929(0x131)];else{if(_0x237d6e[0x0][_0xce1929(0x121)]=='French')var _0x4675bc=users[_0xce1929(0x145)];else{if(_0x237d6e[0x0][_0xce1929(0x121)]==_0xce1929(0xd4))var _0x4675bc=users[_0xce1929(0x165)];else{if(_0x237d6e[0x0][_0xce1929(0x121)]==_0xce1929(0xbf))var _0x4675bc=users[_0xce1929(0xbf)];else{if(_0x237d6e[0x0][_0xce1929(0x121)]==_0xce1929(0xff))var _0x4675bc=users[_0xce1929(0xde)];}}}}}}}_0x4fa1de[_0xce1929(0x168)](_0xce1929(0xbb),{'success':_0x443b27[_0xce1929(0x6f)](_0xce1929(0x17f)),'errors':_0x443b27[_0xce1929(0x6f)](_0xce1929(0x7d)),'role':_0x473c00,'profile':_0x538673,'customer':_0x5710c4,'warehouse':_0x2552aa,'product':_0x497db9,'user':_0x39631d,'master_shop':_0x237d6e,'unit':_0xf7cb7,'language':_0x4675bc,'rooms_data':_0x269182,'ed_fullDate':_0x2d9a52});}catch(_0x3e59e2){console[_0xce1929(0x182)](_0x3e59e2);}}),router['post'](a0_0x27c054(0xb5),auth,async(_0xbba29d,_0x49b8f1)=>{var _0x4ae213=a0_0x27c054;try{const _0x1a1cf2=_0xbba29d[_0x4ae213(0xc4)]['id'],_0x138e8a=await sales_finished[_0x4ae213(0xaf)]({'_id':_0xbba29d['params']['id']}),_0x39a44d=await warehouse['findOne']({'name':_0x138e8a['warehouse_name'],'room':_0xbba29d[_0x4ae213(0x93)][_0x4ae213(0x143)],'warehouse_category':_0x4ae213(0xbd)}),{invoice:_0x3dfadd,customer:_0x591e0a,date:_0x541222,warehouse_name:_0x423b0c,product_name:_0x441d5c,stock:_0x4c98bf,adjust_qty:_0x26c9bc,note:_0x52e13d,room:_0x1a6492,primary_code:_0x490563,secondary_code:_0x58b8f9,prod_code:_0x452825,level:_0x36482b,isle:_0x584541,pallet:_0x4e25b5,expiry_date:_0x100915}=_0xbba29d[_0x4ae213(0x93)];if(typeof _0x441d5c==_0x4ae213(0x96))var _0x4d18e5=[_0xbba29d[_0x4ae213(0x93)][_0x4ae213(0x144)]],_0x1020ab=[_0xbba29d[_0x4ae213(0x93)]['stock']],_0x2280d5=[_0xbba29d[_0x4ae213(0x93)][_0x4ae213(0x120)]],_0x172cd9=[_0xbba29d['body']['primary_code']],_0x139cd2=[_0xbba29d[_0x4ae213(0x93)]['secondary_code']],_0xd490f3=[_0xbba29d[_0x4ae213(0x93)]['prod_code']],_0x1df358=[_0xbba29d[_0x4ae213(0x93)]['level']],_0x415d7c=[_0xbba29d['body'][_0x4ae213(0xc9)]];else var _0x4d18e5=[..._0xbba29d[_0x4ae213(0x93)][_0x4ae213(0x144)]],_0x1020ab=[..._0xbba29d['body'][_0x4ae213(0x14c)]],_0x2280d5=[..._0xbba29d[_0x4ae213(0x93)][_0x4ae213(0x120)]],_0x172cd9=[..._0xbba29d[_0x4ae213(0x93)][_0x4ae213(0xf1)]],_0x139cd2=[..._0xbba29d[_0x4ae213(0x93)][_0x4ae213(0xe4)]],_0xd490f3=[..._0xbba29d[_0x4ae213(0x93)][_0x4ae213(0xb3)]],_0x1df358=[..._0xbba29d[_0x4ae213(0x93)]['level']],_0x415d7c=[..._0xbba29d['body'][_0x4ae213(0xc9)]];const _0x53e8e1=_0x4d18e5['map'](_0x32ef4c=>{return _0x32ef4c={'product_name':_0x32ef4c};});_0x1020ab[_0x4ae213(0xfb)]((_0x289611,_0x3fa26f)=>{var _0x269f84=_0x4ae213;_0x53e8e1[_0x3fa26f][_0x269f84(0x14c)]=_0x289611;}),_0x2280d5[_0x4ae213(0xfb)]((_0x432338,_0x54e6ee)=>{_0x53e8e1[_0x54e6ee]['quantity']=_0x432338;}),_0x172cd9['forEach']((_0xdf0d1b,_0x26bcc0)=>{var _0x51cbc4=_0x4ae213;_0x53e8e1[_0x26bcc0][_0x51cbc4(0xf1)]=_0xdf0d1b;}),_0x139cd2[_0x4ae213(0xfb)]((_0x7bdfd4,_0x95e8d3)=>{var _0x419a0c=_0x4ae213;_0x53e8e1[_0x95e8d3][_0x419a0c(0xe4)]=_0x7bdfd4;}),_0xd490f3[_0x4ae213(0xfb)]((_0x46938c,_0x1a64a0)=>{var _0x33d6b3=_0x4ae213;_0x53e8e1[_0x1a64a0][_0x33d6b3(0xb8)]=_0x46938c;}),_0x1df358[_0x4ae213(0xfb)]((_0x50aad6,_0x3ce5f3)=>{var _0x40483e=_0x4ae213;_0x53e8e1[_0x3ce5f3][_0x40483e(0x9b)]=_0x50aad6;}),_0x415d7c[_0x4ae213(0xfb)]((_0xcf3c46,_0x31aa43)=>{var _0x41eb45=_0x4ae213;_0x53e8e1[_0x31aa43][_0x41eb45(0xc9)]=_0xcf3c46;});var _0x3f3e1c=0x0;_0x53e8e1[_0x4ae213(0xfb)](_0x23988a=>{var _0x4753c8=_0x4ae213;console[_0x4753c8(0x182)](_0x4753c8(0xcb),_0x23988a),(parseInt(_0x23988a[_0x4753c8(0x14c)])<parseInt(_0x23988a[_0x4753c8(0xe7)])||parseInt(_0x23988a[_0x4753c8(0xe7)])==0x0)&&_0x3f3e1c++;});if(_0x3f3e1c!=0x0)return _0xbba29d[_0x4ae213(0x6f)](_0x4ae213(0x7d),_0x4ae213(0x118)),_0x49b8f1[_0x4ae213(0x160)](_0x4ae213(0xb1));_0x138e8a[_0x4ae213(0x14d)][_0x4ae213(0xfb)](_0x42d522=>{var _0x3f90de=_0x4ae213;const _0xe0d605=_0x39a44d['product_details'][_0x3f90de(0xc6)](_0x5b9e10=>{var _0x4519bb=_0x3f90de;_0x5b9e10['product_name']==_0x42d522[_0x4519bb(0x144)]&&_0x5b9e10[_0x4519bb(0xcf)]==_0x42d522['bay']&&(_0x5b9e10[_0x4519bb(0xe9)]=parseInt(_0x5b9e10[_0x4519bb(0xe9)])+parseInt(_0x42d522[_0x4519bb(0xe7)]));});}),await _0x39a44d[_0x4ae213(0x95)]();const _0x34a942=_0x53e8e1[_0x4ae213(0x102)](_0x2661b1=>_0x2661b1[_0x4ae213(0xe7)]!=='0'&&_0x2661b1['quantity']!=='');_0x138e8a[_0x4ae213(0x8a)]=_0x3dfadd,_0x138e8a[_0x4ae213(0x156)]=_0x591e0a,_0x138e8a['date']=_0x541222,_0x138e8a['warehouse_name']=_0x423b0c,_0x138e8a[_0x4ae213(0x14d)]=_0x34a942,_0x138e8a[_0x4ae213(0x79)]=_0x52e13d,_0x138e8a[_0x4ae213(0x143)]=_0x1a6492;const _0x3f3afd=await _0x138e8a[_0x4ae213(0x95)](),_0x5a3ac6=await sales_finished[_0x4ae213(0xaf)]({'_id':_0xbba29d[_0x4ae213(0xc4)]['id']}),_0x5efd26=await warehouse[_0x4ae213(0xaf)]({'name':_0x423b0c,'room':_0x1a6492,'warehouse_category':_0x4ae213(0xbd)});_0x5a3ac6[_0x4ae213(0x14d)][_0x4ae213(0xfb)](_0x30c955=>{var _0x4082ae=_0x4ae213;const _0x2c8b22=_0x5efd26['product_details'][_0x4082ae(0xc6)](_0x5e7876=>{var _0x19f63e=_0x4082ae;_0x5e7876[_0x19f63e(0x144)]==_0x30c955[_0x19f63e(0x144)]&&_0x5e7876[_0x19f63e(0xcf)]==_0x30c955['bay']&&(_0x5e7876['product_stock']=parseInt(_0x5e7876[_0x19f63e(0xe9)])-parseInt(_0x30c955[_0x19f63e(0xe7)]));});}),console[_0x4ae213(0x182)](_0x4ae213(0x11d),_0x5efd26),await _0x5efd26[_0x4ae213(0x95)]();const _0x457761=await c_payment_data[_0x4ae213(0xaf)]({'invoice':_0xbba29d['body'][_0x4ae213(0x8a)]});_0x457761[_0x4ae213(0xe1)]=_0xbba29d[_0x4ae213(0x93)][_0x4ae213(0xe1)],await _0x457761[_0x4ae213(0x95)](),_0xbba29d[_0x4ae213(0x6f)](_0x4ae213(0x17f),_0x4ae213(0xdf)),_0x49b8f1[_0x4ae213(0x160)](_0x4ae213(0x146));}catch(_0xca9a2f){console[_0x4ae213(0x182)](_0xca9a2f);}}),router['post'](a0_0x27c054(0x100),auth,async(_0xd4fd55,_0x55748c)=>{var _0x2cd915=a0_0x27c054;try{const _0x58cdc4=_0xd4fd55['params']['id'],{invoice:_0x5bff6a,customer:_0x12a68f,receivable_amount:_0x46809a,received_amount:_0x40fc21}=_0xd4fd55['body'],_0x598940=await sales['findById'](_0x58cdc4);console[_0x2cd915(0x182)](_0x598940);var _0x165194=_0x46809a-_0x40fc21;console['log'](_0x40fc21),_0x598940[_0x2cd915(0xf7)]=parseFloat(_0x40fc21)+parseFloat(_0x598940[_0x2cd915(0xf7)]),_0x598940['due_amount']=_0x165194,console[_0x2cd915(0x182)](_0x598940);const _0x1d358d=await _0x598940[_0x2cd915(0x95)](),_0x14adf6=await c_payment_data[_0x2cd915(0xaf)]({'invoice':_0x5bff6a});_0x14adf6['amount']=_0x165194,await _0x14adf6[_0x2cd915(0x95)]();let _0x22f233=new Date(),_0x599984=('0'+_0x22f233['getDate']())[_0x2cd915(0x16f)](-0x2),_0x398a4e=('0'+(_0x22f233[_0x2cd915(0x11f)]()+0x1))[_0x2cd915(0x16f)](-0x2),_0x2dcb8b=_0x22f233[_0x2cd915(0x82)](),_0x218392=_0x2dcb8b+'-'+_0x398a4e+'-'+_0x599984;const _0x2f2e6a=new customer_payment({'invoice':_0x5bff6a,'date':_0x2dcb8b+'-'+_0x398a4e+'-'+_0x599984,'customer':_0x12a68f,'reason':_0x2cd915(0x16e),'amount':_0x40fc21}),_0x1dfc3a=await _0x2f2e6a['save']();_0xd4fd55[_0x2cd915(0x6f)](_0x2cd915(0x17f),_0x2cd915(0xa0)),_0x55748c[_0x2cd915(0x160)](_0x2cd915(0x106));}catch(_0x3658e7){console[_0x2cd915(0x182)](_0x3658e7);}}),router[a0_0x27c054(0x181)]('/invoice/:id',auth,async(_0x313a62,_0x1beb26)=>{var _0x5f8feb=a0_0x27c054;try{const {username:_0x4c3a19,email:_0x69957f,role:_0x43368f}=_0x313a62[_0x5f8feb(0x179)],_0x3df349=_0x313a62[_0x5f8feb(0x179)],_0x3aedd0=await profile[_0x5f8feb(0xaf)]({'email':_0x3df349[_0x5f8feb(0x13b)]}),_0x270258=await master_shop[_0x5f8feb(0x158)]();console[_0x5f8feb(0x182)](_0x5f8feb(0x7e),_0x270258);const _0x2c8f29=_0x313a62[_0x5f8feb(0xc4)]['id'],_0x148f48=await sales[_0x5f8feb(0x17d)](_0x2c8f29);console['log'](_0x148f48);const _0x26a5b8=await customer['findOne']({'name':_0x148f48['customer']});console[_0x5f8feb(0x182)](_0x26a5b8);if(_0x270258[0x0][_0x5f8feb(0x121)]==_0x5f8feb(0x142)){var _0x37b113=users['English'];console['log'](_0x37b113);}else{if(_0x270258[0x0][_0x5f8feb(0x121)]==_0x5f8feb(0x17c))var _0x37b113=users['Hindi'];else{if(_0x270258[0x0][_0x5f8feb(0x121)]==_0x5f8feb(0xb2))var _0x37b113=users['German'];else{if(_0x270258[0x0][_0x5f8feb(0x121)]==_0x5f8feb(0x131))var _0x37b113=users[_0x5f8feb(0x131)];else{if(_0x270258[0x0]['language']==_0x5f8feb(0x145))var _0x37b113=users[_0x5f8feb(0x145)];else{if(_0x270258[0x0][_0x5f8feb(0x121)]=='Portuguese\x20(BR)')var _0x37b113=users[_0x5f8feb(0x165)];else{if(_0x270258[0x0]['language']==_0x5f8feb(0xbf))var _0x37b113=users[_0x5f8feb(0xbf)];else{if(_0x270258[0x0]['language']==_0x5f8feb(0xff))var _0x37b113=users[_0x5f8feb(0xde)];}}}}}}}_0x1beb26['render']('sales_invoice',{'success':_0x313a62[_0x5f8feb(0x6f)](_0x5f8feb(0x17f)),'errors':_0x313a62[_0x5f8feb(0x6f)](_0x5f8feb(0x7d)),'role':_0x3df349,'profile':_0x3aedd0,'master_shop':_0x270258,'customers':_0x26a5b8,'sales':_0x148f48,'language':_0x37b113});}catch(_0x2feb7d){console['log'](_0x2feb7d);}}),router[a0_0x27c054(0x181)](a0_0x27c054(0x11b),auth,async(_0x39259a,_0x3515e9)=>{var _0x44b622=a0_0x27c054;try{const {username:_0x11be4a,email:_0x27e60e,role:_0xb75102}=_0x39259a[_0x44b622(0x179)],_0x417b05=_0x39259a[_0x44b622(0x179)],_0x27f521=await profile[_0x44b622(0xaf)]({'email':_0x417b05['email']}),_0x370a36=await master_shop[_0x44b622(0x158)](),_0x2b2764=_0x39259a['params']['id'],_0x2027b9=await sales_finished[_0x44b622(0x17d)](_0x2b2764),_0x2a0b4f=await warehouse['aggregate']([{'$match':{'name':_0x2027b9[_0x44b622(0x10b)]}},{'$unwind':_0x44b622(0x169)},{'$group':{'_id':_0x44b622(0x99),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x44b622(0x11c)},'bay':{'$first':_0x44b622(0x70)},'bin':{'$first':_0x44b622(0x117)},'type':{'$first':_0x44b622(0x16b)},'floorlevel':{'$first':_0x44b622(0xda)},'primary_code':{'$first':_0x44b622(0x80)},'secondary_code':{'$first':_0x44b622(0x76)},'product_code':{'$first':_0x44b622(0x184)},'storage':{'$first':_0x44b622(0xa2)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x44b622(0x101)},'unit':{'$first':_0x44b622(0x81)},'secondary_unit':{'$first':_0x44b622(0x9d)},'maxProducts':{'$first':_0x44b622(0xcc)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x44b622(0xad)}}}]),_0x5c7195=await product['find']({}),_0x238a60=await warehouse[_0x44b622(0x15a)]([{'$match':{'status':_0x44b622(0xca),'warehouse_category':_0x44b622(0xbd),'name':{'$ne':_0x44b622(0xc8),'$ne':_0x44b622(0x152)}}},{'$group':{'_id':'$name','name':{'$first':_0x44b622(0xdd)}}},{'$sort':{'name':0x1}}]);var _0x829df6=[_0x44b622(0xa3)];const _0x2d3462=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x44b622(0x152)}},{'$group':{'_id':_0x44b622(0xdd),'name':{'$first':_0x44b622(0xdd)}}},{'$sort':{'name':0x1}}]);if(_0x370a36[0x0][_0x44b622(0x121)]==_0x44b622(0x142)){var _0x1315da=users[_0x44b622(0x8b)];console[_0x44b622(0x182)](_0x1315da);}else{if(_0x370a36[0x0][_0x44b622(0x121)]==_0x44b622(0x17c))var _0x1315da=users[_0x44b622(0x17c)];else{if(_0x370a36[0x0][_0x44b622(0x121)]=='German')var _0x1315da=users[_0x44b622(0xb2)];else{if(_0x370a36[0x0][_0x44b622(0x121)]==_0x44b622(0x131))var _0x1315da=users[_0x44b622(0x131)];else{if(_0x370a36[0x0][_0x44b622(0x121)]==_0x44b622(0x145))var _0x1315da=users[_0x44b622(0x145)];else{if(_0x370a36[0x0][_0x44b622(0x121)]=='Portuguese\x20(BR)')var _0x1315da=users[_0x44b622(0x165)];else{if(_0x370a36[0x0][_0x44b622(0x121)]==_0x44b622(0xbf))var _0x1315da=users[_0x44b622(0xbf)];else{if(_0x370a36[0x0][_0x44b622(0x121)]==_0x44b622(0xff))var _0x1315da=users['Arabic'];}}}}}}}_0x3515e9[_0x44b622(0x168)](_0x44b622(0xb7),{'success':_0x39259a['flash'](_0x44b622(0x17f)),'errors':_0x39259a['flash'](_0x44b622(0x7d)),'role':_0x417b05,'profile':_0x27f521,'user':_0x2027b9,'stock':_0x2a0b4f,'master_shop':_0x370a36,'unit':_0x5c7195,'language':_0x1315da,'warehouses':_0x238a60,'rooms':_0x829df6,'warehouse_QA':_0x2d3462});}catch(_0x2a7272){console[_0x44b622(0x182)](_0x2a7272),_0x3515e9[_0x44b622(0x9a)](0xc8)[_0x44b622(0x135)]({'message':_0x2a7272['message']});}}),router['post'](a0_0x27c054(0x11b),auth,async(_0x323781,_0xe96b24)=>{var _0x3af8ef=a0_0x27c054;if(_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x13f)]=='QA')try{const {invoice:_0x42a8c9,date:_0x4c9ee0,warehouse_name:_0xe27f2b,product_name:_0x944dba,primary_code:_0x598610,secondary_code:_0x5cfdd3,product_code:_0x4ef399,sales_quantity:_0x47feb1,stocks:_0x477f56,return_qty:_0x1b929e,Room_name:_0x155863,to_warehouse_name_QA:_0x1faa5c,to_Room_name_QA:_0x1d5841,note:_0x1a2ac5,for_categorize:_0x398866,product_name_QA1:_0x426c3f}=_0x323781[_0x3af8ef(0x93)];if(typeof _0x426c3f==_0x3af8ef(0x96))var _0x4136e2=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x17e)]],_0x58a6ac=[_0x323781[_0x3af8ef(0x93)]['primary_code_QA']],_0x3e2549=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xfc)]],_0x5a47c3=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xb9)]],_0x1e8ca=[_0x323781[_0x3af8ef(0x93)]['sales_quantity_QA']],_0xb19665=[_0x323781['body'][_0x3af8ef(0x17a)]],_0x15c173=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xa5)]],_0x4a99f9=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x10a)]],_0x3afd26=[_0x323781['body'][_0x3af8ef(0x12a)]],_0x3fc34f=[_0x323781['body'][_0x3af8ef(0x8c)]],_0x1ba7da=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x173)]],_0x1046bb=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xf9)]],_0x11c24e=[_0x323781[_0x3af8ef(0x93)]['production_date_QA']],_0x4ef526=[_0x323781['body'][_0x3af8ef(0x11e)]];else var _0x4136e2=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x17e)]],_0x58a6ac=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x138)]],_0x3e2549=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xfc)]],_0x5a47c3=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xb9)]],_0x1e8ca=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x136)]],_0xb19665=[..._0x323781[_0x3af8ef(0x93)]['stocks_QA']],_0x15c173=[..._0x323781['body'][_0x3af8ef(0xa5)]],_0x4a99f9=[..._0x323781[_0x3af8ef(0x93)]['maxPerUnit_QA']],_0x3afd26=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x12a)]],_0x3fc34f=[..._0x323781['body']['batch_code_QA']],_0x1ba7da=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x173)]],_0x1046bb=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xf9)]],_0x11c24e=[..._0x323781[_0x3af8ef(0x93)]['production_date_QA']],_0x4ef526=[..._0x323781['body'][_0x3af8ef(0x11e)]];const _0xd8acba=_0x4136e2['map'](_0x297d10=>{return _0x297d10={'product_name':_0x297d10};});_0x58a6ac[_0x3af8ef(0xfb)]((_0x572251,_0x314519)=>{_0xd8acba[_0x314519]['primary_code']=_0x572251;}),_0x3e2549[_0x3af8ef(0xfb)]((_0x184594,_0x469b14)=>{var _0x39c06c=_0x3af8ef;_0xd8acba[_0x469b14][_0x39c06c(0xe4)]=_0x184594;}),_0x5a47c3[_0x3af8ef(0xfb)]((_0x1439ac,_0x2b82c2)=>{var _0x3eef31=_0x3af8ef;_0xd8acba[_0x2b82c2][_0x3eef31(0xb8)]=_0x1439ac;}),_0x1e8ca[_0x3af8ef(0xfb)]((_0x1b2d77,_0xd7b663)=>{var _0x4f63fb=_0x3af8ef;_0xd8acba[_0xd7b663][_0x4f63fb(0xe6)]=_0x1b2d77;}),_0xb19665[_0x3af8ef(0xfb)]((_0xa04ed0,_0x37c7a7)=>{var _0x257783=_0x3af8ef;_0xd8acba[_0x37c7a7][_0x257783(0x14c)]=_0xa04ed0;}),_0x15c173[_0x3af8ef(0xfb)]((_0x5f5b6b,_0x3e3ff9)=>{var _0x5f49f8=_0x3af8ef;_0xd8acba[_0x3e3ff9][_0x5f49f8(0x10d)]=_0x5f5b6b;}),_0x4a99f9[_0x3af8ef(0xfb)]((_0x984100,_0x5d7249)=>{var _0x1231ad=_0x3af8ef;_0xd8acba[_0x5d7249][_0x1231ad(0x12d)]=_0x984100;}),_0x3afd26[_0x3af8ef(0xfb)]((_0x47ef0d,_0x51f0eb)=>{_0xd8acba[_0x51f0eb]['maxProducts']=_0x47ef0d;}),_0x3fc34f[_0x3af8ef(0xfb)]((_0x22271e,_0x2d5f16)=>{var _0x5354c7=_0x3af8ef;_0xd8acba[_0x2d5f16][_0x5354c7(0x150)]=_0x22271e;}),_0x1ba7da['forEach']((_0x4acd67,_0x1c2357)=>{var _0x528bbd=_0x3af8ef;_0xd8acba[_0x1c2357][_0x528bbd(0xa4)]=_0x4acd67;}),_0x1046bb['forEach']((_0x1ad371,_0x5ecff4)=>{var _0x553b23=_0x3af8ef;_0xd8acba[_0x5ecff4][_0x553b23(0x149)]=_0x1ad371;}),_0x11c24e['forEach']((_0x355bb1,_0x405e5b)=>{var _0x181d02=_0x3af8ef;_0xd8acba[_0x405e5b][_0x181d02(0x12f)]=_0x355bb1;}),_0x4ef526[_0x3af8ef(0xfb)]((_0x46fcdd,_0x30586a)=>{var _0x1d6ab2=_0x3af8ef;_0xd8acba[_0x30586a][_0x1d6ab2(0xc9)]=_0x46fcdd;});const _0x1cf15d=await sales_finished['findOne']({'invoice':_0x42a8c9});_0x1cf15d[_0x3af8ef(0x13e)]='True';const _0x4e331c=await _0x1cf15d[_0x3af8ef(0x95)](),_0x417388=new sales_return_finished({'invoice':_0x42a8c9,'customer':_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x156)],'date':_0x4c9ee0,'warehouse_name':_0xe27f2b,'room':_0x155863,'ToWarehouse':_0x1faa5c,'ToRoom':_0x1d5841,'return_sale_QA':_0xd8acba,'note':_0x1a2ac5,'warehouse_cat':_0x398866}),_0x316a50=await _0x417388[_0x3af8ef(0x95)](),_0x5ca3dd=await sales_return_finished[_0x3af8ef(0xaf)]({'invoice':_0x42a8c9}),_0x11929f=await warehouse[_0x3af8ef(0xaf)]({'name':_0x1faa5c,'room':_0x1d5841});_0x5ca3dd[_0x3af8ef(0xf4)][_0x3af8ef(0xfb)](_0x2c451e=>{var _0x2ad6af=_0x3af8ef,_0x420741=0x0;const _0x4948fd=_0x11929f[_0x2ad6af(0x74)][_0x2ad6af(0xc6)](_0x1c857c=>{var _0x23a553=_0x2ad6af;_0x1c857c[_0x23a553(0x144)]==_0x2c451e[_0x23a553(0x144)]&&_0x1c857c[_0x23a553(0xc9)]==_0x2c451e[_0x23a553(0xc9)]&&_0x1c857c['production_date']==_0x2c451e['production_date']&&_0x1c857c[_0x23a553(0x150)]==_0x2c451e[_0x23a553(0x150)]&&(_0x1c857c[_0x23a553(0xe9)]=parseInt(_0x1c857c[_0x23a553(0xe9)])+parseInt(_0x2c451e[_0x23a553(0x10d)]),_0x420741++);});_0x420741=='0'&&(_0x11929f[_0x2ad6af(0x74)]=_0x11929f[_0x2ad6af(0x74)][_0x2ad6af(0x127)]({'product_name':_0x2c451e[_0x2ad6af(0x144)],'product_stock':_0x2c451e[_0x2ad6af(0x10d)],'primary_code':_0x2c451e['primary_code'],'secondary_code':_0x2c451e['secondary_code'],'product_code':_0x2c451e['product_code'],'batch_code':_0x2c451e[_0x2ad6af(0x150)],'maxPerUnit':_0x2c451e['maxPerUnit'],'production_date':_0x2c451e[_0x2ad6af(0x12f)],'expiry_date':_0x2c451e['expiry_date'],'secondary_unit':_0x2c451e['secondary_unit'],'unit':_0x2c451e[_0x2ad6af(0x149)],'maxProducts':_0x2c451e['maxProducts'],'bay':_0x2c451e[_0x2ad6af(0xcf)]}));}),await _0x11929f[_0x3af8ef(0x95)]();const _0x5c5c5f=new c_payment_data({'invoice':_0x42a8c9,'customer':_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x156)],'reason':_0x3af8ef(0x14b)});await _0x5c5c5f[_0x3af8ef(0x95)]();const _0x5cbabe=await master_shop[_0x3af8ef(0x158)](),_0x59d7b8=await email_settings[_0x3af8ef(0xaf)](),_0x431be1=await customer[_0x3af8ef(0xaf)]({'name':_0x323781['body']['customer']});_0x5cbabe[0x0][_0x3af8ef(0xf3)]==0x1?(right_currency=_0x5cbabe[0x0][_0x3af8ef(0x167)],left_currency=''):(right_currency='',left_currency=_0x5cbabe[0x0][_0x3af8ef(0x167)]);var _0x5dc050=_0x4136e2,_0x542472=_0x15c173,_0x57b16a='',_0x39c8ff;for(_0x39c8ff in _0x5dc050){_0x57b16a+=_0x3af8ef(0x15c)+_0x3af8ef(0x183)+_0x5dc050[_0x39c8ff]+_0x3af8ef(0x180)+_0x3af8ef(0x183)+_0x542472[_0x39c8ff]+'</td>'+_0x3af8ef(0x163);}console['log'](_0x3af8ef(0x13a),_0x57b16a);let _0xf70e26=nodemailer[_0x3af8ef(0x72)]({'service':_0x3af8ef(0x176),'auth':{'user':_0x59d7b8['email'],'pass':_0x59d7b8['password']}}),_0x5ae151={'from':_0x59d7b8[_0x3af8ef(0x13b)],'to':_0x431be1[_0x3af8ef(0x13b)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x3af8ef(0xae),'path':__dirname+_0x3af8ef(0x164)+_0x3af8ef(0x170)+_0x5cbabe[0x0][_0x3af8ef(0x8e)],'cid':_0x3af8ef(0xfa)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x3af8ef(0x174)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3af8ef(0xe0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3af8ef(0xdb)+'<div>'+_0x3af8ef(0x85)+_0x5cbabe[0x0][_0x3af8ef(0x112)]+_0x3af8ef(0x111)+_0x3af8ef(0xdb)+_0x3af8ef(0xdb)+'<hr\x20class=\x22my-3\x22>'+_0x3af8ef(0xe0)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x3af8ef(0x9e)+_0x42a8c9+'\x20'+_0x3af8ef(0xa9)+_0x3af8ef(0xc5)+_0x4c9ee0+'\x20'+'</span>'+'</h5>'+'</div>'+_0x3af8ef(0x113)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3af8ef(0x15c)+_0x3af8ef(0x13d)+_0x3af8ef(0x78)+_0x3af8ef(0xb6)+_0x3af8ef(0x92)+_0x3af8ef(0x163)+_0x3af8ef(0xc7)+_0x3af8ef(0xb4)+'\x20'+_0x57b16a+'\x20'+_0x3af8ef(0xeb)+_0x3af8ef(0x8d)+_0x3af8ef(0xe0)+'<strong>\x20Regards\x20</strong>'+_0x3af8ef(0xe5)+_0x5cbabe[0x0][_0x3af8ef(0x112)]+'</h5>'+_0x3af8ef(0xdb)+_0x3af8ef(0xdb)+_0x3af8ef(0x7f)};_0xf70e26[_0x3af8ef(0xc0)](_0x5ae151,function(_0x4e8673,_0x40c454){var _0x22ab6b=_0x3af8ef;_0x4e8673?(console[_0x22ab6b(0x182)](_0x4e8673),console[_0x22ab6b(0x182)]('Error\x20Occurs')):console[_0x22ab6b(0x182)](_0x22ab6b(0x103));}),_0x323781['flash'](_0x3af8ef(0x17f),'sales\x20item\x20return\x20successfull'),_0xe96b24['redirect'](_0x3af8ef(0x146));}catch(_0xadd2e5){_0xe96b24[_0x3af8ef(0x9a)](0xc8)[_0x3af8ef(0x135)]({'message1':_0xadd2e5[_0x3af8ef(0xbe)]});}else{if(_0x323781[_0x3af8ef(0x93)]['for_categorize']=='GS')try{const {invoice:_0xe0fb1a,date:_0x186c5d,warehouse_name:_0x552e2e,product_name:_0x23de27,primary_code:_0x2837ae,secondary_code:_0x69c2d2,product_code:_0x2aec21,sales_quantity:_0x5acb9b,stocks:_0x57a203,return_qty:_0x149b5e,Room_name:_0x3c683c,to_warehouse_name:_0x4f8472,to_Room_name:_0x49032b,note:_0x253c02,level:_0x5eb5e2,isle:_0x541841,pallet:_0xaa6bab,for_categorize:_0x4e3485}=_0x323781['body'];if(typeof _0x23de27==_0x3af8ef(0x96))var _0x4136e2=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x144)]],_0x58a6ac=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xf1)]],_0x3e2549=[_0x323781[_0x3af8ef(0x93)]['secondary_code']],_0x5a47c3=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xb8)]],_0x1e8ca=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xd2)]],_0x15c173=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x10d)]],_0x5c68de=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xcf)]],_0x4a99f9=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x12d)]],_0x3afd26=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x107)]],_0x3fc34f=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x150)]],_0x1ba7da=[_0x323781[_0x3af8ef(0x93)]['secondary_unit']],_0x1046bb=[_0x323781[_0x3af8ef(0x93)]['unit']],_0x11c24e=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x12f)]],_0x4ef526=[_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xc9)]];else var _0x4136e2=[..._0x323781['body'][_0x3af8ef(0x144)]],_0x58a6ac=[..._0x323781['body']['primary_code']],_0x3e2549=[..._0x323781['body']['secondary_code']],_0x5a47c3=[..._0x323781['body'][_0x3af8ef(0xb8)]],_0x1e8ca=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xd2)]],_0x15c173=[..._0x323781['body'][_0x3af8ef(0x10d)]],_0x5c68de=[..._0x323781['body'][_0x3af8ef(0xcf)]],_0x4a99f9=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x12d)]],_0x3afd26=[..._0x323781[_0x3af8ef(0x93)]['maxProducts']],_0x3fc34f=[..._0x323781[_0x3af8ef(0x93)]['batch_code']],_0x1ba7da=[..._0x323781['body'][_0x3af8ef(0xa4)]],_0x1046bb=[..._0x323781['body'][_0x3af8ef(0x149)]],_0x11c24e=[..._0x323781['body']['production_date']],_0x4ef526=[..._0x323781[_0x3af8ef(0x93)][_0x3af8ef(0xc9)]];const _0x123642=_0x4136e2[_0x3af8ef(0xc6)](_0x48188c=>{return _0x48188c={'product_name':_0x48188c};});_0x58a6ac['forEach']((_0x44a9f0,_0x4ea7f3)=>{var _0xf67b8d=_0x3af8ef;_0x123642[_0x4ea7f3][_0xf67b8d(0xf1)]=_0x44a9f0;}),_0x3e2549['forEach']((_0x405d81,_0x2ca83b)=>{var _0x2e3826=_0x3af8ef;_0x123642[_0x2ca83b][_0x2e3826(0xe4)]=_0x405d81;}),_0x5a47c3[_0x3af8ef(0xfb)]((_0x2b5450,_0x5cc951)=>{var _0x25deaa=_0x3af8ef;_0x123642[_0x5cc951][_0x25deaa(0xb8)]=_0x2b5450;}),_0x1e8ca[_0x3af8ef(0xfb)]((_0x24cfd4,_0x2242c1)=>{var _0x2be367=_0x3af8ef;_0x123642[_0x2242c1][_0x2be367(0xe6)]=_0x24cfd4;}),_0x15c173[_0x3af8ef(0xfb)]((_0x577293,_0x5f03be)=>{_0x123642[_0x5f03be]['return_qty']=_0x577293;}),_0x5c68de[_0x3af8ef(0xfb)]((_0x5b9744,_0x4b22b0)=>{var _0x5f5ad5=_0x3af8ef;_0x123642[_0x4b22b0][_0x5f5ad5(0xcf)]=_0x5b9744;}),_0x4a99f9[_0x3af8ef(0xfb)]((_0x3a93dc,_0x24fbb6)=>{var _0x4fc9e7=_0x3af8ef;_0x123642[_0x24fbb6][_0x4fc9e7(0x12d)]=_0x3a93dc;}),_0x3afd26[_0x3af8ef(0xfb)]((_0x5777fc,_0x410a1c)=>{var _0x12a5af=_0x3af8ef;_0x123642[_0x410a1c][_0x12a5af(0x107)]=_0x5777fc;}),_0x3fc34f['forEach']((_0x4d39b0,_0x109f3e)=>{var _0x117b83=_0x3af8ef;_0x123642[_0x109f3e][_0x117b83(0x150)]=_0x4d39b0;}),_0x1ba7da[_0x3af8ef(0xfb)]((_0x16b691,_0x32f6ec)=>{var _0x51b0c6=_0x3af8ef;_0x123642[_0x32f6ec][_0x51b0c6(0xa4)]=_0x16b691;}),_0x1046bb[_0x3af8ef(0xfb)]((_0x4d0fe9,_0x257687)=>{var _0x14539e=_0x3af8ef;_0x123642[_0x257687][_0x14539e(0x149)]=_0x4d0fe9;}),_0x11c24e[_0x3af8ef(0xfb)]((_0x4d1cb5,_0x32aedd)=>{var _0x63260c=_0x3af8ef;_0x123642[_0x32aedd][_0x63260c(0x12f)]=_0x4d1cb5;}),_0x4ef526['forEach']((_0x30ea0e,_0x1f8103)=>{var _0x1a4515=_0x3af8ef;_0x123642[_0x1f8103][_0x1a4515(0xc9)]=_0x30ea0e;});var _0x281cc7=0x0;_0x123642['forEach'](_0x5d8931=>{var _0x4a957c=_0x3af8ef;(parseInt(_0x5d8931[_0x4a957c(0xe6)])<parseInt(_0x5d8931[_0x4a957c(0x10d)])||parseInt(_0x5d8931[_0x4a957c(0x14c)])<parseInt(_0x5d8931['return_qty'])&&parseInt(_0x5d8931['sale_qty'])>parseInt(_0x5d8931[_0x4a957c(0x10d)])||parseInt(_0x5d8931[_0x4a957c(0x10d)])==0x0)&&_0x281cc7++;});if(_0x281cc7!=0x0)return _0x323781[_0x3af8ef(0x6f)]('errors',_0x3af8ef(0x125)),_0xe96b24[_0x3af8ef(0x160)](_0x3af8ef(0xb1));const _0x51732b=await sales_finished[_0x3af8ef(0xaf)]({'invoice':_0xe0fb1a});_0x51732b[_0x3af8ef(0x13e)]=_0x3af8ef(0x10f);const _0xab1eb4=await _0x51732b[_0x3af8ef(0x95)](),_0x1961cb=new sales_return_finished({'invoice':_0xe0fb1a,'customer':_0x323781['body'][_0x3af8ef(0x156)],'date':_0x186c5d,'warehouse_name':_0x552e2e,'room':_0x3c683c,'ToWarehouse':_0x4f8472,'ToRoom':_0x49032b,'return_sale':_0x123642,'note':_0x253c02,'warehouse_cat':_0x4e3485}),_0x501f4a=await _0x1961cb['save'](),_0x1119ef=await sales_return_finished[_0x3af8ef(0xaf)]({'invoice':_0xe0fb1a}),_0x1ab58f=await warehouse[_0x3af8ef(0xaf)]({'name':_0x4f8472,'room':_0x49032b,'warehouse_category':_0x3af8ef(0xbd)});_0x1119ef[_0x3af8ef(0xb0)][_0x3af8ef(0xfb)](_0x15bcb0=>{var _0x1dfebb=_0x3af8ef,_0x4b1e71=0x0;const _0x3bd922=_0x1ab58f['product_details'][_0x1dfebb(0xc6)](_0x2a24d5=>{var _0x57274d=_0x1dfebb;_0x2a24d5['product_name']==_0x15bcb0[_0x57274d(0x144)]&&_0x2a24d5['bay']==_0x15bcb0['bay']&&_0x2a24d5['expiry_date']==_0x15bcb0[_0x57274d(0xc9)]&&_0x2a24d5[_0x57274d(0x12f)]==_0x15bcb0[_0x57274d(0x12f)]&&_0x2a24d5[_0x57274d(0x150)]==_0x15bcb0['batch_code']&&(_0x2a24d5[_0x57274d(0xe9)]=parseInt(_0x2a24d5[_0x57274d(0xe9)])+parseInt(_0x15bcb0['return_qty']),_0x4b1e71++);});_0x4b1e71=='0'&&(_0x1ab58f[_0x1dfebb(0x74)]=_0x1ab58f[_0x1dfebb(0x74)][_0x1dfebb(0x127)]({'product_name':_0x15bcb0[_0x1dfebb(0x144)],'product_stock':_0x15bcb0[_0x1dfebb(0x10d)],'primary_code':_0x15bcb0['primary_code'],'secondary_code':_0x15bcb0[_0x1dfebb(0xe4)],'product_code':_0x15bcb0[_0x1dfebb(0xb8)],'bay':_0x15bcb0[_0x1dfebb(0xcf)],'batch_code':_0x15bcb0[_0x1dfebb(0x150)],'maxPerUnit':_0x15bcb0[_0x1dfebb(0x12d)],'production_date':_0x15bcb0[_0x1dfebb(0x12f)],'expiry_date':_0x15bcb0[_0x1dfebb(0xc9)],'secondary_unit':_0x15bcb0['secondary_unit'],'unit':_0x15bcb0[_0x1dfebb(0x149)],'maxProducts':_0x15bcb0['maxProducts']}));}),await _0x1ab58f[_0x3af8ef(0x95)](),console[_0x3af8ef(0x182)](_0x323781['body']);const _0x1903e0=new c_payment_data({'invoice':_0xe0fb1a,'customer':_0x323781[_0x3af8ef(0x93)][_0x3af8ef(0x156)],'reason':'Sale\x20Return'});await _0x1903e0[_0x3af8ef(0x95)]();const _0x27269e=await master_shop[_0x3af8ef(0x158)]();console[_0x3af8ef(0x182)](_0x3af8ef(0x15e),_0x27269e[0x0][_0x3af8ef(0x8e)]);const _0x25ab97=await email_settings[_0x3af8ef(0xaf)](),_0x54a0ee=await customer['findOne']({'name':_0x323781['body'][_0x3af8ef(0x156)]});console[_0x3af8ef(0x182)](_0x3af8ef(0x7b),_0x54a0ee);_0x27269e[0x0][_0x3af8ef(0xf3)]==0x1?(right_currency=_0x27269e[0x0][_0x3af8ef(0x167)],left_currency=''):(right_currency='',left_currency=_0x27269e[0x0][_0x3af8ef(0x167)]);var _0x5dc050=_0x4136e2,_0x542472=_0x15c173,_0x57b16a='',_0x39c8ff;for(_0x39c8ff in _0x5dc050){_0x57b16a+=_0x3af8ef(0x15c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5dc050[_0x39c8ff]+_0x3af8ef(0x180)+_0x3af8ef(0x183)+_0x542472[_0x39c8ff]+_0x3af8ef(0x180)+_0x3af8ef(0x163);}console[_0x3af8ef(0x182)](_0x3af8ef(0x13a),_0x57b16a);let _0x46efba=nodemailer['createTransport']({'service':_0x3af8ef(0x176),'auth':{'user':_0x25ab97[_0x3af8ef(0x13b)],'pass':_0x25ab97['password']}}),_0x3a8416={'from':_0x25ab97[_0x3af8ef(0x13b)],'to':_0x54a0ee[_0x3af8ef(0x13b)],'subject':_0x3af8ef(0x133),'attachments':[{'filename':_0x3af8ef(0xae),'path':__dirname+_0x3af8ef(0x164)+'/upload/'+_0x27269e[0x0][_0x3af8ef(0x8e)],'cid':_0x3af8ef(0xfa)}],'html':_0x3af8ef(0x83)+_0x3af8ef(0xc2)+_0x3af8ef(0x174)+_0x3af8ef(0xe0)+_0x3af8ef(0x147)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+'<h2>\x20'+_0x27269e[0x0][_0x3af8ef(0x112)]+_0x3af8ef(0x111)+_0x3af8ef(0xdb)+_0x3af8ef(0xdb)+_0x3af8ef(0x14f)+_0x3af8ef(0xe0)+_0x3af8ef(0x140)+_0x3af8ef(0x9e)+_0xe0fb1a+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3af8ef(0xc5)+_0x186c5d+'\x20'+_0x3af8ef(0x129)+_0x3af8ef(0xab)+_0x3af8ef(0xdb)+_0x3af8ef(0x113)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3af8ef(0x15c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x3af8ef(0x78)+_0x3af8ef(0xb6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x3af8ef(0x163)+_0x3af8ef(0xc7)+_0x3af8ef(0xb4)+'\x20'+_0x57b16a+'\x20'+_0x3af8ef(0xeb)+_0x3af8ef(0x8d)+'<div>'+_0x3af8ef(0x12c)+'<h5>'+_0x27269e[0x0][_0x3af8ef(0x112)]+_0x3af8ef(0xab)+_0x3af8ef(0xdb)+_0x3af8ef(0xdb)+'</body></html>'};_0x46efba['sendMail'](_0x3a8416,function(_0x2f47a2,_0x4f3b1b){var _0x1c1a20=_0x3af8ef;_0x2f47a2?(console[_0x1c1a20(0x182)](_0x2f47a2),console[_0x1c1a20(0x182)]('Error\x20Occurs')):console[_0x1c1a20(0x182)](_0x1c1a20(0x103));}),_0x323781['flash'](_0x3af8ef(0x17f),_0x3af8ef(0xd6)),_0xe96b24[_0x3af8ef(0x160)](_0x3af8ef(0x146));}catch(_0x3b3f86){console[_0x3af8ef(0x182)](_0x3b3f86),_0xe96b24[_0x3af8ef(0x9a)](0xc8)[_0x3af8ef(0x135)]({'message1':_0x3b3f86[_0x3af8ef(0xbe)]});}}}),router[a0_0x27c054(0x181)](a0_0x27c054(0xba),auth,async(_0x3042af,_0x28d2bf)=>{var _0x1aaf1e=a0_0x27c054;try{const {username:_0x529672,email:_0x39988d,role:_0x56d1f8}=_0x3042af[_0x1aaf1e(0x179)],_0x421c5a=_0x3042af[_0x1aaf1e(0x179)],_0x40d343=await profile['findOne']({'email':_0x421c5a[_0x1aaf1e(0x13b)]}),_0xafa4c8=await master_shop[_0x1aaf1e(0x158)]();console[_0x1aaf1e(0x182)](_0x1aaf1e(0x17b),_0xafa4c8);const _0x464745=_0x3042af[_0x1aaf1e(0xc4)]['id'],_0x119e74=await sales[_0x1aaf1e(0x17d)](_0x464745);console[_0x1aaf1e(0x182)](_0x1aaf1e(0xac),_0x119e74);if(_0xafa4c8[0x0]['language']==_0x1aaf1e(0x142))var _0x34b615=users[_0x1aaf1e(0x8b)];else{if(_0xafa4c8[0x0]['language']=='Hindi')var _0x34b615=users[_0x1aaf1e(0x17c)];else{if(_0xafa4c8[0x0][_0x1aaf1e(0x121)]==_0x1aaf1e(0xb2))var _0x34b615=users[_0x1aaf1e(0xb2)];else{if(_0xafa4c8[0x0][_0x1aaf1e(0x121)]=='Spanish')var _0x34b615=users['Spanish'];else{if(_0xafa4c8[0x0][_0x1aaf1e(0x121)]==_0x1aaf1e(0x145))var _0x34b615=users['French'];else{if(_0xafa4c8[0x0]['language']==_0x1aaf1e(0xd4))var _0x34b615=users[_0x1aaf1e(0x165)];else{if(_0xafa4c8[0x0][_0x1aaf1e(0x121)]==_0x1aaf1e(0xbf))var _0x34b615=users[_0x1aaf1e(0xbf)];else{if(_0xafa4c8[0x0][_0x1aaf1e(0x121)]=='Arabic\x20(ae)')var _0x34b615=users[_0x1aaf1e(0xde)];}}}}}}}_0x28d2bf[_0x1aaf1e(0x168)](_0x1aaf1e(0xed),{'success':_0x3042af[_0x1aaf1e(0x6f)](_0x1aaf1e(0x17f)),'errors':_0x3042af[_0x1aaf1e(0x6f)](_0x1aaf1e(0x7d)),'role':_0x421c5a,'profile':_0x40d343,'alldata':_0x119e74,'master_shop':_0xafa4c8,'language':_0x34b615});}catch(_0x475ca6){console['log'](_0x475ca6);}}),router[a0_0x27c054(0xd7)](a0_0x27c054(0x7c),async(_0x58f5e0,_0x238f26)=>{var _0x3d959d=a0_0x27c054;const {product_code:_0x3a94d6,warehouse_name:_0x155ee2,rooms_data:_0x1af9de,Roomslist:_0x2efe40}=_0x58f5e0[_0x3d959d(0x93)],_0x2e3692=_0x2efe40['split'](','),_0x5aaa6e=[];async function _0x3df3c3(_0x289a0f){var _0x2f45be=_0x3d959d;const _0x2ac6e5=await warehouse[_0x2f45be(0x15a)]([{'$match':{'name':_0x155ee2,'room':_0x289a0f}},{'$unwind':_0x2f45be(0x169)},{'$match':{'product_details.primary_code':_0x3a94d6}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2f45be(0x177)},'product_stock':{'$first':_0x2f45be(0x11c)},'primary_code':{'$first':_0x2f45be(0x80)},'secondary_code':{'$first':_0x2f45be(0x76)},'product_code':{'$first':_0x2f45be(0x184)},'level':{'$first':_0x2f45be(0x70)},'isle':{'$first':_0x2f45be(0x117)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2f45be(0xda)},'unit':{'$first':_0x2f45be(0x81)},'secondary_unit':{'$first':_0x2f45be(0x9d)},'storage':{'$first':_0x2f45be(0xa2)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2f45be(0x88)},'production_date':{'$first':_0x2f45be(0x101)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2f45be(0x148)},'product_cat':{'$first':_0x2f45be(0x130)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2f45be(0x171)},'invoice':{'$first':_0x2f45be(0x73)}}}]),_0x20e8a9=await warehouse[_0x2f45be(0x15a)]([{'$match':{'name':_0x155ee2,'room':_0x289a0f}},{'$unwind':_0x2f45be(0x169)},{'$match':{'product_details.secondary_code':_0x3a94d6}},{'$group':{'_id':_0x2f45be(0x99),'name':{'$first':_0x2f45be(0x177)},'product_stock':{'$first':_0x2f45be(0x11c)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2f45be(0x184)},'level':{'$first':_0x2f45be(0x70)},'isle':{'$first':_0x2f45be(0x117)},'type':{'$first':_0x2f45be(0x16b)},'pallet':{'$first':_0x2f45be(0xda)},'unit':{'$first':_0x2f45be(0x81)},'secondary_unit':{'$first':_0x2f45be(0x9d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2f45be(0x8f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2f45be(0x101)},'maxPerUnit':{'$first':_0x2f45be(0xad)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x2f45be(0x130)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2f45be(0x171)},'invoice':{'$first':_0x2f45be(0x73)}}}]);if(_0x2ac6e5[_0x2f45be(0x155)]>0x0)_0x5aaa6e[_0x2f45be(0x11a)](_0x2ac6e5);else _0x20e8a9[_0x2f45be(0x155)]>0x0&&_0x5aaa6e[_0x2f45be(0x11a)](_0x20e8a9);}const _0x2d91c2=_0x2e3692[_0x3d959d(0xc6)](_0x36d7d2=>_0x3df3c3(_0x36d7d2));await Promise[_0x3d959d(0xfd)](_0x2d91c2),_0x238f26['json'](_0x5aaa6e);}),module[a0_0x27c054(0x16c)]=router;