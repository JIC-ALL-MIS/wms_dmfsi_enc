var a0_0xce787f=a0_0x2210;function a0_0xfadb(){var _0x4419f2=['$name','Enclosed','$product_details.type','length','unit_QA','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','\x20&&\x20','Sales\x20Update\x20successfully','/../public','edit_sales_finished_view','Sales\x20Mail','../public/language/languages.json','$sale_product.type','findOne','Return\x20Rooms','customers','warehouse','secondary_code','</table>','secondary_unit','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$_id','batch_code','Spanish','/view/add_sales','$product_details._id','$product_details.maxProducts','express','Chinese','role','\x20Order\x20Number\x20:\x20','success','note','<h5\x20style=\x22text-align:\x20left;\x22>','$sale_product.floorlevel','push','gmail','$invoice','secondary_code_QA','aggregate','</tr>','<tr>','English\x20(US)','return_sale_finished','</body></html>','redirect','maxPerUnit_QA','$product_details.product_stock','params','prod_invoice','$product_details.storage','suppliers','flash','purchases_data','</thead>','all','customers_docs','FGSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','concat','date','An\x20error\x20occurred.','$product_details.production_date','port','prod_code','sales_quantity','message','Sales\x20Add\x20successfully','post','stocks_QA','getMonth','getDate','An\x20error\x20occurred\x20while\x20saving\x20data.','quantity','../middleware/auth','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<span\x20style=\x22float:\x20right;\x22>','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$room','amount','render','product_name','master','/view/return_sales/:id','slice','Received\x20Payment\x20For\x20Sale','44HyWDyq','get','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','logo','$date','edit_sales_finished','max','abs','\x20</h2>','production_date_QA','<strong>\x20Regards\x20</strong>','$product_details.product_cat','$product_details.floorlevel','$return_data','/view/:id','sales_quantity_QA','Arabic','$product_details.secondary_code','/all_sales/view','email','Enabled','../models/all_models','find','body','maxPerUnit','<tbody\x20style=\x22text-align:\x20center;\x22>','adjust_qty','batch_code_QA','$product_details.secondary_unit','primary_unit','Logo.png','room','toString','\x20Order\x20Date\x20:\x20','Email\x20sent\x20successfully','for_categorize','json','$product','$product_details.invoice','/upload/','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.room_name','site_title','ADD\x20SALE','product_code','return_sale_QA','catch','primary_code','\x20==\x20','production_date','then','$product_details.bay','staff','language','</div>','random','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Arabic\x20(ae)','sendMail','status','$product_details.batch_code','sales\x20item\x20return\x20successfull','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Quality\x20Inspection','log','Sale\x20Return\x20Mail','add_sales_finished','/all_sales_finished/view','</tbody>','</h5>','6885240MZhzDP','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Sale\x20Return','RoomAssigned','sale_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/picking_list/pdf/','createTransport','bay','/barcode/:id','errors','Finished\x20Goods','final','product','English','$product_details.expiry_date','</span>','invoice','save','nodemailer','$note','findById','customer','currency','Router','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','password','$product_details.rack','$product_details.product_code','Ambient','</head><body>','$customers_docs','room_name','host','sale_product','forEach','prod_cat','True','sales_invoice','Add\x20Sales','/view/add_sales/:id','carton','due_amount','expiry_date_QA','product_stock','return_sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','all_sales_barcode','/give_payment/:id','$product_details.product_name','stock','maxProducts','$customer','foreach\x20newproduct','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','filter','<h5>','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','image','<h2>\x20','Error\x20Occurs','return_qty_QA','map','_id','id_transaction_from','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','user','product_date','received_amount','$finalize','8751925WJbbXF','$product_details.bin','$sale_product.bay','customer_data','$warehouse_name','$product_details.maxPerUnit','1611771lpitaM','Sale','DRY\x20GOODS','$product_details','return_qty','currency_placement','OUTF-','product_name_QA1','product_code_QA','/invoice/:id','expiry_date','product_list','$sale_product.quantity','back','\x20<>\x20','secondary_unit_QA','product_data','warehouse_name','German','maxProducts_QA','197435qLUIjk','payment\x20successfull','Hindi','<div>','$sale_product','unit','max_per_unit','error','/preview/:id','$sale_product.bin','1790048vwBAuS','/view','</td>','142YvbaCS','Portuguese','7160EZLkrc','<hr\x20class=\x22my-3\x22>','/view/add_sale/product','French','/barcode_scanner','product_details','$product_details.unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','getFullYear','<html><head><title></title>','$product_details.primary_code','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','35081955ZdlWKb','stock_data','string'];a0_0xfadb=function(){return _0x4419f2;};return a0_0xfadb();}(function(_0x5d2bda,_0x36649d){var _0x357283=a0_0x2210,_0x42231b=_0x5d2bda();while(!![]){try{var _0x198386=-parseInt(_0x357283(0x26a))/0x1*(parseInt(_0x357283(0x268))/0x2)+-parseInt(_0x357283(0x247))/0x3+parseInt(_0x357283(0x2d1))/0x4*(parseInt(_0x357283(0x25b))/0x5)+-parseInt(_0x357283(0x1fb))/0x6+-parseInt(_0x357283(0x241))/0x7+-parseInt(_0x357283(0x265))/0x8+parseInt(_0x357283(0x276))/0x9;if(_0x198386===_0x36649d)break;else _0x42231b['push'](_0x42231b['shift']());}catch(_0x58ed0e){_0x42231b['push'](_0x42231b['shift']());}}}(a0_0xfadb,0xa264c));const express=require(a0_0xce787f(0x294)),app=express(),router=express[a0_0xce787f(0x213)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0xce787f(0x2e6)),auth=require(a0_0xce787f(0x2c3)),nodemailer=require(a0_0xce787f(0x20e)),users=require(a0_0xce787f(0x284));router[a0_0xce787f(0x2d2)](a0_0xce787f(0x266),auth,async(_0x32920c,_0x2ea191)=>{var _0x46c1f3=a0_0xce787f;try{const {username:_0x50ae31,email:_0x29f5f2,role:_0x207dd3}=_0x32920c['user'],_0x29ec2f=_0x32920c[_0x46c1f3(0x23d)],_0x1d4f1c=await profile[_0x46c1f3(0x286)]({'email':_0x29ec2f[_0x46c1f3(0x2e4)]}),_0x539624=await master_shop[_0x46c1f3(0x2e7)]();let _0x43c240;if(_0x29ec2f[_0x46c1f3(0x296)]=='staff'){const _0x485ed8=await staff[_0x46c1f3(0x286)]({'email':_0x29ec2f[_0x46c1f3(0x2e4)]});_0x43c240=await sales_finished[_0x46c1f3(0x2a0)]([{'$lookup':{'from':_0x46c1f3(0x288),'localField':_0x46c1f3(0x211),'foreignField':'name','as':_0x46c1f3(0x2b1)}},{'$unwind':_0x46c1f3(0x21a)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x46c1f3(0x28e),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x46c1f3(0x2d5)},'warehouse_name':{'$first':_0x46c1f3(0x245)},'sale_product':{'$push':_0x46c1f3(0x25f)},'note':{'$first':_0x46c1f3(0x20f)},'return_data':{'$first':_0x46c1f3(0x2de)},'customers_docs':{'$first':_0x46c1f3(0x21a)},'total_saleproduct_quantity':{'$sum':_0x46c1f3(0x253)},'level':{'$addToSet':_0x46c1f3(0x243)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x46c1f3(0x29b)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x43c240=await sales_finished[_0x46c1f3(0x2a0)]([{'$lookup':{'from':_0x46c1f3(0x288),'localField':'customer','foreignField':'name','as':_0x46c1f3(0x2b1)}},{'$unwind':_0x46c1f3(0x21a)},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x46c1f3(0x29e)},'customers':{'$first':_0x46c1f3(0x22f)},'date':{'$first':_0x46c1f3(0x2d5)},'warehouse_name':{'$first':_0x46c1f3(0x245)},'sale_product':{'$push':_0x46c1f3(0x25f)},'note':{'$first':_0x46c1f3(0x20f)},'return_data':{'$first':_0x46c1f3(0x2de)},'customers_docs':{'$first':_0x46c1f3(0x21a)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x46c1f3(0x243)},'isle':{'$addToSet':_0x46c1f3(0x264)},'type':{'$addToSet':_0x46c1f3(0x285)},'pallet':{'$addToSet':_0x46c1f3(0x29b)},'finalize':{'$first':_0x46c1f3(0x240)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x539624[0x0][_0x46c1f3(0x1ea)]==_0x46c1f3(0x2a3)){var _0x2949bf=users[_0x46c1f3(0x209)];console['log'](_0x2949bf);}else{if(_0x539624[0x0][_0x46c1f3(0x1ea)]=='Hindi')var _0x2949bf=users['Hindi'];else{if(_0x539624[0x0][_0x46c1f3(0x1ea)]=='German')var _0x2949bf=users[_0x46c1f3(0x259)];else{if(_0x539624[0x0][_0x46c1f3(0x1ea)]=='Spanish')var _0x2949bf=users[_0x46c1f3(0x290)];else{if(_0x539624[0x0][_0x46c1f3(0x1ea)]==_0x46c1f3(0x26d))var _0x2949bf=users[_0x46c1f3(0x26d)];else{if(_0x539624[0x0][_0x46c1f3(0x1ea)]=='Portuguese\x20(BR)')var _0x2949bf=users[_0x46c1f3(0x269)];else{if(_0x539624[0x0]['language']==_0x46c1f3(0x295))var _0x2949bf=users['Chinese'];else{if(_0x539624[0x0][_0x46c1f3(0x1ea)]==_0x46c1f3(0x1ee))var _0x2949bf=users[_0x46c1f3(0x2e1)];}}}}}}}_0x2ea191[_0x46c1f3(0x2cb)]('all_sales_finished',{'success':_0x32920c[_0x46c1f3(0x2ad)](_0x46c1f3(0x298)),'errors':_0x32920c[_0x46c1f3(0x2ad)](_0x46c1f3(0x205)),'sales':_0x43c240,'profile':_0x1d4f1c,'role':_0x29ec2f,'master_shop':_0x539624,'language':_0x2949bf});}catch(_0x276cca){console[_0x46c1f3(0x1f5)](_0x276cca);}});function a0_0x2210(_0x357e16,_0x4bc090){var _0xfadba6=a0_0xfadb();return a0_0x2210=function(_0x221069,_0x2cc00f){_0x221069=_0x221069-0x1cf;var _0x341b86=_0xfadba6[_0x221069];return _0x341b86;},a0_0x2210(_0x357e16,_0x4bc090);}async function getRandom8DigitNumber(){var _0x292052=a0_0xce787f;const _0x37e71b=0x989680,_0x1e2117=0x5f5e0ff,_0x398382=Math['floor'](Math[_0x292052(0x1ec)]()*(_0x1e2117-_0x37e71b+0x1))+_0x37e71b;var _0x2736e8;const _0x56ded4=await sales_finished[_0x292052(0x286)]({'invoice':_0x292052(0x24d)+_0x398382});return _0x56ded4&&_0x56ded4[_0x292052(0x27c)]>0x0?_0x2736e8=_0x292052(0x24d)+_0x398382:_0x2736e8='OUTF-'+_0x398382,_0x2736e8;}router[a0_0xce787f(0x2d2)](a0_0xce787f(0x291),auth,async(_0x303e96,_0xf37739)=>{var _0x3e2e0e=a0_0xce787f;try{const {username:_0x16c689,email:_0x4268ee,role:_0x5e24ae}=_0x303e96[_0x3e2e0e(0x23d)],_0xad261d=_0x303e96[_0x3e2e0e(0x23d)],_0x6dd8a7=await profile[_0x3e2e0e(0x286)]({'email':_0xad261d[_0x3e2e0e(0x2e4)]}),_0x567986=await master_shop[_0x3e2e0e(0x2e7)](),_0x35ced1=await customer['find']({});let _0x16272e;if(_0xad261d[_0x3e2e0e(0x296)]=='staff'){const _0x30b743=await staff['findOne']({'email':_0xad261d[_0x3e2e0e(0x2e4)]});_0x16272e=await warehouse[_0x3e2e0e(0x2a0)]([{'$match':{'status':_0x3e2e0e(0x2e5),'name':_0x30b743[_0x3e2e0e(0x289)],'warehouse_category':_0x3e2e0e(0x206),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x3e2e0e(0x279),'name':{'$first':_0x3e2e0e(0x279)}}},{'$sort':{'name':0x1}}]);}else _0x16272e=await warehouse['aggregate']([{'$match':{'status':_0x3e2e0e(0x2e5),'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x3e2e0e(0x279),'name':{'$first':_0x3e2e0e(0x279)}}},{'$sort':{'name':0x1}}]);const _0x48092b=await product[_0x3e2e0e(0x2e7)]({});var _0x413a05=[_0x3e2e0e(0x218),_0x3e2e0e(0x27a)];const _0x22da03=await sales_finished[_0x3e2e0e(0x2e7)]({}),_0x34435a=_0x22da03[_0x3e2e0e(0x27c)]+0x1,_0x498b66=_0x3e2e0e(0x24d)+_0x34435a[_0x3e2e0e(0x1d5)]()['padStart'](0x5,'0');if(_0x567986[0x0][_0x3e2e0e(0x1ea)]==_0x3e2e0e(0x2a3)){var _0x5ac033=users['English'];console[_0x3e2e0e(0x1f5)](_0x5ac033);}else{if(_0x567986[0x0]['language']==_0x3e2e0e(0x25d))var _0x5ac033=users[_0x3e2e0e(0x25d)];else{if(_0x567986[0x0][_0x3e2e0e(0x1ea)]==_0x3e2e0e(0x259))var _0x5ac033=users[_0x3e2e0e(0x259)];else{if(_0x567986[0x0]['language']=='Spanish')var _0x5ac033=users[_0x3e2e0e(0x290)];else{if(_0x567986[0x0][_0x3e2e0e(0x1ea)]=='French')var _0x5ac033=users[_0x3e2e0e(0x26d)];else{if(_0x567986[0x0]['language']==_0x3e2e0e(0x2c7))var _0x5ac033=users['Portuguese'];else{if(_0x567986[0x0][_0x3e2e0e(0x1ea)]=='Chinese')var _0x5ac033=users['Chinese'];else{if(_0x567986[0x0][_0x3e2e0e(0x1ea)]==_0x3e2e0e(0x1ee))var _0x5ac033=users[_0x3e2e0e(0x2e1)];}}}}}}}const _0x162562=getRandom8DigitNumber();_0x162562['then'](_0x36ebc4=>{var _0xb52229=_0x3e2e0e;_0xf37739[_0xb52229(0x2cb)](_0xb52229(0x1f7),{'success':_0x303e96[_0xb52229(0x2ad)](_0xb52229(0x298)),'errors':_0x303e96[_0xb52229(0x2ad)](_0xb52229(0x205)),'role':_0xad261d,'profile':_0x6dd8a7,'customer':_0x35ced1,'warehouse':_0x16272e,'product':_0x48092b,'invoice':_0x36ebc4,'master_shop':_0x567986,'language':_0x5ac033,'rooms_data':_0x413a05});})[_0x3e2e0e(0x1e3)](_0x37c8f6=>{var _0x1ed476=_0x3e2e0e;_0x303e96[_0x1ed476(0x2ad)](_0x1ed476(0x205),_0x1ed476(0x28d)),_0xf37739[_0x1ed476(0x2a6)](_0x1ed476(0x1f8));});}catch(_0x401f72){console[_0x3e2e0e(0x1f5)](_0x401f72);}}),router[a0_0xce787f(0x2d2)](a0_0xce787f(0x223),auth,async(_0xe9811b,_0x1bb8be)=>{var _0x4c1a84=a0_0xce787f;try{const _0x594705=_0xe9811b[_0x4c1a84(0x2a9)]['id'];console['log'](_0x594705);const _0x4d6248=await product[_0x4c1a84(0x2e7)](),_0x20de4d=await purchases[_0x4c1a84(0x2a0)]([{'$match':{'warehouse_name':_0x594705}},{'$unwind':_0x4c1a84(0x1da)},{'$group':{'_id':'$product.product_name'}}]);console[_0x4c1a84(0x1f5)](_0x4c1a84(0x2ae),_0x20de4d),_0x1bb8be[_0x4c1a84(0x1f0)](0xc8)[_0x4c1a84(0x1d9)]({'purchases_data':_0x20de4d,'product_data':_0x4d6248});}catch(_0x287c73){console[_0x4c1a84(0x1f5)](_0x287c73);}}),router[a0_0xce787f(0x2bd)](a0_0xce787f(0x26c),auth,async(_0x525cd2,_0x362ecb)=>{var _0x20d2cb=a0_0xce787f;try{const {warehouse_data:_0x23f140,product_data:_0x9dce43}=_0x525cd2[_0x20d2cb(0x2e8)];console[_0x20d2cb(0x1f5)](_0x525cd2[_0x20d2cb(0x2e8)][_0x20d2cb(0x257)]);;const _0xc9f55b=await master_shop['find']();console[_0x20d2cb(0x1f5)](_0x20d2cb(0x2cd),_0xc9f55b);const _0x31df03=await product['findOne']({'name':_0x9dce43});console[_0x20d2cb(0x1f5)](_0x20d2cb(0x208),_0x31df03);const _0x1d2b2c=await warehouse['aggregate']([{'$match':{'name':_0x23f140}},{'$unwind':_0x20d2cb(0x24a)},{'$match':{'product_details.product_name':_0x9dce43}},{'$group':{'_id':_0x20d2cb(0x22c),'product_stock':{'$first':_0x20d2cb(0x2a8)}}}]);console[_0x20d2cb(0x1f5)](_0x20d2cb(0x277),_0x1d2b2c),_0x362ecb['status'](0xc8)['json']({'master':_0xc9f55b,'new_product':_0x31df03,'stock_data':_0x1d2b2c});}catch(_0x5a0168){console[_0x20d2cb(0x1f5)](_0x5a0168);}}),router[a0_0xce787f(0x2bd)]('/view/add_sales',auth,async(_0x40bcd7,_0x59f21d)=>{var _0x502cc8=a0_0xce787f;try{const {invoice:_0x1eb7d9,date:_0x50d2fa,warehouse_name:_0x16a352,product_name:_0x2e3afa,stock:_0x480158,quantity:_0x4e3014,note:_0x79cdd,room:_0x49a35c,primary_code:_0x1da6f8,secondary_code:_0x28474e,prod_code:_0x1f3042,level:_0x8ba4e0,isle:_0x58f92a,pallet:_0x378256,batch_code:_0x2d6ee3,SCRN:_0x46dd43,expiry_date:_0x5f1e3e,mode_transpo:_0x28146f,name_driver:_0x3a3f00}=_0x40bcd7[_0x502cc8(0x2e8)];if(typeof _0x2e3afa==_0x502cc8(0x278))var _0x3ef36f=[_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x2cc)]],_0xcf0278=[_0x40bcd7['body'][_0x502cc8(0x22d)]],_0x5f1e31=[_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x224)]],_0x108b0f=[_0x40bcd7['body'][_0x502cc8(0x1e4)]],_0x2b6162=[_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x28a)]],_0x4acdd9=[_0x40bcd7['body']['prod_code']],_0x583d24=[_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x2c4)]],_0x48bb5c=[_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x1d2)]],_0x55882c=[_0x40bcd7['body']['secondary_unit']],_0x17e615=[_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x28f)]],_0x23a3bd=[_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x251)]],_0x1ba162=[_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x23e)]],_0x151750=[_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x261)]],_0x534989=[_0x40bcd7['body'][_0x502cc8(0x21f)]],_0x49985b=[_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x1fe)]],_0x5a989b=[_0x40bcd7['body'][_0x502cc8(0x2aa)]],_0x4d8a18=[_0x40bcd7[_0x502cc8(0x2e8)]['id_transaction_from']];else var _0x3ef36f=[..._0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x2cc)]],_0xcf0278=[..._0x40bcd7['body']['stock']],_0x5f1e31=[..._0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x224)]],_0x108b0f=[..._0x40bcd7['body'][_0x502cc8(0x1e4)]],_0x2b6162=[..._0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x28a)]],_0x4acdd9=[..._0x40bcd7[_0x502cc8(0x2e8)]['prod_code']],_0x583d24=[..._0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x2c4)]],_0x48bb5c=[..._0x40bcd7[_0x502cc8(0x2e8)]['primary_unit']],_0x55882c=[..._0x40bcd7[_0x502cc8(0x2e8)]['secondary_unit']],_0x17e615=[..._0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x28f)]],_0x23a3bd=[..._0x40bcd7[_0x502cc8(0x2e8)]['expiry_date']],_0x1ba162=[..._0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x23e)]],_0x151750=[..._0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x261)]],_0x534989=[..._0x40bcd7[_0x502cc8(0x2e8)]['prod_cat']],_0x49985b=[..._0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x1fe)]],_0x5a989b=[..._0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x2aa)]],_0x4d8a18=[..._0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x23b)]];const _0x314542=_0x3ef36f[_0x502cc8(0x239)](_0x4f351a=>{return _0x4f351a={'product_name':_0x4f351a};});_0xcf0278[_0x502cc8(0x21e)]((_0x1134c9,_0x34d641)=>{_0x314542[_0x34d641]['stock']=_0x1134c9;}),_0x5f1e31[_0x502cc8(0x21e)]((_0x2dd259,_0x1c1feb)=>{var _0x38a361=_0x502cc8;_0x314542[_0x1c1feb][_0x38a361(0x2c2)]=Math[_0x38a361(0x2d8)](_0x2dd259);}),_0x4d8a18[_0x502cc8(0x21e)]((_0x47035d,_0x34c218)=>{var _0x4e10d1=_0x502cc8;_0x314542[_0x34c218][_0x4e10d1(0x23b)]=_0x47035d;}),_0x108b0f[_0x502cc8(0x21e)]((_0xfb110d,_0x4094f3)=>{var _0x11b0d3=_0x502cc8;_0x314542[_0x4094f3][_0x11b0d3(0x1e4)]=_0xfb110d;}),_0x2b6162[_0x502cc8(0x21e)]((_0x5c7cdd,_0x2dfbdb)=>{_0x314542[_0x2dfbdb]['secondary_code']=_0x5c7cdd;}),_0x4acdd9[_0x502cc8(0x21e)]((_0x388af7,_0xaf6123)=>{var _0x363acc=_0x502cc8;_0x314542[_0xaf6123][_0x363acc(0x1e1)]=_0x388af7;}),_0x583d24[_0x502cc8(0x21e)]((_0x267468,_0x39cdc7)=>{var _0x740ac0=_0x502cc8;_0x314542[_0x39cdc7][_0x740ac0(0x203)]=_0x267468;}),_0x48bb5c[_0x502cc8(0x21e)]((_0x28c188,_0x22dce1)=>{var _0x2242bf=_0x502cc8;_0x314542[_0x22dce1][_0x2242bf(0x260)]=_0x28c188;}),_0x55882c[_0x502cc8(0x21e)]((_0xd9f889,_0x4d0940)=>{var _0x78cd39=_0x502cc8;_0x314542[_0x4d0940][_0x78cd39(0x28c)]=_0xd9f889;}),_0x17e615[_0x502cc8(0x21e)]((_0x39692f,_0xf4256e)=>{_0x314542[_0xf4256e]['batch_code']=_0x39692f;}),_0x23a3bd['forEach']((_0x276abb,_0x57810c)=>{_0x314542[_0x57810c]['expiry_date']=_0x276abb;}),_0x1ba162[_0x502cc8(0x21e)]((_0x47e391,_0x58c0f5)=>{_0x314542[_0x58c0f5]['production_date']=_0x47e391;}),_0x151750[_0x502cc8(0x21e)]((_0xde3b90,_0x2504c9)=>{_0x314542[_0x2504c9]['maxperunit']=_0xde3b90;}),_0x534989['forEach']((_0x2d5d5f,_0x32aa17)=>{var _0x4aba44=_0x502cc8;_0x314542[_0x32aa17][_0x4aba44(0x21f)]=_0x2d5d5f;}),_0x49985b['forEach']((_0x58814d,_0x96ad92)=>{_0x314542[_0x96ad92]['room_name']=_0x58814d;}),_0x5a989b[_0x502cc8(0x21e)]((_0x984d91,_0x177317)=>{var _0x288d93=_0x502cc8;_0x314542[_0x177317][_0x288d93(0x20c)]=_0x984d91;});var _0x14aff2=0x0;_0x314542['forEach'](_0x3dc658=>{var _0x1ba804=_0x502cc8;parseFloat(_0x3dc658[_0x1ba804(0x22d)])<parseFloat(_0x3dc658[_0x1ba804(0x2c2)])&&parseFloat(_0x3dc658[_0x1ba804(0x2c2)])>parseFloat(_0x3dc658['stock'])&&(console[_0x1ba804(0x1f5)](_0x3dc658[_0x1ba804(0x22d)]+_0x1ba804(0x255)+_0x3dc658[_0x1ba804(0x2c2)]),_0x14aff2++);});if(_0x14aff2!=0x0)return _0x40bcd7[_0x502cc8(0x2ad)](_0x502cc8(0x205),_0x502cc8(0x234)),_0x59f21d[_0x502cc8(0x2a6)](_0x502cc8(0x254));const _0x58fe07=_0x314542['filter'](_0x3b0eaf=>_0x3b0eaf[_0x502cc8(0x2c2)]!=='0'&&_0x3b0eaf[_0x502cc8(0x2c2)]!==''),_0x2ae88d=new sales_finished({'invoice':_0x1eb7d9,'customer':_0x40bcd7['body']['customer'],'date':_0x50d2fa,'warehouse_name':_0x16a352,'sale_product':_0x58fe07,'note':_0x79cdd,'room':_0x49a35c,'primary_code':_0x1da6f8,'secondary_code':_0x28474e,'prod_code':_0x1f3042,'SCRN':_0x46dd43,'finalize':'False','mode_transpo':_0x28146f,'name_driver':_0x3a3f00}),_0x1f4cc7=await _0x2ae88d[_0x502cc8(0x20d)](),_0x557abd=await sales_finished[_0x502cc8(0x286)]({'invoice':_0x1eb7d9}),_0x4ad0cc=new c_payment_data({'invoice':_0x1eb7d9,'customer':_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x211)],'reason':_0x502cc8(0x248)});await _0x4ad0cc['save']();const _0x16d9e2=await master_shop[_0x502cc8(0x2e7)](),_0x138a2b=await email_settings[_0x502cc8(0x286)](),_0x425b8e=await customer[_0x502cc8(0x286)]({'name':_0x40bcd7[_0x502cc8(0x2e8)][_0x502cc8(0x211)]});_0x16d9e2[0x0][_0x502cc8(0x24c)]==0x1?(right_currency=_0x16d9e2[0x0][_0x502cc8(0x212)],left_currency=''):(right_currency='',left_currency=_0x16d9e2[0x0][_0x502cc8(0x212)]);var _0x22de54=_0x3ef36f,_0x3f8c47=_0x5f1e31,_0x11c015='',_0x20bcb4;for(_0x20bcb4 in _0x22de54){_0x11c015+='<tr>'+_0x502cc8(0x231)+_0x22de54[_0x20bcb4]+_0x502cc8(0x267)+_0x502cc8(0x231)+_0x3f8c47[_0x20bcb4]+_0x502cc8(0x267)+_0x502cc8(0x2a1);}console[_0x502cc8(0x1f5)]('product_list',_0x11c015);let _0x1f8e36=nodemailer[_0x502cc8(0x202)]({'host':_0x138a2b[_0x502cc8(0x21c)],'port':Number(_0x138a2b[_0x502cc8(0x2b8)]),'secure':![],'service':_0x502cc8(0x29d),'auth':{'user':_0x138a2b[_0x502cc8(0x2e4)],'pass':_0x138a2b[_0x502cc8(0x215)]}}),_0x4bf128={'from':_0x138a2b[_0x502cc8(0x2e4)],'to':'christian.villamer@jakagroup.com','subject':_0x502cc8(0x222),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x502cc8(0x1dc)+_0x16d9e2[0x0][_0x502cc8(0x235)],'cid':_0x502cc8(0x2d4)}],'html':_0x502cc8(0x1e0)};_0x1f8e36['sendMail'](_0x4bf128,function(_0x4b70a0,_0x5952ce){var _0x2c3126=_0x502cc8;_0x4b70a0?(console[_0x2c3126(0x1f5)](_0x4b70a0),console[_0x2c3126(0x1f5)](_0x2c3126(0x237))):console[_0x2c3126(0x1f5)]('Email\x20sent\x20successfully');}),_0x40bcd7[_0x502cc8(0x2ad)](_0x502cc8(0x298),_0x502cc8(0x2bc)),_0x59f21d['redirect']('/all_sales_finished/preview/'+_0x1f4cc7['_id']);}catch(_0x209472){console[_0x502cc8(0x1f5)](_0x209472);}}),router[a0_0xce787f(0x2d2)](a0_0xce787f(0x263),auth,async(_0x67e9d8,_0x5cb23b)=>{var _0x8405f0=a0_0xce787f;try{const {username:_0x1a4055,email:_0x5d4c4d,role:_0x568d6f}=_0x67e9d8[_0x8405f0(0x23d)],_0x2cfeb3=_0x67e9d8[_0x8405f0(0x23d)],_0x14e877=await profile[_0x8405f0(0x286)]({'email':_0x2cfeb3['email']}),_0x492d6e=await master_shop[_0x8405f0(0x2e7)](),_0x3d1423=_0x67e9d8[_0x8405f0(0x2a9)]['id'],_0x42638e=await sales_finished[_0x8405f0(0x210)](_0x3d1423),_0x4486ec=await warehouse[_0x8405f0(0x2a0)]([{'$match':{'name':_0x42638e[_0x8405f0(0x258)]}},{'$unwind':_0x8405f0(0x24a)},{'$group':{'_id':_0x8405f0(0x292),'name':{'$first':_0x8405f0(0x22c)},'product_stock':{'$first':_0x8405f0(0x2a8)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x8405f0(0x27b)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x8405f0(0x274)},'secondary_code':{'$first':_0x8405f0(0x2e2)},'product_code':{'$first':_0x8405f0(0x217)},'storage':{'$first':_0x8405f0(0x2ab)},'rack':{'$first':_0x8405f0(0x216)},'expiry_date':{'$first':_0x8405f0(0x20a)},'production_date':{'$first':_0x8405f0(0x2b7)},'batch_code':{'$first':_0x8405f0(0x1f1)},'room':{'$first':_0x8405f0(0x2c9)},'room_data':{'$first':_0x8405f0(0x1de)}}}]),_0x79c4be=await customer[_0x8405f0(0x2e7)]({});let _0x12467a;if(_0x2cfeb3[_0x8405f0(0x296)]==_0x8405f0(0x1e9)){const _0x155533=await staff[_0x8405f0(0x286)]({'email':_0x2cfeb3[_0x8405f0(0x2e4)]});_0x12467a=await warehouse[_0x8405f0(0x2a0)]([{'$match':{'status':'Enabled','name':_0x155533['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x8405f0(0x279)}}}]);}else _0x12467a=await warehouse[_0x8405f0(0x2a0)]([{'$match':{'status':_0x8405f0(0x2e5)}},{'$group':{'_id':_0x8405f0(0x279),'name':{'$first':'$name'}}}]);const _0x5de24a=await product['find']({});if(_0x492d6e[0x0]['language']==_0x8405f0(0x2a3)){var _0x36869a=users[_0x8405f0(0x209)];console[_0x8405f0(0x1f5)](_0x36869a);}else{if(_0x492d6e[0x0]['language']==_0x8405f0(0x25d))var _0x36869a=users['Hindi'];else{if(_0x492d6e[0x0][_0x8405f0(0x1ea)]=='German')var _0x36869a=users['German'];else{if(_0x492d6e[0x0][_0x8405f0(0x1ea)]=='Spanish')var _0x36869a=users['Spanish'];else{if(_0x492d6e[0x0]['language']==_0x8405f0(0x26d))var _0x36869a=users[_0x8405f0(0x26d)];else{if(_0x492d6e[0x0][_0x8405f0(0x1ea)]==_0x8405f0(0x2c7))var _0x36869a=users['Portuguese'];else{if(_0x492d6e[0x0][_0x8405f0(0x1ea)]==_0x8405f0(0x295))var _0x36869a=users['Chinese'];else{if(_0x492d6e[0x0][_0x8405f0(0x1ea)]==_0x8405f0(0x1ee))var _0x36869a=users[_0x8405f0(0x2e1)];}}}}}}}_0x5cb23b['render'](_0x8405f0(0x282),{'success':_0x67e9d8[_0x8405f0(0x2ad)](_0x8405f0(0x298)),'errors':_0x67e9d8[_0x8405f0(0x2ad)]('errors'),'role':_0x2cfeb3,'profile':_0x14e877,'customer':_0x79c4be,'warehouse':_0x12467a,'product':_0x4486ec,'user':_0x42638e,'master_shop':_0x492d6e,'unit':_0x5de24a,'language':_0x36869a});}catch(_0x49bf43){console['log'](_0x49bf43);}}),router[a0_0xce787f(0x2bd)]('/preview/:id',auth,async(_0x146a08,_0x596401)=>{var _0x52baff=a0_0xce787f;try{const _0x39207d=_0x146a08['params']['id'],{invoice:_0x160e2e,warehouse_name:_0xd26e7,room:_0x5ae2e9}=_0x146a08[_0x52baff(0x2e8)],_0x327434=await sales_finished[_0x52baff(0x286)]({'invoice':_0x160e2e}),_0x4f33a4=_0x327434[_0x52baff(0x21d)][_0x52baff(0x239)](async _0x144cc6=>{var _0x1a4357=_0x52baff,_0x4b7077=await warehouse[_0x1a4357(0x286)]({'name':_0xd26e7,'room':_0x144cc6[_0x1a4357(0x21b)],'warehouse_category':_0x1a4357(0x206)});const _0x312200=_0x4b7077['product_details'][_0x1a4357(0x239)](_0x2dd04c=>{var _0x327e1e=_0x1a4357;(_0x2dd04c[_0x327e1e(0x2cc)]==_0x144cc6[_0x327e1e(0x2cc)]&&_0x2dd04c[_0x327e1e(0x203)]==_0x144cc6[_0x327e1e(0x203)]&&_0x2dd04c['expiry_date']==_0x144cc6[_0x327e1e(0x251)]&&_0x2dd04c[_0x327e1e(0x1e6)]==_0x144cc6[_0x327e1e(0x1e6)]&&_0x2dd04c[_0x327e1e(0x28f)]==_0x144cc6[_0x327e1e(0x28f)]&&_0x2dd04c[_0x327e1e(0x20c)]==_0x144cc6[_0x327e1e(0x20c)]||_0x2dd04c[_0x327e1e(0x23a)]==_0x144cc6[_0x327e1e(0x23b)])&&(_0x2dd04c[_0x327e1e(0x227)]>0x0&&(console[_0x327e1e(0x1f5)](_0x2dd04c['product_name']+_0x327e1e(0x1e5)+_0x144cc6['product_name']+'\x20&&\x20'+_0x2dd04c[_0x327e1e(0x203)]+_0x327e1e(0x1e5)+_0x144cc6[_0x327e1e(0x203)]+_0x327e1e(0x27f)+_0x2dd04c[_0x327e1e(0x1e6)]+_0x327e1e(0x1e5)+_0x144cc6[_0x327e1e(0x1e6)]+_0x327e1e(0x27f)+_0x2dd04c['expiry_date']+_0x327e1e(0x1e5)+_0x144cc6[_0x327e1e(0x251)]+_0x327e1e(0x27f)+_0x2dd04c[_0x327e1e(0x28f)]+_0x327e1e(0x1e5)+_0x144cc6[_0x327e1e(0x28f)]+_0x327e1e(0x27f)+_0x2dd04c['invoice']+'\x20==\x20'+_0x144cc6[_0x327e1e(0x20c)]+'\x20&&\x20'+_0x2dd04c[_0x327e1e(0x227)]+'\x20<<<==>>>\x20'+_0x144cc6[_0x327e1e(0x2c2)]+'\x20>>>\x20'+_0x144cc6[_0x327e1e(0x21b)]+_0x327e1e(0x27f)+_0x2dd04c[_0x327e1e(0x23a)]+'\x20==\x20'+_0x144cc6[_0x327e1e(0x23b)]),_0x2dd04c[_0x327e1e(0x227)]=Math[_0x327e1e(0x2d7)](0x0,Math['abs'](_0x2dd04c[_0x327e1e(0x227)])-Math['abs'](_0x144cc6['quantity']))));});return _0x4b7077;});Promise[_0x52baff(0x2b0)](_0x4f33a4)[_0x52baff(0x1e7)](async _0x2cd300=>{var _0x47f76c=_0x52baff;try{for(const _0x106cc5 of _0x2cd300){await _0x106cc5[_0x47f76c(0x20d)]();}_0x327434['finalize']='True';const _0x517930=await _0x327434[_0x47f76c(0x20d)](),_0x12e229=await master_shop[_0x47f76c(0x2e7)](),_0x41b038=await email_settings[_0x47f76c(0x286)](),_0x5a33d8=await supervisor_settings['find']();var _0x34d203=_0x327434[_0x47f76c(0x21d)],_0x2d8949='',_0x24d6d5;for(_0x24d6d5 in _0x34d203){var _0x200b1d='FG';_0x327434[_0x47f76c(0x258)]==_0x47f76c(0x249)&&(_0x200b1d='DG'),_0x2d8949+=_0x47f76c(0x2a2)+_0x47f76c(0x231)+_0x34d203[_0x24d6d5]['product_name']+_0x47f76c(0x267)+_0x47f76c(0x231)+_0x34d203[_0x24d6d5][_0x47f76c(0x1e1)]+_0x47f76c(0x267)+_0x47f76c(0x231)+_0x34d203[_0x24d6d5]['quantity']+_0x47f76c(0x267)+_0x47f76c(0x231)+_0x34d203[_0x24d6d5][_0x47f76c(0x260)]+_0x47f76c(0x267)+_0x47f76c(0x231)+_0x34d203[_0x24d6d5][_0x47f76c(0x28c)]+_0x47f76c(0x267)+_0x47f76c(0x231)+_0x327434[_0x47f76c(0x258)]+_0x47f76c(0x267)+_0x47f76c(0x231)+_0x34d203[_0x24d6d5][_0x47f76c(0x21b)]+_0x47f76c(0x267)+_0x47f76c(0x231)+_0x200b1d+_0x34d203[_0x24d6d5]['bay']+_0x47f76c(0x267);}let _0x3792d9=nodemailer[_0x47f76c(0x202)]({'host':_0x41b038[_0x47f76c(0x21c)],'port':Number(_0x41b038['port']),'secure':![],'auth':{'user':_0x41b038['email'],'pass':_0x41b038[_0x47f76c(0x215)]}}),_0x1ef264={'from':_0x41b038[_0x47f76c(0x2e4)],'to':_0x5a33d8[0x0][_0x47f76c(0x2b2)],'subject':_0x47f76c(0x283),'attachments':[{'filename':'Logo.png','path':__dirname+_0x47f76c(0x281)+_0x47f76c(0x1dc)+_0x12e229[0x0][_0x47f76c(0x235)],'cid':_0x47f76c(0x2d4)}],'html':'<!DOCTYPE\x20html>'+_0x47f76c(0x273)+_0x47f76c(0x219)+_0x47f76c(0x25e)+_0x47f76c(0x27e)+_0x47f76c(0x25e)+_0x47f76c(0x214)+_0x47f76c(0x1eb)+_0x47f76c(0x25e)+_0x47f76c(0x236)+_0x12e229[0x0][_0x47f76c(0x1df)]+_0x47f76c(0x2d9)+_0x47f76c(0x1eb)+_0x47f76c(0x1eb)+'<hr\x20class=\x22my-3\x22>'+_0x47f76c(0x25e)+_0x47f76c(0x29a)+_0x47f76c(0x297)+_0x327434[_0x47f76c(0x20c)]+'\x20'+_0x47f76c(0x2c6)+_0x47f76c(0x1d6)+_0x327434['date']+'\x20'+_0x47f76c(0x20b)+_0x47f76c(0x1fa)+_0x47f76c(0x1eb)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x47f76c(0x1ed)+_0x47f76c(0x2a2)+_0x47f76c(0x200)+_0x47f76c(0x2c5)+_0x47f76c(0x229)+_0x47f76c(0x2b3)+_0x47f76c(0x2d3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x47f76c(0x271)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x47f76c(0x2a1)+_0x47f76c(0x2af)+_0x47f76c(0x2ea)+'\x20'+_0x2d8949+'\x20'+_0x47f76c(0x1f9)+_0x47f76c(0x28b)+_0x47f76c(0x25e)+_0x47f76c(0x2db)+_0x47f76c(0x233)+_0x12e229[0x0][_0x47f76c(0x1df)]+'</h5>'+'</div>'+_0x47f76c(0x1eb)+'</body></html>'};_0x3792d9[_0x47f76c(0x1ef)](_0x1ef264,function(_0x484983,_0x1ddec5){var _0x1b280e=_0x47f76c;_0x484983?(console[_0x1b280e(0x1f5)](_0x484983),console['log']('Error\x20Occurs')):console[_0x1b280e(0x1f5)]('Email\x20sent\x20successfully');}),_0x146a08[_0x47f76c(0x2ad)](_0x47f76c(0x298),'Sales\x20Update\x20successfully'),_0x596401[_0x47f76c(0x2a6)](_0x47f76c(0x201)+_0x39207d);}catch(_0x135351){console['error'](_0x135351),_0x596401[_0x47f76c(0x1f0)](0x1f4)['json']({'error':_0x47f76c(0x2c1)});}})[_0x52baff(0x1e3)](_0x4dcca5=>{var _0x29fec8=_0x52baff;console[_0x29fec8(0x262)](_0x4dcca5),_0x596401[_0x29fec8(0x1f0)](0x1f4)[_0x29fec8(0x1d9)]({'error':_0x29fec8(0x2b6)});});}catch(_0x321744){console['log'](_0x321744);}}),router['get']('/view/:id',auth,async(_0x183a1e,_0x285ab3)=>{var _0x8f601e=a0_0xce787f;try{const {username:_0xef832e,email:_0x579a3f,role:_0x51f665}=_0x183a1e[_0x8f601e(0x23d)],_0x10508b=_0x183a1e[_0x8f601e(0x23d)],_0x353a7c=await profile[_0x8f601e(0x286)]({'email':_0x10508b[_0x8f601e(0x2e4)]}),_0x537f7a=await master_shop['find'](),_0x4d6f22=_0x183a1e[_0x8f601e(0x2a9)]['id'],_0xf6bb37=await sales_finished[_0x8f601e(0x210)](_0x4d6f22);let _0x1736da=new Date(_0xf6bb37['expiry_date']),_0x515bcf=('0'+_0x1736da[_0x8f601e(0x2c0)]())[_0x8f601e(0x2cf)](-0x2),_0x3e1157=('0'+(_0x1736da['getMonth']()+0x1))['slice'](-0x2),_0x394bd4=_0x1736da[_0x8f601e(0x272)](),_0x428cb2=_0x394bd4+'-'+_0x3e1157+'-'+_0x515bcf;var _0xd9b72c=['Ambient','Enclosed'];const _0x94e7ce=await warehouse[_0x8f601e(0x2a0)]([{'$match':{'name':_0xf6bb37[_0x8f601e(0x258)],'room':_0xf6bb37[_0x8f601e(0x1d4)]}},{'$unwind':_0x8f601e(0x24a)},{'$group':{'_id':_0x8f601e(0x292),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x8f601e(0x2a8)},'bay':{'$first':_0x8f601e(0x1e8)},'bin':{'$first':_0x8f601e(0x242)},'type':{'$first':_0x8f601e(0x27b)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x8f601e(0x274)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x8f601e(0x217)},'storage':{'$first':_0x8f601e(0x2ab)},'rack':{'$first':_0x8f601e(0x216)}}}]),_0x5e7035=await customer[_0x8f601e(0x2e7)]({});let _0x2a3aa4;if(_0x10508b['role']==_0x8f601e(0x1e9)){const _0x20535d=await staff['findOne']({'email':_0x10508b['email']});_0x2a3aa4=await warehouse[_0x8f601e(0x2a0)]([{'$match':{'status':'Enabled','name':_0x20535d[_0x8f601e(0x289)]}},{'$group':{'_id':_0x8f601e(0x279),'name':{'$first':_0x8f601e(0x279)}}}]);}else _0x2a3aa4=await warehouse['aggregate']([{'$match':{'status':_0x8f601e(0x2e5)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x441443=await product[_0x8f601e(0x2e7)]({});if(_0x537f7a[0x0][_0x8f601e(0x1ea)]=='English\x20(US)'){var _0x3ae33e=users[_0x8f601e(0x209)];console['log'](_0x3ae33e);}else{if(_0x537f7a[0x0]['language']==_0x8f601e(0x25d))var _0x3ae33e=users[_0x8f601e(0x25d)];else{if(_0x537f7a[0x0][_0x8f601e(0x1ea)]==_0x8f601e(0x259))var _0x3ae33e=users['German'];else{if(_0x537f7a[0x0]['language']=='Spanish')var _0x3ae33e=users['Spanish'];else{if(_0x537f7a[0x0][_0x8f601e(0x1ea)]==_0x8f601e(0x26d))var _0x3ae33e=users[_0x8f601e(0x26d)];else{if(_0x537f7a[0x0]['language']=='Portuguese\x20(BR)')var _0x3ae33e=users[_0x8f601e(0x269)];else{if(_0x537f7a[0x0]['language']==_0x8f601e(0x295))var _0x3ae33e=users['Chinese'];else{if(_0x537f7a[0x0][_0x8f601e(0x1ea)]=='Arabic\x20(ae)')var _0x3ae33e=users[_0x8f601e(0x2e1)];}}}}}}}_0x285ab3[_0x8f601e(0x2cb)](_0x8f601e(0x2d6),{'success':_0x183a1e[_0x8f601e(0x2ad)](_0x8f601e(0x298)),'errors':_0x183a1e['flash'](_0x8f601e(0x205)),'role':_0x10508b,'profile':_0x353a7c,'customer':_0x5e7035,'warehouse':_0x2a3aa4,'product':_0x94e7ce,'user':_0xf6bb37,'master_shop':_0x537f7a,'unit':_0x441443,'language':_0x3ae33e,'rooms_data':_0xd9b72c,'ed_fullDate':_0x428cb2});}catch(_0x1410ad){console[_0x8f601e(0x1f5)](_0x1410ad);}}),router[a0_0xce787f(0x2bd)](a0_0xce787f(0x2df),auth,async(_0x5c4adb,_0x2dbe10)=>{var _0x4f451c=a0_0xce787f;try{const _0x1d043c=_0x5c4adb[_0x4f451c(0x2a9)]['id'],_0x3ecdc7=await sales_finished['findOne']({'_id':_0x5c4adb[_0x4f451c(0x2a9)]['id']}),_0x728117=await warehouse[_0x4f451c(0x286)]({'name':_0x3ecdc7[_0x4f451c(0x258)],'room':_0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x1d4)],'warehouse_category':_0x4f451c(0x206)}),{invoice:_0x20d125,customer:_0x88781a,date:_0x352e24,warehouse_name:_0x29365c,product_name:_0x209ace,stock:_0x571f5b,adjust_qty:_0xf6fecc,note:_0x319f81,room:_0x332935,primary_code:_0x45934f,secondary_code:_0x138abd,prod_code:_0x2feb55,level:_0x40f709,isle:_0x4ff2ca,pallet:_0x45f341,expiry_date:_0x5add99}=_0x5c4adb[_0x4f451c(0x2e8)];if(typeof _0x209ace==_0x4f451c(0x278))var _0x39c6dc=[_0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x2cc)]],_0x151772=[_0x5c4adb['body']['stock']],_0x2d01e4=[_0x5c4adb['body'][_0x4f451c(0x1cf)]],_0x2eb7e9=[_0x5c4adb['body'][_0x4f451c(0x1e4)]],_0x104119=[_0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x28a)]],_0x288400=[_0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x2b9)]],_0x241bc4=[_0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x2c4)]],_0x2c71ac=[_0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x251)]];else var _0x39c6dc=[..._0x5c4adb[_0x4f451c(0x2e8)]['product_name']],_0x151772=[..._0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x22d)]],_0x2d01e4=[..._0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x1cf)]],_0x2eb7e9=[..._0x5c4adb[_0x4f451c(0x2e8)]['primary_code']],_0x104119=[..._0x5c4adb[_0x4f451c(0x2e8)]['secondary_code']],_0x288400=[..._0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x2b9)]],_0x241bc4=[..._0x5c4adb[_0x4f451c(0x2e8)]['level']],_0x2c71ac=[..._0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x251)]];const _0x1d51e0=_0x39c6dc['map'](_0x2447cb=>{return _0x2447cb={'product_name':_0x2447cb};});_0x151772[_0x4f451c(0x21e)]((_0x33bde5,_0x3ca97e)=>{var _0x3f6389=_0x4f451c;_0x1d51e0[_0x3ca97e][_0x3f6389(0x22d)]=_0x33bde5;}),_0x2d01e4[_0x4f451c(0x21e)]((_0x2a17d6,_0x4b73ee)=>{var _0x410b39=_0x4f451c;_0x1d51e0[_0x4b73ee][_0x410b39(0x2c2)]=_0x2a17d6;}),_0x2eb7e9[_0x4f451c(0x21e)]((_0x170d05,_0x29de1a)=>{var _0x248252=_0x4f451c;_0x1d51e0[_0x29de1a][_0x248252(0x1e4)]=_0x170d05;}),_0x104119[_0x4f451c(0x21e)]((_0x1fe48d,_0x4ce57f)=>{var _0x48c63a=_0x4f451c;_0x1d51e0[_0x4ce57f][_0x48c63a(0x28a)]=_0x1fe48d;}),_0x288400['forEach']((_0x55508f,_0xffd2ee)=>{var _0x1609d6=_0x4f451c;_0x1d51e0[_0xffd2ee][_0x1609d6(0x1e1)]=_0x55508f;}),_0x241bc4['forEach']((_0x5be4f3,_0x380a96)=>{_0x1d51e0[_0x380a96]['level']=_0x5be4f3;}),_0x2c71ac['forEach']((_0x55e717,_0x5496f7)=>{var _0x45aa8f=_0x4f451c;_0x1d51e0[_0x5496f7][_0x45aa8f(0x251)]=_0x55e717;});var _0x3633d4=0x0;_0x1d51e0[_0x4f451c(0x21e)](_0x58a165=>{var _0x2c6ada=_0x4f451c;console['log'](_0x2c6ada(0x230),_0x58a165),(parseInt(_0x58a165[_0x2c6ada(0x22d)])<parseInt(_0x58a165[_0x2c6ada(0x2c2)])||parseInt(_0x58a165[_0x2c6ada(0x2c2)])==0x0)&&_0x3633d4++;});if(_0x3633d4!=0x0)return _0x5c4adb[_0x4f451c(0x2ad)](_0x4f451c(0x205),_0x4f451c(0x275)),_0x2dbe10['redirect'](_0x4f451c(0x254));_0x3ecdc7[_0x4f451c(0x21d)]['forEach'](_0x2834d9=>{var _0x10fe40=_0x4f451c;const _0x58e8dc=_0x728117[_0x10fe40(0x26f)][_0x10fe40(0x239)](_0x196db2=>{var _0x491fe7=_0x10fe40;_0x196db2[_0x491fe7(0x2cc)]==_0x2834d9[_0x491fe7(0x2cc)]&&_0x196db2[_0x491fe7(0x203)]==_0x2834d9[_0x491fe7(0x203)]&&(_0x196db2[_0x491fe7(0x227)]=parseInt(_0x196db2[_0x491fe7(0x227)])+parseInt(_0x2834d9[_0x491fe7(0x2c2)]));});}),await _0x728117[_0x4f451c(0x20d)]();const _0x5baaf8=_0x1d51e0[_0x4f451c(0x232)](_0x428fd5=>_0x428fd5['quantity']!=='0'&&_0x428fd5[_0x4f451c(0x2c2)]!=='');_0x3ecdc7['invoice']=_0x20d125,_0x3ecdc7[_0x4f451c(0x211)]=_0x88781a,_0x3ecdc7[_0x4f451c(0x2b5)]=_0x352e24,_0x3ecdc7['warehouse_name']=_0x29365c,_0x3ecdc7[_0x4f451c(0x21d)]=_0x5baaf8,_0x3ecdc7[_0x4f451c(0x299)]=_0x319f81,_0x3ecdc7[_0x4f451c(0x1d4)]=_0x332935;const _0x238e57=await _0x3ecdc7[_0x4f451c(0x20d)](),_0x57671a=await sales_finished[_0x4f451c(0x286)]({'_id':_0x5c4adb[_0x4f451c(0x2a9)]['id']}),_0x1d5fc5=await warehouse[_0x4f451c(0x286)]({'name':_0x29365c,'room':_0x332935,'warehouse_category':_0x4f451c(0x206)});_0x57671a[_0x4f451c(0x21d)][_0x4f451c(0x21e)](_0x666d0f=>{var _0xc0fd3f=_0x4f451c;const _0x34d568=_0x1d5fc5['product_details'][_0xc0fd3f(0x239)](_0xdd7ea4=>{var _0x14a7c0=_0xc0fd3f;_0xdd7ea4[_0x14a7c0(0x2cc)]==_0x666d0f[_0x14a7c0(0x2cc)]&&_0xdd7ea4['bay']==_0x666d0f[_0x14a7c0(0x203)]&&(_0xdd7ea4['product_stock']=parseInt(_0xdd7ea4['product_stock'])-parseInt(_0x666d0f[_0x14a7c0(0x2c2)]));});}),console[_0x4f451c(0x1f5)](_0x4f451c(0x207),_0x1d5fc5),await _0x1d5fc5[_0x4f451c(0x20d)]();const _0x192eb3=await c_payment_data[_0x4f451c(0x286)]({'invoice':_0x5c4adb[_0x4f451c(0x2e8)][_0x4f451c(0x20c)]});_0x192eb3['suppliers']=_0x5c4adb['body'][_0x4f451c(0x2ac)],await _0x192eb3[_0x4f451c(0x20d)](),_0x5c4adb['flash'](_0x4f451c(0x298),_0x4f451c(0x280)),_0x2dbe10[_0x4f451c(0x2a6)](_0x4f451c(0x1f8));}catch(_0x110659){console['log'](_0x110659);}}),router['post'](a0_0xce787f(0x22b),auth,async(_0x2e255c,_0x4eb0a0)=>{var _0x576f30=a0_0xce787f;try{const _0x333a68=_0x2e255c['params']['id'],{invoice:_0x4abb82,customer:_0x1eaad5,receivable_amount:_0x55f519,received_amount:_0xac6448}=_0x2e255c['body'],_0x44cee6=await sales['findById'](_0x333a68);console[_0x576f30(0x1f5)](_0x44cee6);var _0x48f1bc=_0x55f519-_0xac6448;console['log'](_0xac6448),_0x44cee6[_0x576f30(0x23f)]=parseFloat(_0xac6448)+parseFloat(_0x44cee6['received_amount']),_0x44cee6[_0x576f30(0x225)]=_0x48f1bc,console['log'](_0x44cee6);const _0x156acd=await _0x44cee6[_0x576f30(0x20d)](),_0x25125a=await c_payment_data[_0x576f30(0x286)]({'invoice':_0x4abb82});_0x25125a[_0x576f30(0x2ca)]=_0x48f1bc,await _0x25125a[_0x576f30(0x20d)]();let _0x152091=new Date(),_0x276bbf=('0'+_0x152091[_0x576f30(0x2c0)]())[_0x576f30(0x2cf)](-0x2),_0x56c0bd=('0'+(_0x152091[_0x576f30(0x2bf)]()+0x1))[_0x576f30(0x2cf)](-0x2),_0x53eda2=_0x152091[_0x576f30(0x272)](),_0x9e8d93=_0x53eda2+'-'+_0x56c0bd+'-'+_0x276bbf;const _0xe433dd=new customer_payment({'invoice':_0x4abb82,'date':_0x53eda2+'-'+_0x56c0bd+'-'+_0x276bbf,'customer':_0x1eaad5,'reason':_0x576f30(0x2d0),'amount':_0xac6448}),_0x42e78d=await _0xe433dd[_0x576f30(0x20d)]();_0x2e255c['flash'](_0x576f30(0x298),_0x576f30(0x25c)),_0x4eb0a0[_0x576f30(0x2a6)](_0x576f30(0x2e3));}catch(_0x1e0609){console[_0x576f30(0x1f5)](_0x1e0609);}}),router[a0_0xce787f(0x2d2)](a0_0xce787f(0x250),auth,async(_0x3b9f18,_0x4fc6a6)=>{var _0x2c04d2=a0_0xce787f;try{const {username:_0x129966,email:_0x15cb1a,role:_0x94f5c2}=_0x3b9f18[_0x2c04d2(0x23d)],_0xf235ab=_0x3b9f18[_0x2c04d2(0x23d)],_0xc66d02=await profile[_0x2c04d2(0x286)]({'email':_0xf235ab[_0x2c04d2(0x2e4)]}),_0x11c681=await master_shop[_0x2c04d2(0x2e7)]();console['log']('master',_0x11c681);const _0x2fcf79=_0x3b9f18[_0x2c04d2(0x2a9)]['id'],_0x52667e=await sales[_0x2c04d2(0x210)](_0x2fcf79);console['log'](_0x52667e);const _0x2e240f=await customer[_0x2c04d2(0x286)]({'name':_0x52667e['customer']});console[_0x2c04d2(0x1f5)](_0x2e240f);if(_0x11c681[0x0]['language']==_0x2c04d2(0x2a3)){var _0x1f77cc=users[_0x2c04d2(0x209)];console[_0x2c04d2(0x1f5)](_0x1f77cc);}else{if(_0x11c681[0x0][_0x2c04d2(0x1ea)]==_0x2c04d2(0x25d))var _0x1f77cc=users[_0x2c04d2(0x25d)];else{if(_0x11c681[0x0][_0x2c04d2(0x1ea)]==_0x2c04d2(0x259))var _0x1f77cc=users['German'];else{if(_0x11c681[0x0][_0x2c04d2(0x1ea)]==_0x2c04d2(0x290))var _0x1f77cc=users[_0x2c04d2(0x290)];else{if(_0x11c681[0x0]['language']==_0x2c04d2(0x26d))var _0x1f77cc=users[_0x2c04d2(0x26d)];else{if(_0x11c681[0x0][_0x2c04d2(0x1ea)]=='Portuguese\x20(BR)')var _0x1f77cc=users[_0x2c04d2(0x269)];else{if(_0x11c681[0x0][_0x2c04d2(0x1ea)]==_0x2c04d2(0x295))var _0x1f77cc=users[_0x2c04d2(0x295)];else{if(_0x11c681[0x0][_0x2c04d2(0x1ea)]==_0x2c04d2(0x1ee))var _0x1f77cc=users[_0x2c04d2(0x2e1)];}}}}}}}_0x4fc6a6[_0x2c04d2(0x2cb)](_0x2c04d2(0x221),{'success':_0x3b9f18['flash']('success'),'errors':_0x3b9f18[_0x2c04d2(0x2ad)]('errors'),'role':_0xf235ab,'profile':_0xc66d02,'master_shop':_0x11c681,'customers':_0x2e240f,'sales':_0x52667e,'language':_0x1f77cc});}catch(_0x5790f9){console[_0x2c04d2(0x1f5)](_0x5790f9);}}),router['get']('/view/return_sales/:id',auth,async(_0x1349f8,_0x4fc39b)=>{var _0x3b7f7c=a0_0xce787f;try{const {username:_0x1a295d,email:_0x14f762,role:_0x38e96a}=_0x1349f8[_0x3b7f7c(0x23d)],_0x2b609f=_0x1349f8['user'],_0xd6d8e7=await profile['findOne']({'email':_0x2b609f[_0x3b7f7c(0x2e4)]}),_0x2c7dc9=await master_shop[_0x3b7f7c(0x2e7)](),_0x25c7cc=_0x1349f8['params']['id'],_0xc7ff87=await sales_finished['findById'](_0x25c7cc),_0x15b108=await warehouse[_0x3b7f7c(0x2a0)]([{'$match':{'name':_0xc7ff87[_0x3b7f7c(0x258)]}},{'$unwind':_0x3b7f7c(0x24a)},{'$group':{'_id':_0x3b7f7c(0x292),'name':{'$first':_0x3b7f7c(0x22c)},'product_stock':{'$first':_0x3b7f7c(0x2a8)},'bay':{'$first':_0x3b7f7c(0x1e8)},'bin':{'$first':_0x3b7f7c(0x242)},'type':{'$first':_0x3b7f7c(0x27b)},'floorlevel':{'$first':_0x3b7f7c(0x2dd)},'primary_code':{'$first':_0x3b7f7c(0x274)},'secondary_code':{'$first':_0x3b7f7c(0x2e2)},'product_code':{'$first':_0x3b7f7c(0x217)},'storage':{'$first':_0x3b7f7c(0x2ab)},'rack':{'$first':_0x3b7f7c(0x216)},'expiry_date':{'$first':_0x3b7f7c(0x20a)},'production_date':{'$first':_0x3b7f7c(0x2b7)},'unit':{'$first':_0x3b7f7c(0x270)},'secondary_unit':{'$first':_0x3b7f7c(0x1d1)},'maxProducts':{'$first':_0x3b7f7c(0x293)},'batch_code':{'$first':_0x3b7f7c(0x1f1)},'maxPerUnit':{'$first':_0x3b7f7c(0x246)}}}]),_0x59e99a=await product[_0x3b7f7c(0x2e7)]({}),_0x1ce695=await warehouse[_0x3b7f7c(0x2a0)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':'Return\x20Goods','$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0x3b7f7c(0x279),'name':{'$first':_0x3b7f7c(0x279)}}},{'$sort':{'name':0x1}}]);var _0x5144f5=[_0x3b7f7c(0x287)];const _0x5dc7ec=await warehouse[_0x3b7f7c(0x2a0)]([{'$match':{'status':'Enabled','name':_0x3b7f7c(0x1f4)}},{'$group':{'_id':_0x3b7f7c(0x279),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x2c7dc9[0x0]['language']==_0x3b7f7c(0x2a3)){var _0x2e137c=users[_0x3b7f7c(0x209)];console[_0x3b7f7c(0x1f5)](_0x2e137c);}else{if(_0x2c7dc9[0x0][_0x3b7f7c(0x1ea)]==_0x3b7f7c(0x25d))var _0x2e137c=users['Hindi'];else{if(_0x2c7dc9[0x0][_0x3b7f7c(0x1ea)]==_0x3b7f7c(0x259))var _0x2e137c=users['German'];else{if(_0x2c7dc9[0x0][_0x3b7f7c(0x1ea)]==_0x3b7f7c(0x290))var _0x2e137c=users['Spanish'];else{if(_0x2c7dc9[0x0][_0x3b7f7c(0x1ea)]==_0x3b7f7c(0x26d))var _0x2e137c=users['French'];else{if(_0x2c7dc9[0x0]['language']=='Portuguese\x20(BR)')var _0x2e137c=users[_0x3b7f7c(0x269)];else{if(_0x2c7dc9[0x0][_0x3b7f7c(0x1ea)]==_0x3b7f7c(0x295))var _0x2e137c=users[_0x3b7f7c(0x295)];else{if(_0x2c7dc9[0x0][_0x3b7f7c(0x1ea)]==_0x3b7f7c(0x1ee))var _0x2e137c=users[_0x3b7f7c(0x2e1)];}}}}}}}_0x4fc39b[_0x3b7f7c(0x2cb)](_0x3b7f7c(0x2a4),{'success':_0x1349f8['flash'](_0x3b7f7c(0x298)),'errors':_0x1349f8[_0x3b7f7c(0x2ad)](_0x3b7f7c(0x205)),'role':_0x2b609f,'profile':_0xd6d8e7,'user':_0xc7ff87,'stock':_0x15b108,'master_shop':_0x2c7dc9,'unit':_0x59e99a,'language':_0x2e137c,'warehouses':_0x1ce695,'rooms':_0x5144f5,'warehouse_QA':_0x5dc7ec});}catch(_0x7082af){console['log'](_0x7082af),_0x4fc39b[_0x3b7f7c(0x1f0)](0xc8)[_0x3b7f7c(0x1d9)]({'message':_0x7082af['message']});}}),router[a0_0xce787f(0x2bd)](a0_0xce787f(0x2ce),auth,async(_0x32544f,_0x3ef176)=>{var _0x491bb0=a0_0xce787f;if(_0x32544f['body']['for_categorize']=='QA')try{const {invoice:_0x2a155c,date:_0x3f25a7,warehouse_name:_0x57808b,product_name:_0x4fe996,primary_code:_0x13cfc7,secondary_code:_0x31f189,product_code:_0x24a0ad,sales_quantity:_0xdd8442,stocks:_0x27ae95,return_qty:_0x34955f,Room_name:_0x9da68c,to_warehouse_name_QA:_0x4a7b06,to_Room_name_QA:_0x2a8532,note:_0x18acaa,for_categorize:_0xb7c202,product_name_QA1:_0x5e7ebe}=_0x32544f['body'];if(typeof _0x5e7ebe==_0x491bb0(0x278))var _0x1cfba7=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x24e)]],_0x10f82f=[_0x32544f[_0x491bb0(0x2e8)]['primary_code_QA']],_0x37c4ba=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x29f)]],_0x4bb723=[_0x32544f[_0x491bb0(0x2e8)]['product_code_QA']],_0x274a81=[_0x32544f['body'][_0x491bb0(0x2e0)]],_0x432eb1=[_0x32544f[_0x491bb0(0x2e8)]['stocks_QA']],_0x400f84=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x238)]],_0x33d40c=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x2a7)]],_0x4bb6e9=[_0x32544f['body'][_0x491bb0(0x25a)]],_0x24b76b=[_0x32544f['body']['batch_code_QA']],_0x12d4fc=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x256)]],_0xf44f5f=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x27d)]],_0x118e8a=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x2da)]],_0xfce0e4=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x226)]];else var _0x1cfba7=[..._0x32544f['body'][_0x491bb0(0x24e)]],_0x10f82f=[..._0x32544f[_0x491bb0(0x2e8)]['primary_code_QA']],_0x37c4ba=[..._0x32544f[_0x491bb0(0x2e8)]['secondary_code_QA']],_0x4bb723=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x24f)]],_0x274a81=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x2e0)]],_0x432eb1=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x2be)]],_0x400f84=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x238)]],_0x33d40c=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x2a7)]],_0x4bb6e9=[..._0x32544f['body'][_0x491bb0(0x25a)]],_0x24b76b=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x1d0)]],_0x12d4fc=[..._0x32544f['body'][_0x491bb0(0x256)]],_0xf44f5f=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x27d)]],_0x118e8a=[..._0x32544f[_0x491bb0(0x2e8)]['production_date_QA']],_0xfce0e4=[..._0x32544f[_0x491bb0(0x2e8)]['expiry_date_QA']];const _0x54c84c=_0x1cfba7[_0x491bb0(0x239)](_0x4d1090=>{return _0x4d1090={'product_name':_0x4d1090};});_0x10f82f[_0x491bb0(0x21e)]((_0x29e974,_0x4bfd79)=>{var _0x5b5a6a=_0x491bb0;_0x54c84c[_0x4bfd79][_0x5b5a6a(0x1e4)]=_0x29e974;}),_0x37c4ba['forEach']((_0x563fac,_0x1a4a1f)=>{_0x54c84c[_0x1a4a1f]['secondary_code']=_0x563fac;}),_0x4bb723['forEach']((_0x28fb60,_0x471f53)=>{var _0x17109a=_0x491bb0;_0x54c84c[_0x471f53][_0x17109a(0x1e1)]=_0x28fb60;}),_0x274a81[_0x491bb0(0x21e)]((_0x25775d,_0xc7a355)=>{var _0x275e8b=_0x491bb0;_0x54c84c[_0xc7a355][_0x275e8b(0x1ff)]=_0x25775d;}),_0x432eb1[_0x491bb0(0x21e)]((_0x307f6d,_0x153002)=>{var _0x13aba4=_0x491bb0;_0x54c84c[_0x153002][_0x13aba4(0x22d)]=_0x307f6d;}),_0x400f84[_0x491bb0(0x21e)]((_0x276d28,_0x2e2864)=>{_0x54c84c[_0x2e2864]['return_qty']=_0x276d28;}),_0x33d40c[_0x491bb0(0x21e)]((_0x2a1af9,_0xe77e6f)=>{var _0x45f0a4=_0x491bb0;_0x54c84c[_0xe77e6f][_0x45f0a4(0x2e9)]=_0x2a1af9;}),_0x4bb6e9['forEach']((_0xf85ca0,_0x58fb57)=>{var _0x1c6063=_0x491bb0;_0x54c84c[_0x58fb57][_0x1c6063(0x22e)]=_0xf85ca0;}),_0x24b76b['forEach']((_0x17d75e,_0x3b7390)=>{var _0x3632f8=_0x491bb0;_0x54c84c[_0x3b7390][_0x3632f8(0x28f)]=_0x17d75e;}),_0x12d4fc[_0x491bb0(0x21e)]((_0x4d980d,_0x469980)=>{var _0x15bab8=_0x491bb0;_0x54c84c[_0x469980][_0x15bab8(0x28c)]=_0x4d980d;}),_0xf44f5f[_0x491bb0(0x21e)]((_0x2c8480,_0x33bb84)=>{_0x54c84c[_0x33bb84]['unit']=_0x2c8480;}),_0x118e8a[_0x491bb0(0x21e)]((_0x59e497,_0xe25f30)=>{var _0x4e4702=_0x491bb0;_0x54c84c[_0xe25f30][_0x4e4702(0x1e6)]=_0x59e497;}),_0xfce0e4['forEach']((_0x3f860b,_0xc3bad6)=>{var _0x22e9ff=_0x491bb0;_0x54c84c[_0xc3bad6][_0x22e9ff(0x251)]=_0x3f860b;});const _0x1b7ffb=await sales_finished[_0x491bb0(0x286)]({'invoice':_0x2a155c});_0x1b7ffb['return_data']=_0x491bb0(0x220);const _0x30ea59=await _0x1b7ffb[_0x491bb0(0x20d)](),_0x24825a=new sales_return_finished({'invoice':_0x2a155c,'customer':_0x32544f[_0x491bb0(0x2e8)]['customer'],'date':_0x3f25a7,'warehouse_name':_0x57808b,'room':_0x9da68c,'ToWarehouse':_0x4a7b06,'ToRoom':_0x2a8532,'return_sale_QA':_0x54c84c,'note':_0x18acaa,'warehouse_cat':_0xb7c202}),_0x3670dd=await _0x24825a[_0x491bb0(0x20d)](),_0x12e7cd=await sales_return_finished['findOne']({'invoice':_0x2a155c}),_0x918d78=await warehouse[_0x491bb0(0x286)]({'name':_0x4a7b06,'room':_0x2a8532});_0x12e7cd[_0x491bb0(0x1e2)][_0x491bb0(0x21e)](_0x1a7062=>{var _0x207b08=_0x491bb0,_0x1ad98f=0x0;const _0x129d9b=_0x918d78[_0x207b08(0x26f)][_0x207b08(0x239)](_0x20ec5b=>{var _0x3f02b5=_0x207b08;_0x20ec5b[_0x3f02b5(0x2cc)]==_0x1a7062[_0x3f02b5(0x2cc)]&&_0x20ec5b[_0x3f02b5(0x251)]==_0x1a7062[_0x3f02b5(0x251)]&&_0x20ec5b[_0x3f02b5(0x1e6)]==_0x1a7062[_0x3f02b5(0x1e6)]&&_0x20ec5b[_0x3f02b5(0x28f)]==_0x1a7062[_0x3f02b5(0x28f)]&&(_0x20ec5b['product_stock']=parseInt(_0x20ec5b['product_stock'])+parseInt(_0x1a7062[_0x3f02b5(0x24b)]),_0x1ad98f++);});_0x1ad98f=='0'&&(_0x918d78[_0x207b08(0x26f)]=_0x918d78[_0x207b08(0x26f)][_0x207b08(0x2b4)]({'product_name':_0x1a7062[_0x207b08(0x2cc)],'product_stock':_0x1a7062[_0x207b08(0x24b)],'primary_code':_0x1a7062['primary_code'],'secondary_code':_0x1a7062[_0x207b08(0x28a)],'product_code':_0x1a7062[_0x207b08(0x1e1)],'batch_code':_0x1a7062['batch_code'],'maxPerUnit':_0x1a7062[_0x207b08(0x2e9)],'production_date':_0x1a7062['production_date'],'expiry_date':_0x1a7062[_0x207b08(0x251)],'secondary_unit':_0x1a7062['secondary_unit'],'unit':_0x1a7062['unit'],'maxProducts':_0x1a7062[_0x207b08(0x22e)],'bay':_0x1a7062['bay']}));}),await _0x918d78['save']();const _0x1fbe31=new c_payment_data({'invoice':_0x2a155c,'customer':_0x32544f[_0x491bb0(0x2e8)]['customer'],'reason':_0x491bb0(0x1fd)});await _0x1fbe31[_0x491bb0(0x20d)]();const _0xe7bd6b=await master_shop['find'](),_0x5a2961=await email_settings[_0x491bb0(0x286)](),_0x35c2d7=await customer['findOne']({'name':_0x32544f[_0x491bb0(0x2e8)]['customer']});_0xe7bd6b[0x0][_0x491bb0(0x24c)]==0x1?(right_currency=_0xe7bd6b[0x0][_0x491bb0(0x212)],left_currency=''):(right_currency='',left_currency=_0xe7bd6b[0x0][_0x491bb0(0x212)]);var _0x2ff023=_0x1cfba7,_0x54cfd1=_0x400f84,_0x499c88='',_0x2c07c9;for(_0x2c07c9 in _0x2ff023){_0x499c88+=_0x491bb0(0x2a2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2ff023[_0x2c07c9]+_0x491bb0(0x267)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x54cfd1[_0x2c07c9]+_0x491bb0(0x267)+_0x491bb0(0x2a1);}console[_0x491bb0(0x1f5)](_0x491bb0(0x252),_0x499c88);let _0x47c23c=nodemailer[_0x491bb0(0x202)]({'service':'gmail','auth':{'user':_0x5a2961['email'],'pass':_0x5a2961[_0x491bb0(0x215)]}}),_0x4c311e={'from':_0x5a2961[_0x491bb0(0x2e4)],'to':_0x35c2d7[_0x491bb0(0x2e4)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x491bb0(0x281)+_0x491bb0(0x1dc)+_0xe7bd6b[0x0][_0x491bb0(0x235)],'cid':_0x491bb0(0x2d4)}],'html':'<!DOCTYPE\x20html>'+_0x491bb0(0x273)+_0x491bb0(0x219)+_0x491bb0(0x25e)+_0x491bb0(0x27e)+_0x491bb0(0x25e)+_0x491bb0(0x214)+'</div>'+_0x491bb0(0x25e)+_0x491bb0(0x236)+_0xe7bd6b[0x0][_0x491bb0(0x1df)]+_0x491bb0(0x2d9)+_0x491bb0(0x1eb)+_0x491bb0(0x1eb)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x491bb0(0x29a)+_0x491bb0(0x297)+_0x2a155c+'\x20'+_0x491bb0(0x2c6)+'\x20Order\x20Date\x20:\x20'+_0x3f25a7+'\x20'+_0x491bb0(0x20b)+'</h5>'+'</div>'+_0x491bb0(0x1f3)+_0x491bb0(0x1ed)+_0x491bb0(0x2a2)+_0x491bb0(0x200)+_0x491bb0(0x1fc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x491bb0(0x2c8)+_0x491bb0(0x2a1)+_0x491bb0(0x2af)+_0x491bb0(0x2ea)+'\x20'+_0x499c88+'\x20'+_0x491bb0(0x1f9)+_0x491bb0(0x28b)+_0x491bb0(0x25e)+'<strong>\x20Regards\x20</strong>'+_0x491bb0(0x233)+_0xe7bd6b[0x0][_0x491bb0(0x1df)]+'</h5>'+_0x491bb0(0x1eb)+'</div>'+_0x491bb0(0x2a5)};_0x47c23c[_0x491bb0(0x1ef)](_0x4c311e,function(_0x3b2413,_0x226109){var _0x44b69c=_0x491bb0;_0x3b2413?(console[_0x44b69c(0x1f5)](_0x3b2413),console[_0x44b69c(0x1f5)](_0x44b69c(0x237))):console[_0x44b69c(0x1f5)](_0x44b69c(0x1d7));}),_0x32544f['flash'](_0x491bb0(0x298),_0x491bb0(0x1f2)),_0x3ef176[_0x491bb0(0x2a6)](_0x491bb0(0x1f8));}catch(_0x4e4fe7){_0x3ef176[_0x491bb0(0x1f0)](0xc8)[_0x491bb0(0x1d9)]({'message1':_0x4e4fe7[_0x491bb0(0x2bb)]});}else{if(_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x1d8)]=='GS')try{const {invoice:_0x1489f9,date:_0x126d2b,warehouse_name:_0x47b8e2,product_name:_0x1a95eb,primary_code:_0xaf5b16,secondary_code:_0x25fb5d,product_code:_0x586acb,sales_quantity:_0x38601c,stocks:_0xaa6da3,return_qty:_0x2169a9,Room_name:_0x5646af,to_warehouse_name:_0x3f0526,to_Room_name:_0xf54f72,note:_0x569536,level:_0x3922c7,isle:_0x292caa,pallet:_0x341757,for_categorize:_0x2144a2}=_0x32544f[_0x491bb0(0x2e8)];if(typeof _0x1a95eb==_0x491bb0(0x278))var _0x1cfba7=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x2cc)]],_0x10f82f=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x1e4)]],_0x37c4ba=[_0x32544f['body']['secondary_code']],_0x4bb723=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x1e1)]],_0x274a81=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x2ba)]],_0x400f84=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x24b)]],_0x434009=[_0x32544f[_0x491bb0(0x2e8)]['bay']],_0x33d40c=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x2e9)]],_0x4bb6e9=[_0x32544f[_0x491bb0(0x2e8)]['maxProducts']],_0x24b76b=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x28f)]],_0x12d4fc=[_0x32544f[_0x491bb0(0x2e8)]['secondary_unit']],_0xf44f5f=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x260)]],_0x118e8a=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x1e6)]],_0xfce0e4=[_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x251)]];else var _0x1cfba7=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x2cc)]],_0x10f82f=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x1e4)]],_0x37c4ba=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x28a)]],_0x4bb723=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x1e1)]],_0x274a81=[..._0x32544f['body'][_0x491bb0(0x2ba)]],_0x400f84=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x24b)]],_0x434009=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x203)]],_0x33d40c=[..._0x32544f['body']['maxPerUnit']],_0x4bb6e9=[..._0x32544f['body'][_0x491bb0(0x22e)]],_0x24b76b=[..._0x32544f['body'][_0x491bb0(0x28f)]],_0x12d4fc=[..._0x32544f['body'][_0x491bb0(0x28c)]],_0xf44f5f=[..._0x32544f[_0x491bb0(0x2e8)]['unit']],_0x118e8a=[..._0x32544f['body'][_0x491bb0(0x1e6)]],_0xfce0e4=[..._0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x251)]];const _0x50fdc2=_0x1cfba7['map'](_0xa98291=>{return _0xa98291={'product_name':_0xa98291};});_0x10f82f[_0x491bb0(0x21e)]((_0x13618c,_0x2ccd4a)=>{var _0x4696a2=_0x491bb0;_0x50fdc2[_0x2ccd4a][_0x4696a2(0x1e4)]=_0x13618c;}),_0x37c4ba[_0x491bb0(0x21e)]((_0x56524c,_0x3a3383)=>{_0x50fdc2[_0x3a3383]['secondary_code']=_0x56524c;}),_0x4bb723[_0x491bb0(0x21e)]((_0x5c7a3d,_0x46d03f)=>{var _0x4c90d9=_0x491bb0;_0x50fdc2[_0x46d03f][_0x4c90d9(0x1e1)]=_0x5c7a3d;}),_0x274a81[_0x491bb0(0x21e)]((_0x7598,_0xbee5ad)=>{var _0x3613ed=_0x491bb0;_0x50fdc2[_0xbee5ad][_0x3613ed(0x1ff)]=_0x7598;}),_0x400f84[_0x491bb0(0x21e)]((_0x41393a,_0xe2c70c)=>{var _0x22984e=_0x491bb0;_0x50fdc2[_0xe2c70c][_0x22984e(0x24b)]=_0x41393a;}),_0x434009[_0x491bb0(0x21e)]((_0x130dc2,_0xd57ba6)=>{var _0x4b7ddb=_0x491bb0;_0x50fdc2[_0xd57ba6][_0x4b7ddb(0x203)]=_0x130dc2;}),_0x33d40c[_0x491bb0(0x21e)]((_0x398f34,_0xbac78e)=>{var _0x47fd9e=_0x491bb0;_0x50fdc2[_0xbac78e][_0x47fd9e(0x2e9)]=_0x398f34;}),_0x4bb6e9['forEach']((_0x514c88,_0x5c46d5)=>{var _0xba3ddd=_0x491bb0;_0x50fdc2[_0x5c46d5][_0xba3ddd(0x22e)]=_0x514c88;}),_0x24b76b[_0x491bb0(0x21e)]((_0x7b1c9,_0x2126ab)=>{var _0x4959f6=_0x491bb0;_0x50fdc2[_0x2126ab][_0x4959f6(0x28f)]=_0x7b1c9;}),_0x12d4fc['forEach']((_0x1b70e9,_0x5eacd9)=>{_0x50fdc2[_0x5eacd9]['secondary_unit']=_0x1b70e9;}),_0xf44f5f[_0x491bb0(0x21e)]((_0x200111,_0xd74e90)=>{var _0x3f4bd4=_0x491bb0;_0x50fdc2[_0xd74e90][_0x3f4bd4(0x260)]=_0x200111;}),_0x118e8a[_0x491bb0(0x21e)]((_0x505b57,_0x234fb7)=>{_0x50fdc2[_0x234fb7]['production_date']=_0x505b57;}),_0xfce0e4[_0x491bb0(0x21e)]((_0x1a6eff,_0x50786c)=>{var _0x4404f1=_0x491bb0;_0x50fdc2[_0x50786c][_0x4404f1(0x251)]=_0x1a6eff;});var _0x421808=0x0;_0x50fdc2[_0x491bb0(0x21e)](_0xbc3f97=>{var _0x48bae9=_0x491bb0;(parseInt(_0xbc3f97['sale_qty'])<parseInt(_0xbc3f97[_0x48bae9(0x24b)])||parseInt(_0xbc3f97['stock'])<parseInt(_0xbc3f97['return_qty'])&&parseInt(_0xbc3f97[_0x48bae9(0x1ff)])>parseInt(_0xbc3f97[_0x48bae9(0x24b)])||parseInt(_0xbc3f97[_0x48bae9(0x24b)])==0x0)&&_0x421808++;});if(_0x421808!=0x0)return _0x32544f['flash'](_0x491bb0(0x205),_0x491bb0(0x1dd)),_0x3ef176[_0x491bb0(0x2a6)](_0x491bb0(0x254));const _0x307679=await sales_finished[_0x491bb0(0x286)]({'invoice':_0x1489f9});_0x307679['return_data']=_0x491bb0(0x220);const _0x4b2343=await _0x307679['save'](),_0x1d256b=new sales_return_finished({'invoice':_0x1489f9,'customer':_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x211)],'date':_0x126d2b,'warehouse_name':_0x47b8e2,'room':_0x5646af,'ToWarehouse':_0x3f0526,'ToRoom':_0xf54f72,'return_sale':_0x50fdc2,'note':_0x569536,'warehouse_cat':_0x2144a2}),_0x4b461d=await _0x1d256b[_0x491bb0(0x20d)](),_0x5cc258=await sales_return_finished[_0x491bb0(0x286)]({'invoice':_0x1489f9}),_0x21a25d=await warehouse[_0x491bb0(0x286)]({'name':_0x3f0526,'room':_0xf54f72,'warehouse_category':_0x491bb0(0x206)});_0x5cc258[_0x491bb0(0x228)][_0x491bb0(0x21e)](_0x3838d2=>{var _0x5185bb=_0x491bb0,_0x313b91=0x0;const _0x23c15f=_0x21a25d[_0x5185bb(0x26f)][_0x5185bb(0x239)](_0x1c13e4=>{var _0x4567f5=_0x5185bb;_0x1c13e4[_0x4567f5(0x2cc)]==_0x3838d2[_0x4567f5(0x2cc)]&&_0x1c13e4['bay']==_0x3838d2[_0x4567f5(0x203)]&&_0x1c13e4['expiry_date']==_0x3838d2[_0x4567f5(0x251)]&&_0x1c13e4['production_date']==_0x3838d2[_0x4567f5(0x1e6)]&&_0x1c13e4['batch_code']==_0x3838d2['batch_code']&&(_0x1c13e4[_0x4567f5(0x227)]=parseInt(_0x1c13e4[_0x4567f5(0x227)])+parseInt(_0x3838d2[_0x4567f5(0x24b)]),_0x313b91++);});_0x313b91=='0'&&(_0x21a25d[_0x5185bb(0x26f)]=_0x21a25d[_0x5185bb(0x26f)][_0x5185bb(0x2b4)]({'product_name':_0x3838d2[_0x5185bb(0x2cc)],'product_stock':_0x3838d2[_0x5185bb(0x24b)],'primary_code':_0x3838d2[_0x5185bb(0x1e4)],'secondary_code':_0x3838d2[_0x5185bb(0x28a)],'product_code':_0x3838d2[_0x5185bb(0x1e1)],'bay':_0x3838d2[_0x5185bb(0x203)],'batch_code':_0x3838d2['batch_code'],'maxPerUnit':_0x3838d2['maxPerUnit'],'production_date':_0x3838d2['production_date'],'expiry_date':_0x3838d2[_0x5185bb(0x251)],'secondary_unit':_0x3838d2[_0x5185bb(0x28c)],'unit':_0x3838d2[_0x5185bb(0x260)],'maxProducts':_0x3838d2[_0x5185bb(0x22e)]}));}),await _0x21a25d[_0x491bb0(0x20d)](),console[_0x491bb0(0x1f5)](_0x32544f[_0x491bb0(0x2e8)]);const _0x459a3f=new c_payment_data({'invoice':_0x1489f9,'customer':_0x32544f[_0x491bb0(0x2e8)][_0x491bb0(0x211)],'reason':_0x491bb0(0x1fd)});await _0x459a3f['save']();const _0x52c1e8=await master_shop[_0x491bb0(0x2e7)]();console[_0x491bb0(0x1f5)]('add\x20post',_0x52c1e8[0x0]['image']);const _0x1a3bb2=await email_settings[_0x491bb0(0x286)](),_0x2d69d2=await customer[_0x491bb0(0x286)]({'name':_0x32544f[_0x491bb0(0x2e8)]['customer']});console[_0x491bb0(0x1f5)](_0x491bb0(0x244),_0x2d69d2);_0x52c1e8[0x0][_0x491bb0(0x24c)]==0x1?(right_currency=_0x52c1e8[0x0][_0x491bb0(0x212)],left_currency=''):(right_currency='',left_currency=_0x52c1e8[0x0][_0x491bb0(0x212)]);var _0x2ff023=_0x1cfba7,_0x54cfd1=_0x400f84,_0x499c88='',_0x2c07c9;for(_0x2c07c9 in _0x2ff023){_0x499c88+='<tr>'+_0x491bb0(0x231)+_0x2ff023[_0x2c07c9]+'</td>'+_0x491bb0(0x231)+_0x54cfd1[_0x2c07c9]+'</td>'+_0x491bb0(0x2a1);}console[_0x491bb0(0x1f5)](_0x491bb0(0x252),_0x499c88);let _0x5d0526=nodemailer['createTransport']({'service':_0x491bb0(0x29d),'auth':{'user':_0x1a3bb2[_0x491bb0(0x2e4)],'pass':_0x1a3bb2[_0x491bb0(0x215)]}}),_0x10b34d={'from':_0x1a3bb2[_0x491bb0(0x2e4)],'to':_0x2d69d2['email'],'subject':_0x491bb0(0x1f6),'attachments':[{'filename':_0x491bb0(0x1d3),'path':__dirname+_0x491bb0(0x281)+_0x491bb0(0x1dc)+_0x52c1e8[0x0][_0x491bb0(0x235)],'cid':_0x491bb0(0x2d4)}],'html':'<!DOCTYPE\x20html>'+_0x491bb0(0x273)+_0x491bb0(0x219)+_0x491bb0(0x25e)+_0x491bb0(0x27e)+_0x491bb0(0x25e)+_0x491bb0(0x214)+_0x491bb0(0x1eb)+'<div>'+_0x491bb0(0x236)+_0x52c1e8[0x0][_0x491bb0(0x1df)]+_0x491bb0(0x2d9)+_0x491bb0(0x1eb)+'</div>'+_0x491bb0(0x26b)+_0x491bb0(0x25e)+_0x491bb0(0x29a)+_0x491bb0(0x297)+_0x1489f9+'\x20'+_0x491bb0(0x2c6)+_0x491bb0(0x1d6)+_0x126d2b+'\x20'+_0x491bb0(0x20b)+'</h5>'+'</div>'+_0x491bb0(0x1f3)+_0x491bb0(0x1ed)+_0x491bb0(0x2a2)+_0x491bb0(0x200)+_0x491bb0(0x1fc)+_0x491bb0(0x23c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x491bb0(0x2a1)+_0x491bb0(0x2af)+_0x491bb0(0x2ea)+'\x20'+_0x499c88+'\x20'+_0x491bb0(0x1f9)+_0x491bb0(0x28b)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x491bb0(0x233)+_0x52c1e8[0x0][_0x491bb0(0x1df)]+'</h5>'+'</div>'+_0x491bb0(0x1eb)+'</body></html>'};_0x5d0526[_0x491bb0(0x1ef)](_0x10b34d,function(_0xaa7fc9,_0x3bfdd9){var _0x268ba3=_0x491bb0;_0xaa7fc9?(console[_0x268ba3(0x1f5)](_0xaa7fc9),console['log'](_0x268ba3(0x237))):console[_0x268ba3(0x1f5)](_0x268ba3(0x1d7));}),_0x32544f[_0x491bb0(0x2ad)](_0x491bb0(0x298),_0x491bb0(0x1f2)),_0x3ef176['redirect'](_0x491bb0(0x1f8));}catch(_0xaee9d8){console[_0x491bb0(0x1f5)](_0xaee9d8),_0x3ef176[_0x491bb0(0x1f0)](0xc8)[_0x491bb0(0x1d9)]({'message1':_0xaee9d8[_0x491bb0(0x2bb)]});}}}),router['get'](a0_0xce787f(0x204),auth,async(_0x122657,_0x168e02)=>{var _0x1685d7=a0_0xce787f;try{const {username:_0x169965,email:_0x31a403,role:_0x5cef91}=_0x122657[_0x1685d7(0x23d)],_0x4a1cc2=_0x122657[_0x1685d7(0x23d)],_0x26ed85=await profile[_0x1685d7(0x286)]({'email':_0x4a1cc2[_0x1685d7(0x2e4)]}),_0x5dfd5b=await master_shop[_0x1685d7(0x2e7)]();console[_0x1685d7(0x1f5)]('barcode\x20Product\x20master',_0x5dfd5b);const _0x60a3a0=_0x122657[_0x1685d7(0x2a9)]['id'],_0x34eb2b=await sales[_0x1685d7(0x210)](_0x60a3a0);console['log']('barcode\x20user_id',_0x34eb2b);if(_0x5dfd5b[0x0][_0x1685d7(0x1ea)]==_0x1685d7(0x2a3))var _0x597ccf=users[_0x1685d7(0x209)];else{if(_0x5dfd5b[0x0][_0x1685d7(0x1ea)]=='Hindi')var _0x597ccf=users['Hindi'];else{if(_0x5dfd5b[0x0]['language']=='German')var _0x597ccf=users[_0x1685d7(0x259)];else{if(_0x5dfd5b[0x0]['language']==_0x1685d7(0x290))var _0x597ccf=users[_0x1685d7(0x290)];else{if(_0x5dfd5b[0x0][_0x1685d7(0x1ea)]==_0x1685d7(0x26d))var _0x597ccf=users[_0x1685d7(0x26d)];else{if(_0x5dfd5b[0x0][_0x1685d7(0x1ea)]==_0x1685d7(0x2c7))var _0x597ccf=users['Portuguese'];else{if(_0x5dfd5b[0x0][_0x1685d7(0x1ea)]==_0x1685d7(0x295))var _0x597ccf=users[_0x1685d7(0x295)];else{if(_0x5dfd5b[0x0]['language']==_0x1685d7(0x1ee))var _0x597ccf=users[_0x1685d7(0x2e1)];}}}}}}}_0x168e02[_0x1685d7(0x2cb)](_0x1685d7(0x22a),{'success':_0x122657['flash'](_0x1685d7(0x298)),'errors':_0x122657[_0x1685d7(0x2ad)](_0x1685d7(0x205)),'role':_0x4a1cc2,'profile':_0x26ed85,'alldata':_0x34eb2b,'master_shop':_0x5dfd5b,'language':_0x597ccf});}catch(_0x14351c){console[_0x1685d7(0x1f5)](_0x14351c);}}),router[a0_0xce787f(0x2bd)](a0_0xce787f(0x26e),async(_0x12055b,_0x4f89f5)=>{var _0x3eca3c=a0_0xce787f;const {product_code:_0x38e239,warehouse_name:_0x1a5e40,rooms_data:_0x49f2f6,Roomslist:_0x3a4fba}=_0x12055b[_0x3eca3c(0x2e8)],_0x5f410f=_0x3a4fba['split'](','),_0x4cee39=[];async function _0x26ddb1(_0x35acb1){var _0xe10a28=_0x3eca3c;const _0x1c77dd=await warehouse[_0xe10a28(0x2a0)]([{'$match':{'name':_0x1a5e40,'room':_0x35acb1}},{'$unwind':_0xe10a28(0x24a)},{'$match':{'product_details.primary_code':_0x38e239}},{'$group':{'_id':_0xe10a28(0x292),'name':{'$first':_0xe10a28(0x22c)},'product_stock':{'$first':_0xe10a28(0x2a8)},'primary_code':{'$first':_0xe10a28(0x274)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0xe10a28(0x1e8)},'isle':{'$first':_0xe10a28(0x242)},'type':{'$first':_0xe10a28(0x27b)},'pallet':{'$first':_0xe10a28(0x2dd)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0xe10a28(0x1d1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xe10a28(0x216)},'expiry_date':{'$first':_0xe10a28(0x20a)},'production_date':{'$first':_0xe10a28(0x2b7)},'maxPerUnit':{'$first':_0xe10a28(0x246)},'batch_code':{'$first':_0xe10a28(0x1f1)},'product_cat':{'$first':_0xe10a28(0x2dc)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0xe10a28(0x2c9)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x4dfed8=await warehouse[_0xe10a28(0x2a0)]([{'$match':{'name':_0x1a5e40,'room':_0x35acb1}},{'$unwind':_0xe10a28(0x24a)},{'$match':{'product_details.secondary_code':_0x38e239}},{'$group':{'_id':'$product_details._id','name':{'$first':_0xe10a28(0x22c)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0xe10a28(0x274)},'secondary_code':{'$first':_0xe10a28(0x2e2)},'product_code':{'$first':_0xe10a28(0x217)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xe10a28(0x2dd)},'unit':{'$first':_0xe10a28(0x270)},'secondary_unit':{'$first':_0xe10a28(0x1d1)},'storage':{'$first':_0xe10a28(0x2ab)},'rack':{'$first':_0xe10a28(0x216)},'expiry_date':{'$first':_0xe10a28(0x20a)},'production_date':{'$first':_0xe10a28(0x2b7)},'maxPerUnit':{'$first':_0xe10a28(0x246)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0xe10a28(0x2c9)},'invoice':{'$first':_0xe10a28(0x1db)}}}]);if(_0x1c77dd['length']>0x0)_0x4cee39[_0xe10a28(0x29c)](_0x1c77dd);else _0x4dfed8[_0xe10a28(0x27c)]>0x0&&_0x4cee39['push'](_0x4dfed8);}const _0x2439c3=_0x5f410f[_0x3eca3c(0x239)](_0x1e0b20=>_0x26ddb1(_0x1e0b20));await Promise[_0x3eca3c(0x2b0)](_0x2439c3),_0x4f89f5[_0x3eca3c(0x1d9)](_0x4cee39);}),module['exports']=router;