var a0_0x292ad1=a0_0xe539;function a0_0x3489(){var _0x3edbe9=['customer_data','Logo.png','$invoice','True','port','exports','$sale_product.bin','<!DOCTYPE\x20html>','Return\x20Goods','warehouse','$_id','False','<hr\x20class=\x22my-3\x22>','<strong>\x20Regards\x20</strong>','Ambient','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','customers_docs','/view/add_sales','sale_qty','457700AHwOvc','edit_sales_finished_view','$product_details.expiry_date','/upload/','Arabic\x20(ae)','express','find','169928lIuqRK','An\x20error\x20occurred.','payment\x20successfull','stocks_QA','$product','$room','date','expiry_date_QA','$product_details.primary_code','bay','<h5>','invoice','aggregate','\x20Order\x20Number\x20:\x20','purchases_data','amount','staff','$product_details.product_name','site_title','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Enclosed','maxPerUnit','return_qty_QA','Received\x20Payment\x20For\x20Sale','/view/return_sales/:id','body','maxProducts','customers','post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','return_data','primary_code','<div>','add\x20post','message','\x20</h2>','primary_code_QA','$sale_product.quantity','gmail','back','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/view/add_sales/:id','$product_details.invoice','prod_cat','$product_details.batch_code','foreach\x20newproduct','product_details','</span>','toString','sales_invoice','master','product_name','$customer','warehouse_name','</head><body>','Quality\x20Inspection','maxProducts_QA','Enabled','params','save','</tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','44292CKchbv','all_sales_barcode','$product_details.secondary_code','$name','English\x20(US)','Sale','map','nodemailer','$product_details.unit','$product_details.product_code','quantity','sales_quantity_QA','getDate','host','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Error\x20Occurs','$product_details.type','Email\x20sent\x20successfully','production_date_QA','Chinese','edit_sales_finished','/give_payment/:id','536yUuRLh','</table>','../middleware/auth','<span\x20style=\x22float:\x20right;\x22>','email','prod_invoice','getMonth','211981DpgPSG','Sale\x20Return','</thead>','/all_sales_finished/preview/','prod_code','product_stock','add_sales_finished','$product_details._id','Sale\x20Product\x20Mail','stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','findOne','product','error','json','sendMail','unit','Portuguese','../models/all_models','$product_details.bin','sales_quantity','$product_details.maxProducts','log','padStart','430436fAFSzP','room_name','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.product_cat','suppliers','floor','status','$sale_product.floorlevel','</body></html>','<tr>','image','primary_unit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','final','split','filter','success','OUTF-','all','$note','$customers_docs','render','catch','Portuguese\x20(BR)','product_date','product_list','currency_placement','secondary_unit','findById','$product_details.storage','Return\x20Rooms','all_sales_finished','stock_data','$warehouse_name','$product.product_name','barcode\x20Product\x20master','French','590FRgTIR','$product_details.bay','max_per_unit','German','redirect','return_qty','/view/:id','sale_product','<h2>\x20','product_data','$product_details.floorlevel','secondary_unit_QA','$date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','4755895DIsKXE','\x20Order\x20Date\x20:\x20','push','\x20<>\x20','secondary_code','$product_details.secondary_unit','../public/language/languages.json','$sale_product.type','createTransport','length','unit_QA','/../public','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$sale_product','concat','Arabic','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</tbody>','role','</td>','/barcode_scanner','/preview/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','note','finalize','abs','Finished\x20Goods','$return_data','level','maxPerUnit_QA','<html><head><title></title>','$sale_product.bay','$product_details.maxPerUnit','errors','production_date','FGSEmail','password','/picking_list/pdf/','logo','slice','/all_sales_finished/view','room','customer','for_categorize','Hindi','due_amount','forEach','Sale\x20Return\x20Mail','Sales\x20Update\x20successfully','English','return_sale_finished','</h5>','34389MrtWTs','string','expiry_date','get','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Spanish','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.production_date','return_sale','product_name_QA1','$product_details.product_stock','/barcode/:id','RoomAssigned','maxperunit','product_code','carton','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/view','210HpRZnk','<h5\x20style=\x22text-align:\x20left;\x22>','flash','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','then','$product_details.rack','user','76atTGFg','batch_code'];a0_0x3489=function(){return _0x3edbe9;};return a0_0x3489();}(function(_0x7cfffc,_0x167958){var _0x5eb29e=a0_0xe539,_0x3e3f9f=_0x7cfffc();while(!![]){try{var _0x39addd=parseInt(_0x5eb29e(0x114))/0x1+-parseInt(_0x5eb29e(0xfe))/0x2*(parseInt(_0x5eb29e(0x159))/0x3)+parseInt(_0x5eb29e(0x18f))/0x4+parseInt(_0x5eb29e(0x1c3))/0x5+-parseInt(_0x5eb29e(0xf6))/0x6*(parseInt(_0x5eb29e(0x176))/0x7)+-parseInt(_0x5eb29e(0x16f))/0x8*(parseInt(_0x5eb29e(0xe3))/0x9)+parseInt(_0x5eb29e(0x1b5))/0xa*(parseInt(_0x5eb29e(0x11b))/0xb);if(_0x39addd===_0x167958)break;else _0x3e3f9f['push'](_0x3e3f9f['shift']());}catch(_0x4ef1a4){_0x3e3f9f['push'](_0x3e3f9f['shift']());}}}(a0_0x3489,0x86840));const express=require(a0_0x292ad1(0x119)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x292ad1(0x189)),auth=require(a0_0x292ad1(0x171)),nodemailer=require(a0_0x292ad1(0x160)),users=require(a0_0x292ad1(0x1c9));router['get'](a0_0x292ad1(0xf5),auth,async(_0x3102dd,_0xddb2b5)=>{var _0x497c7b=a0_0x292ad1;try{const {username:_0x9b8692,email:_0x2059ae,role:_0x9df59}=_0x3102dd[_0x497c7b(0xfd)],_0x3c48aa=_0x3102dd[_0x497c7b(0xfd)],_0x221d37=await profile[_0x497c7b(0x182)]({'email':_0x3c48aa[_0x497c7b(0x173)]}),_0xe89215=await master_shop['find']();let _0x5696d5;if(_0x3c48aa[_0x497c7b(0x1d5)]=='staff'){const _0x22db88=await staff[_0x497c7b(0x182)]({'email':_0x3c48aa[_0x497c7b(0x173)]});_0x5696d5=await sales_finished['aggregate']([{'$lookup':{'from':_0x497c7b(0x136),'localField':_0x497c7b(0xd9),'foreignField':'name','as':_0x497c7b(0x111)}},{'$unwind':_0x497c7b(0x1a4)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x497c7b(0x10a),'invoice':{'$first':_0x497c7b(0x102)},'customers':{'$first':_0x497c7b(0x14f)},'date':{'$first':_0x497c7b(0x1c1)},'warehouse_name':{'$first':_0x497c7b(0x1b1)},'sale_product':{'$push':_0x497c7b(0x1d0)},'note':{'$first':_0x497c7b(0x1a3)},'return_data':{'$first':_0x497c7b(0x1de)},'customers_docs':{'$first':_0x497c7b(0x1a4)},'total_saleproduct_quantity':{'$sum':_0x497c7b(0x140)},'level':{'$addToSet':_0x497c7b(0xce)},'isle':{'$addToSet':_0x497c7b(0x106)},'type':{'$addToSet':_0x497c7b(0x1ca)},'pallet':{'$addToSet':_0x497c7b(0x197)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x5696d5=await sales_finished[_0x497c7b(0x127)]([{'$lookup':{'from':_0x497c7b(0x136),'localField':_0x497c7b(0xd9),'foreignField':'name','as':_0x497c7b(0x111)}},{'$unwind':_0x497c7b(0x1a4)},{'$unwind':_0x497c7b(0x1d0)},{'$group':{'_id':_0x497c7b(0x10a),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x497c7b(0x14f)},'date':{'$first':_0x497c7b(0x1c1)},'warehouse_name':{'$first':_0x497c7b(0x1b1)},'sale_product':{'$push':_0x497c7b(0x1d0)},'note':{'$first':_0x497c7b(0x1a3)},'return_data':{'$first':_0x497c7b(0x1de)},'customers_docs':{'$first':_0x497c7b(0x1a4)},'total_saleproduct_quantity':{'$sum':_0x497c7b(0x140)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x497c7b(0x106)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x497c7b(0x197)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0xe89215[0x0][_0x497c7b(0xf9)]==_0x497c7b(0x15d)){var _0x3dc329=users[_0x497c7b(0xe0)];console[_0x497c7b(0x18d)](_0x3dc329);}else{if(_0xe89215[0x0]['language']=='Hindi')var _0x3dc329=users[_0x497c7b(0xdb)];else{if(_0xe89215[0x0][_0x497c7b(0xf9)]==_0x497c7b(0x1b8))var _0x3dc329=users[_0x497c7b(0x1b8)];else{if(_0xe89215[0x0][_0x497c7b(0xf9)]=='Spanish')var _0x3dc329=users[_0x497c7b(0xe8)];else{if(_0xe89215[0x0][_0x497c7b(0xf9)]==_0x497c7b(0x1b4))var _0x3dc329=users[_0x497c7b(0x1b4)];else{if(_0xe89215[0x0][_0x497c7b(0xf9)]==_0x497c7b(0x1a7))var _0x3dc329=users[_0x497c7b(0x188)];else{if(_0xe89215[0x0][_0x497c7b(0xf9)]==_0x497c7b(0x16c))var _0x3dc329=users[_0x497c7b(0x16c)];else{if(_0xe89215[0x0][_0x497c7b(0xf9)]=='Arabic\x20(ae)')var _0x3dc329=users[_0x497c7b(0x1d2)];}}}}}}}_0xddb2b5[_0x497c7b(0x1a5)](_0x497c7b(0x1af),{'success':_0x3102dd[_0x497c7b(0xf8)](_0x497c7b(0x1a0)),'errors':_0x3102dd[_0x497c7b(0xf8)](_0x497c7b(0xd0)),'sales':_0x5696d5,'profile':_0x221d37,'role':_0x3c48aa,'master_shop':_0xe89215,'language':_0x3dc329});}catch(_0x3a58e5){console[_0x497c7b(0x18d)](_0x3a58e5);}});function a0_0xe539(_0xdce0a1,_0xc4acdd){var _0x348936=a0_0x3489();return a0_0xe539=function(_0xe5392f,_0x21b516){_0xe5392f=_0xe5392f-0xcb;var _0x54cacc=_0x348936[_0xe5392f];return _0x54cacc;},a0_0xe539(_0xdce0a1,_0xc4acdd);}async function getRandom8DigitNumber(){var _0x493175=a0_0x292ad1;const _0x5868a2=0x989680,_0x1b11a9=0x5f5e0ff,_0x234d1e=Math[_0x493175(0x195)](Math['random']()*(_0x1b11a9-_0x5868a2+0x1))+_0x5868a2;var _0x1af82a;const _0x207fbe=await sales_finished[_0x493175(0x182)]({'invoice':'OUTF-'+_0x234d1e});return _0x207fbe&&_0x207fbe[_0x493175(0x1cc)]>0x0?_0x1af82a=_0x493175(0x1a1)+_0x234d1e:_0x1af82a='OUTF-'+_0x234d1e,_0x1af82a;}router[a0_0x292ad1(0xe6)]('/view/add_sales',auth,async(_0x393667,_0x30b7ba)=>{var _0x3b2ac5=a0_0x292ad1;try{const {username:_0x183d5b,email:_0x5f205a,role:_0x44c1f4}=_0x393667[_0x3b2ac5(0xfd)],_0x3bd2fa=_0x393667[_0x3b2ac5(0xfd)],_0xd016aa=await profile[_0x3b2ac5(0x182)]({'email':_0x3bd2fa[_0x3b2ac5(0x173)]}),_0x12b5b8=await master_shop[_0x3b2ac5(0x11a)](),_0x1cbfa6=await customer['find']({});let _0x458aa0;if(_0x3bd2fa[_0x3b2ac5(0x1d5)]==_0x3b2ac5(0x12b)){const _0x18509d=await staff['findOne']({'email':_0x3bd2fa['email']});_0x458aa0=await warehouse[_0x3b2ac5(0x127)]([{'$match':{'status':'Enabled','name':_0x18509d[_0x3b2ac5(0x109)],'warehouse_category':_0x3b2ac5(0x1dd),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x3b2ac5(0x15c),'name':{'$first':_0x3b2ac5(0x15c)}}},{'$sort':{'name':0x1}}]);}else _0x458aa0=await warehouse[_0x3b2ac5(0x127)]([{'$match':{'status':'Enabled','warehouse_category':_0x3b2ac5(0x1dd),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x3b2ac5(0x15c)}}},{'$sort':{'name':0x1}}]);const _0x199aa3=await product['find']({});var _0x124080=[_0x3b2ac5(0x10e),_0x3b2ac5(0x12f)];const _0x47fe2d=await sales_finished[_0x3b2ac5(0x11a)]({}),_0x4ec39b=_0x47fe2d[_0x3b2ac5(0x1cc)]+0x1,_0x25fa3e=_0x3b2ac5(0x1a1)+_0x4ec39b[_0x3b2ac5(0x14b)]()[_0x3b2ac5(0x18e)](0x5,'0');if(_0x12b5b8[0x0][_0x3b2ac5(0xf9)]==_0x3b2ac5(0x15d)){var _0x1cb599=users[_0x3b2ac5(0xe0)];console[_0x3b2ac5(0x18d)](_0x1cb599);}else{if(_0x12b5b8[0x0][_0x3b2ac5(0xf9)]==_0x3b2ac5(0xdb))var _0x1cb599=users[_0x3b2ac5(0xdb)];else{if(_0x12b5b8[0x0][_0x3b2ac5(0xf9)]==_0x3b2ac5(0x1b8))var _0x1cb599=users[_0x3b2ac5(0x1b8)];else{if(_0x12b5b8[0x0]['language']==_0x3b2ac5(0xe8))var _0x1cb599=users[_0x3b2ac5(0xe8)];else{if(_0x12b5b8[0x0][_0x3b2ac5(0xf9)]==_0x3b2ac5(0x1b4))var _0x1cb599=users['French'];else{if(_0x12b5b8[0x0]['language']=='Portuguese\x20(BR)')var _0x1cb599=users['Portuguese'];else{if(_0x12b5b8[0x0][_0x3b2ac5(0xf9)]=='Chinese')var _0x1cb599=users[_0x3b2ac5(0x16c)];else{if(_0x12b5b8[0x0]['language']=='Arabic\x20(ae)')var _0x1cb599=users['Arabic'];}}}}}}}const _0x216160=getRandom8DigitNumber();_0x216160[_0x3b2ac5(0xfb)](_0x33c706=>{var _0x49355c=_0x3b2ac5;_0x30b7ba[_0x49355c(0x1a5)](_0x49355c(0x17c),{'success':_0x393667['flash']('success'),'errors':_0x393667[_0x49355c(0xf8)]('errors'),'role':_0x3bd2fa,'profile':_0xd016aa,'customer':_0x1cbfa6,'warehouse':_0x458aa0,'product':_0x199aa3,'invoice':_0x33c706,'master_shop':_0x12b5b8,'language':_0x1cb599,'rooms_data':_0x124080});})[_0x3b2ac5(0x1a6)](_0x4327ef=>{var _0x33b52=_0x3b2ac5;_0x393667['flash'](_0x33b52(0xd0),_0x33b52(0x1c2)),_0x30b7ba[_0x33b52(0x1b9)](_0x33b52(0xd7));});}catch(_0x25d874){console[_0x3b2ac5(0x18d)](_0x25d874);}}),router['get'](a0_0x292ad1(0x144),auth,async(_0x5dd0ad,_0x446d00)=>{var _0x4060e3=a0_0x292ad1;try{const _0x2eaac4=_0x5dd0ad['params']['id'];console[_0x4060e3(0x18d)](_0x2eaac4);const _0x592976=await product['find'](),_0x46410f=await purchases[_0x4060e3(0x127)]([{'$match':{'warehouse_name':_0x2eaac4}},{'$unwind':_0x4060e3(0x11f)},{'$group':{'_id':_0x4060e3(0x1b2)}}]);console[_0x4060e3(0x18d)](_0x4060e3(0x129),_0x46410f),_0x446d00[_0x4060e3(0x196)](0xc8)[_0x4060e3(0x185)]({'purchases_data':_0x46410f,'product_data':_0x592976});}catch(_0x3c8275){console[_0x4060e3(0x18d)](_0x3c8275);}}),router[a0_0x292ad1(0x137)]('/view/add_sale/product',auth,async(_0x2122a2,_0x4eaab9)=>{var _0x42f862=a0_0x292ad1;try{const {warehouse_data:_0x17a5b7,product_data:_0xfab486}=_0x2122a2[_0x42f862(0x134)];console[_0x42f862(0x18d)](_0x2122a2[_0x42f862(0x134)][_0x42f862(0x1be)]);;const _0x312383=await master_shop[_0x42f862(0x11a)]();console['log'](_0x42f862(0x14d),_0x312383);const _0x7f3ab9=await product[_0x42f862(0x182)]({'name':_0xfab486});console['log'](_0x42f862(0x183),_0x7f3ab9);const _0x203082=await warehouse[_0x42f862(0x127)]([{'$match':{'name':_0x17a5b7}},{'$unwind':_0x42f862(0x191)},{'$match':{'product_details.product_name':_0xfab486}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x42f862(0xed)}}}]);console[_0x42f862(0x18d)](_0x42f862(0x1b0),_0x203082),_0x4eaab9[_0x42f862(0x196)](0xc8)['json']({'master':_0x312383,'new_product':_0x7f3ab9,'stock_data':_0x203082});}catch(_0x4ab4ac){console[_0x42f862(0x18d)](_0x4ab4ac);}}),router[a0_0x292ad1(0x137)](a0_0x292ad1(0x112),auth,async(_0xf45e19,_0x382003)=>{var _0x2ef4be=a0_0x292ad1;try{const {invoice:_0x2dabec,date:_0x38e94b,warehouse_name:_0x196a91,product_name:_0x580150,stock:_0x4ce4ac,quantity:_0x2c9ca9,note:_0x5e5c0b,room:_0x5717b4,primary_code:_0x313c8d,secondary_code:_0x944a8,prod_code:_0x51a604,level:_0x50376c,isle:_0x6bc4a4,pallet:_0xc03e32,batch_code:_0xcf337b,SCRN:_0x486d3e,expiry_date:_0x3598ec,mode_transpo:_0x553fc6,name_driver:_0x3f5885}=_0xf45e19[_0x2ef4be(0x134)];if(typeof _0x580150==_0x2ef4be(0xe4))var _0x3dd3fb=[_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x14e)]],_0x46c8dd=[_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x17f)]],_0x599f6f=[_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0xf2)]],_0x4167cc=[_0xf45e19['body'][_0x2ef4be(0x13a)]],_0x13aee5=[_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x1c7)]],_0xa83fb=[_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x17a)]],_0x26234e=[_0xf45e19['body']['level']],_0x144ba2=[_0xf45e19[_0x2ef4be(0x134)]['primary_unit']],_0x45bae2=[_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x1ab)]],_0x46f83b=[_0xf45e19[_0x2ef4be(0x134)]['batch_code']],_0x4d9baf=[_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0xe5)]],_0x58116f=[_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x1a8)]],_0x5bc2cd=[_0xf45e19[_0x2ef4be(0x134)]['max_per_unit']],_0x21831d=[_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x146)]],_0x42b66e=[_0xf45e19[_0x2ef4be(0x134)]['RoomAssigned']],_0x4ce8b4=[_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x174)]];else var _0x3dd3fb=[..._0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x14e)]],_0x46c8dd=[..._0xf45e19[_0x2ef4be(0x134)]['stock']],_0x599f6f=[..._0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0xf2)]],_0x4167cc=[..._0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x13a)]],_0x13aee5=[..._0xf45e19[_0x2ef4be(0x134)]['secondary_code']],_0xa83fb=[..._0xf45e19['body'][_0x2ef4be(0x17a)]],_0x26234e=[..._0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0xcb)]],_0x144ba2=[..._0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x19b)]],_0x45bae2=[..._0xf45e19['body'][_0x2ef4be(0x1ab)]],_0x46f83b=[..._0xf45e19['body'][_0x2ef4be(0xff)]],_0x4d9baf=[..._0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0xe5)]],_0x58116f=[..._0xf45e19['body']['product_date']],_0x5bc2cd=[..._0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x1b7)]],_0x21831d=[..._0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0x146)]],_0x42b66e=[..._0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0xef)]],_0x4ce8b4=[..._0xf45e19['body'][_0x2ef4be(0x174)]];const _0x3de97f=_0x3dd3fb['map'](_0x48a605=>{return _0x48a605={'product_name':_0x48a605};});_0x46c8dd[_0x2ef4be(0xdd)]((_0x21520f,_0x3c7bba)=>{var _0x1e2be9=_0x2ef4be;_0x3de97f[_0x3c7bba][_0x1e2be9(0x17f)]=_0x21520f;}),_0x599f6f[_0x2ef4be(0xdd)]((_0x1db3b7,_0x385061)=>{var _0x3e4547=_0x2ef4be;_0x3de97f[_0x385061][_0x3e4547(0x163)]=Math[_0x3e4547(0x1dc)](_0x1db3b7);}),_0x4167cc[_0x2ef4be(0xdd)]((_0x14ff5e,_0x58f697)=>{var _0x1c5e0b=_0x2ef4be;_0x3de97f[_0x58f697][_0x1c5e0b(0x13a)]=_0x14ff5e;}),_0x13aee5['forEach']((_0x2a4668,_0x5c724b)=>{var _0x31efc9=_0x2ef4be;_0x3de97f[_0x5c724b][_0x31efc9(0x1c7)]=_0x2a4668;}),_0xa83fb['forEach']((_0x1098ca,_0x45d21c)=>{var _0x56a71f=_0x2ef4be;_0x3de97f[_0x45d21c][_0x56a71f(0xf1)]=_0x1098ca;}),_0x26234e[_0x2ef4be(0xdd)]((_0x1549e8,_0x130de4)=>{var _0x101959=_0x2ef4be;_0x3de97f[_0x130de4][_0x101959(0x124)]=_0x1549e8;}),_0x144ba2[_0x2ef4be(0xdd)]((_0x984ef9,_0x118651)=>{_0x3de97f[_0x118651]['unit']=_0x984ef9;}),_0x45bae2['forEach']((_0x21085b,_0x50a97c)=>{_0x3de97f[_0x50a97c]['secondary_unit']=_0x21085b;}),_0x46f83b[_0x2ef4be(0xdd)]((_0x4e0f77,_0x4fca56)=>{var _0x5b7282=_0x2ef4be;_0x3de97f[_0x4fca56][_0x5b7282(0xff)]=_0x4e0f77;}),_0x4d9baf[_0x2ef4be(0xdd)]((_0x321bcf,_0x4cbdcd)=>{_0x3de97f[_0x4cbdcd]['expiry_date']=_0x321bcf;}),_0x58116f[_0x2ef4be(0xdd)]((_0x26af0f,_0x195f21)=>{var _0x2dcdcb=_0x2ef4be;_0x3de97f[_0x195f21][_0x2dcdcb(0xd1)]=_0x26af0f;}),_0x5bc2cd[_0x2ef4be(0xdd)]((_0x32b8ca,_0x3afc25)=>{var _0x560783=_0x2ef4be;_0x3de97f[_0x3afc25][_0x560783(0xf0)]=_0x32b8ca;}),_0x21831d['forEach']((_0x19ee1f,_0x5cae2a)=>{var _0x526baf=_0x2ef4be;_0x3de97f[_0x5cae2a][_0x526baf(0x146)]=_0x19ee1f;}),_0x42b66e[_0x2ef4be(0xdd)]((_0x48fe9d,_0x16be35)=>{_0x3de97f[_0x16be35]['room_name']=_0x48fe9d;}),_0x4ce8b4[_0x2ef4be(0xdd)]((_0x5767ff,_0x59caab)=>{_0x3de97f[_0x59caab]['invoice']=_0x5767ff;});var _0x24f399=0x0;_0x3de97f[_0x2ef4be(0xdd)](_0x23a7cd=>{var _0x5c7ead=_0x2ef4be;parseFloat(_0x23a7cd[_0x5c7ead(0x17f)])<parseFloat(_0x23a7cd[_0x5c7ead(0x163)])&&parseFloat(_0x23a7cd[_0x5c7ead(0x163)])>parseFloat(_0x23a7cd[_0x5c7ead(0x17f)])&&(console['log'](_0x23a7cd[_0x5c7ead(0x17f)]+_0x5c7ead(0x1c6)+_0x23a7cd[_0x5c7ead(0x163)]),_0x24f399++);});if(_0x24f399!=0x0)return _0xf45e19[_0x2ef4be(0xf8)](_0x2ef4be(0xd0),'Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x382003[_0x2ef4be(0x1b9)]('back');const _0x21c661=_0x3de97f[_0x2ef4be(0x19f)](_0x523d6b=>_0x523d6b[_0x2ef4be(0x163)]!=='0'&&_0x523d6b['quantity']!==''),_0x15f74f=new sales_finished({'invoice':_0x2dabec,'customer':_0xf45e19['body'][_0x2ef4be(0xd9)],'date':_0x38e94b,'warehouse_name':_0x196a91,'sale_product':_0x21c661,'note':_0x5e5c0b,'room':_0x5717b4,'primary_code':_0x313c8d,'secondary_code':_0x944a8,'prod_code':_0x51a604,'SCRN':_0x486d3e,'finalize':_0x2ef4be(0x10b),'mode_transpo':_0x553fc6,'name_driver':_0x3f5885}),_0x52c557=await _0x15f74f['save'](),_0x1b430f=await sales_finished['findOne']({'invoice':_0x2dabec}),_0x57731f=new c_payment_data({'invoice':_0x2dabec,'customer':_0xf45e19[_0x2ef4be(0x134)][_0x2ef4be(0xd9)],'reason':_0x2ef4be(0x15e)});await _0x57731f['save']();const _0x25da24=await master_shop[_0x2ef4be(0x11a)](),_0x52892c=await email_settings['findOne'](),_0x57bc8a=await customer[_0x2ef4be(0x182)]({'name':_0xf45e19[_0x2ef4be(0x134)]['customer']});_0x25da24[0x0]['currency_placement']==0x1?(right_currency=_0x25da24[0x0][_0x2ef4be(0x10f)],left_currency=''):(right_currency='',left_currency=_0x25da24[0x0]['currency']);var _0x5d2a46=_0x3dd3fb,_0xeb750a=_0x599f6f,_0x344733='',_0x5cff6b;for(_0x5cff6b in _0x5d2a46){_0x344733+=_0x2ef4be(0x199)+_0x2ef4be(0x19c)+_0x5d2a46[_0x5cff6b]+_0x2ef4be(0x1d6)+_0x2ef4be(0x19c)+_0xeb750a[_0x5cff6b]+'</td>'+'</tr>';}console[_0x2ef4be(0x18d)]('product_list',_0x344733);let _0x5c0812=nodemailer['createTransport']({'service':_0x2ef4be(0x141),'auth':{'user':_0x52892c['email'],'pass':_0x52892c[_0x2ef4be(0xd3)]}}),_0x1cc354={'from':_0x52892c[_0x2ef4be(0x173)],'to':_0x57bc8a[_0x2ef4be(0x173)],'subject':_0x2ef4be(0x17e),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2ef4be(0x1ce)+_0x2ef4be(0x117)+_0x25da24[0x0][_0x2ef4be(0x19a)],'cid':_0x2ef4be(0xd5)}],'html':'<!DOCTYPE\x20html>'+_0x2ef4be(0xcd)+_0x2ef4be(0x151)+_0x2ef4be(0x13b)+_0x2ef4be(0xe7)+'<div>'+_0x2ef4be(0x1d3)+_0x2ef4be(0xf3)+'<div>'+_0x2ef4be(0x1bd)+_0x25da24[0x0]['site_title']+'\x20</h2>'+_0x2ef4be(0xf3)+_0x2ef4be(0xf3)+_0x2ef4be(0x10c)+_0x2ef4be(0x13b)+_0x2ef4be(0xf7)+_0x2ef4be(0x128)+_0x2dabec+'\x20'+_0x2ef4be(0x172)+_0x2ef4be(0x1c4)+_0x38e94b+'\x20'+_0x2ef4be(0x14a)+'</h5>'+_0x2ef4be(0xf3)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2ef4be(0x1cf)+_0x2ef4be(0x199)+_0x2ef4be(0xfa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>'+'</tr>'+_0x2ef4be(0x178)+_0x2ef4be(0x1d9)+'\x20'+_0x344733+'\x20'+_0x2ef4be(0x1d4)+'</table>'+_0x2ef4be(0x13b)+_0x2ef4be(0x10d)+_0x2ef4be(0x125)+_0x25da24[0x0][_0x2ef4be(0x12d)]+_0x2ef4be(0xe2)+_0x2ef4be(0xf3)+_0x2ef4be(0xf3)+_0x2ef4be(0x198)};_0x5c0812[_0x2ef4be(0x186)](_0x1cc354,function(_0x1ee5a4,_0x359d76){var _0x5beaca=_0x2ef4be;_0x1ee5a4?(console['log'](_0x1ee5a4),console[_0x5beaca(0x18d)](_0x5beaca(0x168))):console[_0x5beaca(0x18d)]('Email\x20sent\x20successfully');}),_0xf45e19['flash']('success','Sales\x20Add\x20successfully'),_0x382003[_0x2ef4be(0x1b9)](_0x2ef4be(0x179)+_0x52c557['_id']);}catch(_0x173462){console[_0x2ef4be(0x18d)](_0x173462);}}),router['get'](a0_0x292ad1(0x1d8),auth,async(_0xb4cdc0,_0x2f568e)=>{var _0x41c881=a0_0x292ad1;try{const {username:_0x376441,email:_0x36383f,role:_0x42e6fc}=_0xb4cdc0['user'],_0x4aae8f=_0xb4cdc0[_0x41c881(0xfd)],_0x2ce695=await profile[_0x41c881(0x182)]({'email':_0x4aae8f[_0x41c881(0x173)]}),_0x375727=await master_shop[_0x41c881(0x11a)](),_0x31e26a=_0xb4cdc0[_0x41c881(0x155)]['id'],_0x2c3d59=await sales_finished[_0x41c881(0x1ac)](_0x31e26a),_0x1a94b0=await warehouse[_0x41c881(0x127)]([{'$match':{'name':_0x2c3d59[_0x41c881(0x150)]}},{'$unwind':_0x41c881(0x191)},{'$group':{'_id':_0x41c881(0x17d),'name':{'$first':_0x41c881(0x12c)},'product_stock':{'$first':_0x41c881(0xed)},'bay':{'$first':_0x41c881(0x1b6)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x41c881(0x169)},'floorlevel':{'$first':_0x41c881(0x1bf)},'primary_code':{'$first':_0x41c881(0x123)},'secondary_code':{'$first':_0x41c881(0x15b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x41c881(0x1ad)},'rack':{'$first':_0x41c881(0xfc)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x41c881(0x147)},'room':{'$first':_0x41c881(0x120)}}}]),_0x2a6c66=await customer['find']({});let _0x2d7c82;if(_0x4aae8f[_0x41c881(0x1d5)]==_0x41c881(0x12b)){const _0x2aa656=await staff['findOne']({'email':_0x4aae8f['email']});_0x2d7c82=await warehouse[_0x41c881(0x127)]([{'$match':{'status':_0x41c881(0x154),'name':_0x2aa656[_0x41c881(0x109)]}},{'$group':{'_id':_0x41c881(0x15c),'name':{'$first':_0x41c881(0x15c)}}}]);}else _0x2d7c82=await warehouse[_0x41c881(0x127)]([{'$match':{'status':_0x41c881(0x154)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x31cb2d=await product[_0x41c881(0x11a)]({});if(_0x375727[0x0][_0x41c881(0xf9)]=='English\x20(US)'){var _0x2240d0=users[_0x41c881(0xe0)];console[_0x41c881(0x18d)](_0x2240d0);}else{if(_0x375727[0x0][_0x41c881(0xf9)]==_0x41c881(0xdb))var _0x2240d0=users[_0x41c881(0xdb)];else{if(_0x375727[0x0]['language']==_0x41c881(0x1b8))var _0x2240d0=users[_0x41c881(0x1b8)];else{if(_0x375727[0x0]['language']==_0x41c881(0xe8))var _0x2240d0=users[_0x41c881(0xe8)];else{if(_0x375727[0x0][_0x41c881(0xf9)]==_0x41c881(0x1b4))var _0x2240d0=users[_0x41c881(0x1b4)];else{if(_0x375727[0x0][_0x41c881(0xf9)]==_0x41c881(0x1a7))var _0x2240d0=users[_0x41c881(0x188)];else{if(_0x375727[0x0][_0x41c881(0xf9)]==_0x41c881(0x16c))var _0x2240d0=users[_0x41c881(0x16c)];else{if(_0x375727[0x0][_0x41c881(0xf9)]==_0x41c881(0x118))var _0x2240d0=users[_0x41c881(0x1d2)];}}}}}}}_0x2f568e[_0x41c881(0x1a5)](_0x41c881(0x115),{'success':_0xb4cdc0[_0x41c881(0xf8)]('success'),'errors':_0xb4cdc0[_0x41c881(0xf8)](_0x41c881(0xd0)),'role':_0x4aae8f,'profile':_0x2ce695,'customer':_0x2a6c66,'warehouse':_0x2d7c82,'product':_0x1a94b0,'user':_0x2c3d59,'master_shop':_0x375727,'unit':_0x31cb2d,'language':_0x2240d0});}catch(_0x34b75a){console[_0x41c881(0x18d)](_0x34b75a);}}),router[a0_0x292ad1(0x137)](a0_0x292ad1(0x1d8),auth,async(_0x13b76b,_0x2f7e32)=>{var _0x257e3b=a0_0x292ad1;try{const _0x441618=_0x13b76b[_0x257e3b(0x155)]['id'],{invoice:_0x407a47,warehouse_name:_0x1f307a,room:_0x16367f}=_0x13b76b['body'],_0x2709d6=await sales_finished['findOne']({'invoice':_0x407a47}),_0x3ae721=_0x2709d6[_0x257e3b(0x1bc)][_0x257e3b(0x15f)](async _0x38e8e1=>{var _0x2929c2=_0x257e3b,_0x4b7244=await warehouse[_0x2929c2(0x182)]({'name':_0x1f307a,'room':_0x38e8e1[_0x2929c2(0x190)],'warehouse_category':_0x2929c2(0x1dd)});const _0x3db5d4=_0x4b7244['product_details'][_0x2929c2(0x15f)](_0x46f1b7=>{var _0x112408=_0x2929c2;_0x46f1b7[_0x112408(0x14e)]==_0x38e8e1[_0x112408(0x14e)]&&_0x46f1b7[_0x112408(0x124)]==_0x38e8e1[_0x112408(0x124)]&&_0x46f1b7[_0x112408(0xe5)]==_0x38e8e1['expiry_date']&&_0x46f1b7[_0x112408(0xd1)]==_0x38e8e1[_0x112408(0xd1)]&&_0x46f1b7[_0x112408(0xff)]==_0x38e8e1['batch_code']&&_0x46f1b7[_0x112408(0x126)]==_0x38e8e1[_0x112408(0x126)]&&(_0x46f1b7[_0x112408(0x17b)]=Math[_0x112408(0x1dc)](_0x46f1b7['product_stock'])-Math[_0x112408(0x1dc)](_0x38e8e1['quantity']));});return _0x4b7244;});Promise[_0x257e3b(0x1a2)](_0x3ae721)[_0x257e3b(0xfb)](async _0x17e6ca=>{var _0x9dfb30=_0x257e3b;try{for(const _0x49554d of _0x17e6ca){await _0x49554d[_0x9dfb30(0x156)]();}_0x2709d6[_0x9dfb30(0x1db)]=_0x9dfb30(0x103);const _0x4bafe6=await _0x2709d6[_0x9dfb30(0x156)](),_0x1dddff=await master_shop[_0x9dfb30(0x11a)](),_0x1e698a=await email_settings[_0x9dfb30(0x182)](),_0x826829=await supervisor_settings[_0x9dfb30(0x11a)]();var _0x4da48f=_0x2709d6[_0x9dfb30(0x1bc)],_0x3dbe89='',_0x36757a;for(_0x36757a in _0x4da48f){var _0x289f5b='FG';_0x2709d6[_0x9dfb30(0x150)]=='DRY\x20GOODS'&&(_0x289f5b='DG'),_0x3dbe89+=_0x9dfb30(0x199)+_0x9dfb30(0x19c)+_0x4da48f[_0x36757a]['product_name']+_0x9dfb30(0x1d6)+_0x9dfb30(0x19c)+_0x4da48f[_0x36757a][_0x9dfb30(0xf1)]+_0x9dfb30(0x1d6)+_0x9dfb30(0x19c)+_0x4da48f[_0x36757a][_0x9dfb30(0x163)]+_0x9dfb30(0x1d6)+_0x9dfb30(0x19c)+_0x4da48f[_0x36757a][_0x9dfb30(0x187)]+_0x9dfb30(0x1d6)+_0x9dfb30(0x19c)+_0x4da48f[_0x36757a][_0x9dfb30(0x1ab)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2709d6[_0x9dfb30(0x150)]+_0x9dfb30(0x1d6)+_0x9dfb30(0x19c)+_0x4da48f[_0x36757a][_0x9dfb30(0x190)]+_0x9dfb30(0x1d6)+_0x9dfb30(0x19c)+_0x289f5b+_0x4da48f[_0x36757a][_0x9dfb30(0x124)]+'</td>';}let _0x28b77f=nodemailer[_0x9dfb30(0x1cb)]({'host':_0x1e698a[_0x9dfb30(0x166)],'port':Number(_0x1e698a[_0x9dfb30(0x104)]),'secure':![],'auth':{'user':_0x1e698a[_0x9dfb30(0x173)],'pass':_0x1e698a[_0x9dfb30(0xd3)]}}),_0x661c7d={'from':_0x1e698a[_0x9dfb30(0x173)],'to':_0x826829[0x0][_0x9dfb30(0xd2)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x9dfb30(0x101),'path':__dirname+_0x9dfb30(0x1ce)+_0x9dfb30(0x117)+_0x1dddff[0x0][_0x9dfb30(0x19a)],'cid':_0x9dfb30(0xd5)}],'html':_0x9dfb30(0x107)+'<html><head><title></title>'+_0x9dfb30(0x151)+_0x9dfb30(0x13b)+_0x9dfb30(0xe7)+'<div>'+_0x9dfb30(0x1d3)+_0x9dfb30(0xf3)+_0x9dfb30(0x13b)+_0x9dfb30(0x1bd)+_0x1dddff[0x0][_0x9dfb30(0x12d)]+'\x20</h2>'+_0x9dfb30(0xf3)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x9dfb30(0x13b)+_0x9dfb30(0xf7)+_0x9dfb30(0x128)+_0x2709d6[_0x9dfb30(0x126)]+'\x20'+_0x9dfb30(0x172)+_0x9dfb30(0x1c4)+_0x2709d6[_0x9dfb30(0x121)]+'\x20'+_0x9dfb30(0x14a)+'</h5>'+'</div>'+_0x9dfb30(0x143)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x9dfb30(0x199)+_0x9dfb30(0xfa)+_0x9dfb30(0x110)+_0x9dfb30(0x12e)+_0x9dfb30(0xf4)+_0x9dfb30(0x181)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x9dfb30(0x180)+_0x9dfb30(0x167)+_0x9dfb30(0x157)+_0x9dfb30(0x178)+_0x9dfb30(0x1d9)+'\x20'+_0x3dbe89+'\x20'+'</tbody>'+_0x9dfb30(0x170)+_0x9dfb30(0x13b)+_0x9dfb30(0x10d)+_0x9dfb30(0x125)+_0x1dddff[0x0][_0x9dfb30(0x12d)]+_0x9dfb30(0xe2)+_0x9dfb30(0xf3)+_0x9dfb30(0xf3)+_0x9dfb30(0x198)};_0x28b77f['sendMail'](_0x661c7d,function(_0x48049d,_0x45ba1e){var _0x58aae5=_0x9dfb30;_0x48049d?(console[_0x58aae5(0x18d)](_0x48049d),console[_0x58aae5(0x18d)](_0x58aae5(0x168))):console['log'](_0x58aae5(0x16a));}),_0x13b76b['flash']('success',_0x9dfb30(0xdf)),_0x2f7e32[_0x9dfb30(0x1b9)](_0x9dfb30(0xd4)+_0x441618);}catch(_0x306ec0){console[_0x9dfb30(0x184)](_0x306ec0),_0x2f7e32[_0x9dfb30(0x196)](0x1f4)[_0x9dfb30(0x185)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x2ae352=>{var _0x41ef08=_0x257e3b;console['error'](_0x2ae352),_0x2f7e32[_0x41ef08(0x196)](0x1f4)[_0x41ef08(0x185)]({'error':_0x41ef08(0x11c)});});}catch(_0x4eedb7){console['log'](_0x4eedb7);}}),router[a0_0x292ad1(0xe6)](a0_0x292ad1(0x1bb),auth,async(_0x4113ff,_0xa1dafd)=>{var _0x5d99b2=a0_0x292ad1;try{const {username:_0x4d75b1,email:_0x360d7a,role:_0x27b9d9}=_0x4113ff[_0x5d99b2(0xfd)],_0x38d8e4=_0x4113ff[_0x5d99b2(0xfd)],_0x3f5741=await profile[_0x5d99b2(0x182)]({'email':_0x38d8e4['email']}),_0x31f35d=await master_shop[_0x5d99b2(0x11a)](),_0x8f43ed=_0x4113ff[_0x5d99b2(0x155)]['id'],_0x3a1738=await sales_finished[_0x5d99b2(0x1ac)](_0x8f43ed);let _0x5a2b3d=new Date(_0x3a1738['expiry_date']),_0x15d1df=('0'+_0x5a2b3d[_0x5d99b2(0x165)]())[_0x5d99b2(0xd6)](-0x2),_0x430f8e=('0'+(_0x5a2b3d[_0x5d99b2(0x175)]()+0x1))[_0x5d99b2(0xd6)](-0x2),_0x33d4aa=_0x5a2b3d['getFullYear'](),_0x277d4f=_0x33d4aa+'-'+_0x430f8e+'-'+_0x15d1df;var _0x343014=[_0x5d99b2(0x10e),_0x5d99b2(0x12f)];const _0x2ac104=await warehouse[_0x5d99b2(0x127)]([{'$match':{'name':_0x3a1738[_0x5d99b2(0x150)],'room':_0x3a1738[_0x5d99b2(0xd8)]}},{'$unwind':_0x5d99b2(0x191)},{'$group':{'_id':_0x5d99b2(0x17d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5d99b2(0xed)},'bay':{'$first':_0x5d99b2(0x1b6)},'bin':{'$first':_0x5d99b2(0x18a)},'type':{'$first':_0x5d99b2(0x169)},'floorlevel':{'$first':_0x5d99b2(0x1bf)},'primary_code':{'$first':_0x5d99b2(0x123)},'secondary_code':{'$first':_0x5d99b2(0x15b)},'product_code':{'$first':_0x5d99b2(0x162)},'storage':{'$first':_0x5d99b2(0x1ad)},'rack':{'$first':_0x5d99b2(0xfc)}}}]),_0xdca1ca=await customer[_0x5d99b2(0x11a)]({});let _0x498109;if(_0x38d8e4[_0x5d99b2(0x1d5)]=='staff'){const _0x231a59=await staff[_0x5d99b2(0x182)]({'email':_0x38d8e4['email']});_0x498109=await warehouse['aggregate']([{'$match':{'status':_0x5d99b2(0x154),'name':_0x231a59[_0x5d99b2(0x109)]}},{'$group':{'_id':_0x5d99b2(0x15c),'name':{'$first':_0x5d99b2(0x15c)}}}]);}else _0x498109=await warehouse['aggregate']([{'$match':{'status':_0x5d99b2(0x154)}},{'$group':{'_id':_0x5d99b2(0x15c),'name':{'$first':_0x5d99b2(0x15c)}}}]);const _0x427122=await product[_0x5d99b2(0x11a)]({});if(_0x31f35d[0x0][_0x5d99b2(0xf9)]=='English\x20(US)'){var _0x1c1667=users['English'];console[_0x5d99b2(0x18d)](_0x1c1667);}else{if(_0x31f35d[0x0]['language']=='Hindi')var _0x1c1667=users[_0x5d99b2(0xdb)];else{if(_0x31f35d[0x0][_0x5d99b2(0xf9)]==_0x5d99b2(0x1b8))var _0x1c1667=users[_0x5d99b2(0x1b8)];else{if(_0x31f35d[0x0][_0x5d99b2(0xf9)]==_0x5d99b2(0xe8))var _0x1c1667=users[_0x5d99b2(0xe8)];else{if(_0x31f35d[0x0][_0x5d99b2(0xf9)]=='French')var _0x1c1667=users[_0x5d99b2(0x1b4)];else{if(_0x31f35d[0x0][_0x5d99b2(0xf9)]=='Portuguese\x20(BR)')var _0x1c1667=users[_0x5d99b2(0x188)];else{if(_0x31f35d[0x0][_0x5d99b2(0xf9)]==_0x5d99b2(0x16c))var _0x1c1667=users[_0x5d99b2(0x16c)];else{if(_0x31f35d[0x0]['language']=='Arabic\x20(ae)')var _0x1c1667=users['Arabic'];}}}}}}}_0xa1dafd[_0x5d99b2(0x1a5)](_0x5d99b2(0x16d),{'success':_0x4113ff[_0x5d99b2(0xf8)](_0x5d99b2(0x1a0)),'errors':_0x4113ff[_0x5d99b2(0xf8)](_0x5d99b2(0xd0)),'role':_0x38d8e4,'profile':_0x3f5741,'customer':_0xdca1ca,'warehouse':_0x498109,'product':_0x2ac104,'user':_0x3a1738,'master_shop':_0x31f35d,'unit':_0x427122,'language':_0x1c1667,'rooms_data':_0x343014,'ed_fullDate':_0x277d4f});}catch(_0x1eb07c){console[_0x5d99b2(0x18d)](_0x1eb07c);}}),router[a0_0x292ad1(0x137)](a0_0x292ad1(0x1bb),auth,async(_0x220b3e,_0x30163e)=>{var _0x18a6f8=a0_0x292ad1;try{const _0x2e6154=_0x220b3e['params']['id'],_0x2de8c8=await sales_finished['findOne']({'_id':_0x220b3e[_0x18a6f8(0x155)]['id']}),_0x26d90e=await warehouse[_0x18a6f8(0x182)]({'name':_0x2de8c8['warehouse_name'],'room':_0x220b3e[_0x18a6f8(0x134)][_0x18a6f8(0xd8)],'warehouse_category':_0x18a6f8(0x1dd)}),{invoice:_0x30c921,customer:_0x12a6ae,date:_0x229d4a,warehouse_name:_0x2c49f3,product_name:_0x4e25e2,stock:_0x2d2ace,adjust_qty:_0x46921a,note:_0xb728b9,room:_0x274acd,primary_code:_0x585319,secondary_code:_0x151128,prod_code:_0x4718a8,level:_0x44931f,isle:_0x531a8f,pallet:_0x3e8ae9,expiry_date:_0x1d3da5}=_0x220b3e['body'];if(typeof _0x4e25e2==_0x18a6f8(0xe4))var _0x2059de=[_0x220b3e[_0x18a6f8(0x134)]['product_name']],_0x54cef5=[_0x220b3e['body'][_0x18a6f8(0x17f)]],_0x1d3ff2=[_0x220b3e[_0x18a6f8(0x134)]['adjust_qty']],_0x41791b=[_0x220b3e['body'][_0x18a6f8(0x13a)]],_0x2a54b6=[_0x220b3e[_0x18a6f8(0x134)]['secondary_code']],_0x1e0e6e=[_0x220b3e['body'][_0x18a6f8(0x17a)]],_0x3a3d08=[_0x220b3e[_0x18a6f8(0x134)]['level']],_0x32df85=[_0x220b3e[_0x18a6f8(0x134)]['expiry_date']];else var _0x2059de=[..._0x220b3e[_0x18a6f8(0x134)][_0x18a6f8(0x14e)]],_0x54cef5=[..._0x220b3e[_0x18a6f8(0x134)]['stock']],_0x1d3ff2=[..._0x220b3e[_0x18a6f8(0x134)]['adjust_qty']],_0x41791b=[..._0x220b3e[_0x18a6f8(0x134)]['primary_code']],_0x2a54b6=[..._0x220b3e[_0x18a6f8(0x134)][_0x18a6f8(0x1c7)]],_0x1e0e6e=[..._0x220b3e['body'][_0x18a6f8(0x17a)]],_0x3a3d08=[..._0x220b3e[_0x18a6f8(0x134)][_0x18a6f8(0xcb)]],_0x32df85=[..._0x220b3e['body'][_0x18a6f8(0xe5)]];const _0x42c880=_0x2059de['map'](_0x1b78c=>{return _0x1b78c={'product_name':_0x1b78c};});_0x54cef5[_0x18a6f8(0xdd)]((_0x11d729,_0x1134ec)=>{_0x42c880[_0x1134ec]['stock']=_0x11d729;}),_0x1d3ff2[_0x18a6f8(0xdd)]((_0x3a8f41,_0x4e1260)=>{var _0x155d36=_0x18a6f8;_0x42c880[_0x4e1260][_0x155d36(0x163)]=_0x3a8f41;}),_0x41791b[_0x18a6f8(0xdd)]((_0x5af892,_0x484de7)=>{var _0x467b11=_0x18a6f8;_0x42c880[_0x484de7][_0x467b11(0x13a)]=_0x5af892;}),_0x2a54b6[_0x18a6f8(0xdd)]((_0x58db62,_0x4742ac)=>{_0x42c880[_0x4742ac]['secondary_code']=_0x58db62;}),_0x1e0e6e[_0x18a6f8(0xdd)]((_0x301ffb,_0xcc0dd4)=>{var _0x4b7d9b=_0x18a6f8;_0x42c880[_0xcc0dd4][_0x4b7d9b(0xf1)]=_0x301ffb;}),_0x3a3d08[_0x18a6f8(0xdd)]((_0xde2dc7,_0x4e7f89)=>{var _0x58108c=_0x18a6f8;_0x42c880[_0x4e7f89][_0x58108c(0xcb)]=_0xde2dc7;}),_0x32df85[_0x18a6f8(0xdd)]((_0x125d8b,_0x2cf42c)=>{var _0x68bacd=_0x18a6f8;_0x42c880[_0x2cf42c][_0x68bacd(0xe5)]=_0x125d8b;});var _0x745694=0x0;_0x42c880[_0x18a6f8(0xdd)](_0x55afc4=>{var _0x43fa41=_0x18a6f8;console[_0x43fa41(0x18d)](_0x43fa41(0x148),_0x55afc4),(parseInt(_0x55afc4[_0x43fa41(0x17f)])<parseInt(_0x55afc4[_0x43fa41(0x163)])||parseInt(_0x55afc4[_0x43fa41(0x163)])==0x0)&&_0x745694++;});if(_0x745694!=0x0)return _0x220b3e[_0x18a6f8(0xf8)](_0x18a6f8(0xd0),_0x18a6f8(0xe9)),_0x30163e['redirect'](_0x18a6f8(0x142));_0x2de8c8[_0x18a6f8(0x1bc)][_0x18a6f8(0xdd)](_0x1533c9=>{const _0x4b3a7a=_0x26d90e['product_details']['map'](_0x305d50=>{var _0x30da4d=a0_0xe539;_0x305d50['product_name']==_0x1533c9[_0x30da4d(0x14e)]&&_0x305d50[_0x30da4d(0x124)]==_0x1533c9[_0x30da4d(0x124)]&&(_0x305d50['product_stock']=parseInt(_0x305d50[_0x30da4d(0x17b)])+parseInt(_0x1533c9['quantity']));});}),await _0x26d90e['save']();const _0x5375b0=_0x42c880['filter'](_0x23ca6a=>_0x23ca6a[_0x18a6f8(0x163)]!=='0'&&_0x23ca6a[_0x18a6f8(0x163)]!=='');_0x2de8c8['invoice']=_0x30c921,_0x2de8c8[_0x18a6f8(0xd9)]=_0x12a6ae,_0x2de8c8['date']=_0x229d4a,_0x2de8c8[_0x18a6f8(0x150)]=_0x2c49f3,_0x2de8c8['sale_product']=_0x5375b0,_0x2de8c8[_0x18a6f8(0x1da)]=_0xb728b9,_0x2de8c8[_0x18a6f8(0xd8)]=_0x274acd;const _0x105f7f=await _0x2de8c8['save'](),_0x5b7850=await sales_finished[_0x18a6f8(0x182)]({'_id':_0x220b3e[_0x18a6f8(0x155)]['id']}),_0x35a340=await warehouse[_0x18a6f8(0x182)]({'name':_0x2c49f3,'room':_0x274acd,'warehouse_category':_0x18a6f8(0x1dd)});_0x5b7850[_0x18a6f8(0x1bc)][_0x18a6f8(0xdd)](_0x5e291b=>{var _0x336ed4=_0x18a6f8;const _0x3dd66b=_0x35a340[_0x336ed4(0x149)][_0x336ed4(0x15f)](_0x1971a0=>{var _0x507d66=_0x336ed4;_0x1971a0[_0x507d66(0x14e)]==_0x5e291b['product_name']&&_0x1971a0[_0x507d66(0x124)]==_0x5e291b[_0x507d66(0x124)]&&(_0x1971a0['product_stock']=parseInt(_0x1971a0[_0x507d66(0x17b)])-parseInt(_0x5e291b['quantity']));});}),console[_0x18a6f8(0x18d)](_0x18a6f8(0x19d),_0x35a340),await _0x35a340[_0x18a6f8(0x156)]();const _0x412b6c=await c_payment_data[_0x18a6f8(0x182)]({'invoice':_0x220b3e[_0x18a6f8(0x134)]['invoice']});_0x412b6c[_0x18a6f8(0x194)]=_0x220b3e[_0x18a6f8(0x134)][_0x18a6f8(0x194)],await _0x412b6c['save'](),_0x220b3e[_0x18a6f8(0xf8)]('success',_0x18a6f8(0xdf)),_0x30163e['redirect'](_0x18a6f8(0xd7));}catch(_0x860327){console['log'](_0x860327);}}),router[a0_0x292ad1(0x137)](a0_0x292ad1(0x16e),auth,async(_0x356090,_0x13c549)=>{var _0x70e8bc=a0_0x292ad1;try{const _0x3aad81=_0x356090[_0x70e8bc(0x155)]['id'],{invoice:_0x355d94,customer:_0x56187f,receivable_amount:_0x3e068b,received_amount:_0x50c1e7}=_0x356090[_0x70e8bc(0x134)],_0x5d76d8=await sales[_0x70e8bc(0x1ac)](_0x3aad81);console[_0x70e8bc(0x18d)](_0x5d76d8);var _0x128f7a=_0x3e068b-_0x50c1e7;console[_0x70e8bc(0x18d)](_0x50c1e7),_0x5d76d8['received_amount']=parseFloat(_0x50c1e7)+parseFloat(_0x5d76d8['received_amount']),_0x5d76d8[_0x70e8bc(0xdc)]=_0x128f7a,console[_0x70e8bc(0x18d)](_0x5d76d8);const _0x19ed7c=await _0x5d76d8['save'](),_0x41386a=await c_payment_data[_0x70e8bc(0x182)]({'invoice':_0x355d94});_0x41386a[_0x70e8bc(0x12a)]=_0x128f7a,await _0x41386a[_0x70e8bc(0x156)]();let _0x33b428=new Date(),_0x50d7f6=('0'+_0x33b428[_0x70e8bc(0x165)]())['slice'](-0x2),_0x3b06bd=('0'+(_0x33b428[_0x70e8bc(0x175)]()+0x1))[_0x70e8bc(0xd6)](-0x2),_0x7b0347=_0x33b428['getFullYear'](),_0x293a31=_0x7b0347+'-'+_0x3b06bd+'-'+_0x50d7f6;const _0x3a9b4a=new customer_payment({'invoice':_0x355d94,'date':_0x7b0347+'-'+_0x3b06bd+'-'+_0x50d7f6,'customer':_0x56187f,'reason':_0x70e8bc(0x132),'amount':_0x50c1e7}),_0x4365cf=await _0x3a9b4a['save']();_0x356090['flash'](_0x70e8bc(0x1a0),_0x70e8bc(0x11d)),_0x13c549[_0x70e8bc(0x1b9)]('/all_sales/view');}catch(_0x101862){console[_0x70e8bc(0x18d)](_0x101862);}}),router[a0_0x292ad1(0xe6)]('/invoice/:id',auth,async(_0xa5b738,_0x5b0ba3)=>{var _0x4ab9c3=a0_0x292ad1;try{const {username:_0x106f54,email:_0x5d51c1,role:_0xf10b66}=_0xa5b738['user'],_0x2437f8=_0xa5b738[_0x4ab9c3(0xfd)],_0x4d6500=await profile['findOne']({'email':_0x2437f8['email']}),_0x215bdc=await master_shop[_0x4ab9c3(0x11a)]();console['log']('master',_0x215bdc);const _0xb337cc=_0xa5b738[_0x4ab9c3(0x155)]['id'],_0x49aac9=await sales[_0x4ab9c3(0x1ac)](_0xb337cc);console[_0x4ab9c3(0x18d)](_0x49aac9);const _0x5eef9d=await customer[_0x4ab9c3(0x182)]({'name':_0x49aac9['customer']});console[_0x4ab9c3(0x18d)](_0x5eef9d);if(_0x215bdc[0x0]['language']==_0x4ab9c3(0x15d)){var _0x3caf51=users[_0x4ab9c3(0xe0)];console[_0x4ab9c3(0x18d)](_0x3caf51);}else{if(_0x215bdc[0x0]['language']==_0x4ab9c3(0xdb))var _0x3caf51=users[_0x4ab9c3(0xdb)];else{if(_0x215bdc[0x0]['language']==_0x4ab9c3(0x1b8))var _0x3caf51=users[_0x4ab9c3(0x1b8)];else{if(_0x215bdc[0x0]['language']==_0x4ab9c3(0xe8))var _0x3caf51=users[_0x4ab9c3(0xe8)];else{if(_0x215bdc[0x0][_0x4ab9c3(0xf9)]=='French')var _0x3caf51=users[_0x4ab9c3(0x1b4)];else{if(_0x215bdc[0x0]['language']==_0x4ab9c3(0x1a7))var _0x3caf51=users[_0x4ab9c3(0x188)];else{if(_0x215bdc[0x0][_0x4ab9c3(0xf9)]==_0x4ab9c3(0x16c))var _0x3caf51=users[_0x4ab9c3(0x16c)];else{if(_0x215bdc[0x0]['language']==_0x4ab9c3(0x118))var _0x3caf51=users[_0x4ab9c3(0x1d2)];}}}}}}}_0x5b0ba3[_0x4ab9c3(0x1a5)](_0x4ab9c3(0x14c),{'success':_0xa5b738[_0x4ab9c3(0xf8)](_0x4ab9c3(0x1a0)),'errors':_0xa5b738[_0x4ab9c3(0xf8)](_0x4ab9c3(0xd0)),'role':_0x2437f8,'profile':_0x4d6500,'master_shop':_0x215bdc,'customers':_0x5eef9d,'sales':_0x49aac9,'language':_0x3caf51});}catch(_0x573938){console[_0x4ab9c3(0x18d)](_0x573938);}}),router[a0_0x292ad1(0xe6)](a0_0x292ad1(0x133),auth,async(_0x1ddb48,_0x1e99f4)=>{var _0x10ef21=a0_0x292ad1;try{const {username:_0x471674,email:_0x3b9219,role:_0x291633}=_0x1ddb48[_0x10ef21(0xfd)],_0x2f8d39=_0x1ddb48[_0x10ef21(0xfd)],_0x4ceec8=await profile[_0x10ef21(0x182)]({'email':_0x2f8d39['email']}),_0x2ef772=await master_shop['find'](),_0x37561e=_0x1ddb48[_0x10ef21(0x155)]['id'],_0x44c9ef=await sales_finished[_0x10ef21(0x1ac)](_0x37561e),_0x870b7b=await warehouse[_0x10ef21(0x127)]([{'$match':{'name':_0x44c9ef[_0x10ef21(0x150)]}},{'$unwind':_0x10ef21(0x191)},{'$group':{'_id':_0x10ef21(0x17d),'name':{'$first':_0x10ef21(0x12c)},'product_stock':{'$first':_0x10ef21(0xed)},'bay':{'$first':_0x10ef21(0x1b6)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x10ef21(0x169)},'floorlevel':{'$first':_0x10ef21(0x1bf)},'primary_code':{'$first':_0x10ef21(0x123)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x10ef21(0x162)},'storage':{'$first':_0x10ef21(0x1ad)},'rack':{'$first':_0x10ef21(0xfc)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x10ef21(0xea)},'unit':{'$first':_0x10ef21(0x161)},'secondary_unit':{'$first':_0x10ef21(0x1c8)},'maxProducts':{'$first':_0x10ef21(0x18c)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x37044f=await product[_0x10ef21(0x11a)]({}),_0x11cb7d=await warehouse[_0x10ef21(0x127)]([{'$match':{'status':_0x10ef21(0x154),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x10ef21(0x108),'$ne':_0x10ef21(0x152)}}},{'$group':{'_id':_0x10ef21(0x15c),'name':{'$first':_0x10ef21(0x15c)}}},{'$sort':{'name':0x1}}]);var _0x33c5db=[_0x10ef21(0x1ae)];const _0x3e2485=await warehouse[_0x10ef21(0x127)]([{'$match':{'status':_0x10ef21(0x154),'name':_0x10ef21(0x152)}},{'$group':{'_id':_0x10ef21(0x15c),'name':{'$first':_0x10ef21(0x15c)}}},{'$sort':{'name':0x1}}]);if(_0x2ef772[0x0][_0x10ef21(0xf9)]==_0x10ef21(0x15d)){var _0x1a5e17=users['English'];console[_0x10ef21(0x18d)](_0x1a5e17);}else{if(_0x2ef772[0x0][_0x10ef21(0xf9)]=='Hindi')var _0x1a5e17=users[_0x10ef21(0xdb)];else{if(_0x2ef772[0x0][_0x10ef21(0xf9)]=='German')var _0x1a5e17=users[_0x10ef21(0x1b8)];else{if(_0x2ef772[0x0][_0x10ef21(0xf9)]==_0x10ef21(0xe8))var _0x1a5e17=users[_0x10ef21(0xe8)];else{if(_0x2ef772[0x0]['language']==_0x10ef21(0x1b4))var _0x1a5e17=users[_0x10ef21(0x1b4)];else{if(_0x2ef772[0x0][_0x10ef21(0xf9)]==_0x10ef21(0x1a7))var _0x1a5e17=users[_0x10ef21(0x188)];else{if(_0x2ef772[0x0][_0x10ef21(0xf9)]==_0x10ef21(0x16c))var _0x1a5e17=users['Chinese'];else{if(_0x2ef772[0x0][_0x10ef21(0xf9)]=='Arabic\x20(ae)')var _0x1a5e17=users[_0x10ef21(0x1d2)];}}}}}}}_0x1e99f4[_0x10ef21(0x1a5)](_0x10ef21(0xe1),{'success':_0x1ddb48['flash'](_0x10ef21(0x1a0)),'errors':_0x1ddb48[_0x10ef21(0xf8)](_0x10ef21(0xd0)),'role':_0x2f8d39,'profile':_0x4ceec8,'user':_0x44c9ef,'stock':_0x870b7b,'master_shop':_0x2ef772,'unit':_0x37044f,'language':_0x1a5e17,'warehouses':_0x11cb7d,'rooms':_0x33c5db,'warehouse_QA':_0x3e2485});}catch(_0x2afbe9){console[_0x10ef21(0x18d)](_0x2afbe9),_0x1e99f4[_0x10ef21(0x196)](0xc8)[_0x10ef21(0x185)]({'message':_0x2afbe9[_0x10ef21(0x13d)]});}}),router[a0_0x292ad1(0x137)]('/view/return_sales/:id',auth,async(_0x26bd1f,_0x5cd4cf)=>{var _0x561c7f=a0_0x292ad1;if(_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xda)]=='QA')try{const {invoice:_0x3be80e,date:_0x1f68c0,warehouse_name:_0x43695d,product_name:_0x4e5f7a,primary_code:_0x114747,secondary_code:_0x54a00d,product_code:_0x1ccf70,sales_quantity:_0x1f7594,stocks:_0x44f59a,return_qty:_0x254995,Room_name:_0xa473df,to_warehouse_name_QA:_0x36bed0,to_Room_name_QA:_0x200b20,note:_0x27914a,for_categorize:_0x28065d,product_name_QA1:_0xb2800f}=_0x26bd1f[_0x561c7f(0x134)];if(typeof _0xb2800f==_0x561c7f(0xe4))var _0x1df3bf=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xec)]],_0x491bcc=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x13f)]],_0x1d8222=[_0x26bd1f['body']['secondary_code_QA']],_0x261560=[_0x26bd1f[_0x561c7f(0x134)]['product_code_QA']],_0x1aa829=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x164)]],_0x2f10d0=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x11e)]],_0xe0867e=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x131)]],_0x5c2e52=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xcc)]],_0x59c17d=[_0x26bd1f['body']['maxProducts_QA']],_0x299b5b=[_0x26bd1f[_0x561c7f(0x134)]['batch_code_QA']],_0x3e4edc=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x1c0)]],_0x206cb4=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x1cd)]],_0x401095=[_0x26bd1f[_0x561c7f(0x134)]['production_date_QA']],_0x2e99d7=[_0x26bd1f['body']['expiry_date_QA']];else var _0x1df3bf=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xec)]],_0x491bcc=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x13f)]],_0x1d8222=[..._0x26bd1f[_0x561c7f(0x134)]['secondary_code_QA']],_0x261560=[..._0x26bd1f['body']['product_code_QA']],_0x1aa829=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x164)]],_0x2f10d0=[..._0x26bd1f[_0x561c7f(0x134)]['stocks_QA']],_0xe0867e=[..._0x26bd1f['body'][_0x561c7f(0x131)]],_0x5c2e52=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xcc)]],_0x59c17d=[..._0x26bd1f['body'][_0x561c7f(0x153)]],_0x299b5b=[..._0x26bd1f[_0x561c7f(0x134)]['batch_code_QA']],_0x3e4edc=[..._0x26bd1f['body'][_0x561c7f(0x1c0)]],_0x206cb4=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x1cd)]],_0x401095=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x16b)]],_0x2e99d7=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x122)]];const _0x5a943a=_0x1df3bf[_0x561c7f(0x15f)](_0xe35cb2=>{return _0xe35cb2={'product_name':_0xe35cb2};});_0x491bcc[_0x561c7f(0xdd)]((_0x506b3d,_0x3cbf89)=>{var _0x38bdc9=_0x561c7f;_0x5a943a[_0x3cbf89][_0x38bdc9(0x13a)]=_0x506b3d;}),_0x1d8222['forEach']((_0x209dd3,_0x41097c)=>{var _0x5e03d1=_0x561c7f;_0x5a943a[_0x41097c][_0x5e03d1(0x1c7)]=_0x209dd3;}),_0x261560[_0x561c7f(0xdd)]((_0x218c1a,_0x5774b4)=>{var _0x1e04d8=_0x561c7f;_0x5a943a[_0x5774b4][_0x1e04d8(0xf1)]=_0x218c1a;}),_0x1aa829[_0x561c7f(0xdd)]((_0x113ec0,_0x52f6e4)=>{var _0xbdd04f=_0x561c7f;_0x5a943a[_0x52f6e4][_0xbdd04f(0x113)]=_0x113ec0;}),_0x2f10d0[_0x561c7f(0xdd)]((_0x1626f2,_0x387d75)=>{_0x5a943a[_0x387d75]['stock']=_0x1626f2;}),_0xe0867e[_0x561c7f(0xdd)]((_0x56ff16,_0x342403)=>{_0x5a943a[_0x342403]['return_qty']=_0x56ff16;}),_0x5c2e52[_0x561c7f(0xdd)]((_0x4ae905,_0x181b94)=>{var _0x129062=_0x561c7f;_0x5a943a[_0x181b94][_0x129062(0x130)]=_0x4ae905;}),_0x59c17d[_0x561c7f(0xdd)]((_0x676f2f,_0x4a7f0f)=>{_0x5a943a[_0x4a7f0f]['maxProducts']=_0x676f2f;}),_0x299b5b[_0x561c7f(0xdd)]((_0x4a7d8d,_0x3c735f)=>{var _0x5dcf76=_0x561c7f;_0x5a943a[_0x3c735f][_0x5dcf76(0xff)]=_0x4a7d8d;}),_0x3e4edc[_0x561c7f(0xdd)]((_0x323537,_0x44dc68)=>{var _0x8c68c9=_0x561c7f;_0x5a943a[_0x44dc68][_0x8c68c9(0x1ab)]=_0x323537;}),_0x206cb4['forEach']((_0x46653f,_0x43c6d4)=>{var _0x5b4aea=_0x561c7f;_0x5a943a[_0x43c6d4][_0x5b4aea(0x187)]=_0x46653f;}),_0x401095[_0x561c7f(0xdd)]((_0x4a4ef9,_0x5872e5)=>{_0x5a943a[_0x5872e5]['production_date']=_0x4a4ef9;}),_0x2e99d7[_0x561c7f(0xdd)]((_0x5ccf7e,_0x4c4cc1)=>{var _0x41117e=_0x561c7f;_0x5a943a[_0x4c4cc1][_0x41117e(0xe5)]=_0x5ccf7e;});const _0x265f7d=await sales_finished[_0x561c7f(0x182)]({'invoice':_0x3be80e});_0x265f7d['return_data']=_0x561c7f(0x103);const _0xa7cfd2=await _0x265f7d[_0x561c7f(0x156)](),_0x4b4e05=new sales_return_finished({'invoice':_0x3be80e,'customer':_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xd9)],'date':_0x1f68c0,'warehouse_name':_0x43695d,'room':_0xa473df,'ToWarehouse':_0x36bed0,'ToRoom':_0x200b20,'return_sale_QA':_0x5a943a,'note':_0x27914a,'warehouse_cat':_0x28065d}),_0x231a14=await _0x4b4e05[_0x561c7f(0x156)](),_0x183532=await sales_return_finished[_0x561c7f(0x182)]({'invoice':_0x3be80e}),_0xf3a3af=await warehouse['findOne']({'name':_0x36bed0,'room':_0x200b20});_0x183532['return_sale_QA']['forEach'](_0x5e85d4=>{var _0xde3566=_0x561c7f,_0x381c55=0x0;const _0x13b617=_0xf3a3af[_0xde3566(0x149)][_0xde3566(0x15f)](_0x4dcb2c=>{var _0x7a89ff=_0xde3566;_0x4dcb2c[_0x7a89ff(0x14e)]==_0x5e85d4[_0x7a89ff(0x14e)]&&_0x4dcb2c[_0x7a89ff(0xe5)]==_0x5e85d4[_0x7a89ff(0xe5)]&&_0x4dcb2c[_0x7a89ff(0xd1)]==_0x5e85d4['production_date']&&_0x4dcb2c['batch_code']==_0x5e85d4[_0x7a89ff(0xff)]&&(_0x4dcb2c[_0x7a89ff(0x17b)]=parseInt(_0x4dcb2c[_0x7a89ff(0x17b)])+parseInt(_0x5e85d4[_0x7a89ff(0x1ba)]),_0x381c55++);});_0x381c55=='0'&&(_0xf3a3af[_0xde3566(0x149)]=_0xf3a3af[_0xde3566(0x149)][_0xde3566(0x1d1)]({'product_name':_0x5e85d4[_0xde3566(0x14e)],'product_stock':_0x5e85d4[_0xde3566(0x1ba)],'primary_code':_0x5e85d4['primary_code'],'secondary_code':_0x5e85d4[_0xde3566(0x1c7)],'product_code':_0x5e85d4['product_code'],'batch_code':_0x5e85d4['batch_code'],'maxPerUnit':_0x5e85d4[_0xde3566(0x130)],'production_date':_0x5e85d4[_0xde3566(0xd1)],'expiry_date':_0x5e85d4[_0xde3566(0xe5)],'secondary_unit':_0x5e85d4['secondary_unit'],'unit':_0x5e85d4['unit'],'maxProducts':_0x5e85d4['maxProducts'],'bay':_0x5e85d4[_0xde3566(0x124)]}));}),await _0xf3a3af[_0x561c7f(0x156)]();const _0x3bea29=new c_payment_data({'invoice':_0x3be80e,'customer':_0x26bd1f['body'][_0x561c7f(0xd9)],'reason':'Sale\x20Return'});await _0x3bea29[_0x561c7f(0x156)]();const _0x35ad9e=await master_shop[_0x561c7f(0x11a)](),_0x32d090=await email_settings['findOne'](),_0x179ce2=await customer[_0x561c7f(0x182)]({'name':_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xd9)]});_0x35ad9e[0x0][_0x561c7f(0x1aa)]==0x1?(right_currency=_0x35ad9e[0x0][_0x561c7f(0x10f)],left_currency=''):(right_currency='',left_currency=_0x35ad9e[0x0][_0x561c7f(0x10f)]);var _0x486027=_0x1df3bf,_0x41a8d3=_0xe0867e,_0x172985='',_0x6bf563;for(_0x6bf563 in _0x486027){_0x172985+='<tr>'+_0x561c7f(0x19c)+_0x486027[_0x6bf563]+_0x561c7f(0x1d6)+_0x561c7f(0x19c)+_0x41a8d3[_0x6bf563]+_0x561c7f(0x1d6)+_0x561c7f(0x157);}console[_0x561c7f(0x18d)](_0x561c7f(0x1a9),_0x172985);let _0x315f2f=nodemailer[_0x561c7f(0x1cb)]({'service':'gmail','auth':{'user':_0x32d090['email'],'pass':_0x32d090['password']}}),_0x503e9e={'from':_0x32d090[_0x561c7f(0x173)],'to':_0x179ce2[_0x561c7f(0x173)],'subject':_0x561c7f(0xde),'attachments':[{'filename':_0x561c7f(0x101),'path':__dirname+_0x561c7f(0x1ce)+_0x561c7f(0x117)+_0x35ad9e[0x0][_0x561c7f(0x19a)],'cid':_0x561c7f(0xd5)}],'html':_0x561c7f(0x107)+_0x561c7f(0xcd)+_0x561c7f(0x151)+_0x561c7f(0x13b)+_0x561c7f(0xe7)+_0x561c7f(0x13b)+_0x561c7f(0x1d3)+'</div>'+_0x561c7f(0x13b)+_0x561c7f(0x1bd)+_0x35ad9e[0x0][_0x561c7f(0x12d)]+_0x561c7f(0x13e)+_0x561c7f(0xf3)+_0x561c7f(0xf3)+_0x561c7f(0x10c)+'<div>'+_0x561c7f(0xf7)+_0x561c7f(0x128)+_0x3be80e+'\x20'+_0x561c7f(0x172)+'\x20Order\x20Date\x20:\x20'+_0x1f68c0+'\x20'+_0x561c7f(0x14a)+'</h5>'+_0x561c7f(0xf3)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x561c7f(0xfa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x561c7f(0x138)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x561c7f(0x157)+_0x561c7f(0x178)+_0x561c7f(0x1d9)+'\x20'+_0x172985+'\x20'+'</tbody>'+_0x561c7f(0x170)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x561c7f(0x125)+_0x35ad9e[0x0][_0x561c7f(0x12d)]+_0x561c7f(0xe2)+'</div>'+'</div>'+_0x561c7f(0x198)};_0x315f2f[_0x561c7f(0x186)](_0x503e9e,function(_0x3fcd75,_0x4b35b0){var _0x11d9e6=_0x561c7f;_0x3fcd75?(console[_0x11d9e6(0x18d)](_0x3fcd75),console[_0x11d9e6(0x18d)](_0x11d9e6(0x168))):console['log'](_0x11d9e6(0x16a));}),_0x26bd1f[_0x561c7f(0xf8)]('success','sales\x20item\x20return\x20successfull'),_0x5cd4cf[_0x561c7f(0x1b9)](_0x561c7f(0xd7));}catch(_0x34c455){_0x5cd4cf['status'](0xc8)[_0x561c7f(0x185)]({'message1':_0x34c455[_0x561c7f(0x13d)]});}else{if(_0x26bd1f['body'][_0x561c7f(0xda)]=='GS')try{const {invoice:_0x44a8cb,date:_0x389fc8,warehouse_name:_0x162958,product_name:_0x22b707,primary_code:_0x17d201,secondary_code:_0x4cb408,product_code:_0x2a506c,sales_quantity:_0x397174,stocks:_0x4c857e,return_qty:_0x1a6fbc,Room_name:_0x47a338,to_warehouse_name:_0x29f87e,to_Room_name:_0x35e29a,note:_0x4ad282,level:_0x1b26ca,isle:_0x3eb750,pallet:_0x1da617,for_categorize:_0x121ab6}=_0x26bd1f[_0x561c7f(0x134)];if(typeof _0x22b707==_0x561c7f(0xe4))var _0x1df3bf=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x14e)]],_0x491bcc=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x13a)]],_0x1d8222=[_0x26bd1f['body'][_0x561c7f(0x1c7)]],_0x261560=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xf1)]],_0x1aa829=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x18b)]],_0xe0867e=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x1ba)]],_0x2f3b85=[_0x26bd1f[_0x561c7f(0x134)]['bay']],_0x5c2e52=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x130)]],_0x59c17d=[_0x26bd1f['body'][_0x561c7f(0x135)]],_0x299b5b=[_0x26bd1f['body']['batch_code']],_0x3e4edc=[_0x26bd1f['body'][_0x561c7f(0x1ab)]],_0x206cb4=[_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x187)]],_0x401095=[_0x26bd1f['body'][_0x561c7f(0xd1)]],_0x2e99d7=[_0x26bd1f[_0x561c7f(0x134)]['expiry_date']];else var _0x1df3bf=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x14e)]],_0x491bcc=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x13a)]],_0x1d8222=[..._0x26bd1f['body'][_0x561c7f(0x1c7)]],_0x261560=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xf1)]],_0x1aa829=[..._0x26bd1f['body']['sales_quantity']],_0xe0867e=[..._0x26bd1f['body'][_0x561c7f(0x1ba)]],_0x2f3b85=[..._0x26bd1f[_0x561c7f(0x134)]['bay']],_0x5c2e52=[..._0x26bd1f[_0x561c7f(0x134)]['maxPerUnit']],_0x59c17d=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x135)]],_0x299b5b=[..._0x26bd1f[_0x561c7f(0x134)]['batch_code']],_0x3e4edc=[..._0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0x1ab)]],_0x206cb4=[..._0x26bd1f['body'][_0x561c7f(0x187)]],_0x401095=[..._0x26bd1f['body'][_0x561c7f(0xd1)]],_0x2e99d7=[..._0x26bd1f['body']['expiry_date']];const _0x3adbf0=_0x1df3bf[_0x561c7f(0x15f)](_0x18869d=>{return _0x18869d={'product_name':_0x18869d};});_0x491bcc[_0x561c7f(0xdd)]((_0x411d47,_0x193b99)=>{_0x3adbf0[_0x193b99]['primary_code']=_0x411d47;}),_0x1d8222['forEach']((_0xad9c42,_0x2bded6)=>{var _0x5569af=_0x561c7f;_0x3adbf0[_0x2bded6][_0x5569af(0x1c7)]=_0xad9c42;}),_0x261560[_0x561c7f(0xdd)]((_0x31b707,_0x5ac005)=>{var _0x22fc1e=_0x561c7f;_0x3adbf0[_0x5ac005][_0x22fc1e(0xf1)]=_0x31b707;}),_0x1aa829['forEach']((_0x5a909a,_0x159e30)=>{_0x3adbf0[_0x159e30]['sale_qty']=_0x5a909a;}),_0xe0867e[_0x561c7f(0xdd)]((_0x5970d8,_0x4e5252)=>{_0x3adbf0[_0x4e5252]['return_qty']=_0x5970d8;}),_0x2f3b85[_0x561c7f(0xdd)]((_0x2e76cf,_0x19e6bf)=>{var _0x176a7a=_0x561c7f;_0x3adbf0[_0x19e6bf][_0x176a7a(0x124)]=_0x2e76cf;}),_0x5c2e52[_0x561c7f(0xdd)]((_0x4b9c8b,_0x4e3573)=>{var _0x4207bc=_0x561c7f;_0x3adbf0[_0x4e3573][_0x4207bc(0x130)]=_0x4b9c8b;}),_0x59c17d[_0x561c7f(0xdd)]((_0x31a8ee,_0x4c032a)=>{var _0x31dc0c=_0x561c7f;_0x3adbf0[_0x4c032a][_0x31dc0c(0x135)]=_0x31a8ee;}),_0x299b5b[_0x561c7f(0xdd)]((_0x7731d4,_0x1abc6c)=>{var _0x5e7d48=_0x561c7f;_0x3adbf0[_0x1abc6c][_0x5e7d48(0xff)]=_0x7731d4;}),_0x3e4edc[_0x561c7f(0xdd)]((_0x1297e2,_0x522a09)=>{var _0x4c4302=_0x561c7f;_0x3adbf0[_0x522a09][_0x4c4302(0x1ab)]=_0x1297e2;}),_0x206cb4['forEach']((_0x102718,_0xab5c2b)=>{var _0x5f4841=_0x561c7f;_0x3adbf0[_0xab5c2b][_0x5f4841(0x187)]=_0x102718;}),_0x401095[_0x561c7f(0xdd)]((_0x3a3c0c,_0x46066f)=>{var _0x3702d3=_0x561c7f;_0x3adbf0[_0x46066f][_0x3702d3(0xd1)]=_0x3a3c0c;}),_0x2e99d7[_0x561c7f(0xdd)]((_0x548733,_0xb3b92c)=>{_0x3adbf0[_0xb3b92c]['expiry_date']=_0x548733;});var _0xd46ae=0x0;_0x3adbf0[_0x561c7f(0xdd)](_0x105ed2=>{var _0x280d5a=_0x561c7f;(parseInt(_0x105ed2[_0x280d5a(0x113)])<parseInt(_0x105ed2['return_qty'])||parseInt(_0x105ed2[_0x280d5a(0x17f)])<parseInt(_0x105ed2[_0x280d5a(0x1ba)])&&parseInt(_0x105ed2[_0x280d5a(0x113)])>parseInt(_0x105ed2[_0x280d5a(0x1ba)])||parseInt(_0x105ed2[_0x280d5a(0x1ba)])==0x0)&&_0xd46ae++;});if(_0xd46ae!=0x0)return _0x26bd1f['flash'](_0x561c7f(0xd0),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x5cd4cf['redirect'](_0x561c7f(0x142));const _0x4425ec=await sales_finished['findOne']({'invoice':_0x44a8cb});_0x4425ec[_0x561c7f(0x139)]=_0x561c7f(0x103);const _0x1fc950=await _0x4425ec['save'](),_0x457da3=new sales_return_finished({'invoice':_0x44a8cb,'customer':_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xd9)],'date':_0x389fc8,'warehouse_name':_0x162958,'room':_0x47a338,'ToWarehouse':_0x29f87e,'ToRoom':_0x35e29a,'return_sale':_0x3adbf0,'note':_0x4ad282,'warehouse_cat':_0x121ab6}),_0x11cc81=await _0x457da3[_0x561c7f(0x156)](),_0x1086d7=await sales_return_finished[_0x561c7f(0x182)]({'invoice':_0x44a8cb}),_0x5b306a=await warehouse[_0x561c7f(0x182)]({'name':_0x29f87e,'room':_0x35e29a,'warehouse_category':_0x561c7f(0x1dd)});_0x1086d7[_0x561c7f(0xeb)][_0x561c7f(0xdd)](_0x458d05=>{var _0x277390=_0x561c7f,_0x48c769=0x0;const _0x33e421=_0x5b306a[_0x277390(0x149)][_0x277390(0x15f)](_0x309d25=>{var _0xe39adb=_0x277390;_0x309d25[_0xe39adb(0x14e)]==_0x458d05[_0xe39adb(0x14e)]&&_0x309d25[_0xe39adb(0x124)]==_0x458d05[_0xe39adb(0x124)]&&_0x309d25[_0xe39adb(0xe5)]==_0x458d05[_0xe39adb(0xe5)]&&_0x309d25[_0xe39adb(0xd1)]==_0x458d05[_0xe39adb(0xd1)]&&_0x309d25['batch_code']==_0x458d05[_0xe39adb(0xff)]&&(_0x309d25[_0xe39adb(0x17b)]=parseInt(_0x309d25[_0xe39adb(0x17b)])+parseInt(_0x458d05[_0xe39adb(0x1ba)]),_0x48c769++);});_0x48c769=='0'&&(_0x5b306a[_0x277390(0x149)]=_0x5b306a[_0x277390(0x149)]['concat']({'product_name':_0x458d05[_0x277390(0x14e)],'product_stock':_0x458d05[_0x277390(0x1ba)],'primary_code':_0x458d05['primary_code'],'secondary_code':_0x458d05[_0x277390(0x1c7)],'product_code':_0x458d05[_0x277390(0xf1)],'bay':_0x458d05['bay'],'batch_code':_0x458d05['batch_code'],'maxPerUnit':_0x458d05[_0x277390(0x130)],'production_date':_0x458d05[_0x277390(0xd1)],'expiry_date':_0x458d05['expiry_date'],'secondary_unit':_0x458d05[_0x277390(0x1ab)],'unit':_0x458d05[_0x277390(0x187)],'maxProducts':_0x458d05['maxProducts']}));}),await _0x5b306a['save'](),console['log'](_0x26bd1f[_0x561c7f(0x134)]);const _0x4deb61=new c_payment_data({'invoice':_0x44a8cb,'customer':_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xd9)],'reason':_0x561c7f(0x177)});await _0x4deb61['save']();const _0xb85033=await master_shop['find']();console[_0x561c7f(0x18d)](_0x561c7f(0x13c),_0xb85033[0x0][_0x561c7f(0x19a)]);const _0x5764e3=await email_settings[_0x561c7f(0x182)](),_0x41380a=await customer['findOne']({'name':_0x26bd1f[_0x561c7f(0x134)][_0x561c7f(0xd9)]});console[_0x561c7f(0x18d)](_0x561c7f(0x100),_0x41380a);_0xb85033[0x0][_0x561c7f(0x1aa)]==0x1?(right_currency=_0xb85033[0x0][_0x561c7f(0x10f)],left_currency=''):(right_currency='',left_currency=_0xb85033[0x0][_0x561c7f(0x10f)]);var _0x486027=_0x1df3bf,_0x41a8d3=_0xe0867e,_0x172985='',_0x6bf563;for(_0x6bf563 in _0x486027){_0x172985+=_0x561c7f(0x199)+_0x561c7f(0x19c)+_0x486027[_0x6bf563]+_0x561c7f(0x1d6)+_0x561c7f(0x19c)+_0x41a8d3[_0x6bf563]+_0x561c7f(0x1d6)+'</tr>';}console[_0x561c7f(0x18d)](_0x561c7f(0x1a9),_0x172985);let _0x5d1173=nodemailer[_0x561c7f(0x1cb)]({'service':_0x561c7f(0x141),'auth':{'user':_0x5764e3[_0x561c7f(0x173)],'pass':_0x5764e3['password']}}),_0x581169={'from':_0x5764e3[_0x561c7f(0x173)],'to':_0x41380a[_0x561c7f(0x173)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x561c7f(0x1ce)+'/upload/'+_0xb85033[0x0][_0x561c7f(0x19a)],'cid':_0x561c7f(0xd5)}],'html':'<!DOCTYPE\x20html>'+_0x561c7f(0xcd)+_0x561c7f(0x151)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x561c7f(0xf3)+'<div>'+'<h2>\x20'+_0xb85033[0x0][_0x561c7f(0x12d)]+'\x20</h2>'+_0x561c7f(0xf3)+_0x561c7f(0xf3)+_0x561c7f(0x10c)+_0x561c7f(0x13b)+_0x561c7f(0xf7)+'\x20Order\x20Number\x20:\x20'+_0x44a8cb+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x561c7f(0x1c4)+_0x389fc8+'\x20'+_0x561c7f(0x14a)+_0x561c7f(0xe2)+'</div>'+_0x561c7f(0x143)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x561c7f(0xfa)+_0x561c7f(0x192)+_0x561c7f(0x138)+_0x561c7f(0x158)+_0x561c7f(0x157)+'</thead>'+_0x561c7f(0x1d9)+'\x20'+_0x172985+'\x20'+_0x561c7f(0x1d4)+_0x561c7f(0x170)+_0x561c7f(0x13b)+'<strong>\x20Regards\x20</strong>'+_0x561c7f(0x125)+_0xb85033[0x0][_0x561c7f(0x12d)]+_0x561c7f(0xe2)+'</div>'+_0x561c7f(0xf3)+_0x561c7f(0x198)};_0x5d1173[_0x561c7f(0x186)](_0x581169,function(_0x1a4c1c,_0x1a97c1){var _0x2f879c=_0x561c7f;_0x1a4c1c?(console[_0x2f879c(0x18d)](_0x1a4c1c),console[_0x2f879c(0x18d)]('Error\x20Occurs')):console['log'](_0x2f879c(0x16a));}),_0x26bd1f['flash'](_0x561c7f(0x1a0),'sales\x20item\x20return\x20successfull'),_0x5cd4cf[_0x561c7f(0x1b9)](_0x561c7f(0xd7));}catch(_0x310736){console['log'](_0x310736),_0x5cd4cf[_0x561c7f(0x196)](0xc8)[_0x561c7f(0x185)]({'message1':_0x310736['message']});}}}),router[a0_0x292ad1(0xe6)](a0_0x292ad1(0xee),auth,async(_0x1fe8ba,_0x4109f6)=>{var _0x5716d0=a0_0x292ad1;try{const {username:_0x235f39,email:_0x1438b6,role:_0x19d0ad}=_0x1fe8ba[_0x5716d0(0xfd)],_0xe88419=_0x1fe8ba[_0x5716d0(0xfd)],_0x2fd243=await profile[_0x5716d0(0x182)]({'email':_0xe88419[_0x5716d0(0x173)]}),_0x47740e=await master_shop[_0x5716d0(0x11a)]();console[_0x5716d0(0x18d)](_0x5716d0(0x1b3),_0x47740e);const _0x371254=_0x1fe8ba['params']['id'],_0x2a34ef=await sales[_0x5716d0(0x1ac)](_0x371254);console[_0x5716d0(0x18d)]('barcode\x20user_id',_0x2a34ef);if(_0x47740e[0x0][_0x5716d0(0xf9)]==_0x5716d0(0x15d))var _0x2c7b3c=users[_0x5716d0(0xe0)];else{if(_0x47740e[0x0][_0x5716d0(0xf9)]==_0x5716d0(0xdb))var _0x2c7b3c=users[_0x5716d0(0xdb)];else{if(_0x47740e[0x0][_0x5716d0(0xf9)]==_0x5716d0(0x1b8))var _0x2c7b3c=users[_0x5716d0(0x1b8)];else{if(_0x47740e[0x0][_0x5716d0(0xf9)]==_0x5716d0(0xe8))var _0x2c7b3c=users['Spanish'];else{if(_0x47740e[0x0][_0x5716d0(0xf9)]=='French')var _0x2c7b3c=users['French'];else{if(_0x47740e[0x0][_0x5716d0(0xf9)]==_0x5716d0(0x1a7))var _0x2c7b3c=users[_0x5716d0(0x188)];else{if(_0x47740e[0x0][_0x5716d0(0xf9)]==_0x5716d0(0x16c))var _0x2c7b3c=users[_0x5716d0(0x16c)];else{if(_0x47740e[0x0][_0x5716d0(0xf9)]==_0x5716d0(0x118))var _0x2c7b3c=users['Arabic'];}}}}}}}_0x4109f6['render'](_0x5716d0(0x15a),{'success':_0x1fe8ba[_0x5716d0(0xf8)](_0x5716d0(0x1a0)),'errors':_0x1fe8ba[_0x5716d0(0xf8)](_0x5716d0(0xd0)),'role':_0xe88419,'profile':_0x2fd243,'alldata':_0x2a34ef,'master_shop':_0x47740e,'language':_0x2c7b3c});}catch(_0x5712f0){console[_0x5716d0(0x18d)](_0x5712f0);}}),router[a0_0x292ad1(0x137)](a0_0x292ad1(0x1d7),async(_0x2bf25f,_0x35097e)=>{var _0x18bb08=a0_0x292ad1;const {product_code:_0x38d916,warehouse_name:_0xdcaf1f,rooms_data:_0x57c871,Roomslist:_0x3cce9b}=_0x2bf25f[_0x18bb08(0x134)],_0x28d097=_0x3cce9b[_0x18bb08(0x19e)](','),_0x54205e=[];async function _0x248a42(_0x57be14){var _0x2fc06f=_0x18bb08;const _0x99001e=await warehouse[_0x2fc06f(0x127)]([{'$match':{'name':_0xdcaf1f,'room':_0x57be14}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x38d916}},{'$group':{'_id':_0x2fc06f(0x17d),'name':{'$first':_0x2fc06f(0x12c)},'product_stock':{'$first':_0x2fc06f(0xed)},'primary_code':{'$first':_0x2fc06f(0x123)},'secondary_code':{'$first':_0x2fc06f(0x15b)},'product_code':{'$first':_0x2fc06f(0x162)},'level':{'$first':_0x2fc06f(0x1b6)},'isle':{'$first':_0x2fc06f(0x18a)},'type':{'$first':_0x2fc06f(0x169)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2fc06f(0x161)},'secondary_unit':{'$first':_0x2fc06f(0x1c8)},'storage':{'$first':_0x2fc06f(0x1ad)},'rack':{'$first':_0x2fc06f(0xfc)},'expiry_date':{'$first':_0x2fc06f(0x116)},'production_date':{'$first':_0x2fc06f(0xea)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2fc06f(0x147)},'product_cat':{'$first':_0x2fc06f(0x193)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2fc06f(0x120)},'invoice':{'$first':_0x2fc06f(0x145)}}}]),_0x11143b=await warehouse['aggregate']([{'$match':{'name':_0xdcaf1f,'room':_0x57be14}},{'$unwind':_0x2fc06f(0x191)},{'$match':{'product_details.secondary_code':_0x38d916}},{'$group':{'_id':_0x2fc06f(0x17d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2fc06f(0xed)},'primary_code':{'$first':_0x2fc06f(0x123)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2fc06f(0x162)},'level':{'$first':_0x2fc06f(0x1b6)},'isle':{'$first':_0x2fc06f(0x18a)},'type':{'$first':_0x2fc06f(0x169)},'pallet':{'$first':_0x2fc06f(0x1bf)},'unit':{'$first':_0x2fc06f(0x161)},'secondary_unit':{'$first':_0x2fc06f(0x1c8)},'storage':{'$first':_0x2fc06f(0x1ad)},'rack':{'$first':_0x2fc06f(0xfc)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2fc06f(0xea)},'maxPerUnit':{'$first':_0x2fc06f(0xcf)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x2fc06f(0x193)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2fc06f(0x120)},'invoice':{'$first':_0x2fc06f(0x145)}}}]);if(_0x99001e[_0x2fc06f(0x1cc)]>0x0)_0x54205e[_0x2fc06f(0x1c5)](_0x99001e);else _0x11143b[_0x2fc06f(0x1cc)]>0x0&&_0x54205e[_0x2fc06f(0x1c5)](_0x11143b);}const _0x2c4aaa=_0x28d097[_0x18bb08(0x15f)](_0x37b373=>_0x248a42(_0x37b373));await Promise[_0x18bb08(0x1a2)](_0x2c4aaa),_0x35097e[_0x18bb08(0x185)](_0x54205e);}),module[a0_0x292ad1(0x105)]=router;