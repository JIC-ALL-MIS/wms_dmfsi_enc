var a0_0x38ef5e=a0_0x4700;(function(_0x4b060c,_0x247405){var _0x2f60d7=a0_0x4700,_0x4441e8=_0x4b060c();while(!![]){try{var _0x1021c2=parseInt(_0x2f60d7(0x1c1))/0x1*(parseInt(_0x2f60d7(0x172))/0x2)+parseInt(_0x2f60d7(0x1aa))/0x3*(-parseInt(_0x2f60d7(0xf5))/0x4)+-parseInt(_0x2f60d7(0x116))/0x5*(parseInt(_0x2f60d7(0x15a))/0x6)+-parseInt(_0x2f60d7(0x197))/0x7+parseInt(_0x2f60d7(0xf0))/0x8+-parseInt(_0x2f60d7(0xf1))/0x9+-parseInt(_0x2f60d7(0x12c))/0xa*(-parseInt(_0x2f60d7(0xfb))/0xb);if(_0x1021c2===_0x247405)break;else _0x4441e8['push'](_0x4441e8['shift']());}catch(_0x199604){_0x4441e8['push'](_0x4441e8['shift']());}}}(a0_0x4191,0xf3779));const express=require('express'),app=express(),router=express[a0_0x38ef5e(0x1a7)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x38ef5e(0x1cc)),auth=require(a0_0x38ef5e(0x152)),nodemailer=require(a0_0x38ef5e(0x1db)),users=require('../public/language/languages.json');router[a0_0x38ef5e(0x1ce)](a0_0x38ef5e(0x133),auth,async(_0x1ced3b,_0x2e03c7)=>{var _0xa88745=a0_0x38ef5e;try{const {username:_0xc8652,email:_0x373ac0,role:_0x588906}=_0x1ced3b[_0xa88745(0x127)],_0x893da5=_0x1ced3b[_0xa88745(0x127)],_0x516ec=await profile[_0xa88745(0x147)]({'email':_0x893da5['email']}),_0x5bd528=await master_shop[_0xa88745(0xd3)]();let _0x267c30;if(_0x893da5['role']==_0xa88745(0x1e8)){const _0x35c52b=await staff[_0xa88745(0x147)]({'email':_0x893da5[_0xa88745(0x14b)]});_0x267c30=await sales_finished[_0xa88745(0x1de)]([{'$lookup':{'from':_0xa88745(0x124),'localField':_0xa88745(0x15e),'foreignField':_0xa88745(0x179),'as':_0xa88745(0xe3)}},{'$unwind':_0xa88745(0xd9)},{'$unwind':_0xa88745(0x108)},{'$group':{'_id':_0xa88745(0x181),'invoice':{'$first':_0xa88745(0x13d)},'customers':{'$first':'$customer'},'date':{'$first':_0xa88745(0x103)},'warehouse_name':{'$first':_0xa88745(0x16f)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0xa88745(0xd2)},'customers_docs':{'$first':_0xa88745(0xd9)},'total_saleproduct_quantity':{'$sum':_0xa88745(0x168)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0xa88745(0x164)},'finalize':{'$first':_0xa88745(0x1af)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x267c30=await sales_finished['aggregate']([{'$lookup':{'from':'customers','localField':_0xa88745(0x15e),'foreignField':_0xa88745(0x179),'as':_0xa88745(0xe3)}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0xa88745(0x13d)},'customers':{'$first':_0xa88745(0x14a)},'date':{'$first':_0xa88745(0x103)},'warehouse_name':{'$first':_0xa88745(0x16f)},'sale_product':{'$push':_0xa88745(0x108)},'note':{'$first':'$note'},'return_data':{'$first':_0xa88745(0xd2)},'customers_docs':{'$first':_0xa88745(0xd9)},'total_saleproduct_quantity':{'$sum':_0xa88745(0x168)},'level':{'$addToSet':_0xa88745(0x110)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0xa88745(0x164)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x5bd528[0x0][_0xa88745(0x15b)]==_0xa88745(0x1c2)){var _0x1071fb=users[_0xa88745(0x105)];console[_0xa88745(0x177)](_0x1071fb);}else{if(_0x5bd528[0x0][_0xa88745(0x15b)]==_0xa88745(0xe4))var _0x1071fb=users['Hindi'];else{if(_0x5bd528[0x0][_0xa88745(0x15b)]==_0xa88745(0x1bf))var _0x1071fb=users[_0xa88745(0x1bf)];else{if(_0x5bd528[0x0][_0xa88745(0x15b)]==_0xa88745(0x12a))var _0x1071fb=users[_0xa88745(0x12a)];else{if(_0x5bd528[0x0][_0xa88745(0x15b)]=='French')var _0x1071fb=users['French'];else{if(_0x5bd528[0x0][_0xa88745(0x15b)]==_0xa88745(0xe8))var _0x1071fb=users[_0xa88745(0x106)];else{if(_0x5bd528[0x0][_0xa88745(0x15b)]==_0xa88745(0x1c8))var _0x1071fb=users['Chinese'];else{if(_0x5bd528[0x0][_0xa88745(0x15b)]==_0xa88745(0x1ef))var _0x1071fb=users[_0xa88745(0x1ad)];}}}}}}}_0x2e03c7['render'](_0xa88745(0x123),{'success':_0x1ced3b[_0xa88745(0xde)](_0xa88745(0x11c)),'errors':_0x1ced3b['flash'](_0xa88745(0x1d1)),'sales':_0x267c30,'profile':_0x516ec,'role':_0x893da5,'master_shop':_0x5bd528,'language':_0x1071fb});}catch(_0x3cc8c0){console[_0xa88745(0x177)](_0x3cc8c0);}});function a0_0x4700(_0x101911,_0x3e65b4){var _0x419112=a0_0x4191();return a0_0x4700=function(_0x47000f,_0x53aaa0){_0x47000f=_0x47000f-0xd1;var _0x260845=_0x419112[_0x47000f];return _0x260845;},a0_0x4700(_0x101911,_0x3e65b4);}async function getRandom8DigitNumber(){var _0x1aa414=a0_0x38ef5e;const _0x423836=0x989680,_0x4aa8ea=0x5f5e0ff,_0x18d2b2=Math[_0x1aa414(0xe2)](Math[_0x1aa414(0x1b1)]()*(_0x4aa8ea-_0x423836+0x1))+_0x423836;var _0x470170;const _0x22ac8e=await sales_finished[_0x1aa414(0x147)]({'invoice':_0x1aa414(0x1a1)+_0x18d2b2});return _0x22ac8e&&_0x22ac8e['length']>0x0?_0x470170='OUTF-'+_0x18d2b2:_0x470170=_0x1aa414(0x1a1)+_0x18d2b2,_0x470170;}function a0_0x4191(){var _0x9094ee=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','primary_code','sale_qty','return_sale','return_sale_QA','getMonth','product_stock','maxperunit','</body></html>','sales_quantity','/upload/','$product_details.maxPerUnit','final','<h5\x20style=\x22text-align:\x20left;\x22>','983703IKTJuK','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.room_name','</thead>','$product_details.storage','$name','add\x20post','<span\x20style=\x22float:\x20right;\x22>','$product_details.secondary_code','OUTF-','gmail','True','/picking_list/pdf/','site_title','length','Router','slice','$product_details.expiry_date','58257fCPEcI','received_amount','unit_QA','Arabic','/all_sales_finished/preview/','$finalize','</div>','random','currency_placement','Logo.png','note','forEach','invoice','An\x20error\x20occurred.','warehouse','string','FGSEmail','post','Sales\x20Mail','<table\x20style=\x22width:\x20100%\x20!important;\x22>','findById','German','stocks_QA','14097mbIaPR','English\x20(US)','$product_details.production_date','</table>','edit_sales_finished','padStart','logo','Chinese','$product_details.floorlevel','Sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','../models/all_models','$product_details.product_name','get','Sale\x20Return','params','errors','then','$product_details','suppliers','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','sales_invoice','Finished\x20Goods','$product_details.product_cat','christian.villamer@jakagroup.com','warehouse_name','nodemailer','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','aggregate','\x20Order\x20Date\x20:\x20','/all_sales/view','An\x20error\x20occurred\x20while\x20saving\x20data.','abs','prod_code','$product_details.unit','/barcode_scanner','unit','$product_details._id','staff','maxPerUnit_QA','$product_details.bay','</h5>','production_date_QA','id_transaction_from','/invoice/:id','Arabic\x20(ae)','currency','bay','$product_details.product_stock','room_name','primary_code_QA','\x20</h2>','$return_data','find','$product_details.batch_code','exports','Quality\x20Inspection','ADD\x20SALE','return_data','$customers_docs','maxProducts','concat','Enclosed','all','flash','amount','</tr>','secondary_unit','floor','customers_docs','Hindi','host','\x20<<<==>>>\x20','return_qty_QA','Portuguese\x20(BR)','French','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','</head><body>','product_name_QA1','\x20<>\x20','\x20==\x20','10332768xcxIqV','14779233wLjKpp','$product_details.type','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','356ipsHlR','<tr>','customer_data','Ambient','sale_product','batch_code_QA','473qyPKKU','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','level','$product_details.rack','/../public','/view/add_sales/:id','error','$date','Error\x20Occurs','English','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$sale_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','\x20>>>\x20','/view/:id','redirect','/all_sales_finished/view','product_code','port','$sale_product.bay','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Sales\x20Update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','</span>','filter','15930CGYHGF','<tbody\x20style=\x22text-align:\x20center;\x22>','maxProducts_QA','expiry_date_QA','product_code_QA','Sale\x20Return\x20Mail','success','message','add_sales_finished','getDate','save','/view/add_sales','finalize','all_sales_finished','customers','$product_details.maxProducts','$product_details.product_code','user','product_details','sales\x20item\x20return\x20successfull','Spanish','stock','825590PgGRBQ','<hr\x20class=\x22my-3\x22>','push','product_data','json','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','secondary_unit_QA','/view','password','image','</tbody>','Add\x20Sales','maxPerUnit','return_qty','prod_cat','body','toString','$invoice','room','render','$product_details.bin','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_date','foreach\x20newproduct','back','all_sales_barcode','batch_code','findOne','\x20&&\x20','False','$customer','email','sendMail','/preview/:id','RoomAssigned','/view/add_sale/product','primary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','../middleware/auth','product_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','status','due_amount','<html><head><title></title>','product_list','Enabled','3150GTvZXh','language','max_per_unit','/view/return_sales/:id','customer','Email\x20sent\x20successfully','prod_invoice','Return\x20Rooms','production_date','secondary_code','$sale_product.floorlevel','<h2>\x20','carton','secondary_code_QA','$sale_product.quantity','$product_details.primary_code','map','</td>','quantity','createTransport','$product_details.invoice','$warehouse_name','$product.product_name','for_categorize','190TQXaQl','$product','Sales\x20Add\x20successfully','$room','DRY\x20GOODS','log','date','name','QA\x20Warehouse','/give_payment/:id','\x20Order\x20Number\x20:\x20','$product_details.secondary_unit','return_sale_finished','<h5>','role','$_id','expiry_date','sales_quantity_QA','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','purchases_data','/barcode/:id','<div>','<strong>\x20Regards\x20</strong>'];a0_0x4191=function(){return _0x9094ee;};return a0_0x4191();}router[a0_0x38ef5e(0x1ce)](a0_0x38ef5e(0x121),auth,async(_0x253d92,_0x4f6ca4)=>{var _0x39610a=a0_0x38ef5e;try{const {username:_0x3be2cc,email:_0x4ed736,role:_0x1704bd}=_0x253d92[_0x39610a(0x127)],_0x155560=_0x253d92[_0x39610a(0x127)],_0x46badd=await profile[_0x39610a(0x147)]({'email':_0x155560[_0x39610a(0x14b)]}),_0x58f5be=await master_shop['find'](),_0x3571c4=await customer[_0x39610a(0xd3)]({});let _0x5c6e07;if(_0x155560[_0x39610a(0x180)]==_0x39610a(0x1e8)){const _0x5bd5cb=await staff[_0x39610a(0x147)]({'email':_0x155560[_0x39610a(0x14b)]});_0x5c6e07=await warehouse[_0x39610a(0x1de)]([{'$match':{'status':_0x39610a(0x159),'name':_0x5bd5cb[_0x39610a(0x1b8)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x39610a(0x17a)}}},{'$group':{'_id':'$name','name':{'$first':_0x39610a(0x19d)}}},{'$sort':{'name':0x1}}]);}else _0x5c6e07=await warehouse['aggregate']([{'$match':{'status':_0x39610a(0x159),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x39610a(0x17a)}}},{'$group':{'_id':_0x39610a(0x19d),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x18393c=await product['find']({});var _0x200912=['Ambient',_0x39610a(0xdc)];const _0x2478d6=await sales_finished[_0x39610a(0xd3)]({}),_0x2d61b8=_0x2478d6[_0x39610a(0x1a6)]+0x1,_0x498a22=_0x39610a(0x1a1)+_0x2d61b8[_0x39610a(0x13c)]()[_0x39610a(0x1c6)](0x5,'0');if(_0x58f5be[0x0][_0x39610a(0x15b)]==_0x39610a(0x1c2)){var _0x5baa84=users['English'];console[_0x39610a(0x177)](_0x5baa84);}else{if(_0x58f5be[0x0][_0x39610a(0x15b)]==_0x39610a(0xe4))var _0x5baa84=users[_0x39610a(0xe4)];else{if(_0x58f5be[0x0][_0x39610a(0x15b)]==_0x39610a(0x1bf))var _0x5baa84=users['German'];else{if(_0x58f5be[0x0]['language']==_0x39610a(0x12a))var _0x5baa84=users['Spanish'];else{if(_0x58f5be[0x0][_0x39610a(0x15b)]=='French')var _0x5baa84=users[_0x39610a(0xe9)];else{if(_0x58f5be[0x0][_0x39610a(0x15b)]==_0x39610a(0xe8))var _0x5baa84=users['Portuguese'];else{if(_0x58f5be[0x0]['language']==_0x39610a(0x1c8))var _0x5baa84=users[_0x39610a(0x1c8)];else{if(_0x58f5be[0x0][_0x39610a(0x15b)]==_0x39610a(0x1ef))var _0x5baa84=users[_0x39610a(0x1ad)];}}}}}}}const _0x3386ec=getRandom8DigitNumber();_0x3386ec[_0x39610a(0x1d2)](_0xf629db=>{var _0x38139f=_0x39610a;_0x4f6ca4[_0x38139f(0x13f)](_0x38139f(0x11e),{'success':_0x253d92[_0x38139f(0xde)](_0x38139f(0x11c)),'errors':_0x253d92[_0x38139f(0xde)](_0x38139f(0x1d1)),'role':_0x155560,'profile':_0x46badd,'customer':_0x3571c4,'warehouse':_0x5c6e07,'product':_0x18393c,'invoice':_0xf629db,'master_shop':_0x58f5be,'language':_0x5baa84,'rooms_data':_0x200912});})[_0x39610a(0xf3)](_0x3a39e2=>{var _0x1b9377=_0x39610a;_0x253d92[_0x1b9377(0xde)](_0x1b9377(0x1d1),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x4f6ca4[_0x1b9377(0x10c)](_0x1b9377(0x10d));});}catch(_0x4009ec){console['log'](_0x4009ec);}}),router[a0_0x38ef5e(0x1ce)](a0_0x38ef5e(0x101),auth,async(_0x38e3c8,_0x4676a8)=>{var _0x5dccf4=a0_0x38ef5e;try{const _0x4dfb91=_0x38e3c8[_0x5dccf4(0x1d0)]['id'];console[_0x5dccf4(0x177)](_0x4dfb91);const _0x217eb0=await product[_0x5dccf4(0xd3)](),_0x10e5d8=await purchases['aggregate']([{'$match':{'warehouse_name':_0x4dfb91}},{'$unwind':_0x5dccf4(0x173)},{'$group':{'_id':_0x5dccf4(0x170)}}]);console[_0x5dccf4(0x177)](_0x5dccf4(0x185),_0x10e5d8),_0x4676a8[_0x5dccf4(0x155)](0xc8)[_0x5dccf4(0x130)]({'purchases_data':_0x10e5d8,'product_data':_0x217eb0});}catch(_0x12163d){console['log'](_0x12163d);}}),router[a0_0x38ef5e(0x1bb)](a0_0x38ef5e(0x14f),auth,async(_0x395f17,_0x5e10fa)=>{var _0x5977d2=a0_0x38ef5e;try{const {warehouse_data:_0x597292,product_data:_0x40b29a}=_0x395f17[_0x5977d2(0x13b)];console['log'](_0x395f17[_0x5977d2(0x13b)][_0x5977d2(0x12f)]);;const _0x47c15b=await master_shop[_0x5977d2(0xd3)]();console[_0x5977d2(0x177)]('master',_0x47c15b);const _0x324e32=await product[_0x5977d2(0x147)]({'name':_0x40b29a});console[_0x5977d2(0x177)]('product',_0x324e32);const _0x72966f=await warehouse[_0x5977d2(0x1de)]([{'$match':{'name':_0x597292}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x40b29a}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x5977d2(0x177)]('stock_data',_0x72966f),_0x5e10fa[_0x5977d2(0x155)](0xc8)[_0x5977d2(0x130)]({'master':_0x47c15b,'new_product':_0x324e32,'stock_data':_0x72966f});}catch(_0x3e3629){console[_0x5977d2(0x177)](_0x3e3629);}}),router['post']('/view/add_sales',auth,async(_0x5b915c,_0xf0675b)=>{var _0xc49b7a=a0_0x38ef5e;try{const {invoice:_0x1fd4b1,date:_0x4ccb7d,warehouse_name:_0x54cb45,product_name:_0x1a9740,stock:_0x34ee49,quantity:_0x20c71b,note:_0x531593,room:_0xca7bcc,primary_code:_0x3aef71,secondary_code:_0x354baa,prod_code:_0x2418aa,level:_0x2a7a2b,isle:_0x3e1a5c,pallet:_0x2ea165,batch_code:_0x1c37a3,SCRN:_0x527786,expiry_date:_0x469822,mode_transpo:_0xede4ea,name_driver:_0x37e52c}=_0x5b915c[_0xc49b7a(0x13b)];if(typeof _0x1a9740==_0xc49b7a(0x1b9))var _0xaa1138=[_0x5b915c[_0xc49b7a(0x13b)]['product_name']],_0x16d80a=[_0x5b915c[_0xc49b7a(0x13b)]['stock']],_0x2235d3=[_0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x166)]],_0xb58ec8=[_0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x18a)]],_0xfe1571=[_0x5b915c[_0xc49b7a(0x13b)]['secondary_code']],_0x1ec7a5=[_0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x1e3)]],_0x3655f7=[_0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0xfe)]],_0xabbcf8=[_0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x150)]],_0x504050=[_0x5b915c[_0xc49b7a(0x13b)]['secondary_unit']],_0x359f04=[_0x5b915c['body'][_0xc49b7a(0x146)]],_0x397cad=[_0x5b915c['body'][_0xc49b7a(0x182)]],_0xdf9051=[_0x5b915c['body'][_0xc49b7a(0x142)]],_0x394018=[_0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x15c)]],_0x31b7b3=[_0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x13a)]],_0x329dbe=[_0x5b915c['body']['RoomAssigned']],_0x3843ad=[_0x5b915c['body'][_0xc49b7a(0x160)]],_0x56d8ad=[_0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x1ed)]];else var _0xaa1138=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x153)]],_0x16d80a=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x12b)]],_0x2235d3=[..._0x5b915c['body']['carton']],_0xb58ec8=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x18a)]],_0xfe1571=[..._0x5b915c[_0xc49b7a(0x13b)]['secondary_code']],_0x1ec7a5=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x1e3)]],_0x3655f7=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0xfe)]],_0xabbcf8=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x150)]],_0x504050=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0xe1)]],_0x359f04=[..._0x5b915c['body']['batch_code']],_0x397cad=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x182)]],_0xdf9051=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x142)]],_0x394018=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x15c)]],_0x31b7b3=[..._0x5b915c[_0xc49b7a(0x13b)]['prod_cat']],_0x329dbe=[..._0x5b915c['body'][_0xc49b7a(0x14e)]],_0x3843ad=[..._0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x160)]],_0x56d8ad=[..._0x5b915c['body'][_0xc49b7a(0x1ed)]];const _0x2423d5=_0xaa1138[_0xc49b7a(0x16a)](_0x119757=>{return _0x119757={'product_name':_0x119757};});_0x16d80a[_0xc49b7a(0x1b5)]((_0x77db9c,_0x1fa42d)=>{_0x2423d5[_0x1fa42d]['stock']=_0x77db9c;}),_0x2235d3[_0xc49b7a(0x1b5)]((_0x3bdb5d,_0x32322b)=>{var _0x3f70fe=_0xc49b7a;_0x2423d5[_0x32322b][_0x3f70fe(0x16c)]=Math[_0x3f70fe(0x1e2)](_0x3bdb5d);}),_0x56d8ad[_0xc49b7a(0x1b5)]((_0x5cba76,_0x2b497f)=>{var _0x416305=_0xc49b7a;_0x2423d5[_0x2b497f][_0x416305(0x1ed)]=_0x5cba76;}),_0xb58ec8[_0xc49b7a(0x1b5)]((_0x7fa512,_0x1c49f5)=>{var _0x5c684f=_0xc49b7a;_0x2423d5[_0x1c49f5][_0x5c684f(0x18a)]=_0x7fa512;}),_0xfe1571['forEach']((_0x4c710d,_0x319a2a)=>{_0x2423d5[_0x319a2a]['secondary_code']=_0x4c710d;}),_0x1ec7a5[_0xc49b7a(0x1b5)]((_0x265573,_0x399831)=>{var _0x14b8e8=_0xc49b7a;_0x2423d5[_0x399831][_0x14b8e8(0x10e)]=_0x265573;}),_0x3655f7[_0xc49b7a(0x1b5)]((_0x4d04b1,_0x4de4b9)=>{var _0x3198e5=_0xc49b7a;_0x2423d5[_0x4de4b9][_0x3198e5(0x1f1)]=_0x4d04b1;}),_0xabbcf8[_0xc49b7a(0x1b5)]((_0x4a96c4,_0x25cef1)=>{_0x2423d5[_0x25cef1]['unit']=_0x4a96c4;}),_0x504050[_0xc49b7a(0x1b5)]((_0x4ea44c,_0x2ea7a6)=>{var _0x3e799a=_0xc49b7a;_0x2423d5[_0x2ea7a6][_0x3e799a(0xe1)]=_0x4ea44c;}),_0x359f04['forEach']((_0x1452ed,_0xb62bfd)=>{var _0x42eb47=_0xc49b7a;_0x2423d5[_0xb62bfd][_0x42eb47(0x146)]=_0x1452ed;}),_0x397cad[_0xc49b7a(0x1b5)]((_0x3a25be,_0xead452)=>{var _0x53cbd6=_0xc49b7a;_0x2423d5[_0xead452][_0x53cbd6(0x182)]=_0x3a25be;}),_0xdf9051[_0xc49b7a(0x1b5)]((_0x1bb039,_0x2b6282)=>{var _0x5455d8=_0xc49b7a;_0x2423d5[_0x2b6282][_0x5455d8(0x162)]=_0x1bb039;}),_0x394018[_0xc49b7a(0x1b5)]((_0x367863,_0x4eeaeb)=>{var _0x19d455=_0xc49b7a;_0x2423d5[_0x4eeaeb][_0x19d455(0x190)]=_0x367863;}),_0x31b7b3[_0xc49b7a(0x1b5)]((_0x1ace15,_0x3a45b1)=>{var _0x42c3c6=_0xc49b7a;_0x2423d5[_0x3a45b1][_0x42c3c6(0x13a)]=_0x1ace15;}),_0x329dbe[_0xc49b7a(0x1b5)]((_0x5510a7,_0x143066)=>{var _0x8373ec=_0xc49b7a;_0x2423d5[_0x143066][_0x8373ec(0x1f3)]=_0x5510a7;}),_0x3843ad[_0xc49b7a(0x1b5)]((_0x5ca933,_0xc8ff39)=>{var _0x3067b0=_0xc49b7a;_0x2423d5[_0xc8ff39][_0x3067b0(0x1b6)]=_0x5ca933;});var _0x54eb82=0x0;_0x2423d5['forEach'](_0x5b5ffe=>{var _0x21009a=_0xc49b7a;parseFloat(_0x5b5ffe[_0x21009a(0x12b)])<parseFloat(_0x5b5ffe['quantity'])&&parseFloat(_0x5b5ffe[_0x21009a(0x16c)])>parseFloat(_0x5b5ffe[_0x21009a(0x12b)])&&(console[_0x21009a(0x177)](_0x5b5ffe[_0x21009a(0x12b)]+_0x21009a(0xee)+_0x5b5ffe['quantity']),_0x54eb82++);});if(_0x54eb82!=0x0)return _0x5b915c[_0xc49b7a(0xde)](_0xc49b7a(0x1d1),_0xc49b7a(0x131)),_0xf0675b[_0xc49b7a(0x10c)](_0xc49b7a(0x144));const _0x587d51=_0x2423d5[_0xc49b7a(0x115)](_0x55a8eb=>_0x55a8eb[_0xc49b7a(0x16c)]!=='0'&&_0x55a8eb[_0xc49b7a(0x16c)]!==''),_0x35489b=new sales_finished({'invoice':_0x1fd4b1,'customer':_0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x15e)],'date':_0x4ccb7d,'warehouse_name':_0x54cb45,'sale_product':_0x587d51,'note':_0x531593,'room':_0xca7bcc,'primary_code':_0x3aef71,'secondary_code':_0x354baa,'prod_code':_0x2418aa,'SCRN':_0x527786,'finalize':_0xc49b7a(0x149),'mode_transpo':_0xede4ea,'name_driver':_0x37e52c}),_0x4f8baa=await _0x35489b[_0xc49b7a(0x120)](),_0xb2970c=await sales_finished['findOne']({'invoice':_0x1fd4b1}),_0x304307=new c_payment_data({'invoice':_0x1fd4b1,'customer':_0x5b915c['body'][_0xc49b7a(0x15e)],'reason':_0xc49b7a(0x1ca)});await _0x304307['save']();const _0x50cd3b=await master_shop[_0xc49b7a(0xd3)](),_0x4a4b26=await email_settings[_0xc49b7a(0x147)](),_0x410e5f=await customer['findOne']({'name':_0x5b915c[_0xc49b7a(0x13b)][_0xc49b7a(0x15e)]});_0x50cd3b[0x0][_0xc49b7a(0x1b2)]==0x1?(right_currency=_0x50cd3b[0x0][_0xc49b7a(0x1f0)],left_currency=''):(right_currency='',left_currency=_0x50cd3b[0x0][_0xc49b7a(0x1f0)]);var _0x24c400=_0xaa1138,_0x445a20=_0x2235d3,_0x2e0f12='',_0x4e9045;for(_0x4e9045 in _0x24c400){_0x2e0f12+=_0xc49b7a(0xf6)+_0xc49b7a(0x111)+_0x24c400[_0x4e9045]+'</td>'+_0xc49b7a(0x111)+_0x445a20[_0x4e9045]+_0xc49b7a(0x16b)+_0xc49b7a(0xe0);}console[_0xc49b7a(0x177)](_0xc49b7a(0x158),_0x2e0f12);let _0x57538a=nodemailer[_0xc49b7a(0x16d)]({'host':_0x4a4b26[_0xc49b7a(0xe5)],'port':Number(_0x4a4b26[_0xc49b7a(0x10f)]),'secure':![],'service':'gmail','auth':{'user':_0x4a4b26['email'],'pass':_0x4a4b26[_0xc49b7a(0x134)]}}),_0x56a3e0={'from':_0x4a4b26[_0xc49b7a(0x14b)],'to':_0xc49b7a(0x1d9),'subject':_0xc49b7a(0x137),'attachments':[{'filename':_0xc49b7a(0x1b3),'path':__dirname+_0xc49b7a(0x100)+_0xc49b7a(0x193)+_0x50cd3b[0x0]['image'],'cid':_0xc49b7a(0x1c7)}],'html':_0xc49b7a(0xd7)};_0x57538a['sendMail'](_0x56a3e0,function(_0xecc16e,_0x1082dd){var _0x183862=_0xc49b7a;_0xecc16e?(console[_0x183862(0x177)](_0xecc16e),console[_0x183862(0x177)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0x5b915c[_0xc49b7a(0xde)](_0xc49b7a(0x11c),_0xc49b7a(0x174)),_0xf0675b[_0xc49b7a(0x10c)](_0xc49b7a(0x1ae)+_0x4f8baa[_0xc49b7a(0xfc)]);}catch(_0x1a2523){console[_0xc49b7a(0x177)](_0x1a2523);}}),router[a0_0x38ef5e(0x1ce)](a0_0x38ef5e(0x14d),auth,async(_0x507011,_0x50c7bd)=>{var _0x412a0a=a0_0x38ef5e;try{const {username:_0x244556,email:_0x214111,role:_0xbf14dc}=_0x507011[_0x412a0a(0x127)],_0x6b2553=_0x507011['user'],_0x999bc5=await profile['findOne']({'email':_0x6b2553[_0x412a0a(0x14b)]}),_0xd5fee4=await master_shop[_0x412a0a(0xd3)](),_0x4c941d=_0x507011[_0x412a0a(0x1d0)]['id'],_0x2c9088=await sales_finished[_0x412a0a(0x1be)](_0x4c941d),_0x5cd890=await warehouse[_0x412a0a(0x1de)]([{'$match':{'name':_0x2c9088['warehouse_name']}},{'$unwind':_0x412a0a(0x1d3)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x412a0a(0x1f2)},'bay':{'$first':_0x412a0a(0x1ea)},'bin':{'$first':_0x412a0a(0x140)},'type':{'$first':_0x412a0a(0xf2)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x412a0a(0x169)},'secondary_code':{'$first':_0x412a0a(0x1a0)},'product_code':{'$first':_0x412a0a(0x126)},'storage':{'$first':_0x412a0a(0x19c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x412a0a(0x1a9)},'production_date':{'$first':_0x412a0a(0x1c3)},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':_0x412a0a(0x175)},'room_data':{'$first':_0x412a0a(0x19a)}}}]),_0x8cec5c=await customer['find']({});let _0x267d88;if(_0x6b2553[_0x412a0a(0x180)]==_0x412a0a(0x1e8)){const _0x51643b=await staff[_0x412a0a(0x147)]({'email':_0x6b2553[_0x412a0a(0x14b)]});_0x267d88=await warehouse['aggregate']([{'$match':{'status':_0x412a0a(0x159),'name':_0x51643b[_0x412a0a(0x1b8)]}},{'$group':{'_id':_0x412a0a(0x19d),'name':{'$first':_0x412a0a(0x19d)}}}]);}else _0x267d88=await warehouse['aggregate']([{'$match':{'status':_0x412a0a(0x159)}},{'$group':{'_id':_0x412a0a(0x19d),'name':{'$first':'$name'}}}]);const _0x1a8bcb=await product[_0x412a0a(0xd3)]({});if(_0xd5fee4[0x0][_0x412a0a(0x15b)]=='English\x20(US)'){var _0x4332a3=users['English'];console['log'](_0x4332a3);}else{if(_0xd5fee4[0x0][_0x412a0a(0x15b)]=='Hindi')var _0x4332a3=users[_0x412a0a(0xe4)];else{if(_0xd5fee4[0x0][_0x412a0a(0x15b)]==_0x412a0a(0x1bf))var _0x4332a3=users[_0x412a0a(0x1bf)];else{if(_0xd5fee4[0x0]['language']==_0x412a0a(0x12a))var _0x4332a3=users[_0x412a0a(0x12a)];else{if(_0xd5fee4[0x0][_0x412a0a(0x15b)]=='French')var _0x4332a3=users[_0x412a0a(0xe9)];else{if(_0xd5fee4[0x0]['language']=='Portuguese\x20(BR)')var _0x4332a3=users[_0x412a0a(0x106)];else{if(_0xd5fee4[0x0][_0x412a0a(0x15b)]==_0x412a0a(0x1c8))var _0x4332a3=users[_0x412a0a(0x1c8)];else{if(_0xd5fee4[0x0][_0x412a0a(0x15b)]==_0x412a0a(0x1ef))var _0x4332a3=users[_0x412a0a(0x1ad)];}}}}}}}_0x50c7bd[_0x412a0a(0x13f)]('edit_sales_finished_view',{'success':_0x507011[_0x412a0a(0xde)]('success'),'errors':_0x507011[_0x412a0a(0xde)](_0x412a0a(0x1d1)),'role':_0x6b2553,'profile':_0x999bc5,'customer':_0x8cec5c,'warehouse':_0x267d88,'product':_0x5cd890,'user':_0x2c9088,'master_shop':_0xd5fee4,'unit':_0x1a8bcb,'language':_0x4332a3});}catch(_0x284990){console[_0x412a0a(0x177)](_0x284990);}}),router[a0_0x38ef5e(0x1bb)](a0_0x38ef5e(0x14d),auth,async(_0x26ef1f,_0x4b8b1e)=>{var _0x3327ca=a0_0x38ef5e;try{const _0x2f3701=_0x26ef1f[_0x3327ca(0x1d0)]['id'],{invoice:_0x5211d7,warehouse_name:_0x3f70b7,room:_0x38c007}=_0x26ef1f[_0x3327ca(0x13b)],_0x48928e=await sales_finished[_0x3327ca(0x147)]({'invoice':_0x5211d7}),_0x59caf7=_0x48928e[_0x3327ca(0xf9)][_0x3327ca(0x16a)](async _0x3555f5=>{var _0x140f8e=_0x3327ca,_0xd90eef=await warehouse[_0x140f8e(0x147)]({'name':_0x3f70b7,'room':_0x3555f5[_0x140f8e(0x1f3)],'warehouse_category':_0x140f8e(0x1d7)});const _0x57edb0=_0xd90eef[_0x140f8e(0x128)][_0x140f8e(0x16a)](_0xcd7528=>{var _0x5615d2=_0x140f8e;_0xcd7528[_0x5615d2(0x153)]==_0x3555f5[_0x5615d2(0x153)]&&_0xcd7528[_0x5615d2(0x1f1)]==_0x3555f5[_0x5615d2(0x1f1)]&&_0xcd7528[_0x5615d2(0x182)]==_0x3555f5[_0x5615d2(0x182)]&&_0xcd7528['production_date']==_0x3555f5[_0x5615d2(0x162)]&&_0xcd7528[_0x5615d2(0x146)]==_0x3555f5[_0x5615d2(0x146)]&&_0xcd7528[_0x5615d2(0xfc)]==_0x3555f5[_0x5615d2(0x1ed)]&&(_0xcd7528['product_stock']>0x0&&(console[_0x5615d2(0x177)](_0xcd7528['product_name']+_0x5615d2(0xef)+_0x3555f5[_0x5615d2(0x153)]+'\x20&&\x20'+_0xcd7528[_0x5615d2(0x1f1)]+_0x5615d2(0xef)+_0x3555f5[_0x5615d2(0x1f1)]+_0x5615d2(0x148)+_0xcd7528[_0x5615d2(0x162)]+'\x20==\x20'+_0x3555f5[_0x5615d2(0x162)]+_0x5615d2(0x148)+_0xcd7528[_0x5615d2(0x182)]+_0x5615d2(0xef)+_0x3555f5[_0x5615d2(0x182)]+_0x5615d2(0x148)+_0xcd7528[_0x5615d2(0x146)]+'\x20==\x20'+_0x3555f5[_0x5615d2(0x146)]+_0x5615d2(0x148)+_0xcd7528[_0x5615d2(0x1b6)]+_0x5615d2(0xef)+_0x3555f5[_0x5615d2(0x1b6)]+_0x5615d2(0x148)+_0xcd7528[_0x5615d2(0x18f)]+_0x5615d2(0xe6)+_0x3555f5[_0x5615d2(0x16c)]+_0x5615d2(0x10a)+_0x3555f5[_0x5615d2(0x1f3)]+'\x20&&\x20'+_0xcd7528[_0x5615d2(0xfc)]+'\x20==\x20'+_0x3555f5[_0x5615d2(0x1ed)]),_0xcd7528[_0x5615d2(0x18f)]=Math['max'](0x0,Math[_0x5615d2(0x1e2)](_0xcd7528[_0x5615d2(0x18f)])-Math['abs'](_0x3555f5['quantity']))));});return _0xd90eef;});Promise[_0x3327ca(0xdd)](_0x59caf7)[_0x3327ca(0x1d2)](async _0x29516b=>{var _0x2be73b=_0x3327ca;try{for(const _0x5b7402 of _0x29516b){await _0x5b7402[_0x2be73b(0x120)]();}_0x48928e[_0x2be73b(0x122)]=_0x2be73b(0x1a3);const _0x72a870=await _0x48928e['save'](),_0x29380e=await master_shop[_0x2be73b(0xd3)](),_0x4a8e8a=await email_settings[_0x2be73b(0x147)](),_0xb0fdf7=await supervisor_settings[_0x2be73b(0xd3)]();var _0x40b626=_0x48928e[_0x2be73b(0xf9)],_0xa6039='',_0x51e7ce;for(_0x51e7ce in _0x40b626){var _0xf7f437='FG';_0x48928e[_0x2be73b(0x1da)]==_0x2be73b(0x176)&&(_0xf7f437='DG'),_0xa6039+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x40b626[_0x51e7ce][_0x2be73b(0x153)]+_0x2be73b(0x16b)+_0x2be73b(0x111)+_0x40b626[_0x51e7ce][_0x2be73b(0x10e)]+_0x2be73b(0x16b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x40b626[_0x51e7ce][_0x2be73b(0x16c)]+_0x2be73b(0x16b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x40b626[_0x51e7ce][_0x2be73b(0x1e6)]+'</td>'+_0x2be73b(0x111)+_0x40b626[_0x51e7ce]['secondary_unit']+'</td>'+_0x2be73b(0x111)+_0x48928e['warehouse_name']+_0x2be73b(0x16b)+_0x2be73b(0x111)+_0x40b626[_0x51e7ce][_0x2be73b(0x1f3)]+_0x2be73b(0x16b)+_0x2be73b(0x111)+_0xf7f437+_0x40b626[_0x51e7ce][_0x2be73b(0x1f1)]+_0x2be73b(0x16b);}let _0x34e772=nodemailer[_0x2be73b(0x16d)]({'host':_0x4a8e8a[_0x2be73b(0xe5)],'port':Number(_0x4a8e8a[_0x2be73b(0x10f)]),'secure':![],'auth':{'user':_0x4a8e8a[_0x2be73b(0x14b)],'pass':_0x4a8e8a['password']}}),_0xa14e3b={'from':_0x4a8e8a[_0x2be73b(0x14b)],'to':_0xb0fdf7[0x0][_0x2be73b(0x1ba)],'subject':_0x2be73b(0x1bc),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2be73b(0x100)+'/upload/'+_0x29380e[0x0][_0x2be73b(0x135)],'cid':'logo'}],'html':_0x2be73b(0x198)+_0x2be73b(0x157)+'</head><body>'+_0x2be73b(0x187)+_0x2be73b(0x154)+'<div>'+_0x2be73b(0x141)+_0x2be73b(0x1b0)+_0x2be73b(0x187)+_0x2be73b(0x165)+_0x29380e[0x0][_0x2be73b(0x1a5)]+_0x2be73b(0xd1)+_0x2be73b(0x1b0)+_0x2be73b(0x1b0)+_0x2be73b(0x12d)+'<div>'+_0x2be73b(0x196)+_0x2be73b(0x17c)+_0x48928e[_0x2be73b(0x1b6)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x48928e[_0x2be73b(0x178)]+'\x20'+_0x2be73b(0x114)+_0x2be73b(0x1eb)+_0x2be73b(0x1b0)+_0x2be73b(0x1bd)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2be73b(0xf6)+_0x2be73b(0x199)+_0x2be73b(0x109)+_0x2be73b(0x1cb)+_0x2be73b(0x1d5)+_0x2be73b(0x107)+_0x2be73b(0x151)+_0x2be73b(0x1dd)+_0x2be73b(0x113)+_0x2be73b(0xe0)+_0x2be73b(0x19b)+_0x2be73b(0x117)+'\x20'+_0xa6039+'\x20'+_0x2be73b(0x136)+'</table>'+_0x2be73b(0x187)+'<strong>\x20Regards\x20</strong>'+_0x2be73b(0x17f)+_0x29380e[0x0][_0x2be73b(0x1a5)]+_0x2be73b(0x1eb)+_0x2be73b(0x1b0)+'</div>'+_0x2be73b(0x191)};_0x34e772[_0x2be73b(0x14c)](_0xa14e3b,function(_0x78f890,_0x1679c7){var _0x577b20=_0x2be73b;_0x78f890?(console[_0x577b20(0x177)](_0x78f890),console['log'](_0x577b20(0x104))):console['log'](_0x577b20(0x15f));}),_0x26ef1f[_0x2be73b(0xde)](_0x2be73b(0x11c),_0x2be73b(0x112)),_0x4b8b1e['redirect'](_0x2be73b(0x1a4)+_0x2f3701);}catch(_0x45d40f){console['error'](_0x45d40f),_0x4b8b1e[_0x2be73b(0x155)](0x1f4)['json']({'error':_0x2be73b(0x1e1)});}})[_0x3327ca(0xf3)](_0x5a1b8a=>{var _0x389a16=_0x3327ca;console[_0x389a16(0x102)](_0x5a1b8a),_0x4b8b1e[_0x389a16(0x155)](0x1f4)[_0x389a16(0x130)]({'error':_0x389a16(0x1b7)});});}catch(_0x323f62){console[_0x3327ca(0x177)](_0x323f62);}}),router[a0_0x38ef5e(0x1ce)](a0_0x38ef5e(0x10b),auth,async(_0x22f523,_0x1fd4a5)=>{var _0x5d2278=a0_0x38ef5e;try{const {username:_0x2a47e0,email:_0x1066be,role:_0x83fd4}=_0x22f523[_0x5d2278(0x127)],_0x49767f=_0x22f523['user'],_0x156e0b=await profile['findOne']({'email':_0x49767f['email']}),_0x2d3438=await master_shop[_0x5d2278(0xd3)](),_0x116761=_0x22f523[_0x5d2278(0x1d0)]['id'],_0x212a57=await sales_finished[_0x5d2278(0x1be)](_0x116761);let _0x343cc2=new Date(_0x212a57[_0x5d2278(0x182)]),_0x5c80de=('0'+_0x343cc2[_0x5d2278(0x11f)]())['slice'](-0x2),_0x2ade04=('0'+(_0x343cc2[_0x5d2278(0x18e)]()+0x1))[_0x5d2278(0x1a8)](-0x2),_0xf4f999=_0x343cc2['getFullYear'](),_0x1d70d0=_0xf4f999+'-'+_0x2ade04+'-'+_0x5c80de;var _0x4fff35=[_0x5d2278(0xf8),_0x5d2278(0xdc)];const _0x4bc8ff=await warehouse['aggregate']([{'$match':{'name':_0x212a57[_0x5d2278(0x1da)],'room':_0x212a57[_0x5d2278(0x13e)]}},{'$unwind':_0x5d2278(0x1d3)},{'$group':{'_id':_0x5d2278(0x1e7),'name':{'$first':_0x5d2278(0x1cd)},'product_stock':{'$first':_0x5d2278(0x1f2)},'bay':{'$first':_0x5d2278(0x1ea)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5d2278(0x1c9)},'primary_code':{'$first':_0x5d2278(0x169)},'secondary_code':{'$first':_0x5d2278(0x1a0)},'product_code':{'$first':_0x5d2278(0x126)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5d2278(0xff)}}}]),_0x48dcc3=await customer[_0x5d2278(0xd3)]({});let _0x1950e9;if(_0x49767f[_0x5d2278(0x180)]==_0x5d2278(0x1e8)){const _0x305ef8=await staff[_0x5d2278(0x147)]({'email':_0x49767f['email']});_0x1950e9=await warehouse[_0x5d2278(0x1de)]([{'$match':{'status':_0x5d2278(0x159),'name':_0x305ef8[_0x5d2278(0x1b8)]}},{'$group':{'_id':_0x5d2278(0x19d),'name':{'$first':_0x5d2278(0x19d)}}}]);}else _0x1950e9=await warehouse['aggregate']([{'$match':{'status':_0x5d2278(0x159)}},{'$group':{'_id':_0x5d2278(0x19d),'name':{'$first':_0x5d2278(0x19d)}}}]);const _0x1f0a30=await product[_0x5d2278(0xd3)]({});if(_0x2d3438[0x0][_0x5d2278(0x15b)]==_0x5d2278(0x1c2)){var _0x4ec851=users[_0x5d2278(0x105)];console[_0x5d2278(0x177)](_0x4ec851);}else{if(_0x2d3438[0x0]['language']=='Hindi')var _0x4ec851=users[_0x5d2278(0xe4)];else{if(_0x2d3438[0x0][_0x5d2278(0x15b)]==_0x5d2278(0x1bf))var _0x4ec851=users[_0x5d2278(0x1bf)];else{if(_0x2d3438[0x0][_0x5d2278(0x15b)]==_0x5d2278(0x12a))var _0x4ec851=users['Spanish'];else{if(_0x2d3438[0x0][_0x5d2278(0x15b)]=='French')var _0x4ec851=users['French'];else{if(_0x2d3438[0x0][_0x5d2278(0x15b)]==_0x5d2278(0xe8))var _0x4ec851=users[_0x5d2278(0x106)];else{if(_0x2d3438[0x0][_0x5d2278(0x15b)]==_0x5d2278(0x1c8))var _0x4ec851=users[_0x5d2278(0x1c8)];else{if(_0x2d3438[0x0][_0x5d2278(0x15b)]==_0x5d2278(0x1ef))var _0x4ec851=users['Arabic'];}}}}}}}_0x1fd4a5[_0x5d2278(0x13f)](_0x5d2278(0x1c5),{'success':_0x22f523[_0x5d2278(0xde)]('success'),'errors':_0x22f523[_0x5d2278(0xde)](_0x5d2278(0x1d1)),'role':_0x49767f,'profile':_0x156e0b,'customer':_0x48dcc3,'warehouse':_0x1950e9,'product':_0x4bc8ff,'user':_0x212a57,'master_shop':_0x2d3438,'unit':_0x1f0a30,'language':_0x4ec851,'rooms_data':_0x4fff35,'ed_fullDate':_0x1d70d0});}catch(_0x548133){console[_0x5d2278(0x177)](_0x548133);}}),router[a0_0x38ef5e(0x1bb)](a0_0x38ef5e(0x10b),auth,async(_0x2de700,_0x2fddc7)=>{var _0x48b456=a0_0x38ef5e;try{const _0x53f56e=_0x2de700[_0x48b456(0x1d0)]['id'],_0x1f3170=await sales_finished[_0x48b456(0x147)]({'_id':_0x2de700[_0x48b456(0x1d0)]['id']}),_0xce8a49=await warehouse[_0x48b456(0x147)]({'name':_0x1f3170['warehouse_name'],'room':_0x2de700[_0x48b456(0x13b)]['room'],'warehouse_category':_0x48b456(0x1d7)}),{invoice:_0x14caa1,customer:_0x21f668,date:_0x5187ae,warehouse_name:_0x538f0f,product_name:_0xa4a4e7,stock:_0x535dd5,adjust_qty:_0x150e51,note:_0x44cbc1,room:_0x1357fa,primary_code:_0x1b0895,secondary_code:_0x4730d6,prod_code:_0x31f443,level:_0x24e178,isle:_0x1f341c,pallet:_0x323626,expiry_date:_0xac5a13}=_0x2de700[_0x48b456(0x13b)];if(typeof _0xa4a4e7==_0x48b456(0x1b9))var _0x185b1d=[_0x2de700[_0x48b456(0x13b)]['product_name']],_0x380be3=[_0x2de700[_0x48b456(0x13b)]['stock']],_0x558974=[_0x2de700[_0x48b456(0x13b)]['adjust_qty']],_0x108103=[_0x2de700[_0x48b456(0x13b)]['primary_code']],_0x521322=[_0x2de700['body'][_0x48b456(0x163)]],_0x3d2758=[_0x2de700[_0x48b456(0x13b)][_0x48b456(0x1e3)]],_0x274ba6=[_0x2de700[_0x48b456(0x13b)][_0x48b456(0xfe)]],_0x1f4ed3=[_0x2de700[_0x48b456(0x13b)][_0x48b456(0x182)]];else var _0x185b1d=[..._0x2de700['body']['product_name']],_0x380be3=[..._0x2de700['body']['stock']],_0x558974=[..._0x2de700[_0x48b456(0x13b)]['adjust_qty']],_0x108103=[..._0x2de700['body'][_0x48b456(0x18a)]],_0x521322=[..._0x2de700[_0x48b456(0x13b)][_0x48b456(0x163)]],_0x3d2758=[..._0x2de700[_0x48b456(0x13b)]['prod_code']],_0x274ba6=[..._0x2de700[_0x48b456(0x13b)][_0x48b456(0xfe)]],_0x1f4ed3=[..._0x2de700[_0x48b456(0x13b)][_0x48b456(0x182)]];const _0x23ed93=_0x185b1d[_0x48b456(0x16a)](_0xcdd80=>{return _0xcdd80={'product_name':_0xcdd80};});_0x380be3[_0x48b456(0x1b5)]((_0x510f07,_0x5464ac)=>{_0x23ed93[_0x5464ac]['stock']=_0x510f07;}),_0x558974[_0x48b456(0x1b5)]((_0x2bbe55,_0x1cdfcd)=>{var _0x331fd3=_0x48b456;_0x23ed93[_0x1cdfcd][_0x331fd3(0x16c)]=_0x2bbe55;}),_0x108103[_0x48b456(0x1b5)]((_0x149dc0,_0x298eab)=>{var _0x20b9fb=_0x48b456;_0x23ed93[_0x298eab][_0x20b9fb(0x18a)]=_0x149dc0;}),_0x521322[_0x48b456(0x1b5)]((_0x10d6b3,_0x34e55e)=>{var _0x35cd0b=_0x48b456;_0x23ed93[_0x34e55e][_0x35cd0b(0x163)]=_0x10d6b3;}),_0x3d2758[_0x48b456(0x1b5)]((_0x370b32,_0x28a120)=>{var _0xf3a495=_0x48b456;_0x23ed93[_0x28a120][_0xf3a495(0x10e)]=_0x370b32;}),_0x274ba6[_0x48b456(0x1b5)]((_0x33b9ea,_0x4e7e2e)=>{var _0x2e61ac=_0x48b456;_0x23ed93[_0x4e7e2e][_0x2e61ac(0xfe)]=_0x33b9ea;}),_0x1f4ed3['forEach']((_0x4cbc79,_0x5f54b5)=>{var _0x122bad=_0x48b456;_0x23ed93[_0x5f54b5][_0x122bad(0x182)]=_0x4cbc79;});var _0x17a36a=0x0;_0x23ed93['forEach'](_0x24ee94=>{var _0x45978f=_0x48b456;console[_0x45978f(0x177)](_0x45978f(0x143),_0x24ee94),(parseInt(_0x24ee94[_0x45978f(0x12b)])<parseInt(_0x24ee94[_0x45978f(0x16c)])||parseInt(_0x24ee94[_0x45978f(0x16c)])==0x0)&&_0x17a36a++;});if(_0x17a36a!=0x0)return _0x2de700[_0x48b456(0xde)](_0x48b456(0x1d1),_0x48b456(0x184)),_0x2fddc7['redirect'](_0x48b456(0x144));_0x1f3170[_0x48b456(0xf9)][_0x48b456(0x1b5)](_0xca2c68=>{var _0x45257d=_0x48b456;const _0x10acd3=_0xce8a49[_0x45257d(0x128)][_0x45257d(0x16a)](_0x199e82=>{var _0x2bcf9d=_0x45257d;_0x199e82['product_name']==_0xca2c68[_0x2bcf9d(0x153)]&&_0x199e82['bay']==_0xca2c68[_0x2bcf9d(0x1f1)]&&(_0x199e82['product_stock']=parseInt(_0x199e82[_0x2bcf9d(0x18f)])+parseInt(_0xca2c68['quantity']));});}),await _0xce8a49['save']();const _0x1469d4=_0x23ed93['filter'](_0x1e10d3=>_0x1e10d3[_0x48b456(0x16c)]!=='0'&&_0x1e10d3[_0x48b456(0x16c)]!=='');_0x1f3170[_0x48b456(0x1b6)]=_0x14caa1,_0x1f3170[_0x48b456(0x15e)]=_0x21f668,_0x1f3170[_0x48b456(0x178)]=_0x5187ae,_0x1f3170[_0x48b456(0x1da)]=_0x538f0f,_0x1f3170[_0x48b456(0xf9)]=_0x1469d4,_0x1f3170[_0x48b456(0x1b4)]=_0x44cbc1,_0x1f3170[_0x48b456(0x13e)]=_0x1357fa;const _0x578fef=await _0x1f3170[_0x48b456(0x120)](),_0x26b180=await sales_finished[_0x48b456(0x147)]({'_id':_0x2de700[_0x48b456(0x1d0)]['id']}),_0x5d7a64=await warehouse['findOne']({'name':_0x538f0f,'room':_0x1357fa,'warehouse_category':_0x48b456(0x1d7)});_0x26b180['sale_product'][_0x48b456(0x1b5)](_0x58b4ad=>{var _0x17e7f1=_0x48b456;const _0x4a8919=_0x5d7a64['product_details'][_0x17e7f1(0x16a)](_0x52a52b=>{var _0x434d04=_0x17e7f1;_0x52a52b['product_name']==_0x58b4ad[_0x434d04(0x153)]&&_0x52a52b[_0x434d04(0x1f1)]==_0x58b4ad[_0x434d04(0x1f1)]&&(_0x52a52b[_0x434d04(0x18f)]=parseInt(_0x52a52b[_0x434d04(0x18f)])-parseInt(_0x58b4ad[_0x434d04(0x16c)]));});}),console[_0x48b456(0x177)](_0x48b456(0x195),_0x5d7a64),await _0x5d7a64[_0x48b456(0x120)]();const _0xc60ada=await c_payment_data[_0x48b456(0x147)]({'invoice':_0x2de700[_0x48b456(0x13b)]['invoice']});_0xc60ada[_0x48b456(0x1d4)]=_0x2de700[_0x48b456(0x13b)][_0x48b456(0x1d4)],await _0xc60ada[_0x48b456(0x120)](),_0x2de700[_0x48b456(0xde)](_0x48b456(0x11c),_0x48b456(0x112)),_0x2fddc7[_0x48b456(0x10c)](_0x48b456(0x10d));}catch(_0x276e2c){console[_0x48b456(0x177)](_0x276e2c);}}),router[a0_0x38ef5e(0x1bb)](a0_0x38ef5e(0x17b),auth,async(_0x50459d,_0x2ac1d9)=>{var _0x3f55d4=a0_0x38ef5e;try{const _0x4ceade=_0x50459d['params']['id'],{invoice:_0x5267ee,customer:_0x3a6218,receivable_amount:_0x102710,received_amount:_0x409154}=_0x50459d[_0x3f55d4(0x13b)],_0x3a2ef7=await sales['findById'](_0x4ceade);console[_0x3f55d4(0x177)](_0x3a2ef7);var _0x52333a=_0x102710-_0x409154;console[_0x3f55d4(0x177)](_0x409154),_0x3a2ef7[_0x3f55d4(0x1ab)]=parseFloat(_0x409154)+parseFloat(_0x3a2ef7[_0x3f55d4(0x1ab)]),_0x3a2ef7[_0x3f55d4(0x156)]=_0x52333a,console[_0x3f55d4(0x177)](_0x3a2ef7);const _0x442570=await _0x3a2ef7[_0x3f55d4(0x120)](),_0x48de64=await c_payment_data[_0x3f55d4(0x147)]({'invoice':_0x5267ee});_0x48de64[_0x3f55d4(0xdf)]=_0x52333a,await _0x48de64[_0x3f55d4(0x120)]();let _0x290950=new Date(),_0x5b2b83=('0'+_0x290950[_0x3f55d4(0x11f)]())[_0x3f55d4(0x1a8)](-0x2),_0x1d7ad1=('0'+(_0x290950[_0x3f55d4(0x18e)]()+0x1))[_0x3f55d4(0x1a8)](-0x2),_0x1c7b96=_0x290950['getFullYear'](),_0x4b453b=_0x1c7b96+'-'+_0x1d7ad1+'-'+_0x5b2b83;const _0x56d84f=new customer_payment({'invoice':_0x5267ee,'date':_0x1c7b96+'-'+_0x1d7ad1+'-'+_0x5b2b83,'customer':_0x3a6218,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x409154}),_0x18c697=await _0x56d84f[_0x3f55d4(0x120)]();_0x50459d[_0x3f55d4(0xde)]('success','payment\x20successfull'),_0x2ac1d9[_0x3f55d4(0x10c)](_0x3f55d4(0x1e0));}catch(_0x105ba8){console[_0x3f55d4(0x177)](_0x105ba8);}}),router[a0_0x38ef5e(0x1ce)](a0_0x38ef5e(0x1ee),auth,async(_0x1e2b8d,_0x9db8bf)=>{var _0x25bcfb=a0_0x38ef5e;try{const {username:_0x112267,email:_0x41b774,role:_0x5bde6f}=_0x1e2b8d['user'],_0x436e9f=_0x1e2b8d[_0x25bcfb(0x127)],_0x53e787=await profile[_0x25bcfb(0x147)]({'email':_0x436e9f[_0x25bcfb(0x14b)]}),_0x130719=await master_shop[_0x25bcfb(0xd3)]();console['log'](_0x25bcfb(0x1dc),_0x130719);const _0x42f5df=_0x1e2b8d[_0x25bcfb(0x1d0)]['id'],_0x173fa6=await sales[_0x25bcfb(0x1be)](_0x42f5df);console[_0x25bcfb(0x177)](_0x173fa6);const _0x11908f=await customer[_0x25bcfb(0x147)]({'name':_0x173fa6['customer']});console[_0x25bcfb(0x177)](_0x11908f);if(_0x130719[0x0][_0x25bcfb(0x15b)]==_0x25bcfb(0x1c2)){var _0x4cf2ff=users[_0x25bcfb(0x105)];console['log'](_0x4cf2ff);}else{if(_0x130719[0x0][_0x25bcfb(0x15b)]==_0x25bcfb(0xe4))var _0x4cf2ff=users[_0x25bcfb(0xe4)];else{if(_0x130719[0x0][_0x25bcfb(0x15b)]==_0x25bcfb(0x1bf))var _0x4cf2ff=users[_0x25bcfb(0x1bf)];else{if(_0x130719[0x0]['language']=='Spanish')var _0x4cf2ff=users[_0x25bcfb(0x12a)];else{if(_0x130719[0x0]['language']=='French')var _0x4cf2ff=users[_0x25bcfb(0xe9)];else{if(_0x130719[0x0][_0x25bcfb(0x15b)]==_0x25bcfb(0xe8))var _0x4cf2ff=users['Portuguese'];else{if(_0x130719[0x0][_0x25bcfb(0x15b)]==_0x25bcfb(0x1c8))var _0x4cf2ff=users[_0x25bcfb(0x1c8)];else{if(_0x130719[0x0]['language']==_0x25bcfb(0x1ef))var _0x4cf2ff=users[_0x25bcfb(0x1ad)];}}}}}}}_0x9db8bf[_0x25bcfb(0x13f)](_0x25bcfb(0x1d6),{'success':_0x1e2b8d[_0x25bcfb(0xde)]('success'),'errors':_0x1e2b8d[_0x25bcfb(0xde)](_0x25bcfb(0x1d1)),'role':_0x436e9f,'profile':_0x53e787,'master_shop':_0x130719,'customers':_0x11908f,'sales':_0x173fa6,'language':_0x4cf2ff});}catch(_0x1a069a){console[_0x25bcfb(0x177)](_0x1a069a);}}),router[a0_0x38ef5e(0x1ce)](a0_0x38ef5e(0x15d),auth,async(_0x567ded,_0x40c1f2)=>{var _0x31872c=a0_0x38ef5e;try{const {username:_0x16eb98,email:_0x25992a,role:_0x3c0a8c}=_0x567ded[_0x31872c(0x127)],_0x54c5ac=_0x567ded[_0x31872c(0x127)],_0x6881b1=await profile['findOne']({'email':_0x54c5ac[_0x31872c(0x14b)]}),_0x269730=await master_shop[_0x31872c(0xd3)](),_0x1513eb=_0x567ded[_0x31872c(0x1d0)]['id'],_0x46f4a6=await sales_finished['findById'](_0x1513eb),_0x415feb=await warehouse[_0x31872c(0x1de)]([{'$match':{'name':_0x46f4a6[_0x31872c(0x1da)]}},{'$unwind':_0x31872c(0x1d3)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x31872c(0x1cd)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x31872c(0x140)},'type':{'$first':_0x31872c(0xf2)},'floorlevel':{'$first':_0x31872c(0x1c9)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x31872c(0x1a0)},'product_code':{'$first':_0x31872c(0x126)},'storage':{'$first':_0x31872c(0x19c)},'rack':{'$first':_0x31872c(0xff)},'expiry_date':{'$first':_0x31872c(0x1a9)},'production_date':{'$first':_0x31872c(0x1c3)},'unit':{'$first':_0x31872c(0x1e4)},'secondary_unit':{'$first':_0x31872c(0x17d)},'maxProducts':{'$first':_0x31872c(0x125)},'batch_code':{'$first':_0x31872c(0xd4)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x3237b3=await product[_0x31872c(0xd3)]({}),_0x2a2dae=await warehouse[_0x31872c(0x1de)]([{'$match':{'status':_0x31872c(0x159),'warehouse_category':_0x31872c(0x1d7),'name':{'$ne':'Return\x20Goods','$ne':_0x31872c(0xd6)}}},{'$group':{'_id':_0x31872c(0x19d),'name':{'$first':_0x31872c(0x19d)}}},{'$sort':{'name':0x1}}]);var _0x2a974d=[_0x31872c(0x161)];const _0x3aa94e=await warehouse[_0x31872c(0x1de)]([{'$match':{'status':_0x31872c(0x159),'name':_0x31872c(0xd6)}},{'$group':{'_id':_0x31872c(0x19d),'name':{'$first':_0x31872c(0x19d)}}},{'$sort':{'name':0x1}}]);if(_0x269730[0x0][_0x31872c(0x15b)]==_0x31872c(0x1c2)){var _0x13232c=users[_0x31872c(0x105)];console['log'](_0x13232c);}else{if(_0x269730[0x0][_0x31872c(0x15b)]=='Hindi')var _0x13232c=users['Hindi'];else{if(_0x269730[0x0]['language']=='German')var _0x13232c=users['German'];else{if(_0x269730[0x0][_0x31872c(0x15b)]==_0x31872c(0x12a))var _0x13232c=users[_0x31872c(0x12a)];else{if(_0x269730[0x0][_0x31872c(0x15b)]==_0x31872c(0xe9))var _0x13232c=users[_0x31872c(0xe9)];else{if(_0x269730[0x0][_0x31872c(0x15b)]==_0x31872c(0xe8))var _0x13232c=users[_0x31872c(0x106)];else{if(_0x269730[0x0]['language']=='Chinese')var _0x13232c=users[_0x31872c(0x1c8)];else{if(_0x269730[0x0][_0x31872c(0x15b)]==_0x31872c(0x1ef))var _0x13232c=users[_0x31872c(0x1ad)];}}}}}}}_0x40c1f2[_0x31872c(0x13f)](_0x31872c(0x17e),{'success':_0x567ded[_0x31872c(0xde)]('success'),'errors':_0x567ded['flash']('errors'),'role':_0x54c5ac,'profile':_0x6881b1,'user':_0x46f4a6,'stock':_0x415feb,'master_shop':_0x269730,'unit':_0x3237b3,'language':_0x13232c,'warehouses':_0x2a2dae,'rooms':_0x2a974d,'warehouse_QA':_0x3aa94e});}catch(_0x44c07d){console['log'](_0x44c07d),_0x40c1f2[_0x31872c(0x155)](0xc8)[_0x31872c(0x130)]({'message':_0x44c07d['message']});}}),router[a0_0x38ef5e(0x1bb)](a0_0x38ef5e(0x15d),auth,async(_0x468aef,_0x5b446b)=>{var _0xa4642b=a0_0x38ef5e;if(_0x468aef['body']['for_categorize']=='QA')try{const {invoice:_0x21f8d0,date:_0x4aebb3,warehouse_name:_0x3beae2,product_name:_0x39beb2,primary_code:_0x98c42e,secondary_code:_0x466994,product_code:_0x54e4af,sales_quantity:_0x4f5944,stocks:_0x5c6560,return_qty:_0x4aabb9,Room_name:_0x485122,to_warehouse_name_QA:_0x596ffd,to_Room_name_QA:_0x35d215,note:_0x5d1896,for_categorize:_0x1a1494,product_name_QA1:_0x52884a}=_0x468aef[_0xa4642b(0x13b)];if(typeof _0x52884a==_0xa4642b(0x1b9))var _0x2a41ad=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0xed)]],_0x2519a9=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x1f4)]],_0x18a477=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x167)]],_0x336595=[_0x468aef['body'][_0xa4642b(0x11a)]],_0x30b114=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x183)]],_0x3b6bb8=[_0x468aef[_0xa4642b(0x13b)]['stocks_QA']],_0x17d7df=[_0x468aef['body'][_0xa4642b(0xe7)]],_0x21d50c=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x1e9)]],_0x267a82=[_0x468aef['body'][_0xa4642b(0x118)]],_0x254a16=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0xfa)]],_0x4b4c58=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x132)]],_0x3ea2b4=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x1ac)]],_0xdca60a=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x1ec)]],_0x5629f2=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x119)]];else var _0x2a41ad=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0xed)]],_0x2519a9=[..._0x468aef['body']['primary_code_QA']],_0x18a477=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x167)]],_0x336595=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x11a)]],_0x30b114=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x183)]],_0x3b6bb8=[..._0x468aef['body'][_0xa4642b(0x1c0)]],_0x17d7df=[..._0x468aef['body'][_0xa4642b(0xe7)]],_0x21d50c=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x1e9)]],_0x267a82=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x118)]],_0x254a16=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0xfa)]],_0x4b4c58=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x132)]],_0x3ea2b4=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x1ac)]],_0xdca60a=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x1ec)]],_0x5629f2=[..._0x468aef[_0xa4642b(0x13b)]['expiry_date_QA']];const _0x3682dd=_0x2a41ad[_0xa4642b(0x16a)](_0x32d3ee=>{return _0x32d3ee={'product_name':_0x32d3ee};});_0x2519a9[_0xa4642b(0x1b5)]((_0x14e0a2,_0x1f806c)=>{var _0x5467d4=_0xa4642b;_0x3682dd[_0x1f806c][_0x5467d4(0x18a)]=_0x14e0a2;}),_0x18a477[_0xa4642b(0x1b5)]((_0x16ed8e,_0x3ccafe)=>{var _0x2060c9=_0xa4642b;_0x3682dd[_0x3ccafe][_0x2060c9(0x163)]=_0x16ed8e;}),_0x336595[_0xa4642b(0x1b5)]((_0xdfc0cb,_0x12d25f)=>{var _0x330428=_0xa4642b;_0x3682dd[_0x12d25f][_0x330428(0x10e)]=_0xdfc0cb;}),_0x30b114[_0xa4642b(0x1b5)]((_0x173678,_0x57ce42)=>{_0x3682dd[_0x57ce42]['sale_qty']=_0x173678;}),_0x3b6bb8[_0xa4642b(0x1b5)]((_0x509be3,_0x3582e1)=>{_0x3682dd[_0x3582e1]['stock']=_0x509be3;}),_0x17d7df[_0xa4642b(0x1b5)]((_0x5d97af,_0x6f76ba)=>{var _0x530188=_0xa4642b;_0x3682dd[_0x6f76ba][_0x530188(0x139)]=_0x5d97af;}),_0x21d50c[_0xa4642b(0x1b5)]((_0x32e052,_0x2a88df)=>{var _0xde6881=_0xa4642b;_0x3682dd[_0x2a88df][_0xde6881(0x138)]=_0x32e052;}),_0x267a82[_0xa4642b(0x1b5)]((_0x574851,_0x3b625a)=>{var _0xfb6e10=_0xa4642b;_0x3682dd[_0x3b625a][_0xfb6e10(0xda)]=_0x574851;}),_0x254a16[_0xa4642b(0x1b5)]((_0x2bbd86,_0x920ef3)=>{var _0x178dfc=_0xa4642b;_0x3682dd[_0x920ef3][_0x178dfc(0x146)]=_0x2bbd86;}),_0x4b4c58[_0xa4642b(0x1b5)]((_0x56a952,_0x373f36)=>{_0x3682dd[_0x373f36]['secondary_unit']=_0x56a952;}),_0x3ea2b4[_0xa4642b(0x1b5)]((_0x2524df,_0x17b979)=>{var _0x5f1102=_0xa4642b;_0x3682dd[_0x17b979][_0x5f1102(0x1e6)]=_0x2524df;}),_0xdca60a[_0xa4642b(0x1b5)]((_0x42ae70,_0x413044)=>{var _0x33f9b7=_0xa4642b;_0x3682dd[_0x413044][_0x33f9b7(0x162)]=_0x42ae70;}),_0x5629f2[_0xa4642b(0x1b5)]((_0x3a7e23,_0xec879a)=>{_0x3682dd[_0xec879a]['expiry_date']=_0x3a7e23;});const _0x8f6129=await sales_finished[_0xa4642b(0x147)]({'invoice':_0x21f8d0});_0x8f6129[_0xa4642b(0xd8)]='True';const _0x1196f0=await _0x8f6129[_0xa4642b(0x120)](),_0x1c0043=new sales_return_finished({'invoice':_0x21f8d0,'customer':_0x468aef['body'][_0xa4642b(0x15e)],'date':_0x4aebb3,'warehouse_name':_0x3beae2,'room':_0x485122,'ToWarehouse':_0x596ffd,'ToRoom':_0x35d215,'return_sale_QA':_0x3682dd,'note':_0x5d1896,'warehouse_cat':_0x1a1494}),_0x4002f6=await _0x1c0043[_0xa4642b(0x120)](),_0x343e62=await sales_return_finished[_0xa4642b(0x147)]({'invoice':_0x21f8d0}),_0x265f01=await warehouse[_0xa4642b(0x147)]({'name':_0x596ffd,'room':_0x35d215});_0x343e62[_0xa4642b(0x18d)][_0xa4642b(0x1b5)](_0x365b82=>{var _0x36600b=_0xa4642b,_0x5bfb3b=0x0;const _0x4fa9e9=_0x265f01[_0x36600b(0x128)][_0x36600b(0x16a)](_0x5a314d=>{var _0x51a06e=_0x36600b;_0x5a314d[_0x51a06e(0x153)]==_0x365b82[_0x51a06e(0x153)]&&_0x5a314d[_0x51a06e(0x182)]==_0x365b82['expiry_date']&&_0x5a314d[_0x51a06e(0x162)]==_0x365b82[_0x51a06e(0x162)]&&_0x5a314d[_0x51a06e(0x146)]==_0x365b82['batch_code']&&(_0x5a314d['product_stock']=parseInt(_0x5a314d[_0x51a06e(0x18f)])+parseInt(_0x365b82[_0x51a06e(0x139)]),_0x5bfb3b++);});_0x5bfb3b=='0'&&(_0x265f01[_0x36600b(0x128)]=_0x265f01[_0x36600b(0x128)][_0x36600b(0xdb)]({'product_name':_0x365b82[_0x36600b(0x153)],'product_stock':_0x365b82['return_qty'],'primary_code':_0x365b82['primary_code'],'secondary_code':_0x365b82[_0x36600b(0x163)],'product_code':_0x365b82['product_code'],'batch_code':_0x365b82[_0x36600b(0x146)],'maxPerUnit':_0x365b82[_0x36600b(0x138)],'production_date':_0x365b82[_0x36600b(0x162)],'expiry_date':_0x365b82[_0x36600b(0x182)],'secondary_unit':_0x365b82['secondary_unit'],'unit':_0x365b82[_0x36600b(0x1e6)],'maxProducts':_0x365b82[_0x36600b(0xda)],'bay':_0x365b82['bay']}));}),await _0x265f01['save']();const _0x4ef68a=new c_payment_data({'invoice':_0x21f8d0,'customer':_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x15e)],'reason':_0xa4642b(0x1cf)});await _0x4ef68a[_0xa4642b(0x120)]();const _0x13e3f8=await master_shop[_0xa4642b(0xd3)](),_0xfd4a69=await email_settings[_0xa4642b(0x147)](),_0x17fbda=await customer[_0xa4642b(0x147)]({'name':_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x15e)]});_0x13e3f8[0x0][_0xa4642b(0x1b2)]==0x1?(right_currency=_0x13e3f8[0x0][_0xa4642b(0x1f0)],left_currency=''):(right_currency='',left_currency=_0x13e3f8[0x0][_0xa4642b(0x1f0)]);var _0x19d37d=_0x2a41ad,_0x59a97e=_0x17d7df,_0x2693c7='',_0xacfc2b;for(_0xacfc2b in _0x19d37d){_0x2693c7+=_0xa4642b(0xf6)+_0xa4642b(0x111)+_0x19d37d[_0xacfc2b]+_0xa4642b(0x16b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59a97e[_0xacfc2b]+_0xa4642b(0x16b)+_0xa4642b(0xe0);}console[_0xa4642b(0x177)]('product_list',_0x2693c7);let _0x51ad46=nodemailer[_0xa4642b(0x16d)]({'service':'gmail','auth':{'user':_0xfd4a69[_0xa4642b(0x14b)],'pass':_0xfd4a69['password']}}),_0x1a6431={'from':_0xfd4a69[_0xa4642b(0x14b)],'to':_0x17fbda[_0xa4642b(0x14b)],'subject':_0xa4642b(0x11b),'attachments':[{'filename':_0xa4642b(0x1b3),'path':__dirname+_0xa4642b(0x100)+'/upload/'+_0x13e3f8[0x0][_0xa4642b(0x135)],'cid':_0xa4642b(0x1c7)}],'html':_0xa4642b(0x198)+_0xa4642b(0x157)+_0xa4642b(0xec)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0xa4642b(0x187)+_0xa4642b(0x165)+_0x13e3f8[0x0][_0xa4642b(0x1a5)]+_0xa4642b(0xd1)+_0xa4642b(0x1b0)+'</div>'+_0xa4642b(0x12d)+_0xa4642b(0x187)+_0xa4642b(0x196)+_0xa4642b(0x17c)+_0x21f8d0+'\x20'+_0xa4642b(0x19f)+'\x20Order\x20Date\x20:\x20'+_0x4aebb3+'\x20'+_0xa4642b(0x114)+'</h5>'+_0xa4642b(0x1b0)+_0xa4642b(0x1bd)+_0xa4642b(0xea)+_0xa4642b(0xf6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xa4642b(0x189)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0xa4642b(0xf4)+_0xa4642b(0xe0)+_0xa4642b(0x19b)+_0xa4642b(0x117)+'\x20'+_0x2693c7+'\x20'+'</tbody>'+_0xa4642b(0x1c4)+_0xa4642b(0x187)+_0xa4642b(0x188)+_0xa4642b(0x17f)+_0x13e3f8[0x0]['site_title']+'</h5>'+_0xa4642b(0x1b0)+_0xa4642b(0x1b0)+_0xa4642b(0x191)};_0x51ad46['sendMail'](_0x1a6431,function(_0x46aeac,_0x85c40f){var _0x118562=_0xa4642b;_0x46aeac?(console[_0x118562(0x177)](_0x46aeac),console[_0x118562(0x177)](_0x118562(0x104))):console['log'](_0x118562(0x15f));}),_0x468aef[_0xa4642b(0xde)](_0xa4642b(0x11c),_0xa4642b(0x129)),_0x5b446b[_0xa4642b(0x10c)]('/all_sales_finished/view');}catch(_0x41abb6){_0x5b446b[_0xa4642b(0x155)](0xc8)['json']({'message1':_0x41abb6[_0xa4642b(0x11d)]});}else{if(_0x468aef['body'][_0xa4642b(0x171)]=='GS')try{const {invoice:_0x32eb51,date:_0x1f05ae,warehouse_name:_0x533be6,product_name:_0x500859,primary_code:_0x2665ad,secondary_code:_0x4f571b,product_code:_0x48b89b,sales_quantity:_0x19a41b,stocks:_0x59e46f,return_qty:_0xc9458a,Room_name:_0x59dd72,to_warehouse_name:_0xb88af9,to_Room_name:_0xe12178,note:_0x4ffc89,level:_0x50d41e,isle:_0x479058,pallet:_0x4e4066,for_categorize:_0x4b07f0}=_0x468aef[_0xa4642b(0x13b)];if(typeof _0x500859==_0xa4642b(0x1b9))var _0x2a41ad=[_0x468aef['body'][_0xa4642b(0x153)]],_0x2519a9=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x18a)]],_0x18a477=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x163)]],_0x336595=[_0x468aef[_0xa4642b(0x13b)]['product_code']],_0x30b114=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x192)]],_0x17d7df=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x139)]],_0xb9822e=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x1f1)]],_0x21d50c=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x138)]],_0x267a82=[_0x468aef[_0xa4642b(0x13b)]['maxProducts']],_0x254a16=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x146)]],_0x4b4c58=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0xe1)]],_0x3ea2b4=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x1e6)]],_0xdca60a=[_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x162)]],_0x5629f2=[_0x468aef[_0xa4642b(0x13b)]['expiry_date']];else var _0x2a41ad=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x153)]],_0x2519a9=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x18a)]],_0x18a477=[..._0x468aef['body']['secondary_code']],_0x336595=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x10e)]],_0x30b114=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x192)]],_0x17d7df=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x139)]],_0xb9822e=[..._0x468aef['body'][_0xa4642b(0x1f1)]],_0x21d50c=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x138)]],_0x267a82=[..._0x468aef['body']['maxProducts']],_0x254a16=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x146)]],_0x4b4c58=[..._0x468aef[_0xa4642b(0x13b)]['secondary_unit']],_0x3ea2b4=[..._0x468aef['body'][_0xa4642b(0x1e6)]],_0xdca60a=[..._0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x162)]],_0x5629f2=[..._0x468aef['body'][_0xa4642b(0x182)]];const _0x5f3194=_0x2a41ad[_0xa4642b(0x16a)](_0x42d2ff=>{return _0x42d2ff={'product_name':_0x42d2ff};});_0x2519a9[_0xa4642b(0x1b5)]((_0x586ceb,_0x1c45a5)=>{var _0x97d7d3=_0xa4642b;_0x5f3194[_0x1c45a5][_0x97d7d3(0x18a)]=_0x586ceb;}),_0x18a477[_0xa4642b(0x1b5)]((_0x31e82d,_0x1533bf)=>{var _0x4bec46=_0xa4642b;_0x5f3194[_0x1533bf][_0x4bec46(0x163)]=_0x31e82d;}),_0x336595[_0xa4642b(0x1b5)]((_0x2784cb,_0x4cbb34)=>{var _0x416b3a=_0xa4642b;_0x5f3194[_0x4cbb34][_0x416b3a(0x10e)]=_0x2784cb;}),_0x30b114[_0xa4642b(0x1b5)]((_0x2c2df9,_0x386b40)=>{_0x5f3194[_0x386b40]['sale_qty']=_0x2c2df9;}),_0x17d7df['forEach']((_0x29c72f,_0x37f3e4)=>{_0x5f3194[_0x37f3e4]['return_qty']=_0x29c72f;}),_0xb9822e[_0xa4642b(0x1b5)]((_0x47479a,_0x59063c)=>{var _0xe7657=_0xa4642b;_0x5f3194[_0x59063c][_0xe7657(0x1f1)]=_0x47479a;}),_0x21d50c[_0xa4642b(0x1b5)]((_0x369454,_0x5b80e9)=>{var _0x234074=_0xa4642b;_0x5f3194[_0x5b80e9][_0x234074(0x138)]=_0x369454;}),_0x267a82[_0xa4642b(0x1b5)]((_0x53c69f,_0x1cb168)=>{_0x5f3194[_0x1cb168]['maxProducts']=_0x53c69f;}),_0x254a16[_0xa4642b(0x1b5)]((_0xf840d9,_0x1857f0)=>{_0x5f3194[_0x1857f0]['batch_code']=_0xf840d9;}),_0x4b4c58[_0xa4642b(0x1b5)]((_0x2ce1c0,_0x3702b5)=>{var _0x282adb=_0xa4642b;_0x5f3194[_0x3702b5][_0x282adb(0xe1)]=_0x2ce1c0;}),_0x3ea2b4[_0xa4642b(0x1b5)]((_0xc52a33,_0x146a88)=>{var _0x1b43ec=_0xa4642b;_0x5f3194[_0x146a88][_0x1b43ec(0x1e6)]=_0xc52a33;}),_0xdca60a[_0xa4642b(0x1b5)]((_0x5ac671,_0x7bc9b1)=>{var _0xcd1d28=_0xa4642b;_0x5f3194[_0x7bc9b1][_0xcd1d28(0x162)]=_0x5ac671;}),_0x5629f2[_0xa4642b(0x1b5)]((_0x13787d,_0x66f5ac)=>{var _0x485540=_0xa4642b;_0x5f3194[_0x66f5ac][_0x485540(0x182)]=_0x13787d;});var _0x2df3b6=0x0;_0x5f3194[_0xa4642b(0x1b5)](_0x2e2b6d=>{var _0x3e97e9=_0xa4642b;(parseInt(_0x2e2b6d[_0x3e97e9(0x18b)])<parseInt(_0x2e2b6d[_0x3e97e9(0x139)])||parseInt(_0x2e2b6d[_0x3e97e9(0x12b)])<parseInt(_0x2e2b6d['return_qty'])&&parseInt(_0x2e2b6d['sale_qty'])>parseInt(_0x2e2b6d[_0x3e97e9(0x139)])||parseInt(_0x2e2b6d[_0x3e97e9(0x139)])==0x0)&&_0x2df3b6++;});if(_0x2df3b6!=0x0)return _0x468aef['flash'](_0xa4642b(0x1d1),_0xa4642b(0xeb)),_0x5b446b[_0xa4642b(0x10c)](_0xa4642b(0x144));const _0xc33ade=await sales_finished[_0xa4642b(0x147)]({'invoice':_0x32eb51});_0xc33ade[_0xa4642b(0xd8)]='True';const _0xe827d7=await _0xc33ade[_0xa4642b(0x120)](),_0x3de777=new sales_return_finished({'invoice':_0x32eb51,'customer':_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x15e)],'date':_0x1f05ae,'warehouse_name':_0x533be6,'room':_0x59dd72,'ToWarehouse':_0xb88af9,'ToRoom':_0xe12178,'return_sale':_0x5f3194,'note':_0x4ffc89,'warehouse_cat':_0x4b07f0}),_0x24b6bb=await _0x3de777[_0xa4642b(0x120)](),_0x323fab=await sales_return_finished['findOne']({'invoice':_0x32eb51}),_0xc1c93d=await warehouse[_0xa4642b(0x147)]({'name':_0xb88af9,'room':_0xe12178,'warehouse_category':'Finished\x20Goods'});_0x323fab[_0xa4642b(0x18c)]['forEach'](_0x4d6814=>{var _0x1437ab=_0xa4642b,_0x3b93d4=0x0;const _0x2305f9=_0xc1c93d[_0x1437ab(0x128)]['map'](_0x24c06f=>{var _0x568ae5=_0x1437ab;_0x24c06f[_0x568ae5(0x153)]==_0x4d6814[_0x568ae5(0x153)]&&_0x24c06f['bay']==_0x4d6814[_0x568ae5(0x1f1)]&&_0x24c06f['expiry_date']==_0x4d6814['expiry_date']&&_0x24c06f[_0x568ae5(0x162)]==_0x4d6814['production_date']&&_0x24c06f[_0x568ae5(0x146)]==_0x4d6814['batch_code']&&(_0x24c06f['product_stock']=parseInt(_0x24c06f['product_stock'])+parseInt(_0x4d6814[_0x568ae5(0x139)]),_0x3b93d4++);});_0x3b93d4=='0'&&(_0xc1c93d[_0x1437ab(0x128)]=_0xc1c93d[_0x1437ab(0x128)][_0x1437ab(0xdb)]({'product_name':_0x4d6814['product_name'],'product_stock':_0x4d6814[_0x1437ab(0x139)],'primary_code':_0x4d6814[_0x1437ab(0x18a)],'secondary_code':_0x4d6814[_0x1437ab(0x163)],'product_code':_0x4d6814[_0x1437ab(0x10e)],'bay':_0x4d6814[_0x1437ab(0x1f1)],'batch_code':_0x4d6814[_0x1437ab(0x146)],'maxPerUnit':_0x4d6814['maxPerUnit'],'production_date':_0x4d6814[_0x1437ab(0x162)],'expiry_date':_0x4d6814[_0x1437ab(0x182)],'secondary_unit':_0x4d6814[_0x1437ab(0xe1)],'unit':_0x4d6814['unit'],'maxProducts':_0x4d6814[_0x1437ab(0xda)]}));}),await _0xc1c93d['save'](),console[_0xa4642b(0x177)](_0x468aef[_0xa4642b(0x13b)]);const _0x1a20ac=new c_payment_data({'invoice':_0x32eb51,'customer':_0x468aef[_0xa4642b(0x13b)][_0xa4642b(0x15e)],'reason':_0xa4642b(0x1cf)});await _0x1a20ac[_0xa4642b(0x120)]();const _0x51aa90=await master_shop[_0xa4642b(0xd3)]();console[_0xa4642b(0x177)](_0xa4642b(0x19e),_0x51aa90[0x0][_0xa4642b(0x135)]);const _0x2cfa2c=await email_settings[_0xa4642b(0x147)](),_0x4624a2=await customer[_0xa4642b(0x147)]({'name':_0x468aef['body']['customer']});console[_0xa4642b(0x177)](_0xa4642b(0xf7),_0x4624a2);_0x51aa90[0x0][_0xa4642b(0x1b2)]==0x1?(right_currency=_0x51aa90[0x0][_0xa4642b(0x1f0)],left_currency=''):(right_currency='',left_currency=_0x51aa90[0x0]['currency']);var _0x19d37d=_0x2a41ad,_0x59a97e=_0x17d7df,_0x2693c7='',_0xacfc2b;for(_0xacfc2b in _0x19d37d){_0x2693c7+=_0xa4642b(0xf6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x19d37d[_0xacfc2b]+'</td>'+_0xa4642b(0x111)+_0x59a97e[_0xacfc2b]+_0xa4642b(0x16b)+_0xa4642b(0xe0);}console[_0xa4642b(0x177)](_0xa4642b(0x158),_0x2693c7);let _0x5f04a7=nodemailer[_0xa4642b(0x16d)]({'service':_0xa4642b(0x1a2),'auth':{'user':_0x2cfa2c[_0xa4642b(0x14b)],'pass':_0x2cfa2c[_0xa4642b(0x134)]}}),_0x30a739={'from':_0x2cfa2c[_0xa4642b(0x14b)],'to':_0x4624a2[_0xa4642b(0x14b)],'subject':_0xa4642b(0x11b),'attachments':[{'filename':_0xa4642b(0x1b3),'path':__dirname+_0xa4642b(0x100)+'/upload/'+_0x51aa90[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0xa4642b(0x157)+_0xa4642b(0xec)+'<div>'+_0xa4642b(0x154)+'<div>'+_0xa4642b(0x141)+'</div>'+_0xa4642b(0x187)+_0xa4642b(0x165)+_0x51aa90[0x0][_0xa4642b(0x1a5)]+_0xa4642b(0xd1)+_0xa4642b(0x1b0)+_0xa4642b(0x1b0)+_0xa4642b(0x12d)+_0xa4642b(0x187)+_0xa4642b(0x196)+_0xa4642b(0x17c)+_0x32eb51+'\x20'+_0xa4642b(0x19f)+_0xa4642b(0x1df)+_0x1f05ae+'\x20'+_0xa4642b(0x114)+_0xa4642b(0x1eb)+_0xa4642b(0x1b0)+_0xa4642b(0x1bd)+_0xa4642b(0xea)+'<tr>'+_0xa4642b(0x199)+_0xa4642b(0x189)+_0xa4642b(0xfd)+_0xa4642b(0xf4)+_0xa4642b(0xe0)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2693c7+'\x20'+'</tbody>'+_0xa4642b(0x1c4)+_0xa4642b(0x187)+_0xa4642b(0x188)+_0xa4642b(0x17f)+_0x51aa90[0x0][_0xa4642b(0x1a5)]+'</h5>'+_0xa4642b(0x1b0)+_0xa4642b(0x1b0)+_0xa4642b(0x191)};_0x5f04a7[_0xa4642b(0x14c)](_0x30a739,function(_0x4c5b65,_0x28bf33){var _0x46f259=_0xa4642b;_0x4c5b65?(console[_0x46f259(0x177)](_0x4c5b65),console[_0x46f259(0x177)](_0x46f259(0x104))):console[_0x46f259(0x177)](_0x46f259(0x15f));}),_0x468aef[_0xa4642b(0xde)](_0xa4642b(0x11c),_0xa4642b(0x129)),_0x5b446b[_0xa4642b(0x10c)](_0xa4642b(0x10d));}catch(_0x2b996f){console['log'](_0x2b996f),_0x5b446b[_0xa4642b(0x155)](0xc8)['json']({'message1':_0x2b996f[_0xa4642b(0x11d)]});}}}),router[a0_0x38ef5e(0x1ce)](a0_0x38ef5e(0x186),auth,async(_0x81f62c,_0x4f1831)=>{var _0x31678a=a0_0x38ef5e;try{const {username:_0x49ec9a,email:_0x2c559e,role:_0x129549}=_0x81f62c[_0x31678a(0x127)],_0x2eb4a1=_0x81f62c[_0x31678a(0x127)],_0x479f4d=await profile['findOne']({'email':_0x2eb4a1[_0x31678a(0x14b)]}),_0x2cae10=await master_shop[_0x31678a(0xd3)]();console[_0x31678a(0x177)]('barcode\x20Product\x20master',_0x2cae10);const _0x587a61=_0x81f62c[_0x31678a(0x1d0)]['id'],_0x50a0f0=await sales[_0x31678a(0x1be)](_0x587a61);console[_0x31678a(0x177)]('barcode\x20user_id',_0x50a0f0);if(_0x2cae10[0x0][_0x31678a(0x15b)]==_0x31678a(0x1c2))var _0xa07604=users[_0x31678a(0x105)];else{if(_0x2cae10[0x0][_0x31678a(0x15b)]==_0x31678a(0xe4))var _0xa07604=users[_0x31678a(0xe4)];else{if(_0x2cae10[0x0][_0x31678a(0x15b)]=='German')var _0xa07604=users[_0x31678a(0x1bf)];else{if(_0x2cae10[0x0][_0x31678a(0x15b)]==_0x31678a(0x12a))var _0xa07604=users[_0x31678a(0x12a)];else{if(_0x2cae10[0x0][_0x31678a(0x15b)]==_0x31678a(0xe9))var _0xa07604=users[_0x31678a(0xe9)];else{if(_0x2cae10[0x0][_0x31678a(0x15b)]==_0x31678a(0xe8))var _0xa07604=users[_0x31678a(0x106)];else{if(_0x2cae10[0x0][_0x31678a(0x15b)]==_0x31678a(0x1c8))var _0xa07604=users[_0x31678a(0x1c8)];else{if(_0x2cae10[0x0][_0x31678a(0x15b)]==_0x31678a(0x1ef))var _0xa07604=users[_0x31678a(0x1ad)];}}}}}}}_0x4f1831['render'](_0x31678a(0x145),{'success':_0x81f62c[_0x31678a(0xde)](_0x31678a(0x11c)),'errors':_0x81f62c['flash'](_0x31678a(0x1d1)),'role':_0x2eb4a1,'profile':_0x479f4d,'alldata':_0x50a0f0,'master_shop':_0x2cae10,'language':_0xa07604});}catch(_0x423127){console['log'](_0x423127);}}),router[a0_0x38ef5e(0x1bb)](a0_0x38ef5e(0x1e5),async(_0x1478e8,_0x3aa822)=>{var _0x189171=a0_0x38ef5e;const {product_code:_0x19c9f2,warehouse_name:_0x575825,rooms_data:_0x45a101,Roomslist:_0x104919}=_0x1478e8['body'],_0x40321a=_0x104919['split'](','),_0x13d4a5=[];async function _0x487746(_0x1dcd2b){var _0x1423b0=a0_0x4700;const _0x23779d=await warehouse['aggregate']([{'$match':{'name':_0x575825,'room':_0x1dcd2b}},{'$unwind':_0x1423b0(0x1d3)},{'$match':{'product_details.primary_code':_0x19c9f2}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1423b0(0x1cd)},'product_stock':{'$first':_0x1423b0(0x1f2)},'primary_code':{'$first':_0x1423b0(0x169)},'secondary_code':{'$first':_0x1423b0(0x1a0)},'product_code':{'$first':_0x1423b0(0x126)},'level':{'$first':_0x1423b0(0x1ea)},'isle':{'$first':_0x1423b0(0x140)},'type':{'$first':_0x1423b0(0xf2)},'pallet':{'$first':_0x1423b0(0x1c9)},'unit':{'$first':_0x1423b0(0x1e4)},'secondary_unit':{'$first':_0x1423b0(0x17d)},'storage':{'$first':_0x1423b0(0x19c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1423b0(0x1a9)},'production_date':{'$first':_0x1423b0(0x1c3)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x1423b0(0x1d8)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x1423b0(0x175)},'invoice':{'$first':_0x1423b0(0x16e)}}}]),_0x30da4e=await warehouse[_0x1423b0(0x1de)]([{'$match':{'name':_0x575825,'room':_0x1dcd2b}},{'$unwind':_0x1423b0(0x1d3)},{'$match':{'product_details.secondary_code':_0x19c9f2}},{'$group':{'_id':_0x1423b0(0x1e7),'name':{'$first':_0x1423b0(0x1cd)},'product_stock':{'$first':_0x1423b0(0x1f2)},'primary_code':{'$first':_0x1423b0(0x169)},'secondary_code':{'$first':_0x1423b0(0x1a0)},'product_code':{'$first':_0x1423b0(0x126)},'level':{'$first':_0x1423b0(0x1ea)},'isle':{'$first':_0x1423b0(0x140)},'type':{'$first':_0x1423b0(0xf2)},'pallet':{'$first':_0x1423b0(0x1c9)},'unit':{'$first':_0x1423b0(0x1e4)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1423b0(0x19c)},'rack':{'$first':_0x1423b0(0xff)},'expiry_date':{'$first':_0x1423b0(0x1a9)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x1423b0(0x194)},'batch_code':{'$first':_0x1423b0(0xd4)},'product_cat':{'$first':_0x1423b0(0x1d8)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1423b0(0x16e)}}}]);if(_0x23779d[_0x1423b0(0x1a6)]>0x0)_0x13d4a5['push'](_0x23779d);else _0x30da4e[_0x1423b0(0x1a6)]>0x0&&_0x13d4a5[_0x1423b0(0x12e)](_0x30da4e);}const _0x20e10c=_0x40321a[_0x189171(0x16a)](_0x3322d5=>_0x487746(_0x3322d5));await Promise[_0x189171(0xdd)](_0x20e10c),_0x3aa822[_0x189171(0x130)](_0x13d4a5);}),module[a0_0x38ef5e(0xd5)]=router;