var a0_0x39e489=a0_0x1c93;(function(_0x8f1163,_0x5c011c){var _0x2649da=a0_0x1c93,_0x10d55a=_0x8f1163();while(!![]){try{var _0x2be123=parseInt(_0x2649da(0x1b7))/0x1+-parseInt(_0x2649da(0x1d7))/0x2+-parseInt(_0x2649da(0x164))/0x3*(-parseInt(_0x2649da(0x10d))/0x4)+-parseInt(_0x2649da(0x14e))/0x5+-parseInt(_0x2649da(0x182))/0x6+-parseInt(_0x2649da(0x210))/0x7*(parseInt(_0x2649da(0x15a))/0x8)+parseInt(_0x2649da(0x1dd))/0x9*(parseInt(_0x2649da(0x209))/0xa);if(_0x2be123===_0x5c011c)break;else _0x10d55a['push'](_0x10d55a['shift']());}catch(_0xc371b4){_0x10d55a['push'](_0x10d55a['shift']());}}}(a0_0x3f95,0xdae9f));function a0_0x3f95(){var _0x40c367=['maxPerUnit_QA','language','floor','secondary_code_QA','5625420JAmCpr','<div>','Error\x20Occurs','success','gmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','primary_code_QA','Enclosed','primary_code','quantity','getDate','stock_data','errors','$product_details.product_name','currency_placement','OUTF-','site_title','room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','RoomAssigned','Enabled','$product_details.secondary_code','$product_details.production_date','customer_data','QA\x20Warehouse','split','/all_sales_finished/view','Sale','room_name','An\x20error\x20occurred\x20while\x20saving\x20data.','return_qty_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','\x20</h2>','status','$date','/../public','back','edit_sales_finished','/invoice/:id','unit','max','$finalize','push','get','$product_details.maxPerUnit','return_qty','for_categorize','date','secondary_unit_QA','product_list','email','name','/view/return_sales/:id','1434734JWCcNE','Sales\x20Mail','image','Portuguese\x20(BR)','<h2>\x20','add_sales_finished','$product_details.floorlevel','getMonth','product_stock','post','product_name_QA1','maxPerUnit','sales\x20item\x20return\x20successfull','sale_qty','/view','</td>','$sale_product','concat','$product_details.batch_code','barcode\x20Product\x20master','Email\x20sent\x20successfully','Ambient','length','</div>','\x20Order\x20Date\x20:\x20','json','French','master','<h5>','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','../public/language/languages.json','123484LInVQt','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','host','carton','/view/add_sales','16173IptZEN','$sale_product.floorlevel','</body></html>','forEach','payment\x20successfull','redirect','render','../middleware/auth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$invoice','max_per_unit','$_id','invoice','$product_details.invoice','customers_docs','Hindi','<strong>\x20Regards\x20</strong>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','exports','maxProducts_QA','$sale_product.bin','map','received_amount','Return\x20Rooms','product_code_QA','<html><head><title></title>','Sale\x20Return','Router','getFullYear','$customer','$product.product_name','message','maxperunit','aggregate','$product_details','<hr\x20class=\x22my-3\x22>','stock','$room','find','/barcode/:id','Received\x20Payment\x20For\x20Sale','all','<h5\x20style=\x22text-align:\x20left;\x22>','customer','930kODnMJ','then','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','warehouse','catch','</tr>','maxProducts','112QLyPnO','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','currency','/preview/:id','English','$product_details.product_cat','/view/add_sale/product','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','\x20Order\x20Number\x20:\x20','/give_payment/:id','$product_details.primary_code','Portuguese','finalize','port','/barcode_scanner','params','primary_unit','logo','Quality\x20Inspection','batch_code','$warehouse_name','67544rbSRXX','</tbody>','product_date','$product_details.bay','flash','sale_product','Arabic','$product_details.type','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','German','</h5>','product_details','findById','$product','$sale_product.bay','suppliers','return_sale_QA','product_code','$sale_product.type','$product_details.rack','</head><body>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','all_sales_barcode','id_transaction_from','warehouse_name','level','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$return_data','</thead>','return_data','sales_quantity_QA','amount','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','stocks_QA','role','customers','Finished\x20Goods','product_name','prod_code','True','secondary_code','/upload/','abs','Sales\x20Update\x20successfully','$note','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','return_sale','bay','Chinese','user','nodemailer','sales_quantity','$product_details.storage','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Arabic\x20(ae)','staff','$name','expiry_date_QA','createTransport','$customers_docs','secondary_unit','/view/:id','5658130yyUUZi','$product_details._id','<tr>','body','prod_cat','Logo.png','Sale\x20Return\x20Mail','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.product_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','adjust_qty','toString','156752YtelHY','\x20&&\x20','barcode\x20user_id','</span>','return_sale_finished','production_date_QA','</table>','<span\x20style=\x22float:\x20right;\x22>','<!DOCTYPE\x20html>','error','309VRknBn','<table\x20style=\x22width:\x20100%\x20!important;\x22>','False','random','expiry_date','_id','$product_details.secondary_unit','$product_details.unit','padStart','batch_code_QA','Spanish','unit_QA','save','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','sendMail','\x20==\x20','\x20<>\x20','$product_details.bin','findOne','log','$product_details.expiry_date','$product_details.maxProducts','$product_details.room_name','slice','English\x20(US)','$product_details.product_stock'];a0_0x3f95=function(){return _0x40c367;};return a0_0x3f95();}function a0_0x1c93(_0x310fe6,_0x131ea7){var _0x3f95d4=a0_0x3f95();return a0_0x1c93=function(_0x1c933d,_0x4ddf8a){_0x1c933d=_0x1c933d-0x102;var _0x36434e=_0x3f95d4[_0x1c933d];return _0x36434e;},a0_0x1c93(_0x310fe6,_0x131ea7);}const express=require('express'),app=express(),router=express[a0_0x39e489(0x1f8)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x39e489(0x1e4)),nodemailer=require(a0_0x39e489(0x141)),users=require(a0_0x39e489(0x1d6));router[a0_0x39e489(0x1ad)](a0_0x39e489(0x1c5),auth,async(_0x5dbfc4,_0x30169b)=>{var _0x395608=a0_0x39e489;try{const {username:_0x2eb749,email:_0x25a9fc,role:_0x519510}=_0x5dbfc4[_0x395608(0x140)],_0x15915f=_0x5dbfc4[_0x395608(0x140)],_0x4ede73=await profile[_0x395608(0x176)]({'email':_0x15915f[_0x395608(0x1b4)]}),_0x3dcda7=await master_shop[_0x395608(0x203)]();let _0x353b5e;if(_0x15915f[_0x395608(0x130)]==_0x395608(0x147)){const _0x5717e0=await staff[_0x395608(0x176)]({'email':_0x15915f[_0x395608(0x1b4)]});_0x353b5e=await sales_finished[_0x395608(0x1fe)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x395608(0x1b5),'as':'customers_docs'}},{'$unwind':_0x395608(0x14b)},{'$unwind':_0x395608(0x1c7)},{'$group':{'_id':_0x395608(0x1e8),'invoice':{'$first':_0x395608(0x1e6)},'customers':{'$first':_0x395608(0x1fa)},'date':{'$first':_0x395608(0x1a4)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x395608(0x1c7)},'note':{'$first':_0x395608(0x13a)},'return_data':{'$first':_0x395608(0x129)},'customers_docs':{'$first':_0x395608(0x14b)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x395608(0x1f1)},'type':{'$addToSet':_0x395608(0x120)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x395608(0x1ab)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x353b5e=await sales_finished[_0x395608(0x1fe)]([{'$lookup':{'from':_0x395608(0x131),'localField':_0x395608(0x208),'foreignField':'name','as':_0x395608(0x1eb)}},{'$unwind':_0x395608(0x14b)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x395608(0x1e8),'invoice':{'$first':_0x395608(0x1e6)},'customers':{'$first':_0x395608(0x1fa)},'date':{'$first':_0x395608(0x1a4)},'warehouse_name':{'$first':_0x395608(0x10c)},'sale_product':{'$push':_0x395608(0x1c7)},'note':{'$first':_0x395608(0x13a)},'return_data':{'$first':_0x395608(0x129)},'customers_docs':{'$first':_0x395608(0x14b)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x395608(0x11c)},'isle':{'$addToSet':_0x395608(0x1f1)},'type':{'$addToSet':_0x395608(0x120)},'pallet':{'$addToSet':_0x395608(0x1de)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x3dcda7[0x0]['language']==_0x395608(0x17c)){var _0x12787f=users[_0x395608(0x214)];console[_0x395608(0x177)](_0x12787f);}else{if(_0x3dcda7[0x0][_0x395608(0x17f)]=='Hindi')var _0x12787f=users[_0x395608(0x1ec)];else{if(_0x3dcda7[0x0][_0x395608(0x17f)]==_0x395608(0x117))var _0x12787f=users[_0x395608(0x117)];else{if(_0x3dcda7[0x0][_0x395608(0x17f)]==_0x395608(0x16e))var _0x12787f=users['Spanish'];else{if(_0x3dcda7[0x0][_0x395608(0x17f)]==_0x395608(0x1d1))var _0x12787f=users['French'];else{if(_0x3dcda7[0x0][_0x395608(0x17f)]==_0x395608(0x1ba))var _0x12787f=users[_0x395608(0x103)];else{if(_0x3dcda7[0x0][_0x395608(0x17f)]==_0x395608(0x13f))var _0x12787f=users[_0x395608(0x13f)];else{if(_0x3dcda7[0x0][_0x395608(0x17f)]==_0x395608(0x146))var _0x12787f=users['Arabic'];}}}}}}}_0x30169b[_0x395608(0x1e3)]('all_sales_finished',{'success':_0x5dbfc4[_0x395608(0x111)](_0x395608(0x185)),'errors':_0x5dbfc4[_0x395608(0x111)](_0x395608(0x18e)),'sales':_0x353b5e,'profile':_0x4ede73,'role':_0x15915f,'master_shop':_0x3dcda7,'language':_0x12787f});}catch(_0x1627a7){console[_0x395608(0x177)](_0x1627a7);}});async function getRandom8DigitNumber(){var _0x3d067a=a0_0x39e489;const _0x35246d=0x989680,_0x387f36=0x5f5e0ff,_0x497acf=Math[_0x3d067a(0x180)](Math[_0x3d067a(0x167)]()*(_0x387f36-_0x35246d+0x1))+_0x35246d;var _0x337ec5;const _0x152719=await sales_finished[_0x3d067a(0x176)]({'invoice':_0x3d067a(0x191)+_0x497acf});return _0x152719&&_0x152719['length']>0x0?_0x337ec5='OUTF-'+_0x497acf:_0x337ec5='OUTF-'+_0x497acf,_0x337ec5;}router[a0_0x39e489(0x1ad)]('/view/add_sales',auth,async(_0x160c34,_0x17f728)=>{var _0x3d7c5f=a0_0x39e489;try{const {username:_0xfb0595,email:_0x239c00,role:_0x148b61}=_0x160c34['user'],_0x3ecff0=_0x160c34['user'],_0x518da6=await profile[_0x3d7c5f(0x176)]({'email':_0x3ecff0[_0x3d7c5f(0x1b4)]}),_0x11278e=await master_shop[_0x3d7c5f(0x203)](),_0xd1d431=await customer[_0x3d7c5f(0x203)]({});let _0x362167;if(_0x3ecff0[_0x3d7c5f(0x130)]==_0x3d7c5f(0x147)){const _0x13546c=await staff[_0x3d7c5f(0x176)]({'email':_0x3ecff0['email']});_0x362167=await warehouse['aggregate']([{'$match':{'status':_0x3d7c5f(0x196),'name':_0x13546c[_0x3d7c5f(0x20c)],'warehouse_category':_0x3d7c5f(0x132),'name':{'$ne':_0x3d7c5f(0x19a)}}},{'$group':{'_id':_0x3d7c5f(0x148),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x362167=await warehouse[_0x3d7c5f(0x1fe)]([{'$match':{'status':'Enabled','warehouse_category':_0x3d7c5f(0x132),'name':{'$ne':_0x3d7c5f(0x19a)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x2fa56d=await product[_0x3d7c5f(0x203)]({});var _0x405833=[_0x3d7c5f(0x1cc),_0x3d7c5f(0x189)];const _0x5e4e08=await sales_finished[_0x3d7c5f(0x203)]({}),_0x4b3641=_0x5e4e08['length']+0x1,_0xe5bfd3='OUTF-'+_0x4b3641[_0x3d7c5f(0x159)]()[_0x3d7c5f(0x16c)](0x5,'0');if(_0x11278e[0x0][_0x3d7c5f(0x17f)]==_0x3d7c5f(0x17c)){var _0x7998d4=users[_0x3d7c5f(0x214)];console[_0x3d7c5f(0x177)](_0x7998d4);}else{if(_0x11278e[0x0]['language']==_0x3d7c5f(0x1ec))var _0x7998d4=users[_0x3d7c5f(0x1ec)];else{if(_0x11278e[0x0][_0x3d7c5f(0x17f)]=='German')var _0x7998d4=users[_0x3d7c5f(0x117)];else{if(_0x11278e[0x0][_0x3d7c5f(0x17f)]==_0x3d7c5f(0x16e))var _0x7998d4=users[_0x3d7c5f(0x16e)];else{if(_0x11278e[0x0][_0x3d7c5f(0x17f)]==_0x3d7c5f(0x1d1))var _0x7998d4=users[_0x3d7c5f(0x1d1)];else{if(_0x11278e[0x0][_0x3d7c5f(0x17f)]==_0x3d7c5f(0x1ba))var _0x7998d4=users['Portuguese'];else{if(_0x11278e[0x0]['language']=='Chinese')var _0x7998d4=users[_0x3d7c5f(0x13f)];else{if(_0x11278e[0x0][_0x3d7c5f(0x17f)]=='Arabic\x20(ae)')var _0x7998d4=users[_0x3d7c5f(0x113)];}}}}}}}const _0x4ceba5=getRandom8DigitNumber();_0x4ceba5['then'](_0x579194=>{var _0x3acf25=_0x3d7c5f;_0x17f728['render'](_0x3acf25(0x1bc),{'success':_0x160c34[_0x3acf25(0x111)](_0x3acf25(0x185)),'errors':_0x160c34[_0x3acf25(0x111)](_0x3acf25(0x18e)),'role':_0x3ecff0,'profile':_0x518da6,'customer':_0xd1d431,'warehouse':_0x362167,'product':_0x2fa56d,'invoice':_0x579194,'master_shop':_0x11278e,'language':_0x7998d4,'rooms_data':_0x405833});})[_0x3d7c5f(0x20d)](_0x5ee7ae=>{var _0x2a395a=_0x3d7c5f;_0x160c34['flash']('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x17f728[_0x2a395a(0x1e2)](_0x2a395a(0x19c));});}catch(_0x2b9136){console['log'](_0x2b9136);}}),router[a0_0x39e489(0x1ad)]('/view/add_sales/:id',auth,async(_0x5a14ca,_0x900148)=>{var _0x10298d=a0_0x39e489;try{const _0x21f180=_0x5a14ca[_0x10298d(0x107)]['id'];console[_0x10298d(0x177)](_0x21f180);const _0x5db0ac=await product['find'](),_0x475d87=await purchases[_0x10298d(0x1fe)]([{'$match':{'warehouse_name':_0x21f180}},{'$unwind':_0x10298d(0x11b)},{'$group':{'_id':_0x10298d(0x1fb)}}]);console[_0x10298d(0x177)]('purchases_data',_0x475d87),_0x900148[_0x10298d(0x1a3)](0xc8)[_0x10298d(0x1d0)]({'purchases_data':_0x475d87,'product_data':_0x5db0ac});}catch(_0x52f2c5){console[_0x10298d(0x177)](_0x52f2c5);}}),router[a0_0x39e489(0x1c0)](a0_0x39e489(0x216),auth,async(_0x56d434,_0x261063)=>{var _0x5e765d=a0_0x39e489;try{const {warehouse_data:_0x35fc76,product_data:_0x54915f}=_0x56d434['body'];console[_0x5e765d(0x177)](_0x56d434[_0x5e765d(0x151)]['product_data']);;const _0x4cb9e1=await master_shop[_0x5e765d(0x203)]();console['log'](_0x5e765d(0x1d2),_0x4cb9e1);const _0x253eb7=await product[_0x5e765d(0x176)]({'name':_0x54915f});console[_0x5e765d(0x177)](_0x5e765d(0x1d4),_0x253eb7);const _0x374eb4=await warehouse[_0x5e765d(0x1fe)]([{'$match':{'name':_0x35fc76}},{'$unwind':_0x5e765d(0x1ff)},{'$match':{'product_details.product_name':_0x54915f}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x5e765d(0x17d)}}}]);console[_0x5e765d(0x177)](_0x5e765d(0x18d),_0x374eb4),_0x261063[_0x5e765d(0x1a3)](0xc8)[_0x5e765d(0x1d0)]({'master':_0x4cb9e1,'new_product':_0x253eb7,'stock_data':_0x374eb4});}catch(_0x1455c2){console[_0x5e765d(0x177)](_0x1455c2);}}),router[a0_0x39e489(0x1c0)](a0_0x39e489(0x1dc),auth,async(_0x2d18f3,_0x49dc0d)=>{var _0x142fd6=a0_0x39e489;try{const {invoice:_0x3c76c2,date:_0x3e236d,warehouse_name:_0x27bb0b,product_name:_0x4dc893,stock:_0x201759,quantity:_0x2d6d62,note:_0x38ed56,room:_0x5aedc2,primary_code:_0x4e6f8e,secondary_code:_0x4715ee,prod_code:_0x3b90af,level:_0x11e91e,isle:_0x3c438c,pallet:_0x4e7121,batch_code:_0x3a970d,SCRN:_0x1567af,expiry_date:_0xf0bfa3,mode_transpo:_0x32030d,name_driver:_0x1511f2}=_0x2d18f3['body'];if(typeof _0x4dc893=='string')var _0x205711=[_0x2d18f3['body'][_0x142fd6(0x133)]],_0x2cd005=[_0x2d18f3[_0x142fd6(0x151)]['stock']],_0x3ecc58=[_0x2d18f3['body'][_0x142fd6(0x1db)]],_0x2b687a=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x18a)]],_0x5d746a=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x136)]],_0xf65d96=[_0x2d18f3['body']['prod_code']],_0x195392=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x127)]],_0x2a9d5b=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x108)]],_0x18cc5b=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x14c)]],_0xaab4f4=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x10b)]],_0x54fd5b=[_0x2d18f3[_0x142fd6(0x151)]['expiry_date']],_0x3f0369=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x10f)]],_0x336dc0=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x1e7)]],_0x17a033=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x152)]],_0x501ab9=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x195)]],_0x15f075=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x144)]],_0x543357=[_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x125)]];else var _0x205711=[..._0x2d18f3['body']['product_name']],_0x2cd005=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x201)]],_0x3ecc58=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x1db)]],_0x2b687a=[..._0x2d18f3[_0x142fd6(0x151)]['primary_code']],_0x5d746a=[..._0x2d18f3[_0x142fd6(0x151)]['secondary_code']],_0xf65d96=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x134)]],_0x195392=[..._0x2d18f3[_0x142fd6(0x151)]['level']],_0x2a9d5b=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x108)]],_0x18cc5b=[..._0x2d18f3[_0x142fd6(0x151)]['secondary_unit']],_0xaab4f4=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x10b)]],_0x54fd5b=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x168)]],_0x3f0369=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x10f)]],_0x336dc0=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x1e7)]],_0x17a033=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x152)]],_0x501ab9=[..._0x2d18f3['body'][_0x142fd6(0x195)]],_0x15f075=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x144)]],_0x543357=[..._0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x125)]];const _0x200224=_0x205711[_0x142fd6(0x1f2)](_0x2c7195=>{return _0x2c7195={'product_name':_0x2c7195};});_0x2cd005[_0x142fd6(0x1e0)]((_0x131af5,_0xc1e958)=>{var _0x42d91f=_0x142fd6;_0x200224[_0xc1e958][_0x42d91f(0x201)]=_0x131af5;}),_0x3ecc58[_0x142fd6(0x1e0)]((_0x40b062,_0xc7ef4d)=>{var _0x314828=_0x142fd6;_0x200224[_0xc7ef4d]['quantity']=Math[_0x314828(0x138)](_0x40b062);}),_0x543357[_0x142fd6(0x1e0)]((_0x3b9a96,_0x29b162)=>{_0x200224[_0x29b162]['id_transaction_from']=_0x3b9a96;}),_0x2b687a['forEach']((_0x404267,_0x43c28a)=>{var _0x180c01=_0x142fd6;_0x200224[_0x43c28a][_0x180c01(0x18a)]=_0x404267;}),_0x5d746a['forEach']((_0x1c1858,_0x3c05c3)=>{_0x200224[_0x3c05c3]['secondary_code']=_0x1c1858;}),_0xf65d96[_0x142fd6(0x1e0)]((_0x17f0ff,_0x41a19a)=>{var _0x5e6eb1=_0x142fd6;_0x200224[_0x41a19a][_0x5e6eb1(0x11f)]=_0x17f0ff;}),_0x195392[_0x142fd6(0x1e0)]((_0x29d380,_0x587221)=>{var _0x6e59f8=_0x142fd6;_0x200224[_0x587221][_0x6e59f8(0x13e)]=_0x29d380;}),_0x2a9d5b['forEach']((_0x4affaa,_0x5b728f)=>{_0x200224[_0x5b728f]['unit']=_0x4affaa;}),_0x18cc5b[_0x142fd6(0x1e0)]((_0x54a6ba,_0x2d37d5)=>{var _0x1ef025=_0x142fd6;_0x200224[_0x2d37d5][_0x1ef025(0x14c)]=_0x54a6ba;}),_0xaab4f4[_0x142fd6(0x1e0)]((_0x577f4,_0x3cd4e7)=>{_0x200224[_0x3cd4e7]['batch_code']=_0x577f4;}),_0x54fd5b['forEach']((_0xc70540,_0x1eb315)=>{var _0x30ce40=_0x142fd6;_0x200224[_0x1eb315][_0x30ce40(0x168)]=_0xc70540;}),_0x3f0369[_0x142fd6(0x1e0)]((_0x151264,_0x8e6960)=>{var _0x1bf403=_0x142fd6;_0x200224[_0x8e6960][_0x1bf403(0x217)]=_0x151264;}),_0x336dc0[_0x142fd6(0x1e0)]((_0x46cb8a,_0xf4c814)=>{var _0x558bdc=_0x142fd6;_0x200224[_0xf4c814][_0x558bdc(0x1fd)]=_0x46cb8a;}),_0x17a033[_0x142fd6(0x1e0)]((_0x5884df,_0x335b31)=>{var _0x2f8e99=_0x142fd6;_0x200224[_0x335b31][_0x2f8e99(0x152)]=_0x5884df;}),_0x501ab9[_0x142fd6(0x1e0)]((_0x478043,_0x3fe815)=>{var _0x2e0bb1=_0x142fd6;_0x200224[_0x3fe815][_0x2e0bb1(0x19e)]=_0x478043;}),_0x15f075[_0x142fd6(0x1e0)]((_0x4e1926,_0x2d1b3d)=>{var _0x1931f6=_0x142fd6;_0x200224[_0x2d1b3d][_0x1931f6(0x1e9)]=_0x4e1926;});var _0x293acf=0x0;_0x200224['forEach'](_0x4cdc3a=>{var _0x194b4d=_0x142fd6;parseFloat(_0x4cdc3a[_0x194b4d(0x201)])<parseFloat(_0x4cdc3a[_0x194b4d(0x18b)])&&parseFloat(_0x4cdc3a[_0x194b4d(0x18b)])>parseFloat(_0x4cdc3a[_0x194b4d(0x201)])&&(console[_0x194b4d(0x177)](_0x4cdc3a[_0x194b4d(0x201)]+_0x194b4d(0x174)+_0x4cdc3a[_0x194b4d(0x18b)]),_0x293acf++);});if(_0x293acf!=0x0)return _0x2d18f3['flash'](_0x142fd6(0x18e),_0x142fd6(0x20b)),_0x49dc0d[_0x142fd6(0x1e2)](_0x142fd6(0x1a6));const _0x4127fd=_0x200224[_0x142fd6(0x13b)](_0x3a95f9=>_0x3a95f9['quantity']!=='0'&&_0x3a95f9[_0x142fd6(0x18b)]!==''),_0x50062f=new sales_finished({'invoice':_0x3c76c2,'customer':_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x208)],'date':_0x3e236d,'warehouse_name':_0x27bb0b,'sale_product':_0x4127fd,'note':_0x38ed56,'room':_0x5aedc2,'primary_code':_0x4e6f8e,'secondary_code':_0x4715ee,'prod_code':_0x3b90af,'SCRN':_0x1567af,'finalize':_0x142fd6(0x166),'mode_transpo':_0x32030d,'name_driver':_0x1511f2}),_0x4e336f=await _0x50062f['save'](),_0x46795f=await sales_finished[_0x142fd6(0x176)]({'invoice':_0x3c76c2}),_0x3ff51c=new c_payment_data({'invoice':_0x3c76c2,'customer':_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x208)],'reason':_0x142fd6(0x19d)});await _0x3ff51c[_0x142fd6(0x170)]();const _0x28298c=await master_shop[_0x142fd6(0x203)](),_0x45fd7e=await email_settings[_0x142fd6(0x176)](),_0x573d51=await customer[_0x142fd6(0x176)]({'name':_0x2d18f3[_0x142fd6(0x151)][_0x142fd6(0x208)]});_0x28298c[0x0][_0x142fd6(0x190)]==0x1?(right_currency=_0x28298c[0x0][_0x142fd6(0x212)],left_currency=''):(right_currency='',left_currency=_0x28298c[0x0][_0x142fd6(0x212)]);var _0x2e23de=_0x205711,_0x3e401e=_0x3ecc58,_0x1bd462='',_0xce9f5a;for(_0xce9f5a in _0x2e23de){_0x1bd462+='<tr>'+_0x142fd6(0x123)+_0x2e23de[_0xce9f5a]+'</td>'+_0x142fd6(0x123)+_0x3e401e[_0xce9f5a]+_0x142fd6(0x1c6)+'</tr>';}console[_0x142fd6(0x177)]('product_list',_0x1bd462);let _0x3cf258=nodemailer['createTransport']({'service':_0x142fd6(0x186),'auth':{'user':_0x45fd7e[_0x142fd6(0x1b4)],'pass':_0x45fd7e[_0x142fd6(0x1d8)]}}),_0x422ae4={'from':_0x45fd7e[_0x142fd6(0x1b4)],'to':_0x573d51['email'],'subject':'Sale\x20Product\x20Mail','attachments':[{'filename':_0x142fd6(0x153),'path':__dirname+_0x142fd6(0x1a5)+_0x142fd6(0x137)+_0x28298c[0x0][_0x142fd6(0x1b9)],'cid':_0x142fd6(0x109)}],'html':_0x142fd6(0x162)+_0x142fd6(0x1f6)+_0x142fd6(0x122)+_0x142fd6(0x183)+_0x142fd6(0x12e)+_0x142fd6(0x183)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x142fd6(0x1ce)+_0x142fd6(0x183)+_0x142fd6(0x1bb)+_0x28298c[0x0][_0x142fd6(0x192)]+'\x20</h2>'+_0x142fd6(0x1ce)+_0x142fd6(0x1ce)+_0x142fd6(0x200)+_0x142fd6(0x183)+_0x142fd6(0x207)+_0x142fd6(0x219)+_0x3c76c2+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x142fd6(0x1cf)+_0x3e236d+'\x20'+_0x142fd6(0x15d)+_0x142fd6(0x118)+'</div>'+_0x142fd6(0x165)+_0x142fd6(0x1ee)+_0x142fd6(0x150)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x142fd6(0x218)+_0x142fd6(0x20e)+_0x142fd6(0x12a)+_0x142fd6(0x155)+'\x20'+_0x1bd462+'\x20'+'</tbody>'+_0x142fd6(0x160)+_0x142fd6(0x183)+'<strong>\x20Regards\x20</strong>'+_0x142fd6(0x1d3)+_0x28298c[0x0][_0x142fd6(0x192)]+_0x142fd6(0x118)+'</div>'+_0x142fd6(0x1ce)+'</body></html>'};_0x3cf258[_0x142fd6(0x172)](_0x422ae4,function(_0x2d2b68,_0x16e8ce){var _0x5d7107=_0x142fd6;_0x2d2b68?(console[_0x5d7107(0x177)](_0x2d2b68),console[_0x5d7107(0x177)](_0x5d7107(0x184))):console[_0x5d7107(0x177)](_0x5d7107(0x1cb));}),_0x2d18f3[_0x142fd6(0x111)]('success','Sales\x20Add\x20successfully'),_0x49dc0d['redirect']('/all_sales_finished/preview/'+_0x4e336f[_0x142fd6(0x169)]);}catch(_0x597a64){console[_0x142fd6(0x177)](_0x597a64);}}),router[a0_0x39e489(0x1ad)](a0_0x39e489(0x213),auth,async(_0x10863f,_0x20da5d)=>{var _0x1f39aa=a0_0x39e489;try{const {username:_0x2e2ca8,email:_0x3999c4,role:_0x32fabd}=_0x10863f[_0x1f39aa(0x140)],_0x524f19=_0x10863f[_0x1f39aa(0x140)],_0x48a013=await profile[_0x1f39aa(0x176)]({'email':_0x524f19['email']}),_0x294486=await master_shop[_0x1f39aa(0x203)](),_0x3139ef=_0x10863f[_0x1f39aa(0x107)]['id'],_0x1ad4fc=await sales_finished['findById'](_0x3139ef),_0x599884=await warehouse['aggregate']([{'$match':{'name':_0x1ad4fc[_0x1f39aa(0x126)]}},{'$unwind':_0x1f39aa(0x1ff)},{'$group':{'_id':_0x1f39aa(0x14f),'name':{'$first':_0x1f39aa(0x18f)},'product_stock':{'$first':_0x1f39aa(0x17d)},'bay':{'$first':_0x1f39aa(0x110)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1f39aa(0x114)},'floorlevel':{'$first':_0x1f39aa(0x1bd)},'primary_code':{'$first':_0x1f39aa(0x102)},'secondary_code':{'$first':_0x1f39aa(0x197)},'product_code':{'$first':_0x1f39aa(0x156)},'storage':{'$first':_0x1f39aa(0x143)},'rack':{'$first':_0x1f39aa(0x121)},'expiry_date':{'$first':_0x1f39aa(0x178)},'production_date':{'$first':_0x1f39aa(0x198)},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':_0x1f39aa(0x202)},'room_data':{'$first':_0x1f39aa(0x17a)}}}]),_0x33dcdd=await customer[_0x1f39aa(0x203)]({});let _0x549f5d;if(_0x524f19[_0x1f39aa(0x130)]==_0x1f39aa(0x147)){const _0x294b82=await staff['findOne']({'email':_0x524f19['email']});_0x549f5d=await warehouse[_0x1f39aa(0x1fe)]([{'$match':{'status':_0x1f39aa(0x196),'name':_0x294b82[_0x1f39aa(0x20c)]}},{'$group':{'_id':'$name','name':{'$first':_0x1f39aa(0x148)}}}]);}else _0x549f5d=await warehouse[_0x1f39aa(0x1fe)]([{'$match':{'status':_0x1f39aa(0x196)}},{'$group':{'_id':'$name','name':{'$first':_0x1f39aa(0x148)}}}]);const _0x356173=await product[_0x1f39aa(0x203)]({});if(_0x294486[0x0][_0x1f39aa(0x17f)]=='English\x20(US)'){var _0x41b59e=users[_0x1f39aa(0x214)];console['log'](_0x41b59e);}else{if(_0x294486[0x0][_0x1f39aa(0x17f)]==_0x1f39aa(0x1ec))var _0x41b59e=users[_0x1f39aa(0x1ec)];else{if(_0x294486[0x0][_0x1f39aa(0x17f)]=='German')var _0x41b59e=users[_0x1f39aa(0x117)];else{if(_0x294486[0x0][_0x1f39aa(0x17f)]==_0x1f39aa(0x16e))var _0x41b59e=users[_0x1f39aa(0x16e)];else{if(_0x294486[0x0][_0x1f39aa(0x17f)]=='French')var _0x41b59e=users[_0x1f39aa(0x1d1)];else{if(_0x294486[0x0]['language']=='Portuguese\x20(BR)')var _0x41b59e=users[_0x1f39aa(0x103)];else{if(_0x294486[0x0]['language']=='Chinese')var _0x41b59e=users[_0x1f39aa(0x13f)];else{if(_0x294486[0x0][_0x1f39aa(0x17f)]==_0x1f39aa(0x146))var _0x41b59e=users['Arabic'];}}}}}}}_0x20da5d['render']('edit_sales_finished_view',{'success':_0x10863f[_0x1f39aa(0x111)]('success'),'errors':_0x10863f[_0x1f39aa(0x111)]('errors'),'role':_0x524f19,'profile':_0x48a013,'customer':_0x33dcdd,'warehouse':_0x549f5d,'product':_0x599884,'user':_0x1ad4fc,'master_shop':_0x294486,'unit':_0x356173,'language':_0x41b59e});}catch(_0x551f75){console[_0x1f39aa(0x177)](_0x551f75);}}),router[a0_0x39e489(0x1c0)](a0_0x39e489(0x213),auth,async(_0x1c0ae9,_0x38d289)=>{var _0x109654=a0_0x39e489;try{const _0x5e874f=_0x1c0ae9['params']['id'],{invoice:_0x3054b6,warehouse_name:_0xf6ab89,room:_0x3fe64d}=_0x1c0ae9[_0x109654(0x151)],_0x29de6c=await sales_finished[_0x109654(0x176)]({'invoice':_0x3054b6}),_0x463fd7=_0x29de6c[_0x109654(0x112)][_0x109654(0x1f2)](async _0x37f7d8=>{var _0x58a170=_0x109654,_0x479699=await warehouse[_0x58a170(0x176)]({'name':_0xf6ab89,'room':_0x37f7d8[_0x58a170(0x19e)],'warehouse_category':_0x58a170(0x132)});const _0x2ce346=_0x479699[_0x58a170(0x119)][_0x58a170(0x1f2)](_0x20264d=>{var _0x5ce402=_0x58a170;(_0x20264d['product_name']==_0x37f7d8[_0x5ce402(0x133)]&&_0x20264d['bay']==_0x37f7d8[_0x5ce402(0x13e)]&&_0x20264d[_0x5ce402(0x168)]==_0x37f7d8[_0x5ce402(0x168)]&&_0x20264d[_0x5ce402(0x217)]==_0x37f7d8[_0x5ce402(0x217)]&&_0x20264d[_0x5ce402(0x10b)]==_0x37f7d8[_0x5ce402(0x10b)]&&_0x20264d[_0x5ce402(0x1e9)]==_0x37f7d8[_0x5ce402(0x1e9)]||_0x20264d[_0x5ce402(0x169)]==_0x37f7d8[_0x5ce402(0x125)])&&(_0x20264d['product_stock']>0x0&&(console[_0x5ce402(0x177)](_0x20264d[_0x5ce402(0x133)]+_0x5ce402(0x173)+_0x37f7d8[_0x5ce402(0x133)]+_0x5ce402(0x15b)+_0x20264d['bay']+_0x5ce402(0x173)+_0x37f7d8['bay']+_0x5ce402(0x15b)+_0x20264d[_0x5ce402(0x217)]+'\x20==\x20'+_0x37f7d8[_0x5ce402(0x217)]+_0x5ce402(0x15b)+_0x20264d[_0x5ce402(0x168)]+_0x5ce402(0x173)+_0x37f7d8[_0x5ce402(0x168)]+'\x20&&\x20'+_0x20264d[_0x5ce402(0x10b)]+_0x5ce402(0x173)+_0x37f7d8['batch_code']+_0x5ce402(0x15b)+_0x20264d[_0x5ce402(0x1e9)]+'\x20==\x20'+_0x37f7d8[_0x5ce402(0x1e9)]+_0x5ce402(0x15b)+_0x20264d[_0x5ce402(0x1bf)]+'\x20<<<==>>>\x20'+_0x37f7d8[_0x5ce402(0x18b)]+'\x20>>>\x20'+_0x37f7d8[_0x5ce402(0x19e)]+_0x5ce402(0x15b)+_0x20264d[_0x5ce402(0x169)]+_0x5ce402(0x173)+_0x37f7d8[_0x5ce402(0x125)]),_0x20264d['product_stock']=Math[_0x5ce402(0x1aa)](0x0,Math[_0x5ce402(0x138)](_0x20264d[_0x5ce402(0x1bf)])-Math['abs'](_0x37f7d8[_0x5ce402(0x18b)]))));});return _0x479699;});Promise[_0x109654(0x206)](_0x463fd7)[_0x109654(0x20a)](async _0x40ac7d=>{var _0x25acef=_0x109654;try{for(const _0xbdf763 of _0x40ac7d){await _0xbdf763[_0x25acef(0x170)]();}_0x29de6c[_0x25acef(0x104)]=_0x25acef(0x135);const _0x303180=await _0x29de6c['save'](),_0x4e9502=await master_shop[_0x25acef(0x203)](),_0x1332f6=await email_settings[_0x25acef(0x176)](),_0x3ee406=await supervisor_settings[_0x25acef(0x203)]();var _0x3361ae=_0x29de6c[_0x25acef(0x112)],_0x59ced2='',_0x2837e6;for(_0x2837e6 in _0x3361ae){var _0x2c1e46='FG';_0x29de6c['warehouse_name']=='DRY\x20GOODS'&&(_0x2c1e46='DG'),_0x59ced2+=_0x25acef(0x150)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3361ae[_0x2837e6]['product_name']+_0x25acef(0x1c6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3361ae[_0x2837e6][_0x25acef(0x11f)]+'</td>'+_0x25acef(0x123)+_0x3361ae[_0x2837e6]['quantity']+'</td>'+_0x25acef(0x123)+_0x3361ae[_0x2837e6]['unit']+_0x25acef(0x1c6)+_0x25acef(0x123)+_0x3361ae[_0x2837e6]['secondary_unit']+_0x25acef(0x1c6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x29de6c[_0x25acef(0x126)]+'</td>'+_0x25acef(0x123)+_0x3361ae[_0x2837e6][_0x25acef(0x19e)]+_0x25acef(0x1c6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2c1e46+_0x3361ae[_0x2837e6][_0x25acef(0x13e)]+_0x25acef(0x1c6);}let _0x224419=nodemailer[_0x25acef(0x14a)]({'host':_0x1332f6[_0x25acef(0x1da)],'port':Number(_0x1332f6[_0x25acef(0x105)]),'secure':![],'auth':{'user':_0x1332f6['email'],'pass':_0x1332f6[_0x25acef(0x1d8)]}}),_0xbd33d2={'from':_0x1332f6[_0x25acef(0x1b4)],'to':_0x3ee406[0x0]['FGSEmail'],'subject':_0x25acef(0x1b8),'attachments':[{'filename':_0x25acef(0x153),'path':__dirname+_0x25acef(0x1a5)+_0x25acef(0x137)+_0x4e9502[0x0]['image'],'cid':_0x25acef(0x109)}],'html':'<!DOCTYPE\x20html>'+_0x25acef(0x1f6)+_0x25acef(0x122)+_0x25acef(0x183)+_0x25acef(0x12e)+_0x25acef(0x183)+_0x25acef(0x157)+_0x25acef(0x1ce)+_0x25acef(0x183)+_0x25acef(0x1bb)+_0x4e9502[0x0][_0x25acef(0x192)]+_0x25acef(0x1a2)+_0x25acef(0x1ce)+'</div>'+_0x25acef(0x200)+_0x25acef(0x183)+_0x25acef(0x207)+_0x25acef(0x219)+_0x29de6c[_0x25acef(0x1e9)]+'\x20'+_0x25acef(0x161)+_0x25acef(0x1cf)+_0x29de6c[_0x25acef(0x1b1)]+'\x20'+_0x25acef(0x15d)+_0x25acef(0x118)+'</div>'+_0x25acef(0x165)+_0x25acef(0x1ee)+_0x25acef(0x150)+_0x25acef(0x194)+_0x25acef(0x1e5)+_0x25acef(0x116)+_0x25acef(0x145)+_0x25acef(0x1d9)+_0x25acef(0x1d5)+_0x25acef(0x13c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x25acef(0x20e)+'</thead>'+_0x25acef(0x155)+'\x20'+_0x59ced2+'\x20'+_0x25acef(0x10e)+_0x25acef(0x160)+_0x25acef(0x183)+_0x25acef(0x1ed)+'<h5>'+_0x4e9502[0x0]['site_title']+'</h5>'+_0x25acef(0x1ce)+_0x25acef(0x1ce)+_0x25acef(0x1df)};_0x224419[_0x25acef(0x172)](_0xbd33d2,function(_0x279487,_0x4b0f78){var _0x321e42=_0x25acef;_0x279487?(console[_0x321e42(0x177)](_0x279487),console[_0x321e42(0x177)](_0x321e42(0x184))):console['log'](_0x321e42(0x1cb));}),_0x1c0ae9[_0x25acef(0x111)](_0x25acef(0x185),_0x25acef(0x139)),_0x38d289[_0x25acef(0x1e2)]('/picking_list/pdf/'+_0x5e874f);}catch(_0x2c3c79){console[_0x25acef(0x163)](_0x2c3c79),_0x38d289['status'](0x1f4)[_0x25acef(0x1d0)]({'error':_0x25acef(0x19f)});}})[_0x109654(0x20d)](_0x31f9a5=>{var _0x57472c=_0x109654;console[_0x57472c(0x163)](_0x31f9a5),_0x38d289['status'](0x1f4)[_0x57472c(0x1d0)]({'error':'An\x20error\x20occurred.'});});}catch(_0x43879b){console[_0x109654(0x177)](_0x43879b);}}),router[a0_0x39e489(0x1ad)](a0_0x39e489(0x14d),auth,async(_0x301aab,_0x1d8863)=>{var _0x3fde20=a0_0x39e489;try{const {username:_0xc3c63b,email:_0x43d47a,role:_0x357fed}=_0x301aab[_0x3fde20(0x140)],_0x237b1e=_0x301aab[_0x3fde20(0x140)],_0x7c0ec8=await profile[_0x3fde20(0x176)]({'email':_0x237b1e['email']}),_0x4f6958=await master_shop[_0x3fde20(0x203)](),_0x48c1f7=_0x301aab[_0x3fde20(0x107)]['id'],_0x373c0c=await sales_finished['findById'](_0x48c1f7);let _0x58fdec=new Date(_0x373c0c[_0x3fde20(0x168)]),_0x23eef0=('0'+_0x58fdec['getDate']())['slice'](-0x2),_0x2c3350=('0'+(_0x58fdec['getMonth']()+0x1))[_0x3fde20(0x17b)](-0x2),_0x584af5=_0x58fdec[_0x3fde20(0x1f9)](),_0x3bf3fc=_0x584af5+'-'+_0x2c3350+'-'+_0x23eef0;var _0x46153f=[_0x3fde20(0x1cc),_0x3fde20(0x189)];const _0x39ac37=await warehouse[_0x3fde20(0x1fe)]([{'$match':{'name':_0x373c0c['warehouse_name'],'room':_0x373c0c[_0x3fde20(0x193)]}},{'$unwind':_0x3fde20(0x1ff)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3fde20(0x18f)},'product_stock':{'$first':_0x3fde20(0x17d)},'bay':{'$first':_0x3fde20(0x110)},'bin':{'$first':_0x3fde20(0x175)},'type':{'$first':_0x3fde20(0x114)},'floorlevel':{'$first':_0x3fde20(0x1bd)},'primary_code':{'$first':_0x3fde20(0x102)},'secondary_code':{'$first':_0x3fde20(0x197)},'product_code':{'$first':_0x3fde20(0x156)},'storage':{'$first':_0x3fde20(0x143)},'rack':{'$first':_0x3fde20(0x121)}}}]),_0x258fdc=await customer['find']({});let _0x4f802f;if(_0x237b1e[_0x3fde20(0x130)]==_0x3fde20(0x147)){const _0x24dae9=await staff['findOne']({'email':_0x237b1e[_0x3fde20(0x1b4)]});_0x4f802f=await warehouse[_0x3fde20(0x1fe)]([{'$match':{'status':'Enabled','name':_0x24dae9[_0x3fde20(0x20c)]}},{'$group':{'_id':_0x3fde20(0x148),'name':{'$first':'$name'}}}]);}else _0x4f802f=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x3fde20(0x148)}}}]);const _0x131caa=await product['find']({});if(_0x4f6958[0x0][_0x3fde20(0x17f)]=='English\x20(US)'){var _0x5b2a1f=users['English'];console[_0x3fde20(0x177)](_0x5b2a1f);}else{if(_0x4f6958[0x0][_0x3fde20(0x17f)]==_0x3fde20(0x1ec))var _0x5b2a1f=users[_0x3fde20(0x1ec)];else{if(_0x4f6958[0x0][_0x3fde20(0x17f)]=='German')var _0x5b2a1f=users[_0x3fde20(0x117)];else{if(_0x4f6958[0x0][_0x3fde20(0x17f)]==_0x3fde20(0x16e))var _0x5b2a1f=users[_0x3fde20(0x16e)];else{if(_0x4f6958[0x0]['language']==_0x3fde20(0x1d1))var _0x5b2a1f=users[_0x3fde20(0x1d1)];else{if(_0x4f6958[0x0]['language']==_0x3fde20(0x1ba))var _0x5b2a1f=users[_0x3fde20(0x103)];else{if(_0x4f6958[0x0][_0x3fde20(0x17f)]==_0x3fde20(0x13f))var _0x5b2a1f=users[_0x3fde20(0x13f)];else{if(_0x4f6958[0x0]['language']=='Arabic\x20(ae)')var _0x5b2a1f=users[_0x3fde20(0x113)];}}}}}}}_0x1d8863[_0x3fde20(0x1e3)](_0x3fde20(0x1a7),{'success':_0x301aab[_0x3fde20(0x111)](_0x3fde20(0x185)),'errors':_0x301aab[_0x3fde20(0x111)](_0x3fde20(0x18e)),'role':_0x237b1e,'profile':_0x7c0ec8,'customer':_0x258fdc,'warehouse':_0x4f802f,'product':_0x39ac37,'user':_0x373c0c,'master_shop':_0x4f6958,'unit':_0x131caa,'language':_0x5b2a1f,'rooms_data':_0x46153f,'ed_fullDate':_0x3bf3fc});}catch(_0x433d5f){console['log'](_0x433d5f);}}),router[a0_0x39e489(0x1c0)]('/view/:id',auth,async(_0x225649,_0x181c0c)=>{var _0x46bf55=a0_0x39e489;try{const _0x2121b8=_0x225649[_0x46bf55(0x107)]['id'],_0x34de6d=await sales_finished[_0x46bf55(0x176)]({'_id':_0x225649[_0x46bf55(0x107)]['id']}),_0x326701=await warehouse[_0x46bf55(0x176)]({'name':_0x34de6d['warehouse_name'],'room':_0x225649[_0x46bf55(0x151)][_0x46bf55(0x193)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x10880d,customer:_0x41aeb4,date:_0x4ae374,warehouse_name:_0x47d56f,product_name:_0x3ea740,stock:_0x25f90f,adjust_qty:_0x4421a3,note:_0x59961c,room:_0x595e46,primary_code:_0xebfb8b,secondary_code:_0x18138e,prod_code:_0x6a45b6,level:_0x48e205,isle:_0xd14ede,pallet:_0x55d699,expiry_date:_0x484710}=_0x225649[_0x46bf55(0x151)];if(typeof _0x3ea740==_0x46bf55(0x115))var _0x1c8773=[_0x225649['body'][_0x46bf55(0x133)]],_0x28cde2=[_0x225649['body'][_0x46bf55(0x201)]],_0x57c8d3=[_0x225649[_0x46bf55(0x151)][_0x46bf55(0x158)]],_0x3da0fd=[_0x225649['body'][_0x46bf55(0x18a)]],_0x56eda8=[_0x225649[_0x46bf55(0x151)][_0x46bf55(0x136)]],_0x205519=[_0x225649[_0x46bf55(0x151)][_0x46bf55(0x134)]],_0xf8113=[_0x225649['body'][_0x46bf55(0x127)]],_0x172602=[_0x225649['body'][_0x46bf55(0x168)]];else var _0x1c8773=[..._0x225649[_0x46bf55(0x151)][_0x46bf55(0x133)]],_0x28cde2=[..._0x225649[_0x46bf55(0x151)]['stock']],_0x57c8d3=[..._0x225649[_0x46bf55(0x151)][_0x46bf55(0x158)]],_0x3da0fd=[..._0x225649['body']['primary_code']],_0x56eda8=[..._0x225649[_0x46bf55(0x151)]['secondary_code']],_0x205519=[..._0x225649['body']['prod_code']],_0xf8113=[..._0x225649['body'][_0x46bf55(0x127)]],_0x172602=[..._0x225649[_0x46bf55(0x151)][_0x46bf55(0x168)]];const _0xa9bfb0=_0x1c8773[_0x46bf55(0x1f2)](_0x14d465=>{return _0x14d465={'product_name':_0x14d465};});_0x28cde2[_0x46bf55(0x1e0)]((_0x4845dd,_0xa132df)=>{var _0x42e2dd=_0x46bf55;_0xa9bfb0[_0xa132df][_0x42e2dd(0x201)]=_0x4845dd;}),_0x57c8d3['forEach']((_0xe4fd52,_0x3c5a5f)=>{var _0x28e0fd=_0x46bf55;_0xa9bfb0[_0x3c5a5f][_0x28e0fd(0x18b)]=_0xe4fd52;}),_0x3da0fd['forEach']((_0x20e0f3,_0xc0d2f6)=>{_0xa9bfb0[_0xc0d2f6]['primary_code']=_0x20e0f3;}),_0x56eda8[_0x46bf55(0x1e0)]((_0x2d614f,_0x425753)=>{var _0x1b13be=_0x46bf55;_0xa9bfb0[_0x425753][_0x1b13be(0x136)]=_0x2d614f;}),_0x205519[_0x46bf55(0x1e0)]((_0x3ef6ff,_0x91ea4b)=>{_0xa9bfb0[_0x91ea4b]['product_code']=_0x3ef6ff;}),_0xf8113['forEach']((_0x26c2c5,_0x43a500)=>{_0xa9bfb0[_0x43a500]['level']=_0x26c2c5;}),_0x172602[_0x46bf55(0x1e0)]((_0x190ec8,_0x3a292b)=>{var _0x1176ea=_0x46bf55;_0xa9bfb0[_0x3a292b][_0x1176ea(0x168)]=_0x190ec8;});var _0x3895cf=0x0;_0xa9bfb0[_0x46bf55(0x1e0)](_0x635b23=>{var _0x129159=_0x46bf55;console['log']('foreach\x20newproduct',_0x635b23),(parseInt(_0x635b23[_0x129159(0x201)])<parseInt(_0x635b23[_0x129159(0x18b)])||parseInt(_0x635b23['quantity'])==0x0)&&_0x3895cf++;});if(_0x3895cf!=0x0)return _0x225649[_0x46bf55(0x111)](_0x46bf55(0x18e),_0x46bf55(0x128)),_0x181c0c[_0x46bf55(0x1e2)](_0x46bf55(0x1a6));_0x34de6d['sale_product']['forEach'](_0x40e6aa=>{var _0x47badd=_0x46bf55;const _0x2dd7d4=_0x326701['product_details'][_0x47badd(0x1f2)](_0x183cee=>{var _0x4c3c19=_0x47badd;_0x183cee[_0x4c3c19(0x133)]==_0x40e6aa[_0x4c3c19(0x133)]&&_0x183cee[_0x4c3c19(0x13e)]==_0x40e6aa[_0x4c3c19(0x13e)]&&(_0x183cee[_0x4c3c19(0x1bf)]=parseInt(_0x183cee[_0x4c3c19(0x1bf)])+parseInt(_0x40e6aa[_0x4c3c19(0x18b)]));});}),await _0x326701['save']();const _0x1d16a0=_0xa9bfb0[_0x46bf55(0x13b)](_0x51194a=>_0x51194a[_0x46bf55(0x18b)]!=='0'&&_0x51194a[_0x46bf55(0x18b)]!=='');_0x34de6d['invoice']=_0x10880d,_0x34de6d[_0x46bf55(0x208)]=_0x41aeb4,_0x34de6d[_0x46bf55(0x1b1)]=_0x4ae374,_0x34de6d[_0x46bf55(0x126)]=_0x47d56f,_0x34de6d[_0x46bf55(0x112)]=_0x1d16a0,_0x34de6d['note']=_0x59961c,_0x34de6d[_0x46bf55(0x193)]=_0x595e46;const _0x467cb2=await _0x34de6d[_0x46bf55(0x170)](),_0x5cd755=await sales_finished[_0x46bf55(0x176)]({'_id':_0x225649[_0x46bf55(0x107)]['id']}),_0x3a627b=await warehouse[_0x46bf55(0x176)]({'name':_0x47d56f,'room':_0x595e46,'warehouse_category':_0x46bf55(0x132)});_0x5cd755[_0x46bf55(0x112)][_0x46bf55(0x1e0)](_0x43c6ad=>{var _0x364b85=_0x46bf55;const _0xc709dc=_0x3a627b[_0x364b85(0x119)][_0x364b85(0x1f2)](_0x18cece=>{var _0x275e25=_0x364b85;_0x18cece['product_name']==_0x43c6ad[_0x275e25(0x133)]&&_0x18cece[_0x275e25(0x13e)]==_0x43c6ad[_0x275e25(0x13e)]&&(_0x18cece['product_stock']=parseInt(_0x18cece[_0x275e25(0x1bf)])-parseInt(_0x43c6ad[_0x275e25(0x18b)]));});}),console[_0x46bf55(0x177)]('final',_0x3a627b),await _0x3a627b[_0x46bf55(0x170)]();const _0x4c7f44=await c_payment_data[_0x46bf55(0x176)]({'invoice':_0x225649[_0x46bf55(0x151)][_0x46bf55(0x1e9)]});_0x4c7f44[_0x46bf55(0x11d)]=_0x225649[_0x46bf55(0x151)][_0x46bf55(0x11d)],await _0x4c7f44[_0x46bf55(0x170)](),_0x225649[_0x46bf55(0x111)](_0x46bf55(0x185),'Sales\x20Update\x20successfully'),_0x181c0c[_0x46bf55(0x1e2)]('/all_sales_finished/view');}catch(_0xa5e88f){console[_0x46bf55(0x177)](_0xa5e88f);}}),router['post'](a0_0x39e489(0x21a),auth,async(_0x1f016c,_0x4597ee)=>{var _0x119f05=a0_0x39e489;try{const _0xc2df33=_0x1f016c[_0x119f05(0x107)]['id'],{invoice:_0xd89542,customer:_0x38afed,receivable_amount:_0x3c74c9,received_amount:_0x1c6584}=_0x1f016c['body'],_0x38f150=await sales[_0x119f05(0x11a)](_0xc2df33);console[_0x119f05(0x177)](_0x38f150);var _0x55e6dd=_0x3c74c9-_0x1c6584;console[_0x119f05(0x177)](_0x1c6584),_0x38f150['received_amount']=parseFloat(_0x1c6584)+parseFloat(_0x38f150[_0x119f05(0x1f3)]),_0x38f150['due_amount']=_0x55e6dd,console['log'](_0x38f150);const _0x1611c3=await _0x38f150[_0x119f05(0x170)](),_0x50da4a=await c_payment_data[_0x119f05(0x176)]({'invoice':_0xd89542});_0x50da4a[_0x119f05(0x12d)]=_0x55e6dd,await _0x50da4a['save']();let _0x53c470=new Date(),_0x3aa3ce=('0'+_0x53c470[_0x119f05(0x18c)]())['slice'](-0x2),_0x59b62f=('0'+(_0x53c470[_0x119f05(0x1be)]()+0x1))[_0x119f05(0x17b)](-0x2),_0x55e9f0=_0x53c470['getFullYear'](),_0x213cc3=_0x55e9f0+'-'+_0x59b62f+'-'+_0x3aa3ce;const _0x2be71d=new customer_payment({'invoice':_0xd89542,'date':_0x55e9f0+'-'+_0x59b62f+'-'+_0x3aa3ce,'customer':_0x38afed,'reason':_0x119f05(0x205),'amount':_0x1c6584}),_0x121b71=await _0x2be71d[_0x119f05(0x170)]();_0x1f016c[_0x119f05(0x111)]('success',_0x119f05(0x1e1)),_0x4597ee[_0x119f05(0x1e2)]('/all_sales/view');}catch(_0x9bd6c9){console[_0x119f05(0x177)](_0x9bd6c9);}}),router['get'](a0_0x39e489(0x1a8),auth,async(_0x551f87,_0x1e7af2)=>{var _0x1e36dc=a0_0x39e489;try{const {username:_0x5bbeab,email:_0x4d31b4,role:_0x3349ad}=_0x551f87[_0x1e36dc(0x140)],_0x4aff85=_0x551f87['user'],_0x60db26=await profile[_0x1e36dc(0x176)]({'email':_0x4aff85[_0x1e36dc(0x1b4)]}),_0x71b366=await master_shop[_0x1e36dc(0x203)]();console[_0x1e36dc(0x177)](_0x1e36dc(0x1d2),_0x71b366);const _0xab2c40=_0x551f87[_0x1e36dc(0x107)]['id'],_0x35f724=await sales[_0x1e36dc(0x11a)](_0xab2c40);console[_0x1e36dc(0x177)](_0x35f724);const _0x4615be=await customer[_0x1e36dc(0x176)]({'name':_0x35f724[_0x1e36dc(0x208)]});console[_0x1e36dc(0x177)](_0x4615be);if(_0x71b366[0x0][_0x1e36dc(0x17f)]==_0x1e36dc(0x17c)){var _0x5153e6=users[_0x1e36dc(0x214)];console[_0x1e36dc(0x177)](_0x5153e6);}else{if(_0x71b366[0x0]['language']==_0x1e36dc(0x1ec))var _0x5153e6=users[_0x1e36dc(0x1ec)];else{if(_0x71b366[0x0][_0x1e36dc(0x17f)]=='German')var _0x5153e6=users['German'];else{if(_0x71b366[0x0][_0x1e36dc(0x17f)]=='Spanish')var _0x5153e6=users['Spanish'];else{if(_0x71b366[0x0][_0x1e36dc(0x17f)]==_0x1e36dc(0x1d1))var _0x5153e6=users['French'];else{if(_0x71b366[0x0]['language']==_0x1e36dc(0x1ba))var _0x5153e6=users[_0x1e36dc(0x103)];else{if(_0x71b366[0x0][_0x1e36dc(0x17f)]==_0x1e36dc(0x13f))var _0x5153e6=users[_0x1e36dc(0x13f)];else{if(_0x71b366[0x0][_0x1e36dc(0x17f)]==_0x1e36dc(0x146))var _0x5153e6=users[_0x1e36dc(0x113)];}}}}}}}_0x1e7af2[_0x1e36dc(0x1e3)]('sales_invoice',{'success':_0x551f87[_0x1e36dc(0x111)](_0x1e36dc(0x185)),'errors':_0x551f87['flash'](_0x1e36dc(0x18e)),'role':_0x4aff85,'profile':_0x60db26,'master_shop':_0x71b366,'customers':_0x4615be,'sales':_0x35f724,'language':_0x5153e6});}catch(_0x2dcc62){console[_0x1e36dc(0x177)](_0x2dcc62);}}),router[a0_0x39e489(0x1ad)]('/view/return_sales/:id',auth,async(_0x3ebbe2,_0x2c82fb)=>{var _0x3cf01e=a0_0x39e489;try{const {username:_0x5a46b8,email:_0x41cf8f,role:_0x3221be}=_0x3ebbe2['user'],_0xbb0252=_0x3ebbe2[_0x3cf01e(0x140)],_0x52c1a8=await profile['findOne']({'email':_0xbb0252[_0x3cf01e(0x1b4)]}),_0x4941c8=await master_shop[_0x3cf01e(0x203)](),_0x53efe1=_0x3ebbe2[_0x3cf01e(0x107)]['id'],_0x3ba8d2=await sales_finished['findById'](_0x53efe1),_0x2ac5b2=await warehouse[_0x3cf01e(0x1fe)]([{'$match':{'name':_0x3ba8d2['warehouse_name']}},{'$unwind':_0x3cf01e(0x1ff)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3cf01e(0x17d)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3cf01e(0x114)},'floorlevel':{'$first':_0x3cf01e(0x1bd)},'primary_code':{'$first':_0x3cf01e(0x102)},'secondary_code':{'$first':_0x3cf01e(0x197)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3cf01e(0x143)},'rack':{'$first':_0x3cf01e(0x121)},'expiry_date':{'$first':_0x3cf01e(0x178)},'production_date':{'$first':_0x3cf01e(0x198)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x3cf01e(0x16a)},'maxProducts':{'$first':_0x3cf01e(0x179)},'batch_code':{'$first':_0x3cf01e(0x1c9)},'maxPerUnit':{'$first':_0x3cf01e(0x1ae)}}}]),_0x37af2c=await product['find']({}),_0x290052=await warehouse['aggregate']([{'$match':{'status':_0x3cf01e(0x196),'warehouse_category':_0x3cf01e(0x132),'name':{'$ne':'Return\x20Goods','$ne':_0x3cf01e(0x10a)}}},{'$group':{'_id':_0x3cf01e(0x148),'name':{'$first':_0x3cf01e(0x148)}}},{'$sort':{'name':0x1}}]);var _0xc20307=[_0x3cf01e(0x1f4)];const _0x1b91f9=await warehouse[_0x3cf01e(0x1fe)]([{'$match':{'status':_0x3cf01e(0x196),'name':_0x3cf01e(0x10a)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x4941c8[0x0][_0x3cf01e(0x17f)]==_0x3cf01e(0x17c)){var _0x1fcd21=users[_0x3cf01e(0x214)];console[_0x3cf01e(0x177)](_0x1fcd21);}else{if(_0x4941c8[0x0][_0x3cf01e(0x17f)]=='Hindi')var _0x1fcd21=users['Hindi'];else{if(_0x4941c8[0x0][_0x3cf01e(0x17f)]==_0x3cf01e(0x117))var _0x1fcd21=users['German'];else{if(_0x4941c8[0x0][_0x3cf01e(0x17f)]==_0x3cf01e(0x16e))var _0x1fcd21=users[_0x3cf01e(0x16e)];else{if(_0x4941c8[0x0][_0x3cf01e(0x17f)]==_0x3cf01e(0x1d1))var _0x1fcd21=users[_0x3cf01e(0x1d1)];else{if(_0x4941c8[0x0]['language']==_0x3cf01e(0x1ba))var _0x1fcd21=users[_0x3cf01e(0x103)];else{if(_0x4941c8[0x0][_0x3cf01e(0x17f)]==_0x3cf01e(0x13f))var _0x1fcd21=users[_0x3cf01e(0x13f)];else{if(_0x4941c8[0x0][_0x3cf01e(0x17f)]==_0x3cf01e(0x146))var _0x1fcd21=users[_0x3cf01e(0x113)];}}}}}}}_0x2c82fb['render'](_0x3cf01e(0x15e),{'success':_0x3ebbe2['flash'](_0x3cf01e(0x185)),'errors':_0x3ebbe2[_0x3cf01e(0x111)]('errors'),'role':_0xbb0252,'profile':_0x52c1a8,'user':_0x3ba8d2,'stock':_0x2ac5b2,'master_shop':_0x4941c8,'unit':_0x37af2c,'language':_0x1fcd21,'warehouses':_0x290052,'rooms':_0xc20307,'warehouse_QA':_0x1b91f9});}catch(_0x19050f){console[_0x3cf01e(0x177)](_0x19050f),_0x2c82fb['status'](0xc8)[_0x3cf01e(0x1d0)]({'message':_0x19050f[_0x3cf01e(0x1fc)]});}}),router[a0_0x39e489(0x1c0)](a0_0x39e489(0x1b6),auth,async(_0xa6937c,_0x2ff95c)=>{var _0x107b3b=a0_0x39e489;if(_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1b0)]=='QA')try{const {invoice:_0xa209d4,date:_0x21f660,warehouse_name:_0x3b0e24,product_name:_0x3f8e14,primary_code:_0x261b60,secondary_code:_0x2f03db,product_code:_0x37cd18,sales_quantity:_0x472358,stocks:_0x5121b4,return_qty:_0x2f3967,Room_name:_0x3fc6e3,to_warehouse_name_QA:_0x2bf0de,to_Room_name_QA:_0x583220,note:_0x485ac4,for_categorize:_0x196341,product_name_QA1:_0x591f83}=_0xa6937c[_0x107b3b(0x151)];if(typeof _0x591f83=='string')var _0x533084=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1c1)]],_0x194079=[_0xa6937c['body']['primary_code_QA']],_0x5443fa=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x181)]],_0x391515=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1f5)]],_0x3fd9a7=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x12c)]],_0x5f3529=[_0xa6937c['body'][_0x107b3b(0x12f)]],_0xbab6a8=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1a0)]],_0x6244f=[_0xa6937c[_0x107b3b(0x151)]['maxPerUnit_QA']],_0x1fe7da=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1f0)]],_0x47f4da=[_0xa6937c[_0x107b3b(0x151)]['batch_code_QA']],_0x1a7542=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1b2)]],_0x329381=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x16f)]],_0x1c3c96=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x15f)]],_0x33daa8=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x149)]];else var _0x533084=[..._0xa6937c['body'][_0x107b3b(0x1c1)]],_0x194079=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x188)]],_0x5443fa=[..._0xa6937c[_0x107b3b(0x151)]['secondary_code_QA']],_0x391515=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1f5)]],_0x3fd9a7=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x12c)]],_0x5f3529=[..._0xa6937c[_0x107b3b(0x151)]['stocks_QA']],_0xbab6a8=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1a0)]],_0x6244f=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x17e)]],_0x1fe7da=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1f0)]],_0x47f4da=[..._0xa6937c['body'][_0x107b3b(0x16d)]],_0x1a7542=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1b2)]],_0x329381=[..._0xa6937c['body'][_0x107b3b(0x16f)]],_0x1c3c96=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x15f)]],_0x33daa8=[..._0xa6937c[_0x107b3b(0x151)]['expiry_date_QA']];const _0x394897=_0x533084['map'](_0x1d8c9e=>{return _0x1d8c9e={'product_name':_0x1d8c9e};});_0x194079[_0x107b3b(0x1e0)]((_0x2dae25,_0x4dbe29)=>{var _0x17fb9e=_0x107b3b;_0x394897[_0x4dbe29][_0x17fb9e(0x18a)]=_0x2dae25;}),_0x5443fa[_0x107b3b(0x1e0)]((_0x48dd98,_0x422a6f)=>{var _0x19eaca=_0x107b3b;_0x394897[_0x422a6f][_0x19eaca(0x136)]=_0x48dd98;}),_0x391515['forEach']((_0x1ff020,_0x12d670)=>{var _0x129ed7=_0x107b3b;_0x394897[_0x12d670][_0x129ed7(0x11f)]=_0x1ff020;}),_0x3fd9a7['forEach']((_0x10aa5c,_0x47092f)=>{_0x394897[_0x47092f]['sale_qty']=_0x10aa5c;}),_0x5f3529[_0x107b3b(0x1e0)]((_0x436434,_0x35c817)=>{var _0x31a8fd=_0x107b3b;_0x394897[_0x35c817][_0x31a8fd(0x201)]=_0x436434;}),_0xbab6a8[_0x107b3b(0x1e0)]((_0x17bc27,_0x83b100)=>{var _0x1f6ee4=_0x107b3b;_0x394897[_0x83b100][_0x1f6ee4(0x1af)]=_0x17bc27;}),_0x6244f[_0x107b3b(0x1e0)]((_0x359873,_0x4adf80)=>{_0x394897[_0x4adf80]['maxPerUnit']=_0x359873;}),_0x1fe7da[_0x107b3b(0x1e0)]((_0x104b04,_0x58d45b)=>{var _0x16806e=_0x107b3b;_0x394897[_0x58d45b][_0x16806e(0x20f)]=_0x104b04;}),_0x47f4da[_0x107b3b(0x1e0)]((_0x5ce8eb,_0x14927f)=>{var _0xb4f6d6=_0x107b3b;_0x394897[_0x14927f][_0xb4f6d6(0x10b)]=_0x5ce8eb;}),_0x1a7542[_0x107b3b(0x1e0)]((_0x5c41bd,_0x507cb1)=>{var _0x688a87=_0x107b3b;_0x394897[_0x507cb1][_0x688a87(0x14c)]=_0x5c41bd;}),_0x329381[_0x107b3b(0x1e0)]((_0x1ce7e9,_0x2d5832)=>{var _0x3aaf0c=_0x107b3b;_0x394897[_0x2d5832][_0x3aaf0c(0x1a9)]=_0x1ce7e9;}),_0x1c3c96[_0x107b3b(0x1e0)]((_0x57bfd3,_0x112557)=>{var _0x4f228f=_0x107b3b;_0x394897[_0x112557][_0x4f228f(0x217)]=_0x57bfd3;}),_0x33daa8[_0x107b3b(0x1e0)]((_0x491563,_0x353165)=>{var _0x36866c=_0x107b3b;_0x394897[_0x353165][_0x36866c(0x168)]=_0x491563;});const _0x4f6f1b=await sales_finished[_0x107b3b(0x176)]({'invoice':_0xa209d4});_0x4f6f1b[_0x107b3b(0x12b)]=_0x107b3b(0x135);const _0x7f45ac=await _0x4f6f1b[_0x107b3b(0x170)](),_0x4b349a=new sales_return_finished({'invoice':_0xa209d4,'customer':_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x208)],'date':_0x21f660,'warehouse_name':_0x3b0e24,'room':_0x3fc6e3,'ToWarehouse':_0x2bf0de,'ToRoom':_0x583220,'return_sale_QA':_0x394897,'note':_0x485ac4,'warehouse_cat':_0x196341}),_0x470480=await _0x4b349a['save'](),_0x332673=await sales_return_finished[_0x107b3b(0x176)]({'invoice':_0xa209d4}),_0x2753f9=await warehouse[_0x107b3b(0x176)]({'name':_0x2bf0de,'room':_0x583220});_0x332673[_0x107b3b(0x11e)]['forEach'](_0x406507=>{var _0x1f8df0=_0x107b3b,_0x2b3c04=0x0;const _0x1e7404=_0x2753f9[_0x1f8df0(0x119)][_0x1f8df0(0x1f2)](_0x2f37eb=>{var _0x2ce444=_0x1f8df0;_0x2f37eb['product_name']==_0x406507[_0x2ce444(0x133)]&&_0x2f37eb[_0x2ce444(0x168)]==_0x406507[_0x2ce444(0x168)]&&_0x2f37eb['production_date']==_0x406507['production_date']&&_0x2f37eb['batch_code']==_0x406507[_0x2ce444(0x10b)]&&(_0x2f37eb[_0x2ce444(0x1bf)]=parseInt(_0x2f37eb[_0x2ce444(0x1bf)])+parseInt(_0x406507['return_qty']),_0x2b3c04++);});_0x2b3c04=='0'&&(_0x2753f9[_0x1f8df0(0x119)]=_0x2753f9[_0x1f8df0(0x119)][_0x1f8df0(0x1c8)]({'product_name':_0x406507[_0x1f8df0(0x133)],'product_stock':_0x406507[_0x1f8df0(0x1af)],'primary_code':_0x406507[_0x1f8df0(0x18a)],'secondary_code':_0x406507['secondary_code'],'product_code':_0x406507[_0x1f8df0(0x11f)],'batch_code':_0x406507[_0x1f8df0(0x10b)],'maxPerUnit':_0x406507[_0x1f8df0(0x1c2)],'production_date':_0x406507[_0x1f8df0(0x217)],'expiry_date':_0x406507[_0x1f8df0(0x168)],'secondary_unit':_0x406507[_0x1f8df0(0x14c)],'unit':_0x406507[_0x1f8df0(0x1a9)],'maxProducts':_0x406507[_0x1f8df0(0x20f)],'bay':_0x406507[_0x1f8df0(0x13e)]}));}),await _0x2753f9[_0x107b3b(0x170)]();const _0x26a89a=new c_payment_data({'invoice':_0xa209d4,'customer':_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x208)],'reason':_0x107b3b(0x1f7)});await _0x26a89a['save']();const _0x867954=await master_shop['find'](),_0x4b012f=await email_settings['findOne'](),_0x268869=await customer[_0x107b3b(0x176)]({'name':_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x208)]});_0x867954[0x0][_0x107b3b(0x190)]==0x1?(right_currency=_0x867954[0x0][_0x107b3b(0x212)],left_currency=''):(right_currency='',left_currency=_0x867954[0x0][_0x107b3b(0x212)]);var _0x559e82=_0x533084,_0x523241=_0xbab6a8,_0x46249b='',_0x134c93;for(_0x134c93 in _0x559e82){_0x46249b+='<tr>'+_0x107b3b(0x123)+_0x559e82[_0x134c93]+_0x107b3b(0x1c6)+_0x107b3b(0x123)+_0x523241[_0x134c93]+'</td>'+'</tr>';}console[_0x107b3b(0x177)]('product_list',_0x46249b);let _0x5c8d7f=nodemailer['createTransport']({'service':_0x107b3b(0x186),'auth':{'user':_0x4b012f[_0x107b3b(0x1b4)],'pass':_0x4b012f[_0x107b3b(0x1d8)]}}),_0x590852={'from':_0x4b012f[_0x107b3b(0x1b4)],'to':_0x268869[_0x107b3b(0x1b4)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x107b3b(0x153),'path':__dirname+_0x107b3b(0x1a5)+'/upload/'+_0x867954[0x0][_0x107b3b(0x1b9)],'cid':_0x107b3b(0x109)}],'html':_0x107b3b(0x162)+_0x107b3b(0x1f6)+_0x107b3b(0x122)+_0x107b3b(0x183)+_0x107b3b(0x12e)+_0x107b3b(0x183)+_0x107b3b(0x157)+'</div>'+'<div>'+_0x107b3b(0x1bb)+_0x867954[0x0][_0x107b3b(0x192)]+_0x107b3b(0x1a2)+_0x107b3b(0x1ce)+_0x107b3b(0x1ce)+_0x107b3b(0x200)+_0x107b3b(0x183)+_0x107b3b(0x207)+_0x107b3b(0x219)+_0xa209d4+'\x20'+_0x107b3b(0x161)+'\x20Order\x20Date\x20:\x20'+_0x21f660+'\x20'+'</span>'+_0x107b3b(0x118)+_0x107b3b(0x1ce)+_0x107b3b(0x165)+_0x107b3b(0x1ee)+_0x107b3b(0x150)+_0x107b3b(0x194)+_0x107b3b(0x187)+_0x107b3b(0x211)+_0x107b3b(0x1a1)+_0x107b3b(0x20e)+_0x107b3b(0x12a)+_0x107b3b(0x155)+'\x20'+_0x46249b+'\x20'+_0x107b3b(0x10e)+_0x107b3b(0x160)+_0x107b3b(0x183)+_0x107b3b(0x1ed)+_0x107b3b(0x1d3)+_0x867954[0x0][_0x107b3b(0x192)]+_0x107b3b(0x118)+_0x107b3b(0x1ce)+_0x107b3b(0x1ce)+_0x107b3b(0x1df)};_0x5c8d7f[_0x107b3b(0x172)](_0x590852,function(_0x491ec4,_0x4a85dd){var _0x542153=_0x107b3b;_0x491ec4?(console[_0x542153(0x177)](_0x491ec4),console[_0x542153(0x177)](_0x542153(0x184))):console[_0x542153(0x177)]('Email\x20sent\x20successfully');}),_0xa6937c[_0x107b3b(0x111)](_0x107b3b(0x185),_0x107b3b(0x1c3)),_0x2ff95c[_0x107b3b(0x1e2)](_0x107b3b(0x19c));}catch(_0xec15ef){_0x2ff95c[_0x107b3b(0x1a3)](0xc8)[_0x107b3b(0x1d0)]({'message1':_0xec15ef['message']});}else{if(_0xa6937c['body'][_0x107b3b(0x1b0)]=='GS')try{const {invoice:_0x3da13b,date:_0x1fc9ca,warehouse_name:_0x492c03,product_name:_0x193938,primary_code:_0x275951,secondary_code:_0x4795a0,product_code:_0x3ea920,sales_quantity:_0x356851,stocks:_0x1a18eb,return_qty:_0xe894c3,Room_name:_0x1e55fc,to_warehouse_name:_0x3d2c80,to_Room_name:_0x39e662,note:_0x351337,level:_0x77e396,isle:_0x23e803,pallet:_0x569a7a,for_categorize:_0x2273a2}=_0xa6937c[_0x107b3b(0x151)];if(typeof _0x193938==_0x107b3b(0x115))var _0x533084=[_0xa6937c[_0x107b3b(0x151)]['product_name']],_0x194079=[_0xa6937c[_0x107b3b(0x151)]['primary_code']],_0x5443fa=[_0xa6937c['body']['secondary_code']],_0x391515=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x11f)]],_0x3fd9a7=[_0xa6937c['body'][_0x107b3b(0x142)]],_0xbab6a8=[_0xa6937c[_0x107b3b(0x151)]['return_qty']],_0x4a5a67=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x13e)]],_0x6244f=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1c2)]],_0x1fe7da=[_0xa6937c['body'][_0x107b3b(0x20f)]],_0x47f4da=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x10b)]],_0x1a7542=[_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x14c)]],_0x329381=[_0xa6937c['body'][_0x107b3b(0x1a9)]],_0x1c3c96=[_0xa6937c[_0x107b3b(0x151)]['production_date']],_0x33daa8=[_0xa6937c['body']['expiry_date']];else var _0x533084=[..._0xa6937c['body'][_0x107b3b(0x133)]],_0x194079=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x18a)]],_0x5443fa=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x136)]],_0x391515=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x11f)]],_0x3fd9a7=[..._0xa6937c['body'][_0x107b3b(0x142)]],_0xbab6a8=[..._0xa6937c[_0x107b3b(0x151)]['return_qty']],_0x4a5a67=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x13e)]],_0x6244f=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1c2)]],_0x1fe7da=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x20f)]],_0x47f4da=[..._0xa6937c[_0x107b3b(0x151)]['batch_code']],_0x1a7542=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x14c)]],_0x329381=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x1a9)]],_0x1c3c96=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x217)]],_0x33daa8=[..._0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x168)]];const _0x497ae4=_0x533084[_0x107b3b(0x1f2)](_0x45dd05=>{return _0x45dd05={'product_name':_0x45dd05};});_0x194079[_0x107b3b(0x1e0)]((_0x6c4aa0,_0x5f2369)=>{var _0x4eeadf=_0x107b3b;_0x497ae4[_0x5f2369][_0x4eeadf(0x18a)]=_0x6c4aa0;}),_0x5443fa[_0x107b3b(0x1e0)]((_0x54697c,_0x471c39)=>{_0x497ae4[_0x471c39]['secondary_code']=_0x54697c;}),_0x391515[_0x107b3b(0x1e0)]((_0xd7fd72,_0x4c493b)=>{_0x497ae4[_0x4c493b]['product_code']=_0xd7fd72;}),_0x3fd9a7['forEach']((_0x37ccbd,_0x1f3b81)=>{var _0x270f4d=_0x107b3b;_0x497ae4[_0x1f3b81][_0x270f4d(0x1c4)]=_0x37ccbd;}),_0xbab6a8[_0x107b3b(0x1e0)]((_0x4585b3,_0x41c695)=>{var _0x532da7=_0x107b3b;_0x497ae4[_0x41c695][_0x532da7(0x1af)]=_0x4585b3;}),_0x4a5a67[_0x107b3b(0x1e0)]((_0x47ce5e,_0x19f9d6)=>{var _0x4fff27=_0x107b3b;_0x497ae4[_0x19f9d6][_0x4fff27(0x13e)]=_0x47ce5e;}),_0x6244f[_0x107b3b(0x1e0)]((_0x1bcd39,_0x27d4a2)=>{_0x497ae4[_0x27d4a2]['maxPerUnit']=_0x1bcd39;}),_0x1fe7da[_0x107b3b(0x1e0)]((_0x353a1b,_0x2aa725)=>{var _0xd6a163=_0x107b3b;_0x497ae4[_0x2aa725][_0xd6a163(0x20f)]=_0x353a1b;}),_0x47f4da['forEach']((_0x2c3df1,_0x52a1dd)=>{var _0x9eec98=_0x107b3b;_0x497ae4[_0x52a1dd][_0x9eec98(0x10b)]=_0x2c3df1;}),_0x1a7542[_0x107b3b(0x1e0)]((_0x375a62,_0x5cb4ee)=>{var _0x578da6=_0x107b3b;_0x497ae4[_0x5cb4ee][_0x578da6(0x14c)]=_0x375a62;}),_0x329381[_0x107b3b(0x1e0)]((_0x1ea0d7,_0x2303c8)=>{var _0x12edc0=_0x107b3b;_0x497ae4[_0x2303c8][_0x12edc0(0x1a9)]=_0x1ea0d7;}),_0x1c3c96[_0x107b3b(0x1e0)]((_0x372938,_0x170e0c)=>{_0x497ae4[_0x170e0c]['production_date']=_0x372938;}),_0x33daa8[_0x107b3b(0x1e0)]((_0x50ddd4,_0x2d0f42)=>{var _0x42e1ed=_0x107b3b;_0x497ae4[_0x2d0f42][_0x42e1ed(0x168)]=_0x50ddd4;});var _0x268569=0x0;_0x497ae4[_0x107b3b(0x1e0)](_0x3c873a=>{var _0x4e0258=_0x107b3b;(parseInt(_0x3c873a['sale_qty'])<parseInt(_0x3c873a['return_qty'])||parseInt(_0x3c873a[_0x4e0258(0x201)])<parseInt(_0x3c873a[_0x4e0258(0x1af)])&&parseInt(_0x3c873a['sale_qty'])>parseInt(_0x3c873a['return_qty'])||parseInt(_0x3c873a[_0x4e0258(0x1af)])==0x0)&&_0x268569++;});if(_0x268569!=0x0)return _0xa6937c['flash'](_0x107b3b(0x18e),_0x107b3b(0x171)),_0x2ff95c[_0x107b3b(0x1e2)](_0x107b3b(0x1a6));const _0x260896=await sales_finished['findOne']({'invoice':_0x3da13b});_0x260896[_0x107b3b(0x12b)]=_0x107b3b(0x135);const _0x463be4=await _0x260896[_0x107b3b(0x170)](),_0x1ad8e8=new sales_return_finished({'invoice':_0x3da13b,'customer':_0xa6937c[_0x107b3b(0x151)]['customer'],'date':_0x1fc9ca,'warehouse_name':_0x492c03,'room':_0x1e55fc,'ToWarehouse':_0x3d2c80,'ToRoom':_0x39e662,'return_sale':_0x497ae4,'note':_0x351337,'warehouse_cat':_0x2273a2}),_0x293849=await _0x1ad8e8['save'](),_0xe0af3b=await sales_return_finished[_0x107b3b(0x176)]({'invoice':_0x3da13b}),_0x33f638=await warehouse['findOne']({'name':_0x3d2c80,'room':_0x39e662,'warehouse_category':_0x107b3b(0x132)});_0xe0af3b[_0x107b3b(0x13d)][_0x107b3b(0x1e0)](_0x1d6b00=>{var _0x5737c5=_0x107b3b,_0x345198=0x0;const _0x2aef34=_0x33f638[_0x5737c5(0x119)][_0x5737c5(0x1f2)](_0x5bdc65=>{var _0x11c91f=_0x5737c5;_0x5bdc65[_0x11c91f(0x133)]==_0x1d6b00[_0x11c91f(0x133)]&&_0x5bdc65[_0x11c91f(0x13e)]==_0x1d6b00[_0x11c91f(0x13e)]&&_0x5bdc65[_0x11c91f(0x168)]==_0x1d6b00['expiry_date']&&_0x5bdc65['production_date']==_0x1d6b00[_0x11c91f(0x217)]&&_0x5bdc65[_0x11c91f(0x10b)]==_0x1d6b00['batch_code']&&(_0x5bdc65['product_stock']=parseInt(_0x5bdc65[_0x11c91f(0x1bf)])+parseInt(_0x1d6b00[_0x11c91f(0x1af)]),_0x345198++);});_0x345198=='0'&&(_0x33f638[_0x5737c5(0x119)]=_0x33f638['product_details'][_0x5737c5(0x1c8)]({'product_name':_0x1d6b00['product_name'],'product_stock':_0x1d6b00[_0x5737c5(0x1af)],'primary_code':_0x1d6b00[_0x5737c5(0x18a)],'secondary_code':_0x1d6b00[_0x5737c5(0x136)],'product_code':_0x1d6b00['product_code'],'bay':_0x1d6b00[_0x5737c5(0x13e)],'batch_code':_0x1d6b00[_0x5737c5(0x10b)],'maxPerUnit':_0x1d6b00[_0x5737c5(0x1c2)],'production_date':_0x1d6b00[_0x5737c5(0x217)],'expiry_date':_0x1d6b00[_0x5737c5(0x168)],'secondary_unit':_0x1d6b00['secondary_unit'],'unit':_0x1d6b00[_0x5737c5(0x1a9)],'maxProducts':_0x1d6b00[_0x5737c5(0x20f)]}));}),await _0x33f638[_0x107b3b(0x170)](),console[_0x107b3b(0x177)](_0xa6937c[_0x107b3b(0x151)]);const _0x7bb382=new c_payment_data({'invoice':_0x3da13b,'customer':_0xa6937c[_0x107b3b(0x151)][_0x107b3b(0x208)],'reason':_0x107b3b(0x1f7)});await _0x7bb382[_0x107b3b(0x170)]();const _0x46c912=await master_shop['find']();console[_0x107b3b(0x177)]('add\x20post',_0x46c912[0x0]['image']);const _0x1d7e09=await email_settings[_0x107b3b(0x176)](),_0x27d616=await customer['findOne']({'name':_0xa6937c['body'][_0x107b3b(0x208)]});console[_0x107b3b(0x177)](_0x107b3b(0x199),_0x27d616);_0x46c912[0x0][_0x107b3b(0x190)]==0x1?(right_currency=_0x46c912[0x0][_0x107b3b(0x212)],left_currency=''):(right_currency='',left_currency=_0x46c912[0x0][_0x107b3b(0x212)]);var _0x559e82=_0x533084,_0x523241=_0xbab6a8,_0x46249b='',_0x134c93;for(_0x134c93 in _0x559e82){_0x46249b+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x559e82[_0x134c93]+_0x107b3b(0x1c6)+_0x107b3b(0x123)+_0x523241[_0x134c93]+_0x107b3b(0x1c6)+'</tr>';}console['log'](_0x107b3b(0x1b3),_0x46249b);let _0x547614=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x1d7e09['email'],'pass':_0x1d7e09['password']}}),_0x1ad66e={'from':_0x1d7e09['email'],'to':_0x27d616[_0x107b3b(0x1b4)],'subject':_0x107b3b(0x154),'attachments':[{'filename':_0x107b3b(0x153),'path':__dirname+_0x107b3b(0x1a5)+_0x107b3b(0x137)+_0x46c912[0x0][_0x107b3b(0x1b9)],'cid':_0x107b3b(0x109)}],'html':_0x107b3b(0x162)+_0x107b3b(0x1f6)+_0x107b3b(0x122)+'<div>'+_0x107b3b(0x12e)+_0x107b3b(0x183)+_0x107b3b(0x157)+_0x107b3b(0x1ce)+_0x107b3b(0x183)+_0x107b3b(0x1bb)+_0x46c912[0x0][_0x107b3b(0x192)]+_0x107b3b(0x1a2)+'</div>'+'</div>'+_0x107b3b(0x200)+_0x107b3b(0x183)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x3da13b+'\x20'+_0x107b3b(0x161)+'\x20Order\x20Date\x20:\x20'+_0x1fc9ca+'\x20'+_0x107b3b(0x15d)+'</h5>'+_0x107b3b(0x1ce)+_0x107b3b(0x165)+_0x107b3b(0x1ee)+_0x107b3b(0x150)+_0x107b3b(0x194)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x107b3b(0x211)+_0x107b3b(0x1a1)+_0x107b3b(0x20e)+_0x107b3b(0x12a)+_0x107b3b(0x155)+'\x20'+_0x46249b+'\x20'+'</tbody>'+_0x107b3b(0x160)+_0x107b3b(0x183)+_0x107b3b(0x1ed)+'<h5>'+_0x46c912[0x0][_0x107b3b(0x192)]+_0x107b3b(0x118)+_0x107b3b(0x1ce)+_0x107b3b(0x1ce)+_0x107b3b(0x1df)};_0x547614['sendMail'](_0x1ad66e,function(_0x4b03e8,_0xdb7bb8){var _0x497a0b=_0x107b3b;_0x4b03e8?(console[_0x497a0b(0x177)](_0x4b03e8),console[_0x497a0b(0x177)](_0x497a0b(0x184))):console[_0x497a0b(0x177)]('Email\x20sent\x20successfully');}),_0xa6937c[_0x107b3b(0x111)](_0x107b3b(0x185),_0x107b3b(0x1c3)),_0x2ff95c[_0x107b3b(0x1e2)](_0x107b3b(0x19c));}catch(_0x3654d6){console['log'](_0x3654d6),_0x2ff95c[_0x107b3b(0x1a3)](0xc8)[_0x107b3b(0x1d0)]({'message1':_0x3654d6['message']});}}}),router['get'](a0_0x39e489(0x204),auth,async(_0x596415,_0x4f2b47)=>{var _0x1a7f4d=a0_0x39e489;try{const {username:_0x504c90,email:_0x36689e,role:_0x2f3940}=_0x596415[_0x1a7f4d(0x140)],_0x12cb5e=_0x596415[_0x1a7f4d(0x140)],_0x209033=await profile['findOne']({'email':_0x12cb5e[_0x1a7f4d(0x1b4)]}),_0xe0ac66=await master_shop['find']();console[_0x1a7f4d(0x177)](_0x1a7f4d(0x1ca),_0xe0ac66);const _0x5643e7=_0x596415[_0x1a7f4d(0x107)]['id'],_0x2cf69a=await sales[_0x1a7f4d(0x11a)](_0x5643e7);console[_0x1a7f4d(0x177)](_0x1a7f4d(0x15c),_0x2cf69a);if(_0xe0ac66[0x0][_0x1a7f4d(0x17f)]==_0x1a7f4d(0x17c))var _0x4b596a=users[_0x1a7f4d(0x214)];else{if(_0xe0ac66[0x0][_0x1a7f4d(0x17f)]==_0x1a7f4d(0x1ec))var _0x4b596a=users[_0x1a7f4d(0x1ec)];else{if(_0xe0ac66[0x0][_0x1a7f4d(0x17f)]=='German')var _0x4b596a=users[_0x1a7f4d(0x117)];else{if(_0xe0ac66[0x0][_0x1a7f4d(0x17f)]=='Spanish')var _0x4b596a=users[_0x1a7f4d(0x16e)];else{if(_0xe0ac66[0x0][_0x1a7f4d(0x17f)]=='French')var _0x4b596a=users['French'];else{if(_0xe0ac66[0x0][_0x1a7f4d(0x17f)]==_0x1a7f4d(0x1ba))var _0x4b596a=users[_0x1a7f4d(0x103)];else{if(_0xe0ac66[0x0]['language']=='Chinese')var _0x4b596a=users['Chinese'];else{if(_0xe0ac66[0x0][_0x1a7f4d(0x17f)]==_0x1a7f4d(0x146))var _0x4b596a=users[_0x1a7f4d(0x113)];}}}}}}}_0x4f2b47[_0x1a7f4d(0x1e3)](_0x1a7f4d(0x124),{'success':_0x596415[_0x1a7f4d(0x111)](_0x1a7f4d(0x185)),'errors':_0x596415[_0x1a7f4d(0x111)]('errors'),'role':_0x12cb5e,'profile':_0x209033,'alldata':_0x2cf69a,'master_shop':_0xe0ac66,'language':_0x4b596a});}catch(_0x126607){console[_0x1a7f4d(0x177)](_0x126607);}}),router[a0_0x39e489(0x1c0)](a0_0x39e489(0x106),async(_0x43bbfd,_0x41b69b)=>{var _0x184e5f=a0_0x39e489;const {product_code:_0x54fe24,warehouse_name:_0x17bef7,rooms_data:_0x4fed2b,Roomslist:_0x96dea2}=_0x43bbfd[_0x184e5f(0x151)],_0x40b013=_0x96dea2[_0x184e5f(0x19b)](','),_0x4eb2ed=[];async function _0x3eac62(_0x19d73e){var _0x5d9344=_0x184e5f;const _0x5e48b4=await warehouse[_0x5d9344(0x1fe)]([{'$match':{'name':_0x17bef7,'room':_0x19d73e}},{'$unwind':_0x5d9344(0x1ff)},{'$match':{'product_details.primary_code':_0x54fe24}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5d9344(0x18f)},'product_stock':{'$first':_0x5d9344(0x17d)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5d9344(0x197)},'product_code':{'$first':_0x5d9344(0x156)},'level':{'$first':_0x5d9344(0x110)},'isle':{'$first':_0x5d9344(0x175)},'type':{'$first':_0x5d9344(0x114)},'pallet':{'$first':_0x5d9344(0x1bd)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x5d9344(0x16a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5d9344(0x178)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x5d9344(0x1ae)},'batch_code':{'$first':_0x5d9344(0x1c9)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x5d9344(0x202)},'invoice':{'$first':_0x5d9344(0x1ea)}}}]),_0x5e1fd1=await warehouse[_0x5d9344(0x1fe)]([{'$match':{'name':_0x17bef7,'room':_0x19d73e}},{'$unwind':_0x5d9344(0x1ff)},{'$match':{'product_details.secondary_code':_0x54fe24}},{'$group':{'_id':_0x5d9344(0x14f),'name':{'$first':_0x5d9344(0x18f)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5d9344(0x197)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x5d9344(0x110)},'isle':{'$first':_0x5d9344(0x175)},'type':{'$first':_0x5d9344(0x114)},'pallet':{'$first':_0x5d9344(0x1bd)},'unit':{'$first':_0x5d9344(0x16b)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5d9344(0x121)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5d9344(0x198)},'maxPerUnit':{'$first':_0x5d9344(0x1ae)},'batch_code':{'$first':_0x5d9344(0x1c9)},'product_cat':{'$first':_0x5d9344(0x215)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x5d9344(0x202)},'invoice':{'$first':_0x5d9344(0x1ea)}}}]);if(_0x5e48b4[_0x5d9344(0x1cd)]>0x0)_0x4eb2ed[_0x5d9344(0x1ac)](_0x5e48b4);else _0x5e1fd1['length']>0x0&&_0x4eb2ed['push'](_0x5e1fd1);}const _0x55521e=_0x40b013[_0x184e5f(0x1f2)](_0x29d016=>_0x3eac62(_0x29d016));await Promise[_0x184e5f(0x206)](_0x55521e),_0x41b69b['json'](_0x4eb2ed);}),module[a0_0x39e489(0x1ef)]=router;