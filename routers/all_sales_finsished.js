var a0_0x2a3f2d=a0_0x3943;function a0_0x3c71(){var _0x8f6d2d=['Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','/view/add_sales/:id','room','due_amount','Return\x20Rooms','Error\x20Occurs','maxperunit','</span>','\x20Order\x20Number\x20:\x20','/all_sales/view','getDate','$product_details','Sales\x20Add\x20successfully','success','../middleware/auth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Sales\x20Update\x20successfully','<!DOCTYPE\x20html>','\x20&&\x20','email','$product_details.maxPerUnit','<tbody\x20style=\x22text-align:\x20center;\x22>','catch','Sale\x20Return','concat','\x20==\x20','max_per_unit','\x20Order\x20Date\x20:\x20','amount','<hr\x20class=\x22my-3\x22>','return_sale_finished','An\x20error\x20occurred.','then','1599038BxLqCJ','152pFFFbA','purchases_data','$product_details.product_cat','prod_cat','../models/all_models','$sale_product.floorlevel','customer','/upload/','add_sales_finished','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','user','push','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','../public/language/languages.json','/all_sales_finished/view','batch_code','warehouse_name','all_sales_finished','errors','body','currency','christian.villamer@jakagroup.com','</body></html>','$product_details.expiry_date','Portuguese\x20(BR)','$sale_product','findById','$product_details.batch_code','payment\x20successfull','post','level','<html><head><title></title>','$sale_product.quantity','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','padStart','log','/invoice/:id','/preview/:id','Logo.png','</td>','maxPerUnit_QA','map','</head><body>','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','$customer','find','\x20<>\x20','split','customers_docs','product_details','sendMail','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.primary_code','$name','OUTF-','Portuguese','$product_details.production_date','edit_sales_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','8983140RpyjTw','$product_details.bin','product_list','/view/return_sales/:id','get','return_sale_QA','for_categorize','secondary_code','secondary_code_QA','An\x20error\x20occurred\x20while\x20saving\x20data.','Return\x20Goods','$customers_docs','$product_details.room_name','return_qty','Chinese','unit','Hindi','</tr>','message','$warehouse_name','$finalize','logo','maxPerUnit','currency_placement','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','host','1832994vtiivH','carton','product_stock','expiry_date_QA','aggregate','customers','$product_details.product_name','expiry_date','floor','478971sBowOO','<h2>\x20','final','$product_details.type','prod_code','<table\x20style=\x22width:\x20100%\x20!important;\x22>','createTransport','24jtcOaD','$product_details.secondary_code','True','stock','invoice','<h5\x20style=\x22text-align:\x20left;\x22>','primary_code_QA','$sale_product.bin','render','production_date_QA','customer_data','Sale\x20Return\x20Mail','$product.product_name','product_code','Finished\x20Goods','</table>','maxProducts','adjust_qty','/view/add_sale/product','string','$note','$product_details._id','FGSEmail','33AUUoUU','random','False','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','product_date','_id','product_code_QA','password','$product_details.invoice','max','/../public','params','back','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','maxProducts_QA','/barcode_scanner','received_amount','Arabic\x20(ae)','status','$date','sales_invoice','Sale','all','suppliers','$product_details.product_stock','forEach','1FVxnbR','1599227iFPlyF','<div>','\x20</h2>','barcode\x20user_id','redirect','</div>','<span\x20style=\x22float:\x20right;\x22>','return_qty_QA','$product_details.unit','Received\x20Payment\x20For\x20Sale','product_data','toString','$product_details.product_code','<tr>','add\x20post','name','ADD\x20SALE','return_sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','primary_code','id_transaction_from','filter','$return_data','French','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','QA\x20Warehouse','gmail','finalize','error','$sale_product.bay','</tbody>','$product_details.floorlevel','getMonth','unit_QA','$invoice','Router','role','Enclosed','batch_code_QA','secondary_unit_QA','$product_details.secondary_unit','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<strong>\x20Regards\x20</strong>','edit_sales_finished_view','$_id','flash','/view','466976HUzlXg','save','<h5>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','room_name','findOne','$sale_product.type','</thead>','sale_product','German','Quality\x20Inspection','$room','site_title','/picking_list/pdf/','note','production_date','$product_details.rack','bay','secondary_unit','7296636sZIxXZ','stocks_QA','English','50uXzvJB','return_data','json','$product_details.storage','foreach\x20newproduct','Ambient','Arabic','Spanish','/view/add_sales','master','English\x20(US)','sales_quantity','length','staff','slice','language','abs','port','sale_qty','warehouse','getFullYear','product_name','quantity','</h5>','express','$product_details.bay','primary_unit','Email\x20sent\x20successfully','nodemailer','image'];a0_0x3c71=function(){return _0x8f6d2d;};return a0_0x3c71();}(function(_0x620b07,_0x39265b){var _0x11a95a=a0_0x3943,_0x110f66=_0x620b07();while(!![]){try{var _0x1e8f45=parseInt(_0x11a95a(0x1a5))/0x1*(-parseInt(_0x11a95a(0x10d))/0x2)+-parseInt(_0x11a95a(0x164))/0x3+-parseInt(_0x11a95a(0x1d6))/0x4*(-parseInt(_0x11a95a(0x1ed))/0x5)+parseInt(_0x11a95a(0x174))/0x6*(parseInt(_0x11a95a(0x1a6))/0x7)+parseInt(_0x11a95a(0x10e))/0x8*(-parseInt(_0x11a95a(0x16d))/0x9)+-parseInt(_0x11a95a(0x14a))/0xa+-parseInt(_0x11a95a(0x18b))/0xb*(-parseInt(_0x11a95a(0x1ea))/0xc);if(_0x1e8f45===_0x39265b)break;else _0x110f66['push'](_0x110f66['shift']());}catch(_0x3f40d6){_0x110f66['push'](_0x110f66['shift']());}}}(a0_0x3c71,0x8eeeb));const express=require(a0_0x2a3f2d(0xe6)),app=express(),router=express[a0_0x2a3f2d(0x1c9)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x2a3f2d(0x112)),auth=require(a0_0x2a3f2d(0xfa)),nodemailer=require(a0_0x2a3f2d(0xea)),users=require(a0_0x2a3f2d(0x11b));router[a0_0x2a3f2d(0x14e)](a0_0x2a3f2d(0x1d5),auth,async(_0x5e313e,_0xd53fc4)=>{var _0xad98bb=a0_0x2a3f2d;try{const {username:_0x4ab93b,email:_0x14f28c,role:_0x188cc9}=_0x5e313e['user'],_0x1cd3cc=_0x5e313e[_0xad98bb(0x118)],_0x54fa57=await profile[_0xad98bb(0x1dc)]({'email':_0x1cd3cc[_0xad98bb(0xff)]}),_0x11c6f6=await master_shop['find']();let _0x26630d;if(_0x1cd3cc[_0xad98bb(0x1ca)]==_0xad98bb(0x1fa)){const _0x3e11bb=await staff['findOne']({'email':_0x1cd3cc[_0xad98bb(0xff)]});_0x26630d=await sales_finished[_0xad98bb(0x168)]([{'$lookup':{'from':_0xad98bb(0x169),'localField':'customer','foreignField':_0xad98bb(0x1b5),'as':_0xad98bb(0x13e)}},{'$unwind':_0xad98bb(0x155)},{'$unwind':_0xad98bb(0x127)},{'$group':{'_id':_0xad98bb(0x1d3),'invoice':{'$first':_0xad98bb(0x1c8)},'customers':{'$first':_0xad98bb(0x13a)},'date':{'$first':_0xad98bb(0x19e)},'warehouse_name':{'$first':_0xad98bb(0x15d)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0xad98bb(0x188)},'return_data':{'$first':_0xad98bb(0x1bc)},'customers_docs':{'$first':_0xad98bb(0x155)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0xad98bb(0x1c3)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x26630d=await sales_finished[_0xad98bb(0x168)]([{'$lookup':{'from':_0xad98bb(0x169),'localField':_0xad98bb(0x114),'foreignField':_0xad98bb(0x1b5),'as':_0xad98bb(0x13e)}},{'$unwind':_0xad98bb(0x155)},{'$unwind':'$sale_product'},{'$group':{'_id':_0xad98bb(0x1d3),'invoice':{'$first':_0xad98bb(0x1c8)},'customers':{'$first':'$customer'},'date':{'$first':_0xad98bb(0x19e)},'warehouse_name':{'$first':_0xad98bb(0x15d)},'sale_product':{'$push':_0xad98bb(0x127)},'note':{'$first':_0xad98bb(0x188)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0xad98bb(0x12e)},'level':{'$addToSet':_0xad98bb(0x1c3)},'isle':{'$addToSet':_0xad98bb(0x17b)},'type':{'$addToSet':_0xad98bb(0x1dd)},'pallet':{'$addToSet':_0xad98bb(0x113)},'finalize':{'$first':_0xad98bb(0x15e)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x11c6f6[0x0][_0xad98bb(0x1fc)]==_0xad98bb(0x1f7)){var _0x16d1d2=users[_0xad98bb(0x1ec)];console[_0xad98bb(0x131)](_0x16d1d2);}else{if(_0x11c6f6[0x0]['language']=='Hindi')var _0x16d1d2=users[_0xad98bb(0x15a)];else{if(_0x11c6f6[0x0][_0xad98bb(0x1fc)]=='German')var _0x16d1d2=users[_0xad98bb(0x1e0)];else{if(_0x11c6f6[0x0][_0xad98bb(0x1fc)]=='Spanish')var _0x16d1d2=users[_0xad98bb(0x1f4)];else{if(_0x11c6f6[0x0][_0xad98bb(0x1fc)]==_0xad98bb(0x1bd))var _0x16d1d2=users[_0xad98bb(0x1bd)];else{if(_0x11c6f6[0x0]['language']==_0xad98bb(0x126))var _0x16d1d2=users[_0xad98bb(0x146)];else{if(_0x11c6f6[0x0][_0xad98bb(0x1fc)]=='Chinese')var _0x16d1d2=users['Chinese'];else{if(_0x11c6f6[0x0][_0xad98bb(0x1fc)]==_0xad98bb(0x19c))var _0x16d1d2=users[_0xad98bb(0x1f3)];}}}}}}}_0xd53fc4['render'](_0xad98bb(0x11f),{'success':_0x5e313e[_0xad98bb(0x1d4)](_0xad98bb(0xf9)),'errors':_0x5e313e['flash'](_0xad98bb(0x120)),'sales':_0x26630d,'profile':_0x54fa57,'role':_0x1cd3cc,'master_shop':_0x11c6f6,'language':_0x16d1d2});}catch(_0x109b23){console[_0xad98bb(0x131)](_0x109b23);}});async function getRandom8DigitNumber(){var _0xba3f1a=a0_0x2a3f2d;const _0x39e67a=0x989680,_0xb3d5bf=0x5f5e0ff,_0x913350=Math[_0xba3f1a(0x16c)](Math[_0xba3f1a(0x18c)]()*(_0xb3d5bf-_0x39e67a+0x1))+_0x39e67a;var _0x249c5c;const _0x1a2a71=await sales_finished[_0xba3f1a(0x1dc)]({'invoice':_0xba3f1a(0x145)+_0x913350});return _0x1a2a71&&_0x1a2a71[_0xba3f1a(0x1f9)]>0x0?_0x249c5c='OUTF-'+_0x913350:_0x249c5c=_0xba3f1a(0x145)+_0x913350,_0x249c5c;}function a0_0x3943(_0x590b2d,_0x3d72b8){var _0x3c71c4=a0_0x3c71();return a0_0x3943=function(_0x3943bb,_0x54786a){_0x3943bb=_0x3943bb-0xe2;var _0x49b90d=_0x3c71c4[_0x3943bb];return _0x49b90d;},a0_0x3943(_0x590b2d,_0x3d72b8);}router[a0_0x2a3f2d(0x14e)](a0_0x2a3f2d(0x1f5),auth,async(_0x176a81,_0x4a2c0f)=>{var _0x437b0a=a0_0x2a3f2d;try{const {username:_0x2f5698,email:_0x5aa8d2,role:_0x247e0c}=_0x176a81[_0x437b0a(0x118)],_0x1fffcc=_0x176a81[_0x437b0a(0x118)],_0xbce58b=await profile[_0x437b0a(0x1dc)]({'email':_0x1fffcc[_0x437b0a(0xff)]}),_0x5d19a1=await master_shop['find'](),_0x27230b=await customer['find']({});let _0x4b5edd;if(_0x1fffcc[_0x437b0a(0x1ca)]==_0x437b0a(0x1fa)){const _0x25fa91=await staff[_0x437b0a(0x1dc)]({'email':_0x1fffcc[_0x437b0a(0xff)]});_0x4b5edd=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x25fa91[_0x437b0a(0x200)],'warehouse_category':_0x437b0a(0x182),'name':{'$ne':_0x437b0a(0x1bf)}}},{'$group':{'_id':_0x437b0a(0x144),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x4b5edd=await warehouse[_0x437b0a(0x168)]([{'$match':{'status':_0x437b0a(0x1cf),'warehouse_category':_0x437b0a(0x182),'name':{'$ne':_0x437b0a(0x1bf)}}},{'$group':{'_id':_0x437b0a(0x144),'name':{'$first':_0x437b0a(0x144)}}},{'$sort':{'name':0x1}}]);const _0x2f0530=await product['find']({});var _0x17859b=[_0x437b0a(0x1f2),'Enclosed'];const _0x365cf8=await sales_finished[_0x437b0a(0x13b)]({}),_0x301330=_0x365cf8[_0x437b0a(0x1f9)]+0x1,_0x4b3613='OUTF-'+_0x301330[_0x437b0a(0x1b1)]()[_0x437b0a(0x130)](0x5,'0');if(_0x5d19a1[0x0][_0x437b0a(0x1fc)]==_0x437b0a(0x1f7)){var _0x3f1c8b=users[_0x437b0a(0x1ec)];console[_0x437b0a(0x131)](_0x3f1c8b);}else{if(_0x5d19a1[0x0][_0x437b0a(0x1fc)]==_0x437b0a(0x15a))var _0x3f1c8b=users[_0x437b0a(0x15a)];else{if(_0x5d19a1[0x0]['language']=='German')var _0x3f1c8b=users[_0x437b0a(0x1e0)];else{if(_0x5d19a1[0x0][_0x437b0a(0x1fc)]==_0x437b0a(0x1f4))var _0x3f1c8b=users['Spanish'];else{if(_0x5d19a1[0x0][_0x437b0a(0x1fc)]==_0x437b0a(0x1bd))var _0x3f1c8b=users['French'];else{if(_0x5d19a1[0x0][_0x437b0a(0x1fc)]==_0x437b0a(0x126))var _0x3f1c8b=users[_0x437b0a(0x146)];else{if(_0x5d19a1[0x0][_0x437b0a(0x1fc)]=='Chinese')var _0x3f1c8b=users[_0x437b0a(0x158)];else{if(_0x5d19a1[0x0][_0x437b0a(0x1fc)]==_0x437b0a(0x19c))var _0x3f1c8b=users[_0x437b0a(0x1f3)];}}}}}}}const _0x38e5eb=getRandom8DigitNumber();_0x38e5eb['then'](_0x1f4c74=>{var _0x3764a9=_0x437b0a;_0x4a2c0f[_0x3764a9(0x17c)](_0x3764a9(0x116),{'success':_0x176a81[_0x3764a9(0x1d4)](_0x3764a9(0xf9)),'errors':_0x176a81[_0x3764a9(0x1d4)](_0x3764a9(0x120)),'role':_0x1fffcc,'profile':_0xbce58b,'customer':_0x27230b,'warehouse':_0x4b5edd,'product':_0x2f0530,'invoice':_0x1f4c74,'master_shop':_0x5d19a1,'language':_0x3f1c8b,'rooms_data':_0x17859b});})[_0x437b0a(0x102)](_0x5607af=>{var _0x4b35b3=_0x437b0a;_0x176a81[_0x4b35b3(0x1d4)](_0x4b35b3(0x120),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x4a2c0f[_0x4b35b3(0x1aa)]('/all_sales_finished/view');});}catch(_0x703525){console[_0x437b0a(0x131)](_0x703525);}}),router[a0_0x2a3f2d(0x14e)](a0_0x2a3f2d(0xed),auth,async(_0x15040a,_0x4eebd5)=>{var _0x15a630=a0_0x2a3f2d;try{const _0x2a985b=_0x15040a[_0x15a630(0x196)]['id'];console[_0x15a630(0x131)](_0x2a985b);const _0x69b4a=await product['find'](),_0x3aa1d0=await purchases[_0x15a630(0x168)]([{'$match':{'warehouse_name':_0x2a985b}},{'$unwind':'$product'},{'$group':{'_id':_0x15a630(0x180)}}]);console[_0x15a630(0x131)](_0x15a630(0x10f),_0x3aa1d0),_0x4eebd5['status'](0xc8)['json']({'purchases_data':_0x3aa1d0,'product_data':_0x69b4a});}catch(_0x47e5c0){console[_0x15a630(0x131)](_0x47e5c0);}}),router[a0_0x2a3f2d(0x12b)](a0_0x2a3f2d(0x186),auth,async(_0x5340d8,_0x259d44)=>{var _0x410505=a0_0x2a3f2d;try{const {warehouse_data:_0x36207d,product_data:_0x481e70}=_0x5340d8[_0x410505(0x121)];console[_0x410505(0x131)](_0x5340d8['body'][_0x410505(0x1b0)]);;const _0x580473=await master_shop[_0x410505(0x13b)]();console[_0x410505(0x131)](_0x410505(0x1f6),_0x580473);const _0x2d7da3=await product[_0x410505(0x1dc)]({'name':_0x481e70});console[_0x410505(0x131)]('product',_0x2d7da3);const _0x58de7c=await warehouse[_0x410505(0x168)]([{'$match':{'name':_0x36207d}},{'$unwind':_0x410505(0xf7)},{'$match':{'product_details.product_name':_0x481e70}},{'$group':{'_id':_0x410505(0x16a),'product_stock':{'$first':_0x410505(0x1a3)}}}]);console[_0x410505(0x131)]('stock_data',_0x58de7c),_0x259d44[_0x410505(0x19d)](0xc8)[_0x410505(0x1ef)]({'master':_0x580473,'new_product':_0x2d7da3,'stock_data':_0x58de7c});}catch(_0x3ade67){console[_0x410505(0x131)](_0x3ade67);}}),router[a0_0x2a3f2d(0x12b)](a0_0x2a3f2d(0x1f5),auth,async(_0xe84da5,_0x3c9367)=>{var _0x1e2f15=a0_0x2a3f2d;try{const {invoice:_0x3281a7,date:_0x3b4a9c,warehouse_name:_0x3a02ad,product_name:_0x148be3,stock:_0x8cb394,quantity:_0x524b3d,note:_0x19fa74,room:_0x102142,primary_code:_0x41b7c0,secondary_code:_0x193a2b,prod_code:_0x465941,level:_0x43b8ce,isle:_0x1b0aa8,pallet:_0x3dab87,batch_code:_0x4a9f37,SCRN:_0x5850f8,expiry_date:_0x2ef0a2,mode_transpo:_0x13f233,name_driver:_0x416a4a}=_0xe84da5[_0x1e2f15(0x121)];if(typeof _0x148be3==_0x1e2f15(0x187))var _0x461f8d=[_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0xe3)]],_0xfc529c=[_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x177)]],_0x3a0167=[_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x165)]],_0x2d23bf=[_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x1b9)]],_0x5b41be=[_0xe84da5[_0x1e2f15(0x121)]['secondary_code']],_0x2ea7bf=[_0xe84da5[_0x1e2f15(0x121)]['prod_code']],_0x4e8838=[_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x12c)]],_0x4df478=[_0xe84da5[_0x1e2f15(0x121)]['primary_unit']],_0x400ed8=[_0xe84da5['body'][_0x1e2f15(0x1e9)]],_0x14a6ef=[_0xe84da5['body'][_0x1e2f15(0x11d)]],_0x25d502=[_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x16b)]],_0x393b2a=[_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x18f)]],_0x3c3424=[_0xe84da5['body']['max_per_unit']],_0x467c2b=[_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x111)]],_0x518437=[_0xe84da5[_0x1e2f15(0x121)]['RoomAssigned']],_0x5c7444=[_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x141)]],_0x1c19c6=[_0xe84da5['body'][_0x1e2f15(0x1ba)]];else var _0x461f8d=[..._0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0xe3)]],_0xfc529c=[..._0xe84da5[_0x1e2f15(0x121)]['stock']],_0x3a0167=[..._0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x165)]],_0x2d23bf=[..._0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x1b9)]],_0x5b41be=[..._0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x151)]],_0x2ea7bf=[..._0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x171)]],_0x4e8838=[..._0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x12c)]],_0x4df478=[..._0xe84da5['body'][_0x1e2f15(0xe8)]],_0x400ed8=[..._0xe84da5['body'][_0x1e2f15(0x1e9)]],_0x14a6ef=[..._0xe84da5[_0x1e2f15(0x121)]['batch_code']],_0x25d502=[..._0xe84da5['body']['expiry_date']],_0x393b2a=[..._0xe84da5['body'][_0x1e2f15(0x18f)]],_0x3c3424=[..._0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x106)]],_0x467c2b=[..._0xe84da5[_0x1e2f15(0x121)]['prod_cat']],_0x518437=[..._0xe84da5[_0x1e2f15(0x121)]['RoomAssigned']],_0x5c7444=[..._0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x141)]],_0x1c19c6=[..._0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x1ba)]];const _0x24adcf=_0x461f8d[_0x1e2f15(0x137)](_0x45d3a9=>{return _0x45d3a9={'product_name':_0x45d3a9};});_0xfc529c[_0x1e2f15(0x1a4)]((_0x59f7d0,_0x33c2fc)=>{var _0xdede0b=_0x1e2f15;_0x24adcf[_0x33c2fc][_0xdede0b(0x177)]=_0x59f7d0;}),_0x3a0167[_0x1e2f15(0x1a4)]((_0x51c8ad,_0x1bec8b)=>{var _0x3fcff8=_0x1e2f15;_0x24adcf[_0x1bec8b][_0x3fcff8(0xe4)]=Math[_0x3fcff8(0x1fd)](_0x51c8ad);}),_0x1c19c6[_0x1e2f15(0x1a4)]((_0x2a5301,_0x3b55ab)=>{_0x24adcf[_0x3b55ab]['id_transaction_from']=_0x2a5301;}),_0x2d23bf['forEach']((_0x2f3bff,_0x2cbf58)=>{var _0x50234d=_0x1e2f15;_0x24adcf[_0x2cbf58][_0x50234d(0x1b9)]=_0x2f3bff;}),_0x5b41be['forEach']((_0x202d4b,_0x31217a)=>{_0x24adcf[_0x31217a]['secondary_code']=_0x202d4b;}),_0x2ea7bf[_0x1e2f15(0x1a4)]((_0x513481,_0x1968fd)=>{var _0x351a7f=_0x1e2f15;_0x24adcf[_0x1968fd][_0x351a7f(0x181)]=_0x513481;}),_0x4e8838[_0x1e2f15(0x1a4)]((_0x2c6536,_0x2b6159)=>{var _0x53c620=_0x1e2f15;_0x24adcf[_0x2b6159][_0x53c620(0x1e8)]=_0x2c6536;}),_0x4df478['forEach']((_0xec8e72,_0x3a6113)=>{var _0x343b4c=_0x1e2f15;_0x24adcf[_0x3a6113][_0x343b4c(0x159)]=_0xec8e72;}),_0x400ed8['forEach']((_0x1a7f9f,_0x1b41c2)=>{_0x24adcf[_0x1b41c2]['secondary_unit']=_0x1a7f9f;}),_0x14a6ef['forEach']((_0x2f6460,_0xdd2ef7)=>{var _0x73a73d=_0x1e2f15;_0x24adcf[_0xdd2ef7][_0x73a73d(0x11d)]=_0x2f6460;}),_0x25d502[_0x1e2f15(0x1a4)]((_0x20d285,_0x25fd51)=>{var _0x2a5fa6=_0x1e2f15;_0x24adcf[_0x25fd51][_0x2a5fa6(0x16b)]=_0x20d285;}),_0x393b2a[_0x1e2f15(0x1a4)]((_0x1201bc,_0x5843d7)=>{var _0x4dd9c4=_0x1e2f15;_0x24adcf[_0x5843d7][_0x4dd9c4(0x1e6)]=_0x1201bc;}),_0x3c3424['forEach']((_0x374a76,_0x5ddb96)=>{var _0x1eed5a=_0x1e2f15;_0x24adcf[_0x5ddb96][_0x1eed5a(0xf2)]=_0x374a76;}),_0x467c2b[_0x1e2f15(0x1a4)]((_0x12d442,_0x3f0261)=>{var _0x4ea794=_0x1e2f15;_0x24adcf[_0x3f0261][_0x4ea794(0x111)]=_0x12d442;}),_0x518437[_0x1e2f15(0x1a4)]((_0x2f35a5,_0x243466)=>{_0x24adcf[_0x243466]['room_name']=_0x2f35a5;}),_0x5c7444[_0x1e2f15(0x1a4)]((_0x13bdf2,_0x1092a5)=>{var _0x2bd66e=_0x1e2f15;_0x24adcf[_0x1092a5][_0x2bd66e(0x178)]=_0x13bdf2;});var _0x3cf5fa=0x0;_0x24adcf[_0x1e2f15(0x1a4)](_0x417ca9=>{var _0x75480b=_0x1e2f15;parseFloat(_0x417ca9[_0x75480b(0x177)])<parseFloat(_0x417ca9['quantity'])&&parseFloat(_0x417ca9[_0x75480b(0xe4)])>parseFloat(_0x417ca9[_0x75480b(0x177)])&&(console[_0x75480b(0x131)](_0x417ca9['stock']+_0x75480b(0x13c)+_0x417ca9[_0x75480b(0xe4)]),_0x3cf5fa++);});if(_0x3cf5fa!=0x0)return _0xe84da5[_0x1e2f15(0x1d4)](_0x1e2f15(0x120),_0x1e2f15(0x139)),_0x3c9367[_0x1e2f15(0x1aa)](_0x1e2f15(0x197));const _0x399071=_0x24adcf[_0x1e2f15(0x1bb)](_0x47f9a6=>_0x47f9a6[_0x1e2f15(0xe4)]!=='0'&&_0x47f9a6[_0x1e2f15(0xe4)]!==''),_0x40537b=new sales_finished({'invoice':_0x3281a7,'customer':_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x114)],'date':_0x3b4a9c,'warehouse_name':_0x3a02ad,'sale_product':_0x399071,'note':_0x19fa74,'room':_0x102142,'primary_code':_0x41b7c0,'secondary_code':_0x193a2b,'prod_code':_0x465941,'SCRN':_0x5850f8,'finalize':_0x1e2f15(0x18d),'mode_transpo':_0x13f233,'name_driver':_0x416a4a}),_0x2b9e26=await _0x40537b['save'](),_0x41e945=await sales_finished[_0x1e2f15(0x1dc)]({'invoice':_0x3281a7}),_0x4abbf3=new c_payment_data({'invoice':_0x3281a7,'customer':_0xe84da5[_0x1e2f15(0x121)][_0x1e2f15(0x114)],'reason':_0x1e2f15(0x1a0)});await _0x4abbf3[_0x1e2f15(0x1d7)]();const _0x4b3133=await master_shop[_0x1e2f15(0x13b)](),_0x4a287e=await email_settings[_0x1e2f15(0x1dc)](),_0x2fd882=await customer['findOne']({'name':_0xe84da5[_0x1e2f15(0x121)]['customer']});_0x4b3133[0x0][_0x1e2f15(0x161)]==0x1?(right_currency=_0x4b3133[0x0][_0x1e2f15(0x122)],left_currency=''):(right_currency='',left_currency=_0x4b3133[0x0]['currency']);var _0x5426fa=_0x461f8d,_0x43eeec=_0x3a0167,_0xb309ed='',_0x591695;for(_0x591695 in _0x5426fa){_0xb309ed+=_0x1e2f15(0x1b3)+_0x1e2f15(0x117)+_0x5426fa[_0x591695]+_0x1e2f15(0x135)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x43eeec[_0x591695]+_0x1e2f15(0x135)+_0x1e2f15(0x15b);}console[_0x1e2f15(0x131)](_0x1e2f15(0x14c),_0xb309ed);let _0x572027=nodemailer['createTransport']({'host':_0x4a287e[_0x1e2f15(0x163)],'port':Number(_0x4a287e[_0x1e2f15(0x1fe)]),'secure':![],'service':_0x1e2f15(0x1c0),'auth':{'user':_0x4a287e['email'],'pass':_0x4a287e['password']}}),_0x153c3f={'from':_0x4a287e[_0x1e2f15(0xff)],'to':_0x1e2f15(0x123),'subject':'Add\x20Sales','attachments':[{'filename':_0x1e2f15(0x134),'path':__dirname+_0x1e2f15(0x195)+_0x1e2f15(0x115)+_0x4b3133[0x0][_0x1e2f15(0xeb)],'cid':_0x1e2f15(0x15f)}],'html':_0x1e2f15(0x1b6)};_0x572027[_0x1e2f15(0x140)](_0x153c3f,function(_0x2c20aa,_0x374790){var _0x1f91b3=_0x1e2f15;_0x2c20aa?(console['log'](_0x2c20aa),console[_0x1f91b3(0x131)](_0x1f91b3(0xf1))):console[_0x1f91b3(0x131)](_0x1f91b3(0xe9));}),_0xe84da5[_0x1e2f15(0x1d4)](_0x1e2f15(0xf9),_0x1e2f15(0xf8)),_0x3c9367[_0x1e2f15(0x1aa)]('/all_sales_finished/preview/'+_0x2b9e26[_0x1e2f15(0x190)]);}catch(_0x4aa51b){console[_0x1e2f15(0x131)](_0x4aa51b);}}),router[a0_0x2a3f2d(0x14e)]('/preview/:id',auth,async(_0x4beddf,_0x158553)=>{var _0x5e8330=a0_0x2a3f2d;try{const {username:_0x51bf1f,email:_0x1734c9,role:_0xa2acb7}=_0x4beddf[_0x5e8330(0x118)],_0x1f8ce7=_0x4beddf[_0x5e8330(0x118)],_0x3c93b0=await profile[_0x5e8330(0x1dc)]({'email':_0x1f8ce7[_0x5e8330(0xff)]}),_0x3afff4=await master_shop[_0x5e8330(0x13b)](),_0x270ef8=_0x4beddf[_0x5e8330(0x196)]['id'],_0xd41f3d=await sales_finished['findById'](_0x270ef8),_0x3939aa=await warehouse['aggregate']([{'$match':{'name':_0xd41f3d[_0x5e8330(0x11e)]}},{'$unwind':_0x5e8330(0xf7)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5e8330(0x16a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5e8330(0xe7)},'bin':{'$first':_0x5e8330(0x14b)},'type':{'$first':_0x5e8330(0x170)},'floorlevel':{'$first':_0x5e8330(0x1c5)},'primary_code':{'$first':_0x5e8330(0x143)},'secondary_code':{'$first':_0x5e8330(0x175)},'product_code':{'$first':_0x5e8330(0x1b2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5e8330(0x1e7)},'expiry_date':{'$first':_0x5e8330(0x125)},'production_date':{'$first':_0x5e8330(0x147)},'batch_code':{'$first':_0x5e8330(0x129)},'room':{'$first':'$room'},'room_data':{'$first':_0x5e8330(0x156)}}}]),_0x2eb824=await customer[_0x5e8330(0x13b)]({});let _0x3437ea;if(_0x1f8ce7['role']==_0x5e8330(0x1fa)){const _0x1441cd=await staff[_0x5e8330(0x1dc)]({'email':_0x1f8ce7[_0x5e8330(0xff)]});_0x3437ea=await warehouse[_0x5e8330(0x168)]([{'$match':{'status':_0x5e8330(0x1cf),'name':_0x1441cd[_0x5e8330(0x200)]}},{'$group':{'_id':_0x5e8330(0x144),'name':{'$first':_0x5e8330(0x144)}}}]);}else _0x3437ea=await warehouse['aggregate']([{'$match':{'status':_0x5e8330(0x1cf)}},{'$group':{'_id':_0x5e8330(0x144),'name':{'$first':_0x5e8330(0x144)}}}]);const _0x37245a=await product[_0x5e8330(0x13b)]({});if(_0x3afff4[0x0][_0x5e8330(0x1fc)]==_0x5e8330(0x1f7)){var _0x4a0449=users[_0x5e8330(0x1ec)];console[_0x5e8330(0x131)](_0x4a0449);}else{if(_0x3afff4[0x0][_0x5e8330(0x1fc)]==_0x5e8330(0x15a))var _0x4a0449=users[_0x5e8330(0x15a)];else{if(_0x3afff4[0x0][_0x5e8330(0x1fc)]==_0x5e8330(0x1e0))var _0x4a0449=users[_0x5e8330(0x1e0)];else{if(_0x3afff4[0x0]['language']==_0x5e8330(0x1f4))var _0x4a0449=users[_0x5e8330(0x1f4)];else{if(_0x3afff4[0x0][_0x5e8330(0x1fc)]==_0x5e8330(0x1bd))var _0x4a0449=users[_0x5e8330(0x1bd)];else{if(_0x3afff4[0x0][_0x5e8330(0x1fc)]==_0x5e8330(0x126))var _0x4a0449=users[_0x5e8330(0x146)];else{if(_0x3afff4[0x0]['language']==_0x5e8330(0x158))var _0x4a0449=users[_0x5e8330(0x158)];else{if(_0x3afff4[0x0]['language']==_0x5e8330(0x19c))var _0x4a0449=users[_0x5e8330(0x1f3)];}}}}}}}_0x158553[_0x5e8330(0x17c)](_0x5e8330(0x1d2),{'success':_0x4beddf[_0x5e8330(0x1d4)](_0x5e8330(0xf9)),'errors':_0x4beddf[_0x5e8330(0x1d4)]('errors'),'role':_0x1f8ce7,'profile':_0x3c93b0,'customer':_0x2eb824,'warehouse':_0x3437ea,'product':_0x3939aa,'user':_0xd41f3d,'master_shop':_0x3afff4,'unit':_0x37245a,'language':_0x4a0449});}catch(_0x18980d){console['log'](_0x18980d);}}),router[a0_0x2a3f2d(0x12b)](a0_0x2a3f2d(0x133),auth,async(_0x43a174,_0x143671)=>{var _0x2a72fa=a0_0x2a3f2d;try{const _0x178271=_0x43a174[_0x2a72fa(0x196)]['id'],{invoice:_0x151313,warehouse_name:_0x2d9875,room:_0x39c28b}=_0x43a174[_0x2a72fa(0x121)],_0x40e7b8=await sales_finished[_0x2a72fa(0x1dc)]({'invoice':_0x151313}),_0x48678e=_0x40e7b8[_0x2a72fa(0x1df)][_0x2a72fa(0x137)](async _0x4a2f6=>{var _0x52f77c=_0x2a72fa,_0x205dc9=await warehouse[_0x52f77c(0x1dc)]({'name':_0x2d9875,'room':_0x4a2f6[_0x52f77c(0x1db)],'warehouse_category':_0x52f77c(0x182)});const _0x566055=_0x205dc9[_0x52f77c(0x13f)][_0x52f77c(0x137)](_0x3d0ce9=>{var _0x4b47f7=_0x52f77c;(_0x3d0ce9[_0x4b47f7(0xe3)]==_0x4a2f6[_0x4b47f7(0xe3)]&&_0x3d0ce9['bay']==_0x4a2f6[_0x4b47f7(0x1e8)]&&_0x3d0ce9['expiry_date']==_0x4a2f6[_0x4b47f7(0x16b)]&&_0x3d0ce9[_0x4b47f7(0x1e6)]==_0x4a2f6[_0x4b47f7(0x1e6)]&&_0x3d0ce9[_0x4b47f7(0x11d)]==_0x4a2f6['batch_code']&&_0x3d0ce9[_0x4b47f7(0x178)]==_0x4a2f6[_0x4b47f7(0x178)]||_0x3d0ce9[_0x4b47f7(0x190)]==_0x4a2f6[_0x4b47f7(0x1ba)])&&(_0x3d0ce9['product_stock']>0x0&&(console[_0x4b47f7(0x131)](_0x3d0ce9[_0x4b47f7(0xe3)]+_0x4b47f7(0x105)+_0x4a2f6[_0x4b47f7(0xe3)]+'\x20&&\x20'+_0x3d0ce9[_0x4b47f7(0x1e8)]+_0x4b47f7(0x105)+_0x4a2f6[_0x4b47f7(0x1e8)]+_0x4b47f7(0xfe)+_0x3d0ce9[_0x4b47f7(0x1e6)]+_0x4b47f7(0x105)+_0x4a2f6[_0x4b47f7(0x1e6)]+_0x4b47f7(0xfe)+_0x3d0ce9[_0x4b47f7(0x16b)]+_0x4b47f7(0x105)+_0x4a2f6['expiry_date']+_0x4b47f7(0xfe)+_0x3d0ce9[_0x4b47f7(0x11d)]+_0x4b47f7(0x105)+_0x4a2f6[_0x4b47f7(0x11d)]+_0x4b47f7(0xfe)+_0x3d0ce9[_0x4b47f7(0x178)]+'\x20==\x20'+_0x4a2f6['invoice']+_0x4b47f7(0xfe)+_0x3d0ce9[_0x4b47f7(0x166)]+'\x20<<<==>>>\x20'+_0x4a2f6['quantity']+'\x20>>>\x20'+_0x4a2f6[_0x4b47f7(0x1db)]+_0x4b47f7(0xfe)+_0x3d0ce9[_0x4b47f7(0x190)]+'\x20==\x20'+_0x4a2f6[_0x4b47f7(0x1ba)]),_0x3d0ce9[_0x4b47f7(0x166)]=Math[_0x4b47f7(0x194)](0x0,Math[_0x4b47f7(0x1fd)](_0x3d0ce9[_0x4b47f7(0x166)])-Math[_0x4b47f7(0x1fd)](_0x4a2f6[_0x4b47f7(0xe4)]))));});return _0x205dc9;});Promise['all'](_0x48678e)[_0x2a72fa(0x10c)](async _0x4d8c3f=>{var _0x1e3053=_0x2a72fa;try{for(const _0x3a03bf of _0x4d8c3f){await _0x3a03bf[_0x1e3053(0x1d7)]();}_0x40e7b8[_0x1e3053(0x1c1)]=_0x1e3053(0x176);const _0x1fa6b9=await _0x40e7b8[_0x1e3053(0x1d7)](),_0x456499=await master_shop[_0x1e3053(0x13b)](),_0x47953f=await email_settings[_0x1e3053(0x1dc)](),_0x5b2edf=await supervisor_settings[_0x1e3053(0x13b)]();var _0x5ba32c=_0x40e7b8[_0x1e3053(0x1df)],_0x4e0bd6='',_0x20bb4a;for(_0x20bb4a in _0x5ba32c){var _0x1b3cd7='FG';_0x40e7b8[_0x1e3053(0x11e)]=='DRY\x20GOODS'&&(_0x1b3cd7='DG'),_0x4e0bd6+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5ba32c[_0x20bb4a][_0x1e3053(0xe3)]+'</td>'+_0x1e3053(0x117)+_0x5ba32c[_0x20bb4a][_0x1e3053(0x181)]+_0x1e3053(0x135)+_0x1e3053(0x117)+_0x5ba32c[_0x20bb4a]['quantity']+_0x1e3053(0x135)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5ba32c[_0x20bb4a][_0x1e3053(0x159)]+'</td>'+_0x1e3053(0x117)+_0x5ba32c[_0x20bb4a][_0x1e3053(0x1e9)]+_0x1e3053(0x135)+_0x1e3053(0x117)+_0x40e7b8['warehouse_name']+_0x1e3053(0x135)+_0x1e3053(0x117)+_0x5ba32c[_0x20bb4a][_0x1e3053(0x1db)]+_0x1e3053(0x135)+_0x1e3053(0x117)+_0x1b3cd7+_0x5ba32c[_0x20bb4a][_0x1e3053(0x1e8)]+_0x1e3053(0x135);}let _0x38f4f7=nodemailer[_0x1e3053(0x173)]({'host':_0x47953f[_0x1e3053(0x163)],'port':Number(_0x47953f[_0x1e3053(0x1fe)]),'secure':![],'auth':{'user':_0x47953f[_0x1e3053(0xff)],'pass':_0x47953f[_0x1e3053(0x192)]}}),_0x185d4f={'from':_0x47953f['email'],'to':_0x5b2edf[0x0][_0x1e3053(0x18a)],'subject':'Sales\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x1e3053(0x195)+'/upload/'+_0x456499[0x0][_0x1e3053(0xeb)],'cid':_0x1e3053(0x15f)}],'html':_0x1e3053(0xfd)+_0x1e3053(0x12d)+_0x1e3053(0x138)+_0x1e3053(0x1a7)+_0x1e3053(0x162)+_0x1e3053(0x1a7)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1e3053(0x1ab)+_0x1e3053(0x1a7)+_0x1e3053(0x16e)+_0x456499[0x0]['site_title']+'\x20</h2>'+_0x1e3053(0x1ab)+_0x1e3053(0x1ab)+_0x1e3053(0x109)+_0x1e3053(0x1a7)+_0x1e3053(0x179)+_0x1e3053(0xf4)+_0x40e7b8[_0x1e3053(0x178)]+'\x20'+_0x1e3053(0x1ac)+_0x1e3053(0x107)+_0x40e7b8['date']+'\x20'+_0x1e3053(0xf3)+'</h5>'+_0x1e3053(0x1ab)+_0x1e3053(0x172)+_0x1e3053(0x1d9)+'<tr>'+_0x1e3053(0x1be)+_0x1e3053(0x142)+_0x1e3053(0x11a)+_0x1e3053(0x1da)+_0x1e3053(0x198)+_0x1e3053(0x1b8)+_0x1e3053(0x18e)+_0x1e3053(0x1d0)+_0x1e3053(0x15b)+_0x1e3053(0x1de)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4e0bd6+'\x20'+_0x1e3053(0x1c4)+_0x1e3053(0x183)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x456499[0x0][_0x1e3053(0x1e3)]+_0x1e3053(0xe5)+_0x1e3053(0x1ab)+_0x1e3053(0x1ab)+'</body></html>'};_0x38f4f7[_0x1e3053(0x140)](_0x185d4f,function(_0x821013,_0x225872){var _0xfc1ec=_0x1e3053;_0x821013?(console[_0xfc1ec(0x131)](_0x821013),console[_0xfc1ec(0x131)](_0xfc1ec(0xf1))):console['log'](_0xfc1ec(0xe9));}),_0x43a174[_0x1e3053(0x1d4)](_0x1e3053(0xf9),_0x1e3053(0xfc)),_0x143671['redirect'](_0x1e3053(0x1e4)+_0x178271);}catch(_0x41ed8d){console[_0x1e3053(0x1c2)](_0x41ed8d),_0x143671[_0x1e3053(0x19d)](0x1f4)[_0x1e3053(0x1ef)]({'error':_0x1e3053(0x153)});}})[_0x2a72fa(0x102)](_0x53e7f3=>{var _0x4719a2=_0x2a72fa;console[_0x4719a2(0x1c2)](_0x53e7f3),_0x143671['status'](0x1f4)[_0x4719a2(0x1ef)]({'error':_0x4719a2(0x10b)});});}catch(_0x4783d8){console[_0x2a72fa(0x131)](_0x4783d8);}}),router[a0_0x2a3f2d(0x14e)]('/view/:id',auth,async(_0x29658b,_0x4d14f6)=>{var _0x572002=a0_0x2a3f2d;try{const {username:_0x121095,email:_0x157657,role:_0x56691c}=_0x29658b['user'],_0x111c29=_0x29658b[_0x572002(0x118)],_0x286914=await profile[_0x572002(0x1dc)]({'email':_0x111c29[_0x572002(0xff)]}),_0x4629f2=await master_shop[_0x572002(0x13b)](),_0xb960e=_0x29658b[_0x572002(0x196)]['id'],_0x21cb0a=await sales_finished['findById'](_0xb960e);let _0x8d80b0=new Date(_0x21cb0a['expiry_date']),_0x19f4e0=('0'+_0x8d80b0[_0x572002(0xf6)]())[_0x572002(0x1fb)](-0x2),_0x2a15bc=('0'+(_0x8d80b0['getMonth']()+0x1))[_0x572002(0x1fb)](-0x2),_0xbf7256=_0x8d80b0[_0x572002(0xe2)](),_0x29475d=_0xbf7256+'-'+_0x2a15bc+'-'+_0x19f4e0;var _0x227a4e=[_0x572002(0x1f2),_0x572002(0x1cb)];const _0x5efc3e=await warehouse[_0x572002(0x168)]([{'$match':{'name':_0x21cb0a[_0x572002(0x11e)],'room':_0x21cb0a[_0x572002(0xee)]}},{'$unwind':_0x572002(0xf7)},{'$group':{'_id':_0x572002(0x189),'name':{'$first':_0x572002(0x16a)},'product_stock':{'$first':_0x572002(0x1a3)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x572002(0x14b)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x572002(0x1c5)},'primary_code':{'$first':_0x572002(0x143)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x572002(0x1e7)}}}]),_0x2b78f0=await customer['find']({});let _0x29ae0e;if(_0x111c29[_0x572002(0x1ca)]==_0x572002(0x1fa)){const _0x2b398e=await staff[_0x572002(0x1dc)]({'email':_0x111c29['email']});_0x29ae0e=await warehouse[_0x572002(0x168)]([{'$match':{'status':_0x572002(0x1cf),'name':_0x2b398e['warehouse']}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x29ae0e=await warehouse[_0x572002(0x168)]([{'$match':{'status':_0x572002(0x1cf)}},{'$group':{'_id':_0x572002(0x144),'name':{'$first':'$name'}}}]);const _0x4e95f4=await product[_0x572002(0x13b)]({});if(_0x4629f2[0x0][_0x572002(0x1fc)]=='English\x20(US)'){var _0x519716=users[_0x572002(0x1ec)];console[_0x572002(0x131)](_0x519716);}else{if(_0x4629f2[0x0][_0x572002(0x1fc)]==_0x572002(0x15a))var _0x519716=users[_0x572002(0x15a)];else{if(_0x4629f2[0x0][_0x572002(0x1fc)]=='German')var _0x519716=users['German'];else{if(_0x4629f2[0x0][_0x572002(0x1fc)]==_0x572002(0x1f4))var _0x519716=users[_0x572002(0x1f4)];else{if(_0x4629f2[0x0][_0x572002(0x1fc)]==_0x572002(0x1bd))var _0x519716=users[_0x572002(0x1bd)];else{if(_0x4629f2[0x0][_0x572002(0x1fc)]==_0x572002(0x126))var _0x519716=users[_0x572002(0x146)];else{if(_0x4629f2[0x0][_0x572002(0x1fc)]==_0x572002(0x158))var _0x519716=users[_0x572002(0x158)];else{if(_0x4629f2[0x0][_0x572002(0x1fc)]==_0x572002(0x19c))var _0x519716=users[_0x572002(0x1f3)];}}}}}}}_0x4d14f6['render'](_0x572002(0x148),{'success':_0x29658b[_0x572002(0x1d4)](_0x572002(0xf9)),'errors':_0x29658b[_0x572002(0x1d4)]('errors'),'role':_0x111c29,'profile':_0x286914,'customer':_0x2b78f0,'warehouse':_0x29ae0e,'product':_0x5efc3e,'user':_0x21cb0a,'master_shop':_0x4629f2,'unit':_0x4e95f4,'language':_0x519716,'rooms_data':_0x227a4e,'ed_fullDate':_0x29475d});}catch(_0x2a4348){console['log'](_0x2a4348);}}),router[a0_0x2a3f2d(0x12b)]('/view/:id',auth,async(_0x56d4e9,_0x5de433)=>{var _0x379477=a0_0x2a3f2d;try{const _0x326431=_0x56d4e9['params']['id'],_0x47895f=await sales_finished[_0x379477(0x1dc)]({'_id':_0x56d4e9[_0x379477(0x196)]['id']}),_0x2c9ae3=await warehouse['findOne']({'name':_0x47895f['warehouse_name'],'room':_0x56d4e9['body']['room'],'warehouse_category':_0x379477(0x182)}),{invoice:_0x4ac436,customer:_0x87b21a,date:_0x49a5be,warehouse_name:_0x9920dc,product_name:_0x3e1384,stock:_0x2446f1,adjust_qty:_0x4d8c31,note:_0x4c758c,room:_0x572d2b,primary_code:_0x478585,secondary_code:_0x71d01a,prod_code:_0xf1974f,level:_0x1e64f0,isle:_0x4e8fd4,pallet:_0x5a76d7,expiry_date:_0x3beac7}=_0x56d4e9[_0x379477(0x121)];if(typeof _0x3e1384=='string')var _0x21dcaf=[_0x56d4e9[_0x379477(0x121)][_0x379477(0xe3)]],_0x928414=[_0x56d4e9[_0x379477(0x121)]['stock']],_0x3a866e=[_0x56d4e9['body'][_0x379477(0x185)]],_0x2f57dc=[_0x56d4e9[_0x379477(0x121)][_0x379477(0x1b9)]],_0x32bb4a=[_0x56d4e9[_0x379477(0x121)][_0x379477(0x151)]],_0x565856=[_0x56d4e9[_0x379477(0x121)][_0x379477(0x171)]],_0x16e444=[_0x56d4e9[_0x379477(0x121)][_0x379477(0x12c)]],_0xc4b578=[_0x56d4e9['body'][_0x379477(0x16b)]];else var _0x21dcaf=[..._0x56d4e9['body']['product_name']],_0x928414=[..._0x56d4e9[_0x379477(0x121)][_0x379477(0x177)]],_0x3a866e=[..._0x56d4e9[_0x379477(0x121)][_0x379477(0x185)]],_0x2f57dc=[..._0x56d4e9[_0x379477(0x121)][_0x379477(0x1b9)]],_0x32bb4a=[..._0x56d4e9[_0x379477(0x121)]['secondary_code']],_0x565856=[..._0x56d4e9[_0x379477(0x121)][_0x379477(0x171)]],_0x16e444=[..._0x56d4e9[_0x379477(0x121)][_0x379477(0x12c)]],_0xc4b578=[..._0x56d4e9['body'][_0x379477(0x16b)]];const _0x2784d8=_0x21dcaf['map'](_0x26c7b4=>{return _0x26c7b4={'product_name':_0x26c7b4};});_0x928414['forEach']((_0x45fc75,_0x2e7451)=>{var _0x47cc61=_0x379477;_0x2784d8[_0x2e7451][_0x47cc61(0x177)]=_0x45fc75;}),_0x3a866e[_0x379477(0x1a4)]((_0x2913a3,_0x508c9e)=>{var _0x3eaedc=_0x379477;_0x2784d8[_0x508c9e][_0x3eaedc(0xe4)]=_0x2913a3;}),_0x2f57dc[_0x379477(0x1a4)]((_0x27ad38,_0x2c5ad3)=>{_0x2784d8[_0x2c5ad3]['primary_code']=_0x27ad38;}),_0x32bb4a['forEach']((_0x147aea,_0x27691a)=>{_0x2784d8[_0x27691a]['secondary_code']=_0x147aea;}),_0x565856[_0x379477(0x1a4)]((_0x412f2,_0x48a44b)=>{var _0x1d316d=_0x379477;_0x2784d8[_0x48a44b][_0x1d316d(0x181)]=_0x412f2;}),_0x16e444[_0x379477(0x1a4)]((_0x1ef61d,_0x3221a4)=>{var _0x36932b=_0x379477;_0x2784d8[_0x3221a4][_0x36932b(0x12c)]=_0x1ef61d;}),_0xc4b578['forEach']((_0x175b07,_0x148fbd)=>{var _0x4d0d99=_0x379477;_0x2784d8[_0x148fbd][_0x4d0d99(0x16b)]=_0x175b07;});var _0x132f5f=0x0;_0x2784d8[_0x379477(0x1a4)](_0x5bf835=>{var _0x43b6d4=_0x379477;console[_0x43b6d4(0x131)](_0x43b6d4(0x1f1),_0x5bf835),(parseInt(_0x5bf835[_0x43b6d4(0x177)])<parseInt(_0x5bf835['quantity'])||parseInt(_0x5bf835[_0x43b6d4(0xe4)])==0x0)&&_0x132f5f++;});if(_0x132f5f!=0x0)return _0x56d4e9[_0x379477(0x1d4)](_0x379477(0x120),_0x379477(0x12f)),_0x5de433[_0x379477(0x1aa)](_0x379477(0x197));_0x47895f[_0x379477(0x1df)]['forEach'](_0x1c211e=>{var _0x43b9e6=_0x379477;const _0x149066=_0x2c9ae3['product_details'][_0x43b9e6(0x137)](_0x1b1011=>{var _0x1ef303=_0x43b9e6;_0x1b1011[_0x1ef303(0xe3)]==_0x1c211e[_0x1ef303(0xe3)]&&_0x1b1011[_0x1ef303(0x1e8)]==_0x1c211e['bay']&&(_0x1b1011[_0x1ef303(0x166)]=parseInt(_0x1b1011['product_stock'])+parseInt(_0x1c211e[_0x1ef303(0xe4)]));});}),await _0x2c9ae3[_0x379477(0x1d7)]();const _0x36f9d1=_0x2784d8['filter'](_0x113758=>_0x113758[_0x379477(0xe4)]!=='0'&&_0x113758[_0x379477(0xe4)]!=='');_0x47895f[_0x379477(0x178)]=_0x4ac436,_0x47895f[_0x379477(0x114)]=_0x87b21a,_0x47895f['date']=_0x49a5be,_0x47895f[_0x379477(0x11e)]=_0x9920dc,_0x47895f[_0x379477(0x1df)]=_0x36f9d1,_0x47895f[_0x379477(0x1e5)]=_0x4c758c,_0x47895f[_0x379477(0xee)]=_0x572d2b;const _0x112e34=await _0x47895f[_0x379477(0x1d7)](),_0x234714=await sales_finished[_0x379477(0x1dc)]({'_id':_0x56d4e9['params']['id']}),_0x3e38f9=await warehouse['findOne']({'name':_0x9920dc,'room':_0x572d2b,'warehouse_category':_0x379477(0x182)});_0x234714[_0x379477(0x1df)][_0x379477(0x1a4)](_0x3c2b9c=>{var _0x5ac235=_0x379477;const _0x6e71a7=_0x3e38f9[_0x5ac235(0x13f)]['map'](_0x1a8f7f=>{var _0x503347=_0x5ac235;_0x1a8f7f[_0x503347(0xe3)]==_0x3c2b9c['product_name']&&_0x1a8f7f[_0x503347(0x1e8)]==_0x3c2b9c[_0x503347(0x1e8)]&&(_0x1a8f7f[_0x503347(0x166)]=parseInt(_0x1a8f7f[_0x503347(0x166)])-parseInt(_0x3c2b9c[_0x503347(0xe4)]));});}),console[_0x379477(0x131)](_0x379477(0x16f),_0x3e38f9),await _0x3e38f9[_0x379477(0x1d7)]();const _0x54a539=await c_payment_data[_0x379477(0x1dc)]({'invoice':_0x56d4e9[_0x379477(0x121)]['invoice']});_0x54a539[_0x379477(0x1a2)]=_0x56d4e9[_0x379477(0x121)][_0x379477(0x1a2)],await _0x54a539[_0x379477(0x1d7)](),_0x56d4e9[_0x379477(0x1d4)](_0x379477(0xf9),_0x379477(0xfc)),_0x5de433[_0x379477(0x1aa)](_0x379477(0x11c));}catch(_0x5deee){console[_0x379477(0x131)](_0x5deee);}}),router['post']('/give_payment/:id',auth,async(_0x5a4d30,_0x747534)=>{var _0x8accc0=a0_0x2a3f2d;try{const _0x35c545=_0x5a4d30[_0x8accc0(0x196)]['id'],{invoice:_0x41cd3e,customer:_0x53b9c6,receivable_amount:_0x312042,received_amount:_0x4fddb2}=_0x5a4d30[_0x8accc0(0x121)],_0x2a314b=await sales[_0x8accc0(0x128)](_0x35c545);console[_0x8accc0(0x131)](_0x2a314b);var _0x348adf=_0x312042-_0x4fddb2;console[_0x8accc0(0x131)](_0x4fddb2),_0x2a314b[_0x8accc0(0x19b)]=parseFloat(_0x4fddb2)+parseFloat(_0x2a314b[_0x8accc0(0x19b)]),_0x2a314b[_0x8accc0(0xef)]=_0x348adf,console[_0x8accc0(0x131)](_0x2a314b);const _0x2147a4=await _0x2a314b[_0x8accc0(0x1d7)](),_0x1c35aa=await c_payment_data[_0x8accc0(0x1dc)]({'invoice':_0x41cd3e});_0x1c35aa[_0x8accc0(0x108)]=_0x348adf,await _0x1c35aa[_0x8accc0(0x1d7)]();let _0x5b5188=new Date(),_0xf88497=('0'+_0x5b5188[_0x8accc0(0xf6)]())[_0x8accc0(0x1fb)](-0x2),_0x5061d8=('0'+(_0x5b5188[_0x8accc0(0x1c6)]()+0x1))['slice'](-0x2),_0x6bdbdb=_0x5b5188['getFullYear'](),_0x4f6cdf=_0x6bdbdb+'-'+_0x5061d8+'-'+_0xf88497;const _0x2d5356=new customer_payment({'invoice':_0x41cd3e,'date':_0x6bdbdb+'-'+_0x5061d8+'-'+_0xf88497,'customer':_0x53b9c6,'reason':_0x8accc0(0x1af),'amount':_0x4fddb2}),_0x173df4=await _0x2d5356['save']();_0x5a4d30[_0x8accc0(0x1d4)](_0x8accc0(0xf9),_0x8accc0(0x12a)),_0x747534[_0x8accc0(0x1aa)](_0x8accc0(0xf5));}catch(_0x16c003){console[_0x8accc0(0x131)](_0x16c003);}}),router[a0_0x2a3f2d(0x14e)](a0_0x2a3f2d(0x132),auth,async(_0x1ab9bb,_0x21e53e)=>{var _0x3e7d55=a0_0x2a3f2d;try{const {username:_0x201c0d,email:_0x241b9f,role:_0x247d20}=_0x1ab9bb[_0x3e7d55(0x118)],_0x4b348c=_0x1ab9bb[_0x3e7d55(0x118)],_0x20f905=await profile[_0x3e7d55(0x1dc)]({'email':_0x4b348c[_0x3e7d55(0xff)]}),_0x390599=await master_shop[_0x3e7d55(0x13b)]();console[_0x3e7d55(0x131)](_0x3e7d55(0x1f6),_0x390599);const _0x441086=_0x1ab9bb[_0x3e7d55(0x196)]['id'],_0x507f55=await sales['findById'](_0x441086);console[_0x3e7d55(0x131)](_0x507f55);const _0x43f40f=await customer['findOne']({'name':_0x507f55[_0x3e7d55(0x114)]});console['log'](_0x43f40f);if(_0x390599[0x0][_0x3e7d55(0x1fc)]=='English\x20(US)'){var _0x387e29=users[_0x3e7d55(0x1ec)];console[_0x3e7d55(0x131)](_0x387e29);}else{if(_0x390599[0x0][_0x3e7d55(0x1fc)]==_0x3e7d55(0x15a))var _0x387e29=users['Hindi'];else{if(_0x390599[0x0][_0x3e7d55(0x1fc)]==_0x3e7d55(0x1e0))var _0x387e29=users[_0x3e7d55(0x1e0)];else{if(_0x390599[0x0][_0x3e7d55(0x1fc)]==_0x3e7d55(0x1f4))var _0x387e29=users[_0x3e7d55(0x1f4)];else{if(_0x390599[0x0]['language']==_0x3e7d55(0x1bd))var _0x387e29=users[_0x3e7d55(0x1bd)];else{if(_0x390599[0x0][_0x3e7d55(0x1fc)]==_0x3e7d55(0x126))var _0x387e29=users[_0x3e7d55(0x146)];else{if(_0x390599[0x0]['language']==_0x3e7d55(0x158))var _0x387e29=users[_0x3e7d55(0x158)];else{if(_0x390599[0x0][_0x3e7d55(0x1fc)]==_0x3e7d55(0x19c))var _0x387e29=users[_0x3e7d55(0x1f3)];}}}}}}}_0x21e53e[_0x3e7d55(0x17c)](_0x3e7d55(0x19f),{'success':_0x1ab9bb['flash']('success'),'errors':_0x1ab9bb['flash']('errors'),'role':_0x4b348c,'profile':_0x20f905,'master_shop':_0x390599,'customers':_0x43f40f,'sales':_0x507f55,'language':_0x387e29});}catch(_0x37a881){console['log'](_0x37a881);}}),router[a0_0x2a3f2d(0x14e)](a0_0x2a3f2d(0x14d),auth,async(_0x1ef9b2,_0x473eca)=>{var _0x3e57f6=a0_0x2a3f2d;try{const {username:_0x53887f,email:_0x27b478,role:_0x37545d}=_0x1ef9b2[_0x3e57f6(0x118)],_0x3fabf4=_0x1ef9b2[_0x3e57f6(0x118)],_0x18a9e8=await profile[_0x3e57f6(0x1dc)]({'email':_0x3fabf4[_0x3e57f6(0xff)]}),_0x3aa54d=await master_shop['find'](),_0x1a0c00=_0x1ef9b2['params']['id'],_0x23276c=await sales_finished[_0x3e57f6(0x128)](_0x1a0c00),_0x1a2c2d=await warehouse[_0x3e57f6(0x168)]([{'$match':{'name':_0x23276c[_0x3e57f6(0x11e)]}},{'$unwind':_0x3e57f6(0xf7)},{'$group':{'_id':_0x3e57f6(0x189),'name':{'$first':_0x3e57f6(0x16a)},'product_stock':{'$first':_0x3e57f6(0x1a3)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x3e57f6(0x14b)},'type':{'$first':_0x3e57f6(0x170)},'floorlevel':{'$first':_0x3e57f6(0x1c5)},'primary_code':{'$first':_0x3e57f6(0x143)},'secondary_code':{'$first':_0x3e57f6(0x175)},'product_code':{'$first':_0x3e57f6(0x1b2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3e57f6(0x1e7)},'expiry_date':{'$first':_0x3e57f6(0x125)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0x3e57f6(0x1ae)},'secondary_unit':{'$first':_0x3e57f6(0x1ce)},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':_0x3e57f6(0x129)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x362a42=await product['find']({}),_0x78fb6=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0x3e57f6(0x154),'$ne':_0x3e57f6(0x1e1)}}},{'$group':{'_id':_0x3e57f6(0x144),'name':{'$first':_0x3e57f6(0x144)}}},{'$sort':{'name':0x1}}]);var _0x552713=[_0x3e57f6(0xf0)];const _0x4f7ab9=await warehouse['aggregate']([{'$match':{'status':_0x3e57f6(0x1cf),'name':'Quality\x20Inspection'}},{'$group':{'_id':'$name','name':{'$first':_0x3e57f6(0x144)}}},{'$sort':{'name':0x1}}]);if(_0x3aa54d[0x0]['language']==_0x3e57f6(0x1f7)){var _0x36b833=users[_0x3e57f6(0x1ec)];console[_0x3e57f6(0x131)](_0x36b833);}else{if(_0x3aa54d[0x0][_0x3e57f6(0x1fc)]==_0x3e57f6(0x15a))var _0x36b833=users[_0x3e57f6(0x15a)];else{if(_0x3aa54d[0x0]['language']==_0x3e57f6(0x1e0))var _0x36b833=users['German'];else{if(_0x3aa54d[0x0][_0x3e57f6(0x1fc)]==_0x3e57f6(0x1f4))var _0x36b833=users[_0x3e57f6(0x1f4)];else{if(_0x3aa54d[0x0]['language']==_0x3e57f6(0x1bd))var _0x36b833=users[_0x3e57f6(0x1bd)];else{if(_0x3aa54d[0x0][_0x3e57f6(0x1fc)]==_0x3e57f6(0x126))var _0x36b833=users[_0x3e57f6(0x146)];else{if(_0x3aa54d[0x0][_0x3e57f6(0x1fc)]==_0x3e57f6(0x158))var _0x36b833=users['Chinese'];else{if(_0x3aa54d[0x0][_0x3e57f6(0x1fc)]=='Arabic\x20(ae)')var _0x36b833=users[_0x3e57f6(0x1f3)];}}}}}}}_0x473eca[_0x3e57f6(0x17c)](_0x3e57f6(0x10a),{'success':_0x1ef9b2[_0x3e57f6(0x1d4)](_0x3e57f6(0xf9)),'errors':_0x1ef9b2['flash'](_0x3e57f6(0x120)),'role':_0x3fabf4,'profile':_0x18a9e8,'user':_0x23276c,'stock':_0x1a2c2d,'master_shop':_0x3aa54d,'unit':_0x362a42,'language':_0x36b833,'warehouses':_0x78fb6,'rooms':_0x552713,'warehouse_QA':_0x4f7ab9});}catch(_0x4d358e){console[_0x3e57f6(0x131)](_0x4d358e),_0x473eca[_0x3e57f6(0x19d)](0xc8)[_0x3e57f6(0x1ef)]({'message':_0x4d358e[_0x3e57f6(0x15c)]});}}),router['post'](a0_0x2a3f2d(0x14d),auth,async(_0x180ed0,_0x45e070)=>{var _0xa3e67b=a0_0x2a3f2d;if(_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x150)]=='QA')try{const {invoice:_0x5e5fb3,date:_0x682594,warehouse_name:_0x36fa0e,product_name:_0x40d522,primary_code:_0x26a581,secondary_code:_0x4992b2,product_code:_0x4306c3,sales_quantity:_0x4511ae,stocks:_0x1695f8,return_qty:_0x5a129c,Room_name:_0x4bcad9,to_warehouse_name_QA:_0x298d71,to_Room_name_QA:_0x3097fe,note:_0x2a4599,for_categorize:_0x8990d9,product_name_QA1:_0x1c75ed}=_0x180ed0[_0xa3e67b(0x121)];if(typeof _0x1c75ed==_0xa3e67b(0x187))var _0x2c7e85=[_0x180ed0[_0xa3e67b(0x121)]['product_name_QA1']],_0x255960=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x17a)]],_0x3afbcf=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x152)]],_0x53c54b=[_0x180ed0['body'][_0xa3e67b(0x191)]],_0x1868d9=[_0x180ed0[_0xa3e67b(0x121)]['sales_quantity_QA']],_0x554ec2=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1eb)]],_0x5c60ae=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1ad)]],_0x533981=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x136)]],_0x173a24=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x199)]],_0x2928a1=[_0x180ed0['body'][_0xa3e67b(0x1cc)]],_0x989603=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1cd)]],_0x5b6d04=[_0x180ed0[_0xa3e67b(0x121)]['unit_QA']],_0x25b1cc=[_0x180ed0[_0xa3e67b(0x121)]['production_date_QA']],_0x16fe01=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x167)]];else var _0x2c7e85=[..._0x180ed0[_0xa3e67b(0x121)]['product_name_QA1']],_0x255960=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x17a)]],_0x3afbcf=[..._0x180ed0[_0xa3e67b(0x121)]['secondary_code_QA']],_0x53c54b=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x191)]],_0x1868d9=[..._0x180ed0[_0xa3e67b(0x121)]['sales_quantity_QA']],_0x554ec2=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1eb)]],_0x5c60ae=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1ad)]],_0x533981=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x136)]],_0x173a24=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x199)]],_0x2928a1=[..._0x180ed0[_0xa3e67b(0x121)]['batch_code_QA']],_0x989603=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1cd)]],_0x5b6d04=[..._0x180ed0['body'][_0xa3e67b(0x1c7)]],_0x25b1cc=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x17d)]],_0x16fe01=[..._0x180ed0['body']['expiry_date_QA']];const _0x1f5801=_0x2c7e85[_0xa3e67b(0x137)](_0x31b737=>{return _0x31b737={'product_name':_0x31b737};});_0x255960[_0xa3e67b(0x1a4)]((_0x60ebb2,_0x444b40)=>{var _0x377207=_0xa3e67b;_0x1f5801[_0x444b40][_0x377207(0x1b9)]=_0x60ebb2;}),_0x3afbcf[_0xa3e67b(0x1a4)]((_0x216153,_0x525feb)=>{var _0x5bcc14=_0xa3e67b;_0x1f5801[_0x525feb][_0x5bcc14(0x151)]=_0x216153;}),_0x53c54b['forEach']((_0x6ea95d,_0x41b5fb)=>{var _0x4b0430=_0xa3e67b;_0x1f5801[_0x41b5fb][_0x4b0430(0x181)]=_0x6ea95d;}),_0x1868d9[_0xa3e67b(0x1a4)]((_0x5599be,_0x9a6e5e)=>{var _0x278120=_0xa3e67b;_0x1f5801[_0x9a6e5e][_0x278120(0x1ff)]=_0x5599be;}),_0x554ec2[_0xa3e67b(0x1a4)]((_0x4705b0,_0x1ea326)=>{var _0x10d6d3=_0xa3e67b;_0x1f5801[_0x1ea326][_0x10d6d3(0x177)]=_0x4705b0;}),_0x5c60ae[_0xa3e67b(0x1a4)]((_0x175357,_0x36aed7)=>{var _0x2a814d=_0xa3e67b;_0x1f5801[_0x36aed7][_0x2a814d(0x157)]=_0x175357;}),_0x533981['forEach']((_0x58068a,_0x2d3fc9)=>{_0x1f5801[_0x2d3fc9]['maxPerUnit']=_0x58068a;}),_0x173a24[_0xa3e67b(0x1a4)]((_0x1e0900,_0x11b26a)=>{var _0x53e74f=_0xa3e67b;_0x1f5801[_0x11b26a][_0x53e74f(0x184)]=_0x1e0900;}),_0x2928a1['forEach']((_0x30827c,_0xefbe13)=>{_0x1f5801[_0xefbe13]['batch_code']=_0x30827c;}),_0x989603['forEach']((_0x5d82e8,_0x53a984)=>{var _0x2e92a2=_0xa3e67b;_0x1f5801[_0x53a984][_0x2e92a2(0x1e9)]=_0x5d82e8;}),_0x5b6d04[_0xa3e67b(0x1a4)]((_0x3be73f,_0x2d66e8)=>{var _0x7413d1=_0xa3e67b;_0x1f5801[_0x2d66e8][_0x7413d1(0x159)]=_0x3be73f;}),_0x25b1cc[_0xa3e67b(0x1a4)]((_0x5eca2f,_0xa4cba4)=>{var _0x372f50=_0xa3e67b;_0x1f5801[_0xa4cba4][_0x372f50(0x1e6)]=_0x5eca2f;}),_0x16fe01[_0xa3e67b(0x1a4)]((_0x4c7797,_0x2e0927)=>{var _0x3162c8=_0xa3e67b;_0x1f5801[_0x2e0927][_0x3162c8(0x16b)]=_0x4c7797;});const _0x2445f5=await sales_finished[_0xa3e67b(0x1dc)]({'invoice':_0x5e5fb3});_0x2445f5[_0xa3e67b(0x1ee)]=_0xa3e67b(0x176);const _0x171adf=await _0x2445f5[_0xa3e67b(0x1d7)](),_0x502168=new sales_return_finished({'invoice':_0x5e5fb3,'customer':_0x180ed0['body'][_0xa3e67b(0x114)],'date':_0x682594,'warehouse_name':_0x36fa0e,'room':_0x4bcad9,'ToWarehouse':_0x298d71,'ToRoom':_0x3097fe,'return_sale_QA':_0x1f5801,'note':_0x2a4599,'warehouse_cat':_0x8990d9}),_0x2d0476=await _0x502168[_0xa3e67b(0x1d7)](),_0x52528a=await sales_return_finished[_0xa3e67b(0x1dc)]({'invoice':_0x5e5fb3}),_0x5e63bd=await warehouse[_0xa3e67b(0x1dc)]({'name':_0x298d71,'room':_0x3097fe});_0x52528a[_0xa3e67b(0x14f)][_0xa3e67b(0x1a4)](_0x39ed00=>{var _0x40097d=_0xa3e67b,_0x566c81=0x0;const _0x5a26d8=_0x5e63bd['product_details'][_0x40097d(0x137)](_0x4f8fc8=>{var _0x3d3862=_0x40097d;_0x4f8fc8[_0x3d3862(0xe3)]==_0x39ed00[_0x3d3862(0xe3)]&&_0x4f8fc8['expiry_date']==_0x39ed00[_0x3d3862(0x16b)]&&_0x4f8fc8[_0x3d3862(0x1e6)]==_0x39ed00['production_date']&&_0x4f8fc8[_0x3d3862(0x11d)]==_0x39ed00[_0x3d3862(0x11d)]&&(_0x4f8fc8[_0x3d3862(0x166)]=parseInt(_0x4f8fc8['product_stock'])+parseInt(_0x39ed00[_0x3d3862(0x157)]),_0x566c81++);});_0x566c81=='0'&&(_0x5e63bd['product_details']=_0x5e63bd['product_details'][_0x40097d(0x104)]({'product_name':_0x39ed00[_0x40097d(0xe3)],'product_stock':_0x39ed00[_0x40097d(0x157)],'primary_code':_0x39ed00[_0x40097d(0x1b9)],'secondary_code':_0x39ed00[_0x40097d(0x151)],'product_code':_0x39ed00['product_code'],'batch_code':_0x39ed00[_0x40097d(0x11d)],'maxPerUnit':_0x39ed00['maxPerUnit'],'production_date':_0x39ed00[_0x40097d(0x1e6)],'expiry_date':_0x39ed00[_0x40097d(0x16b)],'secondary_unit':_0x39ed00['secondary_unit'],'unit':_0x39ed00[_0x40097d(0x159)],'maxProducts':_0x39ed00[_0x40097d(0x184)],'bay':_0x39ed00[_0x40097d(0x1e8)]}));}),await _0x5e63bd[_0xa3e67b(0x1d7)]();const _0x1daa57=new c_payment_data({'invoice':_0x5e5fb3,'customer':_0x180ed0['body'][_0xa3e67b(0x114)],'reason':'Sale\x20Return'});await _0x1daa57[_0xa3e67b(0x1d7)]();const _0x18013d=await master_shop[_0xa3e67b(0x13b)](),_0x4ff15f=await email_settings['findOne'](),_0x7813c6=await customer['findOne']({'name':_0x180ed0['body'][_0xa3e67b(0x114)]});_0x18013d[0x0][_0xa3e67b(0x161)]==0x1?(right_currency=_0x18013d[0x0][_0xa3e67b(0x122)],left_currency=''):(right_currency='',left_currency=_0x18013d[0x0][_0xa3e67b(0x122)]);var _0x53a671=_0x2c7e85,_0x1fd49a=_0x5c60ae,_0x1d577a='',_0x23cdb8;for(_0x23cdb8 in _0x53a671){_0x1d577a+=_0xa3e67b(0x1b3)+_0xa3e67b(0x117)+_0x53a671[_0x23cdb8]+'</td>'+_0xa3e67b(0x117)+_0x1fd49a[_0x23cdb8]+_0xa3e67b(0x135)+_0xa3e67b(0x15b);}console[_0xa3e67b(0x131)](_0xa3e67b(0x14c),_0x1d577a);let _0xcb6c6f=nodemailer['createTransport']({'service':_0xa3e67b(0x1c0),'auth':{'user':_0x4ff15f[_0xa3e67b(0xff)],'pass':_0x4ff15f[_0xa3e67b(0x192)]}}),_0x17fc41={'from':_0x4ff15f[_0xa3e67b(0xff)],'to':_0x7813c6[_0xa3e67b(0xff)],'subject':_0xa3e67b(0x17f),'attachments':[{'filename':'Logo.png','path':__dirname+_0xa3e67b(0x195)+_0xa3e67b(0x115)+_0x18013d[0x0][_0xa3e67b(0xeb)],'cid':'logo'}],'html':_0xa3e67b(0xfd)+_0xa3e67b(0x12d)+_0xa3e67b(0x138)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xa3e67b(0x1a7)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0xa3e67b(0x1ab)+'<div>'+_0xa3e67b(0x16e)+_0x18013d[0x0]['site_title']+_0xa3e67b(0x1a8)+_0xa3e67b(0x1ab)+_0xa3e67b(0x1ab)+'<hr\x20class=\x22my-3\x22>'+_0xa3e67b(0x1a7)+_0xa3e67b(0x179)+_0xa3e67b(0xf4)+_0x5e5fb3+'\x20'+_0xa3e67b(0x1ac)+'\x20Order\x20Date\x20:\x20'+_0x682594+'\x20'+_0xa3e67b(0xf3)+_0xa3e67b(0xe5)+_0xa3e67b(0x1ab)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xa3e67b(0x1d9)+_0xa3e67b(0x1b3)+_0xa3e67b(0x1be)+_0xa3e67b(0xfb)+_0xa3e67b(0x149)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0xa3e67b(0x15b)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1d577a+'\x20'+_0xa3e67b(0x1c4)+'</table>'+'<div>'+_0xa3e67b(0x1d1)+_0xa3e67b(0x1d8)+_0x18013d[0x0]['site_title']+_0xa3e67b(0xe5)+_0xa3e67b(0x1ab)+'</div>'+_0xa3e67b(0x124)};_0xcb6c6f[_0xa3e67b(0x140)](_0x17fc41,function(_0x1940c2,_0x149e96){var _0x3b3880=_0xa3e67b;_0x1940c2?(console[_0x3b3880(0x131)](_0x1940c2),console['log'](_0x3b3880(0xf1))):console[_0x3b3880(0x131)](_0x3b3880(0xe9));}),_0x180ed0[_0xa3e67b(0x1d4)](_0xa3e67b(0xf9),'sales\x20item\x20return\x20successfull'),_0x45e070[_0xa3e67b(0x1aa)](_0xa3e67b(0x11c));}catch(_0x2b2052){_0x45e070[_0xa3e67b(0x19d)](0xc8)[_0xa3e67b(0x1ef)]({'message1':_0x2b2052['message']});}else{if(_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x150)]=='GS')try{const {invoice:_0xb01db0,date:_0x1f83f1,warehouse_name:_0x183dd7,product_name:_0x539f33,primary_code:_0x27a625,secondary_code:_0x40cc70,product_code:_0x3a069e,sales_quantity:_0xcd39ce,stocks:_0x5aed99,return_qty:_0x2bf338,Room_name:_0x3a7875,to_warehouse_name:_0x5f23c2,to_Room_name:_0x49946f,note:_0x107762,level:_0x6bf61f,isle:_0x44d664,pallet:_0x32fc58,for_categorize:_0x2fae4e}=_0x180ed0[_0xa3e67b(0x121)];if(typeof _0x539f33==_0xa3e67b(0x187))var _0x2c7e85=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0xe3)]],_0x255960=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1b9)]],_0x3afbcf=[_0x180ed0['body'][_0xa3e67b(0x151)]],_0x53c54b=[_0x180ed0[_0xa3e67b(0x121)]['product_code']],_0x1868d9=[_0x180ed0[_0xa3e67b(0x121)]['sales_quantity']],_0x5c60ae=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x157)]],_0x5ea537=[_0x180ed0[_0xa3e67b(0x121)]['bay']],_0x533981=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x160)]],_0x173a24=[_0x180ed0['body'][_0xa3e67b(0x184)]],_0x2928a1=[_0x180ed0[_0xa3e67b(0x121)]['batch_code']],_0x989603=[_0x180ed0['body'][_0xa3e67b(0x1e9)]],_0x5b6d04=[_0x180ed0[_0xa3e67b(0x121)]['unit']],_0x25b1cc=[_0x180ed0['body'][_0xa3e67b(0x1e6)]],_0x16fe01=[_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x16b)]];else var _0x2c7e85=[..._0x180ed0[_0xa3e67b(0x121)]['product_name']],_0x255960=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1b9)]],_0x3afbcf=[..._0x180ed0[_0xa3e67b(0x121)]['secondary_code']],_0x53c54b=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x181)]],_0x1868d9=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1f8)]],_0x5c60ae=[..._0x180ed0['body'][_0xa3e67b(0x157)]],_0x5ea537=[..._0x180ed0['body'][_0xa3e67b(0x1e8)]],_0x533981=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x160)]],_0x173a24=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x184)]],_0x2928a1=[..._0x180ed0['body'][_0xa3e67b(0x11d)]],_0x989603=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1e9)]],_0x5b6d04=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x159)]],_0x25b1cc=[..._0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x1e6)]],_0x16fe01=[..._0x180ed0['body'][_0xa3e67b(0x16b)]];const _0x1f5289=_0x2c7e85[_0xa3e67b(0x137)](_0xfa535c=>{return _0xfa535c={'product_name':_0xfa535c};});_0x255960['forEach']((_0x36e5af,_0xd9af65)=>{var _0x24cf03=_0xa3e67b;_0x1f5289[_0xd9af65][_0x24cf03(0x1b9)]=_0x36e5af;}),_0x3afbcf[_0xa3e67b(0x1a4)]((_0x18d2e9,_0xad3230)=>{var _0x5bd93b=_0xa3e67b;_0x1f5289[_0xad3230][_0x5bd93b(0x151)]=_0x18d2e9;}),_0x53c54b[_0xa3e67b(0x1a4)]((_0x127934,_0x35f641)=>{var _0x1499f4=_0xa3e67b;_0x1f5289[_0x35f641][_0x1499f4(0x181)]=_0x127934;}),_0x1868d9['forEach']((_0x4b2119,_0x499f7e)=>{var _0x519bea=_0xa3e67b;_0x1f5289[_0x499f7e][_0x519bea(0x1ff)]=_0x4b2119;}),_0x5c60ae['forEach']((_0x4492de,_0x3d81b8)=>{var _0x1783a6=_0xa3e67b;_0x1f5289[_0x3d81b8][_0x1783a6(0x157)]=_0x4492de;}),_0x5ea537['forEach']((_0x3037bd,_0x3af5d0)=>{_0x1f5289[_0x3af5d0]['bay']=_0x3037bd;}),_0x533981[_0xa3e67b(0x1a4)]((_0x10a04f,_0x4bbd71)=>{var _0x3235c9=_0xa3e67b;_0x1f5289[_0x4bbd71][_0x3235c9(0x160)]=_0x10a04f;}),_0x173a24[_0xa3e67b(0x1a4)]((_0x406227,_0x247682)=>{var _0x77736a=_0xa3e67b;_0x1f5289[_0x247682][_0x77736a(0x184)]=_0x406227;}),_0x2928a1['forEach']((_0x4d11dc,_0x126159)=>{_0x1f5289[_0x126159]['batch_code']=_0x4d11dc;}),_0x989603[_0xa3e67b(0x1a4)]((_0x38ac96,_0x1b9645)=>{var _0x5c1bf3=_0xa3e67b;_0x1f5289[_0x1b9645][_0x5c1bf3(0x1e9)]=_0x38ac96;}),_0x5b6d04[_0xa3e67b(0x1a4)]((_0x56ab99,_0x31cb52)=>{var _0x2baa25=_0xa3e67b;_0x1f5289[_0x31cb52][_0x2baa25(0x159)]=_0x56ab99;}),_0x25b1cc[_0xa3e67b(0x1a4)]((_0x4a48f3,_0x7c6bad)=>{var _0x2b2ef1=_0xa3e67b;_0x1f5289[_0x7c6bad][_0x2b2ef1(0x1e6)]=_0x4a48f3;}),_0x16fe01[_0xa3e67b(0x1a4)]((_0x4ed0e7,_0x434a8b)=>{_0x1f5289[_0x434a8b]['expiry_date']=_0x4ed0e7;});var _0x2cdecf=0x0;_0x1f5289[_0xa3e67b(0x1a4)](_0x2fac61=>{var _0x5d9c6e=_0xa3e67b;(parseInt(_0x2fac61[_0x5d9c6e(0x1ff)])<parseInt(_0x2fac61[_0x5d9c6e(0x157)])||parseInt(_0x2fac61[_0x5d9c6e(0x177)])<parseInt(_0x2fac61[_0x5d9c6e(0x157)])&&parseInt(_0x2fac61[_0x5d9c6e(0x1ff)])>parseInt(_0x2fac61[_0x5d9c6e(0x157)])||parseInt(_0x2fac61[_0x5d9c6e(0x157)])==0x0)&&_0x2cdecf++;});if(_0x2cdecf!=0x0)return _0x180ed0[_0xa3e67b(0x1d4)](_0xa3e67b(0x120),_0xa3e67b(0xec)),_0x45e070['redirect'](_0xa3e67b(0x197));const _0x445ed7=await sales_finished['findOne']({'invoice':_0xb01db0});_0x445ed7[_0xa3e67b(0x1ee)]=_0xa3e67b(0x176);const _0x50f180=await _0x445ed7[_0xa3e67b(0x1d7)](),_0x21941b=new sales_return_finished({'invoice':_0xb01db0,'customer':_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x114)],'date':_0x1f83f1,'warehouse_name':_0x183dd7,'room':_0x3a7875,'ToWarehouse':_0x5f23c2,'ToRoom':_0x49946f,'return_sale':_0x1f5289,'note':_0x107762,'warehouse_cat':_0x2fae4e}),_0x3414c2=await _0x21941b[_0xa3e67b(0x1d7)](),_0x10b352=await sales_return_finished[_0xa3e67b(0x1dc)]({'invoice':_0xb01db0}),_0x8e8080=await warehouse[_0xa3e67b(0x1dc)]({'name':_0x5f23c2,'room':_0x49946f,'warehouse_category':'Finished\x20Goods'});_0x10b352[_0xa3e67b(0x1b7)]['forEach'](_0x522d61=>{var _0x2a9255=_0xa3e67b,_0x4ca68d=0x0;const _0x5b885d=_0x8e8080[_0x2a9255(0x13f)][_0x2a9255(0x137)](_0x48264b=>{var _0x2aeb9e=_0x2a9255;_0x48264b[_0x2aeb9e(0xe3)]==_0x522d61[_0x2aeb9e(0xe3)]&&_0x48264b['bay']==_0x522d61[_0x2aeb9e(0x1e8)]&&_0x48264b[_0x2aeb9e(0x16b)]==_0x522d61['expiry_date']&&_0x48264b[_0x2aeb9e(0x1e6)]==_0x522d61[_0x2aeb9e(0x1e6)]&&_0x48264b[_0x2aeb9e(0x11d)]==_0x522d61[_0x2aeb9e(0x11d)]&&(_0x48264b['product_stock']=parseInt(_0x48264b['product_stock'])+parseInt(_0x522d61[_0x2aeb9e(0x157)]),_0x4ca68d++);});_0x4ca68d=='0'&&(_0x8e8080[_0x2a9255(0x13f)]=_0x8e8080[_0x2a9255(0x13f)][_0x2a9255(0x104)]({'product_name':_0x522d61['product_name'],'product_stock':_0x522d61[_0x2a9255(0x157)],'primary_code':_0x522d61[_0x2a9255(0x1b9)],'secondary_code':_0x522d61['secondary_code'],'product_code':_0x522d61[_0x2a9255(0x181)],'bay':_0x522d61['bay'],'batch_code':_0x522d61[_0x2a9255(0x11d)],'maxPerUnit':_0x522d61['maxPerUnit'],'production_date':_0x522d61[_0x2a9255(0x1e6)],'expiry_date':_0x522d61[_0x2a9255(0x16b)],'secondary_unit':_0x522d61[_0x2a9255(0x1e9)],'unit':_0x522d61[_0x2a9255(0x159)],'maxProducts':_0x522d61[_0x2a9255(0x184)]}));}),await _0x8e8080[_0xa3e67b(0x1d7)](),console[_0xa3e67b(0x131)](_0x180ed0['body']);const _0x322e65=new c_payment_data({'invoice':_0xb01db0,'customer':_0x180ed0[_0xa3e67b(0x121)][_0xa3e67b(0x114)],'reason':_0xa3e67b(0x103)});await _0x322e65['save']();const _0x281df8=await master_shop[_0xa3e67b(0x13b)]();console['log'](_0xa3e67b(0x1b4),_0x281df8[0x0][_0xa3e67b(0xeb)]);const _0x186f4d=await email_settings[_0xa3e67b(0x1dc)](),_0x1a67df=await customer[_0xa3e67b(0x1dc)]({'name':_0x180ed0['body']['customer']});console['log'](_0xa3e67b(0x17e),_0x1a67df);_0x281df8[0x0][_0xa3e67b(0x161)]==0x1?(right_currency=_0x281df8[0x0][_0xa3e67b(0x122)],left_currency=''):(right_currency='',left_currency=_0x281df8[0x0][_0xa3e67b(0x122)]);var _0x53a671=_0x2c7e85,_0x1fd49a=_0x5c60ae,_0x1d577a='',_0x23cdb8;for(_0x23cdb8 in _0x53a671){_0x1d577a+=_0xa3e67b(0x1b3)+_0xa3e67b(0x117)+_0x53a671[_0x23cdb8]+_0xa3e67b(0x135)+_0xa3e67b(0x117)+_0x1fd49a[_0x23cdb8]+'</td>'+_0xa3e67b(0x15b);}console['log'](_0xa3e67b(0x14c),_0x1d577a);let _0x2cdbe8=nodemailer[_0xa3e67b(0x173)]({'service':'gmail','auth':{'user':_0x186f4d['email'],'pass':_0x186f4d[_0xa3e67b(0x192)]}}),_0x31db66={'from':_0x186f4d[_0xa3e67b(0xff)],'to':_0x1a67df[_0xa3e67b(0xff)],'subject':_0xa3e67b(0x17f),'attachments':[{'filename':'Logo.png','path':__dirname+_0xa3e67b(0x195)+'/upload/'+_0x281df8[0x0][_0xa3e67b(0xeb)],'cid':_0xa3e67b(0x15f)}],'html':'<!DOCTYPE\x20html>'+_0xa3e67b(0x12d)+_0xa3e67b(0x138)+_0xa3e67b(0x1a7)+_0xa3e67b(0x162)+_0xa3e67b(0x1a7)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0xa3e67b(0x1ab)+_0xa3e67b(0x1a7)+_0xa3e67b(0x16e)+_0x281df8[0x0][_0xa3e67b(0x1e3)]+'\x20</h2>'+_0xa3e67b(0x1ab)+_0xa3e67b(0x1ab)+_0xa3e67b(0x109)+_0xa3e67b(0x1a7)+_0xa3e67b(0x179)+_0xa3e67b(0xf4)+_0xb01db0+'\x20'+_0xa3e67b(0x1ac)+_0xa3e67b(0x107)+_0x1f83f1+'\x20'+_0xa3e67b(0xf3)+_0xa3e67b(0xe5)+_0xa3e67b(0x1ab)+_0xa3e67b(0x172)+_0xa3e67b(0x1d9)+'<tr>'+_0xa3e67b(0x1be)+_0xa3e67b(0xfb)+_0xa3e67b(0x149)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0xa3e67b(0x15b)+_0xa3e67b(0x1de)+_0xa3e67b(0x101)+'\x20'+_0x1d577a+'\x20'+'</tbody>'+_0xa3e67b(0x183)+_0xa3e67b(0x1a7)+_0xa3e67b(0x1d1)+_0xa3e67b(0x1d8)+_0x281df8[0x0][_0xa3e67b(0x1e3)]+_0xa3e67b(0xe5)+_0xa3e67b(0x1ab)+'</div>'+_0xa3e67b(0x124)};_0x2cdbe8[_0xa3e67b(0x140)](_0x31db66,function(_0x3cbe13,_0x58ad63){var _0x401260=_0xa3e67b;_0x3cbe13?(console['log'](_0x3cbe13),console['log'](_0x401260(0xf1))):console[_0x401260(0x131)]('Email\x20sent\x20successfully');}),_0x180ed0[_0xa3e67b(0x1d4)](_0xa3e67b(0xf9),'sales\x20item\x20return\x20successfull'),_0x45e070['redirect']('/all_sales_finished/view');}catch(_0x461186){console[_0xa3e67b(0x131)](_0x461186),_0x45e070[_0xa3e67b(0x19d)](0xc8)['json']({'message1':_0x461186[_0xa3e67b(0x15c)]});}}}),router[a0_0x2a3f2d(0x14e)]('/barcode/:id',auth,async(_0xf35732,_0x459051)=>{var _0x452489=a0_0x2a3f2d;try{const {username:_0x3ba1bb,email:_0x5e343f,role:_0x5a3a97}=_0xf35732[_0x452489(0x118)],_0x3d271f=_0xf35732[_0x452489(0x118)],_0x2c2f97=await profile[_0x452489(0x1dc)]({'email':_0x3d271f['email']}),_0x51842c=await master_shop['find']();console[_0x452489(0x131)]('barcode\x20Product\x20master',_0x51842c);const _0x3b39b3=_0xf35732[_0x452489(0x196)]['id'],_0x17a4d3=await sales[_0x452489(0x128)](_0x3b39b3);console['log'](_0x452489(0x1a9),_0x17a4d3);if(_0x51842c[0x0][_0x452489(0x1fc)]==_0x452489(0x1f7))var _0x4b1db9=users['English'];else{if(_0x51842c[0x0]['language']==_0x452489(0x15a))var _0x4b1db9=users[_0x452489(0x15a)];else{if(_0x51842c[0x0][_0x452489(0x1fc)]==_0x452489(0x1e0))var _0x4b1db9=users[_0x452489(0x1e0)];else{if(_0x51842c[0x0][_0x452489(0x1fc)]=='Spanish')var _0x4b1db9=users[_0x452489(0x1f4)];else{if(_0x51842c[0x0][_0x452489(0x1fc)]==_0x452489(0x1bd))var _0x4b1db9=users[_0x452489(0x1bd)];else{if(_0x51842c[0x0][_0x452489(0x1fc)]==_0x452489(0x126))var _0x4b1db9=users[_0x452489(0x146)];else{if(_0x51842c[0x0]['language']==_0x452489(0x158))var _0x4b1db9=users[_0x452489(0x158)];else{if(_0x51842c[0x0][_0x452489(0x1fc)]==_0x452489(0x19c))var _0x4b1db9=users[_0x452489(0x1f3)];}}}}}}}_0x459051[_0x452489(0x17c)]('all_sales_barcode',{'success':_0xf35732[_0x452489(0x1d4)](_0x452489(0xf9)),'errors':_0xf35732['flash'](_0x452489(0x120)),'role':_0x3d271f,'profile':_0x2c2f97,'alldata':_0x17a4d3,'master_shop':_0x51842c,'language':_0x4b1db9});}catch(_0x5ea948){console[_0x452489(0x131)](_0x5ea948);}}),router[a0_0x2a3f2d(0x12b)](a0_0x2a3f2d(0x19a),async(_0x55b26c,_0x43f50e)=>{var _0x495f93=a0_0x2a3f2d;const {product_code:_0x22c4cf,warehouse_name:_0x2e7e4b,rooms_data:_0x5b88e1,Roomslist:_0x45449a}=_0x55b26c[_0x495f93(0x121)],_0x2b6011=_0x45449a[_0x495f93(0x13d)](','),_0xe2b668=[];async function _0x1ba784(_0x58f7c2){var _0x15666d=_0x495f93;const _0xfc7c90=await warehouse['aggregate']([{'$match':{'name':_0x2e7e4b,'room':_0x58f7c2}},{'$unwind':_0x15666d(0xf7)},{'$match':{'product_details.primary_code':_0x22c4cf}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x15666d(0x1a3)},'primary_code':{'$first':_0x15666d(0x143)},'secondary_code':{'$first':_0x15666d(0x175)},'product_code':{'$first':_0x15666d(0x1b2)},'level':{'$first':_0x15666d(0xe7)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x15666d(0x170)},'pallet':{'$first':_0x15666d(0x1c5)},'unit':{'$first':_0x15666d(0x1ae)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x15666d(0x1f0)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x15666d(0x125)},'production_date':{'$first':_0x15666d(0x147)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x15666d(0x1e2)},'invoice':{'$first':_0x15666d(0x193)}}}]),_0x2a20bd=await warehouse[_0x15666d(0x168)]([{'$match':{'name':_0x2e7e4b,'room':_0x58f7c2}},{'$unwind':_0x15666d(0xf7)},{'$match':{'product_details.secondary_code':_0x22c4cf}},{'$group':{'_id':_0x15666d(0x189),'name':{'$first':_0x15666d(0x16a)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x15666d(0x143)},'secondary_code':{'$first':_0x15666d(0x175)},'product_code':{'$first':_0x15666d(0x1b2)},'level':{'$first':_0x15666d(0xe7)},'isle':{'$first':_0x15666d(0x14b)},'type':{'$first':_0x15666d(0x170)},'pallet':{'$first':_0x15666d(0x1c5)},'unit':{'$first':_0x15666d(0x1ae)},'secondary_unit':{'$first':_0x15666d(0x1ce)},'storage':{'$first':_0x15666d(0x1f0)},'rack':{'$first':_0x15666d(0x1e7)},'expiry_date':{'$first':_0x15666d(0x125)},'production_date':{'$first':_0x15666d(0x147)},'maxPerUnit':{'$first':_0x15666d(0x100)},'batch_code':{'$first':_0x15666d(0x129)},'product_cat':{'$first':_0x15666d(0x110)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x15666d(0x1e2)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0xfc7c90[_0x15666d(0x1f9)]>0x0)_0xe2b668[_0x15666d(0x119)](_0xfc7c90);else _0x2a20bd[_0x15666d(0x1f9)]>0x0&&_0xe2b668[_0x15666d(0x119)](_0x2a20bd);}const _0x5e0c9d=_0x2b6011[_0x495f93(0x137)](_0x5e977a=>_0x1ba784(_0x5e977a));await Promise[_0x495f93(0x1a1)](_0x5e0c9d),_0x43f50e[_0x495f93(0x1ef)](_0xe2b668);}),module['exports']=router;