var a0_0x23c228=a0_0x36ad;(function(_0x4fa01f,_0x315085){var _0x429ac4=a0_0x36ad,_0x3d6425=_0x4fa01f();while(!![]){try{var _0x4f2545=parseInt(_0x429ac4(0x183))/0x1*(-parseInt(_0x429ac4(0x1a7))/0x2)+parseInt(_0x429ac4(0x1ec))/0x3+-parseInt(_0x429ac4(0x1be))/0x4+-parseInt(_0x429ac4(0x19f))/0x5*(parseInt(_0x429ac4(0x1e0))/0x6)+parseInt(_0x429ac4(0x251))/0x7+-parseInt(_0x429ac4(0x1d5))/0x8*(parseInt(_0x429ac4(0x1a9))/0x9)+parseInt(_0x429ac4(0x18d))/0xa*(parseInt(_0x429ac4(0x242))/0xb);if(_0x4f2545===_0x315085)break;else _0x3d6425['push'](_0x3d6425['shift']());}catch(_0x463fb5){_0x3d6425['push'](_0x3d6425['shift']());}}}(a0_0x8522,0x44bb1));const express=require('express'),app=express(),router=express[a0_0x23c228(0x25f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x23c228(0x202)),auth=require(a0_0x23c228(0x1bf)),nodemailer=require('nodemailer'),users=require(a0_0x23c228(0x172));function a0_0x8522(){var _0x358c0c=['unit_QA','primary_unit','Portuguese\x20(BR)','$product_details.maxProducts','product_name_QA1','site_title','save','../models/all_models','$date','return_data','$product_details.bin','<html><head><title></title>','/barcode_scanner','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','room_name','<h5>','product_stock','createTransport','$name','sales_invoice','$product_details.bay','/picking_list/pdf/','prod_code','secondary_unit','json','barcode\x20user_id','<tbody\x20style=\x22text-align:\x20center;\x22>','bay','date','product_code_QA','barcode\x20Product\x20master','edit_sales_finished_view','master','$product_details.primary_code','production_date','$product_details._id','$product_details.floorlevel','aggregate','RoomAssigned','return_sale_QA','/all_sales_finished/preview/','role','/../public','suppliers','forEach','/all_sales_finished/view','getDate','</table>','An\x20error\x20occurred.','Finished\x20Goods','abs','message','slice','Chinese','password','add\x20post','$product_details.production_date','amount','prod_invoice','stock','max','edit_sales_finished','product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.product_code','/upload/','secondary_code_QA','quantity','host','44zqMnMs','$product_details.expiry_date','</body></html>','image','customer','split','level','An\x20error\x20occurred\x20while\x20saving\x20data.','exports','English','Spanish','Return\x20Rooms','string','carton','expiry_date','576163nYPKGD','language','sales_quantity','/preview/:id','currency','True','push','$sale_product.type','</div>','Sale\x20Return\x20Mail','id_transaction_from','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','maxProducts_QA','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','Router','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</td>','$product_details.type','\x20>>>\x20','batch_code','<strong>\x20Regards\x20</strong>','secondary_unit_QA','add_sales_finished','name','findById','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','for_categorize','secondary_code','\x20==\x20','</tbody>','currency_placement','/give_payment/:id','back','Sales\x20Add\x20successfully','log','logo','toString','staff','stocks_QA','\x20</h2>','_id','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','render','catch','room','Enabled','$product_details.batch_code','Ambient','email','return_qty_QA','/view/add_sale/product','$product_details.maxPerUnit','sale_product','\x20Order\x20Date\x20:\x20','\x20<<<==>>>\x20','$product_details.secondary_code','<h5\x20style=\x22text-align:\x20left;\x22>','../public/language/languages.json','purchases_data','production_date_QA','$warehouse_name','maxPerUnit','<div>','gmail','customers','$sale_product','product_list','DRY\x20GOODS','</tr>','German','$product_details','sales\x20item\x20return\x20successfull','$product_details.room_name','return_sale_finished','1YUZmOG','final','<hr\x20class=\x22my-3\x22>','due_amount','Enclosed','$product_details.secondary_unit','French','$customer','note','customer_data','4487200ncxhIO','Received\x20Payment\x20For\x20Sale','<span\x20style=\x22float:\x20right;\x22>','filter','/view/add_sales','warehouse_name','findOne','</thead>','$invoice','product_name','received_amount','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','flash','$finalize','$sale_product.floorlevel','getFullYear','customers_docs','230MLMFra','all_sales_finished','Arabic','$product_details.product_cat','Logo.png','$product_details.unit','English\x20(US)','product_date','943610KFFjJh','Hindi','326709YzYGek','$room','$note','$customers_docs','return_qty','maxPerUnit_QA','Email\x20sent\x20successfully','body','\x20Order\x20Number\x20:\x20','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','get','</h5>','success','then','Sales\x20Mail','Error\x20Occurs','port','max_per_unit','Sales\x20Update\x20successfully','$_id','1141020RfCjHR','../middleware/auth','primary_code','/view/add_sales/:id','$sale_product.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Arabic\x20(ae)','<h2>\x20','batch_code_QA','maxProducts','Sale\x20Return','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/view/:id','adjust_qty','unit','Quality\x20Inspection','OUTF-','Portuguese','payment\x20successfull','$product_details.product_stock','prod_cat','$product','104uGPsjm','$return_data','redirect','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','length','post','$sale_product.bay','QA\x20Warehouse','$product_details.rack','all','$product_details.product_name','70314GytNyo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/view','maxperunit','invoice','warehouse','</span>','map','sale_qty','product_details','params','sales_quantity_QA','517137BcYELL','/view/return_sales/:id','\x20&&\x20','$product_details.invoice','user','<tr>','</head><body>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','foreach\x20newproduct','<!DOCTYPE\x20html>','status','sendMail','$sale_product.quantity','error'];a0_0x8522=function(){return _0x358c0c;};return a0_0x8522();}router[a0_0x23c228(0x1b4)](a0_0x23c228(0x1e2),auth,async(_0x27c8ff,_0x13293d)=>{var _0x3eeffa=a0_0x23c228;try{const {username:_0x398367,email:_0x25cf86,role:_0x3b4cac}=_0x27c8ff[_0x3eeffa(0x1f0)],_0x447e27=_0x27c8ff[_0x3eeffa(0x1f0)],_0x2da375=await profile['findOne']({'email':_0x447e27['email']}),_0x2c63fb=await master_shop[_0x3eeffa(0x1b2)]();let _0x7994a3;if(_0x447e27['role']==_0x3eeffa(0x15d)){const _0x434b44=await staff[_0x3eeffa(0x193)]({'email':_0x447e27[_0x3eeffa(0x169)]});_0x7994a3=await sales_finished['aggregate']([{'$lookup':{'from':_0x3eeffa(0x179),'localField':'customer','foreignField':_0x3eeffa(0x268),'as':_0x3eeffa(0x19e)}},{'$unwind':'$customers_docs'},{'$unwind':_0x3eeffa(0x17a)},{'$group':{'_id':_0x3eeffa(0x1bd),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3eeffa(0x18a)},'date':{'$first':_0x3eeffa(0x203)},'warehouse_name':{'$first':_0x3eeffa(0x175)},'sale_product':{'$push':_0x3eeffa(0x17a)},'note':{'$first':'$note'},'return_data':{'$first':_0x3eeffa(0x1d6)},'customers_docs':{'$first':_0x3eeffa(0x1ac)},'total_saleproduct_quantity':{'$sum':_0x3eeffa(0x1f9)},'level':{'$addToSet':_0x3eeffa(0x1db)},'isle':{'$addToSet':_0x3eeffa(0x1c2)},'type':{'$addToSet':_0x3eeffa(0x258)},'pallet':{'$addToSet':_0x3eeffa(0x19c)},'finalize':{'$first':_0x3eeffa(0x19b)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x7994a3=await sales_finished[_0x3eeffa(0x222)]([{'$lookup':{'from':_0x3eeffa(0x179),'localField':_0x3eeffa(0x246),'foreignField':_0x3eeffa(0x268),'as':'customers_docs'}},{'$unwind':_0x3eeffa(0x1ac)},{'$unwind':_0x3eeffa(0x17a)},{'$group':{'_id':_0x3eeffa(0x1bd),'invoice':{'$first':_0x3eeffa(0x195)},'customers':{'$first':_0x3eeffa(0x18a)},'date':{'$first':_0x3eeffa(0x203)},'warehouse_name':{'$first':_0x3eeffa(0x175)},'sale_product':{'$push':_0x3eeffa(0x17a)},'note':{'$first':_0x3eeffa(0x1ab)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x3eeffa(0x1f9)},'level':{'$addToSet':_0x3eeffa(0x1db)},'isle':{'$addToSet':_0x3eeffa(0x1c2)},'type':{'$addToSet':_0x3eeffa(0x258)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3eeffa(0x19b)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x2c63fb[0x0][_0x3eeffa(0x252)]==_0x3eeffa(0x1a5)){var _0x3a050b=users['English'];console[_0x3eeffa(0x15a)](_0x3a050b);}else{if(_0x2c63fb[0x0][_0x3eeffa(0x252)]=='Hindi')var _0x3a050b=users[_0x3eeffa(0x1a8)];else{if(_0x2c63fb[0x0][_0x3eeffa(0x252)]=='German')var _0x3a050b=users['German'];else{if(_0x2c63fb[0x0][_0x3eeffa(0x252)]==_0x3eeffa(0x24c))var _0x3a050b=users[_0x3eeffa(0x24c)];else{if(_0x2c63fb[0x0][_0x3eeffa(0x252)]==_0x3eeffa(0x189))var _0x3a050b=users[_0x3eeffa(0x189)];else{if(_0x2c63fb[0x0]['language']=='Portuguese\x20(BR)')var _0x3a050b=users[_0x3eeffa(0x1d0)];else{if(_0x2c63fb[0x0]['language']=='Chinese')var _0x3a050b=users[_0x3eeffa(0x232)];else{if(_0x2c63fb[0x0][_0x3eeffa(0x252)]==_0x3eeffa(0x1c5))var _0x3a050b=users['Arabic'];}}}}}}}_0x13293d['render'](_0x3eeffa(0x1a0),{'success':_0x27c8ff[_0x3eeffa(0x19a)](_0x3eeffa(0x1b6)),'errors':_0x27c8ff[_0x3eeffa(0x19a)](_0x3eeffa(0x161)),'sales':_0x7994a3,'profile':_0x2da375,'role':_0x447e27,'master_shop':_0x2c63fb,'language':_0x3a050b});}catch(_0x5abf9e){console[_0x3eeffa(0x15a)](_0x5abf9e);}});function a0_0x36ad(_0x52a3f2,_0x2b2d1f){var _0x85224b=a0_0x8522();return a0_0x36ad=function(_0x36adaf,_0x74f9d6){_0x36adaf=_0x36adaf-0x150;var _0x489e9a=_0x85224b[_0x36adaf];return _0x489e9a;},a0_0x36ad(_0x52a3f2,_0x2b2d1f);}async function getRandom8DigitNumber(){var _0x43215e=a0_0x23c228;const _0x394d76=0x989680,_0x15cac9=0x5f5e0ff,_0x681926=Math['floor'](Math['random']()*(_0x15cac9-_0x394d76+0x1))+_0x394d76;var _0x13e0a0;const _0x34e76e=await sales_finished['findOne']({'invoice':_0x43215e(0x1cf)+_0x681926});return _0x34e76e&&_0x34e76e[_0x43215e(0x1d9)]>0x0?_0x13e0a0=_0x43215e(0x1cf)+_0x681926:_0x13e0a0='OUTF-'+_0x681926,_0x13e0a0;}router[a0_0x23c228(0x1b4)](a0_0x23c228(0x191),auth,async(_0x83666f,_0x1e60a9)=>{var _0x275cef=a0_0x23c228;try{const {username:_0x3ae262,email:_0x1ef4a0,role:_0x5bf843}=_0x83666f[_0x275cef(0x1f0)],_0x56fe9b=_0x83666f['user'],_0x25d487=await profile[_0x275cef(0x193)]({'email':_0x56fe9b[_0x275cef(0x169)]}),_0x14b193=await master_shop['find'](),_0x234ced=await customer[_0x275cef(0x1b2)]({});let _0x2b1003;if(_0x56fe9b[_0x275cef(0x226)]==_0x275cef(0x15d)){const _0x41f3e1=await staff[_0x275cef(0x193)]({'email':_0x56fe9b[_0x275cef(0x169)]});_0x2b1003=await warehouse['aggregate']([{'$match':{'status':_0x275cef(0x166),'name':_0x41f3e1[_0x275cef(0x1e5)],'warehouse_category':_0x275cef(0x22e),'name':{'$ne':_0x275cef(0x1dc)}}},{'$group':{'_id':_0x275cef(0x20f),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x2b1003=await warehouse[_0x275cef(0x222)]([{'$match':{'status':_0x275cef(0x166),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x275cef(0x1dc)}}},{'$group':{'_id':_0x275cef(0x20f),'name':{'$first':_0x275cef(0x20f)}}},{'$sort':{'name':0x1}}]);const _0x326fe0=await product[_0x275cef(0x1b2)]({});var _0x55efcf=[_0x275cef(0x168),_0x275cef(0x187)];const _0x4e7f8e=await sales_finished[_0x275cef(0x1b2)]({}),_0x2971c9=_0x4e7f8e[_0x275cef(0x1d9)]+0x1,_0x10b706='OUTF-'+_0x2971c9[_0x275cef(0x15c)]()['padStart'](0x5,'0');if(_0x14b193[0x0][_0x275cef(0x252)]==_0x275cef(0x1a5)){var _0x3cdf52=users[_0x275cef(0x24b)];console[_0x275cef(0x15a)](_0x3cdf52);}else{if(_0x14b193[0x0][_0x275cef(0x252)]==_0x275cef(0x1a8))var _0x3cdf52=users['Hindi'];else{if(_0x14b193[0x0][_0x275cef(0x252)]==_0x275cef(0x17e))var _0x3cdf52=users[_0x275cef(0x17e)];else{if(_0x14b193[0x0][_0x275cef(0x252)]=='Spanish')var _0x3cdf52=users[_0x275cef(0x24c)];else{if(_0x14b193[0x0][_0x275cef(0x252)]==_0x275cef(0x189))var _0x3cdf52=users['French'];else{if(_0x14b193[0x0][_0x275cef(0x252)]=='Portuguese\x20(BR)')var _0x3cdf52=users[_0x275cef(0x1d0)];else{if(_0x14b193[0x0][_0x275cef(0x252)]==_0x275cef(0x232))var _0x3cdf52=users[_0x275cef(0x232)];else{if(_0x14b193[0x0][_0x275cef(0x252)]==_0x275cef(0x1c5))var _0x3cdf52=users[_0x275cef(0x1a1)];}}}}}}}const _0x470891=getRandom8DigitNumber();_0x470891[_0x275cef(0x1b7)](_0xde6b79=>{var _0x13a05c=_0x275cef;_0x1e60a9[_0x13a05c(0x163)](_0x13a05c(0x267),{'success':_0x83666f[_0x13a05c(0x19a)](_0x13a05c(0x1b6)),'errors':_0x83666f[_0x13a05c(0x19a)](_0x13a05c(0x161)),'role':_0x56fe9b,'profile':_0x25d487,'customer':_0x234ced,'warehouse':_0x2b1003,'product':_0x326fe0,'invoice':_0xde6b79,'master_shop':_0x14b193,'language':_0x3cdf52,'rooms_data':_0x55efcf});})[_0x275cef(0x164)](_0x7d4a86=>{var _0x45b687=_0x275cef;_0x83666f[_0x45b687(0x19a)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1e60a9[_0x45b687(0x1d7)]('/all_sales_finished/view');});}catch(_0x5748e4){console[_0x275cef(0x15a)](_0x5748e4);}}),router[a0_0x23c228(0x1b4)](a0_0x23c228(0x1c1),auth,async(_0x1084e4,_0x527f35)=>{var _0x46c468=a0_0x23c228;try{const _0x58d9dc=_0x1084e4[_0x46c468(0x1ea)]['id'];console[_0x46c468(0x15a)](_0x58d9dc);const _0x4162ca=await product[_0x46c468(0x1b2)](),_0x1435e9=await purchases[_0x46c468(0x222)]([{'$match':{'warehouse_name':_0x58d9dc}},{'$unwind':_0x46c468(0x1d4)},{'$group':{'_id':'$product.product_name'}}]);console[_0x46c468(0x15a)](_0x46c468(0x173),_0x1435e9),_0x527f35[_0x46c468(0x1f7)](0xc8)[_0x46c468(0x215)]({'purchases_data':_0x1435e9,'product_data':_0x4162ca});}catch(_0x4ab0fd){console[_0x46c468(0x15a)](_0x4ab0fd);}}),router[a0_0x23c228(0x1da)](a0_0x23c228(0x16b),auth,async(_0x49dfb9,_0x4607cf)=>{var _0xd23480=a0_0x23c228;try{const {warehouse_data:_0xa82a5a,product_data:_0x142eb1}=_0x49dfb9[_0xd23480(0x1b0)];console[_0xd23480(0x15a)](_0x49dfb9['body']['product_data']);;const _0x2eb1a3=await master_shop[_0xd23480(0x1b2)]();console[_0xd23480(0x15a)](_0xd23480(0x21d),_0x2eb1a3);const _0x30259c=await product[_0xd23480(0x193)]({'name':_0x142eb1});console[_0xd23480(0x15a)]('product',_0x30259c);const _0x4cdb43=await warehouse[_0xd23480(0x222)]([{'$match':{'name':_0xa82a5a}},{'$unwind':_0xd23480(0x17f)},{'$match':{'product_details.product_name':_0x142eb1}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0xd23480(0x15a)]('stock_data',_0x4cdb43),_0x4607cf[_0xd23480(0x1f7)](0xc8)[_0xd23480(0x215)]({'master':_0x2eb1a3,'new_product':_0x30259c,'stock_data':_0x4cdb43});}catch(_0x5885aa){console[_0xd23480(0x15a)](_0x5885aa);}}),router[a0_0x23c228(0x1da)](a0_0x23c228(0x191),auth,async(_0x5aba08,_0x40e21c)=>{var _0x186ca2=a0_0x23c228;try{const {invoice:_0x32adec,date:_0x2625f7,warehouse_name:_0x57c520,product_name:_0x57bbfb,stock:_0x1bab89,quantity:_0x18009b,note:_0x4318,room:_0x7f0813,primary_code:_0x1ef928,secondary_code:_0x5712bc,prod_code:_0x87d10f,level:_0x2f39d3,isle:_0x5d18c3,pallet:_0x4e5496,batch_code:_0x5a9211,SCRN:_0x52698e,expiry_date:_0x17e5ed,mode_transpo:_0x5de2a2,name_driver:_0x534096}=_0x5aba08['body'];if(typeof _0x57bbfb==_0x186ca2(0x24e))var _0x25f580=[_0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x196)]],_0x10cf61=[_0x5aba08['body'][_0x186ca2(0x238)]],_0xfb5790=[_0x5aba08[_0x186ca2(0x1b0)]['carton']],_0x44c992=[_0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x1c0)]],_0x59bdad=[_0x5aba08[_0x186ca2(0x1b0)]['secondary_code']],_0x1cf24a=[_0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x213)]],_0x40ee9e=[_0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x248)]],_0x252642=[_0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x1fc)]],_0x42a6e8=[_0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x214)]],_0x34c133=[_0x5aba08[_0x186ca2(0x1b0)]['batch_code']],_0x37ae99=[_0x5aba08['body']['expiry_date']],_0x50ee83=[_0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x1a6)]],_0x177f6b=[_0x5aba08[_0x186ca2(0x1b0)]['max_per_unit']],_0x161214=[_0x5aba08[_0x186ca2(0x1b0)]['prod_cat']],_0x471830=[_0x5aba08['body'][_0x186ca2(0x223)]],_0x415d08=[_0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x237)]],_0x40c23a=[_0x5aba08['body'][_0x186ca2(0x25b)]];else var _0x25f580=[..._0x5aba08['body'][_0x186ca2(0x196)]],_0x10cf61=[..._0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x238)]],_0xfb5790=[..._0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x24f)]],_0x44c992=[..._0x5aba08['body'][_0x186ca2(0x1c0)]],_0x59bdad=[..._0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x153)]],_0x1cf24a=[..._0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x213)]],_0x40ee9e=[..._0x5aba08['body'][_0x186ca2(0x248)]],_0x252642=[..._0x5aba08[_0x186ca2(0x1b0)]['primary_unit']],_0x42a6e8=[..._0x5aba08['body'][_0x186ca2(0x214)]],_0x34c133=[..._0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x264)]],_0x37ae99=[..._0x5aba08['body'][_0x186ca2(0x250)]],_0x50ee83=[..._0x5aba08[_0x186ca2(0x1b0)]['product_date']],_0x177f6b=[..._0x5aba08['body'][_0x186ca2(0x1bb)]],_0x161214=[..._0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x1d3)]],_0x471830=[..._0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x223)]],_0x415d08=[..._0x5aba08['body']['prod_invoice']],_0x40c23a=[..._0x5aba08['body'][_0x186ca2(0x25b)]];const _0x35a6b8=_0x25f580[_0x186ca2(0x1e7)](_0x45630a=>{return _0x45630a={'product_name':_0x45630a};});_0x10cf61['forEach']((_0x3d25ed,_0x4de60a)=>{var _0x176679=_0x186ca2;_0x35a6b8[_0x4de60a][_0x176679(0x238)]=_0x3d25ed;}),_0xfb5790[_0x186ca2(0x229)]((_0x1f9e59,_0x525df9)=>{var _0x1d7644=_0x186ca2;_0x35a6b8[_0x525df9][_0x1d7644(0x240)]=Math[_0x1d7644(0x22f)](_0x1f9e59);}),_0x40c23a[_0x186ca2(0x229)]((_0x19d580,_0x36e3a1)=>{var _0x28601e=_0x186ca2;_0x35a6b8[_0x36e3a1][_0x28601e(0x25b)]=_0x19d580;}),_0x44c992[_0x186ca2(0x229)]((_0x4649ad,_0x359277)=>{var _0x2f9b8f=_0x186ca2;_0x35a6b8[_0x359277][_0x2f9b8f(0x1c0)]=_0x4649ad;}),_0x59bdad[_0x186ca2(0x229)]((_0x311eaa,_0x34029e)=>{_0x35a6b8[_0x34029e]['secondary_code']=_0x311eaa;}),_0x1cf24a['forEach']((_0x36f98b,_0x10e87d)=>{var _0x3825cf=_0x186ca2;_0x35a6b8[_0x10e87d][_0x3825cf(0x23b)]=_0x36f98b;}),_0x40ee9e[_0x186ca2(0x229)]((_0x2612db,_0x1e0460)=>{_0x35a6b8[_0x1e0460]['bay']=_0x2612db;}),_0x252642['forEach']((_0x3774a2,_0x3b5cd5)=>{var _0xb2c10e=_0x186ca2;_0x35a6b8[_0x3b5cd5][_0xb2c10e(0x1cd)]=_0x3774a2;}),_0x42a6e8['forEach']((_0x4acdca,_0x431a7f)=>{var _0x4b7021=_0x186ca2;_0x35a6b8[_0x431a7f][_0x4b7021(0x214)]=_0x4acdca;}),_0x34c133[_0x186ca2(0x229)]((_0x375454,_0x5cd9d)=>{var _0x572cda=_0x186ca2;_0x35a6b8[_0x5cd9d][_0x572cda(0x264)]=_0x375454;}),_0x37ae99['forEach']((_0x4b12cb,_0xc4356f)=>{var _0x389bc5=_0x186ca2;_0x35a6b8[_0xc4356f][_0x389bc5(0x250)]=_0x4b12cb;}),_0x50ee83[_0x186ca2(0x229)]((_0x5b6b33,_0x8c0505)=>{var _0x385def=_0x186ca2;_0x35a6b8[_0x8c0505][_0x385def(0x21f)]=_0x5b6b33;}),_0x177f6b[_0x186ca2(0x229)]((_0x484b22,_0x45aee9)=>{var _0x4ba2f8=_0x186ca2;_0x35a6b8[_0x45aee9][_0x4ba2f8(0x1e3)]=_0x484b22;}),_0x161214['forEach']((_0x3f5bcb,_0x9d71dc)=>{var _0x2b7d30=_0x186ca2;_0x35a6b8[_0x9d71dc][_0x2b7d30(0x1d3)]=_0x3f5bcb;}),_0x471830[_0x186ca2(0x229)]((_0x11a62a,_0x376e68)=>{_0x35a6b8[_0x376e68]['room_name']=_0x11a62a;}),_0x415d08[_0x186ca2(0x229)]((_0x2ceee2,_0x39ef02)=>{var _0xf0fbec=_0x186ca2;_0x35a6b8[_0x39ef02][_0xf0fbec(0x1e4)]=_0x2ceee2;});var _0x350b56=0x0;_0x35a6b8[_0x186ca2(0x229)](_0x34a73e=>{var _0x324cfa=_0x186ca2;parseFloat(_0x34a73e['stock'])<parseFloat(_0x34a73e[_0x324cfa(0x240)])&&parseFloat(_0x34a73e[_0x324cfa(0x240)])>parseFloat(_0x34a73e[_0x324cfa(0x238)])&&(console[_0x324cfa(0x15a)](_0x34a73e[_0x324cfa(0x238)]+'\x20<>\x20'+_0x34a73e[_0x324cfa(0x240)]),_0x350b56++);});if(_0x350b56!=0x0)return _0x5aba08[_0x186ca2(0x19a)]('errors',_0x186ca2(0x25e)),_0x40e21c[_0x186ca2(0x1d7)]('back');const _0x43b8f3=_0x35a6b8[_0x186ca2(0x190)](_0x1677f8=>_0x1677f8[_0x186ca2(0x240)]!=='0'&&_0x1677f8[_0x186ca2(0x240)]!==''),_0x51a57c=new sales_finished({'invoice':_0x32adec,'customer':_0x5aba08['body'][_0x186ca2(0x246)],'date':_0x2625f7,'warehouse_name':_0x57c520,'sale_product':_0x43b8f3,'note':_0x4318,'room':_0x7f0813,'primary_code':_0x1ef928,'secondary_code':_0x5712bc,'prod_code':_0x87d10f,'SCRN':_0x52698e,'finalize':'False','mode_transpo':_0x5de2a2,'name_driver':_0x534096}),_0x1dfe26=await _0x51a57c[_0x186ca2(0x201)](),_0xafbb51=await sales_finished[_0x186ca2(0x193)]({'invoice':_0x32adec}),_0x1ec4f9=new c_payment_data({'invoice':_0x32adec,'customer':_0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x246)],'reason':'Sale'});await _0x1ec4f9[_0x186ca2(0x201)]();const _0x188ba6=await master_shop[_0x186ca2(0x1b2)](),_0x430c40=await email_settings['findOne'](),_0x38c6d9=await customer[_0x186ca2(0x193)]({'name':_0x5aba08[_0x186ca2(0x1b0)][_0x186ca2(0x246)]});_0x188ba6[0x0]['currency_placement']==0x1?(right_currency=_0x188ba6[0x0][_0x186ca2(0x255)],left_currency=''):(right_currency='',left_currency=_0x188ba6[0x0][_0x186ca2(0x255)]);var _0x3a55e5=_0x25f580,_0x21cd94=_0xfb5790,_0x458b73='',_0x1f02e4;for(_0x1f02e4 in _0x3a55e5){_0x458b73+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a55e5[_0x1f02e4]+_0x186ca2(0x261)+_0x186ca2(0x1f3)+_0x21cd94[_0x1f02e4]+_0x186ca2(0x261)+'</tr>';}console[_0x186ca2(0x15a)](_0x186ca2(0x17b),_0x458b73),_0x5aba08[_0x186ca2(0x19a)](_0x186ca2(0x1b6),_0x186ca2(0x159)),_0x40e21c['redirect'](_0x186ca2(0x225)+_0x1dfe26[_0x186ca2(0x160)]);}catch(_0x26dd2b){console[_0x186ca2(0x15a)](_0x26dd2b);}}),router['get'](a0_0x23c228(0x254),auth,async(_0x337261,_0x266823)=>{var _0x11a25f=a0_0x23c228;try{const {username:_0xde96e6,email:_0x27f617,role:_0x10ff83}=_0x337261[_0x11a25f(0x1f0)],_0x3a5525=_0x337261[_0x11a25f(0x1f0)],_0x37c8d8=await profile[_0x11a25f(0x193)]({'email':_0x3a5525[_0x11a25f(0x169)]}),_0x3bb413=await master_shop[_0x11a25f(0x1b2)](),_0x3f5855=_0x337261['params']['id'],_0xe9296a=await sales_finished[_0x11a25f(0x269)](_0x3f5855),_0x55787f=await warehouse[_0x11a25f(0x222)]([{'$match':{'name':_0xe9296a['warehouse_name']}},{'$unwind':_0x11a25f(0x17f)},{'$group':{'_id':_0x11a25f(0x220),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x11a25f(0x1d2)},'bay':{'$first':_0x11a25f(0x211)},'bin':{'$first':_0x11a25f(0x205)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x11a25f(0x221)},'primary_code':{'$first':_0x11a25f(0x21e)},'secondary_code':{'$first':_0x11a25f(0x170)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x11a25f(0x150)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x11a25f(0x235)},'batch_code':{'$first':_0x11a25f(0x167)},'room':{'$first':_0x11a25f(0x1aa)},'room_data':{'$first':_0x11a25f(0x181)}}}]),_0x4b1ef9=await customer[_0x11a25f(0x1b2)]({});let _0x15fe96;if(_0x3a5525[_0x11a25f(0x226)]=='staff'){const _0x138708=await staff['findOne']({'email':_0x3a5525[_0x11a25f(0x169)]});_0x15fe96=await warehouse[_0x11a25f(0x222)]([{'$match':{'status':_0x11a25f(0x166),'name':_0x138708[_0x11a25f(0x1e5)]}},{'$group':{'_id':_0x11a25f(0x20f),'name':{'$first':'$name'}}}]);}else _0x15fe96=await warehouse[_0x11a25f(0x222)]([{'$match':{'status':_0x11a25f(0x166)}},{'$group':{'_id':_0x11a25f(0x20f),'name':{'$first':_0x11a25f(0x20f)}}}]);const _0x4aadaa=await product['find']({});if(_0x3bb413[0x0][_0x11a25f(0x252)]==_0x11a25f(0x1a5)){var _0x30926c=users[_0x11a25f(0x24b)];console['log'](_0x30926c);}else{if(_0x3bb413[0x0][_0x11a25f(0x252)]==_0x11a25f(0x1a8))var _0x30926c=users[_0x11a25f(0x1a8)];else{if(_0x3bb413[0x0]['language']==_0x11a25f(0x17e))var _0x30926c=users[_0x11a25f(0x17e)];else{if(_0x3bb413[0x0]['language']==_0x11a25f(0x24c))var _0x30926c=users[_0x11a25f(0x24c)];else{if(_0x3bb413[0x0][_0x11a25f(0x252)]==_0x11a25f(0x189))var _0x30926c=users['French'];else{if(_0x3bb413[0x0]['language']==_0x11a25f(0x1fd))var _0x30926c=users[_0x11a25f(0x1d0)];else{if(_0x3bb413[0x0]['language']=='Chinese')var _0x30926c=users[_0x11a25f(0x232)];else{if(_0x3bb413[0x0][_0x11a25f(0x252)]==_0x11a25f(0x1c5))var _0x30926c=users[_0x11a25f(0x1a1)];}}}}}}}_0x266823[_0x11a25f(0x163)](_0x11a25f(0x21c),{'success':_0x337261[_0x11a25f(0x19a)](_0x11a25f(0x1b6)),'errors':_0x337261[_0x11a25f(0x19a)](_0x11a25f(0x161)),'role':_0x3a5525,'profile':_0x37c8d8,'customer':_0x4b1ef9,'warehouse':_0x15fe96,'product':_0x55787f,'user':_0xe9296a,'master_shop':_0x3bb413,'unit':_0x4aadaa,'language':_0x30926c});}catch(_0x82ba38){console['log'](_0x82ba38);}}),router[a0_0x23c228(0x1da)](a0_0x23c228(0x254),auth,async(_0xaf1638,_0x5bae50)=>{var _0x572712=a0_0x23c228;try{const _0x25daf4=_0xaf1638['params']['id'],{invoice:_0x5a55d3,warehouse_name:_0x536c98,room:_0x5dde25}=_0xaf1638[_0x572712(0x1b0)],_0x25f5a0=await sales_finished[_0x572712(0x193)]({'invoice':_0x5a55d3}),_0xcecf5e=_0x25f5a0['sale_product'][_0x572712(0x1e7)](async _0x3d1170=>{var _0x1a6687=_0x572712,_0x47c8bd=await warehouse['findOne']({'name':_0x536c98,'room':_0x3d1170[_0x1a6687(0x20b)],'warehouse_category':_0x1a6687(0x22e)});const _0x47aa5c=_0x47c8bd[_0x1a6687(0x1e9)]['map'](_0x119636=>{var _0x374a7c=_0x1a6687;_0x119636[_0x374a7c(0x196)]==_0x3d1170[_0x374a7c(0x196)]&&_0x119636[_0x374a7c(0x218)]==_0x3d1170[_0x374a7c(0x218)]&&_0x119636[_0x374a7c(0x250)]==_0x3d1170[_0x374a7c(0x250)]&&_0x119636['production_date']==_0x3d1170[_0x374a7c(0x21f)]&&_0x119636['batch_code']==_0x3d1170['batch_code']&&_0x119636[_0x374a7c(0x160)]==_0x3d1170[_0x374a7c(0x25b)]&&(_0x119636['product_stock']>0x0&&(console[_0x374a7c(0x15a)](_0x119636['product_name']+'\x20==\x20'+_0x3d1170[_0x374a7c(0x196)]+_0x374a7c(0x1ee)+_0x119636[_0x374a7c(0x218)]+_0x374a7c(0x154)+_0x3d1170[_0x374a7c(0x218)]+_0x374a7c(0x1ee)+_0x119636[_0x374a7c(0x21f)]+_0x374a7c(0x154)+_0x3d1170[_0x374a7c(0x21f)]+'\x20&&\x20'+_0x119636[_0x374a7c(0x250)]+'\x20==\x20'+_0x3d1170[_0x374a7c(0x250)]+'\x20&&\x20'+_0x119636[_0x374a7c(0x264)]+_0x374a7c(0x154)+_0x3d1170[_0x374a7c(0x264)]+_0x374a7c(0x1ee)+_0x119636[_0x374a7c(0x1e4)]+_0x374a7c(0x154)+_0x3d1170[_0x374a7c(0x1e4)]+_0x374a7c(0x1ee)+_0x119636[_0x374a7c(0x20d)]+_0x374a7c(0x16f)+_0x3d1170[_0x374a7c(0x240)]+_0x374a7c(0x263)+_0x3d1170[_0x374a7c(0x20b)]+_0x374a7c(0x1ee)+_0x119636[_0x374a7c(0x160)]+'\x20==\x20'+_0x3d1170[_0x374a7c(0x25b)]),_0x119636[_0x374a7c(0x20d)]=Math[_0x374a7c(0x239)](0x0,Math['abs'](_0x119636[_0x374a7c(0x20d)])-Math[_0x374a7c(0x22f)](_0x3d1170[_0x374a7c(0x240)]))));});return _0x47c8bd;});Promise[_0x572712(0x1de)](_0xcecf5e)[_0x572712(0x1b7)](async _0xb8429c=>{var _0x4658f7=_0x572712;try{for(const _0x3aa22d of _0xb8429c){await _0x3aa22d[_0x4658f7(0x201)]();}_0x25f5a0['finalize']=_0x4658f7(0x256);const _0x2ca9a0=await _0x25f5a0[_0x4658f7(0x201)](),_0xfacc56=await master_shop[_0x4658f7(0x1b2)](),_0x28c3c1=await email_settings[_0x4658f7(0x193)](),_0xc96a86=await supervisor_settings[_0x4658f7(0x1b2)]();var _0x147bde=_0x25f5a0['sale_product'],_0x5e2cbd='',_0x4b714d;for(_0x4b714d in _0x147bde){var _0x2a2fa5='FG';_0x25f5a0[_0x4658f7(0x192)]==_0x4658f7(0x17c)&&(_0x2a2fa5='DG'),_0x5e2cbd+=_0x4658f7(0x1f1)+_0x4658f7(0x1f3)+_0x147bde[_0x4b714d][_0x4658f7(0x196)]+_0x4658f7(0x261)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x147bde[_0x4b714d][_0x4658f7(0x23b)]+_0x4658f7(0x261)+_0x4658f7(0x1f3)+_0x147bde[_0x4b714d][_0x4658f7(0x240)]+_0x4658f7(0x261)+_0x4658f7(0x1f3)+_0x147bde[_0x4b714d][_0x4658f7(0x1cd)]+_0x4658f7(0x261)+_0x4658f7(0x1f3)+_0x147bde[_0x4b714d][_0x4658f7(0x214)]+_0x4658f7(0x261)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x25f5a0['warehouse_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x147bde[_0x4b714d]['room_name']+_0x4658f7(0x261)+_0x4658f7(0x1f3)+_0x2a2fa5+_0x147bde[_0x4b714d]['bay']+'</td>';}let _0x35094f=nodemailer['createTransport']({'host':_0x28c3c1[_0x4658f7(0x241)],'port':Number(_0x28c3c1[_0x4658f7(0x1ba)]),'secure':![],'auth':{'user':_0x28c3c1[_0x4658f7(0x169)],'pass':_0x28c3c1[_0x4658f7(0x233)]}}),_0x193d50={'from':_0x28c3c1[_0x4658f7(0x169)],'to':_0xc96a86[0x0]['FGSEmail'],'subject':_0x4658f7(0x1b8),'attachments':[{'filename':_0x4658f7(0x1a3),'path':__dirname+_0x4658f7(0x227)+_0x4658f7(0x23e)+_0xfacc56[0x0][_0x4658f7(0x245)],'cid':_0x4658f7(0x15b)}],'html':_0x4658f7(0x1f6)+_0x4658f7(0x206)+'</head><body>'+'<div>'+_0x4658f7(0x208)+_0x4658f7(0x177)+_0x4658f7(0x260)+_0x4658f7(0x259)+'<div>'+_0x4658f7(0x1c6)+_0xfacc56[0x0][_0x4658f7(0x200)]+'\x20</h2>'+_0x4658f7(0x259)+_0x4658f7(0x259)+_0x4658f7(0x185)+_0x4658f7(0x177)+_0x4658f7(0x171)+'\x20Order\x20Number\x20:\x20'+_0x25f5a0[_0x4658f7(0x1e4)]+'\x20'+_0x4658f7(0x18f)+_0x4658f7(0x16e)+_0x25f5a0[_0x4658f7(0x219)]+'\x20'+_0x4658f7(0x1e6)+_0x4658f7(0x1b5)+_0x4658f7(0x259)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4658f7(0x1f1)+_0x4658f7(0x20a)+_0x4658f7(0x1b3)+_0x4658f7(0x23c)+_0x4658f7(0x1c4)+_0x4658f7(0x162)+_0x4658f7(0x199)+_0x4658f7(0x151)+_0x4658f7(0x1e1)+_0x4658f7(0x17d)+_0x4658f7(0x194)+_0x4658f7(0x217)+'\x20'+_0x5e2cbd+'\x20'+_0x4658f7(0x155)+_0x4658f7(0x22c)+'<div>'+_0x4658f7(0x265)+_0x4658f7(0x20c)+_0xfacc56[0x0][_0x4658f7(0x200)]+_0x4658f7(0x1b5)+_0x4658f7(0x259)+_0x4658f7(0x259)+_0x4658f7(0x244)};_0x35094f[_0x4658f7(0x1f8)](_0x193d50,function(_0x234b73,_0x5ae8b5){var _0x68766d=_0x4658f7;_0x234b73?(console['log'](_0x234b73),console[_0x68766d(0x15a)](_0x68766d(0x1b9))):console[_0x68766d(0x15a)]('Email\x20sent\x20successfully');}),_0xaf1638[_0x4658f7(0x19a)](_0x4658f7(0x1b6),_0x4658f7(0x1bc)),_0x5bae50[_0x4658f7(0x1d7)](_0x4658f7(0x212)+_0x25daf4);}catch(_0x564578){console['error'](_0x564578),_0x5bae50[_0x4658f7(0x1f7)](0x1f4)[_0x4658f7(0x215)]({'error':_0x4658f7(0x249)});}})[_0x572712(0x164)](_0x55f77a=>{var _0x53f9d3=_0x572712;console[_0x53f9d3(0x1fa)](_0x55f77a),_0x5bae50[_0x53f9d3(0x1f7)](0x1f4)[_0x53f9d3(0x215)]({'error':_0x53f9d3(0x22d)});});}catch(_0x144dc3){console[_0x572712(0x15a)](_0x144dc3);}}),router[a0_0x23c228(0x1b4)](a0_0x23c228(0x1cb),auth,async(_0x5e6671,_0x34f5d9)=>{var _0x52365e=a0_0x23c228;try{const {username:_0x1a612e,email:_0x3c57d3,role:_0x13e60c}=_0x5e6671['user'],_0x57f009=_0x5e6671[_0x52365e(0x1f0)],_0x212e9f=await profile['findOne']({'email':_0x57f009[_0x52365e(0x169)]}),_0x51bf7e=await master_shop[_0x52365e(0x1b2)](),_0x48b7fa=_0x5e6671['params']['id'],_0x14343c=await sales_finished[_0x52365e(0x269)](_0x48b7fa);let _0x458348=new Date(_0x14343c['expiry_date']),_0x189efd=('0'+_0x458348[_0x52365e(0x22b)]())['slice'](-0x2),_0x396688=('0'+(_0x458348['getMonth']()+0x1))[_0x52365e(0x231)](-0x2),_0xfcfbf2=_0x458348[_0x52365e(0x19d)](),_0x132f85=_0xfcfbf2+'-'+_0x396688+'-'+_0x189efd;var _0x5349c2=[_0x52365e(0x168),_0x52365e(0x187)];const _0xc14eaa=await warehouse[_0x52365e(0x222)]([{'$match':{'name':_0x14343c[_0x52365e(0x192)],'room':_0x14343c[_0x52365e(0x165)]}},{'$unwind':_0x52365e(0x17f)},{'$group':{'_id':_0x52365e(0x220),'name':{'$first':_0x52365e(0x1df)},'product_stock':{'$first':_0x52365e(0x1d2)},'bay':{'$first':_0x52365e(0x211)},'bin':{'$first':_0x52365e(0x205)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x52365e(0x221)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x52365e(0x23d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x52365e(0x1dd)}}}]),_0x290c77=await customer[_0x52365e(0x1b2)]({});let _0x217258;if(_0x57f009[_0x52365e(0x226)]==_0x52365e(0x15d)){const _0x5e6e23=await staff[_0x52365e(0x193)]({'email':_0x57f009[_0x52365e(0x169)]});_0x217258=await warehouse[_0x52365e(0x222)]([{'$match':{'status':_0x52365e(0x166),'name':_0x5e6e23[_0x52365e(0x1e5)]}},{'$group':{'_id':_0x52365e(0x20f),'name':{'$first':_0x52365e(0x20f)}}}]);}else _0x217258=await warehouse[_0x52365e(0x222)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x52365e(0x20f)}}}]);const _0x391883=await product['find']({});if(_0x51bf7e[0x0][_0x52365e(0x252)]==_0x52365e(0x1a5)){var _0x445a19=users[_0x52365e(0x24b)];console['log'](_0x445a19);}else{if(_0x51bf7e[0x0][_0x52365e(0x252)]=='Hindi')var _0x445a19=users[_0x52365e(0x1a8)];else{if(_0x51bf7e[0x0][_0x52365e(0x252)]==_0x52365e(0x17e))var _0x445a19=users[_0x52365e(0x17e)];else{if(_0x51bf7e[0x0]['language']==_0x52365e(0x24c))var _0x445a19=users['Spanish'];else{if(_0x51bf7e[0x0]['language']=='French')var _0x445a19=users[_0x52365e(0x189)];else{if(_0x51bf7e[0x0][_0x52365e(0x252)]=='Portuguese\x20(BR)')var _0x445a19=users['Portuguese'];else{if(_0x51bf7e[0x0][_0x52365e(0x252)]==_0x52365e(0x232))var _0x445a19=users[_0x52365e(0x232)];else{if(_0x51bf7e[0x0]['language']==_0x52365e(0x1c5))var _0x445a19=users[_0x52365e(0x1a1)];}}}}}}}_0x34f5d9['render'](_0x52365e(0x23a),{'success':_0x5e6671[_0x52365e(0x19a)](_0x52365e(0x1b6)),'errors':_0x5e6671['flash']('errors'),'role':_0x57f009,'profile':_0x212e9f,'customer':_0x290c77,'warehouse':_0x217258,'product':_0xc14eaa,'user':_0x14343c,'master_shop':_0x51bf7e,'unit':_0x391883,'language':_0x445a19,'rooms_data':_0x5349c2,'ed_fullDate':_0x132f85});}catch(_0x18c979){console[_0x52365e(0x15a)](_0x18c979);}}),router[a0_0x23c228(0x1da)](a0_0x23c228(0x1cb),auth,async(_0x47ec39,_0x5b2fb7)=>{var _0x3ae9ae=a0_0x23c228;try{const _0x5413b3=_0x47ec39['params']['id'],_0x445948=await sales_finished[_0x3ae9ae(0x193)]({'_id':_0x47ec39['params']['id']}),_0x2d2161=await warehouse['findOne']({'name':_0x445948[_0x3ae9ae(0x192)],'room':_0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x165)],'warehouse_category':_0x3ae9ae(0x22e)}),{invoice:_0x21ad24,customer:_0x46f0f8,date:_0x2c8810,warehouse_name:_0x154403,product_name:_0xdff539,stock:_0x572f69,adjust_qty:_0x1d25d7,note:_0x19109d,room:_0x49a382,primary_code:_0x3724ae,secondary_code:_0x585d77,prod_code:_0x374b9b,level:_0x3bd3f3,isle:_0x1eb394,pallet:_0x5c9b5f,expiry_date:_0x467644}=_0x47ec39[_0x3ae9ae(0x1b0)];if(typeof _0xdff539==_0x3ae9ae(0x24e))var _0x5f3d19=[_0x47ec39['body'][_0x3ae9ae(0x196)]],_0x2e554f=[_0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x238)]],_0xcc1f13=[_0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x1cc)]],_0x1d9654=[_0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x1c0)]],_0x374d4b=[_0x47ec39['body'][_0x3ae9ae(0x153)]],_0x148743=[_0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x213)]],_0x3420ff=[_0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x248)]],_0x4c479e=[_0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x250)]];else var _0x5f3d19=[..._0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x196)]],_0x2e554f=[..._0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x238)]],_0xcc1f13=[..._0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x1cc)]],_0x1d9654=[..._0x47ec39['body'][_0x3ae9ae(0x1c0)]],_0x374d4b=[..._0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x153)]],_0x148743=[..._0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x213)]],_0x3420ff=[..._0x47ec39[_0x3ae9ae(0x1b0)]['level']],_0x4c479e=[..._0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x250)]];const _0x399f9b=_0x5f3d19[_0x3ae9ae(0x1e7)](_0x2c200c=>{return _0x2c200c={'product_name':_0x2c200c};});_0x2e554f[_0x3ae9ae(0x229)]((_0x43d50b,_0x20b967)=>{var _0x23acd0=_0x3ae9ae;_0x399f9b[_0x20b967][_0x23acd0(0x238)]=_0x43d50b;}),_0xcc1f13[_0x3ae9ae(0x229)]((_0x294159,_0x34fe48)=>{var _0x1a165a=_0x3ae9ae;_0x399f9b[_0x34fe48][_0x1a165a(0x240)]=_0x294159;}),_0x1d9654[_0x3ae9ae(0x229)]((_0x28c4e7,_0x178280)=>{var _0x36caa8=_0x3ae9ae;_0x399f9b[_0x178280][_0x36caa8(0x1c0)]=_0x28c4e7;}),_0x374d4b['forEach']((_0x3a4f03,_0x3e413b)=>{var _0x1cecd4=_0x3ae9ae;_0x399f9b[_0x3e413b][_0x1cecd4(0x153)]=_0x3a4f03;}),_0x148743['forEach']((_0x4b3051,_0x341304)=>{_0x399f9b[_0x341304]['product_code']=_0x4b3051;}),_0x3420ff[_0x3ae9ae(0x229)]((_0xdb9120,_0x51ea72)=>{var _0x4931d3=_0x3ae9ae;_0x399f9b[_0x51ea72][_0x4931d3(0x248)]=_0xdb9120;}),_0x4c479e[_0x3ae9ae(0x229)]((_0x376069,_0x15dd7f)=>{var _0x1dcf37=_0x3ae9ae;_0x399f9b[_0x15dd7f][_0x1dcf37(0x250)]=_0x376069;});var _0x5a23bb=0x0;_0x399f9b['forEach'](_0x56c981=>{var _0x16e213=_0x3ae9ae;console[_0x16e213(0x15a)](_0x16e213(0x1f5),_0x56c981),(parseInt(_0x56c981[_0x16e213(0x238)])<parseInt(_0x56c981['quantity'])||parseInt(_0x56c981[_0x16e213(0x240)])==0x0)&&_0x5a23bb++;});if(_0x5a23bb!=0x0)return _0x47ec39[_0x3ae9ae(0x19a)](_0x3ae9ae(0x161),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x5b2fb7[_0x3ae9ae(0x1d7)](_0x3ae9ae(0x158));_0x445948[_0x3ae9ae(0x16d)][_0x3ae9ae(0x229)](_0x1088c1=>{var _0xa3107=_0x3ae9ae;const _0x5c240e=_0x2d2161[_0xa3107(0x1e9)]['map'](_0xfacfd6=>{var _0x129ac5=_0xa3107;_0xfacfd6[_0x129ac5(0x196)]==_0x1088c1['product_name']&&_0xfacfd6[_0x129ac5(0x218)]==_0x1088c1['bay']&&(_0xfacfd6[_0x129ac5(0x20d)]=parseInt(_0xfacfd6['product_stock'])+parseInt(_0x1088c1['quantity']));});}),await _0x2d2161[_0x3ae9ae(0x201)]();const _0x5a14ac=_0x399f9b['filter'](_0x1cb039=>_0x1cb039['quantity']!=='0'&&_0x1cb039['quantity']!=='');_0x445948[_0x3ae9ae(0x1e4)]=_0x21ad24,_0x445948['customer']=_0x46f0f8,_0x445948[_0x3ae9ae(0x219)]=_0x2c8810,_0x445948[_0x3ae9ae(0x192)]=_0x154403,_0x445948['sale_product']=_0x5a14ac,_0x445948[_0x3ae9ae(0x18b)]=_0x19109d,_0x445948[_0x3ae9ae(0x165)]=_0x49a382;const _0x18cb28=await _0x445948[_0x3ae9ae(0x201)](),_0x951164=await sales_finished[_0x3ae9ae(0x193)]({'_id':_0x47ec39[_0x3ae9ae(0x1ea)]['id']}),_0x270653=await warehouse['findOne']({'name':_0x154403,'room':_0x49a382,'warehouse_category':_0x3ae9ae(0x22e)});_0x951164[_0x3ae9ae(0x16d)][_0x3ae9ae(0x229)](_0x18c612=>{var _0x54b8f4=_0x3ae9ae;const _0x4386a1=_0x270653[_0x54b8f4(0x1e9)][_0x54b8f4(0x1e7)](_0x25c0d9=>{var _0x27f24c=_0x54b8f4;_0x25c0d9[_0x27f24c(0x196)]==_0x18c612[_0x27f24c(0x196)]&&_0x25c0d9[_0x27f24c(0x218)]==_0x18c612[_0x27f24c(0x218)]&&(_0x25c0d9[_0x27f24c(0x20d)]=parseInt(_0x25c0d9[_0x27f24c(0x20d)])-parseInt(_0x18c612['quantity']));});}),console[_0x3ae9ae(0x15a)](_0x3ae9ae(0x184),_0x270653),await _0x270653[_0x3ae9ae(0x201)]();const _0x147468=await c_payment_data[_0x3ae9ae(0x193)]({'invoice':_0x47ec39[_0x3ae9ae(0x1b0)][_0x3ae9ae(0x1e4)]});_0x147468[_0x3ae9ae(0x228)]=_0x47ec39['body'][_0x3ae9ae(0x228)],await _0x147468[_0x3ae9ae(0x201)](),_0x47ec39[_0x3ae9ae(0x19a)](_0x3ae9ae(0x1b6),_0x3ae9ae(0x1bc)),_0x5b2fb7['redirect'](_0x3ae9ae(0x22a));}catch(_0x592d76){console['log'](_0x592d76);}}),router['post'](a0_0x23c228(0x157),auth,async(_0x237c34,_0x483065)=>{var _0x5f53a0=a0_0x23c228;try{const _0x49c5e6=_0x237c34[_0x5f53a0(0x1ea)]['id'],{invoice:_0xb55c9d,customer:_0x3e6bf4,receivable_amount:_0x4fa3e5,received_amount:_0x2feff2}=_0x237c34[_0x5f53a0(0x1b0)],_0x413461=await sales[_0x5f53a0(0x269)](_0x49c5e6);console[_0x5f53a0(0x15a)](_0x413461);var _0x5a0e68=_0x4fa3e5-_0x2feff2;console[_0x5f53a0(0x15a)](_0x2feff2),_0x413461[_0x5f53a0(0x197)]=parseFloat(_0x2feff2)+parseFloat(_0x413461[_0x5f53a0(0x197)]),_0x413461[_0x5f53a0(0x186)]=_0x5a0e68,console['log'](_0x413461);const _0x42628f=await _0x413461['save'](),_0x55a06c=await c_payment_data[_0x5f53a0(0x193)]({'invoice':_0xb55c9d});_0x55a06c[_0x5f53a0(0x236)]=_0x5a0e68,await _0x55a06c['save']();let _0x1a8b61=new Date(),_0x3bc590=('0'+_0x1a8b61[_0x5f53a0(0x22b)]())[_0x5f53a0(0x231)](-0x2),_0x2d63cd=('0'+(_0x1a8b61['getMonth']()+0x1))[_0x5f53a0(0x231)](-0x2),_0x361916=_0x1a8b61[_0x5f53a0(0x19d)](),_0x54147c=_0x361916+'-'+_0x2d63cd+'-'+_0x3bc590;const _0xf2ed38=new customer_payment({'invoice':_0xb55c9d,'date':_0x361916+'-'+_0x2d63cd+'-'+_0x3bc590,'customer':_0x3e6bf4,'reason':_0x5f53a0(0x18e),'amount':_0x2feff2}),_0x24e6be=await _0xf2ed38['save']();_0x237c34[_0x5f53a0(0x19a)]('success',_0x5f53a0(0x1d1)),_0x483065[_0x5f53a0(0x1d7)]('/all_sales/view');}catch(_0x4cebfa){console[_0x5f53a0(0x15a)](_0x4cebfa);}}),router['get']('/invoice/:id',auth,async(_0x52c42e,_0x15d93b)=>{var _0x240e79=a0_0x23c228;try{const {username:_0x3d3782,email:_0x4eba1b,role:_0x211fb1}=_0x52c42e[_0x240e79(0x1f0)],_0x165b46=_0x52c42e[_0x240e79(0x1f0)],_0x4a5279=await profile['findOne']({'email':_0x165b46[_0x240e79(0x169)]}),_0x505d28=await master_shop[_0x240e79(0x1b2)]();console[_0x240e79(0x15a)](_0x240e79(0x21d),_0x505d28);const _0x37cb84=_0x52c42e[_0x240e79(0x1ea)]['id'],_0x33e7a0=await sales[_0x240e79(0x269)](_0x37cb84);console['log'](_0x33e7a0);const _0x11fb71=await customer[_0x240e79(0x193)]({'name':_0x33e7a0[_0x240e79(0x246)]});console[_0x240e79(0x15a)](_0x11fb71);if(_0x505d28[0x0]['language']==_0x240e79(0x1a5)){var _0x15f77e=users['English'];console[_0x240e79(0x15a)](_0x15f77e);}else{if(_0x505d28[0x0][_0x240e79(0x252)]=='Hindi')var _0x15f77e=users[_0x240e79(0x1a8)];else{if(_0x505d28[0x0]['language']=='German')var _0x15f77e=users['German'];else{if(_0x505d28[0x0][_0x240e79(0x252)]==_0x240e79(0x24c))var _0x15f77e=users[_0x240e79(0x24c)];else{if(_0x505d28[0x0][_0x240e79(0x252)]==_0x240e79(0x189))var _0x15f77e=users[_0x240e79(0x189)];else{if(_0x505d28[0x0]['language']=='Portuguese\x20(BR)')var _0x15f77e=users['Portuguese'];else{if(_0x505d28[0x0][_0x240e79(0x252)]=='Chinese')var _0x15f77e=users[_0x240e79(0x232)];else{if(_0x505d28[0x0][_0x240e79(0x252)]=='Arabic\x20(ae)')var _0x15f77e=users[_0x240e79(0x1a1)];}}}}}}}_0x15d93b[_0x240e79(0x163)](_0x240e79(0x210),{'success':_0x52c42e[_0x240e79(0x19a)](_0x240e79(0x1b6)),'errors':_0x52c42e['flash'](_0x240e79(0x161)),'role':_0x165b46,'profile':_0x4a5279,'master_shop':_0x505d28,'customers':_0x11fb71,'sales':_0x33e7a0,'language':_0x15f77e});}catch(_0xb6fe){console['log'](_0xb6fe);}}),router['get'](a0_0x23c228(0x1ed),auth,async(_0x21fc47,_0x2e11b9)=>{var _0x1e3ffc=a0_0x23c228;try{const {username:_0x30a01d,email:_0x550bf9,role:_0x1765b2}=_0x21fc47[_0x1e3ffc(0x1f0)],_0x258d13=_0x21fc47['user'],_0x17bc7f=await profile[_0x1e3ffc(0x193)]({'email':_0x258d13['email']}),_0x37dc16=await master_shop[_0x1e3ffc(0x1b2)](),_0x401eb1=_0x21fc47['params']['id'],_0x310009=await sales_finished[_0x1e3ffc(0x269)](_0x401eb1),_0x3b7095=await warehouse[_0x1e3ffc(0x222)]([{'$match':{'name':_0x310009[_0x1e3ffc(0x192)]}},{'$unwind':_0x1e3ffc(0x17f)},{'$group':{'_id':_0x1e3ffc(0x220),'name':{'$first':_0x1e3ffc(0x1df)},'product_stock':{'$first':_0x1e3ffc(0x1d2)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1e3ffc(0x262)},'floorlevel':{'$first':_0x1e3ffc(0x221)},'primary_code':{'$first':_0x1e3ffc(0x21e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x1e3ffc(0x150)},'rack':{'$first':_0x1e3ffc(0x1dd)},'expiry_date':{'$first':_0x1e3ffc(0x243)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0x1e3ffc(0x1a4)},'secondary_unit':{'$first':_0x1e3ffc(0x188)},'maxProducts':{'$first':_0x1e3ffc(0x1fe)},'batch_code':{'$first':_0x1e3ffc(0x167)},'maxPerUnit':{'$first':_0x1e3ffc(0x16c)}}}]),_0x218d02=await product['find']({}),_0x4f56c8=await warehouse['aggregate']([{'$match':{'status':_0x1e3ffc(0x166),'warehouse_category':_0x1e3ffc(0x22e),'name':{'$ne':'Return\x20Goods','$ne':_0x1e3ffc(0x1ce)}}},{'$group':{'_id':_0x1e3ffc(0x20f),'name':{'$first':_0x1e3ffc(0x20f)}}},{'$sort':{'name':0x1}}]);var _0x193836=[_0x1e3ffc(0x24d)];const _0x134271=await warehouse[_0x1e3ffc(0x222)]([{'$match':{'status':_0x1e3ffc(0x166),'name':_0x1e3ffc(0x1ce)}},{'$group':{'_id':_0x1e3ffc(0x20f),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x37dc16[0x0][_0x1e3ffc(0x252)]=='English\x20(US)'){var _0xd8c345=users[_0x1e3ffc(0x24b)];console[_0x1e3ffc(0x15a)](_0xd8c345);}else{if(_0x37dc16[0x0]['language']==_0x1e3ffc(0x1a8))var _0xd8c345=users['Hindi'];else{if(_0x37dc16[0x0][_0x1e3ffc(0x252)]==_0x1e3ffc(0x17e))var _0xd8c345=users[_0x1e3ffc(0x17e)];else{if(_0x37dc16[0x0][_0x1e3ffc(0x252)]==_0x1e3ffc(0x24c))var _0xd8c345=users[_0x1e3ffc(0x24c)];else{if(_0x37dc16[0x0][_0x1e3ffc(0x252)]==_0x1e3ffc(0x189))var _0xd8c345=users[_0x1e3ffc(0x189)];else{if(_0x37dc16[0x0][_0x1e3ffc(0x252)]=='Portuguese\x20(BR)')var _0xd8c345=users[_0x1e3ffc(0x1d0)];else{if(_0x37dc16[0x0][_0x1e3ffc(0x252)]==_0x1e3ffc(0x232))var _0xd8c345=users['Chinese'];else{if(_0x37dc16[0x0][_0x1e3ffc(0x252)]==_0x1e3ffc(0x1c5))var _0xd8c345=users[_0x1e3ffc(0x1a1)];}}}}}}}_0x2e11b9[_0x1e3ffc(0x163)](_0x1e3ffc(0x182),{'success':_0x21fc47['flash'](_0x1e3ffc(0x1b6)),'errors':_0x21fc47['flash'](_0x1e3ffc(0x161)),'role':_0x258d13,'profile':_0x17bc7f,'user':_0x310009,'stock':_0x3b7095,'master_shop':_0x37dc16,'unit':_0x218d02,'language':_0xd8c345,'warehouses':_0x4f56c8,'rooms':_0x193836,'warehouse_QA':_0x134271});}catch(_0x939a1c){console[_0x1e3ffc(0x15a)](_0x939a1c),_0x2e11b9[_0x1e3ffc(0x1f7)](0xc8)[_0x1e3ffc(0x215)]({'message':_0x939a1c[_0x1e3ffc(0x230)]});}}),router['post']('/view/return_sales/:id',auth,async(_0x3314b1,_0x3f3cec)=>{var _0x1d5a27=a0_0x23c228;if(_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x152)]=='QA')try{const {invoice:_0x41d8ae,date:_0x469377,warehouse_name:_0x439796,product_name:_0x570a57,primary_code:_0x5228e6,secondary_code:_0x317b14,product_code:_0x309f47,sales_quantity:_0x22842e,stocks:_0x542bf0,return_qty:_0x4e9ddd,Room_name:_0x2b791f,to_warehouse_name_QA:_0x592f68,to_Room_name_QA:_0x34cb0f,note:_0x306d45,for_categorize:_0x3959e5,product_name_QA1:_0x3d580f}=_0x3314b1[_0x1d5a27(0x1b0)];if(typeof _0x3d580f==_0x1d5a27(0x24e))var _0x481661=[_0x3314b1[_0x1d5a27(0x1b0)]['product_name_QA1']],_0x55b300=[_0x3314b1['body']['primary_code_QA']],_0x4c0dbe=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x23f)]],_0x36b819=[_0x3314b1['body']['product_code_QA']],_0x3f511a=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1eb)]],_0xee4708=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x15e)]],_0x47ef25=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x16a)]],_0x4e8aad=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1ae)]],_0x147fa0=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x25d)]],_0x21f987=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1c7)]],_0x14eab5=[_0x3314b1['body']['secondary_unit_QA']],_0xa29208=[_0x3314b1['body'][_0x1d5a27(0x1fb)]],_0x3f7257=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x174)]],_0x1d4935=[_0x3314b1[_0x1d5a27(0x1b0)]['expiry_date_QA']];else var _0x481661=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1ff)]],_0x55b300=[..._0x3314b1['body']['primary_code_QA']],_0x4c0dbe=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x23f)]],_0x36b819=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x21a)]],_0x3f511a=[..._0x3314b1[_0x1d5a27(0x1b0)]['sales_quantity_QA']],_0xee4708=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x15e)]],_0x47ef25=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x16a)]],_0x4e8aad=[..._0x3314b1['body'][_0x1d5a27(0x1ae)]],_0x147fa0=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x25d)]],_0x21f987=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1c7)]],_0x14eab5=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x266)]],_0xa29208=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1fb)]],_0x3f7257=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x174)]],_0x1d4935=[..._0x3314b1['body']['expiry_date_QA']];const _0x4198b2=_0x481661[_0x1d5a27(0x1e7)](_0x1f890f=>{return _0x1f890f={'product_name':_0x1f890f};});_0x55b300['forEach']((_0x39178e,_0x12e442)=>{var _0x1b60db=_0x1d5a27;_0x4198b2[_0x12e442][_0x1b60db(0x1c0)]=_0x39178e;}),_0x4c0dbe[_0x1d5a27(0x229)]((_0x18b09f,_0x263c1c)=>{var _0x143c72=_0x1d5a27;_0x4198b2[_0x263c1c][_0x143c72(0x153)]=_0x18b09f;}),_0x36b819[_0x1d5a27(0x229)]((_0x2a10bd,_0x5853a8)=>{var _0x25240f=_0x1d5a27;_0x4198b2[_0x5853a8][_0x25240f(0x23b)]=_0x2a10bd;}),_0x3f511a[_0x1d5a27(0x229)]((_0xc5fe0e,_0xfff569)=>{var _0x1df71b=_0x1d5a27;_0x4198b2[_0xfff569][_0x1df71b(0x1e8)]=_0xc5fe0e;}),_0xee4708['forEach']((_0x5eee70,_0x4441b7)=>{var _0x17793f=_0x1d5a27;_0x4198b2[_0x4441b7][_0x17793f(0x238)]=_0x5eee70;}),_0x47ef25[_0x1d5a27(0x229)]((_0xb26135,_0x1f5964)=>{_0x4198b2[_0x1f5964]['return_qty']=_0xb26135;}),_0x4e8aad[_0x1d5a27(0x229)]((_0x1c9091,_0x56b1f0)=>{var _0x345ea0=_0x1d5a27;_0x4198b2[_0x56b1f0][_0x345ea0(0x176)]=_0x1c9091;}),_0x147fa0['forEach']((_0xf23b64,_0x8e5330)=>{var _0x1aff11=_0x1d5a27;_0x4198b2[_0x8e5330][_0x1aff11(0x1c8)]=_0xf23b64;}),_0x21f987['forEach']((_0xa23e16,_0x4902b9)=>{var _0x452d36=_0x1d5a27;_0x4198b2[_0x4902b9][_0x452d36(0x264)]=_0xa23e16;}),_0x14eab5['forEach']((_0x872c29,_0x16366e)=>{var _0x58d903=_0x1d5a27;_0x4198b2[_0x16366e][_0x58d903(0x214)]=_0x872c29;}),_0xa29208['forEach']((_0x1caa67,_0x50456b)=>{var _0x410099=_0x1d5a27;_0x4198b2[_0x50456b][_0x410099(0x1cd)]=_0x1caa67;}),_0x3f7257[_0x1d5a27(0x229)]((_0x1508c4,_0x614113)=>{var _0x340b26=_0x1d5a27;_0x4198b2[_0x614113][_0x340b26(0x21f)]=_0x1508c4;}),_0x1d4935[_0x1d5a27(0x229)]((_0x15f526,_0x38c3f5)=>{var _0x41199a=_0x1d5a27;_0x4198b2[_0x38c3f5][_0x41199a(0x250)]=_0x15f526;});const _0x206926=await sales_finished[_0x1d5a27(0x193)]({'invoice':_0x41d8ae});_0x206926[_0x1d5a27(0x204)]=_0x1d5a27(0x256);const _0x42ac15=await _0x206926[_0x1d5a27(0x201)](),_0x4e6047=new sales_return_finished({'invoice':_0x41d8ae,'customer':_0x3314b1[_0x1d5a27(0x1b0)]['customer'],'date':_0x469377,'warehouse_name':_0x439796,'room':_0x2b791f,'ToWarehouse':_0x592f68,'ToRoom':_0x34cb0f,'return_sale_QA':_0x4198b2,'note':_0x306d45,'warehouse_cat':_0x3959e5}),_0x51f427=await _0x4e6047['save'](),_0x501c4f=await sales_return_finished['findOne']({'invoice':_0x41d8ae}),_0x4592ab=await warehouse[_0x1d5a27(0x193)]({'name':_0x592f68,'room':_0x34cb0f});_0x501c4f[_0x1d5a27(0x224)][_0x1d5a27(0x229)](_0x52188d=>{var _0x291252=_0x1d5a27,_0xa5752c=0x0;const _0x4b9f8c=_0x4592ab[_0x291252(0x1e9)][_0x291252(0x1e7)](_0x500397=>{var _0x419737=_0x291252;_0x500397[_0x419737(0x196)]==_0x52188d[_0x419737(0x196)]&&_0x500397[_0x419737(0x250)]==_0x52188d[_0x419737(0x250)]&&_0x500397[_0x419737(0x21f)]==_0x52188d['production_date']&&_0x500397['batch_code']==_0x52188d['batch_code']&&(_0x500397[_0x419737(0x20d)]=parseInt(_0x500397[_0x419737(0x20d)])+parseInt(_0x52188d[_0x419737(0x1ad)]),_0xa5752c++);});_0xa5752c=='0'&&(_0x4592ab[_0x291252(0x1e9)]=_0x4592ab['product_details']['concat']({'product_name':_0x52188d['product_name'],'product_stock':_0x52188d[_0x291252(0x1ad)],'primary_code':_0x52188d[_0x291252(0x1c0)],'secondary_code':_0x52188d[_0x291252(0x153)],'product_code':_0x52188d[_0x291252(0x23b)],'batch_code':_0x52188d[_0x291252(0x264)],'maxPerUnit':_0x52188d['maxPerUnit'],'production_date':_0x52188d[_0x291252(0x21f)],'expiry_date':_0x52188d[_0x291252(0x250)],'secondary_unit':_0x52188d[_0x291252(0x214)],'unit':_0x52188d[_0x291252(0x1cd)],'maxProducts':_0x52188d[_0x291252(0x1c8)],'bay':_0x52188d[_0x291252(0x218)]}));}),await _0x4592ab[_0x1d5a27(0x201)]();const _0x1e6a3f=new c_payment_data({'invoice':_0x41d8ae,'customer':_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x246)],'reason':_0x1d5a27(0x1c9)});await _0x1e6a3f[_0x1d5a27(0x201)]();const _0x3eca52=await master_shop[_0x1d5a27(0x1b2)](),_0x316651=await email_settings['findOne'](),_0x5f4b7f=await customer[_0x1d5a27(0x193)]({'name':_0x3314b1['body'][_0x1d5a27(0x246)]});_0x3eca52[0x0][_0x1d5a27(0x156)]==0x1?(right_currency=_0x3eca52[0x0][_0x1d5a27(0x255)],left_currency=''):(right_currency='',left_currency=_0x3eca52[0x0][_0x1d5a27(0x255)]);var _0x58c256=_0x481661,_0x465337=_0x47ef25,_0x10d9a8='',_0x3ef744;for(_0x3ef744 in _0x58c256){_0x10d9a8+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x58c256[_0x3ef744]+_0x1d5a27(0x261)+_0x1d5a27(0x1f3)+_0x465337[_0x3ef744]+'</td>'+_0x1d5a27(0x17d);}console[_0x1d5a27(0x15a)](_0x1d5a27(0x17b),_0x10d9a8);let _0x392ba1=nodemailer[_0x1d5a27(0x20e)]({'service':_0x1d5a27(0x178),'auth':{'user':_0x316651[_0x1d5a27(0x169)],'pass':_0x316651[_0x1d5a27(0x233)]}}),_0x4807bb={'from':_0x316651[_0x1d5a27(0x169)],'to':_0x5f4b7f['email'],'subject':_0x1d5a27(0x25a),'attachments':[{'filename':_0x1d5a27(0x1a3),'path':__dirname+_0x1d5a27(0x227)+_0x1d5a27(0x23e)+_0x3eca52[0x0][_0x1d5a27(0x245)],'cid':_0x1d5a27(0x15b)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+_0x1d5a27(0x177)+_0x1d5a27(0x208)+'<div>'+_0x1d5a27(0x260)+_0x1d5a27(0x259)+_0x1d5a27(0x177)+'<h2>\x20'+_0x3eca52[0x0][_0x1d5a27(0x200)]+_0x1d5a27(0x15f)+_0x1d5a27(0x259)+_0x1d5a27(0x259)+'<hr\x20class=\x22my-3\x22>'+_0x1d5a27(0x177)+_0x1d5a27(0x171)+_0x1d5a27(0x1b1)+_0x41d8ae+'\x20'+_0x1d5a27(0x18f)+_0x1d5a27(0x16e)+_0x469377+'\x20'+'</span>'+_0x1d5a27(0x1b5)+'</div>'+_0x1d5a27(0x1ca)+_0x1d5a27(0x1f4)+'<tr>'+_0x1d5a27(0x20a)+_0x1d5a27(0x25c)+_0x1d5a27(0x209)+_0x1d5a27(0x1c3)+_0x1d5a27(0x17d)+_0x1d5a27(0x194)+_0x1d5a27(0x217)+'\x20'+_0x10d9a8+'\x20'+_0x1d5a27(0x155)+_0x1d5a27(0x22c)+'<div>'+_0x1d5a27(0x265)+_0x1d5a27(0x20c)+_0x3eca52[0x0][_0x1d5a27(0x200)]+_0x1d5a27(0x1b5)+'</div>'+'</div>'+'</body></html>'};_0x392ba1[_0x1d5a27(0x1f8)](_0x4807bb,function(_0x169f45,_0x23a072){var _0x56f89e=_0x1d5a27;_0x169f45?(console[_0x56f89e(0x15a)](_0x169f45),console['log'](_0x56f89e(0x1b9))):console[_0x56f89e(0x15a)](_0x56f89e(0x1af));}),_0x3314b1[_0x1d5a27(0x19a)](_0x1d5a27(0x1b6),_0x1d5a27(0x180)),_0x3f3cec[_0x1d5a27(0x1d7)](_0x1d5a27(0x22a));}catch(_0x13699d){_0x3f3cec[_0x1d5a27(0x1f7)](0xc8)[_0x1d5a27(0x215)]({'message1':_0x13699d[_0x1d5a27(0x230)]});}else{if(_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x152)]=='GS')try{const {invoice:_0xe1f601,date:_0x504a54,warehouse_name:_0x5de1ec,product_name:_0x4ae8f9,primary_code:_0x1670d3,secondary_code:_0xc4fd98,product_code:_0x103a9e,sales_quantity:_0x34535f,stocks:_0x29ab93,return_qty:_0x5ef98c,Room_name:_0x4869df,to_warehouse_name:_0x3b340e,to_Room_name:_0xc1c65,note:_0x128f1a,level:_0xd993fc,isle:_0x8cd8f4,pallet:_0x2611a6,for_categorize:_0x149e53}=_0x3314b1[_0x1d5a27(0x1b0)];if(typeof _0x4ae8f9==_0x1d5a27(0x24e))var _0x481661=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x196)]],_0x55b300=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1c0)]],_0x4c0dbe=[_0x3314b1[_0x1d5a27(0x1b0)]['secondary_code']],_0x36b819=[_0x3314b1[_0x1d5a27(0x1b0)]['product_code']],_0x3f511a=[_0x3314b1[_0x1d5a27(0x1b0)]['sales_quantity']],_0x47ef25=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1ad)]],_0x1cdd5a=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x218)]],_0x4e8aad=[_0x3314b1[_0x1d5a27(0x1b0)]['maxPerUnit']],_0x147fa0=[_0x3314b1[_0x1d5a27(0x1b0)]['maxProducts']],_0x21f987=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x264)]],_0x14eab5=[_0x3314b1[_0x1d5a27(0x1b0)]['secondary_unit']],_0xa29208=[_0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1cd)]],_0x3f7257=[_0x3314b1['body']['production_date']],_0x1d4935=[_0x3314b1[_0x1d5a27(0x1b0)]['expiry_date']];else var _0x481661=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x196)]],_0x55b300=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1c0)]],_0x4c0dbe=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x153)]],_0x36b819=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x23b)]],_0x3f511a=[..._0x3314b1['body'][_0x1d5a27(0x253)]],_0x47ef25=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1ad)]],_0x1cdd5a=[..._0x3314b1['body'][_0x1d5a27(0x218)]],_0x4e8aad=[..._0x3314b1['body'][_0x1d5a27(0x176)]],_0x147fa0=[..._0x3314b1[_0x1d5a27(0x1b0)]['maxProducts']],_0x21f987=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x264)]],_0x14eab5=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x214)]],_0xa29208=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x1cd)]],_0x3f7257=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x21f)]],_0x1d4935=[..._0x3314b1[_0x1d5a27(0x1b0)][_0x1d5a27(0x250)]];const _0x1fdb2b=_0x481661['map'](_0x30810f=>{return _0x30810f={'product_name':_0x30810f};});_0x55b300[_0x1d5a27(0x229)]((_0x4a0aa8,_0x1ba26e)=>{_0x1fdb2b[_0x1ba26e]['primary_code']=_0x4a0aa8;}),_0x4c0dbe[_0x1d5a27(0x229)]((_0x585272,_0x5d587a)=>{var _0x1f4ba3=_0x1d5a27;_0x1fdb2b[_0x5d587a][_0x1f4ba3(0x153)]=_0x585272;}),_0x36b819[_0x1d5a27(0x229)]((_0x1c56ee,_0x9fbace)=>{var _0x30807b=_0x1d5a27;_0x1fdb2b[_0x9fbace][_0x30807b(0x23b)]=_0x1c56ee;}),_0x3f511a[_0x1d5a27(0x229)]((_0x4c7665,_0x40e8d9)=>{_0x1fdb2b[_0x40e8d9]['sale_qty']=_0x4c7665;}),_0x47ef25[_0x1d5a27(0x229)]((_0x4c4c04,_0x514cf9)=>{_0x1fdb2b[_0x514cf9]['return_qty']=_0x4c4c04;}),_0x1cdd5a['forEach']((_0xe288da,_0x494db4)=>{var _0x36f736=_0x1d5a27;_0x1fdb2b[_0x494db4][_0x36f736(0x218)]=_0xe288da;}),_0x4e8aad[_0x1d5a27(0x229)]((_0x47360e,_0x249a1a)=>{var _0x38315e=_0x1d5a27;_0x1fdb2b[_0x249a1a][_0x38315e(0x176)]=_0x47360e;}),_0x147fa0[_0x1d5a27(0x229)]((_0x2c3926,_0x403efc)=>{var _0x1015b7=_0x1d5a27;_0x1fdb2b[_0x403efc][_0x1015b7(0x1c8)]=_0x2c3926;}),_0x21f987['forEach']((_0x189d4d,_0x14ff08)=>{var _0x2f3c11=_0x1d5a27;_0x1fdb2b[_0x14ff08][_0x2f3c11(0x264)]=_0x189d4d;}),_0x14eab5[_0x1d5a27(0x229)]((_0x525d3d,_0x34f74a)=>{_0x1fdb2b[_0x34f74a]['secondary_unit']=_0x525d3d;}),_0xa29208['forEach']((_0xd131f8,_0x2442d2)=>{_0x1fdb2b[_0x2442d2]['unit']=_0xd131f8;}),_0x3f7257['forEach']((_0x245b6e,_0x223216)=>{_0x1fdb2b[_0x223216]['production_date']=_0x245b6e;}),_0x1d4935['forEach']((_0x1b0531,_0x1671bb)=>{var _0x1b0303=_0x1d5a27;_0x1fdb2b[_0x1671bb][_0x1b0303(0x250)]=_0x1b0531;});var _0x359a11=0x0;_0x1fdb2b[_0x1d5a27(0x229)](_0x1b51a4=>{var _0x1cc1f2=_0x1d5a27;(parseInt(_0x1b51a4[_0x1cc1f2(0x1e8)])<parseInt(_0x1b51a4[_0x1cc1f2(0x1ad)])||parseInt(_0x1b51a4[_0x1cc1f2(0x238)])<parseInt(_0x1b51a4[_0x1cc1f2(0x1ad)])&&parseInt(_0x1b51a4[_0x1cc1f2(0x1e8)])>parseInt(_0x1b51a4[_0x1cc1f2(0x1ad)])||parseInt(_0x1b51a4[_0x1cc1f2(0x1ad)])==0x0)&&_0x359a11++;});if(_0x359a11!=0x0)return _0x3314b1['flash'](_0x1d5a27(0x161),_0x1d5a27(0x1d8)),_0x3f3cec['redirect'](_0x1d5a27(0x158));const _0x334513=await sales_finished['findOne']({'invoice':_0xe1f601});_0x334513['return_data']=_0x1d5a27(0x256);const _0x25c96e=await _0x334513[_0x1d5a27(0x201)](),_0xe0a0de=new sales_return_finished({'invoice':_0xe1f601,'customer':_0x3314b1['body']['customer'],'date':_0x504a54,'warehouse_name':_0x5de1ec,'room':_0x4869df,'ToWarehouse':_0x3b340e,'ToRoom':_0xc1c65,'return_sale':_0x1fdb2b,'note':_0x128f1a,'warehouse_cat':_0x149e53}),_0xd72b96=await _0xe0a0de['save'](),_0x8aa3ed=await sales_return_finished[_0x1d5a27(0x193)]({'invoice':_0xe1f601}),_0x4594e4=await warehouse[_0x1d5a27(0x193)]({'name':_0x3b340e,'room':_0xc1c65,'warehouse_category':_0x1d5a27(0x22e)});_0x8aa3ed['return_sale']['forEach'](_0x2972cc=>{var _0x499f17=_0x1d5a27,_0x490aa9=0x0;const _0x588fcb=_0x4594e4['product_details'][_0x499f17(0x1e7)](_0x53e44d=>{var _0x2bea9c=_0x499f17;_0x53e44d[_0x2bea9c(0x196)]==_0x2972cc['product_name']&&_0x53e44d[_0x2bea9c(0x218)]==_0x2972cc[_0x2bea9c(0x218)]&&_0x53e44d['expiry_date']==_0x2972cc[_0x2bea9c(0x250)]&&_0x53e44d[_0x2bea9c(0x21f)]==_0x2972cc['production_date']&&_0x53e44d[_0x2bea9c(0x264)]==_0x2972cc[_0x2bea9c(0x264)]&&(_0x53e44d[_0x2bea9c(0x20d)]=parseInt(_0x53e44d[_0x2bea9c(0x20d)])+parseInt(_0x2972cc[_0x2bea9c(0x1ad)]),_0x490aa9++);});_0x490aa9=='0'&&(_0x4594e4['product_details']=_0x4594e4['product_details'][_0x499f17(0x198)]({'product_name':_0x2972cc[_0x499f17(0x196)],'product_stock':_0x2972cc[_0x499f17(0x1ad)],'primary_code':_0x2972cc[_0x499f17(0x1c0)],'secondary_code':_0x2972cc[_0x499f17(0x153)],'product_code':_0x2972cc['product_code'],'bay':_0x2972cc[_0x499f17(0x218)],'batch_code':_0x2972cc['batch_code'],'maxPerUnit':_0x2972cc[_0x499f17(0x176)],'production_date':_0x2972cc[_0x499f17(0x21f)],'expiry_date':_0x2972cc[_0x499f17(0x250)],'secondary_unit':_0x2972cc[_0x499f17(0x214)],'unit':_0x2972cc[_0x499f17(0x1cd)],'maxProducts':_0x2972cc[_0x499f17(0x1c8)]}));}),await _0x4594e4[_0x1d5a27(0x201)](),console[_0x1d5a27(0x15a)](_0x3314b1['body']);const _0x555f6a=new c_payment_data({'invoice':_0xe1f601,'customer':_0x3314b1[_0x1d5a27(0x1b0)]['customer'],'reason':'Sale\x20Return'});await _0x555f6a['save']();const _0x44c09d=await master_shop[_0x1d5a27(0x1b2)]();console['log'](_0x1d5a27(0x234),_0x44c09d[0x0][_0x1d5a27(0x245)]);const _0x2c2fd8=await email_settings[_0x1d5a27(0x193)](),_0x4d9205=await customer[_0x1d5a27(0x193)]({'name':_0x3314b1['body'][_0x1d5a27(0x246)]});console[_0x1d5a27(0x15a)](_0x1d5a27(0x18c),_0x4d9205);_0x44c09d[0x0][_0x1d5a27(0x156)]==0x1?(right_currency=_0x44c09d[0x0][_0x1d5a27(0x255)],left_currency=''):(right_currency='',left_currency=_0x44c09d[0x0]['currency']);var _0x58c256=_0x481661,_0x465337=_0x47ef25,_0x10d9a8='',_0x3ef744;for(_0x3ef744 in _0x58c256){_0x10d9a8+=_0x1d5a27(0x1f1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x58c256[_0x3ef744]+_0x1d5a27(0x261)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x465337[_0x3ef744]+_0x1d5a27(0x261)+_0x1d5a27(0x17d);}console[_0x1d5a27(0x15a)](_0x1d5a27(0x17b),_0x10d9a8);let _0x5cb590=nodemailer['createTransport']({'service':_0x1d5a27(0x178),'auth':{'user':_0x2c2fd8['email'],'pass':_0x2c2fd8[_0x1d5a27(0x233)]}}),_0x25079e={'from':_0x2c2fd8[_0x1d5a27(0x169)],'to':_0x4d9205[_0x1d5a27(0x169)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x1d5a27(0x227)+_0x1d5a27(0x23e)+_0x44c09d[0x0][_0x1d5a27(0x245)],'cid':_0x1d5a27(0x15b)}],'html':'<!DOCTYPE\x20html>'+_0x1d5a27(0x206)+_0x1d5a27(0x1f2)+_0x1d5a27(0x177)+_0x1d5a27(0x208)+_0x1d5a27(0x177)+_0x1d5a27(0x260)+'</div>'+_0x1d5a27(0x177)+_0x1d5a27(0x1c6)+_0x44c09d[0x0][_0x1d5a27(0x200)]+_0x1d5a27(0x15f)+'</div>'+_0x1d5a27(0x259)+_0x1d5a27(0x185)+_0x1d5a27(0x177)+_0x1d5a27(0x171)+_0x1d5a27(0x1b1)+_0xe1f601+'\x20'+_0x1d5a27(0x18f)+'\x20Order\x20Date\x20:\x20'+_0x504a54+'\x20'+'</span>'+'</h5>'+_0x1d5a27(0x259)+_0x1d5a27(0x1ca)+_0x1d5a27(0x1f4)+_0x1d5a27(0x1f1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1d5a27(0x25c)+_0x1d5a27(0x209)+_0x1d5a27(0x1c3)+'</tr>'+_0x1d5a27(0x194)+_0x1d5a27(0x217)+'\x20'+_0x10d9a8+'\x20'+'</tbody>'+'</table>'+_0x1d5a27(0x177)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x44c09d[0x0][_0x1d5a27(0x200)]+_0x1d5a27(0x1b5)+_0x1d5a27(0x259)+_0x1d5a27(0x259)+_0x1d5a27(0x244)};_0x5cb590[_0x1d5a27(0x1f8)](_0x25079e,function(_0x2d676b,_0x368562){var _0x519943=_0x1d5a27;_0x2d676b?(console[_0x519943(0x15a)](_0x2d676b),console[_0x519943(0x15a)](_0x519943(0x1b9))):console[_0x519943(0x15a)](_0x519943(0x1af));}),_0x3314b1[_0x1d5a27(0x19a)](_0x1d5a27(0x1b6),_0x1d5a27(0x180)),_0x3f3cec[_0x1d5a27(0x1d7)]('/all_sales_finished/view');}catch(_0x41a0a4){console['log'](_0x41a0a4),_0x3f3cec[_0x1d5a27(0x1f7)](0xc8)[_0x1d5a27(0x215)]({'message1':_0x41a0a4[_0x1d5a27(0x230)]});}}}),router['get']('/barcode/:id',auth,async(_0x1f8cd1,_0x516bc4)=>{var _0xb42017=a0_0x23c228;try{const {username:_0x5401ac,email:_0x8b23b4,role:_0x4cd502}=_0x1f8cd1[_0xb42017(0x1f0)],_0x31e7bf=_0x1f8cd1[_0xb42017(0x1f0)],_0x9bff75=await profile[_0xb42017(0x193)]({'email':_0x31e7bf[_0xb42017(0x169)]}),_0xc75ed9=await master_shop[_0xb42017(0x1b2)]();console[_0xb42017(0x15a)](_0xb42017(0x21b),_0xc75ed9);const _0x87d0ca=_0x1f8cd1[_0xb42017(0x1ea)]['id'],_0x122c09=await sales[_0xb42017(0x269)](_0x87d0ca);console['log'](_0xb42017(0x216),_0x122c09);if(_0xc75ed9[0x0][_0xb42017(0x252)]==_0xb42017(0x1a5))var _0xa64543=users[_0xb42017(0x24b)];else{if(_0xc75ed9[0x0]['language']==_0xb42017(0x1a8))var _0xa64543=users[_0xb42017(0x1a8)];else{if(_0xc75ed9[0x0][_0xb42017(0x252)]==_0xb42017(0x17e))var _0xa64543=users[_0xb42017(0x17e)];else{if(_0xc75ed9[0x0][_0xb42017(0x252)]==_0xb42017(0x24c))var _0xa64543=users[_0xb42017(0x24c)];else{if(_0xc75ed9[0x0]['language']==_0xb42017(0x189))var _0xa64543=users['French'];else{if(_0xc75ed9[0x0][_0xb42017(0x252)]=='Portuguese\x20(BR)')var _0xa64543=users[_0xb42017(0x1d0)];else{if(_0xc75ed9[0x0][_0xb42017(0x252)]==_0xb42017(0x232))var _0xa64543=users[_0xb42017(0x232)];else{if(_0xc75ed9[0x0][_0xb42017(0x252)]==_0xb42017(0x1c5))var _0xa64543=users[_0xb42017(0x1a1)];}}}}}}}_0x516bc4[_0xb42017(0x163)]('all_sales_barcode',{'success':_0x1f8cd1[_0xb42017(0x19a)](_0xb42017(0x1b6)),'errors':_0x1f8cd1[_0xb42017(0x19a)]('errors'),'role':_0x31e7bf,'profile':_0x9bff75,'alldata':_0x122c09,'master_shop':_0xc75ed9,'language':_0xa64543});}catch(_0x4fd445){console['log'](_0x4fd445);}}),router[a0_0x23c228(0x1da)](a0_0x23c228(0x207),async(_0x5d1629,_0x91423)=>{var _0x2982a6=a0_0x23c228;const {product_code:_0xe422f3,warehouse_name:_0x2c7e8b,rooms_data:_0x260550,Roomslist:_0x23dfa}=_0x5d1629[_0x2982a6(0x1b0)],_0x42e02a=_0x23dfa[_0x2982a6(0x247)](','),_0x3d4803=[];async function _0x371da2(_0x292a4e){var _0x3b79df=_0x2982a6;const _0x2dfffd=await warehouse[_0x3b79df(0x222)]([{'$match':{'name':_0x2c7e8b,'room':_0x292a4e}},{'$unwind':_0x3b79df(0x17f)},{'$match':{'product_details.primary_code':_0xe422f3}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3b79df(0x1df)},'product_stock':{'$first':_0x3b79df(0x1d2)},'primary_code':{'$first':_0x3b79df(0x21e)},'secondary_code':{'$first':_0x3b79df(0x170)},'product_code':{'$first':_0x3b79df(0x23d)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x3b79df(0x205)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x3b79df(0x221)},'unit':{'$first':_0x3b79df(0x1a4)},'secondary_unit':{'$first':_0x3b79df(0x188)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3b79df(0x1dd)},'expiry_date':{'$first':_0x3b79df(0x243)},'production_date':{'$first':_0x3b79df(0x235)},'maxPerUnit':{'$first':_0x3b79df(0x16c)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x3b79df(0x1aa)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x5584c3=await warehouse['aggregate']([{'$match':{'name':_0x2c7e8b,'room':_0x292a4e}},{'$unwind':_0x3b79df(0x17f)},{'$match':{'product_details.secondary_code':_0xe422f3}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3b79df(0x1df)},'product_stock':{'$first':_0x3b79df(0x1d2)},'primary_code':{'$first':_0x3b79df(0x21e)},'secondary_code':{'$first':_0x3b79df(0x170)},'product_code':{'$first':_0x3b79df(0x23d)},'level':{'$first':_0x3b79df(0x211)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x3b79df(0x1a4)},'secondary_unit':{'$first':_0x3b79df(0x188)},'storage':{'$first':_0x3b79df(0x150)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3b79df(0x243)},'production_date':{'$first':_0x3b79df(0x235)},'maxPerUnit':{'$first':_0x3b79df(0x16c)},'batch_code':{'$first':_0x3b79df(0x167)},'product_cat':{'$first':_0x3b79df(0x1a2)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x3b79df(0x1aa)},'invoice':{'$first':_0x3b79df(0x1ef)}}}]);if(_0x2dfffd['length']>0x0)_0x3d4803[_0x3b79df(0x257)](_0x2dfffd);else _0x5584c3[_0x3b79df(0x1d9)]>0x0&&_0x3d4803['push'](_0x5584c3);}const _0x3ff774=_0x42e02a[_0x2982a6(0x1e7)](_0x1c1735=>_0x371da2(_0x1c1735));await Promise[_0x2982a6(0x1de)](_0x3ff774),_0x91423[_0x2982a6(0x215)](_0x3d4803);}),module[a0_0x23c228(0x24a)]=router;