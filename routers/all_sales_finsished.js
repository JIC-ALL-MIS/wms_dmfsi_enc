var a0_0x38f957=a0_0x2481;(function(_0x319b9d,_0x36a793){var _0xd0c35f=a0_0x2481,_0x4bae87=_0x319b9d();while(!![]){try{var _0x66713b=-parseInt(_0xd0c35f(0x1b3))/0x1+parseInt(_0xd0c35f(0x18b))/0x2*(parseInt(_0xd0c35f(0x1ff))/0x3)+parseInt(_0xd0c35f(0x1da))/0x4+parseInt(_0xd0c35f(0x141))/0x5*(-parseInt(_0xd0c35f(0x212))/0x6)+parseInt(_0xd0c35f(0x1eb))/0x7+parseInt(_0xd0c35f(0x20a))/0x8*(parseInt(_0xd0c35f(0x18c))/0x9)+-parseInt(_0xd0c35f(0x126))/0xa*(-parseInt(_0xd0c35f(0x1d4))/0xb);if(_0x66713b===_0x36a793)break;else _0x4bae87['push'](_0x4bae87['shift']());}catch(_0x1dbaad){_0x4bae87['push'](_0x4bae87['shift']());}}}(a0_0x364f,0x3a68f));const express=require(a0_0x38f957(0x1b0)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x38f957(0x17c)),nodemailer=require(a0_0x38f957(0x1df)),users=require(a0_0x38f957(0x188));router[a0_0x38f957(0x19b)](a0_0x38f957(0x1f3),auth,async(_0x22f652,_0x41dbf0)=>{var _0x34b3cd=a0_0x38f957;try{const {username:_0x40b985,email:_0x1ed145,role:_0x31fbcf}=_0x22f652['user'],_0x7e4edd=_0x22f652[_0x34b3cd(0x195)],_0x466f4a=await profile[_0x34b3cd(0x137)]({'email':_0x7e4edd['email']}),_0x19e433=await master_shop[_0x34b3cd(0x183)]();let _0x3fc4d1;if(_0x7e4edd[_0x34b3cd(0x156)]==_0x34b3cd(0x19a)){const _0x7227f3=await staff[_0x34b3cd(0x137)]({'email':_0x7e4edd['email']});_0x3fc4d1=await sales_finished[_0x34b3cd(0x132)]([{'$lookup':{'from':_0x34b3cd(0x142),'localField':_0x34b3cd(0x185),'foreignField':'name','as':_0x34b3cd(0x1ad)}},{'$unwind':_0x34b3cd(0x167)},{'$unwind':_0x34b3cd(0x1a7)},{'$group':{'_id':_0x34b3cd(0x1ce),'invoice':{'$first':_0x34b3cd(0x21c)},'customers':{'$first':_0x34b3cd(0x205)},'date':{'$first':_0x34b3cd(0x198)},'warehouse_name':{'$first':_0x34b3cd(0x11b)},'sale_product':{'$push':_0x34b3cd(0x1a7)},'note':{'$first':'$note'},'return_data':{'$first':_0x34b3cd(0x1ac)},'customers_docs':{'$first':_0x34b3cd(0x167)},'total_saleproduct_quantity':{'$sum':_0x34b3cd(0x170)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x34b3cd(0x122)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x34b3cd(0x21b)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x3fc4d1=await sales_finished[_0x34b3cd(0x132)]([{'$lookup':{'from':_0x34b3cd(0x142),'localField':_0x34b3cd(0x185),'foreignField':_0x34b3cd(0x18e),'as':_0x34b3cd(0x1ad)}},{'$unwind':_0x34b3cd(0x167)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x34b3cd(0x1ce),'invoice':{'$first':_0x34b3cd(0x21c)},'customers':{'$first':'$customer'},'date':{'$first':_0x34b3cd(0x198)},'warehouse_name':{'$first':_0x34b3cd(0x11b)},'sale_product':{'$push':_0x34b3cd(0x1a7)},'note':{'$first':_0x34b3cd(0x179)},'return_data':{'$first':_0x34b3cd(0x1ac)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x34b3cd(0x14c)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x34b3cd(0x1f9)},'pallet':{'$addToSet':_0x34b3cd(0x21b)},'finalize':{'$first':_0x34b3cd(0x13b)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x19e433[0x0][_0x34b3cd(0x15f)]==_0x34b3cd(0x192)){var _0x4b7d35=users[_0x34b3cd(0x12d)];console[_0x34b3cd(0x1bd)](_0x4b7d35);}else{if(_0x19e433[0x0][_0x34b3cd(0x15f)]==_0x34b3cd(0x1e8))var _0x4b7d35=users[_0x34b3cd(0x1e8)];else{if(_0x19e433[0x0][_0x34b3cd(0x15f)]=='German')var _0x4b7d35=users[_0x34b3cd(0x1ba)];else{if(_0x19e433[0x0]['language']==_0x34b3cd(0x21a))var _0x4b7d35=users[_0x34b3cd(0x21a)];else{if(_0x19e433[0x0][_0x34b3cd(0x15f)]=='French')var _0x4b7d35=users[_0x34b3cd(0x1f7)];else{if(_0x19e433[0x0][_0x34b3cd(0x15f)]==_0x34b3cd(0x1af))var _0x4b7d35=users['Portuguese'];else{if(_0x19e433[0x0][_0x34b3cd(0x15f)]=='Chinese')var _0x4b7d35=users['Chinese'];else{if(_0x19e433[0x0][_0x34b3cd(0x15f)]==_0x34b3cd(0x165))var _0x4b7d35=users[_0x34b3cd(0x18f)];}}}}}}}_0x41dbf0[_0x34b3cd(0x168)]('all_sales_finished',{'success':_0x22f652['flash'](_0x34b3cd(0x17f)),'errors':_0x22f652['flash']('errors'),'sales':_0x3fc4d1,'profile':_0x466f4a,'role':_0x7e4edd,'master_shop':_0x19e433,'language':_0x4b7d35});}catch(_0x3d2cc8){console[_0x34b3cd(0x1bd)](_0x3d2cc8);}});function a0_0x2481(_0x490d5a,_0x25b785){var _0x364ff2=a0_0x364f();return a0_0x2481=function(_0x24812c,_0x58c2de){_0x24812c=_0x24812c-0x11b;var _0x5e77ad=_0x364ff2[_0x24812c];return _0x5e77ad;},a0_0x2481(_0x490d5a,_0x25b785);}function a0_0x364f(){var _0x185dde=['English\x20(US)','<span\x20style=\x22float:\x20right;\x22>','Sale\x20Return','user','level','post','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','staff','get','received_amount','stock','maxProducts','$product_details._id','<hr\x20class=\x22my-3\x22>','$product_details.expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','getDate','/view/return_sales/:id','$product_details.floorlevel','stocks_QA','$sale_product','Ambient','unit_QA','Return\x20Goods','message','$return_data','customers_docs','push','Portuguese\x20(BR)','express','secondary_unit','password','393351typkIH','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','foreach\x20newproduct','quantity','sales_invoice','/preview/:id','Error\x20Occurs','German','<h2>\x20','barcode\x20user_id','log','maxPerUnit','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','sendMail','errors','final','getFullYear','An\x20error\x20occurred\x20while\x20saving\x20data.','invoice','amount','$product.product_name','Sale\x20Product\x20Mail','product_name','getMonth','$product_details.type','barcode\x20Product\x20master','forEach','$_id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/all_sales/view','$product_details.product_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','stock_data','4026kiKRwm','return_qty_QA','bay','prod_invoice','prod_code','Received\x20Payment\x20For\x20Sale','1455472taunrR','product_code','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Quality\x20Inspection','$room','nodemailer','</table>','maxperunit','back','</body></html>','$product_details.rack','room_name','return_qty','<html><head><title></title>','Hindi','/all_sales_finished/preview/','$product_details.bin','194215blHvcG','\x20Order\x20Number\x20:\x20','True','</h5>','batch_code','$product_details.unit','secondary_code','json','/view','exports','Sales\x20Add\x20successfully','status','French','Chinese','$sale_product.type','email','max_per_unit','$product_details.bay','\x20Order\x20Date\x20:\x20','Sale\x20Return\x20Mail','3PAnZnN','warehouse_name','expiry_date_QA','$product_details.primary_code','sale_product','/invoice/:id','$customer','<h5\x20style=\x22text-align:\x20left;\x22>','<!DOCTYPE\x20html>','suppliers','master','8HuqYqX','/upload/','slice','sales_quantity','<tr>','/view/:id','/view/add_sales','unit','2148ZQTCrQ','DRY\x20GOODS','product_date','Enabled','Sale','$product_details.product_stock','production_date_QA','return_sale_finished','Spanish','$sale_product.floorlevel','$invoice','maxPerUnit_QA','$name','for_categorize','host','purchases_data','</tbody>','$product_details.storage','product_details','Email\x20sent\x20successfully','</div>','add\x20post','product','currency_placement','production_date','$warehouse_name','primary_code','</head><body>','warehouse','save','image','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$sale_product.bin','<h5>','map','body','590XFBaDA','logo','sale_qty','gmail','primary_code_QA','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</span>','English','$product_details.maxPerUnit','random','/barcode/:id','/give_payment/:id','aggregate','due_amount','secondary_code_QA','$product_details.production_date','$product_details.product_name','findOne','$product_details.secondary_code','date','Portuguese','$finalize','return_sale','product_stock','$product_details.batch_code','redirect','product_list','1890qCERNF','customers','</td>','/../public','flash','secondary_unit_QA','Enclosed','\x20</h2>','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product','$sale_product.bay','Sales\x20Update\x20successfully','</thead>','room','then','$product_details.invoice','prod_cat','return_sale_QA','toString','catch','role','all','site_title','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','adjust_qty','currency','string','Return\x20Rooms','filter','language','QA\x20Warehouse','OUTF-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','expiry_date','product_name_QA1','Arabic\x20(ae)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$customers_docs','render','Finished\x20Goods','<div>','sales_quantity_QA','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','primary_unit','maxProducts_QA','$product_details.product_cat','$sale_product.quantity','</tr>','<strong>\x20Regards\x20</strong>','$product_details.secondary_unit','all_sales_barcode','createTransport','port','error','note','$note','concat','FGSEmail','../middleware/auth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/all_sales_finished/view','success','/view/add_sale/product','params','<tbody\x20style=\x22text-align:\x20center;\x22>','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','customer','$product_details','RoomAssigned','../public/language/languages.json','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','373012SWClSH','1513881zMEzSN','carton','name','Arabic','add_sales_finished','return_data'];a0_0x364f=function(){return _0x185dde;};return a0_0x364f();}async function getRandom8DigitNumber(){var _0x5520e8=a0_0x38f957;const _0x42da72=0x989680,_0x256834=0x5f5e0ff,_0x332d1f=Math['floor'](Math[_0x5520e8(0x12f)]()*(_0x256834-_0x42da72+0x1))+_0x42da72;var _0x5237ad;const _0x11d139=await sales_finished[_0x5520e8(0x137)]({'invoice':_0x5520e8(0x161)+_0x332d1f});return _0x11d139&&_0x11d139['length']>0x0?_0x5237ad=_0x5520e8(0x161)+_0x332d1f:_0x5237ad='OUTF-'+_0x332d1f,_0x5237ad;}router['get'](a0_0x38f957(0x210),auth,async(_0x26ce2d,_0xfa6fa9)=>{var _0x25c299=a0_0x38f957;try{const {username:_0x2d6e1c,email:_0x518599,role:_0x1ad687}=_0x26ce2d[_0x25c299(0x195)],_0x289e16=_0x26ce2d['user'],_0x347819=await profile[_0x25c299(0x137)]({'email':_0x289e16[_0x25c299(0x1fa)]}),_0x3b0ceb=await master_shop[_0x25c299(0x183)](),_0x21a5ca=await customer[_0x25c299(0x183)]({});let _0x404c9b;if(_0x289e16['role']==_0x25c299(0x19a)){const _0xd6a1fe=await staff[_0x25c299(0x137)]({'email':_0x289e16[_0x25c299(0x1fa)]});_0x404c9b=await warehouse[_0x25c299(0x132)]([{'$match':{'status':_0x25c299(0x215),'name':_0xd6a1fe[_0x25c299(0x11e)],'warehouse_category':_0x25c299(0x169),'name':{'$ne':_0x25c299(0x160)}}},{'$group':{'_id':_0x25c299(0x21e),'name':{'$first':_0x25c299(0x21e)}}},{'$sort':{'name':0x1}}]);}else _0x404c9b=await warehouse[_0x25c299(0x132)]([{'$match':{'status':_0x25c299(0x215),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x25c299(0x160)}}},{'$group':{'_id':'$name','name':{'$first':_0x25c299(0x21e)}}},{'$sort':{'name':0x1}}]);const _0x47b660=await product['find']({});var _0x3e63a8=[_0x25c299(0x1a8),_0x25c299(0x147)];const _0x56f31f=await sales_finished[_0x25c299(0x183)]({}),_0x1b8d08=_0x56f31f['length']+0x1,_0x25e49a=_0x25c299(0x161)+_0x1b8d08[_0x25c299(0x154)]()['padStart'](0x5,'0');if(_0x3b0ceb[0x0]['language']==_0x25c299(0x192)){var _0x4f72a8=users[_0x25c299(0x12d)];console[_0x25c299(0x1bd)](_0x4f72a8);}else{if(_0x3b0ceb[0x0][_0x25c299(0x15f)]==_0x25c299(0x1e8))var _0x4f72a8=users[_0x25c299(0x1e8)];else{if(_0x3b0ceb[0x0][_0x25c299(0x15f)]=='German')var _0x4f72a8=users[_0x25c299(0x1ba)];else{if(_0x3b0ceb[0x0][_0x25c299(0x15f)]==_0x25c299(0x21a))var _0x4f72a8=users['Spanish'];else{if(_0x3b0ceb[0x0][_0x25c299(0x15f)]==_0x25c299(0x1f7))var _0x4f72a8=users[_0x25c299(0x1f7)];else{if(_0x3b0ceb[0x0]['language']==_0x25c299(0x1af))var _0x4f72a8=users[_0x25c299(0x13a)];else{if(_0x3b0ceb[0x0]['language']==_0x25c299(0x1f8))var _0x4f72a8=users['Chinese'];else{if(_0x3b0ceb[0x0]['language']=='Arabic\x20(ae)')var _0x4f72a8=users[_0x25c299(0x18f)];}}}}}}}const _0x3032a7=getRandom8DigitNumber();_0x3032a7[_0x25c299(0x150)](_0xe8a197=>{var _0x512a7f=_0x25c299;_0xfa6fa9[_0x512a7f(0x168)](_0x512a7f(0x190),{'success':_0x26ce2d[_0x512a7f(0x145)]('success'),'errors':_0x26ce2d['flash'](_0x512a7f(0x1c1)),'role':_0x289e16,'profile':_0x347819,'customer':_0x21a5ca,'warehouse':_0x404c9b,'product':_0x47b660,'invoice':_0xe8a197,'master_shop':_0x3b0ceb,'language':_0x4f72a8,'rooms_data':_0x3e63a8});})[_0x25c299(0x155)](_0x39323d=>{var _0x567cc4=_0x25c299;_0x26ce2d[_0x567cc4(0x145)](_0x567cc4(0x1c1),_0x567cc4(0x121)),_0xfa6fa9[_0x567cc4(0x13f)](_0x567cc4(0x17e));});}catch(_0x3cef21){console[_0x25c299(0x1bd)](_0x3cef21);}}),router['get']('/view/add_sales/:id',auth,async(_0x490407,_0xe40691)=>{var _0x2d4911=a0_0x38f957;try{const _0x4dded2=_0x490407[_0x2d4911(0x181)]['id'];console[_0x2d4911(0x1bd)](_0x4dded2);const _0x51cc59=await product[_0x2d4911(0x183)](),_0x57247d=await purchases[_0x2d4911(0x132)]([{'$match':{'warehouse_name':_0x4dded2}},{'$unwind':_0x2d4911(0x14b)},{'$group':{'_id':_0x2d4911(0x1c7)}}]);console[_0x2d4911(0x1bd)](_0x2d4911(0x221),_0x57247d),_0xe40691[_0x2d4911(0x1f6)](0xc8)[_0x2d4911(0x1f2)]({'purchases_data':_0x57247d,'product_data':_0x51cc59});}catch(_0x40033d){console[_0x2d4911(0x1bd)](_0x40033d);}}),router['post'](a0_0x38f957(0x180),auth,async(_0x532c1e,_0x322677)=>{var _0x3db731=a0_0x38f957;try{const {warehouse_data:_0x1b93b1,product_data:_0x2e00da}=_0x532c1e[_0x3db731(0x125)];console[_0x3db731(0x1bd)](_0x532c1e['body']['product_data']);;const _0x315316=await master_shop[_0x3db731(0x183)]();console['log'](_0x3db731(0x209),_0x315316);const _0x1f7b92=await product['findOne']({'name':_0x2e00da});console[_0x3db731(0x1bd)](_0x3db731(0x228),_0x1f7b92);const _0x75e88=await warehouse['aggregate']([{'$match':{'name':_0x1b93b1}},{'$unwind':_0x3db731(0x186)},{'$match':{'product_details.product_name':_0x2e00da}},{'$group':{'_id':_0x3db731(0x136),'product_stock':{'$first':_0x3db731(0x217)}}}]);console[_0x3db731(0x1bd)](_0x3db731(0x1d3),_0x75e88),_0x322677[_0x3db731(0x1f6)](0xc8)['json']({'master':_0x315316,'new_product':_0x1f7b92,'stock_data':_0x75e88});}catch(_0xdf7fb4){console[_0x3db731(0x1bd)](_0xdf7fb4);}}),router[a0_0x38f957(0x197)](a0_0x38f957(0x210),auth,async(_0x29208e,_0x2d0c48)=>{var _0x1bd8c9=a0_0x38f957;try{const {invoice:_0x309ccb,date:_0x3ecc41,warehouse_name:_0x122459,product_name:_0x56c63f,stock:_0x567da2,quantity:_0x25c298,note:_0x100209,room:_0x37173,primary_code:_0x5708b6,secondary_code:_0x122004,prod_code:_0x2a4a5e,level:_0x56d052,isle:_0x57c0bc,pallet:_0x210a84,batch_code:_0x466bac,SCRN:_0x2cd50f,expiry_date:_0xc37284,mode_transpo:_0x15a0c7,name_driver:_0x2a231b}=_0x29208e[_0x1bd8c9(0x125)];if(typeof _0x56c63f==_0x1bd8c9(0x15c))var _0x1ebaa0=[_0x29208e['body'][_0x1bd8c9(0x1c9)]],_0x45d79c=[_0x29208e['body'][_0x1bd8c9(0x19d)]],_0x11fdcb=[_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x18d)]],_0x177c5a=[_0x29208e[_0x1bd8c9(0x125)]['primary_code']],_0x87613f=[_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x1f1)]],_0x4d59cb=[_0x29208e['body'][_0x1bd8c9(0x1d8)]],_0x3345ac=[_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x196)]],_0x304bec=[_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x16d)]],_0x6d22ce=[_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x1b1)]],_0x3bc323=[_0x29208e[_0x1bd8c9(0x125)]['batch_code']],_0x1f26de=[_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x163)]],_0x38b9b5=[_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x214)]],_0x94ff62=[_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x1fb)]],_0x433e40=[_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x152)]],_0xeb2be3=[_0x29208e[_0x1bd8c9(0x125)]['RoomAssigned']],_0x34ad8b=[_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x1d7)]];else var _0x1ebaa0=[..._0x29208e['body'][_0x1bd8c9(0x1c9)]],_0x45d79c=[..._0x29208e['body'][_0x1bd8c9(0x19d)]],_0x11fdcb=[..._0x29208e[_0x1bd8c9(0x125)]['carton']],_0x177c5a=[..._0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x11c)]],_0x87613f=[..._0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x1f1)]],_0x4d59cb=[..._0x29208e[_0x1bd8c9(0x125)]['prod_code']],_0x3345ac=[..._0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x196)]],_0x304bec=[..._0x29208e[_0x1bd8c9(0x125)]['primary_unit']],_0x6d22ce=[..._0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x1b1)]],_0x3bc323=[..._0x29208e['body'][_0x1bd8c9(0x1ef)]],_0x1f26de=[..._0x29208e[_0x1bd8c9(0x125)]['expiry_date']],_0x38b9b5=[..._0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x214)]],_0x94ff62=[..._0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x1fb)]],_0x433e40=[..._0x29208e['body'][_0x1bd8c9(0x152)]],_0xeb2be3=[..._0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x187)]],_0x34ad8b=[..._0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x1d7)]];const _0x26a165=_0x1ebaa0[_0x1bd8c9(0x124)](_0x3c7169=>{return _0x3c7169={'product_name':_0x3c7169};});_0x45d79c[_0x1bd8c9(0x1cd)]((_0x5ed6f7,_0x294a37)=>{_0x26a165[_0x294a37]['stock']=_0x5ed6f7;}),_0x11fdcb['forEach']((_0x173e9a,_0x4a35ca)=>{var _0x106aa0=_0x1bd8c9;_0x26a165[_0x4a35ca][_0x106aa0(0x1b6)]=_0x173e9a;}),_0x177c5a[_0x1bd8c9(0x1cd)]((_0x4a04d7,_0x4b262a)=>{var _0x535668=_0x1bd8c9;_0x26a165[_0x4b262a][_0x535668(0x11c)]=_0x4a04d7;}),_0x87613f['forEach']((_0x50b4a9,_0x5d164a)=>{var _0x5b62ba=_0x1bd8c9;_0x26a165[_0x5d164a][_0x5b62ba(0x1f1)]=_0x50b4a9;}),_0x4d59cb['forEach']((_0xf8fd85,_0x3c9c40)=>{_0x26a165[_0x3c9c40]['product_code']=_0xf8fd85;}),_0x3345ac[_0x1bd8c9(0x1cd)]((_0x3543cd,_0x4cd727)=>{var _0x1de4b4=_0x1bd8c9;_0x26a165[_0x4cd727][_0x1de4b4(0x1d6)]=_0x3543cd;}),_0x304bec[_0x1bd8c9(0x1cd)]((_0x3eae7b,_0x1c955a)=>{var _0x470562=_0x1bd8c9;_0x26a165[_0x1c955a][_0x470562(0x211)]=_0x3eae7b;}),_0x6d22ce[_0x1bd8c9(0x1cd)]((_0x1e4da6,_0x21f9cf)=>{var _0xeb7a93=_0x1bd8c9;_0x26a165[_0x21f9cf][_0xeb7a93(0x1b1)]=_0x1e4da6;}),_0x3bc323[_0x1bd8c9(0x1cd)]((_0x2f8c92,_0x1dc6bc)=>{var _0x953d0f=_0x1bd8c9;_0x26a165[_0x1dc6bc][_0x953d0f(0x1ef)]=_0x2f8c92;}),_0x1f26de[_0x1bd8c9(0x1cd)]((_0x1824b2,_0x3d061b)=>{var _0x534995=_0x1bd8c9;_0x26a165[_0x3d061b][_0x534995(0x163)]=_0x1824b2;}),_0x38b9b5[_0x1bd8c9(0x1cd)]((_0x39fb1c,_0x4bd365)=>{var _0x1e2e28=_0x1bd8c9;_0x26a165[_0x4bd365][_0x1e2e28(0x22a)]=_0x39fb1c;}),_0x94ff62[_0x1bd8c9(0x1cd)]((_0x292ead,_0xfeb237)=>{var _0x303ced=_0x1bd8c9;_0x26a165[_0xfeb237][_0x303ced(0x1e1)]=_0x292ead;}),_0x433e40[_0x1bd8c9(0x1cd)]((_0x250874,_0x5684b4)=>{var _0x4f5f30=_0x1bd8c9;_0x26a165[_0x5684b4][_0x4f5f30(0x152)]=_0x250874;}),_0xeb2be3[_0x1bd8c9(0x1cd)]((_0x511bcb,_0x4ba940)=>{var _0x3bd610=_0x1bd8c9;_0x26a165[_0x4ba940][_0x3bd610(0x1e5)]=_0x511bcb;}),_0x34ad8b[_0x1bd8c9(0x1cd)]((_0x1dc674,_0x23f8c9)=>{var _0x10f20f=_0x1bd8c9;_0x26a165[_0x23f8c9][_0x10f20f(0x1c5)]=_0x1dc674;});var _0x1f6d88=0x0;_0x26a165[_0x1bd8c9(0x1cd)](_0x52ec8c=>{var _0x525536=_0x1bd8c9;console[_0x525536(0x1bd)]('foreach\x20newproduct',_0x52ec8c),(parseInt(_0x52ec8c[_0x525536(0x19d)])<parseInt(_0x52ec8c['quantity'])||parseInt(_0x52ec8c[_0x525536(0x1b6)])==0x0)&&_0x1f6d88++;});if(_0x1f6d88!=0x0)return _0x29208e['flash'](_0x1bd8c9(0x1c1),_0x1bd8c9(0x16c)),_0x2d0c48[_0x1bd8c9(0x13f)](_0x1bd8c9(0x1e2));const _0x4cdc5a=_0x26a165[_0x1bd8c9(0x15e)](_0x2b6054=>_0x2b6054[_0x1bd8c9(0x1b6)]!=='0'&&_0x2b6054[_0x1bd8c9(0x1b6)]!==''),_0x3ba608=new sales_finished({'invoice':_0x309ccb,'customer':_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x185)],'date':_0x3ecc41,'warehouse_name':_0x122459,'sale_product':_0x4cdc5a,'note':_0x100209,'room':_0x37173,'primary_code':_0x5708b6,'secondary_code':_0x122004,'prod_code':_0x2a4a5e,'SCRN':_0x2cd50f,'finalize':'False','mode_transpo':_0x15a0c7,'name_driver':_0x2a231b}),_0x5c5953=await _0x3ba608[_0x1bd8c9(0x11f)](),_0x3319ca=await sales_finished['findOne']({'invoice':_0x309ccb}),_0x2128af=new c_payment_data({'invoice':_0x309ccb,'customer':_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x185)],'reason':_0x1bd8c9(0x216)});await _0x2128af[_0x1bd8c9(0x11f)]();const _0x35a73f=await master_shop[_0x1bd8c9(0x183)](),_0x5551a8=await email_settings[_0x1bd8c9(0x137)](),_0xc19ffd=await customer['findOne']({'name':_0x29208e[_0x1bd8c9(0x125)][_0x1bd8c9(0x185)]});_0x35a73f[0x0][_0x1bd8c9(0x229)]==0x1?(right_currency=_0x35a73f[0x0][_0x1bd8c9(0x15b)],left_currency=''):(right_currency='',left_currency=_0x35a73f[0x0][_0x1bd8c9(0x15b)]);var _0x4ca83c=_0x1ebaa0,_0x59deac=_0x11fdcb,_0xe95f20='',_0x41db0a;for(_0x41db0a in _0x4ca83c){_0xe95f20+=_0x1bd8c9(0x20e)+_0x1bd8c9(0x159)+_0x4ca83c[_0x41db0a]+_0x1bd8c9(0x143)+_0x1bd8c9(0x159)+_0x59deac[_0x41db0a]+'</td>'+_0x1bd8c9(0x171);}console['log'](_0x1bd8c9(0x140),_0xe95f20);let _0x5d55a6=nodemailer[_0x1bd8c9(0x175)]({'service':_0x1bd8c9(0x129),'auth':{'user':_0x5551a8[_0x1bd8c9(0x1fa)],'pass':_0x5551a8['password']}}),_0x6bc70d={'from':_0x5551a8['email'],'to':_0xc19ffd[_0x1bd8c9(0x1fa)],'subject':_0x1bd8c9(0x1c8),'attachments':[{'filename':_0x1bd8c9(0x149),'path':__dirname+_0x1bd8c9(0x144)+'/upload/'+_0x35a73f[0x0][_0x1bd8c9(0x120)],'cid':'logo'}],'html':_0x1bd8c9(0x207)+_0x1bd8c9(0x1e7)+'</head><body>'+'<div>'+_0x1bd8c9(0x1cf)+_0x1bd8c9(0x16a)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x1bd8c9(0x1bb)+_0x35a73f[0x0]['site_title']+_0x1bd8c9(0x148)+_0x1bd8c9(0x226)+_0x1bd8c9(0x226)+'<hr\x20class=\x22my-3\x22>'+_0x1bd8c9(0x16a)+_0x1bd8c9(0x206)+_0x1bd8c9(0x1ec)+_0x309ccb+'\x20'+_0x1bd8c9(0x193)+_0x1bd8c9(0x1fd)+_0x3ecc41+'\x20'+_0x1bd8c9(0x12c)+_0x1bd8c9(0x1ee)+'</div>'+_0x1bd8c9(0x1dc)+_0x1bd8c9(0x12b)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>'+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xe95f20+'\x20'+_0x1bd8c9(0x222)+'</table>'+'<div>'+_0x1bd8c9(0x172)+'<h5>'+_0x35a73f[0x0][_0x1bd8c9(0x158)]+_0x1bd8c9(0x1ee)+'</div>'+_0x1bd8c9(0x226)+_0x1bd8c9(0x1e3)};_0x5d55a6[_0x1bd8c9(0x1c0)](_0x6bc70d,function(_0x23acbd,_0x2f12a1){var _0x592668=_0x1bd8c9;_0x23acbd?(console[_0x592668(0x1bd)](_0x23acbd),console[_0x592668(0x1bd)](_0x592668(0x1b9))):console['log']('Email\x20sent\x20successfully');}),_0x29208e[_0x1bd8c9(0x145)](_0x1bd8c9(0x17f),_0x1bd8c9(0x1f5)),_0x2d0c48[_0x1bd8c9(0x13f)](_0x1bd8c9(0x1e9)+_0x5c5953['_id']);}catch(_0x561fac){console[_0x1bd8c9(0x1bd)](_0x561fac);}}),router[a0_0x38f957(0x19b)](a0_0x38f957(0x1b8),auth,async(_0x3836ce,_0x5ef770)=>{var _0x1ab09b=a0_0x38f957;try{const {username:_0x297890,email:_0x9b5e65,role:_0x520bae}=_0x3836ce[_0x1ab09b(0x195)],_0x20c5ff=_0x3836ce[_0x1ab09b(0x195)],_0x210402=await profile[_0x1ab09b(0x137)]({'email':_0x20c5ff[_0x1ab09b(0x1fa)]}),_0x2cd88f=await master_shop[_0x1ab09b(0x183)](),_0xe94fb3=_0x3836ce[_0x1ab09b(0x181)]['id'],_0x66adaf=await sales_finished[_0x1ab09b(0x189)](_0xe94fb3),_0x6e5564=await warehouse[_0x1ab09b(0x132)]([{'$match':{'name':_0x66adaf[_0x1ab09b(0x200)]}},{'$unwind':_0x1ab09b(0x186)},{'$group':{'_id':_0x1ab09b(0x19f),'name':{'$first':_0x1ab09b(0x136)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1ab09b(0x1fc)},'bin':{'$first':_0x1ab09b(0x1ea)},'type':{'$first':_0x1ab09b(0x1cb)},'floorlevel':{'$first':_0x1ab09b(0x1a5)},'primary_code':{'$first':_0x1ab09b(0x202)},'secondary_code':{'$first':_0x1ab09b(0x138)},'product_code':{'$first':_0x1ab09b(0x1d1)},'storage':{'$first':_0x1ab09b(0x223)},'rack':{'$first':_0x1ab09b(0x1e4)},'expiry_date':{'$first':_0x1ab09b(0x1a1)},'production_date':{'$first':_0x1ab09b(0x135)},'batch_code':{'$first':_0x1ab09b(0x13e)},'room':{'$first':_0x1ab09b(0x1de)}}}]),_0x1d9629=await customer[_0x1ab09b(0x183)]({});let _0x107526;if(_0x20c5ff[_0x1ab09b(0x156)]==_0x1ab09b(0x19a)){const _0x12fa2d=await staff[_0x1ab09b(0x137)]({'email':_0x20c5ff[_0x1ab09b(0x1fa)]});_0x107526=await warehouse[_0x1ab09b(0x132)]([{'$match':{'status':_0x1ab09b(0x215),'name':_0x12fa2d[_0x1ab09b(0x11e)]}},{'$group':{'_id':_0x1ab09b(0x21e),'name':{'$first':_0x1ab09b(0x21e)}}}]);}else _0x107526=await warehouse[_0x1ab09b(0x132)]([{'$match':{'status':_0x1ab09b(0x215)}},{'$group':{'_id':_0x1ab09b(0x21e),'name':{'$first':_0x1ab09b(0x21e)}}}]);const _0x4e9b6a=await product[_0x1ab09b(0x183)]({});if(_0x2cd88f[0x0][_0x1ab09b(0x15f)]==_0x1ab09b(0x192)){var _0x274fb5=users[_0x1ab09b(0x12d)];console[_0x1ab09b(0x1bd)](_0x274fb5);}else{if(_0x2cd88f[0x0]['language']==_0x1ab09b(0x1e8))var _0x274fb5=users['Hindi'];else{if(_0x2cd88f[0x0][_0x1ab09b(0x15f)]=='German')var _0x274fb5=users[_0x1ab09b(0x1ba)];else{if(_0x2cd88f[0x0][_0x1ab09b(0x15f)]==_0x1ab09b(0x21a))var _0x274fb5=users[_0x1ab09b(0x21a)];else{if(_0x2cd88f[0x0][_0x1ab09b(0x15f)]==_0x1ab09b(0x1f7))var _0x274fb5=users['French'];else{if(_0x2cd88f[0x0][_0x1ab09b(0x15f)]==_0x1ab09b(0x1af))var _0x274fb5=users['Portuguese'];else{if(_0x2cd88f[0x0]['language']==_0x1ab09b(0x1f8))var _0x274fb5=users[_0x1ab09b(0x1f8)];else{if(_0x2cd88f[0x0][_0x1ab09b(0x15f)]==_0x1ab09b(0x165))var _0x274fb5=users[_0x1ab09b(0x18f)];}}}}}}}_0x5ef770[_0x1ab09b(0x168)]('edit_sales_finished_view',{'success':_0x3836ce[_0x1ab09b(0x145)](_0x1ab09b(0x17f)),'errors':_0x3836ce['flash'](_0x1ab09b(0x1c1)),'role':_0x20c5ff,'profile':_0x210402,'customer':_0x1d9629,'warehouse':_0x107526,'product':_0x6e5564,'user':_0x66adaf,'master_shop':_0x2cd88f,'unit':_0x4e9b6a,'language':_0x274fb5});}catch(_0x3144b9){console[_0x1ab09b(0x1bd)](_0x3144b9);}}),router['post'](a0_0x38f957(0x1b8),auth,async(_0x4e6038,_0x64081e)=>{var _0x58f274=a0_0x38f957;try{const _0x2410c1=_0x4e6038[_0x58f274(0x181)]['id'],{invoice:_0x252f1b,warehouse_name:_0x28c31f,room:_0x4d1bef}=_0x4e6038[_0x58f274(0x125)],_0x5cb72e=await sales_finished[_0x58f274(0x137)]({'invoice':_0x252f1b}),_0x266e3e=_0x5cb72e['sale_product'][_0x58f274(0x124)](async _0x2b3200=>{var _0x1a20c9=_0x58f274,_0xf5884a=await warehouse[_0x1a20c9(0x137)]({'name':_0x28c31f,'room':_0x2b3200[_0x1a20c9(0x1e5)],'warehouse_category':'Finished\x20Goods'});const _0x15aad0=_0xf5884a[_0x1a20c9(0x224)]['map'](_0x214dec=>{var _0x45877c=_0x1a20c9;_0x214dec[_0x45877c(0x1c9)]==_0x2b3200[_0x45877c(0x1c9)]&&_0x214dec[_0x45877c(0x1d6)]==_0x2b3200[_0x45877c(0x1d6)]&&_0x214dec[_0x45877c(0x163)]==_0x2b3200[_0x45877c(0x163)]&&_0x214dec[_0x45877c(0x22a)]==_0x2b3200[_0x45877c(0x22a)]&&_0x214dec['batch_code']==_0x2b3200[_0x45877c(0x1ef)]&&_0x214dec[_0x45877c(0x1c5)]==_0x2b3200[_0x45877c(0x1c5)]&&(_0x214dec[_0x45877c(0x13d)]=_0x214dec['product_stock']-_0x2b3200['quantity']);});return _0xf5884a;});Promise[_0x58f274(0x157)](_0x266e3e)[_0x58f274(0x150)](async _0x1275cd=>{var _0x25c84d=_0x58f274;try{for(const _0x5b68f1 of _0x1275cd){await _0x5b68f1[_0x25c84d(0x11f)]();}_0x5cb72e['finalize']=_0x25c84d(0x1ed);const _0x150b36=await _0x5cb72e[_0x25c84d(0x11f)](),_0x1593ed=await master_shop[_0x25c84d(0x183)](),_0x5237d5=await email_settings['findOne'](),_0x2c328e=await supervisor_settings[_0x25c84d(0x183)]();var _0x3759f8=_0x5cb72e[_0x25c84d(0x203)],_0x47530d='',_0x4a8245;for(_0x4a8245 in _0x3759f8){var _0x1ed250='FG';_0x5cb72e[_0x25c84d(0x200)]==_0x25c84d(0x213)&&(_0x1ed250='DG'),_0x47530d+=_0x25c84d(0x20e)+_0x25c84d(0x159)+_0x3759f8[_0x4a8245]['product_name']+_0x25c84d(0x143)+_0x25c84d(0x159)+_0x3759f8[_0x4a8245][_0x25c84d(0x1db)]+_0x25c84d(0x143)+_0x25c84d(0x159)+_0x3759f8[_0x4a8245][_0x25c84d(0x1b6)]+_0x25c84d(0x143)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3759f8[_0x4a8245][_0x25c84d(0x211)]+_0x25c84d(0x143)+_0x25c84d(0x159)+_0x3759f8[_0x4a8245][_0x25c84d(0x1b1)]+_0x25c84d(0x143)+_0x25c84d(0x159)+_0x5cb72e[_0x25c84d(0x200)]+'</td>'+_0x25c84d(0x159)+_0x3759f8[_0x4a8245][_0x25c84d(0x1e5)]+_0x25c84d(0x143)+_0x25c84d(0x159)+_0x1ed250+_0x3759f8[_0x4a8245][_0x25c84d(0x1d6)]+'</td>';}let _0x5a9747=nodemailer['createTransport']({'host':_0x5237d5[_0x25c84d(0x220)],'port':Number(_0x5237d5[_0x25c84d(0x176)]),'secure':![],'auth':{'user':_0x5237d5[_0x25c84d(0x1fa)],'pass':_0x5237d5[_0x25c84d(0x1b2)]}}),_0x3ac274={'from':_0x5237d5[_0x25c84d(0x1fa)],'to':_0x2c328e[0x0][_0x25c84d(0x17b)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x25c84d(0x149),'path':__dirname+_0x25c84d(0x144)+'/upload/'+_0x1593ed[0x0][_0x25c84d(0x120)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x25c84d(0x11d)+_0x25c84d(0x16a)+_0x25c84d(0x1cf)+_0x25c84d(0x16a)+_0x25c84d(0x1d2)+'</div>'+_0x25c84d(0x16a)+_0x25c84d(0x1bb)+_0x1593ed[0x0]['site_title']+_0x25c84d(0x148)+_0x25c84d(0x226)+_0x25c84d(0x226)+'<hr\x20class=\x22my-3\x22>'+_0x25c84d(0x16a)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x25c84d(0x1ec)+_0x5cb72e['invoice']+'\x20'+_0x25c84d(0x193)+_0x25c84d(0x1fd)+_0x5cb72e[_0x25c84d(0x139)]+'\x20'+_0x25c84d(0x12c)+_0x25c84d(0x1ee)+_0x25c84d(0x226)+_0x25c84d(0x1dc)+_0x25c84d(0x12b)+_0x25c84d(0x20e)+_0x25c84d(0x17d)+_0x25c84d(0x14a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x25c84d(0x166)+_0x25c84d(0x1a2)+_0x25c84d(0x199)+_0x25c84d(0x18a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x25c84d(0x171)+_0x25c84d(0x14e)+_0x25c84d(0x182)+'\x20'+_0x47530d+'\x20'+_0x25c84d(0x222)+'</table>'+_0x25c84d(0x16a)+'<strong>\x20Regards\x20</strong>'+_0x25c84d(0x123)+_0x1593ed[0x0][_0x25c84d(0x158)]+_0x25c84d(0x1ee)+_0x25c84d(0x226)+_0x25c84d(0x226)+_0x25c84d(0x1e3)};_0x5a9747[_0x25c84d(0x1c0)](_0x3ac274,function(_0x236379,_0x300837){var _0x4f0c77=_0x25c84d;_0x236379?(console[_0x4f0c77(0x1bd)](_0x236379),console[_0x4f0c77(0x1bd)](_0x4f0c77(0x1b9))):console['log'](_0x4f0c77(0x225));}),_0x4e6038['flash'](_0x25c84d(0x17f),_0x25c84d(0x14d)),_0x64081e[_0x25c84d(0x13f)]('/picking_list/pdf/'+_0x2410c1);}catch(_0x1d7ea6){console['error'](_0x1d7ea6),_0x64081e[_0x25c84d(0x1f6)](0x1f4)[_0x25c84d(0x1f2)]({'error':_0x25c84d(0x1c4)});}})['catch'](_0x19880d=>{var _0xdd45d6=_0x58f274;console[_0xdd45d6(0x177)](_0x19880d),_0x64081e[_0xdd45d6(0x1f6)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x25713c){console[_0x58f274(0x1bd)](_0x25713c);}}),router['get'](a0_0x38f957(0x20f),auth,async(_0x5b4d61,_0xf7affe)=>{var _0x2fbd08=a0_0x38f957;try{const {username:_0x2f8cd9,email:_0x169e9b,role:_0x59dc9a}=_0x5b4d61['user'],_0x529ba2=_0x5b4d61[_0x2fbd08(0x195)],_0x12006e=await profile[_0x2fbd08(0x137)]({'email':_0x529ba2[_0x2fbd08(0x1fa)]}),_0x415699=await master_shop['find'](),_0x209a9b=_0x5b4d61[_0x2fbd08(0x181)]['id'],_0x6c5fae=await sales_finished[_0x2fbd08(0x189)](_0x209a9b);let _0x27c904=new Date(_0x6c5fae[_0x2fbd08(0x163)]),_0x1b0e1a=('0'+_0x27c904[_0x2fbd08(0x1a3)]())[_0x2fbd08(0x20c)](-0x2),_0x4a3910=('0'+(_0x27c904[_0x2fbd08(0x1ca)]()+0x1))[_0x2fbd08(0x20c)](-0x2),_0x368f84=_0x27c904[_0x2fbd08(0x1c3)](),_0x57694c=_0x368f84+'-'+_0x4a3910+'-'+_0x1b0e1a;var _0x3a4eeb=['Ambient','Enclosed'];const _0x503fb5=await warehouse[_0x2fbd08(0x132)]([{'$match':{'name':_0x6c5fae[_0x2fbd08(0x200)],'room':_0x6c5fae[_0x2fbd08(0x14f)]}},{'$unwind':_0x2fbd08(0x186)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x2fbd08(0x1cb)},'floorlevel':{'$first':_0x2fbd08(0x1a5)},'primary_code':{'$first':_0x2fbd08(0x202)},'secondary_code':{'$first':_0x2fbd08(0x138)},'product_code':{'$first':_0x2fbd08(0x1d1)},'storage':{'$first':_0x2fbd08(0x223)},'rack':{'$first':_0x2fbd08(0x1e4)}}}]),_0x5e7184=await customer[_0x2fbd08(0x183)]({});let _0x3a7f84;if(_0x529ba2['role']=='staff'){const _0x28185d=await staff['findOne']({'email':_0x529ba2[_0x2fbd08(0x1fa)]});_0x3a7f84=await warehouse['aggregate']([{'$match':{'status':_0x2fbd08(0x215),'name':_0x28185d[_0x2fbd08(0x11e)]}},{'$group':{'_id':'$name','name':{'$first':_0x2fbd08(0x21e)}}}]);}else _0x3a7f84=await warehouse['aggregate']([{'$match':{'status':_0x2fbd08(0x215)}},{'$group':{'_id':_0x2fbd08(0x21e),'name':{'$first':'$name'}}}]);const _0x3a9288=await product[_0x2fbd08(0x183)]({});if(_0x415699[0x0][_0x2fbd08(0x15f)]=='English\x20(US)'){var _0x281736=users[_0x2fbd08(0x12d)];console[_0x2fbd08(0x1bd)](_0x281736);}else{if(_0x415699[0x0][_0x2fbd08(0x15f)]==_0x2fbd08(0x1e8))var _0x281736=users[_0x2fbd08(0x1e8)];else{if(_0x415699[0x0][_0x2fbd08(0x15f)]==_0x2fbd08(0x1ba))var _0x281736=users[_0x2fbd08(0x1ba)];else{if(_0x415699[0x0]['language']==_0x2fbd08(0x21a))var _0x281736=users[_0x2fbd08(0x21a)];else{if(_0x415699[0x0]['language']==_0x2fbd08(0x1f7))var _0x281736=users[_0x2fbd08(0x1f7)];else{if(_0x415699[0x0]['language']=='Portuguese\x20(BR)')var _0x281736=users['Portuguese'];else{if(_0x415699[0x0]['language']==_0x2fbd08(0x1f8))var _0x281736=users[_0x2fbd08(0x1f8)];else{if(_0x415699[0x0][_0x2fbd08(0x15f)]==_0x2fbd08(0x165))var _0x281736=users[_0x2fbd08(0x18f)];}}}}}}}_0xf7affe['render']('edit_sales_finished',{'success':_0x5b4d61['flash'](_0x2fbd08(0x17f)),'errors':_0x5b4d61[_0x2fbd08(0x145)](_0x2fbd08(0x1c1)),'role':_0x529ba2,'profile':_0x12006e,'customer':_0x5e7184,'warehouse':_0x3a7f84,'product':_0x503fb5,'user':_0x6c5fae,'master_shop':_0x415699,'unit':_0x3a9288,'language':_0x281736,'rooms_data':_0x3a4eeb,'ed_fullDate':_0x57694c});}catch(_0x3e16f7){console[_0x2fbd08(0x1bd)](_0x3e16f7);}}),router[a0_0x38f957(0x197)](a0_0x38f957(0x20f),auth,async(_0x36b9c3,_0x23bfe8)=>{var _0x30be17=a0_0x38f957;try{const _0x5c4d7f=_0x36b9c3[_0x30be17(0x181)]['id'],_0x1bf852=await sales_finished[_0x30be17(0x137)]({'_id':_0x36b9c3[_0x30be17(0x181)]['id']}),_0x5ca7b0=await warehouse[_0x30be17(0x137)]({'name':_0x1bf852[_0x30be17(0x200)],'room':_0x36b9c3[_0x30be17(0x125)][_0x30be17(0x14f)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x1030b7,customer:_0x1e7515,date:_0x49f873,warehouse_name:_0x521aa8,product_name:_0x25511f,stock:_0x15a30c,adjust_qty:_0x5f4516,note:_0x8f321b,room:_0x4b1acb,primary_code:_0x4d885c,secondary_code:_0x15b87a,prod_code:_0x201d64,level:_0x532198,isle:_0x12b870,pallet:_0x39d2d3,expiry_date:_0x5a83df}=_0x36b9c3[_0x30be17(0x125)];if(typeof _0x25511f==_0x30be17(0x15c))var _0x498b42=[_0x36b9c3[_0x30be17(0x125)][_0x30be17(0x1c9)]],_0x3b4539=[_0x36b9c3['body'][_0x30be17(0x19d)]],_0x4d8efa=[_0x36b9c3['body'][_0x30be17(0x15a)]],_0xc640bd=[_0x36b9c3[_0x30be17(0x125)]['primary_code']],_0x5ed58e=[_0x36b9c3[_0x30be17(0x125)][_0x30be17(0x1f1)]],_0x393ba1=[_0x36b9c3[_0x30be17(0x125)][_0x30be17(0x1d8)]],_0x5917f5=[_0x36b9c3[_0x30be17(0x125)][_0x30be17(0x196)]],_0x50f079=[_0x36b9c3['body']['expiry_date']];else var _0x498b42=[..._0x36b9c3['body'][_0x30be17(0x1c9)]],_0x3b4539=[..._0x36b9c3[_0x30be17(0x125)]['stock']],_0x4d8efa=[..._0x36b9c3[_0x30be17(0x125)][_0x30be17(0x15a)]],_0xc640bd=[..._0x36b9c3[_0x30be17(0x125)][_0x30be17(0x11c)]],_0x5ed58e=[..._0x36b9c3[_0x30be17(0x125)]['secondary_code']],_0x393ba1=[..._0x36b9c3['body'][_0x30be17(0x1d8)]],_0x5917f5=[..._0x36b9c3[_0x30be17(0x125)][_0x30be17(0x196)]],_0x50f079=[..._0x36b9c3[_0x30be17(0x125)][_0x30be17(0x163)]];const _0x36d518=_0x498b42['map'](_0x2f1be0=>{return _0x2f1be0={'product_name':_0x2f1be0};});_0x3b4539['forEach']((_0x1be439,_0x4bb0db)=>{var _0x5d9b49=_0x30be17;_0x36d518[_0x4bb0db][_0x5d9b49(0x19d)]=_0x1be439;}),_0x4d8efa[_0x30be17(0x1cd)]((_0x3befec,_0x4c0833)=>{var _0x34fb61=_0x30be17;_0x36d518[_0x4c0833][_0x34fb61(0x1b6)]=_0x3befec;}),_0xc640bd[_0x30be17(0x1cd)]((_0x3db690,_0x22ff6e)=>{var _0x364291=_0x30be17;_0x36d518[_0x22ff6e][_0x364291(0x11c)]=_0x3db690;}),_0x5ed58e[_0x30be17(0x1cd)]((_0x13378c,_0x1d85c0)=>{var _0x5a4259=_0x30be17;_0x36d518[_0x1d85c0][_0x5a4259(0x1f1)]=_0x13378c;}),_0x393ba1[_0x30be17(0x1cd)]((_0x42355e,_0x33003b)=>{var _0x38d466=_0x30be17;_0x36d518[_0x33003b][_0x38d466(0x1db)]=_0x42355e;}),_0x5917f5['forEach']((_0x25ace4,_0x3ebfac)=>{var _0x3fed09=_0x30be17;_0x36d518[_0x3ebfac][_0x3fed09(0x196)]=_0x25ace4;}),_0x50f079[_0x30be17(0x1cd)]((_0x342114,_0x5cf290)=>{var _0xc4a811=_0x30be17;_0x36d518[_0x5cf290][_0xc4a811(0x163)]=_0x342114;});var _0xcbd1f0=0x0;_0x36d518[_0x30be17(0x1cd)](_0xeee1=>{var _0x2a4e1e=_0x30be17;console[_0x2a4e1e(0x1bd)](_0x2a4e1e(0x1b5),_0xeee1),(parseInt(_0xeee1[_0x2a4e1e(0x19d)])<parseInt(_0xeee1['quantity'])||parseInt(_0xeee1[_0x2a4e1e(0x1b6)])==0x0)&&_0xcbd1f0++;});if(_0xcbd1f0!=0x0)return _0x36b9c3['flash'](_0x30be17(0x1c1),_0x30be17(0x16c)),_0x23bfe8[_0x30be17(0x13f)](_0x30be17(0x1e2));_0x1bf852[_0x30be17(0x203)][_0x30be17(0x1cd)](_0x28985f=>{var _0x5e7913=_0x30be17;const _0x16b65e=_0x5ca7b0[_0x5e7913(0x224)][_0x5e7913(0x124)](_0x453fff=>{var _0x464865=_0x5e7913;_0x453fff[_0x464865(0x1c9)]==_0x28985f['product_name']&&_0x453fff[_0x464865(0x1d6)]==_0x28985f[_0x464865(0x1d6)]&&(_0x453fff[_0x464865(0x13d)]=parseInt(_0x453fff[_0x464865(0x13d)])+parseInt(_0x28985f['quantity']));});}),await _0x5ca7b0[_0x30be17(0x11f)]();const _0x489ff4=_0x36d518['filter'](_0x55e631=>_0x55e631[_0x30be17(0x1b6)]!=='0'&&_0x55e631[_0x30be17(0x1b6)]!=='');_0x1bf852[_0x30be17(0x1c5)]=_0x1030b7,_0x1bf852[_0x30be17(0x185)]=_0x1e7515,_0x1bf852[_0x30be17(0x139)]=_0x49f873,_0x1bf852['warehouse_name']=_0x521aa8,_0x1bf852[_0x30be17(0x203)]=_0x489ff4,_0x1bf852[_0x30be17(0x178)]=_0x8f321b,_0x1bf852['room']=_0x4b1acb;const _0xa9ae72=await _0x1bf852[_0x30be17(0x11f)](),_0x2bc871=await sales_finished[_0x30be17(0x137)]({'_id':_0x36b9c3[_0x30be17(0x181)]['id']}),_0x35ba3f=await warehouse[_0x30be17(0x137)]({'name':_0x521aa8,'room':_0x4b1acb,'warehouse_category':_0x30be17(0x169)});_0x2bc871[_0x30be17(0x203)][_0x30be17(0x1cd)](_0x368642=>{var _0x23c83c=_0x30be17;const _0x126ec2=_0x35ba3f[_0x23c83c(0x224)][_0x23c83c(0x124)](_0x5acbbf=>{var _0xc71e7c=_0x23c83c;_0x5acbbf[_0xc71e7c(0x1c9)]==_0x368642[_0xc71e7c(0x1c9)]&&_0x5acbbf['bay']==_0x368642[_0xc71e7c(0x1d6)]&&(_0x5acbbf[_0xc71e7c(0x13d)]=parseInt(_0x5acbbf[_0xc71e7c(0x13d)])-parseInt(_0x368642[_0xc71e7c(0x1b6)]));});}),console[_0x30be17(0x1bd)](_0x30be17(0x1c2),_0x35ba3f),await _0x35ba3f[_0x30be17(0x11f)]();const _0x73c8f=await c_payment_data[_0x30be17(0x137)]({'invoice':_0x36b9c3[_0x30be17(0x125)]['invoice']});_0x73c8f['suppliers']=_0x36b9c3[_0x30be17(0x125)][_0x30be17(0x208)],await _0x73c8f[_0x30be17(0x11f)](),_0x36b9c3['flash'](_0x30be17(0x17f),'Sales\x20Update\x20successfully'),_0x23bfe8[_0x30be17(0x13f)](_0x30be17(0x17e));}catch(_0x3a8f4){console[_0x30be17(0x1bd)](_0x3a8f4);}}),router['post'](a0_0x38f957(0x131),auth,async(_0x30f04e,_0x40ab26)=>{var _0x371f90=a0_0x38f957;try{const _0x5e6fdc=_0x30f04e[_0x371f90(0x181)]['id'],{invoice:_0x51c9d3,customer:_0x43e31c,receivable_amount:_0x1b443c,received_amount:_0x29210c}=_0x30f04e[_0x371f90(0x125)],_0x296a9a=await sales[_0x371f90(0x189)](_0x5e6fdc);console[_0x371f90(0x1bd)](_0x296a9a);var _0xf1e6b7=_0x1b443c-_0x29210c;console[_0x371f90(0x1bd)](_0x29210c),_0x296a9a[_0x371f90(0x19c)]=parseFloat(_0x29210c)+parseFloat(_0x296a9a['received_amount']),_0x296a9a[_0x371f90(0x133)]=_0xf1e6b7,console[_0x371f90(0x1bd)](_0x296a9a);const _0xe6321c=await _0x296a9a['save'](),_0x21feee=await c_payment_data['findOne']({'invoice':_0x51c9d3});_0x21feee[_0x371f90(0x1c6)]=_0xf1e6b7,await _0x21feee[_0x371f90(0x11f)]();let _0x49b264=new Date(),_0x5942c7=('0'+_0x49b264[_0x371f90(0x1a3)]())[_0x371f90(0x20c)](-0x2),_0x291f7d=('0'+(_0x49b264[_0x371f90(0x1ca)]()+0x1))[_0x371f90(0x20c)](-0x2),_0x5887f6=_0x49b264[_0x371f90(0x1c3)](),_0x56372c=_0x5887f6+'-'+_0x291f7d+'-'+_0x5942c7;const _0x15c6a2=new customer_payment({'invoice':_0x51c9d3,'date':_0x5887f6+'-'+_0x291f7d+'-'+_0x5942c7,'customer':_0x43e31c,'reason':_0x371f90(0x1d9),'amount':_0x29210c}),_0x51485e=await _0x15c6a2[_0x371f90(0x11f)]();_0x30f04e['flash'](_0x371f90(0x17f),'payment\x20successfull'),_0x40ab26['redirect'](_0x371f90(0x1d0));}catch(_0x25f8fc){console[_0x371f90(0x1bd)](_0x25f8fc);}}),router[a0_0x38f957(0x19b)](a0_0x38f957(0x204),auth,async(_0x1844e0,_0x2b4760)=>{var _0x21212d=a0_0x38f957;try{const {username:_0x47e7de,email:_0xe57f87,role:_0x249344}=_0x1844e0[_0x21212d(0x195)],_0x554cde=_0x1844e0[_0x21212d(0x195)],_0x4d462f=await profile[_0x21212d(0x137)]({'email':_0x554cde[_0x21212d(0x1fa)]}),_0x31bbd8=await master_shop[_0x21212d(0x183)]();console[_0x21212d(0x1bd)]('master',_0x31bbd8);const _0x21637e=_0x1844e0[_0x21212d(0x181)]['id'],_0x1d70ce=await sales[_0x21212d(0x189)](_0x21637e);console[_0x21212d(0x1bd)](_0x1d70ce);const _0x4c6489=await customer['findOne']({'name':_0x1d70ce[_0x21212d(0x185)]});console[_0x21212d(0x1bd)](_0x4c6489);if(_0x31bbd8[0x0]['language']=='English\x20(US)'){var _0x20060d=users['English'];console[_0x21212d(0x1bd)](_0x20060d);}else{if(_0x31bbd8[0x0][_0x21212d(0x15f)]==_0x21212d(0x1e8))var _0x20060d=users[_0x21212d(0x1e8)];else{if(_0x31bbd8[0x0][_0x21212d(0x15f)]==_0x21212d(0x1ba))var _0x20060d=users[_0x21212d(0x1ba)];else{if(_0x31bbd8[0x0][_0x21212d(0x15f)]=='Spanish')var _0x20060d=users[_0x21212d(0x21a)];else{if(_0x31bbd8[0x0][_0x21212d(0x15f)]=='French')var _0x20060d=users[_0x21212d(0x1f7)];else{if(_0x31bbd8[0x0][_0x21212d(0x15f)]==_0x21212d(0x1af))var _0x20060d=users['Portuguese'];else{if(_0x31bbd8[0x0][_0x21212d(0x15f)]=='Chinese')var _0x20060d=users[_0x21212d(0x1f8)];else{if(_0x31bbd8[0x0]['language']==_0x21212d(0x165))var _0x20060d=users[_0x21212d(0x18f)];}}}}}}}_0x2b4760[_0x21212d(0x168)](_0x21212d(0x1b7),{'success':_0x1844e0[_0x21212d(0x145)](_0x21212d(0x17f)),'errors':_0x1844e0[_0x21212d(0x145)](_0x21212d(0x1c1)),'role':_0x554cde,'profile':_0x4d462f,'master_shop':_0x31bbd8,'customers':_0x4c6489,'sales':_0x1d70ce,'language':_0x20060d});}catch(_0x5ad713){console[_0x21212d(0x1bd)](_0x5ad713);}}),router['get'](a0_0x38f957(0x1a4),auth,async(_0x398c11,_0x3843de)=>{var _0x51a353=a0_0x38f957;try{const {username:_0x287f3f,email:_0x4ef8ac,role:_0xfd5f8a}=_0x398c11[_0x51a353(0x195)],_0x39ce57=_0x398c11[_0x51a353(0x195)],_0x496f21=await profile[_0x51a353(0x137)]({'email':_0x39ce57['email']}),_0x4bf2f8=await master_shop[_0x51a353(0x183)](),_0x1bfe8a=_0x398c11[_0x51a353(0x181)]['id'],_0x696ae1=await sales_finished['findById'](_0x1bfe8a),_0x28bb67=await warehouse[_0x51a353(0x132)]([{'$match':{'name':_0x696ae1[_0x51a353(0x200)]}},{'$unwind':_0x51a353(0x186)},{'$group':{'_id':_0x51a353(0x19f),'name':{'$first':_0x51a353(0x136)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x51a353(0x1fc)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x51a353(0x1cb)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x51a353(0x202)},'secondary_code':{'$first':_0x51a353(0x138)},'product_code':{'$first':_0x51a353(0x1d1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x51a353(0x1a1)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0x51a353(0x1f0)},'secondary_unit':{'$first':_0x51a353(0x173)},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':_0x51a353(0x13e)},'maxPerUnit':{'$first':_0x51a353(0x12e)}}}]),_0x228751=await product[_0x51a353(0x183)]({}),_0x293091=await warehouse['aggregate']([{'$match':{'status':_0x51a353(0x215),'warehouse_category':_0x51a353(0x169),'name':{'$ne':_0x51a353(0x1aa),'$ne':_0x51a353(0x1dd)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x398213=[_0x51a353(0x15d)];const _0x34e336=await warehouse[_0x51a353(0x132)]([{'$match':{'status':_0x51a353(0x215),'name':_0x51a353(0x1dd)}},{'$group':{'_id':_0x51a353(0x21e),'name':{'$first':_0x51a353(0x21e)}}},{'$sort':{'name':0x1}}]);if(_0x4bf2f8[0x0]['language']==_0x51a353(0x192)){var _0x2ef959=users[_0x51a353(0x12d)];console[_0x51a353(0x1bd)](_0x2ef959);}else{if(_0x4bf2f8[0x0]['language']=='Hindi')var _0x2ef959=users['Hindi'];else{if(_0x4bf2f8[0x0][_0x51a353(0x15f)]==_0x51a353(0x1ba))var _0x2ef959=users['German'];else{if(_0x4bf2f8[0x0][_0x51a353(0x15f)]=='Spanish')var _0x2ef959=users[_0x51a353(0x21a)];else{if(_0x4bf2f8[0x0][_0x51a353(0x15f)]=='French')var _0x2ef959=users['French'];else{if(_0x4bf2f8[0x0][_0x51a353(0x15f)]==_0x51a353(0x1af))var _0x2ef959=users[_0x51a353(0x13a)];else{if(_0x4bf2f8[0x0][_0x51a353(0x15f)]==_0x51a353(0x1f8))var _0x2ef959=users['Chinese'];else{if(_0x4bf2f8[0x0]['language']==_0x51a353(0x165))var _0x2ef959=users[_0x51a353(0x18f)];}}}}}}}_0x3843de['render'](_0x51a353(0x219),{'success':_0x398c11[_0x51a353(0x145)](_0x51a353(0x17f)),'errors':_0x398c11[_0x51a353(0x145)](_0x51a353(0x1c1)),'role':_0x39ce57,'profile':_0x496f21,'user':_0x696ae1,'stock':_0x28bb67,'master_shop':_0x4bf2f8,'unit':_0x228751,'language':_0x2ef959,'warehouses':_0x293091,'rooms':_0x398213,'warehouse_QA':_0x34e336});}catch(_0x300e5d){console['log'](_0x300e5d),_0x3843de[_0x51a353(0x1f6)](0xc8)[_0x51a353(0x1f2)]({'message':_0x300e5d['message']});}}),router[a0_0x38f957(0x197)](a0_0x38f957(0x1a4),auth,async(_0x2ffc63,_0x157d8f)=>{var _0x3de802=a0_0x38f957;if(_0x2ffc63['body'][_0x3de802(0x21f)]=='QA')try{const {invoice:_0xcc3d0c,date:_0x172768,warehouse_name:_0x4bffb9,product_name:_0xb69b91,primary_code:_0x2c63ee,secondary_code:_0x3a1c3f,product_code:_0x33fec8,sales_quantity:_0x118495,stocks:_0x599545,return_qty:_0x5a39f6,Room_name:_0x47a785,to_warehouse_name_QA:_0x435a65,to_Room_name_QA:_0x1c72a6,note:_0x1b13cb,for_categorize:_0x1b6200,product_name_QA1:_0x2aed5b}=_0x2ffc63[_0x3de802(0x125)];if(typeof _0x2aed5b==_0x3de802(0x15c))var _0x8ce3d2=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x164)]],_0x4ead7c=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x12a)]],_0x557a57=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x134)]],_0x142864=[_0x2ffc63[_0x3de802(0x125)]['product_code_QA']],_0x2d80ed=[_0x2ffc63[_0x3de802(0x125)]['sales_quantity_QA']],_0x13e5df=[_0x2ffc63['body'][_0x3de802(0x1a6)]],_0x3d6243=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1d5)]],_0x12d6a0=[_0x2ffc63['body'][_0x3de802(0x21d)]],_0x49fd60=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x16e)]],_0x2e7f3c=[_0x2ffc63[_0x3de802(0x125)]['batch_code_QA']],_0x3bb2d4=[_0x2ffc63[_0x3de802(0x125)]['secondary_unit_QA']],_0x11093c=[_0x2ffc63['body'][_0x3de802(0x1a9)]],_0x5efeb2=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x218)]],_0x406f5c=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x201)]];else var _0x8ce3d2=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x164)]],_0x4ead7c=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x12a)]],_0x557a57=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x134)]],_0x142864=[..._0x2ffc63[_0x3de802(0x125)]['product_code_QA']],_0x2d80ed=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x16b)]],_0x13e5df=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1a6)]],_0x3d6243=[..._0x2ffc63['body'][_0x3de802(0x1d5)]],_0x12d6a0=[..._0x2ffc63['body'][_0x3de802(0x21d)]],_0x49fd60=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x16e)]],_0x2e7f3c=[..._0x2ffc63[_0x3de802(0x125)]['batch_code_QA']],_0x3bb2d4=[..._0x2ffc63['body'][_0x3de802(0x146)]],_0x11093c=[..._0x2ffc63['body'][_0x3de802(0x1a9)]],_0x5efeb2=[..._0x2ffc63[_0x3de802(0x125)]['production_date_QA']],_0x406f5c=[..._0x2ffc63['body'][_0x3de802(0x201)]];const _0x5c2aeb=_0x8ce3d2[_0x3de802(0x124)](_0x400e23=>{return _0x400e23={'product_name':_0x400e23};});_0x4ead7c[_0x3de802(0x1cd)]((_0x21ccec,_0x289a6e)=>{var _0x3467bb=_0x3de802;_0x5c2aeb[_0x289a6e][_0x3467bb(0x11c)]=_0x21ccec;}),_0x557a57['forEach']((_0x3542b0,_0x1dee30)=>{var _0x75c896=_0x3de802;_0x5c2aeb[_0x1dee30][_0x75c896(0x1f1)]=_0x3542b0;}),_0x142864[_0x3de802(0x1cd)]((_0x54abe9,_0x14ce75)=>{var _0x665dca=_0x3de802;_0x5c2aeb[_0x14ce75][_0x665dca(0x1db)]=_0x54abe9;}),_0x2d80ed[_0x3de802(0x1cd)]((_0x552d72,_0x310833)=>{var _0x4904ff=_0x3de802;_0x5c2aeb[_0x310833][_0x4904ff(0x128)]=_0x552d72;}),_0x13e5df[_0x3de802(0x1cd)]((_0x321268,_0x335dbc)=>{var _0x2c28ce=_0x3de802;_0x5c2aeb[_0x335dbc][_0x2c28ce(0x19d)]=_0x321268;}),_0x3d6243['forEach']((_0x18fce1,_0x67e5ed)=>{_0x5c2aeb[_0x67e5ed]['return_qty']=_0x18fce1;}),_0x12d6a0[_0x3de802(0x1cd)]((_0x21d93f,_0x3674a2)=>{var _0x38e936=_0x3de802;_0x5c2aeb[_0x3674a2][_0x38e936(0x1be)]=_0x21d93f;}),_0x49fd60[_0x3de802(0x1cd)]((_0x529cbf,_0x5b6dbe)=>{_0x5c2aeb[_0x5b6dbe]['maxProducts']=_0x529cbf;}),_0x2e7f3c[_0x3de802(0x1cd)]((_0x21aed2,_0x3457d9)=>{_0x5c2aeb[_0x3457d9]['batch_code']=_0x21aed2;}),_0x3bb2d4[_0x3de802(0x1cd)]((_0x5b9d7,_0x5a4820)=>{var _0x805fd0=_0x3de802;_0x5c2aeb[_0x5a4820][_0x805fd0(0x1b1)]=_0x5b9d7;}),_0x11093c[_0x3de802(0x1cd)]((_0x497a85,_0x452c86)=>{var _0x158516=_0x3de802;_0x5c2aeb[_0x452c86][_0x158516(0x211)]=_0x497a85;}),_0x5efeb2['forEach']((_0x83518f,_0x4236ad)=>{_0x5c2aeb[_0x4236ad]['production_date']=_0x83518f;}),_0x406f5c['forEach']((_0x35ad8e,_0x364e83)=>{var _0x3d5dea=_0x3de802;_0x5c2aeb[_0x364e83][_0x3d5dea(0x163)]=_0x35ad8e;});const _0x42fd6d=await sales_finished[_0x3de802(0x137)]({'invoice':_0xcc3d0c});_0x42fd6d[_0x3de802(0x191)]=_0x3de802(0x1ed);const _0x19daf7=await _0x42fd6d[_0x3de802(0x11f)](),_0x40ea90=new sales_return_finished({'invoice':_0xcc3d0c,'customer':_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x185)],'date':_0x172768,'warehouse_name':_0x4bffb9,'room':_0x47a785,'ToWarehouse':_0x435a65,'ToRoom':_0x1c72a6,'return_sale_QA':_0x5c2aeb,'note':_0x1b13cb,'warehouse_cat':_0x1b6200}),_0x38846f=await _0x40ea90['save'](),_0x38a876=await sales_return_finished[_0x3de802(0x137)]({'invoice':_0xcc3d0c}),_0x49635b=await warehouse[_0x3de802(0x137)]({'name':_0x435a65,'room':_0x1c72a6});_0x38a876[_0x3de802(0x153)][_0x3de802(0x1cd)](_0x251cb6=>{var _0x2d27cc=_0x3de802,_0x4cbcae=0x0;const _0x387aab=_0x49635b[_0x2d27cc(0x224)]['map'](_0x2e5bf7=>{var _0x48461c=_0x2d27cc;_0x2e5bf7[_0x48461c(0x1c9)]==_0x251cb6['product_name']&&_0x2e5bf7[_0x48461c(0x163)]==_0x251cb6[_0x48461c(0x163)]&&_0x2e5bf7['production_date']==_0x251cb6['production_date']&&_0x2e5bf7[_0x48461c(0x1ef)]==_0x251cb6['batch_code']&&(_0x2e5bf7[_0x48461c(0x13d)]=parseInt(_0x2e5bf7['product_stock'])+parseInt(_0x251cb6['return_qty']),_0x4cbcae++);});_0x4cbcae=='0'&&(_0x49635b['product_details']=_0x49635b[_0x2d27cc(0x224)][_0x2d27cc(0x17a)]({'product_name':_0x251cb6['product_name'],'product_stock':_0x251cb6[_0x2d27cc(0x1e6)],'primary_code':_0x251cb6['primary_code'],'secondary_code':_0x251cb6[_0x2d27cc(0x1f1)],'product_code':_0x251cb6[_0x2d27cc(0x1db)],'batch_code':_0x251cb6['batch_code'],'maxPerUnit':_0x251cb6[_0x2d27cc(0x1be)],'production_date':_0x251cb6[_0x2d27cc(0x22a)],'expiry_date':_0x251cb6[_0x2d27cc(0x163)],'secondary_unit':_0x251cb6[_0x2d27cc(0x1b1)],'unit':_0x251cb6['unit'],'maxProducts':_0x251cb6['maxProducts'],'bay':_0x251cb6[_0x2d27cc(0x1d6)]}));}),await _0x49635b[_0x3de802(0x11f)]();const _0x354a42=new c_payment_data({'invoice':_0xcc3d0c,'customer':_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x185)],'reason':_0x3de802(0x194)});await _0x354a42[_0x3de802(0x11f)]();const _0x570563=await master_shop[_0x3de802(0x183)](),_0x1584f7=await email_settings[_0x3de802(0x137)](),_0x1ebadd=await customer[_0x3de802(0x137)]({'name':_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x185)]});_0x570563[0x0]['currency_placement']==0x1?(right_currency=_0x570563[0x0][_0x3de802(0x15b)],left_currency=''):(right_currency='',left_currency=_0x570563[0x0][_0x3de802(0x15b)]);var _0x5eb4aa=_0x8ce3d2,_0x4408f9=_0x3d6243,_0x1e717c='',_0xe5dd58;for(_0xe5dd58 in _0x5eb4aa){_0x1e717c+=_0x3de802(0x20e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5eb4aa[_0xe5dd58]+_0x3de802(0x143)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4408f9[_0xe5dd58]+_0x3de802(0x143)+'</tr>';}console['log'](_0x3de802(0x140),_0x1e717c);let _0xc82d0=nodemailer[_0x3de802(0x175)]({'service':_0x3de802(0x129),'auth':{'user':_0x1584f7[_0x3de802(0x1fa)],'pass':_0x1584f7[_0x3de802(0x1b2)]}}),_0x30fc91={'from':_0x1584f7['email'],'to':_0x1ebadd[_0x3de802(0x1fa)],'subject':_0x3de802(0x1fe),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x570563[0x0][_0x3de802(0x120)],'cid':_0x3de802(0x127)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x3de802(0x11d)+_0x3de802(0x16a)+_0x3de802(0x1cf)+_0x3de802(0x16a)+_0x3de802(0x1d2)+_0x3de802(0x226)+'<div>'+_0x3de802(0x1bb)+_0x570563[0x0][_0x3de802(0x158)]+_0x3de802(0x148)+'</div>'+_0x3de802(0x226)+_0x3de802(0x1a0)+'<div>'+_0x3de802(0x206)+_0x3de802(0x1ec)+_0xcc3d0c+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3de802(0x1fd)+_0x172768+'\x20'+_0x3de802(0x12c)+_0x3de802(0x1ee)+_0x3de802(0x226)+_0x3de802(0x1dc)+_0x3de802(0x12b)+_0x3de802(0x20e)+_0x3de802(0x17d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x3de802(0x162)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x3de802(0x14e)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1e717c+'\x20'+_0x3de802(0x222)+_0x3de802(0x1e0)+_0x3de802(0x16a)+_0x3de802(0x172)+_0x3de802(0x123)+_0x570563[0x0]['site_title']+_0x3de802(0x1ee)+_0x3de802(0x226)+'</div>'+_0x3de802(0x1e3)};_0xc82d0['sendMail'](_0x30fc91,function(_0x115f43,_0x4da2f3){var _0x12dac9=_0x3de802;_0x115f43?(console[_0x12dac9(0x1bd)](_0x115f43),console[_0x12dac9(0x1bd)]('Error\x20Occurs')):console[_0x12dac9(0x1bd)](_0x12dac9(0x225));}),_0x2ffc63[_0x3de802(0x145)]('success','sales\x20item\x20return\x20successfull'),_0x157d8f[_0x3de802(0x13f)]('/all_sales_finished/view');}catch(_0x4e12cd){_0x157d8f[_0x3de802(0x1f6)](0xc8)['json']({'message1':_0x4e12cd[_0x3de802(0x1ab)]});}else{if(_0x2ffc63[_0x3de802(0x125)]['for_categorize']=='GS')try{const {invoice:_0x3e4817,date:_0x38ff78,warehouse_name:_0x57a388,product_name:_0x24f846,primary_code:_0xc92aa8,secondary_code:_0x1966c6,product_code:_0x1f615a,sales_quantity:_0x5c0d18,stocks:_0x168b8f,return_qty:_0x306113,Room_name:_0x3534fa,to_warehouse_name:_0x4212d8,to_Room_name:_0x5a04bc,note:_0x5b5bc9,level:_0x5cdb2a,isle:_0x3d665b,pallet:_0x5458c8,for_categorize:_0x37df85}=_0x2ffc63[_0x3de802(0x125)];if(typeof _0x24f846==_0x3de802(0x15c))var _0x8ce3d2=[_0x2ffc63['body'][_0x3de802(0x1c9)]],_0x4ead7c=[_0x2ffc63['body'][_0x3de802(0x11c)]],_0x557a57=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1f1)]],_0x142864=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1db)]],_0x2d80ed=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x20d)]],_0x3d6243=[_0x2ffc63['body']['return_qty']],_0x48448e=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1d6)]],_0x12d6a0=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1be)]],_0x49fd60=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x19e)]],_0x2e7f3c=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1ef)]],_0x3bb2d4=[_0x2ffc63[_0x3de802(0x125)]['secondary_unit']],_0x11093c=[_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x211)]],_0x5efeb2=[_0x2ffc63['body']['production_date']],_0x406f5c=[_0x2ffc63['body']['expiry_date']];else var _0x8ce3d2=[..._0x2ffc63['body'][_0x3de802(0x1c9)]],_0x4ead7c=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x11c)]],_0x557a57=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1f1)]],_0x142864=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1db)]],_0x2d80ed=[..._0x2ffc63['body'][_0x3de802(0x20d)]],_0x3d6243=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1e6)]],_0x48448e=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1d6)]],_0x12d6a0=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x1be)]],_0x49fd60=[..._0x2ffc63[_0x3de802(0x125)]['maxProducts']],_0x2e7f3c=[..._0x2ffc63['body']['batch_code']],_0x3bb2d4=[..._0x2ffc63['body'][_0x3de802(0x1b1)]],_0x11093c=[..._0x2ffc63[_0x3de802(0x125)][_0x3de802(0x211)]],_0x5efeb2=[..._0x2ffc63['body'][_0x3de802(0x22a)]],_0x406f5c=[..._0x2ffc63['body']['expiry_date']];const _0x223980=_0x8ce3d2[_0x3de802(0x124)](_0x298449=>{return _0x298449={'product_name':_0x298449};});_0x4ead7c[_0x3de802(0x1cd)]((_0x2a17b6,_0x28a3a9)=>{_0x223980[_0x28a3a9]['primary_code']=_0x2a17b6;}),_0x557a57[_0x3de802(0x1cd)]((_0x7e9915,_0x4687eb)=>{var _0x307bdd=_0x3de802;_0x223980[_0x4687eb][_0x307bdd(0x1f1)]=_0x7e9915;}),_0x142864[_0x3de802(0x1cd)]((_0x2b2279,_0x183650)=>{_0x223980[_0x183650]['product_code']=_0x2b2279;}),_0x2d80ed['forEach']((_0x44d349,_0x339a8e)=>{var _0x2cc1bf=_0x3de802;_0x223980[_0x339a8e][_0x2cc1bf(0x128)]=_0x44d349;}),_0x3d6243[_0x3de802(0x1cd)]((_0x49e041,_0x4872c7)=>{var _0x3ac10f=_0x3de802;_0x223980[_0x4872c7][_0x3ac10f(0x1e6)]=_0x49e041;}),_0x48448e['forEach']((_0x2110c7,_0x13a68e)=>{var _0x284361=_0x3de802;_0x223980[_0x13a68e][_0x284361(0x1d6)]=_0x2110c7;}),_0x12d6a0['forEach']((_0x2426ec,_0x137f17)=>{var _0x37639d=_0x3de802;_0x223980[_0x137f17][_0x37639d(0x1be)]=_0x2426ec;}),_0x49fd60[_0x3de802(0x1cd)]((_0x5e5671,_0x3051ec)=>{var _0x56aa78=_0x3de802;_0x223980[_0x3051ec][_0x56aa78(0x19e)]=_0x5e5671;}),_0x2e7f3c['forEach']((_0x360aa7,_0x33ccba)=>{var _0x1a3bc2=_0x3de802;_0x223980[_0x33ccba][_0x1a3bc2(0x1ef)]=_0x360aa7;}),_0x3bb2d4['forEach']((_0x32c919,_0x166cff)=>{_0x223980[_0x166cff]['secondary_unit']=_0x32c919;}),_0x11093c[_0x3de802(0x1cd)]((_0x38ef88,_0x14bdbe)=>{var _0x4e82f0=_0x3de802;_0x223980[_0x14bdbe][_0x4e82f0(0x211)]=_0x38ef88;}),_0x5efeb2[_0x3de802(0x1cd)]((_0x3a8424,_0x4668d2)=>{var _0x51d582=_0x3de802;_0x223980[_0x4668d2][_0x51d582(0x22a)]=_0x3a8424;}),_0x406f5c[_0x3de802(0x1cd)]((_0x3f2a3b,_0x44571c)=>{_0x223980[_0x44571c]['expiry_date']=_0x3f2a3b;});var _0x4515d9=0x0;_0x223980['forEach'](_0x356ab7=>{var _0x371044=_0x3de802;(parseInt(_0x356ab7['sale_qty'])<parseInt(_0x356ab7[_0x371044(0x1e6)])||parseInt(_0x356ab7[_0x371044(0x19d)])<parseInt(_0x356ab7[_0x371044(0x1e6)])&&parseInt(_0x356ab7[_0x371044(0x128)])>parseInt(_0x356ab7[_0x371044(0x1e6)])||parseInt(_0x356ab7['return_qty'])==0x0)&&_0x4515d9++;});if(_0x4515d9!=0x0)return _0x2ffc63[_0x3de802(0x145)]('errors',_0x3de802(0x1bf)),_0x157d8f[_0x3de802(0x13f)]('back');const _0x11ec25=await sales_finished['findOne']({'invoice':_0x3e4817});_0x11ec25[_0x3de802(0x191)]='True';const _0x6b42be=await _0x11ec25[_0x3de802(0x11f)](),_0x3cb83c=new sales_return_finished({'invoice':_0x3e4817,'customer':_0x2ffc63[_0x3de802(0x125)]['customer'],'date':_0x38ff78,'warehouse_name':_0x57a388,'room':_0x3534fa,'ToWarehouse':_0x4212d8,'ToRoom':_0x5a04bc,'return_sale':_0x223980,'note':_0x5b5bc9,'warehouse_cat':_0x37df85}),_0x12354b=await _0x3cb83c[_0x3de802(0x11f)](),_0x194210=await sales_return_finished[_0x3de802(0x137)]({'invoice':_0x3e4817}),_0x1d5dd1=await warehouse['findOne']({'name':_0x4212d8,'room':_0x5a04bc,'warehouse_category':_0x3de802(0x169)});_0x194210[_0x3de802(0x13c)][_0x3de802(0x1cd)](_0xc13fee=>{var _0xb16ff=_0x3de802,_0x1902a6=0x0;const _0x1102db=_0x1d5dd1[_0xb16ff(0x224)]['map'](_0x3991dc=>{var _0x54857f=_0xb16ff;_0x3991dc[_0x54857f(0x1c9)]==_0xc13fee[_0x54857f(0x1c9)]&&_0x3991dc[_0x54857f(0x1d6)]==_0xc13fee[_0x54857f(0x1d6)]&&_0x3991dc[_0x54857f(0x163)]==_0xc13fee['expiry_date']&&_0x3991dc[_0x54857f(0x22a)]==_0xc13fee[_0x54857f(0x22a)]&&_0x3991dc[_0x54857f(0x1ef)]==_0xc13fee['batch_code']&&(_0x3991dc[_0x54857f(0x13d)]=parseInt(_0x3991dc[_0x54857f(0x13d)])+parseInt(_0xc13fee['return_qty']),_0x1902a6++);});_0x1902a6=='0'&&(_0x1d5dd1[_0xb16ff(0x224)]=_0x1d5dd1[_0xb16ff(0x224)][_0xb16ff(0x17a)]({'product_name':_0xc13fee['product_name'],'product_stock':_0xc13fee['return_qty'],'primary_code':_0xc13fee[_0xb16ff(0x11c)],'secondary_code':_0xc13fee[_0xb16ff(0x1f1)],'product_code':_0xc13fee[_0xb16ff(0x1db)],'bay':_0xc13fee[_0xb16ff(0x1d6)],'batch_code':_0xc13fee['batch_code'],'maxPerUnit':_0xc13fee[_0xb16ff(0x1be)],'production_date':_0xc13fee[_0xb16ff(0x22a)],'expiry_date':_0xc13fee['expiry_date'],'secondary_unit':_0xc13fee['secondary_unit'],'unit':_0xc13fee[_0xb16ff(0x211)],'maxProducts':_0xc13fee[_0xb16ff(0x19e)]}));}),await _0x1d5dd1[_0x3de802(0x11f)](),console[_0x3de802(0x1bd)](_0x2ffc63[_0x3de802(0x125)]);const _0x2e9000=new c_payment_data({'invoice':_0x3e4817,'customer':_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x185)],'reason':'Sale\x20Return'});await _0x2e9000[_0x3de802(0x11f)]();const _0x5ea584=await master_shop['find']();console[_0x3de802(0x1bd)](_0x3de802(0x227),_0x5ea584[0x0][_0x3de802(0x120)]);const _0x36a372=await email_settings[_0x3de802(0x137)](),_0x555976=await customer[_0x3de802(0x137)]({'name':_0x2ffc63[_0x3de802(0x125)][_0x3de802(0x185)]});console[_0x3de802(0x1bd)]('customer_data',_0x555976);_0x5ea584[0x0][_0x3de802(0x229)]==0x1?(right_currency=_0x5ea584[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5ea584[0x0][_0x3de802(0x15b)]);var _0x5eb4aa=_0x8ce3d2,_0x4408f9=_0x3d6243,_0x1e717c='',_0xe5dd58;for(_0xe5dd58 in _0x5eb4aa){_0x1e717c+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5eb4aa[_0xe5dd58]+_0x3de802(0x143)+_0x3de802(0x159)+_0x4408f9[_0xe5dd58]+_0x3de802(0x143)+_0x3de802(0x171);}console[_0x3de802(0x1bd)](_0x3de802(0x140),_0x1e717c);let _0x5b9a3f=nodemailer[_0x3de802(0x175)]({'service':_0x3de802(0x129),'auth':{'user':_0x36a372[_0x3de802(0x1fa)],'pass':_0x36a372['password']}}),_0x4d6c87={'from':_0x36a372['email'],'to':_0x555976[_0x3de802(0x1fa)],'subject':_0x3de802(0x1fe),'attachments':[{'filename':_0x3de802(0x149),'path':__dirname+_0x3de802(0x144)+_0x3de802(0x20b)+_0x5ea584[0x0][_0x3de802(0x120)],'cid':_0x3de802(0x127)}],'html':_0x3de802(0x207)+'<html><head><title></title>'+_0x3de802(0x11d)+_0x3de802(0x16a)+_0x3de802(0x1cf)+_0x3de802(0x16a)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3de802(0x226)+_0x3de802(0x16a)+_0x3de802(0x1bb)+_0x5ea584[0x0][_0x3de802(0x158)]+'\x20</h2>'+_0x3de802(0x226)+'</div>'+_0x3de802(0x1a0)+_0x3de802(0x16a)+_0x3de802(0x206)+_0x3de802(0x1ec)+_0x3e4817+'\x20'+_0x3de802(0x193)+'\x20Order\x20Date\x20:\x20'+_0x38ff78+'\x20'+_0x3de802(0x12c)+_0x3de802(0x1ee)+_0x3de802(0x226)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3de802(0x12b)+'<tr>'+_0x3de802(0x17d)+_0x3de802(0x1b4)+_0x3de802(0x162)+_0x3de802(0x184)+'</tr>'+_0x3de802(0x14e)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1e717c+'\x20'+_0x3de802(0x222)+_0x3de802(0x1e0)+_0x3de802(0x16a)+_0x3de802(0x172)+_0x3de802(0x123)+_0x5ea584[0x0][_0x3de802(0x158)]+_0x3de802(0x1ee)+_0x3de802(0x226)+_0x3de802(0x226)+_0x3de802(0x1e3)};_0x5b9a3f['sendMail'](_0x4d6c87,function(_0x16fab9,_0x380e2b){var _0x172f52=_0x3de802;_0x16fab9?(console[_0x172f52(0x1bd)](_0x16fab9),console[_0x172f52(0x1bd)](_0x172f52(0x1b9))):console[_0x172f52(0x1bd)](_0x172f52(0x225));}),_0x2ffc63[_0x3de802(0x145)](_0x3de802(0x17f),'sales\x20item\x20return\x20successfull'),_0x157d8f[_0x3de802(0x13f)](_0x3de802(0x17e));}catch(_0x4bd225){console[_0x3de802(0x1bd)](_0x4bd225),_0x157d8f[_0x3de802(0x1f6)](0xc8)['json']({'message1':_0x4bd225[_0x3de802(0x1ab)]});}}}),router['get'](a0_0x38f957(0x130),auth,async(_0x318f83,_0x3a522f)=>{var _0x5dcbfd=a0_0x38f957;try{const {username:_0x4240f0,email:_0xa251cf,role:_0x1fd636}=_0x318f83[_0x5dcbfd(0x195)],_0x42ecf9=_0x318f83['user'],_0x95d52d=await profile[_0x5dcbfd(0x137)]({'email':_0x42ecf9[_0x5dcbfd(0x1fa)]}),_0x47d396=await master_shop[_0x5dcbfd(0x183)]();console[_0x5dcbfd(0x1bd)](_0x5dcbfd(0x1cc),_0x47d396);const _0x30495d=_0x318f83['params']['id'],_0x5636ab=await sales[_0x5dcbfd(0x189)](_0x30495d);console['log'](_0x5dcbfd(0x1bc),_0x5636ab);if(_0x47d396[0x0][_0x5dcbfd(0x15f)]==_0x5dcbfd(0x192))var _0x312012=users[_0x5dcbfd(0x12d)];else{if(_0x47d396[0x0]['language']==_0x5dcbfd(0x1e8))var _0x312012=users[_0x5dcbfd(0x1e8)];else{if(_0x47d396[0x0]['language']==_0x5dcbfd(0x1ba))var _0x312012=users[_0x5dcbfd(0x1ba)];else{if(_0x47d396[0x0][_0x5dcbfd(0x15f)]==_0x5dcbfd(0x21a))var _0x312012=users[_0x5dcbfd(0x21a)];else{if(_0x47d396[0x0][_0x5dcbfd(0x15f)]==_0x5dcbfd(0x1f7))var _0x312012=users[_0x5dcbfd(0x1f7)];else{if(_0x47d396[0x0][_0x5dcbfd(0x15f)]==_0x5dcbfd(0x1af))var _0x312012=users[_0x5dcbfd(0x13a)];else{if(_0x47d396[0x0][_0x5dcbfd(0x15f)]==_0x5dcbfd(0x1f8))var _0x312012=users[_0x5dcbfd(0x1f8)];else{if(_0x47d396[0x0]['language']==_0x5dcbfd(0x165))var _0x312012=users[_0x5dcbfd(0x18f)];}}}}}}}_0x3a522f[_0x5dcbfd(0x168)](_0x5dcbfd(0x174),{'success':_0x318f83[_0x5dcbfd(0x145)](_0x5dcbfd(0x17f)),'errors':_0x318f83[_0x5dcbfd(0x145)](_0x5dcbfd(0x1c1)),'role':_0x42ecf9,'profile':_0x95d52d,'alldata':_0x5636ab,'master_shop':_0x47d396,'language':_0x312012});}catch(_0x1c9298){console[_0x5dcbfd(0x1bd)](_0x1c9298);}}),router[a0_0x38f957(0x197)]('/barcode_scanner',async(_0x14edd7,_0x14d8cc)=>{var _0x68ce80=a0_0x38f957;const {product_code:_0x304fd4,warehouse_name:_0x35dee5,rooms_data:_0x24c89c,Roomslist:_0x32fdd9}=_0x14edd7['body'],_0x420623=_0x32fdd9['split'](','),_0x17adf3=[];async function _0x2bf3c7(_0x3f211f){var _0x268a6a=a0_0x2481;const _0x5cfd4d=await warehouse[_0x268a6a(0x132)]([{'$match':{'name':_0x35dee5,'room':_0x3f211f}},{'$unwind':_0x268a6a(0x186)},{'$match':{'product_details.primary_code':_0x304fd4}},{'$group':{'_id':_0x268a6a(0x19f),'name':{'$first':_0x268a6a(0x136)},'product_stock':{'$first':_0x268a6a(0x217)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x268a6a(0x138)},'product_code':{'$first':_0x268a6a(0x1d1)},'level':{'$first':_0x268a6a(0x1fc)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x268a6a(0x1cb)},'pallet':{'$first':_0x268a6a(0x1a5)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x268a6a(0x173)},'storage':{'$first':_0x268a6a(0x223)},'rack':{'$first':_0x268a6a(0x1e4)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x268a6a(0x135)},'maxPerUnit':{'$first':_0x268a6a(0x12e)},'batch_code':{'$first':_0x268a6a(0x13e)},'product_cat':{'$first':_0x268a6a(0x16f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x268a6a(0x1de)},'invoice':{'$first':_0x268a6a(0x151)}}}]),_0x8493=await warehouse[_0x268a6a(0x132)]([{'$match':{'name':_0x35dee5,'room':_0x3f211f}},{'$unwind':_0x268a6a(0x186)},{'$match':{'product_details.secondary_code':_0x304fd4}},{'$group':{'_id':_0x268a6a(0x19f),'name':{'$first':_0x268a6a(0x136)},'product_stock':{'$first':_0x268a6a(0x217)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x268a6a(0x138)},'product_code':{'$first':_0x268a6a(0x1d1)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x268a6a(0x1ea)},'type':{'$first':_0x268a6a(0x1cb)},'pallet':{'$first':_0x268a6a(0x1a5)},'unit':{'$first':_0x268a6a(0x1f0)},'secondary_unit':{'$first':_0x268a6a(0x173)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x268a6a(0x1a1)},'production_date':{'$first':_0x268a6a(0x135)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x268a6a(0x16f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x268a6a(0x1de)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x5cfd4d['length']>0x0)_0x17adf3[_0x268a6a(0x1ae)](_0x5cfd4d);else _0x8493['length']>0x0&&_0x17adf3['push'](_0x8493);}const _0x42e8=_0x420623[_0x68ce80(0x124)](_0x1d3edf=>_0x2bf3c7(_0x1d3edf));await Promise['all'](_0x42e8),_0x14d8cc['json'](_0x17adf3);}),module[a0_0x38f957(0x1f4)]=router;