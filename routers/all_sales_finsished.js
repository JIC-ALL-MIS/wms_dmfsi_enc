var a0_0x394fcd=a0_0x14fa;(function(_0x4aa3f7,_0x16f82f){var _0x26db05=a0_0x14fa,_0x427694=_0x4aa3f7();while(!![]){try{var _0x2907c4=-parseInt(_0x26db05(0x268))/0x1+-parseInt(_0x26db05(0x24d))/0x2*(-parseInt(_0x26db05(0x29c))/0x3)+parseInt(_0x26db05(0x2ea))/0x4+-parseInt(_0x26db05(0x203))/0x5+parseInt(_0x26db05(0x2dd))/0x6+-parseInt(_0x26db05(0x264))/0x7*(parseInt(_0x26db05(0x2be))/0x8)+parseInt(_0x26db05(0x27d))/0x9;if(_0x2907c4===_0x16f82f)break;else _0x427694['push'](_0x427694['shift']());}catch(_0x5c5a36){_0x427694['push'](_0x427694['shift']());}}}(a0_0x3670,0x73087));const express=require(a0_0x394fcd(0x1f4)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x394fcd(0x209)),nodemailer=require(a0_0x394fcd(0x28a)),users=require(a0_0x394fcd(0x2bf));function a0_0x3670(){var _0x3f5579=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','createTransport','return_sale','getDate','$_id','nodemailer','Sale','json','<strong>\x20Regards\x20</strong>','post','QA\x20Warehouse','all_sales_barcode','/view/return_sales/:id','Portuguese\x20(BR)','/all_sales_finished/view','user','random','master','<span\x20style=\x22float:\x20right;\x22>','push','status','Finished\x20Goods','room','9qnwAnT','$product_details.secondary_code','$product_details.production_date','role','$sale_product.type','maxProducts','False','customer','primary_code','back','$product_details.product_stock','product_list','</tr>','body','return_sale_QA','received_amount','foreach\x20newproduct','<!DOCTYPE\x20html>','</span>','Quality\x20Inspection','sendMail','\x20Order\x20Number\x20:\x20','Chinese','$note','English','image','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.invoice','DRY\x20GOODS','primary_code_QA','product_stock','</body></html>','findOne','$sale_product.bin','382000IxtVJi','../public/language/languages.json','sale_qty','Portuguese','currency_placement','$product_details.primary_code','forEach','$product_details.maxProducts','$product_details.batch_code','RoomAssigned','product_date','prod_cat','add\x20post','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','floor','product_name_QA1','$product_details.expiry_date','toString','secondary_unit_QA','product','FGSEmail','logo','/view/add_sales','$product_details.secondary_unit','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','production_date','/view/add_sale/product','error','currency','barcode\x20Product\x20master','suppliers','3862992GfhpcE','catch','return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','customers_docs','<h2>\x20','Return\x20Goods','$product_details.rack','carton','<div>','message','$product_details.type','date','1072880ezxKsW','secondary_code','/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','name','room_name','primary_unit','Sale\x20Return','getFullYear','<tbody\x20style=\x22text-align:\x20center;\x22>','Email\x20sent\x20successfully','<tr>','<h5>','True','$customer','findById','Sales\x20Update\x20successfully','/give_payment/:id','warehouse_name','$product_details.product_code','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','express','length','$name','port','$sale_product.bay','French','/barcode/:id','invoice','return_qty','secondary_unit','\x20</h2>','sale_product','$product_details.unit','adjust_qty','\x20Order\x20Date\x20:\x20','3231855PvddqG','$product_details.bay','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Sale\x20Product\x20Mail','return_sale_finished','../middleware/auth','product_name','</head><body>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','An\x20error\x20occurred.','stocks_QA','secondary_code_QA','edit_sales_finished','unit','edit_sales_finished_view','/view/add_sales/:id','$return_data','find','bay','flash','$sale_product.quantity','product_code_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.maxPerUnit','$product_details','maxPerUnit','German','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','params','Arabic\x20(ae)','Received\x20Payment\x20For\x20Sale','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','product_details','</div>','expiry_date_QA','production_date_QA','OUTF-','Sale\x20Return\x20Mail','<html><head><title></title>','max_per_unit','<hr\x20class=\x22my-3\x22>','$product_details.storage','exports','$warehouse_name','English\x20(US)','site_title','$product_details._id','return_qty_QA','prod_invoice','success','<h5\x20style=\x22text-align:\x20left;\x22>','note','staff','$invoice','/invoice/:id','sales\x20item\x20return\x20successfull','gmail','email','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','log','</tbody>','sales_quantity_QA','aggregate','add_sales_finished','prod_code','all','save','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$date','maxperunit','password','Ambient','180172AhhCQP','filter','$product_details.floorlevel','purchases_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.bin','Enabled','Hindi','render','quantity','$sale_product.floorlevel','$sale_product','payment\x20successfull','maxProducts_QA','product_code','Error\x20Occurs','redirect','due_amount','slice','errors','</h5>','then','35yaZuhM','$room','Spanish','map','846634qTGYDx','Enclosed','$customers_docs','for_categorize','get','batch_code','/view/:id','/upload/','finalize','stock','There\x27s\x20a\x20error\x20in\x20this\x20transaction','all_sales_finished','Logo.png','barcode\x20user_id','level','final','batch_code_QA','customer_data','language','warehouse','</td>','9185580flmsvW','</thead>','/preview/:id','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','string','maxPerUnit_QA','Arabic','/../public'];a0_0x3670=function(){return _0x3f5579;};return a0_0x3670();}router[a0_0x394fcd(0x26c)](a0_0x394fcd(0x2ec),auth,async(_0x390451,_0x2fff85)=>{var _0x19445f=a0_0x394fcd;try{const {username:_0x580236,email:_0x39ce63,role:_0x5323de}=_0x390451[_0x19445f(0x294)],_0x3f3c34=_0x390451[_0x19445f(0x294)],_0x5c6168=await profile[_0x19445f(0x2bc)]({'email':_0x3f3c34['email']}),_0x5b76a1=await master_shop[_0x19445f(0x215)]();let _0x222c7b;if(_0x3f3c34[_0x19445f(0x29f)]==_0x19445f(0x239)){const _0x553996=await staff[_0x19445f(0x2bc)]({'email':_0x3f3c34[_0x19445f(0x23e)]});_0x222c7b=await sales_finished[_0x19445f(0x243)]([{'$lookup':{'from':'customers','localField':_0x19445f(0x2a3),'foreignField':_0x19445f(0x2ee),'as':_0x19445f(0x2e1)}},{'$unwind':_0x19445f(0x26a)},{'$unwind':_0x19445f(0x259)},{'$group':{'_id':_0x19445f(0x289),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x19445f(0x2f8)},'date':{'$first':_0x19445f(0x249)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x19445f(0x259)},'note':{'$first':_0x19445f(0x2b3)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x19445f(0x26a)},'total_saleproduct_quantity':{'$sum':_0x19445f(0x218)},'level':{'$addToSet':_0x19445f(0x1f8)},'isle':{'$addToSet':_0x19445f(0x2bd)},'type':{'$addToSet':_0x19445f(0x2a0)},'pallet':{'$addToSet':_0x19445f(0x258)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x222c7b=await sales_finished[_0x19445f(0x243)]([{'$lookup':{'from':'customers','localField':_0x19445f(0x2a3),'foreignField':_0x19445f(0x2ee),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x19445f(0x259)},{'$group':{'_id':'$_id','invoice':{'$first':_0x19445f(0x23a)},'customers':{'$first':_0x19445f(0x2f8)},'date':{'$first':_0x19445f(0x249)},'warehouse_name':{'$first':_0x19445f(0x230)},'sale_product':{'$push':_0x19445f(0x259)},'note':{'$first':_0x19445f(0x2b3)},'return_data':{'$first':_0x19445f(0x214)},'customers_docs':{'$first':_0x19445f(0x26a)},'total_saleproduct_quantity':{'$sum':_0x19445f(0x218)},'level':{'$addToSet':_0x19445f(0x1f8)},'isle':{'$addToSet':_0x19445f(0x2bd)},'type':{'$addToSet':_0x19445f(0x2a0)},'pallet':{'$addToSet':_0x19445f(0x258)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x5b76a1[0x0][_0x19445f(0x27a)]==_0x19445f(0x231)){var _0x3d9357=users['English'];console[_0x19445f(0x240)](_0x3d9357);}else{if(_0x5b76a1[0x0][_0x19445f(0x27a)]==_0x19445f(0x255))var _0x3d9357=users[_0x19445f(0x255)];else{if(_0x5b76a1[0x0][_0x19445f(0x27a)]=='German')var _0x3d9357=users[_0x19445f(0x21e)];else{if(_0x5b76a1[0x0][_0x19445f(0x27a)]==_0x19445f(0x266))var _0x3d9357=users['Spanish'];else{if(_0x5b76a1[0x0][_0x19445f(0x27a)]==_0x19445f(0x1f9))var _0x3d9357=users[_0x19445f(0x1f9)];else{if(_0x5b76a1[0x0][_0x19445f(0x27a)]=='Portuguese\x20(BR)')var _0x3d9357=users['Portuguese'];else{if(_0x5b76a1[0x0]['language']==_0x19445f(0x2b2))var _0x3d9357=users[_0x19445f(0x2b2)];else{if(_0x5b76a1[0x0]['language']=='Arabic\x20(ae)')var _0x3d9357=users[_0x19445f(0x283)];}}}}}}}_0x2fff85[_0x19445f(0x256)](_0x19445f(0x273),{'success':_0x390451[_0x19445f(0x217)](_0x19445f(0x236)),'errors':_0x390451[_0x19445f(0x217)](_0x19445f(0x261)),'sales':_0x222c7b,'profile':_0x5c6168,'role':_0x3f3c34,'master_shop':_0x5b76a1,'language':_0x3d9357});}catch(_0x1d7dfe){console[_0x19445f(0x240)](_0x1d7dfe);}});function a0_0x14fa(_0x1f8ee2,_0x47aa94){var _0x367031=a0_0x3670();return a0_0x14fa=function(_0x14fa5b,_0x486bb8){_0x14fa5b=_0x14fa5b-0x1ed;var _0x253cb3=_0x367031[_0x14fa5b];return _0x253cb3;},a0_0x14fa(_0x1f8ee2,_0x47aa94);}async function getRandom8DigitNumber(){var _0x18a0ac=a0_0x394fcd;const _0x42d98b=0x989680,_0x252b28=0x5f5e0ff,_0x1c4567=Math[_0x18a0ac(0x2cc)](Math[_0x18a0ac(0x295)]()*(_0x252b28-_0x42d98b+0x1))+_0x42d98b;var _0x132794;const _0x12433f=await sales_finished['findOne']({'invoice':_0x18a0ac(0x229)+_0x1c4567});return _0x12433f&&_0x12433f[_0x18a0ac(0x1f5)]>0x0?_0x132794='OUTF-'+_0x1c4567:_0x132794='OUTF-'+_0x1c4567,_0x132794;}router[a0_0x394fcd(0x26c)](a0_0x394fcd(0x2d4),auth,async(_0x9adb27,_0x593153)=>{var _0x430868=a0_0x394fcd;try{const {username:_0x5b5812,email:_0x32f8b4,role:_0x2a41a0}=_0x9adb27[_0x430868(0x294)],_0x571a72=_0x9adb27[_0x430868(0x294)],_0x268f2f=await profile['findOne']({'email':_0x571a72[_0x430868(0x23e)]}),_0x5f3190=await master_shop[_0x430868(0x215)](),_0x5a8722=await customer[_0x430868(0x215)]({});let _0x43706d;if(_0x571a72[_0x430868(0x29f)]=='staff'){const _0x16418=await staff['findOne']({'email':_0x571a72[_0x430868(0x23e)]});_0x43706d=await warehouse['aggregate']([{'$match':{'status':_0x430868(0x254),'name':_0x16418[_0x430868(0x27b)],'warehouse_category':_0x430868(0x29a),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x430868(0x1f6),'name':{'$first':_0x430868(0x1f6)}}},{'$sort':{'name':0x1}}]);}else _0x43706d=await warehouse['aggregate']([{'$match':{'status':_0x430868(0x254),'warehouse_category':_0x430868(0x29a),'name':{'$ne':_0x430868(0x28f)}}},{'$group':{'_id':'$name','name':{'$first':_0x430868(0x1f6)}}},{'$sort':{'name':0x1}}]);const _0x4dff1f=await product['find']({});var _0x316d58=[_0x430868(0x24c),_0x430868(0x269)];const _0x13507a=await sales_finished[_0x430868(0x215)]({}),_0x983c50=_0x13507a['length']+0x1,_0x705ea0='OUTF-'+_0x983c50[_0x430868(0x2cf)]()['padStart'](0x5,'0');if(_0x5f3190[0x0][_0x430868(0x27a)]==_0x430868(0x231)){var _0x2b80b3=users[_0x430868(0x2b4)];console['log'](_0x2b80b3);}else{if(_0x5f3190[0x0][_0x430868(0x27a)]==_0x430868(0x255))var _0x2b80b3=users[_0x430868(0x255)];else{if(_0x5f3190[0x0]['language']==_0x430868(0x21e))var _0x2b80b3=users[_0x430868(0x21e)];else{if(_0x5f3190[0x0]['language']=='Spanish')var _0x2b80b3=users[_0x430868(0x266)];else{if(_0x5f3190[0x0][_0x430868(0x27a)]==_0x430868(0x1f9))var _0x2b80b3=users[_0x430868(0x1f9)];else{if(_0x5f3190[0x0][_0x430868(0x27a)]==_0x430868(0x292))var _0x2b80b3=users[_0x430868(0x2c1)];else{if(_0x5f3190[0x0]['language']==_0x430868(0x2b2))var _0x2b80b3=users[_0x430868(0x2b2)];else{if(_0x5f3190[0x0][_0x430868(0x27a)]==_0x430868(0x221))var _0x2b80b3=users['Arabic'];}}}}}}}const _0x578da2=getRandom8DigitNumber();_0x578da2[_0x430868(0x263)](_0x5d0cfb=>{var _0x4eef0c=_0x430868;_0x593153['render'](_0x4eef0c(0x244),{'success':_0x9adb27[_0x4eef0c(0x217)](_0x4eef0c(0x236)),'errors':_0x9adb27[_0x4eef0c(0x217)](_0x4eef0c(0x261)),'role':_0x571a72,'profile':_0x268f2f,'customer':_0x5a8722,'warehouse':_0x43706d,'product':_0x4dff1f,'invoice':_0x5d0cfb,'master_shop':_0x5f3190,'language':_0x2b80b3,'rooms_data':_0x316d58});})['catch'](_0x5baeb4=>{var _0x389718=_0x430868;_0x9adb27[_0x389718(0x217)]('errors',_0x389718(0x272)),_0x593153['redirect'](_0x389718(0x293));});}catch(_0x2b1748){console[_0x430868(0x240)](_0x2b1748);}}),router['get'](a0_0x394fcd(0x213),auth,async(_0x53efe1,_0xdd733d)=>{var _0x1e7eb3=a0_0x394fcd;try{const _0x212276=_0x53efe1[_0x1e7eb3(0x220)]['id'];console[_0x1e7eb3(0x240)](_0x212276);const _0x1dee75=await product[_0x1e7eb3(0x215)](),_0x54df6a=await purchases[_0x1e7eb3(0x243)]([{'$match':{'warehouse_name':_0x212276}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x1e7eb3(0x240)](_0x1e7eb3(0x250),_0x54df6a),_0xdd733d[_0x1e7eb3(0x299)](0xc8)['json']({'purchases_data':_0x54df6a,'product_data':_0x1dee75});}catch(_0x1ad5c9){console['log'](_0x1ad5c9);}}),router['post'](a0_0x394fcd(0x2d8),auth,async(_0x1ae285,_0x3ae3ab)=>{var _0x13be44=a0_0x394fcd;try{const {warehouse_data:_0x51664a,product_data:_0xa6257c}=_0x1ae285[_0x13be44(0x2a9)];console[_0x13be44(0x240)](_0x1ae285[_0x13be44(0x2a9)]['product_data']);;const _0x1c3e0c=await master_shop[_0x13be44(0x215)]();console[_0x13be44(0x240)](_0x13be44(0x296),_0x1c3e0c);const _0x434c81=await product[_0x13be44(0x2bc)]({'name':_0xa6257c});console['log'](_0x13be44(0x2d1),_0x434c81);const _0x50107a=await warehouse[_0x13be44(0x243)]([{'$match':{'name':_0x51664a}},{'$unwind':_0x13be44(0x21c)},{'$match':{'product_details.product_name':_0xa6257c}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x13be44(0x240)]('stock_data',_0x50107a),_0x3ae3ab[_0x13be44(0x299)](0xc8)[_0x13be44(0x28c)]({'master':_0x1c3e0c,'new_product':_0x434c81,'stock_data':_0x50107a});}catch(_0x5d3138){console[_0x13be44(0x240)](_0x5d3138);}}),router['post'](a0_0x394fcd(0x2d4),auth,async(_0x35c9f4,_0x5eb260)=>{var _0x71a811=a0_0x394fcd;try{const {invoice:_0x2e3061,date:_0xaa6237,warehouse_name:_0x24930c,product_name:_0x49ac98,stock:_0x1f00d3,quantity:_0x507e62,note:_0x1d1a9d,room:_0x4ae168,primary_code:_0x33763b,secondary_code:_0x2ca18a,prod_code:_0x76212c,level:_0x373df8,isle:_0x195cd8,pallet:_0x185ccf,batch_code:_0x4fbcda,SCRN:_0x4f1f0f,expiry_date:_0x28ca63,mode_transpo:_0x217068,name_driver:_0x30329d}=_0x35c9f4['body'];if(typeof _0x49ac98=='string')var _0x582caf=[_0x35c9f4[_0x71a811(0x2a9)]['product_name']],_0x2f0029=[_0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x271)]],_0x548e8b=[_0x35c9f4[_0x71a811(0x2a9)]['carton']],_0x409ccd=[_0x35c9f4[_0x71a811(0x2a9)]['primary_code']],_0xd272e8=[_0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x2eb)]],_0x5b01fc=[_0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x245)]],_0x407853=[_0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x276)]],_0x845b80=[_0x35c9f4['body'][_0x71a811(0x2f0)]],_0x4e0205=[_0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x1fd)]],_0x325d0c=[_0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x26d)]],_0x369581=[_0x35c9f4['body'][_0x71a811(0x205)]],_0x5e7742=[_0x35c9f4['body'][_0x71a811(0x2c8)]],_0x2cee4d=[_0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x22c)]],_0x39bd5b=[_0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x2c9)]],_0x561306=[_0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x2c7)]],_0x56561e=[_0x35c9f4['body']['prod_invoice']];else var _0x582caf=[..._0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x20a)]],_0x2f0029=[..._0x35c9f4['body'][_0x71a811(0x271)]],_0x548e8b=[..._0x35c9f4['body'][_0x71a811(0x2e5)]],_0x409ccd=[..._0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x2a4)]],_0xd272e8=[..._0x35c9f4['body'][_0x71a811(0x2eb)]],_0x5b01fc=[..._0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x245)]],_0x407853=[..._0x35c9f4[_0x71a811(0x2a9)]['level']],_0x845b80=[..._0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x2f0)]],_0x4e0205=[..._0x35c9f4['body'][_0x71a811(0x1fd)]],_0x325d0c=[..._0x35c9f4[_0x71a811(0x2a9)]['batch_code']],_0x369581=[..._0x35c9f4['body'][_0x71a811(0x205)]],_0x5e7742=[..._0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x2c8)]],_0x2cee4d=[..._0x35c9f4[_0x71a811(0x2a9)]['max_per_unit']],_0x39bd5b=[..._0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x2c9)]],_0x561306=[..._0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x2c7)]],_0x56561e=[..._0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x235)]];const _0x12ad58=_0x582caf[_0x71a811(0x267)](_0x383691=>{return _0x383691={'product_name':_0x383691};});_0x2f0029[_0x71a811(0x2c4)]((_0x5093c4,_0x5191c1)=>{_0x12ad58[_0x5191c1]['stock']=_0x5093c4;}),_0x548e8b[_0x71a811(0x2c4)]((_0x5ef5ba,_0x5d8e16)=>{var _0x51487d=_0x71a811;_0x12ad58[_0x5d8e16][_0x51487d(0x257)]=_0x5ef5ba;}),_0x409ccd[_0x71a811(0x2c4)]((_0x5cedc4,_0x2a1237)=>{var _0x31e677=_0x71a811;_0x12ad58[_0x2a1237][_0x31e677(0x2a4)]=_0x5cedc4;}),_0xd272e8['forEach']((_0xe34aa2,_0x2e1a56)=>{var _0x17f55a=_0x71a811;_0x12ad58[_0x2e1a56][_0x17f55a(0x2eb)]=_0xe34aa2;}),_0x5b01fc['forEach']((_0x10b38f,_0x450082)=>{var _0x3d8812=_0x71a811;_0x12ad58[_0x450082][_0x3d8812(0x25c)]=_0x10b38f;}),_0x407853['forEach']((_0x487f5c,_0x212fd2)=>{var _0x5d4561=_0x71a811;_0x12ad58[_0x212fd2][_0x5d4561(0x216)]=_0x487f5c;}),_0x845b80[_0x71a811(0x2c4)]((_0x4972a0,_0x169889)=>{var _0x5c8549=_0x71a811;_0x12ad58[_0x169889][_0x5c8549(0x211)]=_0x4972a0;}),_0x4e0205[_0x71a811(0x2c4)]((_0x3bde74,_0x403a7d)=>{var _0x280645=_0x71a811;_0x12ad58[_0x403a7d][_0x280645(0x1fd)]=_0x3bde74;}),_0x325d0c[_0x71a811(0x2c4)]((_0x49a893,_0x10e755)=>{_0x12ad58[_0x10e755]['batch_code']=_0x49a893;}),_0x369581['forEach']((_0x539304,_0x2c2c60)=>{var _0x202b5f=_0x71a811;_0x12ad58[_0x2c2c60][_0x202b5f(0x205)]=_0x539304;}),_0x5e7742[_0x71a811(0x2c4)]((_0x4c4bb6,_0x242d60)=>{_0x12ad58[_0x242d60]['production_date']=_0x4c4bb6;}),_0x2cee4d[_0x71a811(0x2c4)]((_0x2e95de,_0x457158)=>{var _0x4e4864=_0x71a811;_0x12ad58[_0x457158][_0x4e4864(0x24a)]=_0x2e95de;}),_0x39bd5b['forEach']((_0x418bba,_0x29a4e4)=>{var _0x4cc1c7=_0x71a811;_0x12ad58[_0x29a4e4][_0x4cc1c7(0x2c9)]=_0x418bba;}),_0x561306[_0x71a811(0x2c4)]((_0x2b1e12,_0xec5fde)=>{var _0x1fbdd6=_0x71a811;_0x12ad58[_0xec5fde][_0x1fbdd6(0x2ef)]=_0x2b1e12;}),_0x56561e[_0x71a811(0x2c4)]((_0x1323ba,_0x412e52)=>{_0x12ad58[_0x412e52]['invoice']=_0x1323ba;});var _0xaaa731=0x0;_0x12ad58['forEach'](_0x1116c2=>{var _0x228077=_0x71a811;console[_0x228077(0x240)](_0x228077(0x2ac),_0x1116c2),(parseInt(_0x1116c2[_0x228077(0x271)])<parseInt(_0x1116c2[_0x228077(0x257)])||parseInt(_0x1116c2['quantity'])==0x0)&&_0xaaa731++;});if(_0xaaa731!=0x0)return _0x35c9f4[_0x71a811(0x217)](_0x71a811(0x261),_0x71a811(0x280)),_0x5eb260[_0x71a811(0x25e)](_0x71a811(0x2a5));const _0x4c993d=_0x12ad58[_0x71a811(0x24e)](_0x5cb770=>_0x5cb770[_0x71a811(0x257)]!=='0'&&_0x5cb770['quantity']!==''),_0x2fc937=new sales_finished({'invoice':_0x2e3061,'customer':_0x35c9f4['body'][_0x71a811(0x2a3)],'date':_0xaa6237,'warehouse_name':_0x24930c,'sale_product':_0x4c993d,'note':_0x1d1a9d,'room':_0x4ae168,'primary_code':_0x33763b,'secondary_code':_0x2ca18a,'prod_code':_0x76212c,'SCRN':_0x4f1f0f,'finalize':_0x71a811(0x2a2),'mode_transpo':_0x217068,'name_driver':_0x30329d}),_0x1c85fe=await _0x2fc937[_0x71a811(0x247)](),_0x1f3e0d=await sales_finished['findOne']({'invoice':_0x2e3061}),_0x5f130b=new c_payment_data({'invoice':_0x2e3061,'customer':_0x35c9f4[_0x71a811(0x2a9)][_0x71a811(0x2a3)],'reason':_0x71a811(0x28b)});await _0x5f130b[_0x71a811(0x247)]();const _0x38a701=await master_shop[_0x71a811(0x215)](),_0x1e2f7f=await email_settings[_0x71a811(0x2bc)](),_0x2feaf4=await customer[_0x71a811(0x2bc)]({'name':_0x35c9f4[_0x71a811(0x2a9)]['customer']});_0x38a701[0x0][_0x71a811(0x2c2)]==0x1?(right_currency=_0x38a701[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x38a701[0x0][_0x71a811(0x2da)]);var _0x37bcc7=_0x582caf,_0x1edcd8=_0x548e8b,_0x3cd1fd='',_0x2c4e6f;for(_0x2c4e6f in _0x37bcc7){_0x3cd1fd+=_0x71a811(0x2f5)+_0x71a811(0x23f)+_0x37bcc7[_0x2c4e6f]+'</td>'+_0x71a811(0x23f)+_0x1edcd8[_0x2c4e6f]+_0x71a811(0x27c)+_0x71a811(0x2a8);}console['log'](_0x71a811(0x2a7),_0x3cd1fd);let _0x507e66=nodemailer[_0x71a811(0x286)]({'service':_0x71a811(0x23d),'auth':{'user':_0x1e2f7f['email'],'pass':_0x1e2f7f['password']}}),_0x35258e={'from':_0x1e2f7f[_0x71a811(0x23e)],'to':_0x2feaf4['email'],'subject':_0x71a811(0x207),'attachments':[{'filename':_0x71a811(0x274),'path':__dirname+_0x71a811(0x284)+'/upload/'+_0x38a701[0x0]['image'],'cid':_0x71a811(0x2d3)}],'html':_0x71a811(0x2ad)+_0x71a811(0x22b)+_0x71a811(0x20b)+'<div>'+_0x71a811(0x2d6)+_0x71a811(0x2e6)+_0x71a811(0x2cb)+_0x71a811(0x226)+_0x71a811(0x2e6)+_0x71a811(0x2e2)+_0x38a701[0x0]['site_title']+_0x71a811(0x1fe)+_0x71a811(0x226)+_0x71a811(0x226)+'<hr\x20class=\x22my-3\x22>'+_0x71a811(0x2e6)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x2e3061+'\x20'+_0x71a811(0x297)+'\x20Order\x20Date\x20:\x20'+_0xaa6237+'\x20'+_0x71a811(0x2ae)+_0x71a811(0x262)+_0x71a811(0x226)+_0x71a811(0x248)+_0x71a811(0x20c)+_0x71a811(0x2f5)+_0x71a811(0x1f3)+_0x71a811(0x251)+_0x71a811(0x2a8)+_0x71a811(0x27e)+_0x71a811(0x2f3)+'\x20'+_0x3cd1fd+'\x20'+_0x71a811(0x241)+_0x71a811(0x223)+_0x71a811(0x2e6)+'<strong>\x20Regards\x20</strong>'+_0x71a811(0x2f6)+_0x38a701[0x0][_0x71a811(0x232)]+_0x71a811(0x262)+_0x71a811(0x226)+_0x71a811(0x226)+_0x71a811(0x2bb)};_0x507e66[_0x71a811(0x2b0)](_0x35258e,function(_0x45c39f,_0x2b05c1){var _0x429145=_0x71a811;_0x45c39f?(console[_0x429145(0x240)](_0x45c39f),console['log'](_0x429145(0x25d))):console['log']('Email\x20sent\x20successfully');}),_0x35c9f4['flash'](_0x71a811(0x236),'Sales\x20Add\x20successfully'),_0x5eb260[_0x71a811(0x25e)]('/all_sales_finished/preview/'+_0x1c85fe['_id']);}catch(_0xa91bfe){console[_0x71a811(0x240)](_0xa91bfe);}}),router[a0_0x394fcd(0x26c)](a0_0x394fcd(0x27f),auth,async(_0x115a14,_0x274833)=>{var _0x18756c=a0_0x394fcd;try{const {username:_0x3d8535,email:_0x526d15,role:_0x384887}=_0x115a14[_0x18756c(0x294)],_0x322482=_0x115a14[_0x18756c(0x294)],_0x2ac4b9=await profile['findOne']({'email':_0x322482[_0x18756c(0x23e)]}),_0x484227=await master_shop[_0x18756c(0x215)](),_0x507bfa=_0x115a14['params']['id'],_0x2c90ff=await sales_finished[_0x18756c(0x1ed)](_0x507bfa),_0x563a68=await warehouse['aggregate']([{'$match':{'name':_0x2c90ff['warehouse_name']}},{'$unwind':_0x18756c(0x21c)},{'$group':{'_id':_0x18756c(0x233),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x18756c(0x2a6)},'bay':{'$first':_0x18756c(0x204)},'bin':{'$first':_0x18756c(0x253)},'type':{'$first':_0x18756c(0x2e8)},'floorlevel':{'$first':_0x18756c(0x24f)},'primary_code':{'$first':_0x18756c(0x2c3)},'secondary_code':{'$first':_0x18756c(0x29d)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x18756c(0x22e)},'rack':{'$first':_0x18756c(0x2e4)},'expiry_date':{'$first':_0x18756c(0x2ce)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x18756c(0x2c6)},'room':{'$first':_0x18756c(0x265)}}}]),_0x106888=await customer['find']({});let _0x5d6581;if(_0x322482[_0x18756c(0x29f)]==_0x18756c(0x239)){const _0x577c59=await staff[_0x18756c(0x2bc)]({'email':_0x322482[_0x18756c(0x23e)]});_0x5d6581=await warehouse[_0x18756c(0x243)]([{'$match':{'status':_0x18756c(0x254),'name':_0x577c59[_0x18756c(0x27b)]}},{'$group':{'_id':_0x18756c(0x1f6),'name':{'$first':_0x18756c(0x1f6)}}}]);}else _0x5d6581=await warehouse['aggregate']([{'$match':{'status':_0x18756c(0x254)}},{'$group':{'_id':_0x18756c(0x1f6),'name':{'$first':_0x18756c(0x1f6)}}}]);const _0x2f5a5b=await product[_0x18756c(0x215)]({});if(_0x484227[0x0][_0x18756c(0x27a)]=='English\x20(US)'){var _0x4b7629=users['English'];console[_0x18756c(0x240)](_0x4b7629);}else{if(_0x484227[0x0][_0x18756c(0x27a)]==_0x18756c(0x255))var _0x4b7629=users[_0x18756c(0x255)];else{if(_0x484227[0x0]['language']=='German')var _0x4b7629=users[_0x18756c(0x21e)];else{if(_0x484227[0x0][_0x18756c(0x27a)]==_0x18756c(0x266))var _0x4b7629=users['Spanish'];else{if(_0x484227[0x0][_0x18756c(0x27a)]=='French')var _0x4b7629=users[_0x18756c(0x1f9)];else{if(_0x484227[0x0][_0x18756c(0x27a)]==_0x18756c(0x292))var _0x4b7629=users[_0x18756c(0x2c1)];else{if(_0x484227[0x0]['language']==_0x18756c(0x2b2))var _0x4b7629=users[_0x18756c(0x2b2)];else{if(_0x484227[0x0]['language']==_0x18756c(0x221))var _0x4b7629=users['Arabic'];}}}}}}}_0x274833[_0x18756c(0x256)](_0x18756c(0x212),{'success':_0x115a14[_0x18756c(0x217)](_0x18756c(0x236)),'errors':_0x115a14[_0x18756c(0x217)](_0x18756c(0x261)),'role':_0x322482,'profile':_0x2ac4b9,'customer':_0x106888,'warehouse':_0x5d6581,'product':_0x563a68,'user':_0x2c90ff,'master_shop':_0x484227,'unit':_0x2f5a5b,'language':_0x4b7629});}catch(_0x5ac90c){console[_0x18756c(0x240)](_0x5ac90c);}}),router[a0_0x394fcd(0x28e)](a0_0x394fcd(0x27f),auth,async(_0x38911a,_0x375732)=>{var _0x2fcc89=a0_0x394fcd;try{const _0x3590de=_0x38911a[_0x2fcc89(0x220)]['id'],{invoice:_0x387ce1,warehouse_name:_0x56012c,room:_0x449b6c}=_0x38911a[_0x2fcc89(0x2a9)],_0x574563=await sales_finished[_0x2fcc89(0x2bc)]({'invoice':_0x387ce1}),_0x48ea78=_0x574563[_0x2fcc89(0x1ff)]['map'](async _0x2732ac=>{var _0x3f8597=_0x2fcc89,_0x2807a3=await warehouse[_0x3f8597(0x2bc)]({'name':_0x56012c,'room':_0x2732ac['room_name'],'warehouse_category':_0x3f8597(0x29a)});const _0x51a5a1=_0x2807a3[_0x3f8597(0x225)][_0x3f8597(0x267)](_0x109c8c=>{var _0x359b58=_0x3f8597;_0x109c8c['product_name']==_0x2732ac[_0x359b58(0x20a)]&&_0x109c8c[_0x359b58(0x216)]==_0x2732ac['bay']&&_0x109c8c['expiry_date']==_0x2732ac[_0x359b58(0x205)]&&_0x109c8c[_0x359b58(0x2d7)]==_0x2732ac['production_date']&&_0x109c8c[_0x359b58(0x26d)]==_0x2732ac[_0x359b58(0x26d)]&&_0x109c8c[_0x359b58(0x1fb)]==_0x2732ac['invoice']&&(_0x109c8c[_0x359b58(0x2ba)]=_0x109c8c[_0x359b58(0x2ba)]-_0x2732ac[_0x359b58(0x257)]);});return _0x2807a3;});Promise[_0x2fcc89(0x246)](_0x48ea78)['then'](async _0x121f62=>{var _0x27cb7c=_0x2fcc89;try{for(const _0x416faf of _0x121f62){await _0x416faf[_0x27cb7c(0x247)]();}_0x574563[_0x27cb7c(0x270)]=_0x27cb7c(0x2f7);const _0x4039fe=await _0x574563['save'](),_0x41d6c7=await master_shop['find'](),_0x3bd19d=await email_settings[_0x27cb7c(0x2bc)](),_0x1c3ea2=await supervisor_settings[_0x27cb7c(0x215)]();var _0x3f5264=_0x574563['sale_product'],_0x4cae66='',_0x4ba766;for(_0x4ba766 in _0x3f5264){var _0x3ede2c='FG';_0x574563[_0x27cb7c(0x1f0)]==_0x27cb7c(0x2b8)&&(_0x3ede2c='DG'),_0x4cae66+='<tr>'+_0x27cb7c(0x23f)+_0x3f5264[_0x4ba766][_0x27cb7c(0x20a)]+'</td>'+_0x27cb7c(0x23f)+_0x3f5264[_0x4ba766][_0x27cb7c(0x25c)]+_0x27cb7c(0x27c)+_0x27cb7c(0x23f)+_0x3f5264[_0x4ba766][_0x27cb7c(0x257)]+_0x27cb7c(0x27c)+_0x27cb7c(0x23f)+_0x3f5264[_0x4ba766][_0x27cb7c(0x211)]+_0x27cb7c(0x27c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3f5264[_0x4ba766][_0x27cb7c(0x1fd)]+_0x27cb7c(0x27c)+_0x27cb7c(0x23f)+_0x574563['warehouse_name']+_0x27cb7c(0x27c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3f5264[_0x4ba766][_0x27cb7c(0x2ef)]+_0x27cb7c(0x27c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3ede2c+_0x3f5264[_0x4ba766]['bay']+_0x27cb7c(0x27c);}let _0x5cac23=nodemailer[_0x27cb7c(0x286)]({'host':_0x3bd19d['host'],'port':Number(_0x3bd19d[_0x27cb7c(0x1f7)]),'secure':![],'auth':{'user':_0x3bd19d[_0x27cb7c(0x23e)],'pass':_0x3bd19d[_0x27cb7c(0x24b)]}}),_0x5a1dfc={'from':_0x3bd19d[_0x27cb7c(0x23e)],'to':_0x1c3ea2[0x0][_0x27cb7c(0x2d2)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x27cb7c(0x274),'path':__dirname+'/../public'+_0x27cb7c(0x26f)+_0x41d6c7[0x0][_0x27cb7c(0x2b5)],'cid':_0x27cb7c(0x2d3)}],'html':_0x27cb7c(0x2ad)+'<html><head><title></title>'+'</head><body>'+_0x27cb7c(0x2e6)+_0x27cb7c(0x2d6)+_0x27cb7c(0x2e6)+_0x27cb7c(0x2cb)+'</div>'+_0x27cb7c(0x2e6)+_0x27cb7c(0x2e2)+_0x41d6c7[0x0][_0x27cb7c(0x232)]+_0x27cb7c(0x1fe)+_0x27cb7c(0x226)+_0x27cb7c(0x226)+_0x27cb7c(0x22d)+'<div>'+_0x27cb7c(0x237)+_0x27cb7c(0x2b1)+_0x574563[_0x27cb7c(0x1fb)]+'\x20'+_0x27cb7c(0x297)+_0x27cb7c(0x202)+_0x574563['date']+'\x20'+_0x27cb7c(0x2ae)+_0x27cb7c(0x262)+'</div>'+_0x27cb7c(0x248)+_0x27cb7c(0x20c)+_0x27cb7c(0x2f5)+_0x27cb7c(0x1f3)+_0x27cb7c(0x21a)+_0x27cb7c(0x206)+_0x27cb7c(0x224)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x27cb7c(0x285)+_0x27cb7c(0x2ed)+_0x27cb7c(0x252)+'</tr>'+_0x27cb7c(0x27e)+_0x27cb7c(0x2f3)+'\x20'+_0x4cae66+'\x20'+_0x27cb7c(0x241)+'</table>'+_0x27cb7c(0x2e6)+'<strong>\x20Regards\x20</strong>'+_0x27cb7c(0x2f6)+_0x41d6c7[0x0][_0x27cb7c(0x232)]+'</h5>'+_0x27cb7c(0x226)+_0x27cb7c(0x226)+_0x27cb7c(0x2bb)};_0x5cac23[_0x27cb7c(0x2b0)](_0x5a1dfc,function(_0x43dae3,_0x1977d9){var _0x12a9a8=_0x27cb7c;_0x43dae3?(console[_0x12a9a8(0x240)](_0x43dae3),console['log'](_0x12a9a8(0x25d))):console[_0x12a9a8(0x240)](_0x12a9a8(0x2f4));}),_0x38911a[_0x27cb7c(0x217)](_0x27cb7c(0x236),_0x27cb7c(0x1ee)),_0x375732[_0x27cb7c(0x25e)]('/picking_list/pdf/'+_0x3590de);}catch(_0x3d6157){console[_0x27cb7c(0x2d9)](_0x3d6157),_0x375732[_0x27cb7c(0x299)](0x1f4)[_0x27cb7c(0x28c)]({'error':_0x27cb7c(0x2b6)});}})[_0x2fcc89(0x2de)](_0x32eee5=>{var _0x303535=_0x2fcc89;console[_0x303535(0x2d9)](_0x32eee5),_0x375732[_0x303535(0x299)](0x1f4)[_0x303535(0x28c)]({'error':_0x303535(0x20d)});});}catch(_0x43f7ae){console[_0x2fcc89(0x240)](_0x43f7ae);}}),router[a0_0x394fcd(0x26c)]('/view/:id',auth,async(_0x1761df,_0x3b2187)=>{var _0x5eac4a=a0_0x394fcd;try{const {username:_0x3a0b5f,email:_0xe0a54a,role:_0xed7934}=_0x1761df['user'],_0x1c0443=_0x1761df[_0x5eac4a(0x294)],_0x2f9507=await profile[_0x5eac4a(0x2bc)]({'email':_0x1c0443[_0x5eac4a(0x23e)]}),_0x311f23=await master_shop['find'](),_0x3f371c=_0x1761df[_0x5eac4a(0x220)]['id'],_0x27aedc=await sales_finished[_0x5eac4a(0x1ed)](_0x3f371c);let _0x49a80f=new Date(_0x27aedc[_0x5eac4a(0x205)]),_0x2bc93c=('0'+_0x49a80f[_0x5eac4a(0x288)]())['slice'](-0x2),_0x3a7212=('0'+(_0x49a80f['getMonth']()+0x1))[_0x5eac4a(0x260)](-0x2),_0x397579=_0x49a80f[_0x5eac4a(0x2f2)](),_0x221cf6=_0x397579+'-'+_0x3a7212+'-'+_0x2bc93c;var _0x11c9bb=[_0x5eac4a(0x24c),_0x5eac4a(0x269)];const _0x30bc2b=await warehouse[_0x5eac4a(0x243)]([{'$match':{'name':_0x27aedc['warehouse_name'],'room':_0x27aedc[_0x5eac4a(0x29b)]}},{'$unwind':_0x5eac4a(0x21c)},{'$group':{'_id':_0x5eac4a(0x233),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5eac4a(0x204)},'bin':{'$first':_0x5eac4a(0x253)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5eac4a(0x24f)},'primary_code':{'$first':_0x5eac4a(0x2c3)},'secondary_code':{'$first':_0x5eac4a(0x29d)},'product_code':{'$first':_0x5eac4a(0x1f1)},'storage':{'$first':_0x5eac4a(0x22e)},'rack':{'$first':_0x5eac4a(0x2e4)}}}]),_0x25cdda=await customer[_0x5eac4a(0x215)]({});let _0x21246c;if(_0x1c0443['role']==_0x5eac4a(0x239)){const _0x4cd1d7=await staff[_0x5eac4a(0x2bc)]({'email':_0x1c0443['email']});_0x21246c=await warehouse[_0x5eac4a(0x243)]([{'$match':{'status':'Enabled','name':_0x4cd1d7[_0x5eac4a(0x27b)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x21246c=await warehouse[_0x5eac4a(0x243)]([{'$match':{'status':_0x5eac4a(0x254)}},{'$group':{'_id':_0x5eac4a(0x1f6),'name':{'$first':'$name'}}}]);const _0x4fbafd=await product['find']({});if(_0x311f23[0x0]['language']==_0x5eac4a(0x231)){var _0x5dccb5=users[_0x5eac4a(0x2b4)];console[_0x5eac4a(0x240)](_0x5dccb5);}else{if(_0x311f23[0x0][_0x5eac4a(0x27a)]==_0x5eac4a(0x255))var _0x5dccb5=users[_0x5eac4a(0x255)];else{if(_0x311f23[0x0]['language']=='German')var _0x5dccb5=users['German'];else{if(_0x311f23[0x0][_0x5eac4a(0x27a)]=='Spanish')var _0x5dccb5=users[_0x5eac4a(0x266)];else{if(_0x311f23[0x0][_0x5eac4a(0x27a)]==_0x5eac4a(0x1f9))var _0x5dccb5=users[_0x5eac4a(0x1f9)];else{if(_0x311f23[0x0][_0x5eac4a(0x27a)]=='Portuguese\x20(BR)')var _0x5dccb5=users[_0x5eac4a(0x2c1)];else{if(_0x311f23[0x0][_0x5eac4a(0x27a)]=='Chinese')var _0x5dccb5=users['Chinese'];else{if(_0x311f23[0x0][_0x5eac4a(0x27a)]==_0x5eac4a(0x221))var _0x5dccb5=users[_0x5eac4a(0x283)];}}}}}}}_0x3b2187[_0x5eac4a(0x256)](_0x5eac4a(0x210),{'success':_0x1761df[_0x5eac4a(0x217)]('success'),'errors':_0x1761df[_0x5eac4a(0x217)]('errors'),'role':_0x1c0443,'profile':_0x2f9507,'customer':_0x25cdda,'warehouse':_0x21246c,'product':_0x30bc2b,'user':_0x27aedc,'master_shop':_0x311f23,'unit':_0x4fbafd,'language':_0x5dccb5,'rooms_data':_0x11c9bb,'ed_fullDate':_0x221cf6});}catch(_0x4bdcab){console[_0x5eac4a(0x240)](_0x4bdcab);}}),router[a0_0x394fcd(0x28e)](a0_0x394fcd(0x26e),auth,async(_0x3a5bf2,_0x26af56)=>{var _0x5cc783=a0_0x394fcd;try{const _0x250bc1=_0x3a5bf2['params']['id'],_0x37fca3=await sales_finished['findOne']({'_id':_0x3a5bf2[_0x5cc783(0x220)]['id']}),_0x5b3734=await warehouse[_0x5cc783(0x2bc)]({'name':_0x37fca3['warehouse_name'],'room':_0x3a5bf2['body']['room'],'warehouse_category':'Finished\x20Goods'}),{invoice:_0xa65076,customer:_0x278b87,date:_0x43129a,warehouse_name:_0x1fb7f2,product_name:_0x52a271,stock:_0xe4819,adjust_qty:_0x59d226,note:_0x40ef55,room:_0x1b2065,primary_code:_0x72bb36,secondary_code:_0x1117c7,prod_code:_0x2bc3bb,level:_0x1257cd,isle:_0x1b2b8e,pallet:_0x3a0e5f,expiry_date:_0x576ffa}=_0x3a5bf2[_0x5cc783(0x2a9)];if(typeof _0x52a271==_0x5cc783(0x281))var _0x11590d=[_0x3a5bf2[_0x5cc783(0x2a9)][_0x5cc783(0x20a)]],_0x1e13fd=[_0x3a5bf2['body']['stock']],_0x343181=[_0x3a5bf2[_0x5cc783(0x2a9)][_0x5cc783(0x201)]],_0x8a92a8=[_0x3a5bf2[_0x5cc783(0x2a9)][_0x5cc783(0x2a4)]],_0x37a208=[_0x3a5bf2[_0x5cc783(0x2a9)][_0x5cc783(0x2eb)]],_0x561cc8=[_0x3a5bf2[_0x5cc783(0x2a9)]['prod_code']],_0x468cb9=[_0x3a5bf2['body'][_0x5cc783(0x276)]],_0x51a2a6=[_0x3a5bf2['body'][_0x5cc783(0x205)]];else var _0x11590d=[..._0x3a5bf2[_0x5cc783(0x2a9)][_0x5cc783(0x20a)]],_0x1e13fd=[..._0x3a5bf2['body'][_0x5cc783(0x271)]],_0x343181=[..._0x3a5bf2['body']['adjust_qty']],_0x8a92a8=[..._0x3a5bf2['body'][_0x5cc783(0x2a4)]],_0x37a208=[..._0x3a5bf2[_0x5cc783(0x2a9)][_0x5cc783(0x2eb)]],_0x561cc8=[..._0x3a5bf2[_0x5cc783(0x2a9)][_0x5cc783(0x245)]],_0x468cb9=[..._0x3a5bf2[_0x5cc783(0x2a9)]['level']],_0x51a2a6=[..._0x3a5bf2[_0x5cc783(0x2a9)]['expiry_date']];const _0x10ae44=_0x11590d[_0x5cc783(0x267)](_0x363130=>{return _0x363130={'product_name':_0x363130};});_0x1e13fd[_0x5cc783(0x2c4)]((_0x4c1725,_0x1f44c1)=>{_0x10ae44[_0x1f44c1]['stock']=_0x4c1725;}),_0x343181['forEach']((_0x9475db,_0x4280e3)=>{var _0x5a3689=_0x5cc783;_0x10ae44[_0x4280e3][_0x5a3689(0x257)]=_0x9475db;}),_0x8a92a8[_0x5cc783(0x2c4)]((_0x5c998f,_0x55aa4a)=>{_0x10ae44[_0x55aa4a]['primary_code']=_0x5c998f;}),_0x37a208[_0x5cc783(0x2c4)]((_0x2ea90e,_0x33e5f0)=>{var _0x479a1f=_0x5cc783;_0x10ae44[_0x33e5f0][_0x479a1f(0x2eb)]=_0x2ea90e;}),_0x561cc8[_0x5cc783(0x2c4)]((_0x5a45ca,_0x296274)=>{var _0x596613=_0x5cc783;_0x10ae44[_0x296274][_0x596613(0x25c)]=_0x5a45ca;}),_0x468cb9[_0x5cc783(0x2c4)]((_0x1d6eba,_0x3cbf1e)=>{var _0x3d400c=_0x5cc783;_0x10ae44[_0x3cbf1e][_0x3d400c(0x276)]=_0x1d6eba;}),_0x51a2a6[_0x5cc783(0x2c4)]((_0x3ba12c,_0x22cbbc)=>{var _0x4f887a=_0x5cc783;_0x10ae44[_0x22cbbc][_0x4f887a(0x205)]=_0x3ba12c;});var _0x30e056=0x0;_0x10ae44[_0x5cc783(0x2c4)](_0x1ee5da=>{var _0x106f5c=_0x5cc783;console['log']('foreach\x20newproduct',_0x1ee5da),(parseInt(_0x1ee5da['stock'])<parseInt(_0x1ee5da[_0x106f5c(0x257)])||parseInt(_0x1ee5da['quantity'])==0x0)&&_0x30e056++;});if(_0x30e056!=0x0)return _0x3a5bf2['flash'](_0x5cc783(0x261),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x26af56['redirect'](_0x5cc783(0x2a5));_0x37fca3[_0x5cc783(0x1ff)][_0x5cc783(0x2c4)](_0x5c8589=>{var _0x5735b5=_0x5cc783;const _0x997d2d=_0x5b3734[_0x5735b5(0x225)][_0x5735b5(0x267)](_0x5cb17e=>{var _0x2e11f6=_0x5735b5;_0x5cb17e[_0x2e11f6(0x20a)]==_0x5c8589[_0x2e11f6(0x20a)]&&_0x5cb17e[_0x2e11f6(0x216)]==_0x5c8589[_0x2e11f6(0x216)]&&(_0x5cb17e[_0x2e11f6(0x2ba)]=parseInt(_0x5cb17e[_0x2e11f6(0x2ba)])+parseInt(_0x5c8589[_0x2e11f6(0x257)]));});}),await _0x5b3734[_0x5cc783(0x247)]();const _0x5787ba=_0x10ae44[_0x5cc783(0x24e)](_0x2077d1=>_0x2077d1[_0x5cc783(0x257)]!=='0'&&_0x2077d1[_0x5cc783(0x257)]!=='');_0x37fca3[_0x5cc783(0x1fb)]=_0xa65076,_0x37fca3[_0x5cc783(0x2a3)]=_0x278b87,_0x37fca3[_0x5cc783(0x2e9)]=_0x43129a,_0x37fca3['warehouse_name']=_0x1fb7f2,_0x37fca3[_0x5cc783(0x1ff)]=_0x5787ba,_0x37fca3[_0x5cc783(0x238)]=_0x40ef55,_0x37fca3[_0x5cc783(0x29b)]=_0x1b2065;const _0x50b93c=await _0x37fca3[_0x5cc783(0x247)](),_0x1af6fd=await sales_finished['findOne']({'_id':_0x3a5bf2[_0x5cc783(0x220)]['id']}),_0x236d81=await warehouse[_0x5cc783(0x2bc)]({'name':_0x1fb7f2,'room':_0x1b2065,'warehouse_category':_0x5cc783(0x29a)});_0x1af6fd[_0x5cc783(0x1ff)][_0x5cc783(0x2c4)](_0x23aaca=>{var _0x4febf1=_0x5cc783;const _0x399f38=_0x236d81[_0x4febf1(0x225)][_0x4febf1(0x267)](_0x1c37d3=>{var _0x18bede=_0x4febf1;_0x1c37d3[_0x18bede(0x20a)]==_0x23aaca['product_name']&&_0x1c37d3[_0x18bede(0x216)]==_0x23aaca[_0x18bede(0x216)]&&(_0x1c37d3[_0x18bede(0x2ba)]=parseInt(_0x1c37d3[_0x18bede(0x2ba)])-parseInt(_0x23aaca[_0x18bede(0x257)]));});}),console[_0x5cc783(0x240)](_0x5cc783(0x277),_0x236d81),await _0x236d81['save']();const _0x4a83cf=await c_payment_data['findOne']({'invoice':_0x3a5bf2[_0x5cc783(0x2a9)][_0x5cc783(0x1fb)]});_0x4a83cf[_0x5cc783(0x2dc)]=_0x3a5bf2['body'][_0x5cc783(0x2dc)],await _0x4a83cf[_0x5cc783(0x247)](),_0x3a5bf2[_0x5cc783(0x217)](_0x5cc783(0x236),_0x5cc783(0x1ee)),_0x26af56[_0x5cc783(0x25e)](_0x5cc783(0x293));}catch(_0x1ae6c0){console[_0x5cc783(0x240)](_0x1ae6c0);}}),router[a0_0x394fcd(0x28e)](a0_0x394fcd(0x1ef),auth,async(_0x5b157d,_0x2f3894)=>{var _0x4fd295=a0_0x394fcd;try{const _0x413a31=_0x5b157d['params']['id'],{invoice:_0x27e4c2,customer:_0x3098e9,receivable_amount:_0x3744e9,received_amount:_0x2e73b2}=_0x5b157d[_0x4fd295(0x2a9)],_0x1f88c3=await sales[_0x4fd295(0x1ed)](_0x413a31);console['log'](_0x1f88c3);var _0x43bed7=_0x3744e9-_0x2e73b2;console[_0x4fd295(0x240)](_0x2e73b2),_0x1f88c3['received_amount']=parseFloat(_0x2e73b2)+parseFloat(_0x1f88c3[_0x4fd295(0x2ab)]),_0x1f88c3[_0x4fd295(0x25f)]=_0x43bed7,console[_0x4fd295(0x240)](_0x1f88c3);const _0x38f8b8=await _0x1f88c3[_0x4fd295(0x247)](),_0x594a93=await c_payment_data[_0x4fd295(0x2bc)]({'invoice':_0x27e4c2});_0x594a93['amount']=_0x43bed7,await _0x594a93['save']();let _0x1c57c2=new Date(),_0x232125=('0'+_0x1c57c2[_0x4fd295(0x288)]())[_0x4fd295(0x260)](-0x2),_0x478bf1=('0'+(_0x1c57c2['getMonth']()+0x1))[_0x4fd295(0x260)](-0x2),_0xb0d398=_0x1c57c2['getFullYear'](),_0x5564d6=_0xb0d398+'-'+_0x478bf1+'-'+_0x232125;const _0xd8b209=new customer_payment({'invoice':_0x27e4c2,'date':_0xb0d398+'-'+_0x478bf1+'-'+_0x232125,'customer':_0x3098e9,'reason':_0x4fd295(0x222),'amount':_0x2e73b2}),_0x2b1560=await _0xd8b209['save']();_0x5b157d[_0x4fd295(0x217)](_0x4fd295(0x236),_0x4fd295(0x25a)),_0x2f3894['redirect']('/all_sales/view');}catch(_0x2e2433){console[_0x4fd295(0x240)](_0x2e2433);}}),router[a0_0x394fcd(0x26c)](a0_0x394fcd(0x23b),auth,async(_0x2ad221,_0x24259c)=>{var _0x1ab658=a0_0x394fcd;try{const {username:_0x56fd01,email:_0x3cf39e,role:_0x1f31dd}=_0x2ad221[_0x1ab658(0x294)],_0x3716fa=_0x2ad221[_0x1ab658(0x294)],_0x5b2b89=await profile[_0x1ab658(0x2bc)]({'email':_0x3716fa[_0x1ab658(0x23e)]}),_0x29e37b=await master_shop[_0x1ab658(0x215)]();console[_0x1ab658(0x240)]('master',_0x29e37b);const _0x5bb77e=_0x2ad221[_0x1ab658(0x220)]['id'],_0x446e87=await sales['findById'](_0x5bb77e);console[_0x1ab658(0x240)](_0x446e87);const _0x343407=await customer['findOne']({'name':_0x446e87[_0x1ab658(0x2a3)]});console[_0x1ab658(0x240)](_0x343407);if(_0x29e37b[0x0][_0x1ab658(0x27a)]==_0x1ab658(0x231)){var _0x5ed3e1=users[_0x1ab658(0x2b4)];console[_0x1ab658(0x240)](_0x5ed3e1);}else{if(_0x29e37b[0x0][_0x1ab658(0x27a)]=='Hindi')var _0x5ed3e1=users[_0x1ab658(0x255)];else{if(_0x29e37b[0x0]['language']==_0x1ab658(0x21e))var _0x5ed3e1=users['German'];else{if(_0x29e37b[0x0]['language']==_0x1ab658(0x266))var _0x5ed3e1=users['Spanish'];else{if(_0x29e37b[0x0][_0x1ab658(0x27a)]=='French')var _0x5ed3e1=users[_0x1ab658(0x1f9)];else{if(_0x29e37b[0x0][_0x1ab658(0x27a)]==_0x1ab658(0x292))var _0x5ed3e1=users[_0x1ab658(0x2c1)];else{if(_0x29e37b[0x0][_0x1ab658(0x27a)]==_0x1ab658(0x2b2))var _0x5ed3e1=users[_0x1ab658(0x2b2)];else{if(_0x29e37b[0x0][_0x1ab658(0x27a)]=='Arabic\x20(ae)')var _0x5ed3e1=users[_0x1ab658(0x283)];}}}}}}}_0x24259c[_0x1ab658(0x256)]('sales_invoice',{'success':_0x2ad221[_0x1ab658(0x217)](_0x1ab658(0x236)),'errors':_0x2ad221[_0x1ab658(0x217)](_0x1ab658(0x261)),'role':_0x3716fa,'profile':_0x5b2b89,'master_shop':_0x29e37b,'customers':_0x343407,'sales':_0x446e87,'language':_0x5ed3e1});}catch(_0x2b7428){console['log'](_0x2b7428);}}),router[a0_0x394fcd(0x26c)](a0_0x394fcd(0x291),auth,async(_0xe04697,_0x403bce)=>{var _0x297a57=a0_0x394fcd;try{const {username:_0x3da72e,email:_0x537aa6,role:_0x4f9aea}=_0xe04697['user'],_0x3683b4=_0xe04697[_0x297a57(0x294)],_0x5c9b71=await profile[_0x297a57(0x2bc)]({'email':_0x3683b4['email']}),_0x127d4d=await master_shop[_0x297a57(0x215)](),_0x17b87d=_0xe04697[_0x297a57(0x220)]['id'],_0x38e57d=await sales_finished[_0x297a57(0x1ed)](_0x17b87d),_0x1dfc35=await warehouse['aggregate']([{'$match':{'name':_0x38e57d[_0x297a57(0x1f0)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x297a57(0x233),'name':{'$first':_0x297a57(0x1f2)},'product_stock':{'$first':_0x297a57(0x2a6)},'bay':{'$first':_0x297a57(0x204)},'bin':{'$first':_0x297a57(0x253)},'type':{'$first':_0x297a57(0x2e8)},'floorlevel':{'$first':_0x297a57(0x24f)},'primary_code':{'$first':_0x297a57(0x2c3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x297a57(0x1f1)},'storage':{'$first':_0x297a57(0x22e)},'rack':{'$first':_0x297a57(0x2e4)},'expiry_date':{'$first':_0x297a57(0x2ce)},'production_date':{'$first':_0x297a57(0x29e)},'unit':{'$first':_0x297a57(0x200)},'secondary_unit':{'$first':_0x297a57(0x2d5)},'maxProducts':{'$first':_0x297a57(0x2c5)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x297a57(0x21b)}}}]),_0x4c75a4=await product[_0x297a57(0x215)]({}),_0x5f05e4=await warehouse[_0x297a57(0x243)]([{'$match':{'status':_0x297a57(0x254),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x297a57(0x2e3),'$ne':_0x297a57(0x2af)}}},{'$group':{'_id':_0x297a57(0x1f6),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x4997c2=['Return\x20Rooms'];const _0x92560f=await warehouse[_0x297a57(0x243)]([{'$match':{'status':_0x297a57(0x254),'name':_0x297a57(0x2af)}},{'$group':{'_id':_0x297a57(0x1f6),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x127d4d[0x0]['language']==_0x297a57(0x231)){var _0x4b9dbd=users['English'];console['log'](_0x4b9dbd);}else{if(_0x127d4d[0x0][_0x297a57(0x27a)]==_0x297a57(0x255))var _0x4b9dbd=users[_0x297a57(0x255)];else{if(_0x127d4d[0x0][_0x297a57(0x27a)]==_0x297a57(0x21e))var _0x4b9dbd=users['German'];else{if(_0x127d4d[0x0][_0x297a57(0x27a)]=='Spanish')var _0x4b9dbd=users['Spanish'];else{if(_0x127d4d[0x0][_0x297a57(0x27a)]==_0x297a57(0x1f9))var _0x4b9dbd=users[_0x297a57(0x1f9)];else{if(_0x127d4d[0x0][_0x297a57(0x27a)]==_0x297a57(0x292))var _0x4b9dbd=users[_0x297a57(0x2c1)];else{if(_0x127d4d[0x0][_0x297a57(0x27a)]==_0x297a57(0x2b2))var _0x4b9dbd=users[_0x297a57(0x2b2)];else{if(_0x127d4d[0x0][_0x297a57(0x27a)]=='Arabic\x20(ae)')var _0x4b9dbd=users[_0x297a57(0x283)];}}}}}}}_0x403bce[_0x297a57(0x256)](_0x297a57(0x208),{'success':_0xe04697['flash'](_0x297a57(0x236)),'errors':_0xe04697[_0x297a57(0x217)](_0x297a57(0x261)),'role':_0x3683b4,'profile':_0x5c9b71,'user':_0x38e57d,'stock':_0x1dfc35,'master_shop':_0x127d4d,'unit':_0x4c75a4,'language':_0x4b9dbd,'warehouses':_0x5f05e4,'rooms':_0x4997c2,'warehouse_QA':_0x92560f});}catch(_0x53e6d5){console[_0x297a57(0x240)](_0x53e6d5),_0x403bce[_0x297a57(0x299)](0xc8)['json']({'message':_0x53e6d5[_0x297a57(0x2e7)]});}}),router[a0_0x394fcd(0x28e)](a0_0x394fcd(0x291),auth,async(_0x46d57d,_0x48d09f)=>{var _0x67d938=a0_0x394fcd;if(_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x26b)]=='QA')try{const {invoice:_0x518762,date:_0x19761c,warehouse_name:_0x31b205,product_name:_0x2328cb,primary_code:_0x1f317f,secondary_code:_0x545bc6,product_code:_0x45df71,sales_quantity:_0xfb09fe,stocks:_0x26a22a,return_qty:_0x4ae7f4,Room_name:_0xbf06a3,to_warehouse_name_QA:_0x4a7746,to_Room_name_QA:_0x2e314f,note:_0x574fd1,for_categorize:_0x455aca,product_name_QA1:_0x25c27b}=_0x46d57d[_0x67d938(0x2a9)];if(typeof _0x25c27b==_0x67d938(0x281))var _0x1f42a2=[_0x46d57d['body']['product_name_QA1']],_0xcd697e=[_0x46d57d['body']['primary_code_QA']],_0x5c53db=[_0x46d57d[_0x67d938(0x2a9)]['secondary_code_QA']],_0xfcf707=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x219)]],_0x12bbf9=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x242)]],_0x1f4bfd=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x20e)]],_0x4de06e=[_0x46d57d['body']['return_qty_QA']],_0x2da1b5=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x282)]],_0x167954=[_0x46d57d['body'][_0x67d938(0x25b)]],_0x3c6185=[_0x46d57d[_0x67d938(0x2a9)]['batch_code_QA']],_0x1f45aa=[_0x46d57d['body'][_0x67d938(0x2d0)]],_0xb29b8d=[_0x46d57d['body']['unit_QA']],_0x3d759f=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x228)]],_0x3dd504=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x227)]];else var _0x1f42a2=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2cd)]],_0xcd697e=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2b9)]],_0x5c53db=[..._0x46d57d['body'][_0x67d938(0x20f)]],_0xfcf707=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x219)]],_0x12bbf9=[..._0x46d57d['body'][_0x67d938(0x242)]],_0x1f4bfd=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x20e)]],_0x4de06e=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x234)]],_0x2da1b5=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x282)]],_0x167954=[..._0x46d57d['body'][_0x67d938(0x25b)]],_0x3c6185=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x278)]],_0x1f45aa=[..._0x46d57d[_0x67d938(0x2a9)]['secondary_unit_QA']],_0xb29b8d=[..._0x46d57d['body']['unit_QA']],_0x3d759f=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x228)]],_0x3dd504=[..._0x46d57d[_0x67d938(0x2a9)]['expiry_date_QA']];const _0x2da073=_0x1f42a2['map'](_0x580570=>{return _0x580570={'product_name':_0x580570};});_0xcd697e[_0x67d938(0x2c4)]((_0x272ea9,_0x32ec17)=>{var _0xd48d21=_0x67d938;_0x2da073[_0x32ec17][_0xd48d21(0x2a4)]=_0x272ea9;}),_0x5c53db[_0x67d938(0x2c4)]((_0x1951da,_0x8cec73)=>{var _0x410236=_0x67d938;_0x2da073[_0x8cec73][_0x410236(0x2eb)]=_0x1951da;}),_0xfcf707[_0x67d938(0x2c4)]((_0x5c437e,_0x5d2bbe)=>{_0x2da073[_0x5d2bbe]['product_code']=_0x5c437e;}),_0x12bbf9[_0x67d938(0x2c4)]((_0x5673ea,_0x21f20a)=>{_0x2da073[_0x21f20a]['sale_qty']=_0x5673ea;}),_0x1f4bfd[_0x67d938(0x2c4)]((_0x527f69,_0x206a8b)=>{_0x2da073[_0x206a8b]['stock']=_0x527f69;}),_0x4de06e[_0x67d938(0x2c4)]((_0x10bdb4,_0x47eee5)=>{_0x2da073[_0x47eee5]['return_qty']=_0x10bdb4;}),_0x2da1b5[_0x67d938(0x2c4)]((_0x5121c4,_0x984077)=>{var _0x40d3b6=_0x67d938;_0x2da073[_0x984077][_0x40d3b6(0x21d)]=_0x5121c4;}),_0x167954[_0x67d938(0x2c4)]((_0x248f17,_0x2357de)=>{var _0x1b957b=_0x67d938;_0x2da073[_0x2357de][_0x1b957b(0x2a1)]=_0x248f17;}),_0x3c6185[_0x67d938(0x2c4)]((_0x567127,_0x5b9a53)=>{var _0x2a9927=_0x67d938;_0x2da073[_0x5b9a53][_0x2a9927(0x26d)]=_0x567127;}),_0x1f45aa[_0x67d938(0x2c4)]((_0x5cc5f6,_0xfa27db)=>{var _0x25d37c=_0x67d938;_0x2da073[_0xfa27db][_0x25d37c(0x1fd)]=_0x5cc5f6;}),_0xb29b8d[_0x67d938(0x2c4)]((_0x14eb06,_0x49c8db)=>{var _0x2c04c1=_0x67d938;_0x2da073[_0x49c8db][_0x2c04c1(0x211)]=_0x14eb06;}),_0x3d759f[_0x67d938(0x2c4)]((_0x2340d1,_0x3f6d62)=>{_0x2da073[_0x3f6d62]['production_date']=_0x2340d1;}),_0x3dd504['forEach']((_0x5572f9,_0x279b68)=>{var _0x1392e4=_0x67d938;_0x2da073[_0x279b68][_0x1392e4(0x205)]=_0x5572f9;});const _0x34d129=await sales_finished['findOne']({'invoice':_0x518762});_0x34d129[_0x67d938(0x2df)]=_0x67d938(0x2f7);const _0x55f3f3=await _0x34d129[_0x67d938(0x247)](),_0x911ab8=new sales_return_finished({'invoice':_0x518762,'customer':_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2a3)],'date':_0x19761c,'warehouse_name':_0x31b205,'room':_0xbf06a3,'ToWarehouse':_0x4a7746,'ToRoom':_0x2e314f,'return_sale_QA':_0x2da073,'note':_0x574fd1,'warehouse_cat':_0x455aca}),_0x3fce16=await _0x911ab8['save'](),_0xe5f398=await sales_return_finished[_0x67d938(0x2bc)]({'invoice':_0x518762}),_0x4ff99b=await warehouse[_0x67d938(0x2bc)]({'name':_0x4a7746,'room':_0x2e314f});_0xe5f398[_0x67d938(0x2aa)][_0x67d938(0x2c4)](_0x12ca8c=>{var _0x43882b=_0x67d938,_0x12a337=0x0;const _0x2db6a6=_0x4ff99b[_0x43882b(0x225)][_0x43882b(0x267)](_0x438f74=>{var _0x4f00b0=_0x43882b;_0x438f74[_0x4f00b0(0x20a)]==_0x12ca8c[_0x4f00b0(0x20a)]&&_0x438f74[_0x4f00b0(0x205)]==_0x12ca8c['expiry_date']&&_0x438f74[_0x4f00b0(0x2d7)]==_0x12ca8c[_0x4f00b0(0x2d7)]&&_0x438f74[_0x4f00b0(0x26d)]==_0x12ca8c[_0x4f00b0(0x26d)]&&(_0x438f74['product_stock']=parseInt(_0x438f74[_0x4f00b0(0x2ba)])+parseInt(_0x12ca8c['return_qty']),_0x12a337++);});_0x12a337=='0'&&(_0x4ff99b[_0x43882b(0x225)]=_0x4ff99b[_0x43882b(0x225)]['concat']({'product_name':_0x12ca8c[_0x43882b(0x20a)],'product_stock':_0x12ca8c[_0x43882b(0x1fc)],'primary_code':_0x12ca8c[_0x43882b(0x2a4)],'secondary_code':_0x12ca8c[_0x43882b(0x2eb)],'product_code':_0x12ca8c[_0x43882b(0x25c)],'batch_code':_0x12ca8c[_0x43882b(0x26d)],'maxPerUnit':_0x12ca8c[_0x43882b(0x21d)],'production_date':_0x12ca8c[_0x43882b(0x2d7)],'expiry_date':_0x12ca8c['expiry_date'],'secondary_unit':_0x12ca8c[_0x43882b(0x1fd)],'unit':_0x12ca8c[_0x43882b(0x211)],'maxProducts':_0x12ca8c[_0x43882b(0x2a1)],'bay':_0x12ca8c['bay']}));}),await _0x4ff99b['save']();const _0x3c3948=new c_payment_data({'invoice':_0x518762,'customer':_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2a3)],'reason':_0x67d938(0x2f1)});await _0x3c3948[_0x67d938(0x247)]();const _0x596700=await master_shop[_0x67d938(0x215)](),_0x42435b=await email_settings['findOne'](),_0x259e62=await customer[_0x67d938(0x2bc)]({'name':_0x46d57d[_0x67d938(0x2a9)]['customer']});_0x596700[0x0]['currency_placement']==0x1?(right_currency=_0x596700[0x0][_0x67d938(0x2da)],left_currency=''):(right_currency='',left_currency=_0x596700[0x0]['currency']);var _0x68aa4c=_0x1f42a2,_0x33e643=_0x4de06e,_0x185b95='',_0x5b09db;for(_0x5b09db in _0x68aa4c){_0x185b95+=_0x67d938(0x2f5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x68aa4c[_0x5b09db]+_0x67d938(0x27c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x33e643[_0x5b09db]+_0x67d938(0x27c)+_0x67d938(0x2a8);}console[_0x67d938(0x240)]('product_list',_0x185b95);let _0x5b65c2=nodemailer[_0x67d938(0x286)]({'service':_0x67d938(0x23d),'auth':{'user':_0x42435b[_0x67d938(0x23e)],'pass':_0x42435b[_0x67d938(0x24b)]}}),_0x2d6892={'from':_0x42435b['email'],'to':_0x259e62[_0x67d938(0x23e)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x67d938(0x274),'path':__dirname+'/../public'+_0x67d938(0x26f)+_0x596700[0x0]['image'],'cid':_0x67d938(0x2d3)}],'html':_0x67d938(0x2ad)+_0x67d938(0x22b)+_0x67d938(0x20b)+_0x67d938(0x2e6)+_0x67d938(0x2d6)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x67d938(0x2e6)+_0x67d938(0x2e2)+_0x596700[0x0][_0x67d938(0x232)]+_0x67d938(0x1fe)+_0x67d938(0x226)+'</div>'+_0x67d938(0x22d)+_0x67d938(0x2e6)+_0x67d938(0x237)+_0x67d938(0x2b1)+_0x518762+'\x20'+_0x67d938(0x297)+_0x67d938(0x202)+_0x19761c+'\x20'+'</span>'+_0x67d938(0x262)+_0x67d938(0x226)+_0x67d938(0x248)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x67d938(0x2f5)+_0x67d938(0x1f3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x67d938(0x21f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x67d938(0x2a8)+_0x67d938(0x27e)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x185b95+'\x20'+_0x67d938(0x241)+_0x67d938(0x223)+_0x67d938(0x2e6)+_0x67d938(0x28d)+_0x67d938(0x2f6)+_0x596700[0x0]['site_title']+_0x67d938(0x262)+_0x67d938(0x226)+_0x67d938(0x226)+_0x67d938(0x2bb)};_0x5b65c2['sendMail'](_0x2d6892,function(_0x426dcd,_0x4f5c1b){var _0x2f11bd=_0x67d938;_0x426dcd?(console[_0x2f11bd(0x240)](_0x426dcd),console[_0x2f11bd(0x240)](_0x2f11bd(0x25d))):console['log'](_0x2f11bd(0x2f4));}),_0x46d57d['flash'](_0x67d938(0x236),'sales\x20item\x20return\x20successfull'),_0x48d09f['redirect'](_0x67d938(0x293));}catch(_0x47d0a6){_0x48d09f[_0x67d938(0x299)](0xc8)[_0x67d938(0x28c)]({'message1':_0x47d0a6['message']});}else{if(_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x26b)]=='GS')try{const {invoice:_0x150a7a,date:_0x29c4b5,warehouse_name:_0x354ac7,product_name:_0x51db18,primary_code:_0x1112b7,secondary_code:_0x2e6d09,product_code:_0x44efcb,sales_quantity:_0x34e8bb,stocks:_0x4a53d2,return_qty:_0x5a89d7,Room_name:_0x10e117,to_warehouse_name:_0x1b74af,to_Room_name:_0x2bcfaa,note:_0x5f0b12,level:_0x33a12b,isle:_0x51fc4e,pallet:_0x18767a,for_categorize:_0x5ecefc}=_0x46d57d[_0x67d938(0x2a9)];if(typeof _0x51db18=='string')var _0x1f42a2=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x20a)]],_0xcd697e=[_0x46d57d[_0x67d938(0x2a9)]['primary_code']],_0x5c53db=[_0x46d57d[_0x67d938(0x2a9)]['secondary_code']],_0xfcf707=[_0x46d57d[_0x67d938(0x2a9)]['product_code']],_0x12bbf9=[_0x46d57d[_0x67d938(0x2a9)]['sales_quantity']],_0x4de06e=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x1fc)]],_0x2ea5ca=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x216)]],_0x2da1b5=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x21d)]],_0x167954=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2a1)]],_0x3c6185=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x26d)]],_0x1f45aa=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x1fd)]],_0xb29b8d=[_0x46d57d['body'][_0x67d938(0x211)]],_0x3d759f=[_0x46d57d['body'][_0x67d938(0x2d7)]],_0x3dd504=[_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x205)]];else var _0x1f42a2=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x20a)]],_0xcd697e=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2a4)]],_0x5c53db=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2eb)]],_0xfcf707=[..._0x46d57d['body'][_0x67d938(0x25c)]],_0x12bbf9=[..._0x46d57d[_0x67d938(0x2a9)]['sales_quantity']],_0x4de06e=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x1fc)]],_0x2ea5ca=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x216)]],_0x2da1b5=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x21d)]],_0x167954=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2a1)]],_0x3c6185=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x26d)]],_0x1f45aa=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x1fd)]],_0xb29b8d=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x211)]],_0x3d759f=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2d7)]],_0x3dd504=[..._0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x205)]];const _0x5c7f54=_0x1f42a2['map'](_0x4eca71=>{return _0x4eca71={'product_name':_0x4eca71};});_0xcd697e[_0x67d938(0x2c4)]((_0x4ed7a6,_0x421a3e)=>{var _0x1f00f7=_0x67d938;_0x5c7f54[_0x421a3e][_0x1f00f7(0x2a4)]=_0x4ed7a6;}),_0x5c53db[_0x67d938(0x2c4)]((_0x2104de,_0x35aa10)=>{_0x5c7f54[_0x35aa10]['secondary_code']=_0x2104de;}),_0xfcf707['forEach']((_0x33c819,_0x3686c2)=>{var _0x13a519=_0x67d938;_0x5c7f54[_0x3686c2][_0x13a519(0x25c)]=_0x33c819;}),_0x12bbf9['forEach']((_0x5d87bf,_0x52cb06)=>{var _0x4b8de1=_0x67d938;_0x5c7f54[_0x52cb06][_0x4b8de1(0x2c0)]=_0x5d87bf;}),_0x4de06e[_0x67d938(0x2c4)]((_0x31a629,_0x5ffc26)=>{var _0x443134=_0x67d938;_0x5c7f54[_0x5ffc26][_0x443134(0x1fc)]=_0x31a629;}),_0x2ea5ca[_0x67d938(0x2c4)]((_0x1fce1b,_0x4c69c6)=>{var _0x2b9fef=_0x67d938;_0x5c7f54[_0x4c69c6][_0x2b9fef(0x216)]=_0x1fce1b;}),_0x2da1b5[_0x67d938(0x2c4)]((_0xa368c1,_0x1a90eb)=>{var _0x34e37a=_0x67d938;_0x5c7f54[_0x1a90eb][_0x34e37a(0x21d)]=_0xa368c1;}),_0x167954[_0x67d938(0x2c4)]((_0x3aa7ec,_0x12a421)=>{var _0x2642e3=_0x67d938;_0x5c7f54[_0x12a421][_0x2642e3(0x2a1)]=_0x3aa7ec;}),_0x3c6185[_0x67d938(0x2c4)]((_0x1aa7ce,_0xe92300)=>{_0x5c7f54[_0xe92300]['batch_code']=_0x1aa7ce;}),_0x1f45aa['forEach']((_0x2e6a3e,_0x44f7f2)=>{_0x5c7f54[_0x44f7f2]['secondary_unit']=_0x2e6a3e;}),_0xb29b8d['forEach']((_0x4a60e9,_0x2064e6)=>{var _0x4402bc=_0x67d938;_0x5c7f54[_0x2064e6][_0x4402bc(0x211)]=_0x4a60e9;}),_0x3d759f[_0x67d938(0x2c4)]((_0x1b1857,_0x533fe1)=>{var _0x46b1d4=_0x67d938;_0x5c7f54[_0x533fe1][_0x46b1d4(0x2d7)]=_0x1b1857;}),_0x3dd504[_0x67d938(0x2c4)]((_0x27fb23,_0x5d2cc4)=>{var _0x1b245d=_0x67d938;_0x5c7f54[_0x5d2cc4][_0x1b245d(0x205)]=_0x27fb23;});var _0x335ece=0x0;_0x5c7f54[_0x67d938(0x2c4)](_0x4c868b=>{var _0x384cd0=_0x67d938;(parseInt(_0x4c868b[_0x384cd0(0x2c0)])<parseInt(_0x4c868b[_0x384cd0(0x1fc)])||parseInt(_0x4c868b['stock'])<parseInt(_0x4c868b[_0x384cd0(0x1fc)])&&parseInt(_0x4c868b[_0x384cd0(0x2c0)])>parseInt(_0x4c868b[_0x384cd0(0x1fc)])||parseInt(_0x4c868b['return_qty'])==0x0)&&_0x335ece++;});if(_0x335ece!=0x0)return _0x46d57d[_0x67d938(0x217)](_0x67d938(0x261),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x48d09f[_0x67d938(0x25e)](_0x67d938(0x2a5));const _0x382156=await sales_finished[_0x67d938(0x2bc)]({'invoice':_0x150a7a});_0x382156['return_data']=_0x67d938(0x2f7);const _0x561776=await _0x382156[_0x67d938(0x247)](),_0x119aea=new sales_return_finished({'invoice':_0x150a7a,'customer':_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2a3)],'date':_0x29c4b5,'warehouse_name':_0x354ac7,'room':_0x10e117,'ToWarehouse':_0x1b74af,'ToRoom':_0x2bcfaa,'return_sale':_0x5c7f54,'note':_0x5f0b12,'warehouse_cat':_0x5ecefc}),_0x423d71=await _0x119aea[_0x67d938(0x247)](),_0x21e20a=await sales_return_finished[_0x67d938(0x2bc)]({'invoice':_0x150a7a}),_0xa5276b=await warehouse[_0x67d938(0x2bc)]({'name':_0x1b74af,'room':_0x2bcfaa,'warehouse_category':_0x67d938(0x29a)});_0x21e20a[_0x67d938(0x287)][_0x67d938(0x2c4)](_0x3bfc43=>{var _0x17bfb2=_0x67d938,_0x28e866=0x0;const _0x5c5e6b=_0xa5276b[_0x17bfb2(0x225)][_0x17bfb2(0x267)](_0x5335d3=>{var _0x5433e5=_0x17bfb2;_0x5335d3[_0x5433e5(0x20a)]==_0x3bfc43[_0x5433e5(0x20a)]&&_0x5335d3[_0x5433e5(0x216)]==_0x3bfc43['bay']&&_0x5335d3[_0x5433e5(0x205)]==_0x3bfc43[_0x5433e5(0x205)]&&_0x5335d3[_0x5433e5(0x2d7)]==_0x3bfc43[_0x5433e5(0x2d7)]&&_0x5335d3[_0x5433e5(0x26d)]==_0x3bfc43[_0x5433e5(0x26d)]&&(_0x5335d3[_0x5433e5(0x2ba)]=parseInt(_0x5335d3['product_stock'])+parseInt(_0x3bfc43[_0x5433e5(0x1fc)]),_0x28e866++);});_0x28e866=='0'&&(_0xa5276b[_0x17bfb2(0x225)]=_0xa5276b[_0x17bfb2(0x225)]['concat']({'product_name':_0x3bfc43['product_name'],'product_stock':_0x3bfc43[_0x17bfb2(0x1fc)],'primary_code':_0x3bfc43[_0x17bfb2(0x2a4)],'secondary_code':_0x3bfc43[_0x17bfb2(0x2eb)],'product_code':_0x3bfc43[_0x17bfb2(0x25c)],'bay':_0x3bfc43[_0x17bfb2(0x216)],'batch_code':_0x3bfc43['batch_code'],'maxPerUnit':_0x3bfc43[_0x17bfb2(0x21d)],'production_date':_0x3bfc43[_0x17bfb2(0x2d7)],'expiry_date':_0x3bfc43['expiry_date'],'secondary_unit':_0x3bfc43[_0x17bfb2(0x1fd)],'unit':_0x3bfc43[_0x17bfb2(0x211)],'maxProducts':_0x3bfc43['maxProducts']}));}),await _0xa5276b['save'](),console[_0x67d938(0x240)](_0x46d57d[_0x67d938(0x2a9)]);const _0x43fb32=new c_payment_data({'invoice':_0x150a7a,'customer':_0x46d57d[_0x67d938(0x2a9)]['customer'],'reason':_0x67d938(0x2f1)});await _0x43fb32['save']();const _0x3b5d72=await master_shop[_0x67d938(0x215)]();console[_0x67d938(0x240)](_0x67d938(0x2ca),_0x3b5d72[0x0][_0x67d938(0x2b5)]);const _0x2ad36d=await email_settings[_0x67d938(0x2bc)](),_0x449b03=await customer['findOne']({'name':_0x46d57d[_0x67d938(0x2a9)][_0x67d938(0x2a3)]});console[_0x67d938(0x240)](_0x67d938(0x279),_0x449b03);_0x3b5d72[0x0][_0x67d938(0x2c2)]==0x1?(right_currency=_0x3b5d72[0x0][_0x67d938(0x2da)],left_currency=''):(right_currency='',left_currency=_0x3b5d72[0x0][_0x67d938(0x2da)]);var _0x68aa4c=_0x1f42a2,_0x33e643=_0x4de06e,_0x185b95='',_0x5b09db;for(_0x5b09db in _0x68aa4c){_0x185b95+=_0x67d938(0x2f5)+_0x67d938(0x23f)+_0x68aa4c[_0x5b09db]+_0x67d938(0x27c)+_0x67d938(0x23f)+_0x33e643[_0x5b09db]+_0x67d938(0x27c)+_0x67d938(0x2a8);}console[_0x67d938(0x240)](_0x67d938(0x2a7),_0x185b95);let _0x3a1d56=nodemailer[_0x67d938(0x286)]({'service':'gmail','auth':{'user':_0x2ad36d[_0x67d938(0x23e)],'pass':_0x2ad36d['password']}}),_0x1df71c={'from':_0x2ad36d['email'],'to':_0x449b03[_0x67d938(0x23e)],'subject':_0x67d938(0x22a),'attachments':[{'filename':_0x67d938(0x274),'path':__dirname+'/../public'+'/upload/'+_0x3b5d72[0x0][_0x67d938(0x2b5)],'cid':_0x67d938(0x2d3)}],'html':_0x67d938(0x2ad)+'<html><head><title></title>'+_0x67d938(0x20b)+_0x67d938(0x2e6)+_0x67d938(0x2d6)+'<div>'+_0x67d938(0x2cb)+'</div>'+_0x67d938(0x2e6)+_0x67d938(0x2e2)+_0x3b5d72[0x0][_0x67d938(0x232)]+_0x67d938(0x1fe)+'</div>'+'</div>'+_0x67d938(0x22d)+_0x67d938(0x2e6)+_0x67d938(0x237)+'\x20Order\x20Number\x20:\x20'+_0x150a7a+'\x20'+_0x67d938(0x297)+'\x20Order\x20Date\x20:\x20'+_0x29c4b5+'\x20'+_0x67d938(0x2ae)+_0x67d938(0x262)+'</div>'+_0x67d938(0x248)+_0x67d938(0x20c)+_0x67d938(0x2f5)+_0x67d938(0x1f3)+_0x67d938(0x2e0)+_0x67d938(0x21f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x67d938(0x2a8)+_0x67d938(0x27e)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x185b95+'\x20'+_0x67d938(0x241)+'</table>'+_0x67d938(0x2e6)+_0x67d938(0x28d)+_0x67d938(0x2f6)+_0x3b5d72[0x0]['site_title']+'</h5>'+'</div>'+_0x67d938(0x226)+'</body></html>'};_0x3a1d56[_0x67d938(0x2b0)](_0x1df71c,function(_0x546f2e,_0x463720){var _0x5daa3c=_0x67d938;_0x546f2e?(console['log'](_0x546f2e),console['log'](_0x5daa3c(0x25d))):console['log']('Email\x20sent\x20successfully');}),_0x46d57d[_0x67d938(0x217)](_0x67d938(0x236),_0x67d938(0x23c)),_0x48d09f[_0x67d938(0x25e)](_0x67d938(0x293));}catch(_0x141987){console[_0x67d938(0x240)](_0x141987),_0x48d09f[_0x67d938(0x299)](0xc8)[_0x67d938(0x28c)]({'message1':_0x141987[_0x67d938(0x2e7)]});}}}),router['get'](a0_0x394fcd(0x1fa),auth,async(_0x5386c9,_0x1ce4b8)=>{var _0xf76ddb=a0_0x394fcd;try{const {username:_0x45703f,email:_0xfdbbd9,role:_0x3e9422}=_0x5386c9[_0xf76ddb(0x294)],_0x3d2dc8=_0x5386c9[_0xf76ddb(0x294)],_0x5ecebe=await profile[_0xf76ddb(0x2bc)]({'email':_0x3d2dc8[_0xf76ddb(0x23e)]}),_0x117043=await master_shop[_0xf76ddb(0x215)]();console[_0xf76ddb(0x240)](_0xf76ddb(0x2db),_0x117043);const _0x4e3136=_0x5386c9[_0xf76ddb(0x220)]['id'],_0x39672b=await sales[_0xf76ddb(0x1ed)](_0x4e3136);console['log'](_0xf76ddb(0x275),_0x39672b);if(_0x117043[0x0][_0xf76ddb(0x27a)]==_0xf76ddb(0x231))var _0x5267c8=users[_0xf76ddb(0x2b4)];else{if(_0x117043[0x0][_0xf76ddb(0x27a)]==_0xf76ddb(0x255))var _0x5267c8=users[_0xf76ddb(0x255)];else{if(_0x117043[0x0][_0xf76ddb(0x27a)]==_0xf76ddb(0x21e))var _0x5267c8=users[_0xf76ddb(0x21e)];else{if(_0x117043[0x0][_0xf76ddb(0x27a)]==_0xf76ddb(0x266))var _0x5267c8=users[_0xf76ddb(0x266)];else{if(_0x117043[0x0][_0xf76ddb(0x27a)]==_0xf76ddb(0x1f9))var _0x5267c8=users[_0xf76ddb(0x1f9)];else{if(_0x117043[0x0][_0xf76ddb(0x27a)]==_0xf76ddb(0x292))var _0x5267c8=users[_0xf76ddb(0x2c1)];else{if(_0x117043[0x0][_0xf76ddb(0x27a)]==_0xf76ddb(0x2b2))var _0x5267c8=users[_0xf76ddb(0x2b2)];else{if(_0x117043[0x0][_0xf76ddb(0x27a)]==_0xf76ddb(0x221))var _0x5267c8=users[_0xf76ddb(0x283)];}}}}}}}_0x1ce4b8[_0xf76ddb(0x256)](_0xf76ddb(0x290),{'success':_0x5386c9[_0xf76ddb(0x217)]('success'),'errors':_0x5386c9[_0xf76ddb(0x217)](_0xf76ddb(0x261)),'role':_0x3d2dc8,'profile':_0x5ecebe,'alldata':_0x39672b,'master_shop':_0x117043,'language':_0x5267c8});}catch(_0x371eee){console[_0xf76ddb(0x240)](_0x371eee);}}),router[a0_0x394fcd(0x28e)]('/barcode_scanner',async(_0x6ad8d9,_0x457b14)=>{var _0x48d8dc=a0_0x394fcd;const {product_code:_0x482a3b,warehouse_name:_0x5cdf20,rooms_data:_0x2762e0,Roomslist:_0x631e68}=_0x6ad8d9[_0x48d8dc(0x2a9)],_0x558cb8=_0x631e68['split'](','),_0x19ba5d=[];async function _0x318c64(_0x773481){var _0x20b8bb=_0x48d8dc;const _0x1e1f4c=await warehouse[_0x20b8bb(0x243)]([{'$match':{'name':_0x5cdf20,'room':_0x773481}},{'$unwind':_0x20b8bb(0x21c)},{'$match':{'product_details.primary_code':_0x482a3b}},{'$group':{'_id':_0x20b8bb(0x233),'name':{'$first':_0x20b8bb(0x1f2)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x20b8bb(0x2c3)},'secondary_code':{'$first':_0x20b8bb(0x29d)},'product_code':{'$first':_0x20b8bb(0x1f1)},'level':{'$first':_0x20b8bb(0x204)},'isle':{'$first':_0x20b8bb(0x253)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x20b8bb(0x24f)},'unit':{'$first':_0x20b8bb(0x200)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x20b8bb(0x22e)},'rack':{'$first':_0x20b8bb(0x2e4)},'expiry_date':{'$first':_0x20b8bb(0x2ce)},'production_date':{'$first':_0x20b8bb(0x29e)},'maxPerUnit':{'$first':_0x20b8bb(0x21b)},'batch_code':{'$first':_0x20b8bb(0x2c6)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x20b8bb(0x265)},'invoice':{'$first':_0x20b8bb(0x2b7)}}}]),_0x49d440=await warehouse['aggregate']([{'$match':{'name':_0x5cdf20,'room':_0x773481}},{'$unwind':_0x20b8bb(0x21c)},{'$match':{'product_details.secondary_code':_0x482a3b}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x20b8bb(0x1f2)},'product_stock':{'$first':_0x20b8bb(0x2a6)},'primary_code':{'$first':_0x20b8bb(0x2c3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x20b8bb(0x1f1)},'level':{'$first':_0x20b8bb(0x204)},'isle':{'$first':_0x20b8bb(0x253)},'type':{'$first':_0x20b8bb(0x2e8)},'pallet':{'$first':_0x20b8bb(0x24f)},'unit':{'$first':_0x20b8bb(0x200)},'secondary_unit':{'$first':_0x20b8bb(0x2d5)},'storage':{'$first':_0x20b8bb(0x22e)},'rack':{'$first':_0x20b8bb(0x2e4)},'expiry_date':{'$first':_0x20b8bb(0x2ce)},'production_date':{'$first':_0x20b8bb(0x29e)},'maxPerUnit':{'$first':_0x20b8bb(0x21b)},'batch_code':{'$first':_0x20b8bb(0x2c6)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x20b8bb(0x265)},'invoice':{'$first':_0x20b8bb(0x2b7)}}}]);if(_0x1e1f4c[_0x20b8bb(0x1f5)]>0x0)_0x19ba5d[_0x20b8bb(0x298)](_0x1e1f4c);else _0x49d440['length']>0x0&&_0x19ba5d[_0x20b8bb(0x298)](_0x49d440);}const _0x35aaf8=_0x558cb8[_0x48d8dc(0x267)](_0x438a53=>_0x318c64(_0x438a53));await Promise['all'](_0x35aaf8),_0x457b14[_0x48d8dc(0x28c)](_0x19ba5d);}),module[a0_0x394fcd(0x22f)]=router;