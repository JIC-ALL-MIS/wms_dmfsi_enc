var a0_0x24ad91=a0_0x55d9;(function(_0x50e5ca,_0x4f04e7){var _0x2de7a6=a0_0x55d9,_0x262ce1=_0x50e5ca();while(!![]){try{var _0x15279a=-parseInt(_0x2de7a6(0x249))/0x1*(-parseInt(_0x2de7a6(0x292))/0x2)+-parseInt(_0x2de7a6(0x1b8))/0x3*(-parseInt(_0x2de7a6(0x232))/0x4)+parseInt(_0x2de7a6(0x229))/0x5*(-parseInt(_0x2de7a6(0x286))/0x6)+parseInt(_0x2de7a6(0x285))/0x7*(-parseInt(_0x2de7a6(0x258))/0x8)+-parseInt(_0x2de7a6(0x214))/0x9+-parseInt(_0x2de7a6(0x205))/0xa*(parseInt(_0x2de7a6(0x28f))/0xb)+-parseInt(_0x2de7a6(0x272))/0xc*(-parseInt(_0x2de7a6(0x20a))/0xd);if(_0x15279a===_0x4f04e7)break;else _0x262ce1['push'](_0x262ce1['shift']());}catch(_0x57ed08){_0x262ce1['push'](_0x262ce1['shift']());}}}(a0_0x717c,0xacc30));const express=require(a0_0x24ad91(0x21f)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x24ad91(0x1c0)),auth=require('../middleware/auth'),nodemailer=require(a0_0x24ad91(0x254)),users=require(a0_0x24ad91(0x1a8));function a0_0x717c(){var _0x4b2173=['Arabic\x20(ae)','<!DOCTYPE\x20html>','secondary_code_QA','production_date','toString','164296Jzqfiv','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','log','271482Hcjney','</td>','$date','findOne','/view/add_sales','$sale_product.quantity','christian.villamer@jakagroup.com','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','staff','customers_docs','$product_details.product_cat','/view/add_sales/:id','secondary_unit','exports','Return\x20Rooms','Portuguese\x20(BR)','product_stock','final','$name','edit_sales_finished_view','$product_details.unit','sales_invoice','/view/:id','Sale\x20Return','return_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<tr>','role','$note','maxPerUnit_QA','$customers_docs','currency_placement','$customer','Arabic','warehouse','English','Logo.png','back','createTransport','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','customers','password','$room','product_name','batch_code_QA','site_title','<strong>\x20Regards\x20</strong>','../public/language/languages.json','Portuguese','bay','catch','$sale_product.bin','currency','/invoice/:id','quantity','aggregate','$product_details.bay','return_sale','email','\x20<>\x20','Quality\x20Inspection','/upload/','<h2>\x20','123831aNYKUm','Sales\x20Mail','product_details','expiry_date','prod_code','QA\x20Warehouse','warehouse_name','Hindi','../models/all_models','$sale_product.bay','prod_invoice','add_sales_finished','max_per_unit','sales\x20item\x20return\x20successfull','$product_details.floorlevel','getDate','concat','maxPerUnit','maxperunit','$sale_product.floorlevel','sendMail','payment\x20successfull','</body></html>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_name','findById','getMonth','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','primary_code','/preview/:id','</span>','Error\x20Occurs','primary_code_QA','<h5\x20style=\x22text-align:\x20left;\x22>','maxProducts','redirect','edit_sales_finished','split','for_categorize','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','due_amount','/all_sales/view','Return\x20Goods','Received\x20Payment\x20For\x20Sale','<tbody\x20style=\x22text-align:\x20center;\x22>','status','forEach','length','id_transaction_from','German','<h5>','json','level','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</tr>','filter','room_name','$product_details.type','True','slice','product_data','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','user','Enabled','$product_details.storage','stock_data','\x20Order\x20Date\x20:\x20','secondary_unit_QA','sales_quantity','secondary_code','ADD\x20SALE','invoice','body','<html><head><title></title>','Sales\x20Add\x20successfully','640OhYsCH','received_amount','$_id','$product_details.bin','/all_sales_finished/view','13ohwdfv','product_list','OUTF-','Spanish','port','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$product_details.maxPerUnit','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$sale_product','3939597cbsIBW','/view/return_sales/:id','</thead>','batch_code','floor','get','getFullYear','abs','all_sales_finished','$product_details.secondary_code','unit','express','product_date','Ambient','Sale\x20Return\x20Mail','success','$product_details','<div>','save','$product_details._id','<span\x20style=\x22float:\x20right;\x22>','61045MkRIri','\x20&&\x20','customer','message','An\x20error\x20occurred.','\x20Order\x20Number\x20:\x20','padStart','<hr\x20class=\x22my-3\x22>','render','108lSsnCn','flash','\x20<<<==>>>\x20','$warehouse_name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_stock','product_name_QA1','string','image','product_code','return_sale_QA','$finalize','primary_unit','language','sale_product','False','$sale_product.type','stocks_QA','Chinese','$product_details.rack','find','English\x20(US)','RoomAssigned','2lBisPy','random','foreach\x20newproduct','adjust_qty','Finished\x20Goods','expiry_date_QA','/../public','logo','FGSEmail','return_data','Sale','nodemailer','$invoice','product','</h5>','17896TrEvxy','push','params','name','\x20==\x20','map','</div>','French','error','maxProducts_QA','$product_details.invoice','$return_data','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/view/add_sale/product','\x20</h2>','prod_cat','</tbody>','carton','room','$product_details.room_name','_id','$product_details.product_code','unit_QA','$product.product_name','$product_details.primary_code','sales_quantity_QA','31001484nUCFHX','host','</table>','post','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','Email\x20sent\x20successfully','/all_sales_finished/preview/','$product_details.production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.maxProducts','all_sales_barcode','$product_details.expiry_date','Enclosed','stock','/barcode/:id','purchases_data','sale_qty','$product_details.secondary_unit','$product_details.batch_code','2331DSTUaj','552nOLoza','return_sale_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','errors'];a0_0x717c=function(){return _0x4b2173;};return a0_0x717c();}router['get']('/view',auth,async(_0x86b167,_0x59b1f7)=>{var _0x3eadcf=a0_0x24ad91;try{const {username:_0x3c2a96,email:_0x54864d,role:_0x46971e}=_0x86b167[_0x3eadcf(0x1f8)],_0x344e43=_0x86b167[_0x3eadcf(0x1f8)],_0x54fbff=await profile[_0x3eadcf(0x295)]({'email':_0x344e43[_0x3eadcf(0x1b3)]}),_0x29675d=await master_shop[_0x3eadcf(0x246)]();let _0x2e9b57;if(_0x344e43['role']==_0x3eadcf(0x29a)){const _0x83baff=await staff[_0x3eadcf(0x295)]({'email':_0x344e43[_0x3eadcf(0x1b3)]});_0x2e9b57=await sales_finished[_0x3eadcf(0x1b0)]([{'$lookup':{'from':_0x3eadcf(0x1a1),'localField':_0x3eadcf(0x22b),'foreignField':_0x3eadcf(0x25b),'as':_0x3eadcf(0x29b)}},{'$unwind':_0x3eadcf(0x2b0)},{'$unwind':_0x3eadcf(0x213)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3eadcf(0x255)},'customers':{'$first':_0x3eadcf(0x2b2)},'date':{'$first':_0x3eadcf(0x294)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3eadcf(0x213)},'note':{'$first':_0x3eadcf(0x2ae)},'return_data':{'$first':_0x3eadcf(0x263)},'customers_docs':{'$first':_0x3eadcf(0x2b0)},'total_saleproduct_quantity':{'$sum':_0x3eadcf(0x297)},'level':{'$addToSet':_0x3eadcf(0x1c1)},'isle':{'$addToSet':_0x3eadcf(0x1ac)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x3eadcf(0x1cb)},'finalize':{'$first':_0x3eadcf(0x23d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x2e9b57=await sales_finished[_0x3eadcf(0x1b0)]([{'$lookup':{'from':_0x3eadcf(0x1a1),'localField':_0x3eadcf(0x22b),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0x3eadcf(0x2b0)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x3eadcf(0x207),'invoice':{'$first':_0x3eadcf(0x255)},'customers':{'$first':_0x3eadcf(0x2b2)},'date':{'$first':_0x3eadcf(0x294)},'warehouse_name':{'$first':_0x3eadcf(0x235)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x3eadcf(0x2ae)},'return_data':{'$first':_0x3eadcf(0x263)},'customers_docs':{'$first':_0x3eadcf(0x2b0)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x3eadcf(0x1c1)},'isle':{'$addToSet':_0x3eadcf(0x1ac)},'type':{'$addToSet':_0x3eadcf(0x242)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3eadcf(0x23d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x29675d[0x0][_0x3eadcf(0x23f)]==_0x3eadcf(0x247)){var _0xa69e2e=users[_0x3eadcf(0x19c)];console[_0x3eadcf(0x291)](_0xa69e2e);}else{if(_0x29675d[0x0][_0x3eadcf(0x23f)]=='Hindi')var _0xa69e2e=users[_0x3eadcf(0x1bf)];else{if(_0x29675d[0x0][_0x3eadcf(0x23f)]==_0x3eadcf(0x1ea))var _0xa69e2e=users[_0x3eadcf(0x1ea)];else{if(_0x29675d[0x0][_0x3eadcf(0x23f)]=='Spanish')var _0xa69e2e=users[_0x3eadcf(0x20d)];else{if(_0x29675d[0x0][_0x3eadcf(0x23f)]=='French')var _0xa69e2e=users[_0x3eadcf(0x25f)];else{if(_0x29675d[0x0][_0x3eadcf(0x23f)]==_0x3eadcf(0x2a1))var _0xa69e2e=users[_0x3eadcf(0x1a9)];else{if(_0x29675d[0x0][_0x3eadcf(0x23f)]==_0x3eadcf(0x244))var _0xa69e2e=users['Chinese'];else{if(_0x29675d[0x0][_0x3eadcf(0x23f)]==_0x3eadcf(0x28a))var _0xa69e2e=users[_0x3eadcf(0x2b3)];}}}}}}}_0x59b1f7[_0x3eadcf(0x231)](_0x3eadcf(0x21c),{'success':_0x86b167['flash'](_0x3eadcf(0x223)),'errors':_0x86b167['flash']('errors'),'sales':_0x2e9b57,'profile':_0x54fbff,'role':_0x344e43,'master_shop':_0x29675d,'language':_0xa69e2e});}catch(_0x22be73){console['log'](_0x22be73);}});async function getRandom8DigitNumber(){var _0x338fdd=a0_0x24ad91;const _0x44ac9e=0x989680,_0x35ab1f=0x5f5e0ff,_0x4bfcb9=Math[_0x338fdd(0x218)](Math[_0x338fdd(0x24a)]()*(_0x35ab1f-_0x44ac9e+0x1))+_0x44ac9e;var _0x3bde55;const _0x106f40=await sales_finished[_0x338fdd(0x295)]({'invoice':'OUTF-'+_0x4bfcb9});return _0x106f40&&_0x106f40[_0x338fdd(0x1e8)]>0x0?_0x3bde55=_0x338fdd(0x20c)+_0x4bfcb9:_0x3bde55=_0x338fdd(0x20c)+_0x4bfcb9,_0x3bde55;}function a0_0x55d9(_0x2172bc,_0x12fe6b){var _0x717c5a=a0_0x717c();return a0_0x55d9=function(_0x55d9ef,_0x420400){_0x55d9ef=_0x55d9ef-0x19b;var _0xb49711=_0x717c5a[_0x55d9ef];return _0xb49711;},a0_0x55d9(_0x2172bc,_0x12fe6b);}router[a0_0x24ad91(0x219)](a0_0x24ad91(0x296),auth,async(_0x28582c,_0x49eaba)=>{var _0x48fe71=a0_0x24ad91;try{const {username:_0x50df91,email:_0x306847,role:_0x456f8e}=_0x28582c[_0x48fe71(0x1f8)],_0x824181=_0x28582c['user'],_0xed19e0=await profile['findOne']({'email':_0x824181[_0x48fe71(0x1b3)]}),_0x2316e6=await master_shop[_0x48fe71(0x246)](),_0x59aca2=await customer[_0x48fe71(0x246)]({});let _0x1fa92f;if(_0x824181[_0x48fe71(0x2ad)]=='staff'){const _0x44912a=await staff['findOne']({'email':_0x824181[_0x48fe71(0x1b3)]});_0x1fa92f=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x44912a['warehouse'],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x48fe71(0x2a4)}}},{'$sort':{'name':0x1}}]);}else _0x1fa92f=await warehouse['aggregate']([{'$match':{'status':_0x48fe71(0x1f9),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x48fe71(0x1bd)}}},{'$group':{'_id':_0x48fe71(0x2a4),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x40ac29=await product[_0x48fe71(0x246)]({});var _0x2a1e15=[_0x48fe71(0x221),_0x48fe71(0x27e)];const _0x2df216=await sales_finished[_0x48fe71(0x246)]({}),_0x5da320=_0x2df216[_0x48fe71(0x1e8)]+0x1,_0x550abe=_0x48fe71(0x20c)+_0x5da320[_0x48fe71(0x28e)]()[_0x48fe71(0x22f)](0x5,'0');if(_0x2316e6[0x0][_0x48fe71(0x23f)]==_0x48fe71(0x247)){var _0x16c062=users[_0x48fe71(0x19c)];console[_0x48fe71(0x291)](_0x16c062);}else{if(_0x2316e6[0x0][_0x48fe71(0x23f)]==_0x48fe71(0x1bf))var _0x16c062=users[_0x48fe71(0x1bf)];else{if(_0x2316e6[0x0][_0x48fe71(0x23f)]==_0x48fe71(0x1ea))var _0x16c062=users[_0x48fe71(0x1ea)];else{if(_0x2316e6[0x0]['language']==_0x48fe71(0x20d))var _0x16c062=users[_0x48fe71(0x20d)];else{if(_0x2316e6[0x0][_0x48fe71(0x23f)]==_0x48fe71(0x25f))var _0x16c062=users[_0x48fe71(0x25f)];else{if(_0x2316e6[0x0]['language']==_0x48fe71(0x2a1))var _0x16c062=users[_0x48fe71(0x1a9)];else{if(_0x2316e6[0x0][_0x48fe71(0x23f)]==_0x48fe71(0x244))var _0x16c062=users[_0x48fe71(0x244)];else{if(_0x2316e6[0x0][_0x48fe71(0x23f)]=='Arabic\x20(ae)')var _0x16c062=users['Arabic'];}}}}}}}const _0x117e1e=getRandom8DigitNumber();_0x117e1e['then'](_0x446129=>{var _0x1eefc4=_0x48fe71;_0x49eaba[_0x1eefc4(0x231)](_0x1eefc4(0x1c3),{'success':_0x28582c[_0x1eefc4(0x233)](_0x1eefc4(0x223)),'errors':_0x28582c[_0x1eefc4(0x233)]('errors'),'role':_0x824181,'profile':_0xed19e0,'customer':_0x59aca2,'warehouse':_0x1fa92f,'product':_0x40ac29,'invoice':_0x446129,'master_shop':_0x2316e6,'language':_0x16c062,'rooms_data':_0x2a1e15});})[_0x48fe71(0x1ab)](_0xf57e6d=>{var _0x24fb54=_0x48fe71;_0x28582c[_0x24fb54(0x233)](_0x24fb54(0x289),_0x24fb54(0x212)),_0x49eaba[_0x24fb54(0x1dc)]('/all_sales_finished/view');});}catch(_0x5c958b){console[_0x48fe71(0x291)](_0x5c958b);}}),router[a0_0x24ad91(0x219)](a0_0x24ad91(0x29d),auth,async(_0xace9d5,_0x4da007)=>{var _0x1e0112=a0_0x24ad91;try{const _0x48adbf=_0xace9d5[_0x1e0112(0x25a)]['id'];console[_0x1e0112(0x291)](_0x48adbf);const _0x2ecf64=await product[_0x1e0112(0x246)](),_0x1a7ca8=await purchases['aggregate']([{'$match':{'warehouse_name':_0x48adbf}},{'$unwind':'$product'},{'$group':{'_id':_0x1e0112(0x26f)}}]);console[_0x1e0112(0x291)](_0x1e0112(0x281),_0x1a7ca8),_0x4da007[_0x1e0112(0x1e6)](0xc8)[_0x1e0112(0x1ec)]({'purchases_data':_0x1a7ca8,'product_data':_0x2ecf64});}catch(_0x1a350e){console[_0x1e0112(0x291)](_0x1a350e);}}),router[a0_0x24ad91(0x275)](a0_0x24ad91(0x265),auth,async(_0x43c2cf,_0x3cf81d)=>{var _0x195670=a0_0x24ad91;try{const {warehouse_data:_0x1f28a2,product_data:_0x21cf98}=_0x43c2cf['body'];console[_0x195670(0x291)](_0x43c2cf[_0x195670(0x202)][_0x195670(0x1f5)]);;const _0x3f3fc8=await master_shop['find']();console[_0x195670(0x291)]('master',_0x3f3fc8);const _0x698659=await product['findOne']({'name':_0x21cf98});console['log'](_0x195670(0x256),_0x698659);const _0x19763c=await warehouse[_0x195670(0x1b0)]([{'$match':{'name':_0x1f28a2}},{'$unwind':_0x195670(0x224)},{'$match':{'product_details.product_name':_0x21cf98}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x195670(0x237)}}}]);console[_0x195670(0x291)](_0x195670(0x1fb),_0x19763c),_0x3cf81d['status'](0xc8)[_0x195670(0x1ec)]({'master':_0x3f3fc8,'new_product':_0x698659,'stock_data':_0x19763c});}catch(_0x52799f){console[_0x195670(0x291)](_0x52799f);}}),router[a0_0x24ad91(0x275)](a0_0x24ad91(0x296),auth,async(_0x20504d,_0x3c7a06)=>{var _0x18a9b1=a0_0x24ad91;try{const {invoice:_0x1e7508,date:_0x4f3c94,warehouse_name:_0x53a9bb,product_name:_0x5166db,stock:_0x3ac490,quantity:_0x389b1e,note:_0x4355cd,room:_0x2db050,primary_code:_0x2c973b,secondary_code:_0x4248ad,prod_code:_0x4c288a,level:_0x5f0d24,isle:_0x2908d2,pallet:_0x6e9140,batch_code:_0x2934e4,SCRN:_0x26d56c,expiry_date:_0x4f9578,mode_transpo:_0x33e429,name_driver:_0x5bdef1}=_0x20504d[_0x18a9b1(0x202)];if(typeof _0x5166db==_0x18a9b1(0x239))var _0x24c1f8=[_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x1a4)]],_0x4bdc2e=[_0x20504d[_0x18a9b1(0x202)]['stock']],_0x3f4f08=[_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x269)]],_0x533aa0=[_0x20504d[_0x18a9b1(0x202)]['primary_code']],_0x352f32=[_0x20504d[_0x18a9b1(0x202)]['secondary_code']],_0x3bdfde=[_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x1bc)]],_0xb03dba=[_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x1ed)]],_0x4626fb=[_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x23e)]],_0x4998e8=[_0x20504d[_0x18a9b1(0x202)]['secondary_unit']],_0x492c4a=[_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x217)]],_0x38f1e8=[_0x20504d['body'][_0x18a9b1(0x1bb)]],_0x15b7cc=[_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x220)]],_0x38ece1=[_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x1c4)]],_0x11d297=[_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x267)]],_0x50ce50=[_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x248)]],_0x13e58e=[_0x20504d['body'][_0x18a9b1(0x1c2)]],_0x2e452b=[_0x20504d['body'][_0x18a9b1(0x1e9)]];else var _0x24c1f8=[..._0x20504d['body'][_0x18a9b1(0x1a4)]],_0x4bdc2e=[..._0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x27f)]],_0x3f4f08=[..._0x20504d['body'][_0x18a9b1(0x269)]],_0x533aa0=[..._0x20504d['body'][_0x18a9b1(0x1d5)]],_0x352f32=[..._0x20504d['body'][_0x18a9b1(0x1ff)]],_0x3bdfde=[..._0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x1bc)]],_0xb03dba=[..._0x20504d[_0x18a9b1(0x202)]['level']],_0x4626fb=[..._0x20504d[_0x18a9b1(0x202)]['primary_unit']],_0x4998e8=[..._0x20504d[_0x18a9b1(0x202)]['secondary_unit']],_0x492c4a=[..._0x20504d['body']['batch_code']],_0x38f1e8=[..._0x20504d['body'][_0x18a9b1(0x1bb)]],_0x15b7cc=[..._0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x220)]],_0x38ece1=[..._0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x1c4)]],_0x11d297=[..._0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x267)]],_0x50ce50=[..._0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x248)]],_0x13e58e=[..._0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x1c2)]],_0x2e452b=[..._0x20504d['body']['id_transaction_from']];const _0x4bcd17=_0x24c1f8['map'](_0x5cf271=>{return _0x5cf271={'product_name':_0x5cf271};});_0x4bdc2e[_0x18a9b1(0x1e7)]((_0x5ba2fc,_0x468811)=>{var _0x52e3ef=_0x18a9b1;_0x4bcd17[_0x468811][_0x52e3ef(0x27f)]=_0x5ba2fc;}),_0x3f4f08[_0x18a9b1(0x1e7)]((_0x424646,_0x1615c5)=>{var _0x8a3988=_0x18a9b1;_0x4bcd17[_0x1615c5][_0x8a3988(0x1af)]=Math[_0x8a3988(0x21b)](_0x424646);}),_0x2e452b['forEach']((_0x263045,_0x126413)=>{var _0x3ac9ef=_0x18a9b1;_0x4bcd17[_0x126413][_0x3ac9ef(0x1e9)]=_0x263045;}),_0x533aa0['forEach']((_0x1027ac,_0x1403cf)=>{var _0x13213d=_0x18a9b1;_0x4bcd17[_0x1403cf][_0x13213d(0x1d5)]=_0x1027ac;}),_0x352f32[_0x18a9b1(0x1e7)]((_0x255bf3,_0x11232c)=>{var _0x5e0694=_0x18a9b1;_0x4bcd17[_0x11232c][_0x5e0694(0x1ff)]=_0x255bf3;}),_0x3bdfde[_0x18a9b1(0x1e7)]((_0x39b659,_0x3081af)=>{_0x4bcd17[_0x3081af]['product_code']=_0x39b659;}),_0xb03dba[_0x18a9b1(0x1e7)]((_0x575eb3,_0x1b9892)=>{var _0x3736ab=_0x18a9b1;_0x4bcd17[_0x1b9892][_0x3736ab(0x1aa)]=_0x575eb3;}),_0x4626fb[_0x18a9b1(0x1e7)]((_0x3729b4,_0x3f45d4)=>{var _0xab4ba8=_0x18a9b1;_0x4bcd17[_0x3f45d4][_0xab4ba8(0x21e)]=_0x3729b4;}),_0x4998e8[_0x18a9b1(0x1e7)]((_0x236eaa,_0x4e4d4d)=>{_0x4bcd17[_0x4e4d4d]['secondary_unit']=_0x236eaa;}),_0x492c4a['forEach']((_0x19d441,_0x45d25d)=>{var _0xd45cde=_0x18a9b1;_0x4bcd17[_0x45d25d][_0xd45cde(0x217)]=_0x19d441;}),_0x38f1e8[_0x18a9b1(0x1e7)]((_0x4cc212,_0x122472)=>{var _0x42c091=_0x18a9b1;_0x4bcd17[_0x122472][_0x42c091(0x1bb)]=_0x4cc212;}),_0x15b7cc[_0x18a9b1(0x1e7)]((_0x208843,_0x1a126f)=>{var _0x448382=_0x18a9b1;_0x4bcd17[_0x1a126f][_0x448382(0x28d)]=_0x208843;}),_0x38ece1['forEach']((_0x1f21e0,_0x24dfdc)=>{var _0x2884fa=_0x18a9b1;_0x4bcd17[_0x24dfdc][_0x2884fa(0x1ca)]=_0x1f21e0;}),_0x11d297[_0x18a9b1(0x1e7)]((_0x39ee57,_0x51f273)=>{var _0x3dadbf=_0x18a9b1;_0x4bcd17[_0x51f273][_0x3dadbf(0x267)]=_0x39ee57;}),_0x50ce50[_0x18a9b1(0x1e7)]((_0x329df9,_0x3cf139)=>{_0x4bcd17[_0x3cf139]['room_name']=_0x329df9;}),_0x13e58e[_0x18a9b1(0x1e7)]((_0x189384,_0x2621d8)=>{_0x4bcd17[_0x2621d8]['invoice']=_0x189384;});var _0x4f5f68=0x0;_0x4bcd17[_0x18a9b1(0x1e7)](_0x356c86=>{var _0x51a82a=_0x18a9b1;parseFloat(_0x356c86[_0x51a82a(0x27f)])<parseFloat(_0x356c86[_0x51a82a(0x1af)])&&parseFloat(_0x356c86['quantity'])>parseFloat(_0x356c86[_0x51a82a(0x27f)])&&(console[_0x51a82a(0x291)](_0x356c86['stock']+_0x51a82a(0x1b4)+_0x356c86['quantity']),_0x4f5f68++);});if(_0x4f5f68!=0x0)return _0x20504d[_0x18a9b1(0x233)](_0x18a9b1(0x289),_0x18a9b1(0x276)),_0x3c7a06[_0x18a9b1(0x1dc)](_0x18a9b1(0x19e));const _0x28d8ec=_0x4bcd17[_0x18a9b1(0x1f0)](_0x2ca578=>_0x2ca578[_0x18a9b1(0x1af)]!=='0'&&_0x2ca578['quantity']!==''),_0x45981b=new sales_finished({'invoice':_0x1e7508,'customer':_0x20504d['body'][_0x18a9b1(0x22b)],'date':_0x4f3c94,'warehouse_name':_0x53a9bb,'sale_product':_0x28d8ec,'note':_0x4355cd,'room':_0x2db050,'primary_code':_0x2c973b,'secondary_code':_0x4248ad,'prod_code':_0x4c288a,'SCRN':_0x26d56c,'finalize':_0x18a9b1(0x241),'mode_transpo':_0x33e429,'name_driver':_0x5bdef1}),_0x5d3f02=await _0x45981b['save'](),_0x4149fe=await sales_finished[_0x18a9b1(0x295)]({'invoice':_0x1e7508}),_0x34bb38=new c_payment_data({'invoice':_0x1e7508,'customer':_0x20504d[_0x18a9b1(0x202)][_0x18a9b1(0x22b)],'reason':_0x18a9b1(0x253)});await _0x34bb38[_0x18a9b1(0x226)]();const _0x254b9a=await master_shop[_0x18a9b1(0x246)](),_0x528300=await email_settings['findOne'](),_0x310a41=await customer['findOne']({'name':_0x20504d[_0x18a9b1(0x202)]['customer']});_0x254b9a[0x0][_0x18a9b1(0x2b1)]==0x1?(right_currency=_0x254b9a[0x0][_0x18a9b1(0x1ad)],left_currency=''):(right_currency='',left_currency=_0x254b9a[0x0]['currency']);var _0x9895d6=_0x24c1f8,_0x6a2b21=_0x3f4f08,_0x22cf6e='',_0x12cb5b;for(_0x12cb5b in _0x9895d6){_0x22cf6e+=_0x18a9b1(0x2ac)+_0x18a9b1(0x1e0)+_0x9895d6[_0x12cb5b]+_0x18a9b1(0x293)+_0x18a9b1(0x1e0)+_0x6a2b21[_0x12cb5b]+_0x18a9b1(0x293)+_0x18a9b1(0x1ef);}console[_0x18a9b1(0x291)]('product_list',_0x22cf6e);let _0x3acdf7=nodemailer[_0x18a9b1(0x19f)]({'host':_0x528300[_0x18a9b1(0x273)],'port':Number(_0x528300[_0x18a9b1(0x20e)]),'secure':![],'service':'gmail','auth':{'user':_0x528300[_0x18a9b1(0x1b3)],'pass':_0x528300[_0x18a9b1(0x1a2)]}}),_0x40738f={'from':_0x528300[_0x18a9b1(0x1b3)],'to':_0x18a9b1(0x298),'subject':'Add\x20Sales','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x254b9a[0x0]['image'],'cid':_0x18a9b1(0x250)}],'html':_0x18a9b1(0x200)};_0x3acdf7[_0x18a9b1(0x1cc)](_0x40738f,function(_0x4d143c,_0x2e6649){var _0xabc203=_0x18a9b1;_0x4d143c?(console[_0xabc203(0x291)](_0x4d143c),console[_0xabc203(0x291)](_0xabc203(0x1d8))):console[_0xabc203(0x291)]('Email\x20sent\x20successfully');}),_0x20504d[_0x18a9b1(0x233)](_0x18a9b1(0x223),_0x18a9b1(0x204)),_0x3c7a06[_0x18a9b1(0x1dc)](_0x18a9b1(0x278)+_0x5d3f02[_0x18a9b1(0x26c)]);}catch(_0x1b6cc3){console[_0x18a9b1(0x291)](_0x1b6cc3);}}),router['get'](a0_0x24ad91(0x1d6),auth,async(_0xd248a5,_0x45eb5e)=>{var _0x3c284c=a0_0x24ad91;try{const {username:_0x156273,email:_0x5af50c,role:_0x11c9b2}=_0xd248a5['user'],_0x5b9507=_0xd248a5['user'],_0x8a0d3a=await profile[_0x3c284c(0x295)]({'email':_0x5b9507[_0x3c284c(0x1b3)]}),_0x57bef2=await master_shop[_0x3c284c(0x246)](),_0xf4cd43=_0xd248a5[_0x3c284c(0x25a)]['id'],_0x15f980=await sales_finished[_0x3c284c(0x1d1)](_0xf4cd43),_0x30599f=await warehouse['aggregate']([{'$match':{'name':_0x15f980[_0x3c284c(0x1be)]}},{'$unwind':_0x3c284c(0x224)},{'$group':{'_id':_0x3c284c(0x227),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3c284c(0x237)},'bay':{'$first':_0x3c284c(0x1b1)},'bin':{'$first':_0x3c284c(0x208)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3c284c(0x1c6)},'primary_code':{'$first':_0x3c284c(0x270)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3c284c(0x26d)},'storage':{'$first':_0x3c284c(0x1fa)},'rack':{'$first':_0x3c284c(0x245)},'expiry_date':{'$first':_0x3c284c(0x27d)},'production_date':{'$first':_0x3c284c(0x279)},'batch_code':{'$first':_0x3c284c(0x284)},'room':{'$first':_0x3c284c(0x1a3)},'room_data':{'$first':_0x3c284c(0x26b)}}}]),_0x1c0e13=await customer[_0x3c284c(0x246)]({});let _0x2fd0ce;if(_0x5b9507[_0x3c284c(0x2ad)]==_0x3c284c(0x29a)){const _0x2dc53f=await staff['findOne']({'email':_0x5b9507[_0x3c284c(0x1b3)]});_0x2fd0ce=await warehouse[_0x3c284c(0x1b0)]([{'$match':{'status':_0x3c284c(0x1f9),'name':_0x2dc53f[_0x3c284c(0x19b)]}},{'$group':{'_id':'$name','name':{'$first':_0x3c284c(0x2a4)}}}]);}else _0x2fd0ce=await warehouse[_0x3c284c(0x1b0)]([{'$match':{'status':_0x3c284c(0x1f9)}},{'$group':{'_id':_0x3c284c(0x2a4),'name':{'$first':'$name'}}}]);const _0x3f5d26=await product['find']({});if(_0x57bef2[0x0][_0x3c284c(0x23f)]==_0x3c284c(0x247)){var _0x875b78=users[_0x3c284c(0x19c)];console[_0x3c284c(0x291)](_0x875b78);}else{if(_0x57bef2[0x0]['language']==_0x3c284c(0x1bf))var _0x875b78=users[_0x3c284c(0x1bf)];else{if(_0x57bef2[0x0][_0x3c284c(0x23f)]==_0x3c284c(0x1ea))var _0x875b78=users[_0x3c284c(0x1ea)];else{if(_0x57bef2[0x0]['language']==_0x3c284c(0x20d))var _0x875b78=users[_0x3c284c(0x20d)];else{if(_0x57bef2[0x0]['language']=='French')var _0x875b78=users[_0x3c284c(0x25f)];else{if(_0x57bef2[0x0]['language']==_0x3c284c(0x2a1))var _0x875b78=users['Portuguese'];else{if(_0x57bef2[0x0][_0x3c284c(0x23f)]=='Chinese')var _0x875b78=users[_0x3c284c(0x244)];else{if(_0x57bef2[0x0][_0x3c284c(0x23f)]==_0x3c284c(0x28a))var _0x875b78=users[_0x3c284c(0x2b3)];}}}}}}}_0x45eb5e[_0x3c284c(0x231)](_0x3c284c(0x2a5),{'success':_0xd248a5[_0x3c284c(0x233)]('success'),'errors':_0xd248a5[_0x3c284c(0x233)](_0x3c284c(0x289)),'role':_0x5b9507,'profile':_0x8a0d3a,'customer':_0x1c0e13,'warehouse':_0x2fd0ce,'product':_0x30599f,'user':_0x15f980,'master_shop':_0x57bef2,'unit':_0x3f5d26,'language':_0x875b78});}catch(_0x450d74){console[_0x3c284c(0x291)](_0x450d74);}}),router[a0_0x24ad91(0x275)](a0_0x24ad91(0x1d6),auth,async(_0x2d9492,_0x32faf1)=>{var _0x3974ea=a0_0x24ad91;try{const _0x296270=_0x2d9492['params']['id'],{invoice:_0x4a2956,warehouse_name:_0x4e0032,room:_0x31c5af}=_0x2d9492[_0x3974ea(0x202)],_0x3ecbea=await sales_finished['findOne']({'invoice':_0x4a2956}),_0x1ccde1=_0x3ecbea[_0x3974ea(0x240)][_0x3974ea(0x25d)](async _0x345e9c=>{var _0x2c3877=_0x3974ea,_0x471bb0=await warehouse[_0x2c3877(0x295)]({'name':_0x4e0032,'room':_0x345e9c[_0x2c3877(0x1f1)],'warehouse_category':_0x2c3877(0x24d)});const _0x2d2286=_0x471bb0[_0x2c3877(0x1ba)][_0x2c3877(0x25d)](_0x541444=>{var _0x12baad=_0x2c3877;_0x541444[_0x12baad(0x1a4)]==_0x345e9c['product_name']&&_0x541444[_0x12baad(0x1aa)]==_0x345e9c[_0x12baad(0x1aa)]&&_0x541444[_0x12baad(0x1bb)]==_0x345e9c[_0x12baad(0x1bb)]&&_0x541444[_0x12baad(0x28d)]==_0x345e9c['production_date']&&_0x541444[_0x12baad(0x217)]==_0x345e9c[_0x12baad(0x217)]&&_0x541444[_0x12baad(0x26c)]==_0x345e9c[_0x12baad(0x1e9)]&&(_0x541444[_0x12baad(0x2a2)]>0x0&&(console[_0x12baad(0x291)](_0x541444[_0x12baad(0x1a4)]+_0x12baad(0x25c)+_0x345e9c[_0x12baad(0x1a4)]+_0x12baad(0x22a)+_0x541444['bay']+_0x12baad(0x25c)+_0x345e9c[_0x12baad(0x1aa)]+_0x12baad(0x22a)+_0x541444['production_date']+_0x12baad(0x25c)+_0x345e9c['production_date']+_0x12baad(0x22a)+_0x541444[_0x12baad(0x1bb)]+_0x12baad(0x25c)+_0x345e9c[_0x12baad(0x1bb)]+_0x12baad(0x22a)+_0x541444['batch_code']+_0x12baad(0x25c)+_0x345e9c[_0x12baad(0x217)]+_0x12baad(0x22a)+_0x541444[_0x12baad(0x201)]+_0x12baad(0x25c)+_0x345e9c[_0x12baad(0x201)]+'\x20&&\x20'+_0x541444[_0x12baad(0x2a2)]+_0x12baad(0x234)+_0x345e9c[_0x12baad(0x1af)]+'\x20>>>\x20'+_0x345e9c['room_name']+_0x12baad(0x22a)+_0x541444[_0x12baad(0x26c)]+_0x12baad(0x25c)+_0x345e9c[_0x12baad(0x1e9)]),_0x541444[_0x12baad(0x2a2)]=Math['max'](0x0,Math[_0x12baad(0x21b)](_0x541444[_0x12baad(0x2a2)])-Math[_0x12baad(0x21b)](_0x345e9c[_0x12baad(0x1af)]))));});return _0x471bb0;});Promise['all'](_0x1ccde1)['then'](async _0x2f8a01=>{var _0x1df3ae=_0x3974ea;try{for(const _0x1a9eae of _0x2f8a01){await _0x1a9eae[_0x1df3ae(0x226)]();}_0x3ecbea['finalize']='True';const _0x5ca649=await _0x3ecbea[_0x1df3ae(0x226)](),_0x27ce2a=await master_shop[_0x1df3ae(0x246)](),_0x3efe64=await email_settings[_0x1df3ae(0x295)](),_0x12b725=await supervisor_settings[_0x1df3ae(0x246)]();var _0x3d93ed=_0x3ecbea[_0x1df3ae(0x240)],_0x2310f1='',_0x2a753a;for(_0x2a753a in _0x3d93ed){var _0x425004='FG';_0x3ecbea[_0x1df3ae(0x1be)]=='DRY\x20GOODS'&&(_0x425004='DG'),_0x2310f1+=_0x1df3ae(0x2ac)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d93ed[_0x2a753a][_0x1df3ae(0x1a4)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d93ed[_0x2a753a][_0x1df3ae(0x23b)]+_0x1df3ae(0x293)+_0x1df3ae(0x1e0)+_0x3d93ed[_0x2a753a][_0x1df3ae(0x1af)]+_0x1df3ae(0x293)+_0x1df3ae(0x1e0)+_0x3d93ed[_0x2a753a][_0x1df3ae(0x21e)]+_0x1df3ae(0x293)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d93ed[_0x2a753a][_0x1df3ae(0x29e)]+_0x1df3ae(0x293)+_0x1df3ae(0x1e0)+_0x3ecbea[_0x1df3ae(0x1be)]+_0x1df3ae(0x293)+_0x1df3ae(0x1e0)+_0x3d93ed[_0x2a753a]['room_name']+_0x1df3ae(0x293)+_0x1df3ae(0x1e0)+_0x425004+_0x3d93ed[_0x2a753a]['bay']+_0x1df3ae(0x293);}let _0x3f44ba=nodemailer[_0x1df3ae(0x19f)]({'host':_0x3efe64['host'],'port':Number(_0x3efe64[_0x1df3ae(0x20e)]),'secure':![],'auth':{'user':_0x3efe64['email'],'pass':_0x3efe64[_0x1df3ae(0x1a2)]}}),_0x57a05f={'from':_0x3efe64[_0x1df3ae(0x1b3)],'to':_0x12b725[0x0][_0x1df3ae(0x251)],'subject':_0x1df3ae(0x1b9),'attachments':[{'filename':_0x1df3ae(0x19d),'path':__dirname+_0x1df3ae(0x24f)+_0x1df3ae(0x1b6)+_0x27ce2a[0x0][_0x1df3ae(0x23a)],'cid':_0x1df3ae(0x250)}],'html':_0x1df3ae(0x28b)+'<html><head><title></title>'+_0x1df3ae(0x1f6)+_0x1df3ae(0x225)+_0x1df3ae(0x264)+'<div>'+_0x1df3ae(0x1ee)+_0x1df3ae(0x25e)+_0x1df3ae(0x225)+_0x1df3ae(0x1b7)+_0x27ce2a[0x0][_0x1df3ae(0x1a6)]+_0x1df3ae(0x266)+_0x1df3ae(0x25e)+_0x1df3ae(0x25e)+_0x1df3ae(0x230)+_0x1df3ae(0x225)+_0x1df3ae(0x1da)+_0x1df3ae(0x22e)+_0x3ecbea[_0x1df3ae(0x201)]+'\x20'+_0x1df3ae(0x228)+_0x1df3ae(0x1fc)+_0x3ecbea['date']+'\x20'+_0x1df3ae(0x1d7)+'</h5>'+_0x1df3ae(0x25e)+_0x1df3ae(0x236)+_0x1df3ae(0x1cf)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1df3ae(0x299)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x1df3ae(0x2ab)+_0x1df3ae(0x1d4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x1df3ae(0x27a)+_0x1df3ae(0x1ef)+_0x1df3ae(0x216)+_0x1df3ae(0x1e5)+'\x20'+_0x2310f1+'\x20'+_0x1df3ae(0x268)+_0x1df3ae(0x274)+'<div>'+_0x1df3ae(0x1a7)+_0x1df3ae(0x1eb)+_0x27ce2a[0x0][_0x1df3ae(0x1a6)]+'</h5>'+_0x1df3ae(0x25e)+_0x1df3ae(0x25e)+_0x1df3ae(0x1ce)};_0x3f44ba[_0x1df3ae(0x1cc)](_0x57a05f,function(_0x2165cd,_0x507c9d){var _0x258ebc=_0x1df3ae;_0x2165cd?(console[_0x258ebc(0x291)](_0x2165cd),console[_0x258ebc(0x291)](_0x258ebc(0x1d8))):console[_0x258ebc(0x291)]('Email\x20sent\x20successfully');}),_0x2d9492[_0x1df3ae(0x233)]('success','Sales\x20Update\x20successfully'),_0x32faf1[_0x1df3ae(0x1dc)]('/picking_list/pdf/'+_0x296270);}catch(_0x4ee7c0){console[_0x1df3ae(0x260)](_0x4ee7c0),_0x32faf1[_0x1df3ae(0x1e6)](0x1f4)[_0x1df3ae(0x1ec)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x4b16f6=>{var _0x412089=_0x3974ea;console[_0x412089(0x260)](_0x4b16f6),_0x32faf1['status'](0x1f4)['json']({'error':_0x412089(0x22d)});});}catch(_0xc9a7b5){console[_0x3974ea(0x291)](_0xc9a7b5);}}),router[a0_0x24ad91(0x219)](a0_0x24ad91(0x2a8),auth,async(_0x31445b,_0x49ba6a)=>{var _0x47ce42=a0_0x24ad91;try{const {username:_0x5b8159,email:_0x45a0e2,role:_0x1ba7ad}=_0x31445b[_0x47ce42(0x1f8)],_0x13a3ba=_0x31445b['user'],_0x1c33e6=await profile[_0x47ce42(0x295)]({'email':_0x13a3ba[_0x47ce42(0x1b3)]}),_0xcbdd16=await master_shop['find'](),_0x2d3619=_0x31445b[_0x47ce42(0x25a)]['id'],_0x24cbbe=await sales_finished['findById'](_0x2d3619);let _0x6d64c9=new Date(_0x24cbbe[_0x47ce42(0x1bb)]),_0x780517=('0'+_0x6d64c9[_0x47ce42(0x1c7)]())[_0x47ce42(0x1f4)](-0x2),_0x3771bf=('0'+(_0x6d64c9[_0x47ce42(0x1d2)]()+0x1))[_0x47ce42(0x1f4)](-0x2),_0x21a609=_0x6d64c9[_0x47ce42(0x21a)](),_0x9f678=_0x21a609+'-'+_0x3771bf+'-'+_0x780517;var _0x62c9b1=[_0x47ce42(0x221),_0x47ce42(0x27e)];const _0x2ad251=await warehouse[_0x47ce42(0x1b0)]([{'$match':{'name':_0x24cbbe[_0x47ce42(0x1be)],'room':_0x24cbbe[_0x47ce42(0x26a)]}},{'$unwind':_0x47ce42(0x224)},{'$group':{'_id':_0x47ce42(0x227),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x47ce42(0x1b1)},'bin':{'$first':_0x47ce42(0x208)},'type':{'$first':_0x47ce42(0x1f2)},'floorlevel':{'$first':_0x47ce42(0x1c6)},'primary_code':{'$first':_0x47ce42(0x270)},'secondary_code':{'$first':_0x47ce42(0x21d)},'product_code':{'$first':_0x47ce42(0x26d)},'storage':{'$first':_0x47ce42(0x1fa)},'rack':{'$first':_0x47ce42(0x245)}}}]),_0x2965ef=await customer['find']({});let _0x43e65b;if(_0x13a3ba[_0x47ce42(0x2ad)]==_0x47ce42(0x29a)){const _0x39fe8e=await staff[_0x47ce42(0x295)]({'email':_0x13a3ba[_0x47ce42(0x1b3)]});_0x43e65b=await warehouse[_0x47ce42(0x1b0)]([{'$match':{'status':_0x47ce42(0x1f9),'name':_0x39fe8e['warehouse']}},{'$group':{'_id':_0x47ce42(0x2a4),'name':{'$first':_0x47ce42(0x2a4)}}}]);}else _0x43e65b=await warehouse[_0x47ce42(0x1b0)]([{'$match':{'status':_0x47ce42(0x1f9)}},{'$group':{'_id':'$name','name':{'$first':_0x47ce42(0x2a4)}}}]);const _0x5703a6=await product[_0x47ce42(0x246)]({});if(_0xcbdd16[0x0][_0x47ce42(0x23f)]==_0x47ce42(0x247)){var _0xf480a4=users['English'];console[_0x47ce42(0x291)](_0xf480a4);}else{if(_0xcbdd16[0x0][_0x47ce42(0x23f)]==_0x47ce42(0x1bf))var _0xf480a4=users[_0x47ce42(0x1bf)];else{if(_0xcbdd16[0x0][_0x47ce42(0x23f)]=='German')var _0xf480a4=users['German'];else{if(_0xcbdd16[0x0]['language']==_0x47ce42(0x20d))var _0xf480a4=users[_0x47ce42(0x20d)];else{if(_0xcbdd16[0x0][_0x47ce42(0x23f)]=='French')var _0xf480a4=users[_0x47ce42(0x25f)];else{if(_0xcbdd16[0x0]['language']==_0x47ce42(0x2a1))var _0xf480a4=users[_0x47ce42(0x1a9)];else{if(_0xcbdd16[0x0][_0x47ce42(0x23f)]==_0x47ce42(0x244))var _0xf480a4=users[_0x47ce42(0x244)];else{if(_0xcbdd16[0x0][_0x47ce42(0x23f)]==_0x47ce42(0x28a))var _0xf480a4=users['Arabic'];}}}}}}}_0x49ba6a[_0x47ce42(0x231)](_0x47ce42(0x1dd),{'success':_0x31445b[_0x47ce42(0x233)](_0x47ce42(0x223)),'errors':_0x31445b[_0x47ce42(0x233)]('errors'),'role':_0x13a3ba,'profile':_0x1c33e6,'customer':_0x2965ef,'warehouse':_0x43e65b,'product':_0x2ad251,'user':_0x24cbbe,'master_shop':_0xcbdd16,'unit':_0x5703a6,'language':_0xf480a4,'rooms_data':_0x62c9b1,'ed_fullDate':_0x9f678});}catch(_0x36ac0b){console[_0x47ce42(0x291)](_0x36ac0b);}}),router[a0_0x24ad91(0x275)](a0_0x24ad91(0x2a8),auth,async(_0x341541,_0x3258b9)=>{var _0x29fdb5=a0_0x24ad91;try{const _0x87b5c5=_0x341541[_0x29fdb5(0x25a)]['id'],_0x375f07=await sales_finished[_0x29fdb5(0x295)]({'_id':_0x341541[_0x29fdb5(0x25a)]['id']}),_0x4033f5=await warehouse[_0x29fdb5(0x295)]({'name':_0x375f07[_0x29fdb5(0x1be)],'room':_0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x26a)],'warehouse_category':_0x29fdb5(0x24d)}),{invoice:_0x1dfa13,customer:_0x2004c9,date:_0x3957b8,warehouse_name:_0x2dba7d,product_name:_0x1eb9c3,stock:_0x342914,adjust_qty:_0x486208,note:_0x16508d,room:_0x525848,primary_code:_0x34484b,secondary_code:_0x546459,prod_code:_0x52e1d9,level:_0x45d07c,isle:_0x17318a,pallet:_0x6c6f53,expiry_date:_0x2f5155}=_0x341541[_0x29fdb5(0x202)];if(typeof _0x1eb9c3==_0x29fdb5(0x239))var _0x5027e4=[_0x341541['body'][_0x29fdb5(0x1a4)]],_0xd1ad3c=[_0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x27f)]],_0x31e338=[_0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x24c)]],_0xa7437=[_0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x1d5)]],_0x4f7a4b=[_0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x1ff)]],_0x47b147=[_0x341541['body']['prod_code']],_0x4321ed=[_0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x1ed)]],_0x26db84=[_0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x1bb)]];else var _0x5027e4=[..._0x341541[_0x29fdb5(0x202)]['product_name']],_0xd1ad3c=[..._0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x27f)]],_0x31e338=[..._0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x24c)]],_0xa7437=[..._0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x1d5)]],_0x4f7a4b=[..._0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x1ff)]],_0x47b147=[..._0x341541['body']['prod_code']],_0x4321ed=[..._0x341541[_0x29fdb5(0x202)]['level']],_0x26db84=[..._0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x1bb)]];const _0x20c034=_0x5027e4[_0x29fdb5(0x25d)](_0x517b54=>{return _0x517b54={'product_name':_0x517b54};});_0xd1ad3c['forEach']((_0x44b33b,_0x14292b)=>{var _0x262c41=_0x29fdb5;_0x20c034[_0x14292b][_0x262c41(0x27f)]=_0x44b33b;}),_0x31e338[_0x29fdb5(0x1e7)]((_0x3a0546,_0x209caf)=>{var _0x2b49bf=_0x29fdb5;_0x20c034[_0x209caf][_0x2b49bf(0x1af)]=_0x3a0546;}),_0xa7437['forEach']((_0x421124,_0x2f969e)=>{var _0x5abf77=_0x29fdb5;_0x20c034[_0x2f969e][_0x5abf77(0x1d5)]=_0x421124;}),_0x4f7a4b[_0x29fdb5(0x1e7)]((_0xa99e31,_0x33cbfd)=>{_0x20c034[_0x33cbfd]['secondary_code']=_0xa99e31;}),_0x47b147[_0x29fdb5(0x1e7)]((_0x2cb011,_0x57f627)=>{var _0x407654=_0x29fdb5;_0x20c034[_0x57f627][_0x407654(0x23b)]=_0x2cb011;}),_0x4321ed[_0x29fdb5(0x1e7)]((_0xc963bb,_0x2db914)=>{var _0x33f6ec=_0x29fdb5;_0x20c034[_0x2db914][_0x33f6ec(0x1ed)]=_0xc963bb;}),_0x26db84[_0x29fdb5(0x1e7)]((_0x50a4ec,_0x63fce2)=>{_0x20c034[_0x63fce2]['expiry_date']=_0x50a4ec;});var _0x456afc=0x0;_0x20c034[_0x29fdb5(0x1e7)](_0x2faf11=>{var _0x35523c=_0x29fdb5;console['log'](_0x35523c(0x24b),_0x2faf11),(parseInt(_0x2faf11['stock'])<parseInt(_0x2faf11['quantity'])||parseInt(_0x2faf11[_0x35523c(0x1af)])==0x0)&&_0x456afc++;});if(_0x456afc!=0x0)return _0x341541[_0x29fdb5(0x233)](_0x29fdb5(0x289),_0x29fdb5(0x20f)),_0x3258b9['redirect'](_0x29fdb5(0x19e));_0x375f07['sale_product'][_0x29fdb5(0x1e7)](_0x353a73=>{var _0x4f286a=_0x29fdb5;const _0x38e486=_0x4033f5[_0x4f286a(0x1ba)][_0x4f286a(0x25d)](_0x5460c2=>{var _0x4d8e4a=_0x4f286a;_0x5460c2[_0x4d8e4a(0x1a4)]==_0x353a73[_0x4d8e4a(0x1a4)]&&_0x5460c2[_0x4d8e4a(0x1aa)]==_0x353a73[_0x4d8e4a(0x1aa)]&&(_0x5460c2[_0x4d8e4a(0x2a2)]=parseInt(_0x5460c2[_0x4d8e4a(0x2a2)])+parseInt(_0x353a73[_0x4d8e4a(0x1af)]));});}),await _0x4033f5[_0x29fdb5(0x226)]();const _0x110c39=_0x20c034[_0x29fdb5(0x1f0)](_0x3a83c5=>_0x3a83c5['quantity']!=='0'&&_0x3a83c5[_0x29fdb5(0x1af)]!=='');_0x375f07[_0x29fdb5(0x201)]=_0x1dfa13,_0x375f07['customer']=_0x2004c9,_0x375f07['date']=_0x3957b8,_0x375f07['warehouse_name']=_0x2dba7d,_0x375f07[_0x29fdb5(0x240)]=_0x110c39,_0x375f07['note']=_0x16508d,_0x375f07[_0x29fdb5(0x26a)]=_0x525848;const _0x26ae84=await _0x375f07[_0x29fdb5(0x226)](),_0x5b6581=await sales_finished[_0x29fdb5(0x295)]({'_id':_0x341541[_0x29fdb5(0x25a)]['id']}),_0x36ad05=await warehouse['findOne']({'name':_0x2dba7d,'room':_0x525848,'warehouse_category':_0x29fdb5(0x24d)});_0x5b6581[_0x29fdb5(0x240)]['forEach'](_0x36eb38=>{const _0x58dace=_0x36ad05['product_details']['map'](_0x265db7=>{var _0x4867f9=a0_0x55d9;_0x265db7[_0x4867f9(0x1a4)]==_0x36eb38['product_name']&&_0x265db7['bay']==_0x36eb38[_0x4867f9(0x1aa)]&&(_0x265db7['product_stock']=parseInt(_0x265db7[_0x4867f9(0x2a2)])-parseInt(_0x36eb38[_0x4867f9(0x1af)]));});}),console[_0x29fdb5(0x291)](_0x29fdb5(0x2a3),_0x36ad05),await _0x36ad05[_0x29fdb5(0x226)]();const _0x914e38=await c_payment_data['findOne']({'invoice':_0x341541[_0x29fdb5(0x202)][_0x29fdb5(0x201)]});_0x914e38['suppliers']=_0x341541[_0x29fdb5(0x202)]['suppliers'],await _0x914e38['save'](),_0x341541['flash'](_0x29fdb5(0x223),'Sales\x20Update\x20successfully'),_0x3258b9[_0x29fdb5(0x1dc)](_0x29fdb5(0x209));}catch(_0x4f03de){console[_0x29fdb5(0x291)](_0x4f03de);}}),router[a0_0x24ad91(0x275)]('/give_payment/:id',auth,async(_0x3af959,_0x320240)=>{var _0x3ab8dd=a0_0x24ad91;try{const _0x92d87c=_0x3af959[_0x3ab8dd(0x25a)]['id'],{invoice:_0x4a9193,customer:_0x4e6bd0,receivable_amount:_0x57a426,received_amount:_0x25edb8}=_0x3af959[_0x3ab8dd(0x202)],_0x2516f1=await sales[_0x3ab8dd(0x1d1)](_0x92d87c);console[_0x3ab8dd(0x291)](_0x2516f1);var _0x13819c=_0x57a426-_0x25edb8;console[_0x3ab8dd(0x291)](_0x25edb8),_0x2516f1[_0x3ab8dd(0x206)]=parseFloat(_0x25edb8)+parseFloat(_0x2516f1['received_amount']),_0x2516f1[_0x3ab8dd(0x1e1)]=_0x13819c,console[_0x3ab8dd(0x291)](_0x2516f1);const _0x465e6b=await _0x2516f1[_0x3ab8dd(0x226)](),_0x39bbd8=await c_payment_data[_0x3ab8dd(0x295)]({'invoice':_0x4a9193});_0x39bbd8['amount']=_0x13819c,await _0x39bbd8[_0x3ab8dd(0x226)]();let _0xcbdc0a=new Date(),_0xbb6625=('0'+_0xcbdc0a[_0x3ab8dd(0x1c7)]())[_0x3ab8dd(0x1f4)](-0x2),_0x37e57e=('0'+(_0xcbdc0a[_0x3ab8dd(0x1d2)]()+0x1))[_0x3ab8dd(0x1f4)](-0x2),_0x5f25ab=_0xcbdc0a[_0x3ab8dd(0x21a)](),_0x24ce70=_0x5f25ab+'-'+_0x37e57e+'-'+_0xbb6625;const _0x412956=new customer_payment({'invoice':_0x4a9193,'date':_0x5f25ab+'-'+_0x37e57e+'-'+_0xbb6625,'customer':_0x4e6bd0,'reason':_0x3ab8dd(0x1e4),'amount':_0x25edb8}),_0x2b8245=await _0x412956['save']();_0x3af959['flash']('success',_0x3ab8dd(0x1cd)),_0x320240[_0x3ab8dd(0x1dc)](_0x3ab8dd(0x1e2));}catch(_0x294aa1){console[_0x3ab8dd(0x291)](_0x294aa1);}}),router[a0_0x24ad91(0x219)](a0_0x24ad91(0x1ae),auth,async(_0x564a06,_0x3eb0aa)=>{var _0x12cbb7=a0_0x24ad91;try{const {username:_0x2ae08e,email:_0x11447e,role:_0x4ad766}=_0x564a06[_0x12cbb7(0x1f8)],_0x278283=_0x564a06['user'],_0x4e8ce7=await profile['findOne']({'email':_0x278283[_0x12cbb7(0x1b3)]}),_0x35c260=await master_shop[_0x12cbb7(0x246)]();console[_0x12cbb7(0x291)](_0x12cbb7(0x1d3),_0x35c260);const _0x5191c4=_0x564a06['params']['id'],_0x36f910=await sales[_0x12cbb7(0x1d1)](_0x5191c4);console[_0x12cbb7(0x291)](_0x36f910);const _0x1bcb54=await customer['findOne']({'name':_0x36f910[_0x12cbb7(0x22b)]});console[_0x12cbb7(0x291)](_0x1bcb54);if(_0x35c260[0x0][_0x12cbb7(0x23f)]==_0x12cbb7(0x247)){var _0x5c8165=users[_0x12cbb7(0x19c)];console[_0x12cbb7(0x291)](_0x5c8165);}else{if(_0x35c260[0x0][_0x12cbb7(0x23f)]==_0x12cbb7(0x1bf))var _0x5c8165=users[_0x12cbb7(0x1bf)];else{if(_0x35c260[0x0]['language']==_0x12cbb7(0x1ea))var _0x5c8165=users[_0x12cbb7(0x1ea)];else{if(_0x35c260[0x0][_0x12cbb7(0x23f)]==_0x12cbb7(0x20d))var _0x5c8165=users[_0x12cbb7(0x20d)];else{if(_0x35c260[0x0]['language']==_0x12cbb7(0x25f))var _0x5c8165=users['French'];else{if(_0x35c260[0x0]['language']==_0x12cbb7(0x2a1))var _0x5c8165=users['Portuguese'];else{if(_0x35c260[0x0][_0x12cbb7(0x23f)]=='Chinese')var _0x5c8165=users[_0x12cbb7(0x244)];else{if(_0x35c260[0x0]['language']==_0x12cbb7(0x28a))var _0x5c8165=users[_0x12cbb7(0x2b3)];}}}}}}}_0x3eb0aa['render'](_0x12cbb7(0x2a7),{'success':_0x564a06['flash'](_0x12cbb7(0x223)),'errors':_0x564a06[_0x12cbb7(0x233)](_0x12cbb7(0x289)),'role':_0x278283,'profile':_0x4e8ce7,'master_shop':_0x35c260,'customers':_0x1bcb54,'sales':_0x36f910,'language':_0x5c8165});}catch(_0x2e4a6e){console[_0x12cbb7(0x291)](_0x2e4a6e);}}),router['get']('/view/return_sales/:id',auth,async(_0x5e87ea,_0x5652a3)=>{var _0xf740b3=a0_0x24ad91;try{const {username:_0x3da94c,email:_0x5d4c43,role:_0x31ec50}=_0x5e87ea[_0xf740b3(0x1f8)],_0x419444=_0x5e87ea[_0xf740b3(0x1f8)],_0x1bacbb=await profile[_0xf740b3(0x295)]({'email':_0x419444[_0xf740b3(0x1b3)]}),_0x87dcf6=await master_shop[_0xf740b3(0x246)](),_0x3c7d24=_0x5e87ea[_0xf740b3(0x25a)]['id'],_0x349bba=await sales_finished[_0xf740b3(0x1d1)](_0x3c7d24),_0x89746d=await warehouse[_0xf740b3(0x1b0)]([{'$match':{'name':_0x349bba[_0xf740b3(0x1be)]}},{'$unwind':_0xf740b3(0x224)},{'$group':{'_id':'$product_details._id','name':{'$first':_0xf740b3(0x1d0)},'product_stock':{'$first':_0xf740b3(0x237)},'bay':{'$first':_0xf740b3(0x1b1)},'bin':{'$first':_0xf740b3(0x208)},'type':{'$first':_0xf740b3(0x1f2)},'floorlevel':{'$first':_0xf740b3(0x1c6)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xf740b3(0x21d)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xf740b3(0x1fa)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xf740b3(0x27d)},'production_date':{'$first':_0xf740b3(0x279)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0xf740b3(0x283)},'maxProducts':{'$first':_0xf740b3(0x27b)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0xf740b3(0x211)}}}]),_0xfbbc17=await product[_0xf740b3(0x246)]({}),_0xbfdd72=await warehouse[_0xf740b3(0x1b0)]([{'$match':{'status':_0xf740b3(0x1f9),'warehouse_category':_0xf740b3(0x24d),'name':{'$ne':_0xf740b3(0x1e3),'$ne':_0xf740b3(0x1b5)}}},{'$group':{'_id':_0xf740b3(0x2a4),'name':{'$first':_0xf740b3(0x2a4)}}},{'$sort':{'name':0x1}}]);var _0x2c0263=[_0xf740b3(0x2a0)];const _0x9a9654=await warehouse[_0xf740b3(0x1b0)]([{'$match':{'status':_0xf740b3(0x1f9),'name':_0xf740b3(0x1b5)}},{'$group':{'_id':_0xf740b3(0x2a4),'name':{'$first':_0xf740b3(0x2a4)}}},{'$sort':{'name':0x1}}]);if(_0x87dcf6[0x0][_0xf740b3(0x23f)]==_0xf740b3(0x247)){var _0x2d46f8=users['English'];console[_0xf740b3(0x291)](_0x2d46f8);}else{if(_0x87dcf6[0x0][_0xf740b3(0x23f)]==_0xf740b3(0x1bf))var _0x2d46f8=users[_0xf740b3(0x1bf)];else{if(_0x87dcf6[0x0]['language']==_0xf740b3(0x1ea))var _0x2d46f8=users['German'];else{if(_0x87dcf6[0x0][_0xf740b3(0x23f)]==_0xf740b3(0x20d))var _0x2d46f8=users[_0xf740b3(0x20d)];else{if(_0x87dcf6[0x0][_0xf740b3(0x23f)]==_0xf740b3(0x25f))var _0x2d46f8=users[_0xf740b3(0x25f)];else{if(_0x87dcf6[0x0][_0xf740b3(0x23f)]==_0xf740b3(0x2a1))var _0x2d46f8=users[_0xf740b3(0x1a9)];else{if(_0x87dcf6[0x0][_0xf740b3(0x23f)]=='Chinese')var _0x2d46f8=users[_0xf740b3(0x244)];else{if(_0x87dcf6[0x0][_0xf740b3(0x23f)]==_0xf740b3(0x28a))var _0x2d46f8=users[_0xf740b3(0x2b3)];}}}}}}}_0x5652a3[_0xf740b3(0x231)](_0xf740b3(0x287),{'success':_0x5e87ea[_0xf740b3(0x233)](_0xf740b3(0x223)),'errors':_0x5e87ea[_0xf740b3(0x233)]('errors'),'role':_0x419444,'profile':_0x1bacbb,'user':_0x349bba,'stock':_0x89746d,'master_shop':_0x87dcf6,'unit':_0xfbbc17,'language':_0x2d46f8,'warehouses':_0xbfdd72,'rooms':_0x2c0263,'warehouse_QA':_0x9a9654});}catch(_0x226eb4){console[_0xf740b3(0x291)](_0x226eb4),_0x5652a3[_0xf740b3(0x1e6)](0xc8)['json']({'message':_0x226eb4['message']});}}),router['post'](a0_0x24ad91(0x215),auth,async(_0x12dd9f,_0x3c8fee)=>{var _0x2ad471=a0_0x24ad91;if(_0x12dd9f[_0x2ad471(0x202)]['for_categorize']=='QA')try{const {invoice:_0x445c40,date:_0x45d6af,warehouse_name:_0xfa7f25,product_name:_0x3ef13a,primary_code:_0x63a595,secondary_code:_0x5d727f,product_code:_0x1d0907,sales_quantity:_0x2ae06f,stocks:_0x141121,return_qty:_0x520d8c,Room_name:_0x10c640,to_warehouse_name_QA:_0x475158,to_Room_name_QA:_0x4e8e79,note:_0x375528,for_categorize:_0x2d9cbe,product_name_QA1:_0x3036a3}=_0x12dd9f[_0x2ad471(0x202)];if(typeof _0x3036a3==_0x2ad471(0x239))var _0x44400f=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x238)]],_0x42be24=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1d9)]],_0x25fb8d=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x28c)]],_0x49e237=[_0x12dd9f[_0x2ad471(0x202)]['product_code_QA']],_0x19248b=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x271)]],_0x770a68=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x243)]],_0xeb21d1=[_0x12dd9f['body']['return_qty_QA']],_0x271760=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x2af)]],_0x4b076e=[_0x12dd9f['body'][_0x2ad471(0x261)]],_0x34d743=[_0x12dd9f['body']['batch_code_QA']],_0x3bce95=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1fd)]],_0x46368e=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x26e)]],_0xeea433=[_0x12dd9f[_0x2ad471(0x202)]['production_date_QA']],_0x3f5034=[_0x12dd9f[_0x2ad471(0x202)]['expiry_date_QA']];else var _0x44400f=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x238)]],_0x42be24=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1d9)]],_0x25fb8d=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x28c)]],_0x49e237=[..._0x12dd9f[_0x2ad471(0x202)]['product_code_QA']],_0x19248b=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x271)]],_0x770a68=[..._0x12dd9f['body'][_0x2ad471(0x243)]],_0xeb21d1=[..._0x12dd9f[_0x2ad471(0x202)]['return_qty_QA']],_0x271760=[..._0x12dd9f['body'][_0x2ad471(0x2af)]],_0x4b076e=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x261)]],_0x34d743=[..._0x12dd9f['body'][_0x2ad471(0x1a5)]],_0x3bce95=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1fd)]],_0x46368e=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x26e)]],_0xeea433=[..._0x12dd9f[_0x2ad471(0x202)]['production_date_QA']],_0x3f5034=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x24e)]];const _0x48984e=_0x44400f[_0x2ad471(0x25d)](_0xab3981=>{return _0xab3981={'product_name':_0xab3981};});_0x42be24[_0x2ad471(0x1e7)]((_0x430890,_0x17ed98)=>{var _0x177ca7=_0x2ad471;_0x48984e[_0x17ed98][_0x177ca7(0x1d5)]=_0x430890;}),_0x25fb8d[_0x2ad471(0x1e7)]((_0x5133d8,_0x416544)=>{_0x48984e[_0x416544]['secondary_code']=_0x5133d8;}),_0x49e237['forEach']((_0x222e60,_0x579400)=>{var _0x550ef1=_0x2ad471;_0x48984e[_0x579400][_0x550ef1(0x23b)]=_0x222e60;}),_0x19248b[_0x2ad471(0x1e7)]((_0x10cb0d,_0x1d63d3)=>{var _0x1090fc=_0x2ad471;_0x48984e[_0x1d63d3][_0x1090fc(0x282)]=_0x10cb0d;}),_0x770a68[_0x2ad471(0x1e7)]((_0x375042,_0x21859f)=>{var _0x4d95f2=_0x2ad471;_0x48984e[_0x21859f][_0x4d95f2(0x27f)]=_0x375042;}),_0xeb21d1[_0x2ad471(0x1e7)]((_0x470317,_0x1beb1f)=>{var _0x2b542d=_0x2ad471;_0x48984e[_0x1beb1f][_0x2b542d(0x2aa)]=_0x470317;}),_0x271760[_0x2ad471(0x1e7)]((_0x2b935a,_0x406487)=>{var _0x82a923=_0x2ad471;_0x48984e[_0x406487][_0x82a923(0x1c9)]=_0x2b935a;}),_0x4b076e['forEach']((_0x45b41d,_0x1773c3)=>{var _0x21087a=_0x2ad471;_0x48984e[_0x1773c3][_0x21087a(0x1db)]=_0x45b41d;}),_0x34d743['forEach']((_0x453f3c,_0x1ad7e5)=>{var _0x395480=_0x2ad471;_0x48984e[_0x1ad7e5][_0x395480(0x217)]=_0x453f3c;}),_0x3bce95[_0x2ad471(0x1e7)]((_0x5c6417,_0x4f4695)=>{var _0xc8953f=_0x2ad471;_0x48984e[_0x4f4695][_0xc8953f(0x29e)]=_0x5c6417;}),_0x46368e[_0x2ad471(0x1e7)]((_0x45ca94,_0x4d77ab)=>{var _0x379c83=_0x2ad471;_0x48984e[_0x4d77ab][_0x379c83(0x21e)]=_0x45ca94;}),_0xeea433[_0x2ad471(0x1e7)]((_0x2229d4,_0xf7be24)=>{var _0x33d12e=_0x2ad471;_0x48984e[_0xf7be24][_0x33d12e(0x28d)]=_0x2229d4;}),_0x3f5034[_0x2ad471(0x1e7)]((_0x408756,_0x21869e)=>{var _0x11736e=_0x2ad471;_0x48984e[_0x21869e][_0x11736e(0x1bb)]=_0x408756;});const _0x3e22d1=await sales_finished[_0x2ad471(0x295)]({'invoice':_0x445c40});_0x3e22d1[_0x2ad471(0x252)]='True';const _0x4413f7=await _0x3e22d1[_0x2ad471(0x226)](),_0x194c23=new sales_return_finished({'invoice':_0x445c40,'customer':_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x22b)],'date':_0x45d6af,'warehouse_name':_0xfa7f25,'room':_0x10c640,'ToWarehouse':_0x475158,'ToRoom':_0x4e8e79,'return_sale_QA':_0x48984e,'note':_0x375528,'warehouse_cat':_0x2d9cbe}),_0x42d389=await _0x194c23[_0x2ad471(0x226)](),_0x55d15=await sales_return_finished[_0x2ad471(0x295)]({'invoice':_0x445c40}),_0x358d25=await warehouse['findOne']({'name':_0x475158,'room':_0x4e8e79});_0x55d15[_0x2ad471(0x23c)][_0x2ad471(0x1e7)](_0x1d1f21=>{var _0x36fe1b=_0x2ad471,_0x46c9f3=0x0;const _0x5b8f8d=_0x358d25['product_details'][_0x36fe1b(0x25d)](_0x28cb51=>{var _0x1eb4f5=_0x36fe1b;_0x28cb51[_0x1eb4f5(0x1a4)]==_0x1d1f21['product_name']&&_0x28cb51[_0x1eb4f5(0x1bb)]==_0x1d1f21[_0x1eb4f5(0x1bb)]&&_0x28cb51['production_date']==_0x1d1f21[_0x1eb4f5(0x28d)]&&_0x28cb51[_0x1eb4f5(0x217)]==_0x1d1f21['batch_code']&&(_0x28cb51[_0x1eb4f5(0x2a2)]=parseInt(_0x28cb51['product_stock'])+parseInt(_0x1d1f21['return_qty']),_0x46c9f3++);});_0x46c9f3=='0'&&(_0x358d25[_0x36fe1b(0x1ba)]=_0x358d25[_0x36fe1b(0x1ba)]['concat']({'product_name':_0x1d1f21[_0x36fe1b(0x1a4)],'product_stock':_0x1d1f21[_0x36fe1b(0x2aa)],'primary_code':_0x1d1f21[_0x36fe1b(0x1d5)],'secondary_code':_0x1d1f21['secondary_code'],'product_code':_0x1d1f21[_0x36fe1b(0x23b)],'batch_code':_0x1d1f21['batch_code'],'maxPerUnit':_0x1d1f21[_0x36fe1b(0x1c9)],'production_date':_0x1d1f21[_0x36fe1b(0x28d)],'expiry_date':_0x1d1f21[_0x36fe1b(0x1bb)],'secondary_unit':_0x1d1f21[_0x36fe1b(0x29e)],'unit':_0x1d1f21[_0x36fe1b(0x21e)],'maxProducts':_0x1d1f21[_0x36fe1b(0x1db)],'bay':_0x1d1f21['bay']}));}),await _0x358d25[_0x2ad471(0x226)]();const _0xae7a61=new c_payment_data({'invoice':_0x445c40,'customer':_0x12dd9f[_0x2ad471(0x202)]['customer'],'reason':'Sale\x20Return'});await _0xae7a61[_0x2ad471(0x226)]();const _0x3bf770=await master_shop[_0x2ad471(0x246)](),_0x5a23f6=await email_settings[_0x2ad471(0x295)](),_0x2f21ba=await customer[_0x2ad471(0x295)]({'name':_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x22b)]});_0x3bf770[0x0][_0x2ad471(0x2b1)]==0x1?(right_currency=_0x3bf770[0x0][_0x2ad471(0x1ad)],left_currency=''):(right_currency='',left_currency=_0x3bf770[0x0][_0x2ad471(0x1ad)]);var _0x415abb=_0x44400f,_0x2672cf=_0xeb21d1,_0x174693='',_0x32adb3;for(_0x32adb3 in _0x415abb){_0x174693+=_0x2ad471(0x2ac)+_0x2ad471(0x1e0)+_0x415abb[_0x32adb3]+_0x2ad471(0x293)+_0x2ad471(0x1e0)+_0x2672cf[_0x32adb3]+'</td>'+_0x2ad471(0x1ef);}console[_0x2ad471(0x291)](_0x2ad471(0x20b),_0x174693);let _0x385da3=nodemailer[_0x2ad471(0x19f)]({'service':'gmail','auth':{'user':_0x5a23f6[_0x2ad471(0x1b3)],'pass':_0x5a23f6[_0x2ad471(0x1a2)]}}),_0x4b2ff6={'from':_0x5a23f6['email'],'to':_0x2f21ba[_0x2ad471(0x1b3)],'subject':_0x2ad471(0x222),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2ad471(0x24f)+_0x2ad471(0x1b6)+_0x3bf770[0x0]['image'],'cid':'logo'}],'html':_0x2ad471(0x28b)+_0x2ad471(0x203)+_0x2ad471(0x1f6)+_0x2ad471(0x225)+_0x2ad471(0x264)+_0x2ad471(0x225)+_0x2ad471(0x1ee)+_0x2ad471(0x25e)+_0x2ad471(0x225)+_0x2ad471(0x1b7)+_0x3bf770[0x0][_0x2ad471(0x1a6)]+_0x2ad471(0x266)+_0x2ad471(0x25e)+_0x2ad471(0x25e)+_0x2ad471(0x230)+_0x2ad471(0x225)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2ad471(0x22e)+_0x445c40+'\x20'+_0x2ad471(0x228)+_0x2ad471(0x1fc)+_0x45d6af+'\x20'+_0x2ad471(0x1d7)+_0x2ad471(0x257)+_0x2ad471(0x25e)+_0x2ad471(0x236)+_0x2ad471(0x1cf)+_0x2ad471(0x2ac)+_0x2ad471(0x290)+_0x2ad471(0x288)+_0x2ad471(0x210)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x2ad471(0x1ef)+_0x2ad471(0x216)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x174693+'\x20'+_0x2ad471(0x268)+_0x2ad471(0x274)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x2ad471(0x1eb)+_0x3bf770[0x0][_0x2ad471(0x1a6)]+_0x2ad471(0x257)+_0x2ad471(0x25e)+_0x2ad471(0x25e)+_0x2ad471(0x1ce)};_0x385da3[_0x2ad471(0x1cc)](_0x4b2ff6,function(_0x49fd72,_0x4eda31){var _0x2b0d54=_0x2ad471;_0x49fd72?(console[_0x2b0d54(0x291)](_0x49fd72),console['log']('Error\x20Occurs')):console['log'](_0x2b0d54(0x277));}),_0x12dd9f[_0x2ad471(0x233)](_0x2ad471(0x223),_0x2ad471(0x1c5)),_0x3c8fee[_0x2ad471(0x1dc)](_0x2ad471(0x209));}catch(_0x2a8ea9){_0x3c8fee[_0x2ad471(0x1e6)](0xc8)[_0x2ad471(0x1ec)]({'message1':_0x2a8ea9[_0x2ad471(0x22c)]});}else{if(_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1df)]=='GS')try{const {invoice:_0x5eac96,date:_0x46a7b8,warehouse_name:_0xeb60f,product_name:_0x899aed,primary_code:_0x334e1b,secondary_code:_0x8a39e0,product_code:_0x42a1a9,sales_quantity:_0x2faaaf,stocks:_0x1a9fc1,return_qty:_0x1b63ec,Room_name:_0x2d8c25,to_warehouse_name:_0x2647d5,to_Room_name:_0x12b103,note:_0x3cfcd1,level:_0x2d2d05,isle:_0x1c07e4,pallet:_0x132985,for_categorize:_0x20008c}=_0x12dd9f[_0x2ad471(0x202)];if(typeof _0x899aed==_0x2ad471(0x239))var _0x44400f=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1a4)]],_0x42be24=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1d5)]],_0x25fb8d=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1ff)]],_0x49e237=[_0x12dd9f[_0x2ad471(0x202)]['product_code']],_0x19248b=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1fe)]],_0xeb21d1=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x2aa)]],_0x59d7bd=[_0x12dd9f['body'][_0x2ad471(0x1aa)]],_0x271760=[_0x12dd9f['body'][_0x2ad471(0x1c9)]],_0x4b076e=[_0x12dd9f[_0x2ad471(0x202)]['maxProducts']],_0x34d743=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x217)]],_0x3bce95=[_0x12dd9f[_0x2ad471(0x202)]['secondary_unit']],_0x46368e=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x21e)]],_0xeea433=[_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x28d)]],_0x3f5034=[_0x12dd9f[_0x2ad471(0x202)]['expiry_date']];else var _0x44400f=[..._0x12dd9f[_0x2ad471(0x202)]['product_name']],_0x42be24=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1d5)]],_0x25fb8d=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1ff)]],_0x49e237=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x23b)]],_0x19248b=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1fe)]],_0xeb21d1=[..._0x12dd9f['body']['return_qty']],_0x59d7bd=[..._0x12dd9f[_0x2ad471(0x202)]['bay']],_0x271760=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x1c9)]],_0x4b076e=[..._0x12dd9f[_0x2ad471(0x202)]['maxProducts']],_0x34d743=[..._0x12dd9f[_0x2ad471(0x202)]['batch_code']],_0x3bce95=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x29e)]],_0x46368e=[..._0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x21e)]],_0xeea433=[..._0x12dd9f['body'][_0x2ad471(0x28d)]],_0x3f5034=[..._0x12dd9f['body'][_0x2ad471(0x1bb)]];const _0x401e81=_0x44400f['map'](_0x4b9ae2=>{return _0x4b9ae2={'product_name':_0x4b9ae2};});_0x42be24[_0x2ad471(0x1e7)]((_0x572f25,_0x520014)=>{var _0x4c2063=_0x2ad471;_0x401e81[_0x520014][_0x4c2063(0x1d5)]=_0x572f25;}),_0x25fb8d[_0x2ad471(0x1e7)]((_0x119d24,_0x296e3a)=>{var _0x16f483=_0x2ad471;_0x401e81[_0x296e3a][_0x16f483(0x1ff)]=_0x119d24;}),_0x49e237[_0x2ad471(0x1e7)]((_0x4a9c32,_0x2bd8eb)=>{var _0x2962c1=_0x2ad471;_0x401e81[_0x2bd8eb][_0x2962c1(0x23b)]=_0x4a9c32;}),_0x19248b[_0x2ad471(0x1e7)]((_0x4cbb36,_0x3842f8)=>{var _0x4383b5=_0x2ad471;_0x401e81[_0x3842f8][_0x4383b5(0x282)]=_0x4cbb36;}),_0xeb21d1[_0x2ad471(0x1e7)]((_0x13e5d6,_0xc2ce16)=>{var _0x5537b5=_0x2ad471;_0x401e81[_0xc2ce16][_0x5537b5(0x2aa)]=_0x13e5d6;}),_0x59d7bd[_0x2ad471(0x1e7)]((_0x5bfefc,_0x3c834f)=>{_0x401e81[_0x3c834f]['bay']=_0x5bfefc;}),_0x271760[_0x2ad471(0x1e7)]((_0x802664,_0x4480b2)=>{_0x401e81[_0x4480b2]['maxPerUnit']=_0x802664;}),_0x4b076e[_0x2ad471(0x1e7)]((_0xe71af1,_0x36f49f)=>{_0x401e81[_0x36f49f]['maxProducts']=_0xe71af1;}),_0x34d743[_0x2ad471(0x1e7)]((_0x321386,_0x232c6a)=>{_0x401e81[_0x232c6a]['batch_code']=_0x321386;}),_0x3bce95[_0x2ad471(0x1e7)]((_0x364283,_0x55b38b)=>{var _0x2ca6ac=_0x2ad471;_0x401e81[_0x55b38b][_0x2ca6ac(0x29e)]=_0x364283;}),_0x46368e[_0x2ad471(0x1e7)]((_0x39c72e,_0x195100)=>{var _0x644c91=_0x2ad471;_0x401e81[_0x195100][_0x644c91(0x21e)]=_0x39c72e;}),_0xeea433['forEach']((_0x4acff8,_0x367b92)=>{var _0x50ebd1=_0x2ad471;_0x401e81[_0x367b92][_0x50ebd1(0x28d)]=_0x4acff8;}),_0x3f5034[_0x2ad471(0x1e7)]((_0x402aab,_0x137ff5)=>{var _0x89f43e=_0x2ad471;_0x401e81[_0x137ff5][_0x89f43e(0x1bb)]=_0x402aab;});var _0x4455f5=0x0;_0x401e81['forEach'](_0x431d3d=>{var _0x16cc5e=_0x2ad471;(parseInt(_0x431d3d['sale_qty'])<parseInt(_0x431d3d[_0x16cc5e(0x2aa)])||parseInt(_0x431d3d[_0x16cc5e(0x27f)])<parseInt(_0x431d3d['return_qty'])&&parseInt(_0x431d3d['sale_qty'])>parseInt(_0x431d3d['return_qty'])||parseInt(_0x431d3d[_0x16cc5e(0x2aa)])==0x0)&&_0x4455f5++;});if(_0x4455f5!=0x0)return _0x12dd9f[_0x2ad471(0x233)]('errors',_0x2ad471(0x1a0)),_0x3c8fee[_0x2ad471(0x1dc)](_0x2ad471(0x19e));const _0x1eb6c6=await sales_finished[_0x2ad471(0x295)]({'invoice':_0x5eac96});_0x1eb6c6[_0x2ad471(0x252)]=_0x2ad471(0x1f3);const _0xea362c=await _0x1eb6c6[_0x2ad471(0x226)](),_0x119a06=new sales_return_finished({'invoice':_0x5eac96,'customer':_0x12dd9f['body'][_0x2ad471(0x22b)],'date':_0x46a7b8,'warehouse_name':_0xeb60f,'room':_0x2d8c25,'ToWarehouse':_0x2647d5,'ToRoom':_0x12b103,'return_sale':_0x401e81,'note':_0x3cfcd1,'warehouse_cat':_0x20008c}),_0x51f059=await _0x119a06[_0x2ad471(0x226)](),_0x2aafc5=await sales_return_finished['findOne']({'invoice':_0x5eac96}),_0x2edca2=await warehouse[_0x2ad471(0x295)]({'name':_0x2647d5,'room':_0x12b103,'warehouse_category':_0x2ad471(0x24d)});_0x2aafc5[_0x2ad471(0x1b2)][_0x2ad471(0x1e7)](_0x28122e=>{var _0x3d4fa2=_0x2ad471,_0x5bab7b=0x0;const _0x8f2b47=_0x2edca2[_0x3d4fa2(0x1ba)][_0x3d4fa2(0x25d)](_0x302b61=>{var _0x2301b7=_0x3d4fa2;_0x302b61[_0x2301b7(0x1a4)]==_0x28122e[_0x2301b7(0x1a4)]&&_0x302b61[_0x2301b7(0x1aa)]==_0x28122e[_0x2301b7(0x1aa)]&&_0x302b61[_0x2301b7(0x1bb)]==_0x28122e['expiry_date']&&_0x302b61['production_date']==_0x28122e[_0x2301b7(0x28d)]&&_0x302b61[_0x2301b7(0x217)]==_0x28122e[_0x2301b7(0x217)]&&(_0x302b61['product_stock']=parseInt(_0x302b61[_0x2301b7(0x2a2)])+parseInt(_0x28122e[_0x2301b7(0x2aa)]),_0x5bab7b++);});_0x5bab7b=='0'&&(_0x2edca2['product_details']=_0x2edca2['product_details'][_0x3d4fa2(0x1c8)]({'product_name':_0x28122e[_0x3d4fa2(0x1a4)],'product_stock':_0x28122e['return_qty'],'primary_code':_0x28122e[_0x3d4fa2(0x1d5)],'secondary_code':_0x28122e[_0x3d4fa2(0x1ff)],'product_code':_0x28122e[_0x3d4fa2(0x23b)],'bay':_0x28122e[_0x3d4fa2(0x1aa)],'batch_code':_0x28122e[_0x3d4fa2(0x217)],'maxPerUnit':_0x28122e[_0x3d4fa2(0x1c9)],'production_date':_0x28122e['production_date'],'expiry_date':_0x28122e[_0x3d4fa2(0x1bb)],'secondary_unit':_0x28122e[_0x3d4fa2(0x29e)],'unit':_0x28122e[_0x3d4fa2(0x21e)],'maxProducts':_0x28122e[_0x3d4fa2(0x1db)]}));}),await _0x2edca2['save'](),console[_0x2ad471(0x291)](_0x12dd9f['body']);const _0x5582df=new c_payment_data({'invoice':_0x5eac96,'customer':_0x12dd9f[_0x2ad471(0x202)][_0x2ad471(0x22b)],'reason':_0x2ad471(0x2a9)});await _0x5582df[_0x2ad471(0x226)]();const _0x4ebeea=await master_shop[_0x2ad471(0x246)]();console[_0x2ad471(0x291)]('add\x20post',_0x4ebeea[0x0][_0x2ad471(0x23a)]);const _0x19b671=await email_settings[_0x2ad471(0x295)](),_0x23312a=await customer[_0x2ad471(0x295)]({'name':_0x12dd9f['body'][_0x2ad471(0x22b)]});console[_0x2ad471(0x291)]('customer_data',_0x23312a);_0x4ebeea[0x0][_0x2ad471(0x2b1)]==0x1?(right_currency=_0x4ebeea[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4ebeea[0x0][_0x2ad471(0x1ad)]);var _0x415abb=_0x44400f,_0x2672cf=_0xeb21d1,_0x174693='',_0x32adb3;for(_0x32adb3 in _0x415abb){_0x174693+=_0x2ad471(0x2ac)+_0x2ad471(0x1e0)+_0x415abb[_0x32adb3]+_0x2ad471(0x293)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2672cf[_0x32adb3]+_0x2ad471(0x293)+_0x2ad471(0x1ef);}console[_0x2ad471(0x291)]('product_list',_0x174693);let _0x3e5ec7=nodemailer[_0x2ad471(0x19f)]({'service':'gmail','auth':{'user':_0x19b671[_0x2ad471(0x1b3)],'pass':_0x19b671[_0x2ad471(0x1a2)]}}),_0x33bb80={'from':_0x19b671[_0x2ad471(0x1b3)],'to':_0x23312a['email'],'subject':_0x2ad471(0x222),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2ad471(0x24f)+_0x2ad471(0x1b6)+_0x4ebeea[0x0][_0x2ad471(0x23a)],'cid':_0x2ad471(0x250)}],'html':'<!DOCTYPE\x20html>'+_0x2ad471(0x203)+'</head><body>'+_0x2ad471(0x225)+_0x2ad471(0x264)+_0x2ad471(0x225)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2ad471(0x25e)+_0x2ad471(0x225)+_0x2ad471(0x1b7)+_0x4ebeea[0x0][_0x2ad471(0x1a6)]+_0x2ad471(0x266)+_0x2ad471(0x25e)+_0x2ad471(0x25e)+'<hr\x20class=\x22my-3\x22>'+_0x2ad471(0x225)+_0x2ad471(0x1da)+_0x2ad471(0x22e)+_0x5eac96+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x46a7b8+'\x20'+_0x2ad471(0x1d7)+_0x2ad471(0x257)+'</div>'+_0x2ad471(0x236)+_0x2ad471(0x1cf)+_0x2ad471(0x2ac)+_0x2ad471(0x290)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x2ad471(0x210)+_0x2ad471(0x1f7)+'</tr>'+'</thead>'+_0x2ad471(0x1e5)+'\x20'+_0x174693+'\x20'+_0x2ad471(0x268)+_0x2ad471(0x274)+'<div>'+_0x2ad471(0x1a7)+_0x2ad471(0x1eb)+_0x4ebeea[0x0][_0x2ad471(0x1a6)]+_0x2ad471(0x257)+_0x2ad471(0x25e)+'</div>'+_0x2ad471(0x1ce)};_0x3e5ec7['sendMail'](_0x33bb80,function(_0x1ff9c9,_0x45a28d){var _0x5d92a0=_0x2ad471;_0x1ff9c9?(console[_0x5d92a0(0x291)](_0x1ff9c9),console[_0x5d92a0(0x291)](_0x5d92a0(0x1d8))):console[_0x5d92a0(0x291)](_0x5d92a0(0x277));}),_0x12dd9f[_0x2ad471(0x233)]('success','sales\x20item\x20return\x20successfull'),_0x3c8fee['redirect'](_0x2ad471(0x209));}catch(_0x1b252c){console[_0x2ad471(0x291)](_0x1b252c),_0x3c8fee['status'](0xc8)[_0x2ad471(0x1ec)]({'message1':_0x1b252c[_0x2ad471(0x22c)]});}}}),router[a0_0x24ad91(0x219)](a0_0x24ad91(0x280),auth,async(_0x15e587,_0x11247a)=>{var _0x109e89=a0_0x24ad91;try{const {username:_0x120492,email:_0x1920a7,role:_0x1c22bf}=_0x15e587[_0x109e89(0x1f8)],_0xdab845=_0x15e587[_0x109e89(0x1f8)],_0x8d6096=await profile[_0x109e89(0x295)]({'email':_0xdab845[_0x109e89(0x1b3)]}),_0x1982a6=await master_shop[_0x109e89(0x246)]();console[_0x109e89(0x291)]('barcode\x20Product\x20master',_0x1982a6);const _0x33a5ef=_0x15e587['params']['id'],_0x3eb0a6=await sales[_0x109e89(0x1d1)](_0x33a5ef);console['log']('barcode\x20user_id',_0x3eb0a6);if(_0x1982a6[0x0][_0x109e89(0x23f)]==_0x109e89(0x247))var _0x3ce1fe=users[_0x109e89(0x19c)];else{if(_0x1982a6[0x0][_0x109e89(0x23f)]==_0x109e89(0x1bf))var _0x3ce1fe=users[_0x109e89(0x1bf)];else{if(_0x1982a6[0x0][_0x109e89(0x23f)]=='German')var _0x3ce1fe=users['German'];else{if(_0x1982a6[0x0]['language']==_0x109e89(0x20d))var _0x3ce1fe=users[_0x109e89(0x20d)];else{if(_0x1982a6[0x0]['language']==_0x109e89(0x25f))var _0x3ce1fe=users[_0x109e89(0x25f)];else{if(_0x1982a6[0x0][_0x109e89(0x23f)]==_0x109e89(0x2a1))var _0x3ce1fe=users[_0x109e89(0x1a9)];else{if(_0x1982a6[0x0][_0x109e89(0x23f)]==_0x109e89(0x244))var _0x3ce1fe=users[_0x109e89(0x244)];else{if(_0x1982a6[0x0][_0x109e89(0x23f)]==_0x109e89(0x28a))var _0x3ce1fe=users[_0x109e89(0x2b3)];}}}}}}}_0x11247a[_0x109e89(0x231)](_0x109e89(0x27c),{'success':_0x15e587[_0x109e89(0x233)]('success'),'errors':_0x15e587[_0x109e89(0x233)](_0x109e89(0x289)),'role':_0xdab845,'profile':_0x8d6096,'alldata':_0x3eb0a6,'master_shop':_0x1982a6,'language':_0x3ce1fe});}catch(_0x4f1d33){console[_0x109e89(0x291)](_0x4f1d33);}}),router['post']('/barcode_scanner',async(_0x28bd3a,_0x4d0cef)=>{var _0x5ba52c=a0_0x24ad91;const {product_code:_0x134ded,warehouse_name:_0x17f2de,rooms_data:_0x1e2fad,Roomslist:_0x22ade5}=_0x28bd3a[_0x5ba52c(0x202)],_0x224223=_0x22ade5[_0x5ba52c(0x1de)](','),_0x505a44=[];async function _0x5727c4(_0xb0ff64){var _0x5d6062=_0x5ba52c;const _0x2b89ea=await warehouse[_0x5d6062(0x1b0)]([{'$match':{'name':_0x17f2de,'room':_0xb0ff64}},{'$unwind':_0x5d6062(0x224)},{'$match':{'product_details.primary_code':_0x134ded}},{'$group':{'_id':_0x5d6062(0x227),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5d6062(0x237)},'primary_code':{'$first':_0x5d6062(0x270)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5d6062(0x26d)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x5d6062(0x1f2)},'pallet':{'$first':_0x5d6062(0x1c6)},'unit':{'$first':_0x5d6062(0x2a6)},'secondary_unit':{'$first':_0x5d6062(0x283)},'storage':{'$first':_0x5d6062(0x1fa)},'rack':{'$first':_0x5d6062(0x245)},'expiry_date':{'$first':_0x5d6062(0x27d)},'production_date':{'$first':_0x5d6062(0x279)},'maxPerUnit':{'$first':_0x5d6062(0x211)},'batch_code':{'$first':_0x5d6062(0x284)},'product_cat':{'$first':_0x5d6062(0x29c)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x5d6062(0x1a3)},'invoice':{'$first':_0x5d6062(0x262)}}}]),_0x559f8e=await warehouse[_0x5d6062(0x1b0)]([{'$match':{'name':_0x17f2de,'room':_0xb0ff64}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x134ded}},{'$group':{'_id':_0x5d6062(0x227),'name':{'$first':_0x5d6062(0x1d0)},'product_stock':{'$first':_0x5d6062(0x237)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5d6062(0x21d)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x5d6062(0x1b1)},'isle':{'$first':_0x5d6062(0x208)},'type':{'$first':_0x5d6062(0x1f2)},'pallet':{'$first':_0x5d6062(0x1c6)},'unit':{'$first':_0x5d6062(0x2a6)},'secondary_unit':{'$first':_0x5d6062(0x283)},'storage':{'$first':_0x5d6062(0x1fa)},'rack':{'$first':_0x5d6062(0x245)},'expiry_date':{'$first':_0x5d6062(0x27d)},'production_date':{'$first':_0x5d6062(0x279)},'maxPerUnit':{'$first':_0x5d6062(0x211)},'batch_code':{'$first':_0x5d6062(0x284)},'product_cat':{'$first':_0x5d6062(0x29c)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x5d6062(0x1a3)},'invoice':{'$first':_0x5d6062(0x262)}}}]);if(_0x2b89ea[_0x5d6062(0x1e8)]>0x0)_0x505a44[_0x5d6062(0x259)](_0x2b89ea);else _0x559f8e[_0x5d6062(0x1e8)]>0x0&&_0x505a44[_0x5d6062(0x259)](_0x559f8e);}const _0x57f4a0=_0x224223['map'](_0x2ca58e=>_0x5727c4(_0x2ca58e));await Promise['all'](_0x57f4a0),_0x4d0cef[_0x5ba52c(0x1ec)](_0x505a44);}),module[a0_0x24ad91(0x29f)]=router;