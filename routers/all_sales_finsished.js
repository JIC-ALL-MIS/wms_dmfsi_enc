var a0_0x2db548=a0_0x594f;(function(_0xed56ac,_0x578495){var _0x4d2cf8=a0_0x594f,_0x90a956=_0xed56ac();while(!![]){try{var _0x26f6b4=parseInt(_0x4d2cf8(0xaf))/0x1*(-parseInt(_0x4d2cf8(0xa0))/0x2)+parseInt(_0x4d2cf8(0xbe))/0x3+-parseInt(_0x4d2cf8(0xc8))/0x4+-parseInt(_0x4d2cf8(0x128))/0x5+parseInt(_0x4d2cf8(0x139))/0x6*(parseInt(_0x4d2cf8(0x8d))/0x7)+parseInt(_0x4d2cf8(0x155))/0x8*(-parseInt(_0x4d2cf8(0x99))/0x9)+parseInt(_0x4d2cf8(0x130))/0xa;if(_0x26f6b4===_0x578495)break;else _0x90a956['push'](_0x90a956['shift']());}catch(_0x3ace5f){_0x90a956['push'](_0x90a956['shift']());}}}(a0_0x4b54,0xed9db));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x2db548(0x13b)),auth=require(a0_0x2db548(0xee)),nodemailer=require(a0_0x2db548(0x114)),users=require('../public/language/languages.json');router[a0_0x2db548(0x6d)]('/view',auth,async(_0x5aff7d,_0x90c383)=>{var _0x58dc84=a0_0x2db548;try{const {username:_0x521859,email:_0x5193d1,role:_0x21af54}=_0x5aff7d['user'],_0xe74e40=_0x5aff7d['user'],_0x2a5cb8=await profile[_0x58dc84(0xb8)]({'email':_0xe74e40['email']}),_0x205e21=await master_shop[_0x58dc84(0x141)]();let _0x504213;if(_0xe74e40[_0x58dc84(0x71)]==_0x58dc84(0x8b)){const _0x14e77f=await staff[_0x58dc84(0xb8)]({'email':_0xe74e40['email']});_0x504213=await sales_finished[_0x58dc84(0x113)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':'name','as':'customers_docs'}},{'$unwind':_0x58dc84(0xed)},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x58dc84(0x14f)},'customers':{'$first':_0x58dc84(0xf1)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x58dc84(0x173)},'sale_product':{'$push':_0x58dc84(0x164)},'note':{'$first':_0x58dc84(0xe3)},'return_data':{'$first':_0x58dc84(0xdd)},'customers_docs':{'$first':_0x58dc84(0xed)},'total_saleproduct_quantity':{'$sum':_0x58dc84(0x165)},'level':{'$addToSet':_0x58dc84(0xc6)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x58dc84(0x6b)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x504213=await sales_finished['aggregate']([{'$lookup':{'from':_0x58dc84(0xfc),'localField':_0x58dc84(0x7c),'foreignField':_0x58dc84(0xe4),'as':_0x58dc84(0x10a)}},{'$unwind':_0x58dc84(0xed)},{'$unwind':_0x58dc84(0x164)},{'$group':{'_id':_0x58dc84(0x100),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x58dc84(0xf1)},'date':{'$first':_0x58dc84(0xac)},'warehouse_name':{'$first':_0x58dc84(0x173)},'sale_product':{'$push':_0x58dc84(0x164)},'note':{'$first':_0x58dc84(0xe3)},'return_data':{'$first':_0x58dc84(0xdd)},'customers_docs':{'$first':_0x58dc84(0xed)},'total_saleproduct_quantity':{'$sum':_0x58dc84(0x165)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x58dc84(0x15f)},'type':{'$addToSet':_0x58dc84(0x6b)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x58dc84(0xdc)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x205e21[0x0][_0x58dc84(0x119)]==_0x58dc84(0x132)){var _0xc686fd=users[_0x58dc84(0x13e)];console[_0x58dc84(0x133)](_0xc686fd);}else{if(_0x205e21[0x0][_0x58dc84(0x119)]==_0x58dc84(0xfa))var _0xc686fd=users[_0x58dc84(0xfa)];else{if(_0x205e21[0x0][_0x58dc84(0x119)]==_0x58dc84(0xa5))var _0xc686fd=users[_0x58dc84(0xa5)];else{if(_0x205e21[0x0]['language']==_0x58dc84(0x8c))var _0xc686fd=users['Spanish'];else{if(_0x205e21[0x0][_0x58dc84(0x119)]=='French')var _0xc686fd=users[_0x58dc84(0xe2)];else{if(_0x205e21[0x0][_0x58dc84(0x119)]==_0x58dc84(0xde))var _0xc686fd=users[_0x58dc84(0xe5)];else{if(_0x205e21[0x0]['language']==_0x58dc84(0xff))var _0xc686fd=users[_0x58dc84(0xff)];else{if(_0x205e21[0x0]['language']=='Arabic\x20(ae)')var _0xc686fd=users['Arabic'];}}}}}}}_0x90c383[_0x58dc84(0xd8)](_0x58dc84(0x121),{'success':_0x5aff7d[_0x58dc84(0x84)](_0x58dc84(0xab)),'errors':_0x5aff7d[_0x58dc84(0x84)](_0x58dc84(0x12c)),'sales':_0x504213,'profile':_0x2a5cb8,'role':_0xe74e40,'master_shop':_0x205e21,'language':_0xc686fd});}catch(_0x2e7535){console[_0x58dc84(0x133)](_0x2e7535);}});async function getRandom8DigitNumber(){var _0x4dfe7c=a0_0x2db548;const _0x364f65=0x989680,_0x3e90e3=0x5f5e0ff,_0x5893c9=Math[_0x4dfe7c(0xb0)](Math['random']()*(_0x3e90e3-_0x364f65+0x1))+_0x364f65;var _0x234f5b;const _0x5ab57e=await sales_finished['findOne']({'invoice':_0x4dfe7c(0x158)+_0x5893c9});return _0x5ab57e&&_0x5ab57e[_0x4dfe7c(0x12d)]>0x0?_0x234f5b='OUTF-'+_0x5893c9:_0x234f5b=_0x4dfe7c(0x158)+_0x5893c9,_0x234f5b;}function a0_0x4b54(){var _0x844b24=['secondary_unit','amount','error','customer_data','Ambient','unit','warehouse_name','render','Enclosed','<tbody\x20style=\x22text-align:\x20center;\x22>','</tbody>','$finalize','$return_data','Portuguese\x20(BR)','/barcode/:id','expiry_date_QA','Error\x20Occurs','French','$note','name','Portuguese','product_stock','$product_details.maxProducts','Finished\x20Goods','Sales\x20Mail','$product_details','secondary_unit_QA','</head><body>','$customers_docs','../middleware/auth','createTransport','port','$customer','$product_details.primary_code','$product_details.bay','\x20<<<==>>>\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.secondary_unit','<h5\x20style=\x22text-align:\x20left;\x22>','</table>','Sale','Hindi','batch_code_QA','customers','$product_details.storage','room_name','Chinese','$_id','<hr\x20class=\x22my-3\x22>','<h5>','product','product_name','Sale\x20Return','$product_details.product_code','password','primary_code','</thead>','customers_docs','</div>','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','return_sale_QA','/view/return_sales/:id','back','save','invoice','\x20</h2>','aggregate','nodemailer','add\x20post','padStart','filter','unit_QA','language','</h5>','date','$product_details.production_date','Sale\x20Return\x20Mail','suppliers','abs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','all_sales_finished','\x20>>>\x20','all_sales_barcode','<strong>\x20Regards\x20</strong>','note','Quality\x20Inspection','\x20&&\x20','4067820tqoUoS','add_sales_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','currency_placement','errors','length','/view/:id','maxProducts','9923130DwWJkj','bay','English\x20(US)','log','$product.product_name','/view/add_sales','barcode\x20Product\x20master','final','product_name_QA1','27564HsnjOk','carton','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','barcode\x20user_id','English','<h2>\x20','sales\x20item\x20return\x20successfull','find','slice','then','\x20Order\x20Number\x20:\x20','forEach','/give_payment/:id','Arabic\x20(ae)','production_date_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','string','$product_details.product_name','$room','/barcode_scanner','warehouse','$invoice','</span>','QA\x20Warehouse','Sales\x20Add\x20successfully','prod_cat','/invoice/:id','3088rqPEmN','toString','Logo.png','OUTF-','user','$name','stock_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.type','params','$sale_product.bin','quantity','An\x20error\x20occurred\x20while\x20saving\x20data.','push','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$sale_product','$sale_product.quantity','product_details','map','<html><head><title></title>','maxProducts_QA','level','$product_details.expiry_date','for_categorize','/picking_list/pdf/','product_code_QA','/all_sales/view','</td>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/view/add_sale/product','$warehouse_name','status','/preview/:id','RoomAssigned','edit_sales_finished','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','return_qty','maxPerUnit','$product_details.bin','batch_code','return_sale','Arabic','$sale_product.type','<!DOCTYPE\x20html>','get','<div>','message','received_amount','role','payment\x20successfull','logo','</body></html>','getFullYear','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','sales_quantity','$product_details.unit','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.rack','maxperunit','customer','_id','master','email','id_transaction_from','False','site_title','$product_details.product_stock','flash','getMonth','findById','currency','sendMail','<span\x20style=\x22float:\x20right;\x22>','stock','staff','Spanish','2023hkcBxJ','$product_details.room_name','sale_product','$product_details.floorlevel','primary_code_QA','\x20==\x20','finalize','primary_unit','$product_details.invoice','An\x20error\x20occurred.','sales_invoice','secondary_code_QA','23589VWhVWS','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','redirect','room','$product_details.product_cat','return_data','prod_invoice','3496ngXnZf','image','product_data','product_code','product_list','German','<tr>','production_date','all','Enabled','$product_details.maxPerUnit','success','$date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','sale_qty','177oTBTAX','floor','getDate','Sales\x20Update\x20successfully','due_amount','gmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','adjust_qty','$product_details.batch_code','findOne','split','</tr>','post','edit_sales_finished_view','/all_sales_finished/view','4216743xLjPnO','secondary_code','sales_quantity_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','max_per_unit','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$sale_product.bay','Received\x20Payment\x20For\x20Sale','2470476ijFWud','host','return_qty_QA','/upload/','/all_sales_finished/preview/','True','json','$product_details.secondary_code','$product_details._id'];a0_0x4b54=function(){return _0x844b24;};return a0_0x4b54();}function a0_0x594f(_0x1a15aa,_0x4232a9){var _0x4b549e=a0_0x4b54();return a0_0x594f=function(_0x594f17,_0x4e9f19){_0x594f17=_0x594f17-0x68;var _0x2b591b=_0x4b549e[_0x594f17];return _0x2b591b;},a0_0x594f(_0x1a15aa,_0x4232a9);}router[a0_0x2db548(0x6d)](a0_0x2db548(0x135),auth,async(_0x2ea46f,_0x1eeb14)=>{var _0x4aeb6b=a0_0x2db548;try{const {username:_0xd12493,email:_0x221159,role:_0x3bd1d4}=_0x2ea46f['user'],_0xa29b4=_0x2ea46f[_0x4aeb6b(0x159)],_0x5a6609=await profile[_0x4aeb6b(0xb8)]({'email':_0xa29b4['email']}),_0x3fc689=await master_shop[_0x4aeb6b(0x141)](),_0x54724b=await customer[_0x4aeb6b(0x141)]({});let _0x1a89e9;if(_0xa29b4[_0x4aeb6b(0x71)]==_0x4aeb6b(0x8b)){const _0xf6d08c=await staff[_0x4aeb6b(0xb8)]({'email':_0xa29b4['email']});_0x1a89e9=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0xf6d08c['warehouse'],'warehouse_category':_0x4aeb6b(0xe8),'name':{'$ne':_0x4aeb6b(0x151)}}},{'$group':{'_id':_0x4aeb6b(0x15a),'name':{'$first':_0x4aeb6b(0x15a)}}},{'$sort':{'name':0x1}}]);}else _0x1a89e9=await warehouse[_0x4aeb6b(0x113)]([{'$match':{'status':_0x4aeb6b(0xa9),'warehouse_category':_0x4aeb6b(0xe8),'name':{'$ne':_0x4aeb6b(0x151)}}},{'$group':{'_id':_0x4aeb6b(0x15a),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x50d1a5=await product['find']({});var _0x35ca6f=[_0x4aeb6b(0xd5),_0x4aeb6b(0xd9)];const _0x38d8cc=await sales_finished['find']({}),_0xaa17c3=_0x38d8cc[_0x4aeb6b(0x12d)]+0x1,_0x5923cd='OUTF-'+_0xaa17c3[_0x4aeb6b(0x156)]()[_0x4aeb6b(0x116)](0x5,'0');if(_0x3fc689[0x0][_0x4aeb6b(0x119)]==_0x4aeb6b(0x132)){var _0x318f1f=users[_0x4aeb6b(0x13e)];console[_0x4aeb6b(0x133)](_0x318f1f);}else{if(_0x3fc689[0x0][_0x4aeb6b(0x119)]==_0x4aeb6b(0xfa))var _0x318f1f=users['Hindi'];else{if(_0x3fc689[0x0][_0x4aeb6b(0x119)]==_0x4aeb6b(0xa5))var _0x318f1f=users['German'];else{if(_0x3fc689[0x0]['language']=='Spanish')var _0x318f1f=users[_0x4aeb6b(0x8c)];else{if(_0x3fc689[0x0][_0x4aeb6b(0x119)]==_0x4aeb6b(0xe2))var _0x318f1f=users['French'];else{if(_0x3fc689[0x0][_0x4aeb6b(0x119)]==_0x4aeb6b(0xde))var _0x318f1f=users[_0x4aeb6b(0xe5)];else{if(_0x3fc689[0x0]['language']==_0x4aeb6b(0xff))var _0x318f1f=users['Chinese'];else{if(_0x3fc689[0x0]['language']==_0x4aeb6b(0x147))var _0x318f1f=users['Arabic'];}}}}}}}const _0x85c4ec=getRandom8DigitNumber();_0x85c4ec[_0x4aeb6b(0x143)](_0x3cc9fb=>{var _0x514c36=_0x4aeb6b;_0x1eeb14[_0x514c36(0xd8)](_0x514c36(0x129),{'success':_0x2ea46f[_0x514c36(0x84)](_0x514c36(0xab)),'errors':_0x2ea46f[_0x514c36(0x84)](_0x514c36(0x12c)),'role':_0xa29b4,'profile':_0x5a6609,'customer':_0x54724b,'warehouse':_0x1a89e9,'product':_0x50d1a5,'invoice':_0x3cc9fb,'master_shop':_0x3fc689,'language':_0x318f1f,'rooms_data':_0x35ca6f});})['catch'](_0x5f5339=>{var _0x2a6fe6=_0x4aeb6b;_0x2ea46f['flash'](_0x2a6fe6(0x12c),_0x2a6fe6(0xad)),_0x1eeb14[_0x2a6fe6(0x9b)](_0x2a6fe6(0xbd));});}catch(_0x2265cd){console[_0x4aeb6b(0x133)](_0x2265cd);}}),router[a0_0x2db548(0x6d)]('/view/add_sales/:id',auth,async(_0x25c982,_0x5732f3)=>{var _0x282579=a0_0x2db548;try{const _0x34b5d7=_0x25c982[_0x282579(0x15e)]['id'];console[_0x282579(0x133)](_0x34b5d7);const _0x46c18b=await product[_0x282579(0x141)](),_0x5eb824=await purchases[_0x282579(0x113)]([{'$match':{'warehouse_name':_0x34b5d7}},{'$unwind':'$product'},{'$group':{'_id':_0x282579(0x134)}}]);console[_0x282579(0x133)]('purchases_data',_0x5eb824),_0x5732f3[_0x282579(0x174)](0xc8)['json']({'purchases_data':_0x5eb824,'product_data':_0x46c18b});}catch(_0x96d589){console['log'](_0x96d589);}}),router[a0_0x2db548(0xbb)](a0_0x2db548(0x172),auth,async(_0x25940d,_0x555871)=>{var _0x1c6a1e=a0_0x2db548;try{const {warehouse_data:_0x5cc3b8,product_data:_0x1679b1}=_0x25940d[_0x1c6a1e(0x17a)];console[_0x1c6a1e(0x133)](_0x25940d[_0x1c6a1e(0x17a)][_0x1c6a1e(0xa2)]);;const _0x7fd145=await master_shop['find']();console[_0x1c6a1e(0x133)](_0x1c6a1e(0x7e),_0x7fd145);const _0x1c81ed=await product[_0x1c6a1e(0xb8)]({'name':_0x1679b1});console[_0x1c6a1e(0x133)](_0x1c6a1e(0x103),_0x1c81ed);const _0x54cfbd=await warehouse[_0x1c6a1e(0x113)]([{'$match':{'name':_0x5cc3b8}},{'$unwind':_0x1c6a1e(0xea)},{'$match':{'product_details.product_name':_0x1679b1}},{'$group':{'_id':_0x1c6a1e(0x14b),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x1c6a1e(0x133)](_0x1c6a1e(0x15b),_0x54cfbd),_0x555871[_0x1c6a1e(0x174)](0xc8)[_0x1c6a1e(0xce)]({'master':_0x7fd145,'new_product':_0x1c81ed,'stock_data':_0x54cfbd});}catch(_0x3dcbf7){console['log'](_0x3dcbf7);}}),router[a0_0x2db548(0xbb)](a0_0x2db548(0x135),auth,async(_0x5f4ecf,_0x415c10)=>{var _0x578b81=a0_0x2db548;try{const {invoice:_0x4a94d2,date:_0x2e2582,warehouse_name:_0x5c551d,product_name:_0x542037,stock:_0xa6529b,quantity:_0x139776,note:_0x459521,room:_0x15f0c4,primary_code:_0x231b02,secondary_code:_0x3bed50,prod_code:_0x408122,level:_0x337c49,isle:_0x279551,pallet:_0x30fcbf,batch_code:_0x523e90,SCRN:_0x5549ec,expiry_date:_0x5982ce,mode_transpo:_0x2e690c,name_driver:_0x28de5e}=_0x5f4ecf[_0x578b81(0x17a)];if(typeof _0x542037==_0x578b81(0x14a))var _0x5dabed=[_0x5f4ecf['body'][_0x578b81(0x104)]],_0x45a46f=[_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x8a)]],_0x92a385=[_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x13a)]],_0x1524e4=[_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x108)]],_0x288cc1=[_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0xbf)]],_0x184568=[_0x5f4ecf[_0x578b81(0x17a)]['prod_code']],_0xd22bfd=[_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x16a)]],_0x3e7e85=[_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x94)]],_0x55b718=[_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0xd1)]],_0x4f2d6a=[_0x5f4ecf['body'][_0x578b81(0x68)]],_0x96c400=[_0x5f4ecf['body']['expiry_date']],_0x51786e=[_0x5f4ecf[_0x578b81(0x17a)]['product_date']],_0x4690ea=[_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0xc2)]],_0x1941b6=[_0x5f4ecf['body']['prod_cat']],_0xc33a92=[_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x176)]],_0x52c2fc=[_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x9f)]],_0x3c1f35=[_0x5f4ecf['body'][_0x578b81(0x80)]];else var _0x5dabed=[..._0x5f4ecf['body'][_0x578b81(0x104)]],_0x45a46f=[..._0x5f4ecf[_0x578b81(0x17a)]['stock']],_0x92a385=[..._0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x13a)]],_0x1524e4=[..._0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x108)]],_0x288cc1=[..._0x5f4ecf[_0x578b81(0x17a)]['secondary_code']],_0x184568=[..._0x5f4ecf[_0x578b81(0x17a)]['prod_code']],_0xd22bfd=[..._0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x16a)]],_0x3e7e85=[..._0x5f4ecf['body'][_0x578b81(0x94)]],_0x55b718=[..._0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0xd1)]],_0x4f2d6a=[..._0x5f4ecf[_0x578b81(0x17a)]['batch_code']],_0x96c400=[..._0x5f4ecf[_0x578b81(0x17a)]['expiry_date']],_0x51786e=[..._0x5f4ecf[_0x578b81(0x17a)]['product_date']],_0x4690ea=[..._0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0xc2)]],_0x1941b6=[..._0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x153)]],_0xc33a92=[..._0x5f4ecf[_0x578b81(0x17a)]['RoomAssigned']],_0x52c2fc=[..._0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x9f)]],_0x3c1f35=[..._0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x80)]];const _0x5c99d0=_0x5dabed[_0x578b81(0x167)](_0x39bf33=>{return _0x39bf33={'product_name':_0x39bf33};});_0x45a46f[_0x578b81(0x145)]((_0x451e18,_0x441928)=>{var _0x4ca8fc=_0x578b81;_0x5c99d0[_0x441928][_0x4ca8fc(0x8a)]=_0x451e18;}),_0x92a385['forEach']((_0x34794c,_0x296a4b)=>{var _0x23f4a7=_0x578b81;_0x5c99d0[_0x296a4b][_0x23f4a7(0x160)]=Math[_0x23f4a7(0x11f)](_0x34794c);}),_0x3c1f35[_0x578b81(0x145)]((_0x26af08,_0x2785b0)=>{_0x5c99d0[_0x2785b0]['id_transaction_from']=_0x26af08;}),_0x1524e4['forEach']((_0xf09af3,_0x41e083)=>{var _0x5a58d8=_0x578b81;_0x5c99d0[_0x41e083][_0x5a58d8(0x108)]=_0xf09af3;}),_0x288cc1[_0x578b81(0x145)]((_0x20f572,_0x191bbb)=>{var _0x502830=_0x578b81;_0x5c99d0[_0x191bbb][_0x502830(0xbf)]=_0x20f572;}),_0x184568[_0x578b81(0x145)]((_0x472a76,_0xaa7cbc)=>{var _0x286a29=_0x578b81;_0x5c99d0[_0xaa7cbc][_0x286a29(0xa3)]=_0x472a76;}),_0xd22bfd['forEach']((_0xba5fe2,_0xd05b54)=>{var _0x100ac0=_0x578b81;_0x5c99d0[_0xd05b54][_0x100ac0(0x131)]=_0xba5fe2;}),_0x3e7e85[_0x578b81(0x145)]((_0x3bb134,_0x25e540)=>{var _0x257f26=_0x578b81;_0x5c99d0[_0x25e540][_0x257f26(0xd6)]=_0x3bb134;}),_0x55b718[_0x578b81(0x145)]((_0x30efa3,_0xf3aca5)=>{var _0x55a2dc=_0x578b81;_0x5c99d0[_0xf3aca5][_0x55a2dc(0xd1)]=_0x30efa3;}),_0x4f2d6a[_0x578b81(0x145)]((_0x3bc230,_0x21e619)=>{var _0x1d8ae3=_0x578b81;_0x5c99d0[_0x21e619][_0x1d8ae3(0x68)]=_0x3bc230;}),_0x96c400['forEach']((_0xb24fb,_0x2594be)=>{_0x5c99d0[_0x2594be]['expiry_date']=_0xb24fb;}),_0x51786e[_0x578b81(0x145)]((_0x2ce509,_0x1991e5)=>{_0x5c99d0[_0x1991e5]['production_date']=_0x2ce509;}),_0x4690ea[_0x578b81(0x145)]((_0x297c59,_0x48e0e6)=>{var _0x1cc518=_0x578b81;_0x5c99d0[_0x48e0e6][_0x1cc518(0x7b)]=_0x297c59;}),_0x1941b6[_0x578b81(0x145)]((_0x3b76f4,_0xd2c2d8)=>{var _0x131fc2=_0x578b81;_0x5c99d0[_0xd2c2d8][_0x131fc2(0x153)]=_0x3b76f4;}),_0xc33a92[_0x578b81(0x145)]((_0x48e295,_0x4e7e8b)=>{var _0x1107fc=_0x578b81;_0x5c99d0[_0x4e7e8b][_0x1107fc(0xfe)]=_0x48e295;}),_0x52c2fc[_0x578b81(0x145)]((_0x5cc476,_0x5ac669)=>{var _0x2cc234=_0x578b81;_0x5c99d0[_0x5ac669][_0x2cc234(0x111)]=_0x5cc476;});var _0x458ffc=0x0;_0x5c99d0[_0x578b81(0x145)](_0x4d06f8=>{var _0x157ce8=_0x578b81;parseFloat(_0x4d06f8[_0x157ce8(0x8a)])<parseFloat(_0x4d06f8[_0x157ce8(0x160)])&&parseFloat(_0x4d06f8[_0x157ce8(0x160)])>parseFloat(_0x4d06f8[_0x157ce8(0x8a)])&&(console[_0x157ce8(0x133)](_0x4d06f8['stock']+'\x20<>\x20'+_0x4d06f8[_0x157ce8(0x160)]),_0x458ffc++);});if(_0x458ffc!=0x0)return _0x5f4ecf[_0x578b81(0x84)](_0x578b81(0x12c),_0x578b81(0x76)),_0x415c10[_0x578b81(0x9b)](_0x578b81(0x10f));const _0x5d3879=_0x5c99d0[_0x578b81(0x117)](_0x25d6da=>_0x25d6da[_0x578b81(0x160)]!=='0'&&_0x25d6da[_0x578b81(0x160)]!==''),_0x4dc2c7=new sales_finished({'invoice':_0x4a94d2,'customer':_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x7c)],'date':_0x2e2582,'warehouse_name':_0x5c551d,'sale_product':_0x5d3879,'note':_0x459521,'room':_0x15f0c4,'primary_code':_0x231b02,'secondary_code':_0x3bed50,'prod_code':_0x408122,'SCRN':_0x5549ec,'finalize':_0x578b81(0x81),'mode_transpo':_0x2e690c,'name_driver':_0x28de5e}),_0x5eeca5=await _0x4dc2c7['save'](),_0x20356c=await sales_finished['findOne']({'invoice':_0x4a94d2}),_0x1d5b31=new c_payment_data({'invoice':_0x4a94d2,'customer':_0x5f4ecf['body']['customer'],'reason':_0x578b81(0xf9)});await _0x1d5b31[_0x578b81(0x110)]();const _0xb6c99e=await master_shop['find'](),_0xcdbf55=await email_settings[_0x578b81(0xb8)](),_0x1672a3=await customer[_0x578b81(0xb8)]({'name':_0x5f4ecf[_0x578b81(0x17a)][_0x578b81(0x7c)]});_0xb6c99e[0x0]['currency_placement']==0x1?(right_currency=_0xb6c99e[0x0][_0x578b81(0x87)],left_currency=''):(right_currency='',left_currency=_0xb6c99e[0x0]['currency']);var _0x4ec0ef=_0x5dabed,_0x11e716=_0x92a385,_0x2bd84d='',_0x55be40;for(_0x55be40 in _0x4ec0ef){_0x2bd84d+=_0x578b81(0xa6)+_0x578b81(0x9a)+_0x4ec0ef[_0x55be40]+_0x578b81(0x170)+_0x578b81(0x9a)+_0x11e716[_0x55be40]+_0x578b81(0x170)+'</tr>';}console['log'](_0x578b81(0xa4),_0x2bd84d),_0x5f4ecf['flash'](_0x578b81(0xab),_0x578b81(0x152)),_0x415c10[_0x578b81(0x9b)](_0x578b81(0xcc)+_0x5eeca5[_0x578b81(0x7d)]);}catch(_0x60caff){console[_0x578b81(0x133)](_0x60caff);}}),router[a0_0x2db548(0x6d)](a0_0x2db548(0x175),auth,async(_0x3d5c7b,_0x4e4b6c)=>{var _0x45af98=a0_0x2db548;try{const {username:_0x1eff5e,email:_0x31142e,role:_0x2007f4}=_0x3d5c7b['user'],_0x36da30=_0x3d5c7b['user'],_0x45e6d7=await profile[_0x45af98(0xb8)]({'email':_0x36da30['email']}),_0x2bef96=await master_shop['find'](),_0x3c5179=_0x3d5c7b[_0x45af98(0x15e)]['id'],_0x11638d=await sales_finished[_0x45af98(0x86)](_0x3c5179),_0x18431b=await warehouse[_0x45af98(0x113)]([{'$match':{'name':_0x11638d[_0x45af98(0xd7)]}},{'$unwind':_0x45af98(0xea)},{'$group':{'_id':_0x45af98(0xd0),'name':{'$first':_0x45af98(0x14b)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x45af98(0xf3)},'bin':{'$first':_0x45af98(0x17e)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x45af98(0x90)},'primary_code':{'$first':_0x45af98(0xf2)},'secondary_code':{'$first':_0x45af98(0xcf)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x45af98(0xfd)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x45af98(0x16b)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x45af98(0xb7)},'room':{'$first':_0x45af98(0x14c)},'room_data':{'$first':_0x45af98(0x8e)}}}]),_0x553ee7=await customer['find']({});let _0x3a4f64;if(_0x36da30['role']==_0x45af98(0x8b)){const _0x400eb6=await staff['findOne']({'email':_0x36da30[_0x45af98(0x7f)]});_0x3a4f64=await warehouse[_0x45af98(0x113)]([{'$match':{'status':'Enabled','name':_0x400eb6[_0x45af98(0x14e)]}},{'$group':{'_id':'$name','name':{'$first':_0x45af98(0x15a)}}}]);}else _0x3a4f64=await warehouse[_0x45af98(0x113)]([{'$match':{'status':_0x45af98(0xa9)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x484750=await product[_0x45af98(0x141)]({});if(_0x2bef96[0x0][_0x45af98(0x119)]==_0x45af98(0x132)){var _0x3fe990=users[_0x45af98(0x13e)];console[_0x45af98(0x133)](_0x3fe990);}else{if(_0x2bef96[0x0][_0x45af98(0x119)]==_0x45af98(0xfa))var _0x3fe990=users[_0x45af98(0xfa)];else{if(_0x2bef96[0x0][_0x45af98(0x119)]==_0x45af98(0xa5))var _0x3fe990=users[_0x45af98(0xa5)];else{if(_0x2bef96[0x0][_0x45af98(0x119)]==_0x45af98(0x8c))var _0x3fe990=users[_0x45af98(0x8c)];else{if(_0x2bef96[0x0][_0x45af98(0x119)]==_0x45af98(0xe2))var _0x3fe990=users['French'];else{if(_0x2bef96[0x0][_0x45af98(0x119)]==_0x45af98(0xde))var _0x3fe990=users[_0x45af98(0xe5)];else{if(_0x2bef96[0x0][_0x45af98(0x119)]==_0x45af98(0xff))var _0x3fe990=users['Chinese'];else{if(_0x2bef96[0x0]['language']==_0x45af98(0x147))var _0x3fe990=users['Arabic'];}}}}}}}_0x4e4b6c[_0x45af98(0xd8)](_0x45af98(0xbc),{'success':_0x3d5c7b[_0x45af98(0x84)](_0x45af98(0xab)),'errors':_0x3d5c7b[_0x45af98(0x84)](_0x45af98(0x12c)),'role':_0x36da30,'profile':_0x45e6d7,'customer':_0x553ee7,'warehouse':_0x3a4f64,'product':_0x18431b,'user':_0x11638d,'master_shop':_0x2bef96,'unit':_0x484750,'language':_0x3fe990});}catch(_0x903da6){console[_0x45af98(0x133)](_0x903da6);}}),router[a0_0x2db548(0xbb)]('/preview/:id',auth,async(_0x4f2d86,_0x166f09)=>{var _0xb10680=a0_0x2db548;try{const _0x17b995=_0x4f2d86[_0xb10680(0x15e)]['id'],{invoice:_0x1f916a,warehouse_name:_0xd10af5,room:_0x2178e1}=_0x4f2d86[_0xb10680(0x17a)],_0x5bdbb6=await sales_finished[_0xb10680(0xb8)]({'invoice':_0x1f916a}),_0xb40946=_0x5bdbb6['sale_product']['map'](async _0x3131d9=>{var _0x5c4452=_0xb10680,_0x159593=await warehouse[_0x5c4452(0xb8)]({'name':_0xd10af5,'room':_0x3131d9['room_name'],'warehouse_category':_0x5c4452(0xe8)});const _0x4ee334=_0x159593[_0x5c4452(0x166)][_0x5c4452(0x167)](_0x473ba6=>{var _0x5ea3e5=_0x5c4452;_0x473ba6['product_name']==_0x3131d9['product_name']&&_0x473ba6[_0x5ea3e5(0x131)]==_0x3131d9[_0x5ea3e5(0x131)]&&_0x473ba6[_0x5ea3e5(0x178)]==_0x3131d9['expiry_date']&&_0x473ba6[_0x5ea3e5(0xa7)]==_0x3131d9['production_date']&&_0x473ba6['batch_code']==_0x3131d9[_0x5ea3e5(0x68)]&&_0x473ba6[_0x5ea3e5(0x7d)]==_0x3131d9['id_transaction_from']&&(_0x473ba6[_0x5ea3e5(0xe6)]>0x0&&(console[_0x5ea3e5(0x133)](_0x473ba6[_0x5ea3e5(0x104)]+_0x5ea3e5(0x92)+_0x3131d9[_0x5ea3e5(0x104)]+_0x5ea3e5(0x127)+_0x473ba6[_0x5ea3e5(0x131)]+_0x5ea3e5(0x92)+_0x3131d9[_0x5ea3e5(0x131)]+_0x5ea3e5(0x127)+_0x473ba6['production_date']+_0x5ea3e5(0x92)+_0x3131d9['production_date']+_0x5ea3e5(0x127)+_0x473ba6[_0x5ea3e5(0x178)]+_0x5ea3e5(0x92)+_0x3131d9['expiry_date']+_0x5ea3e5(0x127)+_0x473ba6[_0x5ea3e5(0x68)]+_0x5ea3e5(0x92)+_0x3131d9[_0x5ea3e5(0x68)]+_0x5ea3e5(0x127)+_0x473ba6['invoice']+'\x20==\x20'+_0x3131d9[_0x5ea3e5(0x111)]+_0x5ea3e5(0x127)+_0x473ba6['product_stock']+_0x5ea3e5(0xf4)+_0x3131d9[_0x5ea3e5(0x160)]+_0x5ea3e5(0x122)+_0x3131d9[_0x5ea3e5(0xfe)]+_0x5ea3e5(0x127)+_0x473ba6[_0x5ea3e5(0x7d)]+_0x5ea3e5(0x92)+_0x3131d9['id_transaction_from']),_0x473ba6[_0x5ea3e5(0xe6)]=Math['max'](0x0,Math[_0x5ea3e5(0x11f)](_0x473ba6[_0x5ea3e5(0xe6)])-Math[_0x5ea3e5(0x11f)](_0x3131d9[_0x5ea3e5(0x160)]))));});return _0x159593;});Promise['all'](_0xb40946)[_0xb10680(0x143)](async _0x5a3e03=>{var _0x336b26=_0xb10680;try{for(const _0x575c73 of _0x5a3e03){await _0x575c73[_0x336b26(0x110)]();}_0x5bdbb6[_0x336b26(0x93)]=_0x336b26(0xcd);const _0x3dd2f9=await _0x5bdbb6[_0x336b26(0x110)](),_0x3cae69=await master_shop['find'](),_0x2df62c=await email_settings[_0x336b26(0xb8)](),_0x2822fe=await supervisor_settings[_0x336b26(0x141)]();var _0x1fec4d=_0x5bdbb6['sale_product'],_0x47a388='',_0xcd2201;for(_0xcd2201 in _0x1fec4d){var _0x44cf61='FG';_0x5bdbb6['warehouse_name']=='DRY\x20GOODS'&&(_0x44cf61='DG'),_0x47a388+='<tr>'+_0x336b26(0x9a)+_0x1fec4d[_0xcd2201][_0x336b26(0x104)]+_0x336b26(0x170)+_0x336b26(0x9a)+_0x1fec4d[_0xcd2201][_0x336b26(0xa3)]+'</td>'+_0x336b26(0x9a)+_0x1fec4d[_0xcd2201][_0x336b26(0x160)]+_0x336b26(0x170)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1fec4d[_0xcd2201][_0x336b26(0xd6)]+'</td>'+_0x336b26(0x9a)+_0x1fec4d[_0xcd2201][_0x336b26(0xd1)]+'</td>'+_0x336b26(0x9a)+_0x5bdbb6['warehouse_name']+_0x336b26(0x170)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1fec4d[_0xcd2201][_0x336b26(0xfe)]+_0x336b26(0x170)+_0x336b26(0x9a)+_0x44cf61+_0x1fec4d[_0xcd2201][_0x336b26(0x131)]+_0x336b26(0x170);}let _0x579684=nodemailer[_0x336b26(0xef)]({'host':_0x2df62c[_0x336b26(0xc9)],'port':Number(_0x2df62c[_0x336b26(0xf0)]),'secure':![],'auth':{'user':_0x2df62c[_0x336b26(0x7f)],'pass':_0x2df62c[_0x336b26(0x107)]}}),_0x1a4722={'from':_0x2df62c[_0x336b26(0x7f)],'to':_0x2822fe[0x0]['FGSEmail'],'subject':_0x336b26(0xe9),'attachments':[{'filename':_0x336b26(0x157),'path':__dirname+_0x336b26(0xc3)+_0x336b26(0xcb)+_0x3cae69[0x0][_0x336b26(0xa1)],'cid':_0x336b26(0x73)}],'html':_0x336b26(0x6c)+'<html><head><title></title>'+'</head><body>'+_0x336b26(0x6e)+_0x336b26(0x163)+_0x336b26(0x6e)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x336b26(0x6e)+'<h2>\x20'+_0x3cae69[0x0][_0x336b26(0x82)]+_0x336b26(0x112)+'</div>'+_0x336b26(0x10b)+_0x336b26(0x101)+'<div>'+_0x336b26(0xf7)+'\x20Order\x20Number\x20:\x20'+_0x5bdbb6['invoice']+'\x20'+_0x336b26(0x89)+'\x20Order\x20Date\x20:\x20'+_0x5bdbb6[_0x336b26(0x11b)]+'\x20'+_0x336b26(0x150)+'</h5>'+_0x336b26(0x10b)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x336b26(0x120)+_0x336b26(0xa6)+_0x336b26(0x179)+_0x336b26(0x12a)+_0x336b26(0xc4)+_0x336b26(0x15c)+_0x336b26(0xb5)+_0x336b26(0x17b)+_0x336b26(0xc5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x336b26(0xba)+_0x336b26(0x109)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x47a388+'\x20'+_0x336b26(0xdb)+_0x336b26(0xf8)+_0x336b26(0x6e)+_0x336b26(0x124)+_0x336b26(0x102)+_0x3cae69[0x0][_0x336b26(0x82)]+_0x336b26(0x11a)+_0x336b26(0x10b)+_0x336b26(0x10b)+_0x336b26(0x74)};_0x579684[_0x336b26(0x88)](_0x1a4722,function(_0x4bdae0,_0x1962aa){var _0x2e46a7=_0x336b26;_0x4bdae0?(console[_0x2e46a7(0x133)](_0x4bdae0),console['log'](_0x2e46a7(0xe1))):console[_0x2e46a7(0x133)]('Email\x20sent\x20successfully');}),_0x4f2d86[_0x336b26(0x84)]('success',_0x336b26(0xb2)),_0x166f09[_0x336b26(0x9b)](_0x336b26(0x16d)+_0x17b995);}catch(_0xd2f190){console[_0x336b26(0xd3)](_0xd2f190),_0x166f09[_0x336b26(0x174)](0x1f4)[_0x336b26(0xce)]({'error':_0x336b26(0x161)});}})['catch'](_0x3672d3=>{var _0x448295=_0xb10680;console[_0x448295(0xd3)](_0x3672d3),_0x166f09[_0x448295(0x174)](0x1f4)['json']({'error':_0x448295(0x96)});});}catch(_0x17457a){console[_0xb10680(0x133)](_0x17457a);}}),router['get'](a0_0x2db548(0x12e),auth,async(_0x1da227,_0x2f1b06)=>{var _0x5b428b=a0_0x2db548;try{const {username:_0x345b03,email:_0x5eabdc,role:_0x536994}=_0x1da227[_0x5b428b(0x159)],_0x9b24de=_0x1da227[_0x5b428b(0x159)],_0x22b08a=await profile['findOne']({'email':_0x9b24de[_0x5b428b(0x7f)]}),_0x5f2410=await master_shop['find'](),_0x17ef30=_0x1da227[_0x5b428b(0x15e)]['id'],_0x994529=await sales_finished[_0x5b428b(0x86)](_0x17ef30);let _0x40f942=new Date(_0x994529['expiry_date']),_0x300f42=('0'+_0x40f942[_0x5b428b(0xb1)]())[_0x5b428b(0x142)](-0x2),_0x547550=('0'+(_0x40f942[_0x5b428b(0x85)]()+0x1))[_0x5b428b(0x142)](-0x2),_0x38b046=_0x40f942[_0x5b428b(0x75)](),_0x315246=_0x38b046+'-'+_0x547550+'-'+_0x300f42;var _0x57fffd=[_0x5b428b(0xd5),_0x5b428b(0xd9)];const _0x1fbc3e=await warehouse['aggregate']([{'$match':{'name':_0x994529[_0x5b428b(0xd7)],'room':_0x994529['room']}},{'$unwind':_0x5b428b(0xea)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5b428b(0x14b)},'product_stock':{'$first':_0x5b428b(0x83)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5b428b(0x17e)},'type':{'$first':_0x5b428b(0x15d)},'floorlevel':{'$first':_0x5b428b(0x90)},'primary_code':{'$first':_0x5b428b(0xf2)},'secondary_code':{'$first':_0x5b428b(0xcf)},'product_code':{'$first':_0x5b428b(0x106)},'storage':{'$first':_0x5b428b(0xfd)},'rack':{'$first':'$product_details.rack'}}}]),_0x54cde1=await customer[_0x5b428b(0x141)]({});let _0x2b115b;if(_0x9b24de[_0x5b428b(0x71)]==_0x5b428b(0x8b)){const _0x41abd4=await staff['findOne']({'email':_0x9b24de[_0x5b428b(0x7f)]});_0x2b115b=await warehouse[_0x5b428b(0x113)]([{'$match':{'status':_0x5b428b(0xa9),'name':_0x41abd4[_0x5b428b(0x14e)]}},{'$group':{'_id':_0x5b428b(0x15a),'name':{'$first':_0x5b428b(0x15a)}}}]);}else _0x2b115b=await warehouse[_0x5b428b(0x113)]([{'$match':{'status':_0x5b428b(0xa9)}},{'$group':{'_id':'$name','name':{'$first':_0x5b428b(0x15a)}}}]);const _0x3bc44f=await product['find']({});if(_0x5f2410[0x0]['language']=='English\x20(US)'){var _0x153f85=users[_0x5b428b(0x13e)];console[_0x5b428b(0x133)](_0x153f85);}else{if(_0x5f2410[0x0]['language']==_0x5b428b(0xfa))var _0x153f85=users[_0x5b428b(0xfa)];else{if(_0x5f2410[0x0]['language']==_0x5b428b(0xa5))var _0x153f85=users[_0x5b428b(0xa5)];else{if(_0x5f2410[0x0][_0x5b428b(0x119)]==_0x5b428b(0x8c))var _0x153f85=users[_0x5b428b(0x8c)];else{if(_0x5f2410[0x0][_0x5b428b(0x119)]==_0x5b428b(0xe2))var _0x153f85=users[_0x5b428b(0xe2)];else{if(_0x5f2410[0x0]['language']==_0x5b428b(0xde))var _0x153f85=users[_0x5b428b(0xe5)];else{if(_0x5f2410[0x0][_0x5b428b(0x119)]=='Chinese')var _0x153f85=users[_0x5b428b(0xff)];else{if(_0x5f2410[0x0][_0x5b428b(0x119)]==_0x5b428b(0x147))var _0x153f85=users[_0x5b428b(0x6a)];}}}}}}}_0x2f1b06[_0x5b428b(0xd8)](_0x5b428b(0x177),{'success':_0x1da227['flash'](_0x5b428b(0xab)),'errors':_0x1da227[_0x5b428b(0x84)]('errors'),'role':_0x9b24de,'profile':_0x22b08a,'customer':_0x54cde1,'warehouse':_0x2b115b,'product':_0x1fbc3e,'user':_0x994529,'master_shop':_0x5f2410,'unit':_0x3bc44f,'language':_0x153f85,'rooms_data':_0x57fffd,'ed_fullDate':_0x315246});}catch(_0x530634){console[_0x5b428b(0x133)](_0x530634);}}),router['post'](a0_0x2db548(0x12e),auth,async(_0x148114,_0x1c9d39)=>{var _0x4ade1c=a0_0x2db548;try{const _0x5bf5ab=_0x148114[_0x4ade1c(0x15e)]['id'],_0xbd388e=await sales_finished['findOne']({'_id':_0x148114[_0x4ade1c(0x15e)]['id']}),_0x3c04a3=await warehouse[_0x4ade1c(0xb8)]({'name':_0xbd388e['warehouse_name'],'room':_0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0x9c)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x3009fc,customer:_0xf1f32,date:_0x4ac24e,warehouse_name:_0x315420,product_name:_0xa9c600,stock:_0x6f915e,adjust_qty:_0x20e932,note:_0x58ecf8,room:_0x57fad4,primary_code:_0x2bb34c,secondary_code:_0x3cff42,prod_code:_0x11d65d,level:_0x184a92,isle:_0x3f6f76,pallet:_0x1a1500,expiry_date:_0x48fe20}=_0x148114[_0x4ade1c(0x17a)];if(typeof _0xa9c600==_0x4ade1c(0x14a))var _0x301ee9=[_0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0x104)]],_0x38aaaa=[_0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0x8a)]],_0x4b9792=[_0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0xb6)]],_0x3ae19e=[_0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0x108)]],_0x222448=[_0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0xbf)]],_0x5a20b5=[_0x148114[_0x4ade1c(0x17a)]['prod_code']],_0x508c55=[_0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0x16a)]],_0x1d7bb2=[_0x148114['body'][_0x4ade1c(0x178)]];else var _0x301ee9=[..._0x148114[_0x4ade1c(0x17a)]['product_name']],_0x38aaaa=[..._0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0x8a)]],_0x4b9792=[..._0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0xb6)]],_0x3ae19e=[..._0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0x108)]],_0x222448=[..._0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0xbf)]],_0x5a20b5=[..._0x148114[_0x4ade1c(0x17a)]['prod_code']],_0x508c55=[..._0x148114[_0x4ade1c(0x17a)]['level']],_0x1d7bb2=[..._0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0x178)]];const _0x17fe2b=_0x301ee9[_0x4ade1c(0x167)](_0x23ed42=>{return _0x23ed42={'product_name':_0x23ed42};});_0x38aaaa['forEach']((_0x247a02,_0x3847d5)=>{_0x17fe2b[_0x3847d5]['stock']=_0x247a02;}),_0x4b9792['forEach']((_0x2fafc7,_0x5e7e78)=>{var _0x3717bb=_0x4ade1c;_0x17fe2b[_0x5e7e78][_0x3717bb(0x160)]=_0x2fafc7;}),_0x3ae19e[_0x4ade1c(0x145)]((_0x71a6d1,_0x148a0b)=>{var _0x6f616d=_0x4ade1c;_0x17fe2b[_0x148a0b][_0x6f616d(0x108)]=_0x71a6d1;}),_0x222448[_0x4ade1c(0x145)]((_0x56dd8a,_0xeced2d)=>{var _0x17ac2b=_0x4ade1c;_0x17fe2b[_0xeced2d][_0x17ac2b(0xbf)]=_0x56dd8a;}),_0x5a20b5[_0x4ade1c(0x145)]((_0x143dce,_0x3e4c38)=>{var _0x16b7ea=_0x4ade1c;_0x17fe2b[_0x3e4c38][_0x16b7ea(0xa3)]=_0x143dce;}),_0x508c55[_0x4ade1c(0x145)]((_0x3fbfd2,_0x1cd395)=>{_0x17fe2b[_0x1cd395]['level']=_0x3fbfd2;}),_0x1d7bb2[_0x4ade1c(0x145)]((_0x5a0ee6,_0x56749c)=>{var _0x233e50=_0x4ade1c;_0x17fe2b[_0x56749c][_0x233e50(0x178)]=_0x5a0ee6;});var _0x4b1f40=0x0;_0x17fe2b[_0x4ade1c(0x145)](_0xa8e807=>{var _0x1e2119=_0x4ade1c;console[_0x1e2119(0x133)]('foreach\x20newproduct',_0xa8e807),(parseInt(_0xa8e807[_0x1e2119(0x8a)])<parseInt(_0xa8e807[_0x1e2119(0x160)])||parseInt(_0xa8e807[_0x1e2119(0x160)])==0x0)&&_0x4b1f40++;});if(_0x4b1f40!=0x0)return _0x148114[_0x4ade1c(0x84)](_0x4ade1c(0x12c),_0x4ade1c(0x79)),_0x1c9d39[_0x4ade1c(0x9b)](_0x4ade1c(0x10f));_0xbd388e[_0x4ade1c(0x8f)][_0x4ade1c(0x145)](_0x48bd05=>{var _0x4b1a99=_0x4ade1c;const _0x38b8b8=_0x3c04a3[_0x4b1a99(0x166)]['map'](_0xc68543=>{var _0x392eac=_0x4b1a99;_0xc68543[_0x392eac(0x104)]==_0x48bd05[_0x392eac(0x104)]&&_0xc68543[_0x392eac(0x131)]==_0x48bd05[_0x392eac(0x131)]&&(_0xc68543[_0x392eac(0xe6)]=parseInt(_0xc68543['product_stock'])+parseInt(_0x48bd05[_0x392eac(0x160)]));});}),await _0x3c04a3[_0x4ade1c(0x110)]();const _0x12a951=_0x17fe2b['filter'](_0x16a67b=>_0x16a67b[_0x4ade1c(0x160)]!=='0'&&_0x16a67b[_0x4ade1c(0x160)]!=='');_0xbd388e['invoice']=_0x3009fc,_0xbd388e['customer']=_0xf1f32,_0xbd388e[_0x4ade1c(0x11b)]=_0x4ac24e,_0xbd388e['warehouse_name']=_0x315420,_0xbd388e[_0x4ade1c(0x8f)]=_0x12a951,_0xbd388e[_0x4ade1c(0x125)]=_0x58ecf8,_0xbd388e['room']=_0x57fad4;const _0x572608=await _0xbd388e[_0x4ade1c(0x110)](),_0x26e8b7=await sales_finished[_0x4ade1c(0xb8)]({'_id':_0x148114[_0x4ade1c(0x15e)]['id']}),_0x122f67=await warehouse[_0x4ade1c(0xb8)]({'name':_0x315420,'room':_0x57fad4,'warehouse_category':_0x4ade1c(0xe8)});_0x26e8b7[_0x4ade1c(0x8f)][_0x4ade1c(0x145)](_0x19f9ef=>{var _0x3974fd=_0x4ade1c;const _0x2f6f46=_0x122f67[_0x3974fd(0x166)][_0x3974fd(0x167)](_0xe84250=>{var _0x204020=_0x3974fd;_0xe84250[_0x204020(0x104)]==_0x19f9ef['product_name']&&_0xe84250[_0x204020(0x131)]==_0x19f9ef[_0x204020(0x131)]&&(_0xe84250['product_stock']=parseInt(_0xe84250[_0x204020(0xe6)])-parseInt(_0x19f9ef[_0x204020(0x160)]));});}),console['log'](_0x4ade1c(0x137),_0x122f67),await _0x122f67[_0x4ade1c(0x110)]();const _0x25a21b=await c_payment_data[_0x4ade1c(0xb8)]({'invoice':_0x148114[_0x4ade1c(0x17a)][_0x4ade1c(0x111)]});_0x25a21b[_0x4ade1c(0x11e)]=_0x148114['body']['suppliers'],await _0x25a21b[_0x4ade1c(0x110)](),_0x148114[_0x4ade1c(0x84)](_0x4ade1c(0xab),_0x4ade1c(0xb2)),_0x1c9d39[_0x4ade1c(0x9b)]('/all_sales_finished/view');}catch(_0x4db269){console[_0x4ade1c(0x133)](_0x4db269);}}),router[a0_0x2db548(0xbb)](a0_0x2db548(0x146),auth,async(_0x4e8c18,_0x5f4ddc)=>{var _0x1aff78=a0_0x2db548;try{const _0x5b00ca=_0x4e8c18['params']['id'],{invoice:_0x5ddedd,customer:_0x2da180,receivable_amount:_0x195bbe,received_amount:_0x39a6a8}=_0x4e8c18[_0x1aff78(0x17a)],_0x47e42c=await sales[_0x1aff78(0x86)](_0x5b00ca);console[_0x1aff78(0x133)](_0x47e42c);var _0x31771f=_0x195bbe-_0x39a6a8;console[_0x1aff78(0x133)](_0x39a6a8),_0x47e42c[_0x1aff78(0x70)]=parseFloat(_0x39a6a8)+parseFloat(_0x47e42c[_0x1aff78(0x70)]),_0x47e42c[_0x1aff78(0xb3)]=_0x31771f,console['log'](_0x47e42c);const _0x5d6007=await _0x47e42c['save'](),_0x435f5b=await c_payment_data['findOne']({'invoice':_0x5ddedd});_0x435f5b[_0x1aff78(0xd2)]=_0x31771f,await _0x435f5b[_0x1aff78(0x110)]();let _0x5765ce=new Date(),_0x1777f2=('0'+_0x5765ce['getDate']())[_0x1aff78(0x142)](-0x2),_0x39bf89=('0'+(_0x5765ce['getMonth']()+0x1))[_0x1aff78(0x142)](-0x2),_0x2ce35c=_0x5765ce[_0x1aff78(0x75)](),_0x5e1f17=_0x2ce35c+'-'+_0x39bf89+'-'+_0x1777f2;const _0x590bd1=new customer_payment({'invoice':_0x5ddedd,'date':_0x2ce35c+'-'+_0x39bf89+'-'+_0x1777f2,'customer':_0x2da180,'reason':_0x1aff78(0xc7),'amount':_0x39a6a8}),_0x8bf6c4=await _0x590bd1[_0x1aff78(0x110)]();_0x4e8c18[_0x1aff78(0x84)](_0x1aff78(0xab),_0x1aff78(0x72)),_0x5f4ddc[_0x1aff78(0x9b)](_0x1aff78(0x16f));}catch(_0x16455b){console[_0x1aff78(0x133)](_0x16455b);}}),router[a0_0x2db548(0x6d)](a0_0x2db548(0x154),auth,async(_0x299935,_0x53e1ca)=>{var _0x376d42=a0_0x2db548;try{const {username:_0x5ba2a0,email:_0x1f6d0d,role:_0x20fbf9}=_0x299935['user'],_0x44e10b=_0x299935[_0x376d42(0x159)],_0xdf0bc4=await profile['findOne']({'email':_0x44e10b[_0x376d42(0x7f)]}),_0x4a3b37=await master_shop[_0x376d42(0x141)]();console['log'](_0x376d42(0x7e),_0x4a3b37);const _0x1f7271=_0x299935[_0x376d42(0x15e)]['id'],_0x11ee8a=await sales[_0x376d42(0x86)](_0x1f7271);console[_0x376d42(0x133)](_0x11ee8a);const _0x5c5f7b=await customer['findOne']({'name':_0x11ee8a[_0x376d42(0x7c)]});console[_0x376d42(0x133)](_0x5c5f7b);if(_0x4a3b37[0x0]['language']==_0x376d42(0x132)){var _0x12d479=users[_0x376d42(0x13e)];console[_0x376d42(0x133)](_0x12d479);}else{if(_0x4a3b37[0x0][_0x376d42(0x119)]==_0x376d42(0xfa))var _0x12d479=users[_0x376d42(0xfa)];else{if(_0x4a3b37[0x0][_0x376d42(0x119)]==_0x376d42(0xa5))var _0x12d479=users[_0x376d42(0xa5)];else{if(_0x4a3b37[0x0][_0x376d42(0x119)]==_0x376d42(0x8c))var _0x12d479=users[_0x376d42(0x8c)];else{if(_0x4a3b37[0x0][_0x376d42(0x119)]==_0x376d42(0xe2))var _0x12d479=users[_0x376d42(0xe2)];else{if(_0x4a3b37[0x0][_0x376d42(0x119)]==_0x376d42(0xde))var _0x12d479=users['Portuguese'];else{if(_0x4a3b37[0x0]['language']==_0x376d42(0xff))var _0x12d479=users['Chinese'];else{if(_0x4a3b37[0x0][_0x376d42(0x119)]==_0x376d42(0x147))var _0x12d479=users[_0x376d42(0x6a)];}}}}}}}_0x53e1ca[_0x376d42(0xd8)](_0x376d42(0x97),{'success':_0x299935[_0x376d42(0x84)](_0x376d42(0xab)),'errors':_0x299935[_0x376d42(0x84)](_0x376d42(0x12c)),'role':_0x44e10b,'profile':_0xdf0bc4,'master_shop':_0x4a3b37,'customers':_0x5c5f7b,'sales':_0x11ee8a,'language':_0x12d479});}catch(_0x4c166e){console[_0x376d42(0x133)](_0x4c166e);}}),router[a0_0x2db548(0x6d)](a0_0x2db548(0x10e),auth,async(_0x4dd3ea,_0x46b38c)=>{var _0x5ce256=a0_0x2db548;try{const {username:_0x5434c3,email:_0x84a5dc,role:_0x13ef2e}=_0x4dd3ea['user'],_0xf52409=_0x4dd3ea['user'],_0x4cb990=await profile['findOne']({'email':_0xf52409['email']}),_0x11f754=await master_shop[_0x5ce256(0x141)](),_0x21fe69=_0x4dd3ea[_0x5ce256(0x15e)]['id'],_0x4bb36e=await sales_finished[_0x5ce256(0x86)](_0x21fe69),_0x4fc15e=await warehouse[_0x5ce256(0x113)]([{'$match':{'name':_0x4bb36e['warehouse_name']}},{'$unwind':_0x5ce256(0xea)},{'$group':{'_id':_0x5ce256(0xd0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5ce256(0x83)},'bay':{'$first':_0x5ce256(0xf3)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5ce256(0x90)},'primary_code':{'$first':_0x5ce256(0xf2)},'secondary_code':{'$first':_0x5ce256(0xcf)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5ce256(0xfd)},'rack':{'$first':_0x5ce256(0x7a)},'expiry_date':{'$first':_0x5ce256(0x16b)},'production_date':{'$first':_0x5ce256(0x11c)},'unit':{'$first':_0x5ce256(0x78)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0x5ce256(0xe7)},'batch_code':{'$first':_0x5ce256(0xb7)},'maxPerUnit':{'$first':_0x5ce256(0xaa)}}}]),_0x180d5d=await product[_0x5ce256(0x141)]({}),_0x3bd167=await warehouse[_0x5ce256(0x113)]([{'$match':{'status':'Enabled','warehouse_category':_0x5ce256(0xe8),'name':{'$ne':'Return\x20Goods','$ne':_0x5ce256(0x126)}}},{'$group':{'_id':_0x5ce256(0x15a),'name':{'$first':_0x5ce256(0x15a)}}},{'$sort':{'name':0x1}}]);var _0x39aa48=['Return\x20Rooms'];const _0x72cb6d=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x5ce256(0x126)}},{'$group':{'_id':_0x5ce256(0x15a),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x11f754[0x0][_0x5ce256(0x119)]=='English\x20(US)'){var _0xe4e05f=users[_0x5ce256(0x13e)];console[_0x5ce256(0x133)](_0xe4e05f);}else{if(_0x11f754[0x0]['language']=='Hindi')var _0xe4e05f=users[_0x5ce256(0xfa)];else{if(_0x11f754[0x0][_0x5ce256(0x119)]==_0x5ce256(0xa5))var _0xe4e05f=users['German'];else{if(_0x11f754[0x0]['language']=='Spanish')var _0xe4e05f=users['Spanish'];else{if(_0x11f754[0x0]['language']==_0x5ce256(0xe2))var _0xe4e05f=users[_0x5ce256(0xe2)];else{if(_0x11f754[0x0][_0x5ce256(0x119)]=='Portuguese\x20(BR)')var _0xe4e05f=users[_0x5ce256(0xe5)];else{if(_0x11f754[0x0]['language']==_0x5ce256(0xff))var _0xe4e05f=users[_0x5ce256(0xff)];else{if(_0x11f754[0x0][_0x5ce256(0x119)]==_0x5ce256(0x147))var _0xe4e05f=users[_0x5ce256(0x6a)];}}}}}}}_0x46b38c[_0x5ce256(0xd8)]('return_sale_finished',{'success':_0x4dd3ea[_0x5ce256(0x84)](_0x5ce256(0xab)),'errors':_0x4dd3ea[_0x5ce256(0x84)](_0x5ce256(0x12c)),'role':_0xf52409,'profile':_0x4cb990,'user':_0x4bb36e,'stock':_0x4fc15e,'master_shop':_0x11f754,'unit':_0x180d5d,'language':_0xe4e05f,'warehouses':_0x3bd167,'rooms':_0x39aa48,'warehouse_QA':_0x72cb6d});}catch(_0x404790){console[_0x5ce256(0x133)](_0x404790),_0x46b38c[_0x5ce256(0x174)](0xc8)[_0x5ce256(0xce)]({'message':_0x404790[_0x5ce256(0x6f)]});}}),router[a0_0x2db548(0xbb)](a0_0x2db548(0x10e),auth,async(_0x565875,_0x4f74af)=>{var _0x3c14e7=a0_0x2db548;if(_0x565875['body'][_0x3c14e7(0x16c)]=='QA')try{const {invoice:_0x271f59,date:_0x36a9aa,warehouse_name:_0x3fc564,product_name:_0x488328,primary_code:_0x3c8004,secondary_code:_0x202005,product_code:_0x3f2ee9,sales_quantity:_0x24eaf7,stocks:_0x337487,return_qty:_0x2b0cf5,Room_name:_0x47ebc0,to_warehouse_name_QA:_0x3af58f,to_Room_name_QA:_0x343941,note:_0x3860b9,for_categorize:_0x5ac6f5,product_name_QA1:_0x451876}=_0x565875[_0x3c14e7(0x17a)];if(typeof _0x451876==_0x3c14e7(0x14a))var _0x37b1af=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x138)]],_0x323923=[_0x565875['body'][_0x3c14e7(0x91)]],_0x21bbac=[_0x565875['body'][_0x3c14e7(0x98)]],_0x239f6e=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x16e)]],_0x403b6c=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0xc0)]],_0x1e8559=[_0x565875[_0x3c14e7(0x17a)]['stocks_QA']],_0xd7859a=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0xca)]],_0x2a8eaf=[_0x565875[_0x3c14e7(0x17a)]['maxPerUnit_QA']],_0xc7145f=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x169)]],_0x47470d=[_0x565875[_0x3c14e7(0x17a)]['batch_code_QA']],_0x1ce4d9=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0xeb)]],_0x4710c3=[_0x565875['body'][_0x3c14e7(0x118)]],_0x1fe083=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x148)]],_0x47b6b5=[_0x565875[_0x3c14e7(0x17a)]['expiry_date_QA']];else var _0x37b1af=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x138)]],_0x323923=[..._0x565875[_0x3c14e7(0x17a)]['primary_code_QA']],_0x21bbac=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x98)]],_0x239f6e=[..._0x565875['body'][_0x3c14e7(0x16e)]],_0x403b6c=[..._0x565875['body']['sales_quantity_QA']],_0x1e8559=[..._0x565875[_0x3c14e7(0x17a)]['stocks_QA']],_0xd7859a=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0xca)]],_0x2a8eaf=[..._0x565875[_0x3c14e7(0x17a)]['maxPerUnit_QA']],_0xc7145f=[..._0x565875['body'][_0x3c14e7(0x169)]],_0x47470d=[..._0x565875['body'][_0x3c14e7(0xfb)]],_0x1ce4d9=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0xeb)]],_0x4710c3=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x118)]],_0x1fe083=[..._0x565875[_0x3c14e7(0x17a)]['production_date_QA']],_0x47b6b5=[..._0x565875['body'][_0x3c14e7(0xe0)]];const _0x45ddfb=_0x37b1af[_0x3c14e7(0x167)](_0x2b3070=>{return _0x2b3070={'product_name':_0x2b3070};});_0x323923[_0x3c14e7(0x145)]((_0x16bcd4,_0x17241b)=>{var _0x30698e=_0x3c14e7;_0x45ddfb[_0x17241b][_0x30698e(0x108)]=_0x16bcd4;}),_0x21bbac[_0x3c14e7(0x145)]((_0x3a6a28,_0xee44ba)=>{var _0x4d24d2=_0x3c14e7;_0x45ddfb[_0xee44ba][_0x4d24d2(0xbf)]=_0x3a6a28;}),_0x239f6e['forEach']((_0x1c3f23,_0x5c6094)=>{var _0x3b7ab0=_0x3c14e7;_0x45ddfb[_0x5c6094][_0x3b7ab0(0xa3)]=_0x1c3f23;}),_0x403b6c[_0x3c14e7(0x145)]((_0x34fe07,_0xaed98f)=>{var _0x57dfa2=_0x3c14e7;_0x45ddfb[_0xaed98f][_0x57dfa2(0xae)]=_0x34fe07;}),_0x1e8559[_0x3c14e7(0x145)]((_0x138a2a,_0x1100cc)=>{_0x45ddfb[_0x1100cc]['stock']=_0x138a2a;}),_0xd7859a[_0x3c14e7(0x145)]((_0x192898,_0x5f187c)=>{_0x45ddfb[_0x5f187c]['return_qty']=_0x192898;}),_0x2a8eaf[_0x3c14e7(0x145)]((_0x58e9ea,_0x3e6117)=>{_0x45ddfb[_0x3e6117]['maxPerUnit']=_0x58e9ea;}),_0xc7145f[_0x3c14e7(0x145)]((_0x338e61,_0x5c41fa)=>{_0x45ddfb[_0x5c41fa]['maxProducts']=_0x338e61;}),_0x47470d[_0x3c14e7(0x145)]((_0x418fa0,_0x25cc4d)=>{var _0x80af99=_0x3c14e7;_0x45ddfb[_0x25cc4d][_0x80af99(0x68)]=_0x418fa0;}),_0x1ce4d9['forEach']((_0x401d6e,_0x5ed31a)=>{_0x45ddfb[_0x5ed31a]['secondary_unit']=_0x401d6e;}),_0x4710c3[_0x3c14e7(0x145)]((_0x3e427f,_0x59cd9c)=>{var _0xc7ad5e=_0x3c14e7;_0x45ddfb[_0x59cd9c][_0xc7ad5e(0xd6)]=_0x3e427f;}),_0x1fe083[_0x3c14e7(0x145)]((_0x12fbff,_0x6aba1a)=>{_0x45ddfb[_0x6aba1a]['production_date']=_0x12fbff;}),_0x47b6b5[_0x3c14e7(0x145)]((_0x4d5da5,_0x25c2ba)=>{var _0x1f4f8f=_0x3c14e7;_0x45ddfb[_0x25c2ba][_0x1f4f8f(0x178)]=_0x4d5da5;});const _0x91db8a=await sales_finished[_0x3c14e7(0xb8)]({'invoice':_0x271f59});_0x91db8a['return_data']='True';const _0x1597f7=await _0x91db8a[_0x3c14e7(0x110)](),_0x1ef9b7=new sales_return_finished({'invoice':_0x271f59,'customer':_0x565875[_0x3c14e7(0x17a)]['customer'],'date':_0x36a9aa,'warehouse_name':_0x3fc564,'room':_0x47ebc0,'ToWarehouse':_0x3af58f,'ToRoom':_0x343941,'return_sale_QA':_0x45ddfb,'note':_0x3860b9,'warehouse_cat':_0x5ac6f5}),_0x290a2c=await _0x1ef9b7[_0x3c14e7(0x110)](),_0x1b9b4e=await sales_return_finished[_0x3c14e7(0xb8)]({'invoice':_0x271f59}),_0x465928=await warehouse[_0x3c14e7(0xb8)]({'name':_0x3af58f,'room':_0x343941});_0x1b9b4e[_0x3c14e7(0x10d)]['forEach'](_0x39b88c=>{var _0x439027=_0x3c14e7,_0x99ede4=0x0;const _0x5519ee=_0x465928[_0x439027(0x166)]['map'](_0x2fbb30=>{var _0x461dc8=_0x439027;_0x2fbb30['product_name']==_0x39b88c['product_name']&&_0x2fbb30[_0x461dc8(0x178)]==_0x39b88c[_0x461dc8(0x178)]&&_0x2fbb30[_0x461dc8(0xa7)]==_0x39b88c[_0x461dc8(0xa7)]&&_0x2fbb30['batch_code']==_0x39b88c[_0x461dc8(0x68)]&&(_0x2fbb30['product_stock']=parseInt(_0x2fbb30[_0x461dc8(0xe6)])+parseInt(_0x39b88c[_0x461dc8(0x17c)]),_0x99ede4++);});_0x99ede4=='0'&&(_0x465928[_0x439027(0x166)]=_0x465928[_0x439027(0x166)]['concat']({'product_name':_0x39b88c['product_name'],'product_stock':_0x39b88c[_0x439027(0x17c)],'primary_code':_0x39b88c[_0x439027(0x108)],'secondary_code':_0x39b88c[_0x439027(0xbf)],'product_code':_0x39b88c[_0x439027(0xa3)],'batch_code':_0x39b88c[_0x439027(0x68)],'maxPerUnit':_0x39b88c['maxPerUnit'],'production_date':_0x39b88c[_0x439027(0xa7)],'expiry_date':_0x39b88c[_0x439027(0x178)],'secondary_unit':_0x39b88c[_0x439027(0xd1)],'unit':_0x39b88c[_0x439027(0xd6)],'maxProducts':_0x39b88c['maxProducts'],'bay':_0x39b88c[_0x439027(0x131)]}));}),await _0x465928[_0x3c14e7(0x110)]();const _0x3db249=new c_payment_data({'invoice':_0x271f59,'customer':_0x565875['body'][_0x3c14e7(0x7c)],'reason':_0x3c14e7(0x105)});await _0x3db249[_0x3c14e7(0x110)]();const _0x928fab=await master_shop[_0x3c14e7(0x141)](),_0x1f21ac=await email_settings['findOne'](),_0x32c72d=await customer[_0x3c14e7(0xb8)]({'name':_0x565875['body']['customer']});_0x928fab[0x0][_0x3c14e7(0x12b)]==0x1?(right_currency=_0x928fab[0x0][_0x3c14e7(0x87)],left_currency=''):(right_currency='',left_currency=_0x928fab[0x0][_0x3c14e7(0x87)]);var _0x101202=_0x37b1af,_0x169b00=_0xd7859a,_0x5047a2='',_0x45e196;for(_0x45e196 in _0x101202){_0x5047a2+=_0x3c14e7(0xa6)+_0x3c14e7(0x9a)+_0x101202[_0x45e196]+'</td>'+_0x3c14e7(0x9a)+_0x169b00[_0x45e196]+_0x3c14e7(0x170)+'</tr>';}console[_0x3c14e7(0x133)](_0x3c14e7(0xa4),_0x5047a2);let _0x42db10=nodemailer['createTransport']({'service':_0x3c14e7(0xb4),'auth':{'user':_0x1f21ac[_0x3c14e7(0x7f)],'pass':_0x1f21ac['password']}}),_0x1a5c08={'from':_0x1f21ac[_0x3c14e7(0x7f)],'to':_0x32c72d[_0x3c14e7(0x7f)],'subject':_0x3c14e7(0x11d),'attachments':[{'filename':_0x3c14e7(0x157),'path':__dirname+_0x3c14e7(0xc3)+'/upload/'+_0x928fab[0x0][_0x3c14e7(0xa1)],'cid':'logo'}],'html':_0x3c14e7(0x6c)+_0x3c14e7(0x168)+_0x3c14e7(0xec)+_0x3c14e7(0x6e)+_0x3c14e7(0x163)+_0x3c14e7(0x6e)+_0x3c14e7(0xf5)+'</div>'+_0x3c14e7(0x6e)+_0x3c14e7(0x13f)+_0x928fab[0x0][_0x3c14e7(0x82)]+_0x3c14e7(0x112)+_0x3c14e7(0x10b)+_0x3c14e7(0x10b)+_0x3c14e7(0x101)+_0x3c14e7(0x6e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x3c14e7(0x144)+_0x271f59+'\x20'+_0x3c14e7(0x89)+'\x20Order\x20Date\x20:\x20'+_0x36a9aa+'\x20'+_0x3c14e7(0x150)+_0x3c14e7(0x11a)+_0x3c14e7(0x10b)+_0x3c14e7(0x171)+_0x3c14e7(0x120)+'<tr>'+_0x3c14e7(0x179)+_0x3c14e7(0xc1)+_0x3c14e7(0x13c)+_0x3c14e7(0x149)+_0x3c14e7(0xba)+'</thead>'+_0x3c14e7(0xda)+'\x20'+_0x5047a2+'\x20'+_0x3c14e7(0xdb)+_0x3c14e7(0xf8)+_0x3c14e7(0x6e)+_0x3c14e7(0x124)+'<h5>'+_0x928fab[0x0][_0x3c14e7(0x82)]+_0x3c14e7(0x11a)+'</div>'+_0x3c14e7(0x10b)+_0x3c14e7(0x74)};_0x42db10[_0x3c14e7(0x88)](_0x1a5c08,function(_0x2716b5,_0x159ab2){var _0x3f86ab=_0x3c14e7;_0x2716b5?(console[_0x3f86ab(0x133)](_0x2716b5),console['log'](_0x3f86ab(0xe1))):console[_0x3f86ab(0x133)]('Email\x20sent\x20successfully');}),_0x565875[_0x3c14e7(0x84)](_0x3c14e7(0xab),_0x3c14e7(0x140)),_0x4f74af[_0x3c14e7(0x9b)](_0x3c14e7(0xbd));}catch(_0x4d4028){_0x4f74af['status'](0xc8)[_0x3c14e7(0xce)]({'message1':_0x4d4028[_0x3c14e7(0x6f)]});}else{if(_0x565875['body'][_0x3c14e7(0x16c)]=='GS')try{const {invoice:_0x38b88a,date:_0x2e69e9,warehouse_name:_0x1c9c92,product_name:_0x593d21,primary_code:_0x52bee9,secondary_code:_0x57fe80,product_code:_0x14349c,sales_quantity:_0x43499a,stocks:_0x5c5e2a,return_qty:_0x30fc33,Room_name:_0x410c67,to_warehouse_name:_0x3ebc57,to_Room_name:_0x952c49,note:_0x2e44a5,level:_0x1a5ff4,isle:_0x4b9d88,pallet:_0x2b0188,for_categorize:_0x303a36}=_0x565875[_0x3c14e7(0x17a)];if(typeof _0x593d21==_0x3c14e7(0x14a))var _0x37b1af=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x104)]],_0x323923=[_0x565875['body']['primary_code']],_0x21bbac=[_0x565875[_0x3c14e7(0x17a)]['secondary_code']],_0x239f6e=[_0x565875['body'][_0x3c14e7(0xa3)]],_0x403b6c=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x77)]],_0xd7859a=[_0x565875[_0x3c14e7(0x17a)]['return_qty']],_0x2899f7=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x131)]],_0x2a8eaf=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x17d)]],_0xc7145f=[_0x565875[_0x3c14e7(0x17a)]['maxProducts']],_0x47470d=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x68)]],_0x1ce4d9=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0xd1)]],_0x4710c3=[_0x565875[_0x3c14e7(0x17a)]['unit']],_0x1fe083=[_0x565875[_0x3c14e7(0x17a)]['production_date']],_0x47b6b5=[_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x178)]];else var _0x37b1af=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x104)]],_0x323923=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x108)]],_0x21bbac=[..._0x565875['body'][_0x3c14e7(0xbf)]],_0x239f6e=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0xa3)]],_0x403b6c=[..._0x565875['body'][_0x3c14e7(0x77)]],_0xd7859a=[..._0x565875['body']['return_qty']],_0x2899f7=[..._0x565875['body'][_0x3c14e7(0x131)]],_0x2a8eaf=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x17d)]],_0xc7145f=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x12f)]],_0x47470d=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x68)]],_0x1ce4d9=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0xd1)]],_0x4710c3=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0xd6)]],_0x1fe083=[..._0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0xa7)]],_0x47b6b5=[..._0x565875['body']['expiry_date']];const _0x36ba40=_0x37b1af[_0x3c14e7(0x167)](_0x4ce684=>{return _0x4ce684={'product_name':_0x4ce684};});_0x323923['forEach']((_0x1a212d,_0x1bdc9c)=>{_0x36ba40[_0x1bdc9c]['primary_code']=_0x1a212d;}),_0x21bbac[_0x3c14e7(0x145)]((_0x35c436,_0x4f23d6)=>{var _0x34c2f7=_0x3c14e7;_0x36ba40[_0x4f23d6][_0x34c2f7(0xbf)]=_0x35c436;}),_0x239f6e[_0x3c14e7(0x145)]((_0x33afb7,_0x19f233)=>{var _0x2406c8=_0x3c14e7;_0x36ba40[_0x19f233][_0x2406c8(0xa3)]=_0x33afb7;}),_0x403b6c[_0x3c14e7(0x145)]((_0x25997,_0x53c38f)=>{_0x36ba40[_0x53c38f]['sale_qty']=_0x25997;}),_0xd7859a[_0x3c14e7(0x145)]((_0x13ebcf,_0x206ed9)=>{var _0x19ce0d=_0x3c14e7;_0x36ba40[_0x206ed9][_0x19ce0d(0x17c)]=_0x13ebcf;}),_0x2899f7[_0x3c14e7(0x145)]((_0x2afb80,_0x3eca3c)=>{_0x36ba40[_0x3eca3c]['bay']=_0x2afb80;}),_0x2a8eaf[_0x3c14e7(0x145)]((_0x51b431,_0x5682ff)=>{var _0xb7db06=_0x3c14e7;_0x36ba40[_0x5682ff][_0xb7db06(0x17d)]=_0x51b431;}),_0xc7145f[_0x3c14e7(0x145)]((_0x4ab8e8,_0x22c00b)=>{var _0x32475e=_0x3c14e7;_0x36ba40[_0x22c00b][_0x32475e(0x12f)]=_0x4ab8e8;}),_0x47470d[_0x3c14e7(0x145)]((_0x525810,_0x4b475a)=>{var _0x3fe7a3=_0x3c14e7;_0x36ba40[_0x4b475a][_0x3fe7a3(0x68)]=_0x525810;}),_0x1ce4d9[_0x3c14e7(0x145)]((_0x52f761,_0x53290b)=>{var _0x38a5be=_0x3c14e7;_0x36ba40[_0x53290b][_0x38a5be(0xd1)]=_0x52f761;}),_0x4710c3[_0x3c14e7(0x145)]((_0x2f819a,_0x372ea7)=>{var _0x396ae7=_0x3c14e7;_0x36ba40[_0x372ea7][_0x396ae7(0xd6)]=_0x2f819a;}),_0x1fe083[_0x3c14e7(0x145)]((_0x2ff83a,_0x421443)=>{var _0x4fa8f3=_0x3c14e7;_0x36ba40[_0x421443][_0x4fa8f3(0xa7)]=_0x2ff83a;}),_0x47b6b5[_0x3c14e7(0x145)]((_0x4d1cd0,_0xdd4dd6)=>{var _0x853bd6=_0x3c14e7;_0x36ba40[_0xdd4dd6][_0x853bd6(0x178)]=_0x4d1cd0;});var _0x4d9ba6=0x0;_0x36ba40['forEach'](_0x434cf3=>{var _0x2eea99=_0x3c14e7;(parseInt(_0x434cf3[_0x2eea99(0xae)])<parseInt(_0x434cf3['return_qty'])||parseInt(_0x434cf3['stock'])<parseInt(_0x434cf3['return_qty'])&&parseInt(_0x434cf3['sale_qty'])>parseInt(_0x434cf3[_0x2eea99(0x17c)])||parseInt(_0x434cf3[_0x2eea99(0x17c)])==0x0)&&_0x4d9ba6++;});if(_0x4d9ba6!=0x0)return _0x565875[_0x3c14e7(0x84)]('errors',_0x3c14e7(0x10c)),_0x4f74af[_0x3c14e7(0x9b)]('back');const _0x5406ba=await sales_finished[_0x3c14e7(0xb8)]({'invoice':_0x38b88a});_0x5406ba[_0x3c14e7(0x9e)]=_0x3c14e7(0xcd);const _0x3c1290=await _0x5406ba['save'](),_0x52cef6=new sales_return_finished({'invoice':_0x38b88a,'customer':_0x565875['body']['customer'],'date':_0x2e69e9,'warehouse_name':_0x1c9c92,'room':_0x410c67,'ToWarehouse':_0x3ebc57,'ToRoom':_0x952c49,'return_sale':_0x36ba40,'note':_0x2e44a5,'warehouse_cat':_0x303a36}),_0x40f81f=await _0x52cef6[_0x3c14e7(0x110)](),_0x5571b2=await sales_return_finished['findOne']({'invoice':_0x38b88a}),_0xbdb0cc=await warehouse[_0x3c14e7(0xb8)]({'name':_0x3ebc57,'room':_0x952c49,'warehouse_category':_0x3c14e7(0xe8)});_0x5571b2[_0x3c14e7(0x69)][_0x3c14e7(0x145)](_0x5809ef=>{var _0xa9555e=_0x3c14e7,_0x5d8036=0x0;const _0x5b2419=_0xbdb0cc[_0xa9555e(0x166)][_0xa9555e(0x167)](_0x40f8c7=>{var _0x247e9e=_0xa9555e;_0x40f8c7[_0x247e9e(0x104)]==_0x5809ef[_0x247e9e(0x104)]&&_0x40f8c7[_0x247e9e(0x131)]==_0x5809ef['bay']&&_0x40f8c7[_0x247e9e(0x178)]==_0x5809ef['expiry_date']&&_0x40f8c7[_0x247e9e(0xa7)]==_0x5809ef[_0x247e9e(0xa7)]&&_0x40f8c7[_0x247e9e(0x68)]==_0x5809ef['batch_code']&&(_0x40f8c7[_0x247e9e(0xe6)]=parseInt(_0x40f8c7[_0x247e9e(0xe6)])+parseInt(_0x5809ef[_0x247e9e(0x17c)]),_0x5d8036++);});_0x5d8036=='0'&&(_0xbdb0cc[_0xa9555e(0x166)]=_0xbdb0cc['product_details']['concat']({'product_name':_0x5809ef[_0xa9555e(0x104)],'product_stock':_0x5809ef['return_qty'],'primary_code':_0x5809ef[_0xa9555e(0x108)],'secondary_code':_0x5809ef[_0xa9555e(0xbf)],'product_code':_0x5809ef['product_code'],'bay':_0x5809ef[_0xa9555e(0x131)],'batch_code':_0x5809ef['batch_code'],'maxPerUnit':_0x5809ef[_0xa9555e(0x17d)],'production_date':_0x5809ef[_0xa9555e(0xa7)],'expiry_date':_0x5809ef[_0xa9555e(0x178)],'secondary_unit':_0x5809ef[_0xa9555e(0xd1)],'unit':_0x5809ef[_0xa9555e(0xd6)],'maxProducts':_0x5809ef['maxProducts']}));}),await _0xbdb0cc[_0x3c14e7(0x110)](),console[_0x3c14e7(0x133)](_0x565875[_0x3c14e7(0x17a)]);const _0x393b5a=new c_payment_data({'invoice':_0x38b88a,'customer':_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x7c)],'reason':'Sale\x20Return'});await _0x393b5a[_0x3c14e7(0x110)]();const _0x44ee3f=await master_shop[_0x3c14e7(0x141)]();console[_0x3c14e7(0x133)](_0x3c14e7(0x115),_0x44ee3f[0x0][_0x3c14e7(0xa1)]);const _0x218eb3=await email_settings[_0x3c14e7(0xb8)](),_0x1226f2=await customer[_0x3c14e7(0xb8)]({'name':_0x565875[_0x3c14e7(0x17a)][_0x3c14e7(0x7c)]});console[_0x3c14e7(0x133)](_0x3c14e7(0xd4),_0x1226f2);_0x44ee3f[0x0][_0x3c14e7(0x12b)]==0x1?(right_currency=_0x44ee3f[0x0][_0x3c14e7(0x87)],left_currency=''):(right_currency='',left_currency=_0x44ee3f[0x0][_0x3c14e7(0x87)]);var _0x101202=_0x37b1af,_0x169b00=_0xd7859a,_0x5047a2='',_0x45e196;for(_0x45e196 in _0x101202){_0x5047a2+=_0x3c14e7(0xa6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x101202[_0x45e196]+_0x3c14e7(0x170)+_0x3c14e7(0x9a)+_0x169b00[_0x45e196]+_0x3c14e7(0x170)+_0x3c14e7(0xba);}console[_0x3c14e7(0x133)](_0x3c14e7(0xa4),_0x5047a2);let _0x50ba83=nodemailer['createTransport']({'service':_0x3c14e7(0xb4),'auth':{'user':_0x218eb3['email'],'pass':_0x218eb3[_0x3c14e7(0x107)]}}),_0x38c653={'from':_0x218eb3[_0x3c14e7(0x7f)],'to':_0x1226f2[_0x3c14e7(0x7f)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x3c14e7(0x157),'path':__dirname+_0x3c14e7(0xc3)+'/upload/'+_0x44ee3f[0x0][_0x3c14e7(0xa1)],'cid':'logo'}],'html':_0x3c14e7(0x6c)+_0x3c14e7(0x168)+_0x3c14e7(0xec)+_0x3c14e7(0x6e)+_0x3c14e7(0x163)+_0x3c14e7(0x6e)+_0x3c14e7(0xf5)+_0x3c14e7(0x10b)+_0x3c14e7(0x6e)+_0x3c14e7(0x13f)+_0x44ee3f[0x0][_0x3c14e7(0x82)]+_0x3c14e7(0x112)+_0x3c14e7(0x10b)+_0x3c14e7(0x10b)+'<hr\x20class=\x22my-3\x22>'+_0x3c14e7(0x6e)+_0x3c14e7(0xf7)+_0x3c14e7(0x144)+_0x38b88a+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x2e69e9+'\x20'+_0x3c14e7(0x150)+_0x3c14e7(0x11a)+'</div>'+_0x3c14e7(0x171)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3c14e7(0xa6)+_0x3c14e7(0x179)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x3c14e7(0x13c)+_0x3c14e7(0x149)+_0x3c14e7(0xba)+_0x3c14e7(0x109)+_0x3c14e7(0xda)+'\x20'+_0x5047a2+'\x20'+'</tbody>'+_0x3c14e7(0xf8)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x3c14e7(0x102)+_0x44ee3f[0x0][_0x3c14e7(0x82)]+'</h5>'+'</div>'+_0x3c14e7(0x10b)+_0x3c14e7(0x74)};_0x50ba83[_0x3c14e7(0x88)](_0x38c653,function(_0x195ff5,_0xd445ee){var _0x12f912=_0x3c14e7;_0x195ff5?(console[_0x12f912(0x133)](_0x195ff5),console[_0x12f912(0x133)](_0x12f912(0xe1))):console[_0x12f912(0x133)]('Email\x20sent\x20successfully');}),_0x565875[_0x3c14e7(0x84)](_0x3c14e7(0xab),_0x3c14e7(0x140)),_0x4f74af[_0x3c14e7(0x9b)](_0x3c14e7(0xbd));}catch(_0x160698){console[_0x3c14e7(0x133)](_0x160698),_0x4f74af[_0x3c14e7(0x174)](0xc8)[_0x3c14e7(0xce)]({'message1':_0x160698[_0x3c14e7(0x6f)]});}}}),router[a0_0x2db548(0x6d)](a0_0x2db548(0xdf),auth,async(_0x433bad,_0x293a5e)=>{var _0x137dfb=a0_0x2db548;try{const {username:_0x315e33,email:_0x3b6236,role:_0x28e525}=_0x433bad['user'],_0x5cba8=_0x433bad[_0x137dfb(0x159)],_0x445b26=await profile['findOne']({'email':_0x5cba8['email']}),_0x4abe3b=await master_shop[_0x137dfb(0x141)]();console[_0x137dfb(0x133)](_0x137dfb(0x136),_0x4abe3b);const _0x22f4ac=_0x433bad[_0x137dfb(0x15e)]['id'],_0x13be89=await sales[_0x137dfb(0x86)](_0x22f4ac);console[_0x137dfb(0x133)](_0x137dfb(0x13d),_0x13be89);if(_0x4abe3b[0x0]['language']==_0x137dfb(0x132))var _0xa364f=users[_0x137dfb(0x13e)];else{if(_0x4abe3b[0x0][_0x137dfb(0x119)]==_0x137dfb(0xfa))var _0xa364f=users[_0x137dfb(0xfa)];else{if(_0x4abe3b[0x0]['language']=='German')var _0xa364f=users[_0x137dfb(0xa5)];else{if(_0x4abe3b[0x0][_0x137dfb(0x119)]==_0x137dfb(0x8c))var _0xa364f=users[_0x137dfb(0x8c)];else{if(_0x4abe3b[0x0][_0x137dfb(0x119)]==_0x137dfb(0xe2))var _0xa364f=users[_0x137dfb(0xe2)];else{if(_0x4abe3b[0x0][_0x137dfb(0x119)]==_0x137dfb(0xde))var _0xa364f=users[_0x137dfb(0xe5)];else{if(_0x4abe3b[0x0]['language']==_0x137dfb(0xff))var _0xa364f=users[_0x137dfb(0xff)];else{if(_0x4abe3b[0x0][_0x137dfb(0x119)]==_0x137dfb(0x147))var _0xa364f=users[_0x137dfb(0x6a)];}}}}}}}_0x293a5e[_0x137dfb(0xd8)](_0x137dfb(0x123),{'success':_0x433bad[_0x137dfb(0x84)](_0x137dfb(0xab)),'errors':_0x433bad[_0x137dfb(0x84)](_0x137dfb(0x12c)),'role':_0x5cba8,'profile':_0x445b26,'alldata':_0x13be89,'master_shop':_0x4abe3b,'language':_0xa364f});}catch(_0x2e0d06){console[_0x137dfb(0x133)](_0x2e0d06);}}),router[a0_0x2db548(0xbb)](a0_0x2db548(0x14d),async(_0x4de2cf,_0x39a714)=>{var _0x1529a8=a0_0x2db548;const {product_code:_0x1d7c93,warehouse_name:_0x17ef52,rooms_data:_0x453c8a,Roomslist:_0x47baf9}=_0x4de2cf[_0x1529a8(0x17a)],_0xd7306d=_0x47baf9[_0x1529a8(0xb9)](','),_0x300838=[];async function _0x1a586b(_0x4b90d1){var _0x58edd6=_0x1529a8;const _0x143cc3=await warehouse[_0x58edd6(0x113)]([{'$match':{'name':_0x17ef52,'room':_0x4b90d1}},{'$unwind':_0x58edd6(0xea)},{'$match':{'product_details.primary_code':_0x1d7c93}},{'$group':{'_id':_0x58edd6(0xd0),'name':{'$first':_0x58edd6(0x14b)},'product_stock':{'$first':_0x58edd6(0x83)},'primary_code':{'$first':_0x58edd6(0xf2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x58edd6(0x106)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x58edd6(0x15d)},'pallet':{'$first':_0x58edd6(0x90)},'unit':{'$first':_0x58edd6(0x78)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x58edd6(0x7a)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x58edd6(0xaa)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x58edd6(0x14c)},'invoice':{'$first':_0x58edd6(0x95)}}}]),_0x55cbf0=await warehouse[_0x58edd6(0x113)]([{'$match':{'name':_0x17ef52,'room':_0x4b90d1}},{'$unwind':_0x58edd6(0xea)},{'$match':{'product_details.secondary_code':_0x1d7c93}},{'$group':{'_id':_0x58edd6(0xd0),'name':{'$first':_0x58edd6(0x14b)},'product_stock':{'$first':_0x58edd6(0x83)},'primary_code':{'$first':_0x58edd6(0xf2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x58edd6(0x106)},'level':{'$first':_0x58edd6(0xf3)},'isle':{'$first':_0x58edd6(0x17e)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x58edd6(0xf6)},'storage':{'$first':_0x58edd6(0xfd)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x58edd6(0x16b)},'production_date':{'$first':_0x58edd6(0x11c)},'maxPerUnit':{'$first':_0x58edd6(0xaa)},'batch_code':{'$first':_0x58edd6(0xb7)},'product_cat':{'$first':_0x58edd6(0x9d)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x58edd6(0x14c)},'invoice':{'$first':_0x58edd6(0x95)}}}]);if(_0x143cc3[_0x58edd6(0x12d)]>0x0)_0x300838[_0x58edd6(0x162)](_0x143cc3);else _0x55cbf0[_0x58edd6(0x12d)]>0x0&&_0x300838[_0x58edd6(0x162)](_0x55cbf0);}const _0x253193=_0xd7306d['map'](_0x2e3d4d=>_0x1a586b(_0x2e3d4d));await Promise[_0x1529a8(0xa8)](_0x253193),_0x39a714[_0x1529a8(0xce)](_0x300838);}),module['exports']=router;