var a0_0x5a4c10=a0_0x39ca;(function(_0x226d8e,_0x38411b){var _0x1f8ec4=a0_0x39ca,_0x309dde=_0x226d8e();while(!![]){try{var _0x1df3f6=-parseInt(_0x1f8ec4(0x1fd))/0x1*(-parseInt(_0x1f8ec4(0x13b))/0x2)+parseInt(_0x1f8ec4(0x244))/0x3*(parseInt(_0x1f8ec4(0x16c))/0x4)+-parseInt(_0x1f8ec4(0x184))/0x5+-parseInt(_0x1f8ec4(0x19e))/0x6*(parseInt(_0x1f8ec4(0x239))/0x7)+-parseInt(_0x1f8ec4(0x1d3))/0x8*(parseInt(_0x1f8ec4(0x19c))/0x9)+parseInt(_0x1f8ec4(0x21c))/0xa+-parseInt(_0x1f8ec4(0x23e))/0xb*(-parseInt(_0x1f8ec4(0x22e))/0xc);if(_0x1df3f6===_0x38411b)break;else _0x309dde['push'](_0x309dde['shift']());}catch(_0x48be97){_0x309dde['push'](_0x309dde['shift']());}}}(a0_0x5a78,0x3b2f9));const express=require(a0_0x5a4c10(0x1b5)),app=express(),router=express[a0_0x5a4c10(0x17c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x5a4c10(0x232)),auth=require('../middleware/auth'),nodemailer=require('nodemailer'),users=require(a0_0x5a4c10(0x21d));router[a0_0x5a4c10(0x22f)]('/view',auth,async(_0x3d5a25,_0x4cd056)=>{var _0x2d7ff2=a0_0x5a4c10;try{const {username:_0x35e774,email:_0x1a6bd1,role:_0x417f9f}=_0x3d5a25[_0x2d7ff2(0x1f8)],_0x44d7c0=_0x3d5a25[_0x2d7ff2(0x1f8)],_0x3e81d6=await profile['findOne']({'email':_0x44d7c0['email']}),_0x2b171d=await master_shop[_0x2d7ff2(0x138)]();let _0x479cb1;if(_0x44d7c0['role']==_0x2d7ff2(0x14c)){const _0x5f050b=await staff[_0x2d7ff2(0x187)]({'email':_0x44d7c0[_0x2d7ff2(0x1d7)]});_0x479cb1=await sales_finished[_0x2d7ff2(0x22c)]([{'$lookup':{'from':_0x2d7ff2(0x1ec),'localField':_0x2d7ff2(0x173),'foreignField':_0x2d7ff2(0x134),'as':_0x2d7ff2(0x179)}},{'$unwind':_0x2d7ff2(0x23a)},{'$unwind':_0x2d7ff2(0x1b8)},{'$group':{'_id':_0x2d7ff2(0x235),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x2d7ff2(0x167)},'date':{'$first':_0x2d7ff2(0x1df)},'warehouse_name':{'$first':_0x2d7ff2(0x17e)},'sale_product':{'$push':_0x2d7ff2(0x1b8)},'note':{'$first':_0x2d7ff2(0x160)},'return_data':{'$first':_0x2d7ff2(0x172)},'customers_docs':{'$first':_0x2d7ff2(0x23a)},'total_saleproduct_quantity':{'$sum':_0x2d7ff2(0x169)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x2d7ff2(0x1f4)},'type':{'$addToSet':_0x2d7ff2(0x14a)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x2d7ff2(0x24f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x479cb1=await sales_finished[_0x2d7ff2(0x22c)]([{'$lookup':{'from':_0x2d7ff2(0x1ec),'localField':'customer','foreignField':_0x2d7ff2(0x134),'as':'customers_docs'}},{'$unwind':_0x2d7ff2(0x23a)},{'$unwind':_0x2d7ff2(0x1b8)},{'$group':{'_id':_0x2d7ff2(0x235),'invoice':{'$first':_0x2d7ff2(0x216)},'customers':{'$first':_0x2d7ff2(0x167)},'date':{'$first':_0x2d7ff2(0x1df)},'warehouse_name':{'$first':_0x2d7ff2(0x17e)},'sale_product':{'$push':_0x2d7ff2(0x1b8)},'note':{'$first':_0x2d7ff2(0x160)},'return_data':{'$first':_0x2d7ff2(0x172)},'customers_docs':{'$first':_0x2d7ff2(0x23a)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x2d7ff2(0x1ed)},'isle':{'$addToSet':_0x2d7ff2(0x1f4)},'type':{'$addToSet':_0x2d7ff2(0x14a)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x2d7ff2(0x24f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x2b171d[0x0][_0x2d7ff2(0x142)]=='English\x20(US)'){var _0x42f85f=users['English'];console[_0x2d7ff2(0x1e1)](_0x42f85f);}else{if(_0x2b171d[0x0][_0x2d7ff2(0x142)]==_0x2d7ff2(0x1cb))var _0x42f85f=users[_0x2d7ff2(0x1cb)];else{if(_0x2b171d[0x0][_0x2d7ff2(0x142)]==_0x2d7ff2(0x1f5))var _0x42f85f=users[_0x2d7ff2(0x1f5)];else{if(_0x2b171d[0x0]['language']==_0x2d7ff2(0x13c))var _0x42f85f=users[_0x2d7ff2(0x13c)];else{if(_0x2b171d[0x0][_0x2d7ff2(0x142)]==_0x2d7ff2(0x195))var _0x42f85f=users[_0x2d7ff2(0x195)];else{if(_0x2b171d[0x0][_0x2d7ff2(0x142)]==_0x2d7ff2(0x203))var _0x42f85f=users[_0x2d7ff2(0x1d4)];else{if(_0x2b171d[0x0]['language']=='Chinese')var _0x42f85f=users[_0x2d7ff2(0x212)];else{if(_0x2b171d[0x0][_0x2d7ff2(0x142)]==_0x2d7ff2(0x163))var _0x42f85f=users[_0x2d7ff2(0x206)];}}}}}}}_0x4cd056['render']('all_sales_finished',{'success':_0x3d5a25['flash'](_0x2d7ff2(0x20e)),'errors':_0x3d5a25[_0x2d7ff2(0x1b0)](_0x2d7ff2(0x143)),'sales':_0x479cb1,'profile':_0x3e81d6,'role':_0x44d7c0,'master_shop':_0x2b171d,'language':_0x42f85f});}catch(_0x1d9ed3){console[_0x2d7ff2(0x1e1)](_0x1d9ed3);}});function a0_0x39ca(_0xc128b7,_0x1bc34e){var _0x5a7894=a0_0x5a78();return a0_0x39ca=function(_0x39ca62,_0xde1aeb){_0x39ca62=_0x39ca62-0x133;var _0x459fb6=_0x5a7894[_0x39ca62];return _0x459fb6;},a0_0x39ca(_0xc128b7,_0x1bc34e);}async function getRandom8DigitNumber(){var _0x4e394f=a0_0x5a4c10;const _0x3e95ea=0x989680,_0x5d65fb=0x5f5e0ff,_0x13538b=Math['floor'](Math[_0x4e394f(0x1bf)]()*(_0x5d65fb-_0x3e95ea+0x1))+_0x3e95ea;var _0x403541;const _0x1089ef=await sales_finished['findOne']({'invoice':_0x4e394f(0x159)+_0x13538b});return _0x1089ef&&_0x1089ef[_0x4e394f(0x165)]>0x0?_0x403541=_0x4e394f(0x159)+_0x13538b:_0x403541=_0x4e394f(0x159)+_0x13538b,_0x403541;}function a0_0x5a78(){var _0x12645c=['expiry_date_QA','password','DRY\x20GOODS','$product_details.secondary_unit','Sales\x20Mail','aggregate','/all_sales_finished/view','12qNyJJv','get','English','id_transaction_from','../models/all_models','Return\x20Goods','Finished\x20Goods','$_id','False','$product_details.expiry_date','carton','96803yGPjdk','$customers_docs','$product_details.production_date','</tbody>','room','2069452qyDdcI','$name','<html><head><title></title>','maxPerUnit_QA','maxProducts_QA','product_details','1268247eFOXQH','</div>','<h2>\x20','</tr>','$product_details.maxPerUnit','production_date_QA','/../public','An\x20error\x20occurred\x20while\x20saving\x20data.','port','sales\x20item\x20return\x20successfull','English\x20(US)','$finalize','getFullYear','name','payment\x20successfull','save','\x20Order\x20Number\x20:\x20','find','all_sales_barcode','logo','30778ilfAYe','Spanish','forEach','maxProducts','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Sales\x20Update\x20successfully','/view/add_sales/:id','language','errors','max','prod_code','\x20&&\x20','$product_details.floorlevel','catch','site_title','$sale_product.type','master','staff','$product_details','/picking_list/pdf/','True','exports','sales_invoice','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','final','host','</span>','_id','status','OUTF-','product_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','redirect','add_sales_finished','<div>','<hr\x20class=\x22my-3\x22>','$note','$product_details.invoice','product_stock','Arabic\x20(ae)','edit_sales_finished_view','length','warehouse_name','$customer','$product_details.rack','$sale_product.quantity','Quality\x20Inspection','Sales\x20Add\x20successfully','4kZlcDG','/upload/','secondary_unit','$product_details.storage','unit','$product_details.product_name','$return_data','customer','gmail','batch_code','</head><body>','\x20<<<==>>>\x20','product_name','customers_docs','Error\x20Occurs','Sale\x20Return\x20Mail','Router','level','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','sales_quantity_QA','<strong>\x20Regards\x20</strong>','$product_details.bay','sales_quantity','1207760ylwPfg','sale_qty','edit_sales_finished','findOne','batch_code_QA','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','bay','error','christian.villamer@jakagroup.com','<h5>','return_qty','message','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$room','secondary_code_QA','abs','French','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','suppliers','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','back','/invoice/:id','9kjFBaE','barcode\x20user_id','30gAQKRt','<span\x20style=\x22float:\x20right;\x22>','prod_invoice','currency_placement','for_categorize','Logo.png','Sale','adjust_qty','note','product_code_QA','product_name_QA1','prod_cat','$product_details.bin','all','unit_QA','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','secondary_code','RoomAssigned','flash','<tbody\x20style=\x22text-align:\x20center;\x22>','</h5>','due_amount','string','express','maxPerUnit','$product_details.product_stock','$sale_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','getDate','/barcode/:id','json','sendMail','$product_details.batch_code','random','Add\x20Sales','/view/return_sales/:id','$product','getMonth','$product_details.type','<tr>','concat','/all_sales/view','then','primary_code_QA','Ambient','Hindi','$product_details.primary_code','stock_data','/view/:id','$product_details._id','map','split','\x20Order\x20Date\x20:\x20','1961176xhkViO','Portuguese','maxperunit','primary_unit','email','customer_data','createTransport','$product_details.secondary_code','sale_product','Enclosed','barcode\x20Product\x20master','</thead>','$date','$product.product_name','log','date','body','</td>','render','params','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','invoice','received_amount','primary_code','quantity','customers','$sale_product.bay','ADD\x20SALE','add\x20post','filter','$product_details.product_cat','warehouse','/view/add_sale/product','$sale_product.bin','German','return_sale','<table\x20style=\x22width:\x20100%\x20!important;\x22>','user','expiry_date','$product_details.unit','product','<!DOCTYPE\x20html>','8CfiGna','room_name','$product_details.maxProducts','FGSEmail','padStart','</body></html>','Portuguese\x20(BR)','post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Arabic','Enabled','Sale\x20Return','QA\x20Warehouse','<h5\x20style=\x22text-align:\x20left;\x22>','/view/add_sales','production_date','max_per_unit','success','/preview/:id','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Chinese','stock','There\x27s\x20a\x20error\x20in\x20this\x20transaction','currency','$invoice','slice','\x20==\x20','\x20<>\x20','role','return_qty_QA','642760hRNmpY','../public/language/languages.json','product_code','secondary_unit_QA','image','stocks_QA','product_list','toString','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','</table>','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'];a0_0x5a78=function(){return _0x12645c;};return a0_0x5a78();}router[a0_0x5a4c10(0x22f)](a0_0x5a4c10(0x20b),auth,async(_0x49eaa8,_0x4b4ba8)=>{var _0x36f1c8=a0_0x5a4c10;try{const {username:_0x1ad712,email:_0x1501cc,role:_0x2b5404}=_0x49eaa8[_0x36f1c8(0x1f8)],_0x3fc64a=_0x49eaa8['user'],_0x54b2a6=await profile[_0x36f1c8(0x187)]({'email':_0x3fc64a[_0x36f1c8(0x1d7)]}),_0x2eb3ec=await master_shop[_0x36f1c8(0x138)](),_0x2d9e6c=await customer[_0x36f1c8(0x138)]({});let _0x2a1455;if(_0x3fc64a[_0x36f1c8(0x21a)]==_0x36f1c8(0x14c)){const _0x7ddcac=await staff[_0x36f1c8(0x187)]({'email':_0x3fc64a[_0x36f1c8(0x1d7)]});_0x2a1455=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x7ddcac[_0x36f1c8(0x1f2)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x36f1c8(0x209)}}},{'$group':{'_id':_0x36f1c8(0x23f),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x2a1455=await warehouse[_0x36f1c8(0x22c)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0x36f1c8(0x209)}}},{'$group':{'_id':_0x36f1c8(0x23f),'name':{'$first':_0x36f1c8(0x23f)}}},{'$sort':{'name':0x1}}]);const _0x3e3a86=await product[_0x36f1c8(0x138)]({});var _0x5995eb=[_0x36f1c8(0x1ca),_0x36f1c8(0x1dc)];const _0x3d609b=await sales_finished[_0x36f1c8(0x138)]({}),_0x4b0f2c=_0x3d609b[_0x36f1c8(0x165)]+0x1,_0x440b13=_0x36f1c8(0x159)+_0x4b0f2c[_0x36f1c8(0x223)]()[_0x36f1c8(0x201)](0x5,'0');if(_0x2eb3ec[0x0][_0x36f1c8(0x142)]==_0x36f1c8(0x24e)){var _0x151f38=users['English'];console[_0x36f1c8(0x1e1)](_0x151f38);}else{if(_0x2eb3ec[0x0]['language']==_0x36f1c8(0x1cb))var _0x151f38=users[_0x36f1c8(0x1cb)];else{if(_0x2eb3ec[0x0][_0x36f1c8(0x142)]=='German')var _0x151f38=users[_0x36f1c8(0x1f5)];else{if(_0x2eb3ec[0x0][_0x36f1c8(0x142)]==_0x36f1c8(0x13c))var _0x151f38=users[_0x36f1c8(0x13c)];else{if(_0x2eb3ec[0x0][_0x36f1c8(0x142)]==_0x36f1c8(0x195))var _0x151f38=users['French'];else{if(_0x2eb3ec[0x0][_0x36f1c8(0x142)]==_0x36f1c8(0x203))var _0x151f38=users[_0x36f1c8(0x1d4)];else{if(_0x2eb3ec[0x0][_0x36f1c8(0x142)]=='Chinese')var _0x151f38=users[_0x36f1c8(0x212)];else{if(_0x2eb3ec[0x0][_0x36f1c8(0x142)]=='Arabic\x20(ae)')var _0x151f38=users[_0x36f1c8(0x206)];}}}}}}}const _0x224ac8=getRandom8DigitNumber();_0x224ac8[_0x36f1c8(0x1c8)](_0x1a0d8a=>{var _0x12d5bb=_0x36f1c8;_0x4b4ba8[_0x12d5bb(0x1e5)](_0x12d5bb(0x15d),{'success':_0x49eaa8[_0x12d5bb(0x1b0)](_0x12d5bb(0x20e)),'errors':_0x49eaa8[_0x12d5bb(0x1b0)]('errors'),'role':_0x3fc64a,'profile':_0x54b2a6,'customer':_0x2d9e6c,'warehouse':_0x2a1455,'product':_0x3e3a86,'invoice':_0x1a0d8a,'master_shop':_0x2eb3ec,'language':_0x151f38,'rooms_data':_0x5995eb});})['catch'](_0x2b502f=>{var _0x4f1aaf=_0x36f1c8;_0x49eaa8[_0x4f1aaf(0x1b0)](_0x4f1aaf(0x143),_0x4f1aaf(0x214)),_0x4b4ba8[_0x4f1aaf(0x15c)]('/all_sales_finished/view');});}catch(_0x289230){console[_0x36f1c8(0x1e1)](_0x289230);}}),router[a0_0x5a4c10(0x22f)](a0_0x5a4c10(0x141),auth,async(_0x41a8df,_0x1b5080)=>{var _0xa4b273=a0_0x5a4c10;try{const _0x1a8b01=_0x41a8df[_0xa4b273(0x1e6)]['id'];console['log'](_0x1a8b01);const _0x48f86f=await product[_0xa4b273(0x138)](),_0x171294=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1a8b01}},{'$unwind':_0xa4b273(0x1c2)},{'$group':{'_id':_0xa4b273(0x1e0)}}]);console['log']('purchases_data',_0x171294),_0x1b5080['status'](0xc8)[_0xa4b273(0x1bc)]({'purchases_data':_0x171294,'product_data':_0x48f86f});}catch(_0x27354){console[_0xa4b273(0x1e1)](_0x27354);}}),router[a0_0x5a4c10(0x204)](a0_0x5a4c10(0x1f3),auth,async(_0x570716,_0x30c760)=>{var _0x23751d=a0_0x5a4c10;try{const {warehouse_data:_0x376fbc,product_data:_0x51965a}=_0x570716[_0x23751d(0x1e3)];console[_0x23751d(0x1e1)](_0x570716[_0x23751d(0x1e3)]['product_data']);;const _0x2d9acf=await master_shop[_0x23751d(0x138)]();console[_0x23751d(0x1e1)](_0x23751d(0x14b),_0x2d9acf);const _0x4dedcb=await product[_0x23751d(0x187)]({'name':_0x51965a});console[_0x23751d(0x1e1)](_0x23751d(0x1fb),_0x4dedcb);const _0x1e9af1=await warehouse[_0x23751d(0x22c)]([{'$match':{'name':_0x376fbc}},{'$unwind':_0x23751d(0x14d)},{'$match':{'product_details.product_name':_0x51965a}},{'$group':{'_id':_0x23751d(0x171),'product_stock':{'$first':_0x23751d(0x1b7)}}}]);console[_0x23751d(0x1e1)](_0x23751d(0x1cd),_0x1e9af1),_0x30c760['status'](0xc8)['json']({'master':_0x2d9acf,'new_product':_0x4dedcb,'stock_data':_0x1e9af1});}catch(_0x2fa785){console[_0x23751d(0x1e1)](_0x2fa785);}}),router[a0_0x5a4c10(0x204)](a0_0x5a4c10(0x20b),auth,async(_0x4ec1ab,_0xc7e938)=>{var _0x5a6e99=a0_0x5a4c10;try{const {invoice:_0xe3826f,date:_0x3424dc,warehouse_name:_0x452958,product_name:_0x3a8314,stock:_0x6796e9,quantity:_0x43e481,note:_0x447497,room:_0x2d4997,primary_code:_0xf5a632,secondary_code:_0x21a450,prod_code:_0x205894,level:_0x260a35,isle:_0x266889,pallet:_0x4a3edb,batch_code:_0x7afa81,SCRN:_0x5de24b,expiry_date:_0x2e6090,mode_transpo:_0x443250,name_driver:_0x1f6f8c}=_0x4ec1ab['body'];if(typeof _0x3a8314==_0x5a6e99(0x1b4))var _0x4e6c11=[_0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x178)]],_0x44a17b=[_0x4ec1ab[_0x5a6e99(0x1e3)]['stock']],_0x4b6d1a=[_0x4ec1ab['body'][_0x5a6e99(0x238)]],_0x4cee7d=[_0x4ec1ab[_0x5a6e99(0x1e3)]['primary_code']],_0x31c243=[_0x4ec1ab['body'][_0x5a6e99(0x1ae)]],_0x2c259=[_0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x145)]],_0x2d707b=[_0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x17d)]],_0x5001d5=[_0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x1d6)]],_0x44a35e=[_0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x16e)]],_0x4b8bed=[_0x4ec1ab['body'][_0x5a6e99(0x175)]],_0x33f7b8=[_0x4ec1ab['body']['expiry_date']],_0x5e426a=[_0x4ec1ab[_0x5a6e99(0x1e3)]['product_date']],_0x1ee0c3=[_0x4ec1ab['body'][_0x5a6e99(0x20d)]],_0x3d77d6=[_0x4ec1ab[_0x5a6e99(0x1e3)]['prod_cat']],_0x20223a=[_0x4ec1ab['body'][_0x5a6e99(0x1af)]],_0x341a81=[_0x4ec1ab[_0x5a6e99(0x1e3)]['prod_invoice']],_0x105b59=[_0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x231)]];else var _0x4e6c11=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x178)]],_0x44a17b=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x213)]],_0x4b6d1a=[..._0x4ec1ab[_0x5a6e99(0x1e3)]['carton']],_0x4cee7d=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x1ea)]],_0x31c243=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x1ae)]],_0x2c259=[..._0x4ec1ab['body'][_0x5a6e99(0x145)]],_0x2d707b=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x17d)]],_0x5001d5=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x1d6)]],_0x44a35e=[..._0x4ec1ab['body'][_0x5a6e99(0x16e)]],_0x4b8bed=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x175)]],_0x33f7b8=[..._0x4ec1ab['body'][_0x5a6e99(0x1f9)]],_0x5e426a=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x15a)]],_0x1ee0c3=[..._0x4ec1ab['body'][_0x5a6e99(0x20d)]],_0x3d77d6=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x1a9)]],_0x20223a=[..._0x4ec1ab[_0x5a6e99(0x1e3)]['RoomAssigned']],_0x341a81=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x1a0)]],_0x105b59=[..._0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x231)]];const _0x4dfa9d=_0x4e6c11[_0x5a6e99(0x1d0)](_0x553ec3=>{return _0x553ec3={'product_name':_0x553ec3};});_0x44a17b[_0x5a6e99(0x13d)]((_0x286dae,_0x54e649)=>{_0x4dfa9d[_0x54e649]['stock']=_0x286dae;}),_0x4b6d1a[_0x5a6e99(0x13d)]((_0x27b2db,_0x2ad260)=>{var _0x20e3df=_0x5a6e99;_0x4dfa9d[_0x2ad260][_0x20e3df(0x1eb)]=Math[_0x20e3df(0x194)](_0x27b2db);}),_0x105b59[_0x5a6e99(0x13d)]((_0x2bc1da,_0x2439f5)=>{var _0x508c05=_0x5a6e99;_0x4dfa9d[_0x2439f5][_0x508c05(0x231)]=_0x2bc1da;}),_0x4cee7d[_0x5a6e99(0x13d)]((_0x328a49,_0xb43f29)=>{var _0x5755b6=_0x5a6e99;_0x4dfa9d[_0xb43f29][_0x5755b6(0x1ea)]=_0x328a49;}),_0x31c243[_0x5a6e99(0x13d)]((_0x7b2951,_0x2390e7)=>{_0x4dfa9d[_0x2390e7]['secondary_code']=_0x7b2951;}),_0x2c259['forEach']((_0x1840cb,_0x39e3be)=>{var _0xce1b81=_0x5a6e99;_0x4dfa9d[_0x39e3be][_0xce1b81(0x21e)]=_0x1840cb;}),_0x2d707b[_0x5a6e99(0x13d)]((_0x5de4bf,_0x30944b)=>{var _0x2a2953=_0x5a6e99;_0x4dfa9d[_0x30944b][_0x2a2953(0x18b)]=_0x5de4bf;}),_0x5001d5[_0x5a6e99(0x13d)]((_0x3a74a9,_0x4af195)=>{var _0x4d31c6=_0x5a6e99;_0x4dfa9d[_0x4af195][_0x4d31c6(0x170)]=_0x3a74a9;}),_0x44a35e[_0x5a6e99(0x13d)]((_0x329e73,_0x3ff78a)=>{var _0x49022f=_0x5a6e99;_0x4dfa9d[_0x3ff78a][_0x49022f(0x16e)]=_0x329e73;}),_0x4b8bed[_0x5a6e99(0x13d)]((_0x255ef3,_0x5bfdc4)=>{var _0x5df664=_0x5a6e99;_0x4dfa9d[_0x5bfdc4][_0x5df664(0x175)]=_0x255ef3;}),_0x33f7b8[_0x5a6e99(0x13d)]((_0x1d8892,_0x482a6b)=>{_0x4dfa9d[_0x482a6b]['expiry_date']=_0x1d8892;}),_0x5e426a[_0x5a6e99(0x13d)]((_0x3ac3b2,_0x21068f)=>{var _0x18a355=_0x5a6e99;_0x4dfa9d[_0x21068f][_0x18a355(0x20c)]=_0x3ac3b2;}),_0x1ee0c3[_0x5a6e99(0x13d)]((_0x10bad8,_0x2b133f)=>{var _0x41331a=_0x5a6e99;_0x4dfa9d[_0x2b133f][_0x41331a(0x1d5)]=_0x10bad8;}),_0x3d77d6['forEach']((_0x34b2cf,_0x1588e7)=>{var _0x3452d1=_0x5a6e99;_0x4dfa9d[_0x1588e7][_0x3452d1(0x1a9)]=_0x34b2cf;}),_0x20223a[_0x5a6e99(0x13d)]((_0x3c3e83,_0x43cbe1)=>{var _0x46bd62=_0x5a6e99;_0x4dfa9d[_0x43cbe1][_0x46bd62(0x1fe)]=_0x3c3e83;}),_0x341a81[_0x5a6e99(0x13d)]((_0x4b8b72,_0xfb6830)=>{var _0x2d5479=_0x5a6e99;_0x4dfa9d[_0xfb6830][_0x2d5479(0x1e8)]=_0x4b8b72;});var _0x53dc58=0x0;_0x4dfa9d['forEach'](_0x57d53e=>{var _0x56bee8=_0x5a6e99;parseFloat(_0x57d53e[_0x56bee8(0x213)])<parseFloat(_0x57d53e[_0x56bee8(0x1eb)])&&parseFloat(_0x57d53e['quantity'])>parseFloat(_0x57d53e[_0x56bee8(0x213)])&&(console[_0x56bee8(0x1e1)](_0x57d53e[_0x56bee8(0x213)]+_0x56bee8(0x219)+_0x57d53e['quantity']),_0x53dc58++);});if(_0x53dc58!=0x0)return _0x4ec1ab[_0x5a6e99(0x1b0)](_0x5a6e99(0x143),_0x5a6e99(0x226)),_0xc7e938[_0x5a6e99(0x15c)](_0x5a6e99(0x19a));const _0x4889c3=_0x4dfa9d[_0x5a6e99(0x1f0)](_0x331d10=>_0x331d10[_0x5a6e99(0x1eb)]!=='0'&&_0x331d10[_0x5a6e99(0x1eb)]!==''),_0xebda71=new sales_finished({'invoice':_0xe3826f,'customer':_0x4ec1ab['body'][_0x5a6e99(0x173)],'date':_0x3424dc,'warehouse_name':_0x452958,'sale_product':_0x4889c3,'note':_0x447497,'room':_0x2d4997,'primary_code':_0xf5a632,'secondary_code':_0x21a450,'prod_code':_0x205894,'SCRN':_0x5de24b,'finalize':_0x5a6e99(0x236),'mode_transpo':_0x443250,'name_driver':_0x1f6f8c}),_0x145330=await _0xebda71[_0x5a6e99(0x136)](),_0x5daa0d=await sales_finished[_0x5a6e99(0x187)]({'invoice':_0xe3826f}),_0x363894=new c_payment_data({'invoice':_0xe3826f,'customer':_0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x173)],'reason':_0x5a6e99(0x1a4)});await _0x363894[_0x5a6e99(0x136)]();const _0x3e31d7=await master_shop['find'](),_0x9d8b2f=await email_settings[_0x5a6e99(0x187)](),_0x32b196=await customer[_0x5a6e99(0x187)]({'name':_0x4ec1ab[_0x5a6e99(0x1e3)][_0x5a6e99(0x173)]});_0x3e31d7[0x0][_0x5a6e99(0x1a1)]==0x1?(right_currency=_0x3e31d7[0x0][_0x5a6e99(0x215)],left_currency=''):(right_currency='',left_currency=_0x3e31d7[0x0]['currency']);var _0x5114b9=_0x4e6c11,_0x3ed55b=_0x4b6d1a,_0x1a3ae1='',_0x292565;for(_0x292565 in _0x5114b9){_0x1a3ae1+=_0x5a6e99(0x1c5)+_0x5a6e99(0x196)+_0x5114b9[_0x292565]+_0x5a6e99(0x1e4)+_0x5a6e99(0x196)+_0x3ed55b[_0x292565]+_0x5a6e99(0x1e4)+_0x5a6e99(0x247);}console[_0x5a6e99(0x1e1)](_0x5a6e99(0x222),_0x1a3ae1);let _0x54a007=nodemailer[_0x5a6e99(0x1d9)]({'host':_0x9d8b2f[_0x5a6e99(0x155)],'port':Number(_0x9d8b2f[_0x5a6e99(0x24c)]),'secure':![],'service':_0x5a6e99(0x174),'auth':{'user':_0x9d8b2f['email'],'pass':_0x9d8b2f[_0x5a6e99(0x228)]}}),_0x1e1646={'from':_0x9d8b2f[_0x5a6e99(0x1d7)],'to':_0x5a6e99(0x18d),'subject':_0x5a6e99(0x1c0),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5a6e99(0x24a)+_0x5a6e99(0x16d)+_0x3e31d7[0x0][_0x5a6e99(0x220)],'cid':_0x5a6e99(0x13a)}],'html':_0x5a6e99(0x1ee)};_0x54a007[_0x5a6e99(0x1bd)](_0x1e1646,function(_0x57a7da,_0x5cac57){var _0x16bf39=_0x5a6e99;_0x57a7da?(console[_0x16bf39(0x1e1)](_0x57a7da),console[_0x16bf39(0x1e1)]('Error\x20Occurs')):console['log'](_0x16bf39(0x189));}),_0x4ec1ab[_0x5a6e99(0x1b0)](_0x5a6e99(0x20e),_0x5a6e99(0x16b)),_0xc7e938[_0x5a6e99(0x15c)]('/all_sales_finished/preview/'+_0x145330[_0x5a6e99(0x157)]);}catch(_0xe4d274){console[_0x5a6e99(0x1e1)](_0xe4d274);}}),router[a0_0x5a4c10(0x22f)](a0_0x5a4c10(0x20f),auth,async(_0x56b896,_0x1e108c)=>{var _0x1cc4f7=a0_0x5a4c10;try{const {username:_0x579d59,email:_0x3466fd,role:_0x203d5b}=_0x56b896[_0x1cc4f7(0x1f8)],_0x7271c8=_0x56b896['user'],_0x2ea4a6=await profile['findOne']({'email':_0x7271c8[_0x1cc4f7(0x1d7)]}),_0x111d0d=await master_shop['find'](),_0x1f23a0=_0x56b896[_0x1cc4f7(0x1e6)]['id'],_0x1f30e4=await sales_finished[_0x1cc4f7(0x198)](_0x1f23a0),_0x42f0bf=await warehouse[_0x1cc4f7(0x22c)]([{'$match':{'name':_0x1f30e4[_0x1cc4f7(0x166)]}},{'$unwind':_0x1cc4f7(0x14d)},{'$group':{'_id':_0x1cc4f7(0x1cf),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1cc4f7(0x1b7)},'bay':{'$first':_0x1cc4f7(0x182)},'bin':{'$first':_0x1cc4f7(0x1aa)},'type':{'$first':_0x1cc4f7(0x1c4)},'floorlevel':{'$first':_0x1cc4f7(0x147)},'primary_code':{'$first':_0x1cc4f7(0x1cc)},'secondary_code':{'$first':_0x1cc4f7(0x1da)},'product_code':{'$first':_0x1cc4f7(0x152)},'storage':{'$first':_0x1cc4f7(0x16f)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1cc4f7(0x23b)},'batch_code':{'$first':_0x1cc4f7(0x1be)},'room':{'$first':_0x1cc4f7(0x192)},'room_data':{'$first':'$product_details.room_name'}}}]),_0x4e381d=await customer[_0x1cc4f7(0x138)]({});let _0x25a89a;if(_0x7271c8['role']==_0x1cc4f7(0x14c)){const _0x1b68de=await staff['findOne']({'email':_0x7271c8[_0x1cc4f7(0x1d7)]});_0x25a89a=await warehouse[_0x1cc4f7(0x22c)]([{'$match':{'status':'Enabled','name':_0x1b68de[_0x1cc4f7(0x1f2)]}},{'$group':{'_id':_0x1cc4f7(0x23f),'name':{'$first':'$name'}}}]);}else _0x25a89a=await warehouse[_0x1cc4f7(0x22c)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x1cc4f7(0x23f)}}}]);const _0x3df7bc=await product['find']({});if(_0x111d0d[0x0]['language']==_0x1cc4f7(0x24e)){var _0x2deff0=users[_0x1cc4f7(0x230)];console[_0x1cc4f7(0x1e1)](_0x2deff0);}else{if(_0x111d0d[0x0][_0x1cc4f7(0x142)]=='Hindi')var _0x2deff0=users[_0x1cc4f7(0x1cb)];else{if(_0x111d0d[0x0]['language']==_0x1cc4f7(0x1f5))var _0x2deff0=users[_0x1cc4f7(0x1f5)];else{if(_0x111d0d[0x0][_0x1cc4f7(0x142)]=='Spanish')var _0x2deff0=users[_0x1cc4f7(0x13c)];else{if(_0x111d0d[0x0]['language']==_0x1cc4f7(0x195))var _0x2deff0=users['French'];else{if(_0x111d0d[0x0][_0x1cc4f7(0x142)]=='Portuguese\x20(BR)')var _0x2deff0=users['Portuguese'];else{if(_0x111d0d[0x0][_0x1cc4f7(0x142)]==_0x1cc4f7(0x212))var _0x2deff0=users[_0x1cc4f7(0x212)];else{if(_0x111d0d[0x0][_0x1cc4f7(0x142)]==_0x1cc4f7(0x163))var _0x2deff0=users[_0x1cc4f7(0x206)];}}}}}}}_0x1e108c[_0x1cc4f7(0x1e5)](_0x1cc4f7(0x164),{'success':_0x56b896[_0x1cc4f7(0x1b0)](_0x1cc4f7(0x20e)),'errors':_0x56b896[_0x1cc4f7(0x1b0)]('errors'),'role':_0x7271c8,'profile':_0x2ea4a6,'customer':_0x4e381d,'warehouse':_0x25a89a,'product':_0x42f0bf,'user':_0x1f30e4,'master_shop':_0x111d0d,'unit':_0x3df7bc,'language':_0x2deff0});}catch(_0xd55631){console[_0x1cc4f7(0x1e1)](_0xd55631);}}),router[a0_0x5a4c10(0x204)](a0_0x5a4c10(0x20f),auth,async(_0x1c02fb,_0x551884)=>{var _0x35aa7d=a0_0x5a4c10;try{const _0x847c99=_0x1c02fb[_0x35aa7d(0x1e6)]['id'],{invoice:_0x3c07fd,warehouse_name:_0x39e625,room:_0x483657}=_0x1c02fb[_0x35aa7d(0x1e3)],_0x202acc=await sales_finished[_0x35aa7d(0x187)]({'invoice':_0x3c07fd}),_0x4f512b=_0x202acc[_0x35aa7d(0x1db)][_0x35aa7d(0x1d0)](async _0xb1856=>{var _0x2753db=_0x35aa7d,_0x2a6bd2=await warehouse[_0x2753db(0x187)]({'name':_0x39e625,'room':_0xb1856[_0x2753db(0x1fe)],'warehouse_category':_0x2753db(0x234)});const _0x14f202=_0x2a6bd2[_0x2753db(0x243)][_0x2753db(0x1d0)](_0x117953=>{var _0x33fe2f=_0x2753db;_0x117953[_0x33fe2f(0x178)]==_0xb1856[_0x33fe2f(0x178)]&&_0x117953['bay']==_0xb1856['bay']&&_0x117953['expiry_date']==_0xb1856[_0x33fe2f(0x1f9)]&&_0x117953[_0x33fe2f(0x20c)]==_0xb1856[_0x33fe2f(0x20c)]&&_0x117953[_0x33fe2f(0x175)]==_0xb1856['batch_code']&&_0x117953[_0x33fe2f(0x157)]==_0xb1856[_0x33fe2f(0x231)]&&(_0x117953[_0x33fe2f(0x162)]>0x0&&(console['log'](_0x117953[_0x33fe2f(0x178)]+_0x33fe2f(0x218)+_0xb1856[_0x33fe2f(0x178)]+_0x33fe2f(0x146)+_0x117953[_0x33fe2f(0x18b)]+_0x33fe2f(0x218)+_0xb1856[_0x33fe2f(0x18b)]+_0x33fe2f(0x146)+_0x117953[_0x33fe2f(0x20c)]+_0x33fe2f(0x218)+_0xb1856['production_date']+_0x33fe2f(0x146)+_0x117953[_0x33fe2f(0x1f9)]+_0x33fe2f(0x218)+_0xb1856[_0x33fe2f(0x1f9)]+_0x33fe2f(0x146)+_0x117953['batch_code']+_0x33fe2f(0x218)+_0xb1856[_0x33fe2f(0x175)]+'\x20&&\x20'+_0x117953[_0x33fe2f(0x1e8)]+'\x20==\x20'+_0xb1856[_0x33fe2f(0x1e8)]+'\x20&&\x20'+_0x117953[_0x33fe2f(0x162)]+_0x33fe2f(0x177)+_0xb1856[_0x33fe2f(0x1eb)]+'\x20>>>\x20'+_0xb1856[_0x33fe2f(0x1fe)]+_0x33fe2f(0x146)+_0x117953[_0x33fe2f(0x157)]+_0x33fe2f(0x218)+_0xb1856[_0x33fe2f(0x231)]),_0x117953[_0x33fe2f(0x162)]=Math[_0x33fe2f(0x144)](0x0,Math[_0x33fe2f(0x194)](_0x117953[_0x33fe2f(0x162)])-Math[_0x33fe2f(0x194)](_0xb1856['quantity']))));});return _0x2a6bd2;});Promise['all'](_0x4f512b)[_0x35aa7d(0x1c8)](async _0x2665c6=>{var _0x164ea0=_0x35aa7d;try{for(const _0x23e501 of _0x2665c6){await _0x23e501[_0x164ea0(0x136)]();}_0x202acc['finalize']=_0x164ea0(0x14f);const _0x3fac5d=await _0x202acc[_0x164ea0(0x136)](),_0xcded=await master_shop[_0x164ea0(0x138)](),_0x511999=await email_settings['findOne'](),_0x3e4c79=await supervisor_settings['find']();var _0x1becf3=_0x202acc[_0x164ea0(0x1db)],_0x246a34='',_0x5a3531;for(_0x5a3531 in _0x1becf3){var _0x37859a='FG';_0x202acc[_0x164ea0(0x166)]==_0x164ea0(0x229)&&(_0x37859a='DG'),_0x246a34+=_0x164ea0(0x1c5)+_0x164ea0(0x196)+_0x1becf3[_0x5a3531][_0x164ea0(0x178)]+_0x164ea0(0x1e4)+_0x164ea0(0x196)+_0x1becf3[_0x5a3531][_0x164ea0(0x21e)]+_0x164ea0(0x1e4)+_0x164ea0(0x196)+_0x1becf3[_0x5a3531]['quantity']+_0x164ea0(0x1e4)+_0x164ea0(0x196)+_0x1becf3[_0x5a3531]['unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1becf3[_0x5a3531][_0x164ea0(0x16e)]+_0x164ea0(0x1e4)+_0x164ea0(0x196)+_0x202acc[_0x164ea0(0x166)]+_0x164ea0(0x1e4)+_0x164ea0(0x196)+_0x1becf3[_0x5a3531][_0x164ea0(0x1fe)]+_0x164ea0(0x1e4)+_0x164ea0(0x196)+_0x37859a+_0x1becf3[_0x5a3531][_0x164ea0(0x18b)]+_0x164ea0(0x1e4);}let _0x4f55fc=nodemailer[_0x164ea0(0x1d9)]({'host':_0x511999[_0x164ea0(0x155)],'port':Number(_0x511999[_0x164ea0(0x24c)]),'secure':![],'auth':{'user':_0x511999[_0x164ea0(0x1d7)],'pass':_0x511999[_0x164ea0(0x228)]}}),_0x4ad913={'from':_0x511999[_0x164ea0(0x1d7)],'to':_0x3e4c79[0x0][_0x164ea0(0x200)],'subject':_0x164ea0(0x22b),'attachments':[{'filename':_0x164ea0(0x1a3),'path':__dirname+_0x164ea0(0x24a)+_0x164ea0(0x16d)+_0xcded[0x0]['image'],'cid':_0x164ea0(0x13a)}],'html':_0x164ea0(0x1fc)+'<html><head><title></title>'+_0x164ea0(0x176)+_0x164ea0(0x15e)+_0x164ea0(0x224)+_0x164ea0(0x15e)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x164ea0(0x245)+'<div>'+'<h2>\x20'+_0xcded[0x0][_0x164ea0(0x149)]+_0x164ea0(0x210)+_0x164ea0(0x245)+_0x164ea0(0x245)+_0x164ea0(0x15f)+_0x164ea0(0x15e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x164ea0(0x137)+_0x202acc['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x202acc[_0x164ea0(0x1e2)]+'\x20'+_0x164ea0(0x156)+_0x164ea0(0x1b2)+_0x164ea0(0x245)+_0x164ea0(0x1f7)+_0x164ea0(0x13f)+_0x164ea0(0x1c5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x164ea0(0x153)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x164ea0(0x1e7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x164ea0(0x199)+_0x164ea0(0x18a)+_0x164ea0(0x211)+_0x164ea0(0x247)+_0x164ea0(0x1de)+_0x164ea0(0x1b1)+'\x20'+_0x246a34+'\x20'+'</tbody>'+'</table>'+_0x164ea0(0x15e)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0xcded[0x0][_0x164ea0(0x149)]+'</h5>'+_0x164ea0(0x245)+_0x164ea0(0x245)+_0x164ea0(0x202)};_0x4f55fc[_0x164ea0(0x1bd)](_0x4ad913,function(_0x9b30b2,_0x95b25f){var _0x7eb09b=_0x164ea0;_0x9b30b2?(console[_0x7eb09b(0x1e1)](_0x9b30b2),console[_0x7eb09b(0x1e1)]('Error\x20Occurs')):console[_0x7eb09b(0x1e1)]('Email\x20sent\x20successfully');}),_0x1c02fb['flash'](_0x164ea0(0x20e),_0x164ea0(0x140)),_0x551884[_0x164ea0(0x15c)](_0x164ea0(0x14e)+_0x847c99);}catch(_0x1de434){console['error'](_0x1de434),_0x551884[_0x164ea0(0x158)](0x1f4)[_0x164ea0(0x1bc)]({'error':_0x164ea0(0x24b)});}})[_0x35aa7d(0x148)](_0x15d410=>{var _0x16d0d5=_0x35aa7d;console[_0x16d0d5(0x18c)](_0x15d410),_0x551884[_0x16d0d5(0x158)](0x1f4)[_0x16d0d5(0x1bc)]({'error':'An\x20error\x20occurred.'});});}catch(_0x4ae3de){console['log'](_0x4ae3de);}}),router[a0_0x5a4c10(0x22f)]('/view/:id',auth,async(_0x240c82,_0x32e610)=>{var _0x42b9af=a0_0x5a4c10;try{const {username:_0x5ba31a,email:_0xfae163,role:_0x1b8938}=_0x240c82[_0x42b9af(0x1f8)],_0x190627=_0x240c82[_0x42b9af(0x1f8)],_0x5c6c5a=await profile[_0x42b9af(0x187)]({'email':_0x190627['email']}),_0x11105b=await master_shop[_0x42b9af(0x138)](),_0x2333a1=_0x240c82[_0x42b9af(0x1e6)]['id'],_0x5a11bc=await sales_finished[_0x42b9af(0x198)](_0x2333a1);let _0x1e4d92=new Date(_0x5a11bc['expiry_date']),_0x161eab=('0'+_0x1e4d92[_0x42b9af(0x1ba)]())['slice'](-0x2),_0x1508f0=('0'+(_0x1e4d92[_0x42b9af(0x1c3)]()+0x1))[_0x42b9af(0x217)](-0x2),_0x254e4e=_0x1e4d92[_0x42b9af(0x133)](),_0x1bed59=_0x254e4e+'-'+_0x1508f0+'-'+_0x161eab;var _0x52dfaa=[_0x42b9af(0x1ca),_0x42b9af(0x1dc)];const _0x42a5f7=await warehouse[_0x42b9af(0x22c)]([{'$match':{'name':_0x5a11bc[_0x42b9af(0x166)],'room':_0x5a11bc[_0x42b9af(0x23d)]}},{'$unwind':_0x42b9af(0x14d)},{'$group':{'_id':_0x42b9af(0x1cf),'name':{'$first':_0x42b9af(0x171)},'product_stock':{'$first':_0x42b9af(0x1b7)},'bay':{'$first':_0x42b9af(0x182)},'bin':{'$first':_0x42b9af(0x1aa)},'type':{'$first':_0x42b9af(0x1c4)},'floorlevel':{'$first':_0x42b9af(0x147)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x42b9af(0x1da)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x42b9af(0x16f)},'rack':{'$first':'$product_details.rack'}}}]),_0x3d068a=await customer[_0x42b9af(0x138)]({});let _0x50b53c;if(_0x190627[_0x42b9af(0x21a)]==_0x42b9af(0x14c)){const _0x4ab3e8=await staff[_0x42b9af(0x187)]({'email':_0x190627[_0x42b9af(0x1d7)]});_0x50b53c=await warehouse[_0x42b9af(0x22c)]([{'$match':{'status':'Enabled','name':_0x4ab3e8[_0x42b9af(0x1f2)]}},{'$group':{'_id':_0x42b9af(0x23f),'name':{'$first':_0x42b9af(0x23f)}}}]);}else _0x50b53c=await warehouse[_0x42b9af(0x22c)]([{'$match':{'status':_0x42b9af(0x207)}},{'$group':{'_id':_0x42b9af(0x23f),'name':{'$first':_0x42b9af(0x23f)}}}]);const _0x3332aa=await product['find']({});if(_0x11105b[0x0][_0x42b9af(0x142)]==_0x42b9af(0x24e)){var _0x59fafe=users['English'];console[_0x42b9af(0x1e1)](_0x59fafe);}else{if(_0x11105b[0x0][_0x42b9af(0x142)]=='Hindi')var _0x59fafe=users[_0x42b9af(0x1cb)];else{if(_0x11105b[0x0]['language']==_0x42b9af(0x1f5))var _0x59fafe=users[_0x42b9af(0x1f5)];else{if(_0x11105b[0x0][_0x42b9af(0x142)]=='Spanish')var _0x59fafe=users[_0x42b9af(0x13c)];else{if(_0x11105b[0x0]['language']=='French')var _0x59fafe=users[_0x42b9af(0x195)];else{if(_0x11105b[0x0][_0x42b9af(0x142)]==_0x42b9af(0x203))var _0x59fafe=users[_0x42b9af(0x1d4)];else{if(_0x11105b[0x0]['language']=='Chinese')var _0x59fafe=users[_0x42b9af(0x212)];else{if(_0x11105b[0x0][_0x42b9af(0x142)]==_0x42b9af(0x163))var _0x59fafe=users[_0x42b9af(0x206)];}}}}}}}_0x32e610[_0x42b9af(0x1e5)](_0x42b9af(0x186),{'success':_0x240c82['flash']('success'),'errors':_0x240c82[_0x42b9af(0x1b0)](_0x42b9af(0x143)),'role':_0x190627,'profile':_0x5c6c5a,'customer':_0x3d068a,'warehouse':_0x50b53c,'product':_0x42a5f7,'user':_0x5a11bc,'master_shop':_0x11105b,'unit':_0x3332aa,'language':_0x59fafe,'rooms_data':_0x52dfaa,'ed_fullDate':_0x1bed59});}catch(_0x8f23c1){console[_0x42b9af(0x1e1)](_0x8f23c1);}}),router[a0_0x5a4c10(0x204)](a0_0x5a4c10(0x1ce),auth,async(_0x10a964,_0x577eb5)=>{var _0x3cc4c2=a0_0x5a4c10;try{const _0x344768=_0x10a964['params']['id'],_0x1aa619=await sales_finished[_0x3cc4c2(0x187)]({'_id':_0x10a964[_0x3cc4c2(0x1e6)]['id']}),_0x29baeb=await warehouse[_0x3cc4c2(0x187)]({'name':_0x1aa619['warehouse_name'],'room':_0x10a964['body'][_0x3cc4c2(0x23d)],'warehouse_category':_0x3cc4c2(0x234)}),{invoice:_0x58031c,customer:_0x3cec9b,date:_0xfec01,warehouse_name:_0x14b34d,product_name:_0x5126e7,stock:_0xd4158,adjust_qty:_0x478421,note:_0x925a6a,room:_0x18582a,primary_code:_0x5b8b50,secondary_code:_0x4f454a,prod_code:_0x4bae7d,level:_0x46ba73,isle:_0x5a8d74,pallet:_0x2cad81,expiry_date:_0x1d34f2}=_0x10a964[_0x3cc4c2(0x1e3)];if(typeof _0x5126e7=='string')var _0x46a406=[_0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x178)]],_0x31a20a=[_0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x213)]],_0x51aaee=[_0x10a964[_0x3cc4c2(0x1e3)]['adjust_qty']],_0x3acb8b=[_0x10a964['body']['primary_code']],_0x16bfe0=[_0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x1ae)]],_0x468898=[_0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x145)]],_0x17743a=[_0x10a964[_0x3cc4c2(0x1e3)]['level']],_0x582288=[_0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x1f9)]];else var _0x46a406=[..._0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x178)]],_0x31a20a=[..._0x10a964['body'][_0x3cc4c2(0x213)]],_0x51aaee=[..._0x10a964['body'][_0x3cc4c2(0x1a5)]],_0x3acb8b=[..._0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x1ea)]],_0x16bfe0=[..._0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x1ae)]],_0x468898=[..._0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x145)]],_0x17743a=[..._0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x17d)]],_0x582288=[..._0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x1f9)]];const _0x54d6e0=_0x46a406['map'](_0x4ff3f4=>{return _0x4ff3f4={'product_name':_0x4ff3f4};});_0x31a20a[_0x3cc4c2(0x13d)]((_0x495f3a,_0x134a4a)=>{_0x54d6e0[_0x134a4a]['stock']=_0x495f3a;}),_0x51aaee['forEach']((_0x5c239c,_0x23e6df)=>{var _0x597577=_0x3cc4c2;_0x54d6e0[_0x23e6df][_0x597577(0x1eb)]=_0x5c239c;}),_0x3acb8b[_0x3cc4c2(0x13d)]((_0x5d97a6,_0x27f119)=>{var _0x49e0d1=_0x3cc4c2;_0x54d6e0[_0x27f119][_0x49e0d1(0x1ea)]=_0x5d97a6;}),_0x16bfe0[_0x3cc4c2(0x13d)]((_0x1857ed,_0x468643)=>{var _0x5d2493=_0x3cc4c2;_0x54d6e0[_0x468643][_0x5d2493(0x1ae)]=_0x1857ed;}),_0x468898[_0x3cc4c2(0x13d)]((_0x44f2e3,_0x49cf0d)=>{var _0x28ffe2=_0x3cc4c2;_0x54d6e0[_0x49cf0d][_0x28ffe2(0x21e)]=_0x44f2e3;}),_0x17743a[_0x3cc4c2(0x13d)]((_0x433d2e,_0x4dfc02)=>{_0x54d6e0[_0x4dfc02]['level']=_0x433d2e;}),_0x582288['forEach']((_0x499978,_0x130433)=>{var _0x3f14ed=_0x3cc4c2;_0x54d6e0[_0x130433][_0x3f14ed(0x1f9)]=_0x499978;});var _0x55f9d3=0x0;_0x54d6e0['forEach'](_0x112269=>{var _0x537105=_0x3cc4c2;console[_0x537105(0x1e1)]('foreach\x20newproduct',_0x112269),(parseInt(_0x112269[_0x537105(0x213)])<parseInt(_0x112269[_0x537105(0x1eb)])||parseInt(_0x112269[_0x537105(0x1eb)])==0x0)&&_0x55f9d3++;});if(_0x55f9d3!=0x0)return _0x10a964[_0x3cc4c2(0x1b0)](_0x3cc4c2(0x143),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x577eb5['redirect'](_0x3cc4c2(0x19a));_0x1aa619['sale_product'][_0x3cc4c2(0x13d)](_0x9beda7=>{const _0x16cc29=_0x29baeb['product_details']['map'](_0xcee230=>{var _0x465b88=a0_0x39ca;_0xcee230[_0x465b88(0x178)]==_0x9beda7[_0x465b88(0x178)]&&_0xcee230[_0x465b88(0x18b)]==_0x9beda7[_0x465b88(0x18b)]&&(_0xcee230['product_stock']=parseInt(_0xcee230[_0x465b88(0x162)])+parseInt(_0x9beda7[_0x465b88(0x1eb)]));});}),await _0x29baeb[_0x3cc4c2(0x136)]();const _0x3921f4=_0x54d6e0[_0x3cc4c2(0x1f0)](_0x319745=>_0x319745[_0x3cc4c2(0x1eb)]!=='0'&&_0x319745[_0x3cc4c2(0x1eb)]!=='');_0x1aa619[_0x3cc4c2(0x1e8)]=_0x58031c,_0x1aa619['customer']=_0x3cec9b,_0x1aa619['date']=_0xfec01,_0x1aa619[_0x3cc4c2(0x166)]=_0x14b34d,_0x1aa619[_0x3cc4c2(0x1db)]=_0x3921f4,_0x1aa619[_0x3cc4c2(0x1a6)]=_0x925a6a,_0x1aa619[_0x3cc4c2(0x23d)]=_0x18582a;const _0x194cc5=await _0x1aa619[_0x3cc4c2(0x136)](),_0x57e045=await sales_finished[_0x3cc4c2(0x187)]({'_id':_0x10a964['params']['id']}),_0xe5aa36=await warehouse[_0x3cc4c2(0x187)]({'name':_0x14b34d,'room':_0x18582a,'warehouse_category':'Finished\x20Goods'});_0x57e045['sale_product'][_0x3cc4c2(0x13d)](_0xbef5fd=>{var _0x54209b=_0x3cc4c2;const _0x44a4af=_0xe5aa36[_0x54209b(0x243)][_0x54209b(0x1d0)](_0x2a0c13=>{var _0x396d5b=_0x54209b;_0x2a0c13['product_name']==_0xbef5fd[_0x396d5b(0x178)]&&_0x2a0c13['bay']==_0xbef5fd[_0x396d5b(0x18b)]&&(_0x2a0c13[_0x396d5b(0x162)]=parseInt(_0x2a0c13[_0x396d5b(0x162)])-parseInt(_0xbef5fd[_0x396d5b(0x1eb)]));});}),console[_0x3cc4c2(0x1e1)](_0x3cc4c2(0x154),_0xe5aa36),await _0xe5aa36[_0x3cc4c2(0x136)]();const _0x3442c7=await c_payment_data[_0x3cc4c2(0x187)]({'invoice':_0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x1e8)]});_0x3442c7['suppliers']=_0x10a964[_0x3cc4c2(0x1e3)][_0x3cc4c2(0x197)],await _0x3442c7['save'](),_0x10a964[_0x3cc4c2(0x1b0)](_0x3cc4c2(0x20e),_0x3cc4c2(0x140)),_0x577eb5[_0x3cc4c2(0x15c)](_0x3cc4c2(0x22d));}catch(_0x45ab36){console[_0x3cc4c2(0x1e1)](_0x45ab36);}}),router[a0_0x5a4c10(0x204)]('/give_payment/:id',auth,async(_0x4db7ca,_0x35c785)=>{var _0x5a64e0=a0_0x5a4c10;try{const _0x13363f=_0x4db7ca['params']['id'],{invoice:_0x345013,customer:_0x1abf0c,receivable_amount:_0x26307e,received_amount:_0x3c951a}=_0x4db7ca[_0x5a64e0(0x1e3)],_0x2efc98=await sales['findById'](_0x13363f);console[_0x5a64e0(0x1e1)](_0x2efc98);var _0x226b9c=_0x26307e-_0x3c951a;console['log'](_0x3c951a),_0x2efc98[_0x5a64e0(0x1e9)]=parseFloat(_0x3c951a)+parseFloat(_0x2efc98[_0x5a64e0(0x1e9)]),_0x2efc98[_0x5a64e0(0x1b3)]=_0x226b9c,console['log'](_0x2efc98);const _0xdebc0=await _0x2efc98['save'](),_0x59b44b=await c_payment_data[_0x5a64e0(0x187)]({'invoice':_0x345013});_0x59b44b['amount']=_0x226b9c,await _0x59b44b[_0x5a64e0(0x136)]();let _0x146fe3=new Date(),_0x4d1b89=('0'+_0x146fe3[_0x5a64e0(0x1ba)]())['slice'](-0x2),_0x4257d5=('0'+(_0x146fe3[_0x5a64e0(0x1c3)]()+0x1))[_0x5a64e0(0x217)](-0x2),_0x54adc9=_0x146fe3[_0x5a64e0(0x133)](),_0x1b6546=_0x54adc9+'-'+_0x4257d5+'-'+_0x4d1b89;const _0x2dff86=new customer_payment({'invoice':_0x345013,'date':_0x54adc9+'-'+_0x4257d5+'-'+_0x4d1b89,'customer':_0x1abf0c,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x3c951a}),_0x13c131=await _0x2dff86['save']();_0x4db7ca[_0x5a64e0(0x1b0)](_0x5a64e0(0x20e),_0x5a64e0(0x135)),_0x35c785['redirect'](_0x5a64e0(0x1c7));}catch(_0x2bae09){console[_0x5a64e0(0x1e1)](_0x2bae09);}}),router[a0_0x5a4c10(0x22f)](a0_0x5a4c10(0x19b),auth,async(_0x50c301,_0x3194b5)=>{var _0xd58a11=a0_0x5a4c10;try{const {username:_0x54080f,email:_0x29eaaf,role:_0x42466c}=_0x50c301[_0xd58a11(0x1f8)],_0x219c62=_0x50c301['user'],_0xc79d46=await profile[_0xd58a11(0x187)]({'email':_0x219c62[_0xd58a11(0x1d7)]}),_0x3bcfb7=await master_shop[_0xd58a11(0x138)]();console['log'](_0xd58a11(0x14b),_0x3bcfb7);const _0x444f87=_0x50c301[_0xd58a11(0x1e6)]['id'],_0x2451dd=await sales[_0xd58a11(0x198)](_0x444f87);console[_0xd58a11(0x1e1)](_0x2451dd);const _0x3ddef1=await customer[_0xd58a11(0x187)]({'name':_0x2451dd['customer']});console[_0xd58a11(0x1e1)](_0x3ddef1);if(_0x3bcfb7[0x0][_0xd58a11(0x142)]==_0xd58a11(0x24e)){var _0x40bc43=users[_0xd58a11(0x230)];console[_0xd58a11(0x1e1)](_0x40bc43);}else{if(_0x3bcfb7[0x0][_0xd58a11(0x142)]==_0xd58a11(0x1cb))var _0x40bc43=users[_0xd58a11(0x1cb)];else{if(_0x3bcfb7[0x0]['language']==_0xd58a11(0x1f5))var _0x40bc43=users[_0xd58a11(0x1f5)];else{if(_0x3bcfb7[0x0][_0xd58a11(0x142)]==_0xd58a11(0x13c))var _0x40bc43=users['Spanish'];else{if(_0x3bcfb7[0x0][_0xd58a11(0x142)]=='French')var _0x40bc43=users['French'];else{if(_0x3bcfb7[0x0]['language']==_0xd58a11(0x203))var _0x40bc43=users[_0xd58a11(0x1d4)];else{if(_0x3bcfb7[0x0][_0xd58a11(0x142)]==_0xd58a11(0x212))var _0x40bc43=users[_0xd58a11(0x212)];else{if(_0x3bcfb7[0x0][_0xd58a11(0x142)]=='Arabic\x20(ae)')var _0x40bc43=users[_0xd58a11(0x206)];}}}}}}}_0x3194b5[_0xd58a11(0x1e5)](_0xd58a11(0x151),{'success':_0x50c301[_0xd58a11(0x1b0)](_0xd58a11(0x20e)),'errors':_0x50c301['flash']('errors'),'role':_0x219c62,'profile':_0xc79d46,'master_shop':_0x3bcfb7,'customers':_0x3ddef1,'sales':_0x2451dd,'language':_0x40bc43});}catch(_0x74660){console[_0xd58a11(0x1e1)](_0x74660);}}),router[a0_0x5a4c10(0x22f)](a0_0x5a4c10(0x1c1),auth,async(_0x3b9395,_0x211e88)=>{var _0x424d1e=a0_0x5a4c10;try{const {username:_0x59c4e9,email:_0x471d40,role:_0x483a58}=_0x3b9395['user'],_0x4e552a=_0x3b9395['user'],_0x374b0e=await profile[_0x424d1e(0x187)]({'email':_0x4e552a[_0x424d1e(0x1d7)]}),_0x17019a=await master_shop[_0x424d1e(0x138)](),_0x1606b9=_0x3b9395[_0x424d1e(0x1e6)]['id'],_0x1c5e8a=await sales_finished['findById'](_0x1606b9),_0x201e81=await warehouse[_0x424d1e(0x22c)]([{'$match':{'name':_0x1c5e8a[_0x424d1e(0x166)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x424d1e(0x1cf),'name':{'$first':_0x424d1e(0x171)},'product_stock':{'$first':_0x424d1e(0x1b7)},'bay':{'$first':_0x424d1e(0x182)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x424d1e(0x1c4)},'floorlevel':{'$first':_0x424d1e(0x147)},'primary_code':{'$first':_0x424d1e(0x1cc)},'secondary_code':{'$first':_0x424d1e(0x1da)},'product_code':{'$first':_0x424d1e(0x152)},'storage':{'$first':_0x424d1e(0x16f)},'rack':{'$first':_0x424d1e(0x168)},'expiry_date':{'$first':_0x424d1e(0x237)},'production_date':{'$first':_0x424d1e(0x23b)},'unit':{'$first':_0x424d1e(0x1fa)},'secondary_unit':{'$first':_0x424d1e(0x22a)},'maxProducts':{'$first':_0x424d1e(0x1ff)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x424d1e(0x248)}}}]),_0x5dab67=await product[_0x424d1e(0x138)]({}),_0x56663c=await warehouse[_0x424d1e(0x22c)]([{'$match':{'status':_0x424d1e(0x207),'warehouse_category':_0x424d1e(0x234),'name':{'$ne':_0x424d1e(0x233),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x6c5932=['Return\x20Rooms'];const _0x544cb1=await warehouse['aggregate']([{'$match':{'status':_0x424d1e(0x207),'name':_0x424d1e(0x16a)}},{'$group':{'_id':_0x424d1e(0x23f),'name':{'$first':_0x424d1e(0x23f)}}},{'$sort':{'name':0x1}}]);if(_0x17019a[0x0]['language']==_0x424d1e(0x24e)){var _0x36c834=users[_0x424d1e(0x230)];console['log'](_0x36c834);}else{if(_0x17019a[0x0][_0x424d1e(0x142)]==_0x424d1e(0x1cb))var _0x36c834=users[_0x424d1e(0x1cb)];else{if(_0x17019a[0x0][_0x424d1e(0x142)]=='German')var _0x36c834=users[_0x424d1e(0x1f5)];else{if(_0x17019a[0x0][_0x424d1e(0x142)]==_0x424d1e(0x13c))var _0x36c834=users['Spanish'];else{if(_0x17019a[0x0][_0x424d1e(0x142)]==_0x424d1e(0x195))var _0x36c834=users[_0x424d1e(0x195)];else{if(_0x17019a[0x0]['language']==_0x424d1e(0x203))var _0x36c834=users['Portuguese'];else{if(_0x17019a[0x0][_0x424d1e(0x142)]==_0x424d1e(0x212))var _0x36c834=users['Chinese'];else{if(_0x17019a[0x0][_0x424d1e(0x142)]==_0x424d1e(0x163))var _0x36c834=users[_0x424d1e(0x206)];}}}}}}}_0x211e88[_0x424d1e(0x1e5)]('return_sale_finished',{'success':_0x3b9395[_0x424d1e(0x1b0)](_0x424d1e(0x20e)),'errors':_0x3b9395[_0x424d1e(0x1b0)](_0x424d1e(0x143)),'role':_0x4e552a,'profile':_0x374b0e,'user':_0x1c5e8a,'stock':_0x201e81,'master_shop':_0x17019a,'unit':_0x5dab67,'language':_0x36c834,'warehouses':_0x56663c,'rooms':_0x6c5932,'warehouse_QA':_0x544cb1});}catch(_0x2499f1){console['log'](_0x2499f1),_0x211e88[_0x424d1e(0x158)](0xc8)[_0x424d1e(0x1bc)]({'message':_0x2499f1['message']});}}),router[a0_0x5a4c10(0x204)](a0_0x5a4c10(0x1c1),auth,async(_0x4572c6,_0x505764)=>{var _0x4150f1=a0_0x5a4c10;if(_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x1a2)]=='QA')try{const {invoice:_0x2770d9,date:_0x5c6b7f,warehouse_name:_0x5f2078,product_name:_0x4bbf7e,primary_code:_0x46d01a,secondary_code:_0x59dd9a,product_code:_0x42529e,sales_quantity:_0x2ecf25,stocks:_0x11ff37,return_qty:_0x352889,Room_name:_0x2bd363,to_warehouse_name_QA:_0x4f823e,to_Room_name_QA:_0x2ebe83,note:_0x3d066a,for_categorize:_0x3cc8bc,product_name_QA1:_0x522811}=_0x4572c6['body'];if(typeof _0x522811==_0x4150f1(0x1b4))var _0x2bb3e6=[_0x4572c6['body'][_0x4150f1(0x1a8)]],_0x4ed861=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x1c9)]],_0x43824e=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x193)]],_0x5e4e32=[_0x4572c6['body'][_0x4150f1(0x1a7)]],_0x190ff0=[_0x4572c6['body'][_0x4150f1(0x180)]],_0x46d3e6=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x221)]],_0xc7ad72=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x21b)]],_0x39d22e=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x241)]],_0x2f6cd4=[_0x4572c6['body']['maxProducts_QA']],_0x5b6198=[_0x4572c6[_0x4150f1(0x1e3)]['batch_code_QA']],_0x8b8d55=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x21f)]],_0x3be9b7=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x1ac)]],_0x3cba79=[_0x4572c6[_0x4150f1(0x1e3)]['production_date_QA']],_0x3bc8e7=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x227)]];else var _0x2bb3e6=[..._0x4572c6['body'][_0x4150f1(0x1a8)]],_0x4ed861=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x1c9)]],_0x43824e=[..._0x4572c6['body'][_0x4150f1(0x193)]],_0x5e4e32=[..._0x4572c6['body'][_0x4150f1(0x1a7)]],_0x190ff0=[..._0x4572c6['body'][_0x4150f1(0x180)]],_0x46d3e6=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x221)]],_0xc7ad72=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x21b)]],_0x39d22e=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x241)]],_0x2f6cd4=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x242)]],_0x5b6198=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x188)]],_0x8b8d55=[..._0x4572c6['body'][_0x4150f1(0x21f)]],_0x3be9b7=[..._0x4572c6[_0x4150f1(0x1e3)]['unit_QA']],_0x3cba79=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x249)]],_0x3bc8e7=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x227)]];const _0x22a68b=_0x2bb3e6[_0x4150f1(0x1d0)](_0x6e3096=>{return _0x6e3096={'product_name':_0x6e3096};});_0x4ed861[_0x4150f1(0x13d)]((_0x2168c9,_0x5d69a7)=>{var _0x322d52=_0x4150f1;_0x22a68b[_0x5d69a7][_0x322d52(0x1ea)]=_0x2168c9;}),_0x43824e[_0x4150f1(0x13d)]((_0x4af8a9,_0xb77b1d)=>{_0x22a68b[_0xb77b1d]['secondary_code']=_0x4af8a9;}),_0x5e4e32[_0x4150f1(0x13d)]((_0x1f28af,_0xcbe78b)=>{_0x22a68b[_0xcbe78b]['product_code']=_0x1f28af;}),_0x190ff0['forEach']((_0xa7beba,_0x21ad2e)=>{_0x22a68b[_0x21ad2e]['sale_qty']=_0xa7beba;}),_0x46d3e6[_0x4150f1(0x13d)]((_0x56c236,_0x26f4b3)=>{var _0x2f0dfe=_0x4150f1;_0x22a68b[_0x26f4b3][_0x2f0dfe(0x213)]=_0x56c236;}),_0xc7ad72[_0x4150f1(0x13d)]((_0x37b3d3,_0xd356f0)=>{var _0x11e531=_0x4150f1;_0x22a68b[_0xd356f0][_0x11e531(0x18f)]=_0x37b3d3;}),_0x39d22e['forEach']((_0xa10f3b,_0x93681b)=>{var _0x113034=_0x4150f1;_0x22a68b[_0x93681b][_0x113034(0x1b6)]=_0xa10f3b;}),_0x2f6cd4[_0x4150f1(0x13d)]((_0x3634c5,_0x43156f)=>{var _0x4722aa=_0x4150f1;_0x22a68b[_0x43156f][_0x4722aa(0x13e)]=_0x3634c5;}),_0x5b6198[_0x4150f1(0x13d)]((_0x2be1c6,_0x1d725d)=>{var _0x23ef9c=_0x4150f1;_0x22a68b[_0x1d725d][_0x23ef9c(0x175)]=_0x2be1c6;}),_0x8b8d55[_0x4150f1(0x13d)]((_0x4ad348,_0x49ec35)=>{var _0x52361b=_0x4150f1;_0x22a68b[_0x49ec35][_0x52361b(0x16e)]=_0x4ad348;}),_0x3be9b7[_0x4150f1(0x13d)]((_0xaeb287,_0x504a6e)=>{var _0x5138d1=_0x4150f1;_0x22a68b[_0x504a6e][_0x5138d1(0x170)]=_0xaeb287;}),_0x3cba79['forEach']((_0x567f73,_0x5b22e0)=>{var _0x4bd4e9=_0x4150f1;_0x22a68b[_0x5b22e0][_0x4bd4e9(0x20c)]=_0x567f73;}),_0x3bc8e7[_0x4150f1(0x13d)]((_0x265eeb,_0x512e0c)=>{var _0x54f015=_0x4150f1;_0x22a68b[_0x512e0c][_0x54f015(0x1f9)]=_0x265eeb;});const _0xbac187=await sales_finished[_0x4150f1(0x187)]({'invoice':_0x2770d9});_0xbac187['return_data']=_0x4150f1(0x14f);const _0x174eb8=await _0xbac187[_0x4150f1(0x136)](),_0x56fcc2=new sales_return_finished({'invoice':_0x2770d9,'customer':_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x173)],'date':_0x5c6b7f,'warehouse_name':_0x5f2078,'room':_0x2bd363,'ToWarehouse':_0x4f823e,'ToRoom':_0x2ebe83,'return_sale_QA':_0x22a68b,'note':_0x3d066a,'warehouse_cat':_0x3cc8bc}),_0x2c915e=await _0x56fcc2[_0x4150f1(0x136)](),_0x1855bb=await sales_return_finished[_0x4150f1(0x187)]({'invoice':_0x2770d9}),_0x162114=await warehouse[_0x4150f1(0x187)]({'name':_0x4f823e,'room':_0x2ebe83});_0x1855bb['return_sale_QA'][_0x4150f1(0x13d)](_0x3883f9=>{var _0x335976=_0x4150f1,_0x12afd0=0x0;const _0x459a21=_0x162114['product_details'][_0x335976(0x1d0)](_0x7a605d=>{var _0x4f9572=_0x335976;_0x7a605d[_0x4f9572(0x178)]==_0x3883f9[_0x4f9572(0x178)]&&_0x7a605d['expiry_date']==_0x3883f9[_0x4f9572(0x1f9)]&&_0x7a605d[_0x4f9572(0x20c)]==_0x3883f9['production_date']&&_0x7a605d[_0x4f9572(0x175)]==_0x3883f9[_0x4f9572(0x175)]&&(_0x7a605d['product_stock']=parseInt(_0x7a605d[_0x4f9572(0x162)])+parseInt(_0x3883f9['return_qty']),_0x12afd0++);});_0x12afd0=='0'&&(_0x162114['product_details']=_0x162114['product_details'][_0x335976(0x1c6)]({'product_name':_0x3883f9[_0x335976(0x178)],'product_stock':_0x3883f9['return_qty'],'primary_code':_0x3883f9[_0x335976(0x1ea)],'secondary_code':_0x3883f9[_0x335976(0x1ae)],'product_code':_0x3883f9[_0x335976(0x21e)],'batch_code':_0x3883f9['batch_code'],'maxPerUnit':_0x3883f9['maxPerUnit'],'production_date':_0x3883f9[_0x335976(0x20c)],'expiry_date':_0x3883f9[_0x335976(0x1f9)],'secondary_unit':_0x3883f9['secondary_unit'],'unit':_0x3883f9[_0x335976(0x170)],'maxProducts':_0x3883f9[_0x335976(0x13e)],'bay':_0x3883f9[_0x335976(0x18b)]}));}),await _0x162114[_0x4150f1(0x136)]();const _0x30fcab=new c_payment_data({'invoice':_0x2770d9,'customer':_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x173)],'reason':_0x4150f1(0x208)});await _0x30fcab[_0x4150f1(0x136)]();const _0x123578=await master_shop['find'](),_0x5a2a10=await email_settings[_0x4150f1(0x187)](),_0x343883=await customer['findOne']({'name':_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x173)]});_0x123578[0x0][_0x4150f1(0x1a1)]==0x1?(right_currency=_0x123578[0x0][_0x4150f1(0x215)],left_currency=''):(right_currency='',left_currency=_0x123578[0x0][_0x4150f1(0x215)]);var _0x4ca241=_0x2bb3e6,_0x4dd178=_0xc7ad72,_0x786ff5='',_0x23df95;for(_0x23df95 in _0x4ca241){_0x786ff5+='<tr>'+_0x4150f1(0x196)+_0x4ca241[_0x23df95]+'</td>'+_0x4150f1(0x196)+_0x4dd178[_0x23df95]+'</td>'+'</tr>';}console[_0x4150f1(0x1e1)]('product_list',_0x786ff5);let _0x103dc9=nodemailer[_0x4150f1(0x1d9)]({'service':_0x4150f1(0x174),'auth':{'user':_0x5a2a10[_0x4150f1(0x1d7)],'pass':_0x5a2a10[_0x4150f1(0x228)]}}),_0x323508={'from':_0x5a2a10[_0x4150f1(0x1d7)],'to':_0x343883[_0x4150f1(0x1d7)],'subject':_0x4150f1(0x17b),'attachments':[{'filename':_0x4150f1(0x1a3),'path':__dirname+'/../public'+'/upload/'+_0x123578[0x0]['image'],'cid':_0x4150f1(0x13a)}],'html':_0x4150f1(0x1fc)+_0x4150f1(0x240)+_0x4150f1(0x176)+'<div>'+_0x4150f1(0x224)+_0x4150f1(0x15e)+_0x4150f1(0x1ad)+_0x4150f1(0x245)+_0x4150f1(0x15e)+_0x4150f1(0x246)+_0x123578[0x0][_0x4150f1(0x149)]+_0x4150f1(0x210)+'</div>'+'</div>'+_0x4150f1(0x15f)+'<div>'+_0x4150f1(0x20a)+_0x4150f1(0x137)+_0x2770d9+'\x20'+_0x4150f1(0x19f)+_0x4150f1(0x1d2)+_0x5c6b7f+'\x20'+_0x4150f1(0x156)+_0x4150f1(0x1b2)+_0x4150f1(0x245)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4150f1(0x13f)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4150f1(0x1b9)+_0x4150f1(0x17f)+_0x4150f1(0x15b)+_0x4150f1(0x247)+_0x4150f1(0x1de)+_0x4150f1(0x1b1)+'\x20'+_0x786ff5+'\x20'+_0x4150f1(0x23c)+_0x4150f1(0x225)+_0x4150f1(0x15e)+'<strong>\x20Regards\x20</strong>'+_0x4150f1(0x18e)+_0x123578[0x0]['site_title']+_0x4150f1(0x1b2)+_0x4150f1(0x245)+_0x4150f1(0x245)+_0x4150f1(0x202)};_0x103dc9['sendMail'](_0x323508,function(_0x3241e9,_0xfcc473){var _0x1f67a7=_0x4150f1;_0x3241e9?(console[_0x1f67a7(0x1e1)](_0x3241e9),console[_0x1f67a7(0x1e1)](_0x1f67a7(0x17a))):console[_0x1f67a7(0x1e1)](_0x1f67a7(0x189));}),_0x4572c6[_0x4150f1(0x1b0)]('success',_0x4150f1(0x24d)),_0x505764[_0x4150f1(0x15c)](_0x4150f1(0x22d));}catch(_0x34d2c7){_0x505764[_0x4150f1(0x158)](0xc8)[_0x4150f1(0x1bc)]({'message1':_0x34d2c7[_0x4150f1(0x190)]});}else{if(_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x1a2)]=='GS')try{const {invoice:_0x555e2f,date:_0x2d9752,warehouse_name:_0x57dc67,product_name:_0x32f733,primary_code:_0xb57844,secondary_code:_0x53dde5,product_code:_0x411bfd,sales_quantity:_0x13056c,stocks:_0x8253e3,return_qty:_0x21dccd,Room_name:_0x25d2ea,to_warehouse_name:_0x3fd2fa,to_Room_name:_0x345e9d,note:_0x4dcd1f,level:_0x5eef7e,isle:_0x5cf8d9,pallet:_0x202536,for_categorize:_0x125f6b}=_0x4572c6[_0x4150f1(0x1e3)];if(typeof _0x32f733==_0x4150f1(0x1b4))var _0x2bb3e6=[_0x4572c6['body'][_0x4150f1(0x178)]],_0x4ed861=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x1ea)]],_0x43824e=[_0x4572c6[_0x4150f1(0x1e3)]['secondary_code']],_0x5e4e32=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x21e)]],_0x190ff0=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x183)]],_0xc7ad72=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x18f)]],_0x403360=[_0x4572c6[_0x4150f1(0x1e3)]['bay']],_0x39d22e=[_0x4572c6['body'][_0x4150f1(0x1b6)]],_0x2f6cd4=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x13e)]],_0x5b6198=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x175)]],_0x8b8d55=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x16e)]],_0x3be9b7=[_0x4572c6['body']['unit']],_0x3cba79=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x20c)]],_0x3bc8e7=[_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x1f9)]];else var _0x2bb3e6=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x178)]],_0x4ed861=[..._0x4572c6['body'][_0x4150f1(0x1ea)]],_0x43824e=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x1ae)]],_0x5e4e32=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x21e)]],_0x190ff0=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x183)]],_0xc7ad72=[..._0x4572c6['body'][_0x4150f1(0x18f)]],_0x403360=[..._0x4572c6['body'][_0x4150f1(0x18b)]],_0x39d22e=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x1b6)]],_0x2f6cd4=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x13e)]],_0x5b6198=[..._0x4572c6[_0x4150f1(0x1e3)]['batch_code']],_0x8b8d55=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x16e)]],_0x3be9b7=[..._0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x170)]],_0x3cba79=[..._0x4572c6['body'][_0x4150f1(0x20c)]],_0x3bc8e7=[..._0x4572c6[_0x4150f1(0x1e3)]['expiry_date']];const _0x408e85=_0x2bb3e6['map'](_0x2282e7=>{return _0x2282e7={'product_name':_0x2282e7};});_0x4ed861['forEach']((_0x321e6b,_0x375132)=>{_0x408e85[_0x375132]['primary_code']=_0x321e6b;}),_0x43824e['forEach']((_0x45df8b,_0x208781)=>{var _0x11968d=_0x4150f1;_0x408e85[_0x208781][_0x11968d(0x1ae)]=_0x45df8b;}),_0x5e4e32['forEach']((_0x335fd7,_0x45fc0d)=>{var _0x344177=_0x4150f1;_0x408e85[_0x45fc0d][_0x344177(0x21e)]=_0x335fd7;}),_0x190ff0[_0x4150f1(0x13d)]((_0x1b4bb9,_0x1922c0)=>{var _0x562309=_0x4150f1;_0x408e85[_0x1922c0][_0x562309(0x185)]=_0x1b4bb9;}),_0xc7ad72[_0x4150f1(0x13d)]((_0x2b23fd,_0x979380)=>{var _0x3879e7=_0x4150f1;_0x408e85[_0x979380][_0x3879e7(0x18f)]=_0x2b23fd;}),_0x403360['forEach']((_0x42eb63,_0xf842bb)=>{_0x408e85[_0xf842bb]['bay']=_0x42eb63;}),_0x39d22e[_0x4150f1(0x13d)]((_0x4944e3,_0x1cf392)=>{_0x408e85[_0x1cf392]['maxPerUnit']=_0x4944e3;}),_0x2f6cd4['forEach']((_0x5bcc0b,_0x1d07c3)=>{_0x408e85[_0x1d07c3]['maxProducts']=_0x5bcc0b;}),_0x5b6198['forEach']((_0x480a1c,_0x4c5636)=>{_0x408e85[_0x4c5636]['batch_code']=_0x480a1c;}),_0x8b8d55[_0x4150f1(0x13d)]((_0x19bf64,_0xdcec)=>{var _0x4715bd=_0x4150f1;_0x408e85[_0xdcec][_0x4715bd(0x16e)]=_0x19bf64;}),_0x3be9b7[_0x4150f1(0x13d)]((_0x3d9cc6,_0x55f84a)=>{var _0x19690d=_0x4150f1;_0x408e85[_0x55f84a][_0x19690d(0x170)]=_0x3d9cc6;}),_0x3cba79['forEach']((_0x15a355,_0x16f636)=>{var _0x3af762=_0x4150f1;_0x408e85[_0x16f636][_0x3af762(0x20c)]=_0x15a355;}),_0x3bc8e7[_0x4150f1(0x13d)]((_0x3ad296,_0x1f75de)=>{var _0x27296e=_0x4150f1;_0x408e85[_0x1f75de][_0x27296e(0x1f9)]=_0x3ad296;});var _0x1f4ef9=0x0;_0x408e85['forEach'](_0x54b0ce=>{var _0x52b79f=_0x4150f1;(parseInt(_0x54b0ce[_0x52b79f(0x185)])<parseInt(_0x54b0ce[_0x52b79f(0x18f)])||parseInt(_0x54b0ce['stock'])<parseInt(_0x54b0ce[_0x52b79f(0x18f)])&&parseInt(_0x54b0ce[_0x52b79f(0x185)])>parseInt(_0x54b0ce[_0x52b79f(0x18f)])||parseInt(_0x54b0ce[_0x52b79f(0x18f)])==0x0)&&_0x1f4ef9++;});if(_0x1f4ef9!=0x0)return _0x4572c6['flash'](_0x4150f1(0x143),_0x4150f1(0x191)),_0x505764[_0x4150f1(0x15c)](_0x4150f1(0x19a));const _0x188ba1=await sales_finished[_0x4150f1(0x187)]({'invoice':_0x555e2f});_0x188ba1['return_data']='True';const _0x457490=await _0x188ba1[_0x4150f1(0x136)](),_0x4732b9=new sales_return_finished({'invoice':_0x555e2f,'customer':_0x4572c6['body']['customer'],'date':_0x2d9752,'warehouse_name':_0x57dc67,'room':_0x25d2ea,'ToWarehouse':_0x3fd2fa,'ToRoom':_0x345e9d,'return_sale':_0x408e85,'note':_0x4dcd1f,'warehouse_cat':_0x125f6b}),_0x2f9914=await _0x4732b9[_0x4150f1(0x136)](),_0x256883=await sales_return_finished['findOne']({'invoice':_0x555e2f}),_0xdc245f=await warehouse[_0x4150f1(0x187)]({'name':_0x3fd2fa,'room':_0x345e9d,'warehouse_category':'Finished\x20Goods'});_0x256883[_0x4150f1(0x1f6)][_0x4150f1(0x13d)](_0x307aef=>{var _0x238e63=_0x4150f1,_0x6feb2=0x0;const _0xb0d4d4=_0xdc245f[_0x238e63(0x243)][_0x238e63(0x1d0)](_0x4738cc=>{var _0x39fbb6=_0x238e63;_0x4738cc[_0x39fbb6(0x178)]==_0x307aef[_0x39fbb6(0x178)]&&_0x4738cc['bay']==_0x307aef[_0x39fbb6(0x18b)]&&_0x4738cc[_0x39fbb6(0x1f9)]==_0x307aef[_0x39fbb6(0x1f9)]&&_0x4738cc[_0x39fbb6(0x20c)]==_0x307aef[_0x39fbb6(0x20c)]&&_0x4738cc[_0x39fbb6(0x175)]==_0x307aef[_0x39fbb6(0x175)]&&(_0x4738cc[_0x39fbb6(0x162)]=parseInt(_0x4738cc['product_stock'])+parseInt(_0x307aef['return_qty']),_0x6feb2++);});_0x6feb2=='0'&&(_0xdc245f[_0x238e63(0x243)]=_0xdc245f[_0x238e63(0x243)]['concat']({'product_name':_0x307aef[_0x238e63(0x178)],'product_stock':_0x307aef[_0x238e63(0x18f)],'primary_code':_0x307aef[_0x238e63(0x1ea)],'secondary_code':_0x307aef[_0x238e63(0x1ae)],'product_code':_0x307aef[_0x238e63(0x21e)],'bay':_0x307aef[_0x238e63(0x18b)],'batch_code':_0x307aef[_0x238e63(0x175)],'maxPerUnit':_0x307aef[_0x238e63(0x1b6)],'production_date':_0x307aef[_0x238e63(0x20c)],'expiry_date':_0x307aef[_0x238e63(0x1f9)],'secondary_unit':_0x307aef[_0x238e63(0x16e)],'unit':_0x307aef['unit'],'maxProducts':_0x307aef['maxProducts']}));}),await _0xdc245f[_0x4150f1(0x136)](),console[_0x4150f1(0x1e1)](_0x4572c6['body']);const _0x358817=new c_payment_data({'invoice':_0x555e2f,'customer':_0x4572c6[_0x4150f1(0x1e3)]['customer'],'reason':_0x4150f1(0x208)});await _0x358817['save']();const _0x97afcc=await master_shop[_0x4150f1(0x138)]();console[_0x4150f1(0x1e1)](_0x4150f1(0x1ef),_0x97afcc[0x0][_0x4150f1(0x220)]);const _0x2f8935=await email_settings['findOne'](),_0x37d653=await customer['findOne']({'name':_0x4572c6[_0x4150f1(0x1e3)][_0x4150f1(0x173)]});console[_0x4150f1(0x1e1)](_0x4150f1(0x1d8),_0x37d653);_0x97afcc[0x0]['currency_placement']==0x1?(right_currency=_0x97afcc[0x0][_0x4150f1(0x215)],left_currency=''):(right_currency='',left_currency=_0x97afcc[0x0]['currency']);var _0x4ca241=_0x2bb3e6,_0x4dd178=_0xc7ad72,_0x786ff5='',_0x23df95;for(_0x23df95 in _0x4ca241){_0x786ff5+=_0x4150f1(0x1c5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4ca241[_0x23df95]+'</td>'+_0x4150f1(0x196)+_0x4dd178[_0x23df95]+'</td>'+'</tr>';}console[_0x4150f1(0x1e1)](_0x4150f1(0x222),_0x786ff5);let _0x389425=nodemailer[_0x4150f1(0x1d9)]({'service':_0x4150f1(0x174),'auth':{'user':_0x2f8935[_0x4150f1(0x1d7)],'pass':_0x2f8935[_0x4150f1(0x228)]}}),_0x2f08ef={'from':_0x2f8935['email'],'to':_0x37d653[_0x4150f1(0x1d7)],'subject':_0x4150f1(0x17b),'attachments':[{'filename':_0x4150f1(0x1a3),'path':__dirname+'/../public'+_0x4150f1(0x16d)+_0x97afcc[0x0][_0x4150f1(0x220)],'cid':_0x4150f1(0x13a)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x4150f1(0x176)+'<div>'+_0x4150f1(0x224)+_0x4150f1(0x15e)+_0x4150f1(0x1ad)+_0x4150f1(0x245)+_0x4150f1(0x15e)+_0x4150f1(0x246)+_0x97afcc[0x0]['site_title']+_0x4150f1(0x210)+_0x4150f1(0x245)+_0x4150f1(0x245)+'<hr\x20class=\x22my-3\x22>'+_0x4150f1(0x15e)+_0x4150f1(0x20a)+_0x4150f1(0x137)+_0x555e2f+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x4150f1(0x1d2)+_0x2d9752+'\x20'+_0x4150f1(0x156)+_0x4150f1(0x1b2)+'</div>'+_0x4150f1(0x1f7)+_0x4150f1(0x13f)+_0x4150f1(0x1c5)+_0x4150f1(0x205)+_0x4150f1(0x1b9)+_0x4150f1(0x17f)+_0x4150f1(0x15b)+_0x4150f1(0x247)+_0x4150f1(0x1de)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x786ff5+'\x20'+_0x4150f1(0x23c)+'</table>'+'<div>'+_0x4150f1(0x181)+_0x4150f1(0x18e)+_0x97afcc[0x0][_0x4150f1(0x149)]+_0x4150f1(0x1b2)+_0x4150f1(0x245)+_0x4150f1(0x245)+_0x4150f1(0x202)};_0x389425[_0x4150f1(0x1bd)](_0x2f08ef,function(_0x4877b6,_0x1d2e1b){var _0x58f087=_0x4150f1;_0x4877b6?(console[_0x58f087(0x1e1)](_0x4877b6),console['log'](_0x58f087(0x17a))):console[_0x58f087(0x1e1)](_0x58f087(0x189));}),_0x4572c6[_0x4150f1(0x1b0)](_0x4150f1(0x20e),_0x4150f1(0x24d)),_0x505764['redirect'](_0x4150f1(0x22d));}catch(_0xfb61d7){console[_0x4150f1(0x1e1)](_0xfb61d7),_0x505764['status'](0xc8)[_0x4150f1(0x1bc)]({'message1':_0xfb61d7[_0x4150f1(0x190)]});}}}),router[a0_0x5a4c10(0x22f)](a0_0x5a4c10(0x1bb),auth,async(_0x364053,_0x548ce5)=>{var _0x3771e8=a0_0x5a4c10;try{const {username:_0x1422a3,email:_0x3c39ee,role:_0x2f7593}=_0x364053[_0x3771e8(0x1f8)],_0x3aee8d=_0x364053[_0x3771e8(0x1f8)],_0x1f6b2d=await profile[_0x3771e8(0x187)]({'email':_0x3aee8d[_0x3771e8(0x1d7)]}),_0x3cc96f=await master_shop[_0x3771e8(0x138)]();console[_0x3771e8(0x1e1)](_0x3771e8(0x1dd),_0x3cc96f);const _0x5a3746=_0x364053['params']['id'],_0x180c59=await sales['findById'](_0x5a3746);console[_0x3771e8(0x1e1)](_0x3771e8(0x19d),_0x180c59);if(_0x3cc96f[0x0]['language']==_0x3771e8(0x24e))var _0xa69c17=users[_0x3771e8(0x230)];else{if(_0x3cc96f[0x0][_0x3771e8(0x142)]==_0x3771e8(0x1cb))var _0xa69c17=users[_0x3771e8(0x1cb)];else{if(_0x3cc96f[0x0]['language']==_0x3771e8(0x1f5))var _0xa69c17=users[_0x3771e8(0x1f5)];else{if(_0x3cc96f[0x0]['language']==_0x3771e8(0x13c))var _0xa69c17=users[_0x3771e8(0x13c)];else{if(_0x3cc96f[0x0][_0x3771e8(0x142)]==_0x3771e8(0x195))var _0xa69c17=users[_0x3771e8(0x195)];else{if(_0x3cc96f[0x0][_0x3771e8(0x142)]==_0x3771e8(0x203))var _0xa69c17=users[_0x3771e8(0x1d4)];else{if(_0x3cc96f[0x0][_0x3771e8(0x142)]==_0x3771e8(0x212))var _0xa69c17=users['Chinese'];else{if(_0x3cc96f[0x0][_0x3771e8(0x142)]==_0x3771e8(0x163))var _0xa69c17=users[_0x3771e8(0x206)];}}}}}}}_0x548ce5[_0x3771e8(0x1e5)](_0x3771e8(0x139),{'success':_0x364053[_0x3771e8(0x1b0)](_0x3771e8(0x20e)),'errors':_0x364053[_0x3771e8(0x1b0)]('errors'),'role':_0x3aee8d,'profile':_0x1f6b2d,'alldata':_0x180c59,'master_shop':_0x3cc96f,'language':_0xa69c17});}catch(_0x3201ef){console['log'](_0x3201ef);}}),router[a0_0x5a4c10(0x204)]('/barcode_scanner',async(_0x11fffa,_0x349d4b)=>{var _0x5e6026=a0_0x5a4c10;const {product_code:_0x5be489,warehouse_name:_0x377a3a,rooms_data:_0x397edf,Roomslist:_0x194508}=_0x11fffa['body'],_0x1d9bc0=_0x194508[_0x5e6026(0x1d1)](','),_0x1d0e28=[];async function _0x1ce8fa(_0x4304ab){var _0x2843c6=_0x5e6026;const _0x48a1a7=await warehouse[_0x2843c6(0x22c)]([{'$match':{'name':_0x377a3a,'room':_0x4304ab}},{'$unwind':_0x2843c6(0x14d)},{'$match':{'product_details.primary_code':_0x5be489}},{'$group':{'_id':_0x2843c6(0x1cf),'name':{'$first':_0x2843c6(0x171)},'product_stock':{'$first':_0x2843c6(0x1b7)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2843c6(0x1da)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2843c6(0x1aa)},'type':{'$first':_0x2843c6(0x1c4)},'pallet':{'$first':_0x2843c6(0x147)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2843c6(0x16f)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2843c6(0x237)},'production_date':{'$first':_0x2843c6(0x23b)},'maxPerUnit':{'$first':_0x2843c6(0x248)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2843c6(0x192)},'invoice':{'$first':_0x2843c6(0x161)}}}]),_0x391264=await warehouse[_0x2843c6(0x22c)]([{'$match':{'name':_0x377a3a,'room':_0x4304ab}},{'$unwind':_0x2843c6(0x14d)},{'$match':{'product_details.secondary_code':_0x5be489}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2843c6(0x171)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2843c6(0x1cc)},'secondary_code':{'$first':_0x2843c6(0x1da)},'product_code':{'$first':_0x2843c6(0x152)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2843c6(0x1aa)},'type':{'$first':_0x2843c6(0x1c4)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2843c6(0x1fa)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2843c6(0x168)},'expiry_date':{'$first':_0x2843c6(0x237)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2843c6(0x1be)},'product_cat':{'$first':_0x2843c6(0x1f1)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2843c6(0x192)},'invoice':{'$first':_0x2843c6(0x161)}}}]);if(_0x48a1a7[_0x2843c6(0x165)]>0x0)_0x1d0e28['push'](_0x48a1a7);else _0x391264[_0x2843c6(0x165)]>0x0&&_0x1d0e28['push'](_0x391264);}const _0x54f210=_0x1d9bc0[_0x5e6026(0x1d0)](_0x48181e=>_0x1ce8fa(_0x48181e));await Promise[_0x5e6026(0x1ab)](_0x54f210),_0x349d4b[_0x5e6026(0x1bc)](_0x1d0e28);}),module[a0_0x5a4c10(0x150)]=router;