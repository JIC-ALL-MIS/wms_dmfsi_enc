function a0_0x3e7f(_0x443634,_0x43e083){var _0x207adc=a0_0x207a();return a0_0x3e7f=function(_0x3e7f6d,_0x462c99){_0x3e7f6d=_0x3e7f6d-0x191;var _0x588f24=_0x207adc[_0x3e7f6d];return _0x588f24;},a0_0x3e7f(_0x443634,_0x43e083);}function a0_0x207a(){var _0x2d6cc1=['staff','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','get','params','currency','abs','redirect','<h5>','../public/language/languages.json','$product_details.invoice','aggregate','floor','Spanish','</h5>','product_name','$product_details.storage','prod_invoice','English','$sale_product.type','back','expiry_date_QA','secondary_code','$return_data','save','room','Arabic\x20(ae)','$product_details.type','/view','secondary_unit_QA','French','unit','$product_details.room_name','1591485WgIktZ','primary_unit','$note','secondary_unit','/view/add_sales','<!DOCTYPE\x20html>','Enclosed','</table>','$product_details.floorlevel','primary_code','QA\x20Warehouse','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$sale_product.floorlevel','/all_sales/view','return_qty','forEach','$product_details.product_stock','Logo.png','</body></html>','barcode\x20Product\x20master','$product_details.unit','toString','/preview/:id','$product_details.batch_code','findById','note','56MNVuOz','sales\x20item\x20return\x20successfull','$sale_product.quantity','German','</td>','all','finalize','$warehouse_name','all_sales_barcode','maxPerUnit','sales_quantity_QA','all_sales_finished','$product_details._id','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.secondary_unit','maxPerUnit_QA','$product_details.production_date','/barcode_scanner','name','<hr\x20class=\x22my-3\x22>','\x20<>\x20','customer_data','port','$product','quantity','bay','max','/picking_list/pdf/','/give_payment/:id','primary_code_QA','site_title','date_data','for_categorize','getFullYear','Finished\x20Goods','Ambient','/all_sales_finished/view','invoice','$invoice','logo','OUTF-','received_amount','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_details','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','Return\x20Rooms','getDate','$sale_product','slice','Sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','1767676mCuYJo','sale_product','$product_details.expiry_date','$_id','nodemailer','/upload/','suppliers','production_date_QA','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Portuguese\x20(BR)','render','sales_quantity','/view/return_sales/:id','post','../models/all_models','split','$sale_product.bay','product_name_QA1','Arabic','body','add\x20post','<h2>\x20','edit_sales_finished','date','id_transaction_from','log','edit_sales_finished_view','\x20Order\x20Number\x20:\x20','host','361860ubFOvF','Received\x20Payment\x20For\x20Sale','Return\x20Goods','</span>','True','customers_docs','findOne','/view/:id','$product_details.product_cat','customer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_cat','$finalize','RoomAssigned','$product_details.bin','\x20Order\x20Date\x20:\x20','filter','/../public','sales_invoice','room_name','product_date','errors','stock','<h5\x20style=\x22text-align:\x20left;\x22>','310668isotOy','return_data','level','error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','map','/invoice/:id','find','sale_qty','maxProducts','role','max_per_unit','email','stocks_QA','<span\x20style=\x22float:\x20right;\x22>','product_stock','getMonth','$product_details.product_name','status','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','string','689672BIaBaG','product_code','False','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','out_invoice','17227503GtDukx','Portuguese','$room','warehouse','<div>','$product_details.primary_code','</thead>','Sale\x20Return\x20Mail','currency_placement','expiry_date','Quality\x20Inspection','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Sale\x20Return','$product_details.bay','length','product_list','$product_details.maxPerUnit','adjust_qty','$product.product_name','return_sale','English\x20(US)','/view/add_sale/product','gmail','production_date','$product_details.product_code','express','return_sale_QA','purchases_data','image','$sale_product.bin','product','</head><body>','unit_QA','maxperunit','/all_sales_finished/preview/','flash','<tr>','createTransport','language','message','sendMail','$customers_docs','master','<html><head><title></title>','1sXflty','\x20</h2>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</tr>','concat','warehouse_name','product_code_QA','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','stock_data','amount','<table\x20style=\x22width:\x20100%\x20!important;\x22>','2269390gifJLy','password','Hindi','then','customers','add_sales_finished','_id','due_amount','barcode\x20user_id','</tbody>','<strong>\x20Regards\x20</strong>','json','success','$product_details.secondary_code','user','$product_details.rack','FGSEmail','</div>','Error\x20Occurs','$product_details','catch','foreach\x20newproduct','$date','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Sales\x20Update\x20successfully','batch_code_QA','$name','return_qty_QA','batch_code','/barcode/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_code','product_data'];a0_0x207a=function(){return _0x2d6cc1;};return a0_0x207a();}var a0_0x8d9934=a0_0x3e7f;(function(_0x1a69c8,_0xd7a448){var _0x3c8705=a0_0x3e7f,_0xae2c48=_0x1a69c8();while(!![]){try{var _0x3742b6=parseInt(_0x3c8705(0x1ca))/0x1*(parseInt(_0x3c8705(0x266))/0x2)+parseInt(_0x3c8705(0x218))/0x3+-parseInt(_0x3c8705(0x29b))/0x4+parseInt(_0x3c8705(0x1d5))/0x5+parseInt(_0x3c8705(0x283))/0x6*(parseInt(_0x3c8705(0x233))/0x7)+parseInt(_0x3c8705(0x199))/0x8+-parseInt(_0x3c8705(0x19e))/0x9;if(_0x3742b6===_0xd7a448)break;else _0xae2c48['push'](_0xae2c48['shift']());}catch(_0x18a9bd){_0xae2c48['push'](_0xae2c48['shift']());}}}(a0_0x207a,0x6ca8a));const express=require(a0_0x8d9934(0x1b7)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x8d9934(0x274)),auth=require('../middleware/auth'),nodemailer=require(a0_0x8d9934(0x26a)),users=require(a0_0x8d9934(0x200));router[a0_0x8d9934(0x1fa)](a0_0x8d9934(0x213),auth,async(_0x2e3575,_0x493c9e)=>{var _0x221313=a0_0x8d9934;try{const {username:_0x2a590a,email:_0x1e7a3a,role:_0x104d65}=_0x2e3575['user'],_0x283a1f=_0x2e3575[_0x221313(0x1e3)],_0x2fce09=await profile[_0x221313(0x289)]({'email':_0x283a1f[_0x221313(0x2a7)]}),_0x20ed27=await master_shop[_0x221313(0x2a2)]();let _0x4934c8;if(_0x283a1f['role']==_0x221313(0x1f7)){const _0x2ed296=await staff[_0x221313(0x289)]({'email':_0x283a1f['email']});_0x4934c8=await sales_finished[_0x221313(0x202)]([{'$lookup':{'from':'customers','localField':_0x221313(0x28c),'foreignField':_0x221313(0x245),'as':_0x221313(0x288)}},{'$unwind':_0x221313(0x1c7)},{'$unwind':_0x221313(0x262)},{'$group':{'_id':_0x221313(0x269),'invoice':{'$first':_0x221313(0x259)},'customers':{'$first':'$customer'},'date':{'$first':_0x221313(0x1eb)},'warehouse_name':{'$first':_0x221313(0x23a)},'sale_product':{'$push':_0x221313(0x262)},'note':{'$first':_0x221313(0x21a)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x221313(0x235)},'level':{'$addToSet':_0x221313(0x276)},'isle':{'$addToSet':_0x221313(0x1bb)},'type':{'$addToSet':_0x221313(0x20a)},'pallet':{'$addToSet':_0x221313(0x225)},'finalize':{'$first':_0x221313(0x28f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x4934c8=await sales_finished[_0x221313(0x202)]([{'$lookup':{'from':_0x221313(0x1d9),'localField':_0x221313(0x28c),'foreignField':_0x221313(0x245),'as':_0x221313(0x288)}},{'$unwind':_0x221313(0x1c7)},{'$unwind':_0x221313(0x262)},{'$group':{'_id':_0x221313(0x269),'invoice':{'$first':_0x221313(0x259)},'customers':{'$first':'$customer'},'date':{'$first':_0x221313(0x1eb)},'warehouse_name':{'$first':_0x221313(0x23a)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x221313(0x21a)},'return_data':{'$first':_0x221313(0x20e)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x221313(0x235)},'level':{'$addToSet':_0x221313(0x276)},'isle':{'$addToSet':_0x221313(0x1bb)},'type':{'$addToSet':_0x221313(0x20a)},'pallet':{'$addToSet':_0x221313(0x225)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x20ed27[0x0][_0x221313(0x1c4)]=='English\x20(US)'){var _0x5333cd=users[_0x221313(0x209)];console['log'](_0x5333cd);}else{if(_0x20ed27[0x0][_0x221313(0x1c4)]==_0x221313(0x1d7))var _0x5333cd=users[_0x221313(0x1d7)];else{if(_0x20ed27[0x0][_0x221313(0x1c4)]=='German')var _0x5333cd=users[_0x221313(0x236)];else{if(_0x20ed27[0x0]['language']==_0x221313(0x204))var _0x5333cd=users[_0x221313(0x204)];else{if(_0x20ed27[0x0][_0x221313(0x1c4)]==_0x221313(0x215))var _0x5333cd=users[_0x221313(0x215)];else{if(_0x20ed27[0x0][_0x221313(0x1c4)]==_0x221313(0x26f))var _0x5333cd=users[_0x221313(0x19f)];else{if(_0x20ed27[0x0][_0x221313(0x1c4)]==_0x221313(0x223))var _0x5333cd=users[_0x221313(0x223)];else{if(_0x20ed27[0x0]['language']==_0x221313(0x211))var _0x5333cd=users['Arabic'];}}}}}}}_0x493c9e['render'](_0x221313(0x23e),{'success':_0x2e3575['flash'](_0x221313(0x1e1)),'errors':_0x2e3575[_0x221313(0x1c1)](_0x221313(0x298)),'sales':_0x4934c8,'profile':_0x2fce09,'role':_0x283a1f,'master_shop':_0x20ed27,'language':_0x5333cd});}catch(_0x307d3b){console['log'](_0x307d3b);}});async function getRandom8DigitNumber(){var _0x569751=a0_0x8d9934;const _0x274ef8=0x989680,_0x4c0e6a=0x5f5e0ff,_0x420937=Math[_0x569751(0x203)](Math['random']()*(_0x4c0e6a-_0x274ef8+0x1))+_0x274ef8;var _0x379f13;const _0x16000c=await sales_finished[_0x569751(0x289)]({'invoice':_0x569751(0x25b)+_0x420937});return _0x16000c&&_0x16000c['length']>0x0?_0x379f13=_0x569751(0x25b)+_0x420937:_0x379f13=_0x569751(0x25b)+_0x420937,_0x379f13;}router['get'](a0_0x8d9934(0x21c),auth,async(_0x4a82bd,_0x55cb7e)=>{var _0x20749c=a0_0x8d9934;try{const {username:_0x3d848f,email:_0x37aed9,role:_0x29c440}=_0x4a82bd[_0x20749c(0x1e3)],_0x487239=_0x4a82bd[_0x20749c(0x1e3)],_0x4cbd5f=await profile[_0x20749c(0x289)]({'email':_0x487239[_0x20749c(0x2a7)]}),_0x39da62=await master_shop[_0x20749c(0x2a2)](),_0x351d57=await customer[_0x20749c(0x2a2)]({});let _0x41504a;if(_0x487239[_0x20749c(0x2a5)]==_0x20749c(0x1f7)){const _0xe9ae8e=await staff[_0x20749c(0x289)]({'email':_0x487239[_0x20749c(0x2a7)]});_0x41504a=await warehouse[_0x20749c(0x202)]([{'$match':{'status':_0x20749c(0x1f8),'name':_0xe9ae8e[_0x20749c(0x1a1)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x20749c(0x222)}}},{'$group':{'_id':_0x20749c(0x1f0),'name':{'$first':_0x20749c(0x1f0)}}},{'$sort':{'name':0x1}}]);}else _0x41504a=await warehouse[_0x20749c(0x202)]([{'$match':{'status':_0x20749c(0x1f8),'warehouse_category':_0x20749c(0x255),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x20749c(0x1f0),'name':{'$first':_0x20749c(0x1f0)}}},{'$sort':{'name':0x1}}]);const _0x52c276=await product[_0x20749c(0x2a2)]({});var _0x8248bf=[_0x20749c(0x256),_0x20749c(0x21e)];const _0x5b9427=await sales_finished[_0x20749c(0x2a2)]({}),_0x2f7bde=_0x5b9427['length']+0x1,_0x1a90ef=_0x20749c(0x25b)+_0x2f7bde[_0x20749c(0x22e)]()['padStart'](0x5,'0');if(_0x39da62[0x0][_0x20749c(0x1c4)]==_0x20749c(0x1b2)){var _0x55cac3=users[_0x20749c(0x209)];console[_0x20749c(0x27f)](_0x55cac3);}else{if(_0x39da62[0x0][_0x20749c(0x1c4)]==_0x20749c(0x1d7))var _0x55cac3=users[_0x20749c(0x1d7)];else{if(_0x39da62[0x0][_0x20749c(0x1c4)]==_0x20749c(0x236))var _0x55cac3=users[_0x20749c(0x236)];else{if(_0x39da62[0x0][_0x20749c(0x1c4)]=='Spanish')var _0x55cac3=users[_0x20749c(0x204)];else{if(_0x39da62[0x0]['language']==_0x20749c(0x215))var _0x55cac3=users[_0x20749c(0x215)];else{if(_0x39da62[0x0][_0x20749c(0x1c4)]=='Portuguese\x20(BR)')var _0x55cac3=users[_0x20749c(0x19f)];else{if(_0x39da62[0x0][_0x20749c(0x1c4)]==_0x20749c(0x223))var _0x55cac3=users[_0x20749c(0x223)];else{if(_0x39da62[0x0][_0x20749c(0x1c4)]==_0x20749c(0x211))var _0x55cac3=users[_0x20749c(0x278)];}}}}}}}const _0x1fcc84=getRandom8DigitNumber();_0x1fcc84['then'](_0x298a78=>{var _0x3b7026=_0x20749c;_0x55cb7e[_0x3b7026(0x270)](_0x3b7026(0x1da),{'success':_0x4a82bd[_0x3b7026(0x1c1)]('success'),'errors':_0x4a82bd[_0x3b7026(0x1c1)](_0x3b7026(0x298)),'role':_0x487239,'profile':_0x4cbd5f,'customer':_0x351d57,'warehouse':_0x41504a,'product':_0x52c276,'invoice':_0x298a78,'master_shop':_0x39da62,'language':_0x55cac3,'rooms_data':_0x8248bf});})[_0x20749c(0x1e9)](_0x455c7c=>{var _0x260ce6=_0x20749c;_0x4a82bd[_0x260ce6(0x1c1)](_0x260ce6(0x298),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x55cb7e[_0x260ce6(0x1fe)](_0x260ce6(0x257));});}catch(_0x289346){console[_0x20749c(0x27f)](_0x289346);}}),router[a0_0x8d9934(0x1fa)]('/view/add_sales/:id',auth,async(_0x23fa61,_0x4f6934)=>{var _0x2db9f1=a0_0x8d9934;try{const _0x1b6165=_0x23fa61[_0x2db9f1(0x1fb)]['id'];console[_0x2db9f1(0x27f)](_0x1b6165);const _0x1a7fa7=await product[_0x2db9f1(0x2a2)](),_0x8e2168=await purchases[_0x2db9f1(0x202)]([{'$match':{'warehouse_name':_0x1b6165}},{'$unwind':_0x2db9f1(0x24a)},{'$group':{'_id':_0x2db9f1(0x1b0)}}]);console[_0x2db9f1(0x27f)](_0x2db9f1(0x1b9),_0x8e2168),_0x4f6934[_0x2db9f1(0x195)](0xc8)[_0x2db9f1(0x1e0)]({'purchases_data':_0x8e2168,'product_data':_0x1a7fa7});}catch(_0x3f87ab){console[_0x2db9f1(0x27f)](_0x3f87ab);}}),router['post'](a0_0x8d9934(0x1b3),auth,async(_0x130c1e,_0x18c77b)=>{var _0x3a547f=a0_0x8d9934;try{const {warehouse_data:_0x59cb1f,product_data:_0xe34e87}=_0x130c1e[_0x3a547f(0x279)];console['log'](_0x130c1e[_0x3a547f(0x279)][_0x3a547f(0x1f6)]);;const _0x20ef1c=await master_shop[_0x3a547f(0x2a2)]();console[_0x3a547f(0x27f)](_0x3a547f(0x1c8),_0x20ef1c);const _0x2b9902=await product[_0x3a547f(0x289)]({'name':_0xe34e87});console[_0x3a547f(0x27f)](_0x3a547f(0x1bc),_0x2b9902);const _0x1aa5cb=await warehouse[_0x3a547f(0x202)]([{'$match':{'name':_0x59cb1f}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0xe34e87}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x3a547f(0x229)}}}]);console['log'](_0x3a547f(0x1d2),_0x1aa5cb),_0x18c77b[_0x3a547f(0x195)](0xc8)['json']({'master':_0x20ef1c,'new_product':_0x2b9902,'stock_data':_0x1aa5cb});}catch(_0x127452){console[_0x3a547f(0x27f)](_0x127452);}}),router[a0_0x8d9934(0x273)](a0_0x8d9934(0x21c),auth,async(_0x2cd3f4,_0x14419f)=>{var _0x4dc266=a0_0x8d9934;try{const {invoice:_0x544ee3,date:_0x49fa09,warehouse_name:_0x488a3f,product_name:_0x5b4883,stock:_0x168e8c,quantity:_0x1760fb,note:_0x43b7b3,room:_0x33ce54,primary_code:_0x145f49,secondary_code:_0x3382ca,prod_code:_0x4ac682,level:_0xb5b52d,isle:_0x19837b,pallet:_0x72ae63,batch_code:_0xba11f8,SCRN:_0x13c54a,expiry_date:_0x4e9031,mode_transpo:_0x6fc8dd,name_driver:_0x35ed89}=_0x2cd3f4[_0x4dc266(0x279)];if(typeof _0x5b4883=='string')var _0x32dd0e=[_0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x206)]],_0x1497ad=[_0x2cd3f4[_0x4dc266(0x279)]['stock']],_0xe6a4ae=[_0x2cd3f4[_0x4dc266(0x279)]['carton']],_0x49f3cd=[_0x2cd3f4[_0x4dc266(0x279)]['primary_code']],_0x104cea=[_0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x20d)]],_0x500514=[_0x2cd3f4['body'][_0x4dc266(0x1f5)]],_0x494153=[_0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x29d)]],_0x48bc82=[_0x2cd3f4['body'][_0x4dc266(0x219)]],_0x30df7b=[_0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x21b)]],_0x50eaa8=[_0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x1f2)]],_0x1bfea5=[_0x2cd3f4['body'][_0x4dc266(0x1a7)]],_0x21ec6b=[_0x2cd3f4['body'][_0x4dc266(0x297)]],_0x25f1b8=[_0x2cd3f4['body'][_0x4dc266(0x2a6)]],_0x3d62a9=[_0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x28e)]],_0x20f9ac=[_0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x290)]],_0x468baa=[_0x2cd3f4['body'][_0x4dc266(0x208)]],_0x3626ad=[_0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x27e)]];else var _0x32dd0e=[..._0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x206)]],_0x1497ad=[..._0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x299)]],_0xe6a4ae=[..._0x2cd3f4[_0x4dc266(0x279)]['carton']],_0x49f3cd=[..._0x2cd3f4[_0x4dc266(0x279)]['primary_code']],_0x104cea=[..._0x2cd3f4['body'][_0x4dc266(0x20d)]],_0x500514=[..._0x2cd3f4[_0x4dc266(0x279)]['prod_code']],_0x494153=[..._0x2cd3f4['body'][_0x4dc266(0x29d)]],_0x48bc82=[..._0x2cd3f4[_0x4dc266(0x279)]['primary_unit']],_0x30df7b=[..._0x2cd3f4[_0x4dc266(0x279)]['secondary_unit']],_0x50eaa8=[..._0x2cd3f4[_0x4dc266(0x279)]['batch_code']],_0x1bfea5=[..._0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x1a7)]],_0x21ec6b=[..._0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x297)]],_0x25f1b8=[..._0x2cd3f4['body'][_0x4dc266(0x2a6)]],_0x3d62a9=[..._0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x28e)]],_0x20f9ac=[..._0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x290)]],_0x468baa=[..._0x2cd3f4[_0x4dc266(0x279)]['prod_invoice']],_0x3626ad=[..._0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x27e)]];const _0x3ea9c0=_0x32dd0e[_0x4dc266(0x2a0)](_0x4a6174=>{return _0x4a6174={'product_name':_0x4a6174};});_0x1497ad[_0x4dc266(0x228)]((_0x5b83fe,_0x261229)=>{var _0x1b1d87=_0x4dc266;_0x3ea9c0[_0x261229][_0x1b1d87(0x299)]=_0x5b83fe;}),_0xe6a4ae[_0x4dc266(0x228)]((_0x206658,_0x30886f)=>{var _0x324322=_0x4dc266;_0x3ea9c0[_0x30886f]['quantity']=Math[_0x324322(0x1fd)](_0x206658);}),_0x3626ad[_0x4dc266(0x228)]((_0x33b0c5,_0x310a38)=>{var _0x39cd89=_0x4dc266;_0x3ea9c0[_0x310a38][_0x39cd89(0x27e)]=_0x33b0c5;}),_0x49f3cd[_0x4dc266(0x228)]((_0x14ed28,_0x2ceb4f)=>{var _0x4de716=_0x4dc266;_0x3ea9c0[_0x2ceb4f][_0x4de716(0x221)]=_0x14ed28;}),_0x104cea[_0x4dc266(0x228)]((_0x41699d,_0x2ad1d3)=>{var _0x459128=_0x4dc266;_0x3ea9c0[_0x2ad1d3][_0x459128(0x20d)]=_0x41699d;}),_0x500514['forEach']((_0x44d543,_0x31e70c)=>{var _0x49da73=_0x4dc266;_0x3ea9c0[_0x31e70c]['product_code']=_0x44d543,_0x3ea9c0[_0x31e70c][_0x49da73(0x252)]=_0x49fa09;}),_0x494153[_0x4dc266(0x228)]((_0x4c80bd,_0x28c434)=>{var _0x37f321=_0x4dc266;_0x3ea9c0[_0x28c434][_0x37f321(0x24c)]=_0x4c80bd;}),_0x48bc82[_0x4dc266(0x228)]((_0x279f69,_0x59b27a)=>{_0x3ea9c0[_0x59b27a]['unit']=_0x279f69;}),_0x30df7b[_0x4dc266(0x228)]((_0x1fec0b,_0x42862f)=>{var _0x225255=_0x4dc266;_0x3ea9c0[_0x42862f][_0x225255(0x21b)]=_0x1fec0b;}),_0x50eaa8[_0x4dc266(0x228)]((_0x15265e,_0x413c70)=>{var _0x2e1706=_0x4dc266;_0x3ea9c0[_0x413c70][_0x2e1706(0x1f2)]=_0x15265e;}),_0x1bfea5['forEach']((_0x9a01e6,_0x516aee)=>{_0x3ea9c0[_0x516aee]['expiry_date']=_0x9a01e6;}),_0x21ec6b[_0x4dc266(0x228)]((_0xee927,_0x1aaeeb)=>{var _0x1f65c4=_0x4dc266;_0x3ea9c0[_0x1aaeeb][_0x1f65c4(0x1b5)]=_0xee927;}),_0x25f1b8[_0x4dc266(0x228)]((_0x184ef7,_0x32c9d6)=>{var _0x1c6f07=_0x4dc266;_0x3ea9c0[_0x32c9d6][_0x1c6f07(0x1bf)]=_0x184ef7;}),_0x3d62a9[_0x4dc266(0x228)]((_0xa750ec,_0x549c31)=>{var _0x29cbc1=_0x4dc266;_0x3ea9c0[_0x549c31][_0x29cbc1(0x28e)]=_0xa750ec;}),_0x20f9ac[_0x4dc266(0x228)]((_0x3c3403,_0x329458)=>{var _0x47ce21=_0x4dc266;_0x3ea9c0[_0x329458][_0x47ce21(0x296)]=_0x3c3403;}),_0x468baa[_0x4dc266(0x228)]((_0x10f833,_0x3729af)=>{var _0x2923eb=_0x4dc266;_0x3ea9c0[_0x3729af][_0x2923eb(0x258)]=_0x10f833;});var _0x1c5a3c=0x0;_0x3ea9c0[_0x4dc266(0x228)](_0x43b135=>{var _0x1de6fa=_0x4dc266;parseFloat(_0x43b135[_0x1de6fa(0x299)])<parseFloat(_0x43b135['quantity'])&&parseFloat(_0x43b135[_0x1de6fa(0x24b)])>parseFloat(_0x43b135['stock'])&&(console['log'](_0x43b135[_0x1de6fa(0x299)]+_0x1de6fa(0x247)+_0x43b135[_0x1de6fa(0x24b)]),_0x1c5a3c++);});if(_0x1c5a3c!=0x0)return _0x2cd3f4[_0x4dc266(0x1c1)]('errors',_0x4dc266(0x25f)),_0x14419f['redirect'](_0x4dc266(0x20b));const _0x475786=_0x3ea9c0[_0x4dc266(0x293)](_0xa94e05=>_0xa94e05[_0x4dc266(0x24b)]!=='0'&&_0xa94e05[_0x4dc266(0x24b)]!==''),_0x5e1106=new sales_finished({'invoice':_0x544ee3,'customer':_0x2cd3f4[_0x4dc266(0x279)]['customer'],'date':_0x49fa09,'warehouse_name':_0x488a3f,'sale_product':_0x475786,'note':_0x43b7b3,'room':_0x33ce54,'primary_code':_0x145f49,'secondary_code':_0x3382ca,'prod_code':_0x4ac682,'SCRN':_0x13c54a,'finalize':_0x4dc266(0x19b),'mode_transpo':_0x6fc8dd,'name_driver':_0x35ed89}),_0x22db7b=await _0x5e1106[_0x4dc266(0x20f)](),_0x5bc81f=await sales_finished[_0x4dc266(0x289)]({'invoice':_0x544ee3}),_0x14147c=new c_payment_data({'invoice':_0x544ee3,'customer':_0x2cd3f4[_0x4dc266(0x279)][_0x4dc266(0x28c)],'reason':_0x4dc266(0x264)});await _0x14147c[_0x4dc266(0x20f)]();const _0x2ca027=await master_shop[_0x4dc266(0x2a2)](),_0x38e39e=await email_settings[_0x4dc266(0x289)](),_0x32bcc6=await customer['findOne']({'name':_0x2cd3f4[_0x4dc266(0x279)]['customer']});_0x2ca027[0x0][_0x4dc266(0x1a6)]==0x1?(right_currency=_0x2ca027[0x0][_0x4dc266(0x1fc)],left_currency=''):(right_currency='',left_currency=_0x2ca027[0x0]['currency']);var _0x1270e0=_0x32dd0e,_0x1a54cd=_0xe6a4ae,_0x5ea784='',_0x2b607c;for(_0x2b607c in _0x1270e0){_0x5ea784+='<tr>'+_0x4dc266(0x26e)+_0x1270e0[_0x2b607c]+_0x4dc266(0x237)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1a54cd[_0x2b607c]+_0x4dc266(0x237)+_0x4dc266(0x1cd);}console['log'](_0x4dc266(0x1ad),_0x5ea784),_0x2cd3f4[_0x4dc266(0x1c1)]('success','Sales\x20Add\x20successfully'),_0x14419f[_0x4dc266(0x1fe)](_0x4dc266(0x1c0)+_0x22db7b[_0x4dc266(0x1db)]);}catch(_0x25f496){console[_0x4dc266(0x27f)](_0x25f496);}}),router[a0_0x8d9934(0x1fa)](a0_0x8d9934(0x22f),auth,async(_0x5532da,_0x538c3a)=>{var _0x949477=a0_0x8d9934;try{const {username:_0x567777,email:_0x5b2910,role:_0x90108}=_0x5532da[_0x949477(0x1e3)],_0x1f30e0=_0x5532da[_0x949477(0x1e3)],_0x57de0c=await profile[_0x949477(0x289)]({'email':_0x1f30e0['email']}),_0x26352e=await master_shop[_0x949477(0x2a2)](),_0x99b2c9=_0x5532da[_0x949477(0x1fb)]['id'],_0x71c5d4=await sales_finished[_0x949477(0x231)](_0x99b2c9),_0x9819eb=await warehouse[_0x949477(0x202)]([{'$match':{'name':_0x71c5d4[_0x949477(0x1cf)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x949477(0x23f),'name':{'$first':_0x949477(0x194)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x949477(0x291)},'type':{'$first':_0x949477(0x212)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x949477(0x1a3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x949477(0x1b6)},'storage':{'$first':_0x949477(0x207)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x949477(0x230)},'room':{'$first':_0x949477(0x1a0)},'room_data':{'$first':_0x949477(0x217)}}}]),_0x471e39=await customer[_0x949477(0x2a2)]({});let _0x36aa58;if(_0x1f30e0[_0x949477(0x2a5)]=='staff'){const _0x1e8894=await staff[_0x949477(0x289)]({'email':_0x1f30e0[_0x949477(0x2a7)]});_0x36aa58=await warehouse[_0x949477(0x202)]([{'$match':{'status':_0x949477(0x1f8),'name':_0x1e8894[_0x949477(0x1a1)]}},{'$group':{'_id':_0x949477(0x1f0),'name':{'$first':_0x949477(0x1f0)}}}]);}else _0x36aa58=await warehouse[_0x949477(0x202)]([{'$match':{'status':_0x949477(0x1f8)}},{'$group':{'_id':_0x949477(0x1f0),'name':{'$first':_0x949477(0x1f0)}}}]);const _0x4847c3=await product['find']({});if(_0x26352e[0x0][_0x949477(0x1c4)]==_0x949477(0x1b2)){var _0x4a122f=users['English'];console[_0x949477(0x27f)](_0x4a122f);}else{if(_0x26352e[0x0]['language']==_0x949477(0x1d7))var _0x4a122f=users[_0x949477(0x1d7)];else{if(_0x26352e[0x0]['language']==_0x949477(0x236))var _0x4a122f=users[_0x949477(0x236)];else{if(_0x26352e[0x0][_0x949477(0x1c4)]==_0x949477(0x204))var _0x4a122f=users[_0x949477(0x204)];else{if(_0x26352e[0x0]['language']=='French')var _0x4a122f=users[_0x949477(0x215)];else{if(_0x26352e[0x0]['language']=='Portuguese\x20(BR)')var _0x4a122f=users[_0x949477(0x19f)];else{if(_0x26352e[0x0][_0x949477(0x1c4)]==_0x949477(0x223))var _0x4a122f=users[_0x949477(0x223)];else{if(_0x26352e[0x0][_0x949477(0x1c4)]==_0x949477(0x211))var _0x4a122f=users['Arabic'];}}}}}}}_0x538c3a[_0x949477(0x270)](_0x949477(0x280),{'success':_0x5532da[_0x949477(0x1c1)](_0x949477(0x1e1)),'errors':_0x5532da[_0x949477(0x1c1)](_0x949477(0x298)),'role':_0x1f30e0,'profile':_0x57de0c,'customer':_0x471e39,'warehouse':_0x36aa58,'product':_0x9819eb,'user':_0x71c5d4,'master_shop':_0x26352e,'unit':_0x4847c3,'language':_0x4a122f});}catch(_0x4f368e){console[_0x949477(0x27f)](_0x4f368e);}}),router[a0_0x8d9934(0x273)](a0_0x8d9934(0x22f),auth,async(_0xe45f53,_0x3e6ce3)=>{var _0x419ed6=a0_0x8d9934;try{const _0x2d9a7b=_0xe45f53[_0x419ed6(0x1fb)]['id'],{invoice:_0x4795c2,warehouse_name:_0x5ecaad,room:_0x309670}=_0xe45f53[_0x419ed6(0x279)],_0x4b767a=await sales_finished[_0x419ed6(0x289)]({'invoice':_0x4795c2}),_0x5b8925=_0x4b767a[_0x419ed6(0x267)][_0x419ed6(0x2a0)](async _0x26f6f4=>{var _0x170346=_0x419ed6,_0x2c17c4=await warehouse['findOne']({'name':_0x5ecaad,'room':_0x26f6f4[_0x170346(0x296)],'warehouse_category':_0x170346(0x255)});const _0x59743d=_0x2c17c4[_0x170346(0x25e)][_0x170346(0x2a0)](_0x409751=>{var _0x55b45d=_0x170346;if(_0x409751[_0x55b45d(0x206)]==_0x26f6f4[_0x55b45d(0x206)]&&_0x409751[_0x55b45d(0x24c)]==_0x26f6f4[_0x55b45d(0x24c)]&&_0x409751[_0x55b45d(0x1a7)]==_0x26f6f4[_0x55b45d(0x1a7)]&&_0x409751['production_date']==_0x26f6f4[_0x55b45d(0x1b5)]&&_0x409751[_0x55b45d(0x1f2)]==_0x26f6f4[_0x55b45d(0x1f2)]&&_0x409751[_0x55b45d(0x1db)]==_0x26f6f4[_0x55b45d(0x27e)]){if(_0x409751['product_stock']>0x0){_0x409751[_0x55b45d(0x192)]=Math[_0x55b45d(0x24d)](0x0,Math[_0x55b45d(0x1fd)](_0x409751[_0x55b45d(0x192)])-Math[_0x55b45d(0x1fd)](_0x26f6f4[_0x55b45d(0x24b)]));if(_0x409751[_0x55b45d(0x19d)]==undefined)_0x409751[_0x55b45d(0x19d)]=_0x4795c2+'~';else{var _0x3f66cc=_0x409751[_0x55b45d(0x19d)][_0x55b45d(0x275)]('~'),_0x36cefe='';for(let _0x41098=0x0;_0x41098<=_0x3f66cc[_0x55b45d(0x1ac)]-0x1;_0x41098++){const _0x1f443e=_0x3f66cc[_0x41098];_0x1f443e[_0x55b45d(0x1ac)]>0x0&&(_0x36cefe+=_0x1f443e+'~');}_0x409751['out_invoice']=_0x36cefe;}}}});return console[_0x170346(0x27f)](_0x2c17c4),_0x2c17c4;});Promise[_0x419ed6(0x238)](_0x5b8925)[_0x419ed6(0x1d8)](async _0xd410b6=>{var _0x5eb1d9=_0x419ed6;try{for(const _0x3bad90 of _0xd410b6){await _0x3bad90['save']();}_0x4b767a[_0x5eb1d9(0x239)]=_0x5eb1d9(0x287);const _0x1b0c71=await _0x4b767a['save'](),_0x39894f=await master_shop[_0x5eb1d9(0x2a2)](),_0x5e22cd=await email_settings[_0x5eb1d9(0x289)](),_0x362b39=await supervisor_settings['find']();var _0x3fcf04=_0x4b767a[_0x5eb1d9(0x267)],_0x268618='',_0x54cf65;for(_0x54cf65 in _0x3fcf04){var _0x191787='FG';_0x4b767a['warehouse_name']=='DRY\x20GOODS'&&(_0x191787='DG'),_0x268618+=_0x5eb1d9(0x1c2)+_0x5eb1d9(0x26e)+_0x3fcf04[_0x54cf65][_0x5eb1d9(0x206)]+'</td>'+_0x5eb1d9(0x26e)+_0x3fcf04[_0x54cf65]['product_code']+_0x5eb1d9(0x237)+_0x5eb1d9(0x26e)+_0x3fcf04[_0x54cf65][_0x5eb1d9(0x24b)]+_0x5eb1d9(0x237)+_0x5eb1d9(0x26e)+_0x3fcf04[_0x54cf65][_0x5eb1d9(0x216)]+_0x5eb1d9(0x237)+_0x5eb1d9(0x26e)+_0x3fcf04[_0x54cf65][_0x5eb1d9(0x21b)]+_0x5eb1d9(0x237)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b767a[_0x5eb1d9(0x1cf)]+_0x5eb1d9(0x237)+_0x5eb1d9(0x26e)+_0x3fcf04[_0x54cf65][_0x5eb1d9(0x296)]+_0x5eb1d9(0x237)+_0x5eb1d9(0x26e)+_0x191787+_0x3fcf04[_0x54cf65][_0x5eb1d9(0x24c)]+'</td>';}let _0x6a59ec=nodemailer[_0x5eb1d9(0x1c3)]({'host':_0x5e22cd[_0x5eb1d9(0x282)],'port':Number(_0x5e22cd[_0x5eb1d9(0x249)]),'secure':![],'auth':{'user':_0x5e22cd['email'],'pass':_0x5e22cd[_0x5eb1d9(0x1d6)]}}),_0x29c01a={'from':_0x5e22cd['email'],'to':_0x362b39[0x0][_0x5eb1d9(0x1e5)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x5eb1d9(0x22a),'path':__dirname+_0x5eb1d9(0x294)+_0x5eb1d9(0x26b)+_0x39894f[0x0][_0x5eb1d9(0x1ba)],'cid':_0x5eb1d9(0x25a)}],'html':_0x5eb1d9(0x21d)+_0x5eb1d9(0x1c9)+'</head><body>'+_0x5eb1d9(0x1a2)+_0x5eb1d9(0x25d)+_0x5eb1d9(0x1a2)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5eb1d9(0x1e6)+_0x5eb1d9(0x1a2)+_0x5eb1d9(0x27b)+_0x39894f[0x0]['site_title']+_0x5eb1d9(0x1cb)+_0x5eb1d9(0x1e6)+_0x5eb1d9(0x1e6)+_0x5eb1d9(0x246)+_0x5eb1d9(0x1a2)+_0x5eb1d9(0x29a)+_0x5eb1d9(0x281)+_0x4b767a['invoice']+'\x20'+_0x5eb1d9(0x191)+_0x5eb1d9(0x292)+_0x4b767a[_0x5eb1d9(0x27d)]+'\x20'+'</span>'+_0x5eb1d9(0x205)+_0x5eb1d9(0x1e6)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5eb1d9(0x1c2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5eb1d9(0x29f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x5eb1d9(0x265)+_0x5eb1d9(0x197)+_0x5eb1d9(0x1ed)+_0x5eb1d9(0x1a9)+_0x5eb1d9(0x1f9)+_0x5eb1d9(0x1cd)+'</thead>'+_0x5eb1d9(0x1f4)+'\x20'+_0x268618+'\x20'+_0x5eb1d9(0x1de)+_0x5eb1d9(0x21f)+_0x5eb1d9(0x1a2)+_0x5eb1d9(0x1df)+_0x5eb1d9(0x1ff)+_0x39894f[0x0][_0x5eb1d9(0x251)]+_0x5eb1d9(0x205)+_0x5eb1d9(0x1e6)+'</div>'+_0x5eb1d9(0x22b)};_0x6a59ec[_0x5eb1d9(0x1c6)](_0x29c01a,function(_0x300493,_0x4d4771){var _0xd95073=_0x5eb1d9;_0x300493?(console[_0xd95073(0x27f)](_0x300493),console[_0xd95073(0x27f)]('Error\x20Occurs')):console[_0xd95073(0x27f)]('Email\x20sent\x20successfully');}),_0xe45f53[_0x5eb1d9(0x1c1)](_0x5eb1d9(0x1e1),_0x5eb1d9(0x1ee)),_0x3e6ce3[_0x5eb1d9(0x1fe)](_0x5eb1d9(0x24e)+_0x2d9a7b);}catch(_0x57e428){console[_0x5eb1d9(0x29e)](_0x57e428),_0x3e6ce3[_0x5eb1d9(0x195)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x419ed6(0x1e9)](_0x29ef62=>{var _0x15ca6a=_0x419ed6;console[_0x15ca6a(0x29e)](_0x29ef62),_0x3e6ce3['status'](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x2d2509){console['log'](_0x2d2509);}}),router[a0_0x8d9934(0x1fa)](a0_0x8d9934(0x28a),auth,async(_0x519348,_0x3cd71a)=>{var _0xc57628=a0_0x8d9934;try{const {username:_0x40baae,email:_0x443b61,role:_0x3f9097}=_0x519348[_0xc57628(0x1e3)],_0x1ab720=_0x519348[_0xc57628(0x1e3)],_0x56aba5=await profile['findOne']({'email':_0x1ab720[_0xc57628(0x2a7)]}),_0x4e6248=await master_shop[_0xc57628(0x2a2)](),_0x58c7bb=_0x519348[_0xc57628(0x1fb)]['id'],_0xb4e2bd=await sales_finished[_0xc57628(0x231)](_0x58c7bb);let _0x481c1e=new Date(_0xb4e2bd[_0xc57628(0x1a7)]),_0x12f23c=('0'+_0x481c1e['getDate']())[_0xc57628(0x263)](-0x2),_0x1c34ab=('0'+(_0x481c1e['getMonth']()+0x1))[_0xc57628(0x263)](-0x2),_0x172485=_0x481c1e[_0xc57628(0x254)](),_0x1180ca=_0x172485+'-'+_0x1c34ab+'-'+_0x12f23c;var _0x20cf70=[_0xc57628(0x256),'Enclosed'];const _0x58c380=await warehouse['aggregate']([{'$match':{'name':_0xb4e2bd[_0xc57628(0x1cf)],'room':_0xb4e2bd[_0xc57628(0x210)]}},{'$unwind':_0xc57628(0x1e8)},{'$group':{'_id':_0xc57628(0x23f),'name':{'$first':_0xc57628(0x194)},'product_stock':{'$first':_0xc57628(0x229)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xc57628(0x291)},'type':{'$first':_0xc57628(0x212)},'floorlevel':{'$first':_0xc57628(0x220)},'primary_code':{'$first':_0xc57628(0x1a3)},'secondary_code':{'$first':_0xc57628(0x1e2)},'product_code':{'$first':_0xc57628(0x1b6)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xc57628(0x1e4)}}}]),_0x4d4547=await customer[_0xc57628(0x2a2)]({});let _0x4da5a3;if(_0x1ab720[_0xc57628(0x2a5)]==_0xc57628(0x1f7)){const _0x480abd=await staff[_0xc57628(0x289)]({'email':_0x1ab720[_0xc57628(0x2a7)]});_0x4da5a3=await warehouse['aggregate']([{'$match':{'status':_0xc57628(0x1f8),'name':_0x480abd['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0xc57628(0x1f0)}}}]);}else _0x4da5a3=await warehouse[_0xc57628(0x202)]([{'$match':{'status':_0xc57628(0x1f8)}},{'$group':{'_id':_0xc57628(0x1f0),'name':{'$first':_0xc57628(0x1f0)}}}]);const _0x2dc6a3=await product[_0xc57628(0x2a2)]({});if(_0x4e6248[0x0][_0xc57628(0x1c4)]=='English\x20(US)'){var _0x30bec2=users[_0xc57628(0x209)];console[_0xc57628(0x27f)](_0x30bec2);}else{if(_0x4e6248[0x0]['language']==_0xc57628(0x1d7))var _0x30bec2=users['Hindi'];else{if(_0x4e6248[0x0][_0xc57628(0x1c4)]=='German')var _0x30bec2=users['German'];else{if(_0x4e6248[0x0][_0xc57628(0x1c4)]==_0xc57628(0x204))var _0x30bec2=users[_0xc57628(0x204)];else{if(_0x4e6248[0x0][_0xc57628(0x1c4)]=='French')var _0x30bec2=users[_0xc57628(0x215)];else{if(_0x4e6248[0x0][_0xc57628(0x1c4)]==_0xc57628(0x26f))var _0x30bec2=users['Portuguese'];else{if(_0x4e6248[0x0][_0xc57628(0x1c4)]==_0xc57628(0x223))var _0x30bec2=users[_0xc57628(0x223)];else{if(_0x4e6248[0x0]['language']==_0xc57628(0x211))var _0x30bec2=users[_0xc57628(0x278)];}}}}}}}_0x3cd71a[_0xc57628(0x270)](_0xc57628(0x27c),{'success':_0x519348[_0xc57628(0x1c1)](_0xc57628(0x1e1)),'errors':_0x519348['flash']('errors'),'role':_0x1ab720,'profile':_0x56aba5,'customer':_0x4d4547,'warehouse':_0x4da5a3,'product':_0x58c380,'user':_0xb4e2bd,'master_shop':_0x4e6248,'unit':_0x2dc6a3,'language':_0x30bec2,'rooms_data':_0x20cf70,'ed_fullDate':_0x1180ca});}catch(_0x5f650){console[_0xc57628(0x27f)](_0x5f650);}}),router[a0_0x8d9934(0x273)]('/view/:id',auth,async(_0x530f59,_0x24993b)=>{var _0x233496=a0_0x8d9934;try{const _0x1913cf=_0x530f59[_0x233496(0x1fb)]['id'],_0x368b2e=await sales_finished[_0x233496(0x289)]({'_id':_0x530f59[_0x233496(0x1fb)]['id']}),_0x5ba830=await warehouse[_0x233496(0x289)]({'name':_0x368b2e[_0x233496(0x1cf)],'room':_0x530f59['body']['room'],'warehouse_category':_0x233496(0x255)}),{invoice:_0x3e24f9,customer:_0x5910c4,date:_0x19ea68,warehouse_name:_0x4676c9,product_name:_0x5428eb,stock:_0x59aa85,adjust_qty:_0x3da172,note:_0x4dfce6,room:_0x5297d0,primary_code:_0x1c1f9a,secondary_code:_0x1f805d,prod_code:_0x38580e,level:_0x2e8254,isle:_0x3d9682,pallet:_0x5b9886,expiry_date:_0x3dd45a}=_0x530f59[_0x233496(0x279)];if(typeof _0x5428eb==_0x233496(0x198))var _0x31bad3=[_0x530f59[_0x233496(0x279)][_0x233496(0x206)]],_0x40b086=[_0x530f59[_0x233496(0x279)][_0x233496(0x299)]],_0x59d840=[_0x530f59['body'][_0x233496(0x1af)]],_0x2e4b16=[_0x530f59[_0x233496(0x279)][_0x233496(0x221)]],_0x2052ab=[_0x530f59[_0x233496(0x279)][_0x233496(0x20d)]],_0x416c60=[_0x530f59[_0x233496(0x279)][_0x233496(0x1f5)]],_0x439876=[_0x530f59[_0x233496(0x279)][_0x233496(0x29d)]],_0x3c5125=[_0x530f59[_0x233496(0x279)][_0x233496(0x1a7)]];else var _0x31bad3=[..._0x530f59['body'][_0x233496(0x206)]],_0x40b086=[..._0x530f59[_0x233496(0x279)][_0x233496(0x299)]],_0x59d840=[..._0x530f59[_0x233496(0x279)][_0x233496(0x1af)]],_0x2e4b16=[..._0x530f59[_0x233496(0x279)]['primary_code']],_0x2052ab=[..._0x530f59[_0x233496(0x279)][_0x233496(0x20d)]],_0x416c60=[..._0x530f59[_0x233496(0x279)][_0x233496(0x1f5)]],_0x439876=[..._0x530f59['body'][_0x233496(0x29d)]],_0x3c5125=[..._0x530f59['body'][_0x233496(0x1a7)]];const _0x1206c8=_0x31bad3[_0x233496(0x2a0)](_0x1fb025=>{return _0x1fb025={'product_name':_0x1fb025};});_0x40b086[_0x233496(0x228)]((_0x1dae7a,_0x502a68)=>{var _0x22fb11=_0x233496;_0x1206c8[_0x502a68][_0x22fb11(0x299)]=_0x1dae7a;}),_0x59d840[_0x233496(0x228)]((_0x2a6a62,_0x572410)=>{var _0x22a196=_0x233496;_0x1206c8[_0x572410][_0x22a196(0x24b)]=_0x2a6a62;}),_0x2e4b16[_0x233496(0x228)]((_0x4b6d54,_0x30bf1f)=>{var _0x53e8b3=_0x233496;_0x1206c8[_0x30bf1f][_0x53e8b3(0x221)]=_0x4b6d54;}),_0x2052ab['forEach']((_0x3445c9,_0x1d1551)=>{var _0x20d74d=_0x233496;_0x1206c8[_0x1d1551][_0x20d74d(0x20d)]=_0x3445c9;}),_0x416c60[_0x233496(0x228)]((_0x2bfb07,_0x3cc71b)=>{var _0xcf2ab4=_0x233496;_0x1206c8[_0x3cc71b][_0xcf2ab4(0x19a)]=_0x2bfb07;}),_0x439876['forEach']((_0x4396df,_0x41f8b0)=>{_0x1206c8[_0x41f8b0]['level']=_0x4396df;}),_0x3c5125[_0x233496(0x228)]((_0x297b42,_0x3014a0)=>{var _0x1eb7a7=_0x233496;_0x1206c8[_0x3014a0][_0x1eb7a7(0x1a7)]=_0x297b42;});var _0x4f0930=0x0;_0x1206c8[_0x233496(0x228)](_0x661d17=>{var _0x46804d=_0x233496;console[_0x46804d(0x27f)](_0x46804d(0x1ea),_0x661d17),(parseInt(_0x661d17[_0x46804d(0x299)])<parseInt(_0x661d17[_0x46804d(0x24b)])||parseInt(_0x661d17['quantity'])==0x0)&&_0x4f0930++;});if(_0x4f0930!=0x0)return _0x530f59['flash'](_0x233496(0x298),_0x233496(0x19c)),_0x24993b[_0x233496(0x1fe)](_0x233496(0x20b));_0x368b2e[_0x233496(0x267)]['forEach'](_0x1bd7ad=>{const _0x332f59=_0x5ba830['product_details']['map'](_0xcd19f4=>{var _0x3a3910=a0_0x3e7f;_0xcd19f4[_0x3a3910(0x206)]==_0x1bd7ad[_0x3a3910(0x206)]&&_0xcd19f4[_0x3a3910(0x24c)]==_0x1bd7ad[_0x3a3910(0x24c)]&&(_0xcd19f4[_0x3a3910(0x192)]=parseInt(_0xcd19f4[_0x3a3910(0x192)])+parseInt(_0x1bd7ad[_0x3a3910(0x24b)]));});}),await _0x5ba830[_0x233496(0x20f)]();const _0x320440=_0x1206c8[_0x233496(0x293)](_0x46201c=>_0x46201c[_0x233496(0x24b)]!=='0'&&_0x46201c[_0x233496(0x24b)]!=='');_0x368b2e['invoice']=_0x3e24f9,_0x368b2e[_0x233496(0x28c)]=_0x5910c4,_0x368b2e[_0x233496(0x27d)]=_0x19ea68,_0x368b2e[_0x233496(0x1cf)]=_0x4676c9,_0x368b2e[_0x233496(0x267)]=_0x320440,_0x368b2e[_0x233496(0x232)]=_0x4dfce6,_0x368b2e[_0x233496(0x210)]=_0x5297d0;const _0x925209=await _0x368b2e[_0x233496(0x20f)](),_0x14b917=await sales_finished[_0x233496(0x289)]({'_id':_0x530f59['params']['id']}),_0x591d59=await warehouse[_0x233496(0x289)]({'name':_0x4676c9,'room':_0x5297d0,'warehouse_category':_0x233496(0x255)});_0x14b917[_0x233496(0x267)][_0x233496(0x228)](_0x22f5cf=>{var _0x132558=_0x233496;const _0x18a7ba=_0x591d59[_0x132558(0x25e)][_0x132558(0x2a0)](_0x3cebdb=>{var _0x212b01=_0x132558;_0x3cebdb['product_name']==_0x22f5cf[_0x212b01(0x206)]&&_0x3cebdb['bay']==_0x22f5cf[_0x212b01(0x24c)]&&(_0x3cebdb[_0x212b01(0x192)]=parseInt(_0x3cebdb[_0x212b01(0x192)])-parseInt(_0x22f5cf['quantity']));});}),console[_0x233496(0x27f)]('final',_0x591d59),await _0x591d59['save']();const _0x2ab96f=await c_payment_data[_0x233496(0x289)]({'invoice':_0x530f59[_0x233496(0x279)][_0x233496(0x258)]});_0x2ab96f[_0x233496(0x26c)]=_0x530f59[_0x233496(0x279)][_0x233496(0x26c)],await _0x2ab96f[_0x233496(0x20f)](),_0x530f59[_0x233496(0x1c1)](_0x233496(0x1e1),_0x233496(0x1ee)),_0x24993b[_0x233496(0x1fe)](_0x233496(0x257));}catch(_0x371deb){console[_0x233496(0x27f)](_0x371deb);}}),router[a0_0x8d9934(0x273)](a0_0x8d9934(0x24f),auth,async(_0x26f0bf,_0x33985a)=>{var _0x1a443d=a0_0x8d9934;try{const _0x57eb86=_0x26f0bf[_0x1a443d(0x1fb)]['id'],{invoice:_0x545c33,customer:_0x133d15,receivable_amount:_0x3e3478,received_amount:_0x21cfa5}=_0x26f0bf['body'],_0x367aeb=await sales['findById'](_0x57eb86);console['log'](_0x367aeb);var _0x23bbd3=_0x3e3478-_0x21cfa5;console[_0x1a443d(0x27f)](_0x21cfa5),_0x367aeb[_0x1a443d(0x25c)]=parseFloat(_0x21cfa5)+parseFloat(_0x367aeb[_0x1a443d(0x25c)]),_0x367aeb[_0x1a443d(0x1dc)]=_0x23bbd3,console[_0x1a443d(0x27f)](_0x367aeb);const _0x127527=await _0x367aeb['save'](),_0x35e1f0=await c_payment_data[_0x1a443d(0x289)]({'invoice':_0x545c33});_0x35e1f0[_0x1a443d(0x1d3)]=_0x23bbd3,await _0x35e1f0[_0x1a443d(0x20f)]();let _0x5ac4bf=new Date(),_0x1f3b24=('0'+_0x5ac4bf[_0x1a443d(0x261)]())[_0x1a443d(0x263)](-0x2),_0x276ada=('0'+(_0x5ac4bf[_0x1a443d(0x193)]()+0x1))[_0x1a443d(0x263)](-0x2),_0x2509fd=_0x5ac4bf[_0x1a443d(0x254)](),_0x2e07d1=_0x2509fd+'-'+_0x276ada+'-'+_0x1f3b24;const _0x182ac1=new customer_payment({'invoice':_0x545c33,'date':_0x2509fd+'-'+_0x276ada+'-'+_0x1f3b24,'customer':_0x133d15,'reason':_0x1a443d(0x284),'amount':_0x21cfa5}),_0x571f6d=await _0x182ac1[_0x1a443d(0x20f)]();_0x26f0bf[_0x1a443d(0x1c1)]('success','payment\x20successfull'),_0x33985a[_0x1a443d(0x1fe)](_0x1a443d(0x226));}catch(_0x4dcd20){console[_0x1a443d(0x27f)](_0x4dcd20);}}),router[a0_0x8d9934(0x1fa)](a0_0x8d9934(0x2a1),auth,async(_0x4e1807,_0x4b0ca6)=>{var _0x4efcc7=a0_0x8d9934;try{const {username:_0x3edb4a,email:_0x1f0d75,role:_0x347457}=_0x4e1807[_0x4efcc7(0x1e3)],_0x219b12=_0x4e1807[_0x4efcc7(0x1e3)],_0x20e426=await profile[_0x4efcc7(0x289)]({'email':_0x219b12[_0x4efcc7(0x2a7)]}),_0x3f5342=await master_shop[_0x4efcc7(0x2a2)]();console[_0x4efcc7(0x27f)](_0x4efcc7(0x1c8),_0x3f5342);const _0x4803bc=_0x4e1807[_0x4efcc7(0x1fb)]['id'],_0x1de1f2=await sales[_0x4efcc7(0x231)](_0x4803bc);console[_0x4efcc7(0x27f)](_0x1de1f2);const _0x2a7a70=await customer[_0x4efcc7(0x289)]({'name':_0x1de1f2['customer']});console[_0x4efcc7(0x27f)](_0x2a7a70);if(_0x3f5342[0x0][_0x4efcc7(0x1c4)]==_0x4efcc7(0x1b2)){var _0x1dea92=users['English'];console[_0x4efcc7(0x27f)](_0x1dea92);}else{if(_0x3f5342[0x0][_0x4efcc7(0x1c4)]==_0x4efcc7(0x1d7))var _0x1dea92=users[_0x4efcc7(0x1d7)];else{if(_0x3f5342[0x0]['language']==_0x4efcc7(0x236))var _0x1dea92=users['German'];else{if(_0x3f5342[0x0][_0x4efcc7(0x1c4)]==_0x4efcc7(0x204))var _0x1dea92=users[_0x4efcc7(0x204)];else{if(_0x3f5342[0x0][_0x4efcc7(0x1c4)]==_0x4efcc7(0x215))var _0x1dea92=users[_0x4efcc7(0x215)];else{if(_0x3f5342[0x0][_0x4efcc7(0x1c4)]=='Portuguese\x20(BR)')var _0x1dea92=users[_0x4efcc7(0x19f)];else{if(_0x3f5342[0x0]['language']=='Chinese')var _0x1dea92=users['Chinese'];else{if(_0x3f5342[0x0][_0x4efcc7(0x1c4)]==_0x4efcc7(0x211))var _0x1dea92=users[_0x4efcc7(0x278)];}}}}}}}_0x4b0ca6[_0x4efcc7(0x270)](_0x4efcc7(0x295),{'success':_0x4e1807[_0x4efcc7(0x1c1)]('success'),'errors':_0x4e1807[_0x4efcc7(0x1c1)](_0x4efcc7(0x298)),'role':_0x219b12,'profile':_0x20e426,'master_shop':_0x3f5342,'customers':_0x2a7a70,'sales':_0x1de1f2,'language':_0x1dea92});}catch(_0x52f0a5){console[_0x4efcc7(0x27f)](_0x52f0a5);}}),router[a0_0x8d9934(0x1fa)](a0_0x8d9934(0x272),auth,async(_0x2b7558,_0x1c83cd)=>{var _0x480d12=a0_0x8d9934;try{const {username:_0x321de2,email:_0x51d213,role:_0x562ffa}=_0x2b7558[_0x480d12(0x1e3)],_0x2b8b3a=_0x2b7558['user'],_0x55395a=await profile[_0x480d12(0x289)]({'email':_0x2b8b3a[_0x480d12(0x2a7)]}),_0x256d49=await master_shop[_0x480d12(0x2a2)](),_0x10786d=_0x2b7558[_0x480d12(0x1fb)]['id'],_0x58a9d4=await sales_finished['findById'](_0x10786d),_0x339ec1=await warehouse[_0x480d12(0x202)]([{'$match':{'name':_0x58a9d4['warehouse_name']}},{'$unwind':_0x480d12(0x1e8)},{'$group':{'_id':_0x480d12(0x23f),'name':{'$first':_0x480d12(0x194)},'product_stock':{'$first':_0x480d12(0x229)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x480d12(0x291)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x480d12(0x220)},'primary_code':{'$first':_0x480d12(0x1a3)},'secondary_code':{'$first':_0x480d12(0x1e2)},'product_code':{'$first':_0x480d12(0x1b6)},'storage':{'$first':_0x480d12(0x207)},'rack':{'$first':_0x480d12(0x1e4)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x480d12(0x241)},'maxProducts':{'$first':_0x480d12(0x196)},'batch_code':{'$first':_0x480d12(0x230)},'maxPerUnit':{'$first':_0x480d12(0x1ae)}}}]),_0x52f315=await product[_0x480d12(0x2a2)]({}),_0x1663ca=await warehouse[_0x480d12(0x202)]([{'$match':{'status':'Enabled','warehouse_category':_0x480d12(0x255),'name':{'$ne':_0x480d12(0x285),'$ne':_0x480d12(0x1a8)}}},{'$group':{'_id':'$name','name':{'$first':_0x480d12(0x1f0)}}},{'$sort':{'name':0x1}}]);var _0x31b59a=[_0x480d12(0x260)];const _0x15c5e5=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x480d12(0x1a8)}},{'$group':{'_id':'$name','name':{'$first':_0x480d12(0x1f0)}}},{'$sort':{'name':0x1}}]);if(_0x256d49[0x0][_0x480d12(0x1c4)]=='English\x20(US)'){var _0x3e4ac0=users['English'];console[_0x480d12(0x27f)](_0x3e4ac0);}else{if(_0x256d49[0x0]['language']==_0x480d12(0x1d7))var _0x3e4ac0=users[_0x480d12(0x1d7)];else{if(_0x256d49[0x0]['language']==_0x480d12(0x236))var _0x3e4ac0=users['German'];else{if(_0x256d49[0x0][_0x480d12(0x1c4)]==_0x480d12(0x204))var _0x3e4ac0=users['Spanish'];else{if(_0x256d49[0x0][_0x480d12(0x1c4)]=='French')var _0x3e4ac0=users[_0x480d12(0x215)];else{if(_0x256d49[0x0]['language']=='Portuguese\x20(BR)')var _0x3e4ac0=users[_0x480d12(0x19f)];else{if(_0x256d49[0x0][_0x480d12(0x1c4)]=='Chinese')var _0x3e4ac0=users[_0x480d12(0x223)];else{if(_0x256d49[0x0][_0x480d12(0x1c4)]=='Arabic\x20(ae)')var _0x3e4ac0=users[_0x480d12(0x278)];}}}}}}}_0x1c83cd[_0x480d12(0x270)]('return_sale_finished',{'success':_0x2b7558['flash'](_0x480d12(0x1e1)),'errors':_0x2b7558[_0x480d12(0x1c1)]('errors'),'role':_0x2b8b3a,'profile':_0x55395a,'user':_0x58a9d4,'stock':_0x339ec1,'master_shop':_0x256d49,'unit':_0x52f315,'language':_0x3e4ac0,'warehouses':_0x1663ca,'rooms':_0x31b59a,'warehouse_QA':_0x15c5e5});}catch(_0x1bc746){console[_0x480d12(0x27f)](_0x1bc746),_0x1c83cd['status'](0xc8)[_0x480d12(0x1e0)]({'message':_0x1bc746[_0x480d12(0x1c5)]});}}),router['post'](a0_0x8d9934(0x272),auth,async(_0x1d63d4,_0x1d317b)=>{var _0x53ddd5=a0_0x8d9934;if(_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x253)]=='QA')try{const {invoice:_0x8841f2,date:_0x7a09a3,warehouse_name:_0x44530a,product_name:_0x199e79,primary_code:_0x19a959,secondary_code:_0x59449f,product_code:_0x54ba82,sales_quantity:_0x324974,stocks:_0x1355ca,return_qty:_0x3446cc,Room_name:_0x15ea95,to_warehouse_name_QA:_0x584519,to_Room_name_QA:_0x475c22,note:_0x59f5f2,for_categorize:_0x2c2d53,product_name_QA1:_0x4e1f47}=_0x1d63d4[_0x53ddd5(0x279)];if(typeof _0x4e1f47=='string')var _0x8dffe2=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x277)]],_0x53b456=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x250)]],_0x57e08f=[_0x1d63d4[_0x53ddd5(0x279)]['secondary_code_QA']],_0xa95fb8=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x1d0)]],_0x1f5643=[_0x1d63d4['body'][_0x53ddd5(0x23d)]],_0x4e1ccf=[_0x1d63d4['body']['stocks_QA']],_0x29248b=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x1f1)]],_0x1d8588=[_0x1d63d4[_0x53ddd5(0x279)]['maxPerUnit_QA']],_0xdffdcf=[_0x1d63d4[_0x53ddd5(0x279)]['maxProducts_QA']],_0xa987bc=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x1ef)]],_0xfa9355=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x214)]],_0x3d60b3=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x1be)]],_0x5201e1=[_0x1d63d4['body']['production_date_QA']],_0x28a44d=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x20c)]];else var _0x8dffe2=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x277)]],_0x53b456=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x250)]],_0x57e08f=[..._0x1d63d4[_0x53ddd5(0x279)]['secondary_code_QA']],_0xa95fb8=[..._0x1d63d4[_0x53ddd5(0x279)]['product_code_QA']],_0x1f5643=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x23d)]],_0x4e1ccf=[..._0x1d63d4['body'][_0x53ddd5(0x2a8)]],_0x29248b=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x1f1)]],_0x1d8588=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x242)]],_0xdffdcf=[..._0x1d63d4[_0x53ddd5(0x279)]['maxProducts_QA']],_0xa987bc=[..._0x1d63d4['body']['batch_code_QA']],_0xfa9355=[..._0x1d63d4[_0x53ddd5(0x279)]['secondary_unit_QA']],_0x3d60b3=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x1be)]],_0x5201e1=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x26d)]],_0x28a44d=[..._0x1d63d4[_0x53ddd5(0x279)]['expiry_date_QA']];const _0x4673f6=_0x8dffe2['map'](_0x1e4cbb=>{return _0x1e4cbb={'product_name':_0x1e4cbb};});_0x53b456['forEach']((_0x337d0b,_0xc485b2)=>{var _0x5b1982=_0x53ddd5;_0x4673f6[_0xc485b2][_0x5b1982(0x221)]=_0x337d0b;}),_0x57e08f[_0x53ddd5(0x228)]((_0x4fed24,_0x17b438)=>{_0x4673f6[_0x17b438]['secondary_code']=_0x4fed24;}),_0xa95fb8[_0x53ddd5(0x228)]((_0x2fc36b,_0x397ba5)=>{_0x4673f6[_0x397ba5]['product_code']=_0x2fc36b;}),_0x1f5643[_0x53ddd5(0x228)]((_0x4b813b,_0x448001)=>{var _0x2b1b29=_0x53ddd5;_0x4673f6[_0x448001][_0x2b1b29(0x2a3)]=_0x4b813b;}),_0x4e1ccf[_0x53ddd5(0x228)]((_0x49a44d,_0x5b58f2)=>{var _0xbf3cfd=_0x53ddd5;_0x4673f6[_0x5b58f2][_0xbf3cfd(0x299)]=_0x49a44d;}),_0x29248b[_0x53ddd5(0x228)]((_0x466906,_0x878da4)=>{_0x4673f6[_0x878da4]['return_qty']=_0x466906;}),_0x1d8588[_0x53ddd5(0x228)]((_0x222f59,_0x48d775)=>{var _0x1bf85a=_0x53ddd5;_0x4673f6[_0x48d775][_0x1bf85a(0x23c)]=_0x222f59;}),_0xdffdcf[_0x53ddd5(0x228)]((_0x3c1af4,_0x4dc3a5)=>{var _0x5d514f=_0x53ddd5;_0x4673f6[_0x4dc3a5][_0x5d514f(0x2a4)]=_0x3c1af4;}),_0xa987bc[_0x53ddd5(0x228)]((_0xec827b,_0x84903c)=>{var _0x42bcbb=_0x53ddd5;_0x4673f6[_0x84903c][_0x42bcbb(0x1f2)]=_0xec827b;}),_0xfa9355['forEach']((_0x5142ed,_0x809ea0)=>{var _0x51c67f=_0x53ddd5;_0x4673f6[_0x809ea0][_0x51c67f(0x21b)]=_0x5142ed;}),_0x3d60b3[_0x53ddd5(0x228)]((_0x396ae5,_0x2513f3)=>{var _0x4f2250=_0x53ddd5;_0x4673f6[_0x2513f3][_0x4f2250(0x216)]=_0x396ae5;}),_0x5201e1[_0x53ddd5(0x228)]((_0x38f7f7,_0x41a1e7)=>{var _0x5600d4=_0x53ddd5;_0x4673f6[_0x41a1e7][_0x5600d4(0x1b5)]=_0x38f7f7;}),_0x28a44d[_0x53ddd5(0x228)]((_0x2d1ced,_0x14c2d6)=>{var _0x3439a1=_0x53ddd5;_0x4673f6[_0x14c2d6][_0x3439a1(0x1a7)]=_0x2d1ced;});const _0x29e842=await sales_finished[_0x53ddd5(0x289)]({'invoice':_0x8841f2});_0x29e842[_0x53ddd5(0x29c)]=_0x53ddd5(0x287);const _0x419551=await _0x29e842[_0x53ddd5(0x20f)](),_0x2a6076=new sales_return_finished({'invoice':_0x8841f2,'customer':_0x1d63d4['body']['customer'],'date':_0x7a09a3,'warehouse_name':_0x44530a,'room':_0x15ea95,'ToWarehouse':_0x584519,'ToRoom':_0x475c22,'return_sale_QA':_0x4673f6,'note':_0x59f5f2,'warehouse_cat':_0x2c2d53}),_0x47ac9c=await _0x2a6076['save'](),_0x1c35f7=await sales_return_finished[_0x53ddd5(0x289)]({'invoice':_0x8841f2}),_0x4f9b61=await warehouse['findOne']({'name':_0x584519,'room':_0x475c22});_0x1c35f7[_0x53ddd5(0x1b8)][_0x53ddd5(0x228)](_0x5e5b20=>{var _0x45a037=_0x53ddd5,_0x366a1a=0x0;const _0x4d64ed=_0x4f9b61['product_details'][_0x45a037(0x2a0)](_0x28b095=>{var _0x3408ef=_0x45a037;_0x28b095[_0x3408ef(0x206)]==_0x5e5b20['product_name']&&_0x28b095[_0x3408ef(0x1a7)]==_0x5e5b20[_0x3408ef(0x1a7)]&&_0x28b095[_0x3408ef(0x1b5)]==_0x5e5b20[_0x3408ef(0x1b5)]&&_0x28b095[_0x3408ef(0x1f2)]==_0x5e5b20[_0x3408ef(0x1f2)]&&(_0x28b095['product_stock']=parseInt(_0x28b095[_0x3408ef(0x192)])+parseInt(_0x5e5b20['return_qty']),_0x366a1a++);});_0x366a1a=='0'&&(_0x4f9b61[_0x45a037(0x25e)]=_0x4f9b61[_0x45a037(0x25e)][_0x45a037(0x1ce)]({'product_name':_0x5e5b20[_0x45a037(0x206)],'product_stock':_0x5e5b20[_0x45a037(0x227)],'primary_code':_0x5e5b20[_0x45a037(0x221)],'secondary_code':_0x5e5b20['secondary_code'],'product_code':_0x5e5b20['product_code'],'batch_code':_0x5e5b20[_0x45a037(0x1f2)],'maxPerUnit':_0x5e5b20[_0x45a037(0x23c)],'production_date':_0x5e5b20[_0x45a037(0x1b5)],'expiry_date':_0x5e5b20[_0x45a037(0x1a7)],'secondary_unit':_0x5e5b20['secondary_unit'],'unit':_0x5e5b20['unit'],'maxProducts':_0x5e5b20['maxProducts'],'bay':_0x5e5b20[_0x45a037(0x24c)]}));}),await _0x4f9b61['save']();const _0x590313=new c_payment_data({'invoice':_0x8841f2,'customer':_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x28c)],'reason':_0x53ddd5(0x1aa)});await _0x590313['save']();const _0x43296f=await master_shop[_0x53ddd5(0x2a2)](),_0x349066=await email_settings[_0x53ddd5(0x289)](),_0x15256b=await customer['findOne']({'name':_0x1d63d4['body']['customer']});_0x43296f[0x0][_0x53ddd5(0x1a6)]==0x1?(right_currency=_0x43296f[0x0][_0x53ddd5(0x1fc)],left_currency=''):(right_currency='',left_currency=_0x43296f[0x0][_0x53ddd5(0x1fc)]);var _0x29ad26=_0x8dffe2,_0x449c63=_0x29248b,_0x2a468b='',_0x3cd876;for(_0x3cd876 in _0x29ad26){_0x2a468b+=_0x53ddd5(0x1c2)+_0x53ddd5(0x26e)+_0x29ad26[_0x3cd876]+_0x53ddd5(0x237)+_0x53ddd5(0x26e)+_0x449c63[_0x3cd876]+_0x53ddd5(0x237)+_0x53ddd5(0x1cd);}console[_0x53ddd5(0x27f)](_0x53ddd5(0x1ad),_0x2a468b);let _0x4a1c15=nodemailer['createTransport']({'service':_0x53ddd5(0x1b4),'auth':{'user':_0x349066[_0x53ddd5(0x2a7)],'pass':_0x349066[_0x53ddd5(0x1d6)]}}),_0x4fa6a4={'from':_0x349066[_0x53ddd5(0x2a7)],'to':_0x15256b[_0x53ddd5(0x2a7)],'subject':_0x53ddd5(0x1a5),'attachments':[{'filename':_0x53ddd5(0x22a),'path':__dirname+_0x53ddd5(0x294)+_0x53ddd5(0x26b)+_0x43296f[0x0][_0x53ddd5(0x1ba)],'cid':_0x53ddd5(0x25a)}],'html':_0x53ddd5(0x21d)+_0x53ddd5(0x1c9)+_0x53ddd5(0x1bd)+_0x53ddd5(0x1a2)+_0x53ddd5(0x25d)+'<div>'+_0x53ddd5(0x1cc)+_0x53ddd5(0x1e6)+'<div>'+_0x53ddd5(0x27b)+_0x43296f[0x0][_0x53ddd5(0x251)]+_0x53ddd5(0x1cb)+_0x53ddd5(0x1e6)+_0x53ddd5(0x1e6)+_0x53ddd5(0x246)+_0x53ddd5(0x1a2)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x53ddd5(0x281)+_0x8841f2+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x53ddd5(0x292)+_0x7a09a3+'\x20'+_0x53ddd5(0x286)+_0x53ddd5(0x205)+'</div>'+_0x53ddd5(0x1d4)+_0x53ddd5(0x1d1)+_0x53ddd5(0x1c2)+_0x53ddd5(0x28d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x53ddd5(0x224)+_0x53ddd5(0x1cd)+'</thead>'+_0x53ddd5(0x1f4)+'\x20'+_0x2a468b+'\x20'+'</tbody>'+'</table>'+_0x53ddd5(0x1a2)+_0x53ddd5(0x1df)+_0x53ddd5(0x1ff)+_0x43296f[0x0]['site_title']+_0x53ddd5(0x205)+'</div>'+_0x53ddd5(0x1e6)+'</body></html>'};_0x4a1c15[_0x53ddd5(0x1c6)](_0x4fa6a4,function(_0x295af7,_0x28956e){var _0x4cd801=_0x53ddd5;_0x295af7?(console[_0x4cd801(0x27f)](_0x295af7),console[_0x4cd801(0x27f)]('Error\x20Occurs')):console[_0x4cd801(0x27f)](_0x4cd801(0x1ec));}),_0x1d63d4['flash'](_0x53ddd5(0x1e1),_0x53ddd5(0x234)),_0x1d317b[_0x53ddd5(0x1fe)]('/all_sales_finished/view');}catch(_0x57c5d8){_0x1d317b[_0x53ddd5(0x195)](0xc8)[_0x53ddd5(0x1e0)]({'message1':_0x57c5d8[_0x53ddd5(0x1c5)]});}else{if(_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x253)]=='GS')try{const {invoice:_0x28a645,date:_0x5f2966,warehouse_name:_0x59f4aa,product_name:_0x45a7aa,primary_code:_0x247853,secondary_code:_0x4137dc,product_code:_0x139e95,sales_quantity:_0x55bcd0,stocks:_0x317450,return_qty:_0x526582,Room_name:_0xe45b21,to_warehouse_name:_0x3e4ea7,to_Room_name:_0x3c4c75,note:_0x1120a7,level:_0x2a3584,isle:_0x97adf6,pallet:_0x515316,for_categorize:_0x9e47b1}=_0x1d63d4[_0x53ddd5(0x279)];if(typeof _0x45a7aa==_0x53ddd5(0x198))var _0x8dffe2=[_0x1d63d4['body']['product_name']],_0x53b456=[_0x1d63d4[_0x53ddd5(0x279)]['primary_code']],_0x57e08f=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x20d)]],_0xa95fb8=[_0x1d63d4[_0x53ddd5(0x279)]['product_code']],_0x1f5643=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x271)]],_0x29248b=[_0x1d63d4['body']['return_qty']],_0x4fa5bc=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x24c)]],_0x1d8588=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x23c)]],_0xdffdcf=[_0x1d63d4[_0x53ddd5(0x279)]['maxProducts']],_0xa987bc=[_0x1d63d4[_0x53ddd5(0x279)]['batch_code']],_0xfa9355=[_0x1d63d4['body'][_0x53ddd5(0x21b)]],_0x3d60b3=[_0x1d63d4['body'][_0x53ddd5(0x216)]],_0x5201e1=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x1b5)]],_0x28a44d=[_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x1a7)]];else var _0x8dffe2=[..._0x1d63d4['body'][_0x53ddd5(0x206)]],_0x53b456=[..._0x1d63d4[_0x53ddd5(0x279)]['primary_code']],_0x57e08f=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x20d)]],_0xa95fb8=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x19a)]],_0x1f5643=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x271)]],_0x29248b=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x227)]],_0x4fa5bc=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x24c)]],_0x1d8588=[..._0x1d63d4['body'][_0x53ddd5(0x23c)]],_0xdffdcf=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x2a4)]],_0xa987bc=[..._0x1d63d4['body'][_0x53ddd5(0x1f2)]],_0xfa9355=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x21b)]],_0x3d60b3=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x216)]],_0x5201e1=[..._0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x1b5)]],_0x28a44d=[..._0x1d63d4[_0x53ddd5(0x279)]['expiry_date']];const _0x16a2a0=_0x8dffe2[_0x53ddd5(0x2a0)](_0x327837=>{return _0x327837={'product_name':_0x327837};});_0x53b456['forEach']((_0x4bf96a,_0x481c1b)=>{var _0x2d7f9f=_0x53ddd5;_0x16a2a0[_0x481c1b][_0x2d7f9f(0x221)]=_0x4bf96a;}),_0x57e08f[_0x53ddd5(0x228)]((_0x216c43,_0x4c7c07)=>{var _0x21ec4b=_0x53ddd5;_0x16a2a0[_0x4c7c07][_0x21ec4b(0x20d)]=_0x216c43;}),_0xa95fb8['forEach']((_0x2e4c80,_0x52e83c)=>{var _0xf74ac1=_0x53ddd5;_0x16a2a0[_0x52e83c][_0xf74ac1(0x19a)]=_0x2e4c80;}),_0x1f5643[_0x53ddd5(0x228)]((_0x4bdbec,_0x4614e7)=>{var _0x3ac568=_0x53ddd5;_0x16a2a0[_0x4614e7][_0x3ac568(0x2a3)]=_0x4bdbec;}),_0x29248b[_0x53ddd5(0x228)]((_0x641342,_0x1d44aa)=>{_0x16a2a0[_0x1d44aa]['return_qty']=_0x641342;}),_0x4fa5bc[_0x53ddd5(0x228)]((_0x1e62fa,_0x29928f)=>{var _0x4cc08d=_0x53ddd5;_0x16a2a0[_0x29928f][_0x4cc08d(0x24c)]=_0x1e62fa;}),_0x1d8588['forEach']((_0x1e5f2b,_0x3dc18c)=>{var _0x2aff5d=_0x53ddd5;_0x16a2a0[_0x3dc18c][_0x2aff5d(0x23c)]=_0x1e5f2b;}),_0xdffdcf[_0x53ddd5(0x228)]((_0x1bfc74,_0x4f2937)=>{var _0x5e475a=_0x53ddd5;_0x16a2a0[_0x4f2937][_0x5e475a(0x2a4)]=_0x1bfc74;}),_0xa987bc[_0x53ddd5(0x228)]((_0x250338,_0x38aa66)=>{var _0x2573cf=_0x53ddd5;_0x16a2a0[_0x38aa66][_0x2573cf(0x1f2)]=_0x250338;}),_0xfa9355[_0x53ddd5(0x228)]((_0x4dac7c,_0x546fb8)=>{var _0x35c9f7=_0x53ddd5;_0x16a2a0[_0x546fb8][_0x35c9f7(0x21b)]=_0x4dac7c;}),_0x3d60b3[_0x53ddd5(0x228)]((_0x554d18,_0x37d976)=>{_0x16a2a0[_0x37d976]['unit']=_0x554d18;}),_0x5201e1[_0x53ddd5(0x228)]((_0x115aac,_0x393740)=>{var _0x32c20e=_0x53ddd5;_0x16a2a0[_0x393740][_0x32c20e(0x1b5)]=_0x115aac;}),_0x28a44d[_0x53ddd5(0x228)]((_0x2f8583,_0x28cbe9)=>{var _0x2eae9a=_0x53ddd5;_0x16a2a0[_0x28cbe9][_0x2eae9a(0x1a7)]=_0x2f8583;});var _0x106d5f=0x0;_0x16a2a0[_0x53ddd5(0x228)](_0x2afde3=>{var _0x2df751=_0x53ddd5;(parseInt(_0x2afde3['sale_qty'])<parseInt(_0x2afde3[_0x2df751(0x227)])||parseInt(_0x2afde3[_0x2df751(0x299)])<parseInt(_0x2afde3['return_qty'])&&parseInt(_0x2afde3[_0x2df751(0x2a3)])>parseInt(_0x2afde3[_0x2df751(0x227)])||parseInt(_0x2afde3['return_qty'])==0x0)&&_0x106d5f++;});if(_0x106d5f!=0x0)return _0x1d63d4[_0x53ddd5(0x1c1)]('errors',_0x53ddd5(0x240)),_0x1d317b[_0x53ddd5(0x1fe)](_0x53ddd5(0x20b));const _0x47d2c4=await sales_finished['findOne']({'invoice':_0x28a645});_0x47d2c4['return_data']='True';const _0x1a71b8=await _0x47d2c4[_0x53ddd5(0x20f)](),_0x4a41a7=new sales_return_finished({'invoice':_0x28a645,'customer':_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x28c)],'date':_0x5f2966,'warehouse_name':_0x59f4aa,'room':_0xe45b21,'ToWarehouse':_0x3e4ea7,'ToRoom':_0x3c4c75,'return_sale':_0x16a2a0,'note':_0x1120a7,'warehouse_cat':_0x9e47b1}),_0x1c0340=await _0x4a41a7['save'](),_0x58754b=await sales_return_finished[_0x53ddd5(0x289)]({'invoice':_0x28a645}),_0x47de68=await warehouse[_0x53ddd5(0x289)]({'name':_0x3e4ea7,'room':_0x3c4c75,'warehouse_category':_0x53ddd5(0x255)});_0x58754b[_0x53ddd5(0x1b1)][_0x53ddd5(0x228)](_0x40eb86=>{var _0x314082=_0x53ddd5,_0x79249a=0x0;const _0x43e55a=_0x47de68[_0x314082(0x25e)][_0x314082(0x2a0)](_0x24b65e=>{var _0x540d7a=_0x314082;_0x24b65e[_0x540d7a(0x206)]==_0x40eb86[_0x540d7a(0x206)]&&_0x24b65e[_0x540d7a(0x24c)]==_0x40eb86[_0x540d7a(0x24c)]&&_0x24b65e['expiry_date']==_0x40eb86[_0x540d7a(0x1a7)]&&_0x24b65e[_0x540d7a(0x1b5)]==_0x40eb86['production_date']&&_0x24b65e['batch_code']==_0x40eb86[_0x540d7a(0x1f2)]&&(_0x24b65e[_0x540d7a(0x192)]=parseInt(_0x24b65e['product_stock'])+parseInt(_0x40eb86[_0x540d7a(0x227)]),_0x79249a++);});_0x79249a=='0'&&(_0x47de68[_0x314082(0x25e)]=_0x47de68['product_details']['concat']({'product_name':_0x40eb86[_0x314082(0x206)],'product_stock':_0x40eb86['return_qty'],'primary_code':_0x40eb86['primary_code'],'secondary_code':_0x40eb86[_0x314082(0x20d)],'product_code':_0x40eb86[_0x314082(0x19a)],'bay':_0x40eb86[_0x314082(0x24c)],'batch_code':_0x40eb86[_0x314082(0x1f2)],'maxPerUnit':_0x40eb86[_0x314082(0x23c)],'production_date':_0x40eb86[_0x314082(0x1b5)],'expiry_date':_0x40eb86['expiry_date'],'secondary_unit':_0x40eb86[_0x314082(0x21b)],'unit':_0x40eb86[_0x314082(0x216)],'maxProducts':_0x40eb86[_0x314082(0x2a4)]}));}),await _0x47de68[_0x53ddd5(0x20f)](),console[_0x53ddd5(0x27f)](_0x1d63d4['body']);const _0x1e7df5=new c_payment_data({'invoice':_0x28a645,'customer':_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x28c)],'reason':_0x53ddd5(0x1aa)});await _0x1e7df5[_0x53ddd5(0x20f)]();const _0xe78b3b=await master_shop['find']();console[_0x53ddd5(0x27f)](_0x53ddd5(0x27a),_0xe78b3b[0x0]['image']);const _0x4f9a2e=await email_settings['findOne'](),_0x50301c=await customer['findOne']({'name':_0x1d63d4[_0x53ddd5(0x279)][_0x53ddd5(0x28c)]});console['log'](_0x53ddd5(0x248),_0x50301c);_0xe78b3b[0x0]['currency_placement']==0x1?(right_currency=_0xe78b3b[0x0][_0x53ddd5(0x1fc)],left_currency=''):(right_currency='',left_currency=_0xe78b3b[0x0][_0x53ddd5(0x1fc)]);var _0x29ad26=_0x8dffe2,_0x449c63=_0x29248b,_0x2a468b='',_0x3cd876;for(_0x3cd876 in _0x29ad26){_0x2a468b+=_0x53ddd5(0x1c2)+_0x53ddd5(0x26e)+_0x29ad26[_0x3cd876]+'</td>'+_0x53ddd5(0x26e)+_0x449c63[_0x3cd876]+_0x53ddd5(0x237)+_0x53ddd5(0x1cd);}console[_0x53ddd5(0x27f)](_0x53ddd5(0x1ad),_0x2a468b);let _0x2e1e45=nodemailer[_0x53ddd5(0x1c3)]({'service':_0x53ddd5(0x1b4),'auth':{'user':_0x4f9a2e['email'],'pass':_0x4f9a2e['password']}}),_0x3f37ac={'from':_0x4f9a2e['email'],'to':_0x50301c['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x53ddd5(0x294)+_0x53ddd5(0x26b)+_0xe78b3b[0x0][_0x53ddd5(0x1ba)],'cid':_0x53ddd5(0x25a)}],'html':'<!DOCTYPE\x20html>'+_0x53ddd5(0x1c9)+_0x53ddd5(0x1bd)+_0x53ddd5(0x1a2)+_0x53ddd5(0x25d)+_0x53ddd5(0x1a2)+_0x53ddd5(0x1cc)+_0x53ddd5(0x1e6)+'<div>'+'<h2>\x20'+_0xe78b3b[0x0][_0x53ddd5(0x251)]+_0x53ddd5(0x1cb)+_0x53ddd5(0x1e6)+'</div>'+_0x53ddd5(0x246)+_0x53ddd5(0x1a2)+_0x53ddd5(0x29a)+_0x53ddd5(0x281)+_0x28a645+'\x20'+_0x53ddd5(0x191)+_0x53ddd5(0x292)+_0x5f2966+'\x20'+_0x53ddd5(0x286)+_0x53ddd5(0x205)+_0x53ddd5(0x1e6)+_0x53ddd5(0x1d4)+_0x53ddd5(0x1d1)+'<tr>'+_0x53ddd5(0x28d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x53ddd5(0x224)+_0x53ddd5(0x1cd)+_0x53ddd5(0x1a4)+_0x53ddd5(0x1f4)+'\x20'+_0x2a468b+'\x20'+_0x53ddd5(0x1de)+_0x53ddd5(0x21f)+_0x53ddd5(0x1a2)+_0x53ddd5(0x1df)+_0x53ddd5(0x1ff)+_0xe78b3b[0x0][_0x53ddd5(0x251)]+_0x53ddd5(0x205)+_0x53ddd5(0x1e6)+_0x53ddd5(0x1e6)+_0x53ddd5(0x22b)};_0x2e1e45[_0x53ddd5(0x1c6)](_0x3f37ac,function(_0x3f65df,_0x58ea32){var _0x4488a1=_0x53ddd5;_0x3f65df?(console['log'](_0x3f65df),console[_0x4488a1(0x27f)](_0x4488a1(0x1e7))):console['log'](_0x4488a1(0x1ec));}),_0x1d63d4[_0x53ddd5(0x1c1)](_0x53ddd5(0x1e1),'sales\x20item\x20return\x20successfull'),_0x1d317b[_0x53ddd5(0x1fe)](_0x53ddd5(0x257));}catch(_0x4ff097){console[_0x53ddd5(0x27f)](_0x4ff097),_0x1d317b[_0x53ddd5(0x195)](0xc8)[_0x53ddd5(0x1e0)]({'message1':_0x4ff097[_0x53ddd5(0x1c5)]});}}}),router['get'](a0_0x8d9934(0x1f3),auth,async(_0x5f2e8a,_0xd43e13)=>{var _0x437783=a0_0x8d9934;try{const {username:_0x3596fe,email:_0x4703af,role:_0x4a6bd2}=_0x5f2e8a['user'],_0x10fb37=_0x5f2e8a[_0x437783(0x1e3)],_0xdd6f74=await profile[_0x437783(0x289)]({'email':_0x10fb37[_0x437783(0x2a7)]}),_0x48a4ca=await master_shop[_0x437783(0x2a2)]();console[_0x437783(0x27f)](_0x437783(0x22c),_0x48a4ca);const _0x580ea6=_0x5f2e8a[_0x437783(0x1fb)]['id'],_0x266b6f=await sales[_0x437783(0x231)](_0x580ea6);console[_0x437783(0x27f)](_0x437783(0x1dd),_0x266b6f);if(_0x48a4ca[0x0][_0x437783(0x1c4)]=='English\x20(US)')var _0x469fb9=users[_0x437783(0x209)];else{if(_0x48a4ca[0x0][_0x437783(0x1c4)]=='Hindi')var _0x469fb9=users[_0x437783(0x1d7)];else{if(_0x48a4ca[0x0][_0x437783(0x1c4)]=='German')var _0x469fb9=users[_0x437783(0x236)];else{if(_0x48a4ca[0x0][_0x437783(0x1c4)]==_0x437783(0x204))var _0x469fb9=users[_0x437783(0x204)];else{if(_0x48a4ca[0x0]['language']=='French')var _0x469fb9=users['French'];else{if(_0x48a4ca[0x0][_0x437783(0x1c4)]==_0x437783(0x26f))var _0x469fb9=users[_0x437783(0x19f)];else{if(_0x48a4ca[0x0][_0x437783(0x1c4)]==_0x437783(0x223))var _0x469fb9=users[_0x437783(0x223)];else{if(_0x48a4ca[0x0][_0x437783(0x1c4)]==_0x437783(0x211))var _0x469fb9=users['Arabic'];}}}}}}}_0xd43e13[_0x437783(0x270)](_0x437783(0x23b),{'success':_0x5f2e8a[_0x437783(0x1c1)]('success'),'errors':_0x5f2e8a[_0x437783(0x1c1)]('errors'),'role':_0x10fb37,'profile':_0xdd6f74,'alldata':_0x266b6f,'master_shop':_0x48a4ca,'language':_0x469fb9});}catch(_0x65558a){console[_0x437783(0x27f)](_0x65558a);}}),router[a0_0x8d9934(0x273)](a0_0x8d9934(0x244),async(_0x577ab2,_0x40b609)=>{var _0x1530be=a0_0x8d9934;const {product_code:_0x480806,warehouse_name:_0x39c371,rooms_data:_0x1e1dc3,Roomslist:_0x49656d}=_0x577ab2[_0x1530be(0x279)],_0x3b50da=_0x49656d[_0x1530be(0x275)](','),_0x3539b9=[];async function _0x56c1e3(_0x5c4256){var _0x2f344e=_0x1530be;const _0xa418ea=await warehouse[_0x2f344e(0x202)]([{'$match':{'name':_0x39c371,'room':_0x5c4256}},{'$unwind':_0x2f344e(0x1e8)},{'$match':{'product_details.primary_code':_0x480806}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2f344e(0x229)},'primary_code':{'$first':_0x2f344e(0x1a3)},'secondary_code':{'$first':_0x2f344e(0x1e2)},'product_code':{'$first':_0x2f344e(0x1b6)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2f344e(0x291)},'type':{'$first':_0x2f344e(0x212)},'pallet':{'$first':_0x2f344e(0x220)},'unit':{'$first':_0x2f344e(0x22d)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2f344e(0x207)},'rack':{'$first':_0x2f344e(0x1e4)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2f344e(0x243)},'maxPerUnit':{'$first':_0x2f344e(0x1ae)},'batch_code':{'$first':_0x2f344e(0x230)},'product_cat':{'$first':_0x2f344e(0x28b)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2f344e(0x1a0)},'invoice':{'$first':_0x2f344e(0x201)}}}]),_0x2c5583=await warehouse[_0x2f344e(0x202)]([{'$match':{'name':_0x39c371,'room':_0x5c4256}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x480806}},{'$group':{'_id':_0x2f344e(0x23f),'name':{'$first':_0x2f344e(0x194)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2f344e(0x1a3)},'secondary_code':{'$first':_0x2f344e(0x1e2)},'product_code':{'$first':_0x2f344e(0x1b6)},'level':{'$first':_0x2f344e(0x1ab)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2f344e(0x212)},'pallet':{'$first':_0x2f344e(0x220)},'unit':{'$first':_0x2f344e(0x22d)},'secondary_unit':{'$first':_0x2f344e(0x241)},'storage':{'$first':_0x2f344e(0x207)},'rack':{'$first':_0x2f344e(0x1e4)},'expiry_date':{'$first':_0x2f344e(0x268)},'production_date':{'$first':_0x2f344e(0x243)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x2f344e(0x28b)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2f344e(0x201)}}}]);if(_0xa418ea['length']>0x0)_0x3539b9['push'](_0xa418ea);else _0x2c5583[_0x2f344e(0x1ac)]>0x0&&_0x3539b9['push'](_0x2c5583);}const _0x8473ed=_0x3b50da['map'](_0xf0ddd=>_0x56c1e3(_0xf0ddd));await Promise[_0x1530be(0x238)](_0x8473ed),_0x40b609[_0x1530be(0x1e0)](_0x3539b9);}),module['exports']=router;