var a0_0x2891db=a0_0x2d91;(function(_0x1c6e21,_0x19d843){var _0x454472=a0_0x2d91,_0x2ddcd2=_0x1c6e21();while(!![]){try{var _0x31e8ff=parseInt(_0x454472(0x162))/0x1+parseInt(_0x454472(0xfb))/0x2+parseInt(_0x454472(0xf2))/0x3+-parseInt(_0x454472(0xf6))/0x4+-parseInt(_0x454472(0x8e))/0x5+parseInt(_0x454472(0xc1))/0x6+-parseInt(_0x454472(0xf4))/0x7;if(_0x31e8ff===_0x19d843)break;else _0x2ddcd2['push'](_0x2ddcd2['shift']());}catch(_0x496250){_0x2ddcd2['push'](_0x2ddcd2['shift']());}}}(a0_0x1c0c,0xbe90e));function a0_0x2d91(_0x2ff9b1,_0x5d4b88){var _0x1c0cc8=a0_0x1c0c();return a0_0x2d91=function(_0x2d915e,_0x144503){_0x2d915e=_0x2d915e-0x6f;var _0x428288=_0x1c0cc8[_0x2d915e];return _0x428288;},a0_0x2d91(_0x2ff9b1,_0x5d4b88);}const express=require(a0_0x2891db(0x13a)),app=express(),router=express[a0_0x2891db(0xce)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x2891db(0x13f)),auth=require(a0_0x2891db(0xdb)),nodemailer=require(a0_0x2891db(0xb1)),users=require(a0_0x2891db(0x17e));function a0_0x1c0c(){var _0x1423ae=['<strong>\x20Regards\x20</strong>','product_date','prod_invoice','Chinese','German','$date','prod_code','$product_details.bin','$product_details.maxProducts','$customers_docs','</tr>','sales_quantity_QA','prod_cat','express','/give_payment/:id','customers','email','/view','../models/all_models','getDate','received_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','host','$product_details.rack','Enclosed','FGSEmail','suppliers','$finalize','getFullYear','/preview/:id','Portuguese','redirect','push','$product_details.floorlevel','</td>','stock_data','$warehouse_name','user','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.type','$invoice','language','customer','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','sale_product','primary_unit','all','$return_data','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','maxPerUnit_QA','sendMail','984475mmipVj','$product_details.primary_code','max_per_unit','success','Sales\x20Update\x20successfully','<span\x20style=\x22float:\x20right;\x22>','RoomAssigned','\x20<>\x20','product_data','for_categorize','Spanish','gmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$sale_product.floorlevel','all_sales_finished','/all_sales/view','Error\x20Occurs','sales_invoice','date','Received\x20Payment\x20For\x20Sale','payment\x20successfull','secondary_code','json','unit_QA','/barcode/:id','<html><head><title></title>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','_id','../public/language/languages.json','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','production_date_QA','concat','Logo.png','\x20<<<==>>>\x20','finalize','maxPerUnit','</head><body>','<h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Portuguese\x20(BR)','id_transaction_from','<h2>\x20','production_date','$product_details.secondary_unit','Return\x20Rooms','adjust_qty','find','$product_details.maxPerUnit','$note','final','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','secondary_unit_QA','product_code_QA','$product_details.secondary_code','Arabic\x20(ae)','sales\x20item\x20return\x20successfull','Sales\x20Add\x20successfully','secondary_code_QA','quantity','product_code','floor','primary_code_QA','amount','edit_sales_finished_view','$product','/upload/','<tbody\x20style=\x22text-align:\x20center;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','/all_sales_finished/view','6168950eBOQMS','$product_details.bay','<div>','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','logo','forEach','$sale_product.bay','foreach\x20newproduct','sale_qty','slice','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','</table>','currency_placement','product_list','Email\x20sent\x20successfully','<hr\x20class=\x22my-3\x22>','site_title','filter','maxProducts_QA','then','params','bay','maxProducts','room_name','/view/add_sales','customers_docs','render','</body></html>','ADD\x20SALE','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<tr>','log','$product_details','nodemailer','Hindi','Finished\x20Goods','</thead>','$product_details.batch_code','role','Return\x20Goods','batch_code','password','image','primary_code','English\x20(US)','$sale_product','$customer','get','$product_details.storage','2965890fkmeAW','staff','batch_code_QA','product_name','Sale\x20Return','$room','Enabled','$product_details._id','due_amount','QA\x20Warehouse','flash','$product_details.product_stock','return_sale','Router','product_details','/barcode_scanner','save','/../public','Sale\x20Return\x20Mail','True','$product_details.expiry_date','findById','product_name_QA1','product_stock','post','stocks_QA','../middleware/auth','aggregate','edit_sales_finished','customer_data','/view/return_sales/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$sale_product.type','barcode\x20Product\x20master','</span>','room','map','$product_details.product_name','False','OUTF-','errors','\x20>>>\x20','return_data','body','\x20</h2>','level','$product_details.product_cat','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','error','2734266Wjaybb','length','5164943tzjpPT','back','2712072RHXsSx','\x20==\x20','warehouse','/view/:id','findOne','2080006MdPvAw','$product_details.invoice','Add\x20Sales','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','carton','warehouse_name','barcode\x20user_id','maxperunit','expiry_date','$_id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','string','expiry_date_QA','master','exports','\x20&&\x20','sales_quantity','$product_details.product_code','</tbody>','invoice','split','port','return_qty','/picking_list/pdf/','add\x20post','Ambient','English','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/view/add_sale/product','Arabic','/invoice/:id','currency','$sale_product.quantity','status','$name','\x20Order\x20Date\x20:\x20','\x20Order\x20Number\x20:\x20','secondary_unit','French','unit','random','padStart','purchases_data','abs','name','$product_details.production_date','stock','getMonth','all_sales_barcode','</div>'];a0_0x1c0c=function(){return _0x1423ae;};return a0_0x1c0c();}router['get'](a0_0x2891db(0x13e),auth,async(_0x224822,_0x2d5d2f)=>{var _0x57b999=a0_0x2891db;try{const {username:_0x2492c3,email:_0x3c2f1b,role:_0x4c9afa}=_0x224822[_0x57b999(0x153)],_0x20f4b1=_0x224822['user'],_0x2d07b0=await profile['findOne']({'email':_0x20f4b1['email']}),_0x3a26a3=await master_shop['find']();let _0x87fbf4;if(_0x20f4b1[_0x57b999(0xb6)]==_0x57b999(0xc2)){const _0x388343=await staff['findOne']({'email':_0x20f4b1[_0x57b999(0x13d)]});_0x87fbf4=await sales_finished[_0x57b999(0xdc)]([{'$lookup':{'from':'customers','localField':_0x57b999(0x158),'foreignField':_0x57b999(0x127),'as':'customers_docs'}},{'$unwind':_0x57b999(0x136)},{'$unwind':_0x57b999(0xbd)},{'$group':{'_id':'$_id','invoice':{'$first':_0x57b999(0x156)},'customers':{'$first':_0x57b999(0xbe)},'date':{'$first':_0x57b999(0x132)},'warehouse_name':{'$first':_0x57b999(0x152)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x57b999(0x79)},'return_data':{'$first':_0x57b999(0x15e)},'customers_docs':{'$first':_0x57b999(0x136)},'total_saleproduct_quantity':{'$sum':_0x57b999(0x11b)},'level':{'$addToSet':_0x57b999(0x95)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x57b999(0xe1)},'pallet':{'$addToSet':_0x57b999(0x16f)},'finalize':{'$first':_0x57b999(0x149)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x87fbf4=await sales_finished[_0x57b999(0xdc)]([{'$lookup':{'from':_0x57b999(0x13c),'localField':_0x57b999(0x158),'foreignField':_0x57b999(0x127),'as':_0x57b999(0xa9)}},{'$unwind':'$customers_docs'},{'$unwind':_0x57b999(0xbd)},{'$group':{'_id':_0x57b999(0x104),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x57b999(0x132)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x57b999(0x79)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x57b999(0x136)},'total_saleproduct_quantity':{'$sum':_0x57b999(0x11b)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x57b999(0x16f)},'finalize':{'$first':_0x57b999(0x149)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x3a26a3[0x0][_0x57b999(0x157)]==_0x57b999(0xbc)){var _0x123277=users[_0x57b999(0x115)];console[_0x57b999(0xaf)](_0x123277);}else{if(_0x3a26a3[0x0][_0x57b999(0x157)]==_0x57b999(0xb2))var _0x123277=users['Hindi'];else{if(_0x3a26a3[0x0][_0x57b999(0x157)]==_0x57b999(0x131))var _0x123277=users['German'];else{if(_0x3a26a3[0x0][_0x57b999(0x157)]==_0x57b999(0x16c))var _0x123277=users[_0x57b999(0x16c)];else{if(_0x3a26a3[0x0][_0x57b999(0x157)]==_0x57b999(0x121))var _0x123277=users[_0x57b999(0x121)];else{if(_0x3a26a3[0x0][_0x57b999(0x157)]==_0x57b999(0x70))var _0x123277=users[_0x57b999(0x14c)];else{if(_0x3a26a3[0x0][_0x57b999(0x157)]=='Chinese')var _0x123277=users['Chinese'];else{if(_0x3a26a3[0x0]['language']==_0x57b999(0x7f))var _0x123277=users[_0x57b999(0x118)];}}}}}}}_0x2d5d2f[_0x57b999(0xaa)](_0x57b999(0x170),{'success':_0x224822[_0x57b999(0xcb)](_0x57b999(0x165)),'errors':_0x224822['flash'](_0x57b999(0xe9)),'sales':_0x87fbf4,'profile':_0x2d07b0,'role':_0x20f4b1,'master_shop':_0x3a26a3,'language':_0x123277});}catch(_0x15848c){console[_0x57b999(0xaf)](_0x15848c);}});async function getRandom8DigitNumber(){var _0x5d496a=a0_0x2891db;const _0x4facf0=0x989680,_0x4e8dc8=0x5f5e0ff,_0x448ac0=Math[_0x5d496a(0x85)](Math[_0x5d496a(0x123)]()*(_0x4e8dc8-_0x4facf0+0x1))+_0x4facf0;var _0x6ad3ba;const _0x1f1b91=await sales_finished['findOne']({'invoice':_0x5d496a(0xe8)+_0x448ac0});return _0x1f1b91&&_0x1f1b91[_0x5d496a(0xf3)]>0x0?_0x6ad3ba=_0x5d496a(0xe8)+_0x448ac0:_0x6ad3ba=_0x5d496a(0xe8)+_0x448ac0,_0x6ad3ba;}router[a0_0x2891db(0xbf)](a0_0x2891db(0xa8),auth,async(_0xbe359c,_0x132037)=>{var _0xdc8395=a0_0x2891db;try{const {username:_0x249a23,email:_0x47c651,role:_0x367746}=_0xbe359c[_0xdc8395(0x153)],_0x39d835=_0xbe359c[_0xdc8395(0x153)],_0x5d85c5=await profile['findOne']({'email':_0x39d835[_0xdc8395(0x13d)]}),_0xf2474d=await master_shop[_0xdc8395(0x77)](),_0x2113e6=await customer[_0xdc8395(0x77)]({});let _0x506c5f;if(_0x39d835[_0xdc8395(0xb6)]==_0xdc8395(0xc2)){const _0x48aceb=await staff[_0xdc8395(0xfa)]({'email':_0x39d835[_0xdc8395(0x13d)]});_0x506c5f=await warehouse[_0xdc8395(0xdc)]([{'$match':{'status':_0xdc8395(0xc7),'name':_0x48aceb[_0xdc8395(0xf8)],'warehouse_category':_0xdc8395(0xb3),'name':{'$ne':_0xdc8395(0xca)}}},{'$group':{'_id':_0xdc8395(0x11d),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x506c5f=await warehouse[_0xdc8395(0xdc)]([{'$match':{'status':_0xdc8395(0xc7),'warehouse_category':_0xdc8395(0xb3),'name':{'$ne':_0xdc8395(0xca)}}},{'$group':{'_id':'$name','name':{'$first':_0xdc8395(0x11d)}}},{'$sort':{'name':0x1}}]);const _0x39fdb5=await product[_0xdc8395(0x77)]({});var _0x2d8364=[_0xdc8395(0x114),'Enclosed'];const _0x1d8db5=await sales_finished[_0xdc8395(0x77)]({}),_0x263e69=_0x1d8db5['length']+0x1,_0x47c174=_0xdc8395(0xe8)+_0x263e69['toString']()[_0xdc8395(0x124)](0x5,'0');if(_0xf2474d[0x0][_0xdc8395(0x157)]=='English\x20(US)'){var _0x56fc9b=users[_0xdc8395(0x115)];console['log'](_0x56fc9b);}else{if(_0xf2474d[0x0]['language']==_0xdc8395(0xb2))var _0x56fc9b=users[_0xdc8395(0xb2)];else{if(_0xf2474d[0x0]['language']==_0xdc8395(0x131))var _0x56fc9b=users[_0xdc8395(0x131)];else{if(_0xf2474d[0x0][_0xdc8395(0x157)]==_0xdc8395(0x16c))var _0x56fc9b=users[_0xdc8395(0x16c)];else{if(_0xf2474d[0x0][_0xdc8395(0x157)]==_0xdc8395(0x121))var _0x56fc9b=users[_0xdc8395(0x121)];else{if(_0xf2474d[0x0][_0xdc8395(0x157)]==_0xdc8395(0x70))var _0x56fc9b=users[_0xdc8395(0x14c)];else{if(_0xf2474d[0x0]['language']==_0xdc8395(0x130))var _0x56fc9b=users[_0xdc8395(0x130)];else{if(_0xf2474d[0x0][_0xdc8395(0x157)]==_0xdc8395(0x7f))var _0x56fc9b=users[_0xdc8395(0x118)];}}}}}}}const _0xdce8f2=getRandom8DigitNumber();_0xdce8f2[_0xdc8395(0xa3)](_0x4920a8=>{var _0x1ebd4f=_0xdc8395;_0x132037[_0x1ebd4f(0xaa)]('add_sales_finished',{'success':_0xbe359c[_0x1ebd4f(0xcb)]('success'),'errors':_0xbe359c[_0x1ebd4f(0xcb)](_0x1ebd4f(0xe9)),'role':_0x39d835,'profile':_0x5d85c5,'customer':_0x2113e6,'warehouse':_0x506c5f,'product':_0x39fdb5,'invoice':_0x4920a8,'master_shop':_0xf2474d,'language':_0x56fc9b,'rooms_data':_0x2d8364});})['catch'](_0x4a6a16=>{var _0x4cef9f=_0xdc8395;_0xbe359c[_0x4cef9f(0xcb)](_0x4cef9f(0xe9),_0x4cef9f(0x116)),_0x132037[_0x4cef9f(0x14d)](_0x4cef9f(0x8d));});}catch(_0x84595a){console[_0xdc8395(0xaf)](_0x84595a);}}),router[a0_0x2891db(0xbf)]('/view/add_sales/:id',auth,async(_0x543140,_0x4859e9)=>{var _0x474b49=a0_0x2891db;try{const _0x1b6ba9=_0x543140[_0x474b49(0xa4)]['id'];console[_0x474b49(0xaf)](_0x1b6ba9);const _0x5e65b2=await product[_0x474b49(0x77)](),_0x11ddc9=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1b6ba9}},{'$unwind':_0x474b49(0x89)},{'$group':{'_id':'$product.product_name'}}]);console[_0x474b49(0xaf)](_0x474b49(0x125),_0x11ddc9),_0x4859e9['status'](0xc8)[_0x474b49(0x178)]({'purchases_data':_0x11ddc9,'product_data':_0x5e65b2});}catch(_0x461e1d){console['log'](_0x461e1d);}}),router['post'](a0_0x2891db(0x117),auth,async(_0x3cfe18,_0x21c75c)=>{var _0x330487=a0_0x2891db;try{const {warehouse_data:_0x41ac43,product_data:_0x3afd3e}=_0x3cfe18[_0x330487(0xec)];console[_0x330487(0xaf)](_0x3cfe18[_0x330487(0xec)][_0x330487(0x16a)]);;const _0x328405=await master_shop[_0x330487(0x77)]();console[_0x330487(0xaf)](_0x330487(0x108),_0x328405);const _0xf85bad=await product[_0x330487(0xfa)]({'name':_0x3afd3e});console[_0x330487(0xaf)]('product',_0xf85bad);const _0x5198ac=await warehouse[_0x330487(0xdc)]([{'$match':{'name':_0x41ac43}},{'$unwind':_0x330487(0xb0)},{'$match':{'product_details.product_name':_0x3afd3e}},{'$group':{'_id':_0x330487(0xe6),'product_stock':{'$first':_0x330487(0xcc)}}}]);console[_0x330487(0xaf)](_0x330487(0x151),_0x5198ac),_0x21c75c[_0x330487(0x11c)](0xc8)[_0x330487(0x178)]({'master':_0x328405,'new_product':_0xf85bad,'stock_data':_0x5198ac});}catch(_0xcd1596){console['log'](_0xcd1596);}}),router[a0_0x2891db(0xd9)](a0_0x2891db(0xa8),auth,async(_0x30bc97,_0x4532a7)=>{var _0x537202=a0_0x2891db;try{const {invoice:_0x48110e,date:_0x19fc6d,warehouse_name:_0xc16cc1,product_name:_0x366802,stock:_0x296dd7,quantity:_0xe67f5a,note:_0x3213e4,room:_0x298f71,primary_code:_0x191be0,secondary_code:_0x4ecf8d,prod_code:_0x1d1617,level:_0x3d21b9,isle:_0x5b4584,pallet:_0x4d7eaa,batch_code:_0x52d329,SCRN:_0x42379b,expiry_date:_0x37b00e,mode_transpo:_0x3029e6,name_driver:_0x40fe3e}=_0x30bc97[_0x537202(0xec)];if(typeof _0x366802==_0x537202(0x106))var _0x2cc4c5=[_0x30bc97[_0x537202(0xec)][_0x537202(0xc4)]],_0x2bace4=[_0x30bc97[_0x537202(0xec)][_0x537202(0x129)]],_0x4c4813=[_0x30bc97[_0x537202(0xec)][_0x537202(0xff)]],_0x434538=[_0x30bc97[_0x537202(0xec)][_0x537202(0xbb)]],_0x5e44df=[_0x30bc97[_0x537202(0xec)]['secondary_code']],_0x5baedb=[_0x30bc97['body'][_0x537202(0x133)]],_0x1d4bd3=[_0x30bc97[_0x537202(0xec)][_0x537202(0xee)]],_0x4b1bb8=[_0x30bc97[_0x537202(0xec)][_0x537202(0x15c)]],_0x2ab6e2=[_0x30bc97[_0x537202(0xec)][_0x537202(0x120)]],_0x5c7238=[_0x30bc97[_0x537202(0xec)][_0x537202(0xb8)]],_0x51829f=[_0x30bc97[_0x537202(0xec)][_0x537202(0x103)]],_0x45f0f8=[_0x30bc97[_0x537202(0xec)][_0x537202(0x12e)]],_0x6714b9=[_0x30bc97['body'][_0x537202(0x164)]],_0x24cfe2=[_0x30bc97['body'][_0x537202(0x139)]],_0x3dc8f8=[_0x30bc97['body'][_0x537202(0x168)]],_0x1e8d9e=[_0x30bc97[_0x537202(0xec)][_0x537202(0x12f)]],_0x56d786=[_0x30bc97[_0x537202(0xec)][_0x537202(0x71)]];else var _0x2cc4c5=[..._0x30bc97[_0x537202(0xec)][_0x537202(0xc4)]],_0x2bace4=[..._0x30bc97[_0x537202(0xec)][_0x537202(0x129)]],_0x4c4813=[..._0x30bc97[_0x537202(0xec)]['carton']],_0x434538=[..._0x30bc97[_0x537202(0xec)][_0x537202(0xbb)]],_0x5e44df=[..._0x30bc97[_0x537202(0xec)][_0x537202(0x177)]],_0x5baedb=[..._0x30bc97[_0x537202(0xec)]['prod_code']],_0x1d4bd3=[..._0x30bc97['body']['level']],_0x4b1bb8=[..._0x30bc97[_0x537202(0xec)][_0x537202(0x15c)]],_0x2ab6e2=[..._0x30bc97['body'][_0x537202(0x120)]],_0x5c7238=[..._0x30bc97[_0x537202(0xec)][_0x537202(0xb8)]],_0x51829f=[..._0x30bc97[_0x537202(0xec)][_0x537202(0x103)]],_0x45f0f8=[..._0x30bc97[_0x537202(0xec)][_0x537202(0x12e)]],_0x6714b9=[..._0x30bc97[_0x537202(0xec)]['max_per_unit']],_0x24cfe2=[..._0x30bc97[_0x537202(0xec)][_0x537202(0x139)]],_0x3dc8f8=[..._0x30bc97[_0x537202(0xec)][_0x537202(0x168)]],_0x1e8d9e=[..._0x30bc97[_0x537202(0xec)][_0x537202(0x12f)]],_0x56d786=[..._0x30bc97[_0x537202(0xec)][_0x537202(0x71)]];const _0x1efae2=_0x2cc4c5[_0x537202(0xe5)](_0x331eac=>{return _0x331eac={'product_name':_0x331eac};});_0x2bace4['forEach']((_0x301dda,_0x2a063e)=>{var _0x1cfc20=_0x537202;_0x1efae2[_0x2a063e][_0x1cfc20(0x129)]=_0x301dda;}),_0x4c4813['forEach']((_0x1422a4,_0x427424)=>{var _0x1ef094=_0x537202;_0x1efae2[_0x427424][_0x1ef094(0x83)]=Math[_0x1ef094(0x126)](_0x1422a4);}),_0x56d786[_0x537202(0x94)]((_0x23fcb2,_0x4cd87a)=>{_0x1efae2[_0x4cd87a]['id_transaction_from']=_0x23fcb2;}),_0x434538['forEach']((_0x46f3c1,_0x3de987)=>{_0x1efae2[_0x3de987]['primary_code']=_0x46f3c1;}),_0x5e44df[_0x537202(0x94)]((_0x4f777f,_0x544288)=>{_0x1efae2[_0x544288]['secondary_code']=_0x4f777f;}),_0x5baedb[_0x537202(0x94)]((_0x19eb38,_0x48faad)=>{var _0x272683=_0x537202;_0x1efae2[_0x48faad][_0x272683(0x84)]=_0x19eb38;}),_0x1d4bd3[_0x537202(0x94)]((_0x1ee3b0,_0x48c838)=>{_0x1efae2[_0x48c838]['bay']=_0x1ee3b0;}),_0x4b1bb8[_0x537202(0x94)]((_0x1076d4,_0x21e526)=>{var _0x2e50be=_0x537202;_0x1efae2[_0x21e526][_0x2e50be(0x122)]=_0x1076d4;}),_0x2ab6e2[_0x537202(0x94)]((_0x34f030,_0x3cad57)=>{_0x1efae2[_0x3cad57]['secondary_unit']=_0x34f030;}),_0x5c7238[_0x537202(0x94)]((_0x57f88d,_0x4eb900)=>{_0x1efae2[_0x4eb900]['batch_code']=_0x57f88d;}),_0x51829f['forEach']((_0x2a941e,_0xe04576)=>{_0x1efae2[_0xe04576]['expiry_date']=_0x2a941e;}),_0x45f0f8['forEach']((_0x1cd103,_0x5e1388)=>{var _0x281ec4=_0x537202;_0x1efae2[_0x5e1388][_0x281ec4(0x73)]=_0x1cd103;}),_0x6714b9[_0x537202(0x94)]((_0x969d97,_0x3a8193)=>{var _0x155a58=_0x537202;_0x1efae2[_0x3a8193][_0x155a58(0x102)]=_0x969d97;}),_0x24cfe2[_0x537202(0x94)]((_0x291a9e,_0x32adb7)=>{var _0x33ff18=_0x537202;_0x1efae2[_0x32adb7][_0x33ff18(0x139)]=_0x291a9e;}),_0x3dc8f8[_0x537202(0x94)]((_0x31f01e,_0x3dab00)=>{var _0x4fedb7=_0x537202;_0x1efae2[_0x3dab00][_0x4fedb7(0xa7)]=_0x31f01e;}),_0x1e8d9e[_0x537202(0x94)]((_0x3a32b9,_0x597497)=>{var _0x4c8236=_0x537202;_0x1efae2[_0x597497][_0x4c8236(0x10e)]=_0x3a32b9;});var _0x4e28a4=0x0;_0x1efae2[_0x537202(0x94)](_0x12a6ee=>{var _0xf858b9=_0x537202;parseFloat(_0x12a6ee[_0xf858b9(0x129)])<parseFloat(_0x12a6ee['quantity'])&&parseFloat(_0x12a6ee[_0xf858b9(0x83)])>parseFloat(_0x12a6ee[_0xf858b9(0x129)])&&(console[_0xf858b9(0xaf)](_0x12a6ee[_0xf858b9(0x129)]+_0xf858b9(0x169)+_0x12a6ee[_0xf858b9(0x83)]),_0x4e28a4++);});if(_0x4e28a4!=0x0)return _0x30bc97[_0x537202(0xcb)]('errors','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x4532a7[_0x537202(0x14d)](_0x537202(0xf5));const _0x262564=_0x1efae2[_0x537202(0xa1)](_0x32418b=>_0x32418b[_0x537202(0x83)]!=='0'&&_0x32418b[_0x537202(0x83)]!==''),_0x37ae70=new sales_finished({'invoice':_0x48110e,'customer':_0x30bc97[_0x537202(0xec)][_0x537202(0x158)],'date':_0x19fc6d,'warehouse_name':_0xc16cc1,'sale_product':_0x262564,'note':_0x3213e4,'room':_0x298f71,'primary_code':_0x191be0,'secondary_code':_0x4ecf8d,'prod_code':_0x1d1617,'SCRN':_0x42379b,'finalize':_0x537202(0xe7),'mode_transpo':_0x3029e6,'name_driver':_0x40fe3e}),_0x4b7df1=await _0x37ae70[_0x537202(0xd1)](),_0xee4883=await sales_finished[_0x537202(0xfa)]({'invoice':_0x48110e}),_0x395041=new c_payment_data({'invoice':_0x48110e,'customer':_0x30bc97['body'][_0x537202(0x158)],'reason':'Sale'});await _0x395041[_0x537202(0xd1)]();const _0x2907dc=await master_shop['find'](),_0xa1f3a2=await email_settings['findOne'](),_0x477a0d=await customer[_0x537202(0xfa)]({'name':_0x30bc97['body'][_0x537202(0x158)]});_0x2907dc[0x0][_0x537202(0x9c)]==0x1?(right_currency=_0x2907dc[0x0][_0x537202(0x11a)],left_currency=''):(right_currency='',left_currency=_0x2907dc[0x0][_0x537202(0x11a)]);var _0x2df58b=_0x2cc4c5,_0x1121e5=_0x4c4813,_0x358f9c='',_0x551248;for(_0x551248 in _0x2df58b){_0x358f9c+=_0x537202(0xae)+_0x537202(0x15f)+_0x2df58b[_0x551248]+'</td>'+_0x537202(0x15f)+_0x1121e5[_0x551248]+'</td>'+_0x537202(0x137);}console[_0x537202(0xaf)]('product_list',_0x358f9c);let _0x5e5233=nodemailer['createTransport']({'host':_0xa1f3a2['host'],'port':Number(_0xa1f3a2['port']),'secure':![],'service':_0x537202(0x16d),'auth':{'user':_0xa1f3a2[_0x537202(0x13d)],'pass':_0xa1f3a2[_0x537202(0xb9)]}}),_0x212d33={'from':_0xa1f3a2[_0x537202(0x13d)],'to':'christian.villamer@jakagroup.com','subject':_0x537202(0xfd),'attachments':[{'filename':'Logo.png','path':__dirname+_0x537202(0xd2)+_0x537202(0x8a)+_0x2907dc[0x0][_0x537202(0xba)],'cid':_0x537202(0x93)}],'html':_0x537202(0xac)};_0x5e5233['sendMail'](_0x212d33,function(_0x2916c8,_0x214780){var _0x3b04a1=_0x537202;_0x2916c8?(console['log'](_0x2916c8),console[_0x3b04a1(0xaf)](_0x3b04a1(0x172))):console[_0x3b04a1(0xaf)]('Email\x20sent\x20successfully');}),_0x30bc97[_0x537202(0xcb)](_0x537202(0x165),_0x537202(0x81)),_0x4532a7[_0x537202(0x14d)]('/all_sales_finished/preview/'+_0x4b7df1[_0x537202(0x17d)]);}catch(_0x5e9bae){console['log'](_0x5e9bae);}}),router['get'](a0_0x2891db(0x14b),auth,async(_0x15b339,_0x5500fe)=>{var _0x337cec=a0_0x2891db;try{const {username:_0x1c34d5,email:_0x354ca3,role:_0x27d354}=_0x15b339[_0x337cec(0x153)],_0x5d7743=_0x15b339[_0x337cec(0x153)],_0x10ac03=await profile[_0x337cec(0xfa)]({'email':_0x5d7743[_0x337cec(0x13d)]}),_0x575aa1=await master_shop[_0x337cec(0x77)](),_0x59ee1d=_0x15b339['params']['id'],_0x236607=await sales_finished[_0x337cec(0xd6)](_0x59ee1d),_0x30b76d=await warehouse[_0x337cec(0xdc)]([{'$match':{'name':_0x236607[_0x337cec(0x100)]}},{'$unwind':_0x337cec(0xb0)},{'$group':{'_id':_0x337cec(0xc8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x337cec(0xcc)},'bay':{'$first':_0x337cec(0x8f)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x337cec(0x155)},'floorlevel':{'$first':_0x337cec(0x14f)},'primary_code':{'$first':_0x337cec(0x163)},'secondary_code':{'$first':_0x337cec(0x7e)},'product_code':{'$first':_0x337cec(0x10c)},'storage':{'$first':_0x337cec(0xc0)},'rack':{'$first':_0x337cec(0x145)},'expiry_date':{'$first':_0x337cec(0xd5)},'production_date':{'$first':_0x337cec(0x128)},'batch_code':{'$first':_0x337cec(0xb5)},'room':{'$first':_0x337cec(0xc6)},'room_data':{'$first':'$product_details.room_name'}}}]),_0x36825f=await customer[_0x337cec(0x77)]({});let _0x29b102;if(_0x5d7743[_0x337cec(0xb6)]=='staff'){const _0x41adc6=await staff[_0x337cec(0xfa)]({'email':_0x5d7743[_0x337cec(0x13d)]});_0x29b102=await warehouse[_0x337cec(0xdc)]([{'$match':{'status':_0x337cec(0xc7),'name':_0x41adc6[_0x337cec(0xf8)]}},{'$group':{'_id':_0x337cec(0x11d),'name':{'$first':_0x337cec(0x11d)}}}]);}else _0x29b102=await warehouse[_0x337cec(0xdc)]([{'$match':{'status':_0x337cec(0xc7)}},{'$group':{'_id':_0x337cec(0x11d),'name':{'$first':_0x337cec(0x11d)}}}]);const _0x478a81=await product[_0x337cec(0x77)]({});if(_0x575aa1[0x0][_0x337cec(0x157)]==_0x337cec(0xbc)){var _0x5b4a92=users[_0x337cec(0x115)];console[_0x337cec(0xaf)](_0x5b4a92);}else{if(_0x575aa1[0x0][_0x337cec(0x157)]=='Hindi')var _0x5b4a92=users['Hindi'];else{if(_0x575aa1[0x0]['language']=='German')var _0x5b4a92=users[_0x337cec(0x131)];else{if(_0x575aa1[0x0]['language']=='Spanish')var _0x5b4a92=users[_0x337cec(0x16c)];else{if(_0x575aa1[0x0]['language']==_0x337cec(0x121))var _0x5b4a92=users[_0x337cec(0x121)];else{if(_0x575aa1[0x0]['language']==_0x337cec(0x70))var _0x5b4a92=users[_0x337cec(0x14c)];else{if(_0x575aa1[0x0][_0x337cec(0x157)]=='Chinese')var _0x5b4a92=users[_0x337cec(0x130)];else{if(_0x575aa1[0x0][_0x337cec(0x157)]=='Arabic\x20(ae)')var _0x5b4a92=users[_0x337cec(0x118)];}}}}}}}_0x5500fe[_0x337cec(0xaa)](_0x337cec(0x88),{'success':_0x15b339[_0x337cec(0xcb)](_0x337cec(0x165)),'errors':_0x15b339['flash'](_0x337cec(0xe9)),'role':_0x5d7743,'profile':_0x10ac03,'customer':_0x36825f,'warehouse':_0x29b102,'product':_0x30b76d,'user':_0x236607,'master_shop':_0x575aa1,'unit':_0x478a81,'language':_0x5b4a92});}catch(_0x21e816){console[_0x337cec(0xaf)](_0x21e816);}}),router[a0_0x2891db(0xd9)]('/preview/:id',auth,async(_0x143dcc,_0x1d768e)=>{var _0x531823=a0_0x2891db;try{const _0x1a63e4=_0x143dcc[_0x531823(0xa4)]['id'],{invoice:_0x38ab3d,warehouse_name:_0x2795d3,room:_0x20607b}=_0x143dcc[_0x531823(0xec)],_0x2a8883=await sales_finished[_0x531823(0xfa)]({'invoice':_0x38ab3d}),_0xd7897c=_0x2a8883[_0x531823(0x15b)][_0x531823(0xe5)](async _0x1d42c2=>{var _0x1daf5d=_0x531823,_0x5839d6=await warehouse[_0x1daf5d(0xfa)]({'name':_0x2795d3,'room':_0x1d42c2[_0x1daf5d(0xa7)],'warehouse_category':'Finished\x20Goods'});const _0x3e175d=_0x5839d6[_0x1daf5d(0xcf)][_0x1daf5d(0xe5)](_0x4afd9d=>{var _0x341f9d=_0x1daf5d;(_0x4afd9d['product_name']==_0x1d42c2[_0x341f9d(0xc4)]&&_0x4afd9d[_0x341f9d(0xa5)]==_0x1d42c2[_0x341f9d(0xa5)]&&_0x4afd9d[_0x341f9d(0x103)]==_0x1d42c2[_0x341f9d(0x103)]&&_0x4afd9d[_0x341f9d(0x73)]==_0x1d42c2[_0x341f9d(0x73)]&&_0x4afd9d['batch_code']==_0x1d42c2[_0x341f9d(0xb8)]&&_0x4afd9d[_0x341f9d(0x10e)]==_0x1d42c2[_0x341f9d(0x10e)]||_0x4afd9d[_0x341f9d(0x17d)]==_0x1d42c2['id_transaction_from'])&&(_0x4afd9d[_0x341f9d(0xd8)]>0x0&&(console['log'](_0x4afd9d['product_name']+_0x341f9d(0xf7)+_0x1d42c2['product_name']+_0x341f9d(0x10a)+_0x4afd9d[_0x341f9d(0xa5)]+'\x20==\x20'+_0x1d42c2['bay']+'\x20&&\x20'+_0x4afd9d[_0x341f9d(0x73)]+_0x341f9d(0xf7)+_0x1d42c2['production_date']+_0x341f9d(0x10a)+_0x4afd9d[_0x341f9d(0x103)]+'\x20==\x20'+_0x1d42c2[_0x341f9d(0x103)]+_0x341f9d(0x10a)+_0x4afd9d[_0x341f9d(0xb8)]+_0x341f9d(0xf7)+_0x1d42c2['batch_code']+_0x341f9d(0x10a)+_0x4afd9d[_0x341f9d(0x10e)]+'\x20==\x20'+_0x1d42c2[_0x341f9d(0x10e)]+_0x341f9d(0x10a)+_0x4afd9d['product_stock']+_0x341f9d(0x183)+_0x1d42c2['quantity']+_0x341f9d(0xea)+_0x1d42c2[_0x341f9d(0xa7)]+_0x341f9d(0x10a)+_0x4afd9d[_0x341f9d(0x17d)]+'\x20==\x20'+_0x1d42c2[_0x341f9d(0x71)]),_0x4afd9d['product_stock']=Math['max'](0x0,Math[_0x341f9d(0x126)](_0x4afd9d[_0x341f9d(0xd8)])-Math['abs'](_0x1d42c2[_0x341f9d(0x83)]))));});return _0x5839d6;});Promise[_0x531823(0x15d)](_0xd7897c)[_0x531823(0xa3)](async _0x469b8f=>{var _0x2e4bca=_0x531823;try{for(const _0x15fc1d of _0x469b8f){await _0x15fc1d['save']();}_0x2a8883[_0x2e4bca(0x184)]=_0x2e4bca(0xd4);const _0x5741b4=await _0x2a8883['save'](),_0x3292ce=await master_shop[_0x2e4bca(0x77)](),_0x1433a4=await email_settings[_0x2e4bca(0xfa)](),_0x1f5347=await supervisor_settings[_0x2e4bca(0x77)]();var _0x417d90=_0x2a8883[_0x2e4bca(0x15b)],_0x2176a1='',_0x56e17c;for(_0x56e17c in _0x417d90){var _0x60e89b='FG';_0x2a8883[_0x2e4bca(0x100)]=='DRY\x20GOODS'&&(_0x60e89b='DG'),_0x2176a1+='<tr>'+_0x2e4bca(0x15f)+_0x417d90[_0x56e17c][_0x2e4bca(0xc4)]+_0x2e4bca(0x150)+_0x2e4bca(0x15f)+_0x417d90[_0x56e17c][_0x2e4bca(0x84)]+'</td>'+_0x2e4bca(0x15f)+_0x417d90[_0x56e17c][_0x2e4bca(0x83)]+_0x2e4bca(0x150)+_0x2e4bca(0x15f)+_0x417d90[_0x56e17c][_0x2e4bca(0x122)]+_0x2e4bca(0x150)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x417d90[_0x56e17c][_0x2e4bca(0x120)]+_0x2e4bca(0x150)+_0x2e4bca(0x15f)+_0x2a8883[_0x2e4bca(0x100)]+_0x2e4bca(0x150)+_0x2e4bca(0x15f)+_0x417d90[_0x56e17c]['room_name']+_0x2e4bca(0x150)+_0x2e4bca(0x15f)+_0x60e89b+_0x417d90[_0x56e17c][_0x2e4bca(0xa5)]+_0x2e4bca(0x150);}let _0x21f510=nodemailer['createTransport']({'host':_0x1433a4[_0x2e4bca(0x144)],'port':Number(_0x1433a4[_0x2e4bca(0x110)]),'secure':![],'auth':{'user':_0x1433a4[_0x2e4bca(0x13d)],'pass':_0x1433a4[_0x2e4bca(0xb9)]}}),_0x59f255={'from':_0x1433a4['email'],'to':_0x1f5347[0x0][_0x2e4bca(0x147)],'subject':'Sales\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x2e4bca(0xd2)+_0x2e4bca(0x8a)+_0x3292ce[0x0][_0x2e4bca(0xba)],'cid':_0x2e4bca(0x93)}],'html':_0x2e4bca(0x99)+'<html><head><title></title>'+_0x2e4bca(0x186)+_0x2e4bca(0x90)+_0x2e4bca(0xad)+_0x2e4bca(0x90)+_0x2e4bca(0x17f)+_0x2e4bca(0x12c)+_0x2e4bca(0x90)+_0x2e4bca(0x72)+_0x3292ce[0x0]['site_title']+_0x2e4bca(0xed)+_0x2e4bca(0x12c)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x2e4bca(0x90)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2e4bca(0x11f)+_0x2a8883[_0x2e4bca(0x10e)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2e4bca(0x11e)+_0x2a8883[_0x2e4bca(0x174)]+'\x20'+'</span>'+_0x2e4bca(0x159)+'</div>'+_0x2e4bca(0x105)+_0x2e4bca(0x154)+_0x2e4bca(0xae)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2e4bca(0x7b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x2e4bca(0x142)+_0x2e4bca(0x143)+_0x2e4bca(0xe0)+_0x2e4bca(0x92)+_0x2e4bca(0x9a)+_0x2e4bca(0x137)+_0x2e4bca(0xb4)+_0x2e4bca(0x8b)+'\x20'+_0x2176a1+'\x20'+_0x2e4bca(0x10d)+_0x2e4bca(0x9b)+_0x2e4bca(0x90)+_0x2e4bca(0x12d)+'<h5>'+_0x3292ce[0x0][_0x2e4bca(0xa0)]+_0x2e4bca(0x159)+_0x2e4bca(0x12c)+'</div>'+_0x2e4bca(0xab)};_0x21f510[_0x2e4bca(0x161)](_0x59f255,function(_0x537d9a,_0x57576b){var _0x460114=_0x2e4bca;_0x537d9a?(console['log'](_0x537d9a),console['log'](_0x460114(0x172))):console[_0x460114(0xaf)](_0x460114(0x9e));}),_0x143dcc[_0x2e4bca(0xcb)](_0x2e4bca(0x165),_0x2e4bca(0x166)),_0x1d768e[_0x2e4bca(0x14d)](_0x2e4bca(0x112)+_0x1a63e4);}catch(_0x2da077){console[_0x2e4bca(0xf1)](_0x2da077),_0x1d768e['status'](0x1f4)[_0x2e4bca(0x178)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x3fbf2d=>{var _0x3bbb4c=_0x531823;console[_0x3bbb4c(0xf1)](_0x3fbf2d),_0x1d768e['status'](0x1f4)[_0x3bbb4c(0x178)]({'error':'An\x20error\x20occurred.'});});}catch(_0x7eb953){console[_0x531823(0xaf)](_0x7eb953);}}),router['get'](a0_0x2891db(0xf9),auth,async(_0x3e12c3,_0x11450e)=>{var _0xf657da=a0_0x2891db;try{const {username:_0xc194da,email:_0x255438,role:_0x40fc68}=_0x3e12c3[_0xf657da(0x153)],_0xb3ad65=_0x3e12c3[_0xf657da(0x153)],_0x5ddd6e=await profile['findOne']({'email':_0xb3ad65[_0xf657da(0x13d)]}),_0xa3f5a3=await master_shop[_0xf657da(0x77)](),_0x1dbfb7=_0x3e12c3[_0xf657da(0xa4)]['id'],_0x5195c7=await sales_finished[_0xf657da(0xd6)](_0x1dbfb7);let _0x4a903c=new Date(_0x5195c7[_0xf657da(0x103)]),_0x501338=('0'+_0x4a903c[_0xf657da(0x140)]())[_0xf657da(0x98)](-0x2),_0x1b1190=('0'+(_0x4a903c[_0xf657da(0x12a)]()+0x1))[_0xf657da(0x98)](-0x2),_0x14e9eb=_0x4a903c['getFullYear'](),_0xc62daa=_0x14e9eb+'-'+_0x1b1190+'-'+_0x501338;var _0x51e2fb=[_0xf657da(0x114),_0xf657da(0x146)];const _0xaafe93=await warehouse['aggregate']([{'$match':{'name':_0x5195c7[_0xf657da(0x100)],'room':_0x5195c7[_0xf657da(0xe4)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0xf657da(0xc8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xf657da(0x8f)},'bin':{'$first':_0xf657da(0x134)},'type':{'$first':_0xf657da(0x155)},'floorlevel':{'$first':_0xf657da(0x14f)},'primary_code':{'$first':_0xf657da(0x163)},'secondary_code':{'$first':_0xf657da(0x7e)},'product_code':{'$first':_0xf657da(0x10c)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xf657da(0x145)}}}]),_0x40efaf=await customer['find']({});let _0x343352;if(_0xb3ad65[_0xf657da(0xb6)]=='staff'){const _0x45e537=await staff['findOne']({'email':_0xb3ad65[_0xf657da(0x13d)]});_0x343352=await warehouse[_0xf657da(0xdc)]([{'$match':{'status':_0xf657da(0xc7),'name':_0x45e537[_0xf657da(0xf8)]}},{'$group':{'_id':'$name','name':{'$first':_0xf657da(0x11d)}}}]);}else _0x343352=await warehouse[_0xf657da(0xdc)]([{'$match':{'status':_0xf657da(0xc7)}},{'$group':{'_id':_0xf657da(0x11d),'name':{'$first':'$name'}}}]);const _0x1f9319=await product[_0xf657da(0x77)]({});if(_0xa3f5a3[0x0][_0xf657da(0x157)]==_0xf657da(0xbc)){var _0x347e54=users['English'];console['log'](_0x347e54);}else{if(_0xa3f5a3[0x0][_0xf657da(0x157)]==_0xf657da(0xb2))var _0x347e54=users['Hindi'];else{if(_0xa3f5a3[0x0][_0xf657da(0x157)]==_0xf657da(0x131))var _0x347e54=users[_0xf657da(0x131)];else{if(_0xa3f5a3[0x0][_0xf657da(0x157)]==_0xf657da(0x16c))var _0x347e54=users[_0xf657da(0x16c)];else{if(_0xa3f5a3[0x0]['language']==_0xf657da(0x121))var _0x347e54=users[_0xf657da(0x121)];else{if(_0xa3f5a3[0x0][_0xf657da(0x157)]=='Portuguese\x20(BR)')var _0x347e54=users[_0xf657da(0x14c)];else{if(_0xa3f5a3[0x0]['language']==_0xf657da(0x130))var _0x347e54=users[_0xf657da(0x130)];else{if(_0xa3f5a3[0x0]['language']==_0xf657da(0x7f))var _0x347e54=users[_0xf657da(0x118)];}}}}}}}_0x11450e[_0xf657da(0xaa)](_0xf657da(0xdd),{'success':_0x3e12c3[_0xf657da(0xcb)]('success'),'errors':_0x3e12c3[_0xf657da(0xcb)](_0xf657da(0xe9)),'role':_0xb3ad65,'profile':_0x5ddd6e,'customer':_0x40efaf,'warehouse':_0x343352,'product':_0xaafe93,'user':_0x5195c7,'master_shop':_0xa3f5a3,'unit':_0x1f9319,'language':_0x347e54,'rooms_data':_0x51e2fb,'ed_fullDate':_0xc62daa});}catch(_0x523656){console['log'](_0x523656);}}),router[a0_0x2891db(0xd9)](a0_0x2891db(0xf9),auth,async(_0x7ecf4a,_0x39f6bc)=>{var _0xdbc853=a0_0x2891db;try{const _0x184000=_0x7ecf4a[_0xdbc853(0xa4)]['id'],_0x243eeb=await sales_finished['findOne']({'_id':_0x7ecf4a[_0xdbc853(0xa4)]['id']}),_0x5d94ef=await warehouse[_0xdbc853(0xfa)]({'name':_0x243eeb[_0xdbc853(0x100)],'room':_0x7ecf4a[_0xdbc853(0xec)]['room'],'warehouse_category':_0xdbc853(0xb3)}),{invoice:_0x33e52c,customer:_0x2a758a,date:_0x59a428,warehouse_name:_0x215745,product_name:_0x37a10e,stock:_0x2787dd,adjust_qty:_0x19585d,note:_0x1e6757,room:_0x5bd138,primary_code:_0x56f226,secondary_code:_0x252399,prod_code:_0x11149b,level:_0x371003,isle:_0x3ed344,pallet:_0x46345c,expiry_date:_0x3bedf0}=_0x7ecf4a['body'];if(typeof _0x37a10e==_0xdbc853(0x106))var _0x1b6145=[_0x7ecf4a[_0xdbc853(0xec)][_0xdbc853(0xc4)]],_0x292829=[_0x7ecf4a[_0xdbc853(0xec)]['stock']],_0x208783=[_0x7ecf4a[_0xdbc853(0xec)][_0xdbc853(0x76)]],_0x13ac51=[_0x7ecf4a[_0xdbc853(0xec)][_0xdbc853(0xbb)]],_0x506175=[_0x7ecf4a[_0xdbc853(0xec)][_0xdbc853(0x177)]],_0x7dad73=[_0x7ecf4a[_0xdbc853(0xec)]['prod_code']],_0x4e8989=[_0x7ecf4a['body'][_0xdbc853(0xee)]],_0x3fb296=[_0x7ecf4a['body'][_0xdbc853(0x103)]];else var _0x1b6145=[..._0x7ecf4a[_0xdbc853(0xec)]['product_name']],_0x292829=[..._0x7ecf4a[_0xdbc853(0xec)]['stock']],_0x208783=[..._0x7ecf4a[_0xdbc853(0xec)][_0xdbc853(0x76)]],_0x13ac51=[..._0x7ecf4a[_0xdbc853(0xec)][_0xdbc853(0xbb)]],_0x506175=[..._0x7ecf4a[_0xdbc853(0xec)][_0xdbc853(0x177)]],_0x7dad73=[..._0x7ecf4a['body'][_0xdbc853(0x133)]],_0x4e8989=[..._0x7ecf4a[_0xdbc853(0xec)]['level']],_0x3fb296=[..._0x7ecf4a[_0xdbc853(0xec)][_0xdbc853(0x103)]];const _0x356eb3=_0x1b6145[_0xdbc853(0xe5)](_0x4719aa=>{return _0x4719aa={'product_name':_0x4719aa};});_0x292829[_0xdbc853(0x94)]((_0x25d831,_0x556b0a)=>{var _0x4dbe05=_0xdbc853;_0x356eb3[_0x556b0a][_0x4dbe05(0x129)]=_0x25d831;}),_0x208783['forEach']((_0x52cb28,_0x47cb15)=>{var _0x3ecebf=_0xdbc853;_0x356eb3[_0x47cb15][_0x3ecebf(0x83)]=_0x52cb28;}),_0x13ac51[_0xdbc853(0x94)]((_0x428dfc,_0x149e00)=>{var _0x2eebf3=_0xdbc853;_0x356eb3[_0x149e00][_0x2eebf3(0xbb)]=_0x428dfc;}),_0x506175['forEach']((_0x462bf6,_0x58c1b7)=>{var _0x17e965=_0xdbc853;_0x356eb3[_0x58c1b7][_0x17e965(0x177)]=_0x462bf6;}),_0x7dad73[_0xdbc853(0x94)]((_0x17f336,_0x5540fd)=>{var _0x5bf2a5=_0xdbc853;_0x356eb3[_0x5540fd][_0x5bf2a5(0x84)]=_0x17f336;}),_0x4e8989[_0xdbc853(0x94)]((_0x1f2b1d,_0x291302)=>{_0x356eb3[_0x291302]['level']=_0x1f2b1d;}),_0x3fb296[_0xdbc853(0x94)]((_0x23c2e0,_0x44cab5)=>{_0x356eb3[_0x44cab5]['expiry_date']=_0x23c2e0;});var _0x1802e6=0x0;_0x356eb3['forEach'](_0xef5e74=>{var _0x12e8f2=_0xdbc853;console['log'](_0x12e8f2(0x96),_0xef5e74),(parseInt(_0xef5e74['stock'])<parseInt(_0xef5e74[_0x12e8f2(0x83)])||parseInt(_0xef5e74[_0x12e8f2(0x83)])==0x0)&&_0x1802e6++;});if(_0x1802e6!=0x0)return _0x7ecf4a[_0xdbc853(0xcb)](_0xdbc853(0xe9),_0xdbc853(0x17c)),_0x39f6bc[_0xdbc853(0x14d)]('back');_0x243eeb[_0xdbc853(0x15b)]['forEach'](_0x309d92=>{var _0x57e7e7=_0xdbc853;const _0xdd93db=_0x5d94ef['product_details'][_0x57e7e7(0xe5)](_0x239490=>{var _0x2c1af4=_0x57e7e7;_0x239490['product_name']==_0x309d92['product_name']&&_0x239490['bay']==_0x309d92['bay']&&(_0x239490[_0x2c1af4(0xd8)]=parseInt(_0x239490[_0x2c1af4(0xd8)])+parseInt(_0x309d92[_0x2c1af4(0x83)]));});}),await _0x5d94ef[_0xdbc853(0xd1)]();const _0x24e0cd=_0x356eb3['filter'](_0x5aeca2=>_0x5aeca2['quantity']!=='0'&&_0x5aeca2[_0xdbc853(0x83)]!=='');_0x243eeb['invoice']=_0x33e52c,_0x243eeb[_0xdbc853(0x158)]=_0x2a758a,_0x243eeb[_0xdbc853(0x174)]=_0x59a428,_0x243eeb[_0xdbc853(0x100)]=_0x215745,_0x243eeb['sale_product']=_0x24e0cd,_0x243eeb['note']=_0x1e6757,_0x243eeb[_0xdbc853(0xe4)]=_0x5bd138;const _0x573eba=await _0x243eeb[_0xdbc853(0xd1)](),_0xeb0b0c=await sales_finished[_0xdbc853(0xfa)]({'_id':_0x7ecf4a[_0xdbc853(0xa4)]['id']}),_0x23a202=await warehouse[_0xdbc853(0xfa)]({'name':_0x215745,'room':_0x5bd138,'warehouse_category':_0xdbc853(0xb3)});_0xeb0b0c[_0xdbc853(0x15b)][_0xdbc853(0x94)](_0x15a074=>{var _0x26f4e7=_0xdbc853;const _0x5ebf38=_0x23a202[_0x26f4e7(0xcf)][_0x26f4e7(0xe5)](_0x36ab1b=>{var _0x5873f0=_0x26f4e7;_0x36ab1b[_0x5873f0(0xc4)]==_0x15a074[_0x5873f0(0xc4)]&&_0x36ab1b['bay']==_0x15a074[_0x5873f0(0xa5)]&&(_0x36ab1b[_0x5873f0(0xd8)]=parseInt(_0x36ab1b[_0x5873f0(0xd8)])-parseInt(_0x15a074[_0x5873f0(0x83)]));});}),console[_0xdbc853(0xaf)](_0xdbc853(0x7a),_0x23a202),await _0x23a202[_0xdbc853(0xd1)]();const _0x375ce5=await c_payment_data[_0xdbc853(0xfa)]({'invoice':_0x7ecf4a[_0xdbc853(0xec)][_0xdbc853(0x10e)]});_0x375ce5[_0xdbc853(0x148)]=_0x7ecf4a[_0xdbc853(0xec)][_0xdbc853(0x148)],await _0x375ce5[_0xdbc853(0xd1)](),_0x7ecf4a['flash']('success',_0xdbc853(0x166)),_0x39f6bc['redirect'](_0xdbc853(0x8d));}catch(_0x52faf9){console[_0xdbc853(0xaf)](_0x52faf9);}}),router[a0_0x2891db(0xd9)](a0_0x2891db(0x13b),auth,async(_0x251d67,_0x58404c)=>{var _0x1363c5=a0_0x2891db;try{const _0x2fa02f=_0x251d67[_0x1363c5(0xa4)]['id'],{invoice:_0x124925,customer:_0x4ac92e,receivable_amount:_0x812e19,received_amount:_0xa800c}=_0x251d67[_0x1363c5(0xec)],_0x17f0f3=await sales['findById'](_0x2fa02f);console[_0x1363c5(0xaf)](_0x17f0f3);var _0x59572f=_0x812e19-_0xa800c;console['log'](_0xa800c),_0x17f0f3[_0x1363c5(0x141)]=parseFloat(_0xa800c)+parseFloat(_0x17f0f3[_0x1363c5(0x141)]),_0x17f0f3[_0x1363c5(0xc9)]=_0x59572f,console[_0x1363c5(0xaf)](_0x17f0f3);const _0x4dc67a=await _0x17f0f3[_0x1363c5(0xd1)](),_0x1bd67b=await c_payment_data[_0x1363c5(0xfa)]({'invoice':_0x124925});_0x1bd67b[_0x1363c5(0x87)]=_0x59572f,await _0x1bd67b['save']();let _0x11e792=new Date(),_0x2e83f4=('0'+_0x11e792[_0x1363c5(0x140)]())[_0x1363c5(0x98)](-0x2),_0x1dc162=('0'+(_0x11e792[_0x1363c5(0x12a)]()+0x1))[_0x1363c5(0x98)](-0x2),_0x104c68=_0x11e792[_0x1363c5(0x14a)](),_0x5687b8=_0x104c68+'-'+_0x1dc162+'-'+_0x2e83f4;const _0x4f6bb9=new customer_payment({'invoice':_0x124925,'date':_0x104c68+'-'+_0x1dc162+'-'+_0x2e83f4,'customer':_0x4ac92e,'reason':_0x1363c5(0x175),'amount':_0xa800c}),_0x536bbc=await _0x4f6bb9[_0x1363c5(0xd1)]();_0x251d67[_0x1363c5(0xcb)](_0x1363c5(0x165),_0x1363c5(0x176)),_0x58404c[_0x1363c5(0x14d)](_0x1363c5(0x171));}catch(_0x372c32){console[_0x1363c5(0xaf)](_0x372c32);}}),router[a0_0x2891db(0xbf)](a0_0x2891db(0x119),auth,async(_0x526115,_0x2d9766)=>{var _0x245961=a0_0x2891db;try{const {username:_0x592633,email:_0x3c72ff,role:_0x5bf881}=_0x526115[_0x245961(0x153)],_0x23e75e=_0x526115['user'],_0xb4e14a=await profile[_0x245961(0xfa)]({'email':_0x23e75e[_0x245961(0x13d)]}),_0x187d0f=await master_shop[_0x245961(0x77)]();console['log'](_0x245961(0x108),_0x187d0f);const _0x14ebc2=_0x526115[_0x245961(0xa4)]['id'],_0x362cf7=await sales[_0x245961(0xd6)](_0x14ebc2);console[_0x245961(0xaf)](_0x362cf7);const _0x124ed8=await customer[_0x245961(0xfa)]({'name':_0x362cf7[_0x245961(0x158)]});console[_0x245961(0xaf)](_0x124ed8);if(_0x187d0f[0x0][_0x245961(0x157)]=='English\x20(US)'){var _0x48906d=users['English'];console['log'](_0x48906d);}else{if(_0x187d0f[0x0][_0x245961(0x157)]==_0x245961(0xb2))var _0x48906d=users['Hindi'];else{if(_0x187d0f[0x0][_0x245961(0x157)]==_0x245961(0x131))var _0x48906d=users[_0x245961(0x131)];else{if(_0x187d0f[0x0][_0x245961(0x157)]=='Spanish')var _0x48906d=users['Spanish'];else{if(_0x187d0f[0x0][_0x245961(0x157)]==_0x245961(0x121))var _0x48906d=users[_0x245961(0x121)];else{if(_0x187d0f[0x0][_0x245961(0x157)]==_0x245961(0x70))var _0x48906d=users['Portuguese'];else{if(_0x187d0f[0x0][_0x245961(0x157)]==_0x245961(0x130))var _0x48906d=users[_0x245961(0x130)];else{if(_0x187d0f[0x0][_0x245961(0x157)]=='Arabic\x20(ae)')var _0x48906d=users['Arabic'];}}}}}}}_0x2d9766['render'](_0x245961(0x173),{'success':_0x526115[_0x245961(0xcb)](_0x245961(0x165)),'errors':_0x526115[_0x245961(0xcb)](_0x245961(0xe9)),'role':_0x23e75e,'profile':_0xb4e14a,'master_shop':_0x187d0f,'customers':_0x124ed8,'sales':_0x362cf7,'language':_0x48906d});}catch(_0x569a16){console['log'](_0x569a16);}}),router[a0_0x2891db(0xbf)](a0_0x2891db(0xdf),auth,async(_0x301429,_0xf503bd)=>{var _0x30e49f=a0_0x2891db;try{const {username:_0x559041,email:_0x507fc0,role:_0x30c648}=_0x301429[_0x30e49f(0x153)],_0x49bd41=_0x301429['user'],_0x22ddc4=await profile[_0x30e49f(0xfa)]({'email':_0x49bd41[_0x30e49f(0x13d)]}),_0x32332b=await master_shop[_0x30e49f(0x77)](),_0x1dc038=_0x301429[_0x30e49f(0xa4)]['id'],_0x555980=await sales_finished[_0x30e49f(0xd6)](_0x1dc038),_0x470bd4=await warehouse['aggregate']([{'$match':{'name':_0x555980[_0x30e49f(0x100)]}},{'$unwind':_0x30e49f(0xb0)},{'$group':{'_id':_0x30e49f(0xc8),'name':{'$first':_0x30e49f(0xe6)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x30e49f(0x8f)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x30e49f(0x155)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x30e49f(0x145)},'expiry_date':{'$first':_0x30e49f(0xd5)},'production_date':{'$first':_0x30e49f(0x128)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x30e49f(0x74)},'maxProducts':{'$first':_0x30e49f(0x135)},'batch_code':{'$first':_0x30e49f(0xb5)},'maxPerUnit':{'$first':_0x30e49f(0x78)}}}]),_0x3510cc=await product[_0x30e49f(0x77)]({}),_0x4d49af=await warehouse[_0x30e49f(0xdc)]([{'$match':{'status':_0x30e49f(0xc7),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x30e49f(0xb7),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x3580d5=[_0x30e49f(0x75)];const _0xc84bee=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':'Quality\x20Inspection'}},{'$group':{'_id':'$name','name':{'$first':_0x30e49f(0x11d)}}},{'$sort':{'name':0x1}}]);if(_0x32332b[0x0]['language']==_0x30e49f(0xbc)){var _0xc88d34=users[_0x30e49f(0x115)];console[_0x30e49f(0xaf)](_0xc88d34);}else{if(_0x32332b[0x0]['language']==_0x30e49f(0xb2))var _0xc88d34=users[_0x30e49f(0xb2)];else{if(_0x32332b[0x0][_0x30e49f(0x157)]==_0x30e49f(0x131))var _0xc88d34=users[_0x30e49f(0x131)];else{if(_0x32332b[0x0][_0x30e49f(0x157)]=='Spanish')var _0xc88d34=users[_0x30e49f(0x16c)];else{if(_0x32332b[0x0][_0x30e49f(0x157)]==_0x30e49f(0x121))var _0xc88d34=users[_0x30e49f(0x121)];else{if(_0x32332b[0x0][_0x30e49f(0x157)]==_0x30e49f(0x70))var _0xc88d34=users[_0x30e49f(0x14c)];else{if(_0x32332b[0x0]['language']==_0x30e49f(0x130))var _0xc88d34=users[_0x30e49f(0x130)];else{if(_0x32332b[0x0][_0x30e49f(0x157)]==_0x30e49f(0x7f))var _0xc88d34=users['Arabic'];}}}}}}}_0xf503bd['render']('return_sale_finished',{'success':_0x301429['flash'](_0x30e49f(0x165)),'errors':_0x301429['flash'](_0x30e49f(0xe9)),'role':_0x49bd41,'profile':_0x22ddc4,'user':_0x555980,'stock':_0x470bd4,'master_shop':_0x32332b,'unit':_0x3510cc,'language':_0xc88d34,'warehouses':_0x4d49af,'rooms':_0x3580d5,'warehouse_QA':_0xc84bee});}catch(_0x25737a){console['log'](_0x25737a),_0xf503bd[_0x30e49f(0x11c)](0xc8)[_0x30e49f(0x178)]({'message':_0x25737a[_0x30e49f(0x91)]});}}),router[a0_0x2891db(0xd9)](a0_0x2891db(0xdf),auth,async(_0xf29f72,_0x418a23)=>{var _0x54da7c=a0_0x2891db;if(_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x16b)]=='QA')try{const {invoice:_0x54e66b,date:_0x47ee42,warehouse_name:_0xf4af07,product_name:_0x298cde,primary_code:_0x308af6,secondary_code:_0x7a0f89,product_code:_0x3313b8,sales_quantity:_0x289e74,stocks:_0x8f971d,return_qty:_0x5ea4bf,Room_name:_0x1c3812,to_warehouse_name_QA:_0x3c510d,to_Room_name_QA:_0x5da257,note:_0x30bc57,for_categorize:_0x1651df,product_name_QA1:_0x1804cd}=_0xf29f72[_0x54da7c(0xec)];if(typeof _0x1804cd==_0x54da7c(0x106))var _0x3c3d63=[_0xf29f72['body']['product_name_QA1']],_0x3ecf88=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x86)]],_0x229a37=[_0xf29f72[_0x54da7c(0xec)]['secondary_code_QA']],_0x452049=[_0xf29f72['body'][_0x54da7c(0x7d)]],_0x5635b5=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x138)]],_0x25f065=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0xda)]],_0x3c594=[_0xf29f72[_0x54da7c(0xec)]['return_qty_QA']],_0x39784a=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x160)]],_0xa25f5a=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0xa2)]],_0x2e1edd=[_0xf29f72[_0x54da7c(0xec)]['batch_code_QA']],_0x457044=[_0xf29f72['body'][_0x54da7c(0x7c)]],_0x306df6=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x179)]],_0x28f23a=[_0xf29f72[_0x54da7c(0xec)]['production_date_QA']],_0x4814d7=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x107)]];else var _0x3c3d63=[..._0xf29f72['body'][_0x54da7c(0xd7)]],_0x3ecf88=[..._0xf29f72[_0x54da7c(0xec)]['primary_code_QA']],_0x229a37=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x82)]],_0x452049=[..._0xf29f72['body']['product_code_QA']],_0x5635b5=[..._0xf29f72[_0x54da7c(0xec)]['sales_quantity_QA']],_0x25f065=[..._0xf29f72['body'][_0x54da7c(0xda)]],_0x3c594=[..._0xf29f72[_0x54da7c(0xec)]['return_qty_QA']],_0x39784a=[..._0xf29f72['body'][_0x54da7c(0x160)]],_0xa25f5a=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0xa2)]],_0x2e1edd=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0xc3)]],_0x457044=[..._0xf29f72[_0x54da7c(0xec)]['secondary_unit_QA']],_0x306df6=[..._0xf29f72[_0x54da7c(0xec)]['unit_QA']],_0x28f23a=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x180)]],_0x4814d7=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x107)]];const _0x1520eb=_0x3c3d63[_0x54da7c(0xe5)](_0x328b14=>{return _0x328b14={'product_name':_0x328b14};});_0x3ecf88[_0x54da7c(0x94)]((_0x25739e,_0x1f6a9a)=>{var _0x5b51ca=_0x54da7c;_0x1520eb[_0x1f6a9a][_0x5b51ca(0xbb)]=_0x25739e;}),_0x229a37[_0x54da7c(0x94)]((_0x3ffb46,_0x201bfc)=>{_0x1520eb[_0x201bfc]['secondary_code']=_0x3ffb46;}),_0x452049['forEach']((_0x2648f3,_0x49db33)=>{var _0x21c024=_0x54da7c;_0x1520eb[_0x49db33][_0x21c024(0x84)]=_0x2648f3;}),_0x5635b5[_0x54da7c(0x94)]((_0x1f9ca7,_0x3a1df6)=>{var _0x4831d2=_0x54da7c;_0x1520eb[_0x3a1df6][_0x4831d2(0x97)]=_0x1f9ca7;}),_0x25f065[_0x54da7c(0x94)]((_0x2518f7,_0x3fdf1e)=>{var _0x222c22=_0x54da7c;_0x1520eb[_0x3fdf1e][_0x222c22(0x129)]=_0x2518f7;}),_0x3c594['forEach']((_0x643aa7,_0x145cfb)=>{var _0xe146f3=_0x54da7c;_0x1520eb[_0x145cfb][_0xe146f3(0x111)]=_0x643aa7;}),_0x39784a[_0x54da7c(0x94)]((_0x5dcaf0,_0x554a79)=>{var _0x530c43=_0x54da7c;_0x1520eb[_0x554a79][_0x530c43(0x185)]=_0x5dcaf0;}),_0xa25f5a[_0x54da7c(0x94)]((_0x2d16e6,_0x14ea43)=>{var _0x21da3b=_0x54da7c;_0x1520eb[_0x14ea43][_0x21da3b(0xa6)]=_0x2d16e6;}),_0x2e1edd[_0x54da7c(0x94)]((_0x2cabb7,_0x2c2361)=>{var _0x29d112=_0x54da7c;_0x1520eb[_0x2c2361][_0x29d112(0xb8)]=_0x2cabb7;}),_0x457044[_0x54da7c(0x94)]((_0x19cfa1,_0x59f88b)=>{var _0x1b1142=_0x54da7c;_0x1520eb[_0x59f88b][_0x1b1142(0x120)]=_0x19cfa1;}),_0x306df6['forEach']((_0x1f3783,_0x41e58b)=>{_0x1520eb[_0x41e58b]['unit']=_0x1f3783;}),_0x28f23a[_0x54da7c(0x94)]((_0x3480bd,_0x3bdf3d)=>{var _0x5541ed=_0x54da7c;_0x1520eb[_0x3bdf3d][_0x5541ed(0x73)]=_0x3480bd;}),_0x4814d7[_0x54da7c(0x94)]((_0x23d42a,_0x4ab5e9)=>{_0x1520eb[_0x4ab5e9]['expiry_date']=_0x23d42a;});const _0x2236e4=await sales_finished[_0x54da7c(0xfa)]({'invoice':_0x54e66b});_0x2236e4[_0x54da7c(0xeb)]='True';const _0x3cfb01=await _0x2236e4[_0x54da7c(0xd1)](),_0x35ed0d=new sales_return_finished({'invoice':_0x54e66b,'customer':_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x158)],'date':_0x47ee42,'warehouse_name':_0xf4af07,'room':_0x1c3812,'ToWarehouse':_0x3c510d,'ToRoom':_0x5da257,'return_sale_QA':_0x1520eb,'note':_0x30bc57,'warehouse_cat':_0x1651df}),_0x106eec=await _0x35ed0d[_0x54da7c(0xd1)](),_0x314995=await sales_return_finished['findOne']({'invoice':_0x54e66b}),_0x7d1f74=await warehouse[_0x54da7c(0xfa)]({'name':_0x3c510d,'room':_0x5da257});_0x314995['return_sale_QA'][_0x54da7c(0x94)](_0x3fadaf=>{var _0x170569=_0x54da7c,_0x1ac6fd=0x0;const _0x834c9f=_0x7d1f74['product_details'][_0x170569(0xe5)](_0x2a6dd3=>{var _0x14b664=_0x170569;_0x2a6dd3['product_name']==_0x3fadaf[_0x14b664(0xc4)]&&_0x2a6dd3[_0x14b664(0x103)]==_0x3fadaf[_0x14b664(0x103)]&&_0x2a6dd3[_0x14b664(0x73)]==_0x3fadaf[_0x14b664(0x73)]&&_0x2a6dd3[_0x14b664(0xb8)]==_0x3fadaf[_0x14b664(0xb8)]&&(_0x2a6dd3[_0x14b664(0xd8)]=parseInt(_0x2a6dd3[_0x14b664(0xd8)])+parseInt(_0x3fadaf[_0x14b664(0x111)]),_0x1ac6fd++);});_0x1ac6fd=='0'&&(_0x7d1f74[_0x170569(0xcf)]=_0x7d1f74[_0x170569(0xcf)][_0x170569(0x181)]({'product_name':_0x3fadaf[_0x170569(0xc4)],'product_stock':_0x3fadaf[_0x170569(0x111)],'primary_code':_0x3fadaf[_0x170569(0xbb)],'secondary_code':_0x3fadaf[_0x170569(0x177)],'product_code':_0x3fadaf['product_code'],'batch_code':_0x3fadaf['batch_code'],'maxPerUnit':_0x3fadaf[_0x170569(0x185)],'production_date':_0x3fadaf[_0x170569(0x73)],'expiry_date':_0x3fadaf[_0x170569(0x103)],'secondary_unit':_0x3fadaf['secondary_unit'],'unit':_0x3fadaf[_0x170569(0x122)],'maxProducts':_0x3fadaf[_0x170569(0xa6)],'bay':_0x3fadaf[_0x170569(0xa5)]}));}),await _0x7d1f74[_0x54da7c(0xd1)]();const _0x1567ee=new c_payment_data({'invoice':_0x54e66b,'customer':_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x158)],'reason':'Sale\x20Return'});await _0x1567ee[_0x54da7c(0xd1)]();const _0x3e1eaf=await master_shop[_0x54da7c(0x77)](),_0x31933d=await email_settings['findOne'](),_0x512b56=await customer[_0x54da7c(0xfa)]({'name':_0xf29f72['body'][_0x54da7c(0x158)]});_0x3e1eaf[0x0]['currency_placement']==0x1?(right_currency=_0x3e1eaf[0x0][_0x54da7c(0x11a)],left_currency=''):(right_currency='',left_currency=_0x3e1eaf[0x0][_0x54da7c(0x11a)]);var _0x18cc1a=_0x3c3d63,_0x1f012e=_0x3c594,_0x1a7ce8='',_0x4696b0;for(_0x4696b0 in _0x18cc1a){_0x1a7ce8+=_0x54da7c(0xae)+_0x54da7c(0x15f)+_0x18cc1a[_0x4696b0]+_0x54da7c(0x150)+_0x54da7c(0x15f)+_0x1f012e[_0x4696b0]+_0x54da7c(0x150)+_0x54da7c(0x137);}console[_0x54da7c(0xaf)](_0x54da7c(0x9d),_0x1a7ce8);let _0x53bf00=nodemailer['createTransport']({'service':_0x54da7c(0x16d),'auth':{'user':_0x31933d[_0x54da7c(0x13d)],'pass':_0x31933d[_0x54da7c(0xb9)]}}),_0x59d961={'from':_0x31933d['email'],'to':_0x512b56[_0x54da7c(0x13d)],'subject':_0x54da7c(0xd3),'attachments':[{'filename':_0x54da7c(0x182),'path':__dirname+_0x54da7c(0xd2)+_0x54da7c(0x8a)+_0x3e1eaf[0x0][_0x54da7c(0xba)],'cid':_0x54da7c(0x93)}],'html':'<!DOCTYPE\x20html>'+_0x54da7c(0x17b)+_0x54da7c(0x186)+'<div>'+_0x54da7c(0xad)+_0x54da7c(0x90)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x54da7c(0x90)+'<h2>\x20'+_0x3e1eaf[0x0][_0x54da7c(0xa0)]+'\x20</h2>'+_0x54da7c(0x12c)+_0x54da7c(0x12c)+_0x54da7c(0x9f)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x54e66b+'\x20'+_0x54da7c(0x167)+'\x20Order\x20Date\x20:\x20'+_0x47ee42+'\x20'+_0x54da7c(0xe3)+_0x54da7c(0x159)+_0x54da7c(0x12c)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x54da7c(0x154)+_0x54da7c(0xae)+_0x54da7c(0x6f)+_0x54da7c(0x16e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x54da7c(0xfe)+_0x54da7c(0x137)+_0x54da7c(0xb4)+_0x54da7c(0x8b)+'\x20'+_0x1a7ce8+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x54da7c(0x12d)+_0x54da7c(0x187)+_0x3e1eaf[0x0][_0x54da7c(0xa0)]+'</h5>'+_0x54da7c(0x12c)+_0x54da7c(0x12c)+_0x54da7c(0xab)};_0x53bf00[_0x54da7c(0x161)](_0x59d961,function(_0x520382,_0x24f046){var _0x57040b=_0x54da7c;_0x520382?(console['log'](_0x520382),console['log']('Error\x20Occurs')):console[_0x57040b(0xaf)](_0x57040b(0x9e));}),_0xf29f72[_0x54da7c(0xcb)](_0x54da7c(0x165),_0x54da7c(0x80)),_0x418a23[_0x54da7c(0x14d)]('/all_sales_finished/view');}catch(_0x2f054c){_0x418a23['status'](0xc8)[_0x54da7c(0x178)]({'message1':_0x2f054c[_0x54da7c(0x91)]});}else{if(_0xf29f72[_0x54da7c(0xec)]['for_categorize']=='GS')try{const {invoice:_0x17a048,date:_0x1a4d28,warehouse_name:_0x162eee,product_name:_0x4115cb,primary_code:_0x208798,secondary_code:_0x52576c,product_code:_0x443d8c,sales_quantity:_0x29f09a,stocks:_0xddd29,return_qty:_0x58cb71,Room_name:_0x8c48b5,to_warehouse_name:_0x1b426e,to_Room_name:_0x22b297,note:_0x110a44,level:_0x66a3c5,isle:_0x4a42f6,pallet:_0x42791c,for_categorize:_0x17edcf}=_0xf29f72['body'];if(typeof _0x4115cb==_0x54da7c(0x106))var _0x3c3d63=[_0xf29f72['body'][_0x54da7c(0xc4)]],_0x3ecf88=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0xbb)]],_0x229a37=[_0xf29f72[_0x54da7c(0xec)]['secondary_code']],_0x452049=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x84)]],_0x5635b5=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x10b)]],_0x3c594=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x111)]],_0x112c59=[_0xf29f72['body']['bay']],_0x39784a=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x185)]],_0xa25f5a=[_0xf29f72[_0x54da7c(0xec)]['maxProducts']],_0x2e1edd=[_0xf29f72[_0x54da7c(0xec)]['batch_code']],_0x457044=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x120)]],_0x306df6=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x122)]],_0x28f23a=[_0xf29f72[_0x54da7c(0xec)]['production_date']],_0x4814d7=[_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x103)]];else var _0x3c3d63=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0xc4)]],_0x3ecf88=[..._0xf29f72['body'][_0x54da7c(0xbb)]],_0x229a37=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x177)]],_0x452049=[..._0xf29f72[_0x54da7c(0xec)]['product_code']],_0x5635b5=[..._0xf29f72['body'][_0x54da7c(0x10b)]],_0x3c594=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x111)]],_0x112c59=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0xa5)]],_0x39784a=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x185)]],_0xa25f5a=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0xa6)]],_0x2e1edd=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0xb8)]],_0x457044=[..._0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x120)]],_0x306df6=[..._0xf29f72['body']['unit']],_0x28f23a=[..._0xf29f72[_0x54da7c(0xec)]['production_date']],_0x4814d7=[..._0xf29f72['body'][_0x54da7c(0x103)]];const _0x1b1427=_0x3c3d63[_0x54da7c(0xe5)](_0x5b6c73=>{return _0x5b6c73={'product_name':_0x5b6c73};});_0x3ecf88[_0x54da7c(0x94)]((_0x4a2782,_0x333de3)=>{var _0x553118=_0x54da7c;_0x1b1427[_0x333de3][_0x553118(0xbb)]=_0x4a2782;}),_0x229a37['forEach']((_0x5a34f1,_0x57f823)=>{_0x1b1427[_0x57f823]['secondary_code']=_0x5a34f1;}),_0x452049[_0x54da7c(0x94)]((_0x47c03f,_0x2cc0f4)=>{var _0x2471c9=_0x54da7c;_0x1b1427[_0x2cc0f4][_0x2471c9(0x84)]=_0x47c03f;}),_0x5635b5[_0x54da7c(0x94)]((_0x37f8de,_0x38c98d)=>{var _0x260650=_0x54da7c;_0x1b1427[_0x38c98d][_0x260650(0x97)]=_0x37f8de;}),_0x3c594[_0x54da7c(0x94)]((_0x20b2e5,_0x5d1d10)=>{_0x1b1427[_0x5d1d10]['return_qty']=_0x20b2e5;}),_0x112c59['forEach']((_0x124be5,_0x1efd55)=>{var _0x322d9f=_0x54da7c;_0x1b1427[_0x1efd55][_0x322d9f(0xa5)]=_0x124be5;}),_0x39784a[_0x54da7c(0x94)]((_0x58da99,_0x5da8d8)=>{var _0x19e76f=_0x54da7c;_0x1b1427[_0x5da8d8][_0x19e76f(0x185)]=_0x58da99;}),_0xa25f5a['forEach']((_0x1ea9e8,_0x3cc05b)=>{var _0x945779=_0x54da7c;_0x1b1427[_0x3cc05b][_0x945779(0xa6)]=_0x1ea9e8;}),_0x2e1edd[_0x54da7c(0x94)]((_0xabe8e5,_0x2c6a1d)=>{var _0x24fd7f=_0x54da7c;_0x1b1427[_0x2c6a1d][_0x24fd7f(0xb8)]=_0xabe8e5;}),_0x457044[_0x54da7c(0x94)]((_0x480d90,_0x4f4837)=>{_0x1b1427[_0x4f4837]['secondary_unit']=_0x480d90;}),_0x306df6[_0x54da7c(0x94)]((_0x244ece,_0x535213)=>{var _0x54acfb=_0x54da7c;_0x1b1427[_0x535213][_0x54acfb(0x122)]=_0x244ece;}),_0x28f23a[_0x54da7c(0x94)]((_0x58d76b,_0x29637e)=>{var _0x2f1ea2=_0x54da7c;_0x1b1427[_0x29637e][_0x2f1ea2(0x73)]=_0x58d76b;}),_0x4814d7[_0x54da7c(0x94)]((_0x248b98,_0x42a86f)=>{var _0x3c6600=_0x54da7c;_0x1b1427[_0x42a86f][_0x3c6600(0x103)]=_0x248b98;});var _0xda22ad=0x0;_0x1b1427[_0x54da7c(0x94)](_0x30e28a=>{var _0x5113f0=_0x54da7c;(parseInt(_0x30e28a['sale_qty'])<parseInt(_0x30e28a[_0x5113f0(0x111)])||parseInt(_0x30e28a['stock'])<parseInt(_0x30e28a['return_qty'])&&parseInt(_0x30e28a[_0x5113f0(0x97)])>parseInt(_0x30e28a[_0x5113f0(0x111)])||parseInt(_0x30e28a[_0x5113f0(0x111)])==0x0)&&_0xda22ad++;});if(_0xda22ad!=0x0)return _0xf29f72[_0x54da7c(0xcb)](_0x54da7c(0xe9),_0x54da7c(0xf0)),_0x418a23[_0x54da7c(0x14d)](_0x54da7c(0xf5));const _0x3bc704=await sales_finished['findOne']({'invoice':_0x17a048});_0x3bc704[_0x54da7c(0xeb)]=_0x54da7c(0xd4);const _0x5a7267=await _0x3bc704[_0x54da7c(0xd1)](),_0x3dbd5d=new sales_return_finished({'invoice':_0x17a048,'customer':_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x158)],'date':_0x1a4d28,'warehouse_name':_0x162eee,'room':_0x8c48b5,'ToWarehouse':_0x1b426e,'ToRoom':_0x22b297,'return_sale':_0x1b1427,'note':_0x110a44,'warehouse_cat':_0x17edcf}),_0x448df2=await _0x3dbd5d[_0x54da7c(0xd1)](),_0x874e30=await sales_return_finished[_0x54da7c(0xfa)]({'invoice':_0x17a048}),_0x2f98a4=await warehouse[_0x54da7c(0xfa)]({'name':_0x1b426e,'room':_0x22b297,'warehouse_category':_0x54da7c(0xb3)});_0x874e30[_0x54da7c(0xcd)][_0x54da7c(0x94)](_0x302335=>{var _0x5d296f=_0x54da7c,_0x31a515=0x0;const _0x51a832=_0x2f98a4['product_details'][_0x5d296f(0xe5)](_0x36fab7=>{var _0x2d821e=_0x5d296f;_0x36fab7[_0x2d821e(0xc4)]==_0x302335['product_name']&&_0x36fab7[_0x2d821e(0xa5)]==_0x302335['bay']&&_0x36fab7[_0x2d821e(0x103)]==_0x302335[_0x2d821e(0x103)]&&_0x36fab7['production_date']==_0x302335[_0x2d821e(0x73)]&&_0x36fab7[_0x2d821e(0xb8)]==_0x302335[_0x2d821e(0xb8)]&&(_0x36fab7[_0x2d821e(0xd8)]=parseInt(_0x36fab7['product_stock'])+parseInt(_0x302335[_0x2d821e(0x111)]),_0x31a515++);});_0x31a515=='0'&&(_0x2f98a4[_0x5d296f(0xcf)]=_0x2f98a4[_0x5d296f(0xcf)]['concat']({'product_name':_0x302335[_0x5d296f(0xc4)],'product_stock':_0x302335[_0x5d296f(0x111)],'primary_code':_0x302335[_0x5d296f(0xbb)],'secondary_code':_0x302335[_0x5d296f(0x177)],'product_code':_0x302335[_0x5d296f(0x84)],'bay':_0x302335[_0x5d296f(0xa5)],'batch_code':_0x302335['batch_code'],'maxPerUnit':_0x302335[_0x5d296f(0x185)],'production_date':_0x302335[_0x5d296f(0x73)],'expiry_date':_0x302335[_0x5d296f(0x103)],'secondary_unit':_0x302335[_0x5d296f(0x120)],'unit':_0x302335[_0x5d296f(0x122)],'maxProducts':_0x302335['maxProducts']}));}),await _0x2f98a4[_0x54da7c(0xd1)](),console[_0x54da7c(0xaf)](_0xf29f72['body']);const _0x2547ab=new c_payment_data({'invoice':_0x17a048,'customer':_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x158)],'reason':_0x54da7c(0xc5)});await _0x2547ab[_0x54da7c(0xd1)]();const _0x1464ef=await master_shop[_0x54da7c(0x77)]();console['log'](_0x54da7c(0x113),_0x1464ef[0x0][_0x54da7c(0xba)]);const _0xad8689=await email_settings[_0x54da7c(0xfa)](),_0x1ef3db=await customer['findOne']({'name':_0xf29f72[_0x54da7c(0xec)][_0x54da7c(0x158)]});console[_0x54da7c(0xaf)](_0x54da7c(0xde),_0x1ef3db);_0x1464ef[0x0][_0x54da7c(0x9c)]==0x1?(right_currency=_0x1464ef[0x0][_0x54da7c(0x11a)],left_currency=''):(right_currency='',left_currency=_0x1464ef[0x0]['currency']);var _0x18cc1a=_0x3c3d63,_0x1f012e=_0x3c594,_0x1a7ce8='',_0x4696b0;for(_0x4696b0 in _0x18cc1a){_0x1a7ce8+='<tr>'+_0x54da7c(0x15f)+_0x18cc1a[_0x4696b0]+_0x54da7c(0x150)+_0x54da7c(0x15f)+_0x1f012e[_0x4696b0]+'</td>'+_0x54da7c(0x137);}console[_0x54da7c(0xaf)](_0x54da7c(0x9d),_0x1a7ce8);let _0x192ba9=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0xad8689['email'],'pass':_0xad8689[_0x54da7c(0xb9)]}}),_0x49ea0b={'from':_0xad8689[_0x54da7c(0x13d)],'to':_0x1ef3db[_0x54da7c(0x13d)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x54da7c(0x182),'path':__dirname+'/../public'+_0x54da7c(0x8a)+_0x1464ef[0x0][_0x54da7c(0xba)],'cid':_0x54da7c(0x93)}],'html':_0x54da7c(0x99)+'<html><head><title></title>'+_0x54da7c(0x186)+_0x54da7c(0x90)+_0x54da7c(0xad)+_0x54da7c(0x90)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x54da7c(0x12c)+_0x54da7c(0x90)+_0x54da7c(0x72)+_0x1464ef[0x0][_0x54da7c(0xa0)]+_0x54da7c(0xed)+_0x54da7c(0x12c)+_0x54da7c(0x12c)+_0x54da7c(0x9f)+'<div>'+_0x54da7c(0x8c)+_0x54da7c(0x11f)+_0x17a048+'\x20'+_0x54da7c(0x167)+_0x54da7c(0x11e)+_0x1a4d28+'\x20'+_0x54da7c(0xe3)+_0x54da7c(0x159)+_0x54da7c(0x12c)+_0x54da7c(0x105)+_0x54da7c(0x154)+_0x54da7c(0xae)+_0x54da7c(0x6f)+_0x54da7c(0x16e)+_0x54da7c(0x15a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x54da7c(0x137)+_0x54da7c(0xb4)+_0x54da7c(0x8b)+'\x20'+_0x1a7ce8+'\x20'+_0x54da7c(0x10d)+'</table>'+_0x54da7c(0x90)+_0x54da7c(0x12d)+_0x54da7c(0x187)+_0x1464ef[0x0][_0x54da7c(0xa0)]+_0x54da7c(0x159)+_0x54da7c(0x12c)+'</div>'+_0x54da7c(0xab)};_0x192ba9[_0x54da7c(0x161)](_0x49ea0b,function(_0x234c0f,_0x17dc3c){var _0x2b7aae=_0x54da7c;_0x234c0f?(console['log'](_0x234c0f),console[_0x2b7aae(0xaf)]('Error\x20Occurs')):console[_0x2b7aae(0xaf)](_0x2b7aae(0x9e));}),_0xf29f72[_0x54da7c(0xcb)](_0x54da7c(0x165),'sales\x20item\x20return\x20successfull'),_0x418a23['redirect']('/all_sales_finished/view');}catch(_0x6567d8){console[_0x54da7c(0xaf)](_0x6567d8),_0x418a23[_0x54da7c(0x11c)](0xc8)['json']({'message1':_0x6567d8[_0x54da7c(0x91)]});}}}),router[a0_0x2891db(0xbf)](a0_0x2891db(0x17a),auth,async(_0x5c58e9,_0x1e93c9)=>{var _0x4c5edf=a0_0x2891db;try{const {username:_0x407112,email:_0x3bdd6f,role:_0x332c0c}=_0x5c58e9[_0x4c5edf(0x153)],_0xc6ee13=_0x5c58e9[_0x4c5edf(0x153)],_0x300910=await profile['findOne']({'email':_0xc6ee13[_0x4c5edf(0x13d)]}),_0x50b563=await master_shop['find']();console[_0x4c5edf(0xaf)](_0x4c5edf(0xe2),_0x50b563);const _0x44885e=_0x5c58e9[_0x4c5edf(0xa4)]['id'],_0x587511=await sales[_0x4c5edf(0xd6)](_0x44885e);console[_0x4c5edf(0xaf)](_0x4c5edf(0x101),_0x587511);if(_0x50b563[0x0][_0x4c5edf(0x157)]==_0x4c5edf(0xbc))var _0x327de0=users[_0x4c5edf(0x115)];else{if(_0x50b563[0x0][_0x4c5edf(0x157)]=='Hindi')var _0x327de0=users[_0x4c5edf(0xb2)];else{if(_0x50b563[0x0][_0x4c5edf(0x157)]==_0x4c5edf(0x131))var _0x327de0=users[_0x4c5edf(0x131)];else{if(_0x50b563[0x0][_0x4c5edf(0x157)]==_0x4c5edf(0x16c))var _0x327de0=users[_0x4c5edf(0x16c)];else{if(_0x50b563[0x0]['language']==_0x4c5edf(0x121))var _0x327de0=users['French'];else{if(_0x50b563[0x0][_0x4c5edf(0x157)]==_0x4c5edf(0x70))var _0x327de0=users[_0x4c5edf(0x14c)];else{if(_0x50b563[0x0]['language']==_0x4c5edf(0x130))var _0x327de0=users[_0x4c5edf(0x130)];else{if(_0x50b563[0x0][_0x4c5edf(0x157)]==_0x4c5edf(0x7f))var _0x327de0=users['Arabic'];}}}}}}}_0x1e93c9[_0x4c5edf(0xaa)](_0x4c5edf(0x12b),{'success':_0x5c58e9['flash']('success'),'errors':_0x5c58e9[_0x4c5edf(0xcb)]('errors'),'role':_0xc6ee13,'profile':_0x300910,'alldata':_0x587511,'master_shop':_0x50b563,'language':_0x327de0});}catch(_0x6e0afb){console['log'](_0x6e0afb);}}),router[a0_0x2891db(0xd9)](a0_0x2891db(0xd0),async(_0x104343,_0x5bc076)=>{var _0x4dcdaa=a0_0x2891db;const {product_code:_0x323292,warehouse_name:_0x13f46d,rooms_data:_0x48d366,Roomslist:_0x36840c}=_0x104343[_0x4dcdaa(0xec)],_0x3765bc=_0x36840c[_0x4dcdaa(0x10f)](','),_0x4fc831=[];async function _0x52dd1b(_0x588fee){var _0x41bf5e=_0x4dcdaa;const _0x5d7b55=await warehouse[_0x41bf5e(0xdc)]([{'$match':{'name':_0x13f46d,'room':_0x588fee}},{'$unwind':_0x41bf5e(0xb0)},{'$match':{'product_details.primary_code':_0x323292}},{'$group':{'_id':_0x41bf5e(0xc8),'name':{'$first':_0x41bf5e(0xe6)},'product_stock':{'$first':_0x41bf5e(0xcc)},'primary_code':{'$first':_0x41bf5e(0x163)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x41bf5e(0x10c)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x41bf5e(0x134)},'type':{'$first':_0x41bf5e(0x155)},'pallet':{'$first':_0x41bf5e(0x14f)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x41bf5e(0x74)},'storage':{'$first':_0x41bf5e(0xc0)},'rack':{'$first':_0x41bf5e(0x145)},'expiry_date':{'$first':_0x41bf5e(0xd5)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x41bf5e(0x78)},'batch_code':{'$first':_0x41bf5e(0xb5)},'product_cat':{'$first':_0x41bf5e(0xef)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x41bf5e(0xc6)},'invoice':{'$first':_0x41bf5e(0xfc)}}}]),_0x4888c8=await warehouse['aggregate']([{'$match':{'name':_0x13f46d,'room':_0x588fee}},{'$unwind':_0x41bf5e(0xb0)},{'$match':{'product_details.secondary_code':_0x323292}},{'$group':{'_id':_0x41bf5e(0xc8),'name':{'$first':_0x41bf5e(0xe6)},'product_stock':{'$first':_0x41bf5e(0xcc)},'primary_code':{'$first':_0x41bf5e(0x163)},'secondary_code':{'$first':_0x41bf5e(0x7e)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x41bf5e(0x8f)},'isle':{'$first':_0x41bf5e(0x134)},'type':{'$first':_0x41bf5e(0x155)},'pallet':{'$first':_0x41bf5e(0x14f)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x41bf5e(0x74)},'storage':{'$first':_0x41bf5e(0xc0)},'rack':{'$first':_0x41bf5e(0x145)},'expiry_date':{'$first':_0x41bf5e(0xd5)},'production_date':{'$first':_0x41bf5e(0x128)},'maxPerUnit':{'$first':_0x41bf5e(0x78)},'batch_code':{'$first':_0x41bf5e(0xb5)},'product_cat':{'$first':_0x41bf5e(0xef)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x41bf5e(0xc6)},'invoice':{'$first':_0x41bf5e(0xfc)}}}]);if(_0x5d7b55[_0x41bf5e(0xf3)]>0x0)_0x4fc831[_0x41bf5e(0x14e)](_0x5d7b55);else _0x4888c8['length']>0x0&&_0x4fc831[_0x41bf5e(0x14e)](_0x4888c8);}const _0x1c7141=_0x3765bc[_0x4dcdaa(0xe5)](_0x3db455=>_0x52dd1b(_0x3db455));await Promise[_0x4dcdaa(0x15d)](_0x1c7141),_0x5bc076['json'](_0x4fc831);}),module[a0_0x2891db(0x109)]=router;