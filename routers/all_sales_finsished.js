var a0_0x1a7d8e=a0_0x4ba0;(function(_0x2e2720,_0x1d57ed){var _0x232f67=a0_0x4ba0,_0x1cf0f7=_0x2e2720();while(!![]){try{var _0x4fb088=-parseInt(_0x232f67(0x262))/0x1+-parseInt(_0x232f67(0x25e))/0x2*(parseInt(_0x232f67(0x2c6))/0x3)+-parseInt(_0x232f67(0x1fd))/0x4+-parseInt(_0x232f67(0x1b4))/0x5+-parseInt(_0x232f67(0x230))/0x6+-parseInt(_0x232f67(0x1d2))/0x7*(parseInt(_0x232f67(0x2c1))/0x8)+-parseInt(_0x232f67(0x2a3))/0x9*(-parseInt(_0x232f67(0x289))/0xa);if(_0x4fb088===_0x1d57ed)break;else _0x1cf0f7['push'](_0x1cf0f7['shift']());}catch(_0x3d8a30){_0x1cf0f7['push'](_0x1cf0f7['shift']());}}}(a0_0x51ad,0xb82c8));const express=require(a0_0x1a7d8e(0x1be)),app=express(),router=express[a0_0x1a7d8e(0x1d0)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x1a7d8e(0x1ed)),nodemailer=require(a0_0x1a7d8e(0x255)),users=require('../public/language/languages.json');function a0_0x4ba0(_0x297b74,_0xaa3804){var _0x51adb9=a0_0x51ad();return a0_0x4ba0=function(_0x4ba079,_0x4f022a){_0x4ba079=_0x4ba079-0x1b2;var _0x3f942a=_0x51adb9[_0x4ba079];return _0x3f942a;},a0_0x4ba0(_0x297b74,_0xaa3804);}function a0_0x51ad(){var _0x1f90a3=['production_date_QA','secondary_code','maxProducts_QA','$product_details.unit','$finalize','getFullYear','/view/return_sales/:id','</span>','$product_details.floorlevel','errors','product_code_QA','max_per_unit','$sale_product.bin','post','$customers_docs','secondary_unit_QA','message','return_qty_QA','QA\x20Warehouse','prod_code','$warehouse_name','site_title','sales_quantity','Sale\x20Product\x20Mail','../middleware/auth','push','<tbody\x20style=\x22text-align:\x20center;\x22>','slice','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Portuguese','product_code','Chinese','all','Enabled','invoice','<h2>\x20','/all_sales_finished/view','True','error','1791412TtfPaw','An\x20error\x20occurred.','get','<span\x20style=\x22float:\x20right;\x22>','quantity','Sale\x20Return','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/barcode_scanner','RoomAssigned','suppliers','warehouse','for_categorize','$product_details.secondary_unit','Sale','Logo.png','secondary_unit','getMonth','English\x20(US)','Arabic\x20(ae)','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','stock','$sale_product.floorlevel','product_name_QA1','forEach','foreach\x20newproduct','map','$product_details.primary_code','getDate','language','Spanish','sale_qty','$_id','render','string','received_amount','purchases_data','customers_docs','note','filter','French','$product_details.maxPerUnit','padStart','$sale_product.bay','amount','add\x20post','edit_sales_finished','sale_product','$product_details.product_name','$product_details.expiry_date','/../public','2914548ANrRnk','name','success','OUTF-','$product_details.bin','$product_details.product_stock','<table\x20style=\x22width:\x20100%\x20!important;\x22>','all_sales_finished','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$note','Hindi','toString','expiry_date','room_name','warehouse_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','currency','$product_details.production_date','port','return_data','$product_details.type','<div>','product','sales_invoice','staff','$product_details.batch_code','stocks_QA','unit','Finished\x20Goods','German','params','</head><body>','carton','prod_invoice','primary_unit','aggregate','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','json','find','<!DOCTYPE\x20html>','$sale_product.quantity','An\x20error\x20occurred\x20while\x20saving\x20data.','save','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','2bYeepC','barcode\x20user_id','\x20Order\x20Number\x20:\x20','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','652340iihPSi','<hr\x20class=\x22my-3\x22>','English','return_sale_finished','return_sale','sales_quantity_QA','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','back','$sale_product.type','master','image','currency_placement','date','gmail','product_details','room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','add_sales_finished','</h5>','Error\x20Occurs','user','edit_sales_finished_view','Return\x20Rooms','email','floor','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','DRY\x20GOODS','$product_details.bay','/invoice/:id','Enclosed','$product.product_name','Quality\x20Inspection','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$customer','$product_details','bay','100NKVKbd','return_qty','Arabic','stock_data','maxPerUnit','primary_code','</body></html>','$product_details.invoice','then','batch_code_QA','exports','findById','primary_code_QA','$product_details.product_code','False','customer','<h5\x20style=\x22text-align:\x20left;\x22>','<tr>','catch','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','payment\x20successfull','secondary_code_QA','length','product_stock','4321611otLENG','product_name','/view/add_sale/product','/barcode/:id','level','customer_data','Portuguese\x20(BR)','$product','$name','due_amount','sendMail','final','finalize','$product_details._id','production_date','barcode\x20Product\x20master','prod_cat','product_data','$product_details.storage','</div>','maxPerUnit_QA','</tr>','/upload/','Sales\x20Mail','$invoice','/view/:id','/view/add_sales','adjust_qty','$product_details.rack','logo','221216MIjpFK','$product_details.product_cat','Ambient','log','<strong>\x20Regards\x20</strong>','2910645zDoHDK','$sale_product','return_sale_QA','/all_sales_finished/preview/','split','3031920iSdPTY','batch_code','</thead>','concat','role','<html><head><title></title>','expiry_date_QA','Sales\x20Update\x20successfully','$return_data','sales\x20item\x20return\x20successfull','express','unit_QA','Received\x20Payment\x20For\x20Sale','body','product_list','customers','Email\x20sent\x20successfully','<h5>','status','</td>','flash','Return\x20Goods','maxProducts','$date','\x20Order\x20Date\x20:\x20','</tbody>','$product_details.maxProducts','$product_details.secondary_code','Router','findOne','224IOxutw','createTransport','$room'];a0_0x51ad=function(){return _0x1f90a3;};return a0_0x51ad();}router[a0_0x1a7d8e(0x1ff)]('/view',auth,async(_0x17d1b8,_0x37353a)=>{var _0x5de401=a0_0x1a7d8e;try{const {username:_0x50adee,email:_0x426dc6,role:_0x176ff7}=_0x17d1b8[_0x5de401(0x277)],_0x1a0dfe=_0x17d1b8['user'],_0x5a6d72=await profile[_0x5de401(0x1d1)]({'email':_0x1a0dfe['email']}),_0x172eba=await master_shop[_0x5de401(0x258)]();let _0x4bff5e;if(_0x1a0dfe[_0x5de401(0x1b8)]=='staff'){const _0x3ff5b4=await staff[_0x5de401(0x1d1)]({'email':_0x1a0dfe[_0x5de401(0x27a)]});_0x4bff5e=await sales_finished[_0x5de401(0x254)]([{'$lookup':{'from':'customers','localField':_0x5de401(0x298),'foreignField':_0x5de401(0x231),'as':_0x5de401(0x222)}},{'$unwind':_0x5de401(0x1e3)},{'$unwind':_0x5de401(0x2c7)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x5de401(0x1cb)},'warehouse_name':{'$first':_0x5de401(0x1e9)},'sale_product':{'$push':_0x5de401(0x2c7)},'note':{'$first':_0x5de401(0x23a)},'return_data':{'$first':_0x5de401(0x1bc)},'customers_docs':{'$first':_0x5de401(0x1e3)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x5de401(0x26b)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x5de401(0x1d9)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x4bff5e=await sales_finished[_0x5de401(0x254)]([{'$lookup':{'from':_0x5de401(0x1c3),'localField':_0x5de401(0x298),'foreignField':_0x5de401(0x231),'as':_0x5de401(0x222)}},{'$unwind':_0x5de401(0x1e3)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x5de401(0x21d),'invoice':{'$first':_0x5de401(0x2bb)},'customers':{'$first':_0x5de401(0x286)},'date':{'$first':_0x5de401(0x1cb)},'warehouse_name':{'$first':_0x5de401(0x1e9)},'sale_product':{'$push':_0x5de401(0x2c7)},'note':{'$first':'$note'},'return_data':{'$first':_0x5de401(0x1bc)},'customers_docs':{'$first':_0x5de401(0x1e3)},'total_saleproduct_quantity':{'$sum':_0x5de401(0x25a)},'level':{'$addToSet':_0x5de401(0x228)},'isle':{'$addToSet':_0x5de401(0x1e1)},'type':{'$addToSet':_0x5de401(0x26b)},'pallet':{'$addToSet':_0x5de401(0x213)},'finalize':{'$first':_0x5de401(0x1d9)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x172eba[0x0][_0x5de401(0x21a)]==_0x5de401(0x20e)){var _0x29d7bc=users[_0x5de401(0x264)];console[_0x5de401(0x2c4)](_0x29d7bc);}else{if(_0x172eba[0x0][_0x5de401(0x21a)]==_0x5de401(0x23b))var _0x29d7bc=users['Hindi'];else{if(_0x172eba[0x0][_0x5de401(0x21a)]=='German')var _0x29d7bc=users[_0x5de401(0x24e)];else{if(_0x172eba[0x0]['language']==_0x5de401(0x21b))var _0x29d7bc=users[_0x5de401(0x21b)];else{if(_0x172eba[0x0][_0x5de401(0x21a)]==_0x5de401(0x225))var _0x29d7bc=users[_0x5de401(0x225)];else{if(_0x172eba[0x0][_0x5de401(0x21a)]==_0x5de401(0x2a9))var _0x29d7bc=users['Portuguese'];else{if(_0x172eba[0x0]['language']==_0x5de401(0x1f5))var _0x29d7bc=users[_0x5de401(0x1f5)];else{if(_0x172eba[0x0]['language']==_0x5de401(0x20f))var _0x29d7bc=users[_0x5de401(0x28b)];}}}}}}}_0x37353a[_0x5de401(0x21e)](_0x5de401(0x237),{'success':_0x17d1b8[_0x5de401(0x1c8)](_0x5de401(0x232)),'errors':_0x17d1b8['flash'](_0x5de401(0x1de)),'sales':_0x4bff5e,'profile':_0x5a6d72,'role':_0x1a0dfe,'master_shop':_0x172eba,'language':_0x29d7bc});}catch(_0x13d933){console[_0x5de401(0x2c4)](_0x13d933);}});async function getRandom8DigitNumber(){var _0xc04092=a0_0x1a7d8e;const _0x58a60e=0x989680,_0x5ad4b2=0x5f5e0ff,_0x2d6e42=Math[_0xc04092(0x27b)](Math['random']()*(_0x5ad4b2-_0x58a60e+0x1))+_0x58a60e;var _0x4b164d;const _0x54bfb0=await sales_finished['findOne']({'invoice':_0xc04092(0x233)+_0x2d6e42});return _0x54bfb0&&_0x54bfb0[_0xc04092(0x2a1)]>0x0?_0x4b164d=_0xc04092(0x233)+_0x2d6e42:_0x4b164d=_0xc04092(0x233)+_0x2d6e42,_0x4b164d;}router[a0_0x1a7d8e(0x1ff)](a0_0x1a7d8e(0x2bd),auth,async(_0x101654,_0x18e706)=>{var _0x45132b=a0_0x1a7d8e;try{const {username:_0x5a8b6f,email:_0x5bc603,role:_0x8cbc95}=_0x101654[_0x45132b(0x277)],_0x494a16=_0x101654[_0x45132b(0x277)],_0x45b8ac=await profile[_0x45132b(0x1d1)]({'email':_0x494a16[_0x45132b(0x27a)]}),_0x16c631=await master_shop[_0x45132b(0x258)](),_0x4d05dc=await customer['find']({});let _0x2b765f;if(_0x494a16[_0x45132b(0x1b8)]=='staff'){const _0xc13797=await staff[_0x45132b(0x1d1)]({'email':_0x494a16['email']});_0x2b765f=await warehouse[_0x45132b(0x254)]([{'$match':{'status':_0x45132b(0x1f7),'name':_0xc13797[_0x45132b(0x207)],'warehouse_category':_0x45132b(0x24d),'name':{'$ne':_0x45132b(0x1e7)}}},{'$group':{'_id':'$name','name':{'$first':_0x45132b(0x2ab)}}},{'$sort':{'name':0x1}}]);}else _0x2b765f=await warehouse[_0x45132b(0x254)]([{'$match':{'status':_0x45132b(0x1f7),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x45132b(0x1e7)}}},{'$group':{'_id':_0x45132b(0x2ab),'name':{'$first':_0x45132b(0x2ab)}}},{'$sort':{'name':0x1}}]);const _0x1683c7=await product['find']({});var _0x453cc6=[_0x45132b(0x2c3),_0x45132b(0x280)];const _0x4a7974=await sales_finished[_0x45132b(0x258)]({}),_0x2fdc0a=_0x4a7974[_0x45132b(0x2a1)]+0x1,_0x43e45f='OUTF-'+_0x2fdc0a[_0x45132b(0x23c)]()[_0x45132b(0x227)](0x5,'0');if(_0x16c631[0x0][_0x45132b(0x21a)]==_0x45132b(0x20e)){var _0x3f08a1=users[_0x45132b(0x264)];console[_0x45132b(0x2c4)](_0x3f08a1);}else{if(_0x16c631[0x0][_0x45132b(0x21a)]==_0x45132b(0x23b))var _0x3f08a1=users[_0x45132b(0x23b)];else{if(_0x16c631[0x0][_0x45132b(0x21a)]=='German')var _0x3f08a1=users['German'];else{if(_0x16c631[0x0][_0x45132b(0x21a)]==_0x45132b(0x21b))var _0x3f08a1=users[_0x45132b(0x21b)];else{if(_0x16c631[0x0]['language']==_0x45132b(0x225))var _0x3f08a1=users[_0x45132b(0x225)];else{if(_0x16c631[0x0][_0x45132b(0x21a)]==_0x45132b(0x2a9))var _0x3f08a1=users[_0x45132b(0x1f3)];else{if(_0x16c631[0x0][_0x45132b(0x21a)]==_0x45132b(0x1f5))var _0x3f08a1=users[_0x45132b(0x1f5)];else{if(_0x16c631[0x0][_0x45132b(0x21a)]==_0x45132b(0x20f))var _0x3f08a1=users[_0x45132b(0x28b)];}}}}}}}const _0x32748d=getRandom8DigitNumber();_0x32748d[_0x45132b(0x291)](_0x4e6715=>{var _0x44099a=_0x45132b;_0x18e706[_0x44099a(0x21e)](_0x44099a(0x274),{'success':_0x101654[_0x44099a(0x1c8)]('success'),'errors':_0x101654['flash'](_0x44099a(0x1de)),'role':_0x494a16,'profile':_0x45b8ac,'customer':_0x4d05dc,'warehouse':_0x2b765f,'product':_0x1683c7,'invoice':_0x4e6715,'master_shop':_0x16c631,'language':_0x3f08a1,'rooms_data':_0x453cc6});})[_0x45132b(0x29b)](_0x17a85e=>{var _0x40c358=_0x45132b;_0x101654[_0x40c358(0x1c8)](_0x40c358(0x1de),_0x40c358(0x238)),_0x18e706['redirect'](_0x40c358(0x1fa));});}catch(_0x3f4a2c){console[_0x45132b(0x2c4)](_0x3f4a2c);}}),router[a0_0x1a7d8e(0x1ff)]('/view/add_sales/:id',auth,async(_0x24ad1f,_0x27fac9)=>{var _0xa64f68=a0_0x1a7d8e;try{const _0x534473=_0x24ad1f['params']['id'];console[_0xa64f68(0x2c4)](_0x534473);const _0x2d70d8=await product[_0xa64f68(0x258)](),_0x3c4c0e=await purchases[_0xa64f68(0x254)]([{'$match':{'warehouse_name':_0x534473}},{'$unwind':_0xa64f68(0x2aa)},{'$group':{'_id':_0xa64f68(0x281)}}]);console[_0xa64f68(0x2c4)](_0xa64f68(0x221),_0x3c4c0e),_0x27fac9[_0xa64f68(0x1c6)](0xc8)['json']({'purchases_data':_0x3c4c0e,'product_data':_0x2d70d8});}catch(_0x1e2ff5){console[_0xa64f68(0x2c4)](_0x1e2ff5);}}),router[a0_0x1a7d8e(0x1e2)](a0_0x1a7d8e(0x2a5),auth,async(_0x23ca0b,_0x5edd4b)=>{var _0x1ed659=a0_0x1a7d8e;try{const {warehouse_data:_0x34c7b7,product_data:_0x5c0d31}=_0x23ca0b[_0x1ed659(0x1c1)];console[_0x1ed659(0x2c4)](_0x23ca0b[_0x1ed659(0x1c1)][_0x1ed659(0x2b4)]);;const _0x2d5cea=await master_shop[_0x1ed659(0x258)]();console[_0x1ed659(0x2c4)]('master',_0x2d5cea);const _0xb876ec=await product['findOne']({'name':_0x5c0d31});console[_0x1ed659(0x2c4)](_0x1ed659(0x247),_0xb876ec);const _0x51021a=await warehouse[_0x1ed659(0x254)]([{'$match':{'name':_0x34c7b7}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x5c0d31}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x1ed659(0x2c4)](_0x1ed659(0x28c),_0x51021a),_0x5edd4b[_0x1ed659(0x1c6)](0xc8)[_0x1ed659(0x257)]({'master':_0x2d5cea,'new_product':_0xb876ec,'stock_data':_0x51021a});}catch(_0x40201a){console[_0x1ed659(0x2c4)](_0x40201a);}}),router[a0_0x1a7d8e(0x1e2)](a0_0x1a7d8e(0x2bd),auth,async(_0x24f9e5,_0x1d8c84)=>{var _0x170d18=a0_0x1a7d8e;try{const {invoice:_0x5ea2a0,date:_0x3d4170,warehouse_name:_0x5dd7a4,product_name:_0x5d5f10,stock:_0x2df426,quantity:_0x122a0c,note:_0x4f7ceb,room:_0x35e62c,primary_code:_0x2e1b2d,secondary_code:_0x515c0b,prod_code:_0x40b517,level:_0x7ac229,isle:_0x2c6c23,pallet:_0x4dd3ca,batch_code:_0xd1279d,SCRN:_0x57fe9c,expiry_date:_0x3efe45,mode_transpo:_0x5017d9,name_driver:_0x8bf449}=_0x24f9e5[_0x170d18(0x1c1)];if(typeof _0x5d5f10=='string')var _0x376759=[_0x24f9e5['body'][_0x170d18(0x2a4)]],_0x4b4d6a=[_0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x212)]],_0x27ab5a=[_0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x251)]],_0x208a82=[_0x24f9e5['body'][_0x170d18(0x28e)]],_0x31d92c=[_0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x1d6)]],_0x1f8703=[_0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x1e8)]],_0x3b2663=[_0x24f9e5['body'][_0x170d18(0x2a7)]],_0x30132d=[_0x24f9e5['body'][_0x170d18(0x253)]],_0x3eecd8=[_0x24f9e5['body'][_0x170d18(0x20c)]],_0x12a359=[_0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x1b5)]],_0x1c82dc=[_0x24f9e5[_0x170d18(0x1c1)]['expiry_date']],_0x971515=[_0x24f9e5[_0x170d18(0x1c1)]['product_date']],_0x48f3c8=[_0x24f9e5[_0x170d18(0x1c1)]['max_per_unit']],_0x38a0b3=[_0x24f9e5['body']['prod_cat']],_0x5806e4=[_0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x205)]],_0x89365c=[_0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x252)]];else var _0x376759=[..._0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x2a4)]],_0x4b4d6a=[..._0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x212)]],_0x27ab5a=[..._0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x251)]],_0x208a82=[..._0x24f9e5['body'][_0x170d18(0x28e)]],_0x31d92c=[..._0x24f9e5[_0x170d18(0x1c1)]['secondary_code']],_0x1f8703=[..._0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x1e8)]],_0x3b2663=[..._0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x2a7)]],_0x30132d=[..._0x24f9e5['body']['primary_unit']],_0x3eecd8=[..._0x24f9e5['body'][_0x170d18(0x20c)]],_0x12a359=[..._0x24f9e5['body'][_0x170d18(0x1b5)]],_0x1c82dc=[..._0x24f9e5[_0x170d18(0x1c1)]['expiry_date']],_0x971515=[..._0x24f9e5['body']['product_date']],_0x48f3c8=[..._0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x1e0)]],_0x38a0b3=[..._0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x2b3)]],_0x5806e4=[..._0x24f9e5[_0x170d18(0x1c1)]['RoomAssigned']],_0x89365c=[..._0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x252)]];const _0x676a06=_0x376759[_0x170d18(0x217)](_0x25d8c3=>{return _0x25d8c3={'product_name':_0x25d8c3};});_0x4b4d6a[_0x170d18(0x215)]((_0xc3b19a,_0x4744b4)=>{var _0x2e6127=_0x170d18;_0x676a06[_0x4744b4][_0x2e6127(0x212)]=_0xc3b19a;}),_0x27ab5a[_0x170d18(0x215)]((_0xaa1d78,_0x540dc0)=>{var _0x8cc50b=_0x170d18;_0x676a06[_0x540dc0][_0x8cc50b(0x201)]=_0xaa1d78;}),_0x208a82['forEach']((_0x57b9d2,_0x2f12eb)=>{_0x676a06[_0x2f12eb]['primary_code']=_0x57b9d2;}),_0x31d92c[_0x170d18(0x215)]((_0x35b8b0,_0x4028c0)=>{var _0xec1d19=_0x170d18;_0x676a06[_0x4028c0][_0xec1d19(0x1d6)]=_0x35b8b0;}),_0x1f8703['forEach']((_0x2d3955,_0x5d1ff5)=>{var _0x14f94b=_0x170d18;_0x676a06[_0x5d1ff5][_0x14f94b(0x1f4)]=_0x2d3955;}),_0x3b2663[_0x170d18(0x215)]((_0x3a560f,_0x1068c6)=>{var _0xaf6502=_0x170d18;_0x676a06[_0x1068c6][_0xaf6502(0x288)]=_0x3a560f;}),_0x30132d[_0x170d18(0x215)]((_0xcf7e5a,_0x49c461)=>{var _0x20ae60=_0x170d18;_0x676a06[_0x49c461][_0x20ae60(0x24c)]=_0xcf7e5a;}),_0x3eecd8[_0x170d18(0x215)]((_0xed04ca,_0x3a60e1)=>{var _0x148465=_0x170d18;_0x676a06[_0x3a60e1][_0x148465(0x20c)]=_0xed04ca;}),_0x12a359[_0x170d18(0x215)]((_0x16e4c9,_0x244367)=>{_0x676a06[_0x244367]['batch_code']=_0x16e4c9;}),_0x1c82dc[_0x170d18(0x215)]((_0x2287ee,_0x4ee49e)=>{var _0xaa4979=_0x170d18;_0x676a06[_0x4ee49e][_0xaa4979(0x23d)]=_0x2287ee;}),_0x971515[_0x170d18(0x215)]((_0x5b9727,_0xca66c5)=>{_0x676a06[_0xca66c5]['production_date']=_0x5b9727;}),_0x48f3c8['forEach']((_0x136700,_0x11404e)=>{_0x676a06[_0x11404e]['maxperunit']=_0x136700;}),_0x38a0b3['forEach']((_0x2e8ef7,_0x1a0d33)=>{var _0x4cb207=_0x170d18;_0x676a06[_0x1a0d33][_0x4cb207(0x2b3)]=_0x2e8ef7;}),_0x5806e4[_0x170d18(0x215)]((_0x2e3d71,_0x34f135)=>{var _0x2eaccf=_0x170d18;_0x676a06[_0x34f135][_0x2eaccf(0x23e)]=_0x2e3d71;}),_0x89365c[_0x170d18(0x215)]((_0x5a3f58,_0x47ab78)=>{var _0x3d6506=_0x170d18;_0x676a06[_0x47ab78][_0x3d6506(0x1f8)]=_0x5a3f58;});var _0x269ab6=0x0;_0x676a06[_0x170d18(0x215)](_0x251ae1=>{var _0x264732=_0x170d18;console['log'](_0x264732(0x216),_0x251ae1),(parseInt(_0x251ae1[_0x264732(0x212)])<parseInt(_0x251ae1[_0x264732(0x201)])||parseInt(_0x251ae1['quantity'])==0x0)&&_0x269ab6++;});if(_0x269ab6!=0x0)return _0x24f9e5[_0x170d18(0x1c8)](_0x170d18(0x1de),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x1d8c84[_0x170d18(0x210)]('back');const _0x2c7abb=_0x676a06[_0x170d18(0x224)](_0x55f0ff=>_0x55f0ff[_0x170d18(0x201)]!=='0'&&_0x55f0ff[_0x170d18(0x201)]!==''),_0x51d446=new sales_finished({'invoice':_0x5ea2a0,'customer':_0x24f9e5[_0x170d18(0x1c1)]['customer'],'date':_0x3d4170,'warehouse_name':_0x5dd7a4,'sale_product':_0x2c7abb,'note':_0x4f7ceb,'room':_0x35e62c,'primary_code':_0x2e1b2d,'secondary_code':_0x515c0b,'prod_code':_0x40b517,'SCRN':_0x57fe9c,'finalize':_0x170d18(0x297),'mode_transpo':_0x5017d9,'name_driver':_0x8bf449}),_0x23b6c3=await _0x51d446[_0x170d18(0x25c)](),_0x560480=await sales_finished[_0x170d18(0x1d1)]({'invoice':_0x5ea2a0}),_0xc6da41=new c_payment_data({'invoice':_0x5ea2a0,'customer':_0x24f9e5[_0x170d18(0x1c1)]['customer'],'reason':_0x170d18(0x20a)});await _0xc6da41[_0x170d18(0x25c)]();const _0x577a33=await master_shop[_0x170d18(0x258)](),_0x26b8d3=await email_settings['findOne'](),_0x2041f4=await customer[_0x170d18(0x1d1)]({'name':_0x24f9e5[_0x170d18(0x1c1)][_0x170d18(0x298)]});_0x577a33[0x0][_0x170d18(0x26e)]==0x1?(right_currency=_0x577a33[0x0][_0x170d18(0x241)],left_currency=''):(right_currency='',left_currency=_0x577a33[0x0][_0x170d18(0x241)]);var _0x37e15c=_0x376759,_0xe27c8b=_0x27ab5a,_0x2c4998='',_0x560983;for(_0x560983 in _0x37e15c){_0x2c4998+=_0x170d18(0x29a)+_0x170d18(0x29c)+_0x37e15c[_0x560983]+_0x170d18(0x1c7)+_0x170d18(0x29c)+_0xe27c8b[_0x560983]+_0x170d18(0x1c7)+_0x170d18(0x2b8);}console['log'](_0x170d18(0x1c2),_0x2c4998);let _0x50f45d=nodemailer[_0x170d18(0x1d3)]({'service':_0x170d18(0x270),'auth':{'user':_0x26b8d3[_0x170d18(0x27a)],'pass':_0x26b8d3[_0x170d18(0x283)]}}),_0x589730={'from':_0x26b8d3[_0x170d18(0x27a)],'to':_0x2041f4['email'],'subject':_0x170d18(0x1ec),'attachments':[{'filename':'Logo.png','path':__dirname+_0x170d18(0x22f)+_0x170d18(0x2b9)+_0x577a33[0x0][_0x170d18(0x26d)],'cid':_0x170d18(0x2c0)}],'html':_0x170d18(0x259)+'<html><head><title></title>'+_0x170d18(0x250)+_0x170d18(0x246)+_0x170d18(0x240)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x170d18(0x2b6)+_0x170d18(0x246)+_0x170d18(0x1f9)+_0x577a33[0x0][_0x170d18(0x1ea)]+_0x170d18(0x1f1)+_0x170d18(0x2b6)+_0x170d18(0x2b6)+_0x170d18(0x263)+_0x170d18(0x246)+_0x170d18(0x299)+_0x170d18(0x260)+_0x5ea2a0+'\x20'+_0x170d18(0x200)+_0x170d18(0x1cc)+_0x3d4170+'\x20'+_0x170d18(0x1dc)+_0x170d18(0x275)+_0x170d18(0x2b6)+_0x170d18(0x236)+_0x170d18(0x261)+'<tr>'+_0x170d18(0x239)+_0x170d18(0x256)+_0x170d18(0x2b8)+_0x170d18(0x1b6)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2c4998+'\x20'+'</tbody>'+_0x170d18(0x29d)+'<div>'+_0x170d18(0x2c5)+'<h5>'+_0x577a33[0x0]['site_title']+_0x170d18(0x275)+_0x170d18(0x2b6)+_0x170d18(0x2b6)+'</body></html>'};_0x50f45d[_0x170d18(0x2ad)](_0x589730,function(_0x38c067,_0x34e9b5){var _0x306e2a=_0x170d18;_0x38c067?(console[_0x306e2a(0x2c4)](_0x38c067),console[_0x306e2a(0x2c4)](_0x306e2a(0x276))):console['log'](_0x306e2a(0x1c4));}),_0x24f9e5[_0x170d18(0x1c8)]('success','Sales\x20Add\x20successfully'),_0x1d8c84['redirect'](_0x170d18(0x1b2)+_0x23b6c3['_id']);}catch(_0x19d562){console[_0x170d18(0x2c4)](_0x19d562);}}),router[a0_0x1a7d8e(0x1ff)](a0_0x1a7d8e(0x268),auth,async(_0x30c152,_0x3c73ed)=>{var _0x270e3a=a0_0x1a7d8e;try{const {username:_0x186da6,email:_0x385aa5,role:_0x60c69b}=_0x30c152['user'],_0x32e6cf=_0x30c152['user'],_0x32c096=await profile[_0x270e3a(0x1d1)]({'email':_0x32e6cf[_0x270e3a(0x27a)]}),_0x15ecb3=await master_shop[_0x270e3a(0x258)](),_0x394470=_0x30c152['params']['id'],_0x1af7de=await sales_finished[_0x270e3a(0x294)](_0x394470),_0x456d39=await warehouse[_0x270e3a(0x254)]([{'$match':{'name':_0x1af7de['warehouse_name']}},{'$unwind':_0x270e3a(0x287)},{'$group':{'_id':_0x270e3a(0x2b0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x270e3a(0x235)},'bay':{'$first':_0x270e3a(0x27e)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x270e3a(0x245)},'floorlevel':{'$first':_0x270e3a(0x1dd)},'primary_code':{'$first':_0x270e3a(0x218)},'secondary_code':{'$first':_0x270e3a(0x1cf)},'product_code':{'$first':_0x270e3a(0x296)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x270e3a(0x2bf)},'expiry_date':{'$first':_0x270e3a(0x22e)},'production_date':{'$first':_0x270e3a(0x242)},'batch_code':{'$first':_0x270e3a(0x24a)},'room':{'$first':_0x270e3a(0x1d4)}}}]),_0x2e0d44=await customer[_0x270e3a(0x258)]({});let _0x2cdf6d;if(_0x32e6cf[_0x270e3a(0x1b8)]==_0x270e3a(0x249)){const _0x325c5a=await staff[_0x270e3a(0x1d1)]({'email':_0x32e6cf['email']});_0x2cdf6d=await warehouse['aggregate']([{'$match':{'status':_0x270e3a(0x1f7),'name':_0x325c5a[_0x270e3a(0x207)]}},{'$group':{'_id':'$name','name':{'$first':_0x270e3a(0x2ab)}}}]);}else _0x2cdf6d=await warehouse[_0x270e3a(0x254)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x270e3a(0x2ab),'name':{'$first':_0x270e3a(0x2ab)}}}]);const _0x2ed206=await product[_0x270e3a(0x258)]({});if(_0x15ecb3[0x0]['language']==_0x270e3a(0x20e)){var _0x150c56=users['English'];console[_0x270e3a(0x2c4)](_0x150c56);}else{if(_0x15ecb3[0x0]['language']==_0x270e3a(0x23b))var _0x150c56=users['Hindi'];else{if(_0x15ecb3[0x0][_0x270e3a(0x21a)]==_0x270e3a(0x24e))var _0x150c56=users[_0x270e3a(0x24e)];else{if(_0x15ecb3[0x0][_0x270e3a(0x21a)]=='Spanish')var _0x150c56=users[_0x270e3a(0x21b)];else{if(_0x15ecb3[0x0][_0x270e3a(0x21a)]==_0x270e3a(0x225))var _0x150c56=users[_0x270e3a(0x225)];else{if(_0x15ecb3[0x0][_0x270e3a(0x21a)]==_0x270e3a(0x2a9))var _0x150c56=users[_0x270e3a(0x1f3)];else{if(_0x15ecb3[0x0][_0x270e3a(0x21a)]=='Chinese')var _0x150c56=users[_0x270e3a(0x1f5)];else{if(_0x15ecb3[0x0][_0x270e3a(0x21a)]==_0x270e3a(0x20f))var _0x150c56=users['Arabic'];}}}}}}}_0x3c73ed[_0x270e3a(0x21e)](_0x270e3a(0x278),{'success':_0x30c152[_0x270e3a(0x1c8)](_0x270e3a(0x232)),'errors':_0x30c152[_0x270e3a(0x1c8)](_0x270e3a(0x1de)),'role':_0x32e6cf,'profile':_0x32c096,'customer':_0x2e0d44,'warehouse':_0x2cdf6d,'product':_0x456d39,'user':_0x1af7de,'master_shop':_0x15ecb3,'unit':_0x2ed206,'language':_0x150c56});}catch(_0x9ffedc){console['log'](_0x9ffedc);}}),router[a0_0x1a7d8e(0x1e2)]('/preview/:id',auth,async(_0x1d082b,_0x1b33bc)=>{var _0x13c1cb=a0_0x1a7d8e;try{const _0x3d52ce=_0x1d082b[_0x13c1cb(0x24f)]['id'],{invoice:_0x10590e,warehouse_name:_0x55c691,room:_0x5e16fe}=_0x1d082b[_0x13c1cb(0x1c1)],_0x1e286c=await sales_finished[_0x13c1cb(0x1d1)]({'invoice':_0x10590e}),_0x36ebe7=_0x1e286c[_0x13c1cb(0x22c)]['map'](async _0x2d0d71=>{var _0x3a7b8a=_0x13c1cb,_0x1ac29e=await warehouse['findOne']({'name':_0x55c691,'room':_0x2d0d71[_0x3a7b8a(0x23e)],'warehouse_category':_0x3a7b8a(0x24d)});const _0x456117=_0x1ac29e[_0x3a7b8a(0x271)][_0x3a7b8a(0x217)](_0x366154=>{var _0xd73a26=_0x3a7b8a;_0x366154[_0xd73a26(0x2a4)]==_0x2d0d71[_0xd73a26(0x2a4)]&&_0x366154[_0xd73a26(0x288)]==_0x2d0d71['bay']&&_0x366154[_0xd73a26(0x23d)]==_0x2d0d71[_0xd73a26(0x23d)]&&_0x366154[_0xd73a26(0x2b1)]==_0x2d0d71[_0xd73a26(0x2b1)]&&_0x366154[_0xd73a26(0x1b5)]==_0x2d0d71['batch_code']&&_0x366154[_0xd73a26(0x1f8)]==_0x2d0d71[_0xd73a26(0x1f8)]&&(_0x366154['product_stock']=_0x366154[_0xd73a26(0x2a2)]-_0x2d0d71['quantity']);});return _0x1ac29e;});Promise[_0x13c1cb(0x1f6)](_0x36ebe7)[_0x13c1cb(0x291)](async _0xad478a=>{var _0x5649ba=_0x13c1cb;try{for(const _0x162db9 of _0xad478a){await _0x162db9['save']();}_0x1e286c[_0x5649ba(0x2af)]=_0x5649ba(0x1fb);const _0x1ca9c9=await _0x1e286c[_0x5649ba(0x25c)](),_0x7a666a=await master_shop[_0x5649ba(0x258)](),_0x1e6282=await email_settings[_0x5649ba(0x1d1)](),_0x235779=await supervisor_settings[_0x5649ba(0x258)]();var _0x201bb0=_0x1e286c[_0x5649ba(0x22c)],_0x1f2001='',_0x299389;for(_0x299389 in _0x201bb0){var _0x3009ba='FG';_0x1e286c[_0x5649ba(0x23f)]==_0x5649ba(0x27d)&&(_0x3009ba='DG'),_0x1f2001+=_0x5649ba(0x29a)+_0x5649ba(0x29c)+_0x201bb0[_0x299389]['product_name']+_0x5649ba(0x1c7)+_0x5649ba(0x29c)+_0x201bb0[_0x299389][_0x5649ba(0x1f4)]+_0x5649ba(0x1c7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x201bb0[_0x299389]['quantity']+'</td>'+_0x5649ba(0x29c)+_0x201bb0[_0x299389]['unit']+_0x5649ba(0x1c7)+_0x5649ba(0x29c)+_0x201bb0[_0x299389][_0x5649ba(0x20c)]+_0x5649ba(0x1c7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1e286c[_0x5649ba(0x23f)]+_0x5649ba(0x1c7)+_0x5649ba(0x29c)+_0x201bb0[_0x299389][_0x5649ba(0x23e)]+_0x5649ba(0x1c7)+_0x5649ba(0x29c)+_0x3009ba+_0x201bb0[_0x299389][_0x5649ba(0x288)]+_0x5649ba(0x1c7);}let _0x3d025e=nodemailer[_0x5649ba(0x1d3)]({'host':_0x1e6282['host'],'port':Number(_0x1e6282[_0x5649ba(0x243)]),'secure':![],'auth':{'user':_0x1e6282[_0x5649ba(0x27a)],'pass':_0x1e6282[_0x5649ba(0x283)]}}),_0x10fb95={'from':_0x1e6282[_0x5649ba(0x27a)],'to':_0x235779[0x0]['FGSEmail'],'subject':_0x5649ba(0x2ba),'attachments':[{'filename':_0x5649ba(0x20b),'path':__dirname+'/../public'+_0x5649ba(0x2b9)+_0x7a666a[0x0][_0x5649ba(0x26d)],'cid':_0x5649ba(0x2c0)}],'html':_0x5649ba(0x259)+'<html><head><title></title>'+_0x5649ba(0x250)+_0x5649ba(0x246)+_0x5649ba(0x240)+_0x5649ba(0x246)+_0x5649ba(0x285)+_0x5649ba(0x2b6)+_0x5649ba(0x246)+_0x5649ba(0x1f9)+_0x7a666a[0x0][_0x5649ba(0x1ea)]+'\x20</h2>'+_0x5649ba(0x2b6)+_0x5649ba(0x2b6)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x5649ba(0x299)+_0x5649ba(0x260)+_0x1e286c[_0x5649ba(0x1f8)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x5649ba(0x1cc)+_0x1e286c[_0x5649ba(0x26f)]+'\x20'+'</span>'+_0x5649ba(0x275)+'</div>'+_0x5649ba(0x236)+_0x5649ba(0x261)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5649ba(0x269)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x5649ba(0x203)+_0x5649ba(0x25d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x5649ba(0x284)+_0x5649ba(0x1f2)+_0x5649ba(0x2b8)+'</thead>'+_0x5649ba(0x1ef)+'\x20'+_0x1f2001+'\x20'+_0x5649ba(0x1cd)+'</table>'+'<div>'+_0x5649ba(0x2c5)+'<h5>'+_0x7a666a[0x0][_0x5649ba(0x1ea)]+'</h5>'+_0x5649ba(0x2b6)+_0x5649ba(0x2b6)+'</body></html>'};_0x3d025e['sendMail'](_0x10fb95,function(_0x1fb4ce,_0x45af8e){var _0x35f44b=_0x5649ba;_0x1fb4ce?(console['log'](_0x1fb4ce),console[_0x35f44b(0x2c4)](_0x35f44b(0x276))):console[_0x35f44b(0x2c4)]('Email\x20sent\x20successfully');}),_0x1d082b[_0x5649ba(0x1c8)](_0x5649ba(0x232),_0x5649ba(0x1bb)),_0x1b33bc[_0x5649ba(0x210)]('/picking_list/pdf/'+_0x3d52ce);}catch(_0x40ef99){console[_0x5649ba(0x1fc)](_0x40ef99),_0x1b33bc[_0x5649ba(0x1c6)](0x1f4)['json']({'error':_0x5649ba(0x25b)});}})[_0x13c1cb(0x29b)](_0x43252a=>{var _0x3b3112=_0x13c1cb;console[_0x3b3112(0x1fc)](_0x43252a),_0x1b33bc[_0x3b3112(0x1c6)](0x1f4)['json']({'error':_0x3b3112(0x1fe)});});}catch(_0x10e886){console[_0x13c1cb(0x2c4)](_0x10e886);}}),router[a0_0x1a7d8e(0x1ff)](a0_0x1a7d8e(0x2bc),auth,async(_0x218a50,_0x5662a1)=>{var _0x564569=a0_0x1a7d8e;try{const {username:_0x33886a,email:_0x399a49,role:_0x4c95e2}=_0x218a50[_0x564569(0x277)],_0x3f5d41=_0x218a50['user'],_0x12523f=await profile['findOne']({'email':_0x3f5d41[_0x564569(0x27a)]}),_0x438fe8=await master_shop['find'](),_0x15efbf=_0x218a50['params']['id'],_0x4edee5=await sales_finished[_0x564569(0x294)](_0x15efbf);let _0x3b2eb0=new Date(_0x4edee5[_0x564569(0x23d)]),_0x4cbd5d=('0'+_0x3b2eb0['getDate']())[_0x564569(0x1f0)](-0x2),_0x117583=('0'+(_0x3b2eb0[_0x564569(0x20d)]()+0x1))[_0x564569(0x1f0)](-0x2),_0x270dcb=_0x3b2eb0[_0x564569(0x1da)](),_0x399425=_0x270dcb+'-'+_0x117583+'-'+_0x4cbd5d;var _0x370047=[_0x564569(0x2c3),_0x564569(0x280)];const _0xefe765=await warehouse[_0x564569(0x254)]([{'$match':{'name':_0x4edee5[_0x564569(0x23f)],'room':_0x4edee5[_0x564569(0x272)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x564569(0x2b0),'name':{'$first':_0x564569(0x22d)},'product_stock':{'$first':_0x564569(0x235)},'bay':{'$first':_0x564569(0x27e)},'bin':{'$first':_0x564569(0x234)},'type':{'$first':_0x564569(0x245)},'floorlevel':{'$first':_0x564569(0x1dd)},'primary_code':{'$first':_0x564569(0x218)},'secondary_code':{'$first':_0x564569(0x1cf)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]),_0x4d2934=await customer[_0x564569(0x258)]({});let _0x1ec754;if(_0x3f5d41[_0x564569(0x1b8)]=='staff'){const _0x2c558f=await staff['findOne']({'email':_0x3f5d41['email']});_0x1ec754=await warehouse[_0x564569(0x254)]([{'$match':{'status':_0x564569(0x1f7),'name':_0x2c558f[_0x564569(0x207)]}},{'$group':{'_id':_0x564569(0x2ab),'name':{'$first':_0x564569(0x2ab)}}}]);}else _0x1ec754=await warehouse[_0x564569(0x254)]([{'$match':{'status':_0x564569(0x1f7)}},{'$group':{'_id':_0x564569(0x2ab),'name':{'$first':_0x564569(0x2ab)}}}]);const _0x2d3170=await product[_0x564569(0x258)]({});if(_0x438fe8[0x0]['language']==_0x564569(0x20e)){var _0x886c98=users[_0x564569(0x264)];console[_0x564569(0x2c4)](_0x886c98);}else{if(_0x438fe8[0x0]['language']=='Hindi')var _0x886c98=users[_0x564569(0x23b)];else{if(_0x438fe8[0x0][_0x564569(0x21a)]==_0x564569(0x24e))var _0x886c98=users[_0x564569(0x24e)];else{if(_0x438fe8[0x0][_0x564569(0x21a)]=='Spanish')var _0x886c98=users[_0x564569(0x21b)];else{if(_0x438fe8[0x0][_0x564569(0x21a)]==_0x564569(0x225))var _0x886c98=users['French'];else{if(_0x438fe8[0x0][_0x564569(0x21a)]==_0x564569(0x2a9))var _0x886c98=users[_0x564569(0x1f3)];else{if(_0x438fe8[0x0][_0x564569(0x21a)]=='Chinese')var _0x886c98=users['Chinese'];else{if(_0x438fe8[0x0][_0x564569(0x21a)]==_0x564569(0x20f))var _0x886c98=users[_0x564569(0x28b)];}}}}}}}_0x5662a1[_0x564569(0x21e)](_0x564569(0x22b),{'success':_0x218a50[_0x564569(0x1c8)](_0x564569(0x232)),'errors':_0x218a50[_0x564569(0x1c8)](_0x564569(0x1de)),'role':_0x3f5d41,'profile':_0x12523f,'customer':_0x4d2934,'warehouse':_0x1ec754,'product':_0xefe765,'user':_0x4edee5,'master_shop':_0x438fe8,'unit':_0x2d3170,'language':_0x886c98,'rooms_data':_0x370047,'ed_fullDate':_0x399425});}catch(_0x17e725){console[_0x564569(0x2c4)](_0x17e725);}}),router[a0_0x1a7d8e(0x1e2)](a0_0x1a7d8e(0x2bc),auth,async(_0x186dbe,_0x5da8fd)=>{var _0x53e838=a0_0x1a7d8e;try{const _0x4dfade=_0x186dbe[_0x53e838(0x24f)]['id'],_0x271082=await sales_finished[_0x53e838(0x1d1)]({'_id':_0x186dbe[_0x53e838(0x24f)]['id']}),_0x4695be=await warehouse['findOne']({'name':_0x271082['warehouse_name'],'room':_0x186dbe[_0x53e838(0x1c1)]['room'],'warehouse_category':_0x53e838(0x24d)}),{invoice:_0x137c7b,customer:_0x6e8301,date:_0x590c58,warehouse_name:_0xa4fd10,product_name:_0x4c7507,stock:_0x2378a0,adjust_qty:_0x161743,note:_0x398a2d,room:_0x44fc1c,primary_code:_0x376687,secondary_code:_0x465063,prod_code:_0x283266,level:_0x4e9f21,isle:_0x52ac62,pallet:_0x403fbd,expiry_date:_0xec5248}=_0x186dbe[_0x53e838(0x1c1)];if(typeof _0x4c7507=='string')var _0x5c9fd8=[_0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x2a4)]],_0x21dd07=[_0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x212)]],_0x55979c=[_0x186dbe['body']['adjust_qty']],_0x1f7ba6=[_0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x28e)]],_0x12f402=[_0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x1d6)]],_0x2a359e=[_0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x1e8)]],_0xaf0858=[_0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x2a7)]],_0x31f550=[_0x186dbe[_0x53e838(0x1c1)]['expiry_date']];else var _0x5c9fd8=[..._0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x2a4)]],_0x21dd07=[..._0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x212)]],_0x55979c=[..._0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x2be)]],_0x1f7ba6=[..._0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x28e)]],_0x12f402=[..._0x186dbe['body'][_0x53e838(0x1d6)]],_0x2a359e=[..._0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x1e8)]],_0xaf0858=[..._0x186dbe[_0x53e838(0x1c1)]['level']],_0x31f550=[..._0x186dbe[_0x53e838(0x1c1)]['expiry_date']];const _0x566dab=_0x5c9fd8[_0x53e838(0x217)](_0x531d01=>{return _0x531d01={'product_name':_0x531d01};});_0x21dd07[_0x53e838(0x215)]((_0x5b22af,_0x20b296)=>{var _0x4f374d=_0x53e838;_0x566dab[_0x20b296][_0x4f374d(0x212)]=_0x5b22af;}),_0x55979c['forEach']((_0x2ba126,_0x1a71dc)=>{_0x566dab[_0x1a71dc]['quantity']=_0x2ba126;}),_0x1f7ba6[_0x53e838(0x215)]((_0x16234c,_0xba6f9c)=>{_0x566dab[_0xba6f9c]['primary_code']=_0x16234c;}),_0x12f402[_0x53e838(0x215)]((_0x393b05,_0x4a6e4f)=>{var _0x4a9f9c=_0x53e838;_0x566dab[_0x4a6e4f][_0x4a9f9c(0x1d6)]=_0x393b05;}),_0x2a359e['forEach']((_0x3d855d,_0x1c23e6)=>{var _0x313810=_0x53e838;_0x566dab[_0x1c23e6][_0x313810(0x1f4)]=_0x3d855d;}),_0xaf0858[_0x53e838(0x215)]((_0x3041d2,_0x1afe6a)=>{var _0xd0059a=_0x53e838;_0x566dab[_0x1afe6a][_0xd0059a(0x2a7)]=_0x3041d2;}),_0x31f550['forEach']((_0x303446,_0x4561b6)=>{var _0x391943=_0x53e838;_0x566dab[_0x4561b6][_0x391943(0x23d)]=_0x303446;});var _0x118607=0x0;_0x566dab[_0x53e838(0x215)](_0xa0d9b5=>{var _0x42ec6a=_0x53e838;console[_0x42ec6a(0x2c4)](_0x42ec6a(0x216),_0xa0d9b5),(parseInt(_0xa0d9b5[_0x42ec6a(0x212)])<parseInt(_0xa0d9b5[_0x42ec6a(0x201)])||parseInt(_0xa0d9b5['quantity'])==0x0)&&_0x118607++;});if(_0x118607!=0x0)return _0x186dbe['flash'](_0x53e838(0x1de),_0x53e838(0x27c)),_0x5da8fd[_0x53e838(0x210)](_0x53e838(0x26a));_0x271082[_0x53e838(0x22c)][_0x53e838(0x215)](_0x2bf72f=>{var _0x4cf49a=_0x53e838;const _0x4d0b29=_0x4695be[_0x4cf49a(0x271)][_0x4cf49a(0x217)](_0x6112a7=>{var _0xaaebbd=_0x4cf49a;_0x6112a7[_0xaaebbd(0x2a4)]==_0x2bf72f[_0xaaebbd(0x2a4)]&&_0x6112a7['bay']==_0x2bf72f[_0xaaebbd(0x288)]&&(_0x6112a7[_0xaaebbd(0x2a2)]=parseInt(_0x6112a7['product_stock'])+parseInt(_0x2bf72f[_0xaaebbd(0x201)]));});}),await _0x4695be['save']();const _0x301c62=_0x566dab[_0x53e838(0x224)](_0x1fcdaf=>_0x1fcdaf['quantity']!=='0'&&_0x1fcdaf[_0x53e838(0x201)]!=='');_0x271082[_0x53e838(0x1f8)]=_0x137c7b,_0x271082[_0x53e838(0x298)]=_0x6e8301,_0x271082[_0x53e838(0x26f)]=_0x590c58,_0x271082[_0x53e838(0x23f)]=_0xa4fd10,_0x271082[_0x53e838(0x22c)]=_0x301c62,_0x271082[_0x53e838(0x223)]=_0x398a2d,_0x271082[_0x53e838(0x272)]=_0x44fc1c;const _0x563048=await _0x271082[_0x53e838(0x25c)](),_0x3b198e=await sales_finished[_0x53e838(0x1d1)]({'_id':_0x186dbe['params']['id']}),_0x44066b=await warehouse['findOne']({'name':_0xa4fd10,'room':_0x44fc1c,'warehouse_category':_0x53e838(0x24d)});_0x3b198e[_0x53e838(0x22c)]['forEach'](_0x4beff5=>{const _0x2479cc=_0x44066b['product_details']['map'](_0x54b352=>{var _0x41c464=a0_0x4ba0;_0x54b352[_0x41c464(0x2a4)]==_0x4beff5[_0x41c464(0x2a4)]&&_0x54b352[_0x41c464(0x288)]==_0x4beff5[_0x41c464(0x288)]&&(_0x54b352[_0x41c464(0x2a2)]=parseInt(_0x54b352[_0x41c464(0x2a2)])-parseInt(_0x4beff5[_0x41c464(0x201)]));});}),console['log'](_0x53e838(0x2ae),_0x44066b),await _0x44066b['save']();const _0x310026=await c_payment_data[_0x53e838(0x1d1)]({'invoice':_0x186dbe[_0x53e838(0x1c1)][_0x53e838(0x1f8)]});_0x310026[_0x53e838(0x206)]=_0x186dbe['body'][_0x53e838(0x206)],await _0x310026[_0x53e838(0x25c)](),_0x186dbe['flash'](_0x53e838(0x232),_0x53e838(0x1bb)),_0x5da8fd[_0x53e838(0x210)](_0x53e838(0x1fa));}catch(_0x5cd57b){console[_0x53e838(0x2c4)](_0x5cd57b);}}),router[a0_0x1a7d8e(0x1e2)]('/give_payment/:id',auth,async(_0x14708d,_0x2e8341)=>{var _0x55a537=a0_0x1a7d8e;try{const _0x1f88ca=_0x14708d['params']['id'],{invoice:_0x609016,customer:_0xf02199,receivable_amount:_0x2aff26,received_amount:_0x2f9dc4}=_0x14708d[_0x55a537(0x1c1)],_0x2e8fb3=await sales['findById'](_0x1f88ca);console['log'](_0x2e8fb3);var _0x4a9461=_0x2aff26-_0x2f9dc4;console['log'](_0x2f9dc4),_0x2e8fb3[_0x55a537(0x220)]=parseFloat(_0x2f9dc4)+parseFloat(_0x2e8fb3[_0x55a537(0x220)]),_0x2e8fb3[_0x55a537(0x2ac)]=_0x4a9461,console[_0x55a537(0x2c4)](_0x2e8fb3);const _0x556f0f=await _0x2e8fb3['save'](),_0x1b1530=await c_payment_data[_0x55a537(0x1d1)]({'invoice':_0x609016});_0x1b1530[_0x55a537(0x229)]=_0x4a9461,await _0x1b1530[_0x55a537(0x25c)]();let _0x11f2da=new Date(),_0x3847bc=('0'+_0x11f2da[_0x55a537(0x219)]())['slice'](-0x2),_0x299f10=('0'+(_0x11f2da['getMonth']()+0x1))[_0x55a537(0x1f0)](-0x2),_0x24d7ef=_0x11f2da[_0x55a537(0x1da)](),_0x361d2d=_0x24d7ef+'-'+_0x299f10+'-'+_0x3847bc;const _0x4f425a=new customer_payment({'invoice':_0x609016,'date':_0x24d7ef+'-'+_0x299f10+'-'+_0x3847bc,'customer':_0xf02199,'reason':_0x55a537(0x1c0),'amount':_0x2f9dc4}),_0x1b14ee=await _0x4f425a[_0x55a537(0x25c)]();_0x14708d[_0x55a537(0x1c8)](_0x55a537(0x232),_0x55a537(0x29f)),_0x2e8341[_0x55a537(0x210)]('/all_sales/view');}catch(_0x2c1fb1){console[_0x55a537(0x2c4)](_0x2c1fb1);}}),router['get'](a0_0x1a7d8e(0x27f),auth,async(_0x452477,_0x3401c5)=>{var _0x4246d8=a0_0x1a7d8e;try{const {username:_0x71146f,email:_0x55bf53,role:_0x504e19}=_0x452477[_0x4246d8(0x277)],_0x5d51da=_0x452477[_0x4246d8(0x277)],_0x336722=await profile[_0x4246d8(0x1d1)]({'email':_0x5d51da[_0x4246d8(0x27a)]}),_0x1e10ca=await master_shop[_0x4246d8(0x258)]();console['log'](_0x4246d8(0x26c),_0x1e10ca);const _0x3a1e59=_0x452477[_0x4246d8(0x24f)]['id'],_0x2b4960=await sales['findById'](_0x3a1e59);console[_0x4246d8(0x2c4)](_0x2b4960);const _0x4e2185=await customer[_0x4246d8(0x1d1)]({'name':_0x2b4960[_0x4246d8(0x298)]});console[_0x4246d8(0x2c4)](_0x4e2185);if(_0x1e10ca[0x0][_0x4246d8(0x21a)]=='English\x20(US)'){var _0x12dc8a=users[_0x4246d8(0x264)];console[_0x4246d8(0x2c4)](_0x12dc8a);}else{if(_0x1e10ca[0x0][_0x4246d8(0x21a)]==_0x4246d8(0x23b))var _0x12dc8a=users[_0x4246d8(0x23b)];else{if(_0x1e10ca[0x0][_0x4246d8(0x21a)]==_0x4246d8(0x24e))var _0x12dc8a=users[_0x4246d8(0x24e)];else{if(_0x1e10ca[0x0][_0x4246d8(0x21a)]=='Spanish')var _0x12dc8a=users[_0x4246d8(0x21b)];else{if(_0x1e10ca[0x0][_0x4246d8(0x21a)]==_0x4246d8(0x225))var _0x12dc8a=users[_0x4246d8(0x225)];else{if(_0x1e10ca[0x0][_0x4246d8(0x21a)]==_0x4246d8(0x2a9))var _0x12dc8a=users['Portuguese'];else{if(_0x1e10ca[0x0]['language']=='Chinese')var _0x12dc8a=users[_0x4246d8(0x1f5)];else{if(_0x1e10ca[0x0][_0x4246d8(0x21a)]==_0x4246d8(0x20f))var _0x12dc8a=users['Arabic'];}}}}}}}_0x3401c5[_0x4246d8(0x21e)](_0x4246d8(0x248),{'success':_0x452477[_0x4246d8(0x1c8)]('success'),'errors':_0x452477[_0x4246d8(0x1c8)](_0x4246d8(0x1de)),'role':_0x5d51da,'profile':_0x336722,'master_shop':_0x1e10ca,'customers':_0x4e2185,'sales':_0x2b4960,'language':_0x12dc8a});}catch(_0x46d631){console[_0x4246d8(0x2c4)](_0x46d631);}}),router[a0_0x1a7d8e(0x1ff)](a0_0x1a7d8e(0x1db),auth,async(_0x5a6c6e,_0x43bd53)=>{var _0x36164c=a0_0x1a7d8e;try{const {username:_0x2e3008,email:_0x163649,role:_0x1978e1}=_0x5a6c6e[_0x36164c(0x277)],_0x174f94=_0x5a6c6e[_0x36164c(0x277)],_0x4ad31e=await profile[_0x36164c(0x1d1)]({'email':_0x174f94[_0x36164c(0x27a)]}),_0x1e326f=await master_shop[_0x36164c(0x258)](),_0x47664d=_0x5a6c6e[_0x36164c(0x24f)]['id'],_0x120ccf=await sales_finished[_0x36164c(0x294)](_0x47664d),_0x3a3ace=await warehouse[_0x36164c(0x254)]([{'$match':{'name':_0x120ccf['warehouse_name']}},{'$unwind':_0x36164c(0x287)},{'$group':{'_id':_0x36164c(0x2b0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x36164c(0x234)},'type':{'$first':_0x36164c(0x245)},'floorlevel':{'$first':_0x36164c(0x1dd)},'primary_code':{'$first':_0x36164c(0x218)},'secondary_code':{'$first':_0x36164c(0x1cf)},'product_code':{'$first':_0x36164c(0x296)},'storage':{'$first':_0x36164c(0x2b5)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x36164c(0x22e)},'production_date':{'$first':_0x36164c(0x242)},'unit':{'$first':_0x36164c(0x1d8)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0x36164c(0x1ce)},'batch_code':{'$first':_0x36164c(0x24a)},'maxPerUnit':{'$first':_0x36164c(0x226)}}}]),_0x5e5c05=await product[_0x36164c(0x258)]({}),_0x2ba2b8=await warehouse[_0x36164c(0x254)]([{'$match':{'status':'Enabled','warehouse_category':_0x36164c(0x24d),'name':{'$ne':_0x36164c(0x1c9),'$ne':_0x36164c(0x282)}}},{'$group':{'_id':_0x36164c(0x2ab),'name':{'$first':_0x36164c(0x2ab)}}},{'$sort':{'name':0x1}}]);var _0x8bd36a=[_0x36164c(0x279)];const _0x541ccc=await warehouse[_0x36164c(0x254)]([{'$match':{'status':_0x36164c(0x1f7),'name':_0x36164c(0x282)}},{'$group':{'_id':_0x36164c(0x2ab),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x1e326f[0x0][_0x36164c(0x21a)]==_0x36164c(0x20e)){var _0x558755=users[_0x36164c(0x264)];console[_0x36164c(0x2c4)](_0x558755);}else{if(_0x1e326f[0x0]['language']=='Hindi')var _0x558755=users[_0x36164c(0x23b)];else{if(_0x1e326f[0x0][_0x36164c(0x21a)]=='German')var _0x558755=users[_0x36164c(0x24e)];else{if(_0x1e326f[0x0]['language']==_0x36164c(0x21b))var _0x558755=users['Spanish'];else{if(_0x1e326f[0x0][_0x36164c(0x21a)]==_0x36164c(0x225))var _0x558755=users[_0x36164c(0x225)];else{if(_0x1e326f[0x0][_0x36164c(0x21a)]==_0x36164c(0x2a9))var _0x558755=users[_0x36164c(0x1f3)];else{if(_0x1e326f[0x0]['language']==_0x36164c(0x1f5))var _0x558755=users[_0x36164c(0x1f5)];else{if(_0x1e326f[0x0][_0x36164c(0x21a)]==_0x36164c(0x20f))var _0x558755=users[_0x36164c(0x28b)];}}}}}}}_0x43bd53[_0x36164c(0x21e)](_0x36164c(0x265),{'success':_0x5a6c6e[_0x36164c(0x1c8)]('success'),'errors':_0x5a6c6e[_0x36164c(0x1c8)]('errors'),'role':_0x174f94,'profile':_0x4ad31e,'user':_0x120ccf,'stock':_0x3a3ace,'master_shop':_0x1e326f,'unit':_0x5e5c05,'language':_0x558755,'warehouses':_0x2ba2b8,'rooms':_0x8bd36a,'warehouse_QA':_0x541ccc});}catch(_0x2f85b5){console[_0x36164c(0x2c4)](_0x2f85b5),_0x43bd53[_0x36164c(0x1c6)](0xc8)[_0x36164c(0x257)]({'message':_0x2f85b5['message']});}}),router[a0_0x1a7d8e(0x1e2)](a0_0x1a7d8e(0x1db),auth,async(_0x4cce4e,_0x1eed7b)=>{var _0x34a103=a0_0x1a7d8e;if(_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x208)]=='QA')try{const {invoice:_0x3de230,date:_0x2e9b4b,warehouse_name:_0x38e258,product_name:_0x28db78,primary_code:_0x57de8a,secondary_code:_0x1756d7,product_code:_0x316523,sales_quantity:_0x598ebe,stocks:_0x8779e1,return_qty:_0x1d43ad,Room_name:_0x6c3a15,to_warehouse_name_QA:_0x16fffc,to_Room_name_QA:_0x2cb477,note:_0x466a1b,for_categorize:_0x4201a9,product_name_QA1:_0x186121}=_0x4cce4e[_0x34a103(0x1c1)];if(typeof _0x186121=='string')var _0x53fde3=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x214)]],_0x480283=[_0x4cce4e['body'][_0x34a103(0x295)]],_0x1b197f=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x2a0)]],_0xece11d=[_0x4cce4e['body'][_0x34a103(0x1df)]],_0x33a523=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x267)]],_0x2a5d09=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x24b)]],_0x4234f7=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1e6)]],_0xb68581=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x2b7)]],_0x5899fa=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1d7)]],_0x228359=[_0x4cce4e[_0x34a103(0x1c1)]['batch_code_QA']],_0x39063a=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1e4)]],_0x37d20d=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1bf)]],_0x835417=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1d5)]],_0x938cb6=[_0x4cce4e[_0x34a103(0x1c1)]['expiry_date_QA']];else var _0x53fde3=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x214)]],_0x480283=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x295)]],_0x1b197f=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x2a0)]],_0xece11d=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1df)]],_0x33a523=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x267)]],_0x2a5d09=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x24b)]],_0x4234f7=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1e6)]],_0xb68581=[..._0x4cce4e[_0x34a103(0x1c1)]['maxPerUnit_QA']],_0x5899fa=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1d7)]],_0x228359=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x292)]],_0x39063a=[..._0x4cce4e[_0x34a103(0x1c1)]['secondary_unit_QA']],_0x37d20d=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1bf)]],_0x835417=[..._0x4cce4e[_0x34a103(0x1c1)]['production_date_QA']],_0x938cb6=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1ba)]];const _0x152430=_0x53fde3['map'](_0x39b9eb=>{return _0x39b9eb={'product_name':_0x39b9eb};});_0x480283[_0x34a103(0x215)]((_0x5ef366,_0x55bdae)=>{var _0x175882=_0x34a103;_0x152430[_0x55bdae][_0x175882(0x28e)]=_0x5ef366;}),_0x1b197f['forEach']((_0x337f36,_0xef6629)=>{var _0x19151b=_0x34a103;_0x152430[_0xef6629][_0x19151b(0x1d6)]=_0x337f36;}),_0xece11d['forEach']((_0x5a237e,_0x1f3260)=>{_0x152430[_0x1f3260]['product_code']=_0x5a237e;}),_0x33a523[_0x34a103(0x215)]((_0xa3fd25,_0x254809)=>{var _0x12f055=_0x34a103;_0x152430[_0x254809][_0x12f055(0x21c)]=_0xa3fd25;}),_0x2a5d09[_0x34a103(0x215)]((_0x40dff4,_0x5a8790)=>{var _0x161981=_0x34a103;_0x152430[_0x5a8790][_0x161981(0x212)]=_0x40dff4;}),_0x4234f7['forEach']((_0x3cd4ef,_0x2ca7ad)=>{var _0x5ed4e7=_0x34a103;_0x152430[_0x2ca7ad][_0x5ed4e7(0x28a)]=_0x3cd4ef;}),_0xb68581[_0x34a103(0x215)]((_0x27eb85,_0x43979e)=>{var _0x52b3ad=_0x34a103;_0x152430[_0x43979e][_0x52b3ad(0x28d)]=_0x27eb85;}),_0x5899fa[_0x34a103(0x215)]((_0x5ed15f,_0x458e9d)=>{var _0x40d893=_0x34a103;_0x152430[_0x458e9d][_0x40d893(0x1ca)]=_0x5ed15f;}),_0x228359[_0x34a103(0x215)]((_0x31be71,_0x20aafe)=>{var _0x49d806=_0x34a103;_0x152430[_0x20aafe][_0x49d806(0x1b5)]=_0x31be71;}),_0x39063a[_0x34a103(0x215)]((_0x12d26f,_0x401295)=>{_0x152430[_0x401295]['secondary_unit']=_0x12d26f;}),_0x37d20d[_0x34a103(0x215)]((_0x350415,_0x114c8f)=>{var _0x4efa2e=_0x34a103;_0x152430[_0x114c8f][_0x4efa2e(0x24c)]=_0x350415;}),_0x835417[_0x34a103(0x215)]((_0x333f42,_0x500d5b)=>{_0x152430[_0x500d5b]['production_date']=_0x333f42;}),_0x938cb6[_0x34a103(0x215)]((_0x1e1e93,_0x29bfb1)=>{var _0x163ba5=_0x34a103;_0x152430[_0x29bfb1][_0x163ba5(0x23d)]=_0x1e1e93;});const _0x10b6fd=await sales_finished[_0x34a103(0x1d1)]({'invoice':_0x3de230});_0x10b6fd[_0x34a103(0x244)]=_0x34a103(0x1fb);const _0x351092=await _0x10b6fd[_0x34a103(0x25c)](),_0x143ff4=new sales_return_finished({'invoice':_0x3de230,'customer':_0x4cce4e['body'][_0x34a103(0x298)],'date':_0x2e9b4b,'warehouse_name':_0x38e258,'room':_0x6c3a15,'ToWarehouse':_0x16fffc,'ToRoom':_0x2cb477,'return_sale_QA':_0x152430,'note':_0x466a1b,'warehouse_cat':_0x4201a9}),_0x543e6b=await _0x143ff4['save'](),_0x216edf=await sales_return_finished[_0x34a103(0x1d1)]({'invoice':_0x3de230}),_0x2f82ac=await warehouse[_0x34a103(0x1d1)]({'name':_0x16fffc,'room':_0x2cb477});_0x216edf[_0x34a103(0x2c8)][_0x34a103(0x215)](_0x2f9278=>{var _0x40f121=_0x34a103,_0x255669=0x0;const _0x233f8d=_0x2f82ac[_0x40f121(0x271)][_0x40f121(0x217)](_0x421421=>{var _0x13fc0b=_0x40f121;_0x421421[_0x13fc0b(0x2a4)]==_0x2f9278[_0x13fc0b(0x2a4)]&&_0x421421[_0x13fc0b(0x23d)]==_0x2f9278[_0x13fc0b(0x23d)]&&_0x421421[_0x13fc0b(0x2b1)]==_0x2f9278[_0x13fc0b(0x2b1)]&&_0x421421[_0x13fc0b(0x1b5)]==_0x2f9278['batch_code']&&(_0x421421[_0x13fc0b(0x2a2)]=parseInt(_0x421421['product_stock'])+parseInt(_0x2f9278[_0x13fc0b(0x28a)]),_0x255669++);});_0x255669=='0'&&(_0x2f82ac[_0x40f121(0x271)]=_0x2f82ac[_0x40f121(0x271)][_0x40f121(0x1b7)]({'product_name':_0x2f9278['product_name'],'product_stock':_0x2f9278[_0x40f121(0x28a)],'primary_code':_0x2f9278[_0x40f121(0x28e)],'secondary_code':_0x2f9278[_0x40f121(0x1d6)],'product_code':_0x2f9278[_0x40f121(0x1f4)],'batch_code':_0x2f9278['batch_code'],'maxPerUnit':_0x2f9278[_0x40f121(0x28d)],'production_date':_0x2f9278[_0x40f121(0x2b1)],'expiry_date':_0x2f9278['expiry_date'],'secondary_unit':_0x2f9278['secondary_unit'],'unit':_0x2f9278['unit'],'maxProducts':_0x2f9278[_0x40f121(0x1ca)],'bay':_0x2f9278[_0x40f121(0x288)]}));}),await _0x2f82ac[_0x34a103(0x25c)]();const _0x115a88=new c_payment_data({'invoice':_0x3de230,'customer':_0x4cce4e[_0x34a103(0x1c1)]['customer'],'reason':'Sale\x20Return'});await _0x115a88[_0x34a103(0x25c)]();const _0x1edcbc=await master_shop['find'](),_0x104037=await email_settings['findOne'](),_0x3a497d=await customer[_0x34a103(0x1d1)]({'name':_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x298)]});_0x1edcbc[0x0][_0x34a103(0x26e)]==0x1?(right_currency=_0x1edcbc[0x0][_0x34a103(0x241)],left_currency=''):(right_currency='',left_currency=_0x1edcbc[0x0][_0x34a103(0x241)]);var _0x388932=_0x53fde3,_0x4f3a91=_0x4234f7,_0x347584='',_0x2750aa;for(_0x2750aa in _0x388932){_0x347584+='<tr>'+_0x34a103(0x29c)+_0x388932[_0x2750aa]+_0x34a103(0x1c7)+_0x34a103(0x29c)+_0x4f3a91[_0x2750aa]+'</td>'+_0x34a103(0x2b8);}console[_0x34a103(0x2c4)](_0x34a103(0x1c2),_0x347584);let _0x47ec8a=nodemailer['createTransport']({'service':_0x34a103(0x270),'auth':{'user':_0x104037['email'],'pass':_0x104037['password']}}),_0x1ef7c5={'from':_0x104037[_0x34a103(0x27a)],'to':_0x3a497d[_0x34a103(0x27a)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x34a103(0x20b),'path':__dirname+_0x34a103(0x22f)+_0x34a103(0x2b9)+_0x1edcbc[0x0][_0x34a103(0x26d)],'cid':'logo'}],'html':_0x34a103(0x259)+_0x34a103(0x1b9)+_0x34a103(0x250)+'<div>'+_0x34a103(0x240)+_0x34a103(0x246)+_0x34a103(0x285)+_0x34a103(0x2b6)+'<div>'+_0x34a103(0x1f9)+_0x1edcbc[0x0][_0x34a103(0x1ea)]+_0x34a103(0x1f1)+_0x34a103(0x2b6)+_0x34a103(0x2b6)+_0x34a103(0x263)+_0x34a103(0x246)+_0x34a103(0x299)+_0x34a103(0x260)+_0x3de230+'\x20'+_0x34a103(0x200)+_0x34a103(0x1cc)+_0x2e9b4b+'\x20'+_0x34a103(0x1dc)+_0x34a103(0x275)+_0x34a103(0x2b6)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x34a103(0x261)+'<tr>'+_0x34a103(0x239)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x34a103(0x29e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x34a103(0x2b8)+'</thead>'+_0x34a103(0x1ef)+'\x20'+_0x347584+'\x20'+_0x34a103(0x1cd)+_0x34a103(0x29d)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x1edcbc[0x0][_0x34a103(0x1ea)]+_0x34a103(0x275)+_0x34a103(0x2b6)+_0x34a103(0x2b6)+_0x34a103(0x28f)};_0x47ec8a[_0x34a103(0x2ad)](_0x1ef7c5,function(_0x1ec1a0,_0x17a63c){var _0x392222=_0x34a103;_0x1ec1a0?(console[_0x392222(0x2c4)](_0x1ec1a0),console['log'](_0x392222(0x276))):console[_0x392222(0x2c4)](_0x392222(0x1c4));}),_0x4cce4e['flash']('success',_0x34a103(0x1bd)),_0x1eed7b['redirect'](_0x34a103(0x1fa));}catch(_0x17645b){_0x1eed7b['status'](0xc8)['json']({'message1':_0x17645b['message']});}else{if(_0x4cce4e[_0x34a103(0x1c1)]['for_categorize']=='GS')try{const {invoice:_0x149699,date:_0x1b6a74,warehouse_name:_0x40220e,product_name:_0x43d517,primary_code:_0xe56332,secondary_code:_0x371c3a,product_code:_0x596a06,sales_quantity:_0x5e1e28,stocks:_0x2ccc95,return_qty:_0xbe27,Room_name:_0x1ef2e3,to_warehouse_name:_0x54341e,to_Room_name:_0x5d5271,note:_0x1f84d6,level:_0x21058f,isle:_0x391643,pallet:_0x5b1c96,for_categorize:_0x2e85de}=_0x4cce4e[_0x34a103(0x1c1)];if(typeof _0x43d517==_0x34a103(0x21f))var _0x53fde3=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x2a4)]],_0x480283=[_0x4cce4e[_0x34a103(0x1c1)]['primary_code']],_0x1b197f=[_0x4cce4e[_0x34a103(0x1c1)]['secondary_code']],_0xece11d=[_0x4cce4e[_0x34a103(0x1c1)]['product_code']],_0x33a523=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1eb)]],_0x4234f7=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x28a)]],_0x1f3dbb=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x288)]],_0xb68581=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x28d)]],_0x5899fa=[_0x4cce4e['body'][_0x34a103(0x1ca)]],_0x228359=[_0x4cce4e[_0x34a103(0x1c1)]['batch_code']],_0x39063a=[_0x4cce4e[_0x34a103(0x1c1)]['secondary_unit']],_0x37d20d=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x24c)]],_0x835417=[_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x2b1)]],_0x938cb6=[_0x4cce4e[_0x34a103(0x1c1)]['expiry_date']];else var _0x53fde3=[..._0x4cce4e[_0x34a103(0x1c1)]['product_name']],_0x480283=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x28e)]],_0x1b197f=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1d6)]],_0xece11d=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1f4)]],_0x33a523=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1eb)]],_0x4234f7=[..._0x4cce4e[_0x34a103(0x1c1)]['return_qty']],_0x1f3dbb=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x288)]],_0xb68581=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x28d)]],_0x5899fa=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x1ca)]],_0x228359=[..._0x4cce4e['body'][_0x34a103(0x1b5)]],_0x39063a=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x20c)]],_0x37d20d=[..._0x4cce4e[_0x34a103(0x1c1)]['unit']],_0x835417=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x2b1)]],_0x938cb6=[..._0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x23d)]];const _0x4e63d9=_0x53fde3[_0x34a103(0x217)](_0x59c84c=>{return _0x59c84c={'product_name':_0x59c84c};});_0x480283['forEach']((_0x39c2bd,_0x8dfdea)=>{var _0x379166=_0x34a103;_0x4e63d9[_0x8dfdea][_0x379166(0x28e)]=_0x39c2bd;}),_0x1b197f[_0x34a103(0x215)]((_0x3bc8ba,_0x1c7f6a)=>{var _0xd96138=_0x34a103;_0x4e63d9[_0x1c7f6a][_0xd96138(0x1d6)]=_0x3bc8ba;}),_0xece11d['forEach']((_0x243ba0,_0x3799f3)=>{_0x4e63d9[_0x3799f3]['product_code']=_0x243ba0;}),_0x33a523[_0x34a103(0x215)]((_0x535702,_0x331192)=>{var _0x54ce5c=_0x34a103;_0x4e63d9[_0x331192][_0x54ce5c(0x21c)]=_0x535702;}),_0x4234f7[_0x34a103(0x215)]((_0x5b7f15,_0x5f05bd)=>{var _0x35d53a=_0x34a103;_0x4e63d9[_0x5f05bd][_0x35d53a(0x28a)]=_0x5b7f15;}),_0x1f3dbb[_0x34a103(0x215)]((_0x43e7ee,_0x3721ab)=>{var _0x269b11=_0x34a103;_0x4e63d9[_0x3721ab][_0x269b11(0x288)]=_0x43e7ee;}),_0xb68581[_0x34a103(0x215)]((_0x2d6cf4,_0x4751bb)=>{var _0x1ff9a3=_0x34a103;_0x4e63d9[_0x4751bb][_0x1ff9a3(0x28d)]=_0x2d6cf4;}),_0x5899fa[_0x34a103(0x215)]((_0x4ff3af,_0x206b80)=>{var _0x4d40d0=_0x34a103;_0x4e63d9[_0x206b80][_0x4d40d0(0x1ca)]=_0x4ff3af;}),_0x228359['forEach']((_0x572e70,_0x635dfa)=>{var _0xa1dcd9=_0x34a103;_0x4e63d9[_0x635dfa][_0xa1dcd9(0x1b5)]=_0x572e70;}),_0x39063a[_0x34a103(0x215)]((_0x50e970,_0x10e7ed)=>{var _0x3baa11=_0x34a103;_0x4e63d9[_0x10e7ed][_0x3baa11(0x20c)]=_0x50e970;}),_0x37d20d[_0x34a103(0x215)]((_0xc4f757,_0x272b35)=>{var _0x9cb95=_0x34a103;_0x4e63d9[_0x272b35][_0x9cb95(0x24c)]=_0xc4f757;}),_0x835417[_0x34a103(0x215)]((_0x4dd23a,_0x396895)=>{var _0x3183a9=_0x34a103;_0x4e63d9[_0x396895][_0x3183a9(0x2b1)]=_0x4dd23a;}),_0x938cb6[_0x34a103(0x215)]((_0x53bc5f,_0x33dbf8)=>{var _0x19e344=_0x34a103;_0x4e63d9[_0x33dbf8][_0x19e344(0x23d)]=_0x53bc5f;});var _0xb645d5=0x0;_0x4e63d9[_0x34a103(0x215)](_0x195e0b=>{var _0x6752e8=_0x34a103;(parseInt(_0x195e0b[_0x6752e8(0x21c)])<parseInt(_0x195e0b[_0x6752e8(0x28a)])||parseInt(_0x195e0b[_0x6752e8(0x212)])<parseInt(_0x195e0b[_0x6752e8(0x28a)])&&parseInt(_0x195e0b['sale_qty'])>parseInt(_0x195e0b[_0x6752e8(0x28a)])||parseInt(_0x195e0b[_0x6752e8(0x28a)])==0x0)&&_0xb645d5++;});if(_0xb645d5!=0x0)return _0x4cce4e[_0x34a103(0x1c8)](_0x34a103(0x1de),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x1eed7b[_0x34a103(0x210)]('back');const _0x55c684=await sales_finished[_0x34a103(0x1d1)]({'invoice':_0x149699});_0x55c684[_0x34a103(0x244)]=_0x34a103(0x1fb);const _0x8e05b8=await _0x55c684['save'](),_0x240fd4=new sales_return_finished({'invoice':_0x149699,'customer':_0x4cce4e[_0x34a103(0x1c1)]['customer'],'date':_0x1b6a74,'warehouse_name':_0x40220e,'room':_0x1ef2e3,'ToWarehouse':_0x54341e,'ToRoom':_0x5d5271,'return_sale':_0x4e63d9,'note':_0x1f84d6,'warehouse_cat':_0x2e85de}),_0x4e65d7=await _0x240fd4[_0x34a103(0x25c)](),_0x434a73=await sales_return_finished[_0x34a103(0x1d1)]({'invoice':_0x149699}),_0x16f37c=await warehouse[_0x34a103(0x1d1)]({'name':_0x54341e,'room':_0x5d5271,'warehouse_category':_0x34a103(0x24d)});_0x434a73[_0x34a103(0x266)]['forEach'](_0x1af5d9=>{var _0x47d0fc=_0x34a103,_0x258fd3=0x0;const _0x2e27ec=_0x16f37c[_0x47d0fc(0x271)]['map'](_0x1899fe=>{var _0x472ae8=_0x47d0fc;_0x1899fe[_0x472ae8(0x2a4)]==_0x1af5d9['product_name']&&_0x1899fe[_0x472ae8(0x288)]==_0x1af5d9[_0x472ae8(0x288)]&&_0x1899fe[_0x472ae8(0x23d)]==_0x1af5d9[_0x472ae8(0x23d)]&&_0x1899fe['production_date']==_0x1af5d9[_0x472ae8(0x2b1)]&&_0x1899fe['batch_code']==_0x1af5d9['batch_code']&&(_0x1899fe[_0x472ae8(0x2a2)]=parseInt(_0x1899fe[_0x472ae8(0x2a2)])+parseInt(_0x1af5d9[_0x472ae8(0x28a)]),_0x258fd3++);});_0x258fd3=='0'&&(_0x16f37c[_0x47d0fc(0x271)]=_0x16f37c[_0x47d0fc(0x271)][_0x47d0fc(0x1b7)]({'product_name':_0x1af5d9[_0x47d0fc(0x2a4)],'product_stock':_0x1af5d9[_0x47d0fc(0x28a)],'primary_code':_0x1af5d9[_0x47d0fc(0x28e)],'secondary_code':_0x1af5d9['secondary_code'],'product_code':_0x1af5d9[_0x47d0fc(0x1f4)],'bay':_0x1af5d9[_0x47d0fc(0x288)],'batch_code':_0x1af5d9[_0x47d0fc(0x1b5)],'maxPerUnit':_0x1af5d9[_0x47d0fc(0x28d)],'production_date':_0x1af5d9[_0x47d0fc(0x2b1)],'expiry_date':_0x1af5d9[_0x47d0fc(0x23d)],'secondary_unit':_0x1af5d9['secondary_unit'],'unit':_0x1af5d9[_0x47d0fc(0x24c)],'maxProducts':_0x1af5d9[_0x47d0fc(0x1ca)]}));}),await _0x16f37c[_0x34a103(0x25c)](),console['log'](_0x4cce4e[_0x34a103(0x1c1)]);const _0x145b51=new c_payment_data({'invoice':_0x149699,'customer':_0x4cce4e[_0x34a103(0x1c1)][_0x34a103(0x298)],'reason':_0x34a103(0x202)});await _0x145b51[_0x34a103(0x25c)]();const _0x16f440=await master_shop[_0x34a103(0x258)]();console[_0x34a103(0x2c4)](_0x34a103(0x22a),_0x16f440[0x0][_0x34a103(0x26d)]);const _0x2256bf=await email_settings[_0x34a103(0x1d1)](),_0x1a9ab5=await customer['findOne']({'name':_0x4cce4e[_0x34a103(0x1c1)]['customer']});console[_0x34a103(0x2c4)](_0x34a103(0x2a8),_0x1a9ab5);_0x16f440[0x0][_0x34a103(0x26e)]==0x1?(right_currency=_0x16f440[0x0][_0x34a103(0x241)],left_currency=''):(right_currency='',left_currency=_0x16f440[0x0][_0x34a103(0x241)]);var _0x388932=_0x53fde3,_0x4f3a91=_0x4234f7,_0x347584='',_0x2750aa;for(_0x2750aa in _0x388932){_0x347584+=_0x34a103(0x29a)+_0x34a103(0x29c)+_0x388932[_0x2750aa]+_0x34a103(0x1c7)+_0x34a103(0x29c)+_0x4f3a91[_0x2750aa]+_0x34a103(0x1c7)+_0x34a103(0x2b8);}console[_0x34a103(0x2c4)](_0x34a103(0x1c2),_0x347584);let _0x1e8f0d=nodemailer[_0x34a103(0x1d3)]({'service':'gmail','auth':{'user':_0x2256bf[_0x34a103(0x27a)],'pass':_0x2256bf[_0x34a103(0x283)]}}),_0x2226f1={'from':_0x2256bf['email'],'to':_0x1a9ab5[_0x34a103(0x27a)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x34a103(0x20b),'path':__dirname+_0x34a103(0x22f)+_0x34a103(0x2b9)+_0x16f440[0x0]['image'],'cid':_0x34a103(0x2c0)}],'html':_0x34a103(0x259)+'<html><head><title></title>'+_0x34a103(0x250)+_0x34a103(0x246)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x34a103(0x246)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x34a103(0x1f9)+_0x16f440[0x0]['site_title']+_0x34a103(0x1f1)+'</div>'+_0x34a103(0x2b6)+'<hr\x20class=\x22my-3\x22>'+_0x34a103(0x246)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x34a103(0x260)+_0x149699+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x34a103(0x1cc)+_0x1b6a74+'\x20'+_0x34a103(0x1dc)+'</h5>'+_0x34a103(0x2b6)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x34a103(0x261)+_0x34a103(0x29a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x34a103(0x211)+_0x34a103(0x29e)+_0x34a103(0x273)+'</tr>'+_0x34a103(0x1b6)+_0x34a103(0x1ef)+'\x20'+_0x347584+'\x20'+'</tbody>'+_0x34a103(0x29d)+_0x34a103(0x246)+'<strong>\x20Regards\x20</strong>'+_0x34a103(0x1c5)+_0x16f440[0x0][_0x34a103(0x1ea)]+_0x34a103(0x275)+_0x34a103(0x2b6)+'</div>'+_0x34a103(0x28f)};_0x1e8f0d[_0x34a103(0x2ad)](_0x2226f1,function(_0x4f4622,_0x4705df){var _0x4e0464=_0x34a103;_0x4f4622?(console[_0x4e0464(0x2c4)](_0x4f4622),console[_0x4e0464(0x2c4)](_0x4e0464(0x276))):console[_0x4e0464(0x2c4)](_0x4e0464(0x1c4));}),_0x4cce4e['flash'](_0x34a103(0x232),_0x34a103(0x1bd)),_0x1eed7b[_0x34a103(0x210)]('/all_sales_finished/view');}catch(_0x63dba4){console['log'](_0x63dba4),_0x1eed7b[_0x34a103(0x1c6)](0xc8)[_0x34a103(0x257)]({'message1':_0x63dba4[_0x34a103(0x1e5)]});}}}),router[a0_0x1a7d8e(0x1ff)](a0_0x1a7d8e(0x2a6),auth,async(_0x59ceb3,_0x18907f)=>{var _0x278e57=a0_0x1a7d8e;try{const {username:_0x49cb77,email:_0x19b95b,role:_0x10892c}=_0x59ceb3[_0x278e57(0x277)],_0x2696de=_0x59ceb3['user'],_0x5888da=await profile[_0x278e57(0x1d1)]({'email':_0x2696de[_0x278e57(0x27a)]}),_0x273ac0=await master_shop['find']();console[_0x278e57(0x2c4)](_0x278e57(0x2b2),_0x273ac0);const _0x45d13d=_0x59ceb3[_0x278e57(0x24f)]['id'],_0x556f15=await sales['findById'](_0x45d13d);console[_0x278e57(0x2c4)](_0x278e57(0x25f),_0x556f15);if(_0x273ac0[0x0][_0x278e57(0x21a)]==_0x278e57(0x20e))var _0x153455=users[_0x278e57(0x264)];else{if(_0x273ac0[0x0][_0x278e57(0x21a)]==_0x278e57(0x23b))var _0x153455=users[_0x278e57(0x23b)];else{if(_0x273ac0[0x0][_0x278e57(0x21a)]==_0x278e57(0x24e))var _0x153455=users[_0x278e57(0x24e)];else{if(_0x273ac0[0x0][_0x278e57(0x21a)]==_0x278e57(0x21b))var _0x153455=users[_0x278e57(0x21b)];else{if(_0x273ac0[0x0]['language']==_0x278e57(0x225))var _0x153455=users[_0x278e57(0x225)];else{if(_0x273ac0[0x0][_0x278e57(0x21a)]=='Portuguese\x20(BR)')var _0x153455=users[_0x278e57(0x1f3)];else{if(_0x273ac0[0x0]['language']=='Chinese')var _0x153455=users[_0x278e57(0x1f5)];else{if(_0x273ac0[0x0][_0x278e57(0x21a)]==_0x278e57(0x20f))var _0x153455=users[_0x278e57(0x28b)];}}}}}}}_0x18907f[_0x278e57(0x21e)]('all_sales_barcode',{'success':_0x59ceb3['flash'](_0x278e57(0x232)),'errors':_0x59ceb3[_0x278e57(0x1c8)]('errors'),'role':_0x2696de,'profile':_0x5888da,'alldata':_0x556f15,'master_shop':_0x273ac0,'language':_0x153455});}catch(_0x50df17){console[_0x278e57(0x2c4)](_0x50df17);}}),router[a0_0x1a7d8e(0x1e2)](a0_0x1a7d8e(0x204),async(_0xc1c44b,_0x33b7a7)=>{var _0x38bdee=a0_0x1a7d8e;const {product_code:_0x53ddc2,warehouse_name:_0x3e68a1,rooms_data:_0x33519e,Roomslist:_0x27af1a}=_0xc1c44b[_0x38bdee(0x1c1)],_0xca961b=_0x27af1a[_0x38bdee(0x1b3)](','),_0x40e809=[];async function _0x194e2d(_0x1711ce){var _0x3a0a61=_0x38bdee;const _0x26bc2b=await warehouse[_0x3a0a61(0x254)]([{'$match':{'name':_0x3e68a1,'room':_0x1711ce}},{'$unwind':_0x3a0a61(0x287)},{'$match':{'product_details.primary_code':_0x53ddc2}},{'$group':{'_id':_0x3a0a61(0x2b0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3a0a61(0x218)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3a0a61(0x296)},'level':{'$first':_0x3a0a61(0x27e)},'isle':{'$first':_0x3a0a61(0x234)},'type':{'$first':_0x3a0a61(0x245)},'pallet':{'$first':_0x3a0a61(0x1dd)},'unit':{'$first':_0x3a0a61(0x1d8)},'secondary_unit':{'$first':_0x3a0a61(0x209)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3a0a61(0x2bf)},'expiry_date':{'$first':_0x3a0a61(0x22e)},'production_date':{'$first':_0x3a0a61(0x242)},'maxPerUnit':{'$first':_0x3a0a61(0x226)},'batch_code':{'$first':_0x3a0a61(0x24a)},'product_cat':{'$first':_0x3a0a61(0x2c2)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x3a0a61(0x1d4)},'invoice':{'$first':_0x3a0a61(0x290)}}}]),_0x344d2e=await warehouse['aggregate']([{'$match':{'name':_0x3e68a1,'room':_0x1711ce}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x53ddc2}},{'$group':{'_id':_0x3a0a61(0x2b0),'name':{'$first':_0x3a0a61(0x22d)},'product_stock':{'$first':_0x3a0a61(0x235)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3a0a61(0x296)},'level':{'$first':_0x3a0a61(0x27e)},'isle':{'$first':_0x3a0a61(0x234)},'type':{'$first':_0x3a0a61(0x245)},'pallet':{'$first':_0x3a0a61(0x1dd)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3a0a61(0x2b5)},'rack':{'$first':_0x3a0a61(0x2bf)},'expiry_date':{'$first':_0x3a0a61(0x22e)},'production_date':{'$first':_0x3a0a61(0x242)},'maxPerUnit':{'$first':_0x3a0a61(0x226)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x3a0a61(0x2c2)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x3a0a61(0x1d4)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x26bc2b[_0x3a0a61(0x2a1)]>0x0)_0x40e809[_0x3a0a61(0x1ee)](_0x26bc2b);else _0x344d2e[_0x3a0a61(0x2a1)]>0x0&&_0x40e809[_0x3a0a61(0x1ee)](_0x344d2e);}const _0x101c79=_0xca961b[_0x38bdee(0x217)](_0x1e2a33=>_0x194e2d(_0x1e2a33));await Promise['all'](_0x101c79),_0x33b7a7[_0x38bdee(0x257)](_0x40e809);}),module[a0_0x1a7d8e(0x293)]=router;