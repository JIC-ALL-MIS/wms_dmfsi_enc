function a0_0x2803(_0x5b771a,_0x133f5c){var _0x373eaf=a0_0x373e();return a0_0x2803=function(_0x2803b6,_0x4fee40){_0x2803b6=_0x2803b6-0x1d1;var _0x5eca71=_0x373eaf[_0x2803b6];return _0x5eca71;},a0_0x2803(_0x5b771a,_0x133f5c);}var a0_0x339b0b=a0_0x2803;(function(_0x536725,_0x2258d2){var _0x32fc05=a0_0x2803,_0x559e72=_0x536725();while(!![]){try{var _0x30c401=parseInt(_0x32fc05(0x299))/0x1+parseInt(_0x32fc05(0x2b4))/0x2+-parseInt(_0x32fc05(0x1e3))/0x3+-parseInt(_0x32fc05(0x26a))/0x4*(parseInt(_0x32fc05(0x2c5))/0x5)+-parseInt(_0x32fc05(0x234))/0x6*(-parseInt(_0x32fc05(0x27e))/0x7)+-parseInt(_0x32fc05(0x26b))/0x8*(parseInt(_0x32fc05(0x2be))/0x9)+-parseInt(_0x32fc05(0x2b2))/0xa*(-parseInt(_0x32fc05(0x296))/0xb);if(_0x30c401===_0x2258d2)break;else _0x559e72['push'](_0x559e72['shift']());}catch(_0x7ed5ee){_0x559e72['push'](_0x559e72['shift']());}}}(a0_0x373e,0x569b4));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x339b0b(0x2e6)),nodemailer=require('nodemailer'),users=require(a0_0x339b0b(0x2c6));function a0_0x373e(){var _0x136cc0=['$product_details.product_cat','password','$product','</div>','Enclosed','post','Arabic','<hr\x20class=\x22my-3\x22>','random','room','\x20<>\x20','$product_details.bay','params','push','edit_sales_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','getDate','errors','17328sDRjnw','8AxQEqh','/barcode/:id','message','room_name','return_sale_QA','Sale','date','return_qty','$warehouse_name','Sales\x20Mail','batch_code','return_qty_QA','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.room_name','OUTF-','Portuguese','Finished\x20Goods','</h5>','filter','7HAumYn','\x20</h2>','flash','createTransport','</td>','stock','</tbody>','$customers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/all_sales_finished/view','id_transaction_from','aggregate','$finalize','max_per_unit','secondary_code_QA','<tr>','render','master','secondary_unit_QA','abs','$product_details.product_code','$date','image','production_date','121ACHUyZ','all_sales_barcode','name','65760KkaMld','product_code','warehouse_name','/view/add_sales','currency_placement','</table>','bay','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','secondary_unit','Sales\x20Update\x20successfully','product_stock','$sale_product.bay','finalize','due_amount','customer','/invoice/:id','Hindi','slice','$product_details.storage','Arabic\x20(ae)','date_data','$product_details','/preview/:id','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','QA\x20Warehouse','260040lhpKnS','logo','1088762wAQORf','product_name','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','French','/give_payment/:id','received_amount','<table\x20style=\x22width:\x20100%\x20!important;\x22>','expiry_date_QA','<span\x20style=\x22float:\x20right;\x22>','511281TTbMQw','/view/add_sales/:id','return_data','Quality\x20Inspection','out_invoice','/view/add_sale/product','string','420afQqWy','../public/language/languages.json','$note','concat','$product_details.primary_code','_id','$sale_product','get','carton','$product_details.floorlevel','unit_QA','$product_details.production_date','</head><body>','$product_details.expiry_date','$product_details.type','<h2>\x20','suppliers','barcode\x20user_id','/../public','return_sale_finished','/view/:id','$product_details.unit','all_sales_finished','German','language','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$sale_product.floorlevel','sales_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','host','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$sale_product.bin','Sale\x20Return','../middleware/auth','padStart','adjust_qty','maxPerUnit_QA','<h5>','<h5\x20style=\x22text-align:\x20left;\x22>','all','maxPerUnit','getMonth','$product_details.batch_code','<strong>\x20Regards\x20</strong>','customers_docs','user','product_date','edit_sales_finished_view','customer_data','level','warehouse','secondary_code','sales_quantity_QA','role','2079429wGPRzx','<html><head><title></title>','</tr>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Email\x20sent\x20successfully','final','<div>','$product_details.secondary_code','barcode\x20Product\x20master','$product_details._id','site_title','json','save','prod_invoice','</body></html>','unit','\x20Order\x20Date\x20:\x20','add_sales_finished','add\x20post','$sale_product.type','$return_data','quantity','Ambient','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','redirect','$product_details.maxPerUnit','/upload/','/barcode_scanner','Logo.png','Received\x20Payment\x20For\x20Sale','gmail','findById','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','maxProducts_QA','Chinese','body','$product.product_name','English\x20(US)','FGSEmail','$product_details.invoice','\x20Order\x20Number\x20:\x20','</span>','Portuguese\x20(BR)','Spanish','note','$product_details.rack','$product_details.product_name','$_id','Enabled','<tbody\x20style=\x22text-align:\x20center;\x22>','log','Error\x20Occurs','$invoice','error','for_categorize','/all_sales/view','/view/return_sales/:id','production_date_QA','return_sale','expiry_date','Return\x20Goods','findOne','maxProducts','Sale\x20Return\x20Mail','back','product_code_QA','stocks_QA','$name','primary_code','$room','split','maxperunit','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.product_stock','prod_cat','then','product_details','$product_details.bin','sales_quantity','currency','3434370rCvOvl','amount','product_data','Sales\x20Add\x20successfully','product_name_QA1','invoice','</thead>','True','toString','getFullYear','floor','sendMail','$product_details.maxProducts','length','sale_qty','prod_code','English','RoomAssigned','DRY\x20GOODS','$customer','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','batch_code_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','product_list','forEach','primary_code_QA','status','customers','map','product','max','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','sale_product','find'];a0_0x373e=function(){return _0x136cc0;};return a0_0x373e();}router[a0_0x339b0b(0x2cc)]('/view',auth,async(_0x5cd98c,_0x223e46)=>{var _0x968e5b=a0_0x339b0b;try{const {username:_0x446f1d,email:_0x562ac7,role:_0x45f050}=_0x5cd98c[_0x968e5b(0x1da)],_0xaeda4=_0x5cd98c['user'],_0x291307=await profile[_0x968e5b(0x221)]({'email':_0xaeda4[_0x968e5b(0x1fa)]}),_0x348d9c=await master_shop[_0x968e5b(0x257)]();let _0x47e1cd;if(_0xaeda4[_0x968e5b(0x1e2)]=='staff'){const _0x43c135=await staff['findOne']({'email':_0xaeda4['email']});_0x47e1cd=await sales_finished[_0x968e5b(0x289)]([{'$lookup':{'from':'customers','localField':_0x968e5b(0x2a7),'foreignField':'name','as':_0x968e5b(0x1d9)}},{'$unwind':_0x968e5b(0x285)},{'$unwind':_0x968e5b(0x2cb)},{'$group':{'_id':'$_id','invoice':{'$first':_0x968e5b(0x218)},'customers':{'$first':'$customer'},'date':{'$first':_0x968e5b(0x293)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x968e5b(0x2cb)},'note':{'$first':'$note'},'return_data':{'$first':_0x968e5b(0x1f7)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x968e5b(0x2a4)},'isle':{'$addToSet':_0x968e5b(0x2e4)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x968e5b(0x2df)},'finalize':{'$first':_0x968e5b(0x28a)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x47e1cd=await sales_finished[_0x968e5b(0x289)]([{'$lookup':{'from':_0x968e5b(0x250),'localField':_0x968e5b(0x2a7),'foreignField':_0x968e5b(0x298),'as':_0x968e5b(0x1d9)}},{'$unwind':'$customers_docs'},{'$unwind':_0x968e5b(0x2cb)},{'$group':{'_id':_0x968e5b(0x213),'invoice':{'$first':_0x968e5b(0x218)},'customers':{'$first':_0x968e5b(0x247)},'date':{'$first':_0x968e5b(0x293)},'warehouse_name':{'$first':_0x968e5b(0x273)},'sale_product':{'$push':_0x968e5b(0x2cb)},'note':{'$first':_0x968e5b(0x2c7)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x968e5b(0x2e4)},'type':{'$addToSet':_0x968e5b(0x1f6)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x348d9c[0x0][_0x968e5b(0x2dd)]==_0x968e5b(0x209)){var _0x7816d=users[_0x968e5b(0x244)];console[_0x968e5b(0x216)](_0x7816d);}else{if(_0x348d9c[0x0][_0x968e5b(0x2dd)]==_0x968e5b(0x2a9))var _0x7816d=users[_0x968e5b(0x2a9)];else{if(_0x348d9c[0x0]['language']==_0x968e5b(0x2dc))var _0x7816d=users[_0x968e5b(0x2dc)];else{if(_0x348d9c[0x0]['language']==_0x968e5b(0x20f))var _0x7816d=users[_0x968e5b(0x20f)];else{if(_0x348d9c[0x0]['language']=='French')var _0x7816d=users['French'];else{if(_0x348d9c[0x0][_0x968e5b(0x2dd)]==_0x968e5b(0x20e))var _0x7816d=users['Portuguese'];else{if(_0x348d9c[0x0]['language']=='Chinese')var _0x7816d=users[_0x968e5b(0x206)];else{if(_0x348d9c[0x0][_0x968e5b(0x2dd)]=='Arabic\x20(ae)')var _0x7816d=users[_0x968e5b(0x25e)];}}}}}}}_0x223e46[_0x968e5b(0x28e)](_0x968e5b(0x2db),{'success':_0x5cd98c['flash'](_0x968e5b(0x248)),'errors':_0x5cd98c['flash'](_0x968e5b(0x269)),'sales':_0x47e1cd,'profile':_0x291307,'role':_0xaeda4,'master_shop':_0x348d9c,'language':_0x7816d});}catch(_0x4e39e6){console['log'](_0x4e39e6);}});async function getRandom8DigitNumber(){var _0x9f6476=a0_0x339b0b;const _0x4d3661=0x989680,_0x183b9b=0x5f5e0ff,_0x36a431=Math[_0x9f6476(0x23e)](Math[_0x9f6476(0x260)]()*(_0x183b9b-_0x4d3661+0x1))+_0x4d3661;var _0x3f4621;const _0x20759a=await sales_finished[_0x9f6476(0x221)]({'invoice':'OUTF-'+_0x36a431});return _0x20759a&&_0x20759a[_0x9f6476(0x241)]>0x0?_0x3f4621=_0x9f6476(0x279)+_0x36a431:_0x3f4621=_0x9f6476(0x279)+_0x36a431,_0x3f4621;}router[a0_0x339b0b(0x2cc)](a0_0x339b0b(0x29c),auth,async(_0x430a26,_0x42eb80)=>{var _0x349549=a0_0x339b0b;try{const {username:_0x15e3e2,email:_0x21b4da,role:_0x371563}=_0x430a26[_0x349549(0x1da)],_0x2a03be=_0x430a26['user'],_0x510e7d=await profile['findOne']({'email':_0x2a03be[_0x349549(0x1fa)]}),_0x3381f3=await master_shop[_0x349549(0x257)](),_0x1e6a62=await customer[_0x349549(0x257)]({});let _0x12dd0e;if(_0x2a03be[_0x349549(0x1e2)]==_0x349549(0x2b6)){const _0x250aa4=await staff[_0x349549(0x221)]({'email':_0x2a03be['email']});_0x12dd0e=await warehouse['aggregate']([{'$match':{'status':_0x349549(0x214),'name':_0x250aa4[_0x349549(0x1df)],'warehouse_category':_0x349549(0x27b),'name':{'$ne':_0x349549(0x2b1)}}},{'$group':{'_id':_0x349549(0x227),'name':{'$first':_0x349549(0x227)}}},{'$sort':{'name':0x1}}]);}else _0x12dd0e=await warehouse['aggregate']([{'$match':{'status':_0x349549(0x214),'warehouse_category':_0x349549(0x27b),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x349549(0x227),'name':{'$first':_0x349549(0x227)}}},{'$sort':{'name':0x1}}]);const _0x24fc28=await product['find']({});var _0x19c13c=[_0x349549(0x1f9),_0x349549(0x25c)];const _0x287a7c=await sales_finished[_0x349549(0x257)]({}),_0x4fac0a=_0x287a7c[_0x349549(0x241)]+0x1,_0x12361b=_0x349549(0x279)+_0x4fac0a[_0x349549(0x23c)]()[_0x349549(0x2e7)](0x5,'0');if(_0x3381f3[0x0][_0x349549(0x2dd)]==_0x349549(0x209)){var _0x3d5bfd=users[_0x349549(0x244)];console['log'](_0x3d5bfd);}else{if(_0x3381f3[0x0][_0x349549(0x2dd)]==_0x349549(0x2a9))var _0x3d5bfd=users[_0x349549(0x2a9)];else{if(_0x3381f3[0x0][_0x349549(0x2dd)]==_0x349549(0x2dc))var _0x3d5bfd=users[_0x349549(0x2dc)];else{if(_0x3381f3[0x0]['language']==_0x349549(0x20f))var _0x3d5bfd=users[_0x349549(0x20f)];else{if(_0x3381f3[0x0][_0x349549(0x2dd)]==_0x349549(0x2b8))var _0x3d5bfd=users[_0x349549(0x2b8)];else{if(_0x3381f3[0x0][_0x349549(0x2dd)]==_0x349549(0x20e))var _0x3d5bfd=users['Portuguese'];else{if(_0x3381f3[0x0][_0x349549(0x2dd)]==_0x349549(0x206))var _0x3d5bfd=users[_0x349549(0x206)];else{if(_0x3381f3[0x0][_0x349549(0x2dd)]=='Arabic\x20(ae)')var _0x3d5bfd=users[_0x349549(0x25e)];}}}}}}}const _0x40d096=getRandom8DigitNumber();_0x40d096[_0x349549(0x22f)](_0x2862d1=>{var _0x4b31ff=_0x349549;_0x42eb80[_0x4b31ff(0x28e)](_0x4b31ff(0x1f4),{'success':_0x430a26[_0x4b31ff(0x280)](_0x4b31ff(0x248)),'errors':_0x430a26[_0x4b31ff(0x280)](_0x4b31ff(0x269)),'role':_0x2a03be,'profile':_0x510e7d,'customer':_0x1e6a62,'warehouse':_0x12dd0e,'product':_0x24fc28,'invoice':_0x2862d1,'master_shop':_0x3381f3,'language':_0x3d5bfd,'rooms_data':_0x19c13c});})['catch'](_0x216c54=>{var _0x319770=_0x349549;_0x430a26[_0x319770(0x280)]('errors',_0x319770(0x22c)),_0x42eb80[_0x319770(0x1fc)](_0x319770(0x287));});}catch(_0x5d4509){console[_0x349549(0x216)](_0x5d4509);}}),router[a0_0x339b0b(0x2cc)](a0_0x339b0b(0x2bf),auth,async(_0x448cb3,_0x1b4ce7)=>{var _0x5a8539=a0_0x339b0b;try{const _0x46a3c0=_0x448cb3[_0x5a8539(0x264)]['id'];console['log'](_0x46a3c0);const _0x1f458a=await product[_0x5a8539(0x257)](),_0x12c947=await purchases[_0x5a8539(0x289)]([{'$match':{'warehouse_name':_0x46a3c0}},{'$unwind':_0x5a8539(0x25a)},{'$group':{'_id':_0x5a8539(0x208)}}]);console['log']('purchases_data',_0x12c947),_0x1b4ce7[_0x5a8539(0x24f)](0xc8)[_0x5a8539(0x1ee)]({'purchases_data':_0x12c947,'product_data':_0x1f458a});}catch(_0x4f0859){console[_0x5a8539(0x216)](_0x4f0859);}}),router[a0_0x339b0b(0x25d)](a0_0x339b0b(0x2c3),auth,async(_0x42a218,_0xdd8439)=>{var _0x5587e1=a0_0x339b0b;try{const {warehouse_data:_0x51d548,product_data:_0x3cfe54}=_0x42a218[_0x5587e1(0x207)];console[_0x5587e1(0x216)](_0x42a218[_0x5587e1(0x207)][_0x5587e1(0x236)]);;const _0x19887c=await master_shop[_0x5587e1(0x257)]();console['log'](_0x5587e1(0x28f),_0x19887c);const _0x355a52=await product[_0x5587e1(0x221)]({'name':_0x3cfe54});console['log'](_0x5587e1(0x252),_0x355a52);const _0x258698=await warehouse[_0x5587e1(0x289)]([{'$match':{'name':_0x51d548}},{'$unwind':_0x5587e1(0x2ae)},{'$match':{'product_details.product_name':_0x3cfe54}},{'$group':{'_id':_0x5587e1(0x212),'product_stock':{'$first':_0x5587e1(0x22d)}}}]);console['log']('stock_data',_0x258698),_0xdd8439[_0x5587e1(0x24f)](0xc8)[_0x5587e1(0x1ee)]({'master':_0x19887c,'new_product':_0x355a52,'stock_data':_0x258698});}catch(_0x364ca5){console[_0x5587e1(0x216)](_0x364ca5);}}),router['post'](a0_0x339b0b(0x29c),auth,async(_0x2a8842,_0x7e4539)=>{var _0x4818fa=a0_0x339b0b;try{const {invoice:_0x36b741,date:_0x3d65a8,warehouse_name:_0x3d0e08,product_name:_0x435b90,stock:_0x4bc19e,quantity:_0x400a74,note:_0x1e55d4,room:_0x5aac17,primary_code:_0x3dc258,secondary_code:_0x45e5e5,prod_code:_0x4a9d51,level:_0x184716,isle:_0x25b4db,pallet:_0x2eb2d0,batch_code:_0x2a45d6,SCRN:_0x3c981f,expiry_date:_0x18d395,mode_transpo:_0x770392,name_driver:_0x25da71}=_0x2a8842[_0x4818fa(0x207)];if(typeof _0x435b90==_0x4818fa(0x2c4))var _0x1e29f4=[_0x2a8842['body'][_0x4818fa(0x2b5)]],_0x4f9041=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x283)]],_0x4e806a=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x2cd)]],_0x88cbcc=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x228)]],_0x1a14b5=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x1e0)]],_0x5b991e=[_0x2a8842[_0x4818fa(0x207)]['prod_code']],_0x4d14a9=[_0x2a8842[_0x4818fa(0x207)]['level']],_0x2133bd=[_0x2a8842[_0x4818fa(0x207)]['primary_unit']],_0x1f8a5d=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x2a1)]],_0x5b5041=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x275)]],_0x3cdf0d=[_0x2a8842['body']['expiry_date']],_0x21c33a=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x1db)]],_0x287de2=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x28b)]],_0x5635ad=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x22e)]],_0x2df3b0=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x245)]],_0xa36cdb=[_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x1f0)]],_0x251747=[_0x2a8842['body'][_0x4818fa(0x288)]];else var _0x1e29f4=[..._0x2a8842[_0x4818fa(0x207)]['product_name']],_0x4f9041=[..._0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x283)]],_0x4e806a=[..._0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x2cd)]],_0x88cbcc=[..._0x2a8842[_0x4818fa(0x207)]['primary_code']],_0x1a14b5=[..._0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x1e0)]],_0x5b991e=[..._0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x243)]],_0x4d14a9=[..._0x2a8842['body'][_0x4818fa(0x1de)]],_0x2133bd=[..._0x2a8842[_0x4818fa(0x207)]['primary_unit']],_0x1f8a5d=[..._0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x2a1)]],_0x5b5041=[..._0x2a8842[_0x4818fa(0x207)]['batch_code']],_0x3cdf0d=[..._0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x21f)]],_0x21c33a=[..._0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x1db)]],_0x287de2=[..._0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x28b)]],_0x5635ad=[..._0x2a8842[_0x4818fa(0x207)]['prod_cat']],_0x2df3b0=[..._0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x245)]],_0xa36cdb=[..._0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x1f0)]],_0x251747=[..._0x2a8842[_0x4818fa(0x207)]['id_transaction_from']];const _0x5c297a=_0x1e29f4['map'](_0x2b21f8=>{return _0x2b21f8={'product_name':_0x2b21f8};});_0x4f9041[_0x4818fa(0x24d)]((_0x25f8f6,_0x28a8a9)=>{var _0xa5a41b=_0x4818fa;_0x5c297a[_0x28a8a9][_0xa5a41b(0x283)]=_0x25f8f6;}),_0x4e806a[_0x4818fa(0x24d)]((_0x2c2499,_0x280ae8)=>{var _0x5d7df6=_0x4818fa;_0x5c297a[_0x280ae8][_0x5d7df6(0x1f8)]=Math[_0x5d7df6(0x291)](_0x2c2499);}),_0x251747[_0x4818fa(0x24d)]((_0x50485a,_0x1d1c4b)=>{var _0x187cbe=_0x4818fa;_0x5c297a[_0x1d1c4b][_0x187cbe(0x288)]=_0x50485a;}),_0x88cbcc[_0x4818fa(0x24d)]((_0x27cfef,_0x14a4de)=>{var _0x3b3216=_0x4818fa;_0x5c297a[_0x14a4de][_0x3b3216(0x228)]=_0x27cfef;}),_0x1a14b5[_0x4818fa(0x24d)]((_0x162ddc,_0x3cae73)=>{_0x5c297a[_0x3cae73]['secondary_code']=_0x162ddc;}),_0x5b991e[_0x4818fa(0x24d)]((_0x49e5db,_0x3aef5a)=>{var _0x161c71=_0x4818fa;_0x5c297a[_0x3aef5a]['product_code']=_0x49e5db,_0x5c297a[_0x3aef5a][_0x161c71(0x2ad)]=_0x3d65a8;}),_0x4d14a9[_0x4818fa(0x24d)]((_0x140600,_0x8a0064)=>{_0x5c297a[_0x8a0064]['bay']=_0x140600;}),_0x2133bd['forEach']((_0x27130b,_0x200583)=>{var _0x132946=_0x4818fa;_0x5c297a[_0x200583][_0x132946(0x1f2)]=_0x27130b;}),_0x1f8a5d[_0x4818fa(0x24d)]((_0x5e8c11,_0x708a0c)=>{_0x5c297a[_0x708a0c]['secondary_unit']=_0x5e8c11;}),_0x5b5041[_0x4818fa(0x24d)]((_0x333f96,_0x66b195)=>{var _0x43f269=_0x4818fa;_0x5c297a[_0x66b195][_0x43f269(0x275)]=_0x333f96;}),_0x3cdf0d[_0x4818fa(0x24d)]((_0x5e097f,_0x5cba29)=>{_0x5c297a[_0x5cba29]['expiry_date']=_0x5e097f;}),_0x21c33a[_0x4818fa(0x24d)]((_0x38a609,_0x7f1ec4)=>{var _0x3150e9=_0x4818fa;_0x5c297a[_0x7f1ec4][_0x3150e9(0x295)]=_0x38a609;}),_0x287de2[_0x4818fa(0x24d)]((_0xafcf5e,_0x3f0d78)=>{var _0x500eca=_0x4818fa;_0x5c297a[_0x3f0d78][_0x500eca(0x22b)]=_0xafcf5e;}),_0x5635ad[_0x4818fa(0x24d)]((_0x367bd1,_0x3d0d50)=>{var _0x3af702=_0x4818fa;_0x5c297a[_0x3d0d50][_0x3af702(0x22e)]=_0x367bd1;}),_0x2df3b0['forEach']((_0x5988d7,_0x54ecaa)=>{var _0x4e3b7c=_0x4818fa;_0x5c297a[_0x54ecaa][_0x4e3b7c(0x26e)]=_0x5988d7;}),_0xa36cdb[_0x4818fa(0x24d)]((_0x484acf,_0x4bc7c5)=>{_0x5c297a[_0x4bc7c5]['invoice']=_0x484acf;});var _0x4d2b60=0x0;_0x5c297a[_0x4818fa(0x24d)](_0x34e719=>{var _0x2d2cb9=_0x4818fa;parseFloat(_0x34e719['stock'])<parseFloat(_0x34e719[_0x2d2cb9(0x1f8)])&&parseFloat(_0x34e719[_0x2d2cb9(0x1f8)])>parseFloat(_0x34e719['stock'])&&(console['log'](_0x34e719[_0x2d2cb9(0x283)]+_0x2d2cb9(0x262)+_0x34e719['quantity']),_0x4d2b60++);});if(_0x4d2b60!=0x0)return _0x2a8842[_0x4818fa(0x280)](_0x4818fa(0x269),_0x4818fa(0x2b0)),_0x7e4539['redirect']('back');const _0x120eb8=_0x5c297a[_0x4818fa(0x27d)](_0x9fefd0=>_0x9fefd0[_0x4818fa(0x1f8)]!=='0'&&_0x9fefd0[_0x4818fa(0x1f8)]!==''),_0xe7fea6=new sales_finished({'invoice':_0x36b741,'customer':_0x2a8842['body']['customer'],'date':_0x3d65a8,'warehouse_name':_0x3d0e08,'sale_product':_0x120eb8,'note':_0x1e55d4,'room':_0x5aac17,'primary_code':_0x3dc258,'secondary_code':_0x45e5e5,'prod_code':_0x4a9d51,'SCRN':_0x3c981f,'finalize':'False','mode_transpo':_0x770392,'name_driver':_0x25da71}),_0x32ee76=await _0xe7fea6[_0x4818fa(0x1ef)](),_0x436198=await sales_finished['findOne']({'invoice':_0x36b741}),_0x56ee95=new c_payment_data({'invoice':_0x36b741,'customer':_0x2a8842['body'][_0x4818fa(0x2a7)],'reason':_0x4818fa(0x270)});await _0x56ee95['save']();const _0x448622=await master_shop[_0x4818fa(0x257)](),_0x54c3af=await email_settings['findOne'](),_0x333a46=await customer[_0x4818fa(0x221)]({'name':_0x2a8842[_0x4818fa(0x207)][_0x4818fa(0x2a7)]});_0x448622[0x0][_0x4818fa(0x29d)]==0x1?(right_currency=_0x448622[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x448622[0x0][_0x4818fa(0x233)]);var _0x3b71b3=_0x1e29f4,_0x56765f=_0x4e806a,_0x2f0fe3='',_0x8e26f4;for(_0x8e26f4 in _0x3b71b3){_0x2f0fe3+='<tr>'+_0x4818fa(0x204)+_0x3b71b3[_0x8e26f4]+_0x4818fa(0x282)+_0x4818fa(0x204)+_0x56765f[_0x8e26f4]+'</td>'+_0x4818fa(0x1e5);}console['log'](_0x4818fa(0x24c),_0x2f0fe3),_0x2a8842[_0x4818fa(0x280)]('success',_0x4818fa(0x237)),_0x7e4539['redirect']('/all_sales_finished/preview/'+_0x32ee76['_id']);}catch(_0x3cf790){console[_0x4818fa(0x216)](_0x3cf790);}}),router[a0_0x339b0b(0x2cc)](a0_0x339b0b(0x2af),auth,async(_0x738404,_0xa62a5b)=>{var _0x46292b=a0_0x339b0b;try{const {username:_0x349134,email:_0x4f1704,role:_0x564de6}=_0x738404[_0x46292b(0x1da)],_0x42c9e0=_0x738404[_0x46292b(0x1da)],_0x2bdff1=await profile['findOne']({'email':_0x42c9e0[_0x46292b(0x1fa)]}),_0x10e71c=await master_shop[_0x46292b(0x257)](),_0x2b0249=_0x738404[_0x46292b(0x264)]['id'],_0x1e52ca=await sales_finished[_0x46292b(0x203)](_0x2b0249),_0x47f6b0=await warehouse['aggregate']([{'$match':{'name':_0x1e52ca[_0x46292b(0x29b)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x46292b(0x1ec),'name':{'$first':_0x46292b(0x212)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x46292b(0x2d3)},'floorlevel':{'$first':_0x46292b(0x2ce)},'primary_code':{'$first':_0x46292b(0x2c9)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x46292b(0x2ab)},'rack':{'$first':_0x46292b(0x211)},'expiry_date':{'$first':_0x46292b(0x2d2)},'production_date':{'$first':_0x46292b(0x2d0)},'batch_code':{'$first':_0x46292b(0x1d7)},'room':{'$first':'$room'},'room_data':{'$first':_0x46292b(0x278)}}}]),_0x21ad90=await customer[_0x46292b(0x257)]({});let _0xd8012e;if(_0x42c9e0[_0x46292b(0x1e2)]==_0x46292b(0x2b6)){const _0xa67569=await staff[_0x46292b(0x221)]({'email':_0x42c9e0[_0x46292b(0x1fa)]});_0xd8012e=await warehouse[_0x46292b(0x289)]([{'$match':{'status':_0x46292b(0x214),'name':_0xa67569[_0x46292b(0x1df)]}},{'$group':{'_id':_0x46292b(0x227),'name':{'$first':_0x46292b(0x227)}}}]);}else _0xd8012e=await warehouse['aggregate']([{'$match':{'status':_0x46292b(0x214)}},{'$group':{'_id':'$name','name':{'$first':_0x46292b(0x227)}}}]);const _0x526da1=await product[_0x46292b(0x257)]({});if(_0x10e71c[0x0][_0x46292b(0x2dd)]==_0x46292b(0x209)){var _0x3a1761=users[_0x46292b(0x244)];console[_0x46292b(0x216)](_0x3a1761);}else{if(_0x10e71c[0x0][_0x46292b(0x2dd)]==_0x46292b(0x2a9))var _0x3a1761=users[_0x46292b(0x2a9)];else{if(_0x10e71c[0x0][_0x46292b(0x2dd)]=='German')var _0x3a1761=users[_0x46292b(0x2dc)];else{if(_0x10e71c[0x0][_0x46292b(0x2dd)]==_0x46292b(0x20f))var _0x3a1761=users[_0x46292b(0x20f)];else{if(_0x10e71c[0x0][_0x46292b(0x2dd)]=='French')var _0x3a1761=users['French'];else{if(_0x10e71c[0x0][_0x46292b(0x2dd)]==_0x46292b(0x20e))var _0x3a1761=users['Portuguese'];else{if(_0x10e71c[0x0]['language']==_0x46292b(0x206))var _0x3a1761=users[_0x46292b(0x206)];else{if(_0x10e71c[0x0][_0x46292b(0x2dd)]==_0x46292b(0x2ac))var _0x3a1761=users[_0x46292b(0x25e)];}}}}}}}_0xa62a5b[_0x46292b(0x28e)](_0x46292b(0x1dc),{'success':_0x738404[_0x46292b(0x280)]('success'),'errors':_0x738404[_0x46292b(0x280)](_0x46292b(0x269)),'role':_0x42c9e0,'profile':_0x2bdff1,'customer':_0x21ad90,'warehouse':_0xd8012e,'product':_0x47f6b0,'user':_0x1e52ca,'master_shop':_0x10e71c,'unit':_0x526da1,'language':_0x3a1761});}catch(_0x51742e){console[_0x46292b(0x216)](_0x51742e);}}),router[a0_0x339b0b(0x25d)](a0_0x339b0b(0x2af),auth,async(_0x2cb604,_0x8316d)=>{var _0xc5d709=a0_0x339b0b;try{const _0x2dec9f=_0x2cb604['params']['id'],{invoice:_0x56c121,warehouse_name:_0x1f9de5,room:_0x117e5c}=_0x2cb604[_0xc5d709(0x207)],_0x16355c=await sales_finished[_0xc5d709(0x221)]({'invoice':_0x56c121}),_0x40e569=_0x16355c[_0xc5d709(0x256)][_0xc5d709(0x251)](async _0x3ad6a2=>{var _0xbb5ca2=_0xc5d709,_0x105a5c=await warehouse[_0xbb5ca2(0x221)]({'name':_0x1f9de5,'room':_0x3ad6a2[_0xbb5ca2(0x26e)],'warehouse_category':_0xbb5ca2(0x27b)});const _0x492fe4=_0x105a5c[_0xbb5ca2(0x230)][_0xbb5ca2(0x251)](_0x3cdb44=>{var _0x5a1679=_0xbb5ca2;if(_0x3cdb44[_0x5a1679(0x2b5)]==_0x3ad6a2['product_name']&&_0x3cdb44[_0x5a1679(0x29f)]==_0x3ad6a2[_0x5a1679(0x29f)]&&_0x3cdb44[_0x5a1679(0x21f)]==_0x3ad6a2[_0x5a1679(0x21f)]&&_0x3cdb44[_0x5a1679(0x295)]==_0x3ad6a2['production_date']&&_0x3cdb44[_0x5a1679(0x275)]==_0x3ad6a2[_0x5a1679(0x275)]&&_0x3cdb44[_0x5a1679(0x2ca)]==_0x3ad6a2[_0x5a1679(0x288)]){if(_0x3cdb44[_0x5a1679(0x2a3)]>0x0){_0x3cdb44[_0x5a1679(0x2a3)]=Math[_0x5a1679(0x253)](0x0,Math[_0x5a1679(0x291)](_0x3cdb44[_0x5a1679(0x2a3)])-Math[_0x5a1679(0x291)](_0x3ad6a2['quantity']));if(_0x3cdb44[_0x5a1679(0x2c2)]==undefined)_0x3cdb44[_0x5a1679(0x2c2)]=_0x56c121+'~';else{var _0x14d2a6=_0x3cdb44[_0x5a1679(0x2c2)][_0x5a1679(0x22a)]('~'),_0x45d2b3='';for(let _0x17634a=0x0;_0x17634a<=_0x14d2a6[_0x5a1679(0x241)]-0x1;_0x17634a++){const _0x556f8b=_0x14d2a6[_0x17634a];_0x556f8b[_0x5a1679(0x241)]>0x0&&(_0x45d2b3+=_0x556f8b+'~');}_0x3cdb44['out_invoice']=_0x45d2b3;}}}});return console[_0xbb5ca2(0x216)](_0x105a5c),_0x105a5c;});Promise[_0xc5d709(0x1d4)](_0x40e569)[_0xc5d709(0x22f)](async _0x19bda0=>{var _0x32927f=_0xc5d709;try{for(const _0x572ab1 of _0x19bda0){await _0x572ab1[_0x32927f(0x1ef)]();}_0x16355c[_0x32927f(0x2a5)]='True';const _0x53fcd0=await _0x16355c['save'](),_0x14b7e6=await master_shop[_0x32927f(0x257)](),_0x51c97e=await email_settings[_0x32927f(0x221)](),_0x112bc0=await supervisor_settings[_0x32927f(0x257)]();var _0x211323=_0x16355c[_0x32927f(0x256)],_0x51655f='',_0x3086d2;for(_0x3086d2 in _0x211323){var _0x4fde4c='FG';_0x16355c[_0x32927f(0x29b)]==_0x32927f(0x246)&&(_0x4fde4c='DG'),_0x51655f+=_0x32927f(0x28d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x211323[_0x3086d2][_0x32927f(0x2b5)]+_0x32927f(0x282)+_0x32927f(0x204)+_0x211323[_0x3086d2][_0x32927f(0x29a)]+'</td>'+_0x32927f(0x204)+_0x211323[_0x3086d2][_0x32927f(0x1f8)]+_0x32927f(0x282)+_0x32927f(0x204)+_0x211323[_0x3086d2][_0x32927f(0x1f2)]+_0x32927f(0x282)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x211323[_0x3086d2][_0x32927f(0x2a1)]+_0x32927f(0x282)+_0x32927f(0x204)+_0x16355c['warehouse_name']+_0x32927f(0x282)+_0x32927f(0x204)+_0x211323[_0x3086d2][_0x32927f(0x26e)]+_0x32927f(0x282)+_0x32927f(0x204)+_0x4fde4c+_0x211323[_0x3086d2]['bay']+_0x32927f(0x282);}let _0x34fd18=nodemailer[_0x32927f(0x281)]({'host':_0x51c97e[_0x32927f(0x2e2)],'port':Number(_0x51c97e['port']),'secure':![],'auth':{'user':_0x51c97e['email'],'pass':_0x51c97e['password']}}),_0x497d2f={'from':_0x51c97e[_0x32927f(0x1fa)],'to':_0x112bc0[0x0][_0x32927f(0x20a)],'subject':_0x32927f(0x274),'attachments':[{'filename':_0x32927f(0x200),'path':__dirname+'/../public'+'/upload/'+_0x14b7e6[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x32927f(0x1e4)+_0x32927f(0x2d1)+'<div>'+_0x32927f(0x2de)+_0x32927f(0x1e9)+_0x32927f(0x1e6)+_0x32927f(0x25b)+_0x32927f(0x1e9)+_0x32927f(0x2d4)+_0x14b7e6[0x0][_0x32927f(0x1ed)]+_0x32927f(0x27f)+_0x32927f(0x25b)+_0x32927f(0x25b)+'<hr\x20class=\x22my-3\x22>'+_0x32927f(0x1e9)+_0x32927f(0x1d3)+'\x20Order\x20Number\x20:\x20'+_0x16355c[_0x32927f(0x239)]+'\x20'+_0x32927f(0x2bd)+_0x32927f(0x1f3)+_0x16355c[_0x32927f(0x271)]+'\x20'+'</span>'+'</h5>'+_0x32927f(0x25b)+_0x32927f(0x2bb)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x32927f(0x28d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x32927f(0x24b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x32927f(0x286)+_0x32927f(0x249)+_0x32927f(0x1fb)+_0x32927f(0x2e3)+_0x32927f(0x1e5)+_0x32927f(0x23a)+_0x32927f(0x215)+'\x20'+_0x51655f+'\x20'+_0x32927f(0x284)+_0x32927f(0x29e)+_0x32927f(0x1e9)+_0x32927f(0x1d8)+_0x32927f(0x1d2)+_0x14b7e6[0x0][_0x32927f(0x1ed)]+_0x32927f(0x27c)+_0x32927f(0x25b)+_0x32927f(0x25b)+_0x32927f(0x1f1)};_0x34fd18[_0x32927f(0x23f)](_0x497d2f,function(_0x186f70,_0x40b9ba){var _0x59cc20=_0x32927f;_0x186f70?(console[_0x59cc20(0x216)](_0x186f70),console[_0x59cc20(0x216)](_0x59cc20(0x217))):console['log'](_0x59cc20(0x1e7));}),_0x2cb604[_0x32927f(0x280)]('success',_0x32927f(0x2a2)),_0x8316d['redirect']('/picking_list/pdf/'+_0x2dec9f);}catch(_0x32e935){console[_0x32927f(0x219)](_0x32e935),_0x8316d[_0x32927f(0x24f)](0x1f4)[_0x32927f(0x1ee)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x322386=>{var _0x110ab4=_0xc5d709;console['error'](_0x322386),_0x8316d['status'](0x1f4)[_0x110ab4(0x1ee)]({'error':'An\x20error\x20occurred.'});});}catch(_0x32d1bf){console[_0xc5d709(0x216)](_0x32d1bf);}}),router[a0_0x339b0b(0x2cc)](a0_0x339b0b(0x2d9),auth,async(_0x403948,_0x6a3115)=>{var _0x1d905=a0_0x339b0b;try{const {username:_0x3127e1,email:_0x338ce0,role:_0x53ffd5}=_0x403948[_0x1d905(0x1da)],_0x31db8d=_0x403948[_0x1d905(0x1da)],_0x2fb31d=await profile[_0x1d905(0x221)]({'email':_0x31db8d[_0x1d905(0x1fa)]}),_0x2d0f3a=await master_shop['find'](),_0x19189f=_0x403948[_0x1d905(0x264)]['id'],_0xaebaf=await sales_finished[_0x1d905(0x203)](_0x19189f);let _0x33f81b=new Date(_0xaebaf['expiry_date']),_0x3c91d8=('0'+_0x33f81b[_0x1d905(0x268)]())[_0x1d905(0x2aa)](-0x2),_0xbb3366=('0'+(_0x33f81b[_0x1d905(0x1d6)]()+0x1))['slice'](-0x2),_0x4e31f6=_0x33f81b[_0x1d905(0x23d)](),_0x266964=_0x4e31f6+'-'+_0xbb3366+'-'+_0x3c91d8;var _0x1fee66=['Ambient','Enclosed'];const _0x28fe63=await warehouse[_0x1d905(0x289)]([{'$match':{'name':_0xaebaf['warehouse_name'],'room':_0xaebaf[_0x1d905(0x261)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1d905(0x1ec),'name':{'$first':_0x1d905(0x212)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1d905(0x263)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1d905(0x2d3)},'floorlevel':{'$first':_0x1d905(0x2ce)},'primary_code':{'$first':_0x1d905(0x2c9)},'secondary_code':{'$first':_0x1d905(0x1ea)},'product_code':{'$first':_0x1d905(0x292)},'storage':{'$first':_0x1d905(0x2ab)},'rack':{'$first':'$product_details.rack'}}}]),_0x259bd6=await customer[_0x1d905(0x257)]({});let _0x2b620e;if(_0x31db8d[_0x1d905(0x1e2)]==_0x1d905(0x2b6)){const _0x6e31b4=await staff['findOne']({'email':_0x31db8d[_0x1d905(0x1fa)]});_0x2b620e=await warehouse['aggregate']([{'$match':{'status':_0x1d905(0x214),'name':_0x6e31b4[_0x1d905(0x1df)]}},{'$group':{'_id':_0x1d905(0x227),'name':{'$first':_0x1d905(0x227)}}}]);}else _0x2b620e=await warehouse['aggregate']([{'$match':{'status':_0x1d905(0x214)}},{'$group':{'_id':_0x1d905(0x227),'name':{'$first':_0x1d905(0x227)}}}]);const _0x566d24=await product['find']({});if(_0x2d0f3a[0x0]['language']==_0x1d905(0x209)){var _0x154267=users['English'];console[_0x1d905(0x216)](_0x154267);}else{if(_0x2d0f3a[0x0][_0x1d905(0x2dd)]==_0x1d905(0x2a9))var _0x154267=users[_0x1d905(0x2a9)];else{if(_0x2d0f3a[0x0]['language']==_0x1d905(0x2dc))var _0x154267=users[_0x1d905(0x2dc)];else{if(_0x2d0f3a[0x0][_0x1d905(0x2dd)]=='Spanish')var _0x154267=users[_0x1d905(0x20f)];else{if(_0x2d0f3a[0x0][_0x1d905(0x2dd)]==_0x1d905(0x2b8))var _0x154267=users['French'];else{if(_0x2d0f3a[0x0][_0x1d905(0x2dd)]==_0x1d905(0x20e))var _0x154267=users[_0x1d905(0x27a)];else{if(_0x2d0f3a[0x0]['language']==_0x1d905(0x206))var _0x154267=users[_0x1d905(0x206)];else{if(_0x2d0f3a[0x0]['language']==_0x1d905(0x2ac))var _0x154267=users[_0x1d905(0x25e)];}}}}}}}_0x6a3115['render'](_0x1d905(0x266),{'success':_0x403948[_0x1d905(0x280)](_0x1d905(0x248)),'errors':_0x403948[_0x1d905(0x280)]('errors'),'role':_0x31db8d,'profile':_0x2fb31d,'customer':_0x259bd6,'warehouse':_0x2b620e,'product':_0x28fe63,'user':_0xaebaf,'master_shop':_0x2d0f3a,'unit':_0x566d24,'language':_0x154267,'rooms_data':_0x1fee66,'ed_fullDate':_0x266964});}catch(_0x4d9cb7){console[_0x1d905(0x216)](_0x4d9cb7);}}),router[a0_0x339b0b(0x25d)](a0_0x339b0b(0x2d9),auth,async(_0x524450,_0x514f0e)=>{var _0x23de59=a0_0x339b0b;try{const _0x297e20=_0x524450[_0x23de59(0x264)]['id'],_0x269d2d=await sales_finished[_0x23de59(0x221)]({'_id':_0x524450['params']['id']}),_0x29484c=await warehouse[_0x23de59(0x221)]({'name':_0x269d2d[_0x23de59(0x29b)],'room':_0x524450[_0x23de59(0x207)]['room'],'warehouse_category':_0x23de59(0x27b)}),{invoice:_0x1c4597,customer:_0x59144f,date:_0x239c56,warehouse_name:_0x249173,product_name:_0x5ae76e,stock:_0x434710,adjust_qty:_0x205c24,note:_0x4685dc,room:_0x5e5c03,primary_code:_0x1af683,secondary_code:_0xff937b,prod_code:_0x27d756,level:_0x4a7c4d,isle:_0x4400ca,pallet:_0xd20abe,expiry_date:_0x5e0cb6}=_0x524450[_0x23de59(0x207)];if(typeof _0x5ae76e==_0x23de59(0x2c4))var _0x136deb=[_0x524450[_0x23de59(0x207)][_0x23de59(0x2b5)]],_0x4ee4d2=[_0x524450['body'][_0x23de59(0x283)]],_0x45a4a9=[_0x524450[_0x23de59(0x207)][_0x23de59(0x2e8)]],_0x559fc6=[_0x524450[_0x23de59(0x207)][_0x23de59(0x228)]],_0xdcb142=[_0x524450[_0x23de59(0x207)][_0x23de59(0x1e0)]],_0x240689=[_0x524450[_0x23de59(0x207)]['prod_code']],_0x40bbdf=[_0x524450[_0x23de59(0x207)]['level']],_0x35b482=[_0x524450[_0x23de59(0x207)][_0x23de59(0x21f)]];else var _0x136deb=[..._0x524450[_0x23de59(0x207)]['product_name']],_0x4ee4d2=[..._0x524450[_0x23de59(0x207)][_0x23de59(0x283)]],_0x45a4a9=[..._0x524450[_0x23de59(0x207)]['adjust_qty']],_0x559fc6=[..._0x524450[_0x23de59(0x207)][_0x23de59(0x228)]],_0xdcb142=[..._0x524450[_0x23de59(0x207)]['secondary_code']],_0x240689=[..._0x524450['body'][_0x23de59(0x243)]],_0x40bbdf=[..._0x524450[_0x23de59(0x207)][_0x23de59(0x1de)]],_0x35b482=[..._0x524450['body'][_0x23de59(0x21f)]];const _0x2d1713=_0x136deb[_0x23de59(0x251)](_0x6464a3=>{return _0x6464a3={'product_name':_0x6464a3};});_0x4ee4d2[_0x23de59(0x24d)]((_0x27c674,_0x545ea5)=>{var _0x349052=_0x23de59;_0x2d1713[_0x545ea5][_0x349052(0x283)]=_0x27c674;}),_0x45a4a9['forEach']((_0x2552a7,_0x349693)=>{var _0x4c889d=_0x23de59;_0x2d1713[_0x349693][_0x4c889d(0x1f8)]=_0x2552a7;}),_0x559fc6[_0x23de59(0x24d)]((_0x19d819,_0x1d07ee)=>{var _0x1ac0d1=_0x23de59;_0x2d1713[_0x1d07ee][_0x1ac0d1(0x228)]=_0x19d819;}),_0xdcb142[_0x23de59(0x24d)]((_0x10c634,_0x27ff9b)=>{var _0x48c5ea=_0x23de59;_0x2d1713[_0x27ff9b][_0x48c5ea(0x1e0)]=_0x10c634;}),_0x240689['forEach']((_0x2e7aaa,_0x4b3721)=>{_0x2d1713[_0x4b3721]['product_code']=_0x2e7aaa;}),_0x40bbdf['forEach']((_0x421b7d,_0x38fefd)=>{_0x2d1713[_0x38fefd]['level']=_0x421b7d;}),_0x35b482[_0x23de59(0x24d)]((_0x25a311,_0x562c90)=>{var _0x1ae231=_0x23de59;_0x2d1713[_0x562c90][_0x1ae231(0x21f)]=_0x25a311;});var _0x57c296=0x0;_0x2d1713[_0x23de59(0x24d)](_0x581f33=>{var _0x2e6868=_0x23de59;console['log']('foreach\x20newproduct',_0x581f33),(parseInt(_0x581f33[_0x2e6868(0x283)])<parseInt(_0x581f33[_0x2e6868(0x1f8)])||parseInt(_0x581f33[_0x2e6868(0x1f8)])==0x0)&&_0x57c296++;});if(_0x57c296!=0x0)return _0x524450[_0x23de59(0x280)]('errors',_0x23de59(0x277)),_0x514f0e[_0x23de59(0x1fc)](_0x23de59(0x224));_0x269d2d['sale_product']['forEach'](_0xab3fe1=>{var _0x268090=_0x23de59;const _0x3bf341=_0x29484c[_0x268090(0x230)]['map'](_0xf45b80=>{var _0x11ea76=_0x268090;_0xf45b80[_0x11ea76(0x2b5)]==_0xab3fe1[_0x11ea76(0x2b5)]&&_0xf45b80['bay']==_0xab3fe1[_0x11ea76(0x29f)]&&(_0xf45b80['product_stock']=parseInt(_0xf45b80['product_stock'])+parseInt(_0xab3fe1['quantity']));});}),await _0x29484c[_0x23de59(0x1ef)]();const _0xab36f=_0x2d1713[_0x23de59(0x27d)](_0x3cc6ca=>_0x3cc6ca['quantity']!=='0'&&_0x3cc6ca[_0x23de59(0x1f8)]!=='');_0x269d2d[_0x23de59(0x239)]=_0x1c4597,_0x269d2d[_0x23de59(0x2a7)]=_0x59144f,_0x269d2d[_0x23de59(0x271)]=_0x239c56,_0x269d2d[_0x23de59(0x29b)]=_0x249173,_0x269d2d[_0x23de59(0x256)]=_0xab36f,_0x269d2d[_0x23de59(0x210)]=_0x4685dc,_0x269d2d[_0x23de59(0x261)]=_0x5e5c03;const _0x24b4a5=await _0x269d2d[_0x23de59(0x1ef)](),_0x334a0c=await sales_finished[_0x23de59(0x221)]({'_id':_0x524450[_0x23de59(0x264)]['id']}),_0x276a21=await warehouse[_0x23de59(0x221)]({'name':_0x249173,'room':_0x5e5c03,'warehouse_category':_0x23de59(0x27b)});_0x334a0c[_0x23de59(0x256)][_0x23de59(0x24d)](_0x319d7d=>{var _0x2cb002=_0x23de59;const _0x55a7fa=_0x276a21['product_details'][_0x2cb002(0x251)](_0x4c339d=>{var _0x8e24f9=_0x2cb002;_0x4c339d['product_name']==_0x319d7d[_0x8e24f9(0x2b5)]&&_0x4c339d[_0x8e24f9(0x29f)]==_0x319d7d['bay']&&(_0x4c339d[_0x8e24f9(0x2a3)]=parseInt(_0x4c339d[_0x8e24f9(0x2a3)])-parseInt(_0x319d7d['quantity']));});}),console['log'](_0x23de59(0x1e8),_0x276a21),await _0x276a21['save']();const _0xfc70d1=await c_payment_data[_0x23de59(0x221)]({'invoice':_0x524450['body'][_0x23de59(0x239)]});_0xfc70d1[_0x23de59(0x2d5)]=_0x524450[_0x23de59(0x207)]['suppliers'],await _0xfc70d1['save'](),_0x524450[_0x23de59(0x280)]('success',_0x23de59(0x2a2)),_0x514f0e[_0x23de59(0x1fc)](_0x23de59(0x287));}catch(_0x26fea6){console[_0x23de59(0x216)](_0x26fea6);}}),router[a0_0x339b0b(0x25d)](a0_0x339b0b(0x2b9),auth,async(_0xad80ff,_0x87e168)=>{var _0x2a2633=a0_0x339b0b;try{const _0x2d3d6f=_0xad80ff[_0x2a2633(0x264)]['id'],{invoice:_0x572570,customer:_0x71b54,receivable_amount:_0x1c3211,received_amount:_0x3c47a1}=_0xad80ff[_0x2a2633(0x207)],_0x13421b=await sales[_0x2a2633(0x203)](_0x2d3d6f);console['log'](_0x13421b);var _0x9b34ff=_0x1c3211-_0x3c47a1;console[_0x2a2633(0x216)](_0x3c47a1),_0x13421b['received_amount']=parseFloat(_0x3c47a1)+parseFloat(_0x13421b[_0x2a2633(0x2ba)]),_0x13421b[_0x2a2633(0x2a6)]=_0x9b34ff,console[_0x2a2633(0x216)](_0x13421b);const _0x205b44=await _0x13421b['save'](),_0x270af9=await c_payment_data[_0x2a2633(0x221)]({'invoice':_0x572570});_0x270af9[_0x2a2633(0x235)]=_0x9b34ff,await _0x270af9[_0x2a2633(0x1ef)]();let _0x57377f=new Date(),_0x2e2891=('0'+_0x57377f['getDate']())['slice'](-0x2),_0x303c69=('0'+(_0x57377f['getMonth']()+0x1))[_0x2a2633(0x2aa)](-0x2),_0x1ea562=_0x57377f[_0x2a2633(0x23d)](),_0x960baf=_0x1ea562+'-'+_0x303c69+'-'+_0x2e2891;const _0x2c9f26=new customer_payment({'invoice':_0x572570,'date':_0x1ea562+'-'+_0x303c69+'-'+_0x2e2891,'customer':_0x71b54,'reason':_0x2a2633(0x201),'amount':_0x3c47a1}),_0x82932a=await _0x2c9f26[_0x2a2633(0x1ef)]();_0xad80ff[_0x2a2633(0x280)](_0x2a2633(0x248),'payment\x20successfull'),_0x87e168[_0x2a2633(0x1fc)](_0x2a2633(0x21b));}catch(_0x550705){console['log'](_0x550705);}}),router[a0_0x339b0b(0x2cc)](a0_0x339b0b(0x2a8),auth,async(_0x32acef,_0x2877d3)=>{var _0x49ba5e=a0_0x339b0b;try{const {username:_0x3f16a4,email:_0x2b09b,role:_0x43e63f}=_0x32acef[_0x49ba5e(0x1da)],_0x1459fe=_0x32acef[_0x49ba5e(0x1da)],_0x584a67=await profile[_0x49ba5e(0x221)]({'email':_0x1459fe[_0x49ba5e(0x1fa)]}),_0x2bbac3=await master_shop[_0x49ba5e(0x257)]();console[_0x49ba5e(0x216)](_0x49ba5e(0x28f),_0x2bbac3);const _0x12e57c=_0x32acef[_0x49ba5e(0x264)]['id'],_0x4b17d3=await sales[_0x49ba5e(0x203)](_0x12e57c);console[_0x49ba5e(0x216)](_0x4b17d3);const _0x52de59=await customer['findOne']({'name':_0x4b17d3['customer']});console['log'](_0x52de59);if(_0x2bbac3[0x0]['language']==_0x49ba5e(0x209)){var _0x4d7a68=users[_0x49ba5e(0x244)];console[_0x49ba5e(0x216)](_0x4d7a68);}else{if(_0x2bbac3[0x0][_0x49ba5e(0x2dd)]==_0x49ba5e(0x2a9))var _0x4d7a68=users[_0x49ba5e(0x2a9)];else{if(_0x2bbac3[0x0][_0x49ba5e(0x2dd)]==_0x49ba5e(0x2dc))var _0x4d7a68=users[_0x49ba5e(0x2dc)];else{if(_0x2bbac3[0x0]['language']==_0x49ba5e(0x20f))var _0x4d7a68=users[_0x49ba5e(0x20f)];else{if(_0x2bbac3[0x0][_0x49ba5e(0x2dd)]=='French')var _0x4d7a68=users[_0x49ba5e(0x2b8)];else{if(_0x2bbac3[0x0]['language']==_0x49ba5e(0x20e))var _0x4d7a68=users[_0x49ba5e(0x27a)];else{if(_0x2bbac3[0x0]['language']==_0x49ba5e(0x206))var _0x4d7a68=users[_0x49ba5e(0x206)];else{if(_0x2bbac3[0x0][_0x49ba5e(0x2dd)]==_0x49ba5e(0x2ac))var _0x4d7a68=users['Arabic'];}}}}}}}_0x2877d3[_0x49ba5e(0x28e)](_0x49ba5e(0x2e0),{'success':_0x32acef[_0x49ba5e(0x280)]('success'),'errors':_0x32acef['flash'](_0x49ba5e(0x269)),'role':_0x1459fe,'profile':_0x584a67,'master_shop':_0x2bbac3,'customers':_0x52de59,'sales':_0x4b17d3,'language':_0x4d7a68});}catch(_0x599863){console['log'](_0x599863);}}),router[a0_0x339b0b(0x2cc)](a0_0x339b0b(0x21c),auth,async(_0x50fefe,_0x3b9614)=>{var _0x28ecec=a0_0x339b0b;try{const {username:_0xbce103,email:_0x4df11e,role:_0x2ecd60}=_0x50fefe[_0x28ecec(0x1da)],_0xea66b0=_0x50fefe[_0x28ecec(0x1da)],_0x513b6e=await profile[_0x28ecec(0x221)]({'email':_0xea66b0['email']}),_0x5247d5=await master_shop[_0x28ecec(0x257)](),_0x2bafaf=_0x50fefe['params']['id'],_0x14ba57=await sales_finished['findById'](_0x2bafaf),_0x27bc6c=await warehouse['aggregate']([{'$match':{'name':_0x14ba57['warehouse_name']}},{'$unwind':_0x28ecec(0x2ae)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x28ecec(0x212)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x28ecec(0x263)},'bin':{'$first':_0x28ecec(0x231)},'type':{'$first':_0x28ecec(0x2d3)},'floorlevel':{'$first':_0x28ecec(0x2ce)},'primary_code':{'$first':_0x28ecec(0x2c9)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x28ecec(0x2ab)},'rack':{'$first':_0x28ecec(0x211)},'expiry_date':{'$first':_0x28ecec(0x2d2)},'production_date':{'$first':_0x28ecec(0x2d0)},'unit':{'$first':_0x28ecec(0x2da)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0x28ecec(0x240)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x9668a4=await product[_0x28ecec(0x257)]({}),_0x6d418a=await warehouse[_0x28ecec(0x289)]([{'$match':{'status':_0x28ecec(0x214),'warehouse_category':_0x28ecec(0x27b),'name':{'$ne':_0x28ecec(0x220),'$ne':_0x28ecec(0x2c1)}}},{'$group':{'_id':'$name','name':{'$first':_0x28ecec(0x227)}}},{'$sort':{'name':0x1}}]);var _0x1c9c95=['Return\x20Rooms'];const _0x2059e4=await warehouse[_0x28ecec(0x289)]([{'$match':{'status':_0x28ecec(0x214),'name':_0x28ecec(0x2c1)}},{'$group':{'_id':_0x28ecec(0x227),'name':{'$first':_0x28ecec(0x227)}}},{'$sort':{'name':0x1}}]);if(_0x5247d5[0x0]['language']==_0x28ecec(0x209)){var _0x4b2df8=users[_0x28ecec(0x244)];console[_0x28ecec(0x216)](_0x4b2df8);}else{if(_0x5247d5[0x0]['language']==_0x28ecec(0x2a9))var _0x4b2df8=users['Hindi'];else{if(_0x5247d5[0x0][_0x28ecec(0x2dd)]=='German')var _0x4b2df8=users[_0x28ecec(0x2dc)];else{if(_0x5247d5[0x0][_0x28ecec(0x2dd)]=='Spanish')var _0x4b2df8=users[_0x28ecec(0x20f)];else{if(_0x5247d5[0x0][_0x28ecec(0x2dd)]==_0x28ecec(0x2b8))var _0x4b2df8=users[_0x28ecec(0x2b8)];else{if(_0x5247d5[0x0][_0x28ecec(0x2dd)]==_0x28ecec(0x20e))var _0x4b2df8=users[_0x28ecec(0x27a)];else{if(_0x5247d5[0x0][_0x28ecec(0x2dd)]==_0x28ecec(0x206))var _0x4b2df8=users[_0x28ecec(0x206)];else{if(_0x5247d5[0x0][_0x28ecec(0x2dd)]==_0x28ecec(0x2ac))var _0x4b2df8=users[_0x28ecec(0x25e)];}}}}}}}_0x3b9614[_0x28ecec(0x28e)](_0x28ecec(0x2d8),{'success':_0x50fefe[_0x28ecec(0x280)]('success'),'errors':_0x50fefe['flash'](_0x28ecec(0x269)),'role':_0xea66b0,'profile':_0x513b6e,'user':_0x14ba57,'stock':_0x27bc6c,'master_shop':_0x5247d5,'unit':_0x9668a4,'language':_0x4b2df8,'warehouses':_0x6d418a,'rooms':_0x1c9c95,'warehouse_QA':_0x2059e4});}catch(_0x3d4425){console[_0x28ecec(0x216)](_0x3d4425),_0x3b9614[_0x28ecec(0x24f)](0xc8)[_0x28ecec(0x1ee)]({'message':_0x3d4425[_0x28ecec(0x26d)]});}}),router[a0_0x339b0b(0x25d)]('/view/return_sales/:id',auth,async(_0x353218,_0x17b9f9)=>{var _0x1d10ac=a0_0x339b0b;if(_0x353218['body'][_0x1d10ac(0x21a)]=='QA')try{const {invoice:_0x82199e,date:_0x5ddc14,warehouse_name:_0xd8e8c7,product_name:_0x1b3b2e,primary_code:_0x379f93,secondary_code:_0x15048f,product_code:_0x3608e5,sales_quantity:_0x2d77ed,stocks:_0x45a972,return_qty:_0x4d85cd,Room_name:_0x45245e,to_warehouse_name_QA:_0x5ca3ab,to_Room_name_QA:_0x210949,note:_0x1f7c6e,for_categorize:_0x49d47c,product_name_QA1:_0x5990e9}=_0x353218[_0x1d10ac(0x207)];if(typeof _0x5990e9==_0x1d10ac(0x2c4))var _0x3cb82f=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x238)]],_0x186cbf=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x24e)]],_0x44f7cf=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x28c)]],_0x3897f8=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x225)]],_0x76ae46=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x1e1)]],_0xea75c=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x226)]],_0x4f76f7=[_0x353218['body'][_0x1d10ac(0x276)]],_0x2ef771=[_0x353218[_0x1d10ac(0x207)]['maxPerUnit_QA']],_0x158389=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x205)]],_0x4d68d9=[_0x353218['body'][_0x1d10ac(0x24a)]],_0x395f8b=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x290)]],_0x5604df=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x2cf)]],_0x2088a3=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x21d)]],_0x19be3a=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x2bc)]];else var _0x3cb82f=[..._0x353218['body'][_0x1d10ac(0x238)]],_0x186cbf=[..._0x353218['body'][_0x1d10ac(0x24e)]],_0x44f7cf=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x28c)]],_0x3897f8=[..._0x353218[_0x1d10ac(0x207)]['product_code_QA']],_0x76ae46=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x1e1)]],_0xea75c=[..._0x353218['body'][_0x1d10ac(0x226)]],_0x4f76f7=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x276)]],_0x2ef771=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x1d1)]],_0x158389=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x205)]],_0x4d68d9=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x24a)]],_0x395f8b=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x290)]],_0x5604df=[..._0x353218[_0x1d10ac(0x207)]['unit_QA']],_0x2088a3=[..._0x353218['body'][_0x1d10ac(0x21d)]],_0x19be3a=[..._0x353218['body']['expiry_date_QA']];const _0x4e2877=_0x3cb82f[_0x1d10ac(0x251)](_0x21ac67=>{return _0x21ac67={'product_name':_0x21ac67};});_0x186cbf['forEach']((_0x5eb91f,_0x457293)=>{var _0x3c01c9=_0x1d10ac;_0x4e2877[_0x457293][_0x3c01c9(0x228)]=_0x5eb91f;}),_0x44f7cf[_0x1d10ac(0x24d)]((_0x3dc8ac,_0x4ccf37)=>{var _0xe59b1a=_0x1d10ac;_0x4e2877[_0x4ccf37][_0xe59b1a(0x1e0)]=_0x3dc8ac;}),_0x3897f8[_0x1d10ac(0x24d)]((_0x426c10,_0x447993)=>{var _0x2f9e78=_0x1d10ac;_0x4e2877[_0x447993][_0x2f9e78(0x29a)]=_0x426c10;}),_0x76ae46[_0x1d10ac(0x24d)]((_0x2ce18f,_0x4f1428)=>{_0x4e2877[_0x4f1428]['sale_qty']=_0x2ce18f;}),_0xea75c[_0x1d10ac(0x24d)]((_0x12dec7,_0x236555)=>{var _0x4173b3=_0x1d10ac;_0x4e2877[_0x236555][_0x4173b3(0x283)]=_0x12dec7;}),_0x4f76f7[_0x1d10ac(0x24d)]((_0x43f911,_0x45da68)=>{var _0x46ed1e=_0x1d10ac;_0x4e2877[_0x45da68][_0x46ed1e(0x272)]=_0x43f911;}),_0x2ef771[_0x1d10ac(0x24d)]((_0x446791,_0x256556)=>{var _0x4c11be=_0x1d10ac;_0x4e2877[_0x256556][_0x4c11be(0x1d5)]=_0x446791;}),_0x158389[_0x1d10ac(0x24d)]((_0x146e4b,_0x2614ab)=>{var _0xdde8d4=_0x1d10ac;_0x4e2877[_0x2614ab][_0xdde8d4(0x222)]=_0x146e4b;}),_0x4d68d9['forEach']((_0x127312,_0xa25c5b)=>{_0x4e2877[_0xa25c5b]['batch_code']=_0x127312;}),_0x395f8b['forEach']((_0x1d97f9,_0x12aaf5)=>{var _0x1d83f3=_0x1d10ac;_0x4e2877[_0x12aaf5][_0x1d83f3(0x2a1)]=_0x1d97f9;}),_0x5604df[_0x1d10ac(0x24d)]((_0x42cad8,_0x233e3a)=>{var _0x378d86=_0x1d10ac;_0x4e2877[_0x233e3a][_0x378d86(0x1f2)]=_0x42cad8;}),_0x2088a3[_0x1d10ac(0x24d)]((_0x5659a3,_0x15b368)=>{_0x4e2877[_0x15b368]['production_date']=_0x5659a3;}),_0x19be3a[_0x1d10ac(0x24d)]((_0x1b955e,_0x133084)=>{var _0x5eba08=_0x1d10ac;_0x4e2877[_0x133084][_0x5eba08(0x21f)]=_0x1b955e;});const _0x14f0c7=await sales_finished[_0x1d10ac(0x221)]({'invoice':_0x82199e});_0x14f0c7['return_data']=_0x1d10ac(0x23b);const _0x410cd1=await _0x14f0c7['save'](),_0x32718e=new sales_return_finished({'invoice':_0x82199e,'customer':_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x2a7)],'date':_0x5ddc14,'warehouse_name':_0xd8e8c7,'room':_0x45245e,'ToWarehouse':_0x5ca3ab,'ToRoom':_0x210949,'return_sale_QA':_0x4e2877,'note':_0x1f7c6e,'warehouse_cat':_0x49d47c}),_0x46d473=await _0x32718e['save'](),_0x1c67cb=await sales_return_finished['findOne']({'invoice':_0x82199e}),_0x46cf04=await warehouse[_0x1d10ac(0x221)]({'name':_0x5ca3ab,'room':_0x210949});_0x1c67cb[_0x1d10ac(0x26f)][_0x1d10ac(0x24d)](_0x58914e=>{var _0x44078c=_0x1d10ac,_0x25eadf=0x0;const _0x30ab1f=_0x46cf04[_0x44078c(0x230)]['map'](_0x356f0b=>{var _0x4fc64e=_0x44078c;_0x356f0b[_0x4fc64e(0x2b5)]==_0x58914e[_0x4fc64e(0x2b5)]&&_0x356f0b[_0x4fc64e(0x21f)]==_0x58914e[_0x4fc64e(0x21f)]&&_0x356f0b[_0x4fc64e(0x295)]==_0x58914e[_0x4fc64e(0x295)]&&_0x356f0b[_0x4fc64e(0x275)]==_0x58914e[_0x4fc64e(0x275)]&&(_0x356f0b[_0x4fc64e(0x2a3)]=parseInt(_0x356f0b[_0x4fc64e(0x2a3)])+parseInt(_0x58914e[_0x4fc64e(0x272)]),_0x25eadf++);});_0x25eadf=='0'&&(_0x46cf04[_0x44078c(0x230)]=_0x46cf04[_0x44078c(0x230)]['concat']({'product_name':_0x58914e['product_name'],'product_stock':_0x58914e[_0x44078c(0x272)],'primary_code':_0x58914e[_0x44078c(0x228)],'secondary_code':_0x58914e[_0x44078c(0x1e0)],'product_code':_0x58914e[_0x44078c(0x29a)],'batch_code':_0x58914e['batch_code'],'maxPerUnit':_0x58914e['maxPerUnit'],'production_date':_0x58914e[_0x44078c(0x295)],'expiry_date':_0x58914e[_0x44078c(0x21f)],'secondary_unit':_0x58914e[_0x44078c(0x2a1)],'unit':_0x58914e[_0x44078c(0x1f2)],'maxProducts':_0x58914e[_0x44078c(0x222)],'bay':_0x58914e[_0x44078c(0x29f)]}));}),await _0x46cf04['save']();const _0x35b262=new c_payment_data({'invoice':_0x82199e,'customer':_0x353218[_0x1d10ac(0x207)]['customer'],'reason':_0x1d10ac(0x2e5)});await _0x35b262[_0x1d10ac(0x1ef)]();const _0x33f71c=await master_shop[_0x1d10ac(0x257)](),_0x3f21ce=await email_settings[_0x1d10ac(0x221)](),_0x194b11=await customer[_0x1d10ac(0x221)]({'name':_0x353218[_0x1d10ac(0x207)]['customer']});_0x33f71c[0x0]['currency_placement']==0x1?(right_currency=_0x33f71c[0x0][_0x1d10ac(0x233)],left_currency=''):(right_currency='',left_currency=_0x33f71c[0x0][_0x1d10ac(0x233)]);var _0x1ea7dd=_0x3cb82f,_0x1696d9=_0x4f76f7,_0x380978='',_0xb7db44;for(_0xb7db44 in _0x1ea7dd){_0x380978+=_0x1d10ac(0x28d)+_0x1d10ac(0x204)+_0x1ea7dd[_0xb7db44]+_0x1d10ac(0x282)+_0x1d10ac(0x204)+_0x1696d9[_0xb7db44]+_0x1d10ac(0x282)+_0x1d10ac(0x1e5);}console['log'](_0x1d10ac(0x24c),_0x380978);let _0x10e02b=nodemailer[_0x1d10ac(0x281)]({'service':_0x1d10ac(0x202),'auth':{'user':_0x3f21ce[_0x1d10ac(0x1fa)],'pass':_0x3f21ce['password']}}),_0x59c04b={'from':_0x3f21ce[_0x1d10ac(0x1fa)],'to':_0x194b11[_0x1d10ac(0x1fa)],'subject':_0x1d10ac(0x223),'attachments':[{'filename':_0x1d10ac(0x200),'path':__dirname+_0x1d10ac(0x2d7)+_0x1d10ac(0x1fe)+_0x33f71c[0x0][_0x1d10ac(0x294)],'cid':_0x1d10ac(0x2b3)}],'html':'<!DOCTYPE\x20html>'+_0x1d10ac(0x1e4)+_0x1d10ac(0x2d1)+_0x1d10ac(0x1e9)+_0x1d10ac(0x2de)+_0x1d10ac(0x1e9)+_0x1d10ac(0x1e6)+_0x1d10ac(0x25b)+'<div>'+'<h2>\x20'+_0x33f71c[0x0][_0x1d10ac(0x1ed)]+'\x20</h2>'+'</div>'+_0x1d10ac(0x25b)+_0x1d10ac(0x25f)+_0x1d10ac(0x1e9)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x82199e+'\x20'+_0x1d10ac(0x2bd)+_0x1d10ac(0x1f3)+_0x5ddc14+'\x20'+_0x1d10ac(0x20d)+'</h5>'+_0x1d10ac(0x25b)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1d10ac(0x255)+_0x1d10ac(0x28d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1d10ac(0x267)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x1d10ac(0x2b7)+_0x1d10ac(0x1e5)+_0x1d10ac(0x23a)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x380978+'\x20'+'</tbody>'+_0x1d10ac(0x29e)+_0x1d10ac(0x1e9)+_0x1d10ac(0x1d8)+_0x1d10ac(0x1d2)+_0x33f71c[0x0][_0x1d10ac(0x1ed)]+_0x1d10ac(0x27c)+_0x1d10ac(0x25b)+_0x1d10ac(0x25b)+'</body></html>'};_0x10e02b[_0x1d10ac(0x23f)](_0x59c04b,function(_0x1600e8,_0x1eb790){var _0x4f5f83=_0x1d10ac;_0x1600e8?(console[_0x4f5f83(0x216)](_0x1600e8),console['log'](_0x4f5f83(0x217))):console[_0x4f5f83(0x216)](_0x4f5f83(0x1e7));}),_0x353218[_0x1d10ac(0x280)]('success','sales\x20item\x20return\x20successfull'),_0x17b9f9[_0x1d10ac(0x1fc)](_0x1d10ac(0x287));}catch(_0x281dec){_0x17b9f9[_0x1d10ac(0x24f)](0xc8)[_0x1d10ac(0x1ee)]({'message1':_0x281dec[_0x1d10ac(0x26d)]});}else{if(_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x21a)]=='GS')try{const {invoice:_0x2f08e8,date:_0x2f67ba,warehouse_name:_0x2f12fe,product_name:_0x43f031,primary_code:_0x386974,secondary_code:_0x25a9b4,product_code:_0x372349,sales_quantity:_0x60ce1d,stocks:_0x25e250,return_qty:_0x3da308,Room_name:_0x5bf72c,to_warehouse_name:_0x310821,to_Room_name:_0x3065d1,note:_0x4690d2,level:_0x2644ee,isle:_0x4341ac,pallet:_0x50fcc2,for_categorize:_0x29413b}=_0x353218['body'];if(typeof _0x43f031==_0x1d10ac(0x2c4))var _0x3cb82f=[_0x353218['body'][_0x1d10ac(0x2b5)]],_0x186cbf=[_0x353218[_0x1d10ac(0x207)]['primary_code']],_0x44f7cf=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x1e0)]],_0x3897f8=[_0x353218['body'][_0x1d10ac(0x29a)]],_0x76ae46=[_0x353218['body'][_0x1d10ac(0x232)]],_0x4f76f7=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x272)]],_0x21b586=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x29f)]],_0x2ef771=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x1d5)]],_0x158389=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x222)]],_0x4d68d9=[_0x353218[_0x1d10ac(0x207)]['batch_code']],_0x395f8b=[_0x353218['body'][_0x1d10ac(0x2a1)]],_0x5604df=[_0x353218['body'][_0x1d10ac(0x1f2)]],_0x2088a3=[_0x353218[_0x1d10ac(0x207)]['production_date']],_0x19be3a=[_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x21f)]];else var _0x3cb82f=[..._0x353218[_0x1d10ac(0x207)]['product_name']],_0x186cbf=[..._0x353218[_0x1d10ac(0x207)]['primary_code']],_0x44f7cf=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x1e0)]],_0x3897f8=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x29a)]],_0x76ae46=[..._0x353218['body'][_0x1d10ac(0x232)]],_0x4f76f7=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x272)]],_0x21b586=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x29f)]],_0x2ef771=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x1d5)]],_0x158389=[..._0x353218['body'][_0x1d10ac(0x222)]],_0x4d68d9=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x275)]],_0x395f8b=[..._0x353218['body'][_0x1d10ac(0x2a1)]],_0x5604df=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x1f2)]],_0x2088a3=[..._0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x295)]],_0x19be3a=[..._0x353218['body'][_0x1d10ac(0x21f)]];const _0x454077=_0x3cb82f[_0x1d10ac(0x251)](_0x4ee7ba=>{return _0x4ee7ba={'product_name':_0x4ee7ba};});_0x186cbf['forEach']((_0x119b06,_0x3ad9e8)=>{var _0x1ae719=_0x1d10ac;_0x454077[_0x3ad9e8][_0x1ae719(0x228)]=_0x119b06;}),_0x44f7cf[_0x1d10ac(0x24d)]((_0x8be38a,_0xc5f8f8)=>{_0x454077[_0xc5f8f8]['secondary_code']=_0x8be38a;}),_0x3897f8[_0x1d10ac(0x24d)]((_0x5b41bf,_0x6f7b37)=>{var _0x53e8fd=_0x1d10ac;_0x454077[_0x6f7b37][_0x53e8fd(0x29a)]=_0x5b41bf;}),_0x76ae46[_0x1d10ac(0x24d)]((_0x31dd09,_0x3bb888)=>{var _0x399602=_0x1d10ac;_0x454077[_0x3bb888][_0x399602(0x242)]=_0x31dd09;}),_0x4f76f7['forEach']((_0x3add64,_0x40f9dc)=>{var _0x4e962b=_0x1d10ac;_0x454077[_0x40f9dc][_0x4e962b(0x272)]=_0x3add64;}),_0x21b586[_0x1d10ac(0x24d)]((_0x135e2f,_0x55ae1a)=>{var _0x235938=_0x1d10ac;_0x454077[_0x55ae1a][_0x235938(0x29f)]=_0x135e2f;}),_0x2ef771[_0x1d10ac(0x24d)]((_0x5fe3fb,_0x52fa93)=>{var _0x4aeeda=_0x1d10ac;_0x454077[_0x52fa93][_0x4aeeda(0x1d5)]=_0x5fe3fb;}),_0x158389[_0x1d10ac(0x24d)]((_0x17d66f,_0x4adc03)=>{var _0x3a621f=_0x1d10ac;_0x454077[_0x4adc03][_0x3a621f(0x222)]=_0x17d66f;}),_0x4d68d9[_0x1d10ac(0x24d)]((_0x32c20e,_0x1f59d5)=>{_0x454077[_0x1f59d5]['batch_code']=_0x32c20e;}),_0x395f8b[_0x1d10ac(0x24d)]((_0x4b7ea3,_0x3600ce)=>{var _0x8bab09=_0x1d10ac;_0x454077[_0x3600ce][_0x8bab09(0x2a1)]=_0x4b7ea3;}),_0x5604df[_0x1d10ac(0x24d)]((_0x56477f,_0x427a2d)=>{var _0x648f76=_0x1d10ac;_0x454077[_0x427a2d][_0x648f76(0x1f2)]=_0x56477f;}),_0x2088a3['forEach']((_0x4245a8,_0x203272)=>{var _0x27a5ec=_0x1d10ac;_0x454077[_0x203272][_0x27a5ec(0x295)]=_0x4245a8;}),_0x19be3a[_0x1d10ac(0x24d)]((_0x5ee53a,_0x1487ff)=>{var _0x574683=_0x1d10ac;_0x454077[_0x1487ff][_0x574683(0x21f)]=_0x5ee53a;});var _0x3b1296=0x0;_0x454077['forEach'](_0x459f23=>{var _0x4758b8=_0x1d10ac;(parseInt(_0x459f23['sale_qty'])<parseInt(_0x459f23[_0x4758b8(0x272)])||parseInt(_0x459f23[_0x4758b8(0x283)])<parseInt(_0x459f23[_0x4758b8(0x272)])&&parseInt(_0x459f23[_0x4758b8(0x242)])>parseInt(_0x459f23[_0x4758b8(0x272)])||parseInt(_0x459f23[_0x4758b8(0x272)])==0x0)&&_0x3b1296++;});if(_0x3b1296!=0x0)return _0x353218[_0x1d10ac(0x280)]('errors',_0x1d10ac(0x2a0)),_0x17b9f9[_0x1d10ac(0x1fc)]('back');const _0x193755=await sales_finished['findOne']({'invoice':_0x2f08e8});_0x193755[_0x1d10ac(0x2c0)]=_0x1d10ac(0x23b);const _0x40d587=await _0x193755[_0x1d10ac(0x1ef)](),_0x39a608=new sales_return_finished({'invoice':_0x2f08e8,'customer':_0x353218[_0x1d10ac(0x207)][_0x1d10ac(0x2a7)],'date':_0x2f67ba,'warehouse_name':_0x2f12fe,'room':_0x5bf72c,'ToWarehouse':_0x310821,'ToRoom':_0x3065d1,'return_sale':_0x454077,'note':_0x4690d2,'warehouse_cat':_0x29413b}),_0x4abaf4=await _0x39a608[_0x1d10ac(0x1ef)](),_0xdfbb65=await sales_return_finished['findOne']({'invoice':_0x2f08e8}),_0x391445=await warehouse['findOne']({'name':_0x310821,'room':_0x3065d1,'warehouse_category':'Finished\x20Goods'});_0xdfbb65[_0x1d10ac(0x21e)][_0x1d10ac(0x24d)](_0x11f1c6=>{var _0x394519=_0x1d10ac,_0x56dd7c=0x0;const _0x2075ac=_0x391445[_0x394519(0x230)][_0x394519(0x251)](_0x32863e=>{var _0x5e6b3b=_0x394519;_0x32863e[_0x5e6b3b(0x2b5)]==_0x11f1c6[_0x5e6b3b(0x2b5)]&&_0x32863e[_0x5e6b3b(0x29f)]==_0x11f1c6[_0x5e6b3b(0x29f)]&&_0x32863e[_0x5e6b3b(0x21f)]==_0x11f1c6[_0x5e6b3b(0x21f)]&&_0x32863e['production_date']==_0x11f1c6[_0x5e6b3b(0x295)]&&_0x32863e['batch_code']==_0x11f1c6[_0x5e6b3b(0x275)]&&(_0x32863e[_0x5e6b3b(0x2a3)]=parseInt(_0x32863e[_0x5e6b3b(0x2a3)])+parseInt(_0x11f1c6[_0x5e6b3b(0x272)]),_0x56dd7c++);});_0x56dd7c=='0'&&(_0x391445[_0x394519(0x230)]=_0x391445['product_details'][_0x394519(0x2c8)]({'product_name':_0x11f1c6[_0x394519(0x2b5)],'product_stock':_0x11f1c6[_0x394519(0x272)],'primary_code':_0x11f1c6[_0x394519(0x228)],'secondary_code':_0x11f1c6[_0x394519(0x1e0)],'product_code':_0x11f1c6[_0x394519(0x29a)],'bay':_0x11f1c6[_0x394519(0x29f)],'batch_code':_0x11f1c6[_0x394519(0x275)],'maxPerUnit':_0x11f1c6['maxPerUnit'],'production_date':_0x11f1c6[_0x394519(0x295)],'expiry_date':_0x11f1c6['expiry_date'],'secondary_unit':_0x11f1c6[_0x394519(0x2a1)],'unit':_0x11f1c6['unit'],'maxProducts':_0x11f1c6[_0x394519(0x222)]}));}),await _0x391445[_0x1d10ac(0x1ef)](),console[_0x1d10ac(0x216)](_0x353218['body']);const _0x214144=new c_payment_data({'invoice':_0x2f08e8,'customer':_0x353218[_0x1d10ac(0x207)]['customer'],'reason':_0x1d10ac(0x2e5)});await _0x214144['save']();const _0x4a6d64=await master_shop['find']();console[_0x1d10ac(0x216)](_0x1d10ac(0x1f5),_0x4a6d64[0x0][_0x1d10ac(0x294)]);const _0x42f5a9=await email_settings[_0x1d10ac(0x221)](),_0x4c3cea=await customer[_0x1d10ac(0x221)]({'name':_0x353218[_0x1d10ac(0x207)]['customer']});console[_0x1d10ac(0x216)](_0x1d10ac(0x1dd),_0x4c3cea);_0x4a6d64[0x0][_0x1d10ac(0x29d)]==0x1?(right_currency=_0x4a6d64[0x0][_0x1d10ac(0x233)],left_currency=''):(right_currency='',left_currency=_0x4a6d64[0x0][_0x1d10ac(0x233)]);var _0x1ea7dd=_0x3cb82f,_0x1696d9=_0x4f76f7,_0x380978='',_0xb7db44;for(_0xb7db44 in _0x1ea7dd){_0x380978+=_0x1d10ac(0x28d)+_0x1d10ac(0x204)+_0x1ea7dd[_0xb7db44]+_0x1d10ac(0x282)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1696d9[_0xb7db44]+'</td>'+'</tr>';}console[_0x1d10ac(0x216)](_0x1d10ac(0x24c),_0x380978);let _0x30e5fd=nodemailer['createTransport']({'service':_0x1d10ac(0x202),'auth':{'user':_0x42f5a9[_0x1d10ac(0x1fa)],'pass':_0x42f5a9[_0x1d10ac(0x259)]}}),_0x2b6ccd={'from':_0x42f5a9[_0x1d10ac(0x1fa)],'to':_0x4c3cea[_0x1d10ac(0x1fa)],'subject':_0x1d10ac(0x223),'attachments':[{'filename':'Logo.png','path':__dirname+_0x1d10ac(0x2d7)+_0x1d10ac(0x1fe)+_0x4a6d64[0x0][_0x1d10ac(0x294)],'cid':_0x1d10ac(0x2b3)}],'html':'<!DOCTYPE\x20html>'+_0x1d10ac(0x1e4)+_0x1d10ac(0x2d1)+_0x1d10ac(0x1e9)+_0x1d10ac(0x2de)+_0x1d10ac(0x1e9)+_0x1d10ac(0x1e6)+_0x1d10ac(0x25b)+_0x1d10ac(0x1e9)+'<h2>\x20'+_0x4a6d64[0x0][_0x1d10ac(0x1ed)]+'\x20</h2>'+'</div>'+_0x1d10ac(0x25b)+_0x1d10ac(0x25f)+'<div>'+_0x1d10ac(0x1d3)+_0x1d10ac(0x20c)+_0x2f08e8+'\x20'+_0x1d10ac(0x2bd)+'\x20Order\x20Date\x20:\x20'+_0x2f67ba+'\x20'+_0x1d10ac(0x20d)+'</h5>'+_0x1d10ac(0x25b)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1d10ac(0x255)+_0x1d10ac(0x28d)+_0x1d10ac(0x2e1)+_0x1d10ac(0x267)+_0x1d10ac(0x254)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x1d10ac(0x1e5)+_0x1d10ac(0x23a)+_0x1d10ac(0x215)+'\x20'+_0x380978+'\x20'+_0x1d10ac(0x284)+_0x1d10ac(0x29e)+_0x1d10ac(0x1e9)+'<strong>\x20Regards\x20</strong>'+_0x1d10ac(0x1d2)+_0x4a6d64[0x0][_0x1d10ac(0x1ed)]+_0x1d10ac(0x27c)+_0x1d10ac(0x25b)+_0x1d10ac(0x25b)+_0x1d10ac(0x1f1)};_0x30e5fd[_0x1d10ac(0x23f)](_0x2b6ccd,function(_0x5bf470,_0x4a15ac){var _0x1168f6=_0x1d10ac;_0x5bf470?(console[_0x1168f6(0x216)](_0x5bf470),console['log'](_0x1168f6(0x217))):console['log'](_0x1168f6(0x1e7));}),_0x353218[_0x1d10ac(0x280)](_0x1d10ac(0x248),'sales\x20item\x20return\x20successfull'),_0x17b9f9[_0x1d10ac(0x1fc)](_0x1d10ac(0x287));}catch(_0x440399){console[_0x1d10ac(0x216)](_0x440399),_0x17b9f9[_0x1d10ac(0x24f)](0xc8)['json']({'message1':_0x440399[_0x1d10ac(0x26d)]});}}}),router[a0_0x339b0b(0x2cc)](a0_0x339b0b(0x26c),auth,async(_0x45c423,_0x3242dc)=>{var _0x139a94=a0_0x339b0b;try{const {username:_0x2f69af,email:_0x6c4b72,role:_0x3b3d78}=_0x45c423['user'],_0x370f90=_0x45c423[_0x139a94(0x1da)],_0x265ac2=await profile[_0x139a94(0x221)]({'email':_0x370f90[_0x139a94(0x1fa)]}),_0x8f882c=await master_shop[_0x139a94(0x257)]();console[_0x139a94(0x216)](_0x139a94(0x1eb),_0x8f882c);const _0x473a7c=_0x45c423[_0x139a94(0x264)]['id'],_0x40e6e3=await sales[_0x139a94(0x203)](_0x473a7c);console[_0x139a94(0x216)](_0x139a94(0x2d6),_0x40e6e3);if(_0x8f882c[0x0]['language']==_0x139a94(0x209))var _0x4e836a=users[_0x139a94(0x244)];else{if(_0x8f882c[0x0][_0x139a94(0x2dd)]=='Hindi')var _0x4e836a=users[_0x139a94(0x2a9)];else{if(_0x8f882c[0x0][_0x139a94(0x2dd)]=='German')var _0x4e836a=users[_0x139a94(0x2dc)];else{if(_0x8f882c[0x0][_0x139a94(0x2dd)]==_0x139a94(0x20f))var _0x4e836a=users['Spanish'];else{if(_0x8f882c[0x0][_0x139a94(0x2dd)]==_0x139a94(0x2b8))var _0x4e836a=users['French'];else{if(_0x8f882c[0x0][_0x139a94(0x2dd)]==_0x139a94(0x20e))var _0x4e836a=users[_0x139a94(0x27a)];else{if(_0x8f882c[0x0][_0x139a94(0x2dd)]==_0x139a94(0x206))var _0x4e836a=users[_0x139a94(0x206)];else{if(_0x8f882c[0x0]['language']==_0x139a94(0x2ac))var _0x4e836a=users['Arabic'];}}}}}}}_0x3242dc[_0x139a94(0x28e)](_0x139a94(0x297),{'success':_0x45c423[_0x139a94(0x280)]('success'),'errors':_0x45c423[_0x139a94(0x280)](_0x139a94(0x269)),'role':_0x370f90,'profile':_0x265ac2,'alldata':_0x40e6e3,'master_shop':_0x8f882c,'language':_0x4e836a});}catch(_0x28a70d){console[_0x139a94(0x216)](_0x28a70d);}}),router['post'](a0_0x339b0b(0x1ff),async(_0xb89644,_0x3c04e9)=>{var _0x4fd7ee=a0_0x339b0b;const {product_code:_0x7e8335,warehouse_name:_0x4c235f,rooms_data:_0x304c37,Roomslist:_0x5e1b2e}=_0xb89644[_0x4fd7ee(0x207)],_0x46476f=_0x5e1b2e[_0x4fd7ee(0x22a)](','),_0x514244=[];async function _0x30823f(_0x265afe){var _0x15d8a7=_0x4fd7ee;const _0x8f2fab=await warehouse[_0x15d8a7(0x289)]([{'$match':{'name':_0x4c235f,'room':_0x265afe}},{'$unwind':_0x15d8a7(0x2ae)},{'$match':{'product_details.primary_code':_0x7e8335}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x15d8a7(0x212)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x15d8a7(0x2c9)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x15d8a7(0x292)},'level':{'$first':_0x15d8a7(0x263)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x15d8a7(0x2d3)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x15d8a7(0x2ab)},'rack':{'$first':_0x15d8a7(0x211)},'expiry_date':{'$first':_0x15d8a7(0x2d2)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x15d8a7(0x1fd)},'batch_code':{'$first':_0x15d8a7(0x1d7)},'product_cat':{'$first':_0x15d8a7(0x258)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x15d8a7(0x229)},'invoice':{'$first':'$product_details.invoice'}}}]),_0xfc7e18=await warehouse[_0x15d8a7(0x289)]([{'$match':{'name':_0x4c235f,'room':_0x265afe}},{'$unwind':_0x15d8a7(0x2ae)},{'$match':{'product_details.secondary_code':_0x7e8335}},{'$group':{'_id':_0x15d8a7(0x1ec),'name':{'$first':_0x15d8a7(0x212)},'product_stock':{'$first':_0x15d8a7(0x22d)},'primary_code':{'$first':_0x15d8a7(0x2c9)},'secondary_code':{'$first':_0x15d8a7(0x1ea)},'product_code':{'$first':_0x15d8a7(0x292)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x15d8a7(0x231)},'type':{'$first':_0x15d8a7(0x2d3)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x15d8a7(0x2da)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x15d8a7(0x2ab)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x15d8a7(0x2d2)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x15d8a7(0x1fd)},'batch_code':{'$first':_0x15d8a7(0x1d7)},'product_cat':{'$first':_0x15d8a7(0x258)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x15d8a7(0x229)},'invoice':{'$first':_0x15d8a7(0x20b)}}}]);if(_0x8f2fab['length']>0x0)_0x514244[_0x15d8a7(0x265)](_0x8f2fab);else _0xfc7e18[_0x15d8a7(0x241)]>0x0&&_0x514244[_0x15d8a7(0x265)](_0xfc7e18);}const _0x72f428=_0x46476f[_0x4fd7ee(0x251)](_0x4a26d5=>_0x30823f(_0x4a26d5));await Promise[_0x4fd7ee(0x1d4)](_0x72f428),_0x3c04e9[_0x4fd7ee(0x1ee)](_0x514244);}),module['exports']=router;