var a0_0x32bf9b=a0_0x1e12;(function(_0x1542d3,_0x4d6c8e){var _0x1260e8=a0_0x1e12,_0x4f6ccf=_0x1542d3();while(!![]){try{var _0x4f2b62=-parseInt(_0x1260e8(0x22e))/0x1*(-parseInt(_0x1260e8(0x1b9))/0x2)+parseInt(_0x1260e8(0x1a9))/0x3*(-parseInt(_0x1260e8(0x1f2))/0x4)+parseInt(_0x1260e8(0x1ca))/0x5+parseInt(_0x1260e8(0x21c))/0x6+parseInt(_0x1260e8(0x143))/0x7*(parseInt(_0x1260e8(0x17f))/0x8)+parseInt(_0x1260e8(0x135))/0x9+-parseInt(_0x1260e8(0x1ee))/0xa*(parseInt(_0x1260e8(0x1c2))/0xb);if(_0x4f2b62===_0x4d6c8e)break;else _0x4f6ccf['push'](_0x4f6ccf['shift']());}catch(_0x58da05){_0x4f6ccf['push'](_0x4f6ccf['shift']());}}}(a0_0x2b0a,0xa7f37));const express=require(a0_0x32bf9b(0x1e8)),app=express(),router=express[a0_0x32bf9b(0x133)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x32bf9b(0x170)),auth=require(a0_0x32bf9b(0x204)),nodemailer=require(a0_0x32bf9b(0x160)),users=require(a0_0x32bf9b(0x1da));router[a0_0x32bf9b(0x1c4)](a0_0x32bf9b(0x11c),auth,async(_0x4ac690,_0x127525)=>{var _0x5e2235=a0_0x32bf9b;try{const {username:_0x41f40d,email:_0x5728c6,role:_0x187c30}=_0x4ac690['user'],_0x163af0=_0x4ac690[_0x5e2235(0x1cc)],_0x13bfec=await profile[_0x5e2235(0x16d)]({'email':_0x163af0[_0x5e2235(0x12a)]}),_0x18e0e5=await master_shop[_0x5e2235(0x1ac)]();let _0x4b50ed;if(_0x163af0[_0x5e2235(0x1d9)]==_0x5e2235(0x1b5)){const _0x405ea4=await staff[_0x5e2235(0x16d)]({'email':_0x163af0[_0x5e2235(0x12a)]});_0x4b50ed=await sales_finished[_0x5e2235(0x1ec)]([{'$lookup':{'from':_0x5e2235(0x21d),'localField':_0x5e2235(0x228),'foreignField':_0x5e2235(0x1f4),'as':_0x5e2235(0x175)}},{'$unwind':'$customers_docs'},{'$unwind':_0x5e2235(0x137)},{'$group':{'_id':_0x5e2235(0x1af),'invoice':{'$first':_0x5e2235(0x19a)},'customers':{'$first':_0x5e2235(0x1b6)},'date':{'$first':_0x5e2235(0x1bf)},'warehouse_name':{'$first':_0x5e2235(0x1db)},'sale_product':{'$push':_0x5e2235(0x137)},'note':{'$first':_0x5e2235(0x12f)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x5e2235(0x22f)},'level':{'$addToSet':_0x5e2235(0x167)},'isle':{'$addToSet':_0x5e2235(0x118)},'type':{'$addToSet':_0x5e2235(0x21b)},'pallet':{'$addToSet':_0x5e2235(0x161)},'finalize':{'$first':_0x5e2235(0x1e2)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x4b50ed=await sales_finished[_0x5e2235(0x1ec)]([{'$lookup':{'from':_0x5e2235(0x21d),'localField':_0x5e2235(0x228),'foreignField':_0x5e2235(0x1f4),'as':_0x5e2235(0x175)}},{'$unwind':'$customers_docs'},{'$unwind':_0x5e2235(0x137)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5e2235(0x19a)},'customers':{'$first':'$customer'},'date':{'$first':_0x5e2235(0x1bf)},'warehouse_name':{'$first':_0x5e2235(0x1db)},'sale_product':{'$push':_0x5e2235(0x137)},'note':{'$first':_0x5e2235(0x12f)},'return_data':{'$first':_0x5e2235(0x1ab)},'customers_docs':{'$first':_0x5e2235(0x201)},'total_saleproduct_quantity':{'$sum':_0x5e2235(0x22f)},'level':{'$addToSet':_0x5e2235(0x167)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x5e2235(0x21b)},'pallet':{'$addToSet':_0x5e2235(0x161)},'finalize':{'$first':_0x5e2235(0x1e2)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x18e0e5[0x0]['language']==_0x5e2235(0x17c)){var _0x49371d=users[_0x5e2235(0x19c)];console[_0x5e2235(0x119)](_0x49371d);}else{if(_0x18e0e5[0x0][_0x5e2235(0x163)]==_0x5e2235(0x1be))var _0x49371d=users[_0x5e2235(0x1be)];else{if(_0x18e0e5[0x0][_0x5e2235(0x163)]==_0x5e2235(0x17b))var _0x49371d=users[_0x5e2235(0x17b)];else{if(_0x18e0e5[0x0][_0x5e2235(0x163)]==_0x5e2235(0x11b))var _0x49371d=users['Spanish'];else{if(_0x18e0e5[0x0][_0x5e2235(0x163)]=='French')var _0x49371d=users[_0x5e2235(0x203)];else{if(_0x18e0e5[0x0][_0x5e2235(0x163)]==_0x5e2235(0x12e))var _0x49371d=users['Portuguese'];else{if(_0x18e0e5[0x0][_0x5e2235(0x163)]==_0x5e2235(0x223))var _0x49371d=users[_0x5e2235(0x223)];else{if(_0x18e0e5[0x0][_0x5e2235(0x163)]==_0x5e2235(0x206))var _0x49371d=users[_0x5e2235(0x1b8)];}}}}}}}_0x127525['render'](_0x5e2235(0x16b),{'success':_0x4ac690[_0x5e2235(0x1e7)]('success'),'errors':_0x4ac690['flash'](_0x5e2235(0x187)),'sales':_0x4b50ed,'profile':_0x13bfec,'role':_0x163af0,'master_shop':_0x18e0e5,'language':_0x49371d});}catch(_0xf6977b){console[_0x5e2235(0x119)](_0xf6977b);}});function a0_0x1e12(_0x134e60,_0x1a3502){var _0x2b0a58=a0_0x2b0a();return a0_0x1e12=function(_0x1e129e,_0x366b86){_0x1e129e=_0x1e129e-0x115;var _0x631d7f=_0x2b0a58[_0x1e129e];return _0x631d7f;},a0_0x1e12(_0x134e60,_0x1a3502);}async function getRandom8DigitNumber(){var _0x42f5d8=a0_0x32bf9b;const _0xad1b1e=0x989680,_0x5960ae=0x5f5e0ff,_0x235e36=Math['floor'](Math[_0x42f5d8(0x15d)]()*(_0x5960ae-_0xad1b1e+0x1))+_0xad1b1e;var _0x8a6f21;const _0x22f945=await sales_finished[_0x42f5d8(0x16d)]({'invoice':'OUTF-'+_0x235e36});return _0x22f945&&_0x22f945[_0x42f5d8(0x15b)]>0x0?_0x8a6f21=_0x42f5d8(0x14a)+_0x235e36:_0x8a6f21=_0x42f5d8(0x14a)+_0x235e36,_0x8a6f21;}function a0_0x2b0a(){var _0x70a57c=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','carton','<tbody\x20style=\x22text-align:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','False','save','amount','\x20Order\x20Number\x20:\x20','/view/add_sales/:id','return_sale_QA','\x20==\x20','$name','product_date','due_amount','sale_qty','createTransport','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$invoice','/../public','English','sales_quantity_QA','body','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$room','post','secondary_unit','product_list','Finished\x20Goods','$product_details.maxProducts','RoomAssigned','</h5>','3937212SwDHnf','/invoice/:id','$return_data','find','maxperunit','$product_details.invoice','$_id','/view/add_sale/product','\x20</h2>','push','<html><head><title></title>','maxProducts','staff','$customer','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Arabic','2yhhSUR','Sale\x20Return\x20Mail','unit_QA','status','warehouse_name','Hindi','$date','prod_code','all','11989857oajQoR','QA\x20Warehouse','get','<h5>','redirect','christian.villamer@jakagroup.com','production_date','</div>','4135485UkpxLl','_id','user','$product_details.secondary_code','An\x20error\x20occurred.','$product_details.bin','$product_details.bay','$product_details.rack','string','sales\x20item\x20return\x20successfull','$product_details.room_name','map','$product_details.floorlevel','success','<!DOCTYPE\x20html>','role','../public/language/languages.json','$warehouse_name','/view/:id','product_code_QA','</tr>','Received\x20Payment\x20For\x20Sale','site_title','return_qty','$finalize','primary_code_QA','$product_details.product_stock','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','findById','flash','express','production_date_QA','Sales\x20Mail','/all_sales_finished/preview/','aggregate','batch_code_QA','20YzedMa','Error\x20Occurs','$product_details.unit','batch_code','4TRdYkK','$product_details.primary_code','name','params','gmail','primary_unit','host','return_qty_QA','/barcode_scanner','</table>','<h5\x20style=\x22text-align:\x20left;\x22>','Ambient','$product_details.type','product_name_QA1','getFullYear','$customers_docs','foreach\x20newproduct','French','../middleware/auth','room','Arabic\x20(ae)','product_code','prod_invoice','message','concat','final','max','<div>','sales_quantity','currency_placement','$product_details.storage','suppliers','warehouse','getMonth','id_transaction_from','product','stock','<strong>\x20Regards\x20</strong>','json','/upload/','sale_product','$sale_product.type','5816568RVYuWH','customers','</td>','<tr>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','error','sendMail','Chinese','/give_payment/:id','/all_sales_finished/view','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','secondary_code_QA','customer','return_data','edit_sales_finished_view','unit','room_name','password','574543xugjpO','$sale_product.quantity','add\x20post','image','currency','$sale_product.bin','log','product_stock','Spanish','/view','maxPerUnit_QA','FGSEmail','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','slice','secondary_code','product_details','return_sale_finished','logo','Sales\x20Update\x20successfully','</thead>','filter','/picking_list/pdf/','<h2>\x20','email','getDate','product_name','/view/return_sales/:id','Portuguese\x20(BR)','$note','expiry_date','$product_details.expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Router','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','5880591wsNHTA','stock_data','$sale_product','maxProducts_QA','/preview/:id','\x20<<<==>>>\x20','toString','Portuguese','$product','max_per_unit','$product_details.product_name','date','then','Enclosed','8090866nBntRS','stocks_QA','Quality\x20Inspection','port','True','received_amount','return_sale','OUTF-','$product_details.secondary_unit','$product_details.batch_code','quantity','$product_details.maxPerUnit','expiry_date_QA','$product_details','$product_details.product_code','secondary_unit_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','primary_code','\x20&&\x20','invoice','</body></html>','sales_invoice','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','for_categorize','length','adjust_qty','random','Return\x20Goods','product_data','nodemailer','$sale_product.floorlevel','maxPerUnit','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','back','$product_details._id','$sale_product.bay','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</tbody>','forEach','all_sales_finished','Logo.png','findOne','catch','prod_cat','../models/all_models','<span\x20style=\x22float:\x20right;\x22>','customer_data','split','\x20>>>\x20','customers_docs','Return\x20Rooms','Enabled','ADD\x20SALE','</head><body>','\x20Order\x20Date\x20:\x20','German','English\x20(US)','Email\x20sent\x20successfully','add_sales_finished','8awpjLK','$product_details.production_date','all_sales_barcode','level','abs','bay','render','/all_sales/view','errors','barcode\x20Product\x20master'];a0_0x2b0a=function(){return _0x70a57c;};return a0_0x2b0a();}router[a0_0x32bf9b(0x1c4)]('/view/add_sales',auth,async(_0x1b4737,_0x322e85)=>{var _0x2382da=a0_0x32bf9b;try{const {username:_0x5116db,email:_0xc70c89,role:_0x2e31a3}=_0x1b4737[_0x2382da(0x1cc)],_0x353f47=_0x1b4737[_0x2382da(0x1cc)],_0x12ed0a=await profile[_0x2382da(0x16d)]({'email':_0x353f47[_0x2382da(0x12a)]}),_0x2415a9=await master_shop[_0x2382da(0x1ac)](),_0x57cbe8=await customer[_0x2382da(0x1ac)]({});let _0x4b610a;if(_0x353f47[_0x2382da(0x1d9)]==_0x2382da(0x1b5)){const _0x4e66e7=await staff[_0x2382da(0x16d)]({'email':_0x353f47[_0x2382da(0x12a)]});_0x4b610a=await warehouse[_0x2382da(0x1ec)]([{'$match':{'status':'Enabled','name':_0x4e66e7[_0x2382da(0x212)],'warehouse_category':_0x2382da(0x1a5),'name':{'$ne':_0x2382da(0x1c3)}}},{'$group':{'_id':_0x2382da(0x194),'name':{'$first':_0x2382da(0x194)}}},{'$sort':{'name':0x1}}]);}else _0x4b610a=await warehouse[_0x2382da(0x1ec)]([{'$match':{'status':_0x2382da(0x177),'warehouse_category':_0x2382da(0x1a5),'name':{'$ne':_0x2382da(0x1c3)}}},{'$group':{'_id':_0x2382da(0x194),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x2c6a32=await product[_0x2382da(0x1ac)]({});var _0x2906cc=[_0x2382da(0x1fd),_0x2382da(0x142)];const _0x354d6c=await sales_finished['find']({}),_0x3d6ad6=_0x354d6c[_0x2382da(0x15b)]+0x1,_0x1d3a77=_0x2382da(0x14a)+_0x3d6ad6[_0x2382da(0x13b)]()['padStart'](0x5,'0');if(_0x2415a9[0x0]['language']==_0x2382da(0x17c)){var _0x4122ac=users['English'];console[_0x2382da(0x119)](_0x4122ac);}else{if(_0x2415a9[0x0]['language']==_0x2382da(0x1be))var _0x4122ac=users[_0x2382da(0x1be)];else{if(_0x2415a9[0x0][_0x2382da(0x163)]==_0x2382da(0x17b))var _0x4122ac=users['German'];else{if(_0x2415a9[0x0][_0x2382da(0x163)]==_0x2382da(0x11b))var _0x4122ac=users[_0x2382da(0x11b)];else{if(_0x2415a9[0x0]['language']==_0x2382da(0x203))var _0x4122ac=users[_0x2382da(0x203)];else{if(_0x2415a9[0x0][_0x2382da(0x163)]=='Portuguese\x20(BR)')var _0x4122ac=users[_0x2382da(0x13c)];else{if(_0x2415a9[0x0][_0x2382da(0x163)]=='Chinese')var _0x4122ac=users[_0x2382da(0x223)];else{if(_0x2415a9[0x0][_0x2382da(0x163)]==_0x2382da(0x206))var _0x4122ac=users[_0x2382da(0x1b8)];}}}}}}}const _0x211458=getRandom8DigitNumber();_0x211458[_0x2382da(0x141)](_0x71b312=>{var _0x1f9c85=_0x2382da;_0x322e85[_0x1f9c85(0x185)](_0x1f9c85(0x17e),{'success':_0x1b4737[_0x1f9c85(0x1e7)](_0x1f9c85(0x1d7)),'errors':_0x1b4737[_0x1f9c85(0x1e7)]('errors'),'role':_0x353f47,'profile':_0x12ed0a,'customer':_0x57cbe8,'warehouse':_0x4b610a,'product':_0x2c6a32,'invoice':_0x71b312,'master_shop':_0x2415a9,'language':_0x4122ac,'rooms_data':_0x2906cc});})[_0x2382da(0x16e)](_0x11445e=>{var _0x58c228=_0x2382da;_0x1b4737[_0x58c228(0x1e7)](_0x58c228(0x187),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x322e85[_0x58c228(0x1c6)](_0x58c228(0x225));});}catch(_0x4189be){console[_0x2382da(0x119)](_0x4189be);}}),router['get'](a0_0x32bf9b(0x191),auth,async(_0xcc08e3,_0x57d4f9)=>{var _0x17f956=a0_0x32bf9b;try{const _0xbc546f=_0xcc08e3['params']['id'];console[_0x17f956(0x119)](_0xbc546f);const _0x2d9bc1=await product['find'](),_0x28ce71=await purchases['aggregate']([{'$match':{'warehouse_name':_0xbc546f}},{'$unwind':_0x17f956(0x13d)},{'$group':{'_id':'$product.product_name'}}]);console[_0x17f956(0x119)]('purchases_data',_0x28ce71),_0x57d4f9[_0x17f956(0x1bc)](0xc8)['json']({'purchases_data':_0x28ce71,'product_data':_0x2d9bc1});}catch(_0xf2a1ed){console[_0x17f956(0x119)](_0xf2a1ed);}}),router['post'](a0_0x32bf9b(0x1b0),auth,async(_0x2c86ce,_0x395c26)=>{var _0xfe716c=a0_0x32bf9b;try{const {warehouse_data:_0x4dcf09,product_data:_0x5065ca}=_0x2c86ce[_0xfe716c(0x19e)];console[_0xfe716c(0x119)](_0x2c86ce[_0xfe716c(0x19e)][_0xfe716c(0x15f)]);;const _0x569c84=await master_shop[_0xfe716c(0x1ac)]();console[_0xfe716c(0x119)]('master',_0x569c84);const _0x5c3c1e=await product['findOne']({'name':_0x5065ca});console[_0xfe716c(0x119)](_0xfe716c(0x215),_0x5c3c1e);const _0x1f8b1b=await warehouse[_0xfe716c(0x1ec)]([{'$match':{'name':_0x4dcf09}},{'$unwind':_0xfe716c(0x150)},{'$match':{'product_details.product_name':_0x5065ca}},{'$group':{'_id':_0xfe716c(0x13f),'product_stock':{'$first':_0xfe716c(0x1e4)}}}]);console[_0xfe716c(0x119)](_0xfe716c(0x136),_0x1f8b1b),_0x395c26['status'](0xc8)[_0xfe716c(0x218)]({'master':_0x569c84,'new_product':_0x5c3c1e,'stock_data':_0x1f8b1b});}catch(_0x3ced90){console['log'](_0x3ced90);}}),router[a0_0x32bf9b(0x1a2)]('/view/add_sales',auth,async(_0x288dea,_0x66252c)=>{var _0x42ad5d=a0_0x32bf9b;try{const {invoice:_0x6797eb,date:_0x47dc6f,warehouse_name:_0x1831f0,product_name:_0x564ac,stock:_0x36771f,quantity:_0x117537,note:_0x55ddf6,room:_0x590fa8,primary_code:_0x2b44b6,secondary_code:_0x5b16b7,prod_code:_0x1199d1,level:_0x4f830a,isle:_0xe081dc,pallet:_0x67297c,batch_code:_0x4c4cb9,SCRN:_0x1d62d5,expiry_date:_0x3a1b8b,mode_transpo:_0x3a80f2,name_driver:_0x34fd61}=_0x288dea[_0x42ad5d(0x19e)];if(typeof _0x564ac==_0x42ad5d(0x1d2))var _0x5b6576=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x12c)]],_0xbc432=[_0x288dea['body'][_0x42ad5d(0x216)]],_0x33079b=[_0x288dea['body'][_0x42ad5d(0x18a)]],_0x1af9b1=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x154)]],_0x10a59b=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x121)]],_0x10ec19=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x1c0)]],_0x41851b=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x182)]],_0x5ddcfc=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x1f7)]],_0x1d0b1f=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x1a3)]],_0xb89c20=[_0x288dea['body'][_0x42ad5d(0x1f1)]],_0x49ea29=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x130)]],_0x276990=[_0x288dea[_0x42ad5d(0x19e)]['product_date']],_0x40cf0d=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x13e)]],_0x4c764c=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x16f)]],_0xf1af57=[_0x288dea['body'][_0x42ad5d(0x1a7)]],_0x3bceec=[_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x208)]],_0x1c867c=[_0x288dea['body']['id_transaction_from']];else var _0x5b6576=[..._0x288dea[_0x42ad5d(0x19e)]['product_name']],_0xbc432=[..._0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x216)]],_0x33079b=[..._0x288dea[_0x42ad5d(0x19e)]['carton']],_0x1af9b1=[..._0x288dea['body'][_0x42ad5d(0x154)]],_0x10a59b=[..._0x288dea['body'][_0x42ad5d(0x121)]],_0x10ec19=[..._0x288dea[_0x42ad5d(0x19e)]['prod_code']],_0x41851b=[..._0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x182)]],_0x5ddcfc=[..._0x288dea[_0x42ad5d(0x19e)]['primary_unit']],_0x1d0b1f=[..._0x288dea['body'][_0x42ad5d(0x1a3)]],_0xb89c20=[..._0x288dea['body']['batch_code']],_0x49ea29=[..._0x288dea[_0x42ad5d(0x19e)]['expiry_date']],_0x276990=[..._0x288dea['body'][_0x42ad5d(0x195)]],_0x40cf0d=[..._0x288dea['body'][_0x42ad5d(0x13e)]],_0x4c764c=[..._0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x16f)]],_0xf1af57=[..._0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x1a7)]],_0x3bceec=[..._0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x208)]],_0x1c867c=[..._0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x214)]];const _0x440221=_0x5b6576['map'](_0x347f21=>{return _0x347f21={'product_name':_0x347f21};});_0xbc432[_0x42ad5d(0x16a)]((_0x1334b6,_0x49f29f)=>{var _0x206481=_0x42ad5d;_0x440221[_0x49f29f][_0x206481(0x216)]=_0x1334b6;}),_0x33079b[_0x42ad5d(0x16a)]((_0x2d4991,_0x2d88f9)=>{var _0x2e12f1=_0x42ad5d;_0x440221[_0x2d88f9][_0x2e12f1(0x14d)]=Math[_0x2e12f1(0x183)](_0x2d4991);}),_0x1c867c['forEach']((_0x3b3527,_0x303703)=>{_0x440221[_0x303703]['id_transaction_from']=_0x3b3527;}),_0x1af9b1[_0x42ad5d(0x16a)]((_0x1ab60a,_0x2855bb)=>{var _0x449e28=_0x42ad5d;_0x440221[_0x2855bb][_0x449e28(0x154)]=_0x1ab60a;}),_0x10a59b['forEach']((_0xb8d63c,_0x2f1f44)=>{var _0x211017=_0x42ad5d;_0x440221[_0x2f1f44][_0x211017(0x121)]=_0xb8d63c;}),_0x10ec19[_0x42ad5d(0x16a)]((_0x50c679,_0x1ff741)=>{var _0x14ddf4=_0x42ad5d;_0x440221[_0x1ff741][_0x14ddf4(0x207)]=_0x50c679;}),_0x41851b[_0x42ad5d(0x16a)]((_0x843cb9,_0x6ebd8f)=>{var _0x18aaa9=_0x42ad5d;_0x440221[_0x6ebd8f][_0x18aaa9(0x184)]=_0x843cb9;}),_0x5ddcfc[_0x42ad5d(0x16a)]((_0x4ae749,_0x3f1242)=>{_0x440221[_0x3f1242]['unit']=_0x4ae749;}),_0x1d0b1f['forEach']((_0x51607b,_0x149411)=>{var _0xb4dfe7=_0x42ad5d;_0x440221[_0x149411][_0xb4dfe7(0x1a3)]=_0x51607b;}),_0xb89c20[_0x42ad5d(0x16a)]((_0xd91353,_0x2e826d)=>{var _0x2f42f4=_0x42ad5d;_0x440221[_0x2e826d][_0x2f42f4(0x1f1)]=_0xd91353;}),_0x49ea29['forEach']((_0x2e8cac,_0x1d3d71)=>{var _0x87465=_0x42ad5d;_0x440221[_0x1d3d71][_0x87465(0x130)]=_0x2e8cac;}),_0x276990[_0x42ad5d(0x16a)]((_0x20731e,_0x583ec3)=>{var _0x21d593=_0x42ad5d;_0x440221[_0x583ec3][_0x21d593(0x1c8)]=_0x20731e;}),_0x40cf0d[_0x42ad5d(0x16a)]((_0x108586,_0x28df3c)=>{var _0x401ebe=_0x42ad5d;_0x440221[_0x28df3c][_0x401ebe(0x1ad)]=_0x108586;}),_0x4c764c[_0x42ad5d(0x16a)]((_0x286de3,_0x21fb6a)=>{var _0x42b7ec=_0x42ad5d;_0x440221[_0x21fb6a][_0x42b7ec(0x16f)]=_0x286de3;}),_0xf1af57[_0x42ad5d(0x16a)]((_0x506003,_0x128435)=>{var _0xe1f1df=_0x42ad5d;_0x440221[_0x128435][_0xe1f1df(0x22c)]=_0x506003;}),_0x3bceec[_0x42ad5d(0x16a)]((_0x23ccf0,_0x18d15f)=>{var _0x27e203=_0x42ad5d;_0x440221[_0x18d15f][_0x27e203(0x156)]=_0x23ccf0;});var _0x1cbf26=0x0;_0x440221[_0x42ad5d(0x16a)](_0x32ceff=>{var _0x225d4e=_0x42ad5d;parseFloat(_0x32ceff[_0x225d4e(0x216)])<parseFloat(_0x32ceff['quantity'])&&parseFloat(_0x32ceff[_0x225d4e(0x14d)])>parseFloat(_0x32ceff[_0x225d4e(0x216)])&&(console[_0x225d4e(0x119)](_0x32ceff['stock']+'\x20<>\x20'+_0x32ceff[_0x225d4e(0x14d)]),_0x1cbf26++);});if(_0x1cbf26!=0x0)return _0x288dea['flash'](_0x42ad5d(0x187),_0x42ad5d(0x1e5)),_0x66252c[_0x42ad5d(0x1c6)](_0x42ad5d(0x165));const _0x5a5af8=_0x440221[_0x42ad5d(0x127)](_0x30dd0c=>_0x30dd0c[_0x42ad5d(0x14d)]!=='0'&&_0x30dd0c[_0x42ad5d(0x14d)]!==''),_0x4a2ede=new sales_finished({'invoice':_0x6797eb,'customer':_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x228)],'date':_0x47dc6f,'warehouse_name':_0x1831f0,'sale_product':_0x5a5af8,'note':_0x55ddf6,'room':_0x590fa8,'primary_code':_0x2b44b6,'secondary_code':_0x5b16b7,'prod_code':_0x1199d1,'SCRN':_0x1d62d5,'finalize':_0x42ad5d(0x18d),'mode_transpo':_0x3a80f2,'name_driver':_0x34fd61}),_0x3b9cd9=await _0x4a2ede[_0x42ad5d(0x18e)](),_0x20a69e=await sales_finished[_0x42ad5d(0x16d)]({'invoice':_0x6797eb}),_0x2d68a7=new c_payment_data({'invoice':_0x6797eb,'customer':_0x288dea[_0x42ad5d(0x19e)]['customer'],'reason':'Sale'});await _0x2d68a7[_0x42ad5d(0x18e)]();const _0x2c44c7=await master_shop[_0x42ad5d(0x1ac)](),_0x1d242d=await email_settings[_0x42ad5d(0x16d)](),_0x28d152=await customer[_0x42ad5d(0x16d)]({'name':_0x288dea[_0x42ad5d(0x19e)][_0x42ad5d(0x228)]});_0x2c44c7[0x0][_0x42ad5d(0x20f)]==0x1?(right_currency=_0x2c44c7[0x0][_0x42ad5d(0x117)],left_currency=''):(right_currency='',left_currency=_0x2c44c7[0x0][_0x42ad5d(0x117)]);var _0x350001=_0x5b6576,_0x2cc888=_0x33079b,_0x413b3f='',_0x1736cc;for(_0x1736cc in _0x350001){_0x413b3f+=_0x42ad5d(0x21f)+_0x42ad5d(0x220)+_0x350001[_0x1736cc]+_0x42ad5d(0x21e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2cc888[_0x1736cc]+'</td>'+_0x42ad5d(0x1de);}console[_0x42ad5d(0x119)](_0x42ad5d(0x1a4),_0x413b3f);let _0x1281ff=nodemailer[_0x42ad5d(0x198)]({'host':_0x1d242d[_0x42ad5d(0x1f8)],'port':Number(_0x1d242d[_0x42ad5d(0x146)]),'secure':![],'service':_0x42ad5d(0x1f6),'auth':{'user':_0x1d242d['email'],'pass':_0x1d242d[_0x42ad5d(0x22d)]}}),_0x3b7414={'from':_0x1d242d[_0x42ad5d(0x12a)],'to':_0x42ad5d(0x1c7),'subject':'Add\x20Sales','attachments':[{'filename':_0x42ad5d(0x16c),'path':__dirname+_0x42ad5d(0x19b)+'/upload/'+_0x2c44c7[0x0][_0x42ad5d(0x116)],'cid':_0x42ad5d(0x124)}],'html':_0x42ad5d(0x178)};_0x1281ff['sendMail'](_0x3b7414,function(_0x5a8824,_0xfb2b70){var _0x4ec693=_0x42ad5d;_0x5a8824?(console[_0x4ec693(0x119)](_0x5a8824),console[_0x4ec693(0x119)](_0x4ec693(0x1ef))):console[_0x4ec693(0x119)]('Email\x20sent\x20successfully');}),_0x288dea[_0x42ad5d(0x1e7)](_0x42ad5d(0x1d7),'Sales\x20Add\x20successfully'),_0x66252c['redirect'](_0x42ad5d(0x1eb)+_0x3b9cd9['_id']);}catch(_0xa035c9){console['log'](_0xa035c9);}}),router['get'](a0_0x32bf9b(0x139),auth,async(_0x2839c2,_0x3857a8)=>{var _0x4c4fae=a0_0x32bf9b;try{const {username:_0x349544,email:_0x41fb70,role:_0xe7581d}=_0x2839c2['user'],_0x432d37=_0x2839c2['user'],_0x2dcf96=await profile[_0x4c4fae(0x16d)]({'email':_0x432d37[_0x4c4fae(0x12a)]}),_0x57733e=await master_shop[_0x4c4fae(0x1ac)](),_0x6d5f92=_0x2839c2['params']['id'],_0x5c23e3=await sales_finished['findById'](_0x6d5f92),_0x165a43=await warehouse[_0x4c4fae(0x1ec)]([{'$match':{'name':_0x5c23e3[_0x4c4fae(0x1bd)]}},{'$unwind':_0x4c4fae(0x150)},{'$group':{'_id':_0x4c4fae(0x166),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4c4fae(0x1e4)},'bay':{'$first':_0x4c4fae(0x1d0)},'bin':{'$first':_0x4c4fae(0x1cf)},'type':{'$first':_0x4c4fae(0x1fe)},'floorlevel':{'$first':_0x4c4fae(0x1d6)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4c4fae(0x1cd)},'product_code':{'$first':_0x4c4fae(0x151)},'storage':{'$first':_0x4c4fae(0x210)},'rack':{'$first':_0x4c4fae(0x1d1)},'expiry_date':{'$first':_0x4c4fae(0x131)},'production_date':{'$first':_0x4c4fae(0x180)},'batch_code':{'$first':_0x4c4fae(0x14c)},'room':{'$first':_0x4c4fae(0x1a1)},'room_data':{'$first':_0x4c4fae(0x1d4)}}}]),_0x226454=await customer[_0x4c4fae(0x1ac)]({});let _0x2480fa;if(_0x432d37[_0x4c4fae(0x1d9)]==_0x4c4fae(0x1b5)){const _0x1e5800=await staff[_0x4c4fae(0x16d)]({'email':_0x432d37['email']});_0x2480fa=await warehouse[_0x4c4fae(0x1ec)]([{'$match':{'status':'Enabled','name':_0x1e5800[_0x4c4fae(0x212)]}},{'$group':{'_id':_0x4c4fae(0x194),'name':{'$first':'$name'}}}]);}else _0x2480fa=await warehouse[_0x4c4fae(0x1ec)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x4c4fae(0x194)}}}]);const _0x139dc2=await product[_0x4c4fae(0x1ac)]({});if(_0x57733e[0x0][_0x4c4fae(0x163)]==_0x4c4fae(0x17c)){var _0xbd38f2=users[_0x4c4fae(0x19c)];console[_0x4c4fae(0x119)](_0xbd38f2);}else{if(_0x57733e[0x0][_0x4c4fae(0x163)]==_0x4c4fae(0x1be))var _0xbd38f2=users[_0x4c4fae(0x1be)];else{if(_0x57733e[0x0][_0x4c4fae(0x163)]==_0x4c4fae(0x17b))var _0xbd38f2=users[_0x4c4fae(0x17b)];else{if(_0x57733e[0x0][_0x4c4fae(0x163)]==_0x4c4fae(0x11b))var _0xbd38f2=users['Spanish'];else{if(_0x57733e[0x0][_0x4c4fae(0x163)]=='French')var _0xbd38f2=users[_0x4c4fae(0x203)];else{if(_0x57733e[0x0]['language']=='Portuguese\x20(BR)')var _0xbd38f2=users[_0x4c4fae(0x13c)];else{if(_0x57733e[0x0][_0x4c4fae(0x163)]=='Chinese')var _0xbd38f2=users['Chinese'];else{if(_0x57733e[0x0]['language']==_0x4c4fae(0x206))var _0xbd38f2=users[_0x4c4fae(0x1b8)];}}}}}}}_0x3857a8[_0x4c4fae(0x185)](_0x4c4fae(0x22a),{'success':_0x2839c2['flash'](_0x4c4fae(0x1d7)),'errors':_0x2839c2['flash'](_0x4c4fae(0x187)),'role':_0x432d37,'profile':_0x2dcf96,'customer':_0x226454,'warehouse':_0x2480fa,'product':_0x165a43,'user':_0x5c23e3,'master_shop':_0x57733e,'unit':_0x139dc2,'language':_0xbd38f2});}catch(_0x207057){console[_0x4c4fae(0x119)](_0x207057);}}),router[a0_0x32bf9b(0x1a2)](a0_0x32bf9b(0x139),auth,async(_0x3a6772,_0x3aa9d8)=>{var _0x45fcb2=a0_0x32bf9b;try{const _0x4b4da0=_0x3a6772['params']['id'],{invoice:_0x476f4a,warehouse_name:_0x779522,room:_0x20735c}=_0x3a6772[_0x45fcb2(0x19e)],_0x5dd7fa=await sales_finished[_0x45fcb2(0x16d)]({'invoice':_0x476f4a}),_0x4325b5=_0x5dd7fa['sale_product'][_0x45fcb2(0x1d5)](async _0x165cee=>{var _0x4d0a96=_0x45fcb2,_0x5a2371=await warehouse['findOne']({'name':_0x779522,'room':_0x165cee['room_name'],'warehouse_category':_0x4d0a96(0x1a5)});const _0x28fe40=_0x5a2371[_0x4d0a96(0x122)]['map'](_0x49390f=>{var _0x5ec0e7=_0x4d0a96;(_0x49390f['product_name']==_0x165cee[_0x5ec0e7(0x12c)]&&_0x49390f['bay']==_0x165cee[_0x5ec0e7(0x184)]&&_0x49390f[_0x5ec0e7(0x130)]==_0x165cee[_0x5ec0e7(0x130)]&&_0x49390f[_0x5ec0e7(0x1c8)]==_0x165cee[_0x5ec0e7(0x1c8)]&&_0x49390f[_0x5ec0e7(0x1f1)]==_0x165cee[_0x5ec0e7(0x1f1)]&&_0x49390f[_0x5ec0e7(0x156)]==_0x165cee[_0x5ec0e7(0x156)]||_0x49390f[_0x5ec0e7(0x1cb)]==_0x165cee[_0x5ec0e7(0x214)])&&(_0x49390f['product_stock']>0x0&&(console[_0x5ec0e7(0x119)](_0x49390f['product_name']+'\x20==\x20'+_0x165cee[_0x5ec0e7(0x12c)]+_0x5ec0e7(0x155)+_0x49390f[_0x5ec0e7(0x184)]+_0x5ec0e7(0x193)+_0x165cee[_0x5ec0e7(0x184)]+_0x5ec0e7(0x155)+_0x49390f[_0x5ec0e7(0x1c8)]+_0x5ec0e7(0x193)+_0x165cee[_0x5ec0e7(0x1c8)]+'\x20&&\x20'+_0x49390f[_0x5ec0e7(0x130)]+_0x5ec0e7(0x193)+_0x165cee['expiry_date']+_0x5ec0e7(0x155)+_0x49390f[_0x5ec0e7(0x1f1)]+_0x5ec0e7(0x193)+_0x165cee[_0x5ec0e7(0x1f1)]+_0x5ec0e7(0x155)+_0x49390f[_0x5ec0e7(0x156)]+_0x5ec0e7(0x193)+_0x165cee[_0x5ec0e7(0x156)]+_0x5ec0e7(0x155)+_0x49390f[_0x5ec0e7(0x11a)]+_0x5ec0e7(0x13a)+_0x165cee[_0x5ec0e7(0x14d)]+_0x5ec0e7(0x174)+_0x165cee[_0x5ec0e7(0x22c)]+'\x20&&\x20'+_0x49390f['_id']+_0x5ec0e7(0x193)+_0x165cee[_0x5ec0e7(0x214)]),_0x49390f[_0x5ec0e7(0x11a)]=Math[_0x5ec0e7(0x20c)](0x0,Math[_0x5ec0e7(0x183)](_0x49390f[_0x5ec0e7(0x11a)])-Math[_0x5ec0e7(0x183)](_0x165cee['quantity']))));});return _0x5a2371;});Promise[_0x45fcb2(0x1c1)](_0x4325b5)['then'](async _0x50b8cb=>{var _0x1baae4=_0x45fcb2;try{for(const _0x1f6973 of _0x50b8cb){await _0x1f6973[_0x1baae4(0x18e)]();}_0x5dd7fa['finalize']=_0x1baae4(0x147);const _0x5bc18b=await _0x5dd7fa[_0x1baae4(0x18e)](),_0x3fd8e7=await master_shop[_0x1baae4(0x1ac)](),_0x59fdfd=await email_settings[_0x1baae4(0x16d)](),_0xd79a27=await supervisor_settings[_0x1baae4(0x1ac)]();var _0x32f64e=_0x5dd7fa['sale_product'],_0x39b6e8='',_0x1e2728;for(_0x1e2728 in _0x32f64e){var _0xa0e8ba='FG';_0x5dd7fa[_0x1baae4(0x1bd)]=='DRY\x20GOODS'&&(_0xa0e8ba='DG'),_0x39b6e8+=_0x1baae4(0x21f)+_0x1baae4(0x220)+_0x32f64e[_0x1e2728][_0x1baae4(0x12c)]+_0x1baae4(0x21e)+_0x1baae4(0x220)+_0x32f64e[_0x1e2728][_0x1baae4(0x207)]+_0x1baae4(0x21e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32f64e[_0x1e2728][_0x1baae4(0x14d)]+_0x1baae4(0x21e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32f64e[_0x1e2728][_0x1baae4(0x22b)]+'</td>'+_0x1baae4(0x220)+_0x32f64e[_0x1e2728][_0x1baae4(0x1a3)]+_0x1baae4(0x21e)+_0x1baae4(0x220)+_0x5dd7fa[_0x1baae4(0x1bd)]+_0x1baae4(0x21e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32f64e[_0x1e2728][_0x1baae4(0x22c)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xa0e8ba+_0x32f64e[_0x1e2728][_0x1baae4(0x184)]+'</td>';}let _0x2cf8d7=nodemailer[_0x1baae4(0x198)]({'host':_0x59fdfd[_0x1baae4(0x1f8)],'port':Number(_0x59fdfd[_0x1baae4(0x146)]),'secure':![],'auth':{'user':_0x59fdfd['email'],'pass':_0x59fdfd[_0x1baae4(0x22d)]}}),_0x523b8a={'from':_0x59fdfd[_0x1baae4(0x12a)],'to':_0xd79a27[0x0][_0x1baae4(0x11e)],'subject':_0x1baae4(0x1ea),'attachments':[{'filename':_0x1baae4(0x16c),'path':__dirname+_0x1baae4(0x19b)+_0x1baae4(0x219)+_0x3fd8e7[0x0][_0x1baae4(0x116)],'cid':_0x1baae4(0x124)}],'html':'<!DOCTYPE\x20html>'+_0x1baae4(0x1b3)+'</head><body>'+_0x1baae4(0x20d)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1baae4(0x20d)+_0x1baae4(0x1b7)+_0x1baae4(0x1c9)+_0x1baae4(0x20d)+_0x1baae4(0x129)+_0x3fd8e7[0x0][_0x1baae4(0x1e0)]+_0x1baae4(0x1b1)+'</div>'+_0x1baae4(0x1c9)+'<hr\x20class=\x22my-3\x22>'+_0x1baae4(0x20d)+_0x1baae4(0x1fc)+_0x1baae4(0x190)+_0x5dd7fa[_0x1baae4(0x156)]+'\x20'+_0x1baae4(0x171)+'\x20Order\x20Date\x20:\x20'+_0x5dd7fa[_0x1baae4(0x140)]+'\x20'+'</span>'+'</h5>'+_0x1baae4(0x1c9)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1baae4(0x159)+_0x1baae4(0x21f)+_0x1baae4(0x164)+_0x1baae4(0x153)+_0x1baae4(0x132)+_0x1baae4(0x134)+_0x1baae4(0x199)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x1baae4(0x1de)+'</thead>'+_0x1baae4(0x18b)+'\x20'+_0x39b6e8+'\x20'+'</tbody>'+_0x1baae4(0x1fb)+'<div>'+_0x1baae4(0x217)+_0x1baae4(0x1c5)+_0x3fd8e7[0x0][_0x1baae4(0x1e0)]+_0x1baae4(0x1a8)+_0x1baae4(0x1c9)+_0x1baae4(0x1c9)+'</body></html>'};_0x2cf8d7[_0x1baae4(0x222)](_0x523b8a,function(_0x306caf,_0x1adb23){var _0x366e06=_0x1baae4;_0x306caf?(console['log'](_0x306caf),console[_0x366e06(0x119)]('Error\x20Occurs')):console[_0x366e06(0x119)](_0x366e06(0x17d));}),_0x3a6772[_0x1baae4(0x1e7)]('success',_0x1baae4(0x125)),_0x3aa9d8[_0x1baae4(0x1c6)](_0x1baae4(0x128)+_0x4b4da0);}catch(_0x37a273){console[_0x1baae4(0x221)](_0x37a273),_0x3aa9d8[_0x1baae4(0x1bc)](0x1f4)[_0x1baae4(0x218)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x45fcb2(0x16e)](_0x1ecaae=>{var _0x7bf337=_0x45fcb2;console[_0x7bf337(0x221)](_0x1ecaae),_0x3aa9d8[_0x7bf337(0x1bc)](0x1f4)['json']({'error':_0x7bf337(0x1ce)});});}catch(_0x4d5a57){console[_0x45fcb2(0x119)](_0x4d5a57);}}),router[a0_0x32bf9b(0x1c4)](a0_0x32bf9b(0x1dc),auth,async(_0x4f7e4d,_0x4a4a6a)=>{var _0x20c1d8=a0_0x32bf9b;try{const {username:_0x3627a5,email:_0x263443,role:_0x48f6b7}=_0x4f7e4d[_0x20c1d8(0x1cc)],_0x588ddd=_0x4f7e4d['user'],_0x23395b=await profile[_0x20c1d8(0x16d)]({'email':_0x588ddd['email']}),_0x19e325=await master_shop[_0x20c1d8(0x1ac)](),_0x58f1f1=_0x4f7e4d[_0x20c1d8(0x1f5)]['id'],_0x405162=await sales_finished[_0x20c1d8(0x1e6)](_0x58f1f1);let _0x4c9888=new Date(_0x405162[_0x20c1d8(0x130)]),_0x38799b=('0'+_0x4c9888['getDate']())[_0x20c1d8(0x120)](-0x2),_0x21b3d2=('0'+(_0x4c9888[_0x20c1d8(0x213)]()+0x1))[_0x20c1d8(0x120)](-0x2),_0x431bc2=_0x4c9888[_0x20c1d8(0x200)](),_0x4c8753=_0x431bc2+'-'+_0x21b3d2+'-'+_0x38799b;var _0xcda3a=[_0x20c1d8(0x1fd),_0x20c1d8(0x142)];const _0x348dae=await warehouse[_0x20c1d8(0x1ec)]([{'$match':{'name':_0x405162[_0x20c1d8(0x1bd)],'room':_0x405162['room']}},{'$unwind':_0x20c1d8(0x150)},{'$group':{'_id':_0x20c1d8(0x166),'name':{'$first':_0x20c1d8(0x13f)},'product_stock':{'$first':_0x20c1d8(0x1e4)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x20c1d8(0x1cf)},'type':{'$first':_0x20c1d8(0x1fe)},'floorlevel':{'$first':_0x20c1d8(0x1d6)},'primary_code':{'$first':_0x20c1d8(0x1f3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x20c1d8(0x151)},'storage':{'$first':_0x20c1d8(0x210)},'rack':{'$first':_0x20c1d8(0x1d1)}}}]),_0x46f97c=await customer[_0x20c1d8(0x1ac)]({});let _0x1bcfe6;if(_0x588ddd[_0x20c1d8(0x1d9)]==_0x20c1d8(0x1b5)){const _0x1aedaa=await staff[_0x20c1d8(0x16d)]({'email':_0x588ddd[_0x20c1d8(0x12a)]});_0x1bcfe6=await warehouse[_0x20c1d8(0x1ec)]([{'$match':{'status':'Enabled','name':_0x1aedaa['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x20c1d8(0x194)}}}]);}else _0x1bcfe6=await warehouse[_0x20c1d8(0x1ec)]([{'$match':{'status':_0x20c1d8(0x177)}},{'$group':{'_id':_0x20c1d8(0x194),'name':{'$first':_0x20c1d8(0x194)}}}]);const _0x5f5152=await product[_0x20c1d8(0x1ac)]({});if(_0x19e325[0x0][_0x20c1d8(0x163)]==_0x20c1d8(0x17c)){var _0x389894=users[_0x20c1d8(0x19c)];console[_0x20c1d8(0x119)](_0x389894);}else{if(_0x19e325[0x0][_0x20c1d8(0x163)]==_0x20c1d8(0x1be))var _0x389894=users[_0x20c1d8(0x1be)];else{if(_0x19e325[0x0]['language']==_0x20c1d8(0x17b))var _0x389894=users[_0x20c1d8(0x17b)];else{if(_0x19e325[0x0][_0x20c1d8(0x163)]==_0x20c1d8(0x11b))var _0x389894=users[_0x20c1d8(0x11b)];else{if(_0x19e325[0x0][_0x20c1d8(0x163)]==_0x20c1d8(0x203))var _0x389894=users[_0x20c1d8(0x203)];else{if(_0x19e325[0x0][_0x20c1d8(0x163)]==_0x20c1d8(0x12e))var _0x389894=users[_0x20c1d8(0x13c)];else{if(_0x19e325[0x0]['language']==_0x20c1d8(0x223))var _0x389894=users['Chinese'];else{if(_0x19e325[0x0][_0x20c1d8(0x163)]=='Arabic\x20(ae)')var _0x389894=users['Arabic'];}}}}}}}_0x4a4a6a[_0x20c1d8(0x185)]('edit_sales_finished',{'success':_0x4f7e4d[_0x20c1d8(0x1e7)](_0x20c1d8(0x1d7)),'errors':_0x4f7e4d[_0x20c1d8(0x1e7)](_0x20c1d8(0x187)),'role':_0x588ddd,'profile':_0x23395b,'customer':_0x46f97c,'warehouse':_0x1bcfe6,'product':_0x348dae,'user':_0x405162,'master_shop':_0x19e325,'unit':_0x5f5152,'language':_0x389894,'rooms_data':_0xcda3a,'ed_fullDate':_0x4c8753});}catch(_0x46e58d){console[_0x20c1d8(0x119)](_0x46e58d);}}),router[a0_0x32bf9b(0x1a2)](a0_0x32bf9b(0x1dc),auth,async(_0x1b0e88,_0x501111)=>{var _0x32b9db=a0_0x32bf9b;try{const _0x169b3e=_0x1b0e88[_0x32b9db(0x1f5)]['id'],_0x21c2cf=await sales_finished['findOne']({'_id':_0x1b0e88['params']['id']}),_0x10dbdf=await warehouse[_0x32b9db(0x16d)]({'name':_0x21c2cf[_0x32b9db(0x1bd)],'room':_0x1b0e88['body'][_0x32b9db(0x205)],'warehouse_category':_0x32b9db(0x1a5)}),{invoice:_0x4e86ae,customer:_0x9d928c,date:_0x5b1e0f,warehouse_name:_0x236e04,product_name:_0x425147,stock:_0x4a6df9,adjust_qty:_0x5638e4,note:_0x2fd156,room:_0x30f0fb,primary_code:_0x1d0233,secondary_code:_0x3e5e44,prod_code:_0x3ba928,level:_0x48830b,isle:_0x4edb05,pallet:_0x249a50,expiry_date:_0x29f8ba}=_0x1b0e88[_0x32b9db(0x19e)];if(typeof _0x425147==_0x32b9db(0x1d2))var _0x3e136f=[_0x1b0e88['body'][_0x32b9db(0x12c)]],_0x2fe5ff=[_0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x216)]],_0x495d18=[_0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x15c)]],_0x4d37dd=[_0x1b0e88['body'][_0x32b9db(0x154)]],_0x5a0768=[_0x1b0e88['body']['secondary_code']],_0xf23cbf=[_0x1b0e88['body']['prod_code']],_0x2f11fa=[_0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x182)]],_0x1fcc28=[_0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x130)]];else var _0x3e136f=[..._0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x12c)]],_0x2fe5ff=[..._0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x216)]],_0x495d18=[..._0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x15c)]],_0x4d37dd=[..._0x1b0e88[_0x32b9db(0x19e)]['primary_code']],_0x5a0768=[..._0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x121)]],_0xf23cbf=[..._0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x1c0)]],_0x2f11fa=[..._0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x182)]],_0x1fcc28=[..._0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x130)]];const _0x34a012=_0x3e136f[_0x32b9db(0x1d5)](_0x378c2a=>{return _0x378c2a={'product_name':_0x378c2a};});_0x2fe5ff['forEach']((_0x4072e5,_0x533bf6)=>{var _0xc41398=_0x32b9db;_0x34a012[_0x533bf6][_0xc41398(0x216)]=_0x4072e5;}),_0x495d18['forEach']((_0x394a94,_0x37485c)=>{var _0x4a6039=_0x32b9db;_0x34a012[_0x37485c][_0x4a6039(0x14d)]=_0x394a94;}),_0x4d37dd[_0x32b9db(0x16a)]((_0x231247,_0x40569e)=>{var _0x1d96b3=_0x32b9db;_0x34a012[_0x40569e][_0x1d96b3(0x154)]=_0x231247;}),_0x5a0768['forEach']((_0x313967,_0x5968cb)=>{_0x34a012[_0x5968cb]['secondary_code']=_0x313967;}),_0xf23cbf['forEach']((_0x417335,_0xe954f7)=>{var _0x51a531=_0x32b9db;_0x34a012[_0xe954f7][_0x51a531(0x207)]=_0x417335;}),_0x2f11fa[_0x32b9db(0x16a)]((_0x48c93f,_0x3537d6)=>{var _0x426825=_0x32b9db;_0x34a012[_0x3537d6][_0x426825(0x182)]=_0x48c93f;}),_0x1fcc28['forEach']((_0x2cc99e,_0x52950e)=>{var _0x2004f8=_0x32b9db;_0x34a012[_0x52950e][_0x2004f8(0x130)]=_0x2cc99e;});var _0x57248b=0x0;_0x34a012[_0x32b9db(0x16a)](_0x11b553=>{var _0x3e9a0d=_0x32b9db;console[_0x3e9a0d(0x119)](_0x3e9a0d(0x202),_0x11b553),(parseInt(_0x11b553[_0x3e9a0d(0x216)])<parseInt(_0x11b553[_0x3e9a0d(0x14d)])||parseInt(_0x11b553[_0x3e9a0d(0x14d)])==0x0)&&_0x57248b++;});if(_0x57248b!=0x0)return _0x1b0e88[_0x32b9db(0x1e7)](_0x32b9db(0x187),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x501111[_0x32b9db(0x1c6)]('back');_0x21c2cf['sale_product'][_0x32b9db(0x16a)](_0x1301cf=>{var _0x146728=_0x32b9db;const _0x478695=_0x10dbdf[_0x146728(0x122)][_0x146728(0x1d5)](_0xc919b3=>{var _0x1a9d04=_0x146728;_0xc919b3['product_name']==_0x1301cf['product_name']&&_0xc919b3['bay']==_0x1301cf['bay']&&(_0xc919b3[_0x1a9d04(0x11a)]=parseInt(_0xc919b3[_0x1a9d04(0x11a)])+parseInt(_0x1301cf[_0x1a9d04(0x14d)]));});}),await _0x10dbdf[_0x32b9db(0x18e)]();const _0x437204=_0x34a012[_0x32b9db(0x127)](_0x396e0d=>_0x396e0d['quantity']!=='0'&&_0x396e0d[_0x32b9db(0x14d)]!=='');_0x21c2cf[_0x32b9db(0x156)]=_0x4e86ae,_0x21c2cf['customer']=_0x9d928c,_0x21c2cf['date']=_0x5b1e0f,_0x21c2cf[_0x32b9db(0x1bd)]=_0x236e04,_0x21c2cf['sale_product']=_0x437204,_0x21c2cf['note']=_0x2fd156,_0x21c2cf[_0x32b9db(0x205)]=_0x30f0fb;const _0x59d1a7=await _0x21c2cf[_0x32b9db(0x18e)](),_0x3b206d=await sales_finished['findOne']({'_id':_0x1b0e88['params']['id']}),_0x3e1e77=await warehouse[_0x32b9db(0x16d)]({'name':_0x236e04,'room':_0x30f0fb,'warehouse_category':_0x32b9db(0x1a5)});_0x3b206d[_0x32b9db(0x21a)][_0x32b9db(0x16a)](_0x234f89=>{const _0x3cd20f=_0x3e1e77['product_details']['map'](_0x4d841b=>{var _0x39a6af=a0_0x1e12;_0x4d841b[_0x39a6af(0x12c)]==_0x234f89[_0x39a6af(0x12c)]&&_0x4d841b['bay']==_0x234f89[_0x39a6af(0x184)]&&(_0x4d841b[_0x39a6af(0x11a)]=parseInt(_0x4d841b[_0x39a6af(0x11a)])-parseInt(_0x234f89[_0x39a6af(0x14d)]));});}),console['log'](_0x32b9db(0x20b),_0x3e1e77),await _0x3e1e77['save']();const _0x1ec6d2=await c_payment_data['findOne']({'invoice':_0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x156)]});_0x1ec6d2[_0x32b9db(0x211)]=_0x1b0e88[_0x32b9db(0x19e)][_0x32b9db(0x211)],await _0x1ec6d2[_0x32b9db(0x18e)](),_0x1b0e88['flash'](_0x32b9db(0x1d7),'Sales\x20Update\x20successfully'),_0x501111[_0x32b9db(0x1c6)](_0x32b9db(0x225));}catch(_0x3457eb){console[_0x32b9db(0x119)](_0x3457eb);}}),router[a0_0x32bf9b(0x1a2)](a0_0x32bf9b(0x224),auth,async(_0x53ab51,_0x5d99c8)=>{var _0x428fd0=a0_0x32bf9b;try{const _0x217354=_0x53ab51[_0x428fd0(0x1f5)]['id'],{invoice:_0x4ad8e5,customer:_0x58f871,receivable_amount:_0x41c48a,received_amount:_0x382bb0}=_0x53ab51['body'],_0x347255=await sales[_0x428fd0(0x1e6)](_0x217354);console['log'](_0x347255);var _0x8e708a=_0x41c48a-_0x382bb0;console[_0x428fd0(0x119)](_0x382bb0),_0x347255[_0x428fd0(0x148)]=parseFloat(_0x382bb0)+parseFloat(_0x347255[_0x428fd0(0x148)]),_0x347255[_0x428fd0(0x196)]=_0x8e708a,console[_0x428fd0(0x119)](_0x347255);const _0xf580b9=await _0x347255['save'](),_0x334dc7=await c_payment_data[_0x428fd0(0x16d)]({'invoice':_0x4ad8e5});_0x334dc7[_0x428fd0(0x18f)]=_0x8e708a,await _0x334dc7[_0x428fd0(0x18e)]();let _0x18eef8=new Date(),_0x5814c2=('0'+_0x18eef8[_0x428fd0(0x12b)]())['slice'](-0x2),_0x3f9768=('0'+(_0x18eef8[_0x428fd0(0x213)]()+0x1))[_0x428fd0(0x120)](-0x2),_0x2aae74=_0x18eef8['getFullYear'](),_0x490867=_0x2aae74+'-'+_0x3f9768+'-'+_0x5814c2;const _0x4158ee=new customer_payment({'invoice':_0x4ad8e5,'date':_0x2aae74+'-'+_0x3f9768+'-'+_0x5814c2,'customer':_0x58f871,'reason':_0x428fd0(0x1df),'amount':_0x382bb0}),_0x35886b=await _0x4158ee[_0x428fd0(0x18e)]();_0x53ab51[_0x428fd0(0x1e7)](_0x428fd0(0x1d7),'payment\x20successfull'),_0x5d99c8['redirect'](_0x428fd0(0x186));}catch(_0x3749f3){console[_0x428fd0(0x119)](_0x3749f3);}}),router[a0_0x32bf9b(0x1c4)](a0_0x32bf9b(0x1aa),auth,async(_0x192ec2,_0x9ec539)=>{var _0x73e684=a0_0x32bf9b;try{const {username:_0x24428d,email:_0x587d7e,role:_0x3ef54a}=_0x192ec2['user'],_0x2e56f4=_0x192ec2[_0x73e684(0x1cc)],_0x4f3323=await profile[_0x73e684(0x16d)]({'email':_0x2e56f4['email']}),_0x3b65fb=await master_shop[_0x73e684(0x1ac)]();console['log'](_0x73e684(0x19f),_0x3b65fb);const _0xfc7a40=_0x192ec2[_0x73e684(0x1f5)]['id'],_0x273d17=await sales[_0x73e684(0x1e6)](_0xfc7a40);console['log'](_0x273d17);const _0x203c43=await customer[_0x73e684(0x16d)]({'name':_0x273d17['customer']});console[_0x73e684(0x119)](_0x203c43);if(_0x3b65fb[0x0][_0x73e684(0x163)]==_0x73e684(0x17c)){var _0x190bff=users[_0x73e684(0x19c)];console[_0x73e684(0x119)](_0x190bff);}else{if(_0x3b65fb[0x0][_0x73e684(0x163)]=='Hindi')var _0x190bff=users[_0x73e684(0x1be)];else{if(_0x3b65fb[0x0]['language']==_0x73e684(0x17b))var _0x190bff=users[_0x73e684(0x17b)];else{if(_0x3b65fb[0x0][_0x73e684(0x163)]==_0x73e684(0x11b))var _0x190bff=users[_0x73e684(0x11b)];else{if(_0x3b65fb[0x0][_0x73e684(0x163)]==_0x73e684(0x203))var _0x190bff=users[_0x73e684(0x203)];else{if(_0x3b65fb[0x0][_0x73e684(0x163)]==_0x73e684(0x12e))var _0x190bff=users['Portuguese'];else{if(_0x3b65fb[0x0][_0x73e684(0x163)]=='Chinese')var _0x190bff=users['Chinese'];else{if(_0x3b65fb[0x0]['language']==_0x73e684(0x206))var _0x190bff=users['Arabic'];}}}}}}}_0x9ec539[_0x73e684(0x185)](_0x73e684(0x158),{'success':_0x192ec2[_0x73e684(0x1e7)]('success'),'errors':_0x192ec2['flash'](_0x73e684(0x187)),'role':_0x2e56f4,'profile':_0x4f3323,'master_shop':_0x3b65fb,'customers':_0x203c43,'sales':_0x273d17,'language':_0x190bff});}catch(_0x4ec004){console['log'](_0x4ec004);}}),router['get'](a0_0x32bf9b(0x12d),auth,async(_0x511f0f,_0x151029)=>{var _0x5ad5f2=a0_0x32bf9b;try{const {username:_0x1f2d36,email:_0x3b4860,role:_0x5b2445}=_0x511f0f[_0x5ad5f2(0x1cc)],_0x4bf6b1=_0x511f0f['user'],_0x33550a=await profile[_0x5ad5f2(0x16d)]({'email':_0x4bf6b1[_0x5ad5f2(0x12a)]}),_0x18632e=await master_shop['find'](),_0x19ea6f=_0x511f0f[_0x5ad5f2(0x1f5)]['id'],_0x3a20f1=await sales_finished[_0x5ad5f2(0x1e6)](_0x19ea6f),_0xd58e6f=await warehouse[_0x5ad5f2(0x1ec)]([{'$match':{'name':_0x3a20f1[_0x5ad5f2(0x1bd)]}},{'$unwind':_0x5ad5f2(0x150)},{'$group':{'_id':_0x5ad5f2(0x166),'name':{'$first':_0x5ad5f2(0x13f)},'product_stock':{'$first':_0x5ad5f2(0x1e4)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5ad5f2(0x1fe)},'floorlevel':{'$first':_0x5ad5f2(0x1d6)},'primary_code':{'$first':_0x5ad5f2(0x1f3)},'secondary_code':{'$first':_0x5ad5f2(0x1cd)},'product_code':{'$first':_0x5ad5f2(0x151)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5ad5f2(0x131)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0x5ad5f2(0x1f0)},'secondary_unit':{'$first':_0x5ad5f2(0x14b)},'maxProducts':{'$first':_0x5ad5f2(0x1a6)},'batch_code':{'$first':_0x5ad5f2(0x14c)},'maxPerUnit':{'$first':_0x5ad5f2(0x14e)}}}]),_0x34c53f=await product['find']({}),_0x4e9c1e=await warehouse[_0x5ad5f2(0x1ec)]([{'$match':{'status':_0x5ad5f2(0x177),'warehouse_category':_0x5ad5f2(0x1a5),'name':{'$ne':_0x5ad5f2(0x15e),'$ne':_0x5ad5f2(0x145)}}},{'$group':{'_id':_0x5ad5f2(0x194),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x34570f=[_0x5ad5f2(0x176)];const _0x329e25=await warehouse[_0x5ad5f2(0x1ec)]([{'$match':{'status':_0x5ad5f2(0x177),'name':_0x5ad5f2(0x145)}},{'$group':{'_id':_0x5ad5f2(0x194),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x18632e[0x0]['language']==_0x5ad5f2(0x17c)){var _0x3cdcb2=users[_0x5ad5f2(0x19c)];console['log'](_0x3cdcb2);}else{if(_0x18632e[0x0]['language']==_0x5ad5f2(0x1be))var _0x3cdcb2=users[_0x5ad5f2(0x1be)];else{if(_0x18632e[0x0][_0x5ad5f2(0x163)]==_0x5ad5f2(0x17b))var _0x3cdcb2=users[_0x5ad5f2(0x17b)];else{if(_0x18632e[0x0][_0x5ad5f2(0x163)]==_0x5ad5f2(0x11b))var _0x3cdcb2=users[_0x5ad5f2(0x11b)];else{if(_0x18632e[0x0][_0x5ad5f2(0x163)]==_0x5ad5f2(0x203))var _0x3cdcb2=users['French'];else{if(_0x18632e[0x0][_0x5ad5f2(0x163)]=='Portuguese\x20(BR)')var _0x3cdcb2=users[_0x5ad5f2(0x13c)];else{if(_0x18632e[0x0][_0x5ad5f2(0x163)]==_0x5ad5f2(0x223))var _0x3cdcb2=users[_0x5ad5f2(0x223)];else{if(_0x18632e[0x0][_0x5ad5f2(0x163)]=='Arabic\x20(ae)')var _0x3cdcb2=users[_0x5ad5f2(0x1b8)];}}}}}}}_0x151029[_0x5ad5f2(0x185)](_0x5ad5f2(0x123),{'success':_0x511f0f[_0x5ad5f2(0x1e7)]('success'),'errors':_0x511f0f[_0x5ad5f2(0x1e7)]('errors'),'role':_0x4bf6b1,'profile':_0x33550a,'user':_0x3a20f1,'stock':_0xd58e6f,'master_shop':_0x18632e,'unit':_0x34c53f,'language':_0x3cdcb2,'warehouses':_0x4e9c1e,'rooms':_0x34570f,'warehouse_QA':_0x329e25});}catch(_0x3779e8){console['log'](_0x3779e8),_0x151029[_0x5ad5f2(0x1bc)](0xc8)[_0x5ad5f2(0x218)]({'message':_0x3779e8[_0x5ad5f2(0x209)]});}}),router[a0_0x32bf9b(0x1a2)]('/view/return_sales/:id',auth,async(_0x1ab136,_0x869b97)=>{var _0x29df8a=a0_0x32bf9b;if(_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x15a)]=='QA')try{const {invoice:_0x49fe84,date:_0x23a150,warehouse_name:_0x42f0a2,product_name:_0x16ad90,primary_code:_0x1560da,secondary_code:_0x222746,product_code:_0x3b569e,sales_quantity:_0x4aa6ab,stocks:_0x191490,return_qty:_0x46a18e,Room_name:_0x2c3cd2,to_warehouse_name_QA:_0x295eda,to_Room_name_QA:_0x5c9d5c,note:_0x3f9b8f,for_categorize:_0x24d750,product_name_QA1:_0x21c633}=_0x1ab136[_0x29df8a(0x19e)];if(typeof _0x21c633=='string')var _0x4a2a59=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1ff)]],_0x571db6=[_0x1ab136['body']['primary_code_QA']],_0xe76ffc=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x227)]],_0x24f43c=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1dd)]],_0x12e3c2=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x19d)]],_0xae203d=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x144)]],_0x176e31=[_0x1ab136[_0x29df8a(0x19e)]['return_qty_QA']],_0x5a45f3=[_0x1ab136[_0x29df8a(0x19e)]['maxPerUnit_QA']],_0x4e5954=[_0x1ab136[_0x29df8a(0x19e)]['maxProducts_QA']],_0x58ab7c=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1ed)]],_0x1f375c=[_0x1ab136['body']['secondary_unit_QA']],_0x1227ac=[_0x1ab136[_0x29df8a(0x19e)]['unit_QA']],_0x4c21ed=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1e9)]],_0x1c0dcf=[_0x1ab136[_0x29df8a(0x19e)]['expiry_date_QA']];else var _0x4a2a59=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1ff)]],_0x571db6=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1e3)]],_0xe76ffc=[..._0x1ab136[_0x29df8a(0x19e)]['secondary_code_QA']],_0x24f43c=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1dd)]],_0x12e3c2=[..._0x1ab136['body']['sales_quantity_QA']],_0xae203d=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x144)]],_0x176e31=[..._0x1ab136['body'][_0x29df8a(0x1f9)]],_0x5a45f3=[..._0x1ab136['body'][_0x29df8a(0x11d)]],_0x4e5954=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x138)]],_0x58ab7c=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1ed)]],_0x1f375c=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x152)]],_0x1227ac=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1bb)]],_0x4c21ed=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1e9)]],_0x1c0dcf=[..._0x1ab136['body'][_0x29df8a(0x14f)]];const _0x1e52e3=_0x4a2a59[_0x29df8a(0x1d5)](_0xbbe335=>{return _0xbbe335={'product_name':_0xbbe335};});_0x571db6['forEach']((_0x56c903,_0x29a2ce)=>{var _0x3a867f=_0x29df8a;_0x1e52e3[_0x29a2ce][_0x3a867f(0x154)]=_0x56c903;}),_0xe76ffc[_0x29df8a(0x16a)]((_0x986d,_0x552f6b)=>{var _0x334474=_0x29df8a;_0x1e52e3[_0x552f6b][_0x334474(0x121)]=_0x986d;}),_0x24f43c[_0x29df8a(0x16a)]((_0xe2e3ab,_0x2e9461)=>{var _0x17791d=_0x29df8a;_0x1e52e3[_0x2e9461][_0x17791d(0x207)]=_0xe2e3ab;}),_0x12e3c2['forEach']((_0x18bf3f,_0xb34752)=>{_0x1e52e3[_0xb34752]['sale_qty']=_0x18bf3f;}),_0xae203d[_0x29df8a(0x16a)]((_0x39290d,_0x41843a)=>{var _0x54dafe=_0x29df8a;_0x1e52e3[_0x41843a][_0x54dafe(0x216)]=_0x39290d;}),_0x176e31[_0x29df8a(0x16a)]((_0x20ab22,_0x1d71c9)=>{_0x1e52e3[_0x1d71c9]['return_qty']=_0x20ab22;}),_0x5a45f3[_0x29df8a(0x16a)]((_0x20e9ac,_0x54fea6)=>{var _0xf48676=_0x29df8a;_0x1e52e3[_0x54fea6][_0xf48676(0x162)]=_0x20e9ac;}),_0x4e5954[_0x29df8a(0x16a)]((_0x3bd900,_0x3e841a)=>{var _0x4b3b5e=_0x29df8a;_0x1e52e3[_0x3e841a][_0x4b3b5e(0x1b4)]=_0x3bd900;}),_0x58ab7c[_0x29df8a(0x16a)]((_0x14a1b8,_0x379ec9)=>{var _0x28e716=_0x29df8a;_0x1e52e3[_0x379ec9][_0x28e716(0x1f1)]=_0x14a1b8;}),_0x1f375c[_0x29df8a(0x16a)]((_0x2957fd,_0x2634ef)=>{_0x1e52e3[_0x2634ef]['secondary_unit']=_0x2957fd;}),_0x1227ac[_0x29df8a(0x16a)]((_0x255be8,_0x207669)=>{_0x1e52e3[_0x207669]['unit']=_0x255be8;}),_0x4c21ed[_0x29df8a(0x16a)]((_0x130d09,_0x14ba83)=>{var _0x14b139=_0x29df8a;_0x1e52e3[_0x14ba83][_0x14b139(0x1c8)]=_0x130d09;}),_0x1c0dcf[_0x29df8a(0x16a)]((_0x58acc4,_0x125767)=>{_0x1e52e3[_0x125767]['expiry_date']=_0x58acc4;});const _0x26f35e=await sales_finished[_0x29df8a(0x16d)]({'invoice':_0x49fe84});_0x26f35e[_0x29df8a(0x229)]=_0x29df8a(0x147);const _0x24cfbd=await _0x26f35e[_0x29df8a(0x18e)](),_0x320e29=new sales_return_finished({'invoice':_0x49fe84,'customer':_0x1ab136['body'][_0x29df8a(0x228)],'date':_0x23a150,'warehouse_name':_0x42f0a2,'room':_0x2c3cd2,'ToWarehouse':_0x295eda,'ToRoom':_0x5c9d5c,'return_sale_QA':_0x1e52e3,'note':_0x3f9b8f,'warehouse_cat':_0x24d750}),_0x1d8924=await _0x320e29['save'](),_0x125c16=await sales_return_finished[_0x29df8a(0x16d)]({'invoice':_0x49fe84}),_0x5bc423=await warehouse[_0x29df8a(0x16d)]({'name':_0x295eda,'room':_0x5c9d5c});_0x125c16[_0x29df8a(0x192)]['forEach'](_0x547b21=>{var _0x363421=_0x29df8a,_0x257866=0x0;const _0x4e6a76=_0x5bc423[_0x363421(0x122)][_0x363421(0x1d5)](_0x2ab9db=>{var _0x378743=_0x363421;_0x2ab9db[_0x378743(0x12c)]==_0x547b21[_0x378743(0x12c)]&&_0x2ab9db[_0x378743(0x130)]==_0x547b21[_0x378743(0x130)]&&_0x2ab9db[_0x378743(0x1c8)]==_0x547b21[_0x378743(0x1c8)]&&_0x2ab9db[_0x378743(0x1f1)]==_0x547b21[_0x378743(0x1f1)]&&(_0x2ab9db[_0x378743(0x11a)]=parseInt(_0x2ab9db[_0x378743(0x11a)])+parseInt(_0x547b21[_0x378743(0x1e1)]),_0x257866++);});_0x257866=='0'&&(_0x5bc423[_0x363421(0x122)]=_0x5bc423[_0x363421(0x122)][_0x363421(0x20a)]({'product_name':_0x547b21[_0x363421(0x12c)],'product_stock':_0x547b21[_0x363421(0x1e1)],'primary_code':_0x547b21[_0x363421(0x154)],'secondary_code':_0x547b21[_0x363421(0x121)],'product_code':_0x547b21[_0x363421(0x207)],'batch_code':_0x547b21[_0x363421(0x1f1)],'maxPerUnit':_0x547b21['maxPerUnit'],'production_date':_0x547b21['production_date'],'expiry_date':_0x547b21['expiry_date'],'secondary_unit':_0x547b21['secondary_unit'],'unit':_0x547b21[_0x363421(0x22b)],'maxProducts':_0x547b21[_0x363421(0x1b4)],'bay':_0x547b21['bay']}));}),await _0x5bc423[_0x29df8a(0x18e)]();const _0x3f77d0=new c_payment_data({'invoice':_0x49fe84,'customer':_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x228)],'reason':'Sale\x20Return'});await _0x3f77d0[_0x29df8a(0x18e)]();const _0x19d2d6=await master_shop[_0x29df8a(0x1ac)](),_0x544f98=await email_settings[_0x29df8a(0x16d)](),_0x4fab57=await customer[_0x29df8a(0x16d)]({'name':_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x228)]});_0x19d2d6[0x0][_0x29df8a(0x20f)]==0x1?(right_currency=_0x19d2d6[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x19d2d6[0x0][_0x29df8a(0x117)]);var _0x4d2fb3=_0x4a2a59,_0x1a47ea=_0x176e31,_0x5863fc='',_0x2fcf36;for(_0x2fcf36 in _0x4d2fb3){_0x5863fc+=_0x29df8a(0x21f)+_0x29df8a(0x220)+_0x4d2fb3[_0x2fcf36]+_0x29df8a(0x21e)+_0x29df8a(0x220)+_0x1a47ea[_0x2fcf36]+_0x29df8a(0x21e)+'</tr>';}console[_0x29df8a(0x119)](_0x29df8a(0x1a4),_0x5863fc);let _0x2980d4=nodemailer[_0x29df8a(0x198)]({'service':'gmail','auth':{'user':_0x544f98[_0x29df8a(0x12a)],'pass':_0x544f98[_0x29df8a(0x22d)]}}),_0x4f0f76={'from':_0x544f98[_0x29df8a(0x12a)],'to':_0x4fab57['email'],'subject':_0x29df8a(0x1ba),'attachments':[{'filename':'Logo.png','path':__dirname+_0x29df8a(0x19b)+_0x29df8a(0x219)+_0x19d2d6[0x0][_0x29df8a(0x116)],'cid':_0x29df8a(0x124)}],'html':_0x29df8a(0x1d8)+_0x29df8a(0x1b3)+_0x29df8a(0x179)+'<div>'+_0x29df8a(0x11f)+'<div>'+_0x29df8a(0x1b7)+_0x29df8a(0x1c9)+'<div>'+_0x29df8a(0x129)+_0x19d2d6[0x0][_0x29df8a(0x1e0)]+_0x29df8a(0x1b1)+_0x29df8a(0x1c9)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x29df8a(0x20d)+_0x29df8a(0x1fc)+_0x29df8a(0x190)+_0x49fe84+'\x20'+_0x29df8a(0x171)+_0x29df8a(0x17a)+_0x23a150+'\x20'+'</span>'+_0x29df8a(0x1a8)+_0x29df8a(0x1c9)+_0x29df8a(0x168)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x29df8a(0x21f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x29df8a(0x1a0)+_0x29df8a(0x18c)+_0x29df8a(0x189)+_0x29df8a(0x1de)+'</thead>'+_0x29df8a(0x18b)+'\x20'+_0x5863fc+'\x20'+'</tbody>'+_0x29df8a(0x1fb)+_0x29df8a(0x20d)+_0x29df8a(0x217)+_0x29df8a(0x1c5)+_0x19d2d6[0x0][_0x29df8a(0x1e0)]+_0x29df8a(0x1a8)+_0x29df8a(0x1c9)+_0x29df8a(0x1c9)+'</body></html>'};_0x2980d4[_0x29df8a(0x222)](_0x4f0f76,function(_0x447857,_0xb4e9db){var _0x4ec0bc=_0x29df8a;_0x447857?(console[_0x4ec0bc(0x119)](_0x447857),console['log'](_0x4ec0bc(0x1ef))):console[_0x4ec0bc(0x119)](_0x4ec0bc(0x17d));}),_0x1ab136['flash'](_0x29df8a(0x1d7),'sales\x20item\x20return\x20successfull'),_0x869b97[_0x29df8a(0x1c6)]('/all_sales_finished/view');}catch(_0x204eea){_0x869b97['status'](0xc8)[_0x29df8a(0x218)]({'message1':_0x204eea[_0x29df8a(0x209)]});}else{if(_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x15a)]=='GS')try{const {invoice:_0x2ff212,date:_0x3fd72c,warehouse_name:_0x13d75a,product_name:_0x42a4b7,primary_code:_0x2fa359,secondary_code:_0x51539b,product_code:_0x3542fb,sales_quantity:_0x2194f0,stocks:_0x10166b,return_qty:_0x3ce9af,Room_name:_0x56979d,to_warehouse_name:_0x41bd14,to_Room_name:_0x5a338d,note:_0x3c560b,level:_0x5edba6,isle:_0x4c04a1,pallet:_0x2eb604,for_categorize:_0x4c3858}=_0x1ab136[_0x29df8a(0x19e)];if(typeof _0x42a4b7==_0x29df8a(0x1d2))var _0x4a2a59=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x12c)]],_0x571db6=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x154)]],_0xe76ffc=[_0x1ab136['body'][_0x29df8a(0x121)]],_0x24f43c=[_0x1ab136['body'][_0x29df8a(0x207)]],_0x12e3c2=[_0x1ab136['body'][_0x29df8a(0x20e)]],_0x176e31=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1e1)]],_0x54d90d=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x184)]],_0x5a45f3=[_0x1ab136['body'][_0x29df8a(0x162)]],_0x4e5954=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1b4)]],_0x58ab7c=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1f1)]],_0x1f375c=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1a3)]],_0x1227ac=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x22b)]],_0x4c21ed=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1c8)]],_0x1c0dcf=[_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x130)]];else var _0x4a2a59=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x12c)]],_0x571db6=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x154)]],_0xe76ffc=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x121)]],_0x24f43c=[..._0x1ab136['body'][_0x29df8a(0x207)]],_0x12e3c2=[..._0x1ab136[_0x29df8a(0x19e)]['sales_quantity']],_0x176e31=[..._0x1ab136[_0x29df8a(0x19e)]['return_qty']],_0x54d90d=[..._0x1ab136['body'][_0x29df8a(0x184)]],_0x5a45f3=[..._0x1ab136['body']['maxPerUnit']],_0x4e5954=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1b4)]],_0x58ab7c=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1f1)]],_0x1f375c=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x1a3)]],_0x1227ac=[..._0x1ab136[_0x29df8a(0x19e)]['unit']],_0x4c21ed=[..._0x1ab136['body'][_0x29df8a(0x1c8)]],_0x1c0dcf=[..._0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x130)]];const _0x36307c=_0x4a2a59['map'](_0x4aa4dc=>{return _0x4aa4dc={'product_name':_0x4aa4dc};});_0x571db6[_0x29df8a(0x16a)]((_0x25a8ab,_0x3cf9ac)=>{var _0x59b382=_0x29df8a;_0x36307c[_0x3cf9ac][_0x59b382(0x154)]=_0x25a8ab;}),_0xe76ffc[_0x29df8a(0x16a)]((_0x5aac49,_0x45a77c)=>{var _0x85bd93=_0x29df8a;_0x36307c[_0x45a77c][_0x85bd93(0x121)]=_0x5aac49;}),_0x24f43c[_0x29df8a(0x16a)]((_0x2e2193,_0x13432f)=>{var _0x358370=_0x29df8a;_0x36307c[_0x13432f][_0x358370(0x207)]=_0x2e2193;}),_0x12e3c2[_0x29df8a(0x16a)]((_0x2ba0f7,_0x1e0605)=>{_0x36307c[_0x1e0605]['sale_qty']=_0x2ba0f7;}),_0x176e31[_0x29df8a(0x16a)]((_0xda901e,_0x28f930)=>{_0x36307c[_0x28f930]['return_qty']=_0xda901e;}),_0x54d90d[_0x29df8a(0x16a)]((_0x13433d,_0x6adedf)=>{_0x36307c[_0x6adedf]['bay']=_0x13433d;}),_0x5a45f3[_0x29df8a(0x16a)]((_0x115762,_0x38fa57)=>{var _0x5b861f=_0x29df8a;_0x36307c[_0x38fa57][_0x5b861f(0x162)]=_0x115762;}),_0x4e5954[_0x29df8a(0x16a)]((_0x40b8b3,_0x2773fe)=>{var _0x374337=_0x29df8a;_0x36307c[_0x2773fe][_0x374337(0x1b4)]=_0x40b8b3;}),_0x58ab7c[_0x29df8a(0x16a)]((_0x7dda62,_0x57aee2)=>{var _0x4f113e=_0x29df8a;_0x36307c[_0x57aee2][_0x4f113e(0x1f1)]=_0x7dda62;}),_0x1f375c['forEach']((_0x446c02,_0x438108)=>{var _0x7aef50=_0x29df8a;_0x36307c[_0x438108][_0x7aef50(0x1a3)]=_0x446c02;}),_0x1227ac[_0x29df8a(0x16a)]((_0x1e2e9e,_0x50352d)=>{var _0x369fc2=_0x29df8a;_0x36307c[_0x50352d][_0x369fc2(0x22b)]=_0x1e2e9e;}),_0x4c21ed[_0x29df8a(0x16a)]((_0x26e972,_0x5ec891)=>{var _0x2f7975=_0x29df8a;_0x36307c[_0x5ec891][_0x2f7975(0x1c8)]=_0x26e972;}),_0x1c0dcf[_0x29df8a(0x16a)]((_0x3e992a,_0x4db6b6)=>{var _0x4a0f3e=_0x29df8a;_0x36307c[_0x4db6b6][_0x4a0f3e(0x130)]=_0x3e992a;});var _0x3c0ebe=0x0;_0x36307c['forEach'](_0x4bc6c6=>{var _0x32a933=_0x29df8a;(parseInt(_0x4bc6c6[_0x32a933(0x197)])<parseInt(_0x4bc6c6[_0x32a933(0x1e1)])||parseInt(_0x4bc6c6[_0x32a933(0x216)])<parseInt(_0x4bc6c6[_0x32a933(0x1e1)])&&parseInt(_0x4bc6c6['sale_qty'])>parseInt(_0x4bc6c6[_0x32a933(0x1e1)])||parseInt(_0x4bc6c6['return_qty'])==0x0)&&_0x3c0ebe++;});if(_0x3c0ebe!=0x0)return _0x1ab136[_0x29df8a(0x1e7)](_0x29df8a(0x187),_0x29df8a(0x226)),_0x869b97[_0x29df8a(0x1c6)](_0x29df8a(0x165));const _0x1f16e0=await sales_finished[_0x29df8a(0x16d)]({'invoice':_0x2ff212});_0x1f16e0['return_data']='True';const _0x587c39=await _0x1f16e0[_0x29df8a(0x18e)](),_0x28aa6d=new sales_return_finished({'invoice':_0x2ff212,'customer':_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x228)],'date':_0x3fd72c,'warehouse_name':_0x13d75a,'room':_0x56979d,'ToWarehouse':_0x41bd14,'ToRoom':_0x5a338d,'return_sale':_0x36307c,'note':_0x3c560b,'warehouse_cat':_0x4c3858}),_0x3d2e84=await _0x28aa6d[_0x29df8a(0x18e)](),_0x5981d6=await sales_return_finished['findOne']({'invoice':_0x2ff212}),_0x182dfe=await warehouse[_0x29df8a(0x16d)]({'name':_0x41bd14,'room':_0x5a338d,'warehouse_category':_0x29df8a(0x1a5)});_0x5981d6[_0x29df8a(0x149)][_0x29df8a(0x16a)](_0x2956a3=>{var _0x449175=_0x29df8a,_0x509c1e=0x0;const _0x4a0582=_0x182dfe[_0x449175(0x122)][_0x449175(0x1d5)](_0x5e90ab=>{var _0x49a266=_0x449175;_0x5e90ab[_0x49a266(0x12c)]==_0x2956a3['product_name']&&_0x5e90ab[_0x49a266(0x184)]==_0x2956a3['bay']&&_0x5e90ab[_0x49a266(0x130)]==_0x2956a3['expiry_date']&&_0x5e90ab[_0x49a266(0x1c8)]==_0x2956a3[_0x49a266(0x1c8)]&&_0x5e90ab[_0x49a266(0x1f1)]==_0x2956a3[_0x49a266(0x1f1)]&&(_0x5e90ab[_0x49a266(0x11a)]=parseInt(_0x5e90ab[_0x49a266(0x11a)])+parseInt(_0x2956a3['return_qty']),_0x509c1e++);});_0x509c1e=='0'&&(_0x182dfe[_0x449175(0x122)]=_0x182dfe[_0x449175(0x122)][_0x449175(0x20a)]({'product_name':_0x2956a3['product_name'],'product_stock':_0x2956a3[_0x449175(0x1e1)],'primary_code':_0x2956a3[_0x449175(0x154)],'secondary_code':_0x2956a3[_0x449175(0x121)],'product_code':_0x2956a3['product_code'],'bay':_0x2956a3[_0x449175(0x184)],'batch_code':_0x2956a3[_0x449175(0x1f1)],'maxPerUnit':_0x2956a3[_0x449175(0x162)],'production_date':_0x2956a3[_0x449175(0x1c8)],'expiry_date':_0x2956a3[_0x449175(0x130)],'secondary_unit':_0x2956a3[_0x449175(0x1a3)],'unit':_0x2956a3[_0x449175(0x22b)],'maxProducts':_0x2956a3['maxProducts']}));}),await _0x182dfe[_0x29df8a(0x18e)](),console[_0x29df8a(0x119)](_0x1ab136[_0x29df8a(0x19e)]);const _0x281b28=new c_payment_data({'invoice':_0x2ff212,'customer':_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x228)],'reason':'Sale\x20Return'});await _0x281b28[_0x29df8a(0x18e)]();const _0x148694=await master_shop[_0x29df8a(0x1ac)]();console[_0x29df8a(0x119)](_0x29df8a(0x115),_0x148694[0x0][_0x29df8a(0x116)]);const _0x27642e=await email_settings[_0x29df8a(0x16d)](),_0x33d78b=await customer[_0x29df8a(0x16d)]({'name':_0x1ab136[_0x29df8a(0x19e)][_0x29df8a(0x228)]});console[_0x29df8a(0x119)](_0x29df8a(0x172),_0x33d78b);_0x148694[0x0][_0x29df8a(0x20f)]==0x1?(right_currency=_0x148694[0x0][_0x29df8a(0x117)],left_currency=''):(right_currency='',left_currency=_0x148694[0x0]['currency']);var _0x4d2fb3=_0x4a2a59,_0x1a47ea=_0x176e31,_0x5863fc='',_0x2fcf36;for(_0x2fcf36 in _0x4d2fb3){_0x5863fc+=_0x29df8a(0x21f)+_0x29df8a(0x220)+_0x4d2fb3[_0x2fcf36]+'</td>'+_0x29df8a(0x220)+_0x1a47ea[_0x2fcf36]+'</td>'+_0x29df8a(0x1de);}console[_0x29df8a(0x119)](_0x29df8a(0x1a4),_0x5863fc);let _0x59d8de=nodemailer[_0x29df8a(0x198)]({'service':'gmail','auth':{'user':_0x27642e[_0x29df8a(0x12a)],'pass':_0x27642e[_0x29df8a(0x22d)]}}),_0x167b4a={'from':_0x27642e[_0x29df8a(0x12a)],'to':_0x33d78b[_0x29df8a(0x12a)],'subject':_0x29df8a(0x1ba),'attachments':[{'filename':_0x29df8a(0x16c),'path':__dirname+_0x29df8a(0x19b)+'/upload/'+_0x148694[0x0][_0x29df8a(0x116)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x29df8a(0x1b3)+_0x29df8a(0x179)+_0x29df8a(0x20d)+_0x29df8a(0x11f)+'<div>'+_0x29df8a(0x1b7)+_0x29df8a(0x1c9)+_0x29df8a(0x20d)+'<h2>\x20'+_0x148694[0x0]['site_title']+_0x29df8a(0x1b1)+'</div>'+_0x29df8a(0x1c9)+'<hr\x20class=\x22my-3\x22>'+_0x29df8a(0x20d)+_0x29df8a(0x1fc)+'\x20Order\x20Number\x20:\x20'+_0x2ff212+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x3fd72c+'\x20'+'</span>'+_0x29df8a(0x1a8)+_0x29df8a(0x1c9)+_0x29df8a(0x168)+_0x29df8a(0x159)+_0x29df8a(0x21f)+_0x29df8a(0x164)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x29df8a(0x189)+_0x29df8a(0x1de)+_0x29df8a(0x126)+_0x29df8a(0x18b)+'\x20'+_0x5863fc+'\x20'+_0x29df8a(0x169)+_0x29df8a(0x1fb)+'<div>'+_0x29df8a(0x217)+'<h5>'+_0x148694[0x0][_0x29df8a(0x1e0)]+_0x29df8a(0x1a8)+_0x29df8a(0x1c9)+_0x29df8a(0x1c9)+_0x29df8a(0x157)};_0x59d8de['sendMail'](_0x167b4a,function(_0x598723,_0x17a16a){var _0x330de4=_0x29df8a;_0x598723?(console[_0x330de4(0x119)](_0x598723),console[_0x330de4(0x119)](_0x330de4(0x1ef))):console['log'](_0x330de4(0x17d));}),_0x1ab136[_0x29df8a(0x1e7)](_0x29df8a(0x1d7),_0x29df8a(0x1d3)),_0x869b97[_0x29df8a(0x1c6)](_0x29df8a(0x225));}catch(_0x2940f8){console['log'](_0x2940f8),_0x869b97[_0x29df8a(0x1bc)](0xc8)[_0x29df8a(0x218)]({'message1':_0x2940f8[_0x29df8a(0x209)]});}}}),router[a0_0x32bf9b(0x1c4)]('/barcode/:id',auth,async(_0x5d49aa,_0x313014)=>{var _0x2b4930=a0_0x32bf9b;try{const {username:_0x15f1f7,email:_0x104ee3,role:_0x2f5861}=_0x5d49aa[_0x2b4930(0x1cc)],_0x442848=_0x5d49aa[_0x2b4930(0x1cc)],_0x1ee356=await profile[_0x2b4930(0x16d)]({'email':_0x442848[_0x2b4930(0x12a)]}),_0x20aa84=await master_shop['find']();console[_0x2b4930(0x119)](_0x2b4930(0x188),_0x20aa84);const _0x3f2092=_0x5d49aa['params']['id'],_0x1af48a=await sales[_0x2b4930(0x1e6)](_0x3f2092);console['log']('barcode\x20user_id',_0x1af48a);if(_0x20aa84[0x0]['language']==_0x2b4930(0x17c))var _0x541017=users[_0x2b4930(0x19c)];else{if(_0x20aa84[0x0][_0x2b4930(0x163)]==_0x2b4930(0x1be))var _0x541017=users[_0x2b4930(0x1be)];else{if(_0x20aa84[0x0][_0x2b4930(0x163)]==_0x2b4930(0x17b))var _0x541017=users[_0x2b4930(0x17b)];else{if(_0x20aa84[0x0][_0x2b4930(0x163)]==_0x2b4930(0x11b))var _0x541017=users['Spanish'];else{if(_0x20aa84[0x0][_0x2b4930(0x163)]==_0x2b4930(0x203))var _0x541017=users[_0x2b4930(0x203)];else{if(_0x20aa84[0x0][_0x2b4930(0x163)]=='Portuguese\x20(BR)')var _0x541017=users[_0x2b4930(0x13c)];else{if(_0x20aa84[0x0][_0x2b4930(0x163)]==_0x2b4930(0x223))var _0x541017=users[_0x2b4930(0x223)];else{if(_0x20aa84[0x0][_0x2b4930(0x163)]==_0x2b4930(0x206))var _0x541017=users[_0x2b4930(0x1b8)];}}}}}}}_0x313014[_0x2b4930(0x185)](_0x2b4930(0x181),{'success':_0x5d49aa[_0x2b4930(0x1e7)]('success'),'errors':_0x5d49aa[_0x2b4930(0x1e7)](_0x2b4930(0x187)),'role':_0x442848,'profile':_0x1ee356,'alldata':_0x1af48a,'master_shop':_0x20aa84,'language':_0x541017});}catch(_0x15d799){console[_0x2b4930(0x119)](_0x15d799);}}),router['post'](a0_0x32bf9b(0x1fa),async(_0x459ecf,_0x56e7b6)=>{var _0x289ad8=a0_0x32bf9b;const {product_code:_0x550ea6,warehouse_name:_0x578e72,rooms_data:_0x457137,Roomslist:_0x3f1732}=_0x459ecf[_0x289ad8(0x19e)],_0x4b89ff=_0x3f1732[_0x289ad8(0x173)](','),_0x1d1858=[];async function _0x344433(_0x3ea148){var _0x18eb4a=_0x289ad8;const _0x4e08b9=await warehouse[_0x18eb4a(0x1ec)]([{'$match':{'name':_0x578e72,'room':_0x3ea148}},{'$unwind':_0x18eb4a(0x150)},{'$match':{'product_details.primary_code':_0x550ea6}},{'$group':{'_id':_0x18eb4a(0x166),'name':{'$first':_0x18eb4a(0x13f)},'product_stock':{'$first':_0x18eb4a(0x1e4)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x18eb4a(0x151)},'level':{'$first':_0x18eb4a(0x1d0)},'isle':{'$first':_0x18eb4a(0x1cf)},'type':{'$first':_0x18eb4a(0x1fe)},'pallet':{'$first':_0x18eb4a(0x1d6)},'unit':{'$first':_0x18eb4a(0x1f0)},'secondary_unit':{'$first':_0x18eb4a(0x14b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x18eb4a(0x1d1)},'expiry_date':{'$first':_0x18eb4a(0x131)},'production_date':{'$first':_0x18eb4a(0x180)},'maxPerUnit':{'$first':_0x18eb4a(0x14e)},'batch_code':{'$first':_0x18eb4a(0x14c)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x18eb4a(0x1a1)},'invoice':{'$first':_0x18eb4a(0x1ae)}}}]),_0x1ea833=await warehouse[_0x18eb4a(0x1ec)]([{'$match':{'name':_0x578e72,'room':_0x3ea148}},{'$unwind':_0x18eb4a(0x150)},{'$match':{'product_details.secondary_code':_0x550ea6}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x18eb4a(0x13f)},'product_stock':{'$first':_0x18eb4a(0x1e4)},'primary_code':{'$first':_0x18eb4a(0x1f3)},'secondary_code':{'$first':_0x18eb4a(0x1cd)},'product_code':{'$first':_0x18eb4a(0x151)},'level':{'$first':_0x18eb4a(0x1d0)},'isle':{'$first':_0x18eb4a(0x1cf)},'type':{'$first':_0x18eb4a(0x1fe)},'pallet':{'$first':_0x18eb4a(0x1d6)},'unit':{'$first':_0x18eb4a(0x1f0)},'secondary_unit':{'$first':_0x18eb4a(0x14b)},'storage':{'$first':_0x18eb4a(0x210)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x18eb4a(0x180)},'maxPerUnit':{'$first':_0x18eb4a(0x14e)},'batch_code':{'$first':_0x18eb4a(0x14c)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x18eb4a(0x1a1)},'invoice':{'$first':_0x18eb4a(0x1ae)}}}]);if(_0x4e08b9[_0x18eb4a(0x15b)]>0x0)_0x1d1858[_0x18eb4a(0x1b2)](_0x4e08b9);else _0x1ea833[_0x18eb4a(0x15b)]>0x0&&_0x1d1858[_0x18eb4a(0x1b2)](_0x1ea833);}const _0x34eedf=_0x4b89ff['map'](_0x1706c9=>_0x344433(_0x1706c9));await Promise[_0x289ad8(0x1c1)](_0x34eedf),_0x56e7b6[_0x289ad8(0x218)](_0x1d1858);}),module['exports']=router;