var a0_0x5ccb64=a0_0x30c7;(function(_0x5bbd31,_0x32fc98){var _0x1bb585=a0_0x30c7,_0x9acd81=_0x5bbd31();while(!![]){try{var _0x14a2bf=-parseInt(_0x1bb585(0x1ed))/0x1*(-parseInt(_0x1bb585(0x1d3))/0x2)+-parseInt(_0x1bb585(0x228))/0x3*(-parseInt(_0x1bb585(0x2df))/0x4)+parseInt(_0x1bb585(0x1c4))/0x5+parseInt(_0x1bb585(0x1fc))/0x6*(-parseInt(_0x1bb585(0x2b9))/0x7)+-parseInt(_0x1bb585(0x29d))/0x8*(parseInt(_0x1bb585(0x1d6))/0x9)+-parseInt(_0x1bb585(0x23a))/0xa*(-parseInt(_0x1bb585(0x240))/0xb)+-parseInt(_0x1bb585(0x1f0))/0xc*(parseInt(_0x1bb585(0x26a))/0xd);if(_0x14a2bf===_0x32fc98)break;else _0x9acd81['push'](_0x9acd81['shift']());}catch(_0x84f472){_0x9acd81['push'](_0x9acd81['shift']());}}}(a0_0x2982,0x9d588));const express=require(a0_0x5ccb64(0x2be)),app=express(),router=express[a0_0x5ccb64(0x2c8)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x5ccb64(0x1e7)),auth=require('../middleware/auth'),nodemailer=require(a0_0x5ccb64(0x2bb)),users=require(a0_0x5ccb64(0x2e0));function a0_0x2982(){var _0x2ebbad=['$product_details.room_name','port','</head><body>','$product_details._id','$invoice','sales_invoice','$product_details','/all_sales_finished/preview/','all_sales_barcode','English\x20(US)','</div>','push','master','$product_details.type','Sales\x20Mail','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$_id','FGSEmail','primary_code','/upload/','<tr>','string','foreach\x20newproduct','$product_details.product_name','level','Portuguese\x20(BR)','Add\x20Sales','currency','product_stock','name','aggregate','gmail','edit_sales_finished','$product_details.expiry_date','createTransport','length','$product_details.product_cat','</h5>','return_data','$product_details.floorlevel','$finalize','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Arabic\x20(ae)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','split','find','183944nCRZwa','add\x20post','$product_details.maxPerUnit','params','/give_payment/:id','$product_details.invoice','secondary_code','flash','customer_data','/preview/:id','production_date','production_date_QA','Error\x20Occurs','/view/add_sales','customers','random','Hindi','max_per_unit','sendMail','secondary_unit','English','save','Logo.png','batch_code_QA','<strong>\x20Regards\x20</strong>','expiry_date_QA','return_sale_QA','message','7ezPEDH','<span\x20style=\x22float:\x20right;\x22>','nodemailer','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','express','\x20<>\x20','getMonth','sales_quantity_QA','getDate','product_name_QA1','Enclosed','logo','findOne','Quality\x20Inspection','Router','$product_details.storage','</table>','unit_QA','QA\x20Warehouse','\x20Order\x20Number\x20:\x20','$product_details.bin','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$sale_product.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','site_title','secondary_code_QA','/../public','customer','\x20>>>\x20','status','suppliers','primary_code_QA','DRY\x20GOODS','Return\x20Rooms','An\x20error\x20occurred\x20while\x20saving\x20data.','Ambient','$date','29772gNVSNK','../public/language/languages.json','success','French','$product_details.product_code','3456895cdgkFD','Sales\x20Update\x20successfully','product_data','RoomAssigned','expiry_date','Spanish','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Chinese','$product','<h5>','<h5\x20style=\x22text-align:\x20left;\x22>','password','$warehouse_name','add_sales_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','1142bFZFiQ','purchases_data','$product_details.secondary_code','270rDkVau','payment\x20successfull','stock','product_details','Sale','False','product_code_QA','<tbody\x20style=\x22text-align:\x20center;\x22>','product_date','maxperunit','maxProducts','$product_details.product_stock','$sale_product.bay','maxPerUnit','$product_details.unit','/barcode_scanner','</thead>','../models/all_models','Sale\x20Return\x20Mail','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_code','maxPerUnit_QA','651izTOva','</tr>','$return_data','12ZzICrt','/view/return_sales/:id','$product_details.production_date','/all_sales_finished/view','room_name','unit','primary_unit','floor','filter','max','/view/:id','Finished\x20Goods','3529794AgVffP','currency_placement','$customer','map','Arabic','</td>','return_sale','/view/add_sale/product','return_qty','$product_details.secondary_unit','$product_details.batch_code','forEach','German','<!DOCTYPE\x20html>','/view/add_sales/:id','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<hr\x20class=\x22my-3\x22>','return_qty_QA','product','$room','$customers_docs','image','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</body></html>','</span>','/view','due_amount','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','sale_qty','\x20Order\x20Date\x20:\x20','product_list','sales\x20item\x20return\x20successfull','for_categorize','prod_code','get','christian.villamer@jakagroup.com','host','stocks_QA','$sale_product.quantity','role','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','catch','slice','Sales\x20Add\x20successfully','9RYGFva','quantity','/picking_list/pdf/','_id','barcode\x20Product\x20master','language','ADD\x20SALE','staff','all','maxProducts_QA','log','customers_docs','post','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','<html><head><title></title>','render','Portuguese','$product.product_name','1090uFAbFw','back','final','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','body','98703UigfAW','product_name','$sale_product','adjust_qty','Enabled','\x20<<<==>>>\x20','$name','$product_details.rack','invoice','$product_details.bay','room','$sale_product.floorlevel','padStart','True','user','sale_product','<h2>\x20','json','OUTF-','bay','amount','getFullYear','<div>','concat','Email\x20sent\x20successfully','\x20==\x20','\x20&&\x20','prod_cat','redirect','then','secondary_unit_QA','warehouse','Sale\x20Return','date','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','email','abs','id_transaction_from','/barcode/:id','batch_code','errors','1831817cgRuJu','stock_data','received_amount','error','edit_sales_finished_view'];a0_0x2982=function(){return _0x2ebbad;};return a0_0x2982();}router[a0_0x5ccb64(0x21e)](a0_0x5ccb64(0x215),auth,async(_0x3277d1,_0x212ea3)=>{var _0x4c9df8=a0_0x5ccb64;try{const {username:_0x1d3c94,email:_0x3c1e95,role:_0xbdab79}=_0x3277d1['user'],_0x263052=_0x3277d1[_0x4c9df8(0x24e)],_0x566bfa=await profile[_0x4c9df8(0x2c6)]({'email':_0x263052['email']}),_0x1f7a0c=await master_shop['find']();let _0x289cb4;if(_0x263052[_0x4c9df8(0x223)]==_0x4c9df8(0x22f)){const _0x28a1a4=await staff[_0x4c9df8(0x2c6)]({'email':_0x263052['email']});_0x289cb4=await sales_finished[_0x4c9df8(0x28d)]([{'$lookup':{'from':_0x4c9df8(0x2ab),'localField':_0x4c9df8(0x2d5),'foreignField':_0x4c9df8(0x28c),'as':_0x4c9df8(0x233)}},{'$unwind':'$customers_docs'},{'$unwind':_0x4c9df8(0x242)},{'$group':{'_id':_0x4c9df8(0x27f),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x4c9df8(0x2de)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x4c9df8(0x242)},'note':{'$first':'$note'},'return_data':{'$first':_0x4c9df8(0x1ef)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x4c9df8(0x222)},'level':{'$addToSet':_0x4c9df8(0x1e2)},'isle':{'$addToSet':_0x4c9df8(0x2d0)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x4c9df8(0x297)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x289cb4=await sales_finished[_0x4c9df8(0x28d)]([{'$lookup':{'from':_0x4c9df8(0x2ab),'localField':_0x4c9df8(0x2d5),'foreignField':_0x4c9df8(0x28c),'as':_0x4c9df8(0x233)}},{'$unwind':_0x4c9df8(0x210)},{'$unwind':_0x4c9df8(0x242)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4c9df8(0x273)},'customers':{'$first':_0x4c9df8(0x1fe)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x4c9df8(0x1d0)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x4c9df8(0x1ef)},'customers_docs':{'$first':_0x4c9df8(0x210)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x4c9df8(0x2d0)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x4c9df8(0x24b)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x1f7a0c[0x0][_0x4c9df8(0x22d)]=='English\x20(US)'){var _0x3e82be=users[_0x4c9df8(0x2b1)];console['log'](_0x3e82be);}else{if(_0x1f7a0c[0x0][_0x4c9df8(0x22d)]==_0x4c9df8(0x2ad))var _0x3e82be=users['Hindi'];else{if(_0x1f7a0c[0x0][_0x4c9df8(0x22d)]==_0x4c9df8(0x208))var _0x3e82be=users[_0x4c9df8(0x208)];else{if(_0x1f7a0c[0x0][_0x4c9df8(0x22d)]==_0x4c9df8(0x1c9))var _0x3e82be=users['Spanish'];else{if(_0x1f7a0c[0x0][_0x4c9df8(0x22d)]==_0x4c9df8(0x1c2))var _0x3e82be=users['French'];else{if(_0x1f7a0c[0x0]['language']==_0x4c9df8(0x288))var _0x3e82be=users[_0x4c9df8(0x238)];else{if(_0x1f7a0c[0x0][_0x4c9df8(0x22d)]==_0x4c9df8(0x1cb))var _0x3e82be=users[_0x4c9df8(0x1cb)];else{if(_0x1f7a0c[0x0]['language']==_0x4c9df8(0x299))var _0x3e82be=users[_0x4c9df8(0x200)];}}}}}}}_0x212ea3[_0x4c9df8(0x237)]('all_sales_finished',{'success':_0x3277d1['flash'](_0x4c9df8(0x2e1)),'errors':_0x3277d1[_0x4c9df8(0x2a4)](_0x4c9df8(0x269)),'sales':_0x289cb4,'profile':_0x566bfa,'role':_0x263052,'master_shop':_0x1f7a0c,'language':_0x3e82be});}catch(_0x1f34ec){console[_0x4c9df8(0x232)](_0x1f34ec);}});function a0_0x30c7(_0x17c39f,_0x23352d){var _0x298227=a0_0x2982();return a0_0x30c7=function(_0x30c7e5,_0x1aadf1){_0x30c7e5=_0x30c7e5-0x1c2;var _0x4ae472=_0x298227[_0x30c7e5];return _0x4ae472;},a0_0x30c7(_0x17c39f,_0x23352d);}async function getRandom8DigitNumber(){var _0x134a72=a0_0x5ccb64;const _0x134546=0x989680,_0x1cfac6=0x5f5e0ff,_0x207650=Math[_0x134a72(0x1f7)](Math[_0x134a72(0x2ac)]()*(_0x1cfac6-_0x134546+0x1))+_0x134546;var _0xd9992;const _0x567c1e=await sales_finished[_0x134a72(0x2c6)]({'invoice':_0x134a72(0x252)+_0x207650});return _0x567c1e&&_0x567c1e[_0x134a72(0x292)]>0x0?_0xd9992=_0x134a72(0x252)+_0x207650:_0xd9992=_0x134a72(0x252)+_0x207650,_0xd9992;}router[a0_0x5ccb64(0x21e)](a0_0x5ccb64(0x2aa),auth,async(_0x153e1e,_0x2836ae)=>{var _0x14b871=a0_0x5ccb64;try{const {username:_0x41ea76,email:_0x4fd505,role:_0x2f1fa4}=_0x153e1e[_0x14b871(0x24e)],_0x173380=_0x153e1e[_0x14b871(0x24e)],_0x37e0c3=await profile['findOne']({'email':_0x173380[_0x14b871(0x264)]}),_0x31f341=await master_shop['find'](),_0x849ba0=await customer[_0x14b871(0x29c)]({});let _0x38798f;if(_0x173380[_0x14b871(0x223)]==_0x14b871(0x22f)){const _0x5a27d0=await staff[_0x14b871(0x2c6)]({'email':_0x173380[_0x14b871(0x264)]});_0x38798f=await warehouse[_0x14b871(0x28d)]([{'$match':{'status':'Enabled','name':_0x5a27d0[_0x14b871(0x25f)],'warehouse_category':_0x14b871(0x1fb),'name':{'$ne':_0x14b871(0x2cc)}}},{'$group':{'_id':_0x14b871(0x246),'name':{'$first':_0x14b871(0x246)}}},{'$sort':{'name':0x1}}]);}else _0x38798f=await warehouse[_0x14b871(0x28d)]([{'$match':{'status':_0x14b871(0x244),'warehouse_category':_0x14b871(0x1fb),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x14b871(0x246),'name':{'$first':_0x14b871(0x246)}}},{'$sort':{'name':0x1}}]);const _0x1218cc=await product['find']({});var _0x38bf17=[_0x14b871(0x2dd),'Enclosed'];const _0x46eb35=await sales_finished[_0x14b871(0x29c)]({}),_0x188d6f=_0x46eb35[_0x14b871(0x292)]+0x1,_0x5d61a8=_0x14b871(0x252)+_0x188d6f['toString']()[_0x14b871(0x24c)](0x5,'0');if(_0x31f341[0x0][_0x14b871(0x22d)]==_0x14b871(0x278)){var _0x7875bf=users[_0x14b871(0x2b1)];console[_0x14b871(0x232)](_0x7875bf);}else{if(_0x31f341[0x0][_0x14b871(0x22d)]==_0x14b871(0x2ad))var _0x7875bf=users[_0x14b871(0x2ad)];else{if(_0x31f341[0x0]['language']==_0x14b871(0x208))var _0x7875bf=users[_0x14b871(0x208)];else{if(_0x31f341[0x0][_0x14b871(0x22d)]==_0x14b871(0x1c9))var _0x7875bf=users[_0x14b871(0x1c9)];else{if(_0x31f341[0x0][_0x14b871(0x22d)]==_0x14b871(0x1c2))var _0x7875bf=users[_0x14b871(0x1c2)];else{if(_0x31f341[0x0]['language']==_0x14b871(0x288))var _0x7875bf=users['Portuguese'];else{if(_0x31f341[0x0]['language']==_0x14b871(0x1cb))var _0x7875bf=users[_0x14b871(0x1cb)];else{if(_0x31f341[0x0][_0x14b871(0x22d)]==_0x14b871(0x299))var _0x7875bf=users[_0x14b871(0x200)];}}}}}}}const _0x11031b=getRandom8DigitNumber();_0x11031b[_0x14b871(0x25d)](_0x4b281d=>{var _0x519bd8=_0x14b871;_0x2836ae[_0x519bd8(0x237)](_0x519bd8(0x1d1),{'success':_0x153e1e[_0x519bd8(0x2a4)](_0x519bd8(0x2e1)),'errors':_0x153e1e[_0x519bd8(0x2a4)]('errors'),'role':_0x173380,'profile':_0x37e0c3,'customer':_0x849ba0,'warehouse':_0x38798f,'product':_0x1218cc,'invoice':_0x4b281d,'master_shop':_0x31f341,'language':_0x7875bf,'rooms_data':_0x38bf17});})[_0x14b871(0x225)](_0x50aa5f=>{var _0x1145b4=_0x14b871;_0x153e1e[_0x1145b4(0x2a4)](_0x1145b4(0x269),_0x1145b4(0x212)),_0x2836ae[_0x1145b4(0x25c)](_0x1145b4(0x1f3));});}catch(_0x1ea1c8){console['log'](_0x1ea1c8);}}),router['get'](a0_0x5ccb64(0x20a),auth,async(_0x41ab33,_0x5c3543)=>{var _0x17eda9=a0_0x5ccb64;try{const _0x103f73=_0x41ab33['params']['id'];console[_0x17eda9(0x232)](_0x103f73);const _0x188078=await product[_0x17eda9(0x29c)](),_0x14c620=await purchases[_0x17eda9(0x28d)]([{'$match':{'warehouse_name':_0x103f73}},{'$unwind':_0x17eda9(0x1cc)},{'$group':{'_id':_0x17eda9(0x239)}}]);console[_0x17eda9(0x232)](_0x17eda9(0x1d4),_0x14c620),_0x5c3543[_0x17eda9(0x2d7)](0xc8)[_0x17eda9(0x251)]({'purchases_data':_0x14c620,'product_data':_0x188078});}catch(_0x15a7d){console[_0x17eda9(0x232)](_0x15a7d);}}),router[a0_0x5ccb64(0x234)](a0_0x5ccb64(0x203),auth,async(_0x19bb4e,_0x5dcf1e)=>{var _0x35c297=a0_0x5ccb64;try{const {warehouse_data:_0x10f8e9,product_data:_0xdfe2e1}=_0x19bb4e[_0x35c297(0x23f)];console[_0x35c297(0x232)](_0x19bb4e[_0x35c297(0x23f)][_0x35c297(0x1c6)]);;const _0x2fbf74=await master_shop[_0x35c297(0x29c)]();console[_0x35c297(0x232)](_0x35c297(0x27b),_0x2fbf74);const _0x32f1fa=await product[_0x35c297(0x2c6)]({'name':_0xdfe2e1});console[_0x35c297(0x232)](_0x35c297(0x20e),_0x32f1fa);const _0x3c5c89=await warehouse[_0x35c297(0x28d)]([{'$match':{'name':_0x10f8e9}},{'$unwind':_0x35c297(0x275)},{'$match':{'product_details.product_name':_0xdfe2e1}},{'$group':{'_id':_0x35c297(0x286),'product_stock':{'$first':_0x35c297(0x1e1)}}}]);console[_0x35c297(0x232)](_0x35c297(0x26b),_0x3c5c89),_0x5dcf1e['status'](0xc8)[_0x35c297(0x251)]({'master':_0x2fbf74,'new_product':_0x32f1fa,'stock_data':_0x3c5c89});}catch(_0x37f080){console[_0x35c297(0x232)](_0x37f080);}}),router['post']('/view/add_sales',auth,async(_0xc3ac4a,_0x143105)=>{var _0x462f0f=a0_0x5ccb64;try{const {invoice:_0x4da4ce,date:_0x5b300e,warehouse_name:_0x40bcc7,product_name:_0x23680b,stock:_0x9dff93,quantity:_0x54ab71,note:_0x309a8b,room:_0x84faa6,primary_code:_0x50f857,secondary_code:_0x1bfa02,prod_code:_0x447e0a,level:_0xfad3fd,isle:_0x35f400,pallet:_0x5f3517,batch_code:_0x2aed17,SCRN:_0x23a18d,expiry_date:_0x1a0ec2,mode_transpo:_0x440df5,name_driver:_0x4ccc1e}=_0xc3ac4a['body'];if(typeof _0x23680b=='string')var _0x203314=[_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x241)]],_0x4c852d=[_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x1d8)]],_0x47a3ad=[_0xc3ac4a[_0x462f0f(0x23f)]['carton']],_0x26a4d3=[_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x281)]],_0x132057=[_0xc3ac4a[_0x462f0f(0x23f)]['secondary_code']],_0x4440a3=[_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x21d)]],_0x2cf874=[_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x287)]],_0x2eecb0=[_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x1f6)]],_0x130e7e=[_0xc3ac4a[_0x462f0f(0x23f)]['secondary_unit']],_0x5be879=[_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x268)]],_0xaa3640=[_0xc3ac4a[_0x462f0f(0x23f)]['expiry_date']],_0x1b7f89=[_0xc3ac4a['body'][_0x462f0f(0x1de)]],_0x20fbf2=[_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x2ae)]],_0x47e49f=[_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x25b)]],_0x10300b=[_0xc3ac4a[_0x462f0f(0x23f)]['RoomAssigned']],_0x345c6c=[_0xc3ac4a[_0x462f0f(0x23f)]['prod_invoice']],_0x285fd9=[_0xc3ac4a[_0x462f0f(0x23f)]['id_transaction_from']];else var _0x203314=[..._0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x241)]],_0x4c852d=[..._0xc3ac4a['body'][_0x462f0f(0x1d8)]],_0x47a3ad=[..._0xc3ac4a[_0x462f0f(0x23f)]['carton']],_0x26a4d3=[..._0xc3ac4a[_0x462f0f(0x23f)]['primary_code']],_0x132057=[..._0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x2a3)]],_0x4440a3=[..._0xc3ac4a[_0x462f0f(0x23f)]['prod_code']],_0x2cf874=[..._0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x287)]],_0x2eecb0=[..._0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x1f6)]],_0x130e7e=[..._0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x2b0)]],_0x5be879=[..._0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x268)]],_0xaa3640=[..._0xc3ac4a['body'][_0x462f0f(0x1c8)]],_0x1b7f89=[..._0xc3ac4a[_0x462f0f(0x23f)]['product_date']],_0x20fbf2=[..._0xc3ac4a[_0x462f0f(0x23f)]['max_per_unit']],_0x47e49f=[..._0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x25b)]],_0x10300b=[..._0xc3ac4a['body'][_0x462f0f(0x1c7)]],_0x345c6c=[..._0xc3ac4a['body']['prod_invoice']],_0x285fd9=[..._0xc3ac4a['body']['id_transaction_from']];const _0x158bdf=_0x203314[_0x462f0f(0x1ff)](_0x4cd539=>{return _0x4cd539={'product_name':_0x4cd539};});_0x4c852d[_0x462f0f(0x207)]((_0x29a603,_0x582d81)=>{var _0x3adbc2=_0x462f0f;_0x158bdf[_0x582d81][_0x3adbc2(0x1d8)]=_0x29a603;}),_0x47a3ad[_0x462f0f(0x207)]((_0x365716,_0x45622e)=>{var _0x23ea5b=_0x462f0f;_0x158bdf[_0x45622e][_0x23ea5b(0x229)]=Math[_0x23ea5b(0x265)](_0x365716);}),_0x285fd9[_0x462f0f(0x207)]((_0x2abacf,_0x5e8cae)=>{var _0x1c5007=_0x462f0f;_0x158bdf[_0x5e8cae][_0x1c5007(0x266)]=_0x2abacf;}),_0x26a4d3[_0x462f0f(0x207)]((_0x43ee8a,_0x58240f)=>{var _0x1c5d0b=_0x462f0f;_0x158bdf[_0x58240f][_0x1c5d0b(0x281)]=_0x43ee8a;}),_0x132057[_0x462f0f(0x207)]((_0x35366d,_0x564288)=>{var _0x3be7f2=_0x462f0f;_0x158bdf[_0x564288][_0x3be7f2(0x2a3)]=_0x35366d;}),_0x4440a3[_0x462f0f(0x207)]((_0x1425af,_0x55ea45)=>{var _0x471cf4=_0x462f0f;_0x158bdf[_0x55ea45][_0x471cf4(0x1eb)]=_0x1425af;}),_0x2cf874[_0x462f0f(0x207)]((_0x301d1a,_0x5c757d)=>{var _0x30877c=_0x462f0f;_0x158bdf[_0x5c757d][_0x30877c(0x253)]=_0x301d1a;}),_0x2eecb0[_0x462f0f(0x207)]((_0x1dc0ad,_0x4eb685)=>{var _0x59cbb6=_0x462f0f;_0x158bdf[_0x4eb685][_0x59cbb6(0x1f5)]=_0x1dc0ad;}),_0x130e7e['forEach']((_0x32d302,_0x5d9260)=>{var _0xfeb537=_0x462f0f;_0x158bdf[_0x5d9260][_0xfeb537(0x2b0)]=_0x32d302;}),_0x5be879[_0x462f0f(0x207)]((_0xb14034,_0x5b5802)=>{var _0x6ee1a4=_0x462f0f;_0x158bdf[_0x5b5802][_0x6ee1a4(0x268)]=_0xb14034;}),_0xaa3640[_0x462f0f(0x207)]((_0x14ebd4,_0x419697)=>{var _0x88dc0=_0x462f0f;_0x158bdf[_0x419697][_0x88dc0(0x1c8)]=_0x14ebd4;}),_0x1b7f89[_0x462f0f(0x207)]((_0x1a6fe6,_0x562bc2)=>{_0x158bdf[_0x562bc2]['production_date']=_0x1a6fe6;}),_0x20fbf2['forEach']((_0x12d95c,_0x19b351)=>{var _0xfc3adf=_0x462f0f;_0x158bdf[_0x19b351][_0xfc3adf(0x1df)]=_0x12d95c;}),_0x47e49f[_0x462f0f(0x207)]((_0x159bcf,_0x4303d6)=>{var _0x380faf=_0x462f0f;_0x158bdf[_0x4303d6][_0x380faf(0x25b)]=_0x159bcf;}),_0x10300b[_0x462f0f(0x207)]((_0x125cef,_0x507d59)=>{var _0x53a21b=_0x462f0f;_0x158bdf[_0x507d59][_0x53a21b(0x1f4)]=_0x125cef;}),_0x345c6c[_0x462f0f(0x207)]((_0x2d2b1a,_0x28f7cc)=>{var _0x118b37=_0x462f0f;_0x158bdf[_0x28f7cc][_0x118b37(0x248)]=_0x2d2b1a;});var _0x5bcb2f=0x0;_0x158bdf[_0x462f0f(0x207)](_0x571532=>{var _0xf5fd0a=_0x462f0f;parseFloat(_0x571532[_0xf5fd0a(0x1d8)])<parseFloat(_0x571532[_0xf5fd0a(0x229)])&&parseFloat(_0x571532['quantity'])>parseFloat(_0x571532[_0xf5fd0a(0x1d8)])&&(console['log'](_0x571532[_0xf5fd0a(0x1d8)]+_0xf5fd0a(0x2bf)+_0x571532['quantity']),_0x5bcb2f++);});if(_0x5bcb2f!=0x0)return _0xc3ac4a[_0x462f0f(0x2a4)](_0x462f0f(0x269),_0x462f0f(0x235)),_0x143105[_0x462f0f(0x25c)](_0x462f0f(0x23b));const _0x2399ba=_0x158bdf[_0x462f0f(0x1f8)](_0x3c506c=>_0x3c506c['quantity']!=='0'&&_0x3c506c['quantity']!==''),_0x54f148=new sales_finished({'invoice':_0x4da4ce,'customer':_0xc3ac4a[_0x462f0f(0x23f)]['customer'],'date':_0x5b300e,'warehouse_name':_0x40bcc7,'sale_product':_0x2399ba,'note':_0x309a8b,'room':_0x84faa6,'primary_code':_0x50f857,'secondary_code':_0x1bfa02,'prod_code':_0x447e0a,'SCRN':_0x23a18d,'finalize':_0x462f0f(0x1db),'mode_transpo':_0x440df5,'name_driver':_0x4ccc1e}),_0x5e6955=await _0x54f148[_0x462f0f(0x2b2)](),_0x478c8e=await sales_finished[_0x462f0f(0x2c6)]({'invoice':_0x4da4ce}),_0x16f7f6=new c_payment_data({'invoice':_0x4da4ce,'customer':_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x2d5)],'reason':_0x462f0f(0x1da)});await _0x16f7f6[_0x462f0f(0x2b2)]();const _0x293248=await master_shop[_0x462f0f(0x29c)](),_0x973da=await email_settings[_0x462f0f(0x2c6)](),_0x241327=await customer['findOne']({'name':_0xc3ac4a[_0x462f0f(0x23f)][_0x462f0f(0x2d5)]});_0x293248[0x0][_0x462f0f(0x1fd)]==0x1?(right_currency=_0x293248[0x0][_0x462f0f(0x28a)],left_currency=''):(right_currency='',left_currency=_0x293248[0x0][_0x462f0f(0x28a)]);var _0x462180=_0x203314,_0x21cd70=_0x47a3ad,_0x1bd400='',_0x562cce;for(_0x562cce in _0x462180){_0x1bd400+='<tr>'+_0x462f0f(0x20b)+_0x462180[_0x562cce]+_0x462f0f(0x201)+_0x462f0f(0x20b)+_0x21cd70[_0x562cce]+_0x462f0f(0x201)+'</tr>';}console[_0x462f0f(0x232)](_0x462f0f(0x21a),_0x1bd400);let _0x55af91=nodemailer['createTransport']({'host':_0x973da[_0x462f0f(0x220)],'port':Number(_0x973da['port']),'secure':![],'service':_0x462f0f(0x28e),'auth':{'user':_0x973da[_0x462f0f(0x264)],'pass':_0x973da['password']}}),_0x12be2f={'from':_0x973da[_0x462f0f(0x264)],'to':_0x462f0f(0x21f),'subject':_0x462f0f(0x289),'attachments':[{'filename':_0x462f0f(0x2b3),'path':__dirname+_0x462f0f(0x2d4)+_0x462f0f(0x282)+_0x293248[0x0][_0x462f0f(0x211)],'cid':'logo'}],'html':_0x462f0f(0x22e)};_0x55af91[_0x462f0f(0x2af)](_0x12be2f,function(_0x1c9fbc,_0x4c47c4){var _0x52a2fc=_0x462f0f;_0x1c9fbc?(console[_0x52a2fc(0x232)](_0x1c9fbc),console[_0x52a2fc(0x232)](_0x52a2fc(0x2a9))):console[_0x52a2fc(0x232)](_0x52a2fc(0x258));}),_0xc3ac4a[_0x462f0f(0x2a4)]('success',_0x462f0f(0x227)),_0x143105[_0x462f0f(0x25c)](_0x462f0f(0x276)+_0x5e6955[_0x462f0f(0x22b)]);}catch(_0x467309){console[_0x462f0f(0x232)](_0x467309);}}),router[a0_0x5ccb64(0x21e)]('/preview/:id',auth,async(_0x149257,_0x5bd27f)=>{var _0x21e1ad=a0_0x5ccb64;try{const {username:_0x3e4eb2,email:_0x30e2de,role:_0x55727a}=_0x149257[_0x21e1ad(0x24e)],_0xc82057=_0x149257[_0x21e1ad(0x24e)],_0xf859aa=await profile[_0x21e1ad(0x2c6)]({'email':_0xc82057['email']}),_0xd9c2cc=await master_shop[_0x21e1ad(0x29c)](),_0x9f4fd2=_0x149257[_0x21e1ad(0x2a0)]['id'],_0x22477d=await sales_finished[_0x21e1ad(0x2bc)](_0x9f4fd2),_0x1fe2c4=await warehouse[_0x21e1ad(0x28d)]([{'$match':{'name':_0x22477d[_0x21e1ad(0x1e9)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x21e1ad(0x272),'name':{'$first':_0x21e1ad(0x286)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x21e1ad(0x249)},'bin':{'$first':_0x21e1ad(0x2ce)},'type':{'$first':_0x21e1ad(0x27c)},'floorlevel':{'$first':_0x21e1ad(0x296)},'primary_code':{'$first':_0x21e1ad(0x262)},'secondary_code':{'$first':_0x21e1ad(0x1d5)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x21e1ad(0x2c9)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x21e1ad(0x206)},'room':{'$first':'$room'},'room_data':{'$first':_0x21e1ad(0x26f)}}}]),_0x3da41b=await customer[_0x21e1ad(0x29c)]({});let _0x1d3d2b;if(_0xc82057[_0x21e1ad(0x223)]==_0x21e1ad(0x22f)){const _0x5decf6=await staff[_0x21e1ad(0x2c6)]({'email':_0xc82057[_0x21e1ad(0x264)]});_0x1d3d2b=await warehouse[_0x21e1ad(0x28d)]([{'$match':{'status':_0x21e1ad(0x244),'name':_0x5decf6[_0x21e1ad(0x25f)]}},{'$group':{'_id':'$name','name':{'$first':_0x21e1ad(0x246)}}}]);}else _0x1d3d2b=await warehouse[_0x21e1ad(0x28d)]([{'$match':{'status':_0x21e1ad(0x244)}},{'$group':{'_id':'$name','name':{'$first':_0x21e1ad(0x246)}}}]);const _0x513f00=await product[_0x21e1ad(0x29c)]({});if(_0xd9c2cc[0x0][_0x21e1ad(0x22d)]==_0x21e1ad(0x278)){var _0x587c37=users[_0x21e1ad(0x2b1)];console[_0x21e1ad(0x232)](_0x587c37);}else{if(_0xd9c2cc[0x0][_0x21e1ad(0x22d)]==_0x21e1ad(0x2ad))var _0x587c37=users[_0x21e1ad(0x2ad)];else{if(_0xd9c2cc[0x0][_0x21e1ad(0x22d)]==_0x21e1ad(0x208))var _0x587c37=users[_0x21e1ad(0x208)];else{if(_0xd9c2cc[0x0][_0x21e1ad(0x22d)]==_0x21e1ad(0x1c9))var _0x587c37=users['Spanish'];else{if(_0xd9c2cc[0x0]['language']=='French')var _0x587c37=users[_0x21e1ad(0x1c2)];else{if(_0xd9c2cc[0x0]['language']=='Portuguese\x20(BR)')var _0x587c37=users[_0x21e1ad(0x238)];else{if(_0xd9c2cc[0x0][_0x21e1ad(0x22d)]==_0x21e1ad(0x1cb))var _0x587c37=users['Chinese'];else{if(_0xd9c2cc[0x0]['language']==_0x21e1ad(0x299))var _0x587c37=users[_0x21e1ad(0x200)];}}}}}}}_0x5bd27f[_0x21e1ad(0x237)](_0x21e1ad(0x26e),{'success':_0x149257[_0x21e1ad(0x2a4)](_0x21e1ad(0x2e1)),'errors':_0x149257[_0x21e1ad(0x2a4)](_0x21e1ad(0x269)),'role':_0xc82057,'profile':_0xf859aa,'customer':_0x3da41b,'warehouse':_0x1d3d2b,'product':_0x1fe2c4,'user':_0x22477d,'master_shop':_0xd9c2cc,'unit':_0x513f00,'language':_0x587c37});}catch(_0x5b83bb){console[_0x21e1ad(0x232)](_0x5b83bb);}}),router[a0_0x5ccb64(0x234)](a0_0x5ccb64(0x2a6),auth,async(_0x4d3358,_0x3bdc9c)=>{var _0x2b98b0=a0_0x5ccb64;try{const _0x28d159=_0x4d3358['params']['id'],{invoice:_0x438c66,warehouse_name:_0x18c00c,room:_0xbe0b0b}=_0x4d3358['body'],_0x5d3565=await sales_finished[_0x2b98b0(0x2c6)]({'invoice':_0x438c66}),_0x4f39dc=_0x5d3565[_0x2b98b0(0x24f)]['map'](async _0x487255=>{var _0x34a5cc=_0x2b98b0,_0x319283=await warehouse[_0x34a5cc(0x2c6)]({'name':_0x18c00c,'room':_0x487255[_0x34a5cc(0x1f4)],'warehouse_category':_0x34a5cc(0x1fb)});const _0x17f60a=_0x319283['product_details'][_0x34a5cc(0x1ff)](_0x5bb0df=>{var _0x1527c8=_0x34a5cc;(_0x5bb0df['product_name']==_0x487255[_0x1527c8(0x241)]&&_0x5bb0df[_0x1527c8(0x253)]==_0x487255['bay']&&_0x5bb0df[_0x1527c8(0x1c8)]==_0x487255[_0x1527c8(0x1c8)]&&_0x5bb0df[_0x1527c8(0x2a7)]==_0x487255[_0x1527c8(0x2a7)]&&_0x5bb0df[_0x1527c8(0x268)]==_0x487255[_0x1527c8(0x268)]&&_0x5bb0df[_0x1527c8(0x248)]==_0x487255[_0x1527c8(0x248)]||_0x5bb0df['_id']==_0x487255[_0x1527c8(0x266)])&&(_0x5bb0df[_0x1527c8(0x28b)]>0x0&&(console['log'](_0x5bb0df[_0x1527c8(0x241)]+_0x1527c8(0x259)+_0x487255['product_name']+_0x1527c8(0x25a)+_0x5bb0df[_0x1527c8(0x253)]+'\x20==\x20'+_0x487255[_0x1527c8(0x253)]+_0x1527c8(0x25a)+_0x5bb0df['production_date']+'\x20==\x20'+_0x487255[_0x1527c8(0x2a7)]+_0x1527c8(0x25a)+_0x5bb0df[_0x1527c8(0x1c8)]+'\x20==\x20'+_0x487255[_0x1527c8(0x1c8)]+_0x1527c8(0x25a)+_0x5bb0df[_0x1527c8(0x268)]+_0x1527c8(0x259)+_0x487255[_0x1527c8(0x268)]+'\x20&&\x20'+_0x5bb0df['invoice']+_0x1527c8(0x259)+_0x487255[_0x1527c8(0x248)]+'\x20&&\x20'+_0x5bb0df[_0x1527c8(0x28b)]+_0x1527c8(0x245)+_0x487255[_0x1527c8(0x229)]+_0x1527c8(0x2d6)+_0x487255[_0x1527c8(0x1f4)]+_0x1527c8(0x25a)+_0x5bb0df[_0x1527c8(0x22b)]+_0x1527c8(0x259)+_0x487255[_0x1527c8(0x266)]),_0x5bb0df[_0x1527c8(0x28b)]=Math[_0x1527c8(0x1f9)](0x0,Math[_0x1527c8(0x265)](_0x5bb0df[_0x1527c8(0x28b)])-Math[_0x1527c8(0x265)](_0x487255[_0x1527c8(0x229)]))));});return _0x319283;});Promise['all'](_0x4f39dc)[_0x2b98b0(0x25d)](async _0x3cffb8=>{var _0x3e02d8=_0x2b98b0;try{for(const _0x307b6c of _0x3cffb8){await _0x307b6c[_0x3e02d8(0x2b2)]();}_0x5d3565['finalize']=_0x3e02d8(0x24d);const _0x227200=await _0x5d3565[_0x3e02d8(0x2b2)](),_0x3f6102=await master_shop[_0x3e02d8(0x29c)](),_0x530a16=await email_settings[_0x3e02d8(0x2c6)](),_0x2bc204=await supervisor_settings[_0x3e02d8(0x29c)]();var _0x2cdb3e=_0x5d3565['sale_product'],_0x38e357='',_0x234fd1;for(_0x234fd1 in _0x2cdb3e){var _0xa7a08c='FG';_0x5d3565[_0x3e02d8(0x1e9)]==_0x3e02d8(0x2da)&&(_0xa7a08c='DG'),_0x38e357+=_0x3e02d8(0x283)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2cdb3e[_0x234fd1][_0x3e02d8(0x241)]+_0x3e02d8(0x201)+_0x3e02d8(0x20b)+_0x2cdb3e[_0x234fd1]['product_code']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2cdb3e[_0x234fd1][_0x3e02d8(0x229)]+_0x3e02d8(0x201)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2cdb3e[_0x234fd1]['unit']+_0x3e02d8(0x201)+_0x3e02d8(0x20b)+_0x2cdb3e[_0x234fd1][_0x3e02d8(0x2b0)]+_0x3e02d8(0x201)+_0x3e02d8(0x20b)+_0x5d3565[_0x3e02d8(0x1e9)]+_0x3e02d8(0x201)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2cdb3e[_0x234fd1]['room_name']+_0x3e02d8(0x201)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xa7a08c+_0x2cdb3e[_0x234fd1][_0x3e02d8(0x253)]+_0x3e02d8(0x201);}let _0x42dfd0=nodemailer['createTransport']({'host':_0x530a16['host'],'port':Number(_0x530a16[_0x3e02d8(0x270)]),'secure':![],'auth':{'user':_0x530a16[_0x3e02d8(0x264)],'pass':_0x530a16[_0x3e02d8(0x1cf)]}}),_0x4dea46={'from':_0x530a16[_0x3e02d8(0x264)],'to':_0x2bc204[0x0][_0x3e02d8(0x280)],'subject':_0x3e02d8(0x27d),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3e02d8(0x2d4)+_0x3e02d8(0x282)+_0x3f6102[0x0][_0x3e02d8(0x211)],'cid':_0x3e02d8(0x2c5)}],'html':_0x3e02d8(0x209)+'<html><head><title></title>'+'</head><body>'+_0x3e02d8(0x256)+_0x3e02d8(0x1ca)+_0x3e02d8(0x256)+_0x3e02d8(0x224)+_0x3e02d8(0x279)+'<div>'+_0x3e02d8(0x250)+_0x3f6102[0x0]['site_title']+'\x20</h2>'+_0x3e02d8(0x279)+_0x3e02d8(0x279)+'<hr\x20class=\x22my-3\x22>'+_0x3e02d8(0x256)+_0x3e02d8(0x1ce)+'\x20Order\x20Number\x20:\x20'+_0x5d3565[_0x3e02d8(0x248)]+'\x20'+_0x3e02d8(0x2ba)+_0x3e02d8(0x219)+_0x5d3565['date']+'\x20'+_0x3e02d8(0x214)+_0x3e02d8(0x294)+'</div>'+_0x3e02d8(0x27e)+_0x3e02d8(0x298)+_0x3e02d8(0x283)+_0x3e02d8(0x2d1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x3e02d8(0x29a)+_0x3e02d8(0x1ea)+_0x3e02d8(0x1d2)+_0x3e02d8(0x23e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3e02d8(0x1ee)+_0x3e02d8(0x1e6)+_0x3e02d8(0x1dd)+'\x20'+_0x38e357+'\x20'+_0x3e02d8(0x23d)+_0x3e02d8(0x2ca)+_0x3e02d8(0x256)+_0x3e02d8(0x2b5)+_0x3e02d8(0x1cd)+_0x3f6102[0x0][_0x3e02d8(0x2d2)]+_0x3e02d8(0x294)+_0x3e02d8(0x279)+_0x3e02d8(0x279)+_0x3e02d8(0x213)};_0x42dfd0['sendMail'](_0x4dea46,function(_0x4fe9ec,_0x20a9bd){var _0x4038fc=_0x3e02d8;_0x4fe9ec?(console[_0x4038fc(0x232)](_0x4fe9ec),console[_0x4038fc(0x232)]('Error\x20Occurs')):console[_0x4038fc(0x232)](_0x4038fc(0x258));}),_0x4d3358[_0x3e02d8(0x2a4)](_0x3e02d8(0x2e1),_0x3e02d8(0x1c5)),_0x3bdc9c['redirect'](_0x3e02d8(0x22a)+_0x28d159);}catch(_0x36b3b2){console['error'](_0x36b3b2),_0x3bdc9c['status'](0x1f4)['json']({'error':_0x3e02d8(0x2dc)});}})['catch'](_0x38cd28=>{var _0x2f1f87=_0x2b98b0;console[_0x2f1f87(0x26d)](_0x38cd28),_0x3bdc9c[_0x2f1f87(0x2d7)](0x1f4)[_0x2f1f87(0x251)]({'error':'An\x20error\x20occurred.'});});}catch(_0x2394fa){console['log'](_0x2394fa);}}),router[a0_0x5ccb64(0x21e)]('/view/:id',auth,async(_0x5e3e1e,_0x1e75fa)=>{var _0x50b551=a0_0x5ccb64;try{const {username:_0x3817e5,email:_0x1b84a2,role:_0x4b84a1}=_0x5e3e1e[_0x50b551(0x24e)],_0x438efc=_0x5e3e1e[_0x50b551(0x24e)],_0x3c6577=await profile[_0x50b551(0x2c6)]({'email':_0x438efc[_0x50b551(0x264)]}),_0x4b073c=await master_shop[_0x50b551(0x29c)](),_0x7a80d6=_0x5e3e1e['params']['id'],_0x3b0b16=await sales_finished[_0x50b551(0x2bc)](_0x7a80d6);let _0x17240a=new Date(_0x3b0b16[_0x50b551(0x1c8)]),_0x4b638a=('0'+_0x17240a[_0x50b551(0x2c2)]())[_0x50b551(0x226)](-0x2),_0xf298ef=('0'+(_0x17240a[_0x50b551(0x2c0)]()+0x1))[_0x50b551(0x226)](-0x2),_0x373b3a=_0x17240a[_0x50b551(0x255)](),_0x2aee6f=_0x373b3a+'-'+_0xf298ef+'-'+_0x4b638a;var _0x3ae04d=[_0x50b551(0x2dd),_0x50b551(0x2c4)];const _0x28880f=await warehouse[_0x50b551(0x28d)]([{'$match':{'name':_0x3b0b16[_0x50b551(0x1e9)],'room':_0x3b0b16[_0x50b551(0x24a)]}},{'$unwind':_0x50b551(0x275)},{'$group':{'_id':_0x50b551(0x272),'name':{'$first':_0x50b551(0x286)},'product_stock':{'$first':_0x50b551(0x1e1)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x50b551(0x27c)},'floorlevel':{'$first':_0x50b551(0x296)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x50b551(0x1d5)},'product_code':{'$first':_0x50b551(0x1c3)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]),_0x23de38=await customer['find']({});let _0x5a933d;if(_0x438efc['role']==_0x50b551(0x22f)){const _0x57897a=await staff['findOne']({'email':_0x438efc[_0x50b551(0x264)]});_0x5a933d=await warehouse['aggregate']([{'$match':{'status':_0x50b551(0x244),'name':_0x57897a['warehouse']}},{'$group':{'_id':_0x50b551(0x246),'name':{'$first':'$name'}}}]);}else _0x5a933d=await warehouse[_0x50b551(0x28d)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x50b551(0x246),'name':{'$first':_0x50b551(0x246)}}}]);const _0x1b6e09=await product[_0x50b551(0x29c)]({});if(_0x4b073c[0x0][_0x50b551(0x22d)]==_0x50b551(0x278)){var _0x20c5bd=users[_0x50b551(0x2b1)];console[_0x50b551(0x232)](_0x20c5bd);}else{if(_0x4b073c[0x0]['language']==_0x50b551(0x2ad))var _0x20c5bd=users[_0x50b551(0x2ad)];else{if(_0x4b073c[0x0][_0x50b551(0x22d)]=='German')var _0x20c5bd=users[_0x50b551(0x208)];else{if(_0x4b073c[0x0]['language']==_0x50b551(0x1c9))var _0x20c5bd=users[_0x50b551(0x1c9)];else{if(_0x4b073c[0x0][_0x50b551(0x22d)]=='French')var _0x20c5bd=users[_0x50b551(0x1c2)];else{if(_0x4b073c[0x0]['language']==_0x50b551(0x288))var _0x20c5bd=users[_0x50b551(0x238)];else{if(_0x4b073c[0x0][_0x50b551(0x22d)]=='Chinese')var _0x20c5bd=users[_0x50b551(0x1cb)];else{if(_0x4b073c[0x0][_0x50b551(0x22d)]==_0x50b551(0x299))var _0x20c5bd=users['Arabic'];}}}}}}}_0x1e75fa[_0x50b551(0x237)](_0x50b551(0x28f),{'success':_0x5e3e1e[_0x50b551(0x2a4)](_0x50b551(0x2e1)),'errors':_0x5e3e1e[_0x50b551(0x2a4)](_0x50b551(0x269)),'role':_0x438efc,'profile':_0x3c6577,'customer':_0x23de38,'warehouse':_0x5a933d,'product':_0x28880f,'user':_0x3b0b16,'master_shop':_0x4b073c,'unit':_0x1b6e09,'language':_0x20c5bd,'rooms_data':_0x3ae04d,'ed_fullDate':_0x2aee6f});}catch(_0xa61fc0){console[_0x50b551(0x232)](_0xa61fc0);}}),router[a0_0x5ccb64(0x234)](a0_0x5ccb64(0x1fa),auth,async(_0xf6fcac,_0x453522)=>{var _0x51b411=a0_0x5ccb64;try{const _0x329073=_0xf6fcac[_0x51b411(0x2a0)]['id'],_0x10042f=await sales_finished[_0x51b411(0x2c6)]({'_id':_0xf6fcac[_0x51b411(0x2a0)]['id']}),_0x233e0d=await warehouse['findOne']({'name':_0x10042f[_0x51b411(0x1e9)],'room':_0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x24a)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x2e3517,customer:_0x3f189e,date:_0x2cdc82,warehouse_name:_0x56ab49,product_name:_0x425355,stock:_0x2cbcdd,adjust_qty:_0x242cf0,note:_0x2b9202,room:_0x23ecb2,primary_code:_0x33440f,secondary_code:_0x4ed976,prod_code:_0xeaa644,level:_0x43f024,isle:_0x2ac1a6,pallet:_0x437c57,expiry_date:_0x5d79ab}=_0xf6fcac['body'];if(typeof _0x425355=='string')var _0x4ef353=[_0xf6fcac[_0x51b411(0x23f)]['product_name']],_0x39b3ac=[_0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x1d8)]],_0x495cb8=[_0xf6fcac['body'][_0x51b411(0x243)]],_0x81978e=[_0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x281)]],_0x1cf75e=[_0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x2a3)]],_0x3ed96e=[_0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x21d)]],_0x102dda=[_0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x287)]],_0x1ab51e=[_0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x1c8)]];else var _0x4ef353=[..._0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x241)]],_0x39b3ac=[..._0xf6fcac[_0x51b411(0x23f)]['stock']],_0x495cb8=[..._0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x243)]],_0x81978e=[..._0xf6fcac[_0x51b411(0x23f)]['primary_code']],_0x1cf75e=[..._0xf6fcac['body']['secondary_code']],_0x3ed96e=[..._0xf6fcac[_0x51b411(0x23f)]['prod_code']],_0x102dda=[..._0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x287)]],_0x1ab51e=[..._0xf6fcac[_0x51b411(0x23f)]['expiry_date']];const _0x35e1a7=_0x4ef353[_0x51b411(0x1ff)](_0x443363=>{return _0x443363={'product_name':_0x443363};});_0x39b3ac[_0x51b411(0x207)]((_0x19f41d,_0x15a9bd)=>{var _0x5f44cb=_0x51b411;_0x35e1a7[_0x15a9bd][_0x5f44cb(0x1d8)]=_0x19f41d;}),_0x495cb8[_0x51b411(0x207)]((_0x3a407c,_0x2d31a5)=>{var _0x141fc9=_0x51b411;_0x35e1a7[_0x2d31a5][_0x141fc9(0x229)]=_0x3a407c;}),_0x81978e[_0x51b411(0x207)]((_0x17f781,_0x55046c)=>{var _0xd66bf5=_0x51b411;_0x35e1a7[_0x55046c][_0xd66bf5(0x281)]=_0x17f781;}),_0x1cf75e[_0x51b411(0x207)]((_0x5a4728,_0x7893c8)=>{_0x35e1a7[_0x7893c8]['secondary_code']=_0x5a4728;}),_0x3ed96e['forEach']((_0x5200ab,_0x23c056)=>{var _0x35178f=_0x51b411;_0x35e1a7[_0x23c056][_0x35178f(0x1eb)]=_0x5200ab;}),_0x102dda[_0x51b411(0x207)]((_0x18ee01,_0x542aef)=>{var _0x38fe2a=_0x51b411;_0x35e1a7[_0x542aef][_0x38fe2a(0x287)]=_0x18ee01;}),_0x1ab51e['forEach']((_0x52550b,_0x30b9e3)=>{var _0x17946d=_0x51b411;_0x35e1a7[_0x30b9e3][_0x17946d(0x1c8)]=_0x52550b;});var _0x41944c=0x0;_0x35e1a7[_0x51b411(0x207)](_0x5811d1=>{var _0xfbecce=_0x51b411;console[_0xfbecce(0x232)](_0xfbecce(0x285),_0x5811d1),(parseInt(_0x5811d1[_0xfbecce(0x1d8)])<parseInt(_0x5811d1[_0xfbecce(0x229)])||parseInt(_0x5811d1[_0xfbecce(0x229)])==0x0)&&_0x41944c++;});if(_0x41944c!=0x0)return _0xf6fcac[_0x51b411(0x2a4)]('errors',_0x51b411(0x2cf)),_0x453522[_0x51b411(0x25c)](_0x51b411(0x23b));_0x10042f['sale_product'][_0x51b411(0x207)](_0x2fc594=>{var _0x8fd5e3=_0x51b411;const _0x2e8409=_0x233e0d[_0x8fd5e3(0x1d9)]['map'](_0x5de851=>{var _0x209690=_0x8fd5e3;_0x5de851['product_name']==_0x2fc594['product_name']&&_0x5de851['bay']==_0x2fc594[_0x209690(0x253)]&&(_0x5de851[_0x209690(0x28b)]=parseInt(_0x5de851[_0x209690(0x28b)])+parseInt(_0x2fc594['quantity']));});}),await _0x233e0d['save']();const _0x13f1c4=_0x35e1a7[_0x51b411(0x1f8)](_0x25259c=>_0x25259c['quantity']!=='0'&&_0x25259c[_0x51b411(0x229)]!=='');_0x10042f[_0x51b411(0x248)]=_0x2e3517,_0x10042f[_0x51b411(0x2d5)]=_0x3f189e,_0x10042f[_0x51b411(0x261)]=_0x2cdc82,_0x10042f[_0x51b411(0x1e9)]=_0x56ab49,_0x10042f[_0x51b411(0x24f)]=_0x13f1c4,_0x10042f['note']=_0x2b9202,_0x10042f[_0x51b411(0x24a)]=_0x23ecb2;const _0x28080b=await _0x10042f[_0x51b411(0x2b2)](),_0x14858e=await sales_finished['findOne']({'_id':_0xf6fcac['params']['id']}),_0x103a78=await warehouse[_0x51b411(0x2c6)]({'name':_0x56ab49,'room':_0x23ecb2,'warehouse_category':'Finished\x20Goods'});_0x14858e[_0x51b411(0x24f)]['forEach'](_0x254068=>{var _0x1e26f6=_0x51b411;const _0x3cfb06=_0x103a78[_0x1e26f6(0x1d9)][_0x1e26f6(0x1ff)](_0x974bb5=>{var _0xf376c5=_0x1e26f6;_0x974bb5[_0xf376c5(0x241)]==_0x254068[_0xf376c5(0x241)]&&_0x974bb5['bay']==_0x254068['bay']&&(_0x974bb5[_0xf376c5(0x28b)]=parseInt(_0x974bb5[_0xf376c5(0x28b)])-parseInt(_0x254068[_0xf376c5(0x229)]));});}),console['log'](_0x51b411(0x23c),_0x103a78),await _0x103a78['save']();const _0x494980=await c_payment_data[_0x51b411(0x2c6)]({'invoice':_0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x248)]});_0x494980['suppliers']=_0xf6fcac[_0x51b411(0x23f)][_0x51b411(0x2d8)],await _0x494980['save'](),_0xf6fcac[_0x51b411(0x2a4)](_0x51b411(0x2e1),_0x51b411(0x1c5)),_0x453522[_0x51b411(0x25c)](_0x51b411(0x1f3));}catch(_0x4e09be){console[_0x51b411(0x232)](_0x4e09be);}}),router[a0_0x5ccb64(0x234)](a0_0x5ccb64(0x2a1),auth,async(_0x2b6bbd,_0x19954c)=>{var _0x2083e1=a0_0x5ccb64;try{const _0x4420be=_0x2b6bbd[_0x2083e1(0x2a0)]['id'],{invoice:_0x52f914,customer:_0x1a7bce,receivable_amount:_0xfc3a63,received_amount:_0x19e8b1}=_0x2b6bbd[_0x2083e1(0x23f)],_0x6c076e=await sales['findById'](_0x4420be);console[_0x2083e1(0x232)](_0x6c076e);var _0x1492c4=_0xfc3a63-_0x19e8b1;console[_0x2083e1(0x232)](_0x19e8b1),_0x6c076e[_0x2083e1(0x26c)]=parseFloat(_0x19e8b1)+parseFloat(_0x6c076e[_0x2083e1(0x26c)]),_0x6c076e[_0x2083e1(0x216)]=_0x1492c4,console[_0x2083e1(0x232)](_0x6c076e);const _0x3eeefc=await _0x6c076e[_0x2083e1(0x2b2)](),_0x475b47=await c_payment_data['findOne']({'invoice':_0x52f914});_0x475b47[_0x2083e1(0x254)]=_0x1492c4,await _0x475b47[_0x2083e1(0x2b2)]();let _0x57ba5e=new Date(),_0x411d90=('0'+_0x57ba5e[_0x2083e1(0x2c2)]())[_0x2083e1(0x226)](-0x2),_0x48e83c=('0'+(_0x57ba5e[_0x2083e1(0x2c0)]()+0x1))[_0x2083e1(0x226)](-0x2),_0x2b38ee=_0x57ba5e['getFullYear'](),_0x3cf6d0=_0x2b38ee+'-'+_0x48e83c+'-'+_0x411d90;const _0x536134=new customer_payment({'invoice':_0x52f914,'date':_0x2b38ee+'-'+_0x48e83c+'-'+_0x411d90,'customer':_0x1a7bce,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x19e8b1}),_0x452c1d=await _0x536134['save']();_0x2b6bbd['flash']('success',_0x2083e1(0x1d7)),_0x19954c['redirect']('/all_sales/view');}catch(_0x2398bb){console[_0x2083e1(0x232)](_0x2398bb);}}),router['get']('/invoice/:id',auth,async(_0x465d6c,_0x349fdc)=>{var _0x1919b5=a0_0x5ccb64;try{const {username:_0x50cdd2,email:_0x4a22e9,role:_0x1c28b3}=_0x465d6c[_0x1919b5(0x24e)],_0x464fa4=_0x465d6c['user'],_0x3df927=await profile['findOne']({'email':_0x464fa4[_0x1919b5(0x264)]}),_0x26e1f0=await master_shop[_0x1919b5(0x29c)]();console[_0x1919b5(0x232)](_0x1919b5(0x27b),_0x26e1f0);const _0x41396b=_0x465d6c[_0x1919b5(0x2a0)]['id'],_0x4766b5=await sales[_0x1919b5(0x2bc)](_0x41396b);console[_0x1919b5(0x232)](_0x4766b5);const _0x3b1e38=await customer[_0x1919b5(0x2c6)]({'name':_0x4766b5['customer']});console['log'](_0x3b1e38);if(_0x26e1f0[0x0][_0x1919b5(0x22d)]==_0x1919b5(0x278)){var _0x42eb6e=users[_0x1919b5(0x2b1)];console[_0x1919b5(0x232)](_0x42eb6e);}else{if(_0x26e1f0[0x0][_0x1919b5(0x22d)]==_0x1919b5(0x2ad))var _0x42eb6e=users[_0x1919b5(0x2ad)];else{if(_0x26e1f0[0x0][_0x1919b5(0x22d)]==_0x1919b5(0x208))var _0x42eb6e=users[_0x1919b5(0x208)];else{if(_0x26e1f0[0x0][_0x1919b5(0x22d)]==_0x1919b5(0x1c9))var _0x42eb6e=users['Spanish'];else{if(_0x26e1f0[0x0][_0x1919b5(0x22d)]==_0x1919b5(0x1c2))var _0x42eb6e=users[_0x1919b5(0x1c2)];else{if(_0x26e1f0[0x0][_0x1919b5(0x22d)]=='Portuguese\x20(BR)')var _0x42eb6e=users['Portuguese'];else{if(_0x26e1f0[0x0][_0x1919b5(0x22d)]=='Chinese')var _0x42eb6e=users[_0x1919b5(0x1cb)];else{if(_0x26e1f0[0x0][_0x1919b5(0x22d)]==_0x1919b5(0x299))var _0x42eb6e=users[_0x1919b5(0x200)];}}}}}}}_0x349fdc[_0x1919b5(0x237)](_0x1919b5(0x274),{'success':_0x465d6c[_0x1919b5(0x2a4)](_0x1919b5(0x2e1)),'errors':_0x465d6c[_0x1919b5(0x2a4)]('errors'),'role':_0x464fa4,'profile':_0x3df927,'master_shop':_0x26e1f0,'customers':_0x3b1e38,'sales':_0x4766b5,'language':_0x42eb6e});}catch(_0x13a583){console[_0x1919b5(0x232)](_0x13a583);}}),router[a0_0x5ccb64(0x21e)]('/view/return_sales/:id',auth,async(_0x28fb82,_0x1e10b3)=>{var _0x508ffa=a0_0x5ccb64;try{const {username:_0x3bbcf7,email:_0x4645bc,role:_0xb6578c}=_0x28fb82[_0x508ffa(0x24e)],_0x1af66a=_0x28fb82['user'],_0x3966aa=await profile['findOne']({'email':_0x1af66a[_0x508ffa(0x264)]}),_0x3ebd99=await master_shop[_0x508ffa(0x29c)](),_0x516820=_0x28fb82['params']['id'],_0x2d66b4=await sales_finished[_0x508ffa(0x2bc)](_0x516820),_0x502d7f=await warehouse['aggregate']([{'$match':{'name':_0x2d66b4[_0x508ffa(0x1e9)]}},{'$unwind':_0x508ffa(0x275)},{'$group':{'_id':_0x508ffa(0x272),'name':{'$first':_0x508ffa(0x286)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x508ffa(0x249)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x508ffa(0x27c)},'floorlevel':{'$first':_0x508ffa(0x296)},'primary_code':{'$first':_0x508ffa(0x262)},'secondary_code':{'$first':_0x508ffa(0x1d5)},'product_code':{'$first':_0x508ffa(0x1c3)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x508ffa(0x247)},'expiry_date':{'$first':_0x508ffa(0x290)},'production_date':{'$first':_0x508ffa(0x1f2)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x508ffa(0x205)},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x508ffa(0x29f)}}}]),_0x375142=await product[_0x508ffa(0x29c)]({}),_0x42f196=await warehouse[_0x508ffa(0x28d)]([{'$match':{'status':'Enabled','warehouse_category':_0x508ffa(0x1fb),'name':{'$ne':'Return\x20Goods','$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0x508ffa(0x246),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x578547=[_0x508ffa(0x2db)];const _0x268ac2=await warehouse[_0x508ffa(0x28d)]([{'$match':{'status':'Enabled','name':_0x508ffa(0x2c7)}},{'$group':{'_id':_0x508ffa(0x246),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x3ebd99[0x0][_0x508ffa(0x22d)]=='English\x20(US)'){var _0x5ad2fc=users[_0x508ffa(0x2b1)];console[_0x508ffa(0x232)](_0x5ad2fc);}else{if(_0x3ebd99[0x0][_0x508ffa(0x22d)]=='Hindi')var _0x5ad2fc=users[_0x508ffa(0x2ad)];else{if(_0x3ebd99[0x0][_0x508ffa(0x22d)]==_0x508ffa(0x208))var _0x5ad2fc=users[_0x508ffa(0x208)];else{if(_0x3ebd99[0x0]['language']==_0x508ffa(0x1c9))var _0x5ad2fc=users[_0x508ffa(0x1c9)];else{if(_0x3ebd99[0x0]['language']==_0x508ffa(0x1c2))var _0x5ad2fc=users['French'];else{if(_0x3ebd99[0x0][_0x508ffa(0x22d)]=='Portuguese\x20(BR)')var _0x5ad2fc=users['Portuguese'];else{if(_0x3ebd99[0x0]['language']=='Chinese')var _0x5ad2fc=users[_0x508ffa(0x1cb)];else{if(_0x3ebd99[0x0]['language']==_0x508ffa(0x299))var _0x5ad2fc=users[_0x508ffa(0x200)];}}}}}}}_0x1e10b3[_0x508ffa(0x237)]('return_sale_finished',{'success':_0x28fb82['flash'](_0x508ffa(0x2e1)),'errors':_0x28fb82[_0x508ffa(0x2a4)](_0x508ffa(0x269)),'role':_0x1af66a,'profile':_0x3966aa,'user':_0x2d66b4,'stock':_0x502d7f,'master_shop':_0x3ebd99,'unit':_0x375142,'language':_0x5ad2fc,'warehouses':_0x42f196,'rooms':_0x578547,'warehouse_QA':_0x268ac2});}catch(_0xd4458){console[_0x508ffa(0x232)](_0xd4458),_0x1e10b3[_0x508ffa(0x2d7)](0xc8)['json']({'message':_0xd4458[_0x508ffa(0x2b8)]});}}),router[a0_0x5ccb64(0x234)](a0_0x5ccb64(0x1f1),auth,async(_0x41a9b9,_0x56aa9e)=>{var _0x4a8039=a0_0x5ccb64;if(_0x41a9b9[_0x4a8039(0x23f)]['for_categorize']=='QA')try{const {invoice:_0x2c252f,date:_0x3e8227,warehouse_name:_0x74cfaa,product_name:_0x549a73,primary_code:_0x423a0b,secondary_code:_0x1697d0,product_code:_0x51a524,sales_quantity:_0x21b081,stocks:_0x5bce1f,return_qty:_0x119d86,Room_name:_0x5b32f1,to_warehouse_name_QA:_0x5c62a8,to_Room_name_QA:_0x3e1450,note:_0x57ca1d,for_categorize:_0x33a162,product_name_QA1:_0x5e2505}=_0x41a9b9['body'];if(typeof _0x5e2505==_0x4a8039(0x284))var _0x1f7242=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2c3)]],_0x347599=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2d9)]],_0x7c2cee=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2d3)]],_0x49fa3a=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x1dc)]],_0x2efd2=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2c1)]],_0xf10d5d=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x221)]],_0x451d68=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x20d)]],_0x992f6a=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x1ec)]],_0x538143=[_0x41a9b9['body']['maxProducts_QA']],_0x40b56f=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2b4)]],_0x524431=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x25e)]],_0x511a67=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2cb)]],_0x350646=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2a8)]],_0x16f95f=[_0x41a9b9[_0x4a8039(0x23f)]['expiry_date_QA']];else var _0x1f7242=[..._0x41a9b9[_0x4a8039(0x23f)]['product_name_QA1']],_0x347599=[..._0x41a9b9['body'][_0x4a8039(0x2d9)]],_0x7c2cee=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2d3)]],_0x49fa3a=[..._0x41a9b9[_0x4a8039(0x23f)]['product_code_QA']],_0x2efd2=[..._0x41a9b9['body'][_0x4a8039(0x2c1)]],_0xf10d5d=[..._0x41a9b9[_0x4a8039(0x23f)]['stocks_QA']],_0x451d68=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x20d)]],_0x992f6a=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x1ec)]],_0x538143=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x231)]],_0x40b56f=[..._0x41a9b9['body'][_0x4a8039(0x2b4)]],_0x524431=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x25e)]],_0x511a67=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2cb)]],_0x350646=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2a8)]],_0x16f95f=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2b6)]];const _0x27d05e=_0x1f7242['map'](_0x3db62a=>{return _0x3db62a={'product_name':_0x3db62a};});_0x347599[_0x4a8039(0x207)]((_0x299f14,_0x414af2)=>{var _0x4d9dc7=_0x4a8039;_0x27d05e[_0x414af2][_0x4d9dc7(0x281)]=_0x299f14;}),_0x7c2cee[_0x4a8039(0x207)]((_0x3ddfbc,_0x44dbc0)=>{_0x27d05e[_0x44dbc0]['secondary_code']=_0x3ddfbc;}),_0x49fa3a[_0x4a8039(0x207)]((_0xf22e56,_0x3d7b21)=>{var _0x4c7d8d=_0x4a8039;_0x27d05e[_0x3d7b21][_0x4c7d8d(0x1eb)]=_0xf22e56;}),_0x2efd2[_0x4a8039(0x207)]((_0x2276c1,_0x2e04ee)=>{var _0x4328c5=_0x4a8039;_0x27d05e[_0x2e04ee][_0x4328c5(0x218)]=_0x2276c1;}),_0xf10d5d[_0x4a8039(0x207)]((_0x3da88e,_0x369dfc)=>{var _0x586625=_0x4a8039;_0x27d05e[_0x369dfc][_0x586625(0x1d8)]=_0x3da88e;}),_0x451d68[_0x4a8039(0x207)]((_0xddf344,_0x5f5540)=>{var _0x1f726c=_0x4a8039;_0x27d05e[_0x5f5540][_0x1f726c(0x204)]=_0xddf344;}),_0x992f6a['forEach']((_0x26b4be,_0x5773df)=>{_0x27d05e[_0x5773df]['maxPerUnit']=_0x26b4be;}),_0x538143[_0x4a8039(0x207)]((_0x5aa83a,_0x355eef)=>{var _0x5ca07c=_0x4a8039;_0x27d05e[_0x355eef][_0x5ca07c(0x1e0)]=_0x5aa83a;}),_0x40b56f['forEach']((_0xd2a8c5,_0x26af8f)=>{_0x27d05e[_0x26af8f]['batch_code']=_0xd2a8c5;}),_0x524431['forEach']((_0x4ef0c5,_0x134d5f)=>{var _0x3be31e=_0x4a8039;_0x27d05e[_0x134d5f][_0x3be31e(0x2b0)]=_0x4ef0c5;}),_0x511a67['forEach']((_0xe326d9,_0x377d96)=>{_0x27d05e[_0x377d96]['unit']=_0xe326d9;}),_0x350646[_0x4a8039(0x207)]((_0x4911f2,_0x247827)=>{var _0x421eac=_0x4a8039;_0x27d05e[_0x247827][_0x421eac(0x2a7)]=_0x4911f2;}),_0x16f95f[_0x4a8039(0x207)]((_0xd11c70,_0xda3cbd)=>{var _0x33051d=_0x4a8039;_0x27d05e[_0xda3cbd][_0x33051d(0x1c8)]=_0xd11c70;});const _0x36dfca=await sales_finished[_0x4a8039(0x2c6)]({'invoice':_0x2c252f});_0x36dfca[_0x4a8039(0x295)]=_0x4a8039(0x24d);const _0x12d0fb=await _0x36dfca['save'](),_0x302052=new sales_return_finished({'invoice':_0x2c252f,'customer':_0x41a9b9['body'][_0x4a8039(0x2d5)],'date':_0x3e8227,'warehouse_name':_0x74cfaa,'room':_0x5b32f1,'ToWarehouse':_0x5c62a8,'ToRoom':_0x3e1450,'return_sale_QA':_0x27d05e,'note':_0x57ca1d,'warehouse_cat':_0x33a162}),_0x1eb611=await _0x302052['save'](),_0x33b829=await sales_return_finished[_0x4a8039(0x2c6)]({'invoice':_0x2c252f}),_0x4a23dd=await warehouse[_0x4a8039(0x2c6)]({'name':_0x5c62a8,'room':_0x3e1450});_0x33b829[_0x4a8039(0x2b7)][_0x4a8039(0x207)](_0x4461b2=>{var _0x2ed961=_0x4a8039,_0x4aeef8=0x0;const _0xee6738=_0x4a23dd['product_details'][_0x2ed961(0x1ff)](_0x3f1c3e=>{var _0x322048=_0x2ed961;_0x3f1c3e['product_name']==_0x4461b2[_0x322048(0x241)]&&_0x3f1c3e[_0x322048(0x1c8)]==_0x4461b2[_0x322048(0x1c8)]&&_0x3f1c3e[_0x322048(0x2a7)]==_0x4461b2['production_date']&&_0x3f1c3e[_0x322048(0x268)]==_0x4461b2[_0x322048(0x268)]&&(_0x3f1c3e[_0x322048(0x28b)]=parseInt(_0x3f1c3e['product_stock'])+parseInt(_0x4461b2[_0x322048(0x204)]),_0x4aeef8++);});_0x4aeef8=='0'&&(_0x4a23dd[_0x2ed961(0x1d9)]=_0x4a23dd[_0x2ed961(0x1d9)][_0x2ed961(0x257)]({'product_name':_0x4461b2['product_name'],'product_stock':_0x4461b2[_0x2ed961(0x204)],'primary_code':_0x4461b2[_0x2ed961(0x281)],'secondary_code':_0x4461b2[_0x2ed961(0x2a3)],'product_code':_0x4461b2[_0x2ed961(0x1eb)],'batch_code':_0x4461b2[_0x2ed961(0x268)],'maxPerUnit':_0x4461b2[_0x2ed961(0x1e3)],'production_date':_0x4461b2[_0x2ed961(0x2a7)],'expiry_date':_0x4461b2[_0x2ed961(0x1c8)],'secondary_unit':_0x4461b2['secondary_unit'],'unit':_0x4461b2[_0x2ed961(0x1f5)],'maxProducts':_0x4461b2['maxProducts'],'bay':_0x4461b2[_0x2ed961(0x253)]}));}),await _0x4a23dd[_0x4a8039(0x2b2)]();const _0x9e2934=new c_payment_data({'invoice':_0x2c252f,'customer':_0x41a9b9['body']['customer'],'reason':'Sale\x20Return'});await _0x9e2934[_0x4a8039(0x2b2)]();const _0xd34014=await master_shop[_0x4a8039(0x29c)](),_0x519d93=await email_settings[_0x4a8039(0x2c6)](),_0x3db37d=await customer[_0x4a8039(0x2c6)]({'name':_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2d5)]});_0xd34014[0x0]['currency_placement']==0x1?(right_currency=_0xd34014[0x0][_0x4a8039(0x28a)],left_currency=''):(right_currency='',left_currency=_0xd34014[0x0][_0x4a8039(0x28a)]);var _0x330c73=_0x1f7242,_0x24c836=_0x451d68,_0x5ef5ea='',_0x41f619;for(_0x41f619 in _0x330c73){_0x5ef5ea+=_0x4a8039(0x283)+_0x4a8039(0x20b)+_0x330c73[_0x41f619]+'</td>'+_0x4a8039(0x20b)+_0x24c836[_0x41f619]+_0x4a8039(0x201)+_0x4a8039(0x1ee);}console[_0x4a8039(0x232)]('product_list',_0x5ef5ea);let _0x120d15=nodemailer[_0x4a8039(0x291)]({'service':'gmail','auth':{'user':_0x519d93[_0x4a8039(0x264)],'pass':_0x519d93[_0x4a8039(0x1cf)]}}),_0x1b4f65={'from':_0x519d93[_0x4a8039(0x264)],'to':_0x3db37d[_0x4a8039(0x264)],'subject':_0x4a8039(0x1e8),'attachments':[{'filename':_0x4a8039(0x2b3),'path':__dirname+_0x4a8039(0x2d4)+_0x4a8039(0x282)+_0xd34014[0x0][_0x4a8039(0x211)],'cid':_0x4a8039(0x2c5)}],'html':_0x4a8039(0x209)+_0x4a8039(0x236)+_0x4a8039(0x271)+_0x4a8039(0x256)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4a8039(0x256)+_0x4a8039(0x224)+'</div>'+'<div>'+'<h2>\x20'+_0xd34014[0x0][_0x4a8039(0x2d2)]+'\x20</h2>'+_0x4a8039(0x279)+_0x4a8039(0x279)+_0x4a8039(0x20c)+_0x4a8039(0x256)+_0x4a8039(0x1ce)+'\x20Order\x20Number\x20:\x20'+_0x2c252f+'\x20'+_0x4a8039(0x2ba)+_0x4a8039(0x219)+_0x3e8227+'\x20'+_0x4a8039(0x214)+_0x4a8039(0x294)+_0x4a8039(0x279)+_0x4a8039(0x27e)+_0x4a8039(0x298)+_0x4a8039(0x283)+_0x4a8039(0x2d1)+_0x4a8039(0x263)+_0x4a8039(0x2bd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x4a8039(0x1ee)+_0x4a8039(0x1e6)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5ef5ea+'\x20'+_0x4a8039(0x23d)+_0x4a8039(0x2ca)+_0x4a8039(0x256)+_0x4a8039(0x2b5)+_0x4a8039(0x1cd)+_0xd34014[0x0][_0x4a8039(0x2d2)]+_0x4a8039(0x294)+'</div>'+'</div>'+_0x4a8039(0x213)};_0x120d15[_0x4a8039(0x2af)](_0x1b4f65,function(_0x295fcc,_0x532aa4){var _0xed977f=_0x4a8039;_0x295fcc?(console[_0xed977f(0x232)](_0x295fcc),console['log'](_0xed977f(0x2a9))):console[_0xed977f(0x232)](_0xed977f(0x258));}),_0x41a9b9[_0x4a8039(0x2a4)](_0x4a8039(0x2e1),'sales\x20item\x20return\x20successfull'),_0x56aa9e['redirect'](_0x4a8039(0x1f3));}catch(_0x31493c){_0x56aa9e[_0x4a8039(0x2d7)](0xc8)[_0x4a8039(0x251)]({'message1':_0x31493c[_0x4a8039(0x2b8)]});}else{if(_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x21c)]=='GS')try{const {invoice:_0x45494b,date:_0x12639d,warehouse_name:_0x1a0ab8,product_name:_0x23604f,primary_code:_0x4f6e1b,secondary_code:_0xceef77,product_code:_0x539873,sales_quantity:_0x19f703,stocks:_0x2806b1,return_qty:_0x12dca5,Room_name:_0xf9470a,to_warehouse_name:_0x5418c6,to_Room_name:_0x163eed,note:_0x428727,level:_0x55f5d5,isle:_0x4694da,pallet:_0x20ab1a,for_categorize:_0x1363ae}=_0x41a9b9[_0x4a8039(0x23f)];if(typeof _0x23604f==_0x4a8039(0x284))var _0x1f7242=[_0x41a9b9[_0x4a8039(0x23f)]['product_name']],_0x347599=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x281)]],_0x7c2cee=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2a3)]],_0x49fa3a=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x1eb)]],_0x2efd2=[_0x41a9b9[_0x4a8039(0x23f)]['sales_quantity']],_0x451d68=[_0x41a9b9['body'][_0x4a8039(0x204)]],_0xd17506=[_0x41a9b9['body'][_0x4a8039(0x253)]],_0x992f6a=[_0x41a9b9['body']['maxPerUnit']],_0x538143=[_0x41a9b9['body'][_0x4a8039(0x1e0)]],_0x40b56f=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x268)]],_0x524431=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2b0)]],_0x511a67=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x1f5)]],_0x350646=[_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2a7)]],_0x16f95f=[_0x41a9b9[_0x4a8039(0x23f)]['expiry_date']];else var _0x1f7242=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x241)]],_0x347599=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x281)]],_0x7c2cee=[..._0x41a9b9[_0x4a8039(0x23f)]['secondary_code']],_0x49fa3a=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x1eb)]],_0x2efd2=[..._0x41a9b9[_0x4a8039(0x23f)]['sales_quantity']],_0x451d68=[..._0x41a9b9[_0x4a8039(0x23f)]['return_qty']],_0xd17506=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x253)]],_0x992f6a=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x1e3)]],_0x538143=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x1e0)]],_0x40b56f=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x268)]],_0x524431=[..._0x41a9b9['body']['secondary_unit']],_0x511a67=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x1f5)]],_0x350646=[..._0x41a9b9[_0x4a8039(0x23f)]['production_date']],_0x16f95f=[..._0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x1c8)]];const _0x5db16a=_0x1f7242[_0x4a8039(0x1ff)](_0x53fa90=>{return _0x53fa90={'product_name':_0x53fa90};});_0x347599[_0x4a8039(0x207)]((_0xab634a,_0x3e2735)=>{var _0x2dae42=_0x4a8039;_0x5db16a[_0x3e2735][_0x2dae42(0x281)]=_0xab634a;}),_0x7c2cee[_0x4a8039(0x207)]((_0x4c4de0,_0x29779e)=>{_0x5db16a[_0x29779e]['secondary_code']=_0x4c4de0;}),_0x49fa3a['forEach']((_0x48425e,_0x4e4013)=>{var _0x423d21=_0x4a8039;_0x5db16a[_0x4e4013][_0x423d21(0x1eb)]=_0x48425e;}),_0x2efd2['forEach']((_0x746c3d,_0x379343)=>{var _0x886bd0=_0x4a8039;_0x5db16a[_0x379343][_0x886bd0(0x218)]=_0x746c3d;}),_0x451d68[_0x4a8039(0x207)]((_0x2a9e79,_0x318968)=>{var _0x1bd824=_0x4a8039;_0x5db16a[_0x318968][_0x1bd824(0x204)]=_0x2a9e79;}),_0xd17506['forEach']((_0x1ed431,_0x5df271)=>{var _0x3c9d26=_0x4a8039;_0x5db16a[_0x5df271][_0x3c9d26(0x253)]=_0x1ed431;}),_0x992f6a[_0x4a8039(0x207)]((_0x56bce5,_0x420082)=>{_0x5db16a[_0x420082]['maxPerUnit']=_0x56bce5;}),_0x538143[_0x4a8039(0x207)]((_0x240be4,_0x19d209)=>{_0x5db16a[_0x19d209]['maxProducts']=_0x240be4;}),_0x40b56f[_0x4a8039(0x207)]((_0x37fec3,_0x3c7219)=>{_0x5db16a[_0x3c7219]['batch_code']=_0x37fec3;}),_0x524431[_0x4a8039(0x207)]((_0x26fa7f,_0x563d11)=>{var _0x379978=_0x4a8039;_0x5db16a[_0x563d11][_0x379978(0x2b0)]=_0x26fa7f;}),_0x511a67[_0x4a8039(0x207)]((_0x58dfd0,_0x49fa19)=>{var _0x351449=_0x4a8039;_0x5db16a[_0x49fa19][_0x351449(0x1f5)]=_0x58dfd0;}),_0x350646[_0x4a8039(0x207)]((_0x3d9c33,_0x2c1105)=>{var _0x5d07ba=_0x4a8039;_0x5db16a[_0x2c1105][_0x5d07ba(0x2a7)]=_0x3d9c33;}),_0x16f95f[_0x4a8039(0x207)]((_0x122ea0,_0x8c2161)=>{var _0x471114=_0x4a8039;_0x5db16a[_0x8c2161][_0x471114(0x1c8)]=_0x122ea0;});var _0x4f5633=0x0;_0x5db16a[_0x4a8039(0x207)](_0x73a21c=>{var _0x4316ee=_0x4a8039;(parseInt(_0x73a21c['sale_qty'])<parseInt(_0x73a21c['return_qty'])||parseInt(_0x73a21c[_0x4316ee(0x1d8)])<parseInt(_0x73a21c[_0x4316ee(0x204)])&&parseInt(_0x73a21c[_0x4316ee(0x218)])>parseInt(_0x73a21c[_0x4316ee(0x204)])||parseInt(_0x73a21c[_0x4316ee(0x204)])==0x0)&&_0x4f5633++;});if(_0x4f5633!=0x0)return _0x41a9b9[_0x4a8039(0x2a4)](_0x4a8039(0x269),_0x4a8039(0x217)),_0x56aa9e[_0x4a8039(0x25c)](_0x4a8039(0x23b));const _0x12d0aa=await sales_finished[_0x4a8039(0x2c6)]({'invoice':_0x45494b});_0x12d0aa['return_data']=_0x4a8039(0x24d);const _0x569fe8=await _0x12d0aa[_0x4a8039(0x2b2)](),_0x505f6f=new sales_return_finished({'invoice':_0x45494b,'customer':_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2d5)],'date':_0x12639d,'warehouse_name':_0x1a0ab8,'room':_0xf9470a,'ToWarehouse':_0x5418c6,'ToRoom':_0x163eed,'return_sale':_0x5db16a,'note':_0x428727,'warehouse_cat':_0x1363ae}),_0x469d6d=await _0x505f6f[_0x4a8039(0x2b2)](),_0x330299=await sales_return_finished[_0x4a8039(0x2c6)]({'invoice':_0x45494b}),_0x17d03e=await warehouse[_0x4a8039(0x2c6)]({'name':_0x5418c6,'room':_0x163eed,'warehouse_category':_0x4a8039(0x1fb)});_0x330299[_0x4a8039(0x202)][_0x4a8039(0x207)](_0x42e870=>{var _0x6af1a2=_0x4a8039,_0x3e9840=0x0;const _0x322767=_0x17d03e['product_details'][_0x6af1a2(0x1ff)](_0x24b9aa=>{var _0xf91985=_0x6af1a2;_0x24b9aa[_0xf91985(0x241)]==_0x42e870[_0xf91985(0x241)]&&_0x24b9aa['bay']==_0x42e870['bay']&&_0x24b9aa[_0xf91985(0x1c8)]==_0x42e870['expiry_date']&&_0x24b9aa['production_date']==_0x42e870[_0xf91985(0x2a7)]&&_0x24b9aa[_0xf91985(0x268)]==_0x42e870['batch_code']&&(_0x24b9aa[_0xf91985(0x28b)]=parseInt(_0x24b9aa[_0xf91985(0x28b)])+parseInt(_0x42e870[_0xf91985(0x204)]),_0x3e9840++);});_0x3e9840=='0'&&(_0x17d03e[_0x6af1a2(0x1d9)]=_0x17d03e[_0x6af1a2(0x1d9)]['concat']({'product_name':_0x42e870['product_name'],'product_stock':_0x42e870['return_qty'],'primary_code':_0x42e870[_0x6af1a2(0x281)],'secondary_code':_0x42e870[_0x6af1a2(0x2a3)],'product_code':_0x42e870[_0x6af1a2(0x1eb)],'bay':_0x42e870[_0x6af1a2(0x253)],'batch_code':_0x42e870[_0x6af1a2(0x268)],'maxPerUnit':_0x42e870[_0x6af1a2(0x1e3)],'production_date':_0x42e870[_0x6af1a2(0x2a7)],'expiry_date':_0x42e870['expiry_date'],'secondary_unit':_0x42e870[_0x6af1a2(0x2b0)],'unit':_0x42e870[_0x6af1a2(0x1f5)],'maxProducts':_0x42e870[_0x6af1a2(0x1e0)]}));}),await _0x17d03e[_0x4a8039(0x2b2)](),console[_0x4a8039(0x232)](_0x41a9b9[_0x4a8039(0x23f)]);const _0x3cf66d=new c_payment_data({'invoice':_0x45494b,'customer':_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2d5)],'reason':_0x4a8039(0x260)});await _0x3cf66d['save']();const _0x14def2=await master_shop[_0x4a8039(0x29c)]();console['log'](_0x4a8039(0x29e),_0x14def2[0x0][_0x4a8039(0x211)]);const _0x57e3df=await email_settings[_0x4a8039(0x2c6)](),_0x313ece=await customer[_0x4a8039(0x2c6)]({'name':_0x41a9b9[_0x4a8039(0x23f)][_0x4a8039(0x2d5)]});console['log'](_0x4a8039(0x2a5),_0x313ece);_0x14def2[0x0][_0x4a8039(0x1fd)]==0x1?(right_currency=_0x14def2[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x14def2[0x0][_0x4a8039(0x28a)]);var _0x330c73=_0x1f7242,_0x24c836=_0x451d68,_0x5ef5ea='',_0x41f619;for(_0x41f619 in _0x330c73){_0x5ef5ea+='<tr>'+_0x4a8039(0x20b)+_0x330c73[_0x41f619]+_0x4a8039(0x201)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x24c836[_0x41f619]+_0x4a8039(0x201)+_0x4a8039(0x1ee);}console[_0x4a8039(0x232)](_0x4a8039(0x21a),_0x5ef5ea);let _0x4a6bb6=nodemailer['createTransport']({'service':_0x4a8039(0x28e),'auth':{'user':_0x57e3df[_0x4a8039(0x264)],'pass':_0x57e3df[_0x4a8039(0x1cf)]}}),_0x583f51={'from':_0x57e3df[_0x4a8039(0x264)],'to':_0x313ece[_0x4a8039(0x264)],'subject':_0x4a8039(0x1e8),'attachments':[{'filename':_0x4a8039(0x2b3),'path':__dirname+_0x4a8039(0x2d4)+_0x4a8039(0x282)+_0x14def2[0x0][_0x4a8039(0x211)],'cid':_0x4a8039(0x2c5)}],'html':'<!DOCTYPE\x20html>'+_0x4a8039(0x236)+'</head><body>'+_0x4a8039(0x256)+_0x4a8039(0x1ca)+_0x4a8039(0x256)+_0x4a8039(0x224)+_0x4a8039(0x279)+_0x4a8039(0x256)+_0x4a8039(0x250)+_0x14def2[0x0][_0x4a8039(0x2d2)]+'\x20</h2>'+_0x4a8039(0x279)+'</div>'+_0x4a8039(0x20c)+_0x4a8039(0x256)+_0x4a8039(0x1ce)+_0x4a8039(0x2cd)+_0x45494b+'\x20'+_0x4a8039(0x2ba)+_0x4a8039(0x219)+_0x12639d+'\x20'+_0x4a8039(0x214)+_0x4a8039(0x294)+_0x4a8039(0x279)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4a8039(0x298)+_0x4a8039(0x283)+_0x4a8039(0x2d1)+_0x4a8039(0x263)+_0x4a8039(0x2bd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x4a8039(0x1e6)+_0x4a8039(0x1dd)+'\x20'+_0x5ef5ea+'\x20'+_0x4a8039(0x23d)+_0x4a8039(0x2ca)+_0x4a8039(0x256)+'<strong>\x20Regards\x20</strong>'+_0x4a8039(0x1cd)+_0x14def2[0x0][_0x4a8039(0x2d2)]+'</h5>'+_0x4a8039(0x279)+'</div>'+_0x4a8039(0x213)};_0x4a6bb6[_0x4a8039(0x2af)](_0x583f51,function(_0x2b0122,_0xebff0b){var _0x28d28c=_0x4a8039;_0x2b0122?(console[_0x28d28c(0x232)](_0x2b0122),console[_0x28d28c(0x232)](_0x28d28c(0x2a9))):console[_0x28d28c(0x232)](_0x28d28c(0x258));}),_0x41a9b9[_0x4a8039(0x2a4)](_0x4a8039(0x2e1),_0x4a8039(0x21b)),_0x56aa9e['redirect']('/all_sales_finished/view');}catch(_0x1a7c7d){console[_0x4a8039(0x232)](_0x1a7c7d),_0x56aa9e[_0x4a8039(0x2d7)](0xc8)[_0x4a8039(0x251)]({'message1':_0x1a7c7d['message']});}}}),router[a0_0x5ccb64(0x21e)](a0_0x5ccb64(0x267),auth,async(_0x523d7f,_0x3e0d87)=>{var _0x1097b0=a0_0x5ccb64;try{const {username:_0x47dfed,email:_0x1bc4f0,role:_0x3cb59f}=_0x523d7f['user'],_0x2bad42=_0x523d7f['user'],_0x1d0083=await profile['findOne']({'email':_0x2bad42['email']}),_0x34f7b1=await master_shop[_0x1097b0(0x29c)]();console[_0x1097b0(0x232)](_0x1097b0(0x22c),_0x34f7b1);const _0x330f66=_0x523d7f[_0x1097b0(0x2a0)]['id'],_0x4cabef=await sales[_0x1097b0(0x2bc)](_0x330f66);console['log']('barcode\x20user_id',_0x4cabef);if(_0x34f7b1[0x0][_0x1097b0(0x22d)]==_0x1097b0(0x278))var _0x56e1c4=users[_0x1097b0(0x2b1)];else{if(_0x34f7b1[0x0]['language']==_0x1097b0(0x2ad))var _0x56e1c4=users[_0x1097b0(0x2ad)];else{if(_0x34f7b1[0x0][_0x1097b0(0x22d)]==_0x1097b0(0x208))var _0x56e1c4=users['German'];else{if(_0x34f7b1[0x0][_0x1097b0(0x22d)]==_0x1097b0(0x1c9))var _0x56e1c4=users['Spanish'];else{if(_0x34f7b1[0x0][_0x1097b0(0x22d)]==_0x1097b0(0x1c2))var _0x56e1c4=users[_0x1097b0(0x1c2)];else{if(_0x34f7b1[0x0][_0x1097b0(0x22d)]==_0x1097b0(0x288))var _0x56e1c4=users[_0x1097b0(0x238)];else{if(_0x34f7b1[0x0]['language']==_0x1097b0(0x1cb))var _0x56e1c4=users['Chinese'];else{if(_0x34f7b1[0x0][_0x1097b0(0x22d)]==_0x1097b0(0x299))var _0x56e1c4=users['Arabic'];}}}}}}}_0x3e0d87[_0x1097b0(0x237)](_0x1097b0(0x277),{'success':_0x523d7f[_0x1097b0(0x2a4)]('success'),'errors':_0x523d7f[_0x1097b0(0x2a4)](_0x1097b0(0x269)),'role':_0x2bad42,'profile':_0x1d0083,'alldata':_0x4cabef,'master_shop':_0x34f7b1,'language':_0x56e1c4});}catch(_0x412b0a){console[_0x1097b0(0x232)](_0x412b0a);}}),router['post'](a0_0x5ccb64(0x1e5),async(_0x265a8,_0x32c653)=>{var _0x74500d=a0_0x5ccb64;const {product_code:_0x1047ba,warehouse_name:_0x501804,rooms_data:_0x18ef8c,Roomslist:_0x31dd00}=_0x265a8[_0x74500d(0x23f)],_0x55dc9b=_0x31dd00[_0x74500d(0x29b)](','),_0x43eb25=[];async function _0x4f8470(_0x45f224){var _0xd9d292=_0x74500d;const _0x135920=await warehouse[_0xd9d292(0x28d)]([{'$match':{'name':_0x501804,'room':_0x45f224}},{'$unwind':_0xd9d292(0x275)},{'$match':{'product_details.primary_code':_0x1047ba}},{'$group':{'_id':_0xd9d292(0x272),'name':{'$first':_0xd9d292(0x286)},'product_stock':{'$first':_0xd9d292(0x1e1)},'primary_code':{'$first':_0xd9d292(0x262)},'secondary_code':{'$first':_0xd9d292(0x1d5)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0xd9d292(0x249)},'isle':{'$first':_0xd9d292(0x2ce)},'type':{'$first':_0xd9d292(0x27c)},'pallet':{'$first':_0xd9d292(0x296)},'unit':{'$first':_0xd9d292(0x1e4)},'secondary_unit':{'$first':_0xd9d292(0x205)},'storage':{'$first':_0xd9d292(0x2c9)},'rack':{'$first':_0xd9d292(0x247)},'expiry_date':{'$first':_0xd9d292(0x290)},'production_date':{'$first':_0xd9d292(0x1f2)},'maxPerUnit':{'$first':_0xd9d292(0x29f)},'batch_code':{'$first':_0xd9d292(0x206)},'product_cat':{'$first':_0xd9d292(0x293)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0xd9d292(0x2a2)}}}]),_0x2587ab=await warehouse[_0xd9d292(0x28d)]([{'$match':{'name':_0x501804,'room':_0x45f224}},{'$unwind':_0xd9d292(0x275)},{'$match':{'product_details.secondary_code':_0x1047ba}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0xd9d292(0x262)},'secondary_code':{'$first':_0xd9d292(0x1d5)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0xd9d292(0x249)},'isle':{'$first':_0xd9d292(0x2ce)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xd9d292(0x296)},'unit':{'$first':_0xd9d292(0x1e4)},'secondary_unit':{'$first':_0xd9d292(0x205)},'storage':{'$first':_0xd9d292(0x2c9)},'rack':{'$first':_0xd9d292(0x247)},'expiry_date':{'$first':_0xd9d292(0x290)},'production_date':{'$first':_0xd9d292(0x1f2)},'maxPerUnit':{'$first':_0xd9d292(0x29f)},'batch_code':{'$first':_0xd9d292(0x206)},'product_cat':{'$first':_0xd9d292(0x293)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0xd9d292(0x20f)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x135920[_0xd9d292(0x292)]>0x0)_0x43eb25[_0xd9d292(0x27a)](_0x135920);else _0x2587ab[_0xd9d292(0x292)]>0x0&&_0x43eb25[_0xd9d292(0x27a)](_0x2587ab);}const _0x560402=_0x55dc9b[_0x74500d(0x1ff)](_0x4b1be6=>_0x4f8470(_0x4b1be6));await Promise[_0x74500d(0x230)](_0x560402),_0x32c653['json'](_0x43eb25);}),module['exports']=router;