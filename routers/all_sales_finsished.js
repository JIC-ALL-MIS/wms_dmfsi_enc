var a0_0x1a05a0=a0_0x65d5;function a0_0x3bf2(){var _0x57fcec=['language','expiry_date_QA','product_stock','</thead>','310980jFflPB','secondary_code','$product_details.secondary_code','<html><head><title></title>','note','<table\x20style=\x22width:\x20100%\x20!important;\x22>','role','json','concat','$room','toString','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product','Arabic','host','production_date','warehouse','final','/view/add_sales/:id','$product_details.product_stock','post','sendMail','$sale_product.bay','getFullYear','/barcode_scanner','$sale_product.bin','<!DOCTYPE\x20html>','$_id','$customers_docs','$sale_product.type','\x20Order\x20Number\x20:\x20','$product_details.bay','primary_code','<div>','../models/all_models','Sales\x20Add\x20successfully','filter','adjust_qty','Spanish','warehouse_name','$product_details.invoice','$product_details.production_date','stocks_QA','return_qty','currency_placement','port','$product_details.secondary_unit','<tbody\x20style=\x22text-align:\x20center;\x22>','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','</h5>','prod_cat','\x20</h2>','Sales\x20Update\x20successfully','flash','\x20<<<==>>>\x20','Ambient','ADD\x20SALE','return_sale_QA','unit_QA','Finished\x20Goods','\x20>>>\x20','all','params','2639NCtrQH','$return_data','secondary_unit','/view/return_sales/:id','$sale_product.floorlevel','suppliers','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','find','OUTF-','currency','product_code','Chinese','purchases_data','<h5\x20style=\x22text-align:\x20left;\x22>','secondary_unit_QA','product_details','There\x27s\x20a\x20error\x20in\x20this\x20transaction','maxPerUnit','getDate','product_code_QA','staff','$product_details.batch_code','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','sales_quantity_QA','$product.product_name','2919mywsMs','then','Add\x20Sales','/preview/:id','<h2>\x20','</span>','<hr\x20class=\x22my-3\x22>','$warehouse_name','customer_data','$date','errors','floor','stock','RoomAssigned','customers','\x20&&\x20','\x20Order\x20Date\x20:\x20','christian.villamer@jakagroup.com','Enabled','customers_docs','\x20<>\x20','Error\x20Occurs','$finalize','stock_data','createTransport','/all_sales_finished/preview/','sale_qty','primary_code_QA','$product_details','batch_code','catch','892505xBIbtT','primary_unit','76CPtige','$product_details.storage','amount','/invoice/:id','split','gmail','padStart','nodemailer','product_list','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Sale\x20Return','password','findOne','</tr>','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','date','DRY\x20GOODS','back','status','<h5>','14360IYfCRN','secondary_code_QA','$product_details.bin','True','aggregate','$product_details.unit','Sale','prod_invoice','unit','Portuguese','/view/:id','637415wdqqfD','99672qWXVOR','_id','2toSZLm','<span\x20style=\x22float:\x20right;\x22>','foreach\x20newproduct','get','$invoice','$product_details.maxPerUnit','sales\x20item\x20return\x20successfull','invoice','Logo.png','id_transaction_from','/give_payment/:id','length','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','image','$product_details.product_cat','product_data','add_sales_finished','Arabic\x20(ae)','return_sale_finished','return_data','English','product_name','exports','received_amount','maxperunit','$product_details.room_name','email','redirect','Hindi','/all_sales_finished/view','payment\x20successfull','English\x20(US)','../middleware/auth','string','Received\x20Payment\x20For\x20Sale','return_sale','German','all_sales_finished','product_name_QA1','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/add_sales','success','Portuguese\x20(BR)','209724pWacNg','room_name','</div>','</table>','random','187OPEjhj','maxProducts','$customer','maxPerUnit_QA','/view','level','Sale\x20Return\x20Mail','message','expiry_date','quantity','sales_quantity','slice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</head><body>','render','product_date','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.rack','Quality\x20Inspection','FGSEmail','max','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','abs','</tbody>','getMonth','barcode\x20user_id','\x20==\x20','/../public','French','push','$product_details.product_name','Router','Email\x20sent\x20successfully','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.type','error','/picking_list/pdf/','6lymuOg','$sale_product.quantity','../public/language/languages.json','bay','name','save','logo','all_sales_barcode','$note','log','sale_product','$name','$product_details.maxProducts','/barcode/:id','$product_details.floorlevel','site_title','$product_details.product_code','$product_details.expiry_date','<strong>\x20Regards\x20</strong>','customer','</body></html>','return_qty_QA','$sale_product','10427319GxzzZY','/view/add_sale/product','$product_details._id','/upload/','forEach','batch_code_QA','user','map','room','carton','$product_details.primary_code','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<tr>'];a0_0x3bf2=function(){return _0x57fcec;};return a0_0x3bf2();}function a0_0x65d5(_0x152d10,_0x217509){var _0x3bf202=a0_0x3bf2();return a0_0x65d5=function(_0x65d522,_0x51802b){_0x65d522=_0x65d522-0x83;var _0x80dc4f=_0x3bf202[_0x65d522];return _0x80dc4f;},a0_0x65d5(_0x152d10,_0x217509);}(function(_0x3ece9d,_0x3355ff){var _0x2a7668=a0_0x65d5,_0x558a9a=_0x3ece9d();while(!![]){try{var _0x2a9f1e=parseInt(_0x2a7668(0x126))/0x1*(-parseInt(_0x2a7668(0x129))/0x2)+-parseInt(_0x2a7668(0x154))/0x3*(-parseInt(_0x2a7668(0x106))/0x4)+-parseInt(_0x2a7668(0x104))/0x5*(parseInt(_0x2a7668(0x17f))/0x6)+parseInt(_0x2a7668(0xe5))/0x7*(-parseInt(_0x2a7668(0x11b))/0x8)+-parseInt(_0x2a7668(0x196))/0x9+-parseInt(_0x2a7668(0x8a))/0xa*(-parseInt(_0x2a7668(0x159))/0xb)+parseInt(_0x2a7668(0x127))/0xc*(parseInt(_0x2a7668(0xcb))/0xd);if(_0x2a9f1e===_0x3355ff)break;else _0x558a9a['push'](_0x558a9a['shift']());}catch(_0x3acce){_0x558a9a['push'](_0x558a9a['shift']());}}}(a0_0x3bf2,0xc832e));const express=require('express'),app=express(),router=express[a0_0x1a05a0(0x179)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x1a05a0(0xad)),auth=require(a0_0x1a05a0(0x149)),nodemailer=require(a0_0x1a05a0(0x10d)),users=require(a0_0x1a05a0(0x181));router[a0_0x1a05a0(0x12c)](a0_0x1a05a0(0x15d),auth,async(_0x2cf2b3,_0x19adef)=>{var _0x4d970c=a0_0x1a05a0;try{const {username:_0x41a0c8,email:_0x2f2f6a,role:_0x2cd1bf}=_0x2cf2b3[_0x4d970c(0x19c)],_0x431f59=_0x2cf2b3[_0x4d970c(0x19c)],_0x574216=await profile[_0x4d970c(0x112)]({'email':_0x431f59[_0x4d970c(0x143)]}),_0xd7f856=await master_shop[_0x4d970c(0xd2)]();let _0x2e4929;if(_0x431f59['role']=='staff'){const _0x2cdb56=await staff[_0x4d970c(0x112)]({'email':_0x431f59[_0x4d970c(0x143)]});_0x2e4929=await sales_finished[_0x4d970c(0x11f)]([{'$lookup':{'from':_0x4d970c(0xf3),'localField':_0x4d970c(0x192),'foreignField':_0x4d970c(0x183),'as':_0x4d970c(0xf8)}},{'$unwind':_0x4d970c(0xa7)},{'$unwind':_0x4d970c(0x195)},{'$group':{'_id':_0x4d970c(0xa6),'invoice':{'$first':_0x4d970c(0x12d)},'customers':{'$first':_0x4d970c(0x15b)},'date':{'$first':_0x4d970c(0xee)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x4d970c(0x195)},'note':{'$first':_0x4d970c(0x187)},'return_data':{'$first':_0x4d970c(0xcc)},'customers_docs':{'$first':_0x4d970c(0xa7)},'total_saleproduct_quantity':{'$sum':_0x4d970c(0x180)},'level':{'$addToSet':_0x4d970c(0xa1)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x4d970c(0xa8)},'pallet':{'$addToSet':_0x4d970c(0xcf)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x2e4929=await sales_finished['aggregate']([{'$lookup':{'from':_0x4d970c(0xf3),'localField':_0x4d970c(0x192),'foreignField':_0x4d970c(0x183),'as':_0x4d970c(0xf8)}},{'$unwind':_0x4d970c(0xa7)},{'$unwind':_0x4d970c(0x195)},{'$group':{'_id':_0x4d970c(0xa6),'invoice':{'$first':_0x4d970c(0x12d)},'customers':{'$first':_0x4d970c(0x15b)},'date':{'$first':_0x4d970c(0xee)},'warehouse_name':{'$first':_0x4d970c(0xec)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x4d970c(0xcc)},'customers_docs':{'$first':_0x4d970c(0xa7)},'total_saleproduct_quantity':{'$sum':_0x4d970c(0x180)},'level':{'$addToSet':_0x4d970c(0xa1)},'isle':{'$addToSet':_0x4d970c(0xa4)},'type':{'$addToSet':_0x4d970c(0xa8)},'pallet':{'$addToSet':_0x4d970c(0xcf)},'finalize':{'$first':_0x4d970c(0xfb)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0xd7f856[0x0][_0x4d970c(0x86)]=='English\x20(US)'){var _0x285049=users[_0x4d970c(0x13d)];console[_0x4d970c(0x188)](_0x285049);}else{if(_0xd7f856[0x0][_0x4d970c(0x86)]==_0x4d970c(0x145))var _0x285049=users[_0x4d970c(0x145)];else{if(_0xd7f856[0x0][_0x4d970c(0x86)]=='German')var _0x285049=users[_0x4d970c(0x14d)];else{if(_0xd7f856[0x0][_0x4d970c(0x86)]==_0x4d970c(0xb1))var _0x285049=users['Spanish'];else{if(_0xd7f856[0x0][_0x4d970c(0x86)]==_0x4d970c(0x176))var _0x285049=users[_0x4d970c(0x176)];else{if(_0xd7f856[0x0]['language']==_0x4d970c(0x153))var _0x285049=users[_0x4d970c(0x124)];else{if(_0xd7f856[0x0][_0x4d970c(0x86)]=='Chinese')var _0x285049=users[_0x4d970c(0xd6)];else{if(_0xd7f856[0x0][_0x4d970c(0x86)]==_0x4d970c(0x13a))var _0x285049=users[_0x4d970c(0x98)];}}}}}}}_0x19adef[_0x4d970c(0x167)](_0x4d970c(0x14e),{'success':_0x2cf2b3[_0x4d970c(0xc1)](_0x4d970c(0x152)),'errors':_0x2cf2b3[_0x4d970c(0xc1)](_0x4d970c(0xef)),'sales':_0x2e4929,'profile':_0x574216,'role':_0x431f59,'master_shop':_0xd7f856,'language':_0x285049});}catch(_0x489ff8){console[_0x4d970c(0x188)](_0x489ff8);}});async function getRandom8DigitNumber(){var _0x131988=a0_0x1a05a0;const _0x52656d=0x989680,_0x563360=0x5f5e0ff,_0x5dbbdf=Math[_0x131988(0xf0)](Math[_0x131988(0x158)]()*(_0x563360-_0x52656d+0x1))+_0x52656d;var _0x5e11b3;const _0x401379=await sales_finished[_0x131988(0x112)]({'invoice':_0x131988(0xd3)+_0x5dbbdf});return _0x401379&&_0x401379['length']>0x0?_0x5e11b3=_0x131988(0xd3)+_0x5dbbdf:_0x5e11b3=_0x131988(0xd3)+_0x5dbbdf,_0x5e11b3;}router[a0_0x1a05a0(0x12c)](a0_0x1a05a0(0x151),auth,async(_0x287a67,_0x781031)=>{var _0x4ab62f=a0_0x1a05a0;try{const {username:_0x2564bd,email:_0x3e1ff9,role:_0x1d3e7c}=_0x287a67[_0x4ab62f(0x19c)],_0x4ac902=_0x287a67[_0x4ab62f(0x19c)],_0x403df5=await profile[_0x4ab62f(0x112)]({'email':_0x4ac902[_0x4ab62f(0x143)]}),_0x3228e0=await master_shop[_0x4ab62f(0xd2)](),_0x55e1a9=await customer[_0x4ab62f(0xd2)]({});let _0x3213e1;if(_0x4ac902[_0x4ab62f(0x90)]==_0x4ab62f(0xdf)){const _0x3059b3=await staff['findOne']({'email':_0x4ac902[_0x4ab62f(0x143)]});_0x3213e1=await warehouse[_0x4ab62f(0x11f)]([{'$match':{'status':_0x4ab62f(0xf7),'name':_0x3059b3['warehouse'],'warehouse_category':_0x4ab62f(0xc7),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x4ab62f(0x18a),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x3213e1=await warehouse['aggregate']([{'$match':{'status':_0x4ab62f(0xf7),'warehouse_category':_0x4ab62f(0xc7),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x4ab62f(0x18a),'name':{'$first':_0x4ab62f(0x18a)}}},{'$sort':{'name':0x1}}]);const _0x1d4a0f=await product['find']({});var _0x4ed9a5=[_0x4ab62f(0xc3),'Enclosed'];const _0x44b114=await sales_finished['find']({}),_0x2f1084=_0x44b114[_0x4ab62f(0x134)]+0x1,_0x2465a7='OUTF-'+_0x2f1084[_0x4ab62f(0x94)]()[_0x4ab62f(0x10c)](0x5,'0');if(_0x3228e0[0x0][_0x4ab62f(0x86)]==_0x4ab62f(0x148)){var _0x7dd73c=users['English'];console[_0x4ab62f(0x188)](_0x7dd73c);}else{if(_0x3228e0[0x0]['language']==_0x4ab62f(0x145))var _0x7dd73c=users[_0x4ab62f(0x145)];else{if(_0x3228e0[0x0]['language']=='German')var _0x7dd73c=users['German'];else{if(_0x3228e0[0x0][_0x4ab62f(0x86)]==_0x4ab62f(0xb1))var _0x7dd73c=users[_0x4ab62f(0xb1)];else{if(_0x3228e0[0x0][_0x4ab62f(0x86)]==_0x4ab62f(0x176))var _0x7dd73c=users[_0x4ab62f(0x176)];else{if(_0x3228e0[0x0]['language']==_0x4ab62f(0x153))var _0x7dd73c=users[_0x4ab62f(0x124)];else{if(_0x3228e0[0x0][_0x4ab62f(0x86)]==_0x4ab62f(0xd6))var _0x7dd73c=users[_0x4ab62f(0xd6)];else{if(_0x3228e0[0x0][_0x4ab62f(0x86)]==_0x4ab62f(0x13a))var _0x7dd73c=users['Arabic'];}}}}}}}const _0x405029=getRandom8DigitNumber();_0x405029[_0x4ab62f(0xe6)](_0x4063cc=>{var _0xff61f7=_0x4ab62f;_0x781031[_0xff61f7(0x167)](_0xff61f7(0x139),{'success':_0x287a67[_0xff61f7(0xc1)](_0xff61f7(0x152)),'errors':_0x287a67['flash'](_0xff61f7(0xef)),'role':_0x4ac902,'profile':_0x403df5,'customer':_0x55e1a9,'warehouse':_0x3213e1,'product':_0x1d4a0f,'invoice':_0x4063cc,'master_shop':_0x3228e0,'language':_0x7dd73c,'rooms_data':_0x4ed9a5});})[_0x4ab62f(0x103)](_0x4184c2=>{var _0x2e8d27=_0x4ab62f;_0x287a67[_0x2e8d27(0xc1)](_0x2e8d27(0xef),_0x2e8d27(0xdb)),_0x781031[_0x2e8d27(0x144)]('/all_sales_finished/view');});}catch(_0x3712a7){console[_0x4ab62f(0x188)](_0x3712a7);}}),router[a0_0x1a05a0(0x12c)](a0_0x1a05a0(0x9d),auth,async(_0x4916a3,_0x37e56a)=>{var _0x1d7736=a0_0x1a05a0;try{const _0x171448=_0x4916a3[_0x1d7736(0xca)]['id'];console['log'](_0x171448);const _0x225e5c=await product['find'](),_0x5be59b=await purchases[_0x1d7736(0x11f)]([{'$match':{'warehouse_name':_0x171448}},{'$unwind':_0x1d7736(0x97)},{'$group':{'_id':_0x1d7736(0xe4)}}]);console[_0x1d7736(0x188)](_0x1d7736(0xd7),_0x5be59b),_0x37e56a[_0x1d7736(0x119)](0xc8)['json']({'purchases_data':_0x5be59b,'product_data':_0x225e5c});}catch(_0x496911){console[_0x1d7736(0x188)](_0x496911);}}),router['post'](a0_0x1a05a0(0x197),auth,async(_0x4baa2b,_0x52ed5b)=>{var _0x201911=a0_0x1a05a0;try{const {warehouse_data:_0x4a50bc,product_data:_0x5eb5fb}=_0x4baa2b[_0x201911(0x95)];console['log'](_0x4baa2b[_0x201911(0x95)][_0x201911(0x138)]);;const _0x3e754e=await master_shop['find']();console[_0x201911(0x188)]('master',_0x3e754e);const _0x5aa5af=await product[_0x201911(0x112)]({'name':_0x5eb5fb});console[_0x201911(0x188)]('product',_0x5aa5af);const _0x25e45e=await warehouse[_0x201911(0x11f)]([{'$match':{'name':_0x4a50bc}},{'$unwind':_0x201911(0x101)},{'$match':{'product_details.product_name':_0x5eb5fb}},{'$group':{'_id':_0x201911(0x178),'product_stock':{'$first':_0x201911(0x9e)}}}]);console['log'](_0x201911(0xfc),_0x25e45e),_0x52ed5b[_0x201911(0x119)](0xc8)[_0x201911(0x91)]({'master':_0x3e754e,'new_product':_0x5aa5af,'stock_data':_0x25e45e});}catch(_0x140595){console[_0x201911(0x188)](_0x140595);}}),router[a0_0x1a05a0(0x9f)](a0_0x1a05a0(0x151),auth,async(_0x48ad49,_0x1bc50f)=>{var _0x533d49=a0_0x1a05a0;try{const {invoice:_0x3cc2d8,date:_0x5deb7e,warehouse_name:_0x7f8df2,product_name:_0x3868d9,stock:_0x3ceaf3,quantity:_0x279291,note:_0x4f8785,room:_0x51bda0,primary_code:_0x5d6d80,secondary_code:_0x279480,prod_code:_0x5604a5,level:_0x25ff74,isle:_0x4b7b3e,pallet:_0x148e68,batch_code:_0x211f79,SCRN:_0x271fe2,expiry_date:_0x32bb8b,mode_transpo:_0x26a972,name_driver:_0x1cbaa5}=_0x48ad49[_0x533d49(0x95)];if(typeof _0x3868d9==_0x533d49(0x14a))var _0x3b49cc=[_0x48ad49['body'][_0x533d49(0x13e)]],_0x430a48=[_0x48ad49[_0x533d49(0x95)]['stock']],_0x1cf540=[_0x48ad49[_0x533d49(0x95)][_0x533d49(0x19f)]],_0x145144=[_0x48ad49[_0x533d49(0x95)][_0x533d49(0xab)]],_0x3d924e=[_0x48ad49['body'][_0x533d49(0x8b)]],_0x441dd4=[_0x48ad49['body']['prod_code']],_0x74bc3c=[_0x48ad49[_0x533d49(0x95)][_0x533d49(0x15e)]],_0x3d49db=[_0x48ad49['body'][_0x533d49(0x105)]],_0x4f3c7c=[_0x48ad49['body'][_0x533d49(0xcd)]],_0x37dd98=[_0x48ad49[_0x533d49(0x95)][_0x533d49(0x102)]],_0x50ecee=[_0x48ad49[_0x533d49(0x95)][_0x533d49(0x161)]],_0x4ec685=[_0x48ad49['body'][_0x533d49(0x168)]],_0x19169c=[_0x48ad49[_0x533d49(0x95)]['max_per_unit']],_0x1fcc8c=[_0x48ad49[_0x533d49(0x95)][_0x533d49(0xbe)]],_0x1c2f72=[_0x48ad49['body']['RoomAssigned']],_0x4ccc77=[_0x48ad49[_0x533d49(0x95)][_0x533d49(0x122)]],_0x419c6c=[_0x48ad49['body'][_0x533d49(0x132)]];else var _0x3b49cc=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0x13e)]],_0x430a48=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0xf1)]],_0x1cf540=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0x19f)]],_0x145144=[..._0x48ad49['body'][_0x533d49(0xab)]],_0x3d924e=[..._0x48ad49['body'][_0x533d49(0x8b)]],_0x441dd4=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0x114)]],_0x74bc3c=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0x15e)]],_0x3d49db=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0x105)]],_0x4f3c7c=[..._0x48ad49['body']['secondary_unit']],_0x37dd98=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0x102)]],_0x50ecee=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0x161)]],_0x4ec685=[..._0x48ad49['body'][_0x533d49(0x168)]],_0x19169c=[..._0x48ad49[_0x533d49(0x95)]['max_per_unit']],_0x1fcc8c=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0xbe)]],_0x1c2f72=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0xf2)]],_0x4ccc77=[..._0x48ad49['body']['prod_invoice']],_0x419c6c=[..._0x48ad49[_0x533d49(0x95)][_0x533d49(0x132)]];const _0x2d2639=_0x3b49cc[_0x533d49(0x19d)](_0x41f18a=>{return _0x41f18a={'product_name':_0x41f18a};});_0x430a48[_0x533d49(0x19a)]((_0x31e7ab,_0x4e1221)=>{var _0x481125=_0x533d49;_0x2d2639[_0x4e1221][_0x481125(0xf1)]=_0x31e7ab;}),_0x1cf540[_0x533d49(0x19a)]((_0x106797,_0x4fd42d)=>{var _0x3519e3=_0x533d49;_0x2d2639[_0x4fd42d][_0x3519e3(0x162)]=Math[_0x3519e3(0x170)](_0x106797);}),_0x419c6c[_0x533d49(0x19a)]((_0xc51b0b,_0x570f58)=>{_0x2d2639[_0x570f58]['id_transaction_from']=_0xc51b0b;}),_0x145144[_0x533d49(0x19a)]((_0x4f68a6,_0x2c9347)=>{_0x2d2639[_0x2c9347]['primary_code']=_0x4f68a6;}),_0x3d924e[_0x533d49(0x19a)]((_0x19f513,_0x578939)=>{_0x2d2639[_0x578939]['secondary_code']=_0x19f513;}),_0x441dd4[_0x533d49(0x19a)]((_0x113dec,_0x591309)=>{var _0x576fc7=_0x533d49;_0x2d2639[_0x591309][_0x576fc7(0xd5)]=_0x113dec;}),_0x74bc3c['forEach']((_0x15621f,_0x2b28d0)=>{var _0x1c33db=_0x533d49;_0x2d2639[_0x2b28d0][_0x1c33db(0x182)]=_0x15621f;}),_0x3d49db[_0x533d49(0x19a)]((_0x450588,_0x49a809)=>{_0x2d2639[_0x49a809]['unit']=_0x450588;}),_0x4f3c7c[_0x533d49(0x19a)]((_0x1cb96e,_0x38ff28)=>{var _0x5c9ff3=_0x533d49;_0x2d2639[_0x38ff28][_0x5c9ff3(0xcd)]=_0x1cb96e;}),_0x37dd98[_0x533d49(0x19a)]((_0x33da69,_0x9a888f)=>{var _0xf658fc=_0x533d49;_0x2d2639[_0x9a888f][_0xf658fc(0x102)]=_0x33da69;}),_0x50ecee[_0x533d49(0x19a)]((_0x24a09c,_0x16d799)=>{var _0x403518=_0x533d49;_0x2d2639[_0x16d799][_0x403518(0x161)]=_0x24a09c;}),_0x4ec685[_0x533d49(0x19a)]((_0x257d3f,_0x235979)=>{_0x2d2639[_0x235979]['production_date']=_0x257d3f;}),_0x19169c[_0x533d49(0x19a)]((_0x3f8993,_0x33e109)=>{var _0x2114ed=_0x533d49;_0x2d2639[_0x33e109][_0x2114ed(0x141)]=_0x3f8993;}),_0x1fcc8c[_0x533d49(0x19a)]((_0x11e681,_0x2fbda6)=>{_0x2d2639[_0x2fbda6]['prod_cat']=_0x11e681;}),_0x1c2f72['forEach']((_0x1fa2af,_0x19a020)=>{var _0x2db3a9=_0x533d49;_0x2d2639[_0x19a020][_0x2db3a9(0x155)]=_0x1fa2af;}),_0x4ccc77[_0x533d49(0x19a)]((_0xe5672f,_0x134914)=>{var _0x455fb1=_0x533d49;_0x2d2639[_0x134914][_0x455fb1(0x130)]=_0xe5672f;});var _0x329d52=0x0;_0x2d2639[_0x533d49(0x19a)](_0x5315e0=>{var _0x3b9f9e=_0x533d49;parseFloat(_0x5315e0['stock'])<parseFloat(_0x5315e0[_0x3b9f9e(0x162)])&&parseFloat(_0x5315e0['quantity'])>parseFloat(_0x5315e0[_0x3b9f9e(0xf1)])&&(console[_0x3b9f9e(0x188)](_0x5315e0[_0x3b9f9e(0xf1)]+_0x3b9f9e(0xf9)+_0x5315e0[_0x3b9f9e(0x162)]),_0x329d52++);});if(_0x329d52!=0x0)return _0x48ad49[_0x533d49(0xc1)]('errors','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x1bc50f[_0x533d49(0x144)](_0x533d49(0x118));const _0x4a4f94=_0x2d2639[_0x533d49(0xaf)](_0xdd32f7=>_0xdd32f7[_0x533d49(0x162)]!=='0'&&_0xdd32f7['quantity']!==''),_0x43f971=new sales_finished({'invoice':_0x3cc2d8,'customer':_0x48ad49['body'][_0x533d49(0x192)],'date':_0x5deb7e,'warehouse_name':_0x7f8df2,'sale_product':_0x4a4f94,'note':_0x4f8785,'room':_0x51bda0,'primary_code':_0x5d6d80,'secondary_code':_0x279480,'prod_code':_0x5604a5,'SCRN':_0x271fe2,'finalize':'False','mode_transpo':_0x26a972,'name_driver':_0x1cbaa5}),_0x240955=await _0x43f971[_0x533d49(0x184)](),_0x44f94e=await sales_finished['findOne']({'invoice':_0x3cc2d8}),_0x39e4a0=new c_payment_data({'invoice':_0x3cc2d8,'customer':_0x48ad49[_0x533d49(0x95)]['customer'],'reason':_0x533d49(0x121)});await _0x39e4a0['save']();const _0x585881=await master_shop[_0x533d49(0xd2)](),_0x17ac51=await email_settings['findOne'](),_0x21a5cb=await customer[_0x533d49(0x112)]({'name':_0x48ad49[_0x533d49(0x95)][_0x533d49(0x192)]});_0x585881[0x0][_0x533d49(0xb7)]==0x1?(right_currency=_0x585881[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x585881[0x0][_0x533d49(0xd4)]);var _0x4001b4=_0x3b49cc,_0x6fd9e8=_0x1cf540,_0x194d7b='',_0x2d476c;for(_0x2d476c in _0x4001b4){_0x194d7b+=_0x533d49(0x85)+_0x533d49(0xd1)+_0x4001b4[_0x2d476c]+_0x533d49(0xbb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x6fd9e8[_0x2d476c]+'</td>'+'</tr>';}console['log'](_0x533d49(0x10e),_0x194d7b);let _0x8dd6c8=nodemailer[_0x533d49(0xfd)]({'host':_0x17ac51[_0x533d49(0x99)],'port':Number(_0x17ac51[_0x533d49(0xb8)]),'secure':![],'service':_0x533d49(0x10b),'auth':{'user':_0x17ac51['email'],'pass':_0x17ac51['password']}}),_0x26d364={'from':_0x17ac51[_0x533d49(0x143)],'to':_0x533d49(0xf6),'subject':_0x533d49(0xe7),'attachments':[{'filename':_0x533d49(0x131),'path':__dirname+_0x533d49(0x175)+_0x533d49(0x199)+_0x585881[0x0][_0x533d49(0x136)],'cid':_0x533d49(0x185)}],'html':_0x533d49(0xc4)};_0x8dd6c8[_0x533d49(0xa0)](_0x26d364,function(_0x134282,_0x3be4a1){var _0x1bb1f3=_0x533d49;_0x134282?(console[_0x1bb1f3(0x188)](_0x134282),console[_0x1bb1f3(0x188)](_0x1bb1f3(0xfa))):console[_0x1bb1f3(0x188)](_0x1bb1f3(0x17a));}),_0x48ad49['flash'](_0x533d49(0x152),_0x533d49(0xae)),_0x1bc50f[_0x533d49(0x144)](_0x533d49(0xfe)+_0x240955[_0x533d49(0x128)]);}catch(_0x14732d){console[_0x533d49(0x188)](_0x14732d);}}),router[a0_0x1a05a0(0x12c)](a0_0x1a05a0(0xe8),auth,async(_0x36abc4,_0x254ec9)=>{var _0x10e90e=a0_0x1a05a0;try{const {username:_0x1af7d8,email:_0x476a3d,role:_0x2e7196}=_0x36abc4[_0x10e90e(0x19c)],_0x23fc71=_0x36abc4[_0x10e90e(0x19c)],_0x3003fc=await profile[_0x10e90e(0x112)]({'email':_0x23fc71['email']}),_0xeefb9a=await master_shop[_0x10e90e(0xd2)](),_0x37c75e=_0x36abc4[_0x10e90e(0xca)]['id'],_0x23198b=await sales_finished[_0x10e90e(0xe1)](_0x37c75e),_0x74ef0=await warehouse[_0x10e90e(0x11f)]([{'$match':{'name':_0x23198b[_0x10e90e(0xb2)]}},{'$unwind':_0x10e90e(0x101)},{'$group':{'_id':_0x10e90e(0x198),'name':{'$first':_0x10e90e(0x178)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x10e90e(0xaa)},'bin':{'$first':_0x10e90e(0x11d)},'type':{'$first':_0x10e90e(0x17c)},'floorlevel':{'$first':_0x10e90e(0x18d)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x10e90e(0x8c)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x10e90e(0x190)},'production_date':{'$first':_0x10e90e(0xb4)},'batch_code':{'$first':_0x10e90e(0xe0)},'room':{'$first':'$room'},'room_data':{'$first':_0x10e90e(0x142)}}}]),_0x790e13=await customer['find']({});let _0x53b519;if(_0x23fc71['role']=='staff'){const _0x27486a=await staff['findOne']({'email':_0x23fc71[_0x10e90e(0x143)]});_0x53b519=await warehouse['aggregate']([{'$match':{'status':_0x10e90e(0xf7),'name':_0x27486a[_0x10e90e(0x9b)]}},{'$group':{'_id':_0x10e90e(0x18a),'name':{'$first':'$name'}}}]);}else _0x53b519=await warehouse[_0x10e90e(0x11f)]([{'$match':{'status':_0x10e90e(0xf7)}},{'$group':{'_id':_0x10e90e(0x18a),'name':{'$first':'$name'}}}]);const _0x131039=await product[_0x10e90e(0xd2)]({});if(_0xeefb9a[0x0][_0x10e90e(0x86)]==_0x10e90e(0x148)){var _0x20035e=users[_0x10e90e(0x13d)];console[_0x10e90e(0x188)](_0x20035e);}else{if(_0xeefb9a[0x0][_0x10e90e(0x86)]==_0x10e90e(0x145))var _0x20035e=users[_0x10e90e(0x145)];else{if(_0xeefb9a[0x0]['language']==_0x10e90e(0x14d))var _0x20035e=users[_0x10e90e(0x14d)];else{if(_0xeefb9a[0x0][_0x10e90e(0x86)]=='Spanish')var _0x20035e=users[_0x10e90e(0xb1)];else{if(_0xeefb9a[0x0][_0x10e90e(0x86)]=='French')var _0x20035e=users['French'];else{if(_0xeefb9a[0x0][_0x10e90e(0x86)]==_0x10e90e(0x153))var _0x20035e=users[_0x10e90e(0x124)];else{if(_0xeefb9a[0x0]['language']=='Chinese')var _0x20035e=users[_0x10e90e(0xd6)];else{if(_0xeefb9a[0x0]['language']==_0x10e90e(0x13a))var _0x20035e=users[_0x10e90e(0x98)];}}}}}}}_0x254ec9['render']('edit_sales_finished_view',{'success':_0x36abc4[_0x10e90e(0xc1)](_0x10e90e(0x152)),'errors':_0x36abc4[_0x10e90e(0xc1)](_0x10e90e(0xef)),'role':_0x23fc71,'profile':_0x3003fc,'customer':_0x790e13,'warehouse':_0x53b519,'product':_0x74ef0,'user':_0x23198b,'master_shop':_0xeefb9a,'unit':_0x131039,'language':_0x20035e});}catch(_0x278d7e){console[_0x10e90e(0x188)](_0x278d7e);}}),router[a0_0x1a05a0(0x9f)](a0_0x1a05a0(0xe8),auth,async(_0x308710,_0x527d73)=>{var _0x390f7f=a0_0x1a05a0;try{const _0x2a534f=_0x308710[_0x390f7f(0xca)]['id'],{invoice:_0x3acb71,warehouse_name:_0x2464b2,room:_0x589bdf}=_0x308710[_0x390f7f(0x95)],_0x1d57d5=await sales_finished[_0x390f7f(0x112)]({'invoice':_0x3acb71}),_0x14418b=_0x1d57d5['sale_product'][_0x390f7f(0x19d)](async _0x4e6e37=>{var _0x44cfcc=_0x390f7f,_0x1d54cf=await warehouse[_0x44cfcc(0x112)]({'name':_0x2464b2,'room':_0x4e6e37[_0x44cfcc(0x155)],'warehouse_category':_0x44cfcc(0xc7)});const _0x1cd584=_0x1d54cf[_0x44cfcc(0xda)][_0x44cfcc(0x19d)](_0x128a25=>{var _0x2862ee=_0x44cfcc;(_0x128a25['product_name']==_0x4e6e37[_0x2862ee(0x13e)]&&_0x128a25[_0x2862ee(0x182)]==_0x4e6e37[_0x2862ee(0x182)]&&_0x128a25[_0x2862ee(0x161)]==_0x4e6e37[_0x2862ee(0x161)]&&_0x128a25[_0x2862ee(0x9a)]==_0x4e6e37[_0x2862ee(0x9a)]&&_0x128a25[_0x2862ee(0x102)]==_0x4e6e37[_0x2862ee(0x102)]&&_0x128a25['invoice']==_0x4e6e37[_0x2862ee(0x130)]||_0x128a25['_id']==_0x4e6e37[_0x2862ee(0x132)])&&(_0x128a25[_0x2862ee(0x88)]>0x0&&(console['log'](_0x128a25['product_name']+_0x2862ee(0x174)+_0x4e6e37['product_name']+_0x2862ee(0xf4)+_0x128a25[_0x2862ee(0x182)]+'\x20==\x20'+_0x4e6e37[_0x2862ee(0x182)]+'\x20&&\x20'+_0x128a25[_0x2862ee(0x9a)]+'\x20==\x20'+_0x4e6e37['production_date']+'\x20&&\x20'+_0x128a25['expiry_date']+_0x2862ee(0x174)+_0x4e6e37[_0x2862ee(0x161)]+'\x20&&\x20'+_0x128a25[_0x2862ee(0x102)]+_0x2862ee(0x174)+_0x4e6e37['batch_code']+_0x2862ee(0xf4)+_0x128a25[_0x2862ee(0x130)]+_0x2862ee(0x174)+_0x4e6e37[_0x2862ee(0x130)]+_0x2862ee(0xf4)+_0x128a25[_0x2862ee(0x88)]+_0x2862ee(0xc2)+_0x4e6e37[_0x2862ee(0x162)]+_0x2862ee(0xc8)+_0x4e6e37['room_name']+_0x2862ee(0xf4)+_0x128a25[_0x2862ee(0x128)]+_0x2862ee(0x174)+_0x4e6e37[_0x2862ee(0x132)]),_0x128a25[_0x2862ee(0x88)]=Math[_0x2862ee(0x16d)](0x0,Math[_0x2862ee(0x170)](_0x128a25['product_stock'])-Math['abs'](_0x4e6e37[_0x2862ee(0x162)]))));});return _0x1d54cf;});Promise['all'](_0x14418b)[_0x390f7f(0xe6)](async _0x3a1c5f=>{var _0x5aa6e2=_0x390f7f;try{for(const _0x5522c3 of _0x3a1c5f){await _0x5522c3[_0x5aa6e2(0x184)]();}_0x1d57d5['finalize']='True';const _0x3f6633=await _0x1d57d5[_0x5aa6e2(0x184)](),_0x43fcd0=await master_shop[_0x5aa6e2(0xd2)](),_0x2498b6=await email_settings[_0x5aa6e2(0x112)](),_0x5d79b6=await supervisor_settings[_0x5aa6e2(0xd2)]();var _0x12dad0=_0x1d57d5['sale_product'],_0x1fd788='',_0x1358e2;for(_0x1358e2 in _0x12dad0){var _0x2d6a18='FG';_0x1d57d5[_0x5aa6e2(0xb2)]==_0x5aa6e2(0x117)&&(_0x2d6a18='DG'),_0x1fd788+=_0x5aa6e2(0x85)+_0x5aa6e2(0xd1)+_0x12dad0[_0x1358e2]['product_name']+'</td>'+_0x5aa6e2(0xd1)+_0x12dad0[_0x1358e2][_0x5aa6e2(0xd5)]+_0x5aa6e2(0xbb)+_0x5aa6e2(0xd1)+_0x12dad0[_0x1358e2][_0x5aa6e2(0x162)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x12dad0[_0x1358e2]['unit']+_0x5aa6e2(0xbb)+_0x5aa6e2(0xd1)+_0x12dad0[_0x1358e2][_0x5aa6e2(0xcd)]+_0x5aa6e2(0xbb)+_0x5aa6e2(0xd1)+_0x1d57d5[_0x5aa6e2(0xb2)]+_0x5aa6e2(0xbb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x12dad0[_0x1358e2][_0x5aa6e2(0x155)]+_0x5aa6e2(0xbb)+_0x5aa6e2(0xd1)+_0x2d6a18+_0x12dad0[_0x1358e2][_0x5aa6e2(0x182)]+_0x5aa6e2(0xbb);}let _0x1646de=nodemailer['createTransport']({'host':_0x2498b6['host'],'port':Number(_0x2498b6[_0x5aa6e2(0xb8)]),'secure':![],'auth':{'user':_0x2498b6[_0x5aa6e2(0x143)],'pass':_0x2498b6[_0x5aa6e2(0x111)]}}),_0x354363={'from':_0x2498b6['email'],'to':_0x5d79b6[0x0][_0x5aa6e2(0x16c)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x5aa6e2(0x131),'path':__dirname+_0x5aa6e2(0x175)+_0x5aa6e2(0x199)+_0x43fcd0[0x0][_0x5aa6e2(0x136)],'cid':_0x5aa6e2(0x185)}],'html':_0x5aa6e2(0xa5)+_0x5aa6e2(0x8d)+'</head><body>'+_0x5aa6e2(0xac)+_0x5aa6e2(0x169)+_0x5aa6e2(0xac)+_0x5aa6e2(0x150)+_0x5aa6e2(0x156)+_0x5aa6e2(0xac)+'<h2>\x20'+_0x43fcd0[0x0][_0x5aa6e2(0x18e)]+_0x5aa6e2(0xbf)+_0x5aa6e2(0x156)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x5aa6e2(0xd8)+'\x20Order\x20Number\x20:\x20'+_0x1d57d5['invoice']+'\x20'+_0x5aa6e2(0x12a)+_0x5aa6e2(0xf5)+_0x1d57d5['date']+'\x20'+_0x5aa6e2(0xea)+_0x5aa6e2(0xbd)+_0x5aa6e2(0x156)+_0x5aa6e2(0x8f)+_0x5aa6e2(0x135)+_0x5aa6e2(0x85)+_0x5aa6e2(0x10f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x5aa6e2(0x165)+_0x5aa6e2(0x84)+_0x5aa6e2(0x96)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x5aa6e2(0xbc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x5aa6e2(0x113)+'</thead>'+_0x5aa6e2(0xba)+'\x20'+_0x1fd788+'\x20'+'</tbody>'+_0x5aa6e2(0x157)+_0x5aa6e2(0xac)+_0x5aa6e2(0x191)+_0x5aa6e2(0x11a)+_0x43fcd0[0x0][_0x5aa6e2(0x18e)]+_0x5aa6e2(0xbd)+'</div>'+_0x5aa6e2(0x156)+_0x5aa6e2(0x193)};_0x1646de[_0x5aa6e2(0xa0)](_0x354363,function(_0x1b112f,_0x16b5d5){var _0x1a5791=_0x5aa6e2;_0x1b112f?(console[_0x1a5791(0x188)](_0x1b112f),console['log'](_0x1a5791(0xfa))):console[_0x1a5791(0x188)]('Email\x20sent\x20successfully');}),_0x308710[_0x5aa6e2(0xc1)](_0x5aa6e2(0x152),_0x5aa6e2(0xc0)),_0x527d73['redirect'](_0x5aa6e2(0x17e)+_0x2a534f);}catch(_0x10701f){console[_0x5aa6e2(0x17d)](_0x10701f),_0x527d73[_0x5aa6e2(0x119)](0x1f4)[_0x5aa6e2(0x91)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x390f7f(0x103)](_0x5c8cae=>{var _0x1b0503=_0x390f7f;console['error'](_0x5c8cae),_0x527d73[_0x1b0503(0x119)](0x1f4)[_0x1b0503(0x91)]({'error':'An\x20error\x20occurred.'});});}catch(_0x439347){console[_0x390f7f(0x188)](_0x439347);}}),router[a0_0x1a05a0(0x12c)](a0_0x1a05a0(0x125),auth,async(_0x208abc,_0xb7e2ba)=>{var _0xcad1ce=a0_0x1a05a0;try{const {username:_0x2feb3d,email:_0x332321,role:_0xb2b420}=_0x208abc[_0xcad1ce(0x19c)],_0x2e2739=_0x208abc[_0xcad1ce(0x19c)],_0xd8d47a=await profile[_0xcad1ce(0x112)]({'email':_0x2e2739[_0xcad1ce(0x143)]}),_0x73847a=await master_shop[_0xcad1ce(0xd2)](),_0x5ad122=_0x208abc['params']['id'],_0xc8dab9=await sales_finished[_0xcad1ce(0xe1)](_0x5ad122);let _0x4fcddd=new Date(_0xc8dab9[_0xcad1ce(0x161)]),_0x45aa73=('0'+_0x4fcddd[_0xcad1ce(0xdd)]())['slice'](-0x2),_0x1e8aa9=('0'+(_0x4fcddd['getMonth']()+0x1))[_0xcad1ce(0x164)](-0x2),_0x328c12=_0x4fcddd[_0xcad1ce(0xa2)](),_0x1a9aaf=_0x328c12+'-'+_0x1e8aa9+'-'+_0x45aa73;var _0x16ba07=[_0xcad1ce(0xc3),_0xcad1ce(0x83)];const _0x32f563=await warehouse[_0xcad1ce(0x11f)]([{'$match':{'name':_0xc8dab9['warehouse_name'],'room':_0xc8dab9['room']}},{'$unwind':_0xcad1ce(0x101)},{'$group':{'_id':_0xcad1ce(0x198),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xcad1ce(0x9e)},'bay':{'$first':_0xcad1ce(0xaa)},'bin':{'$first':_0xcad1ce(0x11d)},'type':{'$first':_0xcad1ce(0x17c)},'floorlevel':{'$first':_0xcad1ce(0x18d)},'primary_code':{'$first':_0xcad1ce(0x1a0)},'secondary_code':{'$first':_0xcad1ce(0x8c)},'product_code':{'$first':_0xcad1ce(0x18f)},'storage':{'$first':_0xcad1ce(0x107)},'rack':{'$first':_0xcad1ce(0x16a)}}}]),_0x45727e=await customer[_0xcad1ce(0xd2)]({});let _0x1040d1;if(_0x2e2739[_0xcad1ce(0x90)]==_0xcad1ce(0xdf)){const _0x4cc970=await staff[_0xcad1ce(0x112)]({'email':_0x2e2739['email']});_0x1040d1=await warehouse[_0xcad1ce(0x11f)]([{'$match':{'status':_0xcad1ce(0xf7),'name':_0x4cc970['warehouse']}},{'$group':{'_id':_0xcad1ce(0x18a),'name':{'$first':_0xcad1ce(0x18a)}}}]);}else _0x1040d1=await warehouse['aggregate']([{'$match':{'status':_0xcad1ce(0xf7)}},{'$group':{'_id':_0xcad1ce(0x18a),'name':{'$first':_0xcad1ce(0x18a)}}}]);const _0x5f329c=await product[_0xcad1ce(0xd2)]({});if(_0x73847a[0x0][_0xcad1ce(0x86)]==_0xcad1ce(0x148)){var _0x1730b7=users[_0xcad1ce(0x13d)];console[_0xcad1ce(0x188)](_0x1730b7);}else{if(_0x73847a[0x0][_0xcad1ce(0x86)]==_0xcad1ce(0x145))var _0x1730b7=users['Hindi'];else{if(_0x73847a[0x0][_0xcad1ce(0x86)]=='German')var _0x1730b7=users[_0xcad1ce(0x14d)];else{if(_0x73847a[0x0]['language']==_0xcad1ce(0xb1))var _0x1730b7=users[_0xcad1ce(0xb1)];else{if(_0x73847a[0x0][_0xcad1ce(0x86)]==_0xcad1ce(0x176))var _0x1730b7=users['French'];else{if(_0x73847a[0x0][_0xcad1ce(0x86)]==_0xcad1ce(0x153))var _0x1730b7=users[_0xcad1ce(0x124)];else{if(_0x73847a[0x0][_0xcad1ce(0x86)]==_0xcad1ce(0xd6))var _0x1730b7=users[_0xcad1ce(0xd6)];else{if(_0x73847a[0x0][_0xcad1ce(0x86)]==_0xcad1ce(0x13a))var _0x1730b7=users[_0xcad1ce(0x98)];}}}}}}}_0xb7e2ba[_0xcad1ce(0x167)]('edit_sales_finished',{'success':_0x208abc[_0xcad1ce(0xc1)](_0xcad1ce(0x152)),'errors':_0x208abc[_0xcad1ce(0xc1)](_0xcad1ce(0xef)),'role':_0x2e2739,'profile':_0xd8d47a,'customer':_0x45727e,'warehouse':_0x1040d1,'product':_0x32f563,'user':_0xc8dab9,'master_shop':_0x73847a,'unit':_0x5f329c,'language':_0x1730b7,'rooms_data':_0x16ba07,'ed_fullDate':_0x1a9aaf});}catch(_0x438a58){console[_0xcad1ce(0x188)](_0x438a58);}}),router[a0_0x1a05a0(0x9f)](a0_0x1a05a0(0x125),auth,async(_0x81a05c,_0x4b5fec)=>{var _0x467b6a=a0_0x1a05a0;try{const _0x10e3db=_0x81a05c[_0x467b6a(0xca)]['id'],_0x214dc7=await sales_finished[_0x467b6a(0x112)]({'_id':_0x81a05c[_0x467b6a(0xca)]['id']}),_0x237ca4=await warehouse['findOne']({'name':_0x214dc7['warehouse_name'],'room':_0x81a05c[_0x467b6a(0x95)]['room'],'warehouse_category':_0x467b6a(0xc7)}),{invoice:_0x1eb194,customer:_0x40718d,date:_0xefc98a,warehouse_name:_0x9abc7c,product_name:_0xdabb82,stock:_0x4c6274,adjust_qty:_0x3dac20,note:_0x2144a3,room:_0x32e37d,primary_code:_0x48012f,secondary_code:_0x75ae9c,prod_code:_0xf4e174,level:_0x43fbc4,isle:_0x517c18,pallet:_0x53c563,expiry_date:_0xa89473}=_0x81a05c[_0x467b6a(0x95)];if(typeof _0xdabb82==_0x467b6a(0x14a))var _0x4e0cc0=[_0x81a05c[_0x467b6a(0x95)]['product_name']],_0x332080=[_0x81a05c[_0x467b6a(0x95)][_0x467b6a(0xf1)]],_0x10b8f3=[_0x81a05c[_0x467b6a(0x95)][_0x467b6a(0xb0)]],_0x4d73dd=[_0x81a05c[_0x467b6a(0x95)][_0x467b6a(0xab)]],_0x341dd9=[_0x81a05c[_0x467b6a(0x95)][_0x467b6a(0x8b)]],_0x18b86b=[_0x81a05c[_0x467b6a(0x95)][_0x467b6a(0x114)]],_0x51d494=[_0x81a05c[_0x467b6a(0x95)]['level']],_0x223488=[_0x81a05c[_0x467b6a(0x95)]['expiry_date']];else var _0x4e0cc0=[..._0x81a05c[_0x467b6a(0x95)]['product_name']],_0x332080=[..._0x81a05c[_0x467b6a(0x95)][_0x467b6a(0xf1)]],_0x10b8f3=[..._0x81a05c[_0x467b6a(0x95)]['adjust_qty']],_0x4d73dd=[..._0x81a05c[_0x467b6a(0x95)][_0x467b6a(0xab)]],_0x341dd9=[..._0x81a05c['body']['secondary_code']],_0x18b86b=[..._0x81a05c[_0x467b6a(0x95)][_0x467b6a(0x114)]],_0x51d494=[..._0x81a05c[_0x467b6a(0x95)][_0x467b6a(0x15e)]],_0x223488=[..._0x81a05c[_0x467b6a(0x95)][_0x467b6a(0x161)]];const _0x36acee=_0x4e0cc0[_0x467b6a(0x19d)](_0x1d8891=>{return _0x1d8891={'product_name':_0x1d8891};});_0x332080['forEach']((_0x38cdac,_0x2809f1)=>{var _0x2a6a8a=_0x467b6a;_0x36acee[_0x2809f1][_0x2a6a8a(0xf1)]=_0x38cdac;}),_0x10b8f3[_0x467b6a(0x19a)]((_0x2c8562,_0x2a5b19)=>{var _0x1bc637=_0x467b6a;_0x36acee[_0x2a5b19][_0x1bc637(0x162)]=_0x2c8562;}),_0x4d73dd['forEach']((_0x531d5b,_0x5a3ee2)=>{var _0x56e5fd=_0x467b6a;_0x36acee[_0x5a3ee2][_0x56e5fd(0xab)]=_0x531d5b;}),_0x341dd9[_0x467b6a(0x19a)]((_0x4166b6,_0x3ee72c)=>{var _0x192b11=_0x467b6a;_0x36acee[_0x3ee72c][_0x192b11(0x8b)]=_0x4166b6;}),_0x18b86b[_0x467b6a(0x19a)]((_0x3c5c88,_0x26f548)=>{var _0x159f96=_0x467b6a;_0x36acee[_0x26f548][_0x159f96(0xd5)]=_0x3c5c88;}),_0x51d494['forEach']((_0xb6863d,_0x454c85)=>{var _0x59839d=_0x467b6a;_0x36acee[_0x454c85][_0x59839d(0x15e)]=_0xb6863d;}),_0x223488['forEach']((_0x426a88,_0x8cc4fc)=>{_0x36acee[_0x8cc4fc]['expiry_date']=_0x426a88;});var _0x4fdf73=0x0;_0x36acee[_0x467b6a(0x19a)](_0x4511cf=>{var _0x2fe2a7=_0x467b6a;console[_0x2fe2a7(0x188)](_0x2fe2a7(0x12b),_0x4511cf),(parseInt(_0x4511cf[_0x2fe2a7(0xf1)])<parseInt(_0x4511cf['quantity'])||parseInt(_0x4511cf[_0x2fe2a7(0x162)])==0x0)&&_0x4fdf73++;});if(_0x4fdf73!=0x0)return _0x81a05c[_0x467b6a(0xc1)]('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x4b5fec[_0x467b6a(0x144)](_0x467b6a(0x118));_0x214dc7[_0x467b6a(0x189)][_0x467b6a(0x19a)](_0x5c81ce=>{var _0xc05458=_0x467b6a;const _0x5573e3=_0x237ca4['product_details'][_0xc05458(0x19d)](_0x59476f=>{var _0x33741a=_0xc05458;_0x59476f['product_name']==_0x5c81ce[_0x33741a(0x13e)]&&_0x59476f[_0x33741a(0x182)]==_0x5c81ce[_0x33741a(0x182)]&&(_0x59476f[_0x33741a(0x88)]=parseInt(_0x59476f[_0x33741a(0x88)])+parseInt(_0x5c81ce[_0x33741a(0x162)]));});}),await _0x237ca4['save']();const _0x2560f5=_0x36acee['filter'](_0x2ab0ac=>_0x2ab0ac[_0x467b6a(0x162)]!=='0'&&_0x2ab0ac[_0x467b6a(0x162)]!=='');_0x214dc7[_0x467b6a(0x130)]=_0x1eb194,_0x214dc7['customer']=_0x40718d,_0x214dc7[_0x467b6a(0x116)]=_0xefc98a,_0x214dc7[_0x467b6a(0xb2)]=_0x9abc7c,_0x214dc7['sale_product']=_0x2560f5,_0x214dc7[_0x467b6a(0x8e)]=_0x2144a3,_0x214dc7[_0x467b6a(0x19e)]=_0x32e37d;const _0x2d013e=await _0x214dc7[_0x467b6a(0x184)](),_0x5b5c27=await sales_finished[_0x467b6a(0x112)]({'_id':_0x81a05c['params']['id']}),_0x54d782=await warehouse['findOne']({'name':_0x9abc7c,'room':_0x32e37d,'warehouse_category':'Finished\x20Goods'});_0x5b5c27['sale_product']['forEach'](_0x150a05=>{var _0x2a3525=_0x467b6a;const _0xda9b4e=_0x54d782['product_details'][_0x2a3525(0x19d)](_0xc5761=>{var _0x444fdb=_0x2a3525;_0xc5761[_0x444fdb(0x13e)]==_0x150a05[_0x444fdb(0x13e)]&&_0xc5761[_0x444fdb(0x182)]==_0x150a05[_0x444fdb(0x182)]&&(_0xc5761[_0x444fdb(0x88)]=parseInt(_0xc5761['product_stock'])-parseInt(_0x150a05[_0x444fdb(0x162)]));});}),console[_0x467b6a(0x188)](_0x467b6a(0x9c),_0x54d782),await _0x54d782[_0x467b6a(0x184)]();const _0x87f0b8=await c_payment_data[_0x467b6a(0x112)]({'invoice':_0x81a05c['body'][_0x467b6a(0x130)]});_0x87f0b8[_0x467b6a(0xd0)]=_0x81a05c['body']['suppliers'],await _0x87f0b8['save'](),_0x81a05c[_0x467b6a(0xc1)](_0x467b6a(0x152),_0x467b6a(0xc0)),_0x4b5fec[_0x467b6a(0x144)](_0x467b6a(0x146));}catch(_0x175104){console[_0x467b6a(0x188)](_0x175104);}}),router[a0_0x1a05a0(0x9f)](a0_0x1a05a0(0x133),auth,async(_0x58882a,_0x95ef47)=>{var _0x7b0c0e=a0_0x1a05a0;try{const _0xb1e279=_0x58882a[_0x7b0c0e(0xca)]['id'],{invoice:_0x61b020,customer:_0x4de71f,receivable_amount:_0x365076,received_amount:_0x34617f}=_0x58882a[_0x7b0c0e(0x95)],_0x2b4e6c=await sales[_0x7b0c0e(0xe1)](_0xb1e279);console[_0x7b0c0e(0x188)](_0x2b4e6c);var _0x389cc3=_0x365076-_0x34617f;console['log'](_0x34617f),_0x2b4e6c[_0x7b0c0e(0x140)]=parseFloat(_0x34617f)+parseFloat(_0x2b4e6c[_0x7b0c0e(0x140)]),_0x2b4e6c['due_amount']=_0x389cc3,console[_0x7b0c0e(0x188)](_0x2b4e6c);const _0x83a263=await _0x2b4e6c[_0x7b0c0e(0x184)](),_0x4cfcc2=await c_payment_data[_0x7b0c0e(0x112)]({'invoice':_0x61b020});_0x4cfcc2[_0x7b0c0e(0x108)]=_0x389cc3,await _0x4cfcc2[_0x7b0c0e(0x184)]();let _0x4b7876=new Date(),_0xb6345b=('0'+_0x4b7876[_0x7b0c0e(0xdd)]())[_0x7b0c0e(0x164)](-0x2),_0x408d2a=('0'+(_0x4b7876[_0x7b0c0e(0x172)]()+0x1))[_0x7b0c0e(0x164)](-0x2),_0x3f560b=_0x4b7876[_0x7b0c0e(0xa2)](),_0x5cdf49=_0x3f560b+'-'+_0x408d2a+'-'+_0xb6345b;const _0x55d614=new customer_payment({'invoice':_0x61b020,'date':_0x3f560b+'-'+_0x408d2a+'-'+_0xb6345b,'customer':_0x4de71f,'reason':_0x7b0c0e(0x14b),'amount':_0x34617f}),_0x5aa626=await _0x55d614['save']();_0x58882a[_0x7b0c0e(0xc1)](_0x7b0c0e(0x152),_0x7b0c0e(0x147)),_0x95ef47[_0x7b0c0e(0x144)]('/all_sales/view');}catch(_0x34cccd){console[_0x7b0c0e(0x188)](_0x34cccd);}}),router['get'](a0_0x1a05a0(0x109),auth,async(_0x4b9f76,_0x50e32b)=>{var _0x49e17e=a0_0x1a05a0;try{const {username:_0x35cb9f,email:_0x4e3c14,role:_0x547302}=_0x4b9f76[_0x49e17e(0x19c)],_0x38bc99=_0x4b9f76[_0x49e17e(0x19c)],_0x899afb=await profile['findOne']({'email':_0x38bc99[_0x49e17e(0x143)]}),_0x4ef9bb=await master_shop[_0x49e17e(0xd2)]();console[_0x49e17e(0x188)]('master',_0x4ef9bb);const _0x28aa7a=_0x4b9f76['params']['id'],_0x37275d=await sales[_0x49e17e(0xe1)](_0x28aa7a);console[_0x49e17e(0x188)](_0x37275d);const _0xac2c23=await customer['findOne']({'name':_0x37275d['customer']});console[_0x49e17e(0x188)](_0xac2c23);if(_0x4ef9bb[0x0]['language']=='English\x20(US)'){var _0x2ba443=users['English'];console[_0x49e17e(0x188)](_0x2ba443);}else{if(_0x4ef9bb[0x0][_0x49e17e(0x86)]=='Hindi')var _0x2ba443=users[_0x49e17e(0x145)];else{if(_0x4ef9bb[0x0]['language']==_0x49e17e(0x14d))var _0x2ba443=users[_0x49e17e(0x14d)];else{if(_0x4ef9bb[0x0][_0x49e17e(0x86)]=='Spanish')var _0x2ba443=users[_0x49e17e(0xb1)];else{if(_0x4ef9bb[0x0]['language']==_0x49e17e(0x176))var _0x2ba443=users[_0x49e17e(0x176)];else{if(_0x4ef9bb[0x0]['language']==_0x49e17e(0x153))var _0x2ba443=users[_0x49e17e(0x124)];else{if(_0x4ef9bb[0x0][_0x49e17e(0x86)]==_0x49e17e(0xd6))var _0x2ba443=users[_0x49e17e(0xd6)];else{if(_0x4ef9bb[0x0][_0x49e17e(0x86)]==_0x49e17e(0x13a))var _0x2ba443=users[_0x49e17e(0x98)];}}}}}}}_0x50e32b[_0x49e17e(0x167)]('sales_invoice',{'success':_0x4b9f76[_0x49e17e(0xc1)](_0x49e17e(0x152)),'errors':_0x4b9f76[_0x49e17e(0xc1)](_0x49e17e(0xef)),'role':_0x38bc99,'profile':_0x899afb,'master_shop':_0x4ef9bb,'customers':_0xac2c23,'sales':_0x37275d,'language':_0x2ba443});}catch(_0x4cf89b){console[_0x49e17e(0x188)](_0x4cf89b);}}),router['get'](a0_0x1a05a0(0xce),auth,async(_0x2bb388,_0x4dc62c)=>{var _0xfc545d=a0_0x1a05a0;try{const {username:_0x211ab2,email:_0x1462de,role:_0x23e9b3}=_0x2bb388[_0xfc545d(0x19c)],_0x10098b=_0x2bb388[_0xfc545d(0x19c)],_0x42279b=await profile['findOne']({'email':_0x10098b[_0xfc545d(0x143)]}),_0x5bf09d=await master_shop[_0xfc545d(0xd2)](),_0x3821cb=_0x2bb388['params']['id'],_0x9901c2=await sales_finished['findById'](_0x3821cb),_0x151025=await warehouse['aggregate']([{'$match':{'name':_0x9901c2[_0xfc545d(0xb2)]}},{'$unwind':_0xfc545d(0x101)},{'$group':{'_id':_0xfc545d(0x198),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xfc545d(0xaa)},'bin':{'$first':_0xfc545d(0x11d)},'type':{'$first':_0xfc545d(0x17c)},'floorlevel':{'$first':_0xfc545d(0x18d)},'primary_code':{'$first':_0xfc545d(0x1a0)},'secondary_code':{'$first':_0xfc545d(0x8c)},'product_code':{'$first':_0xfc545d(0x18f)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xfc545d(0x16a)},'expiry_date':{'$first':_0xfc545d(0x190)},'production_date':{'$first':_0xfc545d(0xb4)},'unit':{'$first':_0xfc545d(0x120)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0xfc545d(0x18b)},'batch_code':{'$first':_0xfc545d(0xe0)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x44f36e=await product[_0xfc545d(0xd2)]({}),_0x1822fa=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0xfc545d(0xc7),'name':{'$ne':_0xfc545d(0x16e),'$ne':_0xfc545d(0x16b)}}},{'$group':{'_id':_0xfc545d(0x18a),'name':{'$first':_0xfc545d(0x18a)}}},{'$sort':{'name':0x1}}]);var _0x22c8ae=['Return\x20Rooms'];const _0x5bb324=await warehouse[_0xfc545d(0x11f)]([{'$match':{'status':'Enabled','name':_0xfc545d(0x16b)}},{'$group':{'_id':_0xfc545d(0x18a),'name':{'$first':_0xfc545d(0x18a)}}},{'$sort':{'name':0x1}}]);if(_0x5bf09d[0x0]['language']=='English\x20(US)'){var _0xb3c758=users[_0xfc545d(0x13d)];console[_0xfc545d(0x188)](_0xb3c758);}else{if(_0x5bf09d[0x0][_0xfc545d(0x86)]=='Hindi')var _0xb3c758=users[_0xfc545d(0x145)];else{if(_0x5bf09d[0x0][_0xfc545d(0x86)]==_0xfc545d(0x14d))var _0xb3c758=users['German'];else{if(_0x5bf09d[0x0][_0xfc545d(0x86)]==_0xfc545d(0xb1))var _0xb3c758=users['Spanish'];else{if(_0x5bf09d[0x0][_0xfc545d(0x86)]==_0xfc545d(0x176))var _0xb3c758=users[_0xfc545d(0x176)];else{if(_0x5bf09d[0x0][_0xfc545d(0x86)]==_0xfc545d(0x153))var _0xb3c758=users['Portuguese'];else{if(_0x5bf09d[0x0][_0xfc545d(0x86)]==_0xfc545d(0xd6))var _0xb3c758=users['Chinese'];else{if(_0x5bf09d[0x0][_0xfc545d(0x86)]==_0xfc545d(0x13a))var _0xb3c758=users[_0xfc545d(0x98)];}}}}}}}_0x4dc62c[_0xfc545d(0x167)](_0xfc545d(0x13b),{'success':_0x2bb388[_0xfc545d(0xc1)]('success'),'errors':_0x2bb388[_0xfc545d(0xc1)]('errors'),'role':_0x10098b,'profile':_0x42279b,'user':_0x9901c2,'stock':_0x151025,'master_shop':_0x5bf09d,'unit':_0x44f36e,'language':_0xb3c758,'warehouses':_0x1822fa,'rooms':_0x22c8ae,'warehouse_QA':_0x5bb324});}catch(_0x181383){console[_0xfc545d(0x188)](_0x181383),_0x4dc62c[_0xfc545d(0x119)](0xc8)[_0xfc545d(0x91)]({'message':_0x181383['message']});}}),router[a0_0x1a05a0(0x9f)](a0_0x1a05a0(0xce),auth,async(_0x5526ce,_0x1e2781)=>{var _0x25e5aa=a0_0x1a05a0;if(_0x5526ce[_0x25e5aa(0x95)]['for_categorize']=='QA')try{const {invoice:_0x4d4979,date:_0x1e41be,warehouse_name:_0x10125e,product_name:_0x57ea84,primary_code:_0x213d19,secondary_code:_0x3415cf,product_code:_0x94b4ee,sales_quantity:_0x1fd061,stocks:_0x142ebd,return_qty:_0x942dbe,Room_name:_0x57d73a,to_warehouse_name_QA:_0x1cc704,to_Room_name_QA:_0x5a554f,note:_0x5013bb,for_categorize:_0x34397b,product_name_QA1:_0x153ac4}=_0x5526ce[_0x25e5aa(0x95)];if(typeof _0x153ac4==_0x25e5aa(0x14a))var _0x25a388=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x14f)]],_0x28484c=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x100)]],_0x5b70b1=[_0x5526ce[_0x25e5aa(0x95)]['secondary_code_QA']],_0x462ff9=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xde)]],_0x498bcf=[_0x5526ce[_0x25e5aa(0x95)]['sales_quantity_QA']],_0x494b91=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xb5)]],_0x25e022=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x194)]],_0x21824e=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x15c)]],_0x11032f=[_0x5526ce[_0x25e5aa(0x95)]['maxProducts_QA']],_0x4b9750=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x19b)]],_0x3a6206=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xd9)]],_0x24de59=[_0x5526ce[_0x25e5aa(0x95)]['unit_QA']],_0x46ad7a=[_0x5526ce[_0x25e5aa(0x95)]['production_date_QA']],_0x4eb0fc=[_0x5526ce[_0x25e5aa(0x95)]['expiry_date_QA']];else var _0x25a388=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x14f)]],_0x28484c=[..._0x5526ce['body']['primary_code_QA']],_0x5b70b1=[..._0x5526ce['body'][_0x25e5aa(0x11c)]],_0x462ff9=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xde)]],_0x498bcf=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xe3)]],_0x494b91=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xb5)]],_0x25e022=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x194)]],_0x21824e=[..._0x5526ce['body'][_0x25e5aa(0x15c)]],_0x11032f=[..._0x5526ce['body']['maxProducts_QA']],_0x4b9750=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x19b)]],_0x3a6206=[..._0x5526ce[_0x25e5aa(0x95)]['secondary_unit_QA']],_0x24de59=[..._0x5526ce['body'][_0x25e5aa(0xc6)]],_0x46ad7a=[..._0x5526ce[_0x25e5aa(0x95)]['production_date_QA']],_0x4eb0fc=[..._0x5526ce['body'][_0x25e5aa(0x87)]];const _0x500f4d=_0x25a388[_0x25e5aa(0x19d)](_0x25f314=>{return _0x25f314={'product_name':_0x25f314};});_0x28484c[_0x25e5aa(0x19a)]((_0x119283,_0x6d503a)=>{var _0x2c6f97=_0x25e5aa;_0x500f4d[_0x6d503a][_0x2c6f97(0xab)]=_0x119283;}),_0x5b70b1[_0x25e5aa(0x19a)]((_0x1704b7,_0x21d309)=>{var _0x25f56b=_0x25e5aa;_0x500f4d[_0x21d309][_0x25f56b(0x8b)]=_0x1704b7;}),_0x462ff9[_0x25e5aa(0x19a)]((_0x12b0ec,_0x3c764d)=>{var _0xa6bce0=_0x25e5aa;_0x500f4d[_0x3c764d][_0xa6bce0(0xd5)]=_0x12b0ec;}),_0x498bcf[_0x25e5aa(0x19a)]((_0x31802b,_0x209e71)=>{_0x500f4d[_0x209e71]['sale_qty']=_0x31802b;}),_0x494b91[_0x25e5aa(0x19a)]((_0xcef522,_0x399225)=>{var _0x48997a=_0x25e5aa;_0x500f4d[_0x399225][_0x48997a(0xf1)]=_0xcef522;}),_0x25e022[_0x25e5aa(0x19a)]((_0x5bbd91,_0x21b82b)=>{var _0x552993=_0x25e5aa;_0x500f4d[_0x21b82b][_0x552993(0xb6)]=_0x5bbd91;}),_0x21824e[_0x25e5aa(0x19a)]((_0x198113,_0x2ac404)=>{var _0x37f1fe=_0x25e5aa;_0x500f4d[_0x2ac404][_0x37f1fe(0xdc)]=_0x198113;}),_0x11032f['forEach']((_0x39b8d7,_0x7ae2ba)=>{var _0x388140=_0x25e5aa;_0x500f4d[_0x7ae2ba][_0x388140(0x15a)]=_0x39b8d7;}),_0x4b9750['forEach']((_0x239ce2,_0x2273b0)=>{var _0x712690=_0x25e5aa;_0x500f4d[_0x2273b0][_0x712690(0x102)]=_0x239ce2;}),_0x3a6206[_0x25e5aa(0x19a)]((_0x4ce8d3,_0x4474cb)=>{var _0x1c8ecd=_0x25e5aa;_0x500f4d[_0x4474cb][_0x1c8ecd(0xcd)]=_0x4ce8d3;}),_0x24de59[_0x25e5aa(0x19a)]((_0x3b3ebf,_0x2d0908)=>{var _0xf3121f=_0x25e5aa;_0x500f4d[_0x2d0908][_0xf3121f(0x123)]=_0x3b3ebf;}),_0x46ad7a['forEach']((_0x16b099,_0x28f595)=>{var _0x4aa3f5=_0x25e5aa;_0x500f4d[_0x28f595][_0x4aa3f5(0x9a)]=_0x16b099;}),_0x4eb0fc['forEach']((_0x2895a8,_0x286b35)=>{var _0x590bd6=_0x25e5aa;_0x500f4d[_0x286b35][_0x590bd6(0x161)]=_0x2895a8;});const _0x42252b=await sales_finished['findOne']({'invoice':_0x4d4979});_0x42252b[_0x25e5aa(0x13c)]=_0x25e5aa(0x11e);const _0x36dbf0=await _0x42252b[_0x25e5aa(0x184)](),_0xbe1dfb=new sales_return_finished({'invoice':_0x4d4979,'customer':_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x192)],'date':_0x1e41be,'warehouse_name':_0x10125e,'room':_0x57d73a,'ToWarehouse':_0x1cc704,'ToRoom':_0x5a554f,'return_sale_QA':_0x500f4d,'note':_0x5013bb,'warehouse_cat':_0x34397b}),_0x302384=await _0xbe1dfb[_0x25e5aa(0x184)](),_0x206703=await sales_return_finished[_0x25e5aa(0x112)]({'invoice':_0x4d4979}),_0x19a895=await warehouse[_0x25e5aa(0x112)]({'name':_0x1cc704,'room':_0x5a554f});_0x206703[_0x25e5aa(0xc5)][_0x25e5aa(0x19a)](_0x39659b=>{var _0x3a9c96=_0x25e5aa,_0x34c92b=0x0;const _0x2f463b=_0x19a895[_0x3a9c96(0xda)]['map'](_0x30c00f=>{var _0x4bf246=_0x3a9c96;_0x30c00f['product_name']==_0x39659b[_0x4bf246(0x13e)]&&_0x30c00f[_0x4bf246(0x161)]==_0x39659b['expiry_date']&&_0x30c00f[_0x4bf246(0x9a)]==_0x39659b['production_date']&&_0x30c00f[_0x4bf246(0x102)]==_0x39659b[_0x4bf246(0x102)]&&(_0x30c00f[_0x4bf246(0x88)]=parseInt(_0x30c00f[_0x4bf246(0x88)])+parseInt(_0x39659b[_0x4bf246(0xb6)]),_0x34c92b++);});_0x34c92b=='0'&&(_0x19a895['product_details']=_0x19a895[_0x3a9c96(0xda)][_0x3a9c96(0x92)]({'product_name':_0x39659b[_0x3a9c96(0x13e)],'product_stock':_0x39659b[_0x3a9c96(0xb6)],'primary_code':_0x39659b[_0x3a9c96(0xab)],'secondary_code':_0x39659b[_0x3a9c96(0x8b)],'product_code':_0x39659b[_0x3a9c96(0xd5)],'batch_code':_0x39659b['batch_code'],'maxPerUnit':_0x39659b[_0x3a9c96(0xdc)],'production_date':_0x39659b[_0x3a9c96(0x9a)],'expiry_date':_0x39659b[_0x3a9c96(0x161)],'secondary_unit':_0x39659b[_0x3a9c96(0xcd)],'unit':_0x39659b[_0x3a9c96(0x123)],'maxProducts':_0x39659b[_0x3a9c96(0x15a)],'bay':_0x39659b[_0x3a9c96(0x182)]}));}),await _0x19a895['save']();const _0x3c7c6e=new c_payment_data({'invoice':_0x4d4979,'customer':_0x5526ce['body'][_0x25e5aa(0x192)],'reason':_0x25e5aa(0x110)});await _0x3c7c6e[_0x25e5aa(0x184)]();const _0x438073=await master_shop['find'](),_0x385d39=await email_settings[_0x25e5aa(0x112)](),_0x2a189e=await customer[_0x25e5aa(0x112)]({'name':_0x5526ce[_0x25e5aa(0x95)]['customer']});_0x438073[0x0][_0x25e5aa(0xb7)]==0x1?(right_currency=_0x438073[0x0][_0x25e5aa(0xd4)],left_currency=''):(right_currency='',left_currency=_0x438073[0x0]['currency']);var _0x3c1fc8=_0x25a388,_0x44e860=_0x25e022,_0x2a603e='',_0x3cff79;for(_0x3cff79 in _0x3c1fc8){_0x2a603e+=_0x25e5aa(0x85)+_0x25e5aa(0xd1)+_0x3c1fc8[_0x3cff79]+_0x25e5aa(0xbb)+_0x25e5aa(0xd1)+_0x44e860[_0x3cff79]+'</td>'+_0x25e5aa(0x113);}console['log'](_0x25e5aa(0x10e),_0x2a603e);let _0x332de3=nodemailer[_0x25e5aa(0xfd)]({'service':_0x25e5aa(0x10b),'auth':{'user':_0x385d39[_0x25e5aa(0x143)],'pass':_0x385d39[_0x25e5aa(0x111)]}}),_0x25c162={'from':_0x385d39['email'],'to':_0x2a189e[_0x25e5aa(0x143)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x25e5aa(0x131),'path':__dirname+'/../public'+_0x25e5aa(0x199)+_0x438073[0x0][_0x25e5aa(0x136)],'cid':'logo'}],'html':_0x25e5aa(0xa5)+_0x25e5aa(0x8d)+_0x25e5aa(0x166)+_0x25e5aa(0xac)+_0x25e5aa(0x169)+_0x25e5aa(0xac)+_0x25e5aa(0x150)+_0x25e5aa(0x156)+'<div>'+_0x25e5aa(0xe9)+_0x438073[0x0]['site_title']+_0x25e5aa(0xbf)+_0x25e5aa(0x156)+_0x25e5aa(0x156)+_0x25e5aa(0xeb)+_0x25e5aa(0xac)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x25e5aa(0xa9)+_0x4d4979+'\x20'+_0x25e5aa(0x12a)+'\x20Order\x20Date\x20:\x20'+_0x1e41be+'\x20'+'</span>'+_0x25e5aa(0xbd)+_0x25e5aa(0x156)+_0x25e5aa(0x8f)+_0x25e5aa(0x135)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x25e5aa(0x115)+_0x25e5aa(0x16f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x25e5aa(0x113)+_0x25e5aa(0x89)+_0x25e5aa(0xba)+'\x20'+_0x2a603e+'\x20'+_0x25e5aa(0x171)+'</table>'+_0x25e5aa(0xac)+_0x25e5aa(0x191)+_0x25e5aa(0x11a)+_0x438073[0x0]['site_title']+'</h5>'+_0x25e5aa(0x156)+_0x25e5aa(0x156)+'</body></html>'};_0x332de3[_0x25e5aa(0xa0)](_0x25c162,function(_0x2a940a,_0x4ccaaa){var _0x7bd3fa=_0x25e5aa;_0x2a940a?(console[_0x7bd3fa(0x188)](_0x2a940a),console[_0x7bd3fa(0x188)](_0x7bd3fa(0xfa))):console['log'](_0x7bd3fa(0x17a));}),_0x5526ce['flash'](_0x25e5aa(0x152),_0x25e5aa(0x12f)),_0x1e2781[_0x25e5aa(0x144)](_0x25e5aa(0x146));}catch(_0x4e8925){_0x1e2781[_0x25e5aa(0x119)](0xc8)[_0x25e5aa(0x91)]({'message1':_0x4e8925['message']});}else{if(_0x5526ce[_0x25e5aa(0x95)]['for_categorize']=='GS')try{const {invoice:_0x56f33e,date:_0xd7dfb8,warehouse_name:_0x36fc2c,product_name:_0x129711,primary_code:_0x50b264,secondary_code:_0x2131b9,product_code:_0x14af0d,sales_quantity:_0xa7576c,stocks:_0x57bdce,return_qty:_0xf2c0a5,Room_name:_0xb10303,to_warehouse_name:_0x52789d,to_Room_name:_0x434c76,note:_0x1c9742,level:_0x1f1a24,isle:_0x1e7289,pallet:_0x5698cb,for_categorize:_0x17a0a9}=_0x5526ce[_0x25e5aa(0x95)];if(typeof _0x129711==_0x25e5aa(0x14a))var _0x25a388=[_0x5526ce['body'][_0x25e5aa(0x13e)]],_0x28484c=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xab)]],_0x5b70b1=[_0x5526ce[_0x25e5aa(0x95)]['secondary_code']],_0x462ff9=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xd5)]],_0x498bcf=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x163)]],_0x25e022=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xb6)]],_0x3e15ae=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x182)]],_0x21824e=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xdc)]],_0x11032f=[_0x5526ce[_0x25e5aa(0x95)]['maxProducts']],_0x4b9750=[_0x5526ce['body'][_0x25e5aa(0x102)]],_0x3a6206=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xcd)]],_0x24de59=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x123)]],_0x46ad7a=[_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x9a)]],_0x4eb0fc=[_0x5526ce[_0x25e5aa(0x95)]['expiry_date']];else var _0x25a388=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x13e)]],_0x28484c=[..._0x5526ce[_0x25e5aa(0x95)]['primary_code']],_0x5b70b1=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x8b)]],_0x462ff9=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xd5)]],_0x498bcf=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x163)]],_0x25e022=[..._0x5526ce['body'][_0x25e5aa(0xb6)]],_0x3e15ae=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x182)]],_0x21824e=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xdc)]],_0x11032f=[..._0x5526ce['body'][_0x25e5aa(0x15a)]],_0x4b9750=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x102)]],_0x3a6206=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0xcd)]],_0x24de59=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x123)]],_0x46ad7a=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x9a)]],_0x4eb0fc=[..._0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x161)]];const _0x38c344=_0x25a388[_0x25e5aa(0x19d)](_0x4643b1=>{return _0x4643b1={'product_name':_0x4643b1};});_0x28484c[_0x25e5aa(0x19a)]((_0x4042bd,_0x589680)=>{var _0x239029=_0x25e5aa;_0x38c344[_0x589680][_0x239029(0xab)]=_0x4042bd;}),_0x5b70b1[_0x25e5aa(0x19a)]((_0x5e168c,_0x2e330b)=>{var _0x37253b=_0x25e5aa;_0x38c344[_0x2e330b][_0x37253b(0x8b)]=_0x5e168c;}),_0x462ff9[_0x25e5aa(0x19a)]((_0x383cf5,_0x42adaf)=>{var _0x1e0fae=_0x25e5aa;_0x38c344[_0x42adaf][_0x1e0fae(0xd5)]=_0x383cf5;}),_0x498bcf[_0x25e5aa(0x19a)]((_0x39df62,_0x334014)=>{var _0x4cd125=_0x25e5aa;_0x38c344[_0x334014][_0x4cd125(0xff)]=_0x39df62;}),_0x25e022[_0x25e5aa(0x19a)]((_0x402ef8,_0x41c3c8)=>{var _0x24c712=_0x25e5aa;_0x38c344[_0x41c3c8][_0x24c712(0xb6)]=_0x402ef8;}),_0x3e15ae[_0x25e5aa(0x19a)]((_0x51fa02,_0x55d0f3)=>{_0x38c344[_0x55d0f3]['bay']=_0x51fa02;}),_0x21824e[_0x25e5aa(0x19a)]((_0x39fe16,_0x33372c)=>{_0x38c344[_0x33372c]['maxPerUnit']=_0x39fe16;}),_0x11032f['forEach']((_0x56fef0,_0x483cdf)=>{_0x38c344[_0x483cdf]['maxProducts']=_0x56fef0;}),_0x4b9750[_0x25e5aa(0x19a)]((_0x2314ee,_0x2b0ddf)=>{var _0x5e274d=_0x25e5aa;_0x38c344[_0x2b0ddf][_0x5e274d(0x102)]=_0x2314ee;}),_0x3a6206[_0x25e5aa(0x19a)]((_0x422b66,_0x382805)=>{var _0x58cabf=_0x25e5aa;_0x38c344[_0x382805][_0x58cabf(0xcd)]=_0x422b66;}),_0x24de59[_0x25e5aa(0x19a)]((_0x46e7a9,_0x5dad1a)=>{_0x38c344[_0x5dad1a]['unit']=_0x46e7a9;}),_0x46ad7a[_0x25e5aa(0x19a)]((_0x4a1754,_0x537b6f)=>{var _0x46434d=_0x25e5aa;_0x38c344[_0x537b6f][_0x46434d(0x9a)]=_0x4a1754;}),_0x4eb0fc[_0x25e5aa(0x19a)]((_0x458821,_0x730297)=>{var _0x5b0de5=_0x25e5aa;_0x38c344[_0x730297][_0x5b0de5(0x161)]=_0x458821;});var _0x4e5e29=0x0;_0x38c344[_0x25e5aa(0x19a)](_0x286a11=>{var _0x1d9a30=_0x25e5aa;(parseInt(_0x286a11['sale_qty'])<parseInt(_0x286a11[_0x1d9a30(0xb6)])||parseInt(_0x286a11['stock'])<parseInt(_0x286a11[_0x1d9a30(0xb6)])&&parseInt(_0x286a11['sale_qty'])>parseInt(_0x286a11[_0x1d9a30(0xb6)])||parseInt(_0x286a11[_0x1d9a30(0xb6)])==0x0)&&_0x4e5e29++;});if(_0x4e5e29!=0x0)return _0x5526ce[_0x25e5aa(0xc1)]('errors',_0x25e5aa(0x17b)),_0x1e2781[_0x25e5aa(0x144)]('back');const _0x5d008d=await sales_finished[_0x25e5aa(0x112)]({'invoice':_0x56f33e});_0x5d008d[_0x25e5aa(0x13c)]=_0x25e5aa(0x11e);const _0x39b432=await _0x5d008d[_0x25e5aa(0x184)](),_0xc3edbe=new sales_return_finished({'invoice':_0x56f33e,'customer':_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x192)],'date':_0xd7dfb8,'warehouse_name':_0x36fc2c,'room':_0xb10303,'ToWarehouse':_0x52789d,'ToRoom':_0x434c76,'return_sale':_0x38c344,'note':_0x1c9742,'warehouse_cat':_0x17a0a9}),_0x4d1522=await _0xc3edbe[_0x25e5aa(0x184)](),_0x27fca0=await sales_return_finished[_0x25e5aa(0x112)]({'invoice':_0x56f33e}),_0x2f5730=await warehouse[_0x25e5aa(0x112)]({'name':_0x52789d,'room':_0x434c76,'warehouse_category':_0x25e5aa(0xc7)});_0x27fca0[_0x25e5aa(0x14c)][_0x25e5aa(0x19a)](_0x50fb5c=>{var _0x4cfc9f=_0x25e5aa,_0x3ccce8=0x0;const _0x5002a3=_0x2f5730[_0x4cfc9f(0xda)]['map'](_0x5296c1=>{var _0x50c2e4=_0x4cfc9f;_0x5296c1['product_name']==_0x50fb5c['product_name']&&_0x5296c1['bay']==_0x50fb5c[_0x50c2e4(0x182)]&&_0x5296c1['expiry_date']==_0x50fb5c['expiry_date']&&_0x5296c1[_0x50c2e4(0x9a)]==_0x50fb5c[_0x50c2e4(0x9a)]&&_0x5296c1[_0x50c2e4(0x102)]==_0x50fb5c[_0x50c2e4(0x102)]&&(_0x5296c1[_0x50c2e4(0x88)]=parseInt(_0x5296c1[_0x50c2e4(0x88)])+parseInt(_0x50fb5c[_0x50c2e4(0xb6)]),_0x3ccce8++);});_0x3ccce8=='0'&&(_0x2f5730['product_details']=_0x2f5730['product_details'][_0x4cfc9f(0x92)]({'product_name':_0x50fb5c[_0x4cfc9f(0x13e)],'product_stock':_0x50fb5c[_0x4cfc9f(0xb6)],'primary_code':_0x50fb5c['primary_code'],'secondary_code':_0x50fb5c['secondary_code'],'product_code':_0x50fb5c[_0x4cfc9f(0xd5)],'bay':_0x50fb5c[_0x4cfc9f(0x182)],'batch_code':_0x50fb5c[_0x4cfc9f(0x102)],'maxPerUnit':_0x50fb5c['maxPerUnit'],'production_date':_0x50fb5c['production_date'],'expiry_date':_0x50fb5c[_0x4cfc9f(0x161)],'secondary_unit':_0x50fb5c['secondary_unit'],'unit':_0x50fb5c[_0x4cfc9f(0x123)],'maxProducts':_0x50fb5c[_0x4cfc9f(0x15a)]}));}),await _0x2f5730[_0x25e5aa(0x184)](),console[_0x25e5aa(0x188)](_0x5526ce['body']);const _0xb2f866=new c_payment_data({'invoice':_0x56f33e,'customer':_0x5526ce[_0x25e5aa(0x95)][_0x25e5aa(0x192)],'reason':_0x25e5aa(0x110)});await _0xb2f866['save']();const _0x535c16=await master_shop[_0x25e5aa(0xd2)]();console[_0x25e5aa(0x188)]('add\x20post',_0x535c16[0x0][_0x25e5aa(0x136)]);const _0x2e97fe=await email_settings[_0x25e5aa(0x112)](),_0x4a893f=await customer[_0x25e5aa(0x112)]({'name':_0x5526ce[_0x25e5aa(0x95)]['customer']});console['log'](_0x25e5aa(0xed),_0x4a893f);_0x535c16[0x0][_0x25e5aa(0xb7)]==0x1?(right_currency=_0x535c16[0x0][_0x25e5aa(0xd4)],left_currency=''):(right_currency='',left_currency=_0x535c16[0x0][_0x25e5aa(0xd4)]);var _0x3c1fc8=_0x25a388,_0x44e860=_0x25e022,_0x2a603e='',_0x3cff79;for(_0x3cff79 in _0x3c1fc8){_0x2a603e+='<tr>'+_0x25e5aa(0xd1)+_0x3c1fc8[_0x3cff79]+_0x25e5aa(0xbb)+_0x25e5aa(0xd1)+_0x44e860[_0x3cff79]+'</td>'+_0x25e5aa(0x113);}console[_0x25e5aa(0x188)](_0x25e5aa(0x10e),_0x2a603e);let _0x635ea6=nodemailer[_0x25e5aa(0xfd)]({'service':_0x25e5aa(0x10b),'auth':{'user':_0x2e97fe['email'],'pass':_0x2e97fe[_0x25e5aa(0x111)]}}),_0x2ebb59={'from':_0x2e97fe[_0x25e5aa(0x143)],'to':_0x4a893f[_0x25e5aa(0x143)],'subject':_0x25e5aa(0x15f),'attachments':[{'filename':_0x25e5aa(0x131),'path':__dirname+'/../public'+'/upload/'+_0x535c16[0x0]['image'],'cid':'logo'}],'html':_0x25e5aa(0xa5)+_0x25e5aa(0x8d)+'</head><body>'+_0x25e5aa(0xac)+_0x25e5aa(0x169)+_0x25e5aa(0xac)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x25e5aa(0xac)+_0x25e5aa(0xe9)+_0x535c16[0x0]['site_title']+_0x25e5aa(0xbf)+_0x25e5aa(0x156)+_0x25e5aa(0x156)+'<hr\x20class=\x22my-3\x22>'+_0x25e5aa(0xac)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x25e5aa(0xa9)+_0x56f33e+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x25e5aa(0xf5)+_0xd7dfb8+'\x20'+'</span>'+_0x25e5aa(0xbd)+_0x25e5aa(0x156)+_0x25e5aa(0x8f)+_0x25e5aa(0x135)+_0x25e5aa(0x85)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x25e5aa(0xe2)+'</tr>'+_0x25e5aa(0x89)+_0x25e5aa(0xba)+'\x20'+_0x2a603e+'\x20'+_0x25e5aa(0x171)+'</table>'+_0x25e5aa(0xac)+_0x25e5aa(0x191)+_0x25e5aa(0x11a)+_0x535c16[0x0][_0x25e5aa(0x18e)]+_0x25e5aa(0xbd)+_0x25e5aa(0x156)+_0x25e5aa(0x156)+_0x25e5aa(0x193)};_0x635ea6[_0x25e5aa(0xa0)](_0x2ebb59,function(_0x32ffe1,_0x35c45c){var _0x23b357=_0x25e5aa;_0x32ffe1?(console['log'](_0x32ffe1),console[_0x23b357(0x188)](_0x23b357(0xfa))):console[_0x23b357(0x188)](_0x23b357(0x17a));}),_0x5526ce[_0x25e5aa(0xc1)](_0x25e5aa(0x152),_0x25e5aa(0x12f)),_0x1e2781[_0x25e5aa(0x144)](_0x25e5aa(0x146));}catch(_0x287855){console[_0x25e5aa(0x188)](_0x287855),_0x1e2781[_0x25e5aa(0x119)](0xc8)[_0x25e5aa(0x91)]({'message1':_0x287855[_0x25e5aa(0x160)]});}}}),router['get'](a0_0x1a05a0(0x18c),auth,async(_0x1c2e21,_0x1c3a73)=>{var _0x5d5765=a0_0x1a05a0;try{const {username:_0x520cb0,email:_0x12ea53,role:_0x4cbd85}=_0x1c2e21[_0x5d5765(0x19c)],_0x25c3f7=_0x1c2e21[_0x5d5765(0x19c)],_0x27b094=await profile[_0x5d5765(0x112)]({'email':_0x25c3f7['email']}),_0x42ac8e=await master_shop[_0x5d5765(0xd2)]();console[_0x5d5765(0x188)]('barcode\x20Product\x20master',_0x42ac8e);const _0x293e94=_0x1c2e21[_0x5d5765(0xca)]['id'],_0x4965e0=await sales[_0x5d5765(0xe1)](_0x293e94);console[_0x5d5765(0x188)](_0x5d5765(0x173),_0x4965e0);if(_0x42ac8e[0x0][_0x5d5765(0x86)]==_0x5d5765(0x148))var _0x17d443=users[_0x5d5765(0x13d)];else{if(_0x42ac8e[0x0][_0x5d5765(0x86)]=='Hindi')var _0x17d443=users[_0x5d5765(0x145)];else{if(_0x42ac8e[0x0][_0x5d5765(0x86)]==_0x5d5765(0x14d))var _0x17d443=users['German'];else{if(_0x42ac8e[0x0][_0x5d5765(0x86)]==_0x5d5765(0xb1))var _0x17d443=users['Spanish'];else{if(_0x42ac8e[0x0][_0x5d5765(0x86)]=='French')var _0x17d443=users[_0x5d5765(0x176)];else{if(_0x42ac8e[0x0][_0x5d5765(0x86)]=='Portuguese\x20(BR)')var _0x17d443=users[_0x5d5765(0x124)];else{if(_0x42ac8e[0x0][_0x5d5765(0x86)]==_0x5d5765(0xd6))var _0x17d443=users[_0x5d5765(0xd6)];else{if(_0x42ac8e[0x0][_0x5d5765(0x86)]==_0x5d5765(0x13a))var _0x17d443=users[_0x5d5765(0x98)];}}}}}}}_0x1c3a73[_0x5d5765(0x167)](_0x5d5765(0x186),{'success':_0x1c2e21[_0x5d5765(0xc1)](_0x5d5765(0x152)),'errors':_0x1c2e21['flash'](_0x5d5765(0xef)),'role':_0x25c3f7,'profile':_0x27b094,'alldata':_0x4965e0,'master_shop':_0x42ac8e,'language':_0x17d443});}catch(_0x2b94bd){console[_0x5d5765(0x188)](_0x2b94bd);}}),router[a0_0x1a05a0(0x9f)](a0_0x1a05a0(0xa3),async(_0x58219f,_0x161905)=>{var _0x47e61b=a0_0x1a05a0;const {product_code:_0x2e06ea,warehouse_name:_0x9aef97,rooms_data:_0x5ee17d,Roomslist:_0xd675df}=_0x58219f[_0x47e61b(0x95)],_0x394148=_0xd675df[_0x47e61b(0x10a)](','),_0x524a70=[];async function _0x11bcf7(_0xc829b8){var _0x33bf28=_0x47e61b;const _0x214be2=await warehouse[_0x33bf28(0x11f)]([{'$match':{'name':_0x9aef97,'room':_0xc829b8}},{'$unwind':_0x33bf28(0x101)},{'$match':{'product_details.primary_code':_0x2e06ea}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x33bf28(0x178)},'product_stock':{'$first':_0x33bf28(0x9e)},'primary_code':{'$first':_0x33bf28(0x1a0)},'secondary_code':{'$first':_0x33bf28(0x8c)},'product_code':{'$first':_0x33bf28(0x18f)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x33bf28(0x11d)},'type':{'$first':_0x33bf28(0x17c)},'pallet':{'$first':_0x33bf28(0x18d)},'unit':{'$first':_0x33bf28(0x120)},'secondary_unit':{'$first':_0x33bf28(0xb9)},'storage':{'$first':_0x33bf28(0x107)},'rack':{'$first':_0x33bf28(0x16a)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x33bf28(0x12e)},'batch_code':{'$first':_0x33bf28(0xe0)},'product_cat':{'$first':_0x33bf28(0x137)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x33bf28(0x93)},'invoice':{'$first':_0x33bf28(0xb3)}}}]),_0x5324ce=await warehouse[_0x33bf28(0x11f)]([{'$match':{'name':_0x9aef97,'room':_0xc829b8}},{'$unwind':_0x33bf28(0x101)},{'$match':{'product_details.secondary_code':_0x2e06ea}},{'$group':{'_id':_0x33bf28(0x198),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x33bf28(0x1a0)},'secondary_code':{'$first':_0x33bf28(0x8c)},'product_code':{'$first':_0x33bf28(0x18f)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x33bf28(0x11d)},'type':{'$first':_0x33bf28(0x17c)},'pallet':{'$first':_0x33bf28(0x18d)},'unit':{'$first':_0x33bf28(0x120)},'secondary_unit':{'$first':_0x33bf28(0xb9)},'storage':{'$first':_0x33bf28(0x107)},'rack':{'$first':_0x33bf28(0x16a)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x33bf28(0xb4)},'maxPerUnit':{'$first':_0x33bf28(0x12e)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x33bf28(0x137)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x33bf28(0x93)},'invoice':{'$first':_0x33bf28(0xb3)}}}]);if(_0x214be2['length']>0x0)_0x524a70['push'](_0x214be2);else _0x5324ce[_0x33bf28(0x134)]>0x0&&_0x524a70[_0x33bf28(0x177)](_0x5324ce);}const _0x370968=_0x394148[_0x47e61b(0x19d)](_0x2adc07=>_0x11bcf7(_0x2adc07));await Promise[_0x47e61b(0xc9)](_0x370968),_0x161905['json'](_0x524a70);}),module[a0_0x1a05a0(0x13f)]=router;