var a0_0x51978a=a0_0x2efe;(function(_0x4982e1,_0x1c8fb7){var _0x2881f9=a0_0x2efe,_0x5db2fa=_0x4982e1();while(!![]){try{var _0x2f81c1=parseInt(_0x2881f9(0x1d0))/0x1+parseInt(_0x2881f9(0x166))/0x2+-parseInt(_0x2881f9(0x15e))/0x3+-parseInt(_0x2881f9(0x103))/0x4*(parseInt(_0x2881f9(0x1d6))/0x5)+-parseInt(_0x2881f9(0x19b))/0x6*(parseInt(_0x2881f9(0xe7))/0x7)+parseInt(_0x2881f9(0x121))/0x8+-parseInt(_0x2881f9(0x158))/0x9;if(_0x2f81c1===_0x1c8fb7)break;else _0x5db2fa['push'](_0x5db2fa['shift']());}catch(_0x317f78){_0x5db2fa['push'](_0x5db2fa['shift']());}}}(a0_0x28d8,0x8a817));const express=require('express'),app=express(),router=express[a0_0x51978a(0x12c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x51978a(0x197)),auth=require(a0_0x51978a(0x1c4)),nodemailer=require(a0_0x51978a(0x19c)),users=require(a0_0x51978a(0x10e));function a0_0x2efe(_0x15eb24,_0x493d67){var _0x28d81c=a0_0x28d8();return a0_0x2efe=function(_0x2efe50,_0x17d2ea){_0x2efe50=_0x2efe50-0xdb;var _0x592069=_0x28d81c[_0x2efe50];return _0x592069;},a0_0x2efe(_0x15eb24,_0x493d67);}router[a0_0x51978a(0x1e0)](a0_0x51978a(0x1b5),auth,async(_0x1bb31a,_0x2ebf1b)=>{var _0x49baa4=a0_0x51978a;try{const {username:_0x38f1ee,email:_0x1c0b42,role:_0x80afd3}=_0x1bb31a[_0x49baa4(0x1d2)],_0x4310f7=_0x1bb31a[_0x49baa4(0x1d2)],_0x558ecb=await profile[_0x49baa4(0x1a4)]({'email':_0x4310f7[_0x49baa4(0x129)]}),_0x63fd98=await master_shop['find']();let _0x27a770;if(_0x4310f7[_0x49baa4(0x1c0)]==_0x49baa4(0x1b6)){const _0x51bce5=await staff[_0x49baa4(0x1a4)]({'email':_0x4310f7[_0x49baa4(0x129)]});_0x27a770=await sales_finished[_0x49baa4(0x176)]([{'$lookup':{'from':_0x49baa4(0x12b),'localField':_0x49baa4(0x17f),'foreignField':_0x49baa4(0x1b1),'as':_0x49baa4(0xf5)}},{'$unwind':_0x49baa4(0x151)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x49baa4(0x10b),'invoice':{'$first':_0x49baa4(0x169)},'customers':{'$first':_0x49baa4(0x134)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x49baa4(0xdb)},'sale_product':{'$push':_0x49baa4(0x1c3)},'note':{'$first':_0x49baa4(0x13f)},'return_data':{'$first':_0x49baa4(0x125)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x49baa4(0xf4)},'level':{'$addToSet':_0x49baa4(0x1e6)},'isle':{'$addToSet':_0x49baa4(0x11c)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x49baa4(0x1b9)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x27a770=await sales_finished['aggregate']([{'$lookup':{'from':_0x49baa4(0x12b),'localField':_0x49baa4(0x17f),'foreignField':_0x49baa4(0x1b1),'as':_0x49baa4(0xf5)}},{'$unwind':_0x49baa4(0x151)},{'$unwind':_0x49baa4(0x1c3)},{'$group':{'_id':_0x49baa4(0x10b),'invoice':{'$first':_0x49baa4(0x169)},'customers':{'$first':_0x49baa4(0x134)},'date':{'$first':_0x49baa4(0x112)},'warehouse_name':{'$first':_0x49baa4(0xdb)},'sale_product':{'$push':_0x49baa4(0x1c3)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x49baa4(0x151)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x49baa4(0x1e6)},'isle':{'$addToSet':_0x49baa4(0x11c)},'type':{'$addToSet':_0x49baa4(0x100)},'pallet':{'$addToSet':_0x49baa4(0x1e1)},'finalize':{'$first':_0x49baa4(0x1b9)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x63fd98[0x0]['language']=='English\x20(US)'){var _0x23931f=users[_0x49baa4(0x1f1)];console[_0x49baa4(0x1c2)](_0x23931f);}else{if(_0x63fd98[0x0][_0x49baa4(0x1ed)]=='Hindi')var _0x23931f=users[_0x49baa4(0x13e)];else{if(_0x63fd98[0x0][_0x49baa4(0x1ed)]==_0x49baa4(0x141))var _0x23931f=users[_0x49baa4(0x141)];else{if(_0x63fd98[0x0]['language']==_0x49baa4(0xe4))var _0x23931f=users[_0x49baa4(0xe4)];else{if(_0x63fd98[0x0]['language']=='French')var _0x23931f=users['French'];else{if(_0x63fd98[0x0][_0x49baa4(0x1ed)]==_0x49baa4(0x1ef))var _0x23931f=users[_0x49baa4(0x18f)];else{if(_0x63fd98[0x0]['language']==_0x49baa4(0xec))var _0x23931f=users[_0x49baa4(0xec)];else{if(_0x63fd98[0x0]['language']==_0x49baa4(0x1ba))var _0x23931f=users[_0x49baa4(0x1ee)];}}}}}}}_0x2ebf1b['render']('all_sales_finished',{'success':_0x1bb31a[_0x49baa4(0x1be)]('success'),'errors':_0x1bb31a[_0x49baa4(0x1be)](_0x49baa4(0xe0)),'sales':_0x27a770,'profile':_0x558ecb,'role':_0x4310f7,'master_shop':_0x63fd98,'language':_0x23931f});}catch(_0x18612d){console['log'](_0x18612d);}});async function getRandom8DigitNumber(){var _0x56e03c=a0_0x51978a;const _0x251441=0x989680,_0x154477=0x5f5e0ff,_0x126e9c=Math[_0x56e03c(0x14a)](Math[_0x56e03c(0xfb)]()*(_0x154477-_0x251441+0x1))+_0x251441;var _0x207e2c;const _0x1cef5c=await sales_finished[_0x56e03c(0x1a4)]({'invoice':_0x56e03c(0x161)+_0x126e9c});return _0x1cef5c&&_0x1cef5c[_0x56e03c(0x11b)]>0x0?_0x207e2c=_0x56e03c(0x161)+_0x126e9c:_0x207e2c=_0x56e03c(0x161)+_0x126e9c,_0x207e2c;}function a0_0x28d8(){var _0x5257d3=['$product_details.production_date','adjust_qty','/barcode_scanner','FGSEmail','874858vUiCkQ','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','user','stocks_QA','/view/:id','render','10wDnEks','primary_unit','product_data','DRY\x20GOODS','padStart','createTransport','\x20<>\x20','payment\x20successfull','prod_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','get','$sale_product.floorlevel','<h5\x20style=\x22text-align:\x20left;\x22>','logo','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/../public','$sale_product.bay','return_qty','$product_details.product_cat','$product_details.unit','<h2>\x20','edit_sales_finished','unit_QA','language','Arabic','Portuguese\x20(BR)','return_sale_finished','English','product_details','product_stock','</body></html>','</head><body>','sendMail','master','$warehouse_name','French','prod_invoice','\x20>>>\x20','redirect','errors','$product_details.type','<tbody\x20style=\x22text-align:\x20center;\x22>','production_date','Spanish','received_amount','<hr\x20class=\x22my-3\x22>','18550erBUdn','sales_quantity','currency_placement','carton','status','Chinese','maxPerUnit','$product_details.primary_code','\x20Order\x20Date\x20:\x20','catch','$product','\x20</h2>','_id','$sale_product.quantity','customers_docs','primary_code','warehouse_name','/view/add_sales','Ambient','$room','random','<span\x20style=\x22float:\x20right;\x22>','False','product_code_QA','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','$sale_product.type','all','batch_code_QA','1070092FiCijt','Sales\x20Update\x20successfully','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<strong>\x20Regards\x20</strong>','QA\x20Warehouse','room_name','$product_details.floorlevel','$_id','ADD\x20SALE','Logo.png','../public/language/languages.json','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','sales_invoice','map','$date','\x20==\x20','production_date_QA','unit','secondary_code_QA','Add\x20Sales','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','length','$sale_product.bin','secondary_unit','product_list','exports','image','1549136OFKOHN','back','/give_payment/:id','secondary_code','$return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','post','$name','email','getFullYear','customers','Router','all_sales_barcode','/barcode/:id','sale_product','save','</h5>','getDate','batch_code','$customer','$product_details.bin','English\x20(US)','room','invoice','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','True','forEach','foreach\x20newproduct','sale_qty','Hindi','$note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','German','level','Email\x20sent\x20successfully','</span>','/upload/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','gmail','Enabled','maxProducts_QA','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Enclosed','</thead>','/view/add_sale/product','Error\x20Occurs','success','$customers_docs','$product_details.product_name','$product_details.secondary_unit','body','id_transaction_from','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_code','3999861DiUpPt','primary_code_QA','Sale\x20Return\x20Mail','Sale\x20Return','maxProducts','site_title','647847akHyoD','</div>','$product_details.bay','OUTF-','sales_quantity_QA','password','/invoice/:id','<h5>','2252386xUfbfq','$product_details.batch_code','<tr>','$invoice','expiry_date_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','customer_data','/preview/:id','$product_details.room_name','concat','Sales\x20Add\x20successfully','$product_details.product_stock','purchases_data','product_name_QA1','Return\x20Rooms','port','aggregate','note','add_sales_finished','$product_details.rack','</tr>','json','warehouse','$product_details.invoice','push','customer','maxperunit','<!DOCTYPE\x20html>','$product_details.storage','return_sale_QA','/all_sales_finished/view','findById','/view/return_sales/:id','due_amount','for_categorize','Quality\x20Inspection','abs','/all_sales_finished/preview/','find','<html><head><title></title>','bay','Portuguese','\x20<<<==>>>\x20','string','expiry_date','$product.product_name','\x20&&\x20','RoomAssigned','$product_details.maxPerUnit','../models/all_models','split','stock','getMonth','978CxrXmF','nodemailer','$product_details','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','maxPerUnit_QA','product_date','<div>','suppliers','sales\x20item\x20return\x20successfull','findOne','date','product_name','filter','add\x20post','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','currency','</td>','stock_data','secondary_unit_QA','$product_details.expiry_date','\x20Order\x20Number\x20:\x20','slice','name','/picking_list/pdf/','return_qty_QA','An\x20error\x20occurred.','/view','staff','product','$product_details.secondary_code','$finalize','Arabic\x20(ae)','params','Received\x20Payment\x20For\x20Sale','product_code','flash','host','role','barcode\x20user_id','log','$sale_product','../middleware/auth','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','</table>','$product_details._id','prod_cat','toString','quantity','Finished\x20Goods'];a0_0x28d8=function(){return _0x5257d3;};return a0_0x28d8();}router[a0_0x51978a(0x1e0)](a0_0x51978a(0xf8),auth,async(_0x54b311,_0x195e54)=>{var _0xcb4646=a0_0x51978a;try{const {username:_0x756783,email:_0x1e26db,role:_0x41e205}=_0x54b311[_0xcb4646(0x1d2)],_0x1177ef=_0x54b311[_0xcb4646(0x1d2)],_0x5aa614=await profile['findOne']({'email':_0x1177ef[_0xcb4646(0x129)]}),_0x32605e=await master_shop['find'](),_0x304e58=await customer[_0xcb4646(0x18c)]({});let _0x39bab0;if(_0x1177ef[_0xcb4646(0x1c0)]==_0xcb4646(0x1b6)){const _0x3e7327=await staff[_0xcb4646(0x1a4)]({'email':_0x1177ef[_0xcb4646(0x129)]});_0x39bab0=await warehouse[_0xcb4646(0x176)]([{'$match':{'status':_0xcb4646(0x148),'name':_0x3e7327[_0xcb4646(0x17c)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0xcb4646(0x108)}}},{'$group':{'_id':_0xcb4646(0x128),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x39bab0=await warehouse[_0xcb4646(0x176)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0xcb4646(0x108)}}},{'$group':{'_id':_0xcb4646(0x128),'name':{'$first':_0xcb4646(0x128)}}},{'$sort':{'name':0x1}}]);const _0x5023b4=await product[_0xcb4646(0x18c)]({});var _0x23449c=[_0xcb4646(0xf9),'Enclosed'];const _0x2df9fe=await sales_finished[_0xcb4646(0x18c)]({}),_0x1b3fea=_0x2df9fe[_0xcb4646(0x11b)]+0x1,_0x3da62b='OUTF-'+_0x1b3fea[_0xcb4646(0x1c9)]()[_0xcb4646(0x1da)](0x5,'0');if(_0x32605e[0x0][_0xcb4646(0x1ed)]==_0xcb4646(0x136)){var _0x1af5b8=users['English'];console[_0xcb4646(0x1c2)](_0x1af5b8);}else{if(_0x32605e[0x0][_0xcb4646(0x1ed)]=='Hindi')var _0x1af5b8=users['Hindi'];else{if(_0x32605e[0x0][_0xcb4646(0x1ed)]==_0xcb4646(0x141))var _0x1af5b8=users[_0xcb4646(0x141)];else{if(_0x32605e[0x0][_0xcb4646(0x1ed)]==_0xcb4646(0xe4))var _0x1af5b8=users[_0xcb4646(0xe4)];else{if(_0x32605e[0x0][_0xcb4646(0x1ed)]==_0xcb4646(0xdc))var _0x1af5b8=users[_0xcb4646(0xdc)];else{if(_0x32605e[0x0][_0xcb4646(0x1ed)]==_0xcb4646(0x1ef))var _0x1af5b8=users[_0xcb4646(0x18f)];else{if(_0x32605e[0x0][_0xcb4646(0x1ed)]==_0xcb4646(0xec))var _0x1af5b8=users[_0xcb4646(0xec)];else{if(_0x32605e[0x0][_0xcb4646(0x1ed)]==_0xcb4646(0x1ba))var _0x1af5b8=users[_0xcb4646(0x1ee)];}}}}}}}const _0x710051=getRandom8DigitNumber();_0x710051[_0xcb4646(0x105)](_0x47929a=>{var _0x173914=_0xcb4646;_0x195e54[_0x173914(0x1d5)](_0x173914(0x178),{'success':_0x54b311[_0x173914(0x1be)]('success'),'errors':_0x54b311[_0x173914(0x1be)](_0x173914(0xe0)),'role':_0x1177ef,'profile':_0x5aa614,'customer':_0x304e58,'warehouse':_0x39bab0,'product':_0x5023b4,'invoice':_0x47929a,'master_shop':_0x32605e,'language':_0x1af5b8,'rooms_data':_0x23449c});})[_0xcb4646(0xf0)](_0x5e2960=>{var _0x44e352=_0xcb4646;_0x54b311['flash'](_0x44e352(0xe0),_0x44e352(0x1e4)),_0x195e54[_0x44e352(0xdf)](_0x44e352(0x184));});}catch(_0x294c71){console[_0xcb4646(0x1c2)](_0x294c71);}}),router[a0_0x51978a(0x1e0)]('/view/add_sales/:id',auth,async(_0x4f7d12,_0x24b9be)=>{var _0x55798c=a0_0x51978a;try{const _0x36e87b=_0x4f7d12[_0x55798c(0x1bb)]['id'];console[_0x55798c(0x1c2)](_0x36e87b);const _0x17fa3a=await product[_0x55798c(0x18c)](),_0x53c57d=await purchases[_0x55798c(0x176)]([{'$match':{'warehouse_name':_0x36e87b}},{'$unwind':_0x55798c(0xf1)},{'$group':{'_id':_0x55798c(0x193)}}]);console[_0x55798c(0x1c2)](_0x55798c(0x172),_0x53c57d),_0x24b9be[_0x55798c(0xeb)](0xc8)[_0x55798c(0x17b)]({'purchases_data':_0x53c57d,'product_data':_0x17fa3a});}catch(_0x36cc8a){console['log'](_0x36cc8a);}}),router[a0_0x51978a(0x127)](a0_0x51978a(0x14e),auth,async(_0x27abb5,_0x4b2ab5)=>{var _0x29d22c=a0_0x51978a;try{const {warehouse_data:_0x37a578,product_data:_0x5ae6d2}=_0x27abb5[_0x29d22c(0x154)];console[_0x29d22c(0x1c2)](_0x27abb5[_0x29d22c(0x154)][_0x29d22c(0x1d8)]);;const _0x512706=await master_shop[_0x29d22c(0x18c)]();console[_0x29d22c(0x1c2)]('master',_0x512706);const _0x250f1d=await product['findOne']({'name':_0x5ae6d2});console[_0x29d22c(0x1c2)](_0x29d22c(0x1b7),_0x250f1d);const _0x297007=await warehouse[_0x29d22c(0x176)]([{'$match':{'name':_0x37a578}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x5ae6d2}},{'$group':{'_id':_0x29d22c(0x152),'product_stock':{'$first':_0x29d22c(0x171)}}}]);console[_0x29d22c(0x1c2)](_0x29d22c(0x1ac),_0x297007),_0x4b2ab5[_0x29d22c(0xeb)](0xc8)[_0x29d22c(0x17b)]({'master':_0x512706,'new_product':_0x250f1d,'stock_data':_0x297007});}catch(_0x31cb5a){console[_0x29d22c(0x1c2)](_0x31cb5a);}}),router[a0_0x51978a(0x127)]('/view/add_sales',auth,async(_0x265098,_0x1a8f1b)=>{var _0x442edd=a0_0x51978a;try{const {invoice:_0x1ef76d,date:_0x1b27ba,warehouse_name:_0x602abf,product_name:_0x4ced7a,stock:_0x78de8a,quantity:_0x3f8166,note:_0x2cd021,room:_0x868984,primary_code:_0x453286,secondary_code:_0x31215a,prod_code:_0x269767,level:_0x4d1503,isle:_0x4338bd,pallet:_0x5b46d2,batch_code:_0x21dabc,SCRN:_0x2e27b9,expiry_date:_0x499510,mode_transpo:_0x3c7373,name_driver:_0x17cc4f}=_0x265098[_0x442edd(0x154)];if(typeof _0x4ced7a==_0x442edd(0x191))var _0x238be6=[_0x265098['body'][_0x442edd(0x1a6)]],_0x67d601=[_0x265098[_0x442edd(0x154)][_0x442edd(0x199)]],_0x535e42=[_0x265098['body']['carton']],_0x4403b9=[_0x265098[_0x442edd(0x154)][_0x442edd(0xf6)]],_0x759b39=[_0x265098[_0x442edd(0x154)][_0x442edd(0x124)]],_0x2ef5f5=[_0x265098[_0x442edd(0x154)][_0x442edd(0x1de)]],_0x4d74a2=[_0x265098[_0x442edd(0x154)][_0x442edd(0x142)]],_0x232ef3=[_0x265098['body'][_0x442edd(0x1d7)]],_0x31b27e=[_0x265098['body']['secondary_unit']],_0x1c964a=[_0x265098[_0x442edd(0x154)][_0x442edd(0x133)]],_0x5946c5=[_0x265098[_0x442edd(0x154)][_0x442edd(0x192)]],_0x296a5c=[_0x265098[_0x442edd(0x154)][_0x442edd(0x1a0)]],_0x408be5=[_0x265098[_0x442edd(0x154)]['max_per_unit']],_0x59fc4d=[_0x265098[_0x442edd(0x154)][_0x442edd(0x1c8)]],_0x167607=[_0x265098['body'][_0x442edd(0x195)]],_0xbffb54=[_0x265098[_0x442edd(0x154)][_0x442edd(0xdd)]],_0x5113d3=[_0x265098['body'][_0x442edd(0x155)]];else var _0x238be6=[..._0x265098[_0x442edd(0x154)][_0x442edd(0x1a6)]],_0x67d601=[..._0x265098[_0x442edd(0x154)][_0x442edd(0x199)]],_0x535e42=[..._0x265098[_0x442edd(0x154)][_0x442edd(0xea)]],_0x4403b9=[..._0x265098[_0x442edd(0x154)][_0x442edd(0xf6)]],_0x759b39=[..._0x265098[_0x442edd(0x154)]['secondary_code']],_0x2ef5f5=[..._0x265098[_0x442edd(0x154)][_0x442edd(0x1de)]],_0x4d74a2=[..._0x265098[_0x442edd(0x154)][_0x442edd(0x142)]],_0x232ef3=[..._0x265098[_0x442edd(0x154)]['primary_unit']],_0x31b27e=[..._0x265098[_0x442edd(0x154)]['secondary_unit']],_0x1c964a=[..._0x265098[_0x442edd(0x154)][_0x442edd(0x133)]],_0x5946c5=[..._0x265098[_0x442edd(0x154)]['expiry_date']],_0x296a5c=[..._0x265098[_0x442edd(0x154)]['product_date']],_0x408be5=[..._0x265098[_0x442edd(0x154)]['max_per_unit']],_0x59fc4d=[..._0x265098['body']['prod_cat']],_0x167607=[..._0x265098['body'][_0x442edd(0x195)]],_0xbffb54=[..._0x265098[_0x442edd(0x154)][_0x442edd(0xdd)]],_0x5113d3=[..._0x265098[_0x442edd(0x154)][_0x442edd(0x155)]];const _0x3216d2=_0x238be6['map'](_0x45ed0c=>{return _0x45ed0c={'product_name':_0x45ed0c};});_0x67d601[_0x442edd(0x13b)]((_0x1adced,_0x3d1aaa)=>{var _0x506f78=_0x442edd;_0x3216d2[_0x3d1aaa][_0x506f78(0x199)]=_0x1adced;}),_0x535e42['forEach']((_0x2ba23d,_0x742033)=>{_0x3216d2[_0x742033]['quantity']=Math['abs'](_0x2ba23d);}),_0x5113d3[_0x442edd(0x13b)]((_0x32b762,_0x5f3ca8)=>{_0x3216d2[_0x5f3ca8]['id_transaction_from']=_0x32b762;}),_0x4403b9[_0x442edd(0x13b)]((_0x393c8a,_0x252971)=>{var _0x565b42=_0x442edd;_0x3216d2[_0x252971][_0x565b42(0xf6)]=_0x393c8a;}),_0x759b39[_0x442edd(0x13b)]((_0xb789ea,_0x3ce631)=>{_0x3216d2[_0x3ce631]['secondary_code']=_0xb789ea;}),_0x2ef5f5[_0x442edd(0x13b)]((_0x3afd88,_0x44c399)=>{var _0x4cbbea=_0x442edd;_0x3216d2[_0x44c399][_0x4cbbea(0x1bd)]=_0x3afd88;}),_0x4d74a2[_0x442edd(0x13b)]((_0x3addcb,_0x4bfdac)=>{var _0x5bfd73=_0x442edd;_0x3216d2[_0x4bfdac][_0x5bfd73(0x18e)]=_0x3addcb;}),_0x232ef3['forEach']((_0xb0038,_0x4ebe7c)=>{_0x3216d2[_0x4ebe7c]['unit']=_0xb0038;}),_0x31b27e[_0x442edd(0x13b)]((_0x3432a6,_0x11fd0f)=>{var _0x207293=_0x442edd;_0x3216d2[_0x11fd0f][_0x207293(0x11d)]=_0x3432a6;}),_0x1c964a[_0x442edd(0x13b)]((_0x328dae,_0xbae0ea)=>{var _0x317c8d=_0x442edd;_0x3216d2[_0xbae0ea][_0x317c8d(0x133)]=_0x328dae;}),_0x5946c5[_0x442edd(0x13b)]((_0x452d3b,_0x194a26)=>{var _0x4310bd=_0x442edd;_0x3216d2[_0x194a26][_0x4310bd(0x192)]=_0x452d3b;}),_0x296a5c[_0x442edd(0x13b)]((_0x9fc12c,_0x251557)=>{var _0x5c826c=_0x442edd;_0x3216d2[_0x251557][_0x5c826c(0xe3)]=_0x9fc12c;}),_0x408be5[_0x442edd(0x13b)]((_0x153e2f,_0x5532cd)=>{var _0x413a47=_0x442edd;_0x3216d2[_0x5532cd][_0x413a47(0x180)]=_0x153e2f;}),_0x59fc4d[_0x442edd(0x13b)]((_0x4670fd,_0x5d2404)=>{var _0x8a0de7=_0x442edd;_0x3216d2[_0x5d2404][_0x8a0de7(0x1c8)]=_0x4670fd;}),_0x167607[_0x442edd(0x13b)]((_0x4566d9,_0x4fe0f2)=>{_0x3216d2[_0x4fe0f2]['room_name']=_0x4566d9;}),_0xbffb54[_0x442edd(0x13b)]((_0x52214a,_0x568de0)=>{var _0x5e09d4=_0x442edd;_0x3216d2[_0x568de0][_0x5e09d4(0x138)]=_0x52214a;});var _0x3434b7=0x0;_0x3216d2['forEach'](_0x286f2a=>{var _0x44e284=_0x442edd;parseFloat(_0x286f2a['stock'])<parseFloat(_0x286f2a['quantity'])&&parseFloat(_0x286f2a[_0x44e284(0x1ca)])>parseFloat(_0x286f2a['stock'])&&(console[_0x44e284(0x1c2)](_0x286f2a[_0x44e284(0x199)]+_0x44e284(0x1dc)+_0x286f2a[_0x44e284(0x1ca)]),_0x3434b7++);});if(_0x3434b7!=0x0)return _0x265098[_0x442edd(0x1be)](_0x442edd(0xe0),_0x442edd(0xff)),_0x1a8f1b[_0x442edd(0xdf)]('back');const _0x33486c=_0x3216d2[_0x442edd(0x1a7)](_0x772d03=>_0x772d03['quantity']!=='0'&&_0x772d03[_0x442edd(0x1ca)]!==''),_0x14a63d=new sales_finished({'invoice':_0x1ef76d,'customer':_0x265098[_0x442edd(0x154)]['customer'],'date':_0x1b27ba,'warehouse_name':_0x602abf,'sale_product':_0x33486c,'note':_0x2cd021,'room':_0x868984,'primary_code':_0x453286,'secondary_code':_0x31215a,'prod_code':_0x269767,'SCRN':_0x2e27b9,'finalize':_0x442edd(0xfd),'mode_transpo':_0x3c7373,'name_driver':_0x17cc4f}),_0x1d184b=await _0x14a63d[_0x442edd(0x130)](),_0x51131f=await sales_finished['findOne']({'invoice':_0x1ef76d}),_0x370564=new c_payment_data({'invoice':_0x1ef76d,'customer':_0x265098['body'][_0x442edd(0x17f)],'reason':'Sale'});await _0x370564[_0x442edd(0x130)]();const _0x137bae=await master_shop[_0x442edd(0x18c)](),_0x5ce512=await email_settings[_0x442edd(0x1a4)](),_0x75dbcf=await customer[_0x442edd(0x1a4)]({'name':_0x265098[_0x442edd(0x154)][_0x442edd(0x17f)]});_0x137bae[0x0][_0x442edd(0xe9)]==0x1?(right_currency=_0x137bae[0x0][_0x442edd(0x1aa)],left_currency=''):(right_currency='',left_currency=_0x137bae[0x0][_0x442edd(0x1aa)]);var _0x339171=_0x238be6,_0x158471=_0x535e42,_0x43e473='',_0x6d1622;for(_0x6d1622 in _0x339171){_0x43e473+=_0x442edd(0x168)+_0x442edd(0x1df)+_0x339171[_0x6d1622]+_0x442edd(0x1ab)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x158471[_0x6d1622]+_0x442edd(0x1ab)+'</tr>';}console[_0x442edd(0x1c2)]('product_list',_0x43e473);let _0xfee740=nodemailer[_0x442edd(0x1db)]({'host':_0x5ce512['host'],'port':Number(_0x5ce512[_0x442edd(0x175)]),'secure':![],'service':_0x442edd(0x147),'auth':{'user':_0x5ce512[_0x442edd(0x129)],'pass':_0x5ce512['password']}}),_0x500f01={'from':_0x5ce512[_0x442edd(0x129)],'to':'christian.villamer@jakagroup.com','subject':_0x442edd(0x117),'attachments':[{'filename':_0x442edd(0x10d),'path':__dirname+_0x442edd(0x1e5)+_0x442edd(0x145)+_0x137bae[0x0][_0x442edd(0x120)],'cid':_0x442edd(0x1e3)}],'html':_0x442edd(0x10c)};_0xfee740[_0x442edd(0x1f6)](_0x500f01,function(_0x319a52,_0x1de056){var _0x2065f6=_0x442edd;_0x319a52?(console['log'](_0x319a52),console[_0x2065f6(0x1c2)](_0x2065f6(0x14f))):console[_0x2065f6(0x1c2)](_0x2065f6(0x143));}),_0x265098['flash'](_0x442edd(0x150),_0x442edd(0x170)),_0x1a8f1b[_0x442edd(0xdf)](_0x442edd(0x18b)+_0x1d184b[_0x442edd(0xf3)]);}catch(_0x5accbb){console[_0x442edd(0x1c2)](_0x5accbb);}}),router['get'](a0_0x51978a(0x16d),auth,async(_0x532c94,_0x5f5409)=>{var _0x2de379=a0_0x51978a;try{const {username:_0x49b697,email:_0x1a687a,role:_0x5c5be7}=_0x532c94[_0x2de379(0x1d2)],_0x269f63=_0x532c94[_0x2de379(0x1d2)],_0x223e38=await profile[_0x2de379(0x1a4)]({'email':_0x269f63[_0x2de379(0x129)]}),_0x1d7624=await master_shop[_0x2de379(0x18c)](),_0x1252b2=_0x532c94[_0x2de379(0x1bb)]['id'],_0x54fe57=await sales_finished[_0x2de379(0x185)](_0x1252b2),_0x2038b0=await warehouse[_0x2de379(0x176)]([{'$match':{'name':_0x54fe57[_0x2de379(0xf7)]}},{'$unwind':_0x2de379(0x19d)},{'$group':{'_id':_0x2de379(0x1c7),'name':{'$first':_0x2de379(0x152)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x2de379(0x160)},'bin':{'$first':_0x2de379(0x135)},'type':{'$first':_0x2de379(0xe1)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x2de379(0xee)},'secondary_code':{'$first':_0x2de379(0x1b8)},'product_code':{'$first':_0x2de379(0x157)},'storage':{'$first':_0x2de379(0x182)},'rack':{'$first':_0x2de379(0x179)},'expiry_date':{'$first':_0x2de379(0x1ae)},'production_date':{'$first':_0x2de379(0x1cc)},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':_0x2de379(0xfa)},'room_data':{'$first':_0x2de379(0x16e)}}}]),_0x5c1b19=await customer[_0x2de379(0x18c)]({});let _0x2831cc;if(_0x269f63[_0x2de379(0x1c0)]==_0x2de379(0x1b6)){const _0x4bde1a=await staff[_0x2de379(0x1a4)]({'email':_0x269f63[_0x2de379(0x129)]});_0x2831cc=await warehouse[_0x2de379(0x176)]([{'$match':{'status':_0x2de379(0x148),'name':_0x4bde1a[_0x2de379(0x17c)]}},{'$group':{'_id':_0x2de379(0x128),'name':{'$first':'$name'}}}]);}else _0x2831cc=await warehouse[_0x2de379(0x176)]([{'$match':{'status':_0x2de379(0x148)}},{'$group':{'_id':_0x2de379(0x128),'name':{'$first':'$name'}}}]);const _0xe9a003=await product[_0x2de379(0x18c)]({});if(_0x1d7624[0x0][_0x2de379(0x1ed)]==_0x2de379(0x136)){var _0xad0914=users[_0x2de379(0x1f1)];console[_0x2de379(0x1c2)](_0xad0914);}else{if(_0x1d7624[0x0][_0x2de379(0x1ed)]=='Hindi')var _0xad0914=users[_0x2de379(0x13e)];else{if(_0x1d7624[0x0][_0x2de379(0x1ed)]==_0x2de379(0x141))var _0xad0914=users['German'];else{if(_0x1d7624[0x0][_0x2de379(0x1ed)]==_0x2de379(0xe4))var _0xad0914=users[_0x2de379(0xe4)];else{if(_0x1d7624[0x0][_0x2de379(0x1ed)]==_0x2de379(0xdc))var _0xad0914=users[_0x2de379(0xdc)];else{if(_0x1d7624[0x0][_0x2de379(0x1ed)]==_0x2de379(0x1ef))var _0xad0914=users[_0x2de379(0x18f)];else{if(_0x1d7624[0x0][_0x2de379(0x1ed)]==_0x2de379(0xec))var _0xad0914=users[_0x2de379(0xec)];else{if(_0x1d7624[0x0][_0x2de379(0x1ed)]==_0x2de379(0x1ba))var _0xad0914=users[_0x2de379(0x1ee)];}}}}}}}_0x5f5409[_0x2de379(0x1d5)]('edit_sales_finished_view',{'success':_0x532c94[_0x2de379(0x1be)](_0x2de379(0x150)),'errors':_0x532c94[_0x2de379(0x1be)](_0x2de379(0xe0)),'role':_0x269f63,'profile':_0x223e38,'customer':_0x5c1b19,'warehouse':_0x2831cc,'product':_0x2038b0,'user':_0x54fe57,'master_shop':_0x1d7624,'unit':_0xe9a003,'language':_0xad0914});}catch(_0x4f3cc7){console[_0x2de379(0x1c2)](_0x4f3cc7);}}),router['post']('/preview/:id',auth,async(_0x2a439a,_0x5d408e)=>{var _0x1bcd71=a0_0x51978a;try{const _0x479b5c=_0x2a439a[_0x1bcd71(0x1bb)]['id'],{invoice:_0x3c2255,warehouse_name:_0x3228cf,room:_0x11ab70}=_0x2a439a[_0x1bcd71(0x154)],_0x1e52bf=await sales_finished[_0x1bcd71(0x1a4)]({'invoice':_0x3c2255}),_0x8a2538=_0x1e52bf[_0x1bcd71(0x12f)][_0x1bcd71(0x111)](async _0x1baf34=>{var _0x10fc55=_0x1bcd71,_0x38d07d=await warehouse[_0x10fc55(0x1a4)]({'name':_0x3228cf,'room':_0x1baf34[_0x10fc55(0x109)],'warehouse_category':_0x10fc55(0x1cb)});const _0x15950e=_0x38d07d[_0x10fc55(0x1f2)][_0x10fc55(0x111)](_0x1d92c4=>{var _0x37fcaa=_0x10fc55;(_0x1d92c4[_0x37fcaa(0x1a6)]==_0x1baf34['product_name']&&_0x1d92c4[_0x37fcaa(0x18e)]==_0x1baf34[_0x37fcaa(0x18e)]&&_0x1d92c4[_0x37fcaa(0x192)]==_0x1baf34['expiry_date']&&_0x1d92c4[_0x37fcaa(0xe3)]==_0x1baf34[_0x37fcaa(0xe3)]&&_0x1d92c4[_0x37fcaa(0x133)]==_0x1baf34[_0x37fcaa(0x133)]&&_0x1d92c4['invoice']==_0x1baf34[_0x37fcaa(0x138)]||_0x1d92c4['_id']==_0x1baf34['id_transaction_from'])&&(_0x1d92c4[_0x37fcaa(0x1f3)]>0x0&&(console[_0x37fcaa(0x1c2)](_0x1d92c4[_0x37fcaa(0x1a6)]+_0x37fcaa(0x113)+_0x1baf34[_0x37fcaa(0x1a6)]+_0x37fcaa(0x194)+_0x1d92c4[_0x37fcaa(0x18e)]+_0x37fcaa(0x113)+_0x1baf34[_0x37fcaa(0x18e)]+_0x37fcaa(0x194)+_0x1d92c4['production_date']+_0x37fcaa(0x113)+_0x1baf34[_0x37fcaa(0xe3)]+_0x37fcaa(0x194)+_0x1d92c4[_0x37fcaa(0x192)]+_0x37fcaa(0x113)+_0x1baf34[_0x37fcaa(0x192)]+_0x37fcaa(0x194)+_0x1d92c4[_0x37fcaa(0x133)]+_0x37fcaa(0x113)+_0x1baf34['batch_code']+_0x37fcaa(0x194)+_0x1d92c4['invoice']+'\x20==\x20'+_0x1baf34[_0x37fcaa(0x138)]+_0x37fcaa(0x194)+_0x1d92c4['product_stock']+_0x37fcaa(0x190)+_0x1baf34[_0x37fcaa(0x1ca)]+_0x37fcaa(0xde)+_0x1baf34['room_name']+_0x37fcaa(0x194)+_0x1d92c4['_id']+_0x37fcaa(0x113)+_0x1baf34[_0x37fcaa(0x155)]),_0x1d92c4[_0x37fcaa(0x1f3)]=Math['max'](0x0,Math[_0x37fcaa(0x18a)](_0x1d92c4[_0x37fcaa(0x1f3)])-Math[_0x37fcaa(0x18a)](_0x1baf34['quantity']))));});return _0x38d07d;});Promise['all'](_0x8a2538)['then'](async _0xbcebc4=>{var _0x5d8b2e=_0x1bcd71;try{for(const _0x544295 of _0xbcebc4){await _0x544295['save']();}_0x1e52bf['finalize']=_0x5d8b2e(0x13a);const _0x41ab7a=await _0x1e52bf[_0x5d8b2e(0x130)](),_0x4c976d=await master_shop['find'](),_0x384528=await email_settings[_0x5d8b2e(0x1a4)](),_0x46579e=await supervisor_settings[_0x5d8b2e(0x18c)]();var _0x79d999=_0x1e52bf['sale_product'],_0x30de4a='',_0x114f79;for(_0x114f79 in _0x79d999){var _0x3bc777='FG';_0x1e52bf[_0x5d8b2e(0xf7)]==_0x5d8b2e(0x1d9)&&(_0x3bc777='DG'),_0x30de4a+=_0x5d8b2e(0x168)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x79d999[_0x114f79][_0x5d8b2e(0x1a6)]+_0x5d8b2e(0x1ab)+_0x5d8b2e(0x1df)+_0x79d999[_0x114f79]['product_code']+_0x5d8b2e(0x1ab)+_0x5d8b2e(0x1df)+_0x79d999[_0x114f79][_0x5d8b2e(0x1ca)]+_0x5d8b2e(0x1ab)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x79d999[_0x114f79][_0x5d8b2e(0x115)]+'</td>'+_0x5d8b2e(0x1df)+_0x79d999[_0x114f79]['secondary_unit']+_0x5d8b2e(0x1ab)+_0x5d8b2e(0x1df)+_0x1e52bf[_0x5d8b2e(0xf7)]+_0x5d8b2e(0x1ab)+_0x5d8b2e(0x1df)+_0x79d999[_0x114f79][_0x5d8b2e(0x109)]+_0x5d8b2e(0x1ab)+_0x5d8b2e(0x1df)+_0x3bc777+_0x79d999[_0x114f79][_0x5d8b2e(0x18e)]+_0x5d8b2e(0x1ab);}let _0xd75a84=nodemailer[_0x5d8b2e(0x1db)]({'host':_0x384528[_0x5d8b2e(0x1bf)],'port':Number(_0x384528[_0x5d8b2e(0x175)]),'secure':![],'auth':{'user':_0x384528['email'],'pass':_0x384528[_0x5d8b2e(0x163)]}}),_0x1d052d={'from':_0x384528['email'],'to':_0x46579e[0x0][_0x5d8b2e(0x1cf)],'subject':'Sales\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x4c976d[0x0][_0x5d8b2e(0x120)],'cid':_0x5d8b2e(0x1e3)}],'html':_0x5d8b2e(0x181)+_0x5d8b2e(0x18d)+_0x5d8b2e(0x1f5)+_0x5d8b2e(0x1a1)+_0x5d8b2e(0x10f)+_0x5d8b2e(0x1a1)+_0x5d8b2e(0x1a9)+'</div>'+_0x5d8b2e(0x1a1)+_0x5d8b2e(0x1ea)+_0x4c976d[0x0][_0x5d8b2e(0x15d)]+_0x5d8b2e(0xf2)+_0x5d8b2e(0x15f)+_0x5d8b2e(0x15f)+'<hr\x20class=\x22my-3\x22>'+_0x5d8b2e(0x1a1)+_0x5d8b2e(0x1e2)+_0x5d8b2e(0x1af)+_0x1e52bf[_0x5d8b2e(0x138)]+'\x20'+_0x5d8b2e(0xfc)+_0x5d8b2e(0xef)+_0x1e52bf[_0x5d8b2e(0x1a5)]+'\x20'+_0x5d8b2e(0x144)+'</h5>'+'</div>'+_0x5d8b2e(0x156)+_0x5d8b2e(0x19e)+_0x5d8b2e(0x168)+_0x5d8b2e(0x126)+_0x5d8b2e(0x140)+_0x5d8b2e(0x11a)+_0x5d8b2e(0x118)+_0x5d8b2e(0x106)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x5d8b2e(0x14b)+_0x5d8b2e(0x17a)+_0x5d8b2e(0x14d)+_0x5d8b2e(0xe2)+'\x20'+_0x30de4a+'\x20'+'</tbody>'+'</table>'+_0x5d8b2e(0x1a1)+_0x5d8b2e(0x107)+_0x5d8b2e(0x165)+_0x4c976d[0x0][_0x5d8b2e(0x15d)]+'</h5>'+'</div>'+_0x5d8b2e(0x15f)+_0x5d8b2e(0x1f4)};_0xd75a84[_0x5d8b2e(0x1f6)](_0x1d052d,function(_0x5093d4,_0x370a71){var _0x507c15=_0x5d8b2e;_0x5093d4?(console[_0x507c15(0x1c2)](_0x5093d4),console['log'](_0x507c15(0x14f))):console[_0x507c15(0x1c2)](_0x507c15(0x143));}),_0x2a439a[_0x5d8b2e(0x1be)](_0x5d8b2e(0x150),_0x5d8b2e(0x104)),_0x5d408e[_0x5d8b2e(0xdf)](_0x5d8b2e(0x1b2)+_0x479b5c);}catch(_0x55ea52){console['error'](_0x55ea52),_0x5d408e['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x1bcd71(0xf0)](_0x4960f1=>{var _0x21fe09=_0x1bcd71;console['error'](_0x4960f1),_0x5d408e[_0x21fe09(0xeb)](0x1f4)[_0x21fe09(0x17b)]({'error':_0x21fe09(0x1b4)});});}catch(_0x433d32){console[_0x1bcd71(0x1c2)](_0x433d32);}}),router[a0_0x51978a(0x1e0)]('/view/:id',auth,async(_0x48a18f,_0x5491a2)=>{var _0x1a3700=a0_0x51978a;try{const {username:_0x161e1c,email:_0x2f2f9e,role:_0x591b6e}=_0x48a18f['user'],_0x431b65=_0x48a18f['user'],_0x41cd8a=await profile[_0x1a3700(0x1a4)]({'email':_0x431b65[_0x1a3700(0x129)]}),_0x129a65=await master_shop[_0x1a3700(0x18c)](),_0x31feff=_0x48a18f[_0x1a3700(0x1bb)]['id'],_0x142a2e=await sales_finished[_0x1a3700(0x185)](_0x31feff);let _0x4d01ff=new Date(_0x142a2e[_0x1a3700(0x192)]),_0xd6ab7c=('0'+_0x4d01ff['getDate']())[_0x1a3700(0x1b0)](-0x2),_0x2c6b2e=('0'+(_0x4d01ff[_0x1a3700(0x19a)]()+0x1))[_0x1a3700(0x1b0)](-0x2),_0x37a1e4=_0x4d01ff[_0x1a3700(0x12a)](),_0x20ef29=_0x37a1e4+'-'+_0x2c6b2e+'-'+_0xd6ab7c;var _0x271d44=['Ambient',_0x1a3700(0x14c)];const _0x387964=await warehouse['aggregate']([{'$match':{'name':_0x142a2e[_0x1a3700(0xf7)],'room':_0x142a2e[_0x1a3700(0x137)]}},{'$unwind':_0x1a3700(0x19d)},{'$group':{'_id':_0x1a3700(0x1c7),'name':{'$first':_0x1a3700(0x152)},'product_stock':{'$first':_0x1a3700(0x171)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1a3700(0x135)},'type':{'$first':_0x1a3700(0xe1)},'floorlevel':{'$first':_0x1a3700(0x10a)},'primary_code':{'$first':_0x1a3700(0xee)},'secondary_code':{'$first':_0x1a3700(0x1b8)},'product_code':{'$first':_0x1a3700(0x157)},'storage':{'$first':_0x1a3700(0x182)},'rack':{'$first':_0x1a3700(0x179)}}}]),_0x548718=await customer[_0x1a3700(0x18c)]({});let _0x464f83;if(_0x431b65['role']==_0x1a3700(0x1b6)){const _0x22c19b=await staff[_0x1a3700(0x1a4)]({'email':_0x431b65['email']});_0x464f83=await warehouse[_0x1a3700(0x176)]([{'$match':{'status':_0x1a3700(0x148),'name':_0x22c19b[_0x1a3700(0x17c)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x464f83=await warehouse[_0x1a3700(0x176)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x1a3700(0x128)}}}]);const _0x4ac183=await product[_0x1a3700(0x18c)]({});if(_0x129a65[0x0][_0x1a3700(0x1ed)]==_0x1a3700(0x136)){var _0x46bf50=users[_0x1a3700(0x1f1)];console['log'](_0x46bf50);}else{if(_0x129a65[0x0][_0x1a3700(0x1ed)]==_0x1a3700(0x13e))var _0x46bf50=users[_0x1a3700(0x13e)];else{if(_0x129a65[0x0][_0x1a3700(0x1ed)]==_0x1a3700(0x141))var _0x46bf50=users[_0x1a3700(0x141)];else{if(_0x129a65[0x0][_0x1a3700(0x1ed)]==_0x1a3700(0xe4))var _0x46bf50=users[_0x1a3700(0xe4)];else{if(_0x129a65[0x0][_0x1a3700(0x1ed)]==_0x1a3700(0xdc))var _0x46bf50=users[_0x1a3700(0xdc)];else{if(_0x129a65[0x0][_0x1a3700(0x1ed)]=='Portuguese\x20(BR)')var _0x46bf50=users[_0x1a3700(0x18f)];else{if(_0x129a65[0x0][_0x1a3700(0x1ed)]==_0x1a3700(0xec))var _0x46bf50=users[_0x1a3700(0xec)];else{if(_0x129a65[0x0][_0x1a3700(0x1ed)]=='Arabic\x20(ae)')var _0x46bf50=users['Arabic'];}}}}}}}_0x5491a2[_0x1a3700(0x1d5)](_0x1a3700(0x1eb),{'success':_0x48a18f[_0x1a3700(0x1be)](_0x1a3700(0x150)),'errors':_0x48a18f['flash'](_0x1a3700(0xe0)),'role':_0x431b65,'profile':_0x41cd8a,'customer':_0x548718,'warehouse':_0x464f83,'product':_0x387964,'user':_0x142a2e,'master_shop':_0x129a65,'unit':_0x4ac183,'language':_0x46bf50,'rooms_data':_0x271d44,'ed_fullDate':_0x20ef29});}catch(_0x19a2cf){console[_0x1a3700(0x1c2)](_0x19a2cf);}}),router[a0_0x51978a(0x127)](a0_0x51978a(0x1d4),auth,async(_0x7d43ba,_0x29b12b)=>{var _0x388971=a0_0x51978a;try{const _0x51f027=_0x7d43ba[_0x388971(0x1bb)]['id'],_0x1f2ab7=await sales_finished[_0x388971(0x1a4)]({'_id':_0x7d43ba[_0x388971(0x1bb)]['id']}),_0x1de3e6=await warehouse[_0x388971(0x1a4)]({'name':_0x1f2ab7[_0x388971(0xf7)],'room':_0x7d43ba[_0x388971(0x154)]['room'],'warehouse_category':_0x388971(0x1cb)}),{invoice:_0x1ba571,customer:_0x5cad71,date:_0x32520e,warehouse_name:_0x5902d6,product_name:_0x403812,stock:_0x5d4bcd,adjust_qty:_0x519daf,note:_0x58647d,room:_0x3cdbc9,primary_code:_0x2df034,secondary_code:_0xfb1e56,prod_code:_0x272f50,level:_0x239a84,isle:_0x30a59a,pallet:_0x270c78,expiry_date:_0x3241a8}=_0x7d43ba[_0x388971(0x154)];if(typeof _0x403812=='string')var _0x3e37b3=[_0x7d43ba[_0x388971(0x154)][_0x388971(0x1a6)]],_0x37ab80=[_0x7d43ba['body'][_0x388971(0x199)]],_0x157c52=[_0x7d43ba[_0x388971(0x154)][_0x388971(0x1cd)]],_0x22503d=[_0x7d43ba['body'][_0x388971(0xf6)]],_0x31a088=[_0x7d43ba[_0x388971(0x154)]['secondary_code']],_0x5a7a0c=[_0x7d43ba['body'][_0x388971(0x1de)]],_0x139ae7=[_0x7d43ba[_0x388971(0x154)]['level']],_0x120f8f=[_0x7d43ba[_0x388971(0x154)]['expiry_date']];else var _0x3e37b3=[..._0x7d43ba[_0x388971(0x154)][_0x388971(0x1a6)]],_0x37ab80=[..._0x7d43ba[_0x388971(0x154)][_0x388971(0x199)]],_0x157c52=[..._0x7d43ba[_0x388971(0x154)][_0x388971(0x1cd)]],_0x22503d=[..._0x7d43ba['body'][_0x388971(0xf6)]],_0x31a088=[..._0x7d43ba[_0x388971(0x154)][_0x388971(0x124)]],_0x5a7a0c=[..._0x7d43ba[_0x388971(0x154)]['prod_code']],_0x139ae7=[..._0x7d43ba[_0x388971(0x154)][_0x388971(0x142)]],_0x120f8f=[..._0x7d43ba[_0x388971(0x154)][_0x388971(0x192)]];const _0x1e4f52=_0x3e37b3[_0x388971(0x111)](_0x15d516=>{return _0x15d516={'product_name':_0x15d516};});_0x37ab80[_0x388971(0x13b)]((_0x904d6b,_0x55ff51)=>{var _0x14dc7e=_0x388971;_0x1e4f52[_0x55ff51][_0x14dc7e(0x199)]=_0x904d6b;}),_0x157c52['forEach']((_0x8ea11,_0x7cffe6)=>{var _0xdad5c8=_0x388971;_0x1e4f52[_0x7cffe6][_0xdad5c8(0x1ca)]=_0x8ea11;}),_0x22503d[_0x388971(0x13b)]((_0x3a7627,_0x521f8e)=>{var _0x24083e=_0x388971;_0x1e4f52[_0x521f8e][_0x24083e(0xf6)]=_0x3a7627;}),_0x31a088['forEach']((_0x191af5,_0x1b8da5)=>{var _0x4cb900=_0x388971;_0x1e4f52[_0x1b8da5][_0x4cb900(0x124)]=_0x191af5;}),_0x5a7a0c['forEach']((_0x2229bb,_0x4911ea)=>{var _0x312b3a=_0x388971;_0x1e4f52[_0x4911ea][_0x312b3a(0x1bd)]=_0x2229bb;}),_0x139ae7[_0x388971(0x13b)]((_0x105f07,_0x59801d)=>{var _0x546d7a=_0x388971;_0x1e4f52[_0x59801d][_0x546d7a(0x142)]=_0x105f07;}),_0x120f8f[_0x388971(0x13b)]((_0x5522c7,_0x2d2740)=>{var _0x1beeb8=_0x388971;_0x1e4f52[_0x2d2740][_0x1beeb8(0x192)]=_0x5522c7;});var _0x282cb8=0x0;_0x1e4f52[_0x388971(0x13b)](_0x590dcb=>{var _0x20feb4=_0x388971;console[_0x20feb4(0x1c2)](_0x20feb4(0x13c),_0x590dcb),(parseInt(_0x590dcb[_0x20feb4(0x199)])<parseInt(_0x590dcb[_0x20feb4(0x1ca)])||parseInt(_0x590dcb['quantity'])==0x0)&&_0x282cb8++;});if(_0x282cb8!=0x0)return _0x7d43ba[_0x388971(0x1be)]('errors',_0x388971(0x139)),_0x29b12b[_0x388971(0xdf)](_0x388971(0x122));_0x1f2ab7['sale_product'][_0x388971(0x13b)](_0x4bf570=>{var _0x4e3e2f=_0x388971;const _0xb382c4=_0x1de3e6[_0x4e3e2f(0x1f2)]['map'](_0x368314=>{var _0x1fc4fd=_0x4e3e2f;_0x368314[_0x1fc4fd(0x1a6)]==_0x4bf570[_0x1fc4fd(0x1a6)]&&_0x368314[_0x1fc4fd(0x18e)]==_0x4bf570[_0x1fc4fd(0x18e)]&&(_0x368314[_0x1fc4fd(0x1f3)]=parseInt(_0x368314[_0x1fc4fd(0x1f3)])+parseInt(_0x4bf570[_0x1fc4fd(0x1ca)]));});}),await _0x1de3e6[_0x388971(0x130)]();const _0xf344ce=_0x1e4f52[_0x388971(0x1a7)](_0x238187=>_0x238187[_0x388971(0x1ca)]!=='0'&&_0x238187[_0x388971(0x1ca)]!=='');_0x1f2ab7[_0x388971(0x138)]=_0x1ba571,_0x1f2ab7[_0x388971(0x17f)]=_0x5cad71,_0x1f2ab7[_0x388971(0x1a5)]=_0x32520e,_0x1f2ab7[_0x388971(0xf7)]=_0x5902d6,_0x1f2ab7[_0x388971(0x12f)]=_0xf344ce,_0x1f2ab7[_0x388971(0x177)]=_0x58647d,_0x1f2ab7[_0x388971(0x137)]=_0x3cdbc9;const _0x35cb7c=await _0x1f2ab7[_0x388971(0x130)](),_0x574928=await sales_finished[_0x388971(0x1a4)]({'_id':_0x7d43ba['params']['id']}),_0x5171b2=await warehouse[_0x388971(0x1a4)]({'name':_0x5902d6,'room':_0x3cdbc9,'warehouse_category':_0x388971(0x1cb)});_0x574928['sale_product'][_0x388971(0x13b)](_0x54e982=>{var _0x530ef2=_0x388971;const _0x2a3a84=_0x5171b2[_0x530ef2(0x1f2)][_0x530ef2(0x111)](_0x31f570=>{var _0x4bae65=_0x530ef2;_0x31f570[_0x4bae65(0x1a6)]==_0x54e982['product_name']&&_0x31f570['bay']==_0x54e982['bay']&&(_0x31f570[_0x4bae65(0x1f3)]=parseInt(_0x31f570[_0x4bae65(0x1f3)])-parseInt(_0x54e982[_0x4bae65(0x1ca)]));});}),console[_0x388971(0x1c2)]('final',_0x5171b2),await _0x5171b2[_0x388971(0x130)]();const _0x1ff8cb=await c_payment_data[_0x388971(0x1a4)]({'invoice':_0x7d43ba[_0x388971(0x154)][_0x388971(0x138)]});_0x1ff8cb[_0x388971(0x1a2)]=_0x7d43ba[_0x388971(0x154)][_0x388971(0x1a2)],await _0x1ff8cb['save'](),_0x7d43ba[_0x388971(0x1be)](_0x388971(0x150),_0x388971(0x104)),_0x29b12b[_0x388971(0xdf)](_0x388971(0x184));}catch(_0x1ada89){console[_0x388971(0x1c2)](_0x1ada89);}}),router[a0_0x51978a(0x127)](a0_0x51978a(0x123),auth,async(_0xa75496,_0x2eac27)=>{var _0x7a2da8=a0_0x51978a;try{const _0x131ef1=_0xa75496[_0x7a2da8(0x1bb)]['id'],{invoice:_0x218731,customer:_0x2fff69,receivable_amount:_0x1ffa03,received_amount:_0x1de2be}=_0xa75496[_0x7a2da8(0x154)],_0x506c82=await sales[_0x7a2da8(0x185)](_0x131ef1);console['log'](_0x506c82);var _0x1900fb=_0x1ffa03-_0x1de2be;console[_0x7a2da8(0x1c2)](_0x1de2be),_0x506c82[_0x7a2da8(0xe5)]=parseFloat(_0x1de2be)+parseFloat(_0x506c82[_0x7a2da8(0xe5)]),_0x506c82[_0x7a2da8(0x187)]=_0x1900fb,console[_0x7a2da8(0x1c2)](_0x506c82);const _0x488c19=await _0x506c82[_0x7a2da8(0x130)](),_0x54e541=await c_payment_data[_0x7a2da8(0x1a4)]({'invoice':_0x218731});_0x54e541['amount']=_0x1900fb,await _0x54e541[_0x7a2da8(0x130)]();let _0x2a542e=new Date(),_0x327077=('0'+_0x2a542e[_0x7a2da8(0x132)]())['slice'](-0x2),_0x12d557=('0'+(_0x2a542e[_0x7a2da8(0x19a)]()+0x1))['slice'](-0x2),_0x571210=_0x2a542e['getFullYear'](),_0x456174=_0x571210+'-'+_0x12d557+'-'+_0x327077;const _0x17a570=new customer_payment({'invoice':_0x218731,'date':_0x571210+'-'+_0x12d557+'-'+_0x327077,'customer':_0x2fff69,'reason':_0x7a2da8(0x1bc),'amount':_0x1de2be}),_0x43039d=await _0x17a570[_0x7a2da8(0x130)]();_0xa75496[_0x7a2da8(0x1be)](_0x7a2da8(0x150),_0x7a2da8(0x1dd)),_0x2eac27[_0x7a2da8(0xdf)]('/all_sales/view');}catch(_0x2ea1fc){console['log'](_0x2ea1fc);}}),router[a0_0x51978a(0x1e0)](a0_0x51978a(0x164),auth,async(_0x5339e6,_0x110b04)=>{var _0x399e24=a0_0x51978a;try{const {username:_0x360dd9,email:_0x54eb24,role:_0x3819f3}=_0x5339e6['user'],_0x2d57d0=_0x5339e6[_0x399e24(0x1d2)],_0x359237=await profile[_0x399e24(0x1a4)]({'email':_0x2d57d0[_0x399e24(0x129)]}),_0x513450=await master_shop[_0x399e24(0x18c)]();console[_0x399e24(0x1c2)](_0x399e24(0x1f7),_0x513450);const _0x334b6c=_0x5339e6['params']['id'],_0x10ed00=await sales[_0x399e24(0x185)](_0x334b6c);console[_0x399e24(0x1c2)](_0x10ed00);const _0x3401e7=await customer[_0x399e24(0x1a4)]({'name':_0x10ed00[_0x399e24(0x17f)]});console[_0x399e24(0x1c2)](_0x3401e7);if(_0x513450[0x0][_0x399e24(0x1ed)]==_0x399e24(0x136)){var _0x42f456=users[_0x399e24(0x1f1)];console[_0x399e24(0x1c2)](_0x42f456);}else{if(_0x513450[0x0]['language']==_0x399e24(0x13e))var _0x42f456=users[_0x399e24(0x13e)];else{if(_0x513450[0x0]['language']=='German')var _0x42f456=users[_0x399e24(0x141)];else{if(_0x513450[0x0][_0x399e24(0x1ed)]==_0x399e24(0xe4))var _0x42f456=users[_0x399e24(0xe4)];else{if(_0x513450[0x0][_0x399e24(0x1ed)]==_0x399e24(0xdc))var _0x42f456=users[_0x399e24(0xdc)];else{if(_0x513450[0x0][_0x399e24(0x1ed)]==_0x399e24(0x1ef))var _0x42f456=users[_0x399e24(0x18f)];else{if(_0x513450[0x0][_0x399e24(0x1ed)]==_0x399e24(0xec))var _0x42f456=users[_0x399e24(0xec)];else{if(_0x513450[0x0]['language']==_0x399e24(0x1ba))var _0x42f456=users[_0x399e24(0x1ee)];}}}}}}}_0x110b04[_0x399e24(0x1d5)](_0x399e24(0x110),{'success':_0x5339e6['flash']('success'),'errors':_0x5339e6[_0x399e24(0x1be)](_0x399e24(0xe0)),'role':_0x2d57d0,'profile':_0x359237,'master_shop':_0x513450,'customers':_0x3401e7,'sales':_0x10ed00,'language':_0x42f456});}catch(_0x595244){console['log'](_0x595244);}}),router[a0_0x51978a(0x1e0)](a0_0x51978a(0x186),auth,async(_0x17bedf,_0x475c1b)=>{var _0x31ea58=a0_0x51978a;try{const {username:_0x39c1a5,email:_0x7e1070,role:_0x955dcb}=_0x17bedf[_0x31ea58(0x1d2)],_0x5dd865=_0x17bedf['user'],_0x37d90f=await profile[_0x31ea58(0x1a4)]({'email':_0x5dd865[_0x31ea58(0x129)]}),_0x2a7c75=await master_shop[_0x31ea58(0x18c)](),_0x5408b2=_0x17bedf[_0x31ea58(0x1bb)]['id'],_0x47f790=await sales_finished[_0x31ea58(0x185)](_0x5408b2),_0x53559d=await warehouse[_0x31ea58(0x176)]([{'$match':{'name':_0x47f790[_0x31ea58(0xf7)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x31ea58(0x1c7),'name':{'$first':_0x31ea58(0x152)},'product_stock':{'$first':_0x31ea58(0x171)},'bay':{'$first':_0x31ea58(0x160)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x31ea58(0x10a)},'primary_code':{'$first':_0x31ea58(0xee)},'secondary_code':{'$first':_0x31ea58(0x1b8)},'product_code':{'$first':_0x31ea58(0x157)},'storage':{'$first':_0x31ea58(0x182)},'rack':{'$first':_0x31ea58(0x179)},'expiry_date':{'$first':_0x31ea58(0x1ae)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0x31ea58(0x1e9)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':'$product_details.maxProducts'},'batch_code':{'$first':_0x31ea58(0x167)},'maxPerUnit':{'$first':_0x31ea58(0x196)}}}]),_0x25866e=await product[_0x31ea58(0x18c)]({}),_0x4e8cdf=await warehouse[_0x31ea58(0x176)]([{'$match':{'status':'Enabled','warehouse_category':_0x31ea58(0x1cb),'name':{'$ne':'Return\x20Goods','$ne':_0x31ea58(0x189)}}},{'$group':{'_id':_0x31ea58(0x128),'name':{'$first':_0x31ea58(0x128)}}},{'$sort':{'name':0x1}}]);var _0x3c9316=[_0x31ea58(0x174)];const _0x3652c1=await warehouse[_0x31ea58(0x176)]([{'$match':{'status':_0x31ea58(0x148),'name':'Quality\x20Inspection'}},{'$group':{'_id':_0x31ea58(0x128),'name':{'$first':_0x31ea58(0x128)}}},{'$sort':{'name':0x1}}]);if(_0x2a7c75[0x0]['language']=='English\x20(US)'){var _0x299d74=users['English'];console[_0x31ea58(0x1c2)](_0x299d74);}else{if(_0x2a7c75[0x0]['language']==_0x31ea58(0x13e))var _0x299d74=users[_0x31ea58(0x13e)];else{if(_0x2a7c75[0x0][_0x31ea58(0x1ed)]=='German')var _0x299d74=users['German'];else{if(_0x2a7c75[0x0][_0x31ea58(0x1ed)]==_0x31ea58(0xe4))var _0x299d74=users[_0x31ea58(0xe4)];else{if(_0x2a7c75[0x0][_0x31ea58(0x1ed)]=='French')var _0x299d74=users['French'];else{if(_0x2a7c75[0x0]['language']==_0x31ea58(0x1ef))var _0x299d74=users[_0x31ea58(0x18f)];else{if(_0x2a7c75[0x0][_0x31ea58(0x1ed)]=='Chinese')var _0x299d74=users['Chinese'];else{if(_0x2a7c75[0x0][_0x31ea58(0x1ed)]==_0x31ea58(0x1ba))var _0x299d74=users['Arabic'];}}}}}}}_0x475c1b['render'](_0x31ea58(0x1f0),{'success':_0x17bedf[_0x31ea58(0x1be)](_0x31ea58(0x150)),'errors':_0x17bedf[_0x31ea58(0x1be)]('errors'),'role':_0x5dd865,'profile':_0x37d90f,'user':_0x47f790,'stock':_0x53559d,'master_shop':_0x2a7c75,'unit':_0x25866e,'language':_0x299d74,'warehouses':_0x4e8cdf,'rooms':_0x3c9316,'warehouse_QA':_0x3652c1});}catch(_0xd8cef8){console[_0x31ea58(0x1c2)](_0xd8cef8),_0x475c1b['status'](0xc8)[_0x31ea58(0x17b)]({'message':_0xd8cef8['message']});}}),router[a0_0x51978a(0x127)]('/view/return_sales/:id',auth,async(_0x2bfc3e,_0x495028)=>{var _0x3a958e=a0_0x51978a;if(_0x2bfc3e['body'][_0x3a958e(0x188)]=='QA')try{const {invoice:_0xce4fb2,date:_0x486273,warehouse_name:_0x23a6c6,product_name:_0x26c74d,primary_code:_0x1caeaf,secondary_code:_0x5dc8b1,product_code:_0x264ab9,sales_quantity:_0x5db5da,stocks:_0x48d2c2,return_qty:_0x46abad,Room_name:_0x4540ad,to_warehouse_name_QA:_0xfe1cb8,to_Room_name_QA:_0x4037b2,note:_0x34b81c,for_categorize:_0x14ce17,product_name_QA1:_0x3b8428}=_0x2bfc3e[_0x3a958e(0x154)];if(typeof _0x3b8428==_0x3a958e(0x191))var _0xa56712=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x173)]],_0x4fa394=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x159)]],_0x5a55c3=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x116)]],_0x4f81f=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0xfe)]],_0x2f97f8=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x162)]],_0xe2705c=[_0x2bfc3e['body'][_0x3a958e(0x1d3)]],_0x1afeb3=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x1b3)]],_0x59520e=[_0x2bfc3e['body'][_0x3a958e(0x19f)]],_0xe54e9e=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x149)]],_0x50d762=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x102)]],_0x53b44a=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x1ad)]],_0x3ba180=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x1ec)]],_0xa04efa=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x114)]],_0x4945e9=[_0x2bfc3e['body'][_0x3a958e(0x16a)]];else var _0xa56712=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x173)]],_0x4fa394=[..._0x2bfc3e[_0x3a958e(0x154)]['primary_code_QA']],_0x5a55c3=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x116)]],_0x4f81f=[..._0x2bfc3e['body'][_0x3a958e(0xfe)]],_0x2f97f8=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x162)]],_0xe2705c=[..._0x2bfc3e['body'][_0x3a958e(0x1d3)]],_0x1afeb3=[..._0x2bfc3e[_0x3a958e(0x154)]['return_qty_QA']],_0x59520e=[..._0x2bfc3e[_0x3a958e(0x154)]['maxPerUnit_QA']],_0xe54e9e=[..._0x2bfc3e['body'][_0x3a958e(0x149)]],_0x50d762=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x102)]],_0x53b44a=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x1ad)]],_0x3ba180=[..._0x2bfc3e['body'][_0x3a958e(0x1ec)]],_0xa04efa=[..._0x2bfc3e[_0x3a958e(0x154)]['production_date_QA']],_0x4945e9=[..._0x2bfc3e[_0x3a958e(0x154)]['expiry_date_QA']];const _0x509f93=_0xa56712[_0x3a958e(0x111)](_0x497343=>{return _0x497343={'product_name':_0x497343};});_0x4fa394[_0x3a958e(0x13b)]((_0x3c376c,_0x1e64d3)=>{var _0x2d9a42=_0x3a958e;_0x509f93[_0x1e64d3][_0x2d9a42(0xf6)]=_0x3c376c;}),_0x5a55c3[_0x3a958e(0x13b)]((_0x287f1d,_0x1fe5c2)=>{var _0x5037af=_0x3a958e;_0x509f93[_0x1fe5c2][_0x5037af(0x124)]=_0x287f1d;}),_0x4f81f[_0x3a958e(0x13b)]((_0x221471,_0x55dab7)=>{_0x509f93[_0x55dab7]['product_code']=_0x221471;}),_0x2f97f8[_0x3a958e(0x13b)]((_0x29a23e,_0xcf05e9)=>{var _0x44de45=_0x3a958e;_0x509f93[_0xcf05e9][_0x44de45(0x13d)]=_0x29a23e;}),_0xe2705c['forEach']((_0x4e87e4,_0x269bcb)=>{_0x509f93[_0x269bcb]['stock']=_0x4e87e4;}),_0x1afeb3[_0x3a958e(0x13b)]((_0xc33f92,_0x297e64)=>{var _0xec7fbd=_0x3a958e;_0x509f93[_0x297e64][_0xec7fbd(0x1e7)]=_0xc33f92;}),_0x59520e['forEach']((_0x5b7d94,_0x763cc6)=>{var _0x58d725=_0x3a958e;_0x509f93[_0x763cc6][_0x58d725(0xed)]=_0x5b7d94;}),_0xe54e9e[_0x3a958e(0x13b)]((_0x2c24bd,_0xb83cc)=>{var _0x2ea80e=_0x3a958e;_0x509f93[_0xb83cc][_0x2ea80e(0x15c)]=_0x2c24bd;}),_0x50d762[_0x3a958e(0x13b)]((_0x2bafbd,_0x2950ee)=>{var _0x1eee5b=_0x3a958e;_0x509f93[_0x2950ee][_0x1eee5b(0x133)]=_0x2bafbd;}),_0x53b44a[_0x3a958e(0x13b)]((_0x2eea0b,_0x263d76)=>{var _0x1b3312=_0x3a958e;_0x509f93[_0x263d76][_0x1b3312(0x11d)]=_0x2eea0b;}),_0x3ba180[_0x3a958e(0x13b)]((_0x5873f1,_0x27b155)=>{var _0x2b4c46=_0x3a958e;_0x509f93[_0x27b155][_0x2b4c46(0x115)]=_0x5873f1;}),_0xa04efa['forEach']((_0x32a37a,_0x44d014)=>{_0x509f93[_0x44d014]['production_date']=_0x32a37a;}),_0x4945e9[_0x3a958e(0x13b)]((_0x4fb710,_0x49bbe9)=>{var _0x38dd13=_0x3a958e;_0x509f93[_0x49bbe9][_0x38dd13(0x192)]=_0x4fb710;});const _0x39dbb9=await sales_finished[_0x3a958e(0x1a4)]({'invoice':_0xce4fb2});_0x39dbb9['return_data']='True';const _0x2b2907=await _0x39dbb9[_0x3a958e(0x130)](),_0x135093=new sales_return_finished({'invoice':_0xce4fb2,'customer':_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x17f)],'date':_0x486273,'warehouse_name':_0x23a6c6,'room':_0x4540ad,'ToWarehouse':_0xfe1cb8,'ToRoom':_0x4037b2,'return_sale_QA':_0x509f93,'note':_0x34b81c,'warehouse_cat':_0x14ce17}),_0x16aac8=await _0x135093['save'](),_0x576360=await sales_return_finished[_0x3a958e(0x1a4)]({'invoice':_0xce4fb2}),_0x1c29ae=await warehouse[_0x3a958e(0x1a4)]({'name':_0xfe1cb8,'room':_0x4037b2});_0x576360[_0x3a958e(0x183)][_0x3a958e(0x13b)](_0x425b0f=>{var _0x46e5de=_0x3a958e,_0x267469=0x0;const _0xee6ff7=_0x1c29ae[_0x46e5de(0x1f2)][_0x46e5de(0x111)](_0x12333a=>{var _0x33ef71=_0x46e5de;_0x12333a[_0x33ef71(0x1a6)]==_0x425b0f[_0x33ef71(0x1a6)]&&_0x12333a['expiry_date']==_0x425b0f['expiry_date']&&_0x12333a[_0x33ef71(0xe3)]==_0x425b0f[_0x33ef71(0xe3)]&&_0x12333a['batch_code']==_0x425b0f[_0x33ef71(0x133)]&&(_0x12333a[_0x33ef71(0x1f3)]=parseInt(_0x12333a['product_stock'])+parseInt(_0x425b0f[_0x33ef71(0x1e7)]),_0x267469++);});_0x267469=='0'&&(_0x1c29ae['product_details']=_0x1c29ae[_0x46e5de(0x1f2)][_0x46e5de(0x16f)]({'product_name':_0x425b0f[_0x46e5de(0x1a6)],'product_stock':_0x425b0f[_0x46e5de(0x1e7)],'primary_code':_0x425b0f[_0x46e5de(0xf6)],'secondary_code':_0x425b0f[_0x46e5de(0x124)],'product_code':_0x425b0f[_0x46e5de(0x1bd)],'batch_code':_0x425b0f[_0x46e5de(0x133)],'maxPerUnit':_0x425b0f[_0x46e5de(0xed)],'production_date':_0x425b0f[_0x46e5de(0xe3)],'expiry_date':_0x425b0f[_0x46e5de(0x192)],'secondary_unit':_0x425b0f[_0x46e5de(0x11d)],'unit':_0x425b0f[_0x46e5de(0x115)],'maxProducts':_0x425b0f[_0x46e5de(0x15c)],'bay':_0x425b0f[_0x46e5de(0x18e)]}));}),await _0x1c29ae[_0x3a958e(0x130)]();const _0x2678bf=new c_payment_data({'invoice':_0xce4fb2,'customer':_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x17f)],'reason':_0x3a958e(0x15b)});await _0x2678bf[_0x3a958e(0x130)]();const _0x5835bb=await master_shop[_0x3a958e(0x18c)](),_0x125e54=await email_settings[_0x3a958e(0x1a4)](),_0x19e0e7=await customer['findOne']({'name':_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x17f)]});_0x5835bb[0x0][_0x3a958e(0xe9)]==0x1?(right_currency=_0x5835bb[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5835bb[0x0][_0x3a958e(0x1aa)]);var _0x2bcbe3=_0xa56712,_0xf593db=_0x1afeb3,_0x33c81f='',_0x2f93bc;for(_0x2f93bc in _0x2bcbe3){_0x33c81f+=_0x3a958e(0x168)+_0x3a958e(0x1df)+_0x2bcbe3[_0x2f93bc]+_0x3a958e(0x1ab)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf593db[_0x2f93bc]+_0x3a958e(0x1ab)+_0x3a958e(0x17a);}console[_0x3a958e(0x1c2)](_0x3a958e(0x11e),_0x33c81f);let _0x27c0f8=nodemailer[_0x3a958e(0x1db)]({'service':'gmail','auth':{'user':_0x125e54[_0x3a958e(0x129)],'pass':_0x125e54['password']}}),_0x750514={'from':_0x125e54['email'],'to':_0x19e0e7[_0x3a958e(0x129)],'subject':_0x3a958e(0x15a),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3a958e(0x1e5)+_0x3a958e(0x145)+_0x5835bb[0x0][_0x3a958e(0x120)],'cid':_0x3a958e(0x1e3)}],'html':_0x3a958e(0x181)+_0x3a958e(0x18d)+_0x3a958e(0x1f5)+_0x3a958e(0x1a1)+_0x3a958e(0x10f)+_0x3a958e(0x1a1)+_0x3a958e(0x1a9)+'</div>'+_0x3a958e(0x1a1)+_0x3a958e(0x1ea)+_0x5835bb[0x0]['site_title']+_0x3a958e(0xf2)+_0x3a958e(0x15f)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x3a958e(0x1a1)+_0x3a958e(0x1e2)+_0x3a958e(0x1af)+_0xce4fb2+'\x20'+_0x3a958e(0xfc)+_0x3a958e(0xef)+_0x486273+'\x20'+_0x3a958e(0x144)+_0x3a958e(0x131)+_0x3a958e(0x15f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3a958e(0x19e)+_0x3a958e(0x168)+_0x3a958e(0x126)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x3a958e(0x146)+_0x3a958e(0x1d1)+_0x3a958e(0x17a)+_0x3a958e(0x14d)+_0x3a958e(0xe2)+'\x20'+_0x33c81f+'\x20'+_0x3a958e(0x119)+_0x3a958e(0x1c6)+_0x3a958e(0x1a1)+_0x3a958e(0x107)+_0x3a958e(0x165)+_0x5835bb[0x0][_0x3a958e(0x15d)]+'</h5>'+_0x3a958e(0x15f)+'</div>'+'</body></html>'};_0x27c0f8[_0x3a958e(0x1f6)](_0x750514,function(_0x169f57,_0x53d6d0){var _0x175bac=_0x3a958e;_0x169f57?(console[_0x175bac(0x1c2)](_0x169f57),console[_0x175bac(0x1c2)]('Error\x20Occurs')):console[_0x175bac(0x1c2)]('Email\x20sent\x20successfully');}),_0x2bfc3e[_0x3a958e(0x1be)](_0x3a958e(0x150),_0x3a958e(0x1a3)),_0x495028[_0x3a958e(0xdf)](_0x3a958e(0x184));}catch(_0x2bcea5){_0x495028['status'](0xc8)[_0x3a958e(0x17b)]({'message1':_0x2bcea5['message']});}else{if(_0x2bfc3e[_0x3a958e(0x154)]['for_categorize']=='GS')try{const {invoice:_0x5a95b9,date:_0x21e6cc,warehouse_name:_0x18f0a9,product_name:_0x5af54d,primary_code:_0x43d451,secondary_code:_0xe42677,product_code:_0x4b3253,sales_quantity:_0x1a6dd4,stocks:_0x3a5883,return_qty:_0x4cfafd,Room_name:_0x3e1729,to_warehouse_name:_0x2f88b9,to_Room_name:_0x4876e1,note:_0x5b8a55,level:_0x5865dd,isle:_0x5e9930,pallet:_0x889342,for_categorize:_0x4270c4}=_0x2bfc3e[_0x3a958e(0x154)];if(typeof _0x5af54d==_0x3a958e(0x191))var _0xa56712=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x1a6)]],_0x4fa394=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0xf6)]],_0x5a55c3=[_0x2bfc3e['body'][_0x3a958e(0x124)]],_0x4f81f=[_0x2bfc3e[_0x3a958e(0x154)]['product_code']],_0x2f97f8=[_0x2bfc3e[_0x3a958e(0x154)]['sales_quantity']],_0x1afeb3=[_0x2bfc3e['body'][_0x3a958e(0x1e7)]],_0x3a14d5=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x18e)]],_0x59520e=[_0x2bfc3e['body'][_0x3a958e(0xed)]],_0xe54e9e=[_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x15c)]],_0x50d762=[_0x2bfc3e[_0x3a958e(0x154)]['batch_code']],_0x53b44a=[_0x2bfc3e['body'][_0x3a958e(0x11d)]],_0x3ba180=[_0x2bfc3e[_0x3a958e(0x154)]['unit']],_0xa04efa=[_0x2bfc3e['body'][_0x3a958e(0xe3)]],_0x4945e9=[_0x2bfc3e[_0x3a958e(0x154)]['expiry_date']];else var _0xa56712=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x1a6)]],_0x4fa394=[..._0x2bfc3e[_0x3a958e(0x154)]['primary_code']],_0x5a55c3=[..._0x2bfc3e[_0x3a958e(0x154)]['secondary_code']],_0x4f81f=[..._0x2bfc3e['body'][_0x3a958e(0x1bd)]],_0x2f97f8=[..._0x2bfc3e['body'][_0x3a958e(0xe8)]],_0x1afeb3=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x1e7)]],_0x3a14d5=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x18e)]],_0x59520e=[..._0x2bfc3e['body']['maxPerUnit']],_0xe54e9e=[..._0x2bfc3e['body'][_0x3a958e(0x15c)]],_0x50d762=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x133)]],_0x53b44a=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x11d)]],_0x3ba180=[..._0x2bfc3e[_0x3a958e(0x154)]['unit']],_0xa04efa=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0xe3)]],_0x4945e9=[..._0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x192)]];const _0x35ecea=_0xa56712['map'](_0x47568d=>{return _0x47568d={'product_name':_0x47568d};});_0x4fa394[_0x3a958e(0x13b)]((_0x387525,_0x18aad5)=>{var _0x127916=_0x3a958e;_0x35ecea[_0x18aad5][_0x127916(0xf6)]=_0x387525;}),_0x5a55c3[_0x3a958e(0x13b)]((_0xcc72af,_0xba0f00)=>{var _0x34fab6=_0x3a958e;_0x35ecea[_0xba0f00][_0x34fab6(0x124)]=_0xcc72af;}),_0x4f81f[_0x3a958e(0x13b)]((_0x1d027e,_0x549343)=>{var _0x50fcb3=_0x3a958e;_0x35ecea[_0x549343][_0x50fcb3(0x1bd)]=_0x1d027e;}),_0x2f97f8[_0x3a958e(0x13b)]((_0x2debf3,_0x34ded1)=>{var _0x452568=_0x3a958e;_0x35ecea[_0x34ded1][_0x452568(0x13d)]=_0x2debf3;}),_0x1afeb3[_0x3a958e(0x13b)]((_0x4d8d4e,_0x452e8f)=>{var _0x33552d=_0x3a958e;_0x35ecea[_0x452e8f][_0x33552d(0x1e7)]=_0x4d8d4e;}),_0x3a14d5[_0x3a958e(0x13b)]((_0x2835e9,_0x518b80)=>{var _0x2093a3=_0x3a958e;_0x35ecea[_0x518b80][_0x2093a3(0x18e)]=_0x2835e9;}),_0x59520e[_0x3a958e(0x13b)]((_0x13940f,_0x210db0)=>{var _0xd8c7a9=_0x3a958e;_0x35ecea[_0x210db0][_0xd8c7a9(0xed)]=_0x13940f;}),_0xe54e9e[_0x3a958e(0x13b)]((_0x41353e,_0x2a03fe)=>{var _0x4017f9=_0x3a958e;_0x35ecea[_0x2a03fe][_0x4017f9(0x15c)]=_0x41353e;}),_0x50d762[_0x3a958e(0x13b)]((_0x588842,_0x534c82)=>{var _0x184abd=_0x3a958e;_0x35ecea[_0x534c82][_0x184abd(0x133)]=_0x588842;}),_0x53b44a[_0x3a958e(0x13b)]((_0x42f09d,_0x4b9b6f)=>{var _0x3319dc=_0x3a958e;_0x35ecea[_0x4b9b6f][_0x3319dc(0x11d)]=_0x42f09d;}),_0x3ba180[_0x3a958e(0x13b)]((_0x47b14b,_0xa7a796)=>{var _0x2a9a9f=_0x3a958e;_0x35ecea[_0xa7a796][_0x2a9a9f(0x115)]=_0x47b14b;}),_0xa04efa[_0x3a958e(0x13b)]((_0x416298,_0x5a50e6)=>{_0x35ecea[_0x5a50e6]['production_date']=_0x416298;}),_0x4945e9[_0x3a958e(0x13b)]((_0x156aa2,_0x4a26e4)=>{_0x35ecea[_0x4a26e4]['expiry_date']=_0x156aa2;});var _0x3e8d7f=0x0;_0x35ecea[_0x3a958e(0x13b)](_0x3c79b4=>{var _0x5d47cc=_0x3a958e;(parseInt(_0x3c79b4['sale_qty'])<parseInt(_0x3c79b4[_0x5d47cc(0x1e7)])||parseInt(_0x3c79b4[_0x5d47cc(0x199)])<parseInt(_0x3c79b4[_0x5d47cc(0x1e7)])&&parseInt(_0x3c79b4[_0x5d47cc(0x13d)])>parseInt(_0x3c79b4[_0x5d47cc(0x1e7)])||parseInt(_0x3c79b4[_0x5d47cc(0x1e7)])==0x0)&&_0x3e8d7f++;});if(_0x3e8d7f!=0x0)return _0x2bfc3e['flash'](_0x3a958e(0xe0),_0x3a958e(0x1c5)),_0x495028['redirect'](_0x3a958e(0x122));const _0x1386ed=await sales_finished[_0x3a958e(0x1a4)]({'invoice':_0x5a95b9});_0x1386ed['return_data']=_0x3a958e(0x13a);const _0x18713d=await _0x1386ed[_0x3a958e(0x130)](),_0x5a64ab=new sales_return_finished({'invoice':_0x5a95b9,'customer':_0x2bfc3e[_0x3a958e(0x154)]['customer'],'date':_0x21e6cc,'warehouse_name':_0x18f0a9,'room':_0x3e1729,'ToWarehouse':_0x2f88b9,'ToRoom':_0x4876e1,'return_sale':_0x35ecea,'note':_0x5b8a55,'warehouse_cat':_0x4270c4}),_0x5891b5=await _0x5a64ab['save'](),_0x4c02ca=await sales_return_finished[_0x3a958e(0x1a4)]({'invoice':_0x5a95b9}),_0x3c671e=await warehouse['findOne']({'name':_0x2f88b9,'room':_0x4876e1,'warehouse_category':_0x3a958e(0x1cb)});_0x4c02ca['return_sale'][_0x3a958e(0x13b)](_0x357619=>{var _0x7d88ac=_0x3a958e,_0x417aeb=0x0;const _0x511517=_0x3c671e[_0x7d88ac(0x1f2)][_0x7d88ac(0x111)](_0x47864e=>{var _0x46ce08=_0x7d88ac;_0x47864e[_0x46ce08(0x1a6)]==_0x357619[_0x46ce08(0x1a6)]&&_0x47864e[_0x46ce08(0x18e)]==_0x357619[_0x46ce08(0x18e)]&&_0x47864e[_0x46ce08(0x192)]==_0x357619['expiry_date']&&_0x47864e[_0x46ce08(0xe3)]==_0x357619[_0x46ce08(0xe3)]&&_0x47864e[_0x46ce08(0x133)]==_0x357619[_0x46ce08(0x133)]&&(_0x47864e[_0x46ce08(0x1f3)]=parseInt(_0x47864e[_0x46ce08(0x1f3)])+parseInt(_0x357619[_0x46ce08(0x1e7)]),_0x417aeb++);});_0x417aeb=='0'&&(_0x3c671e[_0x7d88ac(0x1f2)]=_0x3c671e['product_details'][_0x7d88ac(0x16f)]({'product_name':_0x357619[_0x7d88ac(0x1a6)],'product_stock':_0x357619[_0x7d88ac(0x1e7)],'primary_code':_0x357619[_0x7d88ac(0xf6)],'secondary_code':_0x357619[_0x7d88ac(0x124)],'product_code':_0x357619[_0x7d88ac(0x1bd)],'bay':_0x357619[_0x7d88ac(0x18e)],'batch_code':_0x357619[_0x7d88ac(0x133)],'maxPerUnit':_0x357619[_0x7d88ac(0xed)],'production_date':_0x357619['production_date'],'expiry_date':_0x357619[_0x7d88ac(0x192)],'secondary_unit':_0x357619[_0x7d88ac(0x11d)],'unit':_0x357619[_0x7d88ac(0x115)],'maxProducts':_0x357619[_0x7d88ac(0x15c)]}));}),await _0x3c671e[_0x3a958e(0x130)](),console['log'](_0x2bfc3e['body']);const _0x1f27c8=new c_payment_data({'invoice':_0x5a95b9,'customer':_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x17f)],'reason':_0x3a958e(0x15b)});await _0x1f27c8[_0x3a958e(0x130)]();const _0x5c5cf6=await master_shop[_0x3a958e(0x18c)]();console[_0x3a958e(0x1c2)](_0x3a958e(0x1a8),_0x5c5cf6[0x0][_0x3a958e(0x120)]);const _0x59f8a8=await email_settings[_0x3a958e(0x1a4)](),_0x323c1a=await customer[_0x3a958e(0x1a4)]({'name':_0x2bfc3e[_0x3a958e(0x154)][_0x3a958e(0x17f)]});console[_0x3a958e(0x1c2)](_0x3a958e(0x16c),_0x323c1a);_0x5c5cf6[0x0]['currency_placement']==0x1?(right_currency=_0x5c5cf6[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5c5cf6[0x0][_0x3a958e(0x1aa)]);var _0x2bcbe3=_0xa56712,_0xf593db=_0x1afeb3,_0x33c81f='',_0x2f93bc;for(_0x2f93bc in _0x2bcbe3){_0x33c81f+=_0x3a958e(0x168)+_0x3a958e(0x1df)+_0x2bcbe3[_0x2f93bc]+_0x3a958e(0x1ab)+_0x3a958e(0x1df)+_0xf593db[_0x2f93bc]+_0x3a958e(0x1ab)+'</tr>';}console[_0x3a958e(0x1c2)]('product_list',_0x33c81f);let _0x54bb51=nodemailer[_0x3a958e(0x1db)]({'service':_0x3a958e(0x147),'auth':{'user':_0x59f8a8[_0x3a958e(0x129)],'pass':_0x59f8a8['password']}}),_0x1f9231={'from':_0x59f8a8[_0x3a958e(0x129)],'to':_0x323c1a[_0x3a958e(0x129)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x3a958e(0x10d),'path':__dirname+_0x3a958e(0x1e5)+_0x3a958e(0x145)+_0x5c5cf6[0x0][_0x3a958e(0x120)],'cid':_0x3a958e(0x1e3)}],'html':_0x3a958e(0x181)+'<html><head><title></title>'+'</head><body>'+_0x3a958e(0x1a1)+_0x3a958e(0x10f)+_0x3a958e(0x1a1)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3a958e(0x15f)+'<div>'+_0x3a958e(0x1ea)+_0x5c5cf6[0x0][_0x3a958e(0x15d)]+_0x3a958e(0xf2)+'</div>'+_0x3a958e(0x15f)+_0x3a958e(0xe6)+_0x3a958e(0x1a1)+_0x3a958e(0x1e2)+_0x3a958e(0x1af)+_0x5a95b9+'\x20'+_0x3a958e(0xfc)+_0x3a958e(0xef)+_0x21e6cc+'\x20'+_0x3a958e(0x144)+'</h5>'+_0x3a958e(0x15f)+_0x3a958e(0x156)+_0x3a958e(0x19e)+'<tr>'+_0x3a958e(0x126)+_0x3a958e(0x16b)+_0x3a958e(0x146)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x3a958e(0x17a)+'</thead>'+_0x3a958e(0xe2)+'\x20'+_0x33c81f+'\x20'+_0x3a958e(0x119)+_0x3a958e(0x1c6)+_0x3a958e(0x1a1)+_0x3a958e(0x107)+_0x3a958e(0x165)+_0x5c5cf6[0x0][_0x3a958e(0x15d)]+_0x3a958e(0x131)+'</div>'+_0x3a958e(0x15f)+_0x3a958e(0x1f4)};_0x54bb51['sendMail'](_0x1f9231,function(_0x30b996,_0x125a22){var _0x139a9a=_0x3a958e;_0x30b996?(console[_0x139a9a(0x1c2)](_0x30b996),console[_0x139a9a(0x1c2)](_0x139a9a(0x14f))):console['log'](_0x139a9a(0x143));}),_0x2bfc3e[_0x3a958e(0x1be)](_0x3a958e(0x150),'sales\x20item\x20return\x20successfull'),_0x495028['redirect'](_0x3a958e(0x184));}catch(_0x18466d){console['log'](_0x18466d),_0x495028[_0x3a958e(0xeb)](0xc8)[_0x3a958e(0x17b)]({'message1':_0x18466d['message']});}}}),router[a0_0x51978a(0x1e0)](a0_0x51978a(0x12e),auth,async(_0x3c93dc,_0x46605f)=>{var _0x32a18b=a0_0x51978a;try{const {username:_0x2b31be,email:_0x268c91,role:_0x33f258}=_0x3c93dc[_0x32a18b(0x1d2)],_0x4e322e=_0x3c93dc[_0x32a18b(0x1d2)],_0x2f8e36=await profile[_0x32a18b(0x1a4)]({'email':_0x4e322e['email']}),_0x2ce568=await master_shop[_0x32a18b(0x18c)]();console[_0x32a18b(0x1c2)]('barcode\x20Product\x20master',_0x2ce568);const _0x28e54c=_0x3c93dc['params']['id'],_0x474678=await sales[_0x32a18b(0x185)](_0x28e54c);console[_0x32a18b(0x1c2)](_0x32a18b(0x1c1),_0x474678);if(_0x2ce568[0x0]['language']==_0x32a18b(0x136))var _0x11173f=users['English'];else{if(_0x2ce568[0x0][_0x32a18b(0x1ed)]=='Hindi')var _0x11173f=users['Hindi'];else{if(_0x2ce568[0x0][_0x32a18b(0x1ed)]==_0x32a18b(0x141))var _0x11173f=users[_0x32a18b(0x141)];else{if(_0x2ce568[0x0][_0x32a18b(0x1ed)]==_0x32a18b(0xe4))var _0x11173f=users[_0x32a18b(0xe4)];else{if(_0x2ce568[0x0][_0x32a18b(0x1ed)]==_0x32a18b(0xdc))var _0x11173f=users[_0x32a18b(0xdc)];else{if(_0x2ce568[0x0][_0x32a18b(0x1ed)]==_0x32a18b(0x1ef))var _0x11173f=users[_0x32a18b(0x18f)];else{if(_0x2ce568[0x0][_0x32a18b(0x1ed)]==_0x32a18b(0xec))var _0x11173f=users[_0x32a18b(0xec)];else{if(_0x2ce568[0x0][_0x32a18b(0x1ed)]==_0x32a18b(0x1ba))var _0x11173f=users[_0x32a18b(0x1ee)];}}}}}}}_0x46605f['render'](_0x32a18b(0x12d),{'success':_0x3c93dc[_0x32a18b(0x1be)]('success'),'errors':_0x3c93dc[_0x32a18b(0x1be)](_0x32a18b(0xe0)),'role':_0x4e322e,'profile':_0x2f8e36,'alldata':_0x474678,'master_shop':_0x2ce568,'language':_0x11173f});}catch(_0x312703){console[_0x32a18b(0x1c2)](_0x312703);}}),router[a0_0x51978a(0x127)](a0_0x51978a(0x1ce),async(_0x93e1ae,_0xc80745)=>{var _0x26c3b1=a0_0x51978a;const {product_code:_0x4e0379,warehouse_name:_0x422868,rooms_data:_0x30e854,Roomslist:_0x3094b2}=_0x93e1ae[_0x26c3b1(0x154)],_0x70c23e=_0x3094b2[_0x26c3b1(0x198)](','),_0x451621=[];async function _0x272d3d(_0x219cbe){var _0x2d9781=_0x26c3b1;const _0xfa4b0=await warehouse['aggregate']([{'$match':{'name':_0x422868,'room':_0x219cbe}},{'$unwind':_0x2d9781(0x19d)},{'$match':{'product_details.primary_code':_0x4e0379}},{'$group':{'_id':_0x2d9781(0x1c7),'name':{'$first':_0x2d9781(0x152)},'product_stock':{'$first':_0x2d9781(0x171)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2d9781(0x1b8)},'product_code':{'$first':_0x2d9781(0x157)},'level':{'$first':_0x2d9781(0x160)},'isle':{'$first':_0x2d9781(0x135)},'type':{'$first':_0x2d9781(0xe1)},'pallet':{'$first':_0x2d9781(0x10a)},'unit':{'$first':_0x2d9781(0x1e9)},'secondary_unit':{'$first':_0x2d9781(0x153)},'storage':{'$first':_0x2d9781(0x182)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2d9781(0x1cc)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2d9781(0x167)},'product_cat':{'$first':_0x2d9781(0x1e8)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2d9781(0x17d)}}}]),_0x3a7a94=await warehouse['aggregate']([{'$match':{'name':_0x422868,'room':_0x219cbe}},{'$unwind':_0x2d9781(0x19d)},{'$match':{'product_details.secondary_code':_0x4e0379}},{'$group':{'_id':_0x2d9781(0x1c7),'name':{'$first':_0x2d9781(0x152)},'product_stock':{'$first':_0x2d9781(0x171)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2d9781(0x157)},'level':{'$first':_0x2d9781(0x160)},'isle':{'$first':_0x2d9781(0x135)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2d9781(0x10a)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2d9781(0x153)},'storage':{'$first':_0x2d9781(0x182)},'rack':{'$first':_0x2d9781(0x179)},'expiry_date':{'$first':_0x2d9781(0x1ae)},'production_date':{'$first':_0x2d9781(0x1cc)},'maxPerUnit':{'$first':_0x2d9781(0x196)},'batch_code':{'$first':_0x2d9781(0x167)},'product_cat':{'$first':_0x2d9781(0x1e8)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2d9781(0xfa)},'invoice':{'$first':_0x2d9781(0x17d)}}}]);if(_0xfa4b0[_0x2d9781(0x11b)]>0x0)_0x451621['push'](_0xfa4b0);else _0x3a7a94[_0x2d9781(0x11b)]>0x0&&_0x451621[_0x2d9781(0x17e)](_0x3a7a94);}const _0x21916e=_0x70c23e[_0x26c3b1(0x111)](_0x4c1d69=>_0x272d3d(_0x4c1d69));await Promise[_0x26c3b1(0x101)](_0x21916e),_0xc80745['json'](_0x451621);}),module[a0_0x51978a(0x11f)]=router;