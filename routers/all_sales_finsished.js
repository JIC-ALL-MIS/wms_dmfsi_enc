var a0_0x58c878=a0_0x4764;function a0_0x22da(){var _0x321bd1=['<!DOCTYPE\x20html>','note','max','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$customers_docs','</span>','\x20==\x20','$product_details.primary_code','Sales\x20Update\x20successfully','adjust_qty','stock_data','$product_details.production_date','/view/:id','expiry_date_QA','</thead>','sale_product','customers_docs','$product.product_name','<h5>','\x20</h2>','foreach\x20newproduct','329152bhMEMA','Arabic','/../public','getFullYear','host','image','../models/all_models','return_qty','random','prod_cat','</td>','map','error','staff','return_sale','success','\x20&&\x20','room','Add\x20Sales','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Sales\x20Mail','quantity','Sale','Return\x20Goods','prod_invoice','role','user','An\x20error\x20occurred\x20while\x20saving\x20data.','$sale_product.type','all','master','$product_details.secondary_unit','/view/add_sales','log','\x20<<<==>>>\x20','Router','push','FGSEmail','prod_code','Sale\x20Return','bay','product_stock','secondary_unit_QA','secondary_code_QA','$sale_product.floorlevel','length','$customer','id_transaction_from','getDate','Sale\x20Return\x20Mail','primary_code','aggregate','sales_quantity','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Return\x20Rooms','port','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','post','$_id','production_date_QA','add_sales_finished','<strong>\x20Regards\x20</strong>','params','$warehouse_name','invoice','amount','$product_details.floorlevel','$name','customers','expiry_date','$product_details.batch_code','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.product_name','$product_details.bin','$product_details.type','findOne','<div>','language','date','$product_details.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Sales\x20Add\x20successfully','currency_placement','<hr\x20class=\x22my-3\x22>','product_details','getMonth','errors','received_amount','product_name_QA1','/give_payment/:id','final','Error\x20Occurs','site_title','<tbody\x20style=\x22text-align:\x20center;\x22>','Ambient','for_categorize','Arabic\x20(ae)','product_code_QA','maxProducts_QA','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Enabled','German','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','product_data','primary_unit','maxPerUnit','$product_details.unit','password','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','../public/language/languages.json','<tr>','18RPlgrN','sendMail','Quality\x20Inspection','/invoice/:id','French','/picking_list/pdf/','return_sale_QA','$sale_product.bin','redirect','$product_details.maxPerUnit','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','OUTF-','<h2>\x20','Email\x20sent\x20successfully','flash','True','return_data','back','product_name','body','render','$product_details.product_code','level','62826IuylRy','\x20<>\x20','warehouse_name','stocks_QA','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</tr>','concat','RoomAssigned','QA\x20Warehouse','maxProducts','<html><head><title></title>','Portuguese\x20(BR)','92WYsyRw','carton','$product_details','$date','primary_code_QA','unit','production_date','padStart','batch_code_QA','secondary_unit','suppliers','/all_sales_finished/view','</tbody>','add\x20post','$sale_product','gmail','max_per_unit','$product_details.maxProducts','$product_details.rack','1896032pQimWS','$product_details.expiry_date','string','christian.villamer@jakagroup.com','English','An\x20error\x20occurred.','maxPerUnit_QA','json','_id','all_sales_barcode','stock','/barcode/:id','return_qty_QA','Hindi','currency','30274389vvnyBD','$finalize','createTransport','/all_sales_finished/preview/','</h5>','2463574sgFxMc','\x20Order\x20Date\x20:\x20','warehouse','abs','/upload/','Finished\x20Goods','customer','$return_data','$sale_product.quantity','sales\x20item\x20return\x20successfull','/preview/:id','batch_code','finalize','unit_QA','filter','$product_details._id','split','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.product_cat','False','customer_data','/view/add_sales/:id','\x20Order\x20Number\x20:\x20','find','name','Portuguese','$sale_product.bay','1174453jYjarc','logo','forEach','1462595ianNkv','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Logo.png','$product_details.invoice','barcode\x20user_id','Enclosed','<span\x20style=\x22float:\x20right;\x22>','</div>','$note','product_code','<table\x20style=\x22width:\x20100%\x20!important;\x22>','express','</body></html>','status','get','product_date','$room','$product_details.secondary_code','Chinese','edit_sales_finished','catch','</head><body>','exports','slice','sale_qty','<h5\x20style=\x22text-align:\x20left;\x22>','product_list','email','</table>','room_name','save','$product_details.product_stock','$product_details.room_name','/view/return_sales/:id','/view'];a0_0x22da=function(){return _0x321bd1;};return a0_0x22da();}(function(_0x215f6e,_0x5e64fb){var _0xea71b0=a0_0x4764,_0x27181c=_0x215f6e();while(!![]){try{var _0x13091e=-parseInt(_0xea71b0(0x2a4))/0x1+-parseInt(_0xea71b0(0x24c))/0x2+-parseInt(_0xea71b0(0x219))/0x3*(parseInt(_0xea71b0(0x225))/0x4)+parseInt(_0xea71b0(0x26a))/0x5*(-parseInt(_0xea71b0(0x201))/0x6)+parseInt(_0xea71b0(0x267))/0x7+parseInt(_0xea71b0(0x238))/0x8+parseInt(_0xea71b0(0x247))/0x9;if(_0x13091e===_0x5e64fb)break;else _0x27181c['push'](_0x27181c['shift']());}catch(_0x122f59){_0x27181c['push'](_0x27181c['shift']());}}}(a0_0x22da,0xcf23a));const express=require(a0_0x58c878(0x277)),app=express(),router=express[a0_0x58c878(0x1b1)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x58c878(0x2aa)),auth=require('../middleware/auth'),nodemailer=require('nodemailer'),users=require(a0_0x58c878(0x1ff));router[a0_0x58c878(0x27a)](a0_0x58c878(0x28e),auth,async(_0x479804,_0x47a825)=>{var _0x3c670d=a0_0x58c878;try{const {username:_0x297b05,email:_0x3c72e7,role:_0x48241f}=_0x479804['user'],_0x5dd7a9=_0x479804[_0x3c670d(0x1a8)],_0x209cb2=await profile[_0x3c670d(0x1db)]({'email':_0x5dd7a9[_0x3c670d(0x287)]}),_0x4f85ea=await master_shop[_0x3c670d(0x263)]();let _0xcb82ec;if(_0x5dd7a9[_0x3c670d(0x1a7)]==_0x3c670d(0x2b1)){const _0x1c6a7e=await staff[_0x3c670d(0x1db)]({'email':_0x5dd7a9[_0x3c670d(0x287)]});_0xcb82ec=await sales_finished[_0x3c670d(0x1c1)]([{'$lookup':{'from':_0x3c670d(0x1d3),'localField':'customer','foreignField':_0x3c670d(0x264),'as':'customers_docs'}},{'$unwind':_0x3c670d(0x293)},{'$unwind':_0x3c670d(0x233)},{'$group':{'_id':_0x3c670d(0x1c9),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x3c670d(0x228)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3c670d(0x233)},'note':{'$first':_0x3c670d(0x274)},'return_data':{'$first':_0x3c670d(0x253)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x3c670d(0x254)},'level':{'$addToSet':_0x3c670d(0x266)},'isle':{'$addToSet':_0x3c670d(0x208)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x3c670d(0x1ba)},'finalize':{'$first':_0x3c670d(0x248)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0xcb82ec=await sales_finished[_0x3c670d(0x1c1)]([{'$lookup':{'from':_0x3c670d(0x1d3),'localField':_0x3c670d(0x252),'foreignField':_0x3c670d(0x264),'as':_0x3c670d(0x29f)}},{'$unwind':_0x3c670d(0x293)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x3c670d(0x1c9),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3c670d(0x1bc)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3c670d(0x1ce)},'sale_product':{'$push':_0x3c670d(0x233)},'note':{'$first':_0x3c670d(0x274)},'return_data':{'$first':_0x3c670d(0x253)},'customers_docs':{'$first':_0x3c670d(0x293)},'total_saleproduct_quantity':{'$sum':_0x3c670d(0x254)},'level':{'$addToSet':_0x3c670d(0x266)},'isle':{'$addToSet':_0x3c670d(0x208)},'type':{'$addToSet':_0x3c670d(0x1aa)},'pallet':{'$addToSet':_0x3c670d(0x1ba)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x4f85ea[0x0][_0x3c670d(0x1dd)]==_0x3c670d(0x1d6)){var _0x47dd21=users[_0x3c670d(0x23c)];console[_0x3c670d(0x1af)](_0x47dd21);}else{if(_0x4f85ea[0x0][_0x3c670d(0x1dd)]==_0x3c670d(0x245))var _0x47dd21=users['Hindi'];else{if(_0x4f85ea[0x0][_0x3c670d(0x1dd)]==_0x3c670d(0x1f5))var _0x47dd21=users['German'];else{if(_0x4f85ea[0x0][_0x3c670d(0x1dd)]==_0x3c670d(0x1fd))var _0x47dd21=users[_0x3c670d(0x1fd)];else{if(_0x4f85ea[0x0]['language']=='French')var _0x47dd21=users[_0x3c670d(0x205)];else{if(_0x4f85ea[0x0][_0x3c670d(0x1dd)]==_0x3c670d(0x224))var _0x47dd21=users[_0x3c670d(0x265)];else{if(_0x4f85ea[0x0]['language']==_0x3c670d(0x27e))var _0x47dd21=users[_0x3c670d(0x27e)];else{if(_0x4f85ea[0x0][_0x3c670d(0x1dd)]=='Arabic\x20(ae)')var _0x47dd21=users[_0x3c670d(0x2a5)];}}}}}}}_0x47a825[_0x3c670d(0x216)]('all_sales_finished',{'success':_0x479804['flash'](_0x3c670d(0x2b3)),'errors':_0x479804['flash'](_0x3c670d(0x1e6)),'sales':_0xcb82ec,'profile':_0x209cb2,'role':_0x5dd7a9,'master_shop':_0x4f85ea,'language':_0x47dd21});}catch(_0xe90e6e){console[_0x3c670d(0x1af)](_0xe90e6e);}});async function getRandom8DigitNumber(){var _0x25ac5a=a0_0x58c878;const _0x3d79d1=0x989680,_0x527c32=0x5f5e0ff,_0x3caefb=Math['floor'](Math[_0x25ac5a(0x2ac)]()*(_0x527c32-_0x3d79d1+0x1))+_0x3d79d1;var _0x55b1a6;const _0x375165=await sales_finished[_0x25ac5a(0x1db)]({'invoice':_0x25ac5a(0x20d)+_0x3caefb});return _0x375165&&_0x375165['length']>0x0?_0x55b1a6=_0x25ac5a(0x20d)+_0x3caefb:_0x55b1a6=_0x25ac5a(0x20d)+_0x3caefb,_0x55b1a6;}function a0_0x4764(_0x50faed,_0x239dab){var _0x22da88=a0_0x22da();return a0_0x4764=function(_0x476427,_0x4ffc51){_0x476427=_0x476427-0x1a5;var _0x22e778=_0x22da88[_0x476427];return _0x22e778;},a0_0x4764(_0x50faed,_0x239dab);}router[a0_0x58c878(0x27a)](a0_0x58c878(0x1ae),auth,async(_0x4abb78,_0x557933)=>{var _0x59c33e=a0_0x58c878;try{const {username:_0x5767b1,email:_0x539543,role:_0x3870f0}=_0x4abb78[_0x59c33e(0x1a8)],_0x5452c4=_0x4abb78[_0x59c33e(0x1a8)],_0x32cd02=await profile[_0x59c33e(0x1db)]({'email':_0x5452c4[_0x59c33e(0x287)]}),_0x128ad3=await master_shop[_0x59c33e(0x263)](),_0x5c93af=await customer[_0x59c33e(0x263)]({});let _0x30f423;if(_0x5452c4['role']=='staff'){const _0x524c3b=await staff['findOne']({'email':_0x5452c4[_0x59c33e(0x287)]});_0x30f423=await warehouse[_0x59c33e(0x1c1)]([{'$match':{'status':_0x59c33e(0x1f4),'name':_0x524c3b[_0x59c33e(0x24e)],'warehouse_category':_0x59c33e(0x251),'name':{'$ne':_0x59c33e(0x221)}}},{'$group':{'_id':_0x59c33e(0x1d2),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x30f423=await warehouse[_0x59c33e(0x1c1)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x727ffc=await product[_0x59c33e(0x263)]({});var _0x13606d=['Ambient',_0x59c33e(0x271)];const _0x51ecce=await sales_finished[_0x59c33e(0x263)]({}),_0x33c314=_0x51ecce[_0x59c33e(0x1bb)]+0x1,_0x4f1056='OUTF-'+_0x33c314['toString']()[_0x59c33e(0x22c)](0x5,'0');if(_0x128ad3[0x0][_0x59c33e(0x1dd)]=='English\x20(US)'){var _0x2a6f0a=users[_0x59c33e(0x23c)];console[_0x59c33e(0x1af)](_0x2a6f0a);}else{if(_0x128ad3[0x0]['language']=='Hindi')var _0x2a6f0a=users[_0x59c33e(0x245)];else{if(_0x128ad3[0x0][_0x59c33e(0x1dd)]==_0x59c33e(0x1f5))var _0x2a6f0a=users[_0x59c33e(0x1f5)];else{if(_0x128ad3[0x0]['language']==_0x59c33e(0x1fd))var _0x2a6f0a=users[_0x59c33e(0x1fd)];else{if(_0x128ad3[0x0][_0x59c33e(0x1dd)]==_0x59c33e(0x205))var _0x2a6f0a=users[_0x59c33e(0x205)];else{if(_0x128ad3[0x0]['language']==_0x59c33e(0x224))var _0x2a6f0a=users[_0x59c33e(0x265)];else{if(_0x128ad3[0x0][_0x59c33e(0x1dd)]==_0x59c33e(0x27e))var _0x2a6f0a=users['Chinese'];else{if(_0x128ad3[0x0]['language']==_0x59c33e(0x1f0))var _0x2a6f0a=users[_0x59c33e(0x2a5)];}}}}}}}const _0x464059=getRandom8DigitNumber();_0x464059['then'](_0x55d898=>{var _0x5ec012=_0x59c33e;_0x557933[_0x5ec012(0x216)](_0x5ec012(0x1cb),{'success':_0x4abb78[_0x5ec012(0x210)](_0x5ec012(0x2b3)),'errors':_0x4abb78[_0x5ec012(0x210)](_0x5ec012(0x1e6)),'role':_0x5452c4,'profile':_0x32cd02,'customer':_0x5c93af,'warehouse':_0x30f423,'product':_0x727ffc,'invoice':_0x55d898,'master_shop':_0x128ad3,'language':_0x2a6f0a,'rooms_data':_0x13606d});})[_0x59c33e(0x280)](_0x1e830a=>{var _0x47def2=_0x59c33e;_0x4abb78[_0x47def2(0x210)]('errors',_0x47def2(0x21d)),_0x557933['redirect'](_0x47def2(0x230));});}catch(_0x319295){console['log'](_0x319295);}}),router[a0_0x58c878(0x27a)](a0_0x58c878(0x261),auth,async(_0x4477e5,_0x580cbc)=>{var _0x395c1d=a0_0x58c878;try{const _0x2e4eaf=_0x4477e5[_0x395c1d(0x1cd)]['id'];console['log'](_0x2e4eaf);const _0x569ce7=await product[_0x395c1d(0x263)](),_0x4842f6=await purchases[_0x395c1d(0x1c1)]([{'$match':{'warehouse_name':_0x2e4eaf}},{'$unwind':'$product'},{'$group':{'_id':_0x395c1d(0x2a0)}}]);console[_0x395c1d(0x1af)]('purchases_data',_0x4842f6),_0x580cbc['status'](0xc8)[_0x395c1d(0x23f)]({'purchases_data':_0x4842f6,'product_data':_0x569ce7});}catch(_0x418807){console[_0x395c1d(0x1af)](_0x418807);}}),router[a0_0x58c878(0x1c8)]('/view/add_sale/product',auth,async(_0x57645e,_0x5f47d3)=>{var _0x208bea=a0_0x58c878;try{const {warehouse_data:_0x8dcb3c,product_data:_0x133347}=_0x57645e[_0x208bea(0x215)];console['log'](_0x57645e[_0x208bea(0x215)][_0x208bea(0x1f8)]);;const _0x3a7760=await master_shop['find']();console[_0x208bea(0x1af)](_0x208bea(0x1ac),_0x3a7760);const _0x81913b=await product[_0x208bea(0x1db)]({'name':_0x133347});console['log']('product',_0x81913b);const _0x4213cf=await warehouse['aggregate']([{'$match':{'name':_0x8dcb3c}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x133347}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x208bea(0x1af)](_0x208bea(0x299),_0x4213cf),_0x5f47d3['status'](0xc8)[_0x208bea(0x23f)]({'master':_0x3a7760,'new_product':_0x81913b,'stock_data':_0x4213cf});}catch(_0x3017e1){console['log'](_0x3017e1);}}),router['post']('/view/add_sales',auth,async(_0x531a79,_0x327428)=>{var _0x5f31d0=a0_0x58c878;try{const {invoice:_0x4723d9,date:_0x4de3d0,warehouse_name:_0xf6787d,product_name:_0x1eaa8b,stock:_0x1a8c93,quantity:_0xf4d075,note:_0x3894cd,room:_0x5da8ca,primary_code:_0x196293,secondary_code:_0x49ce63,prod_code:_0x23ef23,level:_0x2b6728,isle:_0x4b04a0,pallet:_0x1df0f3,batch_code:_0x2944dc,SCRN:_0x4eacc2,expiry_date:_0x44b03b,mode_transpo:_0x52f61c,name_driver:_0x24be71}=_0x531a79[_0x5f31d0(0x215)];if(typeof _0x1eaa8b==_0x5f31d0(0x23a))var _0x5469f0=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x214)]],_0x406c1b=[_0x531a79[_0x5f31d0(0x215)]['stock']],_0x3d6a23=[_0x531a79[_0x5f31d0(0x215)]['carton']],_0x26bbe9=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1c0)]],_0x1c4c31=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1f6)]],_0x3399c7=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1b4)]],_0x9654a6=[_0x531a79['body'][_0x5f31d0(0x218)]],_0x1b4e31=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1f9)]],_0x47dd1c=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x22e)]],_0x2031a4=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x257)]],_0x2fdb4f=[_0x531a79[_0x5f31d0(0x215)]['expiry_date']],_0x2eb33f=[_0x531a79['body']['product_date']],_0x15cfa8=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x235)]],_0x3a02e5=[_0x531a79[_0x5f31d0(0x215)]['prod_cat']],_0x1e68a8=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x220)]],_0x3d5dbc=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1a6)]],_0x5418bf=[_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1bd)]];else var _0x5469f0=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x214)]],_0x406c1b=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x242)]],_0x3d6a23=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x226)]],_0x26bbe9=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1c0)]],_0x1c4c31=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1f6)]],_0x3399c7=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1b4)]],_0x9654a6=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x218)]],_0x1b4e31=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1f9)]],_0x47dd1c=[..._0x531a79['body'][_0x5f31d0(0x22e)]],_0x2031a4=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x257)]],_0x2fdb4f=[..._0x531a79[_0x5f31d0(0x215)]['expiry_date']],_0x2eb33f=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x27b)]],_0x15cfa8=[..._0x531a79['body']['max_per_unit']],_0x3a02e5=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x2ad)]],_0x1e68a8=[..._0x531a79['body'][_0x5f31d0(0x220)]],_0x3d5dbc=[..._0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x1a6)]],_0x5418bf=[..._0x531a79['body']['id_transaction_from']];const _0x40ff9e=_0x5469f0[_0x5f31d0(0x2af)](_0x38e94b=>{return _0x38e94b={'product_name':_0x38e94b};});_0x406c1b['forEach']((_0x4cb005,_0x57691a)=>{var _0x348e61=_0x5f31d0;_0x40ff9e[_0x57691a][_0x348e61(0x242)]=_0x4cb005;}),_0x3d6a23[_0x5f31d0(0x269)]((_0x334bc1,_0x274bee)=>{var _0x467209=_0x5f31d0;_0x40ff9e[_0x274bee][_0x467209(0x2ba)]=Math[_0x467209(0x24f)](_0x334bc1);}),_0x5418bf['forEach']((_0x58cf4f,_0x379404)=>{var _0x54aeb8=_0x5f31d0;_0x40ff9e[_0x379404][_0x54aeb8(0x1bd)]=_0x58cf4f;}),_0x26bbe9[_0x5f31d0(0x269)]((_0x53d5ca,_0x5b2ad8)=>{var _0x1eec20=_0x5f31d0;_0x40ff9e[_0x5b2ad8][_0x1eec20(0x1c0)]=_0x53d5ca;}),_0x1c4c31['forEach']((_0xd90037,_0x34493c)=>{var _0x3daba9=_0x5f31d0;_0x40ff9e[_0x34493c][_0x3daba9(0x1f6)]=_0xd90037;}),_0x3399c7[_0x5f31d0(0x269)]((_0x9e7dc3,_0x380600)=>{_0x40ff9e[_0x380600]['product_code']=_0x9e7dc3;}),_0x9654a6[_0x5f31d0(0x269)]((_0x1ce300,_0x49e7ee)=>{var _0x4cc8f5=_0x5f31d0;_0x40ff9e[_0x49e7ee][_0x4cc8f5(0x1b6)]=_0x1ce300;}),_0x1b4e31[_0x5f31d0(0x269)]((_0x3c09a5,_0x5cd8d2)=>{_0x40ff9e[_0x5cd8d2]['unit']=_0x3c09a5;}),_0x47dd1c[_0x5f31d0(0x269)]((_0x363e36,_0x292108)=>{var _0x3cbfa1=_0x5f31d0;_0x40ff9e[_0x292108][_0x3cbfa1(0x22e)]=_0x363e36;}),_0x2031a4['forEach']((_0x3a7519,_0xeba4bc)=>{var _0x384386=_0x5f31d0;_0x40ff9e[_0xeba4bc][_0x384386(0x257)]=_0x3a7519;}),_0x2fdb4f['forEach']((_0x4625d8,_0x2daf93)=>{var _0x48ce3f=_0x5f31d0;_0x40ff9e[_0x2daf93][_0x48ce3f(0x1d4)]=_0x4625d8;}),_0x2eb33f[_0x5f31d0(0x269)]((_0x3e67f1,_0x1614c6)=>{var _0x1d1c98=_0x5f31d0;_0x40ff9e[_0x1614c6][_0x1d1c98(0x22b)]=_0x3e67f1;}),_0x15cfa8[_0x5f31d0(0x269)]((_0x303b33,_0x493b78)=>{_0x40ff9e[_0x493b78]['maxperunit']=_0x303b33;}),_0x3a02e5['forEach']((_0x35a07a,_0x12de52)=>{var _0x16b2c2=_0x5f31d0;_0x40ff9e[_0x12de52][_0x16b2c2(0x2ad)]=_0x35a07a;}),_0x1e68a8[_0x5f31d0(0x269)]((_0x1c042b,_0x4aa864)=>{var _0x5b4ed7=_0x5f31d0;_0x40ff9e[_0x4aa864][_0x5b4ed7(0x289)]=_0x1c042b;}),_0x3d5dbc[_0x5f31d0(0x269)]((_0x375fd9,_0x3f84bb)=>{_0x40ff9e[_0x3f84bb]['invoice']=_0x375fd9;});var _0x31dfeb=0x0;_0x40ff9e['forEach'](_0x79a781=>{var _0x2597d0=_0x5f31d0;parseFloat(_0x79a781['stock'])<parseFloat(_0x79a781[_0x2597d0(0x2ba)])&&parseFloat(_0x79a781[_0x2597d0(0x2ba)])>parseFloat(_0x79a781['stock'])&&(console[_0x2597d0(0x1af)](_0x79a781[_0x2597d0(0x242)]+_0x2597d0(0x21a)+_0x79a781['quantity']),_0x31dfeb++);});if(_0x31dfeb!=0x0)return _0x531a79[_0x5f31d0(0x210)](_0x5f31d0(0x1e6),'Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x327428['redirect'](_0x5f31d0(0x213));const _0x5749c9=_0x40ff9e[_0x5f31d0(0x25a)](_0x16772b=>_0x16772b[_0x5f31d0(0x2ba)]!=='0'&&_0x16772b[_0x5f31d0(0x2ba)]!==''),_0x5ec587=new sales_finished({'invoice':_0x4723d9,'customer':_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x252)],'date':_0x4de3d0,'warehouse_name':_0xf6787d,'sale_product':_0x5749c9,'note':_0x3894cd,'room':_0x5da8ca,'primary_code':_0x196293,'secondary_code':_0x49ce63,'prod_code':_0x23ef23,'SCRN':_0x4eacc2,'finalize':_0x5f31d0(0x25f),'mode_transpo':_0x52f61c,'name_driver':_0x24be71}),_0x29a29e=await _0x5ec587[_0x5f31d0(0x28a)](),_0x44a544=await sales_finished['findOne']({'invoice':_0x4723d9}),_0x101fc7=new c_payment_data({'invoice':_0x4723d9,'customer':_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x252)],'reason':_0x5f31d0(0x2bb)});await _0x101fc7[_0x5f31d0(0x28a)]();const _0x497e05=await master_shop[_0x5f31d0(0x263)](),_0x5c0c58=await email_settings[_0x5f31d0(0x1db)](),_0xdbbf7e=await customer[_0x5f31d0(0x1db)]({'name':_0x531a79[_0x5f31d0(0x215)][_0x5f31d0(0x252)]});_0x497e05[0x0][_0x5f31d0(0x1e2)]==0x1?(right_currency=_0x497e05[0x0][_0x5f31d0(0x246)],left_currency=''):(right_currency='',left_currency=_0x497e05[0x0][_0x5f31d0(0x246)]);var _0x10f2d8=_0x5469f0,_0x429d39=_0x3d6a23,_0x356a36='',_0x152710;for(_0x152710 in _0x10f2d8){_0x356a36+=_0x5f31d0(0x200)+_0x5f31d0(0x1f3)+_0x10f2d8[_0x152710]+_0x5f31d0(0x2ae)+_0x5f31d0(0x1f3)+_0x429d39[_0x152710]+'</td>'+_0x5f31d0(0x21e);}console[_0x5f31d0(0x1af)](_0x5f31d0(0x286),_0x356a36);let _0x5a79d4=nodemailer[_0x5f31d0(0x249)]({'host':_0x5c0c58[_0x5f31d0(0x2a8)],'port':Number(_0x5c0c58[_0x5f31d0(0x1c6)]),'secure':![],'service':_0x5f31d0(0x234),'auth':{'user':_0x5c0c58[_0x5f31d0(0x287)],'pass':_0x5c0c58[_0x5f31d0(0x1fc)]}}),_0x24ef11={'from':_0x5c0c58[_0x5f31d0(0x287)],'to':_0x5f31d0(0x23b),'subject':_0x5f31d0(0x2b6),'attachments':[{'filename':_0x5f31d0(0x26e),'path':__dirname+_0x5f31d0(0x2a6)+_0x5f31d0(0x250)+_0x497e05[0x0][_0x5f31d0(0x2a9)],'cid':_0x5f31d0(0x268)}],'html':'ADD\x20SALE'};_0x5a79d4[_0x5f31d0(0x202)](_0x24ef11,function(_0x3da1e0,_0x10e807){var _0x138d41=_0x5f31d0;_0x3da1e0?(console[_0x138d41(0x1af)](_0x3da1e0),console[_0x138d41(0x1af)](_0x138d41(0x1eb))):console[_0x138d41(0x1af)](_0x138d41(0x20f));}),_0x531a79[_0x5f31d0(0x210)]('success',_0x5f31d0(0x1e1)),_0x327428[_0x5f31d0(0x209)](_0x5f31d0(0x24a)+_0x29a29e[_0x5f31d0(0x240)]);}catch(_0x2ef075){console[_0x5f31d0(0x1af)](_0x2ef075);}}),router[a0_0x58c878(0x27a)]('/preview/:id',auth,async(_0x517b84,_0x5987f7)=>{var _0x1ddc9b=a0_0x58c878;try{const {username:_0x393046,email:_0x30d36a,role:_0x2d2321}=_0x517b84[_0x1ddc9b(0x1a8)],_0x125825=_0x517b84[_0x1ddc9b(0x1a8)],_0x1ee661=await profile[_0x1ddc9b(0x1db)]({'email':_0x125825[_0x1ddc9b(0x287)]}),_0x5657ad=await master_shop[_0x1ddc9b(0x263)](),_0x145fc1=_0x517b84[_0x1ddc9b(0x1cd)]['id'],_0x587229=await sales_finished[_0x1ddc9b(0x26b)](_0x145fc1),_0x17b50c=await warehouse[_0x1ddc9b(0x1c1)]([{'$match':{'name':_0x587229[_0x1ddc9b(0x21b)]}},{'$unwind':_0x1ddc9b(0x227)},{'$group':{'_id':_0x1ddc9b(0x25b),'name':{'$first':_0x1ddc9b(0x1d8)},'product_stock':{'$first':_0x1ddc9b(0x28b)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1ddc9b(0x296)},'secondary_code':{'$first':_0x1ddc9b(0x27d)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1ddc9b(0x237)},'expiry_date':{'$first':_0x1ddc9b(0x239)},'production_date':{'$first':_0x1ddc9b(0x29a)},'batch_code':{'$first':_0x1ddc9b(0x1d5)},'room':{'$first':_0x1ddc9b(0x27c)},'room_data':{'$first':_0x1ddc9b(0x28c)}}}]),_0x3c6376=await customer[_0x1ddc9b(0x263)]({});let _0x57dfac;if(_0x125825[_0x1ddc9b(0x1a7)]=='staff'){const _0x3740c3=await staff[_0x1ddc9b(0x1db)]({'email':_0x125825['email']});_0x57dfac=await warehouse[_0x1ddc9b(0x1c1)]([{'$match':{'status':_0x1ddc9b(0x1f4),'name':_0x3740c3[_0x1ddc9b(0x24e)]}},{'$group':{'_id':_0x1ddc9b(0x1d2),'name':{'$first':'$name'}}}]);}else _0x57dfac=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x1ddc9b(0x1d2),'name':{'$first':'$name'}}}]);const _0x42a6f2=await product['find']({});if(_0x5657ad[0x0][_0x1ddc9b(0x1dd)]=='English\x20(US)'){var _0x12504f=users[_0x1ddc9b(0x23c)];console['log'](_0x12504f);}else{if(_0x5657ad[0x0][_0x1ddc9b(0x1dd)]==_0x1ddc9b(0x245))var _0x12504f=users[_0x1ddc9b(0x245)];else{if(_0x5657ad[0x0][_0x1ddc9b(0x1dd)]=='German')var _0x12504f=users[_0x1ddc9b(0x1f5)];else{if(_0x5657ad[0x0][_0x1ddc9b(0x1dd)]==_0x1ddc9b(0x1fd))var _0x12504f=users[_0x1ddc9b(0x1fd)];else{if(_0x5657ad[0x0]['language']=='French')var _0x12504f=users[_0x1ddc9b(0x205)];else{if(_0x5657ad[0x0][_0x1ddc9b(0x1dd)]=='Portuguese\x20(BR)')var _0x12504f=users[_0x1ddc9b(0x265)];else{if(_0x5657ad[0x0]['language']==_0x1ddc9b(0x27e))var _0x12504f=users[_0x1ddc9b(0x27e)];else{if(_0x5657ad[0x0]['language']==_0x1ddc9b(0x1f0))var _0x12504f=users[_0x1ddc9b(0x2a5)];}}}}}}}_0x5987f7[_0x1ddc9b(0x216)]('edit_sales_finished_view',{'success':_0x517b84[_0x1ddc9b(0x210)](_0x1ddc9b(0x2b3)),'errors':_0x517b84[_0x1ddc9b(0x210)](_0x1ddc9b(0x1e6)),'role':_0x125825,'profile':_0x1ee661,'customer':_0x3c6376,'warehouse':_0x57dfac,'product':_0x17b50c,'user':_0x587229,'master_shop':_0x5657ad,'unit':_0x42a6f2,'language':_0x12504f});}catch(_0x528e36){console[_0x1ddc9b(0x1af)](_0x528e36);}}),router[a0_0x58c878(0x1c8)](a0_0x58c878(0x256),auth,async(_0x4dc24d,_0x4ccd8a)=>{var _0x10fad4=a0_0x58c878;try{const _0x35e02c=_0x4dc24d['params']['id'],{invoice:_0x3a255b,warehouse_name:_0x31b072,room:_0x2f8ab4}=_0x4dc24d[_0x10fad4(0x215)],_0xdaa98=await sales_finished['findOne']({'invoice':_0x3a255b}),_0x5bfe12=_0xdaa98[_0x10fad4(0x29e)][_0x10fad4(0x2af)](async _0x43477c=>{var _0x22c7d7=_0x10fad4,_0x3cc1ad=await warehouse[_0x22c7d7(0x1db)]({'name':_0x31b072,'room':_0x43477c[_0x22c7d7(0x289)],'warehouse_category':_0x22c7d7(0x251)});const _0xd89d40=_0x3cc1ad['product_details'][_0x22c7d7(0x2af)](_0x4c21e1=>{var _0x339973=_0x22c7d7;(_0x4c21e1[_0x339973(0x214)]==_0x43477c[_0x339973(0x214)]&&_0x4c21e1[_0x339973(0x1b6)]==_0x43477c[_0x339973(0x1b6)]&&_0x4c21e1[_0x339973(0x1d4)]==_0x43477c[_0x339973(0x1d4)]&&_0x4c21e1[_0x339973(0x22b)]==_0x43477c[_0x339973(0x22b)]&&_0x4c21e1[_0x339973(0x257)]==_0x43477c[_0x339973(0x257)]&&_0x4c21e1[_0x339973(0x1cf)]==_0x43477c[_0x339973(0x1cf)]||_0x4c21e1[_0x339973(0x240)]==_0x43477c['id_transaction_from'])&&(_0x4c21e1[_0x339973(0x1b7)]>0x0&&(console['log'](_0x4c21e1[_0x339973(0x214)]+_0x339973(0x295)+_0x43477c[_0x339973(0x214)]+_0x339973(0x2b4)+_0x4c21e1[_0x339973(0x1b6)]+_0x339973(0x295)+_0x43477c[_0x339973(0x1b6)]+_0x339973(0x2b4)+_0x4c21e1[_0x339973(0x22b)]+_0x339973(0x295)+_0x43477c[_0x339973(0x22b)]+_0x339973(0x2b4)+_0x4c21e1[_0x339973(0x1d4)]+_0x339973(0x295)+_0x43477c[_0x339973(0x1d4)]+_0x339973(0x2b4)+_0x4c21e1[_0x339973(0x257)]+_0x339973(0x295)+_0x43477c[_0x339973(0x257)]+_0x339973(0x2b4)+_0x4c21e1[_0x339973(0x1cf)]+_0x339973(0x295)+_0x43477c[_0x339973(0x1cf)]+_0x339973(0x2b4)+_0x4c21e1[_0x339973(0x1b7)]+_0x339973(0x1b0)+_0x43477c[_0x339973(0x2ba)]+'\x20>>>\x20'+_0x43477c[_0x339973(0x289)]+'\x20&&\x20'+_0x4c21e1['_id']+_0x339973(0x295)+_0x43477c[_0x339973(0x1bd)]),_0x4c21e1['product_stock']=Math[_0x339973(0x291)](0x0,Math[_0x339973(0x24f)](_0x4c21e1[_0x339973(0x1b7)])-Math[_0x339973(0x24f)](_0x43477c[_0x339973(0x2ba)]))));});return _0x3cc1ad;});Promise[_0x10fad4(0x1ab)](_0x5bfe12)[_0x10fad4(0x2b7)](async _0x23f12d=>{var _0x53722a=_0x10fad4;try{for(const _0x4d94ef of _0x23f12d){await _0x4d94ef[_0x53722a(0x28a)]();}_0xdaa98[_0x53722a(0x258)]=_0x53722a(0x211);const _0x50e941=await _0xdaa98[_0x53722a(0x28a)](),_0x270aec=await master_shop['find'](),_0x2e0bc4=await email_settings[_0x53722a(0x1db)](),_0x45ba2e=await supervisor_settings[_0x53722a(0x263)]();var _0x3acebd=_0xdaa98[_0x53722a(0x29e)],_0x11a4d3='',_0x9474bf;for(_0x9474bf in _0x3acebd){var _0x28961a='FG';_0xdaa98[_0x53722a(0x21b)]=='DRY\x20GOODS'&&(_0x28961a='DG'),_0x11a4d3+=_0x53722a(0x200)+_0x53722a(0x1f3)+_0x3acebd[_0x9474bf][_0x53722a(0x214)]+_0x53722a(0x2ae)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3acebd[_0x9474bf][_0x53722a(0x275)]+'</td>'+_0x53722a(0x1f3)+_0x3acebd[_0x9474bf][_0x53722a(0x2ba)]+_0x53722a(0x2ae)+_0x53722a(0x1f3)+_0x3acebd[_0x9474bf][_0x53722a(0x22a)]+_0x53722a(0x2ae)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3acebd[_0x9474bf][_0x53722a(0x22e)]+'</td>'+_0x53722a(0x1f3)+_0xdaa98[_0x53722a(0x21b)]+_0x53722a(0x2ae)+_0x53722a(0x1f3)+_0x3acebd[_0x9474bf][_0x53722a(0x289)]+_0x53722a(0x2ae)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x28961a+_0x3acebd[_0x9474bf][_0x53722a(0x1b6)]+'</td>';}let _0x56d7a1=nodemailer[_0x53722a(0x249)]({'host':_0x2e0bc4['host'],'port':Number(_0x2e0bc4[_0x53722a(0x1c6)]),'secure':![],'auth':{'user':_0x2e0bc4[_0x53722a(0x287)],'pass':_0x2e0bc4[_0x53722a(0x1fc)]}}),_0x1e2a52={'from':_0x2e0bc4[_0x53722a(0x287)],'to':_0x45ba2e[0x0][_0x53722a(0x1b3)],'subject':_0x53722a(0x2b9),'attachments':[{'filename':_0x53722a(0x26e),'path':__dirname+_0x53722a(0x2a6)+_0x53722a(0x250)+_0x270aec[0x0]['image'],'cid':'logo'}],'html':_0x53722a(0x28f)+_0x53722a(0x223)+'</head><body>'+_0x53722a(0x1dc)+_0x53722a(0x292)+_0x53722a(0x1dc)+_0x53722a(0x26d)+_0x53722a(0x273)+_0x53722a(0x1dc)+_0x53722a(0x20e)+_0x270aec[0x0]['site_title']+_0x53722a(0x2a2)+_0x53722a(0x273)+_0x53722a(0x273)+_0x53722a(0x1e3)+_0x53722a(0x1dc)+_0x53722a(0x285)+_0x53722a(0x262)+_0xdaa98['invoice']+'\x20'+_0x53722a(0x272)+_0x53722a(0x24d)+_0xdaa98[_0x53722a(0x1de)]+'\x20'+_0x53722a(0x294)+_0x53722a(0x24b)+_0x53722a(0x273)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x53722a(0x200)+_0x53722a(0x1c4)+_0x53722a(0x2b8)+_0x53722a(0x1d7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x53722a(0x1fe)+_0x53722a(0x25d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x53722a(0x1f7)+_0x53722a(0x21e)+_0x53722a(0x29d)+_0x53722a(0x1ed)+'\x20'+_0x11a4d3+'\x20'+_0x53722a(0x231)+_0x53722a(0x288)+_0x53722a(0x1dc)+'<strong>\x20Regards\x20</strong>'+_0x53722a(0x2a1)+_0x270aec[0x0]['site_title']+_0x53722a(0x24b)+_0x53722a(0x273)+_0x53722a(0x273)+_0x53722a(0x278)};_0x56d7a1[_0x53722a(0x202)](_0x1e2a52,function(_0x2d3c5c,_0x2a98fa){var _0x14c91b=_0x53722a;_0x2d3c5c?(console['log'](_0x2d3c5c),console[_0x14c91b(0x1af)](_0x14c91b(0x1eb))):console['log'](_0x14c91b(0x20f));}),_0x4dc24d[_0x53722a(0x210)](_0x53722a(0x2b3),_0x53722a(0x297)),_0x4ccd8a[_0x53722a(0x209)](_0x53722a(0x206)+_0x35e02c);}catch(_0x31e601){console[_0x53722a(0x2b0)](_0x31e601),_0x4ccd8a[_0x53722a(0x279)](0x1f4)['json']({'error':_0x53722a(0x1a9)});}})[_0x10fad4(0x280)](_0x31da30=>{var _0x54cd1a=_0x10fad4;console[_0x54cd1a(0x2b0)](_0x31da30),_0x4ccd8a[_0x54cd1a(0x279)](0x1f4)['json']({'error':_0x54cd1a(0x23d)});});}catch(_0x1f74ec){console[_0x10fad4(0x1af)](_0x1f74ec);}}),router[a0_0x58c878(0x27a)](a0_0x58c878(0x29b),auth,async(_0x19eab9,_0x207f53)=>{var _0x3daaa3=a0_0x58c878;try{const {username:_0xe9404,email:_0x5a9048,role:_0x4a0c84}=_0x19eab9[_0x3daaa3(0x1a8)],_0x536b68=_0x19eab9[_0x3daaa3(0x1a8)],_0x5d404f=await profile[_0x3daaa3(0x1db)]({'email':_0x536b68[_0x3daaa3(0x287)]}),_0x73e2cc=await master_shop[_0x3daaa3(0x263)](),_0x198e9f=_0x19eab9[_0x3daaa3(0x1cd)]['id'],_0x98689d=await sales_finished['findById'](_0x198e9f);let _0x2c8ac0=new Date(_0x98689d['expiry_date']),_0x1f21ff=('0'+_0x2c8ac0[_0x3daaa3(0x1be)]())['slice'](-0x2),_0x2c1bb7=('0'+(_0x2c8ac0[_0x3daaa3(0x1e5)]()+0x1))['slice'](-0x2),_0x3e86f2=_0x2c8ac0[_0x3daaa3(0x2a7)](),_0x1ce55c=_0x3e86f2+'-'+_0x2c1bb7+'-'+_0x1f21ff;var _0x1436ad=[_0x3daaa3(0x1ee),_0x3daaa3(0x271)];const _0x31d471=await warehouse['aggregate']([{'$match':{'name':_0x98689d[_0x3daaa3(0x21b)],'room':_0x98689d[_0x3daaa3(0x2b5)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3daaa3(0x25b),'name':{'$first':_0x3daaa3(0x1d8)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3daaa3(0x1df)},'bin':{'$first':_0x3daaa3(0x1d9)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3daaa3(0x1d1)},'primary_code':{'$first':_0x3daaa3(0x296)},'secondary_code':{'$first':_0x3daaa3(0x27d)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3daaa3(0x1c3)},'rack':{'$first':'$product_details.rack'}}}]),_0x55d2e7=await customer[_0x3daaa3(0x263)]({});let _0x574271;if(_0x536b68[_0x3daaa3(0x1a7)]==_0x3daaa3(0x2b1)){const _0x1c2149=await staff[_0x3daaa3(0x1db)]({'email':_0x536b68[_0x3daaa3(0x287)]});_0x574271=await warehouse[_0x3daaa3(0x1c1)]([{'$match':{'status':_0x3daaa3(0x1f4),'name':_0x1c2149['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x3daaa3(0x1d2)}}}]);}else _0x574271=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x3daaa3(0x1d2),'name':{'$first':'$name'}}}]);const _0x5c53b2=await product[_0x3daaa3(0x263)]({});if(_0x73e2cc[0x0]['language']==_0x3daaa3(0x1d6)){var _0xb5fda0=users[_0x3daaa3(0x23c)];console[_0x3daaa3(0x1af)](_0xb5fda0);}else{if(_0x73e2cc[0x0][_0x3daaa3(0x1dd)]==_0x3daaa3(0x245))var _0xb5fda0=users[_0x3daaa3(0x245)];else{if(_0x73e2cc[0x0]['language']==_0x3daaa3(0x1f5))var _0xb5fda0=users[_0x3daaa3(0x1f5)];else{if(_0x73e2cc[0x0][_0x3daaa3(0x1dd)]==_0x3daaa3(0x1fd))var _0xb5fda0=users[_0x3daaa3(0x1fd)];else{if(_0x73e2cc[0x0]['language']==_0x3daaa3(0x205))var _0xb5fda0=users[_0x3daaa3(0x205)];else{if(_0x73e2cc[0x0][_0x3daaa3(0x1dd)]==_0x3daaa3(0x224))var _0xb5fda0=users['Portuguese'];else{if(_0x73e2cc[0x0][_0x3daaa3(0x1dd)]==_0x3daaa3(0x27e))var _0xb5fda0=users[_0x3daaa3(0x27e)];else{if(_0x73e2cc[0x0][_0x3daaa3(0x1dd)]==_0x3daaa3(0x1f0))var _0xb5fda0=users[_0x3daaa3(0x2a5)];}}}}}}}_0x207f53[_0x3daaa3(0x216)](_0x3daaa3(0x27f),{'success':_0x19eab9[_0x3daaa3(0x210)](_0x3daaa3(0x2b3)),'errors':_0x19eab9[_0x3daaa3(0x210)](_0x3daaa3(0x1e6)),'role':_0x536b68,'profile':_0x5d404f,'customer':_0x55d2e7,'warehouse':_0x574271,'product':_0x31d471,'user':_0x98689d,'master_shop':_0x73e2cc,'unit':_0x5c53b2,'language':_0xb5fda0,'rooms_data':_0x1436ad,'ed_fullDate':_0x1ce55c});}catch(_0x162f5c){console['log'](_0x162f5c);}}),router['post'](a0_0x58c878(0x29b),auth,async(_0x5857ce,_0x392eb0)=>{var _0x4397af=a0_0x58c878;try{const _0x2cec7a=_0x5857ce[_0x4397af(0x1cd)]['id'],_0x2820d7=await sales_finished[_0x4397af(0x1db)]({'_id':_0x5857ce['params']['id']}),_0x475e21=await warehouse['findOne']({'name':_0x2820d7[_0x4397af(0x21b)],'room':_0x5857ce[_0x4397af(0x215)][_0x4397af(0x2b5)],'warehouse_category':_0x4397af(0x251)}),{invoice:_0x2d40a2,customer:_0x1424c7,date:_0x11baf2,warehouse_name:_0x13c79c,product_name:_0x3170a8,stock:_0x55ae6d,adjust_qty:_0x3c829b,note:_0x33c8bc,room:_0x2f2eb4,primary_code:_0x1d83bb,secondary_code:_0x3b1a2f,prod_code:_0x3d7388,level:_0x3c5cf3,isle:_0x481653,pallet:_0x16069a,expiry_date:_0x57ff26}=_0x5857ce[_0x4397af(0x215)];if(typeof _0x3170a8==_0x4397af(0x23a))var _0x54bacb=[_0x5857ce['body'][_0x4397af(0x214)]],_0x1066f2=[_0x5857ce['body'][_0x4397af(0x242)]],_0x50215c=[_0x5857ce['body'][_0x4397af(0x298)]],_0x585848=[_0x5857ce[_0x4397af(0x215)]['primary_code']],_0x5e11cb=[_0x5857ce[_0x4397af(0x215)][_0x4397af(0x1f6)]],_0x3c2b33=[_0x5857ce['body']['prod_code']],_0xba77e5=[_0x5857ce[_0x4397af(0x215)][_0x4397af(0x218)]],_0x9f1085=[_0x5857ce[_0x4397af(0x215)][_0x4397af(0x1d4)]];else var _0x54bacb=[..._0x5857ce[_0x4397af(0x215)][_0x4397af(0x214)]],_0x1066f2=[..._0x5857ce['body'][_0x4397af(0x242)]],_0x50215c=[..._0x5857ce[_0x4397af(0x215)][_0x4397af(0x298)]],_0x585848=[..._0x5857ce['body'][_0x4397af(0x1c0)]],_0x5e11cb=[..._0x5857ce['body'][_0x4397af(0x1f6)]],_0x3c2b33=[..._0x5857ce[_0x4397af(0x215)][_0x4397af(0x1b4)]],_0xba77e5=[..._0x5857ce[_0x4397af(0x215)]['level']],_0x9f1085=[..._0x5857ce[_0x4397af(0x215)][_0x4397af(0x1d4)]];const _0x316583=_0x54bacb['map'](_0x4f7981=>{return _0x4f7981={'product_name':_0x4f7981};});_0x1066f2['forEach']((_0x16a7ff,_0xf09933)=>{_0x316583[_0xf09933]['stock']=_0x16a7ff;}),_0x50215c[_0x4397af(0x269)]((_0x15eaf9,_0x55e719)=>{var _0x2230f9=_0x4397af;_0x316583[_0x55e719][_0x2230f9(0x2ba)]=_0x15eaf9;}),_0x585848['forEach']((_0x447144,_0x182037)=>{var _0x261e05=_0x4397af;_0x316583[_0x182037][_0x261e05(0x1c0)]=_0x447144;}),_0x5e11cb[_0x4397af(0x269)]((_0x29defe,_0x512718)=>{_0x316583[_0x512718]['secondary_code']=_0x29defe;}),_0x3c2b33['forEach']((_0xc79348,_0x272dcf)=>{var _0x1464e6=_0x4397af;_0x316583[_0x272dcf][_0x1464e6(0x275)]=_0xc79348;}),_0xba77e5['forEach']((_0x1ec3be,_0x5a5a9d)=>{var _0x236760=_0x4397af;_0x316583[_0x5a5a9d][_0x236760(0x218)]=_0x1ec3be;}),_0x9f1085['forEach']((_0x1cd731,_0x32059f)=>{_0x316583[_0x32059f]['expiry_date']=_0x1cd731;});var _0x23a27a=0x0;_0x316583[_0x4397af(0x269)](_0x47867e=>{var _0x24e2e9=_0x4397af;console[_0x24e2e9(0x1af)](_0x24e2e9(0x2a3),_0x47867e),(parseInt(_0x47867e[_0x24e2e9(0x242)])<parseInt(_0x47867e[_0x24e2e9(0x2ba)])||parseInt(_0x47867e[_0x24e2e9(0x2ba)])==0x0)&&_0x23a27a++;});if(_0x23a27a!=0x0)return _0x5857ce[_0x4397af(0x210)](_0x4397af(0x1e6),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x392eb0['redirect']('back');_0x2820d7[_0x4397af(0x29e)][_0x4397af(0x269)](_0x1a6a67=>{var _0x20477e=_0x4397af;const _0x351bd2=_0x475e21[_0x20477e(0x1e4)]['map'](_0x462628=>{var _0xa556f4=_0x20477e;_0x462628['product_name']==_0x1a6a67[_0xa556f4(0x214)]&&_0x462628[_0xa556f4(0x1b6)]==_0x1a6a67[_0xa556f4(0x1b6)]&&(_0x462628[_0xa556f4(0x1b7)]=parseInt(_0x462628['product_stock'])+parseInt(_0x1a6a67[_0xa556f4(0x2ba)]));});}),await _0x475e21[_0x4397af(0x28a)]();const _0x4bf034=_0x316583[_0x4397af(0x25a)](_0x557dba=>_0x557dba[_0x4397af(0x2ba)]!=='0'&&_0x557dba[_0x4397af(0x2ba)]!=='');_0x2820d7[_0x4397af(0x1cf)]=_0x2d40a2,_0x2820d7[_0x4397af(0x252)]=_0x1424c7,_0x2820d7[_0x4397af(0x1de)]=_0x11baf2,_0x2820d7[_0x4397af(0x21b)]=_0x13c79c,_0x2820d7['sale_product']=_0x4bf034,_0x2820d7[_0x4397af(0x290)]=_0x33c8bc,_0x2820d7['room']=_0x2f2eb4;const _0x389e23=await _0x2820d7[_0x4397af(0x28a)](),_0x2e713d=await sales_finished['findOne']({'_id':_0x5857ce[_0x4397af(0x1cd)]['id']}),_0x4fdea0=await warehouse[_0x4397af(0x1db)]({'name':_0x13c79c,'room':_0x2f2eb4,'warehouse_category':_0x4397af(0x251)});_0x2e713d['sale_product']['forEach'](_0x4cd483=>{var _0x2ec94b=_0x4397af;const _0x250eb8=_0x4fdea0['product_details'][_0x2ec94b(0x2af)](_0x5beacb=>{var _0x21c272=_0x2ec94b;_0x5beacb[_0x21c272(0x214)]==_0x4cd483['product_name']&&_0x5beacb[_0x21c272(0x1b6)]==_0x4cd483[_0x21c272(0x1b6)]&&(_0x5beacb[_0x21c272(0x1b7)]=parseInt(_0x5beacb[_0x21c272(0x1b7)])-parseInt(_0x4cd483['quantity']));});}),console[_0x4397af(0x1af)](_0x4397af(0x1ea),_0x4fdea0),await _0x4fdea0['save']();const _0x229c6c=await c_payment_data[_0x4397af(0x1db)]({'invoice':_0x5857ce[_0x4397af(0x215)][_0x4397af(0x1cf)]});_0x229c6c[_0x4397af(0x22f)]=_0x5857ce[_0x4397af(0x215)]['suppliers'],await _0x229c6c['save'](),_0x5857ce[_0x4397af(0x210)]('success',_0x4397af(0x297)),_0x392eb0[_0x4397af(0x209)](_0x4397af(0x230));}catch(_0x14052c){console['log'](_0x14052c);}}),router[a0_0x58c878(0x1c8)](a0_0x58c878(0x1e9),auth,async(_0x1cf1a1,_0x16f135)=>{var _0xa866ff=a0_0x58c878;try{const _0xb5ca1a=_0x1cf1a1[_0xa866ff(0x1cd)]['id'],{invoice:_0x4cd93a,customer:_0x5ede9b,receivable_amount:_0x432df1,received_amount:_0x41d621}=_0x1cf1a1['body'],_0x574b95=await sales['findById'](_0xb5ca1a);console[_0xa866ff(0x1af)](_0x574b95);var _0x462756=_0x432df1-_0x41d621;console[_0xa866ff(0x1af)](_0x41d621),_0x574b95[_0xa866ff(0x1e7)]=parseFloat(_0x41d621)+parseFloat(_0x574b95[_0xa866ff(0x1e7)]),_0x574b95['due_amount']=_0x462756,console[_0xa866ff(0x1af)](_0x574b95);const _0x18d99a=await _0x574b95[_0xa866ff(0x28a)](),_0x2323bf=await c_payment_data[_0xa866ff(0x1db)]({'invoice':_0x4cd93a});_0x2323bf[_0xa866ff(0x1d0)]=_0x462756,await _0x2323bf[_0xa866ff(0x28a)]();let _0x4f4d8a=new Date(),_0x1b7983=('0'+_0x4f4d8a['getDate']())[_0xa866ff(0x283)](-0x2),_0x289e4e=('0'+(_0x4f4d8a['getMonth']()+0x1))[_0xa866ff(0x283)](-0x2),_0x2cb6dd=_0x4f4d8a[_0xa866ff(0x2a7)](),_0x4ff94e=_0x2cb6dd+'-'+_0x289e4e+'-'+_0x1b7983;const _0x28fddd=new customer_payment({'invoice':_0x4cd93a,'date':_0x2cb6dd+'-'+_0x289e4e+'-'+_0x1b7983,'customer':_0x5ede9b,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x41d621}),_0x580c86=await _0x28fddd[_0xa866ff(0x28a)]();_0x1cf1a1[_0xa866ff(0x210)](_0xa866ff(0x2b3),'payment\x20successfull'),_0x16f135[_0xa866ff(0x209)]('/all_sales/view');}catch(_0x23eb55){console['log'](_0x23eb55);}}),router[a0_0x58c878(0x27a)](a0_0x58c878(0x204),auth,async(_0x1593e2,_0x309f81)=>{var _0x567376=a0_0x58c878;try{const {username:_0x362fb9,email:_0x3620d6,role:_0xaa02a6}=_0x1593e2[_0x567376(0x1a8)],_0x39d78e=_0x1593e2[_0x567376(0x1a8)],_0xaf24e7=await profile[_0x567376(0x1db)]({'email':_0x39d78e[_0x567376(0x287)]}),_0x320c44=await master_shop['find']();console[_0x567376(0x1af)](_0x567376(0x1ac),_0x320c44);const _0x3d4c15=_0x1593e2[_0x567376(0x1cd)]['id'],_0x2bc9e7=await sales[_0x567376(0x26b)](_0x3d4c15);console[_0x567376(0x1af)](_0x2bc9e7);const _0x2f64b9=await customer[_0x567376(0x1db)]({'name':_0x2bc9e7['customer']});console[_0x567376(0x1af)](_0x2f64b9);if(_0x320c44[0x0][_0x567376(0x1dd)]=='English\x20(US)'){var _0x319b8a=users[_0x567376(0x23c)];console[_0x567376(0x1af)](_0x319b8a);}else{if(_0x320c44[0x0][_0x567376(0x1dd)]==_0x567376(0x245))var _0x319b8a=users[_0x567376(0x245)];else{if(_0x320c44[0x0][_0x567376(0x1dd)]==_0x567376(0x1f5))var _0x319b8a=users[_0x567376(0x1f5)];else{if(_0x320c44[0x0][_0x567376(0x1dd)]==_0x567376(0x1fd))var _0x319b8a=users[_0x567376(0x1fd)];else{if(_0x320c44[0x0]['language']=='French')var _0x319b8a=users[_0x567376(0x205)];else{if(_0x320c44[0x0][_0x567376(0x1dd)]==_0x567376(0x224))var _0x319b8a=users[_0x567376(0x265)];else{if(_0x320c44[0x0]['language']==_0x567376(0x27e))var _0x319b8a=users[_0x567376(0x27e)];else{if(_0x320c44[0x0][_0x567376(0x1dd)]==_0x567376(0x1f0))var _0x319b8a=users[_0x567376(0x2a5)];}}}}}}}_0x309f81[_0x567376(0x216)]('sales_invoice',{'success':_0x1593e2[_0x567376(0x210)](_0x567376(0x2b3)),'errors':_0x1593e2[_0x567376(0x210)](_0x567376(0x1e6)),'role':_0x39d78e,'profile':_0xaf24e7,'master_shop':_0x320c44,'customers':_0x2f64b9,'sales':_0x2bc9e7,'language':_0x319b8a});}catch(_0x278d9c){console['log'](_0x278d9c);}}),router[a0_0x58c878(0x27a)](a0_0x58c878(0x28d),auth,async(_0x1ba161,_0x225931)=>{var _0xfd3d8=a0_0x58c878;try{const {username:_0x10c919,email:_0x1e7e93,role:_0x426636}=_0x1ba161[_0xfd3d8(0x1a8)],_0x2a0781=_0x1ba161[_0xfd3d8(0x1a8)],_0x554c74=await profile[_0xfd3d8(0x1db)]({'email':_0x2a0781[_0xfd3d8(0x287)]}),_0x309719=await master_shop[_0xfd3d8(0x263)](),_0x59bfc2=_0x1ba161['params']['id'],_0x159ef9=await sales_finished[_0xfd3d8(0x26b)](_0x59bfc2),_0x4dba45=await warehouse['aggregate']([{'$match':{'name':_0x159ef9[_0xfd3d8(0x21b)]}},{'$unwind':_0xfd3d8(0x227)},{'$group':{'_id':_0xfd3d8(0x25b),'name':{'$first':_0xfd3d8(0x1d8)},'product_stock':{'$first':_0xfd3d8(0x28b)},'bay':{'$first':_0xfd3d8(0x1df)},'bin':{'$first':_0xfd3d8(0x1d9)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0xfd3d8(0x1d1)},'primary_code':{'$first':_0xfd3d8(0x296)},'secondary_code':{'$first':_0xfd3d8(0x27d)},'product_code':{'$first':_0xfd3d8(0x217)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xfd3d8(0x237)},'expiry_date':{'$first':_0xfd3d8(0x239)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0xfd3d8(0x1fb)},'secondary_unit':{'$first':_0xfd3d8(0x1ad)},'maxProducts':{'$first':_0xfd3d8(0x236)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x4c3e77=await product[_0xfd3d8(0x263)]({}),_0x26066c=await warehouse[_0xfd3d8(0x1c1)]([{'$match':{'status':'Enabled','warehouse_category':_0xfd3d8(0x251),'name':{'$ne':_0xfd3d8(0x1a5),'$ne':_0xfd3d8(0x203)}}},{'$group':{'_id':'$name','name':{'$first':_0xfd3d8(0x1d2)}}},{'$sort':{'name':0x1}}]);var _0x4b3b6f=[_0xfd3d8(0x1c5)];const _0x3c9e2f=await warehouse[_0xfd3d8(0x1c1)]([{'$match':{'status':_0xfd3d8(0x1f4),'name':_0xfd3d8(0x203)}},{'$group':{'_id':_0xfd3d8(0x1d2),'name':{'$first':_0xfd3d8(0x1d2)}}},{'$sort':{'name':0x1}}]);if(_0x309719[0x0]['language']==_0xfd3d8(0x1d6)){var _0x36d6d8=users[_0xfd3d8(0x23c)];console[_0xfd3d8(0x1af)](_0x36d6d8);}else{if(_0x309719[0x0][_0xfd3d8(0x1dd)]=='Hindi')var _0x36d6d8=users['Hindi'];else{if(_0x309719[0x0][_0xfd3d8(0x1dd)]==_0xfd3d8(0x1f5))var _0x36d6d8=users[_0xfd3d8(0x1f5)];else{if(_0x309719[0x0]['language']==_0xfd3d8(0x1fd))var _0x36d6d8=users[_0xfd3d8(0x1fd)];else{if(_0x309719[0x0][_0xfd3d8(0x1dd)]=='French')var _0x36d6d8=users['French'];else{if(_0x309719[0x0][_0xfd3d8(0x1dd)]==_0xfd3d8(0x224))var _0x36d6d8=users[_0xfd3d8(0x265)];else{if(_0x309719[0x0][_0xfd3d8(0x1dd)]==_0xfd3d8(0x27e))var _0x36d6d8=users['Chinese'];else{if(_0x309719[0x0][_0xfd3d8(0x1dd)]==_0xfd3d8(0x1f0))var _0x36d6d8=users['Arabic'];}}}}}}}_0x225931[_0xfd3d8(0x216)]('return_sale_finished',{'success':_0x1ba161[_0xfd3d8(0x210)](_0xfd3d8(0x2b3)),'errors':_0x1ba161[_0xfd3d8(0x210)](_0xfd3d8(0x1e6)),'role':_0x2a0781,'profile':_0x554c74,'user':_0x159ef9,'stock':_0x4dba45,'master_shop':_0x309719,'unit':_0x4c3e77,'language':_0x36d6d8,'warehouses':_0x26066c,'rooms':_0x4b3b6f,'warehouse_QA':_0x3c9e2f});}catch(_0xcf6b41){console[_0xfd3d8(0x1af)](_0xcf6b41),_0x225931[_0xfd3d8(0x279)](0xc8)[_0xfd3d8(0x23f)]({'message':_0xcf6b41[_0xfd3d8(0x20b)]});}}),router[a0_0x58c878(0x1c8)](a0_0x58c878(0x28d),auth,async(_0x4b5484,_0xe54882)=>{var _0x519e14=a0_0x58c878;if(_0x4b5484['body'][_0x519e14(0x1ef)]=='QA')try{const {invoice:_0x20b108,date:_0x567249,warehouse_name:_0x34ef42,product_name:_0x2cffc6,primary_code:_0x3d91b1,secondary_code:_0xe52dc5,product_code:_0x92f705,sales_quantity:_0x48798f,stocks:_0x403486,return_qty:_0x436230,Room_name:_0x3c8bbb,to_warehouse_name_QA:_0xe8f48e,to_Room_name_QA:_0x5e3da2,note:_0x4af15f,for_categorize:_0x199555,product_name_QA1:_0x3ee5d5}=_0x4b5484[_0x519e14(0x215)];if(typeof _0x3ee5d5=='string')var _0x2717c8=[_0x4b5484[_0x519e14(0x215)]['product_name_QA1']],_0x5eb4d2=[_0x4b5484['body']['primary_code_QA']],_0x3b72b5=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x1b9)]],_0x51f231=[_0x4b5484['body']['product_code_QA']],_0x207cad=[_0x4b5484[_0x519e14(0x215)]['sales_quantity_QA']],_0x23d8d3=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x21c)]],_0x386fc8=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x244)]],_0x13dd1d=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x23e)]],_0x125a61=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x1f2)]],_0x13cca4=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x22d)]],_0x53ac43=[_0x4b5484['body'][_0x519e14(0x1b8)]],_0x4f05c0=[_0x4b5484['body'][_0x519e14(0x259)]],_0x3e740f=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x1ca)]],_0x54972e=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x29c)]];else var _0x2717c8=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x1e8)]],_0x5eb4d2=[..._0x4b5484['body'][_0x519e14(0x229)]],_0x3b72b5=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x1b9)]],_0x51f231=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x1f1)]],_0x207cad=[..._0x4b5484['body']['sales_quantity_QA']],_0x23d8d3=[..._0x4b5484['body'][_0x519e14(0x21c)]],_0x386fc8=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x244)]],_0x13dd1d=[..._0x4b5484['body']['maxPerUnit_QA']],_0x125a61=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x1f2)]],_0x13cca4=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x22d)]],_0x53ac43=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x1b8)]],_0x4f05c0=[..._0x4b5484[_0x519e14(0x215)]['unit_QA']],_0x3e740f=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x1ca)]],_0x54972e=[..._0x4b5484['body']['expiry_date_QA']];const _0x247d3e=_0x2717c8['map'](_0x1205ab=>{return _0x1205ab={'product_name':_0x1205ab};});_0x5eb4d2[_0x519e14(0x269)]((_0x323b3a,_0x5380c8)=>{var _0x5bc5fe=_0x519e14;_0x247d3e[_0x5380c8][_0x5bc5fe(0x1c0)]=_0x323b3a;}),_0x3b72b5[_0x519e14(0x269)]((_0x3784b3,_0x12625f)=>{var _0x201899=_0x519e14;_0x247d3e[_0x12625f][_0x201899(0x1f6)]=_0x3784b3;}),_0x51f231[_0x519e14(0x269)]((_0x3fb9b6,_0x4aba44)=>{var _0x56bc8b=_0x519e14;_0x247d3e[_0x4aba44][_0x56bc8b(0x275)]=_0x3fb9b6;}),_0x207cad[_0x519e14(0x269)]((_0x2d8f3b,_0x415c0b)=>{var _0x3b5a24=_0x519e14;_0x247d3e[_0x415c0b][_0x3b5a24(0x284)]=_0x2d8f3b;}),_0x23d8d3[_0x519e14(0x269)]((_0x402d0e,_0x51f450)=>{var _0x5f5ab1=_0x519e14;_0x247d3e[_0x51f450][_0x5f5ab1(0x242)]=_0x402d0e;}),_0x386fc8['forEach']((_0x5d3ff0,_0x231aba)=>{var _0x473900=_0x519e14;_0x247d3e[_0x231aba][_0x473900(0x2ab)]=_0x5d3ff0;}),_0x13dd1d[_0x519e14(0x269)]((_0xd686a5,_0x3ced84)=>{_0x247d3e[_0x3ced84]['maxPerUnit']=_0xd686a5;}),_0x125a61[_0x519e14(0x269)]((_0x1dfa2c,_0x21ca67)=>{var _0x2b7c23=_0x519e14;_0x247d3e[_0x21ca67][_0x2b7c23(0x222)]=_0x1dfa2c;}),_0x13cca4[_0x519e14(0x269)]((_0x84285e,_0x58fa39)=>{var _0x458f84=_0x519e14;_0x247d3e[_0x58fa39][_0x458f84(0x257)]=_0x84285e;}),_0x53ac43['forEach']((_0x288331,_0x592db3)=>{var _0x4c7876=_0x519e14;_0x247d3e[_0x592db3][_0x4c7876(0x22e)]=_0x288331;}),_0x4f05c0[_0x519e14(0x269)]((_0x349186,_0x218373)=>{var _0x39aea8=_0x519e14;_0x247d3e[_0x218373][_0x39aea8(0x22a)]=_0x349186;}),_0x3e740f[_0x519e14(0x269)]((_0x5599b3,_0x24704d)=>{var _0x34cb80=_0x519e14;_0x247d3e[_0x24704d][_0x34cb80(0x22b)]=_0x5599b3;}),_0x54972e[_0x519e14(0x269)]((_0x954539,_0x22c74a)=>{var _0x4567a4=_0x519e14;_0x247d3e[_0x22c74a][_0x4567a4(0x1d4)]=_0x954539;});const _0x3db1d2=await sales_finished[_0x519e14(0x1db)]({'invoice':_0x20b108});_0x3db1d2[_0x519e14(0x212)]=_0x519e14(0x211);const _0x1e625d=await _0x3db1d2[_0x519e14(0x28a)](),_0x58d942=new sales_return_finished({'invoice':_0x20b108,'customer':_0x4b5484['body'][_0x519e14(0x252)],'date':_0x567249,'warehouse_name':_0x34ef42,'room':_0x3c8bbb,'ToWarehouse':_0xe8f48e,'ToRoom':_0x5e3da2,'return_sale_QA':_0x247d3e,'note':_0x4af15f,'warehouse_cat':_0x199555}),_0x201bf5=await _0x58d942[_0x519e14(0x28a)](),_0x5a4007=await sales_return_finished[_0x519e14(0x1db)]({'invoice':_0x20b108}),_0xb3d474=await warehouse['findOne']({'name':_0xe8f48e,'room':_0x5e3da2});_0x5a4007[_0x519e14(0x207)][_0x519e14(0x269)](_0x15d24a=>{var _0x3f8841=_0x519e14,_0x439d34=0x0;const _0x24a575=_0xb3d474['product_details'][_0x3f8841(0x2af)](_0x56a62b=>{var _0x418cec=_0x3f8841;_0x56a62b[_0x418cec(0x214)]==_0x15d24a['product_name']&&_0x56a62b['expiry_date']==_0x15d24a['expiry_date']&&_0x56a62b[_0x418cec(0x22b)]==_0x15d24a['production_date']&&_0x56a62b[_0x418cec(0x257)]==_0x15d24a[_0x418cec(0x257)]&&(_0x56a62b[_0x418cec(0x1b7)]=parseInt(_0x56a62b[_0x418cec(0x1b7)])+parseInt(_0x15d24a['return_qty']),_0x439d34++);});_0x439d34=='0'&&(_0xb3d474[_0x3f8841(0x1e4)]=_0xb3d474[_0x3f8841(0x1e4)][_0x3f8841(0x21f)]({'product_name':_0x15d24a[_0x3f8841(0x214)],'product_stock':_0x15d24a['return_qty'],'primary_code':_0x15d24a[_0x3f8841(0x1c0)],'secondary_code':_0x15d24a[_0x3f8841(0x1f6)],'product_code':_0x15d24a[_0x3f8841(0x275)],'batch_code':_0x15d24a['batch_code'],'maxPerUnit':_0x15d24a[_0x3f8841(0x1fa)],'production_date':_0x15d24a[_0x3f8841(0x22b)],'expiry_date':_0x15d24a[_0x3f8841(0x1d4)],'secondary_unit':_0x15d24a[_0x3f8841(0x22e)],'unit':_0x15d24a['unit'],'maxProducts':_0x15d24a[_0x3f8841(0x222)],'bay':_0x15d24a['bay']}));}),await _0xb3d474[_0x519e14(0x28a)]();const _0x5272ee=new c_payment_data({'invoice':_0x20b108,'customer':_0x4b5484[_0x519e14(0x215)][_0x519e14(0x252)],'reason':_0x519e14(0x1b5)});await _0x5272ee[_0x519e14(0x28a)]();const _0x2c2315=await master_shop[_0x519e14(0x263)](),_0x4e3c2b=await email_settings['findOne'](),_0x244166=await customer[_0x519e14(0x1db)]({'name':_0x4b5484[_0x519e14(0x215)][_0x519e14(0x252)]});_0x2c2315[0x0][_0x519e14(0x1e2)]==0x1?(right_currency=_0x2c2315[0x0][_0x519e14(0x246)],left_currency=''):(right_currency='',left_currency=_0x2c2315[0x0][_0x519e14(0x246)]);var _0x5a48c5=_0x2717c8,_0x2ec14c=_0x386fc8,_0x417207='',_0x21536e;for(_0x21536e in _0x5a48c5){_0x417207+=_0x519e14(0x200)+_0x519e14(0x1f3)+_0x5a48c5[_0x21536e]+_0x519e14(0x2ae)+_0x519e14(0x1f3)+_0x2ec14c[_0x21536e]+_0x519e14(0x2ae)+_0x519e14(0x21e);}console[_0x519e14(0x1af)](_0x519e14(0x286),_0x417207);let _0x443aae=nodemailer['createTransport']({'service':_0x519e14(0x234),'auth':{'user':_0x4e3c2b['email'],'pass':_0x4e3c2b[_0x519e14(0x1fc)]}}),_0x2a2a53={'from':_0x4e3c2b[_0x519e14(0x287)],'to':_0x244166[_0x519e14(0x287)],'subject':_0x519e14(0x1bf),'attachments':[{'filename':_0x519e14(0x26e),'path':__dirname+_0x519e14(0x2a6)+_0x519e14(0x250)+_0x2c2315[0x0][_0x519e14(0x2a9)],'cid':_0x519e14(0x268)}],'html':_0x519e14(0x28f)+_0x519e14(0x223)+_0x519e14(0x281)+'<div>'+_0x519e14(0x292)+_0x519e14(0x1dc)+_0x519e14(0x26d)+_0x519e14(0x273)+_0x519e14(0x1dc)+_0x519e14(0x20e)+_0x2c2315[0x0][_0x519e14(0x1ec)]+_0x519e14(0x2a2)+_0x519e14(0x273)+_0x519e14(0x273)+'<hr\x20class=\x22my-3\x22>'+_0x519e14(0x1dc)+_0x519e14(0x285)+_0x519e14(0x262)+_0x20b108+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x519e14(0x24d)+_0x567249+'\x20'+_0x519e14(0x294)+'</h5>'+_0x519e14(0x273)+_0x519e14(0x276)+_0x519e14(0x1c7)+_0x519e14(0x200)+_0x519e14(0x1c4)+_0x519e14(0x1e0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x519e14(0x20c)+'</tr>'+_0x519e14(0x29d)+_0x519e14(0x1ed)+'\x20'+_0x417207+'\x20'+'</tbody>'+_0x519e14(0x288)+_0x519e14(0x1dc)+_0x519e14(0x1cc)+'<h5>'+_0x2c2315[0x0][_0x519e14(0x1ec)]+_0x519e14(0x24b)+'</div>'+'</div>'+_0x519e14(0x278)};_0x443aae[_0x519e14(0x202)](_0x2a2a53,function(_0x18d3af,_0x3e6180){var _0x15ceb8=_0x519e14;_0x18d3af?(console[_0x15ceb8(0x1af)](_0x18d3af),console[_0x15ceb8(0x1af)](_0x15ceb8(0x1eb))):console[_0x15ceb8(0x1af)](_0x15ceb8(0x20f));}),_0x4b5484['flash'](_0x519e14(0x2b3),_0x519e14(0x255)),_0xe54882[_0x519e14(0x209)](_0x519e14(0x230));}catch(_0x2a69d6){_0xe54882['status'](0xc8)['json']({'message1':_0x2a69d6['message']});}else{if(_0x4b5484[_0x519e14(0x215)]['for_categorize']=='GS')try{const {invoice:_0x4e97cd,date:_0x18a201,warehouse_name:_0x110f30,product_name:_0x342e8c,primary_code:_0x279a75,secondary_code:_0xb7e4dc,product_code:_0x319ee5,sales_quantity:_0x56ec0f,stocks:_0x3fbffc,return_qty:_0x9b9177,Room_name:_0x30cd7f,to_warehouse_name:_0x326405,to_Room_name:_0x125ec6,note:_0x21d7c2,level:_0x37ca86,isle:_0x4f76b8,pallet:_0x32fcb9,for_categorize:_0x1a5bb9}=_0x4b5484['body'];if(typeof _0x342e8c==_0x519e14(0x23a))var _0x2717c8=[_0x4b5484['body'][_0x519e14(0x214)]],_0x5eb4d2=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x1c0)]],_0x3b72b5=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x1f6)]],_0x51f231=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x275)]],_0x207cad=[_0x4b5484['body'][_0x519e14(0x1c2)]],_0x386fc8=[_0x4b5484[_0x519e14(0x215)]['return_qty']],_0x86a141=[_0x4b5484['body']['bay']],_0x13dd1d=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x1fa)]],_0x125a61=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x222)]],_0x13cca4=[_0x4b5484[_0x519e14(0x215)]['batch_code']],_0x53ac43=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x22e)]],_0x4f05c0=[_0x4b5484[_0x519e14(0x215)][_0x519e14(0x22a)]],_0x3e740f=[_0x4b5484[_0x519e14(0x215)]['production_date']],_0x54972e=[_0x4b5484['body'][_0x519e14(0x1d4)]];else var _0x2717c8=[..._0x4b5484[_0x519e14(0x215)]['product_name']],_0x5eb4d2=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x1c0)]],_0x3b72b5=[..._0x4b5484[_0x519e14(0x215)]['secondary_code']],_0x51f231=[..._0x4b5484['body']['product_code']],_0x207cad=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x1c2)]],_0x386fc8=[..._0x4b5484[_0x519e14(0x215)]['return_qty']],_0x86a141=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x1b6)]],_0x13dd1d=[..._0x4b5484['body'][_0x519e14(0x1fa)]],_0x125a61=[..._0x4b5484['body'][_0x519e14(0x222)]],_0x13cca4=[..._0x4b5484['body'][_0x519e14(0x257)]],_0x53ac43=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x22e)]],_0x4f05c0=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x22a)]],_0x3e740f=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x22b)]],_0x54972e=[..._0x4b5484[_0x519e14(0x215)][_0x519e14(0x1d4)]];const _0x633ccf=_0x2717c8[_0x519e14(0x2af)](_0x103ece=>{return _0x103ece={'product_name':_0x103ece};});_0x5eb4d2[_0x519e14(0x269)]((_0x2fbe30,_0x1f6402)=>{var _0x533cba=_0x519e14;_0x633ccf[_0x1f6402][_0x533cba(0x1c0)]=_0x2fbe30;}),_0x3b72b5['forEach']((_0x2f68c2,_0x48ba22)=>{var _0x4d958a=_0x519e14;_0x633ccf[_0x48ba22][_0x4d958a(0x1f6)]=_0x2f68c2;}),_0x51f231[_0x519e14(0x269)]((_0x3ebcf3,_0x238be4)=>{var _0x551f3b=_0x519e14;_0x633ccf[_0x238be4][_0x551f3b(0x275)]=_0x3ebcf3;}),_0x207cad['forEach']((_0x349980,_0x1123e7)=>{_0x633ccf[_0x1123e7]['sale_qty']=_0x349980;}),_0x386fc8[_0x519e14(0x269)]((_0x583afe,_0x4a8b96)=>{var _0x17855a=_0x519e14;_0x633ccf[_0x4a8b96][_0x17855a(0x2ab)]=_0x583afe;}),_0x86a141[_0x519e14(0x269)]((_0x1b5e43,_0x5929b9)=>{var _0x309d39=_0x519e14;_0x633ccf[_0x5929b9][_0x309d39(0x1b6)]=_0x1b5e43;}),_0x13dd1d[_0x519e14(0x269)]((_0x522e46,_0x52594d)=>{_0x633ccf[_0x52594d]['maxPerUnit']=_0x522e46;}),_0x125a61[_0x519e14(0x269)]((_0x4ba8d3,_0x40f423)=>{var _0x1ce751=_0x519e14;_0x633ccf[_0x40f423][_0x1ce751(0x222)]=_0x4ba8d3;}),_0x13cca4[_0x519e14(0x269)]((_0x5be76b,_0x1392ef)=>{var _0x42cf87=_0x519e14;_0x633ccf[_0x1392ef][_0x42cf87(0x257)]=_0x5be76b;}),_0x53ac43[_0x519e14(0x269)]((_0x35c05a,_0x41d261)=>{_0x633ccf[_0x41d261]['secondary_unit']=_0x35c05a;}),_0x4f05c0[_0x519e14(0x269)]((_0x18c53e,_0x193524)=>{var _0x2d899a=_0x519e14;_0x633ccf[_0x193524][_0x2d899a(0x22a)]=_0x18c53e;}),_0x3e740f[_0x519e14(0x269)]((_0x56563a,_0x49a8ed)=>{var _0x4e5f06=_0x519e14;_0x633ccf[_0x49a8ed][_0x4e5f06(0x22b)]=_0x56563a;}),_0x54972e[_0x519e14(0x269)]((_0x4f42a8,_0x39057c)=>{_0x633ccf[_0x39057c]['expiry_date']=_0x4f42a8;});var _0x456eaa=0x0;_0x633ccf[_0x519e14(0x269)](_0x2231b9=>{var _0x423859=_0x519e14;(parseInt(_0x2231b9[_0x423859(0x284)])<parseInt(_0x2231b9[_0x423859(0x2ab)])||parseInt(_0x2231b9[_0x423859(0x242)])<parseInt(_0x2231b9[_0x423859(0x2ab)])&&parseInt(_0x2231b9[_0x423859(0x284)])>parseInt(_0x2231b9[_0x423859(0x2ab)])||parseInt(_0x2231b9[_0x423859(0x2ab)])==0x0)&&_0x456eaa++;});if(_0x456eaa!=0x0)return _0x4b5484[_0x519e14(0x210)](_0x519e14(0x1e6),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0xe54882[_0x519e14(0x209)]('back');const _0x38a954=await sales_finished['findOne']({'invoice':_0x4e97cd});_0x38a954[_0x519e14(0x212)]=_0x519e14(0x211);const _0x3d1a16=await _0x38a954['save'](),_0x3bb152=new sales_return_finished({'invoice':_0x4e97cd,'customer':_0x4b5484[_0x519e14(0x215)][_0x519e14(0x252)],'date':_0x18a201,'warehouse_name':_0x110f30,'room':_0x30cd7f,'ToWarehouse':_0x326405,'ToRoom':_0x125ec6,'return_sale':_0x633ccf,'note':_0x21d7c2,'warehouse_cat':_0x1a5bb9}),_0x4287ba=await _0x3bb152[_0x519e14(0x28a)](),_0x183e0b=await sales_return_finished[_0x519e14(0x1db)]({'invoice':_0x4e97cd}),_0x2463ec=await warehouse[_0x519e14(0x1db)]({'name':_0x326405,'room':_0x125ec6,'warehouse_category':_0x519e14(0x251)});_0x183e0b[_0x519e14(0x2b2)][_0x519e14(0x269)](_0x4498ee=>{var _0x5389d6=_0x519e14,_0x355298=0x0;const _0x42fe39=_0x2463ec[_0x5389d6(0x1e4)][_0x5389d6(0x2af)](_0x57e77f=>{var _0x52f632=_0x5389d6;_0x57e77f[_0x52f632(0x214)]==_0x4498ee[_0x52f632(0x214)]&&_0x57e77f[_0x52f632(0x1b6)]==_0x4498ee[_0x52f632(0x1b6)]&&_0x57e77f[_0x52f632(0x1d4)]==_0x4498ee['expiry_date']&&_0x57e77f[_0x52f632(0x22b)]==_0x4498ee[_0x52f632(0x22b)]&&_0x57e77f[_0x52f632(0x257)]==_0x4498ee['batch_code']&&(_0x57e77f[_0x52f632(0x1b7)]=parseInt(_0x57e77f['product_stock'])+parseInt(_0x4498ee[_0x52f632(0x2ab)]),_0x355298++);});_0x355298=='0'&&(_0x2463ec[_0x5389d6(0x1e4)]=_0x2463ec[_0x5389d6(0x1e4)][_0x5389d6(0x21f)]({'product_name':_0x4498ee[_0x5389d6(0x214)],'product_stock':_0x4498ee['return_qty'],'primary_code':_0x4498ee[_0x5389d6(0x1c0)],'secondary_code':_0x4498ee[_0x5389d6(0x1f6)],'product_code':_0x4498ee[_0x5389d6(0x275)],'bay':_0x4498ee['bay'],'batch_code':_0x4498ee[_0x5389d6(0x257)],'maxPerUnit':_0x4498ee[_0x5389d6(0x1fa)],'production_date':_0x4498ee[_0x5389d6(0x22b)],'expiry_date':_0x4498ee['expiry_date'],'secondary_unit':_0x4498ee[_0x5389d6(0x22e)],'unit':_0x4498ee['unit'],'maxProducts':_0x4498ee[_0x5389d6(0x222)]}));}),await _0x2463ec[_0x519e14(0x28a)](),console[_0x519e14(0x1af)](_0x4b5484[_0x519e14(0x215)]);const _0x4e4e0e=new c_payment_data({'invoice':_0x4e97cd,'customer':_0x4b5484[_0x519e14(0x215)]['customer'],'reason':_0x519e14(0x1b5)});await _0x4e4e0e[_0x519e14(0x28a)]();const _0x584369=await master_shop[_0x519e14(0x263)]();console['log'](_0x519e14(0x232),_0x584369[0x0][_0x519e14(0x2a9)]);const _0x5b2bb5=await email_settings[_0x519e14(0x1db)](),_0x275f96=await customer[_0x519e14(0x1db)]({'name':_0x4b5484[_0x519e14(0x215)][_0x519e14(0x252)]});console[_0x519e14(0x1af)](_0x519e14(0x260),_0x275f96);_0x584369[0x0][_0x519e14(0x1e2)]==0x1?(right_currency=_0x584369[0x0][_0x519e14(0x246)],left_currency=''):(right_currency='',left_currency=_0x584369[0x0]['currency']);var _0x5a48c5=_0x2717c8,_0x2ec14c=_0x386fc8,_0x417207='',_0x21536e;for(_0x21536e in _0x5a48c5){_0x417207+=_0x519e14(0x200)+_0x519e14(0x1f3)+_0x5a48c5[_0x21536e]+_0x519e14(0x2ae)+_0x519e14(0x1f3)+_0x2ec14c[_0x21536e]+_0x519e14(0x2ae)+_0x519e14(0x21e);}console[_0x519e14(0x1af)](_0x519e14(0x286),_0x417207);let _0x402081=nodemailer[_0x519e14(0x249)]({'service':'gmail','auth':{'user':_0x5b2bb5[_0x519e14(0x287)],'pass':_0x5b2bb5[_0x519e14(0x1fc)]}}),_0x45f701={'from':_0x5b2bb5[_0x519e14(0x287)],'to':_0x275f96['email'],'subject':_0x519e14(0x1bf),'attachments':[{'filename':_0x519e14(0x26e),'path':__dirname+_0x519e14(0x2a6)+_0x519e14(0x250)+_0x584369[0x0]['image'],'cid':_0x519e14(0x268)}],'html':_0x519e14(0x28f)+'<html><head><title></title>'+'</head><body>'+_0x519e14(0x1dc)+_0x519e14(0x292)+_0x519e14(0x1dc)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x519e14(0x20e)+_0x584369[0x0][_0x519e14(0x1ec)]+_0x519e14(0x2a2)+_0x519e14(0x273)+_0x519e14(0x273)+'<hr\x20class=\x22my-3\x22>'+_0x519e14(0x1dc)+_0x519e14(0x285)+_0x519e14(0x262)+_0x4e97cd+'\x20'+_0x519e14(0x272)+_0x519e14(0x24d)+_0x18a201+'\x20'+_0x519e14(0x294)+'</h5>'+_0x519e14(0x273)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x519e14(0x1c7)+_0x519e14(0x200)+_0x519e14(0x1c4)+_0x519e14(0x1e0)+_0x519e14(0x26c)+_0x519e14(0x20c)+_0x519e14(0x21e)+_0x519e14(0x29d)+_0x519e14(0x1ed)+'\x20'+_0x417207+'\x20'+_0x519e14(0x231)+_0x519e14(0x288)+_0x519e14(0x1dc)+_0x519e14(0x1cc)+_0x519e14(0x2a1)+_0x584369[0x0][_0x519e14(0x1ec)]+'</h5>'+_0x519e14(0x273)+'</div>'+_0x519e14(0x278)};_0x402081[_0x519e14(0x202)](_0x45f701,function(_0x4817d1,_0x4eb1bb){var _0x15ffb9=_0x519e14;_0x4817d1?(console[_0x15ffb9(0x1af)](_0x4817d1),console[_0x15ffb9(0x1af)]('Error\x20Occurs')):console[_0x15ffb9(0x1af)]('Email\x20sent\x20successfully');}),_0x4b5484[_0x519e14(0x210)](_0x519e14(0x2b3),_0x519e14(0x255)),_0xe54882[_0x519e14(0x209)](_0x519e14(0x230));}catch(_0x2852f4){console['log'](_0x2852f4),_0xe54882['status'](0xc8)[_0x519e14(0x23f)]({'message1':_0x2852f4[_0x519e14(0x20b)]});}}}),router[a0_0x58c878(0x27a)](a0_0x58c878(0x243),auth,async(_0x360876,_0x47c755)=>{var _0x336874=a0_0x58c878;try{const {username:_0x41149c,email:_0x16ce07,role:_0x4c4cc4}=_0x360876[_0x336874(0x1a8)],_0x3c6336=_0x360876['user'],_0x7981e4=await profile['findOne']({'email':_0x3c6336['email']}),_0x4b6a91=await master_shop[_0x336874(0x263)]();console[_0x336874(0x1af)]('barcode\x20Product\x20master',_0x4b6a91);const _0x4d10e4=_0x360876['params']['id'],_0x5a1a75=await sales[_0x336874(0x26b)](_0x4d10e4);console['log'](_0x336874(0x270),_0x5a1a75);if(_0x4b6a91[0x0][_0x336874(0x1dd)]==_0x336874(0x1d6))var _0xbdbd3c=users[_0x336874(0x23c)];else{if(_0x4b6a91[0x0][_0x336874(0x1dd)]==_0x336874(0x245))var _0xbdbd3c=users[_0x336874(0x245)];else{if(_0x4b6a91[0x0][_0x336874(0x1dd)]==_0x336874(0x1f5))var _0xbdbd3c=users['German'];else{if(_0x4b6a91[0x0][_0x336874(0x1dd)]==_0x336874(0x1fd))var _0xbdbd3c=users[_0x336874(0x1fd)];else{if(_0x4b6a91[0x0][_0x336874(0x1dd)]==_0x336874(0x205))var _0xbdbd3c=users[_0x336874(0x205)];else{if(_0x4b6a91[0x0][_0x336874(0x1dd)]=='Portuguese\x20(BR)')var _0xbdbd3c=users[_0x336874(0x265)];else{if(_0x4b6a91[0x0][_0x336874(0x1dd)]==_0x336874(0x27e))var _0xbdbd3c=users[_0x336874(0x27e)];else{if(_0x4b6a91[0x0][_0x336874(0x1dd)]=='Arabic\x20(ae)')var _0xbdbd3c=users['Arabic'];}}}}}}}_0x47c755[_0x336874(0x216)](_0x336874(0x241),{'success':_0x360876['flash'](_0x336874(0x2b3)),'errors':_0x360876[_0x336874(0x210)](_0x336874(0x1e6)),'role':_0x3c6336,'profile':_0x7981e4,'alldata':_0x5a1a75,'master_shop':_0x4b6a91,'language':_0xbdbd3c});}catch(_0xa5fa5f){console[_0x336874(0x1af)](_0xa5fa5f);}}),router[a0_0x58c878(0x1c8)]('/barcode_scanner',async(_0x1c6c69,_0x414c93)=>{var _0x466ebd=a0_0x58c878;const {product_code:_0x136e88,warehouse_name:_0x49eb8b,rooms_data:_0x260113,Roomslist:_0x4af417}=_0x1c6c69[_0x466ebd(0x215)],_0x147261=_0x4af417[_0x466ebd(0x25c)](','),_0x21f4fc=[];async function _0x4f04a2(_0x365e6b){var _0x405c7b=_0x466ebd;const _0x5b4d71=await warehouse[_0x405c7b(0x1c1)]([{'$match':{'name':_0x49eb8b,'room':_0x365e6b}},{'$unwind':_0x405c7b(0x227)},{'$match':{'product_details.primary_code':_0x136e88}},{'$group':{'_id':_0x405c7b(0x25b),'name':{'$first':_0x405c7b(0x1d8)},'product_stock':{'$first':_0x405c7b(0x28b)},'primary_code':{'$first':_0x405c7b(0x296)},'secondary_code':{'$first':_0x405c7b(0x27d)},'product_code':{'$first':_0x405c7b(0x217)},'level':{'$first':_0x405c7b(0x1df)},'isle':{'$first':_0x405c7b(0x1d9)},'type':{'$first':_0x405c7b(0x1da)},'pallet':{'$first':_0x405c7b(0x1d1)},'unit':{'$first':_0x405c7b(0x1fb)},'secondary_unit':{'$first':_0x405c7b(0x1ad)},'storage':{'$first':_0x405c7b(0x1c3)},'rack':{'$first':_0x405c7b(0x237)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x405c7b(0x29a)},'maxPerUnit':{'$first':_0x405c7b(0x20a)},'batch_code':{'$first':_0x405c7b(0x1d5)},'product_cat':{'$first':_0x405c7b(0x25e)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x405c7b(0x26f)}}}]),_0x27ad90=await warehouse[_0x405c7b(0x1c1)]([{'$match':{'name':_0x49eb8b,'room':_0x365e6b}},{'$unwind':_0x405c7b(0x227)},{'$match':{'product_details.secondary_code':_0x136e88}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x405c7b(0x1d8)},'product_stock':{'$first':_0x405c7b(0x28b)},'primary_code':{'$first':_0x405c7b(0x296)},'secondary_code':{'$first':_0x405c7b(0x27d)},'product_code':{'$first':_0x405c7b(0x217)},'level':{'$first':_0x405c7b(0x1df)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x405c7b(0x1da)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x405c7b(0x1fb)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x405c7b(0x1c3)},'rack':{'$first':_0x405c7b(0x237)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x405c7b(0x29a)},'maxPerUnit':{'$first':_0x405c7b(0x20a)},'batch_code':{'$first':_0x405c7b(0x1d5)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x405c7b(0x27c)},'invoice':{'$first':_0x405c7b(0x26f)}}}]);if(_0x5b4d71[_0x405c7b(0x1bb)]>0x0)_0x21f4fc[_0x405c7b(0x1b2)](_0x5b4d71);else _0x27ad90[_0x405c7b(0x1bb)]>0x0&&_0x21f4fc[_0x405c7b(0x1b2)](_0x27ad90);}const _0x3d2954=_0x147261[_0x466ebd(0x2af)](_0x46f660=>_0x4f04a2(_0x46f660));await Promise['all'](_0x3d2954),_0x414c93[_0x466ebd(0x23f)](_0x21f4fc);}),module[a0_0x58c878(0x282)]=router;