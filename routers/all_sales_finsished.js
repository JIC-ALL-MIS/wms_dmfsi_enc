function a0_0x4825(_0x172f10,_0x400d7a){var _0xd790e4=a0_0xd790();return a0_0x4825=function(_0x4825f0,_0x4a3bba){_0x4825f0=_0x4825f0-0x1ca;var _0x3186b8=_0xd790e4[_0x4825f0];return _0x3186b8;},a0_0x4825(_0x172f10,_0x400d7a);}var a0_0x13961e=a0_0x4825;(function(_0x1f4cc8,_0x1a4e8b){var _0x7afcf0=a0_0x4825,_0x56ed34=_0x1f4cc8();while(!![]){try{var _0x175a26=parseInt(_0x7afcf0(0x257))/0x1*(-parseInt(_0x7afcf0(0x24e))/0x2)+-parseInt(_0x7afcf0(0x21d))/0x3+-parseInt(_0x7afcf0(0x289))/0x4+-parseInt(_0x7afcf0(0x2d8))/0x5*(parseInt(_0x7afcf0(0x2d2))/0x6)+parseInt(_0x7afcf0(0x1f5))/0x7+-parseInt(_0x7afcf0(0x2ab))/0x8*(-parseInt(_0x7afcf0(0x2cf))/0x9)+parseInt(_0x7afcf0(0x280))/0xa;if(_0x175a26===_0x1a4e8b)break;else _0x56ed34['push'](_0x56ed34['shift']());}catch(_0x27c0ab){_0x56ed34['push'](_0x56ed34['shift']());}}}(a0_0xd790,0x72455));const express=require(a0_0x13961e(0x20c)),app=express(),router=express[a0_0x13961e(0x2ac)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x13961e(0x1dd)),auth=require(a0_0x13961e(0x276)),nodemailer=require(a0_0x13961e(0x2b4)),users=require(a0_0x13961e(0x268));router[a0_0x13961e(0x2c7)](a0_0x13961e(0x296),auth,async(_0x1bbd4e,_0x557657)=>{var _0x1ca038=a0_0x13961e;try{const {username:_0x14cfaf,email:_0x29a41b,role:_0x1ed133}=_0x1bbd4e['user'],_0x3f519f=_0x1bbd4e[_0x1ca038(0x291)],_0x20d3af=await profile[_0x1ca038(0x269)]({'email':_0x3f519f['email']}),_0x21e78d=await master_shop['find']();let _0x5a2535;if(_0x3f519f[_0x1ca038(0x265)]==_0x1ca038(0x29a)){const _0x465db9=await staff[_0x1ca038(0x269)]({'email':_0x3f519f[_0x1ca038(0x272)]});_0x5a2535=await sales_finished[_0x1ca038(0x240)]([{'$lookup':{'from':_0x1ca038(0x283),'localField':'customer','foreignField':_0x1ca038(0x203),'as':'customers_docs'}},{'$unwind':_0x1ca038(0x1f2)},{'$unwind':_0x1ca038(0x252)},{'$group':{'_id':_0x1ca038(0x26a),'invoice':{'$first':_0x1ca038(0x210)},'customers':{'$first':'$customer'},'date':{'$first':_0x1ca038(0x1f0)},'warehouse_name':{'$first':_0x1ca038(0x2d0)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x1ca038(0x1d3)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x1ca038(0x1f2)},'total_saleproduct_quantity':{'$sum':_0x1ca038(0x23a)},'level':{'$addToSet':_0x1ca038(0x2be)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x1ca038(0x22b)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x5a2535=await sales_finished[_0x1ca038(0x240)]([{'$lookup':{'from':_0x1ca038(0x283),'localField':_0x1ca038(0x24c),'foreignField':_0x1ca038(0x203),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x1ca038(0x252)},{'$group':{'_id':_0x1ca038(0x26a),'invoice':{'$first':_0x1ca038(0x210)},'customers':{'$first':_0x1ca038(0x22e)},'date':{'$first':_0x1ca038(0x1f0)},'warehouse_name':{'$first':_0x1ca038(0x2d0)},'sale_product':{'$push':_0x1ca038(0x252)},'note':{'$first':_0x1ca038(0x1d3)},'return_data':{'$first':_0x1ca038(0x274)},'customers_docs':{'$first':_0x1ca038(0x1f2)},'total_saleproduct_quantity':{'$sum':_0x1ca038(0x23a)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x1ca038(0x262)},'type':{'$addToSet':_0x1ca038(0x1cb)},'pallet':{'$addToSet':_0x1ca038(0x22b)},'finalize':{'$first':_0x1ca038(0x1d2)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x21e78d[0x0][_0x1ca038(0x2ed)]==_0x1ca038(0x21f)){var _0x5d4b0=users[_0x1ca038(0x2db)];console[_0x1ca038(0x279)](_0x5d4b0);}else{if(_0x21e78d[0x0][_0x1ca038(0x2ed)]==_0x1ca038(0x2cd))var _0x5d4b0=users[_0x1ca038(0x2cd)];else{if(_0x21e78d[0x0][_0x1ca038(0x2ed)]==_0x1ca038(0x295))var _0x5d4b0=users[_0x1ca038(0x295)];else{if(_0x21e78d[0x0][_0x1ca038(0x2ed)]==_0x1ca038(0x226))var _0x5d4b0=users[_0x1ca038(0x226)];else{if(_0x21e78d[0x0][_0x1ca038(0x2ed)]=='French')var _0x5d4b0=users['French'];else{if(_0x21e78d[0x0][_0x1ca038(0x2ed)]=='Portuguese\x20(BR)')var _0x5d4b0=users['Portuguese'];else{if(_0x21e78d[0x0][_0x1ca038(0x2ed)]==_0x1ca038(0x28f))var _0x5d4b0=users[_0x1ca038(0x28f)];else{if(_0x21e78d[0x0][_0x1ca038(0x2ed)]==_0x1ca038(0x2bf))var _0x5d4b0=users[_0x1ca038(0x23d)];}}}}}}}_0x557657[_0x1ca038(0x205)](_0x1ca038(0x1f8),{'success':_0x1bbd4e['flash'](_0x1ca038(0x2a6)),'errors':_0x1bbd4e[_0x1ca038(0x2eb)](_0x1ca038(0x228)),'sales':_0x5a2535,'profile':_0x20d3af,'role':_0x3f519f,'master_shop':_0x21e78d,'language':_0x5d4b0});}catch(_0x77d9e9){console['log'](_0x77d9e9);}});async function getRandom8DigitNumber(){var _0x2b475b=a0_0x13961e;const _0x417c4b=0x989680,_0x3d37b8=0x5f5e0ff,_0x2a1082=Math[_0x2b475b(0x20f)](Math[_0x2b475b(0x2ba)]()*(_0x3d37b8-_0x417c4b+0x1))+_0x417c4b;var _0x424d67;const _0x3c473a=await sales_finished[_0x2b475b(0x269)]({'invoice':_0x2b475b(0x273)+_0x2a1082});return _0x3c473a&&_0x3c473a[_0x2b475b(0x2bc)]>0x0?_0x424d67='OUTF-'+_0x2a1082:_0x424d67=_0x2b475b(0x273)+_0x2a1082,_0x424d67;}function a0_0xd790(){var _0x2f25c7=['product_name_QA1','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','stocks_QA','product_code_QA','password','post','map','warehouse','Sale\x20Return','<tr>','$sale_product.quantity','add\x20post','Return\x20Goods','Arabic','$product_details.primary_code','Portuguese','aggregate','note','/all_sales_finished/view','max_per_unit','<div>','True','Sales\x20Update\x20successfully','product','/view/add_sale/product','sale_qty','Quality\x20Inspection','maxProducts_QA','customer','redirect','101254XBqZBw','product_date','$name','Finished\x20Goods','$sale_product','logo','abs','French','$product_details.expiry_date','17RQIXIY','</body></html>','sale_product','amount','find','\x20&&\x20','$product_details.rack','gmail','\x20==\x20','$product_details.bin','sales_quantity','$sale_product.bin','</span>','getDate','role','<h5>','invoice','../public/language/languages.json','findOne','$_id','\x20<<<==>>>\x20','$product_details','customer_data','\x20Order\x20Number\x20:\x20','Enclosed','forEach','filter','email','OUTF-','$return_data','</table>','../middleware/auth','/barcode/:id','QA\x20Warehouse','log','return_sale','Received\x20Payment\x20For\x20Sale','An\x20error\x20occurred.','/view/add_sales/:id','split','/../public','25349700UbuSLh','room_name','sales\x20item\x20return\x20successfull','customers','params','$product_details.secondary_unit','</thead>','prod_invoice','expiry_date_QA','3413380HoCDxQ','host','product_list','exports','master','back','Chinese','received_amount','user','$product_details.production_date','primary_code_QA','Sale\x20Return\x20Mail','German','/view','/invoice/:id','json','Sale','staff','</head><body>','save','Sales\x20Mail','adjust_qty','RoomAssigned','$room','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/preview/:id','getFullYear','date','success','return_data','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','stock','42304kssXNc','Router','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_details','payment\x20successfull','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','barcode\x20user_id','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','nodemailer','secondary_unit_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<hr\x20class=\x22my-3\x22>','$product_details.room_name','suppliers','random','production_date_QA','length','barcode\x20Product\x20master','$sale_product.bay','Arabic\x20(ae)','then','product_data','error','prod_code','due_amount','prod_cat','Add\x20Sales','get','$product_details.storage','<strong>\x20Regards\x20</strong>','$product_details.product_code','FGSEmail','id_transaction_from','Hindi','edit_sales_finished_view','747OaSbAy','$warehouse_name','/view/return_sales/:id','30dVaXmA','$product_details.product_name','primary_unit','sales_invoice','/upload/','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','697295HKtbiO','maxProducts','$product_details.unit','English','secondary_code_QA','product_code','<!DOCTYPE\x20html>','currency_placement','_id','/view/add_sales','$product_details.maxPerUnit','<html><head><title></title>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</h5>','body','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','return_sale_QA','expiry_date','concat','flash','\x20<>\x20','language','/give_payment/:id','$product_details._id','warehouse_name','</div>','$sale_product.type','$product_details.bay','An\x20error\x20occurred\x20while\x20saving\x20data.','<tbody\x20style=\x22text-align:\x20center;\x22>','</tr>','string','$product_details.secondary_code','$finalize','$note','DRY\x20GOODS','$product_details.product_cat','</tbody>','product_stock','</td>','all','push','level','bay','../models/all_models','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','\x20>>>\x20','final','edit_sales_finished','/all_sales_finished/preview/','Logo.png','<span\x20style=\x22float:\x20right;\x22>','<h2>\x20','unit','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','all_sales_barcode','\x20Order\x20Date\x20:\x20','maxPerUnit','/all_sales/view','secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.floorlevel','port','$date','Ambient','$customers_docs','foreach\x20newproduct','$product_details.batch_code','2968714OUhGSx','max','toString','all_sales_finished','carton','quantity','\x20</h2>','return_qty','getMonth','$product.product_name','batch_code_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','maxperunit','findById','name','$product_details.type','render','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','createTransport','message','stock_data','unit_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','express','product_name','return_qty_QA','floor','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.product_stock','Sales\x20Add\x20successfully','<h5\x20style=\x22text-align:\x20left;\x22>','Return\x20Rooms','ADD\x20SALE','image','batch_code','catch','$product_details.invoice','Email\x20sent\x20successfully','1555872Clhbwd','secondary_code','English\x20(US)','christian.villamer@jakagroup.com','sales_quantity_QA','maxPerUnit_QA','for_categorize','site_title','currency','Spanish','Portuguese\x20(BR)','errors','status','Error\x20Occurs','$sale_product.floorlevel','/view/:id','production_date','$customer'];a0_0xd790=function(){return _0x2f25c7;};return a0_0xd790();}router[a0_0x13961e(0x2c7)]('/view/add_sales',auth,async(_0x3a17ba,_0x4dda8e)=>{var _0x2222cf=a0_0x13961e;try{const {username:_0xe9cf8f,email:_0x37ed07,role:_0x9b895a}=_0x3a17ba['user'],_0x26267b=_0x3a17ba[_0x2222cf(0x291)],_0x3c0f23=await profile[_0x2222cf(0x269)]({'email':_0x26267b['email']}),_0x250ebe=await master_shop['find'](),_0xbfb1c1=await customer[_0x2222cf(0x25b)]({});let _0x2fa576;if(_0x26267b[_0x2222cf(0x265)]=='staff'){const _0xe8eef1=await staff[_0x2222cf(0x269)]({'email':_0x26267b[_0x2222cf(0x272)]});_0x2fa576=await warehouse['aggregate']([{'$match':{'status':_0x2222cf(0x2b2),'name':_0xe8eef1[_0x2222cf(0x237)],'warehouse_category':_0x2222cf(0x251),'name':{'$ne':_0x2222cf(0x278)}}},{'$group':{'_id':_0x2222cf(0x250),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x2fa576=await warehouse[_0x2222cf(0x240)]([{'$match':{'status':_0x2222cf(0x2b2),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x2222cf(0x278)}}},{'$group':{'_id':_0x2222cf(0x250),'name':{'$first':_0x2222cf(0x250)}}},{'$sort':{'name':0x1}}]);const _0x3cf8bd=await product[_0x2222cf(0x25b)]({});var _0x4e69b7=[_0x2222cf(0x1f1),_0x2222cf(0x26f)];const _0x161b9b=await sales_finished[_0x2222cf(0x25b)]({}),_0x125fd1=_0x161b9b[_0x2222cf(0x2bc)]+0x1,_0x3988c0=_0x2222cf(0x273)+_0x125fd1[_0x2222cf(0x1f7)]()['padStart'](0x5,'0');if(_0x250ebe[0x0][_0x2222cf(0x2ed)]==_0x2222cf(0x21f)){var _0x434b12=users[_0x2222cf(0x2db)];console[_0x2222cf(0x279)](_0x434b12);}else{if(_0x250ebe[0x0][_0x2222cf(0x2ed)]=='Hindi')var _0x434b12=users[_0x2222cf(0x2cd)];else{if(_0x250ebe[0x0][_0x2222cf(0x2ed)]==_0x2222cf(0x295))var _0x434b12=users[_0x2222cf(0x295)];else{if(_0x250ebe[0x0][_0x2222cf(0x2ed)]==_0x2222cf(0x226))var _0x434b12=users['Spanish'];else{if(_0x250ebe[0x0]['language']==_0x2222cf(0x255))var _0x434b12=users[_0x2222cf(0x255)];else{if(_0x250ebe[0x0][_0x2222cf(0x2ed)]==_0x2222cf(0x227))var _0x434b12=users[_0x2222cf(0x23f)];else{if(_0x250ebe[0x0]['language']=='Chinese')var _0x434b12=users['Chinese'];else{if(_0x250ebe[0x0][_0x2222cf(0x2ed)]==_0x2222cf(0x2bf))var _0x434b12=users[_0x2222cf(0x23d)];}}}}}}}const _0x4309b5=getRandom8DigitNumber();_0x4309b5[_0x2222cf(0x2c0)](_0x569553=>{var _0x4eb485=_0x2222cf;_0x4dda8e['render']('add_sales_finished',{'success':_0x3a17ba[_0x4eb485(0x2eb)](_0x4eb485(0x2a6)),'errors':_0x3a17ba[_0x4eb485(0x2eb)]('errors'),'role':_0x26267b,'profile':_0x3c0f23,'customer':_0xbfb1c1,'warehouse':_0x2fa576,'product':_0x3cf8bd,'invoice':_0x569553,'master_shop':_0x250ebe,'language':_0x434b12,'rooms_data':_0x4e69b7});})[_0x2222cf(0x21a)](_0xab59f8=>{var _0x3bc9a4=_0x2222cf;_0x3a17ba[_0x3bc9a4(0x2eb)](_0x3bc9a4(0x228),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x4dda8e['redirect']('/all_sales_finished/view');});}catch(_0x382970){console[_0x2222cf(0x279)](_0x382970);}}),router[a0_0x13961e(0x2c7)](a0_0x13961e(0x27d),auth,async(_0x4806cb,_0x8c35b)=>{var _0x32b977=a0_0x13961e;try{const _0x15a0d4=_0x4806cb[_0x32b977(0x284)]['id'];console[_0x32b977(0x279)](_0x15a0d4);const _0x5cef84=await product[_0x32b977(0x25b)](),_0x40c485=await purchases[_0x32b977(0x240)]([{'$match':{'warehouse_name':_0x15a0d4}},{'$unwind':'$product'},{'$group':{'_id':_0x32b977(0x1fe)}}]);console[_0x32b977(0x279)]('purchases_data',_0x40c485),_0x8c35b['status'](0xc8)[_0x32b977(0x298)]({'purchases_data':_0x40c485,'product_data':_0x5cef84});}catch(_0x217f2a){console[_0x32b977(0x279)](_0x217f2a);}}),router[a0_0x13961e(0x235)](a0_0x13961e(0x248),auth,async(_0xc9de3,_0x24b103)=>{var _0x1e0d36=a0_0x13961e;try{const {warehouse_data:_0x4c58d2,product_data:_0x171ebe}=_0xc9de3['body'];console['log'](_0xc9de3['body'][_0x1e0d36(0x2c1)]);;const _0x2b5234=await master_shop[_0x1e0d36(0x25b)]();console[_0x1e0d36(0x279)](_0x1e0d36(0x28d),_0x2b5234);const _0x1da2b1=await product[_0x1e0d36(0x269)]({'name':_0x171ebe});console[_0x1e0d36(0x279)](_0x1e0d36(0x247),_0x1da2b1);const _0x404551=await warehouse['aggregate']([{'$match':{'name':_0x4c58d2}},{'$unwind':_0x1e0d36(0x26c)},{'$match':{'product_details.product_name':_0x171ebe}},{'$group':{'_id':_0x1e0d36(0x2d3),'product_stock':{'$first':_0x1e0d36(0x213)}}}]);console['log'](_0x1e0d36(0x209),_0x404551),_0x24b103[_0x1e0d36(0x229)](0xc8)[_0x1e0d36(0x298)]({'master':_0x2b5234,'new_product':_0x1da2b1,'stock_data':_0x404551});}catch(_0x4181ea){console[_0x1e0d36(0x279)](_0x4181ea);}}),router[a0_0x13961e(0x235)](a0_0x13961e(0x2e1),auth,async(_0xafc76,_0x5093e1)=>{var _0x2f3ebf=a0_0x13961e;try{const {invoice:_0x462523,date:_0x4480b8,warehouse_name:_0x429c7d,product_name:_0x3a6dcc,stock:_0x53055c,quantity:_0x39c0dc,note:_0x9e8f04,room:_0x147ace,primary_code:_0x5074f7,secondary_code:_0x2ee44c,prod_code:_0xc2bdcf,level:_0x2e4c0e,isle:_0x19c294,pallet:_0xa2cac2,batch_code:_0x4286f5,SCRN:_0x2c3cae,expiry_date:_0x366644,mode_transpo:_0x40911b,name_driver:_0x93c798}=_0xafc76[_0x2f3ebf(0x2e6)];if(typeof _0x3a6dcc==_0x2f3ebf(0x1d0))var _0x428e22=[_0xafc76[_0x2f3ebf(0x2e6)]['product_name']],_0x5d68c7=[_0xafc76[_0x2f3ebf(0x2e6)]['stock']],_0xaf9cd0=[_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x1f9)]],_0x1a7c20=[_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x2a1)]],_0x5143d3=[_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x21e)]],_0x872d62=[_0xafc76[_0x2f3ebf(0x2e6)]['prod_code']],_0x1da203=[_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x1db)]],_0x3b9f91=[_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x2d4)]],_0x44dbd9=[_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x1ec)]],_0x340e9a=[_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x219)]],_0x199968=[_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x2e9)]],_0x41ecc1=[_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x24f)]],_0x44aa4a=[_0xafc76['body'][_0x2f3ebf(0x243)]],_0x8f6c06=[_0xafc76['body']['prod_cat']],_0x299f98=[_0xafc76[_0x2f3ebf(0x2e6)]['RoomAssigned']],_0x4f32e1=[_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x287)]],_0x3074cc=[_0xafc76[_0x2f3ebf(0x2e6)]['id_transaction_from']];else var _0x428e22=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x20d)]],_0x5d68c7=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x2aa)]],_0xaf9cd0=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x1f9)]],_0x1a7c20=[..._0xafc76['body'][_0x2f3ebf(0x2a1)]],_0x5143d3=[..._0xafc76['body']['secondary_code']],_0x872d62=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x2c3)]],_0x1da203=[..._0xafc76[_0x2f3ebf(0x2e6)]['level']],_0x3b9f91=[..._0xafc76['body'][_0x2f3ebf(0x2d4)]],_0x44dbd9=[..._0xafc76['body'][_0x2f3ebf(0x1ec)]],_0x340e9a=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x219)]],_0x199968=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x2e9)]],_0x41ecc1=[..._0xafc76[_0x2f3ebf(0x2e6)]['product_date']],_0x44aa4a=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x243)]],_0x8f6c06=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x2c5)]],_0x299f98=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x29f)]],_0x4f32e1=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x287)]],_0x3074cc=[..._0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x2cc)]];const _0x3a1a54=_0x428e22[_0x2f3ebf(0x236)](_0x34cd3d=>{return _0x34cd3d={'product_name':_0x34cd3d};});_0x5d68c7[_0x2f3ebf(0x270)]((_0x59ed33,_0x5734fa)=>{_0x3a1a54[_0x5734fa]['stock']=_0x59ed33;}),_0xaf9cd0['forEach']((_0x10d97c,_0x38cc89)=>{var _0x5c48ef=_0x2f3ebf;_0x3a1a54[_0x38cc89][_0x5c48ef(0x1fa)]=Math['abs'](_0x10d97c);}),_0x3074cc['forEach']((_0x5e93f0,_0x40d26a)=>{var _0x3b6a96=_0x2f3ebf;_0x3a1a54[_0x40d26a][_0x3b6a96(0x2cc)]=_0x5e93f0;}),_0x1a7c20[_0x2f3ebf(0x270)]((_0xd37667,_0x5447f9)=>{_0x3a1a54[_0x5447f9]['primary_code']=_0xd37667;}),_0x5143d3[_0x2f3ebf(0x270)]((_0xeead2a,_0x1cce53)=>{var _0x597cae=_0x2f3ebf;_0x3a1a54[_0x1cce53][_0x597cae(0x21e)]=_0xeead2a;}),_0x872d62[_0x2f3ebf(0x270)]((_0x321466,_0xc64b35)=>{var _0x72b61d=_0x2f3ebf;_0x3a1a54[_0xc64b35][_0x72b61d(0x2dd)]=_0x321466;}),_0x1da203[_0x2f3ebf(0x270)]((_0x286965,_0x5460f0)=>{var _0x7a9ade=_0x2f3ebf;_0x3a1a54[_0x5460f0][_0x7a9ade(0x1dc)]=_0x286965;}),_0x3b9f91[_0x2f3ebf(0x270)]((_0x2fc031,_0x44e80a)=>{var _0x53b2c8=_0x2f3ebf;_0x3a1a54[_0x44e80a][_0x53b2c8(0x1e6)]=_0x2fc031;}),_0x44dbd9[_0x2f3ebf(0x270)]((_0x6a3850,_0x439302)=>{var _0x1f0699=_0x2f3ebf;_0x3a1a54[_0x439302][_0x1f0699(0x1ec)]=_0x6a3850;}),_0x340e9a[_0x2f3ebf(0x270)]((_0x2adc1a,_0x58fd3d)=>{var _0x4ac1a5=_0x2f3ebf;_0x3a1a54[_0x58fd3d][_0x4ac1a5(0x219)]=_0x2adc1a;}),_0x199968['forEach']((_0x3a6c1b,_0x599434)=>{_0x3a1a54[_0x599434]['expiry_date']=_0x3a6c1b;}),_0x41ecc1[_0x2f3ebf(0x270)]((_0x3e226f,_0x5c0325)=>{_0x3a1a54[_0x5c0325]['production_date']=_0x3e226f;}),_0x44aa4a['forEach']((_0x3edcf5,_0x10fde9)=>{var _0xbe07e3=_0x2f3ebf;_0x3a1a54[_0x10fde9][_0xbe07e3(0x201)]=_0x3edcf5;}),_0x8f6c06[_0x2f3ebf(0x270)]((_0x257e1d,_0x4bc89a)=>{var _0x30723e=_0x2f3ebf;_0x3a1a54[_0x4bc89a][_0x30723e(0x2c5)]=_0x257e1d;}),_0x299f98['forEach']((_0xf67daa,_0x59a8de)=>{var _0x46086d=_0x2f3ebf;_0x3a1a54[_0x59a8de][_0x46086d(0x281)]=_0xf67daa;}),_0x4f32e1[_0x2f3ebf(0x270)]((_0x111de1,_0x24522e)=>{var _0xdb2ea2=_0x2f3ebf;_0x3a1a54[_0x24522e][_0xdb2ea2(0x267)]=_0x111de1;});var _0x37c703=0x0;_0x3a1a54[_0x2f3ebf(0x270)](_0x132db9=>{var _0xf4aee=_0x2f3ebf;parseFloat(_0x132db9[_0xf4aee(0x2aa)])<parseFloat(_0x132db9[_0xf4aee(0x1fa)])&&parseFloat(_0x132db9[_0xf4aee(0x1fa)])>parseFloat(_0x132db9[_0xf4aee(0x2aa)])&&(console[_0xf4aee(0x279)](_0x132db9[_0xf4aee(0x2aa)]+_0xf4aee(0x2ec)+_0x132db9[_0xf4aee(0x1fa)]),_0x37c703++);});if(_0x37c703!=0x0)return _0xafc76[_0x2f3ebf(0x2eb)]('errors',_0x2f3ebf(0x2d7)),_0x5093e1[_0x2f3ebf(0x24d)]('back');const _0x6c2afb=_0x3a1a54[_0x2f3ebf(0x271)](_0x1b9357=>_0x1b9357['quantity']!=='0'&&_0x1b9357['quantity']!==''),_0x4dc7a6=new sales_finished({'invoice':_0x462523,'customer':_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x24c)],'date':_0x4480b8,'warehouse_name':_0x429c7d,'sale_product':_0x6c2afb,'note':_0x9e8f04,'room':_0x147ace,'primary_code':_0x5074f7,'secondary_code':_0x2ee44c,'prod_code':_0xc2bdcf,'SCRN':_0x2c3cae,'finalize':'False','mode_transpo':_0x40911b,'name_driver':_0x93c798}),_0x2abcc0=await _0x4dc7a6[_0x2f3ebf(0x29c)](),_0x54aacb=await sales_finished['findOne']({'invoice':_0x462523}),_0x15b9b5=new c_payment_data({'invoice':_0x462523,'customer':_0xafc76['body'][_0x2f3ebf(0x24c)],'reason':_0x2f3ebf(0x299)});await _0x15b9b5[_0x2f3ebf(0x29c)]();const _0x16ade6=await master_shop[_0x2f3ebf(0x25b)](),_0x2add35=await email_settings[_0x2f3ebf(0x269)](),_0x780c6=await customer[_0x2f3ebf(0x269)]({'name':_0xafc76[_0x2f3ebf(0x2e6)][_0x2f3ebf(0x24c)]});_0x16ade6[0x0][_0x2f3ebf(0x2df)]==0x1?(right_currency=_0x16ade6[0x0][_0x2f3ebf(0x225)],left_currency=''):(right_currency='',left_currency=_0x16ade6[0x0][_0x2f3ebf(0x225)]);var _0x2beeab=_0x428e22,_0xc4d58a=_0xaf9cd0,_0x48eda9='',_0x5372d2;for(_0x5372d2 in _0x2beeab){_0x48eda9+=_0x2f3ebf(0x239)+_0x2f3ebf(0x2e7)+_0x2beeab[_0x5372d2]+'</td>'+_0x2f3ebf(0x2e7)+_0xc4d58a[_0x5372d2]+_0x2f3ebf(0x1d8)+_0x2f3ebf(0x1cf);}console[_0x2f3ebf(0x279)](_0x2f3ebf(0x28b),_0x48eda9);let _0x3ff9d1=nodemailer[_0x2f3ebf(0x207)]({'host':_0x2add35[_0x2f3ebf(0x28a)],'port':Number(_0x2add35['port']),'secure':![],'service':'gmail','auth':{'user':_0x2add35[_0x2f3ebf(0x272)],'pass':_0x2add35[_0x2f3ebf(0x234)]}}),_0xebd300={'from':_0x2add35[_0x2f3ebf(0x272)],'to':_0x2f3ebf(0x220),'subject':_0x2f3ebf(0x2c6),'attachments':[{'filename':_0x2f3ebf(0x1e3),'path':__dirname+_0x2f3ebf(0x27f)+'/upload/'+_0x16ade6[0x0][_0x2f3ebf(0x218)],'cid':_0x2f3ebf(0x253)}],'html':_0x2f3ebf(0x217)};_0x3ff9d1[_0x2f3ebf(0x230)](_0xebd300,function(_0x25c230,_0xca4c4c){var _0x54c56c=_0x2f3ebf;_0x25c230?(console[_0x54c56c(0x279)](_0x25c230),console[_0x54c56c(0x279)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0xafc76['flash']('success',_0x2f3ebf(0x214)),_0x5093e1[_0x2f3ebf(0x24d)](_0x2f3ebf(0x1e2)+_0x2abcc0[_0x2f3ebf(0x2e0)]);}catch(_0x3a7cbf){console[_0x2f3ebf(0x279)](_0x3a7cbf);}}),router[a0_0x13961e(0x2c7)](a0_0x13961e(0x2a3),auth,async(_0x94a161,_0x80420d)=>{var _0x85d439=a0_0x13961e;try{const {username:_0x618f57,email:_0x3809d3,role:_0x5cb805}=_0x94a161[_0x85d439(0x291)],_0x3115b=_0x94a161[_0x85d439(0x291)],_0xfae5a0=await profile[_0x85d439(0x269)]({'email':_0x3115b[_0x85d439(0x272)]}),_0xf2fcf8=await master_shop[_0x85d439(0x25b)](),_0xedaaa6=_0x94a161[_0x85d439(0x284)]['id'],_0x12a129=await sales_finished[_0x85d439(0x202)](_0xedaaa6),_0x5cf612=await warehouse[_0x85d439(0x240)]([{'$match':{'name':_0x12a129[_0x85d439(0x2f0)]}},{'$unwind':_0x85d439(0x26c)},{'$group':{'_id':_0x85d439(0x2ef),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x85d439(0x213)},'bay':{'$first':_0x85d439(0x1cc)},'bin':{'$first':_0x85d439(0x260)},'type':{'$first':_0x85d439(0x204)},'floorlevel':{'$first':_0x85d439(0x1ee)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x85d439(0x2c8)},'rack':{'$first':_0x85d439(0x25d)},'expiry_date':{'$first':_0x85d439(0x256)},'production_date':{'$first':_0x85d439(0x292)},'batch_code':{'$first':_0x85d439(0x1f4)},'room':{'$first':_0x85d439(0x2a0)},'room_data':{'$first':_0x85d439(0x2b8)}}}]),_0xe0deeb=await customer[_0x85d439(0x25b)]({});let _0x233998;if(_0x3115b[_0x85d439(0x265)]=='staff'){const _0x444091=await staff[_0x85d439(0x269)]({'email':_0x3115b[_0x85d439(0x272)]});_0x233998=await warehouse[_0x85d439(0x240)]([{'$match':{'status':'Enabled','name':_0x444091[_0x85d439(0x237)]}},{'$group':{'_id':_0x85d439(0x250),'name':{'$first':'$name'}}}]);}else _0x233998=await warehouse['aggregate']([{'$match':{'status':_0x85d439(0x2b2)}},{'$group':{'_id':_0x85d439(0x250),'name':{'$first':_0x85d439(0x250)}}}]);const _0x1da420=await product[_0x85d439(0x25b)]({});if(_0xf2fcf8[0x0][_0x85d439(0x2ed)]==_0x85d439(0x21f)){var _0x50d57b=users['English'];console[_0x85d439(0x279)](_0x50d57b);}else{if(_0xf2fcf8[0x0]['language']==_0x85d439(0x2cd))var _0x50d57b=users[_0x85d439(0x2cd)];else{if(_0xf2fcf8[0x0][_0x85d439(0x2ed)]==_0x85d439(0x295))var _0x50d57b=users['German'];else{if(_0xf2fcf8[0x0][_0x85d439(0x2ed)]=='Spanish')var _0x50d57b=users['Spanish'];else{if(_0xf2fcf8[0x0]['language']==_0x85d439(0x255))var _0x50d57b=users[_0x85d439(0x255)];else{if(_0xf2fcf8[0x0]['language']==_0x85d439(0x227))var _0x50d57b=users[_0x85d439(0x23f)];else{if(_0xf2fcf8[0x0][_0x85d439(0x2ed)]=='Chinese')var _0x50d57b=users[_0x85d439(0x28f)];else{if(_0xf2fcf8[0x0][_0x85d439(0x2ed)]=='Arabic\x20(ae)')var _0x50d57b=users[_0x85d439(0x23d)];}}}}}}}_0x80420d[_0x85d439(0x205)](_0x85d439(0x2ce),{'success':_0x94a161[_0x85d439(0x2eb)](_0x85d439(0x2a6)),'errors':_0x94a161[_0x85d439(0x2eb)](_0x85d439(0x228)),'role':_0x3115b,'profile':_0xfae5a0,'customer':_0xe0deeb,'warehouse':_0x233998,'product':_0x5cf612,'user':_0x12a129,'master_shop':_0xf2fcf8,'unit':_0x1da420,'language':_0x50d57b});}catch(_0x494332){console[_0x85d439(0x279)](_0x494332);}}),router['post'](a0_0x13961e(0x2a3),auth,async(_0xd7105c,_0x3c4fd9)=>{var _0x1a08b6=a0_0x13961e;try{const _0x21ae1b=_0xd7105c['params']['id'],{invoice:_0x395473,warehouse_name:_0x2c9d36,room:_0x27024b}=_0xd7105c[_0x1a08b6(0x2e6)],_0x422083=await sales_finished[_0x1a08b6(0x269)]({'invoice':_0x395473}),_0x271d70=_0x422083['sale_product']['map'](async _0x4024ce=>{var _0x571cec=_0x1a08b6,_0x4685ed=await warehouse[_0x571cec(0x269)]({'name':_0x2c9d36,'room':_0x4024ce[_0x571cec(0x281)],'warehouse_category':_0x571cec(0x251)});const _0x5183e3=_0x4685ed[_0x571cec(0x2ae)]['map'](_0x4bfa9d=>{var _0x1e036e=_0x571cec;(_0x4bfa9d['product_name']==_0x4024ce[_0x1e036e(0x20d)]&&_0x4bfa9d[_0x1e036e(0x1dc)]==_0x4024ce['bay']&&_0x4bfa9d['expiry_date']==_0x4024ce[_0x1e036e(0x2e9)]&&_0x4bfa9d['production_date']==_0x4024ce[_0x1e036e(0x22d)]&&_0x4bfa9d[_0x1e036e(0x219)]==_0x4024ce[_0x1e036e(0x219)]&&_0x4bfa9d[_0x1e036e(0x267)]==_0x4024ce[_0x1e036e(0x267)]||_0x4bfa9d[_0x1e036e(0x2e0)]==_0x4024ce[_0x1e036e(0x2cc)])&&(_0x4bfa9d['product_stock']>0x0&&(console[_0x1e036e(0x279)](_0x4bfa9d[_0x1e036e(0x20d)]+_0x1e036e(0x25f)+_0x4024ce[_0x1e036e(0x20d)]+_0x1e036e(0x25c)+_0x4bfa9d['bay']+_0x1e036e(0x25f)+_0x4024ce['bay']+_0x1e036e(0x25c)+_0x4bfa9d[_0x1e036e(0x22d)]+'\x20==\x20'+_0x4024ce[_0x1e036e(0x22d)]+'\x20&&\x20'+_0x4bfa9d[_0x1e036e(0x2e9)]+_0x1e036e(0x25f)+_0x4024ce[_0x1e036e(0x2e9)]+_0x1e036e(0x25c)+_0x4bfa9d[_0x1e036e(0x219)]+_0x1e036e(0x25f)+_0x4024ce[_0x1e036e(0x219)]+_0x1e036e(0x25c)+_0x4bfa9d[_0x1e036e(0x267)]+_0x1e036e(0x25f)+_0x4024ce[_0x1e036e(0x267)]+'\x20&&\x20'+_0x4bfa9d[_0x1e036e(0x1d7)]+_0x1e036e(0x26b)+_0x4024ce[_0x1e036e(0x1fa)]+_0x1e036e(0x1df)+_0x4024ce['room_name']+'\x20&&\x20'+_0x4bfa9d[_0x1e036e(0x2e0)]+_0x1e036e(0x25f)+_0x4024ce['id_transaction_from']),_0x4bfa9d[_0x1e036e(0x1d7)]=Math[_0x1e036e(0x1f6)](0x0,Math['abs'](_0x4bfa9d[_0x1e036e(0x1d7)])-Math[_0x1e036e(0x254)](_0x4024ce['quantity']))));});return _0x4685ed;});Promise[_0x1a08b6(0x1d9)](_0x271d70)[_0x1a08b6(0x2c0)](async _0x1e1bc0=>{var _0x17ebc8=_0x1a08b6;try{for(const _0x2cf0ab of _0x1e1bc0){await _0x2cf0ab[_0x17ebc8(0x29c)]();}_0x422083['finalize']=_0x17ebc8(0x245);const _0x148809=await _0x422083[_0x17ebc8(0x29c)](),_0x102775=await master_shop[_0x17ebc8(0x25b)](),_0x25455c=await email_settings[_0x17ebc8(0x269)](),_0x258d93=await supervisor_settings[_0x17ebc8(0x25b)]();var _0x8bb0e2=_0x422083[_0x17ebc8(0x259)],_0x40a3fb='',_0xc5c52d;for(_0xc5c52d in _0x8bb0e2){var _0x147c62='FG';_0x422083[_0x17ebc8(0x2f0)]==_0x17ebc8(0x1d4)&&(_0x147c62='DG'),_0x40a3fb+=_0x17ebc8(0x239)+_0x17ebc8(0x2e7)+_0x8bb0e2[_0xc5c52d][_0x17ebc8(0x20d)]+'</td>'+_0x17ebc8(0x2e7)+_0x8bb0e2[_0xc5c52d][_0x17ebc8(0x2dd)]+_0x17ebc8(0x1d8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x8bb0e2[_0xc5c52d][_0x17ebc8(0x1fa)]+_0x17ebc8(0x1d8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x8bb0e2[_0xc5c52d]['unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x8bb0e2[_0xc5c52d][_0x17ebc8(0x1ec)]+_0x17ebc8(0x1d8)+_0x17ebc8(0x2e7)+_0x422083[_0x17ebc8(0x2f0)]+_0x17ebc8(0x1d8)+_0x17ebc8(0x2e7)+_0x8bb0e2[_0xc5c52d][_0x17ebc8(0x281)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x147c62+_0x8bb0e2[_0xc5c52d]['bay']+_0x17ebc8(0x1d8);}let _0xe24317=nodemailer[_0x17ebc8(0x207)]({'host':_0x25455c[_0x17ebc8(0x28a)],'port':Number(_0x25455c[_0x17ebc8(0x1ef)]),'secure':![],'auth':{'user':_0x25455c['email'],'pass':_0x25455c[_0x17ebc8(0x234)]}}),_0x2c802f={'from':_0x25455c[_0x17ebc8(0x272)],'to':_0x258d93[0x0][_0x17ebc8(0x2cb)],'subject':_0x17ebc8(0x29d),'attachments':[{'filename':_0x17ebc8(0x1e3),'path':__dirname+'/../public'+_0x17ebc8(0x2d6)+_0x102775[0x0]['image'],'cid':_0x17ebc8(0x253)}],'html':'<!DOCTYPE\x20html>'+_0x17ebc8(0x2e3)+_0x17ebc8(0x29b)+'<div>'+_0x17ebc8(0x2ad)+_0x17ebc8(0x244)+_0x17ebc8(0x2b0)+'</div>'+_0x17ebc8(0x244)+_0x17ebc8(0x1e5)+_0x102775[0x0][_0x17ebc8(0x224)]+'\x20</h2>'+_0x17ebc8(0x1ca)+_0x17ebc8(0x1ca)+_0x17ebc8(0x2b7)+_0x17ebc8(0x244)+_0x17ebc8(0x215)+_0x17ebc8(0x26e)+_0x422083[_0x17ebc8(0x267)]+'\x20'+_0x17ebc8(0x1e4)+_0x17ebc8(0x1e9)+_0x422083[_0x17ebc8(0x2a5)]+'\x20'+_0x17ebc8(0x263)+_0x17ebc8(0x2e5)+'</div>'+_0x17ebc8(0x2e4)+_0x17ebc8(0x206)+'<tr>'+_0x17ebc8(0x2a9)+_0x17ebc8(0x1ed)+_0x17ebc8(0x2b6)+_0x17ebc8(0x200)+_0x17ebc8(0x2b3)+_0x17ebc8(0x2a2)+_0x17ebc8(0x20b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x17ebc8(0x1cf)+'</thead>'+_0x17ebc8(0x1ce)+'\x20'+_0x40a3fb+'\x20'+_0x17ebc8(0x1d6)+_0x17ebc8(0x275)+_0x17ebc8(0x244)+_0x17ebc8(0x2c9)+_0x17ebc8(0x266)+_0x102775[0x0][_0x17ebc8(0x224)]+_0x17ebc8(0x2e5)+'</div>'+_0x17ebc8(0x1ca)+'</body></html>'};_0xe24317['sendMail'](_0x2c802f,function(_0x2d61a1,_0x297a27){var _0x4f6662=_0x17ebc8;_0x2d61a1?(console['log'](_0x2d61a1),console[_0x4f6662(0x279)](_0x4f6662(0x22a))):console['log']('Email\x20sent\x20successfully');}),_0xd7105c[_0x17ebc8(0x2eb)](_0x17ebc8(0x2a6),_0x17ebc8(0x246)),_0x3c4fd9[_0x17ebc8(0x24d)]('/picking_list/pdf/'+_0x21ae1b);}catch(_0x5b314e){console[_0x17ebc8(0x2c2)](_0x5b314e),_0x3c4fd9['status'](0x1f4)[_0x17ebc8(0x298)]({'error':_0x17ebc8(0x1cd)});}})[_0x1a08b6(0x21a)](_0x248d13=>{var _0x4b098d=_0x1a08b6;console[_0x4b098d(0x2c2)](_0x248d13),_0x3c4fd9[_0x4b098d(0x229)](0x1f4)['json']({'error':_0x4b098d(0x27c)});});}catch(_0x53d3e7){console['log'](_0x53d3e7);}}),router[a0_0x13961e(0x2c7)]('/view/:id',auth,async(_0x5555c5,_0x493076)=>{var _0x38d1f0=a0_0x13961e;try{const {username:_0x2bd2ba,email:_0x49afde,role:_0x2482b3}=_0x5555c5['user'],_0x3ecd02=_0x5555c5['user'],_0x123212=await profile[_0x38d1f0(0x269)]({'email':_0x3ecd02[_0x38d1f0(0x272)]}),_0xdb0e4e=await master_shop[_0x38d1f0(0x25b)](),_0x833093=_0x5555c5[_0x38d1f0(0x284)]['id'],_0x17f5e9=await sales_finished[_0x38d1f0(0x202)](_0x833093);let _0x53f3f8=new Date(_0x17f5e9['expiry_date']),_0x340334=('0'+_0x53f3f8['getDate']())['slice'](-0x2),_0x10c395=('0'+(_0x53f3f8['getMonth']()+0x1))['slice'](-0x2),_0x98f5d3=_0x53f3f8[_0x38d1f0(0x2a4)](),_0x1226d7=_0x98f5d3+'-'+_0x10c395+'-'+_0x340334;var _0x3e95cc=[_0x38d1f0(0x1f1),_0x38d1f0(0x26f)];const _0x5df96f=await warehouse[_0x38d1f0(0x240)]([{'$match':{'name':_0x17f5e9[_0x38d1f0(0x2f0)],'room':_0x17f5e9['room']}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x38d1f0(0x2d3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x38d1f0(0x1cc)},'bin':{'$first':_0x38d1f0(0x260)},'type':{'$first':_0x38d1f0(0x204)},'floorlevel':{'$first':_0x38d1f0(0x1ee)},'primary_code':{'$first':_0x38d1f0(0x23e)},'secondary_code':{'$first':_0x38d1f0(0x1d1)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x38d1f0(0x25d)}}}]),_0xc4b9f=await customer[_0x38d1f0(0x25b)]({});let _0x20dd91;if(_0x3ecd02[_0x38d1f0(0x265)]==_0x38d1f0(0x29a)){const _0x587a53=await staff[_0x38d1f0(0x269)]({'email':_0x3ecd02['email']});_0x20dd91=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x587a53[_0x38d1f0(0x237)]}},{'$group':{'_id':_0x38d1f0(0x250),'name':{'$first':'$name'}}}]);}else _0x20dd91=await warehouse[_0x38d1f0(0x240)]([{'$match':{'status':_0x38d1f0(0x2b2)}},{'$group':{'_id':_0x38d1f0(0x250),'name':{'$first':_0x38d1f0(0x250)}}}]);const _0x5c5e08=await product['find']({});if(_0xdb0e4e[0x0][_0x38d1f0(0x2ed)]==_0x38d1f0(0x21f)){var _0x3d2cf2=users['English'];console[_0x38d1f0(0x279)](_0x3d2cf2);}else{if(_0xdb0e4e[0x0][_0x38d1f0(0x2ed)]==_0x38d1f0(0x2cd))var _0x3d2cf2=users['Hindi'];else{if(_0xdb0e4e[0x0][_0x38d1f0(0x2ed)]==_0x38d1f0(0x295))var _0x3d2cf2=users[_0x38d1f0(0x295)];else{if(_0xdb0e4e[0x0][_0x38d1f0(0x2ed)]=='Spanish')var _0x3d2cf2=users[_0x38d1f0(0x226)];else{if(_0xdb0e4e[0x0]['language']==_0x38d1f0(0x255))var _0x3d2cf2=users[_0x38d1f0(0x255)];else{if(_0xdb0e4e[0x0]['language']==_0x38d1f0(0x227))var _0x3d2cf2=users[_0x38d1f0(0x23f)];else{if(_0xdb0e4e[0x0][_0x38d1f0(0x2ed)]=='Chinese')var _0x3d2cf2=users[_0x38d1f0(0x28f)];else{if(_0xdb0e4e[0x0][_0x38d1f0(0x2ed)]==_0x38d1f0(0x2bf))var _0x3d2cf2=users['Arabic'];}}}}}}}_0x493076[_0x38d1f0(0x205)](_0x38d1f0(0x1e1),{'success':_0x5555c5[_0x38d1f0(0x2eb)]('success'),'errors':_0x5555c5['flash'](_0x38d1f0(0x228)),'role':_0x3ecd02,'profile':_0x123212,'customer':_0xc4b9f,'warehouse':_0x20dd91,'product':_0x5df96f,'user':_0x17f5e9,'master_shop':_0xdb0e4e,'unit':_0x5c5e08,'language':_0x3d2cf2,'rooms_data':_0x3e95cc,'ed_fullDate':_0x1226d7});}catch(_0x4194c4){console[_0x38d1f0(0x279)](_0x4194c4);}}),router[a0_0x13961e(0x235)](a0_0x13961e(0x22c),auth,async(_0x43614d,_0x39ee52)=>{var _0x4049f3=a0_0x13961e;try{const _0x777a3c=_0x43614d[_0x4049f3(0x284)]['id'],_0x1ae8b9=await sales_finished[_0x4049f3(0x269)]({'_id':_0x43614d[_0x4049f3(0x284)]['id']}),_0x41a60b=await warehouse[_0x4049f3(0x269)]({'name':_0x1ae8b9[_0x4049f3(0x2f0)],'room':_0x43614d['body']['room'],'warehouse_category':_0x4049f3(0x251)}),{invoice:_0x3aa193,customer:_0x3e80c1,date:_0x4c88e2,warehouse_name:_0x32ee73,product_name:_0x8ee643,stock:_0x444adc,adjust_qty:_0x36e3af,note:_0x534894,room:_0x5ade9a,primary_code:_0x52b30d,secondary_code:_0x3d75ae,prod_code:_0x296d58,level:_0x3263cd,isle:_0x159679,pallet:_0x470eb5,expiry_date:_0x1abb44}=_0x43614d['body'];if(typeof _0x8ee643==_0x4049f3(0x1d0))var _0xcc540b=[_0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x20d)]],_0x3c9595=[_0x43614d[_0x4049f3(0x2e6)]['stock']],_0x194996=[_0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x29e)]],_0x263ed6=[_0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x2a1)]],_0x54c86f=[_0x43614d[_0x4049f3(0x2e6)]['secondary_code']],_0x475657=[_0x43614d['body']['prod_code']],_0x42c1c4=[_0x43614d['body']['level']],_0x4ca1f7=[_0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x2e9)]];else var _0xcc540b=[..._0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x20d)]],_0x3c9595=[..._0x43614d['body'][_0x4049f3(0x2aa)]],_0x194996=[..._0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x29e)]],_0x263ed6=[..._0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x2a1)]],_0x54c86f=[..._0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x21e)]],_0x475657=[..._0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x2c3)]],_0x42c1c4=[..._0x43614d['body'][_0x4049f3(0x1db)]],_0x4ca1f7=[..._0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x2e9)]];const _0x3f4f8a=_0xcc540b[_0x4049f3(0x236)](_0x39d707=>{return _0x39d707={'product_name':_0x39d707};});_0x3c9595[_0x4049f3(0x270)]((_0x3d53d,_0x537b51)=>{var _0x13a4e8=_0x4049f3;_0x3f4f8a[_0x537b51][_0x13a4e8(0x2aa)]=_0x3d53d;}),_0x194996['forEach']((_0x253038,_0xb1656a)=>{var _0x385804=_0x4049f3;_0x3f4f8a[_0xb1656a][_0x385804(0x1fa)]=_0x253038;}),_0x263ed6[_0x4049f3(0x270)]((_0x3b4880,_0x1b4df5)=>{var _0x397edc=_0x4049f3;_0x3f4f8a[_0x1b4df5][_0x397edc(0x2a1)]=_0x3b4880;}),_0x54c86f[_0x4049f3(0x270)]((_0x3af9e3,_0x321ca8)=>{var _0x4d713a=_0x4049f3;_0x3f4f8a[_0x321ca8][_0x4d713a(0x21e)]=_0x3af9e3;}),_0x475657[_0x4049f3(0x270)]((_0x2b98d1,_0xcb1906)=>{var _0x1f0358=_0x4049f3;_0x3f4f8a[_0xcb1906][_0x1f0358(0x2dd)]=_0x2b98d1;}),_0x42c1c4[_0x4049f3(0x270)]((_0x2ee08c,_0x2c4aa2)=>{var _0x407d0f=_0x4049f3;_0x3f4f8a[_0x2c4aa2][_0x407d0f(0x1db)]=_0x2ee08c;}),_0x4ca1f7[_0x4049f3(0x270)]((_0x51b8ec,_0x48bd5f)=>{_0x3f4f8a[_0x48bd5f]['expiry_date']=_0x51b8ec;});var _0x44de3e=0x0;_0x3f4f8a[_0x4049f3(0x270)](_0x1e39b7=>{var _0x31c924=_0x4049f3;console[_0x31c924(0x279)](_0x31c924(0x1f3),_0x1e39b7),(parseInt(_0x1e39b7[_0x31c924(0x2aa)])<parseInt(_0x1e39b7[_0x31c924(0x1fa)])||parseInt(_0x1e39b7[_0x31c924(0x1fa)])==0x0)&&_0x44de3e++;});if(_0x44de3e!=0x0)return _0x43614d[_0x4049f3(0x2eb)](_0x4049f3(0x228),_0x4049f3(0x1de)),_0x39ee52[_0x4049f3(0x24d)](_0x4049f3(0x28e));_0x1ae8b9[_0x4049f3(0x259)][_0x4049f3(0x270)](_0x250449=>{var _0x4f4e29=_0x4049f3;const _0x52e82b=_0x41a60b['product_details'][_0x4f4e29(0x236)](_0x1cd9b5=>{var _0x22609d=_0x4f4e29;_0x1cd9b5[_0x22609d(0x20d)]==_0x250449[_0x22609d(0x20d)]&&_0x1cd9b5['bay']==_0x250449[_0x22609d(0x1dc)]&&(_0x1cd9b5[_0x22609d(0x1d7)]=parseInt(_0x1cd9b5[_0x22609d(0x1d7)])+parseInt(_0x250449[_0x22609d(0x1fa)]));});}),await _0x41a60b[_0x4049f3(0x29c)]();const _0x2b605d=_0x3f4f8a[_0x4049f3(0x271)](_0x2767db=>_0x2767db[_0x4049f3(0x1fa)]!=='0'&&_0x2767db[_0x4049f3(0x1fa)]!=='');_0x1ae8b9['invoice']=_0x3aa193,_0x1ae8b9[_0x4049f3(0x24c)]=_0x3e80c1,_0x1ae8b9['date']=_0x4c88e2,_0x1ae8b9[_0x4049f3(0x2f0)]=_0x32ee73,_0x1ae8b9[_0x4049f3(0x259)]=_0x2b605d,_0x1ae8b9[_0x4049f3(0x241)]=_0x534894,_0x1ae8b9['room']=_0x5ade9a;const _0x24a9a6=await _0x1ae8b9[_0x4049f3(0x29c)](),_0x590e0d=await sales_finished[_0x4049f3(0x269)]({'_id':_0x43614d[_0x4049f3(0x284)]['id']}),_0x5f34be=await warehouse[_0x4049f3(0x269)]({'name':_0x32ee73,'room':_0x5ade9a,'warehouse_category':_0x4049f3(0x251)});_0x590e0d['sale_product']['forEach'](_0x21e988=>{var _0x104f85=_0x4049f3;const _0x2b50d8=_0x5f34be[_0x104f85(0x2ae)][_0x104f85(0x236)](_0x3f8550=>{var _0x25d4d9=_0x104f85;_0x3f8550[_0x25d4d9(0x20d)]==_0x21e988[_0x25d4d9(0x20d)]&&_0x3f8550[_0x25d4d9(0x1dc)]==_0x21e988['bay']&&(_0x3f8550[_0x25d4d9(0x1d7)]=parseInt(_0x3f8550[_0x25d4d9(0x1d7)])-parseInt(_0x21e988[_0x25d4d9(0x1fa)]));});}),console[_0x4049f3(0x279)](_0x4049f3(0x1e0),_0x5f34be),await _0x5f34be['save']();const _0x438731=await c_payment_data[_0x4049f3(0x269)]({'invoice':_0x43614d[_0x4049f3(0x2e6)][_0x4049f3(0x267)]});_0x438731['suppliers']=_0x43614d['body'][_0x4049f3(0x2b9)],await _0x438731['save'](),_0x43614d[_0x4049f3(0x2eb)]('success',_0x4049f3(0x246)),_0x39ee52['redirect'](_0x4049f3(0x242));}catch(_0x4c1685){console[_0x4049f3(0x279)](_0x4c1685);}}),router[a0_0x13961e(0x235)](a0_0x13961e(0x2ee),auth,async(_0x1567ca,_0x34180f)=>{var _0x1bacd1=a0_0x13961e;try{const _0x3d09e8=_0x1567ca['params']['id'],{invoice:_0x49f750,customer:_0x58e97d,receivable_amount:_0x125ffa,received_amount:_0x253980}=_0x1567ca['body'],_0x31d66f=await sales[_0x1bacd1(0x202)](_0x3d09e8);console[_0x1bacd1(0x279)](_0x31d66f);var _0x274e02=_0x125ffa-_0x253980;console[_0x1bacd1(0x279)](_0x253980),_0x31d66f['received_amount']=parseFloat(_0x253980)+parseFloat(_0x31d66f[_0x1bacd1(0x290)]),_0x31d66f[_0x1bacd1(0x2c4)]=_0x274e02,console[_0x1bacd1(0x279)](_0x31d66f);const _0x302d4d=await _0x31d66f['save'](),_0x57289b=await c_payment_data['findOne']({'invoice':_0x49f750});_0x57289b[_0x1bacd1(0x25a)]=_0x274e02,await _0x57289b['save']();let _0x466dae=new Date(),_0x313829=('0'+_0x466dae[_0x1bacd1(0x264)]())['slice'](-0x2),_0x1fe4ae=('0'+(_0x466dae[_0x1bacd1(0x1fd)]()+0x1))['slice'](-0x2),_0x280997=_0x466dae[_0x1bacd1(0x2a4)](),_0x16b7f0=_0x280997+'-'+_0x1fe4ae+'-'+_0x313829;const _0x5964d3=new customer_payment({'invoice':_0x49f750,'date':_0x280997+'-'+_0x1fe4ae+'-'+_0x313829,'customer':_0x58e97d,'reason':_0x1bacd1(0x27b),'amount':_0x253980}),_0x3b6563=await _0x5964d3[_0x1bacd1(0x29c)]();_0x1567ca[_0x1bacd1(0x2eb)]('success',_0x1bacd1(0x2af)),_0x34180f[_0x1bacd1(0x24d)](_0x1bacd1(0x1eb));}catch(_0x5b9b1a){console['log'](_0x5b9b1a);}}),router[a0_0x13961e(0x2c7)](a0_0x13961e(0x297),auth,async(_0x5daa52,_0x3a2d32)=>{var _0x5312b1=a0_0x13961e;try{const {username:_0x433f79,email:_0x244f0f,role:_0x403f84}=_0x5daa52[_0x5312b1(0x291)],_0xd39df=_0x5daa52['user'],_0x1e95a6=await profile[_0x5312b1(0x269)]({'email':_0xd39df[_0x5312b1(0x272)]}),_0x1c811e=await master_shop['find']();console[_0x5312b1(0x279)]('master',_0x1c811e);const _0x2030dc=_0x5daa52[_0x5312b1(0x284)]['id'],_0x199bb9=await sales[_0x5312b1(0x202)](_0x2030dc);console[_0x5312b1(0x279)](_0x199bb9);const _0x52741a=await customer[_0x5312b1(0x269)]({'name':_0x199bb9[_0x5312b1(0x24c)]});console['log'](_0x52741a);if(_0x1c811e[0x0][_0x5312b1(0x2ed)]==_0x5312b1(0x21f)){var _0x4c8417=users[_0x5312b1(0x2db)];console[_0x5312b1(0x279)](_0x4c8417);}else{if(_0x1c811e[0x0][_0x5312b1(0x2ed)]=='Hindi')var _0x4c8417=users[_0x5312b1(0x2cd)];else{if(_0x1c811e[0x0][_0x5312b1(0x2ed)]=='German')var _0x4c8417=users['German'];else{if(_0x1c811e[0x0][_0x5312b1(0x2ed)]=='Spanish')var _0x4c8417=users['Spanish'];else{if(_0x1c811e[0x0][_0x5312b1(0x2ed)]==_0x5312b1(0x255))var _0x4c8417=users[_0x5312b1(0x255)];else{if(_0x1c811e[0x0][_0x5312b1(0x2ed)]==_0x5312b1(0x227))var _0x4c8417=users['Portuguese'];else{if(_0x1c811e[0x0][_0x5312b1(0x2ed)]==_0x5312b1(0x28f))var _0x4c8417=users['Chinese'];else{if(_0x1c811e[0x0][_0x5312b1(0x2ed)]==_0x5312b1(0x2bf))var _0x4c8417=users[_0x5312b1(0x23d)];}}}}}}}_0x3a2d32[_0x5312b1(0x205)](_0x5312b1(0x2d5),{'success':_0x5daa52[_0x5312b1(0x2eb)]('success'),'errors':_0x5daa52[_0x5312b1(0x2eb)](_0x5312b1(0x228)),'role':_0xd39df,'profile':_0x1e95a6,'master_shop':_0x1c811e,'customers':_0x52741a,'sales':_0x199bb9,'language':_0x4c8417});}catch(_0x44dbb0){console[_0x5312b1(0x279)](_0x44dbb0);}}),router[a0_0x13961e(0x2c7)](a0_0x13961e(0x2d1),auth,async(_0x4784ef,_0x4b6280)=>{var _0x3327bf=a0_0x13961e;try{const {username:_0x44d8ef,email:_0x2a4d4c,role:_0x5655a4}=_0x4784ef[_0x3327bf(0x291)],_0x43432c=_0x4784ef[_0x3327bf(0x291)],_0x1448cf=await profile[_0x3327bf(0x269)]({'email':_0x43432c[_0x3327bf(0x272)]}),_0x409e99=await master_shop[_0x3327bf(0x25b)](),_0xb8b38f=_0x4784ef[_0x3327bf(0x284)]['id'],_0x52bc95=await sales_finished[_0x3327bf(0x202)](_0xb8b38f),_0x2ff608=await warehouse['aggregate']([{'$match':{'name':_0x52bc95['warehouse_name']}},{'$unwind':_0x3327bf(0x26c)},{'$group':{'_id':_0x3327bf(0x2ef),'name':{'$first':_0x3327bf(0x2d3)},'product_stock':{'$first':_0x3327bf(0x213)},'bay':{'$first':_0x3327bf(0x1cc)},'bin':{'$first':_0x3327bf(0x260)},'type':{'$first':_0x3327bf(0x204)},'floorlevel':{'$first':_0x3327bf(0x1ee)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3327bf(0x1d1)},'product_code':{'$first':_0x3327bf(0x2ca)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3327bf(0x25d)},'expiry_date':{'$first':_0x3327bf(0x256)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x3327bf(0x285)},'maxProducts':{'$first':_0x3327bf(0x2a8)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x3327bf(0x2e2)}}}]),_0x205deb=await product[_0x3327bf(0x25b)]({}),_0x2b66db=await warehouse[_0x3327bf(0x240)]([{'$match':{'status':'Enabled','warehouse_category':_0x3327bf(0x251),'name':{'$ne':_0x3327bf(0x23c),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0x3327bf(0x250),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x17c6fb=[_0x3327bf(0x216)];const _0xce74f2=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x3327bf(0x24a)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);if(_0x409e99[0x0][_0x3327bf(0x2ed)]==_0x3327bf(0x21f)){var _0x56a7b3=users[_0x3327bf(0x2db)];console[_0x3327bf(0x279)](_0x56a7b3);}else{if(_0x409e99[0x0][_0x3327bf(0x2ed)]==_0x3327bf(0x2cd))var _0x56a7b3=users['Hindi'];else{if(_0x409e99[0x0][_0x3327bf(0x2ed)]==_0x3327bf(0x295))var _0x56a7b3=users['German'];else{if(_0x409e99[0x0][_0x3327bf(0x2ed)]==_0x3327bf(0x226))var _0x56a7b3=users[_0x3327bf(0x226)];else{if(_0x409e99[0x0][_0x3327bf(0x2ed)]==_0x3327bf(0x255))var _0x56a7b3=users[_0x3327bf(0x255)];else{if(_0x409e99[0x0][_0x3327bf(0x2ed)]==_0x3327bf(0x227))var _0x56a7b3=users['Portuguese'];else{if(_0x409e99[0x0][_0x3327bf(0x2ed)]=='Chinese')var _0x56a7b3=users[_0x3327bf(0x28f)];else{if(_0x409e99[0x0][_0x3327bf(0x2ed)]==_0x3327bf(0x2bf))var _0x56a7b3=users[_0x3327bf(0x23d)];}}}}}}}_0x4b6280[_0x3327bf(0x205)]('return_sale_finished',{'success':_0x4784ef['flash'](_0x3327bf(0x2a6)),'errors':_0x4784ef[_0x3327bf(0x2eb)]('errors'),'role':_0x43432c,'profile':_0x1448cf,'user':_0x52bc95,'stock':_0x2ff608,'master_shop':_0x409e99,'unit':_0x205deb,'language':_0x56a7b3,'warehouses':_0x2b66db,'rooms':_0x17c6fb,'warehouse_QA':_0xce74f2});}catch(_0x9cdfd4){console[_0x3327bf(0x279)](_0x9cdfd4),_0x4b6280[_0x3327bf(0x229)](0xc8)[_0x3327bf(0x298)]({'message':_0x9cdfd4[_0x3327bf(0x208)]});}}),router['post'](a0_0x13961e(0x2d1),auth,async(_0x4dcd3c,_0x437dcf)=>{var _0x9518dd=a0_0x13961e;if(_0x4dcd3c['body'][_0x9518dd(0x223)]=='QA')try{const {invoice:_0x562190,date:_0x3b0717,warehouse_name:_0x93679f,product_name:_0x140dee,primary_code:_0x4fa582,secondary_code:_0x3f4fa8,product_code:_0x5d901b,sales_quantity:_0x440778,stocks:_0x549cfc,return_qty:_0x28643f,Room_name:_0xf8f2be,to_warehouse_name_QA:_0x2484be,to_Room_name_QA:_0x392847,note:_0xe7e33c,for_categorize:_0xf7da90,product_name_QA1:_0x161657}=_0x4dcd3c['body'];if(typeof _0x161657=='string')var _0xe28333=[_0x4dcd3c['body'][_0x9518dd(0x22f)]],_0x160b4e=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x293)]],_0x5965f2=[_0x4dcd3c['body']['secondary_code_QA']],_0x7d5b72=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x233)]],_0x4bc9f0=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x221)]],_0x548a60=[_0x4dcd3c[_0x9518dd(0x2e6)]['stocks_QA']],_0x37c9e5=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x20e)]],_0x3f71e7=[_0x4dcd3c['body'][_0x9518dd(0x222)]],_0x1ff59d=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x24b)]],_0x162247=[_0x4dcd3c['body'][_0x9518dd(0x1ff)]],_0x263833=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x2b5)]],_0x148f93=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x20a)]],_0x443848=[_0x4dcd3c[_0x9518dd(0x2e6)]['production_date_QA']],_0x5d1567=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x288)]];else var _0xe28333=[..._0x4dcd3c[_0x9518dd(0x2e6)]['product_name_QA1']],_0x160b4e=[..._0x4dcd3c['body'][_0x9518dd(0x293)]],_0x5965f2=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x2dc)]],_0x7d5b72=[..._0x4dcd3c[_0x9518dd(0x2e6)]['product_code_QA']],_0x4bc9f0=[..._0x4dcd3c['body'][_0x9518dd(0x221)]],_0x548a60=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x232)]],_0x37c9e5=[..._0x4dcd3c[_0x9518dd(0x2e6)]['return_qty_QA']],_0x3f71e7=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x222)]],_0x1ff59d=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x24b)]],_0x162247=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x1ff)]],_0x263833=[..._0x4dcd3c[_0x9518dd(0x2e6)]['secondary_unit_QA']],_0x148f93=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x20a)]],_0x443848=[..._0x4dcd3c['body'][_0x9518dd(0x2bb)]],_0x5d1567=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x288)]];const _0x4867a7=_0xe28333[_0x9518dd(0x236)](_0x199166=>{return _0x199166={'product_name':_0x199166};});_0x160b4e[_0x9518dd(0x270)]((_0x521765,_0x408b0c)=>{_0x4867a7[_0x408b0c]['primary_code']=_0x521765;}),_0x5965f2[_0x9518dd(0x270)]((_0x514b49,_0x5a039b)=>{_0x4867a7[_0x5a039b]['secondary_code']=_0x514b49;}),_0x7d5b72['forEach']((_0x229ab0,_0x25ae11)=>{var _0x46575e=_0x9518dd;_0x4867a7[_0x25ae11][_0x46575e(0x2dd)]=_0x229ab0;}),_0x4bc9f0[_0x9518dd(0x270)]((_0xf550c1,_0x15e556)=>{var _0x48e049=_0x9518dd;_0x4867a7[_0x15e556][_0x48e049(0x249)]=_0xf550c1;}),_0x548a60['forEach']((_0x4d8919,_0x156e1f)=>{_0x4867a7[_0x156e1f]['stock']=_0x4d8919;}),_0x37c9e5[_0x9518dd(0x270)]((_0x187895,_0x753365)=>{var _0x47ba14=_0x9518dd;_0x4867a7[_0x753365][_0x47ba14(0x1fc)]=_0x187895;}),_0x3f71e7['forEach']((_0x226336,_0x42940f)=>{var _0x4c2022=_0x9518dd;_0x4867a7[_0x42940f][_0x4c2022(0x1ea)]=_0x226336;}),_0x1ff59d['forEach']((_0x4ae849,_0x2efbef)=>{_0x4867a7[_0x2efbef]['maxProducts']=_0x4ae849;}),_0x162247['forEach']((_0x1a145e,_0x8a9028)=>{var _0x1a8440=_0x9518dd;_0x4867a7[_0x8a9028][_0x1a8440(0x219)]=_0x1a145e;}),_0x263833[_0x9518dd(0x270)]((_0x1a2cec,_0x2f6a49)=>{var _0x25cf43=_0x9518dd;_0x4867a7[_0x2f6a49][_0x25cf43(0x1ec)]=_0x1a2cec;}),_0x148f93[_0x9518dd(0x270)]((_0x54ac6b,_0x24f6d5)=>{var _0x4d7af2=_0x9518dd;_0x4867a7[_0x24f6d5][_0x4d7af2(0x1e6)]=_0x54ac6b;}),_0x443848[_0x9518dd(0x270)]((_0x42cfba,_0x30cd12)=>{_0x4867a7[_0x30cd12]['production_date']=_0x42cfba;}),_0x5d1567[_0x9518dd(0x270)]((_0x1b3385,_0x2d8fee)=>{var _0x18e233=_0x9518dd;_0x4867a7[_0x2d8fee][_0x18e233(0x2e9)]=_0x1b3385;});const _0x33174b=await sales_finished[_0x9518dd(0x269)]({'invoice':_0x562190});_0x33174b['return_data']=_0x9518dd(0x245);const _0x580338=await _0x33174b[_0x9518dd(0x29c)](),_0x488323=new sales_return_finished({'invoice':_0x562190,'customer':_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x24c)],'date':_0x3b0717,'warehouse_name':_0x93679f,'room':_0xf8f2be,'ToWarehouse':_0x2484be,'ToRoom':_0x392847,'return_sale_QA':_0x4867a7,'note':_0xe7e33c,'warehouse_cat':_0xf7da90}),_0x2cfb83=await _0x488323[_0x9518dd(0x29c)](),_0x253180=await sales_return_finished[_0x9518dd(0x269)]({'invoice':_0x562190}),_0x2d30fd=await warehouse['findOne']({'name':_0x2484be,'room':_0x392847});_0x253180[_0x9518dd(0x2e8)][_0x9518dd(0x270)](_0x16b185=>{var _0x2da1b3=_0x9518dd,_0x25c407=0x0;const _0x181922=_0x2d30fd[_0x2da1b3(0x2ae)][_0x2da1b3(0x236)](_0x227ec9=>{var _0x295b71=_0x2da1b3;_0x227ec9[_0x295b71(0x20d)]==_0x16b185['product_name']&&_0x227ec9[_0x295b71(0x2e9)]==_0x16b185[_0x295b71(0x2e9)]&&_0x227ec9['production_date']==_0x16b185[_0x295b71(0x22d)]&&_0x227ec9['batch_code']==_0x16b185[_0x295b71(0x219)]&&(_0x227ec9[_0x295b71(0x1d7)]=parseInt(_0x227ec9['product_stock'])+parseInt(_0x16b185[_0x295b71(0x1fc)]),_0x25c407++);});_0x25c407=='0'&&(_0x2d30fd[_0x2da1b3(0x2ae)]=_0x2d30fd[_0x2da1b3(0x2ae)][_0x2da1b3(0x2ea)]({'product_name':_0x16b185[_0x2da1b3(0x20d)],'product_stock':_0x16b185[_0x2da1b3(0x1fc)],'primary_code':_0x16b185[_0x2da1b3(0x2a1)],'secondary_code':_0x16b185[_0x2da1b3(0x21e)],'product_code':_0x16b185[_0x2da1b3(0x2dd)],'batch_code':_0x16b185[_0x2da1b3(0x219)],'maxPerUnit':_0x16b185['maxPerUnit'],'production_date':_0x16b185[_0x2da1b3(0x22d)],'expiry_date':_0x16b185['expiry_date'],'secondary_unit':_0x16b185[_0x2da1b3(0x1ec)],'unit':_0x16b185['unit'],'maxProducts':_0x16b185[_0x2da1b3(0x2d9)],'bay':_0x16b185[_0x2da1b3(0x1dc)]}));}),await _0x2d30fd[_0x9518dd(0x29c)]();const _0x524f6a=new c_payment_data({'invoice':_0x562190,'customer':_0x4dcd3c[_0x9518dd(0x2e6)]['customer'],'reason':_0x9518dd(0x238)});await _0x524f6a[_0x9518dd(0x29c)]();const _0x56b445=await master_shop[_0x9518dd(0x25b)](),_0x39e9d0=await email_settings[_0x9518dd(0x269)](),_0x55fe45=await customer[_0x9518dd(0x269)]({'name':_0x4dcd3c[_0x9518dd(0x2e6)]['customer']});_0x56b445[0x0][_0x9518dd(0x2df)]==0x1?(right_currency=_0x56b445[0x0][_0x9518dd(0x225)],left_currency=''):(right_currency='',left_currency=_0x56b445[0x0][_0x9518dd(0x225)]);var _0x4cacbc=_0xe28333,_0x303243=_0x37c9e5,_0x1683d1='',_0x19d82b;for(_0x19d82b in _0x4cacbc){_0x1683d1+=_0x9518dd(0x239)+_0x9518dd(0x2e7)+_0x4cacbc[_0x19d82b]+_0x9518dd(0x1d8)+_0x9518dd(0x2e7)+_0x303243[_0x19d82b]+_0x9518dd(0x1d8)+'</tr>';}console[_0x9518dd(0x279)](_0x9518dd(0x28b),_0x1683d1);let _0x5cdc66=nodemailer[_0x9518dd(0x207)]({'service':_0x9518dd(0x25e),'auth':{'user':_0x39e9d0['email'],'pass':_0x39e9d0[_0x9518dd(0x234)]}}),_0x3e8c73={'from':_0x39e9d0[_0x9518dd(0x272)],'to':_0x55fe45['email'],'subject':_0x9518dd(0x294),'attachments':[{'filename':'Logo.png','path':__dirname+_0x9518dd(0x27f)+_0x9518dd(0x2d6)+_0x56b445[0x0][_0x9518dd(0x218)],'cid':_0x9518dd(0x253)}],'html':_0x9518dd(0x2de)+_0x9518dd(0x2e3)+_0x9518dd(0x29b)+'<div>'+_0x9518dd(0x2ad)+'<div>'+_0x9518dd(0x2b0)+'</div>'+_0x9518dd(0x244)+_0x9518dd(0x1e5)+_0x56b445[0x0][_0x9518dd(0x224)]+'\x20</h2>'+_0x9518dd(0x1ca)+_0x9518dd(0x1ca)+_0x9518dd(0x2b7)+'<div>'+_0x9518dd(0x215)+'\x20Order\x20Number\x20:\x20'+_0x562190+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x9518dd(0x1e9)+_0x3b0717+'\x20'+'</span>'+_0x9518dd(0x2e5)+_0x9518dd(0x1ca)+_0x9518dd(0x2e4)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x9518dd(0x239)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x9518dd(0x231)+_0x9518dd(0x211)+_0x9518dd(0x212)+_0x9518dd(0x1cf)+_0x9518dd(0x286)+_0x9518dd(0x1ce)+'\x20'+_0x1683d1+'\x20'+_0x9518dd(0x1d6)+_0x9518dd(0x275)+_0x9518dd(0x244)+_0x9518dd(0x2c9)+'<h5>'+_0x56b445[0x0][_0x9518dd(0x224)]+_0x9518dd(0x2e5)+_0x9518dd(0x1ca)+_0x9518dd(0x1ca)+_0x9518dd(0x258)};_0x5cdc66[_0x9518dd(0x230)](_0x3e8c73,function(_0x328b1b,_0x532dde){var _0x5d80c9=_0x9518dd;_0x328b1b?(console['log'](_0x328b1b),console[_0x5d80c9(0x279)](_0x5d80c9(0x22a))):console['log'](_0x5d80c9(0x21c));}),_0x4dcd3c[_0x9518dd(0x2eb)](_0x9518dd(0x2a6),_0x9518dd(0x282)),_0x437dcf[_0x9518dd(0x24d)](_0x9518dd(0x242));}catch(_0x478754){_0x437dcf[_0x9518dd(0x229)](0xc8)[_0x9518dd(0x298)]({'message1':_0x478754['message']});}else{if(_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x223)]=='GS')try{const {invoice:_0x682808,date:_0x760c80,warehouse_name:_0x1d95e,product_name:_0x2a84db,primary_code:_0x2d5ff6,secondary_code:_0x95a02,product_code:_0x573cd6,sales_quantity:_0x33ad0c,stocks:_0x189aca,return_qty:_0x449c88,Room_name:_0x25e525,to_warehouse_name:_0x2561d7,to_Room_name:_0x23303f,note:_0x54ab1f,level:_0x409e87,isle:_0x215af8,pallet:_0x27e0e8,for_categorize:_0x564cf6}=_0x4dcd3c[_0x9518dd(0x2e6)];if(typeof _0x2a84db==_0x9518dd(0x1d0))var _0xe28333=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x20d)]],_0x160b4e=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x2a1)]],_0x5965f2=[_0x4dcd3c['body'][_0x9518dd(0x21e)]],_0x7d5b72=[_0x4dcd3c[_0x9518dd(0x2e6)]['product_code']],_0x4bc9f0=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x261)]],_0x37c9e5=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x1fc)]],_0xc19704=[_0x4dcd3c['body'][_0x9518dd(0x1dc)]],_0x3f71e7=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x1ea)]],_0x1ff59d=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x2d9)]],_0x162247=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x219)]],_0x263833=[_0x4dcd3c['body'][_0x9518dd(0x1ec)]],_0x148f93=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x1e6)]],_0x443848=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x22d)]],_0x5d1567=[_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x2e9)]];else var _0xe28333=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x20d)]],_0x160b4e=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x2a1)]],_0x5965f2=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x21e)]],_0x7d5b72=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x2dd)]],_0x4bc9f0=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x261)]],_0x37c9e5=[..._0x4dcd3c[_0x9518dd(0x2e6)]['return_qty']],_0xc19704=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x1dc)]],_0x3f71e7=[..._0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x1ea)]],_0x1ff59d=[..._0x4dcd3c[_0x9518dd(0x2e6)]['maxProducts']],_0x162247=[..._0x4dcd3c['body'][_0x9518dd(0x219)]],_0x263833=[..._0x4dcd3c['body'][_0x9518dd(0x1ec)]],_0x148f93=[..._0x4dcd3c[_0x9518dd(0x2e6)]['unit']],_0x443848=[..._0x4dcd3c[_0x9518dd(0x2e6)]['production_date']],_0x5d1567=[..._0x4dcd3c[_0x9518dd(0x2e6)]['expiry_date']];const _0x3363a9=_0xe28333[_0x9518dd(0x236)](_0x2f4e57=>{return _0x2f4e57={'product_name':_0x2f4e57};});_0x160b4e['forEach']((_0x1224e1,_0x624c4a)=>{var _0x3aecde=_0x9518dd;_0x3363a9[_0x624c4a][_0x3aecde(0x2a1)]=_0x1224e1;}),_0x5965f2[_0x9518dd(0x270)]((_0x2614c4,_0x4a0045)=>{_0x3363a9[_0x4a0045]['secondary_code']=_0x2614c4;}),_0x7d5b72['forEach']((_0x596443,_0x2c9a0f)=>{_0x3363a9[_0x2c9a0f]['product_code']=_0x596443;}),_0x4bc9f0['forEach']((_0x29421d,_0x3f323a)=>{var _0x2d528e=_0x9518dd;_0x3363a9[_0x3f323a][_0x2d528e(0x249)]=_0x29421d;}),_0x37c9e5[_0x9518dd(0x270)]((_0x1cb1f2,_0x1ed2a4)=>{var _0x2195b2=_0x9518dd;_0x3363a9[_0x1ed2a4][_0x2195b2(0x1fc)]=_0x1cb1f2;}),_0xc19704[_0x9518dd(0x270)]((_0x38103d,_0x513525)=>{var _0xc83477=_0x9518dd;_0x3363a9[_0x513525][_0xc83477(0x1dc)]=_0x38103d;}),_0x3f71e7[_0x9518dd(0x270)]((_0x5e3c80,_0xd0dead)=>{var _0x54610c=_0x9518dd;_0x3363a9[_0xd0dead][_0x54610c(0x1ea)]=_0x5e3c80;}),_0x1ff59d[_0x9518dd(0x270)]((_0x195972,_0x55ae1c)=>{var _0x5e1e5f=_0x9518dd;_0x3363a9[_0x55ae1c][_0x5e1e5f(0x2d9)]=_0x195972;}),_0x162247[_0x9518dd(0x270)]((_0x520dbe,_0x2cad6e)=>{var _0x193217=_0x9518dd;_0x3363a9[_0x2cad6e][_0x193217(0x219)]=_0x520dbe;}),_0x263833[_0x9518dd(0x270)]((_0x213f73,_0x3f7fb1)=>{var _0x2c97f2=_0x9518dd;_0x3363a9[_0x3f7fb1][_0x2c97f2(0x1ec)]=_0x213f73;}),_0x148f93['forEach']((_0x3ea52c,_0xf8b748)=>{var _0x1d1e93=_0x9518dd;_0x3363a9[_0xf8b748][_0x1d1e93(0x1e6)]=_0x3ea52c;}),_0x443848[_0x9518dd(0x270)]((_0x5104f8,_0x4236f3)=>{var _0x56a58c=_0x9518dd;_0x3363a9[_0x4236f3][_0x56a58c(0x22d)]=_0x5104f8;}),_0x5d1567[_0x9518dd(0x270)]((_0x3e2478,_0x9dec4f)=>{var _0xe00b6f=_0x9518dd;_0x3363a9[_0x9dec4f][_0xe00b6f(0x2e9)]=_0x3e2478;});var _0xc8b1a7=0x0;_0x3363a9[_0x9518dd(0x270)](_0x49b0e6=>{var _0x101908=_0x9518dd;(parseInt(_0x49b0e6['sale_qty'])<parseInt(_0x49b0e6['return_qty'])||parseInt(_0x49b0e6[_0x101908(0x2aa)])<parseInt(_0x49b0e6[_0x101908(0x1fc)])&&parseInt(_0x49b0e6[_0x101908(0x249)])>parseInt(_0x49b0e6[_0x101908(0x1fc)])||parseInt(_0x49b0e6[_0x101908(0x1fc)])==0x0)&&_0xc8b1a7++;});if(_0xc8b1a7!=0x0)return _0x4dcd3c['flash']('errors',_0x9518dd(0x1e7)),_0x437dcf[_0x9518dd(0x24d)](_0x9518dd(0x28e));const _0x5bcee9=await sales_finished[_0x9518dd(0x269)]({'invoice':_0x682808});_0x5bcee9[_0x9518dd(0x2a7)]='True';const _0x523f9e=await _0x5bcee9[_0x9518dd(0x29c)](),_0x3b1f81=new sales_return_finished({'invoice':_0x682808,'customer':_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x24c)],'date':_0x760c80,'warehouse_name':_0x1d95e,'room':_0x25e525,'ToWarehouse':_0x2561d7,'ToRoom':_0x23303f,'return_sale':_0x3363a9,'note':_0x54ab1f,'warehouse_cat':_0x564cf6}),_0x103f31=await _0x3b1f81[_0x9518dd(0x29c)](),_0x3783b6=await sales_return_finished['findOne']({'invoice':_0x682808}),_0xf53f3b=await warehouse[_0x9518dd(0x269)]({'name':_0x2561d7,'room':_0x23303f,'warehouse_category':_0x9518dd(0x251)});_0x3783b6[_0x9518dd(0x27a)][_0x9518dd(0x270)](_0x1aa80e=>{var _0x431cc0=_0x9518dd,_0x111242=0x0;const _0x2fbe24=_0xf53f3b[_0x431cc0(0x2ae)][_0x431cc0(0x236)](_0x57c2f9=>{var _0x4536c1=_0x431cc0;_0x57c2f9[_0x4536c1(0x20d)]==_0x1aa80e[_0x4536c1(0x20d)]&&_0x57c2f9[_0x4536c1(0x1dc)]==_0x1aa80e[_0x4536c1(0x1dc)]&&_0x57c2f9['expiry_date']==_0x1aa80e[_0x4536c1(0x2e9)]&&_0x57c2f9['production_date']==_0x1aa80e[_0x4536c1(0x22d)]&&_0x57c2f9[_0x4536c1(0x219)]==_0x1aa80e['batch_code']&&(_0x57c2f9[_0x4536c1(0x1d7)]=parseInt(_0x57c2f9[_0x4536c1(0x1d7)])+parseInt(_0x1aa80e['return_qty']),_0x111242++);});_0x111242=='0'&&(_0xf53f3b[_0x431cc0(0x2ae)]=_0xf53f3b[_0x431cc0(0x2ae)]['concat']({'product_name':_0x1aa80e['product_name'],'product_stock':_0x1aa80e[_0x431cc0(0x1fc)],'primary_code':_0x1aa80e['primary_code'],'secondary_code':_0x1aa80e[_0x431cc0(0x21e)],'product_code':_0x1aa80e[_0x431cc0(0x2dd)],'bay':_0x1aa80e['bay'],'batch_code':_0x1aa80e[_0x431cc0(0x219)],'maxPerUnit':_0x1aa80e[_0x431cc0(0x1ea)],'production_date':_0x1aa80e['production_date'],'expiry_date':_0x1aa80e[_0x431cc0(0x2e9)],'secondary_unit':_0x1aa80e[_0x431cc0(0x1ec)],'unit':_0x1aa80e[_0x431cc0(0x1e6)],'maxProducts':_0x1aa80e['maxProducts']}));}),await _0xf53f3b[_0x9518dd(0x29c)](),console[_0x9518dd(0x279)](_0x4dcd3c[_0x9518dd(0x2e6)]);const _0xb4ee43=new c_payment_data({'invoice':_0x682808,'customer':_0x4dcd3c[_0x9518dd(0x2e6)][_0x9518dd(0x24c)],'reason':'Sale\x20Return'});await _0xb4ee43[_0x9518dd(0x29c)]();const _0xa11a3a=await master_shop[_0x9518dd(0x25b)]();console[_0x9518dd(0x279)](_0x9518dd(0x23b),_0xa11a3a[0x0]['image']);const _0x2cec58=await email_settings['findOne'](),_0x580c2a=await customer[_0x9518dd(0x269)]({'name':_0x4dcd3c[_0x9518dd(0x2e6)]['customer']});console[_0x9518dd(0x279)](_0x9518dd(0x26d),_0x580c2a);_0xa11a3a[0x0][_0x9518dd(0x2df)]==0x1?(right_currency=_0xa11a3a[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0xa11a3a[0x0][_0x9518dd(0x225)]);var _0x4cacbc=_0xe28333,_0x303243=_0x37c9e5,_0x1683d1='',_0x19d82b;for(_0x19d82b in _0x4cacbc){_0x1683d1+=_0x9518dd(0x239)+_0x9518dd(0x2e7)+_0x4cacbc[_0x19d82b]+_0x9518dd(0x1d8)+_0x9518dd(0x2e7)+_0x303243[_0x19d82b]+_0x9518dd(0x1d8)+_0x9518dd(0x1cf);}console['log']('product_list',_0x1683d1);let _0x37d6d1=nodemailer[_0x9518dd(0x207)]({'service':_0x9518dd(0x25e),'auth':{'user':_0x2cec58[_0x9518dd(0x272)],'pass':_0x2cec58[_0x9518dd(0x234)]}}),_0x1e23c0={'from':_0x2cec58[_0x9518dd(0x272)],'to':_0x580c2a['email'],'subject':_0x9518dd(0x294),'attachments':[{'filename':_0x9518dd(0x1e3),'path':__dirname+'/../public'+_0x9518dd(0x2d6)+_0xa11a3a[0x0]['image'],'cid':_0x9518dd(0x253)}],'html':_0x9518dd(0x2de)+'<html><head><title></title>'+_0x9518dd(0x29b)+_0x9518dd(0x244)+_0x9518dd(0x2ad)+'<div>'+_0x9518dd(0x2b0)+'</div>'+_0x9518dd(0x244)+'<h2>\x20'+_0xa11a3a[0x0][_0x9518dd(0x224)]+_0x9518dd(0x1fb)+'</div>'+_0x9518dd(0x1ca)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x682808+'\x20'+_0x9518dd(0x1e4)+_0x9518dd(0x1e9)+_0x760c80+'\x20'+_0x9518dd(0x263)+'</h5>'+_0x9518dd(0x1ca)+_0x9518dd(0x2e4)+_0x9518dd(0x206)+'<tr>'+_0x9518dd(0x2a9)+_0x9518dd(0x231)+_0x9518dd(0x211)+_0x9518dd(0x212)+_0x9518dd(0x1cf)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1683d1+'\x20'+_0x9518dd(0x1d6)+_0x9518dd(0x275)+_0x9518dd(0x244)+_0x9518dd(0x2c9)+_0x9518dd(0x266)+_0xa11a3a[0x0][_0x9518dd(0x224)]+_0x9518dd(0x2e5)+_0x9518dd(0x1ca)+_0x9518dd(0x1ca)+_0x9518dd(0x258)};_0x37d6d1[_0x9518dd(0x230)](_0x1e23c0,function(_0x42573a,_0x28dd3a){var _0x65a78e=_0x9518dd;_0x42573a?(console[_0x65a78e(0x279)](_0x42573a),console[_0x65a78e(0x279)]('Error\x20Occurs')):console[_0x65a78e(0x279)](_0x65a78e(0x21c));}),_0x4dcd3c[_0x9518dd(0x2eb)](_0x9518dd(0x2a6),_0x9518dd(0x282)),_0x437dcf[_0x9518dd(0x24d)]('/all_sales_finished/view');}catch(_0x37f65e){console[_0x9518dd(0x279)](_0x37f65e),_0x437dcf['status'](0xc8)[_0x9518dd(0x298)]({'message1':_0x37f65e[_0x9518dd(0x208)]});}}}),router[a0_0x13961e(0x2c7)](a0_0x13961e(0x277),auth,async(_0x397aba,_0x49837c)=>{var _0x5596f6=a0_0x13961e;try{const {username:_0x4e7c47,email:_0x31b08c,role:_0x510246}=_0x397aba[_0x5596f6(0x291)],_0xade399=_0x397aba['user'],_0x1562aa=await profile['findOne']({'email':_0xade399['email']}),_0x1e66d8=await master_shop[_0x5596f6(0x25b)]();console[_0x5596f6(0x279)](_0x5596f6(0x2bd),_0x1e66d8);const _0x2e5f36=_0x397aba[_0x5596f6(0x284)]['id'],_0x4d8d5e=await sales[_0x5596f6(0x202)](_0x2e5f36);console[_0x5596f6(0x279)](_0x5596f6(0x2b1),_0x4d8d5e);if(_0x1e66d8[0x0][_0x5596f6(0x2ed)]==_0x5596f6(0x21f))var _0x2ce914=users['English'];else{if(_0x1e66d8[0x0][_0x5596f6(0x2ed)]==_0x5596f6(0x2cd))var _0x2ce914=users[_0x5596f6(0x2cd)];else{if(_0x1e66d8[0x0]['language']==_0x5596f6(0x295))var _0x2ce914=users[_0x5596f6(0x295)];else{if(_0x1e66d8[0x0][_0x5596f6(0x2ed)]==_0x5596f6(0x226))var _0x2ce914=users[_0x5596f6(0x226)];else{if(_0x1e66d8[0x0][_0x5596f6(0x2ed)]=='French')var _0x2ce914=users[_0x5596f6(0x255)];else{if(_0x1e66d8[0x0][_0x5596f6(0x2ed)]==_0x5596f6(0x227))var _0x2ce914=users[_0x5596f6(0x23f)];else{if(_0x1e66d8[0x0][_0x5596f6(0x2ed)]==_0x5596f6(0x28f))var _0x2ce914=users[_0x5596f6(0x28f)];else{if(_0x1e66d8[0x0][_0x5596f6(0x2ed)]==_0x5596f6(0x2bf))var _0x2ce914=users['Arabic'];}}}}}}}_0x49837c['render'](_0x5596f6(0x1e8),{'success':_0x397aba[_0x5596f6(0x2eb)](_0x5596f6(0x2a6)),'errors':_0x397aba[_0x5596f6(0x2eb)](_0x5596f6(0x228)),'role':_0xade399,'profile':_0x1562aa,'alldata':_0x4d8d5e,'master_shop':_0x1e66d8,'language':_0x2ce914});}catch(_0x3672b1){console[_0x5596f6(0x279)](_0x3672b1);}}),router[a0_0x13961e(0x235)]('/barcode_scanner',async(_0x11dc61,_0x38f084)=>{var _0x34b1f4=a0_0x13961e;const {product_code:_0x2309c1,warehouse_name:_0x55c2b3,rooms_data:_0x593e71,Roomslist:_0x413b7f}=_0x11dc61[_0x34b1f4(0x2e6)],_0xd9f0d0=_0x413b7f[_0x34b1f4(0x27e)](','),_0x2a7783=[];async function _0x29e04d(_0x594c0c){var _0x53ebea=_0x34b1f4;const _0x104f6d=await warehouse[_0x53ebea(0x240)]([{'$match':{'name':_0x55c2b3,'room':_0x594c0c}},{'$unwind':_0x53ebea(0x26c)},{'$match':{'product_details.primary_code':_0x2309c1}},{'$group':{'_id':_0x53ebea(0x2ef),'name':{'$first':_0x53ebea(0x2d3)},'product_stock':{'$first':_0x53ebea(0x213)},'primary_code':{'$first':_0x53ebea(0x23e)},'secondary_code':{'$first':_0x53ebea(0x1d1)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x53ebea(0x1cc)},'isle':{'$first':_0x53ebea(0x260)},'type':{'$first':_0x53ebea(0x204)},'pallet':{'$first':_0x53ebea(0x1ee)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x53ebea(0x2c8)},'rack':{'$first':_0x53ebea(0x25d)},'expiry_date':{'$first':_0x53ebea(0x256)},'production_date':{'$first':_0x53ebea(0x292)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x53ebea(0x1f4)},'product_cat':{'$first':_0x53ebea(0x1d5)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x53ebea(0x21b)}}}]),_0x3b7443=await warehouse[_0x53ebea(0x240)]([{'$match':{'name':_0x55c2b3,'room':_0x594c0c}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x2309c1}},{'$group':{'_id':_0x53ebea(0x2ef),'name':{'$first':_0x53ebea(0x2d3)},'product_stock':{'$first':_0x53ebea(0x213)},'primary_code':{'$first':_0x53ebea(0x23e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x53ebea(0x2ca)},'level':{'$first':_0x53ebea(0x1cc)},'isle':{'$first':_0x53ebea(0x260)},'type':{'$first':_0x53ebea(0x204)},'pallet':{'$first':_0x53ebea(0x1ee)},'unit':{'$first':_0x53ebea(0x2da)},'secondary_unit':{'$first':_0x53ebea(0x285)},'storage':{'$first':_0x53ebea(0x2c8)},'rack':{'$first':_0x53ebea(0x25d)},'expiry_date':{'$first':_0x53ebea(0x256)},'production_date':{'$first':_0x53ebea(0x292)},'maxPerUnit':{'$first':_0x53ebea(0x2e2)},'batch_code':{'$first':_0x53ebea(0x1f4)},'product_cat':{'$first':_0x53ebea(0x1d5)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x53ebea(0x2a0)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x104f6d[_0x53ebea(0x2bc)]>0x0)_0x2a7783[_0x53ebea(0x1da)](_0x104f6d);else _0x3b7443[_0x53ebea(0x2bc)]>0x0&&_0x2a7783[_0x53ebea(0x1da)](_0x3b7443);}const _0x5b9c69=_0xd9f0d0[_0x34b1f4(0x236)](_0x5d430a=>_0x29e04d(_0x5d430a));await Promise[_0x34b1f4(0x1d9)](_0x5b9c69),_0x38f084[_0x34b1f4(0x298)](_0x2a7783);}),module[a0_0x13961e(0x28c)]=router;