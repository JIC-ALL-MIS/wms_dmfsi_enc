var a0_0x5169a5=a0_0x1000;(function(_0x25e756,_0x114bce){var _0x54d985=a0_0x1000,_0x173e91=_0x25e756();while(!![]){try{var _0x38018f=parseInt(_0x54d985(0x1cb))/0x1+parseInt(_0x54d985(0x13e))/0x2+-parseInt(_0x54d985(0x153))/0x3*(parseInt(_0x54d985(0x252))/0x4)+-parseInt(_0x54d985(0x233))/0x5+-parseInt(_0x54d985(0x168))/0x6+parseInt(_0x54d985(0x247))/0x7*(parseInt(_0x54d985(0x14e))/0x8)+parseInt(_0x54d985(0x212))/0x9;if(_0x38018f===_0x114bce)break;else _0x173e91['push'](_0x173e91['shift']());}catch(_0x26928a){_0x173e91['push'](_0x173e91['shift']());}}}(a0_0x46f5,0x43f07));const express=require(a0_0x5169a5(0x1b4)),app=express(),router=express[a0_0x5169a5(0x22c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x5169a5(0x232)),auth=require(a0_0x5169a5(0x1a2)),nodemailer=require(a0_0x5169a5(0x179)),users=require(a0_0x5169a5(0x21d));router[a0_0x5169a5(0x172)](a0_0x5169a5(0x1ac),auth,async(_0x57a1f4,_0x5f322b)=>{var _0x2fd1a1=a0_0x5169a5;try{const {username:_0x3a43e0,email:_0x1a5676,role:_0xf0bb38}=_0x57a1f4[_0x2fd1a1(0x1ab)],_0x4c0f27=_0x57a1f4[_0x2fd1a1(0x1ab)],_0x104073=await profile[_0x2fd1a1(0x1b2)]({'email':_0x4c0f27['email']}),_0x31aac7=await master_shop[_0x2fd1a1(0x14a)]();let _0x31746a;if(_0x4c0f27[_0x2fd1a1(0x15b)]==_0x2fd1a1(0x199)){const _0x17e0fd=await staff[_0x2fd1a1(0x1b2)]({'email':_0x4c0f27[_0x2fd1a1(0x14c)]});_0x31746a=await sales_finished[_0x2fd1a1(0x16c)]([{'$lookup':{'from':_0x2fd1a1(0x1d7),'localField':_0x2fd1a1(0x237),'foreignField':_0x2fd1a1(0x185),'as':_0x2fd1a1(0x17f)}},{'$unwind':_0x2fd1a1(0x140)},{'$unwind':_0x2fd1a1(0x253)},{'$group':{'_id':_0x2fd1a1(0x1eb),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x2fd1a1(0x217)},'date':{'$first':_0x2fd1a1(0x206)},'warehouse_name':{'$first':_0x2fd1a1(0x17b)},'sale_product':{'$push':_0x2fd1a1(0x253)},'note':{'$first':_0x2fd1a1(0x15e)},'return_data':{'$first':_0x2fd1a1(0x14b)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x2fd1a1(0x1b9)},'level':{'$addToSet':_0x2fd1a1(0x22a)},'isle':{'$addToSet':_0x2fd1a1(0x257)},'type':{'$addToSet':_0x2fd1a1(0x1c1)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x31746a=await sales_finished[_0x2fd1a1(0x16c)]([{'$lookup':{'from':_0x2fd1a1(0x1d7),'localField':_0x2fd1a1(0x237),'foreignField':_0x2fd1a1(0x185),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x2fd1a1(0x253)},{'$group':{'_id':_0x2fd1a1(0x1eb),'invoice':{'$first':_0x2fd1a1(0x18e)},'customers':{'$first':_0x2fd1a1(0x217)},'date':{'$first':_0x2fd1a1(0x206)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x2fd1a1(0x253)},'note':{'$first':'$note'},'return_data':{'$first':_0x2fd1a1(0x14b)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x2fd1a1(0x1b9)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x2fd1a1(0x257)},'type':{'$addToSet':_0x2fd1a1(0x1c1)},'pallet':{'$addToSet':_0x2fd1a1(0x211)},'finalize':{'$first':_0x2fd1a1(0x160)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x31aac7[0x0][_0x2fd1a1(0x1d6)]==_0x2fd1a1(0x228)){var _0x2a2ea4=users[_0x2fd1a1(0x176)];console['log'](_0x2a2ea4);}else{if(_0x31aac7[0x0][_0x2fd1a1(0x1d6)]=='Hindi')var _0x2a2ea4=users[_0x2fd1a1(0x162)];else{if(_0x31aac7[0x0][_0x2fd1a1(0x1d6)]==_0x2fd1a1(0x1a8))var _0x2a2ea4=users[_0x2fd1a1(0x1a8)];else{if(_0x31aac7[0x0]['language']=='Spanish')var _0x2a2ea4=users['Spanish'];else{if(_0x31aac7[0x0][_0x2fd1a1(0x1d6)]==_0x2fd1a1(0x197))var _0x2a2ea4=users[_0x2fd1a1(0x197)];else{if(_0x31aac7[0x0][_0x2fd1a1(0x1d6)]=='Portuguese\x20(BR)')var _0x2a2ea4=users[_0x2fd1a1(0x219)];else{if(_0x31aac7[0x0]['language']==_0x2fd1a1(0x1c0))var _0x2a2ea4=users[_0x2fd1a1(0x1c0)];else{if(_0x31aac7[0x0]['language']==_0x2fd1a1(0x1ba))var _0x2a2ea4=users[_0x2fd1a1(0x19b)];}}}}}}}_0x5f322b[_0x2fd1a1(0x1fe)](_0x2fd1a1(0x1af),{'success':_0x57a1f4[_0x2fd1a1(0x1d5)]('success'),'errors':_0x57a1f4[_0x2fd1a1(0x1d5)](_0x2fd1a1(0x142)),'sales':_0x31746a,'profile':_0x104073,'role':_0x4c0f27,'master_shop':_0x31aac7,'language':_0x2a2ea4});}catch(_0x1f24e3){console[_0x2fd1a1(0x250)](_0x1f24e3);}});async function getRandom8DigitNumber(){var _0x2e6458=a0_0x5169a5;const _0x3bd950=0x989680,_0x2acccf=0x5f5e0ff,_0x188ab5=Math['floor'](Math[_0x2e6458(0x1c2)]()*(_0x2acccf-_0x3bd950+0x1))+_0x3bd950;var _0x1a6447;const _0x369a0a=await sales_finished['findOne']({'invoice':_0x2e6458(0x1e7)+_0x188ab5});return _0x369a0a&&_0x369a0a[_0x2e6458(0x167)]>0x0?_0x1a6447=_0x2e6458(0x1e7)+_0x188ab5:_0x1a6447=_0x2e6458(0x1e7)+_0x188ab5,_0x1a6447;}function a0_0x46f5(){var _0x3c814b=['name','level','push','warehouse','/view/add_sales','<html><head><title></title>','Sales\x20Add\x20successfully','Return\x20Rooms','/all_sales/view','$invoice','all_sales_barcode','product_details','batch_code','add\x20post','catch','product_name','$product_details.maxPerUnit','$product_details._id','French','$product','staff','map','Arabic','Enabled','<h5\x20style=\x22text-align:\x20left;\x22>','maxPerUnit','product_date','production_date_QA','$product_details.secondary_unit','../middleware/auth','$name','DRY\x20GOODS','unit','/picking_list/pdf/','purchases_data','German','production_date','Enclosed','user','/view','/preview/:id','expiry_date','all_sales_finished','received_amount','back','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','express','Error\x20Occurs','room_name','$product_details.batch_code','product_code','$sale_product.quantity','Arabic\x20(ae)','</td>','Ambient','amount','<span\x20style=\x22float:\x20right;\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','Chinese','$sale_product.type','random','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.product_stock','gmail','\x20&&\x20','\x20<>\x20','edit_sales_finished_view','/give_payment/:id','<!DOCTYPE\x20html>','263498LfDvOY','\x20</h2>','id_transaction_from','</tr>','/../public','suppliers','getFullYear','maxPerUnit_QA','Spanish','Add\x20Sales','flash','language','customers','/all_sales_finished/view','sale_product','$product_details.product_name','message','<div>','return_qty','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/view/add_sale/product','prod_invoice','image','params','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','sales\x20item\x20return\x20successfull','\x20==\x20','OUTF-','/barcode_scanner','finalize','prod_cat','$_id','unit_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','date','Quality\x20Inspection','redirect','An\x20error\x20occurred.','adjust_qty','sendMail','json','password','<h2>\x20','exports','save','$product_details.invoice','secondary_code','</body></html>','carton','sales_quantity_QA','render','product_data','_id','product_name_QA1','maxProducts','$product_details.secondary_code','product_code_QA','string','$date','findById','Email\x20sent\x20successfully','host','product_list','<h5>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','forEach','return_sale_finished','False','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$sale_product.floorlevel','5435262oQdMCc','Logo.png','room','currency','\x20Order\x20Date\x20:\x20','$customer','invoice','Portuguese','$product_details.product_code','Received\x20Payment\x20For\x20Sale','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','../public/language/languages.json','body','$product_details.storage','createTransport','\x20<<<==>>>\x20','Finished\x20Goods','secondary_unit','Sale','<table\x20style=\x22width:\x20100%\x20!important;\x22>','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','English\x20(US)','bay','$sale_product.bay','True','Router','product_stock','</tbody>','</h5>','Sales\x20Update\x20successfully','$product_details.maxProducts','../models/all_models','2664445cduJdv','payment\x20successfull','$product.product_name','secondary_code_QA','customer','$product_details.unit','</thead>','/upload/','christian.villamer@jakagroup.com','expiry_date_QA','return_qty_QA','for_categorize','site_title','$product_details.rack','sales_quantity','/view/:id','Sale\x20Return','FGSEmail','primary_code_QA','edit_sales_finished','35cngxwt','$product_details.floorlevel','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','concat','stocks_QA','success','barcode\x20user_id','</div>','log','product','6912SUbumA','$sale_product','return_sale','max_per_unit','</span>','$sale_product.bin','\x20>>>\x20','491348gqjPoX','filter','$customers_docs','/invoice/:id','errors','getMonth','foreach\x20newproduct','maxProducts_QA','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','due_amount','slice','find','$return_data','email','<strong>\x20Regards\x20</strong>','643656KynEvs','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','currency_placement','</head><body>','$product_details.bin','855vogEcF','port','$product_details','RoomAssigned','logo','return_data','batch_code_QA','prod_code','role','status','</table>','$note','sale_qty','$finalize','secondary_unit_QA','Hindi','$product_details.primary_code','/view/return_sales/:id','<tr>','warehouse_name','length','1270362VqoKyj','stock','barcode\x20Product\x20master','abs','aggregate','$room','master','$product_details.room_name','$product_details.bay','$product_details.type','get','quantity','split','all','English','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.expiry_date','nodemailer','/barcode/:id','$warehouse_name','getDate','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.production_date','customers_docs','Sale\x20Return\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<hr\x20class=\x22my-3\x22>','post','error'];a0_0x46f5=function(){return _0x3c814b;};return a0_0x46f5();}function a0_0x1000(_0x1a265d,_0x420cf0){var _0x46f571=a0_0x46f5();return a0_0x1000=function(_0x1000e2,_0x5e871c){_0x1000e2=_0x1000e2-0x13e;var _0x29df0b=_0x46f571[_0x1000e2];return _0x29df0b;},a0_0x1000(_0x1a265d,_0x420cf0);}router[a0_0x5169a5(0x172)]('/view/add_sales',auth,async(_0x16be58,_0x541f79)=>{var _0x329e0b=a0_0x5169a5;try{const {username:_0x1a756d,email:_0x2e8638,role:_0x4da484}=_0x16be58[_0x329e0b(0x1ab)],_0x46123f=_0x16be58['user'],_0x2b10c4=await profile[_0x329e0b(0x1b2)]({'email':_0x46123f['email']}),_0x32cd28=await master_shop[_0x329e0b(0x14a)](),_0x59eaa1=await customer['find']({});let _0x38364a;if(_0x46123f['role']=='staff'){const _0x10de55=await staff[_0x329e0b(0x1b2)]({'email':_0x46123f['email']});_0x38364a=await warehouse[_0x329e0b(0x16c)]([{'$match':{'status':_0x329e0b(0x19c),'name':_0x10de55[_0x329e0b(0x188)],'warehouse_category':_0x329e0b(0x222),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x329e0b(0x1a3)}}},{'$sort':{'name':0x1}}]);}else _0x38364a=await warehouse[_0x329e0b(0x16c)]([{'$match':{'status':_0x329e0b(0x19c),'warehouse_category':_0x329e0b(0x222),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x329e0b(0x1a3)}}},{'$sort':{'name':0x1}}]);const _0x104941=await product[_0x329e0b(0x14a)]({});var _0x153cfd=[_0x329e0b(0x1bc),_0x329e0b(0x1aa)];const _0xec8b5d=await sales_finished[_0x329e0b(0x14a)]({}),_0x17ff31=_0xec8b5d[_0x329e0b(0x167)]+0x1,_0x36faed='OUTF-'+_0x17ff31['toString']()['padStart'](0x5,'0');if(_0x32cd28[0x0]['language']==_0x329e0b(0x228)){var _0x24bf24=users[_0x329e0b(0x176)];console[_0x329e0b(0x250)](_0x24bf24);}else{if(_0x32cd28[0x0][_0x329e0b(0x1d6)]==_0x329e0b(0x162))var _0x24bf24=users[_0x329e0b(0x162)];else{if(_0x32cd28[0x0][_0x329e0b(0x1d6)]==_0x329e0b(0x1a8))var _0x24bf24=users[_0x329e0b(0x1a8)];else{if(_0x32cd28[0x0][_0x329e0b(0x1d6)]==_0x329e0b(0x1d3))var _0x24bf24=users[_0x329e0b(0x1d3)];else{if(_0x32cd28[0x0][_0x329e0b(0x1d6)]==_0x329e0b(0x197))var _0x24bf24=users['French'];else{if(_0x32cd28[0x0][_0x329e0b(0x1d6)]==_0x329e0b(0x249))var _0x24bf24=users['Portuguese'];else{if(_0x32cd28[0x0][_0x329e0b(0x1d6)]=='Chinese')var _0x24bf24=users['Chinese'];else{if(_0x32cd28[0x0][_0x329e0b(0x1d6)]==_0x329e0b(0x1ba))var _0x24bf24=users['Arabic'];}}}}}}}const _0x1c106e=getRandom8DigitNumber();_0x1c106e['then'](_0x4fbdc9=>{var _0x27a5e5=_0x329e0b;_0x541f79['render']('add_sales_finished',{'success':_0x16be58[_0x27a5e5(0x1d5)]('success'),'errors':_0x16be58['flash']('errors'),'role':_0x46123f,'profile':_0x2b10c4,'customer':_0x59eaa1,'warehouse':_0x38364a,'product':_0x104941,'invoice':_0x4fbdc9,'master_shop':_0x32cd28,'language':_0x24bf24,'rooms_data':_0x153cfd});})[_0x329e0b(0x193)](_0x2913bc=>{var _0x43b947=_0x329e0b;_0x16be58[_0x43b947(0x1d5)]('errors',_0x43b947(0x17d)),_0x541f79['redirect'](_0x43b947(0x1d8));});}catch(_0x7b1ea3){console[_0x329e0b(0x250)](_0x7b1ea3);}}),router['get']('/view/add_sales/:id',auth,async(_0x58d4cc,_0x27f279)=>{var _0x442f04=a0_0x5169a5;try{const _0x4c8d0d=_0x58d4cc[_0x442f04(0x1e3)]['id'];console[_0x442f04(0x250)](_0x4c8d0d);const _0x230ebc=await product[_0x442f04(0x14a)](),_0x13b1be=await purchases[_0x442f04(0x16c)]([{'$match':{'warehouse_name':_0x4c8d0d}},{'$unwind':_0x442f04(0x198)},{'$group':{'_id':_0x442f04(0x235)}}]);console['log'](_0x442f04(0x1a7),_0x13b1be),_0x27f279['status'](0xc8)['json']({'purchases_data':_0x13b1be,'product_data':_0x230ebc});}catch(_0x1d6ed3){console[_0x442f04(0x250)](_0x1d6ed3);}}),router[a0_0x5169a5(0x183)](a0_0x5169a5(0x1e0),auth,async(_0x5767cc,_0x19c902)=>{var _0x7c3b9f=a0_0x5169a5;try{const {warehouse_data:_0x2f836f,product_data:_0x310656}=_0x5767cc[_0x7c3b9f(0x21e)];console[_0x7c3b9f(0x250)](_0x5767cc['body'][_0x7c3b9f(0x1ff)]);;const _0xacf1e4=await master_shop[_0x7c3b9f(0x14a)]();console[_0x7c3b9f(0x250)](_0x7c3b9f(0x16e),_0xacf1e4);const _0x37e6c6=await product['findOne']({'name':_0x310656});console['log'](_0x7c3b9f(0x251),_0x37e6c6);const _0x56da06=await warehouse[_0x7c3b9f(0x16c)]([{'$match':{'name':_0x2f836f}},{'$unwind':_0x7c3b9f(0x155)},{'$match':{'product_details.product_name':_0x310656}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x7c3b9f(0x1c4)}}}]);console[_0x7c3b9f(0x250)]('stock_data',_0x56da06),_0x19c902[_0x7c3b9f(0x15c)](0xc8)['json']({'master':_0xacf1e4,'new_product':_0x37e6c6,'stock_data':_0x56da06});}catch(_0x193074){console[_0x7c3b9f(0x250)](_0x193074);}}),router[a0_0x5169a5(0x183)](a0_0x5169a5(0x189),auth,async(_0x521f62,_0x233294)=>{var _0x4a3513=a0_0x5169a5;try{const {invoice:_0x57f6ea,date:_0x2cd05a,warehouse_name:_0x36052c,product_name:_0x2ebdd3,stock:_0x2bb557,quantity:_0x45620c,note:_0x32cae5,room:_0x38b60a,primary_code:_0x233c17,secondary_code:_0x48a004,prod_code:_0x27e2d8,level:_0x27c0cb,isle:_0x164ca6,pallet:_0x1e2dc5,batch_code:_0xaf0631,SCRN:_0x3c4f39,expiry_date:_0x20ebc3,mode_transpo:_0x123655,name_driver:_0x59c1b0}=_0x521f62['body'];if(typeof _0x2ebdd3==_0x4a3513(0x205))var _0x329121=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x194)]],_0x2ac7a5=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x169)]],_0x52eca5=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x1fc)]],_0x17ef53=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x146)]],_0x547ef1=[_0x521f62['body'][_0x4a3513(0x1fa)]],_0x1649f0=[_0x521f62['body']['prod_code']],_0x93b140=[_0x521f62['body'][_0x4a3513(0x186)]],_0x2e34da=[_0x521f62[_0x4a3513(0x21e)]['primary_unit']],_0x2ebf4a=[_0x521f62['body'][_0x4a3513(0x223)]],_0x129052=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x191)]],_0x1ccd6e=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x1ae)]],_0x42ed26=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x19f)]],_0x39d8dd=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x255)]],_0x4720b8=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x1ea)]],_0x5bac0f=[_0x521f62[_0x4a3513(0x21e)]['RoomAssigned']],_0x333ddd=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x1e1)]],_0x20e0b1=[_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x1cd)]];else var _0x329121=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x194)]],_0x2ac7a5=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x169)]],_0x52eca5=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x1fc)]],_0x17ef53=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x146)]],_0x547ef1=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x1fa)]],_0x1649f0=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x15a)]],_0x93b140=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x186)]],_0x2e34da=[..._0x521f62[_0x4a3513(0x21e)]['primary_unit']],_0x2ebf4a=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x223)]],_0x129052=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x191)]],_0x1ccd6e=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x1ae)]],_0x42ed26=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x19f)]],_0x39d8dd=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x255)]],_0x4720b8=[..._0x521f62['body']['prod_cat']],_0x5bac0f=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x156)]],_0x333ddd=[..._0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x1e1)]],_0x20e0b1=[..._0x521f62['body'][_0x4a3513(0x1cd)]];const _0x1a8910=_0x329121[_0x4a3513(0x19a)](_0x28688=>{return _0x28688={'product_name':_0x28688};});_0x2ac7a5[_0x4a3513(0x20d)]((_0x2320c3,_0x4f2008)=>{var _0x40d0c8=_0x4a3513;_0x1a8910[_0x4f2008][_0x40d0c8(0x169)]=_0x2320c3;}),_0x52eca5[_0x4a3513(0x20d)]((_0x5ad86b,_0x9a583a)=>{var _0x542436=_0x4a3513;_0x1a8910[_0x9a583a][_0x542436(0x173)]=Math[_0x542436(0x16b)](_0x5ad86b);}),_0x20e0b1[_0x4a3513(0x20d)]((_0x375b03,_0x4b9a53)=>{var _0x28ae45=_0x4a3513;_0x1a8910[_0x4b9a53][_0x28ae45(0x1cd)]=_0x375b03;}),_0x17ef53[_0x4a3513(0x20d)]((_0x157666,_0x1161b2)=>{_0x1a8910[_0x1161b2]['primary_code']=_0x157666;}),_0x547ef1[_0x4a3513(0x20d)]((_0x4f5d2b,_0x3923f6)=>{var _0x4cf2b5=_0x4a3513;_0x1a8910[_0x3923f6][_0x4cf2b5(0x1fa)]=_0x4f5d2b;}),_0x1649f0['forEach']((_0x12fe09,_0x452c14)=>{var _0x11482f=_0x4a3513;_0x1a8910[_0x452c14][_0x11482f(0x1b8)]=_0x12fe09;}),_0x93b140[_0x4a3513(0x20d)]((_0x11bad4,_0x4d4e25)=>{var _0x3df465=_0x4a3513;_0x1a8910[_0x4d4e25][_0x3df465(0x229)]=_0x11bad4;}),_0x2e34da['forEach']((_0x327ee8,_0x3a8026)=>{var _0x5f3f4a=_0x4a3513;_0x1a8910[_0x3a8026][_0x5f3f4a(0x1a5)]=_0x327ee8;}),_0x2ebf4a[_0x4a3513(0x20d)]((_0x28489d,_0x42e0f5)=>{var _0x1cf8b4=_0x4a3513;_0x1a8910[_0x42e0f5][_0x1cf8b4(0x223)]=_0x28489d;}),_0x129052['forEach']((_0x6a2fad,_0x483dc5)=>{var _0xd9f958=_0x4a3513;_0x1a8910[_0x483dc5][_0xd9f958(0x191)]=_0x6a2fad;}),_0x1ccd6e[_0x4a3513(0x20d)]((_0x3fb54f,_0x6bf279)=>{_0x1a8910[_0x6bf279]['expiry_date']=_0x3fb54f;}),_0x42ed26[_0x4a3513(0x20d)]((_0x1c4838,_0x21d2eb)=>{var _0x468fc9=_0x4a3513;_0x1a8910[_0x21d2eb][_0x468fc9(0x1a9)]=_0x1c4838;}),_0x39d8dd[_0x4a3513(0x20d)]((_0x28e68d,_0x3a37cd)=>{_0x1a8910[_0x3a37cd]['maxperunit']=_0x28e68d;}),_0x4720b8[_0x4a3513(0x20d)]((_0xe2b3b0,_0x22b32b)=>{var _0xec118a=_0x4a3513;_0x1a8910[_0x22b32b][_0xec118a(0x1ea)]=_0xe2b3b0;}),_0x5bac0f[_0x4a3513(0x20d)]((_0x2b22bf,_0x19a728)=>{var _0x43537d=_0x4a3513;_0x1a8910[_0x19a728][_0x43537d(0x1b6)]=_0x2b22bf;}),_0x333ddd[_0x4a3513(0x20d)]((_0x269b95,_0x64ced)=>{var _0x387960=_0x4a3513;_0x1a8910[_0x64ced][_0x387960(0x218)]=_0x269b95;});var _0x30de26=0x0;_0x1a8910[_0x4a3513(0x20d)](_0x9efeaf=>{var _0x3fe83e=_0x4a3513;parseFloat(_0x9efeaf[_0x3fe83e(0x169)])<parseFloat(_0x9efeaf[_0x3fe83e(0x173)])&&parseFloat(_0x9efeaf[_0x3fe83e(0x173)])>parseFloat(_0x9efeaf['stock'])&&(console[_0x3fe83e(0x250)](_0x9efeaf[_0x3fe83e(0x169)]+_0x3fe83e(0x1c7)+_0x9efeaf['quantity']),_0x30de26++);});if(_0x30de26!=0x0)return _0x521f62[_0x4a3513(0x1d5)](_0x4a3513(0x142),_0x4a3513(0x14f)),_0x233294[_0x4a3513(0x1f0)]('back');const _0x350543=_0x1a8910[_0x4a3513(0x13f)](_0x2942b2=>_0x2942b2[_0x4a3513(0x173)]!=='0'&&_0x2942b2['quantity']!==''),_0x4c285b=new sales_finished({'invoice':_0x57f6ea,'customer':_0x521f62[_0x4a3513(0x21e)][_0x4a3513(0x237)],'date':_0x2cd05a,'warehouse_name':_0x36052c,'sale_product':_0x350543,'note':_0x32cae5,'room':_0x38b60a,'primary_code':_0x233c17,'secondary_code':_0x48a004,'prod_code':_0x27e2d8,'SCRN':_0x3c4f39,'finalize':_0x4a3513(0x20f),'mode_transpo':_0x123655,'name_driver':_0x59c1b0}),_0x44334d=await _0x4c285b[_0x4a3513(0x1f8)](),_0x1d8eeb=await sales_finished['findOne']({'invoice':_0x57f6ea}),_0x526c55=new c_payment_data({'invoice':_0x57f6ea,'customer':_0x521f62['body']['customer'],'reason':_0x4a3513(0x224)});await _0x526c55[_0x4a3513(0x1f8)]();const _0x3dd151=await master_shop[_0x4a3513(0x14a)](),_0x58ffc8=await email_settings[_0x4a3513(0x1b2)](),_0x2bc2d6=await customer['findOne']({'name':_0x521f62['body'][_0x4a3513(0x237)]});_0x3dd151[0x0][_0x4a3513(0x150)]==0x1?(right_currency=_0x3dd151[0x0][_0x4a3513(0x215)],left_currency=''):(right_currency='',left_currency=_0x3dd151[0x0]['currency']);var _0x23e30f=_0x329121,_0x380f5b=_0x52eca5,_0x52085b='',_0x4e83d3;for(_0x4e83d3 in _0x23e30f){_0x52085b+=_0x4a3513(0x165)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x23e30f[_0x4e83d3]+'</td>'+_0x4a3513(0x1df)+_0x380f5b[_0x4e83d3]+_0x4a3513(0x1bb)+'</tr>';}console[_0x4a3513(0x250)](_0x4a3513(0x20a),_0x52085b);let _0x42ff64=nodemailer[_0x4a3513(0x220)]({'host':_0x58ffc8[_0x4a3513(0x209)],'port':Number(_0x58ffc8[_0x4a3513(0x154)]),'secure':![],'service':_0x4a3513(0x1c5),'auth':{'user':_0x58ffc8[_0x4a3513(0x14c)],'pass':_0x58ffc8[_0x4a3513(0x1f5)]}}),_0x229e23={'from':_0x58ffc8[_0x4a3513(0x14c)],'to':_0x4a3513(0x23b),'subject':_0x4a3513(0x1d4),'attachments':[{'filename':_0x4a3513(0x213),'path':__dirname+_0x4a3513(0x1cf)+'/upload/'+_0x3dd151[0x0][_0x4a3513(0x1e2)],'cid':_0x4a3513(0x157)}],'html':'ADD\x20SALE'};_0x42ff64[_0x4a3513(0x1f3)](_0x229e23,function(_0x3f1eb6,_0x588e7f){var _0x35037c=_0x4a3513;_0x3f1eb6?(console[_0x35037c(0x250)](_0x3f1eb6),console[_0x35037c(0x250)](_0x35037c(0x1b5))):console[_0x35037c(0x250)]('Email\x20sent\x20successfully');}),_0x521f62[_0x4a3513(0x1d5)]('success',_0x4a3513(0x18b)),_0x233294[_0x4a3513(0x1f0)]('/all_sales_finished/preview/'+_0x44334d[_0x4a3513(0x200)]);}catch(_0x19f6dc){console['log'](_0x19f6dc);}}),router['get']('/preview/:id',auth,async(_0x518bac,_0x174c26)=>{var _0x4f451c=a0_0x5169a5;try{const {username:_0x4f4ccc,email:_0x4ca954,role:_0x5e81fd}=_0x518bac['user'],_0x1eb537=_0x518bac[_0x4f451c(0x1ab)],_0x268b96=await profile['findOne']({'email':_0x1eb537[_0x4f451c(0x14c)]}),_0x229a66=await master_shop[_0x4f451c(0x14a)](),_0x3d01c9=_0x518bac['params']['id'],_0x4d0dd1=await sales_finished[_0x4f451c(0x207)](_0x3d01c9),_0x42c634=await warehouse[_0x4f451c(0x16c)]([{'$match':{'name':_0x4d0dd1[_0x4f451c(0x166)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4f451c(0x1da)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4f451c(0x170)},'bin':{'$first':_0x4f451c(0x152)},'type':{'$first':_0x4f451c(0x171)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4f451c(0x203)},'product_code':{'$first':_0x4f451c(0x21a)},'storage':{'$first':_0x4f451c(0x21f)},'rack':{'$first':_0x4f451c(0x240)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x4f451c(0x17e)},'batch_code':{'$first':_0x4f451c(0x1b7)},'room':{'$first':_0x4f451c(0x16d)},'room_data':{'$first':_0x4f451c(0x16f)}}}]),_0x39f343=await customer['find']({});let _0x14d509;if(_0x1eb537[_0x4f451c(0x15b)]==_0x4f451c(0x199)){const _0x26c0c5=await staff[_0x4f451c(0x1b2)]({'email':_0x1eb537['email']});_0x14d509=await warehouse[_0x4f451c(0x16c)]([{'$match':{'status':_0x4f451c(0x19c),'name':_0x26c0c5[_0x4f451c(0x188)]}},{'$group':{'_id':_0x4f451c(0x1a3),'name':{'$first':_0x4f451c(0x1a3)}}}]);}else _0x14d509=await warehouse[_0x4f451c(0x16c)]([{'$match':{'status':_0x4f451c(0x19c)}},{'$group':{'_id':'$name','name':{'$first':_0x4f451c(0x1a3)}}}]);const _0x25c3fc=await product['find']({});if(_0x229a66[0x0]['language']==_0x4f451c(0x228)){var _0xf3abdf=users[_0x4f451c(0x176)];console[_0x4f451c(0x250)](_0xf3abdf);}else{if(_0x229a66[0x0]['language']==_0x4f451c(0x162))var _0xf3abdf=users[_0x4f451c(0x162)];else{if(_0x229a66[0x0][_0x4f451c(0x1d6)]==_0x4f451c(0x1a8))var _0xf3abdf=users[_0x4f451c(0x1a8)];else{if(_0x229a66[0x0]['language']==_0x4f451c(0x1d3))var _0xf3abdf=users['Spanish'];else{if(_0x229a66[0x0]['language']=='French')var _0xf3abdf=users[_0x4f451c(0x197)];else{if(_0x229a66[0x0][_0x4f451c(0x1d6)]=='Portuguese\x20(BR)')var _0xf3abdf=users[_0x4f451c(0x219)];else{if(_0x229a66[0x0][_0x4f451c(0x1d6)]=='Chinese')var _0xf3abdf=users['Chinese'];else{if(_0x229a66[0x0][_0x4f451c(0x1d6)]==_0x4f451c(0x1ba))var _0xf3abdf=users[_0x4f451c(0x19b)];}}}}}}}_0x174c26[_0x4f451c(0x1fe)](_0x4f451c(0x1c8),{'success':_0x518bac[_0x4f451c(0x1d5)]('success'),'errors':_0x518bac[_0x4f451c(0x1d5)](_0x4f451c(0x142)),'role':_0x1eb537,'profile':_0x268b96,'customer':_0x39f343,'warehouse':_0x14d509,'product':_0x42c634,'user':_0x4d0dd1,'master_shop':_0x229a66,'unit':_0x25c3fc,'language':_0xf3abdf});}catch(_0x5f37e9){console[_0x4f451c(0x250)](_0x5f37e9);}}),router[a0_0x5169a5(0x183)](a0_0x5169a5(0x1ad),auth,async(_0xa03327,_0x446c1e)=>{var _0x53ac30=a0_0x5169a5;try{const _0x4e74f8=_0xa03327[_0x53ac30(0x1e3)]['id'],{invoice:_0x10fd57,warehouse_name:_0x28fcd1,room:_0xce9f6b}=_0xa03327[_0x53ac30(0x21e)],_0x3e0845=await sales_finished['findOne']({'invoice':_0x10fd57}),_0x39d1ee=_0x3e0845[_0x53ac30(0x1d9)][_0x53ac30(0x19a)](async _0x20211b=>{var _0x2391c3=_0x53ac30,_0x4a7196=await warehouse['findOne']({'name':_0x28fcd1,'room':_0x20211b[_0x2391c3(0x1b6)],'warehouse_category':_0x2391c3(0x222)});const _0x4ee04f=_0x4a7196[_0x2391c3(0x190)][_0x2391c3(0x19a)](_0x387e8b=>{var _0x28e703=_0x2391c3;_0x387e8b[_0x28e703(0x194)]==_0x20211b[_0x28e703(0x194)]&&_0x387e8b['bay']==_0x20211b[_0x28e703(0x229)]&&_0x387e8b[_0x28e703(0x1ae)]==_0x20211b[_0x28e703(0x1ae)]&&_0x387e8b[_0x28e703(0x1a9)]==_0x20211b[_0x28e703(0x1a9)]&&_0x387e8b[_0x28e703(0x191)]==_0x20211b['batch_code']&&_0x387e8b[_0x28e703(0x200)]==_0x20211b['id_transaction_from']&&(_0x387e8b['product_stock']>0x0&&(console[_0x28e703(0x250)](_0x387e8b[_0x28e703(0x194)]+_0x28e703(0x1e6)+_0x20211b[_0x28e703(0x194)]+_0x28e703(0x1c6)+_0x387e8b[_0x28e703(0x229)]+_0x28e703(0x1e6)+_0x20211b[_0x28e703(0x229)]+_0x28e703(0x1c6)+_0x387e8b[_0x28e703(0x1a9)]+_0x28e703(0x1e6)+_0x20211b['production_date']+_0x28e703(0x1c6)+_0x387e8b[_0x28e703(0x1ae)]+_0x28e703(0x1e6)+_0x20211b[_0x28e703(0x1ae)]+_0x28e703(0x1c6)+_0x387e8b[_0x28e703(0x191)]+_0x28e703(0x1e6)+_0x20211b[_0x28e703(0x191)]+_0x28e703(0x1c6)+_0x387e8b[_0x28e703(0x218)]+_0x28e703(0x1e6)+_0x20211b[_0x28e703(0x218)]+'\x20&&\x20'+_0x387e8b[_0x28e703(0x22d)]+_0x28e703(0x221)+_0x20211b[_0x28e703(0x173)]+_0x28e703(0x258)+_0x20211b[_0x28e703(0x1b6)]+'\x20&&\x20'+_0x387e8b[_0x28e703(0x200)]+_0x28e703(0x1e6)+_0x20211b[_0x28e703(0x1cd)]),_0x387e8b[_0x28e703(0x22d)]=Math['max'](0x0,Math['abs'](_0x387e8b[_0x28e703(0x22d)])-Math[_0x28e703(0x16b)](_0x20211b[_0x28e703(0x173)]))));});return _0x4a7196;});Promise['all'](_0x39d1ee)[_0x53ac30(0x226)](async _0x1d13c5=>{var _0x257649=_0x53ac30;try{for(const _0x43f72b of _0x1d13c5){await _0x43f72b[_0x257649(0x1f8)]();}_0x3e0845[_0x257649(0x1e9)]=_0x257649(0x22b);const _0x33670a=await _0x3e0845[_0x257649(0x1f8)](),_0x53f206=await master_shop[_0x257649(0x14a)](),_0x3025d6=await email_settings[_0x257649(0x1b2)](),_0x310c51=await supervisor_settings[_0x257649(0x14a)]();var _0x4a6df2=_0x3e0845[_0x257649(0x1d9)],_0x71d737='',_0x29d56d;for(_0x29d56d in _0x4a6df2){var _0x7d7c5='FG';_0x3e0845[_0x257649(0x166)]==_0x257649(0x1a4)&&(_0x7d7c5='DG'),_0x71d737+=_0x257649(0x165)+_0x257649(0x1df)+_0x4a6df2[_0x29d56d][_0x257649(0x194)]+_0x257649(0x1bb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4a6df2[_0x29d56d]['product_code']+_0x257649(0x1bb)+_0x257649(0x1df)+_0x4a6df2[_0x29d56d][_0x257649(0x173)]+_0x257649(0x1bb)+_0x257649(0x1df)+_0x4a6df2[_0x29d56d]['unit']+_0x257649(0x1bb)+_0x257649(0x1df)+_0x4a6df2[_0x29d56d][_0x257649(0x223)]+_0x257649(0x1bb)+_0x257649(0x1df)+_0x3e0845['warehouse_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4a6df2[_0x29d56d][_0x257649(0x1b6)]+_0x257649(0x1bb)+_0x257649(0x1df)+_0x7d7c5+_0x4a6df2[_0x29d56d][_0x257649(0x229)]+_0x257649(0x1bb);}let _0x1bf766=nodemailer[_0x257649(0x220)]({'host':_0x3025d6['host'],'port':Number(_0x3025d6[_0x257649(0x154)]),'secure':![],'auth':{'user':_0x3025d6[_0x257649(0x14c)],'pass':_0x3025d6['password']}}),_0x55f564={'from':_0x3025d6[_0x257649(0x14c)],'to':_0x310c51[0x0][_0x257649(0x244)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x257649(0x213),'path':__dirname+_0x257649(0x1cf)+_0x257649(0x23a)+_0x53f206[0x0][_0x257649(0x1e2)],'cid':_0x257649(0x157)}],'html':_0x257649(0x1ca)+_0x257649(0x18a)+_0x257649(0x151)+_0x257649(0x1dc)+_0x257649(0x21c)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x257649(0x24f)+_0x257649(0x1dc)+_0x257649(0x1f6)+_0x53f206[0x0][_0x257649(0x23f)]+_0x257649(0x1cc)+'</div>'+_0x257649(0x24f)+_0x257649(0x182)+_0x257649(0x1dc)+_0x257649(0x19d)+'\x20Order\x20Number\x20:\x20'+_0x3e0845[_0x257649(0x218)]+'\x20'+_0x257649(0x1be)+_0x257649(0x216)+_0x3e0845[_0x257649(0x1ee)]+'\x20'+'</span>'+_0x257649(0x22f)+_0x257649(0x24f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x257649(0x20c)+_0x257649(0x165)+_0x257649(0x147)+_0x257649(0x24a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x257649(0x1c3)+_0x257649(0x1b3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x257649(0x210)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x257649(0x1ce)+'</thead>'+_0x257649(0x1bf)+'\x20'+_0x71d737+'\x20'+_0x257649(0x22e)+_0x257649(0x15d)+_0x257649(0x1dc)+_0x257649(0x14d)+_0x257649(0x20b)+_0x53f206[0x0][_0x257649(0x23f)]+_0x257649(0x22f)+'</div>'+_0x257649(0x24f)+_0x257649(0x1fb)};_0x1bf766[_0x257649(0x1f3)](_0x55f564,function(_0xc5470e,_0x88a6e6){var _0x5bddf6=_0x257649;_0xc5470e?(console[_0x5bddf6(0x250)](_0xc5470e),console['log'](_0x5bddf6(0x1b5))):console[_0x5bddf6(0x250)](_0x5bddf6(0x208));}),_0xa03327[_0x257649(0x1d5)](_0x257649(0x24d),_0x257649(0x230)),_0x446c1e['redirect'](_0x257649(0x1a6)+_0x4e74f8);}catch(_0x8d2f6e){console[_0x257649(0x184)](_0x8d2f6e),_0x446c1e[_0x257649(0x15c)](0x1f4)[_0x257649(0x1f4)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x53ac30(0x193)](_0x1723c9=>{var _0x3d5eb0=_0x53ac30;console[_0x3d5eb0(0x184)](_0x1723c9),_0x446c1e[_0x3d5eb0(0x15c)](0x1f4)[_0x3d5eb0(0x1f4)]({'error':_0x3d5eb0(0x1f1)});});}catch(_0x2515a1){console['log'](_0x2515a1);}}),router[a0_0x5169a5(0x172)]('/view/:id',auth,async(_0x48b47b,_0x59447a)=>{var _0x5f4320=a0_0x5169a5;try{const {username:_0x5c787d,email:_0x55aaac,role:_0x118ac7}=_0x48b47b[_0x5f4320(0x1ab)],_0x81eab8=_0x48b47b['user'],_0xe48f35=await profile['findOne']({'email':_0x81eab8['email']}),_0x4bb9cf=await master_shop['find'](),_0x230a26=_0x48b47b[_0x5f4320(0x1e3)]['id'],_0x2aed70=await sales_finished[_0x5f4320(0x207)](_0x230a26);let _0x3f6ae3=new Date(_0x2aed70[_0x5f4320(0x1ae)]),_0xde5f10=('0'+_0x3f6ae3[_0x5f4320(0x17c)]())[_0x5f4320(0x149)](-0x2),_0x4cd10d=('0'+(_0x3f6ae3[_0x5f4320(0x143)]()+0x1))['slice'](-0x2),_0x157be6=_0x3f6ae3[_0x5f4320(0x1d1)](),_0x53cd57=_0x157be6+'-'+_0x4cd10d+'-'+_0xde5f10;var _0x31c699=[_0x5f4320(0x1bc),_0x5f4320(0x1aa)];const _0x3342f4=await warehouse[_0x5f4320(0x16c)]([{'$match':{'name':_0x2aed70[_0x5f4320(0x166)],'room':_0x2aed70[_0x5f4320(0x214)]}},{'$unwind':_0x5f4320(0x155)},{'$group':{'_id':_0x5f4320(0x196),'name':{'$first':_0x5f4320(0x1da)},'product_stock':{'$first':_0x5f4320(0x1c4)},'bay':{'$first':_0x5f4320(0x170)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5f4320(0x171)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5f4320(0x163)},'secondary_code':{'$first':_0x5f4320(0x203)},'product_code':{'$first':_0x5f4320(0x21a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5f4320(0x240)}}}]),_0x489942=await customer[_0x5f4320(0x14a)]({});let _0x425d81;if(_0x81eab8[_0x5f4320(0x15b)]==_0x5f4320(0x199)){const _0x34b4dc=await staff['findOne']({'email':_0x81eab8[_0x5f4320(0x14c)]});_0x425d81=await warehouse['aggregate']([{'$match':{'status':_0x5f4320(0x19c),'name':_0x34b4dc[_0x5f4320(0x188)]}},{'$group':{'_id':_0x5f4320(0x1a3),'name':{'$first':'$name'}}}]);}else _0x425d81=await warehouse['aggregate']([{'$match':{'status':_0x5f4320(0x19c)}},{'$group':{'_id':_0x5f4320(0x1a3),'name':{'$first':'$name'}}}]);const _0x1c4bf7=await product[_0x5f4320(0x14a)]({});if(_0x4bb9cf[0x0]['language']=='English\x20(US)'){var _0x23c204=users['English'];console['log'](_0x23c204);}else{if(_0x4bb9cf[0x0][_0x5f4320(0x1d6)]=='Hindi')var _0x23c204=users[_0x5f4320(0x162)];else{if(_0x4bb9cf[0x0][_0x5f4320(0x1d6)]=='German')var _0x23c204=users[_0x5f4320(0x1a8)];else{if(_0x4bb9cf[0x0][_0x5f4320(0x1d6)]==_0x5f4320(0x1d3))var _0x23c204=users[_0x5f4320(0x1d3)];else{if(_0x4bb9cf[0x0][_0x5f4320(0x1d6)]==_0x5f4320(0x197))var _0x23c204=users[_0x5f4320(0x197)];else{if(_0x4bb9cf[0x0][_0x5f4320(0x1d6)]=='Portuguese\x20(BR)')var _0x23c204=users[_0x5f4320(0x219)];else{if(_0x4bb9cf[0x0][_0x5f4320(0x1d6)]==_0x5f4320(0x1c0))var _0x23c204=users[_0x5f4320(0x1c0)];else{if(_0x4bb9cf[0x0][_0x5f4320(0x1d6)]=='Arabic\x20(ae)')var _0x23c204=users['Arabic'];}}}}}}}_0x59447a['render'](_0x5f4320(0x246),{'success':_0x48b47b[_0x5f4320(0x1d5)](_0x5f4320(0x24d)),'errors':_0x48b47b[_0x5f4320(0x1d5)](_0x5f4320(0x142)),'role':_0x81eab8,'profile':_0xe48f35,'customer':_0x489942,'warehouse':_0x425d81,'product':_0x3342f4,'user':_0x2aed70,'master_shop':_0x4bb9cf,'unit':_0x1c4bf7,'language':_0x23c204,'rooms_data':_0x31c699,'ed_fullDate':_0x53cd57});}catch(_0x294d06){console[_0x5f4320(0x250)](_0x294d06);}}),router[a0_0x5169a5(0x183)](a0_0x5169a5(0x242),auth,async(_0x29019e,_0x597518)=>{var _0x184885=a0_0x5169a5;try{const _0x10d90a=_0x29019e[_0x184885(0x1e3)]['id'],_0x211d40=await sales_finished[_0x184885(0x1b2)]({'_id':_0x29019e[_0x184885(0x1e3)]['id']}),_0x40036d=await warehouse[_0x184885(0x1b2)]({'name':_0x211d40[_0x184885(0x166)],'room':_0x29019e['body'][_0x184885(0x214)],'warehouse_category':_0x184885(0x222)}),{invoice:_0x59ad38,customer:_0x2fb9c4,date:_0x5afccf,warehouse_name:_0x561169,product_name:_0x22a609,stock:_0x16aab6,adjust_qty:_0x2083db,note:_0x1e5a76,room:_0x53b02e,primary_code:_0x104d9a,secondary_code:_0x58f048,prod_code:_0x2a1c27,level:_0x14557f,isle:_0x140579,pallet:_0x53d18b,expiry_date:_0x480cf3}=_0x29019e[_0x184885(0x21e)];if(typeof _0x22a609==_0x184885(0x205))var _0x1489de=[_0x29019e[_0x184885(0x21e)]['product_name']],_0xd58084=[_0x29019e[_0x184885(0x21e)][_0x184885(0x169)]],_0x5d87d9=[_0x29019e[_0x184885(0x21e)][_0x184885(0x1f2)]],_0x13e943=[_0x29019e[_0x184885(0x21e)]['primary_code']],_0x648358=[_0x29019e['body'][_0x184885(0x1fa)]],_0x57af6f=[_0x29019e[_0x184885(0x21e)]['prod_code']],_0x162e7d=[_0x29019e[_0x184885(0x21e)][_0x184885(0x186)]],_0x5e4ea9=[_0x29019e[_0x184885(0x21e)][_0x184885(0x1ae)]];else var _0x1489de=[..._0x29019e[_0x184885(0x21e)][_0x184885(0x194)]],_0xd58084=[..._0x29019e[_0x184885(0x21e)][_0x184885(0x169)]],_0x5d87d9=[..._0x29019e[_0x184885(0x21e)][_0x184885(0x1f2)]],_0x13e943=[..._0x29019e[_0x184885(0x21e)][_0x184885(0x146)]],_0x648358=[..._0x29019e[_0x184885(0x21e)][_0x184885(0x1fa)]],_0x57af6f=[..._0x29019e[_0x184885(0x21e)][_0x184885(0x15a)]],_0x162e7d=[..._0x29019e[_0x184885(0x21e)][_0x184885(0x186)]],_0x5e4ea9=[..._0x29019e[_0x184885(0x21e)]['expiry_date']];const _0x5b3513=_0x1489de['map'](_0x5b92be=>{return _0x5b92be={'product_name':_0x5b92be};});_0xd58084[_0x184885(0x20d)]((_0x4d6413,_0x149ac4)=>{var _0x21cb1c=_0x184885;_0x5b3513[_0x149ac4][_0x21cb1c(0x169)]=_0x4d6413;}),_0x5d87d9[_0x184885(0x20d)]((_0x4dcdaa,_0x40feaa)=>{var _0x8ee19d=_0x184885;_0x5b3513[_0x40feaa][_0x8ee19d(0x173)]=_0x4dcdaa;}),_0x13e943[_0x184885(0x20d)]((_0x106efb,_0x597060)=>{var _0x54a1d8=_0x184885;_0x5b3513[_0x597060][_0x54a1d8(0x146)]=_0x106efb;}),_0x648358[_0x184885(0x20d)]((_0x339f47,_0x21cc76)=>{_0x5b3513[_0x21cc76]['secondary_code']=_0x339f47;}),_0x57af6f[_0x184885(0x20d)]((_0x1d93bd,_0x48c947)=>{var _0x4b80a6=_0x184885;_0x5b3513[_0x48c947][_0x4b80a6(0x1b8)]=_0x1d93bd;}),_0x162e7d[_0x184885(0x20d)]((_0x603b7e,_0x3c41f3)=>{var _0x461073=_0x184885;_0x5b3513[_0x3c41f3][_0x461073(0x186)]=_0x603b7e;}),_0x5e4ea9['forEach']((_0x376691,_0x3c5b58)=>{var _0x532fb8=_0x184885;_0x5b3513[_0x3c5b58][_0x532fb8(0x1ae)]=_0x376691;});var _0x49757d=0x0;_0x5b3513[_0x184885(0x20d)](_0x16ad98=>{var _0x1f42ad=_0x184885;console[_0x1f42ad(0x250)](_0x1f42ad(0x144),_0x16ad98),(parseInt(_0x16ad98[_0x1f42ad(0x169)])<parseInt(_0x16ad98[_0x1f42ad(0x173)])||parseInt(_0x16ad98[_0x1f42ad(0x173)])==0x0)&&_0x49757d++;});if(_0x49757d!=0x0)return _0x29019e[_0x184885(0x1d5)]('errors',_0x184885(0x1e4)),_0x597518[_0x184885(0x1f0)](_0x184885(0x1b1));_0x211d40['sale_product'][_0x184885(0x20d)](_0xd361aa=>{var _0x33ced6=_0x184885;const _0x3b804b=_0x40036d[_0x33ced6(0x190)][_0x33ced6(0x19a)](_0x40660f=>{var _0x5cc60f=_0x33ced6;_0x40660f[_0x5cc60f(0x194)]==_0xd361aa[_0x5cc60f(0x194)]&&_0x40660f['bay']==_0xd361aa['bay']&&(_0x40660f[_0x5cc60f(0x22d)]=parseInt(_0x40660f[_0x5cc60f(0x22d)])+parseInt(_0xd361aa[_0x5cc60f(0x173)]));});}),await _0x40036d[_0x184885(0x1f8)]();const _0x2d4b52=_0x5b3513[_0x184885(0x13f)](_0x4a19cd=>_0x4a19cd[_0x184885(0x173)]!=='0'&&_0x4a19cd['quantity']!=='');_0x211d40[_0x184885(0x218)]=_0x59ad38,_0x211d40[_0x184885(0x237)]=_0x2fb9c4,_0x211d40['date']=_0x5afccf,_0x211d40[_0x184885(0x166)]=_0x561169,_0x211d40[_0x184885(0x1d9)]=_0x2d4b52,_0x211d40['note']=_0x1e5a76,_0x211d40[_0x184885(0x214)]=_0x53b02e;const _0x1736c2=await _0x211d40[_0x184885(0x1f8)](),_0x4510f1=await sales_finished[_0x184885(0x1b2)]({'_id':_0x29019e[_0x184885(0x1e3)]['id']}),_0x38acaa=await warehouse['findOne']({'name':_0x561169,'room':_0x53b02e,'warehouse_category':_0x184885(0x222)});_0x4510f1[_0x184885(0x1d9)][_0x184885(0x20d)](_0xc33e4e=>{var _0x43338e=_0x184885;const _0x4a61fe=_0x38acaa[_0x43338e(0x190)][_0x43338e(0x19a)](_0x4ea45a=>{var _0xb68441=_0x43338e;_0x4ea45a['product_name']==_0xc33e4e['product_name']&&_0x4ea45a[_0xb68441(0x229)]==_0xc33e4e[_0xb68441(0x229)]&&(_0x4ea45a[_0xb68441(0x22d)]=parseInt(_0x4ea45a[_0xb68441(0x22d)])-parseInt(_0xc33e4e[_0xb68441(0x173)]));});}),console[_0x184885(0x250)]('final',_0x38acaa),await _0x38acaa[_0x184885(0x1f8)]();const _0x25865c=await c_payment_data['findOne']({'invoice':_0x29019e['body'][_0x184885(0x218)]});_0x25865c[_0x184885(0x1d0)]=_0x29019e[_0x184885(0x21e)][_0x184885(0x1d0)],await _0x25865c[_0x184885(0x1f8)](),_0x29019e[_0x184885(0x1d5)](_0x184885(0x24d),_0x184885(0x230)),_0x597518[_0x184885(0x1f0)](_0x184885(0x1d8));}catch(_0x977f22){console[_0x184885(0x250)](_0x977f22);}}),router[a0_0x5169a5(0x183)](a0_0x5169a5(0x1c9),auth,async(_0x1230fc,_0x462282)=>{var _0x510a91=a0_0x5169a5;try{const _0x4b18ab=_0x1230fc[_0x510a91(0x1e3)]['id'],{invoice:_0x559513,customer:_0x1c9c2b,receivable_amount:_0x554bce,received_amount:_0x3942bd}=_0x1230fc[_0x510a91(0x21e)],_0x5d2e8d=await sales[_0x510a91(0x207)](_0x4b18ab);console[_0x510a91(0x250)](_0x5d2e8d);var _0x1acbfe=_0x554bce-_0x3942bd;console['log'](_0x3942bd),_0x5d2e8d[_0x510a91(0x1b0)]=parseFloat(_0x3942bd)+parseFloat(_0x5d2e8d[_0x510a91(0x1b0)]),_0x5d2e8d[_0x510a91(0x148)]=_0x1acbfe,console['log'](_0x5d2e8d);const _0x5e0134=await _0x5d2e8d[_0x510a91(0x1f8)](),_0x98916d=await c_payment_data['findOne']({'invoice':_0x559513});_0x98916d[_0x510a91(0x1bd)]=_0x1acbfe,await _0x98916d['save']();let _0x2b36cd=new Date(),_0x4ff054=('0'+_0x2b36cd['getDate']())['slice'](-0x2),_0x12f290=('0'+(_0x2b36cd[_0x510a91(0x143)]()+0x1))[_0x510a91(0x149)](-0x2),_0x33b3d3=_0x2b36cd['getFullYear'](),_0x4784db=_0x33b3d3+'-'+_0x12f290+'-'+_0x4ff054;const _0xcbfc22=new customer_payment({'invoice':_0x559513,'date':_0x33b3d3+'-'+_0x12f290+'-'+_0x4ff054,'customer':_0x1c9c2b,'reason':_0x510a91(0x21b),'amount':_0x3942bd}),_0x5de3bb=await _0xcbfc22[_0x510a91(0x1f8)]();_0x1230fc[_0x510a91(0x1d5)]('success',_0x510a91(0x234)),_0x462282['redirect'](_0x510a91(0x18d));}catch(_0x4deb60){console[_0x510a91(0x250)](_0x4deb60);}}),router[a0_0x5169a5(0x172)](a0_0x5169a5(0x141),auth,async(_0x5c78f7,_0x17fccc)=>{var _0x2e9d6e=a0_0x5169a5;try{const {username:_0x16a1d9,email:_0x8f538a,role:_0x1609fb}=_0x5c78f7['user'],_0x5355ba=_0x5c78f7[_0x2e9d6e(0x1ab)],_0x4ab716=await profile[_0x2e9d6e(0x1b2)]({'email':_0x5355ba[_0x2e9d6e(0x14c)]}),_0x416b43=await master_shop[_0x2e9d6e(0x14a)]();console[_0x2e9d6e(0x250)]('master',_0x416b43);const _0x1a24be=_0x5c78f7[_0x2e9d6e(0x1e3)]['id'],_0x4727b3=await sales['findById'](_0x1a24be);console[_0x2e9d6e(0x250)](_0x4727b3);const _0x1ffdda=await customer[_0x2e9d6e(0x1b2)]({'name':_0x4727b3[_0x2e9d6e(0x237)]});console[_0x2e9d6e(0x250)](_0x1ffdda);if(_0x416b43[0x0][_0x2e9d6e(0x1d6)]==_0x2e9d6e(0x228)){var _0x4adcdd=users['English'];console['log'](_0x4adcdd);}else{if(_0x416b43[0x0][_0x2e9d6e(0x1d6)]==_0x2e9d6e(0x162))var _0x4adcdd=users[_0x2e9d6e(0x162)];else{if(_0x416b43[0x0][_0x2e9d6e(0x1d6)]==_0x2e9d6e(0x1a8))var _0x4adcdd=users['German'];else{if(_0x416b43[0x0][_0x2e9d6e(0x1d6)]==_0x2e9d6e(0x1d3))var _0x4adcdd=users[_0x2e9d6e(0x1d3)];else{if(_0x416b43[0x0][_0x2e9d6e(0x1d6)]==_0x2e9d6e(0x197))var _0x4adcdd=users[_0x2e9d6e(0x197)];else{if(_0x416b43[0x0][_0x2e9d6e(0x1d6)]==_0x2e9d6e(0x249))var _0x4adcdd=users[_0x2e9d6e(0x219)];else{if(_0x416b43[0x0]['language']==_0x2e9d6e(0x1c0))var _0x4adcdd=users[_0x2e9d6e(0x1c0)];else{if(_0x416b43[0x0][_0x2e9d6e(0x1d6)]=='Arabic\x20(ae)')var _0x4adcdd=users['Arabic'];}}}}}}}_0x17fccc['render']('sales_invoice',{'success':_0x5c78f7[_0x2e9d6e(0x1d5)]('success'),'errors':_0x5c78f7['flash']('errors'),'role':_0x5355ba,'profile':_0x4ab716,'master_shop':_0x416b43,'customers':_0x1ffdda,'sales':_0x4727b3,'language':_0x4adcdd});}catch(_0x3d7fee){console[_0x2e9d6e(0x250)](_0x3d7fee);}}),router[a0_0x5169a5(0x172)](a0_0x5169a5(0x164),auth,async(_0x173def,_0xa41a4e)=>{var _0xd23f9=a0_0x5169a5;try{const {username:_0x3b8194,email:_0x2cec3c,role:_0x4cf1e6}=_0x173def[_0xd23f9(0x1ab)],_0x5acd02=_0x173def[_0xd23f9(0x1ab)],_0x17378c=await profile[_0xd23f9(0x1b2)]({'email':_0x5acd02['email']}),_0x368639=await master_shop[_0xd23f9(0x14a)](),_0x4af023=_0x173def[_0xd23f9(0x1e3)]['id'],_0x3a909c=await sales_finished['findById'](_0x4af023),_0x253651=await warehouse[_0xd23f9(0x16c)]([{'$match':{'name':_0x3a909c[_0xd23f9(0x166)]}},{'$unwind':_0xd23f9(0x155)},{'$group':{'_id':_0xd23f9(0x196),'name':{'$first':_0xd23f9(0x1da)},'product_stock':{'$first':_0xd23f9(0x1c4)},'bay':{'$first':_0xd23f9(0x170)},'bin':{'$first':_0xd23f9(0x152)},'type':{'$first':_0xd23f9(0x171)},'floorlevel':{'$first':_0xd23f9(0x248)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xd23f9(0x203)},'product_code':{'$first':_0xd23f9(0x21a)},'storage':{'$first':_0xd23f9(0x21f)},'rack':{'$first':_0xd23f9(0x240)},'expiry_date':{'$first':_0xd23f9(0x178)},'production_date':{'$first':_0xd23f9(0x17e)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'maxProducts':{'$first':_0xd23f9(0x231)},'batch_code':{'$first':_0xd23f9(0x1b7)},'maxPerUnit':{'$first':_0xd23f9(0x195)}}}]),_0x396ce8=await product[_0xd23f9(0x14a)]({}),_0x23a46d=await warehouse[_0xd23f9(0x16c)]([{'$match':{'status':'Enabled','warehouse_category':_0xd23f9(0x222),'name':{'$ne':'Return\x20Goods','$ne':_0xd23f9(0x1ef)}}},{'$group':{'_id':_0xd23f9(0x1a3),'name':{'$first':_0xd23f9(0x1a3)}}},{'$sort':{'name':0x1}}]);var _0x3b8834=[_0xd23f9(0x18c)];const _0x10b7a1=await warehouse[_0xd23f9(0x16c)]([{'$match':{'status':_0xd23f9(0x19c),'name':'Quality\x20Inspection'}},{'$group':{'_id':_0xd23f9(0x1a3),'name':{'$first':_0xd23f9(0x1a3)}}},{'$sort':{'name':0x1}}]);if(_0x368639[0x0][_0xd23f9(0x1d6)]==_0xd23f9(0x228)){var _0x3f12b2=users['English'];console[_0xd23f9(0x250)](_0x3f12b2);}else{if(_0x368639[0x0][_0xd23f9(0x1d6)]=='Hindi')var _0x3f12b2=users[_0xd23f9(0x162)];else{if(_0x368639[0x0][_0xd23f9(0x1d6)]==_0xd23f9(0x1a8))var _0x3f12b2=users[_0xd23f9(0x1a8)];else{if(_0x368639[0x0][_0xd23f9(0x1d6)]==_0xd23f9(0x1d3))var _0x3f12b2=users[_0xd23f9(0x1d3)];else{if(_0x368639[0x0][_0xd23f9(0x1d6)]==_0xd23f9(0x197))var _0x3f12b2=users[_0xd23f9(0x197)];else{if(_0x368639[0x0][_0xd23f9(0x1d6)]==_0xd23f9(0x249))var _0x3f12b2=users[_0xd23f9(0x219)];else{if(_0x368639[0x0][_0xd23f9(0x1d6)]==_0xd23f9(0x1c0))var _0x3f12b2=users[_0xd23f9(0x1c0)];else{if(_0x368639[0x0][_0xd23f9(0x1d6)]==_0xd23f9(0x1ba))var _0x3f12b2=users[_0xd23f9(0x19b)];}}}}}}}_0xa41a4e[_0xd23f9(0x1fe)](_0xd23f9(0x20e),{'success':_0x173def[_0xd23f9(0x1d5)]('success'),'errors':_0x173def[_0xd23f9(0x1d5)](_0xd23f9(0x142)),'role':_0x5acd02,'profile':_0x17378c,'user':_0x3a909c,'stock':_0x253651,'master_shop':_0x368639,'unit':_0x396ce8,'language':_0x3f12b2,'warehouses':_0x23a46d,'rooms':_0x3b8834,'warehouse_QA':_0x10b7a1});}catch(_0x1fe685){console['log'](_0x1fe685),_0xa41a4e['status'](0xc8)[_0xd23f9(0x1f4)]({'message':_0x1fe685[_0xd23f9(0x1db)]});}}),router[a0_0x5169a5(0x183)]('/view/return_sales/:id',auth,async(_0x2f2eaf,_0x4f6c56)=>{var _0x1e8b30=a0_0x5169a5;if(_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x23e)]=='QA')try{const {invoice:_0x5c0669,date:_0x1b5971,warehouse_name:_0x1b86f4,product_name:_0x59a9b5,primary_code:_0x11a625,secondary_code:_0x2bb8f0,product_code:_0x45d162,sales_quantity:_0x43ad6a,stocks:_0x39d3af,return_qty:_0x8e0ab5,Room_name:_0x4c4f1a,to_warehouse_name_QA:_0x36b32d,to_Room_name_QA:_0x59b03b,note:_0xb2d34f,for_categorize:_0x366f5c,product_name_QA1:_0x5e0a5e}=_0x2f2eaf[_0x1e8b30(0x21e)];if(typeof _0x5e0a5e=='string')var _0x4811a5=[_0x2f2eaf['body']['product_name_QA1']],_0x2f1dc6=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x245)]],_0x25146a=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x236)]],_0x4eaa09=[_0x2f2eaf['body']['product_code_QA']],_0x4ad791=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1fd)]],_0x4091f8=[_0x2f2eaf[_0x1e8b30(0x21e)]['stocks_QA']],_0x58f130=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x23d)]],_0x3d552c=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1d2)]],_0x46d385=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x145)]],_0x2d27e2=[_0x2f2eaf['body'][_0x1e8b30(0x159)]],_0x2d4dfc=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x161)]],_0x92c238=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1ec)]],_0x50b065=[_0x2f2eaf['body']['production_date_QA']],_0xac59db=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x23c)]];else var _0x4811a5=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x201)]],_0x2f1dc6=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x245)]],_0x25146a=[..._0x2f2eaf['body'][_0x1e8b30(0x236)]],_0x4eaa09=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x204)]],_0x4ad791=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1fd)]],_0x4091f8=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x24c)]],_0x58f130=[..._0x2f2eaf['body'][_0x1e8b30(0x23d)]],_0x3d552c=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1d2)]],_0x46d385=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x145)]],_0x2d27e2=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x159)]],_0x2d4dfc=[..._0x2f2eaf['body'][_0x1e8b30(0x161)]],_0x92c238=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1ec)]],_0x50b065=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1a0)]],_0xac59db=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x23c)]];const _0x1d8d8d=_0x4811a5[_0x1e8b30(0x19a)](_0x5b6464=>{return _0x5b6464={'product_name':_0x5b6464};});_0x2f1dc6[_0x1e8b30(0x20d)]((_0x470155,_0x42759b)=>{var _0x243aa8=_0x1e8b30;_0x1d8d8d[_0x42759b][_0x243aa8(0x146)]=_0x470155;}),_0x25146a['forEach']((_0x38bbc2,_0x260387)=>{_0x1d8d8d[_0x260387]['secondary_code']=_0x38bbc2;}),_0x4eaa09['forEach']((_0x300ee5,_0x1ca3c0)=>{var _0x38b2cf=_0x1e8b30;_0x1d8d8d[_0x1ca3c0][_0x38b2cf(0x1b8)]=_0x300ee5;}),_0x4ad791[_0x1e8b30(0x20d)]((_0x45811f,_0x284e4f)=>{var _0x472665=_0x1e8b30;_0x1d8d8d[_0x284e4f][_0x472665(0x15f)]=_0x45811f;}),_0x4091f8[_0x1e8b30(0x20d)]((_0x180c5b,_0x26d263)=>{var _0x1c4aac=_0x1e8b30;_0x1d8d8d[_0x26d263][_0x1c4aac(0x169)]=_0x180c5b;}),_0x58f130[_0x1e8b30(0x20d)]((_0x319b44,_0x4556b9)=>{var _0x416a22=_0x1e8b30;_0x1d8d8d[_0x4556b9][_0x416a22(0x1dd)]=_0x319b44;}),_0x3d552c[_0x1e8b30(0x20d)]((_0xab0375,_0x158989)=>{var _0x33195e=_0x1e8b30;_0x1d8d8d[_0x158989][_0x33195e(0x19e)]=_0xab0375;}),_0x46d385[_0x1e8b30(0x20d)]((_0x4a3a72,_0x53b85c)=>{var _0x2f969f=_0x1e8b30;_0x1d8d8d[_0x53b85c][_0x2f969f(0x202)]=_0x4a3a72;}),_0x2d27e2[_0x1e8b30(0x20d)]((_0x2757b8,_0x2df901)=>{var _0x491ea0=_0x1e8b30;_0x1d8d8d[_0x2df901][_0x491ea0(0x191)]=_0x2757b8;}),_0x2d4dfc[_0x1e8b30(0x20d)]((_0x8bbe26,_0x437dcb)=>{var _0x34ec76=_0x1e8b30;_0x1d8d8d[_0x437dcb][_0x34ec76(0x223)]=_0x8bbe26;}),_0x92c238[_0x1e8b30(0x20d)]((_0xa75e3e,_0x412d2e)=>{var _0x34b1ba=_0x1e8b30;_0x1d8d8d[_0x412d2e][_0x34b1ba(0x1a5)]=_0xa75e3e;}),_0x50b065['forEach']((_0x477c27,_0x32fb1b)=>{var _0x52034c=_0x1e8b30;_0x1d8d8d[_0x32fb1b][_0x52034c(0x1a9)]=_0x477c27;}),_0xac59db[_0x1e8b30(0x20d)]((_0x3562ae,_0x3bb4e5)=>{var _0x39394e=_0x1e8b30;_0x1d8d8d[_0x3bb4e5][_0x39394e(0x1ae)]=_0x3562ae;});const _0x7e1a3c=await sales_finished[_0x1e8b30(0x1b2)]({'invoice':_0x5c0669});_0x7e1a3c[_0x1e8b30(0x158)]=_0x1e8b30(0x22b);const _0x11712a=await _0x7e1a3c[_0x1e8b30(0x1f8)](),_0x3b9959=new sales_return_finished({'invoice':_0x5c0669,'customer':_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x237)],'date':_0x1b5971,'warehouse_name':_0x1b86f4,'room':_0x4c4f1a,'ToWarehouse':_0x36b32d,'ToRoom':_0x59b03b,'return_sale_QA':_0x1d8d8d,'note':_0xb2d34f,'warehouse_cat':_0x366f5c}),_0xb90e2b=await _0x3b9959[_0x1e8b30(0x1f8)](),_0x3beea3=await sales_return_finished[_0x1e8b30(0x1b2)]({'invoice':_0x5c0669}),_0x3268b8=await warehouse[_0x1e8b30(0x1b2)]({'name':_0x36b32d,'room':_0x59b03b});_0x3beea3['return_sale_QA'][_0x1e8b30(0x20d)](_0x1e2c21=>{var _0x17a561=_0x1e8b30,_0x9d7149=0x0;const _0x3151c3=_0x3268b8[_0x17a561(0x190)]['map'](_0x4f9125=>{var _0x280ddd=_0x17a561;_0x4f9125['product_name']==_0x1e2c21[_0x280ddd(0x194)]&&_0x4f9125[_0x280ddd(0x1ae)]==_0x1e2c21[_0x280ddd(0x1ae)]&&_0x4f9125['production_date']==_0x1e2c21[_0x280ddd(0x1a9)]&&_0x4f9125[_0x280ddd(0x191)]==_0x1e2c21[_0x280ddd(0x191)]&&(_0x4f9125['product_stock']=parseInt(_0x4f9125[_0x280ddd(0x22d)])+parseInt(_0x1e2c21[_0x280ddd(0x1dd)]),_0x9d7149++);});_0x9d7149=='0'&&(_0x3268b8[_0x17a561(0x190)]=_0x3268b8['product_details'][_0x17a561(0x24b)]({'product_name':_0x1e2c21['product_name'],'product_stock':_0x1e2c21[_0x17a561(0x1dd)],'primary_code':_0x1e2c21[_0x17a561(0x146)],'secondary_code':_0x1e2c21[_0x17a561(0x1fa)],'product_code':_0x1e2c21[_0x17a561(0x1b8)],'batch_code':_0x1e2c21['batch_code'],'maxPerUnit':_0x1e2c21[_0x17a561(0x19e)],'production_date':_0x1e2c21['production_date'],'expiry_date':_0x1e2c21[_0x17a561(0x1ae)],'secondary_unit':_0x1e2c21[_0x17a561(0x223)],'unit':_0x1e2c21[_0x17a561(0x1a5)],'maxProducts':_0x1e2c21['maxProducts'],'bay':_0x1e2c21[_0x17a561(0x229)]}));}),await _0x3268b8[_0x1e8b30(0x1f8)]();const _0x18e2ab=new c_payment_data({'invoice':_0x5c0669,'customer':_0x2f2eaf['body'][_0x1e8b30(0x237)],'reason':'Sale\x20Return'});await _0x18e2ab[_0x1e8b30(0x1f8)]();const _0xc61f0=await master_shop['find'](),_0x5d22d7=await email_settings[_0x1e8b30(0x1b2)](),_0x403c89=await customer[_0x1e8b30(0x1b2)]({'name':_0x2f2eaf[_0x1e8b30(0x21e)]['customer']});_0xc61f0[0x0][_0x1e8b30(0x150)]==0x1?(right_currency=_0xc61f0[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0xc61f0[0x0][_0x1e8b30(0x215)]);var _0x2d95a1=_0x4811a5,_0x29d8f8=_0x58f130,_0x9001f='',_0x10d0ba;for(_0x10d0ba in _0x2d95a1){_0x9001f+=_0x1e8b30(0x165)+_0x1e8b30(0x1df)+_0x2d95a1[_0x10d0ba]+_0x1e8b30(0x1bb)+_0x1e8b30(0x1df)+_0x29d8f8[_0x10d0ba]+'</td>'+'</tr>';}console[_0x1e8b30(0x250)]('product_list',_0x9001f);let _0x5012fa=nodemailer[_0x1e8b30(0x220)]({'service':_0x1e8b30(0x1c5),'auth':{'user':_0x5d22d7['email'],'pass':_0x5d22d7[_0x1e8b30(0x1f5)]}}),_0x44f76b={'from':_0x5d22d7[_0x1e8b30(0x14c)],'to':_0x403c89[_0x1e8b30(0x14c)],'subject':_0x1e8b30(0x180),'attachments':[{'filename':_0x1e8b30(0x213),'path':__dirname+'/../public'+'/upload/'+_0xc61f0[0x0][_0x1e8b30(0x1e2)],'cid':_0x1e8b30(0x157)}],'html':_0x1e8b30(0x1ca)+_0x1e8b30(0x18a)+_0x1e8b30(0x151)+'<div>'+_0x1e8b30(0x21c)+'<div>'+_0x1e8b30(0x1de)+_0x1e8b30(0x24f)+_0x1e8b30(0x1dc)+_0x1e8b30(0x1f6)+_0xc61f0[0x0]['site_title']+_0x1e8b30(0x1cc)+_0x1e8b30(0x24f)+_0x1e8b30(0x24f)+_0x1e8b30(0x182)+_0x1e8b30(0x1dc)+_0x1e8b30(0x19d)+'\x20Order\x20Number\x20:\x20'+_0x5c0669+'\x20'+_0x1e8b30(0x1be)+_0x1e8b30(0x216)+_0x1b5971+'\x20'+_0x1e8b30(0x256)+_0x1e8b30(0x22f)+_0x1e8b30(0x24f)+_0x1e8b30(0x225)+_0x1e8b30(0x20c)+_0x1e8b30(0x165)+_0x1e8b30(0x147)+_0x1e8b30(0x181)+_0x1e8b30(0x227)+_0x1e8b30(0x1ed)+_0x1e8b30(0x1ce)+_0x1e8b30(0x239)+_0x1e8b30(0x1bf)+'\x20'+_0x9001f+'\x20'+'</tbody>'+_0x1e8b30(0x15d)+_0x1e8b30(0x1dc)+_0x1e8b30(0x14d)+_0x1e8b30(0x20b)+_0xc61f0[0x0][_0x1e8b30(0x23f)]+'</h5>'+_0x1e8b30(0x24f)+_0x1e8b30(0x24f)+'</body></html>'};_0x5012fa[_0x1e8b30(0x1f3)](_0x44f76b,function(_0x568c9f,_0x1609c7){var _0x38cf48=_0x1e8b30;_0x568c9f?(console[_0x38cf48(0x250)](_0x568c9f),console[_0x38cf48(0x250)](_0x38cf48(0x1b5))):console[_0x38cf48(0x250)](_0x38cf48(0x208));}),_0x2f2eaf['flash'](_0x1e8b30(0x24d),_0x1e8b30(0x1e5)),_0x4f6c56[_0x1e8b30(0x1f0)](_0x1e8b30(0x1d8));}catch(_0x47be6e){_0x4f6c56[_0x1e8b30(0x15c)](0xc8)['json']({'message1':_0x47be6e[_0x1e8b30(0x1db)]});}else{if(_0x2f2eaf['body'][_0x1e8b30(0x23e)]=='GS')try{const {invoice:_0x30a8b2,date:_0x1b5492,warehouse_name:_0x34a77e,product_name:_0x235905,primary_code:_0x29482f,secondary_code:_0x42eff7,product_code:_0x1ad5be,sales_quantity:_0x19e2e3,stocks:_0x123c2f,return_qty:_0x253e35,Room_name:_0x2f528f,to_warehouse_name:_0x1905e7,to_Room_name:_0x258e45,note:_0x2f7fc3,level:_0x452508,isle:_0x51541c,pallet:_0x237fc2,for_categorize:_0xfe8c34}=_0x2f2eaf['body'];if(typeof _0x235905==_0x1e8b30(0x205))var _0x4811a5=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x194)]],_0x2f1dc6=[_0x2f2eaf[_0x1e8b30(0x21e)]['primary_code']],_0x25146a=[_0x2f2eaf[_0x1e8b30(0x21e)]['secondary_code']],_0x4eaa09=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1b8)]],_0x4ad791=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x241)]],_0x58f130=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1dd)]],_0x14de28=[_0x2f2eaf['body'][_0x1e8b30(0x229)]],_0x3d552c=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x19e)]],_0x46d385=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x202)]],_0x2d27e2=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x191)]],_0x2d4dfc=[_0x2f2eaf[_0x1e8b30(0x21e)]['secondary_unit']],_0x92c238=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1a5)]],_0x50b065=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1a9)]],_0xac59db=[_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1ae)]];else var _0x4811a5=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x194)]],_0x2f1dc6=[..._0x2f2eaf[_0x1e8b30(0x21e)]['primary_code']],_0x25146a=[..._0x2f2eaf[_0x1e8b30(0x21e)]['secondary_code']],_0x4eaa09=[..._0x2f2eaf[_0x1e8b30(0x21e)]['product_code']],_0x4ad791=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x241)]],_0x58f130=[..._0x2f2eaf['body'][_0x1e8b30(0x1dd)]],_0x14de28=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x229)]],_0x3d552c=[..._0x2f2eaf[_0x1e8b30(0x21e)]['maxPerUnit']],_0x46d385=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x202)]],_0x2d27e2=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x191)]],_0x2d4dfc=[..._0x2f2eaf[_0x1e8b30(0x21e)]['secondary_unit']],_0x92c238=[..._0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x1a5)]],_0x50b065=[..._0x2f2eaf[_0x1e8b30(0x21e)]['production_date']],_0xac59db=[..._0x2f2eaf[_0x1e8b30(0x21e)]['expiry_date']];const _0x436715=_0x4811a5[_0x1e8b30(0x19a)](_0x517f27=>{return _0x517f27={'product_name':_0x517f27};});_0x2f1dc6[_0x1e8b30(0x20d)]((_0x1f548b,_0x3f0e33)=>{var _0x39a632=_0x1e8b30;_0x436715[_0x3f0e33][_0x39a632(0x146)]=_0x1f548b;}),_0x25146a[_0x1e8b30(0x20d)]((_0x503ed3,_0x5db4ae)=>{var _0x22312a=_0x1e8b30;_0x436715[_0x5db4ae][_0x22312a(0x1fa)]=_0x503ed3;}),_0x4eaa09[_0x1e8b30(0x20d)]((_0x49f4ea,_0x4df066)=>{_0x436715[_0x4df066]['product_code']=_0x49f4ea;}),_0x4ad791[_0x1e8b30(0x20d)]((_0x1b42d5,_0xcfd807)=>{var _0x5dc2c5=_0x1e8b30;_0x436715[_0xcfd807][_0x5dc2c5(0x15f)]=_0x1b42d5;}),_0x58f130[_0x1e8b30(0x20d)]((_0x85edc2,_0x46a462)=>{_0x436715[_0x46a462]['return_qty']=_0x85edc2;}),_0x14de28[_0x1e8b30(0x20d)]((_0x3d577,_0xc77084)=>{var _0x5a6792=_0x1e8b30;_0x436715[_0xc77084][_0x5a6792(0x229)]=_0x3d577;}),_0x3d552c['forEach']((_0x2acbb7,_0x22bd4b)=>{_0x436715[_0x22bd4b]['maxPerUnit']=_0x2acbb7;}),_0x46d385['forEach']((_0x484d9f,_0x456df5)=>{_0x436715[_0x456df5]['maxProducts']=_0x484d9f;}),_0x2d27e2[_0x1e8b30(0x20d)]((_0xb03135,_0x1124df)=>{var _0x39cb32=_0x1e8b30;_0x436715[_0x1124df][_0x39cb32(0x191)]=_0xb03135;}),_0x2d4dfc['forEach']((_0x10d8e2,_0x38da0d)=>{var _0xaf3cab=_0x1e8b30;_0x436715[_0x38da0d][_0xaf3cab(0x223)]=_0x10d8e2;}),_0x92c238[_0x1e8b30(0x20d)]((_0x20b495,_0x3a3267)=>{var _0x271a14=_0x1e8b30;_0x436715[_0x3a3267][_0x271a14(0x1a5)]=_0x20b495;}),_0x50b065[_0x1e8b30(0x20d)]((_0x1c0a6c,_0x572a4c)=>{var _0x28af59=_0x1e8b30;_0x436715[_0x572a4c][_0x28af59(0x1a9)]=_0x1c0a6c;}),_0xac59db[_0x1e8b30(0x20d)]((_0x3f74ad,_0x39d1f1)=>{var _0x156a49=_0x1e8b30;_0x436715[_0x39d1f1][_0x156a49(0x1ae)]=_0x3f74ad;});var _0x39f948=0x0;_0x436715[_0x1e8b30(0x20d)](_0x3f53f7=>{var _0x551531=_0x1e8b30;(parseInt(_0x3f53f7[_0x551531(0x15f)])<parseInt(_0x3f53f7[_0x551531(0x1dd)])||parseInt(_0x3f53f7[_0x551531(0x169)])<parseInt(_0x3f53f7[_0x551531(0x1dd)])&&parseInt(_0x3f53f7[_0x551531(0x15f)])>parseInt(_0x3f53f7[_0x551531(0x1dd)])||parseInt(_0x3f53f7['return_qty'])==0x0)&&_0x39f948++;});if(_0x39f948!=0x0)return _0x2f2eaf[_0x1e8b30(0x1d5)](_0x1e8b30(0x142),_0x1e8b30(0x177)),_0x4f6c56['redirect']('back');const _0x406c1f=await sales_finished[_0x1e8b30(0x1b2)]({'invoice':_0x30a8b2});_0x406c1f[_0x1e8b30(0x158)]=_0x1e8b30(0x22b);const _0x1149e5=await _0x406c1f[_0x1e8b30(0x1f8)](),_0x3fc93c=new sales_return_finished({'invoice':_0x30a8b2,'customer':_0x2f2eaf['body']['customer'],'date':_0x1b5492,'warehouse_name':_0x34a77e,'room':_0x2f528f,'ToWarehouse':_0x1905e7,'ToRoom':_0x258e45,'return_sale':_0x436715,'note':_0x2f7fc3,'warehouse_cat':_0xfe8c34}),_0x1fed1b=await _0x3fc93c[_0x1e8b30(0x1f8)](),_0xf6dce=await sales_return_finished[_0x1e8b30(0x1b2)]({'invoice':_0x30a8b2}),_0x4b29d0=await warehouse[_0x1e8b30(0x1b2)]({'name':_0x1905e7,'room':_0x258e45,'warehouse_category':_0x1e8b30(0x222)});_0xf6dce[_0x1e8b30(0x254)][_0x1e8b30(0x20d)](_0xbada94=>{var _0x22e639=_0x1e8b30,_0x22f4e8=0x0;const _0x8eb686=_0x4b29d0[_0x22e639(0x190)][_0x22e639(0x19a)](_0x2f27d0=>{var _0x5d16c3=_0x22e639;_0x2f27d0[_0x5d16c3(0x194)]==_0xbada94[_0x5d16c3(0x194)]&&_0x2f27d0['bay']==_0xbada94[_0x5d16c3(0x229)]&&_0x2f27d0[_0x5d16c3(0x1ae)]==_0xbada94['expiry_date']&&_0x2f27d0[_0x5d16c3(0x1a9)]==_0xbada94[_0x5d16c3(0x1a9)]&&_0x2f27d0[_0x5d16c3(0x191)]==_0xbada94[_0x5d16c3(0x191)]&&(_0x2f27d0[_0x5d16c3(0x22d)]=parseInt(_0x2f27d0[_0x5d16c3(0x22d)])+parseInt(_0xbada94['return_qty']),_0x22f4e8++);});_0x22f4e8=='0'&&(_0x4b29d0[_0x22e639(0x190)]=_0x4b29d0[_0x22e639(0x190)][_0x22e639(0x24b)]({'product_name':_0xbada94[_0x22e639(0x194)],'product_stock':_0xbada94['return_qty'],'primary_code':_0xbada94[_0x22e639(0x146)],'secondary_code':_0xbada94[_0x22e639(0x1fa)],'product_code':_0xbada94['product_code'],'bay':_0xbada94[_0x22e639(0x229)],'batch_code':_0xbada94[_0x22e639(0x191)],'maxPerUnit':_0xbada94[_0x22e639(0x19e)],'production_date':_0xbada94[_0x22e639(0x1a9)],'expiry_date':_0xbada94[_0x22e639(0x1ae)],'secondary_unit':_0xbada94[_0x22e639(0x223)],'unit':_0xbada94['unit'],'maxProducts':_0xbada94['maxProducts']}));}),await _0x4b29d0[_0x1e8b30(0x1f8)](),console[_0x1e8b30(0x250)](_0x2f2eaf[_0x1e8b30(0x21e)]);const _0x19d079=new c_payment_data({'invoice':_0x30a8b2,'customer':_0x2f2eaf['body'][_0x1e8b30(0x237)],'reason':_0x1e8b30(0x243)});await _0x19d079[_0x1e8b30(0x1f8)]();const _0x50b09d=await master_shop['find']();console[_0x1e8b30(0x250)](_0x1e8b30(0x192),_0x50b09d[0x0]['image']);const _0x46f9a4=await email_settings[_0x1e8b30(0x1b2)](),_0x731387=await customer[_0x1e8b30(0x1b2)]({'name':_0x2f2eaf[_0x1e8b30(0x21e)][_0x1e8b30(0x237)]});console[_0x1e8b30(0x250)]('customer_data',_0x731387);_0x50b09d[0x0][_0x1e8b30(0x150)]==0x1?(right_currency=_0x50b09d[0x0][_0x1e8b30(0x215)],left_currency=''):(right_currency='',left_currency=_0x50b09d[0x0][_0x1e8b30(0x215)]);var _0x2d95a1=_0x4811a5,_0x29d8f8=_0x58f130,_0x9001f='',_0x10d0ba;for(_0x10d0ba in _0x2d95a1){_0x9001f+=_0x1e8b30(0x165)+_0x1e8b30(0x1df)+_0x2d95a1[_0x10d0ba]+'</td>'+_0x1e8b30(0x1df)+_0x29d8f8[_0x10d0ba]+_0x1e8b30(0x1bb)+_0x1e8b30(0x1ce);}console['log'](_0x1e8b30(0x20a),_0x9001f);let _0x405d9e=nodemailer[_0x1e8b30(0x220)]({'service':_0x1e8b30(0x1c5),'auth':{'user':_0x46f9a4[_0x1e8b30(0x14c)],'pass':_0x46f9a4['password']}}),_0x3d0ec3={'from':_0x46f9a4[_0x1e8b30(0x14c)],'to':_0x731387[_0x1e8b30(0x14c)],'subject':_0x1e8b30(0x180),'attachments':[{'filename':_0x1e8b30(0x213),'path':__dirname+_0x1e8b30(0x1cf)+_0x1e8b30(0x23a)+_0x50b09d[0x0]['image'],'cid':_0x1e8b30(0x157)}],'html':_0x1e8b30(0x1ca)+'<html><head><title></title>'+_0x1e8b30(0x151)+_0x1e8b30(0x1dc)+_0x1e8b30(0x21c)+'<div>'+_0x1e8b30(0x1de)+_0x1e8b30(0x24f)+_0x1e8b30(0x1dc)+_0x1e8b30(0x1f6)+_0x50b09d[0x0][_0x1e8b30(0x23f)]+_0x1e8b30(0x1cc)+_0x1e8b30(0x24f)+_0x1e8b30(0x24f)+_0x1e8b30(0x182)+'<div>'+_0x1e8b30(0x19d)+'\x20Order\x20Number\x20:\x20'+_0x30a8b2+'\x20'+_0x1e8b30(0x1be)+_0x1e8b30(0x216)+_0x1b5492+'\x20'+'</span>'+'</h5>'+_0x1e8b30(0x24f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x1e8b30(0x147)+_0x1e8b30(0x181)+_0x1e8b30(0x227)+_0x1e8b30(0x1ed)+_0x1e8b30(0x1ce)+_0x1e8b30(0x239)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x9001f+'\x20'+'</tbody>'+_0x1e8b30(0x15d)+_0x1e8b30(0x1dc)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x50b09d[0x0][_0x1e8b30(0x23f)]+_0x1e8b30(0x22f)+'</div>'+_0x1e8b30(0x24f)+_0x1e8b30(0x1fb)};_0x405d9e[_0x1e8b30(0x1f3)](_0x3d0ec3,function(_0x4306ff,_0x4ffa34){var _0x588dc8=_0x1e8b30;_0x4306ff?(console[_0x588dc8(0x250)](_0x4306ff),console[_0x588dc8(0x250)](_0x588dc8(0x1b5))):console['log'](_0x588dc8(0x208));}),_0x2f2eaf[_0x1e8b30(0x1d5)](_0x1e8b30(0x24d),_0x1e8b30(0x1e5)),_0x4f6c56[_0x1e8b30(0x1f0)](_0x1e8b30(0x1d8));}catch(_0x57febf){console[_0x1e8b30(0x250)](_0x57febf),_0x4f6c56['status'](0xc8)[_0x1e8b30(0x1f4)]({'message1':_0x57febf[_0x1e8b30(0x1db)]});}}}),router['get'](a0_0x5169a5(0x17a),auth,async(_0x43eca8,_0x5efb84)=>{var _0x309cfb=a0_0x5169a5;try{const {username:_0x48b55d,email:_0x225646,role:_0x18253b}=_0x43eca8['user'],_0x355640=_0x43eca8[_0x309cfb(0x1ab)],_0x5ae4e7=await profile[_0x309cfb(0x1b2)]({'email':_0x355640[_0x309cfb(0x14c)]}),_0x3bcdac=await master_shop['find']();console['log'](_0x309cfb(0x16a),_0x3bcdac);const _0x36ea3b=_0x43eca8[_0x309cfb(0x1e3)]['id'],_0x10315d=await sales[_0x309cfb(0x207)](_0x36ea3b);console[_0x309cfb(0x250)](_0x309cfb(0x24e),_0x10315d);if(_0x3bcdac[0x0]['language']==_0x309cfb(0x228))var _0x20b9bb=users[_0x309cfb(0x176)];else{if(_0x3bcdac[0x0][_0x309cfb(0x1d6)]==_0x309cfb(0x162))var _0x20b9bb=users[_0x309cfb(0x162)];else{if(_0x3bcdac[0x0][_0x309cfb(0x1d6)]=='German')var _0x20b9bb=users[_0x309cfb(0x1a8)];else{if(_0x3bcdac[0x0][_0x309cfb(0x1d6)]==_0x309cfb(0x1d3))var _0x20b9bb=users[_0x309cfb(0x1d3)];else{if(_0x3bcdac[0x0][_0x309cfb(0x1d6)]==_0x309cfb(0x197))var _0x20b9bb=users[_0x309cfb(0x197)];else{if(_0x3bcdac[0x0][_0x309cfb(0x1d6)]==_0x309cfb(0x249))var _0x20b9bb=users[_0x309cfb(0x219)];else{if(_0x3bcdac[0x0]['language']=='Chinese')var _0x20b9bb=users[_0x309cfb(0x1c0)];else{if(_0x3bcdac[0x0]['language']==_0x309cfb(0x1ba))var _0x20b9bb=users['Arabic'];}}}}}}}_0x5efb84[_0x309cfb(0x1fe)](_0x309cfb(0x18f),{'success':_0x43eca8[_0x309cfb(0x1d5)](_0x309cfb(0x24d)),'errors':_0x43eca8[_0x309cfb(0x1d5)](_0x309cfb(0x142)),'role':_0x355640,'profile':_0x5ae4e7,'alldata':_0x10315d,'master_shop':_0x3bcdac,'language':_0x20b9bb});}catch(_0x258d8e){console[_0x309cfb(0x250)](_0x258d8e);}}),router[a0_0x5169a5(0x183)](a0_0x5169a5(0x1e8),async(_0x371b27,_0x42aec0)=>{var _0x56ae79=a0_0x5169a5;const {product_code:_0x24ff4d,warehouse_name:_0x4f9e0a,rooms_data:_0x5050cd,Roomslist:_0x31e359}=_0x371b27[_0x56ae79(0x21e)],_0x4df8a7=_0x31e359[_0x56ae79(0x174)](','),_0x13c036=[];async function _0x4066c2(_0x151fb5){var _0x12ac85=_0x56ae79;const _0xc539c=await warehouse[_0x12ac85(0x16c)]([{'$match':{'name':_0x4f9e0a,'room':_0x151fb5}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x24ff4d}},{'$group':{'_id':_0x12ac85(0x196),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x12ac85(0x203)},'product_code':{'$first':_0x12ac85(0x21a)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x12ac85(0x152)},'type':{'$first':_0x12ac85(0x171)},'pallet':{'$first':_0x12ac85(0x248)},'unit':{'$first':_0x12ac85(0x238)},'secondary_unit':{'$first':_0x12ac85(0x1a1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x12ac85(0x240)},'expiry_date':{'$first':_0x12ac85(0x178)},'production_date':{'$first':_0x12ac85(0x17e)},'maxPerUnit':{'$first':_0x12ac85(0x195)},'batch_code':{'$first':_0x12ac85(0x1b7)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x12ac85(0x16d)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x5ca8d3=await warehouse[_0x12ac85(0x16c)]([{'$match':{'name':_0x4f9e0a,'room':_0x151fb5}},{'$unwind':_0x12ac85(0x155)},{'$match':{'product_details.secondary_code':_0x24ff4d}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x12ac85(0x1c4)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x12ac85(0x203)},'product_code':{'$first':_0x12ac85(0x21a)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x12ac85(0x152)},'type':{'$first':_0x12ac85(0x171)},'pallet':{'$first':_0x12ac85(0x248)},'unit':{'$first':_0x12ac85(0x238)},'secondary_unit':{'$first':_0x12ac85(0x1a1)},'storage':{'$first':_0x12ac85(0x21f)},'rack':{'$first':_0x12ac85(0x240)},'expiry_date':{'$first':_0x12ac85(0x178)},'production_date':{'$first':_0x12ac85(0x17e)},'maxPerUnit':{'$first':_0x12ac85(0x195)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x12ac85(0x1f9)}}}]);if(_0xc539c[_0x12ac85(0x167)]>0x0)_0x13c036['push'](_0xc539c);else _0x5ca8d3[_0x12ac85(0x167)]>0x0&&_0x13c036[_0x12ac85(0x187)](_0x5ca8d3);}const _0xd93a8d=_0x4df8a7[_0x56ae79(0x19a)](_0x5104ed=>_0x4066c2(_0x5104ed));await Promise[_0x56ae79(0x175)](_0xd93a8d),_0x42aec0[_0x56ae79(0x1f4)](_0x13c036);}),module[a0_0x5169a5(0x1f7)]=router;