var a0_0x4eaf28=a0_0x5bc3;function a0_0x39f8(){var _0x462b37=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','prod_cat','$product.product_name','$sale_product','redirect','/upload/','filter','<tr>','/view/:id','$product_details.secondary_code','$product_details.rack','</head><body>','$product_details.product_cat','5110920LknBgi','primary_code','Received\x20Payment\x20For\x20Sale','carton','$product_details.invoice','$name','$product_details.maxProducts','Sales\x20Add\x20successfully','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','password','secondary_unit','$sale_product.type','French','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','OUTF-','QA\x20Warehouse','save','due_amount','Spanish','sales_quantity_QA','../middleware/auth','4793391wvYIrq','$product_details.expiry_date','1525002IRWDtP','<tbody\x20style=\x22text-align:\x20center;\x22>','/view/add_sales','Sales\x20Update\x20successfully','role','41264GDrzKy','$product_details.bay','return_qty','/preview/:id','render','map','production_date','Finished\x20Goods','Sales\x20Mail','Quality\x20Inspection','../models/all_models','stock_data','return_qty_QA','<h2>\x20','port','$product_details.maxPerUnit','all','<hr\x20class=\x22my-3\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','Sale','find','Arabic','stocks_QA','customer_data','$sale_product.bin','product_date','</tbody>','Arabic\x20(ae)','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','findById','/give_payment/:id','success','barcode\x20Product\x20master','</td>','$product_details.storage','prod_invoice','$warehouse_name','9459830ObSLZE','room_name','customers','<strong>\x20Regards\x20</strong>','add_sales_finished','German','add\x20post','1759OdbUfz','Hindi','random','<div>','Error\x20Occurs','padStart','$return_data','finalize','$product_details.primary_code','7UerlqE','image','expiry_date','aggregate','adjust_qty','get','Enabled','Email\x20sent\x20successfully','errors','$sale_product.bay','batch_code_QA','floor','secondary_code_QA','$product_details.floorlevel','string','split','maxPerUnit','Enclosed','</div>','sendMail','unit','</body></html>','sales\x20item\x20return\x20successfull','/view/return_sales/:id','$customers_docs','stock','Sale\x20Return\x20Mail','<!DOCTYPE\x20html>','express','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','product_stock','findOne','/all_sales_finished/preview/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product','exports','sales_quantity','<span\x20style=\x22float:\x20right;\x22>','$product_details.production_date','/picking_list/pdf/','Portuguese','nodemailer','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Ambient','post','room','Sale\x20Return','RoomAssigned','$invoice','note','quantity','maxProducts','</span>','_id','batch_code','gmail','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','length','\x20</h2>','return_sale','final','$room','prod_code','received_amount','warehouse_name','return_data','$sale_product.floorlevel','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','customers_docs','Portuguese\x20(BR)','customer','/view/add_sale/product','\x20<>\x20','params','</h5>','product_name_QA1','concat','invoice','Router','$product_details.batch_code','secondary_code','createTransport','purchases_data','master','<html><head><title></title>','all_sales_barcode','edit_sales_finished_view','payment\x20successfull','189Yiyjhy','$product_details.product_code','maxperunit','secondary_unit_QA','FGSEmail','logo','product_list','message','back','product_name','/barcode/:id','push','foreach\x20newproduct','$product_details.type','$note','getDate','user','</thead>','$product_details','$product_details.product_name','then','False','body','11rrDGji','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','382POVhGv','maxPerUnit_QA','/all_sales_finished/view','error','product_code','3313065cfWNkM','toString','sales_invoice','Return\x20Goods','product_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','warehouse','</tr>','sale_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','currency','suppliers','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','An\x20error\x20occurred.','log','return_sale_QA','forEach','Logo.png','for_categorize','$product_details.product_stock','Return\x20Rooms','<table\x20style=\x22width:\x20100%\x20!important;\x22>','\x20Order\x20Number\x20:\x20','product_details','language','unit_QA','site_title','production_date_QA','flash','currency_placement','$product_details._id','expiry_date_QA','</table>','An\x20error\x20occurred\x20while\x20saving\x20data.','/view/add_sales/:id','level','/../public','$product_details.unit','date','$sale_product.quantity','catch','DRY\x20GOODS','<h5>','abs','$customer','slice','$_id','$date','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','staff','$finalize','/all_sales/view','True','\x20Order\x20Date\x20:\x20','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','maxProducts_QA','status','getFullYear','bay','Chinese','$product_details.bin','sale_qty','name','$product_details.secondary_unit','English\x20(US)','json','English','Sale\x20Product\x20Mail'];a0_0x39f8=function(){return _0x462b37;};return a0_0x39f8();}(function(_0x3a263c,_0x2eefd1){var _0x184f5a=a0_0x5bc3,_0x288f26=_0x3a263c();while(!![]){try{var _0x136097=-parseInt(_0x184f5a(0x1ca))/0x1*(parseInt(_0x184f5a(0x128))/0x2)+parseInt(_0x184f5a(0x10f))/0x3*(parseInt(_0x184f5a(0x19e))/0x4)+-parseInt(_0x184f5a(0x12d))/0x5+parseInt(_0x184f5a(0x199))/0x6*(-parseInt(_0x184f5a(0x1d3))/0x7)+parseInt(_0x184f5a(0x182))/0x8+-parseInt(_0x184f5a(0x197))/0x9+-parseInt(_0x184f5a(0x1c3))/0xa*(-parseInt(_0x184f5a(0x126))/0xb);if(_0x136097===_0x2eefd1)break;else _0x288f26['push'](_0x288f26['shift']());}catch(_0x3b4874){_0x288f26['push'](_0x288f26['shift']());}}}(a0_0x39f8,0x6db80));const express=require(a0_0x4eaf28(0x1ef)),app=express(),router=express[a0_0x4eaf28(0x105)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x4eaf28(0x1a8)),auth=require(a0_0x4eaf28(0x196)),nodemailer=require(a0_0x4eaf28(0x1fc)),users=require('../public/language/languages.json');function a0_0x5bc3(_0x4ba19d,_0x3133ea){var _0x39f8af=a0_0x39f8();return a0_0x5bc3=function(_0x5bc328,_0x3eafe7){_0x5bc328=_0x5bc328-0xfa;var _0x24a304=_0x39f8af[_0x5bc328];return _0x24a304;},a0_0x5bc3(_0x4ba19d,_0x3133ea);}router[a0_0x4eaf28(0x1d8)]('/view',auth,async(_0x523cb8,_0x204256)=>{var _0x508adc=a0_0x4eaf28;try{const {username:_0x1492d5,email:_0x46b0fd,role:_0x27d7be}=_0x523cb8[_0x508adc(0x11f)],_0x2eee7c=_0x523cb8[_0x508adc(0x11f)],_0x3e56a0=await profile[_0x508adc(0x1f2)]({'email':_0x2eee7c[_0x508adc(0x166)]}),_0x4b87e1=await master_shop['find']();let _0x15f946;if(_0x2eee7c[_0x508adc(0x19d)]=='staff'){const _0x34eeda=await staff[_0x508adc(0x1f2)]({'email':_0x2eee7c['email']});_0x15f946=await sales_finished['aggregate']([{'$lookup':{'from':_0x508adc(0x1c5),'localField':_0x508adc(0xfd),'foreignField':_0x508adc(0x16f),'as':_0x508adc(0xfb)}},{'$unwind':_0x508adc(0x1eb)},{'$unwind':_0x508adc(0x178)},{'$group':{'_id':_0x508adc(0x15e),'invoice':{'$first':_0x508adc(0x203)},'customers':{'$first':_0x508adc(0x15c)},'date':{'$first':_0x508adc(0x15f)},'warehouse_name':{'$first':_0x508adc(0x1c2)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x508adc(0x1d0)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x508adc(0x157)},'level':{'$addToSet':_0x508adc(0x1dc)},'isle':{'$addToSet':_0x508adc(0x1b6)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x508adc(0x215)},'finalize':{'$first':_0x508adc(0x162)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x15f946=await sales_finished[_0x508adc(0x1d6)]([{'$lookup':{'from':'customers','localField':_0x508adc(0xfd),'foreignField':_0x508adc(0x16f),'as':_0x508adc(0xfb)}},{'$unwind':_0x508adc(0x1eb)},{'$unwind':_0x508adc(0x178)},{'$group':{'_id':_0x508adc(0x15e),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x508adc(0x15f)},'warehouse_name':{'$first':_0x508adc(0x1c2)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x508adc(0x11d)},'return_data':{'$first':_0x508adc(0x1d0)},'customers_docs':{'$first':_0x508adc(0x1eb)},'total_saleproduct_quantity':{'$sum':_0x508adc(0x157)},'level':{'$addToSet':_0x508adc(0x1dc)},'isle':{'$addToSet':_0x508adc(0x1b6)},'type':{'$addToSet':_0x508adc(0x18d)},'pallet':{'$addToSet':_0x508adc(0x215)},'finalize':{'$first':_0x508adc(0x162)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x4b87e1[0x0]['language']==_0x508adc(0x171)){var _0x5bc3f5=users[_0x508adc(0x173)];console['log'](_0x5bc3f5);}else{if(_0x4b87e1[0x0]['language']==_0x508adc(0x1cb))var _0x5bc3f5=users[_0x508adc(0x1cb)];else{if(_0x4b87e1[0x0][_0x508adc(0x148)]==_0x508adc(0x1c8))var _0x5bc3f5=users[_0x508adc(0x1c8)];else{if(_0x4b87e1[0x0][_0x508adc(0x148)]==_0x508adc(0x194))var _0x5bc3f5=users[_0x508adc(0x194)];else{if(_0x4b87e1[0x0][_0x508adc(0x148)]==_0x508adc(0x18e))var _0x5bc3f5=users[_0x508adc(0x18e)];else{if(_0x4b87e1[0x0]['language']==_0x508adc(0xfc))var _0x5bc3f5=users['Portuguese'];else{if(_0x4b87e1[0x0][_0x508adc(0x148)]=='Chinese')var _0x5bc3f5=users[_0x508adc(0x16c)];else{if(_0x4b87e1[0x0]['language']==_0x508adc(0x1b9))var _0x5bc3f5=users[_0x508adc(0x1b3)];}}}}}}}_0x204256[_0x508adc(0x1a2)]('all_sales_finished',{'success':_0x523cb8[_0x508adc(0x14c)](_0x508adc(0x1bd)),'errors':_0x523cb8[_0x508adc(0x14c)](_0x508adc(0x1db)),'sales':_0x15f946,'profile':_0x3e56a0,'role':_0x2eee7c,'master_shop':_0x4b87e1,'language':_0x5bc3f5});}catch(_0x2c093a){console[_0x508adc(0x13e)](_0x2c093a);}});async function getRandom8DigitNumber(){var _0x22c9e4=a0_0x4eaf28;const _0x367874=0x989680,_0x3df268=0x5f5e0ff,_0x5a0cb2=Math[_0x22c9e4(0x1de)](Math[_0x22c9e4(0x1cc)]()*(_0x3df268-_0x367874+0x1))+_0x367874;var _0x55e03c;const _0x1d6986=await sales_finished[_0x22c9e4(0x1f2)]({'invoice':_0x22c9e4(0x190)+_0x5a0cb2});return _0x1d6986&&_0x1d6986[_0x22c9e4(0x20c)]>0x0?_0x55e03c=_0x22c9e4(0x190)+_0x5a0cb2:_0x55e03c=_0x22c9e4(0x190)+_0x5a0cb2,_0x55e03c;}router[a0_0x4eaf28(0x1d8)](a0_0x4eaf28(0x19b),auth,async(_0xcf28a,_0x1f0180)=>{var _0x22ce77=a0_0x4eaf28;try{const {username:_0x3c4dd9,email:_0x392ed6,role:_0x41ad0c}=_0xcf28a[_0x22ce77(0x11f)],_0x1ad5b4=_0xcf28a[_0x22ce77(0x11f)],_0x16a1f9=await profile['findOne']({'email':_0x1ad5b4['email']}),_0x40aa3e=await master_shop['find'](),_0x4b5a42=await customer[_0x22ce77(0x1b2)]({});let _0x2b6e31;if(_0x1ad5b4['role']==_0x22ce77(0x161)){const _0x5b3324=await staff[_0x22ce77(0x1f2)]({'email':_0x1ad5b4[_0x22ce77(0x166)]});_0x2b6e31=await warehouse[_0x22ce77(0x1d6)]([{'$match':{'status':_0x22ce77(0x1d9),'name':_0x5b3324[_0x22ce77(0x134)],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x22ce77(0x187),'name':{'$first':_0x22ce77(0x187)}}},{'$sort':{'name':0x1}}]);}else _0x2b6e31=await warehouse[_0x22ce77(0x1d6)]([{'$match':{'status':_0x22ce77(0x1d9),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x22ce77(0x191)}}},{'$group':{'_id':_0x22ce77(0x187),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x1f1d17=await product['find']({});var _0x49fab1=['Ambient',_0x22ce77(0x1e4)];const _0x467408=await sales_finished['find']({}),_0x25a28e=_0x467408[_0x22ce77(0x20c)]+0x1,_0x17e514=_0x22ce77(0x190)+_0x25a28e[_0x22ce77(0x12e)]()[_0x22ce77(0x1cf)](0x5,'0');if(_0x40aa3e[0x0]['language']==_0x22ce77(0x171)){var _0x1b9445=users[_0x22ce77(0x173)];console[_0x22ce77(0x13e)](_0x1b9445);}else{if(_0x40aa3e[0x0]['language']==_0x22ce77(0x1cb))var _0x1b9445=users[_0x22ce77(0x1cb)];else{if(_0x40aa3e[0x0]['language']==_0x22ce77(0x1c8))var _0x1b9445=users[_0x22ce77(0x1c8)];else{if(_0x40aa3e[0x0][_0x22ce77(0x148)]==_0x22ce77(0x194))var _0x1b9445=users['Spanish'];else{if(_0x40aa3e[0x0][_0x22ce77(0x148)]==_0x22ce77(0x18e))var _0x1b9445=users[_0x22ce77(0x18e)];else{if(_0x40aa3e[0x0][_0x22ce77(0x148)]==_0x22ce77(0xfc))var _0x1b9445=users[_0x22ce77(0x1fb)];else{if(_0x40aa3e[0x0]['language']==_0x22ce77(0x16c))var _0x1b9445=users['Chinese'];else{if(_0x40aa3e[0x0][_0x22ce77(0x148)]==_0x22ce77(0x1b9))var _0x1b9445=users[_0x22ce77(0x1b3)];}}}}}}}const _0x5ac08e=getRandom8DigitNumber();_0x5ac08e[_0x22ce77(0x123)](_0x1ee178=>{var _0x5a5d1c=_0x22ce77;_0x1f0180['render'](_0x5a5d1c(0x1c7),{'success':_0xcf28a[_0x5a5d1c(0x14c)](_0x5a5d1c(0x1bd)),'errors':_0xcf28a[_0x5a5d1c(0x14c)]('errors'),'role':_0x1ad5b4,'profile':_0x16a1f9,'customer':_0x4b5a42,'warehouse':_0x2b6e31,'product':_0x1f1d17,'invoice':_0x1ee178,'master_shop':_0x40aa3e,'language':_0x1b9445,'rooms_data':_0x49fab1});})[_0x22ce77(0x158)](_0x5dddc5=>{var _0x2bf2ca=_0x22ce77;_0xcf28a[_0x2bf2ca(0x14c)](_0x2bf2ca(0x1db),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1f0180['redirect'](_0x2bf2ca(0x12a));});}catch(_0x3f5964){console['log'](_0x3f5964);}}),router[a0_0x4eaf28(0x1d8)](a0_0x4eaf28(0x152),auth,async(_0x22cc1e,_0x237812)=>{var _0xd2221f=a0_0x4eaf28;try{const _0x3dd853=_0x22cc1e[_0xd2221f(0x100)]['id'];console['log'](_0x3dd853);const _0x3cfa43=await product[_0xd2221f(0x1b2)](),_0x194a3c=await purchases[_0xd2221f(0x1d6)]([{'$match':{'warehouse_name':_0x3dd853}},{'$unwind':_0xd2221f(0x1f5)},{'$group':{'_id':_0xd2221f(0x177)}}]);console['log'](_0xd2221f(0x109),_0x194a3c),_0x237812['status'](0xc8)['json']({'purchases_data':_0x194a3c,'product_data':_0x3cfa43});}catch(_0x56eaed){console['log'](_0x56eaed);}}),router[a0_0x4eaf28(0x1ff)](a0_0x4eaf28(0xfe),auth,async(_0x84e12a,_0x400af4)=>{var _0x42fca0=a0_0x4eaf28;try{const {warehouse_data:_0x36ee2c,product_data:_0x3c6c5f}=_0x84e12a['body'];console[_0x42fca0(0x13e)](_0x84e12a['body'][_0x42fca0(0x131)]);;const _0x3b7eef=await master_shop[_0x42fca0(0x1b2)]();console['log'](_0x42fca0(0x10a),_0x3b7eef);const _0x2bd1ef=await product[_0x42fca0(0x1f2)]({'name':_0x3c6c5f});console['log']('product',_0x2bd1ef);const _0x228662=await warehouse[_0x42fca0(0x1d6)]([{'$match':{'name':_0x36ee2c}},{'$unwind':_0x42fca0(0x121)},{'$match':{'product_details.product_name':_0x3c6c5f}},{'$group':{'_id':_0x42fca0(0x122),'product_stock':{'$first':_0x42fca0(0x143)}}}]);console['log'](_0x42fca0(0x1a9),_0x228662),_0x400af4[_0x42fca0(0x169)](0xc8)[_0x42fca0(0x172)]({'master':_0x3b7eef,'new_product':_0x2bd1ef,'stock_data':_0x228662});}catch(_0x1712a1){console[_0x42fca0(0x13e)](_0x1712a1);}}),router[a0_0x4eaf28(0x1ff)](a0_0x4eaf28(0x19b),auth,async(_0x4aeb0b,_0x5424dd)=>{var _0x2d2b79=a0_0x4eaf28;try{const {invoice:_0x237cfc,date:_0x4ff013,warehouse_name:_0x3a975b,product_name:_0x13420d,stock:_0x5e899b,quantity:_0x40370b,note:_0x547834,room:_0x4ff497,primary_code:_0x41638c,secondary_code:_0x3dcf87,prod_code:_0x5eae03,level:_0x43f055,isle:_0x15e6fe,pallet:_0x309a4e,batch_code:_0x550db0,SCRN:_0x25a024,expiry_date:_0x25f799,mode_transpo:_0x48e7f5,name_driver:_0x3fc3f4}=_0x4aeb0b[_0x2d2b79(0x125)];if(typeof _0x13420d==_0x2d2b79(0x1e1))var _0x271bb6=[_0x4aeb0b['body']['product_name']],_0x4b9b44=[_0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x1ec)]],_0x2fd280=[_0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x185)]],_0x2d2a87=[_0x4aeb0b['body']['primary_code']],_0x3a87b7=[_0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x107)]],_0x206fa6=[_0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x211)]],_0x36fa35=[_0x4aeb0b[_0x2d2b79(0x125)]['level']],_0x3f65ae=[_0x4aeb0b['body']['primary_unit']],_0x571b85=[_0x4aeb0b[_0x2d2b79(0x125)]['secondary_unit']],_0x43b609=[_0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x209)]],_0x55f021=[_0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x1d5)]],_0x495dbb=[_0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x1b7)]],_0x480cfb=[_0x4aeb0b['body']['max_per_unit']],_0x1756fd=[_0x4aeb0b['body'][_0x2d2b79(0x176)]],_0x2b54c5=[_0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x202)]],_0x58fc4c=[_0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x1c1)]];else var _0x271bb6=[..._0x4aeb0b['body']['product_name']],_0x4b9b44=[..._0x4aeb0b['body'][_0x2d2b79(0x1ec)]],_0x2fd280=[..._0x4aeb0b['body']['carton']],_0x2d2a87=[..._0x4aeb0b['body']['primary_code']],_0x3a87b7=[..._0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x107)]],_0x206fa6=[..._0x4aeb0b['body'][_0x2d2b79(0x211)]],_0x36fa35=[..._0x4aeb0b['body'][_0x2d2b79(0x153)]],_0x3f65ae=[..._0x4aeb0b[_0x2d2b79(0x125)]['primary_unit']],_0x571b85=[..._0x4aeb0b['body']['secondary_unit']],_0x43b609=[..._0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x209)]],_0x55f021=[..._0x4aeb0b['body'][_0x2d2b79(0x1d5)]],_0x495dbb=[..._0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x1b7)]],_0x480cfb=[..._0x4aeb0b['body']['max_per_unit']],_0x1756fd=[..._0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x176)]],_0x2b54c5=[..._0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0x202)]],_0x58fc4c=[..._0x4aeb0b[_0x2d2b79(0x125)]['prod_invoice']];const _0x20c06b=_0x271bb6[_0x2d2b79(0x1a3)](_0x40a731=>{return _0x40a731={'product_name':_0x40a731};});_0x4b9b44['forEach']((_0x320a2b,_0x7edca)=>{_0x20c06b[_0x7edca]['stock']=_0x320a2b;}),_0x2fd280[_0x2d2b79(0x140)]((_0x26cdf3,_0x193f65)=>{var _0x5152ad=_0x2d2b79;_0x20c06b[_0x193f65][_0x5152ad(0x205)]=Math[_0x5152ad(0x15b)](_0x26cdf3);}),_0x2d2a87[_0x2d2b79(0x140)]((_0x30b775,_0x50f273)=>{var _0xb34224=_0x2d2b79;_0x20c06b[_0x50f273][_0xb34224(0x183)]=_0x30b775;}),_0x3a87b7[_0x2d2b79(0x140)]((_0x3339d3,_0x308a06)=>{_0x20c06b[_0x308a06]['secondary_code']=_0x3339d3;}),_0x206fa6['forEach']((_0x1abef1,_0x56d310)=>{_0x20c06b[_0x56d310]['product_code']=_0x1abef1;}),_0x36fa35[_0x2d2b79(0x140)]((_0x56a9df,_0x166b0e)=>{var _0x43eaaa=_0x2d2b79;_0x20c06b[_0x166b0e][_0x43eaaa(0x16b)]=_0x56a9df;}),_0x3f65ae[_0x2d2b79(0x140)]((_0x11aa8b,_0x120c48)=>{var _0x598fe5=_0x2d2b79;_0x20c06b[_0x120c48][_0x598fe5(0x1e7)]=_0x11aa8b;}),_0x571b85[_0x2d2b79(0x140)]((_0x1ed6f1,_0x28e611)=>{var _0x292f2a=_0x2d2b79;_0x20c06b[_0x28e611][_0x292f2a(0x18c)]=_0x1ed6f1;}),_0x43b609[_0x2d2b79(0x140)]((_0x5bc4c7,_0x27be94)=>{var _0x5c9858=_0x2d2b79;_0x20c06b[_0x27be94][_0x5c9858(0x209)]=_0x5bc4c7;}),_0x55f021[_0x2d2b79(0x140)]((_0x144e53,_0x503b52)=>{var _0x530358=_0x2d2b79;_0x20c06b[_0x503b52][_0x530358(0x1d5)]=_0x144e53;}),_0x495dbb['forEach']((_0x47968e,_0x265116)=>{var _0x4c4414=_0x2d2b79;_0x20c06b[_0x265116][_0x4c4414(0x1a4)]=_0x47968e;}),_0x480cfb[_0x2d2b79(0x140)]((_0x5ecd69,_0x2ea268)=>{var _0x5910ef=_0x2d2b79;_0x20c06b[_0x2ea268][_0x5910ef(0x111)]=_0x5ecd69;}),_0x1756fd[_0x2d2b79(0x140)]((_0x2dfcdf,_0x1cf727)=>{_0x20c06b[_0x1cf727]['prod_cat']=_0x2dfcdf;}),_0x2b54c5['forEach']((_0x24d916,_0x43606a)=>{_0x20c06b[_0x43606a]['room_name']=_0x24d916;}),_0x58fc4c[_0x2d2b79(0x140)]((_0x1d5272,_0x347bba)=>{var _0x5a6359=_0x2d2b79;_0x20c06b[_0x347bba][_0x5a6359(0x104)]=_0x1d5272;});var _0x4ccca3=0x0;_0x20c06b[_0x2d2b79(0x140)](_0x1dccbe=>{var _0x31b2cf=_0x2d2b79;parseFloat(_0x1dccbe[_0x31b2cf(0x1ec)])<parseFloat(_0x1dccbe['quantity'])&&parseFloat(_0x1dccbe[_0x31b2cf(0x205)])>parseFloat(_0x1dccbe[_0x31b2cf(0x1ec)])&&(console[_0x31b2cf(0x13e)](_0x1dccbe[_0x31b2cf(0x1ec)]+_0x31b2cf(0xff)+_0x1dccbe[_0x31b2cf(0x205)]),_0x4ccca3++);});if(_0x4ccca3!=0x0)return _0x4aeb0b[_0x2d2b79(0x14c)](_0x2d2b79(0x1db),_0x2d2b79(0xfa)),_0x5424dd[_0x2d2b79(0x179)](_0x2d2b79(0x117));const _0x28adbd=_0x20c06b[_0x2d2b79(0x17b)](_0x547b55=>_0x547b55['quantity']!=='0'&&_0x547b55['quantity']!==''),_0x9ded68=new sales_finished({'invoice':_0x237cfc,'customer':_0x4aeb0b[_0x2d2b79(0x125)][_0x2d2b79(0xfd)],'date':_0x4ff013,'warehouse_name':_0x3a975b,'sale_product':_0x28adbd,'note':_0x547834,'room':_0x4ff497,'primary_code':_0x41638c,'secondary_code':_0x3dcf87,'prod_code':_0x5eae03,'SCRN':_0x25a024,'finalize':_0x2d2b79(0x124),'mode_transpo':_0x48e7f5,'name_driver':_0x3fc3f4}),_0x4b39e9=await _0x9ded68[_0x2d2b79(0x192)](),_0x143600=await sales_finished[_0x2d2b79(0x1f2)]({'invoice':_0x237cfc}),_0x406f6a=new c_payment_data({'invoice':_0x237cfc,'customer':_0x4aeb0b['body'][_0x2d2b79(0xfd)],'reason':_0x2d2b79(0x1b1)});await _0x406f6a[_0x2d2b79(0x192)]();const _0x4300f1=await master_shop['find'](),_0x15ec0b=await email_settings['findOne'](),_0x3457f9=await customer[_0x2d2b79(0x1f2)]({'name':_0x4aeb0b['body'][_0x2d2b79(0xfd)]});_0x4300f1[0x0][_0x2d2b79(0x14d)]==0x1?(right_currency=_0x4300f1[0x0][_0x2d2b79(0x138)],left_currency=''):(right_currency='',left_currency=_0x4300f1[0x0][_0x2d2b79(0x138)]);var _0x2df378=_0x271bb6,_0x176de4=_0x2fd280,_0x45a186='',_0x4f0356;for(_0x4f0356 in _0x2df378){_0x45a186+=_0x2d2b79(0x17c)+_0x2d2b79(0x20b)+_0x2df378[_0x4f0356]+'</td>'+_0x2d2b79(0x20b)+_0x176de4[_0x4f0356]+_0x2d2b79(0x1bf)+'</tr>';}console[_0x2d2b79(0x13e)](_0x2d2b79(0x115),_0x45a186);let _0x519791=nodemailer[_0x2d2b79(0x108)]({'service':'gmail','auth':{'user':_0x15ec0b[_0x2d2b79(0x166)],'pass':_0x15ec0b[_0x2d2b79(0x18b)]}}),_0x4dd36d={'from':_0x15ec0b[_0x2d2b79(0x166)],'to':_0x3457f9[_0x2d2b79(0x166)],'subject':_0x2d2b79(0x174),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2d2b79(0x154)+_0x2d2b79(0x17a)+_0x4300f1[0x0][_0x2d2b79(0x1d4)],'cid':_0x2d2b79(0x114)}],'html':_0x2d2b79(0x1ee)+'<html><head><title></title>'+_0x2d2b79(0x180)+_0x2d2b79(0x1cd)+_0x2d2b79(0x18a)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2d2b79(0x1e5)+_0x2d2b79(0x1cd)+_0x2d2b79(0x1ab)+_0x4300f1[0x0][_0x2d2b79(0x14a)]+'\x20</h2>'+_0x2d2b79(0x1e5)+_0x2d2b79(0x1e5)+'<hr\x20class=\x22my-3\x22>'+_0x2d2b79(0x1cd)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x2d2b79(0x146)+_0x237cfc+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x2d2b79(0x165)+_0x4ff013+'\x20'+'</span>'+'</h5>'+'</div>'+_0x2d2b79(0x145)+_0x2d2b79(0x1ba)+_0x2d2b79(0x17c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>'+_0x2d2b79(0x135)+_0x2d2b79(0x120)+_0x2d2b79(0x19a)+'\x20'+_0x45a186+'\x20'+'</tbody>'+'</table>'+_0x2d2b79(0x1cd)+_0x2d2b79(0x1c6)+_0x2d2b79(0x15a)+_0x4300f1[0x0][_0x2d2b79(0x14a)]+'</h5>'+_0x2d2b79(0x1e5)+'</div>'+_0x2d2b79(0x1e8)};_0x519791['sendMail'](_0x4dd36d,function(_0x497daf,_0x56ebe8){var _0x923316=_0x2d2b79;_0x497daf?(console['log'](_0x497daf),console[_0x923316(0x13e)](_0x923316(0x1ce))):console[_0x923316(0x13e)]('Email\x20sent\x20successfully');}),_0x4aeb0b[_0x2d2b79(0x14c)](_0x2d2b79(0x1bd),_0x2d2b79(0x189)),_0x5424dd[_0x2d2b79(0x179)](_0x2d2b79(0x1f3)+_0x4b39e9[_0x2d2b79(0x208)]);}catch(_0x527ee5){console[_0x2d2b79(0x13e)](_0x527ee5);}}),router[a0_0x4eaf28(0x1d8)](a0_0x4eaf28(0x1a1),auth,async(_0x9104f1,_0x41d78e)=>{var _0x54fafb=a0_0x4eaf28;try{const {username:_0x344f37,email:_0x42d035,role:_0x17a4cf}=_0x9104f1[_0x54fafb(0x11f)],_0x197af7=_0x9104f1['user'],_0x8bcbf7=await profile[_0x54fafb(0x1f2)]({'email':_0x197af7[_0x54fafb(0x166)]}),_0x1a843a=await master_shop['find'](),_0x1d38cd=_0x9104f1[_0x54fafb(0x100)]['id'],_0xdd5f5b=await sales_finished[_0x54fafb(0x1bb)](_0x1d38cd),_0x954f17=await warehouse[_0x54fafb(0x1d6)]([{'$match':{'name':_0xdd5f5b[_0x54fafb(0x213)]}},{'$unwind':_0x54fafb(0x121)},{'$group':{'_id':_0x54fafb(0x14e),'name':{'$first':_0x54fafb(0x122)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x54fafb(0x19f)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x54fafb(0x11c)},'floorlevel':{'$first':_0x54fafb(0x1e0)},'primary_code':{'$first':_0x54fafb(0x1d2)},'secondary_code':{'$first':_0x54fafb(0x17e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x54fafb(0x1c0)},'rack':{'$first':_0x54fafb(0x17f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x54fafb(0x1f9)},'batch_code':{'$first':_0x54fafb(0x106)},'room':{'$first':'$room'}}}]),_0xffb191=await customer[_0x54fafb(0x1b2)]({});let _0x35c0dc;if(_0x197af7['role']==_0x54fafb(0x161)){const _0xde857c=await staff['findOne']({'email':_0x197af7[_0x54fafb(0x166)]});_0x35c0dc=await warehouse[_0x54fafb(0x1d6)]([{'$match':{'status':_0x54fafb(0x1d9),'name':_0xde857c['warehouse']}},{'$group':{'_id':_0x54fafb(0x187),'name':{'$first':'$name'}}}]);}else _0x35c0dc=await warehouse[_0x54fafb(0x1d6)]([{'$match':{'status':_0x54fafb(0x1d9)}},{'$group':{'_id':_0x54fafb(0x187),'name':{'$first':_0x54fafb(0x187)}}}]);const _0x464da8=await product[_0x54fafb(0x1b2)]({});if(_0x1a843a[0x0][_0x54fafb(0x148)]==_0x54fafb(0x171)){var _0x17d71d=users[_0x54fafb(0x173)];console[_0x54fafb(0x13e)](_0x17d71d);}else{if(_0x1a843a[0x0]['language']==_0x54fafb(0x1cb))var _0x17d71d=users[_0x54fafb(0x1cb)];else{if(_0x1a843a[0x0][_0x54fafb(0x148)]==_0x54fafb(0x1c8))var _0x17d71d=users[_0x54fafb(0x1c8)];else{if(_0x1a843a[0x0][_0x54fafb(0x148)]=='Spanish')var _0x17d71d=users['Spanish'];else{if(_0x1a843a[0x0][_0x54fafb(0x148)]==_0x54fafb(0x18e))var _0x17d71d=users[_0x54fafb(0x18e)];else{if(_0x1a843a[0x0][_0x54fafb(0x148)]==_0x54fafb(0xfc))var _0x17d71d=users['Portuguese'];else{if(_0x1a843a[0x0]['language']==_0x54fafb(0x16c))var _0x17d71d=users[_0x54fafb(0x16c)];else{if(_0x1a843a[0x0]['language']==_0x54fafb(0x1b9))var _0x17d71d=users['Arabic'];}}}}}}}_0x41d78e[_0x54fafb(0x1a2)](_0x54fafb(0x10d),{'success':_0x9104f1[_0x54fafb(0x14c)](_0x54fafb(0x1bd)),'errors':_0x9104f1[_0x54fafb(0x14c)]('errors'),'role':_0x197af7,'profile':_0x8bcbf7,'customer':_0xffb191,'warehouse':_0x35c0dc,'product':_0x954f17,'user':_0xdd5f5b,'master_shop':_0x1a843a,'unit':_0x464da8,'language':_0x17d71d});}catch(_0x36504a){console[_0x54fafb(0x13e)](_0x36504a);}}),router[a0_0x4eaf28(0x1ff)](a0_0x4eaf28(0x1a1),auth,async(_0x3a2736,_0x4142a8)=>{var _0x5b9e23=a0_0x4eaf28;try{const _0x40f107=_0x3a2736['params']['id'],{invoice:_0x359023,warehouse_name:_0x243bad,room:_0x48f3d6}=_0x3a2736[_0x5b9e23(0x125)],_0x9075b5=await sales_finished[_0x5b9e23(0x1f2)]({'invoice':_0x359023}),_0x130d00=_0x9075b5[_0x5b9e23(0x136)][_0x5b9e23(0x1a3)](async _0xb07b9a=>{var _0x180d02=_0x5b9e23,_0x54e366=await warehouse[_0x180d02(0x1f2)]({'name':_0x243bad,'room':_0xb07b9a[_0x180d02(0x1c4)],'warehouse_category':'Finished\x20Goods'});const _0x3b699e=_0x54e366['product_details'][_0x180d02(0x1a3)](_0x2a38cd=>{var _0x107329=_0x180d02;_0x2a38cd[_0x107329(0x118)]==_0xb07b9a[_0x107329(0x118)]&&_0x2a38cd['bay']==_0xb07b9a[_0x107329(0x16b)]&&_0x2a38cd[_0x107329(0x1d5)]==_0xb07b9a[_0x107329(0x1d5)]&&_0x2a38cd[_0x107329(0x1a4)]==_0xb07b9a[_0x107329(0x1a4)]&&_0x2a38cd['batch_code']==_0xb07b9a[_0x107329(0x209)]&&_0x2a38cd['invoice']==_0xb07b9a[_0x107329(0x104)]&&(_0x2a38cd['product_stock']=Math['abs'](_0x2a38cd[_0x107329(0x1f1)])-Math[_0x107329(0x15b)](_0xb07b9a[_0x107329(0x205)]));});return _0x54e366;});Promise[_0x5b9e23(0x1ae)](_0x130d00)[_0x5b9e23(0x123)](async _0x11e898=>{var _0x2d72b9=_0x5b9e23;try{for(const _0x2da936 of _0x11e898){await _0x2da936[_0x2d72b9(0x192)]();}_0x9075b5[_0x2d72b9(0x1d1)]=_0x2d72b9(0x164);const _0x2faac7=await _0x9075b5[_0x2d72b9(0x192)](),_0x21d422=await master_shop['find'](),_0x5eb17c=await email_settings['findOne'](),_0x1048cc=await supervisor_settings[_0x2d72b9(0x1b2)]();var _0x20e59d=_0x9075b5[_0x2d72b9(0x136)],_0x575414='',_0x5116a6;for(_0x5116a6 in _0x20e59d){var _0x44a2ed='FG';_0x9075b5[_0x2d72b9(0x213)]==_0x2d72b9(0x159)&&(_0x44a2ed='DG'),_0x575414+=_0x2d72b9(0x17c)+_0x2d72b9(0x20b)+_0x20e59d[_0x5116a6]['product_name']+_0x2d72b9(0x1bf)+_0x2d72b9(0x20b)+_0x20e59d[_0x5116a6][_0x2d72b9(0x12c)]+_0x2d72b9(0x1bf)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x20e59d[_0x5116a6][_0x2d72b9(0x205)]+'</td>'+_0x2d72b9(0x20b)+_0x20e59d[_0x5116a6]['unit']+_0x2d72b9(0x1bf)+_0x2d72b9(0x20b)+_0x20e59d[_0x5116a6][_0x2d72b9(0x18c)]+_0x2d72b9(0x1bf)+_0x2d72b9(0x20b)+_0x9075b5[_0x2d72b9(0x213)]+_0x2d72b9(0x1bf)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x20e59d[_0x5116a6][_0x2d72b9(0x1c4)]+_0x2d72b9(0x1bf)+_0x2d72b9(0x20b)+_0x44a2ed+_0x20e59d[_0x5116a6][_0x2d72b9(0x16b)]+'</td>';}let _0x3f8d37=nodemailer['createTransport']({'host':_0x5eb17c['host'],'port':Number(_0x5eb17c[_0x2d72b9(0x1ac)]),'secure':![],'auth':{'user':_0x5eb17c[_0x2d72b9(0x166)],'pass':_0x5eb17c[_0x2d72b9(0x18b)]}}),_0x522b81={'from':_0x5eb17c['email'],'to':_0x1048cc[0x0][_0x2d72b9(0x113)],'subject':_0x2d72b9(0x1a6),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2d72b9(0x154)+'/upload/'+_0x21d422[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x2d72b9(0x180)+_0x2d72b9(0x1cd)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2d72b9(0x1cd)+_0x2d72b9(0x160)+_0x2d72b9(0x1e5)+'<div>'+_0x2d72b9(0x1ab)+_0x21d422[0x0]['site_title']+_0x2d72b9(0x20d)+_0x2d72b9(0x1e5)+_0x2d72b9(0x1e5)+_0x2d72b9(0x1af)+'<div>'+_0x2d72b9(0x1b0)+_0x2d72b9(0x146)+_0x9075b5[_0x2d72b9(0x104)]+'\x20'+_0x2d72b9(0x1f8)+_0x2d72b9(0x165)+_0x9075b5[_0x2d72b9(0x156)]+'\x20'+_0x2d72b9(0x207)+_0x2d72b9(0x101)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2d72b9(0x1ba)+_0x2d72b9(0x17c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2d72b9(0x13b)+_0x2d72b9(0x1f4)+_0x2d72b9(0x175)+_0x2d72b9(0x13c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x2d72b9(0x167)+_0x2d72b9(0x137)+'</tr>'+_0x2d72b9(0x120)+_0x2d72b9(0x19a)+'\x20'+_0x575414+'\x20'+_0x2d72b9(0x1b8)+_0x2d72b9(0x150)+_0x2d72b9(0x1cd)+_0x2d72b9(0x1c6)+_0x2d72b9(0x15a)+_0x21d422[0x0][_0x2d72b9(0x14a)]+_0x2d72b9(0x101)+'</div>'+_0x2d72b9(0x1e5)+_0x2d72b9(0x1e8)};_0x3f8d37[_0x2d72b9(0x1e6)](_0x522b81,function(_0x2d1a4e,_0x4d5962){var _0x474896=_0x2d72b9;_0x2d1a4e?(console[_0x474896(0x13e)](_0x2d1a4e),console['log']('Error\x20Occurs')):console[_0x474896(0x13e)]('Email\x20sent\x20successfully');}),_0x3a2736[_0x2d72b9(0x14c)](_0x2d72b9(0x1bd),_0x2d72b9(0x19c)),_0x4142a8['redirect'](_0x2d72b9(0x1fa)+_0x40f107);}catch(_0x1909a2){console[_0x2d72b9(0x12b)](_0x1909a2),_0x4142a8[_0x2d72b9(0x169)](0x1f4)[_0x2d72b9(0x172)]({'error':_0x2d72b9(0x151)});}})['catch'](_0x4d74fb=>{var _0x1bc0c0=_0x5b9e23;console[_0x1bc0c0(0x12b)](_0x4d74fb),_0x4142a8[_0x1bc0c0(0x169)](0x1f4)['json']({'error':_0x1bc0c0(0x13d)});});}catch(_0x44da91){console['log'](_0x44da91);}}),router['get']('/view/:id',auth,async(_0x13392c,_0x25b4d2)=>{var _0x4d9847=a0_0x4eaf28;try{const {username:_0x37ceb5,email:_0x52cadb,role:_0x15f160}=_0x13392c[_0x4d9847(0x11f)],_0x28e87a=_0x13392c[_0x4d9847(0x11f)],_0x5b2c9b=await profile[_0x4d9847(0x1f2)]({'email':_0x28e87a[_0x4d9847(0x166)]}),_0x80bd22=await master_shop[_0x4d9847(0x1b2)](),_0x1cdaae=_0x13392c[_0x4d9847(0x100)]['id'],_0xb548bd=await sales_finished[_0x4d9847(0x1bb)](_0x1cdaae);let _0x123950=new Date(_0xb548bd[_0x4d9847(0x1d5)]),_0x582fc8=('0'+_0x123950['getDate']())[_0x4d9847(0x15d)](-0x2),_0x398d5b=('0'+(_0x123950['getMonth']()+0x1))[_0x4d9847(0x15d)](-0x2),_0x3bd485=_0x123950['getFullYear'](),_0x55f08a=_0x3bd485+'-'+_0x398d5b+'-'+_0x582fc8;var _0x733cae=[_0x4d9847(0x1fe),_0x4d9847(0x1e4)];const _0x4e5658=await warehouse[_0x4d9847(0x1d6)]([{'$match':{'name':_0xb548bd['warehouse_name'],'room':_0xb548bd[_0x4d9847(0x200)]}},{'$unwind':_0x4d9847(0x121)},{'$group':{'_id':_0x4d9847(0x14e),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4d9847(0x143)},'bay':{'$first':_0x4d9847(0x19f)},'bin':{'$first':_0x4d9847(0x16d)},'type':{'$first':_0x4d9847(0x11c)},'floorlevel':{'$first':_0x4d9847(0x1e0)},'primary_code':{'$first':_0x4d9847(0x1d2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4d9847(0x110)},'storage':{'$first':_0x4d9847(0x1c0)},'rack':{'$first':_0x4d9847(0x17f)}}}]),_0x2c16a0=await customer[_0x4d9847(0x1b2)]({});let _0x5d6938;if(_0x28e87a[_0x4d9847(0x19d)]==_0x4d9847(0x161)){const _0x5124fe=await staff[_0x4d9847(0x1f2)]({'email':_0x28e87a['email']});_0x5d6938=await warehouse[_0x4d9847(0x1d6)]([{'$match':{'status':_0x4d9847(0x1d9),'name':_0x5124fe[_0x4d9847(0x134)]}},{'$group':{'_id':_0x4d9847(0x187),'name':{'$first':_0x4d9847(0x187)}}}]);}else _0x5d6938=await warehouse[_0x4d9847(0x1d6)]([{'$match':{'status':_0x4d9847(0x1d9)}},{'$group':{'_id':_0x4d9847(0x187),'name':{'$first':_0x4d9847(0x187)}}}]);const _0x44c827=await product[_0x4d9847(0x1b2)]({});if(_0x80bd22[0x0][_0x4d9847(0x148)]==_0x4d9847(0x171)){var _0x2776c7=users[_0x4d9847(0x173)];console[_0x4d9847(0x13e)](_0x2776c7);}else{if(_0x80bd22[0x0][_0x4d9847(0x148)]=='Hindi')var _0x2776c7=users[_0x4d9847(0x1cb)];else{if(_0x80bd22[0x0][_0x4d9847(0x148)]==_0x4d9847(0x1c8))var _0x2776c7=users['German'];else{if(_0x80bd22[0x0][_0x4d9847(0x148)]==_0x4d9847(0x194))var _0x2776c7=users[_0x4d9847(0x194)];else{if(_0x80bd22[0x0]['language']==_0x4d9847(0x18e))var _0x2776c7=users['French'];else{if(_0x80bd22[0x0]['language']==_0x4d9847(0xfc))var _0x2776c7=users[_0x4d9847(0x1fb)];else{if(_0x80bd22[0x0][_0x4d9847(0x148)]==_0x4d9847(0x16c))var _0x2776c7=users['Chinese'];else{if(_0x80bd22[0x0][_0x4d9847(0x148)]==_0x4d9847(0x1b9))var _0x2776c7=users['Arabic'];}}}}}}}_0x25b4d2['render']('edit_sales_finished',{'success':_0x13392c['flash'](_0x4d9847(0x1bd)),'errors':_0x13392c[_0x4d9847(0x14c)]('errors'),'role':_0x28e87a,'profile':_0x5b2c9b,'customer':_0x2c16a0,'warehouse':_0x5d6938,'product':_0x4e5658,'user':_0xb548bd,'master_shop':_0x80bd22,'unit':_0x44c827,'language':_0x2776c7,'rooms_data':_0x733cae,'ed_fullDate':_0x55f08a});}catch(_0x5077a3){console[_0x4d9847(0x13e)](_0x5077a3);}}),router[a0_0x4eaf28(0x1ff)](a0_0x4eaf28(0x17d),auth,async(_0x29e735,_0xbac858)=>{var _0xf3c680=a0_0x4eaf28;try{const _0x83b073=_0x29e735[_0xf3c680(0x100)]['id'],_0x4ca286=await sales_finished[_0xf3c680(0x1f2)]({'_id':_0x29e735[_0xf3c680(0x100)]['id']}),_0x36e7b1=await warehouse[_0xf3c680(0x1f2)]({'name':_0x4ca286[_0xf3c680(0x213)],'room':_0x29e735[_0xf3c680(0x125)]['room'],'warehouse_category':_0xf3c680(0x1a5)}),{invoice:_0x27bd5c,customer:_0x26985e,date:_0x51a571,warehouse_name:_0x2a968e,product_name:_0x5b7387,stock:_0x3fa949,adjust_qty:_0x585649,note:_0x2dfddc,room:_0x31ae4a,primary_code:_0x4bd41b,secondary_code:_0x202812,prod_code:_0x233dbc,level:_0x1a5a68,isle:_0x25f96d,pallet:_0x151093,expiry_date:_0xc51c8e}=_0x29e735[_0xf3c680(0x125)];if(typeof _0x5b7387==_0xf3c680(0x1e1))var _0x364ee7=[_0x29e735[_0xf3c680(0x125)]['product_name']],_0x219d9a=[_0x29e735[_0xf3c680(0x125)][_0xf3c680(0x1ec)]],_0x1d7b5c=[_0x29e735[_0xf3c680(0x125)][_0xf3c680(0x1d7)]],_0x144d51=[_0x29e735[_0xf3c680(0x125)][_0xf3c680(0x183)]],_0x160b92=[_0x29e735[_0xf3c680(0x125)]['secondary_code']],_0x1d35c2=[_0x29e735[_0xf3c680(0x125)][_0xf3c680(0x211)]],_0x467100=[_0x29e735[_0xf3c680(0x125)]['level']],_0x5e2724=[_0x29e735[_0xf3c680(0x125)][_0xf3c680(0x1d5)]];else var _0x364ee7=[..._0x29e735['body']['product_name']],_0x219d9a=[..._0x29e735['body'][_0xf3c680(0x1ec)]],_0x1d7b5c=[..._0x29e735['body'][_0xf3c680(0x1d7)]],_0x144d51=[..._0x29e735[_0xf3c680(0x125)][_0xf3c680(0x183)]],_0x160b92=[..._0x29e735[_0xf3c680(0x125)][_0xf3c680(0x107)]],_0x1d35c2=[..._0x29e735[_0xf3c680(0x125)][_0xf3c680(0x211)]],_0x467100=[..._0x29e735[_0xf3c680(0x125)][_0xf3c680(0x153)]],_0x5e2724=[..._0x29e735[_0xf3c680(0x125)][_0xf3c680(0x1d5)]];const _0xfc788a=_0x364ee7[_0xf3c680(0x1a3)](_0xd2cc04=>{return _0xd2cc04={'product_name':_0xd2cc04};});_0x219d9a[_0xf3c680(0x140)]((_0x5695a5,_0x98c255)=>{var _0x2898de=_0xf3c680;_0xfc788a[_0x98c255][_0x2898de(0x1ec)]=_0x5695a5;}),_0x1d7b5c[_0xf3c680(0x140)]((_0x3cce91,_0x1ee491)=>{var _0x3f1600=_0xf3c680;_0xfc788a[_0x1ee491][_0x3f1600(0x205)]=_0x3cce91;}),_0x144d51[_0xf3c680(0x140)]((_0x855b8d,_0x3e47ed)=>{var _0x38406e=_0xf3c680;_0xfc788a[_0x3e47ed][_0x38406e(0x183)]=_0x855b8d;}),_0x160b92[_0xf3c680(0x140)]((_0x4ccadf,_0x5aea68)=>{var _0x28c4b8=_0xf3c680;_0xfc788a[_0x5aea68][_0x28c4b8(0x107)]=_0x4ccadf;}),_0x1d35c2[_0xf3c680(0x140)]((_0x1ed1ce,_0x21481c)=>{var _0x42522b=_0xf3c680;_0xfc788a[_0x21481c][_0x42522b(0x12c)]=_0x1ed1ce;}),_0x467100[_0xf3c680(0x140)]((_0x24fe5d,_0x11e812)=>{var _0x50cf14=_0xf3c680;_0xfc788a[_0x11e812][_0x50cf14(0x153)]=_0x24fe5d;}),_0x5e2724[_0xf3c680(0x140)]((_0x480e09,_0x13cb35)=>{var _0x721c6=_0xf3c680;_0xfc788a[_0x13cb35][_0x721c6(0x1d5)]=_0x480e09;});var _0x5e9940=0x0;_0xfc788a[_0xf3c680(0x140)](_0xf96192=>{var _0xa8db13=_0xf3c680;console[_0xa8db13(0x13e)](_0xa8db13(0x11b),_0xf96192),(parseInt(_0xf96192['stock'])<parseInt(_0xf96192['quantity'])||parseInt(_0xf96192[_0xa8db13(0x205)])==0x0)&&_0x5e9940++;});if(_0x5e9940!=0x0)return _0x29e735['flash']('errors',_0xf3c680(0x18f)),_0xbac858[_0xf3c680(0x179)](_0xf3c680(0x117));_0x4ca286['sale_product'][_0xf3c680(0x140)](_0x19477b=>{var _0x5ad498=_0xf3c680;const _0x5da25d=_0x36e7b1[_0x5ad498(0x147)][_0x5ad498(0x1a3)](_0x20550a=>{var _0x30ea14=_0x5ad498;_0x20550a['product_name']==_0x19477b[_0x30ea14(0x118)]&&_0x20550a[_0x30ea14(0x16b)]==_0x19477b[_0x30ea14(0x16b)]&&(_0x20550a['product_stock']=parseInt(_0x20550a['product_stock'])+parseInt(_0x19477b[_0x30ea14(0x205)]));});}),await _0x36e7b1[_0xf3c680(0x192)]();const _0x3645cb=_0xfc788a[_0xf3c680(0x17b)](_0x20f55b=>_0x20f55b['quantity']!=='0'&&_0x20f55b[_0xf3c680(0x205)]!=='');_0x4ca286[_0xf3c680(0x104)]=_0x27bd5c,_0x4ca286[_0xf3c680(0xfd)]=_0x26985e,_0x4ca286[_0xf3c680(0x156)]=_0x51a571,_0x4ca286[_0xf3c680(0x213)]=_0x2a968e,_0x4ca286[_0xf3c680(0x136)]=_0x3645cb,_0x4ca286[_0xf3c680(0x204)]=_0x2dfddc,_0x4ca286[_0xf3c680(0x200)]=_0x31ae4a;const _0x132fa7=await _0x4ca286[_0xf3c680(0x192)](),_0x1a4479=await sales_finished['findOne']({'_id':_0x29e735[_0xf3c680(0x100)]['id']}),_0x15f145=await warehouse[_0xf3c680(0x1f2)]({'name':_0x2a968e,'room':_0x31ae4a,'warehouse_category':_0xf3c680(0x1a5)});_0x1a4479[_0xf3c680(0x136)][_0xf3c680(0x140)](_0x5b1aeb=>{var _0x25b3ce=_0xf3c680;const _0x2e1878=_0x15f145[_0x25b3ce(0x147)][_0x25b3ce(0x1a3)](_0x1e533c=>{var _0x3fb05a=_0x25b3ce;_0x1e533c[_0x3fb05a(0x118)]==_0x5b1aeb['product_name']&&_0x1e533c[_0x3fb05a(0x16b)]==_0x5b1aeb['bay']&&(_0x1e533c['product_stock']=parseInt(_0x1e533c['product_stock'])-parseInt(_0x5b1aeb['quantity']));});}),console[_0xf3c680(0x13e)](_0xf3c680(0x20f),_0x15f145),await _0x15f145[_0xf3c680(0x192)]();const _0x2b4d5b=await c_payment_data['findOne']({'invoice':_0x29e735[_0xf3c680(0x125)][_0xf3c680(0x104)]});_0x2b4d5b[_0xf3c680(0x139)]=_0x29e735[_0xf3c680(0x125)]['suppliers'],await _0x2b4d5b[_0xf3c680(0x192)](),_0x29e735['flash'](_0xf3c680(0x1bd),_0xf3c680(0x19c)),_0xbac858[_0xf3c680(0x179)](_0xf3c680(0x12a));}catch(_0x552f9b){console[_0xf3c680(0x13e)](_0x552f9b);}}),router['post'](a0_0x4eaf28(0x1bc),auth,async(_0x431098,_0x4844a4)=>{var _0xd08ef7=a0_0x4eaf28;try{const _0xace22a=_0x431098[_0xd08ef7(0x100)]['id'],{invoice:_0x4b3d93,customer:_0x9ca44,receivable_amount:_0x2fffed,received_amount:_0x44e011}=_0x431098['body'],_0x483cb6=await sales['findById'](_0xace22a);console[_0xd08ef7(0x13e)](_0x483cb6);var _0x16cebc=_0x2fffed-_0x44e011;console[_0xd08ef7(0x13e)](_0x44e011),_0x483cb6[_0xd08ef7(0x212)]=parseFloat(_0x44e011)+parseFloat(_0x483cb6[_0xd08ef7(0x212)]),_0x483cb6[_0xd08ef7(0x193)]=_0x16cebc,console['log'](_0x483cb6);const _0x415c7f=await _0x483cb6[_0xd08ef7(0x192)](),_0x8750a0=await c_payment_data['findOne']({'invoice':_0x4b3d93});_0x8750a0[_0xd08ef7(0x13a)]=_0x16cebc,await _0x8750a0[_0xd08ef7(0x192)]();let _0x5504f9=new Date(),_0x31e4a3=('0'+_0x5504f9[_0xd08ef7(0x11e)]())[_0xd08ef7(0x15d)](-0x2),_0x309560=('0'+(_0x5504f9['getMonth']()+0x1))[_0xd08ef7(0x15d)](-0x2),_0x3833f8=_0x5504f9[_0xd08ef7(0x16a)](),_0x20ed5b=_0x3833f8+'-'+_0x309560+'-'+_0x31e4a3;const _0x2f2f2b=new customer_payment({'invoice':_0x4b3d93,'date':_0x3833f8+'-'+_0x309560+'-'+_0x31e4a3,'customer':_0x9ca44,'reason':_0xd08ef7(0x184),'amount':_0x44e011}),_0x5d37a8=await _0x2f2f2b['save']();_0x431098[_0xd08ef7(0x14c)](_0xd08ef7(0x1bd),_0xd08ef7(0x10e)),_0x4844a4['redirect'](_0xd08ef7(0x163));}catch(_0x210a1c){console[_0xd08ef7(0x13e)](_0x210a1c);}}),router[a0_0x4eaf28(0x1d8)]('/invoice/:id',auth,async(_0x46875f,_0x32e2be)=>{var _0x4fb321=a0_0x4eaf28;try{const {username:_0x80574b,email:_0x2b6f83,role:_0x5282bc}=_0x46875f['user'],_0x5847c9=_0x46875f[_0x4fb321(0x11f)],_0x11ad4a=await profile[_0x4fb321(0x1f2)]({'email':_0x5847c9[_0x4fb321(0x166)]}),_0x598729=await master_shop[_0x4fb321(0x1b2)]();console[_0x4fb321(0x13e)](_0x4fb321(0x10a),_0x598729);const _0x2d586f=_0x46875f[_0x4fb321(0x100)]['id'],_0x3fa25e=await sales[_0x4fb321(0x1bb)](_0x2d586f);console[_0x4fb321(0x13e)](_0x3fa25e);const _0x34073f=await customer[_0x4fb321(0x1f2)]({'name':_0x3fa25e['customer']});console['log'](_0x34073f);if(_0x598729[0x0][_0x4fb321(0x148)]==_0x4fb321(0x171)){var _0x1763aa=users[_0x4fb321(0x173)];console[_0x4fb321(0x13e)](_0x1763aa);}else{if(_0x598729[0x0][_0x4fb321(0x148)]==_0x4fb321(0x1cb))var _0x1763aa=users[_0x4fb321(0x1cb)];else{if(_0x598729[0x0][_0x4fb321(0x148)]==_0x4fb321(0x1c8))var _0x1763aa=users['German'];else{if(_0x598729[0x0][_0x4fb321(0x148)]==_0x4fb321(0x194))var _0x1763aa=users[_0x4fb321(0x194)];else{if(_0x598729[0x0]['language']=='French')var _0x1763aa=users[_0x4fb321(0x18e)];else{if(_0x598729[0x0][_0x4fb321(0x148)]==_0x4fb321(0xfc))var _0x1763aa=users[_0x4fb321(0x1fb)];else{if(_0x598729[0x0][_0x4fb321(0x148)]==_0x4fb321(0x16c))var _0x1763aa=users['Chinese'];else{if(_0x598729[0x0][_0x4fb321(0x148)]==_0x4fb321(0x1b9))var _0x1763aa=users[_0x4fb321(0x1b3)];}}}}}}}_0x32e2be[_0x4fb321(0x1a2)](_0x4fb321(0x12f),{'success':_0x46875f[_0x4fb321(0x14c)](_0x4fb321(0x1bd)),'errors':_0x46875f['flash']('errors'),'role':_0x5847c9,'profile':_0x11ad4a,'master_shop':_0x598729,'customers':_0x34073f,'sales':_0x3fa25e,'language':_0x1763aa});}catch(_0x3b23d5){console[_0x4fb321(0x13e)](_0x3b23d5);}}),router[a0_0x4eaf28(0x1d8)](a0_0x4eaf28(0x1ea),auth,async(_0x207a37,_0x4def39)=>{var _0x3aef2b=a0_0x4eaf28;try{const {username:_0x595605,email:_0x2c0637,role:_0x5d2930}=_0x207a37[_0x3aef2b(0x11f)],_0x27d660=_0x207a37['user'],_0x83f880=await profile[_0x3aef2b(0x1f2)]({'email':_0x27d660[_0x3aef2b(0x166)]}),_0x4f87ee=await master_shop[_0x3aef2b(0x1b2)](),_0x2b80e1=_0x207a37[_0x3aef2b(0x100)]['id'],_0x574ee2=await sales_finished[_0x3aef2b(0x1bb)](_0x2b80e1),_0xc35ac=await warehouse['aggregate']([{'$match':{'name':_0x574ee2['warehouse_name']}},{'$unwind':_0x3aef2b(0x121)},{'$group':{'_id':_0x3aef2b(0x14e),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3aef2b(0x143)},'bay':{'$first':_0x3aef2b(0x19f)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3aef2b(0x1e0)},'primary_code':{'$first':_0x3aef2b(0x1d2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3aef2b(0x1c0)},'rack':{'$first':_0x3aef2b(0x17f)},'expiry_date':{'$first':_0x3aef2b(0x198)},'production_date':{'$first':_0x3aef2b(0x1f9)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x3aef2b(0x170)},'maxProducts':{'$first':_0x3aef2b(0x188)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x3aef2b(0x1ad)}}}]),_0x3c2cd9=await product[_0x3aef2b(0x1b2)]({}),_0x3d7351=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x3aef2b(0x1a5),'name':{'$ne':_0x3aef2b(0x130),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':'$name','name':{'$first':_0x3aef2b(0x187)}}},{'$sort':{'name':0x1}}]);var _0x3d0499=[_0x3aef2b(0x144)];const _0x4d6e3f=await warehouse[_0x3aef2b(0x1d6)]([{'$match':{'status':_0x3aef2b(0x1d9),'name':_0x3aef2b(0x1a7)}},{'$group':{'_id':_0x3aef2b(0x187),'name':{'$first':_0x3aef2b(0x187)}}},{'$sort':{'name':0x1}}]);if(_0x4f87ee[0x0][_0x3aef2b(0x148)]==_0x3aef2b(0x171)){var _0x2e91a0=users['English'];console[_0x3aef2b(0x13e)](_0x2e91a0);}else{if(_0x4f87ee[0x0][_0x3aef2b(0x148)]==_0x3aef2b(0x1cb))var _0x2e91a0=users[_0x3aef2b(0x1cb)];else{if(_0x4f87ee[0x0]['language']==_0x3aef2b(0x1c8))var _0x2e91a0=users['German'];else{if(_0x4f87ee[0x0][_0x3aef2b(0x148)]=='Spanish')var _0x2e91a0=users[_0x3aef2b(0x194)];else{if(_0x4f87ee[0x0][_0x3aef2b(0x148)]==_0x3aef2b(0x18e))var _0x2e91a0=users[_0x3aef2b(0x18e)];else{if(_0x4f87ee[0x0]['language']=='Portuguese\x20(BR)')var _0x2e91a0=users[_0x3aef2b(0x1fb)];else{if(_0x4f87ee[0x0]['language']==_0x3aef2b(0x16c))var _0x2e91a0=users['Chinese'];else{if(_0x4f87ee[0x0][_0x3aef2b(0x148)]==_0x3aef2b(0x1b9))var _0x2e91a0=users[_0x3aef2b(0x1b3)];}}}}}}}_0x4def39[_0x3aef2b(0x1a2)]('return_sale_finished',{'success':_0x207a37[_0x3aef2b(0x14c)](_0x3aef2b(0x1bd)),'errors':_0x207a37[_0x3aef2b(0x14c)](_0x3aef2b(0x1db)),'role':_0x27d660,'profile':_0x83f880,'user':_0x574ee2,'stock':_0xc35ac,'master_shop':_0x4f87ee,'unit':_0x3c2cd9,'language':_0x2e91a0,'warehouses':_0x3d7351,'rooms':_0x3d0499,'warehouse_QA':_0x4d6e3f});}catch(_0x2f03e4){console[_0x3aef2b(0x13e)](_0x2f03e4),_0x4def39[_0x3aef2b(0x169)](0xc8)['json']({'message':_0x2f03e4['message']});}}),router[a0_0x4eaf28(0x1ff)]('/view/return_sales/:id',auth,async(_0x1b3880,_0x5057ec)=>{var _0x1879d6=a0_0x4eaf28;if(_0x1b3880['body'][_0x1879d6(0x142)]=='QA')try{const {invoice:_0x43d589,date:_0x1d1939,warehouse_name:_0x22dfff,product_name:_0x4bbe8b,primary_code:_0x2fdecb,secondary_code:_0x2bd07f,product_code:_0x5785ed,sales_quantity:_0x127838,stocks:_0x6826f6,return_qty:_0xa22527,Room_name:_0x39426f,to_warehouse_name_QA:_0x48fe7d,to_Room_name_QA:_0x469fca,note:_0x45fdc4,for_categorize:_0x1fd6a7,product_name_QA1:_0x40685b}=_0x1b3880[_0x1879d6(0x125)];if(typeof _0x40685b==_0x1879d6(0x1e1))var _0x59b68b=[_0x1b3880['body'][_0x1879d6(0x102)]],_0x4d3bb7=[_0x1b3880['body']['primary_code_QA']],_0x260685=[_0x1b3880[_0x1879d6(0x125)]['secondary_code_QA']],_0x35627d=[_0x1b3880[_0x1879d6(0x125)]['product_code_QA']],_0x1fbd56=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x195)]],_0x46ccb6=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1b4)]],_0x50a99f=[_0x1b3880[_0x1879d6(0x125)]['return_qty_QA']],_0x167fd4=[_0x1b3880[_0x1879d6(0x125)]['maxPerUnit_QA']],_0x44e5a4=[_0x1b3880[_0x1879d6(0x125)]['maxProducts_QA']],_0x15974f=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1dd)]],_0x44eab2=[_0x1b3880['body'][_0x1879d6(0x112)]],_0x5c61ab=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x149)]],_0x400abc=[_0x1b3880['body'][_0x1879d6(0x14b)]],_0x2fc7ad=[_0x1b3880[_0x1879d6(0x125)]['expiry_date_QA']];else var _0x59b68b=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x102)]],_0x4d3bb7=[..._0x1b3880[_0x1879d6(0x125)]['primary_code_QA']],_0x260685=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1df)]],_0x35627d=[..._0x1b3880['body']['product_code_QA']],_0x1fbd56=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x195)]],_0x46ccb6=[..._0x1b3880['body'][_0x1879d6(0x1b4)]],_0x50a99f=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1aa)]],_0x167fd4=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x129)]],_0x44e5a4=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x168)]],_0x15974f=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1dd)]],_0x44eab2=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x112)]],_0x5c61ab=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x149)]],_0x400abc=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x14b)]],_0x2fc7ad=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x14f)]];const _0x37d784=_0x59b68b[_0x1879d6(0x1a3)](_0x3277a0=>{return _0x3277a0={'product_name':_0x3277a0};});_0x4d3bb7[_0x1879d6(0x140)]((_0x2a4447,_0x457cc8)=>{var _0x54fd80=_0x1879d6;_0x37d784[_0x457cc8][_0x54fd80(0x183)]=_0x2a4447;}),_0x260685[_0x1879d6(0x140)]((_0x533450,_0x21cc7a)=>{_0x37d784[_0x21cc7a]['secondary_code']=_0x533450;}),_0x35627d[_0x1879d6(0x140)]((_0x35ba48,_0x331ba1)=>{var _0x371322=_0x1879d6;_0x37d784[_0x331ba1][_0x371322(0x12c)]=_0x35ba48;}),_0x1fbd56['forEach']((_0x5b7c30,_0x44cb61)=>{var _0x1d1baf=_0x1879d6;_0x37d784[_0x44cb61][_0x1d1baf(0x16e)]=_0x5b7c30;}),_0x46ccb6['forEach']((_0x37a09c,_0x3d4b39)=>{_0x37d784[_0x3d4b39]['stock']=_0x37a09c;}),_0x50a99f['forEach']((_0xbecc7b,_0x24b4b7)=>{var _0xc74972=_0x1879d6;_0x37d784[_0x24b4b7][_0xc74972(0x1a0)]=_0xbecc7b;}),_0x167fd4[_0x1879d6(0x140)]((_0x14403,_0x5417b8)=>{_0x37d784[_0x5417b8]['maxPerUnit']=_0x14403;}),_0x44e5a4[_0x1879d6(0x140)]((_0x2a8f25,_0x50c8b)=>{_0x37d784[_0x50c8b]['maxProducts']=_0x2a8f25;}),_0x15974f[_0x1879d6(0x140)]((_0x36c9c7,_0x9c59d9)=>{var _0x405135=_0x1879d6;_0x37d784[_0x9c59d9][_0x405135(0x209)]=_0x36c9c7;}),_0x44eab2[_0x1879d6(0x140)]((_0x40c507,_0xb1cf13)=>{var _0x135bd2=_0x1879d6;_0x37d784[_0xb1cf13][_0x135bd2(0x18c)]=_0x40c507;}),_0x5c61ab[_0x1879d6(0x140)]((_0x563530,_0x471c4c)=>{var _0x10ee18=_0x1879d6;_0x37d784[_0x471c4c][_0x10ee18(0x1e7)]=_0x563530;}),_0x400abc[_0x1879d6(0x140)]((_0x4eefa4,_0x54b624)=>{var _0x15bc0e=_0x1879d6;_0x37d784[_0x54b624][_0x15bc0e(0x1a4)]=_0x4eefa4;}),_0x2fc7ad[_0x1879d6(0x140)]((_0x54c164,_0x232876)=>{var _0x43388a=_0x1879d6;_0x37d784[_0x232876][_0x43388a(0x1d5)]=_0x54c164;});const _0x117c01=await sales_finished[_0x1879d6(0x1f2)]({'invoice':_0x43d589});_0x117c01[_0x1879d6(0x214)]=_0x1879d6(0x164);const _0x20b751=await _0x117c01[_0x1879d6(0x192)](),_0x529a93=new sales_return_finished({'invoice':_0x43d589,'customer':_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0xfd)],'date':_0x1d1939,'warehouse_name':_0x22dfff,'room':_0x39426f,'ToWarehouse':_0x48fe7d,'ToRoom':_0x469fca,'return_sale_QA':_0x37d784,'note':_0x45fdc4,'warehouse_cat':_0x1fd6a7}),_0x4f40ec=await _0x529a93[_0x1879d6(0x192)](),_0x298ecf=await sales_return_finished[_0x1879d6(0x1f2)]({'invoice':_0x43d589}),_0x520773=await warehouse['findOne']({'name':_0x48fe7d,'room':_0x469fca});_0x298ecf[_0x1879d6(0x13f)]['forEach'](_0x315cee=>{var _0x521f81=_0x1879d6,_0xb3185f=0x0;const _0x44c06d=_0x520773[_0x521f81(0x147)][_0x521f81(0x1a3)](_0x1f4cf7=>{var _0x89c04e=_0x521f81;_0x1f4cf7[_0x89c04e(0x118)]==_0x315cee[_0x89c04e(0x118)]&&_0x1f4cf7[_0x89c04e(0x1d5)]==_0x315cee[_0x89c04e(0x1d5)]&&_0x1f4cf7[_0x89c04e(0x1a4)]==_0x315cee[_0x89c04e(0x1a4)]&&_0x1f4cf7['batch_code']==_0x315cee[_0x89c04e(0x209)]&&(_0x1f4cf7['product_stock']=parseInt(_0x1f4cf7['product_stock'])+parseInt(_0x315cee[_0x89c04e(0x1a0)]),_0xb3185f++);});_0xb3185f=='0'&&(_0x520773['product_details']=_0x520773[_0x521f81(0x147)][_0x521f81(0x103)]({'product_name':_0x315cee['product_name'],'product_stock':_0x315cee[_0x521f81(0x1a0)],'primary_code':_0x315cee['primary_code'],'secondary_code':_0x315cee[_0x521f81(0x107)],'product_code':_0x315cee[_0x521f81(0x12c)],'batch_code':_0x315cee[_0x521f81(0x209)],'maxPerUnit':_0x315cee[_0x521f81(0x1e3)],'production_date':_0x315cee[_0x521f81(0x1a4)],'expiry_date':_0x315cee['expiry_date'],'secondary_unit':_0x315cee[_0x521f81(0x18c)],'unit':_0x315cee[_0x521f81(0x1e7)],'maxProducts':_0x315cee[_0x521f81(0x206)],'bay':_0x315cee[_0x521f81(0x16b)]}));}),await _0x520773[_0x1879d6(0x192)]();const _0xb9acd1=new c_payment_data({'invoice':_0x43d589,'customer':_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0xfd)],'reason':_0x1879d6(0x201)});await _0xb9acd1['save']();const _0x5aefc4=await master_shop['find'](),_0x5d3ba6=await email_settings[_0x1879d6(0x1f2)](),_0x12552b=await customer[_0x1879d6(0x1f2)]({'name':_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0xfd)]});_0x5aefc4[0x0][_0x1879d6(0x14d)]==0x1?(right_currency=_0x5aefc4[0x0][_0x1879d6(0x138)],left_currency=''):(right_currency='',left_currency=_0x5aefc4[0x0][_0x1879d6(0x138)]);var _0x411863=_0x59b68b,_0x9e483=_0x50a99f,_0x8c28a7='',_0x42ab56;for(_0x42ab56 in _0x411863){_0x8c28a7+=_0x1879d6(0x17c)+_0x1879d6(0x20b)+_0x411863[_0x42ab56]+'</td>'+_0x1879d6(0x20b)+_0x9e483[_0x42ab56]+_0x1879d6(0x1bf)+_0x1879d6(0x135);}console[_0x1879d6(0x13e)](_0x1879d6(0x115),_0x8c28a7);let _0x19fc9d=nodemailer[_0x1879d6(0x108)]({'service':_0x1879d6(0x20a),'auth':{'user':_0x5d3ba6['email'],'pass':_0x5d3ba6[_0x1879d6(0x18b)]}}),_0x3fa297={'from':_0x5d3ba6[_0x1879d6(0x166)],'to':_0x12552b['email'],'subject':_0x1879d6(0x1ed),'attachments':[{'filename':_0x1879d6(0x141),'path':__dirname+_0x1879d6(0x154)+'/upload/'+_0x5aefc4[0x0]['image'],'cid':_0x1879d6(0x114)}],'html':_0x1879d6(0x1ee)+_0x1879d6(0x10b)+'</head><body>'+_0x1879d6(0x1cd)+_0x1879d6(0x18a)+'<div>'+_0x1879d6(0x160)+'</div>'+'<div>'+_0x1879d6(0x1ab)+_0x5aefc4[0x0][_0x1879d6(0x14a)]+_0x1879d6(0x20d)+'</div>'+'</div>'+_0x1879d6(0x1af)+_0x1879d6(0x1cd)+_0x1879d6(0x1b0)+_0x1879d6(0x146)+_0x43d589+'\x20'+_0x1879d6(0x1f8)+_0x1879d6(0x165)+_0x1d1939+'\x20'+_0x1879d6(0x207)+_0x1879d6(0x101)+_0x1879d6(0x1e5)+_0x1879d6(0x145)+_0x1879d6(0x1ba)+_0x1879d6(0x17c)+_0x1879d6(0x133)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x1879d6(0x127)+_0x1879d6(0x1f0)+_0x1879d6(0x135)+_0x1879d6(0x120)+_0x1879d6(0x19a)+'\x20'+_0x8c28a7+'\x20'+'</tbody>'+_0x1879d6(0x150)+_0x1879d6(0x1cd)+_0x1879d6(0x1c6)+'<h5>'+_0x5aefc4[0x0]['site_title']+'</h5>'+_0x1879d6(0x1e5)+_0x1879d6(0x1e5)+'</body></html>'};_0x19fc9d[_0x1879d6(0x1e6)](_0x3fa297,function(_0x584da4,_0x427e40){var _0xa12870=_0x1879d6;_0x584da4?(console[_0xa12870(0x13e)](_0x584da4),console[_0xa12870(0x13e)](_0xa12870(0x1ce))):console[_0xa12870(0x13e)](_0xa12870(0x1da));}),_0x1b3880[_0x1879d6(0x14c)](_0x1879d6(0x1bd),'sales\x20item\x20return\x20successfull'),_0x5057ec['redirect'](_0x1879d6(0x12a));}catch(_0x396921){_0x5057ec[_0x1879d6(0x169)](0xc8)[_0x1879d6(0x172)]({'message1':_0x396921[_0x1879d6(0x116)]});}else{if(_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x142)]=='GS')try{const {invoice:_0x88aef,date:_0x444b58,warehouse_name:_0x1874d5,product_name:_0x4e83f6,primary_code:_0x2e5a3b,secondary_code:_0xf6e329,product_code:_0x49a2ad,sales_quantity:_0x524ed4,stocks:_0x322605,return_qty:_0x4e63b3,Room_name:_0x3157a0,to_warehouse_name:_0x3369bf,to_Room_name:_0x1cf270,note:_0x335cc0,level:_0x434732,isle:_0x5da048,pallet:_0x4349b9,for_categorize:_0x501cc2}=_0x1b3880[_0x1879d6(0x125)];if(typeof _0x4e83f6=='string')var _0x59b68b=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x118)]],_0x4d3bb7=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x183)]],_0x260685=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x107)]],_0x35627d=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x12c)]],_0x1fbd56=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1f7)]],_0x50a99f=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1a0)]],_0x1352ad=[_0x1b3880['body'][_0x1879d6(0x16b)]],_0x167fd4=[_0x1b3880[_0x1879d6(0x125)]['maxPerUnit']],_0x44e5a4=[_0x1b3880['body'][_0x1879d6(0x206)]],_0x15974f=[_0x1b3880[_0x1879d6(0x125)]['batch_code']],_0x44eab2=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x18c)]],_0x5c61ab=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1e7)]],_0x400abc=[_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1a4)]],_0x2fc7ad=[_0x1b3880['body'][_0x1879d6(0x1d5)]];else var _0x59b68b=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x118)]],_0x4d3bb7=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x183)]],_0x260685=[..._0x1b3880['body'][_0x1879d6(0x107)]],_0x35627d=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x12c)]],_0x1fbd56=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1f7)]],_0x50a99f=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1a0)]],_0x1352ad=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x16b)]],_0x167fd4=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x1e3)]],_0x44e5a4=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x206)]],_0x15974f=[..._0x1b3880[_0x1879d6(0x125)][_0x1879d6(0x209)]],_0x44eab2=[..._0x1b3880[_0x1879d6(0x125)]['secondary_unit']],_0x5c61ab=[..._0x1b3880[_0x1879d6(0x125)]['unit']],_0x400abc=[..._0x1b3880['body'][_0x1879d6(0x1a4)]],_0x2fc7ad=[..._0x1b3880[_0x1879d6(0x125)]['expiry_date']];const _0x10a0f1=_0x59b68b[_0x1879d6(0x1a3)](_0x3b3f0a=>{return _0x3b3f0a={'product_name':_0x3b3f0a};});_0x4d3bb7[_0x1879d6(0x140)]((_0x2a3b9e,_0x4bbe1f)=>{var _0x19ed83=_0x1879d6;_0x10a0f1[_0x4bbe1f][_0x19ed83(0x183)]=_0x2a3b9e;}),_0x260685[_0x1879d6(0x140)]((_0x51e33f,_0xb005f7)=>{var _0x23cfc8=_0x1879d6;_0x10a0f1[_0xb005f7][_0x23cfc8(0x107)]=_0x51e33f;}),_0x35627d[_0x1879d6(0x140)]((_0x157bdf,_0x381851)=>{var _0x190ca0=_0x1879d6;_0x10a0f1[_0x381851][_0x190ca0(0x12c)]=_0x157bdf;}),_0x1fbd56[_0x1879d6(0x140)]((_0x209708,_0x5520b7)=>{_0x10a0f1[_0x5520b7]['sale_qty']=_0x209708;}),_0x50a99f[_0x1879d6(0x140)]((_0x363195,_0x50e27e)=>{var _0x974d9d=_0x1879d6;_0x10a0f1[_0x50e27e][_0x974d9d(0x1a0)]=_0x363195;}),_0x1352ad['forEach']((_0x5dd024,_0x179f22)=>{var _0x3e7117=_0x1879d6;_0x10a0f1[_0x179f22][_0x3e7117(0x16b)]=_0x5dd024;}),_0x167fd4[_0x1879d6(0x140)]((_0x40769b,_0x166d32)=>{var _0x38deba=_0x1879d6;_0x10a0f1[_0x166d32][_0x38deba(0x1e3)]=_0x40769b;}),_0x44e5a4[_0x1879d6(0x140)]((_0x4bcacb,_0x44a0c0)=>{_0x10a0f1[_0x44a0c0]['maxProducts']=_0x4bcacb;}),_0x15974f['forEach']((_0x160274,_0xa6e609)=>{var _0x5a7028=_0x1879d6;_0x10a0f1[_0xa6e609][_0x5a7028(0x209)]=_0x160274;}),_0x44eab2['forEach']((_0x5270f3,_0x46ef73)=>{var _0x2b0004=_0x1879d6;_0x10a0f1[_0x46ef73][_0x2b0004(0x18c)]=_0x5270f3;}),_0x5c61ab[_0x1879d6(0x140)]((_0x4dec31,_0x4ea6ca)=>{var _0x325f92=_0x1879d6;_0x10a0f1[_0x4ea6ca][_0x325f92(0x1e7)]=_0x4dec31;}),_0x400abc['forEach']((_0x4235d7,_0x351139)=>{var _0x107fa9=_0x1879d6;_0x10a0f1[_0x351139][_0x107fa9(0x1a4)]=_0x4235d7;}),_0x2fc7ad[_0x1879d6(0x140)]((_0x396139,_0x48e91a)=>{var _0x4d48dd=_0x1879d6;_0x10a0f1[_0x48e91a][_0x4d48dd(0x1d5)]=_0x396139;});var _0x4ecdfd=0x0;_0x10a0f1[_0x1879d6(0x140)](_0x52a3f7=>{var _0x53e751=_0x1879d6;(parseInt(_0x52a3f7[_0x53e751(0x16e)])<parseInt(_0x52a3f7[_0x53e751(0x1a0)])||parseInt(_0x52a3f7[_0x53e751(0x1ec)])<parseInt(_0x52a3f7[_0x53e751(0x1a0)])&&parseInt(_0x52a3f7[_0x53e751(0x16e)])>parseInt(_0x52a3f7[_0x53e751(0x1a0)])||parseInt(_0x52a3f7[_0x53e751(0x1a0)])==0x0)&&_0x4ecdfd++;});if(_0x4ecdfd!=0x0)return _0x1b3880[_0x1879d6(0x14c)](_0x1879d6(0x1db),_0x1879d6(0x1fd)),_0x5057ec[_0x1879d6(0x179)]('back');const _0x472c7e=await sales_finished['findOne']({'invoice':_0x88aef});_0x472c7e['return_data']=_0x1879d6(0x164);const _0x697bdc=await _0x472c7e[_0x1879d6(0x192)](),_0x52942c=new sales_return_finished({'invoice':_0x88aef,'customer':_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0xfd)],'date':_0x444b58,'warehouse_name':_0x1874d5,'room':_0x3157a0,'ToWarehouse':_0x3369bf,'ToRoom':_0x1cf270,'return_sale':_0x10a0f1,'note':_0x335cc0,'warehouse_cat':_0x501cc2}),_0x1c3573=await _0x52942c[_0x1879d6(0x192)](),_0x67f510=await sales_return_finished[_0x1879d6(0x1f2)]({'invoice':_0x88aef}),_0x3b323b=await warehouse[_0x1879d6(0x1f2)]({'name':_0x3369bf,'room':_0x1cf270,'warehouse_category':_0x1879d6(0x1a5)});_0x67f510[_0x1879d6(0x20e)]['forEach'](_0x5b2493=>{var _0x1e9dab=_0x1879d6,_0x44abae=0x0;const _0x2ff5b6=_0x3b323b[_0x1e9dab(0x147)][_0x1e9dab(0x1a3)](_0x9213a9=>{var _0x41276c=_0x1e9dab;_0x9213a9[_0x41276c(0x118)]==_0x5b2493[_0x41276c(0x118)]&&_0x9213a9[_0x41276c(0x16b)]==_0x5b2493[_0x41276c(0x16b)]&&_0x9213a9[_0x41276c(0x1d5)]==_0x5b2493[_0x41276c(0x1d5)]&&_0x9213a9['production_date']==_0x5b2493[_0x41276c(0x1a4)]&&_0x9213a9[_0x41276c(0x209)]==_0x5b2493[_0x41276c(0x209)]&&(_0x9213a9['product_stock']=parseInt(_0x9213a9[_0x41276c(0x1f1)])+parseInt(_0x5b2493[_0x41276c(0x1a0)]),_0x44abae++);});_0x44abae=='0'&&(_0x3b323b[_0x1e9dab(0x147)]=_0x3b323b[_0x1e9dab(0x147)][_0x1e9dab(0x103)]({'product_name':_0x5b2493['product_name'],'product_stock':_0x5b2493['return_qty'],'primary_code':_0x5b2493[_0x1e9dab(0x183)],'secondary_code':_0x5b2493[_0x1e9dab(0x107)],'product_code':_0x5b2493[_0x1e9dab(0x12c)],'bay':_0x5b2493['bay'],'batch_code':_0x5b2493['batch_code'],'maxPerUnit':_0x5b2493[_0x1e9dab(0x1e3)],'production_date':_0x5b2493[_0x1e9dab(0x1a4)],'expiry_date':_0x5b2493[_0x1e9dab(0x1d5)],'secondary_unit':_0x5b2493[_0x1e9dab(0x18c)],'unit':_0x5b2493[_0x1e9dab(0x1e7)],'maxProducts':_0x5b2493[_0x1e9dab(0x206)]}));}),await _0x3b323b[_0x1879d6(0x192)](),console[_0x1879d6(0x13e)](_0x1b3880[_0x1879d6(0x125)]);const _0x529a11=new c_payment_data({'invoice':_0x88aef,'customer':_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0xfd)],'reason':_0x1879d6(0x201)});await _0x529a11[_0x1879d6(0x192)]();const _0x24802f=await master_shop[_0x1879d6(0x1b2)]();console['log'](_0x1879d6(0x1c9),_0x24802f[0x0][_0x1879d6(0x1d4)]);const _0x5d0d25=await email_settings[_0x1879d6(0x1f2)](),_0x43fd96=await customer[_0x1879d6(0x1f2)]({'name':_0x1b3880[_0x1879d6(0x125)][_0x1879d6(0xfd)]});console[_0x1879d6(0x13e)](_0x1879d6(0x1b5),_0x43fd96);_0x24802f[0x0][_0x1879d6(0x14d)]==0x1?(right_currency=_0x24802f[0x0][_0x1879d6(0x138)],left_currency=''):(right_currency='',left_currency=_0x24802f[0x0]['currency']);var _0x411863=_0x59b68b,_0x9e483=_0x50a99f,_0x8c28a7='',_0x42ab56;for(_0x42ab56 in _0x411863){_0x8c28a7+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x411863[_0x42ab56]+_0x1879d6(0x1bf)+_0x1879d6(0x20b)+_0x9e483[_0x42ab56]+_0x1879d6(0x1bf)+'</tr>';}console[_0x1879d6(0x13e)](_0x1879d6(0x115),_0x8c28a7);let _0x5862a9=nodemailer[_0x1879d6(0x108)]({'service':_0x1879d6(0x20a),'auth':{'user':_0x5d0d25[_0x1879d6(0x166)],'pass':_0x5d0d25[_0x1879d6(0x18b)]}}),_0x20568f={'from':_0x5d0d25['email'],'to':_0x43fd96[_0x1879d6(0x166)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x1879d6(0x141),'path':__dirname+_0x1879d6(0x154)+_0x1879d6(0x17a)+_0x24802f[0x0][_0x1879d6(0x1d4)],'cid':_0x1879d6(0x114)}],'html':_0x1879d6(0x1ee)+_0x1879d6(0x10b)+_0x1879d6(0x180)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x1879d6(0x160)+_0x1879d6(0x1e5)+_0x1879d6(0x1cd)+_0x1879d6(0x1ab)+_0x24802f[0x0][_0x1879d6(0x14a)]+_0x1879d6(0x20d)+'</div>'+_0x1879d6(0x1e5)+_0x1879d6(0x1af)+_0x1879d6(0x1cd)+_0x1879d6(0x1b0)+'\x20Order\x20Number\x20:\x20'+_0x88aef+'\x20'+_0x1879d6(0x1f8)+_0x1879d6(0x165)+_0x444b58+'\x20'+_0x1879d6(0x207)+_0x1879d6(0x101)+_0x1879d6(0x1e5)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1879d6(0x1ba)+'<tr>'+_0x1879d6(0x133)+_0x1879d6(0x132)+_0x1879d6(0x127)+_0x1879d6(0x1f0)+_0x1879d6(0x135)+'</thead>'+_0x1879d6(0x19a)+'\x20'+_0x8c28a7+'\x20'+'</tbody>'+_0x1879d6(0x150)+'<div>'+_0x1879d6(0x1c6)+_0x1879d6(0x15a)+_0x24802f[0x0][_0x1879d6(0x14a)]+'</h5>'+_0x1879d6(0x1e5)+_0x1879d6(0x1e5)+_0x1879d6(0x1e8)};_0x5862a9[_0x1879d6(0x1e6)](_0x20568f,function(_0x5ea0d3,_0xf846c8){var _0xf62e71=_0x1879d6;_0x5ea0d3?(console['log'](_0x5ea0d3),console[_0xf62e71(0x13e)](_0xf62e71(0x1ce))):console[_0xf62e71(0x13e)]('Email\x20sent\x20successfully');}),_0x1b3880[_0x1879d6(0x14c)](_0x1879d6(0x1bd),_0x1879d6(0x1e9)),_0x5057ec[_0x1879d6(0x179)]('/all_sales_finished/view');}catch(_0x4cd4a7){console[_0x1879d6(0x13e)](_0x4cd4a7),_0x5057ec['status'](0xc8)[_0x1879d6(0x172)]({'message1':_0x4cd4a7[_0x1879d6(0x116)]});}}}),router[a0_0x4eaf28(0x1d8)](a0_0x4eaf28(0x119),auth,async(_0x3b0098,_0x1a6bed)=>{var _0x2c82d3=a0_0x4eaf28;try{const {username:_0x27c89a,email:_0x5eb82d,role:_0x5743db}=_0x3b0098['user'],_0x2cf4d9=_0x3b0098['user'],_0x4993bf=await profile[_0x2c82d3(0x1f2)]({'email':_0x2cf4d9[_0x2c82d3(0x166)]}),_0x4600b=await master_shop[_0x2c82d3(0x1b2)]();console[_0x2c82d3(0x13e)](_0x2c82d3(0x1be),_0x4600b);const _0x1f940f=_0x3b0098[_0x2c82d3(0x100)]['id'],_0x2bfa56=await sales[_0x2c82d3(0x1bb)](_0x1f940f);console[_0x2c82d3(0x13e)]('barcode\x20user_id',_0x2bfa56);if(_0x4600b[0x0][_0x2c82d3(0x148)]==_0x2c82d3(0x171))var _0x51324a=users['English'];else{if(_0x4600b[0x0][_0x2c82d3(0x148)]==_0x2c82d3(0x1cb))var _0x51324a=users[_0x2c82d3(0x1cb)];else{if(_0x4600b[0x0][_0x2c82d3(0x148)]==_0x2c82d3(0x1c8))var _0x51324a=users[_0x2c82d3(0x1c8)];else{if(_0x4600b[0x0][_0x2c82d3(0x148)]=='Spanish')var _0x51324a=users[_0x2c82d3(0x194)];else{if(_0x4600b[0x0]['language']==_0x2c82d3(0x18e))var _0x51324a=users[_0x2c82d3(0x18e)];else{if(_0x4600b[0x0]['language']==_0x2c82d3(0xfc))var _0x51324a=users[_0x2c82d3(0x1fb)];else{if(_0x4600b[0x0][_0x2c82d3(0x148)]=='Chinese')var _0x51324a=users[_0x2c82d3(0x16c)];else{if(_0x4600b[0x0][_0x2c82d3(0x148)]==_0x2c82d3(0x1b9))var _0x51324a=users[_0x2c82d3(0x1b3)];}}}}}}}_0x1a6bed[_0x2c82d3(0x1a2)](_0x2c82d3(0x10c),{'success':_0x3b0098[_0x2c82d3(0x14c)](_0x2c82d3(0x1bd)),'errors':_0x3b0098['flash'](_0x2c82d3(0x1db)),'role':_0x2cf4d9,'profile':_0x4993bf,'alldata':_0x2bfa56,'master_shop':_0x4600b,'language':_0x51324a});}catch(_0x219319){console[_0x2c82d3(0x13e)](_0x219319);}}),router[a0_0x4eaf28(0x1ff)]('/barcode_scanner',async(_0x1cc7ba,_0x51d73b)=>{var _0x492027=a0_0x4eaf28;const {product_code:_0x5414ae,warehouse_name:_0x26cd65,rooms_data:_0x2be8a9,Roomslist:_0x45ca82}=_0x1cc7ba['body'],_0x422d2e=_0x45ca82[_0x492027(0x1e2)](','),_0x376b63=[];async function _0x1e3b5a(_0x52cd19){var _0x14d3af=_0x492027;const _0x1649d2=await warehouse['aggregate']([{'$match':{'name':_0x26cd65,'room':_0x52cd19}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x5414ae}},{'$group':{'_id':_0x14d3af(0x14e),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x14d3af(0x143)},'primary_code':{'$first':_0x14d3af(0x1d2)},'secondary_code':{'$first':_0x14d3af(0x17e)},'product_code':{'$first':_0x14d3af(0x110)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x14d3af(0x11c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x14d3af(0x155)},'secondary_unit':{'$first':_0x14d3af(0x170)},'storage':{'$first':_0x14d3af(0x1c0)},'rack':{'$first':_0x14d3af(0x17f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x14d3af(0x1ad)},'batch_code':{'$first':_0x14d3af(0x106)},'product_cat':{'$first':_0x14d3af(0x181)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x14d3af(0x210)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x5a9909=await warehouse['aggregate']([{'$match':{'name':_0x26cd65,'room':_0x52cd19}},{'$unwind':_0x14d3af(0x121)},{'$match':{'product_details.secondary_code':_0x5414ae}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x14d3af(0x122)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x14d3af(0x1d2)},'secondary_code':{'$first':_0x14d3af(0x17e)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x14d3af(0x19f)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x14d3af(0x11c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x14d3af(0x155)},'secondary_unit':{'$first':_0x14d3af(0x170)},'storage':{'$first':_0x14d3af(0x1c0)},'rack':{'$first':_0x14d3af(0x17f)},'expiry_date':{'$first':_0x14d3af(0x198)},'production_date':{'$first':_0x14d3af(0x1f9)},'maxPerUnit':{'$first':_0x14d3af(0x1ad)},'batch_code':{'$first':_0x14d3af(0x106)},'product_cat':{'$first':_0x14d3af(0x181)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x14d3af(0x210)},'invoice':{'$first':_0x14d3af(0x186)}}}]);if(_0x1649d2[_0x14d3af(0x20c)]>0x0)_0x376b63['push'](_0x1649d2);else _0x5a9909['length']>0x0&&_0x376b63[_0x14d3af(0x11a)](_0x5a9909);}const _0x5b5cca=_0x422d2e['map'](_0x27f338=>_0x1e3b5a(_0x27f338));await Promise[_0x492027(0x1ae)](_0x5b5cca),_0x51d73b[_0x492027(0x172)](_0x376b63);}),module[a0_0x4eaf28(0x1f6)]=router;