var a0_0x56a295=a0_0x16a2;(function(_0x151c4e,_0x4c3d3a){var _0x4f3fa4=a0_0x16a2,_0x1094c5=_0x151c4e();while(!![]){try{var _0x54a047=parseInt(_0x4f3fa4(0x2ab))/0x1+-parseInt(_0x4f3fa4(0x249))/0x2+-parseInt(_0x4f3fa4(0x274))/0x3+parseInt(_0x4f3fa4(0x1fe))/0x4+parseInt(_0x4f3fa4(0x228))/0x5*(parseInt(_0x4f3fa4(0x238))/0x6)+parseInt(_0x4f3fa4(0x219))/0x7+parseInt(_0x4f3fa4(0x2ad))/0x8*(-parseInt(_0x4f3fa4(0x278))/0x9);if(_0x54a047===_0x4c3d3a)break;else _0x1094c5['push'](_0x1094c5['shift']());}catch(_0x1a2c72){_0x1094c5['push'](_0x1094c5['shift']());}}}(a0_0x47ed,0xd38f9));const express=require(a0_0x56a295(0x1dc)),app=express(),router=express[a0_0x56a295(0x1d5)](),{profile,master_shop,sales_spmx,invoice_for_outgoing,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x56a295(0x2d7)),auth=require('../middleware/auth'),nodemailer=require('nodemailer'),users=require('../public/language/languages.json'),e=require('connect-flash');router[a0_0x56a295(0x2bd)](a0_0x56a295(0x1b8),auth,async(_0x8a3c2d,_0x11d7fd)=>{var _0x41ca88=a0_0x56a295;try{const {username:_0x2136bd,email:_0x13729b,role:_0x43f98a}=_0x8a3c2d['user'],_0x460aa6=_0x8a3c2d[_0x41ca88(0x220)],_0x3c5615=await profile['findOne']({'email':_0x460aa6[_0x41ca88(0x1d8)]}),_0x3a64b0=await staff[_0x41ca88(0x257)]({'email':_0x460aa6[_0x41ca88(0x1d8)]});if(_0x460aa6[_0x41ca88(0x2cf)]==_0x41ca88(0x2ce)){const _0x1d9d75=await staff[_0x41ca88(0x257)]({'email':_0x460aa6['email']});}const _0x9f641a=await master_shop['find'](),_0x14f986=await sales_spmx['aggregate']([{'$unwind':_0x41ca88(0x1bf)},{'$group':{'_id':_0x41ca88(0x234),'invoice':{'$first':_0x41ca88(0x2a9)},'date':{'$first':'$date'},'finalize':{'$first':'$finalize'},'warehouse_name':{'$first':'$warehouse_name'},'room_spmx':{'$addToSet':_0x41ca88(0x1c2)},'sale_product':{'$push':_0x41ca88(0x1bf)},'note':{'$first':_0x41ca88(0x29f)},'spicemix_spmx_qty':{'$sum':_0x41ca88(0x241)},'extenders_spmx_qty':{'$sum':_0x41ca88(0x265)},'curing_spmx_qty':{'$sum':_0x41ca88(0x214)},'spicemix_spmx':{'$addToSet':'$sale_product.spicemix_spmx'},'extenders_spmx':{'$addToSet':'$sale_product.extenders_spmx'},'curing_spmx':{'$addToSet':_0x41ca88(0x1c0)},'product_code':{'$addToSet':'$sale_product.product_code'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'warehouse_name':0x1,'room_spmx':0x1,'sale_product':0x1,'note':0x1,'spicemix_spmx_qty':0x1,'extenders_spmx_qty':0x1,'curing_spmx_qty':0x1,'spicemix_spmx':0x1,'extenders_spmx':0x1,'curing_spmx':0x1,'product_code':0x1,'finalize':0x1}}]);if(_0x9f641a[0x0][_0x41ca88(0x1d3)]=='English\x20(US)')var _0x351963=users[_0x41ca88(0x216)];else{if(_0x9f641a[0x0]['language']==_0x41ca88(0x201))var _0x351963=users[_0x41ca88(0x201)];else{if(_0x9f641a[0x0]['language']==_0x41ca88(0x1ec))var _0x351963=users[_0x41ca88(0x1ec)];else{if(_0x9f641a[0x0][_0x41ca88(0x1d3)]==_0x41ca88(0x1b4))var _0x351963=users[_0x41ca88(0x1b4)];else{if(_0x9f641a[0x0][_0x41ca88(0x1d3)]==_0x41ca88(0x245))var _0x351963=users[_0x41ca88(0x245)];else{if(_0x9f641a[0x0][_0x41ca88(0x1d3)]==_0x41ca88(0x1c4))var _0x351963=users[_0x41ca88(0x2eb)];else{if(_0x9f641a[0x0]['language']==_0x41ca88(0x1cc))var _0x351963=users['Chinese'];else{if(_0x9f641a[0x0]['language']==_0x41ca88(0x223))var _0x351963=users[_0x41ca88(0x1c1)];}}}}}}}_0x11d7fd['render']('all_sales_finished_spmx',{'success':_0x8a3c2d[_0x41ca88(0x286)](_0x41ca88(0x225)),'errors':_0x8a3c2d['flash']('errors'),'data':_0x14f986,'role':_0x460aa6,'profile':_0x3c5615,'master_shop':_0x9f641a,'language':_0x351963});}catch(_0x53fcdb){console[_0x41ca88(0x1ca)]('table\x20page',_0x53fcdb),_0x11d7fd['status'](0xc8)[_0x41ca88(0x2ea)]({'message':_0x53fcdb[_0x41ca88(0x284)]});}}),router['get']('/view/add_sales_spmx',auth,async(_0x3467ab,_0x2fbd1a)=>{var _0x54b8de=a0_0x56a295;try{const {username:_0x28e7b7,email:_0x2377c8,role:_0x293f6f}=_0x3467ab['user'],_0x177484=_0x3467ab[_0x54b8de(0x220)],_0x2a5553=await profile['findOne']({'email':_0x177484[_0x54b8de(0x1d8)]}),_0x172558=await staff[_0x54b8de(0x257)]({'email':_0x177484['email']});if(_0x177484[_0x54b8de(0x2cf)]=='staff'){const _0x3b6cd4=await staff[_0x54b8de(0x257)]({'email':_0x177484[_0x54b8de(0x1d8)]});}const _0x100a12=await warehouse[_0x54b8de(0x2cc)]([{'$match':{'status':'Enabled','warehouse_category':_0x54b8de(0x236),'name':{'$ne':_0x54b8de(0x2c6)}}},{'$group':{'_id':'$name','name':{'$first':_0x54b8de(0x22e)}}}]),_0x879171=await master_shop[_0x54b8de(0x254)]();if(_0x879171[0x0]['language']==_0x54b8de(0x24f))var _0x4a31cf=users[_0x54b8de(0x216)];else{if(_0x879171[0x0][_0x54b8de(0x1d3)]==_0x54b8de(0x201))var _0x4a31cf=users['Hindi'];else{if(_0x879171[0x0]['language']==_0x54b8de(0x1ec))var _0x4a31cf=users[_0x54b8de(0x1ec)];else{if(_0x879171[0x0]['language']==_0x54b8de(0x1b4))var _0x4a31cf=users[_0x54b8de(0x1b4)];else{if(_0x879171[0x0][_0x54b8de(0x1d3)]==_0x54b8de(0x245))var _0x4a31cf=users['French'];else{if(_0x879171[0x0][_0x54b8de(0x1d3)]==_0x54b8de(0x1c4))var _0x4a31cf=users[_0x54b8de(0x2eb)];else{if(_0x879171[0x0]['language']=='Chinese')var _0x4a31cf=users['Chinese'];else{if(_0x879171[0x0][_0x54b8de(0x1d3)]==_0x54b8de(0x223))var _0x4a31cf=users[_0x54b8de(0x1c1)];}}}}}}}_0x2fbd1a[_0x54b8de(0x247)](_0x54b8de(0x255),{'success':_0x3467ab[_0x54b8de(0x286)](_0x54b8de(0x225)),'errors':_0x3467ab[_0x54b8de(0x286)](_0x54b8de(0x26b)),'role':_0x177484,'profile':_0x2a5553,'master_shop':_0x879171,'warehouse':_0x100a12,'language':_0x4a31cf});}catch(_0x47868d){console['log'](_0x54b8de(0x2b5),_0x47868d),_0x2fbd1a[_0x54b8de(0x1ed)](0xc8)[_0x54b8de(0x2ea)]({'message':_0x47868d['message']});}}),router[a0_0x56a295(0x273)]('/view/add_sales_spmx',auth,async(_0x4c75c2,_0x44a93d)=>{var _0x2b93ca=a0_0x56a295;try{const {date:_0x2e6320,SCRN:_0x75b2a2,PO_number:_0x34d5cd,warehouse_name:_0x234dcd,to_room_name:_0x3f9b73,prod_code:_0x2f658c,note:_0x5d6ac3}=_0x4c75c2['body'];if(typeof _0x2f658c==_0x2b93ca(0x1e8))var _0x16cedb=[_0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x1b3)]],_0x1097e7=[_0x4c75c2['body']['spicemix_spmx']],_0x1beb95=[_0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x2c2)]],_0x256884=[_0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x27e)]],_0x3e6a6b=[_0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x1bd)]],_0x312ccb=[_0x4c75c2[_0x2b93ca(0x230)]['extenders_spmx_qty']],_0x1cf605=[_0x4c75c2[_0x2b93ca(0x230)]['extenders_spmx_qty_stock']],_0xe63ddc=[_0x4c75c2[_0x2b93ca(0x230)]['curing_spmx']],_0x3fdcf2=[_0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x2ba)]],_0x4253cf=[_0x4c75c2['body'][_0x2b93ca(0x1af)]],_0x246def=[_0x4c75c2['body'][_0x2b93ca(0x2e9)]],_0x50ddd0=[_0x4c75c2[_0x2b93ca(0x230)]['unit_spmx']],_0x447726=[_0x4c75c2['body'][_0x2b93ca(0x1cf)]],_0x4421dd=[_0x4c75c2[_0x2b93ca(0x230)]['category_spmx']],_0x2b8ea0=[_0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x2d0)]],_0x385f0b=[_0x4c75c2['body'][_0x2b93ca(0x2d3)]];else var _0x16cedb=[..._0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x1b3)]],_0x1097e7=[..._0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x29a)]],_0x1beb95=[..._0x4c75c2['body']['spicemix_spmx_qty']],_0x256884=[..._0x4c75c2['body']['spicemix_spmx_qty_stock']],_0x3e6a6b=[..._0x4c75c2['body'][_0x2b93ca(0x1bd)]],_0x312ccb=[..._0x4c75c2[_0x2b93ca(0x230)]['extenders_spmx_qty']],_0x1cf605=[..._0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x233)]],_0xe63ddc=[..._0x4c75c2['body']['curing_spmx']],_0x3fdcf2=[..._0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x2ba)]],_0x4253cf=[..._0x4c75c2[_0x2b93ca(0x230)]['curing_spmx_qty_stock']],_0x246def=[..._0x4c75c2['body'][_0x2b93ca(0x2e9)]],_0x50ddd0=[..._0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x1b2)]],_0x447726=[..._0x4c75c2['body']['brand_spmx']],_0x4421dd=[..._0x4c75c2[_0x2b93ca(0x230)]['category_spmx']],_0x2b8ea0=[..._0x4c75c2[_0x2b93ca(0x230)]['out_going_id']],_0x385f0b=[..._0x4c75c2[_0x2b93ca(0x230)][_0x2b93ca(0x2d3)]];const _0x5c1b5d=_0x16cedb['map'](_0x333e25=>{return _0x333e25={'product_code':_0x333e25};});_0x1097e7['forEach']((_0x1737d7,_0x4f4224)=>{_0x5c1b5d[_0x4f4224]['spicemix_spmx']=_0x1737d7;}),_0x1beb95[_0x2b93ca(0x279)]((_0x235646,_0x2fcb5a)=>{var _0x5834db=_0x2b93ca;_0x5c1b5d[_0x2fcb5a][_0x5834db(0x2c2)]=_0x235646;}),_0x256884['forEach']((_0x536e0f,_0x1b6a29)=>{var _0x2fe64f=_0x2b93ca;_0x5c1b5d[_0x1b6a29][_0x2fe64f(0x27e)]=_0x536e0f;}),_0x3e6a6b[_0x2b93ca(0x279)]((_0xbd5b54,_0x1c623a)=>{var _0x2dafec=_0x2b93ca;_0x5c1b5d[_0x1c623a][_0x2dafec(0x1bd)]=_0xbd5b54;}),_0x312ccb[_0x2b93ca(0x279)]((_0x236989,_0x18fbb4)=>{var _0x46e9a3=_0x2b93ca;_0x5c1b5d[_0x18fbb4][_0x46e9a3(0x22f)]=_0x236989;}),_0x1cf605[_0x2b93ca(0x279)]((_0x4f6dad,_0x82d04)=>{var _0x205cee=_0x2b93ca;_0x5c1b5d[_0x82d04][_0x205cee(0x233)]=_0x4f6dad;}),_0xe63ddc[_0x2b93ca(0x279)]((_0xf8a3d8,_0x25a870)=>{var _0xd0f59=_0x2b93ca;_0x5c1b5d[_0x25a870][_0xd0f59(0x1d1)]=_0xf8a3d8;}),_0x3fdcf2[_0x2b93ca(0x279)]((_0x54845b,_0x13b1ea)=>{var _0x3fad54=_0x2b93ca;_0x5c1b5d[_0x13b1ea][_0x3fad54(0x2ba)]=_0x54845b;}),_0x4253cf[_0x2b93ca(0x279)]((_0x1237c5,_0x430afd)=>{var _0x1aa3f7=_0x2b93ca;_0x5c1b5d[_0x430afd][_0x1aa3f7(0x1af)]=_0x1237c5;}),_0x246def[_0x2b93ca(0x279)]((_0x2c0599,_0x12ee8a)=>{var _0x1ad216=_0x2b93ca;_0x5c1b5d[_0x12ee8a][_0x1ad216(0x2e9)]=_0x2c0599;}),_0x50ddd0[_0x2b93ca(0x279)]((_0x436031,_0x21c0df)=>{var _0x1f06d2=_0x2b93ca;_0x5c1b5d[_0x21c0df][_0x1f06d2(0x1b2)]=_0x436031;}),_0x447726[_0x2b93ca(0x279)]((_0x5544db,_0x2ecb89)=>{_0x5c1b5d[_0x2ecb89]['brand_spmx']=_0x5544db;}),_0x4421dd[_0x2b93ca(0x279)]((_0x1bbb2b,_0x43a4f2)=>{var _0x689667=_0x2b93ca;_0x5c1b5d[_0x43a4f2][_0x689667(0x299)]=_0x1bbb2b;}),_0x2b8ea0[_0x2b93ca(0x279)]((_0x15bda2,_0x5de837)=>{_0x5c1b5d[_0x5de837]['id_transaction_from']=_0x15bda2;}),_0x385f0b[_0x2b93ca(0x279)]((_0x5f485d,_0x3e1aa1)=>{_0x5c1b5d[_0x3e1aa1]['incoming_invoice']=_0x5f485d;});const _0x10eb0a=new invoice_for_outgoing();await _0x10eb0a[_0x2b93ca(0x295)]();const _0x285b9d=new sales_spmx({'invoice':_0x2b93ca(0x264)+_0x10eb0a['invoice_init'][_0x2b93ca(0x206)]()[_0x2b93ca(0x277)](0x8,'0'),'date':_0x2e6320,'warehouse_name':_0x234dcd,'sale_product':_0x5c1b5d,'note':_0x5d6ac3,'POnumber':_0x34d5cd,'SCRN':_0x75b2a2}),_0x12b68b=await _0x285b9d[_0x2b93ca(0x295)]();_0x4c75c2[_0x2b93ca(0x286)]('success',_0x2b93ca(0x2a4)),_0x44a93d[_0x2b93ca(0x25f)]('/all_sales_finished/view_sales_spmx/'+_0x12b68b[_0x2b93ca(0x21e)]);}catch(_0x8a3fb5){console[_0x2b93ca(0x1ca)](_0x2b93ca(0x2b5),_0x8a3fb5),_0x44a93d[_0x2b93ca(0x1ed)](0xc8)[_0x2b93ca(0x2ea)]({'message':_0x8a3fb5['message']});}}),router['get'](a0_0x56a295(0x1df),auth,async(_0x4f0ecf,_0x2e876d)=>{var _0x413128=a0_0x56a295;try{const _0x94f6fc=_0x4f0ecf[_0x413128(0x289)]['id'],_0x220279=await sales_spmx['findById'](_0x94f6fc),_0x591e22=await master_shop[_0x413128(0x254)](),_0x38e4c5=_0x4f0ecf[_0x413128(0x220)],_0x1d5464=await profile[_0x413128(0x257)]({'email':_0x38e4c5[_0x413128(0x1d8)]}),_0x1121bc=await staff[_0x413128(0x257)]({'email':_0x38e4c5[_0x413128(0x1d8)]});if(_0x591e22[0x0][_0x413128(0x1d3)]==_0x413128(0x24f))var _0x5d19b0=users['English'];else{if(_0x591e22[0x0][_0x413128(0x1d3)]=='Hindi')var _0x5d19b0=users[_0x413128(0x201)];else{if(_0x591e22[0x0][_0x413128(0x1d3)]==_0x413128(0x1ec))var _0x5d19b0=users[_0x413128(0x1ec)];else{if(_0x591e22[0x0][_0x413128(0x1d3)]==_0x413128(0x1b4))var _0x5d19b0=users[_0x413128(0x1b4)];else{if(_0x591e22[0x0][_0x413128(0x1d3)]==_0x413128(0x245))var _0x5d19b0=users['French'];else{if(_0x591e22[0x0]['language']==_0x413128(0x1c4))var _0x5d19b0=users[_0x413128(0x2eb)];else{if(_0x591e22[0x0][_0x413128(0x1d3)]=='Chinese')var _0x5d19b0=users['Chinese'];else{if(_0x591e22[0x0][_0x413128(0x1d3)]==_0x413128(0x223))var _0x5d19b0=users['Arabic'];}}}}}}}_0x2e876d[_0x413128(0x247)]('view_sales_finished_spmx',{'success':_0x4f0ecf['flash'](_0x413128(0x225)),'errors':_0x4f0ecf[_0x413128(0x286)](_0x413128(0x26b)),'role':_0x38e4c5,'profile':_0x1d5464,'master_shop':_0x591e22,'language':_0x5d19b0,'data':_0x220279});}catch(_0xf753fe){;_0x2e876d[_0x413128(0x1ed)](0xc8)[_0x413128(0x2ea)]({'message':_0xf753fe[_0x413128(0x284)]});}}),router[a0_0x56a295(0x273)](a0_0x56a295(0x1f1),auth,async(_0x4cb9cf,_0x511f70)=>{var _0x1bc5b9=a0_0x56a295;try{const _0x55e28c=_0x4cb9cf[_0x1bc5b9(0x289)]['id'],_0x164e24=await sales_spmx[_0x1bc5b9(0x1c6)](_0x55e28c);_0x164e24[_0x1bc5b9(0x1e6)][_0x1bc5b9(0x279)](async _0x528bed=>{var _0x5bd5b6=_0x1bc5b9;const _0x4b7f15=await warehouse[_0x5bd5b6(0x257)]({'name':_0x164e24[_0x5bd5b6(0x2d2)],'room':_0x528bed[_0x5bd5b6(0x2e9)],'warehouse_category':_0x5bd5b6(0x236),'product_details_spmx._id':_0x528bed[_0x5bd5b6(0x2e7)]});if(_0x4b7f15){const _0x35eed9=_0x4b7f15['product_details_spmx'][_0x5bd5b6(0x254)](_0x3290a6=>_0x3290a6['_id'][_0x5bd5b6(0x206)]()===_0x528bed[_0x5bd5b6(0x2e7)]);_0x35eed9[_0x5bd5b6(0x2c2)]=_0x35eed9[_0x5bd5b6(0x2c2)]-_0x528bed[_0x5bd5b6(0x2c2)],_0x35eed9[_0x5bd5b6(0x22f)]=_0x35eed9['extenders_spmx_qty']-_0x528bed[_0x5bd5b6(0x22f)],_0x35eed9[_0x5bd5b6(0x2ba)]=_0x35eed9[_0x5bd5b6(0x2ba)]-_0x528bed[_0x5bd5b6(0x2ba)],await warehouse['updateOne']({'name':_0x164e24[_0x5bd5b6(0x2d2)],'room':_0x528bed[_0x5bd5b6(0x2e9)],'warehouse_category':'SPMX','product_details_spmx._id':_0x528bed[_0x5bd5b6(0x2e7)]},{'$set':{'product_details_spmx.$.spicemix_spmx_qty':_0x35eed9['spicemix_spmx_qty'],'product_details_spmx.$.extenders_spmx_qty':_0x35eed9[_0x5bd5b6(0x22f)],'product_details_spmx.$.curing_spmx_qty':_0x35eed9[_0x5bd5b6(0x2ba)]}});}}),_0x164e24[_0x1bc5b9(0x2c5)]='True',_0x164e24[_0x1bc5b9(0x295)](),_0x4cb9cf[_0x1bc5b9(0x286)](_0x1bc5b9(0x225),_0x1bc5b9(0x1e1)),_0x511f70[_0x1bc5b9(0x25f)](_0x1bc5b9(0x266)+_0x164e24[_0x1bc5b9(0x21e)]);return;}catch(_0x13d0c8){_0x511f70[_0x1bc5b9(0x2ea)]({'message':_0x13d0c8[_0x1bc5b9(0x284)]});}}),router[a0_0x56a295(0x2bd)](a0_0x56a295(0x2c0),auth,async(_0x3e6043,_0x4bc557)=>{var _0x520dce=a0_0x56a295;try{const {username:_0x4eafdb,email:_0x399f57,role:_0x18cc6a}=_0x3e6043[_0x520dce(0x220)],_0x17726d=_0x3e6043[_0x520dce(0x220)],_0x4dce77=await profile[_0x520dce(0x257)]({'email':_0x17726d[_0x520dce(0x1d8)]}),_0x66ebda=await master_shop[_0x520dce(0x254)]();let _0x33565b;if(_0x17726d['role']==_0x520dce(0x2ce)){const _0x75b676=await staff[_0x520dce(0x257)]({'email':_0x17726d[_0x520dce(0x1d8)]});_0x33565b=await sales_finished['aggregate']([{'$unwind':_0x520dce(0x1bf)},{'$group':{'_id':_0x520dce(0x234),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x520dce(0x1b5)},'date':{'$first':_0x520dce(0x1b0)},'warehouse_name':{'$first':'$warehouse_name'},'note':{'$first':_0x520dce(0x29f)},'return_data':{'$first':'$return_data'},'total_saleproduct_quantity':{'$sum':_0x520dce(0x256)},'level':{'$addToSet':_0x520dce(0x262)},'isle':{'$addToSet':_0x520dce(0x2a0)},'type':{'$addToSet':_0x520dce(0x23e)},'pallet':{'$addToSet':_0x520dce(0x253)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'note':0x1,'return_data':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x33565b=await sales_finished['aggregate']([{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x520dce(0x2a9)},'customers':{'$first':'$customer'},'date':{'$first':_0x520dce(0x1b0)},'warehouse_name':{'$first':_0x520dce(0x2bb)},'note':{'$first':_0x520dce(0x29f)},'return_data':{'$first':_0x520dce(0x1c3)},'total_saleproduct_quantity':{'$sum':_0x520dce(0x256)},'level':{'$addToSet':_0x520dce(0x262)},'isle':{'$addToSet':_0x520dce(0x2a0)},'type':{'$addToSet':_0x520dce(0x23e)},'pallet':{'$addToSet':_0x520dce(0x253)},'finalize':{'$first':_0x520dce(0x1e5)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'note':0x1,'return_data':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x66ebda[0x0]['language']==_0x520dce(0x24f)){var _0x43266a=users[_0x520dce(0x216)];console[_0x520dce(0x1ca)](_0x43266a);}else{if(_0x66ebda[0x0]['language']==_0x520dce(0x201))var _0x43266a=users[_0x520dce(0x201)];else{if(_0x66ebda[0x0][_0x520dce(0x1d3)]==_0x520dce(0x1ec))var _0x43266a=users[_0x520dce(0x1ec)];else{if(_0x66ebda[0x0]['language']==_0x520dce(0x1b4))var _0x43266a=users[_0x520dce(0x1b4)];else{if(_0x66ebda[0x0][_0x520dce(0x1d3)]==_0x520dce(0x245))var _0x43266a=users[_0x520dce(0x245)];else{if(_0x66ebda[0x0][_0x520dce(0x1d3)]==_0x520dce(0x1c4))var _0x43266a=users[_0x520dce(0x2eb)];else{if(_0x66ebda[0x0][_0x520dce(0x1d3)]==_0x520dce(0x1cc))var _0x43266a=users[_0x520dce(0x1cc)];else{if(_0x66ebda[0x0][_0x520dce(0x1d3)]==_0x520dce(0x223))var _0x43266a=users[_0x520dce(0x1c1)];}}}}}}}_0x4bc557['render']('all_sales_finished',{'success':_0x3e6043['flash']('success'),'errors':_0x3e6043[_0x520dce(0x286)]('errors'),'sales':_0x33565b,'profile':_0x4dce77,'role':_0x17726d,'master_shop':_0x66ebda,'language':_0x43266a});}catch(_0x5064d7){console[_0x520dce(0x1ca)](_0x5064d7);}});async function getRandom8DigitNumber(){var _0x41b140=a0_0x56a295;const _0x331ad4=0x989680,_0x4b51b3=0x5f5e0ff,_0x1f9ef9=Math[_0x41b140(0x23b)](Math['random']()*(_0x4b51b3-_0x331ad4+0x1))+_0x331ad4;var _0x186fca;const _0x5810c0=await sales_finished[_0x41b140(0x257)]({'invoice':_0x41b140(0x1ef)+_0x1f9ef9});return _0x5810c0&&_0x5810c0['length']>0x0?_0x186fca=_0x41b140(0x1ef)+_0x1f9ef9:_0x186fca=_0x41b140(0x1ef)+_0x1f9ef9,_0x186fca;}function a0_0x47ed(){var _0xf56eeb=['$product_details.storage','/view/add_sales','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','user','currency','production_date','Arabic\x20(ae)','$product_details_spmx.category_spmx','success','secondary_code','master','5DfVOPC','$room','push','$product_details.room_name','$product_details_spmx.spicemix_spmx_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$name','extenders_spmx_qty','body','\x20Order\x20Number\x20:\x20','barcode\x20Product\x20master','extenders_spmx_qty_stock','$_id','\x20<>\x20','SPMX','sale_qty','7393320IEADNi','</h5>','<span\x20style=\x22float:\x20right;\x22>','floor','$product_details.production_date','False','$sale_product.type','product_stock','payment\x20successfull','$sale_product.spicemix_spmx_qty','$product_details.product_stock','all','Logo.png','French','/upload/','render','/../public','2288160HEEDYp','warehouse','production_date_QA','An\x20error\x20occurred.','<table\x20style=\x22width:\x20100%\x20!important;\x22>','stock','English\x20(US)','currency_placement','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details_spmx.product_code','$sale_product.floorlevel','find','add_sales_finished_spmx','$sale_product.quantity','findOne','product_code','$product_details.unit','$product_details_spmx.brand_spmx','batch_code','primary_unit','maxProducts_QA','<h5>','redirect','</div>','/all_sales_finished/view','$sale_product.bay','<tr>','OUT-','$sale_product.extenders_spmx_qty','/all_sales_finished/view_sales_spmx/','$product_details.type','Sales\x20Mail','</td>','add\x20post','errors','product_details','$product_details_spmx.extenders_spmx_qty','length','password','$product_details_spmx.spicemix_spmx','Ambient','$product_details.secondary_code','post','1802370CpgMjV','all_sales_barcode','date','padStart','9KqhDmp','forEach','DRY\x20GOODS','Return\x20Goods','$product_details_spmx','Error\x20Occurs','spicemix_spmx_qty_stock','purchases_data','$product_details.secondary_unit','<!DOCTYPE\x20html>','error','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','message','return_qty_QA','flash','maxPerUnit','prod_cat','params','then','/barcode_scanner','$product_details.batch_code','edit_sales_finished_view','Sales\x20Update\x20successfully','/all_sales_finished/preview/','primary_code_QA','max','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','maxperunit','save','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','primary_code','$product.product_name','category_spmx','spicemix_spmx','/invoice/:id','getDate','filter','Sale\x20Return\x20Mail','$note','$sale_product.bin','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.bay','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Outgoing\x20Successfully\x20Added\x20but\x20not\x20Finalized','/view/add_sales/:id','quantity','map','$product_details.primary_code','$invoice','product_data','813043gTcNSL','logo','2854672JNeMVj','RoomAssigned','unit_QA','/barcode/:id','barcode\x20user_id','Return\x20Rooms','level','True','table\x20page','/barcode_scanner_spmx','$product_details._id','$product_details_spmx.unit_spmx','sales_quantity_QA','curing_spmx_qty','$warehouse_name','</body></html>','get','</thead>','Enclosed','/view','port','spicemix_spmx_qty','sales_quantity','add_sales_finished','finalize','QA\x20Warehouse','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','final','stocks_QA','aggregate','<div>','staff','role','out_going_id','maxPerUnit_QA','warehouse_name','incoming_invoice','</head><body>','/give_payment/:id','product','../models/all_models','date_data','</tbody>','<tbody\x20style=\x22text-align:\x20center;\x22>','slice','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_name','back','$product_details.product_cat','<strong>\x20Regards\x20</strong>','for_categorize','product_date','$product_details.invoice','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','/view/return_sales/:id','/preview/:id','id_transaction_from','Sale','room_spmx','json','Portuguese','$product_details.expiry_date','createTransport','Finished\x20Goods','$product_details_spmx.extenders_spmx','$product_details.product_name','$product_details.product_code','curing_spmx_qty_stock','$date','$product_details_spmx.curing_spmx','unit_spmx','prod_code','Spanish','$customer','maxProducts','return_sale_QA','/view_spmx','return_data','received_amount','exports','\x20</h2>','extenders_spmx','secondary_unit_QA','$sale_product','$sale_product.curing_spmx','Arabic','$sale_product.room_spmx','$return_data','Portuguese\x20(BR)','secondary_unit','findById','host','carton','$product_details','log','expiry_date_QA','Chinese','customer','</table>','brand_spmx','product_code_QA','curing_spmx','</tr>','language','Sale\x20Return','Router','/all_sales/view','room_name','email','expiry_date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.floorlevel','express','due_amount','$product_details.rack','/view_sales_spmx/:id','$product_details.maxPerUnit','Outgoing\x20Successfully\x20Added\x20and\x20Finalized','</span>','split','<html><head><title></title>','$finalize','sale_product','abs','string','gmail','bay','Enabled','German','status','prod_invoice','OUTF-','Quality\x20Inspection','/process/:id','product_name_QA1','secondary_code_QA','edit_sales_finished','unit','adjust_qty','room','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','image','product_list','return_qty','Sales\x20Add\x20successfully','138032LlwYLy','sales\x20item\x20return\x20successfull','\x20Order\x20Date\x20:\x20','Hindi','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<hr\x20class=\x22my-3\x22>','max_per_unit','toString','suppliers','batch_code_QA','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','site_title','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<h2>\x20','catch','sales_invoice','amount','$product_details.bin','sendMail','out_invoice','$product_details_spmx._id','$sale_product.curing_spmx_qty','/picking_list/pdf/','English','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','6219402ePEHFo','Email\x20sent\x20successfully','/view/:id'];a0_0x47ed=function(){return _0xf56eeb;};return a0_0x47ed();}function a0_0x16a2(_0x5efd64,_0x162270){var _0x47ed0e=a0_0x47ed();return a0_0x16a2=function(_0x16a229,_0x1c9713){_0x16a229=_0x16a229-0x1ac;var _0x498304=_0x47ed0e[_0x16a229];return _0x498304;},a0_0x16a2(_0x5efd64,_0x162270);}router[a0_0x56a295(0x2bd)](a0_0x56a295(0x21d),auth,async(_0x257299,_0x499d88)=>{var _0x35c926=a0_0x56a295;try{const {username:_0x3d94eb,email:_0xa30fa2,role:_0x25ad24}=_0x257299['user'],_0x22464a=_0x257299[_0x35c926(0x220)],_0x2db8b0=await profile['findOne']({'email':_0x22464a[_0x35c926(0x1d8)]}),_0x53eee7=await master_shop['find'](),_0x1b09c3=await customer[_0x35c926(0x254)]({});let _0x558199;if(_0x22464a[_0x35c926(0x2cf)]==_0x35c926(0x2ce)){const _0x54a6ec=await staff[_0x35c926(0x257)]({'email':_0x22464a['email']});_0x558199=await warehouse[_0x35c926(0x2cc)]([{'$match':{'status':_0x35c926(0x1eb),'name':_0x54a6ec[_0x35c926(0x24a)],'warehouse_category':_0x35c926(0x2ee),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x35c926(0x22e),'name':{'$first':_0x35c926(0x22e)}}},{'$sort':{'name':0x1}}]);}else _0x558199=await warehouse[_0x35c926(0x2cc)]([{'$match':{'status':_0x35c926(0x1eb),'warehouse_category':_0x35c926(0x2ee),'name':{'$ne':_0x35c926(0x2c6)}}},{'$group':{'_id':_0x35c926(0x22e),'name':{'$first':_0x35c926(0x22e)}}},{'$sort':{'name':0x1}}]);const _0x5baaaf=await product['find']({});var _0x4062c2=[_0x35c926(0x271),_0x35c926(0x2bf)];const _0x39461e=await sales_finished[_0x35c926(0x254)]({}),_0x50c466=_0x39461e[_0x35c926(0x26e)]+0x1,_0x52c7b3='OUTF-'+_0x50c466['toString']()[_0x35c926(0x277)](0x5,'0');if(_0x53eee7[0x0][_0x35c926(0x1d3)]=='English\x20(US)'){var _0x128a2d=users[_0x35c926(0x216)];console[_0x35c926(0x1ca)](_0x128a2d);}else{if(_0x53eee7[0x0][_0x35c926(0x1d3)]=='Hindi')var _0x128a2d=users[_0x35c926(0x201)];else{if(_0x53eee7[0x0][_0x35c926(0x1d3)]==_0x35c926(0x1ec))var _0x128a2d=users[_0x35c926(0x1ec)];else{if(_0x53eee7[0x0]['language']==_0x35c926(0x1b4))var _0x128a2d=users[_0x35c926(0x1b4)];else{if(_0x53eee7[0x0][_0x35c926(0x1d3)]==_0x35c926(0x245))var _0x128a2d=users['French'];else{if(_0x53eee7[0x0]['language']==_0x35c926(0x1c4))var _0x128a2d=users[_0x35c926(0x2eb)];else{if(_0x53eee7[0x0]['language']==_0x35c926(0x1cc))var _0x128a2d=users[_0x35c926(0x1cc)];else{if(_0x53eee7[0x0]['language']==_0x35c926(0x223))var _0x128a2d=users[_0x35c926(0x1c1)];}}}}}}}const _0x3ca06b=getRandom8DigitNumber();_0x3ca06b[_0x35c926(0x28a)](_0x3817ef=>{var _0x489c61=_0x35c926;_0x499d88[_0x489c61(0x247)](_0x489c61(0x2c4),{'success':_0x257299['flash'](_0x489c61(0x225)),'errors':_0x257299['flash']('errors'),'role':_0x22464a,'profile':_0x2db8b0,'customer':_0x1b09c3,'warehouse':_0x558199,'product':_0x5baaaf,'invoice':_0x3817ef,'master_shop':_0x53eee7,'language':_0x128a2d,'rooms_data':_0x4062c2});})[_0x35c926(0x20d)](_0x5b417f=>{var _0x2027f8=_0x35c926;_0x257299[_0x2027f8(0x286)](_0x2027f8(0x26b),_0x2027f8(0x1da)),_0x499d88['redirect']('/all_sales_finished/view');});}catch(_0x4426fc){console[_0x35c926(0x1ca)](_0x4426fc);}}),router[a0_0x56a295(0x2bd)](a0_0x56a295(0x2a5),auth,async(_0x1b47f6,_0x47e851)=>{var _0x214396=a0_0x56a295;try{const _0xaac50b=_0x1b47f6[_0x214396(0x289)]['id'];console[_0x214396(0x1ca)](_0xaac50b);const _0x210627=await product[_0x214396(0x254)](),_0x2ccfde=await purchases[_0x214396(0x2cc)]([{'$match':{'warehouse_name':_0xaac50b}},{'$unwind':'$product'},{'$group':{'_id':_0x214396(0x298)}}]);console[_0x214396(0x1ca)](_0x214396(0x27f),_0x2ccfde),_0x47e851[_0x214396(0x1ed)](0xc8)[_0x214396(0x2ea)]({'purchases_data':_0x2ccfde,'product_data':_0x210627});}catch(_0x310e62){console[_0x214396(0x1ca)](_0x310e62);}}),router['post']('/view/add_sale/product',auth,async(_0x4edf58,_0xd211fb)=>{var _0x43b36c=a0_0x56a295;try{const {warehouse_data:_0x545dac,product_data:_0x2f0af7}=_0x4edf58[_0x43b36c(0x230)];console[_0x43b36c(0x1ca)](_0x4edf58[_0x43b36c(0x230)][_0x43b36c(0x2aa)]);;const _0x19b378=await master_shop[_0x43b36c(0x254)]();console[_0x43b36c(0x1ca)](_0x43b36c(0x227),_0x19b378);const _0x1fa18a=await product['findOne']({'name':_0x2f0af7});console[_0x43b36c(0x1ca)](_0x43b36c(0x2d6),_0x1fa18a);const _0x26efbe=await warehouse['aggregate']([{'$match':{'name':_0x545dac}},{'$unwind':_0x43b36c(0x1c9)},{'$match':{'product_details.product_name':_0x2f0af7}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x43b36c(0x242)}}}]);console[_0x43b36c(0x1ca)]('stock_data',_0x26efbe),_0xd211fb[_0x43b36c(0x1ed)](0xc8)[_0x43b36c(0x2ea)]({'master':_0x19b378,'new_product':_0x1fa18a,'stock_data':_0x26efbe});}catch(_0x43b998){console[_0x43b36c(0x1ca)](_0x43b998);}}),router['post'](a0_0x56a295(0x21d),auth,async(_0x3d743e,_0x4783d8)=>{var _0xafa66b=a0_0x56a295;try{const {invoice:_0x358992,date:_0x350cc6,warehouse_name:_0x1a4d9f,product_name:_0x4db1d2,stock:_0x93fae6,quantity:_0x2b828a,note:_0x4c6d4c,room:_0x3a4905,primary_code:_0x3061a4,secondary_code:_0x36260e,prod_code:_0x231e80,level:_0x2f635a,isle:_0x5b46df,pallet:_0x1ecd36,batch_code:_0x31ea1f,SCRN:_0x343141,expiry_date:_0x2a2df7,mode_transpo:_0x46699d,name_driver:_0x172c9f}=_0x3d743e[_0xafa66b(0x230)];if(typeof _0x4db1d2==_0xafa66b(0x1e8))var _0x19176f=[_0x3d743e[_0xafa66b(0x230)]['product_name']],_0x2f4a23=[_0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x24e)]],_0x4aba9a=[_0x3d743e['body']['carton']],_0x56da79=[_0x3d743e[_0xafa66b(0x230)]['primary_code']],_0x3e430b=[_0x3d743e['body'][_0xafa66b(0x226)]],_0x4a9dac=[_0x3d743e[_0xafa66b(0x230)]['prod_code']],_0x50bf9f=[_0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x2b3)]],_0x47161a=[_0x3d743e['body'][_0xafa66b(0x25c)]],_0xa7650e=[_0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x1c5)]],_0x26c4b1=[_0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x25b)]],_0x51a646=[_0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x1d9)]],_0x4d4626=[_0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x2e2)]],_0x221fc2=[_0x3d743e['body'][_0xafa66b(0x205)]],_0x3e6eba=[_0x3d743e[_0xafa66b(0x230)]['prod_cat']],_0x25515e=[_0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x2ae)]],_0x4c4eeb=[_0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x1ee)]],_0x26dbd8=[_0x3d743e[_0xafa66b(0x230)]['id_transaction_from']];else var _0x19176f=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x2dd)]],_0x2f4a23=[..._0x3d743e['body'][_0xafa66b(0x24e)]],_0x4aba9a=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x1c8)]],_0x56da79=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x297)]],_0x3e430b=[..._0x3d743e[_0xafa66b(0x230)]['secondary_code']],_0x4a9dac=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x1b3)]],_0x50bf9f=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x2b3)]],_0x47161a=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x25c)]],_0xa7650e=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x1c5)]],_0x26c4b1=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x25b)]],_0x51a646=[..._0x3d743e[_0xafa66b(0x230)]['expiry_date']],_0x4d4626=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x2e2)]],_0x221fc2=[..._0x3d743e['body'][_0xafa66b(0x205)]],_0x3e6eba=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x288)]],_0x25515e=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x2ae)]],_0x4c4eeb=[..._0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x1ee)]],_0x26dbd8=[..._0x3d743e['body'][_0xafa66b(0x2e7)]];const _0x5ec390=_0x19176f['map'](_0x3539f6=>{return _0x3539f6={'product_name':_0x3539f6};});_0x2f4a23[_0xafa66b(0x279)]((_0x2f9574,_0x4abbd5)=>{var _0x3c1c6f=_0xafa66b;_0x5ec390[_0x4abbd5][_0x3c1c6f(0x24e)]=_0x2f9574;}),_0x4aba9a[_0xafa66b(0x279)]((_0x2449d1,_0x19effa)=>{var _0xb5fd49=_0xafa66b;_0x5ec390[_0x19effa][_0xb5fd49(0x2a6)]=Math['abs'](_0x2449d1);}),_0x26dbd8[_0xafa66b(0x279)]((_0x476a82,_0x47a8d1)=>{var _0x179a81=_0xafa66b;_0x5ec390[_0x47a8d1][_0x179a81(0x2e7)]=_0x476a82;}),_0x56da79[_0xafa66b(0x279)]((_0x1bf340,_0xc7e196)=>{var _0x4065b3=_0xafa66b;_0x5ec390[_0xc7e196][_0x4065b3(0x297)]=_0x1bf340;}),_0x3e430b['forEach']((_0x1321aa,_0x36f2c6)=>{var _0xb67078=_0xafa66b;_0x5ec390[_0x36f2c6][_0xb67078(0x226)]=_0x1321aa;}),_0x4a9dac[_0xafa66b(0x279)]((_0x2f58e8,_0x57f1f2)=>{var _0x2e8f94=_0xafa66b;_0x5ec390[_0x57f1f2]['product_code']=_0x2f58e8,_0x5ec390[_0x57f1f2][_0x2e8f94(0x2d8)]=_0x350cc6;}),_0x50bf9f['forEach']((_0x5afe09,_0x2d2763)=>{var _0x5d8657=_0xafa66b;_0x5ec390[_0x2d2763][_0x5d8657(0x1ea)]=_0x5afe09;}),_0x47161a['forEach']((_0x5b24a4,_0x116677)=>{_0x5ec390[_0x116677]['unit']=_0x5b24a4;}),_0xa7650e['forEach']((_0x207015,_0xb72eba)=>{var _0x3d30ae=_0xafa66b;_0x5ec390[_0xb72eba][_0x3d30ae(0x1c5)]=_0x207015;}),_0x26c4b1[_0xafa66b(0x279)]((_0x43b1b3,_0xf6fd4f)=>{var _0x45aaa3=_0xafa66b;_0x5ec390[_0xf6fd4f][_0x45aaa3(0x25b)]=_0x43b1b3;}),_0x51a646[_0xafa66b(0x279)]((_0x4823ba,_0x290dee)=>{var _0x180f93=_0xafa66b;_0x5ec390[_0x290dee][_0x180f93(0x1d9)]=_0x4823ba;}),_0x4d4626[_0xafa66b(0x279)]((_0x31aa0f,_0x35d4d7)=>{var _0x27f6a0=_0xafa66b;_0x5ec390[_0x35d4d7][_0x27f6a0(0x222)]=_0x31aa0f;}),_0x221fc2[_0xafa66b(0x279)]((_0x2694db,_0x311b6f)=>{var _0x4742eb=_0xafa66b;_0x5ec390[_0x311b6f][_0x4742eb(0x294)]=_0x2694db;}),_0x3e6eba[_0xafa66b(0x279)]((_0x712878,_0xed5666)=>{_0x5ec390[_0xed5666]['prod_cat']=_0x712878;}),_0x25515e[_0xafa66b(0x279)]((_0x4d26a3,_0x31ec3a)=>{var _0x22116c=_0xafa66b;_0x5ec390[_0x31ec3a][_0x22116c(0x1d7)]=_0x4d26a3;}),_0x4c4eeb[_0xafa66b(0x279)]((_0x310dca,_0x3320c0)=>{var _0x389723=_0xafa66b;_0x5ec390[_0x3320c0][_0x389723(0x292)]=_0x310dca;});var _0x21441a=0x0;_0x5ec390[_0xafa66b(0x279)](_0xb554e1=>{var _0x13569f=_0xafa66b;parseFloat(_0xb554e1[_0x13569f(0x24e)])<parseFloat(_0xb554e1[_0x13569f(0x2a6)])&&parseFloat(_0xb554e1[_0x13569f(0x2a6)])>parseFloat(_0xb554e1[_0x13569f(0x24e)])&&(console[_0x13569f(0x1ca)](_0xb554e1['stock']+_0x13569f(0x235)+_0xb554e1[_0x13569f(0x2a6)]),_0x21441a++);});if(_0x21441a!=0x0)return _0x3d743e['flash'](_0xafa66b(0x26b),_0xafa66b(0x2e4)),_0x4783d8[_0xafa66b(0x25f)](_0xafa66b(0x2de));const _0x6749e7=_0x5ec390[_0xafa66b(0x29d)](_0x439e51=>_0x439e51[_0xafa66b(0x2a6)]!=='0'&&_0x439e51['quantity']!==''),_0x139db7=new sales_finished({'invoice':_0x358992,'customer':_0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x1cd)],'date':_0x350cc6,'warehouse_name':_0x1a4d9f,'sale_product':_0x6749e7,'note':_0x4c6d4c,'room':_0x3a4905,'primary_code':_0x3061a4,'secondary_code':_0x36260e,'prod_code':_0x231e80,'SCRN':_0x343141,'finalize':_0xafa66b(0x23d),'mode_transpo':_0x46699d,'name_driver':_0x172c9f}),_0x5bffc1=await _0x139db7[_0xafa66b(0x295)](),_0x3da26b=await sales_finished[_0xafa66b(0x257)]({'invoice':_0x358992}),_0x43b6d4=new c_payment_data({'invoice':_0x358992,'customer':_0x3d743e[_0xafa66b(0x230)][_0xafa66b(0x1cd)],'reason':_0xafa66b(0x2e8)});await _0x43b6d4[_0xafa66b(0x295)]();const _0x2222a8=await master_shop[_0xafa66b(0x254)](),_0x1a551f=await email_settings[_0xafa66b(0x257)](),_0x10b236=await customer['findOne']({'name':_0x3d743e['body']['customer']});_0x2222a8[0x0][_0xafa66b(0x250)]==0x1?(right_currency=_0x2222a8[0x0][_0xafa66b(0x221)],left_currency=''):(right_currency='',left_currency=_0x2222a8[0x0][_0xafa66b(0x221)]);var _0xa88394=_0x19176f,_0x3abe04=_0x4aba9a,_0x22e2be='',_0x4832b0;for(_0x4832b0 in _0xa88394){_0x22e2be+=_0xafa66b(0x263)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xa88394[_0x4832b0]+_0xafa66b(0x269)+_0xafa66b(0x296)+_0x3abe04[_0x4832b0]+_0xafa66b(0x269)+_0xafa66b(0x1d2);}console[_0xafa66b(0x1ca)](_0xafa66b(0x1fb),_0x22e2be),_0x3d743e[_0xafa66b(0x286)]('success',_0xafa66b(0x1fd)),_0x4783d8[_0xafa66b(0x25f)](_0xafa66b(0x28f)+_0x5bffc1[_0xafa66b(0x21e)]);}catch(_0xe80aa9){console[_0xafa66b(0x1ca)](_0xe80aa9);}}),router['get'](a0_0x56a295(0x2e6),auth,async(_0x5f4a6b,_0x132c21)=>{var _0x17e69e=a0_0x56a295;try{const {username:_0x320c96,email:_0x40a8b6,role:_0x42e346}=_0x5f4a6b[_0x17e69e(0x220)],_0x5b7791=_0x5f4a6b[_0x17e69e(0x220)],_0x1955f9=await profile[_0x17e69e(0x257)]({'email':_0x5b7791['email']}),_0x5bc091=await master_shop[_0x17e69e(0x254)](),_0x3e815e=_0x5f4a6b['params']['id'],_0x5fd0d3=await sales_finished['findById'](_0x3e815e),_0xb23f19=await warehouse[_0x17e69e(0x2cc)]([{'$match':{'name':_0x5fd0d3[_0x17e69e(0x2d2)]}},{'$unwind':_0x17e69e(0x1c9)},{'$group':{'_id':_0x17e69e(0x2b7),'name':{'$first':_0x17e69e(0x1ad)},'product_stock':{'$first':_0x17e69e(0x242)},'bay':{'$first':_0x17e69e(0x2a2)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x17e69e(0x1db)},'primary_code':{'$first':_0x17e69e(0x2a8)},'secondary_code':{'$first':_0x17e69e(0x272)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x17e69e(0x21c)},'rack':{'$first':_0x17e69e(0x1de)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x17e69e(0x23c)},'batch_code':{'$first':_0x17e69e(0x28c)},'room':{'$first':_0x17e69e(0x229)},'room_data':{'$first':_0x17e69e(0x22b)}}}]),_0x1a736f=await customer['find']({});let _0x269d82;if(_0x5b7791[_0x17e69e(0x2cf)]=='staff'){const _0x42c83e=await staff[_0x17e69e(0x257)]({'email':_0x5b7791[_0x17e69e(0x1d8)]});_0x269d82=await warehouse[_0x17e69e(0x2cc)]([{'$match':{'status':'Enabled','name':_0x42c83e[_0x17e69e(0x24a)]}},{'$group':{'_id':_0x17e69e(0x22e),'name':{'$first':_0x17e69e(0x22e)}}}]);}else _0x269d82=await warehouse[_0x17e69e(0x2cc)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x17e69e(0x22e),'name':{'$first':_0x17e69e(0x22e)}}}]);const _0x388ca7=await product[_0x17e69e(0x254)]({});if(_0x5bc091[0x0][_0x17e69e(0x1d3)]==_0x17e69e(0x24f)){var _0x37c38d=users['English'];console[_0x17e69e(0x1ca)](_0x37c38d);}else{if(_0x5bc091[0x0][_0x17e69e(0x1d3)]==_0x17e69e(0x201))var _0x37c38d=users[_0x17e69e(0x201)];else{if(_0x5bc091[0x0]['language']=='German')var _0x37c38d=users[_0x17e69e(0x1ec)];else{if(_0x5bc091[0x0][_0x17e69e(0x1d3)]==_0x17e69e(0x1b4))var _0x37c38d=users[_0x17e69e(0x1b4)];else{if(_0x5bc091[0x0][_0x17e69e(0x1d3)]==_0x17e69e(0x245))var _0x37c38d=users[_0x17e69e(0x245)];else{if(_0x5bc091[0x0][_0x17e69e(0x1d3)]==_0x17e69e(0x1c4))var _0x37c38d=users[_0x17e69e(0x2eb)];else{if(_0x5bc091[0x0][_0x17e69e(0x1d3)]==_0x17e69e(0x1cc))var _0x37c38d=users['Chinese'];else{if(_0x5bc091[0x0][_0x17e69e(0x1d3)]==_0x17e69e(0x223))var _0x37c38d=users[_0x17e69e(0x1c1)];}}}}}}}_0x132c21[_0x17e69e(0x247)](_0x17e69e(0x28d),{'success':_0x5f4a6b['flash'](_0x17e69e(0x225)),'errors':_0x5f4a6b[_0x17e69e(0x286)](_0x17e69e(0x26b)),'role':_0x5b7791,'profile':_0x1955f9,'customer':_0x1a736f,'warehouse':_0x269d82,'product':_0xb23f19,'user':_0x5fd0d3,'master_shop':_0x5bc091,'unit':_0x388ca7,'language':_0x37c38d});}catch(_0x47c7c4){console[_0x17e69e(0x1ca)](_0x47c7c4);}}),router['post']('/preview/:id',auth,async(_0xcab13f,_0x53b18d)=>{var _0x3e8fe4=a0_0x56a295;try{const _0x2c72f5=_0xcab13f[_0x3e8fe4(0x289)]['id'],{invoice:_0x2a208c,warehouse_name:_0x1c686e,room:_0x15437b}=_0xcab13f[_0x3e8fe4(0x230)],_0x46f288=await sales_finished[_0x3e8fe4(0x257)]({'invoice':_0x2a208c}),_0x1b7f21=_0x46f288[_0x3e8fe4(0x1e6)][_0x3e8fe4(0x2a7)](async _0x12d400=>{var _0x1a506a=_0x3e8fe4,_0x2d5506=await warehouse['findOne']({'name':_0x1c686e,'room':_0x12d400[_0x1a506a(0x1d7)],'warehouse_category':'Finished\x20Goods'});const _0x3e4146=_0x2d5506[_0x1a506a(0x26c)]['map'](_0x3f1e78=>{var _0x56b96a=_0x1a506a;if(_0x3f1e78[_0x56b96a(0x2dd)]==_0x12d400['product_name']&&_0x3f1e78[_0x56b96a(0x1ea)]==_0x12d400[_0x56b96a(0x1ea)]&&_0x3f1e78[_0x56b96a(0x1d9)]==_0x12d400['expiry_date']&&_0x3f1e78[_0x56b96a(0x222)]==_0x12d400[_0x56b96a(0x222)]&&_0x3f1e78['batch_code']==_0x12d400[_0x56b96a(0x25b)]&&_0x3f1e78[_0x56b96a(0x21e)]==_0x12d400[_0x56b96a(0x2e7)]){if(_0x3f1e78['product_stock']>0x0){_0x3f1e78[_0x56b96a(0x23f)]=Math[_0x56b96a(0x291)](0x0,Math[_0x56b96a(0x1e7)](_0x3f1e78[_0x56b96a(0x23f)])-Math['abs'](_0x12d400['quantity']));if(_0x3f1e78['out_invoice']==undefined)_0x3f1e78[_0x56b96a(0x212)]=_0x2a208c+'~';else{var _0x391b17=_0x3f1e78[_0x56b96a(0x212)][_0x56b96a(0x1e3)]('~'),_0x3f4b0a='';for(let _0x437d0c=0x0;_0x437d0c<=_0x391b17[_0x56b96a(0x26e)]-0x1;_0x437d0c++){const _0x32a311=_0x391b17[_0x437d0c];_0x32a311[_0x56b96a(0x26e)]>0x0&&(_0x3f4b0a+=_0x32a311+'~');}_0x3f1e78[_0x56b96a(0x212)]=_0x3f4b0a;}}}});return console[_0x1a506a(0x1ca)](_0x2d5506),_0x2d5506;});Promise[_0x3e8fe4(0x243)](_0x1b7f21)[_0x3e8fe4(0x28a)](async _0x3b12e9=>{var _0x177952=_0x3e8fe4;try{for(const _0x2ca431 of _0x3b12e9){await _0x2ca431[_0x177952(0x295)]();}_0x46f288[_0x177952(0x2c5)]=_0x177952(0x2b4);const _0x4a1ae8=await _0x46f288[_0x177952(0x295)](),_0x3810d1=await master_shop[_0x177952(0x254)](),_0x2b4ed7=await email_settings['findOne'](),_0x45afc5=await supervisor_settings[_0x177952(0x254)]();var _0x5502de=_0x46f288[_0x177952(0x1e6)],_0x5c3b86='',_0x4c49e6;for(_0x4c49e6 in _0x5502de){var _0x4719c5='FG';_0x46f288[_0x177952(0x2d2)]==_0x177952(0x27a)&&(_0x4719c5='DG'),_0x5c3b86+=_0x177952(0x263)+_0x177952(0x296)+_0x5502de[_0x4c49e6][_0x177952(0x2dd)]+_0x177952(0x269)+_0x177952(0x296)+_0x5502de[_0x4c49e6][_0x177952(0x258)]+_0x177952(0x269)+_0x177952(0x296)+_0x5502de[_0x4c49e6]['quantity']+_0x177952(0x269)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5502de[_0x4c49e6]['unit']+'</td>'+_0x177952(0x296)+_0x5502de[_0x4c49e6][_0x177952(0x1c5)]+_0x177952(0x269)+_0x177952(0x296)+_0x46f288['warehouse_name']+_0x177952(0x269)+_0x177952(0x296)+_0x5502de[_0x4c49e6]['room_name']+_0x177952(0x269)+_0x177952(0x296)+_0x4719c5+_0x5502de[_0x4c49e6][_0x177952(0x1ea)]+_0x177952(0x269);}let _0x596250=nodemailer[_0x177952(0x2ed)]({'host':_0x2b4ed7[_0x177952(0x1c7)],'port':Number(_0x2b4ed7[_0x177952(0x2c1)]),'secure':![],'auth':{'user':_0x2b4ed7[_0x177952(0x1d8)],'pass':_0x2b4ed7[_0x177952(0x26f)]}}),_0x220d15={'from':_0x2b4ed7[_0x177952(0x1d8)],'to':_0x45afc5[0x0]['FGSEmail'],'subject':_0x177952(0x268),'attachments':[{'filename':'Logo.png','path':__dirname+_0x177952(0x248)+'/upload/'+_0x3810d1[0x0][_0x177952(0x1fa)],'cid':_0x177952(0x2ac)}],'html':_0x177952(0x281)+_0x177952(0x1e4)+_0x177952(0x2d4)+_0x177952(0x2cd)+_0x177952(0x2a3)+_0x177952(0x2cd)+_0x177952(0x283)+_0x177952(0x260)+'<div>'+_0x177952(0x20c)+_0x3810d1[0x0]['site_title']+'\x20</h2>'+_0x177952(0x260)+_0x177952(0x260)+_0x177952(0x204)+_0x177952(0x2cd)+_0x177952(0x217)+'\x20Order\x20Number\x20:\x20'+_0x46f288[_0x177952(0x292)]+'\x20'+_0x177952(0x23a)+_0x177952(0x200)+_0x46f288[_0x177952(0x276)]+'\x20'+'</span>'+'</h5>'+_0x177952(0x260)+_0x177952(0x24d)+_0x177952(0x2dc)+_0x177952(0x263)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x177952(0x218)+_0x177952(0x209)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x177952(0x21f)+_0x177952(0x203)+_0x177952(0x1f9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x177952(0x2be)+_0x177952(0x2da)+'\x20'+_0x5c3b86+'\x20'+_0x177952(0x2d9)+'</table>'+'<div>'+_0x177952(0x2e0)+_0x177952(0x25e)+_0x3810d1[0x0][_0x177952(0x20a)]+'</h5>'+_0x177952(0x260)+'</div>'+'</body></html>'};_0x596250['sendMail'](_0x220d15,function(_0x34e470,_0x532626){var _0x2d1664=_0x177952;_0x34e470?(console['log'](_0x34e470),console[_0x2d1664(0x1ca)](_0x2d1664(0x27d))):console[_0x2d1664(0x1ca)](_0x2d1664(0x21a));}),_0xcab13f[_0x177952(0x286)](_0x177952(0x225),_0x177952(0x28e)),_0x53b18d[_0x177952(0x25f)](_0x177952(0x215)+_0x2c72f5);}catch(_0x534879){console[_0x177952(0x282)](_0x534879),_0x53b18d[_0x177952(0x1ed)](0x1f4)['json']({'error':_0x177952(0x2a1)});}})[_0x3e8fe4(0x20d)](_0x33cc55=>{var _0x11d50d=_0x3e8fe4;console[_0x11d50d(0x282)](_0x33cc55),_0x53b18d[_0x11d50d(0x1ed)](0x1f4)['json']({'error':_0x11d50d(0x24c)});});}catch(_0x320749){console[_0x3e8fe4(0x1ca)](_0x320749);}}),router[a0_0x56a295(0x2bd)](a0_0x56a295(0x21b),auth,async(_0x1099e1,_0x356790)=>{var _0x549d58=a0_0x56a295;try{const {username:_0x1f473e,email:_0x522ecc,role:_0x377eb9}=_0x1099e1['user'],_0x1af402=_0x1099e1[_0x549d58(0x220)],_0x2fc200=await profile[_0x549d58(0x257)]({'email':_0x1af402[_0x549d58(0x1d8)]}),_0x25e27c=await master_shop['find'](),_0x397264=_0x1099e1[_0x549d58(0x289)]['id'],_0x4784cc=await sales_finished[_0x549d58(0x1c6)](_0x397264);let _0x5e8f36=new Date(_0x4784cc[_0x549d58(0x1d9)]),_0x3f3305=('0'+_0x5e8f36[_0x549d58(0x29c)]())[_0x549d58(0x2db)](-0x2),_0x2a2d7e=('0'+(_0x5e8f36['getMonth']()+0x1))[_0x549d58(0x2db)](-0x2),_0x5c160f=_0x5e8f36['getFullYear'](),_0x1a606a=_0x5c160f+'-'+_0x2a2d7e+'-'+_0x3f3305;var _0x4e04e9=[_0x549d58(0x271),_0x549d58(0x2bf)];const _0x586da4=await warehouse[_0x549d58(0x2cc)]([{'$match':{'name':_0x4784cc[_0x549d58(0x2d2)],'room':_0x4784cc[_0x549d58(0x1f7)]}},{'$unwind':_0x549d58(0x1c9)},{'$group':{'_id':_0x549d58(0x2b7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x549d58(0x242)},'bay':{'$first':_0x549d58(0x2a2)},'bin':{'$first':_0x549d58(0x210)},'type':{'$first':_0x549d58(0x267)},'floorlevel':{'$first':_0x549d58(0x1db)},'primary_code':{'$first':_0x549d58(0x2a8)},'secondary_code':{'$first':_0x549d58(0x272)},'product_code':{'$first':_0x549d58(0x1ae)},'storage':{'$first':_0x549d58(0x21c)},'rack':{'$first':_0x549d58(0x1de)}}}]),_0x5588c4=await customer[_0x549d58(0x254)]({});let _0xc9249b;if(_0x1af402[_0x549d58(0x2cf)]==_0x549d58(0x2ce)){const _0x5383b7=await staff[_0x549d58(0x257)]({'email':_0x1af402['email']});_0xc9249b=await warehouse[_0x549d58(0x2cc)]([{'$match':{'status':_0x549d58(0x1eb),'name':_0x5383b7[_0x549d58(0x24a)]}},{'$group':{'_id':_0x549d58(0x22e),'name':{'$first':_0x549d58(0x22e)}}}]);}else _0xc9249b=await warehouse[_0x549d58(0x2cc)]([{'$match':{'status':_0x549d58(0x1eb)}},{'$group':{'_id':'$name','name':{'$first':_0x549d58(0x22e)}}}]);const _0x3cfb91=await product[_0x549d58(0x254)]({});if(_0x25e27c[0x0][_0x549d58(0x1d3)]==_0x549d58(0x24f)){var _0x464808=users[_0x549d58(0x216)];console[_0x549d58(0x1ca)](_0x464808);}else{if(_0x25e27c[0x0][_0x549d58(0x1d3)]=='Hindi')var _0x464808=users['Hindi'];else{if(_0x25e27c[0x0][_0x549d58(0x1d3)]==_0x549d58(0x1ec))var _0x464808=users[_0x549d58(0x1ec)];else{if(_0x25e27c[0x0][_0x549d58(0x1d3)]==_0x549d58(0x1b4))var _0x464808=users[_0x549d58(0x1b4)];else{if(_0x25e27c[0x0]['language']==_0x549d58(0x245))var _0x464808=users[_0x549d58(0x245)];else{if(_0x25e27c[0x0][_0x549d58(0x1d3)]==_0x549d58(0x1c4))var _0x464808=users[_0x549d58(0x2eb)];else{if(_0x25e27c[0x0][_0x549d58(0x1d3)]==_0x549d58(0x1cc))var _0x464808=users['Chinese'];else{if(_0x25e27c[0x0]['language']==_0x549d58(0x223))var _0x464808=users[_0x549d58(0x1c1)];}}}}}}}_0x356790[_0x549d58(0x247)](_0x549d58(0x1f4),{'success':_0x1099e1['flash']('success'),'errors':_0x1099e1[_0x549d58(0x286)](_0x549d58(0x26b)),'role':_0x1af402,'profile':_0x2fc200,'customer':_0x5588c4,'warehouse':_0xc9249b,'product':_0x586da4,'user':_0x4784cc,'master_shop':_0x25e27c,'unit':_0x3cfb91,'language':_0x464808,'rooms_data':_0x4e04e9,'ed_fullDate':_0x1a606a});}catch(_0x54e8be){console[_0x549d58(0x1ca)](_0x54e8be);}}),router[a0_0x56a295(0x273)](a0_0x56a295(0x21b),auth,async(_0x133cd8,_0x3a47f3)=>{var _0x28385d=a0_0x56a295;try{const _0xec50de=_0x133cd8[_0x28385d(0x289)]['id'],_0x58c9f3=await sales_finished[_0x28385d(0x257)]({'_id':_0x133cd8[_0x28385d(0x289)]['id']}),_0x5ba62d=await warehouse['findOne']({'name':_0x58c9f3['warehouse_name'],'room':_0x133cd8[_0x28385d(0x230)][_0x28385d(0x1f7)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x22083e,customer:_0x258e72,date:_0xddeb0f,warehouse_name:_0x3316ca,product_name:_0x1ddee6,stock:_0x57178b,adjust_qty:_0x531005,note:_0x119bab,room:_0x17d5fb,primary_code:_0x4c4039,secondary_code:_0x20f6a0,prod_code:_0x14ba6d,level:_0x53f3c9,isle:_0x2a656a,pallet:_0x2875fc,expiry_date:_0x31719c}=_0x133cd8[_0x28385d(0x230)];if(typeof _0x1ddee6==_0x28385d(0x1e8))var _0x9551bb=[_0x133cd8[_0x28385d(0x230)][_0x28385d(0x2dd)]],_0x1cb843=[_0x133cd8[_0x28385d(0x230)][_0x28385d(0x24e)]],_0x5444df=[_0x133cd8[_0x28385d(0x230)][_0x28385d(0x1f6)]],_0xe47ea1=[_0x133cd8[_0x28385d(0x230)]['primary_code']],_0x28b04b=[_0x133cd8['body'][_0x28385d(0x226)]],_0x2675f5=[_0x133cd8[_0x28385d(0x230)][_0x28385d(0x1b3)]],_0x13d2f3=[_0x133cd8[_0x28385d(0x230)][_0x28385d(0x2b3)]],_0x3bd8ce=[_0x133cd8[_0x28385d(0x230)]['expiry_date']];else var _0x9551bb=[..._0x133cd8[_0x28385d(0x230)][_0x28385d(0x2dd)]],_0x1cb843=[..._0x133cd8[_0x28385d(0x230)][_0x28385d(0x24e)]],_0x5444df=[..._0x133cd8[_0x28385d(0x230)][_0x28385d(0x1f6)]],_0xe47ea1=[..._0x133cd8[_0x28385d(0x230)][_0x28385d(0x297)]],_0x28b04b=[..._0x133cd8[_0x28385d(0x230)][_0x28385d(0x226)]],_0x2675f5=[..._0x133cd8[_0x28385d(0x230)][_0x28385d(0x1b3)]],_0x13d2f3=[..._0x133cd8[_0x28385d(0x230)][_0x28385d(0x2b3)]],_0x3bd8ce=[..._0x133cd8['body']['expiry_date']];const _0x1c4097=_0x9551bb['map'](_0x5df7c8=>{return _0x5df7c8={'product_name':_0x5df7c8};});_0x1cb843[_0x28385d(0x279)]((_0x2b148b,_0x32d033)=>{var _0x4353d8=_0x28385d;_0x1c4097[_0x32d033][_0x4353d8(0x24e)]=_0x2b148b;}),_0x5444df[_0x28385d(0x279)]((_0x7fff4c,_0x3d0624)=>{_0x1c4097[_0x3d0624]['quantity']=_0x7fff4c;}),_0xe47ea1['forEach']((_0x363ac4,_0x2f0fe5)=>{var _0x4173ca=_0x28385d;_0x1c4097[_0x2f0fe5][_0x4173ca(0x297)]=_0x363ac4;}),_0x28b04b['forEach']((_0x46a614,_0x54ca9d)=>{var _0x50ce82=_0x28385d;_0x1c4097[_0x54ca9d][_0x50ce82(0x226)]=_0x46a614;}),_0x2675f5[_0x28385d(0x279)]((_0x36e338,_0x5d71c8)=>{var _0x46fbd4=_0x28385d;_0x1c4097[_0x5d71c8][_0x46fbd4(0x258)]=_0x36e338;}),_0x13d2f3[_0x28385d(0x279)]((_0x8a40fb,_0x3afb62)=>{_0x1c4097[_0x3afb62]['level']=_0x8a40fb;}),_0x3bd8ce['forEach']((_0x3dc2ac,_0x4dd850)=>{var _0x169c52=_0x28385d;_0x1c4097[_0x4dd850][_0x169c52(0x1d9)]=_0x3dc2ac;});var _0x2825db=0x0;_0x1c4097[_0x28385d(0x279)](_0x3faf1e=>{var _0xf3aefe=_0x28385d;console[_0xf3aefe(0x1ca)]('foreach\x20newproduct',_0x3faf1e),(parseInt(_0x3faf1e[_0xf3aefe(0x24e)])<parseInt(_0x3faf1e[_0xf3aefe(0x2a6)])||parseInt(_0x3faf1e[_0xf3aefe(0x2a6)])==0x0)&&_0x2825db++;});if(_0x2825db!=0x0)return _0x133cd8['flash']('errors',_0x28385d(0x20b)),_0x3a47f3['redirect'](_0x28385d(0x2de));_0x58c9f3[_0x28385d(0x1e6)][_0x28385d(0x279)](_0x2382ec=>{var _0x1f058b=_0x28385d;const _0x1960b4=_0x5ba62d[_0x1f058b(0x26c)][_0x1f058b(0x2a7)](_0x14074a=>{var _0x1aa8b4=_0x1f058b;_0x14074a['product_name']==_0x2382ec['product_name']&&_0x14074a[_0x1aa8b4(0x1ea)]==_0x2382ec[_0x1aa8b4(0x1ea)]&&(_0x14074a[_0x1aa8b4(0x23f)]=parseInt(_0x14074a[_0x1aa8b4(0x23f)])+parseInt(_0x2382ec[_0x1aa8b4(0x2a6)]));});}),await _0x5ba62d['save']();const _0x3e1826=_0x1c4097[_0x28385d(0x29d)](_0x5f4111=>_0x5f4111[_0x28385d(0x2a6)]!=='0'&&_0x5f4111[_0x28385d(0x2a6)]!=='');_0x58c9f3[_0x28385d(0x292)]=_0x22083e,_0x58c9f3['customer']=_0x258e72,_0x58c9f3['date']=_0xddeb0f,_0x58c9f3['warehouse_name']=_0x3316ca,_0x58c9f3[_0x28385d(0x1e6)]=_0x3e1826,_0x58c9f3['note']=_0x119bab,_0x58c9f3[_0x28385d(0x1f7)]=_0x17d5fb;const _0x1edfcc=await _0x58c9f3[_0x28385d(0x295)](),_0x287657=await sales_finished[_0x28385d(0x257)]({'_id':_0x133cd8['params']['id']}),_0x3e649d=await warehouse['findOne']({'name':_0x3316ca,'room':_0x17d5fb,'warehouse_category':_0x28385d(0x2ee)});_0x287657[_0x28385d(0x1e6)]['forEach'](_0x183ec7=>{const _0x5bff60=_0x3e649d['product_details']['map'](_0x2190d5=>{var _0x2ffea5=a0_0x16a2;_0x2190d5[_0x2ffea5(0x2dd)]==_0x183ec7[_0x2ffea5(0x2dd)]&&_0x2190d5[_0x2ffea5(0x1ea)]==_0x183ec7[_0x2ffea5(0x1ea)]&&(_0x2190d5[_0x2ffea5(0x23f)]=parseInt(_0x2190d5[_0x2ffea5(0x23f)])-parseInt(_0x183ec7[_0x2ffea5(0x2a6)]));});}),console[_0x28385d(0x1ca)](_0x28385d(0x2ca),_0x3e649d),await _0x3e649d[_0x28385d(0x295)]();const _0x463cfa=await c_payment_data[_0x28385d(0x257)]({'invoice':_0x133cd8['body'][_0x28385d(0x292)]});_0x463cfa[_0x28385d(0x207)]=_0x133cd8[_0x28385d(0x230)][_0x28385d(0x207)],await _0x463cfa[_0x28385d(0x295)](),_0x133cd8[_0x28385d(0x286)](_0x28385d(0x225),_0x28385d(0x28e)),_0x3a47f3[_0x28385d(0x25f)](_0x28385d(0x261));}catch(_0x50b9cc){console[_0x28385d(0x1ca)](_0x50b9cc);}}),router['post'](a0_0x56a295(0x2d5),auth,async(_0x9b16a5,_0x51d2c6)=>{var _0x5b163b=a0_0x56a295;try{const _0x5604d6=_0x9b16a5[_0x5b163b(0x289)]['id'],{invoice:_0x146831,customer:_0x25e669,receivable_amount:_0xf2d7c7,received_amount:_0x576531}=_0x9b16a5['body'],_0x111e93=await sales[_0x5b163b(0x1c6)](_0x5604d6);console['log'](_0x111e93);var _0x7a9ebe=_0xf2d7c7-_0x576531;console[_0x5b163b(0x1ca)](_0x576531),_0x111e93[_0x5b163b(0x1ba)]=parseFloat(_0x576531)+parseFloat(_0x111e93[_0x5b163b(0x1ba)]),_0x111e93[_0x5b163b(0x1dd)]=_0x7a9ebe,console['log'](_0x111e93);const _0x478b95=await _0x111e93[_0x5b163b(0x295)](),_0x40452b=await c_payment_data[_0x5b163b(0x257)]({'invoice':_0x146831});_0x40452b[_0x5b163b(0x20f)]=_0x7a9ebe,await _0x40452b[_0x5b163b(0x295)]();let _0x1afc14=new Date(),_0xb5c6a5=('0'+_0x1afc14[_0x5b163b(0x29c)]())[_0x5b163b(0x2db)](-0x2),_0x21f7d5=('0'+(_0x1afc14[_0x5b163b(0x202)]()+0x1))[_0x5b163b(0x2db)](-0x2),_0x2cf192=_0x1afc14['getFullYear'](),_0x5ed1e5=_0x2cf192+'-'+_0x21f7d5+'-'+_0xb5c6a5;const _0xf6bee1=new customer_payment({'invoice':_0x146831,'date':_0x2cf192+'-'+_0x21f7d5+'-'+_0xb5c6a5,'customer':_0x25e669,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x576531}),_0x19f144=await _0xf6bee1['save']();_0x9b16a5['flash'](_0x5b163b(0x225),_0x5b163b(0x240)),_0x51d2c6['redirect'](_0x5b163b(0x1d6));}catch(_0x24f2bb){console[_0x5b163b(0x1ca)](_0x24f2bb);}}),router[a0_0x56a295(0x2bd)](a0_0x56a295(0x29b),auth,async(_0x4de623,_0x17fd27)=>{var _0x525d60=a0_0x56a295;try{const {username:_0x389912,email:_0x47a6c7,role:_0x5ce5e9}=_0x4de623[_0x525d60(0x220)],_0x4eed69=_0x4de623[_0x525d60(0x220)],_0x256183=await profile[_0x525d60(0x257)]({'email':_0x4eed69[_0x525d60(0x1d8)]}),_0x3ff7b5=await master_shop[_0x525d60(0x254)]();console[_0x525d60(0x1ca)](_0x525d60(0x227),_0x3ff7b5);const _0x9486ba=_0x4de623[_0x525d60(0x289)]['id'],_0x3e3f72=await sales[_0x525d60(0x1c6)](_0x9486ba);console[_0x525d60(0x1ca)](_0x3e3f72);const _0xb7ff54=await customer['findOne']({'name':_0x3e3f72[_0x525d60(0x1cd)]});console[_0x525d60(0x1ca)](_0xb7ff54);if(_0x3ff7b5[0x0]['language']==_0x525d60(0x24f)){var _0x4b8bd6=users['English'];console[_0x525d60(0x1ca)](_0x4b8bd6);}else{if(_0x3ff7b5[0x0][_0x525d60(0x1d3)]=='Hindi')var _0x4b8bd6=users[_0x525d60(0x201)];else{if(_0x3ff7b5[0x0][_0x525d60(0x1d3)]==_0x525d60(0x1ec))var _0x4b8bd6=users['German'];else{if(_0x3ff7b5[0x0][_0x525d60(0x1d3)]=='Spanish')var _0x4b8bd6=users[_0x525d60(0x1b4)];else{if(_0x3ff7b5[0x0][_0x525d60(0x1d3)]==_0x525d60(0x245))var _0x4b8bd6=users[_0x525d60(0x245)];else{if(_0x3ff7b5[0x0][_0x525d60(0x1d3)]=='Portuguese\x20(BR)')var _0x4b8bd6=users[_0x525d60(0x2eb)];else{if(_0x3ff7b5[0x0][_0x525d60(0x1d3)]==_0x525d60(0x1cc))var _0x4b8bd6=users[_0x525d60(0x1cc)];else{if(_0x3ff7b5[0x0][_0x525d60(0x1d3)]==_0x525d60(0x223))var _0x4b8bd6=users[_0x525d60(0x1c1)];}}}}}}}_0x17fd27[_0x525d60(0x247)](_0x525d60(0x20e),{'success':_0x4de623[_0x525d60(0x286)](_0x525d60(0x225)),'errors':_0x4de623[_0x525d60(0x286)](_0x525d60(0x26b)),'role':_0x4eed69,'profile':_0x256183,'master_shop':_0x3ff7b5,'customers':_0xb7ff54,'sales':_0x3e3f72,'language':_0x4b8bd6});}catch(_0x399c73){console[_0x525d60(0x1ca)](_0x399c73);}}),router[a0_0x56a295(0x2bd)](a0_0x56a295(0x2e5),auth,async(_0x52b328,_0x45f336)=>{var _0x42d2c8=a0_0x56a295;try{const {username:_0x3a9ca6,email:_0x357d58,role:_0x1c9e50}=_0x52b328['user'],_0x567514=_0x52b328['user'],_0xf643ea=await profile[_0x42d2c8(0x257)]({'email':_0x567514['email']}),_0x3c0881=await master_shop['find'](),_0x496da0=_0x52b328['params']['id'],_0x105c5f=await sales_finished[_0x42d2c8(0x1c6)](_0x496da0),_0x2f8c99=await warehouse[_0x42d2c8(0x2cc)]([{'$match':{'name':_0x105c5f[_0x42d2c8(0x2d2)]}},{'$unwind':_0x42d2c8(0x1c9)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x42d2c8(0x1ad)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x42d2c8(0x210)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x42d2c8(0x1db)},'primary_code':{'$first':_0x42d2c8(0x2a8)},'secondary_code':{'$first':_0x42d2c8(0x272)},'product_code':{'$first':_0x42d2c8(0x1ae)},'storage':{'$first':_0x42d2c8(0x21c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x42d2c8(0x2ec)},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':_0x42d2c8(0x259)},'secondary_unit':{'$first':_0x42d2c8(0x280)},'maxProducts':{'$first':_0x42d2c8(0x1f8)},'batch_code':{'$first':_0x42d2c8(0x28c)},'maxPerUnit':{'$first':_0x42d2c8(0x1e0)}}}]),_0x189623=await product[_0x42d2c8(0x254)]({}),_0x43b0c6=await warehouse['aggregate']([{'$match':{'status':_0x42d2c8(0x1eb),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x42d2c8(0x27b),'$ne':'Quality\x20Inspection'}}},{'$group':{'_id':_0x42d2c8(0x22e),'name':{'$first':_0x42d2c8(0x22e)}}},{'$sort':{'name':0x1}}]);var _0x25b50a=[_0x42d2c8(0x2b2)];const _0x25ffb0=await warehouse[_0x42d2c8(0x2cc)]([{'$match':{'status':'Enabled','name':_0x42d2c8(0x1f0)}},{'$group':{'_id':_0x42d2c8(0x22e),'name':{'$first':_0x42d2c8(0x22e)}}},{'$sort':{'name':0x1}}]);if(_0x3c0881[0x0][_0x42d2c8(0x1d3)]=='English\x20(US)'){var _0x1100ae=users['English'];console[_0x42d2c8(0x1ca)](_0x1100ae);}else{if(_0x3c0881[0x0][_0x42d2c8(0x1d3)]=='Hindi')var _0x1100ae=users[_0x42d2c8(0x201)];else{if(_0x3c0881[0x0][_0x42d2c8(0x1d3)]==_0x42d2c8(0x1ec))var _0x1100ae=users['German'];else{if(_0x3c0881[0x0][_0x42d2c8(0x1d3)]==_0x42d2c8(0x1b4))var _0x1100ae=users['Spanish'];else{if(_0x3c0881[0x0][_0x42d2c8(0x1d3)]==_0x42d2c8(0x245))var _0x1100ae=users[_0x42d2c8(0x245)];else{if(_0x3c0881[0x0]['language']=='Portuguese\x20(BR)')var _0x1100ae=users['Portuguese'];else{if(_0x3c0881[0x0]['language']==_0x42d2c8(0x1cc))var _0x1100ae=users[_0x42d2c8(0x1cc)];else{if(_0x3c0881[0x0][_0x42d2c8(0x1d3)]=='Arabic\x20(ae)')var _0x1100ae=users[_0x42d2c8(0x1c1)];}}}}}}}_0x45f336[_0x42d2c8(0x247)]('return_sale_finished',{'success':_0x52b328[_0x42d2c8(0x286)](_0x42d2c8(0x225)),'errors':_0x52b328['flash'](_0x42d2c8(0x26b)),'role':_0x567514,'profile':_0xf643ea,'user':_0x105c5f,'stock':_0x2f8c99,'master_shop':_0x3c0881,'unit':_0x189623,'language':_0x1100ae,'warehouses':_0x43b0c6,'rooms':_0x25b50a,'warehouse_QA':_0x25ffb0});}catch(_0x4bf4a0){console[_0x42d2c8(0x1ca)](_0x4bf4a0),_0x45f336[_0x42d2c8(0x1ed)](0xc8)['json']({'message':_0x4bf4a0[_0x42d2c8(0x284)]});}}),router[a0_0x56a295(0x273)](a0_0x56a295(0x2e5),auth,async(_0xe6c431,_0x5d7878)=>{var _0x46e2ab=a0_0x56a295;if(_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x2e1)]=='QA')try{const {invoice:_0x31249e,date:_0x221479,warehouse_name:_0x2dc296,product_name:_0x241323,primary_code:_0xb859c6,secondary_code:_0xf2f33a,product_code:_0x4418ee,sales_quantity:_0x4cc18a,stocks:_0x50bbc5,return_qty:_0x259c26,Room_name:_0x1b0109,to_warehouse_name_QA:_0x469c40,to_Room_name_QA:_0x1d53b2,note:_0x4bcfcd,for_categorize:_0xb9de35,product_name_QA1:_0xcc0ec4}=_0xe6c431[_0x46e2ab(0x230)];if(typeof _0xcc0ec4=='string')var _0x28d3f3=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1f2)]],_0x2ee081=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x290)]],_0x3e93a3=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1f3)]],_0x2d8a0d=[_0xe6c431['body']['product_code_QA']],_0x1c6b81=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x2b9)]],_0xe4104d=[_0xe6c431['body'][_0x46e2ab(0x2cb)]],_0x33b62b=[_0xe6c431[_0x46e2ab(0x230)]['return_qty_QA']],_0x5c97fd=[_0xe6c431['body'][_0x46e2ab(0x2d1)]],_0x366212=[_0xe6c431['body'][_0x46e2ab(0x25d)]],_0x5371d4=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x208)]],_0x1bea30=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1be)]],_0x52b4c1=[_0xe6c431['body']['unit_QA']],_0x26bd37=[_0xe6c431[_0x46e2ab(0x230)]['production_date_QA']],_0x4e9490=[_0xe6c431['body'][_0x46e2ab(0x1cb)]];else var _0x28d3f3=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1f2)]],_0x2ee081=[..._0xe6c431[_0x46e2ab(0x230)]['primary_code_QA']],_0x3e93a3=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1f3)]],_0x2d8a0d=[..._0xe6c431['body'][_0x46e2ab(0x1d0)]],_0x1c6b81=[..._0xe6c431[_0x46e2ab(0x230)]['sales_quantity_QA']],_0xe4104d=[..._0xe6c431['body'][_0x46e2ab(0x2cb)]],_0x33b62b=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x285)]],_0x5c97fd=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x2d1)]],_0x366212=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x25d)]],_0x5371d4=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x208)]],_0x1bea30=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1be)]],_0x52b4c1=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x2af)]],_0x26bd37=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x24b)]],_0x4e9490=[..._0xe6c431[_0x46e2ab(0x230)]['expiry_date_QA']];const _0x45e69e=_0x28d3f3[_0x46e2ab(0x2a7)](_0x8581e1=>{return _0x8581e1={'product_name':_0x8581e1};});_0x2ee081[_0x46e2ab(0x279)]((_0xfd6bc7,_0x1cbc38)=>{var _0x4ba82e=_0x46e2ab;_0x45e69e[_0x1cbc38][_0x4ba82e(0x297)]=_0xfd6bc7;}),_0x3e93a3[_0x46e2ab(0x279)]((_0x1640f2,_0x2d1186)=>{_0x45e69e[_0x2d1186]['secondary_code']=_0x1640f2;}),_0x2d8a0d[_0x46e2ab(0x279)]((_0x3e4d96,_0x3ad927)=>{var _0x7d2fe7=_0x46e2ab;_0x45e69e[_0x3ad927][_0x7d2fe7(0x258)]=_0x3e4d96;}),_0x1c6b81['forEach']((_0x2d8960,_0x3cd38e)=>{var _0x1e88cf=_0x46e2ab;_0x45e69e[_0x3cd38e][_0x1e88cf(0x237)]=_0x2d8960;}),_0xe4104d['forEach']((_0x5e0f7e,_0x393327)=>{var _0x291799=_0x46e2ab;_0x45e69e[_0x393327][_0x291799(0x24e)]=_0x5e0f7e;}),_0x33b62b[_0x46e2ab(0x279)]((_0x1f3dfc,_0x4c5929)=>{_0x45e69e[_0x4c5929]['return_qty']=_0x1f3dfc;}),_0x5c97fd['forEach']((_0x21f83f,_0x5699a0)=>{var _0x529ab5=_0x46e2ab;_0x45e69e[_0x5699a0][_0x529ab5(0x287)]=_0x21f83f;}),_0x366212[_0x46e2ab(0x279)]((_0x55e823,_0x3880a9)=>{_0x45e69e[_0x3880a9]['maxProducts']=_0x55e823;}),_0x5371d4[_0x46e2ab(0x279)]((_0x3383ec,_0x19f1fc)=>{var _0x349875=_0x46e2ab;_0x45e69e[_0x19f1fc][_0x349875(0x25b)]=_0x3383ec;}),_0x1bea30[_0x46e2ab(0x279)]((_0x67a9bb,_0x3681bc)=>{var _0x2f7012=_0x46e2ab;_0x45e69e[_0x3681bc][_0x2f7012(0x1c5)]=_0x67a9bb;}),_0x52b4c1[_0x46e2ab(0x279)]((_0x49a48e,_0x295772)=>{_0x45e69e[_0x295772]['unit']=_0x49a48e;}),_0x26bd37['forEach']((_0x16c837,_0x27e86c)=>{var _0x14f5fc=_0x46e2ab;_0x45e69e[_0x27e86c][_0x14f5fc(0x222)]=_0x16c837;}),_0x4e9490[_0x46e2ab(0x279)]((_0x5c394e,_0x358697)=>{_0x45e69e[_0x358697]['expiry_date']=_0x5c394e;});const _0x178ac1=await sales_finished[_0x46e2ab(0x257)]({'invoice':_0x31249e});_0x178ac1[_0x46e2ab(0x1b9)]=_0x46e2ab(0x2b4);const _0x3937de=await _0x178ac1[_0x46e2ab(0x295)](),_0x4d26b0=new sales_return_finished({'invoice':_0x31249e,'customer':_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1cd)],'date':_0x221479,'warehouse_name':_0x2dc296,'room':_0x1b0109,'ToWarehouse':_0x469c40,'ToRoom':_0x1d53b2,'return_sale_QA':_0x45e69e,'note':_0x4bcfcd,'warehouse_cat':_0xb9de35}),_0x37eb21=await _0x4d26b0[_0x46e2ab(0x295)](),_0x119bd8=await sales_return_finished[_0x46e2ab(0x257)]({'invoice':_0x31249e}),_0x1d7c56=await warehouse[_0x46e2ab(0x257)]({'name':_0x469c40,'room':_0x1d53b2});_0x119bd8[_0x46e2ab(0x1b7)][_0x46e2ab(0x279)](_0x3f3294=>{var _0x3e5d7b=_0x46e2ab,_0x1318c5=0x0;const _0x1c40a9=_0x1d7c56['product_details'][_0x3e5d7b(0x2a7)](_0x2d3808=>{var _0x588e64=_0x3e5d7b;_0x2d3808[_0x588e64(0x2dd)]==_0x3f3294['product_name']&&_0x2d3808[_0x588e64(0x1d9)]==_0x3f3294['expiry_date']&&_0x2d3808[_0x588e64(0x222)]==_0x3f3294[_0x588e64(0x222)]&&_0x2d3808['batch_code']==_0x3f3294[_0x588e64(0x25b)]&&(_0x2d3808[_0x588e64(0x23f)]=parseInt(_0x2d3808[_0x588e64(0x23f)])+parseInt(_0x3f3294[_0x588e64(0x1fc)]),_0x1318c5++);});_0x1318c5=='0'&&(_0x1d7c56[_0x3e5d7b(0x26c)]=_0x1d7c56['product_details'][_0x3e5d7b(0x2c7)]({'product_name':_0x3f3294[_0x3e5d7b(0x2dd)],'product_stock':_0x3f3294[_0x3e5d7b(0x1fc)],'primary_code':_0x3f3294['primary_code'],'secondary_code':_0x3f3294[_0x3e5d7b(0x226)],'product_code':_0x3f3294['product_code'],'batch_code':_0x3f3294['batch_code'],'maxPerUnit':_0x3f3294[_0x3e5d7b(0x287)],'production_date':_0x3f3294[_0x3e5d7b(0x222)],'expiry_date':_0x3f3294['expiry_date'],'secondary_unit':_0x3f3294['secondary_unit'],'unit':_0x3f3294[_0x3e5d7b(0x1f5)],'maxProducts':_0x3f3294[_0x3e5d7b(0x1b6)],'bay':_0x3f3294[_0x3e5d7b(0x1ea)]}));}),await _0x1d7c56['save']();const _0x8c78af=new c_payment_data({'invoice':_0x31249e,'customer':_0xe6c431[_0x46e2ab(0x230)]['customer'],'reason':_0x46e2ab(0x1d4)});await _0x8c78af[_0x46e2ab(0x295)]();const _0x292b68=await master_shop['find'](),_0x1e9da4=await email_settings['findOne'](),_0x4d0459=await customer[_0x46e2ab(0x257)]({'name':_0xe6c431['body'][_0x46e2ab(0x1cd)]});_0x292b68[0x0]['currency_placement']==0x1?(right_currency=_0x292b68[0x0][_0x46e2ab(0x221)],left_currency=''):(right_currency='',left_currency=_0x292b68[0x0][_0x46e2ab(0x221)]);var _0x50d9e5=_0x28d3f3,_0x413c17=_0x33b62b,_0x1514e9='',_0x6d7607;for(_0x6d7607 in _0x50d9e5){_0x1514e9+=_0x46e2ab(0x263)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x50d9e5[_0x6d7607]+_0x46e2ab(0x269)+_0x46e2ab(0x296)+_0x413c17[_0x6d7607]+_0x46e2ab(0x269)+_0x46e2ab(0x1d2);}console[_0x46e2ab(0x1ca)](_0x46e2ab(0x1fb),_0x1514e9);let _0x4b4a02=nodemailer['createTransport']({'service':_0x46e2ab(0x1e9),'auth':{'user':_0x1e9da4[_0x46e2ab(0x1d8)],'pass':_0x1e9da4['password']}}),_0x5a0c15={'from':_0x1e9da4[_0x46e2ab(0x1d8)],'to':_0x4d0459[_0x46e2ab(0x1d8)],'subject':_0x46e2ab(0x29e),'attachments':[{'filename':_0x46e2ab(0x244),'path':__dirname+_0x46e2ab(0x248)+_0x46e2ab(0x246)+_0x292b68[0x0][_0x46e2ab(0x1fa)],'cid':_0x46e2ab(0x2ac)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x46e2ab(0x2d4)+'<div>'+_0x46e2ab(0x2a3)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x46e2ab(0x260)+_0x46e2ab(0x2cd)+_0x46e2ab(0x20c)+_0x292b68[0x0]['site_title']+_0x46e2ab(0x1bc)+'</div>'+'</div>'+_0x46e2ab(0x204)+_0x46e2ab(0x2cd)+_0x46e2ab(0x217)+_0x46e2ab(0x231)+_0x31249e+'\x20'+_0x46e2ab(0x23a)+_0x46e2ab(0x200)+_0x221479+'\x20'+_0x46e2ab(0x1e2)+_0x46e2ab(0x239)+'</div>'+_0x46e2ab(0x24d)+_0x46e2ab(0x2dc)+_0x46e2ab(0x263)+_0x46e2ab(0x293)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x46e2ab(0x1d2)+'</thead>'+_0x46e2ab(0x2da)+'\x20'+_0x1514e9+'\x20'+_0x46e2ab(0x2d9)+_0x46e2ab(0x1ce)+_0x46e2ab(0x2cd)+_0x46e2ab(0x2e0)+_0x46e2ab(0x25e)+_0x292b68[0x0]['site_title']+'</h5>'+_0x46e2ab(0x260)+_0x46e2ab(0x260)+_0x46e2ab(0x2bc)};_0x4b4a02['sendMail'](_0x5a0c15,function(_0x21de96,_0x1c7944){var _0x446f4c=_0x46e2ab;_0x21de96?(console[_0x446f4c(0x1ca)](_0x21de96),console[_0x446f4c(0x1ca)](_0x446f4c(0x27d))):console['log'](_0x446f4c(0x21a));}),_0xe6c431[_0x46e2ab(0x286)](_0x46e2ab(0x225),'sales\x20item\x20return\x20successfull'),_0x5d7878[_0x46e2ab(0x25f)](_0x46e2ab(0x261));}catch(_0x5d4676){_0x5d7878['status'](0xc8)[_0x46e2ab(0x2ea)]({'message1':_0x5d4676[_0x46e2ab(0x284)]});}else{if(_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x2e1)]=='GS')try{const {invoice:_0x4c1b9f,date:_0x235d15,warehouse_name:_0x3a9073,product_name:_0x15c1fb,primary_code:_0x1ad7a2,secondary_code:_0x329b8e,product_code:_0xdc485d,sales_quantity:_0x37d5b0,stocks:_0x9a7ff9,return_qty:_0x3b3ae4,Room_name:_0x2c7ad9,to_warehouse_name:_0x369b82,to_Room_name:_0x9ac53,note:_0x1d1f9d,level:_0x5e6318,isle:_0x1780a1,pallet:_0x34f1bd,for_categorize:_0x62ebe}=_0xe6c431['body'];if(typeof _0x15c1fb=='string')var _0x28d3f3=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x2dd)]],_0x2ee081=[_0xe6c431['body'][_0x46e2ab(0x297)]],_0x3e93a3=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x226)]],_0x2d8a0d=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x258)]],_0x1c6b81=[_0xe6c431[_0x46e2ab(0x230)]['sales_quantity']],_0x33b62b=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1fc)]],_0x2d40d7=[_0xe6c431['body']['bay']],_0x5c97fd=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x287)]],_0x366212=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1b6)]],_0x5371d4=[_0xe6c431['body']['batch_code']],_0x1bea30=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1c5)]],_0x52b4c1=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1f5)]],_0x26bd37=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x222)]],_0x4e9490=[_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1d9)]];else var _0x28d3f3=[..._0xe6c431['body'][_0x46e2ab(0x2dd)]],_0x2ee081=[..._0xe6c431['body'][_0x46e2ab(0x297)]],_0x3e93a3=[..._0xe6c431['body'][_0x46e2ab(0x226)]],_0x2d8a0d=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x258)]],_0x1c6b81=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x2c3)]],_0x33b62b=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1fc)]],_0x2d40d7=[..._0xe6c431[_0x46e2ab(0x230)]['bay']],_0x5c97fd=[..._0xe6c431['body']['maxPerUnit']],_0x366212=[..._0xe6c431[_0x46e2ab(0x230)]['maxProducts']],_0x5371d4=[..._0xe6c431[_0x46e2ab(0x230)]['batch_code']],_0x1bea30=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1c5)]],_0x52b4c1=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1f5)]],_0x26bd37=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x222)]],_0x4e9490=[..._0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1d9)]];const _0x50728c=_0x28d3f3[_0x46e2ab(0x2a7)](_0x2f444a=>{return _0x2f444a={'product_name':_0x2f444a};});_0x2ee081['forEach']((_0x35ae1e,_0x4f7854)=>{var _0x528e27=_0x46e2ab;_0x50728c[_0x4f7854][_0x528e27(0x297)]=_0x35ae1e;}),_0x3e93a3[_0x46e2ab(0x279)]((_0x109e90,_0x33de74)=>{var _0x1ba624=_0x46e2ab;_0x50728c[_0x33de74][_0x1ba624(0x226)]=_0x109e90;}),_0x2d8a0d[_0x46e2ab(0x279)]((_0x5d7aba,_0x237924)=>{var _0x329d4b=_0x46e2ab;_0x50728c[_0x237924][_0x329d4b(0x258)]=_0x5d7aba;}),_0x1c6b81[_0x46e2ab(0x279)]((_0x826b8a,_0xde4f49)=>{var _0x500405=_0x46e2ab;_0x50728c[_0xde4f49][_0x500405(0x237)]=_0x826b8a;}),_0x33b62b['forEach']((_0xc2a0a,_0xf760de)=>{var _0x5ad29d=_0x46e2ab;_0x50728c[_0xf760de][_0x5ad29d(0x1fc)]=_0xc2a0a;}),_0x2d40d7['forEach']((_0x2eeacb,_0x341abd)=>{var _0x61496=_0x46e2ab;_0x50728c[_0x341abd][_0x61496(0x1ea)]=_0x2eeacb;}),_0x5c97fd[_0x46e2ab(0x279)]((_0x5e8ca3,_0x24eb2b)=>{var _0x325bb9=_0x46e2ab;_0x50728c[_0x24eb2b][_0x325bb9(0x287)]=_0x5e8ca3;}),_0x366212[_0x46e2ab(0x279)]((_0x2f10f0,_0x45476b)=>{var _0x3cab54=_0x46e2ab;_0x50728c[_0x45476b][_0x3cab54(0x1b6)]=_0x2f10f0;}),_0x5371d4[_0x46e2ab(0x279)]((_0xe72ada,_0x6b87d1)=>{_0x50728c[_0x6b87d1]['batch_code']=_0xe72ada;}),_0x1bea30[_0x46e2ab(0x279)]((_0x2e8ab1,_0x5b0e4c)=>{_0x50728c[_0x5b0e4c]['secondary_unit']=_0x2e8ab1;}),_0x52b4c1[_0x46e2ab(0x279)]((_0x5974d5,_0x42dd68)=>{var _0x31dfc7=_0x46e2ab;_0x50728c[_0x42dd68][_0x31dfc7(0x1f5)]=_0x5974d5;}),_0x26bd37[_0x46e2ab(0x279)]((_0x5b2396,_0x2402d3)=>{var _0x2d5839=_0x46e2ab;_0x50728c[_0x2402d3][_0x2d5839(0x222)]=_0x5b2396;}),_0x4e9490[_0x46e2ab(0x279)]((_0x5079f9,_0x57351e)=>{var _0x1c3f54=_0x46e2ab;_0x50728c[_0x57351e][_0x1c3f54(0x1d9)]=_0x5079f9;});var _0x4216e6=0x0;_0x50728c['forEach'](_0x47e555=>{var _0x57c614=_0x46e2ab;(parseInt(_0x47e555[_0x57c614(0x237)])<parseInt(_0x47e555[_0x57c614(0x1fc)])||parseInt(_0x47e555[_0x57c614(0x24e)])<parseInt(_0x47e555['return_qty'])&&parseInt(_0x47e555[_0x57c614(0x237)])>parseInt(_0x47e555[_0x57c614(0x1fc)])||parseInt(_0x47e555[_0x57c614(0x1fc)])==0x0)&&_0x4216e6++;});if(_0x4216e6!=0x0)return _0xe6c431[_0x46e2ab(0x286)]('errors',_0x46e2ab(0x251)),_0x5d7878['redirect'](_0x46e2ab(0x2de));const _0x4d8067=await sales_finished[_0x46e2ab(0x257)]({'invoice':_0x4c1b9f});_0x4d8067[_0x46e2ab(0x1b9)]=_0x46e2ab(0x2b4);const _0x48b875=await _0x4d8067[_0x46e2ab(0x295)](),_0x308da8=new sales_return_finished({'invoice':_0x4c1b9f,'customer':_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1cd)],'date':_0x235d15,'warehouse_name':_0x3a9073,'room':_0x2c7ad9,'ToWarehouse':_0x369b82,'ToRoom':_0x9ac53,'return_sale':_0x50728c,'note':_0x1d1f9d,'warehouse_cat':_0x62ebe}),_0x46b31d=await _0x308da8['save'](),_0x152225=await sales_return_finished[_0x46e2ab(0x257)]({'invoice':_0x4c1b9f}),_0x5e4af7=await warehouse[_0x46e2ab(0x257)]({'name':_0x369b82,'room':_0x9ac53,'warehouse_category':_0x46e2ab(0x2ee)});_0x152225['return_sale'][_0x46e2ab(0x279)](_0x1921eb=>{var _0x52d091=_0x46e2ab,_0x3bcdc9=0x0;const _0x157ed0=_0x5e4af7[_0x52d091(0x26c)]['map'](_0x1f2700=>{var _0x2a41c6=_0x52d091;_0x1f2700[_0x2a41c6(0x2dd)]==_0x1921eb['product_name']&&_0x1f2700[_0x2a41c6(0x1ea)]==_0x1921eb['bay']&&_0x1f2700['expiry_date']==_0x1921eb[_0x2a41c6(0x1d9)]&&_0x1f2700[_0x2a41c6(0x222)]==_0x1921eb[_0x2a41c6(0x222)]&&_0x1f2700[_0x2a41c6(0x25b)]==_0x1921eb[_0x2a41c6(0x25b)]&&(_0x1f2700['product_stock']=parseInt(_0x1f2700[_0x2a41c6(0x23f)])+parseInt(_0x1921eb['return_qty']),_0x3bcdc9++);});_0x3bcdc9=='0'&&(_0x5e4af7[_0x52d091(0x26c)]=_0x5e4af7[_0x52d091(0x26c)][_0x52d091(0x2c7)]({'product_name':_0x1921eb[_0x52d091(0x2dd)],'product_stock':_0x1921eb[_0x52d091(0x1fc)],'primary_code':_0x1921eb[_0x52d091(0x297)],'secondary_code':_0x1921eb[_0x52d091(0x226)],'product_code':_0x1921eb[_0x52d091(0x258)],'bay':_0x1921eb[_0x52d091(0x1ea)],'batch_code':_0x1921eb[_0x52d091(0x25b)],'maxPerUnit':_0x1921eb[_0x52d091(0x287)],'production_date':_0x1921eb[_0x52d091(0x222)],'expiry_date':_0x1921eb[_0x52d091(0x1d9)],'secondary_unit':_0x1921eb[_0x52d091(0x1c5)],'unit':_0x1921eb[_0x52d091(0x1f5)],'maxProducts':_0x1921eb[_0x52d091(0x1b6)]}));}),await _0x5e4af7['save'](),console['log'](_0xe6c431[_0x46e2ab(0x230)]);const _0x2de771=new c_payment_data({'invoice':_0x4c1b9f,'customer':_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1cd)],'reason':_0x46e2ab(0x1d4)});await _0x2de771[_0x46e2ab(0x295)]();const _0x3dbda2=await master_shop[_0x46e2ab(0x254)]();console['log'](_0x46e2ab(0x26a),_0x3dbda2[0x0]['image']);const _0x5336da=await email_settings[_0x46e2ab(0x257)](),_0x100353=await customer[_0x46e2ab(0x257)]({'name':_0xe6c431[_0x46e2ab(0x230)][_0x46e2ab(0x1cd)]});console[_0x46e2ab(0x1ca)]('customer_data',_0x100353);_0x3dbda2[0x0][_0x46e2ab(0x250)]==0x1?(right_currency=_0x3dbda2[0x0][_0x46e2ab(0x221)],left_currency=''):(right_currency='',left_currency=_0x3dbda2[0x0]['currency']);var _0x50d9e5=_0x28d3f3,_0x413c17=_0x33b62b,_0x1514e9='',_0x6d7607;for(_0x6d7607 in _0x50d9e5){_0x1514e9+=_0x46e2ab(0x263)+_0x46e2ab(0x296)+_0x50d9e5[_0x6d7607]+_0x46e2ab(0x269)+_0x46e2ab(0x296)+_0x413c17[_0x6d7607]+_0x46e2ab(0x269)+'</tr>';}console[_0x46e2ab(0x1ca)](_0x46e2ab(0x1fb),_0x1514e9);let _0x556ba4=nodemailer[_0x46e2ab(0x2ed)]({'service':_0x46e2ab(0x1e9),'auth':{'user':_0x5336da[_0x46e2ab(0x1d8)],'pass':_0x5336da['password']}}),_0x577902={'from':_0x5336da[_0x46e2ab(0x1d8)],'to':_0x100353[_0x46e2ab(0x1d8)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x46e2ab(0x244),'path':__dirname+_0x46e2ab(0x248)+'/upload/'+_0x3dbda2[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x46e2ab(0x1e4)+'</head><body>'+_0x46e2ab(0x2cd)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x46e2ab(0x2cd)+_0x46e2ab(0x283)+_0x46e2ab(0x260)+_0x46e2ab(0x2cd)+'<h2>\x20'+_0x3dbda2[0x0][_0x46e2ab(0x20a)]+_0x46e2ab(0x1bc)+'</div>'+_0x46e2ab(0x260)+_0x46e2ab(0x204)+_0x46e2ab(0x2cd)+_0x46e2ab(0x217)+'\x20Order\x20Number\x20:\x20'+_0x4c1b9f+'\x20'+_0x46e2ab(0x23a)+_0x46e2ab(0x200)+_0x235d15+'\x20'+'</span>'+'</h5>'+_0x46e2ab(0x260)+_0x46e2ab(0x24d)+_0x46e2ab(0x2dc)+_0x46e2ab(0x263)+_0x46e2ab(0x293)+_0x46e2ab(0x22d)+_0x46e2ab(0x2c9)+_0x46e2ab(0x2c8)+_0x46e2ab(0x1d2)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1514e9+'\x20'+_0x46e2ab(0x2d9)+_0x46e2ab(0x1ce)+_0x46e2ab(0x2cd)+_0x46e2ab(0x2e0)+_0x46e2ab(0x25e)+_0x3dbda2[0x0]['site_title']+_0x46e2ab(0x239)+_0x46e2ab(0x260)+_0x46e2ab(0x260)+_0x46e2ab(0x2bc)};_0x556ba4[_0x46e2ab(0x211)](_0x577902,function(_0x2e337a,_0x2c9698){var _0xee8762=_0x46e2ab;_0x2e337a?(console[_0xee8762(0x1ca)](_0x2e337a),console[_0xee8762(0x1ca)]('Error\x20Occurs')):console[_0xee8762(0x1ca)](_0xee8762(0x21a));}),_0xe6c431['flash'](_0x46e2ab(0x225),_0x46e2ab(0x1ff)),_0x5d7878[_0x46e2ab(0x25f)](_0x46e2ab(0x261));}catch(_0x4c3ac1){console[_0x46e2ab(0x1ca)](_0x4c3ac1),_0x5d7878[_0x46e2ab(0x1ed)](0xc8)[_0x46e2ab(0x2ea)]({'message1':_0x4c3ac1[_0x46e2ab(0x284)]});}}}),router[a0_0x56a295(0x2bd)](a0_0x56a295(0x2b0),auth,async(_0x44d52d,_0x2452dd)=>{var _0x54001b=a0_0x56a295;try{const {username:_0x248575,email:_0x599482,role:_0x74d91e}=_0x44d52d[_0x54001b(0x220)],_0x47e335=_0x44d52d['user'],_0x5db4e1=await profile[_0x54001b(0x257)]({'email':_0x47e335['email']}),_0x125c44=await master_shop[_0x54001b(0x254)]();console['log'](_0x54001b(0x232),_0x125c44);const _0x373f25=_0x44d52d[_0x54001b(0x289)]['id'],_0x1c1758=await sales['findById'](_0x373f25);console[_0x54001b(0x1ca)](_0x54001b(0x2b1),_0x1c1758);if(_0x125c44[0x0]['language']==_0x54001b(0x24f))var _0x12cfcd=users[_0x54001b(0x216)];else{if(_0x125c44[0x0][_0x54001b(0x1d3)]=='Hindi')var _0x12cfcd=users[_0x54001b(0x201)];else{if(_0x125c44[0x0][_0x54001b(0x1d3)]==_0x54001b(0x1ec))var _0x12cfcd=users[_0x54001b(0x1ec)];else{if(_0x125c44[0x0][_0x54001b(0x1d3)]=='Spanish')var _0x12cfcd=users[_0x54001b(0x1b4)];else{if(_0x125c44[0x0]['language']==_0x54001b(0x245))var _0x12cfcd=users['French'];else{if(_0x125c44[0x0]['language']=='Portuguese\x20(BR)')var _0x12cfcd=users[_0x54001b(0x2eb)];else{if(_0x125c44[0x0]['language']=='Chinese')var _0x12cfcd=users['Chinese'];else{if(_0x125c44[0x0]['language']==_0x54001b(0x223))var _0x12cfcd=users[_0x54001b(0x1c1)];}}}}}}}_0x2452dd[_0x54001b(0x247)](_0x54001b(0x275),{'success':_0x44d52d[_0x54001b(0x286)](_0x54001b(0x225)),'errors':_0x44d52d['flash'](_0x54001b(0x26b)),'role':_0x47e335,'profile':_0x5db4e1,'alldata':_0x1c1758,'master_shop':_0x125c44,'language':_0x12cfcd});}catch(_0xf0287a){console['log'](_0xf0287a);}}),router[a0_0x56a295(0x273)](a0_0x56a295(0x28b),async(_0x4da033,_0x301c54)=>{var _0x2342f3=a0_0x56a295;const {product_code:_0x3611ab,warehouse_name:_0x3b25c9,rooms_data:_0x521ff3,Roomslist:_0xc83b0f}=_0x4da033[_0x2342f3(0x230)],_0x4765d8=_0xc83b0f[_0x2342f3(0x1e3)](','),_0x1e623a=[];async function _0x31fbc9(_0x235a67){var _0x275ad7=_0x2342f3;const _0x35c4fc=await warehouse['aggregate']([{'$match':{'name':_0x3b25c9,'room':_0x235a67}},{'$unwind':_0x275ad7(0x1c9)},{'$match':{'product_details.primary_code':_0x3611ab,'product_details.product_stock':{'$gt':0x0}}},{'$group':{'_id':_0x275ad7(0x2b7),'name':{'$first':_0x275ad7(0x1ad)},'product_stock':{'$first':_0x275ad7(0x242)},'primary_code':{'$first':_0x275ad7(0x2a8)},'secondary_code':{'$first':_0x275ad7(0x272)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x275ad7(0x2a2)},'isle':{'$first':_0x275ad7(0x210)},'type':{'$first':_0x275ad7(0x267)},'pallet':{'$first':_0x275ad7(0x1db)},'unit':{'$first':_0x275ad7(0x259)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x275ad7(0x1de)},'expiry_date':{'$first':_0x275ad7(0x2ec)},'production_date':{'$first':_0x275ad7(0x23c)},'maxPerUnit':{'$first':_0x275ad7(0x1e0)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x275ad7(0x229)},'invoice':{'$first':_0x275ad7(0x2e3)}}}]),_0x5d0a9c=await warehouse['aggregate']([{'$match':{'name':_0x3b25c9,'room':_0x235a67}},{'$unwind':_0x275ad7(0x1c9)},{'$match':{'product_details.secondary_code':_0x3611ab}},{'$group':{'_id':_0x275ad7(0x2b7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x275ad7(0x272)},'product_code':{'$first':_0x275ad7(0x1ae)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x275ad7(0x210)},'type':{'$first':_0x275ad7(0x267)},'pallet':{'$first':_0x275ad7(0x1db)},'unit':{'$first':_0x275ad7(0x259)},'secondary_unit':{'$first':_0x275ad7(0x280)},'storage':{'$first':_0x275ad7(0x21c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x275ad7(0x2ec)},'production_date':{'$first':_0x275ad7(0x23c)},'maxPerUnit':{'$first':_0x275ad7(0x1e0)},'batch_code':{'$first':_0x275ad7(0x28c)},'product_cat':{'$first':_0x275ad7(0x2df)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x275ad7(0x229)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x35c4fc[_0x275ad7(0x26e)]>0x0)_0x1e623a['push'](_0x35c4fc);else _0x5d0a9c[_0x275ad7(0x26e)]>0x0&&_0x1e623a['push'](_0x5d0a9c);}const _0x2d369a=_0x4765d8[_0x2342f3(0x2a7)](_0x1611b0=>_0x31fbc9(_0x1611b0));await Promise[_0x2342f3(0x243)](_0x2d369a),_0x301c54['json'](_0x1e623a);}),router[a0_0x56a295(0x273)](a0_0x56a295(0x2b6),async(_0x32121b,_0x5e3ed3)=>{var _0x570bce=a0_0x56a295;const {product_code:_0x207c4c,warehouse_name:_0x44064a,rooms_data:_0x28310c,Roomslist:_0x3c27d9}=_0x32121b[_0x570bce(0x230)];console[_0x570bce(0x1ca)](_0x32121b[_0x570bce(0x230)]);const _0x34e0de=_0x3c27d9['split'](','),_0x5f2823=[];async function _0x529147(_0x1a66ef){var _0x3c02bf=_0x570bce;const _0x397cd7=await warehouse['aggregate']([{'$match':{'name':_0x44064a,'room':_0x1a66ef}},{'$unwind':_0x3c02bf(0x27c)},{'$match':{'product_details_spmx.product_code':_0x207c4c}},{'$group':{'_id':_0x3c02bf(0x213),'spicemix_spmx':{'$first':_0x3c02bf(0x270)},'extenders_spmx':{'$first':_0x3c02bf(0x1ac)},'curing_spmx':{'$first':_0x3c02bf(0x1b1)},'spicemix_spmx_qty':{'$first':_0x3c02bf(0x22c)},'extenders_spmx_qty':{'$first':_0x3c02bf(0x26d)},'curing_spmx_qty':{'$first':'$product_details_spmx.curing_spmx_qty'},'unit_spmx':{'$first':_0x3c02bf(0x2b8)},'brand_spmx':{'$first':_0x3c02bf(0x25a)},'category_spmx':{'$first':_0x3c02bf(0x224)},'roomNamed':{'$first':_0x3c02bf(0x229)},'invoice':{'$first':'$product_details_spmx.inv_incoming'},'product_code_spmx':{'$first':_0x3c02bf(0x252)}}}]);_0x5f2823[_0x3c02bf(0x22a)](_0x397cd7);}const _0x3163b2=_0x34e0de['map'](_0x27a972=>_0x529147(_0x27a972));await Promise[_0x570bce(0x243)](_0x3163b2),_0x5e3ed3[_0x570bce(0x2ea)](_0x5f2823);}),module[a0_0x56a295(0x1bb)]=router;