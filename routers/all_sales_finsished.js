var a0_0x1a596=a0_0x5762;(function(_0xd6ecc1,_0x22491f){var _0x3e66f7=a0_0x5762,_0x409efc=_0xd6ecc1();while(!![]){try{var _0x4363d6=-parseInt(_0x3e66f7(0x2b2))/0x1+parseInt(_0x3e66f7(0x284))/0x2*(parseInt(_0x3e66f7(0x1af))/0x3)+parseInt(_0x3e66f7(0x1c6))/0x4*(parseInt(_0x3e66f7(0x25f))/0x5)+parseInt(_0x3e66f7(0x1d1))/0x6+-parseInt(_0x3e66f7(0x207))/0x7+parseInt(_0x3e66f7(0x29a))/0x8+-parseInt(_0x3e66f7(0x2ab))/0x9*(parseInt(_0x3e66f7(0x2a4))/0xa);if(_0x4363d6===_0x22491f)break;else _0x409efc['push'](_0x409efc['shift']());}catch(_0x32de8f){_0x409efc['push'](_0x409efc['shift']());}}}(a0_0x4926,0xa0460));const express=require(a0_0x1a596(0x1d8)),app=express(),router=express[a0_0x1a596(0x1c7)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x1a596(0x24e)),auth=require(a0_0x1a596(0x27e)),nodemailer=require('nodemailer'),users=require(a0_0x1a596(0x216));function a0_0x4926(){var _0x548867=['gmail','English\x20(US)','string','image','product_list','sale_qty','split','product','primary_unit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','_id','exports','$warehouse_name','Received\x20Payment\x20For\x20Sale','../middleware/auth','get','quantity','/preview/:id','Arabic','adjust_qty','171694edyqyZ','</thead>','slice','$sale_product.quantity','</tbody>','<span\x20style=\x22float:\x20right;\x22>','$date','Portuguese','site_title','level','$sale_product.bay','$product_details.product_cat','$_id','user','FGSEmail','$note','customers','random','DRY\x20GOODS','barcode\x20user_id','return_sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','346224MBbpnS','production_date_QA','$sale_product.type','edit_sales_finished_view','Enabled','master','customer_data','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','forEach','70BaCQDm','secondary_unit','\x20Order\x20Date\x20:\x20','getDate','$product_details','French','$product_details.primary_code','1991718OOuHLA','$product_details.floorlevel','filter','bay','\x20<>\x20','aggregate','sale_product','668845XpzpGG','$room','/view/return_sales/:id','/view','Return\x20Rooms','/view/add_sales','find','product_data','$product_details.room_name','/give_payment/:id','for_categorize','Hindi','$product_details.storage','secondary_unit_QA','final','$product_details.unit','/upload/','Email\x20sent\x20successfully','product_name','primary_code_QA','product_name_QA1','$product_details.product_stock','45zhFlIh','Error\x20Occurs','push','expiry_date','$name','$product_details.bay','body','$product_details.rack','OUTF-','product_stock','port','maxProducts','<div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<tbody\x20style=\x22text-align:\x20center;\x22>','</h5>','stock_data','note','$finalize','production_date','$product','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</head><body>','4wcUPyU','Router','staff','language','/barcode/:id','status','Chinese','prod_invoice','Spanish','<table\x20style=\x22width:\x20100%\x20!important;\x22>','expiry_date_QA','7703670KYIolL','Quality\x20Inspection','False','Finished\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$customers_docs','invoice','express','/view/add_sales/:id','all','maxPerUnit_QA','RoomAssigned','room_name','\x20>>>\x20','suppliers','An\x20error\x20occurred.','secondary_code_QA','save','success','findById','payment\x20successfull','product_code_QA','$sale_product.floorlevel','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','\x20Order\x20Number\x20:\x20','Portuguese\x20(BR)','customers_docs','params','padStart','all_sales_finished','map','name','sales\x20item\x20return\x20successfull','/all_sales/view','<strong>\x20Regards\x20</strong>','$product_details.product_code','$product_details.maxPerUnit','<tr>','date','/barcode_scanner','primary_code','unit_QA','</table>','getFullYear','English','message','redirect','room','Sale\x20Return','$sale_product.bin','/view/:id','sales_quantity_QA','max_per_unit','$product_details.production_date','5981514yfyISF','length','maxProducts_QA','Sales\x20Update\x20successfully','</div>','createTransport','received_amount','Arabic\x20(ae)','$product_details.type','then','/all_sales_finished/preview/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','finalize','<!DOCTYPE\x20html>','prod_cat','../public/language/languages.json','log','warehouse_name','Logo.png','maxPerUnit','return_qty','batch_code_QA','json','$product_details.product_name','QA\x20Warehouse','back','Ambient','getMonth','<html><head><title></title>','render','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','toString','carton','barcode\x20Product\x20master','product_date','\x20==\x20','$sale_product','catch','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','concat','$return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product_code','warehouse','maxperunit','currency_placement','</td>','$product_details.secondary_unit','errors','$customer','$product_details.batch_code','sendMail','sales_invoice','secondary_code','$product_details._id','<h2>\x20','prod_code','findOne','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','logo','stock','currency','$product_details.expiry_date','return_sale_QA','\x20&&\x20','password','role','\x20</h2>','email','German','/../public','../models/all_models','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','add\x20post','/invoice/:id','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','abs','$product_details.secondary_code','product_details','all_sales_barcode','True','stocks_QA','Sale','$product_details.maxProducts','error','<h5>','post','5570065eYyPdA','return_qty_QA','flash','</body></html>','sales_quantity','unit','return_data','/all_sales_finished/view','/picking_list/pdf/','batch_code','$product_details.bin','/view/add_sale/product','Sale\x20Product\x20Mail','</tr>','customer','</span>','<h5\x20style=\x22text-align:\x20left;\x22>'];a0_0x4926=function(){return _0x548867;};return a0_0x4926();}router[a0_0x1a596(0x27f)](a0_0x1a596(0x19c),auth,async(_0x13eb85,_0x5de838)=>{var _0x314267=a0_0x1a596;try{const {username:_0xe3e11c,email:_0x4e54f0,role:_0xaa07cf}=_0x13eb85['user'],_0x35d8d9=_0x13eb85['user'],_0x5daff2=await profile[_0x314267(0x240)]({'email':_0x35d8d9['email']}),_0x3c38d2=await master_shop['find']();let _0x535b83;if(_0x35d8d9[_0x314267(0x249)]==_0x314267(0x1c8)){const _0x5c771b=await staff[_0x314267(0x240)]({'email':_0x35d8d9[_0x314267(0x24b)]});_0x535b83=await sales_finished[_0x314267(0x2b0)]([{'$lookup':{'from':_0x314267(0x294),'localField':_0x314267(0x26d),'foreignField':_0x314267(0x1f0),'as':_0x314267(0x1eb)}},{'$unwind':_0x314267(0x1d6)},{'$unwind':_0x314267(0x22b)},{'$group':{'_id':_0x314267(0x290),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x314267(0x28a)},'warehouse_name':{'$first':_0x314267(0x27c)},'sale_product':{'$push':_0x314267(0x22b)},'note':{'$first':_0x314267(0x293)},'return_data':{'$first':_0x314267(0x22f)},'customers_docs':{'$first':_0x314267(0x1d6)},'total_saleproduct_quantity':{'$sum':_0x314267(0x287)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x314267(0x29c)},'pallet':{'$addToSet':_0x314267(0x1e7)},'finalize':{'$first':_0x314267(0x1c1)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x535b83=await sales_finished[_0x314267(0x2b0)]([{'$lookup':{'from':_0x314267(0x294),'localField':_0x314267(0x26d),'foreignField':_0x314267(0x1f0),'as':_0x314267(0x1eb)}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x314267(0x238)},'date':{'$first':_0x314267(0x28a)},'warehouse_name':{'$first':_0x314267(0x27c)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x314267(0x293)},'return_data':{'$first':_0x314267(0x22f)},'customers_docs':{'$first':_0x314267(0x1d6)},'total_saleproduct_quantity':{'$sum':_0x314267(0x287)},'level':{'$addToSet':_0x314267(0x28e)},'isle':{'$addToSet':_0x314267(0x202)},'type':{'$addToSet':_0x314267(0x29c)},'pallet':{'$addToSet':_0x314267(0x1e7)},'finalize':{'$first':_0x314267(0x1c1)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x3c38d2[0x0]['language']==_0x314267(0x271)){var _0xa69ff0=users[_0x314267(0x1fd)];console[_0x314267(0x217)](_0xa69ff0);}else{if(_0x3c38d2[0x0]['language']=='Hindi')var _0xa69ff0=users[_0x314267(0x1a4)];else{if(_0x3c38d2[0x0][_0x314267(0x1c9)]==_0x314267(0x24c))var _0xa69ff0=users[_0x314267(0x24c)];else{if(_0x3c38d2[0x0][_0x314267(0x1c9)]==_0x314267(0x1ce))var _0xa69ff0=users['Spanish'];else{if(_0x3c38d2[0x0][_0x314267(0x1c9)]=='French')var _0xa69ff0=users[_0x314267(0x2a9)];else{if(_0x3c38d2[0x0]['language']==_0x314267(0x1ea))var _0xa69ff0=users[_0x314267(0x28b)];else{if(_0x3c38d2[0x0][_0x314267(0x1c9)]=='Chinese')var _0xa69ff0=users[_0x314267(0x1cc)];else{if(_0x3c38d2[0x0][_0x314267(0x1c9)]=='Arabic\x20(ae)')var _0xa69ff0=users[_0x314267(0x282)];}}}}}}}_0x5de838[_0x314267(0x224)](_0x314267(0x1ee),{'success':_0x13eb85[_0x314267(0x261)](_0x314267(0x1e3)),'errors':_0x13eb85[_0x314267(0x261)]('errors'),'sales':_0x535b83,'profile':_0x5daff2,'role':_0x35d8d9,'master_shop':_0x3c38d2,'language':_0xa69ff0});}catch(_0x100175){console[_0x314267(0x217)](_0x100175);}});function a0_0x5762(_0x1efe1c,_0x250d56){var _0x4926b3=a0_0x4926();return a0_0x5762=function(_0x576201,_0x595cf7){_0x576201=_0x576201-0x19a;var _0xf80a1e=_0x4926b3[_0x576201];return _0xf80a1e;},a0_0x5762(_0x1efe1c,_0x250d56);}async function getRandom8DigitNumber(){var _0x15449d=a0_0x1a596;const _0x107452=0x989680,_0x376df5=0x5f5e0ff,_0x9f3473=Math['floor'](Math[_0x15449d(0x295)]()*(_0x376df5-_0x107452+0x1))+_0x107452;var _0x1e33ff;const _0x1c2f86=await sales_finished[_0x15449d(0x240)]({'invoice':_0x15449d(0x1b7)+_0x9f3473});return _0x1c2f86&&_0x1c2f86['length']>0x0?_0x1e33ff=_0x15449d(0x1b7)+_0x9f3473:_0x1e33ff='OUTF-'+_0x9f3473,_0x1e33ff;}router[a0_0x1a596(0x27f)](a0_0x1a596(0x19e),auth,async(_0x2b6272,_0x291437)=>{var _0x10bc03=a0_0x1a596;try{const {username:_0x218133,email:_0x169707,role:_0x2ba3dc}=_0x2b6272[_0x10bc03(0x291)],_0x6bc374=_0x2b6272[_0x10bc03(0x291)],_0x167e7b=await profile[_0x10bc03(0x240)]({'email':_0x6bc374['email']}),_0x595190=await master_shop[_0x10bc03(0x19f)](),_0x563fd9=await customer[_0x10bc03(0x19f)]({});let _0x1efc6d;if(_0x6bc374[_0x10bc03(0x249)]==_0x10bc03(0x1c8)){const _0x340f22=await staff['findOne']({'email':_0x6bc374[_0x10bc03(0x24b)]});_0x1efc6d=await warehouse[_0x10bc03(0x2b0)]([{'$match':{'status':_0x10bc03(0x29e),'name':_0x340f22[_0x10bc03(0x232)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x10bc03(0x21f)}}},{'$group':{'_id':'$name','name':{'$first':_0x10bc03(0x1b3)}}},{'$sort':{'name':0x1}}]);}else _0x1efc6d=await warehouse[_0x10bc03(0x2b0)]([{'$match':{'status':_0x10bc03(0x29e),'warehouse_category':_0x10bc03(0x1d4),'name':{'$ne':_0x10bc03(0x21f)}}},{'$group':{'_id':_0x10bc03(0x1b3),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x132999=await product[_0x10bc03(0x19f)]({});var _0x3cc487=[_0x10bc03(0x221),_0x10bc03(0x24f)];const _0x4e905d=await sales_finished['find']({}),_0x2cc56d=_0x4e905d[_0x10bc03(0x208)]+0x1,_0x401ff4=_0x10bc03(0x1b7)+_0x2cc56d[_0x10bc03(0x226)]()[_0x10bc03(0x1ed)](0x5,'0');if(_0x595190[0x0][_0x10bc03(0x1c9)]==_0x10bc03(0x271)){var _0x1cb78b=users[_0x10bc03(0x1fd)];console[_0x10bc03(0x217)](_0x1cb78b);}else{if(_0x595190[0x0][_0x10bc03(0x1c9)]==_0x10bc03(0x1a4))var _0x1cb78b=users[_0x10bc03(0x1a4)];else{if(_0x595190[0x0][_0x10bc03(0x1c9)]==_0x10bc03(0x24c))var _0x1cb78b=users[_0x10bc03(0x24c)];else{if(_0x595190[0x0][_0x10bc03(0x1c9)]=='Spanish')var _0x1cb78b=users[_0x10bc03(0x1ce)];else{if(_0x595190[0x0][_0x10bc03(0x1c9)]==_0x10bc03(0x2a9))var _0x1cb78b=users[_0x10bc03(0x2a9)];else{if(_0x595190[0x0]['language']==_0x10bc03(0x1ea))var _0x1cb78b=users[_0x10bc03(0x28b)];else{if(_0x595190[0x0][_0x10bc03(0x1c9)]==_0x10bc03(0x1cc))var _0x1cb78b=users[_0x10bc03(0x1cc)];else{if(_0x595190[0x0][_0x10bc03(0x1c9)]=='Arabic\x20(ae)')var _0x1cb78b=users[_0x10bc03(0x282)];}}}}}}}const _0x4efb03=getRandom8DigitNumber();_0x4efb03[_0x10bc03(0x210)](_0x393a35=>{var _0x1a0042=_0x10bc03;_0x291437[_0x1a0042(0x224)]('add_sales_finished',{'success':_0x2b6272[_0x1a0042(0x261)](_0x1a0042(0x1e3)),'errors':_0x2b6272[_0x1a0042(0x261)](_0x1a0042(0x237)),'role':_0x6bc374,'profile':_0x167e7b,'customer':_0x563fd9,'warehouse':_0x1efc6d,'product':_0x132999,'invoice':_0x393a35,'master_shop':_0x595190,'language':_0x1cb78b,'rooms_data':_0x3cc487});})[_0x10bc03(0x22c)](_0x2e38ba=>{var _0xec3dda=_0x10bc03;_0x2b6272[_0xec3dda(0x261)](_0xec3dda(0x237),_0xec3dda(0x1c4)),_0x291437[_0xec3dda(0x1ff)](_0xec3dda(0x266));});}catch(_0x188bc5){console['log'](_0x188bc5);}}),router[a0_0x1a596(0x27f)](a0_0x1a596(0x1d9),auth,async(_0x2f68f6,_0x2f2e76)=>{var _0x48f10a=a0_0x1a596;try{const _0x262dae=_0x2f68f6[_0x48f10a(0x1ec)]['id'];console[_0x48f10a(0x217)](_0x262dae);const _0x2788ea=await product[_0x48f10a(0x19f)](),_0x29aad1=await purchases[_0x48f10a(0x2b0)]([{'$match':{'warehouse_name':_0x262dae}},{'$unwind':_0x48f10a(0x1c3)},{'$group':{'_id':'$product.product_name'}}]);console[_0x48f10a(0x217)]('purchases_data',_0x29aad1),_0x2f2e76['status'](0xc8)[_0x48f10a(0x21d)]({'purchases_data':_0x29aad1,'product_data':_0x2788ea});}catch(_0x48b5d9){console[_0x48f10a(0x217)](_0x48b5d9);}}),router[a0_0x1a596(0x25e)](a0_0x1a596(0x26a),auth,async(_0x399ae0,_0x3fb259)=>{var _0x568687=a0_0x1a596;try{const {warehouse_data:_0x15ecf3,product_data:_0x2581bf}=_0x399ae0['body'];console[_0x568687(0x217)](_0x399ae0[_0x568687(0x1b5)][_0x568687(0x1a0)]);;const _0x49457f=await master_shop['find']();console[_0x568687(0x217)]('master',_0x49457f);const _0x3233ce=await product[_0x568687(0x240)]({'name':_0x2581bf});console[_0x568687(0x217)](_0x568687(0x277),_0x3233ce);const _0x5d1ab0=await warehouse[_0x568687(0x2b0)]([{'$match':{'name':_0x15ecf3}},{'$unwind':_0x568687(0x2a8)},{'$match':{'product_details.product_name':_0x2581bf}},{'$group':{'_id':_0x568687(0x21e),'product_stock':{'$first':_0x568687(0x1ae)}}}]);console[_0x568687(0x217)](_0x568687(0x1bf),_0x5d1ab0),_0x3fb259[_0x568687(0x1cb)](0xc8)[_0x568687(0x21d)]({'master':_0x49457f,'new_product':_0x3233ce,'stock_data':_0x5d1ab0});}catch(_0x546d31){console[_0x568687(0x217)](_0x546d31);}}),router['post'](a0_0x1a596(0x19e),auth,async(_0x31acd3,_0x3385e3)=>{var _0x3ed810=a0_0x1a596;try{const {invoice:_0x1efdd5,date:_0xf432e,warehouse_name:_0x5f1d1d,product_name:_0x428f5a,stock:_0x35dec5,quantity:_0x3c55a3,note:_0xd464b5,room:_0x246422,primary_code:_0x5b38c2,secondary_code:_0x741174,prod_code:_0x3eb9fe,level:_0x28dec6,isle:_0x20f1bf,pallet:_0xa4dd56,batch_code:_0x2200b2,SCRN:_0x13ba9f,expiry_date:_0x7fad55,mode_transpo:_0x5d0811,name_driver:_0x2ca065}=_0x31acd3[_0x3ed810(0x1b5)];if(typeof _0x428f5a==_0x3ed810(0x272))var _0x2c6050=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x1ab)]],_0xd8414b=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x243)]],_0x103634=[_0x31acd3[_0x3ed810(0x1b5)]['carton']],_0x290e51=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x1f9)]],_0x232a1a=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x23c)]],_0x245017=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x23f)]],_0x15af94=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x28d)]],_0x17686f=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x278)]],_0x443524=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x2a5)]],_0x4a0856=[_0x31acd3[_0x3ed810(0x1b5)]['batch_code']],_0x2dd068=[_0x31acd3[_0x3ed810(0x1b5)]['expiry_date']],_0x2683ad=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x229)]],_0x2acf0b=[_0x31acd3[_0x3ed810(0x1b5)]['max_per_unit']],_0x5f161d=[_0x31acd3['body'][_0x3ed810(0x215)]],_0x1e5cc5=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x1dc)]],_0x1dabf3=[_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x1cd)]];else var _0x2c6050=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x1ab)]],_0xd8414b=[..._0x31acd3[_0x3ed810(0x1b5)]['stock']],_0x103634=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x227)]],_0x290e51=[..._0x31acd3[_0x3ed810(0x1b5)]['primary_code']],_0x232a1a=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x23c)]],_0x245017=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x23f)]],_0x15af94=[..._0x31acd3[_0x3ed810(0x1b5)]['level']],_0x17686f=[..._0x31acd3['body'][_0x3ed810(0x278)]],_0x443524=[..._0x31acd3[_0x3ed810(0x1b5)]['secondary_unit']],_0x4a0856=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x268)]],_0x2dd068=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x1b2)]],_0x2683ad=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x229)]],_0x2acf0b=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x205)]],_0x5f161d=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x215)]],_0x1e5cc5=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x1dc)]],_0x1dabf3=[..._0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x1cd)]];const _0x26d4dc=_0x2c6050[_0x3ed810(0x1ef)](_0x5fb14c=>{return _0x5fb14c={'product_name':_0x5fb14c};});_0xd8414b[_0x3ed810(0x2a3)]((_0x5d9b99,_0x3c669d)=>{var _0x479b43=_0x3ed810;_0x26d4dc[_0x3c669d][_0x479b43(0x243)]=_0x5d9b99;}),_0x103634[_0x3ed810(0x2a3)]((_0x32b9c5,_0x3ffbd2)=>{var _0x335e55=_0x3ed810;_0x26d4dc[_0x3ffbd2]['quantity']=Math[_0x335e55(0x254)](_0x32b9c5);}),_0x290e51[_0x3ed810(0x2a3)]((_0x232fca,_0x28a6bd)=>{var _0xd4ca04=_0x3ed810;_0x26d4dc[_0x28a6bd][_0xd4ca04(0x1f9)]=_0x232fca;}),_0x232a1a['forEach']((_0x41bc57,_0x112a55)=>{var _0x372e79=_0x3ed810;_0x26d4dc[_0x112a55][_0x372e79(0x23c)]=_0x41bc57;}),_0x245017[_0x3ed810(0x2a3)]((_0x53859c,_0x38ad2e)=>{var _0xdc6fe=_0x3ed810;_0x26d4dc[_0x38ad2e][_0xdc6fe(0x231)]=_0x53859c;}),_0x15af94[_0x3ed810(0x2a3)]((_0x16eb23,_0x32faf5)=>{var _0x2461fd=_0x3ed810;_0x26d4dc[_0x32faf5][_0x2461fd(0x2ae)]=_0x16eb23;}),_0x17686f['forEach']((_0x144d9d,_0x55c8d6)=>{var _0xffcbc7=_0x3ed810;_0x26d4dc[_0x55c8d6][_0xffcbc7(0x264)]=_0x144d9d;}),_0x443524['forEach']((_0x4f4d17,_0x42c08d)=>{var _0x18c8a4=_0x3ed810;_0x26d4dc[_0x42c08d][_0x18c8a4(0x2a5)]=_0x4f4d17;}),_0x4a0856[_0x3ed810(0x2a3)]((_0x3cc2f1,_0xd2eed3)=>{var _0x394b84=_0x3ed810;_0x26d4dc[_0xd2eed3][_0x394b84(0x268)]=_0x3cc2f1;}),_0x2dd068[_0x3ed810(0x2a3)]((_0x676ebd,_0x484000)=>{var _0x205495=_0x3ed810;_0x26d4dc[_0x484000][_0x205495(0x1b2)]=_0x676ebd;}),_0x2683ad[_0x3ed810(0x2a3)]((_0x451e5b,_0x45728f)=>{_0x26d4dc[_0x45728f]['production_date']=_0x451e5b;}),_0x2acf0b[_0x3ed810(0x2a3)]((_0x3c4787,_0x4cfc0f)=>{var _0xeea711=_0x3ed810;_0x26d4dc[_0x4cfc0f][_0xeea711(0x233)]=_0x3c4787;}),_0x5f161d[_0x3ed810(0x2a3)]((_0x2e4c2a,_0x348c81)=>{var _0x3e4664=_0x3ed810;_0x26d4dc[_0x348c81][_0x3e4664(0x215)]=_0x2e4c2a;}),_0x1e5cc5[_0x3ed810(0x2a3)]((_0x3f7d8b,_0x2ab3b6)=>{var _0x5b6a46=_0x3ed810;_0x26d4dc[_0x2ab3b6][_0x5b6a46(0x1dd)]=_0x3f7d8b;}),_0x1dabf3[_0x3ed810(0x2a3)]((_0x2b25e8,_0x5d2058)=>{var _0x57c4c0=_0x3ed810;_0x26d4dc[_0x5d2058][_0x57c4c0(0x1d7)]=_0x2b25e8;});var _0x30716a=0x0;_0x26d4dc[_0x3ed810(0x2a3)](_0xe79b97=>{var _0x392f6d=_0x3ed810;parseFloat(_0xe79b97['stock'])<parseFloat(_0xe79b97[_0x392f6d(0x280)])&&parseFloat(_0xe79b97[_0x392f6d(0x280)])>parseFloat(_0xe79b97['stock'])&&(console['log'](_0xe79b97[_0x392f6d(0x243)]+_0x392f6d(0x2af)+_0xe79b97[_0x392f6d(0x280)]),_0x30716a++);});if(_0x30716a!=0x0)return _0x31acd3[_0x3ed810(0x261)](_0x3ed810(0x237),'Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty'),_0x3385e3['redirect']('back');const _0x4aebf2=_0x26d4dc[_0x3ed810(0x2ad)](_0x42339a=>_0x42339a[_0x3ed810(0x280)]!=='0'&&_0x42339a['quantity']!==''),_0x546316=new sales_finished({'invoice':_0x1efdd5,'customer':_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x26d)],'date':_0xf432e,'warehouse_name':_0x5f1d1d,'sale_product':_0x4aebf2,'note':_0xd464b5,'room':_0x246422,'primary_code':_0x5b38c2,'secondary_code':_0x741174,'prod_code':_0x3eb9fe,'SCRN':_0x13ba9f,'finalize':_0x3ed810(0x1d3),'mode_transpo':_0x5d0811,'name_driver':_0x2ca065}),_0x1cf37b=await _0x546316[_0x3ed810(0x1e2)](),_0x2ddda6=await sales_finished[_0x3ed810(0x240)]({'invoice':_0x1efdd5}),_0x37cc2c=new c_payment_data({'invoice':_0x1efdd5,'customer':_0x31acd3[_0x3ed810(0x1b5)]['customer'],'reason':_0x3ed810(0x25a)});await _0x37cc2c[_0x3ed810(0x1e2)]();const _0x58be8c=await master_shop[_0x3ed810(0x19f)](),_0x176bfd=await email_settings['findOne'](),_0x3e8cbc=await customer['findOne']({'name':_0x31acd3[_0x3ed810(0x1b5)][_0x3ed810(0x26d)]});_0x58be8c[0x0][_0x3ed810(0x234)]==0x1?(right_currency=_0x58be8c[0x0][_0x3ed810(0x244)],left_currency=''):(right_currency='',left_currency=_0x58be8c[0x0][_0x3ed810(0x244)]);var _0x58edc5=_0x2c6050,_0x18024f=_0x103634,_0x4d1aeb='',_0x53f76e;for(_0x53f76e in _0x58edc5){_0x4d1aeb+=_0x3ed810(0x1f6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x58edc5[_0x53f76e]+_0x3ed810(0x235)+_0x3ed810(0x279)+_0x18024f[_0x53f76e]+_0x3ed810(0x235)+_0x3ed810(0x26c);}console['log'](_0x3ed810(0x274),_0x4d1aeb);let _0x4fcb88=nodemailer['createTransport']({'service':_0x3ed810(0x270),'auth':{'user':_0x176bfd['email'],'pass':_0x176bfd[_0x3ed810(0x248)]}}),_0xedaf21={'from':_0x176bfd[_0x3ed810(0x24b)],'to':_0x3e8cbc[_0x3ed810(0x24b)],'subject':_0x3ed810(0x26b),'attachments':[{'filename':_0x3ed810(0x219),'path':__dirname+_0x3ed810(0x24d)+_0x3ed810(0x1a9)+_0x58be8c[0x0]['image'],'cid':_0x3ed810(0x242)}],'html':_0x3ed810(0x214)+'<html><head><title></title>'+_0x3ed810(0x1c5)+_0x3ed810(0x1bb)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x3ed810(0x22d)+'</div>'+_0x3ed810(0x1bb)+_0x3ed810(0x23e)+_0x58be8c[0x0][_0x3ed810(0x28c)]+_0x3ed810(0x24a)+'</div>'+_0x3ed810(0x20b)+_0x3ed810(0x2a1)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x1efdd5+'\x20'+_0x3ed810(0x289)+_0x3ed810(0x2a6)+_0xf432e+'\x20'+'</span>'+_0x3ed810(0x1be)+_0x3ed810(0x20b)+_0x3ed810(0x1cf)+_0x3ed810(0x1e8)+_0x3ed810(0x1f6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>'+_0x3ed810(0x26c)+_0x3ed810(0x285)+_0x3ed810(0x1bd)+'\x20'+_0x4d1aeb+'\x20'+_0x3ed810(0x288)+_0x3ed810(0x1fb)+_0x3ed810(0x1bb)+_0x3ed810(0x1f3)+_0x3ed810(0x25d)+_0x58be8c[0x0][_0x3ed810(0x28c)]+_0x3ed810(0x1be)+_0x3ed810(0x20b)+_0x3ed810(0x20b)+_0x3ed810(0x262)};_0x4fcb88[_0x3ed810(0x23a)](_0xedaf21,function(_0x3721c0,_0x2e2bb8){var _0x547b10=_0x3ed810;_0x3721c0?(console[_0x547b10(0x217)](_0x3721c0),console['log'](_0x547b10(0x1b0))):console[_0x547b10(0x217)](_0x547b10(0x1aa));}),_0x31acd3[_0x3ed810(0x261)](_0x3ed810(0x1e3),'Sales\x20Add\x20successfully'),_0x3385e3['redirect'](_0x3ed810(0x211)+_0x1cf37b[_0x3ed810(0x27a)]);}catch(_0x310c55){console['log'](_0x310c55);}}),router['get'](a0_0x1a596(0x281),auth,async(_0x323dc0,_0x595f50)=>{var _0x3ee624=a0_0x1a596;try{const {username:_0x164f96,email:_0xb7fe30,role:_0x278b22}=_0x323dc0[_0x3ee624(0x291)],_0x48658a=_0x323dc0[_0x3ee624(0x291)],_0x2028ae=await profile['findOne']({'email':_0x48658a[_0x3ee624(0x24b)]}),_0x4d2e36=await master_shop[_0x3ee624(0x19f)](),_0x33b3c8=_0x323dc0[_0x3ee624(0x1ec)]['id'],_0x1c8805=await sales_finished[_0x3ee624(0x1e4)](_0x33b3c8),_0x52d10d=await warehouse[_0x3ee624(0x2b0)]([{'$match':{'name':_0x1c8805['warehouse_name']}},{'$unwind':_0x3ee624(0x2a8)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3ee624(0x1b4)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3ee624(0x20f)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3ee624(0x1f4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3ee624(0x1b6)},'expiry_date':{'$first':_0x3ee624(0x245)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':'$room'},'room_data':{'$first':_0x3ee624(0x1a1)}}}]),_0x376e83=await customer[_0x3ee624(0x19f)]({});let _0x412f2a;if(_0x48658a[_0x3ee624(0x249)]==_0x3ee624(0x1c8)){const _0x59fcc7=await staff[_0x3ee624(0x240)]({'email':_0x48658a['email']});_0x412f2a=await warehouse[_0x3ee624(0x2b0)]([{'$match':{'status':_0x3ee624(0x29e),'name':_0x59fcc7[_0x3ee624(0x232)]}},{'$group':{'_id':'$name','name':{'$first':_0x3ee624(0x1b3)}}}]);}else _0x412f2a=await warehouse[_0x3ee624(0x2b0)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x3ee624(0x1b3),'name':{'$first':_0x3ee624(0x1b3)}}}]);const _0x6daec8=await product['find']({});if(_0x4d2e36[0x0]['language']==_0x3ee624(0x271)){var _0x3b0b7e=users['English'];console['log'](_0x3b0b7e);}else{if(_0x4d2e36[0x0][_0x3ee624(0x1c9)]==_0x3ee624(0x1a4))var _0x3b0b7e=users[_0x3ee624(0x1a4)];else{if(_0x4d2e36[0x0][_0x3ee624(0x1c9)]==_0x3ee624(0x24c))var _0x3b0b7e=users[_0x3ee624(0x24c)];else{if(_0x4d2e36[0x0][_0x3ee624(0x1c9)]==_0x3ee624(0x1ce))var _0x3b0b7e=users[_0x3ee624(0x1ce)];else{if(_0x4d2e36[0x0][_0x3ee624(0x1c9)]==_0x3ee624(0x2a9))var _0x3b0b7e=users['French'];else{if(_0x4d2e36[0x0][_0x3ee624(0x1c9)]==_0x3ee624(0x1ea))var _0x3b0b7e=users['Portuguese'];else{if(_0x4d2e36[0x0][_0x3ee624(0x1c9)]=='Chinese')var _0x3b0b7e=users[_0x3ee624(0x1cc)];else{if(_0x4d2e36[0x0][_0x3ee624(0x1c9)]==_0x3ee624(0x20e))var _0x3b0b7e=users['Arabic'];}}}}}}}_0x595f50[_0x3ee624(0x224)](_0x3ee624(0x29d),{'success':_0x323dc0['flash'](_0x3ee624(0x1e3)),'errors':_0x323dc0[_0x3ee624(0x261)](_0x3ee624(0x237)),'role':_0x48658a,'profile':_0x2028ae,'customer':_0x376e83,'warehouse':_0x412f2a,'product':_0x52d10d,'user':_0x1c8805,'master_shop':_0x4d2e36,'unit':_0x6daec8,'language':_0x3b0b7e});}catch(_0x5e12ea){console[_0x3ee624(0x217)](_0x5e12ea);}}),router[a0_0x1a596(0x25e)](a0_0x1a596(0x281),auth,async(_0x591fde,_0x5d4c0e)=>{var _0x9f9228=a0_0x1a596;try{const _0x1004d8=_0x591fde[_0x9f9228(0x1ec)]['id'],{invoice:_0x36a568,warehouse_name:_0x1c617e,room:_0x4e29d1}=_0x591fde[_0x9f9228(0x1b5)],_0x816cf2=await sales_finished[_0x9f9228(0x240)]({'invoice':_0x36a568}),_0x13b445=_0x816cf2[_0x9f9228(0x2b1)][_0x9f9228(0x1ef)](async _0x3a45cf=>{var _0x44b38e=_0x9f9228,_0x4674b9=await warehouse[_0x44b38e(0x240)]({'name':_0x1c617e,'room':_0x3a45cf['room_name'],'warehouse_category':_0x44b38e(0x1d4)});const _0x15aff6=_0x4674b9['product_details'][_0x44b38e(0x1ef)](_0x28feff=>{var _0x32812e=_0x44b38e;_0x28feff[_0x32812e(0x1ab)]==_0x3a45cf[_0x32812e(0x1ab)]&&_0x28feff[_0x32812e(0x2ae)]==_0x3a45cf[_0x32812e(0x2ae)]&&_0x28feff['expiry_date']==_0x3a45cf[_0x32812e(0x1b2)]&&_0x28feff[_0x32812e(0x1c2)]==_0x3a45cf[_0x32812e(0x1c2)]&&_0x28feff[_0x32812e(0x268)]==_0x3a45cf[_0x32812e(0x268)]&&_0x28feff['invoice']==_0x3a45cf['invoice']&&(console[_0x32812e(0x217)](_0x28feff[_0x32812e(0x1ab)]+_0x32812e(0x22a)+_0x3a45cf[_0x32812e(0x1ab)]+'\x20&&\x20'+_0x28feff[_0x32812e(0x2ae)]+_0x32812e(0x22a)+_0x3a45cf[_0x32812e(0x2ae)]+_0x32812e(0x247)+_0x28feff[_0x32812e(0x1c2)]+_0x32812e(0x22a)+_0x3a45cf[_0x32812e(0x1c2)]+_0x32812e(0x247)+_0x28feff[_0x32812e(0x1b2)]+_0x32812e(0x22a)+_0x3a45cf[_0x32812e(0x1b2)]+_0x32812e(0x247)+_0x28feff[_0x32812e(0x268)]+_0x32812e(0x22a)+_0x3a45cf[_0x32812e(0x268)]+'\x20&&\x20'+_0x28feff[_0x32812e(0x1d7)]+_0x32812e(0x22a)+_0x3a45cf['invoice']+_0x32812e(0x247)+_0x28feff[_0x32812e(0x1b8)]+_0x32812e(0x22a)+_0x3a45cf[_0x32812e(0x280)]+_0x32812e(0x1de)+_0x3a45cf[_0x32812e(0x1dd)]),_0x28feff[_0x32812e(0x1b8)]>0x0&&(_0x28feff[_0x32812e(0x1b8)]=Math['abs'](Math[_0x32812e(0x254)](_0x28feff[_0x32812e(0x1b8)])-Math['abs'](_0x3a45cf[_0x32812e(0x280)]))));});return _0x4674b9;});Promise[_0x9f9228(0x1da)](_0x13b445)['then'](async _0x5a6927=>{var _0x1b432c=_0x9f9228;try{for(const _0x15f3a9 of _0x5a6927){await _0x15f3a9[_0x1b432c(0x1e2)]();}_0x816cf2[_0x1b432c(0x213)]=_0x1b432c(0x258);const _0x4c7614=await _0x816cf2[_0x1b432c(0x1e2)](),_0x2f88fe=await master_shop[_0x1b432c(0x19f)](),_0x555000=await email_settings[_0x1b432c(0x240)](),_0x1a3060=await supervisor_settings[_0x1b432c(0x19f)]();var _0x49ee5b=_0x816cf2[_0x1b432c(0x2b1)],_0x55a57e='',_0x43fd6d;for(_0x43fd6d in _0x49ee5b){var _0x2708f8='FG';_0x816cf2['warehouse_name']==_0x1b432c(0x296)&&(_0x2708f8='DG'),_0x55a57e+='<tr>'+_0x1b432c(0x279)+_0x49ee5b[_0x43fd6d][_0x1b432c(0x1ab)]+_0x1b432c(0x235)+_0x1b432c(0x279)+_0x49ee5b[_0x43fd6d]['product_code']+_0x1b432c(0x235)+_0x1b432c(0x279)+_0x49ee5b[_0x43fd6d][_0x1b432c(0x280)]+_0x1b432c(0x235)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x49ee5b[_0x43fd6d]['unit']+_0x1b432c(0x235)+_0x1b432c(0x279)+_0x49ee5b[_0x43fd6d][_0x1b432c(0x2a5)]+_0x1b432c(0x235)+_0x1b432c(0x279)+_0x816cf2[_0x1b432c(0x218)]+'</td>'+_0x1b432c(0x279)+_0x49ee5b[_0x43fd6d][_0x1b432c(0x1dd)]+_0x1b432c(0x235)+_0x1b432c(0x279)+_0x2708f8+_0x49ee5b[_0x43fd6d][_0x1b432c(0x2ae)]+_0x1b432c(0x235);}let _0x327bd8=nodemailer[_0x1b432c(0x20c)]({'host':_0x555000['host'],'port':Number(_0x555000[_0x1b432c(0x1b9)]),'secure':![],'auth':{'user':_0x555000['email'],'pass':_0x555000[_0x1b432c(0x248)]}}),_0x440761={'from':_0x555000[_0x1b432c(0x24b)],'to':_0x1a3060[0x0][_0x1b432c(0x292)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x1b432c(0x219),'path':__dirname+_0x1b432c(0x24d)+_0x1b432c(0x1a9)+_0x2f88fe[0x0][_0x1b432c(0x273)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x1b432c(0x1c5)+_0x1b432c(0x1bb)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1b432c(0x1bb)+_0x1b432c(0x22d)+'</div>'+_0x1b432c(0x1bb)+_0x1b432c(0x23e)+_0x2f88fe[0x0]['site_title']+_0x1b432c(0x24a)+'</div>'+_0x1b432c(0x20b)+_0x1b432c(0x2a1)+_0x1b432c(0x1bb)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1b432c(0x1e9)+_0x816cf2['invoice']+'\x20'+_0x1b432c(0x289)+'\x20Order\x20Date\x20:\x20'+_0x816cf2[_0x1b432c(0x1f7)]+'\x20'+'</span>'+_0x1b432c(0x1be)+_0x1b432c(0x20b)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1b432c(0x1e8)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x1b432c(0x230)+_0x1b432c(0x2a2)+_0x1b432c(0x212)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x1b432c(0x1d5)+_0x1b432c(0x299)+_0x1b432c(0x26c)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x55a57e+'\x20'+_0x1b432c(0x288)+_0x1b432c(0x1fb)+'<div>'+_0x1b432c(0x1f3)+_0x1b432c(0x25d)+_0x2f88fe[0x0][_0x1b432c(0x28c)]+_0x1b432c(0x1be)+'</div>'+_0x1b432c(0x20b)+_0x1b432c(0x262)};_0x327bd8[_0x1b432c(0x23a)](_0x440761,function(_0x185712,_0xecad5){var _0x370254=_0x1b432c;_0x185712?(console[_0x370254(0x217)](_0x185712),console['log'](_0x370254(0x1b0))):console[_0x370254(0x217)](_0x370254(0x1aa));}),_0x591fde[_0x1b432c(0x261)](_0x1b432c(0x1e3),_0x1b432c(0x20a)),_0x5d4c0e[_0x1b432c(0x1ff)](_0x1b432c(0x267)+_0x1004d8);}catch(_0x48d1bb){console[_0x1b432c(0x25c)](_0x48d1bb),_0x5d4c0e['status'](0x1f4)[_0x1b432c(0x21d)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x9f9228(0x22c)](_0x43da3e=>{var _0x2f4c1c=_0x9f9228;console['error'](_0x43da3e),_0x5d4c0e[_0x2f4c1c(0x1cb)](0x1f4)[_0x2f4c1c(0x21d)]({'error':_0x2f4c1c(0x1e0)});});}catch(_0x77b8a9){console[_0x9f9228(0x217)](_0x77b8a9);}}),router[a0_0x1a596(0x27f)]('/view/:id',auth,async(_0x314646,_0x7bdd14)=>{var _0x435c9b=a0_0x1a596;try{const {username:_0x3d0cda,email:_0x237b2f,role:_0x423430}=_0x314646[_0x435c9b(0x291)],_0x45609d=_0x314646[_0x435c9b(0x291)],_0x235d79=await profile[_0x435c9b(0x240)]({'email':_0x45609d[_0x435c9b(0x24b)]}),_0x5c118a=await master_shop[_0x435c9b(0x19f)](),_0x339158=_0x314646[_0x435c9b(0x1ec)]['id'],_0x4e8fc6=await sales_finished['findById'](_0x339158);let _0x28961c=new Date(_0x4e8fc6[_0x435c9b(0x1b2)]),_0x57690a=('0'+_0x28961c[_0x435c9b(0x2a7)]())[_0x435c9b(0x286)](-0x2),_0x44d1a6=('0'+(_0x28961c[_0x435c9b(0x222)]()+0x1))[_0x435c9b(0x286)](-0x2),_0x6568e0=_0x28961c[_0x435c9b(0x1fc)](),_0x12c538=_0x6568e0+'-'+_0x44d1a6+'-'+_0x57690a;var _0x198c23=[_0x435c9b(0x221),_0x435c9b(0x24f)];const _0x366478=await warehouse['aggregate']([{'$match':{'name':_0x4e8fc6['warehouse_name'],'room':_0x4e8fc6[_0x435c9b(0x200)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x435c9b(0x21e)},'product_stock':{'$first':_0x435c9b(0x1ae)},'bay':{'$first':_0x435c9b(0x1b4)},'bin':{'$first':_0x435c9b(0x269)},'type':{'$first':_0x435c9b(0x20f)},'floorlevel':{'$first':_0x435c9b(0x2ac)},'primary_code':{'$first':_0x435c9b(0x2aa)},'secondary_code':{'$first':_0x435c9b(0x255)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x435c9b(0x1a5)},'rack':{'$first':'$product_details.rack'}}}]),_0x464722=await customer['find']({});let _0x300c2e;if(_0x45609d[_0x435c9b(0x249)]=='staff'){const _0x102932=await staff[_0x435c9b(0x240)]({'email':_0x45609d[_0x435c9b(0x24b)]});_0x300c2e=await warehouse[_0x435c9b(0x2b0)]([{'$match':{'status':'Enabled','name':_0x102932[_0x435c9b(0x232)]}},{'$group':{'_id':_0x435c9b(0x1b3),'name':{'$first':'$name'}}}]);}else _0x300c2e=await warehouse[_0x435c9b(0x2b0)]([{'$match':{'status':_0x435c9b(0x29e)}},{'$group':{'_id':_0x435c9b(0x1b3),'name':{'$first':_0x435c9b(0x1b3)}}}]);const _0x36912a=await product['find']({});if(_0x5c118a[0x0][_0x435c9b(0x1c9)]==_0x435c9b(0x271)){var _0x51ad87=users[_0x435c9b(0x1fd)];console[_0x435c9b(0x217)](_0x51ad87);}else{if(_0x5c118a[0x0][_0x435c9b(0x1c9)]=='Hindi')var _0x51ad87=users['Hindi'];else{if(_0x5c118a[0x0][_0x435c9b(0x1c9)]==_0x435c9b(0x24c))var _0x51ad87=users['German'];else{if(_0x5c118a[0x0][_0x435c9b(0x1c9)]==_0x435c9b(0x1ce))var _0x51ad87=users[_0x435c9b(0x1ce)];else{if(_0x5c118a[0x0][_0x435c9b(0x1c9)]==_0x435c9b(0x2a9))var _0x51ad87=users['French'];else{if(_0x5c118a[0x0][_0x435c9b(0x1c9)]==_0x435c9b(0x1ea))var _0x51ad87=users[_0x435c9b(0x28b)];else{if(_0x5c118a[0x0][_0x435c9b(0x1c9)]==_0x435c9b(0x1cc))var _0x51ad87=users[_0x435c9b(0x1cc)];else{if(_0x5c118a[0x0][_0x435c9b(0x1c9)]==_0x435c9b(0x20e))var _0x51ad87=users[_0x435c9b(0x282)];}}}}}}}_0x7bdd14[_0x435c9b(0x224)]('edit_sales_finished',{'success':_0x314646['flash']('success'),'errors':_0x314646[_0x435c9b(0x261)]('errors'),'role':_0x45609d,'profile':_0x235d79,'customer':_0x464722,'warehouse':_0x300c2e,'product':_0x366478,'user':_0x4e8fc6,'master_shop':_0x5c118a,'unit':_0x36912a,'language':_0x51ad87,'rooms_data':_0x198c23,'ed_fullDate':_0x12c538});}catch(_0x36af8f){console['log'](_0x36af8f);}}),router[a0_0x1a596(0x25e)](a0_0x1a596(0x203),auth,async(_0x5d7932,_0x683ff5)=>{var _0x6d4ecc=a0_0x1a596;try{const _0x367fd3=_0x5d7932[_0x6d4ecc(0x1ec)]['id'],_0x41ad33=await sales_finished[_0x6d4ecc(0x240)]({'_id':_0x5d7932[_0x6d4ecc(0x1ec)]['id']}),_0x210c95=await warehouse[_0x6d4ecc(0x240)]({'name':_0x41ad33[_0x6d4ecc(0x218)],'room':_0x5d7932[_0x6d4ecc(0x1b5)][_0x6d4ecc(0x200)],'warehouse_category':_0x6d4ecc(0x1d4)}),{invoice:_0x40189f,customer:_0x11a546,date:_0x352b70,warehouse_name:_0x564af8,product_name:_0x317e43,stock:_0x5dbc26,adjust_qty:_0x4ce629,note:_0xe42c24,room:_0xfe131d,primary_code:_0x5dbbd1,secondary_code:_0x43a70b,prod_code:_0x56d67e,level:_0x24a254,isle:_0x1ed977,pallet:_0x19ada3,expiry_date:_0x3ce1f0}=_0x5d7932[_0x6d4ecc(0x1b5)];if(typeof _0x317e43==_0x6d4ecc(0x272))var _0x28c180=[_0x5d7932[_0x6d4ecc(0x1b5)][_0x6d4ecc(0x1ab)]],_0x5dc8b2=[_0x5d7932[_0x6d4ecc(0x1b5)]['stock']],_0x235c19=[_0x5d7932[_0x6d4ecc(0x1b5)][_0x6d4ecc(0x283)]],_0x1b5b46=[_0x5d7932[_0x6d4ecc(0x1b5)][_0x6d4ecc(0x1f9)]],_0x2bb7d1=[_0x5d7932[_0x6d4ecc(0x1b5)]['secondary_code']],_0x43e2f0=[_0x5d7932['body'][_0x6d4ecc(0x23f)]],_0x2b3b6e=[_0x5d7932[_0x6d4ecc(0x1b5)]['level']],_0xba6df=[_0x5d7932[_0x6d4ecc(0x1b5)][_0x6d4ecc(0x1b2)]];else var _0x28c180=[..._0x5d7932['body'][_0x6d4ecc(0x1ab)]],_0x5dc8b2=[..._0x5d7932[_0x6d4ecc(0x1b5)]['stock']],_0x235c19=[..._0x5d7932[_0x6d4ecc(0x1b5)][_0x6d4ecc(0x283)]],_0x1b5b46=[..._0x5d7932[_0x6d4ecc(0x1b5)]['primary_code']],_0x2bb7d1=[..._0x5d7932[_0x6d4ecc(0x1b5)][_0x6d4ecc(0x23c)]],_0x43e2f0=[..._0x5d7932[_0x6d4ecc(0x1b5)][_0x6d4ecc(0x23f)]],_0x2b3b6e=[..._0x5d7932[_0x6d4ecc(0x1b5)]['level']],_0xba6df=[..._0x5d7932[_0x6d4ecc(0x1b5)][_0x6d4ecc(0x1b2)]];const _0x1939d3=_0x28c180[_0x6d4ecc(0x1ef)](_0x2afe16=>{return _0x2afe16={'product_name':_0x2afe16};});_0x5dc8b2[_0x6d4ecc(0x2a3)]((_0x397f42,_0x21cc9d)=>{var _0x26224b=_0x6d4ecc;_0x1939d3[_0x21cc9d][_0x26224b(0x243)]=_0x397f42;}),_0x235c19['forEach']((_0x15bd28,_0x355ed6)=>{var _0x4d093e=_0x6d4ecc;_0x1939d3[_0x355ed6][_0x4d093e(0x280)]=_0x15bd28;}),_0x1b5b46[_0x6d4ecc(0x2a3)]((_0x3da427,_0x54aa19)=>{_0x1939d3[_0x54aa19]['primary_code']=_0x3da427;}),_0x2bb7d1['forEach']((_0x1419e7,_0x106a6e)=>{var _0x231ecb=_0x6d4ecc;_0x1939d3[_0x106a6e][_0x231ecb(0x23c)]=_0x1419e7;}),_0x43e2f0['forEach']((_0x5c7ac1,_0x35c106)=>{_0x1939d3[_0x35c106]['product_code']=_0x5c7ac1;}),_0x2b3b6e[_0x6d4ecc(0x2a3)]((_0x9274a1,_0xe84b23)=>{var _0x46a420=_0x6d4ecc;_0x1939d3[_0xe84b23][_0x46a420(0x28d)]=_0x9274a1;}),_0xba6df[_0x6d4ecc(0x2a3)]((_0x2f98aa,_0x3dfb49)=>{var _0x3d1a63=_0x6d4ecc;_0x1939d3[_0x3dfb49][_0x3d1a63(0x1b2)]=_0x2f98aa;});var _0x5154e6=0x0;_0x1939d3[_0x6d4ecc(0x2a3)](_0x3fe079=>{var _0x587037=_0x6d4ecc;console[_0x587037(0x217)]('foreach\x20newproduct',_0x3fe079),(parseInt(_0x3fe079[_0x587037(0x243)])<parseInt(_0x3fe079[_0x587037(0x280)])||parseInt(_0x3fe079[_0x587037(0x280)])==0x0)&&_0x5154e6++;});if(_0x5154e6!=0x0)return _0x5d7932[_0x6d4ecc(0x261)]('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x683ff5[_0x6d4ecc(0x1ff)](_0x6d4ecc(0x220));_0x41ad33[_0x6d4ecc(0x2b1)][_0x6d4ecc(0x2a3)](_0x5eefc6=>{var _0x5e8b17=_0x6d4ecc;const _0x4fa2e5=_0x210c95[_0x5e8b17(0x256)][_0x5e8b17(0x1ef)](_0x7e6a9f=>{var _0x302856=_0x5e8b17;_0x7e6a9f[_0x302856(0x1ab)]==_0x5eefc6[_0x302856(0x1ab)]&&_0x7e6a9f['bay']==_0x5eefc6[_0x302856(0x2ae)]&&(_0x7e6a9f['product_stock']=parseInt(_0x7e6a9f['product_stock'])+parseInt(_0x5eefc6[_0x302856(0x280)]));});}),await _0x210c95[_0x6d4ecc(0x1e2)]();const _0x2ea2ac=_0x1939d3['filter'](_0x1f0db2=>_0x1f0db2[_0x6d4ecc(0x280)]!=='0'&&_0x1f0db2[_0x6d4ecc(0x280)]!=='');_0x41ad33['invoice']=_0x40189f,_0x41ad33[_0x6d4ecc(0x26d)]=_0x11a546,_0x41ad33[_0x6d4ecc(0x1f7)]=_0x352b70,_0x41ad33[_0x6d4ecc(0x218)]=_0x564af8,_0x41ad33[_0x6d4ecc(0x2b1)]=_0x2ea2ac,_0x41ad33[_0x6d4ecc(0x1c0)]=_0xe42c24,_0x41ad33[_0x6d4ecc(0x200)]=_0xfe131d;const _0x41bf52=await _0x41ad33['save'](),_0x2a797c=await sales_finished[_0x6d4ecc(0x240)]({'_id':_0x5d7932['params']['id']}),_0x5375dc=await warehouse[_0x6d4ecc(0x240)]({'name':_0x564af8,'room':_0xfe131d,'warehouse_category':_0x6d4ecc(0x1d4)});_0x2a797c[_0x6d4ecc(0x2b1)][_0x6d4ecc(0x2a3)](_0x5712d6=>{var _0xfd1efc=_0x6d4ecc;const _0x4f6b9d=_0x5375dc[_0xfd1efc(0x256)][_0xfd1efc(0x1ef)](_0x3290d5=>{var _0x4cada5=_0xfd1efc;_0x3290d5['product_name']==_0x5712d6[_0x4cada5(0x1ab)]&&_0x3290d5[_0x4cada5(0x2ae)]==_0x5712d6[_0x4cada5(0x2ae)]&&(_0x3290d5[_0x4cada5(0x1b8)]=parseInt(_0x3290d5[_0x4cada5(0x1b8)])-parseInt(_0x5712d6[_0x4cada5(0x280)]));});}),console[_0x6d4ecc(0x217)](_0x6d4ecc(0x1a7),_0x5375dc),await _0x5375dc['save']();const _0x5314fe=await c_payment_data[_0x6d4ecc(0x240)]({'invoice':_0x5d7932[_0x6d4ecc(0x1b5)][_0x6d4ecc(0x1d7)]});_0x5314fe[_0x6d4ecc(0x1df)]=_0x5d7932['body'][_0x6d4ecc(0x1df)],await _0x5314fe[_0x6d4ecc(0x1e2)](),_0x5d7932[_0x6d4ecc(0x261)](_0x6d4ecc(0x1e3),_0x6d4ecc(0x20a)),_0x683ff5['redirect'](_0x6d4ecc(0x266));}catch(_0x3cc1f7){console[_0x6d4ecc(0x217)](_0x3cc1f7);}}),router[a0_0x1a596(0x25e)](a0_0x1a596(0x1a2),auth,async(_0x4d0934,_0x2ca91c)=>{var _0x410118=a0_0x1a596;try{const _0x193fae=_0x4d0934['params']['id'],{invoice:_0x57d6dc,customer:_0x41c905,receivable_amount:_0x3450fb,received_amount:_0x2e1aed}=_0x4d0934[_0x410118(0x1b5)],_0x5cf324=await sales['findById'](_0x193fae);console[_0x410118(0x217)](_0x5cf324);var _0x341652=_0x3450fb-_0x2e1aed;console[_0x410118(0x217)](_0x2e1aed),_0x5cf324['received_amount']=parseFloat(_0x2e1aed)+parseFloat(_0x5cf324[_0x410118(0x20d)]),_0x5cf324['due_amount']=_0x341652,console[_0x410118(0x217)](_0x5cf324);const _0x274314=await _0x5cf324[_0x410118(0x1e2)](),_0x3a0f1b=await c_payment_data[_0x410118(0x240)]({'invoice':_0x57d6dc});_0x3a0f1b['amount']=_0x341652,await _0x3a0f1b[_0x410118(0x1e2)]();let _0x5362cf=new Date(),_0x53c0a0=('0'+_0x5362cf[_0x410118(0x2a7)]())[_0x410118(0x286)](-0x2),_0x4f8ca6=('0'+(_0x5362cf[_0x410118(0x222)]()+0x1))[_0x410118(0x286)](-0x2),_0x5a6e06=_0x5362cf[_0x410118(0x1fc)](),_0x6db643=_0x5a6e06+'-'+_0x4f8ca6+'-'+_0x53c0a0;const _0x4d1aac=new customer_payment({'invoice':_0x57d6dc,'date':_0x5a6e06+'-'+_0x4f8ca6+'-'+_0x53c0a0,'customer':_0x41c905,'reason':_0x410118(0x27d),'amount':_0x2e1aed}),_0x1bc2a2=await _0x4d1aac[_0x410118(0x1e2)]();_0x4d0934['flash'](_0x410118(0x1e3),_0x410118(0x1e5)),_0x2ca91c['redirect'](_0x410118(0x1f2));}catch(_0x1883c9){console[_0x410118(0x217)](_0x1883c9);}}),router[a0_0x1a596(0x27f)](a0_0x1a596(0x252),auth,async(_0x4f49f9,_0x547245)=>{var _0x5c3fb6=a0_0x1a596;try{const {username:_0x2aadde,email:_0x149f27,role:_0x553f34}=_0x4f49f9[_0x5c3fb6(0x291)],_0x4dd85c=_0x4f49f9[_0x5c3fb6(0x291)],_0x4ddf0a=await profile[_0x5c3fb6(0x240)]({'email':_0x4dd85c[_0x5c3fb6(0x24b)]}),_0x340e99=await master_shop[_0x5c3fb6(0x19f)]();console[_0x5c3fb6(0x217)](_0x5c3fb6(0x29f),_0x340e99);const _0x5791f7=_0x4f49f9[_0x5c3fb6(0x1ec)]['id'],_0x2be915=await sales[_0x5c3fb6(0x1e4)](_0x5791f7);console[_0x5c3fb6(0x217)](_0x2be915);const _0x5abc0b=await customer['findOne']({'name':_0x2be915['customer']});console['log'](_0x5abc0b);if(_0x340e99[0x0][_0x5c3fb6(0x1c9)]=='English\x20(US)'){var _0x507a70=users[_0x5c3fb6(0x1fd)];console['log'](_0x507a70);}else{if(_0x340e99[0x0][_0x5c3fb6(0x1c9)]==_0x5c3fb6(0x1a4))var _0x507a70=users[_0x5c3fb6(0x1a4)];else{if(_0x340e99[0x0][_0x5c3fb6(0x1c9)]=='German')var _0x507a70=users[_0x5c3fb6(0x24c)];else{if(_0x340e99[0x0][_0x5c3fb6(0x1c9)]==_0x5c3fb6(0x1ce))var _0x507a70=users['Spanish'];else{if(_0x340e99[0x0][_0x5c3fb6(0x1c9)]==_0x5c3fb6(0x2a9))var _0x507a70=users[_0x5c3fb6(0x2a9)];else{if(_0x340e99[0x0][_0x5c3fb6(0x1c9)]=='Portuguese\x20(BR)')var _0x507a70=users[_0x5c3fb6(0x28b)];else{if(_0x340e99[0x0][_0x5c3fb6(0x1c9)]==_0x5c3fb6(0x1cc))var _0x507a70=users[_0x5c3fb6(0x1cc)];else{if(_0x340e99[0x0]['language']==_0x5c3fb6(0x20e))var _0x507a70=users['Arabic'];}}}}}}}_0x547245['render'](_0x5c3fb6(0x23b),{'success':_0x4f49f9[_0x5c3fb6(0x261)](_0x5c3fb6(0x1e3)),'errors':_0x4f49f9['flash'](_0x5c3fb6(0x237)),'role':_0x4dd85c,'profile':_0x4ddf0a,'master_shop':_0x340e99,'customers':_0x5abc0b,'sales':_0x2be915,'language':_0x507a70});}catch(_0xd4461c){console[_0x5c3fb6(0x217)](_0xd4461c);}}),router[a0_0x1a596(0x27f)](a0_0x1a596(0x19b),auth,async(_0x17b60b,_0x511197)=>{var _0x18bb5c=a0_0x1a596;try{const {username:_0x4dc9d3,email:_0x53e39a,role:_0x5e49f1}=_0x17b60b['user'],_0x361e97=_0x17b60b[_0x18bb5c(0x291)],_0x319b01=await profile['findOne']({'email':_0x361e97[_0x18bb5c(0x24b)]}),_0x539e70=await master_shop[_0x18bb5c(0x19f)](),_0xd83a7b=_0x17b60b['params']['id'],_0x3b953f=await sales_finished[_0x18bb5c(0x1e4)](_0xd83a7b),_0x3cc7d6=await warehouse['aggregate']([{'$match':{'name':_0x3b953f[_0x18bb5c(0x218)]}},{'$unwind':_0x18bb5c(0x2a8)},{'$group':{'_id':_0x18bb5c(0x23d),'name':{'$first':_0x18bb5c(0x21e)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x18bb5c(0x269)},'type':{'$first':_0x18bb5c(0x20f)},'floorlevel':{'$first':_0x18bb5c(0x2ac)},'primary_code':{'$first':_0x18bb5c(0x2aa)},'secondary_code':{'$first':_0x18bb5c(0x255)},'product_code':{'$first':_0x18bb5c(0x1f4)},'storage':{'$first':_0x18bb5c(0x1a5)},'rack':{'$first':_0x18bb5c(0x1b6)},'expiry_date':{'$first':_0x18bb5c(0x245)},'production_date':{'$first':_0x18bb5c(0x206)},'unit':{'$first':_0x18bb5c(0x1a8)},'secondary_unit':{'$first':_0x18bb5c(0x236)},'maxProducts':{'$first':_0x18bb5c(0x25b)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x2e5bcc=await product[_0x18bb5c(0x19f)]({}),_0x2d5e28=await warehouse[_0x18bb5c(0x2b0)]([{'$match':{'status':'Enabled','warehouse_category':_0x18bb5c(0x1d4),'name':{'$ne':'Return\x20Goods','$ne':_0x18bb5c(0x1d2)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x314fd3=[_0x18bb5c(0x19d)];const _0x1dd974=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x18bb5c(0x1d2)}},{'$group':{'_id':_0x18bb5c(0x1b3),'name':{'$first':_0x18bb5c(0x1b3)}}},{'$sort':{'name':0x1}}]);if(_0x539e70[0x0]['language']==_0x18bb5c(0x271)){var _0x252d10=users[_0x18bb5c(0x1fd)];console['log'](_0x252d10);}else{if(_0x539e70[0x0]['language']=='Hindi')var _0x252d10=users[_0x18bb5c(0x1a4)];else{if(_0x539e70[0x0][_0x18bb5c(0x1c9)]=='German')var _0x252d10=users['German'];else{if(_0x539e70[0x0][_0x18bb5c(0x1c9)]==_0x18bb5c(0x1ce))var _0x252d10=users['Spanish'];else{if(_0x539e70[0x0][_0x18bb5c(0x1c9)]==_0x18bb5c(0x2a9))var _0x252d10=users[_0x18bb5c(0x2a9)];else{if(_0x539e70[0x0][_0x18bb5c(0x1c9)]=='Portuguese\x20(BR)')var _0x252d10=users[_0x18bb5c(0x28b)];else{if(_0x539e70[0x0]['language']==_0x18bb5c(0x1cc))var _0x252d10=users[_0x18bb5c(0x1cc)];else{if(_0x539e70[0x0][_0x18bb5c(0x1c9)]=='Arabic\x20(ae)')var _0x252d10=users['Arabic'];}}}}}}}_0x511197[_0x18bb5c(0x224)]('return_sale_finished',{'success':_0x17b60b[_0x18bb5c(0x261)](_0x18bb5c(0x1e3)),'errors':_0x17b60b[_0x18bb5c(0x261)](_0x18bb5c(0x237)),'role':_0x361e97,'profile':_0x319b01,'user':_0x3b953f,'stock':_0x3cc7d6,'master_shop':_0x539e70,'unit':_0x2e5bcc,'language':_0x252d10,'warehouses':_0x2d5e28,'rooms':_0x314fd3,'warehouse_QA':_0x1dd974});}catch(_0x22e5c0){console['log'](_0x22e5c0),_0x511197['status'](0xc8)[_0x18bb5c(0x21d)]({'message':_0x22e5c0['message']});}}),router[a0_0x1a596(0x25e)](a0_0x1a596(0x19b),auth,async(_0xaebde0,_0x142b89)=>{var _0x379e10=a0_0x1a596;if(_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1a3)]=='QA')try{const {invoice:_0x4a48f7,date:_0x51dd6f,warehouse_name:_0x33ee3d,product_name:_0x7a682f,primary_code:_0x59db29,secondary_code:_0x194ba2,product_code:_0x2c9e4e,sales_quantity:_0x3a6a8a,stocks:_0x972633,return_qty:_0x45b737,Room_name:_0x5ed521,to_warehouse_name_QA:_0x3d8763,to_Room_name_QA:_0x2618a7,note:_0x28543e,for_categorize:_0x314133,product_name_QA1:_0x3cbd6c}=_0xaebde0['body'];if(typeof _0x3cbd6c==_0x379e10(0x272))var _0x1009a5=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1ad)]],_0x394587=[_0xaebde0['body'][_0x379e10(0x1ac)]],_0x386734=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1e1)]],_0x41d303=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1e6)]],_0x4084d9=[_0xaebde0['body']['sales_quantity_QA']],_0xf96f95=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x259)]],_0x62fe09=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x260)]],_0x231f2b=[_0xaebde0[_0x379e10(0x1b5)]['maxPerUnit_QA']],_0x3abfcd=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x209)]],_0x567e1b=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x21c)]],_0x4832d6=[_0xaebde0[_0x379e10(0x1b5)]['secondary_unit_QA']],_0x385201=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1fa)]],_0x34e9af=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x29b)]],_0x57f5b4=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1d0)]];else var _0x1009a5=[..._0xaebde0['body']['product_name_QA1']],_0x394587=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1ac)]],_0x386734=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1e1)]],_0x41d303=[..._0xaebde0['body'][_0x379e10(0x1e6)]],_0x4084d9=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x204)]],_0xf96f95=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x259)]],_0x62fe09=[..._0xaebde0['body'][_0x379e10(0x260)]],_0x231f2b=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1db)]],_0x3abfcd=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x209)]],_0x567e1b=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x21c)]],_0x4832d6=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1a6)]],_0x385201=[..._0xaebde0['body'][_0x379e10(0x1fa)]],_0x34e9af=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x29b)]],_0x57f5b4=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1d0)]];const _0x1801a2=_0x1009a5[_0x379e10(0x1ef)](_0x376b65=>{return _0x376b65={'product_name':_0x376b65};});_0x394587[_0x379e10(0x2a3)]((_0x5c0664,_0x3850f2)=>{var _0x59b041=_0x379e10;_0x1801a2[_0x3850f2][_0x59b041(0x1f9)]=_0x5c0664;}),_0x386734['forEach']((_0x1c99b6,_0x3d342a)=>{var _0x43ac2a=_0x379e10;_0x1801a2[_0x3d342a][_0x43ac2a(0x23c)]=_0x1c99b6;}),_0x41d303[_0x379e10(0x2a3)]((_0x5db414,_0x17d55d)=>{var _0x1cfcf1=_0x379e10;_0x1801a2[_0x17d55d][_0x1cfcf1(0x231)]=_0x5db414;}),_0x4084d9[_0x379e10(0x2a3)]((_0x34fec3,_0x32d7d7)=>{var _0x2183c6=_0x379e10;_0x1801a2[_0x32d7d7][_0x2183c6(0x275)]=_0x34fec3;}),_0xf96f95[_0x379e10(0x2a3)]((_0x2c93f4,_0x3a10da)=>{var _0x553eef=_0x379e10;_0x1801a2[_0x3a10da][_0x553eef(0x243)]=_0x2c93f4;}),_0x62fe09[_0x379e10(0x2a3)]((_0x331891,_0x554963)=>{var _0x44cf56=_0x379e10;_0x1801a2[_0x554963][_0x44cf56(0x21b)]=_0x331891;}),_0x231f2b[_0x379e10(0x2a3)]((_0x46e535,_0x4c7a2c)=>{_0x1801a2[_0x4c7a2c]['maxPerUnit']=_0x46e535;}),_0x3abfcd[_0x379e10(0x2a3)]((_0x3662d8,_0x459d4f)=>{var _0x5c7ab7=_0x379e10;_0x1801a2[_0x459d4f][_0x5c7ab7(0x1ba)]=_0x3662d8;}),_0x567e1b['forEach']((_0x4d413f,_0x58de12)=>{var _0x2ab78a=_0x379e10;_0x1801a2[_0x58de12][_0x2ab78a(0x268)]=_0x4d413f;}),_0x4832d6[_0x379e10(0x2a3)]((_0x19ead5,_0x52eed2)=>{var _0x59f213=_0x379e10;_0x1801a2[_0x52eed2][_0x59f213(0x2a5)]=_0x19ead5;}),_0x385201['forEach']((_0x9a8b5,_0x357729)=>{var _0x332543=_0x379e10;_0x1801a2[_0x357729][_0x332543(0x264)]=_0x9a8b5;}),_0x34e9af['forEach']((_0x3dcd85,_0x1b941d)=>{_0x1801a2[_0x1b941d]['production_date']=_0x3dcd85;}),_0x57f5b4[_0x379e10(0x2a3)]((_0x10a344,_0x4a50fb)=>{var _0x57319e=_0x379e10;_0x1801a2[_0x4a50fb][_0x57319e(0x1b2)]=_0x10a344;});const _0x23d664=await sales_finished[_0x379e10(0x240)]({'invoice':_0x4a48f7});_0x23d664[_0x379e10(0x265)]=_0x379e10(0x258);const _0x37c2f8=await _0x23d664[_0x379e10(0x1e2)](),_0x2b1561=new sales_return_finished({'invoice':_0x4a48f7,'customer':_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x26d)],'date':_0x51dd6f,'warehouse_name':_0x33ee3d,'room':_0x5ed521,'ToWarehouse':_0x3d8763,'ToRoom':_0x2618a7,'return_sale_QA':_0x1801a2,'note':_0x28543e,'warehouse_cat':_0x314133}),_0x42d34b=await _0x2b1561[_0x379e10(0x1e2)](),_0x159e99=await sales_return_finished['findOne']({'invoice':_0x4a48f7}),_0xc080e7=await warehouse[_0x379e10(0x240)]({'name':_0x3d8763,'room':_0x2618a7});_0x159e99[_0x379e10(0x246)][_0x379e10(0x2a3)](_0x21e9be=>{var _0x38b53a=_0x379e10,_0x40d22b=0x0;const _0x2e95d9=_0xc080e7[_0x38b53a(0x256)][_0x38b53a(0x1ef)](_0x50ec39=>{var _0x1d3f72=_0x38b53a;_0x50ec39[_0x1d3f72(0x1ab)]==_0x21e9be['product_name']&&_0x50ec39[_0x1d3f72(0x1b2)]==_0x21e9be[_0x1d3f72(0x1b2)]&&_0x50ec39[_0x1d3f72(0x1c2)]==_0x21e9be[_0x1d3f72(0x1c2)]&&_0x50ec39[_0x1d3f72(0x268)]==_0x21e9be['batch_code']&&(_0x50ec39[_0x1d3f72(0x1b8)]=parseInt(_0x50ec39['product_stock'])+parseInt(_0x21e9be[_0x1d3f72(0x21b)]),_0x40d22b++);});_0x40d22b=='0'&&(_0xc080e7['product_details']=_0xc080e7[_0x38b53a(0x256)][_0x38b53a(0x22e)]({'product_name':_0x21e9be[_0x38b53a(0x1ab)],'product_stock':_0x21e9be[_0x38b53a(0x21b)],'primary_code':_0x21e9be['primary_code'],'secondary_code':_0x21e9be[_0x38b53a(0x23c)],'product_code':_0x21e9be[_0x38b53a(0x231)],'batch_code':_0x21e9be[_0x38b53a(0x268)],'maxPerUnit':_0x21e9be['maxPerUnit'],'production_date':_0x21e9be[_0x38b53a(0x1c2)],'expiry_date':_0x21e9be[_0x38b53a(0x1b2)],'secondary_unit':_0x21e9be[_0x38b53a(0x2a5)],'unit':_0x21e9be['unit'],'maxProducts':_0x21e9be[_0x38b53a(0x1ba)],'bay':_0x21e9be[_0x38b53a(0x2ae)]}));}),await _0xc080e7['save']();const _0x21bac3=new c_payment_data({'invoice':_0x4a48f7,'customer':_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x26d)],'reason':_0x379e10(0x201)});await _0x21bac3[_0x379e10(0x1e2)]();const _0x1803de=await master_shop[_0x379e10(0x19f)](),_0x1beec3=await email_settings['findOne'](),_0xe2f803=await customer['findOne']({'name':_0xaebde0[_0x379e10(0x1b5)]['customer']});_0x1803de[0x0][_0x379e10(0x234)]==0x1?(right_currency=_0x1803de[0x0][_0x379e10(0x244)],left_currency=''):(right_currency='',left_currency=_0x1803de[0x0][_0x379e10(0x244)]);var _0x4f062b=_0x1009a5,_0x158326=_0x62fe09,_0x1fbe5e='',_0x2000ec;for(_0x2000ec in _0x4f062b){_0x1fbe5e+=_0x379e10(0x1f6)+_0x379e10(0x279)+_0x4f062b[_0x2000ec]+'</td>'+_0x379e10(0x279)+_0x158326[_0x2000ec]+_0x379e10(0x235)+_0x379e10(0x26c);}console[_0x379e10(0x217)](_0x379e10(0x274),_0x1fbe5e);let _0x4bbb54=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x1beec3['email'],'pass':_0x1beec3['password']}}),_0x3070b1={'from':_0x1beec3[_0x379e10(0x24b)],'to':_0xe2f803[_0x379e10(0x24b)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x379e10(0x219),'path':__dirname+_0x379e10(0x24d)+'/upload/'+_0x1803de[0x0][_0x379e10(0x273)],'cid':'logo'}],'html':_0x379e10(0x214)+_0x379e10(0x223)+_0x379e10(0x1c5)+_0x379e10(0x1bb)+_0x379e10(0x241)+_0x379e10(0x1bb)+_0x379e10(0x22d)+'</div>'+_0x379e10(0x1bb)+_0x379e10(0x23e)+_0x1803de[0x0][_0x379e10(0x28c)]+_0x379e10(0x24a)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x379e10(0x26f)+_0x379e10(0x1e9)+_0x4a48f7+'\x20'+_0x379e10(0x289)+_0x379e10(0x2a6)+_0x51dd6f+'\x20'+'</span>'+'</h5>'+_0x379e10(0x20b)+_0x379e10(0x1cf)+_0x379e10(0x1e8)+_0x379e10(0x1f6)+_0x379e10(0x225)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x379e10(0x285)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1fbe5e+'\x20'+_0x379e10(0x288)+_0x379e10(0x1fb)+_0x379e10(0x1bb)+'<strong>\x20Regards\x20</strong>'+_0x379e10(0x25d)+_0x1803de[0x0][_0x379e10(0x28c)]+_0x379e10(0x1be)+_0x379e10(0x20b)+_0x379e10(0x20b)+_0x379e10(0x262)};_0x4bbb54['sendMail'](_0x3070b1,function(_0x380931,_0x4ca465){var _0x14dc3d=_0x379e10;_0x380931?(console[_0x14dc3d(0x217)](_0x380931),console[_0x14dc3d(0x217)](_0x14dc3d(0x1b0))):console[_0x14dc3d(0x217)]('Email\x20sent\x20successfully');}),_0xaebde0[_0x379e10(0x261)](_0x379e10(0x1e3),_0x379e10(0x1f1)),_0x142b89[_0x379e10(0x1ff)]('/all_sales_finished/view');}catch(_0x2f251b){_0x142b89['status'](0xc8)[_0x379e10(0x21d)]({'message1':_0x2f251b[_0x379e10(0x1fe)]});}else{if(_0xaebde0['body']['for_categorize']=='GS')try{const {invoice:_0x160458,date:_0x4d173c,warehouse_name:_0x54fdd5,product_name:_0x32a1c1,primary_code:_0xb9d543,secondary_code:_0x186e49,product_code:_0x35beee,sales_quantity:_0x1c9ba1,stocks:_0x499424,return_qty:_0x5c0c4d,Room_name:_0x291feb,to_warehouse_name:_0x4a9652,to_Room_name:_0x15d43f,note:_0x3eb09a,level:_0x2d0bf4,isle:_0x44c0a0,pallet:_0x38c6c7,for_categorize:_0x36e306}=_0xaebde0[_0x379e10(0x1b5)];if(typeof _0x32a1c1=='string')var _0x1009a5=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1ab)]],_0x394587=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1f9)]],_0x386734=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x23c)]],_0x41d303=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x231)]],_0x4084d9=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x263)]],_0x62fe09=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x21b)]],_0x425e48=[_0xaebde0['body'][_0x379e10(0x2ae)]],_0x231f2b=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x21a)]],_0x3abfcd=[_0xaebde0['body'][_0x379e10(0x1ba)]],_0x567e1b=[_0xaebde0[_0x379e10(0x1b5)]['batch_code']],_0x4832d6=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x2a5)]],_0x385201=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x264)]],_0x34e9af=[_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1c2)]],_0x57f5b4=[_0xaebde0[_0x379e10(0x1b5)]['expiry_date']];else var _0x1009a5=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1ab)]],_0x394587=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1f9)]],_0x386734=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x23c)]],_0x41d303=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x231)]],_0x4084d9=[..._0xaebde0['body'][_0x379e10(0x263)]],_0x62fe09=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x21b)]],_0x425e48=[..._0xaebde0[_0x379e10(0x1b5)]['bay']],_0x231f2b=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x21a)]],_0x3abfcd=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x1ba)]],_0x567e1b=[..._0xaebde0['body'][_0x379e10(0x268)]],_0x4832d6=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x2a5)]],_0x385201=[..._0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x264)]],_0x34e9af=[..._0xaebde0['body'][_0x379e10(0x1c2)]],_0x57f5b4=[..._0xaebde0[_0x379e10(0x1b5)]['expiry_date']];const _0x171a15=_0x1009a5[_0x379e10(0x1ef)](_0xb48aaa=>{return _0xb48aaa={'product_name':_0xb48aaa};});_0x394587[_0x379e10(0x2a3)]((_0x25124f,_0x245d80)=>{var _0x22ad56=_0x379e10;_0x171a15[_0x245d80][_0x22ad56(0x1f9)]=_0x25124f;}),_0x386734[_0x379e10(0x2a3)]((_0x3daa17,_0x28b4ad)=>{var _0x1d6230=_0x379e10;_0x171a15[_0x28b4ad][_0x1d6230(0x23c)]=_0x3daa17;}),_0x41d303['forEach']((_0x5af966,_0x247d8c)=>{_0x171a15[_0x247d8c]['product_code']=_0x5af966;}),_0x4084d9[_0x379e10(0x2a3)]((_0x2b32ad,_0x231098)=>{var _0x224339=_0x379e10;_0x171a15[_0x231098][_0x224339(0x275)]=_0x2b32ad;}),_0x62fe09['forEach']((_0x57dd53,_0x72e6d1)=>{var _0x804510=_0x379e10;_0x171a15[_0x72e6d1][_0x804510(0x21b)]=_0x57dd53;}),_0x425e48[_0x379e10(0x2a3)]((_0x3f8f2f,_0x27bdde)=>{var _0x5cedf9=_0x379e10;_0x171a15[_0x27bdde][_0x5cedf9(0x2ae)]=_0x3f8f2f;}),_0x231f2b[_0x379e10(0x2a3)]((_0x44a394,_0x59b59d)=>{var _0x1b7728=_0x379e10;_0x171a15[_0x59b59d][_0x1b7728(0x21a)]=_0x44a394;}),_0x3abfcd['forEach']((_0x248ed0,_0x2b414c)=>{var _0x2b2bd6=_0x379e10;_0x171a15[_0x2b414c][_0x2b2bd6(0x1ba)]=_0x248ed0;}),_0x567e1b['forEach']((_0x26c3fa,_0x52754e)=>{_0x171a15[_0x52754e]['batch_code']=_0x26c3fa;}),_0x4832d6[_0x379e10(0x2a3)]((_0x136200,_0x45c318)=>{var _0x44fb8c=_0x379e10;_0x171a15[_0x45c318][_0x44fb8c(0x2a5)]=_0x136200;}),_0x385201[_0x379e10(0x2a3)]((_0x374d57,_0x2203a6)=>{_0x171a15[_0x2203a6]['unit']=_0x374d57;}),_0x34e9af[_0x379e10(0x2a3)]((_0x8fb156,_0x1d0885)=>{var _0x38eaa6=_0x379e10;_0x171a15[_0x1d0885][_0x38eaa6(0x1c2)]=_0x8fb156;}),_0x57f5b4[_0x379e10(0x2a3)]((_0x504abc,_0xa1e271)=>{var _0x3bfe79=_0x379e10;_0x171a15[_0xa1e271][_0x3bfe79(0x1b2)]=_0x504abc;});var _0x5049e7=0x0;_0x171a15['forEach'](_0x2f7524=>{var _0x4eaef6=_0x379e10;(parseInt(_0x2f7524['sale_qty'])<parseInt(_0x2f7524[_0x4eaef6(0x21b)])||parseInt(_0x2f7524[_0x4eaef6(0x243)])<parseInt(_0x2f7524[_0x4eaef6(0x21b)])&&parseInt(_0x2f7524[_0x4eaef6(0x275)])>parseInt(_0x2f7524[_0x4eaef6(0x21b)])||parseInt(_0x2f7524[_0x4eaef6(0x21b)])==0x0)&&_0x5049e7++;});if(_0x5049e7!=0x0)return _0xaebde0[_0x379e10(0x261)](_0x379e10(0x237),_0x379e10(0x253)),_0x142b89['redirect'](_0x379e10(0x220));const _0x3fa338=await sales_finished[_0x379e10(0x240)]({'invoice':_0x160458});_0x3fa338[_0x379e10(0x265)]='True';const _0x27deb9=await _0x3fa338[_0x379e10(0x1e2)](),_0x469791=new sales_return_finished({'invoice':_0x160458,'customer':_0xaebde0[_0x379e10(0x1b5)]['customer'],'date':_0x4d173c,'warehouse_name':_0x54fdd5,'room':_0x291feb,'ToWarehouse':_0x4a9652,'ToRoom':_0x15d43f,'return_sale':_0x171a15,'note':_0x3eb09a,'warehouse_cat':_0x36e306}),_0x113797=await _0x469791[_0x379e10(0x1e2)](),_0x4879d0=await sales_return_finished[_0x379e10(0x240)]({'invoice':_0x160458}),_0xba1e9a=await warehouse[_0x379e10(0x240)]({'name':_0x4a9652,'room':_0x15d43f,'warehouse_category':_0x379e10(0x1d4)});_0x4879d0[_0x379e10(0x298)][_0x379e10(0x2a3)](_0x32fd1f=>{var _0x5487e7=_0x379e10,_0x480775=0x0;const _0x178598=_0xba1e9a[_0x5487e7(0x256)]['map'](_0x45ec8a=>{var _0x4f5710=_0x5487e7;_0x45ec8a[_0x4f5710(0x1ab)]==_0x32fd1f[_0x4f5710(0x1ab)]&&_0x45ec8a[_0x4f5710(0x2ae)]==_0x32fd1f['bay']&&_0x45ec8a['expiry_date']==_0x32fd1f[_0x4f5710(0x1b2)]&&_0x45ec8a[_0x4f5710(0x1c2)]==_0x32fd1f[_0x4f5710(0x1c2)]&&_0x45ec8a[_0x4f5710(0x268)]==_0x32fd1f[_0x4f5710(0x268)]&&(_0x45ec8a[_0x4f5710(0x1b8)]=parseInt(_0x45ec8a['product_stock'])+parseInt(_0x32fd1f[_0x4f5710(0x21b)]),_0x480775++);});_0x480775=='0'&&(_0xba1e9a['product_details']=_0xba1e9a[_0x5487e7(0x256)][_0x5487e7(0x22e)]({'product_name':_0x32fd1f['product_name'],'product_stock':_0x32fd1f[_0x5487e7(0x21b)],'primary_code':_0x32fd1f[_0x5487e7(0x1f9)],'secondary_code':_0x32fd1f[_0x5487e7(0x23c)],'product_code':_0x32fd1f[_0x5487e7(0x231)],'bay':_0x32fd1f[_0x5487e7(0x2ae)],'batch_code':_0x32fd1f[_0x5487e7(0x268)],'maxPerUnit':_0x32fd1f[_0x5487e7(0x21a)],'production_date':_0x32fd1f[_0x5487e7(0x1c2)],'expiry_date':_0x32fd1f[_0x5487e7(0x1b2)],'secondary_unit':_0x32fd1f[_0x5487e7(0x2a5)],'unit':_0x32fd1f[_0x5487e7(0x264)],'maxProducts':_0x32fd1f['maxProducts']}));}),await _0xba1e9a[_0x379e10(0x1e2)](),console['log'](_0xaebde0[_0x379e10(0x1b5)]);const _0xe2d945=new c_payment_data({'invoice':_0x160458,'customer':_0xaebde0['body'][_0x379e10(0x26d)],'reason':_0x379e10(0x201)});await _0xe2d945[_0x379e10(0x1e2)]();const _0x279d44=await master_shop[_0x379e10(0x19f)]();console[_0x379e10(0x217)](_0x379e10(0x251),_0x279d44[0x0][_0x379e10(0x273)]);const _0x3da985=await email_settings[_0x379e10(0x240)](),_0xe6b27b=await customer[_0x379e10(0x240)]({'name':_0xaebde0[_0x379e10(0x1b5)][_0x379e10(0x26d)]});console['log'](_0x379e10(0x2a0),_0xe6b27b);_0x279d44[0x0][_0x379e10(0x234)]==0x1?(right_currency=_0x279d44[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x279d44[0x0][_0x379e10(0x244)]);var _0x4f062b=_0x1009a5,_0x158326=_0x62fe09,_0x1fbe5e='',_0x2000ec;for(_0x2000ec in _0x4f062b){_0x1fbe5e+=_0x379e10(0x1f6)+_0x379e10(0x279)+_0x4f062b[_0x2000ec]+_0x379e10(0x235)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x158326[_0x2000ec]+_0x379e10(0x235)+'</tr>';}console[_0x379e10(0x217)](_0x379e10(0x274),_0x1fbe5e);let _0x4126a8=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x3da985[_0x379e10(0x24b)],'pass':_0x3da985[_0x379e10(0x248)]}}),_0x214ba8={'from':_0x3da985[_0x379e10(0x24b)],'to':_0xe6b27b[_0x379e10(0x24b)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x379e10(0x219),'path':__dirname+_0x379e10(0x24d)+'/upload/'+_0x279d44[0x0]['image'],'cid':_0x379e10(0x242)}],'html':_0x379e10(0x214)+_0x379e10(0x223)+_0x379e10(0x1c5)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x379e10(0x22d)+_0x379e10(0x20b)+_0x379e10(0x1bb)+'<h2>\x20'+_0x279d44[0x0][_0x379e10(0x28c)]+_0x379e10(0x24a)+_0x379e10(0x20b)+_0x379e10(0x20b)+_0x379e10(0x2a1)+_0x379e10(0x1bb)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x379e10(0x1e9)+_0x160458+'\x20'+_0x379e10(0x289)+_0x379e10(0x2a6)+_0x4d173c+'\x20'+_0x379e10(0x26e)+'</h5>'+_0x379e10(0x20b)+_0x379e10(0x1cf)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x379e10(0x225)+_0x379e10(0x250)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x379e10(0x1bc)+_0x379e10(0x26c)+_0x379e10(0x285)+_0x379e10(0x1bd)+'\x20'+_0x1fbe5e+'\x20'+_0x379e10(0x288)+_0x379e10(0x1fb)+_0x379e10(0x1bb)+_0x379e10(0x1f3)+'<h5>'+_0x279d44[0x0]['site_title']+_0x379e10(0x1be)+_0x379e10(0x20b)+_0x379e10(0x20b)+'</body></html>'};_0x4126a8[_0x379e10(0x23a)](_0x214ba8,function(_0x3d27d5,_0x55e200){var _0x2c01c3=_0x379e10;_0x3d27d5?(console['log'](_0x3d27d5),console['log'](_0x2c01c3(0x1b0))):console['log'](_0x2c01c3(0x1aa));}),_0xaebde0[_0x379e10(0x261)](_0x379e10(0x1e3),'sales\x20item\x20return\x20successfull'),_0x142b89[_0x379e10(0x1ff)](_0x379e10(0x266));}catch(_0x1e69ed){console[_0x379e10(0x217)](_0x1e69ed),_0x142b89['status'](0xc8)[_0x379e10(0x21d)]({'message1':_0x1e69ed[_0x379e10(0x1fe)]});}}}),router['get'](a0_0x1a596(0x1ca),auth,async(_0x4fa895,_0x36e9e3)=>{var _0x2d317a=a0_0x1a596;try{const {username:_0x3e51e9,email:_0x1ee78f,role:_0x3489b0}=_0x4fa895[_0x2d317a(0x291)],_0x514438=_0x4fa895[_0x2d317a(0x291)],_0x2dc298=await profile[_0x2d317a(0x240)]({'email':_0x514438[_0x2d317a(0x24b)]}),_0x2eea93=await master_shop[_0x2d317a(0x19f)]();console[_0x2d317a(0x217)](_0x2d317a(0x228),_0x2eea93);const _0x5b9734=_0x4fa895[_0x2d317a(0x1ec)]['id'],_0x5aee05=await sales['findById'](_0x5b9734);console['log'](_0x2d317a(0x297),_0x5aee05);if(_0x2eea93[0x0][_0x2d317a(0x1c9)]=='English\x20(US)')var _0x2b2c49=users[_0x2d317a(0x1fd)];else{if(_0x2eea93[0x0][_0x2d317a(0x1c9)]==_0x2d317a(0x1a4))var _0x2b2c49=users['Hindi'];else{if(_0x2eea93[0x0][_0x2d317a(0x1c9)]==_0x2d317a(0x24c))var _0x2b2c49=users[_0x2d317a(0x24c)];else{if(_0x2eea93[0x0]['language']==_0x2d317a(0x1ce))var _0x2b2c49=users[_0x2d317a(0x1ce)];else{if(_0x2eea93[0x0]['language']=='French')var _0x2b2c49=users[_0x2d317a(0x2a9)];else{if(_0x2eea93[0x0][_0x2d317a(0x1c9)]==_0x2d317a(0x1ea))var _0x2b2c49=users[_0x2d317a(0x28b)];else{if(_0x2eea93[0x0][_0x2d317a(0x1c9)]=='Chinese')var _0x2b2c49=users[_0x2d317a(0x1cc)];else{if(_0x2eea93[0x0][_0x2d317a(0x1c9)]==_0x2d317a(0x20e))var _0x2b2c49=users[_0x2d317a(0x282)];}}}}}}}_0x36e9e3[_0x2d317a(0x224)](_0x2d317a(0x257),{'success':_0x4fa895['flash'](_0x2d317a(0x1e3)),'errors':_0x4fa895['flash'](_0x2d317a(0x237)),'role':_0x514438,'profile':_0x2dc298,'alldata':_0x5aee05,'master_shop':_0x2eea93,'language':_0x2b2c49});}catch(_0xdacab8){console[_0x2d317a(0x217)](_0xdacab8);}}),router[a0_0x1a596(0x25e)](a0_0x1a596(0x1f8),async(_0x1dc38f,_0x1a5f7a)=>{var _0x288a12=a0_0x1a596;const {product_code:_0x4086b8,warehouse_name:_0x1fb40a,rooms_data:_0x5933ad,Roomslist:_0x41a605}=_0x1dc38f[_0x288a12(0x1b5)],_0x284a56=_0x41a605[_0x288a12(0x276)](','),_0xf117d2=[];async function _0x12ccec(_0x1c4ecc){var _0x121070=_0x288a12;const _0x37fe0f=await warehouse['aggregate']([{'$match':{'name':_0x1fb40a,'room':_0x1c4ecc}},{'$unwind':_0x121070(0x2a8)},{'$match':{'product_details.primary_code':_0x4086b8}},{'$group':{'_id':_0x121070(0x23d),'name':{'$first':_0x121070(0x21e)},'product_stock':{'$first':_0x121070(0x1ae)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x121070(0x1f4)},'level':{'$first':_0x121070(0x1b4)},'isle':{'$first':_0x121070(0x269)},'type':{'$first':_0x121070(0x20f)},'pallet':{'$first':_0x121070(0x2ac)},'unit':{'$first':_0x121070(0x1a8)},'secondary_unit':{'$first':_0x121070(0x236)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x121070(0x1b6)},'expiry_date':{'$first':_0x121070(0x245)},'production_date':{'$first':_0x121070(0x206)},'maxPerUnit':{'$first':_0x121070(0x1f5)},'batch_code':{'$first':_0x121070(0x239)},'product_cat':{'$first':_0x121070(0x28f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x4d3f09=await warehouse[_0x121070(0x2b0)]([{'$match':{'name':_0x1fb40a,'room':_0x1c4ecc}},{'$unwind':_0x121070(0x2a8)},{'$match':{'product_details.secondary_code':_0x4086b8}},{'$group':{'_id':_0x121070(0x23d),'name':{'$first':_0x121070(0x21e)},'product_stock':{'$first':_0x121070(0x1ae)},'primary_code':{'$first':_0x121070(0x2aa)},'secondary_code':{'$first':_0x121070(0x255)},'product_code':{'$first':_0x121070(0x1f4)},'level':{'$first':_0x121070(0x1b4)},'isle':{'$first':_0x121070(0x269)},'type':{'$first':_0x121070(0x20f)},'pallet':{'$first':_0x121070(0x2ac)},'unit':{'$first':_0x121070(0x1a8)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x121070(0x1a5)},'rack':{'$first':_0x121070(0x1b6)},'expiry_date':{'$first':_0x121070(0x245)},'production_date':{'$first':_0x121070(0x206)},'maxPerUnit':{'$first':_0x121070(0x1f5)},'batch_code':{'$first':_0x121070(0x239)},'product_cat':{'$first':_0x121070(0x28f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x121070(0x19a)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x37fe0f['length']>0x0)_0xf117d2[_0x121070(0x1b1)](_0x37fe0f);else _0x4d3f09[_0x121070(0x208)]>0x0&&_0xf117d2[_0x121070(0x1b1)](_0x4d3f09);}const _0x47593e=_0x284a56['map'](_0x59a6ce=>_0x12ccec(_0x59a6ce));await Promise[_0x288a12(0x1da)](_0x47593e),_0x1a5f7a[_0x288a12(0x21d)](_0xf117d2);}),module[a0_0x1a596(0x27b)]=router;