var a0_0xc2500c=a0_0x47bf;(function(_0x1c1032,_0x4f78ab){var _0x790abb=a0_0x47bf,_0x59a96c=_0x1c1032();while(!![]){try{var _0x155a05=parseInt(_0x790abb(0x1a1))/0x1+parseInt(_0x790abb(0x132))/0x2+parseInt(_0x790abb(0x1e3))/0x3+-parseInt(_0x790abb(0x186))/0x4+parseInt(_0x790abb(0x18e))/0x5+parseInt(_0x790abb(0x17a))/0x6+-parseInt(_0x790abb(0x184))/0x7;if(_0x155a05===_0x4f78ab)break;else _0x59a96c['push'](_0x59a96c['shift']());}catch(_0x4bd875){_0x59a96c['push'](_0x59a96c['shift']());}}}(a0_0x37ce,0xc9331));function a0_0x37ce(){var _0x1b5372=['unit_QA','slice','push','padStart','<div>','expiry_date_QA','Sales\x20Update\x20successfully','$sale_product.floorlevel','Ambient','$product_details.secondary_unit','status','/view/return_sales/:id','product_code','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','Arabic\x20(ae)','site_title','1098299ZAtJTq','Enclosed','$sale_product.quantity','unit','length','$product_details.type','</table>','success','render','quantity','return_data','floor','</td>','all_sales_barcode','product_details','batch_code','gmail','\x20>>>\x20','sale_qty','flash','prod_invoice','room','</div>','maxProducts','max_per_unit','$product_details.product_code','$product_details.product_cat','/view/:id','log','invoice','post','all_sales_finished','prod_cat','<span\x20style=\x22float:\x20right;\x22>','<strong>\x20Regards\x20</strong>','carton','Error\x20Occurs','DRY\x20GOODS','maxperunit','note','exports','staff','$product_details.production_date','return_qty','\x20Order\x20Number\x20:\x20','sales_quantity','sales\x20item\x20return\x20successfull','stock_data','_id','$sale_product.type','$sale_product.bin','</head><body>','$product_details.secondary_code','RoomAssigned','room_name','role','master','$product_details.maxProducts','\x20<<<==>>>\x20','$product_details.floorlevel','$product_details.rack','German','\x20Order\x20Date\x20:\x20','/all_sales/view','\x20<>\x20','string','905766QiMjPx','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','redirect','$date','<tr>','express','\x20&&\x20','bay','filter','../middleware/auth','<h5\x20style=\x22text-align:\x20left;\x22>','product_date','return_sale','params','</tbody>','$warehouse_name','$_id','$product_details','ADD\x20SALE','concat','An\x20error\x20occurred.','barcode\x20user_id','amount','$note','level','add_sales_finished','Quality\x20Inspection','error','barcode\x20Product\x20master','True','product_code_QA','production_date_QA','due_amount','finalize','$room','/invoice/:id','stock','\x20==\x20','secondary_code','return_sale_finished','purchases_data','$product_details.product_stock','Finished\x20Goods','$product_details.batch_code','edit_sales_finished','</span>','secondary_unit_QA','return_qty_QA','product_stock','/preview/:id','$product_details.bin','aggregate','$product_details.maxPerUnit','Logo.png','$product_details.invoice','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','customers','json','findById','Spanish','currency_placement','</thead>','/view/add_sales','primary_unit','English\x20(US)','id_transaction_from','/picking_list/pdf/','christian.villamer@jakagroup.com','/view','French','FGSEmail','primary_code','QA\x20Warehouse','prod_code','Sale\x20Return\x20Mail','then','$return_data','production_date','get','$customers_docs','product_list','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Email\x20sent\x20successfully','catch','getFullYear','</body></html>','$product_details.bay','$product_details.storage','findOne','return_sale_QA','createTransport','/barcode/:id','/view/add_sale/product','/upload/','OUTF-','sales_quantity_QA','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','nodemailer','map','user','add\x20post','<tbody\x20style=\x22text-align:\x20center;\x22>','random','Portuguese\x20(BR)','Portuguese','../models/all_models','<table\x20style=\x22width:\x20100%\x20!important;\x22>','494716DeDUXk','maxPerUnit','for_categorize','body','sale_product','Return\x20Rooms','secondary_unit','customers_docs','batch_code_QA','language','name','product_data','all','date','email','maxPerUnit_QA','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','maxProducts_QA','Hindi','Arabic','<hr\x20class=\x22my-3\x22>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','forEach','image','$sale_product','$product_details._id','\x20</h2>','/view/add_sales/:id','English','$product_details.expiry_date','$finalize','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','../public/language/languages.json','/give_payment/:id','final','product_name_QA1','<html><head><title></title>','$customer','Enabled','$sale_product.bay','/../public','currency','</h5>','warehouse','find','sendMail','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<h2>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','stocks_QA','$invoice','sales_invoice','port','primary_code_QA','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','host','password','message','$name','errors','False','back','product_name','$product_details.primary_code','Sales\x20Mail','suppliers','Sale\x20Return','Return\x20Goods','save','/barcode_scanner','5112672yDlDRe','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','expiry_date','customer','getDate','/all_sales_finished/view','<!DOCTYPE\x20html>','$product_details.product_name','adjust_qty','7371994YyMqGP','abs','2723888MxTmwx','foreach\x20newproduct','secondary_code_QA','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','</tr>','Chinese','getMonth','292680dMLbpw','warehouse_name','<h5>'];a0_0x37ce=function(){return _0x1b5372;};return a0_0x37ce();}const express=require(a0_0xc2500c(0x1e8)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0xc2500c(0x130)),auth=require(a0_0xc2500c(0x1ec)),nodemailer=require(a0_0xc2500c(0x128)),users=require(a0_0xc2500c(0x153));router[a0_0xc2500c(0x115)](a0_0xc2500c(0x10b),auth,async(_0x4ad678,_0x4a577d)=>{var _0x14bcde=a0_0xc2500c;try{const {username:_0xfeb846,email:_0x34c74d,role:_0x4edaa6}=_0x4ad678[_0x14bcde(0x12a)],_0x468da7=_0x4ad678[_0x14bcde(0x12a)],_0x10a82c=await profile[_0x14bcde(0x11f)]({'email':_0x468da7[_0x14bcde(0x140)]}),_0x156648=await master_shop[_0x14bcde(0x15f)]();let _0xc05f2c;if(_0x468da7[_0x14bcde(0x1d8)]==_0x14bcde(0x1ca)){const _0x43a135=await staff[_0x14bcde(0x11f)]({'email':_0x468da7[_0x14bcde(0x140)]});_0xc05f2c=await sales_finished[_0x14bcde(0xfa)]([{'$lookup':{'from':'customers','localField':_0x14bcde(0x17e),'foreignField':_0x14bcde(0x13c),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x14bcde(0x14b)},{'$group':{'_id':_0x14bcde(0x1f3),'invoice':{'$first':_0x14bcde(0x165)},'customers':{'$first':_0x14bcde(0x158)},'date':{'$first':_0x14bcde(0x1e6)},'warehouse_name':{'$first':_0x14bcde(0x1f2)},'sale_product':{'$push':_0x14bcde(0x14b)},'note':{'$first':_0x14bcde(0x1fa)},'return_data':{'$first':_0x14bcde(0x113)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x14bcde(0x1d3)},'type':{'$addToSet':_0x14bcde(0x1d2)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x14bcde(0x151)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0xc05f2c=await sales_finished[_0x14bcde(0xfa)]([{'$lookup':{'from':_0x14bcde(0xff),'localField':_0x14bcde(0x17e),'foreignField':_0x14bcde(0x13c),'as':_0x14bcde(0x139)}},{'$unwind':_0x14bcde(0x116)},{'$unwind':_0x14bcde(0x14b)},{'$group':{'_id':_0x14bcde(0x1f3),'invoice':{'$first':_0x14bcde(0x165)},'customers':{'$first':_0x14bcde(0x158)},'date':{'$first':_0x14bcde(0x1e6)},'warehouse_name':{'$first':_0x14bcde(0x1f2)},'sale_product':{'$push':_0x14bcde(0x14b)},'note':{'$first':_0x14bcde(0x1fa)},'return_data':{'$first':_0x14bcde(0x113)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x14bcde(0x1a3)},'level':{'$addToSet':_0x14bcde(0x15a)},'isle':{'$addToSet':_0x14bcde(0x1d3)},'type':{'$addToSet':_0x14bcde(0x1d2)},'pallet':{'$addToSet':_0x14bcde(0x198)},'finalize':{'$first':_0x14bcde(0x151)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x156648[0x0][_0x14bcde(0x13b)]=='English\x20(US)'){var _0x5708f4=users[_0x14bcde(0x14f)];console[_0x14bcde(0x1bd)](_0x5708f4);}else{if(_0x156648[0x0][_0x14bcde(0x13b)]=='Hindi')var _0x5708f4=users['Hindi'];else{if(_0x156648[0x0][_0x14bcde(0x13b)]==_0x14bcde(0x1de))var _0x5708f4=users[_0x14bcde(0x1de)];else{if(_0x156648[0x0][_0x14bcde(0x13b)]==_0x14bcde(0x102))var _0x5708f4=users[_0x14bcde(0x102)];else{if(_0x156648[0x0][_0x14bcde(0x13b)]==_0x14bcde(0x10c))var _0x5708f4=users[_0x14bcde(0x10c)];else{if(_0x156648[0x0]['language']==_0x14bcde(0x12e))var _0x5708f4=users['Portuguese'];else{if(_0x156648[0x0][_0x14bcde(0x13b)]==_0x14bcde(0x18c))var _0x5708f4=users[_0x14bcde(0x18c)];else{if(_0x156648[0x0][_0x14bcde(0x13b)]=='Arabic\x20(ae)')var _0x5708f4=users[_0x14bcde(0x146)];}}}}}}}_0x4a577d['render'](_0x14bcde(0x1c0),{'success':_0x4ad678[_0x14bcde(0x1b4)]('success'),'errors':_0x4ad678[_0x14bcde(0x1b4)]('errors'),'sales':_0xc05f2c,'profile':_0x10a82c,'role':_0x468da7,'master_shop':_0x156648,'language':_0x5708f4});}catch(_0x53ce54){console[_0x14bcde(0x1bd)](_0x53ce54);}});function a0_0x47bf(_0x225abb,_0x3c367a){var _0x37ce9a=a0_0x37ce();return a0_0x47bf=function(_0x47bf71,_0x4e5b57){_0x47bf71=_0x47bf71-0xe3;var _0x32b212=_0x37ce9a[_0x47bf71];return _0x32b212;},a0_0x47bf(_0x225abb,_0x3c367a);}async function getRandom8DigitNumber(){var _0x2f41f3=a0_0xc2500c;const _0x316b66=0x989680,_0x338dfc=0x5f5e0ff,_0x1968ef=Math[_0x2f41f3(0x1ac)](Math[_0x2f41f3(0x12d)]()*(_0x338dfc-_0x316b66+0x1))+_0x316b66;var _0x22edb4;const _0x2998c2=await sales_finished[_0x2f41f3(0x11f)]({'invoice':_0x2f41f3(0x125)+_0x1968ef});return _0x2998c2&&_0x2998c2['length']>0x0?_0x22edb4=_0x2f41f3(0x125)+_0x1968ef:_0x22edb4='OUTF-'+_0x1968ef,_0x22edb4;}router['get']('/view/add_sales',auth,async(_0x19fbb1,_0x4f7f89)=>{var _0x292abc=a0_0xc2500c;try{const {username:_0x4d277e,email:_0x2e01e0,role:_0x26d4e3}=_0x19fbb1['user'],_0x197d33=_0x19fbb1[_0x292abc(0x12a)],_0x53c681=await profile['findOne']({'email':_0x197d33['email']}),_0x1305cc=await master_shop['find'](),_0x2fd07a=await customer[_0x292abc(0x15f)]({});let _0x55924e;if(_0x197d33[_0x292abc(0x1d8)]=='staff'){const _0x3e6746=await staff[_0x292abc(0x11f)]({'email':_0x197d33[_0x292abc(0x140)]});_0x55924e=await warehouse[_0x292abc(0xfa)]([{'$match':{'status':_0x292abc(0x159),'name':_0x3e6746[_0x292abc(0x15e)],'warehouse_category':_0x292abc(0xf1),'name':{'$ne':_0x292abc(0x10f)}}},{'$group':{'_id':'$name','name':{'$first':_0x292abc(0x16e)}}},{'$sort':{'name':0x1}}]);}else _0x55924e=await warehouse[_0x292abc(0xfa)]([{'$match':{'status':_0x292abc(0x159),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x292abc(0x10f)}}},{'$group':{'_id':_0x292abc(0x16e),'name':{'$first':_0x292abc(0x16e)}}},{'$sort':{'name':0x1}}]);const _0x4c79f4=await product[_0x292abc(0x15f)]({});var _0x5ac164=['Ambient',_0x292abc(0x1a2)];const _0x25315d=await sales_finished['find']({}),_0x51dcc9=_0x25315d['length']+0x1,_0xeece70=_0x292abc(0x125)+_0x51dcc9['toString']()[_0x292abc(0x194)](0x5,'0');if(_0x1305cc[0x0][_0x292abc(0x13b)]==_0x292abc(0x107)){var _0x117113=users[_0x292abc(0x14f)];console[_0x292abc(0x1bd)](_0x117113);}else{if(_0x1305cc[0x0][_0x292abc(0x13b)]==_0x292abc(0x145))var _0x117113=users['Hindi'];else{if(_0x1305cc[0x0]['language']==_0x292abc(0x1de))var _0x117113=users['German'];else{if(_0x1305cc[0x0]['language']==_0x292abc(0x102))var _0x117113=users[_0x292abc(0x102)];else{if(_0x1305cc[0x0]['language']==_0x292abc(0x10c))var _0x117113=users['French'];else{if(_0x1305cc[0x0]['language']=='Portuguese\x20(BR)')var _0x117113=users[_0x292abc(0x12f)];else{if(_0x1305cc[0x0][_0x292abc(0x13b)]=='Chinese')var _0x117113=users[_0x292abc(0x18c)];else{if(_0x1305cc[0x0]['language']==_0x292abc(0x19f))var _0x117113=users['Arabic'];}}}}}}}const _0x362a6d=getRandom8DigitNumber();_0x362a6d[_0x292abc(0x112)](_0x2d22ac=>{var _0x387991=_0x292abc;_0x4f7f89['render'](_0x387991(0x1fc),{'success':_0x19fbb1['flash']('success'),'errors':_0x19fbb1[_0x387991(0x1b4)](_0x387991(0x16f)),'role':_0x197d33,'profile':_0x53c681,'customer':_0x2fd07a,'warehouse':_0x55924e,'product':_0x4c79f4,'invoice':_0x2d22ac,'master_shop':_0x1305cc,'language':_0x117113,'rooms_data':_0x5ac164});})['catch'](_0x377cf7=>{var _0x3b520b=_0x292abc;_0x19fbb1[_0x3b520b(0x1b4)](_0x3b520b(0x16f),_0x3b520b(0x148)),_0x4f7f89['redirect'](_0x3b520b(0x180));});}catch(_0x23e56f){console[_0x292abc(0x1bd)](_0x23e56f);}}),router[a0_0xc2500c(0x115)](a0_0xc2500c(0x14e),auth,async(_0x26c46e,_0x13ce90)=>{var _0x5a8f49=a0_0xc2500c;try{const _0x13713c=_0x26c46e['params']['id'];console['log'](_0x13713c);const _0x35e9ad=await product['find'](),_0x4d8f52=await purchases[_0x5a8f49(0xfa)]([{'$match':{'warehouse_name':_0x13713c}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x5a8f49(0xef),_0x4d8f52),_0x13ce90[_0x5a8f49(0x19b)](0xc8)[_0x5a8f49(0x100)]({'purchases_data':_0x4d8f52,'product_data':_0x35e9ad});}catch(_0x390708){console[_0x5a8f49(0x1bd)](_0x390708);}}),router[a0_0xc2500c(0x1bf)](a0_0xc2500c(0x123),auth,async(_0x22e815,_0x16d234)=>{var _0xcdab34=a0_0xc2500c;try{const {warehouse_data:_0x5e19c0,product_data:_0x1f06a3}=_0x22e815[_0xcdab34(0x135)];console[_0xcdab34(0x1bd)](_0x22e815['body'][_0xcdab34(0x13d)]);;const _0x41b514=await master_shop[_0xcdab34(0x15f)]();console[_0xcdab34(0x1bd)](_0xcdab34(0x1d9),_0x41b514);const _0x958393=await product[_0xcdab34(0x11f)]({'name':_0x1f06a3});console[_0xcdab34(0x1bd)]('product',_0x958393);const _0x1f2b05=await warehouse[_0xcdab34(0xfa)]([{'$match':{'name':_0x5e19c0}},{'$unwind':_0xcdab34(0x1f4)},{'$match':{'product_details.product_name':_0x1f06a3}},{'$group':{'_id':_0xcdab34(0x182),'product_stock':{'$first':_0xcdab34(0xf0)}}}]);console[_0xcdab34(0x1bd)](_0xcdab34(0x1d0),_0x1f2b05),_0x16d234[_0xcdab34(0x19b)](0xc8)[_0xcdab34(0x100)]({'master':_0x41b514,'new_product':_0x958393,'stock_data':_0x1f2b05});}catch(_0x34987c){console[_0xcdab34(0x1bd)](_0x34987c);}}),router['post'](a0_0xc2500c(0x105),auth,async(_0x5528a9,_0x1ad912)=>{var _0x27f1b0=a0_0xc2500c;try{const {invoice:_0x36dda2,date:_0xc025f,warehouse_name:_0x1b8abf,product_name:_0x4fb2fa,stock:_0x25638e,quantity:_0x451159,note:_0x57bce5,room:_0x13c18b,primary_code:_0x43e2d6,secondary_code:_0x4ac660,prod_code:_0x29ca53,level:_0x334471,isle:_0x10a596,pallet:_0x54c325,batch_code:_0x17ccb6,SCRN:_0x33deed,expiry_date:_0x5dd269,mode_transpo:_0x29e83f,name_driver:_0x5a45f4}=_0x5528a9[_0x27f1b0(0x135)];if(typeof _0x4fb2fa==_0x27f1b0(0x1e2))var _0x3c097e=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x172)]],_0x26118c=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0xeb)]],_0x52fb54=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1c4)]],_0x392a9b=[_0x5528a9['body'][_0x27f1b0(0x10e)]],_0x1ee3ea=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0xed)]],_0x288348=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x110)]],_0x68ee4b=[_0x5528a9['body'][_0x27f1b0(0x1fb)]],_0x5e8d80=[_0x5528a9[_0x27f1b0(0x135)]['primary_unit']],_0x2b7b8d=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x138)]],_0x55ac06=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1b0)]],_0x4c6757=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x17d)]],_0x1d2e1e=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1ee)]],_0x18fd8d=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1b9)]],_0x512bfc=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1c1)]],_0x35448f=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1d6)]],_0x315aaa=[_0x5528a9['body'][_0x27f1b0(0x1b5)]],_0x4ac535=[_0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x108)]];else var _0x3c097e=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x172)]],_0x26118c=[..._0x5528a9[_0x27f1b0(0x135)]['stock']],_0x52fb54=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1c4)]],_0x392a9b=[..._0x5528a9[_0x27f1b0(0x135)]['primary_code']],_0x1ee3ea=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0xed)]],_0x288348=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x110)]],_0x68ee4b=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1fb)]],_0x5e8d80=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x106)]],_0x2b7b8d=[..._0x5528a9[_0x27f1b0(0x135)]['secondary_unit']],_0x55ac06=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1b0)]],_0x4c6757=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x17d)]],_0x1d2e1e=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1ee)]],_0x18fd8d=[..._0x5528a9[_0x27f1b0(0x135)]['max_per_unit']],_0x512bfc=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x1c1)]],_0x35448f=[..._0x5528a9[_0x27f1b0(0x135)]['RoomAssigned']],_0x315aaa=[..._0x5528a9['body'][_0x27f1b0(0x1b5)]],_0x4ac535=[..._0x5528a9[_0x27f1b0(0x135)][_0x27f1b0(0x108)]];const _0x4f9a29=_0x3c097e[_0x27f1b0(0x129)](_0x52b2f6=>{return _0x52b2f6={'product_name':_0x52b2f6};});_0x26118c['forEach']((_0x252a52,_0x4ec4ac)=>{var _0x2d87a2=_0x27f1b0;_0x4f9a29[_0x4ec4ac][_0x2d87a2(0xeb)]=_0x252a52;}),_0x52fb54[_0x27f1b0(0x149)]((_0x5d5335,_0x39a65b)=>{_0x4f9a29[_0x39a65b]['quantity']=Math['abs'](_0x5d5335);}),_0x4ac535[_0x27f1b0(0x149)]((_0x5d497f,_0x246104)=>{_0x4f9a29[_0x246104]['id_transaction_from']=_0x5d497f;}),_0x392a9b[_0x27f1b0(0x149)]((_0x1f818f,_0x15c544)=>{_0x4f9a29[_0x15c544]['primary_code']=_0x1f818f;}),_0x1ee3ea[_0x27f1b0(0x149)]((_0x2c77ac,_0x1c614b)=>{var _0xb21606=_0x27f1b0;_0x4f9a29[_0x1c614b][_0xb21606(0xed)]=_0x2c77ac;}),_0x288348[_0x27f1b0(0x149)]((_0x280080,_0x3ed963)=>{var _0x2978c1=_0x27f1b0;_0x4f9a29[_0x3ed963][_0x2978c1(0x19d)]=_0x280080;}),_0x68ee4b[_0x27f1b0(0x149)]((_0x1d2051,_0x19f310)=>{_0x4f9a29[_0x19f310]['bay']=_0x1d2051;}),_0x5e8d80['forEach']((_0x363b87,_0x1eae7f)=>{var _0x1f92a4=_0x27f1b0;_0x4f9a29[_0x1eae7f][_0x1f92a4(0x1a4)]=_0x363b87;}),_0x2b7b8d[_0x27f1b0(0x149)]((_0x2f6d5a,_0x223188)=>{_0x4f9a29[_0x223188]['secondary_unit']=_0x2f6d5a;}),_0x55ac06[_0x27f1b0(0x149)]((_0x347010,_0x43b269)=>{var _0x43876d=_0x27f1b0;_0x4f9a29[_0x43b269][_0x43876d(0x1b0)]=_0x347010;}),_0x4c6757['forEach']((_0x4d5321,_0x1d83aa)=>{var _0x52e4fc=_0x27f1b0;_0x4f9a29[_0x1d83aa][_0x52e4fc(0x17d)]=_0x4d5321;}),_0x1d2e1e[_0x27f1b0(0x149)]((_0x5c6f0f,_0x39c09c)=>{var _0x8d7ea1=_0x27f1b0;_0x4f9a29[_0x39c09c][_0x8d7ea1(0x114)]=_0x5c6f0f;}),_0x18fd8d['forEach']((_0x36b4bc,_0x4e7c80)=>{var _0x3fd21f=_0x27f1b0;_0x4f9a29[_0x4e7c80][_0x3fd21f(0x1c7)]=_0x36b4bc;}),_0x512bfc[_0x27f1b0(0x149)]((_0x1c4749,_0xf8b64e)=>{var _0x533bb5=_0x27f1b0;_0x4f9a29[_0xf8b64e][_0x533bb5(0x1c1)]=_0x1c4749;}),_0x35448f[_0x27f1b0(0x149)]((_0x240f6d,_0x17805b)=>{_0x4f9a29[_0x17805b]['room_name']=_0x240f6d;}),_0x315aaa[_0x27f1b0(0x149)]((_0x15da7e,_0xf8a95c)=>{var _0x4ce3c7=_0x27f1b0;_0x4f9a29[_0xf8a95c][_0x4ce3c7(0x1be)]=_0x15da7e;});var _0x338404=0x0;_0x4f9a29[_0x27f1b0(0x149)](_0x2fe988=>{var _0x550eda=_0x27f1b0;parseFloat(_0x2fe988['stock'])<parseFloat(_0x2fe988[_0x550eda(0x1aa)])&&parseFloat(_0x2fe988[_0x550eda(0x1aa)])>parseFloat(_0x2fe988['stock'])&&(console['log'](_0x2fe988[_0x550eda(0xeb)]+_0x550eda(0x1e1)+_0x2fe988['quantity']),_0x338404++);});if(_0x338404!=0x0)return _0x5528a9[_0x27f1b0(0x1b4)](_0x27f1b0(0x16f),_0x27f1b0(0x19e)),_0x1ad912[_0x27f1b0(0x1e5)](_0x27f1b0(0x171));const _0x45c8b2=_0x4f9a29['filter'](_0x5a8f7c=>_0x5a8f7c[_0x27f1b0(0x1aa)]!=='0'&&_0x5a8f7c[_0x27f1b0(0x1aa)]!==''),_0x287a30=new sales_finished({'invoice':_0x36dda2,'customer':_0x5528a9['body'][_0x27f1b0(0x17e)],'date':_0xc025f,'warehouse_name':_0x1b8abf,'sale_product':_0x45c8b2,'note':_0x57bce5,'room':_0x13c18b,'primary_code':_0x43e2d6,'secondary_code':_0x4ac660,'prod_code':_0x29ca53,'SCRN':_0x33deed,'finalize':_0x27f1b0(0x170),'mode_transpo':_0x29e83f,'name_driver':_0x5a45f4}),_0x413838=await _0x287a30['save'](),_0x3be169=await sales_finished[_0x27f1b0(0x11f)]({'invoice':_0x36dda2}),_0x1a0d02=new c_payment_data({'invoice':_0x36dda2,'customer':_0x5528a9['body'][_0x27f1b0(0x17e)],'reason':'Sale'});await _0x1a0d02[_0x27f1b0(0x178)]();const _0x18d79d=await master_shop['find'](),_0x1ed283=await email_settings[_0x27f1b0(0x11f)](),_0x3c7b90=await customer['findOne']({'name':_0x5528a9['body'][_0x27f1b0(0x17e)]});_0x18d79d[0x0][_0x27f1b0(0x103)]==0x1?(right_currency=_0x18d79d[0x0][_0x27f1b0(0x15c)],left_currency=''):(right_currency='',left_currency=_0x18d79d[0x0]['currency']);var _0xb5af15=_0x3c097e,_0x32e952=_0x52fb54,_0x1823c1='',_0x120dba;for(_0x120dba in _0xb5af15){_0x1823c1+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xb5af15[_0x120dba]+_0x27f1b0(0x1ad)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32e952[_0x120dba]+_0x27f1b0(0x1ad)+_0x27f1b0(0x18b);}console[_0x27f1b0(0x1bd)]('product_list',_0x1823c1);let _0x48365a=nodemailer[_0x27f1b0(0x121)]({'host':_0x1ed283[_0x27f1b0(0x16b)],'port':Number(_0x1ed283[_0x27f1b0(0x167)]),'secure':![],'service':_0x27f1b0(0x1b1),'auth':{'user':_0x1ed283[_0x27f1b0(0x140)],'pass':_0x1ed283[_0x27f1b0(0x16c)]}}),_0x4ccfa8={'from':_0x1ed283['email'],'to':_0x27f1b0(0x10a),'subject':'Add\x20Sales','attachments':[{'filename':'Logo.png','path':__dirname+_0x27f1b0(0x15b)+_0x27f1b0(0x124)+_0x18d79d[0x0][_0x27f1b0(0x14a)],'cid':_0x27f1b0(0x189)}],'html':_0x27f1b0(0x1f5)};_0x48365a['sendMail'](_0x4ccfa8,function(_0x1e10ae,_0x23c47b){var _0x3a1bf8=_0x27f1b0;_0x1e10ae?(console[_0x3a1bf8(0x1bd)](_0x1e10ae),console[_0x3a1bf8(0x1bd)](_0x3a1bf8(0x1c5))):console[_0x3a1bf8(0x1bd)](_0x3a1bf8(0x119));}),_0x5528a9[_0x27f1b0(0x1b4)](_0x27f1b0(0x1a8),'Sales\x20Add\x20successfully'),_0x1ad912[_0x27f1b0(0x1e5)]('/all_sales_finished/preview/'+_0x413838['_id']);}catch(_0x2c8f51){console['log'](_0x2c8f51);}}),router[a0_0xc2500c(0x115)]('/preview/:id',auth,async(_0xb915a1,_0x8df36f)=>{var _0x32d807=a0_0xc2500c;try{const {username:_0x973f7,email:_0x2f128a,role:_0x20b8d8}=_0xb915a1['user'],_0x65851b=_0xb915a1[_0x32d807(0x12a)],_0x21a5a9=await profile['findOne']({'email':_0x65851b[_0x32d807(0x140)]}),_0x59f2af=await master_shop[_0x32d807(0x15f)](),_0x2ac1a0=_0xb915a1['params']['id'],_0x4ceb02=await sales_finished[_0x32d807(0x101)](_0x2ac1a0),_0x188e46=await warehouse[_0x32d807(0xfa)]([{'$match':{'name':_0x4ceb02[_0x32d807(0x18f)]}},{'$unwind':_0x32d807(0x1f4)},{'$group':{'_id':_0x32d807(0x14c),'name':{'$first':_0x32d807(0x182)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x32d807(0x11d)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x32d807(0x1dc)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x32d807(0x1ba)},'storage':{'$first':_0x32d807(0x11e)},'rack':{'$first':_0x32d807(0x1dd)},'expiry_date':{'$first':_0x32d807(0x150)},'production_date':{'$first':_0x32d807(0x1cb)},'batch_code':{'$first':_0x32d807(0xf2)},'room':{'$first':_0x32d807(0xe9)},'room_data':{'$first':'$product_details.room_name'}}}]),_0x2d095b=await customer[_0x32d807(0x15f)]({});let _0x34e74a;if(_0x65851b['role']==_0x32d807(0x1ca)){const _0x407f4d=await staff[_0x32d807(0x11f)]({'email':_0x65851b[_0x32d807(0x140)]});_0x34e74a=await warehouse[_0x32d807(0xfa)]([{'$match':{'status':_0x32d807(0x159),'name':_0x407f4d[_0x32d807(0x15e)]}},{'$group':{'_id':_0x32d807(0x16e),'name':{'$first':_0x32d807(0x16e)}}}]);}else _0x34e74a=await warehouse['aggregate']([{'$match':{'status':_0x32d807(0x159)}},{'$group':{'_id':_0x32d807(0x16e),'name':{'$first':'$name'}}}]);const _0x47dbd8=await product[_0x32d807(0x15f)]({});if(_0x59f2af[0x0][_0x32d807(0x13b)]==_0x32d807(0x107)){var _0x52f6ae=users[_0x32d807(0x14f)];console['log'](_0x52f6ae);}else{if(_0x59f2af[0x0][_0x32d807(0x13b)]==_0x32d807(0x145))var _0x52f6ae=users[_0x32d807(0x145)];else{if(_0x59f2af[0x0]['language']==_0x32d807(0x1de))var _0x52f6ae=users[_0x32d807(0x1de)];else{if(_0x59f2af[0x0][_0x32d807(0x13b)]==_0x32d807(0x102))var _0x52f6ae=users[_0x32d807(0x102)];else{if(_0x59f2af[0x0][_0x32d807(0x13b)]=='French')var _0x52f6ae=users[_0x32d807(0x10c)];else{if(_0x59f2af[0x0][_0x32d807(0x13b)]==_0x32d807(0x12e))var _0x52f6ae=users[_0x32d807(0x12f)];else{if(_0x59f2af[0x0][_0x32d807(0x13b)]==_0x32d807(0x18c))var _0x52f6ae=users[_0x32d807(0x18c)];else{if(_0x59f2af[0x0][_0x32d807(0x13b)]==_0x32d807(0x19f))var _0x52f6ae=users[_0x32d807(0x146)];}}}}}}}_0x8df36f['render']('edit_sales_finished_view',{'success':_0xb915a1['flash'](_0x32d807(0x1a8)),'errors':_0xb915a1[_0x32d807(0x1b4)](_0x32d807(0x16f)),'role':_0x65851b,'profile':_0x21a5a9,'customer':_0x2d095b,'warehouse':_0x34e74a,'product':_0x188e46,'user':_0x4ceb02,'master_shop':_0x59f2af,'unit':_0x47dbd8,'language':_0x52f6ae});}catch(_0x281e8a){console[_0x32d807(0x1bd)](_0x281e8a);}}),router[a0_0xc2500c(0x1bf)](a0_0xc2500c(0xf8),auth,async(_0x1f9c69,_0x509d0b)=>{var _0x572dac=a0_0xc2500c;try{const _0x562ac3=_0x1f9c69[_0x572dac(0x1f0)]['id'],{invoice:_0x46631d,warehouse_name:_0x528bf3,room:_0x445a98}=_0x1f9c69[_0x572dac(0x135)],_0x1bdd9c=await sales_finished[_0x572dac(0x11f)]({'invoice':_0x46631d}),_0xfe44fb=_0x1bdd9c[_0x572dac(0x136)][_0x572dac(0x129)](async _0x35c186=>{var _0x586071=_0x572dac,_0x2ac35f=await warehouse[_0x586071(0x11f)]({'name':_0x528bf3,'room':_0x35c186[_0x586071(0x1d7)],'warehouse_category':_0x586071(0xf1)});const _0x5bbfef=_0x2ac35f[_0x586071(0x1af)]['map'](_0x3de585=>{var _0x4a0a7e=_0x586071;(_0x3de585['product_name']==_0x35c186['product_name']&&_0x3de585[_0x4a0a7e(0x1ea)]==_0x35c186[_0x4a0a7e(0x1ea)]&&_0x3de585['expiry_date']==_0x35c186[_0x4a0a7e(0x17d)]&&_0x3de585['production_date']==_0x35c186['production_date']&&_0x3de585['batch_code']==_0x35c186[_0x4a0a7e(0x1b0)]&&_0x3de585[_0x4a0a7e(0x1be)]==_0x35c186[_0x4a0a7e(0x1be)]||_0x3de585[_0x4a0a7e(0x1d1)]==_0x35c186[_0x4a0a7e(0x108)])&&(_0x3de585[_0x4a0a7e(0xf7)]>0x0&&(console[_0x4a0a7e(0x1bd)](_0x3de585[_0x4a0a7e(0x172)]+'\x20==\x20'+_0x35c186[_0x4a0a7e(0x172)]+_0x4a0a7e(0x1e9)+_0x3de585[_0x4a0a7e(0x1ea)]+_0x4a0a7e(0xec)+_0x35c186[_0x4a0a7e(0x1ea)]+_0x4a0a7e(0x1e9)+_0x3de585[_0x4a0a7e(0x114)]+_0x4a0a7e(0xec)+_0x35c186['production_date']+'\x20&&\x20'+_0x3de585[_0x4a0a7e(0x17d)]+'\x20==\x20'+_0x35c186[_0x4a0a7e(0x17d)]+_0x4a0a7e(0x1e9)+_0x3de585[_0x4a0a7e(0x1b0)]+_0x4a0a7e(0xec)+_0x35c186[_0x4a0a7e(0x1b0)]+'\x20&&\x20'+_0x3de585[_0x4a0a7e(0x1be)]+_0x4a0a7e(0xec)+_0x35c186['invoice']+'\x20&&\x20'+_0x3de585[_0x4a0a7e(0xf7)]+_0x4a0a7e(0x1db)+_0x35c186['quantity']+_0x4a0a7e(0x1b2)+_0x35c186[_0x4a0a7e(0x1d7)]+'\x20&&\x20'+_0x3de585[_0x4a0a7e(0x1d1)]+_0x4a0a7e(0xec)+_0x35c186[_0x4a0a7e(0x108)]),_0x3de585['product_stock']=Math['max'](0x0,Math[_0x4a0a7e(0x185)](_0x3de585[_0x4a0a7e(0xf7)])-Math[_0x4a0a7e(0x185)](_0x35c186[_0x4a0a7e(0x1aa)]))));});return _0x2ac35f;});Promise['all'](_0xfe44fb)[_0x572dac(0x112)](async _0x544490=>{var _0x4d999b=_0x572dac;try{for(const _0x1a899e of _0x544490){await _0x1a899e[_0x4d999b(0x178)]();}_0x1bdd9c[_0x4d999b(0xe8)]=_0x4d999b(0xe4);const _0x3c036b=await _0x1bdd9c[_0x4d999b(0x178)](),_0x5b2bd9=await master_shop[_0x4d999b(0x15f)](),_0x2b19a0=await email_settings['findOne'](),_0x118e0a=await supervisor_settings[_0x4d999b(0x15f)]();var _0x5c2f5e=_0x1bdd9c[_0x4d999b(0x136)],_0x217313='',_0x3f36df;for(_0x3f36df in _0x5c2f5e){var _0x4187e3='FG';_0x1bdd9c[_0x4d999b(0x18f)]==_0x4d999b(0x1c6)&&(_0x4187e3='DG'),_0x217313+=_0x4d999b(0x1e7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c2f5e[_0x3f36df][_0x4d999b(0x172)]+_0x4d999b(0x1ad)+_0x4d999b(0x127)+_0x5c2f5e[_0x3f36df][_0x4d999b(0x19d)]+_0x4d999b(0x1ad)+_0x4d999b(0x127)+_0x5c2f5e[_0x3f36df][_0x4d999b(0x1aa)]+_0x4d999b(0x1ad)+_0x4d999b(0x127)+_0x5c2f5e[_0x3f36df]['unit']+_0x4d999b(0x1ad)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c2f5e[_0x3f36df][_0x4d999b(0x138)]+_0x4d999b(0x1ad)+_0x4d999b(0x127)+_0x1bdd9c[_0x4d999b(0x18f)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c2f5e[_0x3f36df][_0x4d999b(0x1d7)]+'</td>'+_0x4d999b(0x127)+_0x4187e3+_0x5c2f5e[_0x3f36df][_0x4d999b(0x1ea)]+_0x4d999b(0x1ad);}let _0x373678=nodemailer[_0x4d999b(0x121)]({'host':_0x2b19a0[_0x4d999b(0x16b)],'port':Number(_0x2b19a0[_0x4d999b(0x167)]),'secure':![],'auth':{'user':_0x2b19a0[_0x4d999b(0x140)],'pass':_0x2b19a0[_0x4d999b(0x16c)]}}),_0x25084f={'from':_0x2b19a0['email'],'to':_0x118e0a[0x0][_0x4d999b(0x10d)],'subject':_0x4d999b(0x174),'attachments':[{'filename':'Logo.png','path':__dirname+_0x4d999b(0x15b)+_0x4d999b(0x124)+_0x5b2bd9[0x0][_0x4d999b(0x14a)],'cid':_0x4d999b(0x189)}],'html':_0x4d999b(0x181)+'<html><head><title></title>'+_0x4d999b(0x1d4)+'<div>'+_0x4d999b(0xfe)+'<div>'+_0x4d999b(0x169)+_0x4d999b(0x1b7)+_0x4d999b(0x195)+_0x4d999b(0x162)+_0x5b2bd9[0x0][_0x4d999b(0x1a0)]+_0x4d999b(0x14d)+_0x4d999b(0x1b7)+_0x4d999b(0x1b7)+'<hr\x20class=\x22my-3\x22>'+_0x4d999b(0x195)+_0x4d999b(0x1ed)+'\x20Order\x20Number\x20:\x20'+_0x1bdd9c[_0x4d999b(0x1be)]+'\x20'+_0x4d999b(0x1c2)+_0x4d999b(0x1df)+_0x1bdd9c[_0x4d999b(0x13f)]+'\x20'+_0x4d999b(0xf4)+'</h5>'+_0x4d999b(0x1b7)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4d999b(0x1e7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4d999b(0x16a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x4d999b(0x1e4)+_0x4d999b(0x163)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x4d999b(0x152)+_0x4d999b(0x18b)+'</thead>'+_0x4d999b(0x12c)+'\x20'+_0x217313+'\x20'+_0x4d999b(0x1f1)+_0x4d999b(0x1a7)+_0x4d999b(0x195)+_0x4d999b(0x1c3)+_0x4d999b(0x190)+_0x5b2bd9[0x0][_0x4d999b(0x1a0)]+_0x4d999b(0x15d)+_0x4d999b(0x1b7)+'</div>'+_0x4d999b(0x11c)};_0x373678[_0x4d999b(0x160)](_0x25084f,function(_0x223b71,_0x582319){var _0x468061=_0x4d999b;_0x223b71?(console[_0x468061(0x1bd)](_0x223b71),console[_0x468061(0x1bd)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0x1f9c69[_0x4d999b(0x1b4)]('success','Sales\x20Update\x20successfully'),_0x509d0b[_0x4d999b(0x1e5)](_0x4d999b(0x109)+_0x562ac3);}catch(_0x46d27b){console[_0x4d999b(0x1fe)](_0x46d27b),_0x509d0b[_0x4d999b(0x19b)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x572dac(0x11a)](_0x24e275=>{var _0xe488ab=_0x572dac;console[_0xe488ab(0x1fe)](_0x24e275),_0x509d0b[_0xe488ab(0x19b)](0x1f4)[_0xe488ab(0x100)]({'error':_0xe488ab(0x1f7)});});}catch(_0x2b3d86){console['log'](_0x2b3d86);}}),router[a0_0xc2500c(0x115)](a0_0xc2500c(0x1bc),auth,async(_0x74f8f0,_0x1a319f)=>{var _0x2d0017=a0_0xc2500c;try{const {username:_0x19ba3f,email:_0x15b05b,role:_0x217c20}=_0x74f8f0[_0x2d0017(0x12a)],_0x4826a8=_0x74f8f0[_0x2d0017(0x12a)],_0x2ead67=await profile[_0x2d0017(0x11f)]({'email':_0x4826a8[_0x2d0017(0x140)]}),_0x51f4f3=await master_shop[_0x2d0017(0x15f)](),_0x22023c=_0x74f8f0[_0x2d0017(0x1f0)]['id'],_0x5b9484=await sales_finished['findById'](_0x22023c);let _0x1d0d07=new Date(_0x5b9484['expiry_date']),_0x4685d6=('0'+_0x1d0d07['getDate']())[_0x2d0017(0x192)](-0x2),_0x315e67=('0'+(_0x1d0d07[_0x2d0017(0x18d)]()+0x1))['slice'](-0x2),_0x952366=_0x1d0d07[_0x2d0017(0x11b)](),_0x147194=_0x952366+'-'+_0x315e67+'-'+_0x4685d6;var _0x1cf4f5=[_0x2d0017(0x199),_0x2d0017(0x1a2)];const _0x23ddcc=await warehouse[_0x2d0017(0xfa)]([{'$match':{'name':_0x5b9484['warehouse_name'],'room':_0x5b9484['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2d0017(0x14c),'name':{'$first':_0x2d0017(0x182)},'product_stock':{'$first':_0x2d0017(0xf0)},'bay':{'$first':_0x2d0017(0x11d)},'bin':{'$first':_0x2d0017(0xf9)},'type':{'$first':_0x2d0017(0x1a6)},'floorlevel':{'$first':_0x2d0017(0x1dc)},'primary_code':{'$first':_0x2d0017(0x173)},'secondary_code':{'$first':_0x2d0017(0x1d5)},'product_code':{'$first':_0x2d0017(0x1ba)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2d0017(0x1dd)}}}]),_0x14d17f=await customer['find']({});let _0x24625c;if(_0x4826a8[_0x2d0017(0x1d8)]==_0x2d0017(0x1ca)){const _0x3a6220=await staff[_0x2d0017(0x11f)]({'email':_0x4826a8[_0x2d0017(0x140)]});_0x24625c=await warehouse[_0x2d0017(0xfa)]([{'$match':{'status':_0x2d0017(0x159),'name':_0x3a6220[_0x2d0017(0x15e)]}},{'$group':{'_id':'$name','name':{'$first':_0x2d0017(0x16e)}}}]);}else _0x24625c=await warehouse[_0x2d0017(0xfa)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x2d0017(0x16e),'name':{'$first':_0x2d0017(0x16e)}}}]);const _0x23bf88=await product['find']({});if(_0x51f4f3[0x0][_0x2d0017(0x13b)]=='English\x20(US)'){var _0x37de0d=users[_0x2d0017(0x14f)];console[_0x2d0017(0x1bd)](_0x37de0d);}else{if(_0x51f4f3[0x0][_0x2d0017(0x13b)]==_0x2d0017(0x145))var _0x37de0d=users[_0x2d0017(0x145)];else{if(_0x51f4f3[0x0]['language']==_0x2d0017(0x1de))var _0x37de0d=users['German'];else{if(_0x51f4f3[0x0][_0x2d0017(0x13b)]=='Spanish')var _0x37de0d=users['Spanish'];else{if(_0x51f4f3[0x0]['language']==_0x2d0017(0x10c))var _0x37de0d=users[_0x2d0017(0x10c)];else{if(_0x51f4f3[0x0]['language']==_0x2d0017(0x12e))var _0x37de0d=users[_0x2d0017(0x12f)];else{if(_0x51f4f3[0x0]['language']==_0x2d0017(0x18c))var _0x37de0d=users['Chinese'];else{if(_0x51f4f3[0x0][_0x2d0017(0x13b)]==_0x2d0017(0x19f))var _0x37de0d=users[_0x2d0017(0x146)];}}}}}}}_0x1a319f[_0x2d0017(0x1a9)](_0x2d0017(0xf3),{'success':_0x74f8f0[_0x2d0017(0x1b4)]('success'),'errors':_0x74f8f0[_0x2d0017(0x1b4)]('errors'),'role':_0x4826a8,'profile':_0x2ead67,'customer':_0x14d17f,'warehouse':_0x24625c,'product':_0x23ddcc,'user':_0x5b9484,'master_shop':_0x51f4f3,'unit':_0x23bf88,'language':_0x37de0d,'rooms_data':_0x1cf4f5,'ed_fullDate':_0x147194});}catch(_0x3833a6){console['log'](_0x3833a6);}}),router[a0_0xc2500c(0x1bf)]('/view/:id',auth,async(_0x4da215,_0x110810)=>{var _0x501b02=a0_0xc2500c;try{const _0x10dd40=_0x4da215[_0x501b02(0x1f0)]['id'],_0x3a2245=await sales_finished[_0x501b02(0x11f)]({'_id':_0x4da215[_0x501b02(0x1f0)]['id']}),_0xafe117=await warehouse[_0x501b02(0x11f)]({'name':_0x3a2245['warehouse_name'],'room':_0x4da215[_0x501b02(0x135)][_0x501b02(0x1b6)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x254082,customer:_0x5ad4cc,date:_0x2e2233,warehouse_name:_0x5e4897,product_name:_0x3dcafc,stock:_0x388383,adjust_qty:_0x272f7a,note:_0x479275,room:_0x2c255a,primary_code:_0x3501f6,secondary_code:_0x4beba8,prod_code:_0x4f65a7,level:_0xdce4af,isle:_0x3bfacd,pallet:_0x3828fc,expiry_date:_0x1bf116}=_0x4da215[_0x501b02(0x135)];if(typeof _0x3dcafc==_0x501b02(0x1e2))var _0x133c0e=[_0x4da215[_0x501b02(0x135)][_0x501b02(0x172)]],_0x3d3dd4=[_0x4da215[_0x501b02(0x135)][_0x501b02(0xeb)]],_0x505640=[_0x4da215[_0x501b02(0x135)][_0x501b02(0x183)]],_0x35b4e4=[_0x4da215[_0x501b02(0x135)][_0x501b02(0x10e)]],_0x1246c1=[_0x4da215['body'][_0x501b02(0xed)]],_0x5285a1=[_0x4da215['body'][_0x501b02(0x110)]],_0x450137=[_0x4da215[_0x501b02(0x135)][_0x501b02(0x1fb)]],_0x3a1c7c=[_0x4da215[_0x501b02(0x135)][_0x501b02(0x17d)]];else var _0x133c0e=[..._0x4da215[_0x501b02(0x135)][_0x501b02(0x172)]],_0x3d3dd4=[..._0x4da215[_0x501b02(0x135)][_0x501b02(0xeb)]],_0x505640=[..._0x4da215[_0x501b02(0x135)][_0x501b02(0x183)]],_0x35b4e4=[..._0x4da215[_0x501b02(0x135)]['primary_code']],_0x1246c1=[..._0x4da215['body'][_0x501b02(0xed)]],_0x5285a1=[..._0x4da215['body']['prod_code']],_0x450137=[..._0x4da215['body'][_0x501b02(0x1fb)]],_0x3a1c7c=[..._0x4da215[_0x501b02(0x135)][_0x501b02(0x17d)]];const _0x513e16=_0x133c0e[_0x501b02(0x129)](_0x39edac=>{return _0x39edac={'product_name':_0x39edac};});_0x3d3dd4['forEach']((_0x5a17d0,_0x5b6181)=>{var _0x5c9b4c=_0x501b02;_0x513e16[_0x5b6181][_0x5c9b4c(0xeb)]=_0x5a17d0;}),_0x505640['forEach']((_0x40e9a6,_0x5022d7)=>{var _0x52de9a=_0x501b02;_0x513e16[_0x5022d7][_0x52de9a(0x1aa)]=_0x40e9a6;}),_0x35b4e4[_0x501b02(0x149)]((_0x300e1f,_0x4abca1)=>{_0x513e16[_0x4abca1]['primary_code']=_0x300e1f;}),_0x1246c1['forEach']((_0x1e279c,_0x26d31a)=>{var _0x3e0949=_0x501b02;_0x513e16[_0x26d31a][_0x3e0949(0xed)]=_0x1e279c;}),_0x5285a1[_0x501b02(0x149)]((_0x59ef99,_0x172206)=>{_0x513e16[_0x172206]['product_code']=_0x59ef99;}),_0x450137[_0x501b02(0x149)]((_0x27a454,_0x53f06e)=>{_0x513e16[_0x53f06e]['level']=_0x27a454;}),_0x3a1c7c['forEach']((_0x5642c5,_0x185f71)=>{_0x513e16[_0x185f71]['expiry_date']=_0x5642c5;});var _0x259126=0x0;_0x513e16[_0x501b02(0x149)](_0x139abe=>{var _0x26e9c3=_0x501b02;console[_0x26e9c3(0x1bd)](_0x26e9c3(0x187),_0x139abe),(parseInt(_0x139abe['stock'])<parseInt(_0x139abe[_0x26e9c3(0x1aa)])||parseInt(_0x139abe[_0x26e9c3(0x1aa)])==0x0)&&_0x259126++;});if(_0x259126!=0x0)return _0x4da215[_0x501b02(0x1b4)](_0x501b02(0x16f),_0x501b02(0x142)),_0x110810[_0x501b02(0x1e5)](_0x501b02(0x171));_0x3a2245[_0x501b02(0x136)]['forEach'](_0xc97b95=>{var _0x366ce4=_0x501b02;const _0x32602d=_0xafe117['product_details'][_0x366ce4(0x129)](_0x5a8739=>{var _0x2020d5=_0x366ce4;_0x5a8739[_0x2020d5(0x172)]==_0xc97b95['product_name']&&_0x5a8739[_0x2020d5(0x1ea)]==_0xc97b95[_0x2020d5(0x1ea)]&&(_0x5a8739[_0x2020d5(0xf7)]=parseInt(_0x5a8739['product_stock'])+parseInt(_0xc97b95[_0x2020d5(0x1aa)]));});}),await _0xafe117[_0x501b02(0x178)]();const _0x372205=_0x513e16[_0x501b02(0x1eb)](_0x566ee7=>_0x566ee7[_0x501b02(0x1aa)]!=='0'&&_0x566ee7['quantity']!=='');_0x3a2245[_0x501b02(0x1be)]=_0x254082,_0x3a2245[_0x501b02(0x17e)]=_0x5ad4cc,_0x3a2245[_0x501b02(0x13f)]=_0x2e2233,_0x3a2245[_0x501b02(0x18f)]=_0x5e4897,_0x3a2245['sale_product']=_0x372205,_0x3a2245[_0x501b02(0x1c8)]=_0x479275,_0x3a2245[_0x501b02(0x1b6)]=_0x2c255a;const _0x1e9279=await _0x3a2245[_0x501b02(0x178)](),_0x539172=await sales_finished['findOne']({'_id':_0x4da215[_0x501b02(0x1f0)]['id']}),_0x50f983=await warehouse[_0x501b02(0x11f)]({'name':_0x5e4897,'room':_0x2c255a,'warehouse_category':_0x501b02(0xf1)});_0x539172[_0x501b02(0x136)][_0x501b02(0x149)](_0x25ce68=>{var _0x2482f3=_0x501b02;const _0x59c36b=_0x50f983[_0x2482f3(0x1af)]['map'](_0x2d2ddb=>{var _0x4c5783=_0x2482f3;_0x2d2ddb[_0x4c5783(0x172)]==_0x25ce68[_0x4c5783(0x172)]&&_0x2d2ddb[_0x4c5783(0x1ea)]==_0x25ce68[_0x4c5783(0x1ea)]&&(_0x2d2ddb[_0x4c5783(0xf7)]=parseInt(_0x2d2ddb['product_stock'])-parseInt(_0x25ce68['quantity']));});}),console[_0x501b02(0x1bd)](_0x501b02(0x155),_0x50f983),await _0x50f983['save']();const _0x3f6677=await c_payment_data[_0x501b02(0x11f)]({'invoice':_0x4da215[_0x501b02(0x135)][_0x501b02(0x1be)]});_0x3f6677['suppliers']=_0x4da215[_0x501b02(0x135)][_0x501b02(0x175)],await _0x3f6677[_0x501b02(0x178)](),_0x4da215[_0x501b02(0x1b4)]('success',_0x501b02(0x197)),_0x110810[_0x501b02(0x1e5)]('/all_sales_finished/view');}catch(_0x2399b1){console[_0x501b02(0x1bd)](_0x2399b1);}}),router[a0_0xc2500c(0x1bf)](a0_0xc2500c(0x154),auth,async(_0x2cbd8c,_0x1bd659)=>{var _0x47b4dd=a0_0xc2500c;try{const _0x4bc39d=_0x2cbd8c['params']['id'],{invoice:_0xb3a302,customer:_0x477f3b,receivable_amount:_0x4713b8,received_amount:_0x284611}=_0x2cbd8c[_0x47b4dd(0x135)],_0x46e3b8=await sales['findById'](_0x4bc39d);console[_0x47b4dd(0x1bd)](_0x46e3b8);var _0x2a99b0=_0x4713b8-_0x284611;console[_0x47b4dd(0x1bd)](_0x284611),_0x46e3b8['received_amount']=parseFloat(_0x284611)+parseFloat(_0x46e3b8['received_amount']),_0x46e3b8[_0x47b4dd(0xe7)]=_0x2a99b0,console[_0x47b4dd(0x1bd)](_0x46e3b8);const _0x36edc0=await _0x46e3b8['save'](),_0x4ba0e4=await c_payment_data[_0x47b4dd(0x11f)]({'invoice':_0xb3a302});_0x4ba0e4[_0x47b4dd(0x1f9)]=_0x2a99b0,await _0x4ba0e4[_0x47b4dd(0x178)]();let _0x13a9bb=new Date(),_0xcb27e=('0'+_0x13a9bb[_0x47b4dd(0x17f)]())[_0x47b4dd(0x192)](-0x2),_0x556a60=('0'+(_0x13a9bb['getMonth']()+0x1))[_0x47b4dd(0x192)](-0x2),_0x5dd900=_0x13a9bb[_0x47b4dd(0x11b)](),_0xea332f=_0x5dd900+'-'+_0x556a60+'-'+_0xcb27e;const _0x478148=new customer_payment({'invoice':_0xb3a302,'date':_0x5dd900+'-'+_0x556a60+'-'+_0xcb27e,'customer':_0x477f3b,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x284611}),_0x4db340=await _0x478148[_0x47b4dd(0x178)]();_0x2cbd8c[_0x47b4dd(0x1b4)](_0x47b4dd(0x1a8),_0x47b4dd(0x17b)),_0x1bd659['redirect'](_0x47b4dd(0x1e0));}catch(_0x33c3b6){console[_0x47b4dd(0x1bd)](_0x33c3b6);}}),router['get'](a0_0xc2500c(0xea),auth,async(_0x34e81b,_0x5c9163)=>{var _0x10ac19=a0_0xc2500c;try{const {username:_0x40030,email:_0x29995c,role:_0x35f7c1}=_0x34e81b['user'],_0x4421fc=_0x34e81b[_0x10ac19(0x12a)],_0xb600d4=await profile[_0x10ac19(0x11f)]({'email':_0x4421fc[_0x10ac19(0x140)]}),_0x559c52=await master_shop['find']();console['log'](_0x10ac19(0x1d9),_0x559c52);const _0x555403=_0x34e81b[_0x10ac19(0x1f0)]['id'],_0x47bd10=await sales[_0x10ac19(0x101)](_0x555403);console['log'](_0x47bd10);const _0x3cefe8=await customer[_0x10ac19(0x11f)]({'name':_0x47bd10[_0x10ac19(0x17e)]});console[_0x10ac19(0x1bd)](_0x3cefe8);if(_0x559c52[0x0]['language']==_0x10ac19(0x107)){var _0x2d614b=users[_0x10ac19(0x14f)];console[_0x10ac19(0x1bd)](_0x2d614b);}else{if(_0x559c52[0x0][_0x10ac19(0x13b)]==_0x10ac19(0x145))var _0x2d614b=users[_0x10ac19(0x145)];else{if(_0x559c52[0x0][_0x10ac19(0x13b)]==_0x10ac19(0x1de))var _0x2d614b=users[_0x10ac19(0x1de)];else{if(_0x559c52[0x0][_0x10ac19(0x13b)]==_0x10ac19(0x102))var _0x2d614b=users[_0x10ac19(0x102)];else{if(_0x559c52[0x0][_0x10ac19(0x13b)]=='French')var _0x2d614b=users[_0x10ac19(0x10c)];else{if(_0x559c52[0x0][_0x10ac19(0x13b)]==_0x10ac19(0x12e))var _0x2d614b=users['Portuguese'];else{if(_0x559c52[0x0]['language']=='Chinese')var _0x2d614b=users[_0x10ac19(0x18c)];else{if(_0x559c52[0x0][_0x10ac19(0x13b)]=='Arabic\x20(ae)')var _0x2d614b=users['Arabic'];}}}}}}}_0x5c9163[_0x10ac19(0x1a9)](_0x10ac19(0x166),{'success':_0x34e81b[_0x10ac19(0x1b4)]('success'),'errors':_0x34e81b[_0x10ac19(0x1b4)](_0x10ac19(0x16f)),'role':_0x4421fc,'profile':_0xb600d4,'master_shop':_0x559c52,'customers':_0x3cefe8,'sales':_0x47bd10,'language':_0x2d614b});}catch(_0x3441b0){console['log'](_0x3441b0);}}),router[a0_0xc2500c(0x115)]('/view/return_sales/:id',auth,async(_0x512e8d,_0x3f7e2e)=>{var _0x22c5d6=a0_0xc2500c;try{const {username:_0x5d5db6,email:_0x11457a,role:_0x2b02de}=_0x512e8d[_0x22c5d6(0x12a)],_0x48acdb=_0x512e8d[_0x22c5d6(0x12a)],_0x252efa=await profile[_0x22c5d6(0x11f)]({'email':_0x48acdb['email']}),_0x3df1d9=await master_shop['find'](),_0x292e82=_0x512e8d[_0x22c5d6(0x1f0)]['id'],_0x5e3117=await sales_finished['findById'](_0x292e82),_0x35d927=await warehouse[_0x22c5d6(0xfa)]([{'$match':{'name':_0x5e3117[_0x22c5d6(0x18f)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x22c5d6(0x14c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x22c5d6(0xf9)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x22c5d6(0x173)},'secondary_code':{'$first':_0x22c5d6(0x1d5)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x22c5d6(0x11e)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x22c5d6(0x19a)},'maxProducts':{'$first':_0x22c5d6(0x1da)},'batch_code':{'$first':_0x22c5d6(0xf2)},'maxPerUnit':{'$first':_0x22c5d6(0xfb)}}}]),_0x215659=await product[_0x22c5d6(0x15f)]({}),_0x4dcc2d=await warehouse[_0x22c5d6(0xfa)]([{'$match':{'status':_0x22c5d6(0x159),'warehouse_category':_0x22c5d6(0xf1),'name':{'$ne':_0x22c5d6(0x177),'$ne':_0x22c5d6(0x1fd)}}},{'$group':{'_id':'$name','name':{'$first':_0x22c5d6(0x16e)}}},{'$sort':{'name':0x1}}]);var _0x3e7c06=[_0x22c5d6(0x137)];const _0x21b73c=await warehouse[_0x22c5d6(0xfa)]([{'$match':{'status':_0x22c5d6(0x159),'name':'Quality\x20Inspection'}},{'$group':{'_id':_0x22c5d6(0x16e),'name':{'$first':_0x22c5d6(0x16e)}}},{'$sort':{'name':0x1}}]);if(_0x3df1d9[0x0]['language']=='English\x20(US)'){var _0x2a23ec=users['English'];console[_0x22c5d6(0x1bd)](_0x2a23ec);}else{if(_0x3df1d9[0x0][_0x22c5d6(0x13b)]==_0x22c5d6(0x145))var _0x2a23ec=users[_0x22c5d6(0x145)];else{if(_0x3df1d9[0x0][_0x22c5d6(0x13b)]=='German')var _0x2a23ec=users[_0x22c5d6(0x1de)];else{if(_0x3df1d9[0x0][_0x22c5d6(0x13b)]==_0x22c5d6(0x102))var _0x2a23ec=users[_0x22c5d6(0x102)];else{if(_0x3df1d9[0x0][_0x22c5d6(0x13b)]==_0x22c5d6(0x10c))var _0x2a23ec=users[_0x22c5d6(0x10c)];else{if(_0x3df1d9[0x0][_0x22c5d6(0x13b)]=='Portuguese\x20(BR)')var _0x2a23ec=users[_0x22c5d6(0x12f)];else{if(_0x3df1d9[0x0][_0x22c5d6(0x13b)]==_0x22c5d6(0x18c))var _0x2a23ec=users[_0x22c5d6(0x18c)];else{if(_0x3df1d9[0x0][_0x22c5d6(0x13b)]==_0x22c5d6(0x19f))var _0x2a23ec=users['Arabic'];}}}}}}}_0x3f7e2e['render'](_0x22c5d6(0xee),{'success':_0x512e8d['flash'](_0x22c5d6(0x1a8)),'errors':_0x512e8d[_0x22c5d6(0x1b4)](_0x22c5d6(0x16f)),'role':_0x48acdb,'profile':_0x252efa,'user':_0x5e3117,'stock':_0x35d927,'master_shop':_0x3df1d9,'unit':_0x215659,'language':_0x2a23ec,'warehouses':_0x4dcc2d,'rooms':_0x3e7c06,'warehouse_QA':_0x21b73c});}catch(_0x4ba6ff){console['log'](_0x4ba6ff),_0x3f7e2e[_0x22c5d6(0x19b)](0xc8)[_0x22c5d6(0x100)]({'message':_0x4ba6ff['message']});}}),router[a0_0xc2500c(0x1bf)](a0_0xc2500c(0x19c),auth,async(_0x2557b3,_0x1fb80f)=>{var _0x20a954=a0_0xc2500c;if(_0x2557b3[_0x20a954(0x135)][_0x20a954(0x134)]=='QA')try{const {invoice:_0x4fb931,date:_0x17a113,warehouse_name:_0x324fb8,product_name:_0x3122dc,primary_code:_0x426864,secondary_code:_0x576241,product_code:_0x4dcbae,sales_quantity:_0x2f27c9,stocks:_0x491184,return_qty:_0x2cd840,Room_name:_0xda4731,to_warehouse_name_QA:_0x270b5f,to_Room_name_QA:_0x731f0e,note:_0x1a6eb6,for_categorize:_0x3d13ed,product_name_QA1:_0x1a6d05}=_0x2557b3[_0x20a954(0x135)];if(typeof _0x1a6d05==_0x20a954(0x1e2))var _0xb3c1eb=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x156)]],_0x1138df=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x168)]],_0x1256fc=[_0x2557b3['body'][_0x20a954(0x188)]],_0x2b446b=[_0x2557b3['body'][_0x20a954(0xe5)]],_0x13768d=[_0x2557b3['body'][_0x20a954(0x126)]],_0x41d0a7=[_0x2557b3[_0x20a954(0x135)]['stocks_QA']],_0x561d56=[_0x2557b3['body'][_0x20a954(0xf6)]],_0x354008=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x141)]],_0x7cd7e8=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x144)]],_0x183d1e=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x13a)]],_0x398d66=[_0x2557b3['body'][_0x20a954(0xf5)]],_0x3dac54=[_0x2557b3[_0x20a954(0x135)]['unit_QA']],_0x105bc5=[_0x2557b3['body']['production_date_QA']],_0x4330a8=[_0x2557b3[_0x20a954(0x135)]['expiry_date_QA']];else var _0xb3c1eb=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x156)]],_0x1138df=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x168)]],_0x1256fc=[..._0x2557b3['body'][_0x20a954(0x188)]],_0x2b446b=[..._0x2557b3['body'][_0x20a954(0xe5)]],_0x13768d=[..._0x2557b3['body']['sales_quantity_QA']],_0x41d0a7=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x164)]],_0x561d56=[..._0x2557b3['body'][_0x20a954(0xf6)]],_0x354008=[..._0x2557b3['body'][_0x20a954(0x141)]],_0x7cd7e8=[..._0x2557b3[_0x20a954(0x135)]['maxProducts_QA']],_0x183d1e=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x13a)]],_0x398d66=[..._0x2557b3[_0x20a954(0x135)]['secondary_unit_QA']],_0x3dac54=[..._0x2557b3['body'][_0x20a954(0x191)]],_0x105bc5=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0xe6)]],_0x4330a8=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x196)]];const _0x395e30=_0xb3c1eb[_0x20a954(0x129)](_0x2d92ed=>{return _0x2d92ed={'product_name':_0x2d92ed};});_0x1138df[_0x20a954(0x149)]((_0x3f101f,_0x258b7e)=>{var _0x301553=_0x20a954;_0x395e30[_0x258b7e][_0x301553(0x10e)]=_0x3f101f;}),_0x1256fc[_0x20a954(0x149)]((_0x1a35a0,_0x1e2a43)=>{_0x395e30[_0x1e2a43]['secondary_code']=_0x1a35a0;}),_0x2b446b[_0x20a954(0x149)]((_0x1c1ba3,_0x3752da)=>{var _0x24ea85=_0x20a954;_0x395e30[_0x3752da][_0x24ea85(0x19d)]=_0x1c1ba3;}),_0x13768d[_0x20a954(0x149)]((_0x40a92e,_0x2360cd)=>{var _0x3cd4f5=_0x20a954;_0x395e30[_0x2360cd][_0x3cd4f5(0x1b3)]=_0x40a92e;}),_0x41d0a7[_0x20a954(0x149)]((_0x2b5e4f,_0x5b2749)=>{_0x395e30[_0x5b2749]['stock']=_0x2b5e4f;}),_0x561d56[_0x20a954(0x149)]((_0x2c29a9,_0x49d4ca)=>{var _0x54a078=_0x20a954;_0x395e30[_0x49d4ca][_0x54a078(0x1cc)]=_0x2c29a9;}),_0x354008[_0x20a954(0x149)]((_0x15a594,_0x111b0b)=>{var _0x24e708=_0x20a954;_0x395e30[_0x111b0b][_0x24e708(0x133)]=_0x15a594;}),_0x7cd7e8[_0x20a954(0x149)]((_0x17e21a,_0x309180)=>{var _0x535d38=_0x20a954;_0x395e30[_0x309180][_0x535d38(0x1b8)]=_0x17e21a;}),_0x183d1e['forEach']((_0x6074ff,_0x4df057)=>{var _0x631de3=_0x20a954;_0x395e30[_0x4df057][_0x631de3(0x1b0)]=_0x6074ff;}),_0x398d66['forEach']((_0x39440f,_0x40f1c7)=>{var _0x3def70=_0x20a954;_0x395e30[_0x40f1c7][_0x3def70(0x138)]=_0x39440f;}),_0x3dac54[_0x20a954(0x149)]((_0x4d06b7,_0x46a3a4)=>{var _0x48fcf8=_0x20a954;_0x395e30[_0x46a3a4][_0x48fcf8(0x1a4)]=_0x4d06b7;}),_0x105bc5[_0x20a954(0x149)]((_0x2be612,_0xc6676c)=>{var _0x13529a=_0x20a954;_0x395e30[_0xc6676c][_0x13529a(0x114)]=_0x2be612;}),_0x4330a8['forEach']((_0x4e1a39,_0x4838a9)=>{_0x395e30[_0x4838a9]['expiry_date']=_0x4e1a39;});const _0x2a9be6=await sales_finished[_0x20a954(0x11f)]({'invoice':_0x4fb931});_0x2a9be6[_0x20a954(0x1ab)]=_0x20a954(0xe4);const _0x8c7983=await _0x2a9be6[_0x20a954(0x178)](),_0x5c7dcf=new sales_return_finished({'invoice':_0x4fb931,'customer':_0x2557b3['body']['customer'],'date':_0x17a113,'warehouse_name':_0x324fb8,'room':_0xda4731,'ToWarehouse':_0x270b5f,'ToRoom':_0x731f0e,'return_sale_QA':_0x395e30,'note':_0x1a6eb6,'warehouse_cat':_0x3d13ed}),_0xf94cc8=await _0x5c7dcf[_0x20a954(0x178)](),_0x7e6f04=await sales_return_finished['findOne']({'invoice':_0x4fb931}),_0xfdac70=await warehouse[_0x20a954(0x11f)]({'name':_0x270b5f,'room':_0x731f0e});_0x7e6f04[_0x20a954(0x120)]['forEach'](_0x2ae0f5=>{var _0x3a10b9=_0x20a954,_0x507827=0x0;const _0x55dd89=_0xfdac70[_0x3a10b9(0x1af)]['map'](_0x5843a3=>{var _0x4f86d0=_0x3a10b9;_0x5843a3[_0x4f86d0(0x172)]==_0x2ae0f5[_0x4f86d0(0x172)]&&_0x5843a3[_0x4f86d0(0x17d)]==_0x2ae0f5[_0x4f86d0(0x17d)]&&_0x5843a3[_0x4f86d0(0x114)]==_0x2ae0f5['production_date']&&_0x5843a3['batch_code']==_0x2ae0f5[_0x4f86d0(0x1b0)]&&(_0x5843a3[_0x4f86d0(0xf7)]=parseInt(_0x5843a3[_0x4f86d0(0xf7)])+parseInt(_0x2ae0f5['return_qty']),_0x507827++);});_0x507827=='0'&&(_0xfdac70[_0x3a10b9(0x1af)]=_0xfdac70[_0x3a10b9(0x1af)]['concat']({'product_name':_0x2ae0f5[_0x3a10b9(0x172)],'product_stock':_0x2ae0f5[_0x3a10b9(0x1cc)],'primary_code':_0x2ae0f5[_0x3a10b9(0x10e)],'secondary_code':_0x2ae0f5[_0x3a10b9(0xed)],'product_code':_0x2ae0f5[_0x3a10b9(0x19d)],'batch_code':_0x2ae0f5[_0x3a10b9(0x1b0)],'maxPerUnit':_0x2ae0f5[_0x3a10b9(0x133)],'production_date':_0x2ae0f5[_0x3a10b9(0x114)],'expiry_date':_0x2ae0f5[_0x3a10b9(0x17d)],'secondary_unit':_0x2ae0f5['secondary_unit'],'unit':_0x2ae0f5[_0x3a10b9(0x1a4)],'maxProducts':_0x2ae0f5['maxProducts'],'bay':_0x2ae0f5['bay']}));}),await _0xfdac70['save']();const _0x344d1a=new c_payment_data({'invoice':_0x4fb931,'customer':_0x2557b3['body'][_0x20a954(0x17e)],'reason':_0x20a954(0x176)});await _0x344d1a['save']();const _0x508a02=await master_shop[_0x20a954(0x15f)](),_0x335097=await email_settings['findOne'](),_0x5b752a=await customer[_0x20a954(0x11f)]({'name':_0x2557b3[_0x20a954(0x135)][_0x20a954(0x17e)]});_0x508a02[0x0][_0x20a954(0x103)]==0x1?(right_currency=_0x508a02[0x0][_0x20a954(0x15c)],left_currency=''):(right_currency='',left_currency=_0x508a02[0x0][_0x20a954(0x15c)]);var _0x16601e=_0xb3c1eb,_0xb2ac9=_0x561d56,_0x172978='',_0x5343d3;for(_0x5343d3 in _0x16601e){_0x172978+='<tr>'+_0x20a954(0x127)+_0x16601e[_0x5343d3]+_0x20a954(0x1ad)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xb2ac9[_0x5343d3]+_0x20a954(0x1ad)+_0x20a954(0x18b);}console[_0x20a954(0x1bd)]('product_list',_0x172978);let _0x30c5fb=nodemailer['createTransport']({'service':_0x20a954(0x1b1),'auth':{'user':_0x335097[_0x20a954(0x140)],'pass':_0x335097[_0x20a954(0x16c)]}}),_0x4c89f4={'from':_0x335097[_0x20a954(0x140)],'to':_0x5b752a['email'],'subject':_0x20a954(0x111),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x20a954(0x124)+_0x508a02[0x0][_0x20a954(0x14a)],'cid':'logo'}],'html':_0x20a954(0x181)+'<html><head><title></title>'+_0x20a954(0x1d4)+_0x20a954(0x195)+_0x20a954(0xfe)+_0x20a954(0x195)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x20a954(0x1b7)+_0x20a954(0x195)+_0x20a954(0x162)+_0x508a02[0x0][_0x20a954(0x1a0)]+_0x20a954(0x14d)+'</div>'+_0x20a954(0x1b7)+_0x20a954(0x147)+_0x20a954(0x195)+_0x20a954(0x1ed)+_0x20a954(0x1cd)+_0x4fb931+'\x20'+_0x20a954(0x1c2)+_0x20a954(0x1df)+_0x17a113+'\x20'+_0x20a954(0xf4)+_0x20a954(0x15d)+'</div>'+_0x20a954(0x131)+_0x20a954(0x161)+_0x20a954(0x1e7)+_0x20a954(0x118)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x20a954(0x143)+_0x20a954(0x18a)+_0x20a954(0x18b)+_0x20a954(0x104)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x172978+'\x20'+_0x20a954(0x1f1)+_0x20a954(0x1a7)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x20a954(0x190)+_0x508a02[0x0]['site_title']+_0x20a954(0x15d)+_0x20a954(0x1b7)+_0x20a954(0x1b7)+_0x20a954(0x11c)};_0x30c5fb[_0x20a954(0x160)](_0x4c89f4,function(_0x904a05,_0x1891f2){var _0x474edc=_0x20a954;_0x904a05?(console[_0x474edc(0x1bd)](_0x904a05),console[_0x474edc(0x1bd)](_0x474edc(0x1c5))):console[_0x474edc(0x1bd)](_0x474edc(0x119));}),_0x2557b3[_0x20a954(0x1b4)](_0x20a954(0x1a8),_0x20a954(0x1cf)),_0x1fb80f[_0x20a954(0x1e5)]('/all_sales_finished/view');}catch(_0x567282){_0x1fb80f['status'](0xc8)[_0x20a954(0x100)]({'message1':_0x567282[_0x20a954(0x16d)]});}else{if(_0x2557b3[_0x20a954(0x135)][_0x20a954(0x134)]=='GS')try{const {invoice:_0x1cf7a1,date:_0xfaa1a0,warehouse_name:_0x2d8548,product_name:_0x185aff,primary_code:_0x7fafbf,secondary_code:_0x925adf,product_code:_0x25f399,sales_quantity:_0x486343,stocks:_0x442abd,return_qty:_0x64993a,Room_name:_0x11053a,to_warehouse_name:_0x43d6bf,to_Room_name:_0x4ff82d,note:_0x219bf3,level:_0x8c5965,isle:_0x18d51f,pallet:_0x23545f,for_categorize:_0x329f30}=_0x2557b3[_0x20a954(0x135)];if(typeof _0x185aff==_0x20a954(0x1e2))var _0xb3c1eb=[_0x2557b3['body']['product_name']],_0x1138df=[_0x2557b3[_0x20a954(0x135)]['primary_code']],_0x1256fc=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0xed)]],_0x2b446b=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x19d)]],_0x13768d=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x1ce)]],_0x561d56=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x1cc)]],_0x2464ae=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x1ea)]],_0x354008=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x133)]],_0x7cd7e8=[_0x2557b3['body'][_0x20a954(0x1b8)]],_0x183d1e=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x1b0)]],_0x398d66=[_0x2557b3[_0x20a954(0x135)]['secondary_unit']],_0x3dac54=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x1a4)]],_0x105bc5=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x114)]],_0x4330a8=[_0x2557b3[_0x20a954(0x135)][_0x20a954(0x17d)]];else var _0xb3c1eb=[..._0x2557b3['body'][_0x20a954(0x172)]],_0x1138df=[..._0x2557b3['body']['primary_code']],_0x1256fc=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0xed)]],_0x2b446b=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x19d)]],_0x13768d=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x1ce)]],_0x561d56=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x1cc)]],_0x2464ae=[..._0x2557b3[_0x20a954(0x135)]['bay']],_0x354008=[..._0x2557b3['body']['maxPerUnit']],_0x7cd7e8=[..._0x2557b3[_0x20a954(0x135)]['maxProducts']],_0x183d1e=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x1b0)]],_0x398d66=[..._0x2557b3[_0x20a954(0x135)]['secondary_unit']],_0x3dac54=[..._0x2557b3['body'][_0x20a954(0x1a4)]],_0x105bc5=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x114)]],_0x4330a8=[..._0x2557b3[_0x20a954(0x135)][_0x20a954(0x17d)]];const _0x44a57b=_0xb3c1eb[_0x20a954(0x129)](_0x19193a=>{return _0x19193a={'product_name':_0x19193a};});_0x1138df['forEach']((_0x5798a3,_0x185f01)=>{var _0x34473a=_0x20a954;_0x44a57b[_0x185f01][_0x34473a(0x10e)]=_0x5798a3;}),_0x1256fc[_0x20a954(0x149)]((_0x1ac81f,_0x348b1b)=>{var _0x42c81e=_0x20a954;_0x44a57b[_0x348b1b][_0x42c81e(0xed)]=_0x1ac81f;}),_0x2b446b[_0x20a954(0x149)]((_0x3a3df4,_0x1af1e2)=>{var _0x1a0a9f=_0x20a954;_0x44a57b[_0x1af1e2][_0x1a0a9f(0x19d)]=_0x3a3df4;}),_0x13768d[_0x20a954(0x149)]((_0x3ea679,_0x2691b8)=>{_0x44a57b[_0x2691b8]['sale_qty']=_0x3ea679;}),_0x561d56[_0x20a954(0x149)]((_0xc171d7,_0x5094a6)=>{_0x44a57b[_0x5094a6]['return_qty']=_0xc171d7;}),_0x2464ae[_0x20a954(0x149)]((_0x50b7a0,_0x5c6056)=>{_0x44a57b[_0x5c6056]['bay']=_0x50b7a0;}),_0x354008[_0x20a954(0x149)]((_0xb3b11a,_0x15e536)=>{var _0x4f2b25=_0x20a954;_0x44a57b[_0x15e536][_0x4f2b25(0x133)]=_0xb3b11a;}),_0x7cd7e8[_0x20a954(0x149)]((_0x2448ed,_0x31cae0)=>{var _0x1594a7=_0x20a954;_0x44a57b[_0x31cae0][_0x1594a7(0x1b8)]=_0x2448ed;}),_0x183d1e[_0x20a954(0x149)]((_0x3506d9,_0x35e969)=>{var _0xc9349d=_0x20a954;_0x44a57b[_0x35e969][_0xc9349d(0x1b0)]=_0x3506d9;}),_0x398d66[_0x20a954(0x149)]((_0x4cb1ed,_0x529581)=>{var _0x4fe50d=_0x20a954;_0x44a57b[_0x529581][_0x4fe50d(0x138)]=_0x4cb1ed;}),_0x3dac54['forEach']((_0x1f5f6f,_0x3f491f)=>{var _0x3ae66f=_0x20a954;_0x44a57b[_0x3f491f][_0x3ae66f(0x1a4)]=_0x1f5f6f;}),_0x105bc5[_0x20a954(0x149)]((_0xc6429b,_0x2fec0c)=>{_0x44a57b[_0x2fec0c]['production_date']=_0xc6429b;}),_0x4330a8[_0x20a954(0x149)]((_0x5c5ff7,_0x5e4906)=>{var _0x974132=_0x20a954;_0x44a57b[_0x5e4906][_0x974132(0x17d)]=_0x5c5ff7;});var _0x4944b3=0x0;_0x44a57b[_0x20a954(0x149)](_0x26c9bf=>{var _0x3857bb=_0x20a954;(parseInt(_0x26c9bf[_0x3857bb(0x1b3)])<parseInt(_0x26c9bf[_0x3857bb(0x1cc)])||parseInt(_0x26c9bf[_0x3857bb(0xeb)])<parseInt(_0x26c9bf[_0x3857bb(0x1cc)])&&parseInt(_0x26c9bf[_0x3857bb(0x1b3)])>parseInt(_0x26c9bf[_0x3857bb(0x1cc)])||parseInt(_0x26c9bf['return_qty'])==0x0)&&_0x4944b3++;});if(_0x4944b3!=0x0)return _0x2557b3[_0x20a954(0x1b4)](_0x20a954(0x16f),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x1fb80f[_0x20a954(0x1e5)](_0x20a954(0x171));const _0x2cbb13=await sales_finished[_0x20a954(0x11f)]({'invoice':_0x1cf7a1});_0x2cbb13[_0x20a954(0x1ab)]=_0x20a954(0xe4);const _0x28a605=await _0x2cbb13[_0x20a954(0x178)](),_0x576e3d=new sales_return_finished({'invoice':_0x1cf7a1,'customer':_0x2557b3[_0x20a954(0x135)][_0x20a954(0x17e)],'date':_0xfaa1a0,'warehouse_name':_0x2d8548,'room':_0x11053a,'ToWarehouse':_0x43d6bf,'ToRoom':_0x4ff82d,'return_sale':_0x44a57b,'note':_0x219bf3,'warehouse_cat':_0x329f30}),_0x413bb7=await _0x576e3d['save'](),_0x1882a1=await sales_return_finished[_0x20a954(0x11f)]({'invoice':_0x1cf7a1}),_0x132071=await warehouse[_0x20a954(0x11f)]({'name':_0x43d6bf,'room':_0x4ff82d,'warehouse_category':_0x20a954(0xf1)});_0x1882a1[_0x20a954(0x1ef)]['forEach'](_0x44423d=>{var _0x5204a1=_0x20a954,_0x569cca=0x0;const _0x85643c=_0x132071[_0x5204a1(0x1af)]['map'](_0x5362fa=>{var _0x143046=_0x5204a1;_0x5362fa['product_name']==_0x44423d[_0x143046(0x172)]&&_0x5362fa[_0x143046(0x1ea)]==_0x44423d['bay']&&_0x5362fa[_0x143046(0x17d)]==_0x44423d[_0x143046(0x17d)]&&_0x5362fa[_0x143046(0x114)]==_0x44423d[_0x143046(0x114)]&&_0x5362fa[_0x143046(0x1b0)]==_0x44423d[_0x143046(0x1b0)]&&(_0x5362fa[_0x143046(0xf7)]=parseInt(_0x5362fa['product_stock'])+parseInt(_0x44423d['return_qty']),_0x569cca++);});_0x569cca=='0'&&(_0x132071[_0x5204a1(0x1af)]=_0x132071[_0x5204a1(0x1af)][_0x5204a1(0x1f6)]({'product_name':_0x44423d[_0x5204a1(0x172)],'product_stock':_0x44423d[_0x5204a1(0x1cc)],'primary_code':_0x44423d[_0x5204a1(0x10e)],'secondary_code':_0x44423d[_0x5204a1(0xed)],'product_code':_0x44423d[_0x5204a1(0x19d)],'bay':_0x44423d[_0x5204a1(0x1ea)],'batch_code':_0x44423d[_0x5204a1(0x1b0)],'maxPerUnit':_0x44423d[_0x5204a1(0x133)],'production_date':_0x44423d[_0x5204a1(0x114)],'expiry_date':_0x44423d[_0x5204a1(0x17d)],'secondary_unit':_0x44423d[_0x5204a1(0x138)],'unit':_0x44423d['unit'],'maxProducts':_0x44423d[_0x5204a1(0x1b8)]}));}),await _0x132071['save'](),console[_0x20a954(0x1bd)](_0x2557b3['body']);const _0x556809=new c_payment_data({'invoice':_0x1cf7a1,'customer':_0x2557b3[_0x20a954(0x135)]['customer'],'reason':'Sale\x20Return'});await _0x556809[_0x20a954(0x178)]();const _0x16ae3d=await master_shop['find']();console['log'](_0x20a954(0x12b),_0x16ae3d[0x0][_0x20a954(0x14a)]);const _0x239874=await email_settings[_0x20a954(0x11f)](),_0x47108b=await customer[_0x20a954(0x11f)]({'name':_0x2557b3[_0x20a954(0x135)][_0x20a954(0x17e)]});console[_0x20a954(0x1bd)]('customer_data',_0x47108b);_0x16ae3d[0x0][_0x20a954(0x103)]==0x1?(right_currency=_0x16ae3d[0x0][_0x20a954(0x15c)],left_currency=''):(right_currency='',left_currency=_0x16ae3d[0x0][_0x20a954(0x15c)]);var _0x16601e=_0xb3c1eb,_0xb2ac9=_0x561d56,_0x172978='',_0x5343d3;for(_0x5343d3 in _0x16601e){_0x172978+=_0x20a954(0x1e7)+_0x20a954(0x127)+_0x16601e[_0x5343d3]+_0x20a954(0x1ad)+_0x20a954(0x127)+_0xb2ac9[_0x5343d3]+'</td>'+_0x20a954(0x18b);}console['log'](_0x20a954(0x117),_0x172978);let _0x3a447c=nodemailer[_0x20a954(0x121)]({'service':_0x20a954(0x1b1),'auth':{'user':_0x239874[_0x20a954(0x140)],'pass':_0x239874[_0x20a954(0x16c)]}}),_0x2a73ca={'from':_0x239874['email'],'to':_0x47108b[_0x20a954(0x140)],'subject':_0x20a954(0x111),'attachments':[{'filename':_0x20a954(0xfc),'path':__dirname+'/../public'+_0x20a954(0x124)+_0x16ae3d[0x0][_0x20a954(0x14a)],'cid':_0x20a954(0x189)}],'html':_0x20a954(0x181)+_0x20a954(0x157)+_0x20a954(0x1d4)+_0x20a954(0x195)+_0x20a954(0xfe)+'<div>'+_0x20a954(0x169)+'</div>'+'<div>'+_0x20a954(0x162)+_0x16ae3d[0x0]['site_title']+_0x20a954(0x14d)+'</div>'+_0x20a954(0x1b7)+_0x20a954(0x147)+'<div>'+_0x20a954(0x1ed)+'\x20Order\x20Number\x20:\x20'+_0x1cf7a1+'\x20'+_0x20a954(0x1c2)+'\x20Order\x20Date\x20:\x20'+_0xfaa1a0+'\x20'+_0x20a954(0xf4)+_0x20a954(0x15d)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x20a954(0x1e7)+_0x20a954(0x118)+_0x20a954(0x17c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x20a954(0x18a)+_0x20a954(0x18b)+_0x20a954(0x104)+_0x20a954(0x12c)+'\x20'+_0x172978+'\x20'+'</tbody>'+_0x20a954(0x1a7)+_0x20a954(0x195)+_0x20a954(0x1c3)+'<h5>'+_0x16ae3d[0x0]['site_title']+'</h5>'+_0x20a954(0x1b7)+'</div>'+_0x20a954(0x11c)};_0x3a447c[_0x20a954(0x160)](_0x2a73ca,function(_0x5c0b99,_0x4f0e3f){var _0x167ac8=_0x20a954;_0x5c0b99?(console[_0x167ac8(0x1bd)](_0x5c0b99),console[_0x167ac8(0x1bd)](_0x167ac8(0x1c5))):console[_0x167ac8(0x1bd)]('Email\x20sent\x20successfully');}),_0x2557b3[_0x20a954(0x1b4)](_0x20a954(0x1a8),'sales\x20item\x20return\x20successfull'),_0x1fb80f[_0x20a954(0x1e5)](_0x20a954(0x180));}catch(_0x110b93){console[_0x20a954(0x1bd)](_0x110b93),_0x1fb80f[_0x20a954(0x19b)](0xc8)[_0x20a954(0x100)]({'message1':_0x110b93['message']});}}}),router['get'](a0_0xc2500c(0x122),auth,async(_0x561542,_0x1b73f5)=>{var _0x33d843=a0_0xc2500c;try{const {username:_0x27ffd2,email:_0x4c8724,role:_0xbb4931}=_0x561542[_0x33d843(0x12a)],_0x557e3d=_0x561542[_0x33d843(0x12a)],_0x4e7c1a=await profile[_0x33d843(0x11f)]({'email':_0x557e3d['email']}),_0x471f60=await master_shop[_0x33d843(0x15f)]();console[_0x33d843(0x1bd)](_0x33d843(0xe3),_0x471f60);const _0x2ae919=_0x561542[_0x33d843(0x1f0)]['id'],_0x232879=await sales['findById'](_0x2ae919);console['log'](_0x33d843(0x1f8),_0x232879);if(_0x471f60[0x0][_0x33d843(0x13b)]==_0x33d843(0x107))var _0x7493d2=users[_0x33d843(0x14f)];else{if(_0x471f60[0x0][_0x33d843(0x13b)]==_0x33d843(0x145))var _0x7493d2=users[_0x33d843(0x145)];else{if(_0x471f60[0x0][_0x33d843(0x13b)]=='German')var _0x7493d2=users[_0x33d843(0x1de)];else{if(_0x471f60[0x0][_0x33d843(0x13b)]==_0x33d843(0x102))var _0x7493d2=users['Spanish'];else{if(_0x471f60[0x0][_0x33d843(0x13b)]=='French')var _0x7493d2=users[_0x33d843(0x10c)];else{if(_0x471f60[0x0][_0x33d843(0x13b)]==_0x33d843(0x12e))var _0x7493d2=users[_0x33d843(0x12f)];else{if(_0x471f60[0x0][_0x33d843(0x13b)]==_0x33d843(0x18c))var _0x7493d2=users[_0x33d843(0x18c)];else{if(_0x471f60[0x0][_0x33d843(0x13b)]==_0x33d843(0x19f))var _0x7493d2=users[_0x33d843(0x146)];}}}}}}}_0x1b73f5['render'](_0x33d843(0x1ae),{'success':_0x561542[_0x33d843(0x1b4)](_0x33d843(0x1a8)),'errors':_0x561542[_0x33d843(0x1b4)]('errors'),'role':_0x557e3d,'profile':_0x4e7c1a,'alldata':_0x232879,'master_shop':_0x471f60,'language':_0x7493d2});}catch(_0x5ba46){console[_0x33d843(0x1bd)](_0x5ba46);}}),router[a0_0xc2500c(0x1bf)](a0_0xc2500c(0x179),async(_0xd25353,_0x1f097b)=>{var _0x872137=a0_0xc2500c;const {product_code:_0x165969,warehouse_name:_0x54743c,rooms_data:_0x2f32ab,Roomslist:_0x39b8c2}=_0xd25353['body'],_0xee7d96=_0x39b8c2['split'](','),_0x361221=[];async function _0x10eb4e(_0x4758db){var _0x2203ca=a0_0x47bf;const _0x358ca0=await warehouse['aggregate']([{'$match':{'name':_0x54743c,'room':_0x4758db}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x165969}},{'$group':{'_id':_0x2203ca(0x14c),'name':{'$first':_0x2203ca(0x182)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2203ca(0x173)},'secondary_code':{'$first':_0x2203ca(0x1d5)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2203ca(0x11d)},'isle':{'$first':_0x2203ca(0xf9)},'type':{'$first':_0x2203ca(0x1a6)},'pallet':{'$first':_0x2203ca(0x1dc)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2203ca(0x19a)},'storage':{'$first':_0x2203ca(0x11e)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2203ca(0x150)},'production_date':{'$first':_0x2203ca(0x1cb)},'maxPerUnit':{'$first':_0x2203ca(0xfb)},'batch_code':{'$first':_0x2203ca(0xf2)},'product_cat':{'$first':_0x2203ca(0x1bb)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2203ca(0xe9)},'invoice':{'$first':_0x2203ca(0xfd)}}}]),_0x335a66=await warehouse[_0x2203ca(0xfa)]([{'$match':{'name':_0x54743c,'room':_0x4758db}},{'$unwind':_0x2203ca(0x1f4)},{'$match':{'product_details.secondary_code':_0x165969}},{'$group':{'_id':_0x2203ca(0x14c),'name':{'$first':_0x2203ca(0x182)},'product_stock':{'$first':_0x2203ca(0xf0)},'primary_code':{'$first':_0x2203ca(0x173)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2203ca(0x1ba)},'level':{'$first':_0x2203ca(0x11d)},'isle':{'$first':_0x2203ca(0xf9)},'type':{'$first':_0x2203ca(0x1a6)},'pallet':{'$first':_0x2203ca(0x1dc)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2203ca(0x19a)},'storage':{'$first':_0x2203ca(0x11e)},'rack':{'$first':_0x2203ca(0x1dd)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2203ca(0x1cb)},'maxPerUnit':{'$first':_0x2203ca(0xfb)},'batch_code':{'$first':_0x2203ca(0xf2)},'product_cat':{'$first':_0x2203ca(0x1bb)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2203ca(0xe9)},'invoice':{'$first':_0x2203ca(0xfd)}}}]);if(_0x358ca0[_0x2203ca(0x1a5)]>0x0)_0x361221[_0x2203ca(0x193)](_0x358ca0);else _0x335a66[_0x2203ca(0x1a5)]>0x0&&_0x361221[_0x2203ca(0x193)](_0x335a66);}const _0x43b2f0=_0xee7d96[_0x872137(0x129)](_0x143488=>_0x10eb4e(_0x143488));await Promise[_0x872137(0x13e)](_0x43b2f0),_0x1f097b[_0x872137(0x100)](_0x361221);}),module[a0_0xc2500c(0x1c9)]=router;