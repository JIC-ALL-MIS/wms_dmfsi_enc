var a0_0x5d1488=a0_0x4aa4;function a0_0x4aa4(_0xeb9b00,_0xffa034){var _0x5ca242=a0_0x5ca2();return a0_0x4aa4=function(_0x4aa469,_0x273431){_0x4aa469=_0x4aa469-0x96;var _0x24ed75=_0x5ca242[_0x4aa469];return _0x24ed75;},a0_0x4aa4(_0xeb9b00,_0xffa034);}function a0_0x5ca2(){var _0x1a3dcc=['primary_code_QA','$product_details.unit','quantity','findById','gmail','2367495agoDKf','random','then','$product_details.secondary_unit','/all_sales_finished/preview/','<tbody\x20style=\x22text-align:\x20center;\x22>','maxProducts','sale_qty','_id','\x20Order\x20Date\x20:\x20','\x20<>\x20','forEach','expiry_date_QA','German','exports','staff','max_per_unit','password','flash','/preview/:id','filter','$return_data','padStart','product_name','finalize','sales\x20item\x20return\x20successfull','logo','return_sale_finished','name','errors','1077988iJdGWY','$product_details.maxPerUnit','\x20<<<==>>>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','redirect','Logo.png','post','customer_data','</span>','$product_details.type','Sale\x20Return','length','getDate','Quality\x20Inspection','createTransport','Portuguese','maxperunit','Email\x20sent\x20successfully','stocks_QA','Router','English','Chinese','expiry_date','split','production_date_QA','primary_unit','</body></html>','Enabled','sale_product','stock_data','getFullYear','/view/return_sales/:id','</table>','slice','return_qty_QA','</head><body>','customers','return_qty','batch_code','product_name_QA1','Spanish','<tr>','$product_details.expiry_date','stock','193uhNnsZ','10UQqujR','Enclosed','$product_details.product_code','message','$product_details.room_name','concat','/barcode/:id','295484LcmPBC','/view','body','$note','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$finalize','4069850IzqzGt','Must\x20not\x20be\x20greater\x20or\x20less\x20than\x20stock\x20Qty','\x20==\x20','8177015wSTOdH','bay','all_sales_barcode','params','$room','product_list','$product_details.product_name','../middleware/auth','success','Error\x20Occurs','Sales\x20Update\x20successfully','all','Sale\x20Return\x20Mail','production_date','$product_details.batch_code','primary_code','adjust_qty','$product_details.bay','2380734bEFHGo','find','error','return_data','French','$customers_docs','RoomAssigned','$sale_product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','foreach\x20newproduct','9014lrDPVA','maxPerUnit','warehouse','$product_details.bin','status','$product_details._id','$sale_product.quantity','</thead>','customer','<h5\x20style=\x22text-align:\x20left;\x22>','findOne','<strong>\x20Regards\x20</strong>','product_stock','</td>','</div>','add_sales_finished','unit','port','/view/add_sale/product','$product_details','$product','$_id','/view/:id','$product_details.product_cat','$product_details.floorlevel','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</tbody>','secondary_code_QA','Finished\x20Goods','Hindi','sales_quantity','purchases_data','</tr>','24RGxtAL','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','batch_code_QA','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','customers_docs','../models/all_models','currency_placement','host','return_sale','for_categorize','<hr\x20class=\x22my-3\x22>','unit_QA','aggregate','secondary_unit_QA','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/../public','return_sale_QA','image','/view/add_sales','$sale_product.type','received_amount','map','site_title','<h2>\x20','$product_details.production_date','edit_sales_finished_view','True','prod_invoice','warehouse_name','Return\x20Goods','getMonth','product_data','/all_sales/view','final','OUTF-','../public/language/languages.json','3ZptqNs','payment\x20successfull','room','<html><head><title></title>','string','$sale_product','$warehouse_name','product_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/barcode_scanner','toString','save','date','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','prod_cat','English\x20(US)','$product_details.primary_code','sales_quantity_QA','level','carton','product_code_QA','$product.product_name','/invoice/:id','Sales\x20Add\x20successfully','$sale_product.bin','id_transaction_from','role','$product_details.invoice','QA\x20Warehouse','room_name','$product_details.storage','product_date','currency','abs','Arabic\x20(ae)','/all_sales_finished/view','secondary_unit','</h5>','render','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Sale\x20Product\x20Mail','\x20&&\x20','$invoice','Ambient','$product_details.secondary_code','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<h5>','Arabic','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','maxProducts_QA','\x20>>>\x20','<!DOCTYPE\x20html>','json','$product_details.maxProducts','get','prod_code','<span\x20style=\x22float:\x20right;\x22>','log','invoice','<div>','An\x20error\x20occurred.','language','Portuguese\x20(BR)','False','sendMail','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Quantity\x20</th>','master','\x20Order\x20Number\x20:\x20','/upload/','<table\x20style=\x22width:\x20100%\x20!important;\x22>','\x20</h2>','edit_sales_finished','FGSEmail','back','product','DRY\x20GOODS','product_details','$product_details.product_stock','There\x27s\x20a\x20error\x20in\x20this\x20transaction','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$product_details.rack','push','$name','/view/add_sales/:id','An\x20error\x20occurred\x20while\x20saving\x20data.'];a0_0x5ca2=function(){return _0x1a3dcc;};return a0_0x5ca2();}(function(_0x644274,_0x530f47){var _0x567338=a0_0x4aa4,_0x4b6e07=_0x644274();while(!![]){try{var _0x1f151e=-parseInt(_0x567338(0xcb))/0x1*(-parseInt(_0x567338(0xf9))/0x2)+-parseInt(_0x567338(0x13f))/0x3*(-parseInt(_0x567338(0x9f))/0x4)+parseInt(_0x567338(0xcc))/0x5*(-parseInt(_0x567338(0xee))/0x6)+-parseInt(_0x567338(0xd3))/0x7*(-parseInt(_0x567338(0x11b))/0x8)+-parseInt(_0x567338(0x19d))/0x9+-parseInt(_0x567338(0xd9))/0xa+parseInt(_0x567338(0xdc))/0xb;if(_0x1f151e===_0x530f47)break;else _0x4b6e07['push'](_0x4b6e07['shift']());}catch(_0x2f2f1c){_0x4b6e07['push'](_0x4b6e07['shift']());}}}(a0_0x5ca2,0x853c3));const express=require('express'),app=express(),router=express[a0_0x5d1488(0xb2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,sales_finished,sales_return_finished,supervisor_settings}=require(a0_0x5d1488(0x120)),auth=require(a0_0x5d1488(0xe3)),nodemailer=require('nodemailer'),users=require(a0_0x5d1488(0x13e));router[a0_0x5d1488(0x177)](a0_0x5d1488(0xd4),auth,async(_0xc057bd,_0x4a32be)=>{var _0x41cd10=a0_0x5d1488;try{const {username:_0x22a8ea,email:_0x1f8def,role:_0xee0254}=_0xc057bd[_0x41cd10(0x191)],_0x5bee6a=_0xc057bd[_0x41cd10(0x191)],_0x213d81=await profile[_0x41cd10(0x103)]({'email':_0x5bee6a[_0x41cd10(0x14c)]}),_0x29c768=await master_shop[_0x41cd10(0xef)]();let _0x189787;if(_0x5bee6a[_0x41cd10(0x15a)]==_0x41cd10(0x1ac)){const _0x190689=await staff[_0x41cd10(0x103)]({'email':_0x5bee6a['email']});_0x189787=await sales_finished[_0x41cd10(0x127)]([{'$lookup':{'from':_0x41cd10(0xc3),'localField':_0x41cd10(0x101),'foreignField':_0x41cd10(0x9d),'as':_0x41cd10(0x11f)}},{'$unwind':_0x41cd10(0xf3)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x41cd10(0x10e),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x41cd10(0x16d)},'warehouse_name':{'$first':_0x41cd10(0x145)},'sale_product':{'$push':_0x41cd10(0x144)},'note':{'$first':_0x41cd10(0xd6)},'return_data':{'$first':_0x41cd10(0x96)},'customers_docs':{'$first':_0x41cd10(0xf3)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x41cd10(0x12e)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);}else _0x189787=await sales_finished[_0x41cd10(0x127)]([{'$lookup':{'from':_0x41cd10(0xc3),'localField':_0x41cd10(0x101),'foreignField':_0x41cd10(0x9d),'as':'customers_docs'}},{'$unwind':_0x41cd10(0xf3)},{'$unwind':_0x41cd10(0x144)},{'$group':{'_id':'$_id','invoice':{'$first':_0x41cd10(0x16a)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x41cd10(0x145)},'sale_product':{'$push':_0x41cd10(0x144)},'note':{'$first':'$note'},'return_data':{'$first':_0x41cd10(0x96)},'customers_docs':{'$first':_0x41cd10(0xf3)},'total_saleproduct_quantity':{'$sum':_0x41cd10(0xff)},'level':{'$addToSet':_0x41cd10(0xf5)},'isle':{'$addToSet':_0x41cd10(0x158)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x41cd10(0xd8)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1}}]);if(_0x29c768[0x0][_0x41cd10(0x17e)]==_0x41cd10(0x14f)){var _0x3f9eab=users[_0x41cd10(0xb3)];console[_0x41cd10(0x17a)](_0x3f9eab);}else{if(_0x29c768[0x0][_0x41cd10(0x17e)]==_0x41cd10(0x117))var _0x3f9eab=users[_0x41cd10(0x117)];else{if(_0x29c768[0x0]['language']==_0x41cd10(0x1aa))var _0x3f9eab=users[_0x41cd10(0x1aa)];else{if(_0x29c768[0x0]['language']==_0x41cd10(0xc7))var _0x3f9eab=users[_0x41cd10(0xc7)];else{if(_0x29c768[0x0][_0x41cd10(0x17e)]==_0x41cd10(0xf2))var _0x3f9eab=users['French'];else{if(_0x29c768[0x0][_0x41cd10(0x17e)]==_0x41cd10(0x17f))var _0x3f9eab=users['Portuguese'];else{if(_0x29c768[0x0][_0x41cd10(0x17e)]==_0x41cd10(0xb4))var _0x3f9eab=users[_0x41cd10(0xb4)];else{if(_0x29c768[0x0]['language']==_0x41cd10(0x162))var _0x3f9eab=users[_0x41cd10(0x170)];}}}}}}}_0x4a32be['render']('all_sales_finished',{'success':_0xc057bd['flash'](_0x41cd10(0xe4)),'errors':_0xc057bd['flash'](_0x41cd10(0x9e)),'sales':_0x189787,'profile':_0x213d81,'role':_0x5bee6a,'master_shop':_0x29c768,'language':_0x3f9eab});}catch(_0xc358e){console[_0x41cd10(0x17a)](_0xc358e);}});async function getRandom8DigitNumber(){var _0x11ed7f=a0_0x5d1488;const _0x5164ae=0x989680,_0x5eab2b=0x5f5e0ff,_0x4d2b0b=Math['floor'](Math[_0x11ed7f(0x19e)]()*(_0x5eab2b-_0x5164ae+0x1))+_0x5164ae;var _0x4d0dc5;const _0x488e18=await sales_finished[_0x11ed7f(0x103)]({'invoice':_0x11ed7f(0x13d)+_0x4d2b0b});return _0x488e18&&_0x488e18['length']>0x0?_0x4d0dc5=_0x11ed7f(0x13d)+_0x4d2b0b:_0x4d0dc5=_0x11ed7f(0x13d)+_0x4d2b0b,_0x4d0dc5;}router['get'](a0_0x5d1488(0x12d),auth,async(_0x4c9ee9,_0xb54b8e)=>{var _0x2d9a93=a0_0x5d1488;try{const {username:_0x1ec0f6,email:_0x3b0d99,role:_0x58fda0}=_0x4c9ee9[_0x2d9a93(0x191)],_0xc0dd6b=_0x4c9ee9[_0x2d9a93(0x191)],_0x5591cd=await profile['findOne']({'email':_0xc0dd6b['email']}),_0x12b653=await master_shop[_0x2d9a93(0xef)](),_0x21171d=await customer[_0x2d9a93(0xef)]({});let _0x36c5e7;if(_0xc0dd6b[_0x2d9a93(0x15a)]==_0x2d9a93(0x1ac)){const _0x35e6dd=await staff[_0x2d9a93(0x103)]({'email':_0xc0dd6b['email']});_0x36c5e7=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x35e6dd['warehouse'],'warehouse_category':_0x2d9a93(0x116),'name':{'$ne':_0x2d9a93(0x15c)}}},{'$group':{'_id':_0x2d9a93(0x195),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x36c5e7=await warehouse['aggregate']([{'$match':{'status':_0x2d9a93(0xba),'warehouse_category':_0x2d9a93(0x116),'name':{'$ne':_0x2d9a93(0x15c)}}},{'$group':{'_id':'$name','name':{'$first':_0x2d9a93(0x195)}}},{'$sort':{'name':0x1}}]);const _0x40cf21=await product[_0x2d9a93(0xef)]({});var _0x69f04e=['Ambient','Enclosed'];const _0x341d4d=await sales_finished['find']({}),_0x570bc0=_0x341d4d[_0x2d9a93(0xaa)]+0x1,_0x4347da=_0x2d9a93(0x13d)+_0x570bc0[_0x2d9a93(0x149)]()[_0x2d9a93(0x97)](0x5,'0');if(_0x12b653[0x0][_0x2d9a93(0x17e)]==_0x2d9a93(0x14f)){var _0x153a9c=users[_0x2d9a93(0xb3)];console['log'](_0x153a9c);}else{if(_0x12b653[0x0]['language']=='Hindi')var _0x153a9c=users[_0x2d9a93(0x117)];else{if(_0x12b653[0x0]['language']=='German')var _0x153a9c=users[_0x2d9a93(0x1aa)];else{if(_0x12b653[0x0]['language']==_0x2d9a93(0xc7))var _0x153a9c=users[_0x2d9a93(0xc7)];else{if(_0x12b653[0x0]['language']=='French')var _0x153a9c=users[_0x2d9a93(0xf2)];else{if(_0x12b653[0x0]['language']==_0x2d9a93(0x17f))var _0x153a9c=users[_0x2d9a93(0xae)];else{if(_0x12b653[0x0]['language']=='Chinese')var _0x153a9c=users[_0x2d9a93(0xb4)];else{if(_0x12b653[0x0]['language']==_0x2d9a93(0x162))var _0x153a9c=users[_0x2d9a93(0x170)];}}}}}}}const _0x2d90e4=getRandom8DigitNumber();_0x2d90e4['then'](_0x22a83f=>{var _0x32873d=_0x2d9a93;_0xb54b8e[_0x32873d(0x166)](_0x32873d(0x108),{'success':_0x4c9ee9['flash'](_0x32873d(0xe4)),'errors':_0x4c9ee9[_0x32873d(0x1af)](_0x32873d(0x9e)),'role':_0xc0dd6b,'profile':_0x5591cd,'customer':_0x21171d,'warehouse':_0x36c5e7,'product':_0x40cf21,'invoice':_0x22a83f,'master_shop':_0x12b653,'language':_0x153a9c,'rooms_data':_0x69f04e});})[_0x2d9a93(0x112)](_0x18edb7=>{var _0x2a23f9=_0x2d9a93;_0x4c9ee9['flash']('errors',_0x2a23f9(0x190)),_0xb54b8e[_0x2a23f9(0xa3)](_0x2a23f9(0x163));});}catch(_0x4f22d5){console['log'](_0x4f22d5);}}),router[a0_0x5d1488(0x177)](a0_0x5d1488(0x196),auth,async(_0x48c18b,_0xfa527a)=>{var _0x491469=a0_0x5d1488;try{const _0x3e8fdf=_0x48c18b[_0x491469(0xdf)]['id'];console[_0x491469(0x17a)](_0x3e8fdf);const _0xd7ed63=await product[_0x491469(0xef)](),_0x3aec44=await purchases['aggregate']([{'$match':{'warehouse_name':_0x3e8fdf}},{'$unwind':_0x491469(0x10d)},{'$group':{'_id':_0x491469(0x155)}}]);console['log'](_0x491469(0x119),_0x3aec44),_0xfa527a[_0x491469(0xfd)](0xc8)[_0x491469(0x175)]({'purchases_data':_0x3aec44,'product_data':_0xd7ed63});}catch(_0x1a1556){console[_0x491469(0x17a)](_0x1a1556);}}),router[a0_0x5d1488(0xa5)](a0_0x5d1488(0x10b),auth,async(_0x239fa2,_0x184e94)=>{var _0x330371=a0_0x5d1488;try{const {warehouse_data:_0x526f26,product_data:_0x385270}=_0x239fa2['body'];console[_0x330371(0x17a)](_0x239fa2[_0x330371(0xd5)][_0x330371(0x13a)]);;const _0x2d3efe=await master_shop['find']();console[_0x330371(0x17a)](_0x330371(0x184),_0x2d3efe);const _0x44125e=await product['findOne']({'name':_0x385270});console[_0x330371(0x17a)](_0x330371(0x18c),_0x44125e);const _0x165abc=await warehouse['aggregate']([{'$match':{'name':_0x526f26}},{'$unwind':_0x330371(0x10c)},{'$match':{'product_details.product_name':_0x385270}},{'$group':{'_id':_0x330371(0xe2),'product_stock':{'$first':_0x330371(0x18f)}}}]);console[_0x330371(0x17a)](_0x330371(0xbc),_0x165abc),_0x184e94[_0x330371(0xfd)](0xc8)['json']({'master':_0x2d3efe,'new_product':_0x44125e,'stock_data':_0x165abc});}catch(_0x5ae56a){console[_0x330371(0x17a)](_0x5ae56a);}}),router[a0_0x5d1488(0xa5)](a0_0x5d1488(0x12d),auth,async(_0x5f7892,_0xaf84aa)=>{var _0x1dd9a6=a0_0x5d1488;try{const {invoice:_0x3a2f14,date:_0x59deda,warehouse_name:_0x3489d9,product_name:_0x9c0899,stock:_0x281664,quantity:_0xa14d6b,note:_0xce55ed,room:_0x136751,primary_code:_0x10d0ab,secondary_code:_0x57e37d,prod_code:_0x2f8413,level:_0x2c5350,isle:_0x446f19,pallet:_0x4119eb,batch_code:_0x48d7bd,SCRN:_0x2b9087,expiry_date:_0x3de367,mode_transpo:_0x53217c,name_driver:_0x455cdf}=_0x5f7892[_0x1dd9a6(0xd5)];if(typeof _0x9c0899==_0x1dd9a6(0x143))var _0x925e66=[_0x5f7892[_0x1dd9a6(0xd5)]['product_name']],_0xccedb=[_0x5f7892[_0x1dd9a6(0xd5)]['stock']],_0x1f717d=[_0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0x153)]],_0x25b6b4=[_0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0xeb)]],_0x6cb35b=[_0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0x182)]],_0x22c2dc=[_0x5f7892['body'][_0x1dd9a6(0x178)]],_0x586385=[_0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0x152)]],_0x4d21ba=[_0x5f7892['body']['primary_unit']],_0x24c682=[_0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0x164)]],_0x96c41e=[_0x5f7892['body'][_0x1dd9a6(0xc5)]],_0x27c81a=[_0x5f7892['body']['expiry_date']],_0xc64e4f=[_0x5f7892[_0x1dd9a6(0xd5)]['product_date']],_0x564f92=[_0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0x1ad)]],_0x339b5e=[_0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0x14e)]],_0x2dd37e=[_0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0xf4)]],_0x458cc3=[_0x5f7892['body'][_0x1dd9a6(0x136)]],_0x55a9f4=[_0x5f7892[_0x1dd9a6(0xd5)]['id_transaction_from']];else var _0x925e66=[..._0x5f7892['body'][_0x1dd9a6(0x98)]],_0xccedb=[..._0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0xca)]],_0x1f717d=[..._0x5f7892['body'][_0x1dd9a6(0x153)]],_0x25b6b4=[..._0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0xeb)]],_0x6cb35b=[..._0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0x182)]],_0x22c2dc=[..._0x5f7892['body'][_0x1dd9a6(0x178)]],_0x586385=[..._0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0x152)]],_0x4d21ba=[..._0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0xb8)]],_0x24c682=[..._0x5f7892[_0x1dd9a6(0xd5)]['secondary_unit']],_0x96c41e=[..._0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0xc5)]],_0x27c81a=[..._0x5f7892[_0x1dd9a6(0xd5)]['expiry_date']],_0xc64e4f=[..._0x5f7892['body'][_0x1dd9a6(0x15f)]],_0x564f92=[..._0x5f7892[_0x1dd9a6(0xd5)]['max_per_unit']],_0x339b5e=[..._0x5f7892[_0x1dd9a6(0xd5)]['prod_cat']],_0x2dd37e=[..._0x5f7892[_0x1dd9a6(0xd5)][_0x1dd9a6(0xf4)]],_0x458cc3=[..._0x5f7892['body'][_0x1dd9a6(0x136)]],_0x55a9f4=[..._0x5f7892['body'][_0x1dd9a6(0x159)]];const _0x38aa4e=_0x925e66[_0x1dd9a6(0x130)](_0x5857b7=>{return _0x5857b7={'product_name':_0x5857b7};});_0xccedb[_0x1dd9a6(0x1a8)]((_0x514182,_0x561159)=>{var _0x283671=_0x1dd9a6;_0x38aa4e[_0x561159][_0x283671(0xca)]=_0x514182;}),_0x1f717d[_0x1dd9a6(0x1a8)]((_0x19ce21,_0xb67ce9)=>{var _0xceeb45=_0x1dd9a6;_0x38aa4e[_0xb67ce9]['quantity']=Math[_0xceeb45(0x161)](_0x19ce21);}),_0x55a9f4[_0x1dd9a6(0x1a8)]((_0x42e830,_0x3bc667)=>{var _0x387ff8=_0x1dd9a6;_0x38aa4e[_0x3bc667][_0x387ff8(0x159)]=_0x42e830;}),_0x25b6b4[_0x1dd9a6(0x1a8)]((_0x512f9b,_0x17681d)=>{var _0x300aec=_0x1dd9a6;_0x38aa4e[_0x17681d][_0x300aec(0xeb)]=_0x512f9b;}),_0x6cb35b['forEach']((_0x3d954f,_0x2a3791)=>{var _0x389347=_0x1dd9a6;_0x38aa4e[_0x2a3791][_0x389347(0x182)]=_0x3d954f;}),_0x22c2dc['forEach']((_0x90a325,_0x59bbc0)=>{_0x38aa4e[_0x59bbc0]['product_code']=_0x90a325;}),_0x586385[_0x1dd9a6(0x1a8)]((_0x3c45d0,_0x5b8d81)=>{_0x38aa4e[_0x5b8d81]['bay']=_0x3c45d0;}),_0x4d21ba[_0x1dd9a6(0x1a8)]((_0x283640,_0x424c91)=>{_0x38aa4e[_0x424c91]['unit']=_0x283640;}),_0x24c682[_0x1dd9a6(0x1a8)]((_0x214367,_0x2e7244)=>{var _0x1cabb2=_0x1dd9a6;_0x38aa4e[_0x2e7244][_0x1cabb2(0x164)]=_0x214367;}),_0x96c41e['forEach']((_0x136d06,_0x5c42fe)=>{var _0x472091=_0x1dd9a6;_0x38aa4e[_0x5c42fe][_0x472091(0xc5)]=_0x136d06;}),_0x27c81a[_0x1dd9a6(0x1a8)]((_0x40b410,_0xf790a8)=>{var _0x5e53d2=_0x1dd9a6;_0x38aa4e[_0xf790a8][_0x5e53d2(0xb5)]=_0x40b410;}),_0xc64e4f[_0x1dd9a6(0x1a8)]((_0x4781fb,_0x2389b6)=>{_0x38aa4e[_0x2389b6]['production_date']=_0x4781fb;}),_0x564f92[_0x1dd9a6(0x1a8)]((_0x2f90e5,_0x40eed0)=>{var _0x12fd33=_0x1dd9a6;_0x38aa4e[_0x40eed0][_0x12fd33(0xaf)]=_0x2f90e5;}),_0x339b5e['forEach']((_0x1e4fb0,_0x147261)=>{_0x38aa4e[_0x147261]['prod_cat']=_0x1e4fb0;}),_0x2dd37e[_0x1dd9a6(0x1a8)]((_0x5d7ed6,_0x54867b)=>{var _0x128f0d=_0x1dd9a6;_0x38aa4e[_0x54867b][_0x128f0d(0x15d)]=_0x5d7ed6;}),_0x458cc3['forEach']((_0x379d5a,_0xcca283)=>{var _0x29063c=_0x1dd9a6;_0x38aa4e[_0xcca283][_0x29063c(0x17b)]=_0x379d5a;});var _0x307d95=0x0;_0x38aa4e[_0x1dd9a6(0x1a8)](_0x5794d2=>{var _0x2734b3=_0x1dd9a6;parseFloat(_0x5794d2['stock'])<parseFloat(_0x5794d2[_0x2734b3(0x19a)])&&parseFloat(_0x5794d2[_0x2734b3(0x19a)])>parseFloat(_0x5794d2[_0x2734b3(0xca)])&&(console[_0x2734b3(0x17a)](_0x5794d2[_0x2734b3(0xca)]+_0x2734b3(0x1a7)+_0x5794d2[_0x2734b3(0x19a)]),_0x307d95++);});if(_0x307d95!=0x0)return _0x5f7892[_0x1dd9a6(0x1af)](_0x1dd9a6(0x9e),_0x1dd9a6(0xda)),_0xaf84aa[_0x1dd9a6(0xa3)](_0x1dd9a6(0x18b));const _0x1d0129=_0x38aa4e[_0x1dd9a6(0x1b1)](_0x2fd585=>_0x2fd585[_0x1dd9a6(0x19a)]!=='0'&&_0x2fd585['quantity']!==''),_0x473c16=new sales_finished({'invoice':_0x3a2f14,'customer':_0x5f7892['body'][_0x1dd9a6(0x101)],'date':_0x59deda,'warehouse_name':_0x3489d9,'sale_product':_0x1d0129,'note':_0xce55ed,'room':_0x136751,'primary_code':_0x10d0ab,'secondary_code':_0x57e37d,'prod_code':_0x2f8413,'SCRN':_0x2b9087,'finalize':_0x1dd9a6(0x180),'mode_transpo':_0x53217c,'name_driver':_0x455cdf}),_0x59e567=await _0x473c16[_0x1dd9a6(0x14a)](),_0x992d87=await sales_finished['findOne']({'invoice':_0x3a2f14}),_0x447351=new c_payment_data({'invoice':_0x3a2f14,'customer':_0x5f7892[_0x1dd9a6(0xd5)]['customer'],'reason':'Sale'});await _0x447351[_0x1dd9a6(0x14a)]();const _0x2d6c1e=await master_shop[_0x1dd9a6(0xef)](),_0x37ce0c=await email_settings[_0x1dd9a6(0x103)](),_0x2bd796=await customer[_0x1dd9a6(0x103)]({'name':_0x5f7892[_0x1dd9a6(0xd5)]['customer']});_0x2d6c1e[0x0]['currency_placement']==0x1?(right_currency=_0x2d6c1e[0x0][_0x1dd9a6(0x160)],left_currency=''):(right_currency='',left_currency=_0x2d6c1e[0x0]['currency']);var _0x329924=_0x925e66,_0x5526a3=_0x1f717d,_0x1514e9='',_0x514d23;for(_0x514d23 in _0x329924){_0x1514e9+=_0x1dd9a6(0xc8)+_0x1dd9a6(0xd7)+_0x329924[_0x514d23]+_0x1dd9a6(0x106)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5526a3[_0x514d23]+_0x1dd9a6(0x106)+_0x1dd9a6(0x11a);}console[_0x1dd9a6(0x17a)]('product_list',_0x1514e9);let _0x58e6de=nodemailer[_0x1dd9a6(0xad)]({'service':'gmail','auth':{'user':_0x37ce0c[_0x1dd9a6(0x14c)],'pass':_0x37ce0c[_0x1dd9a6(0x1ae)]}}),_0x5b7f8d={'from':_0x37ce0c[_0x1dd9a6(0x14c)],'to':_0x2bd796[_0x1dd9a6(0x14c)],'subject':_0x1dd9a6(0x168),'attachments':[{'filename':_0x1dd9a6(0xa4),'path':__dirname+_0x1dd9a6(0x12a)+_0x1dd9a6(0x186)+_0x2d6c1e[0x0][_0x1dd9a6(0x12c)],'cid':_0x1dd9a6(0x9b)}],'html':'<!DOCTYPE\x20html>'+_0x1dd9a6(0x142)+'</head><body>'+_0x1dd9a6(0x17c)+_0x1dd9a6(0x147)+'<div>'+_0x1dd9a6(0x129)+_0x1dd9a6(0x107)+'<div>'+'<h2>\x20'+_0x2d6c1e[0x0][_0x1dd9a6(0x131)]+_0x1dd9a6(0x188)+_0x1dd9a6(0x107)+_0x1dd9a6(0x107)+_0x1dd9a6(0x125)+_0x1dd9a6(0x17c)+_0x1dd9a6(0x102)+'\x20Order\x20Number\x20:\x20'+_0x3a2f14+'\x20'+_0x1dd9a6(0x179)+_0x1dd9a6(0x1a6)+_0x59deda+'\x20'+_0x1dd9a6(0xa7)+'</h5>'+_0x1dd9a6(0x107)+_0x1dd9a6(0x187)+_0x1dd9a6(0x171)+_0x1dd9a6(0xc8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1dd9a6(0x183)+_0x1dd9a6(0x11a)+_0x1dd9a6(0x100)+_0x1dd9a6(0x1a2)+'\x20'+_0x1514e9+'\x20'+'</tbody>'+_0x1dd9a6(0xbf)+'<div>'+_0x1dd9a6(0x104)+'<h5>'+_0x2d6c1e[0x0][_0x1dd9a6(0x131)]+_0x1dd9a6(0x165)+_0x1dd9a6(0x107)+'</div>'+_0x1dd9a6(0xb9)};_0x58e6de[_0x1dd9a6(0x181)](_0x5b7f8d,function(_0x233e4e,_0x2d861f){var _0x34eb6a=_0x1dd9a6;_0x233e4e?(console[_0x34eb6a(0x17a)](_0x233e4e),console[_0x34eb6a(0x17a)](_0x34eb6a(0xe5))):console[_0x34eb6a(0x17a)](_0x34eb6a(0xb0));}),_0x5f7892[_0x1dd9a6(0x1af)](_0x1dd9a6(0xe4),_0x1dd9a6(0x157)),_0xaf84aa['redirect'](_0x1dd9a6(0x1a1)+_0x59e567[_0x1dd9a6(0x1a5)]);}catch(_0x52516f){console['log'](_0x52516f);}}),router[a0_0x5d1488(0x177)]('/preview/:id',auth,async(_0x439bfd,_0x4afe2f)=>{var _0x53e64e=a0_0x5d1488;try{const {username:_0x32ac55,email:_0x280507,role:_0x1263af}=_0x439bfd[_0x53e64e(0x191)],_0x226194=_0x439bfd[_0x53e64e(0x191)],_0x3717cf=await profile['findOne']({'email':_0x226194['email']}),_0x5559e5=await master_shop[_0x53e64e(0xef)](),_0x5cae7a=_0x439bfd['params']['id'],_0x4d9059=await sales_finished[_0x53e64e(0x19b)](_0x5cae7a),_0x197c5e=await warehouse[_0x53e64e(0x127)]([{'$match':{'name':_0x4d9059[_0x53e64e(0x137)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x53e64e(0xfe),'name':{'$first':_0x53e64e(0xe2)},'product_stock':{'$first':_0x53e64e(0x18f)},'bay':{'$first':_0x53e64e(0xed)},'bin':{'$first':_0x53e64e(0xfc)},'type':{'$first':_0x53e64e(0xa8)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x53e64e(0x150)},'secondary_code':{'$first':_0x53e64e(0x16c)},'product_code':{'$first':_0x53e64e(0xce)},'storage':{'$first':_0x53e64e(0x15e)},'rack':{'$first':_0x53e64e(0x193)},'expiry_date':{'$first':_0x53e64e(0xc9)},'production_date':{'$first':_0x53e64e(0x133)},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':_0x53e64e(0xe0)},'room_data':{'$first':_0x53e64e(0xd0)}}}]),_0x24c885=await customer[_0x53e64e(0xef)]({});let _0x52cc15;if(_0x226194[_0x53e64e(0x15a)]==_0x53e64e(0x1ac)){const _0x3aceec=await staff[_0x53e64e(0x103)]({'email':_0x226194[_0x53e64e(0x14c)]});_0x52cc15=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x3aceec[_0x53e64e(0xfb)]}},{'$group':{'_id':_0x53e64e(0x195),'name':{'$first':_0x53e64e(0x195)}}}]);}else _0x52cc15=await warehouse[_0x53e64e(0x127)]([{'$match':{'status':_0x53e64e(0xba)}},{'$group':{'_id':_0x53e64e(0x195),'name':{'$first':'$name'}}}]);const _0x4cae86=await product['find']({});if(_0x5559e5[0x0][_0x53e64e(0x17e)]==_0x53e64e(0x14f)){var _0x3de53c=users[_0x53e64e(0xb3)];console['log'](_0x3de53c);}else{if(_0x5559e5[0x0]['language']=='Hindi')var _0x3de53c=users[_0x53e64e(0x117)];else{if(_0x5559e5[0x0][_0x53e64e(0x17e)]==_0x53e64e(0x1aa))var _0x3de53c=users[_0x53e64e(0x1aa)];else{if(_0x5559e5[0x0]['language']==_0x53e64e(0xc7))var _0x3de53c=users[_0x53e64e(0xc7)];else{if(_0x5559e5[0x0][_0x53e64e(0x17e)]==_0x53e64e(0xf2))var _0x3de53c=users[_0x53e64e(0xf2)];else{if(_0x5559e5[0x0][_0x53e64e(0x17e)]==_0x53e64e(0x17f))var _0x3de53c=users['Portuguese'];else{if(_0x5559e5[0x0]['language']=='Chinese')var _0x3de53c=users[_0x53e64e(0xb4)];else{if(_0x5559e5[0x0][_0x53e64e(0x17e)]==_0x53e64e(0x162))var _0x3de53c=users[_0x53e64e(0x170)];}}}}}}}_0x4afe2f[_0x53e64e(0x166)](_0x53e64e(0x134),{'success':_0x439bfd[_0x53e64e(0x1af)](_0x53e64e(0xe4)),'errors':_0x439bfd[_0x53e64e(0x1af)]('errors'),'role':_0x226194,'profile':_0x3717cf,'customer':_0x24c885,'warehouse':_0x52cc15,'product':_0x197c5e,'user':_0x4d9059,'master_shop':_0x5559e5,'unit':_0x4cae86,'language':_0x3de53c});}catch(_0x70bdfa){console['log'](_0x70bdfa);}}),router[a0_0x5d1488(0xa5)](a0_0x5d1488(0x1b0),auth,async(_0x35cd16,_0x33ab0f)=>{var _0xb81977=a0_0x5d1488;try{const _0x3a15aa=_0x35cd16[_0xb81977(0xdf)]['id'],{invoice:_0x3b7b95,warehouse_name:_0x102925,room:_0x1443c1}=_0x35cd16[_0xb81977(0xd5)],_0x53212c=await sales_finished[_0xb81977(0x103)]({'invoice':_0x3b7b95}),_0x458981=_0x53212c['sale_product'][_0xb81977(0x130)](async _0x51ead0=>{var _0xff8d77=_0xb81977,_0x5f5616=await warehouse[_0xff8d77(0x103)]({'name':_0x102925,'room':_0x51ead0[_0xff8d77(0x15d)],'warehouse_category':_0xff8d77(0x116)});const _0x46dd79=_0x5f5616[_0xff8d77(0x18e)]['map'](_0x388049=>{var _0x2c9010=_0xff8d77;_0x388049[_0x2c9010(0x98)]==_0x51ead0[_0x2c9010(0x98)]&&_0x388049[_0x2c9010(0xdd)]==_0x51ead0[_0x2c9010(0xdd)]&&_0x388049[_0x2c9010(0xb5)]==_0x51ead0[_0x2c9010(0xb5)]&&_0x388049[_0x2c9010(0xe9)]==_0x51ead0[_0x2c9010(0xe9)]&&_0x388049['batch_code']==_0x51ead0[_0x2c9010(0xc5)]&&_0x388049['invoice']==_0x51ead0[_0x2c9010(0x17b)]&&_0x388049[_0x2c9010(0x1a5)]==_0x51ead0[_0x2c9010(0x159)]&&(_0x388049[_0x2c9010(0x105)]>0x0&&(console[_0x2c9010(0x17a)](_0x388049[_0x2c9010(0x98)]+'\x20==\x20'+_0x51ead0['product_name']+_0x2c9010(0x169)+_0x388049['bay']+_0x2c9010(0xdb)+_0x51ead0[_0x2c9010(0xdd)]+'\x20&&\x20'+_0x388049[_0x2c9010(0xe9)]+'\x20==\x20'+_0x51ead0[_0x2c9010(0xe9)]+_0x2c9010(0x169)+_0x388049['expiry_date']+_0x2c9010(0xdb)+_0x51ead0[_0x2c9010(0xb5)]+'\x20&&\x20'+_0x388049[_0x2c9010(0xc5)]+_0x2c9010(0xdb)+_0x51ead0[_0x2c9010(0xc5)]+_0x2c9010(0x169)+_0x388049[_0x2c9010(0x17b)]+'\x20==\x20'+_0x51ead0[_0x2c9010(0x17b)]+'\x20&&\x20'+_0x388049[_0x2c9010(0x105)]+_0x2c9010(0xa1)+_0x51ead0[_0x2c9010(0x19a)]+_0x2c9010(0x173)+_0x51ead0[_0x2c9010(0x15d)]+'\x20&&\x20'+_0x388049[_0x2c9010(0x1a5)]+_0x2c9010(0xdb)+_0x51ead0['id_transaction_from']),_0x388049[_0x2c9010(0x105)]=Math['max'](0x0,Math[_0x2c9010(0x161)](_0x388049[_0x2c9010(0x105)])-Math[_0x2c9010(0x161)](_0x51ead0[_0x2c9010(0x19a)]))));});return _0x5f5616;});Promise[_0xb81977(0xe7)](_0x458981)[_0xb81977(0x19f)](async _0x27ef38=>{var _0x3085b2=_0xb81977;try{for(const _0x3f8285 of _0x27ef38){await _0x3f8285['save']();}_0x53212c[_0x3085b2(0x99)]=_0x3085b2(0x135);const _0x4fb9fe=await _0x53212c[_0x3085b2(0x14a)](),_0x3c674d=await master_shop['find'](),_0x15e9b8=await email_settings[_0x3085b2(0x103)](),_0x2e7f66=await supervisor_settings[_0x3085b2(0xef)]();var _0x465785=_0x53212c[_0x3085b2(0xbb)],_0x5ea3c8='',_0x477597;for(_0x477597 in _0x465785){var _0x2ab5d0='FG';_0x53212c[_0x3085b2(0x137)]==_0x3085b2(0x18d)&&(_0x2ab5d0='DG'),_0x5ea3c8+=_0x3085b2(0xc8)+_0x3085b2(0xd7)+_0x465785[_0x477597]['product_name']+'</td>'+_0x3085b2(0xd7)+_0x465785[_0x477597]['product_code']+_0x3085b2(0x106)+_0x3085b2(0xd7)+_0x465785[_0x477597][_0x3085b2(0x19a)]+_0x3085b2(0x106)+_0x3085b2(0xd7)+_0x465785[_0x477597][_0x3085b2(0x109)]+_0x3085b2(0x106)+_0x3085b2(0xd7)+_0x465785[_0x477597][_0x3085b2(0x164)]+_0x3085b2(0x106)+_0x3085b2(0xd7)+_0x53212c['warehouse_name']+_0x3085b2(0x106)+_0x3085b2(0xd7)+_0x465785[_0x477597][_0x3085b2(0x15d)]+_0x3085b2(0x106)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2ab5d0+_0x465785[_0x477597]['bay']+'</td>';}let _0x1e5a46=nodemailer[_0x3085b2(0xad)]({'host':_0x15e9b8[_0x3085b2(0x122)],'port':Number(_0x15e9b8[_0x3085b2(0x10a)]),'secure':![],'auth':{'user':_0x15e9b8[_0x3085b2(0x14c)],'pass':_0x15e9b8[_0x3085b2(0x1ae)]}}),_0x51ae90={'from':_0x15e9b8[_0x3085b2(0x14c)],'to':_0x2e7f66[0x0][_0x3085b2(0x18a)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x3085b2(0xa4),'path':__dirname+'/../public'+_0x3085b2(0x186)+_0x3c674d[0x0][_0x3085b2(0x12c)],'cid':_0x3085b2(0x9b)}],'html':_0x3085b2(0x174)+_0x3085b2(0x142)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3085b2(0x17c)+_0x3085b2(0x129)+_0x3085b2(0x107)+'<div>'+_0x3085b2(0x132)+_0x3c674d[0x0][_0x3085b2(0x131)]+_0x3085b2(0x188)+_0x3085b2(0x107)+_0x3085b2(0x107)+_0x3085b2(0x125)+_0x3085b2(0x17c)+_0x3085b2(0x102)+_0x3085b2(0x185)+_0x53212c[_0x3085b2(0x17b)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3085b2(0x1a6)+_0x53212c['date']+'\x20'+'</span>'+_0x3085b2(0x165)+'</div>'+_0x3085b2(0x187)+_0x3085b2(0x171)+_0x3085b2(0xc8)+_0x3085b2(0x16e)+_0x3085b2(0xa2)+_0x3085b2(0xf6)+_0x3085b2(0x113)+_0x3085b2(0x11c)+_0x3085b2(0x167)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3085b2(0x11a)+_0x3085b2(0x100)+_0x3085b2(0x1a2)+'\x20'+_0x5ea3c8+'\x20'+'</tbody>'+_0x3085b2(0xbf)+'<div>'+_0x3085b2(0x104)+'<h5>'+_0x3c674d[0x0][_0x3085b2(0x131)]+_0x3085b2(0x165)+_0x3085b2(0x107)+_0x3085b2(0x107)+_0x3085b2(0xb9)};_0x1e5a46['sendMail'](_0x51ae90,function(_0x131c91,_0x5a4d6e){var _0x499e85=_0x3085b2;_0x131c91?(console[_0x499e85(0x17a)](_0x131c91),console[_0x499e85(0x17a)](_0x499e85(0xe5))):console[_0x499e85(0x17a)](_0x499e85(0xb0));}),_0x35cd16[_0x3085b2(0x1af)](_0x3085b2(0xe4),_0x3085b2(0xe6)),_0x33ab0f[_0x3085b2(0xa3)]('/picking_list/pdf/'+_0x3a15aa);}catch(_0x3562e8){console[_0x3085b2(0xf0)](_0x3562e8),_0x33ab0f[_0x3085b2(0xfd)](0x1f4)[_0x3085b2(0x175)]({'error':_0x3085b2(0x197)});}})[_0xb81977(0x112)](_0x464185=>{var _0x55fa7b=_0xb81977;console[_0x55fa7b(0xf0)](_0x464185),_0x33ab0f[_0x55fa7b(0xfd)](0x1f4)[_0x55fa7b(0x175)]({'error':_0x55fa7b(0x17d)});});}catch(_0x730536){console[_0xb81977(0x17a)](_0x730536);}}),router[a0_0x5d1488(0x177)]('/view/:id',auth,async(_0x51e7ae,_0x536bf3)=>{var _0xdcb8de=a0_0x5d1488;try{const {username:_0x317ecf,email:_0x4efd61,role:_0x5ef2b7}=_0x51e7ae['user'],_0xc96d08=_0x51e7ae['user'],_0x2673b3=await profile[_0xdcb8de(0x103)]({'email':_0xc96d08[_0xdcb8de(0x14c)]}),_0x2289bf=await master_shop[_0xdcb8de(0xef)](),_0x4e0193=_0x51e7ae['params']['id'],_0x75a25c=await sales_finished['findById'](_0x4e0193);let _0x3b5e80=new Date(_0x75a25c['expiry_date']),_0xd22de=('0'+_0x3b5e80[_0xdcb8de(0xab)]())[_0xdcb8de(0xc0)](-0x2),_0x1ca59f=('0'+(_0x3b5e80[_0xdcb8de(0x139)]()+0x1))[_0xdcb8de(0xc0)](-0x2),_0x516d77=_0x3b5e80['getFullYear'](),_0x255c26=_0x516d77+'-'+_0x1ca59f+'-'+_0xd22de;var _0x139c36=[_0xdcb8de(0x16b),_0xdcb8de(0xcd)];const _0xbeeab3=await warehouse[_0xdcb8de(0x127)]([{'$match':{'name':_0x75a25c[_0xdcb8de(0x137)],'room':_0x75a25c['room']}},{'$unwind':_0xdcb8de(0x10c)},{'$group':{'_id':_0xdcb8de(0xfe),'name':{'$first':_0xdcb8de(0xe2)},'product_stock':{'$first':_0xdcb8de(0x18f)},'bay':{'$first':_0xdcb8de(0xed)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xdcb8de(0xa8)},'floorlevel':{'$first':_0xdcb8de(0x111)},'primary_code':{'$first':_0xdcb8de(0x150)},'secondary_code':{'$first':_0xdcb8de(0x16c)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xdcb8de(0x15e)},'rack':{'$first':'$product_details.rack'}}}]),_0x978d3d=await customer[_0xdcb8de(0xef)]({});let _0x384cdb;if(_0xc96d08[_0xdcb8de(0x15a)]==_0xdcb8de(0x1ac)){const _0xd2996=await staff[_0xdcb8de(0x103)]({'email':_0xc96d08[_0xdcb8de(0x14c)]});_0x384cdb=await warehouse[_0xdcb8de(0x127)]([{'$match':{'status':_0xdcb8de(0xba),'name':_0xd2996[_0xdcb8de(0xfb)]}},{'$group':{'_id':'$name','name':{'$first':_0xdcb8de(0x195)}}}]);}else _0x384cdb=await warehouse['aggregate']([{'$match':{'status':_0xdcb8de(0xba)}},{'$group':{'_id':'$name','name':{'$first':_0xdcb8de(0x195)}}}]);const _0x1cc345=await product[_0xdcb8de(0xef)]({});if(_0x2289bf[0x0][_0xdcb8de(0x17e)]==_0xdcb8de(0x14f)){var _0x583dda=users[_0xdcb8de(0xb3)];console[_0xdcb8de(0x17a)](_0x583dda);}else{if(_0x2289bf[0x0][_0xdcb8de(0x17e)]=='Hindi')var _0x583dda=users[_0xdcb8de(0x117)];else{if(_0x2289bf[0x0][_0xdcb8de(0x17e)]==_0xdcb8de(0x1aa))var _0x583dda=users[_0xdcb8de(0x1aa)];else{if(_0x2289bf[0x0][_0xdcb8de(0x17e)]==_0xdcb8de(0xc7))var _0x583dda=users[_0xdcb8de(0xc7)];else{if(_0x2289bf[0x0]['language']=='French')var _0x583dda=users[_0xdcb8de(0xf2)];else{if(_0x2289bf[0x0][_0xdcb8de(0x17e)]==_0xdcb8de(0x17f))var _0x583dda=users[_0xdcb8de(0xae)];else{if(_0x2289bf[0x0][_0xdcb8de(0x17e)]==_0xdcb8de(0xb4))var _0x583dda=users[_0xdcb8de(0xb4)];else{if(_0x2289bf[0x0][_0xdcb8de(0x17e)]==_0xdcb8de(0x162))var _0x583dda=users['Arabic'];}}}}}}}_0x536bf3['render'](_0xdcb8de(0x189),{'success':_0x51e7ae[_0xdcb8de(0x1af)](_0xdcb8de(0xe4)),'errors':_0x51e7ae[_0xdcb8de(0x1af)](_0xdcb8de(0x9e)),'role':_0xc96d08,'profile':_0x2673b3,'customer':_0x978d3d,'warehouse':_0x384cdb,'product':_0xbeeab3,'user':_0x75a25c,'master_shop':_0x2289bf,'unit':_0x1cc345,'language':_0x583dda,'rooms_data':_0x139c36,'ed_fullDate':_0x255c26});}catch(_0x737eef){console['log'](_0x737eef);}}),router['post'](a0_0x5d1488(0x10f),auth,async(_0x5b1fba,_0x5451c5)=>{var _0x1dda5c=a0_0x5d1488;try{const _0x353d20=_0x5b1fba[_0x1dda5c(0xdf)]['id'],_0x222fee=await sales_finished[_0x1dda5c(0x103)]({'_id':_0x5b1fba[_0x1dda5c(0xdf)]['id']}),_0xc56ba9=await warehouse[_0x1dda5c(0x103)]({'name':_0x222fee[_0x1dda5c(0x137)],'room':_0x5b1fba[_0x1dda5c(0xd5)][_0x1dda5c(0x141)],'warehouse_category':_0x1dda5c(0x116)}),{invoice:_0x3da1ec,customer:_0x10b296,date:_0x2c7e7c,warehouse_name:_0x1ea2e0,product_name:_0x598419,stock:_0x306242,adjust_qty:_0x5a8ae3,note:_0x4954b5,room:_0x5004d9,primary_code:_0x1393a9,secondary_code:_0x22909a,prod_code:_0x3e4a73,level:_0x211cf0,isle:_0x1255e4,pallet:_0x273580,expiry_date:_0x32ca0d}=_0x5b1fba[_0x1dda5c(0xd5)];if(typeof _0x598419==_0x1dda5c(0x143))var _0x26ffbf=[_0x5b1fba[_0x1dda5c(0xd5)][_0x1dda5c(0x98)]],_0x5d3f69=[_0x5b1fba[_0x1dda5c(0xd5)]['stock']],_0x5f29d6=[_0x5b1fba[_0x1dda5c(0xd5)][_0x1dda5c(0xec)]],_0x17f300=[_0x5b1fba[_0x1dda5c(0xd5)]['primary_code']],_0x2e3320=[_0x5b1fba[_0x1dda5c(0xd5)]['secondary_code']],_0x3afcfb=[_0x5b1fba['body'][_0x1dda5c(0x178)]],_0x57baae=[_0x5b1fba[_0x1dda5c(0xd5)][_0x1dda5c(0x152)]],_0x2c5d24=[_0x5b1fba[_0x1dda5c(0xd5)]['expiry_date']];else var _0x26ffbf=[..._0x5b1fba[_0x1dda5c(0xd5)][_0x1dda5c(0x98)]],_0x5d3f69=[..._0x5b1fba[_0x1dda5c(0xd5)][_0x1dda5c(0xca)]],_0x5f29d6=[..._0x5b1fba['body'][_0x1dda5c(0xec)]],_0x17f300=[..._0x5b1fba[_0x1dda5c(0xd5)][_0x1dda5c(0xeb)]],_0x2e3320=[..._0x5b1fba['body'][_0x1dda5c(0x182)]],_0x3afcfb=[..._0x5b1fba[_0x1dda5c(0xd5)][_0x1dda5c(0x178)]],_0x57baae=[..._0x5b1fba[_0x1dda5c(0xd5)][_0x1dda5c(0x152)]],_0x2c5d24=[..._0x5b1fba['body']['expiry_date']];const _0x1aeaf7=_0x26ffbf[_0x1dda5c(0x130)](_0x21b3c1=>{return _0x21b3c1={'product_name':_0x21b3c1};});_0x5d3f69[_0x1dda5c(0x1a8)]((_0x3b5e5f,_0x4d46d8)=>{var _0x308c12=_0x1dda5c;_0x1aeaf7[_0x4d46d8][_0x308c12(0xca)]=_0x3b5e5f;}),_0x5f29d6[_0x1dda5c(0x1a8)]((_0x26d22f,_0xc62961)=>{_0x1aeaf7[_0xc62961]['quantity']=_0x26d22f;}),_0x17f300['forEach']((_0x154df7,_0x157c9e)=>{_0x1aeaf7[_0x157c9e]['primary_code']=_0x154df7;}),_0x2e3320[_0x1dda5c(0x1a8)]((_0xf2559b,_0x562592)=>{var _0x55ef58=_0x1dda5c;_0x1aeaf7[_0x562592][_0x55ef58(0x182)]=_0xf2559b;}),_0x3afcfb['forEach']((_0x5dda1e,_0x145439)=>{var _0x47b2b5=_0x1dda5c;_0x1aeaf7[_0x145439][_0x47b2b5(0x146)]=_0x5dda1e;}),_0x57baae[_0x1dda5c(0x1a8)]((_0xd672a0,_0x327536)=>{var _0x2b6e15=_0x1dda5c;_0x1aeaf7[_0x327536][_0x2b6e15(0x152)]=_0xd672a0;}),_0x2c5d24['forEach']((_0x2a0c5f,_0x316062)=>{var _0x3d8076=_0x1dda5c;_0x1aeaf7[_0x316062][_0x3d8076(0xb5)]=_0x2a0c5f;});var _0x1c1a56=0x0;_0x1aeaf7['forEach'](_0xdba296=>{var _0x47e8b1=_0x1dda5c;console[_0x47e8b1(0x17a)](_0x47e8b1(0xf8),_0xdba296),(parseInt(_0xdba296[_0x47e8b1(0xca)])<parseInt(_0xdba296[_0x47e8b1(0x19a)])||parseInt(_0xdba296[_0x47e8b1(0x19a)])==0x0)&&_0x1c1a56++;});if(_0x1c1a56!=0x0)return _0x5b1fba[_0x1dda5c(0x1af)]('errors',_0x1dda5c(0x11e)),_0x5451c5[_0x1dda5c(0xa3)](_0x1dda5c(0x18b));_0x222fee[_0x1dda5c(0xbb)][_0x1dda5c(0x1a8)](_0x49e600=>{var _0x3a6847=_0x1dda5c;const _0x526b02=_0xc56ba9[_0x3a6847(0x18e)][_0x3a6847(0x130)](_0x3fa674=>{var _0x39b3d7=_0x3a6847;_0x3fa674[_0x39b3d7(0x98)]==_0x49e600['product_name']&&_0x3fa674['bay']==_0x49e600[_0x39b3d7(0xdd)]&&(_0x3fa674['product_stock']=parseInt(_0x3fa674[_0x39b3d7(0x105)])+parseInt(_0x49e600[_0x39b3d7(0x19a)]));});}),await _0xc56ba9[_0x1dda5c(0x14a)]();const _0x1d5682=_0x1aeaf7[_0x1dda5c(0x1b1)](_0x31b7c3=>_0x31b7c3['quantity']!=='0'&&_0x31b7c3[_0x1dda5c(0x19a)]!=='');_0x222fee[_0x1dda5c(0x17b)]=_0x3da1ec,_0x222fee[_0x1dda5c(0x101)]=_0x10b296,_0x222fee[_0x1dda5c(0x14b)]=_0x2c7e7c,_0x222fee[_0x1dda5c(0x137)]=_0x1ea2e0,_0x222fee[_0x1dda5c(0xbb)]=_0x1d5682,_0x222fee['note']=_0x4954b5,_0x222fee[_0x1dda5c(0x141)]=_0x5004d9;const _0x5c10a4=await _0x222fee[_0x1dda5c(0x14a)](),_0x20e5c8=await sales_finished[_0x1dda5c(0x103)]({'_id':_0x5b1fba['params']['id']}),_0x5dc204=await warehouse[_0x1dda5c(0x103)]({'name':_0x1ea2e0,'room':_0x5004d9,'warehouse_category':_0x1dda5c(0x116)});_0x20e5c8[_0x1dda5c(0xbb)][_0x1dda5c(0x1a8)](_0x2cfe32=>{var _0x3e19b2=_0x1dda5c;const _0x4c48ee=_0x5dc204[_0x3e19b2(0x18e)]['map'](_0x5e71a9=>{var _0x62a00c=_0x3e19b2;_0x5e71a9['product_name']==_0x2cfe32[_0x62a00c(0x98)]&&_0x5e71a9[_0x62a00c(0xdd)]==_0x2cfe32['bay']&&(_0x5e71a9[_0x62a00c(0x105)]=parseInt(_0x5e71a9[_0x62a00c(0x105)])-parseInt(_0x2cfe32['quantity']));});}),console[_0x1dda5c(0x17a)](_0x1dda5c(0x13c),_0x5dc204),await _0x5dc204['save']();const _0x53964d=await c_payment_data[_0x1dda5c(0x103)]({'invoice':_0x5b1fba['body'][_0x1dda5c(0x17b)]});_0x53964d['suppliers']=_0x5b1fba['body']['suppliers'],await _0x53964d['save'](),_0x5b1fba[_0x1dda5c(0x1af)](_0x1dda5c(0xe4),_0x1dda5c(0xe6)),_0x5451c5[_0x1dda5c(0xa3)](_0x1dda5c(0x163));}catch(_0x1fa628){console['log'](_0x1fa628);}}),router[a0_0x5d1488(0xa5)]('/give_payment/:id',auth,async(_0x51c2a3,_0x7088f0)=>{var _0x3251f7=a0_0x5d1488;try{const _0x27c93c=_0x51c2a3['params']['id'],{invoice:_0x426205,customer:_0x2c46c3,receivable_amount:_0x1d2393,received_amount:_0x204b11}=_0x51c2a3[_0x3251f7(0xd5)],_0x53d38b=await sales[_0x3251f7(0x19b)](_0x27c93c);console[_0x3251f7(0x17a)](_0x53d38b);var _0x1bb00c=_0x1d2393-_0x204b11;console[_0x3251f7(0x17a)](_0x204b11),_0x53d38b[_0x3251f7(0x12f)]=parseFloat(_0x204b11)+parseFloat(_0x53d38b[_0x3251f7(0x12f)]),_0x53d38b['due_amount']=_0x1bb00c,console[_0x3251f7(0x17a)](_0x53d38b);const _0x4f5394=await _0x53d38b[_0x3251f7(0x14a)](),_0x44daa6=await c_payment_data[_0x3251f7(0x103)]({'invoice':_0x426205});_0x44daa6['amount']=_0x1bb00c,await _0x44daa6[_0x3251f7(0x14a)]();let _0x11216d=new Date(),_0x1f163d=('0'+_0x11216d[_0x3251f7(0xab)]())[_0x3251f7(0xc0)](-0x2),_0x48cbf1=('0'+(_0x11216d[_0x3251f7(0x139)]()+0x1))[_0x3251f7(0xc0)](-0x2),_0x56b07b=_0x11216d[_0x3251f7(0xbd)](),_0x2d962b=_0x56b07b+'-'+_0x48cbf1+'-'+_0x1f163d;const _0x487616=new customer_payment({'invoice':_0x426205,'date':_0x56b07b+'-'+_0x48cbf1+'-'+_0x1f163d,'customer':_0x2c46c3,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x204b11}),_0x2488e4=await _0x487616[_0x3251f7(0x14a)]();_0x51c2a3[_0x3251f7(0x1af)](_0x3251f7(0xe4),_0x3251f7(0x140)),_0x7088f0[_0x3251f7(0xa3)](_0x3251f7(0x13b));}catch(_0x14813e){console[_0x3251f7(0x17a)](_0x14813e);}}),router[a0_0x5d1488(0x177)](a0_0x5d1488(0x156),auth,async(_0x63b7b1,_0x243241)=>{var _0x1d1e7f=a0_0x5d1488;try{const {username:_0x55210c,email:_0x1079c8,role:_0x438199}=_0x63b7b1[_0x1d1e7f(0x191)],_0x28a703=_0x63b7b1['user'],_0x351e91=await profile[_0x1d1e7f(0x103)]({'email':_0x28a703[_0x1d1e7f(0x14c)]}),_0x491324=await master_shop[_0x1d1e7f(0xef)]();console[_0x1d1e7f(0x17a)](_0x1d1e7f(0x184),_0x491324);const _0x5e3db5=_0x63b7b1[_0x1d1e7f(0xdf)]['id'],_0x39b941=await sales[_0x1d1e7f(0x19b)](_0x5e3db5);console[_0x1d1e7f(0x17a)](_0x39b941);const _0x4164ec=await customer['findOne']({'name':_0x39b941[_0x1d1e7f(0x101)]});console['log'](_0x4164ec);if(_0x491324[0x0][_0x1d1e7f(0x17e)]==_0x1d1e7f(0x14f)){var _0x3f73af=users['English'];console[_0x1d1e7f(0x17a)](_0x3f73af);}else{if(_0x491324[0x0][_0x1d1e7f(0x17e)]=='Hindi')var _0x3f73af=users[_0x1d1e7f(0x117)];else{if(_0x491324[0x0][_0x1d1e7f(0x17e)]==_0x1d1e7f(0x1aa))var _0x3f73af=users['German'];else{if(_0x491324[0x0][_0x1d1e7f(0x17e)]=='Spanish')var _0x3f73af=users[_0x1d1e7f(0xc7)];else{if(_0x491324[0x0][_0x1d1e7f(0x17e)]==_0x1d1e7f(0xf2))var _0x3f73af=users[_0x1d1e7f(0xf2)];else{if(_0x491324[0x0][_0x1d1e7f(0x17e)]=='Portuguese\x20(BR)')var _0x3f73af=users[_0x1d1e7f(0xae)];else{if(_0x491324[0x0][_0x1d1e7f(0x17e)]=='Chinese')var _0x3f73af=users[_0x1d1e7f(0xb4)];else{if(_0x491324[0x0][_0x1d1e7f(0x17e)]==_0x1d1e7f(0x162))var _0x3f73af=users[_0x1d1e7f(0x170)];}}}}}}}_0x243241[_0x1d1e7f(0x166)]('sales_invoice',{'success':_0x63b7b1[_0x1d1e7f(0x1af)](_0x1d1e7f(0xe4)),'errors':_0x63b7b1[_0x1d1e7f(0x1af)](_0x1d1e7f(0x9e)),'role':_0x28a703,'profile':_0x351e91,'master_shop':_0x491324,'customers':_0x4164ec,'sales':_0x39b941,'language':_0x3f73af});}catch(_0x45d030){console[_0x1d1e7f(0x17a)](_0x45d030);}}),router[a0_0x5d1488(0x177)](a0_0x5d1488(0xbe),auth,async(_0x5d1dfb,_0x252279)=>{var _0x2d6783=a0_0x5d1488;try{const {username:_0x1437cd,email:_0x12bc35,role:_0x4c594b}=_0x5d1dfb['user'],_0x55e8e6=_0x5d1dfb['user'],_0xd07e50=await profile[_0x2d6783(0x103)]({'email':_0x55e8e6[_0x2d6783(0x14c)]}),_0x1fe30d=await master_shop[_0x2d6783(0xef)](),_0x1d20e9=_0x5d1dfb[_0x2d6783(0xdf)]['id'],_0x1b7def=await sales_finished['findById'](_0x1d20e9),_0x4d1753=await warehouse[_0x2d6783(0x127)]([{'$match':{'name':_0x1b7def[_0x2d6783(0x137)]}},{'$unwind':_0x2d6783(0x10c)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2d6783(0x18f)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2d6783(0xfc)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2d6783(0x111)},'primary_code':{'$first':_0x2d6783(0x150)},'secondary_code':{'$first':_0x2d6783(0x16c)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2d6783(0x193)},'expiry_date':{'$first':_0x2d6783(0xc9)},'production_date':{'$first':_0x2d6783(0x133)},'unit':{'$first':_0x2d6783(0x199)},'secondary_unit':{'$first':_0x2d6783(0x1a0)},'maxProducts':{'$first':_0x2d6783(0x176)},'batch_code':{'$first':_0x2d6783(0xea)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'}}}]),_0x5cc2fc=await product['find']({}),_0x2708c8=await warehouse[_0x2d6783(0x127)]([{'$match':{'status':_0x2d6783(0xba),'warehouse_category':_0x2d6783(0x116),'name':{'$ne':_0x2d6783(0x138),'$ne':_0x2d6783(0xac)}}},{'$group':{'_id':_0x2d6783(0x195),'name':{'$first':_0x2d6783(0x195)}}},{'$sort':{'name':0x1}}]);var _0x3966cc=['Return\x20Rooms'];const _0x1e8130=await warehouse[_0x2d6783(0x127)]([{'$match':{'status':_0x2d6783(0xba),'name':_0x2d6783(0xac)}},{'$group':{'_id':_0x2d6783(0x195),'name':{'$first':_0x2d6783(0x195)}}},{'$sort':{'name':0x1}}]);if(_0x1fe30d[0x0][_0x2d6783(0x17e)]==_0x2d6783(0x14f)){var _0x369e15=users[_0x2d6783(0xb3)];console['log'](_0x369e15);}else{if(_0x1fe30d[0x0][_0x2d6783(0x17e)]==_0x2d6783(0x117))var _0x369e15=users[_0x2d6783(0x117)];else{if(_0x1fe30d[0x0][_0x2d6783(0x17e)]==_0x2d6783(0x1aa))var _0x369e15=users[_0x2d6783(0x1aa)];else{if(_0x1fe30d[0x0]['language']==_0x2d6783(0xc7))var _0x369e15=users[_0x2d6783(0xc7)];else{if(_0x1fe30d[0x0]['language']==_0x2d6783(0xf2))var _0x369e15=users[_0x2d6783(0xf2)];else{if(_0x1fe30d[0x0][_0x2d6783(0x17e)]==_0x2d6783(0x17f))var _0x369e15=users[_0x2d6783(0xae)];else{if(_0x1fe30d[0x0][_0x2d6783(0x17e)]==_0x2d6783(0xb4))var _0x369e15=users[_0x2d6783(0xb4)];else{if(_0x1fe30d[0x0][_0x2d6783(0x17e)]==_0x2d6783(0x162))var _0x369e15=users[_0x2d6783(0x170)];}}}}}}}_0x252279[_0x2d6783(0x166)](_0x2d6783(0x9c),{'success':_0x5d1dfb[_0x2d6783(0x1af)]('success'),'errors':_0x5d1dfb['flash'](_0x2d6783(0x9e)),'role':_0x55e8e6,'profile':_0xd07e50,'user':_0x1b7def,'stock':_0x4d1753,'master_shop':_0x1fe30d,'unit':_0x5cc2fc,'language':_0x369e15,'warehouses':_0x2708c8,'rooms':_0x3966cc,'warehouse_QA':_0x1e8130});}catch(_0x31b02a){console['log'](_0x31b02a),_0x252279['status'](0xc8)[_0x2d6783(0x175)]({'message':_0x31b02a[_0x2d6783(0xcf)]});}}),router[a0_0x5d1488(0xa5)](a0_0x5d1488(0xbe),auth,async(_0x306da3,_0x45c736)=>{var _0xb3e33a=a0_0x5d1488;if(_0x306da3['body'][_0xb3e33a(0x124)]=='QA')try{const {invoice:_0x388954,date:_0x761b48,warehouse_name:_0x4da30d,product_name:_0x1d27dc,primary_code:_0x2b29f4,secondary_code:_0x640f0d,product_code:_0x12dd1b,sales_quantity:_0x2ee2aa,stocks:_0x28370a,return_qty:_0x605eca,Room_name:_0x1b8dbc,to_warehouse_name_QA:_0x3ff6a9,to_Room_name_QA:_0x37759a,note:_0xbb2db3,for_categorize:_0x292168,product_name_QA1:_0x3ad5a6}=_0x306da3[_0xb3e33a(0xd5)];if(typeof _0x3ad5a6==_0xb3e33a(0x143))var _0x5d0438=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xc6)]],_0x1076d5=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x198)]],_0x212ee3=[_0x306da3['body']['secondary_code_QA']],_0x1aa660=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x154)]],_0x2db653=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x151)]],_0x3bf36b=[_0x306da3['body']['stocks_QA']],_0x1943ea=[_0x306da3['body']['return_qty_QA']],_0x2a7ac5=[_0x306da3[_0xb3e33a(0xd5)]['maxPerUnit_QA']],_0x591e48=[_0x306da3[_0xb3e33a(0xd5)]['maxProducts_QA']],_0x3776c9=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x11d)]],_0xc44080=[_0x306da3[_0xb3e33a(0xd5)]['secondary_unit_QA']],_0x592d22=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x126)]],_0x2863ec=[_0x306da3['body'][_0xb3e33a(0xb7)]],_0x5e0001=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x1a9)]];else var _0x5d0438=[..._0x306da3['body']['product_name_QA1']],_0x1076d5=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x198)]],_0x212ee3=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x115)]],_0x1aa660=[..._0x306da3['body'][_0xb3e33a(0x154)]],_0x2db653=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x151)]],_0x3bf36b=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xb1)]],_0x1943ea=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xc1)]],_0x2a7ac5=[..._0x306da3['body']['maxPerUnit_QA']],_0x591e48=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x172)]],_0x3776c9=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x11d)]],_0xc44080=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x128)]],_0x592d22=[..._0x306da3[_0xb3e33a(0xd5)]['unit_QA']],_0x2863ec=[..._0x306da3[_0xb3e33a(0xd5)]['production_date_QA']],_0x5e0001=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x1a9)]];const _0x541535=_0x5d0438[_0xb3e33a(0x130)](_0x59f61b=>{return _0x59f61b={'product_name':_0x59f61b};});_0x1076d5['forEach']((_0x19ad6d,_0x1667aa)=>{var _0x39e56c=_0xb3e33a;_0x541535[_0x1667aa][_0x39e56c(0xeb)]=_0x19ad6d;}),_0x212ee3[_0xb3e33a(0x1a8)]((_0x54f098,_0x5cda1c)=>{var _0x330903=_0xb3e33a;_0x541535[_0x5cda1c][_0x330903(0x182)]=_0x54f098;}),_0x1aa660[_0xb3e33a(0x1a8)]((_0x5a5c60,_0x2aaac3)=>{var _0x552738=_0xb3e33a;_0x541535[_0x2aaac3][_0x552738(0x146)]=_0x5a5c60;}),_0x2db653['forEach']((_0x3904c2,_0x954ed8)=>{var _0x794035=_0xb3e33a;_0x541535[_0x954ed8][_0x794035(0x1a4)]=_0x3904c2;}),_0x3bf36b[_0xb3e33a(0x1a8)]((_0x3aedba,_0x248737)=>{_0x541535[_0x248737]['stock']=_0x3aedba;}),_0x1943ea[_0xb3e33a(0x1a8)]((_0x52dc51,_0x24eb01)=>{var _0x51005d=_0xb3e33a;_0x541535[_0x24eb01][_0x51005d(0xc4)]=_0x52dc51;}),_0x2a7ac5['forEach']((_0x4279bb,_0x2eebb6)=>{var _0x41fc4f=_0xb3e33a;_0x541535[_0x2eebb6][_0x41fc4f(0xfa)]=_0x4279bb;}),_0x591e48['forEach']((_0x325e1f,_0xf37671)=>{var _0x9c38ce=_0xb3e33a;_0x541535[_0xf37671][_0x9c38ce(0x1a3)]=_0x325e1f;}),_0x3776c9['forEach']((_0x4c8cbf,_0x4ddbd1)=>{var _0xdcd8ef=_0xb3e33a;_0x541535[_0x4ddbd1][_0xdcd8ef(0xc5)]=_0x4c8cbf;}),_0xc44080[_0xb3e33a(0x1a8)]((_0x404959,_0x9306f7)=>{var _0x4859c7=_0xb3e33a;_0x541535[_0x9306f7][_0x4859c7(0x164)]=_0x404959;}),_0x592d22['forEach']((_0x510b95,_0x2efbef)=>{var _0x5246b0=_0xb3e33a;_0x541535[_0x2efbef][_0x5246b0(0x109)]=_0x510b95;}),_0x2863ec[_0xb3e33a(0x1a8)]((_0x20ae3a,_0x103c97)=>{var _0x33a342=_0xb3e33a;_0x541535[_0x103c97][_0x33a342(0xe9)]=_0x20ae3a;}),_0x5e0001[_0xb3e33a(0x1a8)]((_0x4dd46e,_0x2830a9)=>{var _0x63322e=_0xb3e33a;_0x541535[_0x2830a9][_0x63322e(0xb5)]=_0x4dd46e;});const _0xe73c2=await sales_finished[_0xb3e33a(0x103)]({'invoice':_0x388954});_0xe73c2['return_data']=_0xb3e33a(0x135);const _0x2fd935=await _0xe73c2[_0xb3e33a(0x14a)](),_0x186d90=new sales_return_finished({'invoice':_0x388954,'customer':_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x101)],'date':_0x761b48,'warehouse_name':_0x4da30d,'room':_0x1b8dbc,'ToWarehouse':_0x3ff6a9,'ToRoom':_0x37759a,'return_sale_QA':_0x541535,'note':_0xbb2db3,'warehouse_cat':_0x292168}),_0x451fcf=await _0x186d90[_0xb3e33a(0x14a)](),_0x2416c2=await sales_return_finished['findOne']({'invoice':_0x388954}),_0xb68f5a=await warehouse['findOne']({'name':_0x3ff6a9,'room':_0x37759a});_0x2416c2[_0xb3e33a(0x12b)][_0xb3e33a(0x1a8)](_0x64f8b3=>{var _0xa3c304=_0xb3e33a,_0x3c21b9=0x0;const _0x32cf48=_0xb68f5a[_0xa3c304(0x18e)][_0xa3c304(0x130)](_0x26f201=>{var _0x4e7458=_0xa3c304;_0x26f201[_0x4e7458(0x98)]==_0x64f8b3[_0x4e7458(0x98)]&&_0x26f201[_0x4e7458(0xb5)]==_0x64f8b3[_0x4e7458(0xb5)]&&_0x26f201[_0x4e7458(0xe9)]==_0x64f8b3[_0x4e7458(0xe9)]&&_0x26f201[_0x4e7458(0xc5)]==_0x64f8b3['batch_code']&&(_0x26f201[_0x4e7458(0x105)]=parseInt(_0x26f201[_0x4e7458(0x105)])+parseInt(_0x64f8b3[_0x4e7458(0xc4)]),_0x3c21b9++);});_0x3c21b9=='0'&&(_0xb68f5a['product_details']=_0xb68f5a[_0xa3c304(0x18e)][_0xa3c304(0xd1)]({'product_name':_0x64f8b3[_0xa3c304(0x98)],'product_stock':_0x64f8b3[_0xa3c304(0xc4)],'primary_code':_0x64f8b3['primary_code'],'secondary_code':_0x64f8b3[_0xa3c304(0x182)],'product_code':_0x64f8b3['product_code'],'batch_code':_0x64f8b3[_0xa3c304(0xc5)],'maxPerUnit':_0x64f8b3[_0xa3c304(0xfa)],'production_date':_0x64f8b3[_0xa3c304(0xe9)],'expiry_date':_0x64f8b3[_0xa3c304(0xb5)],'secondary_unit':_0x64f8b3[_0xa3c304(0x164)],'unit':_0x64f8b3[_0xa3c304(0x109)],'maxProducts':_0x64f8b3['maxProducts'],'bay':_0x64f8b3[_0xa3c304(0xdd)]}));}),await _0xb68f5a[_0xb3e33a(0x14a)]();const _0x4ad7fa=new c_payment_data({'invoice':_0x388954,'customer':_0x306da3[_0xb3e33a(0xd5)]['customer'],'reason':_0xb3e33a(0xa9)});await _0x4ad7fa['save']();const _0x2fa1a6=await master_shop['find'](),_0x41b6c9=await email_settings[_0xb3e33a(0x103)](),_0x794794=await customer[_0xb3e33a(0x103)]({'name':_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x101)]});_0x2fa1a6[0x0][_0xb3e33a(0x121)]==0x1?(right_currency=_0x2fa1a6[0x0][_0xb3e33a(0x160)],left_currency=''):(right_currency='',left_currency=_0x2fa1a6[0x0][_0xb3e33a(0x160)]);var _0x5c58e1=_0x5d0438,_0x140de8=_0x1943ea,_0x1072fb='',_0x6106a4;for(_0x6106a4 in _0x5c58e1){_0x1072fb+=_0xb3e33a(0xc8)+_0xb3e33a(0xd7)+_0x5c58e1[_0x6106a4]+_0xb3e33a(0x106)+_0xb3e33a(0xd7)+_0x140de8[_0x6106a4]+'</td>'+'</tr>';}console[_0xb3e33a(0x17a)](_0xb3e33a(0xe1),_0x1072fb);let _0x232080=nodemailer['createTransport']({'service':_0xb3e33a(0x19c),'auth':{'user':_0x41b6c9[_0xb3e33a(0x14c)],'pass':_0x41b6c9[_0xb3e33a(0x1ae)]}}),_0xa18692={'from':_0x41b6c9[_0xb3e33a(0x14c)],'to':_0x794794[_0xb3e33a(0x14c)],'subject':_0xb3e33a(0xe8),'attachments':[{'filename':_0xb3e33a(0xa4),'path':__dirname+_0xb3e33a(0x12a)+'/upload/'+_0x2fa1a6[0x0][_0xb3e33a(0x12c)],'cid':_0xb3e33a(0x9b)}],'html':'<!DOCTYPE\x20html>'+_0xb3e33a(0x142)+'</head><body>'+_0xb3e33a(0x17c)+_0xb3e33a(0x147)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0xb3e33a(0x17c)+_0xb3e33a(0x132)+_0x2fa1a6[0x0]['site_title']+_0xb3e33a(0x188)+_0xb3e33a(0x107)+'</div>'+_0xb3e33a(0x125)+_0xb3e33a(0x17c)+_0xb3e33a(0x102)+_0xb3e33a(0x185)+_0x388954+'\x20'+_0xb3e33a(0x179)+_0xb3e33a(0x1a6)+_0x761b48+'\x20'+_0xb3e33a(0xa7)+_0xb3e33a(0x165)+_0xb3e33a(0x107)+_0xb3e33a(0x187)+_0xb3e33a(0x171)+'<tr>'+_0xb3e33a(0x16e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0xb3e33a(0x192)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0xb3e33a(0x11a)+_0xb3e33a(0x100)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1072fb+'\x20'+'</tbody>'+_0xb3e33a(0xbf)+_0xb3e33a(0x17c)+'<strong>\x20Regards\x20</strong>'+_0xb3e33a(0x16f)+_0x2fa1a6[0x0][_0xb3e33a(0x131)]+_0xb3e33a(0x165)+_0xb3e33a(0x107)+_0xb3e33a(0x107)+_0xb3e33a(0xb9)};_0x232080[_0xb3e33a(0x181)](_0xa18692,function(_0x1b747f,_0x1d5ef7){var _0xe9b56d=_0xb3e33a;_0x1b747f?(console[_0xe9b56d(0x17a)](_0x1b747f),console[_0xe9b56d(0x17a)]('Error\x20Occurs')):console[_0xe9b56d(0x17a)](_0xe9b56d(0xb0));}),_0x306da3['flash'](_0xb3e33a(0xe4),_0xb3e33a(0x9a)),_0x45c736[_0xb3e33a(0xa3)](_0xb3e33a(0x163));}catch(_0x1c0115){_0x45c736[_0xb3e33a(0xfd)](0xc8)[_0xb3e33a(0x175)]({'message1':_0x1c0115[_0xb3e33a(0xcf)]});}else{if(_0x306da3['body'][_0xb3e33a(0x124)]=='GS')try{const {invoice:_0x59d018,date:_0x3b1b85,warehouse_name:_0x108709,product_name:_0x1927ae,primary_code:_0x532154,secondary_code:_0x222818,product_code:_0x177209,sales_quantity:_0x275570,stocks:_0x1f0172,return_qty:_0x2af3ed,Room_name:_0xcc199b,to_warehouse_name:_0x5499b6,to_Room_name:_0x145599,note:_0x34936e,level:_0x2c366a,isle:_0x21b73a,pallet:_0x3cce13,for_categorize:_0x385c84}=_0x306da3['body'];if(typeof _0x1927ae=='string')var _0x5d0438=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x98)]],_0x1076d5=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xeb)]],_0x212ee3=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x182)]],_0x1aa660=[_0x306da3['body'][_0xb3e33a(0x146)]],_0x2db653=[_0x306da3['body'][_0xb3e33a(0x118)]],_0x1943ea=[_0x306da3[_0xb3e33a(0xd5)]['return_qty']],_0x479ff9=[_0x306da3[_0xb3e33a(0xd5)]['bay']],_0x2a7ac5=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xfa)]],_0x591e48=[_0x306da3['body']['maxProducts']],_0x3776c9=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xc5)]],_0xc44080=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x164)]],_0x592d22=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x109)]],_0x2863ec=[_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xe9)]],_0x5e0001=[_0x306da3[_0xb3e33a(0xd5)]['expiry_date']];else var _0x5d0438=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x98)]],_0x1076d5=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xeb)]],_0x212ee3=[..._0x306da3['body'][_0xb3e33a(0x182)]],_0x1aa660=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x146)]],_0x2db653=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x118)]],_0x1943ea=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xc4)]],_0x479ff9=[..._0x306da3['body']['bay']],_0x2a7ac5=[..._0x306da3['body'][_0xb3e33a(0xfa)]],_0x591e48=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x1a3)]],_0x3776c9=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xc5)]],_0xc44080=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x164)]],_0x592d22=[..._0x306da3[_0xb3e33a(0xd5)]['unit']],_0x2863ec=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xe9)]],_0x5e0001=[..._0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0xb5)]];const _0x313fe6=_0x5d0438[_0xb3e33a(0x130)](_0x34bb8c=>{return _0x34bb8c={'product_name':_0x34bb8c};});_0x1076d5[_0xb3e33a(0x1a8)]((_0x380aff,_0x4cbbf3)=>{var _0x22d5fd=_0xb3e33a;_0x313fe6[_0x4cbbf3][_0x22d5fd(0xeb)]=_0x380aff;}),_0x212ee3[_0xb3e33a(0x1a8)]((_0x5c4631,_0x39b8b9)=>{var _0x2b8940=_0xb3e33a;_0x313fe6[_0x39b8b9][_0x2b8940(0x182)]=_0x5c4631;}),_0x1aa660[_0xb3e33a(0x1a8)]((_0x4442b2,_0x37378a)=>{var _0x496c69=_0xb3e33a;_0x313fe6[_0x37378a][_0x496c69(0x146)]=_0x4442b2;}),_0x2db653[_0xb3e33a(0x1a8)]((_0x37832e,_0x38ca93)=>{var _0x2550ef=_0xb3e33a;_0x313fe6[_0x38ca93][_0x2550ef(0x1a4)]=_0x37832e;}),_0x1943ea[_0xb3e33a(0x1a8)]((_0x42c8a0,_0x39920d)=>{var _0x4b6afe=_0xb3e33a;_0x313fe6[_0x39920d][_0x4b6afe(0xc4)]=_0x42c8a0;}),_0x479ff9[_0xb3e33a(0x1a8)]((_0x1ef578,_0x48139f)=>{var _0x2780a5=_0xb3e33a;_0x313fe6[_0x48139f][_0x2780a5(0xdd)]=_0x1ef578;}),_0x2a7ac5[_0xb3e33a(0x1a8)]((_0x217ad9,_0x53ce63)=>{_0x313fe6[_0x53ce63]['maxPerUnit']=_0x217ad9;}),_0x591e48[_0xb3e33a(0x1a8)]((_0xc42f6b,_0x6ebfa2)=>{var _0x154619=_0xb3e33a;_0x313fe6[_0x6ebfa2][_0x154619(0x1a3)]=_0xc42f6b;}),_0x3776c9['forEach']((_0xc2485a,_0x49c98a)=>{_0x313fe6[_0x49c98a]['batch_code']=_0xc2485a;}),_0xc44080['forEach']((_0x5c75f4,_0x157797)=>{var _0x2fe20b=_0xb3e33a;_0x313fe6[_0x157797][_0x2fe20b(0x164)]=_0x5c75f4;}),_0x592d22[_0xb3e33a(0x1a8)]((_0x3c0d2b,_0x21076f)=>{var _0x35fa81=_0xb3e33a;_0x313fe6[_0x21076f][_0x35fa81(0x109)]=_0x3c0d2b;}),_0x2863ec[_0xb3e33a(0x1a8)]((_0x40171a,_0x4f189d)=>{_0x313fe6[_0x4f189d]['production_date']=_0x40171a;}),_0x5e0001['forEach']((_0x1d1d88,_0x3235bc)=>{var _0x47b562=_0xb3e33a;_0x313fe6[_0x3235bc][_0x47b562(0xb5)]=_0x1d1d88;});var _0x571ee0=0x0;_0x313fe6[_0xb3e33a(0x1a8)](_0x26b587=>{var _0x3016d3=_0xb3e33a;(parseInt(_0x26b587[_0x3016d3(0x1a4)])<parseInt(_0x26b587['return_qty'])||parseInt(_0x26b587['stock'])<parseInt(_0x26b587[_0x3016d3(0xc4)])&&parseInt(_0x26b587['sale_qty'])>parseInt(_0x26b587[_0x3016d3(0xc4)])||parseInt(_0x26b587[_0x3016d3(0xc4)])==0x0)&&_0x571ee0++;});if(_0x571ee0!=0x0)return _0x306da3[_0xb3e33a(0x1af)](_0xb3e33a(0x9e),_0xb3e33a(0xf7)),_0x45c736['redirect'](_0xb3e33a(0x18b));const _0xdbc95e=await sales_finished[_0xb3e33a(0x103)]({'invoice':_0x59d018});_0xdbc95e[_0xb3e33a(0xf1)]=_0xb3e33a(0x135);const _0x597769=await _0xdbc95e['save'](),_0x57b19f=new sales_return_finished({'invoice':_0x59d018,'customer':_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x101)],'date':_0x3b1b85,'warehouse_name':_0x108709,'room':_0xcc199b,'ToWarehouse':_0x5499b6,'ToRoom':_0x145599,'return_sale':_0x313fe6,'note':_0x34936e,'warehouse_cat':_0x385c84}),_0x4f7a97=await _0x57b19f[_0xb3e33a(0x14a)](),_0x296d38=await sales_return_finished[_0xb3e33a(0x103)]({'invoice':_0x59d018}),_0x5c66a4=await warehouse[_0xb3e33a(0x103)]({'name':_0x5499b6,'room':_0x145599,'warehouse_category':_0xb3e33a(0x116)});_0x296d38[_0xb3e33a(0x123)][_0xb3e33a(0x1a8)](_0x146612=>{var _0x4cc1a0=_0xb3e33a,_0x4682b8=0x0;const _0x16a7d2=_0x5c66a4[_0x4cc1a0(0x18e)]['map'](_0x48e868=>{var _0x3d1f6a=_0x4cc1a0;_0x48e868[_0x3d1f6a(0x98)]==_0x146612[_0x3d1f6a(0x98)]&&_0x48e868[_0x3d1f6a(0xdd)]==_0x146612[_0x3d1f6a(0xdd)]&&_0x48e868[_0x3d1f6a(0xb5)]==_0x146612[_0x3d1f6a(0xb5)]&&_0x48e868[_0x3d1f6a(0xe9)]==_0x146612[_0x3d1f6a(0xe9)]&&_0x48e868[_0x3d1f6a(0xc5)]==_0x146612['batch_code']&&(_0x48e868[_0x3d1f6a(0x105)]=parseInt(_0x48e868[_0x3d1f6a(0x105)])+parseInt(_0x146612['return_qty']),_0x4682b8++);});_0x4682b8=='0'&&(_0x5c66a4[_0x4cc1a0(0x18e)]=_0x5c66a4[_0x4cc1a0(0x18e)][_0x4cc1a0(0xd1)]({'product_name':_0x146612[_0x4cc1a0(0x98)],'product_stock':_0x146612['return_qty'],'primary_code':_0x146612[_0x4cc1a0(0xeb)],'secondary_code':_0x146612[_0x4cc1a0(0x182)],'product_code':_0x146612[_0x4cc1a0(0x146)],'bay':_0x146612[_0x4cc1a0(0xdd)],'batch_code':_0x146612[_0x4cc1a0(0xc5)],'maxPerUnit':_0x146612[_0x4cc1a0(0xfa)],'production_date':_0x146612[_0x4cc1a0(0xe9)],'expiry_date':_0x146612[_0x4cc1a0(0xb5)],'secondary_unit':_0x146612[_0x4cc1a0(0x164)],'unit':_0x146612[_0x4cc1a0(0x109)],'maxProducts':_0x146612[_0x4cc1a0(0x1a3)]}));}),await _0x5c66a4[_0xb3e33a(0x14a)](),console['log'](_0x306da3[_0xb3e33a(0xd5)]);const _0x4171ee=new c_payment_data({'invoice':_0x59d018,'customer':_0x306da3[_0xb3e33a(0xd5)][_0xb3e33a(0x101)],'reason':_0xb3e33a(0xa9)});await _0x4171ee[_0xb3e33a(0x14a)]();const _0x286106=await master_shop[_0xb3e33a(0xef)]();console[_0xb3e33a(0x17a)]('add\x20post',_0x286106[0x0][_0xb3e33a(0x12c)]);const _0x542419=await email_settings['findOne'](),_0x245239=await customer[_0xb3e33a(0x103)]({'name':_0x306da3['body'][_0xb3e33a(0x101)]});console['log'](_0xb3e33a(0xa6),_0x245239);_0x286106[0x0][_0xb3e33a(0x121)]==0x1?(right_currency=_0x286106[0x0][_0xb3e33a(0x160)],left_currency=''):(right_currency='',left_currency=_0x286106[0x0][_0xb3e33a(0x160)]);var _0x5c58e1=_0x5d0438,_0x140de8=_0x1943ea,_0x1072fb='',_0x6106a4;for(_0x6106a4 in _0x5c58e1){_0x1072fb+=_0xb3e33a(0xc8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c58e1[_0x6106a4]+_0xb3e33a(0x106)+_0xb3e33a(0xd7)+_0x140de8[_0x6106a4]+_0xb3e33a(0x106)+'</tr>';}console[_0xb3e33a(0x17a)](_0xb3e33a(0xe1),_0x1072fb);let _0x17e551=nodemailer[_0xb3e33a(0xad)]({'service':'gmail','auth':{'user':_0x542419[_0xb3e33a(0x14c)],'pass':_0x542419[_0xb3e33a(0x1ae)]}}),_0x3fe674={'from':_0x542419[_0xb3e33a(0x14c)],'to':_0x245239[_0xb3e33a(0x14c)],'subject':_0xb3e33a(0xe8),'attachments':[{'filename':_0xb3e33a(0xa4),'path':__dirname+_0xb3e33a(0x12a)+_0xb3e33a(0x186)+_0x286106[0x0][_0xb3e33a(0x12c)],'cid':'logo'}],'html':_0xb3e33a(0x174)+_0xb3e33a(0x142)+_0xb3e33a(0xc2)+'<div>'+_0xb3e33a(0x147)+_0xb3e33a(0x17c)+_0xb3e33a(0x129)+_0xb3e33a(0x107)+_0xb3e33a(0x17c)+_0xb3e33a(0x132)+_0x286106[0x0][_0xb3e33a(0x131)]+_0xb3e33a(0x188)+_0xb3e33a(0x107)+_0xb3e33a(0x107)+_0xb3e33a(0x125)+_0xb3e33a(0x17c)+_0xb3e33a(0x102)+_0xb3e33a(0x185)+_0x59d018+'\x20'+_0xb3e33a(0x179)+_0xb3e33a(0x1a6)+_0x3b1b85+'\x20'+_0xb3e33a(0xa7)+_0xb3e33a(0x165)+_0xb3e33a(0x107)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xb3e33a(0x171)+_0xb3e33a(0xc8)+_0xb3e33a(0x16e)+_0xb3e33a(0x14d)+_0xb3e33a(0x192)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0xb3e33a(0x11a)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1072fb+'\x20'+_0xb3e33a(0x114)+_0xb3e33a(0xbf)+_0xb3e33a(0x17c)+_0xb3e33a(0x104)+_0xb3e33a(0x16f)+_0x286106[0x0][_0xb3e33a(0x131)]+_0xb3e33a(0x165)+_0xb3e33a(0x107)+'</div>'+_0xb3e33a(0xb9)};_0x17e551[_0xb3e33a(0x181)](_0x3fe674,function(_0x34fdb8,_0x4dbd27){var _0x4f8ad4=_0xb3e33a;_0x34fdb8?(console['log'](_0x34fdb8),console[_0x4f8ad4(0x17a)](_0x4f8ad4(0xe5))):console[_0x4f8ad4(0x17a)](_0x4f8ad4(0xb0));}),_0x306da3[_0xb3e33a(0x1af)](_0xb3e33a(0xe4),_0xb3e33a(0x9a)),_0x45c736[_0xb3e33a(0xa3)]('/all_sales_finished/view');}catch(_0xb0cd8f){console[_0xb3e33a(0x17a)](_0xb0cd8f),_0x45c736[_0xb3e33a(0xfd)](0xc8)['json']({'message1':_0xb0cd8f[_0xb3e33a(0xcf)]});}}}),router['get'](a0_0x5d1488(0xd2),auth,async(_0x2999a2,_0x3dfa36)=>{var _0x4c260c=a0_0x5d1488;try{const {username:_0x1a4392,email:_0x50ee31,role:_0x3ab036}=_0x2999a2['user'],_0x5c24fd=_0x2999a2[_0x4c260c(0x191)],_0x125c54=await profile[_0x4c260c(0x103)]({'email':_0x5c24fd[_0x4c260c(0x14c)]}),_0x52c2ac=await master_shop[_0x4c260c(0xef)]();console[_0x4c260c(0x17a)]('barcode\x20Product\x20master',_0x52c2ac);const _0x203b13=_0x2999a2[_0x4c260c(0xdf)]['id'],_0x2ac5c3=await sales[_0x4c260c(0x19b)](_0x203b13);console['log']('barcode\x20user_id',_0x2ac5c3);if(_0x52c2ac[0x0]['language']=='English\x20(US)')var _0x1281ce=users[_0x4c260c(0xb3)];else{if(_0x52c2ac[0x0][_0x4c260c(0x17e)]==_0x4c260c(0x117))var _0x1281ce=users[_0x4c260c(0x117)];else{if(_0x52c2ac[0x0][_0x4c260c(0x17e)]==_0x4c260c(0x1aa))var _0x1281ce=users[_0x4c260c(0x1aa)];else{if(_0x52c2ac[0x0]['language']==_0x4c260c(0xc7))var _0x1281ce=users[_0x4c260c(0xc7)];else{if(_0x52c2ac[0x0][_0x4c260c(0x17e)]==_0x4c260c(0xf2))var _0x1281ce=users[_0x4c260c(0xf2)];else{if(_0x52c2ac[0x0][_0x4c260c(0x17e)]==_0x4c260c(0x17f))var _0x1281ce=users[_0x4c260c(0xae)];else{if(_0x52c2ac[0x0]['language']==_0x4c260c(0xb4))var _0x1281ce=users[_0x4c260c(0xb4)];else{if(_0x52c2ac[0x0][_0x4c260c(0x17e)]=='Arabic\x20(ae)')var _0x1281ce=users['Arabic'];}}}}}}}_0x3dfa36[_0x4c260c(0x166)](_0x4c260c(0xde),{'success':_0x2999a2['flash'](_0x4c260c(0xe4)),'errors':_0x2999a2['flash']('errors'),'role':_0x5c24fd,'profile':_0x125c54,'alldata':_0x2ac5c3,'master_shop':_0x52c2ac,'language':_0x1281ce});}catch(_0x20b75e){console[_0x4c260c(0x17a)](_0x20b75e);}}),router[a0_0x5d1488(0xa5)](a0_0x5d1488(0x148),async(_0x4060ad,_0x1fc6be)=>{var _0x51b866=a0_0x5d1488;const {product_code:_0x143bc3,warehouse_name:_0x5c71ac,rooms_data:_0x56a03d,Roomslist:_0x2c5ae7}=_0x4060ad['body'],_0x31be65=_0x2c5ae7[_0x51b866(0xb6)](','),_0x5a2c34=[];async function _0x5e954d(_0x5ea729){var _0x50f57f=_0x51b866;const _0x3fb036=await warehouse[_0x50f57f(0x127)]([{'$match':{'name':_0x5c71ac,'room':_0x5ea729}},{'$unwind':_0x50f57f(0x10c)},{'$match':{'product_details.primary_code':_0x143bc3}},{'$group':{'_id':_0x50f57f(0xfe),'name':{'$first':_0x50f57f(0xe2)},'product_stock':{'$first':_0x50f57f(0x18f)},'primary_code':{'$first':_0x50f57f(0x150)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x50f57f(0xce)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x50f57f(0xa8)},'pallet':{'$first':_0x50f57f(0x111)},'unit':{'$first':_0x50f57f(0x199)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x50f57f(0x15e)},'rack':{'$first':_0x50f57f(0x193)},'expiry_date':{'$first':_0x50f57f(0xc9)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x50f57f(0xa0)},'batch_code':{'$first':_0x50f57f(0xea)},'product_cat':{'$first':_0x50f57f(0x110)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x285464=await warehouse[_0x50f57f(0x127)]([{'$match':{'name':_0x5c71ac,'room':_0x5ea729}},{'$unwind':_0x50f57f(0x10c)},{'$match':{'product_details.secondary_code':_0x143bc3}},{'$group':{'_id':_0x50f57f(0xfe),'name':{'$first':_0x50f57f(0xe2)},'product_stock':{'$first':_0x50f57f(0x18f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x50f57f(0x16c)},'product_code':{'$first':_0x50f57f(0xce)},'level':{'$first':_0x50f57f(0xed)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x50f57f(0x111)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x50f57f(0x1a0)},'storage':{'$first':_0x50f57f(0x15e)},'rack':{'$first':_0x50f57f(0x193)},'expiry_date':{'$first':_0x50f57f(0xc9)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x50f57f(0xa0)},'batch_code':{'$first':_0x50f57f(0xea)},'product_cat':{'$first':_0x50f57f(0x110)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x50f57f(0xe0)},'invoice':{'$first':_0x50f57f(0x15b)}}}]);if(_0x3fb036[_0x50f57f(0xaa)]>0x0)_0x5a2c34[_0x50f57f(0x194)](_0x3fb036);else _0x285464[_0x50f57f(0xaa)]>0x0&&_0x5a2c34['push'](_0x285464);}const _0x299343=_0x31be65[_0x51b866(0x130)](_0x4b99ef=>_0x5e954d(_0x4b99ef));await Promise[_0x51b866(0xe7)](_0x299343),_0x1fc6be['json'](_0x5a2c34);}),module[a0_0x5d1488(0x1ab)]=router;