const a0_0x4ad503=a0_0x3af8;(function(_0x205584,_0x470eef){const _0x5541ce=a0_0x3af8,_0x44e68b=_0x205584();while(!![]){try{const _0xdf9de8=parseInt(_0x5541ce(0xa1))/0x1*(parseInt(_0x5541ce(0x8e))/0x2)+parseInt(_0x5541ce(0xc0))/0x3*(-parseInt(_0x5541ce(0x94))/0x4)+-parseInt(_0x5541ce(0xb7))/0x5*(-parseInt(_0x5541ce(0xb1))/0x6)+parseInt(_0x5541ce(0xa7))/0x7*(parseInt(_0x5541ce(0xba))/0x8)+parseInt(_0x5541ce(0x92))/0x9+-parseInt(_0x5541ce(0x90))/0xa+-parseInt(_0x5541ce(0x93))/0xb;if(_0xdf9de8===_0x470eef)break;else _0x44e68b['push'](_0x44e68b['shift']());}catch(_0x395d09){_0x44e68b['push'](_0x44e68b['shift']());}}}(a0_0x4334,0x659fc));function a0_0x3af8(_0x46627b,_0x6bf91c){const _0x43347c=a0_0x4334();return a0_0x3af8=function(_0x3af8c0,_0x28f867){_0x3af8c0=_0x3af8c0-0x87;let _0x50b932=_0x43347c[_0x3af8c0];return _0x50b932;},a0_0x3af8(_0x46627b,_0x6bf91c);}function a0_0x4334(){const _0x2aed78=['message','warehouses','$sale_product.quantity','$product.id_transaction_id','log','/warehouse_monitor','$to_warehouse','$sale_product.product_name','725323yRglut','$$invoice','$product.room_names','$product.product_name','status','$product_details','620753rBrWbK','success','$sale_product.room_name','all','$product.to_quantity','\x20documents\x20updated','../../models/all_models','table\x20page','data_transfer','valueOf','504738AzJGTz','$name','$room','$product.to_room_name','_id','errors','10qFQKWa','data_adjustment','render','8kjvovf','warehouse_data','$product','$product_details.invoice','length','invoice','123537ZNdQAM','$sale_product','data_sales','$warehouse_name','json','monitor','push','map','exports','/join','$product._id','/checking','Router','/negative','$sale_product.id_transaction_from','$product_details._id','$product.product_code','flash','2rRNnZe','aggregate','664770KbAWCF','modifiedCount','2497464AlbLgR','3111537JFlcYE','48SvPQXi','$invoice','$product_details.product_code','$sale_product.product_code','get'];a0_0x4334=function(){return _0x2aed78;};return a0_0x4334();}const express=require('express'),app=express(),router=express[a0_0x4ad503(0x88)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x4ad503(0xad));router[a0_0x4ad503(0x98)](a0_0x4ad503(0x89),async(_0x25a715,_0xe2e447)=>{const _0x4c4cdd=a0_0x4ad503;try{const _0x533e44=await warehouse['updateMany']({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0xe2e447[_0x4c4cdd(0xc4)]({'status':_0x533e44[_0x4c4cdd(0x91)]+_0x4c4cdd(0xac)});}catch(_0x7cf0e3){console[_0x4c4cdd(0x9d)](_0x4c4cdd(0xae),_0x7cf0e3),_0xe2e447[_0x4c4cdd(0xa5)](0xc8)['json']({'message':_0x7cf0e3['message']});}}),router[a0_0x4ad503(0x98)](a0_0x4ad503(0x87),async(_0x3bc6ef,_0x277121)=>{const _0x589002=a0_0x4ad503;try{const _0x3f0925=await warehouse[_0x589002(0x8f)]([{'$unwind':_0x589002(0xa6)},{'$match':{'product_details.invoice':'INCF-52068316','product_details.primary_code':'14800005047429'}},{'$group':{'_id':{'name':_0x589002(0xb2),'room':_0x589002(0xb3)},'products':{'$push':_0x589002(0xa6)}}}]);_0x277121[_0x589002(0xc4)](_0x3f0925);}catch(_0x3c55f2){console['log'](_0x589002(0xae),_0x3c55f2),_0x277121[_0x589002(0xa5)](0xc8)[_0x589002(0xc4)]({'message':_0x3c55f2[_0x589002(0x99)]});}}),router[a0_0x4ad503(0x98)](a0_0x4ad503(0x9e),async(_0x22fdf4,_0x293fe3)=>{const _0x273c01=a0_0x4ad503;_0x293fe3[_0x273c01(0xb9)](_0x273c01(0xc5),{'success':_0x22fdf4[_0x273c01(0x8d)](_0x273c01(0xa8)),'errors':_0x22fdf4[_0x273c01(0x8d)](_0x273c01(0xb6))});}),router['get'](a0_0x4ad503(0xc9),async(_0xfea80a,_0x540252)=>{const _0x4b8fd7=a0_0x4ad503;var _0x5c84f3=await purchases[_0x4b8fd7(0x8f)]([{'$lookup':{'from':_0x4b8fd7(0x9a),'let':{'invoice':_0x4b8fd7(0x95)},'pipeline':[{'$unwind':_0x4b8fd7(0xa6)},{'$match':{'$expr':{'$eq':[_0x4b8fd7(0xa2),_0x4b8fd7(0xbd)]}}},{'$project':{'_id':_0x4b8fd7(0x8b),'product_name':'$product_details.product_name','product_code':_0x4b8fd7(0x96),'quantity_available':'$product_details.product_stock','warehouse_name':'$name','warehouse_room':_0x4b8fd7(0xb3),'invoice':_0x4b8fd7(0xbd)}}],'as':'warehouse_data'}}]);_0x5c84f3[_0x4b8fd7(0xc2)]={},await Promise['all'](_0x5c84f3[_0x4b8fd7(0xc7)](async _0x3b982c=>{const _0x15b27a=_0x4b8fd7;_0x5c84f3[_0x15b27a(0xc2)][_0x3b982c[_0x15b27a(0xbf)]]=[],await Promise[_0x15b27a(0xaa)](_0x3b982c[_0x15b27a(0xbb)][_0x15b27a(0xc7)](async _0x980b2b=>{const _0x2b64c2=_0x15b27a,_0x53f451=await sales[_0x2b64c2(0x8f)]([{'$unwind':_0x2b64c2(0xc1)},{'$match':{'sale_product.id_transaction_from':_0x980b2b[_0x2b64c2(0xb5)]['valueOf'](),'sale_product.invoice':_0x980b2b[_0x2b64c2(0xbf)]}},{'$project':{'_id':'$sale_product._id','product_name':_0x2b64c2(0xa0),'product_code':_0x2b64c2(0x97),'quantity_available':_0x2b64c2(0x9b),'warehouse_name':_0x2b64c2(0xc3),'warehouse_room':_0x2b64c2(0xa9),'product_invoice':'$sale_product.invoice','invoice':'$invoice','id_transaction_from':_0x2b64c2(0x8a)}}]);_0x53f451[_0x2b64c2(0xbe)]>0x0&&_0x5c84f3[_0x2b64c2(0xc2)][_0x3b982c[_0x2b64c2(0xbf)]][_0x2b64c2(0xc6)](..._0x53f451);}));})),_0x5c84f3[_0x4b8fd7(0xc2)]=_0x5c84f3['data_sales'],_0x5c84f3[_0x4b8fd7(0xb8)]={},await Promise[_0x4b8fd7(0xaa)](_0x5c84f3['map'](async _0x1867c6=>{const _0x273fbe=_0x4b8fd7;_0x5c84f3['data_adjustment'][_0x1867c6[_0x273fbe(0xbf)]]=[],await Promise[_0x273fbe(0xaa)](_0x1867c6['warehouse_data'][_0x273fbe(0xc7)](async _0xd60dd5=>{const _0x4dc46f=_0x273fbe,_0x4d2e13=await adjustment['aggregate']([{'$unwind':_0x4dc46f(0xbc)},{'$match':{'product.id_transaction_from':_0xd60dd5[_0x4dc46f(0xb5)]['valueOf'](),'product.invoice':_0xd60dd5[_0x4dc46f(0xbf)]}},{'$project':{'_id':_0x4dc46f(0xca),'product_name':'$product.product_name','product_code':_0x4dc46f(0x8c),'quantity_available':'$product.new_adjust_qty','warehouse_name':_0x4dc46f(0xc3),'warehouse_room':_0x4dc46f(0xa3),'product_invoice':'$product.invoice','invoice':_0x4dc46f(0x95),'id_transaction_from':'$product.id_transaction_from'}}]);_0x4d2e13['length']>0x0&&_0x5c84f3['data_adjustment'][_0x1867c6[_0x4dc46f(0xbf)]][_0x4dc46f(0xc6)](..._0x4d2e13);}));})),_0x5c84f3[_0x4b8fd7(0xaf)]={},await Promise['all'](_0x5c84f3['map'](async _0x552f12=>{const _0x5641a9=_0x4b8fd7;_0x5c84f3['data_transfer'][_0x552f12['invoice']]=[],await Promise[_0x5641a9(0xaa)](_0x552f12[_0x5641a9(0xbb)][_0x5641a9(0xc7)](async _0x504493=>{const _0x432ea2=_0x5641a9,_0x96cdf9=await transfers[_0x432ea2(0x8f)]([{'$unwind':_0x432ea2(0xbc)},{'$match':{'product.id_transaction_id':_0x504493[_0x432ea2(0xb5)][_0x432ea2(0xb0)](),'product.To_invoice':_0x504493[_0x432ea2(0xbf)]}},{'$project':{'_id':_0x432ea2(0xca),'product_name':_0x432ea2(0xa4),'product_code':_0x432ea2(0x8c),'quantity_available':_0x432ea2(0xab),'warehouse_name':_0x432ea2(0x9f),'warehouse_room':'$product.room_names','product_invoice':_0x432ea2(0xb4),'invoice':'$invoice','id_transaction_id':_0x432ea2(0x9c)}}]);console[_0x432ea2(0x9d)](_0x96cdf9),_0x96cdf9[_0x432ea2(0xbe)]>0x0&&_0x5c84f3['data_transfer'][_0x552f12[_0x432ea2(0xbf)]][_0x432ea2(0xc6)](..._0x96cdf9);}));})),_0x540252[_0x4b8fd7(0xc4)]({'purchases_warehouse':_0x5c84f3,'data_sales':_0x5c84f3[_0x4b8fd7(0xc2)],'data_adjustment':_0x5c84f3['data_adjustment'],'data_transfer':_0x5c84f3['data_transfer']});}),module[a0_0x4ad503(0xc8)]=router;