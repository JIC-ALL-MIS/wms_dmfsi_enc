const a0_0x29a7ca=a0_0x5bbf;(function(_0x3e0c1d,_0x4b3ec0){const _0x2601ca=a0_0x5bbf,_0x350117=_0x3e0c1d();while(!![]){try{const _0x28a361=parseInt(_0x2601ca(0x160))/0x1+parseInt(_0x2601ca(0x12a))/0x2*(parseInt(_0x2601ca(0x149))/0x3)+-parseInt(_0x2601ca(0x13e))/0x4*(parseInt(_0x2601ca(0x154))/0x5)+parseInt(_0x2601ca(0x151))/0x6+parseInt(_0x2601ca(0x129))/0x7+-parseInt(_0x2601ca(0x143))/0x8*(parseInt(_0x2601ca(0x158))/0x9)+parseInt(_0x2601ca(0x134))/0xa*(-parseInt(_0x2601ca(0x141))/0xb);if(_0x28a361===_0x4b3ec0)break;else _0x350117['push'](_0x350117['shift']());}catch(_0x1dd874){_0x350117['push'](_0x350117['shift']());}}}(a0_0x37b4,0x746a8));function a0_0x5bbf(_0x17b39c,_0x7888bb){const _0x37b4a6=a0_0x37b4();return a0_0x5bbf=function(_0x5bbfcb,_0x552457){_0x5bbfcb=_0x5bbfcb-0x11e;let _0x1cc0d0=_0x37b4a6[_0x5bbfcb];return _0x1cc0d0;},a0_0x5bbf(_0x17b39c,_0x7888bb);}function a0_0x37b4(){const _0x404ed4=['table\x20page','modifiedCount','$name','all','3309640xPXQmZ','data_sales','$product_details.product_code','11BfasOR','status','4938200ZBjDAY','map','json','$product.product_code','$sale_product','length','1989573sbitTb','$product.id_transaction_from','$invoice','INCF-52068316','$room','$product','$product.room_names','$product._id','5094162CFSrOM','exports','$product.product_name','5QDmcrc','Router','$warehouse_name','push','9FqoeYY','$sale_product.id_transaction_from','$to_warehouse','$sale_product.invoice','data_transfer','$$invoice','warehouses','monitor','499565PcpzrI','/negative','render','$sale_product.product_name','valueOf','$product_details.product_name','$sale_product.product_code','message','$product.invoice','\x20documents\x20updated','success','14800005047429','$product.to_quantity','log','_id','3830960howigT','2naqAxj','$sale_product._id','aggregate','invoice','$product_details._id','get','/join','data_adjustment','$product_details','$sale_product.quantity','6375380pJlhqs','../../models/all_models','warehouse_data','$product_details.invoice','$product_details.product_stock','flash'];a0_0x37b4=function(){return _0x404ed4;};return a0_0x37b4();}const express=require('express'),app=express(),router=express[a0_0x29a7ca(0x155)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x29a7ca(0x135));router['get'](a0_0x29a7ca(0x161),async(_0x40f63e,_0x44b43b)=>{const _0x311492=a0_0x29a7ca;try{const _0x57be60=await warehouse['updateMany']({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x44b43b['json']({'status':_0x57be60[_0x311492(0x13b)]+_0x311492(0x123)});}catch(_0x2d8b7c){console[_0x311492(0x127)](_0x311492(0x13a),_0x2d8b7c),_0x44b43b[_0x311492(0x142)](0xc8)[_0x311492(0x145)]({'message':_0x2d8b7c['message']});}}),router[a0_0x29a7ca(0x12f)]('/checking',async(_0x1f3d8e,_0x26ca4d)=>{const _0x5bad79=a0_0x29a7ca;try{const _0x15a841=await warehouse[_0x5bad79(0x12c)]([{'$unwind':_0x5bad79(0x132)},{'$match':{'product_details.invoice':_0x5bad79(0x14c),'product_details.primary_code':_0x5bad79(0x125)}},{'$group':{'_id':{'name':_0x5bad79(0x13c),'room':'$room'},'products':{'$push':'$product_details'}}}]);_0x26ca4d['json'](_0x15a841);}catch(_0x485a26){console[_0x5bad79(0x127)](_0x5bad79(0x13a),_0x485a26),_0x26ca4d[_0x5bad79(0x142)](0xc8)[_0x5bad79(0x145)]({'message':_0x485a26[_0x5bad79(0x121)]});}}),router[a0_0x29a7ca(0x12f)]('/warehouse_monitor',async(_0x5ac28d,_0x3ef107)=>{const _0x3aa0d0=a0_0x29a7ca;_0x3ef107[_0x3aa0d0(0x162)](_0x3aa0d0(0x15f),{'success':_0x5ac28d[_0x3aa0d0(0x139)](_0x3aa0d0(0x124)),'errors':_0x5ac28d[_0x3aa0d0(0x139)]('errors')});}),router[a0_0x29a7ca(0x12f)](a0_0x29a7ca(0x130),async(_0x4d2d8b,_0x42013c)=>{const _0x48e350=a0_0x29a7ca;var _0x144d32=await purchases[_0x48e350(0x12c)]([{'$lookup':{'from':_0x48e350(0x15e),'let':{'invoice':_0x48e350(0x14b)},'pipeline':[{'$unwind':_0x48e350(0x132)},{'$match':{'$expr':{'$eq':[_0x48e350(0x15d),_0x48e350(0x137)]}}},{'$project':{'_id':_0x48e350(0x12e),'product_name':_0x48e350(0x11f),'product_code':_0x48e350(0x140),'quantity_available':_0x48e350(0x138),'warehouse_name':_0x48e350(0x13c),'warehouse_room':_0x48e350(0x14d),'invoice':_0x48e350(0x137)}}],'as':_0x48e350(0x136)}}]);_0x144d32[_0x48e350(0x13f)]={},await Promise[_0x48e350(0x13d)](_0x144d32[_0x48e350(0x144)](async _0x55090c=>{const _0x678869=_0x48e350;_0x144d32[_0x678869(0x13f)][_0x55090c[_0x678869(0x12d)]]=[],await Promise[_0x678869(0x13d)](_0x55090c[_0x678869(0x136)][_0x678869(0x144)](async _0xe6ae7c=>{const _0x2fad11=_0x678869,_0x201f3d=await sales[_0x2fad11(0x12c)]([{'$unwind':_0x2fad11(0x147)},{'$match':{'sale_product.id_transaction_from':_0xe6ae7c[_0x2fad11(0x128)][_0x2fad11(0x11e)](),'sale_product.invoice':_0xe6ae7c[_0x2fad11(0x12d)]}},{'$project':{'_id':_0x2fad11(0x12b),'product_name':_0x2fad11(0x163),'product_code':_0x2fad11(0x120),'quantity_available':_0x2fad11(0x133),'warehouse_name':_0x2fad11(0x156),'warehouse_room':'$sale_product.room_name','product_invoice':_0x2fad11(0x15b),'invoice':_0x2fad11(0x14b),'id_transaction_from':_0x2fad11(0x159)}}]);_0x201f3d[_0x2fad11(0x148)]>0x0&&_0x144d32[_0x2fad11(0x13f)][_0x55090c[_0x2fad11(0x12d)]][_0x2fad11(0x157)](..._0x201f3d);}));})),_0x144d32[_0x48e350(0x13f)]=_0x144d32[_0x48e350(0x13f)],_0x144d32[_0x48e350(0x131)]={},await Promise['all'](_0x144d32[_0x48e350(0x144)](async _0x417a20=>{const _0x80cf45=_0x48e350;_0x144d32[_0x80cf45(0x131)][_0x417a20[_0x80cf45(0x12d)]]=[],await Promise[_0x80cf45(0x13d)](_0x417a20['warehouse_data'][_0x80cf45(0x144)](async _0x490d63=>{const _0x2c7758=_0x80cf45,_0x150e0d=await adjustment[_0x2c7758(0x12c)]([{'$unwind':'$product'},{'$match':{'product.id_transaction_from':_0x490d63[_0x2c7758(0x128)][_0x2c7758(0x11e)](),'product.invoice':_0x490d63[_0x2c7758(0x12d)]}},{'$project':{'_id':_0x2c7758(0x150),'product_name':_0x2c7758(0x153),'product_code':_0x2c7758(0x146),'quantity_available':'$product.new_adjust_qty','warehouse_name':_0x2c7758(0x156),'warehouse_room':_0x2c7758(0x14f),'product_invoice':_0x2c7758(0x122),'invoice':_0x2c7758(0x14b),'id_transaction_from':_0x2c7758(0x14a)}}]);_0x150e0d['length']>0x0&&_0x144d32[_0x2c7758(0x131)][_0x417a20['invoice']][_0x2c7758(0x157)](..._0x150e0d);}));})),_0x144d32['data_transfer']={},await Promise[_0x48e350(0x13d)](_0x144d32[_0x48e350(0x144)](async _0x55b4bd=>{const _0x230e24=_0x48e350;_0x144d32[_0x230e24(0x15c)][_0x55b4bd[_0x230e24(0x12d)]]=[],await Promise[_0x230e24(0x13d)](_0x55b4bd[_0x230e24(0x136)][_0x230e24(0x144)](async _0x94eaa6=>{const _0x36ebce=_0x230e24,_0x3b0091=await transfers['aggregate']([{'$unwind':_0x36ebce(0x14e)},{'$match':{'product.id_transaction_id':_0x94eaa6[_0x36ebce(0x128)][_0x36ebce(0x11e)](),'product.To_invoice':_0x94eaa6[_0x36ebce(0x12d)]}},{'$project':{'_id':'$product._id','product_name':_0x36ebce(0x153),'product_code':'$product.product_code','quantity_available':_0x36ebce(0x126),'warehouse_name':_0x36ebce(0x15a),'warehouse_room':_0x36ebce(0x14f),'product_invoice':'$product.to_room_name','invoice':'$invoice','id_transaction_id':'$product.id_transaction_id'}}]);console[_0x36ebce(0x127)](_0x3b0091),_0x3b0091[_0x36ebce(0x148)]>0x0&&_0x144d32[_0x36ebce(0x15c)][_0x55b4bd['invoice']]['push'](..._0x3b0091);}));})),_0x42013c[_0x48e350(0x145)]({'purchases_warehouse':_0x144d32,'data_sales':_0x144d32[_0x48e350(0x13f)],'data_adjustment':_0x144d32[_0x48e350(0x131)],'data_transfer':_0x144d32[_0x48e350(0x15c)]});}),module[a0_0x29a7ca(0x152)]=router;