const a0_0x5f30a8=a0_0x510d;function a0_0x510d(_0xb740f,_0x224c52){const _0xc39204=a0_0xc392();return a0_0x510d=function(_0x510db5,_0x353b38){_0x510db5=_0x510db5-0x79;let _0x574d01=_0xc39204[_0x510db5];return _0x574d01;},a0_0x510d(_0xb740f,_0x224c52);}function a0_0xc392(){const _0x72960b=['Router','aggregate','log','$sale_product._id','warehouses','table\x20page','get','message','json','all','$sale_product.product_name','$product_details','14800005047429','$product._id','$product','57780JZHMdx','push','monitor','$product.id_transaction_id','1637685HNuHFI','exports','5mHjHHL','valueOf','9780540vletjX','/join','$sale_product.invoice','$sale_product.id_transaction_from','$warehouse_name','$product_details.invoice','$sale_product.room_name','$product_details._id','/checking','express','$product_details.product_stock','invoice','$product.product_name','$product.id_transaction_from','$product.new_adjust_qty','$product.room_names','data_transfer','render','status','4711292hxNgkr','INCF-52068316','\x20documents\x20updated','1700005YBFKRf','errors','159ROgFti','26356041csCTRD','$room','data_sales','$product.to_quantity','$product.to_room_name','$product.product_code','$invoice','../../models/all_models','length','11034736ubXPcP','warehouse_data','$name','flash','map','data_adjustment','updateMany','_id'];a0_0xc392=function(){return _0x72960b;};return a0_0xc392();}(function(_0x20a699,_0x1f7e29){const _0x59eb9b=a0_0x510d,_0x516ff0=_0x20a699();while(!![]){try{const _0x547804=parseInt(_0x59eb9b(0x79))/0x1+parseInt(_0x59eb9b(0x9c))/0x2*(parseInt(_0x59eb9b(0x7b))/0x3)+-parseInt(_0x59eb9b(0xb7))/0x4*(-parseInt(_0x59eb9b(0xa2))/0x5)+-parseInt(_0x59eb9b(0xa4))/0x6+-parseInt(_0x59eb9b(0xa0))/0x7+parseInt(_0x59eb9b(0x85))/0x8+-parseInt(_0x59eb9b(0x7c))/0x9;if(_0x547804===_0x1f7e29)break;else _0x516ff0['push'](_0x516ff0['shift']());}catch(_0x15a296){_0x516ff0['push'](_0x516ff0['shift']());}}}(a0_0xc392,0xf3206));const express=require(a0_0x5f30a8(0xad)),app=express(),router=express[a0_0x5f30a8(0x8d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x5f30a8(0x83));router['get']('/negative',async(_0x5ed56a,_0x592a89)=>{const _0x56b08c=a0_0x5f30a8;try{const _0x576b69=await warehouse[_0x56b08c(0x8b)]({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x592a89['json']({'status':_0x576b69['modifiedCount']+_0x56b08c(0xb9)});}catch(_0x1e06c8){console[_0x56b08c(0x8f)](_0x56b08c(0x92),_0x1e06c8),_0x592a89[_0x56b08c(0xb6)](0xc8)[_0x56b08c(0x95)]({'message':_0x1e06c8[_0x56b08c(0x94)]});}}),router['get'](a0_0x5f30a8(0xac),async(_0x58252c,_0x2bff3c)=>{const _0x5def39=a0_0x5f30a8;try{const _0x224b62=await warehouse['aggregate']([{'$unwind':_0x5def39(0x98)},{'$match':{'product_details.invoice':_0x5def39(0xb8),'product_details.primary_code':_0x5def39(0x99)}},{'$group':{'_id':{'name':_0x5def39(0x87),'room':_0x5def39(0x7d)},'products':{'$push':_0x5def39(0x98)}}}]);_0x2bff3c[_0x5def39(0x95)](_0x224b62);}catch(_0x4f80f4){console['log'](_0x5def39(0x92),_0x4f80f4),_0x2bff3c[_0x5def39(0xb6)](0xc8)['json']({'message':_0x4f80f4['message']});}}),router[a0_0x5f30a8(0x93)]('/warehouse_monitor',async(_0x2fe0f2,_0x405904)=>{const _0x81d1d4=a0_0x5f30a8;_0x405904[_0x81d1d4(0xb5)](_0x81d1d4(0x9e),{'success':_0x2fe0f2[_0x81d1d4(0x88)]('success'),'errors':_0x2fe0f2['flash'](_0x81d1d4(0x7a))});}),router[a0_0x5f30a8(0x93)](a0_0x5f30a8(0xa5),async(_0x215d4d,_0x1b07fd)=>{const _0x384341=a0_0x5f30a8;var _0x1b92b7=await purchases['aggregate']([{'$lookup':{'from':_0x384341(0x91),'let':{'invoice':_0x384341(0x82)},'pipeline':[{'$unwind':_0x384341(0x98)},{'$match':{'$expr':{'$eq':['$$invoice',_0x384341(0xa9)]}}},{'$project':{'_id':_0x384341(0xab),'product_name':'$product_details.product_name','product_code':'$product_details.product_code','quantity_available':_0x384341(0xae),'warehouse_name':_0x384341(0x87),'warehouse_room':_0x384341(0x7d),'invoice':_0x384341(0xa9)}}],'as':'warehouse_data'}}]);_0x1b92b7['data_sales']={},await Promise[_0x384341(0x96)](_0x1b92b7['map'](async _0x595161=>{const _0x32ccc8=_0x384341;_0x1b92b7[_0x32ccc8(0x7e)][_0x595161[_0x32ccc8(0xaf)]]=[],await Promise[_0x32ccc8(0x96)](_0x595161[_0x32ccc8(0x86)][_0x32ccc8(0x89)](async _0x30ef49=>{const _0x235138=_0x32ccc8,_0x4c52ae=await sales['aggregate']([{'$unwind':'$sale_product'},{'$match':{'sale_product.id_transaction_from':_0x30ef49[_0x235138(0x8c)]['valueOf'](),'sale_product.invoice':_0x30ef49[_0x235138(0xaf)]}},{'$project':{'_id':_0x235138(0x90),'product_name':_0x235138(0x97),'product_code':'$sale_product.product_code','quantity_available':'$sale_product.quantity','warehouse_name':_0x235138(0xa8),'warehouse_room':_0x235138(0xaa),'product_invoice':_0x235138(0xa6),'invoice':_0x235138(0x82),'id_transaction_from':_0x235138(0xa7)}}]);_0x4c52ae[_0x235138(0x84)]>0x0&&_0x1b92b7['data_sales'][_0x595161['invoice']][_0x235138(0x9d)](..._0x4c52ae);}));})),_0x1b92b7[_0x384341(0x7e)]=_0x1b92b7[_0x384341(0x7e)],_0x1b92b7['data_adjustment']={},await Promise[_0x384341(0x96)](_0x1b92b7[_0x384341(0x89)](async _0x415e9e=>{const _0x4d0534=_0x384341;_0x1b92b7['data_adjustment'][_0x415e9e[_0x4d0534(0xaf)]]=[],await Promise[_0x4d0534(0x96)](_0x415e9e['warehouse_data'][_0x4d0534(0x89)](async _0x25b547=>{const _0x23d6c6=_0x4d0534,_0x3f6184=await adjustment[_0x23d6c6(0x8e)]([{'$unwind':_0x23d6c6(0x9b)},{'$match':{'product.id_transaction_from':_0x25b547['_id'][_0x23d6c6(0xa3)](),'product.invoice':_0x25b547[_0x23d6c6(0xaf)]}},{'$project':{'_id':_0x23d6c6(0x9a),'product_name':_0x23d6c6(0xb0),'product_code':_0x23d6c6(0x81),'quantity_available':_0x23d6c6(0xb2),'warehouse_name':_0x23d6c6(0xa8),'warehouse_room':'$product.room_names','product_invoice':'$product.invoice','invoice':_0x23d6c6(0x82),'id_transaction_from':_0x23d6c6(0xb1)}}]);_0x3f6184['length']>0x0&&_0x1b92b7['data_adjustment'][_0x415e9e[_0x23d6c6(0xaf)]][_0x23d6c6(0x9d)](..._0x3f6184);}));})),_0x1b92b7[_0x384341(0xb4)]={},await Promise[_0x384341(0x96)](_0x1b92b7[_0x384341(0x89)](async _0x4794d1=>{const _0x3511c2=_0x384341;_0x1b92b7['data_transfer'][_0x4794d1['invoice']]=[],await Promise[_0x3511c2(0x96)](_0x4794d1['warehouse_data']['map'](async _0x64dcc1=>{const _0x5f0948=_0x3511c2,_0x153253=await transfers[_0x5f0948(0x8e)]([{'$unwind':_0x5f0948(0x9b)},{'$match':{'product.id_transaction_id':_0x64dcc1['_id'][_0x5f0948(0xa3)](),'product.To_invoice':_0x64dcc1['invoice']}},{'$project':{'_id':_0x5f0948(0x9a),'product_name':_0x5f0948(0xb0),'product_code':'$product.product_code','quantity_available':_0x5f0948(0x7f),'warehouse_name':'$to_warehouse','warehouse_room':_0x5f0948(0xb3),'product_invoice':_0x5f0948(0x80),'invoice':_0x5f0948(0x82),'id_transaction_id':_0x5f0948(0x9f)}}]);console['log'](_0x153253),_0x153253[_0x5f0948(0x84)]>0x0&&_0x1b92b7[_0x5f0948(0xb4)][_0x4794d1[_0x5f0948(0xaf)]]['push'](..._0x153253);}));})),_0x1b07fd[_0x384341(0x95)]({'purchases_warehouse':_0x1b92b7,'data_sales':_0x1b92b7[_0x384341(0x7e)],'data_adjustment':_0x1b92b7[_0x384341(0x8a)],'data_transfer':_0x1b92b7[_0x384341(0xb4)]});}),module[a0_0x5f30a8(0xa1)]=router;