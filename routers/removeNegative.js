const a0_0x169a2a=a0_0x4ad2;function a0_0x4ad2(_0x30441b,_0x564dd6){const _0x44e859=a0_0x44e8();return a0_0x4ad2=function(_0x4ad2f2,_0x1045f3){_0x4ad2f2=_0x4ad2f2-0x153;let _0x3757a7=_0x44e859[_0x4ad2f2];return _0x3757a7;},a0_0x4ad2(_0x30441b,_0x564dd6);}(function(_0x587587,_0x19738d){const _0x22830b=a0_0x4ad2,_0x3ff305=_0x587587();while(!![]){try{const _0x22614a=parseInt(_0x22830b(0x15c))/0x1*(parseInt(_0x22830b(0x18a))/0x2)+parseInt(_0x22830b(0x16e))/0x3+-parseInt(_0x22830b(0x182))/0x4*(-parseInt(_0x22830b(0x188))/0x5)+parseInt(_0x22830b(0x185))/0x6+parseInt(_0x22830b(0x174))/0x7*(parseInt(_0x22830b(0x154))/0x8)+-parseInt(_0x22830b(0x159))/0x9+-parseInt(_0x22830b(0x158))/0xa;if(_0x22614a===_0x19738d)break;else _0x3ff305['push'](_0x3ff305['shift']());}catch(_0x1bf175){_0x3ff305['push'](_0x3ff305['shift']());}}}(a0_0x44e8,0xf2ab8));function a0_0x44e8(){const _0x15d8ca=['$product.to_room_name','data_transfer','$product.product_name','$product.new_adjust_qty','../../models/all_models','warehouse_data','4JyvpNI','log','$warehouse_name','545550mLcpOx','$sale_product.quantity','updateMany','5732275VzQNes','json','1709016idQmuE','length','message','$name','data_sales','status','$product.id_transaction_from','table\x20page','1239544vouuMI','$sale_product._id','valueOf','14800005047429','22639080Xalauu','8598924zkIsLp','aggregate','/negative','1QuDptM','modifiedCount','Router','$sale_product.room_name','$$invoice','INCF-52068316','$product_details','$product_details._id','_id','$sale_product.product_name','data_adjustment','$product_details.product_name','get','$invoice','$product.id_transaction_id','$product','map','flash','3110493hWyGpC','push','invoice','$sale_product.product_code','monitor','$sale_product.invoice','49GuAUcz','$product_details.invoice','warehouses','exports','all','$product_details.product_stock','$to_warehouse','success'];a0_0x44e8=function(){return _0x15d8ca;};return a0_0x44e8();}const express=require('express'),app=express(),router=express[a0_0x169a2a(0x15e)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x169a2a(0x180));router[a0_0x169a2a(0x168)](a0_0x169a2a(0x15b),async(_0x2f2557,_0x36a035)=>{const _0x42027c=a0_0x169a2a;try{const _0xc16e42=await warehouse[_0x42027c(0x187)]({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x36a035['json']({'status':_0xc16e42[_0x42027c(0x15d)]+'\x20documents\x20updated'});}catch(_0x18ed63){console[_0x42027c(0x183)](_0x42027c(0x153),_0x18ed63),_0x36a035[_0x42027c(0x18f)](0xc8)[_0x42027c(0x189)]({'message':_0x18ed63[_0x42027c(0x18c)]});}}),router[a0_0x169a2a(0x168)]('/checking',async(_0x46b0a4,_0x4f6f04)=>{const _0x34cb6b=a0_0x169a2a;try{const _0x40b794=await warehouse[_0x34cb6b(0x15a)]([{'$unwind':_0x34cb6b(0x162)},{'$match':{'product_details.invoice':_0x34cb6b(0x161),'product_details.primary_code':_0x34cb6b(0x157)}},{'$group':{'_id':{'name':'$name','room':'$room'},'products':{'$push':_0x34cb6b(0x162)}}}]);_0x4f6f04[_0x34cb6b(0x189)](_0x40b794);}catch(_0x36601a){console['log'](_0x34cb6b(0x153),_0x36601a),_0x4f6f04[_0x34cb6b(0x18f)](0xc8)['json']({'message':_0x36601a[_0x34cb6b(0x18c)]});}}),router[a0_0x169a2a(0x168)]('/warehouse_monitor',async(_0x4ab35f,_0x116ef1)=>{const _0x102aa3=a0_0x169a2a;_0x116ef1['render'](_0x102aa3(0x172),{'success':_0x4ab35f[_0x102aa3(0x16d)](_0x102aa3(0x17b)),'errors':_0x4ab35f[_0x102aa3(0x16d)]('errors')});}),router[a0_0x169a2a(0x168)]('/join',async(_0x3fb969,_0x2fc2f2)=>{const _0xd786f6=a0_0x169a2a;var _0x1a0fa4=await purchases['aggregate']([{'$lookup':{'from':_0xd786f6(0x176),'let':{'invoice':_0xd786f6(0x169)},'pipeline':[{'$unwind':_0xd786f6(0x162)},{'$match':{'$expr':{'$eq':[_0xd786f6(0x160),_0xd786f6(0x175)]}}},{'$project':{'_id':_0xd786f6(0x163),'product_name':_0xd786f6(0x167),'product_code':'$product_details.product_code','quantity_available':_0xd786f6(0x179),'warehouse_name':_0xd786f6(0x18d),'warehouse_room':'$room','invoice':'$product_details.invoice'}}],'as':_0xd786f6(0x181)}}]);_0x1a0fa4['data_sales']={},await Promise[_0xd786f6(0x178)](_0x1a0fa4[_0xd786f6(0x16c)](async _0x171c74=>{const _0x3d4976=_0xd786f6;_0x1a0fa4['data_sales'][_0x171c74['invoice']]=[],await Promise[_0x3d4976(0x178)](_0x171c74['warehouse_data'][_0x3d4976(0x16c)](async _0x381d69=>{const _0x296606=_0x3d4976,_0x4c7055=await sales[_0x296606(0x15a)]([{'$unwind':'$sale_product'},{'$match':{'sale_product.id_transaction_from':_0x381d69[_0x296606(0x164)][_0x296606(0x156)](),'sale_product.invoice':_0x381d69[_0x296606(0x170)]}},{'$project':{'_id':_0x296606(0x155),'product_name':_0x296606(0x165),'product_code':_0x296606(0x171),'quantity_available':_0x296606(0x186),'warehouse_name':_0x296606(0x184),'warehouse_room':_0x296606(0x15f),'product_invoice':_0x296606(0x173),'invoice':_0x296606(0x169),'id_transaction_from':'$sale_product.id_transaction_from'}}]);_0x4c7055[_0x296606(0x18b)]>0x0&&_0x1a0fa4[_0x296606(0x18e)][_0x171c74['invoice']][_0x296606(0x16f)](..._0x4c7055);}));})),_0x1a0fa4['data_sales']=_0x1a0fa4[_0xd786f6(0x18e)],_0x1a0fa4[_0xd786f6(0x166)]={},await Promise['all'](_0x1a0fa4[_0xd786f6(0x16c)](async _0x4cc1d3=>{const _0x38728c=_0xd786f6;_0x1a0fa4[_0x38728c(0x166)][_0x4cc1d3[_0x38728c(0x170)]]=[],await Promise['all'](_0x4cc1d3['warehouse_data'][_0x38728c(0x16c)](async _0x2ae89b=>{const _0x3f75b1=_0x38728c,_0x1ee3c6=await adjustment[_0x3f75b1(0x15a)]([{'$unwind':_0x3f75b1(0x16b)},{'$match':{'product.id_transaction_from':_0x2ae89b[_0x3f75b1(0x164)][_0x3f75b1(0x156)](),'product.invoice':_0x2ae89b[_0x3f75b1(0x170)]}},{'$project':{'_id':'$product._id','product_name':'$product.product_name','product_code':'$product.product_code','quantity_available':_0x3f75b1(0x17f),'warehouse_name':_0x3f75b1(0x184),'warehouse_room':'$product.room_names','product_invoice':'$product.invoice','invoice':'$invoice','id_transaction_from':_0x3f75b1(0x190)}}]);_0x1ee3c6['length']>0x0&&_0x1a0fa4[_0x3f75b1(0x166)][_0x4cc1d3[_0x3f75b1(0x170)]]['push'](..._0x1ee3c6);}));})),_0x1a0fa4[_0xd786f6(0x17d)]={},await Promise['all'](_0x1a0fa4[_0xd786f6(0x16c)](async _0x703285=>{const _0x39a59b=_0xd786f6;_0x1a0fa4[_0x39a59b(0x17d)][_0x703285[_0x39a59b(0x170)]]=[],await Promise['all'](_0x703285[_0x39a59b(0x181)][_0x39a59b(0x16c)](async _0x2283f6=>{const _0x5c7d11=_0x39a59b,_0x4cf5d9=await transfers['aggregate']([{'$unwind':'$product'},{'$match':{'product.id_transaction_id':_0x2283f6[_0x5c7d11(0x164)][_0x5c7d11(0x156)](),'product.To_invoice':_0x2283f6[_0x5c7d11(0x170)]}},{'$project':{'_id':'$product._id','product_name':_0x5c7d11(0x17e),'product_code':'$product.product_code','quantity_available':'$product.to_quantity','warehouse_name':_0x5c7d11(0x17a),'warehouse_room':'$product.room_names','product_invoice':_0x5c7d11(0x17c),'invoice':_0x5c7d11(0x169),'id_transaction_id':_0x5c7d11(0x16a)}}]);console['log'](_0x4cf5d9),_0x4cf5d9[_0x5c7d11(0x18b)]>0x0&&_0x1a0fa4[_0x5c7d11(0x17d)][_0x703285[_0x5c7d11(0x170)]][_0x5c7d11(0x16f)](..._0x4cf5d9);}));})),_0x2fc2f2['json']({'purchases_warehouse':_0x1a0fa4,'data_sales':_0x1a0fa4[_0xd786f6(0x18e)],'data_adjustment':_0x1a0fa4['data_adjustment'],'data_transfer':_0x1a0fa4['data_transfer']});}),module[a0_0x169a2a(0x177)]=router;