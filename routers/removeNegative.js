const a0_0x47abf3=a0_0x4df9;function a0_0x1792(){const _0x740d49=['$sale_product._id','$sale_product.invoice','warehouse_data','$sale_product.quantity','render','push','$sale_product.room_name','_id','$product.product_name','all','map','length','$$invoice','data_adjustment','$name','$product.product_code','get','$to_warehouse','45BpUBNj','message','50230QEMvnr','$product_details.product_code','invoice','135762gicDwi','$product.invoice','status','469816RsfkYt','$invoice','3736CjIlLg','INCF-52068316','data_transfer','/join','log','$product_details.invoice','exports','$product_details.product_stock','success','$product_details','flash','$sale_product.id_transaction_from','$product._id','$sale_product.product_code','$product.room_names','errors','/checking','263214lVfXev','313GVJrdt','$product.to_quantity','updateMany','/negative','3569400oBPMPQ','\x20documents\x20updated','$room','387AydFou','../../models/all_models','$product','$product_details.product_name','express','valueOf','14800005047429','/warehouse_monitor','$product.id_transaction_from','295316bjkANx','data_sales','$product_details._id','json','aggregate'];a0_0x1792=function(){return _0x740d49;};return a0_0x1792();}(function(_0xebd306,_0x5afd93){const _0x429af9=a0_0x4df9,_0x1e39dc=_0xebd306();while(!![]){try{const _0x253016=parseInt(_0x429af9(0x17d))/0x1*(parseInt(_0x429af9(0x16b))/0x2)+-parseInt(_0x429af9(0x17c))/0x3+-parseInt(_0x429af9(0x169))/0x4+parseInt(_0x429af9(0x161))/0x5*(-parseInt(_0x429af9(0x166))/0x6)+-parseInt(_0x429af9(0x14a))/0x7+parseInt(_0x429af9(0x181))/0x8+-parseInt(_0x429af9(0x184))/0x9*(parseInt(_0x429af9(0x163))/0xa);if(_0x253016===_0x5afd93)break;else _0x1e39dc['push'](_0x1e39dc['shift']());}catch(_0x2674ea){_0x1e39dc['push'](_0x1e39dc['shift']());}}}(a0_0x1792,0x58d47));const express=require(a0_0x47abf3(0x188)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x47abf3(0x185));function a0_0x4df9(_0x3e29a6,_0x958411){const _0x17929e=a0_0x1792();return a0_0x4df9=function(_0x4df9f0,_0x3a0c90){_0x4df9f0=_0x4df9f0-0x148;let _0x46af11=_0x17929e[_0x4df9f0];return _0x46af11;},a0_0x4df9(_0x3e29a6,_0x958411);}router[a0_0x47abf3(0x15f)](a0_0x47abf3(0x180),async(_0xae428e,_0x2bd37b)=>{const _0xac14df=a0_0x47abf3;try{const _0x1a0674=await warehouse[_0xac14df(0x17f)]({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x2bd37b[_0xac14df(0x14d)]({'status':_0x1a0674['modifiedCount']+_0xac14df(0x182)});}catch(_0x3c66d8){console[_0xac14df(0x16f)]('table\x20page',_0x3c66d8),_0x2bd37b['status'](0xc8)[_0xac14df(0x14d)]({'message':_0x3c66d8['message']});}}),router[a0_0x47abf3(0x15f)](a0_0x47abf3(0x17b),async(_0x27b844,_0x2a4c6a)=>{const _0x13af4b=a0_0x47abf3;try{const _0x2c2558=await warehouse['aggregate']([{'$unwind':_0x13af4b(0x174)},{'$match':{'product_details.invoice':_0x13af4b(0x16c),'product_details.primary_code':_0x13af4b(0x18a)}},{'$group':{'_id':{'name':_0x13af4b(0x15d),'room':_0x13af4b(0x183)},'products':{'$push':'$product_details'}}}]);_0x2a4c6a[_0x13af4b(0x14d)](_0x2c2558);}catch(_0x1925c9){console['log']('table\x20page',_0x1925c9),_0x2a4c6a[_0x13af4b(0x168)](0xc8)[_0x13af4b(0x14d)]({'message':_0x1925c9[_0x13af4b(0x162)]});}}),router[a0_0x47abf3(0x15f)](a0_0x47abf3(0x148),async(_0x140b04,_0x181a1d)=>{const _0x5a697e=a0_0x47abf3;_0x181a1d[_0x5a697e(0x153)]('monitor',{'success':_0x140b04['flash'](_0x5a697e(0x173)),'errors':_0x140b04[_0x5a697e(0x175)](_0x5a697e(0x17a))});}),router['get'](a0_0x47abf3(0x16e),async(_0x4d6689,_0x4e826b)=>{const _0x2de1f7=a0_0x47abf3;var _0x2ae1ed=await purchases[_0x2de1f7(0x14e)]([{'$lookup':{'from':'warehouses','let':{'invoice':'$invoice'},'pipeline':[{'$unwind':'$product_details'},{'$match':{'$expr':{'$eq':[_0x2de1f7(0x15b),_0x2de1f7(0x170)]}}},{'$project':{'_id':_0x2de1f7(0x14c),'product_name':_0x2de1f7(0x187),'product_code':_0x2de1f7(0x164),'quantity_available':_0x2de1f7(0x172),'warehouse_name':_0x2de1f7(0x15d),'warehouse_room':'$room','invoice':'$product_details.invoice'}}],'as':_0x2de1f7(0x151)}}]);_0x2ae1ed[_0x2de1f7(0x14b)]={},await Promise[_0x2de1f7(0x158)](_0x2ae1ed[_0x2de1f7(0x159)](async _0x4c2e60=>{const _0x3bd415=_0x2de1f7;_0x2ae1ed[_0x3bd415(0x14b)][_0x4c2e60[_0x3bd415(0x165)]]=[],await Promise[_0x3bd415(0x158)](_0x4c2e60['warehouse_data'][_0x3bd415(0x159)](async _0x21b404=>{const _0xb5c87a=_0x3bd415,_0x4de518=await sales[_0xb5c87a(0x14e)]([{'$unwind':'$sale_product'},{'$match':{'sale_product.id_transaction_from':_0x21b404[_0xb5c87a(0x156)][_0xb5c87a(0x189)](),'sale_product.invoice':_0x21b404['invoice']}},{'$project':{'_id':_0xb5c87a(0x14f),'product_name':'$sale_product.product_name','product_code':_0xb5c87a(0x178),'quantity_available':_0xb5c87a(0x152),'warehouse_name':'$warehouse_name','warehouse_room':_0xb5c87a(0x155),'product_invoice':_0xb5c87a(0x150),'invoice':'$invoice','id_transaction_from':_0xb5c87a(0x176)}}]);_0x4de518['length']>0x0&&_0x2ae1ed['data_sales'][_0x4c2e60[_0xb5c87a(0x165)]][_0xb5c87a(0x154)](..._0x4de518);}));})),_0x2ae1ed[_0x2de1f7(0x14b)]=_0x2ae1ed[_0x2de1f7(0x14b)],_0x2ae1ed['data_adjustment']={},await Promise[_0x2de1f7(0x158)](_0x2ae1ed['map'](async _0x57bf82=>{const _0x436dd3=_0x2de1f7;_0x2ae1ed[_0x436dd3(0x15c)][_0x57bf82[_0x436dd3(0x165)]]=[],await Promise[_0x436dd3(0x158)](_0x57bf82['warehouse_data'][_0x436dd3(0x159)](async _0x4171c9=>{const _0x4eb6fb=_0x436dd3,_0x5389d5=await adjustment[_0x4eb6fb(0x14e)]([{'$unwind':_0x4eb6fb(0x186)},{'$match':{'product.id_transaction_from':_0x4171c9['_id'][_0x4eb6fb(0x189)](),'product.invoice':_0x4171c9['invoice']}},{'$project':{'_id':_0x4eb6fb(0x177),'product_name':_0x4eb6fb(0x157),'product_code':_0x4eb6fb(0x15e),'quantity_available':'$product.new_adjust_qty','warehouse_name':'$warehouse_name','warehouse_room':_0x4eb6fb(0x179),'product_invoice':_0x4eb6fb(0x167),'invoice':'$invoice','id_transaction_from':_0x4eb6fb(0x149)}}]);_0x5389d5[_0x4eb6fb(0x15a)]>0x0&&_0x2ae1ed[_0x4eb6fb(0x15c)][_0x57bf82['invoice']][_0x4eb6fb(0x154)](..._0x5389d5);}));})),_0x2ae1ed['data_transfer']={},await Promise[_0x2de1f7(0x158)](_0x2ae1ed['map'](async _0x31ff27=>{const _0x159942=_0x2de1f7;_0x2ae1ed[_0x159942(0x16d)][_0x31ff27[_0x159942(0x165)]]=[],await Promise['all'](_0x31ff27[_0x159942(0x151)]['map'](async _0x53f329=>{const _0x5bdc11=_0x159942,_0x33aae3=await transfers['aggregate']([{'$unwind':_0x5bdc11(0x186)},{'$match':{'product.id_transaction_id':_0x53f329[_0x5bdc11(0x156)][_0x5bdc11(0x189)](),'product.To_invoice':_0x53f329[_0x5bdc11(0x165)]}},{'$project':{'_id':_0x5bdc11(0x177),'product_name':_0x5bdc11(0x157),'product_code':_0x5bdc11(0x15e),'quantity_available':_0x5bdc11(0x17e),'warehouse_name':_0x5bdc11(0x160),'warehouse_room':_0x5bdc11(0x179),'product_invoice':'$product.to_room_name','invoice':_0x5bdc11(0x16a),'id_transaction_id':'$product.id_transaction_id'}}]);console['log'](_0x33aae3),_0x33aae3[_0x5bdc11(0x15a)]>0x0&&_0x2ae1ed[_0x5bdc11(0x16d)][_0x31ff27['invoice']][_0x5bdc11(0x154)](..._0x33aae3);}));})),_0x4e826b[_0x2de1f7(0x14d)]({'purchases_warehouse':_0x2ae1ed,'data_sales':_0x2ae1ed[_0x2de1f7(0x14b)],'data_adjustment':_0x2ae1ed[_0x2de1f7(0x15c)],'data_transfer':_0x2ae1ed['data_transfer']});}),module[a0_0x47abf3(0x171)]=router;