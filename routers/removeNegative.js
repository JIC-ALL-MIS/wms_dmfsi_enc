const a0_0x55acbf=a0_0x5015;function a0_0x37a8(){const _0x386d7c=['$product.to_room_name','INCF-52068316','/checking','status','60378lmiTNn','all','map','json','data_adjustment','$product.to_quantity','render','250914hkHhGi','$sale_product.product_code','$product.id_transaction_id','/join','6661550MCdSeF','$product.new_adjust_qty','/negative','$$invoice','46CBtfZz','flash','updateMany','$product.room_names','5019360casiMv','push','14800005047429','message','Router','$name','$product._id','1528854GJIyor','express','$sale_product.room_name','length','$product.id_transaction_from','\x20documents\x20updated','$product_details.product_name','1040oInmEH','6275577tMZiiZ','get','data_transfer','modifiedCount','table\x20page','$product_details.product_code','invoice','$sale_product._id','$sale_product.invoice','_id','$product','$to_warehouse','$product.invoice','exports','success','$warehouse_name','$product.product_code','warehouses','$sale_product','$product.product_name','valueOf','$product_details.invoice','data_sales','$sale_product.product_name','aggregate','$room','145845StvtKj','$product_details','warehouse_data','log','errors','monitor','$invoice'];a0_0x37a8=function(){return _0x386d7c;};return a0_0x37a8();}(function(_0x20c2ef,_0x2fa2da){const _0x57e903=a0_0x5015,_0x5406e9=_0x20c2ef();while(!![]){try{const _0x430bc1=-parseInt(_0x57e903(0x141))/0x1*(-parseInt(_0x57e903(0x109))/0x2)+parseInt(_0x57e903(0x114))/0x3+-parseInt(_0x57e903(0x10d))/0x4+parseInt(_0x57e903(0x105))/0x5+-parseInt(_0x57e903(0x101))/0x6+parseInt(_0x57e903(0x11c))/0x7+parseInt(_0x57e903(0x11b))/0x8*(-parseInt(_0x57e903(0x136))/0x9);if(_0x430bc1===_0x2fa2da)break;else _0x5406e9['push'](_0x5406e9['shift']());}catch(_0x576840){_0x5406e9['push'](_0x5406e9['shift']());}}}(a0_0x37a8,0xb0b70));function a0_0x5015(_0x5c91cf,_0x4516b2){const _0x37a8a4=a0_0x37a8();return a0_0x5015=function(_0x501557,_0x2420ae){_0x501557=_0x501557-0xff;let _0x400510=_0x37a8a4[_0x501557];return _0x400510;},a0_0x5015(_0x5c91cf,_0x4516b2);}const express=require(a0_0x55acbf(0x115)),app=express(),router=express[a0_0x55acbf(0x111)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require('../../models/all_models');router[a0_0x55acbf(0x11d)](a0_0x55acbf(0x107),async(_0x332895,_0x2bc6e6)=>{const _0x533d3c=a0_0x55acbf;try{const _0x2a2910=await warehouse[_0x533d3c(0x10b)]({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x2bc6e6[_0x533d3c(0x144)]({'status':_0x2a2910[_0x533d3c(0x11f)]+_0x533d3c(0x119)});}catch(_0x5e0037){console[_0x533d3c(0x139)](_0x533d3c(0x120),_0x5e0037),_0x2bc6e6['status'](0xc8)[_0x533d3c(0x144)]({'message':_0x5e0037[_0x533d3c(0x110)]});}}),router['get'](a0_0x55acbf(0x13f),async(_0x139fcf,_0x2f9961)=>{const _0x1e8c12=a0_0x55acbf;try{const _0x2bc204=await warehouse[_0x1e8c12(0x134)]([{'$unwind':_0x1e8c12(0x137)},{'$match':{'product_details.invoice':_0x1e8c12(0x13e),'product_details.primary_code':_0x1e8c12(0x10f)}},{'$group':{'_id':{'name':_0x1e8c12(0x112),'room':_0x1e8c12(0x135)},'products':{'$push':_0x1e8c12(0x137)}}}]);_0x2f9961[_0x1e8c12(0x144)](_0x2bc204);}catch(_0x4b103b){console[_0x1e8c12(0x139)]('table\x20page',_0x4b103b),_0x2f9961[_0x1e8c12(0x140)](0xc8)[_0x1e8c12(0x144)]({'message':_0x4b103b[_0x1e8c12(0x110)]});}}),router[a0_0x55acbf(0x11d)]('/warehouse_monitor',async(_0x56383b,_0xc3349d)=>{const _0x3bdcc6=a0_0x55acbf;_0xc3349d[_0x3bdcc6(0x100)](_0x3bdcc6(0x13b),{'success':_0x56383b[_0x3bdcc6(0x10a)](_0x3bdcc6(0x12a)),'errors':_0x56383b[_0x3bdcc6(0x10a)](_0x3bdcc6(0x13a))});}),router[a0_0x55acbf(0x11d)](a0_0x55acbf(0x104),async(_0x2c162d,_0x473619)=>{const _0x22d71f=a0_0x55acbf;var _0x3d7718=await purchases[_0x22d71f(0x134)]([{'$lookup':{'from':_0x22d71f(0x12d),'let':{'invoice':_0x22d71f(0x13c)},'pipeline':[{'$unwind':_0x22d71f(0x137)},{'$match':{'$expr':{'$eq':[_0x22d71f(0x108),_0x22d71f(0x131)]}}},{'$project':{'_id':'$product_details._id','product_name':_0x22d71f(0x11a),'product_code':_0x22d71f(0x121),'quantity_available':'$product_details.product_stock','warehouse_name':_0x22d71f(0x112),'warehouse_room':_0x22d71f(0x135),'invoice':'$product_details.invoice'}}],'as':'warehouse_data'}}]);_0x3d7718[_0x22d71f(0x132)]={},await Promise[_0x22d71f(0x142)](_0x3d7718[_0x22d71f(0x143)](async _0x5f43cb=>{const _0x33fb6a=_0x22d71f;_0x3d7718[_0x33fb6a(0x132)][_0x5f43cb['invoice']]=[],await Promise[_0x33fb6a(0x142)](_0x5f43cb[_0x33fb6a(0x138)][_0x33fb6a(0x143)](async _0x14f95c=>{const _0x440ac2=_0x33fb6a,_0x5d4868=await sales['aggregate']([{'$unwind':_0x440ac2(0x12e)},{'$match':{'sale_product.id_transaction_from':_0x14f95c[_0x440ac2(0x125)][_0x440ac2(0x130)](),'sale_product.invoice':_0x14f95c[_0x440ac2(0x122)]}},{'$project':{'_id':_0x440ac2(0x123),'product_name':_0x440ac2(0x133),'product_code':_0x440ac2(0x102),'quantity_available':'$sale_product.quantity','warehouse_name':_0x440ac2(0x12b),'warehouse_room':_0x440ac2(0x116),'product_invoice':_0x440ac2(0x124),'invoice':'$invoice','id_transaction_from':'$sale_product.id_transaction_from'}}]);_0x5d4868[_0x440ac2(0x117)]>0x0&&_0x3d7718[_0x440ac2(0x132)][_0x5f43cb[_0x440ac2(0x122)]][_0x440ac2(0x10e)](..._0x5d4868);}));})),_0x3d7718[_0x22d71f(0x132)]=_0x3d7718[_0x22d71f(0x132)],_0x3d7718['data_adjustment']={},await Promise[_0x22d71f(0x142)](_0x3d7718[_0x22d71f(0x143)](async _0x1ee9c1=>{const _0x4c6dec=_0x22d71f;_0x3d7718[_0x4c6dec(0x145)][_0x1ee9c1['invoice']]=[],await Promise[_0x4c6dec(0x142)](_0x1ee9c1[_0x4c6dec(0x138)][_0x4c6dec(0x143)](async _0x3b7edf=>{const _0x18c116=_0x4c6dec,_0x231b7a=await adjustment[_0x18c116(0x134)]([{'$unwind':'$product'},{'$match':{'product.id_transaction_from':_0x3b7edf[_0x18c116(0x125)][_0x18c116(0x130)](),'product.invoice':_0x3b7edf[_0x18c116(0x122)]}},{'$project':{'_id':'$product._id','product_name':_0x18c116(0x12f),'product_code':_0x18c116(0x12c),'quantity_available':_0x18c116(0x106),'warehouse_name':_0x18c116(0x12b),'warehouse_room':_0x18c116(0x10c),'product_invoice':_0x18c116(0x128),'invoice':_0x18c116(0x13c),'id_transaction_from':_0x18c116(0x118)}}]);_0x231b7a['length']>0x0&&_0x3d7718[_0x18c116(0x145)][_0x1ee9c1['invoice']][_0x18c116(0x10e)](..._0x231b7a);}));})),_0x3d7718[_0x22d71f(0x11e)]={},await Promise[_0x22d71f(0x142)](_0x3d7718[_0x22d71f(0x143)](async _0x465e28=>{const _0x9f389e=_0x22d71f;_0x3d7718[_0x9f389e(0x11e)][_0x465e28[_0x9f389e(0x122)]]=[],await Promise[_0x9f389e(0x142)](_0x465e28[_0x9f389e(0x138)][_0x9f389e(0x143)](async _0x28b997=>{const _0x131212=_0x9f389e,_0x382eda=await transfers[_0x131212(0x134)]([{'$unwind':_0x131212(0x126)},{'$match':{'product.id_transaction_id':_0x28b997[_0x131212(0x125)][_0x131212(0x130)](),'product.To_invoice':_0x28b997[_0x131212(0x122)]}},{'$project':{'_id':_0x131212(0x113),'product_name':_0x131212(0x12f),'product_code':_0x131212(0x12c),'quantity_available':_0x131212(0xff),'warehouse_name':_0x131212(0x127),'warehouse_room':_0x131212(0x10c),'product_invoice':_0x131212(0x13d),'invoice':'$invoice','id_transaction_id':_0x131212(0x103)}}]);console[_0x131212(0x139)](_0x382eda),_0x382eda[_0x131212(0x117)]>0x0&&_0x3d7718['data_transfer'][_0x465e28['invoice']][_0x131212(0x10e)](..._0x382eda);}));})),_0x473619[_0x22d71f(0x144)]({'purchases_warehouse':_0x3d7718,'data_sales':_0x3d7718[_0x22d71f(0x132)],'data_adjustment':_0x3d7718[_0x22d71f(0x145)],'data_transfer':_0x3d7718[_0x22d71f(0x11e)]});}),module[a0_0x55acbf(0x129)]=router;