const a0_0x19b359=a0_0x26c7;(function(_0x2894aa,_0x5bef3b){const _0x4bb512=a0_0x26c7,_0x56785f=_0x2894aa();while(!![]){try{const _0x33a968=-parseInt(_0x4bb512(0x14e))/0x1+-parseInt(_0x4bb512(0x160))/0x2+parseInt(_0x4bb512(0x170))/0x3*(-parseInt(_0x4bb512(0x19a))/0x4)+-parseInt(_0x4bb512(0x176))/0x5*(parseInt(_0x4bb512(0x158))/0x6)+parseInt(_0x4bb512(0x13f))/0x7*(-parseInt(_0x4bb512(0x131))/0x8)+parseInt(_0x4bb512(0x180))/0x9*(-parseInt(_0x4bb512(0x14f))/0xa)+parseInt(_0x4bb512(0x146))/0xb*(parseInt(_0x4bb512(0x1a4))/0xc);if(_0x33a968===_0x5bef3b)break;else _0x56785f['push'](_0x56785f['shift']());}catch(_0x373351){_0x56785f['push'](_0x56785f['shift']());}}}(a0_0x100f,0x69f23));const express=require('express'),app=express(),router=express[a0_0x19b359(0x148)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require(a0_0x19b359(0x15f)),auth=require(a0_0x19b359(0x192)),users=require(a0_0x19b359(0x157));router['get']('/view',auth,async(_0x4b05ed,_0x5e1cfd)=>{const _0x96ea85=a0_0x19b359;try{const {username:_0x48c397,email:_0x5d2849,role:_0x4164ce}=_0x4b05ed['user'],_0x6f72c3=_0x4b05ed[_0x96ea85(0x178)],_0x1db115=await profile[_0x96ea85(0x166)]({'email':_0x6f72c3['email']}),_0x338f71=await master_shop[_0x96ea85(0x197)]();console['log'](_0x96ea85(0x141),_0x338f71);const _0x57aa4d=await purchases_return_finished[_0x96ea85(0x19d)]([{'$lookup':{'from':_0x96ea85(0x13e),'localField':_0x96ea85(0x13e),'foreignField':_0x96ea85(0x18e),'as':_0x96ea85(0x188)}},{'$unwind':_0x96ea85(0x144)},{'$unwind':_0x96ea85(0x195)},{'$group':{'_id':_0x96ea85(0x19e),'invoice':{'$first':'$invoice'},'date':{'$first':'$date'},'suppliers':{'$first':_0x96ea85(0x18a)},'warehouse_name':{'$first':_0x96ea85(0x15a)},'product_name':{'$first':_0x96ea85(0x19b)},'return_qty':{'$first':_0x96ea85(0x15b)},'price':{'$first':_0x96ea85(0x184)},'total':{'$sum':_0x96ea85(0x136)},'note':{'$first':'$note'},'total_amount':{'$first':_0x96ea85(0x134)},'discount':{'$first':'$discount'},'receivable':{'$first':'$receivable'},'received':{'$first':_0x96ea85(0x145)},'due_amount':{'$first':_0x96ea85(0x17d)},'mobile':{'$first':'$supplier_docs.mobile'},'email':{'$first':'$supplier_docs.email'},'address':{'$first':_0x96ea85(0x163)},'return_sum_qty':{'$sum':'$return_product.return_qty'}}}]);console[_0x96ea85(0x177)](_0x57aa4d);if(_0x338f71[0x0][_0x96ea85(0x181)]=='English\x20(US)'){var _0xe2dda7=users['English'];console[_0x96ea85(0x177)](_0xe2dda7);}else{if(_0x338f71[0x0][_0x96ea85(0x181)]==_0x96ea85(0x16d))var _0xe2dda7=users[_0x96ea85(0x16d)];else{if(_0x338f71[0x0][_0x96ea85(0x181)]==_0x96ea85(0x171))var _0xe2dda7=users[_0x96ea85(0x171)];else{if(_0x338f71[0x0][_0x96ea85(0x181)]==_0x96ea85(0x143))var _0xe2dda7=users[_0x96ea85(0x143)];else{if(_0x338f71[0x0][_0x96ea85(0x181)]=='French')var _0xe2dda7=users['French'];else{if(_0x338f71[0x0]['language']==_0x96ea85(0x133))var _0xe2dda7=users[_0x96ea85(0x15c)];else{if(_0x338f71[0x0][_0x96ea85(0x181)]==_0x96ea85(0x174))var _0xe2dda7=users['Chinese'];else{if(_0x338f71[0x0][_0x96ea85(0x181)]==_0x96ea85(0x185))var _0xe2dda7=users[_0x96ea85(0x172)];}}}}}}}_0x5e1cfd['render'](_0x96ea85(0x15e),{'success':_0x4b05ed[_0x96ea85(0x149)]('success'),'errors':_0x4b05ed['flash'](_0x96ea85(0x18b)),'role':_0x6f72c3,'profile':_0x1db115,'master_shop':_0x338f71,'user':_0x57aa4d,'language':_0xe2dda7});}catch(_0x6f3467){console[_0x96ea85(0x177)](_0x6f3467);}}),router[a0_0x19b359(0x164)]('/view/:id',auth,async(_0x4b29bc,_0x5234ac)=>{const _0xc4694d=a0_0x19b359;try{const {username:_0x1ed187,email:_0x5e2d5f,role:_0x187ebc}=_0x4b29bc[_0xc4694d(0x178)],_0x26b0e2=_0x4b29bc[_0xc4694d(0x178)],_0x5e996b=await profile[_0xc4694d(0x166)]({'email':_0x26b0e2[_0xc4694d(0x19f)]}),_0x14248e=await product['find']({}),_0xdbfdd3=await master_shop[_0xc4694d(0x197)](),_0x17a0c6=_0x4b29bc[_0xc4694d(0x191)]['id'],_0x177603=await purchases_return_finished[_0xc4694d(0x16b)](_0x17a0c6),_0x7c9b10=await warehouse['aggregate']([{'$match':{'name':_0x177603[_0xc4694d(0x16e)],'room':_0x177603[_0xc4694d(0x183)],'warehouse_category':_0xc4694d(0x147)}},{'$unwind':_0xc4694d(0x1a0)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xc4694d(0x17c)},'bay':{'$first':_0xc4694d(0x156)},'bin':{'$first':_0xc4694d(0x1a5)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xc4694d(0x153)},'secondary_code':{'$first':_0xc4694d(0x17e)},'product_code':{'$first':_0xc4694d(0x198)},'storage':{'$first':_0xc4694d(0x15d)},'rack':{'$first':_0xc4694d(0x179)}}}]);warehouse_data=await warehouse[_0xc4694d(0x19d)]([{'$match':{'status':_0xc4694d(0x167),'name':_0xc4694d(0x186),'warehouse_category':_0xc4694d(0x147)}},{'$group':{'_id':_0xc4694d(0x159),'name':{'$first':_0xc4694d(0x159)}}},{'$sort':{'name':0x1}}]),console[_0xc4694d(0x177)](_0xc4694d(0x199),_0x7c9b10);if(_0xdbfdd3[0x0]['language']==_0xc4694d(0x194)){var _0x146986=users[_0xc4694d(0x18c)];console['log'](_0x146986);}else{if(_0xdbfdd3[0x0][_0xc4694d(0x181)]==_0xc4694d(0x16d))var _0x146986=users['Hindi'];else{if(_0xdbfdd3[0x0][_0xc4694d(0x181)]==_0xc4694d(0x171))var _0x146986=users[_0xc4694d(0x171)];else{if(_0xdbfdd3[0x0][_0xc4694d(0x181)]==_0xc4694d(0x143))var _0x146986=users[_0xc4694d(0x143)];else{if(_0xdbfdd3[0x0][_0xc4694d(0x181)]=='French')var _0x146986=users[_0xc4694d(0x168)];else{if(_0xdbfdd3[0x0]['language']==_0xc4694d(0x133))var _0x146986=users[_0xc4694d(0x15c)];else{if(_0xdbfdd3[0x0][_0xc4694d(0x181)]==_0xc4694d(0x174))var _0x146986=users[_0xc4694d(0x174)];else{if(_0xdbfdd3[0x0]['language']==_0xc4694d(0x185))var _0x146986=users[_0xc4694d(0x172)];}}}}}}}_0x5234ac[_0xc4694d(0x17f)](_0xc4694d(0x132),{'success':_0x4b29bc[_0xc4694d(0x149)]('success'),'errors':_0x4b29bc['flash'](_0xc4694d(0x18b)),'role':_0x26b0e2,'master_shop':_0xdbfdd3,'profile':_0x5e996b,'user':_0x177603,'stock':_0x7c9b10,'product':_0x14248e,'language':_0x146986,'warehouse':warehouse_data});}catch(_0x169596){console[_0xc4694d(0x177)](_0x169596);}}),router[a0_0x19b359(0x152)]('/view/:id',auth,async(_0x1a430e,_0x3d6cf6)=>{const _0x312c37=a0_0x19b359;try{const _0x3ba982=_0x1a430e['params']['id'],_0x2dc9ba=await purchases_return_finished['findOne']({'invoice':_0x1a430e['body']['invoice']}),_0xc8b5a2=await warehouse[_0x312c37(0x166)]({'name':_0x2dc9ba['to_warehouse_name'],'room':_0x2dc9ba['to_room'],'warehouse_category':_0x312c37(0x147)}),{invoice:_0x3a4fa8,suppliers:_0xcf96e6,date:_0x2e88b4,warehouse_name:_0x5d3f42,product_name:_0x581d14,purchase_quantity:_0x3dc0bb,stocks:_0x51470f,return_qty:_0xd7ab7f,note:_0x199b98,Room_name:_0x35a51b,level:_0xbac5,isle:_0x2cf215,pallet:_0x1692b3,to_warehouse_name:_0x35ad55,to_Room_name:_0x3f0673}=_0x1a430e[_0x312c37(0x189)];if(typeof _0x581d14==_0x312c37(0x161))var _0x1c7d02=[_0x1a430e[_0x312c37(0x189)]['product_name']],_0x12a356=[_0x1a430e['body'][_0x312c37(0x165)]],_0x408a9b=[_0x1a430e['body'][_0x312c37(0x16f)]],_0x556abe=[_0x1a430e[_0x312c37(0x189)][_0x312c37(0x14b)]],_0x43e436=[_0x1a430e[_0x312c37(0x189)]['level']],_0x243edd=[_0x1a430e[_0x312c37(0x189)][_0x312c37(0x14a)]],_0xdb80f=[_0x1a430e[_0x312c37(0x189)][_0x312c37(0x154)]],_0x1650c2=[_0x1a430e['body'][_0x312c37(0x1a1)]];else var _0x1c7d02=[..._0x1a430e[_0x312c37(0x189)][_0x312c37(0x190)]],_0x12a356=[..._0x1a430e[_0x312c37(0x189)][_0x312c37(0x165)]],_0x408a9b=[..._0x1a430e[_0x312c37(0x189)][_0x312c37(0x16f)]],_0x556abe=[..._0x1a430e[_0x312c37(0x189)][_0x312c37(0x14b)]],_0x43e436=[..._0x1a430e[_0x312c37(0x189)][_0x312c37(0x16c)]],_0x243edd=[..._0x1a430e['body'][_0x312c37(0x14a)]],_0xdb80f=[..._0x1a430e[_0x312c37(0x189)][_0x312c37(0x154)]],_0x1650c2=[..._0x1a430e[_0x312c37(0x189)]['secondary_code_hide']];const _0x2212be=_0x1c7d02['map'](_0x9ef668=>{return _0x9ef668={'product_name':_0x9ef668};});_0x12a356['forEach']((_0x58fa05,_0x510637)=>{_0x2212be[_0x510637]['purchase_quantity']=_0x58fa05;}),_0x408a9b[_0x312c37(0x142)]((_0xe0d885,_0x46499a)=>{_0x2212be[_0x46499a]['stock_quantity']=_0xe0d885;}),_0x556abe[_0x312c37(0x142)]((_0x4c7616,_0x3b6c78)=>{const _0x2beb8a=_0x312c37;_0x2212be[_0x3b6c78][_0x2beb8a(0x14b)]=_0x4c7616;}),_0x43e436['forEach']((_0x5f2d05,_0x1f8c61)=>{_0x2212be[_0x1f8c61]['bay']=_0x5f2d05;}),_0x243edd[_0x312c37(0x142)]((_0x2a66c6,_0x14c08d)=>{const _0xdf3859=_0x312c37;_0x2212be[_0x14c08d][_0xdf3859(0x175)]=_0x2a66c6;}),_0xdb80f[_0x312c37(0x142)]((_0x5c5b08,_0x210cdb)=>{const _0x654d92=_0x312c37;_0x2212be[_0x210cdb][_0x654d92(0x140)]=_0x5c5b08;}),_0x1650c2[_0x312c37(0x142)]((_0x372d3e,_0x4fb4f3)=>{const _0x36b7fd=_0x312c37;_0x2212be[_0x4fb4f3][_0x36b7fd(0x19c)]=_0x372d3e;});var _0x4956f1=0x0;_0x2212be[_0x312c37(0x142)](_0x57466a=>{const _0x236a7b=_0x312c37;(parseInt(_0x57466a['purchase_quantity'])<parseInt(_0x57466a['return_qty'])||parseInt(_0x57466a['stock_quantity'])<parseInt(_0x57466a[_0x236a7b(0x14b)]))&&_0x4956f1++;});if(_0x4956f1!=0x0)return _0x1a430e[_0x312c37(0x149)](_0x312c37(0x18b),_0x312c37(0x18d)),_0x3d6cf6[_0x312c37(0x187)]('back');_0x2dc9ba[_0x312c37(0x13a)]['forEach'](_0xd64222=>{const _0x3bc122=_0x312c37;if(_0xd64222[_0x3bc122(0x14b)]>0x0){const _0x4d1414=_0xc8b5a2[_0x3bc122(0x193)][_0x3bc122(0x14c)](_0x6f64=>{const _0x5e9ad4=_0x3bc122;_0x6f64[_0x5e9ad4(0x190)]==_0xd64222[_0x5e9ad4(0x190)]&&_0x6f64[_0x5e9ad4(0x138)]==_0xd64222['bay']&&(_0x6f64['product_stock']=parseInt(_0x6f64['product_stock'])+parseInt(_0xd64222[_0x5e9ad4(0x14b)]));});}}),await _0xc8b5a2['save'](),_0x2dc9ba[_0x312c37(0x13d)]=_0x3a4fa8,_0x2dc9ba[_0x312c37(0x13e)]=_0xcf96e6,_0x2dc9ba[_0x312c37(0x173)]=_0x2e88b4,_0x2dc9ba['warehouse_name']=_0x5d3f42,_0x2dc9ba['return_product']=_0x2212be,_0x2dc9ba['note']=_0x199b98,_0x2dc9ba[_0x312c37(0x183)]=_0x35a51b,_0x2dc9ba[_0x312c37(0x16a)]=_0x35ad55,_0x2dc9ba[_0x312c37(0x162)]=_0x3f0673;const _0x62cd74=await _0x2dc9ba[_0x312c37(0x18f)](),_0x392671=await purchases_return_finished[_0x312c37(0x166)]({'invoice':_0x1a430e[_0x312c37(0x189)][_0x312c37(0x13d)]}),_0x2f7cf5=await warehouse[_0x312c37(0x166)]({'name':_0x1a430e[_0x312c37(0x189)][_0x312c37(0x16a)],'room':_0x1a430e['body'][_0x312c37(0x14d)],'warehouse_category':'Finished\x20Goods'});_0x392671[_0x312c37(0x13a)][_0x312c37(0x142)](_0x3c44f7=>{const _0x1cfc01=_0x312c37;_0x2f7cf5[_0x1cfc01(0x193)]['map'](_0x5be142=>{const _0x531663=_0x1cfc01;_0x5be142[_0x531663(0x190)]==_0x3c44f7[_0x531663(0x190)]&&_0x5be142[_0x531663(0x138)]==_0x3c44f7[_0x531663(0x138)]&&(_0x5be142[_0x531663(0x139)]=parseInt(_0x5be142[_0x531663(0x139)])-parseInt(_0x3c44f7['return_qty']));});}),await _0x2f7cf5['save']();const _0x45a67a=await s_payment_data[_0x312c37(0x166)]({'invoice':_0x1a430e[_0x312c37(0x189)]['invoice'],'reason':'Purchase\x20Return'});await _0x45a67a[_0x312c37(0x18f)](),_0x1a430e[_0x312c37(0x149)]('success',_0x312c37(0x169)),_0x3d6cf6[_0x312c37(0x187)](_0x312c37(0x1a3));}catch(_0x1a17e2){console['log'](_0x1a17e2),_0x3d6cf6['status'](0xc8)[_0x312c37(0x17b)]({'message':_0x1a17e2[_0x312c37(0x182)]});}}),router[a0_0x19b359(0x164)]('/invoice/:id',auth,async(_0x1521ce,_0x5a028d)=>{const _0x1c8d41=a0_0x19b359;try{const {username:_0x3252ff,email:_0x2ac355,role:_0x3733cb}=_0x1521ce['user'],_0x5c06c8=_0x1521ce['user'],_0x816f40=await profile[_0x1c8d41(0x166)]({'email':_0x5c06c8[_0x1c8d41(0x19f)]}),_0x5b5728=await master_shop[_0x1c8d41(0x197)]();console[_0x1c8d41(0x177)](_0x1c8d41(0x141),_0x5b5728);const _0xdc8e89=_0x1521ce[_0x1c8d41(0x191)]['id'],_0x100dab=await purchases_return[_0x1c8d41(0x16b)](_0xdc8e89);console['log'](_0x100dab);const _0x4addd3=await suppliers['findOne']({'name':_0x100dab[_0x1c8d41(0x13e)]});console[_0x1c8d41(0x177)](_0x4addd3);if(_0x5b5728[0x0][_0x1c8d41(0x181)]==_0x1c8d41(0x194)){var _0x431e20=users[_0x1c8d41(0x18c)];console[_0x1c8d41(0x177)](_0x431e20);}else{if(_0x5b5728[0x0][_0x1c8d41(0x181)]==_0x1c8d41(0x16d))var _0x431e20=users['Hindi'];else{if(_0x5b5728[0x0][_0x1c8d41(0x181)]==_0x1c8d41(0x171))var _0x431e20=users[_0x1c8d41(0x171)];else{if(_0x5b5728[0x0]['language']==_0x1c8d41(0x143))var _0x431e20=users[_0x1c8d41(0x143)];else{if(_0x5b5728[0x0][_0x1c8d41(0x181)]==_0x1c8d41(0x168))var _0x431e20=users[_0x1c8d41(0x168)];else{if(_0x5b5728[0x0][_0x1c8d41(0x181)]=='Portuguese\x20(BR)')var _0x431e20=users[_0x1c8d41(0x15c)];else{if(_0x5b5728[0x0][_0x1c8d41(0x181)]=='Chinese')var _0x431e20=users[_0x1c8d41(0x174)];else{if(_0x5b5728[0x0][_0x1c8d41(0x181)]==_0x1c8d41(0x185))var _0x431e20=users[_0x1c8d41(0x172)];}}}}}}}_0x5a028d[_0x1c8d41(0x17f)](_0x1c8d41(0x17a),{'success':_0x1521ce[_0x1c8d41(0x149)](_0x1c8d41(0x1a2)),'errors':_0x1521ce['flash'](_0x1c8d41(0x18b)),'role':_0x5c06c8,'profile':_0x816f40,'master_shop':_0x5b5728,'supplier':_0x4addd3,'purchase':_0x100dab,'language':_0x431e20});}catch(_0x28375c){console[_0x1c8d41(0x177)](_0x28375c);}}),router[a0_0x19b359(0x152)](a0_0x19b359(0x151),auth,async(_0x23bbfc,_0x288ba3)=>{const _0x3ba29a=a0_0x19b359;try{const _0x259eef=_0x23bbfc[_0x3ba29a(0x191)]['id'],{invoice:_0x5cdbe9,suppliers:_0x23fd05,receivable_amount:_0x6602ae,received_amount:_0x1aa89d}=_0x23bbfc['body'],_0x5cc943=await purchases_return[_0x3ba29a(0x16b)](_0x259eef);console[_0x3ba29a(0x177)](_0x5cc943);var _0x234a91=_0x6602ae-_0x1aa89d;console['log'](_0x1aa89d),_0x5cc943[_0x3ba29a(0x13c)]=parseFloat(_0x1aa89d)+parseFloat(_0x5cc943['received']),_0x5cc943['due_amount']=_0x234a91,console[_0x3ba29a(0x177)](_0x5cc943);const _0x10b491=await _0x5cc943[_0x3ba29a(0x18f)](),_0x50931f=await s_payment_data[_0x3ba29a(0x166)]({'invoice':_0x23bbfc['body'][_0x3ba29a(0x13d)],'reason':'Purchase\x20Return'});_0x50931f['amount']=_0x234a91,await _0x50931f[_0x3ba29a(0x18f)]();let _0x4abf7b=new Date(),_0x96e033=('0'+_0x4abf7b[_0x3ba29a(0x150)]())[_0x3ba29a(0x13b)](-0x2),_0x2d5ed4=('0'+(_0x4abf7b[_0x3ba29a(0x135)]()+0x1))['slice'](-0x2),_0x3b96c3=_0x4abf7b[_0x3ba29a(0x137)](),_0x34990f=_0x3b96c3+'-'+_0x2d5ed4+'-'+_0x96e033;const _0x2063f7=new suppliers_payment({'invoice':_0x5cdbe9,'date':_0x3b96c3+'-'+_0x2d5ed4+'-'+_0x96e033,'suppliers':_0x23fd05,'reason':_0x3ba29a(0x155),'amount':_0x1aa89d}),_0x3cefe1=await _0x2063f7[_0x3ba29a(0x18f)]();_0x23bbfc[_0x3ba29a(0x149)](_0x3ba29a(0x1a2),'payment\x20successfull'),_0x288ba3[_0x3ba29a(0x187)](_0x3ba29a(0x196));}catch(_0x5af2ca){console[_0x3ba29a(0x177)](_0x5af2ca);}}),module['exports']=router;function a0_0x26c7(_0x569b62,_0x4906af){const _0x100f48=a0_0x100f();return a0_0x26c7=function(_0x26c71d,_0x2febfd){_0x26c71d=_0x26c71d-0x131;let _0x36bf69=_0x100f48[_0x26c71d];return _0x36bf69;},a0_0x26c7(_0x569b62,_0x4906af);}function a0_0x100f(){const _0x27c2fd=['Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','name','save','product_name','params','../middleware/auth','product_details','English\x20(US)','$supplier_docs','/purchases_return/view','find','$product_details.product_code','stock_data','40GRrJHD','$return_product.product_name','secondary_code','aggregate','$_id','email','$product_details','secondary_code_hide','success','/purchases_return_finished/view','468252PrAkub','$product_details.bin','848BAEzio','return_purchase_edit_finished','Portuguese\x20(BR)','$total_amount','getMonth','$return_product.total','getFullYear','bay','product_stock','return_product','slice','received','invoice','suppliers','14035ipujug','primary_code','master','forEach','Spanish','$return_product','$received','715bzTTXk','Finished\x20Goods','Router','flash','product_code_hide','return_qty','map','to_Room_name','649398NsZLZm','4940rkhHbU','getDate','/receive_payment/:id','post','$product_details.primary_code','primary_code_hide','Received\x20For\x20Purchase\x20Return','$product_details.bay','../public/language/languages.json','786342IvKuIW','$name','$warehouse_name','$return_product.return_qty','Portuguese','$product_details.storage','purchases_return_finished','../models/all_models','108572NkCQoj','string','to_room','$supplier_docs.address','get','purchase_quantity','findOne','Enabled','French','purchase\x20return\x20successfully','to_warehouse_name','findById','level','Hindi','warehouse_name','stocks','164949CxNAQN','German','Arabic','date','Chinese','product_code','20fWHPjc','log','user','$product_details.rack','return_purchase_invoice','json','$product_details.product_stock','$due_amount','$product_details.secondary_code','render','2043spEfmK','language','message','room','$return_product.price','Arabic\x20(ae)','Return\x20Goods','redirect','supplier_docs','body','$suppliers','errors','English'];a0_0x100f=function(){return _0x27c2fd;};return a0_0x100f();}