const a0_0x532b7b=a0_0x3dcc;(function(_0x2a2a90,_0x12e90d){const _0x4cf303=a0_0x3dcc,_0x94a4b2=_0x2a2a90();while(!![]){try{const _0x49321e=-parseInt(_0x4cf303(0xfd))/0x1+-parseInt(_0x4cf303(0xff))/0x2+-parseInt(_0x4cf303(0xdb))/0x3+parseInt(_0x4cf303(0xd8))/0x4+parseInt(_0x4cf303(0xd4))/0x5*(-parseInt(_0x4cf303(0xd3))/0x6)+parseInt(_0x4cf303(0xc9))/0x7+parseInt(_0x4cf303(0xfc))/0x8;if(_0x49321e===_0x12e90d)break;else _0x94a4b2['push'](_0x94a4b2['shift']());}catch(_0x48ad3a){_0x94a4b2['push'](_0x94a4b2['shift']());}}}(a0_0xe254,0x8b228));const express=require(a0_0x532b7b(0xc8)),app=express(),router=express[a0_0x532b7b(0xde)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require('../models/all_models'),auth=require(a0_0x532b7b(0x10f)),users=require(a0_0x532b7b(0x105));function a0_0x3dcc(_0x3794e1,_0x5eaaff){const _0xe25465=a0_0xe254();return a0_0x3dcc=function(_0x3dcce1,_0x3ae4af){_0x3dcce1=_0x3dcce1-0xc3;let _0x187d21=_0xe25465[_0x3dcce1];return _0x187d21;},a0_0x3dcc(_0x3794e1,_0x5eaaff);}router[a0_0x532b7b(0xcf)]('/view',auth,async(_0x4ff0a3,_0x2a310c)=>{const _0x1110de=a0_0x532b7b;try{const {username:_0x4bc1c4,email:_0x400741,role:_0x4e13fb}=_0x4ff0a3[_0x1110de(0x131)],_0xaea9e2=_0x4ff0a3[_0x1110de(0x131)],_0x15aa26=await profile[_0x1110de(0x10c)]({'email':_0xaea9e2['email']}),_0x21d4eb=await master_shop[_0x1110de(0x124)]();console[_0x1110de(0x107)]('master',_0x21d4eb);const _0x143b79=await purchases_return_finished[_0x1110de(0xfa)]([{'$lookup':{'from':_0x1110de(0xe1),'localField':_0x1110de(0xe1),'foreignField':'name','as':'supplier_docs'}},{'$unwind':_0x1110de(0xd6)},{'$unwind':_0x1110de(0xea)},{'$group':{'_id':_0x1110de(0xc6),'invoice':{'$first':_0x1110de(0x119)},'date':{'$first':'$date'},'suppliers':{'$first':_0x1110de(0xf2)},'warehouse_name':{'$first':_0x1110de(0x127)},'product_name':{'$first':'$return_product.product_name'},'return_qty':{'$first':'$return_product.return_qty'},'price':{'$first':_0x1110de(0xda)},'total':{'$sum':_0x1110de(0xe0)},'note':{'$first':_0x1110de(0x12f)},'total_amount':{'$first':_0x1110de(0xfe)},'discount':{'$first':'$discount'},'receivable':{'$first':_0x1110de(0x112)},'received':{'$first':_0x1110de(0xd0)},'due_amount':{'$first':_0x1110de(0x133)},'mobile':{'$first':'$supplier_docs.mobile'},'email':{'$first':'$supplier_docs.email'},'address':{'$first':_0x1110de(0x129)},'return_sum_qty':{'$sum':_0x1110de(0xdf)}}}]);console[_0x1110de(0x107)](_0x143b79);if(_0x21d4eb[0x0][_0x1110de(0xc5)]==_0x1110de(0xc7)){var _0x7afe70=users[_0x1110de(0xf3)];console[_0x1110de(0x107)](_0x7afe70);}else{if(_0x21d4eb[0x0][_0x1110de(0xc5)]=='Hindi')var _0x7afe70=users[_0x1110de(0xd7)];else{if(_0x21d4eb[0x0][_0x1110de(0xc5)]==_0x1110de(0xd2))var _0x7afe70=users[_0x1110de(0xd2)];else{if(_0x21d4eb[0x0][_0x1110de(0xc5)]==_0x1110de(0x134))var _0x7afe70=users[_0x1110de(0x134)];else{if(_0x21d4eb[0x0]['language']==_0x1110de(0xe7))var _0x7afe70=users[_0x1110de(0xe7)];else{if(_0x21d4eb[0x0][_0x1110de(0xc5)]==_0x1110de(0xc3))var _0x7afe70=users[_0x1110de(0x10e)];else{if(_0x21d4eb[0x0][_0x1110de(0xc5)]==_0x1110de(0x11c))var _0x7afe70=users[_0x1110de(0x11c)];else{if(_0x21d4eb[0x0][_0x1110de(0xc5)]==_0x1110de(0x120))var _0x7afe70=users[_0x1110de(0xe9)];}}}}}}}_0x2a310c[_0x1110de(0x110)](_0x1110de(0xfb),{'success':_0x4ff0a3[_0x1110de(0x11e)](_0x1110de(0xe5)),'errors':_0x4ff0a3['flash'](_0x1110de(0x10a)),'role':_0xaea9e2,'profile':_0x15aa26,'master_shop':_0x21d4eb,'user':_0x143b79,'language':_0x7afe70});}catch(_0x3df90d){console[_0x1110de(0x107)](_0x3df90d);}}),router[a0_0x532b7b(0xcf)](a0_0x532b7b(0xcd),auth,async(_0x53b426,_0x39eaf5)=>{const _0x171981=a0_0x532b7b;try{const {username:_0x288f4a,email:_0x3a2f1d,role:_0x36c824}=_0x53b426[_0x171981(0x131)],_0x271bd3=_0x53b426[_0x171981(0x131)],_0x31d17b=await profile[_0x171981(0x10c)]({'email':_0x271bd3[_0x171981(0xcc)]}),_0x4f9f2e=await product[_0x171981(0x124)]({}),_0x120cc0=await master_shop['find'](),_0x231095=_0x53b426[_0x171981(0x10b)]['id'],_0x5a9a94=await purchases_return_finished[_0x171981(0xf6)](_0x231095),_0x2f3051=await warehouse[_0x171981(0xfa)]([{'$match':{'name':_0x5a9a94[_0x171981(0x12e)],'room':_0x5a9a94[_0x171981(0x12c)],'warehouse_category':_0x171981(0x115)}},{'$unwind':_0x171981(0x113)},{'$group':{'_id':_0x171981(0x12a),'name':{'$first':_0x171981(0x111)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x171981(0xce)},'bin':{'$first':_0x171981(0x125)},'type':{'$first':_0x171981(0xdd)},'floorlevel':{'$first':_0x171981(0xed)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x171981(0x117)},'storage':{'$first':_0x171981(0x114)},'rack':{'$first':_0x171981(0xd1)}}}]);warehouse_data=await warehouse[_0x171981(0xfa)]([{'$match':{'status':_0x171981(0x116),'name':_0x171981(0xee),'warehouse_category':_0x171981(0x115)}},{'$group':{'_id':_0x171981(0xd9),'name':{'$first':_0x171981(0xd9)}}},{'$sort':{'name':0x1}}]),console[_0x171981(0x107)](_0x171981(0xd5),_0x2f3051);if(_0x120cc0[0x0][_0x171981(0xc5)]=='English\x20(US)'){var _0x20763e=users['English'];console['log'](_0x20763e);}else{if(_0x120cc0[0x0][_0x171981(0xc5)]==_0x171981(0xd7))var _0x20763e=users[_0x171981(0xd7)];else{if(_0x120cc0[0x0][_0x171981(0xc5)]==_0x171981(0xd2))var _0x20763e=users[_0x171981(0xd2)];else{if(_0x120cc0[0x0]['language']==_0x171981(0x134))var _0x20763e=users[_0x171981(0x134)];else{if(_0x120cc0[0x0][_0x171981(0xc5)]==_0x171981(0xe7))var _0x20763e=users['French'];else{if(_0x120cc0[0x0]['language']=='Portuguese\x20(BR)')var _0x20763e=users['Portuguese'];else{if(_0x120cc0[0x0]['language']==_0x171981(0x11c))var _0x20763e=users[_0x171981(0x11c)];else{if(_0x120cc0[0x0]['language']==_0x171981(0x120))var _0x20763e=users['Arabic'];}}}}}}}_0x39eaf5[_0x171981(0x110)]('return_purchase_edit_finished',{'success':_0x53b426['flash'](_0x171981(0xe5)),'errors':_0x53b426[_0x171981(0x11e)]('errors'),'role':_0x271bd3,'master_shop':_0x120cc0,'profile':_0x31d17b,'user':_0x5a9a94,'stock':_0x2f3051,'product':_0x4f9f2e,'language':_0x20763e,'warehouse':warehouse_data});}catch(_0x420eeb){console[_0x171981(0x107)](_0x420eeb);}}),router[a0_0x532b7b(0xdc)]('/view/:id',auth,async(_0x534061,_0x5463ea)=>{const _0x52306b=a0_0x532b7b;try{const _0x554db0=_0x534061[_0x52306b(0x10b)]['id'],_0x460242=await purchases_return_finished[_0x52306b(0x10c)]({'invoice':_0x534061[_0x52306b(0x106)][_0x52306b(0x102)]}),_0x6fe712=await warehouse[_0x52306b(0x10c)]({'name':_0x460242[_0x52306b(0x103)],'room':_0x460242[_0x52306b(0xe3)],'warehouse_category':_0x52306b(0x115)}),{invoice:_0x3f3294,suppliers:_0x1f1283,date:_0xd6fafb,warehouse_name:_0x43dcb2,product_name:_0x2f18c8,purchase_quantity:_0x1bf3e9,stocks:_0xbf7969,return_qty:_0x5328d6,note:_0x1b2c9d,Room_name:_0x5dac1f,level:_0x4da514,isle:_0x2cd74a,pallet:_0x1f8d9d,to_warehouse_name:_0x4bed6c,to_Room_name:_0x336c25}=_0x534061[_0x52306b(0x106)];if(typeof _0x2f18c8==_0x52306b(0xe4))var _0x4179f4=[_0x534061['body'][_0x52306b(0x12d)]],_0x286bc7=[_0x534061[_0x52306b(0x106)][_0x52306b(0x11b)]],_0x2b2d87=[_0x534061['body'][_0x52306b(0x121)]],_0x477f0c=[_0x534061['body'][_0x52306b(0x128)]],_0x49d486=[_0x534061[_0x52306b(0x106)]['level']],_0x2abba9=[_0x534061[_0x52306b(0x106)][_0x52306b(0x104)]],_0x2871ce=[_0x534061[_0x52306b(0x106)][_0x52306b(0xe2)]],_0x5ce597=[_0x534061[_0x52306b(0x106)]['secondary_code_hide']];else var _0x4179f4=[..._0x534061['body'][_0x52306b(0x12d)]],_0x286bc7=[..._0x534061[_0x52306b(0x106)]['purchase_quantity']],_0x2b2d87=[..._0x534061['body']['stocks']],_0x477f0c=[..._0x534061[_0x52306b(0x106)][_0x52306b(0x128)]],_0x49d486=[..._0x534061[_0x52306b(0x106)][_0x52306b(0x11f)]],_0x2abba9=[..._0x534061[_0x52306b(0x106)][_0x52306b(0x104)]],_0x2871ce=[..._0x534061[_0x52306b(0x106)][_0x52306b(0xe2)]],_0x5ce597=[..._0x534061[_0x52306b(0x106)][_0x52306b(0x11a)]];const _0x4dddb2=_0x4179f4[_0x52306b(0x132)](_0xe1a59f=>{return _0xe1a59f={'product_name':_0xe1a59f};});_0x286bc7[_0x52306b(0x101)]((_0x12bfe5,_0x57e5d1)=>{const _0x46dcf0=_0x52306b;_0x4dddb2[_0x57e5d1][_0x46dcf0(0x11b)]=_0x12bfe5;}),_0x2b2d87[_0x52306b(0x101)]((_0x1fe612,_0x1f0250)=>{const _0x508f15=_0x52306b;_0x4dddb2[_0x1f0250][_0x508f15(0xcb)]=_0x1fe612;}),_0x477f0c[_0x52306b(0x101)]((_0x273846,_0x3c0148)=>{const _0xd3eab2=_0x52306b;_0x4dddb2[_0x3c0148][_0xd3eab2(0x128)]=_0x273846;}),_0x49d486['forEach']((_0x3867c5,_0x354ae3)=>{const _0xc22c63=_0x52306b;_0x4dddb2[_0x354ae3][_0xc22c63(0xf4)]=_0x3867c5;}),_0x2abba9[_0x52306b(0x101)]((_0x2ecbe7,_0x4bc6a5)=>{const _0xbf7230=_0x52306b;_0x4dddb2[_0x4bc6a5][_0xbf7230(0xf5)]=_0x2ecbe7;}),_0x2871ce[_0x52306b(0x101)]((_0x5d67e0,_0xd28333)=>{_0x4dddb2[_0xd28333]['primary_code']=_0x5d67e0;}),_0x5ce597[_0x52306b(0x101)]((_0x5c9bfe,_0x316e1d)=>{const _0x47c7ef=_0x52306b;_0x4dddb2[_0x316e1d][_0x47c7ef(0xf7)]=_0x5c9bfe;});var _0x3c7cf6=0x0;_0x4dddb2[_0x52306b(0x101)](_0x569c8b=>{const _0x18cabf=_0x52306b;(parseInt(_0x569c8b[_0x18cabf(0x11b)])<parseInt(_0x569c8b[_0x18cabf(0x128)])||parseInt(_0x569c8b[_0x18cabf(0xcb)])<parseInt(_0x569c8b[_0x18cabf(0x128)]))&&_0x3c7cf6++;});if(_0x3c7cf6!=0x0)return _0x534061[_0x52306b(0x11e)](_0x52306b(0x10a),_0x52306b(0xf9)),_0x5463ea[_0x52306b(0xe6)](_0x52306b(0x12b));_0x460242[_0x52306b(0x123)][_0x52306b(0x101)](_0x14a77a=>{const _0x4c8f4c=_0x52306b;if(_0x14a77a[_0x4c8f4c(0x128)]>0x0){const _0x2b0d06=_0x6fe712['product_details'][_0x4c8f4c(0x132)](_0x11f770=>{const _0x18709d=_0x4c8f4c;_0x11f770[_0x18709d(0x12d)]==_0x14a77a[_0x18709d(0x12d)]&&_0x11f770[_0x18709d(0xf4)]==_0x14a77a[_0x18709d(0xf4)]&&(_0x11f770[_0x18709d(0xec)]=parseInt(_0x11f770[_0x18709d(0xec)])+parseInt(_0x14a77a[_0x18709d(0x128)]));});}}),await _0x6fe712['save'](),_0x460242[_0x52306b(0x102)]=_0x3f3294,_0x460242[_0x52306b(0xe1)]=_0x1f1283,_0x460242['date']=_0xd6fafb,_0x460242['warehouse_name']=_0x43dcb2,_0x460242[_0x52306b(0x123)]=_0x4dddb2,_0x460242[_0x52306b(0xf8)]=_0x1b2c9d,_0x460242[_0x52306b(0x12c)]=_0x5dac1f,_0x460242[_0x52306b(0x103)]=_0x4bed6c,_0x460242[_0x52306b(0xe3)]=_0x336c25;const _0x561f35=await _0x460242['save'](),_0x20666f=await purchases_return_finished[_0x52306b(0x10c)]({'invoice':_0x534061[_0x52306b(0x106)][_0x52306b(0x102)]}),_0x427905=await warehouse[_0x52306b(0x10c)]({'name':_0x534061[_0x52306b(0x106)][_0x52306b(0x103)],'room':_0x534061[_0x52306b(0x106)][_0x52306b(0x108)],'warehouse_category':_0x52306b(0x115)});_0x20666f['return_product'][_0x52306b(0x101)](_0x4779f1=>{_0x427905['product_details']['map'](_0x2fc23b=>{const _0x1c2187=a0_0x3dcc;_0x2fc23b['product_name']==_0x4779f1[_0x1c2187(0x12d)]&&_0x2fc23b[_0x1c2187(0xf4)]==_0x4779f1[_0x1c2187(0xf4)]&&(_0x2fc23b['product_stock']=parseInt(_0x2fc23b['product_stock'])-parseInt(_0x4779f1['return_qty']));});}),await _0x427905[_0x52306b(0xe8)]();const _0x506498=await s_payment_data[_0x52306b(0x10c)]({'invoice':_0x534061[_0x52306b(0x106)][_0x52306b(0x102)],'reason':'Purchase\x20Return'});await _0x506498['save'](),_0x534061[_0x52306b(0x11e)]('success','purchase\x20return\x20successfully'),_0x5463ea[_0x52306b(0xe6)](_0x52306b(0x11d));}catch(_0x53f4d5){console[_0x52306b(0x107)](_0x53f4d5),_0x5463ea[_0x52306b(0x10d)](0xc8)[_0x52306b(0x122)]({'message':_0x53f4d5['message']});}}),router[a0_0x532b7b(0xcf)](a0_0x532b7b(0xca),auth,async(_0x37c050,_0x5dc5c1)=>{const _0x57c886=a0_0x532b7b;try{const {username:_0x7909e9,email:_0x1e086e,role:_0x1739aa}=_0x37c050[_0x57c886(0x131)],_0x38eb83=_0x37c050[_0x57c886(0x131)],_0x5490d0=await profile[_0x57c886(0x10c)]({'email':_0x38eb83[_0x57c886(0xcc)]}),_0x242089=await master_shop[_0x57c886(0x124)]();console[_0x57c886(0x107)](_0x57c886(0x130),_0x242089);const _0x48d230=_0x37c050[_0x57c886(0x10b)]['id'],_0x21c724=await purchases_return[_0x57c886(0xf6)](_0x48d230);console[_0x57c886(0x107)](_0x21c724);const _0x4b16bf=await suppliers[_0x57c886(0x10c)]({'name':_0x21c724[_0x57c886(0xe1)]});console['log'](_0x4b16bf);if(_0x242089[0x0][_0x57c886(0xc5)]=='English\x20(US)'){var _0x444a37=users['English'];console[_0x57c886(0x107)](_0x444a37);}else{if(_0x242089[0x0][_0x57c886(0xc5)]=='Hindi')var _0x444a37=users[_0x57c886(0xd7)];else{if(_0x242089[0x0]['language']==_0x57c886(0xd2))var _0x444a37=users['German'];else{if(_0x242089[0x0][_0x57c886(0xc5)]==_0x57c886(0x134))var _0x444a37=users[_0x57c886(0x134)];else{if(_0x242089[0x0][_0x57c886(0xc5)]==_0x57c886(0xe7))var _0x444a37=users[_0x57c886(0xe7)];else{if(_0x242089[0x0][_0x57c886(0xc5)]=='Portuguese\x20(BR)')var _0x444a37=users[_0x57c886(0x10e)];else{if(_0x242089[0x0][_0x57c886(0xc5)]==_0x57c886(0x11c))var _0x444a37=users[_0x57c886(0x11c)];else{if(_0x242089[0x0][_0x57c886(0xc5)]==_0x57c886(0x120))var _0x444a37=users[_0x57c886(0xe9)];}}}}}}}_0x5dc5c1['render'](_0x57c886(0xef),{'success':_0x37c050[_0x57c886(0x11e)](_0x57c886(0xe5)),'errors':_0x37c050['flash'](_0x57c886(0x10a)),'role':_0x38eb83,'profile':_0x5490d0,'master_shop':_0x242089,'supplier':_0x4b16bf,'purchase':_0x21c724,'language':_0x444a37});}catch(_0x215ccf){console['log'](_0x215ccf);}}),router[a0_0x532b7b(0xdc)]('/receive_payment/:id',auth,async(_0x3e4c7f,_0x15d4c8)=>{const _0x3ef76f=a0_0x532b7b;try{const _0x1f26e3=_0x3e4c7f[_0x3ef76f(0x10b)]['id'],{invoice:_0x41c7ad,suppliers:_0x25d082,receivable_amount:_0x5c29be,received_amount:_0x58aadb}=_0x3e4c7f[_0x3ef76f(0x106)],_0x28f737=await purchases_return[_0x3ef76f(0xf6)](_0x1f26e3);console['log'](_0x28f737);var _0x4c44e1=_0x5c29be-_0x58aadb;console[_0x3ef76f(0x107)](_0x58aadb),_0x28f737[_0x3ef76f(0x126)]=parseFloat(_0x58aadb)+parseFloat(_0x28f737[_0x3ef76f(0x126)]),_0x28f737[_0x3ef76f(0x100)]=_0x4c44e1,console['log'](_0x28f737);const _0x3dde14=await _0x28f737[_0x3ef76f(0xe8)](),_0x4c3fd5=await s_payment_data[_0x3ef76f(0x10c)]({'invoice':_0x3e4c7f[_0x3ef76f(0x106)][_0x3ef76f(0x102)],'reason':_0x3ef76f(0x109)});_0x4c3fd5['amount']=_0x4c44e1,await _0x4c3fd5[_0x3ef76f(0xe8)]();let _0x1fd76a=new Date(),_0x240535=('0'+_0x1fd76a['getDate']())['slice'](-0x2),_0x437a4b=('0'+(_0x1fd76a[_0x3ef76f(0x118)]()+0x1))[_0x3ef76f(0xc4)](-0x2),_0x2d4d08=_0x1fd76a[_0x3ef76f(0xf1)](),_0x1f77ca=_0x2d4d08+'-'+_0x437a4b+'-'+_0x240535;const _0x505f82=new suppliers_payment({'invoice':_0x41c7ad,'date':_0x2d4d08+'-'+_0x437a4b+'-'+_0x240535,'suppliers':_0x25d082,'reason':'Received\x20For\x20Purchase\x20Return','amount':_0x58aadb}),_0x40d8bc=await _0x505f82[_0x3ef76f(0xe8)]();_0x3e4c7f[_0x3ef76f(0x11e)](_0x3ef76f(0xe5),_0x3ef76f(0xf0)),_0x15d4c8['redirect']('/purchases_return/view');}catch(_0x341e14){console['log'](_0x341e14);}}),module[a0_0x532b7b(0xeb)]=router;function a0_0xe254(){const _0x2e2e9a=['room','product_name','warehouse_name','$note','master','user','map','$due_amount','Spanish','Portuguese\x20(BR)','slice','language','$_id','English\x20(US)','express','7195636eqdqIT','/invoice/:id','stock_quantity','email','/view/:id','$product_details.bay','get','$received','$product_details.rack','German','1111302hqLDWn','5xaNjgR','stock_data','$return_product','Hindi','3685068qrZkzT','$name','$return_product.price','3178494CDTuKz','post','$product_details.type','Router','$return_product.return_qty','$return_product.total','suppliers','primary_code_hide','to_room','string','success','redirect','French','save','Arabic','$supplier_docs','exports','product_stock','$product_details.floorlevel','Return\x20Goods','return_purchase_invoice','payment\x20successfull','getFullYear','$suppliers','English','bay','product_code','findById','secondary_code','note','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','aggregate','purchases_return_finished','7208296GduYOW','344247ttyEml','$total_amount','1382788SyFmMO','due_amount','forEach','invoice','to_warehouse_name','product_code_hide','../public/language/languages.json','body','log','to_Room_name','Purchase\x20Return','errors','params','findOne','status','Portuguese','../middleware/auth','render','$product_details.product_name','$receivable','$product_details','$product_details.storage','Finished\x20Goods','Enabled','$product_details.product_code','getMonth','$invoice','secondary_code_hide','purchase_quantity','Chinese','/purchases_return_finished/view','flash','level','Arabic\x20(ae)','stocks','json','return_product','find','$product_details.bin','received','$warehouse_name','return_qty','$supplier_docs.address','$product_details._id','back'];a0_0xe254=function(){return _0x2e2e9a;};return a0_0xe254();}