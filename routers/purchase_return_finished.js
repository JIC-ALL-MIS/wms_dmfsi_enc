const a0_0x162bc7=a0_0x18ae;function a0_0x4e92(){const _0x3115f6=['768811AmfoIS','post','11169795YjeqAq','6974500BKMXTp','$date','primary_code_hide','flash','json','$supplier_docs.address','$product_details._id','/view','product_details','warehouse_name','product_name','$product_details.primary_code','purchases_return_finished','$product_details.product_name','58098GpVANv','log','../models/all_models','render','4559442oLuJHG','$name','$supplier_docs','$supplier_docs.email','findOne','email','$warehouse_name','$product_details.floorlevel','$total_amount','find','purchase\x20return\x20successfully','Finished\x20Goods','Portuguese','body','$receivable','product_code','$product_details.secondary_code','getMonth','stock_quantity','received','$note','purchase_quantity','Chinese','to_Room_name','message','$return_product.product_name','suppliers','supplier_docs','errors','findById','$return_product.return_qty','Purchase\x20Return','user','$supplier_docs.mobile','level','return_qty','Hindi','French','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Arabic','secondary_code','status','Router','redirect','$return_product.total','German','stocks','return_purchase_edit_finished','Enabled','English','to_warehouse_name','English\x20(US)','378aRvkLm','date','Arabic\x20(ae)','get','map','string','product_stock','secondary_code_hide','bay','219888MaYMMM','params','Return\x20Goods','aggregate','$due_amount','153IUAUzo','$product_details.type','product_code_hide','Spanish','exports','due_amount','/purchases_return/view','save','../public/language/languages.json','$product_details.bay','Portuguese\x20(BR)','express','room','stock_data','$suppliers','back','language','5838328sRluDj','$received','$return_product.price','success','getDate','name','$invoice','$_id','forEach','Received\x20For\x20Purchase\x20Return','invoice','return_product','payment\x20successfull','/view/:id','$product_details.product_code','master','to_room'];a0_0x4e92=function(){return _0x3115f6;};return a0_0x4e92();}(function(_0x7b8c23,_0x4fb99e){const _0x576294=a0_0x18ae,_0x161811=_0x7b8c23();while(!![]){try{const _0x2fbd63=parseInt(_0x576294(0x18d))/0x1+-parseInt(_0x576294(0x19e))/0x2*(-parseInt(_0x576294(0x16b))/0x3)+-parseInt(_0x576294(0x17c))/0x4+parseInt(_0x576294(0x190))/0x5+-parseInt(_0x576294(0x1a2))/0x6+-parseInt(_0x576294(0x18f))/0x7+parseInt(_0x576294(0x166))/0x8*(parseInt(_0x576294(0x15d))/0x9);if(_0x2fbd63===_0x4fb99e)break;else _0x161811['push'](_0x161811['shift']());}catch(_0x3fa36b){_0x161811['push'](_0x161811['shift']());}}}(a0_0x4e92,0xf0580));function a0_0x18ae(_0x952372,_0x32df13){const _0x4e9286=a0_0x4e92();return a0_0x18ae=function(_0x18aeb7,_0x55e571){_0x18aeb7=_0x18aeb7-0x14c;let _0x7eaeed=_0x4e9286[_0x18aeb7];return _0x7eaeed;},a0_0x18ae(_0x952372,_0x32df13);}const express=require(a0_0x162bc7(0x176)),app=express(),router=express[a0_0x162bc7(0x153)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require(a0_0x162bc7(0x1a0)),auth=require('../middleware/auth'),users=require(a0_0x162bc7(0x173));router[a0_0x162bc7(0x160)](a0_0x162bc7(0x197),auth,async(_0x464ea6,_0x52bcb3)=>{const _0x4da476=a0_0x162bc7;try{const {username:_0x194a09,email:_0x3227ef,role:_0x3b1796}=_0x464ea6[_0x4da476(0x1c2)],_0xc5ed63=_0x464ea6['user'],_0x27d8f4=await profile[_0x4da476(0x1a6)]({'email':_0xc5ed63[_0x4da476(0x1a7)]}),_0x5c45bd=await master_shop['find']();console['log'](_0x4da476(0x18b),_0x5c45bd);const _0x459fd0=await purchases_return_finished[_0x4da476(0x169)]([{'$lookup':{'from':_0x4da476(0x1bc),'localField':_0x4da476(0x1bc),'foreignField':_0x4da476(0x181),'as':_0x4da476(0x1bd)}},{'$unwind':'$return_product'},{'$unwind':_0x4da476(0x1a4)},{'$group':{'_id':_0x4da476(0x183),'invoice':{'$first':_0x4da476(0x182)},'date':{'$first':_0x4da476(0x191)},'suppliers':{'$first':_0x4da476(0x179)},'warehouse_name':{'$first':_0x4da476(0x1a8)},'product_name':{'$first':_0x4da476(0x1bb)},'return_qty':{'$first':_0x4da476(0x1c0)},'price':{'$first':_0x4da476(0x17e)},'total':{'$sum':_0x4da476(0x155)},'note':{'$first':_0x4da476(0x1b6)},'total_amount':{'$first':_0x4da476(0x1aa)},'discount':{'$first':'$discount'},'receivable':{'$first':_0x4da476(0x1b0)},'received':{'$first':_0x4da476(0x17d)},'due_amount':{'$first':_0x4da476(0x16a)},'mobile':{'$first':_0x4da476(0x1c3)},'email':{'$first':_0x4da476(0x1a5)},'address':{'$first':_0x4da476(0x195)},'return_sum_qty':{'$sum':_0x4da476(0x1c0)}}}]);console[_0x4da476(0x19f)](_0x459fd0);if(_0x5c45bd[0x0][_0x4da476(0x17b)]==_0x4da476(0x15c)){var _0x5aaf11=users[_0x4da476(0x15a)];console[_0x4da476(0x19f)](_0x5aaf11);}else{if(_0x5c45bd[0x0]['language']=='Hindi')var _0x5aaf11=users['Hindi'];else{if(_0x5c45bd[0x0][_0x4da476(0x17b)]==_0x4da476(0x156))var _0x5aaf11=users['German'];else{if(_0x5c45bd[0x0][_0x4da476(0x17b)]=='Spanish')var _0x5aaf11=users['Spanish'];else{if(_0x5c45bd[0x0][_0x4da476(0x17b)]=='French')var _0x5aaf11=users[_0x4da476(0x14e)];else{if(_0x5c45bd[0x0][_0x4da476(0x17b)]==_0x4da476(0x175))var _0x5aaf11=users[_0x4da476(0x1ae)];else{if(_0x5c45bd[0x0][_0x4da476(0x17b)]==_0x4da476(0x1b8))var _0x5aaf11=users[_0x4da476(0x1b8)];else{if(_0x5c45bd[0x0][_0x4da476(0x17b)]==_0x4da476(0x15f))var _0x5aaf11=users[_0x4da476(0x150)];}}}}}}}_0x52bcb3[_0x4da476(0x1a1)](_0x4da476(0x19c),{'success':_0x464ea6[_0x4da476(0x193)](_0x4da476(0x17f)),'errors':_0x464ea6[_0x4da476(0x193)]('errors'),'role':_0xc5ed63,'profile':_0x27d8f4,'master_shop':_0x5c45bd,'user':_0x459fd0,'language':_0x5aaf11});}catch(_0x9fda27){console[_0x4da476(0x19f)](_0x9fda27);}}),router['get'](a0_0x162bc7(0x189),auth,async(_0x2b0550,_0x15ccf1)=>{const _0x43fea5=a0_0x162bc7;try{const {username:_0x3f6115,email:_0x1586e6,role:_0x7aae02}=_0x2b0550['user'],_0x3246e0=_0x2b0550[_0x43fea5(0x1c2)],_0x14256f=await profile['findOne']({'email':_0x3246e0[_0x43fea5(0x1a7)]}),_0x2af810=await product[_0x43fea5(0x1ab)]({}),_0x5173d5=await master_shop[_0x43fea5(0x1ab)](),_0x43b8a9=_0x2b0550['params']['id'],_0x65e5cb=await purchases_return_finished['findById'](_0x43b8a9),_0x38a0e3=await warehouse[_0x43fea5(0x169)]([{'$match':{'name':_0x65e5cb[_0x43fea5(0x199)],'room':_0x65e5cb[_0x43fea5(0x177)],'warehouse_category':_0x43fea5(0x1ad)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x43fea5(0x196),'name':{'$first':_0x43fea5(0x19d)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x43fea5(0x174)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x43fea5(0x16c)},'floorlevel':{'$first':_0x43fea5(0x1a9)},'primary_code':{'$first':_0x43fea5(0x19b)},'secondary_code':{'$first':_0x43fea5(0x1b2)},'product_code':{'$first':_0x43fea5(0x18a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x43fea5(0x169)]([{'$match':{'status':_0x43fea5(0x159),'name':_0x43fea5(0x168),'warehouse_category':_0x43fea5(0x1ad)}},{'$group':{'_id':_0x43fea5(0x1a3),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x43fea5(0x19f)](_0x43fea5(0x178),_0x38a0e3);if(_0x5173d5[0x0]['language']==_0x43fea5(0x15c)){var _0x65df00=users[_0x43fea5(0x15a)];console[_0x43fea5(0x19f)](_0x65df00);}else{if(_0x5173d5[0x0][_0x43fea5(0x17b)]=='Hindi')var _0x65df00=users['Hindi'];else{if(_0x5173d5[0x0][_0x43fea5(0x17b)]==_0x43fea5(0x156))var _0x65df00=users[_0x43fea5(0x156)];else{if(_0x5173d5[0x0][_0x43fea5(0x17b)]=='Spanish')var _0x65df00=users[_0x43fea5(0x16e)];else{if(_0x5173d5[0x0][_0x43fea5(0x17b)]=='French')var _0x65df00=users[_0x43fea5(0x14e)];else{if(_0x5173d5[0x0][_0x43fea5(0x17b)]==_0x43fea5(0x175))var _0x65df00=users[_0x43fea5(0x1ae)];else{if(_0x5173d5[0x0][_0x43fea5(0x17b)]==_0x43fea5(0x1b8))var _0x65df00=users[_0x43fea5(0x1b8)];else{if(_0x5173d5[0x0][_0x43fea5(0x17b)]==_0x43fea5(0x15f))var _0x65df00=users[_0x43fea5(0x150)];}}}}}}}_0x15ccf1['render'](_0x43fea5(0x158),{'success':_0x2b0550[_0x43fea5(0x193)](_0x43fea5(0x17f)),'errors':_0x2b0550[_0x43fea5(0x193)]('errors'),'role':_0x3246e0,'master_shop':_0x5173d5,'profile':_0x14256f,'user':_0x65e5cb,'stock':_0x38a0e3,'product':_0x2af810,'language':_0x65df00,'warehouse':warehouse_data});}catch(_0x3ca63c){console['log'](_0x3ca63c);}}),router[a0_0x162bc7(0x18e)]('/view/:id',auth,async(_0x321434,_0x53e83d)=>{const _0x2418ab=a0_0x162bc7;try{const _0xce7bab=_0x321434[_0x2418ab(0x167)]['id'],_0x534e3f=await purchases_return_finished[_0x2418ab(0x1a6)]({'invoice':_0x321434[_0x2418ab(0x1af)][_0x2418ab(0x186)]}),_0x44692d=await warehouse[_0x2418ab(0x1a6)]({'name':_0x534e3f[_0x2418ab(0x15b)],'room':_0x534e3f[_0x2418ab(0x18c)],'warehouse_category':_0x2418ab(0x1ad)}),{invoice:_0x595b79,suppliers:_0xe142e8,date:_0xfd5cc6,warehouse_name:_0x529877,product_name:_0x52b722,purchase_quantity:_0x54f35b,stocks:_0xee660b,return_qty:_0x35fd03,note:_0x4905d6,Room_name:_0xc6670c,level:_0x18ca72,isle:_0x21b1a5,pallet:_0x34988b,to_warehouse_name:_0x50eead,to_Room_name:_0x4bd449}=_0x321434['body'];if(typeof _0x52b722==_0x2418ab(0x162))var _0x86593e=[_0x321434[_0x2418ab(0x1af)]['product_name']],_0x3c17d1=[_0x321434[_0x2418ab(0x1af)][_0x2418ab(0x1b7)]],_0x50d61a=[_0x321434['body']['stocks']],_0x597982=[_0x321434['body'][_0x2418ab(0x14c)]],_0x363f34=[_0x321434['body'][_0x2418ab(0x1c4)]],_0x2ab164=[_0x321434['body']['product_code_hide']],_0x2aa9e5=[_0x321434[_0x2418ab(0x1af)]['primary_code_hide']],_0x45087c=[_0x321434[_0x2418ab(0x1af)][_0x2418ab(0x164)]];else var _0x86593e=[..._0x321434[_0x2418ab(0x1af)][_0x2418ab(0x19a)]],_0x3c17d1=[..._0x321434['body']['purchase_quantity']],_0x50d61a=[..._0x321434[_0x2418ab(0x1af)][_0x2418ab(0x157)]],_0x597982=[..._0x321434[_0x2418ab(0x1af)]['return_qty']],_0x363f34=[..._0x321434['body'][_0x2418ab(0x1c4)]],_0x2ab164=[..._0x321434[_0x2418ab(0x1af)][_0x2418ab(0x16d)]],_0x2aa9e5=[..._0x321434[_0x2418ab(0x1af)][_0x2418ab(0x192)]],_0x45087c=[..._0x321434['body'][_0x2418ab(0x164)]];const _0x4ee182=_0x86593e[_0x2418ab(0x161)](_0x5401e6=>{return _0x5401e6={'product_name':_0x5401e6};});_0x3c17d1['forEach']((_0x287ce1,_0x4bb848)=>{const _0x4b281e=_0x2418ab;_0x4ee182[_0x4bb848][_0x4b281e(0x1b7)]=_0x287ce1;}),_0x50d61a[_0x2418ab(0x184)]((_0x238a7c,_0x51e03e)=>{const _0x64411a=_0x2418ab;_0x4ee182[_0x51e03e][_0x64411a(0x1b4)]=_0x238a7c;}),_0x597982[_0x2418ab(0x184)]((_0x4a1120,_0x4f4426)=>{const _0x24885f=_0x2418ab;_0x4ee182[_0x4f4426][_0x24885f(0x14c)]=_0x4a1120;}),_0x363f34[_0x2418ab(0x184)]((_0x1d3519,_0x489813)=>{_0x4ee182[_0x489813]['bay']=_0x1d3519;}),_0x2ab164[_0x2418ab(0x184)]((_0x2a2314,_0x106f5b)=>{const _0x5d7f62=_0x2418ab;_0x4ee182[_0x106f5b][_0x5d7f62(0x1b1)]=_0x2a2314;}),_0x2aa9e5[_0x2418ab(0x184)]((_0xe4cc77,_0x1b3d98)=>{_0x4ee182[_0x1b3d98]['primary_code']=_0xe4cc77;}),_0x45087c[_0x2418ab(0x184)]((_0x2bccd6,_0x4d5067)=>{const _0x4eca37=_0x2418ab;_0x4ee182[_0x4d5067][_0x4eca37(0x151)]=_0x2bccd6;});var _0x5ef1c3=0x0;_0x4ee182['forEach'](_0x2175ef=>{const _0x552464=_0x2418ab;(parseInt(_0x2175ef[_0x552464(0x1b7)])<parseInt(_0x2175ef[_0x552464(0x14c)])||parseInt(_0x2175ef[_0x552464(0x1b4)])<parseInt(_0x2175ef['return_qty']))&&_0x5ef1c3++;});if(_0x5ef1c3!=0x0)return _0x321434['flash'](_0x2418ab(0x1be),_0x2418ab(0x14f)),_0x53e83d[_0x2418ab(0x154)](_0x2418ab(0x17a));_0x534e3f[_0x2418ab(0x187)]['forEach'](_0x2c9a09=>{const _0x1ca331=_0x2418ab;if(_0x2c9a09[_0x1ca331(0x14c)]>0x0){const _0xe3a8f1=_0x44692d[_0x1ca331(0x198)][_0x1ca331(0x161)](_0x2fa825=>{const _0x3e6171=_0x1ca331;_0x2fa825[_0x3e6171(0x19a)]==_0x2c9a09[_0x3e6171(0x19a)]&&_0x2fa825['bay']==_0x2c9a09[_0x3e6171(0x165)]&&(_0x2fa825['product_stock']=parseInt(_0x2fa825[_0x3e6171(0x163)])+parseInt(_0x2c9a09['return_qty']));});}}),await _0x44692d[_0x2418ab(0x172)](),_0x534e3f[_0x2418ab(0x186)]=_0x595b79,_0x534e3f[_0x2418ab(0x1bc)]=_0xe142e8,_0x534e3f[_0x2418ab(0x15e)]=_0xfd5cc6,_0x534e3f['warehouse_name']=_0x529877,_0x534e3f['return_product']=_0x4ee182,_0x534e3f['note']=_0x4905d6,_0x534e3f[_0x2418ab(0x177)]=_0xc6670c,_0x534e3f[_0x2418ab(0x15b)]=_0x50eead,_0x534e3f[_0x2418ab(0x18c)]=_0x4bd449;const _0x4aa215=await _0x534e3f[_0x2418ab(0x172)](),_0x1a422d=await purchases_return_finished['findOne']({'invoice':_0x321434[_0x2418ab(0x1af)][_0x2418ab(0x186)]}),_0x58747e=await warehouse[_0x2418ab(0x1a6)]({'name':_0x321434[_0x2418ab(0x1af)][_0x2418ab(0x15b)],'room':_0x321434[_0x2418ab(0x1af)][_0x2418ab(0x1b9)],'warehouse_category':_0x2418ab(0x1ad)});_0x1a422d[_0x2418ab(0x187)][_0x2418ab(0x184)](_0x252613=>{const _0x1c7fa7=_0x2418ab;_0x58747e['product_details'][_0x1c7fa7(0x161)](_0x49f26b=>{const _0x1a6bf3=_0x1c7fa7;_0x49f26b[_0x1a6bf3(0x19a)]==_0x252613[_0x1a6bf3(0x19a)]&&_0x49f26b[_0x1a6bf3(0x165)]==_0x252613['bay']&&(_0x49f26b['product_stock']=parseInt(_0x49f26b[_0x1a6bf3(0x163)])-parseInt(_0x252613[_0x1a6bf3(0x14c)]));});}),await _0x58747e[_0x2418ab(0x172)]();const _0x1ba96b=await s_payment_data['findOne']({'invoice':_0x321434[_0x2418ab(0x1af)][_0x2418ab(0x186)],'reason':'Purchase\x20Return'});await _0x1ba96b[_0x2418ab(0x172)](),_0x321434[_0x2418ab(0x193)](_0x2418ab(0x17f),_0x2418ab(0x1ac)),_0x53e83d[_0x2418ab(0x154)]('/purchases_return_finished/view');}catch(_0x2d1fbb){console[_0x2418ab(0x19f)](_0x2d1fbb),_0x53e83d[_0x2418ab(0x152)](0xc8)[_0x2418ab(0x194)]({'message':_0x2d1fbb[_0x2418ab(0x1ba)]});}}),router[a0_0x162bc7(0x160)]('/invoice/:id',auth,async(_0xecc233,_0x469741)=>{const _0x34530d=a0_0x162bc7;try{const {username:_0x214c47,email:_0x55b31c,role:_0x43ca71}=_0xecc233['user'],_0x2f6814=_0xecc233[_0x34530d(0x1c2)],_0x513e29=await profile[_0x34530d(0x1a6)]({'email':_0x2f6814[_0x34530d(0x1a7)]}),_0xb99ce3=await master_shop[_0x34530d(0x1ab)]();console[_0x34530d(0x19f)](_0x34530d(0x18b),_0xb99ce3);const _0x4a7c96=_0xecc233[_0x34530d(0x167)]['id'],_0xf73127=await purchases_return[_0x34530d(0x1bf)](_0x4a7c96);console[_0x34530d(0x19f)](_0xf73127);const _0x260d61=await suppliers['findOne']({'name':_0xf73127[_0x34530d(0x1bc)]});console[_0x34530d(0x19f)](_0x260d61);if(_0xb99ce3[0x0]['language']=='English\x20(US)'){var _0x408540=users[_0x34530d(0x15a)];console[_0x34530d(0x19f)](_0x408540);}else{if(_0xb99ce3[0x0][_0x34530d(0x17b)]=='Hindi')var _0x408540=users[_0x34530d(0x14d)];else{if(_0xb99ce3[0x0][_0x34530d(0x17b)]==_0x34530d(0x156))var _0x408540=users['German'];else{if(_0xb99ce3[0x0][_0x34530d(0x17b)]==_0x34530d(0x16e))var _0x408540=users[_0x34530d(0x16e)];else{if(_0xb99ce3[0x0][_0x34530d(0x17b)]==_0x34530d(0x14e))var _0x408540=users[_0x34530d(0x14e)];else{if(_0xb99ce3[0x0][_0x34530d(0x17b)]==_0x34530d(0x175))var _0x408540=users[_0x34530d(0x1ae)];else{if(_0xb99ce3[0x0][_0x34530d(0x17b)]==_0x34530d(0x1b8))var _0x408540=users[_0x34530d(0x1b8)];else{if(_0xb99ce3[0x0][_0x34530d(0x17b)]==_0x34530d(0x15f))var _0x408540=users[_0x34530d(0x150)];}}}}}}}_0x469741[_0x34530d(0x1a1)]('return_purchase_invoice',{'success':_0xecc233['flash'](_0x34530d(0x17f)),'errors':_0xecc233['flash']('errors'),'role':_0x2f6814,'profile':_0x513e29,'master_shop':_0xb99ce3,'supplier':_0x260d61,'purchase':_0xf73127,'language':_0x408540});}catch(_0x51589f){console[_0x34530d(0x19f)](_0x51589f);}}),router[a0_0x162bc7(0x18e)]('/receive_payment/:id',auth,async(_0x5c42b6,_0x1e5685)=>{const _0x569717=a0_0x162bc7;try{const _0x318ac9=_0x5c42b6[_0x569717(0x167)]['id'],{invoice:_0x394c81,suppliers:_0x1d0a4c,receivable_amount:_0x385418,received_amount:_0x21dd81}=_0x5c42b6[_0x569717(0x1af)],_0x4de5fe=await purchases_return[_0x569717(0x1bf)](_0x318ac9);console['log'](_0x4de5fe);var _0xe9f8d0=_0x385418-_0x21dd81;console[_0x569717(0x19f)](_0x21dd81),_0x4de5fe['received']=parseFloat(_0x21dd81)+parseFloat(_0x4de5fe[_0x569717(0x1b5)]),_0x4de5fe[_0x569717(0x170)]=_0xe9f8d0,console[_0x569717(0x19f)](_0x4de5fe);const _0x52ace9=await _0x4de5fe[_0x569717(0x172)](),_0x53540b=await s_payment_data[_0x569717(0x1a6)]({'invoice':_0x5c42b6[_0x569717(0x1af)][_0x569717(0x186)],'reason':_0x569717(0x1c1)});_0x53540b['amount']=_0xe9f8d0,await _0x53540b[_0x569717(0x172)]();let _0x23b9a0=new Date(),_0x4323a0=('0'+_0x23b9a0[_0x569717(0x180)]())['slice'](-0x2),_0x3aa751=('0'+(_0x23b9a0[_0x569717(0x1b3)]()+0x1))['slice'](-0x2),_0x4af0d4=_0x23b9a0['getFullYear'](),_0x45451e=_0x4af0d4+'-'+_0x3aa751+'-'+_0x4323a0;const _0x2d2901=new suppliers_payment({'invoice':_0x394c81,'date':_0x4af0d4+'-'+_0x3aa751+'-'+_0x4323a0,'suppliers':_0x1d0a4c,'reason':_0x569717(0x185),'amount':_0x21dd81}),_0x5d9d26=await _0x2d2901[_0x569717(0x172)]();_0x5c42b6[_0x569717(0x193)](_0x569717(0x17f),_0x569717(0x188)),_0x1e5685[_0x569717(0x154)](_0x569717(0x171));}catch(_0x480ab1){console[_0x569717(0x19f)](_0x480ab1);}}),module[a0_0x162bc7(0x16f)]=router;