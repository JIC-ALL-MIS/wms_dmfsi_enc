const a0_0x2273bf=a0_0x993e;(function(_0x5339e4,_0x15db63){const _0x1ade79=a0_0x993e,_0x620b41=_0x5339e4();while(!![]){try{const _0x8279bd=-parseInt(_0x1ade79(0x7c))/0x1+parseInt(_0x1ade79(0x9f))/0x2+-parseInt(_0x1ade79(0xad))/0x3+parseInt(_0x1ade79(0x82))/0x4*(-parseInt(_0x1ade79(0xcc))/0x5)+-parseInt(_0x1ade79(0x7d))/0x6*(parseInt(_0x1ade79(0xe6))/0x7)+parseInt(_0x1ade79(0xdd))/0x8*(parseInt(_0x1ade79(0xb6))/0x9)+parseInt(_0x1ade79(0xc8))/0xa*(parseInt(_0x1ade79(0xe5))/0xb);if(_0x8279bd===_0x15db63)break;else _0x620b41['push'](_0x620b41['shift']());}catch(_0x564a71){_0x620b41['push'](_0x620b41['shift']());}}}(a0_0x2708,0x9a065));const express=require(a0_0x2273bf(0xe7)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require(a0_0x2273bf(0xcd)),auth=require('../middleware/auth'),users=require('../public/language/languages.json');router['get'](a0_0x2273bf(0xee),auth,async(_0x536ac1,_0x4aa8dc)=>{const _0x42f942=a0_0x2273bf;try{const {username:_0x2fd4ee,email:_0x4a53f8,role:_0x402855}=_0x536ac1['user'],_0x4b473c=_0x536ac1['user'],_0x469d84=await profile[_0x42f942(0xda)]({'email':_0x4b473c['email']}),_0x31e630=await master_shop[_0x42f942(0x96)]();console['log'](_0x42f942(0xa7),_0x31e630);const _0x467b6e=await purchases_return_finished[_0x42f942(0xac)]([{'$lookup':{'from':_0x42f942(0x8c),'localField':_0x42f942(0x8c),'foreignField':_0x42f942(0xbc),'as':_0x42f942(0xdf)}},{'$unwind':'$return_product'},{'$unwind':_0x42f942(0xec)},{'$group':{'_id':'$_id','invoice':{'$first':_0x42f942(0x89)},'date':{'$first':'$date'},'suppliers':{'$first':_0x42f942(0x9e)},'warehouse_name':{'$first':_0x42f942(0x9c)},'product_name':{'$first':_0x42f942(0x87)},'return_qty':{'$first':'$return_product.return_qty'},'price':{'$first':_0x42f942(0xe1)},'total':{'$sum':_0x42f942(0xc6)},'note':{'$first':_0x42f942(0x80)},'total_amount':{'$first':'$total_amount'},'discount':{'$first':_0x42f942(0xb3)},'receivable':{'$first':_0x42f942(0xea)},'received':{'$first':'$received'},'due_amount':{'$first':_0x42f942(0xb0)},'mobile':{'$first':_0x42f942(0x86)},'email':{'$first':_0x42f942(0xca)},'address':{'$first':_0x42f942(0xba)},'return_sum_qty':{'$sum':_0x42f942(0x83)}}}]);console[_0x42f942(0xc9)](_0x467b6e);if(_0x31e630[0x0][_0x42f942(0x8a)]==_0x42f942(0xcf)){var _0x3e184=users[_0x42f942(0xb7)];console[_0x42f942(0xc9)](_0x3e184);}else{if(_0x31e630[0x0][_0x42f942(0x8a)]==_0x42f942(0x7a))var _0x3e184=users[_0x42f942(0x7a)];else{if(_0x31e630[0x0]['language']==_0x42f942(0xe2))var _0x3e184=users[_0x42f942(0xe2)];else{if(_0x31e630[0x0][_0x42f942(0x8a)]==_0x42f942(0xcb))var _0x3e184=users[_0x42f942(0xcb)];else{if(_0x31e630[0x0][_0x42f942(0x8a)]==_0x42f942(0xeb))var _0x3e184=users['French'];else{if(_0x31e630[0x0][_0x42f942(0x8a)]==_0x42f942(0xab))var _0x3e184=users['Portuguese'];else{if(_0x31e630[0x0][_0x42f942(0x8a)]==_0x42f942(0xe9))var _0x3e184=users[_0x42f942(0xe9)];else{if(_0x31e630[0x0][_0x42f942(0x8a)]==_0x42f942(0xf0))var _0x3e184=users[_0x42f942(0xb5)];}}}}}}}_0x4aa8dc[_0x42f942(0x9b)](_0x42f942(0xd8),{'success':_0x536ac1['flash'](_0x42f942(0x93)),'errors':_0x536ac1[_0x42f942(0xd4)](_0x42f942(0x84)),'role':_0x4b473c,'profile':_0x469d84,'master_shop':_0x31e630,'user':_0x467b6e,'language':_0x3e184});}catch(_0x293aac){console[_0x42f942(0xc9)](_0x293aac);}}),router['get']('/view/:id',auth,async(_0x1a272f,_0x24a425)=>{const _0x5b2148=a0_0x2273bf;try{const {username:_0x3768ee,email:_0x5b804f,role:_0x10d29e}=_0x1a272f[_0x5b2148(0xc4)],_0x2c1747=_0x1a272f[_0x5b2148(0xc4)],_0x3af3af=await profile['findOne']({'email':_0x2c1747[_0x5b2148(0xa0)]}),_0x295b91=await product[_0x5b2148(0x96)]({}),_0x1818db=await master_shop['find'](),_0x3d5532=_0x1a272f[_0x5b2148(0xb8)]['id'],_0x594555=await purchases_return_finished[_0x5b2148(0xa9)](_0x3d5532),_0x4a89c6=await warehouse[_0x5b2148(0xac)]([{'$match':{'name':_0x594555[_0x5b2148(0x79)],'room':_0x594555[_0x5b2148(0xdc)],'warehouse_category':_0x5b2148(0xbb)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5b2148(0xb9),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5b2148(0x9d)},'bin':{'$first':_0x5b2148(0xa4)},'type':{'$first':_0x5b2148(0xa2)},'floorlevel':{'$first':_0x5b2148(0xd6)},'primary_code':{'$first':_0x5b2148(0xe3)},'secondary_code':{'$first':_0x5b2148(0xc3)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5b2148(0xa1)},'rack':{'$first':_0x5b2148(0xef)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x5b2148(0x8b),'name':_0x5b2148(0x8d),'warehouse_category':'Finished\x20Goods'}},{'$group':{'_id':_0x5b2148(0xbd),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x5b2148(0xc9)](_0x5b2148(0x9a),_0x4a89c6);if(_0x1818db[0x0][_0x5b2148(0x8a)]==_0x5b2148(0xcf)){var _0x565fd5=users[_0x5b2148(0xb7)];console['log'](_0x565fd5);}else{if(_0x1818db[0x0][_0x5b2148(0x8a)]==_0x5b2148(0x7a))var _0x565fd5=users[_0x5b2148(0x7a)];else{if(_0x1818db[0x0][_0x5b2148(0x8a)]==_0x5b2148(0xe2))var _0x565fd5=users['German'];else{if(_0x1818db[0x0][_0x5b2148(0x8a)]==_0x5b2148(0xcb))var _0x565fd5=users[_0x5b2148(0xcb)];else{if(_0x1818db[0x0]['language']=='French')var _0x565fd5=users[_0x5b2148(0xeb)];else{if(_0x1818db[0x0][_0x5b2148(0x8a)]==_0x5b2148(0xab))var _0x565fd5=users[_0x5b2148(0xc5)];else{if(_0x1818db[0x0][_0x5b2148(0x8a)]==_0x5b2148(0xe9))var _0x565fd5=users[_0x5b2148(0xe9)];else{if(_0x1818db[0x0][_0x5b2148(0x8a)]==_0x5b2148(0xf0))var _0x565fd5=users[_0x5b2148(0xb5)];}}}}}}}_0x24a425['render'](_0x5b2148(0xb1),{'success':_0x1a272f[_0x5b2148(0xd4)](_0x5b2148(0x93)),'errors':_0x1a272f[_0x5b2148(0xd4)](_0x5b2148(0x84)),'role':_0x2c1747,'master_shop':_0x1818db,'profile':_0x3af3af,'user':_0x594555,'stock':_0x4a89c6,'product':_0x295b91,'language':_0x565fd5,'warehouse':warehouse_data});}catch(_0x57f10f){console[_0x5b2148(0xc9)](_0x57f10f);}}),router['post'](a0_0x2273bf(0xd0),auth,async(_0x18956b,_0x1e6804)=>{const _0x4e98e0=a0_0x2273bf;try{const _0x2a357d=_0x18956b[_0x4e98e0(0xb8)]['id'],_0x8db0e=await purchases_return_finished[_0x4e98e0(0xda)]({'invoice':_0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0xaf)]}),_0x6fa6a=await warehouse['findOne']({'name':_0x8db0e[_0x4e98e0(0x85)],'room':_0x8db0e[_0x4e98e0(0xa3)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x1ca39f,suppliers:_0x56998d,date:_0x2f93bd,warehouse_name:_0x30d868,product_name:_0x27cbc2,purchase_quantity:_0x47fe51,stocks:_0x54ffe4,return_qty:_0x4d348c,note:_0x45c3cd,Room_name:_0x53ff17,level:_0x550471,isle:_0xacb0ca,pallet:_0x51c269,to_warehouse_name:_0x61b775,to_Room_name:_0x220e0f}=_0x18956b[_0x4e98e0(0xc2)];if(typeof _0x27cbc2==_0x4e98e0(0x95))var _0x19a06a=[_0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0x88)]],_0x1510bb=[_0x18956b['body'][_0x4e98e0(0xe8)]],_0x118997=[_0x18956b['body'][_0x4e98e0(0xed)]],_0x512171=[_0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0xa6)]],_0x57ce9b=[_0x18956b['body'][_0x4e98e0(0x92)]],_0x556cb0=[_0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0xa5)]],_0x446225=[_0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0x91)]],_0xf95c4e=[_0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0x94)]];else var _0x19a06a=[..._0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0x88)]],_0x1510bb=[..._0x18956b['body'][_0x4e98e0(0xe8)]],_0x118997=[..._0x18956b[_0x4e98e0(0xc2)]['stocks']],_0x512171=[..._0x18956b[_0x4e98e0(0xc2)]['return_qty']],_0x57ce9b=[..._0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0x92)]],_0x556cb0=[..._0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0xa5)]],_0x446225=[..._0x18956b['body'][_0x4e98e0(0x91)]],_0xf95c4e=[..._0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0x94)]];const _0x2cd1c8=_0x19a06a[_0x4e98e0(0xae)](_0xe17005=>{return _0xe17005={'product_name':_0xe17005};});_0x1510bb['forEach']((_0x319caa,_0x48fc2c)=>{_0x2cd1c8[_0x48fc2c]['purchase_quantity']=_0x319caa;}),_0x118997[_0x4e98e0(0x7f)]((_0x398b88,_0x32fe11)=>{_0x2cd1c8[_0x32fe11]['stock_quantity']=_0x398b88;}),_0x512171[_0x4e98e0(0x7f)]((_0x295c4a,_0x28f7dd)=>{const _0x17d9da=_0x4e98e0;_0x2cd1c8[_0x28f7dd][_0x17d9da(0xa6)]=_0x295c4a;}),_0x57ce9b[_0x4e98e0(0x7f)]((_0x53182e,_0x811db1)=>{const _0x1e39e6=_0x4e98e0;_0x2cd1c8[_0x811db1][_0x1e39e6(0xe0)]=_0x53182e;}),_0x556cb0['forEach']((_0x5754a8,_0x25886e)=>{_0x2cd1c8[_0x25886e]['product_code']=_0x5754a8;}),_0x446225['forEach']((_0x1d5cdf,_0x446651)=>{const _0x58141f=_0x4e98e0;_0x2cd1c8[_0x446651][_0x58141f(0xc7)]=_0x1d5cdf;}),_0xf95c4e[_0x4e98e0(0x7f)]((_0xa52889,_0x34aa0f)=>{_0x2cd1c8[_0x34aa0f]['secondary_code']=_0xa52889;});var _0x21a619=0x0;_0x2cd1c8[_0x4e98e0(0x7f)](_0x334c2e=>{const _0x3199f5=_0x4e98e0;(parseInt(_0x334c2e[_0x3199f5(0xe8)])<parseInt(_0x334c2e[_0x3199f5(0xa6)])||parseInt(_0x334c2e[_0x3199f5(0xd5)])<parseInt(_0x334c2e[_0x3199f5(0xa6)]))&&_0x21a619++;});if(_0x21a619!=0x0)return _0x18956b['flash'](_0x4e98e0(0x84),_0x4e98e0(0xd9)),_0x1e6804[_0x4e98e0(0x81)](_0x4e98e0(0xb4));_0x8db0e['return_product'][_0x4e98e0(0x7f)](_0x59b76=>{const _0x38a1b3=_0x4e98e0;if(_0x59b76[_0x38a1b3(0xa6)]>0x0){const _0x3b8035=_0x6fa6a['product_details'][_0x38a1b3(0xae)](_0xe7d00c=>{const _0x58dbaa=_0x38a1b3;_0xe7d00c[_0x58dbaa(0x88)]==_0x59b76[_0x58dbaa(0x88)]&&_0xe7d00c[_0x58dbaa(0xe0)]==_0x59b76[_0x58dbaa(0xe0)]&&(_0xe7d00c['product_stock']=parseInt(_0xe7d00c['product_stock'])+parseInt(_0x59b76[_0x58dbaa(0xa6)]));});}}),await _0x6fa6a[_0x4e98e0(0xa8)](),_0x8db0e[_0x4e98e0(0xaf)]=_0x1ca39f,_0x8db0e[_0x4e98e0(0x8c)]=_0x56998d,_0x8db0e['date']=_0x2f93bd,_0x8db0e[_0x4e98e0(0x79)]=_0x30d868,_0x8db0e['return_product']=_0x2cd1c8,_0x8db0e['note']=_0x45c3cd,_0x8db0e[_0x4e98e0(0xdc)]=_0x53ff17,_0x8db0e[_0x4e98e0(0x85)]=_0x61b775,_0x8db0e[_0x4e98e0(0xa3)]=_0x220e0f;const _0xb870cf=await _0x8db0e[_0x4e98e0(0xa8)](),_0x487749=await purchases_return_finished[_0x4e98e0(0xda)]({'invoice':_0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0xaf)]}),_0x4b7440=await warehouse[_0x4e98e0(0xda)]({'name':_0x18956b[_0x4e98e0(0xc2)]['to_warehouse_name'],'room':_0x18956b['body'][_0x4e98e0(0xdb)],'warehouse_category':_0x4e98e0(0xbb)});_0x487749[_0x4e98e0(0xaa)][_0x4e98e0(0x7f)](_0x321bd8=>{const _0x44e0c4=_0x4e98e0;_0x4b7440[_0x44e0c4(0x7e)][_0x44e0c4(0xae)](_0x363e31=>{const _0x21597e=_0x44e0c4;_0x363e31['product_name']==_0x321bd8[_0x21597e(0x88)]&&_0x363e31['bay']==_0x321bd8[_0x21597e(0xe0)]&&(_0x363e31[_0x21597e(0x97)]=parseInt(_0x363e31[_0x21597e(0x97)])-parseInt(_0x321bd8[_0x21597e(0xa6)]));});}),await _0x4b7440[_0x4e98e0(0xa8)]();const _0x3fc405=await s_payment_data[_0x4e98e0(0xda)]({'invoice':_0x18956b[_0x4e98e0(0xc2)][_0x4e98e0(0xaf)],'reason':_0x4e98e0(0xce)});await _0x3fc405[_0x4e98e0(0xa8)](),_0x18956b[_0x4e98e0(0xd4)](_0x4e98e0(0x93),'purchase\x20return\x20successfully'),_0x1e6804[_0x4e98e0(0x81)](_0x4e98e0(0x7b));}catch(_0x4a5f77){console[_0x4e98e0(0xc9)](_0x4a5f77),_0x1e6804[_0x4e98e0(0xbf)](0xc8)[_0x4e98e0(0x8e)]({'message':_0x4a5f77[_0x4e98e0(0x99)]});}}),router[a0_0x2273bf(0xd2)]('/invoice/:id',auth,async(_0x531dd3,_0x48b89a)=>{const _0x325112=a0_0x2273bf;try{const {username:_0x146578,email:_0x4bd8e7,role:_0x279e23}=_0x531dd3[_0x325112(0xc4)],_0x4d98fc=_0x531dd3[_0x325112(0xc4)],_0x1b02bb=await profile[_0x325112(0xda)]({'email':_0x4d98fc[_0x325112(0xa0)]}),_0x3bf49c=await master_shop['find']();console['log']('master',_0x3bf49c);const _0x97e334=_0x531dd3[_0x325112(0xb8)]['id'],_0x21ee58=await purchases_return[_0x325112(0xa9)](_0x97e334);console['log'](_0x21ee58);const _0x493452=await suppliers[_0x325112(0xda)]({'name':_0x21ee58[_0x325112(0x8c)]});console[_0x325112(0xc9)](_0x493452);if(_0x3bf49c[0x0]['language']==_0x325112(0xcf)){var _0x2649d8=users[_0x325112(0xb7)];console[_0x325112(0xc9)](_0x2649d8);}else{if(_0x3bf49c[0x0][_0x325112(0x8a)]==_0x325112(0x7a))var _0x2649d8=users[_0x325112(0x7a)];else{if(_0x3bf49c[0x0][_0x325112(0x8a)]==_0x325112(0xe2))var _0x2649d8=users['German'];else{if(_0x3bf49c[0x0][_0x325112(0x8a)]==_0x325112(0xcb))var _0x2649d8=users[_0x325112(0xcb)];else{if(_0x3bf49c[0x0][_0x325112(0x8a)]==_0x325112(0xeb))var _0x2649d8=users['French'];else{if(_0x3bf49c[0x0][_0x325112(0x8a)]==_0x325112(0xab))var _0x2649d8=users[_0x325112(0xc5)];else{if(_0x3bf49c[0x0][_0x325112(0x8a)]==_0x325112(0xe9))var _0x2649d8=users[_0x325112(0xe9)];else{if(_0x3bf49c[0x0][_0x325112(0x8a)]==_0x325112(0xf0))var _0x2649d8=users[_0x325112(0xb5)];}}}}}}}_0x48b89a[_0x325112(0x9b)](_0x325112(0xbe),{'success':_0x531dd3[_0x325112(0xd4)]('success'),'errors':_0x531dd3['flash'](_0x325112(0x84)),'role':_0x4d98fc,'profile':_0x1b02bb,'master_shop':_0x3bf49c,'supplier':_0x493452,'purchase':_0x21ee58,'language':_0x2649d8});}catch(_0x39999d){console['log'](_0x39999d);}}),router[a0_0x2273bf(0x90)](a0_0x2273bf(0xc0),auth,async(_0x4d7aac,_0x47e120)=>{const _0xda3242=a0_0x2273bf;try{const _0x1412d6=_0x4d7aac[_0xda3242(0xb8)]['id'],{invoice:_0x3ea28f,suppliers:_0xbd4b74,receivable_amount:_0x2b2c8b,received_amount:_0x283af9}=_0x4d7aac['body'],_0x238390=await purchases_return[_0xda3242(0xa9)](_0x1412d6);console['log'](_0x238390);var _0x258371=_0x2b2c8b-_0x283af9;console[_0xda3242(0xc9)](_0x283af9),_0x238390[_0xda3242(0xd1)]=parseFloat(_0x283af9)+parseFloat(_0x238390['received']),_0x238390[_0xda3242(0x8f)]=_0x258371,console['log'](_0x238390);const _0x36325c=await _0x238390[_0xda3242(0xa8)](),_0x2e2a2c=await s_payment_data[_0xda3242(0xda)]({'invoice':_0x4d7aac[_0xda3242(0xc2)][_0xda3242(0xaf)],'reason':_0xda3242(0xce)});_0x2e2a2c[_0xda3242(0xd3)]=_0x258371,await _0x2e2a2c[_0xda3242(0xa8)]();let _0x22a331=new Date(),_0x1e3bf5=('0'+_0x22a331[_0xda3242(0xb2)]())[_0xda3242(0x98)](-0x2),_0x231bb9=('0'+(_0x22a331['getMonth']()+0x1))[_0xda3242(0x98)](-0x2),_0x489ff9=_0x22a331[_0xda3242(0xe4)](),_0x4fd665=_0x489ff9+'-'+_0x231bb9+'-'+_0x1e3bf5;const _0x59108f=new suppliers_payment({'invoice':_0x3ea28f,'date':_0x489ff9+'-'+_0x231bb9+'-'+_0x1e3bf5,'suppliers':_0xbd4b74,'reason':_0xda3242(0xd7),'amount':_0x283af9}),_0x1323ca=await _0x59108f['save']();_0x4d7aac[_0xda3242(0xd4)](_0xda3242(0x93),_0xda3242(0xc1)),_0x47e120['redirect'](_0xda3242(0xde));}catch(_0x10397e){console[_0xda3242(0xc9)](_0x10397e);}}),module['exports']=router;function a0_0x993e(_0x4174c9,_0x51dc73){const _0x2708e5=a0_0x2708();return a0_0x993e=function(_0x993ee5,_0x3abc69){_0x993ee5=_0x993ee5-0x79;let _0x38d57d=_0x2708e5[_0x993ee5];return _0x38d57d;},a0_0x993e(_0x4174c9,_0x51dc73);}function a0_0x2708(){const _0x44e9f3=['save','findById','return_product','Portuguese\x20(BR)','aggregate','2508156MRCYAS','map','invoice','$due_amount','return_purchase_edit_finished','getDate','$discount','back','Arabic','9eQTdEY','English','params','$product_details._id','$supplier_docs.address','Finished\x20Goods','name','$name','return_purchase_invoice','status','/receive_payment/:id','payment\x20successfull','body','$product_details.secondary_code','user','Portuguese','$return_product.total','primary_code','850SuAOPa','log','$supplier_docs.email','Spanish','7030aeAqWB','../models/all_models','Purchase\x20Return','English\x20(US)','/view/:id','received','get','amount','flash','stock_quantity','$product_details.floorlevel','Received\x20For\x20Purchase\x20Return','purchases_return_finished','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','findOne','to_Room_name','room','3671112ejqVOv','/purchases_return/view','supplier_docs','bay','$return_product.price','German','$product_details.primary_code','getFullYear','224433RIfhUW','1422568VrBxlJ','express','purchase_quantity','Chinese','$receivable','French','$supplier_docs','stocks','/view','$product_details.rack','Arabic\x20(ae)','warehouse_name','Hindi','/purchases_return_finished/view','906164lNjzcE','18PpNBTz','product_details','forEach','$note','redirect','1068WDBPau','$return_product.return_qty','errors','to_warehouse_name','$supplier_docs.mobile','$return_product.product_name','product_name','$invoice','language','Enabled','suppliers','Return\x20Goods','json','due_amount','post','primary_code_hide','level','success','secondary_code_hide','string','find','product_stock','slice','message','stock_data','render','$warehouse_name','$product_details.bay','$suppliers','2330062duHYMT','email','$product_details.storage','$product_details.type','to_room','$product_details.bin','product_code_hide','return_qty','master'];a0_0x2708=function(){return _0x44e9f3;};return a0_0x2708();}