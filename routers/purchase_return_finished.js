const a0_0x39245b=a0_0x325c;function a0_0x1717(){const _0x4564eb=['note','due_amount','success','to_room','English','errors','English\x20(US)','../middleware/auth','$received','stock_data','$warehouse_name','redirect','Router','$product_details.type','language','Spanish','French','Chinese','Portuguese','$product_details.secondary_code','aggregate','$suppliers','get','return_qty','16244216YARzku','$product_details.product_code','return_purchase_edit_finished','exports','user','$supplier_docs.mobile','Hindi','primary_code','save','string','/purchases_return/view','product_name','level','purchase\x20return\x20successfully','$product_details.storage','Portuguese\x20(BR)','Received\x20For\x20Purchase\x20Return','$receivable','$product_details.bin','Finished\x20Goods','body','secondary_code_hide','to_Room_name','primary_code_hide','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','/receive_payment/:id','bay','product_stock','$discount','$supplier_docs','German','slice','$return_product.price','$product_details.rack','Purchase\x20Return','$supplier_docs.email','$product_details._id','Arabic','supplier_docs','amount','name','$due_amount','back','return_product','$product_details.product_name','../models/all_models','post','json','log','420340FWHwKS','3374470sQYMGz','$name','warehouse_name','/view/:id','stocks','find','return_purchase_invoice','params','$product_details.primary_code','$return_product.total','suppliers','date','$supplier_docs.address','$return_product.return_qty','$total_amount','flash','Arabic\x20(ae)','602214bnKZVJ','$_id','secondary_code','2FcOKei','$product_details.floorlevel','map','purchases_return_finished','findOne','$return_product','$product_details.bay','forEach','product_code','1146558sltiTn','master','Enabled','invoice','stock_quantity','getDate','../public/language/languages.json','product_code_hide','product_details','1072722bcTshX','to_warehouse_name','email','$product_details.product_stock','payment\x20successfull','room','$date','1704255DCDBGp','/invoice/:id','purchase_quantity','Return\x20Goods','$product_details','render'];a0_0x1717=function(){return _0x4564eb;};return a0_0x1717();}function a0_0x325c(_0x28d58c,_0x4c81d8){const _0x1717c3=a0_0x1717();return a0_0x325c=function(_0x325cbf,_0x1168a5){_0x325cbf=_0x325cbf-0x101;let _0x294926=_0x1717c3[_0x325cbf];return _0x294926;},a0_0x325c(_0x28d58c,_0x4c81d8);}(function(_0x43cd38,_0x214fad){const _0x22cb6e=a0_0x325c,_0x3dd790=_0x43cd38();while(!![]){try{const _0x386525=parseInt(_0x22cb6e(0x12b))/0x1*(-parseInt(_0x22cb6e(0x134))/0x2)+parseInt(_0x22cb6e(0x13d))/0x3+-parseInt(_0x22cb6e(0x116))/0x4+-parseInt(_0x22cb6e(0x117))/0x5+-parseInt(_0x22cb6e(0x128))/0x6+parseInt(_0x22cb6e(0x144))/0x7+parseInt(_0x22cb6e(0x162))/0x8;if(_0x386525===_0x214fad)break;else _0x3dd790['push'](_0x3dd790['shift']());}catch(_0x2232f8){_0x3dd790['push'](_0x3dd790['shift']());}}}(a0_0x1717,0x939f4));const express=require('express'),app=express(),router=express[a0_0x39245b(0x156)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require(a0_0x39245b(0x112)),auth=require(a0_0x39245b(0x151)),users=require(a0_0x39245b(0x13a));router[a0_0x39245b(0x160)]('/view',auth,async(_0x387b36,_0x4469a5)=>{const _0x5af395=a0_0x39245b;try{const {username:_0x4e389e,email:_0x2ecc99,role:_0x44be4e}=_0x387b36[_0x5af395(0x166)],_0x379c02=_0x387b36[_0x5af395(0x166)],_0x482441=await profile[_0x5af395(0x12f)]({'email':_0x379c02['email']}),_0x5a8e79=await master_shop[_0x5af395(0x11c)]();console[_0x5af395(0x115)]('master',_0x5a8e79);const _0x10f1c9=await purchases_return_finished[_0x5af395(0x15e)]([{'$lookup':{'from':_0x5af395(0x121),'localField':_0x5af395(0x121),'foreignField':_0x5af395(0x10d),'as':_0x5af395(0x10b)}},{'$unwind':_0x5af395(0x130)},{'$unwind':_0x5af395(0x102)},{'$group':{'_id':_0x5af395(0x129),'invoice':{'$first':'$invoice'},'date':{'$first':_0x5af395(0x143)},'suppliers':{'$first':_0x5af395(0x15f)},'warehouse_name':{'$first':_0x5af395(0x154)},'product_name':{'$first':'$return_product.product_name'},'return_qty':{'$first':_0x5af395(0x124)},'price':{'$first':_0x5af395(0x105)},'total':{'$sum':_0x5af395(0x120)},'note':{'$first':'$note'},'total_amount':{'$first':_0x5af395(0x125)},'discount':{'$first':_0x5af395(0x101)},'receivable':{'$first':_0x5af395(0x173)},'received':{'$first':_0x5af395(0x152)},'due_amount':{'$first':_0x5af395(0x10e)},'mobile':{'$first':_0x5af395(0x167)},'email':{'$first':_0x5af395(0x108)},'address':{'$first':_0x5af395(0x123)},'return_sum_qty':{'$sum':_0x5af395(0x124)}}}]);console[_0x5af395(0x115)](_0x10f1c9);if(_0x5a8e79[0x0][_0x5af395(0x158)]=='English\x20(US)'){var _0x3d1198=users[_0x5af395(0x14e)];console['log'](_0x3d1198);}else{if(_0x5a8e79[0x0][_0x5af395(0x158)]=='Hindi')var _0x3d1198=users['Hindi'];else{if(_0x5a8e79[0x0]['language']=='German')var _0x3d1198=users[_0x5af395(0x103)];else{if(_0x5a8e79[0x0][_0x5af395(0x158)]==_0x5af395(0x159))var _0x3d1198=users['Spanish'];else{if(_0x5a8e79[0x0][_0x5af395(0x158)]==_0x5af395(0x15a))var _0x3d1198=users[_0x5af395(0x15a)];else{if(_0x5a8e79[0x0][_0x5af395(0x158)]=='Portuguese\x20(BR)')var _0x3d1198=users['Portuguese'];else{if(_0x5a8e79[0x0]['language']=='Chinese')var _0x3d1198=users[_0x5af395(0x15b)];else{if(_0x5a8e79[0x0][_0x5af395(0x158)]==_0x5af395(0x127))var _0x3d1198=users[_0x5af395(0x10a)];}}}}}}}_0x4469a5[_0x5af395(0x149)](_0x5af395(0x12e),{'success':_0x387b36[_0x5af395(0x126)](_0x5af395(0x14c)),'errors':_0x387b36['flash'](_0x5af395(0x14f)),'role':_0x379c02,'profile':_0x482441,'master_shop':_0x5a8e79,'user':_0x10f1c9,'language':_0x3d1198});}catch(_0x51af2f){console[_0x5af395(0x115)](_0x51af2f);}}),router[a0_0x39245b(0x160)](a0_0x39245b(0x11a),auth,async(_0x1c857b,_0x4a2ad1)=>{const _0x58b5e9=a0_0x39245b;try{const {username:_0x417a0f,email:_0x5b5af2,role:_0x371183}=_0x1c857b[_0x58b5e9(0x166)],_0x11cdc3=_0x1c857b[_0x58b5e9(0x166)],_0x51b85d=await profile[_0x58b5e9(0x12f)]({'email':_0x11cdc3['email']}),_0x1de6a0=await product['find']({}),_0x56d244=await master_shop[_0x58b5e9(0x11c)](),_0xbe9b67=_0x1c857b['params']['id'],_0x166b79=await purchases_return_finished['findById'](_0xbe9b67),_0x2ed6c7=await warehouse[_0x58b5e9(0x15e)]([{'$match':{'name':_0x166b79[_0x58b5e9(0x119)],'room':_0x166b79[_0x58b5e9(0x142)],'warehouse_category':_0x58b5e9(0x175)}},{'$unwind':_0x58b5e9(0x148)},{'$group':{'_id':_0x58b5e9(0x109),'name':{'$first':_0x58b5e9(0x111)},'product_stock':{'$first':_0x58b5e9(0x140)},'bay':{'$first':_0x58b5e9(0x131)},'bin':{'$first':_0x58b5e9(0x174)},'type':{'$first':_0x58b5e9(0x157)},'floorlevel':{'$first':_0x58b5e9(0x12c)},'primary_code':{'$first':_0x58b5e9(0x11f)},'secondary_code':{'$first':_0x58b5e9(0x15d)},'product_code':{'$first':_0x58b5e9(0x163)},'storage':{'$first':_0x58b5e9(0x170)},'rack':{'$first':_0x58b5e9(0x106)}}}]);warehouse_data=await warehouse[_0x58b5e9(0x15e)]([{'$match':{'status':_0x58b5e9(0x136),'name':_0x58b5e9(0x147),'warehouse_category':_0x58b5e9(0x175)}},{'$group':{'_id':'$name','name':{'$first':_0x58b5e9(0x118)}}},{'$sort':{'name':0x1}}]),console['log'](_0x58b5e9(0x153),_0x2ed6c7);if(_0x56d244[0x0]['language']==_0x58b5e9(0x150)){var _0xc991f1=users[_0x58b5e9(0x14e)];console[_0x58b5e9(0x115)](_0xc991f1);}else{if(_0x56d244[0x0][_0x58b5e9(0x158)]=='Hindi')var _0xc991f1=users[_0x58b5e9(0x168)];else{if(_0x56d244[0x0][_0x58b5e9(0x158)]==_0x58b5e9(0x103))var _0xc991f1=users[_0x58b5e9(0x103)];else{if(_0x56d244[0x0][_0x58b5e9(0x158)]=='Spanish')var _0xc991f1=users[_0x58b5e9(0x159)];else{if(_0x56d244[0x0][_0x58b5e9(0x158)]==_0x58b5e9(0x15a))var _0xc991f1=users[_0x58b5e9(0x15a)];else{if(_0x56d244[0x0][_0x58b5e9(0x158)]==_0x58b5e9(0x171))var _0xc991f1=users[_0x58b5e9(0x15c)];else{if(_0x56d244[0x0][_0x58b5e9(0x158)]==_0x58b5e9(0x15b))var _0xc991f1=users[_0x58b5e9(0x15b)];else{if(_0x56d244[0x0][_0x58b5e9(0x158)]==_0x58b5e9(0x127))var _0xc991f1=users[_0x58b5e9(0x10a)];}}}}}}}_0x4a2ad1['render'](_0x58b5e9(0x164),{'success':_0x1c857b[_0x58b5e9(0x126)](_0x58b5e9(0x14c)),'errors':_0x1c857b[_0x58b5e9(0x126)](_0x58b5e9(0x14f)),'role':_0x11cdc3,'master_shop':_0x56d244,'profile':_0x51b85d,'user':_0x166b79,'stock':_0x2ed6c7,'product':_0x1de6a0,'language':_0xc991f1,'warehouse':warehouse_data});}catch(_0x4a39b8){console[_0x58b5e9(0x115)](_0x4a39b8);}}),router['post'](a0_0x39245b(0x11a),auth,async(_0x52196c,_0x5715ac)=>{const _0x5659ee=a0_0x39245b;try{const _0x2a7ebd=_0x52196c[_0x5659ee(0x11e)]['id'],_0x2bdfff=await purchases_return_finished[_0x5659ee(0x12f)]({'invoice':_0x52196c[_0x5659ee(0x176)][_0x5659ee(0x137)]}),_0x176811=await warehouse[_0x5659ee(0x12f)]({'name':_0x2bdfff['to_warehouse_name'],'room':_0x2bdfff[_0x5659ee(0x14d)],'warehouse_category':_0x5659ee(0x175)}),{invoice:_0x52a5bf,suppliers:_0x4738d1,date:_0x506be2,warehouse_name:_0x4579d2,product_name:_0x5d966b,purchase_quantity:_0x234ef9,stocks:_0x59dffd,return_qty:_0x92309,note:_0x3f1bc6,Room_name:_0x3bc0a8,level:_0x562c2d,isle:_0x2acba6,pallet:_0x131f2a,to_warehouse_name:_0x1be141,to_Room_name:_0x56f19f}=_0x52196c[_0x5659ee(0x176)];if(typeof _0x5d966b==_0x5659ee(0x16b))var _0xe8c505=[_0x52196c[_0x5659ee(0x176)]['product_name']],_0x1a28b3=[_0x52196c[_0x5659ee(0x176)]['purchase_quantity']],_0x3d853f=[_0x52196c[_0x5659ee(0x176)][_0x5659ee(0x11b)]],_0x2ada57=[_0x52196c[_0x5659ee(0x176)]['return_qty']],_0x1a1fef=[_0x52196c[_0x5659ee(0x176)][_0x5659ee(0x16e)]],_0x27e903=[_0x52196c[_0x5659ee(0x176)][_0x5659ee(0x13b)]],_0xf6a276=[_0x52196c[_0x5659ee(0x176)][_0x5659ee(0x179)]],_0x844559=[_0x52196c[_0x5659ee(0x176)][_0x5659ee(0x177)]];else var _0xe8c505=[..._0x52196c['body']['product_name']],_0x1a28b3=[..._0x52196c[_0x5659ee(0x176)][_0x5659ee(0x146)]],_0x3d853f=[..._0x52196c[_0x5659ee(0x176)][_0x5659ee(0x11b)]],_0x2ada57=[..._0x52196c['body'][_0x5659ee(0x161)]],_0x1a1fef=[..._0x52196c['body'][_0x5659ee(0x16e)]],_0x27e903=[..._0x52196c['body'][_0x5659ee(0x13b)]],_0xf6a276=[..._0x52196c[_0x5659ee(0x176)][_0x5659ee(0x179)]],_0x844559=[..._0x52196c[_0x5659ee(0x176)][_0x5659ee(0x177)]];const _0x4ab067=_0xe8c505['map'](_0x111fc0=>{return _0x111fc0={'product_name':_0x111fc0};});_0x1a28b3[_0x5659ee(0x132)]((_0x26f5d4,_0x680786)=>{_0x4ab067[_0x680786]['purchase_quantity']=_0x26f5d4;}),_0x3d853f['forEach']((_0xb2c7ad,_0x559254)=>{const _0xff6ecf=_0x5659ee;_0x4ab067[_0x559254][_0xff6ecf(0x138)]=_0xb2c7ad;}),_0x2ada57[_0x5659ee(0x132)]((_0x2a24f1,_0x4121ea)=>{const _0x2d06bb=_0x5659ee;_0x4ab067[_0x4121ea][_0x2d06bb(0x161)]=_0x2a24f1;}),_0x1a1fef['forEach']((_0x119705,_0x2b28f4)=>{const _0x390336=_0x5659ee;_0x4ab067[_0x2b28f4][_0x390336(0x17c)]=_0x119705;}),_0x27e903[_0x5659ee(0x132)]((_0x43fa4a,_0xc1ca46)=>{const _0x4fba72=_0x5659ee;_0x4ab067[_0xc1ca46][_0x4fba72(0x133)]=_0x43fa4a;}),_0xf6a276[_0x5659ee(0x132)]((_0x4b4f40,_0x455ad3)=>{const _0x261a90=_0x5659ee;_0x4ab067[_0x455ad3][_0x261a90(0x169)]=_0x4b4f40;}),_0x844559[_0x5659ee(0x132)]((_0x24f373,_0x1c07cd)=>{const _0x468670=_0x5659ee;_0x4ab067[_0x1c07cd][_0x468670(0x12a)]=_0x24f373;});var _0x21c4f8=0x0;_0x4ab067[_0x5659ee(0x132)](_0x318032=>{const _0x280913=_0x5659ee;(parseInt(_0x318032[_0x280913(0x146)])<parseInt(_0x318032[_0x280913(0x161)])||parseInt(_0x318032[_0x280913(0x138)])<parseInt(_0x318032['return_qty']))&&_0x21c4f8++;});if(_0x21c4f8!=0x0)return _0x52196c[_0x5659ee(0x126)]('errors',_0x5659ee(0x17a)),_0x5715ac[_0x5659ee(0x155)](_0x5659ee(0x10f));_0x2bdfff[_0x5659ee(0x110)][_0x5659ee(0x132)](_0x5cf47d=>{if(_0x5cf47d['return_qty']>0x0){const _0x5530fb=_0x176811['product_details']['map'](_0x5c7441=>{const _0x1184e3=a0_0x325c;_0x5c7441['product_name']==_0x5cf47d['product_name']&&_0x5c7441[_0x1184e3(0x17c)]==_0x5cf47d[_0x1184e3(0x17c)]&&(_0x5c7441[_0x1184e3(0x17d)]=parseInt(_0x5c7441[_0x1184e3(0x17d)])+parseInt(_0x5cf47d[_0x1184e3(0x161)]));});}}),await _0x176811[_0x5659ee(0x16a)](),_0x2bdfff[_0x5659ee(0x137)]=_0x52a5bf,_0x2bdfff[_0x5659ee(0x121)]=_0x4738d1,_0x2bdfff[_0x5659ee(0x122)]=_0x506be2,_0x2bdfff[_0x5659ee(0x119)]=_0x4579d2,_0x2bdfff[_0x5659ee(0x110)]=_0x4ab067,_0x2bdfff[_0x5659ee(0x14a)]=_0x3f1bc6,_0x2bdfff[_0x5659ee(0x142)]=_0x3bc0a8,_0x2bdfff[_0x5659ee(0x13e)]=_0x1be141,_0x2bdfff['to_room']=_0x56f19f;const _0x386f6c=await _0x2bdfff[_0x5659ee(0x16a)](),_0x2eb3d3=await purchases_return_finished[_0x5659ee(0x12f)]({'invoice':_0x52196c['body'][_0x5659ee(0x137)]}),_0x604a94=await warehouse['findOne']({'name':_0x52196c[_0x5659ee(0x176)][_0x5659ee(0x13e)],'room':_0x52196c[_0x5659ee(0x176)][_0x5659ee(0x178)],'warehouse_category':_0x5659ee(0x175)});_0x2eb3d3[_0x5659ee(0x110)][_0x5659ee(0x132)](_0x4a13bd=>{const _0x4a35e3=_0x5659ee;_0x604a94[_0x4a35e3(0x13c)][_0x4a35e3(0x12d)](_0x53c54a=>{const _0x161f49=_0x4a35e3;_0x53c54a[_0x161f49(0x16d)]==_0x4a13bd[_0x161f49(0x16d)]&&_0x53c54a[_0x161f49(0x17c)]==_0x4a13bd[_0x161f49(0x17c)]&&(_0x53c54a[_0x161f49(0x17d)]=parseInt(_0x53c54a[_0x161f49(0x17d)])-parseInt(_0x4a13bd[_0x161f49(0x161)]));});}),await _0x604a94[_0x5659ee(0x16a)]();const _0x3b25f4=await s_payment_data[_0x5659ee(0x12f)]({'invoice':_0x52196c[_0x5659ee(0x176)][_0x5659ee(0x137)],'reason':_0x5659ee(0x107)});await _0x3b25f4[_0x5659ee(0x16a)](),_0x52196c['flash']('success',_0x5659ee(0x16f)),_0x5715ac[_0x5659ee(0x155)]('/purchases_return_finished/view');}catch(_0x1a9609){console['log'](_0x1a9609),_0x5715ac['status'](0xc8)[_0x5659ee(0x114)]({'message':_0x1a9609['message']});}}),router['get'](a0_0x39245b(0x145),auth,async(_0x40e4fe,_0x346a98)=>{const _0x43756a=a0_0x39245b;try{const {username:_0x15488f,email:_0x35ac9c,role:_0x1bb823}=_0x40e4fe[_0x43756a(0x166)],_0x598255=_0x40e4fe['user'],_0x4c663b=await profile[_0x43756a(0x12f)]({'email':_0x598255[_0x43756a(0x13f)]}),_0x4cc6f4=await master_shop[_0x43756a(0x11c)]();console[_0x43756a(0x115)](_0x43756a(0x135),_0x4cc6f4);const _0x46d1c9=_0x40e4fe[_0x43756a(0x11e)]['id'],_0x3b2779=await purchases_return['findById'](_0x46d1c9);console[_0x43756a(0x115)](_0x3b2779);const _0x36a449=await suppliers[_0x43756a(0x12f)]({'name':_0x3b2779[_0x43756a(0x121)]});console[_0x43756a(0x115)](_0x36a449);if(_0x4cc6f4[0x0][_0x43756a(0x158)]==_0x43756a(0x150)){var _0x53762a=users[_0x43756a(0x14e)];console[_0x43756a(0x115)](_0x53762a);}else{if(_0x4cc6f4[0x0][_0x43756a(0x158)]=='Hindi')var _0x53762a=users['Hindi'];else{if(_0x4cc6f4[0x0][_0x43756a(0x158)]==_0x43756a(0x103))var _0x53762a=users['German'];else{if(_0x4cc6f4[0x0][_0x43756a(0x158)]==_0x43756a(0x159))var _0x53762a=users[_0x43756a(0x159)];else{if(_0x4cc6f4[0x0]['language']==_0x43756a(0x15a))var _0x53762a=users['French'];else{if(_0x4cc6f4[0x0][_0x43756a(0x158)]==_0x43756a(0x171))var _0x53762a=users[_0x43756a(0x15c)];else{if(_0x4cc6f4[0x0][_0x43756a(0x158)]==_0x43756a(0x15b))var _0x53762a=users[_0x43756a(0x15b)];else{if(_0x4cc6f4[0x0]['language']==_0x43756a(0x127))var _0x53762a=users['Arabic'];}}}}}}}_0x346a98[_0x43756a(0x149)](_0x43756a(0x11d),{'success':_0x40e4fe[_0x43756a(0x126)](_0x43756a(0x14c)),'errors':_0x40e4fe[_0x43756a(0x126)](_0x43756a(0x14f)),'role':_0x598255,'profile':_0x4c663b,'master_shop':_0x4cc6f4,'supplier':_0x36a449,'purchase':_0x3b2779,'language':_0x53762a});}catch(_0x2ea422){console[_0x43756a(0x115)](_0x2ea422);}}),router[a0_0x39245b(0x113)](a0_0x39245b(0x17b),auth,async(_0x1c4403,_0x44482b)=>{const _0x23653d=a0_0x39245b;try{const _0xe0a1b8=_0x1c4403[_0x23653d(0x11e)]['id'],{invoice:_0x2ac63d,suppliers:_0x23c6b1,receivable_amount:_0x295e04,received_amount:_0x2a905a}=_0x1c4403[_0x23653d(0x176)],_0x13e88b=await purchases_return['findById'](_0xe0a1b8);console[_0x23653d(0x115)](_0x13e88b);var _0x4ffede=_0x295e04-_0x2a905a;console[_0x23653d(0x115)](_0x2a905a),_0x13e88b['received']=parseFloat(_0x2a905a)+parseFloat(_0x13e88b['received']),_0x13e88b[_0x23653d(0x14b)]=_0x4ffede,console[_0x23653d(0x115)](_0x13e88b);const _0x75c946=await _0x13e88b['save'](),_0x521399=await s_payment_data[_0x23653d(0x12f)]({'invoice':_0x1c4403['body']['invoice'],'reason':_0x23653d(0x107)});_0x521399[_0x23653d(0x10c)]=_0x4ffede,await _0x521399[_0x23653d(0x16a)]();let _0x379d22=new Date(),_0x577a1c=('0'+_0x379d22[_0x23653d(0x139)]())[_0x23653d(0x104)](-0x2),_0x44154c=('0'+(_0x379d22['getMonth']()+0x1))[_0x23653d(0x104)](-0x2),_0xb1d53e=_0x379d22['getFullYear'](),_0x59ca00=_0xb1d53e+'-'+_0x44154c+'-'+_0x577a1c;const _0x2a381d=new suppliers_payment({'invoice':_0x2ac63d,'date':_0xb1d53e+'-'+_0x44154c+'-'+_0x577a1c,'suppliers':_0x23c6b1,'reason':_0x23653d(0x172),'amount':_0x2a905a}),_0x5c2931=await _0x2a381d[_0x23653d(0x16a)]();_0x1c4403[_0x23653d(0x126)](_0x23653d(0x14c),_0x23653d(0x141)),_0x44482b['redirect'](_0x23653d(0x16c));}catch(_0x21292e){console[_0x23653d(0x115)](_0x21292e);}}),module[a0_0x39245b(0x165)]=router;