const a0_0x39c6ad=a0_0x148c;function a0_0x2cd1(){const _0x37cdd9=['map','$return_product.return_qty','1633775RLLEOE','../middleware/auth','English','message','$received','find','$product_details.product_stock','$supplier_docs.address','purchase\x20return\x20successfully','params','$supplier_docs.mobile','redirect','purchases_return_finished','Return\x20Goods','$product_details.bin','$product_details.primary_code','$date','save','3769188PGSbjw','$due_amount','language','/purchases_return/view','stock_data','$suppliers','product_stock','$supplier_docs','../public/language/languages.json','status','purchase_quantity','226922GcgBci','findOne','to_Room_name','Portuguese\x20(BR)','Router','name','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','flash','$product_details','$product_details.bay','71667fVGcqd','findById','$product_details._id','received','to_warehouse_name','due_amount','/view','getMonth','/view/:id','product_code_hide','payment\x20successfull','$product_details.product_code','2FDOezy','$product_details.storage','$product_details.product_name','$product_details.floorlevel','Purchase\x20Return','product_name','success','render','string','level','master','Spanish','/purchases_return_finished/view','getDate','product_code','return_product','Hindi','448kitxZG','Arabic\x20(ae)','suppliers','/invoice/:id','slice','body','English\x20(US)','forEach','date','$invoice','express','email','Received\x20For\x20Purchase\x20Return','stocks','aggregate','$return_product','French','Finished\x20Goods','exports','product_details','$note','amount','primary_code_hide','$product_details.rack','5786532BFmDjc','5156046DpURgW','4165736WQtDKH','return_qty','German','errors','getFullYear','../models/all_models','warehouse_name','Arabic','invoice','json','$return_product.total','Chinese','room','user','Portuguese','bay','stock_quantity','get','secondary_code','to_room','log','$return_product.price'];a0_0x2cd1=function(){return _0x37cdd9;};return a0_0x2cd1();}(function(_0x5b4fcf,_0x53d6c3){const _0x322107=a0_0x148c,_0x3b42db=_0x5b4fcf();while(!![]){try{const _0x550f7a=-parseInt(_0x322107(0x159))/0x1*(-parseInt(_0x322107(0x1b9))/0x2)+parseInt(_0x322107(0x1ae))/0x3+parseInt(_0x322107(0x184))/0x4+parseInt(_0x322107(0x19c))/0x5+-parseInt(_0x322107(0x182))/0x6+-parseInt(_0x322107(0x183))/0x7+parseInt(_0x322107(0x16a))/0x8*(-parseInt(_0x322107(0x14d))/0x9);if(_0x550f7a===_0x53d6c3)break;else _0x3b42db['push'](_0x3b42db['shift']());}catch(_0xa3882d){_0x3b42db['push'](_0x3b42db['shift']());}}}(a0_0x2cd1,0xac043));const express=require(a0_0x39c6ad(0x174)),app=express(),router=express[a0_0x39c6ad(0x1bd)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require(a0_0x39c6ad(0x189)),auth=require(a0_0x39c6ad(0x19d)),users=require(a0_0x39c6ad(0x1b6));function a0_0x148c(_0x18ae2d,_0x209cb1){const _0x2cd19b=a0_0x2cd1();return a0_0x148c=function(_0x148c1b,_0x26e71a){_0x148c1b=_0x148c1b-0x148;let _0x129209=_0x2cd19b[_0x148c1b];return _0x129209;},a0_0x148c(_0x18ae2d,_0x209cb1);}router['get'](a0_0x39c6ad(0x153),auth,async(_0x237485,_0x551102)=>{const _0x779409=a0_0x39c6ad;try{const {username:_0x5404e7,email:_0x4dcc75,role:_0x32bdfc}=_0x237485['user'],_0x46d4e5=_0x237485[_0x779409(0x191)],_0x455c71=await profile[_0x779409(0x1ba)]({'email':_0x46d4e5[_0x779409(0x175)]}),_0x403046=await master_shop[_0x779409(0x1a1)]();console[_0x779409(0x198)](_0x779409(0x163),_0x403046);const _0x55cbe8=await purchases_return_finished[_0x779409(0x178)]([{'$lookup':{'from':_0x779409(0x16c),'localField':_0x779409(0x16c),'foreignField':_0x779409(0x148),'as':'supplier_docs'}},{'$unwind':_0x779409(0x179)},{'$unwind':_0x779409(0x1b5)},{'$group':{'_id':'$_id','invoice':{'$first':_0x779409(0x173)},'date':{'$first':_0x779409(0x1ac)},'suppliers':{'$first':_0x779409(0x1b3)},'warehouse_name':{'$first':'$warehouse_name'},'product_name':{'$first':'$return_product.product_name'},'return_qty':{'$first':_0x779409(0x19b)},'price':{'$first':_0x779409(0x199)},'total':{'$sum':_0x779409(0x18e)},'note':{'$first':_0x779409(0x17e)},'total_amount':{'$first':'$total_amount'},'discount':{'$first':'$discount'},'receivable':{'$first':'$receivable'},'received':{'$first':_0x779409(0x1a0)},'due_amount':{'$first':_0x779409(0x1af)},'mobile':{'$first':_0x779409(0x1a6)},'email':{'$first':'$supplier_docs.email'},'address':{'$first':_0x779409(0x1a3)},'return_sum_qty':{'$sum':_0x779409(0x19b)}}}]);console[_0x779409(0x198)](_0x55cbe8);if(_0x403046[0x0][_0x779409(0x1b0)]==_0x779409(0x170)){var _0x4c453a=users[_0x779409(0x19e)];console[_0x779409(0x198)](_0x4c453a);}else{if(_0x403046[0x0][_0x779409(0x1b0)]==_0x779409(0x169))var _0x4c453a=users[_0x779409(0x169)];else{if(_0x403046[0x0][_0x779409(0x1b0)]==_0x779409(0x186))var _0x4c453a=users[_0x779409(0x186)];else{if(_0x403046[0x0]['language']==_0x779409(0x164))var _0x4c453a=users[_0x779409(0x164)];else{if(_0x403046[0x0]['language']==_0x779409(0x17a))var _0x4c453a=users['French'];else{if(_0x403046[0x0]['language']==_0x779409(0x1bc))var _0x4c453a=users[_0x779409(0x192)];else{if(_0x403046[0x0][_0x779409(0x1b0)]==_0x779409(0x18f))var _0x4c453a=users[_0x779409(0x18f)];else{if(_0x403046[0x0]['language']=='Arabic\x20(ae)')var _0x4c453a=users[_0x779409(0x18b)];}}}}}}}_0x551102[_0x779409(0x160)](_0x779409(0x1a8),{'success':_0x237485[_0x779409(0x14a)](_0x779409(0x15f)),'errors':_0x237485[_0x779409(0x14a)](_0x779409(0x187)),'role':_0x46d4e5,'profile':_0x455c71,'master_shop':_0x403046,'user':_0x55cbe8,'language':_0x4c453a});}catch(_0x5d4063){console[_0x779409(0x198)](_0x5d4063);}}),router[a0_0x39c6ad(0x195)]('/view/:id',auth,async(_0x341c2b,_0x55d138)=>{const _0x495cb6=a0_0x39c6ad;try{const {username:_0x1676f8,email:_0x263a2d,role:_0xad180e}=_0x341c2b[_0x495cb6(0x191)],_0x200327=_0x341c2b[_0x495cb6(0x191)],_0x4aabfa=await profile[_0x495cb6(0x1ba)]({'email':_0x200327[_0x495cb6(0x175)]}),_0xb737b1=await product['find']({}),_0x367567=await master_shop[_0x495cb6(0x1a1)](),_0x539207=_0x341c2b[_0x495cb6(0x1a5)]['id'],_0x32fc81=await purchases_return_finished['findById'](_0x539207),_0x50e153=await warehouse[_0x495cb6(0x178)]([{'$match':{'name':_0x32fc81['warehouse_name'],'room':_0x32fc81['room'],'warehouse_category':_0x495cb6(0x17b)}},{'$unwind':_0x495cb6(0x14b)},{'$group':{'_id':_0x495cb6(0x14f),'name':{'$first':_0x495cb6(0x15b)},'product_stock':{'$first':_0x495cb6(0x1a2)},'bay':{'$first':_0x495cb6(0x14c)},'bin':{'$first':_0x495cb6(0x1aa)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x495cb6(0x15c)},'primary_code':{'$first':_0x495cb6(0x1ab)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x495cb6(0x158)},'storage':{'$first':_0x495cb6(0x15a)},'rack':{'$first':_0x495cb6(0x181)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x495cb6(0x1a9),'warehouse_category':_0x495cb6(0x17b)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console['log'](_0x495cb6(0x1b2),_0x50e153);if(_0x367567[0x0][_0x495cb6(0x1b0)]==_0x495cb6(0x170)){var _0x43a9cc=users[_0x495cb6(0x19e)];console[_0x495cb6(0x198)](_0x43a9cc);}else{if(_0x367567[0x0][_0x495cb6(0x1b0)]==_0x495cb6(0x169))var _0x43a9cc=users[_0x495cb6(0x169)];else{if(_0x367567[0x0][_0x495cb6(0x1b0)]==_0x495cb6(0x186))var _0x43a9cc=users[_0x495cb6(0x186)];else{if(_0x367567[0x0][_0x495cb6(0x1b0)]==_0x495cb6(0x164))var _0x43a9cc=users['Spanish'];else{if(_0x367567[0x0][_0x495cb6(0x1b0)]==_0x495cb6(0x17a))var _0x43a9cc=users[_0x495cb6(0x17a)];else{if(_0x367567[0x0][_0x495cb6(0x1b0)]==_0x495cb6(0x1bc))var _0x43a9cc=users[_0x495cb6(0x192)];else{if(_0x367567[0x0][_0x495cb6(0x1b0)]==_0x495cb6(0x18f))var _0x43a9cc=users[_0x495cb6(0x18f)];else{if(_0x367567[0x0][_0x495cb6(0x1b0)]=='Arabic\x20(ae)')var _0x43a9cc=users[_0x495cb6(0x18b)];}}}}}}}_0x55d138['render']('return_purchase_edit_finished',{'success':_0x341c2b[_0x495cb6(0x14a)](_0x495cb6(0x15f)),'errors':_0x341c2b[_0x495cb6(0x14a)](_0x495cb6(0x187)),'role':_0x200327,'master_shop':_0x367567,'profile':_0x4aabfa,'user':_0x32fc81,'stock':_0x50e153,'product':_0xb737b1,'language':_0x43a9cc,'warehouse':warehouse_data});}catch(_0x54c0e9){console[_0x495cb6(0x198)](_0x54c0e9);}}),router['post'](a0_0x39c6ad(0x155),auth,async(_0x29fe97,_0x262a50)=>{const _0xcab54=a0_0x39c6ad;try{const _0x22219c=_0x29fe97[_0xcab54(0x1a5)]['id'],_0x175302=await purchases_return_finished[_0xcab54(0x1ba)]({'invoice':_0x29fe97[_0xcab54(0x16f)][_0xcab54(0x18c)]}),_0x28845c=await warehouse['findOne']({'name':_0x175302[_0xcab54(0x151)],'room':_0x175302[_0xcab54(0x197)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x4f0a86,suppliers:_0x3ab056,date:_0xc5c98,warehouse_name:_0x4d75dc,product_name:_0xe9d05c,purchase_quantity:_0x4e692b,stocks:_0x43856e,return_qty:_0x3bb143,note:_0x55c600,Room_name:_0x3515d3,level:_0x486166,isle:_0x5bc944,pallet:_0x2bdc1f,to_warehouse_name:_0x55c564,to_Room_name:_0x433718}=_0x29fe97[_0xcab54(0x16f)];if(typeof _0xe9d05c==_0xcab54(0x161))var _0x149535=[_0x29fe97['body']['product_name']],_0x51bf79=[_0x29fe97[_0xcab54(0x16f)]['purchase_quantity']],_0x57ce0b=[_0x29fe97[_0xcab54(0x16f)][_0xcab54(0x177)]],_0x301af8=[_0x29fe97[_0xcab54(0x16f)][_0xcab54(0x185)]],_0x15ab38=[_0x29fe97['body'][_0xcab54(0x162)]],_0x50c7af=[_0x29fe97[_0xcab54(0x16f)][_0xcab54(0x156)]],_0xfaaf66=[_0x29fe97[_0xcab54(0x16f)][_0xcab54(0x180)]],_0x29fb41=[_0x29fe97[_0xcab54(0x16f)]['secondary_code_hide']];else var _0x149535=[..._0x29fe97[_0xcab54(0x16f)]['product_name']],_0x51bf79=[..._0x29fe97[_0xcab54(0x16f)][_0xcab54(0x1b8)]],_0x57ce0b=[..._0x29fe97['body'][_0xcab54(0x177)]],_0x301af8=[..._0x29fe97[_0xcab54(0x16f)][_0xcab54(0x185)]],_0x15ab38=[..._0x29fe97['body']['level']],_0x50c7af=[..._0x29fe97[_0xcab54(0x16f)][_0xcab54(0x156)]],_0xfaaf66=[..._0x29fe97[_0xcab54(0x16f)][_0xcab54(0x180)]],_0x29fb41=[..._0x29fe97['body']['secondary_code_hide']];const _0x11adb5=_0x149535[_0xcab54(0x19a)](_0x7d89e8=>{return _0x7d89e8={'product_name':_0x7d89e8};});_0x51bf79[_0xcab54(0x171)]((_0x346de9,_0x53fd2f)=>{const _0x332323=_0xcab54;_0x11adb5[_0x53fd2f][_0x332323(0x1b8)]=_0x346de9;}),_0x57ce0b[_0xcab54(0x171)]((_0x40769c,_0x291843)=>{const _0x1d0a60=_0xcab54;_0x11adb5[_0x291843][_0x1d0a60(0x194)]=_0x40769c;}),_0x301af8[_0xcab54(0x171)]((_0xb24b,_0x3e90ae)=>{const _0x194e15=_0xcab54;_0x11adb5[_0x3e90ae][_0x194e15(0x185)]=_0xb24b;}),_0x15ab38['forEach']((_0x4aabb7,_0x49e7f1)=>{const _0x14a702=_0xcab54;_0x11adb5[_0x49e7f1][_0x14a702(0x193)]=_0x4aabb7;}),_0x50c7af[_0xcab54(0x171)]((_0x443c80,_0x5b58c1)=>{const _0x5acfd0=_0xcab54;_0x11adb5[_0x5b58c1][_0x5acfd0(0x167)]=_0x443c80;}),_0xfaaf66[_0xcab54(0x171)]((_0x1e4190,_0x325749)=>{_0x11adb5[_0x325749]['primary_code']=_0x1e4190;}),_0x29fb41['forEach']((_0x5703ef,_0x1d2fc6)=>{const _0x5e6d78=_0xcab54;_0x11adb5[_0x1d2fc6][_0x5e6d78(0x196)]=_0x5703ef;});var _0x2cd5ca=0x0;_0x11adb5[_0xcab54(0x171)](_0x3fb83a=>{const _0x150a36=_0xcab54;(parseInt(_0x3fb83a['purchase_quantity'])<parseInt(_0x3fb83a[_0x150a36(0x185)])||parseInt(_0x3fb83a[_0x150a36(0x194)])<parseInt(_0x3fb83a['return_qty']))&&_0x2cd5ca++;});if(_0x2cd5ca!=0x0)return _0x29fe97[_0xcab54(0x14a)]('errors',_0xcab54(0x149)),_0x262a50[_0xcab54(0x1a7)]('back');_0x175302['return_product'][_0xcab54(0x171)](_0x43cd13=>{const _0x51219a=_0xcab54;if(_0x43cd13[_0x51219a(0x185)]>0x0){const _0x17d7d2=_0x28845c[_0x51219a(0x17d)][_0x51219a(0x19a)](_0x399561=>{const _0x360fee=_0x51219a;_0x399561[_0x360fee(0x15e)]==_0x43cd13[_0x360fee(0x15e)]&&_0x399561[_0x360fee(0x193)]==_0x43cd13[_0x360fee(0x193)]&&(_0x399561[_0x360fee(0x1b4)]=parseInt(_0x399561[_0x360fee(0x1b4)])+parseInt(_0x43cd13[_0x360fee(0x185)]));});}}),await _0x28845c[_0xcab54(0x1ad)](),_0x175302['invoice']=_0x4f0a86,_0x175302[_0xcab54(0x16c)]=_0x3ab056,_0x175302[_0xcab54(0x172)]=_0xc5c98,_0x175302[_0xcab54(0x18a)]=_0x4d75dc,_0x175302[_0xcab54(0x168)]=_0x11adb5,_0x175302['note']=_0x55c600,_0x175302[_0xcab54(0x190)]=_0x3515d3,_0x175302[_0xcab54(0x151)]=_0x55c564,_0x175302[_0xcab54(0x197)]=_0x433718;const _0x3ed388=await _0x175302['save'](),_0x323d84=await purchases_return_finished[_0xcab54(0x1ba)]({'invoice':_0x29fe97['body']['invoice']}),_0x56a8f0=await warehouse[_0xcab54(0x1ba)]({'name':_0x29fe97[_0xcab54(0x16f)][_0xcab54(0x151)],'room':_0x29fe97[_0xcab54(0x16f)][_0xcab54(0x1bb)],'warehouse_category':'Finished\x20Goods'});_0x323d84[_0xcab54(0x168)][_0xcab54(0x171)](_0x5d52c9=>{const _0x5dd753=_0xcab54;_0x56a8f0[_0x5dd753(0x17d)][_0x5dd753(0x19a)](_0x1f7404=>{const _0x2ad03f=_0x5dd753;_0x1f7404[_0x2ad03f(0x15e)]==_0x5d52c9['product_name']&&_0x1f7404[_0x2ad03f(0x193)]==_0x5d52c9['bay']&&(_0x1f7404[_0x2ad03f(0x1b4)]=parseInt(_0x1f7404[_0x2ad03f(0x1b4)])-parseInt(_0x5d52c9[_0x2ad03f(0x185)]));});}),await _0x56a8f0[_0xcab54(0x1ad)]();const _0x5cbc81=await s_payment_data[_0xcab54(0x1ba)]({'invoice':_0x29fe97[_0xcab54(0x16f)]['invoice'],'reason':'Purchase\x20Return'});await _0x5cbc81['save'](),_0x29fe97[_0xcab54(0x14a)](_0xcab54(0x15f),_0xcab54(0x1a4)),_0x262a50[_0xcab54(0x1a7)](_0xcab54(0x165));}catch(_0x1f68e6){console[_0xcab54(0x198)](_0x1f68e6),_0x262a50[_0xcab54(0x1b7)](0xc8)[_0xcab54(0x18d)]({'message':_0x1f68e6[_0xcab54(0x19f)]});}}),router[a0_0x39c6ad(0x195)](a0_0x39c6ad(0x16d),auth,async(_0x417117,_0x167dcc)=>{const _0x27a32f=a0_0x39c6ad;try{const {username:_0x1d55c0,email:_0x42d37c,role:_0x630d2}=_0x417117[_0x27a32f(0x191)],_0x255180=_0x417117[_0x27a32f(0x191)],_0x23b81d=await profile[_0x27a32f(0x1ba)]({'email':_0x255180['email']}),_0x5290c4=await master_shop[_0x27a32f(0x1a1)]();console[_0x27a32f(0x198)](_0x27a32f(0x163),_0x5290c4);const _0x691ec2=_0x417117[_0x27a32f(0x1a5)]['id'],_0xe853de=await purchases_return[_0x27a32f(0x14e)](_0x691ec2);console[_0x27a32f(0x198)](_0xe853de);const _0x495ff=await suppliers[_0x27a32f(0x1ba)]({'name':_0xe853de[_0x27a32f(0x16c)]});console['log'](_0x495ff);if(_0x5290c4[0x0][_0x27a32f(0x1b0)]==_0x27a32f(0x170)){var _0x35417d=users[_0x27a32f(0x19e)];console[_0x27a32f(0x198)](_0x35417d);}else{if(_0x5290c4[0x0][_0x27a32f(0x1b0)]==_0x27a32f(0x169))var _0x35417d=users[_0x27a32f(0x169)];else{if(_0x5290c4[0x0][_0x27a32f(0x1b0)]=='German')var _0x35417d=users[_0x27a32f(0x186)];else{if(_0x5290c4[0x0]['language']==_0x27a32f(0x164))var _0x35417d=users[_0x27a32f(0x164)];else{if(_0x5290c4[0x0][_0x27a32f(0x1b0)]==_0x27a32f(0x17a))var _0x35417d=users['French'];else{if(_0x5290c4[0x0][_0x27a32f(0x1b0)]=='Portuguese\x20(BR)')var _0x35417d=users[_0x27a32f(0x192)];else{if(_0x5290c4[0x0]['language']==_0x27a32f(0x18f))var _0x35417d=users['Chinese'];else{if(_0x5290c4[0x0][_0x27a32f(0x1b0)]==_0x27a32f(0x16b))var _0x35417d=users['Arabic'];}}}}}}}_0x167dcc['render']('return_purchase_invoice',{'success':_0x417117[_0x27a32f(0x14a)](_0x27a32f(0x15f)),'errors':_0x417117[_0x27a32f(0x14a)](_0x27a32f(0x187)),'role':_0x255180,'profile':_0x23b81d,'master_shop':_0x5290c4,'supplier':_0x495ff,'purchase':_0xe853de,'language':_0x35417d});}catch(_0x58f6f9){console[_0x27a32f(0x198)](_0x58f6f9);}}),router['post']('/receive_payment/:id',auth,async(_0x38fd7f,_0x1b543b)=>{const _0x3c94aa=a0_0x39c6ad;try{const _0x3da7ff=_0x38fd7f[_0x3c94aa(0x1a5)]['id'],{invoice:_0x4d83e5,suppliers:_0x299df2,receivable_amount:_0x310242,received_amount:_0x242a58}=_0x38fd7f[_0x3c94aa(0x16f)],_0x1ab4e2=await purchases_return[_0x3c94aa(0x14e)](_0x3da7ff);console[_0x3c94aa(0x198)](_0x1ab4e2);var _0x3c25d4=_0x310242-_0x242a58;console[_0x3c94aa(0x198)](_0x242a58),_0x1ab4e2[_0x3c94aa(0x150)]=parseFloat(_0x242a58)+parseFloat(_0x1ab4e2[_0x3c94aa(0x150)]),_0x1ab4e2[_0x3c94aa(0x152)]=_0x3c25d4,console[_0x3c94aa(0x198)](_0x1ab4e2);const _0x1a6989=await _0x1ab4e2[_0x3c94aa(0x1ad)](),_0x5e6b44=await s_payment_data[_0x3c94aa(0x1ba)]({'invoice':_0x38fd7f[_0x3c94aa(0x16f)][_0x3c94aa(0x18c)],'reason':_0x3c94aa(0x15d)});_0x5e6b44[_0x3c94aa(0x17f)]=_0x3c25d4,await _0x5e6b44[_0x3c94aa(0x1ad)]();let _0x2cce4d=new Date(),_0x3725bc=('0'+_0x2cce4d[_0x3c94aa(0x166)]())[_0x3c94aa(0x16e)](-0x2),_0x2f600f=('0'+(_0x2cce4d[_0x3c94aa(0x154)]()+0x1))[_0x3c94aa(0x16e)](-0x2),_0x2a993b=_0x2cce4d[_0x3c94aa(0x188)](),_0x1b6569=_0x2a993b+'-'+_0x2f600f+'-'+_0x3725bc;const _0x244a00=new suppliers_payment({'invoice':_0x4d83e5,'date':_0x2a993b+'-'+_0x2f600f+'-'+_0x3725bc,'suppliers':_0x299df2,'reason':_0x3c94aa(0x176),'amount':_0x242a58}),_0x2973fd=await _0x244a00[_0x3c94aa(0x1ad)]();_0x38fd7f[_0x3c94aa(0x14a)]('success',_0x3c94aa(0x157)),_0x1b543b[_0x3c94aa(0x1a7)](_0x3c94aa(0x1b1));}catch(_0x513dfa){console[_0x3c94aa(0x198)](_0x513dfa);}}),module[a0_0x39c6ad(0x17c)]=router;