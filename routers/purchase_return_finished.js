const a0_0x268949=a0_0x3461;(function(_0x31f1cf,_0x3761aa){const _0x5cd06c=a0_0x3461,_0x280504=_0x31f1cf();while(!![]){try{const _0x3f6138=parseInt(_0x5cd06c(0x15c))/0x1+parseInt(_0x5cd06c(0x154))/0x2*(parseInt(_0x5cd06c(0x142))/0x3)+-parseInt(_0x5cd06c(0x146))/0x4*(parseInt(_0x5cd06c(0x156))/0x5)+-parseInt(_0x5cd06c(0x12d))/0x6*(-parseInt(_0x5cd06c(0x13a))/0x7)+-parseInt(_0x5cd06c(0x110))/0x8+parseInt(_0x5cd06c(0x15a))/0x9+parseInt(_0x5cd06c(0x122))/0xa;if(_0x3f6138===_0x3761aa)break;else _0x280504['push'](_0x280504['shift']());}catch(_0x14e524){_0x280504['push'](_0x280504['shift']());}}}(a0_0x4be7,0x8ec9d));function a0_0x3461(_0x582692,_0x30838c){const _0x4be71c=a0_0x4be7();return a0_0x3461=function(_0x3461a6,_0x43bdd4){_0x3461a6=_0x3461a6-0xf0;let _0x32bf6d=_0x4be71c[_0x3461a6];return _0x32bf6d;},a0_0x3461(_0x582692,_0x30838c);}const express=require('express'),app=express(),router=express[a0_0x268949(0xf8)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require(a0_0x268949(0x109)),auth=require(a0_0x268949(0x13d)),users=require(a0_0x268949(0x12c));function a0_0x4be7(){const _0x36f26b=['English','$supplier_docs.mobile','flash','Portuguese\x20(BR)','/receive_payment/:id','$return_product.total','secondary_code','stock_quantity','230006mFJUJV','Return\x20Goods','$supplier_docs','../middleware/auth','errors','language','find','$_id','50637Xsjvcx','German','bay','product_stock','675684pWSXdB','email','to_warehouse_name','$receivable','Spanish','supplier_docs','$supplier_docs.address','Finished\x20Goods','payment\x20successfull','params','Received\x20For\x20Purchase\x20Return','$discount','invoice','return_product','66MQbUzs','Arabic\x20(ae)','10MugomW','date','exports','to_room','3780765yNTBgf','post','370426wcNJEw','$total_amount','return_purchase_invoice','aggregate','Arabic','$product_details.product_code','master','$product_details.product_stock','getDate','$invoice','$return_product.price','$due_amount','Router','forEach','render','Chinese','product_name','warehouse_name','map','log','English\x20(US)','user','/purchases_return/view','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','to_Room_name','success','product_details','return_qty','stocks','../models/all_models','primary_code_hide','room','purchase_quantity','body','due_amount','suppliers','8900680XInTam','product_code','status','$return_product.return_qty','purchases_return_finished','redirect','back','Portuguese','$product_details.storage','/view','$product_details.bin','/view/:id','/invoice/:id','return_purchase_edit_finished','get','level','$note','Hindi','634680lkZOIC','$return_product.product_name','save','name','findOne','$name','$product_details.product_name','Enabled','French','secondary_code_hide','../public/language/languages.json','114SlVvEn','$received','stock_data','json','$product_details.bay'];a0_0x4be7=function(){return _0x36f26b;};return a0_0x4be7();}router[a0_0x268949(0x11e)](a0_0x268949(0x119),auth,async(_0xa8056,_0x816281)=>{const _0x418b74=a0_0x268949;try{const {username:_0x5c158c,email:_0x1c1cb7,role:_0x2a2b32}=_0xa8056[_0x418b74(0x101)],_0x3286bb=_0xa8056[_0x418b74(0x101)],_0x31143e=await profile['findOne']({'email':_0x3286bb[_0x418b74(0x147)]}),_0x4726bd=await master_shop[_0x418b74(0x140)]();console[_0x418b74(0xff)]('master',_0x4726bd);const _0x561784=await purchases_return_finished[_0x418b74(0x15f)]([{'$lookup':{'from':_0x418b74(0x10f),'localField':_0x418b74(0x10f),'foreignField':_0x418b74(0x125),'as':_0x418b74(0x14b)}},{'$unwind':'$return_product'},{'$unwind':_0x418b74(0x13c)},{'$group':{'_id':_0x418b74(0x141),'invoice':{'$first':_0x418b74(0xf5)},'date':{'$first':'$date'},'suppliers':{'$first':'$suppliers'},'warehouse_name':{'$first':'$warehouse_name'},'product_name':{'$first':_0x418b74(0x123)},'return_qty':{'$first':_0x418b74(0x113)},'price':{'$first':_0x418b74(0xf6)},'total':{'$sum':_0x418b74(0x137)},'note':{'$first':_0x418b74(0x120)},'total_amount':{'$first':_0x418b74(0x15d)},'discount':{'$first':_0x418b74(0x151)},'receivable':{'$first':_0x418b74(0x149)},'received':{'$first':_0x418b74(0x12e)},'due_amount':{'$first':_0x418b74(0xf7)},'mobile':{'$first':_0x418b74(0x133)},'email':{'$first':'$supplier_docs.email'},'address':{'$first':_0x418b74(0x14c)},'return_sum_qty':{'$sum':_0x418b74(0x113)}}}]);console[_0x418b74(0xff)](_0x561784);if(_0x4726bd[0x0][_0x418b74(0x13f)]==_0x418b74(0x100)){var _0x3c4ded=users['English'];console[_0x418b74(0xff)](_0x3c4ded);}else{if(_0x4726bd[0x0][_0x418b74(0x13f)]=='Hindi')var _0x3c4ded=users['Hindi'];else{if(_0x4726bd[0x0][_0x418b74(0x13f)]=='German')var _0x3c4ded=users[_0x418b74(0x143)];else{if(_0x4726bd[0x0]['language']==_0x418b74(0x14a))var _0x3c4ded=users[_0x418b74(0x14a)];else{if(_0x4726bd[0x0][_0x418b74(0x13f)]==_0x418b74(0x12a))var _0x3c4ded=users[_0x418b74(0x12a)];else{if(_0x4726bd[0x0][_0x418b74(0x13f)]=='Portuguese\x20(BR)')var _0x3c4ded=users['Portuguese'];else{if(_0x4726bd[0x0]['language']==_0x418b74(0xfb))var _0x3c4ded=users[_0x418b74(0xfb)];else{if(_0x4726bd[0x0][_0x418b74(0x13f)]==_0x418b74(0x155))var _0x3c4ded=users[_0x418b74(0xf0)];}}}}}}}_0x816281['render'](_0x418b74(0x114),{'success':_0xa8056[_0x418b74(0x134)](_0x418b74(0x105)),'errors':_0xa8056[_0x418b74(0x134)](_0x418b74(0x13e)),'role':_0x3286bb,'profile':_0x31143e,'master_shop':_0x4726bd,'user':_0x561784,'language':_0x3c4ded});}catch(_0x1591b9){console[_0x418b74(0xff)](_0x1591b9);}}),router[a0_0x268949(0x11e)](a0_0x268949(0x11b),auth,async(_0x250335,_0xc7b318)=>{const _0xbc00c1=a0_0x268949;try{const {username:_0x173229,email:_0x46c790,role:_0x5f2374}=_0x250335[_0xbc00c1(0x101)],_0x450be9=_0x250335['user'],_0x51224f=await profile[_0xbc00c1(0x126)]({'email':_0x450be9['email']}),_0x45e236=await product['find']({}),_0x5cf550=await master_shop[_0xbc00c1(0x140)](),_0x492373=_0x250335['params']['id'],_0x3c45ab=await purchases_return_finished['findById'](_0x492373),_0x23e12b=await warehouse[_0xbc00c1(0x15f)]([{'$match':{'name':_0x3c45ab[_0xbc00c1(0xfd)],'room':_0x3c45ab[_0xbc00c1(0x10b)],'warehouse_category':_0xbc00c1(0x14d)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0xbc00c1(0x128)},'product_stock':{'$first':_0xbc00c1(0xf3)},'bay':{'$first':_0xbc00c1(0x131)},'bin':{'$first':_0xbc00c1(0x11a)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xbc00c1(0xf1)},'storage':{'$first':_0xbc00c1(0x118)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0xbc00c1(0x15f)]([{'$match':{'status':_0xbc00c1(0x129),'name':_0xbc00c1(0x13b),'warehouse_category':_0xbc00c1(0x14d)}},{'$group':{'_id':_0xbc00c1(0x127),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0xbc00c1(0xff)](_0xbc00c1(0x12f),_0x23e12b);if(_0x5cf550[0x0][_0xbc00c1(0x13f)]==_0xbc00c1(0x100)){var _0x6ccbcd=users[_0xbc00c1(0x132)];console[_0xbc00c1(0xff)](_0x6ccbcd);}else{if(_0x5cf550[0x0][_0xbc00c1(0x13f)]=='Hindi')var _0x6ccbcd=users[_0xbc00c1(0x121)];else{if(_0x5cf550[0x0]['language']==_0xbc00c1(0x143))var _0x6ccbcd=users[_0xbc00c1(0x143)];else{if(_0x5cf550[0x0][_0xbc00c1(0x13f)]==_0xbc00c1(0x14a))var _0x6ccbcd=users['Spanish'];else{if(_0x5cf550[0x0][_0xbc00c1(0x13f)]==_0xbc00c1(0x12a))var _0x6ccbcd=users[_0xbc00c1(0x12a)];else{if(_0x5cf550[0x0][_0xbc00c1(0x13f)]=='Portuguese\x20(BR)')var _0x6ccbcd=users[_0xbc00c1(0x117)];else{if(_0x5cf550[0x0][_0xbc00c1(0x13f)]==_0xbc00c1(0xfb))var _0x6ccbcd=users['Chinese'];else{if(_0x5cf550[0x0]['language']==_0xbc00c1(0x155))var _0x6ccbcd=users['Arabic'];}}}}}}}_0xc7b318[_0xbc00c1(0xfa)](_0xbc00c1(0x11d),{'success':_0x250335[_0xbc00c1(0x134)](_0xbc00c1(0x105)),'errors':_0x250335['flash'](_0xbc00c1(0x13e)),'role':_0x450be9,'master_shop':_0x5cf550,'profile':_0x51224f,'user':_0x3c45ab,'stock':_0x23e12b,'product':_0x45e236,'language':_0x6ccbcd,'warehouse':warehouse_data});}catch(_0x2f3728){console['log'](_0x2f3728);}}),router[a0_0x268949(0x15b)](a0_0x268949(0x11b),auth,async(_0x3e661a,_0x21cb0e)=>{const _0x665cdf=a0_0x268949;try{const _0x23bda3=_0x3e661a[_0x665cdf(0x14f)]['id'],_0x2126db=await purchases_return_finished[_0x665cdf(0x126)]({'invoice':_0x3e661a[_0x665cdf(0x10d)]['invoice']}),_0x1f646b=await warehouse[_0x665cdf(0x126)]({'name':_0x2126db[_0x665cdf(0x148)],'room':_0x2126db[_0x665cdf(0x159)],'warehouse_category':'Finished\x20Goods'}),{invoice:_0x137043,suppliers:_0x643c63,date:_0x55fe37,warehouse_name:_0xa2bc3,product_name:_0x2e2b8b,purchase_quantity:_0x3ae3f4,stocks:_0x3cd838,return_qty:_0x25a02d,note:_0x3c504d,Room_name:_0xa42902,level:_0x611921,isle:_0x391710,pallet:_0x5064e3,to_warehouse_name:_0x18adde,to_Room_name:_0x2c1279}=_0x3e661a[_0x665cdf(0x10d)];if(typeof _0x2e2b8b=='string')var _0x461650=[_0x3e661a['body'][_0x665cdf(0xfc)]],_0xdc4c30=[_0x3e661a[_0x665cdf(0x10d)]['purchase_quantity']],_0x11e862=[_0x3e661a[_0x665cdf(0x10d)][_0x665cdf(0x108)]],_0x156c5d=[_0x3e661a[_0x665cdf(0x10d)][_0x665cdf(0x107)]],_0xe89603=[_0x3e661a[_0x665cdf(0x10d)]['level']],_0xeae5a2=[_0x3e661a[_0x665cdf(0x10d)]['product_code_hide']],_0x495188=[_0x3e661a[_0x665cdf(0x10d)][_0x665cdf(0x10a)]],_0x649876=[_0x3e661a[_0x665cdf(0x10d)]['secondary_code_hide']];else var _0x461650=[..._0x3e661a[_0x665cdf(0x10d)]['product_name']],_0xdc4c30=[..._0x3e661a[_0x665cdf(0x10d)][_0x665cdf(0x10c)]],_0x11e862=[..._0x3e661a[_0x665cdf(0x10d)]['stocks']],_0x156c5d=[..._0x3e661a[_0x665cdf(0x10d)][_0x665cdf(0x107)]],_0xe89603=[..._0x3e661a['body'][_0x665cdf(0x11f)]],_0xeae5a2=[..._0x3e661a[_0x665cdf(0x10d)]['product_code_hide']],_0x495188=[..._0x3e661a['body']['primary_code_hide']],_0x649876=[..._0x3e661a['body'][_0x665cdf(0x12b)]];const _0x428672=_0x461650[_0x665cdf(0xfe)](_0x10ece5=>{return _0x10ece5={'product_name':_0x10ece5};});_0xdc4c30[_0x665cdf(0xf9)]((_0x2c65f6,_0x4c219b)=>{const _0x5864a8=_0x665cdf;_0x428672[_0x4c219b][_0x5864a8(0x10c)]=_0x2c65f6;}),_0x11e862[_0x665cdf(0xf9)]((_0x8c0ee1,_0x937be6)=>{const _0x4d1b29=_0x665cdf;_0x428672[_0x937be6][_0x4d1b29(0x139)]=_0x8c0ee1;}),_0x156c5d[_0x665cdf(0xf9)]((_0x2b163e,_0x4b818b)=>{_0x428672[_0x4b818b]['return_qty']=_0x2b163e;}),_0xe89603[_0x665cdf(0xf9)]((_0x1ee913,_0xf79b70)=>{const _0x151879=_0x665cdf;_0x428672[_0xf79b70][_0x151879(0x144)]=_0x1ee913;}),_0xeae5a2[_0x665cdf(0xf9)]((_0x18e2d4,_0x2f3f2a)=>{const _0x2c732b=_0x665cdf;_0x428672[_0x2f3f2a][_0x2c732b(0x111)]=_0x18e2d4;}),_0x495188[_0x665cdf(0xf9)]((_0x5b4a42,_0x3972ef)=>{_0x428672[_0x3972ef]['primary_code']=_0x5b4a42;}),_0x649876[_0x665cdf(0xf9)]((_0x3430d1,_0x241a14)=>{const _0x302dc7=_0x665cdf;_0x428672[_0x241a14][_0x302dc7(0x138)]=_0x3430d1;});var _0xa5ee55=0x0;_0x428672[_0x665cdf(0xf9)](_0x16f381=>{const _0x173082=_0x665cdf;(parseInt(_0x16f381['purchase_quantity'])<parseInt(_0x16f381[_0x173082(0x107)])||parseInt(_0x16f381[_0x173082(0x139)])<parseInt(_0x16f381[_0x173082(0x107)]))&&_0xa5ee55++;});if(_0xa5ee55!=0x0)return _0x3e661a[_0x665cdf(0x134)](_0x665cdf(0x13e),_0x665cdf(0x103)),_0x21cb0e['redirect'](_0x665cdf(0x116));_0x2126db[_0x665cdf(0x153)]['forEach'](_0x4d6fe8=>{const _0x7c916a=_0x665cdf;if(_0x4d6fe8[_0x7c916a(0x107)]>0x0){const _0x518fa3=_0x1f646b[_0x7c916a(0x106)][_0x7c916a(0xfe)](_0xb6e5ee=>{const _0xbaa413=_0x7c916a;_0xb6e5ee[_0xbaa413(0xfc)]==_0x4d6fe8[_0xbaa413(0xfc)]&&_0xb6e5ee['bay']==_0x4d6fe8['bay']&&(_0xb6e5ee[_0xbaa413(0x145)]=parseInt(_0xb6e5ee[_0xbaa413(0x145)])+parseInt(_0x4d6fe8[_0xbaa413(0x107)]));});}}),await _0x1f646b['save'](),_0x2126db[_0x665cdf(0x152)]=_0x137043,_0x2126db['suppliers']=_0x643c63,_0x2126db[_0x665cdf(0x157)]=_0x55fe37,_0x2126db['warehouse_name']=_0xa2bc3,_0x2126db[_0x665cdf(0x153)]=_0x428672,_0x2126db['note']=_0x3c504d,_0x2126db[_0x665cdf(0x10b)]=_0xa42902,_0x2126db[_0x665cdf(0x148)]=_0x18adde,_0x2126db[_0x665cdf(0x159)]=_0x2c1279;const _0x36e6b4=await _0x2126db[_0x665cdf(0x124)](),_0x20bd44=await purchases_return_finished[_0x665cdf(0x126)]({'invoice':_0x3e661a[_0x665cdf(0x10d)]['invoice']}),_0x2f12f7=await warehouse['findOne']({'name':_0x3e661a[_0x665cdf(0x10d)]['to_warehouse_name'],'room':_0x3e661a[_0x665cdf(0x10d)][_0x665cdf(0x104)],'warehouse_category':_0x665cdf(0x14d)});_0x20bd44[_0x665cdf(0x153)]['forEach'](_0x120716=>{const _0x528852=_0x665cdf;_0x2f12f7[_0x528852(0x106)][_0x528852(0xfe)](_0x1eda8d=>{const _0x1bd7fe=_0x528852;_0x1eda8d[_0x1bd7fe(0xfc)]==_0x120716[_0x1bd7fe(0xfc)]&&_0x1eda8d['bay']==_0x120716['bay']&&(_0x1eda8d[_0x1bd7fe(0x145)]=parseInt(_0x1eda8d[_0x1bd7fe(0x145)])-parseInt(_0x120716['return_qty']));});}),await _0x2f12f7['save']();const _0x584566=await s_payment_data[_0x665cdf(0x126)]({'invoice':_0x3e661a[_0x665cdf(0x10d)][_0x665cdf(0x152)],'reason':'Purchase\x20Return'});await _0x584566[_0x665cdf(0x124)](),_0x3e661a[_0x665cdf(0x134)](_0x665cdf(0x105),'purchase\x20return\x20successfully'),_0x21cb0e[_0x665cdf(0x115)]('/purchases_return_finished/view');}catch(_0x3a9939){console[_0x665cdf(0xff)](_0x3a9939),_0x21cb0e[_0x665cdf(0x112)](0xc8)[_0x665cdf(0x130)]({'message':_0x3a9939['message']});}}),router['get'](a0_0x268949(0x11c),auth,async(_0x2c0f44,_0x551216)=>{const _0x37cc3e=a0_0x268949;try{const {username:_0x3415bb,email:_0x2ef411,role:_0x2cce48}=_0x2c0f44[_0x37cc3e(0x101)],_0x16ef4d=_0x2c0f44[_0x37cc3e(0x101)],_0x37814a=await profile['findOne']({'email':_0x16ef4d['email']}),_0x573575=await master_shop[_0x37cc3e(0x140)]();console[_0x37cc3e(0xff)](_0x37cc3e(0xf2),_0x573575);const _0x53b7b5=_0x2c0f44['params']['id'],_0x1dae98=await purchases_return['findById'](_0x53b7b5);console[_0x37cc3e(0xff)](_0x1dae98);const _0x553be0=await suppliers['findOne']({'name':_0x1dae98[_0x37cc3e(0x10f)]});console['log'](_0x553be0);if(_0x573575[0x0][_0x37cc3e(0x13f)]==_0x37cc3e(0x100)){var _0x2dba54=users[_0x37cc3e(0x132)];console[_0x37cc3e(0xff)](_0x2dba54);}else{if(_0x573575[0x0][_0x37cc3e(0x13f)]==_0x37cc3e(0x121))var _0x2dba54=users[_0x37cc3e(0x121)];else{if(_0x573575[0x0][_0x37cc3e(0x13f)]=='German')var _0x2dba54=users[_0x37cc3e(0x143)];else{if(_0x573575[0x0][_0x37cc3e(0x13f)]==_0x37cc3e(0x14a))var _0x2dba54=users[_0x37cc3e(0x14a)];else{if(_0x573575[0x0][_0x37cc3e(0x13f)]==_0x37cc3e(0x12a))var _0x2dba54=users[_0x37cc3e(0x12a)];else{if(_0x573575[0x0][_0x37cc3e(0x13f)]==_0x37cc3e(0x135))var _0x2dba54=users[_0x37cc3e(0x117)];else{if(_0x573575[0x0][_0x37cc3e(0x13f)]=='Chinese')var _0x2dba54=users[_0x37cc3e(0xfb)];else{if(_0x573575[0x0]['language']==_0x37cc3e(0x155))var _0x2dba54=users[_0x37cc3e(0xf0)];}}}}}}}_0x551216['render'](_0x37cc3e(0x15e),{'success':_0x2c0f44[_0x37cc3e(0x134)]('success'),'errors':_0x2c0f44[_0x37cc3e(0x134)]('errors'),'role':_0x16ef4d,'profile':_0x37814a,'master_shop':_0x573575,'supplier':_0x553be0,'purchase':_0x1dae98,'language':_0x2dba54});}catch(_0x24b9c4){console[_0x37cc3e(0xff)](_0x24b9c4);}}),router[a0_0x268949(0x15b)](a0_0x268949(0x136),auth,async(_0x4363a1,_0x2ca4ae)=>{const _0x13a0ea=a0_0x268949;try{const _0x1f5f2d=_0x4363a1[_0x13a0ea(0x14f)]['id'],{invoice:_0xe39768,suppliers:_0x31b515,receivable_amount:_0x29ab4f,received_amount:_0x41824e}=_0x4363a1[_0x13a0ea(0x10d)],_0x461cd1=await purchases_return['findById'](_0x1f5f2d);console[_0x13a0ea(0xff)](_0x461cd1);var _0x2060a1=_0x29ab4f-_0x41824e;console[_0x13a0ea(0xff)](_0x41824e),_0x461cd1['received']=parseFloat(_0x41824e)+parseFloat(_0x461cd1['received']),_0x461cd1[_0x13a0ea(0x10e)]=_0x2060a1,console[_0x13a0ea(0xff)](_0x461cd1);const _0x5249b6=await _0x461cd1[_0x13a0ea(0x124)](),_0x5b9932=await s_payment_data[_0x13a0ea(0x126)]({'invoice':_0x4363a1[_0x13a0ea(0x10d)][_0x13a0ea(0x152)],'reason':'Purchase\x20Return'});_0x5b9932['amount']=_0x2060a1,await _0x5b9932[_0x13a0ea(0x124)]();let _0x32de89=new Date(),_0x3031e2=('0'+_0x32de89[_0x13a0ea(0xf4)]())['slice'](-0x2),_0x2eb02f=('0'+(_0x32de89['getMonth']()+0x1))['slice'](-0x2),_0x3165e0=_0x32de89['getFullYear'](),_0x15a584=_0x3165e0+'-'+_0x2eb02f+'-'+_0x3031e2;const _0x29cb09=new suppliers_payment({'invoice':_0xe39768,'date':_0x3165e0+'-'+_0x2eb02f+'-'+_0x3031e2,'suppliers':_0x31b515,'reason':_0x13a0ea(0x150),'amount':_0x41824e}),_0x13139c=await _0x29cb09['save']();_0x4363a1['flash'](_0x13a0ea(0x105),_0x13a0ea(0x14e)),_0x2ca4ae['redirect'](_0x13a0ea(0x102));}catch(_0x2c7178){console[_0x13a0ea(0xff)](_0x2c7178);}}),module[a0_0x268949(0x158)]=router;