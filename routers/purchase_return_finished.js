const a0_0x4d16f3=a0_0xe8cd;(function(_0xd688f0,_0x19362b){const _0x54c23e=a0_0xe8cd,_0x297e91=_0xd688f0();while(!![]){try{const _0x51763d=-parseInt(_0x54c23e(0x135))/0x1+parseInt(_0x54c23e(0x161))/0x2+-parseInt(_0x54c23e(0x102))/0x3+-parseInt(_0x54c23e(0x15e))/0x4*(-parseInt(_0x54c23e(0x126))/0x5)+-parseInt(_0x54c23e(0x10e))/0x6+-parseInt(_0x54c23e(0x105))/0x7*(parseInt(_0x54c23e(0x117))/0x8)+parseInt(_0x54c23e(0x112))/0x9*(parseInt(_0x54c23e(0x12a))/0xa);if(_0x51763d===_0x19362b)break;else _0x297e91['push'](_0x297e91['shift']());}catch(_0x1ee208){_0x297e91['push'](_0x297e91['shift']());}}}(a0_0x3d1a,0x4bf07));function a0_0x3d1a(){const _0x2efc19=['primary_code_hide','aggregate','$return_product.total','back','room','purchase\x20return\x20successfully','exports','274283fPORIA','return_qty','redirect','../models/all_models','find','$product_details.bin','$product_details.type','$return_product.product_name','$note','stock_quantity','body','stocks','$product_details._id','$receivable','/purchases_return/view','$product_details.product_code','product_stock','$product_details.secondary_code','findOne','$product_details.product_stock','save','flash','stock_data','map','$discount','English\x20(US)','findById','$name','forEach','user','German','purchase_quantity','params','French','product_code_hide','note','Enabled','Portuguese\x20(BR)','level','invoice','master','4dbirKN','$return_product.return_qty','$product_details','1192570UNuHrP','to_room','message','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','secondary_code_hide','to_warehouse_name','json','../middleware/auth','name','Router','primary_code','/purchases_return_finished/view','product_details','suppliers','$product_details.storage','bay','/receive_payment/:id','express','$product_details.product_name','../public/language/languages.json','$_id','Finished\x20Goods','warehouse_name','$supplier_docs.mobile','Purchase\x20Return','215949oKHUMi','product_name','English','14987irlnei','string','return_purchase_edit_finished','$product_details.bay','$invoice','$product_details.primary_code','/invoice/:id','language','errors','594882rQxJDv','payment\x20successfull','purchases_return_finished','$return_product.price','9IfUrvx','Chinese','date','$received','received','1904llxaNU','render','Arabic','email','Arabic\x20(ae)','Hindi','Spanish','slice','log','status','supplier_docs','post','/view/:id','return_product','Portuguese','907830yiHvVg','get','$product_details.rack','success','4881670oDVSiF','getMonth','$suppliers','to_Room_name'];a0_0x3d1a=function(){return _0x2efc19;};return a0_0x3d1a();}const express=require(a0_0x4d16f3(0xfa)),app=express(),router=express[a0_0x4d16f3(0xf2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,purchases_return_finished}=require(a0_0x4d16f3(0x138)),auth=require(a0_0x4d16f3(0xf0)),users=require(a0_0x4d16f3(0xfc));function a0_0xe8cd(_0x2df5b6,_0x601028){const _0x3d1a04=a0_0x3d1a();return a0_0xe8cd=function(_0xe8cdb2,_0x1aacbd){_0xe8cdb2=_0xe8cdb2-0xef;let _0xd897be=_0x3d1a04[_0xe8cdb2];return _0xd897be;},a0_0xe8cd(_0x2df5b6,_0x601028);}router[a0_0x4d16f3(0x127)]('/view',auth,async(_0x8a05d6,_0x123f05)=>{const _0x111d9d=a0_0x4d16f3;try{const {username:_0x45049a,email:_0x1e2486,role:_0x5d7468}=_0x8a05d6[_0x111d9d(0x152)],_0x4bb842=_0x8a05d6[_0x111d9d(0x152)],_0x20a8a8=await profile[_0x111d9d(0x147)]({'email':_0x4bb842[_0x111d9d(0x11a)]}),_0x598c49=await master_shop[_0x111d9d(0x139)]();console[_0x111d9d(0x11f)](_0x111d9d(0x15d),_0x598c49);const _0x174d2b=await purchases_return_finished[_0x111d9d(0x12f)]([{'$lookup':{'from':_0x111d9d(0xf6),'localField':_0x111d9d(0xf6),'foreignField':_0x111d9d(0xf1),'as':_0x111d9d(0x121)}},{'$unwind':'$return_product'},{'$unwind':'$supplier_docs'},{'$group':{'_id':_0x111d9d(0xfd),'invoice':{'$first':_0x111d9d(0x109)},'date':{'$first':'$date'},'suppliers':{'$first':_0x111d9d(0x12c)},'warehouse_name':{'$first':'$warehouse_name'},'product_name':{'$first':_0x111d9d(0x13c)},'return_qty':{'$first':_0x111d9d(0x15f)},'price':{'$first':_0x111d9d(0x111)},'total':{'$sum':_0x111d9d(0x130)},'note':{'$first':_0x111d9d(0x13d)},'total_amount':{'$first':'$total_amount'},'discount':{'$first':_0x111d9d(0x14d)},'receivable':{'$first':_0x111d9d(0x142)},'received':{'$first':_0x111d9d(0x115)},'due_amount':{'$first':'$due_amount'},'mobile':{'$first':_0x111d9d(0x100)},'email':{'$first':'$supplier_docs.email'},'address':{'$first':'$supplier_docs.address'},'return_sum_qty':{'$sum':_0x111d9d(0x15f)}}}]);console[_0x111d9d(0x11f)](_0x174d2b);if(_0x598c49[0x0]['language']==_0x111d9d(0x14e)){var _0x37d132=users[_0x111d9d(0x104)];console[_0x111d9d(0x11f)](_0x37d132);}else{if(_0x598c49[0x0][_0x111d9d(0x10c)]==_0x111d9d(0x11c))var _0x37d132=users[_0x111d9d(0x11c)];else{if(_0x598c49[0x0]['language']==_0x111d9d(0x153))var _0x37d132=users[_0x111d9d(0x153)];else{if(_0x598c49[0x0]['language']==_0x111d9d(0x11d))var _0x37d132=users[_0x111d9d(0x11d)];else{if(_0x598c49[0x0][_0x111d9d(0x10c)]==_0x111d9d(0x156))var _0x37d132=users['French'];else{if(_0x598c49[0x0][_0x111d9d(0x10c)]==_0x111d9d(0x15a))var _0x37d132=users[_0x111d9d(0x125)];else{if(_0x598c49[0x0][_0x111d9d(0x10c)]==_0x111d9d(0x113))var _0x37d132=users['Chinese'];else{if(_0x598c49[0x0][_0x111d9d(0x10c)]==_0x111d9d(0x11b))var _0x37d132=users[_0x111d9d(0x119)];}}}}}}}_0x123f05['render'](_0x111d9d(0x110),{'success':_0x8a05d6[_0x111d9d(0x14a)]('success'),'errors':_0x8a05d6[_0x111d9d(0x14a)]('errors'),'role':_0x4bb842,'profile':_0x20a8a8,'master_shop':_0x598c49,'user':_0x174d2b,'language':_0x37d132});}catch(_0x40bbe4){console['log'](_0x40bbe4);}}),router[a0_0x4d16f3(0x127)](a0_0x4d16f3(0x123),auth,async(_0x48d4a9,_0x4d23d1)=>{const _0x5db079=a0_0x4d16f3;try{const {username:_0x15556b,email:_0x39be93,role:_0x359c66}=_0x48d4a9[_0x5db079(0x152)],_0xaf27ed=_0x48d4a9[_0x5db079(0x152)],_0x592271=await profile[_0x5db079(0x147)]({'email':_0xaf27ed[_0x5db079(0x11a)]}),_0x3ca7fe=await product[_0x5db079(0x139)]({}),_0x292f4c=await master_shop[_0x5db079(0x139)](),_0x4ea926=_0x48d4a9[_0x5db079(0x155)]['id'],_0x49d538=await purchases_return_finished[_0x5db079(0x14f)](_0x4ea926),_0x2696c2=await warehouse[_0x5db079(0x12f)]([{'$match':{'name':_0x49d538['warehouse_name'],'room':_0x49d538[_0x5db079(0x132)],'warehouse_category':_0x5db079(0xfe)}},{'$unwind':_0x5db079(0x160)},{'$group':{'_id':_0x5db079(0x141),'name':{'$first':_0x5db079(0xfb)},'product_stock':{'$first':_0x5db079(0x148)},'bay':{'$first':_0x5db079(0x108)},'bin':{'$first':_0x5db079(0x13a)},'type':{'$first':_0x5db079(0x13b)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5db079(0x10a)},'secondary_code':{'$first':_0x5db079(0x146)},'product_code':{'$first':_0x5db079(0x144)},'storage':{'$first':_0x5db079(0xf7)},'rack':{'$first':_0x5db079(0x128)}}}]);warehouse_data=await warehouse[_0x5db079(0x12f)]([{'$match':{'status':_0x5db079(0x159),'name':'Return\x20Goods','warehouse_category':_0x5db079(0xfe)}},{'$group':{'_id':_0x5db079(0x150),'name':{'$first':_0x5db079(0x150)}}},{'$sort':{'name':0x1}}]),console[_0x5db079(0x11f)](_0x5db079(0x14b),_0x2696c2);if(_0x292f4c[0x0]['language']==_0x5db079(0x14e)){var _0x8862b7=users['English'];console[_0x5db079(0x11f)](_0x8862b7);}else{if(_0x292f4c[0x0][_0x5db079(0x10c)]=='Hindi')var _0x8862b7=users[_0x5db079(0x11c)];else{if(_0x292f4c[0x0][_0x5db079(0x10c)]=='German')var _0x8862b7=users[_0x5db079(0x153)];else{if(_0x292f4c[0x0]['language']=='Spanish')var _0x8862b7=users[_0x5db079(0x11d)];else{if(_0x292f4c[0x0]['language']==_0x5db079(0x156))var _0x8862b7=users['French'];else{if(_0x292f4c[0x0]['language']==_0x5db079(0x15a))var _0x8862b7=users[_0x5db079(0x125)];else{if(_0x292f4c[0x0][_0x5db079(0x10c)]=='Chinese')var _0x8862b7=users[_0x5db079(0x113)];else{if(_0x292f4c[0x0][_0x5db079(0x10c)]==_0x5db079(0x11b))var _0x8862b7=users[_0x5db079(0x119)];}}}}}}}_0x4d23d1[_0x5db079(0x118)](_0x5db079(0x107),{'success':_0x48d4a9['flash']('success'),'errors':_0x48d4a9[_0x5db079(0x14a)](_0x5db079(0x10d)),'role':_0xaf27ed,'master_shop':_0x292f4c,'profile':_0x592271,'user':_0x49d538,'stock':_0x2696c2,'product':_0x3ca7fe,'language':_0x8862b7,'warehouse':warehouse_data});}catch(_0x1b338c){console[_0x5db079(0x11f)](_0x1b338c);}}),router[a0_0x4d16f3(0x122)](a0_0x4d16f3(0x123),auth,async(_0x22daea,_0x152a8d)=>{const _0x4febe5=a0_0x4d16f3;try{const _0x519f58=_0x22daea['params']['id'],_0x216d33=await purchases_return_finished[_0x4febe5(0x147)]({'invoice':_0x22daea['body']['invoice']}),_0x47dad5=await warehouse[_0x4febe5(0x147)]({'name':_0x216d33[_0x4febe5(0x166)],'room':_0x216d33[_0x4febe5(0x162)],'warehouse_category':_0x4febe5(0xfe)}),{invoice:_0x5487a6,suppliers:_0x53154c,date:_0x1613ac,warehouse_name:_0x3268fd,product_name:_0x5f0bcb,purchase_quantity:_0x25c829,stocks:_0x31c7ae,return_qty:_0x372cc1,note:_0x39ce44,Room_name:_0x5e16f1,level:_0x2fae8b,isle:_0x494952,pallet:_0x49a396,to_warehouse_name:_0x30a854,to_Room_name:_0x2494ab}=_0x22daea[_0x4febe5(0x13f)];if(typeof _0x5f0bcb==_0x4febe5(0x106))var _0x180ca8=[_0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x103)]],_0xe3f63f=[_0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x154)]],_0x374bed=[_0x22daea['body'][_0x4febe5(0x140)]],_0x5266ef=[_0x22daea[_0x4febe5(0x13f)]['return_qty']],_0x539335=[_0x22daea['body']['level']],_0x11fa3e=[_0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x157)]],_0x2d948e=[_0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x12e)]],_0x14298f=[_0x22daea[_0x4febe5(0x13f)]['secondary_code_hide']];else var _0x180ca8=[..._0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x103)]],_0xe3f63f=[..._0x22daea[_0x4febe5(0x13f)]['purchase_quantity']],_0x374bed=[..._0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x140)]],_0x5266ef=[..._0x22daea[_0x4febe5(0x13f)]['return_qty']],_0x539335=[..._0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x15b)]],_0x11fa3e=[..._0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x157)]],_0x2d948e=[..._0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x12e)]],_0x14298f=[..._0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x165)]];const _0x43e483=_0x180ca8[_0x4febe5(0x14c)](_0x49db5e=>{return _0x49db5e={'product_name':_0x49db5e};});_0xe3f63f['forEach']((_0x42caad,_0xabc1d3)=>{const _0x22fae3=_0x4febe5;_0x43e483[_0xabc1d3][_0x22fae3(0x154)]=_0x42caad;}),_0x374bed[_0x4febe5(0x151)]((_0x394a68,_0x23f376)=>{const _0x5985d9=_0x4febe5;_0x43e483[_0x23f376][_0x5985d9(0x13e)]=_0x394a68;}),_0x5266ef[_0x4febe5(0x151)]((_0x47f560,_0x3b517e)=>{const _0x4f9dbc=_0x4febe5;_0x43e483[_0x3b517e][_0x4f9dbc(0x136)]=_0x47f560;}),_0x539335[_0x4febe5(0x151)]((_0x30deff,_0x12f4c9)=>{const _0x270fe3=_0x4febe5;_0x43e483[_0x12f4c9][_0x270fe3(0xf8)]=_0x30deff;}),_0x11fa3e[_0x4febe5(0x151)]((_0x4c3583,_0x23fee3)=>{_0x43e483[_0x23fee3]['product_code']=_0x4c3583;}),_0x2d948e['forEach']((_0x3ff708,_0x252d98)=>{const _0x535ff7=_0x4febe5;_0x43e483[_0x252d98][_0x535ff7(0xf3)]=_0x3ff708;}),_0x14298f[_0x4febe5(0x151)]((_0x3ce7b0,_0xb540e4)=>{_0x43e483[_0xb540e4]['secondary_code']=_0x3ce7b0;});var _0x50629c=0x0;_0x43e483[_0x4febe5(0x151)](_0x109b8e=>{const _0x572c4e=_0x4febe5;(parseInt(_0x109b8e[_0x572c4e(0x154)])<parseInt(_0x109b8e[_0x572c4e(0x136)])||parseInt(_0x109b8e[_0x572c4e(0x13e)])<parseInt(_0x109b8e[_0x572c4e(0x136)]))&&_0x50629c++;});if(_0x50629c!=0x0)return _0x22daea[_0x4febe5(0x14a)](_0x4febe5(0x10d),_0x4febe5(0x164)),_0x152a8d[_0x4febe5(0x137)](_0x4febe5(0x131));_0x216d33[_0x4febe5(0x124)][_0x4febe5(0x151)](_0x305b9b=>{const _0x32c42f=_0x4febe5;if(_0x305b9b[_0x32c42f(0x136)]>0x0){const _0x1ed4e1=_0x47dad5[_0x32c42f(0xf5)]['map'](_0x3e91e4=>{const _0x50f4e0=_0x32c42f;_0x3e91e4[_0x50f4e0(0x103)]==_0x305b9b[_0x50f4e0(0x103)]&&_0x3e91e4[_0x50f4e0(0xf8)]==_0x305b9b[_0x50f4e0(0xf8)]&&(_0x3e91e4[_0x50f4e0(0x145)]=parseInt(_0x3e91e4[_0x50f4e0(0x145)])+parseInt(_0x305b9b['return_qty']));});}}),await _0x47dad5[_0x4febe5(0x149)](),_0x216d33[_0x4febe5(0x15c)]=_0x5487a6,_0x216d33[_0x4febe5(0xf6)]=_0x53154c,_0x216d33[_0x4febe5(0x114)]=_0x1613ac,_0x216d33[_0x4febe5(0xff)]=_0x3268fd,_0x216d33['return_product']=_0x43e483,_0x216d33[_0x4febe5(0x158)]=_0x39ce44,_0x216d33[_0x4febe5(0x132)]=_0x5e16f1,_0x216d33[_0x4febe5(0x166)]=_0x30a854,_0x216d33[_0x4febe5(0x162)]=_0x2494ab;const _0x1ebf8d=await _0x216d33['save'](),_0x62577b=await purchases_return_finished[_0x4febe5(0x147)]({'invoice':_0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x15c)]}),_0x43856b=await warehouse[_0x4febe5(0x147)]({'name':_0x22daea[_0x4febe5(0x13f)][_0x4febe5(0x166)],'room':_0x22daea['body'][_0x4febe5(0x12d)],'warehouse_category':_0x4febe5(0xfe)});_0x62577b[_0x4febe5(0x124)]['forEach'](_0x1d2a88=>{const _0x20cb85=_0x4febe5;_0x43856b[_0x20cb85(0xf5)]['map'](_0x3de0a4=>{const _0x3d2e09=_0x20cb85;_0x3de0a4[_0x3d2e09(0x103)]==_0x1d2a88['product_name']&&_0x3de0a4[_0x3d2e09(0xf8)]==_0x1d2a88['bay']&&(_0x3de0a4[_0x3d2e09(0x145)]=parseInt(_0x3de0a4[_0x3d2e09(0x145)])-parseInt(_0x1d2a88['return_qty']));});}),await _0x43856b[_0x4febe5(0x149)]();const _0x2ab28d=await s_payment_data[_0x4febe5(0x147)]({'invoice':_0x22daea[_0x4febe5(0x13f)]['invoice'],'reason':_0x4febe5(0x101)});await _0x2ab28d[_0x4febe5(0x149)](),_0x22daea[_0x4febe5(0x14a)](_0x4febe5(0x129),_0x4febe5(0x133)),_0x152a8d[_0x4febe5(0x137)](_0x4febe5(0xf4));}catch(_0x408c4c){console['log'](_0x408c4c),_0x152a8d[_0x4febe5(0x120)](0xc8)[_0x4febe5(0xef)]({'message':_0x408c4c[_0x4febe5(0x163)]});}}),router['get'](a0_0x4d16f3(0x10b),auth,async(_0x38113f,_0x1fefaa)=>{const _0x56598f=a0_0x4d16f3;try{const {username:_0x3887d4,email:_0x3c46f6,role:_0x551483}=_0x38113f[_0x56598f(0x152)],_0x56f8be=_0x38113f[_0x56598f(0x152)],_0x168802=await profile[_0x56598f(0x147)]({'email':_0x56f8be[_0x56598f(0x11a)]}),_0x475447=await master_shop['find']();console['log'](_0x56598f(0x15d),_0x475447);const _0x189b71=_0x38113f[_0x56598f(0x155)]['id'],_0x26ddc5=await purchases_return['findById'](_0x189b71);console[_0x56598f(0x11f)](_0x26ddc5);const _0x4ec233=await suppliers['findOne']({'name':_0x26ddc5[_0x56598f(0xf6)]});console[_0x56598f(0x11f)](_0x4ec233);if(_0x475447[0x0][_0x56598f(0x10c)]==_0x56598f(0x14e)){var _0x534dba=users['English'];console[_0x56598f(0x11f)](_0x534dba);}else{if(_0x475447[0x0][_0x56598f(0x10c)]==_0x56598f(0x11c))var _0x534dba=users['Hindi'];else{if(_0x475447[0x0][_0x56598f(0x10c)]==_0x56598f(0x153))var _0x534dba=users[_0x56598f(0x153)];else{if(_0x475447[0x0][_0x56598f(0x10c)]==_0x56598f(0x11d))var _0x534dba=users[_0x56598f(0x11d)];else{if(_0x475447[0x0][_0x56598f(0x10c)]==_0x56598f(0x156))var _0x534dba=users['French'];else{if(_0x475447[0x0]['language']==_0x56598f(0x15a))var _0x534dba=users[_0x56598f(0x125)];else{if(_0x475447[0x0]['language']==_0x56598f(0x113))var _0x534dba=users[_0x56598f(0x113)];else{if(_0x475447[0x0][_0x56598f(0x10c)]==_0x56598f(0x11b))var _0x534dba=users[_0x56598f(0x119)];}}}}}}}_0x1fefaa[_0x56598f(0x118)]('return_purchase_invoice',{'success':_0x38113f['flash'](_0x56598f(0x129)),'errors':_0x38113f[_0x56598f(0x14a)](_0x56598f(0x10d)),'role':_0x56f8be,'profile':_0x168802,'master_shop':_0x475447,'supplier':_0x4ec233,'purchase':_0x26ddc5,'language':_0x534dba});}catch(_0x2f89fd){console[_0x56598f(0x11f)](_0x2f89fd);}}),router[a0_0x4d16f3(0x122)](a0_0x4d16f3(0xf9),auth,async(_0x1ee762,_0x2d96ca)=>{const _0x4e937b=a0_0x4d16f3;try{const _0x5c34ef=_0x1ee762['params']['id'],{invoice:_0x44fa4d,suppliers:_0x49c806,receivable_amount:_0x55d34f,received_amount:_0x48a3fb}=_0x1ee762[_0x4e937b(0x13f)],_0x530635=await purchases_return[_0x4e937b(0x14f)](_0x5c34ef);console[_0x4e937b(0x11f)](_0x530635);var _0xf42770=_0x55d34f-_0x48a3fb;console[_0x4e937b(0x11f)](_0x48a3fb),_0x530635[_0x4e937b(0x116)]=parseFloat(_0x48a3fb)+parseFloat(_0x530635[_0x4e937b(0x116)]),_0x530635['due_amount']=_0xf42770,console[_0x4e937b(0x11f)](_0x530635);const _0x1fd42=await _0x530635['save'](),_0x1e9706=await s_payment_data[_0x4e937b(0x147)]({'invoice':_0x1ee762[_0x4e937b(0x13f)]['invoice'],'reason':_0x4e937b(0x101)});_0x1e9706['amount']=_0xf42770,await _0x1e9706['save']();let _0x475baa=new Date(),_0x5a5e7c=('0'+_0x475baa['getDate']())[_0x4e937b(0x11e)](-0x2),_0x679cae=('0'+(_0x475baa[_0x4e937b(0x12b)]()+0x1))[_0x4e937b(0x11e)](-0x2),_0x357ec1=_0x475baa['getFullYear'](),_0x4dcc53=_0x357ec1+'-'+_0x679cae+'-'+_0x5a5e7c;const _0x24cd45=new suppliers_payment({'invoice':_0x44fa4d,'date':_0x357ec1+'-'+_0x679cae+'-'+_0x5a5e7c,'suppliers':_0x49c806,'reason':'Received\x20For\x20Purchase\x20Return','amount':_0x48a3fb}),_0x793032=await _0x24cd45[_0x4e937b(0x149)]();_0x1ee762[_0x4e937b(0x14a)](_0x4e937b(0x129),_0x4e937b(0x10f)),_0x2d96ca['redirect'](_0x4e937b(0x143));}catch(_0x3215f0){console[_0x4e937b(0x11f)](_0x3215f0);}}),module[a0_0x4d16f3(0x134)]=router;