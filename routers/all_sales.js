var a0_0x33bc05=a0_0x4f76;(function(_0x552aeb,_0x59c815){var _0x2b6343=a0_0x4f76,_0x4da86e=_0x552aeb();while(!![]){try{var _0x511f19=-parseInt(_0x2b6343(0xbf))/0x1*(parseInt(_0x2b6343(0xca))/0x2)+parseInt(_0x2b6343(0x10a))/0x3+-parseInt(_0x2b6343(0x191))/0x4*(parseInt(_0x2b6343(0xef))/0x5)+-parseInt(_0x2b6343(0x1a5))/0x6*(-parseInt(_0x2b6343(0x11e))/0x7)+parseInt(_0x2b6343(0x159))/0x8+parseInt(_0x2b6343(0x1ab))/0x9+-parseInt(_0x2b6343(0x18c))/0xa*(-parseInt(_0x2b6343(0x103))/0xb);if(_0x511f19===_0x59c815)break;else _0x4da86e['push'](_0x4da86e['shift']());}catch(_0x941009){_0x4da86e['push'](_0x4da86e['shift']());}}}(a0_0xe36e,0x3b023));const express=require(a0_0x33bc05(0xe5)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x33bc05(0x19f)),auth=require(a0_0x33bc05(0xed)),nodemailer=require(a0_0x33bc05(0x134)),users=require(a0_0x33bc05(0x161));router[a0_0x33bc05(0x123)](a0_0x33bc05(0x166),auth,async(_0x7a8926,_0x5ef6fd)=>{var _0x2ad6be=a0_0x33bc05;try{const {username:_0xd328e7,email:_0x444fb2,role:_0x3d0a77}=_0x7a8926[_0x2ad6be(0x19b)],_0x77445f=_0x7a8926['user'],_0x3105d1=await profile[_0x2ad6be(0x151)]({'email':_0x77445f[_0x2ad6be(0xc1)]}),_0x1a9182=await master_shop[_0x2ad6be(0xf9)]();let _0x4d8ea4;if(_0x77445f[_0x2ad6be(0xfd)]==_0x2ad6be(0xdd)){const _0x613fb5=await staff['findOne']({'email':_0x77445f[_0x2ad6be(0xc1)]});_0x4d8ea4=await sales[_0x2ad6be(0xb9)]([{'$lookup':{'from':_0x2ad6be(0xd4),'localField':_0x2ad6be(0x14a),'foreignField':_0x2ad6be(0x13e),'as':_0x2ad6be(0xf6)}},{'$unwind':_0x2ad6be(0x14e)},{'$unwind':_0x2ad6be(0x153)},{'$group':{'_id':_0x2ad6be(0x199),'invoice':{'$first':_0x2ad6be(0x195)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2ad6be(0xac)},'sale_product':{'$push':_0x2ad6be(0x153)},'note':{'$first':_0x2ad6be(0x172)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x2ad6be(0xbb)},'level':{'$addToSet':_0x2ad6be(0xd3)},'isle':{'$addToSet':_0x2ad6be(0x15c)},'type':{'$addToSet':_0x2ad6be(0x113)},'pallet':{'$addToSet':_0x2ad6be(0x12c)},'finalize':{'$first':_0x2ad6be(0x171)},'isAllowEdit':{'$first':_0x2ad6be(0xe7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x4d8ea4=await sales['aggregate']([{'$lookup':{'from':_0x2ad6be(0xd4),'localField':_0x2ad6be(0x14a),'foreignField':_0x2ad6be(0x13e),'as':'customers_docs'}},{'$unwind':_0x2ad6be(0x14e)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x2ad6be(0x199),'invoice':{'$first':_0x2ad6be(0x195)},'customers':{'$first':_0x2ad6be(0x117)},'date':{'$first':_0x2ad6be(0xde)},'warehouse_name':{'$first':_0x2ad6be(0xac)},'sale_product':{'$push':_0x2ad6be(0x153)},'note':{'$first':'$note'},'return_data':{'$first':_0x2ad6be(0x12e)},'customers_docs':{'$first':_0x2ad6be(0x14e)},'total_saleproduct_quantity':{'$sum':_0x2ad6be(0xbb)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x2ad6be(0x15c)},'type':{'$addToSet':_0x2ad6be(0x113)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x2ad6be(0x171)},'isAllowEdit':{'$first':_0x2ad6be(0xe7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x2ad6be(0x110)]('sales\x20all_data',_0x4d8ea4);if(_0x1a9182[0x0][_0x2ad6be(0x14c)]==_0x2ad6be(0xe2)){var _0xe9d5da=users[_0x2ad6be(0x104)];console[_0x2ad6be(0x110)](_0xe9d5da);}else{if(_0x1a9182[0x0][_0x2ad6be(0x14c)]==_0x2ad6be(0x11f))var _0xe9d5da=users[_0x2ad6be(0x11f)];else{if(_0x1a9182[0x0][_0x2ad6be(0x14c)]==_0x2ad6be(0x138))var _0xe9d5da=users[_0x2ad6be(0x138)];else{if(_0x1a9182[0x0][_0x2ad6be(0x14c)]==_0x2ad6be(0xd7))var _0xe9d5da=users[_0x2ad6be(0xd7)];else{if(_0x1a9182[0x0][_0x2ad6be(0x14c)]==_0x2ad6be(0xfa))var _0xe9d5da=users[_0x2ad6be(0xfa)];else{if(_0x1a9182[0x0]['language']==_0x2ad6be(0x13b))var _0xe9d5da=users['Portuguese'];else{if(_0x1a9182[0x0][_0x2ad6be(0x14c)]=='Chinese')var _0xe9d5da=users[_0x2ad6be(0x18d)];else{if(_0x1a9182[0x0][_0x2ad6be(0x14c)]==_0x2ad6be(0xaa))var _0xe9d5da=users[_0x2ad6be(0x194)];}}}}}}}_0x5ef6fd[_0x2ad6be(0xe8)]('all_sales',{'success':_0x7a8926[_0x2ad6be(0x16e)](_0x2ad6be(0x15e)),'errors':_0x7a8926[_0x2ad6be(0x16e)]('errors'),'sales':_0x4d8ea4,'profile':_0x3105d1,'role':_0x77445f,'master_shop':_0x1a9182,'language':_0xe9d5da});}catch(_0x1d3dac){console['log'](_0x1d3dac);}});async function getRandom8DigitNumber(){var _0x5461fd=a0_0x33bc05;const _0x40ff7e=0x989680,_0x474d04=0x5f5e0ff,_0x18f7fb=Math['floor'](Math[_0x5461fd(0xba)]()*(_0x474d04-_0x40ff7e+0x1))+_0x40ff7e;var _0x5c5b7e;const _0x182dc4=await sales['findOne']({'invoice':_0x5461fd(0xcc)+_0x18f7fb});return _0x182dc4&&_0x182dc4[_0x5461fd(0x136)]>0x0?_0x5c5b7e=_0x5461fd(0xcc)+_0x18f7fb:_0x5c5b7e=_0x5461fd(0xcc)+_0x18f7fb,_0x5c5b7e;}function a0_0x4f76(_0x30f962,_0x44584b){var _0xe36e14=a0_0xe36e();return a0_0x4f76=function(_0x4f76fe,_0x2d83bf){_0x4f76fe=_0x4f76fe-0xa4;var _0x3bec2b=_0xe36e14[_0x4f76fe];return _0x3bec2b;},a0_0x4f76(_0x30f962,_0x44584b);}function a0_0xe36e(){var _0x14d9d0=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Email\x20sent\x20successfully','$product_details.invoice','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Sales\x20Update\x20successfully','master','id_transaction_from','408xdzkwQ','False','isAllowEdit','actual_qty','</tbody>','password','333225JTCmvF','An\x20error\x20occurred.','slice','</td>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<div>','<tr>','Arabic\x20(ae)','Logo.png','$warehouse_name','bay','edit_sales','stocks','/give_payment/:id','purchases_data','forEach','/invoice/:id','exports','<strong>\x20Regards\x20</strong>','quantity','primary_unit','$product_details.storage','aggregate','random','$sale_product.quantity','$product_details.pallet','$product_details.unit','currency','5386GPfYbb','payment\x20successfull','email','rack','storage','max','$product_details.product_cat','$product_details.secondary_code','unit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Enabled','26SNHjIJ','</span>','OUT-','sendMail','\x20Order\x20Number\x20:\x20','post','SCRN','$product_details.rack','/upload/','$sale_product.bay','customers','_id','Ambient','Spanish','\x20Order\x20Date\x20:\x20','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.secondary_unit','/all_sales/view','staff','$date','$product_details._id','filter','Enclosed','English\x20(US)','Sale\x20Return\x20Mail','id_transact','express','$product_details.batch_code','$isAllowEdit','render','<html><head><title></title>','</table>','/barcode/:id','stock','../middleware/auth','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','465sWGYTq','amount','secondary_unit','product_details','$product_details.actual_uom','type','string','customers_docs','carton','product_stock','find','French','product_code','createTransport','role','delivery_code','Error\x20Occurs','warehouse','$name','$product_details.maxPerUnit','297LPsSCk','English','/preview/:id','foreach\x20newproduct','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','date','727581bLwcdP','$product_details.isle','body','/view/:id','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','padStart','log','prod_invoice','$product_details.bay','$sale_product.type','$product_details.production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<h2>\x20','$customer','True','product_data','$product_details.type','$room','abs','invoice','5005MygMuV','Hindi','prod_cat','expiry_date','product_list','get','$product_details.product_name','/barcode_scanner','secondary_code','$product_details','An\x20error\x20occurred\x20while\x20saving\x20data.','<span\x20style=\x22float:\x20right;\x22>','quantity_notConverted','Portuguese','$sale_product.floorlevel','$product_details.product_code','$return_data','product_name','bin','$product_details.product_stock','catch','delivery_date','nodemailer','$product_details.level','length','Raw\x20Materials','German','RoomAssigned','Received\x20Payment\x20For\x20Sale','Portuguese\x20(BR)','level','save','name','$product_details.primary_code','$product','<table\x20style=\x22width:\x20100%\x20!important;\x22>','max_per_unit','batch_code','floorlevel','requested_qty','status','<h5>','<h5\x20style=\x22text-align:\x20left;\x22>','<hr\x20class=\x22my-3\x22>','customer','all','language','getMonth','$customers_docs','concat','received_amount','findOne','Return\x20Rooms','$sale_product','params','Floor','There\x27s\x20a\x20error\x20in\x20this\x20transaction','product','push','1322976XFvovB','sales_quantity','warehouse_name','$sale_product.bin','errors','success','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','sale_product','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','stock_data','/view/add_sales','/view/return_sales/:id','/view','logo','</body></html>','types','return_sale','Sales\x20Add\x20successfully','due_amount','map','flash','findById','/../public','$finalize','$note','$product_details.floorlevel','getFullYear','Return\x20Goods','finalize','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</h5>','RMSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</thead>','return_qty','image','customer_data','$product_details.expiry_date','add_sales','prod_code','json','message','</div>','sale_qty','</tr>','production_date','site_title','room_name','/all_sales/preview/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','2200xMDGcj','Chinese','split','actual_uom','Receiving\x20Area','8076NkThKc','room','redirect','Arabic','$invoice','<!DOCTYPE\x20html>','primary_code','$product_details.bin','$_id','Level','user'];a0_0xe36e=function(){return _0x14d9d0;};return a0_0xe36e();}router['get'](a0_0x33bc05(0x164),auth,async(_0x2b054c,_0x8f3e7c)=>{var _0x1ab5ca=a0_0x33bc05;try{const {username:_0x4804d0,email:_0xa994b2,role:_0x42a1cd}=_0x2b054c[_0x1ab5ca(0x19b)],_0x5a4977=_0x2b054c['user'],_0x14aaae=await profile[_0x1ab5ca(0x151)]({'email':_0x5a4977[_0x1ab5ca(0xc1)]}),_0x4f24a9=await master_shop[_0x1ab5ca(0xf9)](),_0xbe2df=await customer['find']({});let _0x5dd319;if(_0x5a4977[_0x1ab5ca(0xfd)]=='staff'){const _0x1795f2=await staff[_0x1ab5ca(0x151)]({'email':_0x5a4977[_0x1ab5ca(0xc1)]});_0x5dd319=await warehouse[_0x1ab5ca(0xb9)]([{'$match':{'status':_0x1ab5ca(0xc9),'name':_0x1795f2['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x1ab5ca(0x101)}}},{'$sort':{'name':0x1}}]);}else _0x5dd319=await warehouse[_0x1ab5ca(0xb9)]([{'$match':{'status':_0x1ab5ca(0xc9),'warehouse_category':_0x1ab5ca(0x137),'name':{'$ne':_0x1ab5ca(0x175)}}},{'$group':{'_id':_0x1ab5ca(0x101),'name':{'$first':_0x1ab5ca(0x101)}}},{'$sort':{'name':0x1}}]);const _0x175662=await product['find']({});var _0x2467d3=[_0x1ab5ca(0xd6),'Enclosed'];const _0x1fca6d=await sales[_0x1ab5ca(0xf9)]({}),_0x5f17a8=_0x1fca6d[_0x1ab5ca(0x136)]+0x1,_0xa012d3=_0x1ab5ca(0xcc)+_0x5f17a8['toString']()[_0x1ab5ca(0x10f)](0x5,'0');if(_0x4f24a9[0x0]['language']==_0x1ab5ca(0xe2)){var _0x122772=users[_0x1ab5ca(0x104)];console[_0x1ab5ca(0x110)](_0x122772);}else{if(_0x4f24a9[0x0]['language']=='Hindi')var _0x122772=users[_0x1ab5ca(0x11f)];else{if(_0x4f24a9[0x0][_0x1ab5ca(0x14c)]=='German')var _0x122772=users[_0x1ab5ca(0x138)];else{if(_0x4f24a9[0x0][_0x1ab5ca(0x14c)]=='Spanish')var _0x122772=users[_0x1ab5ca(0xd7)];else{if(_0x4f24a9[0x0]['language']==_0x1ab5ca(0xfa))var _0x122772=users[_0x1ab5ca(0xfa)];else{if(_0x4f24a9[0x0][_0x1ab5ca(0x14c)]==_0x1ab5ca(0x13b))var _0x122772=users[_0x1ab5ca(0x12b)];else{if(_0x4f24a9[0x0][_0x1ab5ca(0x14c)]==_0x1ab5ca(0x18d))var _0x122772=users[_0x1ab5ca(0x18d)];else{if(_0x4f24a9[0x0][_0x1ab5ca(0x14c)]=='Arabic\x20(ae)')var _0x122772=users[_0x1ab5ca(0x194)];}}}}}}}const _0x3de41c=getRandom8DigitNumber();_0x3de41c['then'](_0x573dd8=>{var _0x1a25bc=_0x1ab5ca;_0x8f3e7c['render'](_0x1a25bc(0x180),{'success':_0x2b054c[_0x1a25bc(0x16e)](_0x1a25bc(0x15e)),'errors':_0x2b054c[_0x1a25bc(0x16e)](_0x1a25bc(0x15d)),'role':_0x5a4977,'profile':_0x14aaae,'customer':_0xbe2df,'warehouse':_0x5dd319,'product':_0x175662,'invoice':_0x573dd8,'master_shop':_0x4f24a9,'language':_0x122772,'rooms_data':_0x2467d3});})[_0x1ab5ca(0x132)](_0x3e5beb=>{var _0x7ed0d0=_0x1ab5ca;_0x2b054c[_0x7ed0d0(0x16e)]('errors',_0x7ed0d0(0x156)),_0x8f3e7c['redirect'](_0x7ed0d0(0xdc));});}catch(_0x293e25){console[_0x1ab5ca(0x110)](_0x293e25);}}),router[a0_0x33bc05(0x123)]('/view/add_sales/:id',auth,async(_0x53eec7,_0x270fd9)=>{var _0x55dcf7=a0_0x33bc05;try{const _0x4a708c=_0x53eec7[_0x55dcf7(0x154)]['id'];console[_0x55dcf7(0x110)](_0x4a708c);const _0x5e93c8=await product[_0x55dcf7(0xf9)](),_0x5bd9f0=await purchases[_0x55dcf7(0xb9)]([{'$match':{'warehouse_name':_0x4a708c}},{'$unwind':_0x55dcf7(0x140)},{'$group':{'_id':'$product.product_name'}}]);console[_0x55dcf7(0x110)](_0x55dcf7(0xb1),_0x5bd9f0),_0x270fd9['status'](0xc8)[_0x55dcf7(0x182)]({'purchases_data':_0x5bd9f0,'product_data':_0x5e93c8});}catch(_0x29e692){console['log'](_0x29e692);}}),router[a0_0x33bc05(0xcf)]('/view/add_sale/product',auth,async(_0xc5bdc8,_0x47d24d)=>{var _0x397c4d=a0_0x33bc05;try{const {warehouse_data:_0x251615,product_data:_0x4cecb4}=_0xc5bdc8[_0x397c4d(0x10c)];console[_0x397c4d(0x110)](_0xc5bdc8[_0x397c4d(0x10c)][_0x397c4d(0x119)]);;const _0x5cb932=await master_shop[_0x397c4d(0xf9)]();console[_0x397c4d(0x110)]('master',_0x5cb932);const _0x1e0b5e=await product[_0x397c4d(0x151)]({'name':_0x4cecb4});console[_0x397c4d(0x110)](_0x397c4d(0x157),_0x1e0b5e);const _0x1be377=await warehouse[_0x397c4d(0xb9)]([{'$match':{'name':_0x251615}},{'$unwind':_0x397c4d(0x127)},{'$match':{'product_details.product_name':_0x4cecb4}},{'$group':{'_id':_0x397c4d(0x124),'product_stock':{'$first':_0x397c4d(0x131)}}}]);console['log'](_0x397c4d(0x163),_0x1be377),_0x47d24d['status'](0xc8)[_0x397c4d(0x182)]({'master':_0x5cb932,'new_product':_0x1e0b5e,'stock_data':_0x1be377});}catch(_0x325d58){console[_0x397c4d(0x110)](_0x325d58);}}),router[a0_0x33bc05(0xcf)](a0_0x33bc05(0x164),auth,async(_0x52997d,_0x4e15af)=>{var _0x22982f=a0_0x33bc05;try{const {invoice:_0x39b10f,date:_0x5ce871,warehouse_name:_0x59b015,product_name:_0x2d4887,stock:_0x1bd866,quantity:_0x3f9e31,note:_0x36c54a,room:_0x4b7816,primary_code:_0x4716a3,secondary_code:_0x2a168,prod_code:_0x40afff,level:_0x3329f3,isle:_0x50ae2a,pallet:_0x4ef861,batch_code:_0x46f9bd,SCRN:_0x2f368a,expiry_date:_0x5e15fa}=_0x52997d['body'];if(typeof _0x2d4887==_0x22982f(0xf5))var _0x1548b9=[_0x52997d[_0x22982f(0x10c)]['product_name']],_0x456958=[_0x52997d['body']['stock']],_0x219e14=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0xf7)]],_0x49d1e0=[_0x52997d[_0x22982f(0x10c)]['primary_code']],_0x265db0=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x126)]],_0x191d39=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x181)]],_0x27cb9=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x13c)]],_0x1e3395=[_0x52997d['body']['primary_unit']],_0x21528d=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0xf1)]],_0xa2dc1d=[_0x52997d['body'][_0x22982f(0x143)]],_0xe92871=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x121)]],_0x282762=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x142)]],_0x534e36=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x187)]],_0x5da083=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x145)]],_0x33af73=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x133)]],_0x5c0033=[_0x52997d[_0x22982f(0x10c)]['delivery_code']],_0x5d3393=[_0x52997d[_0x22982f(0x10c)]['prod_cat']],_0x5036e5=[_0x52997d['body'][_0x22982f(0xb6)]],_0x27770f=[_0x52997d['body'][_0x22982f(0x139)]],_0x20fecd=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x111)]],_0x12b873=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x1a8)]],_0x507b81=[_0x52997d[_0x22982f(0x10c)][_0x22982f(0x18f)]],_0x5c13d4=[_0x52997d['body']['id_transact']];else var _0x1548b9=[..._0x52997d['body'][_0x22982f(0x12f)]],_0x456958=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0xec)]],_0x219e14=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0xf7)]],_0x49d1e0=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0x197)]],_0x265db0=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0x126)]],_0x191d39=[..._0x52997d[_0x22982f(0x10c)]['prod_code']],_0x27cb9=[..._0x52997d[_0x22982f(0x10c)]['level']],_0x1e3395=[..._0x52997d['body'][_0x22982f(0xb7)]],_0x21528d=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0xf1)]],_0xa2dc1d=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0x143)]],_0xe92871=[..._0x52997d['body'][_0x22982f(0x121)]],_0x282762=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0x142)]],_0x534e36=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0x187)]],_0x5da083=[..._0x52997d['body'][_0x22982f(0x145)]],_0x33af73=[..._0x52997d[_0x22982f(0x10c)]['delivery_date']],_0x5c0033=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0xfe)]],_0x5d3393=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0x120)]],_0x5036e5=[..._0x52997d['body'][_0x22982f(0xb6)]],_0x27770f=[..._0x52997d[_0x22982f(0x10c)][_0x22982f(0x139)]],_0x20fecd=[..._0x52997d['body'][_0x22982f(0x111)]],_0x12b873=[..._0x52997d['body'][_0x22982f(0x1a8)]],_0x507b81=[..._0x52997d['body'][_0x22982f(0x18f)]],_0x5c13d4=[..._0x52997d['body'][_0x22982f(0xe4)]];const _0x4537e4=_0x1548b9[_0x22982f(0x16d)](_0x44c3d9=>{return _0x44c3d9={'product_name':_0x44c3d9};});_0x456958['forEach']((_0x184888,_0x6b7bf6)=>{var _0xc39244=_0x22982f;_0x4537e4[_0x6b7bf6][_0xc39244(0xec)]=Math[_0xc39244(0x11c)](_0x184888);}),_0x12b873['forEach']((_0xef099f,_0x2cd225)=>{var _0x2b0b7f=_0x22982f;_0x4537e4[_0x2cd225][_0x2b0b7f(0x1a8)]=Math['abs'](_0xef099f);}),_0x507b81[_0x22982f(0xb2)]((_0x5f4857,_0x29c39b)=>{var _0x2a8b9a=_0x22982f;_0x4537e4[_0x29c39b][_0x2a8b9a(0x18f)]=_0x5f4857;}),_0x5c13d4['forEach']((_0x1d1a48,_0x3d69fa)=>{_0x4537e4[_0x3d69fa]['id_transaction_from']=_0x1d1a48;}),_0x219e14['forEach']((_0x281b0f,_0x381d20)=>{_0x4537e4[_0x381d20]['quantity']=_0x281b0f;}),_0x49d1e0['forEach']((_0x54963a,_0xccf3bd)=>{var _0x11255f=_0x22982f;_0x4537e4[_0xccf3bd][_0x11255f(0x197)]=_0x54963a;}),_0x265db0[_0x22982f(0xb2)]((_0x5e7cad,_0x34ede3)=>{_0x4537e4[_0x34ede3]['secondary_code']=_0x5e7cad;}),_0x191d39[_0x22982f(0xb2)]((_0x457edc,_0x197c1c)=>{var _0x54487f=_0x22982f;_0x4537e4[_0x197c1c][_0x54487f(0xfb)]=_0x457edc;}),_0x27cb9[_0x22982f(0xb2)]((_0x395299,_0x5ccc1d)=>{_0x27770f['forEach']((_0x107906,_0x2ef7ce)=>{var _0x3bdaea=a0_0x4f76;if(_0x107906=='Receiving\x20Area'&&_0x5ccc1d==_0x2ef7ce){var _0x217c40=_0x395299[_0x3bdaea(0xa5)](0x3);_0x4537e4[_0x5ccc1d][_0x3bdaea(0xc3)]=_0x395299[0x0],_0x4537e4[_0x5ccc1d][_0x3bdaea(0xc2)]=_0x395299[0x1],_0x4537e4[_0x5ccc1d][_0x3bdaea(0xad)]=0x0,_0x4537e4[_0x5ccc1d]['bin']=0x0,_0x4537e4[_0x5ccc1d][_0x3bdaea(0xf4)]=_0x3bdaea(0x155),_0x4537e4[_0x5ccc1d][_0x3bdaea(0x144)]=_0x217c40;}else{if(_0x107906=='Shelves'&&_0x5ccc1d==_0x2ef7ce){var _0x217c40=_0x395299['slice'](0x3);_0x4537e4[_0x5ccc1d][_0x3bdaea(0xc3)]=_0x395299[0x0],_0x4537e4[_0x5ccc1d][_0x3bdaea(0xc2)]=_0x395299[0x1],_0x4537e4[_0x5ccc1d][_0x3bdaea(0xad)]=0x0,_0x4537e4[_0x5ccc1d][_0x3bdaea(0x130)]=0x0,_0x4537e4[_0x5ccc1d][_0x3bdaea(0xf4)]=_0x3bdaea(0x155),_0x4537e4[_0x5ccc1d][_0x3bdaea(0x144)]=_0x395299[0x5];}else{if(_0x5ccc1d==_0x2ef7ce){var _0x3f8b5e;if(_0x395299[0x4]=='L')_0x3f8b5e=_0x3bdaea(0x19a);else _0x395299[0x4]=='F'&&(_0x3f8b5e=_0x3bdaea(0x155));_0x4537e4[_0x5ccc1d][_0x3bdaea(0xc3)]=_0x395299[0x0],_0x4537e4[_0x5ccc1d][_0x3bdaea(0xc2)]=_0x395299[0x1],_0x4537e4[_0x5ccc1d][_0x3bdaea(0xad)]=_0x395299[0x2],_0x4537e4[_0x5ccc1d]['bin']=_0x395299[0x3],_0x4537e4[_0x5ccc1d][_0x3bdaea(0xf4)]=_0x3f8b5e,_0x4537e4[_0x5ccc1d][_0x3bdaea(0x144)]=_0x395299[0x5];}}}});}),_0x1e3395['forEach']((_0x298037,_0x4adccf)=>{var _0x5459af=_0x22982f;_0x4537e4[_0x4adccf][_0x5459af(0xc7)]=_0x298037;}),_0x21528d[_0x22982f(0xb2)]((_0x287ad7,_0xdf4dcb)=>{var _0x41e092=_0x22982f;_0x4537e4[_0xdf4dcb][_0x41e092(0xf1)]=_0x287ad7;}),_0xa2dc1d[_0x22982f(0xb2)]((_0x51b165,_0x36e0d8)=>{var _0x110075=_0x22982f;_0x4537e4[_0x36e0d8][_0x110075(0x143)]=_0x51b165;}),_0xe92871[_0x22982f(0xb2)]((_0x2208c8,_0x565688)=>{_0x4537e4[_0x565688]['expiry_date']=_0x2208c8;}),_0x282762[_0x22982f(0xb2)]((_0x25f87c,_0x45d1d3)=>{_0x4537e4[_0x45d1d3]['maxperunit']=_0x25f87c;}),_0x534e36['forEach']((_0x587c7a,_0x5e3cdb)=>{var _0x37fb7f=_0x22982f;_0x4537e4[_0x5e3cdb][_0x37fb7f(0x187)]=_0x587c7a;}),_0x5da083[_0x22982f(0xb2)]((_0x4864cf,_0x5d368e)=>{var _0x3deb4c=_0x22982f;_0x4537e4[_0x5d368e][_0x3deb4c(0x145)]=_0x4864cf;}),_0x33af73[_0x22982f(0xb2)]((_0x5064d8,_0x2ec6e5)=>{var _0x2fbd89=_0x22982f;_0x4537e4[_0x2ec6e5][_0x2fbd89(0x133)]=_0x5064d8;}),_0x5c0033['forEach']((_0x6f048c,_0x18610c)=>{_0x4537e4[_0x18610c]['delivery_code']=_0x6f048c;}),_0x5d3393[_0x22982f(0xb2)]((_0x599f0a,_0x33c73e)=>{var _0x4a620c=_0x22982f;_0x4537e4[_0x33c73e][_0x4a620c(0x120)]=_0x599f0a;}),_0x5036e5[_0x22982f(0xb2)]((_0x3f5a8d,_0x58798b)=>{var _0x1f3ffd=_0x22982f;_0x4537e4[_0x58798b][_0x1f3ffd(0x12a)]=_0x3f5a8d;}),_0x27770f[_0x22982f(0xb2)]((_0x474a0a,_0x536a6b)=>{var _0x49b6ef=_0x22982f;_0x4537e4[_0x536a6b][_0x49b6ef(0x189)]=_0x474a0a;}),_0x20fecd[_0x22982f(0xb2)]((_0xaf7c9e,_0x4826a6)=>{var _0x26d0b7=_0x22982f;_0x4537e4[_0x4826a6][_0x26d0b7(0x11d)]=_0xaf7c9e;});var _0x4cb9d8=0x0;_0x4537e4[_0x22982f(0xb2)](_0x44fd67=>{var _0x45a5fa=_0x22982f;(_0x44fd67[_0x45a5fa(0xec)]<_0x44fd67['quantity_notConverted']||_0x44fd67[_0x45a5fa(0x12a)]==0x0)&&(console[_0x45a5fa(0x110)](_0x45a5fa(0x106),_0x44fd67),_0x4cb9d8++);});const _0x436145=_0x4537e4[_0x22982f(0xe0)](_0x49a13c=>_0x49a13c[_0x22982f(0xb6)]!=='0'&&_0x49a13c[_0x22982f(0xb6)]!==''),_0x4ba4ce=new sales({'invoice':_0x39b10f,'customer':_0x52997d[_0x22982f(0x10c)][_0x22982f(0x14a)],'date':_0x5ce871,'warehouse_name':_0x59b015,'sale_product':_0x436145,'note':_0x36c54a,'room':_0x4b7816,'primary_code':_0x4716a3,'secondary_code':_0x2a168,'prod_code':_0x40afff,'SCRN':_0x2f368a}),_0x5b0278=await _0x4ba4ce[_0x22982f(0x13d)]();_0x52997d['flash'](_0x22982f(0x15e),_0x22982f(0x16b)),_0x4e15af['redirect'](_0x22982f(0x18a)+_0x5b0278['_id']);}catch(_0x201740){console['log'](_0x201740);}}),router[a0_0x33bc05(0x123)](a0_0x33bc05(0x105),auth,async(_0x48d41d,_0x3f4f71)=>{var _0x305885=a0_0x33bc05;try{const {username:_0xac22ba,email:_0x1fa0b5,role:_0x1ab365}=_0x48d41d[_0x305885(0x19b)],_0x14c75f=_0x48d41d[_0x305885(0x19b)],_0x5c1ac9=await profile[_0x305885(0x151)]({'email':_0x14c75f[_0x305885(0xc1)]}),_0x23adb0=await master_shop[_0x305885(0xf9)](),_0x3d241c=_0x48d41d[_0x305885(0x154)]['id'],_0x41e40b=await sales[_0x305885(0x16f)](_0x3d241c),_0x5c64a0=await warehouse['aggregate']([{'$match':{'name':_0x41e40b[_0x305885(0x15b)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x305885(0x124)},'product_stock':{'$first':_0x305885(0x131)},'bay':{'$first':_0x305885(0x112)},'bin':{'$first':_0x305885(0x198)},'type':{'$first':_0x305885(0x11a)},'floorlevel':{'$first':_0x305885(0x173)},'primary_code':{'$first':_0x305885(0x13f)},'secondary_code':{'$first':_0x305885(0xc6)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x305885(0xb8)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x305885(0x17f)},'production_date':{'$first':_0x305885(0x114)},'invoice':{'$first':_0x305885(0x19e)}}}]),_0x34ec93=await customer[_0x305885(0xf9)]({});let _0x282a7c;if(_0x14c75f[_0x305885(0xfd)]==_0x305885(0xdd)){const _0x3b5e2e=await staff[_0x305885(0x151)]({'email':_0x14c75f[_0x305885(0xc1)]});_0x282a7c=await warehouse[_0x305885(0xb9)]([{'$match':{'status':_0x305885(0xc9),'name':_0x3b5e2e[_0x305885(0x100)]}},{'$group':{'_id':_0x305885(0x101),'name':{'$first':_0x305885(0x101)}}}]);}else _0x282a7c=await warehouse['aggregate']([{'$match':{'status':_0x305885(0xc9)}},{'$group':{'_id':_0x305885(0x101),'name':{'$first':_0x305885(0x101)}}}]);const _0x3440e6=await product['find']({}),_0x5aef91=await suppliers[_0x305885(0xf9)]({});if(_0x23adb0[0x0][_0x305885(0x14c)]=='English\x20(US)'){var _0x212436=users['English'];console[_0x305885(0x110)](_0x212436);}else{if(_0x23adb0[0x0][_0x305885(0x14c)]==_0x305885(0x11f))var _0x212436=users[_0x305885(0x11f)];else{if(_0x23adb0[0x0]['language']==_0x305885(0x138))var _0x212436=users[_0x305885(0x138)];else{if(_0x23adb0[0x0][_0x305885(0x14c)]==_0x305885(0xd7))var _0x212436=users[_0x305885(0xd7)];else{if(_0x23adb0[0x0]['language']==_0x305885(0xfa))var _0x212436=users[_0x305885(0xfa)];else{if(_0x23adb0[0x0][_0x305885(0x14c)]==_0x305885(0x13b))var _0x212436=users['Portuguese'];else{if(_0x23adb0[0x0]['language']=='Chinese')var _0x212436=users[_0x305885(0x18d)];else{if(_0x23adb0[0x0][_0x305885(0x14c)]==_0x305885(0xaa))var _0x212436=users[_0x305885(0x194)];}}}}}}}_0x3f4f71['render']('edit_sales_view',{'success':_0x48d41d[_0x305885(0x16e)](_0x305885(0x15e)),'errors':_0x48d41d[_0x305885(0x16e)](_0x305885(0x15d)),'role':_0x14c75f,'profile':_0x5c1ac9,'customer':_0x34ec93,'warehouse':_0x282a7c,'product':_0x5c64a0,'user':_0x41e40b,'master_shop':_0x23adb0,'unit':_0x3440e6,'language':_0x212436,'suppliers':_0x5aef91});}catch(_0x1ede6d){console[_0x305885(0x110)](_0x1ede6d);}}),router[a0_0x33bc05(0xcf)]('/preview/:id',auth,async(_0xd17e71,_0x3f95e3)=>{var _0x55b451=a0_0x33bc05;try{const _0x4868bc=_0xd17e71['params']['id'],{invoice:_0x1f6580,warehouse_name:_0x3c89a,room:_0x22ed1d}=_0xd17e71[_0x55b451(0x10c)],_0x11dace=await sales['findOne']({'invoice':_0x1f6580}),_0x63f7b2=_0x11dace[_0x55b451(0x160)]['map'](async _0x157c2e=>{var _0x3dff84=_0x55b451,_0x5d17c0=await warehouse[_0x3dff84(0x151)]({'name':_0x3c89a,'room':_0x157c2e[_0x3dff84(0x189)],'warehouse_category':_0x3dff84(0x137)});const _0x290734=_0x5d17c0[_0x3dff84(0xf2)][_0x3dff84(0x16d)](_0x32fc44=>{var _0x379015=_0x3dff84;_0x32fc44[_0x379015(0x12f)]==_0x157c2e['product_name']&&_0x32fc44[_0x379015(0x144)]==_0x157c2e['floorlevel']&&_0x32fc44[_0x379015(0xf4)]==_0x157c2e[_0x379015(0xf4)]&&_0x32fc44[_0x379015(0x130)]==_0x157c2e[_0x379015(0x130)]&&_0x32fc44['bay']==_0x157c2e[_0x379015(0xad)]&&_0x32fc44[_0x379015(0xc2)]==_0x157c2e[_0x379015(0xc2)]&&_0x32fc44['storage']==_0x157c2e[_0x379015(0xc3)]&&_0x32fc44[_0x379015(0x121)]==_0x157c2e['expiry_date']&&_0x32fc44[_0x379015(0x143)]==_0x157c2e[_0x379015(0x143)]&&_0x32fc44[_0x379015(0xd5)]==_0x157c2e[_0x379015(0x1a4)]&&(_0x32fc44[_0x379015(0xf8)]=Math[_0x379015(0xc4)](0x0,Math[_0x379015(0x11c)](_0x32fc44[_0x379015(0xf8)])-Math[_0x379015(0x11c)](_0x157c2e[_0x379015(0xb6)])));});return _0x5d17c0;});Promise['all'](_0x63f7b2)[_0x55b451(0xd9)](async _0x4d48e2=>{var _0x1261bb=_0x55b451;try{for(const _0x1a83b1 of _0x4d48e2){await _0x1a83b1['save']();}_0x11dace['finalize']=_0x1261bb(0x118);const _0x32922d=await _0x11dace[_0x1261bb(0x13d)](),_0x178500=await master_shop[_0x1261bb(0xf9)](),_0x124b16=await email_settings['findOne'](),_0x5eacdc=await supervisor_settings['find']();var _0x277589=_0x11dace[_0x1261bb(0x160)],_0x14ea52='',_0x35a9d9;for(_0x35a9d9 in _0x277589){_0x14ea52+=_0x1261bb(0xa9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x277589[_0x35a9d9][_0x1261bb(0x12f)]+_0x1261bb(0xa6)+_0x1261bb(0x10e)+_0x277589[_0x35a9d9][_0x1261bb(0xfb)]+_0x1261bb(0xa6)+_0x1261bb(0x10e)+_0x277589[_0x35a9d9][_0x1261bb(0xb6)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x277589[_0x35a9d9]['unit']+_0x1261bb(0xa6)+_0x1261bb(0x10e)+_0x277589[_0x35a9d9][_0x1261bb(0xf1)]+_0x1261bb(0xa6)+_0x1261bb(0x10e)+_0x11dace[_0x1261bb(0x15b)]+'</td>'+_0x1261bb(0x10e)+_0x277589[_0x35a9d9][_0x1261bb(0x189)]+_0x1261bb(0xa6)+_0x1261bb(0x10e)+_0x277589[_0x35a9d9][_0x1261bb(0xc3)]+_0x277589[_0x35a9d9][_0x1261bb(0xc2)]+_0x277589[_0x35a9d9][_0x1261bb(0xad)]+_0x277589[_0x35a9d9][_0x1261bb(0x130)]+_0x277589[_0x35a9d9][_0x1261bb(0xf4)][0x0]+_0x277589[_0x35a9d9]['floorlevel']+'</td>',_0x1261bb(0x186);}let _0x501ed9=nodemailer[_0x1261bb(0xfc)]({'host':_0x124b16['host'],'port':Number(_0x124b16['port']),'secure':![],'auth':{'user':_0x124b16[_0x1261bb(0xc1)],'pass':_0x124b16['password']}}),_0x53d2d6={'from':_0x124b16[_0x1261bb(0xc1)],'to':_0x5eacdc[0x0][_0x1261bb(0x179)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x1261bb(0xab),'path':__dirname+_0x1261bb(0x170)+_0x1261bb(0xd2)+_0x178500[0x0]['image'],'cid':_0x1261bb(0x167)}],'html':_0x1261bb(0x196)+_0x1261bb(0xe9)+'</head><body>'+_0x1261bb(0xa8)+_0x1261bb(0xa7)+_0x1261bb(0xa8)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+'<h2>\x20'+_0x178500[0x0][_0x1261bb(0x188)]+'\x20</h2>'+_0x1261bb(0x184)+_0x1261bb(0x184)+_0x1261bb(0x149)+_0x1261bb(0xa8)+_0x1261bb(0x148)+_0x1261bb(0xce)+_0x11dace[_0x1261bb(0x11d)]+'\x20'+_0x1261bb(0x129)+'\x20Order\x20Date\x20:\x20'+_0x11dace[_0x1261bb(0x109)]+'\x20'+_0x1261bb(0xcb)+_0x1261bb(0x178)+_0x1261bb(0x184)+_0x1261bb(0x141)+_0x1261bb(0x15f)+_0x1261bb(0xa9)+_0x1261bb(0x17a)+_0x1261bb(0x177)+_0x1261bb(0x18b)+_0x1261bb(0x115)+_0x1261bb(0x162)+_0x1261bb(0x108)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x1261bb(0xda)+'</tr>'+_0x1261bb(0x17b)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x14ea52+'\x20'+_0x1261bb(0x1a9)+_0x1261bb(0xea)+_0x1261bb(0xa8)+_0x1261bb(0xb5)+'<h5>'+_0x178500[0x0][_0x1261bb(0x188)]+_0x1261bb(0x178)+_0x1261bb(0x184)+_0x1261bb(0x184)+_0x1261bb(0x168)};_0x501ed9['sendMail'](_0x53d2d6,function(_0x1e9369,_0x45f9d4){var _0x26ce18=_0x1261bb;_0x1e9369?(console[_0x26ce18(0x110)](_0x1e9369),console[_0x26ce18(0x110)](_0x26ce18(0xff))):console[_0x26ce18(0x110)](_0x26ce18(0x19d));}),_0xd17e71[_0x1261bb(0x16e)]('success',_0x1261bb(0x1a2)),_0x3f95e3[_0x1261bb(0x193)](_0x1261bb(0x18a)+_0x4868bc);}catch(_0x4751df){console['error'](_0x4751df),_0x3f95e3[_0x1261bb(0x146)](0x1f4)[_0x1261bb(0x182)]({'error':_0x1261bb(0x128)});}})[_0x55b451(0x132)](_0x362d0b=>{var _0x43bd18=_0x55b451;console['error'](_0x362d0b),_0x3f95e3[_0x43bd18(0x146)](0x1f4)[_0x43bd18(0x182)]({'error':_0x43bd18(0xa4)});});}catch(_0x1d6ae3){console[_0x55b451(0x110)](_0x1d6ae3);}}),router['get'](a0_0x33bc05(0x10d),auth,async(_0x3f94b4,_0x5ef5ad)=>{var _0x58c457=a0_0x33bc05;try{const {username:_0x26db9a,email:_0x543100,role:_0x188194}=_0x3f94b4[_0x58c457(0x19b)],_0x38b8a7=_0x3f94b4['user'],_0x229189=await profile['findOne']({'email':_0x38b8a7[_0x58c457(0xc1)]}),_0x142459=await master_shop['find'](),_0x16a10b=_0x3f94b4[_0x58c457(0x154)]['id'],_0x3b3e3=await sales[_0x58c457(0x16f)](_0x16a10b);var _0x30b139=[_0x58c457(0xd6),_0x58c457(0xe1)];const _0x4dab2f=await warehouse[_0x58c457(0xb9)]([{'$match':{'name':_0x3b3e3[_0x58c457(0x15b)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x58c457(0x127)},{'$group':{'_id':_0x58c457(0xdf),'name':{'$first':_0x58c457(0x124)},'product_stock':{'$first':_0x58c457(0x131)},'bay':{'$first':_0x58c457(0x112)},'bin':{'$first':_0x58c457(0x198)},'type':{'$first':_0x58c457(0x11a)},'floorlevel':{'$first':_0x58c457(0x173)},'primary_code':{'$first':_0x58c457(0x13f)},'secondary_code':{'$first':_0x58c457(0xc6)},'product_code':{'$first':_0x58c457(0x12d)},'storage':{'$first':_0x58c457(0xb8)},'rack':{'$first':_0x58c457(0xd1)}}}]),_0x50df30=await customer[_0x58c457(0xf9)]({});let _0x1702d3;if(_0x38b8a7[_0x58c457(0xfd)]==_0x58c457(0xdd)){const _0x802e4=await staff[_0x58c457(0x151)]({'email':_0x38b8a7[_0x58c457(0xc1)]});_0x1702d3=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x802e4[_0x58c457(0x100)],'warehouse_category':_0x58c457(0x137)}},{'$group':{'_id':_0x58c457(0x101),'name':{'$first':_0x58c457(0x101)}}}]);}else _0x1702d3=await warehouse['aggregate']([{'$match':{'status':_0x58c457(0xc9),'warehouse_category':_0x58c457(0x137)}},{'$group':{'_id':_0x58c457(0x101),'name':{'$first':'$name'}}}]);const _0x1ccf88=await product[_0x58c457(0xf9)]({});if(_0x142459[0x0][_0x58c457(0x14c)]==_0x58c457(0xe2)){var _0x214f06=users[_0x58c457(0x104)];console[_0x58c457(0x110)](_0x214f06);}else{if(_0x142459[0x0][_0x58c457(0x14c)]==_0x58c457(0x11f))var _0x214f06=users[_0x58c457(0x11f)];else{if(_0x142459[0x0][_0x58c457(0x14c)]==_0x58c457(0x138))var _0x214f06=users[_0x58c457(0x138)];else{if(_0x142459[0x0][_0x58c457(0x14c)]==_0x58c457(0xd7))var _0x214f06=users[_0x58c457(0xd7)];else{if(_0x142459[0x0][_0x58c457(0x14c)]==_0x58c457(0xfa))var _0x214f06=users[_0x58c457(0xfa)];else{if(_0x142459[0x0][_0x58c457(0x14c)]=='Portuguese\x20(BR)')var _0x214f06=users['Portuguese'];else{if(_0x142459[0x0][_0x58c457(0x14c)]=='Chinese')var _0x214f06=users[_0x58c457(0x18d)];else{if(_0x142459[0x0][_0x58c457(0x14c)]==_0x58c457(0xaa))var _0x214f06=users[_0x58c457(0x194)];}}}}}}}_0x5ef5ad[_0x58c457(0xe8)](_0x58c457(0xae),{'success':_0x3f94b4[_0x58c457(0x16e)](_0x58c457(0x15e)),'errors':_0x3f94b4['flash']('errors'),'role':_0x38b8a7,'profile':_0x229189,'customer':_0x50df30,'warehouse':_0x1702d3,'product':_0x4dab2f,'user':_0x3b3e3,'master_shop':_0x142459,'unit':_0x1ccf88,'language':_0x214f06});}catch(_0x3db76b){console[_0x58c457(0x110)](_0x3db76b);}}),router[a0_0x33bc05(0xcf)](a0_0x33bc05(0x10d),auth,async(_0x41486c,_0x24edc2)=>{var _0x4be3c1=a0_0x33bc05;try{const _0x5ac247=_0x41486c[_0x4be3c1(0x154)]['id'],_0x38c218=await sales[_0x4be3c1(0x151)]({'_id':_0x41486c[_0x4be3c1(0x154)]['id']}),_0x449379=await warehouse['findOne']({'name':_0x38c218[_0x4be3c1(0x15b)],'room':_0x41486c['body'][_0x4be3c1(0x192)]}),{invoice:_0x38164b,date:_0x38f178,warehouse_name:_0x400a34,product_name:_0x2fbb8b,stock:_0x31309c,quantity:_0x5c9705,note:_0xaf6d3b,room:_0x1cd9d7,customer:_0x2d145,SCRN:_0xda6c9b}=_0x41486c[_0x4be3c1(0x10c)];if(typeof _0x2fbb8b==_0x4be3c1(0xf5))var _0x55dfbb=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x12f)]],_0x394384=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0xec)]],_0x522928=[_0x41486c['body'][_0x4be3c1(0xf7)]],_0x241f5c=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x197)]],_0x5a2b0e=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x126)]],_0x4595c0=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x181)]],_0x1ae2f8=[_0x41486c['body'][_0x4be3c1(0x13c)]],_0x3d9a4a=[_0x41486c['body'][_0x4be3c1(0xb7)]],_0x2f509f=[_0x41486c[_0x4be3c1(0x10c)]['secondary_unit']],_0x419304=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x143)]],_0x1dcda4=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x121)]],_0x540816=[_0x41486c['body']['max_per_unit']],_0x4d148b=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x187)]],_0x335792=[_0x41486c['body']['requested_qty']],_0x2245af=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x133)]],_0x57ecda=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0xfe)]],_0x4d045f=[_0x41486c['body'][_0x4be3c1(0x120)]],_0x55bcb9=[_0x41486c['body'][_0x4be3c1(0xb6)]],_0x2dabdf=[_0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x139)]];else var _0x55dfbb=[..._0x41486c[_0x4be3c1(0x10c)]['product_name']],_0x394384=[..._0x41486c[_0x4be3c1(0x10c)]['stock']],_0x522928=[..._0x41486c[_0x4be3c1(0x10c)]['carton']],_0x241f5c=[..._0x41486c['body'][_0x4be3c1(0x197)]],_0x5a2b0e=[..._0x41486c[_0x4be3c1(0x10c)]['secondary_code']],_0x4595c0=[..._0x41486c['body'][_0x4be3c1(0x181)]],_0x1ae2f8=[..._0x41486c['body'][_0x4be3c1(0x13c)]],_0x3d9a4a=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0xb7)]],_0x2f509f=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0xf1)]],_0x419304=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x143)]],_0x1dcda4=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x121)]],_0x540816=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x142)]],_0x4d148b=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x187)]],_0x335792=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x145)]],_0x2245af=[..._0x41486c['body']['delivery_date']],_0x57ecda=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0xfe)]],_0x4d045f=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x120)]],_0x55bcb9=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0xb6)]],_0x2dabdf=[..._0x41486c[_0x4be3c1(0x10c)][_0x4be3c1(0x139)]];const _0x5bbb5c=_0x55dfbb[_0x4be3c1(0x16d)](_0x5472c0=>{return _0x5472c0={'product_name':_0x5472c0};});_0x394384[_0x4be3c1(0xb2)]((_0xa7deb4,_0x341a54)=>{var _0x2e22a2=_0x4be3c1;_0x5bbb5c[_0x341a54][_0x2e22a2(0xec)]=Math[_0x2e22a2(0x11c)](_0xa7deb4);}),_0x522928[_0x4be3c1(0xb2)]((_0x501521,_0x508c4c)=>{var _0x52d999=_0x4be3c1;_0x5bbb5c[_0x508c4c][_0x52d999(0xb6)]=_0x501521;}),_0x241f5c['forEach']((_0x3a77a9,_0x254af0)=>{_0x5bbb5c[_0x254af0]['primary_code']=_0x3a77a9;}),_0x5a2b0e[_0x4be3c1(0xb2)]((_0x254eda,_0x37b942)=>{var _0x5569d0=_0x4be3c1;_0x5bbb5c[_0x37b942][_0x5569d0(0x126)]=_0x254eda;}),_0x4595c0[_0x4be3c1(0xb2)]((_0xf183ab,_0x77b0d6)=>{_0x5bbb5c[_0x77b0d6]['product_code']=_0xf183ab;}),_0x1ae2f8[_0x4be3c1(0xb2)]((_0x61bd29,_0x3c5285)=>{var _0x56f331=_0x4be3c1;_0x2dabdf[_0x56f331(0xb2)]((_0x8e742c,_0x266c9f)=>{var _0x2f2096=_0x56f331;if(_0x8e742c==_0x2f2096(0x190)&&_0x3c5285==_0x266c9f){var _0x53a092=_0x61bd29[_0x2f2096(0xa5)](0x3);_0x5bbb5c[_0x3c5285]['storage']=_0x61bd29[0x0],_0x5bbb5c[_0x3c5285][_0x2f2096(0xc2)]=_0x61bd29[0x1],_0x5bbb5c[_0x3c5285][_0x2f2096(0xad)]=0x0,_0x5bbb5c[_0x3c5285][_0x2f2096(0x130)]=0x0,_0x5bbb5c[_0x3c5285]['type']='Floor',_0x5bbb5c[_0x3c5285]['floorlevel']=_0x53a092;}else{if(_0x8e742c=='Shelves'&&_0x3c5285==_0x266c9f){var _0x53a092=_0x61bd29[_0x2f2096(0xa5)](0x3);_0x5bbb5c[_0x3c5285][_0x2f2096(0xc3)]=_0x61bd29[0x0],_0x5bbb5c[_0x3c5285][_0x2f2096(0xc2)]=_0x61bd29[0x1],_0x5bbb5c[_0x3c5285][_0x2f2096(0xad)]=0x0,_0x5bbb5c[_0x3c5285]['bin']=0x0,_0x5bbb5c[_0x3c5285][_0x2f2096(0xf4)]='Floor',_0x5bbb5c[_0x3c5285][_0x2f2096(0x144)]=_0x61bd29[0x5];}else{if(_0x3c5285==_0x266c9f){var _0x22be0f;if(_0x61bd29[0x4]=='L')_0x22be0f=_0x2f2096(0x19a);else _0x61bd29[0x4]=='F'&&(_0x22be0f=_0x2f2096(0x155));_0x5bbb5c[_0x3c5285][_0x2f2096(0xc3)]=_0x61bd29[0x0],_0x5bbb5c[_0x3c5285]['rack']=_0x61bd29[0x1],_0x5bbb5c[_0x3c5285][_0x2f2096(0xad)]=_0x61bd29[0x2],_0x5bbb5c[_0x3c5285][_0x2f2096(0x130)]=_0x61bd29[0x3],_0x5bbb5c[_0x3c5285][_0x2f2096(0xf4)]=_0x22be0f,_0x5bbb5c[_0x3c5285][_0x2f2096(0x144)]=_0x61bd29[0x5];}}}});}),_0x3d9a4a[_0x4be3c1(0xb2)]((_0x99257d,_0x2a43b9)=>{var _0x7ca6a8=_0x4be3c1;_0x5bbb5c[_0x2a43b9][_0x7ca6a8(0xc7)]=_0x99257d;}),_0x2f509f[_0x4be3c1(0xb2)]((_0x58b493,_0x46ad2d)=>{_0x5bbb5c[_0x46ad2d]['secondary_unit']=_0x58b493;}),_0x419304[_0x4be3c1(0xb2)]((_0x2bfb65,_0x3394f5)=>{_0x5bbb5c[_0x3394f5]['batch_code']=_0x2bfb65;}),_0x1dcda4[_0x4be3c1(0xb2)]((_0x111d87,_0x24cb32)=>{var _0xf225cd=_0x4be3c1;_0x5bbb5c[_0x24cb32][_0xf225cd(0x121)]=_0x111d87;}),_0x540816[_0x4be3c1(0xb2)]((_0x2e4417,_0x30da32)=>{_0x5bbb5c[_0x30da32]['maxperunit']=_0x2e4417;}),_0x4d148b['forEach']((_0xe2c302,_0x5da27d)=>{var _0x392f64=_0x4be3c1;_0x5bbb5c[_0x5da27d][_0x392f64(0x187)]=_0xe2c302;}),_0x335792['forEach']((_0x4b575f,_0x552129)=>{var _0x11343a=_0x4be3c1;_0x5bbb5c[_0x552129]['requested_qty']=Math[_0x11343a(0x11c)](_0x4b575f);}),_0x2245af[_0x4be3c1(0xb2)]((_0x201e8e,_0x446c98)=>{var _0x2c2f9d=_0x4be3c1;_0x5bbb5c[_0x446c98][_0x2c2f9d(0x133)]=_0x201e8e;}),_0x57ecda[_0x4be3c1(0xb2)]((_0xe8f3f1,_0x128010)=>{var _0x1d93d8=_0x4be3c1;_0x5bbb5c[_0x128010][_0x1d93d8(0xfe)]=_0xe8f3f1;}),_0x4d045f[_0x4be3c1(0xb2)]((_0x58d0ea,_0x47f08a)=>{var _0x5affae=_0x4be3c1;_0x5bbb5c[_0x47f08a][_0x5affae(0x120)]=_0x58d0ea;}),_0x55bcb9[_0x4be3c1(0xb2)]((_0xebe419,_0x56d7ab)=>{var _0x19265e=_0x4be3c1;_0x5bbb5c[_0x56d7ab][_0x19265e(0x12a)]=_0xebe419;}),_0x2dabdf[_0x4be3c1(0xb2)]((_0x5aa24a,_0x44aeb9)=>{var _0x10d7a6=_0x4be3c1;_0x5bbb5c[_0x44aeb9][_0x10d7a6(0x189)]=_0x5aa24a;});var _0x4b844a=0x0;_0x5bbb5c['forEach'](_0x8ca123=>{var _0x5bfd14=_0x4be3c1;console['log'](_0x5bfd14(0x106),_0x8ca123),(parseInt(_0x8ca123['stock'])<parseInt(_0x8ca123[_0x5bfd14(0xb6)])||parseInt(_0x8ca123[_0x5bfd14(0xb6)])==0x0)&&_0x4b844a++;});if(_0x4b844a!=0x0)return _0x41486c['flash'](_0x4be3c1(0x15d),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x24edc2[_0x4be3c1(0x193)]('back');const _0x1e0390=_0x5bbb5c[_0x4be3c1(0xe0)](_0x278fbc=>_0x278fbc[_0x4be3c1(0xb6)]!=='0'&&_0x278fbc[_0x4be3c1(0xb6)]!=='');_0x38c218['invoice']=_0x38164b,_0x38c218[_0x4be3c1(0x14a)]=_0x2d145,_0x38c218['date']=_0x38f178,_0x38c218[_0x4be3c1(0x15b)]=_0x400a34,_0x38c218[_0x4be3c1(0x160)]=_0x1e0390,_0x38c218['note']=_0xaf6d3b,_0x38c218[_0x4be3c1(0xd0)]=_0xda6c9b,_0x38c218[_0x4be3c1(0x176)]=_0x4be3c1(0x1a6),_0x38c218[_0x4be3c1(0x1a7)]='False';const _0x4d23a6=await _0x38c218['save']();_0x41486c['flash']('success',_0x4be3c1(0x1a2)),_0x24edc2[_0x4be3c1(0x193)](_0x4be3c1(0xdc));}catch(_0xe3d425){console[_0x4be3c1(0x110)](_0xe3d425);}}),router[a0_0x33bc05(0xcf)](a0_0x33bc05(0xb0),auth,async(_0x5ba443,_0x267675)=>{var _0x4a8eb=a0_0x33bc05;try{const _0x3df854=_0x5ba443['params']['id'],{invoice:_0x4b55af,customer:_0x5d70e0,receivable_amount:_0x4a4710,received_amount:_0x5c13c7}=_0x5ba443[_0x4a8eb(0x10c)],_0x45bdff=await sales[_0x4a8eb(0x16f)](_0x3df854);console[_0x4a8eb(0x110)](_0x45bdff);var _0x43e80a=_0x4a4710-_0x5c13c7;console[_0x4a8eb(0x110)](_0x5c13c7),_0x45bdff[_0x4a8eb(0x150)]=parseFloat(_0x5c13c7)+parseFloat(_0x45bdff['received_amount']),_0x45bdff[_0x4a8eb(0x16c)]=_0x43e80a,console['log'](_0x45bdff);const _0x12b3b6=await _0x45bdff[_0x4a8eb(0x13d)](),_0x166967=await c_payment_data[_0x4a8eb(0x151)]({'invoice':_0x4b55af});_0x166967[_0x4a8eb(0xf0)]=_0x43e80a,await _0x166967[_0x4a8eb(0x13d)]();let _0x138ec3=new Date(),_0x2d3847=('0'+_0x138ec3['getDate']())['slice'](-0x2),_0x23c75c=('0'+(_0x138ec3[_0x4a8eb(0x14d)]()+0x1))[_0x4a8eb(0xa5)](-0x2),_0x2440a2=_0x138ec3[_0x4a8eb(0x174)](),_0x4a6c62=_0x2440a2+'-'+_0x23c75c+'-'+_0x2d3847;const _0x5cf467=new customer_payment({'invoice':_0x4b55af,'date':_0x2440a2+'-'+_0x23c75c+'-'+_0x2d3847,'customer':_0x5d70e0,'reason':_0x4a8eb(0x13a),'amount':_0x5c13c7}),_0x23c699=await _0x5cf467[_0x4a8eb(0x13d)]();_0x5ba443[_0x4a8eb(0x16e)](_0x4a8eb(0x15e),_0x4a8eb(0xc0)),_0x267675[_0x4a8eb(0x193)]('/all_sales/view');}catch(_0x57dfb0){console[_0x4a8eb(0x110)](_0x57dfb0);}}),router[a0_0x33bc05(0x123)](a0_0x33bc05(0xb3),auth,async(_0x4e58fc,_0x4dea20)=>{var _0x47c431=a0_0x33bc05;try{const {username:_0x25481f,email:_0x469725,role:_0x465622}=_0x4e58fc[_0x47c431(0x19b)],_0x5b2dae=_0x4e58fc['user'],_0x51208a=await profile[_0x47c431(0x151)]({'email':_0x5b2dae[_0x47c431(0xc1)]}),_0x224223=await master_shop['find']();console[_0x47c431(0x110)](_0x47c431(0x1a3),_0x224223);const _0x1051d9=_0x4e58fc[_0x47c431(0x154)]['id'],_0x30bd92=await sales[_0x47c431(0x16f)](_0x1051d9);console[_0x47c431(0x110)](_0x30bd92);const _0x1002c0=await customer[_0x47c431(0x151)]({'name':_0x30bd92['customer']});console[_0x47c431(0x110)](_0x1002c0);if(_0x224223[0x0][_0x47c431(0x14c)]==_0x47c431(0xe2)){var _0x44bf66=users[_0x47c431(0x104)];console[_0x47c431(0x110)](_0x44bf66);}else{if(_0x224223[0x0][_0x47c431(0x14c)]==_0x47c431(0x11f))var _0x44bf66=users[_0x47c431(0x11f)];else{if(_0x224223[0x0][_0x47c431(0x14c)]==_0x47c431(0x138))var _0x44bf66=users[_0x47c431(0x138)];else{if(_0x224223[0x0][_0x47c431(0x14c)]=='Spanish')var _0x44bf66=users[_0x47c431(0xd7)];else{if(_0x224223[0x0][_0x47c431(0x14c)]==_0x47c431(0xfa))var _0x44bf66=users[_0x47c431(0xfa)];else{if(_0x224223[0x0][_0x47c431(0x14c)]==_0x47c431(0x13b))var _0x44bf66=users[_0x47c431(0x12b)];else{if(_0x224223[0x0][_0x47c431(0x14c)]=='Chinese')var _0x44bf66=users['Chinese'];else{if(_0x224223[0x0][_0x47c431(0x14c)]=='Arabic\x20(ae)')var _0x44bf66=users[_0x47c431(0x194)];}}}}}}}_0x4dea20[_0x47c431(0xe8)]('sales_invoice',{'success':_0x4e58fc[_0x47c431(0x16e)](_0x47c431(0x15e)),'errors':_0x4e58fc[_0x47c431(0x16e)](_0x47c431(0x15d)),'role':_0x5b2dae,'profile':_0x51208a,'master_shop':_0x224223,'customers':_0x1002c0,'sales':_0x30bd92,'language':_0x44bf66});}catch(_0x2c481b){console[_0x47c431(0x110)](_0x2c481b);}}),router[a0_0x33bc05(0x123)](a0_0x33bc05(0x165),auth,async(_0x3da233,_0x26aebb)=>{var _0x526981=a0_0x33bc05;try{const {username:_0x19a9ad,email:_0x15e757,role:_0x314245}=_0x3da233[_0x526981(0x19b)],_0x4ddaac=_0x3da233[_0x526981(0x19b)],_0x509ab6=await profile['findOne']({'email':_0x4ddaac['email']}),_0x4faa62=await master_shop[_0x526981(0xf9)]();console[_0x526981(0x110)]('master',_0x4faa62);const _0x26d16a=_0x3da233[_0x526981(0x154)]['id'];console[_0x526981(0x110)](_0x26d16a);const _0x5cf5b9=await sales[_0x526981(0x16f)](_0x26d16a);console[_0x526981(0x110)]('user_id',_0x5cf5b9);const _0x5c39a0=await warehouse[_0x526981(0xb9)]([{'$match':{'name':_0x526981(0x175),'room':_0x526981(0x152)}},{'$unwind':_0x526981(0x127)},{'$group':{'_id':_0x526981(0xdf),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x526981(0x131)},'level':{'$first':_0x526981(0x135)},'isle':{'$first':_0x526981(0x10b)},'pallet':{'$first':_0x526981(0xbc)},'primary_code':{'$first':_0x526981(0x13f)},'secondary_code':{'$first':_0x526981(0xc6)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x526981(0x110)]('stock_data',_0x5c39a0);const _0x405956=await product[_0x526981(0xf9)]({});warehouse_data=await warehouse[_0x526981(0xb9)]([{'$match':{'status':_0x526981(0xc9),'name':'Return\x20Goods','warehouse_category':_0x526981(0x137)}},{'$group':{'_id':_0x526981(0x101),'name':{'$first':_0x526981(0x101)}}},{'$sort':{'name':0x1}}]);var _0x499fd0=['Return\x20Rooms'];if(_0x4faa62[0x0][_0x526981(0x14c)]==_0x526981(0xe2)){var _0x1a1b69=users['English'];console['log'](_0x1a1b69);}else{if(_0x4faa62[0x0][_0x526981(0x14c)]=='Hindi')var _0x1a1b69=users[_0x526981(0x11f)];else{if(_0x4faa62[0x0][_0x526981(0x14c)]==_0x526981(0x138))var _0x1a1b69=users[_0x526981(0x138)];else{if(_0x4faa62[0x0][_0x526981(0x14c)]==_0x526981(0xd7))var _0x1a1b69=users[_0x526981(0xd7)];else{if(_0x4faa62[0x0][_0x526981(0x14c)]==_0x526981(0xfa))var _0x1a1b69=users[_0x526981(0xfa)];else{if(_0x4faa62[0x0]['language']=='Portuguese\x20(BR)')var _0x1a1b69=users[_0x526981(0x12b)];else{if(_0x4faa62[0x0][_0x526981(0x14c)]==_0x526981(0x18d))var _0x1a1b69=users['Chinese'];else{if(_0x4faa62[0x0][_0x526981(0x14c)]=='Arabic\x20(ae)')var _0x1a1b69=users[_0x526981(0x194)];}}}}}}}_0x26aebb[_0x526981(0xe8)](_0x526981(0x16a),{'success':_0x3da233[_0x526981(0x16e)](_0x526981(0x15e)),'errors':_0x3da233[_0x526981(0x16e)](_0x526981(0x15d)),'role':_0x4ddaac,'profile':_0x509ab6,'user':_0x5cf5b9,'stock':_0x5c39a0,'master_shop':_0x4faa62,'unit':_0x405956,'language':_0x1a1b69,'warehouses':warehouse_data,'rooms':_0x499fd0});}catch(_0x250f03){console[_0x526981(0x110)](_0x250f03),_0x26aebb[_0x526981(0x146)](0xc8)[_0x526981(0x182)]({'message':_0x250f03[_0x526981(0x183)]});}}),router[a0_0x33bc05(0xcf)](a0_0x33bc05(0x165),auth,async(_0x5079cc,_0x27a13f)=>{var _0x54b8e3=a0_0x33bc05;try{const {invoice:_0x1aaa84,date:_0x32749e,warehouse_name:_0x129742,product_name:_0xa5cb05,primary_code:_0x5755b1,secondary_code:_0x304723,product_code:_0x5bd222,sales_quantity:_0x1697a3,stocks:_0x3beb00,return_qty:_0x1181f6,Room_name:_0x3139dc,to_warehouse_name:_0x38bb71,to_Roomname:_0x2328a5,to_Room_name:_0x349e75,note:_0x834b67,level:_0x228f0,isle:_0x5eb26d,pallet:_0x205737}=_0x5079cc[_0x54b8e3(0x10c)];if(typeof _0xa5cb05=='string')var _0x2ab91d=[_0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x12f)]],_0x285a64=[_0x5079cc[_0x54b8e3(0x10c)]['primary_code']],_0x4fdf6a=[_0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x126)]],_0xc6ef39=[_0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0xfb)]],_0xabfd12=[_0x5079cc[_0x54b8e3(0x10c)]['sales_quantity']],_0x2bc1ca=[_0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0xaf)]],_0x4a4ebe=[_0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x17c)]],_0x5b24b6=[_0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0xad)]],_0x235117=[_0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x130)]],_0x5ca4ec=[_0x5079cc['body'][_0x54b8e3(0x169)]],_0xd2e46f=[_0x5079cc['body'][_0x54b8e3(0x144)]];else var _0x2ab91d=[..._0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x12f)]],_0x285a64=[..._0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x197)]],_0x4fdf6a=[..._0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x126)]],_0xc6ef39=[..._0x5079cc['body'][_0x54b8e3(0xfb)]],_0xabfd12=[..._0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x15a)]],_0x2bc1ca=[..._0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0xaf)]],_0x4a4ebe=[..._0x5079cc[_0x54b8e3(0x10c)]['return_qty']],_0x5b24b6=[..._0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0xad)]],_0x235117=[..._0x5079cc[_0x54b8e3(0x10c)]['bin']],_0x5ca4ec=[..._0x5079cc[_0x54b8e3(0x10c)]['types']],_0xd2e46f=[..._0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x144)]];const _0x13dd4a=_0x2ab91d[_0x54b8e3(0x16d)](_0xf01076=>{return _0xf01076={'product_name':_0xf01076};});_0x285a64[_0x54b8e3(0xb2)]((_0x2835d8,_0x174bf9)=>{var _0x624aec=_0x54b8e3;_0x13dd4a[_0x174bf9][_0x624aec(0x197)]=_0x2835d8;}),_0x4fdf6a[_0x54b8e3(0xb2)]((_0x5dbb6c,_0x504e62)=>{var _0x4d176d=_0x54b8e3;_0x13dd4a[_0x504e62][_0x4d176d(0x126)]=_0x5dbb6c;}),_0xc6ef39[_0x54b8e3(0xb2)]((_0x192afd,_0x5f1466)=>{_0x13dd4a[_0x5f1466]['product_code']=_0x192afd;}),_0xabfd12[_0x54b8e3(0xb2)]((_0x1557be,_0x5873e8)=>{var _0x2534c8=_0x54b8e3;_0x13dd4a[_0x5873e8][_0x2534c8(0x185)]=_0x1557be;}),_0x2bc1ca[_0x54b8e3(0xb2)]((_0x12218c,_0xe26a52)=>{var _0x1f030f=_0x54b8e3;_0x13dd4a[_0xe26a52][_0x1f030f(0xec)]=_0x12218c;}),_0x4a4ebe[_0x54b8e3(0xb2)]((_0x383b20,_0x36f36a)=>{var _0x24e62b=_0x54b8e3;_0x13dd4a[_0x36f36a][_0x24e62b(0x17c)]=_0x383b20;}),_0x5b24b6[_0x54b8e3(0xb2)]((_0xfca13,_0x3ed138)=>{_0x13dd4a[_0x3ed138]['bay']=_0xfca13;}),_0x235117['forEach']((_0x21bc4a,_0x1b0ecb)=>{var _0x13146e=_0x54b8e3;_0x13dd4a[_0x1b0ecb][_0x13146e(0x130)]=_0x21bc4a;}),_0x5ca4ec[_0x54b8e3(0xb2)]((_0x18f0dc,_0x358215)=>{var _0x5b9d9f=_0x54b8e3;_0x13dd4a[_0x358215][_0x5b9d9f(0xf4)]=_0x18f0dc;}),_0xd2e46f[_0x54b8e3(0xb2)]((_0x3e4483,_0x20a185)=>{_0x13dd4a[_0x20a185]['floorlevel']=_0x3e4483;});var _0x3ea23b=0x0;_0x13dd4a[_0x54b8e3(0xb2)](_0x16058d=>{var _0x484279=_0x54b8e3;console['log'](_0x484279(0x106),_0x16058d),(parseInt(_0x16058d[_0x484279(0x185)])<parseInt(_0x16058d[_0x484279(0x17c)])||parseInt(_0x16058d[_0x484279(0xec)])<parseInt(_0x16058d[_0x484279(0x17c)])&&parseInt(_0x16058d[_0x484279(0x185)])>parseInt(_0x16058d[_0x484279(0x17c)])||parseInt(_0x16058d['return_qty'])==0x0)&&_0x3ea23b++;});if(_0x3ea23b!=0x0)return _0x5079cc[_0x54b8e3(0x16e)](_0x54b8e3(0x15d),_0x54b8e3(0xee)),_0x27a13f[_0x54b8e3(0x193)]('back');const _0x54a246=await sales[_0x54b8e3(0x151)]({'invoice':_0x1aaa84});console[_0x54b8e3(0x110)](_0x54a246),_0x54a246['return_data']='True';const _0x22ad00=await _0x54a246[_0x54b8e3(0x13d)](),_0x164d1e=new sales_return({'invoice':_0x1aaa84,'customer':_0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x14a)],'date':_0x32749e,'warehouse_name':_0x129742,'room':_0x3139dc,'ToWarehouse':_0x38bb71,'ToRoom':_0x349e75,'return_sale':_0x13dd4a,'note':_0x834b67}),_0x458813=await _0x164d1e[_0x54b8e3(0x13d)]();console[_0x54b8e3(0x110)](_0x164d1e);const _0x5655e9=await sales_return['findOne']({'invoice':_0x1aaa84}),_0x5aee59=await warehouse[_0x54b8e3(0x151)]({'name':_0x38bb71,'room':_0x349e75});_0x5655e9[_0x54b8e3(0x16a)][_0x54b8e3(0xb2)](_0x5397dc=>{var _0x3a17be=_0x54b8e3,_0x405ee5=0x0;const _0x5e5252=_0x5aee59[_0x3a17be(0xf2)][_0x3a17be(0x16d)](_0x3dfd97=>{var _0x272b44=_0x3a17be;_0x3dfd97[_0x272b44(0x12f)]==_0x5397dc[_0x272b44(0x12f)]&&_0x3dfd97[_0x272b44(0x144)]==_0x5397dc[_0x272b44(0x144)]&&_0x3dfd97[_0x272b44(0xf4)]==_0x5397dc[_0x272b44(0xf4)]&&_0x3dfd97[_0x272b44(0x130)]==_0x5397dc[_0x272b44(0x130)]&&_0x3dfd97[_0x272b44(0xad)]==_0x5397dc['bay']&&(_0x3dfd97['product_stock']=parseInt(_0x3dfd97[_0x272b44(0xf8)])+parseInt(_0x5397dc[_0x272b44(0x17c)]),_0x405ee5++);});_0x405ee5=='0'&&(_0x5aee59[_0x3a17be(0xf2)]=_0x5aee59[_0x3a17be(0xf2)][_0x3a17be(0x14f)]({'product_name':_0x5397dc[_0x3a17be(0x12f)],'product_stock':_0x5397dc[_0x3a17be(0x17c)],'primary_code':_0x5397dc['primary_code'],'secondary_code':_0x5397dc[_0x3a17be(0x126)],'product_code':_0x5397dc[_0x3a17be(0xfb)],'bay':_0x5397dc[_0x3a17be(0xad)],'bin':_0x5397dc[_0x3a17be(0x130)],'type':_0x5397dc[_0x3a17be(0xf4)],'floorlevel':_0x5397dc[_0x3a17be(0x144)]})),console['log']('final',_0x5aee59);}),await _0x5aee59[_0x54b8e3(0x13d)](),console[_0x54b8e3(0x110)](_0x5079cc[_0x54b8e3(0x10c)]);const _0x594676=new c_payment_data({'invoice':_0x1aaa84,'customer':_0x5079cc[_0x54b8e3(0x10c)][_0x54b8e3(0x14a)],'reason':'Sale\x20Return'});await _0x594676[_0x54b8e3(0x13d)]();const _0xde5e67=await master_shop[_0x54b8e3(0xf9)]();console['log']('add\x20post',_0xde5e67[0x0]['image']);const _0x100322=await email_settings[_0x54b8e3(0x151)](),_0xa514c0=await customer[_0x54b8e3(0x151)]({'name':_0x5079cc[_0x54b8e3(0x10c)]['customer']});console[_0x54b8e3(0x110)](_0x54b8e3(0x17e),_0xa514c0);_0xde5e67[0x0]['currency_placement']==0x1?(right_currency=_0xde5e67[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0xde5e67[0x0][_0x54b8e3(0xbe)]);var _0x3669d2=_0x2ab91d,_0x4c77de=_0x4a4ebe,_0x3f6e6f='',_0x5104e4;for(_0x5104e4 in _0x3669d2){_0x3f6e6f+=_0x54b8e3(0xa9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3669d2[_0x5104e4]+_0x54b8e3(0xa6)+_0x54b8e3(0x10e)+_0x4c77de[_0x5104e4]+'</td>'+_0x54b8e3(0x186);}console[_0x54b8e3(0x110)](_0x54b8e3(0x122),_0x3f6e6f);let _0x2ad6d9=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x100322['email'],'pass':_0x100322[_0x54b8e3(0x1aa)]}}),_0x138b78={'from':_0x100322['email'],'to':_0xa514c0['email'],'subject':_0x54b8e3(0xe3),'attachments':[{'filename':_0x54b8e3(0xab),'path':__dirname+_0x54b8e3(0x170)+_0x54b8e3(0xd2)+_0xde5e67[0x0][_0x54b8e3(0x17d)],'cid':_0x54b8e3(0x167)}],'html':_0x54b8e3(0x196)+_0x54b8e3(0xe9)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x54b8e3(0xa8)+_0x54b8e3(0xc8)+_0x54b8e3(0x184)+'<div>'+_0x54b8e3(0x116)+_0xde5e67[0x0][_0x54b8e3(0x188)]+_0x54b8e3(0x107)+_0x54b8e3(0x184)+_0x54b8e3(0x184)+_0x54b8e3(0x149)+_0x54b8e3(0xa8)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x54b8e3(0xce)+_0x1aaa84+'\x20'+_0x54b8e3(0x129)+_0x54b8e3(0xd8)+_0x32749e+'\x20'+_0x54b8e3(0xcb)+_0x54b8e3(0x178)+_0x54b8e3(0x184)+_0x54b8e3(0x141)+_0x54b8e3(0x15f)+_0x54b8e3(0xa9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x54b8e3(0x1a0)+_0x54b8e3(0x1a1)+_0x54b8e3(0x19c)+_0x54b8e3(0x186)+_0x54b8e3(0x17b)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3f6e6f+'\x20'+_0x54b8e3(0x1a9)+_0x54b8e3(0xea)+_0x54b8e3(0xa8)+_0x54b8e3(0xb5)+_0x54b8e3(0x147)+_0xde5e67[0x0]['site_title']+_0x54b8e3(0x178)+_0x54b8e3(0x184)+_0x54b8e3(0x184)+_0x54b8e3(0x168)};_0x2ad6d9[_0x54b8e3(0xcd)](_0x138b78,function(_0x465e9d,_0x35cef0){var _0x20748e=_0x54b8e3;_0x465e9d?(console['log'](_0x465e9d),console['log'](_0x20748e(0xff))):console['log'](_0x20748e(0x19d));}),_0x5079cc[_0x54b8e3(0x16e)]('success','sales\x20item\x20return\x20successfull'),_0x27a13f[_0x54b8e3(0x193)](_0x54b8e3(0xdc));}catch(_0x44213b){console[_0x54b8e3(0x110)](_0x44213b),_0x27a13f['status'](0xc8)[_0x54b8e3(0x182)]({'message1':_0x44213b[_0x54b8e3(0x183)]});}}),router[a0_0x33bc05(0x123)](a0_0x33bc05(0xeb),auth,async(_0x271bdd,_0x450168)=>{var _0xb25fa2=a0_0x33bc05;try{const {username:_0x35ff10,email:_0x4607a0,role:_0x334fd3}=_0x271bdd[_0xb25fa2(0x19b)],_0x4c9179=_0x271bdd[_0xb25fa2(0x19b)],_0x2da01d=await profile[_0xb25fa2(0x151)]({'email':_0x4c9179['email']}),_0x368782=await master_shop['find']();console[_0xb25fa2(0x110)]('barcode\x20Product\x20master',_0x368782);const _0x230711=_0x271bdd['params']['id'],_0x364179=await sales[_0xb25fa2(0x16f)](_0x230711);console[_0xb25fa2(0x110)]('barcode\x20user_id',_0x364179);if(_0x368782[0x0]['language']==_0xb25fa2(0xe2))var _0xad14c9=users[_0xb25fa2(0x104)];else{if(_0x368782[0x0]['language']==_0xb25fa2(0x11f))var _0xad14c9=users['Hindi'];else{if(_0x368782[0x0][_0xb25fa2(0x14c)]==_0xb25fa2(0x138))var _0xad14c9=users[_0xb25fa2(0x138)];else{if(_0x368782[0x0][_0xb25fa2(0x14c)]==_0xb25fa2(0xd7))var _0xad14c9=users[_0xb25fa2(0xd7)];else{if(_0x368782[0x0][_0xb25fa2(0x14c)]=='French')var _0xad14c9=users[_0xb25fa2(0xfa)];else{if(_0x368782[0x0][_0xb25fa2(0x14c)]==_0xb25fa2(0x13b))var _0xad14c9=users['Portuguese'];else{if(_0x368782[0x0]['language']==_0xb25fa2(0x18d))var _0xad14c9=users[_0xb25fa2(0x18d)];else{if(_0x368782[0x0][_0xb25fa2(0x14c)]=='Arabic\x20(ae)')var _0xad14c9=users[_0xb25fa2(0x194)];}}}}}}}_0x450168[_0xb25fa2(0xe8)]('all_sales_barcode',{'success':_0x271bdd['flash']('success'),'errors':_0x271bdd[_0xb25fa2(0x16e)](_0xb25fa2(0x15d)),'role':_0x4c9179,'profile':_0x2da01d,'alldata':_0x364179,'master_shop':_0x368782,'language':_0xad14c9});}catch(_0x59c384){console[_0xb25fa2(0x110)](_0x59c384);}}),router[a0_0x33bc05(0xcf)](a0_0x33bc05(0x125),async(_0x1becd9,_0x26bc4b)=>{var _0xad5aa4=a0_0x33bc05;const {product_code:_0x130cea,warehouse_name:_0x129def,rooms_data:_0x47c576,Roomslist:_0xf9c1d5}=_0x1becd9[_0xad5aa4(0x10c)],_0x1575c1=_0xf9c1d5[_0xad5aa4(0x18e)](','),_0x2b14d3=[];async function _0x46eca2(_0x27af57){var _0x58aff7=_0xad5aa4;const _0x10c085=await warehouse['aggregate']([{'$match':{'name':_0x129def,'room':_0x27af57}},{'$unwind':_0x58aff7(0x127)},{'$match':{'product_details.primary_code':_0x130cea}},{'$group':{'_id':_0x58aff7(0xdf),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x58aff7(0x131)},'primary_code':{'$first':_0x58aff7(0x13f)},'secondary_code':{'$first':_0x58aff7(0xc6)},'product_code':{'$first':_0x58aff7(0x12d)},'level':{'$first':_0x58aff7(0x112)},'isle':{'$first':_0x58aff7(0x198)},'type':{'$first':_0x58aff7(0x11a)},'pallet':{'$first':_0x58aff7(0x173)},'unit':{'$first':_0x58aff7(0xbd)},'secondary_unit':{'$first':_0x58aff7(0xdb)},'storage':{'$first':_0x58aff7(0xb8)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x58aff7(0x17f)},'production_date':{'$first':_0x58aff7(0x114)},'maxPerUnit':{'$first':_0x58aff7(0x102)},'batch_code':{'$first':_0x58aff7(0xe6)},'product_cat':{'$first':_0x58aff7(0xc5)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x58aff7(0x11b)},'invoice':{'$first':_0x58aff7(0x19e)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x58aff7(0xf3)}}}]),_0x59b411=await warehouse[_0x58aff7(0xb9)]([{'$match':{'name':_0x129def,'room':_0x27af57}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x130cea}},{'$group':{'_id':_0x58aff7(0xdf),'name':{'$first':_0x58aff7(0x124)},'product_stock':{'$first':_0x58aff7(0x131)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x58aff7(0xc6)},'product_code':{'$first':_0x58aff7(0x12d)},'level':{'$first':_0x58aff7(0x112)},'isle':{'$first':_0x58aff7(0x198)},'type':{'$first':_0x58aff7(0x11a)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x58aff7(0xdb)},'storage':{'$first':_0x58aff7(0xb8)},'rack':{'$first':_0x58aff7(0xd1)},'expiry_date':{'$first':_0x58aff7(0x17f)},'production_date':{'$first':_0x58aff7(0x114)},'maxPerUnit':{'$first':_0x58aff7(0x102)},'batch_code':{'$first':_0x58aff7(0xe6)},'product_cat':{'$first':_0x58aff7(0xc5)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x58aff7(0x19e)}}}]);if(_0x10c085['length']>0x0)_0x2b14d3[_0x58aff7(0x158)](_0x10c085);else _0x59b411[_0x58aff7(0x136)]>0x0&&_0x2b14d3[_0x58aff7(0x158)](_0x59b411);}const _0x14bf9d=_0x1575c1[_0xad5aa4(0x16d)](_0x3eae31=>_0x46eca2(_0x3eae31));await Promise[_0xad5aa4(0x14b)](_0x14bf9d),_0x26bc4b[_0xad5aa4(0x182)](_0x2b14d3);}),module[a0_0x33bc05(0xb4)]=router;