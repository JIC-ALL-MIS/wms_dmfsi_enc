var a0_0x1c136b=a0_0x2ebf;(function(_0x3cfaf0,_0x139b88){var _0x249205=a0_0x2ebf,_0x14e999=_0x3cfaf0();while(!![]){try{var _0x11907f=-parseInt(_0x249205(0x187))/0x1*(-parseInt(_0x249205(0x1a8))/0x2)+parseInt(_0x249205(0x192))/0x3*(parseInt(_0x249205(0x16f))/0x4)+parseInt(_0x249205(0x101))/0x5*(parseInt(_0x249205(0x19b))/0x6)+parseInt(_0x249205(0xff))/0x7*(parseInt(_0x249205(0x19f))/0x8)+-parseInt(_0x249205(0xf7))/0x9*(parseInt(_0x249205(0xe1))/0xa)+parseInt(_0x249205(0xc8))/0xb*(-parseInt(_0x249205(0xd8))/0xc)+-parseInt(_0x249205(0x14e))/0xd*(parseInt(_0x249205(0x137))/0xe);if(_0x11907f===_0x139b88)break;else _0x14e999['push'](_0x14e999['shift']());}catch(_0x243d6a){_0x14e999['push'](_0x14e999['shift']());}}}(a0_0xc487,0x445c3));const express=require(a0_0x1c136b(0x184)),app=express(),router=express[a0_0x1c136b(0xcc)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1c136b(0xe2)),auth=require(a0_0x1c136b(0xf1)),nodemailer=require('nodemailer'),users=require('../public/language/languages.json');function a0_0xc487(){var _0x2edec8=['stock_data','id_transact','/upload/','slice','Spanish','carton','OUT-','$product_details.product_code','Error\x20Occurs','product_details','An\x20error\x20occurred\x20while\x20saving\x20data.','purchases_data','$return_data','sales\x20all_data','$product_details.expiry_date','redirect','all_sales_barcode','primary_unit','$product','date','map','$sale_product.quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.actual_uom','Receiving\x20Area','random','room_name','Arabic\x20(ae)','<h2>\x20','secondary_code','2050564HUSPGC','max_per_unit','filter','\x20</h2>','RoomAssigned','storage','body','return_sale','product_data','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Hindi','$product_details.secondary_code','Enabled','level','$sale_product.bin','/preview/:id','params','isAllowEdit','return_data','$product_details.delivery_code','$product.product_name','express','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.delivery_date','731DVEyNI','German','<tr>','split','$product_details.unit','due_amount','/view/add_sales/:id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</table>','actual_uom','/all_sales/view','3kjhOFY','production_date','warehouse_name','\x20Order\x20Date\x20:\x20','currency_placement','port','sendMail','push','/../public','234uxuqZd','add_sales','floorlevel','$product_details.pallet','1056904gYlehx','concat','</h5>','status','$finalize','product_stock','json','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','8YMYzFg','warehouse','$product_details.secondary_unit','flash','user','/barcode/:id','Enclosed','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.maxPerUnit','customer_data','SCRN','Ambient','payment\x20successfull','/view/:id','primary_code','unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','</td>','quantity_notConverted','site_title','bin','log','product_name','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<h5>','sales_invoice','post','expiry_date','Return\x20Rooms','return_qty','sale_product','error','<html><head><title></title>','$isAllowEdit','Chinese','requested_qty','getMonth','</head><body>','customer','$product_details.product_cat','/give_payment/:id','all','back','get','string','findById','Logo.png','$product_details.bin','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','maxperunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','master','exports','delivery_code','/view','3848339HUrpPi','add\x20post','quantity','staff','Router','<hr\x20class=\x22my-3\x22>','prod_invoice','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$sale_product','Raw\x20Materials','An\x20error\x20occurred.','$product_details.isle','French','RMSEmail','stocks','12IiTuBY','amount','errors','$room','English','stock','product_code','$product_details.batch_code','rack','5400gJuRfh','../models/all_models','note','image','<div>','product','render','$product_details.production_date','False','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details','English\x20(US)','secondary_unit','Level','finalize','../middleware/auth','$name','message','all_sales','delivery_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','1791KXVIUO','<strong>\x20Regards\x20</strong>','received_amount','<!DOCTYPE\x20html>','language','aggregate','Portuguese\x20(BR)','_id','14QJmNCA','Return\x20Goods','57370VVmLFu','sale_qty','max','/invoice/:id','createTransport','$customer','$sale_product.type','$product_details.rack','</div>','Sales\x20Add\x20successfully','role','logo','length','Sale\x20Return','$product_details.type','type','barcode\x20user_id','password','actual_qty','findOne','Floor','product_list','batch_code','$product_details.product_name','save','Portuguese','customers','barcode\x20Product\x20master','user_id','sales_quantity','/view/return_sales/:id','then','$product_details.bay','<span\x20style=\x22float:\x20right;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','abs','success','$product_details._id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</body></html>','foreach\x20newproduct','$_id','/view/add_sales','room','toString','find','email','$product_details.invoice','/all_sales/preview/','$warehouse_name','$product_details.primary_code','$product_details.floorlevel','$sale_product.bay','</tr>','98LBeeqN','$product_details.storage','catch','</thead>','Email\x20sent\x20successfully','bay','$invoice','True','$customers_docs','Sales\x20Update\x20successfully','prod_code','invoice','prod_cat','<tbody\x20style=\x22text-align:\x20center;\x22>','/view/add_sale/product','$note','gmail','$product_details.actual_qty','forEach','edit_sales_view','$date','types','currency','909935tSKgMc','id_transaction_from','name'];a0_0xc487=function(){return _0x2edec8;};return a0_0xc487();}router['get'](a0_0x1c136b(0xc7),auth,async(_0x517fbb,_0x362ea8)=>{var _0x727b62=a0_0x1c136b;try{const {username:_0x130a7a,email:_0x48b86f,role:_0x2b3ceb}=_0x517fbb[_0x727b62(0x1ac)],_0x5c7e20=_0x517fbb[_0x727b62(0x1ac)],_0x2ba0eb=await profile[_0x727b62(0x114)]({'email':_0x5c7e20[_0x727b62(0x12f)]}),_0x29425c=await master_shop[_0x727b62(0x12e)]();let _0x546ca7;if(_0x5c7e20[_0x727b62(0x10b)]==_0x727b62(0xcb)){const _0x2684b7=await staff[_0x727b62(0x114)]({'email':_0x5c7e20['email']});_0x546ca7=await sales['aggregate']([{'$lookup':{'from':_0x727b62(0x11b),'localField':'customer','foreignField':_0x727b62(0x150),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x727b62(0xd1)},{'$group':{'_id':_0x727b62(0x12a),'invoice':{'$first':_0x727b62(0x13d)},'customers':{'$first':_0x727b62(0x106)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x727b62(0x132)},'sale_product':{'$push':_0x727b62(0xd1)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x727b62(0x13f)},'total_saleproduct_quantity':{'$sum':_0x727b62(0x166)},'level':{'$addToSet':_0x727b62(0x135)},'isle':{'$addToSet':_0x727b62(0x17d)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x727b62(0x1a3)},'isAllowEdit':{'$first':_0x727b62(0xb2)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x546ca7=await sales['aggregate']([{'$lookup':{'from':'customers','localField':_0x727b62(0xb7),'foreignField':_0x727b62(0x150),'as':'customers_docs'}},{'$unwind':_0x727b62(0x13f)},{'$unwind':_0x727b62(0xd1)},{'$group':{'_id':_0x727b62(0x12a),'invoice':{'$first':_0x727b62(0x13d)},'customers':{'$first':_0x727b62(0x106)},'date':{'$first':_0x727b62(0x14b)},'warehouse_name':{'$first':_0x727b62(0x132)},'sale_product':{'$push':_0x727b62(0xd1)},'note':{'$first':_0x727b62(0x146)},'return_data':{'$first':_0x727b62(0x15d)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x727b62(0x166)},'level':{'$addToSet':_0x727b62(0x135)},'isle':{'$addToSet':_0x727b62(0x17d)},'type':{'$addToSet':_0x727b62(0x107)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x727b62(0x1a3)},'isAllowEdit':{'$first':_0x727b62(0xb2)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x727b62(0xa6)](_0x727b62(0x15e),_0x546ca7);if(_0x29425c[0x0][_0x727b62(0xfb)]=='English\x20(US)'){var _0x48b9fe=users[_0x727b62(0xdc)];console[_0x727b62(0xa6)](_0x48b9fe);}else{if(_0x29425c[0x0][_0x727b62(0xfb)]=='Hindi')var _0x48b9fe=users['Hindi'];else{if(_0x29425c[0x0][_0x727b62(0xfb)]==_0x727b62(0x188))var _0x48b9fe=users[_0x727b62(0x188)];else{if(_0x29425c[0x0][_0x727b62(0xfb)]=='Spanish')var _0x48b9fe=users['Spanish'];else{if(_0x29425c[0x0]['language']==_0x727b62(0xd5))var _0x48b9fe=users[_0x727b62(0xd5)];else{if(_0x29425c[0x0]['language']==_0x727b62(0xfd))var _0x48b9fe=users[_0x727b62(0x11a)];else{if(_0x29425c[0x0][_0x727b62(0xfb)]=='Chinese')var _0x48b9fe=users[_0x727b62(0xb3)];else{if(_0x29425c[0x0][_0x727b62(0xfb)]==_0x727b62(0x16c))var _0x48b9fe=users['Arabic'];}}}}}}}_0x362ea8['render'](_0x727b62(0xf4),{'success':_0x517fbb['flash'](_0x727b62(0x125)),'errors':_0x517fbb[_0x727b62(0x1ab)](_0x727b62(0xda)),'sales':_0x546ca7,'profile':_0x2ba0eb,'role':_0x5c7e20,'master_shop':_0x29425c,'language':_0x48b9fe});}catch(_0x3d86f9){console[_0x727b62(0xa6)](_0x3d86f9);}});async function getRandom8DigitNumber(){var _0x244be0=a0_0x1c136b;const _0x77a8e8=0x989680,_0xd72d52=0x5f5e0ff,_0x60ec01=Math['floor'](Math[_0x244be0(0x16a)]()*(_0xd72d52-_0x77a8e8+0x1))+_0x77a8e8;var _0x16b51c;const _0xc8eb59=await sales[_0x244be0(0x114)]({'invoice':_0x244be0(0x157)+_0x60ec01});return _0xc8eb59&&_0xc8eb59[_0x244be0(0x10d)]>0x0?_0x16b51c=_0x244be0(0x157)+_0x60ec01:_0x16b51c=_0x244be0(0x157)+_0x60ec01,_0x16b51c;}function a0_0x2ebf(_0x20c2d3,_0x223c69){var _0xc4873c=a0_0xc487();return a0_0x2ebf=function(_0x2ebf5f,_0x767065){_0x2ebf5f=_0x2ebf5f-0x96;var _0x514e53=_0xc4873c[_0x2ebf5f];return _0x514e53;},a0_0x2ebf(_0x20c2d3,_0x223c69);}router[a0_0x1c136b(0xbc)](a0_0x1c136b(0x12b),auth,async(_0x4ae10d,_0x535e31)=>{var _0x51d656=a0_0x1c136b;try{const {username:_0x112a78,email:_0x1ab771,role:_0x221354}=_0x4ae10d[_0x51d656(0x1ac)],_0x27a755=_0x4ae10d[_0x51d656(0x1ac)],_0x417ccf=await profile['findOne']({'email':_0x27a755[_0x51d656(0x12f)]}),_0x5e1647=await master_shop['find'](),_0xe073f1=await customer[_0x51d656(0x12e)]({});let _0x461259;if(_0x27a755[_0x51d656(0x10b)]=='staff'){const _0x3f0193=await staff[_0x51d656(0x114)]({'email':_0x27a755[_0x51d656(0x12f)]});_0x461259=await warehouse[_0x51d656(0xfc)]([{'$match':{'status':_0x51d656(0x17b),'name':_0x3f0193[_0x51d656(0x1a9)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x51d656(0x100)}}},{'$group':{'_id':_0x51d656(0xf2),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x461259=await warehouse[_0x51d656(0xfc)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0x51d656(0x100)}}},{'$group':{'_id':_0x51d656(0xf2),'name':{'$first':_0x51d656(0xf2)}}},{'$sort':{'name':0x1}}]);const _0x30ffe9=await product[_0x51d656(0x12e)]({});var _0x5ef007=[_0x51d656(0x9c),'Enclosed'];const _0x435156=await sales['find']({}),_0x5b7d95=_0x435156[_0x51d656(0x10d)]+0x1,_0x3488c8=_0x51d656(0x157)+_0x5b7d95[_0x51d656(0x12d)]()['padStart'](0x5,'0');if(_0x5e1647[0x0]['language']==_0x51d656(0xed)){var _0x2964e=users[_0x51d656(0xdc)];console[_0x51d656(0xa6)](_0x2964e);}else{if(_0x5e1647[0x0]['language']==_0x51d656(0x179))var _0x2964e=users['Hindi'];else{if(_0x5e1647[0x0][_0x51d656(0xfb)]==_0x51d656(0x188))var _0x2964e=users['German'];else{if(_0x5e1647[0x0]['language']==_0x51d656(0x155))var _0x2964e=users[_0x51d656(0x155)];else{if(_0x5e1647[0x0][_0x51d656(0xfb)]=='French')var _0x2964e=users[_0x51d656(0xd5)];else{if(_0x5e1647[0x0][_0x51d656(0xfb)]=='Portuguese\x20(BR)')var _0x2964e=users[_0x51d656(0x11a)];else{if(_0x5e1647[0x0][_0x51d656(0xfb)]==_0x51d656(0xb3))var _0x2964e=users[_0x51d656(0xb3)];else{if(_0x5e1647[0x0][_0x51d656(0xfb)]=='Arabic\x20(ae)')var _0x2964e=users['Arabic'];}}}}}}}const _0x33a7bf=getRandom8DigitNumber();_0x33a7bf[_0x51d656(0x120)](_0x1e1e3f=>{var _0x3e7872=_0x51d656;_0x535e31[_0x3e7872(0xe7)](_0x3e7872(0x19c),{'success':_0x4ae10d[_0x3e7872(0x1ab)](_0x3e7872(0x125)),'errors':_0x4ae10d[_0x3e7872(0x1ab)](_0x3e7872(0xda)),'role':_0x27a755,'profile':_0x417ccf,'customer':_0xe073f1,'warehouse':_0x461259,'product':_0x30ffe9,'invoice':_0x1e1e3f,'master_shop':_0x5e1647,'language':_0x2964e,'rooms_data':_0x5ef007});})[_0x51d656(0x139)](_0x1b32eb=>{var _0x5d0245=_0x51d656;_0x4ae10d[_0x5d0245(0x1ab)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x535e31[_0x5d0245(0x160)](_0x5d0245(0x191));});}catch(_0x2750d4){console[_0x51d656(0xa6)](_0x2750d4);}}),router['get'](a0_0x1c136b(0x18d),auth,async(_0x244776,_0x3fbb72)=>{var _0x2c3600=a0_0x1c136b;try{const _0x3b1137=_0x244776['params']['id'];console['log'](_0x3b1137);const _0x5a8b42=await product[_0x2c3600(0x12e)](),_0x570d97=await purchases[_0x2c3600(0xfc)]([{'$match':{'warehouse_name':_0x3b1137}},{'$unwind':_0x2c3600(0x163)},{'$group':{'_id':_0x2c3600(0x183)}}]);console[_0x2c3600(0xa6)](_0x2c3600(0x15c),_0x570d97),_0x3fbb72['status'](0xc8)[_0x2c3600(0x1a5)]({'purchases_data':_0x570d97,'product_data':_0x5a8b42});}catch(_0x288432){console['log'](_0x288432);}}),router['post'](a0_0x1c136b(0x145),auth,async(_0x22260e,_0x57a639)=>{var _0x42c441=a0_0x1c136b;try{const {warehouse_data:_0x45b271,product_data:_0x6e3bca}=_0x22260e[_0x42c441(0x175)];console[_0x42c441(0xa6)](_0x22260e['body'][_0x42c441(0x177)]);;const _0x185177=await master_shop['find']();console[_0x42c441(0xa6)]('master',_0x185177);const _0x3d3004=await product['findOne']({'name':_0x6e3bca});console[_0x42c441(0xa6)](_0x42c441(0xe6),_0x3d3004);const _0x23013e=await warehouse[_0x42c441(0xfc)]([{'$match':{'name':_0x45b271}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x6e3bca}},{'$group':{'_id':_0x42c441(0x118),'product_stock':{'$first':'$product_details.product_stock'}}}]);console['log'](_0x42c441(0x151),_0x23013e),_0x57a639[_0x42c441(0x1a2)](0xc8)[_0x42c441(0x1a5)]({'master':_0x185177,'new_product':_0x3d3004,'stock_data':_0x23013e});}catch(_0x38804f){console[_0x42c441(0xa6)](_0x38804f);}}),router[a0_0x1c136b(0xab)](a0_0x1c136b(0x12b),auth,async(_0x41d7c4,_0x38b852)=>{var _0x1f2ce4=a0_0x1c136b;try{const {invoice:_0x47dda0,date:_0x3b909e,warehouse_name:_0x20ac28,product_name:_0x48820b,stock:_0x3d95b5,quantity:_0x1f6100,note:_0x298643,room:_0x1cf722,primary_code:_0x1333d6,secondary_code:_0x2f029c,prod_code:_0xe440c6,level:_0x422ceb,isle:_0x551e45,pallet:_0x5c3c5a,batch_code:_0x2dfd44,SCRN:_0x183d80,expiry_date:_0x1c0c2a}=_0x41d7c4[_0x1f2ce4(0x175)];if(typeof _0x48820b=='string')var _0x339c68=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0xa7)]],_0x36aaaf=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0xdd)]],_0x142898=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x156)]],_0xd23c44=[_0x41d7c4['body']['primary_code']],_0x5e0104=[_0x41d7c4['body']['secondary_code']],_0x26febf=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x141)]],_0x16e781=[_0x41d7c4[_0x1f2ce4(0x175)]['level']],_0x53d967=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x162)]],_0x58f45b=[_0x41d7c4['body'][_0x1f2ce4(0xee)]],_0x212949=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x117)]],_0x3f1bf4=[_0x41d7c4[_0x1f2ce4(0x175)]['expiry_date']],_0x1f14df=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x170)]],_0x574815=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x193)]],_0x484710=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0xb4)]],_0x3a4001=[_0x41d7c4[_0x1f2ce4(0x175)]['delivery_date']],_0x1069bf=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0xc6)]],_0x5264e7=[_0x41d7c4[_0x1f2ce4(0x175)]['prod_cat']],_0x5a4833=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0xca)]],_0x294d64=[_0x41d7c4[_0x1f2ce4(0x175)]['RoomAssigned']],_0x22e74d=[_0x41d7c4['body'][_0x1f2ce4(0xce)]],_0x2dbad2=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x113)]],_0x14896d=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x190)]],_0x44c46d=[_0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x152)]];else var _0x339c68=[..._0x41d7c4['body'][_0x1f2ce4(0xa7)]],_0x36aaaf=[..._0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0xdd)]],_0x142898=[..._0x41d7c4['body']['carton']],_0xd23c44=[..._0x41d7c4[_0x1f2ce4(0x175)]['primary_code']],_0x5e0104=[..._0x41d7c4['body']['secondary_code']],_0x26febf=[..._0x41d7c4['body'][_0x1f2ce4(0x141)]],_0x16e781=[..._0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x17c)]],_0x53d967=[..._0x41d7c4['body'][_0x1f2ce4(0x162)]],_0x58f45b=[..._0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0xee)]],_0x212949=[..._0x41d7c4['body'][_0x1f2ce4(0x117)]],_0x3f1bf4=[..._0x41d7c4[_0x1f2ce4(0x175)]['expiry_date']],_0x1f14df=[..._0x41d7c4[_0x1f2ce4(0x175)]['max_per_unit']],_0x574815=[..._0x41d7c4[_0x1f2ce4(0x175)]['production_date']],_0x484710=[..._0x41d7c4[_0x1f2ce4(0x175)]['requested_qty']],_0x3a4001=[..._0x41d7c4['body'][_0x1f2ce4(0xf5)]],_0x1069bf=[..._0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0xc6)]],_0x5264e7=[..._0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x143)]],_0x5a4833=[..._0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0xca)]],_0x294d64=[..._0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x173)]],_0x22e74d=[..._0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0xce)]],_0x2dbad2=[..._0x41d7c4['body']['actual_qty']],_0x14896d=[..._0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x190)]],_0x44c46d=[..._0x41d7c4[_0x1f2ce4(0x175)][_0x1f2ce4(0x152)]];const _0x2c4d8f=_0x339c68['map'](_0x106dc9=>{return _0x106dc9={'product_name':_0x106dc9};});_0x36aaaf[_0x1f2ce4(0x149)]((_0x1b2f98,_0x276d2a)=>{var _0x253c9b=_0x1f2ce4;_0x2c4d8f[_0x276d2a][_0x253c9b(0xdd)]=Math['abs'](_0x1b2f98);}),_0x2dbad2['forEach']((_0x5ac99a,_0x53944f)=>{var _0x59c347=_0x1f2ce4;_0x2c4d8f[_0x53944f][_0x59c347(0x113)]=Math[_0x59c347(0x124)](_0x5ac99a);}),_0x14896d['forEach']((_0x359381,_0x1aba0b)=>{var _0x507f2a=_0x1f2ce4;_0x2c4d8f[_0x1aba0b][_0x507f2a(0x190)]=_0x359381;}),_0x44c46d[_0x1f2ce4(0x149)]((_0x437aeb,_0xd9629e)=>{var _0x51e3e7=_0x1f2ce4;_0x2c4d8f[_0xd9629e][_0x51e3e7(0x14f)]=_0x437aeb;}),_0x142898[_0x1f2ce4(0x149)]((_0x3db7fa,_0x35eb76)=>{var _0x401501=_0x1f2ce4;_0x2c4d8f[_0x35eb76][_0x401501(0xca)]=_0x3db7fa;}),_0xd23c44[_0x1f2ce4(0x149)]((_0x24384c,_0x49cebe)=>{var _0x3269e7=_0x1f2ce4;_0x2c4d8f[_0x49cebe][_0x3269e7(0x9f)]=_0x24384c;}),_0x5e0104[_0x1f2ce4(0x149)]((_0x406176,_0x49554b)=>{var _0x10e763=_0x1f2ce4;_0x2c4d8f[_0x49554b][_0x10e763(0x16e)]=_0x406176;}),_0x26febf['forEach']((_0x3017d1,_0x55215f)=>{_0x2c4d8f[_0x55215f]['product_code']=_0x3017d1;}),_0x16e781[_0x1f2ce4(0x149)]((_0x2e5c19,_0x3ca7ef)=>{var _0x576e80=_0x1f2ce4;_0x294d64[_0x576e80(0x149)]((_0xfc2359,_0xa1e18e)=>{var _0x1a7777=_0x576e80;if(_0xfc2359==_0x1a7777(0x169)&&_0x3ca7ef==_0xa1e18e){var _0x431d40=_0x2e5c19[_0x1a7777(0x154)](0x3);_0x2c4d8f[_0x3ca7ef][_0x1a7777(0x174)]=_0x2e5c19[0x0],_0x2c4d8f[_0x3ca7ef][_0x1a7777(0xe0)]=_0x2e5c19[0x1],_0x2c4d8f[_0x3ca7ef][_0x1a7777(0x13c)]=0x0,_0x2c4d8f[_0x3ca7ef][_0x1a7777(0xa5)]=0x0,_0x2c4d8f[_0x3ca7ef]['type']='Floor',_0x2c4d8f[_0x3ca7ef][_0x1a7777(0x19d)]=_0x431d40;}else{if(_0xfc2359=='Shelves'&&_0x3ca7ef==_0xa1e18e){var _0x431d40=_0x2e5c19[_0x1a7777(0x154)](0x3);_0x2c4d8f[_0x3ca7ef]['storage']=_0x2e5c19[0x0],_0x2c4d8f[_0x3ca7ef][_0x1a7777(0xe0)]=_0x2e5c19[0x1],_0x2c4d8f[_0x3ca7ef][_0x1a7777(0x13c)]=0x0,_0x2c4d8f[_0x3ca7ef][_0x1a7777(0xa5)]=0x0,_0x2c4d8f[_0x3ca7ef][_0x1a7777(0x110)]=_0x1a7777(0x115),_0x2c4d8f[_0x3ca7ef]['floorlevel']=_0x2e5c19[0x5];}else{if(_0x3ca7ef==_0xa1e18e){var _0x2bc21c;if(_0x2e5c19[0x4]=='L')_0x2bc21c='Level';else _0x2e5c19[0x4]=='F'&&(_0x2bc21c='Floor');_0x2c4d8f[_0x3ca7ef][_0x1a7777(0x174)]=_0x2e5c19[0x0],_0x2c4d8f[_0x3ca7ef]['rack']=_0x2e5c19[0x1],_0x2c4d8f[_0x3ca7ef][_0x1a7777(0x13c)]=_0x2e5c19[0x2],_0x2c4d8f[_0x3ca7ef][_0x1a7777(0xa5)]=_0x2e5c19[0x3],_0x2c4d8f[_0x3ca7ef][_0x1a7777(0x110)]=_0x2bc21c,_0x2c4d8f[_0x3ca7ef]['floorlevel']=_0x2e5c19[0x5];}}}});}),_0x53d967[_0x1f2ce4(0x149)]((_0x30b4c4,_0x5c1f0a)=>{var _0x1681b7=_0x1f2ce4;_0x2c4d8f[_0x5c1f0a][_0x1681b7(0xa0)]=_0x30b4c4;}),_0x58f45b[_0x1f2ce4(0x149)]((_0x3319e3,_0x20dd7e)=>{_0x2c4d8f[_0x20dd7e]['secondary_unit']=_0x3319e3;}),_0x212949[_0x1f2ce4(0x149)]((_0x54dc41,_0x3f2438)=>{var _0x35a780=_0x1f2ce4;_0x2c4d8f[_0x3f2438][_0x35a780(0x117)]=_0x54dc41;}),_0x3f1bf4[_0x1f2ce4(0x149)]((_0xe0da82,_0x14f726)=>{_0x2c4d8f[_0x14f726]['expiry_date']=_0xe0da82;}),_0x1f14df[_0x1f2ce4(0x149)]((_0x4abdab,_0x5b943f)=>{var _0x47f43=_0x1f2ce4;_0x2c4d8f[_0x5b943f][_0x47f43(0xc2)]=_0x4abdab;}),_0x574815[_0x1f2ce4(0x149)]((_0x4b7d37,_0x35e6b0)=>{var _0x28558d=_0x1f2ce4;_0x2c4d8f[_0x35e6b0][_0x28558d(0x193)]=_0x4b7d37;}),_0x484710['forEach']((_0xb4a85e,_0x5aa41e)=>{var _0x5d8ffa=_0x1f2ce4;_0x2c4d8f[_0x5aa41e][_0x5d8ffa(0xb4)]=_0xb4a85e;}),_0x3a4001[_0x1f2ce4(0x149)]((_0x26ff0b,_0x44f43a)=>{var _0x1eec03=_0x1f2ce4;_0x2c4d8f[_0x44f43a][_0x1eec03(0xf5)]=_0x26ff0b;}),_0x1069bf['forEach']((_0x5b6999,_0x245156)=>{var _0x3618e5=_0x1f2ce4;_0x2c4d8f[_0x245156][_0x3618e5(0xc6)]=_0x5b6999;}),_0x5264e7[_0x1f2ce4(0x149)]((_0x14c1c5,_0x4ac84e)=>{var _0x4efaad=_0x1f2ce4;_0x2c4d8f[_0x4ac84e][_0x4efaad(0x143)]=_0x14c1c5;}),_0x5a4833[_0x1f2ce4(0x149)]((_0xe510e3,_0x25fc5c)=>{_0x2c4d8f[_0x25fc5c]['quantity_notConverted']=_0xe510e3;}),_0x294d64[_0x1f2ce4(0x149)]((_0x269b91,_0x2e7fb3)=>{var _0x4ea0d6=_0x1f2ce4;_0x2c4d8f[_0x2e7fb3][_0x4ea0d6(0x16b)]=_0x269b91;}),_0x22e74d[_0x1f2ce4(0x149)]((_0xc3482d,_0x3bddc3)=>{_0x2c4d8f[_0x3bddc3]['invoice']=_0xc3482d;});var _0x47d300=0x0;_0x2c4d8f[_0x1f2ce4(0x149)](_0x403571=>{var _0x9f0239=_0x1f2ce4;(_0x403571['stock']<_0x403571[_0x9f0239(0xa3)]||_0x403571['quantity_notConverted']==0x0)&&(console['log'](_0x9f0239(0x129),_0x403571),_0x47d300++);});const _0x18549d=_0x2c4d8f[_0x1f2ce4(0x171)](_0xa24d32=>_0xa24d32[_0x1f2ce4(0xca)]!=='0'&&_0xa24d32['quantity']!==''),_0x10bcda=new sales({'invoice':_0x47dda0,'customer':_0x41d7c4['body']['customer'],'date':_0x3b909e,'warehouse_name':_0x20ac28,'sale_product':_0x18549d,'note':_0x298643,'room':_0x1cf722,'primary_code':_0x1333d6,'secondary_code':_0x2f029c,'prod_code':_0xe440c6,'SCRN':_0x183d80}),_0x38bf76=await _0x10bcda[_0x1f2ce4(0x119)]();_0x41d7c4[_0x1f2ce4(0x1ab)]('success',_0x1f2ce4(0x10a)),_0x38b852[_0x1f2ce4(0x160)](_0x1f2ce4(0x131)+_0x38bf76[_0x1f2ce4(0xfe)]);}catch(_0x6698f9){console['log'](_0x6698f9);}}),router[a0_0x1c136b(0xbc)](a0_0x1c136b(0x17e),auth,async(_0x160250,_0x13316e)=>{var _0x5a78fd=a0_0x1c136b;try{const {username:_0x52c9e8,email:_0x27441d,role:_0x165863}=_0x160250[_0x5a78fd(0x1ac)],_0x130d2d=_0x160250[_0x5a78fd(0x1ac)],_0x270ea2=await profile[_0x5a78fd(0x114)]({'email':_0x130d2d[_0x5a78fd(0x12f)]}),_0x1465f5=await master_shop[_0x5a78fd(0x12e)](),_0x4c7b66=_0x160250[_0x5a78fd(0x17f)]['id'],_0x306535=await sales[_0x5a78fd(0xbe)](_0x4c7b66),_0x46e53b=await warehouse[_0x5a78fd(0xfc)]([{'$match':{'name':_0x306535[_0x5a78fd(0x194)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5a78fd(0x126),'name':{'$first':_0x5a78fd(0x118)},'product_stock':{'$first':_0x5a78fd(0xcf)},'bay':{'$first':_0x5a78fd(0x121)},'bin':{'$first':_0x5a78fd(0xc0)},'type':{'$first':_0x5a78fd(0x10f)},'floorlevel':{'$first':_0x5a78fd(0x134)},'primary_code':{'$first':_0x5a78fd(0x133)},'secondary_code':{'$first':_0x5a78fd(0x17a)},'product_code':{'$first':_0x5a78fd(0x158)},'storage':{'$first':_0x5a78fd(0x138)},'rack':{'$first':_0x5a78fd(0x108)},'expiry_date':{'$first':_0x5a78fd(0x15f)},'production_date':{'$first':_0x5a78fd(0xe8)},'invoice':{'$first':_0x5a78fd(0x130)}}}]),_0x3ed774=await customer[_0x5a78fd(0x12e)]({});let _0x511f91;if(_0x130d2d[_0x5a78fd(0x10b)]=='staff'){const _0xbdc0cd=await staff[_0x5a78fd(0x114)]({'email':_0x130d2d['email']});_0x511f91=await warehouse[_0x5a78fd(0xfc)]([{'$match':{'status':_0x5a78fd(0x17b),'name':_0xbdc0cd[_0x5a78fd(0x1a9)]}},{'$group':{'_id':_0x5a78fd(0xf2),'name':{'$first':_0x5a78fd(0xf2)}}}]);}else _0x511f91=await warehouse[_0x5a78fd(0xfc)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x5a78fd(0xf2),'name':{'$first':_0x5a78fd(0xf2)}}}]);const _0x1a0129=await product['find']({}),_0x201834=await suppliers['find']({});if(_0x1465f5[0x0]['language']==_0x5a78fd(0xed)){var _0x24a731=users['English'];console['log'](_0x24a731);}else{if(_0x1465f5[0x0][_0x5a78fd(0xfb)]==_0x5a78fd(0x179))var _0x24a731=users[_0x5a78fd(0x179)];else{if(_0x1465f5[0x0][_0x5a78fd(0xfb)]==_0x5a78fd(0x188))var _0x24a731=users['German'];else{if(_0x1465f5[0x0][_0x5a78fd(0xfb)]=='Spanish')var _0x24a731=users[_0x5a78fd(0x155)];else{if(_0x1465f5[0x0][_0x5a78fd(0xfb)]==_0x5a78fd(0xd5))var _0x24a731=users['French'];else{if(_0x1465f5[0x0][_0x5a78fd(0xfb)]==_0x5a78fd(0xfd))var _0x24a731=users[_0x5a78fd(0x11a)];else{if(_0x1465f5[0x0][_0x5a78fd(0xfb)]=='Chinese')var _0x24a731=users['Chinese'];else{if(_0x1465f5[0x0][_0x5a78fd(0xfb)]==_0x5a78fd(0x16c))var _0x24a731=users['Arabic'];}}}}}}}_0x13316e[_0x5a78fd(0xe7)](_0x5a78fd(0x14a),{'success':_0x160250[_0x5a78fd(0x1ab)]('success'),'errors':_0x160250[_0x5a78fd(0x1ab)]('errors'),'role':_0x130d2d,'profile':_0x270ea2,'customer':_0x3ed774,'warehouse':_0x511f91,'product':_0x46e53b,'user':_0x306535,'master_shop':_0x1465f5,'unit':_0x1a0129,'language':_0x24a731,'suppliers':_0x201834});}catch(_0x21fb57){console[_0x5a78fd(0xa6)](_0x21fb57);}}),router['post'](a0_0x1c136b(0x17e),auth,async(_0x526c62,_0x383d0e)=>{var _0x48980c=a0_0x1c136b;try{const _0x57a6c6=_0x526c62[_0x48980c(0x17f)]['id'],{invoice:_0xe5a538,warehouse_name:_0x133430,room:_0x5885b7}=_0x526c62[_0x48980c(0x175)],_0x370b18=await sales[_0x48980c(0x114)]({'invoice':_0xe5a538}),_0x1456eb=_0x370b18[_0x48980c(0xaf)][_0x48980c(0x165)](async _0x328880=>{var _0x4a0b41=_0x48980c,_0x3d8e12=await warehouse[_0x4a0b41(0x114)]({'name':_0x133430,'room':_0x328880['room_name'],'warehouse_category':'Raw\x20Materials'});const _0x9f9e3a=_0x3d8e12[_0x4a0b41(0x15a)][_0x4a0b41(0x165)](_0x3b270a=>{var _0x1ba630=_0x4a0b41;_0x3b270a[_0x1ba630(0xa7)]==_0x328880[_0x1ba630(0xa7)]&&_0x3b270a['floorlevel']==_0x328880[_0x1ba630(0x19d)]&&_0x3b270a[_0x1ba630(0x110)]==_0x328880[_0x1ba630(0x110)]&&_0x3b270a[_0x1ba630(0xa5)]==_0x328880['bin']&&_0x3b270a['bay']==_0x328880['bay']&&_0x3b270a['rack']==_0x328880[_0x1ba630(0xe0)]&&_0x3b270a[_0x1ba630(0x174)]==_0x328880[_0x1ba630(0x174)]&&_0x3b270a[_0x1ba630(0xac)]==_0x328880['expiry_date']&&_0x3b270a[_0x1ba630(0x117)]==_0x328880[_0x1ba630(0x117)]&&_0x3b270a[_0x1ba630(0xfe)]==_0x328880[_0x1ba630(0x14f)]&&(_0x3b270a[_0x1ba630(0x1a4)]=Math[_0x1ba630(0x103)](0x0,Math[_0x1ba630(0x124)](_0x3b270a[_0x1ba630(0x1a4)])-Math['abs'](_0x328880[_0x1ba630(0xca)])));});return _0x3d8e12;});Promise[_0x48980c(0xba)](_0x1456eb)[_0x48980c(0x120)](async _0x3c0053=>{var _0x45a243=_0x48980c;try{for(const _0x28768 of _0x3c0053){await _0x28768[_0x45a243(0x119)]();}_0x370b18['finalize']=_0x45a243(0x13e);const _0x513fab=await _0x370b18[_0x45a243(0x119)](),_0x25ac8f=await master_shop[_0x45a243(0x12e)](),_0x4e1520=await email_settings[_0x45a243(0x114)](),_0x52f59b=await supervisor_settings[_0x45a243(0x12e)]();var _0x464cb3=_0x370b18[_0x45a243(0xaf)],_0x56419e='',_0x19fee6;for(_0x19fee6 in _0x464cb3){_0x56419e+=_0x45a243(0x189)+_0x45a243(0x178)+_0x464cb3[_0x19fee6][_0x45a243(0xa7)]+'</td>'+_0x45a243(0x178)+_0x464cb3[_0x19fee6][_0x45a243(0xde)]+_0x45a243(0xa2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x464cb3[_0x19fee6][_0x45a243(0xca)]+_0x45a243(0xa2)+_0x45a243(0x178)+_0x464cb3[_0x19fee6][_0x45a243(0xa0)]+_0x45a243(0xa2)+_0x45a243(0x178)+_0x464cb3[_0x19fee6][_0x45a243(0xee)]+_0x45a243(0xa2)+_0x45a243(0x178)+_0x370b18[_0x45a243(0x194)]+_0x45a243(0xa2)+_0x45a243(0x178)+_0x464cb3[_0x19fee6][_0x45a243(0x16b)]+'</td>'+_0x45a243(0x178)+_0x464cb3[_0x19fee6][_0x45a243(0x174)]+_0x464cb3[_0x19fee6][_0x45a243(0xe0)]+_0x464cb3[_0x19fee6][_0x45a243(0x13c)]+_0x464cb3[_0x19fee6][_0x45a243(0xa5)]+_0x464cb3[_0x19fee6]['type'][0x0]+_0x464cb3[_0x19fee6][_0x45a243(0x19d)]+_0x45a243(0xa2),_0x45a243(0x136);}let _0x34ee76=nodemailer[_0x45a243(0x105)]({'host':_0x4e1520['host'],'port':Number(_0x4e1520[_0x45a243(0x197)]),'secure':![],'auth':{'user':_0x4e1520[_0x45a243(0x12f)],'pass':_0x4e1520[_0x45a243(0x112)]}}),_0xdf35a8={'from':_0x4e1520['email'],'to':_0x52f59b[0x0][_0x45a243(0xd6)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x45a243(0xbf),'path':__dirname+'/../public'+_0x45a243(0x153)+_0x25ac8f[0x0][_0x45a243(0xe4)],'cid':'logo'}],'html':_0x45a243(0xfa)+_0x45a243(0xb1)+'</head><body>'+_0x45a243(0xe5)+_0x45a243(0xc1)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x45a243(0x109)+_0x45a243(0xe5)+_0x45a243(0x16d)+_0x25ac8f[0x0][_0x45a243(0xa4)]+_0x45a243(0x172)+_0x45a243(0x109)+'</div>'+_0x45a243(0xcd)+'<div>'+_0x45a243(0x123)+'\x20Order\x20Number\x20:\x20'+_0x370b18['invoice']+'\x20'+_0x45a243(0x122)+_0x45a243(0x195)+_0x370b18[_0x45a243(0x164)]+'\x20'+'</span>'+_0x45a243(0x1a1)+'</div>'+_0x45a243(0x127)+_0x45a243(0x18e)+'<tr>'+_0x45a243(0x167)+_0x45a243(0x1a7)+_0x45a243(0xd0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x45a243(0xc3)+_0x45a243(0x185)+_0x45a243(0x136)+_0x45a243(0x13a)+_0x45a243(0x144)+'\x20'+_0x56419e+'\x20'+'</tbody>'+_0x45a243(0x18f)+_0x45a243(0xe5)+_0x45a243(0xf8)+_0x45a243(0xa9)+_0x25ac8f[0x0]['site_title']+_0x45a243(0x1a1)+'</div>'+_0x45a243(0x109)+_0x45a243(0x128)};_0x34ee76[_0x45a243(0x198)](_0xdf35a8,function(_0x21c4a0,_0x327f95){var _0x12b20a=_0x45a243;_0x21c4a0?(console[_0x12b20a(0xa6)](_0x21c4a0),console[_0x12b20a(0xa6)](_0x12b20a(0x159))):console[_0x12b20a(0xa6)](_0x12b20a(0x13b));}),_0x526c62['flash']('success',_0x45a243(0x140)),_0x383d0e[_0x45a243(0x160)](_0x45a243(0x131)+_0x57a6c6);}catch(_0x2cfa65){console['error'](_0x2cfa65),_0x383d0e['status'](0x1f4)[_0x45a243(0x1a5)]({'error':_0x45a243(0x15b)});}})['catch'](_0x444028=>{var _0x1b93c7=_0x48980c;console[_0x1b93c7(0xb0)](_0x444028),_0x383d0e['status'](0x1f4)['json']({'error':_0x1b93c7(0xd3)});});}catch(_0x1f6b58){console['log'](_0x1f6b58);}}),router['get'](a0_0x1c136b(0x9e),auth,async(_0x3f9263,_0x3390b9)=>{var _0xeeef8a=a0_0x1c136b;try{const {username:_0xa84a76,email:_0x319256,role:_0xb797}=_0x3f9263[_0xeeef8a(0x1ac)],_0x17429f=_0x3f9263[_0xeeef8a(0x1ac)],_0x1c30f3=await profile['findOne']({'email':_0x17429f[_0xeeef8a(0x12f)]}),_0x3c6b3d=await master_shop['find'](),_0x326c03=_0x3f9263[_0xeeef8a(0x17f)]['id'],_0x59b0fb=await sales[_0xeeef8a(0xbe)](_0x326c03);var _0xd8dbad=[_0xeeef8a(0x9c),_0xeeef8a(0x97)];const _0x4ebd57=await warehouse['aggregate']([{'$match':{'name':_0x59b0fb['warehouse_name'],'warehouse_category':_0xeeef8a(0xd2)}},{'$unwind':'$product_details'},{'$group':{'_id':_0xeeef8a(0x126),'name':{'$first':_0xeeef8a(0x118)},'product_stock':{'$first':_0xeeef8a(0xcf)},'bay':{'$first':_0xeeef8a(0x121)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xeeef8a(0x10f)},'floorlevel':{'$first':_0xeeef8a(0x134)},'primary_code':{'$first':_0xeeef8a(0x133)},'secondary_code':{'$first':_0xeeef8a(0x17a)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xeeef8a(0x138)},'rack':{'$first':_0xeeef8a(0x108)}}}]),_0x4ffaa6=await customer[_0xeeef8a(0x12e)]({});let _0x2c4122;if(_0x17429f[_0xeeef8a(0x10b)]==_0xeeef8a(0xcb)){const _0x13c579=await staff[_0xeeef8a(0x114)]({'email':_0x17429f[_0xeeef8a(0x12f)]});_0x2c4122=await warehouse[_0xeeef8a(0xfc)]([{'$match':{'status':_0xeeef8a(0x17b),'name':_0x13c579[_0xeeef8a(0x1a9)],'warehouse_category':_0xeeef8a(0xd2)}},{'$group':{'_id':_0xeeef8a(0xf2),'name':{'$first':_0xeeef8a(0xf2)}}}]);}else _0x2c4122=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0xeeef8a(0xd2)}},{'$group':{'_id':_0xeeef8a(0xf2),'name':{'$first':_0xeeef8a(0xf2)}}}]);const _0x2a3a62=await product[_0xeeef8a(0x12e)]({});if(_0x3c6b3d[0x0][_0xeeef8a(0xfb)]==_0xeeef8a(0xed)){var _0x261cd7=users[_0xeeef8a(0xdc)];console[_0xeeef8a(0xa6)](_0x261cd7);}else{if(_0x3c6b3d[0x0][_0xeeef8a(0xfb)]==_0xeeef8a(0x179))var _0x261cd7=users['Hindi'];else{if(_0x3c6b3d[0x0]['language']=='German')var _0x261cd7=users[_0xeeef8a(0x188)];else{if(_0x3c6b3d[0x0][_0xeeef8a(0xfb)]==_0xeeef8a(0x155))var _0x261cd7=users[_0xeeef8a(0x155)];else{if(_0x3c6b3d[0x0][_0xeeef8a(0xfb)]==_0xeeef8a(0xd5))var _0x261cd7=users[_0xeeef8a(0xd5)];else{if(_0x3c6b3d[0x0]['language']==_0xeeef8a(0xfd))var _0x261cd7=users[_0xeeef8a(0x11a)];else{if(_0x3c6b3d[0x0][_0xeeef8a(0xfb)]=='Chinese')var _0x261cd7=users['Chinese'];else{if(_0x3c6b3d[0x0]['language']==_0xeeef8a(0x16c))var _0x261cd7=users['Arabic'];}}}}}}}_0x3390b9[_0xeeef8a(0xe7)]('edit_sales',{'success':_0x3f9263[_0xeeef8a(0x1ab)](_0xeeef8a(0x125)),'errors':_0x3f9263[_0xeeef8a(0x1ab)](_0xeeef8a(0xda)),'role':_0x17429f,'profile':_0x1c30f3,'customer':_0x4ffaa6,'warehouse':_0x2c4122,'product':_0x4ebd57,'user':_0x59b0fb,'master_shop':_0x3c6b3d,'unit':_0x2a3a62,'language':_0x261cd7});}catch(_0x46ddb5){console['log'](_0x46ddb5);}}),router['post']('/view/:id',auth,async(_0x484eea,_0x3b376e)=>{var _0x9bff69=a0_0x1c136b;try{const _0x246e6d=_0x484eea[_0x9bff69(0x17f)]['id'],_0xcf9a65=await sales['findOne']({'_id':_0x484eea[_0x9bff69(0x17f)]['id']}),_0x3fdaa6=await warehouse['findOne']({'name':_0xcf9a65[_0x9bff69(0x194)],'room':_0x484eea['body'][_0x9bff69(0x12c)]}),{invoice:_0xe99249,date:_0x33547a,warehouse_name:_0x4fcca0,product_name:_0x27b202,stock:_0x49e18b,quantity:_0x1c3215,note:_0x37c337,room:_0x868cf1,customer:_0xa660e3,SCRN:_0x122492}=_0x484eea[_0x9bff69(0x175)];if(typeof _0x27b202=='string')var _0x140a85=[_0x484eea['body'][_0x9bff69(0xa7)]],_0x57d374=[_0x484eea[_0x9bff69(0x175)]['stock']],_0x21d3b0=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0x156)]],_0x240985=[_0x484eea['body'][_0x9bff69(0x9f)]],_0x18aed2=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0x16e)]],_0x53f954=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0x141)]],_0x596c13=[_0x484eea['body'][_0x9bff69(0x17c)]],_0x502c9b=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0x162)]],_0x493389=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0xee)]],_0x912069=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0x117)]],_0x5f22d0=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0xac)]],_0x35e625=[_0x484eea['body'][_0x9bff69(0x170)]],_0xa8aa01=[_0x484eea[_0x9bff69(0x175)]['production_date']],_0x2fd497=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0xb4)]],_0x21a2fa=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0xf5)]],_0x377e25=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0xc6)]],_0x3befcd=[_0x484eea[_0x9bff69(0x175)]['prod_cat']],_0x231bdf=[_0x484eea['body']['quantity']],_0x2b1ab2=[_0x484eea[_0x9bff69(0x175)][_0x9bff69(0x173)]];else var _0x140a85=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0xa7)]],_0x57d374=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0xdd)]],_0x21d3b0=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0x156)]],_0x240985=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0x9f)]],_0x18aed2=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0x16e)]],_0x53f954=[..._0x484eea['body'][_0x9bff69(0x141)]],_0x596c13=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0x17c)]],_0x502c9b=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0x162)]],_0x493389=[..._0x484eea[_0x9bff69(0x175)]['secondary_unit']],_0x912069=[..._0x484eea['body'][_0x9bff69(0x117)]],_0x5f22d0=[..._0x484eea['body']['expiry_date']],_0x35e625=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0x170)]],_0xa8aa01=[..._0x484eea['body'][_0x9bff69(0x193)]],_0x2fd497=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0xb4)]],_0x21a2fa=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0xf5)]],_0x377e25=[..._0x484eea[_0x9bff69(0x175)]['delivery_code']],_0x3befcd=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0x143)]],_0x231bdf=[..._0x484eea[_0x9bff69(0x175)][_0x9bff69(0xca)]],_0x2b1ab2=[..._0x484eea[_0x9bff69(0x175)]['RoomAssigned']];const _0x20f534=_0x140a85[_0x9bff69(0x165)](_0x50c03a=>{return _0x50c03a={'product_name':_0x50c03a};});_0x57d374[_0x9bff69(0x149)]((_0x51be91,_0x256ded)=>{var _0x1702fd=_0x9bff69;_0x20f534[_0x256ded][_0x1702fd(0xdd)]=Math[_0x1702fd(0x124)](_0x51be91);}),_0x21d3b0['forEach']((_0x5818c7,_0x59a072)=>{var _0x55e0fb=_0x9bff69;_0x20f534[_0x59a072][_0x55e0fb(0xca)]=_0x5818c7;}),_0x240985[_0x9bff69(0x149)]((_0x413607,_0x1b62fd)=>{var _0x50cfdb=_0x9bff69;_0x20f534[_0x1b62fd][_0x50cfdb(0x9f)]=_0x413607;}),_0x18aed2[_0x9bff69(0x149)]((_0x2ade3e,_0x3de763)=>{var _0x4d3920=_0x9bff69;_0x20f534[_0x3de763][_0x4d3920(0x16e)]=_0x2ade3e;}),_0x53f954[_0x9bff69(0x149)]((_0x1b1ae9,_0x5ad05e)=>{var _0x5954bc=_0x9bff69;_0x20f534[_0x5ad05e][_0x5954bc(0xde)]=_0x1b1ae9;}),_0x596c13[_0x9bff69(0x149)]((_0x366238,_0x408161)=>{var _0x73520e=_0x9bff69;_0x2b1ab2[_0x73520e(0x149)]((_0x28a326,_0x5cb51f)=>{var _0x267446=_0x73520e;if(_0x28a326==_0x267446(0x169)&&_0x408161==_0x5cb51f){var _0x22b699=_0x366238[_0x267446(0x154)](0x3);_0x20f534[_0x408161][_0x267446(0x174)]=_0x366238[0x0],_0x20f534[_0x408161]['rack']=_0x366238[0x1],_0x20f534[_0x408161][_0x267446(0x13c)]=0x0,_0x20f534[_0x408161]['bin']=0x0,_0x20f534[_0x408161][_0x267446(0x110)]='Floor',_0x20f534[_0x408161][_0x267446(0x19d)]=_0x22b699;}else{if(_0x28a326=='Shelves'&&_0x408161==_0x5cb51f){var _0x22b699=_0x366238[_0x267446(0x154)](0x3);_0x20f534[_0x408161][_0x267446(0x174)]=_0x366238[0x0],_0x20f534[_0x408161][_0x267446(0xe0)]=_0x366238[0x1],_0x20f534[_0x408161][_0x267446(0x13c)]=0x0,_0x20f534[_0x408161][_0x267446(0xa5)]=0x0,_0x20f534[_0x408161]['type']=_0x267446(0x115),_0x20f534[_0x408161][_0x267446(0x19d)]=_0x366238[0x5];}else{if(_0x408161==_0x5cb51f){var _0x34d706;if(_0x366238[0x4]=='L')_0x34d706=_0x267446(0xef);else _0x366238[0x4]=='F'&&(_0x34d706='Floor');_0x20f534[_0x408161]['storage']=_0x366238[0x0],_0x20f534[_0x408161][_0x267446(0xe0)]=_0x366238[0x1],_0x20f534[_0x408161][_0x267446(0x13c)]=_0x366238[0x2],_0x20f534[_0x408161][_0x267446(0xa5)]=_0x366238[0x3],_0x20f534[_0x408161][_0x267446(0x110)]=_0x34d706,_0x20f534[_0x408161]['floorlevel']=_0x366238[0x5];}}}});}),_0x502c9b[_0x9bff69(0x149)]((_0x4a9af0,_0x47e288)=>{var _0x4791dd=_0x9bff69;_0x20f534[_0x47e288][_0x4791dd(0xa0)]=_0x4a9af0;}),_0x493389[_0x9bff69(0x149)]((_0x3bc5dc,_0x3075a8)=>{_0x20f534[_0x3075a8]['secondary_unit']=_0x3bc5dc;}),_0x912069['forEach']((_0x3634c1,_0x192dd9)=>{var _0x320c3a=_0x9bff69;_0x20f534[_0x192dd9][_0x320c3a(0x117)]=_0x3634c1;}),_0x5f22d0[_0x9bff69(0x149)]((_0x18d835,_0x4b0e8e)=>{var _0x4e8f0d=_0x9bff69;_0x20f534[_0x4b0e8e][_0x4e8f0d(0xac)]=_0x18d835;}),_0x35e625['forEach']((_0x2d0ad6,_0x488269)=>{var _0x46d7c4=_0x9bff69;_0x20f534[_0x488269][_0x46d7c4(0xc2)]=_0x2d0ad6;}),_0xa8aa01[_0x9bff69(0x149)]((_0xb37d2d,_0x5195dd)=>{var _0x2bb024=_0x9bff69;_0x20f534[_0x5195dd][_0x2bb024(0x193)]=_0xb37d2d;}),_0x2fd497[_0x9bff69(0x149)]((_0x1124ce,_0x565d1e)=>{var _0x363e39=_0x9bff69;_0x20f534[_0x565d1e][_0x363e39(0xb4)]=Math[_0x363e39(0x124)](_0x1124ce);}),_0x21a2fa['forEach']((_0x4b32e8,_0x424757)=>{var _0x2c8249=_0x9bff69;_0x20f534[_0x424757][_0x2c8249(0xf5)]=_0x4b32e8;}),_0x377e25['forEach']((_0xa61a11,_0x2f667d)=>{_0x20f534[_0x2f667d]['delivery_code']=_0xa61a11;}),_0x3befcd['forEach']((_0x5ae4b6,_0x1b1425)=>{var _0x162022=_0x9bff69;_0x20f534[_0x1b1425][_0x162022(0x143)]=_0x5ae4b6;}),_0x231bdf['forEach']((_0x15a5e6,_0x5a3bdf)=>{_0x20f534[_0x5a3bdf]['quantity_notConverted']=_0x15a5e6;}),_0x2b1ab2[_0x9bff69(0x149)]((_0x2e67c3,_0x14eaae)=>{var _0x1f85c5=_0x9bff69;_0x20f534[_0x14eaae][_0x1f85c5(0x16b)]=_0x2e67c3;});var _0x3a6b89=0x0;_0x20f534[_0x9bff69(0x149)](_0x30b77f=>{var _0x2b781c=_0x9bff69;console[_0x2b781c(0xa6)](_0x2b781c(0x129),_0x30b77f),(parseInt(_0x30b77f[_0x2b781c(0xdd)])<parseInt(_0x30b77f['quantity'])||parseInt(_0x30b77f[_0x2b781c(0xca)])==0x0)&&_0x3a6b89++;});if(_0x3a6b89!=0x0)return _0x484eea[_0x9bff69(0x1ab)]('errors',_0x9bff69(0xa8)),_0x3b376e['redirect'](_0x9bff69(0xbb));const _0x2fab81=_0x20f534[_0x9bff69(0x171)](_0x271357=>_0x271357[_0x9bff69(0xca)]!=='0'&&_0x271357[_0x9bff69(0xca)]!=='');_0xcf9a65[_0x9bff69(0x142)]=_0xe99249,_0xcf9a65[_0x9bff69(0xb7)]=_0xa660e3,_0xcf9a65[_0x9bff69(0x164)]=_0x33547a,_0xcf9a65[_0x9bff69(0x194)]=_0x4fcca0,_0xcf9a65[_0x9bff69(0xaf)]=_0x2fab81,_0xcf9a65[_0x9bff69(0xe3)]=_0x37c337,_0xcf9a65[_0x9bff69(0x9b)]=_0x122492,_0xcf9a65[_0x9bff69(0xf0)]=_0x9bff69(0xe9),_0xcf9a65[_0x9bff69(0x180)]=_0x9bff69(0xe9);const _0x47144c=await _0xcf9a65[_0x9bff69(0x119)]();_0x484eea[_0x9bff69(0x1ab)]('success','Sales\x20Update\x20successfully'),_0x3b376e[_0x9bff69(0x160)](_0x9bff69(0x191));}catch(_0x1b8297){console[_0x9bff69(0xa6)](_0x1b8297);}}),router[a0_0x1c136b(0xab)](a0_0x1c136b(0xb9),auth,async(_0x455307,_0x3cd232)=>{var _0x45d30e=a0_0x1c136b;try{const _0xc695e8=_0x455307[_0x45d30e(0x17f)]['id'],{invoice:_0x35f045,customer:_0x54c1cf,receivable_amount:_0x29ab70,received_amount:_0xd71922}=_0x455307[_0x45d30e(0x175)],_0x450c2a=await sales[_0x45d30e(0xbe)](_0xc695e8);console[_0x45d30e(0xa6)](_0x450c2a);var _0x17afb4=_0x29ab70-_0xd71922;console[_0x45d30e(0xa6)](_0xd71922),_0x450c2a['received_amount']=parseFloat(_0xd71922)+parseFloat(_0x450c2a[_0x45d30e(0xf9)]),_0x450c2a[_0x45d30e(0x18c)]=_0x17afb4,console[_0x45d30e(0xa6)](_0x450c2a);const _0x480c30=await _0x450c2a[_0x45d30e(0x119)](),_0xb42b75=await c_payment_data[_0x45d30e(0x114)]({'invoice':_0x35f045});_0xb42b75[_0x45d30e(0xd9)]=_0x17afb4,await _0xb42b75[_0x45d30e(0x119)]();let _0x5a5eaf=new Date(),_0x30b416=('0'+_0x5a5eaf['getDate']())[_0x45d30e(0x154)](-0x2),_0x4ac32a=('0'+(_0x5a5eaf[_0x45d30e(0xb5)]()+0x1))['slice'](-0x2),_0x1ae749=_0x5a5eaf['getFullYear'](),_0x5b80fc=_0x1ae749+'-'+_0x4ac32a+'-'+_0x30b416;const _0x2c2d28=new customer_payment({'invoice':_0x35f045,'date':_0x1ae749+'-'+_0x4ac32a+'-'+_0x30b416,'customer':_0x54c1cf,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0xd71922}),_0x47433f=await _0x2c2d28['save']();_0x455307['flash'](_0x45d30e(0x125),_0x45d30e(0x9d)),_0x3cd232[_0x45d30e(0x160)](_0x45d30e(0x191));}catch(_0x532535){console[_0x45d30e(0xa6)](_0x532535);}}),router[a0_0x1c136b(0xbc)](a0_0x1c136b(0x104),auth,async(_0x541f66,_0x461610)=>{var _0x9123d7=a0_0x1c136b;try{const {username:_0x3c41b9,email:_0xf1ee6c,role:_0x42daed}=_0x541f66[_0x9123d7(0x1ac)],_0x558e36=_0x541f66['user'],_0x245889=await profile[_0x9123d7(0x114)]({'email':_0x558e36[_0x9123d7(0x12f)]}),_0x4893ea=await master_shop[_0x9123d7(0x12e)]();console[_0x9123d7(0xa6)](_0x9123d7(0xc4),_0x4893ea);const _0x282450=_0x541f66[_0x9123d7(0x17f)]['id'],_0x1eeacf=await sales[_0x9123d7(0xbe)](_0x282450);console[_0x9123d7(0xa6)](_0x1eeacf);const _0x573195=await customer[_0x9123d7(0x114)]({'name':_0x1eeacf[_0x9123d7(0xb7)]});console[_0x9123d7(0xa6)](_0x573195);if(_0x4893ea[0x0][_0x9123d7(0xfb)]==_0x9123d7(0xed)){var _0x29aa22=users[_0x9123d7(0xdc)];console['log'](_0x29aa22);}else{if(_0x4893ea[0x0][_0x9123d7(0xfb)]==_0x9123d7(0x179))var _0x29aa22=users[_0x9123d7(0x179)];else{if(_0x4893ea[0x0][_0x9123d7(0xfb)]==_0x9123d7(0x188))var _0x29aa22=users[_0x9123d7(0x188)];else{if(_0x4893ea[0x0]['language']==_0x9123d7(0x155))var _0x29aa22=users[_0x9123d7(0x155)];else{if(_0x4893ea[0x0][_0x9123d7(0xfb)]=='French')var _0x29aa22=users[_0x9123d7(0xd5)];else{if(_0x4893ea[0x0][_0x9123d7(0xfb)]==_0x9123d7(0xfd))var _0x29aa22=users[_0x9123d7(0x11a)];else{if(_0x4893ea[0x0][_0x9123d7(0xfb)]==_0x9123d7(0xb3))var _0x29aa22=users[_0x9123d7(0xb3)];else{if(_0x4893ea[0x0]['language']==_0x9123d7(0x16c))var _0x29aa22=users[_0x9123d7(0xea)];}}}}}}}_0x461610[_0x9123d7(0xe7)](_0x9123d7(0xaa),{'success':_0x541f66[_0x9123d7(0x1ab)]('success'),'errors':_0x541f66[_0x9123d7(0x1ab)](_0x9123d7(0xda)),'role':_0x558e36,'profile':_0x245889,'master_shop':_0x4893ea,'customers':_0x573195,'sales':_0x1eeacf,'language':_0x29aa22});}catch(_0x563cef){console[_0x9123d7(0xa6)](_0x563cef);}}),router[a0_0x1c136b(0xbc)](a0_0x1c136b(0x11f),auth,async(_0xd5bd69,_0x5b9ece)=>{var _0x2ec8e0=a0_0x1c136b;try{const {username:_0x2ee017,email:_0x4f0747,role:_0x2bb769}=_0xd5bd69[_0x2ec8e0(0x1ac)],_0x32622a=_0xd5bd69[_0x2ec8e0(0x1ac)],_0x219335=await profile[_0x2ec8e0(0x114)]({'email':_0x32622a['email']}),_0x21949b=await master_shop[_0x2ec8e0(0x12e)]();console['log'](_0x2ec8e0(0xc4),_0x21949b);const _0x44988b=_0xd5bd69[_0x2ec8e0(0x17f)]['id'];console[_0x2ec8e0(0xa6)](_0x44988b);const _0x476568=await sales['findById'](_0x44988b);console[_0x2ec8e0(0xa6)](_0x2ec8e0(0x11d),_0x476568);const _0x5dadb3=await warehouse[_0x2ec8e0(0xfc)]([{'$match':{'name':_0x2ec8e0(0x100),'room':_0x2ec8e0(0xad)}},{'$unwind':_0x2ec8e0(0xec)},{'$group':{'_id':_0x2ec8e0(0x126),'name':{'$first':_0x2ec8e0(0x118)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x2ec8e0(0xd4)},'pallet':{'$first':_0x2ec8e0(0x19e)},'primary_code':{'$first':_0x2ec8e0(0x133)},'secondary_code':{'$first':_0x2ec8e0(0x17a)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x2ec8e0(0xa6)](_0x2ec8e0(0x151),_0x5dadb3);const _0x36a534=await product[_0x2ec8e0(0x12e)]({});warehouse_data=await warehouse[_0x2ec8e0(0xfc)]([{'$match':{'status':'Enabled','name':_0x2ec8e0(0x100),'warehouse_category':_0x2ec8e0(0xd2)}},{'$group':{'_id':'$name','name':{'$first':_0x2ec8e0(0xf2)}}},{'$sort':{'name':0x1}}]);var _0x5f3599=['Return\x20Rooms'];if(_0x21949b[0x0][_0x2ec8e0(0xfb)]==_0x2ec8e0(0xed)){var _0x556787=users[_0x2ec8e0(0xdc)];console[_0x2ec8e0(0xa6)](_0x556787);}else{if(_0x21949b[0x0][_0x2ec8e0(0xfb)]==_0x2ec8e0(0x179))var _0x556787=users[_0x2ec8e0(0x179)];else{if(_0x21949b[0x0][_0x2ec8e0(0xfb)]==_0x2ec8e0(0x188))var _0x556787=users[_0x2ec8e0(0x188)];else{if(_0x21949b[0x0][_0x2ec8e0(0xfb)]==_0x2ec8e0(0x155))var _0x556787=users[_0x2ec8e0(0x155)];else{if(_0x21949b[0x0][_0x2ec8e0(0xfb)]==_0x2ec8e0(0xd5))var _0x556787=users['French'];else{if(_0x21949b[0x0][_0x2ec8e0(0xfb)]==_0x2ec8e0(0xfd))var _0x556787=users[_0x2ec8e0(0x11a)];else{if(_0x21949b[0x0][_0x2ec8e0(0xfb)]==_0x2ec8e0(0xb3))var _0x556787=users[_0x2ec8e0(0xb3)];else{if(_0x21949b[0x0][_0x2ec8e0(0xfb)]==_0x2ec8e0(0x16c))var _0x556787=users[_0x2ec8e0(0xea)];}}}}}}}_0x5b9ece[_0x2ec8e0(0xe7)](_0x2ec8e0(0x176),{'success':_0xd5bd69['flash']('success'),'errors':_0xd5bd69[_0x2ec8e0(0x1ab)](_0x2ec8e0(0xda)),'role':_0x32622a,'profile':_0x219335,'user':_0x476568,'stock':_0x5dadb3,'master_shop':_0x21949b,'unit':_0x36a534,'language':_0x556787,'warehouses':warehouse_data,'rooms':_0x5f3599});}catch(_0x2346e9){console['log'](_0x2346e9),_0x5b9ece[_0x2ec8e0(0x1a2)](0xc8)[_0x2ec8e0(0x1a5)]({'message':_0x2346e9[_0x2ec8e0(0xf3)]});}}),router['post']('/view/return_sales/:id',auth,async(_0x5828a5,_0x2345db)=>{var _0x8c28e=a0_0x1c136b;try{const {invoice:_0x19656f,date:_0x4e8bb5,warehouse_name:_0x1f89e3,product_name:_0x884312,primary_code:_0x19bb59,secondary_code:_0x4faee1,product_code:_0x366bd6,sales_quantity:_0x130dad,stocks:_0x5ddf60,return_qty:_0x4952c7,Room_name:_0x4cecc2,to_warehouse_name:_0x136180,to_Roomname:_0x77047b,to_Room_name:_0xd75c92,note:_0x58c59f,level:_0x23d31b,isle:_0x3e1f96,pallet:_0x60afdd}=_0x5828a5[_0x8c28e(0x175)];if(typeof _0x884312==_0x8c28e(0xbd))var _0x485ecb=[_0x5828a5[_0x8c28e(0x175)][_0x8c28e(0xa7)]],_0x5706a6=[_0x5828a5['body'][_0x8c28e(0x9f)]],_0x30a911=[_0x5828a5[_0x8c28e(0x175)][_0x8c28e(0x16e)]],_0x5205f9=[_0x5828a5['body'][_0x8c28e(0xde)]],_0x5071fb=[_0x5828a5['body'][_0x8c28e(0x11e)]],_0x4b3187=[_0x5828a5['body'][_0x8c28e(0xd7)]],_0x49a1ed=[_0x5828a5[_0x8c28e(0x175)][_0x8c28e(0xae)]],_0x49f658=[_0x5828a5[_0x8c28e(0x175)][_0x8c28e(0x13c)]],_0x52f0f2=[_0x5828a5['body'][_0x8c28e(0xa5)]],_0x4e222e=[_0x5828a5[_0x8c28e(0x175)][_0x8c28e(0x14c)]],_0x4c7403=[_0x5828a5['body'][_0x8c28e(0x19d)]];else var _0x485ecb=[..._0x5828a5[_0x8c28e(0x175)][_0x8c28e(0xa7)]],_0x5706a6=[..._0x5828a5['body'][_0x8c28e(0x9f)]],_0x30a911=[..._0x5828a5[_0x8c28e(0x175)][_0x8c28e(0x16e)]],_0x5205f9=[..._0x5828a5[_0x8c28e(0x175)][_0x8c28e(0xde)]],_0x5071fb=[..._0x5828a5[_0x8c28e(0x175)][_0x8c28e(0x11e)]],_0x4b3187=[..._0x5828a5['body'][_0x8c28e(0xd7)]],_0x49a1ed=[..._0x5828a5['body']['return_qty']],_0x49f658=[..._0x5828a5[_0x8c28e(0x175)][_0x8c28e(0x13c)]],_0x52f0f2=[..._0x5828a5[_0x8c28e(0x175)]['bin']],_0x4e222e=[..._0x5828a5[_0x8c28e(0x175)][_0x8c28e(0x14c)]],_0x4c7403=[..._0x5828a5[_0x8c28e(0x175)]['floorlevel']];const _0x4b3bcf=_0x485ecb[_0x8c28e(0x165)](_0x10881b=>{return _0x10881b={'product_name':_0x10881b};});_0x5706a6[_0x8c28e(0x149)]((_0x3cab5e,_0x1a5add)=>{var _0x5a39dc=_0x8c28e;_0x4b3bcf[_0x1a5add][_0x5a39dc(0x9f)]=_0x3cab5e;}),_0x30a911[_0x8c28e(0x149)]((_0x4d6fc4,_0x574f0d)=>{var _0x4d7bb7=_0x8c28e;_0x4b3bcf[_0x574f0d][_0x4d7bb7(0x16e)]=_0x4d6fc4;}),_0x5205f9[_0x8c28e(0x149)]((_0x3ca4bd,_0x4bb5cb)=>{_0x4b3bcf[_0x4bb5cb]['product_code']=_0x3ca4bd;}),_0x5071fb[_0x8c28e(0x149)]((_0x10a443,_0x6fcd6b)=>{var _0x41e05f=_0x8c28e;_0x4b3bcf[_0x6fcd6b][_0x41e05f(0x102)]=_0x10a443;}),_0x4b3187[_0x8c28e(0x149)]((_0x3c6b0b,_0x4788b4)=>{var _0x572408=_0x8c28e;_0x4b3bcf[_0x4788b4][_0x572408(0xdd)]=_0x3c6b0b;}),_0x49a1ed['forEach']((_0x50f3f4,_0x2f8db6)=>{var _0x237a55=_0x8c28e;_0x4b3bcf[_0x2f8db6][_0x237a55(0xae)]=_0x50f3f4;}),_0x49f658[_0x8c28e(0x149)]((_0x21cb96,_0xd50e30)=>{var _0x41fd07=_0x8c28e;_0x4b3bcf[_0xd50e30][_0x41fd07(0x13c)]=_0x21cb96;}),_0x52f0f2[_0x8c28e(0x149)]((_0x5161d6,_0x26a36b)=>{var _0x3dc525=_0x8c28e;_0x4b3bcf[_0x26a36b][_0x3dc525(0xa5)]=_0x5161d6;}),_0x4e222e[_0x8c28e(0x149)]((_0x14d47c,_0x71ba4c)=>{var _0xf44668=_0x8c28e;_0x4b3bcf[_0x71ba4c][_0xf44668(0x110)]=_0x14d47c;}),_0x4c7403[_0x8c28e(0x149)]((_0x1f12f0,_0x1d008f)=>{var _0x44cd29=_0x8c28e;_0x4b3bcf[_0x1d008f][_0x44cd29(0x19d)]=_0x1f12f0;});var _0x529fdc=0x0;_0x4b3bcf[_0x8c28e(0x149)](_0x12492d=>{var _0x4e0c7d=_0x8c28e;console[_0x4e0c7d(0xa6)](_0x4e0c7d(0x129),_0x12492d),(parseInt(_0x12492d['sale_qty'])<parseInt(_0x12492d[_0x4e0c7d(0xae)])||parseInt(_0x12492d[_0x4e0c7d(0xdd)])<parseInt(_0x12492d[_0x4e0c7d(0xae)])&&parseInt(_0x12492d[_0x4e0c7d(0x102)])>parseInt(_0x12492d[_0x4e0c7d(0xae)])||parseInt(_0x12492d[_0x4e0c7d(0xae)])==0x0)&&_0x529fdc++;});if(_0x529fdc!=0x0)return _0x5828a5[_0x8c28e(0x1ab)](_0x8c28e(0xda),_0x8c28e(0x1a6)),_0x2345db['redirect'](_0x8c28e(0xbb));const _0x2ca9a2=await sales[_0x8c28e(0x114)]({'invoice':_0x19656f});console[_0x8c28e(0xa6)](_0x2ca9a2),_0x2ca9a2[_0x8c28e(0x181)]=_0x8c28e(0x13e);const _0x558180=await _0x2ca9a2[_0x8c28e(0x119)](),_0x16e2bf=new sales_return({'invoice':_0x19656f,'customer':_0x5828a5[_0x8c28e(0x175)][_0x8c28e(0xb7)],'date':_0x4e8bb5,'warehouse_name':_0x1f89e3,'room':_0x4cecc2,'ToWarehouse':_0x136180,'ToRoom':_0xd75c92,'return_sale':_0x4b3bcf,'note':_0x58c59f}),_0x279903=await _0x16e2bf[_0x8c28e(0x119)]();console['log'](_0x16e2bf);const _0x3b9115=await sales_return[_0x8c28e(0x114)]({'invoice':_0x19656f}),_0x5c5dc9=await warehouse['findOne']({'name':_0x136180,'room':_0xd75c92});_0x3b9115['return_sale'][_0x8c28e(0x149)](_0x234600=>{var _0x212601=_0x8c28e,_0x26f6ce=0x0;const _0x856948=_0x5c5dc9[_0x212601(0x15a)][_0x212601(0x165)](_0x5db86c=>{var _0x278564=_0x212601;_0x5db86c[_0x278564(0xa7)]==_0x234600[_0x278564(0xa7)]&&_0x5db86c[_0x278564(0x19d)]==_0x234600['floorlevel']&&_0x5db86c[_0x278564(0x110)]==_0x234600[_0x278564(0x110)]&&_0x5db86c[_0x278564(0xa5)]==_0x234600['bin']&&_0x5db86c[_0x278564(0x13c)]==_0x234600['bay']&&(_0x5db86c[_0x278564(0x1a4)]=parseInt(_0x5db86c[_0x278564(0x1a4)])+parseInt(_0x234600['return_qty']),_0x26f6ce++);});_0x26f6ce=='0'&&(_0x5c5dc9[_0x212601(0x15a)]=_0x5c5dc9['product_details'][_0x212601(0x1a0)]({'product_name':_0x234600[_0x212601(0xa7)],'product_stock':_0x234600['return_qty'],'primary_code':_0x234600[_0x212601(0x9f)],'secondary_code':_0x234600[_0x212601(0x16e)],'product_code':_0x234600[_0x212601(0xde)],'bay':_0x234600[_0x212601(0x13c)],'bin':_0x234600[_0x212601(0xa5)],'type':_0x234600[_0x212601(0x110)],'floorlevel':_0x234600['floorlevel']})),console[_0x212601(0xa6)]('final',_0x5c5dc9);}),await _0x5c5dc9[_0x8c28e(0x119)](),console['log'](_0x5828a5[_0x8c28e(0x175)]);const _0x2deec6=new c_payment_data({'invoice':_0x19656f,'customer':_0x5828a5[_0x8c28e(0x175)][_0x8c28e(0xb7)],'reason':_0x8c28e(0x10e)});await _0x2deec6[_0x8c28e(0x119)]();const _0x471080=await master_shop[_0x8c28e(0x12e)]();console[_0x8c28e(0xa6)](_0x8c28e(0xc9),_0x471080[0x0][_0x8c28e(0xe4)]);const _0x24d3f1=await email_settings['findOne'](),_0x5b70c0=await customer[_0x8c28e(0x114)]({'name':_0x5828a5[_0x8c28e(0x175)]['customer']});console[_0x8c28e(0xa6)](_0x8c28e(0x9a),_0x5b70c0);_0x471080[0x0][_0x8c28e(0x196)]==0x1?(right_currency=_0x471080[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x471080[0x0][_0x8c28e(0x14d)]);var _0x3a2cf8=_0x485ecb,_0x28baa6=_0x49a1ed,_0x5aac78='',_0x34b3ce;for(_0x34b3ce in _0x3a2cf8){_0x5aac78+=_0x8c28e(0x189)+_0x8c28e(0x178)+_0x3a2cf8[_0x34b3ce]+_0x8c28e(0xa2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x28baa6[_0x34b3ce]+'</td>'+_0x8c28e(0x136);}console[_0x8c28e(0xa6)](_0x8c28e(0x116),_0x5aac78);let _0x41a676=nodemailer['createTransport']({'service':_0x8c28e(0x147),'auth':{'user':_0x24d3f1[_0x8c28e(0x12f)],'pass':_0x24d3f1[_0x8c28e(0x112)]}}),_0x41f9db={'from':_0x24d3f1[_0x8c28e(0x12f)],'to':_0x5b70c0['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x8c28e(0xbf),'path':__dirname+_0x8c28e(0x19a)+_0x8c28e(0x153)+_0x471080[0x0][_0x8c28e(0xe4)],'cid':_0x8c28e(0x10c)}],'html':_0x8c28e(0xfa)+_0x8c28e(0xb1)+_0x8c28e(0xb6)+'<div>'+_0x8c28e(0xc1)+'<div>'+_0x8c28e(0x98)+_0x8c28e(0x109)+_0x8c28e(0xe5)+_0x8c28e(0x16d)+_0x471080[0x0][_0x8c28e(0xa4)]+_0x8c28e(0x172)+_0x8c28e(0x109)+_0x8c28e(0x109)+_0x8c28e(0xcd)+_0x8c28e(0xe5)+_0x8c28e(0x123)+'\x20Order\x20Number\x20:\x20'+_0x19656f+'\x20'+_0x8c28e(0x122)+'\x20Order\x20Date\x20:\x20'+_0x4e8bb5+'\x20'+'</span>'+_0x8c28e(0x1a1)+'</div>'+_0x8c28e(0x127)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x8c28e(0x167)+_0x8c28e(0xeb)+_0x8c28e(0xf6)+_0x8c28e(0xa1)+_0x8c28e(0x136)+_0x8c28e(0x13a)+_0x8c28e(0x144)+'\x20'+_0x5aac78+'\x20'+'</tbody>'+_0x8c28e(0x18f)+_0x8c28e(0xe5)+_0x8c28e(0xf8)+_0x8c28e(0xa9)+_0x471080[0x0][_0x8c28e(0xa4)]+_0x8c28e(0x1a1)+_0x8c28e(0x109)+_0x8c28e(0x109)+_0x8c28e(0x128)};_0x41a676['sendMail'](_0x41f9db,function(_0x2cd67f,_0x285846){var _0x2db5e5=_0x8c28e;_0x2cd67f?(console['log'](_0x2cd67f),console[_0x2db5e5(0xa6)](_0x2db5e5(0x159))):console[_0x2db5e5(0xa6)](_0x2db5e5(0x13b));}),_0x5828a5[_0x8c28e(0x1ab)]('success','sales\x20item\x20return\x20successfull'),_0x2345db[_0x8c28e(0x160)](_0x8c28e(0x191));}catch(_0x27d862){console[_0x8c28e(0xa6)](_0x27d862),_0x2345db[_0x8c28e(0x1a2)](0xc8)[_0x8c28e(0x1a5)]({'message1':_0x27d862[_0x8c28e(0xf3)]});}}),router[a0_0x1c136b(0xbc)](a0_0x1c136b(0x96),auth,async(_0x4823f8,_0x37ddf2)=>{var _0x206f62=a0_0x1c136b;try{const {username:_0x5a3b65,email:_0x22186b,role:_0x2199db}=_0x4823f8['user'],_0x145eab=_0x4823f8[_0x206f62(0x1ac)],_0x4f0056=await profile[_0x206f62(0x114)]({'email':_0x145eab['email']}),_0x2c8c4a=await master_shop['find']();console['log'](_0x206f62(0x11c),_0x2c8c4a);const _0x629355=_0x4823f8[_0x206f62(0x17f)]['id'],_0x354191=await sales['findById'](_0x629355);console[_0x206f62(0xa6)](_0x206f62(0x111),_0x354191);if(_0x2c8c4a[0x0][_0x206f62(0xfb)]==_0x206f62(0xed))var _0x27367d=users[_0x206f62(0xdc)];else{if(_0x2c8c4a[0x0][_0x206f62(0xfb)]=='Hindi')var _0x27367d=users[_0x206f62(0x179)];else{if(_0x2c8c4a[0x0][_0x206f62(0xfb)]==_0x206f62(0x188))var _0x27367d=users['German'];else{if(_0x2c8c4a[0x0][_0x206f62(0xfb)]==_0x206f62(0x155))var _0x27367d=users[_0x206f62(0x155)];else{if(_0x2c8c4a[0x0][_0x206f62(0xfb)]==_0x206f62(0xd5))var _0x27367d=users[_0x206f62(0xd5)];else{if(_0x2c8c4a[0x0][_0x206f62(0xfb)]=='Portuguese\x20(BR)')var _0x27367d=users[_0x206f62(0x11a)];else{if(_0x2c8c4a[0x0][_0x206f62(0xfb)]==_0x206f62(0xb3))var _0x27367d=users[_0x206f62(0xb3)];else{if(_0x2c8c4a[0x0]['language']==_0x206f62(0x16c))var _0x27367d=users['Arabic'];}}}}}}}_0x37ddf2[_0x206f62(0xe7)](_0x206f62(0x161),{'success':_0x4823f8['flash'](_0x206f62(0x125)),'errors':_0x4823f8[_0x206f62(0x1ab)](_0x206f62(0xda)),'role':_0x145eab,'profile':_0x4f0056,'alldata':_0x354191,'master_shop':_0x2c8c4a,'language':_0x27367d});}catch(_0x14c49e){console[_0x206f62(0xa6)](_0x14c49e);}}),router[a0_0x1c136b(0xab)]('/barcode_scanner',async(_0x14832b,_0x23b7fb)=>{var _0x1747c0=a0_0x1c136b;const {product_code:_0x8b7537,warehouse_name:_0x33b226,rooms_data:_0x36a609,Roomslist:_0x1ccbcb}=_0x14832b[_0x1747c0(0x175)],_0x325a90=_0x1ccbcb[_0x1747c0(0x18a)](','),_0x7b59bc=[];async function _0xf11613(_0x3ce060){var _0xab3877=_0x1747c0;const _0x6fc202=await warehouse[_0xab3877(0xfc)]([{'$match':{'name':_0x33b226,'room':_0x3ce060}},{'$unwind':_0xab3877(0xec)},{'$match':{'product_details.primary_code':_0x8b7537}},{'$group':{'_id':_0xab3877(0x126),'name':{'$first':_0xab3877(0x118)},'product_stock':{'$first':_0xab3877(0xcf)},'primary_code':{'$first':_0xab3877(0x133)},'secondary_code':{'$first':_0xab3877(0x17a)},'product_code':{'$first':_0xab3877(0x158)},'level':{'$first':_0xab3877(0x121)},'isle':{'$first':_0xab3877(0xc0)},'type':{'$first':_0xab3877(0x10f)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0xab3877(0x18b)},'secondary_unit':{'$first':_0xab3877(0x1aa)},'storage':{'$first':_0xab3877(0x138)},'rack':{'$first':_0xab3877(0x108)},'expiry_date':{'$first':_0xab3877(0x15f)},'production_date':{'$first':_0xab3877(0xe8)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0xab3877(0xdf)},'product_cat':{'$first':_0xab3877(0xb8)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0xab3877(0xdb)},'invoice':{'$first':_0xab3877(0x130)},'actual_qty':{'$first':_0xab3877(0x148)},'actual_uom':{'$first':_0xab3877(0x168)},'delivery_date':{'$first':_0xab3877(0x186)},'delivery_code':{'$first':_0xab3877(0x182)}}}]),_0x2b72d8=await warehouse[_0xab3877(0xfc)]([{'$match':{'name':_0x33b226,'room':_0x3ce060}},{'$unwind':_0xab3877(0xec)},{'$match':{'product_details.secondary_code':_0x8b7537}},{'$group':{'_id':_0xab3877(0x126),'name':{'$first':_0xab3877(0x118)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0xab3877(0x133)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xab3877(0x158)},'level':{'$first':_0xab3877(0x121)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xab3877(0x134)},'unit':{'$first':_0xab3877(0x18b)},'secondary_unit':{'$first':_0xab3877(0x1aa)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xab3877(0x108)},'expiry_date':{'$first':_0xab3877(0x15f)},'production_date':{'$first':_0xab3877(0xe8)},'maxPerUnit':{'$first':_0xab3877(0x99)},'batch_code':{'$first':_0xab3877(0xdf)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0xab3877(0xdb)},'invoice':{'$first':_0xab3877(0x130)},'delivery_date':{'$first':'$product_details.delivery_date'},'delivery_code':{'$first':'$product_details.delivery_code'}}}]);if(_0x6fc202[_0xab3877(0x10d)]>0x0)_0x7b59bc['push'](_0x6fc202);else _0x2b72d8[_0xab3877(0x10d)]>0x0&&_0x7b59bc[_0xab3877(0x199)](_0x2b72d8);}const _0x3bb92c=_0x325a90[_0x1747c0(0x165)](_0x1e6059=>_0xf11613(_0x1e6059));await Promise['all'](_0x3bb92c),_0x23b7fb[_0x1747c0(0x1a5)](_0x7b59bc);}),module[a0_0x1c136b(0xc5)]=router;