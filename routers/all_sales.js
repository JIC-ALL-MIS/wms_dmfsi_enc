var a0_0x20bdbb=a0_0x20cb;function a0_0x8309(){var _0x4af211=['3439420UfIhAZ','concat','floorlevel','role','$product_details','$product_details.level','$product_details.batch_code','invoice','abs','types','product','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','host','all_sales_barcode','/view/add_sales/:id','user','status','body','$customers_docs','6FcVjiA','foreach\x20newproduct','params','storage','/view/add_sale/product','$isAllowEdit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','prod_invoice','<div>','Chinese','batch_code','Arabic\x20(ae)','$product_details.invoice','flash','2014271jvodmo','Receiving\x20Area','RoomAssigned','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','amount','sales\x20item\x20return\x20successfull','$date','site_title','stock_data','max','$room','$warehouse_name','sales_invoice','product_list','exports','<!DOCTYPE\x20html>','$note','prod_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','requested_qty','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Ambient','email','4384pakjgM','OUT-','_id','forEach','secondary_unit','$product_details.actual_qty','$product_details.unit','id_transaction_from','add_sales','map','stock','warehouse','39580vhBLpq','warehouse_name','password','3BBWxWq','$product.product_name','</head><body>','Return\x20Rooms','/preview/:id','received_amount','id_transact','room','$sale_product.type','<html><head><title></title>','</table>','actual_uom','/../public','$customer','9440365dGbNnC','name','quantity','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','getMonth','toString','$name','Enclosed','Portuguese','nodemailer','Level','staff','An\x20error\x20occurred.','<strong>\x20Regards\x20</strong>','createTransport','secondary_code','/barcode_scanner','</thead>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','padStart','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','json','finalize','$product_details.delivery_date','1179KizGZC','$invoice','/upload/','$product_details.product_stock','redirect','Spanish','filter','gmail','Received\x20Payment\x20For\x20Sale','\x20Order\x20Date\x20:\x20','\x20Order\x20Number\x20:\x20','$sale_product','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<h5\x20style=\x22text-align:\x20left;\x22>','<h2>\x20','$product_details.product_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','aggregate','then','$product_details.delivery_code','/invoice/:id','bay','logo','Error\x20Occurs','product_details','$product_details.product_name','\x20</h2>','680LhHjlh','return_sale','$product_details.isle','$finalize','sendMail','edit_sales','split','$product','actual_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','level','Sales\x20Add\x20successfully','add\x20post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Portuguese\x20(BR)','sale_product','Router','delivery_date','$product_details.actual_uom','get','final','$product_details.production_date','purchases_data','getFullYear','slice','German','False','/view/:id','errors','English','post','return_qty','</body></html>','product_data','room_name','find','/all_sales/view','render','all','save','/view/return_sales/:id','random','$product_details.floorlevel','length','barcode\x20Product\x20master','Arabic','type','primary_code','push','</div>','Return\x20Goods','master','/all_sales/preview/','sales_quantity','user_id','customer','$product_details.storage','rack','$product_details.maxPerUnit','$product_details.pallet','edit_sales_view','$product_details.product_cat','RMSEmail','port','$return_data','$product_details.bin','catch','prod_code','SCRN','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','/barcode/:id','product_stock','unit','/give_payment/:id','True','<hr\x20class=\x22my-3\x22>','$product_details.secondary_unit','max_per_unit','floor','expiry_date','carton','all_sales','300602hniDgc','language','<h5>','primary_unit','findOne','maxperunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$sale_product.quantity','log','</tbody>','success','customer_data','<tr>','$product_details.type','product_name','Floor','date','/view','sale_qty','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','English\x20(US)','$product_details.expiry_date','bin','48hoPuDc','$sale_product.bay','<span\x20style=\x22float:\x20right;\x22>','$product_details.primary_code','Hindi','Sale\x20Return','getDate','product_code','$product_details._id','payment\x20successfull','customers','stocks','French','image','$sale_product.bin','production_date','findById','</span>','2454794PQtCAf','../models/all_models','Enabled','back','Email\x20sent\x20successfully','</h5>','$product_details.bay','Raw\x20Materials','<tbody\x20style=\x22text-align:\x20center;\x22>','Shelves','error','delivery_code','$sale_product.floorlevel','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','message','$product_details.rack','</td>','../public/language/languages.json','</tr>','$_id'];a0_0x8309=function(){return _0x4af211;};return a0_0x8309();}(function(_0x1e5bfc,_0x3cc21a){var _0x579bb0=a0_0x20cb,_0x1f1426=_0x1e5bfc();while(!![]){try{var _0xac8847=-parseInt(_0x579bb0(0xce))/0x1+parseInt(_0x579bb0(0xfa))/0x2*(-parseInt(_0x579bb0(0x155))/0x3)+-parseInt(_0x579bb0(0x152))/0x4*(parseInt(_0x579bb0(0x7c))/0x5)+-parseInt(_0x579bb0(0x121))/0x6*(parseInt(_0x579bb0(0x12f))/0x7)+-parseInt(_0x579bb0(0x146))/0x8*(-parseInt(_0x579bb0(0x17b))/0x9)+parseInt(_0x579bb0(0x10e))/0xa+-parseInt(_0x579bb0(0x163))/0xb*(-parseInt(_0x579bb0(0xe8))/0xc);if(_0xac8847===_0x3cc21a)break;else _0x1f1426['push'](_0x1f1426['shift']());}catch(_0x169adb){_0x1f1426['push'](_0x1f1426['shift']());}}}(a0_0x8309,0xa7c0e));function a0_0x20cb(_0x50c24e,_0x38876c){var _0x830920=a0_0x8309();return a0_0x20cb=function(_0x20cba3,_0x2ced3c){_0x20cba3=_0x20cba3-0x6c;var _0x358d1a=_0x830920[_0x20cba3];return _0x358d1a;},a0_0x20cb(_0x50c24e,_0x38876c);}const express=require('express'),app=express(),router=express[a0_0x20bdbb(0x8c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x20bdbb(0xfb)),auth=require('../middleware/auth'),nodemailer=require(a0_0x20bdbb(0x16c)),users=require(a0_0x20bdbb(0x10b));router[a0_0x20bdbb(0x8f)](a0_0x20bdbb(0xdf),auth,async(_0x39e3c2,_0xc6ce57)=>{var _0x254d9a=a0_0x20bdbb;try{const {username:_0x3cf4a2,email:_0x17edac,role:_0x52112e}=_0x39e3c2['user'],_0x14f31b=_0x39e3c2['user'],_0x1b9522=await profile[_0x254d9a(0xd2)]({'email':_0x14f31b['email']}),_0x5cb302=await master_shop[_0x254d9a(0x9f)]();let _0x57de32;if(_0x14f31b['role']=='staff'){const _0x1bf2b0=await staff['findOne']({'email':_0x14f31b[_0x254d9a(0x145)]});_0x57de32=await sales[_0x254d9a(0x72)]([{'$lookup':{'from':'customers','localField':_0x254d9a(0xb3),'foreignField':_0x254d9a(0x164),'as':'customers_docs'}},{'$unwind':_0x254d9a(0x120)},{'$unwind':_0x254d9a(0x186)},{'$group':{'_id':_0x254d9a(0x10d),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x254d9a(0x135)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x254d9a(0xbc)},'customers_docs':{'$first':_0x254d9a(0x120)},'total_saleproduct_quantity':{'$sum':_0x254d9a(0xd5)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x254d9a(0x106)},'finalize':{'$first':_0x254d9a(0x7f)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x57de32=await sales[_0x254d9a(0x72)]([{'$lookup':{'from':_0x254d9a(0xf2),'localField':'customer','foreignField':_0x254d9a(0x164),'as':'customers_docs'}},{'$unwind':_0x254d9a(0x120)},{'$unwind':_0x254d9a(0x186)},{'$group':{'_id':_0x254d9a(0x10d),'invoice':{'$first':_0x254d9a(0x17c)},'customers':{'$first':_0x254d9a(0x162)},'date':{'$first':_0x254d9a(0x135)},'warehouse_name':{'$first':_0x254d9a(0x13a)},'sale_product':{'$push':_0x254d9a(0x186)},'note':{'$first':_0x254d9a(0x13f)},'return_data':{'$first':_0x254d9a(0xbc)},'customers_docs':{'$first':_0x254d9a(0x120)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x254d9a(0xe9)},'isle':{'$addToSet':_0x254d9a(0xf6)},'type':{'$addToSet':_0x254d9a(0x15d)},'pallet':{'$addToSet':_0x254d9a(0x106)},'finalize':{'$first':_0x254d9a(0x7f)},'isAllowEdit':{'$first':_0x254d9a(0x126)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x254d9a(0xd6)]('sales\x20all_data',_0x57de32);if(_0x5cb302[0x0][_0x254d9a(0xcf)]==_0x254d9a(0xe5)){var _0x3ee038=users[_0x254d9a(0x99)];console[_0x254d9a(0xd6)](_0x3ee038);}else{if(_0x5cb302[0x0][_0x254d9a(0xcf)]==_0x254d9a(0xec))var _0x3ee038=users['Hindi'];else{if(_0x5cb302[0x0][_0x254d9a(0xcf)]=='German')var _0x3ee038=users[_0x254d9a(0x95)];else{if(_0x5cb302[0x0][_0x254d9a(0xcf)]==_0x254d9a(0x180))var _0x3ee038=users[_0x254d9a(0x180)];else{if(_0x5cb302[0x0][_0x254d9a(0xcf)]==_0x254d9a(0xf4))var _0x3ee038=users[_0x254d9a(0xf4)];else{if(_0x5cb302[0x0][_0x254d9a(0xcf)]=='Portuguese\x20(BR)')var _0x3ee038=users[_0x254d9a(0x16b)];else{if(_0x5cb302[0x0][_0x254d9a(0xcf)]==_0x254d9a(0x12a))var _0x3ee038=users[_0x254d9a(0x12a)];else{if(_0x5cb302[0x0][_0x254d9a(0xcf)]==_0x254d9a(0x12c))var _0x3ee038=users['Arabic'];}}}}}}}_0xc6ce57['render'](_0x254d9a(0xcd),{'success':_0x39e3c2['flash'](_0x254d9a(0xd8)),'errors':_0x39e3c2[_0x254d9a(0x12e)](_0x254d9a(0x98)),'sales':_0x57de32,'profile':_0x1b9522,'role':_0x14f31b,'master_shop':_0x5cb302,'language':_0x3ee038});}catch(_0x4438bf){console[_0x254d9a(0xd6)](_0x4438bf);}});async function getRandom8DigitNumber(){var _0x51def3=a0_0x20bdbb;const _0x434c10=0x989680,_0x2f922f=0x5f5e0ff,_0x38b9d8=Math[_0x51def3(0xca)](Math[_0x51def3(0xa5)]()*(_0x2f922f-_0x434c10+0x1))+_0x434c10;var _0xfba5f4;const _0x28af1c=await sales['findOne']({'invoice':_0x51def3(0x147)+_0x38b9d8});return _0x28af1c&&_0x28af1c[_0x51def3(0xa7)]>0x0?_0xfba5f4='OUT-'+_0x38b9d8:_0xfba5f4=_0x51def3(0x147)+_0x38b9d8,_0xfba5f4;}router[a0_0x20bdbb(0x8f)]('/view/add_sales',auth,async(_0x2ff8b2,_0x4368f3)=>{var _0xb174c=a0_0x20bdbb;try{const {username:_0x48b22d,email:_0x57d118,role:_0x7a51c}=_0x2ff8b2[_0xb174c(0x11d)],_0x35e1b2=_0x2ff8b2[_0xb174c(0x11d)],_0xf7a093=await profile[_0xb174c(0xd2)]({'email':_0x35e1b2['email']}),_0x4fef3a=await master_shop[_0xb174c(0x9f)](),_0x4193bb=await customer[_0xb174c(0x9f)]({});let _0x316c2a;if(_0x35e1b2[_0xb174c(0x111)]=='staff'){const _0x21a9b4=await staff[_0xb174c(0xd2)]({'email':_0x35e1b2[_0xb174c(0x145)]});_0x316c2a=await warehouse[_0xb174c(0x72)]([{'$match':{'status':_0xb174c(0xfc),'name':_0x21a9b4[_0xb174c(0x151)],'warehouse_category':_0xb174c(0x101),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0xb174c(0x169),'name':{'$first':_0xb174c(0x169)}}},{'$sort':{'name':0x1}}]);}else _0x316c2a=await warehouse[_0xb174c(0x72)]([{'$match':{'status':_0xb174c(0xfc),'warehouse_category':_0xb174c(0x101),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0xb174c(0x169),'name':{'$first':_0xb174c(0x169)}}},{'$sort':{'name':0x1}}]);const _0x2807c9=await product[_0xb174c(0x9f)]({});var _0x15e40b=[_0xb174c(0x144),'Enclosed'];const _0x550977=await sales['find']({}),_0x38b1a7=_0x550977[_0xb174c(0xa7)]+0x1,_0x302cf5=_0xb174c(0x147)+_0x38b1a7[_0xb174c(0x168)]()[_0xb174c(0x176)](0x5,'0');if(_0x4fef3a[0x0][_0xb174c(0xcf)]==_0xb174c(0xe5)){var _0x4a74f9=users[_0xb174c(0x99)];console[_0xb174c(0xd6)](_0x4a74f9);}else{if(_0x4fef3a[0x0][_0xb174c(0xcf)]==_0xb174c(0xec))var _0x4a74f9=users['Hindi'];else{if(_0x4fef3a[0x0][_0xb174c(0xcf)]=='German')var _0x4a74f9=users[_0xb174c(0x95)];else{if(_0x4fef3a[0x0]['language']==_0xb174c(0x180))var _0x4a74f9=users[_0xb174c(0x180)];else{if(_0x4fef3a[0x0][_0xb174c(0xcf)]==_0xb174c(0xf4))var _0x4a74f9=users['French'];else{if(_0x4fef3a[0x0][_0xb174c(0xcf)]==_0xb174c(0x8a))var _0x4a74f9=users[_0xb174c(0x16b)];else{if(_0x4fef3a[0x0][_0xb174c(0xcf)]=='Chinese')var _0x4a74f9=users[_0xb174c(0x12a)];else{if(_0x4fef3a[0x0][_0xb174c(0xcf)]=='Arabic\x20(ae)')var _0x4a74f9=users[_0xb174c(0xa9)];}}}}}}}const _0x251fb8=getRandom8DigitNumber();_0x251fb8[_0xb174c(0x73)](_0x5ef3aa=>{var _0x93afcb=_0xb174c;_0x4368f3[_0x93afcb(0xa1)](_0x93afcb(0x14e),{'success':_0x2ff8b2[_0x93afcb(0x12e)]('success'),'errors':_0x2ff8b2['flash'](_0x93afcb(0x98)),'role':_0x35e1b2,'profile':_0xf7a093,'customer':_0x4193bb,'warehouse':_0x316c2a,'product':_0x2807c9,'invoice':_0x5ef3aa,'master_shop':_0x4fef3a,'language':_0x4a74f9,'rooms_data':_0x15e40b});})[_0xb174c(0xbe)](_0x1c1cb3=>{var _0x55f432=_0xb174c;_0x2ff8b2[_0x55f432(0x12e)](_0x55f432(0x98),_0x55f432(0x175)),_0x4368f3['redirect'](_0x55f432(0xa0));});}catch(_0xe80255){console[_0xb174c(0xd6)](_0xe80255);}}),router[a0_0x20bdbb(0x8f)](a0_0x20bdbb(0x11c),auth,async(_0x269d25,_0x189026)=>{var _0xb42055=a0_0x20bdbb;try{const _0x36677=_0x269d25[_0xb42055(0x123)]['id'];console[_0xb42055(0xd6)](_0x36677);const _0x471aae=await product[_0xb42055(0x9f)](),_0x2eff47=await purchases[_0xb42055(0x72)]([{'$match':{'warehouse_name':_0x36677}},{'$unwind':_0xb42055(0x83)},{'$group':{'_id':_0xb42055(0x156)}}]);console[_0xb42055(0xd6)](_0xb42055(0x92),_0x2eff47),_0x189026[_0xb42055(0x11e)](0xc8)[_0xb42055(0x178)]({'purchases_data':_0x2eff47,'product_data':_0x471aae});}catch(_0x125527){console['log'](_0x125527);}}),router['post'](a0_0x20bdbb(0x125),auth,async(_0x2efddf,_0x680224)=>{var _0x2f8830=a0_0x20bdbb;try{const {warehouse_data:_0x4b03cf,product_data:_0x5d99fb}=_0x2efddf[_0x2f8830(0x11f)];console['log'](_0x2efddf['body'][_0x2f8830(0x9d)]);;const _0x41ecce=await master_shop[_0x2f8830(0x9f)]();console['log'](_0x2f8830(0xaf),_0x41ecce);const _0x547f7a=await product[_0x2f8830(0xd2)]({'name':_0x5d99fb});console[_0x2f8830(0xd6)](_0x2f8830(0x118),_0x547f7a);const _0x311ef0=await warehouse[_0x2f8830(0x72)]([{'$match':{'name':_0x4b03cf}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x5d99fb}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x2f8830(0x17e)}}}]);console[_0x2f8830(0xd6)](_0x2f8830(0x137),_0x311ef0),_0x680224['status'](0xc8)['json']({'master':_0x41ecce,'new_product':_0x547f7a,'stock_data':_0x311ef0});}catch(_0x53e035){console[_0x2f8830(0xd6)](_0x53e035);}}),router[a0_0x20bdbb(0x9a)]('/view/add_sales',auth,async(_0x363b4b,_0x1007dc)=>{var _0x46cd84=a0_0x20bdbb;try{const {invoice:_0x33a110,date:_0x21aa5c,warehouse_name:_0x2bf8f2,product_name:_0x36281e,stock:_0x5376c3,quantity:_0x5f1ef2,note:_0x3f166c,room:_0x66eb7b,primary_code:_0x1eccab,secondary_code:_0x404af9,prod_code:_0x4c08f6,level:_0x1b172f,isle:_0x2fda40,pallet:_0x266c0b,batch_code:_0x3760e5,SCRN:_0x3eaa4d,expiry_date:_0x14dcd8}=_0x363b4b[_0x46cd84(0x11f)];if(typeof _0x36281e=='string')var _0x659eb=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0xdc)]],_0x473c41=[_0x363b4b[_0x46cd84(0x11f)]['stock']],_0x24f535=[_0x363b4b['body'][_0x46cd84(0xcc)]],_0x17eec7=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0xab)]],_0x2ff5ac=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x172)]],_0x4bcf21=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0xbf)]],_0x432b21=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x86)]],_0x253d66=[_0x363b4b[_0x46cd84(0x11f)]['primary_unit']],_0x4d145c=[_0x363b4b[_0x46cd84(0x11f)]['secondary_unit']],_0x864459=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x12b)]],_0x2d043d=[_0x363b4b[_0x46cd84(0x11f)]['expiry_date']],_0x47785d=[_0x363b4b[_0x46cd84(0x11f)]['max_per_unit']],_0x56ec78=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0xf7)]],_0x48c301=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x142)]],_0x265115=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x8d)]],_0x3000cc=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x105)]],_0x376e49=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x140)]],_0x8aeac0=[_0x363b4b['body'][_0x46cd84(0x165)]],_0x3cc91c=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x131)]],_0x586064=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x128)]],_0x187c90=[_0x363b4b[_0x46cd84(0x11f)]['actual_qty']],_0x120364=[_0x363b4b['body'][_0x46cd84(0x160)]],_0x5e27c1=[_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x15b)]];else var _0x659eb=[..._0x363b4b['body'][_0x46cd84(0xdc)]],_0x473c41=[..._0x363b4b['body'][_0x46cd84(0x150)]],_0x24f535=[..._0x363b4b['body']['carton']],_0x17eec7=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0xab)]],_0x2ff5ac=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x172)]],_0x4bcf21=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0xbf)]],_0x432b21=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x86)]],_0x253d66=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0xd1)]],_0x4d145c=[..._0x363b4b[_0x46cd84(0x11f)]['secondary_unit']],_0x864459=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x12b)]],_0x2d043d=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0xcb)]],_0x47785d=[..._0x363b4b['body'][_0x46cd84(0xc9)]],_0x56ec78=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0xf7)]],_0x48c301=[..._0x363b4b['body'][_0x46cd84(0x142)]],_0x265115=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x8d)]],_0x3000cc=[..._0x363b4b['body'][_0x46cd84(0x105)]],_0x376e49=[..._0x363b4b[_0x46cd84(0x11f)]['prod_cat']],_0x8aeac0=[..._0x363b4b[_0x46cd84(0x11f)]['quantity']],_0x3cc91c=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x131)]],_0x586064=[..._0x363b4b[_0x46cd84(0x11f)]['prod_invoice']],_0x187c90=[..._0x363b4b['body'][_0x46cd84(0x84)]],_0x120364=[..._0x363b4b['body'][_0x46cd84(0x160)]],_0x5e27c1=[..._0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0x15b)]];const _0x4ffff8=_0x659eb[_0x46cd84(0x14f)](_0x47e90a=>{return _0x47e90a={'product_name':_0x47e90a};});_0x473c41[_0x46cd84(0x149)]((_0x459433,_0x366bc6)=>{var _0x43a05c=_0x46cd84;_0x4ffff8[_0x366bc6][_0x43a05c(0x150)]=Math['abs'](_0x459433);}),_0x187c90[_0x46cd84(0x149)]((_0xcd3d38,_0x2428e6)=>{var _0xd51964=_0x46cd84;_0x4ffff8[_0x2428e6][_0xd51964(0x84)]=Math[_0xd51964(0x116)](_0xcd3d38);}),_0x120364[_0x46cd84(0x149)]((_0x31c013,_0x3d8fcf)=>{var _0x337092=_0x46cd84;_0x4ffff8[_0x3d8fcf][_0x337092(0x160)]=_0x31c013;}),_0x5e27c1[_0x46cd84(0x149)]((_0x3c8d9f,_0x1ff939)=>{var _0x2e64d3=_0x46cd84;_0x4ffff8[_0x1ff939][_0x2e64d3(0x14d)]=_0x3c8d9f;}),_0x24f535[_0x46cd84(0x149)]((_0x46eff5,_0x48dc54)=>{_0x4ffff8[_0x48dc54]['quantity']=_0x46eff5;}),_0x17eec7[_0x46cd84(0x149)]((_0x3d66bc,_0x8cfa87)=>{var _0x46c516=_0x46cd84;_0x4ffff8[_0x8cfa87][_0x46c516(0xab)]=_0x3d66bc;}),_0x2ff5ac[_0x46cd84(0x149)]((_0x3778db,_0x5c42cd)=>{var _0x3b4b51=_0x46cd84;_0x4ffff8[_0x5c42cd][_0x3b4b51(0x172)]=_0x3778db;}),_0x4bcf21['forEach']((_0x21ccd9,_0x167c4c)=>{var _0x16dfe9=_0x46cd84;_0x4ffff8[_0x167c4c][_0x16dfe9(0xef)]=_0x21ccd9;}),_0x432b21[_0x46cd84(0x149)]((_0x396405,_0x18b59a)=>{var _0xc63ff5=_0x46cd84;_0x3cc91c[_0xc63ff5(0x149)]((_0x2d6a47,_0x2fd44b)=>{var _0x483787=_0xc63ff5;if(_0x2d6a47=='Receiving\x20Area'&&_0x18b59a==_0x2fd44b){var _0x3d1388=_0x396405[_0x483787(0x94)](0x3);_0x4ffff8[_0x18b59a][_0x483787(0x124)]=_0x396405[0x0],_0x4ffff8[_0x18b59a]['rack']=_0x396405[0x1],_0x4ffff8[_0x18b59a]['bay']=0x0,_0x4ffff8[_0x18b59a][_0x483787(0xe7)]=0x0,_0x4ffff8[_0x18b59a][_0x483787(0xaa)]=_0x483787(0xdd),_0x4ffff8[_0x18b59a][_0x483787(0x110)]=_0x3d1388;}else{if(_0x2d6a47==_0x483787(0x103)&&_0x18b59a==_0x2fd44b){var _0x3d1388=_0x396405[_0x483787(0x94)](0x3);_0x4ffff8[_0x18b59a][_0x483787(0x124)]=_0x396405[0x0],_0x4ffff8[_0x18b59a][_0x483787(0xb5)]=_0x396405[0x1],_0x4ffff8[_0x18b59a][_0x483787(0x76)]=0x0,_0x4ffff8[_0x18b59a][_0x483787(0xe7)]=0x0,_0x4ffff8[_0x18b59a][_0x483787(0xaa)]=_0x483787(0xdd),_0x4ffff8[_0x18b59a]['floorlevel']=_0x396405[0x5];}else{if(_0x18b59a==_0x2fd44b){var _0x33910d;if(_0x396405[0x4]=='L')_0x33910d=_0x483787(0x16d);else _0x396405[0x4]=='F'&&(_0x33910d=_0x483787(0xdd));_0x4ffff8[_0x18b59a][_0x483787(0x124)]=_0x396405[0x0],_0x4ffff8[_0x18b59a][_0x483787(0xb5)]=_0x396405[0x1],_0x4ffff8[_0x18b59a][_0x483787(0x76)]=_0x396405[0x2],_0x4ffff8[_0x18b59a][_0x483787(0xe7)]=_0x396405[0x3],_0x4ffff8[_0x18b59a][_0x483787(0xaa)]=_0x33910d,_0x4ffff8[_0x18b59a][_0x483787(0x110)]=_0x396405[0x5];}}}});}),_0x253d66['forEach']((_0x2b30de,_0x3f44a6)=>{var _0x4f5632=_0x46cd84;_0x4ffff8[_0x3f44a6][_0x4f5632(0xc4)]=_0x2b30de;}),_0x4d145c[_0x46cd84(0x149)]((_0x417897,_0x1d52a3)=>{var _0x20cec7=_0x46cd84;_0x4ffff8[_0x1d52a3][_0x20cec7(0x14a)]=_0x417897;}),_0x864459[_0x46cd84(0x149)]((_0x11c5c1,_0xea2121)=>{_0x4ffff8[_0xea2121]['batch_code']=_0x11c5c1;}),_0x2d043d[_0x46cd84(0x149)]((_0x53d573,_0x4b0076)=>{_0x4ffff8[_0x4b0076]['expiry_date']=_0x53d573;}),_0x47785d[_0x46cd84(0x149)]((_0x37809e,_0x5bc8ce)=>{var _0x93e88e=_0x46cd84;_0x4ffff8[_0x5bc8ce][_0x93e88e(0xd3)]=_0x37809e;}),_0x56ec78[_0x46cd84(0x149)]((_0x3e9084,_0x830fef)=>{var _0x5ca35d=_0x46cd84;_0x4ffff8[_0x830fef][_0x5ca35d(0xf7)]=_0x3e9084;}),_0x48c301['forEach']((_0x6d8692,_0x2553cb)=>{var _0x2b05c0=_0x46cd84;_0x4ffff8[_0x2553cb][_0x2b05c0(0x142)]=_0x6d8692;}),_0x265115[_0x46cd84(0x149)]((_0x55f182,_0x14fd72)=>{var _0x216281=_0x46cd84;_0x4ffff8[_0x14fd72][_0x216281(0x8d)]=_0x55f182;}),_0x3000cc['forEach']((_0xbe237f,_0x145889)=>{var _0x70ef2d=_0x46cd84;_0x4ffff8[_0x145889][_0x70ef2d(0x105)]=_0xbe237f;}),_0x376e49[_0x46cd84(0x149)]((_0x489451,_0x41fc1a)=>{_0x4ffff8[_0x41fc1a]['prod_cat']=_0x489451;}),_0x8aeac0[_0x46cd84(0x149)]((_0x136a01,_0x2214ce)=>{_0x4ffff8[_0x2214ce]['quantity_notConverted']=_0x136a01;}),_0x3cc91c['forEach']((_0x5915e1,_0x56fbc9)=>{_0x4ffff8[_0x56fbc9]['room_name']=_0x5915e1;}),_0x586064[_0x46cd84(0x149)]((_0x38e690,_0x3b7de3)=>{var _0x24a072=_0x46cd84;_0x4ffff8[_0x3b7de3][_0x24a072(0x115)]=_0x38e690;});var _0x29884a=0x0;_0x4ffff8[_0x46cd84(0x149)](_0x5c62d3=>{var _0x2e98a0=_0x46cd84;(_0x5c62d3[_0x2e98a0(0x150)]<_0x5c62d3['quantity_notConverted']||_0x5c62d3['quantity_notConverted']==0x0)&&(console[_0x2e98a0(0xd6)](_0x2e98a0(0x122),_0x5c62d3),_0x29884a++);});const _0x1cd57d=_0x4ffff8[_0x46cd84(0x181)](_0x3db588=>_0x3db588[_0x46cd84(0x165)]!=='0'&&_0x3db588[_0x46cd84(0x165)]!==''),_0x1573da=new sales({'invoice':_0x33a110,'customer':_0x363b4b[_0x46cd84(0x11f)][_0x46cd84(0xb3)],'date':_0x21aa5c,'warehouse_name':_0x2bf8f2,'sale_product':_0x1cd57d,'note':_0x3f166c,'room':_0x66eb7b,'primary_code':_0x1eccab,'secondary_code':_0x404af9,'prod_code':_0x4c08f6,'SCRN':_0x3eaa4d}),_0x427f35=await _0x1573da['save']();_0x363b4b['flash'](_0x46cd84(0xd8),_0x46cd84(0x87)),_0x1007dc['redirect']('/all_sales/preview/'+_0x427f35[_0x46cd84(0x148)]);}catch(_0x1fabbe){console['log'](_0x1fabbe);}}),router[a0_0x20bdbb(0x8f)]('/preview/:id',auth,async(_0x19c89c,_0x3a8e4a)=>{var _0x146506=a0_0x20bdbb;try{const {username:_0x22382e,email:_0x3acb3b,role:_0x57bda2}=_0x19c89c[_0x146506(0x11d)],_0x5731be=_0x19c89c[_0x146506(0x11d)],_0x38c163=await profile[_0x146506(0xd2)]({'email':_0x5731be[_0x146506(0x145)]}),_0x17e96d=await master_shop[_0x146506(0x9f)](),_0x2cd8e1=_0x19c89c[_0x146506(0x123)]['id'],_0x26cd63=await sales[_0x146506(0xf8)](_0x2cd8e1),_0x3df80f=await warehouse[_0x146506(0x72)]([{'$match':{'name':_0x26cd63[_0x146506(0x153)]}},{'$unwind':_0x146506(0x112)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x146506(0x7a)},'product_stock':{'$first':_0x146506(0x17e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x146506(0xdb)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x146506(0xeb)},'secondary_code':{'$first':_0x146506(0xe3)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x146506(0xb4)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x146506(0x12d)}}}]),_0x4c1bc7=await customer[_0x146506(0x9f)]({});let _0x11c519;if(_0x5731be[_0x146506(0x111)]==_0x146506(0x16e)){const _0x26fc3c=await staff['findOne']({'email':_0x5731be['email']});_0x11c519=await warehouse[_0x146506(0x72)]([{'$match':{'status':_0x146506(0xfc),'name':_0x26fc3c[_0x146506(0x151)]}},{'$group':{'_id':_0x146506(0x169),'name':{'$first':_0x146506(0x169)}}}]);}else _0x11c519=await warehouse[_0x146506(0x72)]([{'$match':{'status':_0x146506(0xfc)}},{'$group':{'_id':_0x146506(0x169),'name':{'$first':_0x146506(0x169)}}}]);const _0x3027ca=await product[_0x146506(0x9f)]({}),_0x4f7818=await suppliers[_0x146506(0x9f)]({});if(_0x17e96d[0x0]['language']==_0x146506(0xe5)){var _0xc1f354=users[_0x146506(0x99)];console[_0x146506(0xd6)](_0xc1f354);}else{if(_0x17e96d[0x0]['language']==_0x146506(0xec))var _0xc1f354=users['Hindi'];else{if(_0x17e96d[0x0][_0x146506(0xcf)]==_0x146506(0x95))var _0xc1f354=users['German'];else{if(_0x17e96d[0x0]['language']==_0x146506(0x180))var _0xc1f354=users[_0x146506(0x180)];else{if(_0x17e96d[0x0][_0x146506(0xcf)]==_0x146506(0xf4))var _0xc1f354=users[_0x146506(0xf4)];else{if(_0x17e96d[0x0][_0x146506(0xcf)]==_0x146506(0x8a))var _0xc1f354=users[_0x146506(0x16b)];else{if(_0x17e96d[0x0]['language']==_0x146506(0x12a))var _0xc1f354=users[_0x146506(0x12a)];else{if(_0x17e96d[0x0]['language']==_0x146506(0x12c))var _0xc1f354=users['Arabic'];}}}}}}}_0x3a8e4a['render'](_0x146506(0xb8),{'success':_0x19c89c[_0x146506(0x12e)]('success'),'errors':_0x19c89c['flash']('errors'),'role':_0x5731be,'profile':_0x38c163,'customer':_0x4c1bc7,'warehouse':_0x11c519,'product':_0x3df80f,'user':_0x26cd63,'master_shop':_0x17e96d,'unit':_0x3027ca,'language':_0xc1f354,'suppliers':_0x4f7818});}catch(_0x1dd87a){console[_0x146506(0xd6)](_0x1dd87a);}}),router[a0_0x20bdbb(0x9a)](a0_0x20bdbb(0x159),auth,async(_0x44fdfd,_0x48018b)=>{var _0xcc721f=a0_0x20bdbb;try{const _0x4253e3=_0x44fdfd[_0xcc721f(0x123)]['id'],{invoice:_0x26af0d,warehouse_name:_0x31b46b,room:_0x1ab2eb}=_0x44fdfd['body'],_0xc531cf=await sales[_0xcc721f(0xd2)]({'invoice':_0x26af0d}),_0x78658e=_0xc531cf[_0xcc721f(0x8b)]['map'](async _0x3bfd4a=>{var _0x45a5f5=_0xcc721f,_0xacdef1=await warehouse['findOne']({'name':_0x31b46b,'room':_0x3bfd4a[_0x45a5f5(0x9e)],'warehouse_category':_0x45a5f5(0x101)});const _0x4020fe=_0xacdef1['product_details'][_0x45a5f5(0x14f)](_0x42db83=>{var _0x196b0f=_0x45a5f5;_0x42db83[_0x196b0f(0xdc)]==_0x3bfd4a[_0x196b0f(0xdc)]&&_0x42db83['floorlevel']==_0x3bfd4a[_0x196b0f(0x110)]&&_0x42db83[_0x196b0f(0xaa)]==_0x3bfd4a['type']&&_0x42db83[_0x196b0f(0xe7)]==_0x3bfd4a[_0x196b0f(0xe7)]&&_0x42db83[_0x196b0f(0x76)]==_0x3bfd4a[_0x196b0f(0x76)]&&_0x42db83[_0x196b0f(0xb5)]==_0x3bfd4a[_0x196b0f(0xb5)]&&_0x42db83[_0x196b0f(0x124)]==_0x3bfd4a[_0x196b0f(0x124)]&&_0x42db83[_0x196b0f(0xcb)]==_0x3bfd4a[_0x196b0f(0xcb)]&&_0x42db83[_0x196b0f(0x12b)]==_0x3bfd4a['batch_code']&&_0x42db83[_0x196b0f(0x148)]==_0x3bfd4a[_0x196b0f(0x14d)]&&(_0x42db83[_0x196b0f(0xc3)]=Math[_0x196b0f(0x138)](0x0,Math[_0x196b0f(0x116)](_0x42db83[_0x196b0f(0xc3)])-Math['abs'](_0x3bfd4a[_0x196b0f(0x165)])));});return _0xacdef1;});Promise[_0xcc721f(0xa2)](_0x78658e)[_0xcc721f(0x73)](async _0x174dff=>{var _0x445d54=_0xcc721f;try{for(const _0x15e2ec of _0x174dff){await _0x15e2ec[_0x445d54(0xa3)]();}_0xc531cf[_0x445d54(0x179)]=_0x445d54(0xc6);const _0x1819be=await _0xc531cf[_0x445d54(0xa3)](),_0x9d0ace=await master_shop['find'](),_0x26ec36=await email_settings[_0x445d54(0xd2)](),_0x45fc69=await supervisor_settings[_0x445d54(0x9f)]();var _0x5b959b=_0xc531cf[_0x445d54(0x8b)],_0x5207d3='',_0x3275b0;for(_0x3275b0 in _0x5b959b){_0x5207d3+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b959b[_0x3275b0][_0x445d54(0xdc)]+'</td>'+_0x445d54(0x143)+_0x5b959b[_0x3275b0][_0x445d54(0xef)]+_0x445d54(0x10a)+_0x445d54(0x143)+_0x5b959b[_0x3275b0][_0x445d54(0x165)]+_0x445d54(0x10a)+_0x445d54(0x143)+_0x5b959b[_0x3275b0][_0x445d54(0xc4)]+_0x445d54(0x10a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b959b[_0x3275b0][_0x445d54(0x14a)]+_0x445d54(0x10a)+_0x445d54(0x143)+_0xc531cf[_0x445d54(0x153)]+_0x445d54(0x10a)+_0x445d54(0x143)+_0x5b959b[_0x3275b0][_0x445d54(0x9e)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b959b[_0x3275b0][_0x445d54(0x124)]+_0x5b959b[_0x3275b0][_0x445d54(0xb5)]+_0x5b959b[_0x3275b0][_0x445d54(0x76)]+_0x5b959b[_0x3275b0]['bin']+_0x5b959b[_0x3275b0][_0x445d54(0xaa)][0x0]+_0x5b959b[_0x3275b0][_0x445d54(0x110)]+_0x445d54(0x10a),_0x445d54(0x10c);}let _0x49dee6=nodemailer[_0x445d54(0x171)]({'host':_0x26ec36[_0x445d54(0x11a)],'port':Number(_0x26ec36[_0x445d54(0xbb)]),'secure':![],'auth':{'user':_0x26ec36['email'],'pass':_0x26ec36[_0x445d54(0x154)]}}),_0x344296={'from':_0x26ec36[_0x445d54(0x145)],'to':_0x45fc69[0x0][_0x445d54(0xba)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x445d54(0xe1),'path':__dirname+_0x445d54(0x161)+_0x445d54(0x17d)+_0x9d0ace[0x0][_0x445d54(0xf5)],'cid':_0x445d54(0x77)}],'html':_0x445d54(0x13e)+_0x445d54(0x15e)+_0x445d54(0x157)+'<div>'+_0x445d54(0x166)+_0x445d54(0x129)+_0x445d54(0x119)+_0x445d54(0xad)+_0x445d54(0x129)+_0x445d54(0x6f)+_0x9d0ace[0x0][_0x445d54(0x136)]+_0x445d54(0x7b)+_0x445d54(0xad)+'</div>'+_0x445d54(0xc7)+_0x445d54(0x129)+_0x445d54(0x6e)+_0x445d54(0x185)+_0xc531cf[_0x445d54(0x115)]+'\x20'+_0x445d54(0xea)+_0x445d54(0x184)+_0xc531cf[_0x445d54(0xde)]+'\x20'+'</span>'+'</h5>'+_0x445d54(0xad)+_0x445d54(0x127)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x445d54(0xda)+_0x445d54(0x85)+_0x445d54(0xe2)+_0x445d54(0xe4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x445d54(0xd4)+_0x445d54(0x6d)+_0x445d54(0x89)+_0x445d54(0x141)+_0x445d54(0x10c)+_0x445d54(0x174)+_0x445d54(0x102)+'\x20'+_0x5207d3+'\x20'+_0x445d54(0xd7)+_0x445d54(0x15f)+'<div>'+_0x445d54(0x170)+_0x445d54(0xd0)+_0x9d0ace[0x0][_0x445d54(0x136)]+_0x445d54(0xff)+_0x445d54(0xad)+_0x445d54(0xad)+_0x445d54(0x9c)};_0x49dee6['sendMail'](_0x344296,function(_0x1ddba3,_0x402e70){var _0x56b492=_0x445d54;_0x1ddba3?(console[_0x56b492(0xd6)](_0x1ddba3),console['log'](_0x56b492(0x78))):console['log'](_0x56b492(0xfe));}),_0x44fdfd[_0x445d54(0x12e)](_0x445d54(0xd8),'Sales\x20Update\x20successfully'),_0x48018b[_0x445d54(0x17f)](_0x445d54(0xb0)+_0x4253e3);}catch(_0x44e9dc){console['error'](_0x44e9dc),_0x48018b[_0x445d54(0x11e)](0x1f4)[_0x445d54(0x178)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0xcc721f(0xbe)](_0x45917e=>{var _0xbda2a2=_0xcc721f;console[_0xbda2a2(0x104)](_0x45917e),_0x48018b[_0xbda2a2(0x11e)](0x1f4)['json']({'error':_0xbda2a2(0x16f)});});}catch(_0x210cc2){console[_0xcc721f(0xd6)](_0x210cc2);}}),router[a0_0x20bdbb(0x8f)](a0_0x20bdbb(0x97),auth,async(_0x9ba373,_0x1d21a0)=>{var _0xbf3cea=a0_0x20bdbb;try{const {username:_0x127367,email:_0x22761a,role:_0x538a72}=_0x9ba373['user'],_0x4adf64=_0x9ba373[_0xbf3cea(0x11d)],_0x495515=await profile['findOne']({'email':_0x4adf64[_0xbf3cea(0x145)]}),_0x3b48a9=await master_shop['find'](),_0x4a2386=_0x9ba373[_0xbf3cea(0x123)]['id'],_0xa618a5=await sales[_0xbf3cea(0xf8)](_0x4a2386);var _0x45f51b=[_0xbf3cea(0x144),_0xbf3cea(0x16a)];const _0x4bf285=await warehouse['aggregate']([{'$match':{'name':_0xa618a5[_0xbf3cea(0x153)],'warehouse_category':_0xbf3cea(0x101)}},{'$unwind':_0xbf3cea(0x112)},{'$group':{'_id':_0xbf3cea(0xf0),'name':{'$first':_0xbf3cea(0x7a)},'product_stock':{'$first':_0xbf3cea(0x17e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xbf3cea(0xbd)},'type':{'$first':_0xbf3cea(0xdb)},'floorlevel':{'$first':_0xbf3cea(0xa6)},'primary_code':{'$first':_0xbf3cea(0xeb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xbf3cea(0x70)},'storage':{'$first':_0xbf3cea(0xb4)},'rack':{'$first':_0xbf3cea(0x109)}}}]),_0x54f07b=await customer[_0xbf3cea(0x9f)]({});let _0x2c6c79;if(_0x4adf64[_0xbf3cea(0x111)]==_0xbf3cea(0x16e)){const _0x1fd326=await staff['findOne']({'email':_0x4adf64[_0xbf3cea(0x145)]});_0x2c6c79=await warehouse[_0xbf3cea(0x72)]([{'$match':{'status':'Enabled','name':_0x1fd326['warehouse'],'warehouse_category':_0xbf3cea(0x101)}},{'$group':{'_id':_0xbf3cea(0x169),'name':{'$first':_0xbf3cea(0x169)}}}]);}else _0x2c6c79=await warehouse[_0xbf3cea(0x72)]([{'$match':{'status':_0xbf3cea(0xfc),'warehouse_category':_0xbf3cea(0x101)}},{'$group':{'_id':_0xbf3cea(0x169),'name':{'$first':_0xbf3cea(0x169)}}}]);const _0x59b19f=await product['find']({});if(_0x3b48a9[0x0]['language']=='English\x20(US)'){var _0x3cf523=users['English'];console[_0xbf3cea(0xd6)](_0x3cf523);}else{if(_0x3b48a9[0x0][_0xbf3cea(0xcf)]==_0xbf3cea(0xec))var _0x3cf523=users[_0xbf3cea(0xec)];else{if(_0x3b48a9[0x0][_0xbf3cea(0xcf)]=='German')var _0x3cf523=users['German'];else{if(_0x3b48a9[0x0]['language']==_0xbf3cea(0x180))var _0x3cf523=users[_0xbf3cea(0x180)];else{if(_0x3b48a9[0x0]['language']==_0xbf3cea(0xf4))var _0x3cf523=users[_0xbf3cea(0xf4)];else{if(_0x3b48a9[0x0][_0xbf3cea(0xcf)]==_0xbf3cea(0x8a))var _0x3cf523=users[_0xbf3cea(0x16b)];else{if(_0x3b48a9[0x0][_0xbf3cea(0xcf)]==_0xbf3cea(0x12a))var _0x3cf523=users[_0xbf3cea(0x12a)];else{if(_0x3b48a9[0x0]['language']=='Arabic\x20(ae)')var _0x3cf523=users[_0xbf3cea(0xa9)];}}}}}}}_0x1d21a0[_0xbf3cea(0xa1)](_0xbf3cea(0x81),{'success':_0x9ba373[_0xbf3cea(0x12e)](_0xbf3cea(0xd8)),'errors':_0x9ba373[_0xbf3cea(0x12e)](_0xbf3cea(0x98)),'role':_0x4adf64,'profile':_0x495515,'customer':_0x54f07b,'warehouse':_0x2c6c79,'product':_0x4bf285,'user':_0xa618a5,'master_shop':_0x3b48a9,'unit':_0x59b19f,'language':_0x3cf523});}catch(_0x55c2f5){console[_0xbf3cea(0xd6)](_0x55c2f5);}}),router[a0_0x20bdbb(0x9a)](a0_0x20bdbb(0x97),auth,async(_0x18f12b,_0xcfa3c5)=>{var _0x1fa203=a0_0x20bdbb;try{const _0xaf0aa7=_0x18f12b[_0x1fa203(0x123)]['id'],_0x3b8e3a=await sales[_0x1fa203(0xd2)]({'_id':_0x18f12b[_0x1fa203(0x123)]['id']}),_0x461ee6=await warehouse[_0x1fa203(0xd2)]({'name':_0x3b8e3a[_0x1fa203(0x153)],'room':_0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0x15c)]}),{invoice:_0x4c793e,date:_0x24309a,warehouse_name:_0x57ab16,product_name:_0x54590b,stock:_0x199c37,quantity:_0x42edf0,note:_0x28b7ce,room:_0x15db7c,customer:_0x505fc0,SCRN:_0x2a8152}=_0x18f12b[_0x1fa203(0x11f)];if(typeof _0x54590b=='string')var _0x2324d4=[_0x18f12b[_0x1fa203(0x11f)]['product_name']],_0x3a0af4=[_0x18f12b['body']['stock']],_0x316076=[_0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0xcc)]],_0x3926fe=[_0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0xab)]],_0x1c2cd8=[_0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0x172)]],_0x97dffe=[_0x18f12b[_0x1fa203(0x11f)]['prod_code']],_0x51786f=[_0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0x86)]],_0x2cc6e4=[_0x18f12b['body']['primary_unit']],_0x26e491=[_0x18f12b[_0x1fa203(0x11f)]['secondary_unit']],_0x9dcdc=[_0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0x12b)]],_0x51e180=[_0x18f12b[_0x1fa203(0x11f)]['expiry_date']],_0x478767=[_0x18f12b['body'][_0x1fa203(0xc9)]],_0x625ada=[_0x18f12b['body']['production_date']],_0x4f8b82=[_0x18f12b['body'][_0x1fa203(0x142)]],_0x2b7d8a=[_0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0x8d)]],_0x49ad59=[_0x18f12b[_0x1fa203(0x11f)]['delivery_code']],_0x356d1e=[_0x18f12b['body'][_0x1fa203(0x140)]],_0x45a398=[_0x18f12b[_0x1fa203(0x11f)]['quantity']],_0x6f705f=[_0x18f12b['body']['RoomAssigned']];else var _0x2324d4=[..._0x18f12b[_0x1fa203(0x11f)]['product_name']],_0x3a0af4=[..._0x18f12b['body'][_0x1fa203(0x150)]],_0x316076=[..._0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0xcc)]],_0x3926fe=[..._0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0xab)]],_0x1c2cd8=[..._0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0x172)]],_0x97dffe=[..._0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0xbf)]],_0x51786f=[..._0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0x86)]],_0x2cc6e4=[..._0x18f12b[_0x1fa203(0x11f)]['primary_unit']],_0x26e491=[..._0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0x14a)]],_0x9dcdc=[..._0x18f12b[_0x1fa203(0x11f)]['batch_code']],_0x51e180=[..._0x18f12b['body'][_0x1fa203(0xcb)]],_0x478767=[..._0x18f12b[_0x1fa203(0x11f)]['max_per_unit']],_0x625ada=[..._0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0xf7)]],_0x4f8b82=[..._0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0x142)]],_0x2b7d8a=[..._0x18f12b[_0x1fa203(0x11f)]['delivery_date']],_0x49ad59=[..._0x18f12b['body'][_0x1fa203(0x105)]],_0x356d1e=[..._0x18f12b[_0x1fa203(0x11f)]['prod_cat']],_0x45a398=[..._0x18f12b[_0x1fa203(0x11f)][_0x1fa203(0x165)]],_0x6f705f=[..._0x18f12b[_0x1fa203(0x11f)]['RoomAssigned']];const _0x50badb=_0x2324d4[_0x1fa203(0x14f)](_0x84c856=>{return _0x84c856={'product_name':_0x84c856};});_0x3a0af4['forEach']((_0xab5e7f,_0x2a2aad)=>{var _0x2bf609=_0x1fa203;_0x50badb[_0x2a2aad][_0x2bf609(0x150)]=Math[_0x2bf609(0x116)](_0xab5e7f);}),_0x316076[_0x1fa203(0x149)]((_0x85fd25,_0x53c4d2)=>{var _0x1fa220=_0x1fa203;_0x50badb[_0x53c4d2][_0x1fa220(0x165)]=_0x85fd25;}),_0x3926fe[_0x1fa203(0x149)]((_0x1bfc12,_0x77fec2)=>{var _0x27d45c=_0x1fa203;_0x50badb[_0x77fec2][_0x27d45c(0xab)]=_0x1bfc12;}),_0x1c2cd8['forEach']((_0x34c06b,_0x17d8a2)=>{_0x50badb[_0x17d8a2]['secondary_code']=_0x34c06b;}),_0x97dffe['forEach']((_0x4705c3,_0x1ecb3b)=>{var _0xdb21fe=_0x1fa203;_0x50badb[_0x1ecb3b][_0xdb21fe(0xef)]=_0x4705c3;}),_0x51786f[_0x1fa203(0x149)]((_0x34cb61,_0x412561)=>{var _0x4f710a=_0x1fa203;_0x6f705f[_0x4f710a(0x149)]((_0x90884c,_0x835047)=>{var _0x16a084=_0x4f710a;if(_0x90884c==_0x16a084(0x130)&&_0x412561==_0x835047){var _0x10f4cf=_0x34cb61[_0x16a084(0x94)](0x3);_0x50badb[_0x412561][_0x16a084(0x124)]=_0x34cb61[0x0],_0x50badb[_0x412561][_0x16a084(0xb5)]=_0x34cb61[0x1],_0x50badb[_0x412561][_0x16a084(0x76)]=0x0,_0x50badb[_0x412561][_0x16a084(0xe7)]=0x0,_0x50badb[_0x412561]['type']='Floor',_0x50badb[_0x412561][_0x16a084(0x110)]=_0x10f4cf;}else{if(_0x90884c==_0x16a084(0x103)&&_0x412561==_0x835047){var _0x10f4cf=_0x34cb61['slice'](0x3);_0x50badb[_0x412561][_0x16a084(0x124)]=_0x34cb61[0x0],_0x50badb[_0x412561][_0x16a084(0xb5)]=_0x34cb61[0x1],_0x50badb[_0x412561][_0x16a084(0x76)]=0x0,_0x50badb[_0x412561][_0x16a084(0xe7)]=0x0,_0x50badb[_0x412561]['type']='Floor',_0x50badb[_0x412561][_0x16a084(0x110)]=_0x34cb61[0x5];}else{if(_0x412561==_0x835047){var _0x58cb93;if(_0x34cb61[0x4]=='L')_0x58cb93=_0x16a084(0x16d);else _0x34cb61[0x4]=='F'&&(_0x58cb93=_0x16a084(0xdd));_0x50badb[_0x412561][_0x16a084(0x124)]=_0x34cb61[0x0],_0x50badb[_0x412561]['rack']=_0x34cb61[0x1],_0x50badb[_0x412561]['bay']=_0x34cb61[0x2],_0x50badb[_0x412561][_0x16a084(0xe7)]=_0x34cb61[0x3],_0x50badb[_0x412561][_0x16a084(0xaa)]=_0x58cb93,_0x50badb[_0x412561][_0x16a084(0x110)]=_0x34cb61[0x5];}}}});}),_0x2cc6e4['forEach']((_0xa783c6,_0x240f54)=>{var _0x4b941b=_0x1fa203;_0x50badb[_0x240f54][_0x4b941b(0xc4)]=_0xa783c6;}),_0x26e491[_0x1fa203(0x149)]((_0x1f6e5b,_0x4b0ef0)=>{var _0x3726af=_0x1fa203;_0x50badb[_0x4b0ef0][_0x3726af(0x14a)]=_0x1f6e5b;}),_0x9dcdc['forEach']((_0x501797,_0x5d61be)=>{var _0x1a1f47=_0x1fa203;_0x50badb[_0x5d61be][_0x1a1f47(0x12b)]=_0x501797;}),_0x51e180[_0x1fa203(0x149)]((_0xbd060f,_0x186e83)=>{var _0x91766=_0x1fa203;_0x50badb[_0x186e83][_0x91766(0xcb)]=_0xbd060f;}),_0x478767[_0x1fa203(0x149)]((_0x467f20,_0x3cca1b)=>{_0x50badb[_0x3cca1b]['maxperunit']=_0x467f20;}),_0x625ada[_0x1fa203(0x149)]((_0x50ea99,_0x7a6117)=>{_0x50badb[_0x7a6117]['production_date']=_0x50ea99;}),_0x4f8b82[_0x1fa203(0x149)]((_0x5360ca,_0x2e138e)=>{var _0x416ed4=_0x1fa203;_0x50badb[_0x2e138e][_0x416ed4(0x142)]=Math[_0x416ed4(0x116)](_0x5360ca);}),_0x2b7d8a[_0x1fa203(0x149)]((_0x1b2e4b,_0x1f7f13)=>{var _0x3b2715=_0x1fa203;_0x50badb[_0x1f7f13][_0x3b2715(0x8d)]=_0x1b2e4b;}),_0x49ad59['forEach']((_0x52bedc,_0x5a7c81)=>{var _0x135497=_0x1fa203;_0x50badb[_0x5a7c81][_0x135497(0x105)]=_0x52bedc;}),_0x356d1e[_0x1fa203(0x149)]((_0x3da66f,_0x5b28fe)=>{var _0xb2770d=_0x1fa203;_0x50badb[_0x5b28fe][_0xb2770d(0x140)]=_0x3da66f;}),_0x45a398[_0x1fa203(0x149)]((_0x5aed45,_0x59631f)=>{_0x50badb[_0x59631f]['quantity_notConverted']=_0x5aed45;}),_0x6f705f[_0x1fa203(0x149)]((_0x1ea197,_0x4e8b06)=>{var _0x3ae034=_0x1fa203;_0x50badb[_0x4e8b06][_0x3ae034(0x9e)]=_0x1ea197;});var _0x22023d=0x0;_0x50badb[_0x1fa203(0x149)](_0x452a17=>{var _0x25452f=_0x1fa203;console['log'](_0x25452f(0x122),_0x452a17),(parseInt(_0x452a17[_0x25452f(0x150)])<parseInt(_0x452a17[_0x25452f(0x165)])||parseInt(_0x452a17[_0x25452f(0x165)])==0x0)&&_0x22023d++;});if(_0x22023d!=0x0)return _0x18f12b[_0x1fa203(0x12e)](_0x1fa203(0x98),_0x1fa203(0x107)),_0xcfa3c5[_0x1fa203(0x17f)]('back');const _0x26e566=_0x50badb['filter'](_0x4025dd=>_0x4025dd[_0x1fa203(0x165)]!=='0'&&_0x4025dd['quantity']!=='');_0x3b8e3a[_0x1fa203(0x115)]=_0x4c793e,_0x3b8e3a[_0x1fa203(0xb3)]=_0x505fc0,_0x3b8e3a[_0x1fa203(0xde)]=_0x24309a,_0x3b8e3a[_0x1fa203(0x153)]=_0x57ab16,_0x3b8e3a['sale_product']=_0x26e566,_0x3b8e3a['note']=_0x28b7ce,_0x3b8e3a[_0x1fa203(0xc0)]=_0x2a8152,_0x3b8e3a[_0x1fa203(0x179)]='False',_0x3b8e3a['isAllowEdit']=_0x1fa203(0x96);const _0x439e4d=await _0x3b8e3a[_0x1fa203(0xa3)]();_0x18f12b[_0x1fa203(0x12e)](_0x1fa203(0xd8),'Sales\x20Update\x20successfully'),_0xcfa3c5['redirect']('/all_sales/view');}catch(_0x488940){console[_0x1fa203(0xd6)](_0x488940);}}),router['post'](a0_0x20bdbb(0xc5),auth,async(_0x1b2fff,_0xe48741)=>{var _0x3a91ef=a0_0x20bdbb;try{const _0x3eb6f1=_0x1b2fff['params']['id'],{invoice:_0x2c70cb,customer:_0x5b9e3a,receivable_amount:_0x2c7fd4,received_amount:_0x4d6bf4}=_0x1b2fff[_0x3a91ef(0x11f)],_0x453d8c=await sales[_0x3a91ef(0xf8)](_0x3eb6f1);console[_0x3a91ef(0xd6)](_0x453d8c);var _0x454874=_0x2c7fd4-_0x4d6bf4;console[_0x3a91ef(0xd6)](_0x4d6bf4),_0x453d8c[_0x3a91ef(0x15a)]=parseFloat(_0x4d6bf4)+parseFloat(_0x453d8c[_0x3a91ef(0x15a)]),_0x453d8c['due_amount']=_0x454874,console[_0x3a91ef(0xd6)](_0x453d8c);const _0x585f99=await _0x453d8c[_0x3a91ef(0xa3)](),_0x25371d=await c_payment_data['findOne']({'invoice':_0x2c70cb});_0x25371d[_0x3a91ef(0x133)]=_0x454874,await _0x25371d[_0x3a91ef(0xa3)]();let _0x54e06b=new Date(),_0x5d629e=('0'+_0x54e06b[_0x3a91ef(0xee)]())[_0x3a91ef(0x94)](-0x2),_0x31dde7=('0'+(_0x54e06b[_0x3a91ef(0x167)]()+0x1))[_0x3a91ef(0x94)](-0x2),_0x13d63c=_0x54e06b[_0x3a91ef(0x93)](),_0x4dce3d=_0x13d63c+'-'+_0x31dde7+'-'+_0x5d629e;const _0x2ad50b=new customer_payment({'invoice':_0x2c70cb,'date':_0x13d63c+'-'+_0x31dde7+'-'+_0x5d629e,'customer':_0x5b9e3a,'reason':_0x3a91ef(0x183),'amount':_0x4d6bf4}),_0x495e11=await _0x2ad50b[_0x3a91ef(0xa3)]();_0x1b2fff['flash'](_0x3a91ef(0xd8),_0x3a91ef(0xf1)),_0xe48741['redirect'](_0x3a91ef(0xa0));}catch(_0x2cd76c){console[_0x3a91ef(0xd6)](_0x2cd76c);}}),router[a0_0x20bdbb(0x8f)](a0_0x20bdbb(0x75),auth,async(_0x2c3a0d,_0x432840)=>{var _0x5693d0=a0_0x20bdbb;try{const {username:_0x347490,email:_0x446979,role:_0x2b6a98}=_0x2c3a0d[_0x5693d0(0x11d)],_0x434c19=_0x2c3a0d[_0x5693d0(0x11d)],_0x127ac4=await profile[_0x5693d0(0xd2)]({'email':_0x434c19[_0x5693d0(0x145)]}),_0x4c4099=await master_shop[_0x5693d0(0x9f)]();console[_0x5693d0(0xd6)](_0x5693d0(0xaf),_0x4c4099);const _0x124154=_0x2c3a0d['params']['id'],_0x161da9=await sales[_0x5693d0(0xf8)](_0x124154);console[_0x5693d0(0xd6)](_0x161da9);const _0x1e4a22=await customer['findOne']({'name':_0x161da9[_0x5693d0(0xb3)]});console['log'](_0x1e4a22);if(_0x4c4099[0x0][_0x5693d0(0xcf)]=='English\x20(US)'){var _0x5d1d10=users[_0x5693d0(0x99)];console[_0x5693d0(0xd6)](_0x5d1d10);}else{if(_0x4c4099[0x0]['language']=='Hindi')var _0x5d1d10=users['Hindi'];else{if(_0x4c4099[0x0][_0x5693d0(0xcf)]==_0x5693d0(0x95))var _0x5d1d10=users[_0x5693d0(0x95)];else{if(_0x4c4099[0x0][_0x5693d0(0xcf)]==_0x5693d0(0x180))var _0x5d1d10=users['Spanish'];else{if(_0x4c4099[0x0][_0x5693d0(0xcf)]==_0x5693d0(0xf4))var _0x5d1d10=users[_0x5693d0(0xf4)];else{if(_0x4c4099[0x0][_0x5693d0(0xcf)]==_0x5693d0(0x8a))var _0x5d1d10=users['Portuguese'];else{if(_0x4c4099[0x0][_0x5693d0(0xcf)]==_0x5693d0(0x12a))var _0x5d1d10=users['Chinese'];else{if(_0x4c4099[0x0][_0x5693d0(0xcf)]=='Arabic\x20(ae)')var _0x5d1d10=users[_0x5693d0(0xa9)];}}}}}}}_0x432840['render'](_0x5693d0(0x13b),{'success':_0x2c3a0d[_0x5693d0(0x12e)](_0x5693d0(0xd8)),'errors':_0x2c3a0d[_0x5693d0(0x12e)](_0x5693d0(0x98)),'role':_0x434c19,'profile':_0x127ac4,'master_shop':_0x4c4099,'customers':_0x1e4a22,'sales':_0x161da9,'language':_0x5d1d10});}catch(_0x558736){console['log'](_0x558736);}}),router['get']('/view/return_sales/:id',auth,async(_0xec49d,_0x5e120a)=>{var _0x24cc7d=a0_0x20bdbb;try{const {username:_0x1a3aae,email:_0x1d932b,role:_0x3b8cea}=_0xec49d[_0x24cc7d(0x11d)],_0x51eaef=_0xec49d['user'],_0x111f4f=await profile[_0x24cc7d(0xd2)]({'email':_0x51eaef[_0x24cc7d(0x145)]}),_0x2e1405=await master_shop[_0x24cc7d(0x9f)]();console[_0x24cc7d(0xd6)]('master',_0x2e1405);const _0x2c0ef8=_0xec49d[_0x24cc7d(0x123)]['id'];console[_0x24cc7d(0xd6)](_0x2c0ef8);const _0x5b9a41=await sales[_0x24cc7d(0xf8)](_0x2c0ef8);console['log'](_0x24cc7d(0xb2),_0x5b9a41);const _0x35e48=await warehouse[_0x24cc7d(0x72)]([{'$match':{'name':_0x24cc7d(0xae),'room':_0x24cc7d(0x158)}},{'$unwind':_0x24cc7d(0x112)},{'$group':{'_id':_0x24cc7d(0xf0),'name':{'$first':_0x24cc7d(0x7a)},'product_stock':{'$first':_0x24cc7d(0x17e)},'level':{'$first':_0x24cc7d(0x113)},'isle':{'$first':_0x24cc7d(0x7e)},'pallet':{'$first':_0x24cc7d(0xb7)},'primary_code':{'$first':_0x24cc7d(0xeb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x24cc7d(0x70)}}}]);console[_0x24cc7d(0xd6)](_0x24cc7d(0x137),_0x35e48);const _0x4dd5f7=await product[_0x24cc7d(0x9f)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x24cc7d(0xfc),'name':_0x24cc7d(0xae),'warehouse_category':_0x24cc7d(0x101)}},{'$group':{'_id':_0x24cc7d(0x169),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x2bfa64=[_0x24cc7d(0x158)];if(_0x2e1405[0x0][_0x24cc7d(0xcf)]==_0x24cc7d(0xe5)){var _0x6aa7e0=users['English'];console[_0x24cc7d(0xd6)](_0x6aa7e0);}else{if(_0x2e1405[0x0]['language']==_0x24cc7d(0xec))var _0x6aa7e0=users[_0x24cc7d(0xec)];else{if(_0x2e1405[0x0]['language']==_0x24cc7d(0x95))var _0x6aa7e0=users[_0x24cc7d(0x95)];else{if(_0x2e1405[0x0]['language']==_0x24cc7d(0x180))var _0x6aa7e0=users[_0x24cc7d(0x180)];else{if(_0x2e1405[0x0][_0x24cc7d(0xcf)]==_0x24cc7d(0xf4))var _0x6aa7e0=users['French'];else{if(_0x2e1405[0x0][_0x24cc7d(0xcf)]==_0x24cc7d(0x8a))var _0x6aa7e0=users[_0x24cc7d(0x16b)];else{if(_0x2e1405[0x0][_0x24cc7d(0xcf)]==_0x24cc7d(0x12a))var _0x6aa7e0=users[_0x24cc7d(0x12a)];else{if(_0x2e1405[0x0][_0x24cc7d(0xcf)]==_0x24cc7d(0x12c))var _0x6aa7e0=users['Arabic'];}}}}}}}_0x5e120a['render']('return_sale',{'success':_0xec49d['flash'](_0x24cc7d(0xd8)),'errors':_0xec49d[_0x24cc7d(0x12e)](_0x24cc7d(0x98)),'role':_0x51eaef,'profile':_0x111f4f,'user':_0x5b9a41,'stock':_0x35e48,'master_shop':_0x2e1405,'unit':_0x4dd5f7,'language':_0x6aa7e0,'warehouses':warehouse_data,'rooms':_0x2bfa64});}catch(_0x3e4ef3){console[_0x24cc7d(0xd6)](_0x3e4ef3),_0x5e120a[_0x24cc7d(0x11e)](0xc8)[_0x24cc7d(0x178)]({'message':_0x3e4ef3['message']});}}),router[a0_0x20bdbb(0x9a)](a0_0x20bdbb(0xa4),auth,async(_0x3b6bb3,_0x4dfe26)=>{var _0x3ed1b5=a0_0x20bdbb;try{const {invoice:_0x49af93,date:_0x3a671e,warehouse_name:_0x18c05d,product_name:_0xae0387,primary_code:_0x4af69b,secondary_code:_0x580b3d,product_code:_0x5d22dd,sales_quantity:_0x14be26,stocks:_0x5a5e51,return_qty:_0x28f64d,Room_name:_0x458090,to_warehouse_name:_0x40454b,to_Roomname:_0x49038c,to_Room_name:_0x20c841,note:_0x172423,level:_0x3f3342,isle:_0x2a1b37,pallet:_0x17b523}=_0x3b6bb3[_0x3ed1b5(0x11f)];if(typeof _0xae0387=='string')var _0x5ec096=[_0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0xdc)]],_0x20abb2=[_0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0xab)]],_0x3a980c=[_0x3b6bb3['body'][_0x3ed1b5(0x172)]],_0xc90a27=[_0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0xef)]],_0x5b1cb5=[_0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0xb1)]],_0x1b1602=[_0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0xf3)]],_0x2b5a8d=[_0x3b6bb3[_0x3ed1b5(0x11f)]['return_qty']],_0x47bca9=[_0x3b6bb3['body'][_0x3ed1b5(0x76)]],_0x1a6cae=[_0x3b6bb3[_0x3ed1b5(0x11f)]['bin']],_0x54ecb8=[_0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0x117)]],_0x40a1d8=[_0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0x110)]];else var _0x5ec096=[..._0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0xdc)]],_0x20abb2=[..._0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0xab)]],_0x3a980c=[..._0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0x172)]],_0xc90a27=[..._0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0xef)]],_0x5b1cb5=[..._0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0xb1)]],_0x1b1602=[..._0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0xf3)]],_0x2b5a8d=[..._0x3b6bb3['body']['return_qty']],_0x47bca9=[..._0x3b6bb3['body'][_0x3ed1b5(0x76)]],_0x1a6cae=[..._0x3b6bb3[_0x3ed1b5(0x11f)]['bin']],_0x54ecb8=[..._0x3b6bb3[_0x3ed1b5(0x11f)][_0x3ed1b5(0x117)]],_0x40a1d8=[..._0x3b6bb3['body'][_0x3ed1b5(0x110)]];const _0xc0240e=_0x5ec096['map'](_0x4b286a=>{return _0x4b286a={'product_name':_0x4b286a};});_0x20abb2['forEach']((_0x258232,_0x5e10ff)=>{_0xc0240e[_0x5e10ff]['primary_code']=_0x258232;}),_0x3a980c[_0x3ed1b5(0x149)]((_0x426709,_0x43f71d)=>{var _0x4dc23c=_0x3ed1b5;_0xc0240e[_0x43f71d][_0x4dc23c(0x172)]=_0x426709;}),_0xc90a27[_0x3ed1b5(0x149)]((_0x424099,_0x4abbde)=>{var _0x3a2626=_0x3ed1b5;_0xc0240e[_0x4abbde][_0x3a2626(0xef)]=_0x424099;}),_0x5b1cb5[_0x3ed1b5(0x149)]((_0x48d3ec,_0x11ed32)=>{_0xc0240e[_0x11ed32]['sale_qty']=_0x48d3ec;}),_0x1b1602['forEach']((_0x465676,_0x461f38)=>{_0xc0240e[_0x461f38]['stock']=_0x465676;}),_0x2b5a8d[_0x3ed1b5(0x149)]((_0x1e0cbf,_0x47927b)=>{var _0x3c6082=_0x3ed1b5;_0xc0240e[_0x47927b][_0x3c6082(0x9b)]=_0x1e0cbf;}),_0x47bca9[_0x3ed1b5(0x149)]((_0x4ffc02,_0x42342d)=>{_0xc0240e[_0x42342d]['bay']=_0x4ffc02;}),_0x1a6cae[_0x3ed1b5(0x149)]((_0x2645e9,_0x3bb2a7)=>{_0xc0240e[_0x3bb2a7]['bin']=_0x2645e9;}),_0x54ecb8['forEach']((_0x12d998,_0x2579f2)=>{var _0x521ca8=_0x3ed1b5;_0xc0240e[_0x2579f2][_0x521ca8(0xaa)]=_0x12d998;}),_0x40a1d8[_0x3ed1b5(0x149)]((_0x4ceeac,_0x75fadf)=>{var _0x57dc50=_0x3ed1b5;_0xc0240e[_0x75fadf][_0x57dc50(0x110)]=_0x4ceeac;});var _0x1d6454=0x0;_0xc0240e['forEach'](_0x3b755c=>{var _0x4387a1=_0x3ed1b5;console[_0x4387a1(0xd6)](_0x4387a1(0x122),_0x3b755c),(parseInt(_0x3b755c[_0x4387a1(0xe0)])<parseInt(_0x3b755c[_0x4387a1(0x9b)])||parseInt(_0x3b755c[_0x4387a1(0x150)])<parseInt(_0x3b755c[_0x4387a1(0x9b)])&&parseInt(_0x3b755c[_0x4387a1(0xe0)])>parseInt(_0x3b755c['return_qty'])||parseInt(_0x3b755c[_0x4387a1(0x9b)])==0x0)&&_0x1d6454++;});if(_0x1d6454!=0x0)return _0x3b6bb3[_0x3ed1b5(0x12e)](_0x3ed1b5(0x98),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x4dfe26[_0x3ed1b5(0x17f)](_0x3ed1b5(0xfd));const _0x19ea3d=await sales[_0x3ed1b5(0xd2)]({'invoice':_0x49af93});console[_0x3ed1b5(0xd6)](_0x19ea3d),_0x19ea3d['return_data']=_0x3ed1b5(0xc6);const _0x4761eb=await _0x19ea3d[_0x3ed1b5(0xa3)](),_0x105e36=new sales_return({'invoice':_0x49af93,'customer':_0x3b6bb3[_0x3ed1b5(0x11f)]['customer'],'date':_0x3a671e,'warehouse_name':_0x18c05d,'room':_0x458090,'ToWarehouse':_0x40454b,'ToRoom':_0x20c841,'return_sale':_0xc0240e,'note':_0x172423}),_0x1099af=await _0x105e36[_0x3ed1b5(0xa3)]();console[_0x3ed1b5(0xd6)](_0x105e36);const _0x372966=await sales_return[_0x3ed1b5(0xd2)]({'invoice':_0x49af93}),_0x3e00b2=await warehouse[_0x3ed1b5(0xd2)]({'name':_0x40454b,'room':_0x20c841});_0x372966[_0x3ed1b5(0x7d)][_0x3ed1b5(0x149)](_0x5324f5=>{var _0x4790f1=_0x3ed1b5,_0x56296c=0x0;const _0x255910=_0x3e00b2['product_details']['map'](_0x58a71c=>{var _0x521f51=a0_0x20cb;_0x58a71c['product_name']==_0x5324f5[_0x521f51(0xdc)]&&_0x58a71c['floorlevel']==_0x5324f5['floorlevel']&&_0x58a71c[_0x521f51(0xaa)]==_0x5324f5[_0x521f51(0xaa)]&&_0x58a71c[_0x521f51(0xe7)]==_0x5324f5['bin']&&_0x58a71c[_0x521f51(0x76)]==_0x5324f5[_0x521f51(0x76)]&&(_0x58a71c[_0x521f51(0xc3)]=parseInt(_0x58a71c[_0x521f51(0xc3)])+parseInt(_0x5324f5[_0x521f51(0x9b)]),_0x56296c++);});_0x56296c=='0'&&(_0x3e00b2[_0x4790f1(0x79)]=_0x3e00b2[_0x4790f1(0x79)][_0x4790f1(0x10f)]({'product_name':_0x5324f5['product_name'],'product_stock':_0x5324f5[_0x4790f1(0x9b)],'primary_code':_0x5324f5[_0x4790f1(0xab)],'secondary_code':_0x5324f5[_0x4790f1(0x172)],'product_code':_0x5324f5['product_code'],'bay':_0x5324f5[_0x4790f1(0x76)],'bin':_0x5324f5[_0x4790f1(0xe7)],'type':_0x5324f5[_0x4790f1(0xaa)],'floorlevel':_0x5324f5[_0x4790f1(0x110)]})),console[_0x4790f1(0xd6)](_0x4790f1(0x90),_0x3e00b2);}),await _0x3e00b2[_0x3ed1b5(0xa3)](),console[_0x3ed1b5(0xd6)](_0x3b6bb3[_0x3ed1b5(0x11f)]);const _0x5d5eaa=new c_payment_data({'invoice':_0x49af93,'customer':_0x3b6bb3['body'][_0x3ed1b5(0xb3)],'reason':_0x3ed1b5(0xed)});await _0x5d5eaa[_0x3ed1b5(0xa3)]();const _0x110f49=await master_shop['find']();console[_0x3ed1b5(0xd6)](_0x3ed1b5(0x88),_0x110f49[0x0][_0x3ed1b5(0xf5)]);const _0x38f822=await email_settings[_0x3ed1b5(0xd2)](),_0x1a001a=await customer[_0x3ed1b5(0xd2)]({'name':_0x3b6bb3['body'][_0x3ed1b5(0xb3)]});console[_0x3ed1b5(0xd6)](_0x3ed1b5(0xd9),_0x1a001a);_0x110f49[0x0]['currency_placement']==0x1?(right_currency=_0x110f49[0x0][_0x3ed1b5(0x6c)],left_currency=''):(right_currency='',left_currency=_0x110f49[0x0][_0x3ed1b5(0x6c)]);var _0x493663=_0x5ec096,_0x14bd76=_0x2b5a8d,_0x2bde4b='',_0x4a3eed;for(_0x4a3eed in _0x493663){_0x2bde4b+=_0x3ed1b5(0xda)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x493663[_0x4a3eed]+_0x3ed1b5(0x10a)+_0x3ed1b5(0x143)+_0x14bd76[_0x4a3eed]+'</td>'+_0x3ed1b5(0x10c);}console[_0x3ed1b5(0xd6)](_0x3ed1b5(0x13c),_0x2bde4b);let _0x9fa6e7=nodemailer[_0x3ed1b5(0x171)]({'service':_0x3ed1b5(0x182),'auth':{'user':_0x38f822[_0x3ed1b5(0x145)],'pass':_0x38f822[_0x3ed1b5(0x154)]}}),_0x43eb29={'from':_0x38f822['email'],'to':_0x1a001a[_0x3ed1b5(0x145)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x3ed1b5(0xe1),'path':__dirname+'/../public'+_0x3ed1b5(0x17d)+_0x110f49[0x0]['image'],'cid':'logo'}],'html':_0x3ed1b5(0x13e)+'<html><head><title></title>'+_0x3ed1b5(0x157)+'<div>'+_0x3ed1b5(0x166)+_0x3ed1b5(0x129)+_0x3ed1b5(0x119)+_0x3ed1b5(0xad)+_0x3ed1b5(0x129)+_0x3ed1b5(0x6f)+_0x110f49[0x0][_0x3ed1b5(0x136)]+_0x3ed1b5(0x7b)+_0x3ed1b5(0xad)+_0x3ed1b5(0xad)+_0x3ed1b5(0xc7)+_0x3ed1b5(0x129)+_0x3ed1b5(0x6e)+_0x3ed1b5(0x185)+_0x49af93+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3ed1b5(0x184)+_0x3a671e+'\x20'+_0x3ed1b5(0xf9)+'</h5>'+_0x3ed1b5(0xad)+_0x3ed1b5(0x127)+_0x3ed1b5(0x71)+'<tr>'+_0x3ed1b5(0x85)+_0x3ed1b5(0x177)+_0x3ed1b5(0xc1)+_0x3ed1b5(0x132)+_0x3ed1b5(0x10c)+_0x3ed1b5(0x174)+_0x3ed1b5(0x102)+'\x20'+_0x2bde4b+'\x20'+'</tbody>'+_0x3ed1b5(0x15f)+_0x3ed1b5(0x129)+_0x3ed1b5(0x170)+_0x3ed1b5(0xd0)+_0x110f49[0x0]['site_title']+_0x3ed1b5(0xff)+_0x3ed1b5(0xad)+_0x3ed1b5(0xad)+'</body></html>'};_0x9fa6e7[_0x3ed1b5(0x80)](_0x43eb29,function(_0x990570,_0x59bc17){var _0xb4f547=_0x3ed1b5;_0x990570?(console[_0xb4f547(0xd6)](_0x990570),console[_0xb4f547(0xd6)](_0xb4f547(0x78))):console[_0xb4f547(0xd6)]('Email\x20sent\x20successfully');}),_0x3b6bb3[_0x3ed1b5(0x12e)](_0x3ed1b5(0xd8),_0x3ed1b5(0x134)),_0x4dfe26['redirect'](_0x3ed1b5(0xa0));}catch(_0x499c5f){console['log'](_0x499c5f),_0x4dfe26['status'](0xc8)[_0x3ed1b5(0x178)]({'message1':_0x499c5f[_0x3ed1b5(0x108)]});}}),router['get'](a0_0x20bdbb(0xc2),auth,async(_0x267dc7,_0x47bc69)=>{var _0x35242d=a0_0x20bdbb;try{const {username:_0x4647fb,email:_0x5ee3b0,role:_0x2e3909}=_0x267dc7[_0x35242d(0x11d)],_0x30fa18=_0x267dc7[_0x35242d(0x11d)],_0x53de65=await profile[_0x35242d(0xd2)]({'email':_0x30fa18[_0x35242d(0x145)]}),_0x4955bc=await master_shop[_0x35242d(0x9f)]();console[_0x35242d(0xd6)](_0x35242d(0xa8),_0x4955bc);const _0x573b14=_0x267dc7[_0x35242d(0x123)]['id'],_0x13f839=await sales[_0x35242d(0xf8)](_0x573b14);console[_0x35242d(0xd6)]('barcode\x20user_id',_0x13f839);if(_0x4955bc[0x0][_0x35242d(0xcf)]=='English\x20(US)')var _0x32c2fa=users[_0x35242d(0x99)];else{if(_0x4955bc[0x0][_0x35242d(0xcf)]==_0x35242d(0xec))var _0x32c2fa=users['Hindi'];else{if(_0x4955bc[0x0][_0x35242d(0xcf)]==_0x35242d(0x95))var _0x32c2fa=users[_0x35242d(0x95)];else{if(_0x4955bc[0x0][_0x35242d(0xcf)]==_0x35242d(0x180))var _0x32c2fa=users[_0x35242d(0x180)];else{if(_0x4955bc[0x0][_0x35242d(0xcf)]==_0x35242d(0xf4))var _0x32c2fa=users[_0x35242d(0xf4)];else{if(_0x4955bc[0x0][_0x35242d(0xcf)]=='Portuguese\x20(BR)')var _0x32c2fa=users[_0x35242d(0x16b)];else{if(_0x4955bc[0x0][_0x35242d(0xcf)]==_0x35242d(0x12a))var _0x32c2fa=users[_0x35242d(0x12a)];else{if(_0x4955bc[0x0][_0x35242d(0xcf)]==_0x35242d(0x12c))var _0x32c2fa=users[_0x35242d(0xa9)];}}}}}}}_0x47bc69[_0x35242d(0xa1)](_0x35242d(0x11b),{'success':_0x267dc7[_0x35242d(0x12e)]('success'),'errors':_0x267dc7[_0x35242d(0x12e)](_0x35242d(0x98)),'role':_0x30fa18,'profile':_0x53de65,'alldata':_0x13f839,'master_shop':_0x4955bc,'language':_0x32c2fa});}catch(_0x5e3dbd){console[_0x35242d(0xd6)](_0x5e3dbd);}}),router['post'](a0_0x20bdbb(0x173),async(_0x9e79fe,_0x456429)=>{var _0x28e7b8=a0_0x20bdbb;const {product_code:_0x41f30e,warehouse_name:_0x520941,rooms_data:_0x1a9e94,Roomslist:_0x5c2224}=_0x9e79fe[_0x28e7b8(0x11f)],_0x43543b=_0x5c2224[_0x28e7b8(0x82)](','),_0x352613=[];async function _0x1beb92(_0x17e729){var _0x41553c=_0x28e7b8;const _0x179d09=await warehouse[_0x41553c(0x72)]([{'$match':{'name':_0x520941,'room':_0x17e729}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x41f30e}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x41553c(0x7a)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x41553c(0xeb)},'secondary_code':{'$first':_0x41553c(0xe3)},'product_code':{'$first':_0x41553c(0x70)},'level':{'$first':_0x41553c(0x100)},'isle':{'$first':_0x41553c(0xbd)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x41553c(0xa6)},'unit':{'$first':_0x41553c(0x14c)},'secondary_unit':{'$first':_0x41553c(0xc8)},'storage':{'$first':_0x41553c(0xb4)},'rack':{'$first':_0x41553c(0x109)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x41553c(0x114)},'product_cat':{'$first':_0x41553c(0xb9)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x41553c(0x139)},'invoice':{'$first':_0x41553c(0x12d)},'actual_qty':{'$first':_0x41553c(0x14b)},'actual_uom':{'$first':_0x41553c(0x8e)},'delivery_date':{'$first':_0x41553c(0x17a)},'delivery_code':{'$first':_0x41553c(0x74)}}}]),_0x27a67d=await warehouse[_0x41553c(0x72)]([{'$match':{'name':_0x520941,'room':_0x17e729}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x41f30e}},{'$group':{'_id':_0x41553c(0xf0),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x41553c(0x17e)},'primary_code':{'$first':_0x41553c(0xeb)},'secondary_code':{'$first':_0x41553c(0xe3)},'product_code':{'$first':_0x41553c(0x70)},'level':{'$first':_0x41553c(0x100)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x41553c(0xdb)},'pallet':{'$first':_0x41553c(0xa6)},'unit':{'$first':_0x41553c(0x14c)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x41553c(0xb4)},'rack':{'$first':_0x41553c(0x109)},'expiry_date':{'$first':_0x41553c(0xe6)},'production_date':{'$first':_0x41553c(0x91)},'maxPerUnit':{'$first':_0x41553c(0xb6)},'batch_code':{'$first':_0x41553c(0x114)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x41553c(0x139)},'invoice':{'$first':_0x41553c(0x12d)},'delivery_date':{'$first':_0x41553c(0x17a)},'delivery_code':{'$first':'$product_details.delivery_code'}}}]);if(_0x179d09[_0x41553c(0xa7)]>0x0)_0x352613[_0x41553c(0xac)](_0x179d09);else _0x27a67d[_0x41553c(0xa7)]>0x0&&_0x352613[_0x41553c(0xac)](_0x27a67d);}const _0x48068c=_0x43543b[_0x28e7b8(0x14f)](_0x512216=>_0x1beb92(_0x512216));await Promise[_0x28e7b8(0xa2)](_0x48068c),_0x456429[_0x28e7b8(0x178)](_0x352613);}),module[a0_0x20bdbb(0x13d)]=router;