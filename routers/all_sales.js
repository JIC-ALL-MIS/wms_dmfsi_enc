var a0_0x24e10b=a0_0x1eef;function a0_0x1eef(_0x378dae,_0x1039b6){var _0x5711df=a0_0x5711();return a0_0x1eef=function(_0x1eefdd,_0x4fa560){_0x1eefdd=_0x1eefdd-0xd3;var _0x291ff2=_0x5711df[_0x1eefdd];return _0x291ff2;},a0_0x1eef(_0x378dae,_0x1039b6);}function a0_0x5711(){var _0x854d78=['<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','invoice','/invoice/:id','log','Hindi','$sale_product.bay','Spanish','$isAllowEdit','Return\x20Rooms','barcode\x20Product\x20master','get','\x20Order\x20Date\x20:\x20','getDate','quantity_notConverted','final','Enclosed','image','24qFpRth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','56294lWtNkN','/preview/:id','$finalize','True','master','product_details','/view/return_sales/:id','$product_details.rack','English','getMonth','name','<h5\x20style=\x22text-align:\x20left;\x22>','bin','$product_details.secondary_unit','$product_details.product_stock','delivery_code','catch','<html><head><title></title>','$product_details.invoice','actual_uom','edit_sales','English\x20(US)','<strong>\x20Regards\x20</strong>','password','<!DOCTYPE\x20html>','actual_qty','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.batch_code','date','/view/add_sales/:id','isAllowEdit','</td>','render','/upload/','sendMail','<tbody\x20style=\x22text-align:\x20center;\x22>','type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','sales_quantity','13zqttoy','warehouse_name','findById','level','warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','success','Arabic\x20(ae)','$product_details.production_date','types','/view/add_sale/product','customers_docs','$note','padStart','Level','$sale_product.floorlevel','redirect','string','<span\x20style=\x22float:\x20right;\x22>','$product_details._id','prod_cat','/all_sales/view','site_title','stock_data','<tr>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','unit','staff','slice','92110IaVKPi','return_data','$product_details.maxPerUnit','</tbody>','$return_data','$warehouse_name','room_name','22478880yeXLfD','carton','room','abs','$product_details.level','Return\x20Goods','$product_details.bay','11YEVSiY','map','stock','$product_details.product_name','$_id','/view/:id','Sales\x20Mail','An\x20error\x20occurred.','all_sales_barcode','</body></html>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.storage','back','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Chinese','product_code','$product_details.isle','Ambient','customers','Receiving\x20Area','Sale\x20Return','/all_sales/preview/','user','product_list','4243490GkgWVB','bay','prod_invoice','exports','</h5>','RoomAssigned','$customers_docs','storage','received_amount','length','Enabled','rack','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','save','amount','purchases_data','push','forEach','9pKlbhI','primary_code','$product_details.pallet','email','$product_details.bin','False','OUT-','max_per_unit','$product_details','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.product_code','$product_details.type','Portuguese','287770ljCjOg','$product_details.secondary_code','837207TJDtGt','status','quantity','all_sales','maxperunit','product_data','../models/all_models','currency','params','$room','</span>','$sale_product.type','delivery_date','Sales\x20Update\x20successfully','/view','post','$product','customer_data','foreach\x20newproduct','Sales\x20Add\x20successfully','find','role','$sale_product','errors','primary_unit','concat','Arabic','French','$product_details.product_cat','nodemailer','</head><body>','split','customer','/barcode_scanner','\x20Order\x20Number\x20:\x20','sale_qty','currency_placement','sale_product','1953nkpXVo','finalize','secondary_unit','json','$product_details.actual_uom','user_id','$sale_product.quantity','/../public','$product_details.primary_code','message','edit_sales_view','Shelves','$product_details.floorlevel','Floor','stocks','\x20</h2>','<h5>','all','sales\x20item\x20return\x20successfull','prod_code','Error\x20Occurs','toString','$product_details.expiry_date','production_date','sales\x20all_data','floorlevel','/view/add_sales','createTransport','$date','$name','Portuguese\x20(BR)','expiry_date','logo','requested_qty','body','Email\x20sent\x20successfully','</table>','error','16BnngxW','aggregate','filter','product_name','An\x20error\x20occurred\x20while\x20saving\x20data.','host','$invoice','Logo.png','flash','Raw\x20Materials','barcode\x20user_id','findOne','<h2>\x20','</div>','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','</tr>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','secondary_code','<div>','29336SXPpCn','/barcode/:id','express','$sale_product.bin','German','return_qty'];a0_0x5711=function(){return _0x854d78;};return a0_0x5711();}(function(_0x5e78c8,_0x57d1ee){var _0x6e7784=a0_0x1eef,_0x1f655c=_0x5e78c8();while(!![]){try{var _0x261aac=-parseInt(_0x6e7784(0x18d))/0x1+parseInt(_0x6e7784(0x144))/0x2*(parseInt(_0x6e7784(0x17d))/0x3)+-parseInt(_0x6e7784(0xd3))/0x4*(parseInt(_0x6e7784(0x18b))/0x5)+parseInt(_0x6e7784(0xfe))/0x6*(-parseInt(_0x6e7784(0x100))/0x7)+parseInt(_0x6e7784(0xe7))/0x8*(-parseInt(_0x6e7784(0x1b3))/0x9)+parseInt(_0x6e7784(0x16b))/0xa*(parseInt(_0x6e7784(0x152))/0xb)+parseInt(_0x6e7784(0x14b))/0xc*(parseInt(_0x6e7784(0x127))/0xd);if(_0x261aac===_0x57d1ee)break;else _0x1f655c['push'](_0x1f655c['shift']());}catch(_0x312698){_0x1f655c['push'](_0x1f655c['shift']());}}}(a0_0x5711,0x83f08));const express=require(a0_0x24e10b(0xe9)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x24e10b(0x193)),auth=require('../middleware/auth'),nodemailer=require(a0_0x24e10b(0x1aa)),users=require('../public/language/languages.json');router[a0_0x24e10b(0xf7)](a0_0x24e10b(0x19b),auth,async(_0x3fbfcf,_0x20f2cd)=>{var _0x47d0e9=a0_0x24e10b;try{const {username:_0x5e1ec9,email:_0x26ab4f,role:_0x164b11}=_0x3fbfcf[_0x47d0e9(0x169)],_0x1c5a91=_0x3fbfcf[_0x47d0e9(0x169)],_0x3865d0=await profile[_0x47d0e9(0xde)]({'email':_0x1c5a91['email']}),_0x110e3c=await master_shop[_0x47d0e9(0x1a1)]();let _0x5cd04c;if(_0x1c5a91['role']==_0x47d0e9(0x142)){const _0x1a49c4=await staff[_0x47d0e9(0xde)]({'email':_0x1c5a91[_0x47d0e9(0x180)]});_0x5cd04c=await sales[_0x47d0e9(0xd4)]([{'$lookup':{'from':_0x47d0e9(0x165),'localField':'customer','foreignField':_0x47d0e9(0x10a),'as':_0x47d0e9(0x132)}},{'$unwind':_0x47d0e9(0x171)},{'$unwind':_0x47d0e9(0x1a3)},{'$group':{'_id':_0x47d0e9(0x156),'invoice':{'$first':_0x47d0e9(0xd9)},'customers':{'$first':'$customer'},'date':{'$first':_0x47d0e9(0x1cf)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x47d0e9(0x133)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x47d0e9(0x171)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x47d0e9(0xea)},'type':{'$addToSet':_0x47d0e9(0x198)},'pallet':{'$addToSet':_0x47d0e9(0x136)},'finalize':{'$first':_0x47d0e9(0x102)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x5cd04c=await sales[_0x47d0e9(0xd4)]([{'$lookup':{'from':_0x47d0e9(0x165),'localField':_0x47d0e9(0x1ad),'foreignField':_0x47d0e9(0x10a),'as':_0x47d0e9(0x132)}},{'$unwind':'$customers_docs'},{'$unwind':_0x47d0e9(0x1a3)},{'$group':{'_id':_0x47d0e9(0x156),'invoice':{'$first':_0x47d0e9(0xd9)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x47d0e9(0x149)},'sale_product':{'$push':_0x47d0e9(0x1a3)},'note':{'$first':'$note'},'return_data':{'$first':_0x47d0e9(0x148)},'customers_docs':{'$first':_0x47d0e9(0x171)},'total_saleproduct_quantity':{'$sum':_0x47d0e9(0x1b9)},'level':{'$addToSet':_0x47d0e9(0xf2)},'isle':{'$addToSet':_0x47d0e9(0xea)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x47d0e9(0x136)},'finalize':{'$first':_0x47d0e9(0x102)},'isAllowEdit':{'$first':_0x47d0e9(0xf4)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x47d0e9(0xf0)](_0x47d0e9(0x1cb),_0x5cd04c);if(_0x110e3c[0x0][_0x47d0e9(0x186)]==_0x47d0e9(0x115)){var _0x494525=users['English'];console['log'](_0x494525);}else{if(_0x110e3c[0x0]['language']==_0x47d0e9(0xf1))var _0x494525=users[_0x47d0e9(0xf1)];else{if(_0x110e3c[0x0][_0x47d0e9(0x186)]==_0x47d0e9(0xeb))var _0x494525=users[_0x47d0e9(0xeb)];else{if(_0x110e3c[0x0][_0x47d0e9(0x186)]==_0x47d0e9(0xf3))var _0x494525=users['Spanish'];else{if(_0x110e3c[0x0]['language']==_0x47d0e9(0x1a8))var _0x494525=users['French'];else{if(_0x110e3c[0x0][_0x47d0e9(0x186)]==_0x47d0e9(0x1d1))var _0x494525=users[_0x47d0e9(0x18a)];else{if(_0x110e3c[0x0]['language']==_0x47d0e9(0x161))var _0x494525=users[_0x47d0e9(0x161)];else{if(_0x110e3c[0x0][_0x47d0e9(0x186)]==_0x47d0e9(0x12e))var _0x494525=users[_0x47d0e9(0x1a7)];}}}}}}}_0x20f2cd['render'](_0x47d0e9(0x190),{'success':_0x3fbfcf[_0x47d0e9(0xdb)](_0x47d0e9(0x12d)),'errors':_0x3fbfcf[_0x47d0e9(0xdb)](_0x47d0e9(0x1a4)),'sales':_0x5cd04c,'profile':_0x3865d0,'role':_0x1c5a91,'master_shop':_0x110e3c,'language':_0x494525});}catch(_0x44a564){console[_0x47d0e9(0xf0)](_0x44a564);}});async function getRandom8DigitNumber(){var _0x5c5b86=a0_0x24e10b;const _0x383eb7=0x989680,_0x2608d3=0x5f5e0ff,_0x819bbb=Math['floor'](Math['random']()*(_0x2608d3-_0x383eb7+0x1))+_0x383eb7;var _0x45764c;const _0x17748c=await sales[_0x5c5b86(0xde)]({'invoice':'OUT-'+_0x819bbb});return _0x17748c&&_0x17748c['length']>0x0?_0x45764c='OUT-'+_0x819bbb:_0x45764c=_0x5c5b86(0x183)+_0x819bbb,_0x45764c;}router['get'](a0_0x24e10b(0x1cd),auth,async(_0x309de2,_0x575ea8)=>{var _0x2aa7e9=a0_0x24e10b;try{const {username:_0x58925f,email:_0x40aceb,role:_0x1f0cb4}=_0x309de2['user'],_0x24cb6d=_0x309de2[_0x2aa7e9(0x169)],_0x98ed82=await profile['findOne']({'email':_0x24cb6d[_0x2aa7e9(0x180)]}),_0x15bf91=await master_shop[_0x2aa7e9(0x1a1)](),_0x3b7523=await customer[_0x2aa7e9(0x1a1)]({});let _0x3d52d7;if(_0x24cb6d['role']==_0x2aa7e9(0x142)){const _0x15febd=await staff[_0x2aa7e9(0xde)]({'email':_0x24cb6d[_0x2aa7e9(0x180)]});_0x3d52d7=await warehouse[_0x2aa7e9(0xd4)]([{'$match':{'status':'Enabled','name':_0x15febd[_0x2aa7e9(0x12b)],'warehouse_category':_0x2aa7e9(0xdc),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x2aa7e9(0x1d0)}}},{'$sort':{'name':0x1}}]);}else _0x3d52d7=await warehouse['aggregate']([{'$match':{'status':_0x2aa7e9(0x175),'warehouse_category':_0x2aa7e9(0xdc),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x2aa7e9(0x1d0),'name':{'$first':_0x2aa7e9(0x1d0)}}},{'$sort':{'name':0x1}}]);const _0x1d3457=await product[_0x2aa7e9(0x1a1)]({});var _0x47a54a=['Ambient',_0x2aa7e9(0xfc)];const _0x29124e=await sales[_0x2aa7e9(0x1a1)]({}),_0x1111af=_0x29124e[_0x2aa7e9(0x174)]+0x1,_0x240981=_0x2aa7e9(0x183)+_0x1111af[_0x2aa7e9(0x1c8)]()[_0x2aa7e9(0x134)](0x5,'0');if(_0x15bf91[0x0]['language']==_0x2aa7e9(0x115)){var _0x29b109=users[_0x2aa7e9(0x108)];console[_0x2aa7e9(0xf0)](_0x29b109);}else{if(_0x15bf91[0x0][_0x2aa7e9(0x186)]==_0x2aa7e9(0xf1))var _0x29b109=users[_0x2aa7e9(0xf1)];else{if(_0x15bf91[0x0][_0x2aa7e9(0x186)]==_0x2aa7e9(0xeb))var _0x29b109=users['German'];else{if(_0x15bf91[0x0][_0x2aa7e9(0x186)]=='Spanish')var _0x29b109=users[_0x2aa7e9(0xf3)];else{if(_0x15bf91[0x0][_0x2aa7e9(0x186)]=='French')var _0x29b109=users[_0x2aa7e9(0x1a8)];else{if(_0x15bf91[0x0][_0x2aa7e9(0x186)]==_0x2aa7e9(0x1d1))var _0x29b109=users[_0x2aa7e9(0x18a)];else{if(_0x15bf91[0x0][_0x2aa7e9(0x186)]==_0x2aa7e9(0x161))var _0x29b109=users['Chinese'];else{if(_0x15bf91[0x0]['language']==_0x2aa7e9(0x12e))var _0x29b109=users[_0x2aa7e9(0x1a7)];}}}}}}}const _0x121de0=getRandom8DigitNumber();_0x121de0['then'](_0x452277=>{var _0x55dab2=_0x2aa7e9;_0x575ea8[_0x55dab2(0x120)]('add_sales',{'success':_0x309de2[_0x55dab2(0xdb)](_0x55dab2(0x12d)),'errors':_0x309de2['flash'](_0x55dab2(0x1a4)),'role':_0x24cb6d,'profile':_0x98ed82,'customer':_0x3b7523,'warehouse':_0x3d52d7,'product':_0x1d3457,'invoice':_0x452277,'master_shop':_0x15bf91,'language':_0x29b109,'rooms_data':_0x47a54a});})[_0x2aa7e9(0x110)](_0x371b5e=>{var _0x49c093=_0x2aa7e9;_0x309de2['flash'](_0x49c093(0x1a4),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x575ea8[_0x49c093(0x137)](_0x49c093(0x13c));});}catch(_0x50a8a2){console['log'](_0x50a8a2);}}),router[a0_0x24e10b(0xf7)](a0_0x24e10b(0x11d),auth,async(_0x1fa19a,_0x4c541f)=>{var _0x57f55b=a0_0x24e10b;try{const _0x4fdb81=_0x1fa19a['params']['id'];console[_0x57f55b(0xf0)](_0x4fdb81);const _0x28edbf=await product['find'](),_0x346f14=await purchases[_0x57f55b(0xd4)]([{'$match':{'warehouse_name':_0x4fdb81}},{'$unwind':_0x57f55b(0x19d)},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x57f55b(0x17a),_0x346f14),_0x4c541f[_0x57f55b(0x18e)](0xc8)[_0x57f55b(0x1b6)]({'purchases_data':_0x346f14,'product_data':_0x28edbf});}catch(_0xaed326){console[_0x57f55b(0xf0)](_0xaed326);}}),router[a0_0x24e10b(0x19c)](a0_0x24e10b(0x131),auth,async(_0x32a447,_0x7f28d1)=>{var _0x314ad7=a0_0x24e10b;try{const {warehouse_data:_0x140070,product_data:_0x3e83b2}=_0x32a447['body'];console[_0x314ad7(0xf0)](_0x32a447['body'][_0x314ad7(0x192)]);;const _0x1c8d36=await master_shop[_0x314ad7(0x1a1)]();console[_0x314ad7(0xf0)](_0x314ad7(0x104),_0x1c8d36);const _0x476fb9=await product[_0x314ad7(0xde)]({'name':_0x3e83b2});console[_0x314ad7(0xf0)]('product',_0x476fb9);const _0x28f7c9=await warehouse[_0x314ad7(0xd4)]([{'$match':{'name':_0x140070}},{'$unwind':_0x314ad7(0x185)},{'$match':{'product_details.product_name':_0x3e83b2}},{'$group':{'_id':_0x314ad7(0x155),'product_stock':{'$first':_0x314ad7(0x10e)}}}]);console['log'](_0x314ad7(0x13e),_0x28f7c9),_0x7f28d1[_0x314ad7(0x18e)](0xc8)[_0x314ad7(0x1b6)]({'master':_0x1c8d36,'new_product':_0x476fb9,'stock_data':_0x28f7c9});}catch(_0xa5468c){console['log'](_0xa5468c);}}),router[a0_0x24e10b(0x19c)](a0_0x24e10b(0x1cd),auth,async(_0x3eb190,_0x2b472a)=>{var _0x30f331=a0_0x24e10b;try{const {invoice:_0x4c3688,date:_0x1416cc,warehouse_name:_0x104c82,product_name:_0x224ebc,stock:_0x24bfb3,quantity:_0x204e50,note:_0x47da76,room:_0x391fc6,primary_code:_0x4104d4,secondary_code:_0x5a213a,prod_code:_0x1a2d03,level:_0x4614c0,isle:_0x573292,pallet:_0x6076df,batch_code:_0x26b707,SCRN:_0x1cce67,expiry_date:_0x47ac5b}=_0x3eb190[_0x30f331(0x1d5)];if(typeof _0x224ebc=='string')var _0x8bf42e=[_0x3eb190['body'][_0x30f331(0xd6)]],_0x35396e=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x154)]],_0x29a978=[_0x3eb190[_0x30f331(0x1d5)]['carton']],_0x3c77f4=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x17e)]],_0x10ff9f=[_0x3eb190['body'][_0x30f331(0xe5)]],_0x4671ec=[_0x3eb190['body'][_0x30f331(0x1c6)]],_0x34b42f=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x12a)]],_0x2e8a14=[_0x3eb190[_0x30f331(0x1d5)]['primary_unit']],_0x6af848=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x1b5)]],_0x43a66c=[_0x3eb190['body'][_0x30f331(0xe1)]],_0x4961c8=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x1d2)]],_0x3f5008=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x184)]],_0x227f1b=[_0x3eb190['body']['production_date']],_0x2af082=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x1d4)]],_0x2de242=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x199)]],_0x2a4e9b=[_0x3eb190[_0x30f331(0x1d5)]['delivery_code']],_0x2f156b=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x13b)]],_0x5dcc71=[_0x3eb190['body']['quantity']],_0x5a35d3=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x170)]],_0x227847=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x16d)]],_0x3baf10=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x119)]],_0x2a76ec=[_0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x113)]];else var _0x8bf42e=[..._0x3eb190['body']['product_name']],_0x35396e=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x154)]],_0x29a978=[..._0x3eb190['body']['carton']],_0x3c77f4=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x17e)]],_0x10ff9f=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0xe5)]],_0x4671ec=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x1c6)]],_0x34b42f=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x12a)]],_0x2e8a14=[..._0x3eb190['body']['primary_unit']],_0x6af848=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x1b5)]],_0x43a66c=[..._0x3eb190[_0x30f331(0x1d5)]['batch_code']],_0x4961c8=[..._0x3eb190['body'][_0x30f331(0x1d2)]],_0x3f5008=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x184)]],_0x227f1b=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x1ca)]],_0x2af082=[..._0x3eb190['body'][_0x30f331(0x1d4)]],_0x2de242=[..._0x3eb190['body'][_0x30f331(0x199)]],_0x2a4e9b=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x10f)]],_0x2f156b=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x13b)]],_0x5dcc71=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x18f)]],_0x5a35d3=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x170)]],_0x227847=[..._0x3eb190[_0x30f331(0x1d5)][_0x30f331(0x16d)]],_0x3baf10=[..._0x3eb190[_0x30f331(0x1d5)]['actual_qty']],_0x2a76ec=[..._0x3eb190['body']['actual_uom']];const _0x5ab0e0=_0x8bf42e[_0x30f331(0x153)](_0x31d5e7=>{return _0x31d5e7={'product_name':_0x31d5e7};});_0x35396e[_0x30f331(0x17c)]((_0x19dde3,_0x3db476)=>{var _0x3bcb40=_0x30f331;_0x5ab0e0[_0x3db476][_0x3bcb40(0x154)]=Math[_0x3bcb40(0x14e)](_0x19dde3);}),_0x3baf10[_0x30f331(0x17c)]((_0x24b692,_0x53ba57)=>{var _0x295cc1=_0x30f331;_0x5ab0e0[_0x53ba57][_0x295cc1(0x119)]=Math[_0x295cc1(0x14e)](_0x24b692);}),_0x2a76ec[_0x30f331(0x17c)]((_0xb53a59,_0x4e9150)=>{var _0xe7a690=_0x30f331;_0x5ab0e0[_0x4e9150][_0xe7a690(0x113)]=_0xb53a59;}),_0x29a978[_0x30f331(0x17c)]((_0x56a5cd,_0x532d93)=>{var _0x423afa=_0x30f331;_0x5ab0e0[_0x532d93][_0x423afa(0x18f)]=_0x56a5cd;}),_0x3c77f4[_0x30f331(0x17c)]((_0x3c07b2,_0x5b2187)=>{var _0x52a17c=_0x30f331;_0x5ab0e0[_0x5b2187][_0x52a17c(0x17e)]=_0x3c07b2;}),_0x10ff9f[_0x30f331(0x17c)]((_0x167419,_0x5f0c4c)=>{_0x5ab0e0[_0x5f0c4c]['secondary_code']=_0x167419;}),_0x4671ec[_0x30f331(0x17c)]((_0x4c0913,_0x248ef2)=>{var _0x35b78b=_0x30f331;_0x5ab0e0[_0x248ef2][_0x35b78b(0x162)]=_0x4c0913;}),_0x34b42f['forEach']((_0x530329,_0x2df983)=>{_0x5a35d3['forEach']((_0x9d4a19,_0x4fbe05)=>{var _0x47b128=a0_0x1eef;if(_0x9d4a19==_0x47b128(0x166)&&_0x2df983==_0x4fbe05){var _0x3d20ad=_0x530329[_0x47b128(0x143)](0x3);_0x5ab0e0[_0x2df983][_0x47b128(0x172)]=_0x530329[0x0],_0x5ab0e0[_0x2df983][_0x47b128(0x176)]=_0x530329[0x1],_0x5ab0e0[_0x2df983][_0x47b128(0x16c)]=0x0,_0x5ab0e0[_0x2df983][_0x47b128(0x10c)]=0x0,_0x5ab0e0[_0x2df983][_0x47b128(0x124)]=_0x47b128(0x1c0),_0x5ab0e0[_0x2df983][_0x47b128(0x1cc)]=_0x3d20ad;}else{if(_0x9d4a19==_0x47b128(0x1be)&&_0x2df983==_0x4fbe05){var _0x3d20ad=_0x530329['slice'](0x3);_0x5ab0e0[_0x2df983][_0x47b128(0x172)]=_0x530329[0x0],_0x5ab0e0[_0x2df983]['rack']=_0x530329[0x1],_0x5ab0e0[_0x2df983]['bay']=0x0,_0x5ab0e0[_0x2df983][_0x47b128(0x10c)]=0x0,_0x5ab0e0[_0x2df983][_0x47b128(0x124)]='Floor',_0x5ab0e0[_0x2df983]['floorlevel']=_0x530329[0x5];}else{if(_0x2df983==_0x4fbe05){var _0x3d1036;if(_0x530329[0x4]=='L')_0x3d1036=_0x47b128(0x135);else _0x530329[0x4]=='F'&&(_0x3d1036=_0x47b128(0x1c0));_0x5ab0e0[_0x2df983][_0x47b128(0x172)]=_0x530329[0x0],_0x5ab0e0[_0x2df983]['rack']=_0x530329[0x1],_0x5ab0e0[_0x2df983][_0x47b128(0x16c)]=_0x530329[0x2],_0x5ab0e0[_0x2df983][_0x47b128(0x10c)]=_0x530329[0x3],_0x5ab0e0[_0x2df983][_0x47b128(0x124)]=_0x3d1036,_0x5ab0e0[_0x2df983][_0x47b128(0x1cc)]=_0x530329[0x5];}}}});}),_0x2e8a14[_0x30f331(0x17c)]((_0x2bc7a3,_0x170ae1)=>{var _0x5aa16a=_0x30f331;_0x5ab0e0[_0x170ae1][_0x5aa16a(0x141)]=_0x2bc7a3;}),_0x6af848[_0x30f331(0x17c)]((_0x104631,_0x37e8fd)=>{_0x5ab0e0[_0x37e8fd]['secondary_unit']=_0x104631;}),_0x43a66c[_0x30f331(0x17c)]((_0x7f053c,_0x5af784)=>{var _0x11e338=_0x30f331;_0x5ab0e0[_0x5af784][_0x11e338(0xe1)]=_0x7f053c;}),_0x4961c8[_0x30f331(0x17c)]((_0x446db0,_0x5c8ba5)=>{var _0x3c57e9=_0x30f331;_0x5ab0e0[_0x5c8ba5][_0x3c57e9(0x1d2)]=_0x446db0;}),_0x3f5008['forEach']((_0x3f6189,_0x15290c)=>{var _0x594ba4=_0x30f331;_0x5ab0e0[_0x15290c][_0x594ba4(0x191)]=_0x3f6189;}),_0x227f1b['forEach']((_0x833a8b,_0x247bbe)=>{var _0xa3ce76=_0x30f331;_0x5ab0e0[_0x247bbe][_0xa3ce76(0x1ca)]=_0x833a8b;}),_0x2af082[_0x30f331(0x17c)]((_0x1ca120,_0x4853fb)=>{var _0x58bf7f=_0x30f331;_0x5ab0e0[_0x4853fb][_0x58bf7f(0x1d4)]=_0x1ca120;}),_0x2de242[_0x30f331(0x17c)]((_0x254038,_0x492dc1)=>{var _0x3d7a06=_0x30f331;_0x5ab0e0[_0x492dc1][_0x3d7a06(0x199)]=_0x254038;}),_0x2a4e9b[_0x30f331(0x17c)]((_0x579282,_0x2cd663)=>{var _0x18d6f2=_0x30f331;_0x5ab0e0[_0x2cd663][_0x18d6f2(0x10f)]=_0x579282;}),_0x2f156b[_0x30f331(0x17c)]((_0x372a75,_0x105203)=>{_0x5ab0e0[_0x105203]['prod_cat']=_0x372a75;}),_0x5dcc71['forEach']((_0xffea65,_0x3b4886)=>{_0x5ab0e0[_0x3b4886]['quantity_notConverted']=_0xffea65;}),_0x5a35d3[_0x30f331(0x17c)]((_0x588c8b,_0x430141)=>{_0x5ab0e0[_0x430141]['room_name']=_0x588c8b;}),_0x227847['forEach']((_0x21796c,_0x51071d)=>{_0x5ab0e0[_0x51071d]['invoice']=_0x21796c;});var _0x50d5e8=0x0;_0x5ab0e0[_0x30f331(0x17c)](_0x1ea642=>{var _0x15c53a=_0x30f331;(_0x1ea642[_0x15c53a(0x154)]<_0x1ea642[_0x15c53a(0xfa)]||_0x1ea642['quantity_notConverted']==0x0)&&(console[_0x15c53a(0xf0)](_0x15c53a(0x19f),_0x1ea642),_0x50d5e8++);});const _0x16ed41=_0x5ab0e0['filter'](_0x58b19a=>_0x58b19a[_0x30f331(0x18f)]!=='0'&&_0x58b19a['quantity']!==''),_0x22ceae=new sales({'invoice':_0x4c3688,'customer':_0x3eb190['body'][_0x30f331(0x1ad)],'date':_0x1416cc,'warehouse_name':_0x104c82,'sale_product':_0x16ed41,'note':_0x47da76,'room':_0x391fc6,'primary_code':_0x4104d4,'secondary_code':_0x5a213a,'prod_code':_0x1a2d03,'SCRN':_0x1cce67}),_0x4e1136=await _0x22ceae[_0x30f331(0x178)]();_0x3eb190[_0x30f331(0xdb)](_0x30f331(0x12d),_0x30f331(0x1a0)),_0x2b472a[_0x30f331(0x137)](_0x30f331(0x168)+_0x4e1136['_id']);}catch(_0x23daa1){console[_0x30f331(0xf0)](_0x23daa1);}}),router[a0_0x24e10b(0xf7)](a0_0x24e10b(0x101),auth,async(_0x32b54f,_0x51f5c8)=>{var _0x1259ec=a0_0x24e10b;try{const {username:_0x1b4fe5,email:_0x539a7a,role:_0x16ecad}=_0x32b54f[_0x1259ec(0x169)],_0x5efe36=_0x32b54f[_0x1259ec(0x169)],_0x39af1c=await profile[_0x1259ec(0xde)]({'email':_0x5efe36['email']}),_0x327c46=await master_shop[_0x1259ec(0x1a1)](),_0x2764f7=_0x32b54f['params']['id'],_0x4d1250=await sales[_0x1259ec(0x129)](_0x2764f7),_0x20cdd4=await warehouse[_0x1259ec(0xd4)]([{'$match':{'name':_0x4d1250[_0x1259ec(0x128)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1259ec(0x13a),'name':{'$first':_0x1259ec(0x155)},'product_stock':{'$first':_0x1259ec(0x10e)},'bay':{'$first':_0x1259ec(0x151)},'bin':{'$first':_0x1259ec(0x181)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1259ec(0x1bf)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1259ec(0x18c)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x1259ec(0x15d)},'rack':{'$first':_0x1259ec(0x107)},'expiry_date':{'$first':_0x1259ec(0x1c9)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x1259ec(0x112)}}}]),_0x1b4043=await customer[_0x1259ec(0x1a1)]({});let _0x2943a0;if(_0x5efe36['role']==_0x1259ec(0x142)){const _0x3e5b3a=await staff[_0x1259ec(0xde)]({'email':_0x5efe36['email']});_0x2943a0=await warehouse[_0x1259ec(0xd4)]([{'$match':{'status':_0x1259ec(0x175),'name':_0x3e5b3a[_0x1259ec(0x12b)]}},{'$group':{'_id':_0x1259ec(0x1d0),'name':{'$first':'$name'}}}]);}else _0x2943a0=await warehouse[_0x1259ec(0xd4)]([{'$match':{'status':_0x1259ec(0x175)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x472dc1=await product[_0x1259ec(0x1a1)]({}),_0x51658e=await suppliers['find']({});if(_0x327c46[0x0]['language']==_0x1259ec(0x115)){var _0x383288=users[_0x1259ec(0x108)];console[_0x1259ec(0xf0)](_0x383288);}else{if(_0x327c46[0x0]['language']==_0x1259ec(0xf1))var _0x383288=users[_0x1259ec(0xf1)];else{if(_0x327c46[0x0][_0x1259ec(0x186)]==_0x1259ec(0xeb))var _0x383288=users[_0x1259ec(0xeb)];else{if(_0x327c46[0x0][_0x1259ec(0x186)]=='Spanish')var _0x383288=users['Spanish'];else{if(_0x327c46[0x0][_0x1259ec(0x186)]==_0x1259ec(0x1a8))var _0x383288=users[_0x1259ec(0x1a8)];else{if(_0x327c46[0x0][_0x1259ec(0x186)]==_0x1259ec(0x1d1))var _0x383288=users['Portuguese'];else{if(_0x327c46[0x0][_0x1259ec(0x186)]=='Chinese')var _0x383288=users[_0x1259ec(0x161)];else{if(_0x327c46[0x0][_0x1259ec(0x186)]==_0x1259ec(0x12e))var _0x383288=users[_0x1259ec(0x1a7)];}}}}}}}_0x51f5c8['render'](_0x1259ec(0x1bd),{'success':_0x32b54f[_0x1259ec(0xdb)](_0x1259ec(0x12d)),'errors':_0x32b54f[_0x1259ec(0xdb)](_0x1259ec(0x1a4)),'role':_0x5efe36,'profile':_0x39af1c,'customer':_0x1b4043,'warehouse':_0x2943a0,'product':_0x20cdd4,'user':_0x4d1250,'master_shop':_0x327c46,'unit':_0x472dc1,'language':_0x383288,'suppliers':_0x51658e});}catch(_0x354e3c){console[_0x1259ec(0xf0)](_0x354e3c);}}),router['post']('/preview/:id',auth,async(_0x43d69b,_0x213566)=>{var _0x576b74=a0_0x24e10b;try{const _0x299382=_0x43d69b[_0x576b74(0x195)]['id'],{invoice:_0x2255d1,warehouse_name:_0x138020,room:_0x558077}=_0x43d69b[_0x576b74(0x1d5)],_0x39b86c=await sales[_0x576b74(0xde)]({'invoice':_0x2255d1}),_0x11eb70=_0x39b86c['sale_product'][_0x576b74(0x153)](async _0x46bcd1=>{var _0x2e9554=_0x576b74,_0xbab3d7=await warehouse['findOne']({'name':_0x138020,'room':_0x46bcd1[_0x2e9554(0x14a)],'warehouse_category':'Raw\x20Materials'});const _0x5f10ed=_0xbab3d7[_0x2e9554(0x105)][_0x2e9554(0x153)](_0x33c460=>{var _0x559ca2=_0x2e9554;_0x33c460[_0x559ca2(0xd6)]==_0x46bcd1[_0x559ca2(0xd6)]&&_0x33c460[_0x559ca2(0x1cc)]==_0x46bcd1[_0x559ca2(0x1cc)]&&_0x33c460['type']==_0x46bcd1[_0x559ca2(0x124)]&&_0x33c460[_0x559ca2(0x10c)]==_0x46bcd1[_0x559ca2(0x10c)]&&_0x33c460[_0x559ca2(0x16c)]==_0x46bcd1['bay']&&_0x33c460[_0x559ca2(0x176)]==_0x46bcd1['rack']&&_0x33c460[_0x559ca2(0x172)]==_0x46bcd1[_0x559ca2(0x172)]&&_0x33c460['expiry_date']==_0x46bcd1[_0x559ca2(0x1d2)]&&_0x33c460[_0x559ca2(0xe1)]==_0x46bcd1[_0x559ca2(0xe1)]&&_0x33c460['invoice']==_0x46bcd1[_0x559ca2(0xee)]&&(_0x33c460[_0x559ca2(0x15f)]=Math[_0x559ca2(0x14e)](_0x33c460[_0x559ca2(0x15f)])-Math[_0x559ca2(0x14e)](_0x46bcd1['quantity']));});return _0xbab3d7;});Promise[_0x576b74(0x1c4)](_0x11eb70)['then'](async _0x346363=>{var _0x492128=_0x576b74;try{for(const _0x17e1b3 of _0x346363){await _0x17e1b3[_0x492128(0x178)]();}_0x39b86c[_0x492128(0x1b4)]=_0x492128(0x103);const _0xb0bbdc=await _0x39b86c[_0x492128(0x178)](),_0x230682=await master_shop[_0x492128(0x1a1)](),_0x42f5dd=await email_settings[_0x492128(0xde)](),_0x298a5c=await supervisor_settings[_0x492128(0x1a1)]();var _0x56b3ff=_0x39b86c[_0x492128(0x1b2)],_0x5a59d7='',_0x3e7231;for(_0x3e7231 in _0x56b3ff){_0x5a59d7+=_0x492128(0x13f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x56b3ff[_0x3e7231][_0x492128(0xd6)]+_0x492128(0x11f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x56b3ff[_0x3e7231][_0x492128(0x162)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x56b3ff[_0x3e7231]['quantity']+_0x492128(0x11f)+_0x492128(0xed)+_0x56b3ff[_0x3e7231]['unit']+_0x492128(0x11f)+_0x492128(0xed)+_0x56b3ff[_0x3e7231][_0x492128(0x1b5)]+_0x492128(0x11f)+_0x492128(0xed)+_0x39b86c[_0x492128(0x128)]+_0x492128(0x11f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x56b3ff[_0x3e7231]['room_name']+_0x492128(0x11f)+_0x492128(0xed)+_0x56b3ff[_0x3e7231][_0x492128(0x172)]+_0x56b3ff[_0x3e7231][_0x492128(0x176)]+_0x56b3ff[_0x3e7231][_0x492128(0x16c)]+_0x56b3ff[_0x3e7231][_0x492128(0x10c)]+_0x56b3ff[_0x3e7231]['type'][0x0]+_0x56b3ff[_0x3e7231][_0x492128(0x1cc)]+'</td>',_0x492128(0xe3);}let _0x22e844=nodemailer[_0x492128(0x1ce)]({'host':_0x42f5dd[_0x492128(0xd8)],'port':Number(_0x42f5dd['port']),'secure':![],'auth':{'user':_0x42f5dd[_0x492128(0x180)],'pass':_0x42f5dd[_0x492128(0x117)]}}),_0x461308={'from':_0x42f5dd[_0x492128(0x180)],'to':_0x298a5c[0x0]['RMSEmail'],'subject':_0x492128(0x158),'attachments':[{'filename':_0x492128(0xda),'path':__dirname+_0x492128(0x1ba)+_0x492128(0x121)+_0x230682[0x0][_0x492128(0xfd)],'cid':_0x492128(0x1d3)}],'html':_0x492128(0x118)+_0x492128(0x111)+_0x492128(0x1ab)+'<div>'+_0x492128(0x15c)+_0x492128(0xe6)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x492128(0xe0)+_0x492128(0xe6)+_0x492128(0xdf)+_0x230682[0x0][_0x492128(0x13d)]+_0x492128(0x1c2)+_0x492128(0xe0)+_0x492128(0xe0)+'<hr\x20class=\x22my-3\x22>'+_0x492128(0xe6)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x39b86c[_0x492128(0xee)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x492128(0xf8)+_0x39b86c[_0x492128(0x11c)]+'\x20'+_0x492128(0x197)+'</h5>'+_0x492128(0xe0)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x492128(0x13f)+_0x492128(0x160)+_0x492128(0x187)+_0x492128(0x125)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x492128(0x12c)+_0x492128(0xe2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x492128(0xff)+'</tr>'+'</thead>'+_0x492128(0x123)+'\x20'+_0x5a59d7+'\x20'+_0x492128(0x147)+_0x492128(0x1d7)+'<div>'+_0x492128(0x116)+_0x492128(0x1c3)+_0x230682[0x0][_0x492128(0x13d)]+'</h5>'+_0x492128(0xe0)+'</div>'+'</body></html>'};_0x22e844[_0x492128(0x122)](_0x461308,function(_0x24feb5,_0x192128){var _0x350d43=_0x492128;_0x24feb5?(console[_0x350d43(0xf0)](_0x24feb5),console['log'](_0x350d43(0x1c7))):console[_0x350d43(0xf0)](_0x350d43(0x1d6));}),_0x43d69b[_0x492128(0xdb)](_0x492128(0x12d),'Sales\x20Update\x20successfully'),_0x213566['redirect'](_0x492128(0x168)+_0x299382);}catch(_0x56ed2e){console[_0x492128(0x1d8)](_0x56ed2e),_0x213566[_0x492128(0x18e)](0x1f4)[_0x492128(0x1b6)]({'error':_0x492128(0xd7)});}})['catch'](_0xb3e7a5=>{var _0x5c75f2=_0x576b74;console[_0x5c75f2(0x1d8)](_0xb3e7a5),_0x213566[_0x5c75f2(0x18e)](0x1f4)['json']({'error':_0x5c75f2(0x159)});});}catch(_0x5a29cc){console[_0x576b74(0xf0)](_0x5a29cc);}}),router[a0_0x24e10b(0xf7)](a0_0x24e10b(0x157),auth,async(_0x4165ba,_0x64202b)=>{var _0x329d0a=a0_0x24e10b;try{const {username:_0x6544fa,email:_0x483f23,role:_0xdb4838}=_0x4165ba[_0x329d0a(0x169)],_0x4678b8=_0x4165ba['user'],_0x776b4=await profile['findOne']({'email':_0x4678b8[_0x329d0a(0x180)]}),_0x874178=await master_shop['find'](),_0x3fdda7=_0x4165ba[_0x329d0a(0x195)]['id'],_0x2b0464=await sales[_0x329d0a(0x129)](_0x3fdda7);var _0x1467fd=[_0x329d0a(0x164),_0x329d0a(0xfc)];const _0x35c359=await warehouse[_0x329d0a(0xd4)]([{'$match':{'name':_0x2b0464[_0x329d0a(0x128)],'warehouse_category':_0x329d0a(0xdc)}},{'$unwind':_0x329d0a(0x185)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x329d0a(0x155)},'product_stock':{'$first':_0x329d0a(0x10e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x329d0a(0x189)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x329d0a(0x1bb)},'secondary_code':{'$first':_0x329d0a(0x18c)},'product_code':{'$first':_0x329d0a(0x188)},'storage':{'$first':_0x329d0a(0x15d)},'rack':{'$first':_0x329d0a(0x107)}}}]),_0x57e291=await customer[_0x329d0a(0x1a1)]({});let _0x3fdb93;if(_0x4678b8[_0x329d0a(0x1a2)]==_0x329d0a(0x142)){const _0x416d14=await staff['findOne']({'email':_0x4678b8[_0x329d0a(0x180)]});_0x3fdb93=await warehouse['aggregate']([{'$match':{'status':_0x329d0a(0x175),'name':_0x416d14[_0x329d0a(0x12b)],'warehouse_category':_0x329d0a(0xdc)}},{'$group':{'_id':_0x329d0a(0x1d0),'name':{'$first':'$name'}}}]);}else _0x3fdb93=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x329d0a(0xdc)}},{'$group':{'_id':_0x329d0a(0x1d0),'name':{'$first':_0x329d0a(0x1d0)}}}]);const _0x4f039b=await product['find']({});if(_0x874178[0x0][_0x329d0a(0x186)]=='English\x20(US)'){var _0x5a6005=users[_0x329d0a(0x108)];console[_0x329d0a(0xf0)](_0x5a6005);}else{if(_0x874178[0x0][_0x329d0a(0x186)]==_0x329d0a(0xf1))var _0x5a6005=users[_0x329d0a(0xf1)];else{if(_0x874178[0x0][_0x329d0a(0x186)]==_0x329d0a(0xeb))var _0x5a6005=users[_0x329d0a(0xeb)];else{if(_0x874178[0x0]['language']==_0x329d0a(0xf3))var _0x5a6005=users[_0x329d0a(0xf3)];else{if(_0x874178[0x0][_0x329d0a(0x186)]==_0x329d0a(0x1a8))var _0x5a6005=users[_0x329d0a(0x1a8)];else{if(_0x874178[0x0][_0x329d0a(0x186)]==_0x329d0a(0x1d1))var _0x5a6005=users[_0x329d0a(0x18a)];else{if(_0x874178[0x0][_0x329d0a(0x186)]=='Chinese')var _0x5a6005=users['Chinese'];else{if(_0x874178[0x0]['language']=='Arabic\x20(ae)')var _0x5a6005=users[_0x329d0a(0x1a7)];}}}}}}}_0x64202b[_0x329d0a(0x120)](_0x329d0a(0x114),{'success':_0x4165ba[_0x329d0a(0xdb)]('success'),'errors':_0x4165ba['flash'](_0x329d0a(0x1a4)),'role':_0x4678b8,'profile':_0x776b4,'customer':_0x57e291,'warehouse':_0x3fdb93,'product':_0x35c359,'user':_0x2b0464,'master_shop':_0x874178,'unit':_0x4f039b,'language':_0x5a6005});}catch(_0x3e9225){console[_0x329d0a(0xf0)](_0x3e9225);}}),router['post'](a0_0x24e10b(0x157),auth,async(_0x4558c1,_0x28f08e)=>{var _0x19bcca=a0_0x24e10b;try{const _0x41dcb5=_0x4558c1[_0x19bcca(0x195)]['id'],_0x253dc6=await sales['findOne']({'_id':_0x4558c1[_0x19bcca(0x195)]['id']}),_0x47d7e0=await warehouse[_0x19bcca(0xde)]({'name':_0x253dc6[_0x19bcca(0x128)],'room':_0x4558c1['body'][_0x19bcca(0x14d)]}),{invoice:_0x2945cc,date:_0x5574cf,warehouse_name:_0xc88191,product_name:_0x857d63,stock:_0x437942,quantity:_0x2869e1,note:_0x240c75,room:_0x4e11f4,customer:_0x55ddd6,SCRN:_0x1c62ea}=_0x4558c1[_0x19bcca(0x1d5)];if(typeof _0x857d63==_0x19bcca(0x138))var _0x64a8dd=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0xd6)]],_0x195b8f=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x154)]],_0x472171=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x14c)]],_0x1ee937=[_0x4558c1['body'][_0x19bcca(0x17e)]],_0x306560=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0xe5)]],_0x685788=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x1c6)]],_0x16ea92=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x12a)]],_0x565da0=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x1a5)]],_0x54fd51=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x1b5)]],_0x5bf21a=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0xe1)]],_0x3be853=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x1d2)]],_0x502e7c=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x184)]],_0x5cbcbf=[_0x4558c1['body'][_0x19bcca(0x1ca)]],_0x30a900=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x1d4)]],_0x221955=[_0x4558c1['body']['delivery_date']],_0x5e945f=[_0x4558c1[_0x19bcca(0x1d5)]['delivery_code']],_0x76b7ef=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x13b)]],_0x446ec5=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x18f)]],_0x4cee86=[_0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x170)]];else var _0x64a8dd=[..._0x4558c1['body']['product_name']],_0x195b8f=[..._0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x154)]],_0x472171=[..._0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x14c)]],_0x1ee937=[..._0x4558c1[_0x19bcca(0x1d5)]['primary_code']],_0x306560=[..._0x4558c1['body'][_0x19bcca(0xe5)]],_0x685788=[..._0x4558c1['body'][_0x19bcca(0x1c6)]],_0x16ea92=[..._0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x12a)]],_0x565da0=[..._0x4558c1['body'][_0x19bcca(0x1a5)]],_0x54fd51=[..._0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x1b5)]],_0x5bf21a=[..._0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0xe1)]],_0x3be853=[..._0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x1d2)]],_0x502e7c=[..._0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x184)]],_0x5cbcbf=[..._0x4558c1['body'][_0x19bcca(0x1ca)]],_0x30a900=[..._0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x1d4)]],_0x221955=[..._0x4558c1[_0x19bcca(0x1d5)]['delivery_date']],_0x5e945f=[..._0x4558c1[_0x19bcca(0x1d5)]['delivery_code']],_0x76b7ef=[..._0x4558c1[_0x19bcca(0x1d5)][_0x19bcca(0x13b)]],_0x446ec5=[..._0x4558c1['body'][_0x19bcca(0x18f)]],_0x4cee86=[..._0x4558c1[_0x19bcca(0x1d5)]['RoomAssigned']];const _0x26ff6a=_0x64a8dd['map'](_0x4730cd=>{return _0x4730cd={'product_name':_0x4730cd};});_0x195b8f[_0x19bcca(0x17c)]((_0x33fae0,_0x559d76)=>{var _0xcaf839=_0x19bcca;_0x26ff6a[_0x559d76][_0xcaf839(0x154)]=Math[_0xcaf839(0x14e)](_0x33fae0);}),_0x472171[_0x19bcca(0x17c)]((_0xc97d47,_0x22fdd1)=>{var _0x11f567=_0x19bcca;_0x26ff6a[_0x22fdd1][_0x11f567(0x18f)]=_0xc97d47;}),_0x1ee937[_0x19bcca(0x17c)]((_0x2a0660,_0x266ead)=>{_0x26ff6a[_0x266ead]['primary_code']=_0x2a0660;}),_0x306560[_0x19bcca(0x17c)]((_0x1445fb,_0x2d6103)=>{_0x26ff6a[_0x2d6103]['secondary_code']=_0x1445fb;}),_0x685788[_0x19bcca(0x17c)]((_0x2e9e61,_0x3e8087)=>{var _0x1b7a49=_0x19bcca;_0x26ff6a[_0x3e8087][_0x1b7a49(0x162)]=_0x2e9e61;}),_0x16ea92[_0x19bcca(0x17c)]((_0x16718c,_0x1f265b)=>{var _0x3102f5=_0x19bcca;_0x4cee86[_0x3102f5(0x17c)]((_0x421be2,_0x5b2527)=>{var _0x34b8d7=_0x3102f5;if(_0x421be2==_0x34b8d7(0x166)&&_0x1f265b==_0x5b2527){var _0xf115c0=_0x16718c[_0x34b8d7(0x143)](0x3);_0x26ff6a[_0x1f265b][_0x34b8d7(0x172)]=_0x16718c[0x0],_0x26ff6a[_0x1f265b][_0x34b8d7(0x176)]=_0x16718c[0x1],_0x26ff6a[_0x1f265b]['bay']=0x0,_0x26ff6a[_0x1f265b][_0x34b8d7(0x10c)]=0x0,_0x26ff6a[_0x1f265b]['type']=_0x34b8d7(0x1c0),_0x26ff6a[_0x1f265b][_0x34b8d7(0x1cc)]=_0xf115c0;}else{if(_0x421be2==_0x34b8d7(0x1be)&&_0x1f265b==_0x5b2527){var _0xf115c0=_0x16718c[_0x34b8d7(0x143)](0x3);_0x26ff6a[_0x1f265b][_0x34b8d7(0x172)]=_0x16718c[0x0],_0x26ff6a[_0x1f265b][_0x34b8d7(0x176)]=_0x16718c[0x1],_0x26ff6a[_0x1f265b][_0x34b8d7(0x16c)]=0x0,_0x26ff6a[_0x1f265b][_0x34b8d7(0x10c)]=0x0,_0x26ff6a[_0x1f265b][_0x34b8d7(0x124)]=_0x34b8d7(0x1c0),_0x26ff6a[_0x1f265b][_0x34b8d7(0x1cc)]=_0x16718c[0x5];}else{if(_0x1f265b==_0x5b2527){var _0x128baa;if(_0x16718c[0x4]=='L')_0x128baa=_0x34b8d7(0x135);else _0x16718c[0x4]=='F'&&(_0x128baa='Floor');_0x26ff6a[_0x1f265b][_0x34b8d7(0x172)]=_0x16718c[0x0],_0x26ff6a[_0x1f265b][_0x34b8d7(0x176)]=_0x16718c[0x1],_0x26ff6a[_0x1f265b]['bay']=_0x16718c[0x2],_0x26ff6a[_0x1f265b][_0x34b8d7(0x10c)]=_0x16718c[0x3],_0x26ff6a[_0x1f265b][_0x34b8d7(0x124)]=_0x128baa,_0x26ff6a[_0x1f265b][_0x34b8d7(0x1cc)]=_0x16718c[0x5];}}}});}),_0x565da0['forEach']((_0x2f03a3,_0x10506b)=>{var _0x5d8ba2=_0x19bcca;_0x26ff6a[_0x10506b][_0x5d8ba2(0x141)]=_0x2f03a3;}),_0x54fd51[_0x19bcca(0x17c)]((_0x2b5a32,_0x3d0bd7)=>{var _0x46c2d5=_0x19bcca;_0x26ff6a[_0x3d0bd7][_0x46c2d5(0x1b5)]=_0x2b5a32;}),_0x5bf21a[_0x19bcca(0x17c)]((_0x26d2a6,_0x2f9941)=>{var _0x59b561=_0x19bcca;_0x26ff6a[_0x2f9941][_0x59b561(0xe1)]=_0x26d2a6;}),_0x3be853[_0x19bcca(0x17c)]((_0x27b8dc,_0xf006ed)=>{var _0x76a909=_0x19bcca;_0x26ff6a[_0xf006ed][_0x76a909(0x1d2)]=_0x27b8dc;}),_0x502e7c[_0x19bcca(0x17c)]((_0xf696f2,_0x31d08b)=>{_0x26ff6a[_0x31d08b]['maxperunit']=_0xf696f2;}),_0x5cbcbf[_0x19bcca(0x17c)]((_0x41daa2,_0x27aace)=>{var _0x299ecd=_0x19bcca;_0x26ff6a[_0x27aace][_0x299ecd(0x1ca)]=_0x41daa2;}),_0x30a900[_0x19bcca(0x17c)]((_0x220771,_0x43a7f3)=>{var _0x301623=_0x19bcca;_0x26ff6a[_0x43a7f3][_0x301623(0x1d4)]=Math['abs'](_0x220771);}),_0x221955[_0x19bcca(0x17c)]((_0x3f996e,_0x186eab)=>{var _0x194d1d=_0x19bcca;_0x26ff6a[_0x186eab][_0x194d1d(0x199)]=_0x3f996e;}),_0x5e945f['forEach']((_0x31416b,_0x3d71ad)=>{_0x26ff6a[_0x3d71ad]['delivery_code']=_0x31416b;}),_0x76b7ef['forEach']((_0x587352,_0x276fb0)=>{var _0x18efbd=_0x19bcca;_0x26ff6a[_0x276fb0][_0x18efbd(0x13b)]=_0x587352;}),_0x446ec5[_0x19bcca(0x17c)]((_0x21ca5c,_0x26fdc7)=>{var _0x2038d9=_0x19bcca;_0x26ff6a[_0x26fdc7][_0x2038d9(0xfa)]=_0x21ca5c;}),_0x4cee86[_0x19bcca(0x17c)]((_0x2d7ee0,_0x1fa983)=>{_0x26ff6a[_0x1fa983]['room_name']=_0x2d7ee0;});var _0x4804f2=0x0;_0x26ff6a[_0x19bcca(0x17c)](_0x30bd2d=>{var _0x50eacb=_0x19bcca;console[_0x50eacb(0xf0)](_0x50eacb(0x19f),_0x30bd2d),(parseInt(_0x30bd2d['stock'])<parseInt(_0x30bd2d[_0x50eacb(0x18f)])||parseInt(_0x30bd2d[_0x50eacb(0x18f)])==0x0)&&_0x4804f2++;});if(_0x4804f2!=0x0)return _0x4558c1['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x28f08e[_0x19bcca(0x137)](_0x19bcca(0x15e));const _0x4e0589=_0x26ff6a[_0x19bcca(0xd5)](_0x4d4c15=>_0x4d4c15[_0x19bcca(0x18f)]!=='0'&&_0x4d4c15[_0x19bcca(0x18f)]!=='');_0x253dc6[_0x19bcca(0xee)]=_0x2945cc,_0x253dc6['customer']=_0x55ddd6,_0x253dc6['date']=_0x5574cf,_0x253dc6[_0x19bcca(0x128)]=_0xc88191,_0x253dc6[_0x19bcca(0x1b2)]=_0x4e0589,_0x253dc6['note']=_0x240c75,_0x253dc6['SCRN']=_0x1c62ea,_0x253dc6[_0x19bcca(0x1b4)]=_0x19bcca(0x182),_0x253dc6[_0x19bcca(0x11e)]=_0x19bcca(0x182);const _0x45f635=await _0x253dc6[_0x19bcca(0x178)]();_0x4558c1[_0x19bcca(0xdb)]('success',_0x19bcca(0x19a)),_0x28f08e[_0x19bcca(0x137)](_0x19bcca(0x13c));}catch(_0x42cd60){console[_0x19bcca(0xf0)](_0x42cd60);}}),router['post']('/give_payment/:id',auth,async(_0x3e1bfe,_0x29f750)=>{var _0x4dd30b=a0_0x24e10b;try{const _0x39afdc=_0x3e1bfe[_0x4dd30b(0x195)]['id'],{invoice:_0x8550af,customer:_0x428b4f,receivable_amount:_0x5c2d9c,received_amount:_0x42baa9}=_0x3e1bfe[_0x4dd30b(0x1d5)],_0xf3b168=await sales[_0x4dd30b(0x129)](_0x39afdc);console[_0x4dd30b(0xf0)](_0xf3b168);var _0x4b68ad=_0x5c2d9c-_0x42baa9;console[_0x4dd30b(0xf0)](_0x42baa9),_0xf3b168[_0x4dd30b(0x173)]=parseFloat(_0x42baa9)+parseFloat(_0xf3b168[_0x4dd30b(0x173)]),_0xf3b168['due_amount']=_0x4b68ad,console['log'](_0xf3b168);const _0x38cca4=await _0xf3b168[_0x4dd30b(0x178)](),_0x1a3505=await c_payment_data['findOne']({'invoice':_0x8550af});_0x1a3505[_0x4dd30b(0x179)]=_0x4b68ad,await _0x1a3505[_0x4dd30b(0x178)]();let _0x47ee37=new Date(),_0x3da68f=('0'+_0x47ee37[_0x4dd30b(0xf9)]())[_0x4dd30b(0x143)](-0x2),_0x3f28a2=('0'+(_0x47ee37[_0x4dd30b(0x109)]()+0x1))['slice'](-0x2),_0x3b6fe4=_0x47ee37['getFullYear'](),_0xe65d1a=_0x3b6fe4+'-'+_0x3f28a2+'-'+_0x3da68f;const _0x3c9daa=new customer_payment({'invoice':_0x8550af,'date':_0x3b6fe4+'-'+_0x3f28a2+'-'+_0x3da68f,'customer':_0x428b4f,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x42baa9}),_0x4d32a8=await _0x3c9daa[_0x4dd30b(0x178)]();_0x3e1bfe[_0x4dd30b(0xdb)](_0x4dd30b(0x12d),'payment\x20successfull'),_0x29f750[_0x4dd30b(0x137)]('/all_sales/view');}catch(_0x49f582){console[_0x4dd30b(0xf0)](_0x49f582);}}),router[a0_0x24e10b(0xf7)](a0_0x24e10b(0xef),auth,async(_0x538124,_0x295c3b)=>{var _0x3447d8=a0_0x24e10b;try{const {username:_0x161063,email:_0x32f5d8,role:_0x3d340e}=_0x538124['user'],_0x4d6890=_0x538124[_0x3447d8(0x169)],_0xec698d=await profile['findOne']({'email':_0x4d6890['email']}),_0x1307a4=await master_shop[_0x3447d8(0x1a1)]();console['log']('master',_0x1307a4);const _0x4b0c34=_0x538124[_0x3447d8(0x195)]['id'],_0x10781e=await sales['findById'](_0x4b0c34);console[_0x3447d8(0xf0)](_0x10781e);const _0x1f4dcc=await customer[_0x3447d8(0xde)]({'name':_0x10781e['customer']});console[_0x3447d8(0xf0)](_0x1f4dcc);if(_0x1307a4[0x0][_0x3447d8(0x186)]==_0x3447d8(0x115)){var _0x1b37a5=users[_0x3447d8(0x108)];console['log'](_0x1b37a5);}else{if(_0x1307a4[0x0][_0x3447d8(0x186)]==_0x3447d8(0xf1))var _0x1b37a5=users[_0x3447d8(0xf1)];else{if(_0x1307a4[0x0][_0x3447d8(0x186)]==_0x3447d8(0xeb))var _0x1b37a5=users[_0x3447d8(0xeb)];else{if(_0x1307a4[0x0]['language']=='Spanish')var _0x1b37a5=users['Spanish'];else{if(_0x1307a4[0x0][_0x3447d8(0x186)]==_0x3447d8(0x1a8))var _0x1b37a5=users['French'];else{if(_0x1307a4[0x0][_0x3447d8(0x186)]==_0x3447d8(0x1d1))var _0x1b37a5=users[_0x3447d8(0x18a)];else{if(_0x1307a4[0x0]['language']==_0x3447d8(0x161))var _0x1b37a5=users[_0x3447d8(0x161)];else{if(_0x1307a4[0x0][_0x3447d8(0x186)]==_0x3447d8(0x12e))var _0x1b37a5=users[_0x3447d8(0x1a7)];}}}}}}}_0x295c3b['render']('sales_invoice',{'success':_0x538124[_0x3447d8(0xdb)](_0x3447d8(0x12d)),'errors':_0x538124['flash']('errors'),'role':_0x4d6890,'profile':_0xec698d,'master_shop':_0x1307a4,'customers':_0x1f4dcc,'sales':_0x10781e,'language':_0x1b37a5});}catch(_0x5d6bca){console[_0x3447d8(0xf0)](_0x5d6bca);}}),router[a0_0x24e10b(0xf7)](a0_0x24e10b(0x106),auth,async(_0x58f718,_0x19e53a)=>{var _0x47ba80=a0_0x24e10b;try{const {username:_0x2668ca,email:_0x57b22b,role:_0x454465}=_0x58f718[_0x47ba80(0x169)],_0x2930b4=_0x58f718[_0x47ba80(0x169)],_0x49a5d7=await profile[_0x47ba80(0xde)]({'email':_0x2930b4['email']}),_0x326889=await master_shop['find']();console[_0x47ba80(0xf0)](_0x47ba80(0x104),_0x326889);const _0x1e71b3=_0x58f718[_0x47ba80(0x195)]['id'];console[_0x47ba80(0xf0)](_0x1e71b3);const _0x26f617=await sales[_0x47ba80(0x129)](_0x1e71b3);console[_0x47ba80(0xf0)](_0x47ba80(0x1b8),_0x26f617);const _0xbf8ff=await warehouse[_0x47ba80(0xd4)]([{'$match':{'name':_0x47ba80(0x150),'room':_0x47ba80(0xf5)}},{'$unwind':_0x47ba80(0x185)},{'$group':{'_id':_0x47ba80(0x13a),'name':{'$first':_0x47ba80(0x155)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x47ba80(0x14f)},'isle':{'$first':_0x47ba80(0x163)},'pallet':{'$first':_0x47ba80(0x17f)},'primary_code':{'$first':_0x47ba80(0x1bb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x47ba80(0xf0)](_0x47ba80(0x13e),_0xbf8ff);const _0x481f4c=await product[_0x47ba80(0x1a1)]({});warehouse_data=await warehouse[_0x47ba80(0xd4)]([{'$match':{'status':'Enabled','name':_0x47ba80(0x150),'warehouse_category':_0x47ba80(0xdc)}},{'$group':{'_id':_0x47ba80(0x1d0),'name':{'$first':_0x47ba80(0x1d0)}}},{'$sort':{'name':0x1}}]);var _0x370f44=[_0x47ba80(0xf5)];if(_0x326889[0x0][_0x47ba80(0x186)]=='English\x20(US)'){var _0x4c6d66=users[_0x47ba80(0x108)];console[_0x47ba80(0xf0)](_0x4c6d66);}else{if(_0x326889[0x0][_0x47ba80(0x186)]==_0x47ba80(0xf1))var _0x4c6d66=users[_0x47ba80(0xf1)];else{if(_0x326889[0x0][_0x47ba80(0x186)]=='German')var _0x4c6d66=users[_0x47ba80(0xeb)];else{if(_0x326889[0x0][_0x47ba80(0x186)]=='Spanish')var _0x4c6d66=users['Spanish'];else{if(_0x326889[0x0][_0x47ba80(0x186)]==_0x47ba80(0x1a8))var _0x4c6d66=users[_0x47ba80(0x1a8)];else{if(_0x326889[0x0][_0x47ba80(0x186)]=='Portuguese\x20(BR)')var _0x4c6d66=users[_0x47ba80(0x18a)];else{if(_0x326889[0x0][_0x47ba80(0x186)]==_0x47ba80(0x161))var _0x4c6d66=users['Chinese'];else{if(_0x326889[0x0]['language']=='Arabic\x20(ae)')var _0x4c6d66=users['Arabic'];}}}}}}}_0x19e53a[_0x47ba80(0x120)]('return_sale',{'success':_0x58f718[_0x47ba80(0xdb)](_0x47ba80(0x12d)),'errors':_0x58f718['flash'](_0x47ba80(0x1a4)),'role':_0x2930b4,'profile':_0x49a5d7,'user':_0x26f617,'stock':_0xbf8ff,'master_shop':_0x326889,'unit':_0x481f4c,'language':_0x4c6d66,'warehouses':warehouse_data,'rooms':_0x370f44});}catch(_0x31047b){console[_0x47ba80(0xf0)](_0x31047b),_0x19e53a['status'](0xc8)[_0x47ba80(0x1b6)]({'message':_0x31047b['message']});}}),router[a0_0x24e10b(0x19c)](a0_0x24e10b(0x106),auth,async(_0x20d55c,_0x14ed79)=>{var _0x3cbdfc=a0_0x24e10b;try{const {invoice:_0xdeb35,date:_0x5ef219,warehouse_name:_0x3c8375,product_name:_0x29ac2d,primary_code:_0xf660af,secondary_code:_0x4072c6,product_code:_0x6aef11,sales_quantity:_0x155977,stocks:_0x2d6e33,return_qty:_0x3272aa,Room_name:_0x55d942,to_warehouse_name:_0x2694b0,to_Roomname:_0x9231c0,to_Room_name:_0x2f8df5,note:_0x2a58c4,level:_0x815da2,isle:_0x7b3deb,pallet:_0xc0547c}=_0x20d55c[_0x3cbdfc(0x1d5)];if(typeof _0x29ac2d==_0x3cbdfc(0x138))var _0x462cd3=[_0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0xd6)]],_0x4145d1=[_0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x17e)]],_0x4dc44d=[_0x20d55c['body'][_0x3cbdfc(0xe5)]],_0x4fc844=[_0x20d55c['body'][_0x3cbdfc(0x162)]],_0x8b9db9=[_0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x126)]],_0x56c292=[_0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x1c1)]],_0x1a32a7=[_0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0xec)]],_0x28af66=[_0x20d55c['body'][_0x3cbdfc(0x16c)]],_0x5728bf=[_0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x10c)]],_0x550598=[_0x20d55c['body']['types']],_0x17102d=[_0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x1cc)]];else var _0x462cd3=[..._0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0xd6)]],_0x4145d1=[..._0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x17e)]],_0x4dc44d=[..._0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0xe5)]],_0x4fc844=[..._0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x162)]],_0x8b9db9=[..._0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x126)]],_0x56c292=[..._0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x1c1)]],_0x1a32a7=[..._0x20d55c['body']['return_qty']],_0x28af66=[..._0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x16c)]],_0x5728bf=[..._0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x10c)]],_0x550598=[..._0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x130)]],_0x17102d=[..._0x20d55c['body'][_0x3cbdfc(0x1cc)]];const _0x504290=_0x462cd3['map'](_0x3fba6d=>{return _0x3fba6d={'product_name':_0x3fba6d};});_0x4145d1[_0x3cbdfc(0x17c)]((_0x503406,_0x5361d0)=>{var _0x4aea87=_0x3cbdfc;_0x504290[_0x5361d0][_0x4aea87(0x17e)]=_0x503406;}),_0x4dc44d[_0x3cbdfc(0x17c)]((_0x60df89,_0x28505d)=>{var _0x4977cb=_0x3cbdfc;_0x504290[_0x28505d][_0x4977cb(0xe5)]=_0x60df89;}),_0x4fc844['forEach']((_0x569fa5,_0x58b46d)=>{var _0x1c7a6f=_0x3cbdfc;_0x504290[_0x58b46d][_0x1c7a6f(0x162)]=_0x569fa5;}),_0x8b9db9['forEach']((_0x286533,_0x421290)=>{var _0x5c484d=_0x3cbdfc;_0x504290[_0x421290][_0x5c484d(0x1b0)]=_0x286533;}),_0x56c292[_0x3cbdfc(0x17c)]((_0x46b644,_0x1575e2)=>{_0x504290[_0x1575e2]['stock']=_0x46b644;}),_0x1a32a7[_0x3cbdfc(0x17c)]((_0x26207a,_0x2c308d)=>{var _0x15e31f=_0x3cbdfc;_0x504290[_0x2c308d][_0x15e31f(0xec)]=_0x26207a;}),_0x28af66[_0x3cbdfc(0x17c)]((_0x1012e3,_0x409b73)=>{var _0x37ab4b=_0x3cbdfc;_0x504290[_0x409b73][_0x37ab4b(0x16c)]=_0x1012e3;}),_0x5728bf[_0x3cbdfc(0x17c)]((_0x5dd7ff,_0x305495)=>{_0x504290[_0x305495]['bin']=_0x5dd7ff;}),_0x550598[_0x3cbdfc(0x17c)]((_0xe32bca,_0x494bca)=>{var _0x24c964=_0x3cbdfc;_0x504290[_0x494bca][_0x24c964(0x124)]=_0xe32bca;}),_0x17102d[_0x3cbdfc(0x17c)]((_0x3178a9,_0x33c0be)=>{var _0x31cd71=_0x3cbdfc;_0x504290[_0x33c0be][_0x31cd71(0x1cc)]=_0x3178a9;});var _0x11a46e=0x0;_0x504290[_0x3cbdfc(0x17c)](_0x5cb3c6=>{var _0x232084=_0x3cbdfc;console[_0x232084(0xf0)]('foreach\x20newproduct',_0x5cb3c6),(parseInt(_0x5cb3c6[_0x232084(0x1b0)])<parseInt(_0x5cb3c6[_0x232084(0xec)])||parseInt(_0x5cb3c6[_0x232084(0x154)])<parseInt(_0x5cb3c6[_0x232084(0xec)])&&parseInt(_0x5cb3c6['sale_qty'])>parseInt(_0x5cb3c6[_0x232084(0xec)])||parseInt(_0x5cb3c6[_0x232084(0xec)])==0x0)&&_0x11a46e++;});if(_0x11a46e!=0x0)return _0x20d55c[_0x3cbdfc(0xdb)]('errors',_0x3cbdfc(0x177)),_0x14ed79['redirect'](_0x3cbdfc(0x15e));const _0x2cb168=await sales['findOne']({'invoice':_0xdeb35});console[_0x3cbdfc(0xf0)](_0x2cb168),_0x2cb168[_0x3cbdfc(0x145)]=_0x3cbdfc(0x103);const _0x1f3a56=await _0x2cb168[_0x3cbdfc(0x178)](),_0x23b469=new sales_return({'invoice':_0xdeb35,'customer':_0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x1ad)],'date':_0x5ef219,'warehouse_name':_0x3c8375,'room':_0x55d942,'ToWarehouse':_0x2694b0,'ToRoom':_0x2f8df5,'return_sale':_0x504290,'note':_0x2a58c4}),_0x4223ea=await _0x23b469[_0x3cbdfc(0x178)]();console[_0x3cbdfc(0xf0)](_0x23b469);const _0x586797=await sales_return[_0x3cbdfc(0xde)]({'invoice':_0xdeb35}),_0x3611eb=await warehouse[_0x3cbdfc(0xde)]({'name':_0x2694b0,'room':_0x2f8df5});_0x586797['return_sale'][_0x3cbdfc(0x17c)](_0x4cfca2=>{var _0x1a402c=_0x3cbdfc,_0x4a67a3=0x0;const _0x231742=_0x3611eb['product_details'][_0x1a402c(0x153)](_0x423fc5=>{var _0x54a249=_0x1a402c;_0x423fc5[_0x54a249(0xd6)]==_0x4cfca2['product_name']&&_0x423fc5[_0x54a249(0x1cc)]==_0x4cfca2['floorlevel']&&_0x423fc5['type']==_0x4cfca2[_0x54a249(0x124)]&&_0x423fc5[_0x54a249(0x10c)]==_0x4cfca2[_0x54a249(0x10c)]&&_0x423fc5[_0x54a249(0x16c)]==_0x4cfca2[_0x54a249(0x16c)]&&(_0x423fc5['product_stock']=parseInt(_0x423fc5[_0x54a249(0x15f)])+parseInt(_0x4cfca2[_0x54a249(0xec)]),_0x4a67a3++);});_0x4a67a3=='0'&&(_0x3611eb[_0x1a402c(0x105)]=_0x3611eb[_0x1a402c(0x105)][_0x1a402c(0x1a6)]({'product_name':_0x4cfca2[_0x1a402c(0xd6)],'product_stock':_0x4cfca2[_0x1a402c(0xec)],'primary_code':_0x4cfca2['primary_code'],'secondary_code':_0x4cfca2[_0x1a402c(0xe5)],'product_code':_0x4cfca2[_0x1a402c(0x162)],'bay':_0x4cfca2[_0x1a402c(0x16c)],'bin':_0x4cfca2[_0x1a402c(0x10c)],'type':_0x4cfca2[_0x1a402c(0x124)],'floorlevel':_0x4cfca2[_0x1a402c(0x1cc)]})),console[_0x1a402c(0xf0)](_0x1a402c(0xfb),_0x3611eb);}),await _0x3611eb[_0x3cbdfc(0x178)](),console[_0x3cbdfc(0xf0)](_0x20d55c[_0x3cbdfc(0x1d5)]);const _0x48585e=new c_payment_data({'invoice':_0xdeb35,'customer':_0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x1ad)],'reason':_0x3cbdfc(0x167)});await _0x48585e[_0x3cbdfc(0x178)]();const _0x37f83a=await master_shop[_0x3cbdfc(0x1a1)]();console[_0x3cbdfc(0xf0)]('add\x20post',_0x37f83a[0x0][_0x3cbdfc(0xfd)]);const _0x410a4=await email_settings[_0x3cbdfc(0xde)](),_0x3c5318=await customer[_0x3cbdfc(0xde)]({'name':_0x20d55c[_0x3cbdfc(0x1d5)][_0x3cbdfc(0x1ad)]});console['log'](_0x3cbdfc(0x19e),_0x3c5318);_0x37f83a[0x0][_0x3cbdfc(0x1b1)]==0x1?(right_currency=_0x37f83a[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x37f83a[0x0][_0x3cbdfc(0x194)]);var _0x4dd23d=_0x462cd3,_0x270f3d=_0x1a32a7,_0x39e11c='',_0x3d96a1;for(_0x3d96a1 in _0x4dd23d){_0x39e11c+=_0x3cbdfc(0x13f)+_0x3cbdfc(0xed)+_0x4dd23d[_0x3d96a1]+_0x3cbdfc(0x11f)+_0x3cbdfc(0xed)+_0x270f3d[_0x3d96a1]+_0x3cbdfc(0x11f)+_0x3cbdfc(0xe3);}console['log'](_0x3cbdfc(0x16a),_0x39e11c);let _0x3b969c=nodemailer[_0x3cbdfc(0x1ce)]({'service':'gmail','auth':{'user':_0x410a4[_0x3cbdfc(0x180)],'pass':_0x410a4['password']}}),_0x98b5cc={'from':_0x410a4[_0x3cbdfc(0x180)],'to':_0x3c5318['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x3cbdfc(0xda),'path':__dirname+_0x3cbdfc(0x1ba)+_0x3cbdfc(0x121)+_0x37f83a[0x0][_0x3cbdfc(0xfd)],'cid':_0x3cbdfc(0x1d3)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+_0x3cbdfc(0xe6)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x3cbdfc(0x140)+_0x3cbdfc(0xe0)+_0x3cbdfc(0xe6)+_0x3cbdfc(0xdf)+_0x37f83a[0x0][_0x3cbdfc(0x13d)]+_0x3cbdfc(0x1c2)+_0x3cbdfc(0xe0)+_0x3cbdfc(0xe0)+'<hr\x20class=\x22my-3\x22>'+_0x3cbdfc(0xe6)+_0x3cbdfc(0x10b)+_0x3cbdfc(0x1af)+_0xdeb35+'\x20'+_0x3cbdfc(0x139)+_0x3cbdfc(0xf8)+_0x5ef219+'\x20'+'</span>'+_0x3cbdfc(0x16f)+_0x3cbdfc(0xe0)+_0x3cbdfc(0x11a)+_0x3cbdfc(0xe4)+_0x3cbdfc(0x13f)+_0x3cbdfc(0x160)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x3cbdfc(0xe3)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x39e11c+'\x20'+_0x3cbdfc(0x147)+_0x3cbdfc(0x1d7)+'<div>'+_0x3cbdfc(0x116)+_0x3cbdfc(0x1c3)+_0x37f83a[0x0][_0x3cbdfc(0x13d)]+_0x3cbdfc(0x16f)+_0x3cbdfc(0xe0)+_0x3cbdfc(0xe0)+_0x3cbdfc(0x15b)};_0x3b969c['sendMail'](_0x98b5cc,function(_0x24e350,_0x10b665){var _0xe202e9=_0x3cbdfc;_0x24e350?(console['log'](_0x24e350),console[_0xe202e9(0xf0)]('Error\x20Occurs')):console['log'](_0xe202e9(0x1d6));}),_0x20d55c['flash'](_0x3cbdfc(0x12d),_0x3cbdfc(0x1c5)),_0x14ed79['redirect'](_0x3cbdfc(0x13c));}catch(_0x516bb3){console['log'](_0x516bb3),_0x14ed79['status'](0xc8)[_0x3cbdfc(0x1b6)]({'message1':_0x516bb3[_0x3cbdfc(0x1bc)]});}}),router[a0_0x24e10b(0xf7)](a0_0x24e10b(0xe8),auth,async(_0xfc204a,_0x991c3d)=>{var _0x4469e9=a0_0x24e10b;try{const {username:_0x37875b,email:_0x121899,role:_0x5a23e5}=_0xfc204a[_0x4469e9(0x169)],_0x3a194e=_0xfc204a[_0x4469e9(0x169)],_0x4daea9=await profile[_0x4469e9(0xde)]({'email':_0x3a194e[_0x4469e9(0x180)]}),_0x3a0705=await master_shop['find']();console[_0x4469e9(0xf0)](_0x4469e9(0xf6),_0x3a0705);const _0x262860=_0xfc204a[_0x4469e9(0x195)]['id'],_0x503629=await sales[_0x4469e9(0x129)](_0x262860);console['log'](_0x4469e9(0xdd),_0x503629);if(_0x3a0705[0x0]['language']=='English\x20(US)')var _0x2e7755=users['English'];else{if(_0x3a0705[0x0][_0x4469e9(0x186)]==_0x4469e9(0xf1))var _0x2e7755=users['Hindi'];else{if(_0x3a0705[0x0][_0x4469e9(0x186)]=='German')var _0x2e7755=users[_0x4469e9(0xeb)];else{if(_0x3a0705[0x0][_0x4469e9(0x186)]==_0x4469e9(0xf3))var _0x2e7755=users[_0x4469e9(0xf3)];else{if(_0x3a0705[0x0][_0x4469e9(0x186)]=='French')var _0x2e7755=users[_0x4469e9(0x1a8)];else{if(_0x3a0705[0x0][_0x4469e9(0x186)]=='Portuguese\x20(BR)')var _0x2e7755=users[_0x4469e9(0x18a)];else{if(_0x3a0705[0x0][_0x4469e9(0x186)]==_0x4469e9(0x161))var _0x2e7755=users[_0x4469e9(0x161)];else{if(_0x3a0705[0x0][_0x4469e9(0x186)]==_0x4469e9(0x12e))var _0x2e7755=users[_0x4469e9(0x1a7)];}}}}}}}_0x991c3d[_0x4469e9(0x120)](_0x4469e9(0x15a),{'success':_0xfc204a['flash'](_0x4469e9(0x12d)),'errors':_0xfc204a[_0x4469e9(0xdb)](_0x4469e9(0x1a4)),'role':_0x3a194e,'profile':_0x4daea9,'alldata':_0x503629,'master_shop':_0x3a0705,'language':_0x2e7755});}catch(_0x12a862){console[_0x4469e9(0xf0)](_0x12a862);}}),router[a0_0x24e10b(0x19c)](a0_0x24e10b(0x1ae),async(_0x17697e,_0x24572b)=>{var _0x56a4cc=a0_0x24e10b;const {product_code:_0x1a1ca6,warehouse_name:_0x286e17,rooms_data:_0xb1e430,Roomslist:_0x20e96b}=_0x17697e[_0x56a4cc(0x1d5)],_0x384287=_0x20e96b[_0x56a4cc(0x1ac)](','),_0x48e7bc=[];async function _0xb1c33c(_0x155d16){var _0x2502e3=_0x56a4cc;const _0x44f034=await warehouse[_0x2502e3(0xd4)]([{'$match':{'name':_0x286e17,'room':_0x155d16}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1a1ca6}},{'$group':{'_id':_0x2502e3(0x13a),'name':{'$first':_0x2502e3(0x155)},'product_stock':{'$first':_0x2502e3(0x10e)},'primary_code':{'$first':_0x2502e3(0x1bb)},'secondary_code':{'$first':_0x2502e3(0x18c)},'product_code':{'$first':_0x2502e3(0x188)},'level':{'$first':_0x2502e3(0x151)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2502e3(0x189)},'pallet':{'$first':_0x2502e3(0x1bf)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2502e3(0x10d)},'storage':{'$first':_0x2502e3(0x15d)},'rack':{'$first':_0x2502e3(0x107)},'expiry_date':{'$first':_0x2502e3(0x1c9)},'production_date':{'$first':_0x2502e3(0x12f)},'maxPerUnit':{'$first':_0x2502e3(0x146)},'batch_code':{'$first':_0x2502e3(0x11b)},'product_cat':{'$first':_0x2502e3(0x1a9)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2502e3(0x196)},'invoice':{'$first':_0x2502e3(0x112)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x2502e3(0x1b7)}}}]),_0x3af446=await warehouse[_0x2502e3(0xd4)]([{'$match':{'name':_0x286e17,'room':_0x155d16}},{'$unwind':_0x2502e3(0x185)},{'$match':{'product_details.secondary_code':_0x1a1ca6}},{'$group':{'_id':_0x2502e3(0x13a),'name':{'$first':_0x2502e3(0x155)},'product_stock':{'$first':_0x2502e3(0x10e)},'primary_code':{'$first':_0x2502e3(0x1bb)},'secondary_code':{'$first':_0x2502e3(0x18c)},'product_code':{'$first':_0x2502e3(0x188)},'level':{'$first':_0x2502e3(0x151)},'isle':{'$first':_0x2502e3(0x181)},'type':{'$first':_0x2502e3(0x189)},'pallet':{'$first':_0x2502e3(0x1bf)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2502e3(0x10d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2502e3(0x107)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2502e3(0x12f)},'maxPerUnit':{'$first':_0x2502e3(0x146)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x2502e3(0x1a9)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2502e3(0x112)}}}]);if(_0x44f034[_0x2502e3(0x174)]>0x0)_0x48e7bc['push'](_0x44f034);else _0x3af446[_0x2502e3(0x174)]>0x0&&_0x48e7bc[_0x2502e3(0x17b)](_0x3af446);}const _0x44e33d=_0x384287[_0x56a4cc(0x153)](_0x123c35=>_0xb1c33c(_0x123c35));await Promise['all'](_0x44e33d),_0x24572b['json'](_0x48e7bc);}),module[a0_0x24e10b(0x16e)]=router;