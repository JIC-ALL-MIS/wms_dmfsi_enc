function a0_0x1c59(_0x4e8950,_0x114c7b){var _0x12366c=a0_0x1236();return a0_0x1c59=function(_0x1c59f9,_0x3b9852){_0x1c59f9=_0x1c59f9-0x8d;var _0x3de1e6=_0x12366c[_0x1c59f9];return _0x3de1e6;},a0_0x1c59(_0x4e8950,_0x114c7b);}var a0_0x123b10=a0_0x1c59;(function(_0x40cc4b,_0x243bf1){var _0x50a2e6=a0_0x1c59,_0x4c11da=_0x40cc4b();while(!![]){try{var _0x5da5dd=-parseInt(_0x50a2e6(0xd8))/0x1+parseInt(_0x50a2e6(0xbe))/0x2*(parseInt(_0x50a2e6(0x17a))/0x3)+-parseInt(_0x50a2e6(0xc3))/0x4*(-parseInt(_0x50a2e6(0xb4))/0x5)+parseInt(_0x50a2e6(0x16e))/0x6+parseInt(_0x50a2e6(0x115))/0x7+parseInt(_0x50a2e6(0x11d))/0x8*(-parseInt(_0x50a2e6(0x18c))/0x9)+parseInt(_0x50a2e6(0xd4))/0xa;if(_0x5da5dd===_0x243bf1)break;else _0x4c11da['push'](_0x4c11da['shift']());}catch(_0x18d3df){_0x4c11da['push'](_0x4c11da['shift']());}}}(a0_0x1236,0x35c81));function a0_0x1236(){var _0x50609f=['$product_details.secondary_code','Arabic\x20(ae)','$date','<h5\x20style=\x22text-align:\x20left;\x22>','</table>','due_amount','delivery_date','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$sale_product.floorlevel','max','/barcode/:id','False','stocks','product_data','English\x20(US)','RMSEmail','Receiving\x20Area','41589FGMMUj','</span>','</head><body>','Hindi','delivery_code','room_name','image','<div>','forEach','floor','prod_cat','Portuguese','Return\x20Goods','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.type','<h5>','$product_details.batch_code','secondary_unit','return_sale','room','sale_qty','$product_details.floorlevel','max_per_unit','product_name','primary_code','id_transact','$sale_product.bay','Shelves','Level','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','redirect','map','<h2>\x20','$product_details.actual_qty','aggregate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','sales\x20all_data','Spanish','Received\x20Payment\x20For\x20Sale','Email\x20sent\x20successfully','/view/return_sales/:id','Arabic','findOne','$product_details.product_name','batch_code','concat','$sale_product.quantity','product_stock','$product_details','5eoBktI','$product_details.unit','$product_details.maxPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','body','add\x20post','Chinese','error','currency_placement','271234YaGOoM','\x20Order\x20Date\x20:\x20','$product_details.production_date','/view/:id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','918604nxZzPa','rack','$room','status','Logo.png','$customer','log','carton','note','/all_sales/view','finalize','<strong>\x20Regards\x20</strong>','</thead>','exports','warehouse','catch','Sale\x20Return','2202620WtSexE','/view/add_sales','createTransport','$product_details.bin','338592YuaRct','$product.product_name','sale_product','express','findById','user_id','maxperunit','filter','master','$product_details.rack','$product_details.secondary_unit','</td>','$product_details.storage','/view/add_sale/product','post','prod_invoice','True','requested_qty','$invoice','Sales\x20Mail','bay','getMonth','render','$sale_product.type','Raw\x20Materials','language','id_transaction_from','\x20</h2>','slice','primary_unit','save','random','name','$name','$product','currency','Sales\x20Update\x20successfully','/all_sales/preview/','OUT-','_id','$product_details.expiry_date','stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','abs','production_date','unit','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','back','json','../public/language/languages.json','email','find','$isAllowEdit','edit_sales_view','$return_data','<span\x20style=\x22float:\x20right;\x22>','</tr>','\x20Order\x20Number\x20:\x20','quantity_notConverted','all','979384CoBhXd','customer','invoice','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','German','foreach\x20newproduct','An\x20error\x20occurred.','544rgTvPb','add_sales','actual_qty','Floor','<html><head><title></title>','../models/all_models','product_details','product_code','<tr>','return_qty','flash','storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','product_list','floorlevel','$customers_docs','Enabled','Error\x20Occurs','$sale_product.bin','amount','split','bin','/upload/','Portuguese\x20(BR)','Enclosed','type','all_sales_barcode','$product_details.actual_uom','customers','</tbody>','$product_details.level','/preview/:id','types','prod_code','/../public','payment\x20successfull','$sale_product','Router','params','$product_details.product_stock','errors','nodemailer','success','quantity','English','user','expiry_date','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.bay','$_id','$product_details.product_code','$product_details.product_cat','French','$note','site_title','$product_details.invoice','Ambient','message','secondary_code','stock_data','actual_uom','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','length','logo','<hr\x20class=\x22my-3\x22>','</body></html>','isAllowEdit','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','host','role','staff','</h5>','/barcode_scanner','<!DOCTYPE\x20html>','$product_details._id','$warehouse_name','warehouse_name','$product_details.primary_code','get','password','72300zHgXyj','RoomAssigned','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','edit_sales','$finalize','received_amount','push','level','final','customers_docs','sales_quantity','6hcdiUV'];a0_0x1236=function(){return _0x50609f;};return a0_0x1236();}const express=require(a0_0x123b10(0xdb)),app=express(),router=express[a0_0x123b10(0x142)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x123b10(0x122)),auth=require('../middleware/auth'),nodemailer=require(a0_0x123b10(0x146)),users=require(a0_0x123b10(0x10a));router[a0_0x123b10(0x16c)]('/view',auth,async(_0x162d06,_0x97b16)=>{var _0x2a11d5=a0_0x123b10;try{const {username:_0x33720f,email:_0x4f4cdb,role:_0x385852}=_0x162d06['user'],_0x45b6fb=_0x162d06[_0x2a11d5(0x14a)],_0x3f79d7=await profile['findOne']({'email':_0x45b6fb[_0x2a11d5(0x10b)]}),_0x58629d=await master_shop[_0x2a11d5(0x10c)]();let _0x1b682f;if(_0x45b6fb[_0x2a11d5(0x163)]=='staff'){const _0x92e4dd=await staff[_0x2a11d5(0xad)]({'email':_0x45b6fb[_0x2a11d5(0x10b)]});_0x1b682f=await sales[_0x2a11d5(0xa5)]([{'$lookup':{'from':_0x2a11d5(0x139),'localField':'customer','foreignField':'name','as':_0x2a11d5(0x178)}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x2a11d5(0xea)},'customers':{'$first':_0x2a11d5(0xc8)},'date':{'$first':_0x2a11d5(0x17d)},'warehouse_name':{'$first':_0x2a11d5(0x169)},'sale_product':{'$push':_0x2a11d5(0x141)},'note':{'$first':_0x2a11d5(0x153)},'return_data':{'$first':_0x2a11d5(0x10f)},'customers_docs':{'$first':_0x2a11d5(0x12c)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x2a11d5(0x12f)},'type':{'$addToSet':_0x2a11d5(0xef)},'pallet':{'$addToSet':_0x2a11d5(0x183)},'finalize':{'$first':_0x2a11d5(0x173)},'isAllowEdit':{'$first':_0x2a11d5(0x10d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x1b682f=await sales[_0x2a11d5(0xa5)]([{'$lookup':{'from':_0x2a11d5(0x139),'localField':_0x2a11d5(0x116),'foreignField':_0x2a11d5(0xf8),'as':_0x2a11d5(0x178)}},{'$unwind':_0x2a11d5(0x12c)},{'$unwind':_0x2a11d5(0x141)},{'$group':{'_id':_0x2a11d5(0x14f),'invoice':{'$first':_0x2a11d5(0xea)},'customers':{'$first':'$customer'},'date':{'$first':_0x2a11d5(0x17d)},'warehouse_name':{'$first':_0x2a11d5(0x169)},'sale_product':{'$push':_0x2a11d5(0x141)},'note':{'$first':_0x2a11d5(0x153)},'return_data':{'$first':_0x2a11d5(0x10f)},'customers_docs':{'$first':_0x2a11d5(0x12c)},'total_saleproduct_quantity':{'$sum':_0x2a11d5(0xb1)},'level':{'$addToSet':_0x2a11d5(0x9c)},'isle':{'$addToSet':_0x2a11d5(0x12f)},'type':{'$addToSet':_0x2a11d5(0xef)},'pallet':{'$addToSet':_0x2a11d5(0x183)},'finalize':{'$first':_0x2a11d5(0x173)},'isAllowEdit':{'$first':_0x2a11d5(0x10d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x2a11d5(0xa7),_0x1b682f);if(_0x58629d[0x0][_0x2a11d5(0xf1)]==_0x2a11d5(0x189)){var _0x19b07f=users[_0x2a11d5(0x149)];console[_0x2a11d5(0xc9)](_0x19b07f);}else{if(_0x58629d[0x0]['language']==_0x2a11d5(0x18f))var _0x19b07f=users['Hindi'];else{if(_0x58629d[0x0][_0x2a11d5(0xf1)]==_0x2a11d5(0x11a))var _0x19b07f=users[_0x2a11d5(0x11a)];else{if(_0x58629d[0x0][_0x2a11d5(0xf1)]==_0x2a11d5(0xa8))var _0x19b07f=users['Spanish'];else{if(_0x58629d[0x0]['language']==_0x2a11d5(0x152))var _0x19b07f=users[_0x2a11d5(0x152)];else{if(_0x58629d[0x0][_0x2a11d5(0xf1)]==_0x2a11d5(0x134))var _0x19b07f=users['Portuguese'];else{if(_0x58629d[0x0]['language']=='Chinese')var _0x19b07f=users[_0x2a11d5(0xbb)];else{if(_0x58629d[0x0][_0x2a11d5(0xf1)]==_0x2a11d5(0x17c))var _0x19b07f=users['Arabic'];}}}}}}}_0x97b16[_0x2a11d5(0xee)]('all_sales',{'success':_0x162d06[_0x2a11d5(0x127)]('success'),'errors':_0x162d06[_0x2a11d5(0x127)]('errors'),'sales':_0x1b682f,'profile':_0x3f79d7,'role':_0x45b6fb,'master_shop':_0x58629d,'language':_0x19b07f});}catch(_0x55d334){console[_0x2a11d5(0xc9)](_0x55d334);}});async function getRandom8DigitNumber(){var _0x6c9cb8=a0_0x123b10;const _0x408553=0x989680,_0x34c9d8=0x5f5e0ff,_0x124a01=Math[_0x6c9cb8(0x195)](Math[_0x6c9cb8(0xf7)]()*(_0x34c9d8-_0x408553+0x1))+_0x408553;var _0x491728;const _0x2e5244=await sales[_0x6c9cb8(0xad)]({'invoice':_0x6c9cb8(0xfe)+_0x124a01});return _0x2e5244&&_0x2e5244[_0x6c9cb8(0x15c)]>0x0?_0x491728=_0x6c9cb8(0xfe)+_0x124a01:_0x491728='OUT-'+_0x124a01,_0x491728;}router[a0_0x123b10(0x16c)]('/view/add_sales',auth,async(_0xed1607,_0x20262d)=>{var _0x4c4161=a0_0x123b10;try{const {username:_0x1fe780,email:_0xc9d427,role:_0x5072d8}=_0xed1607[_0x4c4161(0x14a)],_0x41d7d7=_0xed1607[_0x4c4161(0x14a)],_0x8ed927=await profile['findOne']({'email':_0x41d7d7[_0x4c4161(0x10b)]}),_0x37aef2=await master_shop['find'](),_0x287f7d=await customer[_0x4c4161(0x10c)]({});let _0x2357d7;if(_0x41d7d7[_0x4c4161(0x163)]=='staff'){const _0x3e60cb=await staff['findOne']({'email':_0x41d7d7[_0x4c4161(0x10b)]});_0x2357d7=await warehouse[_0x4c4161(0xa5)]([{'$match':{'status':_0x4c4161(0x12d),'name':_0x3e60cb['warehouse'],'warehouse_category':_0x4c4161(0xf0),'name':{'$ne':_0x4c4161(0x8e)}}},{'$group':{'_id':_0x4c4161(0xf9),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x2357d7=await warehouse[_0x4c4161(0xa5)]([{'$match':{'status':_0x4c4161(0x12d),'warehouse_category':_0x4c4161(0xf0),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x4c4161(0xf9),'name':{'$first':_0x4c4161(0xf9)}}},{'$sort':{'name':0x1}}]);const _0x1c0683=await product[_0x4c4161(0x10c)]({});var _0x3512ca=['Ambient',_0x4c4161(0x135)];const _0x2e0a72=await sales['find']({}),_0x5615e6=_0x2e0a72[_0x4c4161(0x15c)]+0x1,_0x537fed='OUT-'+_0x5615e6['toString']()['padStart'](0x5,'0');if(_0x37aef2[0x0][_0x4c4161(0xf1)]==_0x4c4161(0x189)){var _0x58ed42=users[_0x4c4161(0x149)];console[_0x4c4161(0xc9)](_0x58ed42);}else{if(_0x37aef2[0x0][_0x4c4161(0xf1)]==_0x4c4161(0x18f))var _0x58ed42=users['Hindi'];else{if(_0x37aef2[0x0][_0x4c4161(0xf1)]=='German')var _0x58ed42=users[_0x4c4161(0x11a)];else{if(_0x37aef2[0x0][_0x4c4161(0xf1)]==_0x4c4161(0xa8))var _0x58ed42=users['Spanish'];else{if(_0x37aef2[0x0]['language']==_0x4c4161(0x152))var _0x58ed42=users[_0x4c4161(0x152)];else{if(_0x37aef2[0x0][_0x4c4161(0xf1)]==_0x4c4161(0x134))var _0x58ed42=users[_0x4c4161(0x8d)];else{if(_0x37aef2[0x0][_0x4c4161(0xf1)]==_0x4c4161(0xbb))var _0x58ed42=users['Chinese'];else{if(_0x37aef2[0x0]['language']==_0x4c4161(0x17c))var _0x58ed42=users[_0x4c4161(0xac)];}}}}}}}const _0x33909d=getRandom8DigitNumber();_0x33909d[_0x4c4161(0x14c)](_0x5e66dc=>{var _0x439955=_0x4c4161;_0x20262d[_0x439955(0xee)](_0x439955(0x11e),{'success':_0xed1607[_0x439955(0x127)](_0x439955(0x147)),'errors':_0xed1607[_0x439955(0x127)](_0x439955(0x145)),'role':_0x41d7d7,'profile':_0x8ed927,'customer':_0x287f7d,'warehouse':_0x2357d7,'product':_0x1c0683,'invoice':_0x5e66dc,'master_shop':_0x37aef2,'language':_0x58ed42,'rooms_data':_0x3512ca});})[_0x4c4161(0xd2)](_0x90007c=>{var _0x308126=_0x4c4161;_0xed1607[_0x308126(0x127)](_0x308126(0x145),_0x308126(0x9f)),_0x20262d[_0x308126(0xa1)](_0x308126(0xcc));});}catch(_0x3610d9){console[_0x4c4161(0xc9)](_0x3610d9);}}),router['get']('/view/add_sales/:id',auth,async(_0x11010d,_0xaae2dc)=>{var _0x2b61cc=a0_0x123b10;try{const _0x5a9d66=_0x11010d[_0x2b61cc(0x143)]['id'];console['log'](_0x5a9d66);const _0x415f43=await product['find'](),_0x12b2b0=await purchases['aggregate']([{'$match':{'warehouse_name':_0x5a9d66}},{'$unwind':_0x2b61cc(0xfa)},{'$group':{'_id':_0x2b61cc(0xd9)}}]);console['log']('purchases_data',_0x12b2b0),_0xaae2dc[_0x2b61cc(0xc6)](0xc8)['json']({'purchases_data':_0x12b2b0,'product_data':_0x415f43});}catch(_0xa2d580){console[_0x2b61cc(0xc9)](_0xa2d580);}}),router[a0_0x123b10(0xe6)](a0_0x123b10(0xe5),auth,async(_0x4fc4e0,_0x664c6c)=>{var _0x50a336=a0_0x123b10;try{const {warehouse_data:_0x1f57e9,product_data:_0x1b3d42}=_0x4fc4e0['body'];console[_0x50a336(0xc9)](_0x4fc4e0[_0x50a336(0xb9)][_0x50a336(0x188)]);;const _0x170941=await master_shop[_0x50a336(0x10c)]();console[_0x50a336(0xc9)]('master',_0x170941);const _0x4ef2cd=await product[_0x50a336(0xad)]({'name':_0x1b3d42});console[_0x50a336(0xc9)]('product',_0x4ef2cd);const _0x253229=await warehouse[_0x50a336(0xa5)]([{'$match':{'name':_0x1f57e9}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x1b3d42}},{'$group':{'_id':_0x50a336(0xae),'product_stock':{'$first':_0x50a336(0x144)}}}]);console[_0x50a336(0xc9)](_0x50a336(0x159),_0x253229),_0x664c6c[_0x50a336(0xc6)](0xc8)[_0x50a336(0x109)]({'master':_0x170941,'new_product':_0x4ef2cd,'stock_data':_0x253229});}catch(_0xbd8a07){console[_0x50a336(0xc9)](_0xbd8a07);}}),router[a0_0x123b10(0xe6)](a0_0x123b10(0xd5),auth,async(_0x51c230,_0x35389d)=>{var _0x4a65d8=a0_0x123b10;try{const {invoice:_0x20bdbb,date:_0x24131f,warehouse_name:_0x145e9c,product_name:_0x9e1cc,stock:_0x25781f,quantity:_0x20b820,note:_0x467b22,room:_0x29f30e,primary_code:_0x26841c,secondary_code:_0xe05247,prod_code:_0x424420,level:_0x5921b4,isle:_0x27d158,pallet:_0x5dc0b4,batch_code:_0x2ba7c2,SCRN:_0x345cdd,expiry_date:_0x579473}=_0x51c230[_0x4a65d8(0xb9)];if(typeof _0x9e1cc==_0x4a65d8(0x118))var _0x1f4ee8=[_0x51c230['body']['product_name']],_0x2f6bcb=[_0x51c230[_0x4a65d8(0xb9)]['stock']],_0x2daee7=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0xca)]],_0x5e893f=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x9a)]],_0x4617cd=[_0x51c230['body'][_0x4a65d8(0x158)]],_0x5774ea=[_0x51c230[_0x4a65d8(0xb9)]['prod_code']],_0x49b316=[_0x51c230['body'][_0x4a65d8(0x176)]],_0x5d923d=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0xf5)]],_0xbc5083=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x93)]],_0x538568=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0xaf)]],_0x5f5a6e=[_0x51c230[_0x4a65d8(0xb9)]['expiry_date']],_0xdf73da=[_0x51c230['body'][_0x4a65d8(0x98)]],_0x4e3221=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x104)]],_0x2253af=[_0x51c230[_0x4a65d8(0xb9)]['requested_qty']],_0x2197f9=[_0x51c230[_0x4a65d8(0xb9)]['delivery_date']],_0x2b53d6=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x190)]],_0x263e7b=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x196)]],_0x201b2f=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x148)]],_0x38fa9f=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x16f)]],_0x42a5cd=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0xe7)]],_0x26ac18=[_0x51c230['body'][_0x4a65d8(0x11f)]],_0x727cb6=[_0x51c230[_0x4a65d8(0xb9)]['actual_uom']],_0x3b877a=[_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x9b)]];else var _0x1f4ee8=[..._0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x99)]],_0x2f6bcb=[..._0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x101)]],_0x2daee7=[..._0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0xca)]],_0x5e893f=[..._0x51c230['body'][_0x4a65d8(0x9a)]],_0x4617cd=[..._0x51c230[_0x4a65d8(0xb9)]['secondary_code']],_0x5774ea=[..._0x51c230['body']['prod_code']],_0x49b316=[..._0x51c230['body'][_0x4a65d8(0x176)]],_0x5d923d=[..._0x51c230['body']['primary_unit']],_0xbc5083=[..._0x51c230['body']['secondary_unit']],_0x538568=[..._0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0xaf)]],_0x5f5a6e=[..._0x51c230[_0x4a65d8(0xb9)]['expiry_date']],_0xdf73da=[..._0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x98)]],_0x4e3221=[..._0x51c230[_0x4a65d8(0xb9)]['production_date']],_0x2253af=[..._0x51c230['body'][_0x4a65d8(0xe9)]],_0x2197f9=[..._0x51c230[_0x4a65d8(0xb9)]['delivery_date']],_0x2b53d6=[..._0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x190)]],_0x263e7b=[..._0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x196)]],_0x201b2f=[..._0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x148)]],_0x38fa9f=[..._0x51c230[_0x4a65d8(0xb9)]['RoomAssigned']],_0x42a5cd=[..._0x51c230['body'][_0x4a65d8(0xe7)]],_0x26ac18=[..._0x51c230[_0x4a65d8(0xb9)]['actual_qty']],_0x727cb6=[..._0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x15a)]],_0x3b877a=[..._0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x9b)]];const _0x42260f=_0x1f4ee8[_0x4a65d8(0xa2)](_0x3c3028=>{return _0x3c3028={'product_name':_0x3c3028};});_0x2f6bcb['forEach']((_0x1e0f52,_0x2fe8d3)=>{var _0x361858=_0x4a65d8;_0x42260f[_0x2fe8d3][_0x361858(0x101)]=Math[_0x361858(0x103)](_0x1e0f52);}),_0x26ac18[_0x4a65d8(0x194)]((_0x25d039,_0x596fd0)=>{var _0x109046=_0x4a65d8;_0x42260f[_0x596fd0][_0x109046(0x11f)]=Math[_0x109046(0x103)](_0x25d039);}),_0x727cb6[_0x4a65d8(0x194)]((_0x2f0dc6,_0x474e1b)=>{var _0x117ed6=_0x4a65d8;_0x42260f[_0x474e1b][_0x117ed6(0x15a)]=_0x2f0dc6;}),_0x3b877a[_0x4a65d8(0x194)]((_0x4575cd,_0x31a53a)=>{var _0x20d837=_0x4a65d8;_0x42260f[_0x31a53a][_0x20d837(0xf2)]=_0x4575cd;}),_0x2daee7[_0x4a65d8(0x194)]((_0x25fbf9,_0x26b9b1)=>{var _0x1326eb=_0x4a65d8;_0x42260f[_0x26b9b1][_0x1326eb(0x148)]=_0x25fbf9;}),_0x5e893f[_0x4a65d8(0x194)]((_0x51cb48,_0x1dd286)=>{var _0x5f536d=_0x4a65d8;_0x42260f[_0x1dd286][_0x5f536d(0x9a)]=_0x51cb48;}),_0x4617cd[_0x4a65d8(0x194)]((_0xa1de1e,_0xfb667c)=>{_0x42260f[_0xfb667c]['secondary_code']=_0xa1de1e;}),_0x5774ea[_0x4a65d8(0x194)]((_0x5a5369,_0x513eab)=>{_0x42260f[_0x513eab]['product_code']=_0x5a5369;}),_0x49b316[_0x4a65d8(0x194)]((_0x1f5b55,_0x512a02)=>{var _0x308d49=_0x4a65d8;_0x38fa9f[_0x308d49(0x194)]((_0x416ce0,_0x370ae3)=>{var _0x539752=_0x308d49;if(_0x416ce0==_0x539752(0x18b)&&_0x512a02==_0x370ae3){var _0x542858=_0x1f5b55[_0x539752(0xf4)](0x3);_0x42260f[_0x512a02][_0x539752(0x128)]=_0x1f5b55[0x0],_0x42260f[_0x512a02][_0x539752(0xc4)]=_0x1f5b55[0x1],_0x42260f[_0x512a02]['bay']=0x0,_0x42260f[_0x512a02][_0x539752(0x132)]=0x0,_0x42260f[_0x512a02][_0x539752(0x136)]=_0x539752(0x120),_0x42260f[_0x512a02][_0x539752(0x12b)]=_0x542858;}else{if(_0x416ce0==_0x539752(0x9d)&&_0x512a02==_0x370ae3){var _0x542858=_0x1f5b55[_0x539752(0xf4)](0x3);_0x42260f[_0x512a02]['storage']=_0x1f5b55[0x0],_0x42260f[_0x512a02][_0x539752(0xc4)]=_0x1f5b55[0x1],_0x42260f[_0x512a02][_0x539752(0xec)]=0x0,_0x42260f[_0x512a02][_0x539752(0x132)]=0x0,_0x42260f[_0x512a02]['type']='Floor',_0x42260f[_0x512a02][_0x539752(0x12b)]=_0x1f5b55[0x5];}else{if(_0x512a02==_0x370ae3){var _0xe10cc1;if(_0x1f5b55[0x4]=='L')_0xe10cc1=_0x539752(0x9e);else _0x1f5b55[0x4]=='F'&&(_0xe10cc1=_0x539752(0x120));_0x42260f[_0x512a02][_0x539752(0x128)]=_0x1f5b55[0x0],_0x42260f[_0x512a02][_0x539752(0xc4)]=_0x1f5b55[0x1],_0x42260f[_0x512a02][_0x539752(0xec)]=_0x1f5b55[0x2],_0x42260f[_0x512a02][_0x539752(0x132)]=_0x1f5b55[0x3],_0x42260f[_0x512a02][_0x539752(0x136)]=_0xe10cc1,_0x42260f[_0x512a02][_0x539752(0x12b)]=_0x1f5b55[0x5];}}}});}),_0x5d923d['forEach']((_0x87b592,_0x4928e1)=>{var _0x3f2683=_0x4a65d8;_0x42260f[_0x4928e1][_0x3f2683(0x105)]=_0x87b592;}),_0xbc5083['forEach']((_0x3db1b6,_0x2a650b)=>{var _0x25499e=_0x4a65d8;_0x42260f[_0x2a650b][_0x25499e(0x93)]=_0x3db1b6;}),_0x538568['forEach']((_0x10bffe,_0x15cf71)=>{_0x42260f[_0x15cf71]['batch_code']=_0x10bffe;}),_0x5f5a6e['forEach']((_0x353743,_0x3a8666)=>{_0x42260f[_0x3a8666]['expiry_date']=_0x353743;}),_0xdf73da[_0x4a65d8(0x194)]((_0x3d002a,_0x2c3dcc)=>{_0x42260f[_0x2c3dcc]['maxperunit']=_0x3d002a;}),_0x4e3221['forEach']((_0x12d845,_0x2aec09)=>{var _0x6545a4=_0x4a65d8;_0x42260f[_0x2aec09][_0x6545a4(0x104)]=_0x12d845;}),_0x2253af['forEach']((_0x3badf1,_0x58ca81)=>{var _0x390ab6=_0x4a65d8;_0x42260f[_0x58ca81][_0x390ab6(0xe9)]=_0x3badf1;}),_0x2197f9[_0x4a65d8(0x194)]((_0x451bfe,_0x189a81)=>{var _0x25d623=_0x4a65d8;_0x42260f[_0x189a81][_0x25d623(0x181)]=_0x451bfe;}),_0x2b53d6['forEach']((_0x3badf8,_0x13b3d9)=>{var _0x5e54b1=_0x4a65d8;_0x42260f[_0x13b3d9][_0x5e54b1(0x190)]=_0x3badf8;}),_0x263e7b['forEach']((_0x5bf263,_0x16a30a)=>{var _0x67ba6f=_0x4a65d8;_0x42260f[_0x16a30a][_0x67ba6f(0x196)]=_0x5bf263;}),_0x201b2f[_0x4a65d8(0x194)]((_0x409e13,_0x1c0458)=>{var _0x333bb2=_0x4a65d8;_0x42260f[_0x1c0458][_0x333bb2(0x113)]=_0x409e13;}),_0x38fa9f[_0x4a65d8(0x194)]((_0x4935fe,_0x315c6b)=>{var _0x51bb5a=_0x4a65d8;_0x42260f[_0x315c6b][_0x51bb5a(0x191)]=_0x4935fe;}),_0x42a5cd[_0x4a65d8(0x194)]((_0x3e45e3,_0x220922)=>{var _0x9fbff3=_0x4a65d8;_0x42260f[_0x220922][_0x9fbff3(0x117)]=_0x3e45e3;});var _0x238d48=0x0;_0x42260f['forEach'](_0x2723ef=>{var _0xbe410a=_0x4a65d8;(_0x2723ef['stock']<_0x2723ef[_0xbe410a(0x113)]||_0x2723ef[_0xbe410a(0x113)]==0x0)&&(console[_0xbe410a(0xc9)](_0xbe410a(0x11b),_0x2723ef),_0x238d48++);});const _0xdb2124=_0x42260f[_0x4a65d8(0xdf)](_0x56e09c=>_0x56e09c[_0x4a65d8(0x148)]!=='0'&&_0x56e09c[_0x4a65d8(0x148)]!==''),_0x4b9cfe=new sales({'invoice':_0x20bdbb,'customer':_0x51c230[_0x4a65d8(0xb9)][_0x4a65d8(0x116)],'date':_0x24131f,'warehouse_name':_0x145e9c,'sale_product':_0xdb2124,'note':_0x467b22,'room':_0x29f30e,'primary_code':_0x26841c,'secondary_code':_0xe05247,'prod_code':_0x424420,'SCRN':_0x345cdd}),_0x445c36=await _0x4b9cfe['save']();_0x51c230[_0x4a65d8(0x127)](_0x4a65d8(0x147),'Sales\x20Add\x20successfully'),_0x35389d[_0x4a65d8(0xa1)](_0x4a65d8(0xfd)+_0x445c36[_0x4a65d8(0xff)]);}catch(_0x183deb){console[_0x4a65d8(0xc9)](_0x183deb);}}),router[a0_0x123b10(0x16c)](a0_0x123b10(0x13c),auth,async(_0xf10ad1,_0x407be6)=>{var _0x8c9a84=a0_0x123b10;try{const {username:_0x3417a9,email:_0x53fb29,role:_0x4033c7}=_0xf10ad1[_0x8c9a84(0x14a)],_0x501b9c=_0xf10ad1['user'],_0x559683=await profile['findOne']({'email':_0x501b9c['email']}),_0x594941=await master_shop[_0x8c9a84(0x10c)](),_0x24c980=_0xf10ad1['params']['id'],_0x289009=await sales[_0x8c9a84(0xdc)](_0x24c980),_0x32794a=await warehouse['aggregate']([{'$match':{'name':_0x289009[_0x8c9a84(0x16a)]}},{'$unwind':_0x8c9a84(0xb3)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x8c9a84(0xae)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x8c9a84(0x14e)},'bin':{'$first':_0x8c9a84(0xd7)},'type':{'$first':_0x8c9a84(0x90)},'floorlevel':{'$first':_0x8c9a84(0x97)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x8c9a84(0x17b)},'product_code':{'$first':_0x8c9a84(0x150)},'storage':{'$first':_0x8c9a84(0xe4)},'rack':{'$first':_0x8c9a84(0xe1)},'expiry_date':{'$first':_0x8c9a84(0x100)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x8c9a84(0x155)}}}]),_0x414225=await customer[_0x8c9a84(0x10c)]({});let _0x3428a7;if(_0x501b9c['role']==_0x8c9a84(0x164)){const _0x19c490=await staff[_0x8c9a84(0xad)]({'email':_0x501b9c[_0x8c9a84(0x10b)]});_0x3428a7=await warehouse['aggregate']([{'$match':{'status':_0x8c9a84(0x12d),'name':_0x19c490[_0x8c9a84(0xd1)]}},{'$group':{'_id':_0x8c9a84(0xf9),'name':{'$first':_0x8c9a84(0xf9)}}}]);}else _0x3428a7=await warehouse[_0x8c9a84(0xa5)]([{'$match':{'status':_0x8c9a84(0x12d)}},{'$group':{'_id':_0x8c9a84(0xf9),'name':{'$first':_0x8c9a84(0xf9)}}}]);const _0x4924a8=await product[_0x8c9a84(0x10c)]({}),_0x20d38a=await suppliers[_0x8c9a84(0x10c)]({});if(_0x594941[0x0]['language']=='English\x20(US)'){var _0x502d75=users[_0x8c9a84(0x149)];console[_0x8c9a84(0xc9)](_0x502d75);}else{if(_0x594941[0x0][_0x8c9a84(0xf1)]==_0x8c9a84(0x18f))var _0x502d75=users[_0x8c9a84(0x18f)];else{if(_0x594941[0x0]['language']==_0x8c9a84(0x11a))var _0x502d75=users['German'];else{if(_0x594941[0x0][_0x8c9a84(0xf1)]==_0x8c9a84(0xa8))var _0x502d75=users[_0x8c9a84(0xa8)];else{if(_0x594941[0x0][_0x8c9a84(0xf1)]==_0x8c9a84(0x152))var _0x502d75=users[_0x8c9a84(0x152)];else{if(_0x594941[0x0][_0x8c9a84(0xf1)]==_0x8c9a84(0x134))var _0x502d75=users[_0x8c9a84(0x8d)];else{if(_0x594941[0x0]['language']==_0x8c9a84(0xbb))var _0x502d75=users[_0x8c9a84(0xbb)];else{if(_0x594941[0x0][_0x8c9a84(0xf1)]==_0x8c9a84(0x17c))var _0x502d75=users[_0x8c9a84(0xac)];}}}}}}}_0x407be6[_0x8c9a84(0xee)](_0x8c9a84(0x10e),{'success':_0xf10ad1[_0x8c9a84(0x127)]('success'),'errors':_0xf10ad1['flash']('errors'),'role':_0x501b9c,'profile':_0x559683,'customer':_0x414225,'warehouse':_0x3428a7,'product':_0x32794a,'user':_0x289009,'master_shop':_0x594941,'unit':_0x4924a8,'language':_0x502d75,'suppliers':_0x20d38a});}catch(_0x24c039){console[_0x8c9a84(0xc9)](_0x24c039);}}),router[a0_0x123b10(0xe6)]('/preview/:id',auth,async(_0x4fa05f,_0x345edc)=>{var _0x2087ab=a0_0x123b10;try{const _0x35ad22=_0x4fa05f['params']['id'],{invoice:_0x5c4d64,warehouse_name:_0x1df02f,room:_0x1221bc}=_0x4fa05f['body'],_0x48f33a=await sales[_0x2087ab(0xad)]({'invoice':_0x5c4d64}),_0x45d664=_0x48f33a[_0x2087ab(0xda)][_0x2087ab(0xa2)](async _0x58fe2d=>{var _0x413f91=_0x2087ab,_0x1fce9f=await warehouse['findOne']({'name':_0x1df02f,'room':_0x58fe2d[_0x413f91(0x191)],'warehouse_category':_0x413f91(0xf0)});const _0x4ae335=_0x1fce9f[_0x413f91(0x123)]['map'](_0x460ed0=>{var _0x49c829=_0x413f91;_0x460ed0[_0x49c829(0x99)]==_0x58fe2d[_0x49c829(0x99)]&&_0x460ed0[_0x49c829(0x12b)]==_0x58fe2d[_0x49c829(0x12b)]&&_0x460ed0[_0x49c829(0x136)]==_0x58fe2d['type']&&_0x460ed0[_0x49c829(0x132)]==_0x58fe2d[_0x49c829(0x132)]&&_0x460ed0[_0x49c829(0xec)]==_0x58fe2d['bay']&&_0x460ed0[_0x49c829(0xc4)]==_0x58fe2d[_0x49c829(0xc4)]&&_0x460ed0[_0x49c829(0x128)]==_0x58fe2d[_0x49c829(0x128)]&&_0x460ed0[_0x49c829(0x14b)]==_0x58fe2d[_0x49c829(0x14b)]&&_0x460ed0['batch_code']==_0x58fe2d[_0x49c829(0xaf)]&&_0x460ed0[_0x49c829(0x117)]==_0x58fe2d[_0x49c829(0x117)]&&_0x460ed0[_0x49c829(0xff)]==_0x58fe2d['id_transaction_from']&&(_0x460ed0[_0x49c829(0xb2)]=Math[_0x49c829(0x184)](0x0,Math[_0x49c829(0x103)](_0x460ed0[_0x49c829(0xb2)])-Math['abs'](_0x58fe2d['quantity'])));});return _0x1fce9f;});Promise[_0x2087ab(0x114)](_0x45d664)[_0x2087ab(0x14c)](async _0x9617f7=>{var _0x1e9baf=_0x2087ab;try{for(const _0x5f177b of _0x9617f7){await _0x5f177b[_0x1e9baf(0xf6)]();}_0x48f33a[_0x1e9baf(0xcd)]=_0x1e9baf(0xe8);const _0x3f5780=await _0x48f33a['save'](),_0x2cdca3=await master_shop['find'](),_0x4f9f57=await email_settings[_0x1e9baf(0xad)](),_0x28b12c=await supervisor_settings['find']();var _0x2666dc=_0x48f33a[_0x1e9baf(0xda)],_0x10c7ce='',_0x1ddd59;for(_0x1ddd59 in _0x2666dc){_0x10c7ce+=_0x1e9baf(0x125)+_0x1e9baf(0x182)+_0x2666dc[_0x1ddd59][_0x1e9baf(0x99)]+_0x1e9baf(0xe3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2666dc[_0x1ddd59]['product_code']+'</td>'+_0x1e9baf(0x182)+_0x2666dc[_0x1ddd59][_0x1e9baf(0x148)]+_0x1e9baf(0xe3)+_0x1e9baf(0x182)+_0x2666dc[_0x1ddd59][_0x1e9baf(0x105)]+_0x1e9baf(0xe3)+_0x1e9baf(0x182)+_0x2666dc[_0x1ddd59]['secondary_unit']+'</td>'+_0x1e9baf(0x182)+_0x48f33a['warehouse_name']+'</td>'+_0x1e9baf(0x182)+_0x2666dc[_0x1ddd59][_0x1e9baf(0x191)]+_0x1e9baf(0xe3)+_0x1e9baf(0x182)+_0x2666dc[_0x1ddd59][_0x1e9baf(0x128)]+_0x2666dc[_0x1ddd59][_0x1e9baf(0xc4)]+_0x2666dc[_0x1ddd59]['bay']+_0x2666dc[_0x1ddd59][_0x1e9baf(0x132)]+_0x2666dc[_0x1ddd59][_0x1e9baf(0x136)][0x0]+_0x2666dc[_0x1ddd59][_0x1e9baf(0x12b)]+_0x1e9baf(0xe3),_0x1e9baf(0x111);}let _0x44f5cc=nodemailer[_0x1e9baf(0xd6)]({'host':_0x4f9f57[_0x1e9baf(0x162)],'port':Number(_0x4f9f57['port']),'secure':![],'auth':{'user':_0x4f9f57[_0x1e9baf(0x10b)],'pass':_0x4f9f57[_0x1e9baf(0x16d)]}}),_0x3f2b6f={'from':_0x4f9f57[_0x1e9baf(0x10b)],'to':_0x28b12c[0x0][_0x1e9baf(0x18a)],'subject':_0x1e9baf(0xeb),'attachments':[{'filename':_0x1e9baf(0xc7),'path':__dirname+_0x1e9baf(0x13f)+_0x1e9baf(0x133)+_0x2cdca3[0x0][_0x1e9baf(0x192)],'cid':_0x1e9baf(0x15d)}],'html':_0x1e9baf(0x167)+_0x1e9baf(0x121)+_0x1e9baf(0x18e)+_0x1e9baf(0x193)+_0x1e9baf(0xa0)+_0x1e9baf(0x193)+_0x1e9baf(0xb8)+_0x1e9baf(0x106)+_0x1e9baf(0x193)+_0x1e9baf(0xa3)+_0x2cdca3[0x0][_0x1e9baf(0x154)]+_0x1e9baf(0xf3)+_0x1e9baf(0x106)+_0x1e9baf(0x106)+_0x1e9baf(0x15e)+_0x1e9baf(0x193)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1e9baf(0x112)+_0x48f33a[_0x1e9baf(0x117)]+'\x20'+_0x1e9baf(0x110)+_0x1e9baf(0xbf)+_0x48f33a['date']+'\x20'+_0x1e9baf(0x18d)+_0x1e9baf(0x165)+_0x1e9baf(0x106)+_0x1e9baf(0xc2)+_0x1e9baf(0x161)+'<tr>'+_0x1e9baf(0x107)+_0x1e9baf(0x129)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x1e9baf(0x14d)+_0x1e9baf(0x171)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x1e9baf(0xb7)+_0x1e9baf(0x119)+_0x1e9baf(0x111)+'</thead>'+_0x1e9baf(0x8f)+'\x20'+_0x10c7ce+'\x20'+'</tbody>'+_0x1e9baf(0x17f)+_0x1e9baf(0x193)+_0x1e9baf(0xce)+_0x1e9baf(0x91)+_0x2cdca3[0x0][_0x1e9baf(0x154)]+_0x1e9baf(0x165)+_0x1e9baf(0x106)+_0x1e9baf(0x106)+_0x1e9baf(0x15f)};_0x44f5cc['sendMail'](_0x3f2b6f,function(_0x3c64d0,_0x34959d){var _0x44fc7b=_0x1e9baf;_0x3c64d0?(console[_0x44fc7b(0xc9)](_0x3c64d0),console[_0x44fc7b(0xc9)](_0x44fc7b(0x12e))):console[_0x44fc7b(0xc9)](_0x44fc7b(0xaa));}),_0x4fa05f[_0x1e9baf(0x127)](_0x1e9baf(0x147),_0x1e9baf(0xfc)),_0x345edc[_0x1e9baf(0xa1)]('/all_sales/preview/'+_0x35ad22);}catch(_0x32d4c6){console[_0x1e9baf(0xbc)](_0x32d4c6),_0x345edc[_0x1e9baf(0xc6)](0x1f4)[_0x1e9baf(0x109)]({'error':_0x1e9baf(0x170)});}})[_0x2087ab(0xd2)](_0x545c6a=>{var _0x54f516=_0x2087ab;console[_0x54f516(0xbc)](_0x545c6a),_0x345edc['status'](0x1f4)[_0x54f516(0x109)]({'error':_0x54f516(0x11c)});});}catch(_0xb2c15c){console[_0x2087ab(0xc9)](_0xb2c15c);}}),router[a0_0x123b10(0x16c)](a0_0x123b10(0xc1),auth,async(_0x116cb2,_0x331304)=>{var _0x1bf888=a0_0x123b10;try{const {username:_0x3d1926,email:_0x49dba7,role:_0x1e210b}=_0x116cb2[_0x1bf888(0x14a)],_0x4f020d=_0x116cb2['user'],_0x1517b0=await profile['findOne']({'email':_0x4f020d[_0x1bf888(0x10b)]}),_0x3ec44a=await master_shop[_0x1bf888(0x10c)](),_0x2d4576=_0x116cb2['params']['id'],_0x3a37b6=await sales['findById'](_0x2d4576);var _0x46402c=[_0x1bf888(0x156),_0x1bf888(0x135)];const _0x1693d3=await warehouse[_0x1bf888(0xa5)]([{'$match':{'name':_0x3a37b6['warehouse_name'],'warehouse_category':_0x1bf888(0xf0)}},{'$unwind':_0x1bf888(0xb3)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1bf888(0x144)},'bay':{'$first':_0x1bf888(0x14e)},'bin':{'$first':_0x1bf888(0xd7)},'type':{'$first':_0x1bf888(0x90)},'floorlevel':{'$first':_0x1bf888(0x97)},'primary_code':{'$first':_0x1bf888(0x16b)},'secondary_code':{'$first':_0x1bf888(0x17b)},'product_code':{'$first':_0x1bf888(0x150)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1bf888(0xe1)}}}]),_0x8233f4=await customer[_0x1bf888(0x10c)]({});let _0x2d0936;if(_0x4f020d[_0x1bf888(0x163)]==_0x1bf888(0x164)){const _0x37583e=await staff[_0x1bf888(0xad)]({'email':_0x4f020d[_0x1bf888(0x10b)]});_0x2d0936=await warehouse[_0x1bf888(0xa5)]([{'$match':{'status':'Enabled','name':_0x37583e[_0x1bf888(0xd1)],'warehouse_category':_0x1bf888(0xf0)}},{'$group':{'_id':'$name','name':{'$first':_0x1bf888(0xf9)}}}]);}else _0x2d0936=await warehouse[_0x1bf888(0xa5)]([{'$match':{'status':_0x1bf888(0x12d),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x1bf888(0xf9),'name':{'$first':_0x1bf888(0xf9)}}}]);const _0x1d20b9=await product[_0x1bf888(0x10c)]({});if(_0x3ec44a[0x0][_0x1bf888(0xf1)]==_0x1bf888(0x189)){var _0x334aea=users[_0x1bf888(0x149)];console[_0x1bf888(0xc9)](_0x334aea);}else{if(_0x3ec44a[0x0][_0x1bf888(0xf1)]==_0x1bf888(0x18f))var _0x334aea=users[_0x1bf888(0x18f)];else{if(_0x3ec44a[0x0][_0x1bf888(0xf1)]=='German')var _0x334aea=users[_0x1bf888(0x11a)];else{if(_0x3ec44a[0x0][_0x1bf888(0xf1)]==_0x1bf888(0xa8))var _0x334aea=users[_0x1bf888(0xa8)];else{if(_0x3ec44a[0x0]['language']=='French')var _0x334aea=users['French'];else{if(_0x3ec44a[0x0][_0x1bf888(0xf1)]=='Portuguese\x20(BR)')var _0x334aea=users[_0x1bf888(0x8d)];else{if(_0x3ec44a[0x0][_0x1bf888(0xf1)]==_0x1bf888(0xbb))var _0x334aea=users['Chinese'];else{if(_0x3ec44a[0x0][_0x1bf888(0xf1)]==_0x1bf888(0x17c))var _0x334aea=users[_0x1bf888(0xac)];}}}}}}}_0x331304[_0x1bf888(0xee)](_0x1bf888(0x172),{'success':_0x116cb2[_0x1bf888(0x127)]('success'),'errors':_0x116cb2[_0x1bf888(0x127)](_0x1bf888(0x145)),'role':_0x4f020d,'profile':_0x1517b0,'customer':_0x8233f4,'warehouse':_0x2d0936,'product':_0x1693d3,'user':_0x3a37b6,'master_shop':_0x3ec44a,'unit':_0x1d20b9,'language':_0x334aea});}catch(_0x5c60f2){console['log'](_0x5c60f2);}}),router[a0_0x123b10(0xe6)](a0_0x123b10(0xc1),auth,async(_0x4b0725,_0x26db22)=>{var _0x4093b4=a0_0x123b10;try{const _0x3bc471=_0x4b0725['params']['id'],_0x299196=await sales['findOne']({'_id':_0x4b0725[_0x4093b4(0x143)]['id']}),_0x2f1f3f=await warehouse[_0x4093b4(0xad)]({'name':_0x299196[_0x4093b4(0x16a)],'room':_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x95)]}),{invoice:_0x147d8f,date:_0x241796,warehouse_name:_0x4cf9fc,product_name:_0x2ffe88,stock:_0x576fa5,quantity:_0x58f741,note:_0x42afbf,room:_0x15b7f1,customer:_0x3290c0,SCRN:_0x278e84}=_0x4b0725[_0x4093b4(0xb9)];if(typeof _0x2ffe88==_0x4093b4(0x118))var _0x2142eb=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x99)]],_0x2d0d62=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x101)]],_0xd377a0=[_0x4b0725['body']['carton']],_0x234ec4=[_0x4b0725['body'][_0x4093b4(0x9a)]],_0x51939f=[_0x4b0725[_0x4093b4(0xb9)]['secondary_code']],_0x4fa043=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x13e)]],_0x3360db=[_0x4b0725['body'][_0x4093b4(0x176)]],_0x2227d4=[_0x4b0725['body']['primary_unit']],_0x209136=[_0x4b0725['body'][_0x4093b4(0x93)]],_0x14429b=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0xaf)]],_0x1e72d4=[_0x4b0725['body'][_0x4093b4(0x14b)]],_0x15d221=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x98)]],_0x3021e0=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x104)]],_0x94cc00=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0xe9)]],_0xb9179c=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x181)]],_0x3dfea4=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x190)]],_0x499792=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x196)]],_0x31a0bd=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x148)]],_0x2ffb45=[_0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x16f)]];else var _0x2142eb=[..._0x4b0725[_0x4093b4(0xb9)]['product_name']],_0x2d0d62=[..._0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x101)]],_0xd377a0=[..._0x4b0725[_0x4093b4(0xb9)]['carton']],_0x234ec4=[..._0x4b0725['body'][_0x4093b4(0x9a)]],_0x51939f=[..._0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x158)]],_0x4fa043=[..._0x4b0725['body'][_0x4093b4(0x13e)]],_0x3360db=[..._0x4b0725[_0x4093b4(0xb9)]['level']],_0x2227d4=[..._0x4b0725[_0x4093b4(0xb9)]['primary_unit']],_0x209136=[..._0x4b0725['body'][_0x4093b4(0x93)]],_0x14429b=[..._0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0xaf)]],_0x1e72d4=[..._0x4b0725[_0x4093b4(0xb9)]['expiry_date']],_0x15d221=[..._0x4b0725['body'][_0x4093b4(0x98)]],_0x3021e0=[..._0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x104)]],_0x94cc00=[..._0x4b0725[_0x4093b4(0xb9)]['requested_qty']],_0xb9179c=[..._0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x181)]],_0x3dfea4=[..._0x4b0725[_0x4093b4(0xb9)][_0x4093b4(0x190)]],_0x499792=[..._0x4b0725['body'][_0x4093b4(0x196)]],_0x31a0bd=[..._0x4b0725[_0x4093b4(0xb9)]['quantity']],_0x2ffb45=[..._0x4b0725[_0x4093b4(0xb9)]['RoomAssigned']];const _0x35a4c0=_0x2142eb[_0x4093b4(0xa2)](_0x956712=>{return _0x956712={'product_name':_0x956712};});_0x2d0d62['forEach']((_0x481a24,_0x101c6b)=>{var _0x453691=_0x4093b4;_0x35a4c0[_0x101c6b][_0x453691(0x101)]=Math[_0x453691(0x103)](_0x481a24);}),_0xd377a0[_0x4093b4(0x194)]((_0x43fbcd,_0x5b4d55)=>{var _0x1264c8=_0x4093b4;_0x35a4c0[_0x5b4d55][_0x1264c8(0x148)]=_0x43fbcd;}),_0x234ec4['forEach']((_0x34260c,_0x54b02f)=>{var _0x20aa26=_0x4093b4;_0x35a4c0[_0x54b02f][_0x20aa26(0x9a)]=_0x34260c;}),_0x51939f[_0x4093b4(0x194)]((_0x210e09,_0x369a5e)=>{var _0x282402=_0x4093b4;_0x35a4c0[_0x369a5e][_0x282402(0x158)]=_0x210e09;}),_0x4fa043[_0x4093b4(0x194)]((_0x4744b1,_0x466d6d)=>{var _0x44261d=_0x4093b4;_0x35a4c0[_0x466d6d][_0x44261d(0x124)]=_0x4744b1;}),_0x3360db[_0x4093b4(0x194)]((_0x3bd222,_0x464d96)=>{var _0x398373=_0x4093b4;_0x2ffb45[_0x398373(0x194)]((_0x572956,_0x48c286)=>{var _0x6c2109=_0x398373;if(_0x572956==_0x6c2109(0x18b)&&_0x464d96==_0x48c286){var _0x1f681d=_0x3bd222[_0x6c2109(0xf4)](0x3);_0x35a4c0[_0x464d96][_0x6c2109(0x128)]=_0x3bd222[0x0],_0x35a4c0[_0x464d96][_0x6c2109(0xc4)]=_0x3bd222[0x1],_0x35a4c0[_0x464d96][_0x6c2109(0xec)]=0x0,_0x35a4c0[_0x464d96][_0x6c2109(0x132)]=0x0,_0x35a4c0[_0x464d96]['type']=_0x6c2109(0x120),_0x35a4c0[_0x464d96][_0x6c2109(0x12b)]=_0x1f681d;}else{if(_0x572956==_0x6c2109(0x9d)&&_0x464d96==_0x48c286){var _0x1f681d=_0x3bd222[_0x6c2109(0xf4)](0x3);_0x35a4c0[_0x464d96][_0x6c2109(0x128)]=_0x3bd222[0x0],_0x35a4c0[_0x464d96][_0x6c2109(0xc4)]=_0x3bd222[0x1],_0x35a4c0[_0x464d96]['bay']=0x0,_0x35a4c0[_0x464d96]['bin']=0x0,_0x35a4c0[_0x464d96][_0x6c2109(0x136)]=_0x6c2109(0x120),_0x35a4c0[_0x464d96][_0x6c2109(0x12b)]=_0x3bd222[0x5];}else{if(_0x464d96==_0x48c286){var _0x5c8c91;if(_0x3bd222[0x4]=='L')_0x5c8c91=_0x6c2109(0x9e);else _0x3bd222[0x4]=='F'&&(_0x5c8c91='Floor');_0x35a4c0[_0x464d96]['storage']=_0x3bd222[0x0],_0x35a4c0[_0x464d96]['rack']=_0x3bd222[0x1],_0x35a4c0[_0x464d96][_0x6c2109(0xec)]=_0x3bd222[0x2],_0x35a4c0[_0x464d96][_0x6c2109(0x132)]=_0x3bd222[0x3],_0x35a4c0[_0x464d96]['type']=_0x5c8c91,_0x35a4c0[_0x464d96][_0x6c2109(0x12b)]=_0x3bd222[0x5];}}}});}),_0x2227d4[_0x4093b4(0x194)]((_0x1d6965,_0x38c4e1)=>{var _0x27df08=_0x4093b4;_0x35a4c0[_0x38c4e1][_0x27df08(0x105)]=_0x1d6965;}),_0x209136[_0x4093b4(0x194)]((_0x221766,_0x5b749d)=>{var _0x8ef448=_0x4093b4;_0x35a4c0[_0x5b749d][_0x8ef448(0x93)]=_0x221766;}),_0x14429b[_0x4093b4(0x194)]((_0xf3a85b,_0x52d7f8)=>{_0x35a4c0[_0x52d7f8]['batch_code']=_0xf3a85b;}),_0x1e72d4[_0x4093b4(0x194)]((_0x62ea1,_0x170dd5)=>{var _0x174441=_0x4093b4;_0x35a4c0[_0x170dd5][_0x174441(0x14b)]=_0x62ea1;}),_0x15d221[_0x4093b4(0x194)]((_0x47919a,_0x49be8f)=>{var _0x35e25b=_0x4093b4;_0x35a4c0[_0x49be8f][_0x35e25b(0xde)]=_0x47919a;}),_0x3021e0[_0x4093b4(0x194)]((_0x2a1a92,_0x856adf)=>{_0x35a4c0[_0x856adf]['production_date']=_0x2a1a92;}),_0x94cc00[_0x4093b4(0x194)]((_0x15e995,_0x30e6db)=>{var _0x4d011d=_0x4093b4;_0x35a4c0[_0x30e6db][_0x4d011d(0xe9)]=Math[_0x4d011d(0x103)](_0x15e995);}),_0xb9179c[_0x4093b4(0x194)]((_0x5c00ab,_0x6639a9)=>{_0x35a4c0[_0x6639a9]['delivery_date']=_0x5c00ab;}),_0x3dfea4[_0x4093b4(0x194)]((_0x113c62,_0x311d7d)=>{var _0x47a715=_0x4093b4;_0x35a4c0[_0x311d7d][_0x47a715(0x190)]=_0x113c62;}),_0x499792[_0x4093b4(0x194)]((_0x29c3ca,_0x52af06)=>{var _0x2b0e74=_0x4093b4;_0x35a4c0[_0x52af06][_0x2b0e74(0x196)]=_0x29c3ca;}),_0x31a0bd[_0x4093b4(0x194)]((_0x4be7f2,_0x740905)=>{_0x35a4c0[_0x740905]['quantity_notConverted']=_0x4be7f2;}),_0x2ffb45['forEach']((_0xc50850,_0x11eb2d)=>{var _0xc61471=_0x4093b4;_0x35a4c0[_0x11eb2d][_0xc61471(0x191)]=_0xc50850;});var _0x20cb78=0x0;_0x35a4c0[_0x4093b4(0x194)](_0x5a0469=>{var _0xfef011=_0x4093b4;console[_0xfef011(0xc9)](_0xfef011(0x11b),_0x5a0469),(parseInt(_0x5a0469[_0xfef011(0x101)])<parseInt(_0x5a0469[_0xfef011(0x148)])||parseInt(_0x5a0469[_0xfef011(0x148)])==0x0)&&_0x20cb78++;});if(_0x20cb78!=0x0)return _0x4b0725[_0x4093b4(0x127)](_0x4093b4(0x145),_0x4093b4(0x15b)),_0x26db22[_0x4093b4(0xa1)](_0x4093b4(0x108));const _0x58b81f=_0x35a4c0[_0x4093b4(0xdf)](_0x3d9c91=>_0x3d9c91[_0x4093b4(0x148)]!=='0'&&_0x3d9c91[_0x4093b4(0x148)]!=='');_0x299196[_0x4093b4(0x117)]=_0x147d8f,_0x299196[_0x4093b4(0x116)]=_0x3290c0,_0x299196['date']=_0x241796,_0x299196['warehouse_name']=_0x4cf9fc,_0x299196[_0x4093b4(0xda)]=_0x58b81f,_0x299196[_0x4093b4(0xcb)]=_0x42afbf,_0x299196['SCRN']=_0x278e84,_0x299196['finalize']='False',_0x299196[_0x4093b4(0x160)]=_0x4093b4(0x186);const _0x466a84=await _0x299196['save']();_0x4b0725[_0x4093b4(0x127)](_0x4093b4(0x147),_0x4093b4(0xfc)),_0x26db22[_0x4093b4(0xa1)]('/all_sales/view');}catch(_0x31036e){console[_0x4093b4(0xc9)](_0x31036e);}}),router['post']('/give_payment/:id',auth,async(_0x1384dc,_0x1adb84)=>{var _0x28f531=a0_0x123b10;try{const _0x40f6d3=_0x1384dc[_0x28f531(0x143)]['id'],{invoice:_0x4b9ad1,customer:_0x515cc8,receivable_amount:_0x509adb,received_amount:_0x299fee}=_0x1384dc[_0x28f531(0xb9)],_0x27841b=await sales[_0x28f531(0xdc)](_0x40f6d3);console['log'](_0x27841b);var _0x11c7a1=_0x509adb-_0x299fee;console['log'](_0x299fee),_0x27841b['received_amount']=parseFloat(_0x299fee)+parseFloat(_0x27841b[_0x28f531(0x174)]),_0x27841b[_0x28f531(0x180)]=_0x11c7a1,console['log'](_0x27841b);const _0x47f927=await _0x27841b[_0x28f531(0xf6)](),_0xedd194=await c_payment_data[_0x28f531(0xad)]({'invoice':_0x4b9ad1});_0xedd194[_0x28f531(0x130)]=_0x11c7a1,await _0xedd194['save']();let _0x3783e1=new Date(),_0x156d8f=('0'+_0x3783e1['getDate']())[_0x28f531(0xf4)](-0x2),_0x1664bb=('0'+(_0x3783e1[_0x28f531(0xed)]()+0x1))[_0x28f531(0xf4)](-0x2),_0xda0472=_0x3783e1['getFullYear'](),_0x3912ba=_0xda0472+'-'+_0x1664bb+'-'+_0x156d8f;const _0x3ffbe3=new customer_payment({'invoice':_0x4b9ad1,'date':_0xda0472+'-'+_0x1664bb+'-'+_0x156d8f,'customer':_0x515cc8,'reason':_0x28f531(0xa9),'amount':_0x299fee}),_0x5509cd=await _0x3ffbe3[_0x28f531(0xf6)]();_0x1384dc[_0x28f531(0x127)]('success',_0x28f531(0x140)),_0x1adb84[_0x28f531(0xa1)](_0x28f531(0xcc));}catch(_0x2423bd){console[_0x28f531(0xc9)](_0x2423bd);}}),router[a0_0x123b10(0x16c)]('/invoice/:id',auth,async(_0x3ca92f,_0x2723dd)=>{var _0x59ff15=a0_0x123b10;try{const {username:_0x23c82d,email:_0x1220fd,role:_0xd364e2}=_0x3ca92f['user'],_0x47f2ef=_0x3ca92f[_0x59ff15(0x14a)],_0x30e170=await profile[_0x59ff15(0xad)]({'email':_0x47f2ef[_0x59ff15(0x10b)]}),_0x6f79ff=await master_shop['find']();console[_0x59ff15(0xc9)](_0x59ff15(0xe0),_0x6f79ff);const _0x57c112=_0x3ca92f[_0x59ff15(0x143)]['id'],_0x4717aa=await sales[_0x59ff15(0xdc)](_0x57c112);console['log'](_0x4717aa);const _0x1593c4=await customer[_0x59ff15(0xad)]({'name':_0x4717aa[_0x59ff15(0x116)]});console[_0x59ff15(0xc9)](_0x1593c4);if(_0x6f79ff[0x0][_0x59ff15(0xf1)]==_0x59ff15(0x189)){var _0x1a9cce=users[_0x59ff15(0x149)];console[_0x59ff15(0xc9)](_0x1a9cce);}else{if(_0x6f79ff[0x0][_0x59ff15(0xf1)]==_0x59ff15(0x18f))var _0x1a9cce=users[_0x59ff15(0x18f)];else{if(_0x6f79ff[0x0][_0x59ff15(0xf1)]=='German')var _0x1a9cce=users[_0x59ff15(0x11a)];else{if(_0x6f79ff[0x0][_0x59ff15(0xf1)]=='Spanish')var _0x1a9cce=users[_0x59ff15(0xa8)];else{if(_0x6f79ff[0x0]['language']=='French')var _0x1a9cce=users[_0x59ff15(0x152)];else{if(_0x6f79ff[0x0][_0x59ff15(0xf1)]==_0x59ff15(0x134))var _0x1a9cce=users[_0x59ff15(0x8d)];else{if(_0x6f79ff[0x0]['language']=='Chinese')var _0x1a9cce=users[_0x59ff15(0xbb)];else{if(_0x6f79ff[0x0][_0x59ff15(0xf1)]=='Arabic\x20(ae)')var _0x1a9cce=users[_0x59ff15(0xac)];}}}}}}}_0x2723dd['render']('sales_invoice',{'success':_0x3ca92f[_0x59ff15(0x127)]('success'),'errors':_0x3ca92f[_0x59ff15(0x127)](_0x59ff15(0x145)),'role':_0x47f2ef,'profile':_0x30e170,'master_shop':_0x6f79ff,'customers':_0x1593c4,'sales':_0x4717aa,'language':_0x1a9cce});}catch(_0x35c1c4){console[_0x59ff15(0xc9)](_0x35c1c4);}}),router['get'](a0_0x123b10(0xab),auth,async(_0x306fdd,_0x12e1da)=>{var _0x52540e=a0_0x123b10;try{const {username:_0x49aeb1,email:_0x3cf650,role:_0x52c0b2}=_0x306fdd[_0x52540e(0x14a)],_0x339c70=_0x306fdd[_0x52540e(0x14a)],_0x20e1e5=await profile[_0x52540e(0xad)]({'email':_0x339c70[_0x52540e(0x10b)]}),_0x8d423b=await master_shop[_0x52540e(0x10c)]();console[_0x52540e(0xc9)](_0x52540e(0xe0),_0x8d423b);const _0x41a17d=_0x306fdd[_0x52540e(0x143)]['id'];console[_0x52540e(0xc9)](_0x41a17d);const _0xf87ab0=await sales['findById'](_0x41a17d);console['log'](_0x52540e(0xdd),_0xf87ab0);const _0x55cb91=await warehouse[_0x52540e(0xa5)]([{'$match':{'name':_0x52540e(0x8e),'room':'Return\x20Rooms'}},{'$unwind':_0x52540e(0xb3)},{'$group':{'_id':_0x52540e(0x168),'name':{'$first':_0x52540e(0xae)},'product_stock':{'$first':_0x52540e(0x144)},'level':{'$first':_0x52540e(0x13b)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x52540e(0x16b)},'secondary_code':{'$first':_0x52540e(0x17b)},'product_code':{'$first':_0x52540e(0x150)}}}]);console[_0x52540e(0xc9)](_0x52540e(0x159),_0x55cb91);const _0x570b49=await product[_0x52540e(0x10c)]({});warehouse_data=await warehouse[_0x52540e(0xa5)]([{'$match':{'status':_0x52540e(0x12d),'name':_0x52540e(0x8e),'warehouse_category':_0x52540e(0xf0)}},{'$group':{'_id':_0x52540e(0xf9),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x415988=['Return\x20Rooms'];if(_0x8d423b[0x0][_0x52540e(0xf1)]==_0x52540e(0x189)){var _0x4a9cdc=users['English'];console[_0x52540e(0xc9)](_0x4a9cdc);}else{if(_0x8d423b[0x0][_0x52540e(0xf1)]=='Hindi')var _0x4a9cdc=users['Hindi'];else{if(_0x8d423b[0x0][_0x52540e(0xf1)]==_0x52540e(0x11a))var _0x4a9cdc=users['German'];else{if(_0x8d423b[0x0][_0x52540e(0xf1)]=='Spanish')var _0x4a9cdc=users['Spanish'];else{if(_0x8d423b[0x0]['language']==_0x52540e(0x152))var _0x4a9cdc=users[_0x52540e(0x152)];else{if(_0x8d423b[0x0][_0x52540e(0xf1)]==_0x52540e(0x134))var _0x4a9cdc=users[_0x52540e(0x8d)];else{if(_0x8d423b[0x0][_0x52540e(0xf1)]=='Chinese')var _0x4a9cdc=users[_0x52540e(0xbb)];else{if(_0x8d423b[0x0][_0x52540e(0xf1)]=='Arabic\x20(ae)')var _0x4a9cdc=users[_0x52540e(0xac)];}}}}}}}_0x12e1da[_0x52540e(0xee)](_0x52540e(0x94),{'success':_0x306fdd[_0x52540e(0x127)]('success'),'errors':_0x306fdd[_0x52540e(0x127)](_0x52540e(0x145)),'role':_0x339c70,'profile':_0x20e1e5,'user':_0xf87ab0,'stock':_0x55cb91,'master_shop':_0x8d423b,'unit':_0x570b49,'language':_0x4a9cdc,'warehouses':warehouse_data,'rooms':_0x415988});}catch(_0x40e668){console[_0x52540e(0xc9)](_0x40e668),_0x12e1da[_0x52540e(0xc6)](0xc8)[_0x52540e(0x109)]({'message':_0x40e668['message']});}}),router['post']('/view/return_sales/:id',auth,async(_0x1425a7,_0x4175e4)=>{var _0x44cb39=a0_0x123b10;try{const {invoice:_0x5791b7,date:_0x5e8ff9,warehouse_name:_0x28e1e1,product_name:_0x27f5f9,primary_code:_0x44e524,secondary_code:_0x3aaa1e,product_code:_0xaca148,sales_quantity:_0x58b6ac,stocks:_0x2ec273,return_qty:_0x4ec57b,Room_name:_0x373e80,to_warehouse_name:_0x58c01a,to_Roomname:_0x2834d9,to_Room_name:_0x54ba01,note:_0x4ddf04,level:_0x1b701c,isle:_0x3e4902,pallet:_0x1897aa}=_0x1425a7[_0x44cb39(0xb9)];if(typeof _0x27f5f9=='string')var _0x3abbea=[_0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x99)]],_0x2d1a74=[_0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x9a)]],_0x47953c=[_0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x158)]],_0x436c2e=[_0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x124)]],_0x4742a7=[_0x1425a7['body'][_0x44cb39(0x179)]],_0x3dcc86=[_0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x187)]],_0x5b1a7e=[_0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x126)]],_0x308bee=[_0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0xec)]],_0x250f95=[_0x1425a7['body']['bin']],_0x7c5fe4=[_0x1425a7['body']['types']],_0x5057f=[_0x1425a7[_0x44cb39(0xb9)]['floorlevel']];else var _0x3abbea=[..._0x1425a7['body'][_0x44cb39(0x99)]],_0x2d1a74=[..._0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x9a)]],_0x47953c=[..._0x1425a7[_0x44cb39(0xb9)]['secondary_code']],_0x436c2e=[..._0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x124)]],_0x4742a7=[..._0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x179)]],_0x3dcc86=[..._0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x187)]],_0x5b1a7e=[..._0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x126)]],_0x308bee=[..._0x1425a7['body'][_0x44cb39(0xec)]],_0x250f95=[..._0x1425a7[_0x44cb39(0xb9)]['bin']],_0x7c5fe4=[..._0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x13d)]],_0x5057f=[..._0x1425a7[_0x44cb39(0xb9)][_0x44cb39(0x12b)]];const _0x3d5588=_0x3abbea[_0x44cb39(0xa2)](_0x3bfa7b=>{return _0x3bfa7b={'product_name':_0x3bfa7b};});_0x2d1a74[_0x44cb39(0x194)]((_0x3d6fa7,_0x5afe4a)=>{var _0x5915d0=_0x44cb39;_0x3d5588[_0x5afe4a][_0x5915d0(0x9a)]=_0x3d6fa7;}),_0x47953c[_0x44cb39(0x194)]((_0x50fdc5,_0x5a7bc8)=>{_0x3d5588[_0x5a7bc8]['secondary_code']=_0x50fdc5;}),_0x436c2e[_0x44cb39(0x194)]((_0x1de572,_0x193571)=>{var _0x213f98=_0x44cb39;_0x3d5588[_0x193571][_0x213f98(0x124)]=_0x1de572;}),_0x4742a7['forEach']((_0x309c55,_0x339602)=>{_0x3d5588[_0x339602]['sale_qty']=_0x309c55;}),_0x3dcc86[_0x44cb39(0x194)]((_0x59a857,_0x4bda72)=>{var _0x4dfe58=_0x44cb39;_0x3d5588[_0x4bda72][_0x4dfe58(0x101)]=_0x59a857;}),_0x5b1a7e['forEach']((_0x10be5a,_0x4d4466)=>{var _0x2d808d=_0x44cb39;_0x3d5588[_0x4d4466][_0x2d808d(0x126)]=_0x10be5a;}),_0x308bee[_0x44cb39(0x194)]((_0x339b8a,_0x3b6e44)=>{var _0x4e4770=_0x44cb39;_0x3d5588[_0x3b6e44][_0x4e4770(0xec)]=_0x339b8a;}),_0x250f95[_0x44cb39(0x194)]((_0x4ad4f7,_0x268704)=>{var _0x495d77=_0x44cb39;_0x3d5588[_0x268704][_0x495d77(0x132)]=_0x4ad4f7;}),_0x7c5fe4[_0x44cb39(0x194)]((_0x378c81,_0x3d8e86)=>{var _0xda6c86=_0x44cb39;_0x3d5588[_0x3d8e86][_0xda6c86(0x136)]=_0x378c81;}),_0x5057f[_0x44cb39(0x194)]((_0x9878ae,_0x18caae)=>{var _0x42ea95=_0x44cb39;_0x3d5588[_0x18caae][_0x42ea95(0x12b)]=_0x9878ae;});var _0x4b6ba3=0x0;_0x3d5588['forEach'](_0xa97189=>{var _0x297b74=_0x44cb39;console[_0x297b74(0xc9)](_0x297b74(0x11b),_0xa97189),(parseInt(_0xa97189[_0x297b74(0x96)])<parseInt(_0xa97189[_0x297b74(0x126)])||parseInt(_0xa97189[_0x297b74(0x101)])<parseInt(_0xa97189[_0x297b74(0x126)])&&parseInt(_0xa97189[_0x297b74(0x96)])>parseInt(_0xa97189[_0x297b74(0x126)])||parseInt(_0xa97189['return_qty'])==0x0)&&_0x4b6ba3++;});if(_0x4b6ba3!=0x0)return _0x1425a7['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x4175e4[_0x44cb39(0xa1)](_0x44cb39(0x108));const _0x3c8e54=await sales[_0x44cb39(0xad)]({'invoice':_0x5791b7});console[_0x44cb39(0xc9)](_0x3c8e54),_0x3c8e54['return_data']=_0x44cb39(0xe8);const _0xf312ca=await _0x3c8e54[_0x44cb39(0xf6)](),_0x42dbfd=new sales_return({'invoice':_0x5791b7,'customer':_0x1425a7['body'][_0x44cb39(0x116)],'date':_0x5e8ff9,'warehouse_name':_0x28e1e1,'room':_0x373e80,'ToWarehouse':_0x58c01a,'ToRoom':_0x54ba01,'return_sale':_0x3d5588,'note':_0x4ddf04}),_0xc3051=await _0x42dbfd[_0x44cb39(0xf6)]();console[_0x44cb39(0xc9)](_0x42dbfd);const _0x219816=await sales_return[_0x44cb39(0xad)]({'invoice':_0x5791b7}),_0x1f389d=await warehouse[_0x44cb39(0xad)]({'name':_0x58c01a,'room':_0x54ba01});_0x219816[_0x44cb39(0x94)]['forEach'](_0x8f465e=>{var _0x361396=_0x44cb39,_0x1e85ef=0x0;const _0x412ce6=_0x1f389d[_0x361396(0x123)][_0x361396(0xa2)](_0xafc1bc=>{var _0x138ac2=_0x361396;_0xafc1bc[_0x138ac2(0x99)]==_0x8f465e[_0x138ac2(0x99)]&&_0xafc1bc['floorlevel']==_0x8f465e[_0x138ac2(0x12b)]&&_0xafc1bc[_0x138ac2(0x136)]==_0x8f465e[_0x138ac2(0x136)]&&_0xafc1bc['bin']==_0x8f465e['bin']&&_0xafc1bc[_0x138ac2(0xec)]==_0x8f465e['bay']&&(_0xafc1bc['product_stock']=parseInt(_0xafc1bc['product_stock'])+parseInt(_0x8f465e['return_qty']),_0x1e85ef++);});_0x1e85ef=='0'&&(_0x1f389d[_0x361396(0x123)]=_0x1f389d[_0x361396(0x123)][_0x361396(0xb0)]({'product_name':_0x8f465e[_0x361396(0x99)],'product_stock':_0x8f465e['return_qty'],'primary_code':_0x8f465e[_0x361396(0x9a)],'secondary_code':_0x8f465e[_0x361396(0x158)],'product_code':_0x8f465e[_0x361396(0x124)],'bay':_0x8f465e['bay'],'bin':_0x8f465e[_0x361396(0x132)],'type':_0x8f465e['type'],'floorlevel':_0x8f465e[_0x361396(0x12b)]})),console[_0x361396(0xc9)](_0x361396(0x177),_0x1f389d);}),await _0x1f389d[_0x44cb39(0xf6)](),console[_0x44cb39(0xc9)](_0x1425a7[_0x44cb39(0xb9)]);const _0x5c45fd=new c_payment_data({'invoice':_0x5791b7,'customer':_0x1425a7['body']['customer'],'reason':_0x44cb39(0xd3)});await _0x5c45fd[_0x44cb39(0xf6)]();const _0x29f60f=await master_shop['find']();console[_0x44cb39(0xc9)](_0x44cb39(0xba),_0x29f60f[0x0]['image']);const _0x2e172c=await email_settings[_0x44cb39(0xad)](),_0x50f224=await customer[_0x44cb39(0xad)]({'name':_0x1425a7['body'][_0x44cb39(0x116)]});console['log']('customer_data',_0x50f224);_0x29f60f[0x0][_0x44cb39(0xbd)]==0x1?(right_currency=_0x29f60f[0x0][_0x44cb39(0xfb)],left_currency=''):(right_currency='',left_currency=_0x29f60f[0x0][_0x44cb39(0xfb)]);var _0x4b9553=_0x3abbea,_0x27c33f=_0x5b1a7e,_0x19aa54='',_0x21b714;for(_0x21b714 in _0x4b9553){_0x19aa54+=_0x44cb39(0x125)+_0x44cb39(0x182)+_0x4b9553[_0x21b714]+_0x44cb39(0xe3)+_0x44cb39(0x182)+_0x27c33f[_0x21b714]+'</td>'+_0x44cb39(0x111);}console['log'](_0x44cb39(0x12a),_0x19aa54);let _0x17c855=nodemailer[_0x44cb39(0xd6)]({'service':'gmail','auth':{'user':_0x2e172c[_0x44cb39(0x10b)],'pass':_0x2e172c[_0x44cb39(0x16d)]}}),_0x28f536={'from':_0x2e172c[_0x44cb39(0x10b)],'to':_0x50f224[_0x44cb39(0x10b)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x44cb39(0xc7),'path':__dirname+_0x44cb39(0x13f)+_0x44cb39(0x133)+_0x29f60f[0x0][_0x44cb39(0x192)],'cid':_0x44cb39(0x15d)}],'html':_0x44cb39(0x167)+_0x44cb39(0x121)+_0x44cb39(0x18e)+_0x44cb39(0x193)+_0x44cb39(0xa0)+_0x44cb39(0x193)+_0x44cb39(0xb8)+_0x44cb39(0x106)+_0x44cb39(0x193)+_0x44cb39(0xa3)+_0x29f60f[0x0][_0x44cb39(0x154)]+'\x20</h2>'+'</div>'+_0x44cb39(0x106)+'<hr\x20class=\x22my-3\x22>'+_0x44cb39(0x193)+_0x44cb39(0x17e)+'\x20Order\x20Number\x20:\x20'+_0x5791b7+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x44cb39(0xbf)+_0x5e8ff9+'\x20'+_0x44cb39(0x18d)+_0x44cb39(0x165)+_0x44cb39(0x106)+_0x44cb39(0xc2)+_0x44cb39(0x161)+_0x44cb39(0x125)+_0x44cb39(0x107)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x44cb39(0x102)+_0x44cb39(0xa6)+'</tr>'+_0x44cb39(0xcf)+_0x44cb39(0x8f)+'\x20'+_0x19aa54+'\x20'+_0x44cb39(0x13a)+_0x44cb39(0x17f)+_0x44cb39(0x193)+_0x44cb39(0xce)+_0x44cb39(0x91)+_0x29f60f[0x0][_0x44cb39(0x154)]+_0x44cb39(0x165)+_0x44cb39(0x106)+_0x44cb39(0x106)+_0x44cb39(0x15f)};_0x17c855['sendMail'](_0x28f536,function(_0x26685b,_0x5508ad){var _0x2bd467=_0x44cb39;_0x26685b?(console['log'](_0x26685b),console['log'](_0x2bd467(0x12e))):console[_0x2bd467(0xc9)](_0x2bd467(0xaa));}),_0x1425a7['flash'](_0x44cb39(0x147),'sales\x20item\x20return\x20successfull'),_0x4175e4[_0x44cb39(0xa1)](_0x44cb39(0xcc));}catch(_0x13ad11){console[_0x44cb39(0xc9)](_0x13ad11),_0x4175e4[_0x44cb39(0xc6)](0xc8)['json']({'message1':_0x13ad11[_0x44cb39(0x157)]});}}),router[a0_0x123b10(0x16c)](a0_0x123b10(0x185),auth,async(_0x150149,_0x12e909)=>{var _0x203384=a0_0x123b10;try{const {username:_0x203c4e,email:_0x5ca998,role:_0xa0c17e}=_0x150149[_0x203384(0x14a)],_0x263f9f=_0x150149[_0x203384(0x14a)],_0x4e7c6c=await profile['findOne']({'email':_0x263f9f[_0x203384(0x10b)]}),_0x39928f=await master_shop[_0x203384(0x10c)]();console[_0x203384(0xc9)]('barcode\x20Product\x20master',_0x39928f);const _0x2b00e5=_0x150149[_0x203384(0x143)]['id'],_0x5604dd=await sales[_0x203384(0xdc)](_0x2b00e5);console[_0x203384(0xc9)]('barcode\x20user_id',_0x5604dd);if(_0x39928f[0x0][_0x203384(0xf1)]=='English\x20(US)')var _0x64c120=users[_0x203384(0x149)];else{if(_0x39928f[0x0][_0x203384(0xf1)]==_0x203384(0x18f))var _0x64c120=users['Hindi'];else{if(_0x39928f[0x0][_0x203384(0xf1)]==_0x203384(0x11a))var _0x64c120=users['German'];else{if(_0x39928f[0x0][_0x203384(0xf1)]==_0x203384(0xa8))var _0x64c120=users[_0x203384(0xa8)];else{if(_0x39928f[0x0][_0x203384(0xf1)]=='French')var _0x64c120=users[_0x203384(0x152)];else{if(_0x39928f[0x0]['language']=='Portuguese\x20(BR)')var _0x64c120=users['Portuguese'];else{if(_0x39928f[0x0][_0x203384(0xf1)]=='Chinese')var _0x64c120=users[_0x203384(0xbb)];else{if(_0x39928f[0x0][_0x203384(0xf1)]==_0x203384(0x17c))var _0x64c120=users[_0x203384(0xac)];}}}}}}}_0x12e909['render'](_0x203384(0x137),{'success':_0x150149[_0x203384(0x127)]('success'),'errors':_0x150149[_0x203384(0x127)](_0x203384(0x145)),'role':_0x263f9f,'profile':_0x4e7c6c,'alldata':_0x5604dd,'master_shop':_0x39928f,'language':_0x64c120});}catch(_0xdc3995){console['log'](_0xdc3995);}}),router[a0_0x123b10(0xe6)](a0_0x123b10(0x166),async(_0x33a205,_0x329015)=>{var _0x55f81f=a0_0x123b10;const {product_code:_0x340e23,warehouse_name:_0x44fd5d,rooms_data:_0x424383,Roomslist:_0x8d7b36}=_0x33a205[_0x55f81f(0xb9)],_0x53097b=_0x8d7b36[_0x55f81f(0x131)](','),_0x1672de=[];async function _0x35ae62(_0x5de872){var _0x286048=_0x55f81f;const _0x534fe7=await warehouse[_0x286048(0xa5)]([{'$match':{'name':_0x44fd5d,'room':_0x5de872}},{'$unwind':_0x286048(0xb3)},{'$match':{'product_details.primary_code':_0x340e23}},{'$group':{'_id':_0x286048(0x168),'name':{'$first':_0x286048(0xae)},'product_stock':{'$first':_0x286048(0x144)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x286048(0x14e)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x286048(0x90)},'pallet':{'$first':_0x286048(0x97)},'unit':{'$first':_0x286048(0xb5)},'secondary_unit':{'$first':_0x286048(0xe2)},'storage':{'$first':_0x286048(0xe4)},'rack':{'$first':_0x286048(0xe1)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x286048(0xb6)},'batch_code':{'$first':_0x286048(0x92)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x286048(0x155)},'actual_qty':{'$first':_0x286048(0xa4)},'actual_uom':{'$first':_0x286048(0x138)}}}]),_0x49db96=await warehouse[_0x286048(0xa5)]([{'$match':{'name':_0x44fd5d,'room':_0x5de872}},{'$unwind':_0x286048(0xb3)},{'$match':{'product_details.secondary_code':_0x340e23}},{'$group':{'_id':_0x286048(0x168),'name':{'$first':_0x286048(0xae)},'product_stock':{'$first':_0x286048(0x144)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x286048(0x17b)},'product_code':{'$first':_0x286048(0x150)},'level':{'$first':_0x286048(0x14e)},'isle':{'$first':_0x286048(0xd7)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x286048(0xe2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x286048(0xe1)},'expiry_date':{'$first':_0x286048(0x100)},'production_date':{'$first':_0x286048(0xc0)},'maxPerUnit':{'$first':_0x286048(0xb6)},'batch_code':{'$first':_0x286048(0x92)},'product_cat':{'$first':_0x286048(0x151)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x286048(0xc5)},'invoice':{'$first':_0x286048(0x155)}}}]);if(_0x534fe7['length']>0x0)_0x1672de[_0x286048(0x175)](_0x534fe7);else _0x49db96[_0x286048(0x15c)]>0x0&&_0x1672de[_0x286048(0x175)](_0x49db96);}const _0x26d762=_0x53097b[_0x55f81f(0xa2)](_0x2c0b7f=>_0x35ae62(_0x2c0b7f));await Promise[_0x55f81f(0x114)](_0x26d762),_0x329015[_0x55f81f(0x109)](_0x1672de);}),module[a0_0x123b10(0xd0)]=router;