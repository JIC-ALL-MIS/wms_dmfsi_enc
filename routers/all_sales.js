function a0_0x343f(){var _0x4017b4=['secondary_unit','$product_details.product_cat','actual_qty','German','$product_details','160020NlVgru','/all_sales/preview/','Level','<h5>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','English','logo','$sale_product.type','customer','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','English\x20(US)','2002524oUquaY','2932240jeCgsq','../middleware/auth','message','product_code','/view','../public/language/languages.json','stock_data','Return\x20Goods','$customers_docs','post','/barcode/:id','sales_invoice','find','id_transaction_from','quantity_notConverted','expiry_date','batch_code','maxperunit','prod_code','$product_details.product_code','9yIzfPG','rack','Logo.png','Sales\x20Mail','$product_details.expiry_date','False','payment\x20successfull','</tbody>','user_id','map','sales_quantity','Enabled','sale_qty','quantity','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.bin','errors','<div>','getDate','slice','$product_details.primary_code','</div>','bin','$warehouse_name','</body></html>','role','type','</td>','finalize','add_sales','sales\x20all_data','aggregate','/view/:id','customers_docs','Receiving\x20Area','received_amount','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Arabic\x20(ae)','production_date','max_per_unit','Hindi','Raw\x20Materials','\x20Order\x20Number\x20:\x20','$product_details.actual_qty','delivery_code','Router','$product_details.level','room_name','body','edit_sales_view','$product_details.batch_code','return_sale','save','Sale\x20Return','$product_details._id','$product_details.maxPerUnit','secondary_code','redirect','storage','warehouse_name','</head><body>','$finalize','name','bay','French','$product_details.bay','$name','all_sales','Error\x20Occurs','prod_invoice','all','push','email','/upload/','<h2>\x20','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</h5>','forEach','378395HTfCnl','$product_details.secondary_code','string','createTransport','warehouse','/preview/:id','sendMail','Floor','carton','requested_qty','product_name','5526RsJvrt','site_title','all_sales_barcode','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</tr>','$customer','sales\x20item\x20return\x20successfull','log','/view/return_sales/:id','product_list','gmail','isAllowEdit','$product_details.unit','unit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<html><head><title></title>','back','<!DOCTYPE\x20html>','$date','<tbody\x20style=\x22text-align:\x20center;\x22>','language','<h5\x20style=\x22text-align:\x20left;\x22>','Enclosed','note','exports','flash','product_details','status','then','prod_cat','$product_details.actual_uom','getMonth','<tr>','$product_details.secondary_unit','Return\x20Rooms','return_data','add\x20post','Chinese','render','types','customers','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','findById','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_name','floorlevel','Spanish','Sales\x20Update\x20successfully','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<span\x20style=\x22float:\x20right;\x22>','804ueZclf','due_amount','/view/add_sale/product','Shelves','$sale_product.bay','edit_sales','True','return_qty','$product_details.product_stock','$product_details.production_date','RoomAssigned','$product_details.invoice','length','/view/add_sales','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','delivery_date','$room','floor','_id','host','Ambient','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$isAllowEdit','padStart','$sale_product.quantity','<strong>\x20Regards\x20</strong>','user','error','room','currency','image','$sale_product.bin','/barcode_scanner','/../public','actual_uom','15625450jxypFO','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','</span>','3503283OcKxeW','$_id','sale_product','id_transact','get','port','$product_details.isle','password','$note','params','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$return_data','abs','$product_details.rack','6MrcTzz','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','foreach\x20newproduct','$product_details.storage','product_stock','product_data','/all_sales/view','filter','primary_unit','master','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','barcode\x20Product\x20master','success','level','barcode\x20user_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','<hr\x20class=\x22my-3\x22>','staff','catch','invoice','</table>','OUT-','Portuguese\x20(BR)','\x20</h2>','</thead>','$invoice','product','currency_placement','json','Sales\x20Add\x20successfully','$sale_product.floorlevel','/give_payment/:id','primary_code','$product_details.type','\x20Order\x20Date\x20:\x20','amount','stock','$sale_product','random'];a0_0x343f=function(){return _0x4017b4;};return a0_0x343f();}var a0_0x29f14d=a0_0x3157;function a0_0x3157(_0x524132,_0x9cdc55){var _0x343f47=a0_0x343f();return a0_0x3157=function(_0x3157ab,_0x5b0272){_0x3157ab=_0x3157ab-0x111;var _0x512e9b=_0x343f47[_0x3157ab];return _0x512e9b;},a0_0x3157(_0x524132,_0x9cdc55);}(function(_0x4d3e79,_0x422da1){var _0x26b92c=a0_0x3157,_0x3c14dc=_0x4d3e79();while(!![]){try{var _0x13cad4=-parseInt(_0x26b92c(0x151))/0x1+-parseInt(_0x26b92c(0x203))/0x2*(parseInt(_0x26b92c(0x1cf))/0x3)+parseInt(_0x26b92c(0x15d))/0x4+parseInt(_0x26b92c(0x1c4))/0x5+parseInt(_0x26b92c(0x124))/0x6*(-parseInt(_0x26b92c(0x116))/0x7)+-parseInt(_0x26b92c(0x15e))/0x8+-parseInt(_0x26b92c(0x172))/0x9*(-parseInt(_0x26b92c(0x113))/0xa);if(_0x13cad4===_0x422da1)break;else _0x3c14dc['push'](_0x3c14dc['shift']());}catch(_0x4950ec){_0x3c14dc['push'](_0x3c14dc['shift']());}}}(a0_0x343f,0x5aa98));const express=require('express'),app=express(),router=express[a0_0x29f14d(0x1a2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x29f14d(0x15f)),nodemailer=require('nodemailer'),users=require(a0_0x29f14d(0x163));router[a0_0x29f14d(0x11a)](a0_0x29f14d(0x162),auth,async(_0x524972,_0x4942ad)=>{var _0x36dfe3=a0_0x29f14d;try{const {username:_0xa00de6,email:_0x3559ee,role:_0x381d6e}=_0x524972['user'],_0x228040=_0x524972[_0x36dfe3(0x21d)],_0x22a2f4=await profile[_0x36dfe3(0x197)]({'email':_0x228040[_0x36dfe3(0x1bd)]}),_0x476dc1=await master_shop[_0x36dfe3(0x16a)]();let _0x3a693d;if(_0x228040[_0x36dfe3(0x18c)]==_0x36dfe3(0x136)){const _0x31ce95=await staff[_0x36dfe3(0x197)]({'email':_0x228040['email']});_0x3a693d=await sales[_0x36dfe3(0x192)]([{'$lookup':{'from':_0x36dfe3(0x1f7),'localField':_0x36dfe3(0x159),'foreignField':_0x36dfe3(0x1b3),'as':_0x36dfe3(0x194)}},{'$unwind':_0x36dfe3(0x166)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x36dfe3(0x117),'invoice':{'$first':_0x36dfe3(0x13e)},'customers':{'$first':_0x36dfe3(0x1d4)},'date':{'$first':_0x36dfe3(0x1e1)},'warehouse_name':{'$first':_0x36dfe3(0x18a)},'sale_product':{'$push':_0x36dfe3(0x14a)},'note':{'$first':_0x36dfe3(0x11e)},'return_data':{'$first':_0x36dfe3(0x121)},'customers_docs':{'$first':_0x36dfe3(0x166)},'total_saleproduct_quantity':{'$sum':_0x36dfe3(0x21b)},'level':{'$addToSet':_0x36dfe3(0x207)},'isle':{'$addToSet':_0x36dfe3(0x222)},'type':{'$addToSet':_0x36dfe3(0x158)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x36dfe3(0x1b2)},'isAllowEdit':{'$first':_0x36dfe3(0x219)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x3a693d=await sales[_0x36dfe3(0x192)]([{'$lookup':{'from':_0x36dfe3(0x1f7),'localField':'customer','foreignField':'name','as':_0x36dfe3(0x194)}},{'$unwind':_0x36dfe3(0x166)},{'$unwind':_0x36dfe3(0x14a)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x36dfe3(0x1d4)},'date':{'$first':_0x36dfe3(0x1e1)},'warehouse_name':{'$first':_0x36dfe3(0x18a)},'sale_product':{'$push':_0x36dfe3(0x14a)},'note':{'$first':_0x36dfe3(0x11e)},'return_data':{'$first':_0x36dfe3(0x121)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x36dfe3(0x21b)},'level':{'$addToSet':_0x36dfe3(0x207)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x36dfe3(0x158)},'pallet':{'$addToSet':_0x36dfe3(0x143)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x36dfe3(0x219)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x36dfe3(0x191),_0x3a693d);if(_0x476dc1[0x0][_0x36dfe3(0x1e3)]==_0x36dfe3(0x15c)){var _0x4ee8c0=users[_0x36dfe3(0x156)];console[_0x36dfe3(0x1d6)](_0x4ee8c0);}else{if(_0x476dc1[0x0][_0x36dfe3(0x1e3)]=='Hindi')var _0x4ee8c0=users[_0x36dfe3(0x19d)];else{if(_0x476dc1[0x0][_0x36dfe3(0x1e3)]==_0x36dfe3(0x14f))var _0x4ee8c0=users[_0x36dfe3(0x14f)];else{if(_0x476dc1[0x0]['language']==_0x36dfe3(0x1fe))var _0x4ee8c0=users[_0x36dfe3(0x1fe)];else{if(_0x476dc1[0x0][_0x36dfe3(0x1e3)]==_0x36dfe3(0x1b5))var _0x4ee8c0=users[_0x36dfe3(0x1b5)];else{if(_0x476dc1[0x0][_0x36dfe3(0x1e3)]==_0x36dfe3(0x13b))var _0x4ee8c0=users[_0x36dfe3(0x200)];else{if(_0x476dc1[0x0][_0x36dfe3(0x1e3)]==_0x36dfe3(0x1f4))var _0x4ee8c0=users[_0x36dfe3(0x1f4)];else{if(_0x476dc1[0x0][_0x36dfe3(0x1e3)]==_0x36dfe3(0x19a))var _0x4ee8c0=users[_0x36dfe3(0x15a)];}}}}}}}_0x4942ad['render'](_0x36dfe3(0x1b8),{'success':_0x524972[_0x36dfe3(0x1e8)](_0x36dfe3(0x131)),'errors':_0x524972[_0x36dfe3(0x1e8)](_0x36dfe3(0x183)),'sales':_0x3a693d,'profile':_0x22a2f4,'role':_0x228040,'master_shop':_0x476dc1,'language':_0x4ee8c0});}catch(_0x541728){console[_0x36dfe3(0x1d6)](_0x541728);}});async function getRandom8DigitNumber(){var _0xb106e8=a0_0x29f14d;const _0x12aee2=0x989680,_0x221c22=0x5f5e0ff,_0x689762=Math[_0xb106e8(0x214)](Math[_0xb106e8(0x14b)]()*(_0x221c22-_0x12aee2+0x1))+_0x12aee2;var _0x521766;const _0x4bc4b7=await sales['findOne']({'invoice':_0xb106e8(0x13a)+_0x689762});return _0x4bc4b7&&_0x4bc4b7['length']>0x0?_0x521766=_0xb106e8(0x13a)+_0x689762:_0x521766=_0xb106e8(0x13a)+_0x689762,_0x521766;}router[a0_0x29f14d(0x11a)](a0_0x29f14d(0x210),auth,async(_0x4cc425,_0xc43185)=>{var _0x41bcd9=a0_0x29f14d;try{const {username:_0x2ec4b4,email:_0x41e594,role:_0x1d3e8a}=_0x4cc425[_0x41bcd9(0x21d)],_0x39bdc9=_0x4cc425[_0x41bcd9(0x21d)],_0x418a78=await profile[_0x41bcd9(0x197)]({'email':_0x39bdc9[_0x41bcd9(0x1bd)]}),_0x201dc9=await master_shop[_0x41bcd9(0x16a)](),_0x193fc2=await customer[_0x41bcd9(0x16a)]({});let _0x5dbb52;if(_0x39bdc9[_0x41bcd9(0x18c)]==_0x41bcd9(0x136)){const _0x2ec9c3=await staff[_0x41bcd9(0x197)]({'email':_0x39bdc9['email']});_0x5dbb52=await warehouse[_0x41bcd9(0x192)]([{'$match':{'status':'Enabled','name':_0x2ec9c3[_0x41bcd9(0x1c8)],'warehouse_category':_0x41bcd9(0x19e),'name':{'$ne':_0x41bcd9(0x165)}}},{'$group':{'_id':_0x41bcd9(0x1b7),'name':{'$first':_0x41bcd9(0x1b7)}}},{'$sort':{'name':0x1}}]);}else _0x5dbb52=await warehouse[_0x41bcd9(0x192)]([{'$match':{'status':_0x41bcd9(0x17d),'warehouse_category':_0x41bcd9(0x19e),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x41bcd9(0x1b7),'name':{'$first':_0x41bcd9(0x1b7)}}},{'$sort':{'name':0x1}}]);const _0x2096e1=await product[_0x41bcd9(0x16a)]({});var _0x24d4ad=['Ambient',_0x41bcd9(0x1e5)];const _0x506b94=await sales[_0x41bcd9(0x16a)]({}),_0x4f7adc=_0x506b94[_0x41bcd9(0x20f)]+0x1,_0x511548=_0x41bcd9(0x13a)+_0x4f7adc['toString']()[_0x41bcd9(0x21a)](0x5,'0');if(_0x201dc9[0x0]['language']==_0x41bcd9(0x15c)){var _0x51825d=users['English'];console[_0x41bcd9(0x1d6)](_0x51825d);}else{if(_0x201dc9[0x0][_0x41bcd9(0x1e3)]==_0x41bcd9(0x19d))var _0x51825d=users[_0x41bcd9(0x19d)];else{if(_0x201dc9[0x0]['language']=='German')var _0x51825d=users[_0x41bcd9(0x14f)];else{if(_0x201dc9[0x0]['language']==_0x41bcd9(0x1fe))var _0x51825d=users[_0x41bcd9(0x1fe)];else{if(_0x201dc9[0x0][_0x41bcd9(0x1e3)]==_0x41bcd9(0x1b5))var _0x51825d=users[_0x41bcd9(0x1b5)];else{if(_0x201dc9[0x0][_0x41bcd9(0x1e3)]==_0x41bcd9(0x13b))var _0x51825d=users[_0x41bcd9(0x200)];else{if(_0x201dc9[0x0][_0x41bcd9(0x1e3)]==_0x41bcd9(0x1f4))var _0x51825d=users['Chinese'];else{if(_0x201dc9[0x0][_0x41bcd9(0x1e3)]==_0x41bcd9(0x19a))var _0x51825d=users['Arabic'];}}}}}}}const _0x216b55=getRandom8DigitNumber();_0x216b55[_0x41bcd9(0x1eb)](_0x13babe=>{var _0x50f702=_0x41bcd9;_0xc43185[_0x50f702(0x1f5)](_0x50f702(0x190),{'success':_0x4cc425[_0x50f702(0x1e8)](_0x50f702(0x131)),'errors':_0x4cc425[_0x50f702(0x1e8)]('errors'),'role':_0x39bdc9,'profile':_0x418a78,'customer':_0x193fc2,'warehouse':_0x5dbb52,'product':_0x2096e1,'invoice':_0x13babe,'master_shop':_0x201dc9,'language':_0x51825d,'rooms_data':_0x24d4ad});})[_0x41bcd9(0x137)](_0x17e11c=>{var _0x167a71=_0x41bcd9;_0x4cc425['flash'](_0x167a71(0x183),_0x167a71(0x155)),_0xc43185[_0x167a71(0x1ae)]('/all_sales/view');});}catch(_0x1a21d9){console[_0x41bcd9(0x1d6)](_0x1a21d9);}}),router[a0_0x29f14d(0x11a)]('/view/add_sales/:id',auth,async(_0x348076,_0x149eb9)=>{var _0xec9868=a0_0x29f14d;try{const _0x1887d1=_0x348076['params']['id'];console['log'](_0x1887d1);const _0x36471d=await product[_0xec9868(0x16a)](),_0x553c4d=await purchases[_0xec9868(0x192)]([{'$match':{'warehouse_name':_0x1887d1}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0xec9868(0x1d6)]('purchases_data',_0x553c4d),_0x149eb9[_0xec9868(0x1ea)](0xc8)[_0xec9868(0x141)]({'purchases_data':_0x553c4d,'product_data':_0x36471d});}catch(_0x2d8693){console[_0xec9868(0x1d6)](_0x2d8693);}}),router['post'](a0_0x29f14d(0x205),auth,async(_0x4b14ef,_0x388a2e)=>{var _0x1cf55b=a0_0x29f14d;try{const {warehouse_data:_0x33cac1,product_data:_0x997542}=_0x4b14ef[_0x1cf55b(0x1a5)];console['log'](_0x4b14ef[_0x1cf55b(0x1a5)][_0x1cf55b(0x129)]);;const _0x54f4b5=await master_shop['find']();console[_0x1cf55b(0x1d6)](_0x1cf55b(0x12d),_0x54f4b5);const _0x47b8a2=await product['findOne']({'name':_0x997542});console['log'](_0x1cf55b(0x13f),_0x47b8a2);const _0x5a16aa=await warehouse[_0x1cf55b(0x192)]([{'$match':{'name':_0x33cac1}},{'$unwind':_0x1cf55b(0x150)},{'$match':{'product_details.product_name':_0x997542}},{'$group':{'_id':_0x1cf55b(0x1fc),'product_stock':{'$first':_0x1cf55b(0x20b)}}}]);console[_0x1cf55b(0x1d6)](_0x1cf55b(0x164),_0x5a16aa),_0x388a2e[_0x1cf55b(0x1ea)](0xc8)[_0x1cf55b(0x141)]({'master':_0x54f4b5,'new_product':_0x47b8a2,'stock_data':_0x5a16aa});}catch(_0x3730fb){console['log'](_0x3730fb);}}),router['post'](a0_0x29f14d(0x210),auth,async(_0x356b6d,_0x52ac1f)=>{var _0x33b78e=a0_0x29f14d;try{const {invoice:_0xedb09e,date:_0x515e5e,warehouse_name:_0x5df75a,product_name:_0x1beebd,stock:_0x2a00b0,quantity:_0xaea6d4,note:_0x175a4f,room:_0x2f18aa,primary_code:_0x84ba9b,secondary_code:_0x249628,prod_code:_0x48550a,level:_0x34ba64,isle:_0x44a01c,pallet:_0x402a0c,batch_code:_0x4093c0,SCRN:_0x42b94a,expiry_date:_0x519720}=_0x356b6d[_0x33b78e(0x1a5)];if(typeof _0x1beebd==_0x33b78e(0x1c6))var _0x131c13=[_0x356b6d[_0x33b78e(0x1a5)]['product_name']],_0x557861=[_0x356b6d[_0x33b78e(0x1a5)]['stock']],_0x265d42=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x1cc)]],_0xb7fde7=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x145)]],_0x441832=[_0x356b6d[_0x33b78e(0x1a5)]['secondary_code']],_0x4a47e4=[_0x356b6d[_0x33b78e(0x1a5)]['prod_code']],_0x4e7bd1=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x132)]],_0x3e746c=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x12c)]],_0x5458ab=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x14c)]],_0x1ce48c=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x16e)]],_0xd280a=[_0x356b6d[_0x33b78e(0x1a5)]['expiry_date']],_0x2ee814=[_0x356b6d[_0x33b78e(0x1a5)]['max_per_unit']],_0x20939b=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x19b)]],_0xf671a=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x1cd)]],_0x114a68=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x212)]],_0x29df6a=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x1a1)]],_0x31e9a5=[_0x356b6d['body']['prod_cat']],_0x3eaffd=[_0x356b6d['body'][_0x33b78e(0x17f)]],_0x4a4f73=[_0x356b6d['body'][_0x33b78e(0x20d)]],_0x51ca9b=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x1ba)]],_0x35cd67=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x14e)]],_0x5ea081=[_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x112)]],_0x5b0335=[_0x356b6d['body'][_0x33b78e(0x119)]];else var _0x131c13=[..._0x356b6d['body'][_0x33b78e(0x1ce)]],_0x557861=[..._0x356b6d[_0x33b78e(0x1a5)]['stock']],_0x265d42=[..._0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x1cc)]],_0xb7fde7=[..._0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x145)]],_0x441832=[..._0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x1ad)]],_0x4a47e4=[..._0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x170)]],_0x4e7bd1=[..._0x356b6d[_0x33b78e(0x1a5)]['level']],_0x3e746c=[..._0x356b6d['body'][_0x33b78e(0x12c)]],_0x5458ab=[..._0x356b6d[_0x33b78e(0x1a5)]['secondary_unit']],_0x1ce48c=[..._0x356b6d['body']['batch_code']],_0xd280a=[..._0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x16d)]],_0x2ee814=[..._0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x19c)]],_0x20939b=[..._0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x19b)]],_0xf671a=[..._0x356b6d['body'][_0x33b78e(0x1cd)]],_0x114a68=[..._0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x212)]],_0x29df6a=[..._0x356b6d[_0x33b78e(0x1a5)]['delivery_code']],_0x31e9a5=[..._0x356b6d[_0x33b78e(0x1a5)]['prod_cat']],_0x3eaffd=[..._0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x17f)]],_0x4a4f73=[..._0x356b6d['body'][_0x33b78e(0x20d)]],_0x51ca9b=[..._0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x1ba)]],_0x35cd67=[..._0x356b6d[_0x33b78e(0x1a5)]['actual_qty']],_0x5ea081=[..._0x356b6d[_0x33b78e(0x1a5)]['actual_uom']],_0x5b0335=[..._0x356b6d['body'][_0x33b78e(0x119)]];const _0x15da51=_0x131c13[_0x33b78e(0x17b)](_0x1f609f=>{return _0x1f609f={'product_name':_0x1f609f};});_0x557861[_0x33b78e(0x1c3)]((_0x14346a,_0x565288)=>{var _0x4717fb=_0x33b78e;_0x15da51[_0x565288]['stock']=Math[_0x4717fb(0x122)](_0x14346a);}),_0x35cd67['forEach']((_0x32b8d8,_0x5d9004)=>{var _0x1e2337=_0x33b78e;_0x15da51[_0x5d9004][_0x1e2337(0x14e)]=Math[_0x1e2337(0x122)](_0x32b8d8);}),_0x5ea081['forEach']((_0x54413e,_0x3ee308)=>{_0x15da51[_0x3ee308]['actual_uom']=_0x54413e;}),_0x5b0335[_0x33b78e(0x1c3)]((_0x2f25e2,_0x5455c1)=>{var _0x2d3507=_0x33b78e;_0x15da51[_0x5455c1][_0x2d3507(0x16b)]=_0x2f25e2;}),_0x265d42[_0x33b78e(0x1c3)]((_0x1d35cc,_0x23829c)=>{_0x15da51[_0x23829c]['quantity']=_0x1d35cc;}),_0xb7fde7[_0x33b78e(0x1c3)]((_0x1da213,_0x2db029)=>{_0x15da51[_0x2db029]['primary_code']=_0x1da213;}),_0x441832[_0x33b78e(0x1c3)]((_0x4d641d,_0x15b6e2)=>{_0x15da51[_0x15b6e2]['secondary_code']=_0x4d641d;}),_0x4a47e4[_0x33b78e(0x1c3)]((_0x5ac127,_0xffaa0a)=>{_0x15da51[_0xffaa0a]['product_code']=_0x5ac127;}),_0x4e7bd1['forEach']((_0x104220,_0x2c9a36)=>{var _0x4330ab=_0x33b78e;_0x4a4f73[_0x4330ab(0x1c3)]((_0x36c364,_0x1fcaf6)=>{var _0x3660ec=_0x4330ab;if(_0x36c364=='Receiving\x20Area'&&_0x2c9a36==_0x1fcaf6){var _0x24a7ce=_0x104220['slice'](0x3);_0x15da51[_0x2c9a36][_0x3660ec(0x1af)]=_0x104220[0x0],_0x15da51[_0x2c9a36][_0x3660ec(0x173)]=_0x104220[0x1],_0x15da51[_0x2c9a36][_0x3660ec(0x1b4)]=0x0,_0x15da51[_0x2c9a36][_0x3660ec(0x189)]=0x0,_0x15da51[_0x2c9a36][_0x3660ec(0x18d)]=_0x3660ec(0x1cb),_0x15da51[_0x2c9a36][_0x3660ec(0x1fd)]=_0x24a7ce;}else{if(_0x36c364==_0x3660ec(0x206)&&_0x2c9a36==_0x1fcaf6){var _0x24a7ce=_0x104220['slice'](0x3);_0x15da51[_0x2c9a36][_0x3660ec(0x1af)]=_0x104220[0x0],_0x15da51[_0x2c9a36][_0x3660ec(0x173)]=_0x104220[0x1],_0x15da51[_0x2c9a36][_0x3660ec(0x1b4)]=0x0,_0x15da51[_0x2c9a36][_0x3660ec(0x189)]=0x0,_0x15da51[_0x2c9a36][_0x3660ec(0x18d)]='Floor',_0x15da51[_0x2c9a36]['floorlevel']=_0x104220[0x5];}else{if(_0x2c9a36==_0x1fcaf6){var _0x20c5b3;if(_0x104220[0x4]=='L')_0x20c5b3=_0x3660ec(0x153);else _0x104220[0x4]=='F'&&(_0x20c5b3='Floor');_0x15da51[_0x2c9a36][_0x3660ec(0x1af)]=_0x104220[0x0],_0x15da51[_0x2c9a36][_0x3660ec(0x173)]=_0x104220[0x1],_0x15da51[_0x2c9a36]['bay']=_0x104220[0x2],_0x15da51[_0x2c9a36]['bin']=_0x104220[0x3],_0x15da51[_0x2c9a36][_0x3660ec(0x18d)]=_0x20c5b3,_0x15da51[_0x2c9a36][_0x3660ec(0x1fd)]=_0x104220[0x5];}}}});}),_0x3e746c[_0x33b78e(0x1c3)]((_0x3e141d,_0x534c95)=>{var _0x51ed52=_0x33b78e;_0x15da51[_0x534c95][_0x51ed52(0x1dc)]=_0x3e141d;}),_0x5458ab[_0x33b78e(0x1c3)]((_0x2818f8,_0x31ed41)=>{var _0x5e5546=_0x33b78e;_0x15da51[_0x31ed41][_0x5e5546(0x14c)]=_0x2818f8;}),_0x1ce48c[_0x33b78e(0x1c3)]((_0x1ba837,_0x393908)=>{var _0x162ab5=_0x33b78e;_0x15da51[_0x393908][_0x162ab5(0x16e)]=_0x1ba837;}),_0xd280a[_0x33b78e(0x1c3)]((_0x52b635,_0x27a523)=>{_0x15da51[_0x27a523]['expiry_date']=_0x52b635;}),_0x2ee814[_0x33b78e(0x1c3)]((_0x4f3725,_0x4be26c)=>{var _0x531c64=_0x33b78e;_0x15da51[_0x4be26c][_0x531c64(0x16f)]=_0x4f3725;}),_0x20939b[_0x33b78e(0x1c3)]((_0xcbfa6e,_0x34fe12)=>{var _0x642a1f=_0x33b78e;_0x15da51[_0x34fe12][_0x642a1f(0x19b)]=_0xcbfa6e;}),_0xf671a['forEach']((_0x5a9027,_0x50f926)=>{var _0x1546db=_0x33b78e;_0x15da51[_0x50f926][_0x1546db(0x1cd)]=_0x5a9027;}),_0x114a68[_0x33b78e(0x1c3)]((_0x14fd15,_0x250b5a)=>{_0x15da51[_0x250b5a]['delivery_date']=_0x14fd15;}),_0x29df6a[_0x33b78e(0x1c3)]((_0x5582e1,_0x5da31c)=>{var _0x54c8a1=_0x33b78e;_0x15da51[_0x5da31c][_0x54c8a1(0x1a1)]=_0x5582e1;}),_0x31e9a5[_0x33b78e(0x1c3)]((_0x1c3cad,_0x2334e2)=>{_0x15da51[_0x2334e2]['prod_cat']=_0x1c3cad;}),_0x3eaffd['forEach']((_0x3efc5f,_0x14fc92)=>{var _0x4d83cb=_0x33b78e;_0x15da51[_0x14fc92][_0x4d83cb(0x16c)]=_0x3efc5f;}),_0x4a4f73[_0x33b78e(0x1c3)]((_0x30cefc,_0x26dbe0)=>{_0x15da51[_0x26dbe0]['room_name']=_0x30cefc;}),_0x51ca9b[_0x33b78e(0x1c3)]((_0xd152c8,_0x36fbe0)=>{var _0x2c2ba9=_0x33b78e;_0x15da51[_0x36fbe0][_0x2c2ba9(0x138)]=_0xd152c8;});var _0x17e3ee=0x0;_0x15da51[_0x33b78e(0x1c3)](_0x16b33a=>{var _0x25129c=_0x33b78e;(_0x16b33a['stock']<_0x16b33a[_0x25129c(0x16c)]||_0x16b33a['quantity_notConverted']==0x0)&&(console['log'](_0x25129c(0x126),_0x16b33a),_0x17e3ee++);});const _0x1c385b=_0x15da51[_0x33b78e(0x12b)](_0x5325a5=>_0x5325a5[_0x33b78e(0x17f)]!=='0'&&_0x5325a5[_0x33b78e(0x17f)]!==''),_0x5586b9=new sales({'invoice':_0xedb09e,'customer':_0x356b6d[_0x33b78e(0x1a5)][_0x33b78e(0x159)],'date':_0x515e5e,'warehouse_name':_0x5df75a,'sale_product':_0x1c385b,'note':_0x175a4f,'room':_0x2f18aa,'primary_code':_0x84ba9b,'secondary_code':_0x249628,'prod_code':_0x48550a,'SCRN':_0x42b94a}),_0x22e80c=await _0x5586b9[_0x33b78e(0x1a9)]();_0x356b6d[_0x33b78e(0x1e8)](_0x33b78e(0x131),_0x33b78e(0x142)),_0x52ac1f['redirect'](_0x33b78e(0x152)+_0x22e80c[_0x33b78e(0x215)]);}catch(_0xc0eafa){console['log'](_0xc0eafa);}}),router['get'](a0_0x29f14d(0x1c9),auth,async(_0x458ea4,_0x4bd289)=>{var _0xf90b22=a0_0x29f14d;try{const {username:_0x465142,email:_0x1f193f,role:_0x104bb6}=_0x458ea4['user'],_0x272ad9=_0x458ea4['user'],_0x2f3172=await profile['findOne']({'email':_0x272ad9['email']}),_0x34043d=await master_shop[_0xf90b22(0x16a)](),_0x41994c=_0x458ea4['params']['id'],_0x20cef5=await sales[_0xf90b22(0x1fa)](_0x41994c),_0x50b6aa=await warehouse[_0xf90b22(0x192)]([{'$match':{'name':_0x20cef5['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0xf90b22(0x1ab),'name':{'$first':_0xf90b22(0x1fc)},'product_stock':{'$first':_0xf90b22(0x20b)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xf90b22(0x182)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0xf90b22(0x12e)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xf90b22(0x1c5)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xf90b22(0x127)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xf90b22(0x176)},'production_date':{'$first':_0xf90b22(0x20c)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x142253=await customer[_0xf90b22(0x16a)]({});let _0x4199a2;if(_0x272ad9[_0xf90b22(0x18c)]==_0xf90b22(0x136)){const _0x2466f5=await staff[_0xf90b22(0x197)]({'email':_0x272ad9[_0xf90b22(0x1bd)]});_0x4199a2=await warehouse['aggregate']([{'$match':{'status':_0xf90b22(0x17d),'name':_0x2466f5[_0xf90b22(0x1c8)]}},{'$group':{'_id':_0xf90b22(0x1b7),'name':{'$first':_0xf90b22(0x1b7)}}}]);}else _0x4199a2=await warehouse[_0xf90b22(0x192)]([{'$match':{'status':_0xf90b22(0x17d)}},{'$group':{'_id':_0xf90b22(0x1b7),'name':{'$first':_0xf90b22(0x1b7)}}}]);const _0x5b4749=await product['find']({}),_0x11978a=await suppliers[_0xf90b22(0x16a)]({});if(_0x34043d[0x0][_0xf90b22(0x1e3)]==_0xf90b22(0x15c)){var _0x23c63d=users['English'];console[_0xf90b22(0x1d6)](_0x23c63d);}else{if(_0x34043d[0x0][_0xf90b22(0x1e3)]=='Hindi')var _0x23c63d=users[_0xf90b22(0x19d)];else{if(_0x34043d[0x0][_0xf90b22(0x1e3)]==_0xf90b22(0x14f))var _0x23c63d=users[_0xf90b22(0x14f)];else{if(_0x34043d[0x0][_0xf90b22(0x1e3)]==_0xf90b22(0x1fe))var _0x23c63d=users[_0xf90b22(0x1fe)];else{if(_0x34043d[0x0][_0xf90b22(0x1e3)]=='French')var _0x23c63d=users[_0xf90b22(0x1b5)];else{if(_0x34043d[0x0]['language']=='Portuguese\x20(BR)')var _0x23c63d=users[_0xf90b22(0x200)];else{if(_0x34043d[0x0][_0xf90b22(0x1e3)]==_0xf90b22(0x1f4))var _0x23c63d=users[_0xf90b22(0x1f4)];else{if(_0x34043d[0x0][_0xf90b22(0x1e3)]=='Arabic\x20(ae)')var _0x23c63d=users[_0xf90b22(0x15a)];}}}}}}}_0x4bd289['render'](_0xf90b22(0x1a6),{'success':_0x458ea4['flash'](_0xf90b22(0x131)),'errors':_0x458ea4['flash']('errors'),'role':_0x272ad9,'profile':_0x2f3172,'customer':_0x142253,'warehouse':_0x4199a2,'product':_0x50b6aa,'user':_0x20cef5,'master_shop':_0x34043d,'unit':_0x5b4749,'language':_0x23c63d,'suppliers':_0x11978a});}catch(_0x49174f){console[_0xf90b22(0x1d6)](_0x49174f);}}),router[a0_0x29f14d(0x167)]('/preview/:id',auth,async(_0x861636,_0x33f193)=>{var _0x3a13b2=a0_0x29f14d;try{const _0x319ce2=_0x861636[_0x3a13b2(0x11f)]['id'],{invoice:_0x53a271,warehouse_name:_0x551e78,room:_0x51a869}=_0x861636[_0x3a13b2(0x1a5)],_0x1aa499=await sales[_0x3a13b2(0x197)]({'invoice':_0x53a271}),_0x13d204=_0x1aa499[_0x3a13b2(0x118)]['map'](async _0x5d0399=>{var _0x2b8ce7=_0x3a13b2,_0x1a8414=await warehouse[_0x2b8ce7(0x197)]({'name':_0x551e78,'room':_0x5d0399['room_name'],'warehouse_category':'Raw\x20Materials'});const _0x27a1f7=_0x1a8414[_0x2b8ce7(0x1e9)]['map'](_0x730d1=>{var _0x4ff847=_0x2b8ce7;_0x730d1[_0x4ff847(0x1ce)]==_0x5d0399[_0x4ff847(0x1ce)]&&_0x730d1['floorlevel']==_0x5d0399[_0x4ff847(0x1fd)]&&_0x730d1[_0x4ff847(0x18d)]==_0x5d0399['type']&&_0x730d1[_0x4ff847(0x189)]==_0x5d0399[_0x4ff847(0x189)]&&_0x730d1['bay']==_0x5d0399[_0x4ff847(0x1b4)]&&_0x730d1[_0x4ff847(0x173)]==_0x5d0399[_0x4ff847(0x173)]&&_0x730d1[_0x4ff847(0x1af)]==_0x5d0399['storage']&&_0x730d1['expiry_date']==_0x5d0399[_0x4ff847(0x16d)]&&_0x730d1[_0x4ff847(0x16e)]==_0x5d0399[_0x4ff847(0x16e)]&&_0x730d1['invoice']==_0x5d0399[_0x4ff847(0x138)]&&_0x730d1[_0x4ff847(0x215)]==_0x5d0399['id_transaction_from']&&(_0x730d1[_0x4ff847(0x128)]=Math['max'](0x0,Math['abs'](_0x730d1['product_stock'])-Math['abs'](_0x5d0399[_0x4ff847(0x17f)])));});return _0x1a8414;});Promise[_0x3a13b2(0x1bb)](_0x13d204)[_0x3a13b2(0x1eb)](async _0xbedcde=>{var _0xffdf81=_0x3a13b2;try{for(const _0x585291 of _0xbedcde){await _0x585291[_0xffdf81(0x1a9)]();}_0x1aa499[_0xffdf81(0x18f)]=_0xffdf81(0x209);const _0xd719aa=await _0x1aa499[_0xffdf81(0x1a9)](),_0x6fd9bc=await master_shop[_0xffdf81(0x16a)](),_0x3dc5d4=await email_settings[_0xffdf81(0x197)](),_0x35d5bb=await supervisor_settings[_0xffdf81(0x16a)]();var _0x4794d6=_0x1aa499[_0xffdf81(0x118)],_0x3eabdf='',_0x71f0e;for(_0x71f0e in _0x4794d6){_0x3eabdf+='<tr>'+_0xffdf81(0x1fb)+_0x4794d6[_0x71f0e][_0xffdf81(0x1ce)]+'</td>'+_0xffdf81(0x1fb)+_0x4794d6[_0x71f0e][_0xffdf81(0x161)]+_0xffdf81(0x18e)+_0xffdf81(0x1fb)+_0x4794d6[_0x71f0e][_0xffdf81(0x17f)]+_0xffdf81(0x18e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4794d6[_0x71f0e][_0xffdf81(0x1dc)]+_0xffdf81(0x18e)+_0xffdf81(0x1fb)+_0x4794d6[_0x71f0e]['secondary_unit']+'</td>'+_0xffdf81(0x1fb)+_0x1aa499['warehouse_name']+'</td>'+_0xffdf81(0x1fb)+_0x4794d6[_0x71f0e][_0xffdf81(0x1a4)]+_0xffdf81(0x18e)+_0xffdf81(0x1fb)+_0x4794d6[_0x71f0e][_0xffdf81(0x1af)]+_0x4794d6[_0x71f0e][_0xffdf81(0x173)]+_0x4794d6[_0x71f0e][_0xffdf81(0x1b4)]+_0x4794d6[_0x71f0e][_0xffdf81(0x189)]+_0x4794d6[_0x71f0e][_0xffdf81(0x18d)][0x0]+_0x4794d6[_0x71f0e][_0xffdf81(0x1fd)]+_0xffdf81(0x18e),_0xffdf81(0x1d3);}let _0x23cb4=nodemailer[_0xffdf81(0x1c7)]({'host':_0x3dc5d4[_0xffdf81(0x216)],'port':Number(_0x3dc5d4[_0xffdf81(0x11b)]),'secure':![],'auth':{'user':_0x3dc5d4[_0xffdf81(0x1bd)],'pass':_0x3dc5d4[_0xffdf81(0x11d)]}}),_0x2cab68={'from':_0x3dc5d4[_0xffdf81(0x1bd)],'to':_0x35d5bb[0x0]['RMSEmail'],'subject':_0xffdf81(0x175),'attachments':[{'filename':_0xffdf81(0x174),'path':__dirname+_0xffdf81(0x111)+_0xffdf81(0x1be)+_0x6fd9bc[0x0]['image'],'cid':_0xffdf81(0x157)}],'html':_0xffdf81(0x1e0)+_0xffdf81(0x1de)+_0xffdf81(0x1b1)+_0xffdf81(0x184)+_0xffdf81(0x125)+_0xffdf81(0x184)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0xffdf81(0x188)+'<div>'+_0xffdf81(0x1bf)+_0x6fd9bc[0x0]['site_title']+_0xffdf81(0x13c)+_0xffdf81(0x188)+_0xffdf81(0x188)+_0xffdf81(0x135)+_0xffdf81(0x184)+_0xffdf81(0x1e4)+_0xffdf81(0x19f)+_0x1aa499['invoice']+'\x20'+_0xffdf81(0x202)+'\x20Order\x20Date\x20:\x20'+_0x1aa499['date']+'\x20'+_0xffdf81(0x115)+_0xffdf81(0x1c2)+_0xffdf81(0x188)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xffdf81(0x218)+_0xffdf81(0x1ef)+_0xffdf81(0x15b)+_0xffdf81(0x12f)+_0xffdf81(0x1c1)+_0xffdf81(0x1d2)+_0xffdf81(0x199)+_0xffdf81(0x201)+_0xffdf81(0x181)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0xffdf81(0x1d3)+_0xffdf81(0x13d)+_0xffdf81(0x1e2)+'\x20'+_0x3eabdf+'\x20'+'</tbody>'+_0xffdf81(0x139)+_0xffdf81(0x184)+_0xffdf81(0x21c)+_0xffdf81(0x154)+_0x6fd9bc[0x0][_0xffdf81(0x1d0)]+'</h5>'+'</div>'+'</div>'+_0xffdf81(0x18b)};_0x23cb4[_0xffdf81(0x1ca)](_0x2cab68,function(_0x3ac594,_0x4774df){var _0x2e124b=_0xffdf81;_0x3ac594?(console[_0x2e124b(0x1d6)](_0x3ac594),console[_0x2e124b(0x1d6)](_0x2e124b(0x1b9))):console[_0x2e124b(0x1d6)](_0x2e124b(0x1c0));}),_0x861636[_0xffdf81(0x1e8)](_0xffdf81(0x131),_0xffdf81(0x1ff)),_0x33f193[_0xffdf81(0x1ae)](_0xffdf81(0x152)+_0x319ce2);}catch(_0x46e234){console[_0xffdf81(0x21e)](_0x46e234),_0x33f193[_0xffdf81(0x1ea)](0x1f4)[_0xffdf81(0x141)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x3a13b2(0x137)](_0x4c1d1c=>{var _0x1dac24=_0x3a13b2;console[_0x1dac24(0x21e)](_0x4c1d1c),_0x33f193['status'](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x2a9528){console[_0x3a13b2(0x1d6)](_0x2a9528);}}),router[a0_0x29f14d(0x11a)](a0_0x29f14d(0x193),auth,async(_0x2e496c,_0xe6f03)=>{var _0x75b29b=a0_0x29f14d;try{const {username:_0x3cbf0a,email:_0x371761,role:_0x3c652e}=_0x2e496c[_0x75b29b(0x21d)],_0x4ded0=_0x2e496c[_0x75b29b(0x21d)],_0x20d410=await profile[_0x75b29b(0x197)]({'email':_0x4ded0[_0x75b29b(0x1bd)]}),_0x510ac7=await master_shop[_0x75b29b(0x16a)](),_0x153fb9=_0x2e496c['params']['id'],_0x35f8ed=await sales[_0x75b29b(0x1fa)](_0x153fb9);var _0x37e1be=[_0x75b29b(0x217),_0x75b29b(0x1e5)];const _0x134484=await warehouse[_0x75b29b(0x192)]([{'$match':{'name':_0x35f8ed['warehouse_name'],'warehouse_category':_0x75b29b(0x19e)}},{'$unwind':_0x75b29b(0x150)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x75b29b(0x1fc)},'product_stock':{'$first':_0x75b29b(0x20b)},'bay':{'$first':_0x75b29b(0x1b6)},'bin':{'$first':_0x75b29b(0x182)},'type':{'$first':_0x75b29b(0x146)},'floorlevel':{'$first':_0x75b29b(0x12e)},'primary_code':{'$first':_0x75b29b(0x187)},'secondary_code':{'$first':_0x75b29b(0x1c5)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x75b29b(0x123)}}}]),_0x1737fb=await customer[_0x75b29b(0x16a)]({});let _0x30bc99;if(_0x4ded0[_0x75b29b(0x18c)]==_0x75b29b(0x136)){const _0x3fbc8d=await staff[_0x75b29b(0x197)]({'email':_0x4ded0['email']});_0x30bc99=await warehouse[_0x75b29b(0x192)]([{'$match':{'status':_0x75b29b(0x17d),'name':_0x3fbc8d['warehouse'],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x75b29b(0x1b7),'name':{'$first':'$name'}}}]);}else _0x30bc99=await warehouse[_0x75b29b(0x192)]([{'$match':{'status':_0x75b29b(0x17d),'warehouse_category':_0x75b29b(0x19e)}},{'$group':{'_id':_0x75b29b(0x1b7),'name':{'$first':_0x75b29b(0x1b7)}}}]);const _0x2cce1c=await product[_0x75b29b(0x16a)]({});if(_0x510ac7[0x0][_0x75b29b(0x1e3)]==_0x75b29b(0x15c)){var _0x2e5d79=users['English'];console[_0x75b29b(0x1d6)](_0x2e5d79);}else{if(_0x510ac7[0x0]['language']==_0x75b29b(0x19d))var _0x2e5d79=users[_0x75b29b(0x19d)];else{if(_0x510ac7[0x0]['language']==_0x75b29b(0x14f))var _0x2e5d79=users['German'];else{if(_0x510ac7[0x0][_0x75b29b(0x1e3)]==_0x75b29b(0x1fe))var _0x2e5d79=users[_0x75b29b(0x1fe)];else{if(_0x510ac7[0x0][_0x75b29b(0x1e3)]==_0x75b29b(0x1b5))var _0x2e5d79=users['French'];else{if(_0x510ac7[0x0]['language']==_0x75b29b(0x13b))var _0x2e5d79=users[_0x75b29b(0x200)];else{if(_0x510ac7[0x0]['language']=='Chinese')var _0x2e5d79=users[_0x75b29b(0x1f4)];else{if(_0x510ac7[0x0][_0x75b29b(0x1e3)]=='Arabic\x20(ae)')var _0x2e5d79=users['Arabic'];}}}}}}}_0xe6f03[_0x75b29b(0x1f5)](_0x75b29b(0x208),{'success':_0x2e496c[_0x75b29b(0x1e8)](_0x75b29b(0x131)),'errors':_0x2e496c[_0x75b29b(0x1e8)](_0x75b29b(0x183)),'role':_0x4ded0,'profile':_0x20d410,'customer':_0x1737fb,'warehouse':_0x30bc99,'product':_0x134484,'user':_0x35f8ed,'master_shop':_0x510ac7,'unit':_0x2cce1c,'language':_0x2e5d79});}catch(_0x143e03){console['log'](_0x143e03);}}),router['post'](a0_0x29f14d(0x193),auth,async(_0x399799,_0x5ce4ff)=>{var _0xb42f72=a0_0x29f14d;try{const _0xd934c9=_0x399799['params']['id'],_0xab7323=await sales[_0xb42f72(0x197)]({'_id':_0x399799['params']['id']}),_0x581ca8=await warehouse[_0xb42f72(0x197)]({'name':_0xab7323['warehouse_name'],'room':_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x21f)]}),{invoice:_0x9d19d1,date:_0x368e09,warehouse_name:_0x3f0095,product_name:_0xf73f21,stock:_0xa5f370,quantity:_0x4cd4c3,note:_0x2c417c,room:_0xd1f17b,customer:_0x383e1d,SCRN:_0x451582}=_0x399799[_0xb42f72(0x1a5)];if(typeof _0xf73f21==_0xb42f72(0x1c6))var _0xa24247=[_0x399799[_0xb42f72(0x1a5)]['product_name']],_0x195614=[_0x399799['body']['stock']],_0x10e611=[_0x399799[_0xb42f72(0x1a5)]['carton']],_0x32ef74=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x145)]],_0x3b2692=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x1ad)]],_0x3e9655=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x170)]],_0x1c0961=[_0x399799[_0xb42f72(0x1a5)]['level']],_0x19d96b=[_0x399799['body'][_0xb42f72(0x12c)]],_0x52cecd=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x14c)]],_0x47b16d=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x16e)]],_0x2c48a3=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x16d)]],_0x1698b3=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x19c)]],_0x52afcb=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x19b)]],_0x111669=[_0x399799['body'][_0xb42f72(0x1cd)]],_0x4be76b=[_0x399799['body'][_0xb42f72(0x212)]],_0x1449e8=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x1a1)]],_0x176b90=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x1ec)]],_0x44c78a=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x17f)]],_0x54c8e7=[_0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x20d)]];else var _0xa24247=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x1ce)]],_0x195614=[..._0x399799[_0xb42f72(0x1a5)]['stock']],_0x10e611=[..._0x399799[_0xb42f72(0x1a5)]['carton']],_0x32ef74=[..._0x399799[_0xb42f72(0x1a5)]['primary_code']],_0x3b2692=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x1ad)]],_0x3e9655=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x170)]],_0x1c0961=[..._0x399799['body']['level']],_0x19d96b=[..._0x399799['body'][_0xb42f72(0x12c)]],_0x52cecd=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x14c)]],_0x47b16d=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x16e)]],_0x2c48a3=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x16d)]],_0x1698b3=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x19c)]],_0x52afcb=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x19b)]],_0x111669=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x1cd)]],_0x4be76b=[..._0x399799[_0xb42f72(0x1a5)]['delivery_date']],_0x1449e8=[..._0x399799[_0xb42f72(0x1a5)]['delivery_code']],_0x176b90=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x1ec)]],_0x44c78a=[..._0x399799[_0xb42f72(0x1a5)]['quantity']],_0x54c8e7=[..._0x399799[_0xb42f72(0x1a5)][_0xb42f72(0x20d)]];const _0x2b8a68=_0xa24247['map'](_0x1e231b=>{return _0x1e231b={'product_name':_0x1e231b};});_0x195614[_0xb42f72(0x1c3)]((_0x49a95a,_0xedfd41)=>{var _0x382781=_0xb42f72;_0x2b8a68[_0xedfd41][_0x382781(0x149)]=Math[_0x382781(0x122)](_0x49a95a);}),_0x10e611[_0xb42f72(0x1c3)]((_0x25ef05,_0x3b41cb)=>{var _0xf587a3=_0xb42f72;_0x2b8a68[_0x3b41cb][_0xf587a3(0x17f)]=_0x25ef05;}),_0x32ef74['forEach']((_0x4396ca,_0x2cb547)=>{var _0x2212b8=_0xb42f72;_0x2b8a68[_0x2cb547][_0x2212b8(0x145)]=_0x4396ca;}),_0x3b2692['forEach']((_0x4a22e6,_0x4a6dea)=>{var _0x2880ca=_0xb42f72;_0x2b8a68[_0x4a6dea][_0x2880ca(0x1ad)]=_0x4a22e6;}),_0x3e9655['forEach']((_0x14fcb6,_0x19a68b)=>{var _0x158b5e=_0xb42f72;_0x2b8a68[_0x19a68b][_0x158b5e(0x161)]=_0x14fcb6;}),_0x1c0961[_0xb42f72(0x1c3)]((_0x41a12b,_0x357e8b)=>{_0x54c8e7['forEach']((_0x2d05d2,_0x3cbd56)=>{var _0x5e571b=a0_0x3157;if(_0x2d05d2==_0x5e571b(0x195)&&_0x357e8b==_0x3cbd56){var _0x5e4eb6=_0x41a12b['slice'](0x3);_0x2b8a68[_0x357e8b][_0x5e571b(0x1af)]=_0x41a12b[0x0],_0x2b8a68[_0x357e8b][_0x5e571b(0x173)]=_0x41a12b[0x1],_0x2b8a68[_0x357e8b][_0x5e571b(0x1b4)]=0x0,_0x2b8a68[_0x357e8b][_0x5e571b(0x189)]=0x0,_0x2b8a68[_0x357e8b][_0x5e571b(0x18d)]=_0x5e571b(0x1cb),_0x2b8a68[_0x357e8b][_0x5e571b(0x1fd)]=_0x5e4eb6;}else{if(_0x2d05d2==_0x5e571b(0x206)&&_0x357e8b==_0x3cbd56){var _0x5e4eb6=_0x41a12b['slice'](0x3);_0x2b8a68[_0x357e8b][_0x5e571b(0x1af)]=_0x41a12b[0x0],_0x2b8a68[_0x357e8b][_0x5e571b(0x173)]=_0x41a12b[0x1],_0x2b8a68[_0x357e8b]['bay']=0x0,_0x2b8a68[_0x357e8b][_0x5e571b(0x189)]=0x0,_0x2b8a68[_0x357e8b][_0x5e571b(0x18d)]=_0x5e571b(0x1cb),_0x2b8a68[_0x357e8b][_0x5e571b(0x1fd)]=_0x41a12b[0x5];}else{if(_0x357e8b==_0x3cbd56){var _0x1317c9;if(_0x41a12b[0x4]=='L')_0x1317c9=_0x5e571b(0x153);else _0x41a12b[0x4]=='F'&&(_0x1317c9=_0x5e571b(0x1cb));_0x2b8a68[_0x357e8b][_0x5e571b(0x1af)]=_0x41a12b[0x0],_0x2b8a68[_0x357e8b]['rack']=_0x41a12b[0x1],_0x2b8a68[_0x357e8b]['bay']=_0x41a12b[0x2],_0x2b8a68[_0x357e8b][_0x5e571b(0x189)]=_0x41a12b[0x3],_0x2b8a68[_0x357e8b]['type']=_0x1317c9,_0x2b8a68[_0x357e8b][_0x5e571b(0x1fd)]=_0x41a12b[0x5];}}}});}),_0x19d96b[_0xb42f72(0x1c3)]((_0x23ed37,_0x5ebb22)=>{var _0x401522=_0xb42f72;_0x2b8a68[_0x5ebb22][_0x401522(0x1dc)]=_0x23ed37;}),_0x52cecd['forEach']((_0x10406f,_0x50a451)=>{var _0x234ae2=_0xb42f72;_0x2b8a68[_0x50a451][_0x234ae2(0x14c)]=_0x10406f;}),_0x47b16d[_0xb42f72(0x1c3)]((_0x59db2a,_0x5c6ec0)=>{_0x2b8a68[_0x5c6ec0]['batch_code']=_0x59db2a;}),_0x2c48a3[_0xb42f72(0x1c3)]((_0x47a222,_0x4e3ebd)=>{var _0x1ebe1a=_0xb42f72;_0x2b8a68[_0x4e3ebd][_0x1ebe1a(0x16d)]=_0x47a222;}),_0x1698b3[_0xb42f72(0x1c3)]((_0x1d9fb7,_0x3f680a)=>{var _0x5b84d2=_0xb42f72;_0x2b8a68[_0x3f680a][_0x5b84d2(0x16f)]=_0x1d9fb7;}),_0x52afcb[_0xb42f72(0x1c3)]((_0x1c617f,_0x14b32)=>{var _0x2ae75a=_0xb42f72;_0x2b8a68[_0x14b32][_0x2ae75a(0x19b)]=_0x1c617f;}),_0x111669[_0xb42f72(0x1c3)]((_0x42ab0c,_0x3b2e9d)=>{var _0x641124=_0xb42f72;_0x2b8a68[_0x3b2e9d][_0x641124(0x1cd)]=Math[_0x641124(0x122)](_0x42ab0c);}),_0x4be76b[_0xb42f72(0x1c3)]((_0x5d39c4,_0x3cac01)=>{var _0x35a101=_0xb42f72;_0x2b8a68[_0x3cac01][_0x35a101(0x212)]=_0x5d39c4;}),_0x1449e8['forEach']((_0x2c9c1e,_0x31ab16)=>{var _0x5506c2=_0xb42f72;_0x2b8a68[_0x31ab16][_0x5506c2(0x1a1)]=_0x2c9c1e;}),_0x176b90['forEach']((_0x58602d,_0x46bc2c)=>{var _0x29d421=_0xb42f72;_0x2b8a68[_0x46bc2c][_0x29d421(0x1ec)]=_0x58602d;}),_0x44c78a[_0xb42f72(0x1c3)]((_0x5dcf6f,_0x3f1d6c)=>{var _0x4e5ff7=_0xb42f72;_0x2b8a68[_0x3f1d6c][_0x4e5ff7(0x16c)]=_0x5dcf6f;}),_0x54c8e7[_0xb42f72(0x1c3)]((_0x218cd8,_0x9a9e54)=>{var _0x150551=_0xb42f72;_0x2b8a68[_0x9a9e54][_0x150551(0x1a4)]=_0x218cd8;});var _0x3096be=0x0;_0x2b8a68[_0xb42f72(0x1c3)](_0x54b1c1=>{var _0x154380=_0xb42f72;console[_0x154380(0x1d6)]('foreach\x20newproduct',_0x54b1c1),(parseInt(_0x54b1c1[_0x154380(0x149)])<parseInt(_0x54b1c1['quantity'])||parseInt(_0x54b1c1[_0x154380(0x17f)])==0x0)&&_0x3096be++;});if(_0x3096be!=0x0)return _0x399799[_0xb42f72(0x1e8)](_0xb42f72(0x183),_0xb42f72(0x211)),_0x5ce4ff['redirect'](_0xb42f72(0x1df));const _0x5afe52=_0x2b8a68[_0xb42f72(0x12b)](_0x47026e=>_0x47026e[_0xb42f72(0x17f)]!=='0'&&_0x47026e['quantity']!=='');_0xab7323[_0xb42f72(0x138)]=_0x9d19d1,_0xab7323[_0xb42f72(0x159)]=_0x383e1d,_0xab7323[_0xb42f72(0x1f8)]=_0x368e09,_0xab7323[_0xb42f72(0x1b0)]=_0x3f0095,_0xab7323[_0xb42f72(0x118)]=_0x5afe52,_0xab7323[_0xb42f72(0x1e6)]=_0x2c417c,_0xab7323['SCRN']=_0x451582,_0xab7323[_0xb42f72(0x18f)]=_0xb42f72(0x177),_0xab7323[_0xb42f72(0x1da)]='False';const _0x501754=await _0xab7323[_0xb42f72(0x1a9)]();_0x399799['flash'](_0xb42f72(0x131),_0xb42f72(0x1ff)),_0x5ce4ff[_0xb42f72(0x1ae)](_0xb42f72(0x12a));}catch(_0x17fef7){console[_0xb42f72(0x1d6)](_0x17fef7);}}),router[a0_0x29f14d(0x167)](a0_0x29f14d(0x144),auth,async(_0x342e90,_0x47bb24)=>{var _0x2ca428=a0_0x29f14d;try{const _0x28fb3c=_0x342e90[_0x2ca428(0x11f)]['id'],{invoice:_0x4622b7,customer:_0x27face,receivable_amount:_0x2116a9,received_amount:_0x4c8108}=_0x342e90['body'],_0x5958b0=await sales[_0x2ca428(0x1fa)](_0x28fb3c);console[_0x2ca428(0x1d6)](_0x5958b0);var _0x4e7abc=_0x2116a9-_0x4c8108;console[_0x2ca428(0x1d6)](_0x4c8108),_0x5958b0[_0x2ca428(0x196)]=parseFloat(_0x4c8108)+parseFloat(_0x5958b0[_0x2ca428(0x196)]),_0x5958b0[_0x2ca428(0x204)]=_0x4e7abc,console[_0x2ca428(0x1d6)](_0x5958b0);const _0x22ee05=await _0x5958b0['save'](),_0xcb0420=await c_payment_data[_0x2ca428(0x197)]({'invoice':_0x4622b7});_0xcb0420[_0x2ca428(0x148)]=_0x4e7abc,await _0xcb0420[_0x2ca428(0x1a9)]();let _0x59e25d=new Date(),_0x2634e7=('0'+_0x59e25d[_0x2ca428(0x185)]())[_0x2ca428(0x186)](-0x2),_0x46843c=('0'+(_0x59e25d[_0x2ca428(0x1ee)]()+0x1))[_0x2ca428(0x186)](-0x2),_0x2d6f4c=_0x59e25d['getFullYear'](),_0x1d5a99=_0x2d6f4c+'-'+_0x46843c+'-'+_0x2634e7;const _0x440b37=new customer_payment({'invoice':_0x4622b7,'date':_0x2d6f4c+'-'+_0x46843c+'-'+_0x2634e7,'customer':_0x27face,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x4c8108}),_0x5a9b56=await _0x440b37[_0x2ca428(0x1a9)]();_0x342e90[_0x2ca428(0x1e8)](_0x2ca428(0x131),_0x2ca428(0x178)),_0x47bb24[_0x2ca428(0x1ae)](_0x2ca428(0x12a));}catch(_0x12c8b1){console['log'](_0x12c8b1);}}),router['get']('/invoice/:id',auth,async(_0x154c8b,_0x15854c)=>{var _0x4dc238=a0_0x29f14d;try{const {username:_0x46721a,email:_0x352a0f,role:_0x152ef3}=_0x154c8b[_0x4dc238(0x21d)],_0x2f15bc=_0x154c8b['user'],_0x210315=await profile[_0x4dc238(0x197)]({'email':_0x2f15bc['email']}),_0x2b924c=await master_shop[_0x4dc238(0x16a)]();console['log'](_0x4dc238(0x12d),_0x2b924c);const _0x38101d=_0x154c8b[_0x4dc238(0x11f)]['id'],_0x33ba61=await sales[_0x4dc238(0x1fa)](_0x38101d);console[_0x4dc238(0x1d6)](_0x33ba61);const _0x23a6cf=await customer[_0x4dc238(0x197)]({'name':_0x33ba61['customer']});console[_0x4dc238(0x1d6)](_0x23a6cf);if(_0x2b924c[0x0][_0x4dc238(0x1e3)]==_0x4dc238(0x15c)){var _0x2e8d1b=users[_0x4dc238(0x156)];console[_0x4dc238(0x1d6)](_0x2e8d1b);}else{if(_0x2b924c[0x0][_0x4dc238(0x1e3)]=='Hindi')var _0x2e8d1b=users[_0x4dc238(0x19d)];else{if(_0x2b924c[0x0]['language']==_0x4dc238(0x14f))var _0x2e8d1b=users['German'];else{if(_0x2b924c[0x0][_0x4dc238(0x1e3)]==_0x4dc238(0x1fe))var _0x2e8d1b=users['Spanish'];else{if(_0x2b924c[0x0][_0x4dc238(0x1e3)]==_0x4dc238(0x1b5))var _0x2e8d1b=users[_0x4dc238(0x1b5)];else{if(_0x2b924c[0x0][_0x4dc238(0x1e3)]=='Portuguese\x20(BR)')var _0x2e8d1b=users['Portuguese'];else{if(_0x2b924c[0x0][_0x4dc238(0x1e3)]==_0x4dc238(0x1f4))var _0x2e8d1b=users['Chinese'];else{if(_0x2b924c[0x0]['language']==_0x4dc238(0x19a))var _0x2e8d1b=users['Arabic'];}}}}}}}_0x15854c['render'](_0x4dc238(0x169),{'success':_0x154c8b['flash'](_0x4dc238(0x131)),'errors':_0x154c8b[_0x4dc238(0x1e8)](_0x4dc238(0x183)),'role':_0x2f15bc,'profile':_0x210315,'master_shop':_0x2b924c,'customers':_0x23a6cf,'sales':_0x33ba61,'language':_0x2e8d1b});}catch(_0x2d9781){console['log'](_0x2d9781);}}),router[a0_0x29f14d(0x11a)](a0_0x29f14d(0x1d7),auth,async(_0xff4687,_0x202b2f)=>{var _0x1b9f16=a0_0x29f14d;try{const {username:_0x4f94eb,email:_0x357412,role:_0x4a5cdc}=_0xff4687['user'],_0x2d1bbe=_0xff4687['user'],_0x5bdc29=await profile['findOne']({'email':_0x2d1bbe[_0x1b9f16(0x1bd)]}),_0x86d296=await master_shop[_0x1b9f16(0x16a)]();console[_0x1b9f16(0x1d6)]('master',_0x86d296);const _0x5a3b91=_0xff4687[_0x1b9f16(0x11f)]['id'];console[_0x1b9f16(0x1d6)](_0x5a3b91);const _0x37f838=await sales[_0x1b9f16(0x1fa)](_0x5a3b91);console[_0x1b9f16(0x1d6)](_0x1b9f16(0x17a),_0x37f838);const _0x586b4e=await warehouse[_0x1b9f16(0x192)]([{'$match':{'name':_0x1b9f16(0x165),'room':_0x1b9f16(0x1f1)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1b9f16(0x1ab),'name':{'$first':_0x1b9f16(0x1fc)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x1b9f16(0x1a3)},'isle':{'$first':_0x1b9f16(0x11c)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x1b9f16(0x187)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x1b9f16(0x1d6)](_0x1b9f16(0x164),_0x586b4e);const _0x1d5da3=await product[_0x1b9f16(0x16a)]({});warehouse_data=await warehouse[_0x1b9f16(0x192)]([{'$match':{'status':_0x1b9f16(0x17d),'name':_0x1b9f16(0x165),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x1b9f16(0x1b7),'name':{'$first':_0x1b9f16(0x1b7)}}},{'$sort':{'name':0x1}}]);var _0x43c0c6=[_0x1b9f16(0x1f1)];if(_0x86d296[0x0][_0x1b9f16(0x1e3)]==_0x1b9f16(0x15c)){var _0x3f6013=users[_0x1b9f16(0x156)];console['log'](_0x3f6013);}else{if(_0x86d296[0x0]['language']==_0x1b9f16(0x19d))var _0x3f6013=users['Hindi'];else{if(_0x86d296[0x0][_0x1b9f16(0x1e3)]==_0x1b9f16(0x14f))var _0x3f6013=users[_0x1b9f16(0x14f)];else{if(_0x86d296[0x0][_0x1b9f16(0x1e3)]==_0x1b9f16(0x1fe))var _0x3f6013=users[_0x1b9f16(0x1fe)];else{if(_0x86d296[0x0][_0x1b9f16(0x1e3)]==_0x1b9f16(0x1b5))var _0x3f6013=users[_0x1b9f16(0x1b5)];else{if(_0x86d296[0x0]['language']==_0x1b9f16(0x13b))var _0x3f6013=users[_0x1b9f16(0x200)];else{if(_0x86d296[0x0][_0x1b9f16(0x1e3)]=='Chinese')var _0x3f6013=users[_0x1b9f16(0x1f4)];else{if(_0x86d296[0x0]['language']==_0x1b9f16(0x19a))var _0x3f6013=users[_0x1b9f16(0x15a)];}}}}}}}_0x202b2f['render'](_0x1b9f16(0x1a8),{'success':_0xff4687[_0x1b9f16(0x1e8)](_0x1b9f16(0x131)),'errors':_0xff4687[_0x1b9f16(0x1e8)](_0x1b9f16(0x183)),'role':_0x2d1bbe,'profile':_0x5bdc29,'user':_0x37f838,'stock':_0x586b4e,'master_shop':_0x86d296,'unit':_0x1d5da3,'language':_0x3f6013,'warehouses':warehouse_data,'rooms':_0x43c0c6});}catch(_0x4ffee6){console['log'](_0x4ffee6),_0x202b2f[_0x1b9f16(0x1ea)](0xc8)[_0x1b9f16(0x141)]({'message':_0x4ffee6[_0x1b9f16(0x160)]});}}),router['post'](a0_0x29f14d(0x1d7),auth,async(_0xb876f2,_0x430d06)=>{var _0x313156=a0_0x29f14d;try{const {invoice:_0x392ea6,date:_0x91548d,warehouse_name:_0x135646,product_name:_0x3228d6,primary_code:_0x3caaf6,secondary_code:_0x2869f7,product_code:_0x2cdb4d,sales_quantity:_0x2fee87,stocks:_0x4a7aea,return_qty:_0x2f1335,Room_name:_0x48a592,to_warehouse_name:_0x393172,to_Roomname:_0x5c1181,to_Room_name:_0x504bdd,note:_0x360753,level:_0x20a9ad,isle:_0x8f4b55,pallet:_0x32ee5d}=_0xb876f2['body'];if(typeof _0x3228d6==_0x313156(0x1c6))var _0x58ae6a=[_0xb876f2[_0x313156(0x1a5)]['product_name']],_0x44563a=[_0xb876f2['body']['primary_code']],_0x3c244a=[_0xb876f2['body'][_0x313156(0x1ad)]],_0xd695ca=[_0xb876f2[_0x313156(0x1a5)]['product_code']],_0x402bb1=[_0xb876f2[_0x313156(0x1a5)]['sales_quantity']],_0x4bd6b3=[_0xb876f2[_0x313156(0x1a5)]['stocks']],_0x175c41=[_0xb876f2[_0x313156(0x1a5)][_0x313156(0x20a)]],_0x595d15=[_0xb876f2[_0x313156(0x1a5)][_0x313156(0x1b4)]],_0xf997a2=[_0xb876f2[_0x313156(0x1a5)][_0x313156(0x189)]],_0x492a61=[_0xb876f2['body'][_0x313156(0x1f6)]],_0x2e0bfc=[_0xb876f2['body'][_0x313156(0x1fd)]];else var _0x58ae6a=[..._0xb876f2[_0x313156(0x1a5)][_0x313156(0x1ce)]],_0x44563a=[..._0xb876f2[_0x313156(0x1a5)]['primary_code']],_0x3c244a=[..._0xb876f2[_0x313156(0x1a5)][_0x313156(0x1ad)]],_0xd695ca=[..._0xb876f2[_0x313156(0x1a5)][_0x313156(0x161)]],_0x402bb1=[..._0xb876f2[_0x313156(0x1a5)][_0x313156(0x17c)]],_0x4bd6b3=[..._0xb876f2[_0x313156(0x1a5)]['stocks']],_0x175c41=[..._0xb876f2[_0x313156(0x1a5)]['return_qty']],_0x595d15=[..._0xb876f2[_0x313156(0x1a5)][_0x313156(0x1b4)]],_0xf997a2=[..._0xb876f2[_0x313156(0x1a5)]['bin']],_0x492a61=[..._0xb876f2[_0x313156(0x1a5)][_0x313156(0x1f6)]],_0x2e0bfc=[..._0xb876f2[_0x313156(0x1a5)][_0x313156(0x1fd)]];const _0x45b559=_0x58ae6a['map'](_0xdf3ae3=>{return _0xdf3ae3={'product_name':_0xdf3ae3};});_0x44563a[_0x313156(0x1c3)]((_0x3648d8,_0x4979a1)=>{var _0x53f8a9=_0x313156;_0x45b559[_0x4979a1][_0x53f8a9(0x145)]=_0x3648d8;}),_0x3c244a[_0x313156(0x1c3)]((_0x9c00bc,_0x330ee6)=>{var _0x9828e3=_0x313156;_0x45b559[_0x330ee6][_0x9828e3(0x1ad)]=_0x9c00bc;}),_0xd695ca['forEach']((_0x206e45,_0x23ddae)=>{var _0x24d30e=_0x313156;_0x45b559[_0x23ddae][_0x24d30e(0x161)]=_0x206e45;}),_0x402bb1[_0x313156(0x1c3)]((_0xcd4781,_0x1e75a2)=>{var _0x599ed0=_0x313156;_0x45b559[_0x1e75a2][_0x599ed0(0x17e)]=_0xcd4781;}),_0x4bd6b3[_0x313156(0x1c3)]((_0x95783c,_0x3dbd00)=>{var _0x4676d0=_0x313156;_0x45b559[_0x3dbd00][_0x4676d0(0x149)]=_0x95783c;}),_0x175c41[_0x313156(0x1c3)]((_0x2b6248,_0x9903c)=>{var _0x1e4873=_0x313156;_0x45b559[_0x9903c][_0x1e4873(0x20a)]=_0x2b6248;}),_0x595d15[_0x313156(0x1c3)]((_0x398741,_0x1fd212)=>{var _0x428c8d=_0x313156;_0x45b559[_0x1fd212][_0x428c8d(0x1b4)]=_0x398741;}),_0xf997a2[_0x313156(0x1c3)]((_0x266ffc,_0x182853)=>{var _0x1de0ac=_0x313156;_0x45b559[_0x182853][_0x1de0ac(0x189)]=_0x266ffc;}),_0x492a61['forEach']((_0x135a23,_0x243192)=>{var _0x227ed7=_0x313156;_0x45b559[_0x243192][_0x227ed7(0x18d)]=_0x135a23;}),_0x2e0bfc[_0x313156(0x1c3)]((_0x24a000,_0x1ff3e6)=>{var _0x356138=_0x313156;_0x45b559[_0x1ff3e6][_0x356138(0x1fd)]=_0x24a000;});var _0x140655=0x0;_0x45b559[_0x313156(0x1c3)](_0x1039c4=>{var _0x12adc8=_0x313156;console['log'](_0x12adc8(0x126),_0x1039c4),(parseInt(_0x1039c4['sale_qty'])<parseInt(_0x1039c4[_0x12adc8(0x20a)])||parseInt(_0x1039c4[_0x12adc8(0x149)])<parseInt(_0x1039c4[_0x12adc8(0x20a)])&&parseInt(_0x1039c4['sale_qty'])>parseInt(_0x1039c4['return_qty'])||parseInt(_0x1039c4[_0x12adc8(0x20a)])==0x0)&&_0x140655++;});if(_0x140655!=0x0)return _0xb876f2[_0x313156(0x1e8)](_0x313156(0x183),_0x313156(0x114)),_0x430d06[_0x313156(0x1ae)](_0x313156(0x1df));const _0x409438=await sales[_0x313156(0x197)]({'invoice':_0x392ea6});console[_0x313156(0x1d6)](_0x409438),_0x409438[_0x313156(0x1f2)]='True';const _0x23a811=await _0x409438['save'](),_0xa4b420=new sales_return({'invoice':_0x392ea6,'customer':_0xb876f2['body'][_0x313156(0x159)],'date':_0x91548d,'warehouse_name':_0x135646,'room':_0x48a592,'ToWarehouse':_0x393172,'ToRoom':_0x504bdd,'return_sale':_0x45b559,'note':_0x360753}),_0x17c7b4=await _0xa4b420[_0x313156(0x1a9)]();console[_0x313156(0x1d6)](_0xa4b420);const _0xca77e4=await sales_return[_0x313156(0x197)]({'invoice':_0x392ea6}),_0x4afbe5=await warehouse[_0x313156(0x197)]({'name':_0x393172,'room':_0x504bdd});_0xca77e4[_0x313156(0x1a8)]['forEach'](_0x50f49a=>{var _0x19a713=_0x313156,_0x53dcea=0x0;const _0x319b86=_0x4afbe5[_0x19a713(0x1e9)][_0x19a713(0x17b)](_0x56c54f=>{var _0x8a0e14=_0x19a713;_0x56c54f[_0x8a0e14(0x1ce)]==_0x50f49a[_0x8a0e14(0x1ce)]&&_0x56c54f[_0x8a0e14(0x1fd)]==_0x50f49a[_0x8a0e14(0x1fd)]&&_0x56c54f[_0x8a0e14(0x18d)]==_0x50f49a[_0x8a0e14(0x18d)]&&_0x56c54f[_0x8a0e14(0x189)]==_0x50f49a[_0x8a0e14(0x189)]&&_0x56c54f[_0x8a0e14(0x1b4)]==_0x50f49a[_0x8a0e14(0x1b4)]&&(_0x56c54f[_0x8a0e14(0x128)]=parseInt(_0x56c54f[_0x8a0e14(0x128)])+parseInt(_0x50f49a['return_qty']),_0x53dcea++);});_0x53dcea=='0'&&(_0x4afbe5[_0x19a713(0x1e9)]=_0x4afbe5[_0x19a713(0x1e9)][_0x19a713(0x180)]({'product_name':_0x50f49a['product_name'],'product_stock':_0x50f49a[_0x19a713(0x20a)],'primary_code':_0x50f49a[_0x19a713(0x145)],'secondary_code':_0x50f49a[_0x19a713(0x1ad)],'product_code':_0x50f49a[_0x19a713(0x161)],'bay':_0x50f49a[_0x19a713(0x1b4)],'bin':_0x50f49a['bin'],'type':_0x50f49a[_0x19a713(0x18d)],'floorlevel':_0x50f49a[_0x19a713(0x1fd)]})),console['log']('final',_0x4afbe5);}),await _0x4afbe5[_0x313156(0x1a9)](),console[_0x313156(0x1d6)](_0xb876f2[_0x313156(0x1a5)]);const _0x4b9066=new c_payment_data({'invoice':_0x392ea6,'customer':_0xb876f2[_0x313156(0x1a5)][_0x313156(0x159)],'reason':_0x313156(0x1aa)});await _0x4b9066[_0x313156(0x1a9)]();const _0x5677cc=await master_shop[_0x313156(0x16a)]();console[_0x313156(0x1d6)](_0x313156(0x1f3),_0x5677cc[0x0][_0x313156(0x221)]);const _0x37973b=await email_settings[_0x313156(0x197)](),_0x1ad8fa=await customer['findOne']({'name':_0xb876f2['body'][_0x313156(0x159)]});console['log']('customer_data',_0x1ad8fa);_0x5677cc[0x0][_0x313156(0x140)]==0x1?(right_currency=_0x5677cc[0x0][_0x313156(0x220)],left_currency=''):(right_currency='',left_currency=_0x5677cc[0x0]['currency']);var _0x3dcbdf=_0x58ae6a,_0x4e0671=_0x175c41,_0x3ce062='',_0x1be9b8;for(_0x1be9b8 in _0x3dcbdf){_0x3ce062+=_0x313156(0x1ef)+_0x313156(0x1fb)+_0x3dcbdf[_0x1be9b8]+_0x313156(0x18e)+_0x313156(0x1fb)+_0x4e0671[_0x1be9b8]+'</td>'+_0x313156(0x1d3);}console[_0x313156(0x1d6)](_0x313156(0x1d8),_0x3ce062);let _0x1eb581=nodemailer[_0x313156(0x1c7)]({'service':_0x313156(0x1d9),'auth':{'user':_0x37973b[_0x313156(0x1bd)],'pass':_0x37973b['password']}}),_0x423e95={'from':_0x37973b['email'],'to':_0x1ad8fa[_0x313156(0x1bd)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x313156(0x174),'path':__dirname+_0x313156(0x111)+'/upload/'+_0x5677cc[0x0][_0x313156(0x221)],'cid':_0x313156(0x157)}],'html':'<!DOCTYPE\x20html>'+_0x313156(0x1de)+_0x313156(0x1b1)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x313156(0x184)+_0x313156(0x120)+_0x313156(0x188)+_0x313156(0x184)+_0x313156(0x1bf)+_0x5677cc[0x0]['site_title']+_0x313156(0x13c)+'</div>'+'</div>'+_0x313156(0x135)+_0x313156(0x184)+_0x313156(0x1e4)+'\x20Order\x20Number\x20:\x20'+_0x392ea6+'\x20'+_0x313156(0x202)+_0x313156(0x147)+_0x91548d+'\x20'+'</span>'+_0x313156(0x1c2)+'</div>'+_0x313156(0x1dd)+_0x313156(0x218)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x313156(0x198)+_0x313156(0x134)+_0x313156(0x1f9)+_0x313156(0x1d3)+_0x313156(0x13d)+_0x313156(0x1e2)+'\x20'+_0x3ce062+'\x20'+_0x313156(0x179)+_0x313156(0x139)+_0x313156(0x184)+_0x313156(0x21c)+'<h5>'+_0x5677cc[0x0][_0x313156(0x1d0)]+_0x313156(0x1c2)+'</div>'+_0x313156(0x188)+_0x313156(0x18b)};_0x1eb581['sendMail'](_0x423e95,function(_0x343cc2,_0x568218){var _0x4ef832=_0x313156;_0x343cc2?(console[_0x4ef832(0x1d6)](_0x343cc2),console['log'](_0x4ef832(0x1b9))):console[_0x4ef832(0x1d6)]('Email\x20sent\x20successfully');}),_0xb876f2[_0x313156(0x1e8)](_0x313156(0x131),_0x313156(0x1d5)),_0x430d06[_0x313156(0x1ae)]('/all_sales/view');}catch(_0x3dbb10){console[_0x313156(0x1d6)](_0x3dbb10),_0x430d06[_0x313156(0x1ea)](0xc8)[_0x313156(0x141)]({'message1':_0x3dbb10[_0x313156(0x160)]});}}),router[a0_0x29f14d(0x11a)](a0_0x29f14d(0x168),auth,async(_0x4037e3,_0x5be1d1)=>{var _0x207e14=a0_0x29f14d;try{const {username:_0xce5d1d,email:_0x5ace9d,role:_0x58fbfe}=_0x4037e3[_0x207e14(0x21d)],_0x2f4834=_0x4037e3[_0x207e14(0x21d)],_0x426be5=await profile[_0x207e14(0x197)]({'email':_0x2f4834[_0x207e14(0x1bd)]}),_0x54523d=await master_shop[_0x207e14(0x16a)]();console[_0x207e14(0x1d6)](_0x207e14(0x130),_0x54523d);const _0x5acf59=_0x4037e3['params']['id'],_0x59bfbb=await sales[_0x207e14(0x1fa)](_0x5acf59);console[_0x207e14(0x1d6)](_0x207e14(0x133),_0x59bfbb);if(_0x54523d[0x0][_0x207e14(0x1e3)]==_0x207e14(0x15c))var _0x3802e5=users[_0x207e14(0x156)];else{if(_0x54523d[0x0][_0x207e14(0x1e3)]==_0x207e14(0x19d))var _0x3802e5=users[_0x207e14(0x19d)];else{if(_0x54523d[0x0][_0x207e14(0x1e3)]==_0x207e14(0x14f))var _0x3802e5=users[_0x207e14(0x14f)];else{if(_0x54523d[0x0][_0x207e14(0x1e3)]=='Spanish')var _0x3802e5=users[_0x207e14(0x1fe)];else{if(_0x54523d[0x0][_0x207e14(0x1e3)]==_0x207e14(0x1b5))var _0x3802e5=users['French'];else{if(_0x54523d[0x0][_0x207e14(0x1e3)]==_0x207e14(0x13b))var _0x3802e5=users[_0x207e14(0x200)];else{if(_0x54523d[0x0][_0x207e14(0x1e3)]==_0x207e14(0x1f4))var _0x3802e5=users[_0x207e14(0x1f4)];else{if(_0x54523d[0x0][_0x207e14(0x1e3)]==_0x207e14(0x19a))var _0x3802e5=users['Arabic'];}}}}}}}_0x5be1d1['render'](_0x207e14(0x1d1),{'success':_0x4037e3[_0x207e14(0x1e8)](_0x207e14(0x131)),'errors':_0x4037e3[_0x207e14(0x1e8)](_0x207e14(0x183)),'role':_0x2f4834,'profile':_0x426be5,'alldata':_0x59bfbb,'master_shop':_0x54523d,'language':_0x3802e5});}catch(_0x12d346){console[_0x207e14(0x1d6)](_0x12d346);}}),router[a0_0x29f14d(0x167)](a0_0x29f14d(0x223),async(_0x149bf7,_0x533819)=>{var _0x583bf4=a0_0x29f14d;const {product_code:_0xd02111,warehouse_name:_0x207b8f,rooms_data:_0xf8104f,Roomslist:_0x44e23a}=_0x149bf7[_0x583bf4(0x1a5)],_0x18e283=_0x44e23a['split'](','),_0x47c88e=[];async function _0x4a27f0(_0x3fea14){var _0x387785=_0x583bf4;const _0x16d494=await warehouse['aggregate']([{'$match':{'name':_0x207b8f,'room':_0x3fea14}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0xd02111}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x387785(0x20b)},'primary_code':{'$first':_0x387785(0x187)},'secondary_code':{'$first':_0x387785(0x1c5)},'product_code':{'$first':_0x387785(0x171)},'level':{'$first':_0x387785(0x1b6)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x387785(0x12e)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x387785(0x1f0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x387785(0x123)},'expiry_date':{'$first':_0x387785(0x176)},'production_date':{'$first':_0x387785(0x20c)},'maxPerUnit':{'$first':_0x387785(0x1ac)},'batch_code':{'$first':_0x387785(0x1a7)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x387785(0x213)},'invoice':{'$first':_0x387785(0x20e)},'actual_qty':{'$first':_0x387785(0x1a0)},'actual_uom':{'$first':_0x387785(0x1ed)}}}]),_0x560685=await warehouse[_0x387785(0x192)]([{'$match':{'name':_0x207b8f,'room':_0x3fea14}},{'$unwind':_0x387785(0x150)},{'$match':{'product_details.secondary_code':_0xd02111}},{'$group':{'_id':_0x387785(0x1ab),'name':{'$first':_0x387785(0x1fc)},'product_stock':{'$first':_0x387785(0x20b)},'primary_code':{'$first':_0x387785(0x187)},'secondary_code':{'$first':_0x387785(0x1c5)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x387785(0x1b6)},'isle':{'$first':_0x387785(0x182)},'type':{'$first':_0x387785(0x146)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x387785(0x1db)},'secondary_unit':{'$first':_0x387785(0x1f0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x387785(0x123)},'expiry_date':{'$first':_0x387785(0x176)},'production_date':{'$first':_0x387785(0x20c)},'maxPerUnit':{'$first':_0x387785(0x1ac)},'batch_code':{'$first':_0x387785(0x1a7)},'product_cat':{'$first':_0x387785(0x14d)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x387785(0x213)},'invoice':{'$first':_0x387785(0x20e)}}}]);if(_0x16d494[_0x387785(0x20f)]>0x0)_0x47c88e[_0x387785(0x1bc)](_0x16d494);else _0x560685[_0x387785(0x20f)]>0x0&&_0x47c88e[_0x387785(0x1bc)](_0x560685);}const _0x4f1124=_0x18e283[_0x583bf4(0x17b)](_0x22e3f8=>_0x4a27f0(_0x22e3f8));await Promise[_0x583bf4(0x1bb)](_0x4f1124),_0x533819[_0x583bf4(0x141)](_0x47c88e);}),module[a0_0x29f14d(0x1e7)]=router;