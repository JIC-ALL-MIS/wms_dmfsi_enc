var a0_0xafeddc=a0_0x2525;(function(_0x3fe3fb,_0xb921a2){var _0x38418c=a0_0x2525,_0x2fa729=_0x3fe3fb();while(!![]){try{var _0x24a2cd=-parseInt(_0x38418c(0x269))/0x1*(-parseInt(_0x38418c(0x237))/0x2)+parseInt(_0x38418c(0x1f4))/0x3+parseInt(_0x38418c(0x1e6))/0x4+-parseInt(_0x38418c(0x24a))/0x5*(parseInt(_0x38418c(0x1fc))/0x6)+parseInt(_0x38418c(0x1f9))/0x7*(-parseInt(_0x38418c(0x254))/0x8)+parseInt(_0x38418c(0x28d))/0x9*(parseInt(_0x38418c(0x22b))/0xa)+parseInt(_0x38418c(0x2ed))/0xb*(-parseInt(_0x38418c(0x236))/0xc);if(_0x24a2cd===_0xb921a2)break;else _0x2fa729['push'](_0x2fa729['shift']());}catch(_0x5853be){_0x2fa729['push'](_0x2fa729['shift']());}}}(a0_0x42ed,0x5123f));const express=require(a0_0xafeddc(0x259)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0xafeddc(0x28a)),auth=require('../middleware/auth'),nodemailer=require(a0_0xafeddc(0x216)),users=require('../public/language/languages.json');function a0_0x2525(_0x5e67f2,_0x2c41d6){var _0x42ed28=a0_0x42ed();return a0_0x2525=function(_0x2525ec,_0x3cadac){_0x2525ec=_0x2525ec-0x1e4;var _0x5ec992=_0x42ed28[_0x2525ec];return _0x5ec992;},a0_0x2525(_0x5e67f2,_0x2c41d6);}router[a0_0xafeddc(0x266)](a0_0xafeddc(0x276),auth,async(_0x27bbc,_0x30ec93)=>{var _0x1755a9=a0_0xafeddc;try{const {username:_0x391c13,email:_0xf2b009,role:_0x5b6014}=_0x27bbc[_0x1755a9(0x2af)],_0x29de02=_0x27bbc[_0x1755a9(0x2af)],_0x23d0d7=await profile[_0x1755a9(0x24c)]({'email':_0x29de02[_0x1755a9(0x20e)]}),_0x4a8e38=await master_shop[_0x1755a9(0x2ce)]();let _0xd611ab;if(_0x29de02[_0x1755a9(0x247)]==_0x1755a9(0x290)){const _0x4fab59=await staff[_0x1755a9(0x24c)]({'email':_0x29de02['email']});_0xd611ab=await sales[_0x1755a9(0x226)]([{'$lookup':{'from':_0x1755a9(0x25d),'localField':_0x1755a9(0x291),'foreignField':_0x1755a9(0x2da),'as':_0x1755a9(0x29e)}},{'$unwind':_0x1755a9(0x270)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x1755a9(0x20c),'invoice':{'$first':_0x1755a9(0x2bd)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x1755a9(0x275)},'note':{'$first':_0x1755a9(0x264)},'return_data':{'$first':_0x1755a9(0x2d3)},'customers_docs':{'$first':_0x1755a9(0x270)},'total_saleproduct_quantity':{'$sum':_0x1755a9(0x221)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x1755a9(0x25a)},'type':{'$addToSet':_0x1755a9(0x26e)},'pallet':{'$addToSet':_0x1755a9(0x262)},'finalize':{'$first':_0x1755a9(0x209)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0xd611ab=await sales[_0x1755a9(0x226)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x1755a9(0x2da),'as':'customers_docs'}},{'$unwind':_0x1755a9(0x270)},{'$unwind':_0x1755a9(0x275)},{'$group':{'_id':_0x1755a9(0x20c),'invoice':{'$first':_0x1755a9(0x2bd)},'customers':{'$first':_0x1755a9(0x244)},'date':{'$first':_0x1755a9(0x2c4)},'warehouse_name':{'$first':_0x1755a9(0x287)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x1755a9(0x264)},'return_data':{'$first':_0x1755a9(0x2d3)},'customers_docs':{'$first':_0x1755a9(0x270)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x1755a9(0x262)},'finalize':{'$first':_0x1755a9(0x209)},'isAllowEdit':{'$first':_0x1755a9(0x2dc)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x1755a9(0x2ef)]('sales\x20all_data',_0xd611ab);if(_0x4a8e38[0x0][_0x1755a9(0x1fa)]==_0x1755a9(0x25b)){var _0x31e946=users['English'];console[_0x1755a9(0x2ef)](_0x31e946);}else{if(_0x4a8e38[0x0][_0x1755a9(0x1fa)]==_0x1755a9(0x20b))var _0x31e946=users[_0x1755a9(0x20b)];else{if(_0x4a8e38[0x0][_0x1755a9(0x1fa)]==_0x1755a9(0x272))var _0x31e946=users[_0x1755a9(0x272)];else{if(_0x4a8e38[0x0][_0x1755a9(0x1fa)]=='Spanish')var _0x31e946=users[_0x1755a9(0x2d2)];else{if(_0x4a8e38[0x0][_0x1755a9(0x1fa)]==_0x1755a9(0x1ff))var _0x31e946=users[_0x1755a9(0x1ff)];else{if(_0x4a8e38[0x0]['language']=='Portuguese\x20(BR)')var _0x31e946=users['Portuguese'];else{if(_0x4a8e38[0x0]['language']==_0x1755a9(0x260))var _0x31e946=users['Chinese'];else{if(_0x4a8e38[0x0][_0x1755a9(0x1fa)]==_0x1755a9(0x293))var _0x31e946=users[_0x1755a9(0x280)];}}}}}}}_0x30ec93[_0x1755a9(0x22d)](_0x1755a9(0x2c7),{'success':_0x27bbc[_0x1755a9(0x2d1)](_0x1755a9(0x20d)),'errors':_0x27bbc[_0x1755a9(0x2d1)](_0x1755a9(0x267)),'sales':_0xd611ab,'profile':_0x23d0d7,'role':_0x29de02,'master_shop':_0x4a8e38,'language':_0x31e946});}catch(_0x4f1d14){console[_0x1755a9(0x2ef)](_0x4f1d14);}});async function getRandom8DigitNumber(){var _0x2da85b=a0_0xafeddc;const _0x41830b=0x989680,_0x501ab8=0x5f5e0ff,_0x348f22=Math[_0x2da85b(0x202)](Math[_0x2da85b(0x2a7)]()*(_0x501ab8-_0x41830b+0x1))+_0x41830b;var _0x8c8fe;const _0xbf356e=await sales['findOne']({'invoice':'OUT-'+_0x348f22});return _0xbf356e&&_0xbf356e[_0x2da85b(0x2b0)]>0x0?_0x8c8fe='OUT-'+_0x348f22:_0x8c8fe=_0x2da85b(0x2d5)+_0x348f22,_0x8c8fe;}router['get'](a0_0xafeddc(0x261),auth,async(_0x361acd,_0x19f219)=>{var _0x14ee49=a0_0xafeddc;try{const {username:_0x4640aa,email:_0x2699b8,role:_0x1be09d}=_0x361acd['user'],_0x435faf=_0x361acd['user'],_0x13a0be=await profile[_0x14ee49(0x24c)]({'email':_0x435faf[_0x14ee49(0x20e)]}),_0x290794=await master_shop[_0x14ee49(0x2ce)](),_0x3dee04=await customer[_0x14ee49(0x2ce)]({});let _0x20aa6e;if(_0x435faf['role']==_0x14ee49(0x290)){const _0x245c29=await staff[_0x14ee49(0x24c)]({'email':_0x435faf[_0x14ee49(0x20e)]});_0x20aa6e=await warehouse[_0x14ee49(0x226)]([{'$match':{'status':_0x14ee49(0x2db),'name':_0x245c29['warehouse'],'warehouse_category':_0x14ee49(0x295),'name':{'$ne':_0x14ee49(0x2b3)}}},{'$group':{'_id':_0x14ee49(0x21e),'name':{'$first':_0x14ee49(0x21e)}}},{'$sort':{'name':0x1}}]);}else _0x20aa6e=await warehouse[_0x14ee49(0x226)]([{'$match':{'status':_0x14ee49(0x2db),'warehouse_category':_0x14ee49(0x295),'name':{'$ne':_0x14ee49(0x2b3)}}},{'$group':{'_id':'$name','name':{'$first':_0x14ee49(0x21e)}}},{'$sort':{'name':0x1}}]);const _0x54d396=await product['find']({});var _0x14a864=[_0x14ee49(0x2cd),_0x14ee49(0x20f)];const _0x22b456=await sales[_0x14ee49(0x2ce)]({}),_0x38160b=_0x22b456[_0x14ee49(0x2b0)]+0x1,_0x4e90a8=_0x14ee49(0x2d5)+_0x38160b[_0x14ee49(0x2c8)]()[_0x14ee49(0x1f3)](0x5,'0');if(_0x290794[0x0][_0x14ee49(0x1fa)]==_0x14ee49(0x25b)){var _0x1083a9=users['English'];console['log'](_0x1083a9);}else{if(_0x290794[0x0]['language']==_0x14ee49(0x20b))var _0x1083a9=users[_0x14ee49(0x20b)];else{if(_0x290794[0x0][_0x14ee49(0x1fa)]==_0x14ee49(0x272))var _0x1083a9=users['German'];else{if(_0x290794[0x0]['language']==_0x14ee49(0x2d2))var _0x1083a9=users[_0x14ee49(0x2d2)];else{if(_0x290794[0x0][_0x14ee49(0x1fa)]=='French')var _0x1083a9=users[_0x14ee49(0x1ff)];else{if(_0x290794[0x0][_0x14ee49(0x1fa)]==_0x14ee49(0x218))var _0x1083a9=users['Portuguese'];else{if(_0x290794[0x0]['language']==_0x14ee49(0x260))var _0x1083a9=users[_0x14ee49(0x260)];else{if(_0x290794[0x0][_0x14ee49(0x1fa)]==_0x14ee49(0x293))var _0x1083a9=users['Arabic'];}}}}}}}const _0x5f0fc7=getRandom8DigitNumber();_0x5f0fc7[_0x14ee49(0x228)](_0x6a0208=>{var _0x11e38e=_0x14ee49;_0x19f219['render']('add_sales',{'success':_0x361acd[_0x11e38e(0x2d1)]('success'),'errors':_0x361acd[_0x11e38e(0x2d1)]('errors'),'role':_0x435faf,'profile':_0x13a0be,'customer':_0x3dee04,'warehouse':_0x20aa6e,'product':_0x54d396,'invoice':_0x6a0208,'master_shop':_0x290794,'language':_0x1083a9,'rooms_data':_0x14a864});})[_0x14ee49(0x1e7)](_0x35a6fe=>{var _0x48431f=_0x14ee49;_0x361acd['flash'](_0x48431f(0x267),_0x48431f(0x27f)),_0x19f219[_0x48431f(0x1fe)](_0x48431f(0x251));});}catch(_0x42580d){console['log'](_0x42580d);}}),router[a0_0xafeddc(0x266)](a0_0xafeddc(0x2f3),auth,async(_0x1accd9,_0x479c5d)=>{var _0x939ead=a0_0xafeddc;try{const _0x571052=_0x1accd9[_0x939ead(0x2b1)]['id'];console[_0x939ead(0x2ef)](_0x571052);const _0x21e2b6=await product['find'](),_0x18a520=await purchases[_0x939ead(0x226)]([{'$match':{'warehouse_name':_0x571052}},{'$unwind':_0x939ead(0x2df)},{'$group':{'_id':_0x939ead(0x2dd)}}]);console['log'](_0x939ead(0x2d7),_0x18a520),_0x479c5d['status'](0xc8)[_0x939ead(0x278)]({'purchases_data':_0x18a520,'product_data':_0x21e2b6});}catch(_0x3cf686){console['log'](_0x3cf686);}}),router[a0_0xafeddc(0x29a)](a0_0xafeddc(0x2f0),auth,async(_0x2c5e04,_0x1dcb8d)=>{var _0x5826e8=a0_0xafeddc;try{const {warehouse_data:_0x5620fa,product_data:_0x4226a9}=_0x2c5e04[_0x5826e8(0x27b)];console['log'](_0x2c5e04[_0x5826e8(0x27b)]['product_data']);;const _0x17f0b8=await master_shop['find']();console['log'](_0x5826e8(0x21f),_0x17f0b8);const _0x11701b=await product[_0x5826e8(0x24c)]({'name':_0x4226a9});console[_0x5826e8(0x2ef)](_0x5826e8(0x227),_0x11701b);const _0x5c2a50=await warehouse[_0x5826e8(0x226)]([{'$match':{'name':_0x5620fa}},{'$unwind':_0x5826e8(0x2a6)},{'$match':{'product_details.product_name':_0x4226a9}},{'$group':{'_id':_0x5826e8(0x1e4),'product_stock':{'$first':_0x5826e8(0x1ec)}}}]);console[_0x5826e8(0x2ef)](_0x5826e8(0x257),_0x5c2a50),_0x1dcb8d['status'](0xc8)[_0x5826e8(0x278)]({'master':_0x17f0b8,'new_product':_0x11701b,'stock_data':_0x5c2a50});}catch(_0x5e2e01){console[_0x5826e8(0x2ef)](_0x5e2e01);}}),router[a0_0xafeddc(0x29a)](a0_0xafeddc(0x261),auth,async(_0x52b212,_0x3dd705)=>{var _0x1f2d08=a0_0xafeddc;try{const {invoice:_0x25ff3,date:_0x309183,warehouse_name:_0x25fdf9,product_name:_0x387f7a,stock:_0x5b35ca,quantity:_0xc96da0,note:_0x2877ea,room:_0xd08f77,primary_code:_0x577f14,secondary_code:_0x3bdb7c,prod_code:_0x4166bd,level:_0x1dc4ef,isle:_0x4efdce,pallet:_0x3dc08f,batch_code:_0x1a8ffb,SCRN:_0x1e062f,expiry_date:_0x45f444}=_0x52b212[_0x1f2d08(0x27b)];if(typeof _0x387f7a==_0x1f2d08(0x2be))var _0x3a8601=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x201)]],_0x39e1fb=[_0x52b212['body'][_0x1f2d08(0x2ee)]],_0x2a8b5d=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x2b9)]],_0x9fbfec=[_0x52b212['body'][_0x1f2d08(0x1ea)]],_0xfd9bd1=[_0x52b212[_0x1f2d08(0x27b)]['secondary_code']],_0x754242=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x2f5)]],_0x3012b2=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x24f)]],_0x1a32a8=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x2b6)]],_0x499c4e=[_0x52b212['body'][_0x1f2d08(0x243)]],_0x1a4922=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x214)]],_0x1eb581=[_0x52b212[_0x1f2d08(0x27b)]['expiry_date']],_0xaf5678=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x265)]],_0x22c9b8=[_0x52b212['body'][_0x1f2d08(0x25f)]],_0x2194c6=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x26d)]],_0x5af1be=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x213)]],_0xf35d56=[_0x52b212['body'][_0x1f2d08(0x1f0)]],_0x51a3cb=[_0x52b212['body'][_0x1f2d08(0x233)]],_0x107552=[_0x52b212['body'][_0x1f2d08(0x294)]],_0x581f4f=[_0x52b212['body'][_0x1f2d08(0x2c2)]],_0x5b891d=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x212)]],_0x17290a=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x2ba)]],_0x533e50=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x29f)]],_0x154ad4=[_0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x282)]];else var _0x3a8601=[..._0x52b212[_0x1f2d08(0x27b)]['product_name']],_0x39e1fb=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x2ee)]],_0x2a8b5d=[..._0x52b212[_0x1f2d08(0x27b)]['carton']],_0x9fbfec=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x1ea)]],_0xfd9bd1=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x26c)]],_0x754242=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x2f5)]],_0x3012b2=[..._0x52b212[_0x1f2d08(0x27b)]['level']],_0x1a32a8=[..._0x52b212[_0x1f2d08(0x27b)]['primary_unit']],_0x499c4e=[..._0x52b212[_0x1f2d08(0x27b)]['secondary_unit']],_0x1a4922=[..._0x52b212['body']['batch_code']],_0x1eb581=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x279)]],_0xaf5678=[..._0x52b212[_0x1f2d08(0x27b)]['max_per_unit']],_0x22c9b8=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x25f)]],_0x2194c6=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x26d)]],_0x5af1be=[..._0x52b212[_0x1f2d08(0x27b)]['delivery_date']],_0xf35d56=[..._0x52b212[_0x1f2d08(0x27b)]['delivery_code']],_0x51a3cb=[..._0x52b212['body']['prod_cat']],_0x107552=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x294)]],_0x581f4f=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x2c2)]],_0x5b891d=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x212)]],_0x17290a=[..._0x52b212['body'][_0x1f2d08(0x2ba)]],_0x533e50=[..._0x52b212[_0x1f2d08(0x27b)][_0x1f2d08(0x29f)]],_0x154ad4=[..._0x52b212['body'][_0x1f2d08(0x282)]];const _0x5b9b79=_0x3a8601['map'](_0x4e6236=>{return _0x4e6236={'product_name':_0x4e6236};});_0x39e1fb[_0x1f2d08(0x2d4)]((_0x485e50,_0x37bef4)=>{var _0x14244f=_0x1f2d08;_0x5b9b79[_0x37bef4][_0x14244f(0x2ee)]=Math['abs'](_0x485e50);}),_0x17290a[_0x1f2d08(0x2d4)]((_0x5ac27b,_0x5b1642)=>{var _0x2d43d1=_0x1f2d08;_0x5b9b79[_0x5b1642][_0x2d43d1(0x2ba)]=Math[_0x2d43d1(0x1fb)](_0x5ac27b);}),_0x533e50[_0x1f2d08(0x2d4)]((_0x4a84aa,_0x558a05)=>{var _0x55614a=_0x1f2d08;_0x5b9b79[_0x558a05][_0x55614a(0x29f)]=_0x4a84aa;}),_0x154ad4[_0x1f2d08(0x2d4)]((_0x3ea55c,_0x4b1eb7)=>{var _0x1e7487=_0x1f2d08;_0x5b9b79[_0x4b1eb7][_0x1e7487(0x211)]=_0x3ea55c;}),_0x2a8b5d[_0x1f2d08(0x2d4)]((_0x2f41ad,_0x1c5919)=>{var _0x33cfbe=_0x1f2d08;_0x5b9b79[_0x1c5919][_0x33cfbe(0x294)]=_0x2f41ad;}),_0x9fbfec['forEach']((_0x1906d1,_0x484e57)=>{var _0x2bdc34=_0x1f2d08;_0x5b9b79[_0x484e57][_0x2bdc34(0x1ea)]=_0x1906d1;}),_0xfd9bd1[_0x1f2d08(0x2d4)]((_0x38fa07,_0x48cf72)=>{var _0x3ec933=_0x1f2d08;_0x5b9b79[_0x48cf72][_0x3ec933(0x26c)]=_0x38fa07;}),_0x754242[_0x1f2d08(0x2d4)]((_0x33bafe,_0x52cd17)=>{var _0x35dad9=_0x1f2d08;_0x5b9b79[_0x52cd17][_0x35dad9(0x23f)]=_0x33bafe;}),_0x3012b2['forEach']((_0x19c0f4,_0x55bf85)=>{_0x581f4f['forEach']((_0x3fffb6,_0x59f8f6)=>{var _0x4c2e71=a0_0x2525;if(_0x3fffb6=='Receiving\x20Area'&&_0x55bf85==_0x59f8f6){var _0xa3118d=_0x19c0f4[_0x4c2e71(0x2e0)](0x3);_0x5b9b79[_0x55bf85]['storage']=_0x19c0f4[0x0],_0x5b9b79[_0x55bf85]['rack']=_0x19c0f4[0x1],_0x5b9b79[_0x55bf85][_0x4c2e71(0x1fd)]=0x0,_0x5b9b79[_0x55bf85]['bin']=0x0,_0x5b9b79[_0x55bf85][_0x4c2e71(0x232)]=_0x4c2e71(0x21a),_0x5b9b79[_0x55bf85][_0x4c2e71(0x239)]=_0xa3118d;}else{if(_0x3fffb6==_0x4c2e71(0x2ae)&&_0x55bf85==_0x59f8f6){var _0xa3118d=_0x19c0f4[_0x4c2e71(0x2e0)](0x3);_0x5b9b79[_0x55bf85][_0x4c2e71(0x2f2)]=_0x19c0f4[0x0],_0x5b9b79[_0x55bf85]['rack']=_0x19c0f4[0x1],_0x5b9b79[_0x55bf85][_0x4c2e71(0x1fd)]=0x0,_0x5b9b79[_0x55bf85]['bin']=0x0,_0x5b9b79[_0x55bf85]['type']=_0x4c2e71(0x21a),_0x5b9b79[_0x55bf85]['floorlevel']=_0x19c0f4[0x5];}else{if(_0x55bf85==_0x59f8f6){var _0x16a270;if(_0x19c0f4[0x4]=='L')_0x16a270='Level';else _0x19c0f4[0x4]=='F'&&(_0x16a270=_0x4c2e71(0x21a));_0x5b9b79[_0x55bf85][_0x4c2e71(0x2f2)]=_0x19c0f4[0x0],_0x5b9b79[_0x55bf85][_0x4c2e71(0x210)]=_0x19c0f4[0x1],_0x5b9b79[_0x55bf85][_0x4c2e71(0x1fd)]=_0x19c0f4[0x2],_0x5b9b79[_0x55bf85][_0x4c2e71(0x2e4)]=_0x19c0f4[0x3],_0x5b9b79[_0x55bf85][_0x4c2e71(0x232)]=_0x16a270,_0x5b9b79[_0x55bf85]['floorlevel']=_0x19c0f4[0x5];}}}});}),_0x1a32a8[_0x1f2d08(0x2d4)]((_0x401ddd,_0x3984fb)=>{var _0x402656=_0x1f2d08;_0x5b9b79[_0x3984fb][_0x402656(0x249)]=_0x401ddd;}),_0x499c4e['forEach']((_0x302c0a,_0x2a7e1a)=>{_0x5b9b79[_0x2a7e1a]['secondary_unit']=_0x302c0a;}),_0x1a4922['forEach']((_0x196a0c,_0x1a62c1)=>{var _0x374f9e=_0x1f2d08;_0x5b9b79[_0x1a62c1][_0x374f9e(0x214)]=_0x196a0c;}),_0x1eb581[_0x1f2d08(0x2d4)]((_0x167581,_0x5e3afa)=>{var _0x37bee0=_0x1f2d08;_0x5b9b79[_0x5e3afa][_0x37bee0(0x279)]=_0x167581;}),_0xaf5678[_0x1f2d08(0x2d4)]((_0x4d4142,_0x3d0cd2)=>{var _0x48a755=_0x1f2d08;_0x5b9b79[_0x3d0cd2][_0x48a755(0x250)]=_0x4d4142;}),_0x22c9b8['forEach']((_0x3f77ac,_0x21f5d7)=>{var _0x29b061=_0x1f2d08;_0x5b9b79[_0x21f5d7][_0x29b061(0x25f)]=_0x3f77ac;}),_0x2194c6['forEach']((_0x36f601,_0x24a596)=>{_0x5b9b79[_0x24a596]['requested_qty']=_0x36f601;}),_0x5af1be[_0x1f2d08(0x2d4)]((_0x200d38,_0x2a2558)=>{var _0x5cb795=_0x1f2d08;_0x5b9b79[_0x2a2558][_0x5cb795(0x213)]=_0x200d38;}),_0xf35d56[_0x1f2d08(0x2d4)]((_0x4bccff,_0x1cc431)=>{var _0xe7cbf4=_0x1f2d08;_0x5b9b79[_0x1cc431][_0xe7cbf4(0x1f0)]=_0x4bccff;}),_0x51a3cb[_0x1f2d08(0x2d4)]((_0x51d53b,_0x344262)=>{var _0x14f007=_0x1f2d08;_0x5b9b79[_0x344262][_0x14f007(0x233)]=_0x51d53b;}),_0x107552[_0x1f2d08(0x2d4)]((_0x2fac44,_0x5ea49d)=>{var _0x4d0931=_0x1f2d08;_0x5b9b79[_0x5ea49d][_0x4d0931(0x2e6)]=_0x2fac44;}),_0x581f4f[_0x1f2d08(0x2d4)]((_0x491b4f,_0x9b0af1)=>{var _0x26631f=_0x1f2d08;_0x5b9b79[_0x9b0af1][_0x26631f(0x2f4)]=_0x491b4f;}),_0x5b891d['forEach']((_0x57598a,_0x24f130)=>{var _0x54db4f=_0x1f2d08;_0x5b9b79[_0x24f130][_0x54db4f(0x200)]=_0x57598a;});var _0x5a2ebf=0x0;_0x5b9b79[_0x1f2d08(0x2d4)](_0x3d8644=>{var _0x81fb7b=_0x1f2d08;(_0x3d8644[_0x81fb7b(0x2ee)]<_0x3d8644[_0x81fb7b(0x2e6)]||_0x3d8644['quantity_notConverted']==0x0)&&(console['log']('foreach\x20newproduct',_0x3d8644),_0x5a2ebf++);});const _0x273934=_0x5b9b79[_0x1f2d08(0x26a)](_0x3664fe=>_0x3664fe[_0x1f2d08(0x294)]!=='0'&&_0x3664fe[_0x1f2d08(0x294)]!==''),_0x21a66c=new sales({'invoice':_0x25ff3,'customer':_0x52b212[_0x1f2d08(0x27b)]['customer'],'date':_0x309183,'warehouse_name':_0x25fdf9,'sale_product':_0x273934,'note':_0x2877ea,'room':_0xd08f77,'primary_code':_0x577f14,'secondary_code':_0x3bdb7c,'prod_code':_0x4166bd,'SCRN':_0x1e062f}),_0x3f35e5=await _0x21a66c['save']();_0x52b212[_0x1f2d08(0x2d1)](_0x1f2d08(0x20d),_0x1f2d08(0x296)),_0x3dd705[_0x1f2d08(0x1fe)](_0x1f2d08(0x2a3)+_0x3f35e5['_id']);}catch(_0x2a8414){console[_0x1f2d08(0x2ef)](_0x2a8414);}}),router[a0_0xafeddc(0x266)]('/preview/:id',auth,async(_0x524292,_0x1cbbaa)=>{var _0xe1091f=a0_0xafeddc;try{const {username:_0x29b56b,email:_0x15d38b,role:_0x312af2}=_0x524292[_0xe1091f(0x2af)],_0x461cd4=_0x524292['user'],_0x5170b3=await profile[_0xe1091f(0x24c)]({'email':_0x461cd4['email']}),_0xb0cd64=await master_shop[_0xe1091f(0x2ce)](),_0x25554b=_0x524292['params']['id'],_0x503209=await sales[_0xe1091f(0x21c)](_0x25554b),_0x24f643=await warehouse[_0xe1091f(0x226)]([{'$match':{'name':_0x503209[_0xe1091f(0x297)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0xe1091f(0x1f1),'name':{'$first':_0xe1091f(0x1e4)},'product_stock':{'$first':_0xe1091f(0x1ec)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xe1091f(0x229)},'type':{'$first':_0xe1091f(0x2c9)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xe1091f(0x2cb)},'secondary_code':{'$first':_0xe1091f(0x24d)},'product_code':{'$first':_0xe1091f(0x273)},'storage':{'$first':_0xe1091f(0x240)},'rack':{'$first':_0xe1091f(0x1f2)},'expiry_date':{'$first':_0xe1091f(0x2ec)},'production_date':{'$first':_0xe1091f(0x2d9)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x1a4e95=await customer[_0xe1091f(0x2ce)]({});let _0x765723;if(_0x461cd4['role']==_0xe1091f(0x290)){const _0x51f0ff=await staff['findOne']({'email':_0x461cd4['email']});_0x765723=await warehouse[_0xe1091f(0x226)]([{'$match':{'status':_0xe1091f(0x2db),'name':_0x51f0ff[_0xe1091f(0x2de)]}},{'$group':{'_id':_0xe1091f(0x21e),'name':{'$first':'$name'}}}]);}else _0x765723=await warehouse[_0xe1091f(0x226)]([{'$match':{'status':_0xe1091f(0x2db)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x1e6da1=await product[_0xe1091f(0x2ce)]({}),_0x3a1d99=await suppliers[_0xe1091f(0x2ce)]({});if(_0xb0cd64[0x0][_0xe1091f(0x1fa)]==_0xe1091f(0x25b)){var _0x1bf599=users[_0xe1091f(0x285)];console[_0xe1091f(0x2ef)](_0x1bf599);}else{if(_0xb0cd64[0x0][_0xe1091f(0x1fa)]==_0xe1091f(0x20b))var _0x1bf599=users['Hindi'];else{if(_0xb0cd64[0x0][_0xe1091f(0x1fa)]==_0xe1091f(0x272))var _0x1bf599=users['German'];else{if(_0xb0cd64[0x0][_0xe1091f(0x1fa)]==_0xe1091f(0x2d2))var _0x1bf599=users[_0xe1091f(0x2d2)];else{if(_0xb0cd64[0x0]['language']==_0xe1091f(0x1ff))var _0x1bf599=users[_0xe1091f(0x1ff)];else{if(_0xb0cd64[0x0][_0xe1091f(0x1fa)]=='Portuguese\x20(BR)')var _0x1bf599=users[_0xe1091f(0x2a9)];else{if(_0xb0cd64[0x0]['language']==_0xe1091f(0x260))var _0x1bf599=users['Chinese'];else{if(_0xb0cd64[0x0][_0xe1091f(0x1fa)]==_0xe1091f(0x293))var _0x1bf599=users[_0xe1091f(0x280)];}}}}}}}_0x1cbbaa['render']('edit_sales_view',{'success':_0x524292[_0xe1091f(0x2d1)]('success'),'errors':_0x524292[_0xe1091f(0x2d1)]('errors'),'role':_0x461cd4,'profile':_0x5170b3,'customer':_0x1a4e95,'warehouse':_0x765723,'product':_0x24f643,'user':_0x503209,'master_shop':_0xb0cd64,'unit':_0x1e6da1,'language':_0x1bf599,'suppliers':_0x3a1d99});}catch(_0x2ff4ed){console['log'](_0x2ff4ed);}}),router[a0_0xafeddc(0x29a)](a0_0xafeddc(0x215),auth,async(_0x295181,_0x3332a7)=>{var _0x54cfe1=a0_0xafeddc;try{const _0x4175a9=_0x295181[_0x54cfe1(0x2b1)]['id'],{invoice:_0x15804d,warehouse_name:_0x3e1aac,room:_0x2bd6fe}=_0x295181[_0x54cfe1(0x27b)],_0x4dc4fc=await sales[_0x54cfe1(0x24c)]({'invoice':_0x15804d}),_0x2b5608=_0x4dc4fc[_0x54cfe1(0x20a)][_0x54cfe1(0x2bf)](async _0x30b749=>{var _0xd366b0=_0x54cfe1,_0x50b963=await warehouse[_0xd366b0(0x24c)]({'name':_0x3e1aac,'room':_0x30b749[_0xd366b0(0x2f4)],'warehouse_category':_0xd366b0(0x295)});const _0x2a5268=_0x50b963[_0xd366b0(0x23d)]['map'](_0x513a3a=>{var _0x1a68bc=_0xd366b0;_0x513a3a[_0x1a68bc(0x201)]==_0x30b749['product_name']&&_0x513a3a['floorlevel']==_0x30b749[_0x1a68bc(0x239)]&&_0x513a3a[_0x1a68bc(0x232)]==_0x30b749['type']&&_0x513a3a[_0x1a68bc(0x2e4)]==_0x30b749[_0x1a68bc(0x2e4)]&&_0x513a3a['bay']==_0x30b749[_0x1a68bc(0x1fd)]&&_0x513a3a[_0x1a68bc(0x210)]==_0x30b749[_0x1a68bc(0x210)]&&_0x513a3a[_0x1a68bc(0x2f2)]==_0x30b749['storage']&&_0x513a3a['expiry_date']==_0x30b749['expiry_date']&&_0x513a3a[_0x1a68bc(0x214)]==_0x30b749[_0x1a68bc(0x214)]&&_0x513a3a[_0x1a68bc(0x200)]==_0x30b749[_0x1a68bc(0x200)]&&_0x513a3a['_id']==_0x30b749['id_transaction_from']&&(_0x513a3a[_0x1a68bc(0x258)]=Math[_0x1a68bc(0x2a1)](0x0,Math[_0x1a68bc(0x1fb)](_0x513a3a[_0x1a68bc(0x258)])-Math[_0x1a68bc(0x1fb)](_0x30b749['quantity'])));});return _0x50b963;});Promise[_0x54cfe1(0x255)](_0x2b5608)[_0x54cfe1(0x228)](async _0x34de31=>{var _0x20370c=_0x54cfe1;try{for(const _0xe14196 of _0x34de31){await _0xe14196[_0x20370c(0x2bb)]();}_0x4dc4fc[_0x20370c(0x224)]='True';const _0x4537f6=await _0x4dc4fc[_0x20370c(0x2bb)](),_0x28b940=await master_shop[_0x20370c(0x2ce)](),_0x2034f8=await email_settings[_0x20370c(0x24c)](),_0x10aaa1=await supervisor_settings[_0x20370c(0x2ce)]();var _0x759882=_0x4dc4fc[_0x20370c(0x20a)],_0x1d4e12='',_0x43df66;for(_0x43df66 in _0x759882){_0x1d4e12+=_0x20370c(0x1ef)+_0x20370c(0x2c3)+_0x759882[_0x43df66]['product_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x759882[_0x43df66]['product_code']+_0x20370c(0x268)+_0x20370c(0x2c3)+_0x759882[_0x43df66][_0x20370c(0x294)]+_0x20370c(0x268)+_0x20370c(0x2c3)+_0x759882[_0x43df66][_0x20370c(0x249)]+_0x20370c(0x268)+_0x20370c(0x2c3)+_0x759882[_0x43df66][_0x20370c(0x243)]+_0x20370c(0x268)+_0x20370c(0x2c3)+_0x4dc4fc[_0x20370c(0x297)]+_0x20370c(0x268)+_0x20370c(0x2c3)+_0x759882[_0x43df66][_0x20370c(0x2f4)]+'</td>'+_0x20370c(0x2c3)+_0x759882[_0x43df66][_0x20370c(0x2f2)]+_0x759882[_0x43df66]['rack']+_0x759882[_0x43df66][_0x20370c(0x1fd)]+_0x759882[_0x43df66]['bin']+_0x759882[_0x43df66][_0x20370c(0x232)][0x0]+_0x759882[_0x43df66]['floorlevel']+'</td>','</tr>';}let _0xb52670=nodemailer['createTransport']({'host':_0x2034f8[_0x20370c(0x27d)],'port':Number(_0x2034f8['port']),'secure':![],'auth':{'user':_0x2034f8[_0x20370c(0x20e)],'pass':_0x2034f8['password']}}),_0x534be7={'from':_0x2034f8[_0x20370c(0x20e)],'to':_0x10aaa1[0x0][_0x20370c(0x2ca)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x20370c(0x2c5),'path':__dirname+_0x20370c(0x208)+_0x20370c(0x2d0)+_0x28b940[0x0][_0x20370c(0x288)],'cid':'logo'}],'html':_0x20370c(0x207)+'<html><head><title></title>'+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x20370c(0x2e2)+_0x20370c(0x22e)+'</div>'+'<div>'+'<h2>\x20'+_0x28b940[0x0][_0x20370c(0x26b)]+_0x20370c(0x252)+_0x20370c(0x242)+'</div>'+_0x20370c(0x2eb)+_0x20370c(0x2e2)+_0x20370c(0x292)+_0x20370c(0x274)+_0x4dc4fc[_0x20370c(0x200)]+'\x20'+_0x20370c(0x2a5)+_0x20370c(0x2e8)+_0x4dc4fc['date']+'\x20'+_0x20370c(0x289)+'</h5>'+_0x20370c(0x242)+_0x20370c(0x2cc)+_0x20370c(0x25e)+'<tr>'+_0x20370c(0x28b)+_0x20370c(0x2ab)+_0x20370c(0x241)+_0x20370c(0x27a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x20370c(0x27c)+_0x20370c(0x1e9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x20370c(0x238)+_0x20370c(0x2ac)+_0x20370c(0x1f5)+'\x20'+_0x1d4e12+'\x20'+_0x20370c(0x22a)+_0x20370c(0x2aa)+_0x20370c(0x2e2)+_0x20370c(0x21d)+_0x20370c(0x21b)+_0x28b940[0x0][_0x20370c(0x26b)]+_0x20370c(0x2ea)+_0x20370c(0x242)+'</div>'+'</body></html>'};_0xb52670[_0x20370c(0x2b5)](_0x534be7,function(_0x37d824,_0x56ac56){var _0x425ef4=_0x20370c;_0x37d824?(console[_0x425ef4(0x2ef)](_0x37d824),console[_0x425ef4(0x2ef)](_0x425ef4(0x203))):console[_0x425ef4(0x2ef)](_0x425ef4(0x299));}),_0x295181[_0x20370c(0x2d1)]('success',_0x20370c(0x29b)),_0x3332a7['redirect'](_0x20370c(0x2a3)+_0x4175a9);}catch(_0x461779){console['error'](_0x461779),_0x3332a7[_0x20370c(0x263)](0x1f4)['json']({'error':_0x20370c(0x234)});}})[_0x54cfe1(0x1e7)](_0x654fa5=>{var _0xf0320d=_0x54cfe1;console[_0xf0320d(0x284)](_0x654fa5),_0x3332a7[_0xf0320d(0x263)](0x1f4)[_0xf0320d(0x278)]({'error':_0xf0320d(0x24b)});});}catch(_0x24e0e2){console[_0x54cfe1(0x2ef)](_0x24e0e2);}}),router[a0_0xafeddc(0x266)](a0_0xafeddc(0x2bc),auth,async(_0x215564,_0x2fe1d9)=>{var _0x106908=a0_0xafeddc;try{const {username:_0x399b56,email:_0x8fcb0d,role:_0x4d3568}=_0x215564[_0x106908(0x2af)],_0x4dc969=_0x215564['user'],_0x1fa5f5=await profile[_0x106908(0x24c)]({'email':_0x4dc969[_0x106908(0x20e)]}),_0xe8761b=await master_shop[_0x106908(0x2ce)](),_0x1f32a1=_0x215564[_0x106908(0x2b1)]['id'],_0x2ab3ee=await sales[_0x106908(0x21c)](_0x1f32a1);var _0x1de9fd=[_0x106908(0x2cd),_0x106908(0x20f)];const _0x130f7e=await warehouse['aggregate']([{'$match':{'name':_0x2ab3ee[_0x106908(0x297)],'warehouse_category':_0x106908(0x295)}},{'$unwind':_0x106908(0x2a6)},{'$group':{'_id':_0x106908(0x1f1),'name':{'$first':_0x106908(0x1e4)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x106908(0x28c)},'bin':{'$first':_0x106908(0x229)},'type':{'$first':_0x106908(0x2c9)},'floorlevel':{'$first':_0x106908(0x2e7)},'primary_code':{'$first':_0x106908(0x2cb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x106908(0x273)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]),_0x258e40=await customer[_0x106908(0x2ce)]({});let _0x484d0c;if(_0x4dc969[_0x106908(0x247)]==_0x106908(0x290)){const _0x47ece2=await staff['findOne']({'email':_0x4dc969[_0x106908(0x20e)]});_0x484d0c=await warehouse['aggregate']([{'$match':{'status':_0x106908(0x2db),'name':_0x47ece2['warehouse'],'warehouse_category':_0x106908(0x295)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x484d0c=await warehouse['aggregate']([{'$match':{'status':_0x106908(0x2db),'warehouse_category':_0x106908(0x295)}},{'$group':{'_id':_0x106908(0x21e),'name':{'$first':_0x106908(0x21e)}}}]);const _0x4ec346=await product[_0x106908(0x2ce)]({});if(_0xe8761b[0x0][_0x106908(0x1fa)]==_0x106908(0x25b)){var _0x347f8e=users[_0x106908(0x285)];console['log'](_0x347f8e);}else{if(_0xe8761b[0x0]['language']=='Hindi')var _0x347f8e=users['Hindi'];else{if(_0xe8761b[0x0][_0x106908(0x1fa)]=='German')var _0x347f8e=users[_0x106908(0x272)];else{if(_0xe8761b[0x0][_0x106908(0x1fa)]=='Spanish')var _0x347f8e=users['Spanish'];else{if(_0xe8761b[0x0][_0x106908(0x1fa)]=='French')var _0x347f8e=users[_0x106908(0x1ff)];else{if(_0xe8761b[0x0][_0x106908(0x1fa)]==_0x106908(0x218))var _0x347f8e=users['Portuguese'];else{if(_0xe8761b[0x0]['language']=='Chinese')var _0x347f8e=users[_0x106908(0x260)];else{if(_0xe8761b[0x0][_0x106908(0x1fa)]=='Arabic\x20(ae)')var _0x347f8e=users[_0x106908(0x280)];}}}}}}}_0x2fe1d9[_0x106908(0x22d)](_0x106908(0x26f),{'success':_0x215564[_0x106908(0x2d1)](_0x106908(0x20d)),'errors':_0x215564[_0x106908(0x2d1)](_0x106908(0x267)),'role':_0x4dc969,'profile':_0x1fa5f5,'customer':_0x258e40,'warehouse':_0x484d0c,'product':_0x130f7e,'user':_0x2ab3ee,'master_shop':_0xe8761b,'unit':_0x4ec346,'language':_0x347f8e});}catch(_0x45d1a8){console[_0x106908(0x2ef)](_0x45d1a8);}}),router[a0_0xafeddc(0x29a)](a0_0xafeddc(0x2bc),auth,async(_0x509b9a,_0x3984fd)=>{var _0x2b5083=a0_0xafeddc;try{const _0x4df251=_0x509b9a[_0x2b5083(0x2b1)]['id'],_0x11946e=await sales[_0x2b5083(0x24c)]({'_id':_0x509b9a['params']['id']}),_0x2a0aeb=await warehouse[_0x2b5083(0x24c)]({'name':_0x11946e[_0x2b5083(0x297)],'room':_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x1e5)]}),{invoice:_0x3c724d,date:_0x32dcff,warehouse_name:_0x3fe6d7,product_name:_0x5cce44,stock:_0x46225b,quantity:_0x55e917,note:_0x2d8909,room:_0x427cd0,customer:_0x557839,SCRN:_0xdbcd24}=_0x509b9a[_0x2b5083(0x27b)];if(typeof _0x5cce44==_0x2b5083(0x2be))var _0x60846c=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x201)]],_0x4251c3=[_0x509b9a['body'][_0x2b5083(0x2ee)]],_0x985a5f=[_0x509b9a[_0x2b5083(0x27b)]['carton']],_0x3864cc=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x1ea)]],_0x31b613=[_0x509b9a[_0x2b5083(0x27b)]['secondary_code']],_0x2b3e5f=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x2f5)]],_0x933299=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x24f)]],_0x4bbbda=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x2b6)]],_0x2da211=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x243)]],_0x35bb65=[_0x509b9a['body'][_0x2b5083(0x214)]],_0x4dcff8=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x279)]],_0x5be595=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x265)]],_0x2c2492=[_0x509b9a['body'][_0x2b5083(0x25f)]],_0x500ab5=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x26d)]],_0x3eb989=[_0x509b9a['body']['delivery_date']],_0x5f41b0=[_0x509b9a[_0x2b5083(0x27b)]['delivery_code']],_0x48542b=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x233)]],_0x5bc0e2=[_0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x294)]],_0x477cd7=[_0x509b9a[_0x2b5083(0x27b)]['RoomAssigned']];else var _0x60846c=[..._0x509b9a['body']['product_name']],_0x4251c3=[..._0x509b9a[_0x2b5083(0x27b)]['stock']],_0x985a5f=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x2b9)]],_0x3864cc=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x1ea)]],_0x31b613=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x26c)]],_0x2b3e5f=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x2f5)]],_0x933299=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x24f)]],_0x4bbbda=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x2b6)]],_0x2da211=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x243)]],_0x35bb65=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x214)]],_0x4dcff8=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x279)]],_0x5be595=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x265)]],_0x2c2492=[..._0x509b9a['body'][_0x2b5083(0x25f)]],_0x500ab5=[..._0x509b9a['body']['requested_qty']],_0x3eb989=[..._0x509b9a[_0x2b5083(0x27b)]['delivery_date']],_0x5f41b0=[..._0x509b9a[_0x2b5083(0x27b)][_0x2b5083(0x1f0)]],_0x48542b=[..._0x509b9a['body'][_0x2b5083(0x233)]],_0x5bc0e2=[..._0x509b9a[_0x2b5083(0x27b)]['quantity']],_0x477cd7=[..._0x509b9a['body'][_0x2b5083(0x2c2)]];const _0x59b279=_0x60846c[_0x2b5083(0x2bf)](_0x122ce6=>{return _0x122ce6={'product_name':_0x122ce6};});_0x4251c3['forEach']((_0x555960,_0x5e1fac)=>{var _0x283117=_0x2b5083;_0x59b279[_0x5e1fac]['stock']=Math[_0x283117(0x1fb)](_0x555960);}),_0x985a5f[_0x2b5083(0x2d4)]((_0xb321d8,_0x57ee11)=>{var _0x3622b3=_0x2b5083;_0x59b279[_0x57ee11][_0x3622b3(0x294)]=_0xb321d8;}),_0x3864cc['forEach']((_0x2723d0,_0x2e7b95)=>{var _0x2f73f9=_0x2b5083;_0x59b279[_0x2e7b95][_0x2f73f9(0x1ea)]=_0x2723d0;}),_0x31b613[_0x2b5083(0x2d4)]((_0x1afb1e,_0x48f843)=>{var _0x1cab1c=_0x2b5083;_0x59b279[_0x48f843][_0x1cab1c(0x26c)]=_0x1afb1e;}),_0x2b3e5f[_0x2b5083(0x2d4)]((_0x29e4a2,_0x97ab9)=>{var _0x2bccec=_0x2b5083;_0x59b279[_0x97ab9][_0x2bccec(0x23f)]=_0x29e4a2;}),_0x933299[_0x2b5083(0x2d4)]((_0x37ea93,_0x509aac)=>{_0x477cd7['forEach']((_0x418d76,_0x1fc047)=>{var _0x57f39e=a0_0x2525;if(_0x418d76=='Receiving\x20Area'&&_0x509aac==_0x1fc047){var _0x5a5e88=_0x37ea93[_0x57f39e(0x2e0)](0x3);_0x59b279[_0x509aac][_0x57f39e(0x2f2)]=_0x37ea93[0x0],_0x59b279[_0x509aac][_0x57f39e(0x210)]=_0x37ea93[0x1],_0x59b279[_0x509aac][_0x57f39e(0x1fd)]=0x0,_0x59b279[_0x509aac][_0x57f39e(0x2e4)]=0x0,_0x59b279[_0x509aac]['type']='Floor',_0x59b279[_0x509aac][_0x57f39e(0x239)]=_0x5a5e88;}else{if(_0x418d76==_0x57f39e(0x2ae)&&_0x509aac==_0x1fc047){var _0x5a5e88=_0x37ea93[_0x57f39e(0x2e0)](0x3);_0x59b279[_0x509aac][_0x57f39e(0x2f2)]=_0x37ea93[0x0],_0x59b279[_0x509aac]['rack']=_0x37ea93[0x1],_0x59b279[_0x509aac][_0x57f39e(0x1fd)]=0x0,_0x59b279[_0x509aac][_0x57f39e(0x2e4)]=0x0,_0x59b279[_0x509aac][_0x57f39e(0x232)]=_0x57f39e(0x21a),_0x59b279[_0x509aac][_0x57f39e(0x239)]=_0x37ea93[0x5];}else{if(_0x509aac==_0x1fc047){var _0x261637;if(_0x37ea93[0x4]=='L')_0x261637='Level';else _0x37ea93[0x4]=='F'&&(_0x261637=_0x57f39e(0x21a));_0x59b279[_0x509aac]['storage']=_0x37ea93[0x0],_0x59b279[_0x509aac][_0x57f39e(0x210)]=_0x37ea93[0x1],_0x59b279[_0x509aac][_0x57f39e(0x1fd)]=_0x37ea93[0x2],_0x59b279[_0x509aac][_0x57f39e(0x2e4)]=_0x37ea93[0x3],_0x59b279[_0x509aac]['type']=_0x261637,_0x59b279[_0x509aac][_0x57f39e(0x239)]=_0x37ea93[0x5];}}}});}),_0x4bbbda[_0x2b5083(0x2d4)]((_0x156c9f,_0x642d8c)=>{_0x59b279[_0x642d8c]['unit']=_0x156c9f;}),_0x2da211['forEach']((_0x95257c,_0x1dff88)=>{var _0x324947=_0x2b5083;_0x59b279[_0x1dff88][_0x324947(0x243)]=_0x95257c;}),_0x35bb65[_0x2b5083(0x2d4)]((_0x1b5573,_0x559a88)=>{var _0x5c4e18=_0x2b5083;_0x59b279[_0x559a88][_0x5c4e18(0x214)]=_0x1b5573;}),_0x4dcff8[_0x2b5083(0x2d4)]((_0x2f0376,_0x8e223c)=>{_0x59b279[_0x8e223c]['expiry_date']=_0x2f0376;}),_0x5be595['forEach']((_0x4f2af1,_0x24ddda)=>{var _0x1f3a5b=_0x2b5083;_0x59b279[_0x24ddda][_0x1f3a5b(0x250)]=_0x4f2af1;}),_0x2c2492[_0x2b5083(0x2d4)]((_0x39d3d4,_0x21dd39)=>{_0x59b279[_0x21dd39]['production_date']=_0x39d3d4;}),_0x500ab5[_0x2b5083(0x2d4)]((_0x41ec19,_0x4535c7)=>{var _0x13cd77=_0x2b5083;_0x59b279[_0x4535c7][_0x13cd77(0x26d)]=Math['abs'](_0x41ec19);}),_0x3eb989['forEach']((_0x27ccfb,_0x430571)=>{_0x59b279[_0x430571]['delivery_date']=_0x27ccfb;}),_0x5f41b0[_0x2b5083(0x2d4)]((_0x1c754d,_0x38408d)=>{var _0x37367b=_0x2b5083;_0x59b279[_0x38408d][_0x37367b(0x1f0)]=_0x1c754d;}),_0x48542b[_0x2b5083(0x2d4)]((_0x45ed74,_0x175c8f)=>{var _0x1f5eac=_0x2b5083;_0x59b279[_0x175c8f][_0x1f5eac(0x233)]=_0x45ed74;}),_0x5bc0e2['forEach']((_0x3a4e44,_0x472063)=>{var _0x555a9d=_0x2b5083;_0x59b279[_0x472063][_0x555a9d(0x2e6)]=_0x3a4e44;}),_0x477cd7[_0x2b5083(0x2d4)]((_0x379517,_0x594d3a)=>{var _0x185190=_0x2b5083;_0x59b279[_0x594d3a][_0x185190(0x2f4)]=_0x379517;});var _0x593715=0x0;_0x59b279[_0x2b5083(0x2d4)](_0x1fc78b=>{var _0x28e128=_0x2b5083;console[_0x28e128(0x2ef)](_0x28e128(0x206),_0x1fc78b),(parseInt(_0x1fc78b[_0x28e128(0x2ee)])<parseInt(_0x1fc78b[_0x28e128(0x294)])||parseInt(_0x1fc78b[_0x28e128(0x294)])==0x0)&&_0x593715++;});if(_0x593715!=0x0)return _0x509b9a['flash']('errors',_0x2b5083(0x1f7)),_0x3984fd[_0x2b5083(0x1fe)](_0x2b5083(0x23e));const _0x30ae08=_0x59b279[_0x2b5083(0x26a)](_0x1f4312=>_0x1f4312[_0x2b5083(0x294)]!=='0'&&_0x1f4312[_0x2b5083(0x294)]!=='');_0x11946e[_0x2b5083(0x200)]=_0x3c724d,_0x11946e['customer']=_0x557839,_0x11946e[_0x2b5083(0x2b4)]=_0x32dcff,_0x11946e[_0x2b5083(0x297)]=_0x3fe6d7,_0x11946e[_0x2b5083(0x20a)]=_0x30ae08,_0x11946e[_0x2b5083(0x271)]=_0x2d8909,_0x11946e['SCRN']=_0xdbcd24,_0x11946e[_0x2b5083(0x224)]='False',_0x11946e[_0x2b5083(0x2a2)]=_0x2b5083(0x2e1);const _0xcaca4=await _0x11946e[_0x2b5083(0x2bb)]();_0x509b9a[_0x2b5083(0x2d1)](_0x2b5083(0x20d),'Sales\x20Update\x20successfully'),_0x3984fd[_0x2b5083(0x1fe)](_0x2b5083(0x251));}catch(_0x25b8d7){console[_0x2b5083(0x2ef)](_0x25b8d7);}}),router[a0_0xafeddc(0x29a)](a0_0xafeddc(0x2b2),auth,async(_0x3419b1,_0x20571a)=>{var _0x118e08=a0_0xafeddc;try{const _0xe46ad6=_0x3419b1[_0x118e08(0x2b1)]['id'],{invoice:_0x4bc558,customer:_0x5ed2d7,receivable_amount:_0x171031,received_amount:_0x1f8de6}=_0x3419b1[_0x118e08(0x27b)],_0x17c9ca=await sales[_0x118e08(0x21c)](_0xe46ad6);console[_0x118e08(0x2ef)](_0x17c9ca);var _0x2e6c8f=_0x171031-_0x1f8de6;console['log'](_0x1f8de6),_0x17c9ca[_0x118e08(0x225)]=parseFloat(_0x1f8de6)+parseFloat(_0x17c9ca[_0x118e08(0x225)]),_0x17c9ca[_0x118e08(0x1ed)]=_0x2e6c8f,console[_0x118e08(0x2ef)](_0x17c9ca);const _0x471109=await _0x17c9ca['save'](),_0x409221=await c_payment_data['findOne']({'invoice':_0x4bc558});_0x409221['amount']=_0x2e6c8f,await _0x409221[_0x118e08(0x2bb)]();let _0x1ba6e0=new Date(),_0x57f383=('0'+_0x1ba6e0['getDate']())[_0x118e08(0x2e0)](-0x2),_0x95c7f5=('0'+(_0x1ba6e0[_0x118e08(0x217)]()+0x1))[_0x118e08(0x2e0)](-0x2),_0x465f27=_0x1ba6e0[_0x118e08(0x28f)](),_0x607a91=_0x465f27+'-'+_0x95c7f5+'-'+_0x57f383;const _0x1763f0=new customer_payment({'invoice':_0x4bc558,'date':_0x465f27+'-'+_0x95c7f5+'-'+_0x57f383,'customer':_0x5ed2d7,'reason':_0x118e08(0x29d),'amount':_0x1f8de6}),_0x5871b1=await _0x1763f0['save']();_0x3419b1[_0x118e08(0x2d1)](_0x118e08(0x20d),'payment\x20successfull'),_0x20571a[_0x118e08(0x1fe)](_0x118e08(0x251));}catch(_0x5474dc){console[_0x118e08(0x2ef)](_0x5474dc);}}),router[a0_0xafeddc(0x266)](a0_0xafeddc(0x2e9),auth,async(_0x35bfa9,_0x124ddf)=>{var _0x3e9f13=a0_0xafeddc;try{const {username:_0x2eb4ef,email:_0x3323ef,role:_0x2ddc73}=_0x35bfa9['user'],_0x2f6a52=_0x35bfa9[_0x3e9f13(0x2af)],_0x28d520=await profile[_0x3e9f13(0x24c)]({'email':_0x2f6a52[_0x3e9f13(0x20e)]}),_0x246a78=await master_shop[_0x3e9f13(0x2ce)]();console['log']('master',_0x246a78);const _0x181295=_0x35bfa9['params']['id'],_0x342d90=await sales[_0x3e9f13(0x21c)](_0x181295);console[_0x3e9f13(0x2ef)](_0x342d90);const _0x5d6a15=await customer[_0x3e9f13(0x24c)]({'name':_0x342d90[_0x3e9f13(0x291)]});console[_0x3e9f13(0x2ef)](_0x5d6a15);if(_0x246a78[0x0][_0x3e9f13(0x1fa)]==_0x3e9f13(0x25b)){var _0x4e4cc2=users['English'];console[_0x3e9f13(0x2ef)](_0x4e4cc2);}else{if(_0x246a78[0x0][_0x3e9f13(0x1fa)]==_0x3e9f13(0x20b))var _0x4e4cc2=users[_0x3e9f13(0x20b)];else{if(_0x246a78[0x0][_0x3e9f13(0x1fa)]==_0x3e9f13(0x272))var _0x4e4cc2=users[_0x3e9f13(0x272)];else{if(_0x246a78[0x0][_0x3e9f13(0x1fa)]==_0x3e9f13(0x2d2))var _0x4e4cc2=users[_0x3e9f13(0x2d2)];else{if(_0x246a78[0x0][_0x3e9f13(0x1fa)]=='French')var _0x4e4cc2=users['French'];else{if(_0x246a78[0x0][_0x3e9f13(0x1fa)]==_0x3e9f13(0x218))var _0x4e4cc2=users['Portuguese'];else{if(_0x246a78[0x0][_0x3e9f13(0x1fa)]==_0x3e9f13(0x260))var _0x4e4cc2=users['Chinese'];else{if(_0x246a78[0x0]['language']==_0x3e9f13(0x293))var _0x4e4cc2=users[_0x3e9f13(0x280)];}}}}}}}_0x124ddf['render']('sales_invoice',{'success':_0x35bfa9[_0x3e9f13(0x2d1)](_0x3e9f13(0x20d)),'errors':_0x35bfa9[_0x3e9f13(0x2d1)](_0x3e9f13(0x267)),'role':_0x2f6a52,'profile':_0x28d520,'master_shop':_0x246a78,'customers':_0x5d6a15,'sales':_0x342d90,'language':_0x4e4cc2});}catch(_0x27c768){console['log'](_0x27c768);}}),router['get'](a0_0xafeddc(0x245),auth,async(_0x220563,_0x1563ea)=>{var _0xaf108a=a0_0xafeddc;try{const {username:_0x42d9cd,email:_0x3780be,role:_0x1d3dec}=_0x220563['user'],_0x206909=_0x220563[_0xaf108a(0x2af)],_0x4df68b=await profile[_0xaf108a(0x24c)]({'email':_0x206909[_0xaf108a(0x20e)]}),_0x52391d=await master_shop[_0xaf108a(0x2ce)]();console['log'](_0xaf108a(0x21f),_0x52391d);const _0x238865=_0x220563[_0xaf108a(0x2b1)]['id'];console[_0xaf108a(0x2ef)](_0x238865);const _0x552fcc=await sales[_0xaf108a(0x21c)](_0x238865);console['log'](_0xaf108a(0x2c6),_0x552fcc);const _0x3fdff8=await warehouse[_0xaf108a(0x226)]([{'$match':{'name':_0xaf108a(0x2b3),'room':_0xaf108a(0x277)}},{'$unwind':_0xaf108a(0x2a6)},{'$group':{'_id':_0xaf108a(0x1f1),'name':{'$first':_0xaf108a(0x1e4)},'product_stock':{'$first':_0xaf108a(0x1ec)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0xaf108a(0x223)},'pallet':{'$first':_0xaf108a(0x2a4)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0xaf108a(0x2ef)](_0xaf108a(0x257),_0x3fdff8);const _0x35f4c7=await product[_0xaf108a(0x2ce)]({});warehouse_data=await warehouse[_0xaf108a(0x226)]([{'$match':{'status':_0xaf108a(0x2db),'name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0xaf108a(0x21e),'name':{'$first':_0xaf108a(0x21e)}}},{'$sort':{'name':0x1}}]);var _0x422d49=[_0xaf108a(0x277)];if(_0x52391d[0x0][_0xaf108a(0x1fa)]==_0xaf108a(0x25b)){var _0x4d15d3=users['English'];console['log'](_0x4d15d3);}else{if(_0x52391d[0x0][_0xaf108a(0x1fa)]==_0xaf108a(0x20b))var _0x4d15d3=users[_0xaf108a(0x20b)];else{if(_0x52391d[0x0]['language']=='German')var _0x4d15d3=users[_0xaf108a(0x272)];else{if(_0x52391d[0x0]['language']=='Spanish')var _0x4d15d3=users[_0xaf108a(0x2d2)];else{if(_0x52391d[0x0][_0xaf108a(0x1fa)]==_0xaf108a(0x1ff))var _0x4d15d3=users[_0xaf108a(0x1ff)];else{if(_0x52391d[0x0]['language']==_0xaf108a(0x218))var _0x4d15d3=users[_0xaf108a(0x2a9)];else{if(_0x52391d[0x0]['language']==_0xaf108a(0x260))var _0x4d15d3=users['Chinese'];else{if(_0x52391d[0x0][_0xaf108a(0x1fa)]=='Arabic\x20(ae)')var _0x4d15d3=users[_0xaf108a(0x280)];}}}}}}}_0x1563ea['render']('return_sale',{'success':_0x220563[_0xaf108a(0x2d1)](_0xaf108a(0x20d)),'errors':_0x220563['flash']('errors'),'role':_0x206909,'profile':_0x4df68b,'user':_0x552fcc,'stock':_0x3fdff8,'master_shop':_0x52391d,'unit':_0x35f4c7,'language':_0x4d15d3,'warehouses':warehouse_data,'rooms':_0x422d49});}catch(_0x21601c){console[_0xaf108a(0x2ef)](_0x21601c),_0x1563ea[_0xaf108a(0x263)](0xc8)[_0xaf108a(0x278)]({'message':_0x21601c['message']});}}),router[a0_0xafeddc(0x29a)](a0_0xafeddc(0x245),auth,async(_0x383d7d,_0x37f764)=>{var _0x233c28=a0_0xafeddc;try{const {invoice:_0x27577b,date:_0x5d0df9,warehouse_name:_0x4674c2,product_name:_0x3f7922,primary_code:_0x1c1467,secondary_code:_0x13d8e6,product_code:_0x138d76,sales_quantity:_0x481782,stocks:_0x5f0a4a,return_qty:_0x368266,Room_name:_0x2183c9,to_warehouse_name:_0x2b6512,to_Roomname:_0x547034,to_Room_name:_0x17b3af,note:_0x4225d1,level:_0x4dfe17,isle:_0x4f57d3,pallet:_0x1043ee}=_0x383d7d['body'];if(typeof _0x3f7922=='string')var _0x4f41c0=[_0x383d7d['body'][_0x233c28(0x201)]],_0x35ce4a=[_0x383d7d[_0x233c28(0x27b)]['primary_code']],_0x504ff6=[_0x383d7d['body'][_0x233c28(0x26c)]],_0x46db4e=[_0x383d7d['body']['product_code']],_0x488ef5=[_0x383d7d[_0x233c28(0x27b)][_0x233c28(0x246)]],_0x17dba9=[_0x383d7d['body'][_0x233c28(0x281)]],_0x43a6ea=[_0x383d7d[_0x233c28(0x27b)][_0x233c28(0x2d6)]],_0x365988=[_0x383d7d[_0x233c28(0x27b)][_0x233c28(0x1fd)]],_0x5b310a=[_0x383d7d[_0x233c28(0x27b)][_0x233c28(0x2e4)]],_0x5bc9d6=[_0x383d7d[_0x233c28(0x27b)][_0x233c28(0x29c)]],_0x3ab256=[_0x383d7d[_0x233c28(0x27b)][_0x233c28(0x239)]];else var _0x4f41c0=[..._0x383d7d[_0x233c28(0x27b)][_0x233c28(0x201)]],_0x35ce4a=[..._0x383d7d['body'][_0x233c28(0x1ea)]],_0x504ff6=[..._0x383d7d[_0x233c28(0x27b)][_0x233c28(0x26c)]],_0x46db4e=[..._0x383d7d[_0x233c28(0x27b)][_0x233c28(0x23f)]],_0x488ef5=[..._0x383d7d[_0x233c28(0x27b)][_0x233c28(0x246)]],_0x17dba9=[..._0x383d7d[_0x233c28(0x27b)][_0x233c28(0x281)]],_0x43a6ea=[..._0x383d7d[_0x233c28(0x27b)][_0x233c28(0x2d6)]],_0x365988=[..._0x383d7d[_0x233c28(0x27b)][_0x233c28(0x1fd)]],_0x5b310a=[..._0x383d7d[_0x233c28(0x27b)][_0x233c28(0x2e4)]],_0x5bc9d6=[..._0x383d7d['body']['types']],_0x3ab256=[..._0x383d7d[_0x233c28(0x27b)][_0x233c28(0x239)]];const _0x235ca4=_0x4f41c0[_0x233c28(0x2bf)](_0x1f3000=>{return _0x1f3000={'product_name':_0x1f3000};});_0x35ce4a['forEach']((_0x12d7c6,_0x29399b)=>{var _0x47d0ca=_0x233c28;_0x235ca4[_0x29399b][_0x47d0ca(0x1ea)]=_0x12d7c6;}),_0x504ff6[_0x233c28(0x2d4)]((_0x250d1a,_0x13a4b5)=>{_0x235ca4[_0x13a4b5]['secondary_code']=_0x250d1a;}),_0x46db4e['forEach']((_0x1c8d82,_0x2ba542)=>{_0x235ca4[_0x2ba542]['product_code']=_0x1c8d82;}),_0x488ef5['forEach']((_0x58dd68,_0x221fd2)=>{var _0x2f6635=_0x233c28;_0x235ca4[_0x221fd2][_0x2f6635(0x22c)]=_0x58dd68;}),_0x17dba9[_0x233c28(0x2d4)]((_0x174a13,_0x1491e4)=>{var _0xba4680=_0x233c28;_0x235ca4[_0x1491e4][_0xba4680(0x2ee)]=_0x174a13;}),_0x43a6ea['forEach']((_0x13c284,_0xee329)=>{var _0x39ab62=_0x233c28;_0x235ca4[_0xee329][_0x39ab62(0x2d6)]=_0x13c284;}),_0x365988[_0x233c28(0x2d4)]((_0x3ce5e2,_0xac314d)=>{var _0xe3f05b=_0x233c28;_0x235ca4[_0xac314d][_0xe3f05b(0x1fd)]=_0x3ce5e2;}),_0x5b310a[_0x233c28(0x2d4)]((_0x4e1f76,_0x1d80e0)=>{var _0x173110=_0x233c28;_0x235ca4[_0x1d80e0][_0x173110(0x2e4)]=_0x4e1f76;}),_0x5bc9d6['forEach']((_0x1ec364,_0x2a7d8f)=>{var _0x170817=_0x233c28;_0x235ca4[_0x2a7d8f][_0x170817(0x232)]=_0x1ec364;}),_0x3ab256['forEach']((_0x52640c,_0x134508)=>{var _0x1c42e2=_0x233c28;_0x235ca4[_0x134508][_0x1c42e2(0x239)]=_0x52640c;});var _0x83a6b1=0x0;_0x235ca4[_0x233c28(0x2d4)](_0x10c358=>{var _0x100513=_0x233c28;console[_0x100513(0x2ef)](_0x100513(0x206),_0x10c358),(parseInt(_0x10c358['sale_qty'])<parseInt(_0x10c358[_0x100513(0x2d6)])||parseInt(_0x10c358['stock'])<parseInt(_0x10c358[_0x100513(0x2d6)])&&parseInt(_0x10c358[_0x100513(0x22c)])>parseInt(_0x10c358[_0x100513(0x2d6)])||parseInt(_0x10c358[_0x100513(0x2d6)])==0x0)&&_0x83a6b1++;});if(_0x83a6b1!=0x0)return _0x383d7d['flash']('errors',_0x233c28(0x2a8)),_0x37f764[_0x233c28(0x1fe)](_0x233c28(0x23e));const _0x23747d=await sales['findOne']({'invoice':_0x27577b});console[_0x233c28(0x2ef)](_0x23747d),_0x23747d[_0x233c28(0x2d8)]=_0x233c28(0x22f);const _0x22317d=await _0x23747d[_0x233c28(0x2bb)](),_0x5a326b=new sales_return({'invoice':_0x27577b,'customer':_0x383d7d[_0x233c28(0x27b)][_0x233c28(0x291)],'date':_0x5d0df9,'warehouse_name':_0x4674c2,'room':_0x2183c9,'ToWarehouse':_0x2b6512,'ToRoom':_0x17b3af,'return_sale':_0x235ca4,'note':_0x4225d1}),_0xb9d16c=await _0x5a326b[_0x233c28(0x2bb)]();console[_0x233c28(0x2ef)](_0x5a326b);const _0x193ce7=await sales_return['findOne']({'invoice':_0x27577b}),_0x344bd4=await warehouse[_0x233c28(0x24c)]({'name':_0x2b6512,'room':_0x17b3af});_0x193ce7[_0x233c28(0x283)][_0x233c28(0x2d4)](_0x41ea7f=>{var _0x217cac=_0x233c28,_0x1326ca=0x0;const _0x36f3f7=_0x344bd4[_0x217cac(0x23d)][_0x217cac(0x2bf)](_0x45afe1=>{var _0x1a8e28=_0x217cac;_0x45afe1[_0x1a8e28(0x201)]==_0x41ea7f[_0x1a8e28(0x201)]&&_0x45afe1[_0x1a8e28(0x239)]==_0x41ea7f['floorlevel']&&_0x45afe1[_0x1a8e28(0x232)]==_0x41ea7f['type']&&_0x45afe1[_0x1a8e28(0x2e4)]==_0x41ea7f['bin']&&_0x45afe1['bay']==_0x41ea7f[_0x1a8e28(0x1fd)]&&(_0x45afe1['product_stock']=parseInt(_0x45afe1[_0x1a8e28(0x258)])+parseInt(_0x41ea7f['return_qty']),_0x1326ca++);});_0x1326ca=='0'&&(_0x344bd4[_0x217cac(0x23d)]=_0x344bd4['product_details'][_0x217cac(0x25c)]({'product_name':_0x41ea7f[_0x217cac(0x201)],'product_stock':_0x41ea7f[_0x217cac(0x2d6)],'primary_code':_0x41ea7f[_0x217cac(0x1ea)],'secondary_code':_0x41ea7f[_0x217cac(0x26c)],'product_code':_0x41ea7f[_0x217cac(0x23f)],'bay':_0x41ea7f[_0x217cac(0x1fd)],'bin':_0x41ea7f[_0x217cac(0x2e4)],'type':_0x41ea7f[_0x217cac(0x232)],'floorlevel':_0x41ea7f[_0x217cac(0x239)]})),console['log'](_0x217cac(0x2ad),_0x344bd4);}),await _0x344bd4[_0x233c28(0x2bb)](),console['log'](_0x383d7d[_0x233c28(0x27b)]);const _0xd99701=new c_payment_data({'invoice':_0x27577b,'customer':_0x383d7d['body'][_0x233c28(0x291)],'reason':_0x233c28(0x23b)});await _0xd99701['save']();const _0x435865=await master_shop[_0x233c28(0x2ce)]();console['log'](_0x233c28(0x2e3),_0x435865[0x0][_0x233c28(0x288)]);const _0x430576=await email_settings[_0x233c28(0x24c)](),_0x5af24b=await customer[_0x233c28(0x24c)]({'name':_0x383d7d['body'][_0x233c28(0x291)]});console['log']('customer_data',_0x5af24b);_0x435865[0x0]['currency_placement']==0x1?(right_currency=_0x435865[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x435865[0x0][_0x233c28(0x2b7)]);var _0x267244=_0x4f41c0,_0x3f7fb0=_0x43a6ea,_0x202379='',_0x253ea7;for(_0x253ea7 in _0x267244){_0x202379+=_0x233c28(0x1ef)+_0x233c28(0x2c3)+_0x267244[_0x253ea7]+_0x233c28(0x268)+_0x233c28(0x2c3)+_0x3f7fb0[_0x253ea7]+_0x233c28(0x268)+'</tr>';}console[_0x233c28(0x2ef)](_0x233c28(0x286),_0x202379);let _0x4f685a=nodemailer[_0x233c28(0x248)]({'service':_0x233c28(0x235),'auth':{'user':_0x430576[_0x233c28(0x20e)],'pass':_0x430576[_0x233c28(0x23a)]}}),_0x35d720={'from':_0x430576[_0x233c28(0x20e)],'to':_0x5af24b[_0x233c28(0x20e)],'subject':_0x233c28(0x28e),'attachments':[{'filename':_0x233c28(0x2c5),'path':__dirname+_0x233c28(0x208)+_0x233c28(0x2d0)+_0x435865[0x0][_0x233c28(0x288)],'cid':_0x233c28(0x1eb)}],'html':_0x233c28(0x207)+_0x233c28(0x2a0)+_0x233c28(0x24e)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x233c28(0x2e2)+_0x233c28(0x2c0)+_0x435865[0x0]['site_title']+_0x233c28(0x252)+_0x233c28(0x242)+'</div>'+_0x233c28(0x2eb)+_0x233c28(0x2e2)+_0x233c28(0x292)+'\x20Order\x20Number\x20:\x20'+_0x27577b+'\x20'+_0x233c28(0x2a5)+_0x233c28(0x2e8)+_0x5d0df9+'\x20'+_0x233c28(0x289)+_0x233c28(0x2ea)+'</div>'+_0x233c28(0x2cc)+_0x233c28(0x25e)+_0x233c28(0x1ef)+_0x233c28(0x28b)+_0x233c28(0x2f1)+_0x233c28(0x27e)+_0x233c28(0x230)+'</tr>'+_0x233c28(0x2ac)+_0x233c28(0x1f5)+'\x20'+_0x202379+'\x20'+_0x233c28(0x22a)+_0x233c28(0x2aa)+_0x233c28(0x2e2)+_0x233c28(0x21d)+_0x233c28(0x21b)+_0x435865[0x0][_0x233c28(0x26b)]+'</h5>'+_0x233c28(0x242)+_0x233c28(0x242)+_0x233c28(0x1ee)};_0x4f685a['sendMail'](_0x35d720,function(_0x8f02b8,_0x441186){var _0x444c90=_0x233c28;_0x8f02b8?(console['log'](_0x8f02b8),console[_0x444c90(0x2ef)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0x383d7d['flash'](_0x233c28(0x20d),'sales\x20item\x20return\x20successfull'),_0x37f764[_0x233c28(0x1fe)]('/all_sales/view');}catch(_0x54fd34){console['log'](_0x54fd34),_0x37f764[_0x233c28(0x263)](0xc8)[_0x233c28(0x278)]({'message1':_0x54fd34[_0x233c28(0x205)]});}}),router[a0_0xafeddc(0x266)](a0_0xafeddc(0x1f8),auth,async(_0x2b4cc4,_0x25ce69)=>{var _0x5e15ec=a0_0xafeddc;try{const {username:_0x118ca0,email:_0x526b63,role:_0x5cc0f3}=_0x2b4cc4[_0x5e15ec(0x2af)],_0x5453f0=_0x2b4cc4[_0x5e15ec(0x2af)],_0x57e5c6=await profile[_0x5e15ec(0x24c)]({'email':_0x5453f0[_0x5e15ec(0x20e)]}),_0x5efe4a=await master_shop[_0x5e15ec(0x2ce)]();console['log'](_0x5e15ec(0x2e5),_0x5efe4a);const _0x1fd6da=_0x2b4cc4[_0x5e15ec(0x2b1)]['id'],_0x508864=await sales[_0x5e15ec(0x21c)](_0x1fd6da);console[_0x5e15ec(0x2ef)](_0x5e15ec(0x253),_0x508864);if(_0x5efe4a[0x0]['language']=='English\x20(US)')var _0x3e4f17=users[_0x5e15ec(0x285)];else{if(_0x5efe4a[0x0][_0x5e15ec(0x1fa)]==_0x5e15ec(0x20b))var _0x3e4f17=users[_0x5e15ec(0x20b)];else{if(_0x5efe4a[0x0][_0x5e15ec(0x1fa)]==_0x5e15ec(0x272))var _0x3e4f17=users[_0x5e15ec(0x272)];else{if(_0x5efe4a[0x0][_0x5e15ec(0x1fa)]==_0x5e15ec(0x2d2))var _0x3e4f17=users[_0x5e15ec(0x2d2)];else{if(_0x5efe4a[0x0]['language']==_0x5e15ec(0x1ff))var _0x3e4f17=users['French'];else{if(_0x5efe4a[0x0]['language']==_0x5e15ec(0x218))var _0x3e4f17=users[_0x5e15ec(0x2a9)];else{if(_0x5efe4a[0x0][_0x5e15ec(0x1fa)]==_0x5e15ec(0x260))var _0x3e4f17=users[_0x5e15ec(0x260)];else{if(_0x5efe4a[0x0]['language']==_0x5e15ec(0x293))var _0x3e4f17=users[_0x5e15ec(0x280)];}}}}}}}_0x25ce69[_0x5e15ec(0x22d)](_0x5e15ec(0x204),{'success':_0x2b4cc4[_0x5e15ec(0x2d1)](_0x5e15ec(0x20d)),'errors':_0x2b4cc4['flash'](_0x5e15ec(0x267)),'role':_0x5453f0,'profile':_0x57e5c6,'alldata':_0x508864,'master_shop':_0x5efe4a,'language':_0x3e4f17});}catch(_0x4d7e4a){console[_0x5e15ec(0x2ef)](_0x4d7e4a);}}),router['post']('/barcode_scanner',async(_0x36fffd,_0x5433ae)=>{var _0x5a9070=a0_0xafeddc;const {product_code:_0x16f4a5,warehouse_name:_0x5753e4,rooms_data:_0x24385e,Roomslist:_0x537435}=_0x36fffd[_0x5a9070(0x27b)],_0x1e1adb=_0x537435[_0x5a9070(0x220)](','),_0xe5c129=[];async function _0x5f1a00(_0x1a85ad){var _0x5b5113=_0x5a9070;const _0x4f109f=await warehouse[_0x5b5113(0x226)]([{'$match':{'name':_0x5753e4,'room':_0x1a85ad}},{'$unwind':_0x5b5113(0x2a6)},{'$match':{'product_details.primary_code':_0x16f4a5}},{'$group':{'_id':_0x5b5113(0x1f1),'name':{'$first':_0x5b5113(0x1e4)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x5b5113(0x2cb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5b5113(0x273)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x5b5113(0x229)},'type':{'$first':_0x5b5113(0x2c9)},'pallet':{'$first':_0x5b5113(0x2e7)},'unit':{'$first':_0x5b5113(0x2c1)},'secondary_unit':{'$first':_0x5b5113(0x222)},'storage':{'$first':_0x5b5113(0x240)},'rack':{'$first':_0x5b5113(0x1f2)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5b5113(0x2d9)},'maxPerUnit':{'$first':_0x5b5113(0x2cf)},'batch_code':{'$first':_0x5b5113(0x1e8)},'product_cat':{'$first':_0x5b5113(0x23c)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x5b5113(0x2b8)},'actual_qty':{'$first':_0x5b5113(0x298)},'actual_uom':{'$first':_0x5b5113(0x256)}}}]),_0x38170d=await warehouse[_0x5b5113(0x226)]([{'$match':{'name':_0x5753e4,'room':_0x1a85ad}},{'$unwind':_0x5b5113(0x2a6)},{'$match':{'product_details.secondary_code':_0x16f4a5}},{'$group':{'_id':_0x5b5113(0x1f1),'name':{'$first':_0x5b5113(0x1e4)},'product_stock':{'$first':_0x5b5113(0x1ec)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5b5113(0x24d)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x5b5113(0x28c)},'isle':{'$first':_0x5b5113(0x229)},'type':{'$first':_0x5b5113(0x2c9)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x5b5113(0x2c1)},'secondary_unit':{'$first':_0x5b5113(0x222)},'storage':{'$first':_0x5b5113(0x240)},'rack':{'$first':_0x5b5113(0x1f2)},'expiry_date':{'$first':_0x5b5113(0x2ec)},'production_date':{'$first':_0x5b5113(0x2d9)},'maxPerUnit':{'$first':_0x5b5113(0x2cf)},'batch_code':{'$first':_0x5b5113(0x1e8)},'product_cat':{'$first':_0x5b5113(0x23c)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x5b5113(0x219)},'invoice':{'$first':_0x5b5113(0x2b8)}}}]);if(_0x4f109f[_0x5b5113(0x2b0)]>0x0)_0xe5c129[_0x5b5113(0x231)](_0x4f109f);else _0x38170d[_0x5b5113(0x2b0)]>0x0&&_0xe5c129[_0x5b5113(0x231)](_0x38170d);}const _0x515e73=_0x1e1adb[_0x5a9070(0x2bf)](_0x5c9e50=>_0x5f1a00(_0x5c9e50));await Promise['all'](_0x515e73),_0x5433ae[_0x5a9070(0x278)](_0xe5c129);}),module[a0_0xafeddc(0x1f6)]=router;function a0_0x42ed(){var _0xb12e4f=['id_transact','return_sale','error','English','product_list','$warehouse_name','image','</span>','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.bay','57897WFtTLc','Sale\x20Return\x20Mail','getFullYear','staff','customer','<h5\x20style=\x22text-align:\x20left;\x22>','Arabic\x20(ae)','quantity','Raw\x20Materials','Sales\x20Add\x20successfully','warehouse_name','$product_details.actual_qty','Email\x20sent\x20successfully','post','Sales\x20Update\x20successfully','types','Received\x20Payment\x20For\x20Sale','customers_docs','actual_uom','<html><head><title></title>','max','isAllowEdit','/all_sales/preview/','$product_details.pallet','<span\x20style=\x22float:\x20right;\x22>','$product_details','random','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Portuguese','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</thead>','final','Shelves','user','length','params','/give_payment/:id','Return\x20Goods','date','sendMail','primary_unit','currency','$product_details.invoice','carton','actual_qty','save','/view/:id','$invoice','string','map','<h2>\x20','$product_details.unit','RoomAssigned','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$date','Logo.png','user_id','all_sales','toString','$product_details.type','RMSEmail','$product_details.primary_code','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Ambient','find','$product_details.maxPerUnit','/upload/','flash','Spanish','$return_data','forEach','OUT-','return_qty','purchases_data','return_data','$product_details.production_date','name','Enabled','$isAllowEdit','$product.product_name','warehouse','$product','slice','False','<div>','add\x20post','bin','barcode\x20Product\x20master','quantity_notConverted','$product_details.floorlevel','\x20Order\x20Date\x20:\x20','/invoice/:id','</h5>','<hr\x20class=\x22my-3\x22>','$product_details.expiry_date','99jgonKf','stock','log','/view/add_sale/product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','storage','/view/add_sales/:id','room_name','prod_code','$product_details.product_name','room','2299968gsDvrA','catch','$product_details.batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','primary_code','logo','$product_details.product_stock','due_amount','</body></html>','<tr>','delivery_code','$product_details._id','$product_details.rack','padStart','1112469VPQTvK','<tbody\x20style=\x22text-align:\x20center;\x22>','exports','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','/barcode/:id','2308054WOAtkd','language','abs','6FYGzsp','bay','redirect','French','invoice','product_name','floor','Error\x20Occurs','all_sales_barcode','message','foreach\x20newproduct','<!DOCTYPE\x20html>','/../public','$finalize','sale_product','Hindi','$_id','success','email','Enclosed','rack','id_transaction_from','prod_invoice','delivery_date','batch_code','/preview/:id','nodemailer','getMonth','Portuguese\x20(BR)','$room','Floor','<h5>','findById','<strong>\x20Regards\x20</strong>','$name','master','split','$sale_product.quantity','$product_details.secondary_unit','$product_details.isle','finalize','received_amount','aggregate','product','then','$product_details.bin','</tbody>','780HeyCtH','sale_qty','render','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','push','type','prod_cat','An\x20error\x20occurred\x20while\x20saving\x20data.','gmail','587904bbRaOm','5330fkWOni','</tr>','floorlevel','password','Sale\x20Return','$product_details.product_cat','product_details','back','product_code','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</div>','secondary_unit','$customer','/view/return_sales/:id','sales_quantity','role','createTransport','unit','2193005FPCCTf','An\x20error\x20occurred.','findOne','$product_details.secondary_code','</head><body>','level','maxperunit','/all_sales/view','\x20</h2>','barcode\x20user_id','16nrFiqy','all','$product_details.actual_uom','stock_data','product_stock','express','$sale_product.bin','English\x20(US)','concat','customers','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','production_date','Chinese','/view/add_sales','$sale_product.floorlevel','status','$note','max_per_unit','get','errors','</td>','159yDHqNX','filter','site_title','secondary_code','requested_qty','$sale_product.type','edit_sales','$customers_docs','note','German','$product_details.product_code','\x20Order\x20Number\x20:\x20','$sale_product','/view','Return\x20Rooms','json','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','host','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Arabic','stocks'];a0_0x42ed=function(){return _0xb12e4f;};return a0_0x42ed();}