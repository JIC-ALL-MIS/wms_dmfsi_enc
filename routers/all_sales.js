var a0_0x13ef01=a0_0x35c6;function a0_0x35c6(_0x18a9fe,_0x2391b6){var _0x4a6bc5=a0_0x4a6b();return a0_0x35c6=function(_0x35c6c8,_0x3af4d4){_0x35c6c8=_0x35c6c8-0x1f3;var _0x200ab4=_0x4a6bc5[_0x35c6c8];return _0x200ab4;},a0_0x35c6(_0x18a9fe,_0x2391b6);}function a0_0x4a6b(){var _0x4774e9=['</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','concat','English','max','$_id','<html><head><title></title>','Arabic','/barcode_scanner','2197162QlAiYH','sales_quantity','An\x20error\x20occurred\x20while\x20saving\x20data.','push','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$note','5181234LaMOpp','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','4766930fuyHTX','gmail','Sales\x20Mail','Logo.png','Floor','$product_details._id','stock_data','finalize','../models/all_models','all_sales_barcode','body','/view/add_sales','length','forEach','$sale_product','user','Spanish','unit','Chinese','$sale_product.floorlevel','/barcode/:id','$sale_product.bay','getDate','$product_details.storage','$sale_product.type','_id','bay','add\x20post','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','payment\x20successfull','all_sales','$product_details.invoice','foreach\x20newproduct','Hindi','2835992WbeXuJ','Portuguese','getMonth','$product_details.secondary_code','</span>','<div>','received_amount','Error\x20Occurs','Level','$customers_docs','aggregate','return_qty','$product_details.rack','secondary_code','edit_sales_view','</head><body>','customers','1323096JwNzSG','/preview/:id','$product_details.actual_qty','warehouse','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','add_sales','email','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/view/return_sales/:id','$product_details.product_cat','requested_qty','<h2>\x20','/invoice/:id','save','image','Return\x20Rooms','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Sale\x20Return\x20Mail','maxperunit','name','prod_cat','$product_details.level','RMSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','message','$product_details.production_date','product_stock','$product_details.primary_code','</div>','id_transact','</tbody>','currency','/upload/','\x20Order\x20Number\x20:\x20','expiry_date','<!DOCTYPE\x20html>','$name','1039764ZeZWhk','role','OUT-','toString','</td>','$finalize','<strong>\x20Regards\x20</strong>','site_title','$product_details.batch_code','Arabic\x20(ae)','/give_payment/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','type','user_id','../middleware/auth','findById','secondary_unit','rack','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/../public','host','catch','Enabled','amount','batch_code','$isAllowEdit','then','room_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','sale_product','<hr\x20class=\x22my-3\x22>','back','floor','$product_details.secondary_unit','$product_details.pallet','An\x20error\x20occurred.','\x20Order\x20Date\x20:\x20','stock','German','$product_details.product_stock','stocks','padStart','params','flash','carton','5sqXQas','production_date','167679iBjHNa','string','$product_details.expiry_date','log','Enclosed','sales_invoice','$product_details.maxPerUnit','</thead>','product_data','$product_details.isle','$return_data','$product_details.type','id_transaction_from','$product_details.actual_uom','language','date','/view/add_sale/product','delivery_code','<h5\x20style=\x22text-align:\x20left;\x22>','product_details','</table>','quantity','return_data','master','French','password','Email\x20sent\x20successfully','level','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.bin','True','storage','RoomAssigned','invoice','<tr>','English\x20(US)','Portuguese\x20(BR)','all','<tbody\x20style=\x22text-align:\x20center;\x22>','floorlevel','actual_uom','</tr>','$room','warehouse_name','$product_details','Sales\x20Add\x20successfully','customers_docs','return_sale','/view','post','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','json','\x20</h2>','errors','split','filter','/all_sales/view','Ambient','$date','Router','map','staff','render','isAllowEdit','findOne','$customer','abs','$sale_product.bin','$product.product_name','../public/language/languages.json','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$invoice','<span\x20style=\x22float:\x20right;\x22>','slice','max_per_unit','Shelves','prod_invoice','success','sale_qty','quantity_notConverted','delivery_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.bay','Raw\x20Materials','get','room','$product_details.floorlevel','$product_details.product_code','product_name','<h5>','customer','$sale_product.quantity','product','$product_details.product_name','bin','types','redirect','sales\x20item\x20return\x20successfull','Sales\x20Update\x20successfully','product_code','primary_unit','primary_code','actual_qty','express','Receiving\x20Area','False','port'];a0_0x4a6b=function(){return _0x4774e9;};return a0_0x4a6b();}(function(_0x50f4a2,_0x231dd9){var _0x23cf4d=a0_0x35c6,_0x140f87=_0x50f4a2();while(!![]){try{var _0x1ab08d=-parseInt(_0x23cf4d(0x2f5))/0x1+parseInt(_0x23cf4d(0x291))/0x2+parseInt(_0x23cf4d(0x21d))/0x3+parseInt(_0x23cf4d(0x2ce))/0x4+parseInt(_0x23cf4d(0x21b))/0x5*(-parseInt(_0x23cf4d(0x298))/0x6)+parseInt(_0x23cf4d(0x29a))/0x7+parseInt(_0x23cf4d(0x2bd))/0x8;if(_0x1ab08d===_0x231dd9)break;else _0x140f87['push'](_0x140f87['shift']());}catch(_0x435a70){_0x140f87['push'](_0x140f87['shift']());}}}(a0_0x4a6b,0x96bda));const express=require(a0_0x13ef01(0x284)),app=express(),router=express[a0_0x13ef01(0x258)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x13ef01(0x2a2)),auth=require(a0_0x13ef01(0x1fb)),nodemailer=require(a0_0x13ef01(0x2b6)),users=require(a0_0x13ef01(0x262));router[a0_0x13ef01(0x271)](a0_0x13ef01(0x24d),auth,async(_0x42cf91,_0x1b5a4f)=>{var _0x237690=a0_0x13ef01;try{const {username:_0x2a89a4,email:_0xde154f,role:_0x1412d0}=_0x42cf91[_0x237690(0x2a9)],_0x5e76a3=_0x42cf91[_0x237690(0x2a9)],_0x32a735=await profile[_0x237690(0x25d)]({'email':_0x5e76a3[_0x237690(0x2d5)]}),_0x1827ea=await master_shop['find']();let _0x559229;if(_0x5e76a3[_0x237690(0x2f6)]==_0x237690(0x25a)){const _0xa93542=await staff[_0x237690(0x25d)]({'email':_0x5e76a3['email']});_0x559229=await sales[_0x237690(0x2c7)]([{'$lookup':{'from':_0x237690(0x2cd),'localField':_0x237690(0x277),'foreignField':_0x237690(0x2e3),'as':_0x237690(0x24b)}},{'$unwind':_0x237690(0x2c6)},{'$unwind':_0x237690(0x2a8)},{'$group':{'_id':_0x237690(0x28d),'invoice':{'$first':_0x237690(0x264)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x237690(0x2a8)},'note':{'$first':'$note'},'return_data':{'$first':_0x237690(0x227)},'customers_docs':{'$first':_0x237690(0x2c6)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x237690(0x260)},'type':{'$addToSet':_0x237690(0x2b2)},'pallet':{'$addToSet':_0x237690(0x2ad)},'finalize':{'$first':_0x237690(0x2fa)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x559229=await sales[_0x237690(0x2c7)]([{'$lookup':{'from':_0x237690(0x2cd),'localField':'customer','foreignField':_0x237690(0x2e3),'as':'customers_docs'}},{'$unwind':_0x237690(0x2c6)},{'$unwind':_0x237690(0x2a8)},{'$group':{'_id':_0x237690(0x28d),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x237690(0x25e)},'date':{'$first':_0x237690(0x257)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x237690(0x2a8)},'note':{'$first':_0x237690(0x297)},'return_data':{'$first':_0x237690(0x227)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x237690(0x278)},'level':{'$addToSet':_0x237690(0x2af)},'isle':{'$addToSet':_0x237690(0x260)},'type':{'$addToSet':_0x237690(0x2b2)},'pallet':{'$addToSet':_0x237690(0x2ad)},'finalize':{'$first':_0x237690(0x2fa)},'isAllowEdit':{'$first':_0x237690(0x206)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x237690(0x220)]('sales\x20all_data',_0x559229);if(_0x1827ea[0x0][_0x237690(0x22b)]==_0x237690(0x240)){var _0x23fb08=users[_0x237690(0x28b)];console[_0x237690(0x220)](_0x23fb08);}else{if(_0x1827ea[0x0][_0x237690(0x22b)]=='Hindi')var _0x23fb08=users[_0x237690(0x2bc)];else{if(_0x1827ea[0x0][_0x237690(0x22b)]==_0x237690(0x214))var _0x23fb08=users[_0x237690(0x214)];else{if(_0x1827ea[0x0][_0x237690(0x22b)]==_0x237690(0x2aa))var _0x23fb08=users[_0x237690(0x2aa)];else{if(_0x1827ea[0x0][_0x237690(0x22b)]==_0x237690(0x235))var _0x23fb08=users[_0x237690(0x235)];else{if(_0x1827ea[0x0][_0x237690(0x22b)]==_0x237690(0x241))var _0x23fb08=users[_0x237690(0x2be)];else{if(_0x1827ea[0x0][_0x237690(0x22b)]==_0x237690(0x2ac))var _0x23fb08=users[_0x237690(0x2ac)];else{if(_0x1827ea[0x0][_0x237690(0x22b)]==_0x237690(0x1f6))var _0x23fb08=users[_0x237690(0x28f)];}}}}}}}_0x1b5a4f[_0x237690(0x25b)](_0x237690(0x2b9),{'success':_0x42cf91[_0x237690(0x219)]('success'),'errors':_0x42cf91[_0x237690(0x219)](_0x237690(0x252)),'sales':_0x559229,'profile':_0x32a735,'role':_0x5e76a3,'master_shop':_0x1827ea,'language':_0x23fb08});}catch(_0x16b31c){console[_0x237690(0x220)](_0x16b31c);}});async function getRandom8DigitNumber(){var _0x4d2640=a0_0x13ef01;const _0x221817=0x989680,_0x33db02=0x5f5e0ff,_0x57665d=Math[_0x4d2640(0x20e)](Math['random']()*(_0x33db02-_0x221817+0x1))+_0x221817;var _0x5b2a7d;const _0x52791b=await sales[_0x4d2640(0x25d)]({'invoice':_0x4d2640(0x2f7)+_0x57665d});return _0x52791b&&_0x52791b[_0x4d2640(0x2a6)]>0x0?_0x5b2a7d=_0x4d2640(0x2f7)+_0x57665d:_0x5b2a7d='OUT-'+_0x57665d,_0x5b2a7d;}router[a0_0x13ef01(0x271)](a0_0x13ef01(0x2a5),auth,async(_0x1bd7ab,_0x487ff4)=>{var _0x361994=a0_0x13ef01;try{const {username:_0x204c6d,email:_0x31d66e,role:_0x344e4f}=_0x1bd7ab[_0x361994(0x2a9)],_0xae6f9f=_0x1bd7ab['user'],_0x598af0=await profile[_0x361994(0x25d)]({'email':_0xae6f9f[_0x361994(0x2d5)]}),_0x58961c=await master_shop[_0x361994(0x295)](),_0x8f303a=await customer[_0x361994(0x295)]({});let _0x125930;if(_0xae6f9f[_0x361994(0x2f6)]==_0x361994(0x25a)){const _0x25c74d=await staff[_0x361994(0x25d)]({'email':_0xae6f9f[_0x361994(0x2d5)]});_0x125930=await warehouse[_0x361994(0x2c7)]([{'$match':{'status':_0x361994(0x203),'name':_0x25c74d[_0x361994(0x2d1)],'warehouse_category':_0x361994(0x270),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x361994(0x2f4),'name':{'$first':_0x361994(0x2f4)}}},{'$sort':{'name':0x1}}]);}else _0x125930=await warehouse['aggregate']([{'$match':{'status':_0x361994(0x203),'warehouse_category':_0x361994(0x270),'name':{'$ne':_0x361994(0x2d6)}}},{'$group':{'_id':_0x361994(0x2f4),'name':{'$first':_0x361994(0x2f4)}}},{'$sort':{'name':0x1}}]);const _0x4b5899=await product['find']({});var _0x582352=['Ambient',_0x361994(0x221)];const _0x24a775=await sales[_0x361994(0x295)]({}),_0x300360=_0x24a775[_0x361994(0x2a6)]+0x1,_0x4daa1d=_0x361994(0x2f7)+_0x300360[_0x361994(0x2f8)]()[_0x361994(0x217)](0x5,'0');if(_0x58961c[0x0][_0x361994(0x22b)]==_0x361994(0x240)){var _0x3dc7d7=users[_0x361994(0x28b)];console[_0x361994(0x220)](_0x3dc7d7);}else{if(_0x58961c[0x0]['language']==_0x361994(0x2bc))var _0x3dc7d7=users[_0x361994(0x2bc)];else{if(_0x58961c[0x0][_0x361994(0x22b)]==_0x361994(0x214))var _0x3dc7d7=users[_0x361994(0x214)];else{if(_0x58961c[0x0]['language']=='Spanish')var _0x3dc7d7=users[_0x361994(0x2aa)];else{if(_0x58961c[0x0]['language']=='French')var _0x3dc7d7=users['French'];else{if(_0x58961c[0x0][_0x361994(0x22b)]==_0x361994(0x241))var _0x3dc7d7=users[_0x361994(0x2be)];else{if(_0x58961c[0x0][_0x361994(0x22b)]==_0x361994(0x2ac))var _0x3dc7d7=users[_0x361994(0x2ac)];else{if(_0x58961c[0x0]['language']==_0x361994(0x1f6))var _0x3dc7d7=users[_0x361994(0x28f)];}}}}}}}const _0x433b14=getRandom8DigitNumber();_0x433b14[_0x361994(0x207)](_0x323135=>{var _0x30d2e3=_0x361994;_0x487ff4[_0x30d2e3(0x25b)](_0x30d2e3(0x2d4),{'success':_0x1bd7ab[_0x30d2e3(0x219)](_0x30d2e3(0x26a)),'errors':_0x1bd7ab[_0x30d2e3(0x219)](_0x30d2e3(0x252)),'role':_0xae6f9f,'profile':_0x598af0,'customer':_0x8f303a,'warehouse':_0x125930,'product':_0x4b5899,'invoice':_0x323135,'master_shop':_0x58961c,'language':_0x3dc7d7,'rooms_data':_0x582352});})['catch'](_0x59ef11=>{var _0x3abfd4=_0x361994;_0x1bd7ab[_0x3abfd4(0x219)](_0x3abfd4(0x252),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x487ff4[_0x3abfd4(0x27d)](_0x3abfd4(0x255));});}catch(_0x127755){console[_0x361994(0x220)](_0x127755);}}),router[a0_0x13ef01(0x271)]('/view/add_sales/:id',auth,async(_0x4def5f,_0x3f3a41)=>{var _0x1182da=a0_0x13ef01;try{const _0x43fd01=_0x4def5f['params']['id'];console[_0x1182da(0x220)](_0x43fd01);const _0x3218a4=await product[_0x1182da(0x295)](),_0x56f405=await purchases['aggregate']([{'$match':{'warehouse_name':_0x43fd01}},{'$unwind':'$product'},{'$group':{'_id':_0x1182da(0x261)}}]);console[_0x1182da(0x220)]('purchases_data',_0x56f405),_0x3f3a41[_0x1182da(0x2d2)](0xc8)[_0x1182da(0x250)]({'purchases_data':_0x56f405,'product_data':_0x3218a4});}catch(_0x428a99){console[_0x1182da(0x220)](_0x428a99);}}),router[a0_0x13ef01(0x24e)](a0_0x13ef01(0x22d),auth,async(_0x311152,_0x1b418f)=>{var _0x2e4f21=a0_0x13ef01;try{const {warehouse_data:_0x2d68f9,product_data:_0x153d5b}=_0x311152[_0x2e4f21(0x2a4)];console['log'](_0x311152['body'][_0x2e4f21(0x225)]);;const _0x173b35=await master_shop[_0x2e4f21(0x295)]();console[_0x2e4f21(0x220)]('master',_0x173b35);const _0x976706=await product[_0x2e4f21(0x25d)]({'name':_0x153d5b});console[_0x2e4f21(0x220)](_0x2e4f21(0x279),_0x976706);const _0x41e894=await warehouse[_0x2e4f21(0x2c7)]([{'$match':{'name':_0x2d68f9}},{'$unwind':_0x2e4f21(0x249)},{'$match':{'product_details.product_name':_0x153d5b}},{'$group':{'_id':_0x2e4f21(0x27a),'product_stock':{'$first':_0x2e4f21(0x215)}}}]);console[_0x2e4f21(0x220)](_0x2e4f21(0x2a0),_0x41e894),_0x1b418f['status'](0xc8)[_0x2e4f21(0x250)]({'master':_0x173b35,'new_product':_0x976706,'stock_data':_0x41e894});}catch(_0x3ea9a5){console[_0x2e4f21(0x220)](_0x3ea9a5);}}),router[a0_0x13ef01(0x24e)](a0_0x13ef01(0x2a5),auth,async(_0x52e2bc,_0x195c0b)=>{var _0x465e99=a0_0x13ef01;try{const {invoice:_0x3abbe1,date:_0x1b227c,warehouse_name:_0x1a2a93,product_name:_0x1a7077,stock:_0x137096,quantity:_0x1de952,note:_0x31ff9a,room:_0xb6eff6,primary_code:_0x45b12f,secondary_code:_0x4a61a0,prod_code:_0x3fcbe8,level:_0x3a3bab,isle:_0x56ea6b,pallet:_0x1f3fbe,batch_code:_0x4a0e4b,SCRN:_0x414c28,expiry_date:_0x311490}=_0x52e2bc[_0x465e99(0x2a4)];if(typeof _0x1a7077==_0x465e99(0x21e))var _0x2af79a=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x275)]],_0x54a2c1=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x213)]],_0x3a4d7=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x21a)]],_0x2e891b=[_0x52e2bc[_0x465e99(0x2a4)]['primary_code']],_0x60ff52=[_0x52e2bc['body'][_0x465e99(0x2ca)]],_0x32ff9a=[_0x52e2bc[_0x465e99(0x2a4)]['prod_code']],_0x443672=[_0x52e2bc[_0x465e99(0x2a4)]['level']],_0x1e3e87=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x281)]],_0x2264fc=[_0x52e2bc['body'][_0x465e99(0x1fd)]],_0x35f703=[_0x52e2bc[_0x465e99(0x2a4)]['batch_code']],_0x8f0d2a=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x2f2)]],_0x2f6b41=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x267)]],_0x3fdb34=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x21c)]],_0x421c03=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x2da)]],_0x177bf0=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x26d)]],_0x206b55=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x22e)]],_0x5b7080=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x2e4)]],_0x4da6f9=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x232)]],_0x1aef4e=[_0x52e2bc[_0x465e99(0x2a4)]['RoomAssigned']],_0x4d3918=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x269)]],_0x1d7272=[_0x52e2bc[_0x465e99(0x2a4)]['actual_qty']],_0x5dfbbb=[_0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x245)]],_0x4a19a0=[_0x52e2bc['body'][_0x465e99(0x2ed)]];else var _0x2af79a=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x275)]],_0x54a2c1=[..._0x52e2bc['body']['stock']],_0x3a4d7=[..._0x52e2bc[_0x465e99(0x2a4)]['carton']],_0x2e891b=[..._0x52e2bc['body'][_0x465e99(0x282)]],_0x60ff52=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x2ca)]],_0x32ff9a=[..._0x52e2bc[_0x465e99(0x2a4)]['prod_code']],_0x443672=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x238)]],_0x1e3e87=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x281)]],_0x2264fc=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x1fd)]],_0x35f703=[..._0x52e2bc['body']['batch_code']],_0x8f0d2a=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x2f2)]],_0x2f6b41=[..._0x52e2bc[_0x465e99(0x2a4)]['max_per_unit']],_0x3fdb34=[..._0x52e2bc[_0x465e99(0x2a4)]['production_date']],_0x421c03=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x2da)]],_0x177bf0=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x26d)]],_0x206b55=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x22e)]],_0x5b7080=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x2e4)]],_0x4da6f9=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x232)]],_0x1aef4e=[..._0x52e2bc['body'][_0x465e99(0x23d)]],_0x4d3918=[..._0x52e2bc[_0x465e99(0x2a4)]['prod_invoice']],_0x1d7272=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x283)]],_0x5dfbbb=[..._0x52e2bc[_0x465e99(0x2a4)][_0x465e99(0x245)]],_0x4a19a0=[..._0x52e2bc['body']['id_transact']];const _0x7a7c93=_0x2af79a['map'](_0x196929=>{return _0x196929={'product_name':_0x196929};});_0x54a2c1['forEach']((_0xbb3914,_0x1db627)=>{var _0x19dc18=_0x465e99;_0x7a7c93[_0x1db627][_0x19dc18(0x213)]=Math['abs'](_0xbb3914);}),_0x1d7272[_0x465e99(0x2a7)]((_0x3bd543,_0x49d16b)=>{var _0x560fdb=_0x465e99;_0x7a7c93[_0x49d16b][_0x560fdb(0x283)]=Math[_0x560fdb(0x25f)](_0x3bd543);}),_0x5dfbbb['forEach']((_0x349cf2,_0x2a21c1)=>{var _0x176166=_0x465e99;_0x7a7c93[_0x2a21c1][_0x176166(0x245)]=_0x349cf2;}),_0x4a19a0[_0x465e99(0x2a7)]((_0x3904da,_0x3bcdb7)=>{var _0x3cd4eb=_0x465e99;_0x7a7c93[_0x3bcdb7][_0x3cd4eb(0x229)]=_0x3904da;}),_0x3a4d7[_0x465e99(0x2a7)]((_0x190cdb,_0x1fe416)=>{var _0x1ec69c=_0x465e99;_0x7a7c93[_0x1fe416][_0x1ec69c(0x232)]=_0x190cdb;}),_0x2e891b[_0x465e99(0x2a7)]((_0x4d5d76,_0x52615f)=>{var _0x1f0f6f=_0x465e99;_0x7a7c93[_0x52615f][_0x1f0f6f(0x282)]=_0x4d5d76;}),_0x60ff52['forEach']((_0xa1d019,_0x45d360)=>{_0x7a7c93[_0x45d360]['secondary_code']=_0xa1d019;}),_0x32ff9a[_0x465e99(0x2a7)]((_0xeef679,_0x1b9a2a)=>{var _0x546887=_0x465e99;_0x7a7c93[_0x1b9a2a][_0x546887(0x280)]=_0xeef679;}),_0x443672[_0x465e99(0x2a7)]((_0x570943,_0x530784)=>{var _0x3e561b=_0x465e99;_0x1aef4e[_0x3e561b(0x2a7)]((_0x464b44,_0x124cce)=>{var _0x1312c7=_0x3e561b;if(_0x464b44==_0x1312c7(0x285)&&_0x530784==_0x124cce){var _0x19e987=_0x570943['slice'](0x3);_0x7a7c93[_0x530784][_0x1312c7(0x23c)]=_0x570943[0x0],_0x7a7c93[_0x530784][_0x1312c7(0x1fe)]=_0x570943[0x1],_0x7a7c93[_0x530784][_0x1312c7(0x2b4)]=0x0,_0x7a7c93[_0x530784][_0x1312c7(0x27b)]=0x0,_0x7a7c93[_0x530784][_0x1312c7(0x1f9)]=_0x1312c7(0x29e),_0x7a7c93[_0x530784][_0x1312c7(0x244)]=_0x19e987;}else{if(_0x464b44==_0x1312c7(0x268)&&_0x530784==_0x124cce){var _0x19e987=_0x570943[_0x1312c7(0x266)](0x3);_0x7a7c93[_0x530784][_0x1312c7(0x23c)]=_0x570943[0x0],_0x7a7c93[_0x530784]['rack']=_0x570943[0x1],_0x7a7c93[_0x530784]['bay']=0x0,_0x7a7c93[_0x530784][_0x1312c7(0x27b)]=0x0,_0x7a7c93[_0x530784][_0x1312c7(0x1f9)]=_0x1312c7(0x29e),_0x7a7c93[_0x530784][_0x1312c7(0x244)]=_0x570943[0x5];}else{if(_0x530784==_0x124cce){var _0x4e620d;if(_0x570943[0x4]=='L')_0x4e620d=_0x1312c7(0x2c5);else _0x570943[0x4]=='F'&&(_0x4e620d=_0x1312c7(0x29e));_0x7a7c93[_0x530784][_0x1312c7(0x23c)]=_0x570943[0x0],_0x7a7c93[_0x530784][_0x1312c7(0x1fe)]=_0x570943[0x1],_0x7a7c93[_0x530784][_0x1312c7(0x2b4)]=_0x570943[0x2],_0x7a7c93[_0x530784][_0x1312c7(0x27b)]=_0x570943[0x3],_0x7a7c93[_0x530784][_0x1312c7(0x1f9)]=_0x4e620d,_0x7a7c93[_0x530784][_0x1312c7(0x244)]=_0x570943[0x5];}}}});}),_0x1e3e87['forEach']((_0x5268be,_0x2f6c58)=>{var _0x9cc6ad=_0x465e99;_0x7a7c93[_0x2f6c58][_0x9cc6ad(0x2ab)]=_0x5268be;}),_0x2264fc[_0x465e99(0x2a7)]((_0x433ba3,_0x13fcea)=>{var _0x44fe02=_0x465e99;_0x7a7c93[_0x13fcea][_0x44fe02(0x1fd)]=_0x433ba3;}),_0x35f703[_0x465e99(0x2a7)]((_0x520223,_0x41b7b6)=>{var _0x20cfde=_0x465e99;_0x7a7c93[_0x41b7b6][_0x20cfde(0x205)]=_0x520223;}),_0x8f0d2a[_0x465e99(0x2a7)]((_0x161069,_0xf0304a)=>{var _0x595445=_0x465e99;_0x7a7c93[_0xf0304a][_0x595445(0x2f2)]=_0x161069;}),_0x2f6b41[_0x465e99(0x2a7)]((_0x2daef5,_0x5db867)=>{var _0x39c1e2=_0x465e99;_0x7a7c93[_0x5db867][_0x39c1e2(0x2e2)]=_0x2daef5;}),_0x3fdb34[_0x465e99(0x2a7)]((_0x5cf9b,_0x39cc1d)=>{var _0x4dcbbc=_0x465e99;_0x7a7c93[_0x39cc1d][_0x4dcbbc(0x21c)]=_0x5cf9b;}),_0x421c03['forEach']((_0x23334f,_0xce8193)=>{var _0x2783c4=_0x465e99;_0x7a7c93[_0xce8193][_0x2783c4(0x2da)]=_0x23334f;}),_0x177bf0[_0x465e99(0x2a7)]((_0x352d63,_0x34e72b)=>{var _0x120f1f=_0x465e99;_0x7a7c93[_0x34e72b][_0x120f1f(0x26d)]=_0x352d63;}),_0x206b55[_0x465e99(0x2a7)]((_0x420aba,_0x119b62)=>{var _0x4ad34b=_0x465e99;_0x7a7c93[_0x119b62][_0x4ad34b(0x22e)]=_0x420aba;}),_0x5b7080[_0x465e99(0x2a7)]((_0x35720d,_0x206912)=>{var _0x17c7bf=_0x465e99;_0x7a7c93[_0x206912][_0x17c7bf(0x2e4)]=_0x35720d;}),_0x4da6f9[_0x465e99(0x2a7)]((_0x10d572,_0xb33925)=>{var _0x1d08c0=_0x465e99;_0x7a7c93[_0xb33925][_0x1d08c0(0x26c)]=_0x10d572;}),_0x1aef4e[_0x465e99(0x2a7)]((_0x671f58,_0x1708c7)=>{_0x7a7c93[_0x1708c7]['room_name']=_0x671f58;}),_0x4d3918[_0x465e99(0x2a7)]((_0x263285,_0x6d547d)=>{var _0x34ccf3=_0x465e99;_0x7a7c93[_0x6d547d][_0x34ccf3(0x23e)]=_0x263285;});var _0x2afa6d=0x0;_0x7a7c93[_0x465e99(0x2a7)](_0x57afec=>{var _0x4703f5=_0x465e99;(_0x57afec[_0x4703f5(0x213)]<_0x57afec[_0x4703f5(0x26c)]||_0x57afec[_0x4703f5(0x26c)]==0x0)&&(console[_0x4703f5(0x220)](_0x4703f5(0x2bb),_0x57afec),_0x2afa6d++);});const _0x55f39d=_0x7a7c93['filter'](_0x24a166=>_0x24a166[_0x465e99(0x232)]!=='0'&&_0x24a166[_0x465e99(0x232)]!==''),_0x37f4ba=new sales({'invoice':_0x3abbe1,'customer':_0x52e2bc[_0x465e99(0x2a4)]['customer'],'date':_0x1b227c,'warehouse_name':_0x1a2a93,'sale_product':_0x55f39d,'note':_0x31ff9a,'room':_0xb6eff6,'primary_code':_0x45b12f,'secondary_code':_0x4a61a0,'prod_code':_0x3fcbe8,'SCRN':_0x414c28}),_0x16c6d3=await _0x37f4ba[_0x465e99(0x2dd)]();_0x52e2bc[_0x465e99(0x219)](_0x465e99(0x26a),_0x465e99(0x24a)),_0x195c0b['redirect']('/all_sales/preview/'+_0x16c6d3[_0x465e99(0x2b3)]);}catch(_0x51f867){console[_0x465e99(0x220)](_0x51f867);}}),router[a0_0x13ef01(0x271)]('/preview/:id',auth,async(_0x241405,_0x1b7604)=>{var _0x16e273=a0_0x13ef01;try{const {username:_0x305af6,email:_0x37997d,role:_0x2d5680}=_0x241405['user'],_0x743ed=_0x241405[_0x16e273(0x2a9)],_0x48dddb=await profile['findOne']({'email':_0x743ed[_0x16e273(0x2d5)]}),_0x4ba4c2=await master_shop[_0x16e273(0x295)](),_0x24043d=_0x241405[_0x16e273(0x218)]['id'],_0x8bbaa9=await sales[_0x16e273(0x1fc)](_0x24043d),_0x42b90b=await warehouse[_0x16e273(0x2c7)]([{'$match':{'name':_0x8bbaa9[_0x16e273(0x248)]}},{'$unwind':_0x16e273(0x249)},{'$group':{'_id':_0x16e273(0x29f),'name':{'$first':_0x16e273(0x27a)},'product_stock':{'$first':_0x16e273(0x215)},'bay':{'$first':_0x16e273(0x26f)},'bin':{'$first':_0x16e273(0x23a)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x16e273(0x2eb)},'secondary_code':{'$first':_0x16e273(0x2c0)},'product_code':{'$first':_0x16e273(0x274)},'storage':{'$first':_0x16e273(0x2b1)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x16e273(0x21f)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x44e9ca=await customer[_0x16e273(0x295)]({});let _0x60fb81;if(_0x743ed[_0x16e273(0x2f6)]==_0x16e273(0x25a)){const _0x4250ce=await staff[_0x16e273(0x25d)]({'email':_0x743ed[_0x16e273(0x2d5)]});_0x60fb81=await warehouse['aggregate']([{'$match':{'status':_0x16e273(0x203),'name':_0x4250ce[_0x16e273(0x2d1)]}},{'$group':{'_id':_0x16e273(0x2f4),'name':{'$first':'$name'}}}]);}else _0x60fb81=await warehouse[_0x16e273(0x2c7)]([{'$match':{'status':_0x16e273(0x203)}},{'$group':{'_id':_0x16e273(0x2f4),'name':{'$first':_0x16e273(0x2f4)}}}]);const _0x5ad588=await product[_0x16e273(0x295)]({}),_0x259389=await suppliers[_0x16e273(0x295)]({});if(_0x4ba4c2[0x0][_0x16e273(0x22b)]==_0x16e273(0x240)){var _0x69429f=users['English'];console[_0x16e273(0x220)](_0x69429f);}else{if(_0x4ba4c2[0x0][_0x16e273(0x22b)]==_0x16e273(0x2bc))var _0x69429f=users[_0x16e273(0x2bc)];else{if(_0x4ba4c2[0x0]['language']==_0x16e273(0x214))var _0x69429f=users[_0x16e273(0x214)];else{if(_0x4ba4c2[0x0][_0x16e273(0x22b)]==_0x16e273(0x2aa))var _0x69429f=users[_0x16e273(0x2aa)];else{if(_0x4ba4c2[0x0][_0x16e273(0x22b)]=='French')var _0x69429f=users[_0x16e273(0x235)];else{if(_0x4ba4c2[0x0][_0x16e273(0x22b)]==_0x16e273(0x241))var _0x69429f=users[_0x16e273(0x2be)];else{if(_0x4ba4c2[0x0][_0x16e273(0x22b)]==_0x16e273(0x2ac))var _0x69429f=users[_0x16e273(0x2ac)];else{if(_0x4ba4c2[0x0][_0x16e273(0x22b)]==_0x16e273(0x1f6))var _0x69429f=users[_0x16e273(0x28f)];}}}}}}}_0x1b7604['render'](_0x16e273(0x2cb),{'success':_0x241405['flash'](_0x16e273(0x26a)),'errors':_0x241405[_0x16e273(0x219)](_0x16e273(0x252)),'role':_0x743ed,'profile':_0x48dddb,'customer':_0x44e9ca,'warehouse':_0x60fb81,'product':_0x42b90b,'user':_0x8bbaa9,'master_shop':_0x4ba4c2,'unit':_0x5ad588,'language':_0x69429f,'suppliers':_0x259389});}catch(_0x1b8eab){console['log'](_0x1b8eab);}}),router[a0_0x13ef01(0x24e)](a0_0x13ef01(0x2cf),auth,async(_0x315615,_0x28555f)=>{var _0x53f5c7=a0_0x13ef01;try{const _0x2fd395=_0x315615[_0x53f5c7(0x218)]['id'],{invoice:_0xec8670,warehouse_name:_0x2beda9,room:_0x4a286f}=_0x315615[_0x53f5c7(0x2a4)],_0x305efb=await sales[_0x53f5c7(0x25d)]({'invoice':_0xec8670}),_0xb305de=_0x305efb[_0x53f5c7(0x20b)][_0x53f5c7(0x259)](async _0x5d8998=>{var _0x2a8235=_0x53f5c7,_0x298b8b=await warehouse[_0x2a8235(0x25d)]({'name':_0x2beda9,'room':_0x5d8998[_0x2a8235(0x208)],'warehouse_category':_0x2a8235(0x270)});const _0x3b998f=_0x298b8b['product_details'][_0x2a8235(0x259)](_0x59501e=>{var _0xfafdeb=_0x2a8235;_0x59501e['product_name']==_0x5d8998[_0xfafdeb(0x275)]&&_0x59501e[_0xfafdeb(0x244)]==_0x5d8998['floorlevel']&&_0x59501e['type']==_0x5d8998[_0xfafdeb(0x1f9)]&&_0x59501e[_0xfafdeb(0x27b)]==_0x5d8998[_0xfafdeb(0x27b)]&&_0x59501e[_0xfafdeb(0x2b4)]==_0x5d8998['bay']&&_0x59501e[_0xfafdeb(0x1fe)]==_0x5d8998['rack']&&_0x59501e['storage']==_0x5d8998[_0xfafdeb(0x23c)]&&_0x59501e[_0xfafdeb(0x2f2)]==_0x5d8998[_0xfafdeb(0x2f2)]&&_0x59501e[_0xfafdeb(0x205)]==_0x5d8998[_0xfafdeb(0x205)]&&_0x59501e[_0xfafdeb(0x23e)]==_0x5d8998[_0xfafdeb(0x23e)]&&_0x59501e[_0xfafdeb(0x2b3)]==_0x5d8998[_0xfafdeb(0x229)]&&(_0x59501e[_0xfafdeb(0x2ea)]=Math[_0xfafdeb(0x28c)](0x0,Math['abs'](_0x59501e['product_stock'])-Math[_0xfafdeb(0x25f)](_0x5d8998[_0xfafdeb(0x232)])));});return _0x298b8b;});Promise['all'](_0xb305de)[_0x53f5c7(0x207)](async _0x372698=>{var _0x586c48=_0x53f5c7;try{for(const _0x3e24f9 of _0x372698){await _0x3e24f9[_0x586c48(0x2dd)]();}_0x305efb[_0x586c48(0x2a1)]=_0x586c48(0x23b);const _0x243263=await _0x305efb[_0x586c48(0x2dd)](),_0x895cbc=await master_shop[_0x586c48(0x295)](),_0x23f691=await email_settings[_0x586c48(0x25d)](),_0x2f1ef2=await supervisor_settings['find']();var _0x4c0383=_0x305efb[_0x586c48(0x20b)],_0x2db566='',_0x2a7905;for(_0x2a7905 in _0x4c0383){_0x2db566+=_0x586c48(0x23f)+_0x586c48(0x24f)+_0x4c0383[_0x2a7905][_0x586c48(0x275)]+_0x586c48(0x2f9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c0383[_0x2a7905][_0x586c48(0x280)]+_0x586c48(0x2f9)+_0x586c48(0x24f)+_0x4c0383[_0x2a7905]['quantity']+_0x586c48(0x2f9)+_0x586c48(0x24f)+_0x4c0383[_0x2a7905][_0x586c48(0x2ab)]+_0x586c48(0x2f9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c0383[_0x2a7905][_0x586c48(0x1fd)]+_0x586c48(0x2f9)+_0x586c48(0x24f)+_0x305efb['warehouse_name']+_0x586c48(0x2f9)+_0x586c48(0x24f)+_0x4c0383[_0x2a7905][_0x586c48(0x208)]+_0x586c48(0x2f9)+_0x586c48(0x24f)+_0x4c0383[_0x2a7905][_0x586c48(0x23c)]+_0x4c0383[_0x2a7905][_0x586c48(0x1fe)]+_0x4c0383[_0x2a7905][_0x586c48(0x2b4)]+_0x4c0383[_0x2a7905][_0x586c48(0x27b)]+_0x4c0383[_0x2a7905][_0x586c48(0x1f9)][0x0]+_0x4c0383[_0x2a7905]['floorlevel']+_0x586c48(0x2f9),'</tr>';}let _0x29c819=nodemailer['createTransport']({'host':_0x23f691[_0x586c48(0x201)],'port':Number(_0x23f691[_0x586c48(0x287)]),'secure':![],'auth':{'user':_0x23f691[_0x586c48(0x2d5)],'pass':_0x23f691['password']}}),_0x373948={'from':_0x23f691['email'],'to':_0x2f1ef2[0x0][_0x586c48(0x2e6)],'subject':_0x586c48(0x29c),'attachments':[{'filename':_0x586c48(0x29d),'path':__dirname+_0x586c48(0x200)+_0x586c48(0x2f0)+_0x895cbc[0x0][_0x586c48(0x2de)],'cid':'logo'}],'html':_0x586c48(0x2f3)+_0x586c48(0x28e)+_0x586c48(0x2cc)+'<div>'+_0x586c48(0x209)+_0x586c48(0x2c2)+_0x586c48(0x1ff)+'</div>'+_0x586c48(0x2c2)+_0x586c48(0x2db)+_0x895cbc[0x0][_0x586c48(0x1f4)]+_0x586c48(0x251)+_0x586c48(0x2ec)+_0x586c48(0x2ec)+_0x586c48(0x20c)+_0x586c48(0x2c2)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x586c48(0x2f1)+_0x305efb['invoice']+'\x20'+_0x586c48(0x265)+'\x20Order\x20Date\x20:\x20'+_0x305efb[_0x586c48(0x22c)]+'\x20'+_0x586c48(0x2c1)+'</h5>'+_0x586c48(0x2ec)+_0x586c48(0x2e0)+_0x586c48(0x239)+_0x586c48(0x23f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x586c48(0x2b7)+_0x586c48(0x1f8)+_0x586c48(0x2e7)+_0x586c48(0x26e)+_0x586c48(0x2d3)+_0x586c48(0x289)+_0x586c48(0x246)+_0x586c48(0x224)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2db566+'\x20'+_0x586c48(0x2ee)+'</table>'+_0x586c48(0x2c2)+_0x586c48(0x1f3)+_0x586c48(0x276)+_0x895cbc[0x0]['site_title']+_0x586c48(0x288)+_0x586c48(0x2ec)+_0x586c48(0x2ec)+'</body></html>'};_0x29c819['sendMail'](_0x373948,function(_0x523bda,_0x2dedd7){var _0x52b69a=_0x586c48;_0x523bda?(console['log'](_0x523bda),console[_0x52b69a(0x220)](_0x52b69a(0x2c4))):console[_0x52b69a(0x220)](_0x52b69a(0x237));}),_0x315615[_0x586c48(0x219)](_0x586c48(0x26a),_0x586c48(0x27f)),_0x28555f['redirect']('/all_sales/preview/'+_0x2fd395);}catch(_0x15d1b3){console['error'](_0x15d1b3),_0x28555f[_0x586c48(0x2d2)](0x1f4)[_0x586c48(0x250)]({'error':_0x586c48(0x293)});}})[_0x53f5c7(0x202)](_0x29b346=>{var _0x1f4003=_0x53f5c7;console['error'](_0x29b346),_0x28555f[_0x1f4003(0x2d2)](0x1f4)[_0x1f4003(0x250)]({'error':_0x1f4003(0x211)});});}catch(_0x1fc25b){console['log'](_0x1fc25b);}}),router[a0_0x13ef01(0x271)]('/view/:id',auth,async(_0x4ff03d,_0x1c62f9)=>{var _0x2307db=a0_0x13ef01;try{const {username:_0x1681ff,email:_0x5b3971,role:_0x41a89d}=_0x4ff03d[_0x2307db(0x2a9)],_0x36474a=_0x4ff03d[_0x2307db(0x2a9)],_0x1117aa=await profile['findOne']({'email':_0x36474a[_0x2307db(0x2d5)]}),_0x33b8e3=await master_shop['find'](),_0x137d64=_0x4ff03d['params']['id'],_0x418b19=await sales['findById'](_0x137d64);var _0x55f7b6=[_0x2307db(0x256),_0x2307db(0x221)];const _0x1ad235=await warehouse[_0x2307db(0x2c7)]([{'$match':{'name':_0x418b19[_0x2307db(0x248)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x2307db(0x249)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2307db(0x215)},'bay':{'$first':_0x2307db(0x26f)},'bin':{'$first':_0x2307db(0x23a)},'type':{'$first':_0x2307db(0x228)},'floorlevel':{'$first':_0x2307db(0x273)},'primary_code':{'$first':_0x2307db(0x2eb)},'secondary_code':{'$first':_0x2307db(0x2c0)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2307db(0x2b1)},'rack':{'$first':_0x2307db(0x2c9)}}}]),_0x3bc3f6=await customer['find']({});let _0x34daef;if(_0x36474a[_0x2307db(0x2f6)]==_0x2307db(0x25a)){const _0xa6450a=await staff[_0x2307db(0x25d)]({'email':_0x36474a[_0x2307db(0x2d5)]});_0x34daef=await warehouse[_0x2307db(0x2c7)]([{'$match':{'status':_0x2307db(0x203),'name':_0xa6450a[_0x2307db(0x2d1)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2307db(0x2f4),'name':{'$first':_0x2307db(0x2f4)}}}]);}else _0x34daef=await warehouse[_0x2307db(0x2c7)]([{'$match':{'status':_0x2307db(0x203),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2307db(0x2f4),'name':{'$first':_0x2307db(0x2f4)}}}]);const _0x25de57=await product[_0x2307db(0x295)]({});if(_0x33b8e3[0x0]['language']==_0x2307db(0x240)){var _0x4d9b36=users[_0x2307db(0x28b)];console[_0x2307db(0x220)](_0x4d9b36);}else{if(_0x33b8e3[0x0]['language']==_0x2307db(0x2bc))var _0x4d9b36=users['Hindi'];else{if(_0x33b8e3[0x0][_0x2307db(0x22b)]==_0x2307db(0x214))var _0x4d9b36=users[_0x2307db(0x214)];else{if(_0x33b8e3[0x0]['language']==_0x2307db(0x2aa))var _0x4d9b36=users[_0x2307db(0x2aa)];else{if(_0x33b8e3[0x0][_0x2307db(0x22b)]==_0x2307db(0x235))var _0x4d9b36=users['French'];else{if(_0x33b8e3[0x0][_0x2307db(0x22b)]==_0x2307db(0x241))var _0x4d9b36=users[_0x2307db(0x2be)];else{if(_0x33b8e3[0x0][_0x2307db(0x22b)]==_0x2307db(0x2ac))var _0x4d9b36=users[_0x2307db(0x2ac)];else{if(_0x33b8e3[0x0][_0x2307db(0x22b)]==_0x2307db(0x1f6))var _0x4d9b36=users[_0x2307db(0x28f)];}}}}}}}_0x1c62f9[_0x2307db(0x25b)]('edit_sales',{'success':_0x4ff03d[_0x2307db(0x219)](_0x2307db(0x26a)),'errors':_0x4ff03d['flash'](_0x2307db(0x252)),'role':_0x36474a,'profile':_0x1117aa,'customer':_0x3bc3f6,'warehouse':_0x34daef,'product':_0x1ad235,'user':_0x418b19,'master_shop':_0x33b8e3,'unit':_0x25de57,'language':_0x4d9b36});}catch(_0x12a28b){console[_0x2307db(0x220)](_0x12a28b);}}),router['post']('/view/:id',auth,async(_0x132fd3,_0x373df2)=>{var _0x1e9169=a0_0x13ef01;try{const _0x4c5afa=_0x132fd3[_0x1e9169(0x218)]['id'],_0x322de5=await sales[_0x1e9169(0x25d)]({'_id':_0x132fd3[_0x1e9169(0x218)]['id']}),_0x51aa2e=await warehouse[_0x1e9169(0x25d)]({'name':_0x322de5['warehouse_name'],'room':_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x272)]}),{invoice:_0x48a8a9,date:_0x4c08ec,warehouse_name:_0x1ff817,product_name:_0x1cf824,stock:_0x3e9fd0,quantity:_0x17b6de,note:_0x72cab2,room:_0x72c2ac,customer:_0xeea0f1,SCRN:_0x3d3a53}=_0x132fd3[_0x1e9169(0x2a4)];if(typeof _0x1cf824==_0x1e9169(0x21e))var _0x2291a3=[_0x132fd3['body']['product_name']],_0x207d69=[_0x132fd3['body']['stock']],_0x2532ac=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x21a)]],_0x3e9fd5=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x282)]],_0x357527=[_0x132fd3['body'][_0x1e9169(0x2ca)]],_0x4f4277=[_0x132fd3[_0x1e9169(0x2a4)]['prod_code']],_0x4cbe6a=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x238)]],_0x22cb10=[_0x132fd3[_0x1e9169(0x2a4)]['primary_unit']],_0x2d011d=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x1fd)]],_0xfbd942=[_0x132fd3['body'][_0x1e9169(0x205)]],_0x278d5f=[_0x132fd3['body'][_0x1e9169(0x2f2)]],_0x7cce2b=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x267)]],_0x1e70c2=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x21c)]],_0x207cdb=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x2da)]],_0x49b90a=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x26d)]],_0x40ba3a=[_0x132fd3[_0x1e9169(0x2a4)]['delivery_code']],_0x3dd118=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x2e4)]],_0x12df1b=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x232)]],_0x41cf63=[_0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x23d)]];else var _0x2291a3=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x275)]],_0x207d69=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x213)]],_0x2532ac=[..._0x132fd3['body']['carton']],_0x3e9fd5=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x282)]],_0x357527=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x2ca)]],_0x4f4277=[..._0x132fd3[_0x1e9169(0x2a4)]['prod_code']],_0x4cbe6a=[..._0x132fd3['body'][_0x1e9169(0x238)]],_0x22cb10=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x281)]],_0x2d011d=[..._0x132fd3['body'][_0x1e9169(0x1fd)]],_0xfbd942=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x205)]],_0x278d5f=[..._0x132fd3[_0x1e9169(0x2a4)]['expiry_date']],_0x7cce2b=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x267)]],_0x1e70c2=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x21c)]],_0x207cdb=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x2da)]],_0x49b90a=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x26d)]],_0x40ba3a=[..._0x132fd3[_0x1e9169(0x2a4)]['delivery_code']],_0x3dd118=[..._0x132fd3['body'][_0x1e9169(0x2e4)]],_0x12df1b=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x232)]],_0x41cf63=[..._0x132fd3[_0x1e9169(0x2a4)][_0x1e9169(0x23d)]];const _0x38daf0=_0x2291a3[_0x1e9169(0x259)](_0x1ca0a4=>{return _0x1ca0a4={'product_name':_0x1ca0a4};});_0x207d69[_0x1e9169(0x2a7)]((_0x19529c,_0x433d7d)=>{var _0x57b6c9=_0x1e9169;_0x38daf0[_0x433d7d][_0x57b6c9(0x213)]=Math[_0x57b6c9(0x25f)](_0x19529c);}),_0x2532ac[_0x1e9169(0x2a7)]((_0x38accc,_0x3eea66)=>{var _0xac1583=_0x1e9169;_0x38daf0[_0x3eea66][_0xac1583(0x232)]=_0x38accc;}),_0x3e9fd5[_0x1e9169(0x2a7)]((_0x54989e,_0x556394)=>{var _0x2ea66b=_0x1e9169;_0x38daf0[_0x556394][_0x2ea66b(0x282)]=_0x54989e;}),_0x357527['forEach']((_0x2d61a8,_0x15eb8c)=>{var _0x5e57ea=_0x1e9169;_0x38daf0[_0x15eb8c][_0x5e57ea(0x2ca)]=_0x2d61a8;}),_0x4f4277[_0x1e9169(0x2a7)]((_0x3c5ca5,_0x5187ff)=>{var _0x17f627=_0x1e9169;_0x38daf0[_0x5187ff][_0x17f627(0x280)]=_0x3c5ca5;}),_0x4cbe6a[_0x1e9169(0x2a7)]((_0x1b9310,_0x278a55)=>{_0x41cf63['forEach']((_0x4644ab,_0x317490)=>{var _0x1a8881=a0_0x35c6;if(_0x4644ab=='Receiving\x20Area'&&_0x278a55==_0x317490){var _0xa39be6=_0x1b9310['slice'](0x3);_0x38daf0[_0x278a55][_0x1a8881(0x23c)]=_0x1b9310[0x0],_0x38daf0[_0x278a55][_0x1a8881(0x1fe)]=_0x1b9310[0x1],_0x38daf0[_0x278a55][_0x1a8881(0x2b4)]=0x0,_0x38daf0[_0x278a55][_0x1a8881(0x27b)]=0x0,_0x38daf0[_0x278a55][_0x1a8881(0x1f9)]=_0x1a8881(0x29e),_0x38daf0[_0x278a55][_0x1a8881(0x244)]=_0xa39be6;}else{if(_0x4644ab==_0x1a8881(0x268)&&_0x278a55==_0x317490){var _0xa39be6=_0x1b9310[_0x1a8881(0x266)](0x3);_0x38daf0[_0x278a55][_0x1a8881(0x23c)]=_0x1b9310[0x0],_0x38daf0[_0x278a55][_0x1a8881(0x1fe)]=_0x1b9310[0x1],_0x38daf0[_0x278a55][_0x1a8881(0x2b4)]=0x0,_0x38daf0[_0x278a55][_0x1a8881(0x27b)]=0x0,_0x38daf0[_0x278a55][_0x1a8881(0x1f9)]=_0x1a8881(0x29e),_0x38daf0[_0x278a55][_0x1a8881(0x244)]=_0x1b9310[0x5];}else{if(_0x278a55==_0x317490){var _0x418b63;if(_0x1b9310[0x4]=='L')_0x418b63=_0x1a8881(0x2c5);else _0x1b9310[0x4]=='F'&&(_0x418b63=_0x1a8881(0x29e));_0x38daf0[_0x278a55][_0x1a8881(0x23c)]=_0x1b9310[0x0],_0x38daf0[_0x278a55][_0x1a8881(0x1fe)]=_0x1b9310[0x1],_0x38daf0[_0x278a55][_0x1a8881(0x2b4)]=_0x1b9310[0x2],_0x38daf0[_0x278a55][_0x1a8881(0x27b)]=_0x1b9310[0x3],_0x38daf0[_0x278a55]['type']=_0x418b63,_0x38daf0[_0x278a55][_0x1a8881(0x244)]=_0x1b9310[0x5];}}}});}),_0x22cb10['forEach']((_0x30a7f1,_0x390819)=>{var _0x1c351d=_0x1e9169;_0x38daf0[_0x390819][_0x1c351d(0x2ab)]=_0x30a7f1;}),_0x2d011d[_0x1e9169(0x2a7)]((_0x47d649,_0x288849)=>{var _0x4c98b0=_0x1e9169;_0x38daf0[_0x288849][_0x4c98b0(0x1fd)]=_0x47d649;}),_0xfbd942['forEach']((_0x45f829,_0x112395)=>{_0x38daf0[_0x112395]['batch_code']=_0x45f829;}),_0x278d5f[_0x1e9169(0x2a7)]((_0x16284,_0x52e5dc)=>{_0x38daf0[_0x52e5dc]['expiry_date']=_0x16284;}),_0x7cce2b[_0x1e9169(0x2a7)]((_0x276980,_0x3f0a06)=>{var _0x57ef7d=_0x1e9169;_0x38daf0[_0x3f0a06][_0x57ef7d(0x2e2)]=_0x276980;}),_0x1e70c2[_0x1e9169(0x2a7)]((_0x58cb1b,_0x1eebf2)=>{var _0x5d1148=_0x1e9169;_0x38daf0[_0x1eebf2][_0x5d1148(0x21c)]=_0x58cb1b;}),_0x207cdb[_0x1e9169(0x2a7)]((_0x38fd58,_0xfe1996)=>{var _0x40de40=_0x1e9169;_0x38daf0[_0xfe1996][_0x40de40(0x2da)]=Math[_0x40de40(0x25f)](_0x38fd58);}),_0x49b90a[_0x1e9169(0x2a7)]((_0x53b672,_0x16e899)=>{var _0x515d02=_0x1e9169;_0x38daf0[_0x16e899][_0x515d02(0x26d)]=_0x53b672;}),_0x40ba3a[_0x1e9169(0x2a7)]((_0x923b50,_0x336070)=>{_0x38daf0[_0x336070]['delivery_code']=_0x923b50;}),_0x3dd118[_0x1e9169(0x2a7)]((_0x17c163,_0x5b72a4)=>{var _0x443e7f=_0x1e9169;_0x38daf0[_0x5b72a4][_0x443e7f(0x2e4)]=_0x17c163;}),_0x12df1b[_0x1e9169(0x2a7)]((_0x977b3a,_0x1ae13f)=>{var _0x5cee4e=_0x1e9169;_0x38daf0[_0x1ae13f][_0x5cee4e(0x26c)]=_0x977b3a;}),_0x41cf63[_0x1e9169(0x2a7)]((_0x38fd71,_0x17f98d)=>{var _0x6124fc=_0x1e9169;_0x38daf0[_0x17f98d][_0x6124fc(0x208)]=_0x38fd71;});var _0x109d75=0x0;_0x38daf0[_0x1e9169(0x2a7)](_0x3d8f85=>{var _0x4f819e=_0x1e9169;console[_0x4f819e(0x220)](_0x4f819e(0x2bb),_0x3d8f85),(parseInt(_0x3d8f85[_0x4f819e(0x213)])<parseInt(_0x3d8f85[_0x4f819e(0x232)])||parseInt(_0x3d8f85[_0x4f819e(0x232)])==0x0)&&_0x109d75++;});if(_0x109d75!=0x0)return _0x132fd3['flash'](_0x1e9169(0x252),_0x1e9169(0x299)),_0x373df2[_0x1e9169(0x27d)]('back');const _0xc9e79a=_0x38daf0[_0x1e9169(0x254)](_0x372dba=>_0x372dba[_0x1e9169(0x232)]!=='0'&&_0x372dba[_0x1e9169(0x232)]!=='');_0x322de5['invoice']=_0x48a8a9,_0x322de5[_0x1e9169(0x277)]=_0xeea0f1,_0x322de5[_0x1e9169(0x22c)]=_0x4c08ec,_0x322de5[_0x1e9169(0x248)]=_0x1ff817,_0x322de5[_0x1e9169(0x20b)]=_0xc9e79a,_0x322de5['note']=_0x72cab2,_0x322de5['SCRN']=_0x3d3a53,_0x322de5[_0x1e9169(0x2a1)]=_0x1e9169(0x286),_0x322de5[_0x1e9169(0x25c)]=_0x1e9169(0x286);const _0x4c8a9e=await _0x322de5[_0x1e9169(0x2dd)]();_0x132fd3['flash'](_0x1e9169(0x26a),_0x1e9169(0x27f)),_0x373df2['redirect'](_0x1e9169(0x255));}catch(_0x12790b){console[_0x1e9169(0x220)](_0x12790b);}}),router['post'](a0_0x13ef01(0x1f7),auth,async(_0x30e148,_0x20506e)=>{var _0x4742d1=a0_0x13ef01;try{const _0x3b5c3c=_0x30e148['params']['id'],{invoice:_0x4364a2,customer:_0x3ae577,receivable_amount:_0x297dfd,received_amount:_0x3361a8}=_0x30e148[_0x4742d1(0x2a4)],_0x66c2a7=await sales[_0x4742d1(0x1fc)](_0x3b5c3c);console[_0x4742d1(0x220)](_0x66c2a7);var _0x4e5e9f=_0x297dfd-_0x3361a8;console[_0x4742d1(0x220)](_0x3361a8),_0x66c2a7['received_amount']=parseFloat(_0x3361a8)+parseFloat(_0x66c2a7[_0x4742d1(0x2c3)]),_0x66c2a7['due_amount']=_0x4e5e9f,console[_0x4742d1(0x220)](_0x66c2a7);const _0xebe12=await _0x66c2a7[_0x4742d1(0x2dd)](),_0x13a958=await c_payment_data[_0x4742d1(0x25d)]({'invoice':_0x4364a2});_0x13a958[_0x4742d1(0x204)]=_0x4e5e9f,await _0x13a958[_0x4742d1(0x2dd)]();let _0x4ea200=new Date(),_0x23c598=('0'+_0x4ea200[_0x4742d1(0x2b0)]())[_0x4742d1(0x266)](-0x2),_0x670c74=('0'+(_0x4ea200[_0x4742d1(0x2bf)]()+0x1))[_0x4742d1(0x266)](-0x2),_0x4193f3=_0x4ea200['getFullYear'](),_0x13727e=_0x4193f3+'-'+_0x670c74+'-'+_0x23c598;const _0x3887bd=new customer_payment({'invoice':_0x4364a2,'date':_0x4193f3+'-'+_0x670c74+'-'+_0x23c598,'customer':_0x3ae577,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x3361a8}),_0x255933=await _0x3887bd[_0x4742d1(0x2dd)]();_0x30e148['flash'](_0x4742d1(0x26a),_0x4742d1(0x2b8)),_0x20506e[_0x4742d1(0x27d)](_0x4742d1(0x255));}catch(_0x1ada6b){console[_0x4742d1(0x220)](_0x1ada6b);}}),router[a0_0x13ef01(0x271)](a0_0x13ef01(0x2dc),auth,async(_0x27eb65,_0x1a392c)=>{var _0xbb2b38=a0_0x13ef01;try{const {username:_0x340384,email:_0x52c329,role:_0x4d0268}=_0x27eb65[_0xbb2b38(0x2a9)],_0x3df9ea=_0x27eb65[_0xbb2b38(0x2a9)],_0x2de053=await profile['findOne']({'email':_0x3df9ea[_0xbb2b38(0x2d5)]}),_0x60d640=await master_shop[_0xbb2b38(0x295)]();console[_0xbb2b38(0x220)](_0xbb2b38(0x234),_0x60d640);const _0x196420=_0x27eb65[_0xbb2b38(0x218)]['id'],_0x28cbf7=await sales[_0xbb2b38(0x1fc)](_0x196420);console[_0xbb2b38(0x220)](_0x28cbf7);const _0x5d0e2b=await customer[_0xbb2b38(0x25d)]({'name':_0x28cbf7[_0xbb2b38(0x277)]});console[_0xbb2b38(0x220)](_0x5d0e2b);if(_0x60d640[0x0][_0xbb2b38(0x22b)]==_0xbb2b38(0x240)){var _0x1cf6ff=users[_0xbb2b38(0x28b)];console['log'](_0x1cf6ff);}else{if(_0x60d640[0x0]['language']==_0xbb2b38(0x2bc))var _0x1cf6ff=users[_0xbb2b38(0x2bc)];else{if(_0x60d640[0x0][_0xbb2b38(0x22b)]==_0xbb2b38(0x214))var _0x1cf6ff=users[_0xbb2b38(0x214)];else{if(_0x60d640[0x0][_0xbb2b38(0x22b)]==_0xbb2b38(0x2aa))var _0x1cf6ff=users[_0xbb2b38(0x2aa)];else{if(_0x60d640[0x0][_0xbb2b38(0x22b)]==_0xbb2b38(0x235))var _0x1cf6ff=users['French'];else{if(_0x60d640[0x0][_0xbb2b38(0x22b)]=='Portuguese\x20(BR)')var _0x1cf6ff=users[_0xbb2b38(0x2be)];else{if(_0x60d640[0x0][_0xbb2b38(0x22b)]==_0xbb2b38(0x2ac))var _0x1cf6ff=users[_0xbb2b38(0x2ac)];else{if(_0x60d640[0x0]['language']==_0xbb2b38(0x1f6))var _0x1cf6ff=users[_0xbb2b38(0x28f)];}}}}}}}_0x1a392c['render'](_0xbb2b38(0x222),{'success':_0x27eb65[_0xbb2b38(0x219)]('success'),'errors':_0x27eb65[_0xbb2b38(0x219)](_0xbb2b38(0x252)),'role':_0x3df9ea,'profile':_0x2de053,'master_shop':_0x60d640,'customers':_0x5d0e2b,'sales':_0x28cbf7,'language':_0x1cf6ff});}catch(_0x5efa01){console[_0xbb2b38(0x220)](_0x5efa01);}}),router[a0_0x13ef01(0x271)](a0_0x13ef01(0x2d8),auth,async(_0x1f3173,_0x2e2e91)=>{var _0x20096e=a0_0x13ef01;try{const {username:_0x49e143,email:_0xb41246,role:_0x2ebe0d}=_0x1f3173[_0x20096e(0x2a9)],_0x4c0dd2=_0x1f3173[_0x20096e(0x2a9)],_0x466332=await profile[_0x20096e(0x25d)]({'email':_0x4c0dd2[_0x20096e(0x2d5)]}),_0x2fd2c9=await master_shop[_0x20096e(0x295)]();console[_0x20096e(0x220)](_0x20096e(0x234),_0x2fd2c9);const _0x4891d2=_0x1f3173[_0x20096e(0x218)]['id'];console[_0x20096e(0x220)](_0x4891d2);const _0x55e324=await sales['findById'](_0x4891d2);console[_0x20096e(0x220)](_0x20096e(0x1fa),_0x55e324);const _0x532748=await warehouse['aggregate']([{'$match':{'name':_0x20096e(0x2d6),'room':_0x20096e(0x2df)}},{'$unwind':_0x20096e(0x249)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x20096e(0x215)},'level':{'$first':_0x20096e(0x2e5)},'isle':{'$first':_0x20096e(0x226)},'pallet':{'$first':_0x20096e(0x210)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x20096e(0x2c0)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x20096e(0x220)](_0x20096e(0x2a0),_0x532748);const _0x3daa11=await product[_0x20096e(0x295)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x20096e(0x203),'name':_0x20096e(0x2d6),'warehouse_category':_0x20096e(0x270)}},{'$group':{'_id':'$name','name':{'$first':_0x20096e(0x2f4)}}},{'$sort':{'name':0x1}}]);var _0x3e5769=['Return\x20Rooms'];if(_0x2fd2c9[0x0]['language']==_0x20096e(0x240)){var _0x434d1a=users['English'];console[_0x20096e(0x220)](_0x434d1a);}else{if(_0x2fd2c9[0x0][_0x20096e(0x22b)]=='Hindi')var _0x434d1a=users['Hindi'];else{if(_0x2fd2c9[0x0][_0x20096e(0x22b)]==_0x20096e(0x214))var _0x434d1a=users[_0x20096e(0x214)];else{if(_0x2fd2c9[0x0][_0x20096e(0x22b)]==_0x20096e(0x2aa))var _0x434d1a=users[_0x20096e(0x2aa)];else{if(_0x2fd2c9[0x0]['language']==_0x20096e(0x235))var _0x434d1a=users[_0x20096e(0x235)];else{if(_0x2fd2c9[0x0][_0x20096e(0x22b)]==_0x20096e(0x241))var _0x434d1a=users[_0x20096e(0x2be)];else{if(_0x2fd2c9[0x0][_0x20096e(0x22b)]=='Chinese')var _0x434d1a=users[_0x20096e(0x2ac)];else{if(_0x2fd2c9[0x0]['language']==_0x20096e(0x1f6))var _0x434d1a=users[_0x20096e(0x28f)];}}}}}}}_0x2e2e91[_0x20096e(0x25b)](_0x20096e(0x24c),{'success':_0x1f3173[_0x20096e(0x219)]('success'),'errors':_0x1f3173['flash']('errors'),'role':_0x4c0dd2,'profile':_0x466332,'user':_0x55e324,'stock':_0x532748,'master_shop':_0x2fd2c9,'unit':_0x3daa11,'language':_0x434d1a,'warehouses':warehouse_data,'rooms':_0x3e5769});}catch(_0x196eb9){console[_0x20096e(0x220)](_0x196eb9),_0x2e2e91['status'](0xc8)[_0x20096e(0x250)]({'message':_0x196eb9[_0x20096e(0x2e8)]});}}),router[a0_0x13ef01(0x24e)](a0_0x13ef01(0x2d8),auth,async(_0x3e63fa,_0x1ceae4)=>{var _0x5f1a50=a0_0x13ef01;try{const {invoice:_0x3717ad,date:_0x28e27e,warehouse_name:_0x4ad591,product_name:_0x1a2fce,primary_code:_0x2c90c2,secondary_code:_0xcf8d4d,product_code:_0x22215c,sales_quantity:_0x45a1d9,stocks:_0x90d822,return_qty:_0x125074,Room_name:_0x49bb0e,to_warehouse_name:_0x7ae144,to_Roomname:_0x1fad50,to_Room_name:_0x2a8fd4,note:_0x379650,level:_0x4683ba,isle:_0x1019d4,pallet:_0xfac577}=_0x3e63fa[_0x5f1a50(0x2a4)];if(typeof _0x1a2fce==_0x5f1a50(0x21e))var _0x3d47dc=[_0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x275)]],_0x4c6609=[_0x3e63fa[_0x5f1a50(0x2a4)]['primary_code']],_0x6c753c=[_0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x2ca)]],_0x5ad6d2=[_0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x280)]],_0x24a66a=[_0x3e63fa['body'][_0x5f1a50(0x292)]],_0x57ff67=[_0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x216)]],_0x1a6368=[_0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x2c8)]],_0x178a7e=[_0x3e63fa[_0x5f1a50(0x2a4)]['bay']],_0x533843=[_0x3e63fa[_0x5f1a50(0x2a4)]['bin']],_0x46ffda=[_0x3e63fa['body'][_0x5f1a50(0x27c)]],_0x14f537=[_0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x244)]];else var _0x3d47dc=[..._0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x275)]],_0x4c6609=[..._0x3e63fa['body']['primary_code']],_0x6c753c=[..._0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x2ca)]],_0x5ad6d2=[..._0x3e63fa['body']['product_code']],_0x24a66a=[..._0x3e63fa[_0x5f1a50(0x2a4)]['sales_quantity']],_0x57ff67=[..._0x3e63fa['body'][_0x5f1a50(0x216)]],_0x1a6368=[..._0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x2c8)]],_0x178a7e=[..._0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x2b4)]],_0x533843=[..._0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x27b)]],_0x46ffda=[..._0x3e63fa['body'][_0x5f1a50(0x27c)]],_0x14f537=[..._0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x244)]];const _0x1393d3=_0x3d47dc['map'](_0x3e4b64=>{return _0x3e4b64={'product_name':_0x3e4b64};});_0x4c6609[_0x5f1a50(0x2a7)]((_0x228035,_0x4071eb)=>{var _0x12627f=_0x5f1a50;_0x1393d3[_0x4071eb][_0x12627f(0x282)]=_0x228035;}),_0x6c753c[_0x5f1a50(0x2a7)]((_0x30a518,_0x240bea)=>{var _0x41e9ec=_0x5f1a50;_0x1393d3[_0x240bea][_0x41e9ec(0x2ca)]=_0x30a518;}),_0x5ad6d2[_0x5f1a50(0x2a7)]((_0x4210a6,_0x272c1a)=>{var _0x417707=_0x5f1a50;_0x1393d3[_0x272c1a][_0x417707(0x280)]=_0x4210a6;}),_0x24a66a['forEach']((_0x3a56ed,_0x3a8281)=>{var _0x477a7e=_0x5f1a50;_0x1393d3[_0x3a8281][_0x477a7e(0x26b)]=_0x3a56ed;}),_0x57ff67[_0x5f1a50(0x2a7)]((_0xb1d427,_0x22e0b9)=>{_0x1393d3[_0x22e0b9]['stock']=_0xb1d427;}),_0x1a6368[_0x5f1a50(0x2a7)]((_0x1a04fd,_0x5738a1)=>{var _0x506ca8=_0x5f1a50;_0x1393d3[_0x5738a1][_0x506ca8(0x2c8)]=_0x1a04fd;}),_0x178a7e[_0x5f1a50(0x2a7)]((_0x40f38b,_0x2fcde6)=>{var _0x14a0ce=_0x5f1a50;_0x1393d3[_0x2fcde6][_0x14a0ce(0x2b4)]=_0x40f38b;}),_0x533843['forEach']((_0x44812c,_0x5b9455)=>{_0x1393d3[_0x5b9455]['bin']=_0x44812c;}),_0x46ffda[_0x5f1a50(0x2a7)]((_0x436ddc,_0x370e48)=>{_0x1393d3[_0x370e48]['type']=_0x436ddc;}),_0x14f537[_0x5f1a50(0x2a7)]((_0x456093,_0x4557ef)=>{var _0x68d81b=_0x5f1a50;_0x1393d3[_0x4557ef][_0x68d81b(0x244)]=_0x456093;});var _0x3c4735=0x0;_0x1393d3[_0x5f1a50(0x2a7)](_0x2bfe10=>{var _0x56073e=_0x5f1a50;console[_0x56073e(0x220)](_0x56073e(0x2bb),_0x2bfe10),(parseInt(_0x2bfe10['sale_qty'])<parseInt(_0x2bfe10[_0x56073e(0x2c8)])||parseInt(_0x2bfe10[_0x56073e(0x213)])<parseInt(_0x2bfe10[_0x56073e(0x2c8)])&&parseInt(_0x2bfe10[_0x56073e(0x26b)])>parseInt(_0x2bfe10['return_qty'])||parseInt(_0x2bfe10['return_qty'])==0x0)&&_0x3c4735++;});if(_0x3c4735!=0x0)return _0x3e63fa[_0x5f1a50(0x219)]('errors',_0x5f1a50(0x263)),_0x1ceae4['redirect'](_0x5f1a50(0x20d));const _0x2228ed=await sales['findOne']({'invoice':_0x3717ad});console['log'](_0x2228ed),_0x2228ed[_0x5f1a50(0x233)]='True';const _0x2f694b=await _0x2228ed['save'](),_0x310977=new sales_return({'invoice':_0x3717ad,'customer':_0x3e63fa[_0x5f1a50(0x2a4)][_0x5f1a50(0x277)],'date':_0x28e27e,'warehouse_name':_0x4ad591,'room':_0x49bb0e,'ToWarehouse':_0x7ae144,'ToRoom':_0x2a8fd4,'return_sale':_0x1393d3,'note':_0x379650}),_0x4f62ce=await _0x310977['save']();console[_0x5f1a50(0x220)](_0x310977);const _0x37fbb8=await sales_return[_0x5f1a50(0x25d)]({'invoice':_0x3717ad}),_0x4c58bf=await warehouse[_0x5f1a50(0x25d)]({'name':_0x7ae144,'room':_0x2a8fd4});_0x37fbb8[_0x5f1a50(0x24c)][_0x5f1a50(0x2a7)](_0xb1c250=>{var _0x435064=_0x5f1a50,_0x5db6f4=0x0;const _0x1e6ea4=_0x4c58bf[_0x435064(0x230)][_0x435064(0x259)](_0x4a73aa=>{var _0x575b36=_0x435064;_0x4a73aa[_0x575b36(0x275)]==_0xb1c250[_0x575b36(0x275)]&&_0x4a73aa[_0x575b36(0x244)]==_0xb1c250[_0x575b36(0x244)]&&_0x4a73aa[_0x575b36(0x1f9)]==_0xb1c250[_0x575b36(0x1f9)]&&_0x4a73aa['bin']==_0xb1c250[_0x575b36(0x27b)]&&_0x4a73aa[_0x575b36(0x2b4)]==_0xb1c250[_0x575b36(0x2b4)]&&(_0x4a73aa[_0x575b36(0x2ea)]=parseInt(_0x4a73aa[_0x575b36(0x2ea)])+parseInt(_0xb1c250[_0x575b36(0x2c8)]),_0x5db6f4++);});_0x5db6f4=='0'&&(_0x4c58bf['product_details']=_0x4c58bf['product_details'][_0x435064(0x28a)]({'product_name':_0xb1c250[_0x435064(0x275)],'product_stock':_0xb1c250[_0x435064(0x2c8)],'primary_code':_0xb1c250[_0x435064(0x282)],'secondary_code':_0xb1c250[_0x435064(0x2ca)],'product_code':_0xb1c250[_0x435064(0x280)],'bay':_0xb1c250[_0x435064(0x2b4)],'bin':_0xb1c250[_0x435064(0x27b)],'type':_0xb1c250['type'],'floorlevel':_0xb1c250[_0x435064(0x244)]})),console[_0x435064(0x220)]('final',_0x4c58bf);}),await _0x4c58bf[_0x5f1a50(0x2dd)](),console[_0x5f1a50(0x220)](_0x3e63fa[_0x5f1a50(0x2a4)]);const _0x1fde0d=new c_payment_data({'invoice':_0x3717ad,'customer':_0x3e63fa['body'][_0x5f1a50(0x277)],'reason':'Sale\x20Return'});await _0x1fde0d[_0x5f1a50(0x2dd)]();const _0x539c68=await master_shop[_0x5f1a50(0x295)]();console[_0x5f1a50(0x220)](_0x5f1a50(0x2b5),_0x539c68[0x0][_0x5f1a50(0x2de)]);const _0x102abc=await email_settings[_0x5f1a50(0x25d)](),_0x5a2ce8=await customer[_0x5f1a50(0x25d)]({'name':_0x3e63fa['body'][_0x5f1a50(0x277)]});console[_0x5f1a50(0x220)]('customer_data',_0x5a2ce8);_0x539c68[0x0]['currency_placement']==0x1?(right_currency=_0x539c68[0x0][_0x5f1a50(0x2ef)],left_currency=''):(right_currency='',left_currency=_0x539c68[0x0][_0x5f1a50(0x2ef)]);var _0x174773=_0x3d47dc,_0x14df5a=_0x1a6368,_0x22d112='',_0x1e18bc;for(_0x1e18bc in _0x174773){_0x22d112+=_0x5f1a50(0x23f)+_0x5f1a50(0x24f)+_0x174773[_0x1e18bc]+_0x5f1a50(0x2f9)+_0x5f1a50(0x24f)+_0x14df5a[_0x1e18bc]+'</td>'+'</tr>';}console[_0x5f1a50(0x220)]('product_list',_0x22d112);let _0x2886db=nodemailer['createTransport']({'service':_0x5f1a50(0x29b),'auth':{'user':_0x102abc['email'],'pass':_0x102abc[_0x5f1a50(0x236)]}}),_0x5dbf32={'from':_0x102abc[_0x5f1a50(0x2d5)],'to':_0x5a2ce8[_0x5f1a50(0x2d5)],'subject':_0x5f1a50(0x2e1),'attachments':[{'filename':_0x5f1a50(0x29d),'path':__dirname+_0x5f1a50(0x200)+_0x5f1a50(0x2f0)+_0x539c68[0x0][_0x5f1a50(0x2de)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x5f1a50(0x28e)+_0x5f1a50(0x2cc)+_0x5f1a50(0x2c2)+_0x5f1a50(0x209)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5f1a50(0x2ec)+'<div>'+_0x5f1a50(0x2db)+_0x539c68[0x0][_0x5f1a50(0x1f4)]+'\x20</h2>'+_0x5f1a50(0x2ec)+'</div>'+_0x5f1a50(0x20c)+'<div>'+_0x5f1a50(0x22f)+_0x5f1a50(0x2f1)+_0x3717ad+'\x20'+_0x5f1a50(0x265)+_0x5f1a50(0x212)+_0x28e27e+'\x20'+'</span>'+_0x5f1a50(0x288)+_0x5f1a50(0x2ec)+_0x5f1a50(0x2e0)+_0x5f1a50(0x239)+_0x5f1a50(0x23f)+_0x5f1a50(0x2d7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x5f1a50(0x20a)+_0x5f1a50(0x296)+'</tr>'+_0x5f1a50(0x224)+_0x5f1a50(0x243)+'\x20'+_0x22d112+'\x20'+_0x5f1a50(0x2ee)+_0x5f1a50(0x231)+_0x5f1a50(0x2c2)+'<strong>\x20Regards\x20</strong>'+_0x5f1a50(0x276)+_0x539c68[0x0][_0x5f1a50(0x1f4)]+_0x5f1a50(0x288)+_0x5f1a50(0x2ec)+_0x5f1a50(0x2ec)+'</body></html>'};_0x2886db['sendMail'](_0x5dbf32,function(_0x10ff06,_0xf98c55){var _0x5ddd0e=_0x5f1a50;_0x10ff06?(console[_0x5ddd0e(0x220)](_0x10ff06),console[_0x5ddd0e(0x220)](_0x5ddd0e(0x2c4))):console[_0x5ddd0e(0x220)](_0x5ddd0e(0x237));}),_0x3e63fa['flash'](_0x5f1a50(0x26a),_0x5f1a50(0x27e)),_0x1ceae4[_0x5f1a50(0x27d)](_0x5f1a50(0x255));}catch(_0x1ab11a){console[_0x5f1a50(0x220)](_0x1ab11a),_0x1ceae4[_0x5f1a50(0x2d2)](0xc8)[_0x5f1a50(0x250)]({'message1':_0x1ab11a['message']});}}),router['get'](a0_0x13ef01(0x2ae),auth,async(_0x29af41,_0xea330c)=>{var _0x8c6285=a0_0x13ef01;try{const {username:_0x11dead,email:_0x3c148d,role:_0x5bf961}=_0x29af41[_0x8c6285(0x2a9)],_0x478f2b=_0x29af41[_0x8c6285(0x2a9)],_0x69966=await profile[_0x8c6285(0x25d)]({'email':_0x478f2b[_0x8c6285(0x2d5)]}),_0x2a7f4a=await master_shop[_0x8c6285(0x295)]();console[_0x8c6285(0x220)]('barcode\x20Product\x20master',_0x2a7f4a);const _0x59c6c6=_0x29af41[_0x8c6285(0x218)]['id'],_0x340c00=await sales['findById'](_0x59c6c6);console[_0x8c6285(0x220)]('barcode\x20user_id',_0x340c00);if(_0x2a7f4a[0x0][_0x8c6285(0x22b)]==_0x8c6285(0x240))var _0x3d6d01=users['English'];else{if(_0x2a7f4a[0x0][_0x8c6285(0x22b)]=='Hindi')var _0x3d6d01=users[_0x8c6285(0x2bc)];else{if(_0x2a7f4a[0x0][_0x8c6285(0x22b)]==_0x8c6285(0x214))var _0x3d6d01=users['German'];else{if(_0x2a7f4a[0x0]['language']=='Spanish')var _0x3d6d01=users[_0x8c6285(0x2aa)];else{if(_0x2a7f4a[0x0][_0x8c6285(0x22b)]==_0x8c6285(0x235))var _0x3d6d01=users[_0x8c6285(0x235)];else{if(_0x2a7f4a[0x0][_0x8c6285(0x22b)]==_0x8c6285(0x241))var _0x3d6d01=users['Portuguese'];else{if(_0x2a7f4a[0x0]['language']=='Chinese')var _0x3d6d01=users['Chinese'];else{if(_0x2a7f4a[0x0]['language']==_0x8c6285(0x1f6))var _0x3d6d01=users[_0x8c6285(0x28f)];}}}}}}}_0xea330c[_0x8c6285(0x25b)](_0x8c6285(0x2a3),{'success':_0x29af41[_0x8c6285(0x219)]('success'),'errors':_0x29af41['flash'](_0x8c6285(0x252)),'role':_0x478f2b,'profile':_0x69966,'alldata':_0x340c00,'master_shop':_0x2a7f4a,'language':_0x3d6d01});}catch(_0x41ac33){console[_0x8c6285(0x220)](_0x41ac33);}}),router[a0_0x13ef01(0x24e)](a0_0x13ef01(0x290),async(_0xc0347e,_0x11dff6)=>{var _0x394e1f=a0_0x13ef01;const {product_code:_0x593349,warehouse_name:_0x5cfc63,rooms_data:_0x50de43,Roomslist:_0x6c29e8}=_0xc0347e[_0x394e1f(0x2a4)],_0x146f85=_0x6c29e8[_0x394e1f(0x253)](','),_0x48ef16=[];async function _0xd2d877(_0x3f31fa){var _0x3b3466=_0x394e1f;const _0x6175f=await warehouse[_0x3b3466(0x2c7)]([{'$match':{'name':_0x5cfc63,'room':_0x3f31fa}},{'$unwind':_0x3b3466(0x249)},{'$match':{'product_details.primary_code':_0x593349}},{'$group':{'_id':_0x3b3466(0x29f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3b3466(0x215)},'primary_code':{'$first':_0x3b3466(0x2eb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3b3466(0x274)},'level':{'$first':_0x3b3466(0x26f)},'isle':{'$first':_0x3b3466(0x23a)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x3b3466(0x273)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x3b3466(0x20f)},'storage':{'$first':_0x3b3466(0x2b1)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3b3466(0x21f)},'production_date':{'$first':_0x3b3466(0x2e9)},'maxPerUnit':{'$first':_0x3b3466(0x223)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x3b3466(0x2d9)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x3b3466(0x247)},'invoice':{'$first':_0x3b3466(0x2ba)},'actual_qty':{'$first':_0x3b3466(0x2d0)},'actual_uom':{'$first':_0x3b3466(0x22a)}}}]),_0x28c7de=await warehouse[_0x3b3466(0x2c7)]([{'$match':{'name':_0x5cfc63,'room':_0x3f31fa}},{'$unwind':_0x3b3466(0x249)},{'$match':{'product_details.secondary_code':_0x593349}},{'$group':{'_id':_0x3b3466(0x29f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3b3466(0x215)},'primary_code':{'$first':_0x3b3466(0x2eb)},'secondary_code':{'$first':_0x3b3466(0x2c0)},'product_code':{'$first':_0x3b3466(0x274)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x3b3466(0x228)},'pallet':{'$first':_0x3b3466(0x273)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x3b3466(0x20f)},'storage':{'$first':_0x3b3466(0x2b1)},'rack':{'$first':_0x3b3466(0x2c9)},'expiry_date':{'$first':_0x3b3466(0x21f)},'production_date':{'$first':_0x3b3466(0x2e9)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x3b3466(0x1f5)},'product_cat':{'$first':_0x3b3466(0x2d9)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x3b3466(0x2ba)}}}]);if(_0x6175f[_0x3b3466(0x2a6)]>0x0)_0x48ef16['push'](_0x6175f);else _0x28c7de[_0x3b3466(0x2a6)]>0x0&&_0x48ef16[_0x3b3466(0x294)](_0x28c7de);}const _0x48d544=_0x146f85[_0x394e1f(0x259)](_0x45c247=>_0xd2d877(_0x45c247));await Promise[_0x394e1f(0x242)](_0x48d544),_0x11dff6[_0x394e1f(0x250)](_0x48ef16);}),module['exports']=router;