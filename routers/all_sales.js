var a0_0x598093=a0_0x5de4;function a0_0x5de4(_0x47829f,_0x1b31f1){var _0x2356dd=a0_0x2356();return a0_0x5de4=function(_0x5de4ab,_0x224082){_0x5de4ab=_0x5de4ab-0x114;var _0x5f5729=_0x2356dd[_0x5de4ab];return _0x5f5729;},a0_0x5de4(_0x47829f,_0x1b31f1);}(function(_0x144a98,_0x5e71fb){var _0x12ef1e=a0_0x5de4,_0x5daf8e=_0x144a98();while(!![]){try{var _0x333511=parseInt(_0x12ef1e(0x14d))/0x1*(-parseInt(_0x12ef1e(0x1a2))/0x2)+-parseInt(_0x12ef1e(0x119))/0x3*(-parseInt(_0x12ef1e(0x206))/0x4)+parseInt(_0x12ef1e(0x216))/0x5*(-parseInt(_0x12ef1e(0x143))/0x6)+parseInt(_0x12ef1e(0x18d))/0x7*(-parseInt(_0x12ef1e(0x117))/0x8)+-parseInt(_0x12ef1e(0x15b))/0x9+parseInt(_0x12ef1e(0x222))/0xa*(parseInt(_0x12ef1e(0x220))/0xb)+-parseInt(_0x12ef1e(0x1f4))/0xc;if(_0x333511===_0x5e71fb)break;else _0x5daf8e['push'](_0x5daf8e['shift']());}catch(_0x4d6559){_0x5daf8e['push'](_0x5daf8e['shift']());}}}(a0_0x2356,0x64283));const express=require(a0_0x598093(0x1d9)),app=express(),router=express[a0_0x598093(0x16b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x598093(0x175)),auth=require(a0_0x598093(0x176)),nodemailer=require(a0_0x598093(0x1b5)),users=require('../public/language/languages.json');router['get'](a0_0x598093(0x1ac),auth,async(_0x855581,_0x163b37)=>{var _0x45ba5e=a0_0x598093;try{const {username:_0x3fa88f,email:_0x1b52e1,role:_0x573d86}=_0x855581[_0x45ba5e(0x181)],_0x5b191b=_0x855581[_0x45ba5e(0x181)],_0x111718=await profile[_0x45ba5e(0x1c4)]({'email':_0x5b191b[_0x45ba5e(0x21a)]}),_0x135278=await master_shop[_0x45ba5e(0x1a1)]();let _0xf9cfab;if(_0x5b191b[_0x45ba5e(0x1a3)]==_0x45ba5e(0x162)){const _0x2782b3=await staff[_0x45ba5e(0x1c4)]({'email':_0x5b191b['email']});_0xf9cfab=await sales[_0x45ba5e(0x212)]([{'$lookup':{'from':_0x45ba5e(0x1e5),'localField':_0x45ba5e(0x180),'foreignField':_0x45ba5e(0x1bf),'as':_0x45ba5e(0x1db)}},{'$unwind':'$customers_docs'},{'$unwind':_0x45ba5e(0x1c3)},{'$group':{'_id':_0x45ba5e(0x1c9),'invoice':{'$first':_0x45ba5e(0x1fe)},'customers':{'$first':_0x45ba5e(0x12b)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x45ba5e(0x1c3)},'note':{'$first':'$note'},'return_data':{'$first':_0x45ba5e(0x13e)},'customers_docs':{'$first':_0x45ba5e(0x1c2)},'total_saleproduct_quantity':{'$sum':_0x45ba5e(0x20b)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x45ba5e(0x203)},'type':{'$addToSet':_0x45ba5e(0x202)},'pallet':{'$addToSet':_0x45ba5e(0x188)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x45ba5e(0x196)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0xf9cfab=await sales[_0x45ba5e(0x212)]([{'$lookup':{'from':'customers','localField':_0x45ba5e(0x180),'foreignField':_0x45ba5e(0x1bf),'as':'customers_docs'}},{'$unwind':_0x45ba5e(0x1c2)},{'$unwind':_0x45ba5e(0x1c3)},{'$group':{'_id':_0x45ba5e(0x1c9),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x45ba5e(0x12b)},'date':{'$first':_0x45ba5e(0x20f)},'warehouse_name':{'$first':_0x45ba5e(0x198)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x45ba5e(0x21e)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x45ba5e(0x1c2)},'total_saleproduct_quantity':{'$sum':_0x45ba5e(0x20b)},'level':{'$addToSet':_0x45ba5e(0x21f)},'isle':{'$addToSet':_0x45ba5e(0x203)},'type':{'$addToSet':_0x45ba5e(0x202)},'pallet':{'$addToSet':_0x45ba5e(0x188)},'finalize':{'$first':_0x45ba5e(0x134)},'isAllowEdit':{'$first':_0x45ba5e(0x196)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x45ba5e(0x172)](_0x45ba5e(0x156),_0xf9cfab);if(_0x135278[0x0][_0x45ba5e(0x187)]==_0x45ba5e(0x1bd)){var _0x532837=users[_0x45ba5e(0x15d)];console[_0x45ba5e(0x172)](_0x532837);}else{if(_0x135278[0x0]['language']==_0x45ba5e(0x1c0))var _0x532837=users[_0x45ba5e(0x1c0)];else{if(_0x135278[0x0][_0x45ba5e(0x187)]==_0x45ba5e(0x145))var _0x532837=users[_0x45ba5e(0x145)];else{if(_0x135278[0x0][_0x45ba5e(0x187)]==_0x45ba5e(0x141))var _0x532837=users[_0x45ba5e(0x141)];else{if(_0x135278[0x0]['language']=='French')var _0x532837=users[_0x45ba5e(0x19c)];else{if(_0x135278[0x0][_0x45ba5e(0x187)]==_0x45ba5e(0x159))var _0x532837=users[_0x45ba5e(0x15f)];else{if(_0x135278[0x0][_0x45ba5e(0x187)]=='Chinese')var _0x532837=users[_0x45ba5e(0x1be)];else{if(_0x135278[0x0]['language']==_0x45ba5e(0x158))var _0x532837=users[_0x45ba5e(0x1e9)];}}}}}}}_0x163b37[_0x45ba5e(0x193)](_0x45ba5e(0x148),{'success':_0x855581[_0x45ba5e(0x13b)](_0x45ba5e(0x132)),'errors':_0x855581[_0x45ba5e(0x13b)]('errors'),'sales':_0xf9cfab,'profile':_0x111718,'role':_0x5b191b,'master_shop':_0x135278,'language':_0x532837});}catch(_0x140c27){console['log'](_0x140c27);}});function a0_0x2356(){var _0x3803fb=['user','warehouse_name','$product_details.actual_qty','$product_details.batch_code','</div>','$product_details.isle','language','$sale_product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','then','Return\x20Goods','primary_unit','4683tosPIl','quantity_notConverted','stocks','types','stock_data','add\x20post','render','</td>','False','$isAllowEdit','length','$warehouse_name','password','actual_qty','unit','French','findById','$product_details.maxPerUnit','<strong>\x20Regards\x20</strong>','production_date','find','4658FRAEHJ','role','$product_details.production_date','date','$product_details.bay','bay','$product_details.primary_code','prod_cat','push','customer_data','/view','</body></html>','barcode\x20user_id','product_name','Level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','warehouse','type','</h5>','nodemailer','$product_details.product_cat','prod_code','$product_details.invoice','sales_quantity','storage','Ambient','finalize','English\x20(US)','Chinese','name','Hindi','</tr>','$customers_docs','$sale_product','findOne','</thead>','primary_code','floorlevel','Sale\x20Return','$_id','delivery_date','product_stock','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','get','master','post','barcode\x20Product\x20master','forEach','$product_details.unit','site_title','due_amount','sendMail','$product_details.pallet','$product_details','logo','express','Enabled','customers_docs','concat','/invoice/:id','Received\x20Payment\x20For\x20Sale','invoice','Error\x20Occurs','An\x20error\x20occurred.','createTransport','</tbody>','<tbody\x20style=\x22text-align:\x20center;\x22>','customers','Receiving\x20Area','redirect','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Arabic','quantity','expiry_date','\x20Order\x20Date\x20:\x20','/view/return_sales/:id','sales\x20item\x20return\x20successfull','<h5\x20style=\x22text-align:\x20left;\x22>','/give_payment/:id','Email\x20sent\x20successfully','secondary_code','actual_uom','366804SXBPfQ','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.bin','secondary_unit','isAllowEdit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.storage','$product_details.secondary_code','$product','$invoice','sale_qty','$product_details.floorlevel','<tr>','$sale_product.type','$sale_product.bin','\x20</h2>','$product_details.product_code','19564lrmCvP','rack','RoomAssigned','requested_qty','batch_code','$sale_product.quantity','body','Floor','_id','$date','save','padStart','aggregate','/all_sales/view','getMonth','level','1845KxDIqg','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','port','$product_details.secondary_unit','email','return_sale','product_list','filter','$note','$sale_product.bay','25157GtHIRd','$product_details.product_stock','3140pTVJRA','currency','return_qty','/preview/:id','product_code','status','896QHDgPL','all','381LgcOGd','params','/../public','<div>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','message','host','carton','prod_invoice','OUT-','/view/add_sales/:id','errors','Sales\x20Update\x20successfully','Raw\x20Materials','received_amount','exports','Logo.png','sale_product','$customer','$room','\x20Order\x20Number\x20:\x20','/all_sales/preview/','stock','</table>','error','success','foreach\x20newproduct','$finalize','$product_details.product_name','edit_sales','slice','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','final','return_data','flash','/barcode/:id','/upload/','$return_data','user_id','Shelves','Spanish','maxperunit','6126yoHlIO','getFullYear','German','room','</span>','all_sales','json','bin','sales_invoice','/view/add_sales','87oiIwAs','room_name','$product_details._id','Sales\x20Add\x20successfully','<html><head><title></title>','/barcode_scanner','product_details','max_per_unit','<hr\x20class=\x22my-3\x22>','sales\x20all_data','image','Arabic\x20(ae)','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','2197485ueOZKe','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','English','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Portuguese','map','all_sales_barcode','staff','Sales\x20Mail','Enclosed','abs','string','back','/view/:id','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Router','/view/add_sale/product','delivery_code','$name','Return\x20Rooms','amount','True','log','random','split','../models/all_models','../middleware/auth','<span\x20style=\x22float:\x20right;\x22>','catch','gmail','$product.product_name','$product_details.rack','<h2>\x20','$product_details.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','RMSEmail','customer'];a0_0x2356=function(){return _0x3803fb;};return a0_0x2356();}async function getRandom8DigitNumber(){var _0x848412=a0_0x598093;const _0x59c7a5=0x989680,_0x352b92=0x5f5e0ff,_0x350e89=Math['floor'](Math[_0x848412(0x173)]()*(_0x352b92-_0x59c7a5+0x1))+_0x59c7a5;var _0x42c0dc;const _0x5358ca=await sales[_0x848412(0x1c4)]({'invoice':_0x848412(0x122)+_0x350e89});return _0x5358ca&&_0x5358ca[_0x848412(0x197)]>0x0?_0x42c0dc=_0x848412(0x122)+_0x350e89:_0x42c0dc='OUT-'+_0x350e89,_0x42c0dc;}router[a0_0x598093(0x1cd)](a0_0x598093(0x14c),auth,async(_0x5d1a34,_0x1c14bf)=>{var _0x2bca62=a0_0x598093;try{const {username:_0x55323c,email:_0x1d06ed,role:_0x20dcad}=_0x5d1a34[_0x2bca62(0x181)],_0x3ee612=_0x5d1a34[_0x2bca62(0x181)],_0x365e07=await profile[_0x2bca62(0x1c4)]({'email':_0x3ee612['email']}),_0x285f5a=await master_shop['find'](),_0x56238d=await customer['find']({});let _0x3ecf2a;if(_0x3ee612[_0x2bca62(0x1a3)]==_0x2bca62(0x162)){const _0x1bbbb7=await staff[_0x2bca62(0x1c4)]({'email':_0x3ee612[_0x2bca62(0x21a)]});_0x3ecf2a=await warehouse[_0x2bca62(0x212)]([{'$match':{'status':_0x2bca62(0x1da),'name':_0x1bbbb7[_0x2bca62(0x1b2)],'warehouse_category':_0x2bca62(0x126),'name':{'$ne':_0x2bca62(0x18b)}}},{'$group':{'_id':_0x2bca62(0x16e),'name':{'$first':_0x2bca62(0x16e)}}},{'$sort':{'name':0x1}}]);}else _0x3ecf2a=await warehouse['aggregate']([{'$match':{'status':_0x2bca62(0x1da),'warehouse_category':_0x2bca62(0x126),'name':{'$ne':_0x2bca62(0x18b)}}},{'$group':{'_id':_0x2bca62(0x16e),'name':{'$first':_0x2bca62(0x16e)}}},{'$sort':{'name':0x1}}]);const _0x31be90=await product[_0x2bca62(0x1a1)]({});var _0x5f5aeb=[_0x2bca62(0x1bb),_0x2bca62(0x164)];const _0x17754e=await sales[_0x2bca62(0x1a1)]({}),_0x4ad610=_0x17754e['length']+0x1,_0x45486e=_0x2bca62(0x122)+_0x4ad610['toString']()[_0x2bca62(0x211)](0x5,'0');if(_0x285f5a[0x0][_0x2bca62(0x187)]==_0x2bca62(0x1bd)){var _0x4a75b1=users['English'];console[_0x2bca62(0x172)](_0x4a75b1);}else{if(_0x285f5a[0x0][_0x2bca62(0x187)]==_0x2bca62(0x1c0))var _0x4a75b1=users[_0x2bca62(0x1c0)];else{if(_0x285f5a[0x0]['language']==_0x2bca62(0x145))var _0x4a75b1=users[_0x2bca62(0x145)];else{if(_0x285f5a[0x0][_0x2bca62(0x187)]=='Spanish')var _0x4a75b1=users[_0x2bca62(0x141)];else{if(_0x285f5a[0x0][_0x2bca62(0x187)]==_0x2bca62(0x19c))var _0x4a75b1=users[_0x2bca62(0x19c)];else{if(_0x285f5a[0x0]['language']=='Portuguese\x20(BR)')var _0x4a75b1=users[_0x2bca62(0x15f)];else{if(_0x285f5a[0x0][_0x2bca62(0x187)]=='Chinese')var _0x4a75b1=users[_0x2bca62(0x1be)];else{if(_0x285f5a[0x0][_0x2bca62(0x187)]==_0x2bca62(0x158))var _0x4a75b1=users[_0x2bca62(0x1e9)];}}}}}}}const _0x41d874=getRandom8DigitNumber();_0x41d874[_0x2bca62(0x18a)](_0xe2ab12=>{var _0x2882d4=_0x2bca62;_0x1c14bf[_0x2882d4(0x193)]('add_sales',{'success':_0x5d1a34[_0x2882d4(0x13b)](_0x2882d4(0x132)),'errors':_0x5d1a34['flash']('errors'),'role':_0x3ee612,'profile':_0x365e07,'customer':_0x56238d,'warehouse':_0x3ecf2a,'product':_0x31be90,'invoice':_0xe2ab12,'master_shop':_0x285f5a,'language':_0x4a75b1,'rooms_data':_0x5f5aeb});})['catch'](_0x132990=>{var _0x50ee8b=_0x2bca62;_0x5d1a34[_0x50ee8b(0x13b)](_0x50ee8b(0x124),_0x50ee8b(0x1e8)),_0x1c14bf[_0x50ee8b(0x1e7)](_0x50ee8b(0x213));});}catch(_0x7d8a1e){console[_0x2bca62(0x172)](_0x7d8a1e);}}),router[a0_0x598093(0x1cd)](a0_0x598093(0x123),auth,async(_0x53e804,_0x4e2a96)=>{var _0x5e810d=a0_0x598093;try{const _0x4a51ef=_0x53e804[_0x5e810d(0x11a)]['id'];console[_0x5e810d(0x172)](_0x4a51ef);const _0x3e4a0a=await product['find'](),_0x3be367=await purchases[_0x5e810d(0x212)]([{'$match':{'warehouse_name':_0x4a51ef}},{'$unwind':_0x5e810d(0x1fd)},{'$group':{'_id':_0x5e810d(0x17a)}}]);console[_0x5e810d(0x172)]('purchases_data',_0x3be367),_0x4e2a96[_0x5e810d(0x116)](0xc8)[_0x5e810d(0x149)]({'purchases_data':_0x3be367,'product_data':_0x3e4a0a});}catch(_0x32d568){console['log'](_0x32d568);}}),router[a0_0x598093(0x1cf)](a0_0x598093(0x16c),auth,async(_0x4d7047,_0x1bfe40)=>{var _0x30032d=a0_0x598093;try{const {warehouse_data:_0x33ea12,product_data:_0x1da266}=_0x4d7047[_0x30032d(0x20c)];console[_0x30032d(0x172)](_0x4d7047[_0x30032d(0x20c)]['product_data']);;const _0xa5a47b=await master_shop[_0x30032d(0x1a1)]();console['log'](_0x30032d(0x1ce),_0xa5a47b);const _0x5d5cac=await product[_0x30032d(0x1c4)]({'name':_0x1da266});console['log']('product',_0x5d5cac);const _0x54fa0b=await warehouse[_0x30032d(0x212)]([{'$match':{'name':_0x33ea12}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x1da266}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x30032d(0x221)}}}]);console[_0x30032d(0x172)](_0x30032d(0x191),_0x54fa0b),_0x1bfe40[_0x30032d(0x116)](0xc8)[_0x30032d(0x149)]({'master':_0xa5a47b,'new_product':_0x5d5cac,'stock_data':_0x54fa0b});}catch(_0x11dcea){console[_0x30032d(0x172)](_0x11dcea);}}),router[a0_0x598093(0x1cf)](a0_0x598093(0x14c),auth,async(_0x4bc81b,_0x25f79e)=>{var _0xdc257e=a0_0x598093;try{const {invoice:_0x441cee,date:_0x51a1a2,warehouse_name:_0x52d409,product_name:_0x3cd474,stock:_0x21aa22,quantity:_0x58237a,note:_0x3ecce1,room:_0x345cc4,primary_code:_0xce2329,secondary_code:_0x2ff17e,prod_code:_0xefb1ae,level:_0x4f7440,isle:_0xd32eb1,pallet:_0x4d6ee9,batch_code:_0x1eb8d1,SCRN:_0x5688c6,expiry_date:_0x46de2e}=_0x4bc81b[_0xdc257e(0x20c)];if(typeof _0x3cd474==_0xdc257e(0x166))var _0x420e2e=[_0x4bc81b[_0xdc257e(0x20c)]['product_name']],_0x3bb1ef=[_0x4bc81b['body'][_0xdc257e(0x12f)]],_0x3cd512=[_0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x120)]],_0xcc8d60=[_0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x1c6)]],_0x552a5a=[_0x4bc81b['body']['secondary_code']],_0x1be38c=[_0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x1b7)]],_0x1a501a=[_0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x215)]],_0x236190=[_0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x18c)]],_0x1b41dd=[_0x4bc81b['body'][_0xdc257e(0x1f8)]],_0x40369e=[_0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x20a)]],_0x3ce376=[_0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x1eb)]],_0x4dd24d=[_0x4bc81b['body'][_0xdc257e(0x154)]],_0x3ddc0e=[_0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x1a0)]],_0x1f7048=[_0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x209)]],_0x5cd779=[_0x4bc81b['body'][_0xdc257e(0x1ca)]],_0x44deb2=[_0x4bc81b[_0xdc257e(0x20c)]['delivery_code']],_0x3ad994=[_0x4bc81b['body']['prod_cat']],_0x18c001=[_0x4bc81b[_0xdc257e(0x20c)]['quantity']],_0x16805d=[_0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x208)]],_0x17abca=[_0x4bc81b['body'][_0xdc257e(0x121)]],_0x177925=[_0x4bc81b[_0xdc257e(0x20c)]['actual_qty']],_0x11ef0e=[_0x4bc81b['body'][_0xdc257e(0x1f3)]];else var _0x420e2e=[..._0x4bc81b['body'][_0xdc257e(0x1af)]],_0x3bb1ef=[..._0x4bc81b['body'][_0xdc257e(0x12f)]],_0x3cd512=[..._0x4bc81b['body'][_0xdc257e(0x120)]],_0xcc8d60=[..._0x4bc81b['body']['primary_code']],_0x552a5a=[..._0x4bc81b[_0xdc257e(0x20c)]['secondary_code']],_0x1be38c=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x1b7)]],_0x1a501a=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x215)]],_0x236190=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x18c)]],_0x1b41dd=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x1f8)]],_0x40369e=[..._0x4bc81b['body'][_0xdc257e(0x20a)]],_0x3ce376=[..._0x4bc81b['body'][_0xdc257e(0x1eb)]],_0x4dd24d=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x154)]],_0x3ddc0e=[..._0x4bc81b['body'][_0xdc257e(0x1a0)]],_0x1f7048=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x209)]],_0x5cd779=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x1ca)]],_0x44deb2=[..._0x4bc81b['body'][_0xdc257e(0x16d)]],_0x3ad994=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x1a9)]],_0x18c001=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x1ea)]],_0x16805d=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x208)]],_0x17abca=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x121)]],_0x177925=[..._0x4bc81b[_0xdc257e(0x20c)]['actual_qty']],_0x11ef0e=[..._0x4bc81b[_0xdc257e(0x20c)][_0xdc257e(0x1f3)]];const _0x50f71b=_0x420e2e['map'](_0x359f30=>{return _0x359f30={'product_name':_0x359f30};});_0x3bb1ef[_0xdc257e(0x1d1)]((_0xbdd041,_0x656ad4)=>{var _0x1d9f1d=_0xdc257e;_0x50f71b[_0x656ad4][_0x1d9f1d(0x12f)]=Math[_0x1d9f1d(0x165)](_0xbdd041);}),_0x177925[_0xdc257e(0x1d1)]((_0x1fce3d,_0x51ac9e)=>{var _0x4fe53e=_0xdc257e;_0x50f71b[_0x51ac9e][_0x4fe53e(0x19a)]=Math[_0x4fe53e(0x165)](_0x1fce3d);}),_0x11ef0e[_0xdc257e(0x1d1)]((_0x3aec99,_0x52ef5f)=>{_0x50f71b[_0x52ef5f]['actual_uom']=_0x3aec99;}),_0x3cd512[_0xdc257e(0x1d1)]((_0x475454,_0x8cfe2c)=>{var _0x1201db=_0xdc257e;_0x50f71b[_0x8cfe2c][_0x1201db(0x1ea)]=_0x475454;}),_0xcc8d60[_0xdc257e(0x1d1)]((_0x1355eb,_0x275819)=>{var _0x9d84b2=_0xdc257e;_0x50f71b[_0x275819][_0x9d84b2(0x1c6)]=_0x1355eb;}),_0x552a5a[_0xdc257e(0x1d1)]((_0x11b5ad,_0x26a9bc)=>{var _0x291c8d=_0xdc257e;_0x50f71b[_0x26a9bc][_0x291c8d(0x1f2)]=_0x11b5ad;}),_0x1be38c['forEach']((_0x17c3eb,_0x4d3c30)=>{var _0x2e3bf9=_0xdc257e;_0x50f71b[_0x4d3c30][_0x2e3bf9(0x115)]=_0x17c3eb;}),_0x1a501a[_0xdc257e(0x1d1)]((_0x2ec58f,_0xebf8bf)=>{_0x16805d['forEach']((_0x16e857,_0x371d1d)=>{var _0x213aa6=a0_0x5de4;if(_0x16e857==_0x213aa6(0x1e6)&&_0xebf8bf==_0x371d1d){var _0x582556=_0x2ec58f[_0x213aa6(0x137)](0x3);_0x50f71b[_0xebf8bf][_0x213aa6(0x1ba)]=_0x2ec58f[0x0],_0x50f71b[_0xebf8bf][_0x213aa6(0x207)]=_0x2ec58f[0x1],_0x50f71b[_0xebf8bf][_0x213aa6(0x1a7)]=0x0,_0x50f71b[_0xebf8bf]['bin']=0x0,_0x50f71b[_0xebf8bf][_0x213aa6(0x1b3)]=_0x213aa6(0x20d),_0x50f71b[_0xebf8bf][_0x213aa6(0x1c7)]=_0x582556;}else{if(_0x16e857==_0x213aa6(0x140)&&_0xebf8bf==_0x371d1d){var _0x582556=_0x2ec58f['slice'](0x3);_0x50f71b[_0xebf8bf][_0x213aa6(0x1ba)]=_0x2ec58f[0x0],_0x50f71b[_0xebf8bf][_0x213aa6(0x207)]=_0x2ec58f[0x1],_0x50f71b[_0xebf8bf][_0x213aa6(0x1a7)]=0x0,_0x50f71b[_0xebf8bf][_0x213aa6(0x14a)]=0x0,_0x50f71b[_0xebf8bf]['type']=_0x213aa6(0x20d),_0x50f71b[_0xebf8bf][_0x213aa6(0x1c7)]=_0x2ec58f[0x5];}else{if(_0xebf8bf==_0x371d1d){var _0x104e2a;if(_0x2ec58f[0x4]=='L')_0x104e2a=_0x213aa6(0x1b0);else _0x2ec58f[0x4]=='F'&&(_0x104e2a='Floor');_0x50f71b[_0xebf8bf]['storage']=_0x2ec58f[0x0],_0x50f71b[_0xebf8bf][_0x213aa6(0x207)]=_0x2ec58f[0x1],_0x50f71b[_0xebf8bf][_0x213aa6(0x1a7)]=_0x2ec58f[0x2],_0x50f71b[_0xebf8bf][_0x213aa6(0x14a)]=_0x2ec58f[0x3],_0x50f71b[_0xebf8bf][_0x213aa6(0x1b3)]=_0x104e2a,_0x50f71b[_0xebf8bf][_0x213aa6(0x1c7)]=_0x2ec58f[0x5];}}}});}),_0x236190[_0xdc257e(0x1d1)]((_0x48c5e9,_0x398a6d)=>{var _0x1bc0e6=_0xdc257e;_0x50f71b[_0x398a6d][_0x1bc0e6(0x19b)]=_0x48c5e9;}),_0x1b41dd[_0xdc257e(0x1d1)]((_0x534f3a,_0x9343e9)=>{var _0x114c4c=_0xdc257e;_0x50f71b[_0x9343e9][_0x114c4c(0x1f8)]=_0x534f3a;}),_0x40369e[_0xdc257e(0x1d1)]((_0x1551a6,_0x1c6528)=>{_0x50f71b[_0x1c6528]['batch_code']=_0x1551a6;}),_0x3ce376[_0xdc257e(0x1d1)]((_0x461a68,_0x2f3068)=>{var _0x246cc6=_0xdc257e;_0x50f71b[_0x2f3068][_0x246cc6(0x1eb)]=_0x461a68;}),_0x4dd24d[_0xdc257e(0x1d1)]((_0x2d4cf9,_0x2a4e6e)=>{var _0x15289a=_0xdc257e;_0x50f71b[_0x2a4e6e][_0x15289a(0x142)]=_0x2d4cf9;}),_0x3ddc0e[_0xdc257e(0x1d1)]((_0x1e21ec,_0x5ae5d3)=>{var _0x176fac=_0xdc257e;_0x50f71b[_0x5ae5d3][_0x176fac(0x1a0)]=_0x1e21ec;}),_0x1f7048[_0xdc257e(0x1d1)]((_0x9ef63b,_0x2afa01)=>{var _0xe80be0=_0xdc257e;_0x50f71b[_0x2afa01][_0xe80be0(0x209)]=_0x9ef63b;}),_0x5cd779[_0xdc257e(0x1d1)]((_0x315a59,_0x4c68cf)=>{var _0x250444=_0xdc257e;_0x50f71b[_0x4c68cf][_0x250444(0x1ca)]=_0x315a59;}),_0x44deb2['forEach']((_0x496bf8,_0x343635)=>{_0x50f71b[_0x343635]['delivery_code']=_0x496bf8;}),_0x3ad994[_0xdc257e(0x1d1)]((_0x1ab3db,_0x5f1559)=>{var _0x4d8f77=_0xdc257e;_0x50f71b[_0x5f1559][_0x4d8f77(0x1a9)]=_0x1ab3db;}),_0x18c001[_0xdc257e(0x1d1)]((_0x5a117b,_0x34fecb)=>{var _0x310b2c=_0xdc257e;_0x50f71b[_0x34fecb][_0x310b2c(0x18e)]=_0x5a117b;}),_0x16805d[_0xdc257e(0x1d1)]((_0x165b7d,_0x5dfa1f)=>{var _0x565b72=_0xdc257e;_0x50f71b[_0x5dfa1f][_0x565b72(0x14e)]=_0x165b7d;}),_0x17abca['forEach']((_0xec2740,_0x297e24)=>{var _0x481513=_0xdc257e;_0x50f71b[_0x297e24][_0x481513(0x1df)]=_0xec2740;});var _0x22384d=0x0;_0x50f71b['forEach'](_0x183367=>{var _0x40eef9=_0xdc257e;(_0x183367[_0x40eef9(0x12f)]<_0x183367[_0x40eef9(0x18e)]||_0x183367[_0x40eef9(0x18e)]==0x0)&&(console[_0x40eef9(0x172)]('foreach\x20newproduct',_0x183367),_0x22384d++);});const _0x327718=_0x50f71b['filter'](_0x419194=>_0x419194[_0xdc257e(0x1ea)]!=='0'&&_0x419194[_0xdc257e(0x1ea)]!==''),_0x18941f=new sales({'invoice':_0x441cee,'customer':_0x4bc81b['body'][_0xdc257e(0x180)],'date':_0x51a1a2,'warehouse_name':_0x52d409,'sale_product':_0x327718,'note':_0x3ecce1,'room':_0x345cc4,'primary_code':_0xce2329,'secondary_code':_0x2ff17e,'prod_code':_0xefb1ae,'SCRN':_0x5688c6}),_0x24541b=await _0x18941f[_0xdc257e(0x210)]();_0x4bc81b['flash'](_0xdc257e(0x132),_0xdc257e(0x150)),_0x25f79e['redirect'](_0xdc257e(0x12e)+_0x24541b[_0xdc257e(0x20e)]);}catch(_0x3be869){console[_0xdc257e(0x172)](_0x3be869);}}),router['get'](a0_0x598093(0x114),auth,async(_0x3f74de,_0x3b7007)=>{var _0x25d0a7=a0_0x598093;try{const {username:_0x2c8c64,email:_0x543429,role:_0x3d4365}=_0x3f74de[_0x25d0a7(0x181)],_0x22271f=_0x3f74de[_0x25d0a7(0x181)],_0x3f4790=await profile[_0x25d0a7(0x1c4)]({'email':_0x22271f['email']}),_0x474fc2=await master_shop[_0x25d0a7(0x1a1)](),_0x5c755e=_0x3f74de[_0x25d0a7(0x11a)]['id'],_0x40a5e7=await sales[_0x25d0a7(0x19d)](_0x5c755e),_0x208794=await warehouse['aggregate']([{'$match':{'name':_0x40a5e7[_0x25d0a7(0x182)]}},{'$unwind':_0x25d0a7(0x1d7)},{'$group':{'_id':_0x25d0a7(0x14f),'name':{'$first':_0x25d0a7(0x135)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x25d0a7(0x1a6)},'bin':{'$first':_0x25d0a7(0x1f7)},'type':{'$first':_0x25d0a7(0x17d)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x25d0a7(0x1fc)},'product_code':{'$first':_0x25d0a7(0x205)},'storage':{'$first':_0x25d0a7(0x1fb)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x25d0a7(0x1a4)},'invoice':{'$first':_0x25d0a7(0x1b8)}}}]),_0x32c6ae=await customer[_0x25d0a7(0x1a1)]({});let _0x35fe0b;if(_0x22271f[_0x25d0a7(0x1a3)]=='staff'){const _0x3efc52=await staff['findOne']({'email':_0x22271f[_0x25d0a7(0x21a)]});_0x35fe0b=await warehouse[_0x25d0a7(0x212)]([{'$match':{'status':_0x25d0a7(0x1da),'name':_0x3efc52[_0x25d0a7(0x1b2)]}},{'$group':{'_id':_0x25d0a7(0x16e),'name':{'$first':_0x25d0a7(0x16e)}}}]);}else _0x35fe0b=await warehouse['aggregate']([{'$match':{'status':_0x25d0a7(0x1da)}},{'$group':{'_id':'$name','name':{'$first':_0x25d0a7(0x16e)}}}]);const _0x221733=await product[_0x25d0a7(0x1a1)]({}),_0x529e41=await suppliers[_0x25d0a7(0x1a1)]({});if(_0x474fc2[0x0][_0x25d0a7(0x187)]==_0x25d0a7(0x1bd)){var _0x3d84e3=users['English'];console['log'](_0x3d84e3);}else{if(_0x474fc2[0x0][_0x25d0a7(0x187)]=='Hindi')var _0x3d84e3=users[_0x25d0a7(0x1c0)];else{if(_0x474fc2[0x0][_0x25d0a7(0x187)]=='German')var _0x3d84e3=users['German'];else{if(_0x474fc2[0x0][_0x25d0a7(0x187)]=='Spanish')var _0x3d84e3=users['Spanish'];else{if(_0x474fc2[0x0][_0x25d0a7(0x187)]==_0x25d0a7(0x19c))var _0x3d84e3=users['French'];else{if(_0x474fc2[0x0][_0x25d0a7(0x187)]==_0x25d0a7(0x159))var _0x3d84e3=users[_0x25d0a7(0x15f)];else{if(_0x474fc2[0x0][_0x25d0a7(0x187)]==_0x25d0a7(0x1be))var _0x3d84e3=users[_0x25d0a7(0x1be)];else{if(_0x474fc2[0x0][_0x25d0a7(0x187)]==_0x25d0a7(0x158))var _0x3d84e3=users['Arabic'];}}}}}}}_0x3b7007['render']('edit_sales_view',{'success':_0x3f74de[_0x25d0a7(0x13b)](_0x25d0a7(0x132)),'errors':_0x3f74de[_0x25d0a7(0x13b)](_0x25d0a7(0x124)),'role':_0x22271f,'profile':_0x3f4790,'customer':_0x32c6ae,'warehouse':_0x35fe0b,'product':_0x208794,'user':_0x40a5e7,'master_shop':_0x474fc2,'unit':_0x221733,'language':_0x3d84e3,'suppliers':_0x529e41});}catch(_0x180b10){console[_0x25d0a7(0x172)](_0x180b10);}}),router[a0_0x598093(0x1cf)](a0_0x598093(0x114),auth,async(_0x473cfa,_0x57078d)=>{var _0x104c0e=a0_0x598093;try{const _0x5f2860=_0x473cfa[_0x104c0e(0x11a)]['id'],{invoice:_0x5acb02,warehouse_name:_0x33354b,room:_0x497920}=_0x473cfa[_0x104c0e(0x20c)],_0xa3f678=await sales[_0x104c0e(0x1c4)]({'invoice':_0x5acb02}),_0x4b298b=_0xa3f678[_0x104c0e(0x12a)][_0x104c0e(0x160)](async _0x138871=>{var _0x25fc6c=_0x104c0e,_0x24b5a6=await warehouse[_0x25fc6c(0x1c4)]({'name':_0x33354b,'room':_0x138871[_0x25fc6c(0x14e)],'warehouse_category':_0x25fc6c(0x126)});const _0x5b6300=_0x24b5a6[_0x25fc6c(0x153)][_0x25fc6c(0x160)](_0x3140a1=>{var _0x5bf55d=_0x25fc6c;_0x3140a1[_0x5bf55d(0x1af)]==_0x138871[_0x5bf55d(0x1af)]&&_0x3140a1[_0x5bf55d(0x1c7)]==_0x138871[_0x5bf55d(0x1c7)]&&_0x3140a1[_0x5bf55d(0x1b3)]==_0x138871[_0x5bf55d(0x1b3)]&&_0x3140a1[_0x5bf55d(0x14a)]==_0x138871['bin']&&_0x3140a1['bay']==_0x138871[_0x5bf55d(0x1a7)]&&_0x3140a1[_0x5bf55d(0x207)]==_0x138871[_0x5bf55d(0x207)]&&_0x3140a1[_0x5bf55d(0x1ba)]==_0x138871[_0x5bf55d(0x1ba)]&&_0x3140a1[_0x5bf55d(0x1eb)]==_0x138871[_0x5bf55d(0x1eb)]&&_0x3140a1['batch_code']==_0x138871['batch_code']&&_0x3140a1[_0x5bf55d(0x1df)]==_0x138871['invoice']&&(_0x3140a1[_0x5bf55d(0x1cb)]=Math[_0x5bf55d(0x165)](_0x3140a1[_0x5bf55d(0x1cb)])-Math[_0x5bf55d(0x165)](_0x138871[_0x5bf55d(0x1ea)]));});return _0x24b5a6;});Promise[_0x104c0e(0x118)](_0x4b298b)[_0x104c0e(0x18a)](async _0xece74b=>{var _0x2bf0ba=_0x104c0e;try{for(const _0x10bbbd of _0xece74b){await _0x10bbbd['save']();}_0xa3f678[_0x2bf0ba(0x1bc)]=_0x2bf0ba(0x171);const _0x165e86=await _0xa3f678['save'](),_0x58ae26=await master_shop['find'](),_0x382337=await email_settings[_0x2bf0ba(0x1c4)](),_0x28bb75=await supervisor_settings[_0x2bf0ba(0x1a1)]();var _0x2b2d3a=_0xa3f678[_0x2bf0ba(0x12a)],_0x29e66d='',_0x4c3ef7;for(_0x4c3ef7 in _0x2b2d3a){_0x29e66d+=_0x2bf0ba(0x201)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2b2d3a[_0x4c3ef7][_0x2bf0ba(0x1af)]+_0x2bf0ba(0x194)+_0x2bf0ba(0x1cc)+_0x2b2d3a[_0x4c3ef7][_0x2bf0ba(0x115)]+_0x2bf0ba(0x194)+_0x2bf0ba(0x1cc)+_0x2b2d3a[_0x4c3ef7]['quantity']+_0x2bf0ba(0x194)+_0x2bf0ba(0x1cc)+_0x2b2d3a[_0x4c3ef7][_0x2bf0ba(0x19b)]+'</td>'+_0x2bf0ba(0x1cc)+_0x2b2d3a[_0x4c3ef7][_0x2bf0ba(0x1f8)]+_0x2bf0ba(0x194)+_0x2bf0ba(0x1cc)+_0xa3f678[_0x2bf0ba(0x182)]+_0x2bf0ba(0x194)+_0x2bf0ba(0x1cc)+_0x2b2d3a[_0x4c3ef7][_0x2bf0ba(0x14e)]+_0x2bf0ba(0x194)+_0x2bf0ba(0x1cc)+_0x2b2d3a[_0x4c3ef7]['storage']+_0x2b2d3a[_0x4c3ef7][_0x2bf0ba(0x207)]+_0x2b2d3a[_0x4c3ef7]['bay']+_0x2b2d3a[_0x4c3ef7]['bin']+_0x2b2d3a[_0x4c3ef7][_0x2bf0ba(0x1b3)][0x0]+_0x2b2d3a[_0x4c3ef7]['floorlevel']+_0x2bf0ba(0x194),_0x2bf0ba(0x1c1);}let _0x462e00=nodemailer[_0x2bf0ba(0x1e2)]({'host':_0x382337[_0x2bf0ba(0x11f)],'port':Number(_0x382337[_0x2bf0ba(0x218)]),'secure':![],'auth':{'user':_0x382337['email'],'pass':_0x382337[_0x2bf0ba(0x199)]}}),_0x281166={'from':_0x382337[_0x2bf0ba(0x21a)],'to':_0x28bb75[0x0][_0x2bf0ba(0x17f)],'subject':_0x2bf0ba(0x163),'attachments':[{'filename':_0x2bf0ba(0x129),'path':__dirname+_0x2bf0ba(0x11b)+_0x2bf0ba(0x13d)+_0x58ae26[0x0]['image'],'cid':_0x2bf0ba(0x1d8)}],'html':'<!DOCTYPE\x20html>'+_0x2bf0ba(0x151)+_0x2bf0ba(0x1f5)+_0x2bf0ba(0x11c)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2bf0ba(0x185)+_0x2bf0ba(0x11c)+_0x2bf0ba(0x17c)+_0x58ae26[0x0][_0x2bf0ba(0x1d3)]+_0x2bf0ba(0x204)+'</div>'+'</div>'+_0x2bf0ba(0x155)+_0x2bf0ba(0x11c)+_0x2bf0ba(0x1ef)+_0x2bf0ba(0x12d)+_0xa3f678['invoice']+'\x20'+_0x2bf0ba(0x177)+_0x2bf0ba(0x1ec)+_0xa3f678[_0x2bf0ba(0x1a5)]+'\x20'+_0x2bf0ba(0x147)+_0x2bf0ba(0x1b4)+_0x2bf0ba(0x185)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2bf0ba(0x138)+_0x2bf0ba(0x201)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2bf0ba(0x15a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x2bf0ba(0x1f6)+_0x2bf0ba(0x189)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x2bf0ba(0x1c1)+_0x2bf0ba(0x1c5)+_0x2bf0ba(0x1e4)+'\x20'+_0x29e66d+'\x20'+'</tbody>'+_0x2bf0ba(0x130)+_0x2bf0ba(0x11c)+_0x2bf0ba(0x19f)+'<h5>'+_0x58ae26[0x0]['site_title']+_0x2bf0ba(0x1b4)+_0x2bf0ba(0x185)+'</div>'+_0x2bf0ba(0x1ad)};_0x462e00[_0x2bf0ba(0x1d5)](_0x281166,function(_0x4c856b,_0x23e35c){var _0x87119f=_0x2bf0ba;_0x4c856b?(console[_0x87119f(0x172)](_0x4c856b),console[_0x87119f(0x172)](_0x87119f(0x1e0))):console[_0x87119f(0x172)]('Email\x20sent\x20successfully');}),_0x473cfa['flash'](_0x2bf0ba(0x132),_0x2bf0ba(0x125)),_0x57078d[_0x2bf0ba(0x1e7)](_0x2bf0ba(0x12e)+_0x5f2860);}catch(_0x4d2c54){console[_0x2bf0ba(0x131)](_0x4d2c54),_0x57078d[_0x2bf0ba(0x116)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x104c0e(0x178)](_0xb2ae6a=>{var _0x470e77=_0x104c0e;console[_0x470e77(0x131)](_0xb2ae6a),_0x57078d[_0x470e77(0x116)](0x1f4)['json']({'error':_0x470e77(0x1e1)});});}catch(_0x2a9b49){console[_0x104c0e(0x172)](_0x2a9b49);}}),router['get'](a0_0x598093(0x168),auth,async(_0x5b6639,_0x2cf92b)=>{var _0x590424=a0_0x598093;try{const {username:_0x47d639,email:_0x550712,role:_0x3629b7}=_0x5b6639['user'],_0x45d6e2=_0x5b6639[_0x590424(0x181)],_0x926359=await profile['findOne']({'email':_0x45d6e2[_0x590424(0x21a)]}),_0x379275=await master_shop[_0x590424(0x1a1)](),_0xb21244=_0x5b6639[_0x590424(0x11a)]['id'],_0x4ac9c0=await sales['findById'](_0xb21244);var _0x465d98=[_0x590424(0x1bb),_0x590424(0x164)];const _0x11dba5=await warehouse['aggregate']([{'$match':{'name':_0x4ac9c0[_0x590424(0x182)],'warehouse_category':_0x590424(0x126)}},{'$unwind':_0x590424(0x1d7)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x590424(0x135)},'product_stock':{'$first':_0x590424(0x221)},'bay':{'$first':_0x590424(0x1a6)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x590424(0x17d)},'floorlevel':{'$first':_0x590424(0x200)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x590424(0x1fc)},'product_code':{'$first':_0x590424(0x205)},'storage':{'$first':_0x590424(0x1fb)},'rack':{'$first':_0x590424(0x17b)}}}]),_0x531d3c=await customer[_0x590424(0x1a1)]({});let _0x141c4c;if(_0x45d6e2[_0x590424(0x1a3)]==_0x590424(0x162)){const _0x318c66=await staff[_0x590424(0x1c4)]({'email':_0x45d6e2[_0x590424(0x21a)]});_0x141c4c=await warehouse['aggregate']([{'$match':{'status':_0x590424(0x1da),'name':_0x318c66[_0x590424(0x1b2)],'warehouse_category':_0x590424(0x126)}},{'$group':{'_id':'$name','name':{'$first':_0x590424(0x16e)}}}]);}else _0x141c4c=await warehouse['aggregate']([{'$match':{'status':_0x590424(0x1da),'warehouse_category':_0x590424(0x126)}},{'$group':{'_id':_0x590424(0x16e),'name':{'$first':'$name'}}}]);const _0x37e382=await product[_0x590424(0x1a1)]({});if(_0x379275[0x0][_0x590424(0x187)]==_0x590424(0x1bd)){var _0x37f83d=users[_0x590424(0x15d)];console['log'](_0x37f83d);}else{if(_0x379275[0x0]['language']==_0x590424(0x1c0))var _0x37f83d=users['Hindi'];else{if(_0x379275[0x0][_0x590424(0x187)]==_0x590424(0x145))var _0x37f83d=users[_0x590424(0x145)];else{if(_0x379275[0x0][_0x590424(0x187)]==_0x590424(0x141))var _0x37f83d=users['Spanish'];else{if(_0x379275[0x0][_0x590424(0x187)]==_0x590424(0x19c))var _0x37f83d=users[_0x590424(0x19c)];else{if(_0x379275[0x0][_0x590424(0x187)]==_0x590424(0x159))var _0x37f83d=users[_0x590424(0x15f)];else{if(_0x379275[0x0][_0x590424(0x187)]==_0x590424(0x1be))var _0x37f83d=users[_0x590424(0x1be)];else{if(_0x379275[0x0][_0x590424(0x187)]==_0x590424(0x158))var _0x37f83d=users[_0x590424(0x1e9)];}}}}}}}_0x2cf92b[_0x590424(0x193)](_0x590424(0x136),{'success':_0x5b6639[_0x590424(0x13b)](_0x590424(0x132)),'errors':_0x5b6639[_0x590424(0x13b)](_0x590424(0x124)),'role':_0x45d6e2,'profile':_0x926359,'customer':_0x531d3c,'warehouse':_0x141c4c,'product':_0x11dba5,'user':_0x4ac9c0,'master_shop':_0x379275,'unit':_0x37e382,'language':_0x37f83d});}catch(_0x25cfaa){console[_0x590424(0x172)](_0x25cfaa);}}),router[a0_0x598093(0x1cf)]('/view/:id',auth,async(_0x4e28e5,_0x3b4d2e)=>{var _0x3705b6=a0_0x598093;try{const _0x102e55=_0x4e28e5[_0x3705b6(0x11a)]['id'],_0x503c1b=await sales[_0x3705b6(0x1c4)]({'_id':_0x4e28e5[_0x3705b6(0x11a)]['id']}),_0x480496=await warehouse[_0x3705b6(0x1c4)]({'name':_0x503c1b[_0x3705b6(0x182)],'room':_0x4e28e5['body'][_0x3705b6(0x146)]}),{invoice:_0x3f0b58,date:_0x116033,warehouse_name:_0x1591cd,product_name:_0x3e6598,stock:_0xf6282f,quantity:_0x32d30a,note:_0x5d23e8,room:_0x386375,customer:_0xd28cb2,SCRN:_0xee7344}=_0x4e28e5['body'];if(typeof _0x3e6598==_0x3705b6(0x166))var _0x50a690=[_0x4e28e5['body']['product_name']],_0x821ef0=[_0x4e28e5['body']['stock']],_0x26903=[_0x4e28e5['body'][_0x3705b6(0x120)]],_0x1bb9e=[_0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x1c6)]],_0x47c922=[_0x4e28e5[_0x3705b6(0x20c)]['secondary_code']],_0x1f144a=[_0x4e28e5[_0x3705b6(0x20c)]['prod_code']],_0xe4ed8a=[_0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x215)]],_0x50668e=[_0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x18c)]],_0x28172c=[_0x4e28e5[_0x3705b6(0x20c)]['secondary_unit']],_0xf50abb=[_0x4e28e5['body'][_0x3705b6(0x20a)]],_0x49b444=[_0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x1eb)]],_0x3d9d1a=[_0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x154)]],_0x939bc0=[_0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x1a0)]],_0x2bf1df=[_0x4e28e5[_0x3705b6(0x20c)]['requested_qty']],_0x46594b=[_0x4e28e5[_0x3705b6(0x20c)]['delivery_date']],_0xda1d47=[_0x4e28e5['body'][_0x3705b6(0x16d)]],_0x2572aa=[_0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x1a9)]],_0xf293b6=[_0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x1ea)]],_0x30cc02=[_0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x208)]];else var _0x50a690=[..._0x4e28e5['body'][_0x3705b6(0x1af)]],_0x821ef0=[..._0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x12f)]],_0x26903=[..._0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x120)]],_0x1bb9e=[..._0x4e28e5['body'][_0x3705b6(0x1c6)]],_0x47c922=[..._0x4e28e5[_0x3705b6(0x20c)]['secondary_code']],_0x1f144a=[..._0x4e28e5[_0x3705b6(0x20c)]['prod_code']],_0xe4ed8a=[..._0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x215)]],_0x50668e=[..._0x4e28e5['body']['primary_unit']],_0x28172c=[..._0x4e28e5['body'][_0x3705b6(0x1f8)]],_0xf50abb=[..._0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x20a)]],_0x49b444=[..._0x4e28e5['body'][_0x3705b6(0x1eb)]],_0x3d9d1a=[..._0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x154)]],_0x939bc0=[..._0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x1a0)]],_0x2bf1df=[..._0x4e28e5[_0x3705b6(0x20c)]['requested_qty']],_0x46594b=[..._0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x1ca)]],_0xda1d47=[..._0x4e28e5['body']['delivery_code']],_0x2572aa=[..._0x4e28e5['body'][_0x3705b6(0x1a9)]],_0xf293b6=[..._0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x1ea)]],_0x30cc02=[..._0x4e28e5[_0x3705b6(0x20c)][_0x3705b6(0x208)]];const _0x464505=_0x50a690['map'](_0x3f3597=>{return _0x3f3597={'product_name':_0x3f3597};});_0x821ef0[_0x3705b6(0x1d1)]((_0x288209,_0x5d4177)=>{var _0x5d91dc=_0x3705b6;_0x464505[_0x5d4177]['stock']=Math[_0x5d91dc(0x165)](_0x288209);}),_0x26903['forEach']((_0x46b262,_0x5c45db)=>{var _0x35cdfd=_0x3705b6;_0x464505[_0x5c45db][_0x35cdfd(0x1ea)]=_0x46b262;}),_0x1bb9e[_0x3705b6(0x1d1)]((_0x5a892c,_0x5edd5c)=>{var _0x12b742=_0x3705b6;_0x464505[_0x5edd5c][_0x12b742(0x1c6)]=_0x5a892c;}),_0x47c922['forEach']((_0x34ef8c,_0x3ed18a)=>{_0x464505[_0x3ed18a]['secondary_code']=_0x34ef8c;}),_0x1f144a[_0x3705b6(0x1d1)]((_0x3d25f4,_0x56e199)=>{var _0x45be2e=_0x3705b6;_0x464505[_0x56e199][_0x45be2e(0x115)]=_0x3d25f4;}),_0xe4ed8a[_0x3705b6(0x1d1)]((_0x2aed0f,_0x20e1a4)=>{var _0x392ce3=_0x3705b6;_0x30cc02[_0x392ce3(0x1d1)]((_0x1bea47,_0x40e491)=>{var _0x5e9f73=_0x392ce3;if(_0x1bea47==_0x5e9f73(0x1e6)&&_0x20e1a4==_0x40e491){var _0x23ea90=_0x2aed0f[_0x5e9f73(0x137)](0x3);_0x464505[_0x20e1a4][_0x5e9f73(0x1ba)]=_0x2aed0f[0x0],_0x464505[_0x20e1a4][_0x5e9f73(0x207)]=_0x2aed0f[0x1],_0x464505[_0x20e1a4]['bay']=0x0,_0x464505[_0x20e1a4][_0x5e9f73(0x14a)]=0x0,_0x464505[_0x20e1a4][_0x5e9f73(0x1b3)]=_0x5e9f73(0x20d),_0x464505[_0x20e1a4][_0x5e9f73(0x1c7)]=_0x23ea90;}else{if(_0x1bea47==_0x5e9f73(0x140)&&_0x20e1a4==_0x40e491){var _0x23ea90=_0x2aed0f[_0x5e9f73(0x137)](0x3);_0x464505[_0x20e1a4][_0x5e9f73(0x1ba)]=_0x2aed0f[0x0],_0x464505[_0x20e1a4][_0x5e9f73(0x207)]=_0x2aed0f[0x1],_0x464505[_0x20e1a4]['bay']=0x0,_0x464505[_0x20e1a4][_0x5e9f73(0x14a)]=0x0,_0x464505[_0x20e1a4][_0x5e9f73(0x1b3)]=_0x5e9f73(0x20d),_0x464505[_0x20e1a4][_0x5e9f73(0x1c7)]=_0x2aed0f[0x5];}else{if(_0x20e1a4==_0x40e491){var _0x30d122;if(_0x2aed0f[0x4]=='L')_0x30d122=_0x5e9f73(0x1b0);else _0x2aed0f[0x4]=='F'&&(_0x30d122=_0x5e9f73(0x20d));_0x464505[_0x20e1a4][_0x5e9f73(0x1ba)]=_0x2aed0f[0x0],_0x464505[_0x20e1a4][_0x5e9f73(0x207)]=_0x2aed0f[0x1],_0x464505[_0x20e1a4][_0x5e9f73(0x1a7)]=_0x2aed0f[0x2],_0x464505[_0x20e1a4][_0x5e9f73(0x14a)]=_0x2aed0f[0x3],_0x464505[_0x20e1a4][_0x5e9f73(0x1b3)]=_0x30d122,_0x464505[_0x20e1a4]['floorlevel']=_0x2aed0f[0x5];}}}});}),_0x50668e[_0x3705b6(0x1d1)]((_0x20a8ab,_0x23d897)=>{var _0x2f8ea8=_0x3705b6;_0x464505[_0x23d897][_0x2f8ea8(0x19b)]=_0x20a8ab;}),_0x28172c[_0x3705b6(0x1d1)]((_0x5da971,_0x55706a)=>{var _0x824b86=_0x3705b6;_0x464505[_0x55706a][_0x824b86(0x1f8)]=_0x5da971;}),_0xf50abb[_0x3705b6(0x1d1)]((_0x275f61,_0x1065d8)=>{var _0x3be08e=_0x3705b6;_0x464505[_0x1065d8][_0x3be08e(0x20a)]=_0x275f61;}),_0x49b444[_0x3705b6(0x1d1)]((_0x2ab1fa,_0x4cb25b)=>{_0x464505[_0x4cb25b]['expiry_date']=_0x2ab1fa;}),_0x3d9d1a[_0x3705b6(0x1d1)]((_0x55acf1,_0x4f7a05)=>{_0x464505[_0x4f7a05]['maxperunit']=_0x55acf1;}),_0x939bc0[_0x3705b6(0x1d1)]((_0x55ac2f,_0x175d63)=>{var _0x13980a=_0x3705b6;_0x464505[_0x175d63][_0x13980a(0x1a0)]=_0x55ac2f;}),_0x2bf1df[_0x3705b6(0x1d1)]((_0x5a22a0,_0x280097)=>{var _0x35e810=_0x3705b6;_0x464505[_0x280097][_0x35e810(0x209)]=Math[_0x35e810(0x165)](_0x5a22a0);}),_0x46594b[_0x3705b6(0x1d1)]((_0x593d13,_0x205e58)=>{var _0x490fc2=_0x3705b6;_0x464505[_0x205e58][_0x490fc2(0x1ca)]=_0x593d13;}),_0xda1d47[_0x3705b6(0x1d1)]((_0x593dac,_0x7074b7)=>{var _0x5baba5=_0x3705b6;_0x464505[_0x7074b7][_0x5baba5(0x16d)]=_0x593dac;}),_0x2572aa[_0x3705b6(0x1d1)]((_0x1f1eda,_0x5f06e3)=>{var _0x3cdf23=_0x3705b6;_0x464505[_0x5f06e3][_0x3cdf23(0x1a9)]=_0x1f1eda;}),_0xf293b6['forEach']((_0x341b63,_0x5db682)=>{_0x464505[_0x5db682]['quantity_notConverted']=_0x341b63;}),_0x30cc02[_0x3705b6(0x1d1)]((_0x1a1625,_0x36537e)=>{var _0xd19c82=_0x3705b6;_0x464505[_0x36537e][_0xd19c82(0x14e)]=_0x1a1625;});var _0x2c3e3f=0x0;_0x464505[_0x3705b6(0x1d1)](_0x250269=>{var _0x4c465e=_0x3705b6;console['log'](_0x4c465e(0x133),_0x250269),(parseInt(_0x250269[_0x4c465e(0x12f)])<parseInt(_0x250269['quantity'])||parseInt(_0x250269[_0x4c465e(0x1ea)])==0x0)&&_0x2c3e3f++;});if(_0x2c3e3f!=0x0)return _0x4e28e5[_0x3705b6(0x13b)](_0x3705b6(0x124),_0x3705b6(0x15e)),_0x3b4d2e[_0x3705b6(0x1e7)](_0x3705b6(0x167));const _0x273307=_0x464505[_0x3705b6(0x21d)](_0x59303c=>_0x59303c['quantity']!=='0'&&_0x59303c['quantity']!=='');_0x503c1b[_0x3705b6(0x1df)]=_0x3f0b58,_0x503c1b['customer']=_0xd28cb2,_0x503c1b[_0x3705b6(0x1a5)]=_0x116033,_0x503c1b[_0x3705b6(0x182)]=_0x1591cd,_0x503c1b[_0x3705b6(0x12a)]=_0x273307,_0x503c1b[_0x3705b6(0x169)]=_0x5d23e8,_0x503c1b['SCRN']=_0xee7344,_0x503c1b['finalize']=_0x3705b6(0x195),_0x503c1b[_0x3705b6(0x1f9)]=_0x3705b6(0x195);const _0x4f7d39=await _0x503c1b[_0x3705b6(0x210)]();_0x4e28e5[_0x3705b6(0x13b)](_0x3705b6(0x132),_0x3705b6(0x125)),_0x3b4d2e[_0x3705b6(0x1e7)](_0x3705b6(0x213));}catch(_0x5d4691){console[_0x3705b6(0x172)](_0x5d4691);}}),router['post'](a0_0x598093(0x1f0),auth,async(_0x4b3e17,_0x17676d)=>{var _0x1f985=a0_0x598093;try{const _0x1d3dc7=_0x4b3e17[_0x1f985(0x11a)]['id'],{invoice:_0x3317ad,customer:_0x1f0603,receivable_amount:_0x33e216,received_amount:_0x8b699a}=_0x4b3e17[_0x1f985(0x20c)],_0x18de3f=await sales[_0x1f985(0x19d)](_0x1d3dc7);console[_0x1f985(0x172)](_0x18de3f);var _0x5caadf=_0x33e216-_0x8b699a;console['log'](_0x8b699a),_0x18de3f[_0x1f985(0x127)]=parseFloat(_0x8b699a)+parseFloat(_0x18de3f[_0x1f985(0x127)]),_0x18de3f[_0x1f985(0x1d4)]=_0x5caadf,console[_0x1f985(0x172)](_0x18de3f);const _0x3f8260=await _0x18de3f[_0x1f985(0x210)](),_0x2415a6=await c_payment_data[_0x1f985(0x1c4)]({'invoice':_0x3317ad});_0x2415a6[_0x1f985(0x170)]=_0x5caadf,await _0x2415a6[_0x1f985(0x210)]();let _0x1a285d=new Date(),_0x4a7df3=('0'+_0x1a285d['getDate']())[_0x1f985(0x137)](-0x2),_0x19115e=('0'+(_0x1a285d[_0x1f985(0x214)]()+0x1))[_0x1f985(0x137)](-0x2),_0x119ada=_0x1a285d[_0x1f985(0x144)](),_0x43970a=_0x119ada+'-'+_0x19115e+'-'+_0x4a7df3;const _0x327488=new customer_payment({'invoice':_0x3317ad,'date':_0x119ada+'-'+_0x19115e+'-'+_0x4a7df3,'customer':_0x1f0603,'reason':_0x1f985(0x1de),'amount':_0x8b699a}),_0x5155e0=await _0x327488[_0x1f985(0x210)]();_0x4b3e17[_0x1f985(0x13b)](_0x1f985(0x132),'payment\x20successfull'),_0x17676d['redirect'](_0x1f985(0x213));}catch(_0x372859){console[_0x1f985(0x172)](_0x372859);}}),router['get'](a0_0x598093(0x1dd),auth,async(_0x4a4af9,_0x34d5aa)=>{var _0xdcfb8b=a0_0x598093;try{const {username:_0x3683b7,email:_0x9e616b,role:_0x3bf2b2}=_0x4a4af9[_0xdcfb8b(0x181)],_0x4ff2ea=_0x4a4af9[_0xdcfb8b(0x181)],_0x5c6931=await profile['findOne']({'email':_0x4ff2ea['email']}),_0xba52f4=await master_shop[_0xdcfb8b(0x1a1)]();console[_0xdcfb8b(0x172)](_0xdcfb8b(0x1ce),_0xba52f4);const _0x421eea=_0x4a4af9[_0xdcfb8b(0x11a)]['id'],_0x58015d=await sales[_0xdcfb8b(0x19d)](_0x421eea);console['log'](_0x58015d);const _0x28a0b9=await customer[_0xdcfb8b(0x1c4)]({'name':_0x58015d['customer']});console[_0xdcfb8b(0x172)](_0x28a0b9);if(_0xba52f4[0x0][_0xdcfb8b(0x187)]==_0xdcfb8b(0x1bd)){var _0x547b66=users['English'];console[_0xdcfb8b(0x172)](_0x547b66);}else{if(_0xba52f4[0x0][_0xdcfb8b(0x187)]==_0xdcfb8b(0x1c0))var _0x547b66=users['Hindi'];else{if(_0xba52f4[0x0]['language']==_0xdcfb8b(0x145))var _0x547b66=users['German'];else{if(_0xba52f4[0x0]['language']==_0xdcfb8b(0x141))var _0x547b66=users[_0xdcfb8b(0x141)];else{if(_0xba52f4[0x0][_0xdcfb8b(0x187)]==_0xdcfb8b(0x19c))var _0x547b66=users[_0xdcfb8b(0x19c)];else{if(_0xba52f4[0x0][_0xdcfb8b(0x187)]==_0xdcfb8b(0x159))var _0x547b66=users['Portuguese'];else{if(_0xba52f4[0x0]['language']=='Chinese')var _0x547b66=users['Chinese'];else{if(_0xba52f4[0x0][_0xdcfb8b(0x187)]=='Arabic\x20(ae)')var _0x547b66=users[_0xdcfb8b(0x1e9)];}}}}}}}_0x34d5aa[_0xdcfb8b(0x193)](_0xdcfb8b(0x14b),{'success':_0x4a4af9['flash'](_0xdcfb8b(0x132)),'errors':_0x4a4af9[_0xdcfb8b(0x13b)](_0xdcfb8b(0x124)),'role':_0x4ff2ea,'profile':_0x5c6931,'master_shop':_0xba52f4,'customers':_0x28a0b9,'sales':_0x58015d,'language':_0x547b66});}catch(_0x59eb10){console[_0xdcfb8b(0x172)](_0x59eb10);}}),router[a0_0x598093(0x1cd)](a0_0x598093(0x1ed),auth,async(_0x330290,_0x319ab7)=>{var _0x17bde7=a0_0x598093;try{const {username:_0x9d2491,email:_0x1271b1,role:_0x3d2591}=_0x330290['user'],_0x1def8c=_0x330290[_0x17bde7(0x181)],_0xa4bdc0=await profile[_0x17bde7(0x1c4)]({'email':_0x1def8c['email']}),_0x221a27=await master_shop[_0x17bde7(0x1a1)]();console['log'](_0x17bde7(0x1ce),_0x221a27);const _0x1e0a3c=_0x330290[_0x17bde7(0x11a)]['id'];console['log'](_0x1e0a3c);const _0x4b1c41=await sales['findById'](_0x1e0a3c);console[_0x17bde7(0x172)](_0x17bde7(0x13f),_0x4b1c41);const _0x1af9ca=await warehouse[_0x17bde7(0x212)]([{'$match':{'name':_0x17bde7(0x18b),'room':_0x17bde7(0x16f)}},{'$unwind':_0x17bde7(0x1d7)},{'$group':{'_id':_0x17bde7(0x14f),'name':{'$first':_0x17bde7(0x135)},'product_stock':{'$first':_0x17bde7(0x221)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x17bde7(0x186)},'pallet':{'$first':_0x17bde7(0x1d6)},'primary_code':{'$first':_0x17bde7(0x1a8)},'secondary_code':{'$first':_0x17bde7(0x1fc)},'product_code':{'$first':_0x17bde7(0x205)}}}]);console[_0x17bde7(0x172)](_0x17bde7(0x191),_0x1af9ca);const _0x5e408d=await product[_0x17bde7(0x1a1)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x17bde7(0x1da),'name':_0x17bde7(0x18b),'warehouse_category':_0x17bde7(0x126)}},{'$group':{'_id':_0x17bde7(0x16e),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0xb6ddfb=[_0x17bde7(0x16f)];if(_0x221a27[0x0][_0x17bde7(0x187)]==_0x17bde7(0x1bd)){var _0x3acaee=users[_0x17bde7(0x15d)];console[_0x17bde7(0x172)](_0x3acaee);}else{if(_0x221a27[0x0][_0x17bde7(0x187)]==_0x17bde7(0x1c0))var _0x3acaee=users[_0x17bde7(0x1c0)];else{if(_0x221a27[0x0][_0x17bde7(0x187)]==_0x17bde7(0x145))var _0x3acaee=users[_0x17bde7(0x145)];else{if(_0x221a27[0x0][_0x17bde7(0x187)]==_0x17bde7(0x141))var _0x3acaee=users[_0x17bde7(0x141)];else{if(_0x221a27[0x0][_0x17bde7(0x187)]==_0x17bde7(0x19c))var _0x3acaee=users[_0x17bde7(0x19c)];else{if(_0x221a27[0x0][_0x17bde7(0x187)]==_0x17bde7(0x159))var _0x3acaee=users[_0x17bde7(0x15f)];else{if(_0x221a27[0x0][_0x17bde7(0x187)]==_0x17bde7(0x1be))var _0x3acaee=users['Chinese'];else{if(_0x221a27[0x0][_0x17bde7(0x187)]==_0x17bde7(0x158))var _0x3acaee=users['Arabic'];}}}}}}}_0x319ab7[_0x17bde7(0x193)](_0x17bde7(0x21b),{'success':_0x330290[_0x17bde7(0x13b)](_0x17bde7(0x132)),'errors':_0x330290[_0x17bde7(0x13b)]('errors'),'role':_0x1def8c,'profile':_0xa4bdc0,'user':_0x4b1c41,'stock':_0x1af9ca,'master_shop':_0x221a27,'unit':_0x5e408d,'language':_0x3acaee,'warehouses':warehouse_data,'rooms':_0xb6ddfb});}catch(_0x5511a2){console[_0x17bde7(0x172)](_0x5511a2),_0x319ab7['status'](0xc8)['json']({'message':_0x5511a2[_0x17bde7(0x11e)]});}}),router['post']('/view/return_sales/:id',auth,async(_0x27e079,_0x56e01a)=>{var _0x235a19=a0_0x598093;try{const {invoice:_0x103d6b,date:_0x11a850,warehouse_name:_0x23a8a3,product_name:_0x89e265,primary_code:_0x561575,secondary_code:_0x556278,product_code:_0x4780dd,sales_quantity:_0x47e7ba,stocks:_0x24eee3,return_qty:_0x128a96,Room_name:_0x1616f6,to_warehouse_name:_0x51df65,to_Roomname:_0x181ef7,to_Room_name:_0x5e6ad5,note:_0xb49e5b,level:_0x4656f4,isle:_0x25b587,pallet:_0x42f48a}=_0x27e079[_0x235a19(0x20c)];if(typeof _0x89e265==_0x235a19(0x166))var _0x503ec3=[_0x27e079[_0x235a19(0x20c)][_0x235a19(0x1af)]],_0x466131=[_0x27e079[_0x235a19(0x20c)][_0x235a19(0x1c6)]],_0x4d1489=[_0x27e079['body'][_0x235a19(0x1f2)]],_0x106a88=[_0x27e079['body']['product_code']],_0x58ef44=[_0x27e079['body'][_0x235a19(0x1b9)]],_0x338aa1=[_0x27e079['body'][_0x235a19(0x18f)]],_0x427453=[_0x27e079[_0x235a19(0x20c)][_0x235a19(0x224)]],_0x36079c=[_0x27e079[_0x235a19(0x20c)][_0x235a19(0x1a7)]],_0x1c7d0b=[_0x27e079[_0x235a19(0x20c)][_0x235a19(0x14a)]],_0x4e631d=[_0x27e079[_0x235a19(0x20c)][_0x235a19(0x190)]],_0x3673af=[_0x27e079['body'][_0x235a19(0x1c7)]];else var _0x503ec3=[..._0x27e079[_0x235a19(0x20c)]['product_name']],_0x466131=[..._0x27e079['body'][_0x235a19(0x1c6)]],_0x4d1489=[..._0x27e079[_0x235a19(0x20c)]['secondary_code']],_0x106a88=[..._0x27e079['body']['product_code']],_0x58ef44=[..._0x27e079[_0x235a19(0x20c)]['sales_quantity']],_0x338aa1=[..._0x27e079[_0x235a19(0x20c)][_0x235a19(0x18f)]],_0x427453=[..._0x27e079[_0x235a19(0x20c)][_0x235a19(0x224)]],_0x36079c=[..._0x27e079['body'][_0x235a19(0x1a7)]],_0x1c7d0b=[..._0x27e079['body'][_0x235a19(0x14a)]],_0x4e631d=[..._0x27e079[_0x235a19(0x20c)]['types']],_0x3673af=[..._0x27e079[_0x235a19(0x20c)][_0x235a19(0x1c7)]];const _0x2738a5=_0x503ec3['map'](_0x3697d9=>{return _0x3697d9={'product_name':_0x3697d9};});_0x466131['forEach']((_0x7539b0,_0xaa9a6c)=>{var _0x41c6d5=_0x235a19;_0x2738a5[_0xaa9a6c][_0x41c6d5(0x1c6)]=_0x7539b0;}),_0x4d1489['forEach']((_0x9cbbea,_0x30ed55)=>{var _0xe6ff=_0x235a19;_0x2738a5[_0x30ed55][_0xe6ff(0x1f2)]=_0x9cbbea;}),_0x106a88[_0x235a19(0x1d1)]((_0xb6f8f5,_0x55c85a)=>{var _0x130722=_0x235a19;_0x2738a5[_0x55c85a][_0x130722(0x115)]=_0xb6f8f5;}),_0x58ef44[_0x235a19(0x1d1)]((_0x157993,_0x411d3c)=>{var _0x1e14f4=_0x235a19;_0x2738a5[_0x411d3c][_0x1e14f4(0x1ff)]=_0x157993;}),_0x338aa1[_0x235a19(0x1d1)]((_0x148559,_0x44a5e5)=>{var _0x505264=_0x235a19;_0x2738a5[_0x44a5e5][_0x505264(0x12f)]=_0x148559;}),_0x427453['forEach']((_0x3a3f68,_0x183f7a)=>{var _0x4aa16e=_0x235a19;_0x2738a5[_0x183f7a][_0x4aa16e(0x224)]=_0x3a3f68;}),_0x36079c[_0x235a19(0x1d1)]((_0x1a1af9,_0x1cedde)=>{var _0x4cf355=_0x235a19;_0x2738a5[_0x1cedde][_0x4cf355(0x1a7)]=_0x1a1af9;}),_0x1c7d0b['forEach']((_0x40fa1f,_0x1ad4c8)=>{var _0x2f93db=_0x235a19;_0x2738a5[_0x1ad4c8][_0x2f93db(0x14a)]=_0x40fa1f;}),_0x4e631d['forEach']((_0x898590,_0x31b1d7)=>{var _0x41da1f=_0x235a19;_0x2738a5[_0x31b1d7][_0x41da1f(0x1b3)]=_0x898590;}),_0x3673af[_0x235a19(0x1d1)]((_0x17a63c,_0x2a0ad2)=>{var _0x499525=_0x235a19;_0x2738a5[_0x2a0ad2][_0x499525(0x1c7)]=_0x17a63c;});var _0x13920f=0x0;_0x2738a5[_0x235a19(0x1d1)](_0x3ee40e=>{var _0xcd5420=_0x235a19;console[_0xcd5420(0x172)](_0xcd5420(0x133),_0x3ee40e),(parseInt(_0x3ee40e[_0xcd5420(0x1ff)])<parseInt(_0x3ee40e[_0xcd5420(0x224)])||parseInt(_0x3ee40e['stock'])<parseInt(_0x3ee40e[_0xcd5420(0x224)])&&parseInt(_0x3ee40e[_0xcd5420(0x1ff)])>parseInt(_0x3ee40e[_0xcd5420(0x224)])||parseInt(_0x3ee40e[_0xcd5420(0x224)])==0x0)&&_0x13920f++;});if(_0x13920f!=0x0)return _0x27e079['flash']('errors',_0x235a19(0x15c)),_0x56e01a['redirect'](_0x235a19(0x167));const _0x518f6b=await sales[_0x235a19(0x1c4)]({'invoice':_0x103d6b});console['log'](_0x518f6b),_0x518f6b[_0x235a19(0x13a)]=_0x235a19(0x171);const _0x46f3a6=await _0x518f6b[_0x235a19(0x210)](),_0x7efa90=new sales_return({'invoice':_0x103d6b,'customer':_0x27e079[_0x235a19(0x20c)][_0x235a19(0x180)],'date':_0x11a850,'warehouse_name':_0x23a8a3,'room':_0x1616f6,'ToWarehouse':_0x51df65,'ToRoom':_0x5e6ad5,'return_sale':_0x2738a5,'note':_0xb49e5b}),_0x24ec41=await _0x7efa90['save']();console[_0x235a19(0x172)](_0x7efa90);const _0xf13c4b=await sales_return[_0x235a19(0x1c4)]({'invoice':_0x103d6b}),_0x263a5c=await warehouse[_0x235a19(0x1c4)]({'name':_0x51df65,'room':_0x5e6ad5});_0xf13c4b[_0x235a19(0x21b)][_0x235a19(0x1d1)](_0x499382=>{var _0x1b0ea9=_0x235a19,_0x37be6f=0x0;const _0x58bd26=_0x263a5c[_0x1b0ea9(0x153)]['map'](_0x40d85a=>{var _0x3a5e90=_0x1b0ea9;_0x40d85a[_0x3a5e90(0x1af)]==_0x499382[_0x3a5e90(0x1af)]&&_0x40d85a[_0x3a5e90(0x1c7)]==_0x499382['floorlevel']&&_0x40d85a[_0x3a5e90(0x1b3)]==_0x499382[_0x3a5e90(0x1b3)]&&_0x40d85a['bin']==_0x499382[_0x3a5e90(0x14a)]&&_0x40d85a[_0x3a5e90(0x1a7)]==_0x499382[_0x3a5e90(0x1a7)]&&(_0x40d85a['product_stock']=parseInt(_0x40d85a[_0x3a5e90(0x1cb)])+parseInt(_0x499382['return_qty']),_0x37be6f++);});_0x37be6f=='0'&&(_0x263a5c[_0x1b0ea9(0x153)]=_0x263a5c[_0x1b0ea9(0x153)][_0x1b0ea9(0x1dc)]({'product_name':_0x499382[_0x1b0ea9(0x1af)],'product_stock':_0x499382[_0x1b0ea9(0x224)],'primary_code':_0x499382[_0x1b0ea9(0x1c6)],'secondary_code':_0x499382['secondary_code'],'product_code':_0x499382[_0x1b0ea9(0x115)],'bay':_0x499382[_0x1b0ea9(0x1a7)],'bin':_0x499382[_0x1b0ea9(0x14a)],'type':_0x499382[_0x1b0ea9(0x1b3)],'floorlevel':_0x499382['floorlevel']})),console[_0x1b0ea9(0x172)](_0x1b0ea9(0x139),_0x263a5c);}),await _0x263a5c['save'](),console['log'](_0x27e079[_0x235a19(0x20c)]);const _0x2e9fb1=new c_payment_data({'invoice':_0x103d6b,'customer':_0x27e079[_0x235a19(0x20c)]['customer'],'reason':_0x235a19(0x1c8)});await _0x2e9fb1[_0x235a19(0x210)]();const _0x3ec1bc=await master_shop[_0x235a19(0x1a1)]();console['log'](_0x235a19(0x192),_0x3ec1bc[0x0][_0x235a19(0x157)]);const _0x1c0c8e=await email_settings['findOne'](),_0x47df0a=await customer['findOne']({'name':_0x27e079[_0x235a19(0x20c)]['customer']});console['log'](_0x235a19(0x1ab),_0x47df0a);_0x3ec1bc[0x0]['currency_placement']==0x1?(right_currency=_0x3ec1bc[0x0][_0x235a19(0x223)],left_currency=''):(right_currency='',left_currency=_0x3ec1bc[0x0][_0x235a19(0x223)]);var _0x44bc04=_0x503ec3,_0x1f9de2=_0x427453,_0x49b65f='',_0x1e75e8;for(_0x1e75e8 in _0x44bc04){_0x49b65f+='<tr>'+_0x235a19(0x1cc)+_0x44bc04[_0x1e75e8]+_0x235a19(0x194)+_0x235a19(0x1cc)+_0x1f9de2[_0x1e75e8]+'</td>'+_0x235a19(0x1c1);}console['log'](_0x235a19(0x21c),_0x49b65f);let _0x36968e=nodemailer['createTransport']({'service':_0x235a19(0x179),'auth':{'user':_0x1c0c8e['email'],'pass':_0x1c0c8e[_0x235a19(0x199)]}}),_0x468166={'from':_0x1c0c8e[_0x235a19(0x21a)],'to':_0x47df0a[_0x235a19(0x21a)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x235a19(0x11b)+_0x235a19(0x13d)+_0x3ec1bc[0x0][_0x235a19(0x157)],'cid':_0x235a19(0x1d8)}],'html':'<!DOCTYPE\x20html>'+_0x235a19(0x151)+_0x235a19(0x1f5)+_0x235a19(0x11c)+_0x235a19(0x11d)+_0x235a19(0x11c)+_0x235a19(0x1fa)+_0x235a19(0x185)+_0x235a19(0x11c)+_0x235a19(0x17c)+_0x3ec1bc[0x0][_0x235a19(0x1d3)]+'\x20</h2>'+_0x235a19(0x185)+_0x235a19(0x185)+_0x235a19(0x155)+_0x235a19(0x11c)+_0x235a19(0x1ef)+_0x235a19(0x12d)+_0x103d6b+'\x20'+_0x235a19(0x177)+_0x235a19(0x1ec)+_0x11a850+'\x20'+'</span>'+_0x235a19(0x1b4)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x235a19(0x138)+_0x235a19(0x201)+_0x235a19(0x1b1)+_0x235a19(0x16a)+_0x235a19(0x217)+_0x235a19(0x17e)+_0x235a19(0x1c1)+_0x235a19(0x1c5)+_0x235a19(0x1e4)+'\x20'+_0x49b65f+'\x20'+_0x235a19(0x1e3)+_0x235a19(0x130)+_0x235a19(0x11c)+_0x235a19(0x19f)+'<h5>'+_0x3ec1bc[0x0]['site_title']+'</h5>'+_0x235a19(0x185)+_0x235a19(0x185)+_0x235a19(0x1ad)};_0x36968e[_0x235a19(0x1d5)](_0x468166,function(_0x48f390,_0x47d043){var _0xac5b31=_0x235a19;_0x48f390?(console[_0xac5b31(0x172)](_0x48f390),console['log'](_0xac5b31(0x1e0))):console[_0xac5b31(0x172)](_0xac5b31(0x1f1));}),_0x27e079['flash']('success',_0x235a19(0x1ee)),_0x56e01a[_0x235a19(0x1e7)](_0x235a19(0x213));}catch(_0x3d5801){console['log'](_0x3d5801),_0x56e01a[_0x235a19(0x116)](0xc8)[_0x235a19(0x149)]({'message1':_0x3d5801['message']});}}),router[a0_0x598093(0x1cd)](a0_0x598093(0x13c),auth,async(_0x4e162b,_0x4ec391)=>{var _0x2fd622=a0_0x598093;try{const {username:_0x378752,email:_0x5d9542,role:_0x5f14ed}=_0x4e162b[_0x2fd622(0x181)],_0x171b98=_0x4e162b['user'],_0x4e41ed=await profile[_0x2fd622(0x1c4)]({'email':_0x171b98['email']}),_0x20fd60=await master_shop[_0x2fd622(0x1a1)]();console[_0x2fd622(0x172)](_0x2fd622(0x1d0),_0x20fd60);const _0x3c623f=_0x4e162b[_0x2fd622(0x11a)]['id'],_0x206f45=await sales[_0x2fd622(0x19d)](_0x3c623f);console['log'](_0x2fd622(0x1ae),_0x206f45);if(_0x20fd60[0x0]['language']=='English\x20(US)')var _0x2ba474=users[_0x2fd622(0x15d)];else{if(_0x20fd60[0x0][_0x2fd622(0x187)]=='Hindi')var _0x2ba474=users[_0x2fd622(0x1c0)];else{if(_0x20fd60[0x0][_0x2fd622(0x187)]==_0x2fd622(0x145))var _0x2ba474=users[_0x2fd622(0x145)];else{if(_0x20fd60[0x0][_0x2fd622(0x187)]==_0x2fd622(0x141))var _0x2ba474=users['Spanish'];else{if(_0x20fd60[0x0][_0x2fd622(0x187)]==_0x2fd622(0x19c))var _0x2ba474=users[_0x2fd622(0x19c)];else{if(_0x20fd60[0x0]['language']==_0x2fd622(0x159))var _0x2ba474=users[_0x2fd622(0x15f)];else{if(_0x20fd60[0x0]['language']==_0x2fd622(0x1be))var _0x2ba474=users[_0x2fd622(0x1be)];else{if(_0x20fd60[0x0]['language']==_0x2fd622(0x158))var _0x2ba474=users['Arabic'];}}}}}}}_0x4ec391[_0x2fd622(0x193)](_0x2fd622(0x161),{'success':_0x4e162b[_0x2fd622(0x13b)]('success'),'errors':_0x4e162b['flash'](_0x2fd622(0x124)),'role':_0x171b98,'profile':_0x4e41ed,'alldata':_0x206f45,'master_shop':_0x20fd60,'language':_0x2ba474});}catch(_0x5d7033){console[_0x2fd622(0x172)](_0x5d7033);}}),router[a0_0x598093(0x1cf)](a0_0x598093(0x152),async(_0xd75f05,_0x897462)=>{var _0x1bd1e4=a0_0x598093;const {product_code:_0x5c7b0d,warehouse_name:_0x33e65e,rooms_data:_0x23cb85,Roomslist:_0x449924}=_0xd75f05[_0x1bd1e4(0x20c)],_0xb4bce7=_0x449924[_0x1bd1e4(0x174)](','),_0x26e8fc=[];async function _0x3cbc76(_0x5ab022){var _0x295851=_0x1bd1e4;const _0x251f60=await warehouse[_0x295851(0x212)]([{'$match':{'name':_0x33e65e,'room':_0x5ab022}},{'$unwind':_0x295851(0x1d7)},{'$match':{'product_details.primary_code':_0x5c7b0d}},{'$group':{'_id':_0x295851(0x14f),'name':{'$first':_0x295851(0x135)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x295851(0x1a8)},'secondary_code':{'$first':_0x295851(0x1fc)},'product_code':{'$first':_0x295851(0x205)},'level':{'$first':_0x295851(0x1a6)},'isle':{'$first':_0x295851(0x1f7)},'type':{'$first':_0x295851(0x17d)},'pallet':{'$first':_0x295851(0x200)},'unit':{'$first':_0x295851(0x1d2)},'secondary_unit':{'$first':_0x295851(0x219)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x295851(0x17b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x295851(0x1a4)},'maxPerUnit':{'$first':_0x295851(0x19e)},'batch_code':{'$first':_0x295851(0x184)},'product_cat':{'$first':_0x295851(0x1b6)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x295851(0x12c)},'invoice':{'$first':_0x295851(0x1b8)},'actual_qty':{'$first':_0x295851(0x183)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x172f94=await warehouse[_0x295851(0x212)]([{'$match':{'name':_0x33e65e,'room':_0x5ab022}},{'$unwind':_0x295851(0x1d7)},{'$match':{'product_details.secondary_code':_0x5c7b0d}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x295851(0x135)},'product_stock':{'$first':_0x295851(0x221)},'primary_code':{'$first':_0x295851(0x1a8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x295851(0x1a6)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x295851(0x200)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x295851(0x219)},'storage':{'$first':_0x295851(0x1fb)},'rack':{'$first':_0x295851(0x17b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x295851(0x1a4)},'maxPerUnit':{'$first':_0x295851(0x19e)},'batch_code':{'$first':_0x295851(0x184)},'product_cat':{'$first':_0x295851(0x1b6)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x295851(0x12c)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x251f60[_0x295851(0x197)]>0x0)_0x26e8fc[_0x295851(0x1aa)](_0x251f60);else _0x172f94[_0x295851(0x197)]>0x0&&_0x26e8fc[_0x295851(0x1aa)](_0x172f94);}const _0x150442=_0xb4bce7[_0x1bd1e4(0x160)](_0x27994c=>_0x3cbc76(_0x27994c));await Promise['all'](_0x150442),_0x897462[_0x1bd1e4(0x149)](_0x26e8fc);}),module[a0_0x598093(0x128)]=router;