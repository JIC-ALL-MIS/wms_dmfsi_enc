var a0_0x2c2a86=a0_0x27b4;(function(_0x4afcec,_0x1e7e54){var _0x1e566e=a0_0x27b4,_0x5c9878=_0x4afcec();while(!![]){try{var _0x4e4ea7=-parseInt(_0x1e566e(0xda))/0x1+-parseInt(_0x1e566e(0x138))/0x2+-parseInt(_0x1e566e(0x175))/0x3+-parseInt(_0x1e566e(0x183))/0x4*(-parseInt(_0x1e566e(0x12d))/0x5)+parseInt(_0x1e566e(0x182))/0x6+-parseInt(_0x1e566e(0x109))/0x7*(-parseInt(_0x1e566e(0x134))/0x8)+-parseInt(_0x1e566e(0x18b))/0x9*(-parseInt(_0x1e566e(0x118))/0xa);if(_0x4e4ea7===_0x1e7e54)break;else _0x5c9878['push'](_0x5c9878['shift']());}catch(_0x1aeb0c){_0x5c9878['push'](_0x5c9878['shift']());}}}(a0_0x6c07,0x1a603));function a0_0x6c07(){var _0x281d85=['finalize','../middleware/auth','rack','slice','$product_details.maxPerUnit','catch','$sale_product','Portuguese\x20(BR)','port','sale_qty','Sales\x20Mail','/view/add_sales','message','$product_details.product_stock','back','json','/../public','/upload/','return_data','33593YbMACE','/preview/:id','note','$product_details.bay','Portuguese','customers','Logo.png','push','<strong>\x20Regards\x20</strong>','logo','length','$product.product_name','</tbody>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','1940lSBNrA','Floor','$product_details.isle','customers_docs','$invoice','OUT-','</h5>','Shelves','batch_code','prod_cat','<tr>','SCRN','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_name','host','quantity','$product_details.batch_code','<!DOCTYPE\x20html>','received_amount','/view/add_sale/product','850ZsCASl','id_transaction_from','purchases_data','/view','$product_details._id','sales_invoice','RoomAssigned','240aHpXOU','body','</thead>','findById','159976jRAZXt','sales_quantity','split','Sale\x20Return','</body></html>','gmail','\x20Order\x20Date\x20:\x20','<h5>','$product_details.primary_code','max_per_unit','../models/all_models','toString','expiry_date','English','Sales\x20Update\x20successfully','express','language','/all_sales/preview/','get','due_amount','/view/return_sales/:id','room_name','An\x20error\x20occurred.','user','delivery_date','staff','bin','return_qty','$name','$product_details.level','<h2>\x20','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.product_code','Sales\x20Add\x20successfully','</table>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','production_date','actual_uom','Enclosed','Email\x20sent\x20successfully','<html><head><title></title>','exports','forEach','then','</td>','floor','getFullYear','product_details','storage','barcode\x20user_id','False','nodemailer','quantity_notConverted','Receiving\x20Area','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','edit_sales_view','email','primary_unit','$date','$finalize','Raw\x20Materials','640077kFvMMS','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</div>','log','bay','currency','product_list','image','$customers_docs','filter','859014QrUWcX','4472McRajT','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','</span>','$product_details.actual_uom','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','getDate','carton','date','3627qrbssX','maxperunit','role','name','$note','Hindi','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','An\x20error\x20occurred\x20while\x20saving\x20data.','product_stock','Arabic','$sale_product.type','render','site_title','<span\x20style=\x22float:\x20right;\x22>','user_id','return_sale','$sale_product.floorlevel','$warehouse_name','actual_qty','stock','warehouse_name','$product_details.secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','secondary_code','Chinese','Return\x20Rooms','$product_details','findOne','warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/all_sales/view','stocks','concat','$room','$product_details.storage','isAllowEdit','Level','\x20</h2>','flash','sales\x20all_data','abs','$product_details.pallet','French','padStart','Arabic\x20(ae)','$product','amount','$product_details.secondary_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','sendMail','all_sales','$product_details.expiry_date','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.type','/barcode/:id','product_code','unit','errors','find','$product_details.bin','customer','Router','<tbody\x20style=\x22text-align:\x20center;\x22>','all','secondary_unit','<hr\x20class=\x22my-3\x22>','sale_product','params','edit_sales','add_sales','$return_data','requested_qty','Enabled','foreach\x20newproduct','product','save','post','room','Return\x20Goods','$isAllowEdit','$product_details.invoice','$sale_product.bin','product_data','map','prod_code','type','random','status','types','$product_details.product_name','Sale\x20Return\x20Mail','error','aggregate','delivery_code','\x20Order\x20Number\x20:\x20','level','floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.floorlevel','../public/language/languages.json','/view/:id','payment\x20successfull','$customer','153999haTfRG','_id','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','redirect','invoice','$product_details.production_date','createTransport','English\x20(US)','True','</tr>','id_transact','string','$sale_product.bay','German','sales\x20item\x20return\x20successfull','</head><body>','primary_code','barcode\x20Product\x20master','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$sale_product.quantity','stock_data','$product_details.product_cat','Received\x20Payment\x20For\x20Sale','<div>','$product_details.actual_qty','master'];a0_0x6c07=function(){return _0x281d85;};return a0_0x6c07();}function a0_0x27b4(_0x2422eb,_0x3af7f2){var _0x6c0792=a0_0x6c07();return a0_0x27b4=function(_0x27b4ef,_0x18dd15){_0x27b4ef=_0x27b4ef-0xa5;var _0xfe5320=_0x6c0792[_0x27b4ef];return _0xfe5320;},a0_0x27b4(_0x2422eb,_0x3af7f2);}const express=require(a0_0x2c2a86(0x147)),app=express(),router=express[a0_0x2c2a86(0xb0)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x2c2a86(0x142)),auth=require(a0_0x2c2a86(0xf7)),nodemailer=require(a0_0x2c2a86(0x16b)),users=require(a0_0x2c2a86(0xd6));router[a0_0x2c2a86(0x14a)](a0_0x2c2a86(0x130),auth,async(_0x4269e2,_0x2b74fc)=>{var _0x3c5cea=a0_0x2c2a86;try{const {username:_0xab32ac,email:_0x1db0f4,role:_0x1bc0d7}=_0x4269e2[_0x3c5cea(0x14f)],_0x2a6605=_0x4269e2['user'],_0x258017=await profile[_0x3c5cea(0x1a6)]({'email':_0x2a6605[_0x3c5cea(0x170)]}),_0x42bb27=await master_shop[_0x3c5cea(0xad)]();let _0x12de31;if(_0x2a6605['role']==_0x3c5cea(0x151)){const _0x1edace=await staff[_0x3c5cea(0x1a6)]({'email':_0x2a6605[_0x3c5cea(0x170)]});_0x12de31=await sales[_0x3c5cea(0xcf)]([{'$lookup':{'from':_0x3c5cea(0x10e),'localField':_0x3c5cea(0xaf),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0x3c5cea(0x180)},{'$unwind':_0x3c5cea(0xfc)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3c5cea(0x11c)},'customers':{'$first':_0x3c5cea(0xd9)},'date':{'$first':_0x3c5cea(0x172)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3c5cea(0xfc)},'note':{'$first':_0x3c5cea(0x18f)},'return_data':{'$first':_0x3c5cea(0xb9)},'customers_docs':{'$first':_0x3c5cea(0x180)},'total_saleproduct_quantity':{'$sum':_0x3c5cea(0xef)},'level':{'$addToSet':_0x3c5cea(0xe7)},'isle':{'$addToSet':_0x3c5cea(0xc4)},'type':{'$addToSet':_0x3c5cea(0x195)},'pallet':{'$addToSet':_0x3c5cea(0x19b)},'finalize':{'$first':_0x3c5cea(0x173)},'isAllowEdit':{'$first':_0x3c5cea(0xc2)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x12de31=await sales[_0x3c5cea(0xcf)]([{'$lookup':{'from':_0x3c5cea(0x10e),'localField':_0x3c5cea(0xaf),'foreignField':_0x3c5cea(0x18e),'as':_0x3c5cea(0x11b)}},{'$unwind':_0x3c5cea(0x180)},{'$unwind':_0x3c5cea(0xfc)},{'$group':{'_id':_0x3c5cea(0x178),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3c5cea(0xd9)},'date':{'$first':_0x3c5cea(0x172)},'warehouse_name':{'$first':_0x3c5cea(0x19c)},'sale_product':{'$push':_0x3c5cea(0xfc)},'note':{'$first':_0x3c5cea(0x18f)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x3c5cea(0xc4)},'type':{'$addToSet':_0x3c5cea(0x195)},'pallet':{'$addToSet':_0x3c5cea(0x19b)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3c5cea(0x17b)](_0x3c5cea(0x1b2),_0x12de31);if(_0x42bb27[0x0][_0x3c5cea(0x148)]==_0x3c5cea(0xe2)){var _0x36af32=users['English'];console['log'](_0x36af32);}else{if(_0x42bb27[0x0][_0x3c5cea(0x148)]==_0x3c5cea(0x190))var _0x36af32=users['Hindi'];else{if(_0x42bb27[0x0]['language']==_0x3c5cea(0xe8))var _0x36af32=users[_0x3c5cea(0xe8)];else{if(_0x42bb27[0x0][_0x3c5cea(0x148)]=='Spanish')var _0x36af32=users[_0x3c5cea(0x176)];else{if(_0x42bb27[0x0][_0x3c5cea(0x148)]=='French')var _0x36af32=users[_0x3c5cea(0x1b5)];else{if(_0x42bb27[0x0][_0x3c5cea(0x148)]==_0x3c5cea(0xfd))var _0x36af32=users[_0x3c5cea(0x10d)];else{if(_0x42bb27[0x0][_0x3c5cea(0x148)]==_0x3c5cea(0x1a3))var _0x36af32=users[_0x3c5cea(0x1a3)];else{if(_0x42bb27[0x0][_0x3c5cea(0x148)]=='Arabic\x20(ae)')var _0x36af32=users[_0x3c5cea(0x194)];}}}}}}}_0x2b74fc[_0x3c5cea(0x196)](_0x3c5cea(0xa5),{'success':_0x4269e2['flash'](_0x3c5cea(0xed)),'errors':_0x4269e2[_0x3c5cea(0x1b1)](_0x3c5cea(0xac)),'sales':_0x12de31,'profile':_0x258017,'role':_0x2a6605,'master_shop':_0x42bb27,'language':_0x36af32});}catch(_0x3ff1ac){console[_0x3c5cea(0x17b)](_0x3ff1ac);}});async function getRandom8DigitNumber(){var _0x4bcc96=a0_0x2c2a86;const _0x22f557=0x989680,_0x4ef53d=0x5f5e0ff,_0x2ac45e=Math[_0x4bcc96(0x165)](Math[_0x4bcc96(0xc9)]()*(_0x4ef53d-_0x22f557+0x1))+_0x22f557;var _0x4c6a96;const _0x5f4941=await sales[_0x4bcc96(0x1a6)]({'invoice':'OUT-'+_0x2ac45e});return _0x5f4941&&_0x5f4941[_0x4bcc96(0x113)]>0x0?_0x4c6a96='OUT-'+_0x2ac45e:_0x4c6a96=_0x4bcc96(0x11d)+_0x2ac45e,_0x4c6a96;}router['get'](a0_0x2c2a86(0x101),auth,async(_0x5526ed,_0xb018ea)=>{var _0x2822ae=a0_0x2c2a86;try{const {username:_0x47663f,email:_0x6241a7,role:_0x1c6f87}=_0x5526ed[_0x2822ae(0x14f)],_0x379e19=_0x5526ed[_0x2822ae(0x14f)],_0x717e9=await profile[_0x2822ae(0x1a6)]({'email':_0x379e19[_0x2822ae(0x170)]}),_0x443399=await master_shop[_0x2822ae(0xad)](),_0x255679=await customer[_0x2822ae(0xad)]({});let _0x2ec356;if(_0x379e19[_0x2822ae(0x18d)]==_0x2822ae(0x151)){const _0x105463=await staff['findOne']({'email':_0x379e19[_0x2822ae(0x170)]});_0x2ec356=await warehouse[_0x2822ae(0xcf)]([{'$match':{'status':_0x2822ae(0xbb),'name':_0x105463['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x2822ae(0xc1)}}},{'$group':{'_id':'$name','name':{'$first':_0x2822ae(0x154)}}},{'$sort':{'name':0x1}}]);}else _0x2ec356=await warehouse[_0x2822ae(0xcf)]([{'$match':{'status':_0x2822ae(0xbb),'warehouse_category':_0x2822ae(0x174),'name':{'$ne':_0x2822ae(0xc1)}}},{'$group':{'_id':_0x2822ae(0x154),'name':{'$first':_0x2822ae(0x154)}}},{'$sort':{'name':0x1}}]);const _0x2d12c0=await product['find']({});var _0x25689b=['Ambient',_0x2822ae(0x15e)];const _0x19c8d5=await sales[_0x2822ae(0xad)]({}),_0x1e17c9=_0x19c8d5[_0x2822ae(0x113)]+0x1,_0x5844bd='OUT-'+_0x1e17c9[_0x2822ae(0x143)]()[_0x2822ae(0x1b6)](0x5,'0');if(_0x443399[0x0][_0x2822ae(0x148)]==_0x2822ae(0xe2)){var _0x414097=users['English'];console[_0x2822ae(0x17b)](_0x414097);}else{if(_0x443399[0x0][_0x2822ae(0x148)]==_0x2822ae(0x190))var _0x414097=users[_0x2822ae(0x190)];else{if(_0x443399[0x0][_0x2822ae(0x148)]==_0x2822ae(0xe8))var _0x414097=users[_0x2822ae(0xe8)];else{if(_0x443399[0x0][_0x2822ae(0x148)]==_0x2822ae(0x176))var _0x414097=users['Spanish'];else{if(_0x443399[0x0][_0x2822ae(0x148)]==_0x2822ae(0x1b5))var _0x414097=users[_0x2822ae(0x1b5)];else{if(_0x443399[0x0]['language']==_0x2822ae(0xfd))var _0x414097=users[_0x2822ae(0x10d)];else{if(_0x443399[0x0][_0x2822ae(0x148)]==_0x2822ae(0x1a3))var _0x414097=users['Chinese'];else{if(_0x443399[0x0][_0x2822ae(0x148)]==_0x2822ae(0x1b7))var _0x414097=users[_0x2822ae(0x194)];}}}}}}}const _0x3c053a=getRandom8DigitNumber();_0x3c053a[_0x2822ae(0x163)](_0x1d6c8d=>{var _0x390986=_0x2822ae;_0xb018ea[_0x390986(0x196)](_0x390986(0xb8),{'success':_0x5526ed[_0x390986(0x1b1)]('success'),'errors':_0x5526ed[_0x390986(0x1b1)]('errors'),'role':_0x379e19,'profile':_0x717e9,'customer':_0x255679,'warehouse':_0x2ec356,'product':_0x2d12c0,'invoice':_0x1d6c8d,'master_shop':_0x443399,'language':_0x414097,'rooms_data':_0x25689b});})[_0x2822ae(0xfb)](_0x26360e=>{var _0x3fabf0=_0x2822ae;_0x5526ed['flash'](_0x3fabf0(0xac),_0x3fabf0(0x15b)),_0xb018ea[_0x3fabf0(0xde)]('/all_sales/view');});}catch(_0x3dfa67){console[_0x2822ae(0x17b)](_0x3dfa67);}}),router[a0_0x2c2a86(0x14a)]('/view/add_sales/:id',auth,async(_0x3fe4c2,_0x681cc1)=>{var _0x51f316=a0_0x2c2a86;try{const _0x24fc36=_0x3fe4c2[_0x51f316(0xb6)]['id'];console[_0x51f316(0x17b)](_0x24fc36);const _0x300804=await product[_0x51f316(0xad)](),_0x18e083=await purchases[_0x51f316(0xcf)]([{'$match':{'warehouse_name':_0x24fc36}},{'$unwind':_0x51f316(0x1b8)},{'$group':{'_id':_0x51f316(0x114)}}]);console['log'](_0x51f316(0x12f),_0x18e083),_0x681cc1[_0x51f316(0xca)](0xc8)['json']({'purchases_data':_0x18e083,'product_data':_0x300804});}catch(_0x1a0729){console[_0x51f316(0x17b)](_0x1a0729);}}),router[a0_0x2c2a86(0xbf)](a0_0x2c2a86(0x12c),auth,async(_0x168b8b,_0x3f8f02)=>{var _0x149eaf=a0_0x2c2a86;try{const {warehouse_data:_0x50408c,product_data:_0x2bc47c}=_0x168b8b[_0x149eaf(0x135)];console[_0x149eaf(0x17b)](_0x168b8b[_0x149eaf(0x135)][_0x149eaf(0xc5)]);;const _0x442c56=await master_shop[_0x149eaf(0xad)]();console[_0x149eaf(0x17b)](_0x149eaf(0xf5),_0x442c56);const _0x23e88d=await product['findOne']({'name':_0x2bc47c});console['log'](_0x149eaf(0xbd),_0x23e88d);const _0x30a729=await warehouse[_0x149eaf(0xcf)]([{'$match':{'name':_0x50408c}},{'$unwind':_0x149eaf(0x1a5)},{'$match':{'product_details.product_name':_0x2bc47c}},{'$group':{'_id':_0x149eaf(0xcc),'product_stock':{'$first':_0x149eaf(0x103)}}}]);console[_0x149eaf(0x17b)]('stock_data',_0x30a729),_0x3f8f02['status'](0xc8)[_0x149eaf(0x105)]({'master':_0x442c56,'new_product':_0x23e88d,'stock_data':_0x30a729});}catch(_0x398877){console[_0x149eaf(0x17b)](_0x398877);}}),router[a0_0x2c2a86(0xbf)](a0_0x2c2a86(0x101),auth,async(_0x5badb4,_0x5a022c)=>{var _0x3487a0=a0_0x2c2a86;try{const {invoice:_0xb34201,date:_0x37a7ab,warehouse_name:_0x35078c,product_name:_0xf0b064,stock:_0x3b73fa,quantity:_0x54b7ab,note:_0x59bcfb,room:_0x2bb525,primary_code:_0x22c6b2,secondary_code:_0x3b2b64,prod_code:_0x2dfc1f,level:_0x3c246f,isle:_0x45cf44,pallet:_0x4de218,batch_code:_0x481445,SCRN:_0x11837b,expiry_date:_0x819ea}=_0x5badb4['body'];if(typeof _0xf0b064==_0x3487a0(0xe6))var _0x3402ff=[_0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x126)]],_0x26156d=[_0x5badb4['body']['stock']],_0x2c89b7=[_0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x189)]],_0x6fed19=[_0x5badb4['body']['primary_code']],_0x433157=[_0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x1a2)]],_0xc780d=[_0x5badb4['body'][_0x3487a0(0xc7)]],_0x33a519=[_0x5badb4[_0x3487a0(0x135)]['level']],_0x3b59e9=[_0x5badb4[_0x3487a0(0x135)]['primary_unit']],_0x20e86b=[_0x5badb4[_0x3487a0(0x135)]['secondary_unit']],_0x19e958=[_0x5badb4[_0x3487a0(0x135)]['batch_code']],_0x52c900=[_0x5badb4[_0x3487a0(0x135)]['expiry_date']],_0x1cdeea=[_0x5badb4['body'][_0x3487a0(0x141)]],_0x164707=[_0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x15c)]],_0x2eb12e=[_0x5badb4[_0x3487a0(0x135)][_0x3487a0(0xba)]],_0x5316dc=[_0x5badb4[_0x3487a0(0x135)]['delivery_date']],_0x30dc20=[_0x5badb4[_0x3487a0(0x135)][_0x3487a0(0xd0)]],_0x2bf1dc=[_0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x121)]],_0x2bee77=[_0x5badb4['body']['quantity']],_0xbd64a3=[_0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x133)]],_0x463d0f=[_0x5badb4[_0x3487a0(0x135)]['prod_invoice']],_0x123b57=[_0x5badb4[_0x3487a0(0x135)]['actual_qty']],_0x2d3652=[_0x5badb4['body'][_0x3487a0(0x15d)]],_0x3afaba=[_0x5badb4[_0x3487a0(0x135)][_0x3487a0(0xe5)]];else var _0x3402ff=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x126)]],_0x26156d=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x19e)]],_0x2c89b7=[..._0x5badb4['body']['carton']],_0x6fed19=[..._0x5badb4[_0x3487a0(0x135)]['primary_code']],_0x433157=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x1a2)]],_0xc780d=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0xc7)]],_0x33a519=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0xd2)]],_0x3b59e9=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x171)]],_0x20e86b=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0xb3)]],_0x19e958=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x120)]],_0x52c900=[..._0x5badb4[_0x3487a0(0x135)]['expiry_date']],_0x1cdeea=[..._0x5badb4[_0x3487a0(0x135)]['max_per_unit']],_0x164707=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x15c)]],_0x2eb12e=[..._0x5badb4['body'][_0x3487a0(0xba)]],_0x5316dc=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x150)]],_0x30dc20=[..._0x5badb4['body'][_0x3487a0(0xd0)]],_0x2bf1dc=[..._0x5badb4[_0x3487a0(0x135)]['prod_cat']],_0x2bee77=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x128)]],_0xbd64a3=[..._0x5badb4[_0x3487a0(0x135)]['RoomAssigned']],_0x463d0f=[..._0x5badb4['body']['prod_invoice']],_0x123b57=[..._0x5badb4[_0x3487a0(0x135)][_0x3487a0(0x19d)]],_0x2d3652=[..._0x5badb4[_0x3487a0(0x135)]['actual_uom']],_0x3afaba=[..._0x5badb4[_0x3487a0(0x135)]['id_transact']];const _0xb36b08=_0x3402ff[_0x3487a0(0xc6)](_0x426672=>{return _0x426672={'product_name':_0x426672};});_0x26156d[_0x3487a0(0x162)]((_0x4fc49e,_0x559edf)=>{var _0x2d7ac8=_0x3487a0;_0xb36b08[_0x559edf]['stock']=Math[_0x2d7ac8(0x1b3)](_0x4fc49e);}),_0x123b57['forEach']((_0xc121f3,_0x415c5b)=>{var _0x2fa846=_0x3487a0;_0xb36b08[_0x415c5b][_0x2fa846(0x19d)]=Math[_0x2fa846(0x1b3)](_0xc121f3);}),_0x2d3652['forEach']((_0x49b4e9,_0x3a96fb)=>{_0xb36b08[_0x3a96fb]['actual_uom']=_0x49b4e9;}),_0x3afaba[_0x3487a0(0x162)]((_0x40ce92,_0x14b3a8)=>{_0xb36b08[_0x14b3a8]['id_transaction_from']=_0x40ce92;}),_0x2c89b7[_0x3487a0(0x162)]((_0x40ef45,_0x3fd56d)=>{var _0x370733=_0x3487a0;_0xb36b08[_0x3fd56d][_0x370733(0x128)]=_0x40ef45;}),_0x6fed19[_0x3487a0(0x162)]((_0x58e6f4,_0x50db7e)=>{var _0x5b8424=_0x3487a0;_0xb36b08[_0x50db7e][_0x5b8424(0xeb)]=_0x58e6f4;}),_0x433157[_0x3487a0(0x162)]((_0x1c31a5,_0x5eb161)=>{var _0x6e4bb1=_0x3487a0;_0xb36b08[_0x5eb161][_0x6e4bb1(0x1a2)]=_0x1c31a5;}),_0xc780d[_0x3487a0(0x162)]((_0x447d1,_0x39c67d)=>{var _0x443b05=_0x3487a0;_0xb36b08[_0x39c67d][_0x443b05(0xaa)]=_0x447d1;}),_0x33a519[_0x3487a0(0x162)]((_0x207fac,_0x3f4834)=>{var _0x4ab641=_0x3487a0;_0xbd64a3[_0x4ab641(0x162)]((_0x4d92e4,_0x26afbb)=>{var _0x50a2c8=_0x4ab641;if(_0x4d92e4=='Receiving\x20Area'&&_0x3f4834==_0x26afbb){var _0x1160db=_0x207fac['slice'](0x3);_0xb36b08[_0x3f4834]['storage']=_0x207fac[0x0],_0xb36b08[_0x3f4834][_0x50a2c8(0xf8)]=_0x207fac[0x1],_0xb36b08[_0x3f4834][_0x50a2c8(0x17c)]=0x0,_0xb36b08[_0x3f4834][_0x50a2c8(0x152)]=0x0,_0xb36b08[_0x3f4834][_0x50a2c8(0xc8)]='Floor',_0xb36b08[_0x3f4834][_0x50a2c8(0xd3)]=_0x1160db;}else{if(_0x4d92e4==_0x50a2c8(0x11f)&&_0x3f4834==_0x26afbb){var _0x1160db=_0x207fac[_0x50a2c8(0xf9)](0x3);_0xb36b08[_0x3f4834][_0x50a2c8(0x168)]=_0x207fac[0x0],_0xb36b08[_0x3f4834][_0x50a2c8(0xf8)]=_0x207fac[0x1],_0xb36b08[_0x3f4834][_0x50a2c8(0x17c)]=0x0,_0xb36b08[_0x3f4834]['bin']=0x0,_0xb36b08[_0x3f4834][_0x50a2c8(0xc8)]=_0x50a2c8(0x119),_0xb36b08[_0x3f4834][_0x50a2c8(0xd3)]=_0x207fac[0x5];}else{if(_0x3f4834==_0x26afbb){var _0x5c07dd;if(_0x207fac[0x4]=='L')_0x5c07dd='Level';else _0x207fac[0x4]=='F'&&(_0x5c07dd='Floor');_0xb36b08[_0x3f4834][_0x50a2c8(0x168)]=_0x207fac[0x0],_0xb36b08[_0x3f4834]['rack']=_0x207fac[0x1],_0xb36b08[_0x3f4834][_0x50a2c8(0x17c)]=_0x207fac[0x2],_0xb36b08[_0x3f4834]['bin']=_0x207fac[0x3],_0xb36b08[_0x3f4834][_0x50a2c8(0xc8)]=_0x5c07dd,_0xb36b08[_0x3f4834][_0x50a2c8(0xd3)]=_0x207fac[0x5];}}}});}),_0x3b59e9[_0x3487a0(0x162)]((_0x3f45e4,_0x497e0f)=>{var _0x44a6e1=_0x3487a0;_0xb36b08[_0x497e0f][_0x44a6e1(0xab)]=_0x3f45e4;}),_0x20e86b[_0x3487a0(0x162)]((_0x3512e1,_0x5bc565)=>{_0xb36b08[_0x5bc565]['secondary_unit']=_0x3512e1;}),_0x19e958[_0x3487a0(0x162)]((_0x475dcd,_0x1feb02)=>{var _0x5ed1bd=_0x3487a0;_0xb36b08[_0x1feb02][_0x5ed1bd(0x120)]=_0x475dcd;}),_0x52c900[_0x3487a0(0x162)]((_0x2bea85,_0x344437)=>{var _0x5be81e=_0x3487a0;_0xb36b08[_0x344437][_0x5be81e(0x144)]=_0x2bea85;}),_0x1cdeea[_0x3487a0(0x162)]((_0x2b86ff,_0x121ed0)=>{var _0xb5f2a9=_0x3487a0;_0xb36b08[_0x121ed0][_0xb5f2a9(0x18c)]=_0x2b86ff;}),_0x164707['forEach']((_0x322000,_0x2ac27b)=>{var _0xc1c7d2=_0x3487a0;_0xb36b08[_0x2ac27b][_0xc1c7d2(0x15c)]=_0x322000;}),_0x2eb12e[_0x3487a0(0x162)]((_0x2a8277,_0x478547)=>{var _0x3a39ad=_0x3487a0;_0xb36b08[_0x478547][_0x3a39ad(0xba)]=_0x2a8277;}),_0x5316dc[_0x3487a0(0x162)]((_0x258828,_0x37e327)=>{_0xb36b08[_0x37e327]['delivery_date']=_0x258828;}),_0x30dc20[_0x3487a0(0x162)]((_0x25250d,_0x223757)=>{_0xb36b08[_0x223757]['delivery_code']=_0x25250d;}),_0x2bf1dc[_0x3487a0(0x162)]((_0x26ce4e,_0x27e107)=>{var _0x205f7d=_0x3487a0;_0xb36b08[_0x27e107][_0x205f7d(0x121)]=_0x26ce4e;}),_0x2bee77[_0x3487a0(0x162)]((_0x1b5eae,_0x119a64)=>{var _0x59e40d=_0x3487a0;_0xb36b08[_0x119a64][_0x59e40d(0x16c)]=_0x1b5eae;}),_0xbd64a3[_0x3487a0(0x162)]((_0x5990ce,_0x174a12)=>{_0xb36b08[_0x174a12]['room_name']=_0x5990ce;}),_0x463d0f[_0x3487a0(0x162)]((_0x3881a9,_0x505048)=>{var _0x7661ac=_0x3487a0;_0xb36b08[_0x505048][_0x7661ac(0xdf)]=_0x3881a9;});var _0x3dee48=0x0;_0xb36b08[_0x3487a0(0x162)](_0x2ebd68=>{var _0x6a5c9d=_0x3487a0;(_0x2ebd68[_0x6a5c9d(0x19e)]<_0x2ebd68[_0x6a5c9d(0x16c)]||_0x2ebd68[_0x6a5c9d(0x16c)]==0x0)&&(console[_0x6a5c9d(0x17b)](_0x6a5c9d(0xbc),_0x2ebd68),_0x3dee48++);});const _0x2ff275=_0xb36b08[_0x3487a0(0x181)](_0x1a1ff3=>_0x1a1ff3[_0x3487a0(0x128)]!=='0'&&_0x1a1ff3[_0x3487a0(0x128)]!==''),_0x3c4156=new sales({'invoice':_0xb34201,'customer':_0x5badb4[_0x3487a0(0x135)][_0x3487a0(0xaf)],'date':_0x37a7ab,'warehouse_name':_0x35078c,'sale_product':_0x2ff275,'note':_0x59bcfb,'room':_0x2bb525,'primary_code':_0x22c6b2,'secondary_code':_0x3b2b64,'prod_code':_0x2dfc1f,'SCRN':_0x11837b}),_0x25b02c=await _0x3c4156[_0x3487a0(0xbe)]();_0x5badb4[_0x3487a0(0x1b1)](_0x3487a0(0xed),_0x3487a0(0x159)),_0x5a022c[_0x3487a0(0xde)](_0x3487a0(0x149)+_0x25b02c['_id']);}catch(_0x29b638){console[_0x3487a0(0x17b)](_0x29b638);}}),router[a0_0x2c2a86(0x14a)](a0_0x2c2a86(0x10a),auth,async(_0x4a37c2,_0x28957a)=>{var _0x555553=a0_0x2c2a86;try{const {username:_0x41a3e9,email:_0x19bbba,role:_0x2dfb81}=_0x4a37c2[_0x555553(0x14f)],_0x2065a9=_0x4a37c2['user'],_0x5dda71=await profile[_0x555553(0x1a6)]({'email':_0x2065a9['email']}),_0x549e12=await master_shop[_0x555553(0xad)](),_0x323b29=_0x4a37c2[_0x555553(0xb6)]['id'],_0x430cd2=await sales[_0x555553(0x137)](_0x323b29),_0x510b08=await warehouse[_0x555553(0xcf)]([{'$match':{'name':_0x430cd2[_0x555553(0x19f)]}},{'$unwind':_0x555553(0x1a5)},{'$group':{'_id':_0x555553(0x131),'name':{'$first':_0x555553(0xcc)},'product_stock':{'$first':_0x555553(0x103)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x555553(0xae)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x555553(0xd5)},'primary_code':{'$first':_0x555553(0x140)},'secondary_code':{'$first':_0x555553(0x1ba)},'product_code':{'$first':_0x555553(0x158)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x555553(0xdc)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x555553(0xe0)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x4b0951=await customer[_0x555553(0xad)]({});let _0x4b8502;if(_0x2065a9[_0x555553(0x18d)]=='staff'){const _0x8d34ef=await staff[_0x555553(0x1a6)]({'email':_0x2065a9[_0x555553(0x170)]});_0x4b8502=await warehouse['aggregate']([{'$match':{'status':_0x555553(0xbb),'name':_0x8d34ef['warehouse']}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x4b8502=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x555553(0x154),'name':{'$first':_0x555553(0x154)}}}]);const _0x3f6ecf=await product[_0x555553(0xad)]({}),_0x3eb7e8=await suppliers[_0x555553(0xad)]({});if(_0x549e12[0x0][_0x555553(0x148)]=='English\x20(US)'){var _0x2fb239=users[_0x555553(0x145)];console[_0x555553(0x17b)](_0x2fb239);}else{if(_0x549e12[0x0]['language']==_0x555553(0x190))var _0x2fb239=users[_0x555553(0x190)];else{if(_0x549e12[0x0][_0x555553(0x148)]==_0x555553(0xe8))var _0x2fb239=users['German'];else{if(_0x549e12[0x0][_0x555553(0x148)]==_0x555553(0x176))var _0x2fb239=users[_0x555553(0x176)];else{if(_0x549e12[0x0]['language']=='French')var _0x2fb239=users['French'];else{if(_0x549e12[0x0][_0x555553(0x148)]==_0x555553(0xfd))var _0x2fb239=users[_0x555553(0x10d)];else{if(_0x549e12[0x0][_0x555553(0x148)]==_0x555553(0x1a3))var _0x2fb239=users[_0x555553(0x1a3)];else{if(_0x549e12[0x0][_0x555553(0x148)]==_0x555553(0x1b7))var _0x2fb239=users['Arabic'];}}}}}}}_0x28957a[_0x555553(0x196)](_0x555553(0x16f),{'success':_0x4a37c2[_0x555553(0x1b1)](_0x555553(0xed)),'errors':_0x4a37c2[_0x555553(0x1b1)](_0x555553(0xac)),'role':_0x2065a9,'profile':_0x5dda71,'customer':_0x4b0951,'warehouse':_0x4b8502,'product':_0x510b08,'user':_0x430cd2,'master_shop':_0x549e12,'unit':_0x3f6ecf,'language':_0x2fb239,'suppliers':_0x3eb7e8});}catch(_0xe3693f){console[_0x555553(0x17b)](_0xe3693f);}}),router['post'](a0_0x2c2a86(0x10a),auth,async(_0x4bd29b,_0x18953f)=>{var _0x586f99=a0_0x2c2a86;try{const _0xdf612b=_0x4bd29b['params']['id'],{invoice:_0x1e8f62,warehouse_name:_0x4838da,room:_0x3e5c31}=_0x4bd29b[_0x586f99(0x135)],_0x4190a3=await sales['findOne']({'invoice':_0x1e8f62}),_0x3881ca=_0x4190a3['sale_product'][_0x586f99(0xc6)](async _0x4cb909=>{var _0x2dffbd=_0x586f99,_0x243a46=await warehouse[_0x2dffbd(0x1a6)]({'name':_0x4838da,'room':_0x4cb909[_0x2dffbd(0x14d)],'warehouse_category':_0x2dffbd(0x174)});const _0x4c2130=_0x243a46[_0x2dffbd(0x167)]['map'](_0x5be44c=>{var _0x485254=_0x2dffbd;_0x5be44c[_0x485254(0x126)]==_0x4cb909[_0x485254(0x126)]&&_0x5be44c[_0x485254(0xd3)]==_0x4cb909[_0x485254(0xd3)]&&_0x5be44c[_0x485254(0xc8)]==_0x4cb909[_0x485254(0xc8)]&&_0x5be44c[_0x485254(0x152)]==_0x4cb909[_0x485254(0x152)]&&_0x5be44c['bay']==_0x4cb909[_0x485254(0x17c)]&&_0x5be44c['rack']==_0x4cb909[_0x485254(0xf8)]&&_0x5be44c[_0x485254(0x168)]==_0x4cb909[_0x485254(0x168)]&&_0x5be44c[_0x485254(0x144)]==_0x4cb909[_0x485254(0x144)]&&_0x5be44c[_0x485254(0x120)]==_0x4cb909[_0x485254(0x120)]&&_0x5be44c[_0x485254(0xdf)]==_0x4cb909['invoice']&&_0x5be44c[_0x485254(0xdb)]==_0x4cb909[_0x485254(0x12e)]&&(_0x5be44c[_0x485254(0x193)]=Math['max'](0x0,Math[_0x485254(0x1b3)](_0x5be44c[_0x485254(0x193)])-Math[_0x485254(0x1b3)](_0x4cb909[_0x485254(0x128)])));});return _0x243a46;});Promise[_0x586f99(0xb2)](_0x3881ca)[_0x586f99(0x163)](async _0x4c7fce=>{var _0x130835=_0x586f99;try{for(const _0x2db478 of _0x4c7fce){await _0x2db478['save']();}_0x4190a3[_0x130835(0xf6)]=_0x130835(0xe3);const _0x4b310a=await _0x4190a3[_0x130835(0xbe)](),_0x120121=await master_shop[_0x130835(0xad)](),_0x30867d=await email_settings[_0x130835(0x1a6)](),_0x49cc05=await supervisor_settings[_0x130835(0xad)]();var _0xbe4a3c=_0x4190a3[_0x130835(0xb5)],_0x102508='',_0x5415e0;for(_0x5415e0 in _0xbe4a3c){_0x102508+=_0x130835(0x122)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xbe4a3c[_0x5415e0]['product_name']+_0x130835(0x164)+_0x130835(0x187)+_0xbe4a3c[_0x5415e0][_0x130835(0xaa)]+_0x130835(0x164)+_0x130835(0x187)+_0xbe4a3c[_0x5415e0]['quantity']+_0x130835(0x164)+_0x130835(0x187)+_0xbe4a3c[_0x5415e0][_0x130835(0xab)]+'</td>'+_0x130835(0x187)+_0xbe4a3c[_0x5415e0]['secondary_unit']+_0x130835(0x164)+_0x130835(0x187)+_0x4190a3[_0x130835(0x19f)]+_0x130835(0x164)+_0x130835(0x187)+_0xbe4a3c[_0x5415e0][_0x130835(0x14d)]+_0x130835(0x164)+_0x130835(0x187)+_0xbe4a3c[_0x5415e0]['storage']+_0xbe4a3c[_0x5415e0]['rack']+_0xbe4a3c[_0x5415e0]['bay']+_0xbe4a3c[_0x5415e0]['bin']+_0xbe4a3c[_0x5415e0]['type'][0x0]+_0xbe4a3c[_0x5415e0][_0x130835(0xd3)]+_0x130835(0x164),_0x130835(0xe4);}let _0x5a41a4=nodemailer[_0x130835(0xe1)]({'host':_0x30867d[_0x130835(0x127)],'port':Number(_0x30867d[_0x130835(0xfe)]),'secure':![],'auth':{'user':_0x30867d['email'],'pass':_0x30867d['password']}}),_0x597201={'from':_0x30867d[_0x130835(0x170)],'to':_0x49cc05[0x0]['RMSEmail'],'subject':_0x130835(0x100),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x130835(0x107)+_0x120121[0x0][_0x130835(0x17f)],'cid':_0x130835(0x112)}],'html':_0x130835(0x12a)+_0x130835(0x160)+_0x130835(0xea)+_0x130835(0xf3)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x130835(0xf3)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x130835(0x17a)+_0x130835(0xf3)+'<h2>\x20'+_0x120121[0x0][_0x130835(0x197)]+'\x20</h2>'+'</div>'+'</div>'+_0x130835(0xb4)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x130835(0xd1)+_0x4190a3[_0x130835(0xdf)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x4190a3[_0x130835(0x18a)]+'\x20'+'</span>'+_0x130835(0x11e)+_0x130835(0x17a)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x130835(0x16e)+_0x130835(0x122)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x130835(0x179)+_0x130835(0x117)+_0x130835(0x1a1)+_0x130835(0xdd)+_0x130835(0x184)+_0x130835(0xee)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x130835(0xe4)+_0x130835(0x136)+_0x130835(0xb1)+'\x20'+_0x102508+'\x20'+'</tbody>'+'</table>'+_0x130835(0xf3)+_0x130835(0x111)+_0x130835(0x13f)+_0x120121[0x0][_0x130835(0x197)]+_0x130835(0x11e)+_0x130835(0x17a)+_0x130835(0x17a)+_0x130835(0x13c)};_0x5a41a4[_0x130835(0x1bc)](_0x597201,function(_0x20c9d4,_0x31d30c){var _0x364a4b=_0x130835;_0x20c9d4?(console[_0x364a4b(0x17b)](_0x20c9d4),console['log']('Error\x20Occurs')):console['log'](_0x364a4b(0x15f));}),_0x4bd29b[_0x130835(0x1b1)](_0x130835(0xed),_0x130835(0x146)),_0x18953f['redirect'](_0x130835(0x149)+_0xdf612b);}catch(_0xb21019){console[_0x130835(0xce)](_0xb21019),_0x18953f['status'](0x1f4)[_0x130835(0x105)]({'error':_0x130835(0x192)});}})['catch'](_0x1dc10a=>{var _0x59429d=_0x586f99;console['error'](_0x1dc10a),_0x18953f['status'](0x1f4)[_0x59429d(0x105)]({'error':_0x59429d(0x14e)});});}catch(_0x3b3c66){console['log'](_0x3b3c66);}}),router[a0_0x2c2a86(0x14a)](a0_0x2c2a86(0xd7),auth,async(_0x3eea87,_0x12ed7a)=>{var _0x156122=a0_0x2c2a86;try{const {username:_0x540721,email:_0xb588db,role:_0x4dc43c}=_0x3eea87[_0x156122(0x14f)],_0x2960c8=_0x3eea87[_0x156122(0x14f)],_0x4c6a85=await profile['findOne']({'email':_0x2960c8['email']}),_0x5847c2=await master_shop[_0x156122(0xad)](),_0x19e250=_0x3eea87[_0x156122(0xb6)]['id'],_0x230c9f=await sales['findById'](_0x19e250);var _0x1d016c=['Ambient',_0x156122(0x15e)];const _0x308711=await warehouse[_0x156122(0xcf)]([{'$match':{'name':_0x230c9f[_0x156122(0x19f)],'warehouse_category':_0x156122(0x174)}},{'$unwind':_0x156122(0x1a5)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x156122(0x103)},'bay':{'$first':_0x156122(0x10c)},'bin':{'$first':_0x156122(0xae)},'type':{'$first':_0x156122(0xa8)},'floorlevel':{'$first':_0x156122(0xd5)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x156122(0x1ba)},'product_code':{'$first':_0x156122(0x158)},'storage':{'$first':_0x156122(0x1ad)},'rack':{'$first':'$product_details.rack'}}}]),_0x5683be=await customer[_0x156122(0xad)]({});let _0x13818c;if(_0x2960c8['role']==_0x156122(0x151)){const _0x37b8ee=await staff[_0x156122(0x1a6)]({'email':_0x2960c8[_0x156122(0x170)]});_0x13818c=await warehouse[_0x156122(0xcf)]([{'$match':{'status':'Enabled','name':_0x37b8ee[_0x156122(0x1a7)],'warehouse_category':_0x156122(0x174)}},{'$group':{'_id':'$name','name':{'$first':_0x156122(0x154)}}}]);}else _0x13818c=await warehouse[_0x156122(0xcf)]([{'$match':{'status':_0x156122(0xbb),'warehouse_category':_0x156122(0x174)}},{'$group':{'_id':_0x156122(0x154),'name':{'$first':_0x156122(0x154)}}}]);const _0x5180d2=await product[_0x156122(0xad)]({});if(_0x5847c2[0x0][_0x156122(0x148)]==_0x156122(0xe2)){var _0x4e58da=users[_0x156122(0x145)];console['log'](_0x4e58da);}else{if(_0x5847c2[0x0][_0x156122(0x148)]=='Hindi')var _0x4e58da=users[_0x156122(0x190)];else{if(_0x5847c2[0x0][_0x156122(0x148)]==_0x156122(0xe8))var _0x4e58da=users['German'];else{if(_0x5847c2[0x0][_0x156122(0x148)]=='Spanish')var _0x4e58da=users[_0x156122(0x176)];else{if(_0x5847c2[0x0][_0x156122(0x148)]==_0x156122(0x1b5))var _0x4e58da=users['French'];else{if(_0x5847c2[0x0][_0x156122(0x148)]=='Portuguese\x20(BR)')var _0x4e58da=users['Portuguese'];else{if(_0x5847c2[0x0]['language']==_0x156122(0x1a3))var _0x4e58da=users[_0x156122(0x1a3)];else{if(_0x5847c2[0x0][_0x156122(0x148)]=='Arabic\x20(ae)')var _0x4e58da=users[_0x156122(0x194)];}}}}}}}_0x12ed7a['render'](_0x156122(0xb7),{'success':_0x3eea87[_0x156122(0x1b1)](_0x156122(0xed)),'errors':_0x3eea87[_0x156122(0x1b1)](_0x156122(0xac)),'role':_0x2960c8,'profile':_0x4c6a85,'customer':_0x5683be,'warehouse':_0x13818c,'product':_0x308711,'user':_0x230c9f,'master_shop':_0x5847c2,'unit':_0x5180d2,'language':_0x4e58da});}catch(_0x10a248){console[_0x156122(0x17b)](_0x10a248);}}),router[a0_0x2c2a86(0xbf)](a0_0x2c2a86(0xd7),auth,async(_0x5e02b9,_0x2f86a7)=>{var _0x4b76da=a0_0x2c2a86;try{const _0x21d268=_0x5e02b9[_0x4b76da(0xb6)]['id'],_0x20999b=await sales[_0x4b76da(0x1a6)]({'_id':_0x5e02b9[_0x4b76da(0xb6)]['id']}),_0x35ad47=await warehouse['findOne']({'name':_0x20999b['warehouse_name'],'room':_0x5e02b9['body'][_0x4b76da(0xc0)]}),{invoice:_0x3740aa,date:_0xab516d,warehouse_name:_0x266be4,product_name:_0xe08f9e,stock:_0x2dce34,quantity:_0x45d389,note:_0x4b8a7d,room:_0x5dbaf2,customer:_0x1f93ec,SCRN:_0x4b85de}=_0x5e02b9['body'];if(typeof _0xe08f9e==_0x4b76da(0xe6))var _0x28fe62=[_0x5e02b9[_0x4b76da(0x135)]['product_name']],_0x1a693e=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x19e)]],_0x2d6a63=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x189)]],_0x33ae61=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0xeb)]],_0x94541c=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x1a2)]],_0x301da6=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0xc7)]],_0x323db8=[_0x5e02b9['body'][_0x4b76da(0xd2)]],_0xca7d38=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x171)]],_0x1a4f67=[_0x5e02b9[_0x4b76da(0x135)]['secondary_unit']],_0x45bc5b=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x120)]],_0x249eb2=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x144)]],_0x2e378e=[_0x5e02b9[_0x4b76da(0x135)]['max_per_unit']],_0x5280f6=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x15c)]],_0x30925c=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0xba)]],_0x42ed27=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x150)]],_0x4f102c=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0xd0)]],_0x229883=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x121)]],_0x3b577d=[_0x5e02b9[_0x4b76da(0x135)]['quantity']],_0x24e33d=[_0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x133)]];else var _0x28fe62=[..._0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x126)]],_0x1a693e=[..._0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x19e)]],_0x2d6a63=[..._0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x189)]],_0x33ae61=[..._0x5e02b9[_0x4b76da(0x135)]['primary_code']],_0x94541c=[..._0x5e02b9[_0x4b76da(0x135)]['secondary_code']],_0x301da6=[..._0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0xc7)]],_0x323db8=[..._0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0xd2)]],_0xca7d38=[..._0x5e02b9['body'][_0x4b76da(0x171)]],_0x1a4f67=[..._0x5e02b9[_0x4b76da(0x135)]['secondary_unit']],_0x45bc5b=[..._0x5e02b9['body'][_0x4b76da(0x120)]],_0x249eb2=[..._0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x144)]],_0x2e378e=[..._0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x141)]],_0x5280f6=[..._0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x15c)]],_0x30925c=[..._0x5e02b9[_0x4b76da(0x135)]['requested_qty']],_0x42ed27=[..._0x5e02b9['body']['delivery_date']],_0x4f102c=[..._0x5e02b9[_0x4b76da(0x135)]['delivery_code']],_0x229883=[..._0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x121)]],_0x3b577d=[..._0x5e02b9[_0x4b76da(0x135)]['quantity']],_0x24e33d=[..._0x5e02b9[_0x4b76da(0x135)][_0x4b76da(0x133)]];const _0x52f0a2=_0x28fe62['map'](_0x59a5cc=>{return _0x59a5cc={'product_name':_0x59a5cc};});_0x1a693e[_0x4b76da(0x162)]((_0x747fa1,_0x5e93a3)=>{var _0x5d12f9=_0x4b76da;_0x52f0a2[_0x5e93a3][_0x5d12f9(0x19e)]=Math[_0x5d12f9(0x1b3)](_0x747fa1);}),_0x2d6a63[_0x4b76da(0x162)]((_0x237645,_0x543922)=>{var _0x22e605=_0x4b76da;_0x52f0a2[_0x543922][_0x22e605(0x128)]=_0x237645;}),_0x33ae61[_0x4b76da(0x162)]((_0x506e27,_0x519e12)=>{var _0x1e914b=_0x4b76da;_0x52f0a2[_0x519e12][_0x1e914b(0xeb)]=_0x506e27;}),_0x94541c[_0x4b76da(0x162)]((_0x54a173,_0x2fd88c)=>{var _0x284d7c=_0x4b76da;_0x52f0a2[_0x2fd88c][_0x284d7c(0x1a2)]=_0x54a173;}),_0x301da6['forEach']((_0x3679af,_0x2cd686)=>{var _0x32ae4c=_0x4b76da;_0x52f0a2[_0x2cd686][_0x32ae4c(0xaa)]=_0x3679af;}),_0x323db8['forEach']((_0x5b6bb0,_0x4afcb3)=>{var _0x57760f=_0x4b76da;_0x24e33d[_0x57760f(0x162)]((_0x1d3400,_0x3ea776)=>{var _0x435932=_0x57760f;if(_0x1d3400==_0x435932(0x16d)&&_0x4afcb3==_0x3ea776){var _0x4ad7a3=_0x5b6bb0[_0x435932(0xf9)](0x3);_0x52f0a2[_0x4afcb3]['storage']=_0x5b6bb0[0x0],_0x52f0a2[_0x4afcb3][_0x435932(0xf8)]=_0x5b6bb0[0x1],_0x52f0a2[_0x4afcb3][_0x435932(0x17c)]=0x0,_0x52f0a2[_0x4afcb3][_0x435932(0x152)]=0x0,_0x52f0a2[_0x4afcb3][_0x435932(0xc8)]='Floor',_0x52f0a2[_0x4afcb3][_0x435932(0xd3)]=_0x4ad7a3;}else{if(_0x1d3400==_0x435932(0x11f)&&_0x4afcb3==_0x3ea776){var _0x4ad7a3=_0x5b6bb0[_0x435932(0xf9)](0x3);_0x52f0a2[_0x4afcb3][_0x435932(0x168)]=_0x5b6bb0[0x0],_0x52f0a2[_0x4afcb3][_0x435932(0xf8)]=_0x5b6bb0[0x1],_0x52f0a2[_0x4afcb3]['bay']=0x0,_0x52f0a2[_0x4afcb3][_0x435932(0x152)]=0x0,_0x52f0a2[_0x4afcb3]['type']=_0x435932(0x119),_0x52f0a2[_0x4afcb3][_0x435932(0xd3)]=_0x5b6bb0[0x5];}else{if(_0x4afcb3==_0x3ea776){var _0x12ca9d;if(_0x5b6bb0[0x4]=='L')_0x12ca9d=_0x435932(0x1af);else _0x5b6bb0[0x4]=='F'&&(_0x12ca9d='Floor');_0x52f0a2[_0x4afcb3][_0x435932(0x168)]=_0x5b6bb0[0x0],_0x52f0a2[_0x4afcb3]['rack']=_0x5b6bb0[0x1],_0x52f0a2[_0x4afcb3][_0x435932(0x17c)]=_0x5b6bb0[0x2],_0x52f0a2[_0x4afcb3]['bin']=_0x5b6bb0[0x3],_0x52f0a2[_0x4afcb3][_0x435932(0xc8)]=_0x12ca9d,_0x52f0a2[_0x4afcb3][_0x435932(0xd3)]=_0x5b6bb0[0x5];}}}});}),_0xca7d38[_0x4b76da(0x162)]((_0x54e9e0,_0x1c605b)=>{var _0x260701=_0x4b76da;_0x52f0a2[_0x1c605b][_0x260701(0xab)]=_0x54e9e0;}),_0x1a4f67[_0x4b76da(0x162)]((_0x3348ba,_0x1deddb)=>{var _0x164099=_0x4b76da;_0x52f0a2[_0x1deddb][_0x164099(0xb3)]=_0x3348ba;}),_0x45bc5b[_0x4b76da(0x162)]((_0x50f418,_0x21d55c)=>{var _0x51193d=_0x4b76da;_0x52f0a2[_0x21d55c][_0x51193d(0x120)]=_0x50f418;}),_0x249eb2[_0x4b76da(0x162)]((_0x4ac77c,_0x22b557)=>{_0x52f0a2[_0x22b557]['expiry_date']=_0x4ac77c;}),_0x2e378e[_0x4b76da(0x162)]((_0x1e66a1,_0x3095e2)=>{var _0x1e4933=_0x4b76da;_0x52f0a2[_0x3095e2][_0x1e4933(0x18c)]=_0x1e66a1;}),_0x5280f6[_0x4b76da(0x162)]((_0x3cfe5d,_0x28c425)=>{var _0x5943b3=_0x4b76da;_0x52f0a2[_0x28c425][_0x5943b3(0x15c)]=_0x3cfe5d;}),_0x30925c[_0x4b76da(0x162)]((_0x546991,_0x62d39f)=>{var _0x3bf084=_0x4b76da;_0x52f0a2[_0x62d39f][_0x3bf084(0xba)]=Math['abs'](_0x546991);}),_0x42ed27[_0x4b76da(0x162)]((_0x28c78f,_0x958179)=>{var _0x82e4be=_0x4b76da;_0x52f0a2[_0x958179][_0x82e4be(0x150)]=_0x28c78f;}),_0x4f102c[_0x4b76da(0x162)]((_0x205d53,_0x116b11)=>{_0x52f0a2[_0x116b11]['delivery_code']=_0x205d53;}),_0x229883[_0x4b76da(0x162)]((_0x4cc144,_0x1bc47f)=>{var _0x5749d0=_0x4b76da;_0x52f0a2[_0x1bc47f][_0x5749d0(0x121)]=_0x4cc144;}),_0x3b577d[_0x4b76da(0x162)]((_0x221281,_0x4a5f3f)=>{var _0x2f0f2a=_0x4b76da;_0x52f0a2[_0x4a5f3f][_0x2f0f2a(0x16c)]=_0x221281;}),_0x24e33d['forEach']((_0x41237f,_0x5cf845)=>{var _0x3d79e1=_0x4b76da;_0x52f0a2[_0x5cf845][_0x3d79e1(0x14d)]=_0x41237f;});var _0x22aaa6=0x0;_0x52f0a2[_0x4b76da(0x162)](_0xd509fa=>{var _0x453eac=_0x4b76da;console[_0x453eac(0x17b)](_0x453eac(0xbc),_0xd509fa),(parseInt(_0xd509fa[_0x453eac(0x19e)])<parseInt(_0xd509fa[_0x453eac(0x128)])||parseInt(_0xd509fa['quantity'])==0x0)&&_0x22aaa6++;});if(_0x22aaa6!=0x0)return _0x5e02b9['flash'](_0x4b76da(0xac),_0x4b76da(0x157)),_0x2f86a7[_0x4b76da(0xde)](_0x4b76da(0x104));const _0x15c7e3=_0x52f0a2['filter'](_0x49e66a=>_0x49e66a[_0x4b76da(0x128)]!=='0'&&_0x49e66a['quantity']!=='');_0x20999b['invoice']=_0x3740aa,_0x20999b[_0x4b76da(0xaf)]=_0x1f93ec,_0x20999b[_0x4b76da(0x18a)]=_0xab516d,_0x20999b[_0x4b76da(0x19f)]=_0x266be4,_0x20999b[_0x4b76da(0xb5)]=_0x15c7e3,_0x20999b[_0x4b76da(0x10b)]=_0x4b8a7d,_0x20999b[_0x4b76da(0x123)]=_0x4b85de,_0x20999b[_0x4b76da(0xf6)]='False',_0x20999b[_0x4b76da(0x1ae)]=_0x4b76da(0x16a);const _0x153432=await _0x20999b['save']();_0x5e02b9[_0x4b76da(0x1b1)](_0x4b76da(0xed),'Sales\x20Update\x20successfully'),_0x2f86a7['redirect'](_0x4b76da(0x1a9));}catch(_0x5dede8){console[_0x4b76da(0x17b)](_0x5dede8);}}),router['post']('/give_payment/:id',auth,async(_0x177394,_0x1045d6)=>{var _0x520d94=a0_0x2c2a86;try{const _0x3c19a6=_0x177394[_0x520d94(0xb6)]['id'],{invoice:_0x49dfa4,customer:_0x435924,receivable_amount:_0x42512e,received_amount:_0x8f53cf}=_0x177394[_0x520d94(0x135)],_0x8cacfa=await sales['findById'](_0x3c19a6);console['log'](_0x8cacfa);var _0x1a0ddb=_0x42512e-_0x8f53cf;console['log'](_0x8f53cf),_0x8cacfa[_0x520d94(0x12b)]=parseFloat(_0x8f53cf)+parseFloat(_0x8cacfa['received_amount']),_0x8cacfa[_0x520d94(0x14b)]=_0x1a0ddb,console[_0x520d94(0x17b)](_0x8cacfa);const _0x238a58=await _0x8cacfa['save'](),_0x3a8333=await c_payment_data['findOne']({'invoice':_0x49dfa4});_0x3a8333[_0x520d94(0x1b9)]=_0x1a0ddb,await _0x3a8333[_0x520d94(0xbe)]();let _0x49403b=new Date(),_0x3f3849=('0'+_0x49403b[_0x520d94(0x188)]())[_0x520d94(0xf9)](-0x2),_0x2ac151=('0'+(_0x49403b['getMonth']()+0x1))[_0x520d94(0xf9)](-0x2),_0x1c2878=_0x49403b[_0x520d94(0x166)](),_0x3b52a1=_0x1c2878+'-'+_0x2ac151+'-'+_0x3f3849;const _0x3dc530=new customer_payment({'invoice':_0x49dfa4,'date':_0x1c2878+'-'+_0x2ac151+'-'+_0x3f3849,'customer':_0x435924,'reason':_0x520d94(0xf2),'amount':_0x8f53cf}),_0x20d993=await _0x3dc530[_0x520d94(0xbe)]();_0x177394[_0x520d94(0x1b1)]('success',_0x520d94(0xd8)),_0x1045d6[_0x520d94(0xde)]('/all_sales/view');}catch(_0x148066){console[_0x520d94(0x17b)](_0x148066);}}),router[a0_0x2c2a86(0x14a)]('/invoice/:id',auth,async(_0xc8bfe2,_0x32fdaf)=>{var _0x3cfe78=a0_0x2c2a86;try{const {username:_0x2f14fd,email:_0x120b97,role:_0x177f73}=_0xc8bfe2[_0x3cfe78(0x14f)],_0x596ab8=_0xc8bfe2[_0x3cfe78(0x14f)],_0x2db4eb=await profile[_0x3cfe78(0x1a6)]({'email':_0x596ab8[_0x3cfe78(0x170)]}),_0x35ee82=await master_shop[_0x3cfe78(0xad)]();console[_0x3cfe78(0x17b)](_0x3cfe78(0xf5),_0x35ee82);const _0x2ba7cb=_0xc8bfe2[_0x3cfe78(0xb6)]['id'],_0x518dc1=await sales[_0x3cfe78(0x137)](_0x2ba7cb);console[_0x3cfe78(0x17b)](_0x518dc1);const _0x2fec1f=await customer['findOne']({'name':_0x518dc1[_0x3cfe78(0xaf)]});console[_0x3cfe78(0x17b)](_0x2fec1f);if(_0x35ee82[0x0][_0x3cfe78(0x148)]==_0x3cfe78(0xe2)){var _0x212221=users[_0x3cfe78(0x145)];console[_0x3cfe78(0x17b)](_0x212221);}else{if(_0x35ee82[0x0]['language']==_0x3cfe78(0x190))var _0x212221=users[_0x3cfe78(0x190)];else{if(_0x35ee82[0x0][_0x3cfe78(0x148)]==_0x3cfe78(0xe8))var _0x212221=users[_0x3cfe78(0xe8)];else{if(_0x35ee82[0x0]['language']==_0x3cfe78(0x176))var _0x212221=users[_0x3cfe78(0x176)];else{if(_0x35ee82[0x0][_0x3cfe78(0x148)]==_0x3cfe78(0x1b5))var _0x212221=users['French'];else{if(_0x35ee82[0x0]['language']==_0x3cfe78(0xfd))var _0x212221=users[_0x3cfe78(0x10d)];else{if(_0x35ee82[0x0][_0x3cfe78(0x148)]==_0x3cfe78(0x1a3))var _0x212221=users[_0x3cfe78(0x1a3)];else{if(_0x35ee82[0x0][_0x3cfe78(0x148)]=='Arabic\x20(ae)')var _0x212221=users[_0x3cfe78(0x194)];}}}}}}}_0x32fdaf[_0x3cfe78(0x196)](_0x3cfe78(0x132),{'success':_0xc8bfe2[_0x3cfe78(0x1b1)](_0x3cfe78(0xed)),'errors':_0xc8bfe2[_0x3cfe78(0x1b1)](_0x3cfe78(0xac)),'role':_0x596ab8,'profile':_0x2db4eb,'master_shop':_0x35ee82,'customers':_0x2fec1f,'sales':_0x518dc1,'language':_0x212221});}catch(_0x42638c){console[_0x3cfe78(0x17b)](_0x42638c);}}),router[a0_0x2c2a86(0x14a)](a0_0x2c2a86(0x14c),auth,async(_0x471c35,_0x3957bc)=>{var _0x55998d=a0_0x2c2a86;try{const {username:_0x279d3c,email:_0x52a0a7,role:_0x4def7d}=_0x471c35[_0x55998d(0x14f)],_0x5033e9=_0x471c35[_0x55998d(0x14f)],_0xab2056=await profile[_0x55998d(0x1a6)]({'email':_0x5033e9[_0x55998d(0x170)]}),_0x28a98f=await master_shop[_0x55998d(0xad)]();console[_0x55998d(0x17b)](_0x55998d(0xf5),_0x28a98f);const _0x36e356=_0x471c35[_0x55998d(0xb6)]['id'];console['log'](_0x36e356);const _0x20d691=await sales[_0x55998d(0x137)](_0x36e356);console[_0x55998d(0x17b)](_0x55998d(0x199),_0x20d691);const _0x5549bb=await warehouse[_0x55998d(0xcf)]([{'$match':{'name':'Return\x20Goods','room':'Return\x20Rooms'}},{'$unwind':_0x55998d(0x1a5)},{'$group':{'_id':_0x55998d(0x131),'name':{'$first':_0x55998d(0xcc)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x55998d(0x155)},'isle':{'$first':_0x55998d(0x11a)},'pallet':{'$first':_0x55998d(0x1b4)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x55998d(0x17b)](_0x55998d(0xf0),_0x5549bb);const _0x1c96a6=await product['find']({});warehouse_data=await warehouse[_0x55998d(0xcf)]([{'$match':{'status':_0x55998d(0xbb),'name':_0x55998d(0xc1),'warehouse_category':_0x55998d(0x174)}},{'$group':{'_id':_0x55998d(0x154),'name':{'$first':_0x55998d(0x154)}}},{'$sort':{'name':0x1}}]);var _0xdaf636=[_0x55998d(0x1a4)];if(_0x28a98f[0x0]['language']==_0x55998d(0xe2)){var _0x13c42c=users['English'];console['log'](_0x13c42c);}else{if(_0x28a98f[0x0][_0x55998d(0x148)]==_0x55998d(0x190))var _0x13c42c=users[_0x55998d(0x190)];else{if(_0x28a98f[0x0]['language']=='German')var _0x13c42c=users[_0x55998d(0xe8)];else{if(_0x28a98f[0x0][_0x55998d(0x148)]==_0x55998d(0x176))var _0x13c42c=users[_0x55998d(0x176)];else{if(_0x28a98f[0x0][_0x55998d(0x148)]==_0x55998d(0x1b5))var _0x13c42c=users[_0x55998d(0x1b5)];else{if(_0x28a98f[0x0][_0x55998d(0x148)]==_0x55998d(0xfd))var _0x13c42c=users[_0x55998d(0x10d)];else{if(_0x28a98f[0x0]['language']=='Chinese')var _0x13c42c=users[_0x55998d(0x1a3)];else{if(_0x28a98f[0x0][_0x55998d(0x148)]=='Arabic\x20(ae)')var _0x13c42c=users[_0x55998d(0x194)];}}}}}}}_0x3957bc['render'](_0x55998d(0x19a),{'success':_0x471c35[_0x55998d(0x1b1)](_0x55998d(0xed)),'errors':_0x471c35[_0x55998d(0x1b1)](_0x55998d(0xac)),'role':_0x5033e9,'profile':_0xab2056,'user':_0x20d691,'stock':_0x5549bb,'master_shop':_0x28a98f,'unit':_0x1c96a6,'language':_0x13c42c,'warehouses':warehouse_data,'rooms':_0xdaf636});}catch(_0x79fc8){console[_0x55998d(0x17b)](_0x79fc8),_0x3957bc[_0x55998d(0xca)](0xc8)[_0x55998d(0x105)]({'message':_0x79fc8[_0x55998d(0x102)]});}}),router['post'](a0_0x2c2a86(0x14c),auth,async(_0x1800db,_0x342619)=>{var _0x121acc=a0_0x2c2a86;try{const {invoice:_0x4682f2,date:_0x5dfbac,warehouse_name:_0x2bf47e,product_name:_0x4c1e74,primary_code:_0x3b7a9a,secondary_code:_0x32abd9,product_code:_0x1d40a4,sales_quantity:_0x31d998,stocks:_0x472ec9,return_qty:_0x23904d,Room_name:_0x31419c,to_warehouse_name:_0x27e87c,to_Roomname:_0x52e7ab,to_Room_name:_0x5e9e6e,note:_0x417ed4,level:_0x57dbbb,isle:_0x38d056,pallet:_0x5bee90}=_0x1800db[_0x121acc(0x135)];if(typeof _0x4c1e74=='string')var _0x7817bf=[_0x1800db[_0x121acc(0x135)][_0x121acc(0x126)]],_0x3766ab=[_0x1800db[_0x121acc(0x135)][_0x121acc(0xeb)]],_0x268c23=[_0x1800db[_0x121acc(0x135)]['secondary_code']],_0x3a9625=[_0x1800db[_0x121acc(0x135)][_0x121acc(0xaa)]],_0x1d3882=[_0x1800db[_0x121acc(0x135)][_0x121acc(0x139)]],_0x443d06=[_0x1800db[_0x121acc(0x135)][_0x121acc(0x1aa)]],_0x54b5f6=[_0x1800db[_0x121acc(0x135)]['return_qty']],_0x1f7c5e=[_0x1800db[_0x121acc(0x135)][_0x121acc(0x17c)]],_0x5cc7d9=[_0x1800db[_0x121acc(0x135)][_0x121acc(0x152)]],_0x5b0b70=[_0x1800db[_0x121acc(0x135)]['types']],_0x444784=[_0x1800db[_0x121acc(0x135)][_0x121acc(0xd3)]];else var _0x7817bf=[..._0x1800db[_0x121acc(0x135)][_0x121acc(0x126)]],_0x3766ab=[..._0x1800db[_0x121acc(0x135)][_0x121acc(0xeb)]],_0x268c23=[..._0x1800db[_0x121acc(0x135)]['secondary_code']],_0x3a9625=[..._0x1800db[_0x121acc(0x135)][_0x121acc(0xaa)]],_0x1d3882=[..._0x1800db[_0x121acc(0x135)][_0x121acc(0x139)]],_0x443d06=[..._0x1800db[_0x121acc(0x135)][_0x121acc(0x1aa)]],_0x54b5f6=[..._0x1800db['body'][_0x121acc(0x153)]],_0x1f7c5e=[..._0x1800db[_0x121acc(0x135)][_0x121acc(0x17c)]],_0x5cc7d9=[..._0x1800db[_0x121acc(0x135)][_0x121acc(0x152)]],_0x5b0b70=[..._0x1800db[_0x121acc(0x135)][_0x121acc(0xcb)]],_0x444784=[..._0x1800db['body'][_0x121acc(0xd3)]];const _0x5b53c3=_0x7817bf[_0x121acc(0xc6)](_0x431805=>{return _0x431805={'product_name':_0x431805};});_0x3766ab[_0x121acc(0x162)]((_0x22c731,_0xdda7e1)=>{var _0x2e1042=_0x121acc;_0x5b53c3[_0xdda7e1][_0x2e1042(0xeb)]=_0x22c731;}),_0x268c23[_0x121acc(0x162)]((_0x2d2d55,_0x3f3ce5)=>{var _0x4a93a6=_0x121acc;_0x5b53c3[_0x3f3ce5][_0x4a93a6(0x1a2)]=_0x2d2d55;}),_0x3a9625['forEach']((_0x2eaf0f,_0x56b285)=>{var _0x321943=_0x121acc;_0x5b53c3[_0x56b285][_0x321943(0xaa)]=_0x2eaf0f;}),_0x1d3882[_0x121acc(0x162)]((_0x1413c0,_0x478f51)=>{var _0x400423=_0x121acc;_0x5b53c3[_0x478f51][_0x400423(0xff)]=_0x1413c0;}),_0x443d06['forEach']((_0x2120ea,_0x58088d)=>{var _0x542ab0=_0x121acc;_0x5b53c3[_0x58088d][_0x542ab0(0x19e)]=_0x2120ea;}),_0x54b5f6[_0x121acc(0x162)]((_0x40452c,_0x50d4cf)=>{var _0x4a8c15=_0x121acc;_0x5b53c3[_0x50d4cf][_0x4a8c15(0x153)]=_0x40452c;}),_0x1f7c5e[_0x121acc(0x162)]((_0x5ac8b5,_0x1d404f)=>{var _0x33e5d2=_0x121acc;_0x5b53c3[_0x1d404f][_0x33e5d2(0x17c)]=_0x5ac8b5;}),_0x5cc7d9['forEach']((_0x4ced7e,_0x4eba0f)=>{var _0x4d6323=_0x121acc;_0x5b53c3[_0x4eba0f][_0x4d6323(0x152)]=_0x4ced7e;}),_0x5b0b70['forEach']((_0x7e06e9,_0x4247b3)=>{var _0x68ae08=_0x121acc;_0x5b53c3[_0x4247b3][_0x68ae08(0xc8)]=_0x7e06e9;}),_0x444784[_0x121acc(0x162)]((_0x1c2828,_0x5c7a94)=>{var _0x169833=_0x121acc;_0x5b53c3[_0x5c7a94][_0x169833(0xd3)]=_0x1c2828;});var _0xc5a48b=0x0;_0x5b53c3[_0x121acc(0x162)](_0x292986=>{var _0x5afb26=_0x121acc;console[_0x5afb26(0x17b)](_0x5afb26(0xbc),_0x292986),(parseInt(_0x292986[_0x5afb26(0xff)])<parseInt(_0x292986[_0x5afb26(0x153)])||parseInt(_0x292986[_0x5afb26(0x19e)])<parseInt(_0x292986[_0x5afb26(0x153)])&&parseInt(_0x292986[_0x5afb26(0xff)])>parseInt(_0x292986[_0x5afb26(0x153)])||parseInt(_0x292986['return_qty'])==0x0)&&_0xc5a48b++;});if(_0xc5a48b!=0x0)return _0x1800db[_0x121acc(0x1b1)]('errors',_0x121acc(0x191)),_0x342619['redirect'](_0x121acc(0x104));const _0x3974ed=await sales[_0x121acc(0x1a6)]({'invoice':_0x4682f2});console['log'](_0x3974ed),_0x3974ed[_0x121acc(0x108)]=_0x121acc(0xe3);const _0x2c91f6=await _0x3974ed['save'](),_0x44c924=new sales_return({'invoice':_0x4682f2,'customer':_0x1800db[_0x121acc(0x135)][_0x121acc(0xaf)],'date':_0x5dfbac,'warehouse_name':_0x2bf47e,'room':_0x31419c,'ToWarehouse':_0x27e87c,'ToRoom':_0x5e9e6e,'return_sale':_0x5b53c3,'note':_0x417ed4}),_0x5a2034=await _0x44c924['save']();console[_0x121acc(0x17b)](_0x44c924);const _0x5e7204=await sales_return[_0x121acc(0x1a6)]({'invoice':_0x4682f2}),_0x589f58=await warehouse[_0x121acc(0x1a6)]({'name':_0x27e87c,'room':_0x5e9e6e});_0x5e7204[_0x121acc(0x19a)][_0x121acc(0x162)](_0x371d7f=>{var _0x3c0434=_0x121acc,_0x4b01cf=0x0;const _0x14789a=_0x589f58['product_details'][_0x3c0434(0xc6)](_0x588fb8=>{var _0x59124f=_0x3c0434;_0x588fb8['product_name']==_0x371d7f['product_name']&&_0x588fb8['floorlevel']==_0x371d7f[_0x59124f(0xd3)]&&_0x588fb8[_0x59124f(0xc8)]==_0x371d7f[_0x59124f(0xc8)]&&_0x588fb8[_0x59124f(0x152)]==_0x371d7f[_0x59124f(0x152)]&&_0x588fb8[_0x59124f(0x17c)]==_0x371d7f[_0x59124f(0x17c)]&&(_0x588fb8[_0x59124f(0x193)]=parseInt(_0x588fb8[_0x59124f(0x193)])+parseInt(_0x371d7f[_0x59124f(0x153)]),_0x4b01cf++);});_0x4b01cf=='0'&&(_0x589f58[_0x3c0434(0x167)]=_0x589f58[_0x3c0434(0x167)][_0x3c0434(0x1ab)]({'product_name':_0x371d7f['product_name'],'product_stock':_0x371d7f[_0x3c0434(0x153)],'primary_code':_0x371d7f[_0x3c0434(0xeb)],'secondary_code':_0x371d7f[_0x3c0434(0x1a2)],'product_code':_0x371d7f['product_code'],'bay':_0x371d7f[_0x3c0434(0x17c)],'bin':_0x371d7f[_0x3c0434(0x152)],'type':_0x371d7f['type'],'floorlevel':_0x371d7f[_0x3c0434(0xd3)]})),console[_0x3c0434(0x17b)]('final',_0x589f58);}),await _0x589f58[_0x121acc(0xbe)](),console[_0x121acc(0x17b)](_0x1800db['body']);const _0x2e5796=new c_payment_data({'invoice':_0x4682f2,'customer':_0x1800db[_0x121acc(0x135)][_0x121acc(0xaf)],'reason':_0x121acc(0x13b)});await _0x2e5796[_0x121acc(0xbe)]();const _0x2c6138=await master_shop[_0x121acc(0xad)]();console['log']('add\x20post',_0x2c6138[0x0][_0x121acc(0x17f)]);const _0x5a32ae=await email_settings['findOne'](),_0x1f5635=await customer[_0x121acc(0x1a6)]({'name':_0x1800db['body'][_0x121acc(0xaf)]});console[_0x121acc(0x17b)]('customer_data',_0x1f5635);_0x2c6138[0x0]['currency_placement']==0x1?(right_currency=_0x2c6138[0x0][_0x121acc(0x17d)],left_currency=''):(right_currency='',left_currency=_0x2c6138[0x0][_0x121acc(0x17d)]);var _0x9cc138=_0x7817bf,_0x4a5fa9=_0x54b5f6,_0x1c9490='',_0x1db807;for(_0x1db807 in _0x9cc138){_0x1c9490+=_0x121acc(0x122)+_0x121acc(0x187)+_0x9cc138[_0x1db807]+_0x121acc(0x164)+_0x121acc(0x187)+_0x4a5fa9[_0x1db807]+_0x121acc(0x164)+_0x121acc(0xe4);}console[_0x121acc(0x17b)](_0x121acc(0x17e),_0x1c9490);let _0x12f992=nodemailer[_0x121acc(0xe1)]({'service':_0x121acc(0x13d),'auth':{'user':_0x5a32ae[_0x121acc(0x170)],'pass':_0x5a32ae['password']}}),_0x2539de={'from':_0x5a32ae['email'],'to':_0x1f5635[_0x121acc(0x170)],'subject':_0x121acc(0xcd),'attachments':[{'filename':_0x121acc(0x10f),'path':__dirname+_0x121acc(0x106)+_0x121acc(0x107)+_0x2c6138[0x0][_0x121acc(0x17f)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x121acc(0x160)+_0x121acc(0xea)+_0x121acc(0xf3)+_0x121acc(0x1bb)+'<div>'+_0x121acc(0x125)+'</div>'+_0x121acc(0xf3)+_0x121acc(0x156)+_0x2c6138[0x0]['site_title']+_0x121acc(0x1b0)+'</div>'+_0x121acc(0x17a)+_0x121acc(0xb4)+_0x121acc(0xf3)+_0x121acc(0xa7)+_0x121acc(0xd1)+_0x4682f2+'\x20'+_0x121acc(0x198)+_0x121acc(0x13e)+_0x5dfbac+'\x20'+_0x121acc(0x185)+_0x121acc(0x11e)+_0x121acc(0x17a)+_0x121acc(0x116)+_0x121acc(0x16e)+_0x121acc(0x122)+_0x121acc(0x1a8)+_0x121acc(0x124)+_0x121acc(0x177)+_0x121acc(0xd4)+_0x121acc(0xe4)+_0x121acc(0x136)+_0x121acc(0xb1)+'\x20'+_0x1c9490+'\x20'+_0x121acc(0x115)+_0x121acc(0x15a)+_0x121acc(0xf3)+'<strong>\x20Regards\x20</strong>'+_0x121acc(0x13f)+_0x2c6138[0x0][_0x121acc(0x197)]+_0x121acc(0x11e)+_0x121acc(0x17a)+'</div>'+_0x121acc(0x13c)};_0x12f992['sendMail'](_0x2539de,function(_0xcd62fb,_0x1295ef){var _0x3dd6d6=_0x121acc;_0xcd62fb?(console['log'](_0xcd62fb),console[_0x3dd6d6(0x17b)]('Error\x20Occurs')):console[_0x3dd6d6(0x17b)]('Email\x20sent\x20successfully');}),_0x1800db['flash'](_0x121acc(0xed),_0x121acc(0xe9)),_0x342619[_0x121acc(0xde)](_0x121acc(0x1a9));}catch(_0x986972){console[_0x121acc(0x17b)](_0x986972),_0x342619[_0x121acc(0xca)](0xc8)[_0x121acc(0x105)]({'message1':_0x986972[_0x121acc(0x102)]});}}),router[a0_0x2c2a86(0x14a)](a0_0x2c2a86(0xa9),auth,async(_0x2f737b,_0x5041dd)=>{var _0x2a6895=a0_0x2c2a86;try{const {username:_0x22716d,email:_0x5e5659,role:_0x84b3e5}=_0x2f737b['user'],_0x796a32=_0x2f737b[_0x2a6895(0x14f)],_0x326480=await profile[_0x2a6895(0x1a6)]({'email':_0x796a32[_0x2a6895(0x170)]}),_0x466b6f=await master_shop['find']();console[_0x2a6895(0x17b)](_0x2a6895(0xec),_0x466b6f);const _0x4cc9bc=_0x2f737b[_0x2a6895(0xb6)]['id'],_0xbb72d7=await sales[_0x2a6895(0x137)](_0x4cc9bc);console['log'](_0x2a6895(0x169),_0xbb72d7);if(_0x466b6f[0x0][_0x2a6895(0x148)]=='English\x20(US)')var _0x1e4936=users[_0x2a6895(0x145)];else{if(_0x466b6f[0x0][_0x2a6895(0x148)]==_0x2a6895(0x190))var _0x1e4936=users[_0x2a6895(0x190)];else{if(_0x466b6f[0x0][_0x2a6895(0x148)]==_0x2a6895(0xe8))var _0x1e4936=users[_0x2a6895(0xe8)];else{if(_0x466b6f[0x0]['language']==_0x2a6895(0x176))var _0x1e4936=users[_0x2a6895(0x176)];else{if(_0x466b6f[0x0][_0x2a6895(0x148)]=='French')var _0x1e4936=users[_0x2a6895(0x1b5)];else{if(_0x466b6f[0x0][_0x2a6895(0x148)]==_0x2a6895(0xfd))var _0x1e4936=users[_0x2a6895(0x10d)];else{if(_0x466b6f[0x0][_0x2a6895(0x148)]==_0x2a6895(0x1a3))var _0x1e4936=users[_0x2a6895(0x1a3)];else{if(_0x466b6f[0x0][_0x2a6895(0x148)]==_0x2a6895(0x1b7))var _0x1e4936=users[_0x2a6895(0x194)];}}}}}}}_0x5041dd[_0x2a6895(0x196)]('all_sales_barcode',{'success':_0x2f737b[_0x2a6895(0x1b1)](_0x2a6895(0xed)),'errors':_0x2f737b[_0x2a6895(0x1b1)](_0x2a6895(0xac)),'role':_0x796a32,'profile':_0x326480,'alldata':_0xbb72d7,'master_shop':_0x466b6f,'language':_0x1e4936});}catch(_0x3102db){console['log'](_0x3102db);}}),router[a0_0x2c2a86(0xbf)]('/barcode_scanner',async(_0x4a5d14,_0x28ad5b)=>{var _0x394844=a0_0x2c2a86;const {product_code:_0x2d2833,warehouse_name:_0x38c47f,rooms_data:_0x5e8d8e,Roomslist:_0xdc4d21}=_0x4a5d14[_0x394844(0x135)],_0x2b2763=_0xdc4d21[_0x394844(0x13a)](','),_0x13b4ee=[];async function _0xcb7761(_0x2f2946){var _0x32042b=_0x394844;const _0x404616=await warehouse[_0x32042b(0xcf)]([{'$match':{'name':_0x38c47f,'room':_0x2f2946}},{'$unwind':_0x32042b(0x1a5)},{'$match':{'product_details.primary_code':_0x2d2833}},{'$group':{'_id':_0x32042b(0x131),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x32042b(0x103)},'primary_code':{'$first':_0x32042b(0x140)},'secondary_code':{'$first':_0x32042b(0x1ba)},'product_code':{'$first':_0x32042b(0x158)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x32042b(0xa8)},'pallet':{'$first':_0x32042b(0xd5)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x32042b(0x1a0)},'storage':{'$first':_0x32042b(0x1ad)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x32042b(0xa6)},'production_date':{'$first':_0x32042b(0xe0)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x32042b(0x129)},'product_cat':{'$first':_0x32042b(0xf1)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x32042b(0xc3)},'actual_qty':{'$first':_0x32042b(0xf4)},'actual_uom':{'$first':_0x32042b(0x186)}}}]),_0x568b36=await warehouse[_0x32042b(0xcf)]([{'$match':{'name':_0x38c47f,'room':_0x2f2946}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x2d2833}},{'$group':{'_id':_0x32042b(0x131),'name':{'$first':_0x32042b(0xcc)},'product_stock':{'$first':_0x32042b(0x103)},'primary_code':{'$first':_0x32042b(0x140)},'secondary_code':{'$first':_0x32042b(0x1ba)},'product_code':{'$first':_0x32042b(0x158)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x32042b(0xae)},'type':{'$first':_0x32042b(0xa8)},'pallet':{'$first':_0x32042b(0xd5)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x32042b(0x1a0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x32042b(0xdc)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x32042b(0xe0)},'maxPerUnit':{'$first':_0x32042b(0xfa)},'batch_code':{'$first':_0x32042b(0x129)},'product_cat':{'$first':_0x32042b(0xf1)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x32042b(0x1ac)},'invoice':{'$first':_0x32042b(0xc3)}}}]);if(_0x404616[_0x32042b(0x113)]>0x0)_0x13b4ee[_0x32042b(0x110)](_0x404616);else _0x568b36[_0x32042b(0x113)]>0x0&&_0x13b4ee[_0x32042b(0x110)](_0x568b36);}const _0x4e5e65=_0x2b2763[_0x394844(0xc6)](_0x487dd4=>_0xcb7761(_0x487dd4));await Promise['all'](_0x4e5e65),_0x28ad5b[_0x394844(0x105)](_0x13b4ee);}),module[a0_0x2c2a86(0x161)]=router;