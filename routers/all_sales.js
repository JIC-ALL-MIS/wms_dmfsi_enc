var a0_0x15167a=a0_0x16b5;(function(_0x3f1874,_0xfd2323){var _0x438ad7=a0_0x16b5,_0x2139b7=_0x3f1874();while(!![]){try{var _0x27f122=parseInt(_0x438ad7(0x1aa))/0x1*(parseInt(_0x438ad7(0x173))/0x2)+parseInt(_0x438ad7(0x156))/0x3+parseInt(_0x438ad7(0x121))/0x4+-parseInt(_0x438ad7(0x125))/0x5*(-parseInt(_0x438ad7(0x109))/0x6)+-parseInt(_0x438ad7(0x13b))/0x7+parseInt(_0x438ad7(0x1b8))/0x8*(parseInt(_0x438ad7(0xca))/0x9)+parseInt(_0x438ad7(0x188))/0xa*(-parseInt(_0x438ad7(0x112))/0xb);if(_0x27f122===_0xfd2323)break;else _0x2139b7['push'](_0x2139b7['shift']());}catch(_0x27d568){_0x2139b7['push'](_0x2139b7['shift']());}}}(a0_0x3450,0x9665c));function a0_0x16b5(_0x1a2d97,_0x195d98){var _0x3450d5=a0_0x3450();return a0_0x16b5=function(_0x16b5fd,_0x32fe0d){_0x16b5fd=_0x16b5fd-0xb9;var _0xaa2170=_0x3450d5[_0x16b5fd];return _0xaa2170;},a0_0x16b5(_0x1a2d97,_0x195d98);}const express=require('express'),app=express(),router=express[a0_0x15167a(0x198)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x15167a(0xfb)),auth=require(a0_0x15167a(0xd0)),nodemailer=require(a0_0x15167a(0x190)),users=require(a0_0x15167a(0x1a7));router[a0_0x15167a(0x183)]('/view',auth,async(_0x38e4e4,_0x16ff8e)=>{var _0x2d65e1=a0_0x15167a;try{const {username:_0x2412db,email:_0x77926b,role:_0x5ab724}=_0x38e4e4[_0x2d65e1(0xeb)],_0x44f431=_0x38e4e4[_0x2d65e1(0xeb)],_0x1dddf1=await profile[_0x2d65e1(0xbf)]({'email':_0x44f431[_0x2d65e1(0x13e)]}),_0x4595db=await master_shop[_0x2d65e1(0x163)]();let _0x325626;if(_0x44f431[_0x2d65e1(0x104)]==_0x2d65e1(0x1ab)){const _0x72af8e=await staff[_0x2d65e1(0xbf)]({'email':_0x44f431['email']});_0x325626=await sales[_0x2d65e1(0x1ac)]([{'$lookup':{'from':_0x2d65e1(0xcd),'localField':'customer','foreignField':'name','as':'customers_docs'}},{'$unwind':_0x2d65e1(0xf2)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x2d65e1(0xdf),'invoice':{'$first':_0x2d65e1(0xc5)},'customers':{'$first':_0x2d65e1(0x177)},'date':{'$first':_0x2d65e1(0x19b)},'warehouse_name':{'$first':_0x2d65e1(0xc8)},'sale_product':{'$push':_0x2d65e1(0xd2)},'note':{'$first':'$note'},'return_data':{'$first':_0x2d65e1(0xc0)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x2d65e1(0xdc)},'level':{'$addToSet':_0x2d65e1(0x14e)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x2d65e1(0x123)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x325626=await sales['aggregate']([{'$lookup':{'from':_0x2d65e1(0xcd),'localField':_0x2d65e1(0x145),'foreignField':_0x2d65e1(0x19d),'as':_0x2d65e1(0x192)}},{'$unwind':_0x2d65e1(0xf2)},{'$unwind':_0x2d65e1(0xd2)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x2d65e1(0x177)},'date':{'$first':_0x2d65e1(0x19b)},'warehouse_name':{'$first':_0x2d65e1(0xc8)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x2d65e1(0x1a5)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x2d65e1(0x123)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x2d65e1(0x118)](_0x2d65e1(0x1a6),_0x325626);if(_0x4595db[0x0][_0x2d65e1(0xef)]=='English\x20(US)'){var _0x5b24a6=users[_0x2d65e1(0x114)];console['log'](_0x5b24a6);}else{if(_0x4595db[0x0]['language']==_0x2d65e1(0x1a8))var _0x5b24a6=users['Hindi'];else{if(_0x4595db[0x0]['language']==_0x2d65e1(0x155))var _0x5b24a6=users[_0x2d65e1(0x155)];else{if(_0x4595db[0x0][_0x2d65e1(0xef)]==_0x2d65e1(0x16c))var _0x5b24a6=users['Spanish'];else{if(_0x4595db[0x0]['language']=='French')var _0x5b24a6=users[_0x2d65e1(0x10e)];else{if(_0x4595db[0x0][_0x2d65e1(0xef)]==_0x2d65e1(0x13a))var _0x5b24a6=users[_0x2d65e1(0x174)];else{if(_0x4595db[0x0][_0x2d65e1(0xef)]==_0x2d65e1(0x19a))var _0x5b24a6=users[_0x2d65e1(0x19a)];else{if(_0x4595db[0x0][_0x2d65e1(0xef)]==_0x2d65e1(0xee))var _0x5b24a6=users[_0x2d65e1(0x132)];}}}}}}}_0x16ff8e['render']('all_sales',{'success':_0x38e4e4[_0x2d65e1(0xcf)](_0x2d65e1(0x153)),'errors':_0x38e4e4['flash'](_0x2d65e1(0x10c)),'sales':_0x325626,'profile':_0x1dddf1,'role':_0x44f431,'master_shop':_0x4595db,'language':_0x5b24a6});}catch(_0x1eceec){console[_0x2d65e1(0x118)](_0x1eceec);}});async function getRandom8DigitNumber(){var _0x1b6d2c=a0_0x15167a;const _0x298c28=0x989680,_0x28a9aa=0x5f5e0ff,_0xc5d3de=Math[_0x1b6d2c(0x17b)](Math['random']()*(_0x28a9aa-_0x298c28+0x1))+_0x298c28;var _0x23e9ce;const _0x5c8670=await sales[_0x1b6d2c(0xbf)]({'invoice':_0x1b6d2c(0x1a0)+_0xc5d3de});return _0x5c8670&&_0x5c8670[_0x1b6d2c(0xc1)]>0x0?_0x23e9ce='OUT-'+_0xc5d3de:_0x23e9ce=_0x1b6d2c(0x1a0)+_0xc5d3de,_0x23e9ce;}function a0_0x3450(){var _0xff1d6e=['email','bin','filter','then','</div>','Return\x20Goods','createTransport','customer','True','Level','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','save','split','sendMail','<tbody\x20style=\x22text-align:\x20center;\x22>','$product.product_name','$sale_product.bay','batch_code','requested_qty','_id','<hr\x20class=\x22my-3\x22>','success','Received\x20Payment\x20For\x20Sale','German','289953pJJKUR','message','type','exports','/barcode/:id','Receiving\x20Area','final','Sales\x20Mail','user_id','prod_invoice','</tr>','string','Error\x20Occurs','find','/view/:id','/view/return_sales/:id','product_data','isAllowEdit','all','findById','/all_sales/view','Email\x20sent\x20successfully','Spanish','barcode\x20user_id','warehouse_name','stock_data','return_sale','<tr>','stocks','100792WbLYHt','Portuguese','body','barcode\x20Product\x20master','$customer','stock','received_amount','/barcode_scanner','floor','/all_sales/preview/','English\x20(US)','<strong>\x20Regards\x20</strong>','foreach\x20newproduct','product_name','concat','params','get','due_amount','date','gmail','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','2199370TbUmrk','primary_code','invoice','delivery_code','$product_details.maxPerUnit','$room','secondary_unit','<div>','nodemailer','level','customers_docs','</td>','master','site_title','back','add_sales','Router','/give_payment/:id','Chinese','$date','padStart','name','An\x20error\x20occurred.','$product_details._id','OUT-','</body></html>','</tbody>','error','False','$note','sales\x20all_data','../public/language/languages.json','Hindi','render','21CiHAIH','staff','aggregate','toString','$product_details.production_date','</head><body>','forEach','$product_details.invoice','prod_code','$product_details.secondary_code','$product_details.storage','edit_sales_view','return_qty','Sales\x20Add\x20successfully','4318768hiMjAt','slice','production_date','<h2>\x20','RMSEmail','$product_details.expiry_date','product_code','warehouse','$product_details.pallet','Sales\x20Update\x20successfully','Sale\x20Return\x20Mail','max_per_unit','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/view/add_sales','maxperunit','findOne','$return_data','length','post','$product_details.level','/upload/','$invoice','actual_uom','$product_details.type','$warehouse_name','\x20</h2>','9kOScXV','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','password','customers','add\x20post','flash','../middleware/auth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$sale_product','\x20Order\x20Date\x20:\x20','note','logo','rack','$product_details.floorlevel','$product_details.bin','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.product_cat','$sale_product.quantity','/view/add_sales/:id','\x20Order\x20Number\x20:\x20','$_id','floorlevel','Raw\x20Materials','purchases_data','sale_qty','An\x20error\x20occurred\x20while\x20saving\x20data.','product_list','$name','Logo.png','finalize','edit_sales','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','user','Enabled','bay','Arabic\x20(ae)','language','sales_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$customers_docs','push','redirect','image','<h5>','$product_details.bay','actual_qty','$product_details.product_code','$product_details.primary_code','../models/all_models','secondary_code','prod_cat','$product_details.actual_qty','<h5\x20style=\x22text-align:\x20left;\x22>','Shelves','Sale\x20Return','host','RoomAssigned','role','expiry_date','quantity','</thead>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','77748MObOeD','Floor','<table\x20style=\x22width:\x20100%\x20!important;\x22>','errors','json','French','product_details','unit','storage','44shemhM','sale_product','English','currency','sales_quantity','<html><head><title></title>','log','getFullYear','abs','SCRN','room_name','product','$product','map','sales\x20item\x20return\x20successfull','733424vlcaiA','$product_details.unit','$sale_product.type','status','155GNLMao','$product_details.rack','</h5>','primary_unit','$product_details.product_stock','delivery_date','$product_details.product_name','<span\x20style=\x22float:\x20right;\x22>','<!DOCTYPE\x20html>','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','room','/invoice/:id','Arabic','product_stock','quantity_notConverted','/view/add_sale/product','types','</span>','$product_details.batch_code','return_data','Portuguese\x20(BR)','5488637dRGXtd','getDate','carton'];a0_0x3450=function(){return _0xff1d6e;};return a0_0x3450();}router[a0_0x15167a(0x183)](a0_0x15167a(0xbd),auth,async(_0x1b8af0,_0x669edc)=>{var _0x5a6bff=a0_0x15167a;try{const {username:_0x4e7ea3,email:_0x4e4d8e,role:_0x1f8f86}=_0x1b8af0[_0x5a6bff(0xeb)],_0x3fbe69=_0x1b8af0[_0x5a6bff(0xeb)],_0x3d077a=await profile[_0x5a6bff(0xbf)]({'email':_0x3fbe69[_0x5a6bff(0x13e)]}),_0x5f230d=await master_shop[_0x5a6bff(0x163)](),_0x5c5a8a=await customer['find']({});let _0x1622ae;if(_0x3fbe69[_0x5a6bff(0x104)]==_0x5a6bff(0x1ab)){const _0x799003=await staff[_0x5a6bff(0xbf)]({'email':_0x3fbe69[_0x5a6bff(0x13e)]});_0x1622ae=await warehouse[_0x5a6bff(0x1ac)]([{'$match':{'status':'Enabled','name':_0x799003[_0x5a6bff(0x1bf)],'warehouse_category':_0x5a6bff(0xe1),'name':{'$ne':_0x5a6bff(0x143)}}},{'$group':{'_id':_0x5a6bff(0xe6),'name':{'$first':_0x5a6bff(0xe6)}}},{'$sort':{'name':0x1}}]);}else _0x1622ae=await warehouse[_0x5a6bff(0x1ac)]([{'$match':{'status':_0x5a6bff(0xec),'warehouse_category':_0x5a6bff(0xe1),'name':{'$ne':_0x5a6bff(0x143)}}},{'$group':{'_id':_0x5a6bff(0xe6),'name':{'$first':_0x5a6bff(0xe6)}}},{'$sort':{'name':0x1}}]);const _0x46f747=await product[_0x5a6bff(0x163)]({});var _0x16fc46=['Ambient',_0x5a6bff(0xbb)];const _0x2ea22b=await sales[_0x5a6bff(0x163)]({}),_0x4dc680=_0x2ea22b['length']+0x1,_0x4dd8ad='OUT-'+_0x4dc680[_0x5a6bff(0x1ad)]()[_0x5a6bff(0x19c)](0x5,'0');if(_0x5f230d[0x0][_0x5a6bff(0xef)]==_0x5a6bff(0x17d)){var _0x10c091=users['English'];console['log'](_0x10c091);}else{if(_0x5f230d[0x0]['language']==_0x5a6bff(0x1a8))var _0x10c091=users['Hindi'];else{if(_0x5f230d[0x0][_0x5a6bff(0xef)]=='German')var _0x10c091=users[_0x5a6bff(0x155)];else{if(_0x5f230d[0x0][_0x5a6bff(0xef)]==_0x5a6bff(0x16c))var _0x10c091=users[_0x5a6bff(0x16c)];else{if(_0x5f230d[0x0][_0x5a6bff(0xef)]==_0x5a6bff(0x10e))var _0x10c091=users['French'];else{if(_0x5f230d[0x0][_0x5a6bff(0xef)]==_0x5a6bff(0x13a))var _0x10c091=users[_0x5a6bff(0x174)];else{if(_0x5f230d[0x0][_0x5a6bff(0xef)]==_0x5a6bff(0x19a))var _0x10c091=users[_0x5a6bff(0x19a)];else{if(_0x5f230d[0x0][_0x5a6bff(0xef)]=='Arabic\x20(ae)')var _0x10c091=users['Arabic'];}}}}}}}const _0x410e24=getRandom8DigitNumber();_0x410e24['then'](_0x90b898=>{var _0x1c8ad3=_0x5a6bff;_0x669edc[_0x1c8ad3(0x1a9)](_0x1c8ad3(0x197),{'success':_0x1b8af0[_0x1c8ad3(0xcf)](_0x1c8ad3(0x153)),'errors':_0x1b8af0[_0x1c8ad3(0xcf)](_0x1c8ad3(0x10c)),'role':_0x3fbe69,'profile':_0x3d077a,'customer':_0x5c5a8a,'warehouse':_0x1622ae,'product':_0x46f747,'invoice':_0x90b898,'master_shop':_0x5f230d,'language':_0x10c091,'rooms_data':_0x16fc46});})['catch'](_0x32b071=>{var _0x334ced=_0x5a6bff;_0x1b8af0[_0x334ced(0xcf)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x669edc['redirect'](_0x334ced(0x16a));});}catch(_0x57c860){console['log'](_0x57c860);}}),router[a0_0x15167a(0x183)](a0_0x15167a(0xdd),auth,async(_0x215f05,_0x4e2d56)=>{var _0x40ce06=a0_0x15167a;try{const _0x192c24=_0x215f05[_0x40ce06(0x182)]['id'];console[_0x40ce06(0x118)](_0x192c24);const _0x2a317c=await product['find'](),_0x3b74de=await purchases[_0x40ce06(0x1ac)]([{'$match':{'warehouse_name':_0x192c24}},{'$unwind':_0x40ce06(0x11e)},{'$group':{'_id':_0x40ce06(0x14d)}}]);console[_0x40ce06(0x118)](_0x40ce06(0xe2),_0x3b74de),_0x4e2d56[_0x40ce06(0x124)](0xc8)[_0x40ce06(0x10d)]({'purchases_data':_0x3b74de,'product_data':_0x2a317c});}catch(_0x27f767){console[_0x40ce06(0x118)](_0x27f767);}}),router[a0_0x15167a(0xc2)](a0_0x15167a(0x135),auth,async(_0x510171,_0x239b9f)=>{var _0x270939=a0_0x15167a;try{const {warehouse_data:_0xf31f11,product_data:_0x1b9162}=_0x510171[_0x270939(0x175)];console[_0x270939(0x118)](_0x510171[_0x270939(0x175)][_0x270939(0x166)]);;const _0x309161=await master_shop['find']();console['log'](_0x270939(0x194),_0x309161);const _0x299332=await product[_0x270939(0xbf)]({'name':_0x1b9162});console[_0x270939(0x118)](_0x270939(0x11d),_0x299332);const _0x2ba35f=await warehouse[_0x270939(0x1ac)]([{'$match':{'name':_0xf31f11}},{'$unwind':_0x270939(0xd9)},{'$match':{'product_details.product_name':_0x1b9162}},{'$group':{'_id':_0x270939(0x12b),'product_stock':{'$first':_0x270939(0x129)}}}]);console['log'](_0x270939(0x16f),_0x2ba35f),_0x239b9f['status'](0xc8)[_0x270939(0x10d)]({'master':_0x309161,'new_product':_0x299332,'stock_data':_0x2ba35f});}catch(_0x310658){console[_0x270939(0x118)](_0x310658);}}),router[a0_0x15167a(0xc2)](a0_0x15167a(0xbd),auth,async(_0x249a9e,_0x6647c5)=>{var _0x2b7089=a0_0x15167a;try{const {invoice:_0x29e6ba,date:_0x55850b,warehouse_name:_0x4cb44c,product_name:_0x4e601b,stock:_0x1af108,quantity:_0x59d71b,note:_0x1e9727,room:_0x508abc,primary_code:_0x42d8c3,secondary_code:_0x2ef155,prod_code:_0x2a2329,level:_0x4c285c,isle:_0x154384,pallet:_0x3b0337,batch_code:_0x481caf,SCRN:_0x53ca6d,expiry_date:_0x2a673a}=_0x249a9e['body'];if(typeof _0x4e601b==_0x2b7089(0x161))var _0xf90b5f=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x180)]],_0x10e623=[_0x249a9e[_0x2b7089(0x175)]['stock']],_0x451ff2=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x13d)]],_0x34d8fb=[_0x249a9e[_0x2b7089(0x175)]['primary_code']],_0x223941=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0xfc)]],_0x341194=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x1b2)]],_0x13ae50=[_0x249a9e['body']['level']],_0x564798=[_0x249a9e[_0x2b7089(0x175)]['primary_unit']],_0x4452bc=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x18e)]],_0x36ad23=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x14f)]],_0x34a072=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x105)]],_0x2c87e4=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0xba)]],_0x3f6649=[_0x249a9e[_0x2b7089(0x175)]['production_date']],_0x3fb565=[_0x249a9e[_0x2b7089(0x175)]['requested_qty']],_0x1bae8e=[_0x249a9e['body'][_0x2b7089(0x12a)]],_0x11390f=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x18b)]],_0x4383bf=[_0x249a9e[_0x2b7089(0x175)]['prod_cat']],_0x1063c7=[_0x249a9e[_0x2b7089(0x175)]['quantity']],_0x381fe3=[_0x249a9e[_0x2b7089(0x175)]['RoomAssigned']],_0x35eed5=[_0x249a9e[_0x2b7089(0x175)]['prod_invoice']],_0x2c4eef=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0xf8)]],_0x22f227=[_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0xc6)]];else var _0xf90b5f=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x180)]],_0x10e623=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x178)]],_0x451ff2=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x13d)]],_0x34d8fb=[..._0x249a9e['body'][_0x2b7089(0x189)]],_0x223941=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0xfc)]],_0x341194=[..._0x249a9e[_0x2b7089(0x175)]['prod_code']],_0x13ae50=[..._0x249a9e[_0x2b7089(0x175)]['level']],_0x564798=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x128)]],_0x4452bc=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x18e)]],_0x36ad23=[..._0x249a9e['body'][_0x2b7089(0x14f)]],_0x34a072=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x105)]],_0x2c87e4=[..._0x249a9e['body']['max_per_unit']],_0x3f6649=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x1ba)]],_0x3fb565=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x150)]],_0x1bae8e=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x12a)]],_0x11390f=[..._0x249a9e['body'][_0x2b7089(0x18b)]],_0x4383bf=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0xfd)]],_0x1063c7=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x106)]],_0x381fe3=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x103)]],_0x35eed5=[..._0x249a9e['body'][_0x2b7089(0x15f)]],_0x2c4eef=[..._0x249a9e[_0x2b7089(0x175)][_0x2b7089(0xf8)]],_0x22f227=[..._0x249a9e['body']['actual_uom']];const _0x3f9bc1=_0xf90b5f[_0x2b7089(0x11f)](_0x54b139=>{return _0x54b139={'product_name':_0x54b139};});_0x10e623['forEach']((_0x5e3c09,_0x4b5490)=>{var _0x395915=_0x2b7089;_0x3f9bc1[_0x4b5490][_0x395915(0x178)]=Math[_0x395915(0x11a)](_0x5e3c09);}),_0x2c4eef[_0x2b7089(0x1b0)]((_0x2e6ac5,_0x4f1c86)=>{var _0x2e6f69=_0x2b7089;_0x3f9bc1[_0x4f1c86][_0x2e6f69(0xf8)]=Math[_0x2e6f69(0x11a)](_0x2e6ac5);}),_0x22f227[_0x2b7089(0x1b0)]((_0x22396d,_0x204a60)=>{var _0x50e34a=_0x2b7089;_0x3f9bc1[_0x204a60][_0x50e34a(0xc6)]=_0x22396d;}),_0x451ff2['forEach']((_0x4ffc41,_0x2b0eb6)=>{_0x3f9bc1[_0x2b0eb6]['quantity']=_0x4ffc41;}),_0x34d8fb[_0x2b7089(0x1b0)]((_0x343dd8,_0x329e13)=>{var _0x5d55b5=_0x2b7089;_0x3f9bc1[_0x329e13][_0x5d55b5(0x189)]=_0x343dd8;}),_0x223941[_0x2b7089(0x1b0)]((_0x4c96c2,_0x122b40)=>{var _0x1b2b74=_0x2b7089;_0x3f9bc1[_0x122b40][_0x1b2b74(0xfc)]=_0x4c96c2;}),_0x341194[_0x2b7089(0x1b0)]((_0x41b7ec,_0x7be4d)=>{_0x3f9bc1[_0x7be4d]['product_code']=_0x41b7ec;}),_0x13ae50['forEach']((_0x111396,_0x2eb55d)=>{var _0x102c77=_0x2b7089;_0x381fe3[_0x102c77(0x1b0)]((_0x319a5c,_0x1c7b89)=>{var _0x13004f=_0x102c77;if(_0x319a5c=='Receiving\x20Area'&&_0x2eb55d==_0x1c7b89){var _0x24817a=_0x111396[_0x13004f(0x1b9)](0x3);_0x3f9bc1[_0x2eb55d][_0x13004f(0x111)]=_0x111396[0x0],_0x3f9bc1[_0x2eb55d][_0x13004f(0xd6)]=_0x111396[0x1],_0x3f9bc1[_0x2eb55d][_0x13004f(0xed)]=0x0,_0x3f9bc1[_0x2eb55d][_0x13004f(0x13f)]=0x0,_0x3f9bc1[_0x2eb55d][_0x13004f(0x158)]=_0x13004f(0x10a),_0x3f9bc1[_0x2eb55d][_0x13004f(0xe0)]=_0x24817a;}else{if(_0x319a5c==_0x13004f(0x100)&&_0x2eb55d==_0x1c7b89){var _0x24817a=_0x111396['slice'](0x3);_0x3f9bc1[_0x2eb55d][_0x13004f(0x111)]=_0x111396[0x0],_0x3f9bc1[_0x2eb55d][_0x13004f(0xd6)]=_0x111396[0x1],_0x3f9bc1[_0x2eb55d][_0x13004f(0xed)]=0x0,_0x3f9bc1[_0x2eb55d][_0x13004f(0x13f)]=0x0,_0x3f9bc1[_0x2eb55d][_0x13004f(0x158)]=_0x13004f(0x10a),_0x3f9bc1[_0x2eb55d]['floorlevel']=_0x111396[0x5];}else{if(_0x2eb55d==_0x1c7b89){var _0x4819f3;if(_0x111396[0x4]=='L')_0x4819f3=_0x13004f(0x147);else _0x111396[0x4]=='F'&&(_0x4819f3=_0x13004f(0x10a));_0x3f9bc1[_0x2eb55d][_0x13004f(0x111)]=_0x111396[0x0],_0x3f9bc1[_0x2eb55d][_0x13004f(0xd6)]=_0x111396[0x1],_0x3f9bc1[_0x2eb55d]['bay']=_0x111396[0x2],_0x3f9bc1[_0x2eb55d][_0x13004f(0x13f)]=_0x111396[0x3],_0x3f9bc1[_0x2eb55d][_0x13004f(0x158)]=_0x4819f3,_0x3f9bc1[_0x2eb55d][_0x13004f(0xe0)]=_0x111396[0x5];}}}});}),_0x564798[_0x2b7089(0x1b0)]((_0x1dda08,_0x28b685)=>{_0x3f9bc1[_0x28b685]['unit']=_0x1dda08;}),_0x4452bc[_0x2b7089(0x1b0)]((_0x474118,_0x3f2b63)=>{var _0x2b61a8=_0x2b7089;_0x3f9bc1[_0x3f2b63][_0x2b61a8(0x18e)]=_0x474118;}),_0x36ad23[_0x2b7089(0x1b0)]((_0x3d8aff,_0x16f4ef)=>{var _0x5e8636=_0x2b7089;_0x3f9bc1[_0x16f4ef][_0x5e8636(0x14f)]=_0x3d8aff;}),_0x34a072['forEach']((_0x2cef9b,_0x5a640c)=>{var _0x3b7fc6=_0x2b7089;_0x3f9bc1[_0x5a640c][_0x3b7fc6(0x105)]=_0x2cef9b;}),_0x2c87e4[_0x2b7089(0x1b0)]((_0x1d6124,_0x71541a)=>{_0x3f9bc1[_0x71541a]['maxperunit']=_0x1d6124;}),_0x3f6649[_0x2b7089(0x1b0)]((_0x575713,_0x4c3ebb)=>{var _0x2e2c31=_0x2b7089;_0x3f9bc1[_0x4c3ebb][_0x2e2c31(0x1ba)]=_0x575713;}),_0x3fb565[_0x2b7089(0x1b0)]((_0x50f332,_0x1e41a5)=>{var _0x163266=_0x2b7089;_0x3f9bc1[_0x1e41a5][_0x163266(0x150)]=_0x50f332;}),_0x1bae8e[_0x2b7089(0x1b0)]((_0xd92b51,_0x4f1344)=>{var _0x1c139e=_0x2b7089;_0x3f9bc1[_0x4f1344][_0x1c139e(0x12a)]=_0xd92b51;}),_0x11390f[_0x2b7089(0x1b0)]((_0x2bc1c9,_0x8c0c3e)=>{var _0x36a578=_0x2b7089;_0x3f9bc1[_0x8c0c3e][_0x36a578(0x18b)]=_0x2bc1c9;}),_0x4383bf[_0x2b7089(0x1b0)]((_0x470edc,_0x229464)=>{var _0x504167=_0x2b7089;_0x3f9bc1[_0x229464][_0x504167(0xfd)]=_0x470edc;}),_0x1063c7[_0x2b7089(0x1b0)]((_0x153617,_0x4ee929)=>{var _0x101fdc=_0x2b7089;_0x3f9bc1[_0x4ee929][_0x101fdc(0x134)]=_0x153617;}),_0x381fe3[_0x2b7089(0x1b0)]((_0x138ef9,_0x341dcb)=>{_0x3f9bc1[_0x341dcb]['room_name']=_0x138ef9;}),_0x35eed5[_0x2b7089(0x1b0)]((_0x5beddf,_0x3b68ad)=>{var _0xb7cc08=_0x2b7089;_0x3f9bc1[_0x3b68ad][_0xb7cc08(0x18a)]=_0x5beddf;});var _0x4f50e5=0x0;_0x3f9bc1[_0x2b7089(0x1b0)](_0x4bfa79=>{var _0x597253=_0x2b7089;(_0x4bfa79['stock']<_0x4bfa79[_0x597253(0x134)]||_0x4bfa79['quantity_notConverted']==0x0)&&(console[_0x597253(0x118)]('foreach\x20newproduct',_0x4bfa79),_0x4f50e5++);});const _0x31bfd3=_0x3f9bc1[_0x2b7089(0x140)](_0x11d4e2=>_0x11d4e2['quantity']!=='0'&&_0x11d4e2[_0x2b7089(0x106)]!==''),_0x3b25d8=new sales({'invoice':_0x29e6ba,'customer':_0x249a9e[_0x2b7089(0x175)][_0x2b7089(0x145)],'date':_0x55850b,'warehouse_name':_0x4cb44c,'sale_product':_0x31bfd3,'note':_0x1e9727,'room':_0x508abc,'primary_code':_0x42d8c3,'secondary_code':_0x2ef155,'prod_code':_0x2a2329,'SCRN':_0x53ca6d}),_0x218cb8=await _0x3b25d8['save']();_0x249a9e[_0x2b7089(0xcf)](_0x2b7089(0x153),_0x2b7089(0x1b7)),_0x6647c5[_0x2b7089(0xf4)](_0x2b7089(0x17c)+_0x218cb8[_0x2b7089(0x151)]);}catch(_0x74a97d){console[_0x2b7089(0x118)](_0x74a97d);}}),router['get']('/preview/:id',auth,async(_0x1ae8d5,_0x530313)=>{var _0x2a9142=a0_0x15167a;try{const {username:_0x3be0a4,email:_0x136466,role:_0x4eca5b}=_0x1ae8d5['user'],_0xd77d89=_0x1ae8d5[_0x2a9142(0xeb)],_0x36f49d=await profile[_0x2a9142(0xbf)]({'email':_0xd77d89['email']}),_0x5033ee=await master_shop[_0x2a9142(0x163)](),_0x1a0288=_0x1ae8d5['params']['id'],_0x437958=await sales[_0x2a9142(0x169)](_0x1a0288),_0x41f358=await warehouse[_0x2a9142(0x1ac)]([{'$match':{'name':_0x437958[_0x2a9142(0x16e)]}},{'$unwind':_0x2a9142(0xd9)},{'$group':{'_id':_0x2a9142(0x19f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2a9142(0x129)},'bay':{'$first':_0x2a9142(0xf7)},'bin':{'$first':_0x2a9142(0xd8)},'type':{'$first':_0x2a9142(0xc7)},'floorlevel':{'$first':_0x2a9142(0xd7)},'primary_code':{'$first':_0x2a9142(0xfa)},'secondary_code':{'$first':_0x2a9142(0x1b3)},'product_code':{'$first':_0x2a9142(0xf9)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2a9142(0x126)},'expiry_date':{'$first':_0x2a9142(0x1bd)},'production_date':{'$first':_0x2a9142(0x1ae)},'invoice':{'$first':_0x2a9142(0x1b1)}}}]),_0x8757f=await customer[_0x2a9142(0x163)]({});let _0x46137a;if(_0xd77d89[_0x2a9142(0x104)]==_0x2a9142(0x1ab)){const _0x1686fc=await staff['findOne']({'email':_0xd77d89[_0x2a9142(0x13e)]});_0x46137a=await warehouse[_0x2a9142(0x1ac)]([{'$match':{'status':'Enabled','name':_0x1686fc[_0x2a9142(0x1bf)]}},{'$group':{'_id':_0x2a9142(0xe6),'name':{'$first':'$name'}}}]);}else _0x46137a=await warehouse['aggregate']([{'$match':{'status':_0x2a9142(0xec)}},{'$group':{'_id':_0x2a9142(0xe6),'name':{'$first':'$name'}}}]);const _0x2ce5b2=await product['find']({}),_0x2738fa=await suppliers[_0x2a9142(0x163)]({});if(_0x5033ee[0x0][_0x2a9142(0xef)]=='English\x20(US)'){var _0x3612f6=users[_0x2a9142(0x114)];console[_0x2a9142(0x118)](_0x3612f6);}else{if(_0x5033ee[0x0][_0x2a9142(0xef)]==_0x2a9142(0x1a8))var _0x3612f6=users[_0x2a9142(0x1a8)];else{if(_0x5033ee[0x0]['language']==_0x2a9142(0x155))var _0x3612f6=users[_0x2a9142(0x155)];else{if(_0x5033ee[0x0][_0x2a9142(0xef)]=='Spanish')var _0x3612f6=users['Spanish'];else{if(_0x5033ee[0x0]['language']=='French')var _0x3612f6=users[_0x2a9142(0x10e)];else{if(_0x5033ee[0x0][_0x2a9142(0xef)]==_0x2a9142(0x13a))var _0x3612f6=users['Portuguese'];else{if(_0x5033ee[0x0][_0x2a9142(0xef)]==_0x2a9142(0x19a))var _0x3612f6=users[_0x2a9142(0x19a)];else{if(_0x5033ee[0x0][_0x2a9142(0xef)]==_0x2a9142(0xee))var _0x3612f6=users[_0x2a9142(0x132)];}}}}}}}_0x530313['render'](_0x2a9142(0x1b5),{'success':_0x1ae8d5[_0x2a9142(0xcf)]('success'),'errors':_0x1ae8d5[_0x2a9142(0xcf)](_0x2a9142(0x10c)),'role':_0xd77d89,'profile':_0x36f49d,'customer':_0x8757f,'warehouse':_0x46137a,'product':_0x41f358,'user':_0x437958,'master_shop':_0x5033ee,'unit':_0x2ce5b2,'language':_0x3612f6,'suppliers':_0x2738fa});}catch(_0x1cda06){console[_0x2a9142(0x118)](_0x1cda06);}}),router['post']('/preview/:id',auth,async(_0x5cca53,_0x492236)=>{var _0x5db23c=a0_0x15167a;try{const _0x2b20f7=_0x5cca53['params']['id'],{invoice:_0xc5022f,warehouse_name:_0xc7176c,room:_0x906130}=_0x5cca53[_0x5db23c(0x175)],_0x43761a=await sales[_0x5db23c(0xbf)]({'invoice':_0xc5022f}),_0xc73388=_0x43761a[_0x5db23c(0x113)]['map'](async _0x5a2a22=>{var _0x19c48d=_0x5db23c,_0x3de1a2=await warehouse[_0x19c48d(0xbf)]({'name':_0xc7176c,'room':_0x5a2a22[_0x19c48d(0x11c)],'warehouse_category':'Raw\x20Materials'});const _0x3fd706=_0x3de1a2[_0x19c48d(0x10f)][_0x19c48d(0x11f)](_0x4aa68e=>{var _0x28fe7b=_0x19c48d;_0x4aa68e[_0x28fe7b(0x180)]==_0x5a2a22[_0x28fe7b(0x180)]&&_0x4aa68e[_0x28fe7b(0xe0)]==_0x5a2a22['floorlevel']&&_0x4aa68e[_0x28fe7b(0x158)]==_0x5a2a22[_0x28fe7b(0x158)]&&_0x4aa68e[_0x28fe7b(0x13f)]==_0x5a2a22[_0x28fe7b(0x13f)]&&_0x4aa68e[_0x28fe7b(0xed)]==_0x5a2a22[_0x28fe7b(0xed)]&&_0x4aa68e[_0x28fe7b(0xd6)]==_0x5a2a22[_0x28fe7b(0xd6)]&&_0x4aa68e[_0x28fe7b(0x111)]==_0x5a2a22[_0x28fe7b(0x111)]&&_0x4aa68e[_0x28fe7b(0x105)]==_0x5a2a22[_0x28fe7b(0x105)]&&_0x4aa68e[_0x28fe7b(0x14f)]==_0x5a2a22['batch_code']&&_0x4aa68e['invoice']==_0x5a2a22[_0x28fe7b(0x18a)]&&(_0x4aa68e['product_stock']=Math['max'](0x0,Math['abs'](_0x4aa68e[_0x28fe7b(0x133)])-Math[_0x28fe7b(0x11a)](_0x5a2a22[_0x28fe7b(0x106)])));});return _0x3de1a2;});Promise['all'](_0xc73388)[_0x5db23c(0x141)](async _0x52afca=>{var _0x3703e4=_0x5db23c;try{for(const _0x3b1966 of _0x52afca){await _0x3b1966[_0x3703e4(0x149)]();}_0x43761a['finalize']='True';const _0x29b35c=await _0x43761a[_0x3703e4(0x149)](),_0x1f5d3e=await master_shop[_0x3703e4(0x163)](),_0x3751a2=await email_settings[_0x3703e4(0xbf)](),_0x47da99=await supervisor_settings[_0x3703e4(0x163)]();var _0x59c37a=_0x43761a[_0x3703e4(0x113)],_0x3bb0de='',_0xec6665;for(_0xec6665 in _0x59c37a){_0x3bb0de+=_0x3703e4(0x171)+_0x3703e4(0x148)+_0x59c37a[_0xec6665][_0x3703e4(0x180)]+_0x3703e4(0x193)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59c37a[_0xec6665][_0x3703e4(0x1be)]+_0x3703e4(0x193)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59c37a[_0xec6665][_0x3703e4(0x106)]+_0x3703e4(0x193)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59c37a[_0xec6665]['unit']+_0x3703e4(0x193)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x59c37a[_0xec6665]['secondary_unit']+_0x3703e4(0x193)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x43761a['warehouse_name']+'</td>'+_0x3703e4(0x148)+_0x59c37a[_0xec6665][_0x3703e4(0x11c)]+_0x3703e4(0x193)+_0x3703e4(0x148)+_0x59c37a[_0xec6665]['storage']+_0x59c37a[_0xec6665][_0x3703e4(0xd6)]+_0x59c37a[_0xec6665]['bay']+_0x59c37a[_0xec6665][_0x3703e4(0x13f)]+_0x59c37a[_0xec6665][_0x3703e4(0x158)][0x0]+_0x59c37a[_0xec6665]['floorlevel']+_0x3703e4(0x193),'</tr>';}let _0x4498a7=nodemailer['createTransport']({'host':_0x3751a2[_0x3703e4(0x102)],'port':Number(_0x3751a2['port']),'secure':![],'auth':{'user':_0x3751a2[_0x3703e4(0x13e)],'pass':_0x3751a2[_0x3703e4(0xcc)]}}),_0x32a1ef={'from':_0x3751a2[_0x3703e4(0x13e)],'to':_0x47da99[0x0][_0x3703e4(0x1bc)],'subject':_0x3703e4(0x15d),'attachments':[{'filename':_0x3703e4(0xe7),'path':__dirname+_0x3703e4(0x12e)+_0x3703e4(0xc4)+_0x1f5d3e[0x0][_0x3703e4(0xf5)],'cid':_0x3703e4(0xd5)}],'html':'<!DOCTYPE\x20html>'+_0x3703e4(0x117)+_0x3703e4(0x1af)+_0x3703e4(0x18f)+_0x3703e4(0x187)+_0x3703e4(0x18f)+_0x3703e4(0x108)+_0x3703e4(0x142)+'<div>'+_0x3703e4(0x1bb)+_0x1f5d3e[0x0]['site_title']+_0x3703e4(0xc9)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x3703e4(0xff)+'\x20Order\x20Number\x20:\x20'+_0x43761a[_0x3703e4(0x18a)]+'\x20'+_0x3703e4(0x12c)+_0x3703e4(0xd3)+_0x43761a[_0x3703e4(0x185)]+'\x20'+_0x3703e4(0x137)+'</h5>'+'</div>'+_0x3703e4(0x10b)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3703e4(0x171)+_0x3703e4(0xbc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x3703e4(0x12f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x3703e4(0xd1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x3703e4(0xda)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3703e4(0x160)+_0x3703e4(0x107)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3bb0de+'\x20'+_0x3703e4(0x1a2)+'</table>'+_0x3703e4(0x18f)+_0x3703e4(0x17e)+_0x3703e4(0xf6)+_0x1f5d3e[0x0]['site_title']+_0x3703e4(0x127)+_0x3703e4(0x142)+_0x3703e4(0x142)+_0x3703e4(0x1a1)};_0x4498a7[_0x3703e4(0x14b)](_0x32a1ef,function(_0x4ecaa3,_0x24bf35){var _0x803a88=_0x3703e4;_0x4ecaa3?(console[_0x803a88(0x118)](_0x4ecaa3),console[_0x803a88(0x118)](_0x803a88(0x162))):console[_0x803a88(0x118)](_0x803a88(0x16b));}),_0x5cca53[_0x3703e4(0xcf)]('success',_0x3703e4(0x1c1)),_0x492236['redirect'](_0x3703e4(0x17c)+_0x2b20f7);}catch(_0x4e8271){console[_0x3703e4(0x1a3)](_0x4e8271),_0x492236['status'](0x1f4)[_0x3703e4(0x10d)]({'error':_0x3703e4(0xe4)});}})['catch'](_0x5842d5=>{var _0x5202fc=_0x5db23c;console[_0x5202fc(0x1a3)](_0x5842d5),_0x492236[_0x5202fc(0x124)](0x1f4)[_0x5202fc(0x10d)]({'error':_0x5202fc(0x19e)});});}catch(_0x5a6291){console['log'](_0x5a6291);}}),router[a0_0x15167a(0x183)](a0_0x15167a(0x164),auth,async(_0x34fcca,_0x298a0a)=>{var _0xb78994=a0_0x15167a;try{const {username:_0x5e66ba,email:_0x5ea6f3,role:_0x3b4e83}=_0x34fcca['user'],_0x544f5d=_0x34fcca[_0xb78994(0xeb)],_0x49537f=await profile[_0xb78994(0xbf)]({'email':_0x544f5d['email']}),_0x5be0f6=await master_shop[_0xb78994(0x163)](),_0x4bec66=_0x34fcca['params']['id'],_0xaead19=await sales[_0xb78994(0x169)](_0x4bec66);var _0x8587c3=['Ambient','Enclosed'];const _0x5bb457=await warehouse[_0xb78994(0x1ac)]([{'$match':{'name':_0xaead19['warehouse_name'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':'$product_details'},{'$group':{'_id':_0xb78994(0x19f),'name':{'$first':_0xb78994(0x12b)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xb78994(0xf7)},'bin':{'$first':_0xb78994(0xd8)},'type':{'$first':_0xb78994(0xc7)},'floorlevel':{'$first':_0xb78994(0xd7)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xb78994(0x1b3)},'product_code':{'$first':_0xb78994(0xf9)},'storage':{'$first':_0xb78994(0x1b4)},'rack':{'$first':'$product_details.rack'}}}]),_0x21d480=await customer['find']({});let _0x91a3f9;if(_0x544f5d[_0xb78994(0x104)]==_0xb78994(0x1ab)){const _0x434096=await staff[_0xb78994(0xbf)]({'email':_0x544f5d[_0xb78994(0x13e)]});_0x91a3f9=await warehouse[_0xb78994(0x1ac)]([{'$match':{'status':_0xb78994(0xec),'name':_0x434096[_0xb78994(0x1bf)],'warehouse_category':_0xb78994(0xe1)}},{'$group':{'_id':_0xb78994(0xe6),'name':{'$first':'$name'}}}]);}else _0x91a3f9=await warehouse[_0xb78994(0x1ac)]([{'$match':{'status':_0xb78994(0xec),'warehouse_category':_0xb78994(0xe1)}},{'$group':{'_id':_0xb78994(0xe6),'name':{'$first':_0xb78994(0xe6)}}}]);const _0x1aae58=await product['find']({});if(_0x5be0f6[0x0]['language']==_0xb78994(0x17d)){var _0x517eed=users[_0xb78994(0x114)];console[_0xb78994(0x118)](_0x517eed);}else{if(_0x5be0f6[0x0][_0xb78994(0xef)]=='Hindi')var _0x517eed=users[_0xb78994(0x1a8)];else{if(_0x5be0f6[0x0][_0xb78994(0xef)]==_0xb78994(0x155))var _0x517eed=users[_0xb78994(0x155)];else{if(_0x5be0f6[0x0][_0xb78994(0xef)]==_0xb78994(0x16c))var _0x517eed=users[_0xb78994(0x16c)];else{if(_0x5be0f6[0x0][_0xb78994(0xef)]==_0xb78994(0x10e))var _0x517eed=users['French'];else{if(_0x5be0f6[0x0][_0xb78994(0xef)]==_0xb78994(0x13a))var _0x517eed=users[_0xb78994(0x174)];else{if(_0x5be0f6[0x0][_0xb78994(0xef)]==_0xb78994(0x19a))var _0x517eed=users[_0xb78994(0x19a)];else{if(_0x5be0f6[0x0][_0xb78994(0xef)]==_0xb78994(0xee))var _0x517eed=users['Arabic'];}}}}}}}_0x298a0a[_0xb78994(0x1a9)](_0xb78994(0xe9),{'success':_0x34fcca[_0xb78994(0xcf)]('success'),'errors':_0x34fcca['flash'](_0xb78994(0x10c)),'role':_0x544f5d,'profile':_0x49537f,'customer':_0x21d480,'warehouse':_0x91a3f9,'product':_0x5bb457,'user':_0xaead19,'master_shop':_0x5be0f6,'unit':_0x1aae58,'language':_0x517eed});}catch(_0x25f1f5){console[_0xb78994(0x118)](_0x25f1f5);}}),router['post'](a0_0x15167a(0x164),auth,async(_0x5afa08,_0x1a7ddf)=>{var _0x2f982a=a0_0x15167a;try{const _0x58dd91=_0x5afa08['params']['id'],_0x3c7b7b=await sales[_0x2f982a(0xbf)]({'_id':_0x5afa08[_0x2f982a(0x182)]['id']}),_0x448ef7=await warehouse['findOne']({'name':_0x3c7b7b[_0x2f982a(0x16e)],'room':_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x130)]}),{invoice:_0x918483,date:_0x2d3f53,warehouse_name:_0x172492,product_name:_0x19280b,stock:_0xee6f5e,quantity:_0x2fdf61,note:_0x58e151,room:_0x11c2d7,customer:_0x28bc6e,SCRN:_0x2f8ba3}=_0x5afa08[_0x2f982a(0x175)];if(typeof _0x19280b==_0x2f982a(0x161))var _0x3deca4=[_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x180)]],_0x34db9b=[_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x178)]],_0x1e9ed4=[_0x5afa08[_0x2f982a(0x175)]['carton']],_0xfa0631=[_0x5afa08[_0x2f982a(0x175)]['primary_code']],_0x2c0a0d=[_0x5afa08[_0x2f982a(0x175)]['secondary_code']],_0x56a0ee=[_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x1b2)]],_0x592173=[_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x191)]],_0x46ecbb=[_0x5afa08[_0x2f982a(0x175)]['primary_unit']],_0x37c755=[_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x18e)]],_0x4d9c55=[_0x5afa08['body'][_0x2f982a(0x14f)]],_0x2f3a11=[_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x105)]],_0x27134c=[_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0xba)]],_0x3fe120=[_0x5afa08[_0x2f982a(0x175)]['production_date']],_0x353be0=[_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x150)]],_0x327dd9=[_0x5afa08[_0x2f982a(0x175)]['delivery_date']],_0x1c0c90=[_0x5afa08['body']['delivery_code']],_0x4ff9bb=[_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0xfd)]],_0x52718a=[_0x5afa08['body']['quantity']],_0x2f20c0=[_0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x103)]];else var _0x3deca4=[..._0x5afa08['body'][_0x2f982a(0x180)]],_0x34db9b=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x178)]],_0x1e9ed4=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x13d)]],_0xfa0631=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x189)]],_0x2c0a0d=[..._0x5afa08[_0x2f982a(0x175)]['secondary_code']],_0x56a0ee=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x1b2)]],_0x592173=[..._0x5afa08['body'][_0x2f982a(0x191)]],_0x46ecbb=[..._0x5afa08['body'][_0x2f982a(0x128)]],_0x37c755=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x18e)]],_0x4d9c55=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x14f)]],_0x2f3a11=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x105)]],_0x27134c=[..._0x5afa08[_0x2f982a(0x175)]['max_per_unit']],_0x3fe120=[..._0x5afa08['body'][_0x2f982a(0x1ba)]],_0x353be0=[..._0x5afa08['body'][_0x2f982a(0x150)]],_0x327dd9=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x12a)]],_0x1c0c90=[..._0x5afa08['body'][_0x2f982a(0x18b)]],_0x4ff9bb=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0xfd)]],_0x52718a=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x106)]],_0x2f20c0=[..._0x5afa08[_0x2f982a(0x175)][_0x2f982a(0x103)]];const _0x10b52e=_0x3deca4[_0x2f982a(0x11f)](_0x1c86a9=>{return _0x1c86a9={'product_name':_0x1c86a9};});_0x34db9b[_0x2f982a(0x1b0)]((_0xd3d003,_0x2edeb5)=>{_0x10b52e[_0x2edeb5]['stock']=Math['abs'](_0xd3d003);}),_0x1e9ed4[_0x2f982a(0x1b0)]((_0x99f7b8,_0x4af3ba)=>{_0x10b52e[_0x4af3ba]['quantity']=_0x99f7b8;}),_0xfa0631['forEach']((_0x138bfe,_0x3623cf)=>{var _0x30c821=_0x2f982a;_0x10b52e[_0x3623cf][_0x30c821(0x189)]=_0x138bfe;}),_0x2c0a0d[_0x2f982a(0x1b0)]((_0x251b8,_0x3d6857)=>{var _0x46e88a=_0x2f982a;_0x10b52e[_0x3d6857][_0x46e88a(0xfc)]=_0x251b8;}),_0x56a0ee[_0x2f982a(0x1b0)]((_0x466bc7,_0x1994e3)=>{_0x10b52e[_0x1994e3]['product_code']=_0x466bc7;}),_0x592173['forEach']((_0x476bb6,_0xe7b686)=>{var _0x51d20c=_0x2f982a;_0x2f20c0[_0x51d20c(0x1b0)]((_0x1ee477,_0x709e6f)=>{var _0x13405c=_0x51d20c;if(_0x1ee477==_0x13405c(0x15b)&&_0xe7b686==_0x709e6f){var _0x508cec=_0x476bb6[_0x13405c(0x1b9)](0x3);_0x10b52e[_0xe7b686][_0x13405c(0x111)]=_0x476bb6[0x0],_0x10b52e[_0xe7b686][_0x13405c(0xd6)]=_0x476bb6[0x1],_0x10b52e[_0xe7b686]['bay']=0x0,_0x10b52e[_0xe7b686][_0x13405c(0x13f)]=0x0,_0x10b52e[_0xe7b686][_0x13405c(0x158)]=_0x13405c(0x10a),_0x10b52e[_0xe7b686][_0x13405c(0xe0)]=_0x508cec;}else{if(_0x1ee477=='Shelves'&&_0xe7b686==_0x709e6f){var _0x508cec=_0x476bb6[_0x13405c(0x1b9)](0x3);_0x10b52e[_0xe7b686]['storage']=_0x476bb6[0x0],_0x10b52e[_0xe7b686]['rack']=_0x476bb6[0x1],_0x10b52e[_0xe7b686][_0x13405c(0xed)]=0x0,_0x10b52e[_0xe7b686][_0x13405c(0x13f)]=0x0,_0x10b52e[_0xe7b686][_0x13405c(0x158)]=_0x13405c(0x10a),_0x10b52e[_0xe7b686][_0x13405c(0xe0)]=_0x476bb6[0x5];}else{if(_0xe7b686==_0x709e6f){var _0xa0144;if(_0x476bb6[0x4]=='L')_0xa0144=_0x13405c(0x147);else _0x476bb6[0x4]=='F'&&(_0xa0144=_0x13405c(0x10a));_0x10b52e[_0xe7b686][_0x13405c(0x111)]=_0x476bb6[0x0],_0x10b52e[_0xe7b686][_0x13405c(0xd6)]=_0x476bb6[0x1],_0x10b52e[_0xe7b686][_0x13405c(0xed)]=_0x476bb6[0x2],_0x10b52e[_0xe7b686][_0x13405c(0x13f)]=_0x476bb6[0x3],_0x10b52e[_0xe7b686][_0x13405c(0x158)]=_0xa0144,_0x10b52e[_0xe7b686]['floorlevel']=_0x476bb6[0x5];}}}});}),_0x46ecbb[_0x2f982a(0x1b0)]((_0x384192,_0x36b636)=>{var _0x5d65b2=_0x2f982a;_0x10b52e[_0x36b636][_0x5d65b2(0x110)]=_0x384192;}),_0x37c755[_0x2f982a(0x1b0)]((_0x26d0a5,_0x1cf849)=>{var _0xe55788=_0x2f982a;_0x10b52e[_0x1cf849][_0xe55788(0x18e)]=_0x26d0a5;}),_0x4d9c55[_0x2f982a(0x1b0)]((_0x570963,_0x12c383)=>{var _0x2f0be7=_0x2f982a;_0x10b52e[_0x12c383][_0x2f0be7(0x14f)]=_0x570963;}),_0x2f3a11[_0x2f982a(0x1b0)]((_0x9b7c2,_0x5e9819)=>{var _0x4521b4=_0x2f982a;_0x10b52e[_0x5e9819][_0x4521b4(0x105)]=_0x9b7c2;}),_0x27134c[_0x2f982a(0x1b0)]((_0x2c847e,_0x36b61c)=>{var _0x48dcee=_0x2f982a;_0x10b52e[_0x36b61c][_0x48dcee(0xbe)]=_0x2c847e;}),_0x3fe120[_0x2f982a(0x1b0)]((_0x5e8541,_0x5af0d4)=>{var _0xd55b47=_0x2f982a;_0x10b52e[_0x5af0d4][_0xd55b47(0x1ba)]=_0x5e8541;}),_0x353be0[_0x2f982a(0x1b0)]((_0xda89b2,_0x925034)=>{var _0x536873=_0x2f982a;_0x10b52e[_0x925034][_0x536873(0x150)]=Math[_0x536873(0x11a)](_0xda89b2);}),_0x327dd9[_0x2f982a(0x1b0)]((_0x1e38d2,_0x2e9a58)=>{var _0xe28b2c=_0x2f982a;_0x10b52e[_0x2e9a58][_0xe28b2c(0x12a)]=_0x1e38d2;}),_0x1c0c90[_0x2f982a(0x1b0)]((_0x594aa0,_0x9260b5)=>{var _0x2fb322=_0x2f982a;_0x10b52e[_0x9260b5][_0x2fb322(0x18b)]=_0x594aa0;}),_0x4ff9bb[_0x2f982a(0x1b0)]((_0x1b9df3,_0xee0db5)=>{var _0x2f2385=_0x2f982a;_0x10b52e[_0xee0db5][_0x2f2385(0xfd)]=_0x1b9df3;}),_0x52718a[_0x2f982a(0x1b0)]((_0x1104aa,_0x404a93)=>{var _0x10622e=_0x2f982a;_0x10b52e[_0x404a93][_0x10622e(0x134)]=_0x1104aa;}),_0x2f20c0['forEach']((_0x4cb000,_0x3981b6)=>{var _0x21361a=_0x2f982a;_0x10b52e[_0x3981b6][_0x21361a(0x11c)]=_0x4cb000;});var _0x4fc304=0x0;_0x10b52e[_0x2f982a(0x1b0)](_0x2588c5=>{var _0x357fb8=_0x2f982a;console['log'](_0x357fb8(0x17f),_0x2588c5),(parseInt(_0x2588c5[_0x357fb8(0x178)])<parseInt(_0x2588c5[_0x357fb8(0x106)])||parseInt(_0x2588c5[_0x357fb8(0x106)])==0x0)&&_0x4fc304++;});if(_0x4fc304!=0x0)return _0x5afa08['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x1a7ddf[_0x2f982a(0xf4)](_0x2f982a(0x196));const _0x175969=_0x10b52e[_0x2f982a(0x140)](_0x5603a3=>_0x5603a3[_0x2f982a(0x106)]!=='0'&&_0x5603a3[_0x2f982a(0x106)]!=='');_0x3c7b7b[_0x2f982a(0x18a)]=_0x918483,_0x3c7b7b[_0x2f982a(0x145)]=_0x28bc6e,_0x3c7b7b[_0x2f982a(0x185)]=_0x2d3f53,_0x3c7b7b[_0x2f982a(0x16e)]=_0x172492,_0x3c7b7b[_0x2f982a(0x113)]=_0x175969,_0x3c7b7b[_0x2f982a(0xd4)]=_0x58e151,_0x3c7b7b[_0x2f982a(0x11b)]=_0x2f8ba3,_0x3c7b7b[_0x2f982a(0xe8)]=_0x2f982a(0x1a4),_0x3c7b7b[_0x2f982a(0x167)]=_0x2f982a(0x1a4);const _0x447766=await _0x3c7b7b[_0x2f982a(0x149)]();_0x5afa08['flash']('success',_0x2f982a(0x1c1)),_0x1a7ddf[_0x2f982a(0xf4)](_0x2f982a(0x16a));}catch(_0xe71648){console[_0x2f982a(0x118)](_0xe71648);}}),router[a0_0x15167a(0xc2)](a0_0x15167a(0x199),auth,async(_0x37f90c,_0x83fe6d)=>{var _0x44f943=a0_0x15167a;try{const _0x46d62f=_0x37f90c[_0x44f943(0x182)]['id'],{invoice:_0x176f61,customer:_0x5d0b84,receivable_amount:_0x40e715,received_amount:_0x15a74a}=_0x37f90c[_0x44f943(0x175)],_0x326d11=await sales[_0x44f943(0x169)](_0x46d62f);console['log'](_0x326d11);var _0x356732=_0x40e715-_0x15a74a;console[_0x44f943(0x118)](_0x15a74a),_0x326d11[_0x44f943(0x179)]=parseFloat(_0x15a74a)+parseFloat(_0x326d11[_0x44f943(0x179)]),_0x326d11[_0x44f943(0x184)]=_0x356732,console[_0x44f943(0x118)](_0x326d11);const _0x2a0246=await _0x326d11[_0x44f943(0x149)](),_0x16c857=await c_payment_data[_0x44f943(0xbf)]({'invoice':_0x176f61});_0x16c857['amount']=_0x356732,await _0x16c857[_0x44f943(0x149)]();let _0x2ee59d=new Date(),_0x3b7bfc=('0'+_0x2ee59d[_0x44f943(0x13c)]())[_0x44f943(0x1b9)](-0x2),_0x116a3c=('0'+(_0x2ee59d['getMonth']()+0x1))[_0x44f943(0x1b9)](-0x2),_0x25f913=_0x2ee59d[_0x44f943(0x119)](),_0x165f4b=_0x25f913+'-'+_0x116a3c+'-'+_0x3b7bfc;const _0x35d10c=new customer_payment({'invoice':_0x176f61,'date':_0x25f913+'-'+_0x116a3c+'-'+_0x3b7bfc,'customer':_0x5d0b84,'reason':_0x44f943(0x154),'amount':_0x15a74a}),_0x17bf95=await _0x35d10c[_0x44f943(0x149)]();_0x37f90c[_0x44f943(0xcf)](_0x44f943(0x153),'payment\x20successfull'),_0x83fe6d['redirect'](_0x44f943(0x16a));}catch(_0x353376){console[_0x44f943(0x118)](_0x353376);}}),router[a0_0x15167a(0x183)](a0_0x15167a(0x131),auth,async(_0x51422a,_0x3af18e)=>{var _0x2deb84=a0_0x15167a;try{const {username:_0x4c65eb,email:_0xcfde45,role:_0xf83040}=_0x51422a[_0x2deb84(0xeb)],_0x183081=_0x51422a[_0x2deb84(0xeb)],_0x37182c=await profile[_0x2deb84(0xbf)]({'email':_0x183081[_0x2deb84(0x13e)]}),_0x1fe779=await master_shop['find']();console[_0x2deb84(0x118)](_0x2deb84(0x194),_0x1fe779);const _0x242fb8=_0x51422a[_0x2deb84(0x182)]['id'],_0x46381d=await sales[_0x2deb84(0x169)](_0x242fb8);console[_0x2deb84(0x118)](_0x46381d);const _0x55d908=await customer[_0x2deb84(0xbf)]({'name':_0x46381d[_0x2deb84(0x145)]});console[_0x2deb84(0x118)](_0x55d908);if(_0x1fe779[0x0]['language']==_0x2deb84(0x17d)){var _0x570540=users[_0x2deb84(0x114)];console[_0x2deb84(0x118)](_0x570540);}else{if(_0x1fe779[0x0][_0x2deb84(0xef)]==_0x2deb84(0x1a8))var _0x570540=users[_0x2deb84(0x1a8)];else{if(_0x1fe779[0x0][_0x2deb84(0xef)]==_0x2deb84(0x155))var _0x570540=users[_0x2deb84(0x155)];else{if(_0x1fe779[0x0][_0x2deb84(0xef)]==_0x2deb84(0x16c))var _0x570540=users[_0x2deb84(0x16c)];else{if(_0x1fe779[0x0][_0x2deb84(0xef)]==_0x2deb84(0x10e))var _0x570540=users['French'];else{if(_0x1fe779[0x0][_0x2deb84(0xef)]=='Portuguese\x20(BR)')var _0x570540=users['Portuguese'];else{if(_0x1fe779[0x0]['language']==_0x2deb84(0x19a))var _0x570540=users[_0x2deb84(0x19a)];else{if(_0x1fe779[0x0][_0x2deb84(0xef)]==_0x2deb84(0xee))var _0x570540=users[_0x2deb84(0x132)];}}}}}}}_0x3af18e[_0x2deb84(0x1a9)](_0x2deb84(0xf0),{'success':_0x51422a[_0x2deb84(0xcf)](_0x2deb84(0x153)),'errors':_0x51422a[_0x2deb84(0xcf)]('errors'),'role':_0x183081,'profile':_0x37182c,'master_shop':_0x1fe779,'customers':_0x55d908,'sales':_0x46381d,'language':_0x570540});}catch(_0x496d3d){console[_0x2deb84(0x118)](_0x496d3d);}}),router[a0_0x15167a(0x183)](a0_0x15167a(0x165),auth,async(_0x5aa701,_0x5ed47e)=>{var _0x578913=a0_0x15167a;try{const {username:_0x250948,email:_0x431dd2,role:_0x4afdd8}=_0x5aa701[_0x578913(0xeb)],_0x114805=_0x5aa701[_0x578913(0xeb)],_0x3c57df=await profile[_0x578913(0xbf)]({'email':_0x114805[_0x578913(0x13e)]}),_0x12ed1b=await master_shop['find']();console[_0x578913(0x118)]('master',_0x12ed1b);const _0x54f2a9=_0x5aa701['params']['id'];console[_0x578913(0x118)](_0x54f2a9);const _0xdae860=await sales['findById'](_0x54f2a9);console[_0x578913(0x118)](_0x578913(0x15e),_0xdae860);const _0x2e8c4c=await warehouse[_0x578913(0x1ac)]([{'$match':{'name':_0x578913(0x143),'room':'Return\x20Rooms'}},{'$unwind':'$product_details'},{'$group':{'_id':_0x578913(0x19f),'name':{'$first':_0x578913(0x12b)},'product_stock':{'$first':_0x578913(0x129)},'level':{'$first':_0x578913(0xc3)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x578913(0x1c0)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x578913(0x1b3)},'product_code':{'$first':_0x578913(0xf9)}}}]);console[_0x578913(0x118)](_0x578913(0x16f),_0x2e8c4c);const _0xd0e273=await product[_0x578913(0x163)]({});warehouse_data=await warehouse[_0x578913(0x1ac)]([{'$match':{'status':'Enabled','name':_0x578913(0x143),'warehouse_category':_0x578913(0xe1)}},{'$group':{'_id':_0x578913(0xe6),'name':{'$first':_0x578913(0xe6)}}},{'$sort':{'name':0x1}}]);var _0x4a2df0=['Return\x20Rooms'];if(_0x12ed1b[0x0][_0x578913(0xef)]==_0x578913(0x17d)){var _0x29839b=users['English'];console[_0x578913(0x118)](_0x29839b);}else{if(_0x12ed1b[0x0][_0x578913(0xef)]==_0x578913(0x1a8))var _0x29839b=users[_0x578913(0x1a8)];else{if(_0x12ed1b[0x0][_0x578913(0xef)]==_0x578913(0x155))var _0x29839b=users[_0x578913(0x155)];else{if(_0x12ed1b[0x0][_0x578913(0xef)]==_0x578913(0x16c))var _0x29839b=users['Spanish'];else{if(_0x12ed1b[0x0]['language']==_0x578913(0x10e))var _0x29839b=users[_0x578913(0x10e)];else{if(_0x12ed1b[0x0][_0x578913(0xef)]=='Portuguese\x20(BR)')var _0x29839b=users['Portuguese'];else{if(_0x12ed1b[0x0][_0x578913(0xef)]=='Chinese')var _0x29839b=users['Chinese'];else{if(_0x12ed1b[0x0]['language']==_0x578913(0xee))var _0x29839b=users[_0x578913(0x132)];}}}}}}}_0x5ed47e[_0x578913(0x1a9)](_0x578913(0x170),{'success':_0x5aa701[_0x578913(0xcf)](_0x578913(0x153)),'errors':_0x5aa701[_0x578913(0xcf)]('errors'),'role':_0x114805,'profile':_0x3c57df,'user':_0xdae860,'stock':_0x2e8c4c,'master_shop':_0x12ed1b,'unit':_0xd0e273,'language':_0x29839b,'warehouses':warehouse_data,'rooms':_0x4a2df0});}catch(_0x1ee6fc){console[_0x578913(0x118)](_0x1ee6fc),_0x5ed47e['status'](0xc8)[_0x578913(0x10d)]({'message':_0x1ee6fc['message']});}}),router[a0_0x15167a(0xc2)](a0_0x15167a(0x165),auth,async(_0x1cee6b,_0x19419b)=>{var _0x113530=a0_0x15167a;try{const {invoice:_0x5d6db0,date:_0x42fd91,warehouse_name:_0x4d1188,product_name:_0x4fb49a,primary_code:_0x438811,secondary_code:_0x595dbc,product_code:_0x3b7b0e,sales_quantity:_0x4171a7,stocks:_0x449016,return_qty:_0x438e2c,Room_name:_0x1616da,to_warehouse_name:_0x2f5db8,to_Roomname:_0x13c7aa,to_Room_name:_0x440401,note:_0x1e7296,level:_0x48d657,isle:_0xddf6d8,pallet:_0x5e5c8c}=_0x1cee6b[_0x113530(0x175)];if(typeof _0x4fb49a==_0x113530(0x161))var _0x12c179=[_0x1cee6b[_0x113530(0x175)][_0x113530(0x180)]],_0x132055=[_0x1cee6b['body'][_0x113530(0x189)]],_0x1fb91b=[_0x1cee6b['body'][_0x113530(0xfc)]],_0x4a6874=[_0x1cee6b[_0x113530(0x175)][_0x113530(0x1be)]],_0x1a28d6=[_0x1cee6b[_0x113530(0x175)][_0x113530(0x116)]],_0x31b5eb=[_0x1cee6b[_0x113530(0x175)][_0x113530(0x172)]],_0x2daca3=[_0x1cee6b['body'][_0x113530(0x1b6)]],_0x240962=[_0x1cee6b['body'][_0x113530(0xed)]],_0x21496c=[_0x1cee6b[_0x113530(0x175)]['bin']],_0x28fd4d=[_0x1cee6b[_0x113530(0x175)]['types']],_0x484f92=[_0x1cee6b[_0x113530(0x175)]['floorlevel']];else var _0x12c179=[..._0x1cee6b[_0x113530(0x175)]['product_name']],_0x132055=[..._0x1cee6b['body'][_0x113530(0x189)]],_0x1fb91b=[..._0x1cee6b[_0x113530(0x175)][_0x113530(0xfc)]],_0x4a6874=[..._0x1cee6b[_0x113530(0x175)][_0x113530(0x1be)]],_0x1a28d6=[..._0x1cee6b[_0x113530(0x175)][_0x113530(0x116)]],_0x31b5eb=[..._0x1cee6b[_0x113530(0x175)][_0x113530(0x172)]],_0x2daca3=[..._0x1cee6b[_0x113530(0x175)]['return_qty']],_0x240962=[..._0x1cee6b[_0x113530(0x175)][_0x113530(0xed)]],_0x21496c=[..._0x1cee6b[_0x113530(0x175)][_0x113530(0x13f)]],_0x28fd4d=[..._0x1cee6b[_0x113530(0x175)][_0x113530(0x136)]],_0x484f92=[..._0x1cee6b['body'][_0x113530(0xe0)]];const _0x59d956=_0x12c179[_0x113530(0x11f)](_0x3972ed=>{return _0x3972ed={'product_name':_0x3972ed};});_0x132055[_0x113530(0x1b0)]((_0x4b7be5,_0x22aec7)=>{var _0x3e5ddf=_0x113530;_0x59d956[_0x22aec7][_0x3e5ddf(0x189)]=_0x4b7be5;}),_0x1fb91b['forEach']((_0x56338a,_0x15d190)=>{var _0xc29041=_0x113530;_0x59d956[_0x15d190][_0xc29041(0xfc)]=_0x56338a;}),_0x4a6874[_0x113530(0x1b0)]((_0x9c67e5,_0x1bb62a)=>{var _0x59dbff=_0x113530;_0x59d956[_0x1bb62a][_0x59dbff(0x1be)]=_0x9c67e5;}),_0x1a28d6[_0x113530(0x1b0)]((_0x39c7d4,_0x51ef01)=>{var _0x2c535a=_0x113530;_0x59d956[_0x51ef01][_0x2c535a(0xe3)]=_0x39c7d4;}),_0x31b5eb[_0x113530(0x1b0)]((_0x5dfa1b,_0x51c88f)=>{_0x59d956[_0x51c88f]['stock']=_0x5dfa1b;}),_0x2daca3[_0x113530(0x1b0)]((_0x2bd79e,_0x3957fe)=>{var _0x2fa363=_0x113530;_0x59d956[_0x3957fe][_0x2fa363(0x1b6)]=_0x2bd79e;}),_0x240962[_0x113530(0x1b0)]((_0x4e2a98,_0x3d8a9b)=>{var _0x3ab12d=_0x113530;_0x59d956[_0x3d8a9b][_0x3ab12d(0xed)]=_0x4e2a98;}),_0x21496c['forEach']((_0x54ad67,_0x3db8a8)=>{var _0x42cfaa=_0x113530;_0x59d956[_0x3db8a8][_0x42cfaa(0x13f)]=_0x54ad67;}),_0x28fd4d[_0x113530(0x1b0)]((_0x38798a,_0x1af3ff)=>{_0x59d956[_0x1af3ff]['type']=_0x38798a;}),_0x484f92[_0x113530(0x1b0)]((_0x529863,_0x1cdb9c)=>{_0x59d956[_0x1cdb9c]['floorlevel']=_0x529863;});var _0x33749a=0x0;_0x59d956[_0x113530(0x1b0)](_0x35ea57=>{var _0x35ba1b=_0x113530;console[_0x35ba1b(0x118)](_0x35ba1b(0x17f),_0x35ea57),(parseInt(_0x35ea57[_0x35ba1b(0xe3)])<parseInt(_0x35ea57['return_qty'])||parseInt(_0x35ea57[_0x35ba1b(0x178)])<parseInt(_0x35ea57['return_qty'])&&parseInt(_0x35ea57['sale_qty'])>parseInt(_0x35ea57['return_qty'])||parseInt(_0x35ea57[_0x35ba1b(0x1b6)])==0x0)&&_0x33749a++;});if(_0x33749a!=0x0)return _0x1cee6b['flash'](_0x113530(0x10c),_0x113530(0xea)),_0x19419b['redirect']('back');const _0x44ca04=await sales[_0x113530(0xbf)]({'invoice':_0x5d6db0});console[_0x113530(0x118)](_0x44ca04),_0x44ca04[_0x113530(0x139)]=_0x113530(0x146);const _0x38b5b0=await _0x44ca04[_0x113530(0x149)](),_0x3950c0=new sales_return({'invoice':_0x5d6db0,'customer':_0x1cee6b[_0x113530(0x175)]['customer'],'date':_0x42fd91,'warehouse_name':_0x4d1188,'room':_0x1616da,'ToWarehouse':_0x2f5db8,'ToRoom':_0x440401,'return_sale':_0x59d956,'note':_0x1e7296}),_0x46cc94=await _0x3950c0[_0x113530(0x149)]();console[_0x113530(0x118)](_0x3950c0);const _0x35df80=await sales_return[_0x113530(0xbf)]({'invoice':_0x5d6db0}),_0x3cc8a7=await warehouse['findOne']({'name':_0x2f5db8,'room':_0x440401});_0x35df80[_0x113530(0x170)][_0x113530(0x1b0)](_0x5e0d64=>{var _0x5669eb=_0x113530,_0x297957=0x0;const _0x4c231b=_0x3cc8a7[_0x5669eb(0x10f)][_0x5669eb(0x11f)](_0x404e7e=>{var _0x111036=_0x5669eb;_0x404e7e[_0x111036(0x180)]==_0x5e0d64[_0x111036(0x180)]&&_0x404e7e[_0x111036(0xe0)]==_0x5e0d64[_0x111036(0xe0)]&&_0x404e7e[_0x111036(0x158)]==_0x5e0d64[_0x111036(0x158)]&&_0x404e7e['bin']==_0x5e0d64[_0x111036(0x13f)]&&_0x404e7e[_0x111036(0xed)]==_0x5e0d64[_0x111036(0xed)]&&(_0x404e7e[_0x111036(0x133)]=parseInt(_0x404e7e[_0x111036(0x133)])+parseInt(_0x5e0d64['return_qty']),_0x297957++);});_0x297957=='0'&&(_0x3cc8a7[_0x5669eb(0x10f)]=_0x3cc8a7['product_details'][_0x5669eb(0x181)]({'product_name':_0x5e0d64[_0x5669eb(0x180)],'product_stock':_0x5e0d64[_0x5669eb(0x1b6)],'primary_code':_0x5e0d64[_0x5669eb(0x189)],'secondary_code':_0x5e0d64['secondary_code'],'product_code':_0x5e0d64['product_code'],'bay':_0x5e0d64[_0x5669eb(0xed)],'bin':_0x5e0d64['bin'],'type':_0x5e0d64['type'],'floorlevel':_0x5e0d64[_0x5669eb(0xe0)]})),console[_0x5669eb(0x118)](_0x5669eb(0x15c),_0x3cc8a7);}),await _0x3cc8a7[_0x113530(0x149)](),console[_0x113530(0x118)](_0x1cee6b[_0x113530(0x175)]);const _0x44f570=new c_payment_data({'invoice':_0x5d6db0,'customer':_0x1cee6b[_0x113530(0x175)][_0x113530(0x145)],'reason':_0x113530(0x101)});await _0x44f570[_0x113530(0x149)]();const _0x5717c2=await master_shop[_0x113530(0x163)]();console[_0x113530(0x118)](_0x113530(0xce),_0x5717c2[0x0][_0x113530(0xf5)]);const _0xa68c3a=await email_settings[_0x113530(0xbf)](),_0x24e0c7=await customer[_0x113530(0xbf)]({'name':_0x1cee6b[_0x113530(0x175)][_0x113530(0x145)]});console[_0x113530(0x118)]('customer_data',_0x24e0c7);_0x5717c2[0x0]['currency_placement']==0x1?(right_currency=_0x5717c2[0x0][_0x113530(0x115)],left_currency=''):(right_currency='',left_currency=_0x5717c2[0x0][_0x113530(0x115)]);var _0x2e1432=_0x12c179,_0x24d9f3=_0x2daca3,_0x47b1b0='',_0x44477b;for(_0x44477b in _0x2e1432){_0x47b1b0+=_0x113530(0x171)+_0x113530(0x148)+_0x2e1432[_0x44477b]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x24d9f3[_0x44477b]+_0x113530(0x193)+'</tr>';}console[_0x113530(0x118)](_0x113530(0xe5),_0x47b1b0);let _0x5681e2=nodemailer[_0x113530(0x144)]({'service':_0x113530(0x186),'auth':{'user':_0xa68c3a[_0x113530(0x13e)],'pass':_0xa68c3a[_0x113530(0xcc)]}}),_0x1d9012={'from':_0xa68c3a[_0x113530(0x13e)],'to':_0x24e0c7['email'],'subject':_0x113530(0xb9),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x113530(0xc4)+_0x5717c2[0x0][_0x113530(0xf5)],'cid':'logo'}],'html':_0x113530(0x12d)+_0x113530(0x117)+'</head><body>'+_0x113530(0x18f)+_0x113530(0x187)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x113530(0x18f)+_0x113530(0x1bb)+_0x5717c2[0x0][_0x113530(0x195)]+_0x113530(0xc9)+_0x113530(0x142)+_0x113530(0x142)+_0x113530(0x152)+'<div>'+_0x113530(0xff)+_0x113530(0xde)+_0x5d6db0+'\x20'+_0x113530(0x12c)+_0x113530(0xd3)+_0x42fd91+'\x20'+_0x113530(0x137)+_0x113530(0x127)+_0x113530(0x142)+_0x113530(0x10b)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x113530(0xbc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x113530(0xcb)+_0x113530(0xf1)+_0x113530(0x160)+'</thead>'+_0x113530(0x14c)+'\x20'+_0x47b1b0+'\x20'+'</tbody>'+'</table>'+_0x113530(0x18f)+_0x113530(0x17e)+'<h5>'+_0x5717c2[0x0][_0x113530(0x195)]+_0x113530(0x127)+_0x113530(0x142)+'</div>'+'</body></html>'};_0x5681e2[_0x113530(0x14b)](_0x1d9012,function(_0x2f54a7,_0x51272c){var _0x5b5ae5=_0x113530;_0x2f54a7?(console[_0x5b5ae5(0x118)](_0x2f54a7),console[_0x5b5ae5(0x118)](_0x5b5ae5(0x162))):console[_0x5b5ae5(0x118)](_0x5b5ae5(0x16b));}),_0x1cee6b['flash']('success',_0x113530(0x120)),_0x19419b[_0x113530(0xf4)](_0x113530(0x16a));}catch(_0x5ce502){console[_0x113530(0x118)](_0x5ce502),_0x19419b[_0x113530(0x124)](0xc8)[_0x113530(0x10d)]({'message1':_0x5ce502[_0x113530(0x157)]});}}),router[a0_0x15167a(0x183)](a0_0x15167a(0x15a),auth,async(_0x3931c2,_0x404db9)=>{var _0x3ff5c7=a0_0x15167a;try{const {username:_0x54e76c,email:_0x3c7b90,role:_0x5d8f33}=_0x3931c2['user'],_0x18f736=_0x3931c2['user'],_0x2e789e=await profile[_0x3ff5c7(0xbf)]({'email':_0x18f736[_0x3ff5c7(0x13e)]}),_0x311e68=await master_shop['find']();console['log'](_0x3ff5c7(0x176),_0x311e68);const _0x1f4ae4=_0x3931c2[_0x3ff5c7(0x182)]['id'],_0x49f788=await sales[_0x3ff5c7(0x169)](_0x1f4ae4);console['log'](_0x3ff5c7(0x16d),_0x49f788);if(_0x311e68[0x0][_0x3ff5c7(0xef)]==_0x3ff5c7(0x17d))var _0x1acb88=users['English'];else{if(_0x311e68[0x0][_0x3ff5c7(0xef)]=='Hindi')var _0x1acb88=users[_0x3ff5c7(0x1a8)];else{if(_0x311e68[0x0]['language']==_0x3ff5c7(0x155))var _0x1acb88=users['German'];else{if(_0x311e68[0x0][_0x3ff5c7(0xef)]=='Spanish')var _0x1acb88=users[_0x3ff5c7(0x16c)];else{if(_0x311e68[0x0]['language']==_0x3ff5c7(0x10e))var _0x1acb88=users['French'];else{if(_0x311e68[0x0][_0x3ff5c7(0xef)]==_0x3ff5c7(0x13a))var _0x1acb88=users[_0x3ff5c7(0x174)];else{if(_0x311e68[0x0][_0x3ff5c7(0xef)]==_0x3ff5c7(0x19a))var _0x1acb88=users[_0x3ff5c7(0x19a)];else{if(_0x311e68[0x0][_0x3ff5c7(0xef)]==_0x3ff5c7(0xee))var _0x1acb88=users[_0x3ff5c7(0x132)];}}}}}}}_0x404db9[_0x3ff5c7(0x1a9)]('all_sales_barcode',{'success':_0x3931c2[_0x3ff5c7(0xcf)]('success'),'errors':_0x3931c2['flash'](_0x3ff5c7(0x10c)),'role':_0x18f736,'profile':_0x2e789e,'alldata':_0x49f788,'master_shop':_0x311e68,'language':_0x1acb88});}catch(_0x1ad122){console['log'](_0x1ad122);}}),router[a0_0x15167a(0xc2)](a0_0x15167a(0x17a),async(_0x23d561,_0x4b5beb)=>{var _0x3ebb13=a0_0x15167a;const {product_code:_0x3fe694,warehouse_name:_0x4d8b0c,rooms_data:_0xecb480,Roomslist:_0x4e93d0}=_0x23d561[_0x3ebb13(0x175)],_0x14f66f=_0x4e93d0[_0x3ebb13(0x14a)](','),_0x31a435=[];async function _0x1b43e5(_0xf7d03b){var _0x16b374=_0x3ebb13;const _0x286de7=await warehouse[_0x16b374(0x1ac)]([{'$match':{'name':_0x4d8b0c,'room':_0xf7d03b}},{'$unwind':_0x16b374(0xd9)},{'$match':{'product_details.primary_code':_0x3fe694}},{'$group':{'_id':_0x16b374(0x19f),'name':{'$first':_0x16b374(0x12b)},'product_stock':{'$first':_0x16b374(0x129)},'primary_code':{'$first':_0x16b374(0xfa)},'secondary_code':{'$first':_0x16b374(0x1b3)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x16b374(0xf7)},'isle':{'$first':_0x16b374(0xd8)},'type':{'$first':_0x16b374(0xc7)},'pallet':{'$first':_0x16b374(0xd7)},'unit':{'$first':_0x16b374(0x122)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x16b374(0x1b4)},'rack':{'$first':_0x16b374(0x126)},'expiry_date':{'$first':_0x16b374(0x1bd)},'production_date':{'$first':_0x16b374(0x1ae)},'maxPerUnit':{'$first':_0x16b374(0x18c)},'batch_code':{'$first':_0x16b374(0x138)},'product_cat':{'$first':_0x16b374(0xdb)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x16b374(0x18d)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x16b374(0xfe)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x5956d6=await warehouse['aggregate']([{'$match':{'name':_0x4d8b0c,'room':_0xf7d03b}},{'$unwind':_0x16b374(0xd9)},{'$match':{'product_details.secondary_code':_0x3fe694}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x16b374(0x12b)},'product_stock':{'$first':_0x16b374(0x129)},'primary_code':{'$first':_0x16b374(0xfa)},'secondary_code':{'$first':_0x16b374(0x1b3)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x16b374(0xd8)},'type':{'$first':_0x16b374(0xc7)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x16b374(0x122)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x16b374(0x1b4)},'rack':{'$first':_0x16b374(0x126)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x16b374(0x18c)},'batch_code':{'$first':_0x16b374(0x138)},'product_cat':{'$first':_0x16b374(0xdb)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x16b374(0x1b1)}}}]);if(_0x286de7[_0x16b374(0xc1)]>0x0)_0x31a435[_0x16b374(0xf3)](_0x286de7);else _0x5956d6[_0x16b374(0xc1)]>0x0&&_0x31a435[_0x16b374(0xf3)](_0x5956d6);}const _0x26b8d9=_0x14f66f[_0x3ebb13(0x11f)](_0x3f88e5=>_0x1b43e5(_0x3f88e5));await Promise[_0x3ebb13(0x168)](_0x26b8d9),_0x4b5beb[_0x3ebb13(0x10d)](_0x31a435);}),module[a0_0x15167a(0x159)]=router;