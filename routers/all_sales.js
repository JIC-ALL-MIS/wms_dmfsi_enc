var a0_0x344a80=a0_0x56bd;(function(_0x19a55d,_0xd495bb){var _0x2caefb=a0_0x56bd,_0x589222=_0x19a55d();while(!![]){try{var _0x437389=parseInt(_0x2caefb(0x216))/0x1+-parseInt(_0x2caefb(0x107))/0x2*(parseInt(_0x2caefb(0x12e))/0x3)+parseInt(_0x2caefb(0x103))/0x4*(parseInt(_0x2caefb(0x161))/0x5)+-parseInt(_0x2caefb(0x127))/0x6+-parseInt(_0x2caefb(0x1a2))/0x7*(-parseInt(_0x2caefb(0x10a))/0x8)+-parseInt(_0x2caefb(0x20b))/0x9*(-parseInt(_0x2caefb(0x207))/0xa)+-parseInt(_0x2caefb(0x1c6))/0xb;if(_0x437389===_0xd495bb)break;else _0x589222['push'](_0x589222['shift']());}catch(_0x27073e){_0x589222['push'](_0x589222['shift']());}}}(a0_0x4d4e,0x5a15f));const express=require(a0_0x344a80(0x20a)),app=express(),router=express[a0_0x344a80(0x1c8)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x344a80(0x1b5)),nodemailer=require(a0_0x344a80(0x1cb)),users=require(a0_0x344a80(0x116));router[a0_0x344a80(0x1b8)]('/view',auth,async(_0xd97bd5,_0xd11fc9)=>{var _0x503d09=a0_0x344a80;try{const {username:_0x31b3f5,email:_0x380ccf,role:_0x157634}=_0xd97bd5[_0x503d09(0x1b9)],_0x3408dc=_0xd97bd5[_0x503d09(0x1b9)],_0x32d65b=await profile['findOne']({'email':_0x3408dc[_0x503d09(0x202)]}),_0x1c12ef=await master_shop[_0x503d09(0x15f)]();let _0x39ddfb;if(_0x3408dc[_0x503d09(0x128)]==_0x503d09(0x153)){const _0x3a146a=await staff[_0x503d09(0x122)]({'email':_0x3408dc['email']});_0x39ddfb=await sales[_0x503d09(0x113)]([{'$lookup':{'from':_0x503d09(0x176),'localField':_0x503d09(0x1b7),'foreignField':'name','as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x503d09(0x19e)},{'$group':{'_id':_0x503d09(0x215),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x503d09(0x148)},'date':{'$first':_0x503d09(0x1b3)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x503d09(0x18c)},'return_data':{'$first':_0x503d09(0x14f)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x503d09(0x1aa)},'level':{'$addToSet':_0x503d09(0x1ab)},'isle':{'$addToSet':_0x503d09(0x18b)},'type':{'$addToSet':_0x503d09(0x217)},'pallet':{'$addToSet':_0x503d09(0x126)},'finalize':{'$first':_0x503d09(0x180)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x39ddfb=await sales[_0x503d09(0x113)]([{'$lookup':{'from':_0x503d09(0x176),'localField':_0x503d09(0x1b7),'foreignField':_0x503d09(0x212),'as':'customers_docs'}},{'$unwind':_0x503d09(0x102)},{'$unwind':_0x503d09(0x19e)},{'$group':{'_id':'$_id','invoice':{'$first':_0x503d09(0x189)},'customers':{'$first':_0x503d09(0x148)},'date':{'$first':_0x503d09(0x1b3)},'warehouse_name':{'$first':_0x503d09(0x1f0)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x503d09(0x18c)},'return_data':{'$first':_0x503d09(0x14f)},'customers_docs':{'$first':_0x503d09(0x102)},'total_saleproduct_quantity':{'$sum':_0x503d09(0x1aa)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x503d09(0x18b)},'type':{'$addToSet':_0x503d09(0x217)},'pallet':{'$addToSet':_0x503d09(0x126)},'finalize':{'$first':_0x503d09(0x180)},'isAllowEdit':{'$first':_0x503d09(0x1cf)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x503d09(0x16c)](_0x503d09(0x1bf),_0x39ddfb);if(_0x1c12ef[0x0][_0x503d09(0x147)]==_0x503d09(0x1d2)){var _0x24323b=users[_0x503d09(0x1c2)];console['log'](_0x24323b);}else{if(_0x1c12ef[0x0][_0x503d09(0x147)]==_0x503d09(0x1ee))var _0x24323b=users[_0x503d09(0x1ee)];else{if(_0x1c12ef[0x0][_0x503d09(0x147)]==_0x503d09(0x199))var _0x24323b=users[_0x503d09(0x199)];else{if(_0x1c12ef[0x0]['language']==_0x503d09(0x15b))var _0x24323b=users[_0x503d09(0x15b)];else{if(_0x1c12ef[0x0][_0x503d09(0x147)]==_0x503d09(0x1e3))var _0x24323b=users['French'];else{if(_0x1c12ef[0x0][_0x503d09(0x147)]==_0x503d09(0x101))var _0x24323b=users[_0x503d09(0x145)];else{if(_0x1c12ef[0x0][_0x503d09(0x147)]=='Chinese')var _0x24323b=users[_0x503d09(0x16f)];else{if(_0x1c12ef[0x0][_0x503d09(0x147)]=='Arabic\x20(ae)')var _0x24323b=users[_0x503d09(0x146)];}}}}}}}_0xd11fc9[_0x503d09(0xff)](_0x503d09(0x129),{'success':_0xd97bd5['flash'](_0x503d09(0x17c)),'errors':_0xd97bd5[_0x503d09(0x1d4)](_0x503d09(0x12b)),'sales':_0x39ddfb,'profile':_0x32d65b,'role':_0x3408dc,'master_shop':_0x1c12ef,'language':_0x24323b});}catch(_0x55c1ec){console['log'](_0x55c1ec);}});function a0_0x56bd(_0x93b133,_0x1c6024){var _0x4d4e27=a0_0x4d4e();return a0_0x56bd=function(_0x56bd67,_0x25bb86){_0x56bd67=_0x56bd67-0xff;var _0xe07732=_0x4d4e27[_0x56bd67];return _0xe07732;},a0_0x56bd(_0x93b133,_0x1c6024);}function a0_0x4d4e(){var _0xee9a61=['exports','express','9FMcSHT','$product_details.product_stock','Received\x20Payment\x20For\x20Sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.expiry_date','push','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','name','<span\x20style=\x22float:\x20right;\x22>','host','$_id','303957UiAkzt','$sale_product.type','render','slice','Portuguese\x20(BR)','$customers_docs','8aMqBcd','$product_details.level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/view/add_sales/:id','12EZeVpi','Sales\x20Add\x20successfully','sendMail','4824nkTEDQ','toString','storage','</h5>','secondary_unit','</tr>','add_sales','return_data','master','aggregate','$product_details.pallet','Shelves','../public/language/languages.json','$product_details.invoice','Level','product_name','floorlevel','prod_code','Enclosed','Ambient','/view/return_sales/:id','<hr\x20class=\x22my-3\x22>','abs','Raw\x20Materials','findOne','add\x20post','final','quantity_notConverted','$sale_product.floorlevel','2010738CFvYDj','role','all_sales','prod_cat','errors','product_stock','payment\x20successfull','220215eIjugP','$product_details.rack','warehouse_name','$product_details.secondary_unit','map','error','$product_details.batch_code','/view/:id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','params','\x20Order\x20Date\x20:\x20','Enabled','RoomAssigned','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','requested_qty','json','secondary_code','return_qty','\x20Order\x20Number\x20:\x20','/../public','all','delivery_date','$name','Portuguese','Arabic','language','$customer','\x20</h2>','$product_details.primary_code','finalize','Email\x20sent\x20successfully','redirect','expiry_date','$return_data','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Sale\x20Return\x20Mail','staff','OUT-','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','createTransport','getDate','$product','</thead>','Spanish','stock','An\x20error\x20occurred.','There\x27s\x20a\x20error\x20in\x20this\x20transaction','find','rack','1542255EvqdBk','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','foreach\x20newproduct','SCRN','/give_payment/:id','return_sale','product_code','sale_product','body','Error\x20Occurs','forEach','log','Floor','message','Chinese','currency','bay','date','<div>','$product_details._id','random','customers','status','string','_id','save','An\x20error\x20occurred\x20while\x20saving\x20data.','success','prod_invoice','<html><head><title></title>','barcode\x20Product\x20master','$finalize','</td>','$product_details.product_cat','RMSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','getFullYear','<h2>\x20','$product_details.maxPerUnit','site_title','$invoice','</tbody>','$sale_product.bin','$note','warehouse','Return\x20Rooms','$product_details.unit','</body></html>','bin','delivery_code','/view/add_sale/product','amount','$product_details.bay','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','product_details','sales_quantity','German','customer_data','$product_details.bin','</span>','Receiving\x20Area','$sale_product','back','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details','2569wpchQJ','level','catch','max_per_unit','$product_details.product_code','quantity','/all_sales/preview/','product_list','$sale_product.quantity','$sale_product.bay','stock_data','maxperunit','password','/preview/:id','Arabic\x20(ae)','stocks','actual_qty','$date','floor','../middleware/auth','Logo.png','customer','get','user','Return\x20Goods','$product_details.type','sale_qty','findById','length','sales\x20all_data','types','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','English','type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','barcode\x20user_id','1020943DqkxKi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Router','$product_details.secondary_code','filter','nodemailer','Sales\x20Mail','$product.product_name','purchases_data','$isAllowEdit','user_id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','English\x20(US)','$product_details.actual_qty','flash','post','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.floorlevel','all_sales_barcode','concat','edit_sales','due_amount','/invoice/:id','<h5\x20style=\x22text-align:\x20left;\x22>','gmail','sales_invoice','$product_details.production_date','carton','<tbody\x20style=\x22text-align:\x20center;\x22>','French','$product_details.isle','</div>','production_date','unit','room_name','<!DOCTYPE\x20html>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','True','Sales\x20Update\x20successfully','port','Hindi','logo','$warehouse_name','sales\x20item\x20return\x20successfull','batch_code','$product_details.product_name','received_amount','split','image','/view/add_sales','note','primary_code','<tr>','</table>','invoice','then','False','</head><body>','<h5>','Sale\x20Return','email','/all_sales/view','$room','edit_sales_view','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','951970owilWY','primary_unit'];a0_0x4d4e=function(){return _0xee9a61;};return a0_0x4d4e();}async function getRandom8DigitNumber(){var _0x582b57=a0_0x344a80;const _0x4aec28=0x989680,_0x311a3e=0x5f5e0ff,_0x177874=Math[_0x582b57(0x1b4)](Math[_0x582b57(0x175)]()*(_0x311a3e-_0x4aec28+0x1))+_0x4aec28;var _0x27756a;const _0x329b26=await sales[_0x582b57(0x122)]({'invoice':_0x582b57(0x154)+_0x177874});return _0x329b26&&_0x329b26[_0x582b57(0x1be)]>0x0?_0x27756a='OUT-'+_0x177874:_0x27756a=_0x582b57(0x154)+_0x177874,_0x27756a;}router[a0_0x344a80(0x1b8)](a0_0x344a80(0x1f7),auth,async(_0xb2e9b5,_0x417a71)=>{var _0x126ad4=a0_0x344a80;try{const {username:_0x19f9f8,email:_0x5519ee,role:_0x188b3f}=_0xb2e9b5[_0x126ad4(0x1b9)],_0x29d644=_0xb2e9b5[_0x126ad4(0x1b9)],_0x39f250=await profile[_0x126ad4(0x122)]({'email':_0x29d644[_0x126ad4(0x202)]}),_0x3456f7=await master_shop[_0x126ad4(0x15f)](),_0xd9e85c=await customer['find']({});let _0x8ee59f;if(_0x29d644[_0x126ad4(0x128)]==_0x126ad4(0x153)){const _0xb12de2=await staff[_0x126ad4(0x122)]({'email':_0x29d644[_0x126ad4(0x202)]});_0x8ee59f=await warehouse[_0x126ad4(0x113)]([{'$match':{'status':_0x126ad4(0x139),'name':_0xb12de2['warehouse'],'warehouse_category':_0x126ad4(0x121),'name':{'$ne':_0x126ad4(0x1ba)}}},{'$group':{'_id':_0x126ad4(0x144),'name':{'$first':_0x126ad4(0x144)}}},{'$sort':{'name':0x1}}]);}else _0x8ee59f=await warehouse[_0x126ad4(0x113)]([{'$match':{'status':_0x126ad4(0x139),'warehouse_category':_0x126ad4(0x121),'name':{'$ne':_0x126ad4(0x1ba)}}},{'$group':{'_id':_0x126ad4(0x144),'name':{'$first':_0x126ad4(0x144)}}},{'$sort':{'name':0x1}}]);const _0x506736=await product[_0x126ad4(0x15f)]({});var _0x334a29=[_0x126ad4(0x11d),_0x126ad4(0x11c)];const _0x2f6876=await sales['find']({}),_0x247a09=_0x2f6876['length']+0x1,_0x31d6f2=_0x126ad4(0x154)+_0x247a09[_0x126ad4(0x10b)]()['padStart'](0x5,'0');if(_0x3456f7[0x0][_0x126ad4(0x147)]==_0x126ad4(0x1d2)){var _0xf08aac=users[_0x126ad4(0x1c2)];console['log'](_0xf08aac);}else{if(_0x3456f7[0x0][_0x126ad4(0x147)]==_0x126ad4(0x1ee))var _0xf08aac=users[_0x126ad4(0x1ee)];else{if(_0x3456f7[0x0][_0x126ad4(0x147)]=='German')var _0xf08aac=users[_0x126ad4(0x199)];else{if(_0x3456f7[0x0][_0x126ad4(0x147)]==_0x126ad4(0x15b))var _0xf08aac=users[_0x126ad4(0x15b)];else{if(_0x3456f7[0x0][_0x126ad4(0x147)]==_0x126ad4(0x1e3))var _0xf08aac=users[_0x126ad4(0x1e3)];else{if(_0x3456f7[0x0][_0x126ad4(0x147)]==_0x126ad4(0x101))var _0xf08aac=users[_0x126ad4(0x145)];else{if(_0x3456f7[0x0]['language']==_0x126ad4(0x16f))var _0xf08aac=users[_0x126ad4(0x16f)];else{if(_0x3456f7[0x0]['language']==_0x126ad4(0x1b0))var _0xf08aac=users['Arabic'];}}}}}}}const _0x385730=getRandom8DigitNumber();_0x385730[_0x126ad4(0x1fd)](_0x501f1a=>{var _0x340cbf=_0x126ad4;_0x417a71[_0x340cbf(0xff)](_0x340cbf(0x110),{'success':_0xb2e9b5[_0x340cbf(0x1d4)]('success'),'errors':_0xb2e9b5[_0x340cbf(0x1d4)](_0x340cbf(0x12b)),'role':_0x29d644,'profile':_0x39f250,'customer':_0xd9e85c,'warehouse':_0x8ee59f,'product':_0x506736,'invoice':_0x501f1a,'master_shop':_0x3456f7,'language':_0xf08aac,'rooms_data':_0x334a29});})[_0x126ad4(0x1a4)](_0x3cc170=>{var _0x3b95c9=_0x126ad4;_0xb2e9b5['flash'](_0x3b95c9(0x12b),_0x3b95c9(0x15e)),_0x417a71[_0x3b95c9(0x14d)](_0x3b95c9(0x203));});}catch(_0x55f543){console[_0x126ad4(0x16c)](_0x55f543);}}),router[a0_0x344a80(0x1b8)](a0_0x344a80(0x106),auth,async(_0x38c693,_0x242284)=>{var _0x12b150=a0_0x344a80;try{const _0x578011=_0x38c693[_0x12b150(0x137)]['id'];console['log'](_0x578011);const _0x4ac8de=await product[_0x12b150(0x15f)](),_0x4f4dff=await purchases['aggregate']([{'$match':{'warehouse_name':_0x578011}},{'$unwind':_0x12b150(0x159)},{'$group':{'_id':_0x12b150(0x1cd)}}]);console[_0x12b150(0x16c)](_0x12b150(0x1ce),_0x4f4dff),_0x242284[_0x12b150(0x177)](0xc8)[_0x12b150(0x13d)]({'purchases_data':_0x4f4dff,'product_data':_0x4ac8de});}catch(_0x5ad6fb){console['log'](_0x5ad6fb);}}),router[a0_0x344a80(0x1d5)](a0_0x344a80(0x193),auth,async(_0x998561,_0x1f204b)=>{var _0xcc8422=a0_0x344a80;try{const {warehouse_data:_0x361227,product_data:_0x229b69}=_0x998561[_0xcc8422(0x169)];console['log'](_0x998561[_0xcc8422(0x169)]['product_data']);;const _0x3a570e=await master_shop[_0xcc8422(0x15f)]();console[_0xcc8422(0x16c)](_0xcc8422(0x112),_0x3a570e);const _0x1a235f=await product['findOne']({'name':_0x229b69});console[_0xcc8422(0x16c)]('product',_0x1a235f);const _0x4c691d=await warehouse[_0xcc8422(0x113)]([{'$match':{'name':_0x361227}},{'$unwind':_0xcc8422(0x1a1)},{'$match':{'product_details.product_name':_0x229b69}},{'$group':{'_id':_0xcc8422(0x1f3),'product_stock':{'$first':_0xcc8422(0x20c)}}}]);console['log'](_0xcc8422(0x1ac),_0x4c691d),_0x1f204b['status'](0xc8)[_0xcc8422(0x13d)]({'master':_0x3a570e,'new_product':_0x1a235f,'stock_data':_0x4c691d});}catch(_0xcf7c4f){console[_0xcc8422(0x16c)](_0xcf7c4f);}}),router[a0_0x344a80(0x1d5)](a0_0x344a80(0x1f7),auth,async(_0x24f97e,_0x4f1827)=>{var _0xe99fb9=a0_0x344a80;try{const {invoice:_0x25d85e,date:_0x6746dc,warehouse_name:_0x57bd2d,product_name:_0x42d471,stock:_0x141604,quantity:_0x401e8e,note:_0x105193,room:_0x4f6564,primary_code:_0x130364,secondary_code:_0x346a5b,prod_code:_0x3e879c,level:_0x7769d3,isle:_0x40c0b6,pallet:_0x3c8275,batch_code:_0x3163a1,SCRN:_0xd65605,expiry_date:_0x16fc37}=_0x24f97e[_0xe99fb9(0x169)];if(typeof _0x42d471==_0xe99fb9(0x178))var _0x5059df=[_0x24f97e['body'][_0xe99fb9(0x119)]],_0xb5671d=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x15c)]],_0x4236e5=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x1e1)]],_0x4f2713=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x1f9)]],_0x560fc2=[_0x24f97e[_0xe99fb9(0x169)]['secondary_code']],_0x420dea=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x11b)]],_0x302526=[_0x24f97e['body'][_0xe99fb9(0x1a3)]],_0xf98f36=[_0x24f97e['body'][_0xe99fb9(0x208)]],_0x247123=[_0x24f97e[_0xe99fb9(0x169)]['secondary_unit']],_0x2c473a=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x1f2)]],_0x3850f3=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x14e)]],_0x30029a=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x1a5)]],_0x372a56=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x1e6)]],_0x4433bb=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x13c)]],_0x33090c=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x143)]],_0x38180c=[_0x24f97e['body'][_0xe99fb9(0x192)]],_0x4f50df=[_0x24f97e[_0xe99fb9(0x169)]['prod_cat']],_0x3d435b=[_0x24f97e[_0xe99fb9(0x169)]['quantity']],_0x5e7cee=[_0x24f97e[_0xe99fb9(0x169)]['RoomAssigned']],_0x21c0ed=[_0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x17d)]],_0x3ff79e=[_0x24f97e['body'][_0xe99fb9(0x1b2)]],_0x4da885=[_0x24f97e[_0xe99fb9(0x169)]['actual_uom']];else var _0x5059df=[..._0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x119)]],_0xb5671d=[..._0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x15c)]],_0x4236e5=[..._0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x1e1)]],_0x4f2713=[..._0x24f97e['body'][_0xe99fb9(0x1f9)]],_0x560fc2=[..._0x24f97e['body'][_0xe99fb9(0x13e)]],_0x420dea=[..._0x24f97e['body'][_0xe99fb9(0x11b)]],_0x302526=[..._0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x1a3)]],_0xf98f36=[..._0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x208)]],_0x247123=[..._0x24f97e['body']['secondary_unit']],_0x2c473a=[..._0x24f97e['body'][_0xe99fb9(0x1f2)]],_0x3850f3=[..._0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x14e)]],_0x30029a=[..._0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x1a5)]],_0x372a56=[..._0x24f97e['body']['production_date']],_0x4433bb=[..._0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x13c)]],_0x33090c=[..._0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x143)]],_0x38180c=[..._0x24f97e[_0xe99fb9(0x169)]['delivery_code']],_0x4f50df=[..._0x24f97e['body'][_0xe99fb9(0x12a)]],_0x3d435b=[..._0x24f97e[_0xe99fb9(0x169)][_0xe99fb9(0x1a7)]],_0x5e7cee=[..._0x24f97e[_0xe99fb9(0x169)]['RoomAssigned']],_0x21c0ed=[..._0x24f97e[_0xe99fb9(0x169)]['prod_invoice']],_0x3ff79e=[..._0x24f97e[_0xe99fb9(0x169)]['actual_qty']],_0x4da885=[..._0x24f97e['body']['actual_uom']];const _0x48f8ae=_0x5059df[_0xe99fb9(0x132)](_0xc0b801=>{return _0xc0b801={'product_name':_0xc0b801};});_0xb5671d[_0xe99fb9(0x16b)]((_0x1bc90e,_0x1847f6)=>{_0x48f8ae[_0x1847f6]['stock']=Math['abs'](_0x1bc90e);}),_0x3ff79e[_0xe99fb9(0x16b)]((_0x49dbc0,_0x26791a)=>{_0x48f8ae[_0x26791a]['actual_qty']=Math['abs'](_0x49dbc0);}),_0x4da885[_0xe99fb9(0x16b)]((_0x48624a,_0x2c97ba)=>{_0x48f8ae[_0x2c97ba]['actual_uom']=_0x48624a;}),_0x4236e5['forEach']((_0x46b43e,_0x56ae93)=>{var _0x5d1b06=_0xe99fb9;_0x48f8ae[_0x56ae93][_0x5d1b06(0x1a7)]=_0x46b43e;}),_0x4f2713['forEach']((_0xf512f2,_0x36f45b)=>{_0x48f8ae[_0x36f45b]['primary_code']=_0xf512f2;}),_0x560fc2[_0xe99fb9(0x16b)]((_0x482268,_0x44504b)=>{var _0x5125a0=_0xe99fb9;_0x48f8ae[_0x44504b][_0x5125a0(0x13e)]=_0x482268;}),_0x420dea[_0xe99fb9(0x16b)]((_0x26f412,_0x50c693)=>{var _0x1f9d28=_0xe99fb9;_0x48f8ae[_0x50c693][_0x1f9d28(0x167)]=_0x26f412;}),_0x302526[_0xe99fb9(0x16b)]((_0x3aff64,_0x205ae3)=>{var _0x110b7f=_0xe99fb9;_0x5e7cee[_0x110b7f(0x16b)]((_0x1309f1,_0x17db08)=>{var _0x190e39=_0x110b7f;if(_0x1309f1==_0x190e39(0x19d)&&_0x205ae3==_0x17db08){var _0x420270=_0x3aff64[_0x190e39(0x100)](0x3);_0x48f8ae[_0x205ae3][_0x190e39(0x10c)]=_0x3aff64[0x0],_0x48f8ae[_0x205ae3][_0x190e39(0x160)]=_0x3aff64[0x1],_0x48f8ae[_0x205ae3][_0x190e39(0x171)]=0x0,_0x48f8ae[_0x205ae3][_0x190e39(0x191)]=0x0,_0x48f8ae[_0x205ae3][_0x190e39(0x1c3)]=_0x190e39(0x16d),_0x48f8ae[_0x205ae3][_0x190e39(0x11a)]=_0x420270;}else{if(_0x1309f1==_0x190e39(0x115)&&_0x205ae3==_0x17db08){var _0x420270=_0x3aff64[_0x190e39(0x100)](0x3);_0x48f8ae[_0x205ae3][_0x190e39(0x10c)]=_0x3aff64[0x0],_0x48f8ae[_0x205ae3][_0x190e39(0x160)]=_0x3aff64[0x1],_0x48f8ae[_0x205ae3][_0x190e39(0x171)]=0x0,_0x48f8ae[_0x205ae3]['bin']=0x0,_0x48f8ae[_0x205ae3][_0x190e39(0x1c3)]=_0x190e39(0x16d),_0x48f8ae[_0x205ae3][_0x190e39(0x11a)]=_0x3aff64[0x5];}else{if(_0x205ae3==_0x17db08){var _0x2add71;if(_0x3aff64[0x4]=='L')_0x2add71=_0x190e39(0x118);else _0x3aff64[0x4]=='F'&&(_0x2add71='Floor');_0x48f8ae[_0x205ae3][_0x190e39(0x10c)]=_0x3aff64[0x0],_0x48f8ae[_0x205ae3]['rack']=_0x3aff64[0x1],_0x48f8ae[_0x205ae3][_0x190e39(0x171)]=_0x3aff64[0x2],_0x48f8ae[_0x205ae3][_0x190e39(0x191)]=_0x3aff64[0x3],_0x48f8ae[_0x205ae3]['type']=_0x2add71,_0x48f8ae[_0x205ae3][_0x190e39(0x11a)]=_0x3aff64[0x5];}}}});}),_0xf98f36[_0xe99fb9(0x16b)]((_0x538608,_0x3623cb)=>{var _0x14293b=_0xe99fb9;_0x48f8ae[_0x3623cb][_0x14293b(0x1e7)]=_0x538608;}),_0x247123[_0xe99fb9(0x16b)]((_0x1bb7c7,_0x18b9c4)=>{var _0x5a9025=_0xe99fb9;_0x48f8ae[_0x18b9c4][_0x5a9025(0x10e)]=_0x1bb7c7;}),_0x2c473a[_0xe99fb9(0x16b)]((_0x1cb5bd,_0x1b2ef4)=>{var _0x213140=_0xe99fb9;_0x48f8ae[_0x1b2ef4][_0x213140(0x1f2)]=_0x1cb5bd;}),_0x3850f3['forEach']((_0x3367c9,_0x1aa805)=>{var _0x4c4ab4=_0xe99fb9;_0x48f8ae[_0x1aa805][_0x4c4ab4(0x14e)]=_0x3367c9;}),_0x30029a[_0xe99fb9(0x16b)]((_0x8a8099,_0xc48e8a)=>{var _0x3bd9df=_0xe99fb9;_0x48f8ae[_0xc48e8a][_0x3bd9df(0x1ad)]=_0x8a8099;}),_0x372a56[_0xe99fb9(0x16b)]((_0x3beb20,_0x1e7523)=>{var _0x3ec631=_0xe99fb9;_0x48f8ae[_0x1e7523][_0x3ec631(0x1e6)]=_0x3beb20;}),_0x4433bb[_0xe99fb9(0x16b)]((_0x468dbc,_0x32d273)=>{var _0x4fc13d=_0xe99fb9;_0x48f8ae[_0x32d273][_0x4fc13d(0x13c)]=_0x468dbc;}),_0x33090c[_0xe99fb9(0x16b)]((_0x25adc7,_0x44d32c)=>{var _0x26f454=_0xe99fb9;_0x48f8ae[_0x44d32c][_0x26f454(0x143)]=_0x25adc7;}),_0x38180c[_0xe99fb9(0x16b)]((_0x12aaba,_0x2cd7a4)=>{var _0x4373f7=_0xe99fb9;_0x48f8ae[_0x2cd7a4][_0x4373f7(0x192)]=_0x12aaba;}),_0x4f50df[_0xe99fb9(0x16b)]((_0x56babf,_0x1761af)=>{var _0x9775e8=_0xe99fb9;_0x48f8ae[_0x1761af][_0x9775e8(0x12a)]=_0x56babf;}),_0x3d435b[_0xe99fb9(0x16b)]((_0x48ba8a,_0x385e9b)=>{var _0x5cba14=_0xe99fb9;_0x48f8ae[_0x385e9b][_0x5cba14(0x125)]=_0x48ba8a;}),_0x5e7cee[_0xe99fb9(0x16b)]((_0x3183d9,_0x391a52)=>{var _0x533ab0=_0xe99fb9;_0x48f8ae[_0x391a52][_0x533ab0(0x1e8)]=_0x3183d9;}),_0x21c0ed[_0xe99fb9(0x16b)]((_0x50b076,_0x503a69)=>{var _0x153b4c=_0xe99fb9;_0x48f8ae[_0x503a69][_0x153b4c(0x1fc)]=_0x50b076;});var _0x240344=0x0;_0x48f8ae[_0xe99fb9(0x16b)](_0xbd22c0=>{var _0x52d30d=_0xe99fb9;(_0xbd22c0[_0x52d30d(0x15c)]<_0xbd22c0[_0x52d30d(0x125)]||_0xbd22c0['quantity_notConverted']==0x0)&&(console[_0x52d30d(0x16c)](_0x52d30d(0x163),_0xbd22c0),_0x240344++);});const _0x51e4ea=_0x48f8ae['filter'](_0x3fb8b2=>_0x3fb8b2['quantity']!=='0'&&_0x3fb8b2['quantity']!==''),_0x436279=new sales({'invoice':_0x25d85e,'customer':_0x24f97e[_0xe99fb9(0x169)]['customer'],'date':_0x6746dc,'warehouse_name':_0x57bd2d,'sale_product':_0x51e4ea,'note':_0x105193,'room':_0x4f6564,'primary_code':_0x130364,'secondary_code':_0x346a5b,'prod_code':_0x3e879c,'SCRN':_0xd65605}),_0x38e531=await _0x436279[_0xe99fb9(0x17a)]();_0x24f97e['flash'](_0xe99fb9(0x17c),_0xe99fb9(0x108)),_0x4f1827['redirect'](_0xe99fb9(0x1a8)+_0x38e531[_0xe99fb9(0x179)]);}catch(_0x5c600b){console[_0xe99fb9(0x16c)](_0x5c600b);}}),router[a0_0x344a80(0x1b8)]('/preview/:id',auth,async(_0x48a186,_0xb312c8)=>{var _0x2d1cec=a0_0x344a80;try{const {username:_0x26afcc,email:_0x5e874b,role:_0x11b76b}=_0x48a186['user'],_0x532160=_0x48a186[_0x2d1cec(0x1b9)],_0x10f8b3=await profile['findOne']({'email':_0x532160[_0x2d1cec(0x202)]}),_0x5b91e3=await master_shop[_0x2d1cec(0x15f)](),_0x535e00=_0x48a186[_0x2d1cec(0x137)]['id'],_0x168369=await sales[_0x2d1cec(0x1bd)](_0x535e00),_0x4c2823=await warehouse[_0x2d1cec(0x113)]([{'$match':{'name':_0x168369['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2d1cec(0x1f3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2d1cec(0x19b)},'type':{'$first':_0x2d1cec(0x1bb)},'floorlevel':{'$first':_0x2d1cec(0x1d7)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2d1cec(0x1c9)},'product_code':{'$first':_0x2d1cec(0x1a6)},'storage':{'$first':_0x2d1cec(0x155)},'rack':{'$first':_0x2d1cec(0x12f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'}}}]),_0x40ffef=await customer[_0x2d1cec(0x15f)]({});let _0x3f23fb;if(_0x532160[_0x2d1cec(0x128)]=='staff'){const _0x52236b=await staff[_0x2d1cec(0x122)]({'email':_0x532160[_0x2d1cec(0x202)]});_0x3f23fb=await warehouse[_0x2d1cec(0x113)]([{'$match':{'status':_0x2d1cec(0x139),'name':_0x52236b[_0x2d1cec(0x18d)]}},{'$group':{'_id':'$name','name':{'$first':_0x2d1cec(0x144)}}}]);}else _0x3f23fb=await warehouse['aggregate']([{'$match':{'status':_0x2d1cec(0x139)}},{'$group':{'_id':'$name','name':{'$first':_0x2d1cec(0x144)}}}]);const _0x4590c3=await product[_0x2d1cec(0x15f)]({}),_0x13981b=await suppliers[_0x2d1cec(0x15f)]({});if(_0x5b91e3[0x0][_0x2d1cec(0x147)]=='English\x20(US)'){var _0xafd37c=users[_0x2d1cec(0x1c2)];console[_0x2d1cec(0x16c)](_0xafd37c);}else{if(_0x5b91e3[0x0][_0x2d1cec(0x147)]=='Hindi')var _0xafd37c=users[_0x2d1cec(0x1ee)];else{if(_0x5b91e3[0x0][_0x2d1cec(0x147)]==_0x2d1cec(0x199))var _0xafd37c=users[_0x2d1cec(0x199)];else{if(_0x5b91e3[0x0][_0x2d1cec(0x147)]==_0x2d1cec(0x15b))var _0xafd37c=users[_0x2d1cec(0x15b)];else{if(_0x5b91e3[0x0][_0x2d1cec(0x147)]=='French')var _0xafd37c=users[_0x2d1cec(0x1e3)];else{if(_0x5b91e3[0x0][_0x2d1cec(0x147)]=='Portuguese\x20(BR)')var _0xafd37c=users[_0x2d1cec(0x145)];else{if(_0x5b91e3[0x0][_0x2d1cec(0x147)]==_0x2d1cec(0x16f))var _0xafd37c=users['Chinese'];else{if(_0x5b91e3[0x0]['language']==_0x2d1cec(0x1b0))var _0xafd37c=users['Arabic'];}}}}}}}_0xb312c8[_0x2d1cec(0xff)](_0x2d1cec(0x205),{'success':_0x48a186[_0x2d1cec(0x1d4)](_0x2d1cec(0x17c)),'errors':_0x48a186[_0x2d1cec(0x1d4)]('errors'),'role':_0x532160,'profile':_0x10f8b3,'customer':_0x40ffef,'warehouse':_0x3f23fb,'product':_0x4c2823,'user':_0x168369,'master_shop':_0x5b91e3,'unit':_0x4590c3,'language':_0xafd37c,'suppliers':_0x13981b});}catch(_0x29fb8d){console[_0x2d1cec(0x16c)](_0x29fb8d);}}),router[a0_0x344a80(0x1d5)](a0_0x344a80(0x1af),auth,async(_0x4effbb,_0x54efc2)=>{var _0x334736=a0_0x344a80;try{const _0x20e2bc=_0x4effbb['params']['id'],{invoice:_0x3172d4,warehouse_name:_0x5a0bb3,room:_0x63981a}=_0x4effbb[_0x334736(0x169)],_0x565047=await sales[_0x334736(0x122)]({'invoice':_0x3172d4}),_0x34535e=_0x565047[_0x334736(0x168)][_0x334736(0x132)](async _0x52d9fb=>{var _0x50c6a4=_0x334736,_0x4e8dea=await warehouse[_0x50c6a4(0x122)]({'name':_0x5a0bb3,'room':_0x52d9fb[_0x50c6a4(0x1e8)],'warehouse_category':_0x50c6a4(0x121)});const _0x2b40ad=_0x4e8dea[_0x50c6a4(0x197)][_0x50c6a4(0x132)](_0x5b08d8=>{var _0x5bccec=_0x50c6a4;_0x5b08d8[_0x5bccec(0x119)]==_0x52d9fb[_0x5bccec(0x119)]&&_0x5b08d8[_0x5bccec(0x11a)]==_0x52d9fb['floorlevel']&&_0x5b08d8['type']==_0x52d9fb[_0x5bccec(0x1c3)]&&_0x5b08d8[_0x5bccec(0x191)]==_0x52d9fb[_0x5bccec(0x191)]&&_0x5b08d8['bay']==_0x52d9fb[_0x5bccec(0x171)]&&_0x5b08d8['rack']==_0x52d9fb[_0x5bccec(0x160)]&&_0x5b08d8[_0x5bccec(0x10c)]==_0x52d9fb['storage']&&_0x5b08d8[_0x5bccec(0x14e)]==_0x52d9fb[_0x5bccec(0x14e)]&&_0x5b08d8[_0x5bccec(0x1f2)]==_0x52d9fb[_0x5bccec(0x1f2)]&&_0x5b08d8[_0x5bccec(0x1fc)]==_0x52d9fb[_0x5bccec(0x1fc)]&&(_0x5b08d8[_0x5bccec(0x12c)]=Math[_0x5bccec(0x120)](_0x5b08d8[_0x5bccec(0x12c)])-Math[_0x5bccec(0x120)](_0x52d9fb[_0x5bccec(0x1a7)]));});return _0x4e8dea;});Promise[_0x334736(0x142)](_0x34535e)['then'](async _0x377ab2=>{var _0x2d48ad=_0x334736;try{for(const _0x479ba7 of _0x377ab2){await _0x479ba7['save']();}_0x565047[_0x2d48ad(0x14b)]=_0x2d48ad(0x1eb);const _0x5b50fc=await _0x565047[_0x2d48ad(0x17a)](),_0x355a77=await master_shop[_0x2d48ad(0x15f)](),_0x7ae7a4=await email_settings[_0x2d48ad(0x122)](),_0x4b3ce5=await supervisor_settings['find']();var _0x35fc33=_0x565047['sale_product'],_0xad9ed2='',_0x5372c6;for(_0x5372c6 in _0x35fc33){_0xad9ed2+=_0x2d48ad(0x1fa)+_0x2d48ad(0x206)+_0x35fc33[_0x5372c6][_0x2d48ad(0x119)]+_0x2d48ad(0x181)+_0x2d48ad(0x206)+_0x35fc33[_0x5372c6][_0x2d48ad(0x167)]+_0x2d48ad(0x181)+_0x2d48ad(0x206)+_0x35fc33[_0x5372c6]['quantity']+_0x2d48ad(0x181)+_0x2d48ad(0x206)+_0x35fc33[_0x5372c6][_0x2d48ad(0x1e7)]+_0x2d48ad(0x181)+_0x2d48ad(0x206)+_0x35fc33[_0x5372c6][_0x2d48ad(0x10e)]+_0x2d48ad(0x181)+_0x2d48ad(0x206)+_0x565047['warehouse_name']+_0x2d48ad(0x181)+_0x2d48ad(0x206)+_0x35fc33[_0x5372c6][_0x2d48ad(0x1e8)]+'</td>'+_0x2d48ad(0x206)+_0x35fc33[_0x5372c6]['storage']+_0x35fc33[_0x5372c6]['rack']+_0x35fc33[_0x5372c6][_0x2d48ad(0x171)]+_0x35fc33[_0x5372c6][_0x2d48ad(0x191)]+_0x35fc33[_0x5372c6][_0x2d48ad(0x1c3)][0x0]+_0x35fc33[_0x5372c6]['floorlevel']+'</td>','</tr>';}let _0x5cb00c=nodemailer[_0x2d48ad(0x157)]({'host':_0x7ae7a4[_0x2d48ad(0x214)],'port':Number(_0x7ae7a4[_0x2d48ad(0x1ed)]),'secure':![],'auth':{'user':_0x7ae7a4[_0x2d48ad(0x202)],'pass':_0x7ae7a4[_0x2d48ad(0x1ae)]}}),_0x18561e={'from':_0x7ae7a4[_0x2d48ad(0x202)],'to':_0x4b3ce5[0x0][_0x2d48ad(0x183)],'subject':_0x2d48ad(0x1cc),'attachments':[{'filename':_0x2d48ad(0x1b6),'path':__dirname+_0x2d48ad(0x141)+'/upload/'+_0x355a77[0x0][_0x2d48ad(0x1f6)],'cid':_0x2d48ad(0x1ef)}],'html':_0x2d48ad(0x1e9)+_0x2d48ad(0x17e)+_0x2d48ad(0x1ff)+_0x2d48ad(0x173)+_0x2d48ad(0x1ea)+_0x2d48ad(0x173)+_0x2d48ad(0x136)+_0x2d48ad(0x1e5)+_0x2d48ad(0x173)+_0x2d48ad(0x186)+_0x355a77[0x0][_0x2d48ad(0x188)]+_0x2d48ad(0x149)+'</div>'+'</div>'+_0x2d48ad(0x11f)+_0x2d48ad(0x173)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x565047[_0x2d48ad(0x1fc)]+'\x20'+_0x2d48ad(0x213)+'\x20Order\x20Date\x20:\x20'+_0x565047[_0x2d48ad(0x172)]+'\x20'+_0x2d48ad(0x19c)+_0x2d48ad(0x10d)+_0x2d48ad(0x1e5)+_0x2d48ad(0x1d6)+_0x2d48ad(0x1d1)+_0x2d48ad(0x1fa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2d48ad(0x156)+_0x2d48ad(0x151)+_0x2d48ad(0x1a0)+_0x2d48ad(0x105)+_0x2d48ad(0x20e)+_0x2d48ad(0x184)+_0x2d48ad(0x211)+'</tr>'+'</thead>'+_0x2d48ad(0x1e2)+'\x20'+_0xad9ed2+'\x20'+'</tbody>'+'</table>'+_0x2d48ad(0x173)+_0x2d48ad(0x150)+_0x2d48ad(0x200)+_0x355a77[0x0][_0x2d48ad(0x188)]+_0x2d48ad(0x10d)+_0x2d48ad(0x1e5)+'</div>'+_0x2d48ad(0x190)};_0x5cb00c[_0x2d48ad(0x109)](_0x18561e,function(_0x180ed7,_0x3c0ce9){var _0x1b0db4=_0x2d48ad;_0x180ed7?(console[_0x1b0db4(0x16c)](_0x180ed7),console[_0x1b0db4(0x16c)](_0x1b0db4(0x16a))):console[_0x1b0db4(0x16c)](_0x1b0db4(0x14c));}),_0x4effbb[_0x2d48ad(0x1d4)](_0x2d48ad(0x17c),'Sales\x20Update\x20successfully'),_0x54efc2[_0x2d48ad(0x14d)](_0x2d48ad(0x1a8)+_0x20e2bc);}catch(_0x4dc29f){console[_0x2d48ad(0x133)](_0x4dc29f),_0x54efc2[_0x2d48ad(0x177)](0x1f4)['json']({'error':_0x2d48ad(0x17b)});}})[_0x334736(0x1a4)](_0x495815=>{var _0x5c539a=_0x334736;console[_0x5c539a(0x133)](_0x495815),_0x54efc2[_0x5c539a(0x177)](0x1f4)[_0x5c539a(0x13d)]({'error':_0x5c539a(0x15d)});});}catch(_0x186ba4){console[_0x334736(0x16c)](_0x186ba4);}}),router[a0_0x344a80(0x1b8)](a0_0x344a80(0x135),auth,async(_0x1289ab,_0x1f4524)=>{var _0x3311f3=a0_0x344a80;try{const {username:_0xce7ad5,email:_0x4ce0cb,role:_0x1dc526}=_0x1289ab[_0x3311f3(0x1b9)],_0x479ff9=_0x1289ab[_0x3311f3(0x1b9)],_0x1aa7d4=await profile[_0x3311f3(0x122)]({'email':_0x479ff9['email']}),_0xfd372c=await master_shop[_0x3311f3(0x15f)](),_0x12ca57=_0x1289ab[_0x3311f3(0x137)]['id'],_0x188169=await sales[_0x3311f3(0x1bd)](_0x12ca57);var _0x17489f=[_0x3311f3(0x11d),'Enclosed'];const _0x2e27b5=await warehouse[_0x3311f3(0x113)]([{'$match':{'name':_0x188169['warehouse_name'],'warehouse_category':_0x3311f3(0x121)}},{'$unwind':_0x3311f3(0x1a1)},{'$group':{'_id':_0x3311f3(0x174),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3311f3(0x195)},'bin':{'$first':_0x3311f3(0x19b)},'type':{'$first':_0x3311f3(0x1bb)},'floorlevel':{'$first':_0x3311f3(0x1d7)},'primary_code':{'$first':_0x3311f3(0x14a)},'secondary_code':{'$first':_0x3311f3(0x1c9)},'product_code':{'$first':_0x3311f3(0x1a6)},'storage':{'$first':_0x3311f3(0x155)},'rack':{'$first':_0x3311f3(0x12f)}}}]),_0x1c937b=await customer[_0x3311f3(0x15f)]({});let _0x2824d4;if(_0x479ff9[_0x3311f3(0x128)]==_0x3311f3(0x153)){const _0x263d8a=await staff[_0x3311f3(0x122)]({'email':_0x479ff9[_0x3311f3(0x202)]});_0x2824d4=await warehouse[_0x3311f3(0x113)]([{'$match':{'status':_0x3311f3(0x139),'name':_0x263d8a['warehouse'],'warehouse_category':_0x3311f3(0x121)}},{'$group':{'_id':_0x3311f3(0x144),'name':{'$first':'$name'}}}]);}else _0x2824d4=await warehouse[_0x3311f3(0x113)]([{'$match':{'status':_0x3311f3(0x139),'warehouse_category':_0x3311f3(0x121)}},{'$group':{'_id':_0x3311f3(0x144),'name':{'$first':'$name'}}}]);const _0x2ec6ef=await product[_0x3311f3(0x15f)]({});if(_0xfd372c[0x0]['language']==_0x3311f3(0x1d2)){var _0xe7206f=users[_0x3311f3(0x1c2)];console[_0x3311f3(0x16c)](_0xe7206f);}else{if(_0xfd372c[0x0]['language']==_0x3311f3(0x1ee))var _0xe7206f=users[_0x3311f3(0x1ee)];else{if(_0xfd372c[0x0][_0x3311f3(0x147)]==_0x3311f3(0x199))var _0xe7206f=users[_0x3311f3(0x199)];else{if(_0xfd372c[0x0]['language']==_0x3311f3(0x15b))var _0xe7206f=users[_0x3311f3(0x15b)];else{if(_0xfd372c[0x0][_0x3311f3(0x147)]==_0x3311f3(0x1e3))var _0xe7206f=users[_0x3311f3(0x1e3)];else{if(_0xfd372c[0x0]['language']==_0x3311f3(0x101))var _0xe7206f=users[_0x3311f3(0x145)];else{if(_0xfd372c[0x0][_0x3311f3(0x147)]=='Chinese')var _0xe7206f=users[_0x3311f3(0x16f)];else{if(_0xfd372c[0x0][_0x3311f3(0x147)]==_0x3311f3(0x1b0))var _0xe7206f=users[_0x3311f3(0x146)];}}}}}}}_0x1f4524[_0x3311f3(0xff)](_0x3311f3(0x1da),{'success':_0x1289ab[_0x3311f3(0x1d4)](_0x3311f3(0x17c)),'errors':_0x1289ab['flash'](_0x3311f3(0x12b)),'role':_0x479ff9,'profile':_0x1aa7d4,'customer':_0x1c937b,'warehouse':_0x2824d4,'product':_0x2e27b5,'user':_0x188169,'master_shop':_0xfd372c,'unit':_0x2ec6ef,'language':_0xe7206f});}catch(_0x14b619){console[_0x3311f3(0x16c)](_0x14b619);}}),router['post'](a0_0x344a80(0x135),auth,async(_0x2ddfa6,_0x27ccce)=>{var _0x1667ff=a0_0x344a80;try{const _0x2c2eda=_0x2ddfa6[_0x1667ff(0x137)]['id'],_0x42a8f1=await sales['findOne']({'_id':_0x2ddfa6[_0x1667ff(0x137)]['id']}),_0x224134=await warehouse['findOne']({'name':_0x42a8f1[_0x1667ff(0x130)],'room':_0x2ddfa6[_0x1667ff(0x169)]['room']}),{invoice:_0x2c7cff,date:_0x40a283,warehouse_name:_0x3d71f8,product_name:_0x3705d6,stock:_0x38b27b,quantity:_0x3bdd34,note:_0x5443db,room:_0x398f2e,customer:_0x530b26,SCRN:_0x4b6ad5}=_0x2ddfa6[_0x1667ff(0x169)];if(typeof _0x3705d6=='string')var _0x1b7221=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x119)]],_0x54ca6c=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x15c)]],_0x509c73=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x1e1)]],_0x2ee957=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x1f9)]],_0x2a16bd=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x13e)]],_0x2cd7ce=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x11b)]],_0x948f7=[_0x2ddfa6[_0x1667ff(0x169)]['level']],_0x3b47ea=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x208)]],_0x43bc6c=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x10e)]],_0xd4b2ca=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x1f2)]],_0x2b185e=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x14e)]],_0x9c36e9=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x1a5)]],_0x7c4f65=[_0x2ddfa6[_0x1667ff(0x169)]['production_date']],_0x1dc311=[_0x2ddfa6['body'][_0x1667ff(0x13c)]],_0x504f09=[_0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x143)]],_0x56abec=[_0x2ddfa6[_0x1667ff(0x169)]['delivery_code']],_0x3456fb=[_0x2ddfa6['body'][_0x1667ff(0x12a)]],_0x523455=[_0x2ddfa6['body'][_0x1667ff(0x1a7)]],_0x92c28f=[_0x2ddfa6['body'][_0x1667ff(0x13a)]];else var _0x1b7221=[..._0x2ddfa6[_0x1667ff(0x169)]['product_name']],_0x54ca6c=[..._0x2ddfa6['body'][_0x1667ff(0x15c)]],_0x509c73=[..._0x2ddfa6['body'][_0x1667ff(0x1e1)]],_0x2ee957=[..._0x2ddfa6[_0x1667ff(0x169)]['primary_code']],_0x2a16bd=[..._0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x13e)]],_0x2cd7ce=[..._0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x11b)]],_0x948f7=[..._0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x1a3)]],_0x3b47ea=[..._0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x208)]],_0x43bc6c=[..._0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x10e)]],_0xd4b2ca=[..._0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x1f2)]],_0x2b185e=[..._0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x14e)]],_0x9c36e9=[..._0x2ddfa6[_0x1667ff(0x169)]['max_per_unit']],_0x7c4f65=[..._0x2ddfa6['body'][_0x1667ff(0x1e6)]],_0x1dc311=[..._0x2ddfa6[_0x1667ff(0x169)]['requested_qty']],_0x504f09=[..._0x2ddfa6['body'][_0x1667ff(0x143)]],_0x56abec=[..._0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x192)]],_0x3456fb=[..._0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x12a)]],_0x523455=[..._0x2ddfa6['body'][_0x1667ff(0x1a7)]],_0x92c28f=[..._0x2ddfa6[_0x1667ff(0x169)][_0x1667ff(0x13a)]];const _0x51ae30=_0x1b7221['map'](_0x1b46aa=>{return _0x1b46aa={'product_name':_0x1b46aa};});_0x54ca6c[_0x1667ff(0x16b)]((_0x3c488c,_0x33217b)=>{var _0x4194ed=_0x1667ff;_0x51ae30[_0x33217b][_0x4194ed(0x15c)]=Math[_0x4194ed(0x120)](_0x3c488c);}),_0x509c73[_0x1667ff(0x16b)]((_0xf07032,_0x5db4b2)=>{var _0x3c1d10=_0x1667ff;_0x51ae30[_0x5db4b2][_0x3c1d10(0x1a7)]=_0xf07032;}),_0x2ee957[_0x1667ff(0x16b)]((_0x1fba51,_0x3eb5a6)=>{var _0x13cbc2=_0x1667ff;_0x51ae30[_0x3eb5a6][_0x13cbc2(0x1f9)]=_0x1fba51;}),_0x2a16bd[_0x1667ff(0x16b)]((_0x447ca0,_0x39c8d5)=>{var _0x2b793c=_0x1667ff;_0x51ae30[_0x39c8d5][_0x2b793c(0x13e)]=_0x447ca0;}),_0x2cd7ce[_0x1667ff(0x16b)]((_0x4078dd,_0x536b7e)=>{var _0x38fe28=_0x1667ff;_0x51ae30[_0x536b7e][_0x38fe28(0x167)]=_0x4078dd;}),_0x948f7['forEach']((_0x1353f2,_0x130651)=>{_0x92c28f['forEach']((_0x54a695,_0x2af063)=>{var _0x5068fc=a0_0x56bd;if(_0x54a695==_0x5068fc(0x19d)&&_0x130651==_0x2af063){var _0xc41536=_0x1353f2[_0x5068fc(0x100)](0x3);_0x51ae30[_0x130651][_0x5068fc(0x10c)]=_0x1353f2[0x0],_0x51ae30[_0x130651][_0x5068fc(0x160)]=_0x1353f2[0x1],_0x51ae30[_0x130651]['bay']=0x0,_0x51ae30[_0x130651][_0x5068fc(0x191)]=0x0,_0x51ae30[_0x130651][_0x5068fc(0x1c3)]=_0x5068fc(0x16d),_0x51ae30[_0x130651][_0x5068fc(0x11a)]=_0xc41536;}else{if(_0x54a695==_0x5068fc(0x115)&&_0x130651==_0x2af063){var _0xc41536=_0x1353f2[_0x5068fc(0x100)](0x3);_0x51ae30[_0x130651]['storage']=_0x1353f2[0x0],_0x51ae30[_0x130651][_0x5068fc(0x160)]=_0x1353f2[0x1],_0x51ae30[_0x130651][_0x5068fc(0x171)]=0x0,_0x51ae30[_0x130651][_0x5068fc(0x191)]=0x0,_0x51ae30[_0x130651]['type']=_0x5068fc(0x16d),_0x51ae30[_0x130651][_0x5068fc(0x11a)]=_0x1353f2[0x5];}else{if(_0x130651==_0x2af063){var _0x21809f;if(_0x1353f2[0x4]=='L')_0x21809f='Level';else _0x1353f2[0x4]=='F'&&(_0x21809f=_0x5068fc(0x16d));_0x51ae30[_0x130651][_0x5068fc(0x10c)]=_0x1353f2[0x0],_0x51ae30[_0x130651][_0x5068fc(0x160)]=_0x1353f2[0x1],_0x51ae30[_0x130651][_0x5068fc(0x171)]=_0x1353f2[0x2],_0x51ae30[_0x130651][_0x5068fc(0x191)]=_0x1353f2[0x3],_0x51ae30[_0x130651][_0x5068fc(0x1c3)]=_0x21809f,_0x51ae30[_0x130651][_0x5068fc(0x11a)]=_0x1353f2[0x5];}}}});}),_0x3b47ea[_0x1667ff(0x16b)]((_0x2d084b,_0x26179e)=>{var _0x138a14=_0x1667ff;_0x51ae30[_0x26179e][_0x138a14(0x1e7)]=_0x2d084b;}),_0x43bc6c[_0x1667ff(0x16b)]((_0x60dcac,_0x1b4e1a)=>{var _0x3c05ac=_0x1667ff;_0x51ae30[_0x1b4e1a][_0x3c05ac(0x10e)]=_0x60dcac;}),_0xd4b2ca[_0x1667ff(0x16b)]((_0xbc84cd,_0x5ce901)=>{var _0x3add0f=_0x1667ff;_0x51ae30[_0x5ce901][_0x3add0f(0x1f2)]=_0xbc84cd;}),_0x2b185e[_0x1667ff(0x16b)]((_0x3d6997,_0x92a9dd)=>{var _0x3e70e6=_0x1667ff;_0x51ae30[_0x92a9dd][_0x3e70e6(0x14e)]=_0x3d6997;}),_0x9c36e9['forEach']((_0x10bdc2,_0x1ed354)=>{_0x51ae30[_0x1ed354]['maxperunit']=_0x10bdc2;}),_0x7c4f65[_0x1667ff(0x16b)]((_0x44a086,_0x2e86bb)=>{var _0x4e2fd0=_0x1667ff;_0x51ae30[_0x2e86bb][_0x4e2fd0(0x1e6)]=_0x44a086;}),_0x1dc311['forEach']((_0x3d017d,_0x3773e4)=>{var _0x207151=_0x1667ff;_0x51ae30[_0x3773e4][_0x207151(0x13c)]=Math[_0x207151(0x120)](_0x3d017d);}),_0x504f09['forEach']((_0x34eb5c,_0x5a88b6)=>{var _0x1a57e8=_0x1667ff;_0x51ae30[_0x5a88b6][_0x1a57e8(0x143)]=_0x34eb5c;}),_0x56abec[_0x1667ff(0x16b)]((_0x4c5466,_0x40c8e6)=>{var _0x335dfd=_0x1667ff;_0x51ae30[_0x40c8e6][_0x335dfd(0x192)]=_0x4c5466;}),_0x3456fb[_0x1667ff(0x16b)]((_0x430ced,_0x5b159e)=>{var _0x5d5f05=_0x1667ff;_0x51ae30[_0x5b159e][_0x5d5f05(0x12a)]=_0x430ced;}),_0x523455['forEach']((_0x30fb14,_0x4e790f)=>{var _0x39e23f=_0x1667ff;_0x51ae30[_0x4e790f][_0x39e23f(0x125)]=_0x30fb14;}),_0x92c28f[_0x1667ff(0x16b)]((_0x498c4a,_0x971d6c)=>{_0x51ae30[_0x971d6c]['room_name']=_0x498c4a;});var _0x5af49a=0x0;_0x51ae30[_0x1667ff(0x16b)](_0xed8550=>{var _0x15ff7e=_0x1667ff;console['log'](_0x15ff7e(0x163),_0xed8550),(parseInt(_0xed8550[_0x15ff7e(0x15c)])<parseInt(_0xed8550[_0x15ff7e(0x1a7)])||parseInt(_0xed8550[_0x15ff7e(0x1a7)])==0x0)&&_0x5af49a++;});if(_0x5af49a!=0x0)return _0x2ddfa6[_0x1667ff(0x1d4)](_0x1667ff(0x12b),_0x1667ff(0x1c1)),_0x27ccce[_0x1667ff(0x14d)]('back');const _0xf0ea26=_0x51ae30[_0x1667ff(0x1ca)](_0x5a23f6=>_0x5a23f6[_0x1667ff(0x1a7)]!=='0'&&_0x5a23f6[_0x1667ff(0x1a7)]!=='');_0x42a8f1[_0x1667ff(0x1fc)]=_0x2c7cff,_0x42a8f1[_0x1667ff(0x1b7)]=_0x530b26,_0x42a8f1[_0x1667ff(0x172)]=_0x40a283,_0x42a8f1[_0x1667ff(0x130)]=_0x3d71f8,_0x42a8f1[_0x1667ff(0x168)]=_0xf0ea26,_0x42a8f1[_0x1667ff(0x1f8)]=_0x5443db,_0x42a8f1[_0x1667ff(0x164)]=_0x4b6ad5,_0x42a8f1[_0x1667ff(0x14b)]=_0x1667ff(0x1fe),_0x42a8f1['isAllowEdit']=_0x1667ff(0x1fe);const _0x24a7ce=await _0x42a8f1['save']();_0x2ddfa6[_0x1667ff(0x1d4)]('success',_0x1667ff(0x1ec)),_0x27ccce[_0x1667ff(0x14d)](_0x1667ff(0x203));}catch(_0x5aa7bc){console['log'](_0x5aa7bc);}}),router[a0_0x344a80(0x1d5)](a0_0x344a80(0x165),auth,async(_0x9a9025,_0x38a4af)=>{var _0x5457c4=a0_0x344a80;try{const _0x111cce=_0x9a9025[_0x5457c4(0x137)]['id'],{invoice:_0x45e1cf,customer:_0xebfc9d,receivable_amount:_0x5ecee1,received_amount:_0x436406}=_0x9a9025[_0x5457c4(0x169)],_0xe2dd52=await sales[_0x5457c4(0x1bd)](_0x111cce);console[_0x5457c4(0x16c)](_0xe2dd52);var _0x18f82b=_0x5ecee1-_0x436406;console['log'](_0x436406),_0xe2dd52[_0x5457c4(0x1f4)]=parseFloat(_0x436406)+parseFloat(_0xe2dd52['received_amount']),_0xe2dd52[_0x5457c4(0x1db)]=_0x18f82b,console[_0x5457c4(0x16c)](_0xe2dd52);const _0x40486b=await _0xe2dd52[_0x5457c4(0x17a)](),_0x5d9176=await c_payment_data['findOne']({'invoice':_0x45e1cf});_0x5d9176[_0x5457c4(0x194)]=_0x18f82b,await _0x5d9176[_0x5457c4(0x17a)]();let _0x3f4d90=new Date(),_0x3f8bf6=('0'+_0x3f4d90[_0x5457c4(0x158)]())[_0x5457c4(0x100)](-0x2),_0x15f094=('0'+(_0x3f4d90['getMonth']()+0x1))[_0x5457c4(0x100)](-0x2),_0x5bc093=_0x3f4d90[_0x5457c4(0x185)](),_0x2bcf16=_0x5bc093+'-'+_0x15f094+'-'+_0x3f8bf6;const _0x496f79=new customer_payment({'invoice':_0x45e1cf,'date':_0x5bc093+'-'+_0x15f094+'-'+_0x3f8bf6,'customer':_0xebfc9d,'reason':_0x5457c4(0x20d),'amount':_0x436406}),_0x4bc5e4=await _0x496f79[_0x5457c4(0x17a)]();_0x9a9025[_0x5457c4(0x1d4)](_0x5457c4(0x17c),_0x5457c4(0x12d)),_0x38a4af['redirect']('/all_sales/view');}catch(_0x3b50ce){console[_0x5457c4(0x16c)](_0x3b50ce);}}),router[a0_0x344a80(0x1b8)](a0_0x344a80(0x1dc),auth,async(_0x20d90e,_0x1622fa)=>{var _0x5a613f=a0_0x344a80;try{const {username:_0x253179,email:_0x2cecce,role:_0x31d8a4}=_0x20d90e[_0x5a613f(0x1b9)],_0x684c6c=_0x20d90e[_0x5a613f(0x1b9)],_0x4abac2=await profile[_0x5a613f(0x122)]({'email':_0x684c6c[_0x5a613f(0x202)]}),_0x44276a=await master_shop[_0x5a613f(0x15f)]();console[_0x5a613f(0x16c)](_0x5a613f(0x112),_0x44276a);const _0x1c07f9=_0x20d90e[_0x5a613f(0x137)]['id'],_0x2cc1dc=await sales[_0x5a613f(0x1bd)](_0x1c07f9);console['log'](_0x2cc1dc);const _0x12ccbe=await customer[_0x5a613f(0x122)]({'name':_0x2cc1dc[_0x5a613f(0x1b7)]});console[_0x5a613f(0x16c)](_0x12ccbe);if(_0x44276a[0x0]['language']=='English\x20(US)'){var _0x367582=users[_0x5a613f(0x1c2)];console[_0x5a613f(0x16c)](_0x367582);}else{if(_0x44276a[0x0][_0x5a613f(0x147)]==_0x5a613f(0x1ee))var _0x367582=users[_0x5a613f(0x1ee)];else{if(_0x44276a[0x0][_0x5a613f(0x147)]=='German')var _0x367582=users[_0x5a613f(0x199)];else{if(_0x44276a[0x0][_0x5a613f(0x147)]==_0x5a613f(0x15b))var _0x367582=users[_0x5a613f(0x15b)];else{if(_0x44276a[0x0][_0x5a613f(0x147)]==_0x5a613f(0x1e3))var _0x367582=users[_0x5a613f(0x1e3)];else{if(_0x44276a[0x0]['language']==_0x5a613f(0x101))var _0x367582=users[_0x5a613f(0x145)];else{if(_0x44276a[0x0][_0x5a613f(0x147)]==_0x5a613f(0x16f))var _0x367582=users[_0x5a613f(0x16f)];else{if(_0x44276a[0x0]['language']=='Arabic\x20(ae)')var _0x367582=users[_0x5a613f(0x146)];}}}}}}}_0x1622fa['render'](_0x5a613f(0x1df),{'success':_0x20d90e[_0x5a613f(0x1d4)]('success'),'errors':_0x20d90e[_0x5a613f(0x1d4)]('errors'),'role':_0x684c6c,'profile':_0x4abac2,'master_shop':_0x44276a,'customers':_0x12ccbe,'sales':_0x2cc1dc,'language':_0x367582});}catch(_0x49f94b){console[_0x5a613f(0x16c)](_0x49f94b);}}),router[a0_0x344a80(0x1b8)](a0_0x344a80(0x11e),auth,async(_0x3aa370,_0x3fe6bb)=>{var _0x2cf70e=a0_0x344a80;try{const {username:_0x2bea14,email:_0x2330cc,role:_0x40101d}=_0x3aa370[_0x2cf70e(0x1b9)],_0x176de4=_0x3aa370[_0x2cf70e(0x1b9)],_0x2f687d=await profile[_0x2cf70e(0x122)]({'email':_0x176de4['email']}),_0x59f40f=await master_shop[_0x2cf70e(0x15f)]();console[_0x2cf70e(0x16c)](_0x2cf70e(0x112),_0x59f40f);const _0x553112=_0x3aa370[_0x2cf70e(0x137)]['id'];console['log'](_0x553112);const _0x4b98cb=await sales[_0x2cf70e(0x1bd)](_0x553112);console[_0x2cf70e(0x16c)](_0x2cf70e(0x1d0),_0x4b98cb);const _0x5892cd=await warehouse[_0x2cf70e(0x113)]([{'$match':{'name':_0x2cf70e(0x1ba),'room':'Return\x20Rooms'}},{'$unwind':_0x2cf70e(0x1a1)},{'$group':{'_id':_0x2cf70e(0x174),'name':{'$first':_0x2cf70e(0x1f3)},'product_stock':{'$first':_0x2cf70e(0x20c)},'level':{'$first':_0x2cf70e(0x104)},'isle':{'$first':_0x2cf70e(0x1e4)},'pallet':{'$first':_0x2cf70e(0x114)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2cf70e(0x1c9)},'product_code':{'$first':_0x2cf70e(0x1a6)}}}]);console[_0x2cf70e(0x16c)](_0x2cf70e(0x1ac),_0x5892cd);const _0x37310e=await product['find']({});warehouse_data=await warehouse[_0x2cf70e(0x113)]([{'$match':{'status':_0x2cf70e(0x139),'name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2cf70e(0x144),'name':{'$first':_0x2cf70e(0x144)}}},{'$sort':{'name':0x1}}]);var _0x2c9993=[_0x2cf70e(0x18e)];if(_0x59f40f[0x0][_0x2cf70e(0x147)]==_0x2cf70e(0x1d2)){var _0x46fa63=users['English'];console[_0x2cf70e(0x16c)](_0x46fa63);}else{if(_0x59f40f[0x0][_0x2cf70e(0x147)]==_0x2cf70e(0x1ee))var _0x46fa63=users[_0x2cf70e(0x1ee)];else{if(_0x59f40f[0x0][_0x2cf70e(0x147)]==_0x2cf70e(0x199))var _0x46fa63=users[_0x2cf70e(0x199)];else{if(_0x59f40f[0x0][_0x2cf70e(0x147)]==_0x2cf70e(0x15b))var _0x46fa63=users[_0x2cf70e(0x15b)];else{if(_0x59f40f[0x0][_0x2cf70e(0x147)]==_0x2cf70e(0x1e3))var _0x46fa63=users[_0x2cf70e(0x1e3)];else{if(_0x59f40f[0x0][_0x2cf70e(0x147)]=='Portuguese\x20(BR)')var _0x46fa63=users[_0x2cf70e(0x145)];else{if(_0x59f40f[0x0][_0x2cf70e(0x147)]==_0x2cf70e(0x16f))var _0x46fa63=users[_0x2cf70e(0x16f)];else{if(_0x59f40f[0x0]['language']==_0x2cf70e(0x1b0))var _0x46fa63=users[_0x2cf70e(0x146)];}}}}}}}_0x3fe6bb[_0x2cf70e(0xff)]('return_sale',{'success':_0x3aa370[_0x2cf70e(0x1d4)](_0x2cf70e(0x17c)),'errors':_0x3aa370[_0x2cf70e(0x1d4)](_0x2cf70e(0x12b)),'role':_0x176de4,'profile':_0x2f687d,'user':_0x4b98cb,'stock':_0x5892cd,'master_shop':_0x59f40f,'unit':_0x37310e,'language':_0x46fa63,'warehouses':warehouse_data,'rooms':_0x2c9993});}catch(_0x314b86){console[_0x2cf70e(0x16c)](_0x314b86),_0x3fe6bb[_0x2cf70e(0x177)](0xc8)['json']({'message':_0x314b86['message']});}}),router[a0_0x344a80(0x1d5)](a0_0x344a80(0x11e),auth,async(_0x1cf5d1,_0x459c40)=>{var _0xe4fba0=a0_0x344a80;try{const {invoice:_0x382184,date:_0x42e49f,warehouse_name:_0x543299,product_name:_0x4ebbfc,primary_code:_0x52e31f,secondary_code:_0x2a0a63,product_code:_0x58fada,sales_quantity:_0xfb88c5,stocks:_0x4e7b06,return_qty:_0x12d347,Room_name:_0x2baef5,to_warehouse_name:_0x3a9ea0,to_Roomname:_0x4b4649,to_Room_name:_0x35e639,note:_0x121567,level:_0xe5258f,isle:_0x28ad2d,pallet:_0x302f92}=_0x1cf5d1[_0xe4fba0(0x169)];if(typeof _0x4ebbfc==_0xe4fba0(0x178))var _0x395b3a=[_0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x119)]],_0x608fd4=[_0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x1f9)]],_0x1422b9=[_0x1cf5d1['body'][_0xe4fba0(0x13e)]],_0x179608=[_0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x167)]],_0x3148eb=[_0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x198)]],_0x50a214=[_0x1cf5d1['body'][_0xe4fba0(0x1b1)]],_0x1cf11b=[_0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x13f)]],_0xc271f5=[_0x1cf5d1['body'][_0xe4fba0(0x171)]],_0x261483=[_0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x191)]],_0x252a45=[_0x1cf5d1['body'][_0xe4fba0(0x1c0)]],_0x5429da=[_0x1cf5d1['body'][_0xe4fba0(0x11a)]];else var _0x395b3a=[..._0x1cf5d1['body']['product_name']],_0x608fd4=[..._0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x1f9)]],_0x1422b9=[..._0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x13e)]],_0x179608=[..._0x1cf5d1['body'][_0xe4fba0(0x167)]],_0x3148eb=[..._0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x198)]],_0x50a214=[..._0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x1b1)]],_0x1cf11b=[..._0x1cf5d1['body'][_0xe4fba0(0x13f)]],_0xc271f5=[..._0x1cf5d1[_0xe4fba0(0x169)]['bay']],_0x261483=[..._0x1cf5d1['body'][_0xe4fba0(0x191)]],_0x252a45=[..._0x1cf5d1['body'][_0xe4fba0(0x1c0)]],_0x5429da=[..._0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x11a)]];const _0x513fd0=_0x395b3a[_0xe4fba0(0x132)](_0xa57170=>{return _0xa57170={'product_name':_0xa57170};});_0x608fd4[_0xe4fba0(0x16b)]((_0x10c0c4,_0x2b0075)=>{var _0x3eda6f=_0xe4fba0;_0x513fd0[_0x2b0075][_0x3eda6f(0x1f9)]=_0x10c0c4;}),_0x1422b9['forEach']((_0x58d2d3,_0x1dfee4)=>{_0x513fd0[_0x1dfee4]['secondary_code']=_0x58d2d3;}),_0x179608['forEach']((_0x14ce4f,_0x146123)=>{var _0x614970=_0xe4fba0;_0x513fd0[_0x146123][_0x614970(0x167)]=_0x14ce4f;}),_0x3148eb[_0xe4fba0(0x16b)]((_0x47335e,_0x4068f7)=>{_0x513fd0[_0x4068f7]['sale_qty']=_0x47335e;}),_0x50a214[_0xe4fba0(0x16b)]((_0x4f81fd,_0x1b41ac)=>{var _0x5abc15=_0xe4fba0;_0x513fd0[_0x1b41ac][_0x5abc15(0x15c)]=_0x4f81fd;}),_0x1cf11b[_0xe4fba0(0x16b)]((_0x2134dc,_0x53ef52)=>{var _0x1b41b8=_0xe4fba0;_0x513fd0[_0x53ef52][_0x1b41b8(0x13f)]=_0x2134dc;}),_0xc271f5[_0xe4fba0(0x16b)]((_0x43e882,_0x5f2f84)=>{var _0x5741c6=_0xe4fba0;_0x513fd0[_0x5f2f84][_0x5741c6(0x171)]=_0x43e882;}),_0x261483[_0xe4fba0(0x16b)]((_0x40b5e3,_0x33a0c7)=>{var _0x2737fe=_0xe4fba0;_0x513fd0[_0x33a0c7][_0x2737fe(0x191)]=_0x40b5e3;}),_0x252a45[_0xe4fba0(0x16b)]((_0x48993e,_0x1084c8)=>{var _0x129ff3=_0xe4fba0;_0x513fd0[_0x1084c8][_0x129ff3(0x1c3)]=_0x48993e;}),_0x5429da[_0xe4fba0(0x16b)]((_0x4677a6,_0x3f592e)=>{var _0x1d24f4=_0xe4fba0;_0x513fd0[_0x3f592e][_0x1d24f4(0x11a)]=_0x4677a6;});var _0x4016a0=0x0;_0x513fd0[_0xe4fba0(0x16b)](_0x53cc1b=>{var _0x1a6ae6=_0xe4fba0;console[_0x1a6ae6(0x16c)]('foreach\x20newproduct',_0x53cc1b),(parseInt(_0x53cc1b['sale_qty'])<parseInt(_0x53cc1b[_0x1a6ae6(0x13f)])||parseInt(_0x53cc1b[_0x1a6ae6(0x15c)])<parseInt(_0x53cc1b[_0x1a6ae6(0x13f)])&&parseInt(_0x53cc1b[_0x1a6ae6(0x1bc)])>parseInt(_0x53cc1b[_0x1a6ae6(0x13f)])||parseInt(_0x53cc1b[_0x1a6ae6(0x13f)])==0x0)&&_0x4016a0++;});if(_0x4016a0!=0x0)return _0x1cf5d1[_0xe4fba0(0x1d4)](_0xe4fba0(0x12b),_0xe4fba0(0x196)),_0x459c40[_0xe4fba0(0x14d)](_0xe4fba0(0x19f));const _0x2845a3=await sales['findOne']({'invoice':_0x382184});console[_0xe4fba0(0x16c)](_0x2845a3),_0x2845a3[_0xe4fba0(0x111)]='True';const _0xa58aab=await _0x2845a3['save'](),_0x37efff=new sales_return({'invoice':_0x382184,'customer':_0x1cf5d1[_0xe4fba0(0x169)]['customer'],'date':_0x42e49f,'warehouse_name':_0x543299,'room':_0x2baef5,'ToWarehouse':_0x3a9ea0,'ToRoom':_0x35e639,'return_sale':_0x513fd0,'note':_0x121567}),_0x4f2de1=await _0x37efff[_0xe4fba0(0x17a)]();console['log'](_0x37efff);const _0x2afd65=await sales_return[_0xe4fba0(0x122)]({'invoice':_0x382184}),_0x2e2c06=await warehouse[_0xe4fba0(0x122)]({'name':_0x3a9ea0,'room':_0x35e639});_0x2afd65[_0xe4fba0(0x166)][_0xe4fba0(0x16b)](_0x5b84cf=>{var _0x28214a=_0xe4fba0,_0x114ac3=0x0;const _0x1995eb=_0x2e2c06['product_details']['map'](_0x7b7255=>{var _0x25b440=a0_0x56bd;_0x7b7255[_0x25b440(0x119)]==_0x5b84cf[_0x25b440(0x119)]&&_0x7b7255['floorlevel']==_0x5b84cf[_0x25b440(0x11a)]&&_0x7b7255['type']==_0x5b84cf['type']&&_0x7b7255[_0x25b440(0x191)]==_0x5b84cf['bin']&&_0x7b7255[_0x25b440(0x171)]==_0x5b84cf[_0x25b440(0x171)]&&(_0x7b7255['product_stock']=parseInt(_0x7b7255[_0x25b440(0x12c)])+parseInt(_0x5b84cf['return_qty']),_0x114ac3++);});_0x114ac3=='0'&&(_0x2e2c06['product_details']=_0x2e2c06['product_details'][_0x28214a(0x1d9)]({'product_name':_0x5b84cf[_0x28214a(0x119)],'product_stock':_0x5b84cf[_0x28214a(0x13f)],'primary_code':_0x5b84cf[_0x28214a(0x1f9)],'secondary_code':_0x5b84cf[_0x28214a(0x13e)],'product_code':_0x5b84cf[_0x28214a(0x167)],'bay':_0x5b84cf['bay'],'bin':_0x5b84cf[_0x28214a(0x191)],'type':_0x5b84cf[_0x28214a(0x1c3)],'floorlevel':_0x5b84cf[_0x28214a(0x11a)]})),console['log'](_0x28214a(0x124),_0x2e2c06);}),await _0x2e2c06[_0xe4fba0(0x17a)](),console[_0xe4fba0(0x16c)](_0x1cf5d1[_0xe4fba0(0x169)]);const _0x5700bb=new c_payment_data({'invoice':_0x382184,'customer':_0x1cf5d1[_0xe4fba0(0x169)][_0xe4fba0(0x1b7)],'reason':_0xe4fba0(0x201)});await _0x5700bb['save']();const _0x2f8810=await master_shop[_0xe4fba0(0x15f)]();console['log'](_0xe4fba0(0x123),_0x2f8810[0x0]['image']);const _0x536aaf=await email_settings['findOne'](),_0x48f291=await customer['findOne']({'name':_0x1cf5d1['body'][_0xe4fba0(0x1b7)]});console['log'](_0xe4fba0(0x19a),_0x48f291);_0x2f8810[0x0]['currency_placement']==0x1?(right_currency=_0x2f8810[0x0][_0xe4fba0(0x170)],left_currency=''):(right_currency='',left_currency=_0x2f8810[0x0][_0xe4fba0(0x170)]);var _0x181abb=_0x395b3a,_0x58af76=_0x1cf11b,_0x20a735='',_0x539b22;for(_0x539b22 in _0x181abb){_0x20a735+='<tr>'+_0xe4fba0(0x206)+_0x181abb[_0x539b22]+'</td>'+_0xe4fba0(0x206)+_0x58af76[_0x539b22]+_0xe4fba0(0x181)+_0xe4fba0(0x10f);}console[_0xe4fba0(0x16c)](_0xe4fba0(0x1a9),_0x20a735);let _0x156d82=nodemailer[_0xe4fba0(0x157)]({'service':_0xe4fba0(0x1de),'auth':{'user':_0x536aaf['email'],'pass':_0x536aaf['password']}}),_0x273aee={'from':_0x536aaf[_0xe4fba0(0x202)],'to':_0x48f291[_0xe4fba0(0x202)],'subject':_0xe4fba0(0x152),'attachments':[{'filename':_0xe4fba0(0x1b6),'path':__dirname+_0xe4fba0(0x141)+'/upload/'+_0x2f8810[0x0]['image'],'cid':_0xe4fba0(0x1ef)}],'html':_0xe4fba0(0x1e9)+_0xe4fba0(0x17e)+'</head><body>'+_0xe4fba0(0x173)+_0xe4fba0(0x1ea)+_0xe4fba0(0x173)+_0xe4fba0(0x136)+_0xe4fba0(0x1e5)+'<div>'+_0xe4fba0(0x186)+_0x2f8810[0x0]['site_title']+_0xe4fba0(0x149)+_0xe4fba0(0x1e5)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0xe4fba0(0x173)+_0xe4fba0(0x1dd)+_0xe4fba0(0x140)+_0x382184+'\x20'+_0xe4fba0(0x213)+_0xe4fba0(0x138)+_0x42e49f+'\x20'+'</span>'+_0xe4fba0(0x10d)+_0xe4fba0(0x1e5)+_0xe4fba0(0x1d6)+_0xe4fba0(0x1d1)+'<tr>'+_0xe4fba0(0x13b)+_0xe4fba0(0x162)+_0xe4fba0(0x1c4)+_0xe4fba0(0x1c7)+_0xe4fba0(0x10f)+_0xe4fba0(0x15a)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x20a735+'\x20'+_0xe4fba0(0x18a)+_0xe4fba0(0x1fb)+_0xe4fba0(0x173)+_0xe4fba0(0x150)+_0xe4fba0(0x200)+_0x2f8810[0x0][_0xe4fba0(0x188)]+_0xe4fba0(0x10d)+_0xe4fba0(0x1e5)+_0xe4fba0(0x1e5)+_0xe4fba0(0x190)};_0x156d82[_0xe4fba0(0x109)](_0x273aee,function(_0x5cdec8,_0x5d871f){var _0x347b7f=_0xe4fba0;_0x5cdec8?(console[_0x347b7f(0x16c)](_0x5cdec8),console[_0x347b7f(0x16c)]('Error\x20Occurs')):console[_0x347b7f(0x16c)]('Email\x20sent\x20successfully');}),_0x1cf5d1[_0xe4fba0(0x1d4)](_0xe4fba0(0x17c),_0xe4fba0(0x1f1)),_0x459c40[_0xe4fba0(0x14d)](_0xe4fba0(0x203));}catch(_0x321d09){console['log'](_0x321d09),_0x459c40['status'](0xc8)[_0xe4fba0(0x13d)]({'message1':_0x321d09[_0xe4fba0(0x16e)]});}}),router[a0_0x344a80(0x1b8)]('/barcode/:id',auth,async(_0x29a649,_0x457428)=>{var _0x44b578=a0_0x344a80;try{const {username:_0x493e93,email:_0x4b1740,role:_0x3cb224}=_0x29a649['user'],_0x541017=_0x29a649[_0x44b578(0x1b9)],_0x596907=await profile['findOne']({'email':_0x541017[_0x44b578(0x202)]}),_0xeafa84=await master_shop[_0x44b578(0x15f)]();console[_0x44b578(0x16c)](_0x44b578(0x17f),_0xeafa84);const _0x17921f=_0x29a649['params']['id'],_0xe2e55a=await sales['findById'](_0x17921f);console[_0x44b578(0x16c)](_0x44b578(0x1c5),_0xe2e55a);if(_0xeafa84[0x0][_0x44b578(0x147)]==_0x44b578(0x1d2))var _0x3b7ddb=users['English'];else{if(_0xeafa84[0x0][_0x44b578(0x147)]==_0x44b578(0x1ee))var _0x3b7ddb=users[_0x44b578(0x1ee)];else{if(_0xeafa84[0x0][_0x44b578(0x147)]=='German')var _0x3b7ddb=users[_0x44b578(0x199)];else{if(_0xeafa84[0x0][_0x44b578(0x147)]==_0x44b578(0x15b))var _0x3b7ddb=users['Spanish'];else{if(_0xeafa84[0x0]['language']=='French')var _0x3b7ddb=users[_0x44b578(0x1e3)];else{if(_0xeafa84[0x0][_0x44b578(0x147)]==_0x44b578(0x101))var _0x3b7ddb=users['Portuguese'];else{if(_0xeafa84[0x0][_0x44b578(0x147)]=='Chinese')var _0x3b7ddb=users[_0x44b578(0x16f)];else{if(_0xeafa84[0x0]['language']==_0x44b578(0x1b0))var _0x3b7ddb=users[_0x44b578(0x146)];}}}}}}}_0x457428[_0x44b578(0xff)](_0x44b578(0x1d8),{'success':_0x29a649[_0x44b578(0x1d4)]('success'),'errors':_0x29a649[_0x44b578(0x1d4)]('errors'),'role':_0x541017,'profile':_0x596907,'alldata':_0xe2e55a,'master_shop':_0xeafa84,'language':_0x3b7ddb});}catch(_0x1cdf11){console['log'](_0x1cdf11);}}),router['post']('/barcode_scanner',async(_0x493121,_0x2bbad7)=>{var _0x37d937=a0_0x344a80;const {product_code:_0x16eddb,warehouse_name:_0x8e78b3,rooms_data:_0x5c5c10,Roomslist:_0x453429}=_0x493121[_0x37d937(0x169)],_0x14849=_0x453429[_0x37d937(0x1f5)](','),_0x17ec7d=[];async function _0x42c56c(_0x45c7b7){var _0x201cad=_0x37d937;const _0xeb18ed=await warehouse['aggregate']([{'$match':{'name':_0x8e78b3,'room':_0x45c7b7}},{'$unwind':_0x201cad(0x1a1)},{'$match':{'product_details.primary_code':_0x16eddb}},{'$group':{'_id':_0x201cad(0x174),'name':{'$first':_0x201cad(0x1f3)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x201cad(0x14a)},'secondary_code':{'$first':_0x201cad(0x1c9)},'product_code':{'$first':_0x201cad(0x1a6)},'level':{'$first':_0x201cad(0x195)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x201cad(0x1bb)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x201cad(0x131)},'storage':{'$first':_0x201cad(0x155)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x201cad(0x20f)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x201cad(0x187)},'batch_code':{'$first':_0x201cad(0x134)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x201cad(0x117)},'actual_qty':{'$first':_0x201cad(0x1d3)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x2cccd7=await warehouse[_0x201cad(0x113)]([{'$match':{'name':_0x8e78b3,'room':_0x45c7b7}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x16eddb}},{'$group':{'_id':_0x201cad(0x174),'name':{'$first':_0x201cad(0x1f3)},'product_stock':{'$first':_0x201cad(0x20c)},'primary_code':{'$first':_0x201cad(0x14a)},'secondary_code':{'$first':_0x201cad(0x1c9)},'product_code':{'$first':_0x201cad(0x1a6)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x201cad(0x19b)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x201cad(0x18f)},'secondary_unit':{'$first':_0x201cad(0x131)},'storage':{'$first':_0x201cad(0x155)},'rack':{'$first':_0x201cad(0x12f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x201cad(0x1e0)},'maxPerUnit':{'$first':_0x201cad(0x187)},'batch_code':{'$first':_0x201cad(0x134)},'product_cat':{'$first':_0x201cad(0x182)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x201cad(0x204)},'invoice':{'$first':_0x201cad(0x117)}}}]);if(_0xeb18ed[_0x201cad(0x1be)]>0x0)_0x17ec7d[_0x201cad(0x210)](_0xeb18ed);else _0x2cccd7[_0x201cad(0x1be)]>0x0&&_0x17ec7d[_0x201cad(0x210)](_0x2cccd7);}const _0x564acb=_0x14849[_0x37d937(0x132)](_0x46b679=>_0x42c56c(_0x46b679));await Promise[_0x37d937(0x142)](_0x564acb),_0x2bbad7[_0x37d937(0x13d)](_0x17ec7d);}),module[a0_0x344a80(0x209)]=router;