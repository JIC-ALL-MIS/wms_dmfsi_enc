function a0_0x1166(_0x4d0523,_0x37908e){var _0x12afb5=a0_0x12af();return a0_0x1166=function(_0x116614,_0x9a90bd){_0x116614=_0x116614-0x1ea;var _0x1705d6=_0x12afb5[_0x116614];return _0x1705d6;},a0_0x1166(_0x4d0523,_0x37908e);}var a0_0x168650=a0_0x1166;(function(_0x5c83a7,_0xa896d5){var _0x6425b0=a0_0x1166,_0x9a1297=_0x5c83a7();while(!![]){try{var _0x1e4a57=-parseInt(_0x6425b0(0x2a5))/0x1*(parseInt(_0x6425b0(0x2f4))/0x2)+-parseInt(_0x6425b0(0x25b))/0x3+parseInt(_0x6425b0(0x27c))/0x4*(parseInt(_0x6425b0(0x239))/0x5)+-parseInt(_0x6425b0(0x26c))/0x6*(-parseInt(_0x6425b0(0x2fa))/0x7)+-parseInt(_0x6425b0(0x1f0))/0x8+parseInt(_0x6425b0(0x2f2))/0x9*(-parseInt(_0x6425b0(0x2a7))/0xa)+-parseInt(_0x6425b0(0x2d2))/0xb*(-parseInt(_0x6425b0(0x255))/0xc);if(_0x1e4a57===_0xa896d5)break;else _0x9a1297['push'](_0x9a1297['shift']());}catch(_0x2afb75){_0x9a1297['push'](_0x9a1297['shift']());}}}(a0_0x12af,0x5aff0));const express=require(a0_0x168650(0x24c)),app=express(),router=express[a0_0x168650(0x2c5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x168650(0x27b)),auth=require('../middleware/auth'),nodemailer=require(a0_0x168650(0x289)),users=require(a0_0x168650(0x203));router[a0_0x168650(0x29a)]('/view',auth,async(_0x23480a,_0x33272d)=>{var _0x5ea82a=a0_0x168650;try{const {username:_0x3fd5f9,email:_0xd925ba,role:_0x184787}=_0x23480a[_0x5ea82a(0x22b)],_0x51ab4a=_0x23480a[_0x5ea82a(0x22b)],_0x9e0bde=await profile['findOne']({'email':_0x51ab4a[_0x5ea82a(0x293)]}),_0x4c318e=await master_shop[_0x5ea82a(0x233)]();let _0x362d90;if(_0x51ab4a[_0x5ea82a(0x24b)]=='staff'){const _0x4bf8ba=await staff[_0x5ea82a(0x25f)]({'email':_0x51ab4a[_0x5ea82a(0x293)]});_0x362d90=await sales[_0x5ea82a(0x1fb)]([{'$lookup':{'from':_0x5ea82a(0x1f4),'localField':_0x5ea82a(0x29d),'foreignField':_0x5ea82a(0x2d3),'as':_0x5ea82a(0x21e)}},{'$unwind':_0x5ea82a(0x27e)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x5ea82a(0x27f),'invoice':{'$first':_0x5ea82a(0x2c3)},'customers':{'$first':_0x5ea82a(0x268)},'date':{'$first':_0x5ea82a(0x2ca)},'warehouse_name':{'$first':_0x5ea82a(0x298)},'sale_product':{'$push':_0x5ea82a(0x20e)},'note':{'$first':_0x5ea82a(0x26b)},'return_data':{'$first':_0x5ea82a(0x29e)},'customers_docs':{'$first':_0x5ea82a(0x27e)},'total_saleproduct_quantity':{'$sum':_0x5ea82a(0x1f9)},'level':{'$addToSet':_0x5ea82a(0x23e)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x5ea82a(0x218)},'pallet':{'$addToSet':_0x5ea82a(0x2dd)},'finalize':{'$first':_0x5ea82a(0x1fc)},'isAllowEdit':{'$first':_0x5ea82a(0x21f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x362d90=await sales[_0x5ea82a(0x1fb)]([{'$lookup':{'from':_0x5ea82a(0x1f4),'localField':_0x5ea82a(0x29d),'foreignField':_0x5ea82a(0x2d3),'as':_0x5ea82a(0x21e)}},{'$unwind':_0x5ea82a(0x27e)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x5ea82a(0x27f),'invoice':{'$first':_0x5ea82a(0x2c3)},'customers':{'$first':_0x5ea82a(0x268)},'date':{'$first':_0x5ea82a(0x2ca)},'warehouse_name':{'$first':_0x5ea82a(0x298)},'sale_product':{'$push':_0x5ea82a(0x20e)},'note':{'$first':_0x5ea82a(0x26b)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x5ea82a(0x23e)},'isle':{'$addToSet':_0x5ea82a(0x22c)},'type':{'$addToSet':_0x5ea82a(0x218)},'pallet':{'$addToSet':_0x5ea82a(0x2dd)},'finalize':{'$first':_0x5ea82a(0x1fc)},'isAllowEdit':{'$first':_0x5ea82a(0x21f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5ea82a(0x23f)](_0x5ea82a(0x2a2),_0x362d90);if(_0x4c318e[0x0]['language']==_0x5ea82a(0x252)){var _0x13e67=users[_0x5ea82a(0x2b7)];console[_0x5ea82a(0x23f)](_0x13e67);}else{if(_0x4c318e[0x0][_0x5ea82a(0x247)]==_0x5ea82a(0x201))var _0x13e67=users[_0x5ea82a(0x201)];else{if(_0x4c318e[0x0][_0x5ea82a(0x247)]=='German')var _0x13e67=users[_0x5ea82a(0x20f)];else{if(_0x4c318e[0x0]['language']=='Spanish')var _0x13e67=users['Spanish'];else{if(_0x4c318e[0x0][_0x5ea82a(0x247)]==_0x5ea82a(0x2f7))var _0x13e67=users['French'];else{if(_0x4c318e[0x0]['language']==_0x5ea82a(0x2ff))var _0x13e67=users['Portuguese'];else{if(_0x4c318e[0x0][_0x5ea82a(0x247)]==_0x5ea82a(0x2af))var _0x13e67=users[_0x5ea82a(0x2af)];else{if(_0x4c318e[0x0][_0x5ea82a(0x247)]==_0x5ea82a(0x2bc))var _0x13e67=users[_0x5ea82a(0x250)];}}}}}}}_0x33272d[_0x5ea82a(0x2cd)]('all_sales',{'success':_0x23480a['flash']('success'),'errors':_0x23480a[_0x5ea82a(0x219)]('errors'),'sales':_0x362d90,'profile':_0x9e0bde,'role':_0x51ab4a,'master_shop':_0x4c318e,'language':_0x13e67});}catch(_0x5baf4c){console[_0x5ea82a(0x23f)](_0x5baf4c);}});function a0_0x12af(){var _0x5f290d=['Floor','Sale\x20Return\x20Mail','maxperunit','3810024oNFNVL','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','stock','True','customers','getMonth','/view/add_sales','id_transaction_from','port','$sale_product.quantity','Sales\x20Mail','aggregate','$finalize','Return\x20Rooms','all','stock_data','Sales\x20Add\x20successfully','Hindi','</table>','../public/language/languages.json','<table\x20style=\x22width:\x20100%\x20!important;\x22>','padStart','$product_details.level','back','level','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','image','/view/return_sales/:id','RMSEmail','$sale_product','German','<h5>','$product_details.invoice','sendMail','$product_details.production_date','/view/add_sale/product','type','OUT-','catch','$sale_product.type','flash','Sales\x20Update\x20successfully','<h5\x20style=\x22text-align:\x20left;\x22>','Email\x20sent\x20successfully','production_date','customers_docs','$isAllowEdit','$product_details.secondary_code','findById','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.maxPerUnit','isAllowEdit','$product_details.batch_code','stocks','actual_qty','date','expiry_date','user','$sale_product.bin','</span>','unit','\x20</h2>','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Logo.png','find','product_code','sale_qty','types','invoice','delivery_code','945MLLBzf','Level','Shelves','Raw\x20Materials','length','$sale_product.bay','log','rack','message','room_name','password','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','delivery_date','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','language','$product_details.rack','customer_data','</body></html>','role','express','purchases_data','logo','</tbody>','Arabic','product_data','English\x20(US)','\x20Order\x20Number\x20:\x20','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','12DzjKkM','filter','prod_invoice','secondary_code','requested_qty','<div>','851778RJsRuG','actual_uom','$product_details.product_cat','/invoice/:id','findOne','amount','product_list','json','push','Spanish','RoomAssigned','host','</h5>','$customer','forEach','prod_code','$note','1370388MaWfxb','Enabled','$product_details','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','batch_code','</thead>','$product_details.isle','site_title','$product_details.product_stock','params','</div>','foreach\x20newproduct','sale_product','../models/all_models','96FnDcBb','all_sales_barcode','$customers_docs','$_id','$product_details.product_name','then','\x20Order\x20Date\x20:\x20','$product_details.delivery_code','currency','Enclosed','/upload/','secondary_unit','storage','nodemailer','$product_details.product_code','carton','toString','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','staff','warehouse','body','/give_payment/:id','email','Sale\x20Return','$product_details.bin','$room','<h2>\x20','$warehouse_name','False','get','payment\x20successfull','exports','customer','$return_data','/barcode/:id','createTransport','add_sales','sales\x20all_data','product_details','$product_details.storage','561185wDHuln','sales\x20item\x20return\x20successfull','384610gZVYlc','error','$product_details.expiry_date','_id','room','<strong>\x20Regards\x20</strong>','slice','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Chinese','bay','$product_details.actual_uom','product_stock','<span\x20style=\x22float:\x20right;\x22>','return_qty','floorlevel','add\x20post','English','map','master','string','Portuguese','Arabic\x20(ae)','</tr>','sales_quantity','<html><head><title></title>','<tr>','$product_details.type','/all_sales/preview/','$invoice','redirect','Router','Return\x20Goods','random','$product_details.primary_code','product_name','$date','max_per_unit','<hr\x20class=\x22my-3\x22>','render','id_transact','warehouse_name','floor','barcode\x20Product\x20master','19086243TgOhxu','name','bin','prod_cat','$product_details.secondary_unit','</head><body>','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','received_amount','getDate','$product_details.delivery_date','$sale_product.floorlevel','primary_unit','$product_details._id','quantity','save','concat','/all_sales/view','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/:id','gmail','final','abs','$product_details.floorlevel','SCRN','return_sale','status','/../public','$product_details.bay','/preview/:id','max','edit_sales_view','171pHYYEt','primary_code','2emttkh','finalize','barcode\x20user_id','French','$product_details.pallet','split','21uvCwKb','post','$product','success','$name','Portuguese\x20(BR)','quantity_notConverted','<tbody\x20style=\x22text-align:\x20center;\x22>','</td>'];a0_0x12af=function(){return _0x5f290d;};return a0_0x12af();}async function getRandom8DigitNumber(){var _0x236402=a0_0x168650;const _0xd8e068=0x989680,_0x5b2afa=0x5f5e0ff,_0x19057e=Math[_0x236402(0x2d0)](Math[_0x236402(0x2c7)]()*(_0x5b2afa-_0xd8e068+0x1))+_0xd8e068;var _0xacb853;const _0x360b04=await sales[_0x236402(0x25f)]({'invoice':_0x236402(0x216)+_0x19057e});return _0x360b04&&_0x360b04[_0x236402(0x23d)]>0x0?_0xacb853=_0x236402(0x216)+_0x19057e:_0xacb853=_0x236402(0x216)+_0x19057e,_0xacb853;}router[a0_0x168650(0x29a)](a0_0x168650(0x1f6),auth,async(_0x34f1f9,_0x297796)=>{var _0x16a590=a0_0x168650;try{const {username:_0x551a1e,email:_0x27ca13,role:_0x3ab606}=_0x34f1f9[_0x16a590(0x22b)],_0x537435=_0x34f1f9[_0x16a590(0x22b)],_0x418f15=await profile[_0x16a590(0x25f)]({'email':_0x537435[_0x16a590(0x293)]}),_0x513a25=await master_shop[_0x16a590(0x233)](),_0x437e25=await customer[_0x16a590(0x233)]({});let _0x561458;if(_0x537435[_0x16a590(0x24b)]==_0x16a590(0x28f)){const _0x18aafe=await staff[_0x16a590(0x25f)]({'email':_0x537435[_0x16a590(0x293)]});_0x561458=await warehouse[_0x16a590(0x1fb)]([{'$match':{'status':_0x16a590(0x26d),'name':_0x18aafe[_0x16a590(0x290)],'warehouse_category':_0x16a590(0x23c),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x16a590(0x2fe),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x561458=await warehouse['aggregate']([{'$match':{'status':_0x16a590(0x26d),'warehouse_category':_0x16a590(0x23c),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x18bdd1=await product[_0x16a590(0x233)]({});var _0x4580fc=['Ambient',_0x16a590(0x285)];const _0x573bf0=await sales[_0x16a590(0x233)]({}),_0x2a98ee=_0x573bf0[_0x16a590(0x23d)]+0x1,_0x2cc093=_0x16a590(0x216)+_0x2a98ee[_0x16a590(0x28c)]()[_0x16a590(0x205)](0x5,'0');if(_0x513a25[0x0][_0x16a590(0x247)]==_0x16a590(0x252)){var _0x51c001=users[_0x16a590(0x2b7)];console[_0x16a590(0x23f)](_0x51c001);}else{if(_0x513a25[0x0][_0x16a590(0x247)]==_0x16a590(0x201))var _0x51c001=users['Hindi'];else{if(_0x513a25[0x0]['language']==_0x16a590(0x20f))var _0x51c001=users[_0x16a590(0x20f)];else{if(_0x513a25[0x0]['language']==_0x16a590(0x264))var _0x51c001=users['Spanish'];else{if(_0x513a25[0x0][_0x16a590(0x247)]=='French')var _0x51c001=users[_0x16a590(0x2f7)];else{if(_0x513a25[0x0][_0x16a590(0x247)]==_0x16a590(0x2ff))var _0x51c001=users['Portuguese'];else{if(_0x513a25[0x0][_0x16a590(0x247)]=='Chinese')var _0x51c001=users['Chinese'];else{if(_0x513a25[0x0][_0x16a590(0x247)]==_0x16a590(0x2bc))var _0x51c001=users['Arabic'];}}}}}}}const _0x36dbe4=getRandom8DigitNumber();_0x36dbe4[_0x16a590(0x281)](_0x4adfc3=>{var _0x454e46=_0x16a590;_0x297796['render'](_0x454e46(0x2a1),{'success':_0x34f1f9[_0x454e46(0x219)](_0x454e46(0x2fd)),'errors':_0x34f1f9[_0x454e46(0x219)](_0x454e46(0x209)),'role':_0x537435,'profile':_0x418f15,'customer':_0x437e25,'warehouse':_0x561458,'product':_0x18bdd1,'invoice':_0x4adfc3,'master_shop':_0x513a25,'language':_0x51c001,'rooms_data':_0x4580fc});})['catch'](_0x3bd467=>{var _0x441f38=_0x16a590;_0x34f1f9[_0x441f38(0x219)](_0x441f38(0x209),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x297796[_0x441f38(0x2c4)](_0x441f38(0x2e3));});}catch(_0x4d26da){console[_0x16a590(0x23f)](_0x4d26da);}}),router['get']('/view/add_sales/:id',auth,async(_0x479fb3,_0x1790b4)=>{var _0x29622e=a0_0x168650;try{const _0x281b55=_0x479fb3[_0x29622e(0x277)]['id'];console[_0x29622e(0x23f)](_0x281b55);const _0x436eb7=await product['find'](),_0x26f9d8=await purchases[_0x29622e(0x1fb)]([{'$match':{'warehouse_name':_0x281b55}},{'$unwind':_0x29622e(0x2fc)},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x29622e(0x24d),_0x26f9d8),_0x1790b4[_0x29622e(0x2ec)](0xc8)[_0x29622e(0x262)]({'purchases_data':_0x26f9d8,'product_data':_0x436eb7});}catch(_0x5677e0){console['log'](_0x5677e0);}}),router[a0_0x168650(0x2fb)](a0_0x168650(0x214),auth,async(_0x332f37,_0x66026d)=>{var _0x395f30=a0_0x168650;try{const {warehouse_data:_0x18fd46,product_data:_0x5eaa5c}=_0x332f37[_0x395f30(0x291)];console[_0x395f30(0x23f)](_0x332f37[_0x395f30(0x291)][_0x395f30(0x251)]);;const _0x22165a=await master_shop['find']();console['log'](_0x395f30(0x2b9),_0x22165a);const _0xc0f974=await product[_0x395f30(0x25f)]({'name':_0x5eaa5c});console[_0x395f30(0x23f)](_0x395f30(0x28d),_0xc0f974);const _0x59538a=await warehouse[_0x395f30(0x1fb)]([{'$match':{'name':_0x18fd46}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x5eaa5c}},{'$group':{'_id':_0x395f30(0x280),'product_stock':{'$first':_0x395f30(0x276)}}}]);console['log'](_0x395f30(0x1ff),_0x59538a),_0x66026d[_0x395f30(0x2ec)](0xc8)['json']({'master':_0x22165a,'new_product':_0xc0f974,'stock_data':_0x59538a});}catch(_0xa36302){console['log'](_0xa36302);}}),router[a0_0x168650(0x2fb)](a0_0x168650(0x1f6),auth,async(_0x3ef812,_0x376c9b)=>{var _0x19aea7=a0_0x168650;try{const {invoice:_0x5143ae,date:_0x3fb76d,warehouse_name:_0x573776,product_name:_0x40f407,stock:_0x4a5fd6,quantity:_0x59c8a0,note:_0x461f06,room:_0x88a7d8,primary_code:_0x5776af,secondary_code:_0x4f3d97,prod_code:_0x196bbe,level:_0x31b65a,isle:_0x235edc,pallet:_0x12f3c6,batch_code:_0x54531b,SCRN:_0x26ffe1,expiry_date:_0xa07e00}=_0x3ef812[_0x19aea7(0x291)];if(typeof _0x40f407==_0x19aea7(0x2ba))var _0x97450b=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x2c9)]],_0x28b438=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x1f2)]],_0x41d090=[_0x3ef812['body'][_0x19aea7(0x28b)]],_0x3634b4=[_0x3ef812['body']['primary_code']],_0x45a660=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x258)]],_0x2aa134=[_0x3ef812['body'][_0x19aea7(0x26a)]],_0x1a5523=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x208)]],_0xb2f302=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x2de)]],_0x145c01=[_0x3ef812['body'][_0x19aea7(0x287)]],_0x125993=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x272)]],_0x5c3314=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x22a)]],_0x48ca73=[_0x3ef812['body'][_0x19aea7(0x2cb)]],_0xa8f960=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x21d)]],_0x9b0e20=[_0x3ef812['body']['requested_qty']],_0xdf138c=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x245)]],_0x29daf4=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x238)]],_0x1bf7c9=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x2d5)]],_0x37069a=[_0x3ef812['body'][_0x19aea7(0x2e0)]],_0x4cab14=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x265)]],_0x264a13=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x257)]],_0x43340c=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x228)]],_0x15e6c3=[_0x3ef812[_0x19aea7(0x291)]['actual_uom']],_0x307819=[_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x2ce)]];else var _0x97450b=[..._0x3ef812['body']['product_name']],_0x28b438=[..._0x3ef812[_0x19aea7(0x291)]['stock']],_0x41d090=[..._0x3ef812['body']['carton']],_0x3634b4=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x2f3)]],_0x45a660=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x258)]],_0x2aa134=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x26a)]],_0x1a5523=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x208)]],_0xb2f302=[..._0x3ef812[_0x19aea7(0x291)]['primary_unit']],_0x145c01=[..._0x3ef812['body']['secondary_unit']],_0x125993=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x272)]],_0x5c3314=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x22a)]],_0x48ca73=[..._0x3ef812['body'][_0x19aea7(0x2cb)]],_0xa8f960=[..._0x3ef812['body'][_0x19aea7(0x21d)]],_0x9b0e20=[..._0x3ef812[_0x19aea7(0x291)]['requested_qty']],_0xdf138c=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x245)]],_0x29daf4=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x238)]],_0x1bf7c9=[..._0x3ef812[_0x19aea7(0x291)]['prod_cat']],_0x37069a=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x2e0)]],_0x4cab14=[..._0x3ef812[_0x19aea7(0x291)]['RoomAssigned']],_0x264a13=[..._0x3ef812[_0x19aea7(0x291)]['prod_invoice']],_0x43340c=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x228)]],_0x15e6c3=[..._0x3ef812['body'][_0x19aea7(0x25c)]],_0x307819=[..._0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x2ce)]];const _0x3a9b63=_0x97450b[_0x19aea7(0x2b8)](_0x2ea185=>{return _0x2ea185={'product_name':_0x2ea185};});_0x28b438[_0x19aea7(0x269)]((_0x817a2c,_0x42c106)=>{var _0x53083e=_0x19aea7;_0x3a9b63[_0x42c106]['stock']=Math[_0x53083e(0x2e8)](_0x817a2c);}),_0x43340c[_0x19aea7(0x269)]((_0x22cadf,_0x5e889c)=>{var _0x560e2a=_0x19aea7;_0x3a9b63[_0x5e889c]['actual_qty']=Math[_0x560e2a(0x2e8)](_0x22cadf);}),_0x15e6c3[_0x19aea7(0x269)]((_0x58e13e,_0x2f3a49)=>{var _0x4a4057=_0x19aea7;_0x3a9b63[_0x2f3a49][_0x4a4057(0x25c)]=_0x58e13e;}),_0x307819[_0x19aea7(0x269)]((_0xa45934,_0x1afb5a)=>{var _0x5135f1=_0x19aea7;_0x3a9b63[_0x1afb5a][_0x5135f1(0x1f7)]=_0xa45934;}),_0x41d090[_0x19aea7(0x269)]((_0x14cbfc,_0x380f6f)=>{_0x3a9b63[_0x380f6f]['quantity']=_0x14cbfc;}),_0x3634b4['forEach']((_0x42ee79,_0x4e3e88)=>{var _0x11fcd5=_0x19aea7;_0x3a9b63[_0x4e3e88][_0x11fcd5(0x2f3)]=_0x42ee79;}),_0x45a660[_0x19aea7(0x269)]((_0x397690,_0x4477f6)=>{var _0x3f25ac=_0x19aea7;_0x3a9b63[_0x4477f6][_0x3f25ac(0x258)]=_0x397690;}),_0x2aa134[_0x19aea7(0x269)]((_0x995993,_0x5e19bf)=>{var _0x5232f0=_0x19aea7;_0x3a9b63[_0x5e19bf][_0x5232f0(0x234)]=_0x995993;}),_0x1a5523['forEach']((_0x4b1ca2,_0x125c0a)=>{var _0x289430=_0x19aea7;_0x4cab14[_0x289430(0x269)]((_0x209913,_0x3488b1)=>{var _0x4840b5=_0x289430;if(_0x209913=='Receiving\x20Area'&&_0x125c0a==_0x3488b1){var _0x2effd8=_0x4b1ca2[_0x4840b5(0x2ad)](0x3);_0x3a9b63[_0x125c0a][_0x4840b5(0x288)]=_0x4b1ca2[0x0],_0x3a9b63[_0x125c0a]['rack']=_0x4b1ca2[0x1],_0x3a9b63[_0x125c0a][_0x4840b5(0x2b0)]=0x0,_0x3a9b63[_0x125c0a][_0x4840b5(0x2d4)]=0x0,_0x3a9b63[_0x125c0a][_0x4840b5(0x215)]='Floor',_0x3a9b63[_0x125c0a][_0x4840b5(0x2b5)]=_0x2effd8;}else{if(_0x209913==_0x4840b5(0x23b)&&_0x125c0a==_0x3488b1){var _0x2effd8=_0x4b1ca2[_0x4840b5(0x2ad)](0x3);_0x3a9b63[_0x125c0a][_0x4840b5(0x288)]=_0x4b1ca2[0x0],_0x3a9b63[_0x125c0a]['rack']=_0x4b1ca2[0x1],_0x3a9b63[_0x125c0a][_0x4840b5(0x2b0)]=0x0,_0x3a9b63[_0x125c0a]['bin']=0x0,_0x3a9b63[_0x125c0a][_0x4840b5(0x215)]=_0x4840b5(0x1ed),_0x3a9b63[_0x125c0a][_0x4840b5(0x2b5)]=_0x4b1ca2[0x5];}else{if(_0x125c0a==_0x3488b1){var _0xb73711;if(_0x4b1ca2[0x4]=='L')_0xb73711=_0x4840b5(0x23a);else _0x4b1ca2[0x4]=='F'&&(_0xb73711=_0x4840b5(0x1ed));_0x3a9b63[_0x125c0a][_0x4840b5(0x288)]=_0x4b1ca2[0x0],_0x3a9b63[_0x125c0a][_0x4840b5(0x240)]=_0x4b1ca2[0x1],_0x3a9b63[_0x125c0a][_0x4840b5(0x2b0)]=_0x4b1ca2[0x2],_0x3a9b63[_0x125c0a][_0x4840b5(0x2d4)]=_0x4b1ca2[0x3],_0x3a9b63[_0x125c0a]['type']=_0xb73711,_0x3a9b63[_0x125c0a][_0x4840b5(0x2b5)]=_0x4b1ca2[0x5];}}}});}),_0xb2f302[_0x19aea7(0x269)]((_0x43f06c,_0x1f83d6)=>{var _0x13416e=_0x19aea7;_0x3a9b63[_0x1f83d6][_0x13416e(0x22e)]=_0x43f06c;}),_0x145c01[_0x19aea7(0x269)]((_0x45220f,_0x25f55d)=>{var _0x1a0526=_0x19aea7;_0x3a9b63[_0x25f55d][_0x1a0526(0x287)]=_0x45220f;}),_0x125993[_0x19aea7(0x269)]((_0x586f2a,_0x1144ab)=>{var _0x3ca0a2=_0x19aea7;_0x3a9b63[_0x1144ab][_0x3ca0a2(0x272)]=_0x586f2a;}),_0x5c3314[_0x19aea7(0x269)]((_0x2399de,_0x46123d)=>{var _0x2feca9=_0x19aea7;_0x3a9b63[_0x46123d][_0x2feca9(0x22a)]=_0x2399de;}),_0x48ca73[_0x19aea7(0x269)]((_0x17dd90,_0x20d201)=>{_0x3a9b63[_0x20d201]['maxperunit']=_0x17dd90;}),_0xa8f960['forEach']((_0xda398f,_0x42a744)=>{_0x3a9b63[_0x42a744]['production_date']=_0xda398f;}),_0x9b0e20['forEach']((_0x5a3d2f,_0x23608b)=>{var _0x1ef598=_0x19aea7;_0x3a9b63[_0x23608b][_0x1ef598(0x259)]=_0x5a3d2f;}),_0xdf138c[_0x19aea7(0x269)]((_0x37746e,_0x48d8ea)=>{_0x3a9b63[_0x48d8ea]['delivery_date']=_0x37746e;}),_0x29daf4['forEach']((_0x5487dd,_0x5b6ae9)=>{var _0x11cbc6=_0x19aea7;_0x3a9b63[_0x5b6ae9][_0x11cbc6(0x238)]=_0x5487dd;}),_0x1bf7c9[_0x19aea7(0x269)]((_0x5e5cd9,_0x5a5cbe)=>{var _0x468b74=_0x19aea7;_0x3a9b63[_0x5a5cbe][_0x468b74(0x2d5)]=_0x5e5cd9;}),_0x37069a[_0x19aea7(0x269)]((_0x1c2d17,_0x2e6f34)=>{var _0xdbaa0f=_0x19aea7;_0x3a9b63[_0x2e6f34][_0xdbaa0f(0x1ea)]=_0x1c2d17;}),_0x4cab14['forEach']((_0x378fd9,_0x1e1a8b)=>{var _0x421139=_0x19aea7;_0x3a9b63[_0x1e1a8b][_0x421139(0x242)]=_0x378fd9;}),_0x264a13['forEach']((_0x166b2e,_0x122b70)=>{var _0x9ae666=_0x19aea7;_0x3a9b63[_0x122b70][_0x9ae666(0x237)]=_0x166b2e;});var _0x73da99=0x0;_0x3a9b63[_0x19aea7(0x269)](_0xa51328=>{var _0x525fe3=_0x19aea7;(_0xa51328['stock']<_0xa51328['quantity_notConverted']||_0xa51328[_0x525fe3(0x1ea)]==0x0)&&(console[_0x525fe3(0x23f)](_0x525fe3(0x279),_0xa51328),_0x73da99++);});const _0x5c92d3=_0x3a9b63[_0x19aea7(0x256)](_0x42e4ef=>_0x42e4ef[_0x19aea7(0x2e0)]!=='0'&&_0x42e4ef[_0x19aea7(0x2e0)]!==''),_0x19aec2=new sales({'invoice':_0x5143ae,'customer':_0x3ef812[_0x19aea7(0x291)][_0x19aea7(0x29d)],'date':_0x3fb76d,'warehouse_name':_0x573776,'sale_product':_0x5c92d3,'note':_0x461f06,'room':_0x88a7d8,'primary_code':_0x5776af,'secondary_code':_0x4f3d97,'prod_code':_0x196bbe,'SCRN':_0x26ffe1}),_0x5f47e8=await _0x19aec2['save']();_0x3ef812[_0x19aea7(0x219)](_0x19aea7(0x2fd),_0x19aea7(0x200)),_0x376c9b[_0x19aea7(0x2c4)]('/all_sales/preview/'+_0x5f47e8[_0x19aea7(0x2aa)]);}catch(_0x100828){console['log'](_0x100828);}}),router['get'](a0_0x168650(0x2ef),auth,async(_0x339eed,_0x3b9eb1)=>{var _0x137f17=a0_0x168650;try{const {username:_0x236760,email:_0x208c58,role:_0x3256c4}=_0x339eed[_0x137f17(0x22b)],_0x3b4427=_0x339eed['user'],_0x113422=await profile[_0x137f17(0x25f)]({'email':_0x3b4427[_0x137f17(0x293)]}),_0x4ec174=await master_shop[_0x137f17(0x233)](),_0x67b679=_0x339eed[_0x137f17(0x277)]['id'],_0x20b021=await sales['findById'](_0x67b679),_0xeba405=await warehouse['aggregate']([{'$match':{'name':_0x20b021[_0x137f17(0x2cf)]}},{'$unwind':_0x137f17(0x26e)},{'$group':{'_id':_0x137f17(0x2df),'name':{'$first':_0x137f17(0x280)},'product_stock':{'$first':_0x137f17(0x276)},'bay':{'$first':_0x137f17(0x2ee)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x137f17(0x2c1)},'floorlevel':{'$first':_0x137f17(0x2e9)},'primary_code':{'$first':_0x137f17(0x2c8)},'secondary_code':{'$first':_0x137f17(0x220)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x137f17(0x2a4)},'rack':{'$first':_0x137f17(0x248)},'expiry_date':{'$first':_0x137f17(0x2a9)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':'$product_details.invoice'}}}]),_0xd1beeb=await customer['find']({});let _0x4f61ea;if(_0x3b4427['role']==_0x137f17(0x28f)){const _0x491e1a=await staff[_0x137f17(0x25f)]({'email':_0x3b4427[_0x137f17(0x293)]});_0x4f61ea=await warehouse['aggregate']([{'$match':{'status':_0x137f17(0x26d),'name':_0x491e1a['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x137f17(0x2fe)}}}]);}else _0x4f61ea=await warehouse[_0x137f17(0x1fb)]([{'$match':{'status':_0x137f17(0x26d)}},{'$group':{'_id':_0x137f17(0x2fe),'name':{'$first':_0x137f17(0x2fe)}}}]);const _0x413137=await product['find']({}),_0x401498=await suppliers[_0x137f17(0x233)]({});if(_0x4ec174[0x0][_0x137f17(0x247)]==_0x137f17(0x252)){var _0x122292=users[_0x137f17(0x2b7)];console[_0x137f17(0x23f)](_0x122292);}else{if(_0x4ec174[0x0][_0x137f17(0x247)]==_0x137f17(0x201))var _0x122292=users['Hindi'];else{if(_0x4ec174[0x0][_0x137f17(0x247)]==_0x137f17(0x20f))var _0x122292=users[_0x137f17(0x20f)];else{if(_0x4ec174[0x0][_0x137f17(0x247)]==_0x137f17(0x264))var _0x122292=users['Spanish'];else{if(_0x4ec174[0x0][_0x137f17(0x247)]==_0x137f17(0x2f7))var _0x122292=users[_0x137f17(0x2f7)];else{if(_0x4ec174[0x0][_0x137f17(0x247)]==_0x137f17(0x2ff))var _0x122292=users[_0x137f17(0x2bb)];else{if(_0x4ec174[0x0]['language']=='Chinese')var _0x122292=users[_0x137f17(0x2af)];else{if(_0x4ec174[0x0][_0x137f17(0x247)]==_0x137f17(0x2bc))var _0x122292=users[_0x137f17(0x250)];}}}}}}}_0x3b9eb1[_0x137f17(0x2cd)](_0x137f17(0x2f1),{'success':_0x339eed[_0x137f17(0x219)](_0x137f17(0x2fd)),'errors':_0x339eed['flash']('errors'),'role':_0x3b4427,'profile':_0x113422,'customer':_0xd1beeb,'warehouse':_0x4f61ea,'product':_0xeba405,'user':_0x20b021,'master_shop':_0x4ec174,'unit':_0x413137,'language':_0x122292,'suppliers':_0x401498});}catch(_0x270eb6){console[_0x137f17(0x23f)](_0x270eb6);}}),router[a0_0x168650(0x2fb)](a0_0x168650(0x2ef),auth,async(_0x5c4104,_0x3a6d73)=>{var _0x510d88=a0_0x168650;try{const _0x2dae22=_0x5c4104[_0x510d88(0x277)]['id'],{invoice:_0x2fd9f1,warehouse_name:_0xd86854,room:_0x3e5c27}=_0x5c4104[_0x510d88(0x291)],_0x51e769=await sales['findOne']({'invoice':_0x2fd9f1}),_0x458d9a=_0x51e769[_0x510d88(0x27a)][_0x510d88(0x2b8)](async _0x6fb76f=>{var _0x227587=_0x510d88,_0x554fa5=await warehouse[_0x227587(0x25f)]({'name':_0xd86854,'room':_0x6fb76f[_0x227587(0x242)],'warehouse_category':_0x227587(0x23c)});const _0x11cff8=_0x554fa5['product_details']['map'](_0x40c5dc=>{var _0x3a6a6a=_0x227587;_0x40c5dc[_0x3a6a6a(0x2c9)]==_0x6fb76f[_0x3a6a6a(0x2c9)]&&_0x40c5dc[_0x3a6a6a(0x2b5)]==_0x6fb76f[_0x3a6a6a(0x2b5)]&&_0x40c5dc[_0x3a6a6a(0x215)]==_0x6fb76f[_0x3a6a6a(0x215)]&&_0x40c5dc[_0x3a6a6a(0x2d4)]==_0x6fb76f[_0x3a6a6a(0x2d4)]&&_0x40c5dc[_0x3a6a6a(0x2b0)]==_0x6fb76f['bay']&&_0x40c5dc[_0x3a6a6a(0x240)]==_0x6fb76f['rack']&&_0x40c5dc[_0x3a6a6a(0x288)]==_0x6fb76f[_0x3a6a6a(0x288)]&&_0x40c5dc[_0x3a6a6a(0x22a)]==_0x6fb76f[_0x3a6a6a(0x22a)]&&_0x40c5dc[_0x3a6a6a(0x272)]==_0x6fb76f[_0x3a6a6a(0x272)]&&_0x40c5dc[_0x3a6a6a(0x2aa)]==_0x6fb76f[_0x3a6a6a(0x1f7)]&&(_0x40c5dc['product_stock']=Math[_0x3a6a6a(0x2f0)](0x0,Math[_0x3a6a6a(0x2e8)](_0x40c5dc[_0x3a6a6a(0x2b2)])-Math[_0x3a6a6a(0x2e8)](_0x6fb76f[_0x3a6a6a(0x2e0)])));});return _0x554fa5;});Promise[_0x510d88(0x1fe)](_0x458d9a)[_0x510d88(0x281)](async _0x2901c8=>{var _0xd33d84=_0x510d88;try{for(const _0x272c9a of _0x2901c8){await _0x272c9a[_0xd33d84(0x2e1)]();}_0x51e769[_0xd33d84(0x2f5)]='True';const _0x165a2b=await _0x51e769[_0xd33d84(0x2e1)](),_0x53a19d=await master_shop[_0xd33d84(0x233)](),_0x141add=await email_settings[_0xd33d84(0x25f)](),_0xffe7f2=await supervisor_settings['find']();var _0x3483c5=_0x51e769[_0xd33d84(0x27a)],_0x11efbb='',_0x4a947a;for(_0x4a947a in _0x3483c5){_0x11efbb+=_0xd33d84(0x2c0)+_0xd33d84(0x2ae)+_0x3483c5[_0x4a947a]['product_name']+_0xd33d84(0x1ec)+_0xd33d84(0x2ae)+_0x3483c5[_0x4a947a][_0xd33d84(0x234)]+_0xd33d84(0x1ec)+_0xd33d84(0x2ae)+_0x3483c5[_0x4a947a][_0xd33d84(0x2e0)]+'</td>'+_0xd33d84(0x2ae)+_0x3483c5[_0x4a947a][_0xd33d84(0x22e)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3483c5[_0x4a947a][_0xd33d84(0x287)]+_0xd33d84(0x1ec)+_0xd33d84(0x2ae)+_0x51e769[_0xd33d84(0x2cf)]+_0xd33d84(0x1ec)+_0xd33d84(0x2ae)+_0x3483c5[_0x4a947a][_0xd33d84(0x242)]+_0xd33d84(0x1ec)+_0xd33d84(0x2ae)+_0x3483c5[_0x4a947a][_0xd33d84(0x288)]+_0x3483c5[_0x4a947a]['rack']+_0x3483c5[_0x4a947a][_0xd33d84(0x2b0)]+_0x3483c5[_0x4a947a][_0xd33d84(0x2d4)]+_0x3483c5[_0x4a947a]['type'][0x0]+_0x3483c5[_0x4a947a][_0xd33d84(0x2b5)]+_0xd33d84(0x1ec),_0xd33d84(0x2bd);}let _0x49f559=nodemailer[_0xd33d84(0x2a0)]({'host':_0x141add[_0xd33d84(0x266)],'port':Number(_0x141add[_0xd33d84(0x1f8)]),'secure':![],'auth':{'user':_0x141add[_0xd33d84(0x293)],'pass':_0x141add[_0xd33d84(0x243)]}}),_0x427faf={'from':_0x141add['email'],'to':_0xffe7f2[0x0][_0xd33d84(0x20d)],'subject':_0xd33d84(0x1fa),'attachments':[{'filename':_0xd33d84(0x232),'path':__dirname+_0xd33d84(0x2ed)+_0xd33d84(0x286)+_0x53a19d[0x0]['image'],'cid':_0xd33d84(0x24e)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0xd33d84(0x2d7)+_0xd33d84(0x25a)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0xd33d84(0x2e4)+_0xd33d84(0x278)+_0xd33d84(0x25a)+_0xd33d84(0x297)+_0x53a19d[0x0][_0xd33d84(0x275)]+_0xd33d84(0x22f)+'</div>'+_0xd33d84(0x278)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0xd33d84(0x21b)+_0xd33d84(0x253)+_0x51e769[_0xd33d84(0x237)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0xd33d84(0x282)+_0x51e769['date']+'\x20'+_0xd33d84(0x22d)+_0xd33d84(0x267)+_0xd33d84(0x278)+_0xd33d84(0x204)+_0xd33d84(0x26f)+_0xd33d84(0x2c0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xd33d84(0x271)+_0xd33d84(0x20a)+_0xd33d84(0x2d9)+_0xd33d84(0x223)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0xd33d84(0x2bd)+_0xd33d84(0x273)+_0xd33d84(0x1eb)+'\x20'+_0x11efbb+'\x20'+_0xd33d84(0x24f)+'</table>'+_0xd33d84(0x25a)+_0xd33d84(0x2ac)+_0xd33d84(0x210)+_0x53a19d[0x0][_0xd33d84(0x275)]+_0xd33d84(0x267)+_0xd33d84(0x278)+_0xd33d84(0x278)+_0xd33d84(0x24a)};_0x49f559[_0xd33d84(0x212)](_0x427faf,function(_0x56439b,_0x2bdfac){var _0xf8e484=_0xd33d84;_0x56439b?(console[_0xf8e484(0x23f)](_0x56439b),console[_0xf8e484(0x23f)](_0xf8e484(0x230))):console[_0xf8e484(0x23f)]('Email\x20sent\x20successfully');}),_0x5c4104[_0xd33d84(0x219)](_0xd33d84(0x2fd),_0xd33d84(0x21a)),_0x3a6d73[_0xd33d84(0x2c4)](_0xd33d84(0x2c2)+_0x2dae22);}catch(_0xb235e1){console[_0xd33d84(0x2a8)](_0xb235e1),_0x3a6d73[_0xd33d84(0x2ec)](0x1f4)[_0xd33d84(0x262)]({'error':_0xd33d84(0x222)});}})[_0x510d88(0x217)](_0x1a2952=>{var _0x1b4f8c=_0x510d88;console[_0x1b4f8c(0x2a8)](_0x1a2952),_0x3a6d73[_0x1b4f8c(0x2ec)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x30d76d){console[_0x510d88(0x23f)](_0x30d76d);}}),router[a0_0x168650(0x29a)]('/view/:id',auth,async(_0x4a6a6a,_0x18ae82)=>{var _0x55da60=a0_0x168650;try{const {username:_0x1ff1a4,email:_0x171218,role:_0x1378f5}=_0x4a6a6a[_0x55da60(0x22b)],_0x403ce1=_0x4a6a6a['user'],_0x2b315f=await profile[_0x55da60(0x25f)]({'email':_0x403ce1[_0x55da60(0x293)]}),_0x180192=await master_shop[_0x55da60(0x233)](),_0x46f524=_0x4a6a6a[_0x55da60(0x277)]['id'],_0x1a3021=await sales[_0x55da60(0x221)](_0x46f524);var _0x3eb107=['Ambient','Enclosed'];const _0x3057f1=await warehouse[_0x55da60(0x1fb)]([{'$match':{'name':_0x1a3021[_0x55da60(0x2cf)],'warehouse_category':_0x55da60(0x23c)}},{'$unwind':_0x55da60(0x26e)},{'$group':{'_id':_0x55da60(0x2df),'name':{'$first':_0x55da60(0x280)},'product_stock':{'$first':_0x55da60(0x276)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x55da60(0x295)},'type':{'$first':_0x55da60(0x2c1)},'floorlevel':{'$first':_0x55da60(0x2e9)},'primary_code':{'$first':_0x55da60(0x2c8)},'secondary_code':{'$first':_0x55da60(0x220)},'product_code':{'$first':_0x55da60(0x28a)},'storage':{'$first':_0x55da60(0x2a4)},'rack':{'$first':_0x55da60(0x248)}}}]),_0x264960=await customer[_0x55da60(0x233)]({});let _0x1e28db;if(_0x403ce1[_0x55da60(0x24b)]==_0x55da60(0x28f)){const _0x20786f=await staff[_0x55da60(0x25f)]({'email':_0x403ce1[_0x55da60(0x293)]});_0x1e28db=await warehouse[_0x55da60(0x1fb)]([{'$match':{'status':'Enabled','name':_0x20786f[_0x55da60(0x290)],'warehouse_category':_0x55da60(0x23c)}},{'$group':{'_id':_0x55da60(0x2fe),'name':{'$first':_0x55da60(0x2fe)}}}]);}else _0x1e28db=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x55da60(0x23c)}},{'$group':{'_id':_0x55da60(0x2fe),'name':{'$first':_0x55da60(0x2fe)}}}]);const _0x3de99d=await product['find']({});if(_0x180192[0x0][_0x55da60(0x247)]==_0x55da60(0x252)){var _0x33d345=users[_0x55da60(0x2b7)];console[_0x55da60(0x23f)](_0x33d345);}else{if(_0x180192[0x0][_0x55da60(0x247)]==_0x55da60(0x201))var _0x33d345=users[_0x55da60(0x201)];else{if(_0x180192[0x0]['language']=='German')var _0x33d345=users[_0x55da60(0x20f)];else{if(_0x180192[0x0][_0x55da60(0x247)]==_0x55da60(0x264))var _0x33d345=users[_0x55da60(0x264)];else{if(_0x180192[0x0]['language']==_0x55da60(0x2f7))var _0x33d345=users[_0x55da60(0x2f7)];else{if(_0x180192[0x0][_0x55da60(0x247)]=='Portuguese\x20(BR)')var _0x33d345=users['Portuguese'];else{if(_0x180192[0x0]['language']=='Chinese')var _0x33d345=users['Chinese'];else{if(_0x180192[0x0][_0x55da60(0x247)]==_0x55da60(0x2bc))var _0x33d345=users[_0x55da60(0x250)];}}}}}}}_0x18ae82[_0x55da60(0x2cd)]('edit_sales',{'success':_0x4a6a6a[_0x55da60(0x219)]('success'),'errors':_0x4a6a6a['flash']('errors'),'role':_0x403ce1,'profile':_0x2b315f,'customer':_0x264960,'warehouse':_0x1e28db,'product':_0x3057f1,'user':_0x1a3021,'master_shop':_0x180192,'unit':_0x3de99d,'language':_0x33d345});}catch(_0x2fcc15){console[_0x55da60(0x23f)](_0x2fcc15);}}),router[a0_0x168650(0x2fb)](a0_0x168650(0x2e5),auth,async(_0x56279e,_0x41a354)=>{var _0x415252=a0_0x168650;try{const _0xa6b01c=_0x56279e[_0x415252(0x277)]['id'],_0xda68df=await sales['findOne']({'_id':_0x56279e['params']['id']}),_0x36a00e=await warehouse[_0x415252(0x25f)]({'name':_0xda68df[_0x415252(0x2cf)],'room':_0x56279e[_0x415252(0x291)][_0x415252(0x2ab)]}),{invoice:_0x1ba899,date:_0xc5213b,warehouse_name:_0x4a2be3,product_name:_0x23ac64,stock:_0x3b5c50,quantity:_0xf3b257,note:_0x107854,room:_0x344d45,customer:_0x3952ef,SCRN:_0x34e25e}=_0x56279e[_0x415252(0x291)];if(typeof _0x23ac64==_0x415252(0x2ba))var _0x585249=[_0x56279e['body']['product_name']],_0x36e15b=[_0x56279e[_0x415252(0x291)][_0x415252(0x1f2)]],_0x19924a=[_0x56279e[_0x415252(0x291)]['carton']],_0x272791=[_0x56279e['body'][_0x415252(0x2f3)]],_0x2844d3=[_0x56279e[_0x415252(0x291)][_0x415252(0x258)]],_0x2c7c58=[_0x56279e['body'][_0x415252(0x26a)]],_0x3cf065=[_0x56279e[_0x415252(0x291)][_0x415252(0x208)]],_0x3c872c=[_0x56279e[_0x415252(0x291)][_0x415252(0x2de)]],_0x3291bb=[_0x56279e[_0x415252(0x291)][_0x415252(0x287)]],_0x31fe7f=[_0x56279e['body'][_0x415252(0x272)]],_0x5ee3f9=[_0x56279e['body'][_0x415252(0x22a)]],_0x12ec73=[_0x56279e[_0x415252(0x291)][_0x415252(0x2cb)]],_0xdeb240=[_0x56279e[_0x415252(0x291)]['production_date']],_0x565d55=[_0x56279e[_0x415252(0x291)][_0x415252(0x259)]],_0x20edba=[_0x56279e[_0x415252(0x291)][_0x415252(0x245)]],_0x1a3473=[_0x56279e[_0x415252(0x291)][_0x415252(0x238)]],_0x1b744c=[_0x56279e[_0x415252(0x291)][_0x415252(0x2d5)]],_0x404ed4=[_0x56279e[_0x415252(0x291)]['quantity']],_0x1d56c0=[_0x56279e[_0x415252(0x291)]['RoomAssigned']];else var _0x585249=[..._0x56279e[_0x415252(0x291)][_0x415252(0x2c9)]],_0x36e15b=[..._0x56279e[_0x415252(0x291)][_0x415252(0x1f2)]],_0x19924a=[..._0x56279e['body'][_0x415252(0x28b)]],_0x272791=[..._0x56279e[_0x415252(0x291)][_0x415252(0x2f3)]],_0x2844d3=[..._0x56279e[_0x415252(0x291)][_0x415252(0x258)]],_0x2c7c58=[..._0x56279e['body']['prod_code']],_0x3cf065=[..._0x56279e[_0x415252(0x291)]['level']],_0x3c872c=[..._0x56279e['body']['primary_unit']],_0x3291bb=[..._0x56279e[_0x415252(0x291)][_0x415252(0x287)]],_0x31fe7f=[..._0x56279e[_0x415252(0x291)]['batch_code']],_0x5ee3f9=[..._0x56279e[_0x415252(0x291)][_0x415252(0x22a)]],_0x12ec73=[..._0x56279e[_0x415252(0x291)][_0x415252(0x2cb)]],_0xdeb240=[..._0x56279e[_0x415252(0x291)][_0x415252(0x21d)]],_0x565d55=[..._0x56279e[_0x415252(0x291)][_0x415252(0x259)]],_0x20edba=[..._0x56279e['body'][_0x415252(0x245)]],_0x1a3473=[..._0x56279e['body'][_0x415252(0x238)]],_0x1b744c=[..._0x56279e[_0x415252(0x291)][_0x415252(0x2d5)]],_0x404ed4=[..._0x56279e['body'][_0x415252(0x2e0)]],_0x1d56c0=[..._0x56279e[_0x415252(0x291)][_0x415252(0x265)]];const _0x5ae17e=_0x585249[_0x415252(0x2b8)](_0x15cc25=>{return _0x15cc25={'product_name':_0x15cc25};});_0x36e15b[_0x415252(0x269)]((_0x48ce6d,_0x2881c1)=>{var _0x334516=_0x415252;_0x5ae17e[_0x2881c1][_0x334516(0x1f2)]=Math[_0x334516(0x2e8)](_0x48ce6d);}),_0x19924a[_0x415252(0x269)]((_0x4d5deb,_0x38ccef)=>{var _0x410aab=_0x415252;_0x5ae17e[_0x38ccef][_0x410aab(0x2e0)]=_0x4d5deb;}),_0x272791[_0x415252(0x269)]((_0xe6686d,_0x531849)=>{var _0x455ffd=_0x415252;_0x5ae17e[_0x531849][_0x455ffd(0x2f3)]=_0xe6686d;}),_0x2844d3['forEach']((_0x1e96d5,_0x50de4a)=>{var _0x2e03ef=_0x415252;_0x5ae17e[_0x50de4a][_0x2e03ef(0x258)]=_0x1e96d5;}),_0x2c7c58[_0x415252(0x269)]((_0x45f8b0,_0x3de5f2)=>{var _0x421891=_0x415252;_0x5ae17e[_0x3de5f2][_0x421891(0x234)]=_0x45f8b0;}),_0x3cf065['forEach']((_0x4b4b1d,_0x48be22)=>{_0x1d56c0['forEach']((_0x262d43,_0x52c4ed)=>{var _0x283303=a0_0x1166;if(_0x262d43=='Receiving\x20Area'&&_0x48be22==_0x52c4ed){var _0x2a207c=_0x4b4b1d[_0x283303(0x2ad)](0x3);_0x5ae17e[_0x48be22]['storage']=_0x4b4b1d[0x0],_0x5ae17e[_0x48be22][_0x283303(0x240)]=_0x4b4b1d[0x1],_0x5ae17e[_0x48be22][_0x283303(0x2b0)]=0x0,_0x5ae17e[_0x48be22]['bin']=0x0,_0x5ae17e[_0x48be22][_0x283303(0x215)]='Floor',_0x5ae17e[_0x48be22][_0x283303(0x2b5)]=_0x2a207c;}else{if(_0x262d43==_0x283303(0x23b)&&_0x48be22==_0x52c4ed){var _0x2a207c=_0x4b4b1d[_0x283303(0x2ad)](0x3);_0x5ae17e[_0x48be22][_0x283303(0x288)]=_0x4b4b1d[0x0],_0x5ae17e[_0x48be22]['rack']=_0x4b4b1d[0x1],_0x5ae17e[_0x48be22][_0x283303(0x2b0)]=0x0,_0x5ae17e[_0x48be22]['bin']=0x0,_0x5ae17e[_0x48be22]['type']=_0x283303(0x1ed),_0x5ae17e[_0x48be22][_0x283303(0x2b5)]=_0x4b4b1d[0x5];}else{if(_0x48be22==_0x52c4ed){var _0x24b965;if(_0x4b4b1d[0x4]=='L')_0x24b965=_0x283303(0x23a);else _0x4b4b1d[0x4]=='F'&&(_0x24b965=_0x283303(0x1ed));_0x5ae17e[_0x48be22][_0x283303(0x288)]=_0x4b4b1d[0x0],_0x5ae17e[_0x48be22]['rack']=_0x4b4b1d[0x1],_0x5ae17e[_0x48be22][_0x283303(0x2b0)]=_0x4b4b1d[0x2],_0x5ae17e[_0x48be22][_0x283303(0x2d4)]=_0x4b4b1d[0x3],_0x5ae17e[_0x48be22][_0x283303(0x215)]=_0x24b965,_0x5ae17e[_0x48be22]['floorlevel']=_0x4b4b1d[0x5];}}}});}),_0x3c872c[_0x415252(0x269)]((_0x5c61bf,_0x142cdc)=>{var _0x75325f=_0x415252;_0x5ae17e[_0x142cdc][_0x75325f(0x22e)]=_0x5c61bf;}),_0x3291bb[_0x415252(0x269)]((_0x293765,_0x16da1a)=>{_0x5ae17e[_0x16da1a]['secondary_unit']=_0x293765;}),_0x31fe7f[_0x415252(0x269)]((_0x130ec5,_0x1684ca)=>{var _0x3017c2=_0x415252;_0x5ae17e[_0x1684ca][_0x3017c2(0x272)]=_0x130ec5;}),_0x5ee3f9[_0x415252(0x269)]((_0x3019c4,_0x50079d)=>{_0x5ae17e[_0x50079d]['expiry_date']=_0x3019c4;}),_0x12ec73['forEach']((_0x1fe2c3,_0x303aa6)=>{var _0x322df9=_0x415252;_0x5ae17e[_0x303aa6][_0x322df9(0x1ef)]=_0x1fe2c3;}),_0xdeb240['forEach']((_0x59db83,_0x45bc8f)=>{var _0x21a772=_0x415252;_0x5ae17e[_0x45bc8f][_0x21a772(0x21d)]=_0x59db83;}),_0x565d55[_0x415252(0x269)]((_0x4ffdb4,_0x50d74d)=>{var _0x2acb7e=_0x415252;_0x5ae17e[_0x50d74d][_0x2acb7e(0x259)]=Math[_0x2acb7e(0x2e8)](_0x4ffdb4);}),_0x20edba[_0x415252(0x269)]((_0x3d95ac,_0x4625ba)=>{var _0x4c4541=_0x415252;_0x5ae17e[_0x4625ba][_0x4c4541(0x245)]=_0x3d95ac;}),_0x1a3473[_0x415252(0x269)]((_0x1f3bbc,_0x4a2b4c)=>{var _0x48309c=_0x415252;_0x5ae17e[_0x4a2b4c][_0x48309c(0x238)]=_0x1f3bbc;}),_0x1b744c[_0x415252(0x269)]((_0x17f843,_0x13e280)=>{var _0x1dd847=_0x415252;_0x5ae17e[_0x13e280][_0x1dd847(0x2d5)]=_0x17f843;}),_0x404ed4[_0x415252(0x269)]((_0x1c9b8d,_0x57ca39)=>{var _0x34d2f9=_0x415252;_0x5ae17e[_0x57ca39][_0x34d2f9(0x1ea)]=_0x1c9b8d;}),_0x1d56c0[_0x415252(0x269)]((_0x2f0625,_0x3b4424)=>{_0x5ae17e[_0x3b4424]['room_name']=_0x2f0625;});var _0x147f2c=0x0;_0x5ae17e[_0x415252(0x269)](_0x3107a3=>{var _0x2ff916=_0x415252;console['log'](_0x2ff916(0x279),_0x3107a3),(parseInt(_0x3107a3[_0x2ff916(0x1f2)])<parseInt(_0x3107a3[_0x2ff916(0x2e0)])||parseInt(_0x3107a3['quantity'])==0x0)&&_0x147f2c++;});if(_0x147f2c!=0x0)return _0x56279e[_0x415252(0x219)](_0x415252(0x209),_0x415252(0x246)),_0x41a354[_0x415252(0x2c4)](_0x415252(0x207));const _0x44e114=_0x5ae17e[_0x415252(0x256)](_0x20ee6b=>_0x20ee6b['quantity']!=='0'&&_0x20ee6b['quantity']!=='');_0xda68df['invoice']=_0x1ba899,_0xda68df[_0x415252(0x29d)]=_0x3952ef,_0xda68df[_0x415252(0x229)]=_0xc5213b,_0xda68df[_0x415252(0x2cf)]=_0x4a2be3,_0xda68df['sale_product']=_0x44e114,_0xda68df['note']=_0x107854,_0xda68df[_0x415252(0x2ea)]=_0x34e25e,_0xda68df[_0x415252(0x2f5)]='False',_0xda68df[_0x415252(0x225)]=_0x415252(0x299);const _0xdde83=await _0xda68df[_0x415252(0x2e1)]();_0x56279e['flash'](_0x415252(0x2fd),'Sales\x20Update\x20successfully'),_0x41a354['redirect'](_0x415252(0x2e3));}catch(_0x4171e1){console['log'](_0x4171e1);}}),router['post'](a0_0x168650(0x292),auth,async(_0x3bc32c,_0x231f10)=>{var _0x49c087=a0_0x168650;try{const _0x5265e9=_0x3bc32c[_0x49c087(0x277)]['id'],{invoice:_0x10495d,customer:_0x55d3e2,receivable_amount:_0xc0bb46,received_amount:_0x2d8a71}=_0x3bc32c['body'],_0x138010=await sales[_0x49c087(0x221)](_0x5265e9);console['log'](_0x138010);var _0x19fad8=_0xc0bb46-_0x2d8a71;console[_0x49c087(0x23f)](_0x2d8a71),_0x138010['received_amount']=parseFloat(_0x2d8a71)+parseFloat(_0x138010[_0x49c087(0x2da)]),_0x138010['due_amount']=_0x19fad8,console[_0x49c087(0x23f)](_0x138010);const _0x4fc7ae=await _0x138010['save'](),_0xc0d319=await c_payment_data[_0x49c087(0x25f)]({'invoice':_0x10495d});_0xc0d319[_0x49c087(0x260)]=_0x19fad8,await _0xc0d319['save']();let _0x383dd9=new Date(),_0x5a9a07=('0'+_0x383dd9[_0x49c087(0x2db)]())[_0x49c087(0x2ad)](-0x2),_0x15e29e=('0'+(_0x383dd9[_0x49c087(0x1f5)]()+0x1))[_0x49c087(0x2ad)](-0x2),_0xa8da16=_0x383dd9['getFullYear'](),_0x2dc288=_0xa8da16+'-'+_0x15e29e+'-'+_0x5a9a07;const _0x201fcd=new customer_payment({'invoice':_0x10495d,'date':_0xa8da16+'-'+_0x15e29e+'-'+_0x5a9a07,'customer':_0x55d3e2,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x2d8a71}),_0x38c12b=await _0x201fcd['save']();_0x3bc32c[_0x49c087(0x219)](_0x49c087(0x2fd),_0x49c087(0x29b)),_0x231f10[_0x49c087(0x2c4)](_0x49c087(0x2e3));}catch(_0x437a49){console[_0x49c087(0x23f)](_0x437a49);}}),router[a0_0x168650(0x29a)](a0_0x168650(0x25e),auth,async(_0x2c542b,_0x32d8e6)=>{var _0x4e060c=a0_0x168650;try{const {username:_0xf0888e,email:_0x4af4a7,role:_0x202395}=_0x2c542b[_0x4e060c(0x22b)],_0x2462ba=_0x2c542b[_0x4e060c(0x22b)],_0x294105=await profile[_0x4e060c(0x25f)]({'email':_0x2462ba['email']}),_0x5472cb=await master_shop[_0x4e060c(0x233)]();console['log'](_0x4e060c(0x2b9),_0x5472cb);const _0x5ee433=_0x2c542b[_0x4e060c(0x277)]['id'],_0x368bc1=await sales[_0x4e060c(0x221)](_0x5ee433);console[_0x4e060c(0x23f)](_0x368bc1);const _0x360797=await customer[_0x4e060c(0x25f)]({'name':_0x368bc1[_0x4e060c(0x29d)]});console[_0x4e060c(0x23f)](_0x360797);if(_0x5472cb[0x0][_0x4e060c(0x247)]=='English\x20(US)'){var _0x524289=users[_0x4e060c(0x2b7)];console[_0x4e060c(0x23f)](_0x524289);}else{if(_0x5472cb[0x0][_0x4e060c(0x247)]==_0x4e060c(0x201))var _0x524289=users[_0x4e060c(0x201)];else{if(_0x5472cb[0x0][_0x4e060c(0x247)]==_0x4e060c(0x20f))var _0x524289=users['German'];else{if(_0x5472cb[0x0][_0x4e060c(0x247)]==_0x4e060c(0x264))var _0x524289=users[_0x4e060c(0x264)];else{if(_0x5472cb[0x0]['language']=='French')var _0x524289=users[_0x4e060c(0x2f7)];else{if(_0x5472cb[0x0][_0x4e060c(0x247)]=='Portuguese\x20(BR)')var _0x524289=users['Portuguese'];else{if(_0x5472cb[0x0]['language']==_0x4e060c(0x2af))var _0x524289=users[_0x4e060c(0x2af)];else{if(_0x5472cb[0x0][_0x4e060c(0x247)]=='Arabic\x20(ae)')var _0x524289=users[_0x4e060c(0x250)];}}}}}}}_0x32d8e6[_0x4e060c(0x2cd)]('sales_invoice',{'success':_0x2c542b[_0x4e060c(0x219)](_0x4e060c(0x2fd)),'errors':_0x2c542b[_0x4e060c(0x219)]('errors'),'role':_0x2462ba,'profile':_0x294105,'master_shop':_0x5472cb,'customers':_0x360797,'sales':_0x368bc1,'language':_0x524289});}catch(_0x2880bb){console[_0x4e060c(0x23f)](_0x2880bb);}}),router[a0_0x168650(0x29a)](a0_0x168650(0x20c),auth,async(_0x38a71d,_0x216a13)=>{var _0xfb60d6=a0_0x168650;try{const {username:_0x572d2d,email:_0x5d542d,role:_0x17ab40}=_0x38a71d[_0xfb60d6(0x22b)],_0x3df40a=_0x38a71d[_0xfb60d6(0x22b)],_0x4f6818=await profile['findOne']({'email':_0x3df40a['email']}),_0x20150c=await master_shop['find']();console[_0xfb60d6(0x23f)](_0xfb60d6(0x2b9),_0x20150c);const _0x585704=_0x38a71d[_0xfb60d6(0x277)]['id'];console[_0xfb60d6(0x23f)](_0x585704);const _0x1aff10=await sales['findById'](_0x585704);console[_0xfb60d6(0x23f)]('user_id',_0x1aff10);const _0x32c03c=await warehouse[_0xfb60d6(0x1fb)]([{'$match':{'name':_0xfb60d6(0x2c6),'room':'Return\x20Rooms'}},{'$unwind':_0xfb60d6(0x26e)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xfb60d6(0x276)},'level':{'$first':_0xfb60d6(0x206)},'isle':{'$first':_0xfb60d6(0x274)},'pallet':{'$first':_0xfb60d6(0x2f8)},'primary_code':{'$first':_0xfb60d6(0x2c8)},'secondary_code':{'$first':_0xfb60d6(0x220)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0xfb60d6(0x23f)]('stock_data',_0x32c03c);const _0x33d42b=await product['find']({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0xfb60d6(0x26d),'name':_0xfb60d6(0x2c6),'warehouse_category':_0xfb60d6(0x23c)}},{'$group':{'_id':'$name','name':{'$first':_0xfb60d6(0x2fe)}}},{'$sort':{'name':0x1}}]);var _0x525a5b=[_0xfb60d6(0x1fd)];if(_0x20150c[0x0]['language']==_0xfb60d6(0x252)){var _0x7465aa=users['English'];console[_0xfb60d6(0x23f)](_0x7465aa);}else{if(_0x20150c[0x0][_0xfb60d6(0x247)]=='Hindi')var _0x7465aa=users[_0xfb60d6(0x201)];else{if(_0x20150c[0x0][_0xfb60d6(0x247)]=='German')var _0x7465aa=users['German'];else{if(_0x20150c[0x0][_0xfb60d6(0x247)]==_0xfb60d6(0x264))var _0x7465aa=users[_0xfb60d6(0x264)];else{if(_0x20150c[0x0][_0xfb60d6(0x247)]=='French')var _0x7465aa=users[_0xfb60d6(0x2f7)];else{if(_0x20150c[0x0][_0xfb60d6(0x247)]=='Portuguese\x20(BR)')var _0x7465aa=users[_0xfb60d6(0x2bb)];else{if(_0x20150c[0x0][_0xfb60d6(0x247)]==_0xfb60d6(0x2af))var _0x7465aa=users['Chinese'];else{if(_0x20150c[0x0][_0xfb60d6(0x247)]==_0xfb60d6(0x2bc))var _0x7465aa=users[_0xfb60d6(0x250)];}}}}}}}_0x216a13['render'](_0xfb60d6(0x2eb),{'success':_0x38a71d[_0xfb60d6(0x219)](_0xfb60d6(0x2fd)),'errors':_0x38a71d[_0xfb60d6(0x219)](_0xfb60d6(0x209)),'role':_0x3df40a,'profile':_0x4f6818,'user':_0x1aff10,'stock':_0x32c03c,'master_shop':_0x20150c,'unit':_0x33d42b,'language':_0x7465aa,'warehouses':warehouse_data,'rooms':_0x525a5b});}catch(_0x419f94){console['log'](_0x419f94),_0x216a13['status'](0xc8)[_0xfb60d6(0x262)]({'message':_0x419f94[_0xfb60d6(0x241)]});}}),router['post'](a0_0x168650(0x20c),auth,async(_0x1d5fc8,_0x6cde80)=>{var _0x5e7698=a0_0x168650;try{const {invoice:_0x4ef352,date:_0x4f40f7,warehouse_name:_0x25319f,product_name:_0x2fbc65,primary_code:_0x1a9b83,secondary_code:_0x2ed75f,product_code:_0x58db62,sales_quantity:_0x22ceaf,stocks:_0xfdb868,return_qty:_0x1c1895,Room_name:_0x218d5f,to_warehouse_name:_0x2eef87,to_Roomname:_0xae049d,to_Room_name:_0x563a35,note:_0x191b55,level:_0x37f237,isle:_0x3990c8,pallet:_0x707ca3}=_0x1d5fc8['body'];if(typeof _0x2fbc65==_0x5e7698(0x2ba))var _0x184967=[_0x1d5fc8[_0x5e7698(0x291)]['product_name']],_0xbf3c33=[_0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x2f3)]],_0x259bd8=[_0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x258)]],_0x16a810=[_0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x234)]],_0x2edbc0=[_0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x2be)]],_0x4f5a28=[_0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x227)]],_0x19a762=[_0x1d5fc8['body'][_0x5e7698(0x2b4)]],_0x4a221b=[_0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x2b0)]],_0xb6f2f=[_0x1d5fc8[_0x5e7698(0x291)]['bin']],_0x5147da=[_0x1d5fc8['body'][_0x5e7698(0x236)]],_0x2628dd=[_0x1d5fc8['body'][_0x5e7698(0x2b5)]];else var _0x184967=[..._0x1d5fc8[_0x5e7698(0x291)]['product_name']],_0xbf3c33=[..._0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x2f3)]],_0x259bd8=[..._0x1d5fc8['body'][_0x5e7698(0x258)]],_0x16a810=[..._0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x234)]],_0x2edbc0=[..._0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x2be)]],_0x4f5a28=[..._0x1d5fc8[_0x5e7698(0x291)]['stocks']],_0x19a762=[..._0x1d5fc8['body']['return_qty']],_0x4a221b=[..._0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x2b0)]],_0xb6f2f=[..._0x1d5fc8['body'][_0x5e7698(0x2d4)]],_0x5147da=[..._0x1d5fc8[_0x5e7698(0x291)]['types']],_0x2628dd=[..._0x1d5fc8[_0x5e7698(0x291)][_0x5e7698(0x2b5)]];const _0x5bde4f=_0x184967['map'](_0x4c2bbc=>{return _0x4c2bbc={'product_name':_0x4c2bbc};});_0xbf3c33[_0x5e7698(0x269)]((_0x4c649f,_0x4d4ea1)=>{var _0x128db0=_0x5e7698;_0x5bde4f[_0x4d4ea1][_0x128db0(0x2f3)]=_0x4c649f;}),_0x259bd8[_0x5e7698(0x269)]((_0x325c68,_0x1fd54e)=>{var _0x14753d=_0x5e7698;_0x5bde4f[_0x1fd54e][_0x14753d(0x258)]=_0x325c68;}),_0x16a810['forEach']((_0x1bc2ec,_0x11696b)=>{var _0x2853aa=_0x5e7698;_0x5bde4f[_0x11696b][_0x2853aa(0x234)]=_0x1bc2ec;}),_0x2edbc0[_0x5e7698(0x269)]((_0x1c85c7,_0x2f7f20)=>{var _0x276af9=_0x5e7698;_0x5bde4f[_0x2f7f20][_0x276af9(0x235)]=_0x1c85c7;}),_0x4f5a28['forEach']((_0x51cf11,_0xd507ff)=>{var _0x395af4=_0x5e7698;_0x5bde4f[_0xd507ff][_0x395af4(0x1f2)]=_0x51cf11;}),_0x19a762[_0x5e7698(0x269)]((_0x5ed23c,_0x3fd29f)=>{var _0x5c5509=_0x5e7698;_0x5bde4f[_0x3fd29f][_0x5c5509(0x2b4)]=_0x5ed23c;}),_0x4a221b['forEach']((_0x4d287f,_0x8d92b3)=>{_0x5bde4f[_0x8d92b3]['bay']=_0x4d287f;}),_0xb6f2f[_0x5e7698(0x269)]((_0x1d6a42,_0xed1844)=>{var _0x5586a6=_0x5e7698;_0x5bde4f[_0xed1844][_0x5586a6(0x2d4)]=_0x1d6a42;}),_0x5147da[_0x5e7698(0x269)]((_0x132896,_0x1ebf84)=>{var _0x3f5c4d=_0x5e7698;_0x5bde4f[_0x1ebf84][_0x3f5c4d(0x215)]=_0x132896;}),_0x2628dd[_0x5e7698(0x269)]((_0x30f221,_0x150136)=>{var _0x28bf32=_0x5e7698;_0x5bde4f[_0x150136][_0x28bf32(0x2b5)]=_0x30f221;});var _0x5a3ea0=0x0;_0x5bde4f['forEach'](_0x15b2e5=>{var _0x63d769=_0x5e7698;console[_0x63d769(0x23f)](_0x63d769(0x279),_0x15b2e5),(parseInt(_0x15b2e5[_0x63d769(0x235)])<parseInt(_0x15b2e5[_0x63d769(0x2b4)])||parseInt(_0x15b2e5[_0x63d769(0x1f2)])<parseInt(_0x15b2e5[_0x63d769(0x2b4)])&&parseInt(_0x15b2e5[_0x63d769(0x235)])>parseInt(_0x15b2e5[_0x63d769(0x2b4)])||parseInt(_0x15b2e5[_0x63d769(0x2b4)])==0x0)&&_0x5a3ea0++;});if(_0x5a3ea0!=0x0)return _0x1d5fc8[_0x5e7698(0x219)](_0x5e7698(0x209),_0x5e7698(0x254)),_0x6cde80[_0x5e7698(0x2c4)]('back');const _0x508a07=await sales[_0x5e7698(0x25f)]({'invoice':_0x4ef352});console[_0x5e7698(0x23f)](_0x508a07),_0x508a07['return_data']=_0x5e7698(0x1f3);const _0x20b8fd=await _0x508a07[_0x5e7698(0x2e1)](),_0x2dfdb7=new sales_return({'invoice':_0x4ef352,'customer':_0x1d5fc8['body'][_0x5e7698(0x29d)],'date':_0x4f40f7,'warehouse_name':_0x25319f,'room':_0x218d5f,'ToWarehouse':_0x2eef87,'ToRoom':_0x563a35,'return_sale':_0x5bde4f,'note':_0x191b55}),_0x37be50=await _0x2dfdb7[_0x5e7698(0x2e1)]();console['log'](_0x2dfdb7);const _0x587ef5=await sales_return[_0x5e7698(0x25f)]({'invoice':_0x4ef352}),_0x1d693b=await warehouse[_0x5e7698(0x25f)]({'name':_0x2eef87,'room':_0x563a35});_0x587ef5['return_sale'][_0x5e7698(0x269)](_0x524935=>{var _0x2b3bf0=_0x5e7698,_0x1c1bc2=0x0;const _0x2256e0=_0x1d693b[_0x2b3bf0(0x2a3)]['map'](_0x54fdcf=>{var _0x40d82f=_0x2b3bf0;_0x54fdcf[_0x40d82f(0x2c9)]==_0x524935[_0x40d82f(0x2c9)]&&_0x54fdcf[_0x40d82f(0x2b5)]==_0x524935['floorlevel']&&_0x54fdcf['type']==_0x524935[_0x40d82f(0x215)]&&_0x54fdcf[_0x40d82f(0x2d4)]==_0x524935[_0x40d82f(0x2d4)]&&_0x54fdcf[_0x40d82f(0x2b0)]==_0x524935[_0x40d82f(0x2b0)]&&(_0x54fdcf[_0x40d82f(0x2b2)]=parseInt(_0x54fdcf['product_stock'])+parseInt(_0x524935['return_qty']),_0x1c1bc2++);});_0x1c1bc2=='0'&&(_0x1d693b[_0x2b3bf0(0x2a3)]=_0x1d693b[_0x2b3bf0(0x2a3)][_0x2b3bf0(0x2e2)]({'product_name':_0x524935[_0x2b3bf0(0x2c9)],'product_stock':_0x524935[_0x2b3bf0(0x2b4)],'primary_code':_0x524935[_0x2b3bf0(0x2f3)],'secondary_code':_0x524935['secondary_code'],'product_code':_0x524935['product_code'],'bay':_0x524935[_0x2b3bf0(0x2b0)],'bin':_0x524935[_0x2b3bf0(0x2d4)],'type':_0x524935['type'],'floorlevel':_0x524935['floorlevel']})),console[_0x2b3bf0(0x23f)](_0x2b3bf0(0x2e7),_0x1d693b);}),await _0x1d693b[_0x5e7698(0x2e1)](),console[_0x5e7698(0x23f)](_0x1d5fc8[_0x5e7698(0x291)]);const _0x3b590e=new c_payment_data({'invoice':_0x4ef352,'customer':_0x1d5fc8[_0x5e7698(0x291)]['customer'],'reason':_0x5e7698(0x294)});await _0x3b590e[_0x5e7698(0x2e1)]();const _0x10c3ba=await master_shop[_0x5e7698(0x233)]();console['log'](_0x5e7698(0x2b6),_0x10c3ba[0x0][_0x5e7698(0x20b)]);const _0x193794=await email_settings[_0x5e7698(0x25f)](),_0xdd4324=await customer[_0x5e7698(0x25f)]({'name':_0x1d5fc8['body'][_0x5e7698(0x29d)]});console[_0x5e7698(0x23f)](_0x5e7698(0x249),_0xdd4324);_0x10c3ba[0x0]['currency_placement']==0x1?(right_currency=_0x10c3ba[0x0][_0x5e7698(0x284)],left_currency=''):(right_currency='',left_currency=_0x10c3ba[0x0][_0x5e7698(0x284)]);var _0x308ef8=_0x184967,_0x501849=_0x19a762,_0x2b2d72='',_0x10a1e4;for(_0x10a1e4 in _0x308ef8){_0x2b2d72+='<tr>'+_0x5e7698(0x2ae)+_0x308ef8[_0x10a1e4]+'</td>'+_0x5e7698(0x2ae)+_0x501849[_0x10a1e4]+_0x5e7698(0x1ec)+_0x5e7698(0x2bd);}console[_0x5e7698(0x23f)](_0x5e7698(0x261),_0x2b2d72);let _0x3503b5=nodemailer[_0x5e7698(0x2a0)]({'service':_0x5e7698(0x2e6),'auth':{'user':_0x193794[_0x5e7698(0x293)],'pass':_0x193794[_0x5e7698(0x243)]}}),_0x3b78da={'from':_0x193794[_0x5e7698(0x293)],'to':_0xdd4324[_0x5e7698(0x293)],'subject':_0x5e7698(0x1ee),'attachments':[{'filename':_0x5e7698(0x232),'path':__dirname+_0x5e7698(0x2ed)+_0x5e7698(0x286)+_0x10c3ba[0x0][_0x5e7698(0x20b)],'cid':_0x5e7698(0x24e)}],'html':_0x5e7698(0x2d8)+_0x5e7698(0x2bf)+_0x5e7698(0x2d7)+_0x5e7698(0x25a)+_0x5e7698(0x244)+'<div>'+_0x5e7698(0x2e4)+_0x5e7698(0x278)+_0x5e7698(0x25a)+_0x5e7698(0x297)+_0x10c3ba[0x0]['site_title']+'\x20</h2>'+_0x5e7698(0x278)+_0x5e7698(0x278)+_0x5e7698(0x2cc)+'<div>'+_0x5e7698(0x21b)+_0x5e7698(0x253)+_0x4ef352+'\x20'+_0x5e7698(0x2b3)+_0x5e7698(0x282)+_0x4f40f7+'\x20'+_0x5e7698(0x22d)+_0x5e7698(0x267)+_0x5e7698(0x278)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5e7698(0x26f)+_0x5e7698(0x2c0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5e7698(0x1f1)+_0x5e7698(0x28e)+_0x5e7698(0x231)+_0x5e7698(0x2bd)+_0x5e7698(0x273)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2b2d72+'\x20'+_0x5e7698(0x24f)+_0x5e7698(0x202)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x5e7698(0x210)+_0x10c3ba[0x0][_0x5e7698(0x275)]+_0x5e7698(0x267)+_0x5e7698(0x278)+_0x5e7698(0x278)+_0x5e7698(0x24a)};_0x3503b5[_0x5e7698(0x212)](_0x3b78da,function(_0xe0674c,_0x3ec528){var _0x36ae36=_0x5e7698;_0xe0674c?(console[_0x36ae36(0x23f)](_0xe0674c),console[_0x36ae36(0x23f)](_0x36ae36(0x230))):console[_0x36ae36(0x23f)](_0x36ae36(0x21c));}),_0x1d5fc8[_0x5e7698(0x219)]('success',_0x5e7698(0x2a6)),_0x6cde80[_0x5e7698(0x2c4)](_0x5e7698(0x2e3));}catch(_0x25992f){console[_0x5e7698(0x23f)](_0x25992f),_0x6cde80[_0x5e7698(0x2ec)](0xc8)[_0x5e7698(0x262)]({'message1':_0x25992f['message']});}}),router['get'](a0_0x168650(0x29f),auth,async(_0x2ec051,_0x27d3e4)=>{var _0x2a9ac5=a0_0x168650;try{const {username:_0x49542c,email:_0x4d55a0,role:_0x430801}=_0x2ec051[_0x2a9ac5(0x22b)],_0x404991=_0x2ec051[_0x2a9ac5(0x22b)],_0x1efc58=await profile[_0x2a9ac5(0x25f)]({'email':_0x404991[_0x2a9ac5(0x293)]}),_0x21917f=await master_shop[_0x2a9ac5(0x233)]();console[_0x2a9ac5(0x23f)](_0x2a9ac5(0x2d1),_0x21917f);const _0x52ac97=_0x2ec051[_0x2a9ac5(0x277)]['id'],_0x1cc571=await sales[_0x2a9ac5(0x221)](_0x52ac97);console[_0x2a9ac5(0x23f)](_0x2a9ac5(0x2f6),_0x1cc571);if(_0x21917f[0x0][_0x2a9ac5(0x247)]=='English\x20(US)')var _0x1b83ef=users[_0x2a9ac5(0x2b7)];else{if(_0x21917f[0x0][_0x2a9ac5(0x247)]==_0x2a9ac5(0x201))var _0x1b83ef=users[_0x2a9ac5(0x201)];else{if(_0x21917f[0x0][_0x2a9ac5(0x247)]=='German')var _0x1b83ef=users[_0x2a9ac5(0x20f)];else{if(_0x21917f[0x0]['language']==_0x2a9ac5(0x264))var _0x1b83ef=users[_0x2a9ac5(0x264)];else{if(_0x21917f[0x0][_0x2a9ac5(0x247)]=='French')var _0x1b83ef=users['French'];else{if(_0x21917f[0x0][_0x2a9ac5(0x247)]==_0x2a9ac5(0x2ff))var _0x1b83ef=users[_0x2a9ac5(0x2bb)];else{if(_0x21917f[0x0][_0x2a9ac5(0x247)]==_0x2a9ac5(0x2af))var _0x1b83ef=users[_0x2a9ac5(0x2af)];else{if(_0x21917f[0x0][_0x2a9ac5(0x247)]=='Arabic\x20(ae)')var _0x1b83ef=users['Arabic'];}}}}}}}_0x27d3e4[_0x2a9ac5(0x2cd)](_0x2a9ac5(0x27d),{'success':_0x2ec051[_0x2a9ac5(0x219)](_0x2a9ac5(0x2fd)),'errors':_0x2ec051[_0x2a9ac5(0x219)]('errors'),'role':_0x404991,'profile':_0x1efc58,'alldata':_0x1cc571,'master_shop':_0x21917f,'language':_0x1b83ef});}catch(_0xbef97){console[_0x2a9ac5(0x23f)](_0xbef97);}}),router[a0_0x168650(0x2fb)]('/barcode_scanner',async(_0x345b72,_0xad4f3a)=>{var _0xb184a7=a0_0x168650;const {product_code:_0xd8a2e2,warehouse_name:_0x4496fe,rooms_data:_0x66db5b,Roomslist:_0x55320b}=_0x345b72[_0xb184a7(0x291)],_0x4cbc56=_0x55320b[_0xb184a7(0x2f9)](','),_0x5e5b4a=[];async function _0x3e672b(_0x1dc00b){var _0x45e0bd=_0xb184a7;const _0x2dfe0c=await warehouse[_0x45e0bd(0x1fb)]([{'$match':{'name':_0x4496fe,'room':_0x1dc00b}},{'$unwind':_0x45e0bd(0x26e)},{'$match':{'product_details.primary_code':_0xd8a2e2}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x45e0bd(0x280)},'product_stock':{'$first':_0x45e0bd(0x276)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x45e0bd(0x28a)},'level':{'$first':_0x45e0bd(0x2ee)},'isle':{'$first':_0x45e0bd(0x295)},'type':{'$first':_0x45e0bd(0x2c1)},'pallet':{'$first':_0x45e0bd(0x2e9)},'unit':{'$first':_0x45e0bd(0x270)},'secondary_unit':{'$first':_0x45e0bd(0x2d6)},'storage':{'$first':_0x45e0bd(0x2a4)},'rack':{'$first':_0x45e0bd(0x248)},'expiry_date':{'$first':_0x45e0bd(0x2a9)},'production_date':{'$first':_0x45e0bd(0x213)},'maxPerUnit':{'$first':_0x45e0bd(0x224)},'batch_code':{'$first':_0x45e0bd(0x226)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x45e0bd(0x211)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x45e0bd(0x2b1)},'delivery_date':{'$first':_0x45e0bd(0x2dc)},'delivery_code':{'$first':_0x45e0bd(0x283)}}}]),_0x1d0e4e=await warehouse[_0x45e0bd(0x1fb)]([{'$match':{'name':_0x4496fe,'room':_0x1dc00b}},{'$unwind':_0x45e0bd(0x26e)},{'$match':{'product_details.secondary_code':_0xd8a2e2}},{'$group':{'_id':_0x45e0bd(0x2df),'name':{'$first':_0x45e0bd(0x280)},'product_stock':{'$first':_0x45e0bd(0x276)},'primary_code':{'$first':_0x45e0bd(0x2c8)},'secondary_code':{'$first':_0x45e0bd(0x220)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x45e0bd(0x295)},'type':{'$first':_0x45e0bd(0x2c1)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x45e0bd(0x270)},'secondary_unit':{'$first':_0x45e0bd(0x2d6)},'storage':{'$first':_0x45e0bd(0x2a4)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x45e0bd(0x2a9)},'production_date':{'$first':_0x45e0bd(0x213)},'maxPerUnit':{'$first':_0x45e0bd(0x224)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x45e0bd(0x25d)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x45e0bd(0x296)},'invoice':{'$first':_0x45e0bd(0x211)},'delivery_date':{'$first':_0x45e0bd(0x2dc)},'delivery_code':{'$first':_0x45e0bd(0x283)}}}]);if(_0x2dfe0c[_0x45e0bd(0x23d)]>0x0)_0x5e5b4a[_0x45e0bd(0x263)](_0x2dfe0c);else _0x1d0e4e['length']>0x0&&_0x5e5b4a[_0x45e0bd(0x263)](_0x1d0e4e);}const _0x5b7258=_0x4cbc56[_0xb184a7(0x2b8)](_0x1e418e=>_0x3e672b(_0x1e418e));await Promise['all'](_0x5b7258),_0xad4f3a[_0xb184a7(0x262)](_0x5e5b4a);}),module[a0_0x168650(0x29c)]=router;