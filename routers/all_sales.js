var a0_0x326b1a=a0_0x566c;(function(_0x3f405b,_0x5da59a){var _0x33b3a2=a0_0x566c,_0x4b7af7=_0x3f405b();while(!![]){try{var _0x4bbaa5=-parseInt(_0x33b3a2(0x295))/0x1+-parseInt(_0x33b3a2(0x22a))/0x2*(parseInt(_0x33b3a2(0x2ca))/0x3)+-parseInt(_0x33b3a2(0x263))/0x4+parseInt(_0x33b3a2(0x2ce))/0x5*(parseInt(_0x33b3a2(0x2c5))/0x6)+-parseInt(_0x33b3a2(0x2d8))/0x7+parseInt(_0x33b3a2(0x255))/0x8+parseInt(_0x33b3a2(0x1dc))/0x9;if(_0x4bbaa5===_0x5da59a)break;else _0x4b7af7['push'](_0x4b7af7['shift']());}catch(_0x54ff16){_0x4b7af7['push'](_0x4b7af7['shift']());}}}(a0_0x19db,0x4f50a));const express=require(a0_0x326b1a(0x26f)),app=express(),router=express[a0_0x326b1a(0x2b9)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x326b1a(0x216)),auth=require(a0_0x326b1a(0x2e1)),nodemailer=require('nodemailer'),users=require(a0_0x326b1a(0x232));router['get'](a0_0x326b1a(0x234),auth,async(_0x43745e,_0x2e30ef)=>{var _0x591151=a0_0x326b1a;try{const {username:_0x3c6964,email:_0x146d1d,role:_0x424ece}=_0x43745e['user'],_0x3a9d15=_0x43745e[_0x591151(0x225)],_0x3c4687=await profile[_0x591151(0x2be)]({'email':_0x3a9d15[_0x591151(0x2e4)]}),_0x56cd2a=await master_shop[_0x591151(0x281)]();let _0x150c5d;if(_0x3a9d15[_0x591151(0x24f)]==_0x591151(0x283)){const _0x4b67d7=await staff[_0x591151(0x2be)]({'email':_0x3a9d15['email']});_0x150c5d=await sales[_0x591151(0x240)]([{'$lookup':{'from':_0x591151(0x249),'localField':'customer','foreignField':_0x591151(0x2c6),'as':'customers_docs'}},{'$unwind':_0x591151(0x2c8)},{'$unwind':_0x591151(0x219)},{'$group':{'_id':_0x591151(0x215),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x591151(0x29f)},'date':{'$first':_0x591151(0x286)},'warehouse_name':{'$first':_0x591151(0x205)},'sale_product':{'$push':_0x591151(0x219)},'note':{'$first':_0x591151(0x22c)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x591151(0x2c8)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x591151(0x245)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x591151(0x241)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x591151(0x239)},'isAllowEdit':{'$first':_0x591151(0x260)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x150c5d=await sales[_0x591151(0x240)]([{'$lookup':{'from':_0x591151(0x249),'localField':_0x591151(0x1fc),'foreignField':_0x591151(0x2c6),'as':_0x591151(0x20d)}},{'$unwind':_0x591151(0x2c8)},{'$unwind':_0x591151(0x219)},{'$group':{'_id':_0x591151(0x215),'invoice':{'$first':_0x591151(0x1e0)},'customers':{'$first':_0x591151(0x29f)},'date':{'$first':_0x591151(0x286)},'warehouse_name':{'$first':_0x591151(0x205)},'sale_product':{'$push':_0x591151(0x219)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x591151(0x2c8)},'total_saleproduct_quantity':{'$sum':_0x591151(0x20f)},'level':{'$addToSet':_0x591151(0x245)},'isle':{'$addToSet':_0x591151(0x269)},'type':{'$addToSet':_0x591151(0x241)},'pallet':{'$addToSet':_0x591151(0x275)},'finalize':{'$first':_0x591151(0x239)},'isAllowEdit':{'$first':_0x591151(0x260)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x591151(0x2cd)]('sales\x20all_data',_0x150c5d);if(_0x56cd2a[0x0][_0x591151(0x25a)]==_0x591151(0x231)){var _0x443324=users['English'];console[_0x591151(0x2cd)](_0x443324);}else{if(_0x56cd2a[0x0][_0x591151(0x25a)]==_0x591151(0x235))var _0x443324=users[_0x591151(0x235)];else{if(_0x56cd2a[0x0]['language']==_0x591151(0x28d))var _0x443324=users[_0x591151(0x28d)];else{if(_0x56cd2a[0x0][_0x591151(0x25a)]==_0x591151(0x27c))var _0x443324=users[_0x591151(0x27c)];else{if(_0x56cd2a[0x0][_0x591151(0x25a)]==_0x591151(0x204))var _0x443324=users[_0x591151(0x204)];else{if(_0x56cd2a[0x0][_0x591151(0x25a)]==_0x591151(0x2b2))var _0x443324=users[_0x591151(0x22b)];else{if(_0x56cd2a[0x0][_0x591151(0x25a)]==_0x591151(0x2b0))var _0x443324=users[_0x591151(0x2b0)];else{if(_0x56cd2a[0x0][_0x591151(0x25a)]=='Arabic\x20(ae)')var _0x443324=users[_0x591151(0x2b5)];}}}}}}}_0x2e30ef['render']('all_sales',{'success':_0x43745e[_0x591151(0x1e4)](_0x591151(0x2ae)),'errors':_0x43745e[_0x591151(0x1e4)](_0x591151(0x24e)),'sales':_0x150c5d,'profile':_0x3c4687,'role':_0x3a9d15,'master_shop':_0x56cd2a,'language':_0x443324});}catch(_0x4736de){console[_0x591151(0x2cd)](_0x4736de);}});function a0_0x566c(_0x4081a8,_0x573519){var _0x19dbbe=a0_0x19db();return a0_0x566c=function(_0x566cb9,_0x54cb64){_0x566cb9=_0x566cb9-0x1db;var _0x1ba6b5=_0x19dbbe[_0x566cb9];return _0x1ba6b5;},a0_0x566c(_0x4081a8,_0x573519);}async function getRandom8DigitNumber(){var _0x161791=a0_0x326b1a;const _0x1960e1=0x989680,_0x3d84c1=0x5f5e0ff,_0x1698c0=Math['floor'](Math[_0x161791(0x256)]()*(_0x3d84c1-_0x1960e1+0x1))+_0x1960e1;var _0x32b435;const _0x2f81c9=await sales['findOne']({'invoice':_0x161791(0x22e)+_0x1698c0});return _0x2f81c9&&_0x2f81c9[_0x161791(0x236)]>0x0?_0x32b435='OUT-'+_0x1698c0:_0x32b435=_0x161791(0x22e)+_0x1698c0,_0x32b435;}function a0_0x19db(){var _0x315e36=['edit_sales','map','76qsBsUG','Portuguese','$note','Floor','OUT-','<html><head><title></title>','$product','English\x20(US)','../public/language/languages.json','room','/view','Hindi','length','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Email\x20sent\x20successfully','$finalize','/upload/','product_code','render','createTransport','$product_details.bin','user_id','aggregate','$sale_product.type','<h5\x20style=\x22text-align:\x20left;\x22>','host','$product_details.storage','$sale_product.bay','</head><body>','add\x20post','status','customers','production_date','product_data','requested_qty','</tr>','errors','role','isAllowEdit','id_transaction_from','add_sales','room_name','\x20Order\x20Number\x20:\x20','2445584KIlwle','random','batch_code','amount','/barcode_scanner','language','Enabled','\x20Order\x20Date\x20:\x20','$product_details.product_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$name','$isAllowEdit','getDate','<h5>','811372IKNWJu','warehouse_name','storage','<h2>\x20','$product_details.batch_code','$product_details.product_stock','$sale_product.bin','RoomAssigned','then','exports','return_data','bay','express','findById','redirect','prod_cat','$product_details.type','/view/add_sales/:id','$sale_product.floorlevel','</body></html>','date','$product_details.unit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','An\x20error\x20occurred.','product_details','Spanish','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Sales\x20Add\x20successfully','id_transact','maxperunit','find','There\x27s\x20a\x20error\x20in\x20this\x20transaction','staff','note','Received\x20Payment\x20For\x20Sale','$date','max','return_sale','currency','final','$product_details._id','json','German','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.bay','edit_sales_view','password','product','Error\x20Occurs','product_name','188312ZAZVqO','abs','</span>','actual_uom','forEach','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.expiry_date','site_title','$product_details','expiry_date','$customer','delivery_code','$product_details.primary_code','carton','<tbody\x20style=\x22text-align:\x20center;\x22>','rack','Enclosed','</thead>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.maxPerUnit','Return\x20Rooms','quantity','Shelves','secondary_unit','return_qty','success','slice','Chinese','getFullYear','Portuguese\x20(BR)','padStart','params','Arabic','split','$product_details.floorlevel','True','Router','stock_data','prod_invoice','stock','quantity_notConverted','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/invoice/:id','$product_details.product_name','all','</div>','filter','1274208HDMCEZ','name','customer_data','$customers_docs','/give_payment/:id','4749CZLyhs','purchases_data','<div>','log','10TlDtsM','received_amount','$product_details.product_code','sale_product','Sale\x20Return','finalize','/view/add_sales','prod_code','$product_details.isle','logo','1325219kYEYFJ','/preview/:id','Receiving\x20Area','error','invoice','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.rack','<hr\x20class=\x22my-3\x22>','message','../middleware/auth','due_amount','save','email','$product_details.pallet','primary_code','</tbody>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.secondary_code','Sale\x20Return\x20Mail','2115594ZRyOhu','barcode\x20user_id','<!DOCTYPE\x20html>','</h5>','$invoice','Arabic\x20(ae)','/all_sales/preview/','$product.product_name','flash','$product_details.production_date','sale_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','secondary_code','master','English','stocks','False','Ambient','sales_quantity','floorlevel','/view/:id','warehouse','sales_invoice','get','sales\x20item\x20return\x20successfull','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','image','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Return\x20Goods','</table>','customer','bin','<span\x20style=\x22float:\x20right;\x22>','max_per_unit','/barcode/:id','/../public','back','$product_details.invoice','French','$warehouse_name','delivery_date','catch','barcode\x20Product\x20master','Sales\x20Update\x20successfully','_id','SCRN','string','customers_docs','type','$sale_product.quantity','</td>','$product_details.actual_uom','Raw\x20Materials','\x20</h2>','post','$_id','../models/all_models','/view/return_sales/:id','/view/add_sale/product','$sale_product','unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','body','$room','<strong>\x20Regards\x20</strong>','actual_qty','/all_sales/view','Level','level','product_stock','user','foreach\x20newproduct','primary_unit'];a0_0x19db=function(){return _0x315e36;};return a0_0x19db();}router[a0_0x326b1a(0x1f3)](a0_0x326b1a(0x2d4),auth,async(_0x390828,_0x200f18)=>{var _0x1b1172=a0_0x326b1a;try{const {username:_0x289a8d,email:_0x2c8068,role:_0x4adb3a}=_0x390828[_0x1b1172(0x225)],_0x1454b4=_0x390828[_0x1b1172(0x225)],_0xf75936=await profile[_0x1b1172(0x2be)]({'email':_0x1454b4[_0x1b1172(0x2e4)]}),_0xd94458=await master_shop[_0x1b1172(0x281)](),_0x47f771=await customer[_0x1b1172(0x281)]({});let _0x300dd3;if(_0x1454b4[_0x1b1172(0x24f)]==_0x1b1172(0x283)){const _0x52b09f=await staff[_0x1b1172(0x2be)]({'email':_0x1454b4[_0x1b1172(0x2e4)]});_0x300dd3=await warehouse['aggregate']([{'$match':{'status':_0x1b1172(0x25b),'name':_0x52b09f[_0x1b1172(0x1f1)],'warehouse_category':_0x1b1172(0x212),'name':{'$ne':_0x1b1172(0x1fa)}}},{'$group':{'_id':_0x1b1172(0x25f),'name':{'$first':_0x1b1172(0x25f)}}},{'$sort':{'name':0x1}}]);}else _0x300dd3=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x1b1172(0x212),'name':{'$ne':_0x1b1172(0x1fa)}}},{'$group':{'_id':'$name','name':{'$first':_0x1b1172(0x25f)}}},{'$sort':{'name':0x1}}]);const _0x169227=await product['find']({});var _0x41922b=[_0x1b1172(0x1ed),'Enclosed'];const _0x489adf=await sales['find']({}),_0x531920=_0x489adf[_0x1b1172(0x236)]+0x1,_0x53a79e='OUT-'+_0x531920['toString']()[_0x1b1172(0x2b3)](0x5,'0');if(_0xd94458[0x0][_0x1b1172(0x25a)]=='English\x20(US)'){var _0x384be1=users['English'];console[_0x1b1172(0x2cd)](_0x384be1);}else{if(_0xd94458[0x0][_0x1b1172(0x25a)]=='Hindi')var _0x384be1=users['Hindi'];else{if(_0xd94458[0x0][_0x1b1172(0x25a)]==_0x1b1172(0x28d))var _0x384be1=users[_0x1b1172(0x28d)];else{if(_0xd94458[0x0][_0x1b1172(0x25a)]==_0x1b1172(0x27c))var _0x384be1=users['Spanish'];else{if(_0xd94458[0x0]['language']=='French')var _0x384be1=users['French'];else{if(_0xd94458[0x0][_0x1b1172(0x25a)]==_0x1b1172(0x2b2))var _0x384be1=users[_0x1b1172(0x22b)];else{if(_0xd94458[0x0][_0x1b1172(0x25a)]==_0x1b1172(0x2b0))var _0x384be1=users[_0x1b1172(0x2b0)];else{if(_0xd94458[0x0]['language']=='Arabic\x20(ae)')var _0x384be1=users['Arabic'];}}}}}}}const _0x234036=getRandom8DigitNumber();_0x234036[_0x1b1172(0x26b)](_0x2ee5f6=>{var _0x528a8c=_0x1b1172;_0x200f18[_0x528a8c(0x23c)](_0x528a8c(0x252),{'success':_0x390828['flash'](_0x528a8c(0x2ae)),'errors':_0x390828[_0x528a8c(0x1e4)](_0x528a8c(0x24e)),'role':_0x1454b4,'profile':_0xf75936,'customer':_0x47f771,'warehouse':_0x300dd3,'product':_0x169227,'invoice':_0x2ee5f6,'master_shop':_0xd94458,'language':_0x384be1,'rooms_data':_0x41922b});})[_0x1b1172(0x207)](_0x3085ca=>{var _0x186232=_0x1b1172;_0x390828[_0x186232(0x1e4)](_0x186232(0x24e),_0x186232(0x282)),_0x200f18[_0x186232(0x271)](_0x186232(0x221));});}catch(_0x21b11c){console[_0x1b1172(0x2cd)](_0x21b11c);}}),router[a0_0x326b1a(0x1f3)](a0_0x326b1a(0x274),auth,async(_0x10bc5a,_0x4d5faa)=>{var _0x179b44=a0_0x326b1a;try{const _0x4dd64b=_0x10bc5a['params']['id'];console[_0x179b44(0x2cd)](_0x4dd64b);const _0x9bbf0a=await product[_0x179b44(0x281)](),_0x3322d5=await purchases['aggregate']([{'$match':{'warehouse_name':_0x4dd64b}},{'$unwind':_0x179b44(0x230)},{'$group':{'_id':_0x179b44(0x1e3)}}]);console[_0x179b44(0x2cd)](_0x179b44(0x2cb),_0x3322d5),_0x4d5faa[_0x179b44(0x248)](0xc8)[_0x179b44(0x28c)]({'purchases_data':_0x3322d5,'product_data':_0x9bbf0a});}catch(_0x29d25c){console[_0x179b44(0x2cd)](_0x29d25c);}}),router[a0_0x326b1a(0x214)](a0_0x326b1a(0x218),auth,async(_0x2438b1,_0xb3899a)=>{var _0x2a48f2=a0_0x326b1a;try{const {warehouse_data:_0xdaa579,product_data:_0x4b613d}=_0x2438b1[_0x2a48f2(0x21d)];console['log'](_0x2438b1[_0x2a48f2(0x21d)][_0x2a48f2(0x24b)]);;const _0x31e200=await master_shop[_0x2a48f2(0x281)]();console[_0x2a48f2(0x2cd)](_0x2a48f2(0x1e9),_0x31e200);const _0x390bc3=await product['findOne']({'name':_0x4b613d});console[_0x2a48f2(0x2cd)](_0x2a48f2(0x292),_0x390bc3);const _0x52bc8a=await warehouse[_0x2a48f2(0x240)]([{'$match':{'name':_0xdaa579}},{'$unwind':_0x2a48f2(0x29d)},{'$match':{'product_details.product_name':_0x4b613d}},{'$group':{'_id':_0x2a48f2(0x2c1),'product_stock':{'$first':_0x2a48f2(0x268)}}}]);console['log'](_0x2a48f2(0x2ba),_0x52bc8a),_0xb3899a[_0x2a48f2(0x248)](0xc8)['json']({'master':_0x31e200,'new_product':_0x390bc3,'stock_data':_0x52bc8a});}catch(_0x2d3bc9){console[_0x2a48f2(0x2cd)](_0x2d3bc9);}}),router[a0_0x326b1a(0x214)]('/view/add_sales',auth,async(_0x1c32bf,_0x182c23)=>{var _0x1c9f97=a0_0x326b1a;try{const {invoice:_0x2c5518,date:_0xeb9c42,warehouse_name:_0x489918,product_name:_0x1c4573,stock:_0x3e603a,quantity:_0x31b18c,note:_0x3778ed,room:_0x4163a8,primary_code:_0x1312c6,secondary_code:_0x2686a7,prod_code:_0x5514af,level:_0x3c621f,isle:_0x397363,pallet:_0x1df1bb,batch_code:_0x272a03,SCRN:_0x50683e,expiry_date:_0x121d65}=_0x1c32bf[_0x1c9f97(0x21d)];if(typeof _0x1c4573==_0x1c9f97(0x20c))var _0x3fb6f3=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x294)]],_0xf5f027=[_0x1c32bf[_0x1c9f97(0x21d)]['stock']],_0x5aea71=[_0x1c32bf[_0x1c9f97(0x21d)]['carton']],_0x1de767=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x2e6)]],_0x38b7ac=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x1e8)]],_0xf11cc3=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x2d5)]],_0x360a99=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x223)]],_0x46e3c6=[_0x1c32bf['body'][_0x1c9f97(0x227)]],_0x557d8c=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x2ac)]],_0x1fead4=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x257)]],_0x2b0d69=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x29e)]],_0x279768=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x1ff)]],_0x557236=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x24a)]],_0x120b65=[_0x1c32bf[_0x1c9f97(0x21d)]['requested_qty']],_0x260c4c=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x206)]],_0x58fb3c=[_0x1c32bf[_0x1c9f97(0x21d)]['delivery_code']],_0x521c39=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x272)]],_0x195af0=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x2aa)]],_0x2fe2db=[_0x1c32bf[_0x1c9f97(0x21d)]['RoomAssigned']],_0x5ed68b=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x2bb)]],_0x3d7ff0=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x220)]],_0x780c45=[_0x1c32bf['body'][_0x1c9f97(0x298)]],_0x104049=[_0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x27f)]];else var _0x3fb6f3=[..._0x1c32bf['body'][_0x1c9f97(0x294)]],_0xf5f027=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x2bc)]],_0x5aea71=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x2a2)]],_0x1de767=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x2e6)]],_0x38b7ac=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x1e8)]],_0xf11cc3=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x2d5)]],_0x360a99=[..._0x1c32bf['body'][_0x1c9f97(0x223)]],_0x46e3c6=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x227)]],_0x557d8c=[..._0x1c32bf['body']['secondary_unit']],_0x1fead4=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x257)]],_0x2b0d69=[..._0x1c32bf['body']['expiry_date']],_0x279768=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x1ff)]],_0x557236=[..._0x1c32bf[_0x1c9f97(0x21d)]['production_date']],_0x120b65=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x24c)]],_0x260c4c=[..._0x1c32bf[_0x1c9f97(0x21d)]['delivery_date']],_0x58fb3c=[..._0x1c32bf[_0x1c9f97(0x21d)]['delivery_code']],_0x521c39=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x272)]],_0x195af0=[..._0x1c32bf['body'][_0x1c9f97(0x2aa)]],_0x2fe2db=[..._0x1c32bf[_0x1c9f97(0x21d)]['RoomAssigned']],_0x5ed68b=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x2bb)]],_0x3d7ff0=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x220)]],_0x780c45=[..._0x1c32bf['body'][_0x1c9f97(0x298)]],_0x104049=[..._0x1c32bf[_0x1c9f97(0x21d)][_0x1c9f97(0x27f)]];const _0x47fcdf=_0x3fb6f3['map'](_0x4ad25a=>{return _0x4ad25a={'product_name':_0x4ad25a};});_0xf5f027['forEach']((_0x38d6d5,_0x5a205b)=>{var _0x2984e8=_0x1c9f97;_0x47fcdf[_0x5a205b][_0x2984e8(0x2bc)]=Math['abs'](_0x38d6d5);}),_0x3d7ff0['forEach']((_0x5ba486,_0x1c85ea)=>{var _0x35e83c=_0x1c9f97;_0x47fcdf[_0x1c85ea][_0x35e83c(0x220)]=Math[_0x35e83c(0x296)](_0x5ba486);}),_0x780c45[_0x1c9f97(0x299)]((_0x2f7586,_0x546913)=>{var _0x31848d=_0x1c9f97;_0x47fcdf[_0x546913][_0x31848d(0x298)]=_0x2f7586;}),_0x104049[_0x1c9f97(0x299)]((_0x545ff9,_0x47aa3f)=>{var _0x2f1592=_0x1c9f97;_0x47fcdf[_0x47aa3f][_0x2f1592(0x251)]=_0x545ff9;}),_0x5aea71[_0x1c9f97(0x299)]((_0x3c0d51,_0x3fddfd)=>{var _0x46b6f1=_0x1c9f97;_0x47fcdf[_0x3fddfd][_0x46b6f1(0x2aa)]=_0x3c0d51;}),_0x1de767['forEach']((_0x79aef7,_0x2d632b)=>{var _0x487364=_0x1c9f97;_0x47fcdf[_0x2d632b][_0x487364(0x2e6)]=_0x79aef7;}),_0x38b7ac[_0x1c9f97(0x299)]((_0xd198a2,_0xe0556e)=>{var _0x4f434c=_0x1c9f97;_0x47fcdf[_0xe0556e][_0x4f434c(0x1e8)]=_0xd198a2;}),_0xf11cc3[_0x1c9f97(0x299)]((_0x4b5f3a,_0x115f16)=>{_0x47fcdf[_0x115f16]['product_code']=_0x4b5f3a;}),_0x360a99[_0x1c9f97(0x299)]((_0x93348d,_0x854028)=>{var _0x2efadc=_0x1c9f97;_0x2fe2db[_0x2efadc(0x299)]((_0x13fd2b,_0x151103)=>{var _0x306dda=_0x2efadc;if(_0x13fd2b==_0x306dda(0x2da)&&_0x854028==_0x151103){var _0x52b6fe=_0x93348d['slice'](0x3);_0x47fcdf[_0x854028][_0x306dda(0x265)]=_0x93348d[0x0],_0x47fcdf[_0x854028][_0x306dda(0x2a4)]=_0x93348d[0x1],_0x47fcdf[_0x854028][_0x306dda(0x26e)]=0x0,_0x47fcdf[_0x854028]['bin']=0x0,_0x47fcdf[_0x854028][_0x306dda(0x20e)]=_0x306dda(0x22d),_0x47fcdf[_0x854028][_0x306dda(0x1ef)]=_0x52b6fe;}else{if(_0x13fd2b==_0x306dda(0x2ab)&&_0x854028==_0x151103){var _0x52b6fe=_0x93348d[_0x306dda(0x2af)](0x3);_0x47fcdf[_0x854028][_0x306dda(0x265)]=_0x93348d[0x0],_0x47fcdf[_0x854028]['rack']=_0x93348d[0x1],_0x47fcdf[_0x854028][_0x306dda(0x26e)]=0x0,_0x47fcdf[_0x854028][_0x306dda(0x1fd)]=0x0,_0x47fcdf[_0x854028][_0x306dda(0x20e)]=_0x306dda(0x22d),_0x47fcdf[_0x854028][_0x306dda(0x1ef)]=_0x93348d[0x5];}else{if(_0x854028==_0x151103){var _0x4c8116;if(_0x93348d[0x4]=='L')_0x4c8116=_0x306dda(0x222);else _0x93348d[0x4]=='F'&&(_0x4c8116='Floor');_0x47fcdf[_0x854028][_0x306dda(0x265)]=_0x93348d[0x0],_0x47fcdf[_0x854028]['rack']=_0x93348d[0x1],_0x47fcdf[_0x854028][_0x306dda(0x26e)]=_0x93348d[0x2],_0x47fcdf[_0x854028][_0x306dda(0x1fd)]=_0x93348d[0x3],_0x47fcdf[_0x854028][_0x306dda(0x20e)]=_0x4c8116,_0x47fcdf[_0x854028]['floorlevel']=_0x93348d[0x5];}}}});}),_0x46e3c6[_0x1c9f97(0x299)]((_0x3ace2f,_0x4640e3)=>{var _0x1f1491=_0x1c9f97;_0x47fcdf[_0x4640e3][_0x1f1491(0x21a)]=_0x3ace2f;}),_0x557d8c[_0x1c9f97(0x299)]((_0x2a7cb6,_0x461c08)=>{var _0x406a71=_0x1c9f97;_0x47fcdf[_0x461c08][_0x406a71(0x2ac)]=_0x2a7cb6;}),_0x1fead4[_0x1c9f97(0x299)]((_0x520637,_0x5c1e4e)=>{var _0x2d61cc=_0x1c9f97;_0x47fcdf[_0x5c1e4e][_0x2d61cc(0x257)]=_0x520637;}),_0x2b0d69[_0x1c9f97(0x299)]((_0x28177c,_0x9ea49f)=>{_0x47fcdf[_0x9ea49f]['expiry_date']=_0x28177c;}),_0x279768[_0x1c9f97(0x299)]((_0x37faf9,_0x2c1a89)=>{var _0x54425d=_0x1c9f97;_0x47fcdf[_0x2c1a89][_0x54425d(0x280)]=_0x37faf9;}),_0x557236[_0x1c9f97(0x299)]((_0x100ac4,_0x56af68)=>{var _0x358ad9=_0x1c9f97;_0x47fcdf[_0x56af68][_0x358ad9(0x24a)]=_0x100ac4;}),_0x120b65[_0x1c9f97(0x299)]((_0x1a6967,_0x252a7e)=>{_0x47fcdf[_0x252a7e]['requested_qty']=_0x1a6967;}),_0x260c4c[_0x1c9f97(0x299)]((_0x73c3ff,_0x5bcae4)=>{_0x47fcdf[_0x5bcae4]['delivery_date']=_0x73c3ff;}),_0x58fb3c[_0x1c9f97(0x299)]((_0x3a09af,_0x2f76cb)=>{_0x47fcdf[_0x2f76cb]['delivery_code']=_0x3a09af;}),_0x521c39[_0x1c9f97(0x299)]((_0x5834d2,_0x28cd57)=>{var _0x1e3602=_0x1c9f97;_0x47fcdf[_0x28cd57][_0x1e3602(0x272)]=_0x5834d2;}),_0x195af0[_0x1c9f97(0x299)]((_0x3c94c2,_0xc3a17a)=>{var _0x10682b=_0x1c9f97;_0x47fcdf[_0xc3a17a][_0x10682b(0x2bd)]=_0x3c94c2;}),_0x2fe2db[_0x1c9f97(0x299)]((_0x1e6ff1,_0x4bea37)=>{var _0x3c2cc7=_0x1c9f97;_0x47fcdf[_0x4bea37][_0x3c2cc7(0x253)]=_0x1e6ff1;}),_0x5ed68b[_0x1c9f97(0x299)]((_0x4f4f74,_0x11f6d5)=>{var _0x76f94a=_0x1c9f97;_0x47fcdf[_0x11f6d5][_0x76f94a(0x2dc)]=_0x4f4f74;});var _0x72cf2f=0x0;_0x47fcdf['forEach'](_0x2c9aad=>{var _0x1e370d=_0x1c9f97;(_0x2c9aad['stock']<_0x2c9aad[_0x1e370d(0x2bd)]||_0x2c9aad[_0x1e370d(0x2bd)]==0x0)&&(console['log'](_0x1e370d(0x226),_0x2c9aad),_0x72cf2f++);});const _0x3d2bb9=_0x47fcdf['filter'](_0x28ff92=>_0x28ff92[_0x1c9f97(0x2aa)]!=='0'&&_0x28ff92['quantity']!==''),_0x2d80a6=new sales({'invoice':_0x2c5518,'customer':_0x1c32bf[_0x1c9f97(0x21d)]['customer'],'date':_0xeb9c42,'warehouse_name':_0x489918,'sale_product':_0x3d2bb9,'note':_0x3778ed,'room':_0x4163a8,'primary_code':_0x1312c6,'secondary_code':_0x2686a7,'prod_code':_0x5514af,'SCRN':_0x50683e}),_0x5c99f8=await _0x2d80a6['save']();_0x1c32bf['flash'](_0x1c9f97(0x2ae),_0x1c9f97(0x27e)),_0x182c23[_0x1c9f97(0x271)](_0x1c9f97(0x1e2)+_0x5c99f8[_0x1c9f97(0x20a)]);}catch(_0x53f03b){console[_0x1c9f97(0x2cd)](_0x53f03b);}}),router[a0_0x326b1a(0x1f3)](a0_0x326b1a(0x2d9),auth,async(_0xbdf6c3,_0xb97431)=>{var _0x175df1=a0_0x326b1a;try{const {username:_0x4ee698,email:_0x5759b2,role:_0x164574}=_0xbdf6c3[_0x175df1(0x225)],_0x533e62=_0xbdf6c3[_0x175df1(0x225)],_0x2802af=await profile[_0x175df1(0x2be)]({'email':_0x533e62['email']}),_0x3ad5ff=await master_shop[_0x175df1(0x281)](),_0x196ecb=_0xbdf6c3[_0x175df1(0x2b4)]['id'],_0x454326=await sales[_0x175df1(0x270)](_0x196ecb),_0x25da8d=await warehouse[_0x175df1(0x240)]([{'$match':{'name':_0x454326[_0x175df1(0x264)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x175df1(0x28b),'name':{'$first':_0x175df1(0x2c1)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x175df1(0x28f)},'bin':{'$first':_0x175df1(0x23e)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x175df1(0x2b7)},'primary_code':{'$first':_0x175df1(0x2a1)},'secondary_code':{'$first':_0x175df1(0x2e9)},'product_code':{'$first':_0x175df1(0x2d0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x175df1(0x29b)},'production_date':{'$first':_0x175df1(0x1e5)},'invoice':{'$first':_0x175df1(0x203)}}}]),_0x3be682=await customer[_0x175df1(0x281)]({});let _0x299bb0;if(_0x533e62['role']=='staff'){const _0x16f07e=await staff[_0x175df1(0x2be)]({'email':_0x533e62['email']});_0x299bb0=await warehouse[_0x175df1(0x240)]([{'$match':{'status':_0x175df1(0x25b),'name':_0x16f07e[_0x175df1(0x1f1)]}},{'$group':{'_id':_0x175df1(0x25f),'name':{'$first':_0x175df1(0x25f)}}}]);}else _0x299bb0=await warehouse[_0x175df1(0x240)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x175df1(0x25f),'name':{'$first':'$name'}}}]);const _0x1a48a3=await product[_0x175df1(0x281)]({}),_0x41532d=await suppliers[_0x175df1(0x281)]({});if(_0x3ad5ff[0x0][_0x175df1(0x25a)]==_0x175df1(0x231)){var _0x40da8f=users[_0x175df1(0x1ea)];console['log'](_0x40da8f);}else{if(_0x3ad5ff[0x0][_0x175df1(0x25a)]==_0x175df1(0x235))var _0x40da8f=users[_0x175df1(0x235)];else{if(_0x3ad5ff[0x0][_0x175df1(0x25a)]==_0x175df1(0x28d))var _0x40da8f=users[_0x175df1(0x28d)];else{if(_0x3ad5ff[0x0][_0x175df1(0x25a)]=='Spanish')var _0x40da8f=users[_0x175df1(0x27c)];else{if(_0x3ad5ff[0x0][_0x175df1(0x25a)]==_0x175df1(0x204))var _0x40da8f=users[_0x175df1(0x204)];else{if(_0x3ad5ff[0x0][_0x175df1(0x25a)]==_0x175df1(0x2b2))var _0x40da8f=users['Portuguese'];else{if(_0x3ad5ff[0x0][_0x175df1(0x25a)]==_0x175df1(0x2b0))var _0x40da8f=users[_0x175df1(0x2b0)];else{if(_0x3ad5ff[0x0][_0x175df1(0x25a)]==_0x175df1(0x1e1))var _0x40da8f=users['Arabic'];}}}}}}}_0xb97431['render'](_0x175df1(0x290),{'success':_0xbdf6c3[_0x175df1(0x1e4)](_0x175df1(0x2ae)),'errors':_0xbdf6c3[_0x175df1(0x1e4)]('errors'),'role':_0x533e62,'profile':_0x2802af,'customer':_0x3be682,'warehouse':_0x299bb0,'product':_0x25da8d,'user':_0x454326,'master_shop':_0x3ad5ff,'unit':_0x1a48a3,'language':_0x40da8f,'suppliers':_0x41532d});}catch(_0x4a491a){console[_0x175df1(0x2cd)](_0x4a491a);}}),router[a0_0x326b1a(0x214)](a0_0x326b1a(0x2d9),auth,async(_0x20faa7,_0x273e59)=>{var _0x5652f8=a0_0x326b1a;try{const _0x581df6=_0x20faa7[_0x5652f8(0x2b4)]['id'],{invoice:_0x46ba18,warehouse_name:_0x18a2d2,room:_0x3a7fa6}=_0x20faa7[_0x5652f8(0x21d)],_0x150f68=await sales[_0x5652f8(0x2be)]({'invoice':_0x46ba18}),_0x364a94=_0x150f68[_0x5652f8(0x2d1)][_0x5652f8(0x229)](async _0x3a02b4=>{var _0x227e7a=_0x5652f8,_0x119574=await warehouse['findOne']({'name':_0x18a2d2,'room':_0x3a02b4[_0x227e7a(0x253)],'warehouse_category':_0x227e7a(0x212)});const _0x1d0301=_0x119574[_0x227e7a(0x27b)][_0x227e7a(0x229)](_0x33486c=>{var _0x2a3b7f=_0x227e7a;_0x33486c[_0x2a3b7f(0x294)]==_0x3a02b4[_0x2a3b7f(0x294)]&&_0x33486c[_0x2a3b7f(0x1ef)]==_0x3a02b4['floorlevel']&&_0x33486c[_0x2a3b7f(0x20e)]==_0x3a02b4[_0x2a3b7f(0x20e)]&&_0x33486c['bin']==_0x3a02b4[_0x2a3b7f(0x1fd)]&&_0x33486c[_0x2a3b7f(0x26e)]==_0x3a02b4['bay']&&_0x33486c[_0x2a3b7f(0x2a4)]==_0x3a02b4[_0x2a3b7f(0x2a4)]&&_0x33486c[_0x2a3b7f(0x265)]==_0x3a02b4[_0x2a3b7f(0x265)]&&_0x33486c[_0x2a3b7f(0x29e)]==_0x3a02b4[_0x2a3b7f(0x29e)]&&_0x33486c['batch_code']==_0x3a02b4[_0x2a3b7f(0x257)]&&_0x33486c[_0x2a3b7f(0x20a)]==_0x3a02b4[_0x2a3b7f(0x251)]&&(_0x33486c[_0x2a3b7f(0x224)]=Math[_0x2a3b7f(0x287)](0x0,Math[_0x2a3b7f(0x296)](_0x33486c[_0x2a3b7f(0x224)])-Math[_0x2a3b7f(0x296)](_0x3a02b4[_0x2a3b7f(0x2aa)])));});return _0x119574;});Promise[_0x5652f8(0x2c2)](_0x364a94)['then'](async _0x2fd56c=>{var _0x30b91a=_0x5652f8;try{for(const _0x54e51e of _0x2fd56c){await _0x54e51e[_0x30b91a(0x2e3)]();}_0x150f68[_0x30b91a(0x2d3)]=_0x30b91a(0x2b8);const _0xc9792c=await _0x150f68[_0x30b91a(0x2e3)](),_0x442e13=await master_shop['find'](),_0x2b0c8a=await email_settings[_0x30b91a(0x2be)](),_0x5c0fb2=await supervisor_settings[_0x30b91a(0x281)]();var _0x2f31a8=_0x150f68[_0x30b91a(0x2d1)],_0x45a9e2='',_0x52a9e0;for(_0x52a9e0 in _0x2f31a8){_0x45a9e2+=_0x30b91a(0x1f8)+_0x30b91a(0x2e8)+_0x2f31a8[_0x52a9e0]['product_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2f31a8[_0x52a9e0][_0x30b91a(0x23b)]+'</td>'+_0x30b91a(0x2e8)+_0x2f31a8[_0x52a9e0][_0x30b91a(0x2aa)]+_0x30b91a(0x210)+_0x30b91a(0x2e8)+_0x2f31a8[_0x52a9e0][_0x30b91a(0x21a)]+_0x30b91a(0x210)+_0x30b91a(0x2e8)+_0x2f31a8[_0x52a9e0][_0x30b91a(0x2ac)]+'</td>'+_0x30b91a(0x2e8)+_0x150f68['warehouse_name']+_0x30b91a(0x210)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2f31a8[_0x52a9e0][_0x30b91a(0x253)]+_0x30b91a(0x210)+_0x30b91a(0x2e8)+_0x2f31a8[_0x52a9e0]['storage']+_0x2f31a8[_0x52a9e0]['rack']+_0x2f31a8[_0x52a9e0][_0x30b91a(0x26e)]+_0x2f31a8[_0x52a9e0]['bin']+_0x2f31a8[_0x52a9e0][_0x30b91a(0x20e)][0x0]+_0x2f31a8[_0x52a9e0][_0x30b91a(0x1ef)]+_0x30b91a(0x210),_0x30b91a(0x24d);}let _0x52e71b=nodemailer[_0x30b91a(0x23d)]({'host':_0x2b0c8a[_0x30b91a(0x243)],'port':Number(_0x2b0c8a['port']),'secure':![],'auth':{'user':_0x2b0c8a[_0x30b91a(0x2e4)],'pass':_0x2b0c8a['password']}}),_0x283067={'from':_0x2b0c8a[_0x30b91a(0x2e4)],'to':_0x5c0fb2[0x0]['RMSEmail'],'subject':'Sales\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x30b91a(0x23a)+_0x442e13[0x0][_0x30b91a(0x1f7)],'cid':_0x30b91a(0x2d7)}],'html':_0x30b91a(0x1de)+_0x30b91a(0x22f)+_0x30b91a(0x246)+_0x30b91a(0x2cc)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x30b91a(0x2cc)+_0x30b91a(0x2a7)+_0x30b91a(0x2c3)+_0x30b91a(0x2cc)+_0x30b91a(0x266)+_0x442e13[0x0][_0x30b91a(0x29c)]+_0x30b91a(0x213)+_0x30b91a(0x2c3)+_0x30b91a(0x2c3)+_0x30b91a(0x2df)+_0x30b91a(0x2cc)+_0x30b91a(0x242)+_0x30b91a(0x254)+_0x150f68[_0x30b91a(0x2dc)]+'\x20'+_0x30b91a(0x1fe)+_0x30b91a(0x25c)+_0x150f68[_0x30b91a(0x277)]+'\x20'+'</span>'+_0x30b91a(0x1df)+_0x30b91a(0x2c3)+_0x30b91a(0x279)+_0x30b91a(0x2dd)+_0x30b91a(0x1f8)+_0x30b91a(0x21c)+_0x30b91a(0x2bf)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x30b91a(0x28e)+_0x30b91a(0x1e7)+_0x30b91a(0x25e)+_0x30b91a(0x1f6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x30b91a(0x2a6)+_0x30b91a(0x2a3)+'\x20'+_0x45a9e2+'\x20'+_0x30b91a(0x2e7)+_0x30b91a(0x1fb)+_0x30b91a(0x2cc)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x442e13[0x0][_0x30b91a(0x29c)]+_0x30b91a(0x1df)+_0x30b91a(0x2c3)+_0x30b91a(0x2c3)+_0x30b91a(0x276)};_0x52e71b['sendMail'](_0x283067,function(_0x4c575a,_0x566694){var _0x574a04=_0x30b91a;_0x4c575a?(console[_0x574a04(0x2cd)](_0x4c575a),console[_0x574a04(0x2cd)](_0x574a04(0x293))):console[_0x574a04(0x2cd)](_0x574a04(0x238));}),_0x20faa7[_0x30b91a(0x1e4)]('success','Sales\x20Update\x20successfully'),_0x273e59[_0x30b91a(0x271)]('/all_sales/preview/'+_0x581df6);}catch(_0x3d05ee){console[_0x30b91a(0x2db)](_0x3d05ee),_0x273e59[_0x30b91a(0x248)](0x1f4)[_0x30b91a(0x28c)]({'error':_0x30b91a(0x29a)});}})[_0x5652f8(0x207)](_0x3d2cf0=>{var _0x1ecd3e=_0x5652f8;console['error'](_0x3d2cf0),_0x273e59[_0x1ecd3e(0x248)](0x1f4)[_0x1ecd3e(0x28c)]({'error':_0x1ecd3e(0x27a)});});}catch(_0x4cf845){console[_0x5652f8(0x2cd)](_0x4cf845);}}),router['get']('/view/:id',auth,async(_0x2981bd,_0x271426)=>{var _0x1146db=a0_0x326b1a;try{const {username:_0x3f8677,email:_0x23b9c9,role:_0x4a7b20}=_0x2981bd['user'],_0xdb9e26=_0x2981bd['user'],_0x178a28=await profile[_0x1146db(0x2be)]({'email':_0xdb9e26[_0x1146db(0x2e4)]}),_0x297dbd=await master_shop[_0x1146db(0x281)](),_0x3eea80=_0x2981bd[_0x1146db(0x2b4)]['id'],_0x44b963=await sales['findById'](_0x3eea80);var _0xfba285=['Ambient',_0x1146db(0x2a5)];const _0x559053=await warehouse['aggregate']([{'$match':{'name':_0x44b963[_0x1146db(0x264)],'warehouse_category':_0x1146db(0x212)}},{'$unwind':_0x1146db(0x29d)},{'$group':{'_id':_0x1146db(0x28b),'name':{'$first':_0x1146db(0x2c1)},'product_stock':{'$first':_0x1146db(0x268)},'bay':{'$first':_0x1146db(0x28f)},'bin':{'$first':_0x1146db(0x23e)},'type':{'$first':_0x1146db(0x273)},'floorlevel':{'$first':_0x1146db(0x2b7)},'primary_code':{'$first':_0x1146db(0x2a1)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1146db(0x2d0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1146db(0x2de)}}}]),_0x4c2906=await customer['find']({});let _0x2f3505;if(_0xdb9e26['role']==_0x1146db(0x283)){const _0x870161=await staff[_0x1146db(0x2be)]({'email':_0xdb9e26['email']});_0x2f3505=await warehouse['aggregate']([{'$match':{'status':_0x1146db(0x25b),'name':_0x870161[_0x1146db(0x1f1)],'warehouse_category':_0x1146db(0x212)}},{'$group':{'_id':_0x1146db(0x25f),'name':{'$first':_0x1146db(0x25f)}}}]);}else _0x2f3505=await warehouse['aggregate']([{'$match':{'status':_0x1146db(0x25b),'warehouse_category':_0x1146db(0x212)}},{'$group':{'_id':_0x1146db(0x25f),'name':{'$first':_0x1146db(0x25f)}}}]);const _0xb5aed3=await product[_0x1146db(0x281)]({});if(_0x297dbd[0x0][_0x1146db(0x25a)]==_0x1146db(0x231)){var _0xc17245=users[_0x1146db(0x1ea)];console[_0x1146db(0x2cd)](_0xc17245);}else{if(_0x297dbd[0x0][_0x1146db(0x25a)]==_0x1146db(0x235))var _0xc17245=users[_0x1146db(0x235)];else{if(_0x297dbd[0x0][_0x1146db(0x25a)]==_0x1146db(0x28d))var _0xc17245=users[_0x1146db(0x28d)];else{if(_0x297dbd[0x0][_0x1146db(0x25a)]==_0x1146db(0x27c))var _0xc17245=users[_0x1146db(0x27c)];else{if(_0x297dbd[0x0][_0x1146db(0x25a)]=='French')var _0xc17245=users['French'];else{if(_0x297dbd[0x0]['language']==_0x1146db(0x2b2))var _0xc17245=users[_0x1146db(0x22b)];else{if(_0x297dbd[0x0][_0x1146db(0x25a)]==_0x1146db(0x2b0))var _0xc17245=users['Chinese'];else{if(_0x297dbd[0x0][_0x1146db(0x25a)]==_0x1146db(0x1e1))var _0xc17245=users[_0x1146db(0x2b5)];}}}}}}}_0x271426['render'](_0x1146db(0x228),{'success':_0x2981bd[_0x1146db(0x1e4)](_0x1146db(0x2ae)),'errors':_0x2981bd[_0x1146db(0x1e4)]('errors'),'role':_0xdb9e26,'profile':_0x178a28,'customer':_0x4c2906,'warehouse':_0x2f3505,'product':_0x559053,'user':_0x44b963,'master_shop':_0x297dbd,'unit':_0xb5aed3,'language':_0xc17245});}catch(_0x347e78){console['log'](_0x347e78);}}),router[a0_0x326b1a(0x214)](a0_0x326b1a(0x1f0),auth,async(_0x19eec6,_0x36a536)=>{var _0xbf7792=a0_0x326b1a;try{const _0x338945=_0x19eec6[_0xbf7792(0x2b4)]['id'],_0x2b8ff9=await sales[_0xbf7792(0x2be)]({'_id':_0x19eec6[_0xbf7792(0x2b4)]['id']}),_0x49b4b6=await warehouse[_0xbf7792(0x2be)]({'name':_0x2b8ff9[_0xbf7792(0x264)],'room':_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x233)]}),{invoice:_0x411a05,date:_0x28722d,warehouse_name:_0x253ded,product_name:_0x17304f,stock:_0xd9615d,quantity:_0x10f9fd,note:_0x1a1ce8,room:_0x4746c9,customer:_0x275a36,SCRN:_0x8b326d}=_0x19eec6[_0xbf7792(0x21d)];if(typeof _0x17304f==_0xbf7792(0x20c))var _0x15dca3=[_0x19eec6[_0xbf7792(0x21d)]['product_name']],_0x6381d=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x2bc)]],_0x3c17d2=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x2a2)]],_0x11025e=[_0x19eec6['body'][_0xbf7792(0x2e6)]],_0x4e57f2=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x1e8)]],_0x261b3d=[_0x19eec6[_0xbf7792(0x21d)]['prod_code']],_0x3385cd=[_0x19eec6['body'][_0xbf7792(0x223)]],_0xf4dbee=[_0x19eec6['body']['primary_unit']],_0x3c3680=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x2ac)]],_0x598209=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x257)]],_0x7d1310=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x29e)]],_0x27db6e=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x1ff)]],_0x24270d=[_0x19eec6[_0xbf7792(0x21d)]['production_date']],_0x3db4fe=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x24c)]],_0x1537fc=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x206)]],_0x269a7b=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x2a0)]],_0x4e9528=[_0x19eec6['body'][_0xbf7792(0x272)]],_0x1c1926=[_0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x2aa)]],_0xc6f12a=[_0x19eec6['body'][_0xbf7792(0x26a)]];else var _0x15dca3=[..._0x19eec6['body']['product_name']],_0x6381d=[..._0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x2bc)]],_0x3c17d2=[..._0x19eec6['body'][_0xbf7792(0x2a2)]],_0x11025e=[..._0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x2e6)]],_0x4e57f2=[..._0x19eec6['body'][_0xbf7792(0x1e8)]],_0x261b3d=[..._0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x2d5)]],_0x3385cd=[..._0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x223)]],_0xf4dbee=[..._0x19eec6['body']['primary_unit']],_0x3c3680=[..._0x19eec6['body']['secondary_unit']],_0x598209=[..._0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x257)]],_0x7d1310=[..._0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x29e)]],_0x27db6e=[..._0x19eec6['body'][_0xbf7792(0x1ff)]],_0x24270d=[..._0x19eec6['body'][_0xbf7792(0x24a)]],_0x3db4fe=[..._0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x24c)]],_0x1537fc=[..._0x19eec6[_0xbf7792(0x21d)]['delivery_date']],_0x269a7b=[..._0x19eec6[_0xbf7792(0x21d)]['delivery_code']],_0x4e9528=[..._0x19eec6[_0xbf7792(0x21d)][_0xbf7792(0x272)]],_0x1c1926=[..._0x19eec6['body'][_0xbf7792(0x2aa)]],_0xc6f12a=[..._0x19eec6[_0xbf7792(0x21d)]['RoomAssigned']];const _0x598cfa=_0x15dca3[_0xbf7792(0x229)](_0x52dc7a=>{return _0x52dc7a={'product_name':_0x52dc7a};});_0x6381d[_0xbf7792(0x299)]((_0x4fee88,_0x8dd9a5)=>{var _0xb70324=_0xbf7792;_0x598cfa[_0x8dd9a5][_0xb70324(0x2bc)]=Math['abs'](_0x4fee88);}),_0x3c17d2[_0xbf7792(0x299)]((_0x295066,_0x20431)=>{var _0x4548b3=_0xbf7792;_0x598cfa[_0x20431][_0x4548b3(0x2aa)]=_0x295066;}),_0x11025e['forEach']((_0x1a489b,_0x429b98)=>{var _0xf244cc=_0xbf7792;_0x598cfa[_0x429b98][_0xf244cc(0x2e6)]=_0x1a489b;}),_0x4e57f2['forEach']((_0x1b7442,_0x2fdbba)=>{var _0x728d0b=_0xbf7792;_0x598cfa[_0x2fdbba][_0x728d0b(0x1e8)]=_0x1b7442;}),_0x261b3d['forEach']((_0x214cdb,_0x268a57)=>{var _0x4e7ec8=_0xbf7792;_0x598cfa[_0x268a57][_0x4e7ec8(0x23b)]=_0x214cdb;}),_0x3385cd[_0xbf7792(0x299)]((_0x4cd772,_0xe9523b)=>{_0xc6f12a['forEach']((_0x52c853,_0x1fa5ba)=>{var _0x328b2c=a0_0x566c;if(_0x52c853==_0x328b2c(0x2da)&&_0xe9523b==_0x1fa5ba){var _0x140c8e=_0x4cd772['slice'](0x3);_0x598cfa[_0xe9523b][_0x328b2c(0x265)]=_0x4cd772[0x0],_0x598cfa[_0xe9523b][_0x328b2c(0x2a4)]=_0x4cd772[0x1],_0x598cfa[_0xe9523b]['bay']=0x0,_0x598cfa[_0xe9523b]['bin']=0x0,_0x598cfa[_0xe9523b][_0x328b2c(0x20e)]=_0x328b2c(0x22d),_0x598cfa[_0xe9523b][_0x328b2c(0x1ef)]=_0x140c8e;}else{if(_0x52c853==_0x328b2c(0x2ab)&&_0xe9523b==_0x1fa5ba){var _0x140c8e=_0x4cd772[_0x328b2c(0x2af)](0x3);_0x598cfa[_0xe9523b]['storage']=_0x4cd772[0x0],_0x598cfa[_0xe9523b][_0x328b2c(0x2a4)]=_0x4cd772[0x1],_0x598cfa[_0xe9523b][_0x328b2c(0x26e)]=0x0,_0x598cfa[_0xe9523b][_0x328b2c(0x1fd)]=0x0,_0x598cfa[_0xe9523b]['type']=_0x328b2c(0x22d),_0x598cfa[_0xe9523b][_0x328b2c(0x1ef)]=_0x4cd772[0x5];}else{if(_0xe9523b==_0x1fa5ba){var _0x2e7e3a;if(_0x4cd772[0x4]=='L')_0x2e7e3a='Level';else _0x4cd772[0x4]=='F'&&(_0x2e7e3a=_0x328b2c(0x22d));_0x598cfa[_0xe9523b]['storage']=_0x4cd772[0x0],_0x598cfa[_0xe9523b]['rack']=_0x4cd772[0x1],_0x598cfa[_0xe9523b][_0x328b2c(0x26e)]=_0x4cd772[0x2],_0x598cfa[_0xe9523b][_0x328b2c(0x1fd)]=_0x4cd772[0x3],_0x598cfa[_0xe9523b][_0x328b2c(0x20e)]=_0x2e7e3a,_0x598cfa[_0xe9523b][_0x328b2c(0x1ef)]=_0x4cd772[0x5];}}}});}),_0xf4dbee[_0xbf7792(0x299)]((_0x7c7d0e,_0x19bfb0)=>{var _0xd2f7c6=_0xbf7792;_0x598cfa[_0x19bfb0][_0xd2f7c6(0x21a)]=_0x7c7d0e;}),_0x3c3680[_0xbf7792(0x299)]((_0x2fef36,_0x36e6e7)=>{var _0x83bdcf=_0xbf7792;_0x598cfa[_0x36e6e7][_0x83bdcf(0x2ac)]=_0x2fef36;}),_0x598209[_0xbf7792(0x299)]((_0x151334,_0x3dae20)=>{var _0x327352=_0xbf7792;_0x598cfa[_0x3dae20][_0x327352(0x257)]=_0x151334;}),_0x7d1310[_0xbf7792(0x299)]((_0x376393,_0x546ac5)=>{var _0x4cd178=_0xbf7792;_0x598cfa[_0x546ac5][_0x4cd178(0x29e)]=_0x376393;}),_0x27db6e[_0xbf7792(0x299)]((_0x170542,_0x2a8116)=>{_0x598cfa[_0x2a8116]['maxperunit']=_0x170542;}),_0x24270d['forEach']((_0x2600b4,_0x561d70)=>{_0x598cfa[_0x561d70]['production_date']=_0x2600b4;}),_0x3db4fe[_0xbf7792(0x299)]((_0x4d67b4,_0x3bd906)=>{var _0x568bad=_0xbf7792;_0x598cfa[_0x3bd906][_0x568bad(0x24c)]=Math[_0x568bad(0x296)](_0x4d67b4);}),_0x1537fc[_0xbf7792(0x299)]((_0x44af23,_0x4ab285)=>{var _0x233bdb=_0xbf7792;_0x598cfa[_0x4ab285][_0x233bdb(0x206)]=_0x44af23;}),_0x269a7b[_0xbf7792(0x299)]((_0x49190e,_0x59b2f8)=>{var _0x48ea91=_0xbf7792;_0x598cfa[_0x59b2f8][_0x48ea91(0x2a0)]=_0x49190e;}),_0x4e9528[_0xbf7792(0x299)]((_0x45b18e,_0x57ffdd)=>{var _0x5b375b=_0xbf7792;_0x598cfa[_0x57ffdd][_0x5b375b(0x272)]=_0x45b18e;}),_0x1c1926['forEach']((_0x1f75e8,_0x20a10e)=>{var _0x35586f=_0xbf7792;_0x598cfa[_0x20a10e][_0x35586f(0x2bd)]=_0x1f75e8;}),_0xc6f12a[_0xbf7792(0x299)]((_0x17a6d3,_0x24ffe1)=>{_0x598cfa[_0x24ffe1]['room_name']=_0x17a6d3;});var _0xe19d43=0x0;_0x598cfa['forEach'](_0x446b26=>{var _0x339e57=_0xbf7792;console[_0x339e57(0x2cd)](_0x339e57(0x226),_0x446b26),(parseInt(_0x446b26[_0x339e57(0x2bc)])<parseInt(_0x446b26['quantity'])||parseInt(_0x446b26['quantity'])==0x0)&&_0xe19d43++;});if(_0xe19d43!=0x0)return _0x19eec6['flash'](_0xbf7792(0x24e),_0xbf7792(0x237)),_0x36a536[_0xbf7792(0x271)](_0xbf7792(0x202));const _0x311c8f=_0x598cfa[_0xbf7792(0x2c4)](_0x226890=>_0x226890[_0xbf7792(0x2aa)]!=='0'&&_0x226890[_0xbf7792(0x2aa)]!=='');_0x2b8ff9[_0xbf7792(0x2dc)]=_0x411a05,_0x2b8ff9[_0xbf7792(0x1fc)]=_0x275a36,_0x2b8ff9[_0xbf7792(0x277)]=_0x28722d,_0x2b8ff9[_0xbf7792(0x264)]=_0x253ded,_0x2b8ff9['sale_product']=_0x311c8f,_0x2b8ff9[_0xbf7792(0x284)]=_0x1a1ce8,_0x2b8ff9[_0xbf7792(0x20b)]=_0x8b326d,_0x2b8ff9[_0xbf7792(0x2d3)]=_0xbf7792(0x1ec),_0x2b8ff9[_0xbf7792(0x250)]=_0xbf7792(0x1ec);const _0x6aba2b=await _0x2b8ff9[_0xbf7792(0x2e3)]();_0x19eec6[_0xbf7792(0x1e4)](_0xbf7792(0x2ae),_0xbf7792(0x209)),_0x36a536['redirect'](_0xbf7792(0x221));}catch(_0x4b917c){console[_0xbf7792(0x2cd)](_0x4b917c);}}),router['post'](a0_0x326b1a(0x2c9),auth,async(_0x539361,_0x17c78b)=>{var _0x2cb67f=a0_0x326b1a;try{const _0x5ef256=_0x539361[_0x2cb67f(0x2b4)]['id'],{invoice:_0x39b387,customer:_0x36e020,receivable_amount:_0xe1f42,received_amount:_0x4de69d}=_0x539361[_0x2cb67f(0x21d)],_0x575290=await sales[_0x2cb67f(0x270)](_0x5ef256);console['log'](_0x575290);var _0x52bff4=_0xe1f42-_0x4de69d;console['log'](_0x4de69d),_0x575290[_0x2cb67f(0x2cf)]=parseFloat(_0x4de69d)+parseFloat(_0x575290[_0x2cb67f(0x2cf)]),_0x575290[_0x2cb67f(0x2e2)]=_0x52bff4,console[_0x2cb67f(0x2cd)](_0x575290);const _0x4fcc13=await _0x575290[_0x2cb67f(0x2e3)](),_0x4703cf=await c_payment_data[_0x2cb67f(0x2be)]({'invoice':_0x39b387});_0x4703cf[_0x2cb67f(0x258)]=_0x52bff4,await _0x4703cf[_0x2cb67f(0x2e3)]();let _0x1a463e=new Date(),_0x15bfa0=('0'+_0x1a463e[_0x2cb67f(0x261)]())[_0x2cb67f(0x2af)](-0x2),_0xaf5a88=('0'+(_0x1a463e[_0x2cb67f(0x1f5)]()+0x1))[_0x2cb67f(0x2af)](-0x2),_0x2fb3af=_0x1a463e[_0x2cb67f(0x2b1)](),_0x3dbe3d=_0x2fb3af+'-'+_0xaf5a88+'-'+_0x15bfa0;const _0x40f2a4=new customer_payment({'invoice':_0x39b387,'date':_0x2fb3af+'-'+_0xaf5a88+'-'+_0x15bfa0,'customer':_0x36e020,'reason':_0x2cb67f(0x285),'amount':_0x4de69d}),_0x9d5fdc=await _0x40f2a4[_0x2cb67f(0x2e3)]();_0x539361[_0x2cb67f(0x1e4)](_0x2cb67f(0x2ae),'payment\x20successfull'),_0x17c78b['redirect'](_0x2cb67f(0x221));}catch(_0xe731a1){console['log'](_0xe731a1);}}),router[a0_0x326b1a(0x1f3)](a0_0x326b1a(0x2c0),auth,async(_0x4d5b4d,_0xd32014)=>{var _0x261fed=a0_0x326b1a;try{const {username:_0x31724e,email:_0x18cb20,role:_0x50b172}=_0x4d5b4d[_0x261fed(0x225)],_0x1e6137=_0x4d5b4d[_0x261fed(0x225)],_0x24b778=await profile[_0x261fed(0x2be)]({'email':_0x1e6137[_0x261fed(0x2e4)]}),_0x2e313e=await master_shop[_0x261fed(0x281)]();console['log']('master',_0x2e313e);const _0x309626=_0x4d5b4d[_0x261fed(0x2b4)]['id'],_0x666ace=await sales[_0x261fed(0x270)](_0x309626);console['log'](_0x666ace);const _0xd67a2f=await customer[_0x261fed(0x2be)]({'name':_0x666ace[_0x261fed(0x1fc)]});console[_0x261fed(0x2cd)](_0xd67a2f);if(_0x2e313e[0x0][_0x261fed(0x25a)]==_0x261fed(0x231)){var _0x270b12=users[_0x261fed(0x1ea)];console[_0x261fed(0x2cd)](_0x270b12);}else{if(_0x2e313e[0x0]['language']==_0x261fed(0x235))var _0x270b12=users[_0x261fed(0x235)];else{if(_0x2e313e[0x0][_0x261fed(0x25a)]==_0x261fed(0x28d))var _0x270b12=users[_0x261fed(0x28d)];else{if(_0x2e313e[0x0][_0x261fed(0x25a)]==_0x261fed(0x27c))var _0x270b12=users['Spanish'];else{if(_0x2e313e[0x0]['language']==_0x261fed(0x204))var _0x270b12=users['French'];else{if(_0x2e313e[0x0][_0x261fed(0x25a)]==_0x261fed(0x2b2))var _0x270b12=users[_0x261fed(0x22b)];else{if(_0x2e313e[0x0]['language']=='Chinese')var _0x270b12=users[_0x261fed(0x2b0)];else{if(_0x2e313e[0x0][_0x261fed(0x25a)]==_0x261fed(0x1e1))var _0x270b12=users['Arabic'];}}}}}}}_0xd32014[_0x261fed(0x23c)](_0x261fed(0x1f2),{'success':_0x4d5b4d[_0x261fed(0x1e4)]('success'),'errors':_0x4d5b4d[_0x261fed(0x1e4)]('errors'),'role':_0x1e6137,'profile':_0x24b778,'master_shop':_0x2e313e,'customers':_0xd67a2f,'sales':_0x666ace,'language':_0x270b12});}catch(_0x38b4e3){console['log'](_0x38b4e3);}}),router['get'](a0_0x326b1a(0x217),auth,async(_0x98139,_0x41d204)=>{var _0x4dc7c1=a0_0x326b1a;try{const {username:_0x446920,email:_0x4d8ddc,role:_0x1a1a1e}=_0x98139[_0x4dc7c1(0x225)],_0x5390e8=_0x98139['user'],_0x3ed7d6=await profile[_0x4dc7c1(0x2be)]({'email':_0x5390e8[_0x4dc7c1(0x2e4)]}),_0x448496=await master_shop[_0x4dc7c1(0x281)]();console[_0x4dc7c1(0x2cd)](_0x4dc7c1(0x1e9),_0x448496);const _0x8f929=_0x98139['params']['id'];console[_0x4dc7c1(0x2cd)](_0x8f929);const _0x3c3838=await sales['findById'](_0x8f929);console[_0x4dc7c1(0x2cd)](_0x4dc7c1(0x23f),_0x3c3838);const _0x2d46a4=await warehouse['aggregate']([{'$match':{'name':_0x4dc7c1(0x1fa),'room':_0x4dc7c1(0x2a9)}},{'$unwind':_0x4dc7c1(0x29d)},{'$group':{'_id':_0x4dc7c1(0x28b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4dc7c1(0x268)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x4dc7c1(0x2d6)},'pallet':{'$first':_0x4dc7c1(0x2e5)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4dc7c1(0x2e9)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x4dc7c1(0x2cd)](_0x4dc7c1(0x2ba),_0x2d46a4);const _0x2737f8=await product[_0x4dc7c1(0x281)]({});warehouse_data=await warehouse[_0x4dc7c1(0x240)]([{'$match':{'status':_0x4dc7c1(0x25b),'name':_0x4dc7c1(0x1fa),'warehouse_category':_0x4dc7c1(0x212)}},{'$group':{'_id':_0x4dc7c1(0x25f),'name':{'$first':_0x4dc7c1(0x25f)}}},{'$sort':{'name':0x1}}]);var _0x5539f6=[_0x4dc7c1(0x2a9)];if(_0x448496[0x0][_0x4dc7c1(0x25a)]=='English\x20(US)'){var _0x460114=users[_0x4dc7c1(0x1ea)];console[_0x4dc7c1(0x2cd)](_0x460114);}else{if(_0x448496[0x0][_0x4dc7c1(0x25a)]==_0x4dc7c1(0x235))var _0x460114=users[_0x4dc7c1(0x235)];else{if(_0x448496[0x0][_0x4dc7c1(0x25a)]==_0x4dc7c1(0x28d))var _0x460114=users['German'];else{if(_0x448496[0x0][_0x4dc7c1(0x25a)]==_0x4dc7c1(0x27c))var _0x460114=users['Spanish'];else{if(_0x448496[0x0][_0x4dc7c1(0x25a)]==_0x4dc7c1(0x204))var _0x460114=users[_0x4dc7c1(0x204)];else{if(_0x448496[0x0][_0x4dc7c1(0x25a)]==_0x4dc7c1(0x2b2))var _0x460114=users[_0x4dc7c1(0x22b)];else{if(_0x448496[0x0][_0x4dc7c1(0x25a)]=='Chinese')var _0x460114=users[_0x4dc7c1(0x2b0)];else{if(_0x448496[0x0][_0x4dc7c1(0x25a)]==_0x4dc7c1(0x1e1))var _0x460114=users[_0x4dc7c1(0x2b5)];}}}}}}}_0x41d204[_0x4dc7c1(0x23c)](_0x4dc7c1(0x288),{'success':_0x98139['flash']('success'),'errors':_0x98139[_0x4dc7c1(0x1e4)](_0x4dc7c1(0x24e)),'role':_0x5390e8,'profile':_0x3ed7d6,'user':_0x3c3838,'stock':_0x2d46a4,'master_shop':_0x448496,'unit':_0x2737f8,'language':_0x460114,'warehouses':warehouse_data,'rooms':_0x5539f6});}catch(_0xb39ff1){console[_0x4dc7c1(0x2cd)](_0xb39ff1),_0x41d204[_0x4dc7c1(0x248)](0xc8)[_0x4dc7c1(0x28c)]({'message':_0xb39ff1['message']});}}),router['post'](a0_0x326b1a(0x217),auth,async(_0x2df09f,_0x121a72)=>{var _0x2a123a=a0_0x326b1a;try{const {invoice:_0x15f16b,date:_0x2bcd3a,warehouse_name:_0xa39117,product_name:_0x17e394,primary_code:_0x2230b8,secondary_code:_0x1a1f4e,product_code:_0x4c027d,sales_quantity:_0x178cf1,stocks:_0x51acf9,return_qty:_0x1bb49a,Room_name:_0x562987,to_warehouse_name:_0xb417db,to_Roomname:_0x5b64ba,to_Room_name:_0x1a3583,note:_0xf47d18,level:_0x5e8b1a,isle:_0x51ad19,pallet:_0x4002b9}=_0x2df09f[_0x2a123a(0x21d)];if(typeof _0x17e394=='string')var _0x16242e=[_0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x294)]],_0x258a4e=[_0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x2e6)]],_0x318452=[_0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x1e8)]],_0x524163=[_0x2df09f['body']['product_code']],_0xe5e4ff=[_0x2df09f['body'][_0x2a123a(0x1ee)]],_0x27eb28=[_0x2df09f['body'][_0x2a123a(0x1eb)]],_0x35f19d=[_0x2df09f['body'][_0x2a123a(0x2ad)]],_0x2acd7f=[_0x2df09f['body']['bay']],_0x19a504=[_0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x1fd)]],_0x2d481f=[_0x2df09f[_0x2a123a(0x21d)]['types']],_0x58a207=[_0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x1ef)]];else var _0x16242e=[..._0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x294)]],_0x258a4e=[..._0x2df09f[_0x2a123a(0x21d)]['primary_code']],_0x318452=[..._0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x1e8)]],_0x524163=[..._0x2df09f['body'][_0x2a123a(0x23b)]],_0xe5e4ff=[..._0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x1ee)]],_0x27eb28=[..._0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x1eb)]],_0x35f19d=[..._0x2df09f['body']['return_qty']],_0x2acd7f=[..._0x2df09f['body'][_0x2a123a(0x26e)]],_0x19a504=[..._0x2df09f['body'][_0x2a123a(0x1fd)]],_0x2d481f=[..._0x2df09f['body']['types']],_0x58a207=[..._0x2df09f['body'][_0x2a123a(0x1ef)]];const _0x313f98=_0x16242e[_0x2a123a(0x229)](_0x6e0df1=>{return _0x6e0df1={'product_name':_0x6e0df1};});_0x258a4e[_0x2a123a(0x299)]((_0x5b88ae,_0x5b2c83)=>{var _0x17da39=_0x2a123a;_0x313f98[_0x5b2c83][_0x17da39(0x2e6)]=_0x5b88ae;}),_0x318452[_0x2a123a(0x299)]((_0x5cedc8,_0x23e982)=>{var _0x284d9a=_0x2a123a;_0x313f98[_0x23e982][_0x284d9a(0x1e8)]=_0x5cedc8;}),_0x524163[_0x2a123a(0x299)]((_0x4d3d5e,_0x5cd088)=>{var _0x5a94c6=_0x2a123a;_0x313f98[_0x5cd088][_0x5a94c6(0x23b)]=_0x4d3d5e;}),_0xe5e4ff[_0x2a123a(0x299)]((_0x3a3fd1,_0x534af0)=>{var _0xdba7a=_0x2a123a;_0x313f98[_0x534af0][_0xdba7a(0x1e6)]=_0x3a3fd1;}),_0x27eb28['forEach']((_0x48603a,_0x1e16cb)=>{_0x313f98[_0x1e16cb]['stock']=_0x48603a;}),_0x35f19d['forEach']((_0x2756e5,_0x47af64)=>{var _0x5090f5=_0x2a123a;_0x313f98[_0x47af64][_0x5090f5(0x2ad)]=_0x2756e5;}),_0x2acd7f[_0x2a123a(0x299)]((_0x4b9b90,_0x96865b)=>{_0x313f98[_0x96865b]['bay']=_0x4b9b90;}),_0x19a504['forEach']((_0xaf4579,_0x4c2c24)=>{var _0x2b3486=_0x2a123a;_0x313f98[_0x4c2c24][_0x2b3486(0x1fd)]=_0xaf4579;}),_0x2d481f['forEach']((_0x44cc86,_0x11547e)=>{var _0x201683=_0x2a123a;_0x313f98[_0x11547e][_0x201683(0x20e)]=_0x44cc86;}),_0x58a207['forEach']((_0x241ed5,_0x3830bb)=>{var _0xb9078d=_0x2a123a;_0x313f98[_0x3830bb][_0xb9078d(0x1ef)]=_0x241ed5;});var _0x546de4=0x0;_0x313f98[_0x2a123a(0x299)](_0x889db1=>{var _0x3f6f0a=_0x2a123a;console['log']('foreach\x20newproduct',_0x889db1),(parseInt(_0x889db1['sale_qty'])<parseInt(_0x889db1[_0x3f6f0a(0x2ad)])||parseInt(_0x889db1[_0x3f6f0a(0x2bc)])<parseInt(_0x889db1[_0x3f6f0a(0x2ad)])&&parseInt(_0x889db1[_0x3f6f0a(0x1e6)])>parseInt(_0x889db1[_0x3f6f0a(0x2ad)])||parseInt(_0x889db1[_0x3f6f0a(0x2ad)])==0x0)&&_0x546de4++;});if(_0x546de4!=0x0)return _0x2df09f[_0x2a123a(0x1e4)]('errors',_0x2a123a(0x27d)),_0x121a72['redirect'](_0x2a123a(0x202));const _0xd9d9b7=await sales['findOne']({'invoice':_0x15f16b});console[_0x2a123a(0x2cd)](_0xd9d9b7),_0xd9d9b7[_0x2a123a(0x26d)]='True';const _0x478341=await _0xd9d9b7[_0x2a123a(0x2e3)](),_0x392f6b=new sales_return({'invoice':_0x15f16b,'customer':_0x2df09f['body'][_0x2a123a(0x1fc)],'date':_0x2bcd3a,'warehouse_name':_0xa39117,'room':_0x562987,'ToWarehouse':_0xb417db,'ToRoom':_0x1a3583,'return_sale':_0x313f98,'note':_0xf47d18}),_0x50e1c6=await _0x392f6b[_0x2a123a(0x2e3)]();console['log'](_0x392f6b);const _0x5324fa=await sales_return[_0x2a123a(0x2be)]({'invoice':_0x15f16b}),_0x5d50bb=await warehouse[_0x2a123a(0x2be)]({'name':_0xb417db,'room':_0x1a3583});_0x5324fa[_0x2a123a(0x288)][_0x2a123a(0x299)](_0x39c081=>{var _0x23876d=_0x2a123a,_0x20189e=0x0;const _0x319950=_0x5d50bb[_0x23876d(0x27b)][_0x23876d(0x229)](_0x253f76=>{var _0x49424f=_0x23876d;_0x253f76[_0x49424f(0x294)]==_0x39c081[_0x49424f(0x294)]&&_0x253f76[_0x49424f(0x1ef)]==_0x39c081[_0x49424f(0x1ef)]&&_0x253f76['type']==_0x39c081[_0x49424f(0x20e)]&&_0x253f76[_0x49424f(0x1fd)]==_0x39c081[_0x49424f(0x1fd)]&&_0x253f76[_0x49424f(0x26e)]==_0x39c081[_0x49424f(0x26e)]&&(_0x253f76['product_stock']=parseInt(_0x253f76[_0x49424f(0x224)])+parseInt(_0x39c081[_0x49424f(0x2ad)]),_0x20189e++);});_0x20189e=='0'&&(_0x5d50bb[_0x23876d(0x27b)]=_0x5d50bb[_0x23876d(0x27b)]['concat']({'product_name':_0x39c081[_0x23876d(0x294)],'product_stock':_0x39c081[_0x23876d(0x2ad)],'primary_code':_0x39c081['primary_code'],'secondary_code':_0x39c081[_0x23876d(0x1e8)],'product_code':_0x39c081[_0x23876d(0x23b)],'bay':_0x39c081[_0x23876d(0x26e)],'bin':_0x39c081['bin'],'type':_0x39c081[_0x23876d(0x20e)],'floorlevel':_0x39c081[_0x23876d(0x1ef)]})),console[_0x23876d(0x2cd)](_0x23876d(0x28a),_0x5d50bb);}),await _0x5d50bb[_0x2a123a(0x2e3)](),console[_0x2a123a(0x2cd)](_0x2df09f[_0x2a123a(0x21d)]);const _0xf6c6a0=new c_payment_data({'invoice':_0x15f16b,'customer':_0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x1fc)],'reason':_0x2a123a(0x2d2)});await _0xf6c6a0[_0x2a123a(0x2e3)]();const _0x39733d=await master_shop[_0x2a123a(0x281)]();console[_0x2a123a(0x2cd)](_0x2a123a(0x247),_0x39733d[0x0][_0x2a123a(0x1f7)]);const _0x708996=await email_settings[_0x2a123a(0x2be)](),_0x5b12d9=await customer['findOne']({'name':_0x2df09f[_0x2a123a(0x21d)][_0x2a123a(0x1fc)]});console[_0x2a123a(0x2cd)](_0x2a123a(0x2c7),_0x5b12d9);_0x39733d[0x0]['currency_placement']==0x1?(right_currency=_0x39733d[0x0][_0x2a123a(0x289)],left_currency=''):(right_currency='',left_currency=_0x39733d[0x0][_0x2a123a(0x289)]);var _0x734692=_0x16242e,_0x21226e=_0x35f19d,_0x1a1021='',_0xfec69b;for(_0xfec69b in _0x734692){_0x1a1021+=_0x2a123a(0x1f8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x734692[_0xfec69b]+_0x2a123a(0x210)+_0x2a123a(0x2e8)+_0x21226e[_0xfec69b]+_0x2a123a(0x210)+'</tr>';}console[_0x2a123a(0x2cd)]('product_list',_0x1a1021);let _0x473359=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x708996[_0x2a123a(0x2e4)],'pass':_0x708996[_0x2a123a(0x291)]}}),_0x652eab={'from':_0x708996[_0x2a123a(0x2e4)],'to':_0x5b12d9[_0x2a123a(0x2e4)],'subject':_0x2a123a(0x1db),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2a123a(0x201)+'/upload/'+_0x39733d[0x0][_0x2a123a(0x1f7)],'cid':'logo'}],'html':_0x2a123a(0x1de)+'<html><head><title></title>'+_0x2a123a(0x246)+_0x2a123a(0x2cc)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x2a123a(0x2a7)+'</div>'+'<div>'+_0x2a123a(0x266)+_0x39733d[0x0][_0x2a123a(0x29c)]+_0x2a123a(0x213)+_0x2a123a(0x2c3)+'</div>'+_0x2a123a(0x2df)+_0x2a123a(0x2cc)+_0x2a123a(0x242)+'\x20Order\x20Number\x20:\x20'+_0x15f16b+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x2bcd3a+'\x20'+_0x2a123a(0x297)+_0x2a123a(0x1df)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2a123a(0x2dd)+_0x2a123a(0x1f8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2a123a(0x1f9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x2a123a(0x21b)+_0x2a123a(0x24d)+_0x2a123a(0x2a6)+_0x2a123a(0x2a3)+'\x20'+_0x1a1021+'\x20'+_0x2a123a(0x2e7)+_0x2a123a(0x1fb)+_0x2a123a(0x2cc)+_0x2a123a(0x21f)+_0x2a123a(0x262)+_0x39733d[0x0][_0x2a123a(0x29c)]+'</h5>'+_0x2a123a(0x2c3)+_0x2a123a(0x2c3)+'</body></html>'};_0x473359['sendMail'](_0x652eab,function(_0x18c8f1,_0x9f76fa){var _0x563256=_0x2a123a;_0x18c8f1?(console[_0x563256(0x2cd)](_0x18c8f1),console['log'](_0x563256(0x293))):console['log'](_0x563256(0x238));}),_0x2df09f[_0x2a123a(0x1e4)](_0x2a123a(0x2ae),_0x2a123a(0x1f4)),_0x121a72['redirect'](_0x2a123a(0x221));}catch(_0x2b20fb){console[_0x2a123a(0x2cd)](_0x2b20fb),_0x121a72[_0x2a123a(0x248)](0xc8)[_0x2a123a(0x28c)]({'message1':_0x2b20fb[_0x2a123a(0x2e0)]});}}),router[a0_0x326b1a(0x1f3)](a0_0x326b1a(0x200),auth,async(_0x4d88aa,_0x255641)=>{var _0x13f0b6=a0_0x326b1a;try{const {username:_0xc3ea23,email:_0x3cd91e,role:_0x378f35}=_0x4d88aa[_0x13f0b6(0x225)],_0x2fd2a3=_0x4d88aa[_0x13f0b6(0x225)],_0x371377=await profile[_0x13f0b6(0x2be)]({'email':_0x2fd2a3[_0x13f0b6(0x2e4)]}),_0x13457b=await master_shop['find']();console[_0x13f0b6(0x2cd)](_0x13f0b6(0x208),_0x13457b);const _0x45af2e=_0x4d88aa[_0x13f0b6(0x2b4)]['id'],_0x2b5d17=await sales[_0x13f0b6(0x270)](_0x45af2e);console[_0x13f0b6(0x2cd)](_0x13f0b6(0x1dd),_0x2b5d17);if(_0x13457b[0x0][_0x13f0b6(0x25a)]==_0x13f0b6(0x231))var _0x30f127=users[_0x13f0b6(0x1ea)];else{if(_0x13457b[0x0][_0x13f0b6(0x25a)]=='Hindi')var _0x30f127=users[_0x13f0b6(0x235)];else{if(_0x13457b[0x0][_0x13f0b6(0x25a)]==_0x13f0b6(0x28d))var _0x30f127=users['German'];else{if(_0x13457b[0x0][_0x13f0b6(0x25a)]==_0x13f0b6(0x27c))var _0x30f127=users[_0x13f0b6(0x27c)];else{if(_0x13457b[0x0][_0x13f0b6(0x25a)]==_0x13f0b6(0x204))var _0x30f127=users[_0x13f0b6(0x204)];else{if(_0x13457b[0x0][_0x13f0b6(0x25a)]==_0x13f0b6(0x2b2))var _0x30f127=users[_0x13f0b6(0x22b)];else{if(_0x13457b[0x0][_0x13f0b6(0x25a)]==_0x13f0b6(0x2b0))var _0x30f127=users['Chinese'];else{if(_0x13457b[0x0][_0x13f0b6(0x25a)]==_0x13f0b6(0x1e1))var _0x30f127=users[_0x13f0b6(0x2b5)];}}}}}}}_0x255641[_0x13f0b6(0x23c)]('all_sales_barcode',{'success':_0x4d88aa['flash']('success'),'errors':_0x4d88aa['flash'](_0x13f0b6(0x24e)),'role':_0x2fd2a3,'profile':_0x371377,'alldata':_0x2b5d17,'master_shop':_0x13457b,'language':_0x30f127});}catch(_0x166a7f){console[_0x13f0b6(0x2cd)](_0x166a7f);}}),router[a0_0x326b1a(0x214)](a0_0x326b1a(0x259),async(_0x2b24f7,_0x3bb519)=>{var _0x56ca5d=a0_0x326b1a;const {product_code:_0x1bbcb8,warehouse_name:_0x15569e,rooms_data:_0x45ff7f,Roomslist:_0x10549c}=_0x2b24f7[_0x56ca5d(0x21d)],_0x166dc9=_0x10549c[_0x56ca5d(0x2b6)](','),_0x35d654=[];async function _0x5a2f78(_0x173267){var _0x11a2eb=_0x56ca5d;const _0x4bb483=await warehouse[_0x11a2eb(0x240)]([{'$match':{'name':_0x15569e,'room':_0x173267}},{'$unwind':_0x11a2eb(0x29d)},{'$match':{'product_details.primary_code':_0x1bbcb8}},{'$group':{'_id':_0x11a2eb(0x28b),'name':{'$first':_0x11a2eb(0x2c1)},'product_stock':{'$first':_0x11a2eb(0x268)},'primary_code':{'$first':_0x11a2eb(0x2a1)},'secondary_code':{'$first':_0x11a2eb(0x2e9)},'product_code':{'$first':_0x11a2eb(0x2d0)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x11a2eb(0x23e)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x11a2eb(0x278)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x11a2eb(0x1e5)},'maxPerUnit':{'$first':_0x11a2eb(0x2a8)},'batch_code':{'$first':_0x11a2eb(0x267)},'product_cat':{'$first':_0x11a2eb(0x25d)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x11a2eb(0x203)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x11a2eb(0x211)}}}]),_0x3dc382=await warehouse[_0x11a2eb(0x240)]([{'$match':{'name':_0x15569e,'room':_0x173267}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x1bbcb8}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x11a2eb(0x2c1)},'product_stock':{'$first':_0x11a2eb(0x268)},'primary_code':{'$first':_0x11a2eb(0x2a1)},'secondary_code':{'$first':_0x11a2eb(0x2e9)},'product_code':{'$first':_0x11a2eb(0x2d0)},'level':{'$first':_0x11a2eb(0x28f)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x11a2eb(0x273)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x11a2eb(0x278)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x11a2eb(0x244)},'rack':{'$first':_0x11a2eb(0x2de)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x11a2eb(0x1e5)},'maxPerUnit':{'$first':_0x11a2eb(0x2a8)},'batch_code':{'$first':_0x11a2eb(0x267)},'product_cat':{'$first':_0x11a2eb(0x25d)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x11a2eb(0x21e)},'invoice':{'$first':_0x11a2eb(0x203)}}}]);if(_0x4bb483['length']>0x0)_0x35d654['push'](_0x4bb483);else _0x3dc382[_0x11a2eb(0x236)]>0x0&&_0x35d654['push'](_0x3dc382);}const _0x324d25=_0x166dc9[_0x56ca5d(0x229)](_0x165f3b=>_0x5a2f78(_0x165f3b));await Promise[_0x56ca5d(0x2c2)](_0x324d25),_0x3bb519[_0x56ca5d(0x28c)](_0x35d654);}),module[a0_0x326b1a(0x26c)]=router;