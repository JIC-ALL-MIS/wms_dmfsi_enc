function a0_0x192f(_0x6470ae,_0x51ca91){var _0x3fe2bb=a0_0x3fe2();return a0_0x192f=function(_0x192fdb,_0x345d1e){_0x192fdb=_0x192fdb-0xd9;var _0x3a37b0=_0x3fe2bb[_0x192fdb];return _0x3a37b0;},a0_0x192f(_0x6470ae,_0x51ca91);}var a0_0x173fe7=a0_0x192f;(function(_0xae03cf,_0x1eb49c){var _0x131cb4=a0_0x192f,_0x597aa5=_0xae03cf();while(!![]){try{var _0x2300fe=parseInt(_0x131cb4(0x10a))/0x1+parseInt(_0x131cb4(0x19e))/0x2*(parseInt(_0x131cb4(0xf1))/0x3)+parseInt(_0x131cb4(0x1d3))/0x4+-parseInt(_0x131cb4(0xfb))/0x5*(parseInt(_0x131cb4(0x10e))/0x6)+-parseInt(_0x131cb4(0x14c))/0x7*(-parseInt(_0x131cb4(0xf4))/0x8)+-parseInt(_0x131cb4(0x19f))/0x9+-parseInt(_0x131cb4(0x190))/0xa*(-parseInt(_0x131cb4(0x125))/0xb);if(_0x2300fe===_0x1eb49c)break;else _0x597aa5['push'](_0x597aa5['shift']());}catch(_0x1b43ef){_0x597aa5['push'](_0x597aa5['shift']());}}}(a0_0x3fe2,0x3ddbb));const express=require(a0_0x173fe7(0x1c0)),app=express(),router=express[a0_0x173fe7(0x16b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x173fe7(0x172)),auth=require('../middleware/auth'),nodemailer=require(a0_0x173fe7(0x15e)),users=require(a0_0x173fe7(0x11f));router['get'](a0_0x173fe7(0x151),auth,async(_0x2f4287,_0x2a7bff)=>{var _0x22412e=a0_0x173fe7;try{const {username:_0x43bb99,email:_0x3affe6,role:_0x20008c}=_0x2f4287['user'],_0x40fdd3=_0x2f4287[_0x22412e(0x193)],_0x1ce4bf=await profile[_0x22412e(0x113)]({'email':_0x40fdd3[_0x22412e(0x1d0)]}),_0x431a2a=await master_shop['find']();let _0x4eb157;if(_0x40fdd3[_0x22412e(0x11d)]==_0x22412e(0x1d6)){const _0x3ddd03=await staff[_0x22412e(0x113)]({'email':_0x40fdd3[_0x22412e(0x1d0)]});_0x4eb157=await sales[_0x22412e(0x15a)]([{'$lookup':{'from':_0x22412e(0x158),'localField':'customer','foreignField':_0x22412e(0x17c),'as':_0x22412e(0x1da)}},{'$unwind':_0x22412e(0xdd)},{'$unwind':_0x22412e(0x13b)},{'$group':{'_id':_0x22412e(0x117),'invoice':{'$first':_0x22412e(0x196)},'customers':{'$first':'$customer'},'date':{'$first':_0x22412e(0x12b)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x22412e(0x13b)},'note':{'$first':'$note'},'return_data':{'$first':_0x22412e(0x115)},'customers_docs':{'$first':_0x22412e(0xdd)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x22412e(0x1b0)},'isle':{'$addToSet':_0x22412e(0x166)},'type':{'$addToSet':_0x22412e(0x1ac)},'pallet':{'$addToSet':_0x22412e(0x118)},'finalize':{'$first':_0x22412e(0x10b)},'isAllowEdit':{'$first':_0x22412e(0x159)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x4eb157=await sales[_0x22412e(0x15a)]([{'$lookup':{'from':_0x22412e(0x158),'localField':_0x22412e(0x1c5),'foreignField':_0x22412e(0x17c),'as':_0x22412e(0x1da)}},{'$unwind':'$customers_docs'},{'$unwind':_0x22412e(0x13b)},{'$group':{'_id':_0x22412e(0x117),'invoice':{'$first':_0x22412e(0x196)},'customers':{'$first':_0x22412e(0x1bb)},'date':{'$first':_0x22412e(0x12b)},'warehouse_name':{'$first':_0x22412e(0x142)},'sale_product':{'$push':_0x22412e(0x13b)},'note':{'$first':_0x22412e(0x1c6)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x22412e(0xdd)},'total_saleproduct_quantity':{'$sum':_0x22412e(0x179)},'level':{'$addToSet':_0x22412e(0x1b0)},'isle':{'$addToSet':_0x22412e(0x166)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x22412e(0x10b)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x22412e(0x12d)](_0x22412e(0x165),_0x4eb157);if(_0x431a2a[0x0]['language']==_0x22412e(0x1b2)){var _0x44c48d=users[_0x22412e(0x16f)];console[_0x22412e(0x12d)](_0x44c48d);}else{if(_0x431a2a[0x0][_0x22412e(0x1b3)]==_0x22412e(0x16c))var _0x44c48d=users['Hindi'];else{if(_0x431a2a[0x0][_0x22412e(0x1b3)]==_0x22412e(0x1d9))var _0x44c48d=users[_0x22412e(0x1d9)];else{if(_0x431a2a[0x0][_0x22412e(0x1b3)]==_0x22412e(0x14b))var _0x44c48d=users[_0x22412e(0x14b)];else{if(_0x431a2a[0x0][_0x22412e(0x1b3)]==_0x22412e(0x1cf))var _0x44c48d=users[_0x22412e(0x1cf)];else{if(_0x431a2a[0x0][_0x22412e(0x1b3)]==_0x22412e(0x112))var _0x44c48d=users['Portuguese'];else{if(_0x431a2a[0x0]['language']=='Chinese')var _0x44c48d=users[_0x22412e(0x12e)];else{if(_0x431a2a[0x0][_0x22412e(0x1b3)]=='Arabic\x20(ae)')var _0x44c48d=users[_0x22412e(0x191)];}}}}}}}_0x2a7bff[_0x22412e(0x1a7)]('all_sales',{'success':_0x2f4287['flash'](_0x22412e(0x130)),'errors':_0x2f4287[_0x22412e(0x1ca)](_0x22412e(0x1a3)),'sales':_0x4eb157,'profile':_0x1ce4bf,'role':_0x40fdd3,'master_shop':_0x431a2a,'language':_0x44c48d});}catch(_0x46be7b){console['log'](_0x46be7b);}});async function getRandom8DigitNumber(){var _0x5b831e=a0_0x173fe7;const _0x40ecdf=0x989680,_0x2d3a32=0x5f5e0ff,_0x32f2de=Math['floor'](Math['random']()*(_0x2d3a32-_0x40ecdf+0x1))+_0x40ecdf;var _0x389b96;const _0x280ed4=await sales[_0x5b831e(0x113)]({'invoice':'OUT-'+_0x32f2de});return _0x280ed4&&_0x280ed4[_0x5b831e(0x171)]>0x0?_0x389b96=_0x5b831e(0x1df)+_0x32f2de:_0x389b96=_0x5b831e(0x1df)+_0x32f2de,_0x389b96;}router[a0_0x173fe7(0x19b)](a0_0x173fe7(0x182),auth,async(_0x3af72,_0x3967c7)=>{var _0x4e1345=a0_0x173fe7;try{const {username:_0x5f570d,email:_0x2eeb2f,role:_0x53c05a}=_0x3af72['user'],_0x5c32d2=_0x3af72['user'],_0x247791=await profile[_0x4e1345(0x113)]({'email':_0x5c32d2[_0x4e1345(0x1d0)]}),_0x2bd90c=await master_shop[_0x4e1345(0x108)](),_0x2e68df=await customer[_0x4e1345(0x108)]({});let _0x382809;if(_0x5c32d2['role']=='staff'){const _0x5b94d7=await staff[_0x4e1345(0x113)]({'email':_0x5c32d2[_0x4e1345(0x1d0)]});_0x382809=await warehouse[_0x4e1345(0x15a)]([{'$match':{'status':'Enabled','name':_0x5b94d7['warehouse'],'warehouse_category':_0x4e1345(0x127),'name':{'$ne':_0x4e1345(0x18c)}}},{'$group':{'_id':'$name','name':{'$first':_0x4e1345(0x174)}}},{'$sort':{'name':0x1}}]);}else _0x382809=await warehouse[_0x4e1345(0x15a)]([{'$match':{'status':_0x4e1345(0x126),'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x4e1345(0x174),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x3b44de=await product[_0x4e1345(0x108)]({});var _0x40cf50=[_0x4e1345(0x1d4),_0x4e1345(0x15b)];const _0x3655df=await sales[_0x4e1345(0x108)]({}),_0x9c0428=_0x3655df[_0x4e1345(0x171)]+0x1,_0x19dc86=_0x4e1345(0x1df)+_0x9c0428[_0x4e1345(0x14e)]()[_0x4e1345(0x167)](0x5,'0');if(_0x2bd90c[0x0][_0x4e1345(0x1b3)]==_0x4e1345(0x1b2)){var _0x232a6a=users['English'];console[_0x4e1345(0x12d)](_0x232a6a);}else{if(_0x2bd90c[0x0]['language']==_0x4e1345(0x16c))var _0x232a6a=users[_0x4e1345(0x16c)];else{if(_0x2bd90c[0x0][_0x4e1345(0x1b3)]=='German')var _0x232a6a=users[_0x4e1345(0x1d9)];else{if(_0x2bd90c[0x0][_0x4e1345(0x1b3)]==_0x4e1345(0x14b))var _0x232a6a=users[_0x4e1345(0x14b)];else{if(_0x2bd90c[0x0]['language']=='French')var _0x232a6a=users[_0x4e1345(0x1cf)];else{if(_0x2bd90c[0x0][_0x4e1345(0x1b3)]==_0x4e1345(0x112))var _0x232a6a=users['Portuguese'];else{if(_0x2bd90c[0x0]['language']==_0x4e1345(0x12e))var _0x232a6a=users[_0x4e1345(0x12e)];else{if(_0x2bd90c[0x0][_0x4e1345(0x1b3)]==_0x4e1345(0x17d))var _0x232a6a=users[_0x4e1345(0x191)];}}}}}}}const _0xec5532=getRandom8DigitNumber();_0xec5532['then'](_0x16679e=>{var _0xbdf3ee=_0x4e1345;_0x3967c7[_0xbdf3ee(0x1a7)]('add_sales',{'success':_0x3af72[_0xbdf3ee(0x1ca)](_0xbdf3ee(0x130)),'errors':_0x3af72['flash'](_0xbdf3ee(0x1a3)),'role':_0x5c32d2,'profile':_0x247791,'customer':_0x2e68df,'warehouse':_0x382809,'product':_0x3b44de,'invoice':_0x16679e,'master_shop':_0x2bd90c,'language':_0x232a6a,'rooms_data':_0x40cf50});})[_0x4e1345(0x1a5)](_0x5e6d6c=>{var _0x593396=_0x4e1345;_0x3af72['flash']('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3967c7[_0x593396(0x1b9)](_0x593396(0x150));});}catch(_0x18addf){console[_0x4e1345(0x12d)](_0x18addf);}}),router['get'](a0_0x173fe7(0x152),auth,async(_0x2cf923,_0x1d9c89)=>{var _0x58d464=a0_0x173fe7;try{const _0x54b8f2=_0x2cf923[_0x58d464(0xe2)]['id'];console[_0x58d464(0x12d)](_0x54b8f2);const _0x2f6351=await product[_0x58d464(0x108)](),_0x1a699e=await purchases[_0x58d464(0x15a)]([{'$match':{'warehouse_name':_0x54b8f2}},{'$unwind':_0x58d464(0x1b5)},{'$group':{'_id':_0x58d464(0x10d)}}]);console[_0x58d464(0x12d)]('purchases_data',_0x1a699e),_0x1d9c89[_0x58d464(0xfd)](0xc8)[_0x58d464(0xe9)]({'purchases_data':_0x1a699e,'product_data':_0x2f6351});}catch(_0x288464){console[_0x58d464(0x12d)](_0x288464);}}),router[a0_0x173fe7(0x160)](a0_0x173fe7(0x1b4),auth,async(_0x426f22,_0x42d837)=>{var _0xed0138=a0_0x173fe7;try{const {warehouse_data:_0x55b307,product_data:_0x4af55b}=_0x426f22['body'];console[_0xed0138(0x12d)](_0x426f22[_0xed0138(0x181)]['product_data']);;const _0x421ed7=await master_shop[_0xed0138(0x108)]();console['log'](_0xed0138(0x1c4),_0x421ed7);const _0x803fce=await product['findOne']({'name':_0x4af55b});console[_0xed0138(0x12d)](_0xed0138(0x1cc),_0x803fce);const _0x15df77=await warehouse[_0xed0138(0x15a)]([{'$match':{'name':_0x55b307}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x4af55b}},{'$group':{'_id':_0xed0138(0x131),'product_stock':{'$first':_0xed0138(0x128)}}}]);console['log']('stock_data',_0x15df77),_0x42d837[_0xed0138(0xfd)](0xc8)[_0xed0138(0xe9)]({'master':_0x421ed7,'new_product':_0x803fce,'stock_data':_0x15df77});}catch(_0xdcaeba){console[_0xed0138(0x12d)](_0xdcaeba);}}),router[a0_0x173fe7(0x160)](a0_0x173fe7(0x182),auth,async(_0x3ab6f6,_0x4c32e4)=>{var _0x4f5a91=a0_0x173fe7;try{const {invoice:_0x1b6339,date:_0x224bd2,warehouse_name:_0x15a1f6,product_name:_0xe0ed8f,stock:_0x468a6b,quantity:_0x16caab,note:_0x1e67f0,room:_0x1e5e11,primary_code:_0x54cb94,secondary_code:_0x474bdc,prod_code:_0x9c7b37,level:_0x48b2e3,isle:_0xd220fe,pallet:_0x20e876,batch_code:_0x48a6e1,SCRN:_0x4c81e2,expiry_date:_0x4ffc02}=_0x3ab6f6[_0x4f5a91(0x181)];if(typeof _0xe0ed8f==_0x4f5a91(0xdf))var _0x5b1b5e=[_0x3ab6f6[_0x4f5a91(0x181)]['product_name']],_0x29390a=[_0x3ab6f6[_0x4f5a91(0x181)]['stock']],_0x534f0d=[_0x3ab6f6['body'][_0x4f5a91(0x11b)]],_0xd07f63=[_0x3ab6f6['body'][_0x4f5a91(0x1dc)]],_0x191e85=[_0x3ab6f6['body'][_0x4f5a91(0x1c8)]],_0x38af9e=[_0x3ab6f6['body']['prod_code']],_0x118240=[_0x3ab6f6[_0x4f5a91(0x181)]['level']],_0xc1cd11=[_0x3ab6f6['body'][_0x4f5a91(0x15f)]],_0x11c5af=[_0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x15c)]],_0x54f152=[_0x3ab6f6['body'][_0x4f5a91(0x194)]],_0xe56990=[_0x3ab6f6[_0x4f5a91(0x181)]['expiry_date']],_0x3b60b5=[_0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x16a)]],_0x1362f7=[_0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x1c7)]],_0x42c366=[_0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x12f)]],_0x35a416=[_0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x149)]],_0x1f7e06=[_0x3ab6f6['body'][_0x4f5a91(0x124)]],_0x528923=[_0x3ab6f6['body']['prod_cat']],_0x544c1c=[_0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x148)]],_0x40d26f=[_0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x106)]],_0x448e06=[_0x3ab6f6[_0x4f5a91(0x181)]['prod_invoice']],_0x3aecc8=[_0x3ab6f6['body']['actual_qty']],_0x43e142=[_0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x162)]];else var _0x5b1b5e=[..._0x3ab6f6['body'][_0x4f5a91(0x1c9)]],_0x29390a=[..._0x3ab6f6['body'][_0x4f5a91(0x1d5)]],_0x534f0d=[..._0x3ab6f6[_0x4f5a91(0x181)]['carton']],_0xd07f63=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x1dc)]],_0x191e85=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x1c8)]],_0x38af9e=[..._0x3ab6f6[_0x4f5a91(0x181)]['prod_code']],_0x118240=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x1d1)]],_0xc1cd11=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x15f)]],_0x11c5af=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x15c)]],_0x54f152=[..._0x3ab6f6['body']['batch_code']],_0xe56990=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0xfe)]],_0x3b60b5=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x16a)]],_0x1362f7=[..._0x3ab6f6['body'][_0x4f5a91(0x1c7)]],_0x42c366=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x12f)]],_0x35a416=[..._0x3ab6f6['body'][_0x4f5a91(0x149)]],_0x1f7e06=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x124)]],_0x528923=[..._0x3ab6f6['body']['prod_cat']],_0x544c1c=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0x148)]],_0x40d26f=[..._0x3ab6f6[_0x4f5a91(0x181)]['RoomAssigned']],_0x448e06=[..._0x3ab6f6[_0x4f5a91(0x181)][_0x4f5a91(0xee)]],_0x3aecc8=[..._0x3ab6f6['body']['actual_qty']],_0x43e142=[..._0x3ab6f6['body'][_0x4f5a91(0x162)]];const _0x238f2c=_0x5b1b5e[_0x4f5a91(0x19c)](_0x1e24d8=>{return _0x1e24d8={'product_name':_0x1e24d8};});_0x29390a['forEach']((_0x43e8e0,_0x483e3c)=>{var _0x21838b=_0x4f5a91;_0x238f2c[_0x483e3c][_0x21838b(0x1d5)]=Math[_0x21838b(0xe1)](_0x43e8e0);}),_0x3aecc8[_0x4f5a91(0xd9)]((_0x37502f,_0x462663)=>{var _0x3a8083=_0x4f5a91;_0x238f2c[_0x462663]['actual_qty']=Math[_0x3a8083(0xe1)](_0x37502f);}),_0x43e142[_0x4f5a91(0xd9)]((_0x5e9fa0,_0x3cbce6)=>{var _0x52f420=_0x4f5a91;_0x238f2c[_0x3cbce6][_0x52f420(0x162)]=_0x5e9fa0;}),_0x534f0d[_0x4f5a91(0xd9)]((_0x5ca85e,_0x441852)=>{_0x238f2c[_0x441852]['quantity']=_0x5ca85e;}),_0xd07f63[_0x4f5a91(0xd9)]((_0x3f4926,_0x2564ae)=>{var _0x56e687=_0x4f5a91;_0x238f2c[_0x2564ae][_0x56e687(0x1dc)]=_0x3f4926;}),_0x191e85[_0x4f5a91(0xd9)]((_0x11e381,_0x1d811c)=>{_0x238f2c[_0x1d811c]['secondary_code']=_0x11e381;}),_0x38af9e['forEach']((_0x10a7ad,_0x123f20)=>{_0x238f2c[_0x123f20]['product_code']=_0x10a7ad;}),_0x118240[_0x4f5a91(0xd9)]((_0x1ff9e9,_0x4081d1)=>{_0x40d26f['forEach']((_0x26a713,_0x2ea89c)=>{var _0x1da45a=a0_0x192f;if(_0x26a713=='Receiving\x20Area'&&_0x4081d1==_0x2ea89c){var _0x540282=_0x1ff9e9[_0x1da45a(0x13a)](0x3);_0x238f2c[_0x4081d1][_0x1da45a(0x11c)]=_0x1ff9e9[0x0],_0x238f2c[_0x4081d1][_0x1da45a(0x141)]=_0x1ff9e9[0x1],_0x238f2c[_0x4081d1][_0x1da45a(0x101)]=0x0,_0x238f2c[_0x4081d1][_0x1da45a(0x19a)]=0x0,_0x238f2c[_0x4081d1][_0x1da45a(0xe8)]=_0x1da45a(0x132),_0x238f2c[_0x4081d1][_0x1da45a(0x135)]=_0x540282;}else{if(_0x26a713==_0x1da45a(0x103)&&_0x4081d1==_0x2ea89c){var _0x540282=_0x1ff9e9[_0x1da45a(0x13a)](0x3);_0x238f2c[_0x4081d1][_0x1da45a(0x11c)]=_0x1ff9e9[0x0],_0x238f2c[_0x4081d1][_0x1da45a(0x141)]=_0x1ff9e9[0x1],_0x238f2c[_0x4081d1][_0x1da45a(0x101)]=0x0,_0x238f2c[_0x4081d1]['bin']=0x0,_0x238f2c[_0x4081d1][_0x1da45a(0xe8)]=_0x1da45a(0x132),_0x238f2c[_0x4081d1][_0x1da45a(0x135)]=_0x1ff9e9[0x5];}else{if(_0x4081d1==_0x2ea89c){var _0x166c08;if(_0x1ff9e9[0x4]=='L')_0x166c08=_0x1da45a(0x1a2);else _0x1ff9e9[0x4]=='F'&&(_0x166c08=_0x1da45a(0x132));_0x238f2c[_0x4081d1]['storage']=_0x1ff9e9[0x0],_0x238f2c[_0x4081d1]['rack']=_0x1ff9e9[0x1],_0x238f2c[_0x4081d1][_0x1da45a(0x101)]=_0x1ff9e9[0x2],_0x238f2c[_0x4081d1][_0x1da45a(0x19a)]=_0x1ff9e9[0x3],_0x238f2c[_0x4081d1][_0x1da45a(0xe8)]=_0x166c08,_0x238f2c[_0x4081d1][_0x1da45a(0x135)]=_0x1ff9e9[0x5];}}}});}),_0xc1cd11[_0x4f5a91(0xd9)]((_0xa80b5b,_0xf802b)=>{var _0x607e4f=_0x4f5a91;_0x238f2c[_0xf802b][_0x607e4f(0xec)]=_0xa80b5b;}),_0x11c5af['forEach']((_0x23c636,_0x1f300c)=>{var _0x2dcd7f=_0x4f5a91;_0x238f2c[_0x1f300c][_0x2dcd7f(0x15c)]=_0x23c636;}),_0x54f152[_0x4f5a91(0xd9)]((_0x1f7a3c,_0x475ef4)=>{_0x238f2c[_0x475ef4]['batch_code']=_0x1f7a3c;}),_0xe56990[_0x4f5a91(0xd9)]((_0x4af423,_0x1ae0b8)=>{_0x238f2c[_0x1ae0b8]['expiry_date']=_0x4af423;}),_0x3b60b5[_0x4f5a91(0xd9)]((_0xfe0089,_0x388027)=>{var _0x3b03ca=_0x4f5a91;_0x238f2c[_0x388027][_0x3b03ca(0xe6)]=_0xfe0089;}),_0x1362f7['forEach']((_0x307511,_0x2dedba)=>{var _0x530e2f=_0x4f5a91;_0x238f2c[_0x2dedba][_0x530e2f(0x1c7)]=_0x307511;}),_0x42c366['forEach']((_0x19b321,_0x1e0252)=>{var _0x40f53c=_0x4f5a91;_0x238f2c[_0x1e0252][_0x40f53c(0x12f)]=_0x19b321;}),_0x35a416[_0x4f5a91(0xd9)]((_0x2072e3,_0x2daa28)=>{_0x238f2c[_0x2daa28]['delivery_date']=_0x2072e3;}),_0x1f7e06[_0x4f5a91(0xd9)]((_0xe84b7b,_0x4c79fb)=>{_0x238f2c[_0x4c79fb]['delivery_code']=_0xe84b7b;}),_0x528923[_0x4f5a91(0xd9)]((_0x5ed0ca,_0x813f1e)=>{var _0x105b75=_0x4f5a91;_0x238f2c[_0x813f1e][_0x105b75(0x10c)]=_0x5ed0ca;}),_0x544c1c[_0x4f5a91(0xd9)]((_0x2bdddd,_0x2d5589)=>{var _0x1fd239=_0x4f5a91;_0x238f2c[_0x2d5589][_0x1fd239(0x114)]=_0x2bdddd;}),_0x40d26f[_0x4f5a91(0xd9)]((_0x1e3c38,_0x1fb92c)=>{var _0x5644e1=_0x4f5a91;_0x238f2c[_0x1fb92c][_0x5644e1(0x14d)]=_0x1e3c38;}),_0x448e06[_0x4f5a91(0xd9)]((_0x18411b,_0x1d08b4)=>{var _0x3edf31=_0x4f5a91;_0x238f2c[_0x1d08b4][_0x3edf31(0x18f)]=_0x18411b;});var _0x128c27=0x0;_0x238f2c['forEach'](_0x4376ef=>{var _0xa830d4=_0x4f5a91;(_0x4376ef[_0xa830d4(0x1d5)]<_0x4376ef[_0xa830d4(0x114)]||_0x4376ef['quantity_notConverted']==0x0)&&(console['log'](_0xa830d4(0x184),_0x4376ef),_0x128c27++);});const _0x45150a=_0x238f2c[_0x4f5a91(0x1a0)](_0xa08a82=>_0xa08a82[_0x4f5a91(0x148)]!=='0'&&_0xa08a82[_0x4f5a91(0x148)]!==''),_0x5c603a=new sales({'invoice':_0x1b6339,'customer':_0x3ab6f6['body'][_0x4f5a91(0x1c5)],'date':_0x224bd2,'warehouse_name':_0x15a1f6,'sale_product':_0x45150a,'note':_0x1e67f0,'room':_0x1e5e11,'primary_code':_0x54cb94,'secondary_code':_0x474bdc,'prod_code':_0x9c7b37,'SCRN':_0x4c81e2}),_0x20f0f7=await _0x5c603a[_0x4f5a91(0x178)]();_0x3ab6f6[_0x4f5a91(0x1ca)](_0x4f5a91(0x130),'Sales\x20Add\x20successfully'),_0x4c32e4['redirect'](_0x4f5a91(0xfc)+_0x20f0f7[_0x4f5a91(0x17f)]);}catch(_0x17eaf3){console[_0x4f5a91(0x12d)](_0x17eaf3);}}),router[a0_0x173fe7(0x19b)](a0_0x173fe7(0xf8),auth,async(_0xfc406a,_0x5534f7)=>{var _0xcd350c=a0_0x173fe7;try{const {username:_0x530bde,email:_0x19b268,role:_0x441742}=_0xfc406a[_0xcd350c(0x193)],_0x5321b6=_0xfc406a[_0xcd350c(0x193)],_0x43195e=await profile[_0xcd350c(0x113)]({'email':_0x5321b6[_0xcd350c(0x1d0)]}),_0x57a62b=await master_shop['find'](),_0x3cf5dc=_0xfc406a['params']['id'],_0x25bb7b=await sales[_0xcd350c(0x168)](_0x3cf5dc),_0x1a9fe9=await warehouse[_0xcd350c(0x15a)]([{'$match':{'name':_0x25bb7b[_0xcd350c(0x185)]}},{'$unwind':_0xcd350c(0x1e0)},{'$group':{'_id':_0xcd350c(0x1bf),'name':{'$first':_0xcd350c(0x131)},'product_stock':{'$first':_0xcd350c(0x128)},'bay':{'$first':_0xcd350c(0xf0)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xcd350c(0x19d)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xcd350c(0x1d2)},'product_code':{'$first':_0xcd350c(0xe4)},'storage':{'$first':_0xcd350c(0x1aa)},'rack':{'$first':_0xcd350c(0x192)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0xcd350c(0x1c2)}}}]),_0x41651d=await customer[_0xcd350c(0x108)]({});let _0x22d145;if(_0x5321b6[_0xcd350c(0x11d)]==_0xcd350c(0x1d6)){const _0x2c3524=await staff['findOne']({'email':_0x5321b6['email']});_0x22d145=await warehouse['aggregate']([{'$match':{'status':_0xcd350c(0x126),'name':_0x2c3524[_0xcd350c(0x1d7)]}},{'$group':{'_id':'$name','name':{'$first':_0xcd350c(0x174)}}}]);}else _0x22d145=await warehouse[_0xcd350c(0x15a)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0xcd350c(0x174),'name':{'$first':'$name'}}}]);const _0x4ce9cb=await product[_0xcd350c(0x108)]({}),_0x29d8aa=await suppliers['find']({});if(_0x57a62b[0x0][_0xcd350c(0x1b3)]=='English\x20(US)'){var _0x55db32=users[_0xcd350c(0x16f)];console[_0xcd350c(0x12d)](_0x55db32);}else{if(_0x57a62b[0x0][_0xcd350c(0x1b3)]==_0xcd350c(0x16c))var _0x55db32=users[_0xcd350c(0x16c)];else{if(_0x57a62b[0x0][_0xcd350c(0x1b3)]==_0xcd350c(0x1d9))var _0x55db32=users[_0xcd350c(0x1d9)];else{if(_0x57a62b[0x0]['language']==_0xcd350c(0x14b))var _0x55db32=users[_0xcd350c(0x14b)];else{if(_0x57a62b[0x0][_0xcd350c(0x1b3)]==_0xcd350c(0x1cf))var _0x55db32=users[_0xcd350c(0x1cf)];else{if(_0x57a62b[0x0][_0xcd350c(0x1b3)]=='Portuguese\x20(BR)')var _0x55db32=users['Portuguese'];else{if(_0x57a62b[0x0]['language']==_0xcd350c(0x12e))var _0x55db32=users[_0xcd350c(0x12e)];else{if(_0x57a62b[0x0]['language']=='Arabic\x20(ae)')var _0x55db32=users[_0xcd350c(0x191)];}}}}}}}_0x5534f7[_0xcd350c(0x1a7)](_0xcd350c(0x1b6),{'success':_0xfc406a[_0xcd350c(0x1ca)]('success'),'errors':_0xfc406a[_0xcd350c(0x1ca)](_0xcd350c(0x1a3)),'role':_0x5321b6,'profile':_0x43195e,'customer':_0x41651d,'warehouse':_0x22d145,'product':_0x1a9fe9,'user':_0x25bb7b,'master_shop':_0x57a62b,'unit':_0x4ce9cb,'language':_0x55db32,'suppliers':_0x29d8aa});}catch(_0x38f181){console[_0xcd350c(0x12d)](_0x38f181);}}),router['post'](a0_0x173fe7(0xf8),auth,async(_0xa38025,_0x4c2b2e)=>{var _0x41d2a2=a0_0x173fe7;try{const _0x3d4f51=_0xa38025['params']['id'],{invoice:_0x4fe914,warehouse_name:_0x3218f6,room:_0x298b21}=_0xa38025[_0x41d2a2(0x181)],_0x372a71=await sales['findOne']({'invoice':_0x4fe914}),_0x235834=_0x372a71['sale_product'][_0x41d2a2(0x19c)](async _0x49f30a=>{var _0x448159=_0x41d2a2,_0x4e4fbc=await warehouse[_0x448159(0x113)]({'name':_0x3218f6,'room':_0x49f30a[_0x448159(0x14d)],'warehouse_category':_0x448159(0x127)});const _0x410083=_0x4e4fbc[_0x448159(0xed)][_0x448159(0x19c)](_0x346826=>{var _0x1764fc=_0x448159;_0x346826[_0x1764fc(0x1c9)]==_0x49f30a['product_name']&&_0x346826[_0x1764fc(0x135)]==_0x49f30a[_0x1764fc(0x135)]&&_0x346826[_0x1764fc(0xe8)]==_0x49f30a['type']&&_0x346826[_0x1764fc(0x19a)]==_0x49f30a[_0x1764fc(0x19a)]&&_0x346826[_0x1764fc(0x101)]==_0x49f30a[_0x1764fc(0x101)]&&_0x346826[_0x1764fc(0x141)]==_0x49f30a['rack']&&_0x346826['storage']==_0x49f30a[_0x1764fc(0x11c)]&&_0x346826[_0x1764fc(0xfe)]==_0x49f30a[_0x1764fc(0xfe)]&&_0x346826['batch_code']==_0x49f30a['batch_code']&&_0x346826[_0x1764fc(0x18f)]==_0x49f30a['invoice']&&(_0x346826[_0x1764fc(0x120)]=Math[_0x1764fc(0xe1)](_0x346826[_0x1764fc(0x120)])-Math[_0x1764fc(0xe1)](_0x49f30a['quantity']));});return _0x4e4fbc;});Promise[_0x41d2a2(0xf3)](_0x235834)[_0x41d2a2(0x146)](async _0x4ae59a=>{var _0x59df80=_0x41d2a2;try{for(const _0x35be9a of _0x4ae59a){await _0x35be9a['save']();}_0x372a71[_0x59df80(0x13f)]=_0x59df80(0x12a);const _0x138a1f=await _0x372a71[_0x59df80(0x178)](),_0x550953=await master_shop[_0x59df80(0x108)](),_0x436994=await email_settings[_0x59df80(0x113)](),_0x5ac7a6=await supervisor_settings[_0x59df80(0x108)]();var _0x270c09=_0x372a71['sale_product'],_0x47835b='',_0x5d3163;for(_0x5d3163 in _0x270c09){_0x47835b+=_0x59df80(0x1db)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x270c09[_0x5d3163][_0x59df80(0x1c9)]+_0x59df80(0x163)+_0x59df80(0x18d)+_0x270c09[_0x5d3163]['product_code']+_0x59df80(0x163)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x270c09[_0x5d3163][_0x59df80(0x148)]+_0x59df80(0x163)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x270c09[_0x5d3163][_0x59df80(0xec)]+_0x59df80(0x163)+_0x59df80(0x18d)+_0x270c09[_0x5d3163][_0x59df80(0x15c)]+_0x59df80(0x163)+_0x59df80(0x18d)+_0x372a71[_0x59df80(0x185)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x270c09[_0x5d3163][_0x59df80(0x14d)]+_0x59df80(0x163)+_0x59df80(0x18d)+_0x270c09[_0x5d3163][_0x59df80(0x11c)]+_0x270c09[_0x5d3163]['rack']+_0x270c09[_0x5d3163][_0x59df80(0x101)]+_0x270c09[_0x5d3163][_0x59df80(0x19a)]+_0x270c09[_0x5d3163]['type'][0x0]+_0x270c09[_0x5d3163]['floorlevel']+_0x59df80(0x163),'</tr>';}let _0x149c84=nodemailer[_0x59df80(0x153)]({'host':_0x436994[_0x59df80(0x183)],'port':Number(_0x436994[_0x59df80(0x136)]),'secure':![],'auth':{'user':_0x436994[_0x59df80(0x1d0)],'pass':_0x436994[_0x59df80(0x1ab)]}}),_0x1edbfd={'from':_0x436994['email'],'to':_0x5ac7a6[0x0]['RMSEmail'],'subject':_0x59df80(0xfa),'attachments':[{'filename':_0x59df80(0x14a),'path':__dirname+'/../public'+'/upload/'+_0x550953[0x0]['image'],'cid':_0x59df80(0x1ae)}],'html':_0x59df80(0x116)+_0x59df80(0x169)+_0x59df80(0x13e)+_0x59df80(0x1a9)+_0x59df80(0x175)+'<div>'+_0x59df80(0x100)+_0x59df80(0xe7)+_0x59df80(0x1a9)+'<h2>\x20'+_0x550953[0x0][_0x59df80(0x1cd)]+_0x59df80(0x1c3)+_0x59df80(0xe7)+_0x59df80(0xe7)+_0x59df80(0xef)+'<div>'+_0x59df80(0x1c1)+_0x59df80(0x122)+_0x372a71[_0x59df80(0x18f)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x59df80(0x105)+_0x372a71[_0x59df80(0xe0)]+'\x20'+_0x59df80(0x1b1)+_0x59df80(0x1b8)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x59df80(0x164)+_0x59df80(0x1db)+_0x59df80(0x188)+_0x59df80(0x12c)+_0x59df80(0x198)+_0x59df80(0x18e)+_0x59df80(0xdb)+_0x59df80(0x123)+_0x59df80(0x15d)+_0x59df80(0xf6)+_0x59df80(0x1af)+_0x59df80(0x104)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x47835b+'\x20'+_0x59df80(0x18b)+_0x59df80(0x109)+'<div>'+_0x59df80(0x177)+_0x59df80(0xdc)+_0x550953[0x0]['site_title']+_0x59df80(0x1b8)+_0x59df80(0xe7)+'</div>'+'</body></html>'};_0x149c84[_0x59df80(0x170)](_0x1edbfd,function(_0x15052c,_0x206c64){var _0x5512c6=_0x59df80;_0x15052c?(console[_0x5512c6(0x12d)](_0x15052c),console[_0x5512c6(0x12d)](_0x5512c6(0x17e))):console[_0x5512c6(0x12d)]('Email\x20sent\x20successfully');}),_0xa38025[_0x59df80(0x1ca)](_0x59df80(0x130),_0x59df80(0x1ce)),_0x4c2b2e[_0x59df80(0x1b9)](_0x59df80(0xfc)+_0x3d4f51);}catch(_0x3d484c){console[_0x59df80(0x1a8)](_0x3d484c),_0x4c2b2e['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x109bce=>{var _0x1f2dd6=_0x41d2a2;console[_0x1f2dd6(0x1a8)](_0x109bce),_0x4c2b2e[_0x1f2dd6(0xfd)](0x1f4)[_0x1f2dd6(0xe9)]({'error':_0x1f2dd6(0x119)});});}catch(_0x4544f3){console[_0x41d2a2(0x12d)](_0x4544f3);}}),router['get']('/view/:id',auth,async(_0x232e3b,_0x6414e8)=>{var _0x10a340=a0_0x173fe7;try{const {username:_0x33b76c,email:_0x37553e,role:_0x587bb3}=_0x232e3b[_0x10a340(0x193)],_0x47d209=_0x232e3b['user'],_0xd8cabc=await profile[_0x10a340(0x113)]({'email':_0x47d209[_0x10a340(0x1d0)]}),_0x2b3850=await master_shop[_0x10a340(0x108)](),_0x375e5c=_0x232e3b[_0x10a340(0xe2)]['id'],_0x13b563=await sales[_0x10a340(0x168)](_0x375e5c);var _0x100ed0=[_0x10a340(0x1d4),_0x10a340(0x15b)];const _0x263e6f=await warehouse[_0x10a340(0x15a)]([{'$match':{'name':_0x13b563['warehouse_name'],'warehouse_category':_0x10a340(0x127)}},{'$unwind':_0x10a340(0x1e0)},{'$group':{'_id':_0x10a340(0x1bf),'name':{'$first':_0x10a340(0x131)},'product_stock':{'$first':_0x10a340(0x128)},'bay':{'$first':_0x10a340(0xf0)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x10a340(0x11a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x10a340(0x1d2)},'product_code':{'$first':_0x10a340(0xe4)},'storage':{'$first':_0x10a340(0x1aa)},'rack':{'$first':_0x10a340(0x192)}}}]),_0x4d70b2=await customer[_0x10a340(0x108)]({});let _0x1fe1f4;if(_0x47d209[_0x10a340(0x11d)]==_0x10a340(0x1d6)){const _0x339924=await staff[_0x10a340(0x113)]({'email':_0x47d209['email']});_0x1fe1f4=await warehouse['aggregate']([{'$match':{'status':_0x10a340(0x126),'name':_0x339924['warehouse'],'warehouse_category':_0x10a340(0x127)}},{'$group':{'_id':_0x10a340(0x174),'name':{'$first':_0x10a340(0x174)}}}]);}else _0x1fe1f4=await warehouse[_0x10a340(0x15a)]([{'$match':{'status':_0x10a340(0x126),'warehouse_category':_0x10a340(0x127)}},{'$group':{'_id':_0x10a340(0x174),'name':{'$first':_0x10a340(0x174)}}}]);const _0x3acf52=await product[_0x10a340(0x108)]({});if(_0x2b3850[0x0][_0x10a340(0x1b3)]==_0x10a340(0x1b2)){var _0x3b9449=users[_0x10a340(0x16f)];console[_0x10a340(0x12d)](_0x3b9449);}else{if(_0x2b3850[0x0][_0x10a340(0x1b3)]=='Hindi')var _0x3b9449=users[_0x10a340(0x16c)];else{if(_0x2b3850[0x0]['language']==_0x10a340(0x1d9))var _0x3b9449=users[_0x10a340(0x1d9)];else{if(_0x2b3850[0x0][_0x10a340(0x1b3)]=='Spanish')var _0x3b9449=users[_0x10a340(0x14b)];else{if(_0x2b3850[0x0][_0x10a340(0x1b3)]==_0x10a340(0x1cf))var _0x3b9449=users[_0x10a340(0x1cf)];else{if(_0x2b3850[0x0][_0x10a340(0x1b3)]=='Portuguese\x20(BR)')var _0x3b9449=users[_0x10a340(0x138)];else{if(_0x2b3850[0x0][_0x10a340(0x1b3)]==_0x10a340(0x12e))var _0x3b9449=users['Chinese'];else{if(_0x2b3850[0x0][_0x10a340(0x1b3)]==_0x10a340(0x17d))var _0x3b9449=users['Arabic'];}}}}}}}_0x6414e8['render']('edit_sales',{'success':_0x232e3b[_0x10a340(0x1ca)]('success'),'errors':_0x232e3b[_0x10a340(0x1ca)](_0x10a340(0x1a3)),'role':_0x47d209,'profile':_0xd8cabc,'customer':_0x4d70b2,'warehouse':_0x1fe1f4,'product':_0x263e6f,'user':_0x13b563,'master_shop':_0x2b3850,'unit':_0x3acf52,'language':_0x3b9449});}catch(_0x2c0772){console[_0x10a340(0x12d)](_0x2c0772);}}),router[a0_0x173fe7(0x160)]('/view/:id',auth,async(_0x21ff7d,_0x4fea01)=>{var _0x3dc997=a0_0x173fe7;try{const _0x1d9c7b=_0x21ff7d['params']['id'],_0x2ca32d=await sales[_0x3dc997(0x113)]({'_id':_0x21ff7d[_0x3dc997(0xe2)]['id']}),_0x25c67f=await warehouse['findOne']({'name':_0x2ca32d[_0x3dc997(0x185)],'room':_0x21ff7d[_0x3dc997(0x181)]['room']}),{invoice:_0x3981a4,date:_0xfae7b,warehouse_name:_0x13527e,product_name:_0x145580,stock:_0x5be824,quantity:_0x586865,note:_0x1cfcf8,room:_0x4fa61d,customer:_0x28f517,SCRN:_0x5bb78c}=_0x21ff7d['body'];if(typeof _0x145580==_0x3dc997(0xdf))var _0x465a84=[_0x21ff7d['body']['product_name']],_0x5d010a=[_0x21ff7d['body'][_0x3dc997(0x1d5)]],_0x1109b2=[_0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x11b)]],_0x3e0425=[_0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x1dc)]],_0x1a307f=[_0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x1c8)]],_0x2fd248=[_0x21ff7d['body'][_0x3dc997(0xf2)]],_0x53d181=[_0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x1d1)]],_0x21ddee=[_0x21ff7d[_0x3dc997(0x181)]['primary_unit']],_0x427498=[_0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x15c)]],_0x184213=[_0x21ff7d['body'][_0x3dc997(0x194)]],_0x1f9005=[_0x21ff7d[_0x3dc997(0x181)]['expiry_date']],_0x570650=[_0x21ff7d['body'][_0x3dc997(0x16a)]],_0x1f8624=[_0x21ff7d['body'][_0x3dc997(0x1c7)]],_0x9ced65=[_0x21ff7d[_0x3dc997(0x181)]['requested_qty']],_0x344ede=[_0x21ff7d[_0x3dc997(0x181)]['delivery_date']],_0xdd81c0=[_0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x124)]],_0x44ad1f=[_0x21ff7d[_0x3dc997(0x181)]['prod_cat']],_0x134dbe=[_0x21ff7d[_0x3dc997(0x181)]['quantity']],_0x430d43=[_0x21ff7d[_0x3dc997(0x181)]['RoomAssigned']];else var _0x465a84=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x1c9)]],_0x5d010a=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x1d5)]],_0x1109b2=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x11b)]],_0x3e0425=[..._0x21ff7d[_0x3dc997(0x181)]['primary_code']],_0x1a307f=[..._0x21ff7d[_0x3dc997(0x181)]['secondary_code']],_0x2fd248=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0xf2)]],_0x53d181=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x1d1)]],_0x21ddee=[..._0x21ff7d[_0x3dc997(0x181)]['primary_unit']],_0x427498=[..._0x21ff7d['body'][_0x3dc997(0x15c)]],_0x184213=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x194)]],_0x1f9005=[..._0x21ff7d[_0x3dc997(0x181)]['expiry_date']],_0x570650=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x16a)]],_0x1f8624=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x1c7)]],_0x9ced65=[..._0x21ff7d['body']['requested_qty']],_0x344ede=[..._0x21ff7d[_0x3dc997(0x181)]['delivery_date']],_0xdd81c0=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x124)]],_0x44ad1f=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x10c)]],_0x134dbe=[..._0x21ff7d[_0x3dc997(0x181)][_0x3dc997(0x148)]],_0x430d43=[..._0x21ff7d[_0x3dc997(0x181)]['RoomAssigned']];const _0xa2fa79=_0x465a84[_0x3dc997(0x19c)](_0x1a0460=>{return _0x1a0460={'product_name':_0x1a0460};});_0x5d010a[_0x3dc997(0xd9)]((_0x10284d,_0x346256)=>{var _0x4c23a6=_0x3dc997;_0xa2fa79[_0x346256][_0x4c23a6(0x1d5)]=Math[_0x4c23a6(0xe1)](_0x10284d);}),_0x1109b2['forEach']((_0x5c1924,_0x4f857f)=>{var _0x429af6=_0x3dc997;_0xa2fa79[_0x4f857f][_0x429af6(0x148)]=_0x5c1924;}),_0x3e0425[_0x3dc997(0xd9)]((_0x16f8cc,_0x30f00d)=>{var _0x409fb3=_0x3dc997;_0xa2fa79[_0x30f00d][_0x409fb3(0x1dc)]=_0x16f8cc;}),_0x1a307f[_0x3dc997(0xd9)]((_0x2080c9,_0x44f606)=>{var _0x43f4cf=_0x3dc997;_0xa2fa79[_0x44f606][_0x43f4cf(0x1c8)]=_0x2080c9;}),_0x2fd248[_0x3dc997(0xd9)]((_0x3142c0,_0x4e3498)=>{var _0x84e049=_0x3dc997;_0xa2fa79[_0x4e3498][_0x84e049(0x139)]=_0x3142c0;}),_0x53d181['forEach']((_0x3e37cc,_0x34d8d8)=>{_0x430d43['forEach']((_0x359dcc,_0x429abf)=>{var _0x361536=a0_0x192f;if(_0x359dcc=='Receiving\x20Area'&&_0x34d8d8==_0x429abf){var _0x3de1b1=_0x3e37cc[_0x361536(0x13a)](0x3);_0xa2fa79[_0x34d8d8][_0x361536(0x11c)]=_0x3e37cc[0x0],_0xa2fa79[_0x34d8d8]['rack']=_0x3e37cc[0x1],_0xa2fa79[_0x34d8d8]['bay']=0x0,_0xa2fa79[_0x34d8d8][_0x361536(0x19a)]=0x0,_0xa2fa79[_0x34d8d8][_0x361536(0xe8)]=_0x361536(0x132),_0xa2fa79[_0x34d8d8][_0x361536(0x135)]=_0x3de1b1;}else{if(_0x359dcc==_0x361536(0x103)&&_0x34d8d8==_0x429abf){var _0x3de1b1=_0x3e37cc[_0x361536(0x13a)](0x3);_0xa2fa79[_0x34d8d8][_0x361536(0x11c)]=_0x3e37cc[0x0],_0xa2fa79[_0x34d8d8][_0x361536(0x141)]=_0x3e37cc[0x1],_0xa2fa79[_0x34d8d8][_0x361536(0x101)]=0x0,_0xa2fa79[_0x34d8d8][_0x361536(0x19a)]=0x0,_0xa2fa79[_0x34d8d8][_0x361536(0xe8)]=_0x361536(0x132),_0xa2fa79[_0x34d8d8][_0x361536(0x135)]=_0x3e37cc[0x5];}else{if(_0x34d8d8==_0x429abf){var _0xc82f8b;if(_0x3e37cc[0x4]=='L')_0xc82f8b=_0x361536(0x1a2);else _0x3e37cc[0x4]=='F'&&(_0xc82f8b=_0x361536(0x132));_0xa2fa79[_0x34d8d8][_0x361536(0x11c)]=_0x3e37cc[0x0],_0xa2fa79[_0x34d8d8][_0x361536(0x141)]=_0x3e37cc[0x1],_0xa2fa79[_0x34d8d8][_0x361536(0x101)]=_0x3e37cc[0x2],_0xa2fa79[_0x34d8d8][_0x361536(0x19a)]=_0x3e37cc[0x3],_0xa2fa79[_0x34d8d8][_0x361536(0xe8)]=_0xc82f8b,_0xa2fa79[_0x34d8d8][_0x361536(0x135)]=_0x3e37cc[0x5];}}}});}),_0x21ddee[_0x3dc997(0xd9)]((_0x5ceddc,_0x1e481d)=>{var _0x37e267=_0x3dc997;_0xa2fa79[_0x1e481d][_0x37e267(0xec)]=_0x5ceddc;}),_0x427498[_0x3dc997(0xd9)]((_0x3ca3ac,_0x5931b4)=>{var _0x409ed5=_0x3dc997;_0xa2fa79[_0x5931b4][_0x409ed5(0x15c)]=_0x3ca3ac;}),_0x184213[_0x3dc997(0xd9)]((_0x1cf19e,_0x1b768b)=>{_0xa2fa79[_0x1b768b]['batch_code']=_0x1cf19e;}),_0x1f9005['forEach']((_0x3a7828,_0xf5bb2d)=>{_0xa2fa79[_0xf5bb2d]['expiry_date']=_0x3a7828;}),_0x570650['forEach']((_0x1a4882,_0x19c098)=>{var _0x54eb92=_0x3dc997;_0xa2fa79[_0x19c098][_0x54eb92(0xe6)]=_0x1a4882;}),_0x1f8624[_0x3dc997(0xd9)]((_0x587626,_0x532d72)=>{var _0x56cb9f=_0x3dc997;_0xa2fa79[_0x532d72][_0x56cb9f(0x1c7)]=_0x587626;}),_0x9ced65[_0x3dc997(0xd9)]((_0x23f893,_0x1b8134)=>{_0xa2fa79[_0x1b8134]['requested_qty']=Math['abs'](_0x23f893);}),_0x344ede[_0x3dc997(0xd9)]((_0x347de9,_0x202ba5)=>{var _0x1bb08f=_0x3dc997;_0xa2fa79[_0x202ba5][_0x1bb08f(0x149)]=_0x347de9;}),_0xdd81c0[_0x3dc997(0xd9)]((_0x3b1b0b,_0x2a6cc5)=>{var _0x486c95=_0x3dc997;_0xa2fa79[_0x2a6cc5][_0x486c95(0x124)]=_0x3b1b0b;}),_0x44ad1f[_0x3dc997(0xd9)]((_0x23b5ab,_0x59a7f6)=>{var _0x1f4bf1=_0x3dc997;_0xa2fa79[_0x59a7f6][_0x1f4bf1(0x10c)]=_0x23b5ab;}),_0x134dbe[_0x3dc997(0xd9)]((_0x13d514,_0x1cb8d9)=>{var _0x216af4=_0x3dc997;_0xa2fa79[_0x1cb8d9][_0x216af4(0x114)]=_0x13d514;}),_0x430d43[_0x3dc997(0xd9)]((_0x451c11,_0x412390)=>{var _0x5e5195=_0x3dc997;_0xa2fa79[_0x412390][_0x5e5195(0x14d)]=_0x451c11;});var _0x13709f=0x0;_0xa2fa79[_0x3dc997(0xd9)](_0x3dc658=>{var _0x4d440a=_0x3dc997;console[_0x4d440a(0x12d)](_0x4d440a(0x184),_0x3dc658),(parseInt(_0x3dc658['stock'])<parseInt(_0x3dc658[_0x4d440a(0x148)])||parseInt(_0x3dc658['quantity'])==0x0)&&_0x13709f++;});if(_0x13709f!=0x0)return _0x21ff7d[_0x3dc997(0x1ca)](_0x3dc997(0x1a3),_0x3dc997(0xf9)),_0x4fea01[_0x3dc997(0x1b9)](_0x3dc997(0xff));const _0x38219e=_0xa2fa79[_0x3dc997(0x1a0)](_0x157230=>_0x157230[_0x3dc997(0x148)]!=='0'&&_0x157230[_0x3dc997(0x148)]!=='');_0x2ca32d[_0x3dc997(0x18f)]=_0x3981a4,_0x2ca32d[_0x3dc997(0x1c5)]=_0x28f517,_0x2ca32d['date']=_0xfae7b,_0x2ca32d[_0x3dc997(0x185)]=_0x13527e,_0x2ca32d[_0x3dc997(0x189)]=_0x38219e,_0x2ca32d[_0x3dc997(0x1d8)]=_0x1cfcf8,_0x2ca32d[_0x3dc997(0x144)]=_0x5bb78c,_0x2ca32d[_0x3dc997(0x13f)]=_0x3dc997(0x137),_0x2ca32d['isAllowEdit']='False';const _0x41c67c=await _0x2ca32d[_0x3dc997(0x178)]();_0x21ff7d['flash'](_0x3dc997(0x130),_0x3dc997(0x1ce)),_0x4fea01['redirect']('/all_sales/view');}catch(_0x108231){console[_0x3dc997(0x12d)](_0x108231);}}),router[a0_0x173fe7(0x160)](a0_0x173fe7(0x176),auth,async(_0x2b788d,_0x5d4d0c)=>{var _0xeb0148=a0_0x173fe7;try{const _0x9dca26=_0x2b788d[_0xeb0148(0xe2)]['id'],{invoice:_0x3e0355,customer:_0x2f39ab,receivable_amount:_0x429de3,received_amount:_0x202771}=_0x2b788d['body'],_0x120b83=await sales['findById'](_0x9dca26);console[_0xeb0148(0x12d)](_0x120b83);var _0x5b4bc7=_0x429de3-_0x202771;console['log'](_0x202771),_0x120b83[_0xeb0148(0x13c)]=parseFloat(_0x202771)+parseFloat(_0x120b83[_0xeb0148(0x13c)]),_0x120b83[_0xeb0148(0x187)]=_0x5b4bc7,console['log'](_0x120b83);const _0x5d7b28=await _0x120b83[_0xeb0148(0x178)](),_0x284acf=await c_payment_data['findOne']({'invoice':_0x3e0355});_0x284acf[_0xeb0148(0xde)]=_0x5b4bc7,await _0x284acf[_0xeb0148(0x178)]();let _0x32a74c=new Date(),_0x42622d=('0'+_0x32a74c[_0xeb0148(0x16e)]())[_0xeb0148(0x13a)](-0x2),_0x22a36b=('0'+(_0x32a74c['getMonth']()+0x1))[_0xeb0148(0x13a)](-0x2),_0x1dd2b3=_0x32a74c['getFullYear'](),_0x54c3e8=_0x1dd2b3+'-'+_0x22a36b+'-'+_0x42622d;const _0x158d45=new customer_payment({'invoice':_0x3e0355,'date':_0x1dd2b3+'-'+_0x22a36b+'-'+_0x42622d,'customer':_0x2f39ab,'reason':_0xeb0148(0x17b),'amount':_0x202771}),_0x57bde4=await _0x158d45[_0xeb0148(0x178)]();_0x2b788d[_0xeb0148(0x1ca)]('success',_0xeb0148(0xf5)),_0x5d4d0c['redirect'](_0xeb0148(0x150));}catch(_0x553370){console['log'](_0x553370);}}),router[a0_0x173fe7(0x19b)](a0_0x173fe7(0xda),auth,async(_0x24200d,_0x19c88d)=>{var _0x4fc9a9=a0_0x173fe7;try{const {username:_0x4a5120,email:_0x51931b,role:_0x2d8379}=_0x24200d[_0x4fc9a9(0x193)],_0x2cb6ab=_0x24200d['user'],_0x47236c=await profile[_0x4fc9a9(0x113)]({'email':_0x2cb6ab[_0x4fc9a9(0x1d0)]}),_0x5a5f43=await master_shop['find']();console[_0x4fc9a9(0x12d)](_0x4fc9a9(0x1c4),_0x5a5f43);const _0x50f6c4=_0x24200d[_0x4fc9a9(0xe2)]['id'],_0x4cecc9=await sales[_0x4fc9a9(0x168)](_0x50f6c4);console[_0x4fc9a9(0x12d)](_0x4cecc9);const _0x4df2f2=await customer[_0x4fc9a9(0x113)]({'name':_0x4cecc9[_0x4fc9a9(0x1c5)]});console[_0x4fc9a9(0x12d)](_0x4df2f2);if(_0x5a5f43[0x0][_0x4fc9a9(0x1b3)]==_0x4fc9a9(0x1b2)){var _0x101b02=users[_0x4fc9a9(0x16f)];console[_0x4fc9a9(0x12d)](_0x101b02);}else{if(_0x5a5f43[0x0][_0x4fc9a9(0x1b3)]==_0x4fc9a9(0x16c))var _0x101b02=users[_0x4fc9a9(0x16c)];else{if(_0x5a5f43[0x0][_0x4fc9a9(0x1b3)]==_0x4fc9a9(0x1d9))var _0x101b02=users[_0x4fc9a9(0x1d9)];else{if(_0x5a5f43[0x0]['language']==_0x4fc9a9(0x14b))var _0x101b02=users[_0x4fc9a9(0x14b)];else{if(_0x5a5f43[0x0]['language']==_0x4fc9a9(0x1cf))var _0x101b02=users[_0x4fc9a9(0x1cf)];else{if(_0x5a5f43[0x0][_0x4fc9a9(0x1b3)]==_0x4fc9a9(0x112))var _0x101b02=users[_0x4fc9a9(0x138)];else{if(_0x5a5f43[0x0]['language']=='Chinese')var _0x101b02=users[_0x4fc9a9(0x12e)];else{if(_0x5a5f43[0x0][_0x4fc9a9(0x1b3)]==_0x4fc9a9(0x17d))var _0x101b02=users[_0x4fc9a9(0x191)];}}}}}}}_0x19c88d[_0x4fc9a9(0x1a7)](_0x4fc9a9(0x197),{'success':_0x24200d[_0x4fc9a9(0x1ca)](_0x4fc9a9(0x130)),'errors':_0x24200d[_0x4fc9a9(0x1ca)]('errors'),'role':_0x2cb6ab,'profile':_0x47236c,'master_shop':_0x5a5f43,'customers':_0x4df2f2,'sales':_0x4cecc9,'language':_0x101b02});}catch(_0x575427){console[_0x4fc9a9(0x12d)](_0x575427);}}),router[a0_0x173fe7(0x19b)](a0_0x173fe7(0x1bd),auth,async(_0x49ca48,_0x24784d)=>{var _0x50973e=a0_0x173fe7;try{const {username:_0x27d383,email:_0x7b4f9e,role:_0x31dc2}=_0x49ca48['user'],_0x20ba14=_0x49ca48[_0x50973e(0x193)],_0x823dad=await profile[_0x50973e(0x113)]({'email':_0x20ba14[_0x50973e(0x1d0)]}),_0xcd0256=await master_shop[_0x50973e(0x108)]();console[_0x50973e(0x12d)]('master',_0xcd0256);const _0x4832e2=_0x49ca48[_0x50973e(0xe2)]['id'];console[_0x50973e(0x12d)](_0x4832e2);const _0x11758a=await sales[_0x50973e(0x168)](_0x4832e2);console['log']('user_id',_0x11758a);const _0x219c0b=await warehouse[_0x50973e(0x15a)]([{'$match':{'name':'Return\x20Goods','room':'Return\x20Rooms'}},{'$unwind':'$product_details'},{'$group':{'_id':_0x50973e(0x1bf),'name':{'$first':_0x50973e(0x131)},'product_stock':{'$first':_0x50973e(0x128)},'level':{'$first':_0x50973e(0x1a4)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x50973e(0x134)},'secondary_code':{'$first':_0x50973e(0x1d2)},'product_code':{'$first':_0x50973e(0xe4)}}}]);console[_0x50973e(0x12d)](_0x50973e(0x18a),_0x219c0b);const _0x4efdf8=await product[_0x50973e(0x108)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x50973e(0x126),'name':_0x50973e(0x18c),'warehouse_category':_0x50973e(0x127)}},{'$group':{'_id':_0x50973e(0x174),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x391c3d=[_0x50973e(0x102)];if(_0xcd0256[0x0][_0x50973e(0x1b3)]=='English\x20(US)'){var _0x1221f4=users['English'];console[_0x50973e(0x12d)](_0x1221f4);}else{if(_0xcd0256[0x0][_0x50973e(0x1b3)]==_0x50973e(0x16c))var _0x1221f4=users[_0x50973e(0x16c)];else{if(_0xcd0256[0x0][_0x50973e(0x1b3)]==_0x50973e(0x1d9))var _0x1221f4=users['German'];else{if(_0xcd0256[0x0]['language']==_0x50973e(0x14b))var _0x1221f4=users['Spanish'];else{if(_0xcd0256[0x0][_0x50973e(0x1b3)]==_0x50973e(0x1cf))var _0x1221f4=users[_0x50973e(0x1cf)];else{if(_0xcd0256[0x0]['language']=='Portuguese\x20(BR)')var _0x1221f4=users[_0x50973e(0x138)];else{if(_0xcd0256[0x0][_0x50973e(0x1b3)]=='Chinese')var _0x1221f4=users[_0x50973e(0x12e)];else{if(_0xcd0256[0x0][_0x50973e(0x1b3)]==_0x50973e(0x17d))var _0x1221f4=users[_0x50973e(0x191)];}}}}}}}_0x24784d[_0x50973e(0x1a7)]('return_sale',{'success':_0x49ca48[_0x50973e(0x1ca)](_0x50973e(0x130)),'errors':_0x49ca48[_0x50973e(0x1ca)](_0x50973e(0x1a3)),'role':_0x20ba14,'profile':_0x823dad,'user':_0x11758a,'stock':_0x219c0b,'master_shop':_0xcd0256,'unit':_0x4efdf8,'language':_0x1221f4,'warehouses':warehouse_data,'rooms':_0x391c3d});}catch(_0x20da61){console[_0x50973e(0x12d)](_0x20da61),_0x24784d[_0x50973e(0xfd)](0xc8)[_0x50973e(0xe9)]({'message':_0x20da61[_0x50973e(0x107)]});}}),router[a0_0x173fe7(0x160)](a0_0x173fe7(0x1bd),auth,async(_0x5d00da,_0x1abda)=>{var _0x42aa7e=a0_0x173fe7;try{const {invoice:_0x3dc0b6,date:_0x3a53a5,warehouse_name:_0x178b79,product_name:_0x397c4c,primary_code:_0x19640d,secondary_code:_0x5ce188,product_code:_0x4f9861,sales_quantity:_0x31c4c0,stocks:_0x89135a,return_qty:_0x31d074,Room_name:_0x460199,to_warehouse_name:_0x58a5a8,to_Roomname:_0x268ec0,to_Room_name:_0x2cd3ce,note:_0xcc2f7b,level:_0x4a1b07,isle:_0x3a81b5,pallet:_0x189fbc}=_0x5d00da[_0x42aa7e(0x181)];if(typeof _0x397c4c=='string')var _0x2c2443=[_0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x1c9)]],_0x2cb9f4=[_0x5d00da['body'][_0x42aa7e(0x1dc)]],_0x2c64cc=[_0x5d00da[_0x42aa7e(0x181)]['secondary_code']],_0x44d9a8=[_0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x139)]],_0x389505=[_0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x1b7)]],_0x59b584=[_0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x145)]],_0xca1d02=[_0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x156)]],_0x50e101=[_0x5d00da[_0x42aa7e(0x181)]['bay']],_0x3c1ed5=[_0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x19a)]],_0x20c81c=[_0x5d00da[_0x42aa7e(0x181)]['types']],_0x52f6db=[_0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x135)]];else var _0x2c2443=[..._0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x1c9)]],_0x2cb9f4=[..._0x5d00da['body'][_0x42aa7e(0x1dc)]],_0x2c64cc=[..._0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x1c8)]],_0x44d9a8=[..._0x5d00da['body'][_0x42aa7e(0x139)]],_0x389505=[..._0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x1b7)]],_0x59b584=[..._0x5d00da['body'][_0x42aa7e(0x145)]],_0xca1d02=[..._0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x156)]],_0x50e101=[..._0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x101)]],_0x3c1ed5=[..._0x5d00da[_0x42aa7e(0x181)]['bin']],_0x20c81c=[..._0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x14f)]],_0x52f6db=[..._0x5d00da[_0x42aa7e(0x181)][_0x42aa7e(0x135)]];const _0x1742cf=_0x2c2443[_0x42aa7e(0x19c)](_0x260558=>{return _0x260558={'product_name':_0x260558};});_0x2cb9f4[_0x42aa7e(0xd9)]((_0x2e8ec2,_0x45108a)=>{var _0x194b07=_0x42aa7e;_0x1742cf[_0x45108a][_0x194b07(0x1dc)]=_0x2e8ec2;}),_0x2c64cc[_0x42aa7e(0xd9)]((_0x15c611,_0x114a76)=>{var _0x6f2adc=_0x42aa7e;_0x1742cf[_0x114a76][_0x6f2adc(0x1c8)]=_0x15c611;}),_0x44d9a8['forEach']((_0x2dd1ba,_0x31a6df)=>{var _0x1ff7bf=_0x42aa7e;_0x1742cf[_0x31a6df][_0x1ff7bf(0x139)]=_0x2dd1ba;}),_0x389505[_0x42aa7e(0xd9)]((_0x5db585,_0x381876)=>{var _0x14913b=_0x42aa7e;_0x1742cf[_0x381876][_0x14913b(0x133)]=_0x5db585;}),_0x59b584[_0x42aa7e(0xd9)]((_0x1ad863,_0x107a81)=>{_0x1742cf[_0x107a81]['stock']=_0x1ad863;}),_0xca1d02[_0x42aa7e(0xd9)]((_0x1efe22,_0x290acb)=>{_0x1742cf[_0x290acb]['return_qty']=_0x1efe22;}),_0x50e101['forEach']((_0x459819,_0x55d622)=>{var _0x3bac2a=_0x42aa7e;_0x1742cf[_0x55d622][_0x3bac2a(0x101)]=_0x459819;}),_0x3c1ed5[_0x42aa7e(0xd9)]((_0x2469ff,_0x28966d)=>{var _0x3a68ee=_0x42aa7e;_0x1742cf[_0x28966d][_0x3a68ee(0x19a)]=_0x2469ff;}),_0x20c81c['forEach']((_0x2138a8,_0xa606d)=>{var _0x3b8e89=_0x42aa7e;_0x1742cf[_0xa606d][_0x3b8e89(0xe8)]=_0x2138a8;}),_0x52f6db['forEach']((_0x5efb8d,_0x629d91)=>{_0x1742cf[_0x629d91]['floorlevel']=_0x5efb8d;});var _0x45d4da=0x0;_0x1742cf[_0x42aa7e(0xd9)](_0x441b17=>{var _0x2a36c0=_0x42aa7e;console['log'](_0x2a36c0(0x184),_0x441b17),(parseInt(_0x441b17['sale_qty'])<parseInt(_0x441b17['return_qty'])||parseInt(_0x441b17[_0x2a36c0(0x1d5)])<parseInt(_0x441b17[_0x2a36c0(0x156)])&&parseInt(_0x441b17['sale_qty'])>parseInt(_0x441b17[_0x2a36c0(0x156)])||parseInt(_0x441b17['return_qty'])==0x0)&&_0x45d4da++;});if(_0x45d4da!=0x0)return _0x5d00da[_0x42aa7e(0x1ca)]('errors',_0x42aa7e(0x154)),_0x1abda[_0x42aa7e(0x1b9)](_0x42aa7e(0xff));const _0x3d9efd=await sales[_0x42aa7e(0x113)]({'invoice':_0x3dc0b6});console[_0x42aa7e(0x12d)](_0x3d9efd),_0x3d9efd[_0x42aa7e(0x1bc)]='True';const _0x4b70fd=await _0x3d9efd[_0x42aa7e(0x178)](),_0x5e8944=new sales_return({'invoice':_0x3dc0b6,'customer':_0x5d00da[_0x42aa7e(0x181)]['customer'],'date':_0x3a53a5,'warehouse_name':_0x178b79,'room':_0x460199,'ToWarehouse':_0x58a5a8,'ToRoom':_0x2cd3ce,'return_sale':_0x1742cf,'note':_0xcc2f7b}),_0x5e0665=await _0x5e8944[_0x42aa7e(0x178)]();console[_0x42aa7e(0x12d)](_0x5e8944);const _0x5ae977=await sales_return[_0x42aa7e(0x113)]({'invoice':_0x3dc0b6}),_0xe86d3a=await warehouse[_0x42aa7e(0x113)]({'name':_0x58a5a8,'room':_0x2cd3ce});_0x5ae977['return_sale'][_0x42aa7e(0xd9)](_0x20abc5=>{var _0x1f8950=_0x42aa7e,_0x111d36=0x0;const _0x14f93a=_0xe86d3a[_0x1f8950(0xed)][_0x1f8950(0x19c)](_0x5967dc=>{var _0x3aa593=_0x1f8950;_0x5967dc[_0x3aa593(0x1c9)]==_0x20abc5[_0x3aa593(0x1c9)]&&_0x5967dc[_0x3aa593(0x135)]==_0x20abc5[_0x3aa593(0x135)]&&_0x5967dc[_0x3aa593(0xe8)]==_0x20abc5[_0x3aa593(0xe8)]&&_0x5967dc[_0x3aa593(0x19a)]==_0x20abc5[_0x3aa593(0x19a)]&&_0x5967dc[_0x3aa593(0x101)]==_0x20abc5[_0x3aa593(0x101)]&&(_0x5967dc['product_stock']=parseInt(_0x5967dc['product_stock'])+parseInt(_0x20abc5[_0x3aa593(0x156)]),_0x111d36++);});_0x111d36=='0'&&(_0xe86d3a[_0x1f8950(0xed)]=_0xe86d3a[_0x1f8950(0xed)][_0x1f8950(0x111)]({'product_name':_0x20abc5['product_name'],'product_stock':_0x20abc5['return_qty'],'primary_code':_0x20abc5['primary_code'],'secondary_code':_0x20abc5[_0x1f8950(0x1c8)],'product_code':_0x20abc5['product_code'],'bay':_0x20abc5[_0x1f8950(0x101)],'bin':_0x20abc5[_0x1f8950(0x19a)],'type':_0x20abc5[_0x1f8950(0xe8)],'floorlevel':_0x20abc5[_0x1f8950(0x135)]})),console[_0x1f8950(0x12d)](_0x1f8950(0x121),_0xe86d3a);}),await _0xe86d3a[_0x42aa7e(0x178)](),console[_0x42aa7e(0x12d)](_0x5d00da['body']);const _0x560364=new c_payment_data({'invoice':_0x3dc0b6,'customer':_0x5d00da[_0x42aa7e(0x181)]['customer'],'reason':'Sale\x20Return'});await _0x560364[_0x42aa7e(0x178)]();const _0x1b0f79=await master_shop[_0x42aa7e(0x108)]();console['log'](_0x42aa7e(0x1a1),_0x1b0f79[0x0][_0x42aa7e(0x13d)]);const _0x4a9429=await email_settings['findOne'](),_0x429cd1=await customer['findOne']({'name':_0x5d00da[_0x42aa7e(0x181)]['customer']});console[_0x42aa7e(0x12d)](_0x42aa7e(0x173),_0x429cd1);_0x1b0f79[0x0][_0x42aa7e(0x186)]==0x1?(right_currency=_0x1b0f79[0x0][_0x42aa7e(0x1ba)],left_currency=''):(right_currency='',left_currency=_0x1b0f79[0x0]['currency']);var _0x282346=_0x2c2443,_0x442ad9=_0xca1d02,_0x390a17='',_0x53f0e3;for(_0x53f0e3 in _0x282346){_0x390a17+=_0x42aa7e(0x1db)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x282346[_0x53f0e3]+'</td>'+_0x42aa7e(0x18d)+_0x442ad9[_0x53f0e3]+_0x42aa7e(0x163)+_0x42aa7e(0x1af);}console[_0x42aa7e(0x12d)]('product_list',_0x390a17);let _0x1f751f=nodemailer[_0x42aa7e(0x153)]({'service':_0x42aa7e(0x10f),'auth':{'user':_0x4a9429[_0x42aa7e(0x1d0)],'pass':_0x4a9429['password']}}),_0x58ff4e={'from':_0x4a9429[_0x42aa7e(0x1d0)],'to':_0x429cd1[_0x42aa7e(0x1d0)],'subject':_0x42aa7e(0x180),'attachments':[{'filename':_0x42aa7e(0x14a),'path':__dirname+_0x42aa7e(0xea)+_0x42aa7e(0xf7)+_0x1b0f79[0x0]['image'],'cid':_0x42aa7e(0x1ae)}],'html':_0x42aa7e(0x116)+_0x42aa7e(0x169)+_0x42aa7e(0x13e)+_0x42aa7e(0x1a9)+_0x42aa7e(0x175)+_0x42aa7e(0x1a9)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x42aa7e(0xe7)+_0x42aa7e(0x1a9)+_0x42aa7e(0x140)+_0x1b0f79[0x0][_0x42aa7e(0x1cd)]+_0x42aa7e(0x1c3)+_0x42aa7e(0xe7)+'</div>'+_0x42aa7e(0xef)+_0x42aa7e(0x1a9)+_0x42aa7e(0x1c1)+_0x42aa7e(0x122)+_0x3dc0b6+'\x20'+_0x42aa7e(0x129)+_0x42aa7e(0x105)+_0x3a53a5+'\x20'+_0x42aa7e(0x1b1)+'</h5>'+_0x42aa7e(0xe7)+_0x42aa7e(0x161)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x42aa7e(0x1db)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x42aa7e(0x110)+_0x42aa7e(0x147)+_0x42aa7e(0x1af)+'</thead>'+_0x42aa7e(0xe5)+'\x20'+_0x390a17+'\x20'+'</tbody>'+_0x42aa7e(0x109)+_0x42aa7e(0x1a9)+_0x42aa7e(0x177)+_0x42aa7e(0xdc)+_0x1b0f79[0x0][_0x42aa7e(0x1cd)]+'</h5>'+_0x42aa7e(0xe7)+_0x42aa7e(0xe7)+_0x42aa7e(0x157)};_0x1f751f[_0x42aa7e(0x170)](_0x58ff4e,function(_0x3f1a93,_0x4a6327){var _0x45b9af=_0x42aa7e;_0x3f1a93?(console[_0x45b9af(0x12d)](_0x3f1a93),console[_0x45b9af(0x12d)](_0x45b9af(0x17e))):console[_0x45b9af(0x12d)](_0x45b9af(0x1a6));}),_0x5d00da[_0x42aa7e(0x1ca)](_0x42aa7e(0x130),'sales\x20item\x20return\x20successfull'),_0x1abda[_0x42aa7e(0x1b9)](_0x42aa7e(0x150));}catch(_0x3d990b){console[_0x42aa7e(0x12d)](_0x3d990b),_0x1abda[_0x42aa7e(0xfd)](0xc8)[_0x42aa7e(0xe9)]({'message1':_0x3d990b[_0x42aa7e(0x107)]});}}),router[a0_0x173fe7(0x19b)](a0_0x173fe7(0x16d),auth,async(_0xea9a62,_0x13ee9e)=>{var _0x539b7f=a0_0x173fe7;try{const {username:_0xb9038,email:_0x44cc1b,role:_0x26c6d5}=_0xea9a62['user'],_0x3a36c1=_0xea9a62[_0x539b7f(0x193)],_0x377b05=await profile[_0x539b7f(0x113)]({'email':_0x3a36c1['email']}),_0x2e1642=await master_shop['find']();console[_0x539b7f(0x12d)]('barcode\x20Product\x20master',_0x2e1642);const _0x348e17=_0xea9a62[_0x539b7f(0xe2)]['id'],_0x30a7cd=await sales[_0x539b7f(0x168)](_0x348e17);console[_0x539b7f(0x12d)](_0x539b7f(0x1be),_0x30a7cd);if(_0x2e1642[0x0][_0x539b7f(0x1b3)]==_0x539b7f(0x1b2))var _0x5aa9be=users['English'];else{if(_0x2e1642[0x0][_0x539b7f(0x1b3)]=='Hindi')var _0x5aa9be=users[_0x539b7f(0x16c)];else{if(_0x2e1642[0x0][_0x539b7f(0x1b3)]=='German')var _0x5aa9be=users[_0x539b7f(0x1d9)];else{if(_0x2e1642[0x0][_0x539b7f(0x1b3)]=='Spanish')var _0x5aa9be=users[_0x539b7f(0x14b)];else{if(_0x2e1642[0x0][_0x539b7f(0x1b3)]=='French')var _0x5aa9be=users['French'];else{if(_0x2e1642[0x0][_0x539b7f(0x1b3)]==_0x539b7f(0x112))var _0x5aa9be=users[_0x539b7f(0x138)];else{if(_0x2e1642[0x0][_0x539b7f(0x1b3)]==_0x539b7f(0x12e))var _0x5aa9be=users[_0x539b7f(0x12e)];else{if(_0x2e1642[0x0][_0x539b7f(0x1b3)]==_0x539b7f(0x17d))var _0x5aa9be=users['Arabic'];}}}}}}}_0x13ee9e['render'](_0x539b7f(0x1cb),{'success':_0xea9a62[_0x539b7f(0x1ca)](_0x539b7f(0x130)),'errors':_0xea9a62[_0x539b7f(0x1ca)]('errors'),'role':_0x3a36c1,'profile':_0x377b05,'alldata':_0x30a7cd,'master_shop':_0x2e1642,'language':_0x5aa9be});}catch(_0x37b9c3){console[_0x539b7f(0x12d)](_0x37b9c3);}}),router[a0_0x173fe7(0x160)](a0_0x173fe7(0x143),async(_0x484553,_0x4ae077)=>{var _0x170d0d=a0_0x173fe7;const {product_code:_0x434bbe,warehouse_name:_0x3e0fd7,rooms_data:_0x432a87,Roomslist:_0x11e0e5}=_0x484553['body'],_0x42bc73=_0x11e0e5[_0x170d0d(0x1dd)](','),_0x3ca1ec=[];async function _0x2e708c(_0x29206a){var _0x3b8c43=_0x170d0d;const _0x51cb5d=await warehouse[_0x3b8c43(0x15a)]([{'$match':{'name':_0x3e0fd7,'room':_0x29206a}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x434bbe}},{'$group':{'_id':_0x3b8c43(0x1bf),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3b8c43(0x134)},'secondary_code':{'$first':_0x3b8c43(0x1d2)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x3b8c43(0xf0)},'isle':{'$first':_0x3b8c43(0xeb)},'type':{'$first':_0x3b8c43(0x19d)},'pallet':{'$first':_0x3b8c43(0x11a)},'unit':{'$first':_0x3b8c43(0x155)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3b8c43(0x1aa)},'rack':{'$first':_0x3b8c43(0x192)},'expiry_date':{'$first':_0x3b8c43(0x17a)},'production_date':{'$first':_0x3b8c43(0x1c2)},'maxPerUnit':{'$first':_0x3b8c43(0x1ad)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x3b8c43(0x11e)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x3b8c43(0x1de)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x10c1af=await warehouse[_0x3b8c43(0x15a)]([{'$match':{'name':_0x3e0fd7,'room':_0x29206a}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x434bbe}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3b8c43(0x131)},'product_stock':{'$first':_0x3b8c43(0x128)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3b8c43(0x1d2)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x3b8c43(0xf0)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x3b8c43(0x11a)},'unit':{'$first':_0x3b8c43(0x155)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3b8c43(0x1aa)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x3b8c43(0x1c2)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x3b8c43(0x199)},'product_cat':{'$first':_0x3b8c43(0x11e)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x3b8c43(0x195)},'invoice':{'$first':_0x3b8c43(0x1de)}}}]);if(_0x51cb5d[_0x3b8c43(0x171)]>0x0)_0x3ca1ec[_0x3b8c43(0xe3)](_0x51cb5d);else _0x10c1af[_0x3b8c43(0x171)]>0x0&&_0x3ca1ec[_0x3b8c43(0xe3)](_0x10c1af);}const _0x395a45=_0x42bc73[_0x170d0d(0x19c)](_0x464381=>_0x2e708c(_0x464381));await Promise['all'](_0x395a45),_0x4ae077['json'](_0x3ca1ec);}),module['exports']=router;function a0_0x3fe2(){var _0x37596e=['site_title','Sales\x20Update\x20successfully','French','email','level','$product_details.secondary_code','1025248GuuMCz','Ambient','stock','staff','warehouse','note','German','customers_docs','<tr>','primary_code','split','$product_details.invoice','OUT-','$product_details','forEach','/invoice/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<h5>','$customers_docs','amount','string','date','abs','params','push','$product_details.product_code','<tbody\x20style=\x22text-align:\x20center;\x22>','maxperunit','</div>','type','json','/../public','$product_details.bin','unit','product_details','prod_invoice','<hr\x20class=\x22my-3\x22>','$product_details.bay','1563maznwV','prod_code','all','8jPeUsN','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/upload/','/preview/:id','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Sales\x20Mail','15iziRMi','/all_sales/preview/','status','expiry_date','back','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','bay','Return\x20Rooms','Shelves','</thead>','\x20Order\x20Date\x20:\x20','RoomAssigned','message','find','</table>','67895uGxwbO','$finalize','prod_cat','$product.product_name','843282xUHABQ','gmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','concat','Portuguese\x20(BR)','findOne','quantity_notConverted','$return_data','<!DOCTYPE\x20html>','$_id','$sale_product.floorlevel','An\x20error\x20occurred.','$product_details.floorlevel','carton','storage','role','$product_details.product_cat','../public/language/languages.json','product_stock','final','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','delivery_code','11atDHxv','Enabled','Raw\x20Materials','$product_details.product_stock','<span\x20style=\x22float:\x20right;\x22>','True','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','log','Chinese','requested_qty','success','$product_details.product_name','Floor','sale_qty','$product_details.primary_code','floorlevel','port','False','Portuguese','product_code','slice','$sale_product','received_amount','image','</head><body>','finalize','<h2>\x20','rack','$warehouse_name','/barcode_scanner','SCRN','stocks','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','quantity','delivery_date','Logo.png','Spanish','60011ybpufn','room_name','toString','types','/all_sales/view','/view','/view/add_sales/:id','createTransport','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.unit','return_qty','</body></html>','customers','$isAllowEdit','aggregate','Enclosed','secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','nodemailer','primary_unit','post','<table\x20style=\x22width:\x20100%\x20!important;\x22>','actual_uom','</td>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','sales\x20all_data','$sale_product.bin','padStart','findById','<html><head><title></title>','max_per_unit','Router','Hindi','/barcode/:id','getDate','English','sendMail','length','../models/all_models','customer_data','$name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/give_payment/:id','<strong>\x20Regards\x20</strong>','save','$sale_product.quantity','$product_details.expiry_date','Received\x20Payment\x20For\x20Sale','name','Arabic\x20(ae)','Error\x20Occurs','_id','Sale\x20Return\x20Mail','body','/view/add_sales','host','foreach\x20newproduct','warehouse_name','currency_placement','due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','sale_product','stock_data','</tbody>','Return\x20Goods','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','invoice','1022220deqhPx','Arabic','$product_details.rack','user','batch_code','$room','$invoice','sales_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.batch_code','bin','get','map','$product_details.type','1866rpprCX','2214747nXBBSd','filter','add\x20post','Level','errors','$product_details.level','catch','Email\x20sent\x20successfully','render','error','<div>','$product_details.storage','password','$sale_product.type','$product_details.maxPerUnit','logo','</tr>','$sale_product.bay','</span>','English\x20(US)','language','/view/add_sale/product','$product','edit_sales_view','sales_quantity','</h5>','redirect','currency','$customer','return_data','/view/return_sales/:id','barcode\x20user_id','$product_details._id','express','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.production_date','\x20</h2>','master','customer','$note','production_date','secondary_code','product_name','flash','all_sales_barcode','product'];a0_0x3fe2=function(){return _0x37596e;};return a0_0x3fe2();}