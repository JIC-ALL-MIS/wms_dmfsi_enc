var a0_0x405637=a0_0xb2ca;(function(_0x52a331,_0x242ece){var _0x5741a9=a0_0xb2ca,_0x435b1c=_0x52a331();while(!![]){try{var _0x2eae7c=parseInt(_0x5741a9(0x1e9))/0x1+parseInt(_0x5741a9(0x29a))/0x2*(parseInt(_0x5741a9(0x1e5))/0x3)+parseInt(_0x5741a9(0x235))/0x4+-parseInt(_0x5741a9(0x2a9))/0x5*(parseInt(_0x5741a9(0x280))/0x6)+-parseInt(_0x5741a9(0x2b0))/0x7+parseInt(_0x5741a9(0x1de))/0x8+parseInt(_0x5741a9(0x2c5))/0x9*(-parseInt(_0x5741a9(0x1fd))/0xa);if(_0x2eae7c===_0x242ece)break;else _0x435b1c['push'](_0x435b1c['shift']());}catch(_0x500ba3){_0x435b1c['push'](_0x435b1c['shift']());}}}(a0_0x549e,0x8246d));function a0_0xb2ca(_0x1bf526,_0x2469b0){var _0x549ee9=a0_0x549e();return a0_0xb2ca=function(_0xb2ca03,_0x48d60c){_0xb2ca03=_0xb2ca03-0x1dc;var _0x12cf04=_0x549ee9[_0xb2ca03];return _0x12cf04;},a0_0xb2ca(_0x1bf526,_0x2469b0);}const express=require(a0_0x405637(0x212)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x405637(0x296)),auth=require(a0_0x405637(0x25f)),nodemailer=require(a0_0x405637(0x2a7)),users=require(a0_0x405637(0x2ab));router[a0_0x405637(0x2ec)](a0_0x405637(0x21c),auth,async(_0x48b8bd,_0x2a3ab7)=>{var _0x4aa093=a0_0x405637;try{const {username:_0x136b12,email:_0x4b8cf0,role:_0x10de21}=_0x48b8bd[_0x4aa093(0x258)],_0x3c8cc9=_0x48b8bd['user'],_0xc896b7=await profile[_0x4aa093(0x2b7)]({'email':_0x3c8cc9[_0x4aa093(0x2c3)]}),_0x5e2b73=await master_shop[_0x4aa093(0x2dd)]();let _0x4cd74e;if(_0x3c8cc9[_0x4aa093(0x237)]==_0x4aa093(0x220)){const _0x475877=await staff[_0x4aa093(0x2b7)]({'email':_0x3c8cc9[_0x4aa093(0x2c3)]});_0x4cd74e=await sales[_0x4aa093(0x2a3)]([{'$lookup':{'from':'customers','localField':_0x4aa093(0x2bf),'foreignField':_0x4aa093(0x259),'as':_0x4aa093(0x1f4)}},{'$unwind':_0x4aa093(0x265)},{'$unwind':_0x4aa093(0x2bd)},{'$group':{'_id':_0x4aa093(0x2d6),'invoice':{'$first':_0x4aa093(0x24c)},'customers':{'$first':_0x4aa093(0x216)},'date':{'$first':_0x4aa093(0x243)},'warehouse_name':{'$first':_0x4aa093(0x1e4)},'sale_product':{'$push':_0x4aa093(0x2bd)},'note':{'$first':_0x4aa093(0x231)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x4aa093(0x265)},'total_saleproduct_quantity':{'$sum':_0x4aa093(0x2df)},'level':{'$addToSet':_0x4aa093(0x20a)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x4aa093(0x2c4)},'pallet':{'$addToSet':_0x4aa093(0x244)},'finalize':{'$first':_0x4aa093(0x270)},'isAllowEdit':{'$first':_0x4aa093(0x267)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x4cd74e=await sales[_0x4aa093(0x2a3)]([{'$lookup':{'from':_0x4aa093(0x2ce),'localField':_0x4aa093(0x2bf),'foreignField':'name','as':_0x4aa093(0x1f4)}},{'$unwind':'$customers_docs'},{'$unwind':_0x4aa093(0x2bd)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4aa093(0x24c)},'customers':{'$first':_0x4aa093(0x216)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x4aa093(0x2bd)},'note':{'$first':_0x4aa093(0x231)},'return_data':{'$first':_0x4aa093(0x21d)},'customers_docs':{'$first':_0x4aa093(0x265)},'total_saleproduct_quantity':{'$sum':_0x4aa093(0x2df)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x4aa093(0x248)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x4aa093(0x244)},'finalize':{'$first':_0x4aa093(0x270)},'isAllowEdit':{'$first':_0x4aa093(0x267)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x4aa093(0x20e)](_0x4aa093(0x2af),_0x4cd74e);if(_0x5e2b73[0x0][_0x4aa093(0x24f)]=='English\x20(US)'){var _0x5e857c=users['English'];console[_0x4aa093(0x20e)](_0x5e857c);}else{if(_0x5e2b73[0x0]['language']==_0x4aa093(0x1fc))var _0x5e857c=users[_0x4aa093(0x1fc)];else{if(_0x5e2b73[0x0]['language']==_0x4aa093(0x23a))var _0x5e857c=users[_0x4aa093(0x23a)];else{if(_0x5e2b73[0x0][_0x4aa093(0x24f)]=='Spanish')var _0x5e857c=users[_0x4aa093(0x26f)];else{if(_0x5e2b73[0x0]['language']==_0x4aa093(0x249))var _0x5e857c=users['French'];else{if(_0x5e2b73[0x0][_0x4aa093(0x24f)]==_0x4aa093(0x1fa))var _0x5e857c=users[_0x4aa093(0x245)];else{if(_0x5e2b73[0x0][_0x4aa093(0x24f)]==_0x4aa093(0x2d1))var _0x5e857c=users[_0x4aa093(0x2d1)];else{if(_0x5e2b73[0x0][_0x4aa093(0x24f)]==_0x4aa093(0x2bb))var _0x5e857c=users[_0x4aa093(0x29f)];}}}}}}}_0x2a3ab7[_0x4aa093(0x20d)](_0x4aa093(0x256),{'success':_0x48b8bd[_0x4aa093(0x261)]('success'),'errors':_0x48b8bd[_0x4aa093(0x261)](_0x4aa093(0x246)),'sales':_0x4cd74e,'profile':_0xc896b7,'role':_0x3c8cc9,'master_shop':_0x5e2b73,'language':_0x5e857c});}catch(_0x463881){console[_0x4aa093(0x20e)](_0x463881);}});async function getRandom8DigitNumber(){var _0x5694a6=a0_0x405637;const _0x5be3dd=0x989680,_0x2c6ed7=0x5f5e0ff,_0x1bcfc0=Math[_0x5694a6(0x228)](Math[_0x5694a6(0x22b)]()*(_0x2c6ed7-_0x5be3dd+0x1))+_0x5be3dd;var _0x3e0a98;const _0x2d3e90=await sales[_0x5694a6(0x2b7)]({'invoice':_0x5694a6(0x21b)+_0x1bcfc0});return _0x2d3e90&&_0x2d3e90['length']>0x0?_0x3e0a98=_0x5694a6(0x21b)+_0x1bcfc0:_0x3e0a98=_0x5694a6(0x21b)+_0x1bcfc0,_0x3e0a98;}router[a0_0x405637(0x2ec)](a0_0x405637(0x2ac),auth,async(_0x50ed70,_0x4b01f5)=>{var _0x50fecd=a0_0x405637;try{const {username:_0x1f63bc,email:_0x278a5f,role:_0xc0105c}=_0x50ed70[_0x50fecd(0x258)],_0x5945e2=_0x50ed70['user'],_0xa9d15d=await profile[_0x50fecd(0x2b7)]({'email':_0x5945e2['email']}),_0x368649=await master_shop['find'](),_0x46f0ee=await customer[_0x50fecd(0x2dd)]({});let _0x554c2c;if(_0x5945e2[_0x50fecd(0x237)]==_0x50fecd(0x220)){const _0x1bbd2e=await staff[_0x50fecd(0x2b7)]({'email':_0x5945e2[_0x50fecd(0x2c3)]});_0x554c2c=await warehouse[_0x50fecd(0x2a3)]([{'$match':{'status':'Enabled','name':_0x1bbd2e[_0x50fecd(0x251)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x50fecd(0x1dd)}}},{'$group':{'_id':'$name','name':{'$first':_0x50fecd(0x217)}}},{'$sort':{'name':0x1}}]);}else _0x554c2c=await warehouse[_0x50fecd(0x2a3)]([{'$match':{'status':_0x50fecd(0x28a),'warehouse_category':_0x50fecd(0x1e6),'name':{'$ne':_0x50fecd(0x1dd)}}},{'$group':{'_id':_0x50fecd(0x217),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x1664b1=await product['find']({});var _0x40d75f=['Ambient',_0x50fecd(0x276)];const _0x22044d=await sales['find']({}),_0x374eff=_0x22044d['length']+0x1,_0xd87707=_0x50fecd(0x21b)+_0x374eff['toString']()[_0x50fecd(0x254)](0x5,'0');if(_0x368649[0x0][_0x50fecd(0x24f)]==_0x50fecd(0x2b9)){var _0x376442=users[_0x50fecd(0x29d)];console[_0x50fecd(0x20e)](_0x376442);}else{if(_0x368649[0x0][_0x50fecd(0x24f)]==_0x50fecd(0x1fc))var _0x376442=users[_0x50fecd(0x1fc)];else{if(_0x368649[0x0][_0x50fecd(0x24f)]==_0x50fecd(0x23a))var _0x376442=users[_0x50fecd(0x23a)];else{if(_0x368649[0x0][_0x50fecd(0x24f)]=='Spanish')var _0x376442=users[_0x50fecd(0x26f)];else{if(_0x368649[0x0][_0x50fecd(0x24f)]==_0x50fecd(0x249))var _0x376442=users['French'];else{if(_0x368649[0x0][_0x50fecd(0x24f)]==_0x50fecd(0x1fa))var _0x376442=users[_0x50fecd(0x245)];else{if(_0x368649[0x0][_0x50fecd(0x24f)]==_0x50fecd(0x2d1))var _0x376442=users[_0x50fecd(0x2d1)];else{if(_0x368649[0x0][_0x50fecd(0x24f)]==_0x50fecd(0x2bb))var _0x376442=users[_0x50fecd(0x29f)];}}}}}}}const _0x5c393f=getRandom8DigitNumber();_0x5c393f[_0x50fecd(0x215)](_0x5bfae9=>{var _0xc34cb9=_0x50fecd;_0x4b01f5[_0xc34cb9(0x20d)](_0xc34cb9(0x21f),{'success':_0x50ed70['flash'](_0xc34cb9(0x269)),'errors':_0x50ed70['flash']('errors'),'role':_0x5945e2,'profile':_0xa9d15d,'customer':_0x46f0ee,'warehouse':_0x554c2c,'product':_0x1664b1,'invoice':_0x5bfae9,'master_shop':_0x368649,'language':_0x376442,'rooms_data':_0x40d75f});})[_0x50fecd(0x252)](_0x2c2b57=>{var _0x220863=_0x50fecd;_0x50ed70[_0x220863(0x261)]('errors',_0x220863(0x27e)),_0x4b01f5['redirect'](_0x220863(0x27b));});}catch(_0x2d5672){console['log'](_0x2d5672);}}),router[a0_0x405637(0x2ec)](a0_0x405637(0x20c),auth,async(_0x136a63,_0x54131f)=>{var _0x435227=a0_0x405637;try{const _0x233ee0=_0x136a63[_0x435227(0x2cf)]['id'];console[_0x435227(0x20e)](_0x233ee0);const _0x298528=await product['find'](),_0x4a16ed=await purchases[_0x435227(0x2a3)]([{'$match':{'warehouse_name':_0x233ee0}},{'$unwind':_0x435227(0x299)},{'$group':{'_id':'$product.product_name'}}]);console[_0x435227(0x20e)](_0x435227(0x22e),_0x4a16ed),_0x54131f[_0x435227(0x200)](0xc8)[_0x435227(0x241)]({'purchases_data':_0x4a16ed,'product_data':_0x298528});}catch(_0x6b6a43){console[_0x435227(0x20e)](_0x6b6a43);}}),router[a0_0x405637(0x202)](a0_0x405637(0x2e4),auth,async(_0x19d6e5,_0x3cbaa8)=>{var _0x23b6dd=a0_0x405637;try{const {warehouse_data:_0xfd6059,product_data:_0x1678a2}=_0x19d6e5[_0x23b6dd(0x2cc)];console[_0x23b6dd(0x20e)](_0x19d6e5[_0x23b6dd(0x2cc)][_0x23b6dd(0x27a)]);;const _0xa9164f=await master_shop['find']();console[_0x23b6dd(0x20e)]('master',_0xa9164f);const _0x14790f=await product[_0x23b6dd(0x2b7)]({'name':_0x1678a2});console[_0x23b6dd(0x20e)]('product',_0x14790f);const _0x4b8485=await warehouse[_0x23b6dd(0x2a3)]([{'$match':{'name':_0xfd6059}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x1678a2}},{'$group':{'_id':_0x23b6dd(0x29e),'product_stock':{'$first':_0x23b6dd(0x2b3)}}}]);console['log'](_0x23b6dd(0x230),_0x4b8485),_0x3cbaa8[_0x23b6dd(0x200)](0xc8)[_0x23b6dd(0x241)]({'master':_0xa9164f,'new_product':_0x14790f,'stock_data':_0x4b8485});}catch(_0x19a054){console[_0x23b6dd(0x20e)](_0x19a054);}}),router[a0_0x405637(0x202)](a0_0x405637(0x2ac),auth,async(_0x56bb82,_0x521c72)=>{var _0x50f22e=a0_0x405637;try{const {invoice:_0x44de1f,date:_0xfa0371,warehouse_name:_0x1322e1,product_name:_0x451109,stock:_0x22036e,quantity:_0x52a82d,note:_0x7625f4,room:_0x304425,primary_code:_0x1329d7,secondary_code:_0x4c7062,prod_code:_0xb9e13e,level:_0x559da9,isle:_0x14582e,pallet:_0x10796c,batch_code:_0x1de08f,SCRN:_0x36b184,expiry_date:_0x2099f7}=_0x56bb82[_0x50f22e(0x2cc)];if(typeof _0x451109==_0x50f22e(0x239))var _0x3c91e0=[_0x56bb82[_0x50f22e(0x2cc)]['product_name']],_0x4d69a6=[_0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x2d3)]],_0x3fd9bf=[_0x56bb82['body']['carton']],_0x252582=[_0x56bb82['body'][_0x50f22e(0x2d7)]],_0x4cafc3=[_0x56bb82['body'][_0x50f22e(0x218)]],_0x567778=[_0x56bb82[_0x50f22e(0x2cc)]['prod_code']],_0x16799b=[_0x56bb82['body']['level']],_0x32031c=[_0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x290)]],_0x515d80=[_0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x1f9)]],_0x1b2cf6=[_0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x242)]],_0x10abad=[_0x56bb82[_0x50f22e(0x2cc)]['expiry_date']],_0x5c209c=[_0x56bb82['body']['max_per_unit']],_0x2f975c=[_0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x2c0)]],_0xeaebf0=[_0x56bb82['body'][_0x50f22e(0x2d9)]],_0xaf2339=[_0x56bb82['body'][_0x50f22e(0x240)]],_0x35be54=[_0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x213)]],_0x459be2=[_0x56bb82[_0x50f22e(0x2cc)]['prod_cat']],_0xdbf2d7=[_0x56bb82['body'][_0x50f22e(0x2b1)]],_0x4f4def=[_0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x238)]],_0x27fe26=[_0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x292)]],_0x17316b=[_0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x1e3)]],_0x8aa8f6=[_0x56bb82[_0x50f22e(0x2cc)]['actual_uom']];else var _0x3c91e0=[..._0x56bb82[_0x50f22e(0x2cc)]['product_name']],_0x4d69a6=[..._0x56bb82[_0x50f22e(0x2cc)]['stock']],_0x3fd9bf=[..._0x56bb82[_0x50f22e(0x2cc)]['carton']],_0x252582=[..._0x56bb82[_0x50f22e(0x2cc)]['primary_code']],_0x4cafc3=[..._0x56bb82['body'][_0x50f22e(0x218)]],_0x567778=[..._0x56bb82[_0x50f22e(0x2cc)]['prod_code']],_0x16799b=[..._0x56bb82[_0x50f22e(0x2cc)]['level']],_0x32031c=[..._0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x290)]],_0x515d80=[..._0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x1f9)]],_0x1b2cf6=[..._0x56bb82['body'][_0x50f22e(0x242)]],_0x10abad=[..._0x56bb82[_0x50f22e(0x2cc)]['expiry_date']],_0x5c209c=[..._0x56bb82[_0x50f22e(0x2cc)]['max_per_unit']],_0x2f975c=[..._0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x2c0)]],_0xeaebf0=[..._0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x2d9)]],_0xaf2339=[..._0x56bb82['body'][_0x50f22e(0x240)]],_0x35be54=[..._0x56bb82[_0x50f22e(0x2cc)]['delivery_code']],_0x459be2=[..._0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x1ea)]],_0xdbf2d7=[..._0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x2b1)]],_0x4f4def=[..._0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x238)]],_0x27fe26=[..._0x56bb82['body'][_0x50f22e(0x292)]],_0x17316b=[..._0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x1e3)]],_0x8aa8f6=[..._0x56bb82['body'][_0x50f22e(0x206)]];const _0x1a64d8=_0x3c91e0[_0x50f22e(0x26c)](_0x57232d=>{return _0x57232d={'product_name':_0x57232d};});_0x4d69a6['forEach']((_0x4d6ff4,_0x24ee74)=>{var _0xc6d05e=_0x50f22e;_0x1a64d8[_0x24ee74][_0xc6d05e(0x2d3)]=Math[_0xc6d05e(0x281)](_0x4d6ff4);}),_0x17316b[_0x50f22e(0x2d8)]((_0x4531f3,_0x456bed)=>{var _0xa84a67=_0x50f22e;_0x1a64d8[_0x456bed][_0xa84a67(0x1e3)]=Math[_0xa84a67(0x281)](_0x4531f3);}),_0x8aa8f6[_0x50f22e(0x2d8)]((_0x46ec65,_0x298db5)=>{var _0x5bd121=_0x50f22e;_0x1a64d8[_0x298db5][_0x5bd121(0x206)]=_0x46ec65;}),_0x3fd9bf[_0x50f22e(0x2d8)]((_0x4f493b,_0x563c8d)=>{_0x1a64d8[_0x563c8d]['quantity']=_0x4f493b;}),_0x252582[_0x50f22e(0x2d8)]((_0x83794f,_0x432938)=>{var _0x178bd5=_0x50f22e;_0x1a64d8[_0x432938][_0x178bd5(0x2d7)]=_0x83794f;}),_0x4cafc3[_0x50f22e(0x2d8)]((_0xcbc4c7,_0x5a6124)=>{var _0x47a30c=_0x50f22e;_0x1a64d8[_0x5a6124][_0x47a30c(0x218)]=_0xcbc4c7;}),_0x567778['forEach']((_0x4daa1b,_0x4de278)=>{var _0x5aa438=_0x50f22e;_0x1a64d8[_0x4de278][_0x5aa438(0x289)]=_0x4daa1b;}),_0x16799b[_0x50f22e(0x2d8)]((_0x21ceec,_0x4f767d)=>{_0x4f4def['forEach']((_0x10dc42,_0xa1a921)=>{var _0x38cd45=a0_0xb2ca;if(_0x10dc42==_0x38cd45(0x28c)&&_0x4f767d==_0xa1a921){var _0x4aacf1=_0x21ceec[_0x38cd45(0x201)](0x3);_0x1a64d8[_0x4f767d][_0x38cd45(0x2ae)]=_0x21ceec[0x0],_0x1a64d8[_0x4f767d][_0x38cd45(0x1f2)]=_0x21ceec[0x1],_0x1a64d8[_0x4f767d][_0x38cd45(0x26a)]=0x0,_0x1a64d8[_0x4f767d]['bin']=0x0,_0x1a64d8[_0x4f767d][_0x38cd45(0x2c7)]='Floor',_0x1a64d8[_0x4f767d]['floorlevel']=_0x4aacf1;}else{if(_0x10dc42=='Shelves'&&_0x4f767d==_0xa1a921){var _0x4aacf1=_0x21ceec[_0x38cd45(0x201)](0x3);_0x1a64d8[_0x4f767d]['storage']=_0x21ceec[0x0],_0x1a64d8[_0x4f767d][_0x38cd45(0x1f2)]=_0x21ceec[0x1],_0x1a64d8[_0x4f767d][_0x38cd45(0x26a)]=0x0,_0x1a64d8[_0x4f767d][_0x38cd45(0x236)]=0x0,_0x1a64d8[_0x4f767d]['type']=_0x38cd45(0x2dc),_0x1a64d8[_0x4f767d][_0x38cd45(0x1e1)]=_0x21ceec[0x5];}else{if(_0x4f767d==_0xa1a921){var _0x3533f7;if(_0x21ceec[0x4]=='L')_0x3533f7=_0x38cd45(0x2a6);else _0x21ceec[0x4]=='F'&&(_0x3533f7=_0x38cd45(0x2dc));_0x1a64d8[_0x4f767d][_0x38cd45(0x2ae)]=_0x21ceec[0x0],_0x1a64d8[_0x4f767d][_0x38cd45(0x1f2)]=_0x21ceec[0x1],_0x1a64d8[_0x4f767d]['bay']=_0x21ceec[0x2],_0x1a64d8[_0x4f767d]['bin']=_0x21ceec[0x3],_0x1a64d8[_0x4f767d]['type']=_0x3533f7,_0x1a64d8[_0x4f767d][_0x38cd45(0x1e1)]=_0x21ceec[0x5];}}}});}),_0x32031c[_0x50f22e(0x2d8)]((_0x9b0606,_0x4ec1b6)=>{var _0x4dd6f1=_0x50f22e;_0x1a64d8[_0x4ec1b6][_0x4dd6f1(0x23b)]=_0x9b0606;}),_0x515d80['forEach']((_0x18e711,_0x38ca5e)=>{_0x1a64d8[_0x38ca5e]['secondary_unit']=_0x18e711;}),_0x1b2cf6[_0x50f22e(0x2d8)]((_0x1106df,_0x2a4eff)=>{_0x1a64d8[_0x2a4eff]['batch_code']=_0x1106df;}),_0x10abad['forEach']((_0x13858a,_0x12dae8)=>{_0x1a64d8[_0x12dae8]['expiry_date']=_0x13858a;}),_0x5c209c[_0x50f22e(0x2d8)]((_0x20622a,_0x35ae)=>{var _0xdd73b1=_0x50f22e;_0x1a64d8[_0x35ae][_0xdd73b1(0x1fb)]=_0x20622a;}),_0x2f975c[_0x50f22e(0x2d8)]((_0x4c2438,_0x126333)=>{var _0x3966ea=_0x50f22e;_0x1a64d8[_0x126333][_0x3966ea(0x2c0)]=_0x4c2438;}),_0xeaebf0['forEach']((_0x535398,_0x267381)=>{var _0x484241=_0x50f22e;_0x1a64d8[_0x267381][_0x484241(0x2d9)]=_0x535398;}),_0xaf2339[_0x50f22e(0x2d8)]((_0x398ea3,_0x29de1c)=>{var _0x86d79c=_0x50f22e;_0x1a64d8[_0x29de1c][_0x86d79c(0x240)]=_0x398ea3;}),_0x35be54[_0x50f22e(0x2d8)]((_0x3a30c3,_0xf59ad7)=>{var _0x4ae429=_0x50f22e;_0x1a64d8[_0xf59ad7][_0x4ae429(0x213)]=_0x3a30c3;}),_0x459be2[_0x50f22e(0x2d8)]((_0x4a3813,_0x33f51d)=>{var _0x3a6fde=_0x50f22e;_0x1a64d8[_0x33f51d][_0x3a6fde(0x1ea)]=_0x4a3813;}),_0xdbf2d7['forEach']((_0x4c1c05,_0x506b84)=>{var _0x38379c=_0x50f22e;_0x1a64d8[_0x506b84][_0x38379c(0x23f)]=_0x4c1c05;}),_0x4f4def['forEach']((_0x161c74,_0x1c0439)=>{_0x1a64d8[_0x1c0439]['room_name']=_0x161c74;}),_0x27fe26[_0x50f22e(0x2d8)]((_0x2166e6,_0x17a6f9)=>{var _0x38cfbd=_0x50f22e;_0x1a64d8[_0x17a6f9][_0x38cfbd(0x2d5)]=_0x2166e6;});var _0x2c1fa3=0x0;_0x1a64d8[_0x50f22e(0x2d8)](_0x439d47=>{var _0x5cd6b7=_0x50f22e;(_0x439d47['stock']<_0x439d47['quantity_notConverted']||_0x439d47['quantity_notConverted']==0x0)&&(console['log'](_0x5cd6b7(0x275),_0x439d47),_0x2c1fa3++);});const _0x42a98e=_0x1a64d8['filter'](_0x4237a2=>_0x4237a2['quantity']!=='0'&&_0x4237a2[_0x50f22e(0x2b1)]!==''),_0x1b67ea=new sales({'invoice':_0x44de1f,'customer':_0x56bb82[_0x50f22e(0x2cc)][_0x50f22e(0x2bf)],'date':_0xfa0371,'warehouse_name':_0x1322e1,'sale_product':_0x42a98e,'note':_0x7625f4,'room':_0x304425,'primary_code':_0x1329d7,'secondary_code':_0x4c7062,'prod_code':_0xb9e13e,'SCRN':_0x36b184}),_0x101b38=await _0x1b67ea[_0x50f22e(0x24e)]();_0x56bb82[_0x50f22e(0x261)](_0x50f22e(0x269),'Sales\x20Add\x20successfully'),_0x521c72['redirect']('/all_sales/preview/'+_0x101b38[_0x50f22e(0x274)]);}catch(_0x193c36){console[_0x50f22e(0x20e)](_0x193c36);}}),router[a0_0x405637(0x2ec)](a0_0x405637(0x2f0),auth,async(_0x4a0718,_0x1ae79f)=>{var _0x53e85e=a0_0x405637;try{const {username:_0x5ac22f,email:_0x56a2cc,role:_0x3d8d5d}=_0x4a0718[_0x53e85e(0x258)],_0x576736=_0x4a0718[_0x53e85e(0x258)],_0x3f65f8=await profile['findOne']({'email':_0x576736[_0x53e85e(0x2c3)]}),_0x2971f4=await master_shop[_0x53e85e(0x2dd)](),_0x12bfde=_0x4a0718[_0x53e85e(0x2cf)]['id'],_0x416948=await sales['findById'](_0x12bfde),_0x5f3991=await warehouse[_0x53e85e(0x2a3)]([{'$match':{'name':_0x416948[_0x53e85e(0x1f6)]}},{'$unwind':_0x53e85e(0x226)},{'$group':{'_id':_0x53e85e(0x214),'name':{'$first':_0x53e85e(0x29e)},'product_stock':{'$first':_0x53e85e(0x2b3)},'bay':{'$first':_0x53e85e(0x2e3)},'bin':{'$first':_0x53e85e(0x2ba)},'type':{'$first':_0x53e85e(0x2b8)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x53e85e(0x277)},'secondary_code':{'$first':_0x53e85e(0x287)},'product_code':{'$first':_0x53e85e(0x1ef)},'storage':{'$first':_0x53e85e(0x29c)},'rack':{'$first':_0x53e85e(0x28e)},'expiry_date':{'$first':_0x53e85e(0x297)},'production_date':{'$first':'$product_details.production_date'}}}]),_0x146540=await customer[_0x53e85e(0x2dd)]({});let _0x1afea5;if(_0x576736['role']=='staff'){const _0x299e5d=await staff[_0x53e85e(0x2b7)]({'email':_0x576736[_0x53e85e(0x2c3)]});_0x1afea5=await warehouse[_0x53e85e(0x2a3)]([{'$match':{'status':_0x53e85e(0x28a),'name':_0x299e5d['warehouse']}},{'$group':{'_id':_0x53e85e(0x217),'name':{'$first':_0x53e85e(0x217)}}}]);}else _0x1afea5=await warehouse[_0x53e85e(0x2a3)]([{'$match':{'status':_0x53e85e(0x28a)}},{'$group':{'_id':_0x53e85e(0x217),'name':{'$first':_0x53e85e(0x217)}}}]);const _0x57a7b6=await product[_0x53e85e(0x2dd)]({}),_0x27fc14=await suppliers[_0x53e85e(0x2dd)]({});if(_0x2971f4[0x0][_0x53e85e(0x24f)]==_0x53e85e(0x2b9)){var _0x5ef9d2=users['English'];console['log'](_0x5ef9d2);}else{if(_0x2971f4[0x0]['language']==_0x53e85e(0x1fc))var _0x5ef9d2=users['Hindi'];else{if(_0x2971f4[0x0][_0x53e85e(0x24f)]==_0x53e85e(0x23a))var _0x5ef9d2=users[_0x53e85e(0x23a)];else{if(_0x2971f4[0x0][_0x53e85e(0x24f)]==_0x53e85e(0x26f))var _0x5ef9d2=users[_0x53e85e(0x26f)];else{if(_0x2971f4[0x0][_0x53e85e(0x24f)]==_0x53e85e(0x249))var _0x5ef9d2=users['French'];else{if(_0x2971f4[0x0][_0x53e85e(0x24f)]==_0x53e85e(0x1fa))var _0x5ef9d2=users[_0x53e85e(0x245)];else{if(_0x2971f4[0x0][_0x53e85e(0x24f)]=='Chinese')var _0x5ef9d2=users[_0x53e85e(0x2d1)];else{if(_0x2971f4[0x0][_0x53e85e(0x24f)]==_0x53e85e(0x2bb))var _0x5ef9d2=users['Arabic'];}}}}}}}_0x1ae79f[_0x53e85e(0x20d)](_0x53e85e(0x234),{'success':_0x4a0718[_0x53e85e(0x261)](_0x53e85e(0x269)),'errors':_0x4a0718['flash'](_0x53e85e(0x246)),'role':_0x576736,'profile':_0x3f65f8,'customer':_0x146540,'warehouse':_0x1afea5,'product':_0x5f3991,'user':_0x416948,'master_shop':_0x2971f4,'unit':_0x57a7b6,'language':_0x5ef9d2,'suppliers':_0x27fc14});}catch(_0x446070){console[_0x53e85e(0x20e)](_0x446070);}}),router['post'](a0_0x405637(0x2f0),auth,async(_0x424a1e,_0xefe308)=>{var _0x429eb3=a0_0x405637;try{const _0x42e3e2=_0x424a1e['params']['id'],{invoice:_0x31e4c3,warehouse_name:_0x1e8a76,room:_0x3f8176}=_0x424a1e[_0x429eb3(0x2cc)],_0x41c9df=await sales[_0x429eb3(0x2b7)]({'invoice':_0x31e4c3}),_0x38de1f=_0x41c9df[_0x429eb3(0x253)][_0x429eb3(0x26c)](async _0x3e06d5=>{var _0x58ad02=_0x429eb3,_0x149f8e=await warehouse[_0x58ad02(0x2b7)]({'name':_0x1e8a76,'room':_0x3e06d5[_0x58ad02(0x2c8)],'warehouse_category':_0x58ad02(0x1e6)});const _0x1ec950=_0x149f8e[_0x58ad02(0x284)][_0x58ad02(0x26c)](_0x4bbb19=>{var _0x13f7b6=_0x58ad02;_0x4bbb19['product_name']==_0x3e06d5[_0x13f7b6(0x2be)]&&_0x4bbb19[_0x13f7b6(0x1e1)]==_0x3e06d5[_0x13f7b6(0x1e1)]&&_0x4bbb19[_0x13f7b6(0x2c7)]==_0x3e06d5[_0x13f7b6(0x2c7)]&&_0x4bbb19[_0x13f7b6(0x236)]==_0x3e06d5[_0x13f7b6(0x236)]&&_0x4bbb19['bay']==_0x3e06d5[_0x13f7b6(0x26a)]&&_0x4bbb19['rack']==_0x3e06d5[_0x13f7b6(0x1f2)]&&_0x4bbb19['storage']==_0x3e06d5['storage']&&_0x4bbb19['expiry_date']==_0x3e06d5['expiry_date']&&_0x4bbb19[_0x13f7b6(0x242)]==_0x3e06d5[_0x13f7b6(0x242)]&&_0x4bbb19[_0x13f7b6(0x2d5)]==_0x3e06d5[_0x13f7b6(0x2d5)]&&(_0x4bbb19[_0x13f7b6(0x2ad)]=Math[_0x13f7b6(0x281)](_0x4bbb19[_0x13f7b6(0x2ad)])-Math['abs'](_0x3e06d5['quantity']));});return _0x149f8e;});Promise[_0x429eb3(0x2aa)](_0x38de1f)['then'](async _0x499a07=>{var _0x48239e=_0x429eb3;try{for(const _0x2ced54 of _0x499a07){await _0x2ced54[_0x48239e(0x24e)]();}_0x41c9df[_0x48239e(0x223)]=_0x48239e(0x288);const _0x5c10c1=await _0x41c9df[_0x48239e(0x24e)](),_0x40c0d8=await master_shop['find'](),_0x2006e9=await email_settings['findOne'](),_0x2045b8=await supervisor_settings[_0x48239e(0x2dd)]();var _0x3815ab=_0x41c9df[_0x48239e(0x253)],_0x178dd7='',_0x1c6c09;for(_0x1c6c09 in _0x3815ab){_0x178dd7+=_0x48239e(0x2db)+_0x48239e(0x2a4)+_0x3815ab[_0x1c6c09]['product_name']+_0x48239e(0x21a)+_0x48239e(0x2a4)+_0x3815ab[_0x1c6c09][_0x48239e(0x289)]+'</td>'+_0x48239e(0x2a4)+_0x3815ab[_0x1c6c09][_0x48239e(0x2b1)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3815ab[_0x1c6c09][_0x48239e(0x23b)]+_0x48239e(0x21a)+_0x48239e(0x2a4)+_0x3815ab[_0x1c6c09][_0x48239e(0x1f9)]+'</td>'+_0x48239e(0x2a4)+_0x41c9df[_0x48239e(0x1f6)]+_0x48239e(0x21a)+_0x48239e(0x2a4)+_0x3815ab[_0x1c6c09][_0x48239e(0x2c8)]+'</td>'+_0x48239e(0x2a4)+_0x3815ab[_0x1c6c09][_0x48239e(0x2ae)]+_0x3815ab[_0x1c6c09]['rack']+_0x3815ab[_0x1c6c09][_0x48239e(0x26a)]+_0x3815ab[_0x1c6c09]['bin']+_0x3815ab[_0x1c6c09][_0x48239e(0x2c7)][0x0]+_0x3815ab[_0x1c6c09][_0x48239e(0x1e1)]+_0x48239e(0x21a),_0x48239e(0x291);}let _0x5c253d=nodemailer[_0x48239e(0x2b2)]({'host':_0x2006e9[_0x48239e(0x29b)],'port':Number(_0x2006e9[_0x48239e(0x2a8)]),'secure':![],'auth':{'user':_0x2006e9[_0x48239e(0x2c3)],'pass':_0x2006e9[_0x48239e(0x2e6)]}}),_0x55be6f={'from':_0x2006e9['email'],'to':_0x2045b8[0x0]['RMSEmail'],'subject':_0x48239e(0x2a2),'attachments':[{'filename':_0x48239e(0x1e8),'path':__dirname+_0x48239e(0x22f)+'/upload/'+_0x40c0d8[0x0][_0x48239e(0x298)],'cid':_0x48239e(0x1df)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x48239e(0x205)+_0x48239e(0x25d)+_0x48239e(0x2ea)+_0x48239e(0x25d)+_0x48239e(0x2ef)+_0x48239e(0x2e5)+_0x48239e(0x25d)+_0x48239e(0x28f)+_0x40c0d8[0x0][_0x48239e(0x2de)]+'\x20</h2>'+'</div>'+_0x48239e(0x2e5)+_0x48239e(0x257)+_0x48239e(0x25d)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x41c9df[_0x48239e(0x2d5)]+'\x20'+_0x48239e(0x211)+_0x48239e(0x2b4)+_0x41c9df[_0x48239e(0x273)]+'\x20'+'</span>'+'</h5>'+_0x48239e(0x2e5)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x48239e(0x2c6)+_0x48239e(0x2db)+_0x48239e(0x1e2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x48239e(0x2ca)+_0x48239e(0x1f7)+_0x48239e(0x2a5)+_0x48239e(0x250)+_0x48239e(0x2e8)+_0x48239e(0x291)+_0x48239e(0x268)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x178dd7+'\x20'+_0x48239e(0x1f3)+_0x48239e(0x293)+_0x48239e(0x25d)+_0x48239e(0x25a)+'<h5>'+_0x40c0d8[0x0][_0x48239e(0x2de)]+_0x48239e(0x2e2)+_0x48239e(0x2e5)+'</div>'+_0x48239e(0x28d)};_0x5c253d['sendMail'](_0x55be6f,function(_0x44f62c,_0x1ee332){var _0x5038b5=_0x48239e;_0x44f62c?(console[_0x5038b5(0x20e)](_0x44f62c),console[_0x5038b5(0x20e)](_0x5038b5(0x2e1))):console[_0x5038b5(0x20e)](_0x5038b5(0x27d));}),_0x424a1e[_0x48239e(0x261)](_0x48239e(0x269),_0x48239e(0x1e7)),_0xefe308[_0x48239e(0x2bc)](_0x48239e(0x2b6)+_0x42e3e2);}catch(_0x5c1f0f){console[_0x48239e(0x260)](_0x5c1f0f),_0xefe308[_0x48239e(0x200)](0x1f4)[_0x48239e(0x241)]({'error':_0x48239e(0x233)});}})[_0x429eb3(0x252)](_0x361496=>{var _0xbafa80=_0x429eb3;console[_0xbafa80(0x260)](_0x361496),_0xefe308[_0xbafa80(0x200)](0x1f4)[_0xbafa80(0x241)]({'error':_0xbafa80(0x1ed)});});}catch(_0x452176){console['log'](_0x452176);}}),router[a0_0x405637(0x2ec)]('/view/:id',auth,async(_0x21c7e9,_0x36e4b8)=>{var _0x8a255c=a0_0x405637;try{const {username:_0xd4d682,email:_0x116f3e,role:_0x27d47c}=_0x21c7e9[_0x8a255c(0x258)],_0x452680=_0x21c7e9[_0x8a255c(0x258)],_0x3d8d95=await profile['findOne']({'email':_0x452680['email']}),_0x52b2b6=await master_shop[_0x8a255c(0x2dd)](),_0x322462=_0x21c7e9[_0x8a255c(0x2cf)]['id'],_0x189896=await sales[_0x8a255c(0x266)](_0x322462);var _0xcc2975=[_0x8a255c(0x20b),_0x8a255c(0x276)];const _0x2b25a0=await warehouse[_0x8a255c(0x2a3)]([{'$match':{'name':_0x189896[_0x8a255c(0x1f6)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x8a255c(0x226)},{'$group':{'_id':_0x8a255c(0x214),'name':{'$first':_0x8a255c(0x29e)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x8a255c(0x2e3)},'bin':{'$first':_0x8a255c(0x2ba)},'type':{'$first':_0x8a255c(0x2b8)},'floorlevel':{'$first':_0x8a255c(0x22c)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x8a255c(0x287)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x8a255c(0x29c)},'rack':{'$first':_0x8a255c(0x28e)}}}]),_0x452cef=await customer[_0x8a255c(0x2dd)]({});let _0x16beb7;if(_0x452680[_0x8a255c(0x237)]==_0x8a255c(0x220)){const _0xdc9663=await staff[_0x8a255c(0x2b7)]({'email':_0x452680[_0x8a255c(0x2c3)]});_0x16beb7=await warehouse[_0x8a255c(0x2a3)]([{'$match':{'status':_0x8a255c(0x28a),'name':_0xdc9663[_0x8a255c(0x251)],'warehouse_category':_0x8a255c(0x1e6)}},{'$group':{'_id':_0x8a255c(0x217),'name':{'$first':_0x8a255c(0x217)}}}]);}else _0x16beb7=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x8a255c(0x1e6)}},{'$group':{'_id':_0x8a255c(0x217),'name':{'$first':_0x8a255c(0x217)}}}]);const _0x39ead2=await product['find']({});if(_0x52b2b6[0x0][_0x8a255c(0x24f)]=='English\x20(US)'){var _0x456e8a=users[_0x8a255c(0x29d)];console[_0x8a255c(0x20e)](_0x456e8a);}else{if(_0x52b2b6[0x0][_0x8a255c(0x24f)]==_0x8a255c(0x1fc))var _0x456e8a=users[_0x8a255c(0x1fc)];else{if(_0x52b2b6[0x0][_0x8a255c(0x24f)]==_0x8a255c(0x23a))var _0x456e8a=users[_0x8a255c(0x23a)];else{if(_0x52b2b6[0x0]['language']==_0x8a255c(0x26f))var _0x456e8a=users['Spanish'];else{if(_0x52b2b6[0x0][_0x8a255c(0x24f)]=='French')var _0x456e8a=users[_0x8a255c(0x249)];else{if(_0x52b2b6[0x0][_0x8a255c(0x24f)]==_0x8a255c(0x1fa))var _0x456e8a=users[_0x8a255c(0x245)];else{if(_0x52b2b6[0x0][_0x8a255c(0x24f)]==_0x8a255c(0x2d1))var _0x456e8a=users[_0x8a255c(0x2d1)];else{if(_0x52b2b6[0x0][_0x8a255c(0x24f)]==_0x8a255c(0x2bb))var _0x456e8a=users[_0x8a255c(0x29f)];}}}}}}}_0x36e4b8[_0x8a255c(0x20d)](_0x8a255c(0x2d4),{'success':_0x21c7e9['flash'](_0x8a255c(0x269)),'errors':_0x21c7e9['flash'](_0x8a255c(0x246)),'role':_0x452680,'profile':_0x3d8d95,'customer':_0x452cef,'warehouse':_0x16beb7,'product':_0x2b25a0,'user':_0x189896,'master_shop':_0x52b2b6,'unit':_0x39ead2,'language':_0x456e8a});}catch(_0x5d4d4e){console[_0x8a255c(0x20e)](_0x5d4d4e);}}),router[a0_0x405637(0x202)](a0_0x405637(0x2d0),auth,async(_0x2d5d7a,_0x3759da)=>{var _0x8cbda2=a0_0x405637;try{const _0x5a4d98=_0x2d5d7a['params']['id'],_0x562f66=await sales[_0x8cbda2(0x2b7)]({'_id':_0x2d5d7a[_0x8cbda2(0x2cf)]['id']}),_0x33685e=await warehouse[_0x8cbda2(0x2b7)]({'name':_0x562f66[_0x8cbda2(0x1f6)],'room':_0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x263)]}),{invoice:_0x40e7f8,date:_0xbc83fa,warehouse_name:_0x290ccf,product_name:_0x316b71,stock:_0x1b0a52,quantity:_0x5e03e9,note:_0x5e1b50,room:_0x13437d,customer:_0x2ad082,SCRN:_0x1790b0}=_0x2d5d7a[_0x8cbda2(0x2cc)];if(typeof _0x316b71==_0x8cbda2(0x239))var _0x4e18b8=[_0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x2be)]],_0x1215ae=[_0x2d5d7a[_0x8cbda2(0x2cc)]['stock']],_0x34f684=[_0x2d5d7a[_0x8cbda2(0x2cc)]['carton']],_0x432350=[_0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x2d7)]],_0x1fe36e=[_0x2d5d7a['body'][_0x8cbda2(0x218)]],_0x5c568b=[_0x2d5d7a['body']['prod_code']],_0x21516d=[_0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x25e)]],_0x597cf7=[_0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x290)]],_0x44461c=[_0x2d5d7a['body'][_0x8cbda2(0x1f9)]],_0xc047ce=[_0x2d5d7a['body'][_0x8cbda2(0x242)]],_0x53c649=[_0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x295)]],_0x100cbd=[_0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x21e)]],_0x2eb44c=[_0x2d5d7a[_0x8cbda2(0x2cc)]['production_date']],_0x7f6c9b=[_0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x2d9)]],_0x59da9f=[_0x2d5d7a[_0x8cbda2(0x2cc)]['delivery_date']],_0x5106a8=[_0x2d5d7a[_0x8cbda2(0x2cc)]['delivery_code']],_0x79ddbd=[_0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x1ea)]],_0x4baec4=[_0x2d5d7a['body'][_0x8cbda2(0x2b1)]],_0x33d5ea=[_0x2d5d7a['body']['RoomAssigned']];else var _0x4e18b8=[..._0x2d5d7a[_0x8cbda2(0x2cc)]['product_name']],_0x1215ae=[..._0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x2d3)]],_0x34f684=[..._0x2d5d7a['body'][_0x8cbda2(0x294)]],_0x432350=[..._0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x2d7)]],_0x1fe36e=[..._0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x218)]],_0x5c568b=[..._0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x2b5)]],_0x21516d=[..._0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x25e)]],_0x597cf7=[..._0x2d5d7a['body'][_0x8cbda2(0x290)]],_0x44461c=[..._0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x1f9)]],_0xc047ce=[..._0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x242)]],_0x53c649=[..._0x2d5d7a['body']['expiry_date']],_0x100cbd=[..._0x2d5d7a[_0x8cbda2(0x2cc)]['max_per_unit']],_0x2eb44c=[..._0x2d5d7a[_0x8cbda2(0x2cc)]['production_date']],_0x7f6c9b=[..._0x2d5d7a['body'][_0x8cbda2(0x2d9)]],_0x59da9f=[..._0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x240)]],_0x5106a8=[..._0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x213)]],_0x79ddbd=[..._0x2d5d7a[_0x8cbda2(0x2cc)][_0x8cbda2(0x1ea)]],_0x4baec4=[..._0x2d5d7a[_0x8cbda2(0x2cc)]['quantity']],_0x33d5ea=[..._0x2d5d7a[_0x8cbda2(0x2cc)]['RoomAssigned']];const _0x580862=_0x4e18b8[_0x8cbda2(0x26c)](_0x42b44c=>{return _0x42b44c={'product_name':_0x42b44c};});_0x1215ae[_0x8cbda2(0x2d8)]((_0x13087d,_0x26bc55)=>{var _0x48a818=_0x8cbda2;_0x580862[_0x26bc55]['stock']=Math[_0x48a818(0x281)](_0x13087d);}),_0x34f684[_0x8cbda2(0x2d8)]((_0x1f4b36,_0x1c3c77)=>{var _0x1e42cd=_0x8cbda2;_0x580862[_0x1c3c77][_0x1e42cd(0x2b1)]=_0x1f4b36;}),_0x432350[_0x8cbda2(0x2d8)]((_0x3483a4,_0x34db74)=>{var _0x58c526=_0x8cbda2;_0x580862[_0x34db74][_0x58c526(0x2d7)]=_0x3483a4;}),_0x1fe36e[_0x8cbda2(0x2d8)]((_0x2763a6,_0xb85cb5)=>{_0x580862[_0xb85cb5]['secondary_code']=_0x2763a6;}),_0x5c568b[_0x8cbda2(0x2d8)]((_0x253b80,_0x9877f5)=>{_0x580862[_0x9877f5]['product_code']=_0x253b80;}),_0x21516d[_0x8cbda2(0x2d8)]((_0x17c06e,_0x19a791)=>{var _0x505d8d=_0x8cbda2;_0x33d5ea[_0x505d8d(0x2d8)]((_0x581a42,_0x2eac04)=>{var _0x15bc80=_0x505d8d;if(_0x581a42=='Receiving\x20Area'&&_0x19a791==_0x2eac04){var _0x2f0d71=_0x17c06e[_0x15bc80(0x201)](0x3);_0x580862[_0x19a791][_0x15bc80(0x2ae)]=_0x17c06e[0x0],_0x580862[_0x19a791]['rack']=_0x17c06e[0x1],_0x580862[_0x19a791]['bay']=0x0,_0x580862[_0x19a791][_0x15bc80(0x236)]=0x0,_0x580862[_0x19a791][_0x15bc80(0x2c7)]=_0x15bc80(0x2dc),_0x580862[_0x19a791]['floorlevel']=_0x2f0d71;}else{if(_0x581a42==_0x15bc80(0x24a)&&_0x19a791==_0x2eac04){var _0x2f0d71=_0x17c06e['slice'](0x3);_0x580862[_0x19a791][_0x15bc80(0x2ae)]=_0x17c06e[0x0],_0x580862[_0x19a791][_0x15bc80(0x1f2)]=_0x17c06e[0x1],_0x580862[_0x19a791][_0x15bc80(0x26a)]=0x0,_0x580862[_0x19a791][_0x15bc80(0x236)]=0x0,_0x580862[_0x19a791][_0x15bc80(0x2c7)]=_0x15bc80(0x2dc),_0x580862[_0x19a791]['floorlevel']=_0x17c06e[0x5];}else{if(_0x19a791==_0x2eac04){var _0xe4d00e;if(_0x17c06e[0x4]=='L')_0xe4d00e=_0x15bc80(0x2a6);else _0x17c06e[0x4]=='F'&&(_0xe4d00e=_0x15bc80(0x2dc));_0x580862[_0x19a791][_0x15bc80(0x2ae)]=_0x17c06e[0x0],_0x580862[_0x19a791]['rack']=_0x17c06e[0x1],_0x580862[_0x19a791][_0x15bc80(0x26a)]=_0x17c06e[0x2],_0x580862[_0x19a791][_0x15bc80(0x236)]=_0x17c06e[0x3],_0x580862[_0x19a791]['type']=_0xe4d00e,_0x580862[_0x19a791][_0x15bc80(0x1e1)]=_0x17c06e[0x5];}}}});}),_0x597cf7[_0x8cbda2(0x2d8)]((_0x1bcf79,_0x686c5a)=>{var _0x40b00d=_0x8cbda2;_0x580862[_0x686c5a][_0x40b00d(0x23b)]=_0x1bcf79;}),_0x44461c['forEach']((_0x146c43,_0x40d3f1)=>{_0x580862[_0x40d3f1]['secondary_unit']=_0x146c43;}),_0xc047ce[_0x8cbda2(0x2d8)]((_0x1b559a,_0x5c0e69)=>{var _0x5b342b=_0x8cbda2;_0x580862[_0x5c0e69][_0x5b342b(0x242)]=_0x1b559a;}),_0x53c649[_0x8cbda2(0x2d8)]((_0x5bf613,_0x15aee8)=>{var _0x5416b1=_0x8cbda2;_0x580862[_0x15aee8][_0x5416b1(0x295)]=_0x5bf613;}),_0x100cbd[_0x8cbda2(0x2d8)]((_0x512841,_0x520f97)=>{var _0x37c6f0=_0x8cbda2;_0x580862[_0x520f97][_0x37c6f0(0x1fb)]=_0x512841;}),_0x2eb44c[_0x8cbda2(0x2d8)]((_0x1a98d9,_0xe6ccb1)=>{var _0x44bc03=_0x8cbda2;_0x580862[_0xe6ccb1][_0x44bc03(0x2c0)]=_0x1a98d9;}),_0x7f6c9b['forEach']((_0x25484e,_0x49ad4f)=>{var _0x1213b1=_0x8cbda2;_0x580862[_0x49ad4f][_0x1213b1(0x2d9)]=Math['abs'](_0x25484e);}),_0x59da9f[_0x8cbda2(0x2d8)]((_0x3d2d72,_0x33dc42)=>{var _0x5e2c7e=_0x8cbda2;_0x580862[_0x33dc42][_0x5e2c7e(0x240)]=_0x3d2d72;}),_0x5106a8[_0x8cbda2(0x2d8)]((_0x26f466,_0x10b3b0)=>{var _0x5befcd=_0x8cbda2;_0x580862[_0x10b3b0][_0x5befcd(0x213)]=_0x26f466;}),_0x79ddbd[_0x8cbda2(0x2d8)]((_0x8d2289,_0x27db6f)=>{var _0x20d703=_0x8cbda2;_0x580862[_0x27db6f][_0x20d703(0x1ea)]=_0x8d2289;}),_0x4baec4[_0x8cbda2(0x2d8)]((_0x45f7d3,_0x187941)=>{var _0x22d033=_0x8cbda2;_0x580862[_0x187941][_0x22d033(0x23f)]=_0x45f7d3;}),_0x33d5ea['forEach']((_0xa45f76,_0x5dc5a5)=>{var _0x47e9b5=_0x8cbda2;_0x580862[_0x5dc5a5][_0x47e9b5(0x2c8)]=_0xa45f76;});var _0x1a857b=0x0;_0x580862['forEach'](_0x2b6594=>{var _0x4e30af=_0x8cbda2;console[_0x4e30af(0x20e)]('foreach\x20newproduct',_0x2b6594),(parseInt(_0x2b6594[_0x4e30af(0x2d3)])<parseInt(_0x2b6594[_0x4e30af(0x2b1)])||parseInt(_0x2b6594[_0x4e30af(0x2b1)])==0x0)&&_0x1a857b++;});if(_0x1a857b!=0x0)return _0x2d5d7a[_0x8cbda2(0x261)](_0x8cbda2(0x246),_0x8cbda2(0x2a1)),_0x3759da['redirect']('back');const _0x27abef=_0x580862[_0x8cbda2(0x25b)](_0x8d77bc=>_0x8d77bc[_0x8cbda2(0x2b1)]!=='0'&&_0x8d77bc[_0x8cbda2(0x2b1)]!=='');_0x562f66['invoice']=_0x40e7f8,_0x562f66['customer']=_0x2ad082,_0x562f66[_0x8cbda2(0x273)]=_0xbc83fa,_0x562f66[_0x8cbda2(0x1f6)]=_0x290ccf,_0x562f66[_0x8cbda2(0x253)]=_0x27abef,_0x562f66[_0x8cbda2(0x2eb)]=_0x5e1b50,_0x562f66[_0x8cbda2(0x232)]=_0x1790b0,_0x562f66['finalize']=_0x8cbda2(0x23c),_0x562f66[_0x8cbda2(0x1ff)]=_0x8cbda2(0x23c);const _0x545f1a=await _0x562f66['save']();_0x2d5d7a[_0x8cbda2(0x261)](_0x8cbda2(0x269),_0x8cbda2(0x1e7)),_0x3759da['redirect'](_0x8cbda2(0x27b));}catch(_0x2eca8b){console['log'](_0x2eca8b);}}),router[a0_0x405637(0x202)](a0_0x405637(0x26e),auth,async(_0x2822bc,_0x33e3fe)=>{var _0x40d5bd=a0_0x405637;try{const _0x5041d7=_0x2822bc[_0x40d5bd(0x2cf)]['id'],{invoice:_0x62a8f0,customer:_0x2d6059,receivable_amount:_0x121e53,received_amount:_0xacee24}=_0x2822bc['body'],_0x310c76=await sales[_0x40d5bd(0x266)](_0x5041d7);console['log'](_0x310c76);var _0x3e8290=_0x121e53-_0xacee24;console[_0x40d5bd(0x20e)](_0xacee24),_0x310c76[_0x40d5bd(0x27f)]=parseFloat(_0xacee24)+parseFloat(_0x310c76[_0x40d5bd(0x27f)]),_0x310c76[_0x40d5bd(0x2da)]=_0x3e8290,console[_0x40d5bd(0x20e)](_0x310c76);const _0x31f1cb=await _0x310c76[_0x40d5bd(0x24e)](),_0x34e718=await c_payment_data[_0x40d5bd(0x2b7)]({'invoice':_0x62a8f0});_0x34e718[_0x40d5bd(0x26b)]=_0x3e8290,await _0x34e718[_0x40d5bd(0x24e)]();let _0x497868=new Date(),_0x2d6824=('0'+_0x497868[_0x40d5bd(0x207)]())['slice'](-0x2),_0x502172=('0'+(_0x497868['getMonth']()+0x1))[_0x40d5bd(0x201)](-0x2),_0x20cfae=_0x497868[_0x40d5bd(0x203)](),_0x356734=_0x20cfae+'-'+_0x502172+'-'+_0x2d6824;const _0x47a145=new customer_payment({'invoice':_0x62a8f0,'date':_0x20cfae+'-'+_0x502172+'-'+_0x2d6824,'customer':_0x2d6059,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0xacee24}),_0x27cab0=await _0x47a145[_0x40d5bd(0x24e)]();_0x2822bc['flash'](_0x40d5bd(0x269),_0x40d5bd(0x279)),_0x33e3fe['redirect']('/all_sales/view');}catch(_0x180b6c){console[_0x40d5bd(0x20e)](_0x180b6c);}}),router[a0_0x405637(0x2ec)](a0_0x405637(0x24d),auth,async(_0x127c30,_0x40ebee)=>{var _0x46f900=a0_0x405637;try{const {username:_0x4298b7,email:_0x231be9,role:_0x20bef4}=_0x127c30['user'],_0x24d093=_0x127c30['user'],_0x48dd69=await profile[_0x46f900(0x2b7)]({'email':_0x24d093[_0x46f900(0x2c3)]}),_0x2f589a=await master_shop[_0x46f900(0x2dd)]();console[_0x46f900(0x20e)](_0x46f900(0x278),_0x2f589a);const _0x4183a1=_0x127c30[_0x46f900(0x2cf)]['id'],_0x4ab458=await sales[_0x46f900(0x266)](_0x4183a1);console[_0x46f900(0x20e)](_0x4ab458);const _0x2e3130=await customer[_0x46f900(0x2b7)]({'name':_0x4ab458[_0x46f900(0x2bf)]});console[_0x46f900(0x20e)](_0x2e3130);if(_0x2f589a[0x0][_0x46f900(0x24f)]=='English\x20(US)'){var _0x2bb65e=users['English'];console['log'](_0x2bb65e);}else{if(_0x2f589a[0x0][_0x46f900(0x24f)]==_0x46f900(0x1fc))var _0x2bb65e=users['Hindi'];else{if(_0x2f589a[0x0][_0x46f900(0x24f)]==_0x46f900(0x23a))var _0x2bb65e=users['German'];else{if(_0x2f589a[0x0]['language']=='Spanish')var _0x2bb65e=users['Spanish'];else{if(_0x2f589a[0x0][_0x46f900(0x24f)]=='French')var _0x2bb65e=users[_0x46f900(0x249)];else{if(_0x2f589a[0x0]['language']==_0x46f900(0x1fa))var _0x2bb65e=users[_0x46f900(0x245)];else{if(_0x2f589a[0x0]['language']==_0x46f900(0x2d1))var _0x2bb65e=users[_0x46f900(0x2d1)];else{if(_0x2f589a[0x0]['language']=='Arabic\x20(ae)')var _0x2bb65e=users[_0x46f900(0x29f)];}}}}}}}_0x40ebee[_0x46f900(0x20d)](_0x46f900(0x262),{'success':_0x127c30[_0x46f900(0x261)]('success'),'errors':_0x127c30[_0x46f900(0x261)](_0x46f900(0x246)),'role':_0x24d093,'profile':_0x48dd69,'master_shop':_0x2f589a,'customers':_0x2e3130,'sales':_0x4ab458,'language':_0x2bb65e});}catch(_0x36fc41){console[_0x46f900(0x20e)](_0x36fc41);}}),router['get']('/view/return_sales/:id',auth,async(_0x1e068a,_0x403d5d)=>{var _0x2b39a9=a0_0x405637;try{const {username:_0x289d9e,email:_0xfda6d9,role:_0x114234}=_0x1e068a['user'],_0x2c2d64=_0x1e068a[_0x2b39a9(0x258)],_0x791e35=await profile[_0x2b39a9(0x2b7)]({'email':_0x2c2d64[_0x2b39a9(0x2c3)]}),_0x3a7a35=await master_shop['find']();console[_0x2b39a9(0x20e)](_0x2b39a9(0x278),_0x3a7a35);const _0x526ead=_0x1e068a[_0x2b39a9(0x2cf)]['id'];console[_0x2b39a9(0x20e)](_0x526ead);const _0x278daf=await sales['findById'](_0x526ead);console['log'](_0x2b39a9(0x2c1),_0x278daf);const _0x529a1d=await warehouse[_0x2b39a9(0x2a3)]([{'$match':{'name':_0x2b39a9(0x1dd),'room':'Return\x20Rooms'}},{'$unwind':_0x2b39a9(0x226)},{'$group':{'_id':_0x2b39a9(0x214),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2b39a9(0x2b3)},'level':{'$first':_0x2b39a9(0x2ed)},'isle':{'$first':_0x2b39a9(0x1e0)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x2b39a9(0x277)},'secondary_code':{'$first':_0x2b39a9(0x287)},'product_code':{'$first':_0x2b39a9(0x1ef)}}}]);console[_0x2b39a9(0x20e)](_0x2b39a9(0x230),_0x529a1d);const _0x203fa5=await product['find']({});warehouse_data=await warehouse[_0x2b39a9(0x2a3)]([{'$match':{'status':_0x2b39a9(0x28a),'name':_0x2b39a9(0x1dd),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2b39a9(0x217),'name':{'$first':_0x2b39a9(0x217)}}},{'$sort':{'name':0x1}}]);var _0x2b220a=[_0x2b39a9(0x247)];if(_0x3a7a35[0x0][_0x2b39a9(0x24f)]==_0x2b39a9(0x2b9)){var _0x530cc2=users[_0x2b39a9(0x29d)];console[_0x2b39a9(0x20e)](_0x530cc2);}else{if(_0x3a7a35[0x0]['language']==_0x2b39a9(0x1fc))var _0x530cc2=users[_0x2b39a9(0x1fc)];else{if(_0x3a7a35[0x0][_0x2b39a9(0x24f)]==_0x2b39a9(0x23a))var _0x530cc2=users[_0x2b39a9(0x23a)];else{if(_0x3a7a35[0x0][_0x2b39a9(0x24f)]==_0x2b39a9(0x26f))var _0x530cc2=users[_0x2b39a9(0x26f)];else{if(_0x3a7a35[0x0][_0x2b39a9(0x24f)]==_0x2b39a9(0x249))var _0x530cc2=users[_0x2b39a9(0x249)];else{if(_0x3a7a35[0x0][_0x2b39a9(0x24f)]=='Portuguese\x20(BR)')var _0x530cc2=users[_0x2b39a9(0x245)];else{if(_0x3a7a35[0x0]['language']==_0x2b39a9(0x2d1))var _0x530cc2=users[_0x2b39a9(0x2d1)];else{if(_0x3a7a35[0x0][_0x2b39a9(0x24f)]=='Arabic\x20(ae)')var _0x530cc2=users[_0x2b39a9(0x29f)];}}}}}}}_0x403d5d['render']('return_sale',{'success':_0x1e068a['flash'](_0x2b39a9(0x269)),'errors':_0x1e068a['flash']('errors'),'role':_0x2c2d64,'profile':_0x791e35,'user':_0x278daf,'stock':_0x529a1d,'master_shop':_0x3a7a35,'unit':_0x203fa5,'language':_0x530cc2,'warehouses':warehouse_data,'rooms':_0x2b220a});}catch(_0x4898c5){console[_0x2b39a9(0x20e)](_0x4898c5),_0x403d5d['status'](0xc8)[_0x2b39a9(0x241)]({'message':_0x4898c5[_0x2b39a9(0x25c)]});}}),router[a0_0x405637(0x202)](a0_0x405637(0x1eb),auth,async(_0x2004e5,_0xc3f04e)=>{var _0x3b7368=a0_0x405637;try{const {invoice:_0x5f0b84,date:_0x53aa53,warehouse_name:_0x4c0ed1,product_name:_0xc0e500,primary_code:_0x1c9b81,secondary_code:_0x313a3f,product_code:_0x4181fc,sales_quantity:_0x2e86a5,stocks:_0x1ae92e,return_qty:_0x285eaf,Room_name:_0x17726f,to_warehouse_name:_0x42015f,to_Roomname:_0x1e2d55,to_Room_name:_0x4edefc,note:_0x29fda4,level:_0x2d7b8d,isle:_0x33bb05,pallet:_0x5a810a}=_0x2004e5[_0x3b7368(0x2cc)];if(typeof _0xc0e500=='string')var _0x5eea1e=[_0x2004e5[_0x3b7368(0x2cc)]['product_name']],_0x3f2a14=[_0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x2d7)]],_0x3830b4=[_0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x218)]],_0x14988a=[_0x2004e5[_0x3b7368(0x2cc)]['product_code']],_0x27974b=[_0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x27c)]],_0x1e2a4d=[_0x2004e5['body']['stocks']],_0x56d31a=[_0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x224)]],_0x1c61d2=[_0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x26a)]],_0x5b4ac4=[_0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x236)]],_0x6bd09d=[_0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x286)]],_0x59d1e8=[_0x2004e5['body'][_0x3b7368(0x1e1)]];else var _0x5eea1e=[..._0x2004e5['body'][_0x3b7368(0x2be)]],_0x3f2a14=[..._0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x2d7)]],_0x3830b4=[..._0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x218)]],_0x14988a=[..._0x2004e5[_0x3b7368(0x2cc)]['product_code']],_0x27974b=[..._0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x27c)]],_0x1e2a4d=[..._0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x2a0)]],_0x56d31a=[..._0x2004e5['body'][_0x3b7368(0x224)]],_0x1c61d2=[..._0x2004e5['body'][_0x3b7368(0x26a)]],_0x5b4ac4=[..._0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x236)]],_0x6bd09d=[..._0x2004e5['body'][_0x3b7368(0x286)]],_0x59d1e8=[..._0x2004e5[_0x3b7368(0x2cc)]['floorlevel']];const _0x4a390f=_0x5eea1e[_0x3b7368(0x26c)](_0x2dba0d=>{return _0x2dba0d={'product_name':_0x2dba0d};});_0x3f2a14['forEach']((_0x3a3110,_0x3fc653)=>{_0x4a390f[_0x3fc653]['primary_code']=_0x3a3110;}),_0x3830b4[_0x3b7368(0x2d8)]((_0xa12538,_0x4c63f8)=>{var _0x3b69c9=_0x3b7368;_0x4a390f[_0x4c63f8][_0x3b69c9(0x218)]=_0xa12538;}),_0x14988a[_0x3b7368(0x2d8)]((_0x40b437,_0x373a41)=>{_0x4a390f[_0x373a41]['product_code']=_0x40b437;}),_0x27974b[_0x3b7368(0x2d8)]((_0xd177c9,_0x1349b8)=>{var _0x4d7e6d=_0x3b7368;_0x4a390f[_0x1349b8][_0x4d7e6d(0x222)]=_0xd177c9;}),_0x1e2a4d[_0x3b7368(0x2d8)]((_0x814a9e,_0x2cef76)=>{var _0x52ce76=_0x3b7368;_0x4a390f[_0x2cef76][_0x52ce76(0x2d3)]=_0x814a9e;}),_0x56d31a['forEach']((_0x106e01,_0x5c9f7f)=>{_0x4a390f[_0x5c9f7f]['return_qty']=_0x106e01;}),_0x1c61d2[_0x3b7368(0x2d8)]((_0x3214df,_0x33853f)=>{var _0x469d33=_0x3b7368;_0x4a390f[_0x33853f][_0x469d33(0x26a)]=_0x3214df;}),_0x5b4ac4[_0x3b7368(0x2d8)]((_0x378b39,_0x2517cf)=>{_0x4a390f[_0x2517cf]['bin']=_0x378b39;}),_0x6bd09d[_0x3b7368(0x2d8)]((_0x9ed9a5,_0x17766b)=>{var _0x155c6a=_0x3b7368;_0x4a390f[_0x17766b][_0x155c6a(0x2c7)]=_0x9ed9a5;}),_0x59d1e8[_0x3b7368(0x2d8)]((_0x25ae47,_0x599fff)=>{var _0x210ca5=_0x3b7368;_0x4a390f[_0x599fff][_0x210ca5(0x1e1)]=_0x25ae47;});var _0x4219a6=0x0;_0x4a390f[_0x3b7368(0x2d8)](_0x3626c5=>{var _0x4bd92d=_0x3b7368;console[_0x4bd92d(0x20e)](_0x4bd92d(0x275),_0x3626c5),(parseInt(_0x3626c5[_0x4bd92d(0x222)])<parseInt(_0x3626c5['return_qty'])||parseInt(_0x3626c5[_0x4bd92d(0x2d3)])<parseInt(_0x3626c5['return_qty'])&&parseInt(_0x3626c5[_0x4bd92d(0x222)])>parseInt(_0x3626c5[_0x4bd92d(0x224)])||parseInt(_0x3626c5['return_qty'])==0x0)&&_0x4219a6++;});if(_0x4219a6!=0x0)return _0x2004e5[_0x3b7368(0x261)](_0x3b7368(0x246),_0x3b7368(0x1f1)),_0xc3f04e[_0x3b7368(0x2bc)](_0x3b7368(0x272));const _0x2c735d=await sales[_0x3b7368(0x2b7)]({'invoice':_0x5f0b84});console['log'](_0x2c735d),_0x2c735d[_0x3b7368(0x1ec)]=_0x3b7368(0x288);const _0x33d7e8=await _0x2c735d[_0x3b7368(0x24e)](),_0x4ad162=new sales_return({'invoice':_0x5f0b84,'customer':_0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x2bf)],'date':_0x53aa53,'warehouse_name':_0x4c0ed1,'room':_0x17726f,'ToWarehouse':_0x42015f,'ToRoom':_0x4edefc,'return_sale':_0x4a390f,'note':_0x29fda4}),_0x373e62=await _0x4ad162[_0x3b7368(0x24e)]();console[_0x3b7368(0x20e)](_0x4ad162);const _0x5d0953=await sales_return['findOne']({'invoice':_0x5f0b84}),_0x302f86=await warehouse[_0x3b7368(0x2b7)]({'name':_0x42015f,'room':_0x4edefc});_0x5d0953[_0x3b7368(0x229)]['forEach'](_0x1357af=>{var _0x13b767=_0x3b7368,_0x2d2e16=0x0;const _0x5967a6=_0x302f86[_0x13b767(0x284)][_0x13b767(0x26c)](_0x2da061=>{var _0x41476e=_0x13b767;_0x2da061['product_name']==_0x1357af[_0x41476e(0x2be)]&&_0x2da061['floorlevel']==_0x1357af[_0x41476e(0x1e1)]&&_0x2da061[_0x41476e(0x2c7)]==_0x1357af[_0x41476e(0x2c7)]&&_0x2da061[_0x41476e(0x236)]==_0x1357af[_0x41476e(0x236)]&&_0x2da061[_0x41476e(0x26a)]==_0x1357af[_0x41476e(0x26a)]&&(_0x2da061[_0x41476e(0x2ad)]=parseInt(_0x2da061[_0x41476e(0x2ad)])+parseInt(_0x1357af[_0x41476e(0x224)]),_0x2d2e16++);});_0x2d2e16=='0'&&(_0x302f86[_0x13b767(0x284)]=_0x302f86[_0x13b767(0x284)][_0x13b767(0x227)]({'product_name':_0x1357af[_0x13b767(0x2be)],'product_stock':_0x1357af[_0x13b767(0x224)],'primary_code':_0x1357af[_0x13b767(0x2d7)],'secondary_code':_0x1357af[_0x13b767(0x218)],'product_code':_0x1357af[_0x13b767(0x289)],'bay':_0x1357af[_0x13b767(0x26a)],'bin':_0x1357af[_0x13b767(0x236)],'type':_0x1357af['type'],'floorlevel':_0x1357af[_0x13b767(0x1e1)]})),console[_0x13b767(0x20e)](_0x13b767(0x283),_0x302f86);}),await _0x302f86['save'](),console[_0x3b7368(0x20e)](_0x2004e5['body']);const _0x1472a5=new c_payment_data({'invoice':_0x5f0b84,'customer':_0x2004e5[_0x3b7368(0x2cc)][_0x3b7368(0x2bf)],'reason':_0x3b7368(0x2c2)});await _0x1472a5['save']();const _0x52686c=await master_shop['find']();console['log'](_0x3b7368(0x210),_0x52686c[0x0][_0x3b7368(0x298)]);const _0x48eab0=await email_settings[_0x3b7368(0x2b7)](),_0x46d828=await customer[_0x3b7368(0x2b7)]({'name':_0x2004e5[_0x3b7368(0x2cc)]['customer']});console[_0x3b7368(0x20e)](_0x3b7368(0x225),_0x46d828);_0x52686c[0x0][_0x3b7368(0x2d2)]==0x1?(right_currency=_0x52686c[0x0][_0x3b7368(0x1f5)],left_currency=''):(right_currency='',left_currency=_0x52686c[0x0][_0x3b7368(0x1f5)]);var _0x2a5357=_0x5eea1e,_0x4dd9a1=_0x56d31a,_0x1ddac0='',_0x5df43c;for(_0x5df43c in _0x2a5357){_0x1ddac0+=_0x3b7368(0x2db)+_0x3b7368(0x2a4)+_0x2a5357[_0x5df43c]+_0x3b7368(0x21a)+_0x3b7368(0x2a4)+_0x4dd9a1[_0x5df43c]+_0x3b7368(0x21a)+_0x3b7368(0x291);}console[_0x3b7368(0x20e)](_0x3b7368(0x26d),_0x1ddac0);let _0x1f9733=nodemailer[_0x3b7368(0x2b2)]({'service':_0x3b7368(0x23e),'auth':{'user':_0x48eab0[_0x3b7368(0x2c3)],'pass':_0x48eab0['password']}}),_0x2b2216={'from':_0x48eab0[_0x3b7368(0x2c3)],'to':_0x46d828[_0x3b7368(0x2c3)],'subject':_0x3b7368(0x1dc),'attachments':[{'filename':_0x3b7368(0x1e8),'path':__dirname+_0x3b7368(0x22f)+_0x3b7368(0x209)+_0x52686c[0x0][_0x3b7368(0x298)],'cid':_0x3b7368(0x1df)}],'html':_0x3b7368(0x208)+_0x3b7368(0x221)+_0x3b7368(0x205)+_0x3b7368(0x25d)+_0x3b7368(0x2ea)+_0x3b7368(0x25d)+_0x3b7368(0x2ef)+_0x3b7368(0x2e5)+_0x3b7368(0x25d)+_0x3b7368(0x28f)+_0x52686c[0x0]['site_title']+_0x3b7368(0x2cd)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x3b7368(0x25d)+_0x3b7368(0x22a)+_0x3b7368(0x285)+_0x5f0b84+'\x20'+_0x3b7368(0x211)+_0x3b7368(0x2b4)+_0x53aa53+'\x20'+_0x3b7368(0x204)+_0x3b7368(0x2e2)+_0x3b7368(0x2e5)+_0x3b7368(0x28b)+_0x3b7368(0x2c6)+_0x3b7368(0x2db)+_0x3b7368(0x1e2)+_0x3b7368(0x282)+_0x3b7368(0x1fe)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x3b7368(0x291)+_0x3b7368(0x268)+_0x3b7368(0x219)+'\x20'+_0x1ddac0+'\x20'+_0x3b7368(0x1f3)+_0x3b7368(0x293)+'<div>'+_0x3b7368(0x25a)+_0x3b7368(0x2c9)+_0x52686c[0x0][_0x3b7368(0x2de)]+'</h5>'+_0x3b7368(0x2e5)+_0x3b7368(0x2e5)+_0x3b7368(0x28d)};_0x1f9733['sendMail'](_0x2b2216,function(_0x280d1f,_0x381388){var _0x4b6b05=_0x3b7368;_0x280d1f?(console[_0x4b6b05(0x20e)](_0x280d1f),console[_0x4b6b05(0x20e)]('Error\x20Occurs')):console[_0x4b6b05(0x20e)]('Email\x20sent\x20successfully');}),_0x2004e5[_0x3b7368(0x261)](_0x3b7368(0x269),_0x3b7368(0x271)),_0xc3f04e[_0x3b7368(0x2bc)](_0x3b7368(0x27b));}catch(_0x3d45db){console[_0x3b7368(0x20e)](_0x3d45db),_0xc3f04e[_0x3b7368(0x200)](0xc8)[_0x3b7368(0x241)]({'message1':_0x3d45db[_0x3b7368(0x25c)]});}}),router['get'](a0_0x405637(0x2cb),auth,async(_0x291d64,_0x28edf5)=>{var _0x3b7ed3=a0_0x405637;try{const {username:_0x542979,email:_0x156c0e,role:_0x4f5031}=_0x291d64[_0x3b7ed3(0x258)],_0x5573c2=_0x291d64[_0x3b7ed3(0x258)],_0x39bdeb=await profile['findOne']({'email':_0x5573c2['email']}),_0x36a169=await master_shop[_0x3b7ed3(0x2dd)]();console['log'](_0x3b7ed3(0x2e9),_0x36a169);const _0x1ec003=_0x291d64[_0x3b7ed3(0x2cf)]['id'],_0x4c9010=await sales[_0x3b7ed3(0x266)](_0x1ec003);console[_0x3b7ed3(0x20e)](_0x3b7ed3(0x22d),_0x4c9010);if(_0x36a169[0x0][_0x3b7ed3(0x24f)]=='English\x20(US)')var _0x9fbb6c=users[_0x3b7ed3(0x29d)];else{if(_0x36a169[0x0][_0x3b7ed3(0x24f)]==_0x3b7ed3(0x1fc))var _0x9fbb6c=users[_0x3b7ed3(0x1fc)];else{if(_0x36a169[0x0][_0x3b7ed3(0x24f)]=='German')var _0x9fbb6c=users[_0x3b7ed3(0x23a)];else{if(_0x36a169[0x0][_0x3b7ed3(0x24f)]=='Spanish')var _0x9fbb6c=users['Spanish'];else{if(_0x36a169[0x0][_0x3b7ed3(0x24f)]==_0x3b7ed3(0x249))var _0x9fbb6c=users['French'];else{if(_0x36a169[0x0][_0x3b7ed3(0x24f)]==_0x3b7ed3(0x1fa))var _0x9fbb6c=users[_0x3b7ed3(0x245)];else{if(_0x36a169[0x0]['language']==_0x3b7ed3(0x2d1))var _0x9fbb6c=users[_0x3b7ed3(0x2d1)];else{if(_0x36a169[0x0][_0x3b7ed3(0x24f)]==_0x3b7ed3(0x2bb))var _0x9fbb6c=users['Arabic'];}}}}}}}_0x28edf5[_0x3b7ed3(0x20d)]('all_sales_barcode',{'success':_0x291d64[_0x3b7ed3(0x261)](_0x3b7ed3(0x269)),'errors':_0x291d64[_0x3b7ed3(0x261)](_0x3b7ed3(0x246)),'role':_0x5573c2,'profile':_0x39bdeb,'alldata':_0x4c9010,'master_shop':_0x36a169,'language':_0x9fbb6c});}catch(_0x137c1d){console[_0x3b7ed3(0x20e)](_0x137c1d);}}),router[a0_0x405637(0x202)]('/barcode_scanner',async(_0x4f1b8e,_0x47186d)=>{var _0x1d9537=a0_0x405637;const {product_code:_0xc883b0,warehouse_name:_0x42df06,rooms_data:_0x505376,Roomslist:_0x1bb80d}=_0x4f1b8e[_0x1d9537(0x2cc)],_0x2198ca=_0x1bb80d['split'](','),_0x4732bd=[];async function _0x17934b(_0x28471d){var _0x22534a=_0x1d9537;const _0x72c04b=await warehouse[_0x22534a(0x2a3)]([{'$match':{'name':_0x42df06,'room':_0x28471d}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0xc883b0}},{'$group':{'_id':_0x22534a(0x214),'name':{'$first':_0x22534a(0x29e)},'product_stock':{'$first':_0x22534a(0x2b3)},'primary_code':{'$first':_0x22534a(0x277)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x22534a(0x1ef)},'level':{'$first':_0x22534a(0x2e3)},'isle':{'$first':_0x22534a(0x2ba)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x22534a(0x22c)},'unit':{'$first':_0x22534a(0x20f)},'secondary_unit':{'$first':_0x22534a(0x1ee)},'storage':{'$first':_0x22534a(0x29c)},'rack':{'$first':_0x22534a(0x28e)},'expiry_date':{'$first':_0x22534a(0x297)},'production_date':{'$first':_0x22534a(0x2e0)},'maxPerUnit':{'$first':_0x22534a(0x2ee)},'batch_code':{'$first':_0x22534a(0x1f0)},'product_cat':{'$first':_0x22534a(0x2e7)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x22534a(0x23d)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x22534a(0x24b)}}}]),_0x2d9341=await warehouse['aggregate']([{'$match':{'name':_0x42df06,'room':_0x28471d}},{'$unwind':_0x22534a(0x226)},{'$match':{'product_details.secondary_code':_0xc883b0}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x22534a(0x2b3)},'primary_code':{'$first':_0x22534a(0x277)},'secondary_code':{'$first':_0x22534a(0x287)},'product_code':{'$first':_0x22534a(0x1ef)},'level':{'$first':_0x22534a(0x2e3)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x22534a(0x2b8)},'pallet':{'$first':_0x22534a(0x22c)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x22534a(0x1ee)},'storage':{'$first':_0x22534a(0x29c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x22534a(0x297)},'production_date':{'$first':_0x22534a(0x2e0)},'maxPerUnit':{'$first':_0x22534a(0x2ee)},'batch_code':{'$first':_0x22534a(0x1f0)},'product_cat':{'$first':_0x22534a(0x2e7)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x22534a(0x255)},'invoice':{'$first':_0x22534a(0x23d)}}}]);if(_0x72c04b[_0x22534a(0x1f8)]>0x0)_0x4732bd[_0x22534a(0x264)](_0x72c04b);else _0x2d9341[_0x22534a(0x1f8)]>0x0&&_0x4732bd[_0x22534a(0x264)](_0x2d9341);}const _0x553a7c=_0x2198ca[_0x1d9537(0x26c)](_0x593d92=>_0x17934b(_0x593d92));await Promise[_0x1d9537(0x2aa)](_0x553a7c),_0x47186d['json'](_0x4732bd);}),module['exports']=router;function a0_0x549e(){var _0x9da1e=['$product_details._id','then','$customer','$name','secondary_code','<tbody\x20style=\x22text-align:\x20center;\x22>','</td>','OUT-','/view','$return_data','max_per_unit','add_sales','staff','<html><head><title></title>','sale_qty','finalize','return_qty','customer_data','$product_details','concat','floor','return_sale','<h5\x20style=\x22text-align:\x20left;\x22>','random','$product_details.floorlevel','barcode\x20user_id','purchases_data','/../public','stock_data','$note','SCRN','An\x20error\x20occurred\x20while\x20saving\x20data.','edit_sales_view','2595564QhMpAe','bin','role','RoomAssigned','string','German','unit','False','$product_details.invoice','gmail','quantity_notConverted','delivery_date','json','batch_code','$date','$sale_product.floorlevel','Portuguese','errors','Return\x20Rooms','$sale_product.bin','French','Shelves','$product_details.actual_uom','$invoice','/invoice/:id','save','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','warehouse','catch','sale_product','padStart','$room','all_sales','<hr\x20class=\x22my-3\x22>','user','name','<strong>\x20Regards\x20</strong>','filter','message','<div>','level','../middleware/auth','error','flash','sales_invoice','room','push','$customers_docs','findById','$isAllowEdit','</thead>','success','bay','amount','map','product_list','/give_payment/:id','Spanish','$finalize','sales\x20item\x20return\x20successfull','back','date','_id','foreach\x20newproduct','Enclosed','$product_details.primary_code','master','payment\x20successfull','product_data','/all_sales/view','sales_quantity','Email\x20sent\x20successfully','There\x27s\x20a\x20error\x20in\x20this\x20transaction','received_amount','6ioRBoo','abs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','final','product_details','\x20Order\x20Number\x20:\x20','types','$product_details.secondary_code','True','product_code','Enabled','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Receiving\x20Area','</body></html>','$product_details.rack','<h2>\x20','primary_unit','</tr>','prod_invoice','</table>','carton','expiry_date','../models/all_models','$product_details.expiry_date','image','$product','10jmpUFJ','host','$product_details.storage','English','$product_details.product_name','Arabic','stocks','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Sales\x20Mail','aggregate','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Level','nodemailer','port','3764030laQFwq','all','../public/language/languages.json','/view/add_sales','product_stock','storage','sales\x20all_data','2030987KYQxbq','quantity','createTransport','$product_details.product_stock','\x20Order\x20Date\x20:\x20','prod_code','/all_sales/preview/','findOne','$product_details.type','English\x20(US)','$product_details.bin','Arabic\x20(ae)','redirect','$sale_product','product_name','customer','production_date','user_id','Sale\x20Return','email','$sale_product.type','18iSrxEn','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','type','room_name','<h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/barcode/:id','body','\x20</h2>','customers','params','/view/:id','Chinese','currency_placement','stock','edit_sales','invoice','$_id','primary_code','forEach','requested_qty','due_amount','<tr>','Floor','find','site_title','$sale_product.quantity','$product_details.production_date','Error\x20Occurs','</h5>','$product_details.bay','/view/add_sale/product','</div>','password','$product_details.product_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','barcode\x20Product\x20master','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','note','get','$product_details.level','$product_details.maxPerUnit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/preview/:id','Sale\x20Return\x20Mail','Return\x20Goods','4823200JgGfvd','logo','$product_details.isle','floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','actual_qty','$warehouse_name','223629mEwFJX','Raw\x20Materials','Sales\x20Update\x20successfully','Logo.png','923302pvkueV','prod_cat','/view/return_sales/:id','return_data','An\x20error\x20occurred.','$product_details.secondary_unit','$product_details.product_code','$product_details.batch_code','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','rack','</tbody>','customers_docs','currency','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','length','secondary_unit','Portuguese\x20(BR)','maxperunit','Hindi','4856240TTJHDt','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','isAllowEdit','status','slice','post','getFullYear','</span>','</head><body>','actual_uom','getDate','<!DOCTYPE\x20html>','/upload/','$sale_product.bay','Ambient','/view/add_sales/:id','render','log','$product_details.unit','add\x20post','<span\x20style=\x22float:\x20right;\x22>','express','delivery_code'];a0_0x549e=function(){return _0x9da1e;};return a0_0x549e();}