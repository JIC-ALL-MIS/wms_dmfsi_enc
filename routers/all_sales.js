var a0_0x539370=a0_0x4395;function a0_0x922a(){var _0x325b07=['Hindi','stock','edit_sales','sales\x20item\x20return\x20successfull','/view/add_sales','$product_details.secondary_unit','/view/:id','Chinese','Portuguese\x20(BR)','purchases_data','../models/all_models','room_name','id_transact','$product_details','../middleware/auth','errors','max_per_unit','message','secondary_code','quantity','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$sale_product.bin','</td>','$product_details.product_cat','aggregate','stocks','</h5>','<!DOCTYPE\x20html>','Portuguese','_id','8crSJhm','currency','body','/../public','date','</tbody>','role','get','<div>','$product_details.bay','Error\x20Occurs','primary_unit','$customers_docs','prod_code','redirect','secondary_unit','\x20Order\x20Date\x20:\x20','carton','maxperunit','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/preview/:id','getMonth','customer','<h5\x20style=\x22text-align:\x20left;\x22>','image','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$product_details.unit','sendMail','forEach','$invoice','<table\x20style=\x22width:\x20100%\x20!important;\x22>','bin','push','$product','save','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<tr>','getDate','due_amount','$product_details.actual_qty','post','currency_placement','$product_details.floorlevel','Raw\x20Materials','split','length','bay','285334jhoUki','invoice','slice','toString','warehouse_name','host','</body></html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_invoice','requested_qty','max','/barcode_scanner','10507910fEMkqj','171rmgXec','Email\x20sent\x20successfully','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_code','catch','$sale_product.type','1nLeKKU','/all_sales/view','</tr>','/all_sales/preview/','$note','</span>','padStart','True','expiry_date','$room','storage','<tbody\x20style=\x22text-align:\x20center;\x22>','English\x20(US)','<html><head><title></title>','$product_details.bin','RoomAssigned','finalize','$product_details._id','/view/return_sales/:id','log','$_id','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','floorlevel','language','customer_data','/invoice/:id','$product_details.actual_uom','Router','12NAQEEg','/upload/','$sale_product.bay','Return\x20Rooms','</thead>','abs','customers_docs','False','</div>','return_data','/give_payment/:id','received_amount','error','/view','Sale\x20Return\x20Mail','final','all_sales','quantity_notConverted','name','exports','email','actual_uom','foreach\x20newproduct','$warehouse_name','actual_qty','stock_data','$product_details.storage','Spanish','rack','$sale_product.quantity','all','find','<hr\x20class=\x22my-3\x22>','filter','$product_details.product_name','level','gmail','$name','express','1583115xVvONl','$date','back','product_name','payment\x20successfull','add_sales','production_date','product_details','$product_details.type','sale_qty','$product_details.batch_code','$product_details.expiry_date','delivery_date','$product_details.product_stock','sales_invoice','Sales\x20Update\x20successfully','prod_cat','</table>','port','English','$finalize','</head><body>','<span\x20style=\x22float:\x20right;\x22>','$product_details.pallet','$product_details.rack','status','then','Receiving\x20Area','Logo.png','$sale_product','staff','French','isAllowEdit','return_sale','sale_product','Level','$product_details.primary_code','createTransport','Shelves','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','string','German','return_qty','Floor','<h2>\x20','../public/language/languages.json','An\x20error\x20occurred\x20while\x20saving\x20data.','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$isAllowEdit','9361935aYtdQQ','getFullYear','<strong>\x20Regards\x20</strong>','type','id_transaction_from','product_code','OUT-','1336306BxeUup','$product_details.invoice','customers','unit','site_title','map','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','json','/barcode/:id','product_data','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','logo','render','batch_code','primary_code','$product_details.maxPerUnit','RMSEmail','delivery_code','Return\x20Goods','\x20Order\x20Number\x20:\x20','concat','Ambient','3864VkWnPO','types','$product_details.isle','<h5>','floor','add\x20post','warehouse','findOne','/view/add_sales/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','sales\x20all_data','Enabled','Arabic\x20(ae)','master','18556ttyoJT','findById','Sales\x20Mail','$product_details.production_date','SCRN','barcode\x20user_id','Sale\x20Return','user','$sale_product.floorlevel','params','flash','82995yFeyhY','$customer'];a0_0x922a=function(){return _0x325b07;};return a0_0x922a();}(function(_0x147d9e,_0xb8ccf6){var _0x325164=a0_0x4395,_0x581f66=_0x147d9e();while(!![]){try{var _0x24c4b0=parseInt(_0x325164(0x178))/0x1*(-parseInt(_0x325164(0x1f4))/0x2)+parseInt(_0x325164(0x172))/0x3*(parseInt(_0x325164(0x219))/0x4)+parseInt(_0x325164(0x1bb))/0x5*(parseInt(_0x325164(0x194))/0x6)+-parseInt(_0x325164(0x277))/0x7*(parseInt(_0x325164(0x246))/0x8)+-parseInt(_0x325164(0x1ed))/0x9+-parseInt(_0x325164(0x171))/0xa+-parseInt(_0x325164(0x224))/0xb*(-parseInt(_0x325164(0x20b))/0xc);if(_0x24c4b0===_0xb8ccf6)break;else _0x581f66['push'](_0x581f66['shift']());}catch(_0x4a7f56){_0x581f66['push'](_0x581f66['shift']());}}}(a0_0x922a,0x80b86));function a0_0x4395(_0x222b70,_0x5576db){var _0x922af4=a0_0x922a();return a0_0x4395=function(_0x4395ad,_0x8305fc){_0x4395ad=_0x4395ad-0x167;var _0x440fe9=_0x922af4[_0x4395ad];return _0x440fe9;},a0_0x4395(_0x222b70,_0x5576db);}const express=require(a0_0x539370(0x1ba)),app=express(),router=express[a0_0x539370(0x193)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x539370(0x230)),auth=require(a0_0x539370(0x234)),nodemailer=require('nodemailer'),users=require(a0_0x539370(0x1e8));router[a0_0x539370(0x24d)](a0_0x539370(0x1a1),auth,async(_0x2ad937,_0xbac35b)=>{var _0x5737bb=a0_0x539370;try{const {username:_0x2b2fbd,email:_0x1c9540,role:_0x33c285}=_0x2ad937[_0x5737bb(0x220)],_0x8e25e2=_0x2ad937[_0x5737bb(0x220)],_0x578407=await profile[_0x5737bb(0x212)]({'email':_0x8e25e2[_0x5737bb(0x1a8)]}),_0x4031e1=await master_shop[_0x5737bb(0x1b3)]();let _0x27a6f6;if(_0x8e25e2[_0x5737bb(0x24c)]=='staff'){const _0x3b4529=await staff['findOne']({'email':_0x8e25e2[_0x5737bb(0x1a8)]});_0x27a6f6=await sales['aggregate']([{'$lookup':{'from':_0x5737bb(0x1f6),'localField':'customer','foreignField':'name','as':_0x5737bb(0x19a)}},{'$unwind':'$customers_docs'},{'$unwind':_0x5737bb(0x1d8)},{'$group':{'_id':_0x5737bb(0x18c),'invoice':{'$first':_0x5737bb(0x264)},'customers':{'$first':_0x5737bb(0x225)},'date':{'$first':_0x5737bb(0x1bc)},'warehouse_name':{'$first':_0x5737bb(0x1ab)},'sale_product':{'$push':_0x5737bb(0x1d8)},'note':{'$first':_0x5737bb(0x17c)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x5737bb(0x252)},'total_saleproduct_quantity':{'$sum':_0x5737bb(0x1b1)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x5737bb(0x177)},'pallet':{'$addToSet':_0x5737bb(0x221)},'finalize':{'$first':_0x5737bb(0x1cf)},'isAllowEdit':{'$first':_0x5737bb(0x1ec)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x27a6f6=await sales['aggregate']([{'$lookup':{'from':_0x5737bb(0x1f6),'localField':_0x5737bb(0x25c),'foreignField':_0x5737bb(0x1a6),'as':_0x5737bb(0x19a)}},{'$unwind':'$customers_docs'},{'$unwind':_0x5737bb(0x1d8)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5737bb(0x264)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5737bb(0x1ab)},'sale_product':{'$push':_0x5737bb(0x1d8)},'note':{'$first':_0x5737bb(0x17c)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x5737bb(0x252)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x5737bb(0x196)},'isle':{'$addToSet':_0x5737bb(0x23d)},'type':{'$addToSet':_0x5737bb(0x177)},'pallet':{'$addToSet':_0x5737bb(0x221)},'finalize':{'$first':_0x5737bb(0x1cf)},'isAllowEdit':{'$first':_0x5737bb(0x1ec)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5737bb(0x18b)](_0x5737bb(0x215),_0x27a6f6);if(_0x4031e1[0x0]['language']=='English\x20(US)'){var _0x26f2f4=users[_0x5737bb(0x1ce)];console['log'](_0x26f2f4);}else{if(_0x4031e1[0x0][_0x5737bb(0x18f)]=='Hindi')var _0x26f2f4=users[_0x5737bb(0x226)];else{if(_0x4031e1[0x0]['language']==_0x5737bb(0x1e4))var _0x26f2f4=users['German'];else{if(_0x4031e1[0x0][_0x5737bb(0x18f)]==_0x5737bb(0x1af))var _0x26f2f4=users['Spanish'];else{if(_0x4031e1[0x0][_0x5737bb(0x18f)]==_0x5737bb(0x1da))var _0x26f2f4=users['French'];else{if(_0x4031e1[0x0][_0x5737bb(0x18f)]==_0x5737bb(0x22e))var _0x26f2f4=users[_0x5737bb(0x244)];else{if(_0x4031e1[0x0][_0x5737bb(0x18f)]=='Chinese')var _0x26f2f4=users[_0x5737bb(0x22d)];else{if(_0x4031e1[0x0][_0x5737bb(0x18f)]==_0x5737bb(0x217))var _0x26f2f4=users[_0x5737bb(0x1ea)];}}}}}}}_0xbac35b['render'](_0x5737bb(0x1a4),{'success':_0x2ad937[_0x5737bb(0x223)](_0x5737bb(0x26a)),'errors':_0x2ad937['flash'](_0x5737bb(0x235)),'sales':_0x27a6f6,'profile':_0x578407,'role':_0x8e25e2,'master_shop':_0x4031e1,'language':_0x26f2f4});}catch(_0x4966d7){console['log'](_0x4966d7);}});async function getRandom8DigitNumber(){var _0x408f81=a0_0x539370;const _0x5291ad=0x989680,_0x39e6dc=0x5f5e0ff,_0xf67cb=Math[_0x408f81(0x20f)](Math['random']()*(_0x39e6dc-_0x5291ad+0x1))+_0x5291ad;var _0x5c27ab;const _0x89fa3c=await sales[_0x408f81(0x212)]({'invoice':'OUT-'+_0xf67cb});return _0x89fa3c&&_0x89fa3c[_0x408f81(0x275)]>0x0?_0x5c27ab=_0x408f81(0x1f3)+_0xf67cb:_0x5c27ab='OUT-'+_0xf67cb,_0x5c27ab;}router[a0_0x539370(0x24d)]('/view/add_sales',auth,async(_0x1cb343,_0x1666a0)=>{var _0x3ad444=a0_0x539370;try{const {username:_0x44b8ad,email:_0x1695fa,role:_0x473c1f}=_0x1cb343[_0x3ad444(0x220)],_0x9827d9=_0x1cb343[_0x3ad444(0x220)],_0x31fb79=await profile[_0x3ad444(0x212)]({'email':_0x9827d9[_0x3ad444(0x1a8)]}),_0x3c49ab=await master_shop[_0x3ad444(0x1b3)](),_0x486064=await customer['find']({});let _0x2e4caa;if(_0x9827d9['role']==_0x3ad444(0x1d9)){const _0x51fd4c=await staff[_0x3ad444(0x212)]({'email':_0x9827d9['email']});_0x2e4caa=await warehouse[_0x3ad444(0x240)]([{'$match':{'status':'Enabled','name':_0x51fd4c['warehouse'],'warehouse_category':_0x3ad444(0x273),'name':{'$ne':_0x3ad444(0x207)}}},{'$group':{'_id':_0x3ad444(0x1b9),'name':{'$first':_0x3ad444(0x1b9)}}},{'$sort':{'name':0x1}}]);}else _0x2e4caa=await warehouse[_0x3ad444(0x240)]([{'$match':{'status':_0x3ad444(0x216),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x3ad444(0x207)}}},{'$group':{'_id':_0x3ad444(0x1b9),'name':{'$first':_0x3ad444(0x1b9)}}},{'$sort':{'name':0x1}}]);const _0x772956=await product[_0x3ad444(0x1b3)]({});var _0x21f58d=[_0x3ad444(0x20a),'Enclosed'];const _0x25e004=await sales[_0x3ad444(0x1b3)]({}),_0x54b32b=_0x25e004['length']+0x1,_0x25b6e6=_0x3ad444(0x1f3)+_0x54b32b[_0x3ad444(0x168)]()[_0x3ad444(0x17e)](0x5,'0');if(_0x3c49ab[0x0][_0x3ad444(0x18f)]==_0x3ad444(0x184)){var _0x2914c9=users[_0x3ad444(0x1ce)];console[_0x3ad444(0x18b)](_0x2914c9);}else{if(_0x3c49ab[0x0][_0x3ad444(0x18f)]==_0x3ad444(0x226))var _0x2914c9=users[_0x3ad444(0x226)];else{if(_0x3c49ab[0x0][_0x3ad444(0x18f)]=='German')var _0x2914c9=users[_0x3ad444(0x1e4)];else{if(_0x3c49ab[0x0]['language']=='Spanish')var _0x2914c9=users[_0x3ad444(0x1af)];else{if(_0x3c49ab[0x0][_0x3ad444(0x18f)]==_0x3ad444(0x1da))var _0x2914c9=users[_0x3ad444(0x1da)];else{if(_0x3c49ab[0x0][_0x3ad444(0x18f)]=='Portuguese\x20(BR)')var _0x2914c9=users[_0x3ad444(0x244)];else{if(_0x3c49ab[0x0][_0x3ad444(0x18f)]==_0x3ad444(0x22d))var _0x2914c9=users['Chinese'];else{if(_0x3c49ab[0x0][_0x3ad444(0x18f)]==_0x3ad444(0x217))var _0x2914c9=users[_0x3ad444(0x1ea)];}}}}}}}const _0x1f8bc3=getRandom8DigitNumber();_0x1f8bc3[_0x3ad444(0x1d5)](_0x346675=>{var _0x46a08a=_0x3ad444;_0x1666a0[_0x46a08a(0x201)](_0x46a08a(0x1c0),{'success':_0x1cb343[_0x46a08a(0x223)](_0x46a08a(0x26a)),'errors':_0x1cb343[_0x46a08a(0x223)](_0x46a08a(0x235)),'role':_0x9827d9,'profile':_0x31fb79,'customer':_0x486064,'warehouse':_0x2e4caa,'product':_0x772956,'invoice':_0x346675,'master_shop':_0x3c49ab,'language':_0x2914c9,'rooms_data':_0x21f58d});})[_0x3ad444(0x176)](_0x588336=>{var _0x7b16e3=_0x3ad444;_0x1cb343[_0x7b16e3(0x223)](_0x7b16e3(0x235),_0x7b16e3(0x259)),_0x1666a0[_0x7b16e3(0x254)](_0x7b16e3(0x179));});}catch(_0x61323d){console['log'](_0x61323d);}}),router[a0_0x539370(0x24d)](a0_0x539370(0x213),auth,async(_0x5207ee,_0x45f306)=>{var _0x17e5b4=a0_0x539370;try{const _0x8e66c1=_0x5207ee[_0x17e5b4(0x222)]['id'];console[_0x17e5b4(0x18b)](_0x8e66c1);const _0x262ac6=await product[_0x17e5b4(0x1b3)](),_0x516fa2=await purchases[_0x17e5b4(0x240)]([{'$match':{'warehouse_name':_0x8e66c1}},{'$unwind':_0x17e5b4(0x268)},{'$group':{'_id':_0x17e5b4(0x23b)}}]);console[_0x17e5b4(0x18b)](_0x17e5b4(0x22f),_0x516fa2),_0x45f306[_0x17e5b4(0x1d4)](0xc8)['json']({'purchases_data':_0x516fa2,'product_data':_0x262ac6});}catch(_0x308632){console['log'](_0x308632);}}),router[a0_0x539370(0x270)]('/view/add_sale/product',auth,async(_0x184e72,_0x21ea93)=>{var _0xcf8bae=a0_0x539370;try{const {warehouse_data:_0x61d0da,product_data:_0x1cbc5c}=_0x184e72[_0xcf8bae(0x248)];console[_0xcf8bae(0x18b)](_0x184e72[_0xcf8bae(0x248)][_0xcf8bae(0x1fd)]);;const _0x166f7f=await master_shop[_0xcf8bae(0x1b3)]();console[_0xcf8bae(0x18b)]('master',_0x166f7f);const _0x5c3ee4=await product['findOne']({'name':_0x1cbc5c});console[_0xcf8bae(0x18b)]('product',_0x5c3ee4);const _0x20b30d=await warehouse[_0xcf8bae(0x240)]([{'$match':{'name':_0x61d0da}},{'$unwind':_0xcf8bae(0x233)},{'$match':{'product_details.product_name':_0x1cbc5c}},{'$group':{'_id':_0xcf8bae(0x1b6),'product_stock':{'$first':_0xcf8bae(0x1c8)}}}]);console[_0xcf8bae(0x18b)](_0xcf8bae(0x1ad),_0x20b30d),_0x21ea93['status'](0xc8)[_0xcf8bae(0x1fb)]({'master':_0x166f7f,'new_product':_0x5c3ee4,'stock_data':_0x20b30d});}catch(_0x82e100){console['log'](_0x82e100);}}),router['post'](a0_0x539370(0x22a),auth,async(_0x4378d3,_0x144d23)=>{var _0x189bfa=a0_0x539370;try{const {invoice:_0x27faab,date:_0x4e9f88,warehouse_name:_0xf661f8,product_name:_0x24d3d7,stock:_0x4815a8,quantity:_0x32f64c,note:_0x45f8fc,room:_0x18ba3c,primary_code:_0x5540bf,secondary_code:_0x19c4fd,prod_code:_0x22560c,level:_0x534044,isle:_0x635945,pallet:_0x3d74cb,batch_code:_0x491471,SCRN:_0x272fbe,expiry_date:_0x4178dd}=_0x4378d3[_0x189bfa(0x248)];if(typeof _0x24d3d7==_0x189bfa(0x1e3))var _0x27a0f3=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x1be)]],_0x11989b=[_0x4378d3['body']['stock']],_0xcae649=[_0x4378d3[_0x189bfa(0x248)]['carton']],_0x37c209=[_0x4378d3['body']['primary_code']],_0x225490=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x238)]],_0xeecf69=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x253)]],_0xe27c68=[_0x4378d3['body'][_0x189bfa(0x1b7)]],_0xf1fa57=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x251)]],_0x4e36ee=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x255)]],_0x3499be=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x202)]],_0xf7b213=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x180)]],_0x1aac9c=[_0x4378d3['body'][_0x189bfa(0x236)]],_0x43bd3b=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x1c1)]],_0x492bd2=[_0x4378d3['body'][_0x189bfa(0x16e)]],_0x2f95e6=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x1c7)]],_0x477215=[_0x4378d3[_0x189bfa(0x248)]['delivery_code']],_0xb9b46c=[_0x4378d3[_0x189bfa(0x248)]['prod_cat']],_0x153079=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x239)]],_0x128a23=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x187)]],_0x243029=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x16d)]],_0x2fa400=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x1ac)]],_0x1ce980=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x1a9)]],_0x3bb258=[_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x232)]];else var _0x27a0f3=[..._0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x1be)]],_0x11989b=[..._0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x227)]],_0xcae649=[..._0x4378d3['body'][_0x189bfa(0x257)]],_0x37c209=[..._0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x203)]],_0x225490=[..._0x4378d3['body'][_0x189bfa(0x238)]],_0xeecf69=[..._0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x253)]],_0xe27c68=[..._0x4378d3['body'][_0x189bfa(0x1b7)]],_0xf1fa57=[..._0x4378d3[_0x189bfa(0x248)]['primary_unit']],_0x4e36ee=[..._0x4378d3[_0x189bfa(0x248)]['secondary_unit']],_0x3499be=[..._0x4378d3[_0x189bfa(0x248)]['batch_code']],_0xf7b213=[..._0x4378d3[_0x189bfa(0x248)]['expiry_date']],_0x1aac9c=[..._0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x236)]],_0x43bd3b=[..._0x4378d3[_0x189bfa(0x248)]['production_date']],_0x492bd2=[..._0x4378d3['body'][_0x189bfa(0x16e)]],_0x2f95e6=[..._0x4378d3[_0x189bfa(0x248)]['delivery_date']],_0x477215=[..._0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x206)]],_0xb9b46c=[..._0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x1cb)]],_0x153079=[..._0x4378d3[_0x189bfa(0x248)]['quantity']],_0x128a23=[..._0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x187)]],_0x243029=[..._0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x16d)]],_0x2fa400=[..._0x4378d3['body'][_0x189bfa(0x1ac)]],_0x1ce980=[..._0x4378d3['body'][_0x189bfa(0x1a9)]],_0x3bb258=[..._0x4378d3['body']['id_transact']];const _0x224010=_0x27a0f3[_0x189bfa(0x1f9)](_0x487b99=>{return _0x487b99={'product_name':_0x487b99};});_0x11989b[_0x189bfa(0x263)]((_0x3c33a0,_0x37a038)=>{var _0x3310a4=_0x189bfa;_0x224010[_0x37a038]['stock']=Math[_0x3310a4(0x199)](_0x3c33a0);}),_0x2fa400['forEach']((_0x354077,_0x3297b0)=>{var _0x584f8c=_0x189bfa;_0x224010[_0x3297b0][_0x584f8c(0x1ac)]=Math[_0x584f8c(0x199)](_0x354077);}),_0x1ce980[_0x189bfa(0x263)]((_0x36c0ac,_0x2de202)=>{var _0x5de0ec=_0x189bfa;_0x224010[_0x2de202][_0x5de0ec(0x1a9)]=_0x36c0ac;}),_0x3bb258['forEach']((_0xae255b,_0x2ac46a)=>{_0x224010[_0x2ac46a]['id_transaction_from']=_0xae255b;}),_0xcae649[_0x189bfa(0x263)]((_0x56c030,_0x320557)=>{_0x224010[_0x320557]['quantity']=_0x56c030;}),_0x37c209['forEach']((_0x1d86fd,_0xd33dd)=>{var _0x19b656=_0x189bfa;_0x224010[_0xd33dd][_0x19b656(0x203)]=_0x1d86fd;}),_0x225490[_0x189bfa(0x263)]((_0xee6bd8,_0x5d26e4)=>{var _0x4cab4f=_0x189bfa;_0x224010[_0x5d26e4][_0x4cab4f(0x238)]=_0xee6bd8;}),_0xeecf69[_0x189bfa(0x263)]((_0xd7f82c,_0x59bfac)=>{var _0x1150b9=_0x189bfa;_0x224010[_0x59bfac][_0x1150b9(0x1f2)]=_0xd7f82c;}),_0xe27c68[_0x189bfa(0x263)]((_0x1bddd4,_0x33a758)=>{var _0x540738=_0x189bfa;_0x128a23[_0x540738(0x263)]((_0x55ff72,_0x814961)=>{var _0x459fbc=_0x540738;if(_0x55ff72==_0x459fbc(0x1d6)&&_0x33a758==_0x814961){var _0x596d6b=_0x1bddd4[_0x459fbc(0x167)](0x3);_0x224010[_0x33a758][_0x459fbc(0x182)]=_0x1bddd4[0x0],_0x224010[_0x33a758][_0x459fbc(0x1b0)]=_0x1bddd4[0x1],_0x224010[_0x33a758][_0x459fbc(0x276)]=0x0,_0x224010[_0x33a758][_0x459fbc(0x266)]=0x0,_0x224010[_0x33a758]['type']=_0x459fbc(0x1e6),_0x224010[_0x33a758][_0x459fbc(0x18e)]=_0x596d6b;}else{if(_0x55ff72==_0x459fbc(0x1e1)&&_0x33a758==_0x814961){var _0x596d6b=_0x1bddd4[_0x459fbc(0x167)](0x3);_0x224010[_0x33a758][_0x459fbc(0x182)]=_0x1bddd4[0x0],_0x224010[_0x33a758][_0x459fbc(0x1b0)]=_0x1bddd4[0x1],_0x224010[_0x33a758]['bay']=0x0,_0x224010[_0x33a758]['bin']=0x0,_0x224010[_0x33a758][_0x459fbc(0x1f0)]='Floor',_0x224010[_0x33a758]['floorlevel']=_0x1bddd4[0x5];}else{if(_0x33a758==_0x814961){var _0x1cbb60;if(_0x1bddd4[0x4]=='L')_0x1cbb60=_0x459fbc(0x1de);else _0x1bddd4[0x4]=='F'&&(_0x1cbb60='Floor');_0x224010[_0x33a758][_0x459fbc(0x182)]=_0x1bddd4[0x0],_0x224010[_0x33a758][_0x459fbc(0x1b0)]=_0x1bddd4[0x1],_0x224010[_0x33a758][_0x459fbc(0x276)]=_0x1bddd4[0x2],_0x224010[_0x33a758][_0x459fbc(0x266)]=_0x1bddd4[0x3],_0x224010[_0x33a758][_0x459fbc(0x1f0)]=_0x1cbb60,_0x224010[_0x33a758][_0x459fbc(0x18e)]=_0x1bddd4[0x5];}}}});}),_0xf1fa57[_0x189bfa(0x263)]((_0xe1f8a7,_0x53d000)=>{var _0x4a8b6a=_0x189bfa;_0x224010[_0x53d000][_0x4a8b6a(0x1f7)]=_0xe1f8a7;}),_0x4e36ee[_0x189bfa(0x263)]((_0x179042,_0x3d25ba)=>{_0x224010[_0x3d25ba]['secondary_unit']=_0x179042;}),_0x3499be[_0x189bfa(0x263)]((_0x46e072,_0x132918)=>{_0x224010[_0x132918]['batch_code']=_0x46e072;}),_0xf7b213[_0x189bfa(0x263)]((_0x30d333,_0x470a91)=>{var _0x150f64=_0x189bfa;_0x224010[_0x470a91][_0x150f64(0x180)]=_0x30d333;}),_0x1aac9c[_0x189bfa(0x263)]((_0x4b07a5,_0x261d8e)=>{var _0x1f0b51=_0x189bfa;_0x224010[_0x261d8e][_0x1f0b51(0x258)]=_0x4b07a5;}),_0x43bd3b['forEach']((_0x326325,_0x530052)=>{var _0x3c44f8=_0x189bfa;_0x224010[_0x530052][_0x3c44f8(0x1c1)]=_0x326325;}),_0x492bd2[_0x189bfa(0x263)]((_0x363abb,_0x168953)=>{var _0x2b8f56=_0x189bfa;_0x224010[_0x168953][_0x2b8f56(0x16e)]=_0x363abb;}),_0x2f95e6[_0x189bfa(0x263)]((_0xad0bbc,_0x4debeb)=>{var _0xe59288=_0x189bfa;_0x224010[_0x4debeb][_0xe59288(0x1c7)]=_0xad0bbc;}),_0x477215[_0x189bfa(0x263)]((_0x4ed4b0,_0x308722)=>{var _0x5c38ca=_0x189bfa;_0x224010[_0x308722][_0x5c38ca(0x206)]=_0x4ed4b0;}),_0xb9b46c[_0x189bfa(0x263)]((_0x5379e4,_0x370f97)=>{_0x224010[_0x370f97]['prod_cat']=_0x5379e4;}),_0x153079[_0x189bfa(0x263)]((_0x415749,_0x55bb3e)=>{var _0x371f90=_0x189bfa;_0x224010[_0x55bb3e][_0x371f90(0x1a5)]=_0x415749;}),_0x128a23[_0x189bfa(0x263)]((_0x3ec6c1,_0x4552b5)=>{var _0x40c40c=_0x189bfa;_0x224010[_0x4552b5][_0x40c40c(0x231)]=_0x3ec6c1;}),_0x243029[_0x189bfa(0x263)]((_0x1fa1a6,_0x50a17f)=>{_0x224010[_0x50a17f]['invoice']=_0x1fa1a6;});var _0x53f9cc=0x0;_0x224010['forEach'](_0x45ec66=>{var _0x5dc23a=_0x189bfa;(_0x45ec66[_0x5dc23a(0x227)]<_0x45ec66[_0x5dc23a(0x1a5)]||_0x45ec66[_0x5dc23a(0x1a5)]==0x0)&&(console[_0x5dc23a(0x18b)](_0x5dc23a(0x1aa),_0x45ec66),_0x53f9cc++);});const _0x3ede3c=_0x224010[_0x189bfa(0x1b5)](_0x1a6095=>_0x1a6095[_0x189bfa(0x239)]!=='0'&&_0x1a6095['quantity']!==''),_0x32d940=new sales({'invoice':_0x27faab,'customer':_0x4378d3[_0x189bfa(0x248)][_0x189bfa(0x25c)],'date':_0x4e9f88,'warehouse_name':_0xf661f8,'sale_product':_0x3ede3c,'note':_0x45f8fc,'room':_0x18ba3c,'primary_code':_0x5540bf,'secondary_code':_0x19c4fd,'prod_code':_0x22560c,'SCRN':_0x272fbe}),_0x21e36f=await _0x32d940[_0x189bfa(0x269)]();_0x4378d3[_0x189bfa(0x223)](_0x189bfa(0x26a),'Sales\x20Add\x20successfully'),_0x144d23[_0x189bfa(0x254)](_0x189bfa(0x17b)+_0x21e36f[_0x189bfa(0x245)]);}catch(_0x5eef7d){console[_0x189bfa(0x18b)](_0x5eef7d);}}),router['get'](a0_0x539370(0x25a),auth,async(_0x34b915,_0x3da8c0)=>{var _0x337ddc=a0_0x539370;try{const {username:_0x3415e6,email:_0x5614dc,role:_0x37a28d}=_0x34b915[_0x337ddc(0x220)],_0x1742cc=_0x34b915[_0x337ddc(0x220)],_0x183181=await profile[_0x337ddc(0x212)]({'email':_0x1742cc[_0x337ddc(0x1a8)]}),_0x56cbbd=await master_shop[_0x337ddc(0x1b3)](),_0x49f16a=_0x34b915['params']['id'],_0x289fcc=await sales[_0x337ddc(0x21a)](_0x49f16a),_0x6297da=await warehouse[_0x337ddc(0x240)]([{'$match':{'name':_0x289fcc[_0x337ddc(0x169)]}},{'$unwind':_0x337ddc(0x233)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x337ddc(0x1b6)},'product_stock':{'$first':_0x337ddc(0x1c8)},'bay':{'$first':_0x337ddc(0x24f)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x337ddc(0x272)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x337ddc(0x25f)},'product_code':{'$first':_0x337ddc(0x175)},'storage':{'$first':_0x337ddc(0x1ae)},'rack':{'$first':_0x337ddc(0x1d3)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x337ddc(0x21c)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x24f985=await customer[_0x337ddc(0x1b3)]({});let _0x310619;if(_0x1742cc[_0x337ddc(0x24c)]==_0x337ddc(0x1d9)){const _0x5dac41=await staff[_0x337ddc(0x212)]({'email':_0x1742cc['email']});_0x310619=await warehouse[_0x337ddc(0x240)]([{'$match':{'status':_0x337ddc(0x216),'name':_0x5dac41[_0x337ddc(0x211)]}},{'$group':{'_id':_0x337ddc(0x1b9),'name':{'$first':_0x337ddc(0x1b9)}}}]);}else _0x310619=await warehouse[_0x337ddc(0x240)]([{'$match':{'status':_0x337ddc(0x216)}},{'$group':{'_id':_0x337ddc(0x1b9),'name':{'$first':_0x337ddc(0x1b9)}}}]);const _0x2d3a1b=await product[_0x337ddc(0x1b3)]({}),_0x423336=await suppliers['find']({});if(_0x56cbbd[0x0]['language']==_0x337ddc(0x184)){var _0x5731ed=users[_0x337ddc(0x1ce)];console[_0x337ddc(0x18b)](_0x5731ed);}else{if(_0x56cbbd[0x0][_0x337ddc(0x18f)]==_0x337ddc(0x226))var _0x5731ed=users['Hindi'];else{if(_0x56cbbd[0x0][_0x337ddc(0x18f)]==_0x337ddc(0x1e4))var _0x5731ed=users[_0x337ddc(0x1e4)];else{if(_0x56cbbd[0x0]['language']=='Spanish')var _0x5731ed=users['Spanish'];else{if(_0x56cbbd[0x0][_0x337ddc(0x18f)]=='French')var _0x5731ed=users[_0x337ddc(0x1da)];else{if(_0x56cbbd[0x0]['language']=='Portuguese\x20(BR)')var _0x5731ed=users['Portuguese'];else{if(_0x56cbbd[0x0][_0x337ddc(0x18f)]==_0x337ddc(0x22d))var _0x5731ed=users['Chinese'];else{if(_0x56cbbd[0x0][_0x337ddc(0x18f)]==_0x337ddc(0x217))var _0x5731ed=users[_0x337ddc(0x1ea)];}}}}}}}_0x3da8c0[_0x337ddc(0x201)]('edit_sales_view',{'success':_0x34b915[_0x337ddc(0x223)](_0x337ddc(0x26a)),'errors':_0x34b915[_0x337ddc(0x223)](_0x337ddc(0x235)),'role':_0x1742cc,'profile':_0x183181,'customer':_0x24f985,'warehouse':_0x310619,'product':_0x6297da,'user':_0x289fcc,'master_shop':_0x56cbbd,'unit':_0x2d3a1b,'language':_0x5731ed,'suppliers':_0x423336});}catch(_0x2d9148){console[_0x337ddc(0x18b)](_0x2d9148);}}),router[a0_0x539370(0x270)](a0_0x539370(0x25a),auth,async(_0x232831,_0x4cd2ac)=>{var _0x22b611=a0_0x539370;try{const _0x4582f1=_0x232831[_0x22b611(0x222)]['id'],{invoice:_0x22eb95,warehouse_name:_0x2c4f6f,room:_0x41f780}=_0x232831['body'],_0x3d6fbb=await sales[_0x22b611(0x212)]({'invoice':_0x22eb95}),_0x2169ee=_0x3d6fbb[_0x22b611(0x1dd)][_0x22b611(0x1f9)](async _0x216ae8=>{var _0x3c1178=_0x22b611,_0x40afb6=await warehouse[_0x3c1178(0x212)]({'name':_0x2c4f6f,'room':_0x216ae8[_0x3c1178(0x231)],'warehouse_category':'Raw\x20Materials'});const _0x209719=_0x40afb6['product_details'][_0x3c1178(0x1f9)](_0xa60962=>{var _0x4f3d27=_0x3c1178;_0xa60962[_0x4f3d27(0x1be)]==_0x216ae8[_0x4f3d27(0x1be)]&&_0xa60962[_0x4f3d27(0x18e)]==_0x216ae8[_0x4f3d27(0x18e)]&&_0xa60962[_0x4f3d27(0x1f0)]==_0x216ae8[_0x4f3d27(0x1f0)]&&_0xa60962[_0x4f3d27(0x266)]==_0x216ae8[_0x4f3d27(0x266)]&&_0xa60962[_0x4f3d27(0x276)]==_0x216ae8[_0x4f3d27(0x276)]&&_0xa60962[_0x4f3d27(0x1b0)]==_0x216ae8[_0x4f3d27(0x1b0)]&&_0xa60962[_0x4f3d27(0x182)]==_0x216ae8[_0x4f3d27(0x182)]&&_0xa60962[_0x4f3d27(0x180)]==_0x216ae8[_0x4f3d27(0x180)]&&_0xa60962[_0x4f3d27(0x202)]==_0x216ae8['batch_code']&&_0xa60962[_0x4f3d27(0x278)]==_0x216ae8[_0x4f3d27(0x278)]&&_0xa60962[_0x4f3d27(0x245)]==_0x216ae8[_0x4f3d27(0x1f1)]&&(_0xa60962[_0x4f3d27(0x1fe)]=Math[_0x4f3d27(0x16f)](0x0,Math[_0x4f3d27(0x199)](_0xa60962[_0x4f3d27(0x1fe)])-Math[_0x4f3d27(0x199)](_0x216ae8[_0x4f3d27(0x239)])));});return _0x40afb6;});Promise['all'](_0x2169ee)['then'](async _0x48ab83=>{var _0x26b21e=_0x22b611;try{for(const _0x5b1722 of _0x48ab83){await _0x5b1722[_0x26b21e(0x269)]();}_0x3d6fbb[_0x26b21e(0x188)]=_0x26b21e(0x17f);const _0x32aeec=await _0x3d6fbb[_0x26b21e(0x269)](),_0x50394d=await master_shop[_0x26b21e(0x1b3)](),_0x4cfd78=await email_settings[_0x26b21e(0x212)](),_0x27ab18=await supervisor_settings['find']();var _0x44d656=_0x3d6fbb[_0x26b21e(0x1dd)],_0x1e5ea9='',_0xefa85f;for(_0xefa85f in _0x44d656){_0x1e5ea9+=_0x26b21e(0x26c)+_0x26b21e(0x23a)+_0x44d656[_0xefa85f][_0x26b21e(0x1be)]+_0x26b21e(0x23e)+_0x26b21e(0x23a)+_0x44d656[_0xefa85f]['product_code']+_0x26b21e(0x23e)+_0x26b21e(0x23a)+_0x44d656[_0xefa85f]['quantity']+_0x26b21e(0x23e)+_0x26b21e(0x23a)+_0x44d656[_0xefa85f]['unit']+'</td>'+_0x26b21e(0x23a)+_0x44d656[_0xefa85f][_0x26b21e(0x255)]+_0x26b21e(0x23e)+_0x26b21e(0x23a)+_0x3d6fbb[_0x26b21e(0x169)]+'</td>'+_0x26b21e(0x23a)+_0x44d656[_0xefa85f]['room_name']+_0x26b21e(0x23e)+_0x26b21e(0x23a)+_0x44d656[_0xefa85f][_0x26b21e(0x182)]+_0x44d656[_0xefa85f][_0x26b21e(0x1b0)]+_0x44d656[_0xefa85f]['bay']+_0x44d656[_0xefa85f][_0x26b21e(0x266)]+_0x44d656[_0xefa85f]['type'][0x0]+_0x44d656[_0xefa85f][_0x26b21e(0x18e)]+_0x26b21e(0x23e),_0x26b21e(0x17a);}let _0x42f2c4=nodemailer[_0x26b21e(0x1e0)]({'host':_0x4cfd78[_0x26b21e(0x16a)],'port':Number(_0x4cfd78[_0x26b21e(0x1cd)]),'secure':![],'auth':{'user':_0x4cfd78[_0x26b21e(0x1a8)],'pass':_0x4cfd78['password']}}),_0x2672e6={'from':_0x4cfd78['email'],'to':_0x27ab18[0x0][_0x26b21e(0x205)],'subject':_0x26b21e(0x21b),'attachments':[{'filename':_0x26b21e(0x1d7),'path':__dirname+_0x26b21e(0x249)+'/upload/'+_0x50394d[0x0][_0x26b21e(0x25e)],'cid':_0x26b21e(0x200)}],'html':_0x26b21e(0x243)+_0x26b21e(0x185)+_0x26b21e(0x1d0)+_0x26b21e(0x24e)+_0x26b21e(0x1fa)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x26b21e(0x24e)+'<h2>\x20'+_0x50394d[0x0][_0x26b21e(0x1f8)]+'\x20</h2>'+_0x26b21e(0x19c)+'</div>'+_0x26b21e(0x1b4)+'<div>'+_0x26b21e(0x25d)+_0x26b21e(0x208)+_0x3d6fbb[_0x26b21e(0x278)]+'\x20'+_0x26b21e(0x1d1)+_0x26b21e(0x256)+_0x3d6fbb[_0x26b21e(0x24a)]+'\x20'+_0x26b21e(0x17d)+_0x26b21e(0x242)+_0x26b21e(0x19c)+_0x26b21e(0x265)+_0x26b21e(0x174)+_0x26b21e(0x26c)+_0x26b21e(0x16c)+_0x26b21e(0x214)+_0x26b21e(0x1e2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x26b21e(0x1eb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x26b21e(0x23c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x26b21e(0x17a)+_0x26b21e(0x198)+_0x26b21e(0x183)+'\x20'+_0x1e5ea9+'\x20'+_0x26b21e(0x24b)+_0x26b21e(0x1cc)+_0x26b21e(0x24e)+_0x26b21e(0x1ef)+_0x26b21e(0x20e)+_0x50394d[0x0][_0x26b21e(0x1f8)]+'</h5>'+_0x26b21e(0x19c)+'</div>'+_0x26b21e(0x16b)};_0x42f2c4['sendMail'](_0x2672e6,function(_0x57cbf5,_0x2b9387){var _0x324581=_0x26b21e;_0x57cbf5?(console[_0x324581(0x18b)](_0x57cbf5),console[_0x324581(0x18b)]('Error\x20Occurs')):console[_0x324581(0x18b)](_0x324581(0x173));}),_0x232831[_0x26b21e(0x223)](_0x26b21e(0x26a),_0x26b21e(0x1ca)),_0x4cd2ac[_0x26b21e(0x254)]('/all_sales/preview/'+_0x4582f1);}catch(_0x4709f7){console[_0x26b21e(0x1a0)](_0x4709f7),_0x4cd2ac[_0x26b21e(0x1d4)](0x1f4)[_0x26b21e(0x1fb)]({'error':_0x26b21e(0x1e9)});}})[_0x22b611(0x176)](_0x2fcf0b=>{var _0x50ba87=_0x22b611;console[_0x50ba87(0x1a0)](_0x2fcf0b),_0x4cd2ac[_0x50ba87(0x1d4)](0x1f4)[_0x50ba87(0x1fb)]({'error':'An\x20error\x20occurred.'});});}catch(_0x5f332a){console[_0x22b611(0x18b)](_0x5f332a);}}),router[a0_0x539370(0x24d)](a0_0x539370(0x22c),auth,async(_0x2b6e0a,_0x127193)=>{var _0xfa3d31=a0_0x539370;try{const {username:_0xbe16f,email:_0x1e48bf,role:_0x2aefa9}=_0x2b6e0a['user'],_0x5603ae=_0x2b6e0a['user'],_0x4d2551=await profile[_0xfa3d31(0x212)]({'email':_0x5603ae[_0xfa3d31(0x1a8)]}),_0x22acb3=await master_shop['find'](),_0xd39367=_0x2b6e0a[_0xfa3d31(0x222)]['id'],_0xb45a99=await sales[_0xfa3d31(0x21a)](_0xd39367);var _0x1da2aa=[_0xfa3d31(0x20a),'Enclosed'];const _0x13477b=await warehouse[_0xfa3d31(0x240)]([{'$match':{'name':_0xb45a99[_0xfa3d31(0x169)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':'$product_details'},{'$group':{'_id':_0xfa3d31(0x189),'name':{'$first':_0xfa3d31(0x1b6)},'product_stock':{'$first':_0xfa3d31(0x1c8)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xfa3d31(0x1c3)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xfa3d31(0x1df)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xfa3d31(0x1ae)},'rack':{'$first':_0xfa3d31(0x1d3)}}}]),_0x1d36c4=await customer[_0xfa3d31(0x1b3)]({});let _0x2465ba;if(_0x5603ae[_0xfa3d31(0x24c)]==_0xfa3d31(0x1d9)){const _0x420278=await staff[_0xfa3d31(0x212)]({'email':_0x5603ae[_0xfa3d31(0x1a8)]});_0x2465ba=await warehouse[_0xfa3d31(0x240)]([{'$match':{'status':_0xfa3d31(0x216),'name':_0x420278[_0xfa3d31(0x211)],'warehouse_category':_0xfa3d31(0x273)}},{'$group':{'_id':_0xfa3d31(0x1b9),'name':{'$first':_0xfa3d31(0x1b9)}}}]);}else _0x2465ba=await warehouse[_0xfa3d31(0x240)]([{'$match':{'status':_0xfa3d31(0x216),'warehouse_category':_0xfa3d31(0x273)}},{'$group':{'_id':_0xfa3d31(0x1b9),'name':{'$first':_0xfa3d31(0x1b9)}}}]);const _0x2ee521=await product[_0xfa3d31(0x1b3)]({});if(_0x22acb3[0x0][_0xfa3d31(0x18f)]==_0xfa3d31(0x184)){var _0xf59d59=users[_0xfa3d31(0x1ce)];console['log'](_0xf59d59);}else{if(_0x22acb3[0x0][_0xfa3d31(0x18f)]==_0xfa3d31(0x226))var _0xf59d59=users[_0xfa3d31(0x226)];else{if(_0x22acb3[0x0][_0xfa3d31(0x18f)]==_0xfa3d31(0x1e4))var _0xf59d59=users[_0xfa3d31(0x1e4)];else{if(_0x22acb3[0x0]['language']=='Spanish')var _0xf59d59=users[_0xfa3d31(0x1af)];else{if(_0x22acb3[0x0][_0xfa3d31(0x18f)]=='French')var _0xf59d59=users['French'];else{if(_0x22acb3[0x0]['language']==_0xfa3d31(0x22e))var _0xf59d59=users[_0xfa3d31(0x244)];else{if(_0x22acb3[0x0]['language']==_0xfa3d31(0x22d))var _0xf59d59=users[_0xfa3d31(0x22d)];else{if(_0x22acb3[0x0][_0xfa3d31(0x18f)]==_0xfa3d31(0x217))var _0xf59d59=users[_0xfa3d31(0x1ea)];}}}}}}}_0x127193[_0xfa3d31(0x201)](_0xfa3d31(0x228),{'success':_0x2b6e0a['flash']('success'),'errors':_0x2b6e0a['flash'](_0xfa3d31(0x235)),'role':_0x5603ae,'profile':_0x4d2551,'customer':_0x1d36c4,'warehouse':_0x2465ba,'product':_0x13477b,'user':_0xb45a99,'master_shop':_0x22acb3,'unit':_0x2ee521,'language':_0xf59d59});}catch(_0x1d7092){console[_0xfa3d31(0x18b)](_0x1d7092);}}),router['post']('/view/:id',auth,async(_0x18ac85,_0x3a0d60)=>{var _0x2bd1c9=a0_0x539370;try{const _0x4ab7a5=_0x18ac85[_0x2bd1c9(0x222)]['id'],_0x54007f=await sales['findOne']({'_id':_0x18ac85[_0x2bd1c9(0x222)]['id']}),_0x396577=await warehouse[_0x2bd1c9(0x212)]({'name':_0x54007f['warehouse_name'],'room':_0x18ac85[_0x2bd1c9(0x248)]['room']}),{invoice:_0x57d5ea,date:_0x12ab9c,warehouse_name:_0x4914dd,product_name:_0x3c13c4,stock:_0x55e12c,quantity:_0x48197e,note:_0x4c15b1,room:_0x51ee57,customer:_0x2b79f2,SCRN:_0x5e1f10}=_0x18ac85[_0x2bd1c9(0x248)];if(typeof _0x3c13c4==_0x2bd1c9(0x1e3))var _0x16411d=[_0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x1be)]],_0x49fc5a=[_0x18ac85['body'][_0x2bd1c9(0x227)]],_0x3231b5=[_0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x257)]],_0xf535e6=[_0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x203)]],_0x5d4817=[_0x18ac85['body']['secondary_code']],_0x2ff24e=[_0x18ac85[_0x2bd1c9(0x248)]['prod_code']],_0x27c8f6=[_0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x1b7)]],_0x393272=[_0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x251)]],_0x1678ff=[_0x18ac85[_0x2bd1c9(0x248)]['secondary_unit']],_0x5bda06=[_0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x202)]],_0x2ae460=[_0x18ac85['body'][_0x2bd1c9(0x180)]],_0x5f1944=[_0x18ac85['body'][_0x2bd1c9(0x236)]],_0x3dc6de=[_0x18ac85['body'][_0x2bd1c9(0x1c1)]],_0x54ea47=[_0x18ac85['body']['requested_qty']],_0x105ca1=[_0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x1c7)]],_0x5edd58=[_0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x206)]],_0x4ac60e=[_0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x1cb)]],_0x430ab5=[_0x18ac85[_0x2bd1c9(0x248)]['quantity']],_0x4e9974=[_0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x187)]];else var _0x16411d=[..._0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x1be)]],_0x49fc5a=[..._0x18ac85[_0x2bd1c9(0x248)]['stock']],_0x3231b5=[..._0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x257)]],_0xf535e6=[..._0x18ac85[_0x2bd1c9(0x248)]['primary_code']],_0x5d4817=[..._0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x238)]],_0x2ff24e=[..._0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x253)]],_0x27c8f6=[..._0x18ac85['body'][_0x2bd1c9(0x1b7)]],_0x393272=[..._0x18ac85['body'][_0x2bd1c9(0x251)]],_0x1678ff=[..._0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x255)]],_0x5bda06=[..._0x18ac85[_0x2bd1c9(0x248)]['batch_code']],_0x2ae460=[..._0x18ac85['body'][_0x2bd1c9(0x180)]],_0x5f1944=[..._0x18ac85['body'][_0x2bd1c9(0x236)]],_0x3dc6de=[..._0x18ac85['body'][_0x2bd1c9(0x1c1)]],_0x54ea47=[..._0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x16e)]],_0x105ca1=[..._0x18ac85[_0x2bd1c9(0x248)]['delivery_date']],_0x5edd58=[..._0x18ac85[_0x2bd1c9(0x248)]['delivery_code']],_0x4ac60e=[..._0x18ac85['body'][_0x2bd1c9(0x1cb)]],_0x430ab5=[..._0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x239)]],_0x4e9974=[..._0x18ac85[_0x2bd1c9(0x248)][_0x2bd1c9(0x187)]];const _0x364f82=_0x16411d[_0x2bd1c9(0x1f9)](_0x500453=>{return _0x500453={'product_name':_0x500453};});_0x49fc5a[_0x2bd1c9(0x263)]((_0x473184,_0x122c0c)=>{var _0x30cbcd=_0x2bd1c9;_0x364f82[_0x122c0c][_0x30cbcd(0x227)]=Math[_0x30cbcd(0x199)](_0x473184);}),_0x3231b5['forEach']((_0x15b79c,_0x403e12)=>{var _0x11d4c5=_0x2bd1c9;_0x364f82[_0x403e12][_0x11d4c5(0x239)]=_0x15b79c;}),_0xf535e6[_0x2bd1c9(0x263)]((_0x7aacd5,_0x11d8cc)=>{_0x364f82[_0x11d8cc]['primary_code']=_0x7aacd5;}),_0x5d4817[_0x2bd1c9(0x263)]((_0x10e9ec,_0x1b0016)=>{var _0x4567a2=_0x2bd1c9;_0x364f82[_0x1b0016][_0x4567a2(0x238)]=_0x10e9ec;}),_0x2ff24e[_0x2bd1c9(0x263)]((_0x419ef8,_0x1a8f97)=>{_0x364f82[_0x1a8f97]['product_code']=_0x419ef8;}),_0x27c8f6[_0x2bd1c9(0x263)]((_0xb797ac,_0x74dd7f)=>{var _0x23f1f7=_0x2bd1c9;_0x4e9974[_0x23f1f7(0x263)]((_0x3c6c47,_0x297c2a)=>{var _0x1c3f3b=_0x23f1f7;if(_0x3c6c47=='Receiving\x20Area'&&_0x74dd7f==_0x297c2a){var _0x237ff9=_0xb797ac[_0x1c3f3b(0x167)](0x3);_0x364f82[_0x74dd7f][_0x1c3f3b(0x182)]=_0xb797ac[0x0],_0x364f82[_0x74dd7f][_0x1c3f3b(0x1b0)]=_0xb797ac[0x1],_0x364f82[_0x74dd7f]['bay']=0x0,_0x364f82[_0x74dd7f][_0x1c3f3b(0x266)]=0x0,_0x364f82[_0x74dd7f][_0x1c3f3b(0x1f0)]=_0x1c3f3b(0x1e6),_0x364f82[_0x74dd7f][_0x1c3f3b(0x18e)]=_0x237ff9;}else{if(_0x3c6c47==_0x1c3f3b(0x1e1)&&_0x74dd7f==_0x297c2a){var _0x237ff9=_0xb797ac[_0x1c3f3b(0x167)](0x3);_0x364f82[_0x74dd7f][_0x1c3f3b(0x182)]=_0xb797ac[0x0],_0x364f82[_0x74dd7f][_0x1c3f3b(0x1b0)]=_0xb797ac[0x1],_0x364f82[_0x74dd7f][_0x1c3f3b(0x276)]=0x0,_0x364f82[_0x74dd7f][_0x1c3f3b(0x266)]=0x0,_0x364f82[_0x74dd7f]['type']='Floor',_0x364f82[_0x74dd7f][_0x1c3f3b(0x18e)]=_0xb797ac[0x5];}else{if(_0x74dd7f==_0x297c2a){var _0x1a8d0d;if(_0xb797ac[0x4]=='L')_0x1a8d0d=_0x1c3f3b(0x1de);else _0xb797ac[0x4]=='F'&&(_0x1a8d0d=_0x1c3f3b(0x1e6));_0x364f82[_0x74dd7f][_0x1c3f3b(0x182)]=_0xb797ac[0x0],_0x364f82[_0x74dd7f]['rack']=_0xb797ac[0x1],_0x364f82[_0x74dd7f][_0x1c3f3b(0x276)]=_0xb797ac[0x2],_0x364f82[_0x74dd7f][_0x1c3f3b(0x266)]=_0xb797ac[0x3],_0x364f82[_0x74dd7f][_0x1c3f3b(0x1f0)]=_0x1a8d0d,_0x364f82[_0x74dd7f]['floorlevel']=_0xb797ac[0x5];}}}});}),_0x393272[_0x2bd1c9(0x263)]((_0x5cd708,_0x33fcb3)=>{var _0x4ae109=_0x2bd1c9;_0x364f82[_0x33fcb3][_0x4ae109(0x1f7)]=_0x5cd708;}),_0x1678ff[_0x2bd1c9(0x263)]((_0x23ed9b,_0x30d727)=>{var _0x1bb373=_0x2bd1c9;_0x364f82[_0x30d727][_0x1bb373(0x255)]=_0x23ed9b;}),_0x5bda06[_0x2bd1c9(0x263)]((_0x304711,_0x5b030d)=>{_0x364f82[_0x5b030d]['batch_code']=_0x304711;}),_0x2ae460[_0x2bd1c9(0x263)]((_0xd5a3d,_0x578742)=>{var _0x17c572=_0x2bd1c9;_0x364f82[_0x578742][_0x17c572(0x180)]=_0xd5a3d;}),_0x5f1944[_0x2bd1c9(0x263)]((_0x4e25c5,_0x51f81c)=>{_0x364f82[_0x51f81c]['maxperunit']=_0x4e25c5;}),_0x3dc6de['forEach']((_0x1375cb,_0x2a50d5)=>{var _0x298772=_0x2bd1c9;_0x364f82[_0x2a50d5][_0x298772(0x1c1)]=_0x1375cb;}),_0x54ea47['forEach']((_0x31766f,_0x23e857)=>{var _0x244469=_0x2bd1c9;_0x364f82[_0x23e857][_0x244469(0x16e)]=Math[_0x244469(0x199)](_0x31766f);}),_0x105ca1[_0x2bd1c9(0x263)]((_0x2ba2e1,_0x39739a)=>{_0x364f82[_0x39739a]['delivery_date']=_0x2ba2e1;}),_0x5edd58['forEach']((_0x328696,_0x4fd449)=>{var _0x83a78f=_0x2bd1c9;_0x364f82[_0x4fd449][_0x83a78f(0x206)]=_0x328696;}),_0x4ac60e[_0x2bd1c9(0x263)]((_0x24829a,_0x3e1c6f)=>{var _0x481c2b=_0x2bd1c9;_0x364f82[_0x3e1c6f][_0x481c2b(0x1cb)]=_0x24829a;}),_0x430ab5[_0x2bd1c9(0x263)]((_0x3ac414,_0xffacfd)=>{var _0x532913=_0x2bd1c9;_0x364f82[_0xffacfd][_0x532913(0x1a5)]=_0x3ac414;}),_0x4e9974[_0x2bd1c9(0x263)]((_0x3641c6,_0x5ab4ba)=>{var _0x1bb825=_0x2bd1c9;_0x364f82[_0x5ab4ba][_0x1bb825(0x231)]=_0x3641c6;});var _0x2ff4f5=0x0;_0x364f82[_0x2bd1c9(0x263)](_0x3b3bc5=>{var _0x108e85=_0x2bd1c9;console[_0x108e85(0x18b)](_0x108e85(0x1aa),_0x3b3bc5),(parseInt(_0x3b3bc5[_0x108e85(0x227)])<parseInt(_0x3b3bc5['quantity'])||parseInt(_0x3b3bc5[_0x108e85(0x239)])==0x0)&&_0x2ff4f5++;});if(_0x2ff4f5!=0x0)return _0x18ac85[_0x2bd1c9(0x223)]('errors',_0x2bd1c9(0x18d)),_0x3a0d60[_0x2bd1c9(0x254)](_0x2bd1c9(0x1bd));const _0x5200e2=_0x364f82[_0x2bd1c9(0x1b5)](_0x120a27=>_0x120a27[_0x2bd1c9(0x239)]!=='0'&&_0x120a27['quantity']!=='');_0x54007f[_0x2bd1c9(0x278)]=_0x57d5ea,_0x54007f[_0x2bd1c9(0x25c)]=_0x2b79f2,_0x54007f[_0x2bd1c9(0x24a)]=_0x12ab9c,_0x54007f[_0x2bd1c9(0x169)]=_0x4914dd,_0x54007f[_0x2bd1c9(0x1dd)]=_0x5200e2,_0x54007f['note']=_0x4c15b1,_0x54007f[_0x2bd1c9(0x21d)]=_0x5e1f10,_0x54007f['finalize']=_0x2bd1c9(0x19b),_0x54007f[_0x2bd1c9(0x1db)]=_0x2bd1c9(0x19b);const _0x4ecccf=await _0x54007f[_0x2bd1c9(0x269)]();_0x18ac85[_0x2bd1c9(0x223)](_0x2bd1c9(0x26a),_0x2bd1c9(0x1ca)),_0x3a0d60[_0x2bd1c9(0x254)](_0x2bd1c9(0x179));}catch(_0x327c51){console[_0x2bd1c9(0x18b)](_0x327c51);}}),router[a0_0x539370(0x270)](a0_0x539370(0x19e),auth,async(_0x151e14,_0x4c628f)=>{var _0xd30286=a0_0x539370;try{const _0x56e828=_0x151e14[_0xd30286(0x222)]['id'],{invoice:_0xf1463a,customer:_0xb634a2,receivable_amount:_0x5ae1c6,received_amount:_0x527545}=_0x151e14[_0xd30286(0x248)],_0x302099=await sales['findById'](_0x56e828);console[_0xd30286(0x18b)](_0x302099);var _0x458110=_0x5ae1c6-_0x527545;console[_0xd30286(0x18b)](_0x527545),_0x302099[_0xd30286(0x19f)]=parseFloat(_0x527545)+parseFloat(_0x302099[_0xd30286(0x19f)]),_0x302099[_0xd30286(0x26e)]=_0x458110,console['log'](_0x302099);const _0x5c4bb6=await _0x302099[_0xd30286(0x269)](),_0x34c50b=await c_payment_data['findOne']({'invoice':_0xf1463a});_0x34c50b['amount']=_0x458110,await _0x34c50b[_0xd30286(0x269)]();let _0x8333d4=new Date(),_0x13db17=('0'+_0x8333d4[_0xd30286(0x26d)]())[_0xd30286(0x167)](-0x2),_0x12d023=('0'+(_0x8333d4[_0xd30286(0x25b)]()+0x1))['slice'](-0x2),_0x515d3e=_0x8333d4[_0xd30286(0x1ee)](),_0x5c378e=_0x515d3e+'-'+_0x12d023+'-'+_0x13db17;const _0xb43c2e=new customer_payment({'invoice':_0xf1463a,'date':_0x515d3e+'-'+_0x12d023+'-'+_0x13db17,'customer':_0xb634a2,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x527545}),_0x17e085=await _0xb43c2e[_0xd30286(0x269)]();_0x151e14['flash'](_0xd30286(0x26a),_0xd30286(0x1bf)),_0x4c628f['redirect'](_0xd30286(0x179));}catch(_0x44b3eb){console[_0xd30286(0x18b)](_0x44b3eb);}}),router['get'](a0_0x539370(0x191),auth,async(_0x1831d0,_0x651283)=>{var _0x5f0753=a0_0x539370;try{const {username:_0x1b3885,email:_0x5ecc54,role:_0x2c6f04}=_0x1831d0['user'],_0xbd4d2e=_0x1831d0['user'],_0x574f52=await profile[_0x5f0753(0x212)]({'email':_0xbd4d2e[_0x5f0753(0x1a8)]}),_0x8d96dc=await master_shop[_0x5f0753(0x1b3)]();console[_0x5f0753(0x18b)](_0x5f0753(0x218),_0x8d96dc);const _0x3aae5f=_0x1831d0[_0x5f0753(0x222)]['id'],_0x7a1c11=await sales[_0x5f0753(0x21a)](_0x3aae5f);console['log'](_0x7a1c11);const _0x44117b=await customer[_0x5f0753(0x212)]({'name':_0x7a1c11['customer']});console['log'](_0x44117b);if(_0x8d96dc[0x0][_0x5f0753(0x18f)]=='English\x20(US)'){var _0x308498=users['English'];console[_0x5f0753(0x18b)](_0x308498);}else{if(_0x8d96dc[0x0][_0x5f0753(0x18f)]==_0x5f0753(0x226))var _0x308498=users[_0x5f0753(0x226)];else{if(_0x8d96dc[0x0][_0x5f0753(0x18f)]==_0x5f0753(0x1e4))var _0x308498=users[_0x5f0753(0x1e4)];else{if(_0x8d96dc[0x0]['language']=='Spanish')var _0x308498=users[_0x5f0753(0x1af)];else{if(_0x8d96dc[0x0]['language']==_0x5f0753(0x1da))var _0x308498=users[_0x5f0753(0x1da)];else{if(_0x8d96dc[0x0][_0x5f0753(0x18f)]=='Portuguese\x20(BR)')var _0x308498=users[_0x5f0753(0x244)];else{if(_0x8d96dc[0x0][_0x5f0753(0x18f)]==_0x5f0753(0x22d))var _0x308498=users[_0x5f0753(0x22d)];else{if(_0x8d96dc[0x0][_0x5f0753(0x18f)]==_0x5f0753(0x217))var _0x308498=users[_0x5f0753(0x1ea)];}}}}}}}_0x651283['render'](_0x5f0753(0x1c9),{'success':_0x1831d0[_0x5f0753(0x223)](_0x5f0753(0x26a)),'errors':_0x1831d0[_0x5f0753(0x223)](_0x5f0753(0x235)),'role':_0xbd4d2e,'profile':_0x574f52,'master_shop':_0x8d96dc,'customers':_0x44117b,'sales':_0x7a1c11,'language':_0x308498});}catch(_0xd326ea){console[_0x5f0753(0x18b)](_0xd326ea);}}),router[a0_0x539370(0x24d)](a0_0x539370(0x18a),auth,async(_0x2f1506,_0x1f62b8)=>{var _0x1ba718=a0_0x539370;try{const {username:_0x4c5215,email:_0x43d002,role:_0x46f613}=_0x2f1506[_0x1ba718(0x220)],_0x5e2f38=_0x2f1506[_0x1ba718(0x220)],_0x28e144=await profile[_0x1ba718(0x212)]({'email':_0x5e2f38['email']}),_0x12376c=await master_shop[_0x1ba718(0x1b3)]();console[_0x1ba718(0x18b)](_0x1ba718(0x218),_0x12376c);const _0x3835bb=_0x2f1506[_0x1ba718(0x222)]['id'];console[_0x1ba718(0x18b)](_0x3835bb);const _0x23644f=await sales['findById'](_0x3835bb);console[_0x1ba718(0x18b)]('user_id',_0x23644f);const _0xc288c2=await warehouse['aggregate']([{'$match':{'name':_0x1ba718(0x207),'room':_0x1ba718(0x197)}},{'$unwind':_0x1ba718(0x233)},{'$group':{'_id':_0x1ba718(0x189),'name':{'$first':_0x1ba718(0x1b6)},'product_stock':{'$first':_0x1ba718(0x1c8)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x1ba718(0x20d)},'pallet':{'$first':_0x1ba718(0x1d2)},'primary_code':{'$first':_0x1ba718(0x1df)},'secondary_code':{'$first':_0x1ba718(0x25f)},'product_code':{'$first':_0x1ba718(0x175)}}}]);console[_0x1ba718(0x18b)]('stock_data',_0xc288c2);const _0x2c5a5d=await product[_0x1ba718(0x1b3)]({});warehouse_data=await warehouse[_0x1ba718(0x240)]([{'$match':{'status':_0x1ba718(0x216),'name':'Return\x20Goods','warehouse_category':_0x1ba718(0x273)}},{'$group':{'_id':'$name','name':{'$first':_0x1ba718(0x1b9)}}},{'$sort':{'name':0x1}}]);var _0x19ef52=[_0x1ba718(0x197)];if(_0x12376c[0x0][_0x1ba718(0x18f)]==_0x1ba718(0x184)){var _0x36aef5=users[_0x1ba718(0x1ce)];console[_0x1ba718(0x18b)](_0x36aef5);}else{if(_0x12376c[0x0][_0x1ba718(0x18f)]==_0x1ba718(0x226))var _0x36aef5=users[_0x1ba718(0x226)];else{if(_0x12376c[0x0][_0x1ba718(0x18f)]==_0x1ba718(0x1e4))var _0x36aef5=users[_0x1ba718(0x1e4)];else{if(_0x12376c[0x0]['language']==_0x1ba718(0x1af))var _0x36aef5=users[_0x1ba718(0x1af)];else{if(_0x12376c[0x0][_0x1ba718(0x18f)]=='French')var _0x36aef5=users[_0x1ba718(0x1da)];else{if(_0x12376c[0x0][_0x1ba718(0x18f)]==_0x1ba718(0x22e))var _0x36aef5=users['Portuguese'];else{if(_0x12376c[0x0][_0x1ba718(0x18f)]==_0x1ba718(0x22d))var _0x36aef5=users[_0x1ba718(0x22d)];else{if(_0x12376c[0x0][_0x1ba718(0x18f)]==_0x1ba718(0x217))var _0x36aef5=users[_0x1ba718(0x1ea)];}}}}}}}_0x1f62b8['render'](_0x1ba718(0x1dc),{'success':_0x2f1506[_0x1ba718(0x223)](_0x1ba718(0x26a)),'errors':_0x2f1506[_0x1ba718(0x223)]('errors'),'role':_0x5e2f38,'profile':_0x28e144,'user':_0x23644f,'stock':_0xc288c2,'master_shop':_0x12376c,'unit':_0x2c5a5d,'language':_0x36aef5,'warehouses':warehouse_data,'rooms':_0x19ef52});}catch(_0x4dfec4){console[_0x1ba718(0x18b)](_0x4dfec4),_0x1f62b8['status'](0xc8)[_0x1ba718(0x1fb)]({'message':_0x4dfec4[_0x1ba718(0x237)]});}}),router[a0_0x539370(0x270)](a0_0x539370(0x18a),auth,async(_0x486443,_0x4805d5)=>{var _0x226306=a0_0x539370;try{const {invoice:_0x25f85f,date:_0x7d869d,warehouse_name:_0x29d9de,product_name:_0x5d00ba,primary_code:_0x94815,secondary_code:_0x677593,product_code:_0x521f0c,sales_quantity:_0x233afd,stocks:_0x19aac7,return_qty:_0x595312,Room_name:_0x95d547,to_warehouse_name:_0x2697e1,to_Roomname:_0x19a41e,to_Room_name:_0xc769d2,note:_0x4d0621,level:_0x3ea7bd,isle:_0x351071,pallet:_0x25402e}=_0x486443['body'];if(typeof _0x5d00ba==_0x226306(0x1e3))var _0x5341bf=[_0x486443[_0x226306(0x248)]['product_name']],_0x5612a8=[_0x486443[_0x226306(0x248)][_0x226306(0x203)]],_0x13bdad=[_0x486443[_0x226306(0x248)][_0x226306(0x238)]],_0x49f67f=[_0x486443[_0x226306(0x248)][_0x226306(0x1f2)]],_0x4a3fa9=[_0x486443['body']['sales_quantity']],_0x1427e7=[_0x486443[_0x226306(0x248)][_0x226306(0x241)]],_0x4ccb3a=[_0x486443[_0x226306(0x248)]['return_qty']],_0x5c30f9=[_0x486443[_0x226306(0x248)][_0x226306(0x276)]],_0x2fe071=[_0x486443[_0x226306(0x248)][_0x226306(0x266)]],_0x2c80d4=[_0x486443[_0x226306(0x248)][_0x226306(0x20c)]],_0x23f412=[_0x486443[_0x226306(0x248)][_0x226306(0x18e)]];else var _0x5341bf=[..._0x486443[_0x226306(0x248)][_0x226306(0x1be)]],_0x5612a8=[..._0x486443[_0x226306(0x248)][_0x226306(0x203)]],_0x13bdad=[..._0x486443[_0x226306(0x248)]['secondary_code']],_0x49f67f=[..._0x486443[_0x226306(0x248)]['product_code']],_0x4a3fa9=[..._0x486443['body']['sales_quantity']],_0x1427e7=[..._0x486443[_0x226306(0x248)][_0x226306(0x241)]],_0x4ccb3a=[..._0x486443[_0x226306(0x248)][_0x226306(0x1e5)]],_0x5c30f9=[..._0x486443[_0x226306(0x248)][_0x226306(0x276)]],_0x2fe071=[..._0x486443[_0x226306(0x248)][_0x226306(0x266)]],_0x2c80d4=[..._0x486443[_0x226306(0x248)][_0x226306(0x20c)]],_0x23f412=[..._0x486443['body'][_0x226306(0x18e)]];const _0x18e8ca=_0x5341bf[_0x226306(0x1f9)](_0x236962=>{return _0x236962={'product_name':_0x236962};});_0x5612a8[_0x226306(0x263)]((_0x5ad4e0,_0x29b47a)=>{var _0x1edb06=_0x226306;_0x18e8ca[_0x29b47a][_0x1edb06(0x203)]=_0x5ad4e0;}),_0x13bdad['forEach']((_0xa577b8,_0x2986e0)=>{var _0x4ffa3d=_0x226306;_0x18e8ca[_0x2986e0][_0x4ffa3d(0x238)]=_0xa577b8;}),_0x49f67f[_0x226306(0x263)]((_0x195afb,_0x4e5fff)=>{var _0x348737=_0x226306;_0x18e8ca[_0x4e5fff][_0x348737(0x1f2)]=_0x195afb;}),_0x4a3fa9['forEach']((_0x47cb6d,_0xdb46f0)=>{var _0x28915e=_0x226306;_0x18e8ca[_0xdb46f0][_0x28915e(0x1c4)]=_0x47cb6d;}),_0x1427e7[_0x226306(0x263)]((_0x1134a3,_0x5ddd33)=>{var _0x9e063f=_0x226306;_0x18e8ca[_0x5ddd33][_0x9e063f(0x227)]=_0x1134a3;}),_0x4ccb3a[_0x226306(0x263)]((_0x696b62,_0x5afad1)=>{var _0x2d78ff=_0x226306;_0x18e8ca[_0x5afad1][_0x2d78ff(0x1e5)]=_0x696b62;}),_0x5c30f9[_0x226306(0x263)]((_0x57aef8,_0x4cc932)=>{var _0x38162e=_0x226306;_0x18e8ca[_0x4cc932][_0x38162e(0x276)]=_0x57aef8;}),_0x2fe071['forEach']((_0x349ad4,_0xd079ad)=>{_0x18e8ca[_0xd079ad]['bin']=_0x349ad4;}),_0x2c80d4[_0x226306(0x263)]((_0x10401e,_0x290d0d)=>{var _0x262c56=_0x226306;_0x18e8ca[_0x290d0d][_0x262c56(0x1f0)]=_0x10401e;}),_0x23f412['forEach']((_0x5a1df7,_0x139118)=>{_0x18e8ca[_0x139118]['floorlevel']=_0x5a1df7;});var _0x1e7769=0x0;_0x18e8ca[_0x226306(0x263)](_0x29f4be=>{var _0x57ead1=_0x226306;console[_0x57ead1(0x18b)](_0x57ead1(0x1aa),_0x29f4be),(parseInt(_0x29f4be[_0x57ead1(0x1c4)])<parseInt(_0x29f4be[_0x57ead1(0x1e5)])||parseInt(_0x29f4be[_0x57ead1(0x227)])<parseInt(_0x29f4be['return_qty'])&&parseInt(_0x29f4be['sale_qty'])>parseInt(_0x29f4be[_0x57ead1(0x1e5)])||parseInt(_0x29f4be[_0x57ead1(0x1e5)])==0x0)&&_0x1e7769++;});if(_0x1e7769!=0x0)return _0x486443[_0x226306(0x223)](_0x226306(0x235),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x4805d5[_0x226306(0x254)](_0x226306(0x1bd));const _0x221409=await sales['findOne']({'invoice':_0x25f85f});console[_0x226306(0x18b)](_0x221409),_0x221409[_0x226306(0x19d)]=_0x226306(0x17f);const _0x184864=await _0x221409['save'](),_0x56beec=new sales_return({'invoice':_0x25f85f,'customer':_0x486443[_0x226306(0x248)][_0x226306(0x25c)],'date':_0x7d869d,'warehouse_name':_0x29d9de,'room':_0x95d547,'ToWarehouse':_0x2697e1,'ToRoom':_0xc769d2,'return_sale':_0x18e8ca,'note':_0x4d0621}),_0x24cbe3=await _0x56beec[_0x226306(0x269)]();console[_0x226306(0x18b)](_0x56beec);const _0x350230=await sales_return[_0x226306(0x212)]({'invoice':_0x25f85f}),_0x3660ce=await warehouse[_0x226306(0x212)]({'name':_0x2697e1,'room':_0xc769d2});_0x350230[_0x226306(0x1dc)][_0x226306(0x263)](_0x725ab3=>{var _0x2f0d8e=_0x226306,_0xde0c16=0x0;const _0x59b39b=_0x3660ce[_0x2f0d8e(0x1c2)][_0x2f0d8e(0x1f9)](_0x3d8736=>{var _0x3c459b=_0x2f0d8e;_0x3d8736[_0x3c459b(0x1be)]==_0x725ab3[_0x3c459b(0x1be)]&&_0x3d8736[_0x3c459b(0x18e)]==_0x725ab3[_0x3c459b(0x18e)]&&_0x3d8736[_0x3c459b(0x1f0)]==_0x725ab3[_0x3c459b(0x1f0)]&&_0x3d8736[_0x3c459b(0x266)]==_0x725ab3[_0x3c459b(0x266)]&&_0x3d8736['bay']==_0x725ab3[_0x3c459b(0x276)]&&(_0x3d8736['product_stock']=parseInt(_0x3d8736[_0x3c459b(0x1fe)])+parseInt(_0x725ab3[_0x3c459b(0x1e5)]),_0xde0c16++);});_0xde0c16=='0'&&(_0x3660ce[_0x2f0d8e(0x1c2)]=_0x3660ce['product_details'][_0x2f0d8e(0x209)]({'product_name':_0x725ab3[_0x2f0d8e(0x1be)],'product_stock':_0x725ab3['return_qty'],'primary_code':_0x725ab3[_0x2f0d8e(0x203)],'secondary_code':_0x725ab3['secondary_code'],'product_code':_0x725ab3[_0x2f0d8e(0x1f2)],'bay':_0x725ab3[_0x2f0d8e(0x276)],'bin':_0x725ab3[_0x2f0d8e(0x266)],'type':_0x725ab3[_0x2f0d8e(0x1f0)],'floorlevel':_0x725ab3[_0x2f0d8e(0x18e)]})),console[_0x2f0d8e(0x18b)](_0x2f0d8e(0x1a3),_0x3660ce);}),await _0x3660ce['save'](),console[_0x226306(0x18b)](_0x486443[_0x226306(0x248)]);const _0x3bac12=new c_payment_data({'invoice':_0x25f85f,'customer':_0x486443['body'][_0x226306(0x25c)],'reason':_0x226306(0x21f)});await _0x3bac12[_0x226306(0x269)]();const _0x16a4a5=await master_shop['find']();console[_0x226306(0x18b)](_0x226306(0x210),_0x16a4a5[0x0][_0x226306(0x25e)]);const _0x44fbd2=await email_settings[_0x226306(0x212)](),_0x17ff80=await customer[_0x226306(0x212)]({'name':_0x486443['body'][_0x226306(0x25c)]});console[_0x226306(0x18b)](_0x226306(0x190),_0x17ff80);_0x16a4a5[0x0][_0x226306(0x271)]==0x1?(right_currency=_0x16a4a5[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x16a4a5[0x0][_0x226306(0x247)]);var _0x35b82a=_0x5341bf,_0x1f6295=_0x4ccb3a,_0xbe1695='',_0x4097b8;for(_0x4097b8 in _0x35b82a){_0xbe1695+=_0x226306(0x26c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x35b82a[_0x4097b8]+_0x226306(0x23e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f6295[_0x4097b8]+_0x226306(0x23e)+_0x226306(0x17a);}console[_0x226306(0x18b)]('product_list',_0xbe1695);let _0x2a5737=nodemailer[_0x226306(0x1e0)]({'service':_0x226306(0x1b8),'auth':{'user':_0x44fbd2['email'],'pass':_0x44fbd2['password']}}),_0x43dd89={'from':_0x44fbd2['email'],'to':_0x17ff80[_0x226306(0x1a8)],'subject':_0x226306(0x1a2),'attachments':[{'filename':_0x226306(0x1d7),'path':__dirname+_0x226306(0x249)+_0x226306(0x195)+_0x16a4a5[0x0][_0x226306(0x25e)],'cid':_0x226306(0x200)}],'html':_0x226306(0x243)+_0x226306(0x185)+'</head><body>'+_0x226306(0x24e)+_0x226306(0x1fa)+_0x226306(0x24e)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x226306(0x19c)+_0x226306(0x24e)+_0x226306(0x1e7)+_0x16a4a5[0x0]['site_title']+'\x20</h2>'+_0x226306(0x19c)+_0x226306(0x19c)+'<hr\x20class=\x22my-3\x22>'+_0x226306(0x24e)+_0x226306(0x25d)+_0x226306(0x208)+_0x25f85f+'\x20'+_0x226306(0x1d1)+_0x226306(0x256)+_0x7d869d+'\x20'+_0x226306(0x17d)+_0x226306(0x242)+_0x226306(0x19c)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x226306(0x174)+'<tr>'+_0x226306(0x16c)+_0x226306(0x26b)+_0x226306(0x260)+_0x226306(0x1ff)+'</tr>'+'</thead>'+_0x226306(0x183)+'\x20'+_0xbe1695+'\x20'+'</tbody>'+_0x226306(0x1cc)+_0x226306(0x24e)+_0x226306(0x1ef)+'<h5>'+_0x16a4a5[0x0]['site_title']+_0x226306(0x242)+'</div>'+_0x226306(0x19c)+_0x226306(0x16b)};_0x2a5737[_0x226306(0x262)](_0x43dd89,function(_0x3d4519,_0x516bc0){var _0x367fb8=_0x226306;_0x3d4519?(console[_0x367fb8(0x18b)](_0x3d4519),console[_0x367fb8(0x18b)](_0x367fb8(0x250))):console[_0x367fb8(0x18b)](_0x367fb8(0x173));}),_0x486443[_0x226306(0x223)](_0x226306(0x26a),_0x226306(0x229)),_0x4805d5[_0x226306(0x254)](_0x226306(0x179));}catch(_0x4a4287){console[_0x226306(0x18b)](_0x4a4287),_0x4805d5[_0x226306(0x1d4)](0xc8)[_0x226306(0x1fb)]({'message1':_0x4a4287['message']});}}),router[a0_0x539370(0x24d)](a0_0x539370(0x1fc),auth,async(_0x439cde,_0x240a90)=>{var _0x369890=a0_0x539370;try{const {username:_0x1bf3c3,email:_0xc9157b,role:_0x44f55c}=_0x439cde['user'],_0x435832=_0x439cde[_0x369890(0x220)],_0x46d122=await profile[_0x369890(0x212)]({'email':_0x435832[_0x369890(0x1a8)]}),_0xd691a2=await master_shop[_0x369890(0x1b3)]();console[_0x369890(0x18b)]('barcode\x20Product\x20master',_0xd691a2);const _0x23e731=_0x439cde['params']['id'],_0x27e0ed=await sales['findById'](_0x23e731);console[_0x369890(0x18b)](_0x369890(0x21e),_0x27e0ed);if(_0xd691a2[0x0]['language']==_0x369890(0x184))var _0x31f1eb=users['English'];else{if(_0xd691a2[0x0][_0x369890(0x18f)]==_0x369890(0x226))var _0x31f1eb=users['Hindi'];else{if(_0xd691a2[0x0][_0x369890(0x18f)]==_0x369890(0x1e4))var _0x31f1eb=users[_0x369890(0x1e4)];else{if(_0xd691a2[0x0][_0x369890(0x18f)]==_0x369890(0x1af))var _0x31f1eb=users['Spanish'];else{if(_0xd691a2[0x0][_0x369890(0x18f)]==_0x369890(0x1da))var _0x31f1eb=users[_0x369890(0x1da)];else{if(_0xd691a2[0x0][_0x369890(0x18f)]==_0x369890(0x22e))var _0x31f1eb=users[_0x369890(0x244)];else{if(_0xd691a2[0x0][_0x369890(0x18f)]=='Chinese')var _0x31f1eb=users['Chinese'];else{if(_0xd691a2[0x0]['language']==_0x369890(0x217))var _0x31f1eb=users[_0x369890(0x1ea)];}}}}}}}_0x240a90['render']('all_sales_barcode',{'success':_0x439cde[_0x369890(0x223)](_0x369890(0x26a)),'errors':_0x439cde['flash'](_0x369890(0x235)),'role':_0x435832,'profile':_0x46d122,'alldata':_0x27e0ed,'master_shop':_0xd691a2,'language':_0x31f1eb});}catch(_0x30dd8b){console['log'](_0x30dd8b);}}),router[a0_0x539370(0x270)](a0_0x539370(0x170),async(_0x48dc6e,_0x53cf1d)=>{var _0x5a909f=a0_0x539370;const {product_code:_0x2c3e2b,warehouse_name:_0x493f09,rooms_data:_0x5dab58,Roomslist:_0x35f869}=_0x48dc6e['body'],_0x3f386f=_0x35f869[_0x5a909f(0x274)](','),_0x300de4=[];async function _0xff8d80(_0x233f9f){var _0x32bef6=_0x5a909f;const _0x1ec12f=await warehouse[_0x32bef6(0x240)]([{'$match':{'name':_0x493f09,'room':_0x233f9f}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x2c3e2b}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x32bef6(0x1b6)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x32bef6(0x1df)},'secondary_code':{'$first':_0x32bef6(0x25f)},'product_code':{'$first':_0x32bef6(0x175)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x32bef6(0x186)},'type':{'$first':_0x32bef6(0x1c3)},'pallet':{'$first':_0x32bef6(0x272)},'unit':{'$first':_0x32bef6(0x261)},'secondary_unit':{'$first':_0x32bef6(0x22b)},'storage':{'$first':_0x32bef6(0x1ae)},'rack':{'$first':_0x32bef6(0x1d3)},'expiry_date':{'$first':_0x32bef6(0x1c6)},'production_date':{'$first':_0x32bef6(0x21c)},'maxPerUnit':{'$first':_0x32bef6(0x204)},'batch_code':{'$first':_0x32bef6(0x1c5)},'product_cat':{'$first':_0x32bef6(0x23f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x32bef6(0x181)},'invoice':{'$first':_0x32bef6(0x1f5)},'actual_qty':{'$first':_0x32bef6(0x26f)},'actual_uom':{'$first':_0x32bef6(0x192)}}}]),_0x3bc648=await warehouse[_0x32bef6(0x240)]([{'$match':{'name':_0x493f09,'room':_0x233f9f}},{'$unwind':_0x32bef6(0x233)},{'$match':{'product_details.secondary_code':_0x2c3e2b}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x32bef6(0x1b6)},'product_stock':{'$first':_0x32bef6(0x1c8)},'primary_code':{'$first':_0x32bef6(0x1df)},'secondary_code':{'$first':_0x32bef6(0x25f)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x32bef6(0x24f)},'isle':{'$first':_0x32bef6(0x186)},'type':{'$first':_0x32bef6(0x1c3)},'pallet':{'$first':_0x32bef6(0x272)},'unit':{'$first':_0x32bef6(0x261)},'secondary_unit':{'$first':_0x32bef6(0x22b)},'storage':{'$first':_0x32bef6(0x1ae)},'rack':{'$first':_0x32bef6(0x1d3)},'expiry_date':{'$first':_0x32bef6(0x1c6)},'production_date':{'$first':_0x32bef6(0x21c)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x32bef6(0x1c5)},'product_cat':{'$first':_0x32bef6(0x23f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x32bef6(0x181)},'invoice':{'$first':_0x32bef6(0x1f5)}}}]);if(_0x1ec12f[_0x32bef6(0x275)]>0x0)_0x300de4[_0x32bef6(0x267)](_0x1ec12f);else _0x3bc648[_0x32bef6(0x275)]>0x0&&_0x300de4[_0x32bef6(0x267)](_0x3bc648);}const _0x4c3a31=_0x3f386f[_0x5a909f(0x1f9)](_0x40923a=>_0xff8d80(_0x40923a));await Promise[_0x5a909f(0x1b2)](_0x4c3a31),_0x53cf1d[_0x5a909f(0x1fb)](_0x300de4);}),module[a0_0x539370(0x1a7)]=router;