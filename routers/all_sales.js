var a0_0x583c21=a0_0x4ffb;function a0_0x415d(){var _0xcccd91=['$product_details.secondary_code','customer','quantity_notConverted','116285GQlLsW','secondary_code','random','log','maxperunit','/invoice/:id','foreach\x20newproduct','push','Sales\x20Mail','stocks','$sale_product','sale_qty','flash','string','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_stock','46270PVNjnp','language','$product_details.invoice','json','/../public','Received\x20Payment\x20For\x20Sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<h2>\x20','/all_sales/view','delivery_code','logo','</head><body>','French','<tbody\x20style=\x22text-align:\x20center;\x22>','error','OUT-','findOne','map','sale_product','$product_details.expiry_date','$date','634164GjQFyZ','<html><head><title></title>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','return_sale','$product_details.type','product_name','warehouse_name','</body></html>','/preview/:id','nodemailer','/barcode_scanner','edit_sales','Sale\x20Return','toString','express','sendMail','delivery_date','unit','RMSEmail','300402iUrMnC','product_details','True','finalize','stock_data','<strong>\x20Regards\x20</strong>','$product_details.product_name','host','Ambient','False','floorlevel','invoice','Chinese','email','errors','getMonth','$sale_product.quantity','name','level','English\x20(US)','stock','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','expiry_date','room_name','/give_payment/:id','primary_unit','room','site_title','barcode\x20Product\x20master','image','types','max_per_unit','get','then','/view/:id','render','$product.product_name','bay','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Enclosed','forEach','$product_details.bin','49900JLCJAm','/all_sales/preview/','</tr>','$product_details.primary_code','$product_details.isle','$_id','status','sales_invoice','Sale\x20Return\x20Mail','Return\x20Goods','<span\x20style=\x22float:\x20right;\x22>','warehouse','$product_details.product_cat','exports','$product_details.product_code','Sales\x20Add\x20successfully','/view','$sale_product.bay','filter','$customer','<tr>','all_sales_barcode','/view/add_sales','/view/return_sales/:id','redirect','</thead>','carton','Level','$sale_product.type','return_qty','type','received_amount','</table>','primary_code','prod_code','</h5>','$product_details.rack','split','$name','payment\x20successfull','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Router','length','<div>','catch','product_data','add\x20post','port','purchases_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','secondary_unit','Raw\x20Materials','$product_details.pallet','$room','German','customer_data','currency_placement','Hindi','password','product_code','\x20</h2>','user','production_date','staff','../public/language/languages.json','/view/add_sale/product','all','$finalize','<h5>','$sale_product.floorlevel','date','Portuguese\x20(BR)','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','storage','$product_details','params','Arabic\x20(ae)','rack','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','1852630nQnCxk','<hr\x20class=\x22my-3\x22>','padStart','$product_details.unit','post','$product_details.floorlevel','sales\x20all_data','$product_details.bay','customers_docs','slice','find','\x20Order\x20Number\x20:\x20','return_data','aggregate','bin','Sales\x20Update\x20successfully','RoomAssigned','requested_qty','Enabled','customers','Error\x20Occurs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product','quantity','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','<!DOCTYPE\x20html>','role','Shelves','</td>','$product_details.storage','isAllowEdit','amount','$warehouse_name','/upload/','Portuguese','Spanish','product_stock','Receiving\x20Area','../middleware/auth','Return\x20Rooms','Floor','Logo.png','214417CXKriC','</div>','$note','English','add_sales','\x20Order\x20Date\x20:\x20','createTransport','SCRN','prod_cat','findById','message','$return_data','getFullYear','prod_invoice','$product_details._id','$product_details.batch_code','Arabic','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','floor','$product_details.secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','final','$customers_docs','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','product','Email\x20sent\x20successfully','$sale_product.bin','save','back'];a0_0x415d=function(){return _0xcccd91;};return a0_0x415d();}(function(_0x3b9737,_0x1b5c61){var _0x34b875=a0_0x4ffb,_0x42eec=_0x3b9737();while(!![]){try{var _0x49c64f=-parseInt(_0x34b875(0x18e))/0x1+-parseInt(_0x34b875(0x19e))/0x2+parseInt(_0x34b875(0x1c6))/0x3+-parseInt(_0x34b875(0x1f2))/0x4+parseInt(_0x34b875(0x143))/0x5+-parseInt(_0x34b875(0x1b3))/0x6+parseInt(_0x34b875(0x16d))/0x7;if(_0x49c64f===_0x1b5c61)break;else _0x42eec['push'](_0x42eec['shift']());}catch(_0x3fa429){_0x42eec['push'](_0x42eec['shift']());}}}(a0_0x415d,0x3b7f6));const express=require(a0_0x583c21(0x1c1)),app=express(),router=express[a0_0x583c21(0x11c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x583c21(0x169)),nodemailer=require(a0_0x583c21(0x1bc)),users=require(a0_0x583c21(0x133));router[a0_0x583c21(0x1e7)](a0_0x583c21(0x102),auth,async(_0x5999bb,_0x3e327c)=>{var _0x59efad=a0_0x583c21;try{const {username:_0x21e7ce,email:_0x1cd389,role:_0x4bb5e7}=_0x5999bb[_0x59efad(0x130)],_0x4e3599=_0x5999bb[_0x59efad(0x130)],_0x24710e=await profile[_0x59efad(0x1ae)]({'email':_0x4e3599[_0x59efad(0x1d3)]}),_0x397987=await master_shop[_0x59efad(0x14d)]();let _0x13d1ae;if(_0x4e3599[_0x59efad(0x15d)]==_0x59efad(0x132)){const _0xbb7038=await staff['findOne']({'email':_0x4e3599['email']});_0x13d1ae=await sales[_0x59efad(0x150)]([{'$lookup':{'from':_0x59efad(0x156),'localField':_0x59efad(0x18c),'foreignField':_0x59efad(0x1d7),'as':_0x59efad(0x14b)}},{'$unwind':_0x59efad(0x183)},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x59efad(0x105)},'date':{'$first':_0x59efad(0x1b2)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x59efad(0x16f)},'return_data':{'$first':_0x59efad(0x178)},'customers_docs':{'$first':_0x59efad(0x183)},'total_saleproduct_quantity':{'$sum':_0x59efad(0x1d6)},'level':{'$addToSet':_0x59efad(0x103)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x59efad(0x10e)},'pallet':{'$addToSet':_0x59efad(0x138)},'finalize':{'$first':_0x59efad(0x136)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x13d1ae=await sales[_0x59efad(0x150)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':'name','as':_0x59efad(0x14b)}},{'$unwind':_0x59efad(0x183)},{'$unwind':_0x59efad(0x198)},{'$group':{'_id':_0x59efad(0x1f7),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x59efad(0x105)},'date':{'$first':_0x59efad(0x1b2)},'warehouse_name':{'$first':_0x59efad(0x163)},'sale_product':{'$push':_0x59efad(0x198)},'note':{'$first':_0x59efad(0x16f)},'return_data':{'$first':_0x59efad(0x178)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x59efad(0x1d6)},'level':{'$addToSet':_0x59efad(0x103)},'isle':{'$addToSet':_0x59efad(0x188)},'type':{'$addToSet':_0x59efad(0x10e)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x59efad(0x136)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x59efad(0x191)](_0x59efad(0x149),_0x13d1ae);if(_0x397987[0x0][_0x59efad(0x19f)]=='English\x20(US)'){var _0xdc755e=users[_0x59efad(0x170)];console[_0x59efad(0x191)](_0xdc755e);}else{if(_0x397987[0x0][_0x59efad(0x19f)]==_0x59efad(0x12c))var _0xdc755e=users['Hindi'];else{if(_0x397987[0x0]['language']=='German')var _0xdc755e=users[_0x59efad(0x129)];else{if(_0x397987[0x0][_0x59efad(0x19f)]==_0x59efad(0x166))var _0xdc755e=users['Spanish'];else{if(_0x397987[0x0][_0x59efad(0x19f)]=='French')var _0xdc755e=users['French'];else{if(_0x397987[0x0][_0x59efad(0x19f)]=='Portuguese\x20(BR)')var _0xdc755e=users[_0x59efad(0x165)];else{if(_0x397987[0x0][_0x59efad(0x19f)]==_0x59efad(0x1d2))var _0xdc755e=users[_0x59efad(0x1d2)];else{if(_0x397987[0x0][_0x59efad(0x19f)]=='Arabic\x20(ae)')var _0xdc755e=users[_0x59efad(0x17d)];}}}}}}}_0x3e327c[_0x59efad(0x1ea)]('all_sales',{'success':_0x5999bb['flash'](_0x59efad(0x11a)),'errors':_0x5999bb[_0x59efad(0x19a)](_0x59efad(0x1d4)),'sales':_0x13d1ae,'profile':_0x24710e,'role':_0x4e3599,'master_shop':_0x397987,'language':_0xdc755e});}catch(_0x36fb94){console[_0x59efad(0x191)](_0x36fb94);}});function a0_0x4ffb(_0x32f6e8,_0x2aec31){var _0x415d1d=a0_0x415d();return a0_0x4ffb=function(_0x4ffb72,_0xb347fb){_0x4ffb72=_0x4ffb72-0xff;var _0x42af00=_0x415d1d[_0x4ffb72];return _0x42af00;},a0_0x4ffb(_0x32f6e8,_0x2aec31);}async function getRandom8DigitNumber(){var _0x103b4a=a0_0x583c21;const _0x2e532a=0x989680,_0x27c6c8=0x5f5e0ff,_0x257176=Math[_0x103b4a(0x17f)](Math[_0x103b4a(0x190)]()*(_0x27c6c8-_0x2e532a+0x1))+_0x2e532a;var _0x474bb2;const _0x5adcd7=await sales[_0x103b4a(0x1ae)]({'invoice':_0x103b4a(0x1ad)+_0x257176});return _0x5adcd7&&_0x5adcd7[_0x103b4a(0x11d)]>0x0?_0x474bb2='OUT-'+_0x257176:_0x474bb2='OUT-'+_0x257176,_0x474bb2;}router[a0_0x583c21(0x1e7)](a0_0x583c21(0x108),auth,async(_0x5d8cdb,_0x897a42)=>{var _0x3212e2=a0_0x583c21;try{const {username:_0x2159ce,email:_0x220217,role:_0x3177c7}=_0x5d8cdb[_0x3212e2(0x130)],_0x54f565=_0x5d8cdb['user'],_0x20d47e=await profile[_0x3212e2(0x1ae)]({'email':_0x54f565[_0x3212e2(0x1d3)]}),_0xd9c306=await master_shop[_0x3212e2(0x14d)](),_0x4f858a=await customer[_0x3212e2(0x14d)]({});let _0x35fcf2;if(_0x54f565[_0x3212e2(0x15d)]==_0x3212e2(0x132)){const _0x126f3a=await staff['findOne']({'email':_0x54f565[_0x3212e2(0x1d3)]});_0x35fcf2=await warehouse[_0x3212e2(0x150)]([{'$match':{'status':'Enabled','name':_0x126f3a[_0x3212e2(0x1fd)],'warehouse_category':_0x3212e2(0x126),'name':{'$ne':_0x3212e2(0x1fb)}}},{'$group':{'_id':'$name','name':{'$first':_0x3212e2(0x118)}}},{'$sort':{'name':0x1}}]);}else _0x35fcf2=await warehouse[_0x3212e2(0x150)]([{'$match':{'status':_0x3212e2(0x155),'warehouse_category':_0x3212e2(0x126),'name':{'$ne':_0x3212e2(0x1fb)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x40f42a=await product[_0x3212e2(0x14d)]({});var _0x176848=[_0x3212e2(0x1ce),'Enclosed'];const _0x14b0e5=await sales[_0x3212e2(0x14d)]({}),_0x20ba6d=_0x14b0e5['length']+0x1,_0x461418=_0x3212e2(0x1ad)+_0x20ba6d[_0x3212e2(0x1c0)]()[_0x3212e2(0x145)](0x5,'0');if(_0xd9c306[0x0][_0x3212e2(0x19f)]==_0x3212e2(0x1d9)){var _0x2ccf97=users['English'];console['log'](_0x2ccf97);}else{if(_0xd9c306[0x0]['language']=='Hindi')var _0x2ccf97=users['Hindi'];else{if(_0xd9c306[0x0][_0x3212e2(0x19f)]=='German')var _0x2ccf97=users['German'];else{if(_0xd9c306[0x0][_0x3212e2(0x19f)]==_0x3212e2(0x166))var _0x2ccf97=users[_0x3212e2(0x166)];else{if(_0xd9c306[0x0][_0x3212e2(0x19f)]=='French')var _0x2ccf97=users[_0x3212e2(0x1aa)];else{if(_0xd9c306[0x0][_0x3212e2(0x19f)]=='Portuguese\x20(BR)')var _0x2ccf97=users['Portuguese'];else{if(_0xd9c306[0x0][_0x3212e2(0x19f)]==_0x3212e2(0x1d2))var _0x2ccf97=users[_0x3212e2(0x1d2)];else{if(_0xd9c306[0x0][_0x3212e2(0x19f)]==_0x3212e2(0x13f))var _0x2ccf97=users['Arabic'];}}}}}}}const _0x8e1915=getRandom8DigitNumber();_0x8e1915[_0x3212e2(0x1e8)](_0x210067=>{var _0x2ad64b=_0x3212e2;_0x897a42[_0x2ad64b(0x1ea)](_0x2ad64b(0x171),{'success':_0x5d8cdb[_0x2ad64b(0x19a)]('success'),'errors':_0x5d8cdb[_0x2ad64b(0x19a)](_0x2ad64b(0x1d4)),'role':_0x54f565,'profile':_0x20d47e,'customer':_0x4f858a,'warehouse':_0x35fcf2,'product':_0x40f42a,'invoice':_0x210067,'master_shop':_0xd9c306,'language':_0x2ccf97,'rooms_data':_0x176848});})[_0x3212e2(0x11f)](_0x34c651=>{var _0xd0b6d1=_0x3212e2;_0x5d8cdb[_0xd0b6d1(0x19a)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x897a42[_0xd0b6d1(0x10a)](_0xd0b6d1(0x1a6));});}catch(_0x2baed0){console[_0x3212e2(0x191)](_0x2baed0);}}),router[a0_0x583c21(0x1e7)]('/view/add_sales/:id',auth,async(_0x3c970a,_0x559fad)=>{var _0x180d51=a0_0x583c21;try{const _0x436b6d=_0x3c970a[_0x180d51(0x13e)]['id'];console[_0x180d51(0x191)](_0x436b6d);const _0x5eed39=await product[_0x180d51(0x14d)](),_0x52b42d=await purchases[_0x180d51(0x150)]([{'$match':{'warehouse_name':_0x436b6d}},{'$unwind':_0x180d51(0x159)},{'$group':{'_id':_0x180d51(0x1eb)}}]);console[_0x180d51(0x191)](_0x180d51(0x123),_0x52b42d),_0x559fad[_0x180d51(0x1f8)](0xc8)['json']({'purchases_data':_0x52b42d,'product_data':_0x5eed39});}catch(_0x18a8e1){console[_0x180d51(0x191)](_0x18a8e1);}}),router['post'](a0_0x583c21(0x134),auth,async(_0x2ef927,_0x27abdb)=>{var _0x5a2b48=a0_0x583c21;try{const {warehouse_data:_0x4d0de1,product_data:_0x175632}=_0x2ef927[_0x5a2b48(0x1ed)];console[_0x5a2b48(0x191)](_0x2ef927[_0x5a2b48(0x1ed)][_0x5a2b48(0x120)]);;const _0x51945f=await master_shop[_0x5a2b48(0x14d)]();console['log'](_0x5a2b48(0x141),_0x51945f);const _0x349e74=await product[_0x5a2b48(0x1ae)]({'name':_0x175632});console[_0x5a2b48(0x191)](_0x5a2b48(0x186),_0x349e74);const _0x15a65d=await warehouse[_0x5a2b48(0x150)]([{'$match':{'name':_0x4d0de1}},{'$unwind':_0x5a2b48(0x13d)},{'$match':{'product_details.product_name':_0x175632}},{'$group':{'_id':_0x5a2b48(0x1cc),'product_stock':{'$first':'$product_details.product_stock'}}}]);console['log'](_0x5a2b48(0x1ca),_0x15a65d),_0x27abdb[_0x5a2b48(0x1f8)](0xc8)[_0x5a2b48(0x1a1)]({'master':_0x51945f,'new_product':_0x349e74,'stock_data':_0x15a65d});}catch(_0x445c6e){console[_0x5a2b48(0x191)](_0x445c6e);}}),router[a0_0x583c21(0x147)](a0_0x583c21(0x108),auth,async(_0x4a15ac,_0xdefc7c)=>{var _0x33ded9=a0_0x583c21;try{const {invoice:_0x352925,date:_0x5ad46c,warehouse_name:_0x441943,product_name:_0x447d9b,stock:_0x35c964,quantity:_0x42a156,note:_0x1b7a39,room:_0x1a33be,primary_code:_0x2aef53,secondary_code:_0x4aa219,prod_code:_0x58b6ab,level:_0x2a3f4b,isle:_0x696192,pallet:_0x5cb179,batch_code:_0x214977,SCRN:_0x5c8597,expiry_date:_0x3baa64}=_0x4a15ac[_0x33ded9(0x1ed)];if(typeof _0x447d9b=='string')var _0x1deea7=[_0x4a15ac[_0x33ded9(0x1ed)]['product_name']],_0x2a6bba=[_0x4a15ac[_0x33ded9(0x1ed)]['stock']],_0x5a3715=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x10c)]],_0x57e493=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x113)]],_0x2391a8=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x18f)]],_0x5cc710=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x114)]],_0x2e3017=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x1d8)]],_0x564e47=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x1e0)]],_0x2aec73=[_0x4a15ac['body'][_0x33ded9(0x125)]],_0x5516f2=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x1db)]],_0x1e8404=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x1dd)]],_0x2b987d=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x1e6)]],_0x1c64e0=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x131)]],_0x4ad3d3=[_0x4a15ac[_0x33ded9(0x1ed)]['requested_qty']],_0x554278=[_0x4a15ac[_0x33ded9(0x1ed)]['delivery_date']],_0x53ec2d=[_0x4a15ac[_0x33ded9(0x1ed)]['delivery_code']],_0x337855=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x175)]],_0x1938cb=[_0x4a15ac[_0x33ded9(0x1ed)]['quantity']],_0xfa18ee=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x153)]],_0x4da140=[_0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x17a)]];else var _0x1deea7=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x1b8)]],_0x2a6bba=[..._0x4a15ac['body'][_0x33ded9(0x1da)]],_0x5a3715=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x10c)]],_0x57e493=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x113)]],_0x2391a8=[..._0x4a15ac[_0x33ded9(0x1ed)]['secondary_code']],_0x5cc710=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x114)]],_0x2e3017=[..._0x4a15ac[_0x33ded9(0x1ed)]['level']],_0x564e47=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x1e0)]],_0x2aec73=[..._0x4a15ac[_0x33ded9(0x1ed)]['secondary_unit']],_0x5516f2=[..._0x4a15ac[_0x33ded9(0x1ed)]['batch_code']],_0x1e8404=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x1dd)]],_0x2b987d=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x1e6)]],_0x1c64e0=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x131)]],_0x4ad3d3=[..._0x4a15ac[_0x33ded9(0x1ed)]['requested_qty']],_0x554278=[..._0x4a15ac[_0x33ded9(0x1ed)]['delivery_date']],_0x53ec2d=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x1a7)]],_0x337855=[..._0x4a15ac[_0x33ded9(0x1ed)]['prod_cat']],_0x1938cb=[..._0x4a15ac[_0x33ded9(0x1ed)]['quantity']],_0xfa18ee=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x153)]],_0x4da140=[..._0x4a15ac[_0x33ded9(0x1ed)][_0x33ded9(0x17a)]];const _0x4206b8=_0x1deea7['map'](_0x29c2bb=>{return _0x29c2bb={'product_name':_0x29c2bb};});_0x2a6bba[_0x33ded9(0x1f0)]((_0x1f721d,_0xe7702a)=>{var _0x2f27a9=_0x33ded9;_0x4206b8[_0xe7702a][_0x2f27a9(0x1da)]=_0x1f721d;}),_0x5a3715[_0x33ded9(0x1f0)]((_0x3232d0,_0x4f2476)=>{_0x4206b8[_0x4f2476]['quantity']=_0x3232d0;}),_0x57e493[_0x33ded9(0x1f0)]((_0x2a3294,_0x3cc98f)=>{_0x4206b8[_0x3cc98f]['primary_code']=_0x2a3294;}),_0x2391a8[_0x33ded9(0x1f0)]((_0x307721,_0x584fd7)=>{var _0x25d670=_0x33ded9;_0x4206b8[_0x584fd7][_0x25d670(0x18f)]=_0x307721;}),_0x5cc710[_0x33ded9(0x1f0)]((_0x1922ea,_0x5d23dd)=>{var _0x17e79e=_0x33ded9;_0x4206b8[_0x5d23dd][_0x17e79e(0x12e)]=_0x1922ea;}),_0x2e3017['forEach']((_0x38713c,_0x208c2f)=>{var _0x58c864=_0x33ded9;_0xfa18ee[_0x58c864(0x1f0)]((_0x464223,_0x56eaf0)=>{var _0x4a777c=_0x58c864;if(_0x464223==_0x4a777c(0x168)&&_0x208c2f==_0x56eaf0){var _0xf36523=_0x38713c[_0x4a777c(0x14c)](0x3);_0x4206b8[_0x208c2f][_0x4a777c(0x13c)]=_0x38713c[0x0],_0x4206b8[_0x208c2f][_0x4a777c(0x140)]=_0x38713c[0x1],_0x4206b8[_0x208c2f]['bay']=0x0,_0x4206b8[_0x208c2f][_0x4a777c(0x151)]=0x0,_0x4206b8[_0x208c2f][_0x4a777c(0x110)]=_0x4a777c(0x16b),_0x4206b8[_0x208c2f][_0x4a777c(0x1d0)]=_0xf36523;}else{if(_0x464223==_0x4a777c(0x15e)&&_0x208c2f==_0x56eaf0){var _0xf36523=_0x38713c['slice'](0x3);_0x4206b8[_0x208c2f]['storage']=_0x38713c[0x0],_0x4206b8[_0x208c2f]['rack']=_0x38713c[0x1],_0x4206b8[_0x208c2f][_0x4a777c(0x1ec)]=0x0,_0x4206b8[_0x208c2f][_0x4a777c(0x151)]=0x0,_0x4206b8[_0x208c2f]['type']=_0x4a777c(0x16b),_0x4206b8[_0x208c2f][_0x4a777c(0x1d0)]=_0x38713c[0x5];}else{if(_0x208c2f==_0x56eaf0){var _0x1477b8;if(_0x38713c[0x4]=='L')_0x1477b8=_0x4a777c(0x10d);else _0x38713c[0x4]=='F'&&(_0x1477b8=_0x4a777c(0x16b));_0x4206b8[_0x208c2f][_0x4a777c(0x13c)]=_0x38713c[0x0],_0x4206b8[_0x208c2f]['rack']=_0x38713c[0x1],_0x4206b8[_0x208c2f][_0x4a777c(0x1ec)]=_0x38713c[0x2],_0x4206b8[_0x208c2f][_0x4a777c(0x151)]=_0x38713c[0x3],_0x4206b8[_0x208c2f][_0x4a777c(0x110)]=_0x1477b8,_0x4206b8[_0x208c2f][_0x4a777c(0x1d0)]=_0x38713c[0x5];}}}});}),_0x564e47[_0x33ded9(0x1f0)]((_0x5ca56d,_0x28bd39)=>{_0x4206b8[_0x28bd39]['unit']=_0x5ca56d;}),_0x2aec73[_0x33ded9(0x1f0)]((_0xe07bb4,_0x3ea5b7)=>{var _0x461785=_0x33ded9;_0x4206b8[_0x3ea5b7][_0x461785(0x125)]=_0xe07bb4;}),_0x5516f2[_0x33ded9(0x1f0)]((_0x3e5862,_0x3de778)=>{var _0x4f12ca=_0x33ded9;_0x4206b8[_0x3de778][_0x4f12ca(0x1db)]=_0x3e5862;}),_0x1e8404['forEach']((_0x469fc9,_0xad8b1d)=>{var _0xe0d701=_0x33ded9;_0x4206b8[_0xad8b1d][_0xe0d701(0x1dd)]=_0x469fc9;}),_0x2b987d[_0x33ded9(0x1f0)]((_0x3dd00b,_0x4fa8a9)=>{_0x4206b8[_0x4fa8a9]['maxperunit']=_0x3dd00b;}),_0x1c64e0[_0x33ded9(0x1f0)]((_0x5b7613,_0x4f84ba)=>{var _0x2c42a3=_0x33ded9;_0x4206b8[_0x4f84ba][_0x2c42a3(0x131)]=_0x5b7613;}),_0x4ad3d3['forEach']((_0x24b2aa,_0x37e571)=>{var _0x5a56fa=_0x33ded9;_0x4206b8[_0x37e571][_0x5a56fa(0x154)]=_0x24b2aa;}),_0x554278[_0x33ded9(0x1f0)]((_0x4093e2,_0x5dcbca)=>{_0x4206b8[_0x5dcbca]['delivery_date']=_0x4093e2;}),_0x53ec2d['forEach']((_0x43239d,_0x53abaf)=>{var _0x114637=_0x33ded9;_0x4206b8[_0x53abaf][_0x114637(0x1a7)]=_0x43239d;}),_0x337855[_0x33ded9(0x1f0)]((_0x1ed978,_0x13f689)=>{_0x4206b8[_0x13f689]['prod_cat']=_0x1ed978;}),_0x1938cb[_0x33ded9(0x1f0)]((_0x1455db,_0x315d98)=>{var _0x39bb88=_0x33ded9;_0x4206b8[_0x315d98][_0x39bb88(0x18d)]=_0x1455db;}),_0xfa18ee[_0x33ded9(0x1f0)]((_0x2ed6db,_0x596aa8)=>{var _0x273f8f=_0x33ded9;_0x4206b8[_0x596aa8][_0x273f8f(0x1de)]=_0x2ed6db;}),_0x4da140[_0x33ded9(0x1f0)]((_0x5b51d8,_0x2bf21e)=>{var _0x14e90d=_0x33ded9;_0x4206b8[_0x2bf21e][_0x14e90d(0x1d1)]=_0x5b51d8;});var _0x30a598=0x0;_0x4206b8[_0x33ded9(0x1f0)](_0x4dbeeb=>{var _0x5e887d=_0x33ded9;(_0x4dbeeb[_0x5e887d(0x1da)]<_0x4dbeeb[_0x5e887d(0x18d)]||_0x4dbeeb[_0x5e887d(0x18d)]==0x0)&&(console[_0x5e887d(0x191)]('foreach\x20newproduct',_0x4dbeeb),_0x30a598++);});const _0x4b084a=_0x4206b8[_0x33ded9(0x104)](_0x4030c2=>_0x4030c2[_0x33ded9(0x15a)]!=='0'&&_0x4030c2[_0x33ded9(0x15a)]!==''),_0x2f2605=new sales({'invoice':_0x352925,'customer':_0x4a15ac['body'][_0x33ded9(0x18c)],'date':_0x5ad46c,'warehouse_name':_0x441943,'sale_product':_0x4b084a,'note':_0x1b7a39,'room':_0x1a33be,'primary_code':_0x2aef53,'secondary_code':_0x4aa219,'prod_code':_0x58b6ab,'SCRN':_0x5c8597}),_0x45542b=await _0x2f2605['save']();_0x4a15ac[_0x33ded9(0x19a)](_0x33ded9(0x11a),_0x33ded9(0x101)),_0xdefc7c[_0x33ded9(0x10a)](_0x33ded9(0x1f3)+_0x45542b['_id']);}catch(_0x3e17b){console[_0x33ded9(0x191)](_0x3e17b);}}),router[a0_0x583c21(0x1e7)]('/preview/:id',auth,async(_0x3750e4,_0x1d0720)=>{var _0x3dab18=a0_0x583c21;try{const {username:_0x48d20c,email:_0x3997d8,role:_0x1a3d1a}=_0x3750e4[_0x3dab18(0x130)],_0x21f204=_0x3750e4[_0x3dab18(0x130)],_0x45fba7=await profile['findOne']({'email':_0x21f204[_0x3dab18(0x1d3)]}),_0x1f6910=await master_shop[_0x3dab18(0x14d)](),_0x18690a=_0x3750e4[_0x3dab18(0x13e)]['id'],_0x49c7e3=await sales[_0x3dab18(0x176)](_0x18690a),_0x384ab1=await warehouse[_0x3dab18(0x150)]([{'$match':{'name':_0x49c7e3[_0x3dab18(0x1b9)]}},{'$unwind':_0x3dab18(0x13d)},{'$group':{'_id':_0x3dab18(0x17b),'name':{'$first':_0x3dab18(0x1cc)},'product_stock':{'$first':_0x3dab18(0x19d)},'bay':{'$first':_0x3dab18(0x14a)},'bin':{'$first':_0x3dab18(0x1f1)},'type':{'$first':_0x3dab18(0x1b7)},'floorlevel':{'$first':_0x3dab18(0x148)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3dab18(0x18b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3dab18(0x160)},'rack':{'$first':_0x3dab18(0x116)},'expiry_date':{'$first':_0x3dab18(0x1b1)},'production_date':{'$first':'$product_details.production_date'}}}]),_0x1a63d3=await customer[_0x3dab18(0x14d)]({});let _0xf2f574;if(_0x21f204[_0x3dab18(0x15d)]==_0x3dab18(0x132)){const _0x9096b5=await staff['findOne']({'email':_0x21f204[_0x3dab18(0x1d3)]});_0xf2f574=await warehouse[_0x3dab18(0x150)]([{'$match':{'status':_0x3dab18(0x155),'name':_0x9096b5['warehouse']}},{'$group':{'_id':_0x3dab18(0x118),'name':{'$first':'$name'}}}]);}else _0xf2f574=await warehouse[_0x3dab18(0x150)]([{'$match':{'status':_0x3dab18(0x155)}},{'$group':{'_id':_0x3dab18(0x118),'name':{'$first':'$name'}}}]);const _0x1076c1=await product['find']({}),_0x4d06b7=await suppliers[_0x3dab18(0x14d)]({});if(_0x1f6910[0x0][_0x3dab18(0x19f)]=='English\x20(US)'){var _0x410044=users[_0x3dab18(0x170)];console['log'](_0x410044);}else{if(_0x1f6910[0x0][_0x3dab18(0x19f)]==_0x3dab18(0x12c))var _0x410044=users[_0x3dab18(0x12c)];else{if(_0x1f6910[0x0][_0x3dab18(0x19f)]==_0x3dab18(0x129))var _0x410044=users['German'];else{if(_0x1f6910[0x0][_0x3dab18(0x19f)]==_0x3dab18(0x166))var _0x410044=users[_0x3dab18(0x166)];else{if(_0x1f6910[0x0][_0x3dab18(0x19f)]==_0x3dab18(0x1aa))var _0x410044=users[_0x3dab18(0x1aa)];else{if(_0x1f6910[0x0][_0x3dab18(0x19f)]==_0x3dab18(0x13a))var _0x410044=users[_0x3dab18(0x165)];else{if(_0x1f6910[0x0][_0x3dab18(0x19f)]==_0x3dab18(0x1d2))var _0x410044=users[_0x3dab18(0x1d2)];else{if(_0x1f6910[0x0][_0x3dab18(0x19f)]==_0x3dab18(0x13f))var _0x410044=users['Arabic'];}}}}}}}_0x1d0720[_0x3dab18(0x1ea)]('edit_sales_view',{'success':_0x3750e4['flash'](_0x3dab18(0x11a)),'errors':_0x3750e4[_0x3dab18(0x19a)](_0x3dab18(0x1d4)),'role':_0x21f204,'profile':_0x45fba7,'customer':_0x1a63d3,'warehouse':_0xf2f574,'product':_0x384ab1,'user':_0x49c7e3,'master_shop':_0x1f6910,'unit':_0x1076c1,'language':_0x410044,'suppliers':_0x4d06b7});}catch(_0x140256){console['log'](_0x140256);}}),router['post'](a0_0x583c21(0x1bb),auth,async(_0x30330c,_0x5a7c02)=>{var _0x1f01f0=a0_0x583c21;try{const _0x57399a=_0x30330c[_0x1f01f0(0x13e)]['id'],{invoice:_0x30e060,warehouse_name:_0x448a0e,room:_0xb157d3}=_0x30330c[_0x1f01f0(0x1ed)],_0x3adef9=await sales['findOne']({'invoice':_0x30e060}),_0x205081=_0x3adef9[_0x1f01f0(0x1b0)][_0x1f01f0(0x1af)](async _0x4e5374=>{var _0x581f3e=_0x1f01f0,_0x307868=await warehouse[_0x581f3e(0x1ae)]({'name':_0x448a0e,'room':_0x4e5374[_0x581f3e(0x1de)],'warehouse_category':_0x581f3e(0x126)});const _0x207859=_0x307868[_0x581f3e(0x1c7)]['map'](_0x4db319=>{var _0x1bbd1b=_0x581f3e;_0x4db319[_0x1bbd1b(0x1b8)]==_0x4e5374['product_name']&&_0x4db319['floorlevel']==_0x4e5374[_0x1bbd1b(0x1d0)]&&_0x4db319[_0x1bbd1b(0x110)]==_0x4e5374[_0x1bbd1b(0x110)]&&_0x4db319[_0x1bbd1b(0x151)]==_0x4e5374['bin']&&_0x4db319[_0x1bbd1b(0x1ec)]==_0x4e5374[_0x1bbd1b(0x1ec)]&&_0x4db319[_0x1bbd1b(0x140)]==_0x4e5374[_0x1bbd1b(0x140)]&&_0x4db319[_0x1bbd1b(0x13c)]==_0x4e5374['storage']&&_0x4db319[_0x1bbd1b(0x1dd)]==_0x4e5374[_0x1bbd1b(0x1dd)]&&_0x4db319[_0x1bbd1b(0x1db)]==_0x4e5374[_0x1bbd1b(0x1db)]&&_0x4db319[_0x1bbd1b(0x1d1)]==_0x4e5374[_0x1bbd1b(0x1d1)]&&(_0x4db319['product_stock']=_0x4db319[_0x1bbd1b(0x167)]-_0x4e5374[_0x1bbd1b(0x15a)]);});return _0x307868;});Promise[_0x1f01f0(0x135)](_0x205081)[_0x1f01f0(0x1e8)](async _0x2ae07c=>{var _0x274907=_0x1f01f0;try{for(const _0x29892e of _0x2ae07c){await _0x29892e[_0x274907(0x189)]();}_0x3adef9[_0x274907(0x1c9)]=_0x274907(0x1c8);const _0x32f7c3=await _0x3adef9[_0x274907(0x189)](),_0x2f25e=await master_shop[_0x274907(0x14d)](),_0x3dc7f4=await email_settings[_0x274907(0x1ae)](),_0x369666=await supervisor_settings[_0x274907(0x14d)]();var _0x44c6be=_0x3adef9[_0x274907(0x1b0)],_0x1c7f3c='',_0x37bf0d;for(_0x37bf0d in _0x44c6be){_0x1c7f3c+='<tr>'+_0x274907(0x19c)+_0x44c6be[_0x37bf0d][_0x274907(0x1b8)]+_0x274907(0x15f)+_0x274907(0x19c)+_0x44c6be[_0x37bf0d][_0x274907(0x12e)]+_0x274907(0x15f)+_0x274907(0x19c)+_0x44c6be[_0x37bf0d]['quantity']+_0x274907(0x15f)+_0x274907(0x19c)+_0x44c6be[_0x37bf0d][_0x274907(0x1c4)]+_0x274907(0x15f)+_0x274907(0x19c)+_0x44c6be[_0x37bf0d][_0x274907(0x125)]+'</td>'+_0x274907(0x19c)+_0x3adef9[_0x274907(0x1b9)]+'</td>'+_0x274907(0x19c)+_0x44c6be[_0x37bf0d][_0x274907(0x1de)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x44c6be[_0x37bf0d][_0x274907(0x13c)]+_0x44c6be[_0x37bf0d]['rack']+_0x44c6be[_0x37bf0d][_0x274907(0x1ec)]+_0x44c6be[_0x37bf0d][_0x274907(0x151)]+_0x44c6be[_0x37bf0d][_0x274907(0x110)][0x0]+_0x44c6be[_0x37bf0d][_0x274907(0x1d0)]+_0x274907(0x15f),_0x274907(0x1f4);}let _0x16dc60=nodemailer[_0x274907(0x173)]({'host':_0x3dc7f4[_0x274907(0x1cd)],'port':Number(_0x3dc7f4[_0x274907(0x122)]),'secure':![],'auth':{'user':_0x3dc7f4[_0x274907(0x1d3)],'pass':_0x3dc7f4[_0x274907(0x12d)]}}),_0x7eb391={'from':_0x3dc7f4['email'],'to':_0x369666[0x0][_0x274907(0x1c5)],'subject':_0x274907(0x196),'attachments':[{'filename':_0x274907(0x16c),'path':__dirname+_0x274907(0x1a2)+_0x274907(0x164)+_0x2f25e[0x0][_0x274907(0x1e4)],'cid':'logo'}],'html':_0x274907(0x15c)+_0x274907(0x1b4)+_0x274907(0x1a9)+_0x274907(0x11e)+_0x274907(0x184)+_0x274907(0x11e)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x274907(0x16e)+'<div>'+_0x274907(0x1a5)+_0x2f25e[0x0][_0x274907(0x1e2)]+_0x274907(0x12f)+_0x274907(0x16e)+_0x274907(0x16e)+_0x274907(0x144)+_0x274907(0x11e)+_0x274907(0x185)+_0x274907(0x14e)+_0x3adef9[_0x274907(0x1d1)]+'\x20'+_0x274907(0x1fc)+_0x274907(0x172)+_0x3adef9[_0x274907(0x139)]+'\x20'+'</span>'+_0x274907(0x115)+_0x274907(0x16e)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x274907(0x158)+_0x274907(0x106)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x274907(0x11b)+_0x274907(0x1b5)+_0x274907(0x1a4)+_0x274907(0x142)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x274907(0x124)+'</tr>'+_0x274907(0x10b)+_0x274907(0x1ab)+'\x20'+_0x1c7f3c+'\x20'+'</tbody>'+_0x274907(0x112)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x274907(0x137)+_0x2f25e[0x0]['site_title']+_0x274907(0x115)+'</div>'+'</div>'+_0x274907(0x1ba)};_0x16dc60[_0x274907(0x1c2)](_0x7eb391,function(_0x46a3e2,_0x4c4e21){var _0x138046=_0x274907;_0x46a3e2?(console[_0x138046(0x191)](_0x46a3e2),console[_0x138046(0x191)]('Error\x20Occurs')):console[_0x138046(0x191)](_0x138046(0x187));}),_0x30330c['flash'](_0x274907(0x11a),'Sales\x20Update\x20successfully'),_0x5a7c02['redirect'](_0x274907(0x1f3)+_0x57399a);}catch(_0x2beb44){console[_0x274907(0x1ac)](_0x2beb44),_0x5a7c02['status'](0x1f4)[_0x274907(0x1a1)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x1a930d=>{var _0x300e87=_0x1f01f0;console[_0x300e87(0x1ac)](_0x1a930d),_0x5a7c02[_0x300e87(0x1f8)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x20781f){console[_0x1f01f0(0x191)](_0x20781f);}}),router['get'](a0_0x583c21(0x1e9),auth,async(_0x351b5c,_0x5a9796)=>{var _0x1ee11c=a0_0x583c21;try{const {username:_0x453665,email:_0x1c1fc7,role:_0x449374}=_0x351b5c[_0x1ee11c(0x130)],_0x16da52=_0x351b5c[_0x1ee11c(0x130)],_0x10162e=await profile[_0x1ee11c(0x1ae)]({'email':_0x16da52[_0x1ee11c(0x1d3)]}),_0x311d29=await master_shop[_0x1ee11c(0x14d)](),_0x43b527=_0x351b5c[_0x1ee11c(0x13e)]['id'],_0x2487a8=await sales[_0x1ee11c(0x176)](_0x43b527);var _0x305291=[_0x1ee11c(0x1ce),_0x1ee11c(0x1ef)];const _0x24db2a=await warehouse[_0x1ee11c(0x150)]([{'$match':{'name':_0x2487a8['warehouse_name'],'warehouse_category':_0x1ee11c(0x126)}},{'$unwind':_0x1ee11c(0x13d)},{'$group':{'_id':_0x1ee11c(0x17b),'name':{'$first':_0x1ee11c(0x1cc)},'product_stock':{'$first':_0x1ee11c(0x19d)},'bay':{'$first':_0x1ee11c(0x14a)},'bin':{'$first':_0x1ee11c(0x1f1)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1ee11c(0x148)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1ee11c(0x100)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]),_0xa87e0c=await customer[_0x1ee11c(0x14d)]({});let _0x1f98dd;if(_0x16da52[_0x1ee11c(0x15d)]==_0x1ee11c(0x132)){const _0x324470=await staff[_0x1ee11c(0x1ae)]({'email':_0x16da52[_0x1ee11c(0x1d3)]});_0x1f98dd=await warehouse[_0x1ee11c(0x150)]([{'$match':{'status':_0x1ee11c(0x155),'name':_0x324470['warehouse'],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x1ee11c(0x118)}}}]);}else _0x1f98dd=await warehouse[_0x1ee11c(0x150)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x1ee11c(0x118),'name':{'$first':_0x1ee11c(0x118)}}}]);const _0x43685e=await product[_0x1ee11c(0x14d)]({});if(_0x311d29[0x0]['language']==_0x1ee11c(0x1d9)){var _0x24b81f=users[_0x1ee11c(0x170)];console['log'](_0x24b81f);}else{if(_0x311d29[0x0]['language']==_0x1ee11c(0x12c))var _0x24b81f=users[_0x1ee11c(0x12c)];else{if(_0x311d29[0x0]['language']==_0x1ee11c(0x129))var _0x24b81f=users[_0x1ee11c(0x129)];else{if(_0x311d29[0x0][_0x1ee11c(0x19f)]==_0x1ee11c(0x166))var _0x24b81f=users[_0x1ee11c(0x166)];else{if(_0x311d29[0x0][_0x1ee11c(0x19f)]==_0x1ee11c(0x1aa))var _0x24b81f=users[_0x1ee11c(0x1aa)];else{if(_0x311d29[0x0][_0x1ee11c(0x19f)]==_0x1ee11c(0x13a))var _0x24b81f=users[_0x1ee11c(0x165)];else{if(_0x311d29[0x0][_0x1ee11c(0x19f)]=='Chinese')var _0x24b81f=users[_0x1ee11c(0x1d2)];else{if(_0x311d29[0x0][_0x1ee11c(0x19f)]=='Arabic\x20(ae)')var _0x24b81f=users[_0x1ee11c(0x17d)];}}}}}}}_0x5a9796['render'](_0x1ee11c(0x1be),{'success':_0x351b5c[_0x1ee11c(0x19a)](_0x1ee11c(0x11a)),'errors':_0x351b5c[_0x1ee11c(0x19a)](_0x1ee11c(0x1d4)),'role':_0x16da52,'profile':_0x10162e,'customer':_0xa87e0c,'warehouse':_0x1f98dd,'product':_0x24db2a,'user':_0x2487a8,'master_shop':_0x311d29,'unit':_0x43685e,'language':_0x24b81f});}catch(_0x2950d9){console[_0x1ee11c(0x191)](_0x2950d9);}}),router['post'](a0_0x583c21(0x1e9),auth,async(_0x13150c,_0x150410)=>{var _0x1873ef=a0_0x583c21;try{const _0x151af2=_0x13150c[_0x1873ef(0x13e)]['id'],_0x75c024=await sales[_0x1873ef(0x1ae)]({'_id':_0x13150c[_0x1873ef(0x13e)]['id']}),_0x312cf8=await warehouse[_0x1873ef(0x1ae)]({'name':_0x75c024['warehouse_name'],'room':_0x13150c['body'][_0x1873ef(0x1e1)]}),{invoice:_0x3c96e9,date:_0xbe2d22,warehouse_name:_0x587257,product_name:_0x2187de,stock:_0x30e87b,quantity:_0x55ba08,note:_0x478cb4,room:_0x5e70c6,customer:_0x292323,SCRN:_0x5d0dd9}=_0x13150c[_0x1873ef(0x1ed)];if(typeof _0x2187de==_0x1873ef(0x19b))var _0x1d3679=[_0x13150c[_0x1873ef(0x1ed)]['product_name']],_0x7036e4=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x1da)]],_0x292da0=[_0x13150c[_0x1873ef(0x1ed)]['carton']],_0x3e3007=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x113)]],_0xbac1ef=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x18f)]],_0x43e03b=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x114)]],_0x26a716=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x1d8)]],_0x564bee=[_0x13150c[_0x1873ef(0x1ed)]['primary_unit']],_0x4532ef=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x125)]],_0x4b3c12=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x1db)]],_0x275dad=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x1dd)]],_0x9d36ba=[_0x13150c['body'][_0x1873ef(0x1e6)]],_0x2d43d6=[_0x13150c['body']['production_date']],_0x9169d7=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x154)]],_0x41d87a=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x1c3)]],_0x339a8f=[_0x13150c['body'][_0x1873ef(0x1a7)]],_0x31327e=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x175)]],_0x376fb2=[_0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x15a)]],_0x567cc2=[_0x13150c[_0x1873ef(0x1ed)]['RoomAssigned']];else var _0x1d3679=[..._0x13150c[_0x1873ef(0x1ed)]['product_name']],_0x7036e4=[..._0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x1da)]],_0x292da0=[..._0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x10c)]],_0x3e3007=[..._0x13150c['body']['primary_code']],_0xbac1ef=[..._0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x18f)]],_0x43e03b=[..._0x13150c['body'][_0x1873ef(0x114)]],_0x26a716=[..._0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x1d8)]],_0x564bee=[..._0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x1e0)]],_0x4532ef=[..._0x13150c[_0x1873ef(0x1ed)]['secondary_unit']],_0x4b3c12=[..._0x13150c['body'][_0x1873ef(0x1db)]],_0x275dad=[..._0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x1dd)]],_0x9d36ba=[..._0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x1e6)]],_0x2d43d6=[..._0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x131)]],_0x9169d7=[..._0x13150c['body']['requested_qty']],_0x41d87a=[..._0x13150c['body'][_0x1873ef(0x1c3)]],_0x339a8f=[..._0x13150c[_0x1873ef(0x1ed)]['delivery_code']],_0x31327e=[..._0x13150c['body'][_0x1873ef(0x175)]],_0x376fb2=[..._0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x15a)]],_0x567cc2=[..._0x13150c[_0x1873ef(0x1ed)][_0x1873ef(0x153)]];const _0x58ea47=_0x1d3679[_0x1873ef(0x1af)](_0x1e9056=>{return _0x1e9056={'product_name':_0x1e9056};});_0x7036e4['forEach']((_0x31636f,_0x5f5da3)=>{var _0x2edcb4=_0x1873ef;_0x58ea47[_0x5f5da3][_0x2edcb4(0x1da)]=_0x31636f;}),_0x292da0['forEach']((_0x281a9c,_0xf0b5ba)=>{var _0x39699f=_0x1873ef;_0x58ea47[_0xf0b5ba][_0x39699f(0x15a)]=_0x281a9c;}),_0x3e3007[_0x1873ef(0x1f0)]((_0x579678,_0x39a5d5)=>{var _0x327d68=_0x1873ef;_0x58ea47[_0x39a5d5][_0x327d68(0x113)]=_0x579678;}),_0xbac1ef[_0x1873ef(0x1f0)]((_0x536d16,_0x4cce49)=>{var _0x3c9dd4=_0x1873ef;_0x58ea47[_0x4cce49][_0x3c9dd4(0x18f)]=_0x536d16;}),_0x43e03b[_0x1873ef(0x1f0)]((_0x48c998,_0x13473d)=>{var _0x2499ff=_0x1873ef;_0x58ea47[_0x13473d][_0x2499ff(0x12e)]=_0x48c998;}),_0x26a716[_0x1873ef(0x1f0)]((_0x2a9c27,_0x468424)=>{var _0x356268=_0x1873ef;_0x567cc2[_0x356268(0x1f0)]((_0x3fa748,_0x52fde3)=>{var _0x40de23=_0x356268;if(_0x3fa748=='Receiving\x20Area'&&_0x468424==_0x52fde3){var _0x43a72a=_0x2a9c27[_0x40de23(0x14c)](0x3);_0x58ea47[_0x468424][_0x40de23(0x13c)]=_0x2a9c27[0x0],_0x58ea47[_0x468424][_0x40de23(0x140)]=_0x2a9c27[0x1],_0x58ea47[_0x468424]['bay']=0x0,_0x58ea47[_0x468424][_0x40de23(0x151)]=0x0,_0x58ea47[_0x468424][_0x40de23(0x110)]=_0x40de23(0x16b),_0x58ea47[_0x468424][_0x40de23(0x1d0)]=_0x43a72a;}else{if(_0x3fa748==_0x40de23(0x15e)&&_0x468424==_0x52fde3){var _0x43a72a=_0x2a9c27['slice'](0x3);_0x58ea47[_0x468424][_0x40de23(0x13c)]=_0x2a9c27[0x0],_0x58ea47[_0x468424][_0x40de23(0x140)]=_0x2a9c27[0x1],_0x58ea47[_0x468424][_0x40de23(0x1ec)]=0x0,_0x58ea47[_0x468424][_0x40de23(0x151)]=0x0,_0x58ea47[_0x468424]['type']=_0x40de23(0x16b),_0x58ea47[_0x468424][_0x40de23(0x1d0)]=_0x2a9c27[0x5];}else{if(_0x468424==_0x52fde3){var _0x1c333f;if(_0x2a9c27[0x4]=='L')_0x1c333f=_0x40de23(0x10d);else _0x2a9c27[0x4]=='F'&&(_0x1c333f='Floor');_0x58ea47[_0x468424]['storage']=_0x2a9c27[0x0],_0x58ea47[_0x468424][_0x40de23(0x140)]=_0x2a9c27[0x1],_0x58ea47[_0x468424][_0x40de23(0x1ec)]=_0x2a9c27[0x2],_0x58ea47[_0x468424][_0x40de23(0x151)]=_0x2a9c27[0x3],_0x58ea47[_0x468424][_0x40de23(0x110)]=_0x1c333f,_0x58ea47[_0x468424][_0x40de23(0x1d0)]=_0x2a9c27[0x5];}}}});}),_0x564bee[_0x1873ef(0x1f0)]((_0x13987f,_0xd27110)=>{_0x58ea47[_0xd27110]['unit']=_0x13987f;}),_0x4532ef['forEach']((_0x13b6f4,_0x1595bc)=>{var _0x45cbe0=_0x1873ef;_0x58ea47[_0x1595bc][_0x45cbe0(0x125)]=_0x13b6f4;}),_0x4b3c12['forEach']((_0x1fb83d,_0x54e3f3)=>{var _0x523855=_0x1873ef;_0x58ea47[_0x54e3f3][_0x523855(0x1db)]=_0x1fb83d;}),_0x275dad[_0x1873ef(0x1f0)]((_0x318439,_0x49f0b7)=>{var _0x5d1595=_0x1873ef;_0x58ea47[_0x49f0b7][_0x5d1595(0x1dd)]=_0x318439;}),_0x9d36ba[_0x1873ef(0x1f0)]((_0x462b58,_0x3d7c99)=>{var _0x31a9a5=_0x1873ef;_0x58ea47[_0x3d7c99][_0x31a9a5(0x192)]=_0x462b58;}),_0x2d43d6['forEach']((_0x3180da,_0x381ed7)=>{var _0x145cd8=_0x1873ef;_0x58ea47[_0x381ed7][_0x145cd8(0x131)]=_0x3180da;}),_0x9169d7[_0x1873ef(0x1f0)]((_0x1c9f73,_0xeff5d0)=>{var _0x2b8f85=_0x1873ef;_0x58ea47[_0xeff5d0][_0x2b8f85(0x154)]=_0x1c9f73;}),_0x41d87a[_0x1873ef(0x1f0)]((_0x41ac77,_0x218765)=>{var _0x1dfdda=_0x1873ef;_0x58ea47[_0x218765][_0x1dfdda(0x1c3)]=_0x41ac77;}),_0x339a8f[_0x1873ef(0x1f0)]((_0x414d22,_0x24424a)=>{_0x58ea47[_0x24424a]['delivery_code']=_0x414d22;}),_0x31327e[_0x1873ef(0x1f0)]((_0x5c7ae5,_0xcaaa15)=>{var _0x49434d=_0x1873ef;_0x58ea47[_0xcaaa15][_0x49434d(0x175)]=_0x5c7ae5;}),_0x376fb2[_0x1873ef(0x1f0)]((_0x38ead0,_0x3671f2)=>{var _0x117452=_0x1873ef;_0x58ea47[_0x3671f2][_0x117452(0x18d)]=_0x38ead0;}),_0x567cc2[_0x1873ef(0x1f0)]((_0x218e1f,_0x4ad91d)=>{var _0x436292=_0x1873ef;_0x58ea47[_0x4ad91d][_0x436292(0x1de)]=_0x218e1f;});var _0x2d635c=0x0;_0x58ea47['forEach'](_0x19b4fe=>{var _0x4148b6=_0x1873ef;console[_0x4148b6(0x191)](_0x4148b6(0x194),_0x19b4fe),(parseInt(_0x19b4fe[_0x4148b6(0x1da)])<parseInt(_0x19b4fe[_0x4148b6(0x15a)])||parseInt(_0x19b4fe[_0x4148b6(0x15a)])==0x0)&&_0x2d635c++;});if(_0x2d635c!=0x0)return _0x13150c[_0x1873ef(0x19a)](_0x1873ef(0x1d4),_0x1873ef(0x17e)),_0x150410['redirect']('back');const _0x396121=_0x58ea47[_0x1873ef(0x104)](_0x599deb=>_0x599deb[_0x1873ef(0x15a)]!=='0'&&_0x599deb['quantity']!=='');_0x75c024[_0x1873ef(0x1d1)]=_0x3c96e9,_0x75c024[_0x1873ef(0x18c)]=_0x292323,_0x75c024[_0x1873ef(0x139)]=_0xbe2d22,_0x75c024[_0x1873ef(0x1b9)]=_0x587257,_0x75c024[_0x1873ef(0x1b0)]=_0x396121,_0x75c024['note']=_0x478cb4,_0x75c024[_0x1873ef(0x174)]=_0x5d0dd9,_0x75c024['finalize']=_0x1873ef(0x1cf),_0x75c024[_0x1873ef(0x161)]=_0x1873ef(0x1cf);const _0x275360=await _0x75c024['save']();_0x13150c['flash'](_0x1873ef(0x11a),_0x1873ef(0x152)),_0x150410['redirect'](_0x1873ef(0x1a6));}catch(_0xa37ae4){console[_0x1873ef(0x191)](_0xa37ae4);}}),router[a0_0x583c21(0x147)](a0_0x583c21(0x1df),auth,async(_0x24ffb7,_0x51e306)=>{var _0x4a6fbe=a0_0x583c21;try{const _0x5736ce=_0x24ffb7[_0x4a6fbe(0x13e)]['id'],{invoice:_0x280b43,customer:_0x1ed580,receivable_amount:_0x528519,received_amount:_0x815e34}=_0x24ffb7[_0x4a6fbe(0x1ed)],_0x585b35=await sales[_0x4a6fbe(0x176)](_0x5736ce);console['log'](_0x585b35);var _0x1587c5=_0x528519-_0x815e34;console[_0x4a6fbe(0x191)](_0x815e34),_0x585b35[_0x4a6fbe(0x111)]=parseFloat(_0x815e34)+parseFloat(_0x585b35[_0x4a6fbe(0x111)]),_0x585b35['due_amount']=_0x1587c5,console['log'](_0x585b35);const _0x2c475d=await _0x585b35[_0x4a6fbe(0x189)](),_0xc5546c=await c_payment_data['findOne']({'invoice':_0x280b43});_0xc5546c[_0x4a6fbe(0x162)]=_0x1587c5,await _0xc5546c[_0x4a6fbe(0x189)]();let _0x447438=new Date(),_0x53a3c6=('0'+_0x447438['getDate']())[_0x4a6fbe(0x14c)](-0x2),_0x3d765e=('0'+(_0x447438[_0x4a6fbe(0x1d5)]()+0x1))[_0x4a6fbe(0x14c)](-0x2),_0x3f0fd8=_0x447438[_0x4a6fbe(0x179)](),_0x22d887=_0x3f0fd8+'-'+_0x3d765e+'-'+_0x53a3c6;const _0x11c2a8=new customer_payment({'invoice':_0x280b43,'date':_0x3f0fd8+'-'+_0x3d765e+'-'+_0x53a3c6,'customer':_0x1ed580,'reason':_0x4a6fbe(0x1a3),'amount':_0x815e34}),_0x25ec45=await _0x11c2a8[_0x4a6fbe(0x189)]();_0x24ffb7['flash'](_0x4a6fbe(0x11a),_0x4a6fbe(0x119)),_0x51e306[_0x4a6fbe(0x10a)](_0x4a6fbe(0x1a6));}catch(_0x2082cd){console[_0x4a6fbe(0x191)](_0x2082cd);}}),router['get'](a0_0x583c21(0x193),auth,async(_0x3151ab,_0x508e7a)=>{var _0x477176=a0_0x583c21;try{const {username:_0x682f3a,email:_0x126aa9,role:_0x5c6c5c}=_0x3151ab[_0x477176(0x130)],_0xea2f10=_0x3151ab[_0x477176(0x130)],_0x560de6=await profile[_0x477176(0x1ae)]({'email':_0xea2f10[_0x477176(0x1d3)]}),_0x2d6381=await master_shop[_0x477176(0x14d)]();console[_0x477176(0x191)](_0x477176(0x141),_0x2d6381);const _0x132224=_0x3151ab['params']['id'],_0x204ad5=await sales[_0x477176(0x176)](_0x132224);console[_0x477176(0x191)](_0x204ad5);const _0x38c1f6=await customer[_0x477176(0x1ae)]({'name':_0x204ad5['customer']});console['log'](_0x38c1f6);if(_0x2d6381[0x0][_0x477176(0x19f)]==_0x477176(0x1d9)){var _0x18c7e2=users['English'];console[_0x477176(0x191)](_0x18c7e2);}else{if(_0x2d6381[0x0][_0x477176(0x19f)]==_0x477176(0x12c))var _0x18c7e2=users[_0x477176(0x12c)];else{if(_0x2d6381[0x0][_0x477176(0x19f)]==_0x477176(0x129))var _0x18c7e2=users[_0x477176(0x129)];else{if(_0x2d6381[0x0][_0x477176(0x19f)]==_0x477176(0x166))var _0x18c7e2=users['Spanish'];else{if(_0x2d6381[0x0]['language']=='French')var _0x18c7e2=users[_0x477176(0x1aa)];else{if(_0x2d6381[0x0][_0x477176(0x19f)]==_0x477176(0x13a))var _0x18c7e2=users['Portuguese'];else{if(_0x2d6381[0x0]['language']==_0x477176(0x1d2))var _0x18c7e2=users['Chinese'];else{if(_0x2d6381[0x0][_0x477176(0x19f)]==_0x477176(0x13f))var _0x18c7e2=users[_0x477176(0x17d)];}}}}}}}_0x508e7a[_0x477176(0x1ea)](_0x477176(0x1f9),{'success':_0x3151ab[_0x477176(0x19a)](_0x477176(0x11a)),'errors':_0x3151ab[_0x477176(0x19a)](_0x477176(0x1d4)),'role':_0xea2f10,'profile':_0x560de6,'master_shop':_0x2d6381,'customers':_0x38c1f6,'sales':_0x204ad5,'language':_0x18c7e2});}catch(_0x5194a1){console['log'](_0x5194a1);}}),router['get'](a0_0x583c21(0x109),auth,async(_0xf45eed,_0x4f476b)=>{var _0x23440d=a0_0x583c21;try{const {username:_0x9ea8d0,email:_0x458655,role:_0x134b9c}=_0xf45eed[_0x23440d(0x130)],_0x2e7d11=_0xf45eed[_0x23440d(0x130)],_0x20958c=await profile[_0x23440d(0x1ae)]({'email':_0x2e7d11[_0x23440d(0x1d3)]}),_0x140817=await master_shop[_0x23440d(0x14d)]();console['log']('master',_0x140817);const _0x3f233a=_0xf45eed['params']['id'];console[_0x23440d(0x191)](_0x3f233a);const _0xc2bb31=await sales['findById'](_0x3f233a);console['log']('user_id',_0xc2bb31);const _0x13301e=await warehouse[_0x23440d(0x150)]([{'$match':{'name':'Return\x20Goods','room':_0x23440d(0x16a)}},{'$unwind':_0x23440d(0x13d)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x23440d(0x1cc)},'product_stock':{'$first':_0x23440d(0x19d)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x23440d(0x1f6)},'pallet':{'$first':_0x23440d(0x127)},'primary_code':{'$first':_0x23440d(0x1f5)},'secondary_code':{'$first':_0x23440d(0x18b)},'product_code':{'$first':_0x23440d(0x100)}}}]);console[_0x23440d(0x191)](_0x23440d(0x1ca),_0x13301e);const _0x410873=await product['find']({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x23440d(0x155),'name':_0x23440d(0x1fb),'warehouse_category':_0x23440d(0x126)}},{'$group':{'_id':'$name','name':{'$first':_0x23440d(0x118)}}},{'$sort':{'name':0x1}}]);var _0x291b3e=[_0x23440d(0x16a)];if(_0x140817[0x0][_0x23440d(0x19f)]=='English\x20(US)'){var _0x24b107=users[_0x23440d(0x170)];console[_0x23440d(0x191)](_0x24b107);}else{if(_0x140817[0x0][_0x23440d(0x19f)]=='Hindi')var _0x24b107=users['Hindi'];else{if(_0x140817[0x0]['language']==_0x23440d(0x129))var _0x24b107=users[_0x23440d(0x129)];else{if(_0x140817[0x0][_0x23440d(0x19f)]==_0x23440d(0x166))var _0x24b107=users[_0x23440d(0x166)];else{if(_0x140817[0x0][_0x23440d(0x19f)]=='French')var _0x24b107=users['French'];else{if(_0x140817[0x0]['language']=='Portuguese\x20(BR)')var _0x24b107=users[_0x23440d(0x165)];else{if(_0x140817[0x0][_0x23440d(0x19f)]=='Chinese')var _0x24b107=users[_0x23440d(0x1d2)];else{if(_0x140817[0x0]['language']=='Arabic\x20(ae)')var _0x24b107=users['Arabic'];}}}}}}}_0x4f476b[_0x23440d(0x1ea)](_0x23440d(0x1b6),{'success':_0xf45eed['flash']('success'),'errors':_0xf45eed[_0x23440d(0x19a)](_0x23440d(0x1d4)),'role':_0x2e7d11,'profile':_0x20958c,'user':_0xc2bb31,'stock':_0x13301e,'master_shop':_0x140817,'unit':_0x410873,'language':_0x24b107,'warehouses':warehouse_data,'rooms':_0x291b3e});}catch(_0x3fef45){console[_0x23440d(0x191)](_0x3fef45),_0x4f476b['status'](0xc8)['json']({'message':_0x3fef45['message']});}}),router[a0_0x583c21(0x147)](a0_0x583c21(0x109),auth,async(_0x5ae20a,_0x5d2bfc)=>{var _0x3c15b3=a0_0x583c21;try{const {invoice:_0x31024d,date:_0x41930e,warehouse_name:_0x897015,product_name:_0xc982a,primary_code:_0xc30d32,secondary_code:_0x415d85,product_code:_0x5eda8b,sales_quantity:_0x371c40,stocks:_0x2228dc,return_qty:_0x145089,Room_name:_0x46c9a5,to_warehouse_name:_0x2e835f,to_Roomname:_0x4b638a,to_Room_name:_0x23ce0,note:_0x575f51,level:_0x493cf9,isle:_0x4a06c8,pallet:_0x5e7767}=_0x5ae20a[_0x3c15b3(0x1ed)];if(typeof _0xc982a==_0x3c15b3(0x19b))var _0x111ec7=[_0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x1b8)]],_0x37e92d=[_0x5ae20a['body'][_0x3c15b3(0x113)]],_0x130a3c=[_0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x18f)]],_0x29240a=[_0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x12e)]],_0x19d531=[_0x5ae20a[_0x3c15b3(0x1ed)]['sales_quantity']],_0x219e52=[_0x5ae20a['body'][_0x3c15b3(0x197)]],_0x26ba4c=[_0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x10f)]],_0x4d221c=[_0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x1ec)]],_0x130615=[_0x5ae20a[_0x3c15b3(0x1ed)]['bin']],_0x26fc58=[_0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x1e5)]],_0x2a3d49=[_0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x1d0)]];else var _0x111ec7=[..._0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x1b8)]],_0x37e92d=[..._0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x113)]],_0x130a3c=[..._0x5ae20a[_0x3c15b3(0x1ed)]['secondary_code']],_0x29240a=[..._0x5ae20a[_0x3c15b3(0x1ed)]['product_code']],_0x19d531=[..._0x5ae20a[_0x3c15b3(0x1ed)]['sales_quantity']],_0x219e52=[..._0x5ae20a[_0x3c15b3(0x1ed)]['stocks']],_0x26ba4c=[..._0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x10f)]],_0x4d221c=[..._0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x1ec)]],_0x130615=[..._0x5ae20a['body'][_0x3c15b3(0x151)]],_0x26fc58=[..._0x5ae20a['body'][_0x3c15b3(0x1e5)]],_0x2a3d49=[..._0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x1d0)]];const _0x5681cb=_0x111ec7['map'](_0x4ec1bc=>{return _0x4ec1bc={'product_name':_0x4ec1bc};});_0x37e92d[_0x3c15b3(0x1f0)]((_0x66d23a,_0x104353)=>{var _0x469317=_0x3c15b3;_0x5681cb[_0x104353][_0x469317(0x113)]=_0x66d23a;}),_0x130a3c[_0x3c15b3(0x1f0)]((_0x314e03,_0x5e78b7)=>{var _0x1ab362=_0x3c15b3;_0x5681cb[_0x5e78b7][_0x1ab362(0x18f)]=_0x314e03;}),_0x29240a['forEach']((_0x128367,_0x4146ee)=>{var _0x24717b=_0x3c15b3;_0x5681cb[_0x4146ee][_0x24717b(0x12e)]=_0x128367;}),_0x19d531[_0x3c15b3(0x1f0)]((_0x2dd864,_0x2edb40)=>{var _0x30b765=_0x3c15b3;_0x5681cb[_0x2edb40][_0x30b765(0x199)]=_0x2dd864;}),_0x219e52['forEach']((_0x4090f2,_0x4c66dd)=>{var _0x38fccd=_0x3c15b3;_0x5681cb[_0x4c66dd][_0x38fccd(0x1da)]=_0x4090f2;}),_0x26ba4c[_0x3c15b3(0x1f0)]((_0x379d89,_0x5d711a)=>{_0x5681cb[_0x5d711a]['return_qty']=_0x379d89;}),_0x4d221c['forEach']((_0x523e77,_0x3eeaa0)=>{_0x5681cb[_0x3eeaa0]['bay']=_0x523e77;}),_0x130615[_0x3c15b3(0x1f0)]((_0x5263b2,_0x503f53)=>{var _0x233c7a=_0x3c15b3;_0x5681cb[_0x503f53][_0x233c7a(0x151)]=_0x5263b2;}),_0x26fc58['forEach']((_0x3bba05,_0x42b04c)=>{var _0x5ccf91=_0x3c15b3;_0x5681cb[_0x42b04c][_0x5ccf91(0x110)]=_0x3bba05;}),_0x2a3d49[_0x3c15b3(0x1f0)]((_0x2ed5a5,_0x1c0c02)=>{var _0x5319e0=_0x3c15b3;_0x5681cb[_0x1c0c02][_0x5319e0(0x1d0)]=_0x2ed5a5;});var _0x33275b=0x0;_0x5681cb[_0x3c15b3(0x1f0)](_0x437a8c=>{var _0x5ae48e=_0x3c15b3;console[_0x5ae48e(0x191)](_0x5ae48e(0x194),_0x437a8c),(parseInt(_0x437a8c[_0x5ae48e(0x199)])<parseInt(_0x437a8c[_0x5ae48e(0x10f)])||parseInt(_0x437a8c['stock'])<parseInt(_0x437a8c['return_qty'])&&parseInt(_0x437a8c['sale_qty'])>parseInt(_0x437a8c[_0x5ae48e(0x10f)])||parseInt(_0x437a8c[_0x5ae48e(0x10f)])==0x0)&&_0x33275b++;});if(_0x33275b!=0x0)return _0x5ae20a[_0x3c15b3(0x19a)]('errors',_0x3c15b3(0x15b)),_0x5d2bfc[_0x3c15b3(0x10a)](_0x3c15b3(0x18a));const _0x481437=await sales[_0x3c15b3(0x1ae)]({'invoice':_0x31024d});console['log'](_0x481437),_0x481437[_0x3c15b3(0x14f)]='True';const _0x2a12e4=await _0x481437[_0x3c15b3(0x189)](),_0x6a0a7=new sales_return({'invoice':_0x31024d,'customer':_0x5ae20a['body'][_0x3c15b3(0x18c)],'date':_0x41930e,'warehouse_name':_0x897015,'room':_0x46c9a5,'ToWarehouse':_0x2e835f,'ToRoom':_0x23ce0,'return_sale':_0x5681cb,'note':_0x575f51}),_0x197ab0=await _0x6a0a7[_0x3c15b3(0x189)]();console[_0x3c15b3(0x191)](_0x6a0a7);const _0x46baf5=await sales_return[_0x3c15b3(0x1ae)]({'invoice':_0x31024d}),_0x5b0b32=await warehouse[_0x3c15b3(0x1ae)]({'name':_0x2e835f,'room':_0x23ce0});_0x46baf5[_0x3c15b3(0x1b6)][_0x3c15b3(0x1f0)](_0x506a44=>{var _0x51f9a6=_0x3c15b3,_0x9eacde=0x0;const _0x141cbb=_0x5b0b32[_0x51f9a6(0x1c7)]['map'](_0x331447=>{var _0x36876d=_0x51f9a6;_0x331447['product_name']==_0x506a44[_0x36876d(0x1b8)]&&_0x331447[_0x36876d(0x1d0)]==_0x506a44[_0x36876d(0x1d0)]&&_0x331447['type']==_0x506a44[_0x36876d(0x110)]&&_0x331447[_0x36876d(0x151)]==_0x506a44[_0x36876d(0x151)]&&_0x331447[_0x36876d(0x1ec)]==_0x506a44['bay']&&(_0x331447[_0x36876d(0x167)]=parseInt(_0x331447[_0x36876d(0x167)])+parseInt(_0x506a44[_0x36876d(0x10f)]),_0x9eacde++);});_0x9eacde=='0'&&(_0x5b0b32['product_details']=_0x5b0b32[_0x51f9a6(0x1c7)]['concat']({'product_name':_0x506a44[_0x51f9a6(0x1b8)],'product_stock':_0x506a44[_0x51f9a6(0x10f)],'primary_code':_0x506a44[_0x51f9a6(0x113)],'secondary_code':_0x506a44[_0x51f9a6(0x18f)],'product_code':_0x506a44[_0x51f9a6(0x12e)],'bay':_0x506a44['bay'],'bin':_0x506a44[_0x51f9a6(0x151)],'type':_0x506a44[_0x51f9a6(0x110)],'floorlevel':_0x506a44[_0x51f9a6(0x1d0)]})),console['log'](_0x51f9a6(0x182),_0x5b0b32);}),await _0x5b0b32[_0x3c15b3(0x189)](),console[_0x3c15b3(0x191)](_0x5ae20a[_0x3c15b3(0x1ed)]);const _0x2939f4=new c_payment_data({'invoice':_0x31024d,'customer':_0x5ae20a[_0x3c15b3(0x1ed)][_0x3c15b3(0x18c)],'reason':_0x3c15b3(0x1bf)});await _0x2939f4[_0x3c15b3(0x189)]();const _0x2ee17d=await master_shop[_0x3c15b3(0x14d)]();console[_0x3c15b3(0x191)](_0x3c15b3(0x121),_0x2ee17d[0x0][_0x3c15b3(0x1e4)]);const _0x1a8325=await email_settings['findOne'](),_0x37c1a7=await customer[_0x3c15b3(0x1ae)]({'name':_0x5ae20a['body']['customer']});console[_0x3c15b3(0x191)](_0x3c15b3(0x12a),_0x37c1a7);_0x2ee17d[0x0][_0x3c15b3(0x12b)]==0x1?(right_currency=_0x2ee17d[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x2ee17d[0x0]['currency']);var _0x38854c=_0x111ec7,_0x8619c5=_0x26ba4c,_0x2a131a='',_0xa54463;for(_0xa54463 in _0x38854c){_0x2a131a+='<tr>'+_0x3c15b3(0x19c)+_0x38854c[_0xa54463]+_0x3c15b3(0x15f)+_0x3c15b3(0x19c)+_0x8619c5[_0xa54463]+'</td>'+_0x3c15b3(0x1f4);}console[_0x3c15b3(0x191)]('product_list',_0x2a131a);let _0x5776f3=nodemailer[_0x3c15b3(0x173)]({'service':'gmail','auth':{'user':_0x1a8325[_0x3c15b3(0x1d3)],'pass':_0x1a8325['password']}}),_0x14d5ac={'from':_0x1a8325[_0x3c15b3(0x1d3)],'to':_0x37c1a7['email'],'subject':_0x3c15b3(0x1fa),'attachments':[{'filename':_0x3c15b3(0x16c),'path':__dirname+_0x3c15b3(0x1a2)+_0x3c15b3(0x164)+_0x2ee17d[0x0][_0x3c15b3(0x1e4)],'cid':_0x3c15b3(0x1a8)}],'html':_0x3c15b3(0x15c)+_0x3c15b3(0x1b4)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3c15b3(0x11e)+_0x3c15b3(0x13b)+'</div>'+_0x3c15b3(0x11e)+_0x3c15b3(0x1a5)+_0x2ee17d[0x0][_0x3c15b3(0x1e2)]+_0x3c15b3(0x12f)+_0x3c15b3(0x16e)+'</div>'+_0x3c15b3(0x144)+_0x3c15b3(0x11e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x3c15b3(0x14e)+_0x31024d+'\x20'+_0x3c15b3(0x1fc)+_0x3c15b3(0x172)+_0x41930e+'\x20'+'</span>'+'</h5>'+_0x3c15b3(0x16e)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3c15b3(0x158)+_0x3c15b3(0x106)+_0x3c15b3(0x181)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x3c15b3(0x1dc)+_0x3c15b3(0x1ee)+'</tr>'+_0x3c15b3(0x10b)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2a131a+'\x20'+'</tbody>'+_0x3c15b3(0x112)+_0x3c15b3(0x11e)+_0x3c15b3(0x1cb)+'<h5>'+_0x2ee17d[0x0][_0x3c15b3(0x1e2)]+_0x3c15b3(0x115)+_0x3c15b3(0x16e)+_0x3c15b3(0x16e)+_0x3c15b3(0x1ba)};_0x5776f3['sendMail'](_0x14d5ac,function(_0x22331c,_0x44fff3){var _0x5c073b=_0x3c15b3;_0x22331c?(console[_0x5c073b(0x191)](_0x22331c),console['log'](_0x5c073b(0x157))):console['log'](_0x5c073b(0x187));}),_0x5ae20a[_0x3c15b3(0x19a)](_0x3c15b3(0x11a),'sales\x20item\x20return\x20successfull'),_0x5d2bfc[_0x3c15b3(0x10a)](_0x3c15b3(0x1a6));}catch(_0x5384b8){console[_0x3c15b3(0x191)](_0x5384b8),_0x5d2bfc[_0x3c15b3(0x1f8)](0xc8)['json']({'message1':_0x5384b8[_0x3c15b3(0x177)]});}}),router[a0_0x583c21(0x1e7)]('/barcode/:id',auth,async(_0x5d9b1c,_0x1372c8)=>{var _0x416dca=a0_0x583c21;try{const {username:_0x4b2b5d,email:_0x20e3c9,role:_0x4f89dc}=_0x5d9b1c[_0x416dca(0x130)],_0x4e98a8=_0x5d9b1c[_0x416dca(0x130)],_0x4e33bd=await profile['findOne']({'email':_0x4e98a8['email']}),_0x496209=await master_shop[_0x416dca(0x14d)]();console[_0x416dca(0x191)](_0x416dca(0x1e3),_0x496209);const _0x24a2c7=_0x5d9b1c[_0x416dca(0x13e)]['id'],_0x5b2b87=await sales[_0x416dca(0x176)](_0x24a2c7);console[_0x416dca(0x191)]('barcode\x20user_id',_0x5b2b87);if(_0x496209[0x0][_0x416dca(0x19f)]=='English\x20(US)')var _0x19a334=users[_0x416dca(0x170)];else{if(_0x496209[0x0][_0x416dca(0x19f)]==_0x416dca(0x12c))var _0x19a334=users[_0x416dca(0x12c)];else{if(_0x496209[0x0][_0x416dca(0x19f)]==_0x416dca(0x129))var _0x19a334=users[_0x416dca(0x129)];else{if(_0x496209[0x0][_0x416dca(0x19f)]==_0x416dca(0x166))var _0x19a334=users[_0x416dca(0x166)];else{if(_0x496209[0x0][_0x416dca(0x19f)]==_0x416dca(0x1aa))var _0x19a334=users[_0x416dca(0x1aa)];else{if(_0x496209[0x0][_0x416dca(0x19f)]==_0x416dca(0x13a))var _0x19a334=users['Portuguese'];else{if(_0x496209[0x0][_0x416dca(0x19f)]==_0x416dca(0x1d2))var _0x19a334=users['Chinese'];else{if(_0x496209[0x0]['language']==_0x416dca(0x13f))var _0x19a334=users['Arabic'];}}}}}}}_0x1372c8[_0x416dca(0x1ea)](_0x416dca(0x107),{'success':_0x5d9b1c[_0x416dca(0x19a)]('success'),'errors':_0x5d9b1c['flash']('errors'),'role':_0x4e98a8,'profile':_0x4e33bd,'alldata':_0x5b2b87,'master_shop':_0x496209,'language':_0x19a334});}catch(_0x420d8d){console['log'](_0x420d8d);}}),router['post'](a0_0x583c21(0x1bd),async(_0x3f891c,_0x2e9967)=>{var _0x223f5b=a0_0x583c21;const {product_code:_0x4e3d96,warehouse_name:_0x3b730c,rooms_data:_0x1cdefa,Roomslist:_0x237448}=_0x3f891c['body'],_0x39f73c=_0x237448[_0x223f5b(0x117)](','),_0x3e798f=[];async function _0x360845(_0x348015){var _0x4e2eb8=_0x223f5b;const _0x1bc347=await warehouse['aggregate']([{'$match':{'name':_0x3b730c,'room':_0x348015}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x4e3d96}},{'$group':{'_id':_0x4e2eb8(0x17b),'name':{'$first':_0x4e2eb8(0x1cc)},'product_stock':{'$first':_0x4e2eb8(0x19d)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4e2eb8(0x18b)},'product_code':{'$first':_0x4e2eb8(0x100)},'level':{'$first':_0x4e2eb8(0x14a)},'isle':{'$first':_0x4e2eb8(0x1f1)},'type':{'$first':_0x4e2eb8(0x1b7)},'pallet':{'$first':_0x4e2eb8(0x148)},'unit':{'$first':_0x4e2eb8(0x146)},'secondary_unit':{'$first':_0x4e2eb8(0x180)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4e2eb8(0x116)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x4e2eb8(0x17c)},'product_cat':{'$first':_0x4e2eb8(0x1fe)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4e2eb8(0x128)},'invoice':{'$first':_0x4e2eb8(0x1a0)},'actual_qty':{'$first':'$product_details.actual_qty'}}}]),_0xc14c92=await warehouse[_0x4e2eb8(0x150)]([{'$match':{'name':_0x3b730c,'room':_0x348015}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x4e3d96}},{'$group':{'_id':_0x4e2eb8(0x17b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4e2eb8(0x19d)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4e2eb8(0x18b)},'product_code':{'$first':_0x4e2eb8(0x100)},'level':{'$first':_0x4e2eb8(0x14a)},'isle':{'$first':_0x4e2eb8(0x1f1)},'type':{'$first':_0x4e2eb8(0x1b7)},'pallet':{'$first':_0x4e2eb8(0x148)},'unit':{'$first':_0x4e2eb8(0x146)},'secondary_unit':{'$first':_0x4e2eb8(0x180)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4e2eb8(0x116)},'expiry_date':{'$first':_0x4e2eb8(0x1b1)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x4e2eb8(0x1fe)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x4e2eb8(0x128)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x1bc347[_0x4e2eb8(0x11d)]>0x0)_0x3e798f[_0x4e2eb8(0x195)](_0x1bc347);else _0xc14c92['length']>0x0&&_0x3e798f[_0x4e2eb8(0x195)](_0xc14c92);}const _0x67d299=_0x39f73c['map'](_0x3ff67d=>_0x360845(_0x3ff67d));await Promise['all'](_0x67d299),_0x2e9967[_0x223f5b(0x1a1)](_0x3e798f);}),module[a0_0x583c21(0xff)]=router;