var a0_0x301283=a0_0x6c18;(function(_0x4af3d9,_0x5814e1){var _0x54265f=a0_0x6c18,_0x1417e3=_0x4af3d9();while(!![]){try{var _0x384061=-parseInt(_0x54265f(0xd5))/0x1+-parseInt(_0x54265f(0xc8))/0x2*(-parseInt(_0x54265f(0xd3))/0x3)+parseInt(_0x54265f(0x10a))/0x4*(parseInt(_0x54265f(0x150))/0x5)+-parseInt(_0x54265f(0xc7))/0x6*(parseInt(_0x54265f(0x124))/0x7)+-parseInt(_0x54265f(0x15e))/0x8*(-parseInt(_0x54265f(0x9f))/0x9)+-parseInt(_0x54265f(0x174))/0xa*(-parseInt(_0x54265f(0x18c))/0xb)+-parseInt(_0x54265f(0xdd))/0xc;if(_0x384061===_0x5814e1)break;else _0x1417e3['push'](_0x1417e3['shift']());}catch(_0x304998){_0x1417e3['push'](_0x1417e3['shift']());}}}(a0_0xb1ed,0xc801d));function a0_0x6c18(_0x23e77e,_0x1570bf){var _0xb1edb6=a0_0xb1ed();return a0_0x6c18=function(_0x6c186a,_0x12faf8){_0x6c186a=_0x6c186a-0x9e;var _0xabd90c=_0xb1edb6[_0x6c186a];return _0xabd90c;},a0_0x6c18(_0x23e77e,_0x1570bf);}function a0_0xb1ed(){var _0x4cd0d3=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','\x20Order\x20Date\x20:\x20','log','/barcode_scanner','error','$product_details.production_date','save','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Arabic\x20(ae)','$sale_product.floorlevel','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$sale_product.type','$product_details.bay','product_code','invoice','stocks','35405WBsnXv','filter','$invoice','$product.product_name','host','<!DOCTYPE\x20html>','RoomAssigned','then','</tr>','$product_details.secondary_code','post','date','\x20</h2>','string','1141640UEaOvj','return_data','isAllowEdit','type','../public/language/languages.json','product_name','user_id','sales_quantity','$product_details.primary_code','<h5\x20style=\x22text-align:\x20left;\x22>','random','password','$product_details._id','user','Level','/view/return_sales/:id','$product_details.product_name','/view/add_sales','product','$product_details.isle','<span\x20style=\x22float:\x20right;\x22>','$product','120LjgrRK','port','errors','</tbody>','Floor','<strong>\x20Regards\x20</strong>','$product_details.storage','/upload/','status','Sales\x20Update\x20successfully','English','$sale_product.bin','stock_data','<html><head><title></title>','$isAllowEdit','<tr>','add\x20post','level','id_transact','$product_details.product_cat','Enabled','warehouse_name','Sale\x20Return\x20Mail','product_stock','787138mEoUpP','/all_sales/preview/','batch_code','find','delivery_date','warehouse','customers_docs','$product_details.actual_uom','/view/:id','add_sales','</head><body>','Email\x20sent\x20successfully','received_amount','unit','storage','$product_details.expiry_date','$customer','sales\x20item\x20return\x20successfull','$note','_id','floorlevel','role','secondary_unit','prod_code','catch','customers','Receiving\x20Area','getFullYear','$sale_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','json','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.floorlevel','message','prod_cat','Portuguese','9bSTnHc','</h5>','sale_product','Portuguese\x20(BR)','True','$product_details.unit','primary_code','Logo.png','Arabic','stock','$product_details.product_stock','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$sale_product.bay','logo','Chinese','currency','rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','getMonth','max','carton','params','finalize','$sale_product.quantity','payment\x20successfull','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','name','</body></html>','floor','forEach','actual_qty','express','secondary_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','email','/view/add_sale/product','$name','site_title','image','quantity','402cfQsBt','716798CSstME','$product_details.batch_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Return\x20Goods','primary_unit','$date','sales\x20all_data','production_date','findById','12UzHFos','$product_details.secondary_unit','225175nZbRFr','requested_qty','Shelves','length','../middleware/auth','getDate','$warehouse_name','master','15608700iEPaHT','<table\x20style=\x22width:\x20100%\x20!important;\x22>','False','delivery_code','Ambient','staff','slice','$product_details.rack','product_details','<h5>','final','return_qty','$product_details.pallet','sales_invoice','Return\x20Rooms','room_name','</thead>','createTransport','render','expiry_date','currency_placement','success','SCRN','push','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$customers_docs','Sales\x20Add\x20successfully','$finalize','</td>','bin','abs','foreach\x20newproduct','French','map','types','<hr\x20class=\x22my-3\x22>','get','all_sales_barcode','</div>','flash','Enclosed','product_data','<div>','$product_details.bin','4zQGbzk','max_per_unit','Error\x20Occurs','sendMail','English\x20(US)','RMSEmail','$_id','back','body','redirect','language','maxperunit','Sale\x20Return','split','Raw\x20Materials','edit_sales','$product_details.maxPerUnit','/all_sales/view','amount','$room','findOne','German','aggregate','due_amount','sale_qty','<h2>\x20','10129RcPSli','barcode\x20Product\x20master','/../public','return_sale','$product_details.invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.type','/view','all','Router','Received\x20Payment\x20For\x20Sale','</table>','actual_uom','$product_details','OUT-','bay','id_transaction_from','product_list','exports','customer','Spanish','/preview/:id','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','\x20Order\x20Number\x20:\x20','quantity_notConverted','$product_details.actual_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'];a0_0xb1ed=function(){return _0x4cd0d3;};return a0_0xb1ed();}const express=require(a0_0x301283(0xbe)),app=express(),router=express[a0_0x301283(0x12d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x301283(0xd9)),nodemailer=require('nodemailer'),users=require(a0_0x301283(0x162));router[a0_0x301283(0x102)](a0_0x301283(0x12b),auth,async(_0x34eadd,_0x136908)=>{var _0x3a15d1=a0_0x301283;try{const {username:_0x445116,email:_0x374bba,role:_0xd95050}=_0x34eadd['user'],_0x450f81=_0x34eadd[_0x3a15d1(0x16b)],_0x4276ef=await profile[_0x3a15d1(0x11e)]({'email':_0x450f81[_0x3a15d1(0xc1)]}),_0x221b1b=await master_shop[_0x3a15d1(0x18f)]();let _0x532701;if(_0x450f81[_0x3a15d1(0x1a1)]=='staff'){const _0x4683dc=await staff[_0x3a15d1(0x11e)]({'email':_0x450f81[_0x3a15d1(0xc1)]});_0x532701=await sales[_0x3a15d1(0x120)]([{'$lookup':{'from':_0x3a15d1(0x1a5),'localField':_0x3a15d1(0x137),'foreignField':'name','as':_0x3a15d1(0x192)}},{'$unwind':_0x3a15d1(0xf7)},{'$unwind':_0x3a15d1(0x1a8)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3a15d1(0x152)},'customers':{'$first':_0x3a15d1(0x19c)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3a15d1(0xdb)},'sale_product':{'$push':_0x3a15d1(0x1a8)},'note':{'$first':_0x3a15d1(0x19e)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x3a15d1(0xf7)},'total_saleproduct_quantity':{'$sum':_0x3a15d1(0xb6)},'level':{'$addToSet':_0x3a15d1(0xab)},'isle':{'$addToSet':_0x3a15d1(0x17f)},'type':{'$addToSet':_0x3a15d1(0x14b)},'pallet':{'$addToSet':_0x3a15d1(0x149)},'finalize':{'$first':_0x3a15d1(0xf9)},'isAllowEdit':{'$first':_0x3a15d1(0x182)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x532701=await sales[_0x3a15d1(0x120)]([{'$lookup':{'from':_0x3a15d1(0x1a5),'localField':'customer','foreignField':_0x3a15d1(0xb9),'as':_0x3a15d1(0x192)}},{'$unwind':_0x3a15d1(0xf7)},{'$unwind':_0x3a15d1(0x1a8)},{'$group':{'_id':_0x3a15d1(0x110),'invoice':{'$first':_0x3a15d1(0x152)},'customers':{'$first':_0x3a15d1(0x19c)},'date':{'$first':_0x3a15d1(0xcf)},'warehouse_name':{'$first':_0x3a15d1(0xdb)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x3a15d1(0xb6)},'level':{'$addToSet':_0x3a15d1(0xab)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x3a15d1(0x14b)},'pallet':{'$addToSet':_0x3a15d1(0x149)},'finalize':{'$first':_0x3a15d1(0xf9)},'isAllowEdit':{'$first':_0x3a15d1(0x182)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3a15d1(0x142)](_0x3a15d1(0xd0),_0x532701);if(_0x221b1b[0x0][_0x3a15d1(0x114)]==_0x3a15d1(0x10e)){var _0x3938a7=users[_0x3a15d1(0x17e)];console[_0x3a15d1(0x142)](_0x3938a7);}else{if(_0x221b1b[0x0][_0x3a15d1(0x114)]==_0x3a15d1(0x1ab))var _0x3938a7=users[_0x3a15d1(0x1ab)];else{if(_0x221b1b[0x0]['language']=='German')var _0x3938a7=users[_0x3a15d1(0x11f)];else{if(_0x221b1b[0x0][_0x3a15d1(0x114)]==_0x3a15d1(0x138))var _0x3938a7=users[_0x3a15d1(0x138)];else{if(_0x221b1b[0x0]['language']==_0x3a15d1(0xfe))var _0x3938a7=users[_0x3a15d1(0xfe)];else{if(_0x221b1b[0x0]['language']=='Portuguese\x20(BR)')var _0x3938a7=users[_0x3a15d1(0x9e)];else{if(_0x221b1b[0x0]['language']=='Chinese')var _0x3938a7=users[_0x3a15d1(0xad)];else{if(_0x221b1b[0x0]['language']=='Arabic\x20(ae)')var _0x3938a7=users[_0x3a15d1(0xa7)];}}}}}}}_0x136908[_0x3a15d1(0xef)]('all_sales',{'success':_0x34eadd[_0x3a15d1(0x105)](_0x3a15d1(0xf2)),'errors':_0x34eadd[_0x3a15d1(0x105)]('errors'),'sales':_0x532701,'profile':_0x4276ef,'role':_0x450f81,'master_shop':_0x221b1b,'language':_0x3938a7});}catch(_0x5b22a9){console[_0x3a15d1(0x142)](_0x5b22a9);}});async function getRandom8DigitNumber(){var _0x11f3bb=a0_0x301283;const _0x433b5b=0x989680,_0x3fc6d6=0x5f5e0ff,_0x554662=Math[_0x11f3bb(0xbb)](Math[_0x11f3bb(0x168)]()*(_0x3fc6d6-_0x433b5b+0x1))+_0x433b5b;var _0x5ca145;const _0x2797cc=await sales[_0x11f3bb(0x11e)]({'invoice':_0x11f3bb(0x132)+_0x554662});return _0x2797cc&&_0x2797cc['length']>0x0?_0x5ca145=_0x11f3bb(0x132)+_0x554662:_0x5ca145=_0x11f3bb(0x132)+_0x554662,_0x5ca145;}router[a0_0x301283(0x102)](a0_0x301283(0x16f),auth,async(_0x3c70eb,_0x4a4c04)=>{var _0x43c995=a0_0x301283;try{const {username:_0x456abd,email:_0x26c100,role:_0x3cae40}=_0x3c70eb[_0x43c995(0x16b)],_0x1b9c09=_0x3c70eb['user'],_0xd3f24b=await profile['findOne']({'email':_0x1b9c09[_0x43c995(0xc1)]}),_0x307507=await master_shop[_0x43c995(0x18f)](),_0x5cce56=await customer['find']({});let _0x8670b9;if(_0x1b9c09[_0x43c995(0x1a1)]==_0x43c995(0xe2)){const _0xd53c8a=await staff[_0x43c995(0x11e)]({'email':_0x1b9c09[_0x43c995(0xc1)]});_0x8670b9=await warehouse['aggregate']([{'$match':{'status':_0x43c995(0x188),'name':_0xd53c8a[_0x43c995(0x191)],'warehouse_category':_0x43c995(0x118),'name':{'$ne':_0x43c995(0xcd)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x8670b9=await warehouse[_0x43c995(0x120)]([{'$match':{'status':_0x43c995(0x188),'warehouse_category':_0x43c995(0x118),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x43c995(0xc3)}}},{'$sort':{'name':0x1}}]);const _0x9a491=await product[_0x43c995(0x18f)]({});var _0x215932=[_0x43c995(0xe1),'Enclosed'];const _0x4139e3=await sales[_0x43c995(0x18f)]({}),_0x11bfef=_0x4139e3[_0x43c995(0xd8)]+0x1,_0x3c3dea=_0x43c995(0x132)+_0x11bfef['toString']()['padStart'](0x5,'0');if(_0x307507[0x0][_0x43c995(0x114)]==_0x43c995(0x10e)){var _0x1a1628=users[_0x43c995(0x17e)];console[_0x43c995(0x142)](_0x1a1628);}else{if(_0x307507[0x0][_0x43c995(0x114)]==_0x43c995(0x1ab))var _0x1a1628=users[_0x43c995(0x1ab)];else{if(_0x307507[0x0][_0x43c995(0x114)]==_0x43c995(0x11f))var _0x1a1628=users['German'];else{if(_0x307507[0x0][_0x43c995(0x114)]==_0x43c995(0x138))var _0x1a1628=users[_0x43c995(0x138)];else{if(_0x307507[0x0]['language']==_0x43c995(0xfe))var _0x1a1628=users[_0x43c995(0xfe)];else{if(_0x307507[0x0]['language']==_0x43c995(0xa2))var _0x1a1628=users[_0x43c995(0x9e)];else{if(_0x307507[0x0][_0x43c995(0x114)]==_0x43c995(0xad))var _0x1a1628=users[_0x43c995(0xad)];else{if(_0x307507[0x0][_0x43c995(0x114)]==_0x43c995(0x148))var _0x1a1628=users[_0x43c995(0xa7)];}}}}}}}const _0x1d48ed=getRandom8DigitNumber();_0x1d48ed[_0x43c995(0x157)](_0x22c9b1=>{var _0x37f769=_0x43c995;_0x4a4c04['render'](_0x37f769(0x195),{'success':_0x3c70eb[_0x37f769(0x105)]('success'),'errors':_0x3c70eb[_0x37f769(0x105)](_0x37f769(0x176)),'role':_0x1b9c09,'profile':_0xd3f24b,'customer':_0x5cce56,'warehouse':_0x8670b9,'product':_0x9a491,'invoice':_0x22c9b1,'master_shop':_0x307507,'language':_0x1a1628,'rooms_data':_0x215932});})[_0x43c995(0x1a4)](_0x181b92=>{var _0x1776a0=_0x43c995;_0x3c70eb[_0x1776a0(0x105)]('errors',_0x1776a0(0x147)),_0x4a4c04[_0x1776a0(0x113)]('/all_sales/view');});}catch(_0x47add6){console[_0x43c995(0x142)](_0x47add6);}}),router['get']('/view/add_sales/:id',auth,async(_0x4328fd,_0xc5a617)=>{var _0x405792=a0_0x301283;try{const _0x554ad1=_0x4328fd[_0x405792(0xb4)]['id'];console[_0x405792(0x142)](_0x554ad1);const _0x198e86=await product['find'](),_0x40dbab=await purchases['aggregate']([{'$match':{'warehouse_name':_0x554ad1}},{'$unwind':_0x405792(0x173)},{'$group':{'_id':_0x405792(0x153)}}]);console[_0x405792(0x142)]('purchases_data',_0x40dbab),_0xc5a617[_0x405792(0x17c)](0xc8)['json']({'purchases_data':_0x40dbab,'product_data':_0x198e86});}catch(_0x5d3e72){console[_0x405792(0x142)](_0x5d3e72);}}),router[a0_0x301283(0x15a)](a0_0x301283(0xc2),auth,async(_0x47e36a,_0x3d1f68)=>{var _0x4d1094=a0_0x301283;try{const {warehouse_data:_0x3ed839,product_data:_0x3bfda5}=_0x47e36a[_0x4d1094(0x112)];console[_0x4d1094(0x142)](_0x47e36a['body'][_0x4d1094(0x107)]);;const _0x3d112a=await master_shop[_0x4d1094(0x18f)]();console[_0x4d1094(0x142)](_0x4d1094(0xdc),_0x3d112a);const _0xc5fe06=await product['findOne']({'name':_0x3bfda5});console[_0x4d1094(0x142)](_0x4d1094(0x170),_0xc5fe06);const _0x3a7cea=await warehouse[_0x4d1094(0x120)]([{'$match':{'name':_0x3ed839}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x3bfda5}},{'$group':{'_id':_0x4d1094(0x16e),'product_stock':{'$first':_0x4d1094(0xa9)}}}]);console[_0x4d1094(0x142)](_0x4d1094(0x180),_0x3a7cea),_0x3d1f68[_0x4d1094(0x17c)](0xc8)[_0x4d1094(0x1aa)]({'master':_0x3d112a,'new_product':_0xc5fe06,'stock_data':_0x3a7cea});}catch(_0x5f9baa){console[_0x4d1094(0x142)](_0x5f9baa);}}),router[a0_0x301283(0x15a)]('/view/add_sales',auth,async(_0x39fb0b,_0x3688fb)=>{var _0xa97c99=a0_0x301283;try{const {invoice:_0xd160a8,date:_0x5b80f4,warehouse_name:_0x15acf3,product_name:_0x3a6d2b,stock:_0x2e1fc7,quantity:_0x480426,note:_0x430e0c,room:_0x35fb03,primary_code:_0x5f2996,secondary_code:_0x5ee451,prod_code:_0x2f9503,level:_0x4b72f7,isle:_0x2bd74f,pallet:_0x15deb3,batch_code:_0x38cf9d,SCRN:_0x32c9bc,expiry_date:_0xa56df0}=_0x39fb0b[_0xa97c99(0x112)];if(typeof _0x3a6d2b==_0xa97c99(0x15d))var _0x5984f3=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x163)]],_0x5efa4e=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xa8)]],_0x215393=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xb3)]],_0x149f17=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xa5)]],_0x28ee42=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xbf)]],_0xe4664a=[_0x39fb0b[_0xa97c99(0x112)]['prod_code']],_0x530c37=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x185)]],_0x284a68=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xce)]],_0x2b855d=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x1a2)]],_0x12a226=[_0x39fb0b[_0xa97c99(0x112)]['batch_code']],_0x275b9d=[_0x39fb0b['body'][_0xa97c99(0xf0)]],_0x202b45=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x10b)]],_0x43280d=[_0x39fb0b[_0xa97c99(0x112)]['production_date']],_0x3d271b=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xd6)]],_0x386f6e=[_0x39fb0b['body'][_0xa97c99(0x190)]],_0x500339=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xe0)]],_0x5a3380=[_0x39fb0b['body'][_0xa97c99(0x1af)]],_0x1a220d=[_0x39fb0b['body'][_0xa97c99(0xc6)]],_0x4db2b0=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x156)]],_0xa8aca=[_0x39fb0b[_0xa97c99(0x112)]['prod_invoice']],_0x40048b=[_0x39fb0b['body'][_0xa97c99(0xbd)]],_0x3652da=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x130)]],_0x111c13=[_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x186)]];else var _0x5984f3=[..._0x39fb0b[_0xa97c99(0x112)]['product_name']],_0x5efa4e=[..._0x39fb0b[_0xa97c99(0x112)]['stock']],_0x215393=[..._0x39fb0b['body'][_0xa97c99(0xb3)]],_0x149f17=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xa5)]],_0x28ee42=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xbf)]],_0xe4664a=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x1a3)]],_0x530c37=[..._0x39fb0b[_0xa97c99(0x112)]['level']],_0x284a68=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xce)]],_0x2b855d=[..._0x39fb0b[_0xa97c99(0x112)]['secondary_unit']],_0x12a226=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x18e)]],_0x275b9d=[..._0x39fb0b[_0xa97c99(0x112)]['expiry_date']],_0x202b45=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x10b)]],_0x43280d=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xd1)]],_0x3d271b=[..._0x39fb0b['body'][_0xa97c99(0xd6)]],_0x386f6e=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x190)]],_0x500339=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xe0)]],_0x5a3380=[..._0x39fb0b['body'][_0xa97c99(0x1af)]],_0x1a220d=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xc6)]],_0x4db2b0=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x156)]],_0xa8aca=[..._0x39fb0b['body']['prod_invoice']],_0x40048b=[..._0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0xbd)]],_0x3652da=[..._0x39fb0b[_0xa97c99(0x112)]['actual_uom']],_0x111c13=[..._0x39fb0b['body'][_0xa97c99(0x186)]];const _0x2b51d3=_0x5984f3[_0xa97c99(0xff)](_0x33cd46=>{return _0x33cd46={'product_name':_0x33cd46};});_0x5efa4e['forEach']((_0x3cbcb9,_0x1befd3)=>{var _0x457dd4=_0xa97c99;_0x2b51d3[_0x1befd3][_0x457dd4(0xa8)]=Math[_0x457dd4(0xfc)](_0x3cbcb9);}),_0x40048b[_0xa97c99(0xbc)]((_0x47489c,_0x2179dd)=>{var _0x2a06d5=_0xa97c99;_0x2b51d3[_0x2179dd][_0x2a06d5(0xbd)]=Math['abs'](_0x47489c);}),_0x3652da[_0xa97c99(0xbc)]((_0x176943,_0x539f24)=>{var _0x6c97e1=_0xa97c99;_0x2b51d3[_0x539f24][_0x6c97e1(0x130)]=_0x176943;}),_0x111c13[_0xa97c99(0xbc)]((_0x2a4f4e,_0x4ca1e5)=>{var _0x221aae=_0xa97c99;_0x2b51d3[_0x4ca1e5][_0x221aae(0x134)]=_0x2a4f4e;}),_0x215393[_0xa97c99(0xbc)]((_0x25042d,_0x1f3336)=>{var _0x1f5503=_0xa97c99;_0x2b51d3[_0x1f3336][_0x1f5503(0xc6)]=_0x25042d;}),_0x149f17[_0xa97c99(0xbc)]((_0x1ad38f,_0x10361d)=>{var _0x5df818=_0xa97c99;_0x2b51d3[_0x10361d][_0x5df818(0xa5)]=_0x1ad38f;}),_0x28ee42['forEach']((_0x518541,_0x430870)=>{var _0x340ecd=_0xa97c99;_0x2b51d3[_0x430870][_0x340ecd(0xbf)]=_0x518541;}),_0xe4664a[_0xa97c99(0xbc)]((_0x142854,_0x24d84e)=>{var _0x405615=_0xa97c99;_0x2b51d3[_0x24d84e][_0x405615(0x14d)]=_0x142854;}),_0x530c37[_0xa97c99(0xbc)]((_0x14f727,_0x28deb1)=>{var _0xe55fa9=_0xa97c99;_0x4db2b0[_0xe55fa9(0xbc)]((_0x2da2c1,_0x1374d5)=>{var _0x10f6c2=_0xe55fa9;if(_0x2da2c1=='Receiving\x20Area'&&_0x28deb1==_0x1374d5){var _0x470659=_0x14f727[_0x10f6c2(0xe3)](0x3);_0x2b51d3[_0x28deb1][_0x10f6c2(0x19a)]=_0x14f727[0x0],_0x2b51d3[_0x28deb1][_0x10f6c2(0xaf)]=_0x14f727[0x1],_0x2b51d3[_0x28deb1][_0x10f6c2(0x133)]=0x0,_0x2b51d3[_0x28deb1]['bin']=0x0,_0x2b51d3[_0x28deb1][_0x10f6c2(0x161)]=_0x10f6c2(0x178),_0x2b51d3[_0x28deb1][_0x10f6c2(0x1a0)]=_0x470659;}else{if(_0x2da2c1==_0x10f6c2(0xd7)&&_0x28deb1==_0x1374d5){var _0x470659=_0x14f727[_0x10f6c2(0xe3)](0x3);_0x2b51d3[_0x28deb1][_0x10f6c2(0x19a)]=_0x14f727[0x0],_0x2b51d3[_0x28deb1][_0x10f6c2(0xaf)]=_0x14f727[0x1],_0x2b51d3[_0x28deb1][_0x10f6c2(0x133)]=0x0,_0x2b51d3[_0x28deb1][_0x10f6c2(0xfb)]=0x0,_0x2b51d3[_0x28deb1]['type']='Floor',_0x2b51d3[_0x28deb1]['floorlevel']=_0x14f727[0x5];}else{if(_0x28deb1==_0x1374d5){var _0xa6f93e;if(_0x14f727[0x4]=='L')_0xa6f93e=_0x10f6c2(0x16c);else _0x14f727[0x4]=='F'&&(_0xa6f93e='Floor');_0x2b51d3[_0x28deb1][_0x10f6c2(0x19a)]=_0x14f727[0x0],_0x2b51d3[_0x28deb1][_0x10f6c2(0xaf)]=_0x14f727[0x1],_0x2b51d3[_0x28deb1][_0x10f6c2(0x133)]=_0x14f727[0x2],_0x2b51d3[_0x28deb1][_0x10f6c2(0xfb)]=_0x14f727[0x3],_0x2b51d3[_0x28deb1][_0x10f6c2(0x161)]=_0xa6f93e,_0x2b51d3[_0x28deb1][_0x10f6c2(0x1a0)]=_0x14f727[0x5];}}}});}),_0x284a68[_0xa97c99(0xbc)]((_0xdd61e4,_0x17e8ef)=>{var _0x5ac5bd=_0xa97c99;_0x2b51d3[_0x17e8ef][_0x5ac5bd(0x199)]=_0xdd61e4;}),_0x2b855d['forEach']((_0x36a838,_0x2bf376)=>{var _0x2ff159=_0xa97c99;_0x2b51d3[_0x2bf376][_0x2ff159(0x1a2)]=_0x36a838;}),_0x12a226['forEach']((_0x2fea35,_0x5de2d0)=>{_0x2b51d3[_0x5de2d0]['batch_code']=_0x2fea35;}),_0x275b9d['forEach']((_0xb4d009,_0x2cffb9)=>{var _0x2a7a53=_0xa97c99;_0x2b51d3[_0x2cffb9][_0x2a7a53(0xf0)]=_0xb4d009;}),_0x202b45[_0xa97c99(0xbc)]((_0x3fadc3,_0x368bfc)=>{var _0x24939f=_0xa97c99;_0x2b51d3[_0x368bfc][_0x24939f(0x115)]=_0x3fadc3;}),_0x43280d['forEach']((_0xad167f,_0x2b1cc7)=>{var _0x4bd1b5=_0xa97c99;_0x2b51d3[_0x2b1cc7][_0x4bd1b5(0xd1)]=_0xad167f;}),_0x3d271b[_0xa97c99(0xbc)]((_0x461ab2,_0x31f0aa)=>{var _0x1eabdd=_0xa97c99;_0x2b51d3[_0x31f0aa][_0x1eabdd(0xd6)]=_0x461ab2;}),_0x386f6e[_0xa97c99(0xbc)]((_0x254b3b,_0x29ef8e)=>{_0x2b51d3[_0x29ef8e]['delivery_date']=_0x254b3b;}),_0x500339[_0xa97c99(0xbc)]((_0x425744,_0x1b12d7)=>{var _0x2dc58e=_0xa97c99;_0x2b51d3[_0x1b12d7][_0x2dc58e(0xe0)]=_0x425744;}),_0x5a3380[_0xa97c99(0xbc)]((_0x3f317f,_0xf7321)=>{var _0x2918ad=_0xa97c99;_0x2b51d3[_0xf7321][_0x2918ad(0x1af)]=_0x3f317f;}),_0x1a220d[_0xa97c99(0xbc)]((_0x438ba0,_0x2c70d5)=>{var _0x59df6e=_0xa97c99;_0x2b51d3[_0x2c70d5][_0x59df6e(0x13d)]=_0x438ba0;}),_0x4db2b0[_0xa97c99(0xbc)]((_0x4bb1cb,_0x5be682)=>{var _0x5ae3a1=_0xa97c99;_0x2b51d3[_0x5be682][_0x5ae3a1(0xec)]=_0x4bb1cb;}),_0xa8aca[_0xa97c99(0xbc)]((_0x21180f,_0x1c6496)=>{_0x2b51d3[_0x1c6496]['invoice']=_0x21180f;});var _0x256681=0x0;_0x2b51d3[_0xa97c99(0xbc)](_0x17a12f=>{var _0x38c80b=_0xa97c99;(_0x17a12f[_0x38c80b(0xa8)]<_0x17a12f[_0x38c80b(0x13d)]||_0x17a12f[_0x38c80b(0x13d)]==0x0)&&(console[_0x38c80b(0x142)](_0x38c80b(0xfd),_0x17a12f),_0x256681++);});const _0x14ce17=_0x2b51d3[_0xa97c99(0x151)](_0x2cc114=>_0x2cc114['quantity']!=='0'&&_0x2cc114[_0xa97c99(0xc6)]!==''),_0x49556a=new sales({'invoice':_0xd160a8,'customer':_0x39fb0b[_0xa97c99(0x112)][_0xa97c99(0x137)],'date':_0x5b80f4,'warehouse_name':_0x15acf3,'sale_product':_0x14ce17,'note':_0x430e0c,'room':_0x35fb03,'primary_code':_0x5f2996,'secondary_code':_0x5ee451,'prod_code':_0x2f9503,'SCRN':_0x32c9bc}),_0xbc96d0=await _0x49556a[_0xa97c99(0x146)]();_0x39fb0b[_0xa97c99(0x105)](_0xa97c99(0xf2),_0xa97c99(0xf8)),_0x3688fb[_0xa97c99(0x113)]('/all_sales/preview/'+_0xbc96d0[_0xa97c99(0x19f)]);}catch(_0x347c42){console[_0xa97c99(0x142)](_0x347c42);}}),router['get'](a0_0x301283(0x139),auth,async(_0x1d3b31,_0xa8fbaf)=>{var _0x564222=a0_0x301283;try{const {username:_0x27446c,email:_0x1ff243,role:_0x57af90}=_0x1d3b31[_0x564222(0x16b)],_0x70f284=_0x1d3b31[_0x564222(0x16b)],_0x538eda=await profile[_0x564222(0x11e)]({'email':_0x70f284[_0x564222(0xc1)]}),_0x1f80fc=await master_shop['find'](),_0x216f68=_0x1d3b31[_0x564222(0xb4)]['id'],_0x13a7a0=await sales[_0x564222(0xd2)](_0x216f68),_0x1aa090=await warehouse[_0x564222(0x120)]([{'$match':{'name':_0x13a7a0[_0x564222(0x189)]}},{'$unwind':_0x564222(0x131)},{'$group':{'_id':_0x564222(0x16a),'name':{'$first':_0x564222(0x16e)},'product_stock':{'$first':_0x564222(0xa9)},'bay':{'$first':_0x564222(0x14c)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x564222(0x12a)},'floorlevel':{'$first':_0x564222(0x1ad)},'primary_code':{'$first':_0x564222(0x166)},'secondary_code':{'$first':_0x564222(0x159)},'product_code':{'$first':_0x564222(0xf5)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x564222(0x19b)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x564222(0x128)}}}]),_0x1fefae=await customer[_0x564222(0x18f)]({});let _0x24b0f8;if(_0x70f284[_0x564222(0x1a1)]==_0x564222(0xe2)){const _0x518743=await staff[_0x564222(0x11e)]({'email':_0x70f284['email']});_0x24b0f8=await warehouse[_0x564222(0x120)]([{'$match':{'status':'Enabled','name':_0x518743[_0x564222(0x191)]}},{'$group':{'_id':'$name','name':{'$first':_0x564222(0xc3)}}}]);}else _0x24b0f8=await warehouse[_0x564222(0x120)]([{'$match':{'status':_0x564222(0x188)}},{'$group':{'_id':_0x564222(0xc3),'name':{'$first':_0x564222(0xc3)}}}]);const _0x4c200b=await product['find']({}),_0x512c3e=await suppliers[_0x564222(0x18f)]({});if(_0x1f80fc[0x0][_0x564222(0x114)]==_0x564222(0x10e)){var _0x5b5fe7=users[_0x564222(0x17e)];console[_0x564222(0x142)](_0x5b5fe7);}else{if(_0x1f80fc[0x0]['language']==_0x564222(0x1ab))var _0x5b5fe7=users[_0x564222(0x1ab)];else{if(_0x1f80fc[0x0][_0x564222(0x114)]==_0x564222(0x11f))var _0x5b5fe7=users[_0x564222(0x11f)];else{if(_0x1f80fc[0x0][_0x564222(0x114)]==_0x564222(0x138))var _0x5b5fe7=users[_0x564222(0x138)];else{if(_0x1f80fc[0x0]['language']==_0x564222(0xfe))var _0x5b5fe7=users[_0x564222(0xfe)];else{if(_0x1f80fc[0x0][_0x564222(0x114)]==_0x564222(0xa2))var _0x5b5fe7=users['Portuguese'];else{if(_0x1f80fc[0x0][_0x564222(0x114)]=='Chinese')var _0x5b5fe7=users['Chinese'];else{if(_0x1f80fc[0x0][_0x564222(0x114)]==_0x564222(0x148))var _0x5b5fe7=users[_0x564222(0xa7)];}}}}}}}_0xa8fbaf[_0x564222(0xef)]('edit_sales_view',{'success':_0x1d3b31[_0x564222(0x105)]('success'),'errors':_0x1d3b31[_0x564222(0x105)](_0x564222(0x176)),'role':_0x70f284,'profile':_0x538eda,'customer':_0x1fefae,'warehouse':_0x24b0f8,'product':_0x1aa090,'user':_0x13a7a0,'master_shop':_0x1f80fc,'unit':_0x4c200b,'language':_0x5b5fe7,'suppliers':_0x512c3e});}catch(_0x4fe6df){console[_0x564222(0x142)](_0x4fe6df);}}),router[a0_0x301283(0x15a)](a0_0x301283(0x139),auth,async(_0x2c6f7f,_0x161c4a)=>{var _0x3f007e=a0_0x301283;try{const _0x52163f=_0x2c6f7f[_0x3f007e(0xb4)]['id'],{invoice:_0x563b0f,warehouse_name:_0x17980e,room:_0x2fb6a8}=_0x2c6f7f[_0x3f007e(0x112)],_0xb4281e=await sales[_0x3f007e(0x11e)]({'invoice':_0x563b0f}),_0x3ad572=_0xb4281e[_0x3f007e(0xa1)][_0x3f007e(0xff)](async _0x328e3d=>{var _0x30140c=_0x3f007e,_0x50073e=await warehouse[_0x30140c(0x11e)]({'name':_0x17980e,'room':_0x328e3d[_0x30140c(0xec)],'warehouse_category':_0x30140c(0x118)});const _0x4b3a0f=_0x50073e[_0x30140c(0xe5)][_0x30140c(0xff)](_0x561802=>{var _0x5a09f9=_0x30140c;_0x561802['product_name']==_0x328e3d[_0x5a09f9(0x163)]&&_0x561802['floorlevel']==_0x328e3d[_0x5a09f9(0x1a0)]&&_0x561802[_0x5a09f9(0x161)]==_0x328e3d[_0x5a09f9(0x161)]&&_0x561802[_0x5a09f9(0xfb)]==_0x328e3d[_0x5a09f9(0xfb)]&&_0x561802['bay']==_0x328e3d[_0x5a09f9(0x133)]&&_0x561802[_0x5a09f9(0xaf)]==_0x328e3d[_0x5a09f9(0xaf)]&&_0x561802[_0x5a09f9(0x19a)]==_0x328e3d[_0x5a09f9(0x19a)]&&_0x561802[_0x5a09f9(0xf0)]==_0x328e3d['expiry_date']&&_0x561802['batch_code']==_0x328e3d['batch_code']&&_0x561802[_0x5a09f9(0x14e)]==_0x328e3d['invoice']&&_0x561802[_0x5a09f9(0x19f)]==_0x328e3d[_0x5a09f9(0x134)]&&(_0x561802[_0x5a09f9(0x18b)]=Math[_0x5a09f9(0xb2)](0x0,Math['abs'](_0x561802['product_stock'])-Math[_0x5a09f9(0xfc)](_0x328e3d[_0x5a09f9(0xc6)])));});return _0x50073e;});Promise[_0x3f007e(0x12c)](_0x3ad572)['then'](async _0x24f56e=>{var _0x48e114=_0x3f007e;try{for(const _0x1ea5d1 of _0x24f56e){await _0x1ea5d1['save']();}_0xb4281e['finalize']='True';const _0x230adf=await _0xb4281e['save'](),_0x2b56ef=await master_shop[_0x48e114(0x18f)](),_0x8c4e8a=await email_settings[_0x48e114(0x11e)](),_0x199d65=await supervisor_settings[_0x48e114(0x18f)]();var _0x40de8b=_0xb4281e[_0x48e114(0xa1)],_0x215648='',_0x519c59;for(_0x519c59 in _0x40de8b){_0x215648+='<tr>'+_0x48e114(0xc0)+_0x40de8b[_0x519c59]['product_name']+_0x48e114(0xfa)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x40de8b[_0x519c59][_0x48e114(0x14d)]+_0x48e114(0xfa)+_0x48e114(0xc0)+_0x40de8b[_0x519c59]['quantity']+_0x48e114(0xfa)+_0x48e114(0xc0)+_0x40de8b[_0x519c59][_0x48e114(0x199)]+_0x48e114(0xfa)+_0x48e114(0xc0)+_0x40de8b[_0x519c59][_0x48e114(0x1a2)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xb4281e[_0x48e114(0x189)]+_0x48e114(0xfa)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x40de8b[_0x519c59][_0x48e114(0xec)]+_0x48e114(0xfa)+_0x48e114(0xc0)+_0x40de8b[_0x519c59]['storage']+_0x40de8b[_0x519c59]['rack']+_0x40de8b[_0x519c59][_0x48e114(0x133)]+_0x40de8b[_0x519c59]['bin']+_0x40de8b[_0x519c59][_0x48e114(0x161)][0x0]+_0x40de8b[_0x519c59]['floorlevel']+_0x48e114(0xfa),_0x48e114(0x158);}let _0xa67671=nodemailer[_0x48e114(0xee)]({'host':_0x8c4e8a[_0x48e114(0x154)],'port':Number(_0x8c4e8a[_0x48e114(0x175)]),'secure':![],'auth':{'user':_0x8c4e8a['email'],'pass':_0x8c4e8a['password']}}),_0x3a84b1={'from':_0x8c4e8a[_0x48e114(0xc1)],'to':_0x199d65[0x0][_0x48e114(0x10f)],'subject':'Sales\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x48e114(0x126)+_0x48e114(0x17b)+_0x2b56ef[0x0][_0x48e114(0xc5)],'cid':_0x48e114(0xac)}],'html':_0x48e114(0x155)+_0x48e114(0x181)+_0x48e114(0x196)+_0x48e114(0x108)+_0x48e114(0xaa)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x48e114(0x104)+_0x48e114(0x108)+_0x48e114(0x123)+_0x2b56ef[0x0][_0x48e114(0xc4)]+'\x20</h2>'+'</div>'+_0x48e114(0x104)+'<hr\x20class=\x22my-3\x22>'+_0x48e114(0x108)+_0x48e114(0x167)+_0x48e114(0x13c)+_0xb4281e['invoice']+'\x20'+_0x48e114(0x172)+_0x48e114(0x141)+_0xb4281e[_0x48e114(0x15b)]+'\x20'+'</span>'+'</h5>'+'</div>'+_0x48e114(0xde)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x48e114(0x183)+_0x48e114(0x140)+_0x48e114(0x1a9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x48e114(0x13b)+_0x48e114(0xb0)+_0x48e114(0xcc)+_0x48e114(0x129)+_0x48e114(0x13f)+'</tr>'+'</thead>'+_0x48e114(0xcb)+'\x20'+_0x215648+'\x20'+_0x48e114(0x177)+_0x48e114(0x12f)+_0x48e114(0x108)+_0x48e114(0x179)+_0x48e114(0xe6)+_0x2b56ef[0x0]['site_title']+_0x48e114(0xa0)+'</div>'+_0x48e114(0x104)+_0x48e114(0xba)};_0xa67671[_0x48e114(0x10d)](_0x3a84b1,function(_0x490dfd,_0x1d37d7){var _0x37f0ee=_0x48e114;_0x490dfd?(console[_0x37f0ee(0x142)](_0x490dfd),console[_0x37f0ee(0x142)](_0x37f0ee(0x10c))):console[_0x37f0ee(0x142)](_0x37f0ee(0x197));}),_0x2c6f7f[_0x48e114(0x105)](_0x48e114(0xf2),_0x48e114(0x17d)),_0x161c4a[_0x48e114(0x113)](_0x48e114(0x18d)+_0x52163f);}catch(_0x1439ee){console['error'](_0x1439ee),_0x161c4a[_0x48e114(0x17c)](0x1f4)[_0x48e114(0x1aa)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x3f007e(0x1a4)](_0x9aef97=>{var _0x51df1c=_0x3f007e;console[_0x51df1c(0x144)](_0x9aef97),_0x161c4a[_0x51df1c(0x17c)](0x1f4)[_0x51df1c(0x1aa)]({'error':'An\x20error\x20occurred.'});});}catch(_0x141db7){console[_0x3f007e(0x142)](_0x141db7);}}),router[a0_0x301283(0x102)]('/view/:id',auth,async(_0x147155,_0x4ed909)=>{var _0x346159=a0_0x301283;try{const {username:_0xe833aa,email:_0x1d494b,role:_0x346cb2}=_0x147155[_0x346159(0x16b)],_0xa44ec6=_0x147155[_0x346159(0x16b)],_0x5258cb=await profile['findOne']({'email':_0xa44ec6[_0x346159(0xc1)]}),_0xef9b54=await master_shop[_0x346159(0x18f)](),_0x344d7f=_0x147155[_0x346159(0xb4)]['id'],_0x16f8a7=await sales[_0x346159(0xd2)](_0x344d7f);var _0x3cb2e6=[_0x346159(0xe1),_0x346159(0x106)];const _0x258bf7=await warehouse[_0x346159(0x120)]([{'$match':{'name':_0x16f8a7['warehouse_name'],'warehouse_category':_0x346159(0x118)}},{'$unwind':_0x346159(0x131)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x346159(0x16e)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x346159(0x109)},'type':{'$first':_0x346159(0x12a)},'floorlevel':{'$first':_0x346159(0x1ad)},'primary_code':{'$first':_0x346159(0x166)},'secondary_code':{'$first':_0x346159(0x159)},'product_code':{'$first':_0x346159(0xf5)},'storage':{'$first':_0x346159(0x17a)},'rack':{'$first':_0x346159(0xe4)}}}]),_0x3ede6f=await customer[_0x346159(0x18f)]({});let _0x70d941;if(_0xa44ec6[_0x346159(0x1a1)]==_0x346159(0xe2)){const _0x29ce13=await staff[_0x346159(0x11e)]({'email':_0xa44ec6['email']});_0x70d941=await warehouse[_0x346159(0x120)]([{'$match':{'status':_0x346159(0x188),'name':_0x29ce13[_0x346159(0x191)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x70d941=await warehouse[_0x346159(0x120)]([{'$match':{'status':_0x346159(0x188),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x346159(0xc3),'name':{'$first':_0x346159(0xc3)}}}]);const _0x41956c=await product[_0x346159(0x18f)]({});if(_0xef9b54[0x0][_0x346159(0x114)]==_0x346159(0x10e)){var _0x313569=users[_0x346159(0x17e)];console[_0x346159(0x142)](_0x313569);}else{if(_0xef9b54[0x0][_0x346159(0x114)]==_0x346159(0x1ab))var _0x313569=users[_0x346159(0x1ab)];else{if(_0xef9b54[0x0][_0x346159(0x114)]==_0x346159(0x11f))var _0x313569=users[_0x346159(0x11f)];else{if(_0xef9b54[0x0][_0x346159(0x114)]=='Spanish')var _0x313569=users['Spanish'];else{if(_0xef9b54[0x0]['language']=='French')var _0x313569=users['French'];else{if(_0xef9b54[0x0][_0x346159(0x114)]==_0x346159(0xa2))var _0x313569=users[_0x346159(0x9e)];else{if(_0xef9b54[0x0][_0x346159(0x114)]==_0x346159(0xad))var _0x313569=users[_0x346159(0xad)];else{if(_0xef9b54[0x0][_0x346159(0x114)]==_0x346159(0x148))var _0x313569=users['Arabic'];}}}}}}}_0x4ed909[_0x346159(0xef)](_0x346159(0x119),{'success':_0x147155[_0x346159(0x105)](_0x346159(0xf2)),'errors':_0x147155[_0x346159(0x105)](_0x346159(0x176)),'role':_0xa44ec6,'profile':_0x5258cb,'customer':_0x3ede6f,'warehouse':_0x70d941,'product':_0x258bf7,'user':_0x16f8a7,'master_shop':_0xef9b54,'unit':_0x41956c,'language':_0x313569});}catch(_0x2dce7f){console[_0x346159(0x142)](_0x2dce7f);}}),router[a0_0x301283(0x15a)](a0_0x301283(0x194),auth,async(_0x28ef6b,_0x227515)=>{var _0x2c1df7=a0_0x301283;try{const _0x303600=_0x28ef6b['params']['id'],_0x467120=await sales[_0x2c1df7(0x11e)]({'_id':_0x28ef6b[_0x2c1df7(0xb4)]['id']}),_0x363a04=await warehouse[_0x2c1df7(0x11e)]({'name':_0x467120[_0x2c1df7(0x189)],'room':_0x28ef6b['body']['room']}),{invoice:_0x3e3144,date:_0x112cf5,warehouse_name:_0x35abeb,product_name:_0x27970f,stock:_0x404c6a,quantity:_0x1b2a89,note:_0x44da60,room:_0x1f063f,customer:_0x26ff56,SCRN:_0x2eb4bc}=_0x28ef6b['body'];if(typeof _0x27970f==_0x2c1df7(0x15d))var _0x1b63ab=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x163)]],_0x41eca6=[_0x28ef6b['body'][_0x2c1df7(0xa8)]],_0x107cc7=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xb3)]],_0x4d43db=[_0x28ef6b['body'][_0x2c1df7(0xa5)]],_0x387c8a=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xbf)]],_0x39d0d9=[_0x28ef6b['body'][_0x2c1df7(0x1a3)]],_0x308ef7=[_0x28ef6b[_0x2c1df7(0x112)]['level']],_0x408262=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xce)]],_0xbd196=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x1a2)]],_0x3050ab=[_0x28ef6b['body'][_0x2c1df7(0x18e)]],_0x2a55be=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xf0)]],_0x1eb337=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x10b)]],_0x162143=[_0x28ef6b['body'][_0x2c1df7(0xd1)]],_0x56c46c=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xd6)]],_0x463d09=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x190)]],_0x25912b=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xe0)]],_0x197f7a=[_0x28ef6b[_0x2c1df7(0x112)]['prod_cat']],_0x2bca81=[_0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xc6)]],_0x1e2b96=[_0x28ef6b[_0x2c1df7(0x112)]['RoomAssigned']];else var _0x1b63ab=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x163)]],_0x41eca6=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xa8)]],_0x107cc7=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xb3)]],_0x4d43db=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xa5)]],_0x387c8a=[..._0x28ef6b['body'][_0x2c1df7(0xbf)]],_0x39d0d9=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x1a3)]],_0x308ef7=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x185)]],_0x408262=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xce)]],_0xbd196=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x1a2)]],_0x3050ab=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x18e)]],_0x2a55be=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xf0)]],_0x1eb337=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x10b)]],_0x162143=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xd1)]],_0x56c46c=[..._0x28ef6b[_0x2c1df7(0x112)]['requested_qty']],_0x463d09=[..._0x28ef6b[_0x2c1df7(0x112)]['delivery_date']],_0x25912b=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xe0)]],_0x197f7a=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x1af)]],_0x2bca81=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0xc6)]],_0x1e2b96=[..._0x28ef6b[_0x2c1df7(0x112)][_0x2c1df7(0x156)]];const _0x478f07=_0x1b63ab[_0x2c1df7(0xff)](_0x5d6194=>{return _0x5d6194={'product_name':_0x5d6194};});_0x41eca6[_0x2c1df7(0xbc)]((_0x216504,_0x406a28)=>{var _0x34ecf9=_0x2c1df7;_0x478f07[_0x406a28][_0x34ecf9(0xa8)]=Math[_0x34ecf9(0xfc)](_0x216504);}),_0x107cc7[_0x2c1df7(0xbc)]((_0x3d346c,_0x31e1b7)=>{_0x478f07[_0x31e1b7]['quantity']=_0x3d346c;}),_0x4d43db['forEach']((_0x196307,_0x97f202)=>{var _0x380fda=_0x2c1df7;_0x478f07[_0x97f202][_0x380fda(0xa5)]=_0x196307;}),_0x387c8a[_0x2c1df7(0xbc)]((_0x877df0,_0x696848)=>{var _0x401f0f=_0x2c1df7;_0x478f07[_0x696848][_0x401f0f(0xbf)]=_0x877df0;}),_0x39d0d9[_0x2c1df7(0xbc)]((_0x22f1db,_0x36d949)=>{var _0x41914d=_0x2c1df7;_0x478f07[_0x36d949][_0x41914d(0x14d)]=_0x22f1db;}),_0x308ef7[_0x2c1df7(0xbc)]((_0x35870f,_0x2dde28)=>{var _0x347581=_0x2c1df7;_0x1e2b96[_0x347581(0xbc)]((_0x1466c0,_0x137404)=>{var _0x5b7c0f=_0x347581;if(_0x1466c0==_0x5b7c0f(0x1a6)&&_0x2dde28==_0x137404){var _0x9c40f1=_0x35870f[_0x5b7c0f(0xe3)](0x3);_0x478f07[_0x2dde28][_0x5b7c0f(0x19a)]=_0x35870f[0x0],_0x478f07[_0x2dde28][_0x5b7c0f(0xaf)]=_0x35870f[0x1],_0x478f07[_0x2dde28][_0x5b7c0f(0x133)]=0x0,_0x478f07[_0x2dde28][_0x5b7c0f(0xfb)]=0x0,_0x478f07[_0x2dde28][_0x5b7c0f(0x161)]=_0x5b7c0f(0x178),_0x478f07[_0x2dde28][_0x5b7c0f(0x1a0)]=_0x9c40f1;}else{if(_0x1466c0=='Shelves'&&_0x2dde28==_0x137404){var _0x9c40f1=_0x35870f['slice'](0x3);_0x478f07[_0x2dde28]['storage']=_0x35870f[0x0],_0x478f07[_0x2dde28][_0x5b7c0f(0xaf)]=_0x35870f[0x1],_0x478f07[_0x2dde28][_0x5b7c0f(0x133)]=0x0,_0x478f07[_0x2dde28][_0x5b7c0f(0xfb)]=0x0,_0x478f07[_0x2dde28][_0x5b7c0f(0x161)]=_0x5b7c0f(0x178),_0x478f07[_0x2dde28]['floorlevel']=_0x35870f[0x5];}else{if(_0x2dde28==_0x137404){var _0x27ecb8;if(_0x35870f[0x4]=='L')_0x27ecb8='Level';else _0x35870f[0x4]=='F'&&(_0x27ecb8=_0x5b7c0f(0x178));_0x478f07[_0x2dde28][_0x5b7c0f(0x19a)]=_0x35870f[0x0],_0x478f07[_0x2dde28][_0x5b7c0f(0xaf)]=_0x35870f[0x1],_0x478f07[_0x2dde28]['bay']=_0x35870f[0x2],_0x478f07[_0x2dde28][_0x5b7c0f(0xfb)]=_0x35870f[0x3],_0x478f07[_0x2dde28][_0x5b7c0f(0x161)]=_0x27ecb8,_0x478f07[_0x2dde28][_0x5b7c0f(0x1a0)]=_0x35870f[0x5];}}}});}),_0x408262['forEach']((_0x18144b,_0x6ddec7)=>{_0x478f07[_0x6ddec7]['unit']=_0x18144b;}),_0xbd196[_0x2c1df7(0xbc)]((_0x24c422,_0x520c28)=>{var _0x4ab3e1=_0x2c1df7;_0x478f07[_0x520c28][_0x4ab3e1(0x1a2)]=_0x24c422;}),_0x3050ab[_0x2c1df7(0xbc)]((_0x3547b2,_0x393f24)=>{var _0x231818=_0x2c1df7;_0x478f07[_0x393f24][_0x231818(0x18e)]=_0x3547b2;}),_0x2a55be[_0x2c1df7(0xbc)]((_0x3bc24c,_0x47c4ce)=>{_0x478f07[_0x47c4ce]['expiry_date']=_0x3bc24c;}),_0x1eb337[_0x2c1df7(0xbc)]((_0x799462,_0x59435b)=>{var _0x13d6fc=_0x2c1df7;_0x478f07[_0x59435b][_0x13d6fc(0x115)]=_0x799462;}),_0x162143[_0x2c1df7(0xbc)]((_0xebf109,_0x48671f)=>{var _0x3302cb=_0x2c1df7;_0x478f07[_0x48671f][_0x3302cb(0xd1)]=_0xebf109;}),_0x56c46c[_0x2c1df7(0xbc)]((_0x59504a,_0x2e0197)=>{var _0x2a72b6=_0x2c1df7;_0x478f07[_0x2e0197][_0x2a72b6(0xd6)]=Math[_0x2a72b6(0xfc)](_0x59504a);}),_0x463d09['forEach']((_0x1c3b66,_0x3e1605)=>{_0x478f07[_0x3e1605]['delivery_date']=_0x1c3b66;}),_0x25912b['forEach']((_0xc45939,_0x847c56)=>{var _0x20b841=_0x2c1df7;_0x478f07[_0x847c56][_0x20b841(0xe0)]=_0xc45939;}),_0x197f7a[_0x2c1df7(0xbc)]((_0x1acd1c,_0x43d4d5)=>{_0x478f07[_0x43d4d5]['prod_cat']=_0x1acd1c;}),_0x2bca81['forEach']((_0x152175,_0x21becd)=>{var _0x4f4ae2=_0x2c1df7;_0x478f07[_0x21becd][_0x4f4ae2(0x13d)]=_0x152175;}),_0x1e2b96[_0x2c1df7(0xbc)]((_0x16154,_0xc76254)=>{_0x478f07[_0xc76254]['room_name']=_0x16154;});var _0x5e0a34=0x0;_0x478f07['forEach'](_0x25d826=>{var _0x3effdc=_0x2c1df7;console[_0x3effdc(0x142)]('foreach\x20newproduct',_0x25d826),(parseInt(_0x25d826[_0x3effdc(0xa8)])<parseInt(_0x25d826[_0x3effdc(0xc6)])||parseInt(_0x25d826['quantity'])==0x0)&&_0x5e0a34++;});if(_0x5e0a34!=0x0)return _0x28ef6b['flash'](_0x2c1df7(0x176),_0x2c1df7(0x14a)),_0x227515[_0x2c1df7(0x113)](_0x2c1df7(0x111));const _0x5e3c0a=_0x478f07['filter'](_0xd281cc=>_0xd281cc['quantity']!=='0'&&_0xd281cc[_0x2c1df7(0xc6)]!=='');_0x467120['invoice']=_0x3e3144,_0x467120[_0x2c1df7(0x137)]=_0x26ff56,_0x467120[_0x2c1df7(0x15b)]=_0x112cf5,_0x467120[_0x2c1df7(0x189)]=_0x35abeb,_0x467120[_0x2c1df7(0xa1)]=_0x5e3c0a,_0x467120[_0x2c1df7(0x13a)]=_0x44da60,_0x467120[_0x2c1df7(0xf3)]=_0x2eb4bc,_0x467120[_0x2c1df7(0xb5)]=_0x2c1df7(0xdf),_0x467120[_0x2c1df7(0x160)]=_0x2c1df7(0xdf);const _0x1e0772=await _0x467120[_0x2c1df7(0x146)]();_0x28ef6b[_0x2c1df7(0x105)](_0x2c1df7(0xf2),_0x2c1df7(0x17d)),_0x227515[_0x2c1df7(0x113)](_0x2c1df7(0x11b));}catch(_0x37010b){console[_0x2c1df7(0x142)](_0x37010b);}}),router[a0_0x301283(0x15a)]('/give_payment/:id',auth,async(_0x446ed8,_0x47f783)=>{var _0x34166f=a0_0x301283;try{const _0x13c10a=_0x446ed8[_0x34166f(0xb4)]['id'],{invoice:_0x41a829,customer:_0x5d5ee9,receivable_amount:_0x1468cd,received_amount:_0xfd5277}=_0x446ed8[_0x34166f(0x112)],_0x119dec=await sales[_0x34166f(0xd2)](_0x13c10a);console['log'](_0x119dec);var _0x18c58f=_0x1468cd-_0xfd5277;console['log'](_0xfd5277),_0x119dec[_0x34166f(0x198)]=parseFloat(_0xfd5277)+parseFloat(_0x119dec[_0x34166f(0x198)]),_0x119dec[_0x34166f(0x121)]=_0x18c58f,console[_0x34166f(0x142)](_0x119dec);const _0x5a458f=await _0x119dec['save'](),_0x31114f=await c_payment_data[_0x34166f(0x11e)]({'invoice':_0x41a829});_0x31114f[_0x34166f(0x11c)]=_0x18c58f,await _0x31114f[_0x34166f(0x146)]();let _0x4a231f=new Date(),_0x11f07f=('0'+_0x4a231f[_0x34166f(0xda)]())[_0x34166f(0xe3)](-0x2),_0x191491=('0'+(_0x4a231f[_0x34166f(0xb1)]()+0x1))[_0x34166f(0xe3)](-0x2),_0x293a62=_0x4a231f[_0x34166f(0x1a7)](),_0x3886aa=_0x293a62+'-'+_0x191491+'-'+_0x11f07f;const _0x478f2f=new customer_payment({'invoice':_0x41a829,'date':_0x293a62+'-'+_0x191491+'-'+_0x11f07f,'customer':_0x5d5ee9,'reason':_0x34166f(0x12e),'amount':_0xfd5277}),_0x14a931=await _0x478f2f[_0x34166f(0x146)]();_0x446ed8[_0x34166f(0x105)](_0x34166f(0xf2),_0x34166f(0xb7)),_0x47f783[_0x34166f(0x113)](_0x34166f(0x11b));}catch(_0x11f6b2){console['log'](_0x11f6b2);}}),router[a0_0x301283(0x102)]('/invoice/:id',auth,async(_0x364ebf,_0x1fedc3)=>{var _0x3bd447=a0_0x301283;try{const {username:_0x23e503,email:_0x5b9519,role:_0x3f1889}=_0x364ebf[_0x3bd447(0x16b)],_0x1336a9=_0x364ebf[_0x3bd447(0x16b)],_0x1c9d11=await profile[_0x3bd447(0x11e)]({'email':_0x1336a9['email']}),_0x32365e=await master_shop[_0x3bd447(0x18f)]();console[_0x3bd447(0x142)](_0x3bd447(0xdc),_0x32365e);const _0xba952a=_0x364ebf[_0x3bd447(0xb4)]['id'],_0x1a714f=await sales[_0x3bd447(0xd2)](_0xba952a);console[_0x3bd447(0x142)](_0x1a714f);const _0x3aea74=await customer[_0x3bd447(0x11e)]({'name':_0x1a714f[_0x3bd447(0x137)]});console[_0x3bd447(0x142)](_0x3aea74);if(_0x32365e[0x0][_0x3bd447(0x114)]==_0x3bd447(0x10e)){var _0x23bc4a=users[_0x3bd447(0x17e)];console[_0x3bd447(0x142)](_0x23bc4a);}else{if(_0x32365e[0x0][_0x3bd447(0x114)]=='Hindi')var _0x23bc4a=users[_0x3bd447(0x1ab)];else{if(_0x32365e[0x0]['language']==_0x3bd447(0x11f))var _0x23bc4a=users[_0x3bd447(0x11f)];else{if(_0x32365e[0x0][_0x3bd447(0x114)]=='Spanish')var _0x23bc4a=users['Spanish'];else{if(_0x32365e[0x0][_0x3bd447(0x114)]=='French')var _0x23bc4a=users[_0x3bd447(0xfe)];else{if(_0x32365e[0x0][_0x3bd447(0x114)]==_0x3bd447(0xa2))var _0x23bc4a=users[_0x3bd447(0x9e)];else{if(_0x32365e[0x0][_0x3bd447(0x114)]==_0x3bd447(0xad))var _0x23bc4a=users[_0x3bd447(0xad)];else{if(_0x32365e[0x0][_0x3bd447(0x114)]==_0x3bd447(0x148))var _0x23bc4a=users[_0x3bd447(0xa7)];}}}}}}}_0x1fedc3['render'](_0x3bd447(0xea),{'success':_0x364ebf[_0x3bd447(0x105)]('success'),'errors':_0x364ebf[_0x3bd447(0x105)]('errors'),'role':_0x1336a9,'profile':_0x1c9d11,'master_shop':_0x32365e,'customers':_0x3aea74,'sales':_0x1a714f,'language':_0x23bc4a});}catch(_0x131515){console['log'](_0x131515);}}),router[a0_0x301283(0x102)](a0_0x301283(0x16d),auth,async(_0x14edf7,_0x287005)=>{var _0x3538de=a0_0x301283;try{const {username:_0x192935,email:_0x41975d,role:_0x29e2de}=_0x14edf7[_0x3538de(0x16b)],_0x4cb12c=_0x14edf7['user'],_0x31a627=await profile['findOne']({'email':_0x4cb12c['email']}),_0x1505f2=await master_shop['find']();console[_0x3538de(0x142)](_0x3538de(0xdc),_0x1505f2);const _0xb7df32=_0x14edf7['params']['id'];console[_0x3538de(0x142)](_0xb7df32);const _0xa896cc=await sales['findById'](_0xb7df32);console['log'](_0x3538de(0x164),_0xa896cc);const _0x2f37fd=await warehouse['aggregate']([{'$match':{'name':_0x3538de(0xcd),'room':_0x3538de(0xeb)}},{'$unwind':_0x3538de(0x131)},{'$group':{'_id':_0x3538de(0x16a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3538de(0xa9)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x3538de(0x171)},'pallet':{'$first':_0x3538de(0xe9)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3538de(0xf5)}}}]);console[_0x3538de(0x142)](_0x3538de(0x180),_0x2f37fd);const _0x440e7a=await product[_0x3538de(0x18f)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x3538de(0x188),'name':_0x3538de(0xcd),'warehouse_category':_0x3538de(0x118)}},{'$group':{'_id':'$name','name':{'$first':_0x3538de(0xc3)}}},{'$sort':{'name':0x1}}]);var _0x438a1b=[_0x3538de(0xeb)];if(_0x1505f2[0x0]['language']=='English\x20(US)'){var _0xef6831=users[_0x3538de(0x17e)];console[_0x3538de(0x142)](_0xef6831);}else{if(_0x1505f2[0x0][_0x3538de(0x114)]==_0x3538de(0x1ab))var _0xef6831=users[_0x3538de(0x1ab)];else{if(_0x1505f2[0x0][_0x3538de(0x114)]==_0x3538de(0x11f))var _0xef6831=users[_0x3538de(0x11f)];else{if(_0x1505f2[0x0][_0x3538de(0x114)]==_0x3538de(0x138))var _0xef6831=users[_0x3538de(0x138)];else{if(_0x1505f2[0x0]['language']==_0x3538de(0xfe))var _0xef6831=users[_0x3538de(0xfe)];else{if(_0x1505f2[0x0][_0x3538de(0x114)]==_0x3538de(0xa2))var _0xef6831=users[_0x3538de(0x9e)];else{if(_0x1505f2[0x0][_0x3538de(0x114)]==_0x3538de(0xad))var _0xef6831=users[_0x3538de(0xad)];else{if(_0x1505f2[0x0]['language']==_0x3538de(0x148))var _0xef6831=users[_0x3538de(0xa7)];}}}}}}}_0x287005['render'](_0x3538de(0x127),{'success':_0x14edf7[_0x3538de(0x105)]('success'),'errors':_0x14edf7['flash'](_0x3538de(0x176)),'role':_0x4cb12c,'profile':_0x31a627,'user':_0xa896cc,'stock':_0x2f37fd,'master_shop':_0x1505f2,'unit':_0x440e7a,'language':_0xef6831,'warehouses':warehouse_data,'rooms':_0x438a1b});}catch(_0x46f8ba){console[_0x3538de(0x142)](_0x46f8ba),_0x287005['status'](0xc8)[_0x3538de(0x1aa)]({'message':_0x46f8ba[_0x3538de(0x1ae)]});}}),router['post']('/view/return_sales/:id',auth,async(_0x9af44c,_0x579ac7)=>{var _0x57459c=a0_0x301283;try{const {invoice:_0x3a27d6,date:_0x52a794,warehouse_name:_0x5687ec,product_name:_0x24012e,primary_code:_0x32ec0c,secondary_code:_0x20e508,product_code:_0x526e8e,sales_quantity:_0x406903,stocks:_0x3f698b,return_qty:_0x550af4,Room_name:_0x3a59b0,to_warehouse_name:_0x293465,to_Roomname:_0x170df6,to_Room_name:_0x1ad756,note:_0x49585f,level:_0x5c6b18,isle:_0xbc0a27,pallet:_0xf71b7e}=_0x9af44c[_0x57459c(0x112)];if(typeof _0x24012e=='string')var _0x18dd3c=[_0x9af44c[_0x57459c(0x112)][_0x57459c(0x163)]],_0x55d131=[_0x9af44c['body']['primary_code']],_0x1c6dfc=[_0x9af44c[_0x57459c(0x112)]['secondary_code']],_0x579a13=[_0x9af44c[_0x57459c(0x112)][_0x57459c(0x14d)]],_0xcb1490=[_0x9af44c[_0x57459c(0x112)][_0x57459c(0x165)]],_0x42fb7d=[_0x9af44c['body'][_0x57459c(0x14f)]],_0x2c195a=[_0x9af44c[_0x57459c(0x112)][_0x57459c(0xe8)]],_0x4a0fb4=[_0x9af44c[_0x57459c(0x112)][_0x57459c(0x133)]],_0x2dbaf8=[_0x9af44c['body'][_0x57459c(0xfb)]],_0x59635f=[_0x9af44c[_0x57459c(0x112)][_0x57459c(0x100)]],_0x143694=[_0x9af44c[_0x57459c(0x112)][_0x57459c(0x1a0)]];else var _0x18dd3c=[..._0x9af44c[_0x57459c(0x112)][_0x57459c(0x163)]],_0x55d131=[..._0x9af44c[_0x57459c(0x112)]['primary_code']],_0x1c6dfc=[..._0x9af44c['body']['secondary_code']],_0x579a13=[..._0x9af44c[_0x57459c(0x112)]['product_code']],_0xcb1490=[..._0x9af44c['body'][_0x57459c(0x165)]],_0x42fb7d=[..._0x9af44c['body'][_0x57459c(0x14f)]],_0x2c195a=[..._0x9af44c[_0x57459c(0x112)][_0x57459c(0xe8)]],_0x4a0fb4=[..._0x9af44c['body'][_0x57459c(0x133)]],_0x2dbaf8=[..._0x9af44c[_0x57459c(0x112)][_0x57459c(0xfb)]],_0x59635f=[..._0x9af44c[_0x57459c(0x112)]['types']],_0x143694=[..._0x9af44c[_0x57459c(0x112)][_0x57459c(0x1a0)]];const _0x10c763=_0x18dd3c[_0x57459c(0xff)](_0x4eb5d7=>{return _0x4eb5d7={'product_name':_0x4eb5d7};});_0x55d131[_0x57459c(0xbc)]((_0x3ee5a6,_0x3b3c14)=>{var _0xb869ff=_0x57459c;_0x10c763[_0x3b3c14][_0xb869ff(0xa5)]=_0x3ee5a6;}),_0x1c6dfc['forEach']((_0x2962e0,_0xe2b04d)=>{_0x10c763[_0xe2b04d]['secondary_code']=_0x2962e0;}),_0x579a13[_0x57459c(0xbc)]((_0x480a72,_0x4ce7b6)=>{var _0x5cbf99=_0x57459c;_0x10c763[_0x4ce7b6][_0x5cbf99(0x14d)]=_0x480a72;}),_0xcb1490[_0x57459c(0xbc)]((_0x1c84c3,_0x3581b6)=>{var _0x1aa516=_0x57459c;_0x10c763[_0x3581b6][_0x1aa516(0x122)]=_0x1c84c3;}),_0x42fb7d[_0x57459c(0xbc)]((_0xb0995e,_0x1378c0)=>{var _0xf7dede=_0x57459c;_0x10c763[_0x1378c0][_0xf7dede(0xa8)]=_0xb0995e;}),_0x2c195a[_0x57459c(0xbc)]((_0x5f23c0,_0x500705)=>{var _0x42b2f7=_0x57459c;_0x10c763[_0x500705][_0x42b2f7(0xe8)]=_0x5f23c0;}),_0x4a0fb4['forEach']((_0xc2358,_0x4b00f0)=>{var _0xdc23f8=_0x57459c;_0x10c763[_0x4b00f0][_0xdc23f8(0x133)]=_0xc2358;}),_0x2dbaf8[_0x57459c(0xbc)]((_0x109c87,_0x4dab2f)=>{_0x10c763[_0x4dab2f]['bin']=_0x109c87;}),_0x59635f[_0x57459c(0xbc)]((_0x431b75,_0x2e2806)=>{var _0x39887f=_0x57459c;_0x10c763[_0x2e2806][_0x39887f(0x161)]=_0x431b75;}),_0x143694[_0x57459c(0xbc)]((_0x5311ef,_0x5ce9b1)=>{var _0x5aa467=_0x57459c;_0x10c763[_0x5ce9b1][_0x5aa467(0x1a0)]=_0x5311ef;});var _0x3baf2b=0x0;_0x10c763[_0x57459c(0xbc)](_0x5e3e26=>{var _0x38c947=_0x57459c;console[_0x38c947(0x142)]('foreach\x20newproduct',_0x5e3e26),(parseInt(_0x5e3e26[_0x38c947(0x122)])<parseInt(_0x5e3e26[_0x38c947(0xe8)])||parseInt(_0x5e3e26[_0x38c947(0xa8)])<parseInt(_0x5e3e26[_0x38c947(0xe8)])&&parseInt(_0x5e3e26[_0x38c947(0x122)])>parseInt(_0x5e3e26['return_qty'])||parseInt(_0x5e3e26[_0x38c947(0xe8)])==0x0)&&_0x3baf2b++;});if(_0x3baf2b!=0x0)return _0x9af44c[_0x57459c(0x105)](_0x57459c(0x176),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x579ac7[_0x57459c(0x113)](_0x57459c(0x111));const _0xc3e7f3=await sales[_0x57459c(0x11e)]({'invoice':_0x3a27d6});console['log'](_0xc3e7f3),_0xc3e7f3[_0x57459c(0x15f)]=_0x57459c(0xa3);const _0x2b6934=await _0xc3e7f3[_0x57459c(0x146)](),_0x44f363=new sales_return({'invoice':_0x3a27d6,'customer':_0x9af44c[_0x57459c(0x112)][_0x57459c(0x137)],'date':_0x52a794,'warehouse_name':_0x5687ec,'room':_0x3a59b0,'ToWarehouse':_0x293465,'ToRoom':_0x1ad756,'return_sale':_0x10c763,'note':_0x49585f}),_0xe137de=await _0x44f363[_0x57459c(0x146)]();console['log'](_0x44f363);const _0x14eded=await sales_return[_0x57459c(0x11e)]({'invoice':_0x3a27d6}),_0x276971=await warehouse['findOne']({'name':_0x293465,'room':_0x1ad756});_0x14eded[_0x57459c(0x127)]['forEach'](_0x20b9ff=>{var _0x247df7=_0x57459c,_0x10eb72=0x0;const _0x245f1f=_0x276971[_0x247df7(0xe5)][_0x247df7(0xff)](_0x585641=>{var _0x20270c=_0x247df7;_0x585641['product_name']==_0x20b9ff[_0x20270c(0x163)]&&_0x585641['floorlevel']==_0x20b9ff[_0x20270c(0x1a0)]&&_0x585641[_0x20270c(0x161)]==_0x20b9ff['type']&&_0x585641[_0x20270c(0xfb)]==_0x20b9ff['bin']&&_0x585641[_0x20270c(0x133)]==_0x20b9ff[_0x20270c(0x133)]&&(_0x585641[_0x20270c(0x18b)]=parseInt(_0x585641['product_stock'])+parseInt(_0x20b9ff[_0x20270c(0xe8)]),_0x10eb72++);});_0x10eb72=='0'&&(_0x276971['product_details']=_0x276971['product_details']['concat']({'product_name':_0x20b9ff[_0x247df7(0x163)],'product_stock':_0x20b9ff['return_qty'],'primary_code':_0x20b9ff[_0x247df7(0xa5)],'secondary_code':_0x20b9ff[_0x247df7(0xbf)],'product_code':_0x20b9ff[_0x247df7(0x14d)],'bay':_0x20b9ff[_0x247df7(0x133)],'bin':_0x20b9ff[_0x247df7(0xfb)],'type':_0x20b9ff[_0x247df7(0x161)],'floorlevel':_0x20b9ff[_0x247df7(0x1a0)]})),console['log'](_0x247df7(0xe7),_0x276971);}),await _0x276971[_0x57459c(0x146)](),console['log'](_0x9af44c[_0x57459c(0x112)]);const _0x59306c=new c_payment_data({'invoice':_0x3a27d6,'customer':_0x9af44c['body'][_0x57459c(0x137)],'reason':_0x57459c(0x116)});await _0x59306c[_0x57459c(0x146)]();const _0x206e41=await master_shop[_0x57459c(0x18f)]();console['log'](_0x57459c(0x184),_0x206e41[0x0][_0x57459c(0xc5)]);const _0x5962ae=await email_settings['findOne'](),_0xa946df=await customer['findOne']({'name':_0x9af44c[_0x57459c(0x112)][_0x57459c(0x137)]});console[_0x57459c(0x142)]('customer_data',_0xa946df);_0x206e41[0x0][_0x57459c(0xf1)]==0x1?(right_currency=_0x206e41[0x0][_0x57459c(0xae)],left_currency=''):(right_currency='',left_currency=_0x206e41[0x0]['currency']);var _0x31843b=_0x18dd3c,_0x14e948=_0x2c195a,_0x49e74b='',_0x4087c7;for(_0x4087c7 in _0x31843b){_0x49e74b+=_0x57459c(0x183)+_0x57459c(0xc0)+_0x31843b[_0x4087c7]+'</td>'+_0x57459c(0xc0)+_0x14e948[_0x4087c7]+_0x57459c(0xfa)+_0x57459c(0x158);}console['log'](_0x57459c(0x135),_0x49e74b);let _0x215acf=nodemailer[_0x57459c(0xee)]({'service':'gmail','auth':{'user':_0x5962ae['email'],'pass':_0x5962ae[_0x57459c(0x169)]}}),_0x545124={'from':_0x5962ae['email'],'to':_0xa946df[_0x57459c(0xc1)],'subject':_0x57459c(0x18a),'attachments':[{'filename':_0x57459c(0xa6),'path':__dirname+'/../public'+_0x57459c(0x17b)+_0x206e41[0x0]['image'],'cid':_0x57459c(0xac)}],'html':_0x57459c(0x155)+_0x57459c(0x181)+_0x57459c(0x196)+_0x57459c(0x108)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x57459c(0xb8)+_0x57459c(0x104)+_0x57459c(0x108)+_0x57459c(0x123)+_0x206e41[0x0][_0x57459c(0xc4)]+_0x57459c(0x15c)+_0x57459c(0x104)+_0x57459c(0x104)+_0x57459c(0x101)+'<div>'+_0x57459c(0x167)+_0x57459c(0x13c)+_0x3a27d6+'\x20'+_0x57459c(0x172)+_0x57459c(0x141)+_0x52a794+'\x20'+'</span>'+_0x57459c(0xa0)+_0x57459c(0x104)+_0x57459c(0xde)+_0x57459c(0xca)+_0x57459c(0x183)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x57459c(0x1ac)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x57459c(0xf6)+_0x57459c(0x158)+_0x57459c(0xed)+_0x57459c(0xcb)+'\x20'+_0x49e74b+'\x20'+'</tbody>'+_0x57459c(0x12f)+_0x57459c(0x108)+_0x57459c(0x179)+_0x57459c(0xe6)+_0x206e41[0x0][_0x57459c(0xc4)]+_0x57459c(0xa0)+_0x57459c(0x104)+_0x57459c(0x104)+_0x57459c(0xba)};_0x215acf['sendMail'](_0x545124,function(_0x387dcd,_0x5c2e7b){var _0x1e1711=_0x57459c;_0x387dcd?(console[_0x1e1711(0x142)](_0x387dcd),console[_0x1e1711(0x142)](_0x1e1711(0x10c))):console['log'](_0x1e1711(0x197));}),_0x9af44c[_0x57459c(0x105)](_0x57459c(0xf2),_0x57459c(0x19d)),_0x579ac7['redirect']('/all_sales/view');}catch(_0xe91cfe){console[_0x57459c(0x142)](_0xe91cfe),_0x579ac7[_0x57459c(0x17c)](0xc8)[_0x57459c(0x1aa)]({'message1':_0xe91cfe['message']});}}),router[a0_0x301283(0x102)]('/barcode/:id',auth,async(_0x22f4b3,_0x56de1c)=>{var _0x121a98=a0_0x301283;try{const {username:_0x1a9d90,email:_0x299a02,role:_0x1c7f2e}=_0x22f4b3[_0x121a98(0x16b)],_0x40ca88=_0x22f4b3['user'],_0x4fb7b7=await profile['findOne']({'email':_0x40ca88[_0x121a98(0xc1)]}),_0x14b64b=await master_shop[_0x121a98(0x18f)]();console[_0x121a98(0x142)](_0x121a98(0x125),_0x14b64b);const _0x1088e0=_0x22f4b3[_0x121a98(0xb4)]['id'],_0x751de3=await sales[_0x121a98(0xd2)](_0x1088e0);console[_0x121a98(0x142)]('barcode\x20user_id',_0x751de3);if(_0x14b64b[0x0][_0x121a98(0x114)]=='English\x20(US)')var _0x3f31df=users[_0x121a98(0x17e)];else{if(_0x14b64b[0x0]['language']==_0x121a98(0x1ab))var _0x3f31df=users[_0x121a98(0x1ab)];else{if(_0x14b64b[0x0][_0x121a98(0x114)]=='German')var _0x3f31df=users[_0x121a98(0x11f)];else{if(_0x14b64b[0x0][_0x121a98(0x114)]==_0x121a98(0x138))var _0x3f31df=users['Spanish'];else{if(_0x14b64b[0x0][_0x121a98(0x114)]==_0x121a98(0xfe))var _0x3f31df=users[_0x121a98(0xfe)];else{if(_0x14b64b[0x0]['language']==_0x121a98(0xa2))var _0x3f31df=users[_0x121a98(0x9e)];else{if(_0x14b64b[0x0][_0x121a98(0x114)]==_0x121a98(0xad))var _0x3f31df=users['Chinese'];else{if(_0x14b64b[0x0]['language']=='Arabic\x20(ae)')var _0x3f31df=users[_0x121a98(0xa7)];}}}}}}}_0x56de1c[_0x121a98(0xef)](_0x121a98(0x103),{'success':_0x22f4b3[_0x121a98(0x105)](_0x121a98(0xf2)),'errors':_0x22f4b3[_0x121a98(0x105)](_0x121a98(0x176)),'role':_0x40ca88,'profile':_0x4fb7b7,'alldata':_0x751de3,'master_shop':_0x14b64b,'language':_0x3f31df});}catch(_0x2f25c6){console[_0x121a98(0x142)](_0x2f25c6);}}),router[a0_0x301283(0x15a)](a0_0x301283(0x143),async(_0x22e5e7,_0x2768b6)=>{var _0x3b41d9=a0_0x301283;const {product_code:_0x4a7b3b,warehouse_name:_0x4132bf,rooms_data:_0x4b50a5,Roomslist:_0x3bb755}=_0x22e5e7[_0x3b41d9(0x112)],_0x18f907=_0x3bb755[_0x3b41d9(0x117)](','),_0x26d97b=[];async function _0x1596db(_0x394782){var _0x2454ac=_0x3b41d9;const _0x97e5b8=await warehouse['aggregate']([{'$match':{'name':_0x4132bf,'room':_0x394782}},{'$unwind':_0x2454ac(0x131)},{'$match':{'product_details.primary_code':_0x4a7b3b}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2454ac(0x16e)},'product_stock':{'$first':_0x2454ac(0xa9)},'primary_code':{'$first':_0x2454ac(0x166)},'secondary_code':{'$first':_0x2454ac(0x159)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2454ac(0x14c)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2454ac(0x12a)},'pallet':{'$first':_0x2454ac(0x1ad)},'unit':{'$first':_0x2454ac(0xa4)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2454ac(0x17a)},'rack':{'$first':_0x2454ac(0xe4)},'expiry_date':{'$first':_0x2454ac(0x19b)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2454ac(0xc9)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2454ac(0x128)},'actual_qty':{'$first':_0x2454ac(0x13e)},'actual_uom':{'$first':_0x2454ac(0x193)}}}]),_0x51cffb=await warehouse[_0x2454ac(0x120)]([{'$match':{'name':_0x4132bf,'room':_0x394782}},{'$unwind':_0x2454ac(0x131)},{'$match':{'product_details.secondary_code':_0x4a7b3b}},{'$group':{'_id':_0x2454ac(0x16a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2454ac(0xa9)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2454ac(0xf5)},'level':{'$first':_0x2454ac(0x14c)},'isle':{'$first':_0x2454ac(0x109)},'type':{'$first':_0x2454ac(0x12a)},'pallet':{'$first':_0x2454ac(0x1ad)},'unit':{'$first':_0x2454ac(0xa4)},'secondary_unit':{'$first':_0x2454ac(0xd4)},'storage':{'$first':_0x2454ac(0x17a)},'rack':{'$first':_0x2454ac(0xe4)},'expiry_date':{'$first':_0x2454ac(0x19b)},'production_date':{'$first':_0x2454ac(0x145)},'maxPerUnit':{'$first':_0x2454ac(0x11a)},'batch_code':{'$first':_0x2454ac(0xc9)},'product_cat':{'$first':_0x2454ac(0x187)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2454ac(0x11d)},'invoice':{'$first':_0x2454ac(0x128)}}}]);if(_0x97e5b8['length']>0x0)_0x26d97b[_0x2454ac(0xf4)](_0x97e5b8);else _0x51cffb['length']>0x0&&_0x26d97b['push'](_0x51cffb);}const _0x18fe48=_0x18f907[_0x3b41d9(0xff)](_0x417903=>_0x1596db(_0x417903));await Promise[_0x3b41d9(0x12c)](_0x18fe48),_0x2768b6[_0x3b41d9(0x1aa)](_0x26d97b);}),module[a0_0x301283(0x136)]=router;