var a0_0x49ae98=a0_0x40b8;(function(_0x38c96e,_0x2b7b40){var _0x3b7135=a0_0x40b8,_0x38002e=_0x38c96e();while(!![]){try{var _0x2a179e=-parseInt(_0x3b7135(0x1f1))/0x1*(parseInt(_0x3b7135(0x1a0))/0x2)+parseInt(_0x3b7135(0x181))/0x3+-parseInt(_0x3b7135(0x164))/0x4*(-parseInt(_0x3b7135(0x163))/0x5)+-parseInt(_0x3b7135(0x209))/0x6*(parseInt(_0x3b7135(0x1a4))/0x7)+-parseInt(_0x3b7135(0x16e))/0x8*(-parseInt(_0x3b7135(0x224))/0x9)+parseInt(_0x3b7135(0x150))/0xa+parseInt(_0x3b7135(0x189))/0xb*(parseInt(_0x3b7135(0x19a))/0xc);if(_0x2a179e===_0x2b7b40)break;else _0x38002e['push'](_0x38002e['shift']());}catch(_0x3956b7){_0x38002e['push'](_0x38002e['shift']());}}}(a0_0x100b,0x7a657));const express=require(a0_0x49ae98(0x148)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x49ae98(0x15d)),auth=require(a0_0x49ae98(0x1a2)),nodemailer=require(a0_0x49ae98(0x177)),users=require(a0_0x49ae98(0x1bd));router['get'](a0_0x49ae98(0x200),auth,async(_0x273e47,_0x1da1a3)=>{var _0x4e16ce=a0_0x49ae98;try{const {username:_0x4aa053,email:_0xeed096,role:_0x380aa4}=_0x273e47[_0x4e16ce(0x1d8)],_0x2d7540=_0x273e47[_0x4e16ce(0x1d8)],_0x2113ee=await profile[_0x4e16ce(0x228)]({'email':_0x2d7540['email']}),_0x52cb29=await master_shop['find']();let _0x32d192;if(_0x2d7540['role']=='staff'){const _0x150e7f=await staff[_0x4e16ce(0x228)]({'email':_0x2d7540[_0x4e16ce(0x232)]});_0x32d192=await sales[_0x4e16ce(0x160)]([{'$lookup':{'from':_0x4e16ce(0x223),'localField':_0x4e16ce(0x235),'foreignField':_0x4e16ce(0x239),'as':_0x4e16ce(0x21b)}},{'$unwind':_0x4e16ce(0x18b)},{'$unwind':_0x4e16ce(0x170)},{'$group':{'_id':_0x4e16ce(0x221),'invoice':{'$first':_0x4e16ce(0x1f4)},'customers':{'$first':'$customer'},'date':{'$first':_0x4e16ce(0x157)},'warehouse_name':{'$first':_0x4e16ce(0x1b2)},'sale_product':{'$push':_0x4e16ce(0x170)},'note':{'$first':_0x4e16ce(0x1e3)},'return_data':{'$first':_0x4e16ce(0x196)},'customers_docs':{'$first':_0x4e16ce(0x18b)},'total_saleproduct_quantity':{'$sum':_0x4e16ce(0x1c9)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x4e16ce(0x1a8)},'type':{'$addToSet':_0x4e16ce(0x147)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x4e16ce(0x153)},'isAllowEdit':{'$first':_0x4e16ce(0x1d1)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x32d192=await sales['aggregate']([{'$lookup':{'from':'customers','localField':_0x4e16ce(0x235),'foreignField':_0x4e16ce(0x239),'as':_0x4e16ce(0x21b)}},{'$unwind':_0x4e16ce(0x18b)},{'$unwind':_0x4e16ce(0x170)},{'$group':{'_id':_0x4e16ce(0x221),'invoice':{'$first':_0x4e16ce(0x1f4)},'customers':{'$first':_0x4e16ce(0x1f3)},'date':{'$first':_0x4e16ce(0x157)},'warehouse_name':{'$first':_0x4e16ce(0x1b2)},'sale_product':{'$push':_0x4e16ce(0x170)},'note':{'$first':_0x4e16ce(0x1e3)},'return_data':{'$first':_0x4e16ce(0x196)},'customers_docs':{'$first':_0x4e16ce(0x18b)},'total_saleproduct_quantity':{'$sum':_0x4e16ce(0x1c9)},'level':{'$addToSet':_0x4e16ce(0x234)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x4e16ce(0x240)},'finalize':{'$first':_0x4e16ce(0x153)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x4e16ce(0x245)]('sales\x20all_data',_0x32d192);if(_0x52cb29[0x0]['language']=='English\x20(US)'){var _0x5ece00=users['English'];console[_0x4e16ce(0x245)](_0x5ece00);}else{if(_0x52cb29[0x0][_0x4e16ce(0x1ed)]==_0x4e16ce(0x20e))var _0x5ece00=users['Hindi'];else{if(_0x52cb29[0x0][_0x4e16ce(0x1ed)]==_0x4e16ce(0x1e6))var _0x5ece00=users['German'];else{if(_0x52cb29[0x0][_0x4e16ce(0x1ed)]==_0x4e16ce(0x1c6))var _0x5ece00=users[_0x4e16ce(0x1c6)];else{if(_0x52cb29[0x0][_0x4e16ce(0x1ed)]==_0x4e16ce(0x218))var _0x5ece00=users[_0x4e16ce(0x218)];else{if(_0x52cb29[0x0][_0x4e16ce(0x1ed)]=='Portuguese\x20(BR)')var _0x5ece00=users[_0x4e16ce(0x1b3)];else{if(_0x52cb29[0x0][_0x4e16ce(0x1ed)]=='Chinese')var _0x5ece00=users[_0x4e16ce(0x1bc)];else{if(_0x52cb29[0x0]['language']=='Arabic\x20(ae)')var _0x5ece00=users[_0x4e16ce(0x14b)];}}}}}}}_0x1da1a3[_0x4e16ce(0x1c7)](_0x4e16ce(0x1f6),{'success':_0x273e47['flash'](_0x4e16ce(0x183)),'errors':_0x273e47['flash'](_0x4e16ce(0x1f5)),'sales':_0x32d192,'profile':_0x2113ee,'role':_0x2d7540,'master_shop':_0x52cb29,'language':_0x5ece00});}catch(_0x3b0a4d){console['log'](_0x3b0a4d);}});async function getRandom8DigitNumber(){var _0x18360b=a0_0x49ae98;const _0x1c5bbe=0x989680,_0x5bd70f=0x5f5e0ff,_0x344185=Math[_0x18360b(0x184)](Math['random']()*(_0x5bd70f-_0x1c5bbe+0x1))+_0x1c5bbe;var _0x2af369;const _0xc3d4a2=await sales['findOne']({'invoice':'OUT-'+_0x344185});return _0xc3d4a2&&_0xc3d4a2[_0x18360b(0x191)]>0x0?_0x2af369='OUT-'+_0x344185:_0x2af369=_0x18360b(0x244)+_0x344185,_0x2af369;}function a0_0x40b8(_0x79eff1,_0x281701){var _0x100b98=a0_0x100b();return a0_0x40b8=function(_0x40b8e9,_0x2f84d8){_0x40b8e9=_0x40b8e9-0x139;var _0x301a1d=_0x100b98[_0x40b8e9];return _0x301a1d;},a0_0x40b8(_0x79eff1,_0x281701);}router[a0_0x49ae98(0x187)](a0_0x49ae98(0x1ba),auth,async(_0x3f0eee,_0x5e940e)=>{var _0x5d2397=a0_0x49ae98;try{const {username:_0x2c8abb,email:_0x2f8564,role:_0xf65b53}=_0x3f0eee['user'],_0x493c77=_0x3f0eee[_0x5d2397(0x1d8)],_0x1fe76d=await profile['findOne']({'email':_0x493c77['email']}),_0x41e0af=await master_shop[_0x5d2397(0x238)](),_0x42bd43=await customer[_0x5d2397(0x238)]({});let _0x33eae9;if(_0x493c77['role']=='staff'){const _0xdd73e2=await staff['findOne']({'email':_0x493c77[_0x5d2397(0x232)]});_0x33eae9=await warehouse[_0x5d2397(0x160)]([{'$match':{'status':_0x5d2397(0x17e),'name':_0xdd73e2[_0x5d2397(0x17c)],'warehouse_category':_0x5d2397(0x16b),'name':{'$ne':_0x5d2397(0x180)}}},{'$group':{'_id':_0x5d2397(0x166),'name':{'$first':_0x5d2397(0x166)}}},{'$sort':{'name':0x1}}]);}else _0x33eae9=await warehouse['aggregate']([{'$match':{'status':_0x5d2397(0x17e),'warehouse_category':_0x5d2397(0x16b),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x5d2397(0x166),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x535c04=await product[_0x5d2397(0x238)]({});var _0x275903=[_0x5d2397(0x23b),'Enclosed'];const _0x489cda=await sales['find']({}),_0x216965=_0x489cda[_0x5d2397(0x191)]+0x1,_0x1b7b0d='OUT-'+_0x216965[_0x5d2397(0x14e)]()[_0x5d2397(0x1c2)](0x5,'0');if(_0x41e0af[0x0]['language']==_0x5d2397(0x154)){var _0x7e8f4c=users['English'];console[_0x5d2397(0x245)](_0x7e8f4c);}else{if(_0x41e0af[0x0][_0x5d2397(0x1ed)]==_0x5d2397(0x20e))var _0x7e8f4c=users['Hindi'];else{if(_0x41e0af[0x0][_0x5d2397(0x1ed)]=='German')var _0x7e8f4c=users[_0x5d2397(0x1e6)];else{if(_0x41e0af[0x0][_0x5d2397(0x1ed)]==_0x5d2397(0x1c6))var _0x7e8f4c=users[_0x5d2397(0x1c6)];else{if(_0x41e0af[0x0][_0x5d2397(0x1ed)]==_0x5d2397(0x218))var _0x7e8f4c=users[_0x5d2397(0x218)];else{if(_0x41e0af[0x0][_0x5d2397(0x1ed)]==_0x5d2397(0x213))var _0x7e8f4c=users[_0x5d2397(0x1b3)];else{if(_0x41e0af[0x0][_0x5d2397(0x1ed)]==_0x5d2397(0x1bc))var _0x7e8f4c=users['Chinese'];else{if(_0x41e0af[0x0][_0x5d2397(0x1ed)]=='Arabic\x20(ae)')var _0x7e8f4c=users[_0x5d2397(0x14b)];}}}}}}}const _0x5e21c2=getRandom8DigitNumber();_0x5e21c2[_0x5d2397(0x193)](_0x2f9ea5=>{var _0x197580=_0x5d2397;_0x5e940e[_0x197580(0x1c7)](_0x197580(0x195),{'success':_0x3f0eee['flash'](_0x197580(0x183)),'errors':_0x3f0eee[_0x197580(0x15b)](_0x197580(0x1f5)),'role':_0x493c77,'profile':_0x1fe76d,'customer':_0x42bd43,'warehouse':_0x33eae9,'product':_0x535c04,'invoice':_0x2f9ea5,'master_shop':_0x41e0af,'language':_0x7e8f4c,'rooms_data':_0x275903});})[_0x5d2397(0x18f)](_0x368c68=>{var _0x2e1089=_0x5d2397;_0x3f0eee[_0x2e1089(0x15b)]('errors',_0x2e1089(0x1e8)),_0x5e940e[_0x2e1089(0x13b)](_0x2e1089(0x16c));});}catch(_0xe206b0){console['log'](_0xe206b0);}}),router[a0_0x49ae98(0x187)]('/view/add_sales/:id',auth,async(_0x16bd58,_0x57d12f)=>{var _0x4efad7=a0_0x49ae98;try{const _0x1e0e7b=_0x16bd58[_0x4efad7(0x198)]['id'];console[_0x4efad7(0x245)](_0x1e0e7b);const _0x2708ad=await product['find'](),_0x193fcd=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1e0e7b}},{'$unwind':_0x4efad7(0x23a)},{'$group':{'_id':_0x4efad7(0x156)}}]);console[_0x4efad7(0x245)](_0x4efad7(0x197),_0x193fcd),_0x57d12f['status'](0xc8)['json']({'purchases_data':_0x193fcd,'product_data':_0x2708ad});}catch(_0x36b8a6){console['log'](_0x36b8a6);}}),router[a0_0x49ae98(0x1fd)](a0_0x49ae98(0x1de),auth,async(_0x280d6c,_0x511503)=>{var _0x405fc5=a0_0x49ae98;try{const {warehouse_data:_0x59d6b7,product_data:_0x2c5d80}=_0x280d6c[_0x405fc5(0x161)];console['log'](_0x280d6c[_0x405fc5(0x161)][_0x405fc5(0x171)]);;const _0x5d0ea1=await master_shop[_0x405fc5(0x238)]();console[_0x405fc5(0x245)](_0x405fc5(0x1bf),_0x5d0ea1);const _0x19deea=await product[_0x405fc5(0x228)]({'name':_0x2c5d80});console[_0x405fc5(0x245)](_0x405fc5(0x19c),_0x19deea);const _0x56486c=await warehouse[_0x405fc5(0x160)]([{'$match':{'name':_0x59d6b7}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x2c5d80}},{'$group':{'_id':_0x405fc5(0x1cd),'product_stock':{'$first':_0x405fc5(0x16a)}}}]);console[_0x405fc5(0x245)]('stock_data',_0x56486c),_0x511503['status'](0xc8)[_0x405fc5(0x247)]({'master':_0x5d0ea1,'new_product':_0x19deea,'stock_data':_0x56486c});}catch(_0xfc4293){console[_0x405fc5(0x245)](_0xfc4293);}}),router[a0_0x49ae98(0x1fd)](a0_0x49ae98(0x1ba),auth,async(_0x4e7c8a,_0x3da71b)=>{var _0x2e7ffa=a0_0x49ae98;try{const {invoice:_0x1a85eb,date:_0x1c7ddc,warehouse_name:_0x294311,product_name:_0x5a290e,stock:_0x2fa6c4,quantity:_0x2bb3e2,note:_0x224155,room:_0x4379fb,primary_code:_0x4ba63f,secondary_code:_0x41aa36,prod_code:_0x5b8466,level:_0x620f1b,isle:_0x309a74,pallet:_0x5d45f7,batch_code:_0x4c552c,SCRN:_0x38bfb4,expiry_date:_0x46e683}=_0x4e7c8a[_0x2e7ffa(0x161)];if(typeof _0x5a290e=='string')var _0x5ca8c7=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x23e)]],_0x8dff7e=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x1c1)]],_0x2152aa=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x174)]],_0x30859a=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x20c)]],_0x104735=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x19b)]],_0x39bfea=[_0x4e7c8a['body'][_0x2e7ffa(0x1ae)]],_0x7e653e=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x15f)]],_0x463f95=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x1dc)]],_0x1e90c1=[_0x4e7c8a['body'][_0x2e7ffa(0x18d)]],_0x2ffe37=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x1fc)]],_0x5e1324=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x1c4)]],_0x2e3ac5=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x144)]],_0x260016=[_0x4e7c8a[_0x2e7ffa(0x161)]['production_date']],_0x2000e3=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x1c3)]],_0x3e2265=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x18c)]],_0x1dfc41=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x1b8)]],_0x1de210=[_0x4e7c8a[_0x2e7ffa(0x161)]['prod_cat']],_0x5b82ee=[_0x4e7c8a[_0x2e7ffa(0x161)]['quantity']],_0xace4f0=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x139)]],_0x1abd0d=[_0x4e7c8a['body'][_0x2e7ffa(0x20f)]],_0x33897c=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x21d)]],_0x4f8e02=[_0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x18a)]];else var _0x5ca8c7=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x23e)]],_0x8dff7e=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x1c1)]],_0x2152aa=[..._0x4e7c8a['body'][_0x2e7ffa(0x174)]],_0x30859a=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x20c)]],_0x104735=[..._0x4e7c8a['body'][_0x2e7ffa(0x19b)]],_0x39bfea=[..._0x4e7c8a['body'][_0x2e7ffa(0x1ae)]],_0x7e653e=[..._0x4e7c8a[_0x2e7ffa(0x161)]['level']],_0x463f95=[..._0x4e7c8a['body'][_0x2e7ffa(0x1dc)]],_0x1e90c1=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x18d)]],_0x2ffe37=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x1fc)]],_0x5e1324=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x1c4)]],_0x2e3ac5=[..._0x4e7c8a['body'][_0x2e7ffa(0x144)]],_0x260016=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x15e)]],_0x2000e3=[..._0x4e7c8a['body'][_0x2e7ffa(0x1c3)]],_0x3e2265=[..._0x4e7c8a['body'][_0x2e7ffa(0x18c)]],_0x1dfc41=[..._0x4e7c8a['body']['delivery_code']],_0x1de210=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x179)]],_0x5b82ee=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x21e)]],_0xace4f0=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x139)]],_0x1abd0d=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x20f)]],_0x33897c=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x21d)]],_0x4f8e02=[..._0x4e7c8a[_0x2e7ffa(0x161)][_0x2e7ffa(0x18a)]];const _0x25165f=_0x5ca8c7[_0x2e7ffa(0x175)](_0x3d079d=>{return _0x3d079d={'product_name':_0x3d079d};});_0x8dff7e[_0x2e7ffa(0x1b4)]((_0xe63f6,_0x6cfee)=>{var _0x50db71=_0x2e7ffa;_0x25165f[_0x6cfee][_0x50db71(0x1c1)]=Math[_0x50db71(0x22b)](_0xe63f6);}),_0x33897c[_0x2e7ffa(0x1b4)]((_0x410b0f,_0x1baf45)=>{var _0x37c8f7=_0x2e7ffa;_0x25165f[_0x1baf45]['actual_qty']=Math[_0x37c8f7(0x22b)](_0x410b0f);}),_0x4f8e02[_0x2e7ffa(0x1b4)]((_0x35b845,_0x26eb50)=>{var _0x4f9a2a=_0x2e7ffa;_0x25165f[_0x26eb50][_0x4f9a2a(0x18a)]=_0x35b845;}),_0x2152aa[_0x2e7ffa(0x1b4)]((_0x8cb0d8,_0x92a0ae)=>{_0x25165f[_0x92a0ae]['quantity']=_0x8cb0d8;}),_0x30859a[_0x2e7ffa(0x1b4)]((_0x59ed88,_0x78e977)=>{_0x25165f[_0x78e977]['primary_code']=_0x59ed88;}),_0x104735[_0x2e7ffa(0x1b4)]((_0x53921f,_0x2dfd28)=>{_0x25165f[_0x2dfd28]['secondary_code']=_0x53921f;}),_0x39bfea[_0x2e7ffa(0x1b4)]((_0x27517f,_0x23943a)=>{var _0x157bcc=_0x2e7ffa;_0x25165f[_0x23943a][_0x157bcc(0x1ef)]=_0x27517f;}),_0x7e653e[_0x2e7ffa(0x1b4)]((_0x3d4385,_0x5c4fa4)=>{var _0x5be938=_0x2e7ffa;_0xace4f0[_0x5be938(0x1b4)]((_0x578e75,_0x332c3e)=>{var _0x1b0734=_0x5be938;if(_0x578e75==_0x1b0734(0x1e7)&&_0x5c4fa4==_0x332c3e){var _0xcd6042=_0x3d4385[_0x1b0734(0x1aa)](0x3);_0x25165f[_0x5c4fa4]['storage']=_0x3d4385[0x0],_0x25165f[_0x5c4fa4][_0x1b0734(0x233)]=_0x3d4385[0x1],_0x25165f[_0x5c4fa4][_0x1b0734(0x151)]=0x0,_0x25165f[_0x5c4fa4][_0x1b0734(0x1c8)]=0x0,_0x25165f[_0x5c4fa4][_0x1b0734(0x212)]=_0x1b0734(0x143),_0x25165f[_0x5c4fa4][_0x1b0734(0x248)]=_0xcd6042;}else{if(_0x578e75=='Shelves'&&_0x5c4fa4==_0x332c3e){var _0xcd6042=_0x3d4385[_0x1b0734(0x1aa)](0x3);_0x25165f[_0x5c4fa4]['storage']=_0x3d4385[0x0],_0x25165f[_0x5c4fa4][_0x1b0734(0x233)]=_0x3d4385[0x1],_0x25165f[_0x5c4fa4]['bay']=0x0,_0x25165f[_0x5c4fa4]['bin']=0x0,_0x25165f[_0x5c4fa4][_0x1b0734(0x212)]=_0x1b0734(0x143),_0x25165f[_0x5c4fa4]['floorlevel']=_0x3d4385[0x5];}else{if(_0x5c4fa4==_0x332c3e){var _0x1a24d9;if(_0x3d4385[0x4]=='L')_0x1a24d9=_0x1b0734(0x1cf);else _0x3d4385[0x4]=='F'&&(_0x1a24d9=_0x1b0734(0x143));_0x25165f[_0x5c4fa4][_0x1b0734(0x1ee)]=_0x3d4385[0x0],_0x25165f[_0x5c4fa4][_0x1b0734(0x233)]=_0x3d4385[0x1],_0x25165f[_0x5c4fa4][_0x1b0734(0x151)]=_0x3d4385[0x2],_0x25165f[_0x5c4fa4][_0x1b0734(0x1c8)]=_0x3d4385[0x3],_0x25165f[_0x5c4fa4][_0x1b0734(0x212)]=_0x1a24d9,_0x25165f[_0x5c4fa4][_0x1b0734(0x248)]=_0x3d4385[0x5];}}}});}),_0x463f95[_0x2e7ffa(0x1b4)]((_0x41af36,_0x237290)=>{var _0x41c927=_0x2e7ffa;_0x25165f[_0x237290][_0x41c927(0x1e9)]=_0x41af36;}),_0x1e90c1[_0x2e7ffa(0x1b4)]((_0x5511b6,_0x1475bb)=>{_0x25165f[_0x1475bb]['secondary_unit']=_0x5511b6;}),_0x2ffe37['forEach']((_0x408c13,_0x50ff63)=>{var _0x12891e=_0x2e7ffa;_0x25165f[_0x50ff63][_0x12891e(0x1fc)]=_0x408c13;}),_0x5e1324['forEach']((_0x66a985,_0x45a826)=>{var _0x2d442b=_0x2e7ffa;_0x25165f[_0x45a826][_0x2d442b(0x1c4)]=_0x66a985;}),_0x2e3ac5[_0x2e7ffa(0x1b4)]((_0x2ead39,_0x37d6be)=>{var _0x9a6062=_0x2e7ffa;_0x25165f[_0x37d6be][_0x9a6062(0x214)]=_0x2ead39;}),_0x260016['forEach']((_0x112221,_0x30ee23)=>{var _0x4f049f=_0x2e7ffa;_0x25165f[_0x30ee23][_0x4f049f(0x15e)]=_0x112221;}),_0x2000e3['forEach']((_0x386fec,_0x183182)=>{var _0x218168=_0x2e7ffa;_0x25165f[_0x183182][_0x218168(0x1c3)]=_0x386fec;}),_0x3e2265[_0x2e7ffa(0x1b4)]((_0x3fa899,_0x4c7f77)=>{var _0x46a107=_0x2e7ffa;_0x25165f[_0x4c7f77][_0x46a107(0x18c)]=_0x3fa899;}),_0x1dfc41[_0x2e7ffa(0x1b4)]((_0x17b4ab,_0x5a79af)=>{_0x25165f[_0x5a79af]['delivery_code']=_0x17b4ab;}),_0x1de210[_0x2e7ffa(0x1b4)]((_0x373f4d,_0x56e2ac)=>{var _0x1f3a49=_0x2e7ffa;_0x25165f[_0x56e2ac][_0x1f3a49(0x179)]=_0x373f4d;}),_0x5b82ee[_0x2e7ffa(0x1b4)]((_0x385db6,_0x54ae1d)=>{var _0x3e71aa=_0x2e7ffa;_0x25165f[_0x54ae1d][_0x3e71aa(0x1d6)]=_0x385db6;}),_0xace4f0[_0x2e7ffa(0x1b4)]((_0x4528a4,_0x54d9e0)=>{_0x25165f[_0x54d9e0]['room_name']=_0x4528a4;}),_0x1abd0d[_0x2e7ffa(0x1b4)]((_0x1533ef,_0x1c64e3)=>{var _0x835a51=_0x2e7ffa;_0x25165f[_0x1c64e3][_0x835a51(0x222)]=_0x1533ef;});var _0x1b1d82=0x0;_0x25165f[_0x2e7ffa(0x1b4)](_0x211e91=>{var _0xbae72d=_0x2e7ffa;(_0x211e91[_0xbae72d(0x1c1)]<_0x211e91[_0xbae72d(0x1d6)]||_0x211e91[_0xbae72d(0x1d6)]==0x0)&&(console[_0xbae72d(0x245)](_0xbae72d(0x165),_0x211e91),_0x1b1d82++);});const _0x311f62=_0x25165f['filter'](_0x46335d=>_0x46335d[_0x2e7ffa(0x21e)]!=='0'&&_0x46335d[_0x2e7ffa(0x21e)]!==''),_0x314c19=new sales({'invoice':_0x1a85eb,'customer':_0x4e7c8a['body']['customer'],'date':_0x1c7ddc,'warehouse_name':_0x294311,'sale_product':_0x311f62,'note':_0x224155,'room':_0x4379fb,'primary_code':_0x4ba63f,'secondary_code':_0x41aa36,'prod_code':_0x5b8466,'SCRN':_0x38bfb4}),_0x37cf43=await _0x314c19[_0x2e7ffa(0x1df)]();_0x4e7c8a[_0x2e7ffa(0x15b)]('success',_0x2e7ffa(0x14c)),_0x3da71b['redirect'](_0x2e7ffa(0x22e)+_0x37cf43['_id']);}catch(_0xf475b9){console[_0x2e7ffa(0x245)](_0xf475b9);}}),router['get']('/preview/:id',auth,async(_0x267b73,_0xfdc36a)=>{var _0x18a1ef=a0_0x49ae98;try{const {username:_0x24cc86,email:_0x23a872,role:_0x47cfd2}=_0x267b73[_0x18a1ef(0x1d8)],_0x13d5c2=_0x267b73[_0x18a1ef(0x1d8)],_0x2d1c3f=await profile['findOne']({'email':_0x13d5c2[_0x18a1ef(0x232)]}),_0x529140=await master_shop[_0x18a1ef(0x238)](),_0xdef2c=_0x267b73[_0x18a1ef(0x198)]['id'],_0x3795c5=await sales[_0x18a1ef(0x1ab)](_0xdef2c),_0x5a2d0e=await warehouse[_0x18a1ef(0x160)]([{'$match':{'name':_0x3795c5[_0x18a1ef(0x1ec)]}},{'$unwind':_0x18a1ef(0x1f9)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x18a1ef(0x1cd)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x18a1ef(0x243)},'type':{'$first':_0x18a1ef(0x16d)},'floorlevel':{'$first':_0x18a1ef(0x1e1)},'primary_code':{'$first':_0x18a1ef(0x21f)},'secondary_code':{'$first':_0x18a1ef(0x1e5)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x18a1ef(0x231)},'expiry_date':{'$first':_0x18a1ef(0x1ad)},'production_date':{'$first':_0x18a1ef(0x162)},'invoice':{'$first':_0x18a1ef(0x23f)}}}]),_0x14e3e6=await customer[_0x18a1ef(0x238)]({});let _0x39c319;if(_0x13d5c2[_0x18a1ef(0x199)]=='staff'){const _0x5bf657=await staff['findOne']({'email':_0x13d5c2[_0x18a1ef(0x232)]});_0x39c319=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x5bf657[_0x18a1ef(0x17c)]}},{'$group':{'_id':_0x18a1ef(0x166),'name':{'$first':_0x18a1ef(0x166)}}}]);}else _0x39c319=await warehouse[_0x18a1ef(0x160)]([{'$match':{'status':_0x18a1ef(0x17e)}},{'$group':{'_id':_0x18a1ef(0x166),'name':{'$first':_0x18a1ef(0x166)}}}]);const _0x4b77aa=await product[_0x18a1ef(0x238)]({}),_0x3735c9=await suppliers[_0x18a1ef(0x238)]({});if(_0x529140[0x0][_0x18a1ef(0x1ed)]==_0x18a1ef(0x154)){var _0x1ba59e=users['English'];console[_0x18a1ef(0x245)](_0x1ba59e);}else{if(_0x529140[0x0][_0x18a1ef(0x1ed)]==_0x18a1ef(0x20e))var _0x1ba59e=users[_0x18a1ef(0x20e)];else{if(_0x529140[0x0]['language']==_0x18a1ef(0x1e6))var _0x1ba59e=users[_0x18a1ef(0x1e6)];else{if(_0x529140[0x0]['language']==_0x18a1ef(0x1c6))var _0x1ba59e=users[_0x18a1ef(0x1c6)];else{if(_0x529140[0x0][_0x18a1ef(0x1ed)]==_0x18a1ef(0x218))var _0x1ba59e=users['French'];else{if(_0x529140[0x0][_0x18a1ef(0x1ed)]==_0x18a1ef(0x213))var _0x1ba59e=users['Portuguese'];else{if(_0x529140[0x0][_0x18a1ef(0x1ed)]==_0x18a1ef(0x1bc))var _0x1ba59e=users[_0x18a1ef(0x1bc)];else{if(_0x529140[0x0][_0x18a1ef(0x1ed)]=='Arabic\x20(ae)')var _0x1ba59e=users['Arabic'];}}}}}}}_0xfdc36a[_0x18a1ef(0x1c7)](_0x18a1ef(0x1d7),{'success':_0x267b73[_0x18a1ef(0x15b)](_0x18a1ef(0x183)),'errors':_0x267b73[_0x18a1ef(0x15b)](_0x18a1ef(0x1f5)),'role':_0x13d5c2,'profile':_0x2d1c3f,'customer':_0x14e3e6,'warehouse':_0x39c319,'product':_0x5a2d0e,'user':_0x3795c5,'master_shop':_0x529140,'unit':_0x4b77aa,'language':_0x1ba59e,'suppliers':_0x3735c9});}catch(_0x305a8a){console[_0x18a1ef(0x245)](_0x305a8a);}}),router['post']('/preview/:id',auth,async(_0x45a419,_0x27f68c)=>{var _0x536d70=a0_0x49ae98;try{const _0x4d1283=_0x45a419[_0x536d70(0x198)]['id'],{invoice:_0x1f2cbe,warehouse_name:_0x64a279,room:_0x23b597}=_0x45a419[_0x536d70(0x161)],_0x28124f=await sales[_0x536d70(0x228)]({'invoice':_0x1f2cbe}),_0x2a4dc9=_0x28124f[_0x536d70(0x14d)][_0x536d70(0x175)](async _0x21a9b9=>{var _0x2524bb=_0x536d70,_0x237952=await warehouse[_0x2524bb(0x228)]({'name':_0x64a279,'room':_0x21a9b9['room_name'],'warehouse_category':_0x2524bb(0x16b)});const _0x54a8d0=_0x237952[_0x2524bb(0x1cc)]['map'](_0x4eb05a=>{var _0x8a088b=_0x2524bb;_0x4eb05a[_0x8a088b(0x23e)]==_0x21a9b9[_0x8a088b(0x23e)]&&_0x4eb05a[_0x8a088b(0x248)]==_0x21a9b9[_0x8a088b(0x248)]&&_0x4eb05a[_0x8a088b(0x212)]==_0x21a9b9[_0x8a088b(0x212)]&&_0x4eb05a[_0x8a088b(0x1c8)]==_0x21a9b9['bin']&&_0x4eb05a[_0x8a088b(0x151)]==_0x21a9b9[_0x8a088b(0x151)]&&_0x4eb05a[_0x8a088b(0x233)]==_0x21a9b9[_0x8a088b(0x233)]&&_0x4eb05a[_0x8a088b(0x1ee)]==_0x21a9b9[_0x8a088b(0x1ee)]&&_0x4eb05a[_0x8a088b(0x1c4)]==_0x21a9b9[_0x8a088b(0x1c4)]&&_0x4eb05a[_0x8a088b(0x1fc)]==_0x21a9b9[_0x8a088b(0x1fc)]&&_0x4eb05a[_0x8a088b(0x222)]==_0x21a9b9[_0x8a088b(0x222)]&&(_0x4eb05a[_0x8a088b(0x1ea)]=Math[_0x8a088b(0x226)](0x0,Math[_0x8a088b(0x22b)](_0x4eb05a['product_stock'])-Math[_0x8a088b(0x22b)](_0x21a9b9['quantity'])));});return _0x237952;});Promise['all'](_0x2a4dc9)['then'](async _0x134f9a=>{var _0x35e1e0=_0x536d70;try{for(const _0x62b090 of _0x134f9a){await _0x62b090[_0x35e1e0(0x1df)]();}_0x28124f[_0x35e1e0(0x208)]=_0x35e1e0(0x145);const _0x3b73b2=await _0x28124f[_0x35e1e0(0x1df)](),_0x4d6ce8=await master_shop[_0x35e1e0(0x238)](),_0x490205=await email_settings['findOne'](),_0x200989=await supervisor_settings[_0x35e1e0(0x238)]();var _0x2a6828=_0x28124f[_0x35e1e0(0x14d)],_0x3dad97='',_0x3e6551;for(_0x3e6551 in _0x2a6828){_0x3dad97+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a6828[_0x3e6551][_0x35e1e0(0x23e)]+_0x35e1e0(0x217)+_0x35e1e0(0x1f2)+_0x2a6828[_0x3e6551][_0x35e1e0(0x1ef)]+_0x35e1e0(0x217)+_0x35e1e0(0x1f2)+_0x2a6828[_0x3e6551][_0x35e1e0(0x21e)]+_0x35e1e0(0x217)+_0x35e1e0(0x1f2)+_0x2a6828[_0x3e6551][_0x35e1e0(0x1e9)]+_0x35e1e0(0x217)+_0x35e1e0(0x1f2)+_0x2a6828[_0x3e6551][_0x35e1e0(0x18d)]+_0x35e1e0(0x217)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x28124f[_0x35e1e0(0x1ec)]+_0x35e1e0(0x217)+_0x35e1e0(0x1f2)+_0x2a6828[_0x3e6551][_0x35e1e0(0x220)]+_0x35e1e0(0x217)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a6828[_0x3e6551]['storage']+_0x2a6828[_0x3e6551]['rack']+_0x2a6828[_0x3e6551][_0x35e1e0(0x151)]+_0x2a6828[_0x3e6551][_0x35e1e0(0x1c8)]+_0x2a6828[_0x3e6551][_0x35e1e0(0x212)][0x0]+_0x2a6828[_0x3e6551][_0x35e1e0(0x248)]+_0x35e1e0(0x217),'</tr>';}let _0x142929=nodemailer[_0x35e1e0(0x22f)]({'host':_0x490205[_0x35e1e0(0x215)],'port':Number(_0x490205['port']),'secure':![],'auth':{'user':_0x490205[_0x35e1e0(0x232)],'pass':_0x490205[_0x35e1e0(0x211)]}}),_0x571c4f={'from':_0x490205['email'],'to':_0x200989[0x0][_0x35e1e0(0x241)],'subject':_0x35e1e0(0x205),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x35e1e0(0x1d3)+_0x4d6ce8[0x0][_0x35e1e0(0x159)],'cid':'logo'}],'html':_0x35e1e0(0x1ff)+_0x35e1e0(0x1f0)+_0x35e1e0(0x14f)+_0x35e1e0(0x13f)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x35e1e0(0x13f)+_0x35e1e0(0x21a)+'</div>'+_0x35e1e0(0x13f)+_0x35e1e0(0x188)+_0x4d6ce8[0x0][_0x35e1e0(0x1cb)]+'\x20</h2>'+_0x35e1e0(0x242)+'</div>'+_0x35e1e0(0x1d9)+_0x35e1e0(0x13f)+_0x35e1e0(0x1a5)+_0x35e1e0(0x194)+_0x28124f['invoice']+'\x20'+_0x35e1e0(0x225)+_0x35e1e0(0x13e)+_0x28124f['date']+'\x20'+_0x35e1e0(0x1b9)+'</h5>'+_0x35e1e0(0x242)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x35e1e0(0x236)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x35e1e0(0x176)+_0x35e1e0(0x23d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x35e1e0(0x146)+_0x35e1e0(0x1fe)+_0x35e1e0(0x169)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x35e1e0(0x20a)+_0x35e1e0(0x1e4)+_0x35e1e0(0x1a1)+'\x20'+_0x3dad97+'\x20'+'</tbody>'+_0x35e1e0(0x16f)+'<div>'+_0x35e1e0(0x173)+_0x35e1e0(0x246)+_0x4d6ce8[0x0][_0x35e1e0(0x1cb)]+_0x35e1e0(0x21c)+_0x35e1e0(0x242)+_0x35e1e0(0x242)+_0x35e1e0(0x1d4)};_0x142929[_0x35e1e0(0x204)](_0x571c4f,function(_0x39ba0f,_0x404125){var _0x12a243=_0x35e1e0;_0x39ba0f?(console[_0x12a243(0x245)](_0x39ba0f),console[_0x12a243(0x245)](_0x12a243(0x1d5))):console['log']('Email\x20sent\x20successfully');}),_0x45a419['flash'](_0x35e1e0(0x183),'Sales\x20Update\x20successfully'),_0x27f68c[_0x35e1e0(0x13b)](_0x35e1e0(0x22e)+_0x4d1283);}catch(_0x553c22){console[_0x35e1e0(0x22d)](_0x553c22),_0x27f68c[_0x35e1e0(0x1bb)](0x1f4)[_0x35e1e0(0x247)]({'error':_0x35e1e0(0x142)});}})[_0x536d70(0x18f)](_0x4cc709=>{var _0x5419cd=_0x536d70;console['error'](_0x4cc709),_0x27f68c[_0x5419cd(0x1bb)](0x1f4)[_0x5419cd(0x247)]({'error':_0x5419cd(0x178)});});}catch(_0x39e68d){console[_0x536d70(0x245)](_0x39e68d);}}),router[a0_0x49ae98(0x187)](a0_0x49ae98(0x1b5),auth,async(_0x4080f3,_0x283d5f)=>{var _0x3e9576=a0_0x49ae98;try{const {username:_0x236d43,email:_0x87753c,role:_0x2f0be5}=_0x4080f3[_0x3e9576(0x1d8)],_0x5ed3bd=_0x4080f3['user'],_0xf312f0=await profile[_0x3e9576(0x228)]({'email':_0x5ed3bd[_0x3e9576(0x232)]}),_0x442ee3=await master_shop['find'](),_0x151383=_0x4080f3[_0x3e9576(0x198)]['id'],_0x578283=await sales[_0x3e9576(0x1ab)](_0x151383);var _0x5ed10f=[_0x3e9576(0x23b),'Enclosed'];const _0x3f0898=await warehouse[_0x3e9576(0x160)]([{'$match':{'name':_0x578283[_0x3e9576(0x1ec)],'warehouse_category':_0x3e9576(0x16b)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3e9576(0x1cd)},'product_stock':{'$first':_0x3e9576(0x16a)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3e9576(0x16d)},'floorlevel':{'$first':_0x3e9576(0x1e1)},'primary_code':{'$first':_0x3e9576(0x21f)},'secondary_code':{'$first':_0x3e9576(0x1e5)},'product_code':{'$first':_0x3e9576(0x14a)},'storage':{'$first':_0x3e9576(0x1f8)},'rack':{'$first':_0x3e9576(0x231)}}}]),_0x56402b=await customer['find']({});let _0x3c20ab;if(_0x5ed3bd[_0x3e9576(0x199)]=='staff'){const _0x425aca=await staff[_0x3e9576(0x228)]({'email':_0x5ed3bd[_0x3e9576(0x232)]});_0x3c20ab=await warehouse[_0x3e9576(0x160)]([{'$match':{'status':'Enabled','name':_0x425aca[_0x3e9576(0x17c)],'warehouse_category':_0x3e9576(0x16b)}},{'$group':{'_id':_0x3e9576(0x166),'name':{'$first':_0x3e9576(0x166)}}}]);}else _0x3c20ab=await warehouse[_0x3e9576(0x160)]([{'$match':{'status':_0x3e9576(0x17e),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3e9576(0x166),'name':{'$first':'$name'}}}]);const _0x684a35=await product[_0x3e9576(0x238)]({});if(_0x442ee3[0x0][_0x3e9576(0x1ed)]==_0x3e9576(0x154)){var _0x598a4d=users[_0x3e9576(0x1d0)];console[_0x3e9576(0x245)](_0x598a4d);}else{if(_0x442ee3[0x0][_0x3e9576(0x1ed)]=='Hindi')var _0x598a4d=users[_0x3e9576(0x20e)];else{if(_0x442ee3[0x0][_0x3e9576(0x1ed)]=='German')var _0x598a4d=users[_0x3e9576(0x1e6)];else{if(_0x442ee3[0x0][_0x3e9576(0x1ed)]==_0x3e9576(0x1c6))var _0x598a4d=users[_0x3e9576(0x1c6)];else{if(_0x442ee3[0x0][_0x3e9576(0x1ed)]==_0x3e9576(0x218))var _0x598a4d=users[_0x3e9576(0x218)];else{if(_0x442ee3[0x0][_0x3e9576(0x1ed)]==_0x3e9576(0x213))var _0x598a4d=users[_0x3e9576(0x1b3)];else{if(_0x442ee3[0x0][_0x3e9576(0x1ed)]==_0x3e9576(0x1bc))var _0x598a4d=users[_0x3e9576(0x1bc)];else{if(_0x442ee3[0x0][_0x3e9576(0x1ed)]==_0x3e9576(0x22a))var _0x598a4d=users['Arabic'];}}}}}}}_0x283d5f[_0x3e9576(0x1c7)](_0x3e9576(0x210),{'success':_0x4080f3[_0x3e9576(0x15b)](_0x3e9576(0x183)),'errors':_0x4080f3['flash'](_0x3e9576(0x1f5)),'role':_0x5ed3bd,'profile':_0xf312f0,'customer':_0x56402b,'warehouse':_0x3c20ab,'product':_0x3f0898,'user':_0x578283,'master_shop':_0x442ee3,'unit':_0x684a35,'language':_0x598a4d});}catch(_0x278a93){console['log'](_0x278a93);}}),router[a0_0x49ae98(0x1fd)](a0_0x49ae98(0x1b5),auth,async(_0x19b589,_0x2c04b5)=>{var _0x5e69e3=a0_0x49ae98;try{const _0xcfe0fb=_0x19b589['params']['id'],_0x29f3c5=await sales['findOne']({'_id':_0x19b589[_0x5e69e3(0x198)]['id']}),_0x41d2c6=await warehouse[_0x5e69e3(0x228)]({'name':_0x29f3c5[_0x5e69e3(0x1ec)],'room':_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x230)]}),{invoice:_0x32c104,date:_0x4e1d35,warehouse_name:_0x4cfd62,product_name:_0x3abdc8,stock:_0x2b5017,quantity:_0x5c1ea1,note:_0x4ba246,room:_0x16cf75,customer:_0x373f51,SCRN:_0x5040fd}=_0x19b589[_0x5e69e3(0x161)];if(typeof _0x3abdc8==_0x5e69e3(0x17b))var _0xb73687=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x23e)]],_0x228a48=[_0x19b589['body'][_0x5e69e3(0x1c1)]],_0x2bb83a=[_0x19b589['body'][_0x5e69e3(0x174)]],_0x25e7b1=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x20c)]],_0x553db4=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x19b)]],_0xb74b7=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x1ae)]],_0x3d5d5b=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x15f)]],_0x355a74=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x1dc)]],_0x5b8a93=[_0x19b589['body']['secondary_unit']],_0x29e818=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x1fc)]],_0x4d4de8=[_0x19b589[_0x5e69e3(0x161)]['expiry_date']],_0x5a39ea=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x144)]],_0x2c0870=[_0x19b589[_0x5e69e3(0x161)]['production_date']],_0x441ac5=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x1c3)]],_0x321b7d=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x18c)]],_0x49f659=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x1b8)]],_0x2f8bae=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x179)]],_0x462b49=[_0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x21e)]],_0xbeef5c=[_0x19b589['body'][_0x5e69e3(0x139)]];else var _0xb73687=[..._0x19b589['body'][_0x5e69e3(0x23e)]],_0x228a48=[..._0x19b589[_0x5e69e3(0x161)]['stock']],_0x2bb83a=[..._0x19b589[_0x5e69e3(0x161)]['carton']],_0x25e7b1=[..._0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x20c)]],_0x553db4=[..._0x19b589[_0x5e69e3(0x161)]['secondary_code']],_0xb74b7=[..._0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x1ae)]],_0x3d5d5b=[..._0x19b589[_0x5e69e3(0x161)]['level']],_0x355a74=[..._0x19b589[_0x5e69e3(0x161)]['primary_unit']],_0x5b8a93=[..._0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x18d)]],_0x29e818=[..._0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x1fc)]],_0x4d4de8=[..._0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x1c4)]],_0x5a39ea=[..._0x19b589['body'][_0x5e69e3(0x144)]],_0x2c0870=[..._0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x15e)]],_0x441ac5=[..._0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x1c3)]],_0x321b7d=[..._0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x18c)]],_0x49f659=[..._0x19b589[_0x5e69e3(0x161)][_0x5e69e3(0x1b8)]],_0x2f8bae=[..._0x19b589[_0x5e69e3(0x161)]['prod_cat']],_0x462b49=[..._0x19b589['body'][_0x5e69e3(0x21e)]],_0xbeef5c=[..._0x19b589['body'][_0x5e69e3(0x139)]];const _0xb60e02=_0xb73687[_0x5e69e3(0x175)](_0xe85eb9=>{return _0xe85eb9={'product_name':_0xe85eb9};});_0x228a48[_0x5e69e3(0x1b4)]((_0x5663ed,_0x385906)=>{var _0x4f62c7=_0x5e69e3;_0xb60e02[_0x385906]['stock']=Math[_0x4f62c7(0x22b)](_0x5663ed);}),_0x2bb83a[_0x5e69e3(0x1b4)]((_0x39d586,_0x45c957)=>{var _0x29c445=_0x5e69e3;_0xb60e02[_0x45c957][_0x29c445(0x21e)]=_0x39d586;}),_0x25e7b1[_0x5e69e3(0x1b4)]((_0x37f696,_0x37f63c)=>{var _0x5e901f=_0x5e69e3;_0xb60e02[_0x37f63c][_0x5e901f(0x20c)]=_0x37f696;}),_0x553db4[_0x5e69e3(0x1b4)]((_0xbbecab,_0x81b106)=>{var _0x2e7dd8=_0x5e69e3;_0xb60e02[_0x81b106][_0x2e7dd8(0x19b)]=_0xbbecab;}),_0xb74b7[_0x5e69e3(0x1b4)]((_0x3ae944,_0x116035)=>{_0xb60e02[_0x116035]['product_code']=_0x3ae944;}),_0x3d5d5b[_0x5e69e3(0x1b4)]((_0x38851c,_0x313a2f)=>{var _0x92ad6b=_0x5e69e3;_0xbeef5c[_0x92ad6b(0x1b4)]((_0x133c93,_0x12a6d)=>{var _0x35abc0=_0x92ad6b;if(_0x133c93==_0x35abc0(0x1e7)&&_0x313a2f==_0x12a6d){var _0x4a9103=_0x38851c[_0x35abc0(0x1aa)](0x3);_0xb60e02[_0x313a2f][_0x35abc0(0x1ee)]=_0x38851c[0x0],_0xb60e02[_0x313a2f][_0x35abc0(0x233)]=_0x38851c[0x1],_0xb60e02[_0x313a2f][_0x35abc0(0x151)]=0x0,_0xb60e02[_0x313a2f][_0x35abc0(0x1c8)]=0x0,_0xb60e02[_0x313a2f]['type']=_0x35abc0(0x143),_0xb60e02[_0x313a2f][_0x35abc0(0x248)]=_0x4a9103;}else{if(_0x133c93==_0x35abc0(0x1b7)&&_0x313a2f==_0x12a6d){var _0x4a9103=_0x38851c[_0x35abc0(0x1aa)](0x3);_0xb60e02[_0x313a2f][_0x35abc0(0x1ee)]=_0x38851c[0x0],_0xb60e02[_0x313a2f][_0x35abc0(0x233)]=_0x38851c[0x1],_0xb60e02[_0x313a2f]['bay']=0x0,_0xb60e02[_0x313a2f][_0x35abc0(0x1c8)]=0x0,_0xb60e02[_0x313a2f][_0x35abc0(0x212)]='Floor',_0xb60e02[_0x313a2f][_0x35abc0(0x248)]=_0x38851c[0x5];}else{if(_0x313a2f==_0x12a6d){var _0x4ae9e0;if(_0x38851c[0x4]=='L')_0x4ae9e0=_0x35abc0(0x1cf);else _0x38851c[0x4]=='F'&&(_0x4ae9e0=_0x35abc0(0x143));_0xb60e02[_0x313a2f][_0x35abc0(0x1ee)]=_0x38851c[0x0],_0xb60e02[_0x313a2f][_0x35abc0(0x233)]=_0x38851c[0x1],_0xb60e02[_0x313a2f][_0x35abc0(0x151)]=_0x38851c[0x2],_0xb60e02[_0x313a2f]['bin']=_0x38851c[0x3],_0xb60e02[_0x313a2f][_0x35abc0(0x212)]=_0x4ae9e0,_0xb60e02[_0x313a2f]['floorlevel']=_0x38851c[0x5];}}}});}),_0x355a74[_0x5e69e3(0x1b4)]((_0x2122c9,_0x5029f5)=>{var _0x137c05=_0x5e69e3;_0xb60e02[_0x5029f5][_0x137c05(0x1e9)]=_0x2122c9;}),_0x5b8a93[_0x5e69e3(0x1b4)]((_0x29e238,_0x307865)=>{var _0x3b9333=_0x5e69e3;_0xb60e02[_0x307865][_0x3b9333(0x18d)]=_0x29e238;}),_0x29e818[_0x5e69e3(0x1b4)]((_0x3fb43b,_0x402a4c)=>{var _0x5a32eb=_0x5e69e3;_0xb60e02[_0x402a4c][_0x5a32eb(0x1fc)]=_0x3fb43b;}),_0x4d4de8['forEach']((_0x1828b8,_0x1515dc)=>{var _0xe1b270=_0x5e69e3;_0xb60e02[_0x1515dc][_0xe1b270(0x1c4)]=_0x1828b8;}),_0x5a39ea[_0x5e69e3(0x1b4)]((_0x3ad6ea,_0x1687c2)=>{var _0x2de6b7=_0x5e69e3;_0xb60e02[_0x1687c2][_0x2de6b7(0x214)]=_0x3ad6ea;}),_0x2c0870[_0x5e69e3(0x1b4)]((_0x117cff,_0x512f65)=>{var _0x198a7f=_0x5e69e3;_0xb60e02[_0x512f65][_0x198a7f(0x15e)]=_0x117cff;}),_0x441ac5['forEach']((_0x579e33,_0x5651f2)=>{var _0x149589=_0x5e69e3;_0xb60e02[_0x5651f2][_0x149589(0x1c3)]=Math[_0x149589(0x22b)](_0x579e33);}),_0x321b7d[_0x5e69e3(0x1b4)]((_0x1f3cc6,_0x2bb988)=>{_0xb60e02[_0x2bb988]['delivery_date']=_0x1f3cc6;}),_0x49f659[_0x5e69e3(0x1b4)]((_0x2de1e6,_0x18881e)=>{var _0x3fb79d=_0x5e69e3;_0xb60e02[_0x18881e][_0x3fb79d(0x1b8)]=_0x2de1e6;}),_0x2f8bae[_0x5e69e3(0x1b4)]((_0x4b9cf9,_0x2af9f2)=>{var _0x26f4bd=_0x5e69e3;_0xb60e02[_0x2af9f2][_0x26f4bd(0x179)]=_0x4b9cf9;}),_0x462b49[_0x5e69e3(0x1b4)]((_0x4ec546,_0x372c66)=>{var _0x5e5dee=_0x5e69e3;_0xb60e02[_0x372c66][_0x5e5dee(0x1d6)]=_0x4ec546;}),_0xbeef5c[_0x5e69e3(0x1b4)]((_0x2a1b8b,_0x2e3f85)=>{var _0x568eca=_0x5e69e3;_0xb60e02[_0x2e3f85][_0x568eca(0x220)]=_0x2a1b8b;});var _0xf05ef0=0x0;_0xb60e02['forEach'](_0x15048a=>{var _0xb7752d=_0x5e69e3;console[_0xb7752d(0x245)]('foreach\x20newproduct',_0x15048a),(parseInt(_0x15048a[_0xb7752d(0x1c1)])<parseInt(_0x15048a[_0xb7752d(0x21e)])||parseInt(_0x15048a['quantity'])==0x0)&&_0xf05ef0++;});if(_0xf05ef0!=0x0)return _0x19b589[_0x5e69e3(0x15b)]('errors',_0x5e69e3(0x13d)),_0x2c04b5['redirect'](_0x5e69e3(0x219));const _0x2a83b6=_0xb60e02[_0x5e69e3(0x192)](_0x32b705=>_0x32b705['quantity']!=='0'&&_0x32b705['quantity']!=='');_0x29f3c5[_0x5e69e3(0x222)]=_0x32c104,_0x29f3c5[_0x5e69e3(0x235)]=_0x373f51,_0x29f3c5[_0x5e69e3(0x22c)]=_0x4e1d35,_0x29f3c5['warehouse_name']=_0x4cfd62,_0x29f3c5[_0x5e69e3(0x14d)]=_0x2a83b6,_0x29f3c5['note']=_0x4ba246,_0x29f3c5[_0x5e69e3(0x17d)]=_0x5040fd,_0x29f3c5[_0x5e69e3(0x208)]='False',_0x29f3c5[_0x5e69e3(0x1e2)]=_0x5e69e3(0x19e);const _0x4a9aa2=await _0x29f3c5[_0x5e69e3(0x1df)]();_0x19b589['flash'](_0x5e69e3(0x183),_0x5e69e3(0x149)),_0x2c04b5[_0x5e69e3(0x13b)]('/all_sales/view');}catch(_0x33002c){console['log'](_0x33002c);}}),router[a0_0x49ae98(0x1fd)]('/give_payment/:id',auth,async(_0x43e6b2,_0x138006)=>{var _0x552007=a0_0x49ae98;try{const _0x720e3f=_0x43e6b2['params']['id'],{invoice:_0x5c1032,customer:_0x43551b,receivable_amount:_0x192c11,received_amount:_0x359ffc}=_0x43e6b2['body'],_0xa71fe=await sales[_0x552007(0x1ab)](_0x720e3f);console['log'](_0xa71fe);var _0x322301=_0x192c11-_0x359ffc;console[_0x552007(0x245)](_0x359ffc),_0xa71fe[_0x552007(0x182)]=parseFloat(_0x359ffc)+parseFloat(_0xa71fe['received_amount']),_0xa71fe[_0x552007(0x185)]=_0x322301,console[_0x552007(0x245)](_0xa71fe);const _0x16924f=await _0xa71fe[_0x552007(0x1df)](),_0x560f14=await c_payment_data[_0x552007(0x228)]({'invoice':_0x5c1032});_0x560f14[_0x552007(0x140)]=_0x322301,await _0x560f14[_0x552007(0x1df)]();let _0x401173=new Date(),_0x146820=('0'+_0x401173[_0x552007(0x1dd)]())[_0x552007(0x1aa)](-0x2),_0x39e9db=('0'+(_0x401173[_0x552007(0x227)]()+0x1))[_0x552007(0x1aa)](-0x2),_0x5578b3=_0x401173[_0x552007(0x152)](),_0x208d2a=_0x5578b3+'-'+_0x39e9db+'-'+_0x146820;const _0x85386a=new customer_payment({'invoice':_0x5c1032,'date':_0x5578b3+'-'+_0x39e9db+'-'+_0x146820,'customer':_0x43551b,'reason':_0x552007(0x17f),'amount':_0x359ffc}),_0x1206b4=await _0x85386a['save']();_0x43e6b2[_0x552007(0x15b)]('success','payment\x20successfull'),_0x138006['redirect'](_0x552007(0x16c));}catch(_0x2dfe57){console[_0x552007(0x245)](_0x2dfe57);}}),router['get']('/invoice/:id',auth,async(_0x6da191,_0x16c8e6)=>{var _0x2e0a81=a0_0x49ae98;try{const {username:_0x377dde,email:_0x5b5bb8,role:_0xfb7d1c}=_0x6da191['user'],_0x255c3b=_0x6da191[_0x2e0a81(0x1d8)],_0x36976b=await profile[_0x2e0a81(0x228)]({'email':_0x255c3b[_0x2e0a81(0x232)]}),_0x219a63=await master_shop['find']();console[_0x2e0a81(0x245)](_0x2e0a81(0x1bf),_0x219a63);const _0x1bf78e=_0x6da191[_0x2e0a81(0x198)]['id'],_0x447129=await sales[_0x2e0a81(0x1ab)](_0x1bf78e);console[_0x2e0a81(0x245)](_0x447129);const _0x2548cc=await customer[_0x2e0a81(0x228)]({'name':_0x447129[_0x2e0a81(0x235)]});console[_0x2e0a81(0x245)](_0x2548cc);if(_0x219a63[0x0][_0x2e0a81(0x1ed)]==_0x2e0a81(0x154)){var _0x581abf=users[_0x2e0a81(0x1d0)];console[_0x2e0a81(0x245)](_0x581abf);}else{if(_0x219a63[0x0][_0x2e0a81(0x1ed)]==_0x2e0a81(0x20e))var _0x581abf=users[_0x2e0a81(0x20e)];else{if(_0x219a63[0x0][_0x2e0a81(0x1ed)]==_0x2e0a81(0x1e6))var _0x581abf=users['German'];else{if(_0x219a63[0x0][_0x2e0a81(0x1ed)]==_0x2e0a81(0x1c6))var _0x581abf=users[_0x2e0a81(0x1c6)];else{if(_0x219a63[0x0][_0x2e0a81(0x1ed)]=='French')var _0x581abf=users[_0x2e0a81(0x218)];else{if(_0x219a63[0x0][_0x2e0a81(0x1ed)]==_0x2e0a81(0x213))var _0x581abf=users[_0x2e0a81(0x1b3)];else{if(_0x219a63[0x0]['language']==_0x2e0a81(0x1bc))var _0x581abf=users[_0x2e0a81(0x1bc)];else{if(_0x219a63[0x0][_0x2e0a81(0x1ed)]=='Arabic\x20(ae)')var _0x581abf=users[_0x2e0a81(0x14b)];}}}}}}}_0x16c8e6[_0x2e0a81(0x1c7)]('sales_invoice',{'success':_0x6da191['flash'](_0x2e0a81(0x183)),'errors':_0x6da191[_0x2e0a81(0x15b)](_0x2e0a81(0x1f5)),'role':_0x255c3b,'profile':_0x36976b,'master_shop':_0x219a63,'customers':_0x2548cc,'sales':_0x447129,'language':_0x581abf});}catch(_0x46e503){console['log'](_0x46e503);}}),router[a0_0x49ae98(0x187)]('/view/return_sales/:id',auth,async(_0x4820d1,_0x214b4d)=>{var _0x362686=a0_0x49ae98;try{const {username:_0x340f8b,email:_0x3d503d,role:_0x46c753}=_0x4820d1[_0x362686(0x1d8)],_0x3dcabf=_0x4820d1['user'],_0x527294=await profile[_0x362686(0x228)]({'email':_0x3dcabf[_0x362686(0x232)]}),_0x486618=await master_shop[_0x362686(0x238)]();console[_0x362686(0x245)](_0x362686(0x1bf),_0x486618);const _0x343675=_0x4820d1[_0x362686(0x198)]['id'];console['log'](_0x343675);const _0x10b335=await sales['findById'](_0x343675);console[_0x362686(0x245)](_0x362686(0x155),_0x10b335);const _0x3c63bd=await warehouse[_0x362686(0x160)]([{'$match':{'name':'Return\x20Goods','room':_0x362686(0x206)}},{'$unwind':_0x362686(0x1f9)},{'$group':{'_id':_0x362686(0x1eb),'name':{'$first':_0x362686(0x1cd)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x362686(0x202)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x362686(0x1fb)},'primary_code':{'$first':_0x362686(0x21f)},'secondary_code':{'$first':_0x362686(0x1e5)},'product_code':{'$first':_0x362686(0x14a)}}}]);console[_0x362686(0x245)](_0x362686(0x229),_0x3c63bd);const _0x4ca5f8=await product['find']({});warehouse_data=await warehouse[_0x362686(0x160)]([{'$match':{'status':'Enabled','name':_0x362686(0x180),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x362686(0x166),'name':{'$first':_0x362686(0x166)}}},{'$sort':{'name':0x1}}]);var _0x3c18df=['Return\x20Rooms'];if(_0x486618[0x0][_0x362686(0x1ed)]==_0x362686(0x154)){var _0x3a1cdc=users['English'];console['log'](_0x3a1cdc);}else{if(_0x486618[0x0][_0x362686(0x1ed)]==_0x362686(0x20e))var _0x3a1cdc=users[_0x362686(0x20e)];else{if(_0x486618[0x0][_0x362686(0x1ed)]=='German')var _0x3a1cdc=users[_0x362686(0x1e6)];else{if(_0x486618[0x0][_0x362686(0x1ed)]==_0x362686(0x1c6))var _0x3a1cdc=users['Spanish'];else{if(_0x486618[0x0][_0x362686(0x1ed)]=='French')var _0x3a1cdc=users[_0x362686(0x218)];else{if(_0x486618[0x0][_0x362686(0x1ed)]==_0x362686(0x213))var _0x3a1cdc=users['Portuguese'];else{if(_0x486618[0x0][_0x362686(0x1ed)]==_0x362686(0x1bc))var _0x3a1cdc=users[_0x362686(0x1bc)];else{if(_0x486618[0x0][_0x362686(0x1ed)]==_0x362686(0x22a))var _0x3a1cdc=users[_0x362686(0x14b)];}}}}}}}_0x214b4d['render'](_0x362686(0x20b),{'success':_0x4820d1[_0x362686(0x15b)](_0x362686(0x183)),'errors':_0x4820d1[_0x362686(0x15b)]('errors'),'role':_0x3dcabf,'profile':_0x527294,'user':_0x10b335,'stock':_0x3c63bd,'master_shop':_0x486618,'unit':_0x4ca5f8,'language':_0x3a1cdc,'warehouses':warehouse_data,'rooms':_0x3c18df});}catch(_0x575e8a){console[_0x362686(0x245)](_0x575e8a),_0x214b4d[_0x362686(0x1bb)](0xc8)[_0x362686(0x247)]({'message':_0x575e8a[_0x362686(0x1c5)]});}}),router['post'](a0_0x49ae98(0x1e0),auth,async(_0x355c06,_0x370686)=>{var _0xfa1322=a0_0x49ae98;try{const {invoice:_0x109beb,date:_0x5b10d7,warehouse_name:_0x586061,product_name:_0xcbceef,primary_code:_0x2412e8,secondary_code:_0x35658f,product_code:_0x5e621c,sales_quantity:_0x4e889d,stocks:_0x57be30,return_qty:_0x5db9d7,Room_name:_0x34caf3,to_warehouse_name:_0x5cd65d,to_Roomname:_0x579c82,to_Room_name:_0x104d1c,note:_0x10ac11,level:_0x2a1688,isle:_0x25840e,pallet:_0x1ff605}=_0x355c06[_0xfa1322(0x161)];if(typeof _0xcbceef==_0xfa1322(0x17b))var _0x5e3474=[_0x355c06[_0xfa1322(0x161)]['product_name']],_0x4214f9=[_0x355c06[_0xfa1322(0x161)]['primary_code']],_0x51118a=[_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x19b)]],_0x1bc2cf=[_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x1ef)]],_0x308327=[_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x237)]],_0x2b07d1=[_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x1ce)]],_0xd25ed6=[_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x1a9)]],_0x30b90f=[_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x151)]],_0x2cb196=[_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x1c8)]],_0x1849ce=[_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x201)]],_0x48d879=[_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x248)]];else var _0x5e3474=[..._0x355c06[_0xfa1322(0x161)]['product_name']],_0x4214f9=[..._0x355c06['body'][_0xfa1322(0x20c)]],_0x51118a=[..._0x355c06[_0xfa1322(0x161)][_0xfa1322(0x19b)]],_0x1bc2cf=[..._0x355c06[_0xfa1322(0x161)][_0xfa1322(0x1ef)]],_0x308327=[..._0x355c06[_0xfa1322(0x161)]['sales_quantity']],_0x2b07d1=[..._0x355c06[_0xfa1322(0x161)][_0xfa1322(0x1ce)]],_0xd25ed6=[..._0x355c06[_0xfa1322(0x161)][_0xfa1322(0x1a9)]],_0x30b90f=[..._0x355c06[_0xfa1322(0x161)]['bay']],_0x2cb196=[..._0x355c06[_0xfa1322(0x161)][_0xfa1322(0x1c8)]],_0x1849ce=[..._0x355c06[_0xfa1322(0x161)][_0xfa1322(0x201)]],_0x48d879=[..._0x355c06[_0xfa1322(0x161)][_0xfa1322(0x248)]];const _0x583ffb=_0x5e3474[_0xfa1322(0x175)](_0x4a5c6f=>{return _0x4a5c6f={'product_name':_0x4a5c6f};});_0x4214f9[_0xfa1322(0x1b4)]((_0x3b9f6b,_0x58bd2e)=>{var _0x14b5f4=_0xfa1322;_0x583ffb[_0x58bd2e][_0x14b5f4(0x20c)]=_0x3b9f6b;}),_0x51118a[_0xfa1322(0x1b4)]((_0x239141,_0x2059af)=>{var _0x11bdf2=_0xfa1322;_0x583ffb[_0x2059af][_0x11bdf2(0x19b)]=_0x239141;}),_0x1bc2cf['forEach']((_0x55ef52,_0x57022c)=>{_0x583ffb[_0x57022c]['product_code']=_0x55ef52;}),_0x308327['forEach']((_0x3b3735,_0x4db70c)=>{_0x583ffb[_0x4db70c]['sale_qty']=_0x3b3735;}),_0x2b07d1[_0xfa1322(0x1b4)]((_0x9a0758,_0x1bce75)=>{_0x583ffb[_0x1bce75]['stock']=_0x9a0758;}),_0xd25ed6[_0xfa1322(0x1b4)]((_0x56fa89,_0x278863)=>{_0x583ffb[_0x278863]['return_qty']=_0x56fa89;}),_0x30b90f[_0xfa1322(0x1b4)]((_0x4801cb,_0x5f41e8)=>{var _0x4fe0ff=_0xfa1322;_0x583ffb[_0x5f41e8][_0x4fe0ff(0x151)]=_0x4801cb;}),_0x2cb196[_0xfa1322(0x1b4)]((_0x4dc1d2,_0x2eb3f0)=>{var _0x15291a=_0xfa1322;_0x583ffb[_0x2eb3f0][_0x15291a(0x1c8)]=_0x4dc1d2;}),_0x1849ce[_0xfa1322(0x1b4)]((_0x2de210,_0x2b779c)=>{var _0x26c560=_0xfa1322;_0x583ffb[_0x2b779c][_0x26c560(0x212)]=_0x2de210;}),_0x48d879[_0xfa1322(0x1b4)]((_0x49be38,_0x3ac652)=>{var _0x158a09=_0xfa1322;_0x583ffb[_0x3ac652][_0x158a09(0x248)]=_0x49be38;});var _0x1e7a47=0x0;_0x583ffb[_0xfa1322(0x1b4)](_0x27308a=>{var _0x36716e=_0xfa1322;console[_0x36716e(0x245)](_0x36716e(0x165),_0x27308a),(parseInt(_0x27308a[_0x36716e(0x1a3)])<parseInt(_0x27308a[_0x36716e(0x1a9)])||parseInt(_0x27308a[_0x36716e(0x1c1)])<parseInt(_0x27308a['return_qty'])&&parseInt(_0x27308a['sale_qty'])>parseInt(_0x27308a[_0x36716e(0x1a9)])||parseInt(_0x27308a[_0x36716e(0x1a9)])==0x0)&&_0x1e7a47++;});if(_0x1e7a47!=0x0)return _0x355c06[_0xfa1322(0x15b)](_0xfa1322(0x1f5),_0xfa1322(0x18e)),_0x370686[_0xfa1322(0x13b)](_0xfa1322(0x219));const _0x5974d1=await sales[_0xfa1322(0x228)]({'invoice':_0x109beb});console[_0xfa1322(0x245)](_0x5974d1),_0x5974d1['return_data']=_0xfa1322(0x145);const _0x4c2762=await _0x5974d1[_0xfa1322(0x1df)](),_0x5731d2=new sales_return({'invoice':_0x109beb,'customer':_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x235)],'date':_0x5b10d7,'warehouse_name':_0x586061,'room':_0x34caf3,'ToWarehouse':_0x5cd65d,'ToRoom':_0x104d1c,'return_sale':_0x583ffb,'note':_0x10ac11}),_0x19161c=await _0x5731d2[_0xfa1322(0x1df)]();console[_0xfa1322(0x245)](_0x5731d2);const _0x46fede=await sales_return[_0xfa1322(0x228)]({'invoice':_0x109beb}),_0x357342=await warehouse[_0xfa1322(0x228)]({'name':_0x5cd65d,'room':_0x104d1c});_0x46fede[_0xfa1322(0x20b)][_0xfa1322(0x1b4)](_0x4aedd3=>{var _0x5ce4d3=_0xfa1322,_0x295e47=0x0;const _0x9b5049=_0x357342[_0x5ce4d3(0x1cc)][_0x5ce4d3(0x175)](_0x360f1e=>{var _0x277a6e=_0x5ce4d3;_0x360f1e[_0x277a6e(0x23e)]==_0x4aedd3[_0x277a6e(0x23e)]&&_0x360f1e[_0x277a6e(0x248)]==_0x4aedd3[_0x277a6e(0x248)]&&_0x360f1e['type']==_0x4aedd3[_0x277a6e(0x212)]&&_0x360f1e[_0x277a6e(0x1c8)]==_0x4aedd3[_0x277a6e(0x1c8)]&&_0x360f1e['bay']==_0x4aedd3['bay']&&(_0x360f1e['product_stock']=parseInt(_0x360f1e['product_stock'])+parseInt(_0x4aedd3[_0x277a6e(0x1a9)]),_0x295e47++);});_0x295e47=='0'&&(_0x357342[_0x5ce4d3(0x1cc)]=_0x357342[_0x5ce4d3(0x1cc)][_0x5ce4d3(0x1be)]({'product_name':_0x4aedd3[_0x5ce4d3(0x23e)],'product_stock':_0x4aedd3[_0x5ce4d3(0x1a9)],'primary_code':_0x4aedd3['primary_code'],'secondary_code':_0x4aedd3[_0x5ce4d3(0x19b)],'product_code':_0x4aedd3[_0x5ce4d3(0x1ef)],'bay':_0x4aedd3[_0x5ce4d3(0x151)],'bin':_0x4aedd3[_0x5ce4d3(0x1c8)],'type':_0x4aedd3[_0x5ce4d3(0x212)],'floorlevel':_0x4aedd3[_0x5ce4d3(0x248)]})),console[_0x5ce4d3(0x245)](_0x5ce4d3(0x13a),_0x357342);}),await _0x357342[_0xfa1322(0x1df)](),console[_0xfa1322(0x245)](_0x355c06[_0xfa1322(0x161)]);const _0xc172f9=new c_payment_data({'invoice':_0x109beb,'customer':_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x235)],'reason':'Sale\x20Return'});await _0xc172f9[_0xfa1322(0x1df)]();const _0x3e4f1c=await master_shop[_0xfa1322(0x238)]();console[_0xfa1322(0x245)](_0xfa1322(0x203),_0x3e4f1c[0x0][_0xfa1322(0x159)]);const _0x42223d=await email_settings[_0xfa1322(0x228)](),_0x151af8=await customer[_0xfa1322(0x228)]({'name':_0x355c06[_0xfa1322(0x161)][_0xfa1322(0x235)]});console['log'](_0xfa1322(0x216),_0x151af8);_0x3e4f1c[0x0][_0xfa1322(0x1ca)]==0x1?(right_currency=_0x3e4f1c[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x3e4f1c[0x0][_0xfa1322(0x1af)]);var _0xe364c=_0x5e3474,_0xf3e5ae=_0xd25ed6,_0x2e6d70='',_0x729198;for(_0x729198 in _0xe364c){_0x2e6d70+='<tr>'+_0xfa1322(0x1f2)+_0xe364c[_0x729198]+_0xfa1322(0x217)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf3e5ae[_0x729198]+'</td>'+'</tr>';}console[_0xfa1322(0x245)](_0xfa1322(0x186),_0x2e6d70);let _0x4e84a7=nodemailer[_0xfa1322(0x22f)]({'service':_0xfa1322(0x15a),'auth':{'user':_0x42223d[_0xfa1322(0x232)],'pass':_0x42223d['password']}}),_0x1c60fb={'from':_0x42223d[_0xfa1322(0x232)],'to':_0x151af8[_0xfa1322(0x232)],'subject':_0xfa1322(0x168),'attachments':[{'filename':_0xfa1322(0x1d2),'path':__dirname+_0xfa1322(0x141)+_0xfa1322(0x1d3)+_0x3e4f1c[0x0][_0xfa1322(0x159)],'cid':_0xfa1322(0x17a)}],'html':_0xfa1322(0x1ff)+_0xfa1322(0x1f0)+_0xfa1322(0x14f)+_0xfa1322(0x13f)+_0xfa1322(0x1da)+_0xfa1322(0x13f)+_0xfa1322(0x21a)+_0xfa1322(0x242)+_0xfa1322(0x13f)+_0xfa1322(0x188)+_0x3e4f1c[0x0][_0xfa1322(0x1cb)]+_0xfa1322(0x207)+_0xfa1322(0x242)+_0xfa1322(0x242)+_0xfa1322(0x1d9)+_0xfa1322(0x13f)+_0xfa1322(0x1a5)+'\x20Order\x20Number\x20:\x20'+_0x109beb+'\x20'+_0xfa1322(0x225)+'\x20Order\x20Date\x20:\x20'+_0x5b10d7+'\x20'+_0xfa1322(0x1b9)+'</h5>'+_0xfa1322(0x242)+_0xfa1322(0x158)+_0xfa1322(0x236)+_0xfa1322(0x190)+_0xfa1322(0x19d)+_0xfa1322(0x13c)+_0xfa1322(0x1b0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0xfa1322(0x1e4)+_0xfa1322(0x1a1)+'\x20'+_0x2e6d70+'\x20'+'</tbody>'+_0xfa1322(0x16f)+_0xfa1322(0x13f)+_0xfa1322(0x173)+_0xfa1322(0x246)+_0x3e4f1c[0x0][_0xfa1322(0x1cb)]+_0xfa1322(0x21c)+'</div>'+_0xfa1322(0x242)+_0xfa1322(0x1d4)};_0x4e84a7[_0xfa1322(0x204)](_0x1c60fb,function(_0x6ffc78,_0x19b351){var _0x4fd591=_0xfa1322;_0x6ffc78?(console[_0x4fd591(0x245)](_0x6ffc78),console[_0x4fd591(0x245)]('Error\x20Occurs')):console[_0x4fd591(0x245)](_0x4fd591(0x1f7));}),_0x355c06[_0xfa1322(0x15b)]('success',_0xfa1322(0x1a7)),_0x370686[_0xfa1322(0x13b)]('/all_sales/view');}catch(_0x30ffac){console[_0xfa1322(0x245)](_0x30ffac),_0x370686[_0xfa1322(0x1bb)](0xc8)[_0xfa1322(0x247)]({'message1':_0x30ffac[_0xfa1322(0x1c5)]});}}),router['get'](a0_0x49ae98(0x19f),auth,async(_0x51fc4b,_0x1d4507)=>{var _0x3be0dc=a0_0x49ae98;try{const {username:_0x4b77bb,email:_0x3cb208,role:_0x55bb11}=_0x51fc4b['user'],_0x55cb35=_0x51fc4b[_0x3be0dc(0x1d8)],_0xdebb68=await profile['findOne']({'email':_0x55cb35[_0x3be0dc(0x232)]}),_0x32ae22=await master_shop[_0x3be0dc(0x238)]();console[_0x3be0dc(0x245)](_0x3be0dc(0x1a6),_0x32ae22);const _0x2f8d49=_0x51fc4b['params']['id'],_0x5528b3=await sales[_0x3be0dc(0x1ab)](_0x2f8d49);console[_0x3be0dc(0x245)]('barcode\x20user_id',_0x5528b3);if(_0x32ae22[0x0][_0x3be0dc(0x1ed)]==_0x3be0dc(0x154))var _0x9070c0=users['English'];else{if(_0x32ae22[0x0][_0x3be0dc(0x1ed)]==_0x3be0dc(0x20e))var _0x9070c0=users[_0x3be0dc(0x20e)];else{if(_0x32ae22[0x0][_0x3be0dc(0x1ed)]==_0x3be0dc(0x1e6))var _0x9070c0=users[_0x3be0dc(0x1e6)];else{if(_0x32ae22[0x0][_0x3be0dc(0x1ed)]==_0x3be0dc(0x1c6))var _0x9070c0=users[_0x3be0dc(0x1c6)];else{if(_0x32ae22[0x0][_0x3be0dc(0x1ed)]=='French')var _0x9070c0=users['French'];else{if(_0x32ae22[0x0][_0x3be0dc(0x1ed)]=='Portuguese\x20(BR)')var _0x9070c0=users[_0x3be0dc(0x1b3)];else{if(_0x32ae22[0x0][_0x3be0dc(0x1ed)]==_0x3be0dc(0x1bc))var _0x9070c0=users[_0x3be0dc(0x1bc)];else{if(_0x32ae22[0x0][_0x3be0dc(0x1ed)]==_0x3be0dc(0x22a))var _0x9070c0=users[_0x3be0dc(0x14b)];}}}}}}}_0x1d4507[_0x3be0dc(0x1c7)](_0x3be0dc(0x172),{'success':_0x51fc4b['flash'](_0x3be0dc(0x183)),'errors':_0x51fc4b[_0x3be0dc(0x15b)](_0x3be0dc(0x1f5)),'role':_0x55cb35,'profile':_0xdebb68,'alldata':_0x5528b3,'master_shop':_0x32ae22,'language':_0x9070c0});}catch(_0x2abef7){console[_0x3be0dc(0x245)](_0x2abef7);}}),router['post']('/barcode_scanner',async(_0x55608b,_0xbc9daf)=>{var _0x4eee67=a0_0x49ae98;const {product_code:_0x27aa0d,warehouse_name:_0x25367b,rooms_data:_0x2d5208,Roomslist:_0x18d696}=_0x55608b['body'],_0x2218b9=_0x18d696['split'](','),_0x101b57=[];async function _0x3c2d33(_0x4bec5f){var _0x5b9223=a0_0x40b8;const _0xb73496=await warehouse[_0x5b9223(0x160)]([{'$match':{'name':_0x25367b,'room':_0x4bec5f}},{'$unwind':_0x5b9223(0x1f9)},{'$match':{'product_details.primary_code':_0x27aa0d}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5b9223(0x16a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5b9223(0x14a)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x5b9223(0x243)},'type':{'$first':_0x5b9223(0x16d)},'pallet':{'$first':_0x5b9223(0x1e1)},'unit':{'$first':_0x5b9223(0x1ac)},'secondary_unit':{'$first':_0x5b9223(0x1b6)},'storage':{'$first':_0x5b9223(0x1f8)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5b9223(0x1ad)},'production_date':{'$first':_0x5b9223(0x162)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x5b9223(0x1b1)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x5b9223(0x15c)},'invoice':{'$first':_0x5b9223(0x23f)},'actual_qty':{'$first':_0x5b9223(0x20d)},'actual_uom':{'$first':_0x5b9223(0x1fa)}}}]),_0x2fd841=await warehouse[_0x5b9223(0x160)]([{'$match':{'name':_0x25367b,'room':_0x4bec5f}},{'$unwind':_0x5b9223(0x1f9)},{'$match':{'product_details.secondary_code':_0x27aa0d}},{'$group':{'_id':_0x5b9223(0x1eb),'name':{'$first':_0x5b9223(0x1cd)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x5b9223(0x21f)},'secondary_code':{'$first':_0x5b9223(0x1e5)},'product_code':{'$first':_0x5b9223(0x14a)},'level':{'$first':_0x5b9223(0x1db)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x5b9223(0x16d)},'pallet':{'$first':_0x5b9223(0x1e1)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x5b9223(0x1b6)},'storage':{'$first':_0x5b9223(0x1f8)},'rack':{'$first':_0x5b9223(0x231)},'expiry_date':{'$first':_0x5b9223(0x1ad)},'production_date':{'$first':_0x5b9223(0x162)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x5b9223(0x23c)},'product_cat':{'$first':_0x5b9223(0x1b1)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x5b9223(0x15c)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0xb73496[_0x5b9223(0x191)]>0x0)_0x101b57['push'](_0xb73496);else _0x2fd841['length']>0x0&&_0x101b57['push'](_0x2fd841);}const _0x371b76=_0x2218b9[_0x4eee67(0x175)](_0x404004=>_0x3c2d33(_0x404004));await Promise[_0x4eee67(0x1c0)](_0x371b76),_0xbc9daf[_0x4eee67(0x247)](_0x101b57);}),module[a0_0x49ae98(0x167)]=router;function a0_0x100b(){var _0x36b2db=['render','bin','$sale_product.quantity','currency_placement','site_title','product_details','$product_details.product_name','stocks','Level','English','$isAllowEdit','Logo.png','/upload/','</body></html>','Error\x20Occurs','quantity_notConverted','edit_sales_view','user','<hr\x20class=\x22my-3\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.bay','primary_unit','getDate','/view/add_sale/product','save','/view/return_sales/:id','$product_details.floorlevel','isAllowEdit','$note','</thead>','$product_details.secondary_code','German','Receiving\x20Area','There\x27s\x20a\x20error\x20in\x20this\x20transaction','unit','product_stock','$product_details._id','warehouse_name','language','storage','product_code','<html><head><title></title>','854116faXpam','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$customer','$invoice','errors','all_sales','Email\x20sent\x20successfully','$product_details.storage','$product_details','$product_details.actual_uom','$product_details.pallet','batch_code','post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<!DOCTYPE\x20html>','/view','types','$product_details.level','add\x20post','sendMail','Sales\x20Mail','Return\x20Rooms','\x20</h2>','finalize','268674uvweNR','</tr>','return_sale','primary_code','$product_details.actual_qty','Hindi','prod_invoice','edit_sales','password','type','Portuguese\x20(BR)','maxperunit','host','customer_data','</td>','French','back','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','customers_docs','</h5>','actual_qty','quantity','$product_details.primary_code','room_name','$_id','invoice','customers','414JzOSCv','<span\x20style=\x22float:\x20right;\x22>','max','getMonth','findOne','stock_data','Arabic\x20(ae)','abs','date','error','/all_sales/preview/','createTransport','room','$product_details.rack','email','rack','$sale_product.bay','customer','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','sales_quantity','find','name','$product','Ambient','$product_details.batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product_name','$product_details.invoice','$sale_product.floorlevel','RMSEmail','</div>','$product_details.bin','OUT-','log','<h5>','json','floorlevel','RoomAssigned','final','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','\x20Order\x20Date\x20:\x20','<div>','amount','/../public','An\x20error\x20occurred\x20while\x20saving\x20data.','Floor','max_per_unit','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$sale_product.type','express','Sales\x20Update\x20successfully','$product_details.product_code','Arabic','Sales\x20Add\x20successfully','sale_product','toString','</head><body>','3933830STBHwb','bay','getFullYear','$finalize','English\x20(US)','user_id','$product.product_name','$date','<table\x20style=\x22width:\x20100%\x20!important;\x22>','image','gmail','flash','$room','../models/all_models','production_date','level','aggregate','body','$product_details.production_date','1953890dVQLko','8mYFDAc','foreach\x20newproduct','$name','exports','Sale\x20Return\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.product_stock','Raw\x20Materials','/all_sales/view','$product_details.type','11624SPOmaA','</table>','$sale_product','product_data','all_sales_barcode','<strong>\x20Regards\x20</strong>','carton','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','nodemailer','An\x20error\x20occurred.','prod_cat','logo','string','warehouse','SCRN','Enabled','Received\x20Payment\x20For\x20Sale','Return\x20Goods','968718dyRuCY','received_amount','success','floor','due_amount','product_list','get','<h2>\x20','3116707BMKFtW','actual_uom','$customers_docs','delivery_date','secondary_unit','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','catch','<tr>','length','filter','then','\x20Order\x20Number\x20:\x20','add_sales','$return_data','purchases_data','params','role','12rGhSwS','secondary_code','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','False','/barcode/:id','2mmNAye','<tbody\x20style=\x22text-align:\x20center;\x22>','../middleware/auth','sale_qty','77PDrEfG','<h5\x20style=\x22text-align:\x20left;\x22>','barcode\x20Product\x20master','sales\x20item\x20return\x20successfull','$sale_product.bin','return_qty','slice','findById','$product_details.unit','$product_details.expiry_date','prod_code','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$product_details.product_cat','$warehouse_name','Portuguese','forEach','/view/:id','$product_details.secondary_unit','Shelves','delivery_code','</span>','/view/add_sales','status','Chinese','../public/language/languages.json','concat','master','all','stock','padStart','requested_qty','expiry_date','message','Spanish'];a0_0x100b=function(){return _0x36b2db;};return a0_0x100b();}