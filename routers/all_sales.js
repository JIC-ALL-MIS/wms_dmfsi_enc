var a0_0xfbb5dd=a0_0x55c9;function a0_0x55c9(_0x1ea4dc,_0xc02d99){var _0x2039ef=a0_0x2039();return a0_0x55c9=function(_0x55c9d8,_0x391b76){_0x55c9d8=_0x55c9d8-0x1e5;var _0x9e1ac=_0x2039ef[_0x55c9d8];return _0x9e1ac;},a0_0x55c9(_0x1ea4dc,_0xc02d99);}(function(_0x2bfe88,_0x10bc64){var _0x22f279=a0_0x55c9,_0x154b8c=_0x2bfe88();while(!![]){try{var _0x5b1072=parseInt(_0x22f279(0x2e2))/0x1*(-parseInt(_0x22f279(0x2af))/0x2)+parseInt(_0x22f279(0x2de))/0x3*(parseInt(_0x22f279(0x2b0))/0x4)+-parseInt(_0x22f279(0x26e))/0x5*(parseInt(_0x22f279(0x2db))/0x6)+-parseInt(_0x22f279(0x2d3))/0x7+-parseInt(_0x22f279(0x223))/0x8*(parseInt(_0x22f279(0x2dc))/0x9)+parseInt(_0x22f279(0x286))/0xa*(-parseInt(_0x22f279(0x2d7))/0xb)+parseInt(_0x22f279(0x21a))/0xc;if(_0x5b1072===_0x10bc64)break;else _0x154b8c['push'](_0x154b8c['shift']());}catch(_0x2fcf0c){_0x154b8c['push'](_0x154b8c['shift']());}}}(a0_0x2039,0x36269));const express=require(a0_0xfbb5dd(0x274)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0xfbb5dd(0x232)),auth=require(a0_0xfbb5dd(0x21b)),nodemailer=require(a0_0xfbb5dd(0x206)),users=require('../public/language/languages.json');router['get'](a0_0xfbb5dd(0x2be),auth,async(_0x8fb2d,_0x80b582)=>{var _0x26d0b2=a0_0xfbb5dd;try{const {username:_0x4a2e65,email:_0x4d1cf4,role:_0x936bae}=_0x8fb2d[_0x26d0b2(0x2e6)],_0x5b3940=_0x8fb2d['user'],_0x1f5a1a=await profile['findOne']({'email':_0x5b3940['email']}),_0x5b4c0e=await master_shop[_0x26d0b2(0x1e5)]();let _0xe410a9;if(_0x5b3940[_0x26d0b2(0x228)]==_0x26d0b2(0x22f)){const _0x1e5408=await staff[_0x26d0b2(0x241)]({'email':_0x5b3940[_0x26d0b2(0x252)]});_0xe410a9=await sales['aggregate']([{'$lookup':{'from':_0x26d0b2(0x2a3),'localField':_0x26d0b2(0x25a),'foreignField':_0x26d0b2(0x29b),'as':_0x26d0b2(0x276)}},{'$unwind':_0x26d0b2(0x249)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x26d0b2(0x2b1),'invoice':{'$first':_0x26d0b2(0x1f5)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x26d0b2(0x257)},'sale_product':{'$push':_0x26d0b2(0x213)},'note':{'$first':'$note'},'return_data':{'$first':_0x26d0b2(0x218)},'customers_docs':{'$first':_0x26d0b2(0x249)},'total_saleproduct_quantity':{'$sum':_0x26d0b2(0x279)},'level':{'$addToSet':_0x26d0b2(0x25c)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x26d0b2(0x26f)},'pallet':{'$addToSet':_0x26d0b2(0x2e1)},'finalize':{'$first':_0x26d0b2(0x1f2)},'isAllowEdit':{'$first':_0x26d0b2(0x1fa)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0xe410a9=await sales[_0x26d0b2(0x222)]([{'$lookup':{'from':_0x26d0b2(0x2a3),'localField':_0x26d0b2(0x25a),'foreignField':_0x26d0b2(0x29b),'as':_0x26d0b2(0x276)}},{'$unwind':_0x26d0b2(0x249)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x26d0b2(0x2b1),'invoice':{'$first':_0x26d0b2(0x1f5)},'customers':{'$first':_0x26d0b2(0x2d1)},'date':{'$first':_0x26d0b2(0x205)},'warehouse_name':{'$first':_0x26d0b2(0x257)},'sale_product':{'$push':_0x26d0b2(0x213)},'note':{'$first':_0x26d0b2(0x2e3)},'return_data':{'$first':_0x26d0b2(0x218)},'customers_docs':{'$first':_0x26d0b2(0x249)},'total_saleproduct_quantity':{'$sum':_0x26d0b2(0x279)},'level':{'$addToSet':_0x26d0b2(0x25c)},'isle':{'$addToSet':_0x26d0b2(0x2e5)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x26d0b2(0x1f2)},'isAllowEdit':{'$first':_0x26d0b2(0x1fa)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x26d0b2(0x27c)](_0x26d0b2(0x24b),_0xe410a9);if(_0x5b4c0e[0x0][_0x26d0b2(0x1f8)]=='English\x20(US)'){var _0x57a9c1=users[_0x26d0b2(0x216)];console[_0x26d0b2(0x27c)](_0x57a9c1);}else{if(_0x5b4c0e[0x0]['language']==_0x26d0b2(0x2b9))var _0x57a9c1=users[_0x26d0b2(0x2b9)];else{if(_0x5b4c0e[0x0][_0x26d0b2(0x1f8)]==_0x26d0b2(0x2bf))var _0x57a9c1=users[_0x26d0b2(0x2bf)];else{if(_0x5b4c0e[0x0]['language']==_0x26d0b2(0x217))var _0x57a9c1=users[_0x26d0b2(0x217)];else{if(_0x5b4c0e[0x0][_0x26d0b2(0x1f8)]=='French')var _0x57a9c1=users[_0x26d0b2(0x21d)];else{if(_0x5b4c0e[0x0][_0x26d0b2(0x1f8)]==_0x26d0b2(0x239))var _0x57a9c1=users[_0x26d0b2(0x22b)];else{if(_0x5b4c0e[0x0][_0x26d0b2(0x1f8)]==_0x26d0b2(0x262))var _0x57a9c1=users['Chinese'];else{if(_0x5b4c0e[0x0][_0x26d0b2(0x1f8)]==_0x26d0b2(0x221))var _0x57a9c1=users['Arabic'];}}}}}}}_0x80b582['render']('all_sales',{'success':_0x8fb2d['flash'](_0x26d0b2(0x293)),'errors':_0x8fb2d['flash'](_0x26d0b2(0x250)),'sales':_0xe410a9,'profile':_0x1f5a1a,'role':_0x5b3940,'master_shop':_0x5b4c0e,'language':_0x57a9c1});}catch(_0x3fff71){console[_0x26d0b2(0x27c)](_0x3fff71);}});async function getRandom8DigitNumber(){var _0x15253c=a0_0xfbb5dd;const _0x5a4d86=0x989680,_0x10240d=0x5f5e0ff,_0x33d65d=Math['floor'](Math[_0x15253c(0x298)]()*(_0x10240d-_0x5a4d86+0x1))+_0x5a4d86;var _0x2b41fb;const _0x4e4c04=await sales['findOne']({'invoice':_0x15253c(0x203)+_0x33d65d});return _0x4e4c04&&_0x4e4c04[_0x15253c(0x282)]>0x0?_0x2b41fb=_0x15253c(0x203)+_0x33d65d:_0x2b41fb=_0x15253c(0x203)+_0x33d65d,_0x2b41fb;}router['get'](a0_0xfbb5dd(0x20e),auth,async(_0x2469b5,_0x292933)=>{var _0x58b729=a0_0xfbb5dd;try{const {username:_0x4720d0,email:_0x3500c7,role:_0x13519b}=_0x2469b5[_0x58b729(0x2e6)],_0x547651=_0x2469b5[_0x58b729(0x2e6)],_0x90a9d2=await profile[_0x58b729(0x241)]({'email':_0x547651['email']}),_0x363de5=await master_shop[_0x58b729(0x1e5)](),_0x3aa1a4=await customer[_0x58b729(0x1e5)]({});let _0x2c0f20;if(_0x547651[_0x58b729(0x228)]==_0x58b729(0x22f)){const _0x56205d=await staff[_0x58b729(0x241)]({'email':_0x547651['email']});_0x2c0f20=await warehouse[_0x58b729(0x222)]([{'$match':{'status':_0x58b729(0x2c7),'name':_0x56205d[_0x58b729(0x280)],'warehouse_category':_0x58b729(0x256),'name':{'$ne':_0x58b729(0x227)}}},{'$group':{'_id':'$name','name':{'$first':_0x58b729(0x21e)}}},{'$sort':{'name':0x1}}]);}else _0x2c0f20=await warehouse[_0x58b729(0x222)]([{'$match':{'status':_0x58b729(0x2c7),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x58b729(0x227)}}},{'$group':{'_id':_0x58b729(0x21e),'name':{'$first':_0x58b729(0x21e)}}},{'$sort':{'name':0x1}}]);const _0x57b60f=await product['find']({});var _0x4a07dd=[_0x58b729(0x2ae),'Enclosed'];const _0x45cfb5=await sales['find']({}),_0x543bfe=_0x45cfb5['length']+0x1,_0x2d6d0a='OUT-'+_0x543bfe[_0x58b729(0x246)]()[_0x58b729(0x288)](0x5,'0');if(_0x363de5[0x0][_0x58b729(0x1f8)]==_0x58b729(0x2df)){var _0x561ef=users[_0x58b729(0x216)];console[_0x58b729(0x27c)](_0x561ef);}else{if(_0x363de5[0x0][_0x58b729(0x1f8)]==_0x58b729(0x2b9))var _0x561ef=users[_0x58b729(0x2b9)];else{if(_0x363de5[0x0]['language']==_0x58b729(0x2bf))var _0x561ef=users[_0x58b729(0x2bf)];else{if(_0x363de5[0x0][_0x58b729(0x1f8)]==_0x58b729(0x217))var _0x561ef=users[_0x58b729(0x217)];else{if(_0x363de5[0x0][_0x58b729(0x1f8)]=='French')var _0x561ef=users['French'];else{if(_0x363de5[0x0][_0x58b729(0x1f8)]==_0x58b729(0x239))var _0x561ef=users[_0x58b729(0x22b)];else{if(_0x363de5[0x0]['language']==_0x58b729(0x262))var _0x561ef=users['Chinese'];else{if(_0x363de5[0x0]['language']=='Arabic\x20(ae)')var _0x561ef=users[_0x58b729(0x28c)];}}}}}}}const _0x3321da=getRandom8DigitNumber();_0x3321da[_0x58b729(0x2bc)](_0x2c80f7=>{var _0xdbc117=_0x58b729;_0x292933[_0xdbc117(0x1f7)]('add_sales',{'success':_0x2469b5[_0xdbc117(0x1ed)](_0xdbc117(0x293)),'errors':_0x2469b5[_0xdbc117(0x1ed)](_0xdbc117(0x250)),'role':_0x547651,'profile':_0x90a9d2,'customer':_0x3aa1a4,'warehouse':_0x2c0f20,'product':_0x57b60f,'invoice':_0x2c80f7,'master_shop':_0x363de5,'language':_0x561ef,'rooms_data':_0x4a07dd});})[_0x58b729(0x273)](_0x30dfc6=>{var _0x2f16e9=_0x58b729;_0x2469b5['flash']('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x292933[_0x2f16e9(0x20b)](_0x2f16e9(0x2d9));});}catch(_0x5c2af0){console['log'](_0x5c2af0);}}),router[a0_0xfbb5dd(0x243)](a0_0xfbb5dd(0x2b3),auth,async(_0xb79b0c,_0x3ad4ee)=>{var _0x27c94c=a0_0xfbb5dd;try{const _0x506aeb=_0xb79b0c[_0x27c94c(0x2da)]['id'];console[_0x27c94c(0x27c)](_0x506aeb);const _0x3bedc6=await product['find'](),_0xa3e495=await purchases['aggregate']([{'$match':{'warehouse_name':_0x506aeb}},{'$unwind':'$product'},{'$group':{'_id':_0x27c94c(0x2b7)}}]);console[_0x27c94c(0x27c)](_0x27c94c(0x234),_0xa3e495),_0x3ad4ee['status'](0xc8)[_0x27c94c(0x2b5)]({'purchases_data':_0xa3e495,'product_data':_0x3bedc6});}catch(_0x5841a6){console[_0x27c94c(0x27c)](_0x5841a6);}}),router[a0_0xfbb5dd(0x242)](a0_0xfbb5dd(0x2b6),auth,async(_0x49b29f,_0x1104b1)=>{var _0x4541cd=a0_0xfbb5dd;try{const {warehouse_data:_0x9ed615,product_data:_0x382ab8}=_0x49b29f[_0x4541cd(0x2bd)];console['log'](_0x49b29f[_0x4541cd(0x2bd)][_0x4541cd(0x27b)]);;const _0x4f5c40=await master_shop[_0x4541cd(0x1e5)]();console[_0x4541cd(0x27c)](_0x4541cd(0x272),_0x4f5c40);const _0x18ca24=await product['findOne']({'name':_0x382ab8});console['log'](_0x4541cd(0x21f),_0x18ca24);const _0x28901b=await warehouse[_0x4541cd(0x222)]([{'$match':{'name':_0x9ed615}},{'$unwind':_0x4541cd(0x204)},{'$match':{'product_details.product_name':_0x382ab8}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x4541cd(0x1eb)}}}]);console[_0x4541cd(0x27c)](_0x4541cd(0x253),_0x28901b),_0x1104b1[_0x4541cd(0x23d)](0xc8)[_0x4541cd(0x2b5)]({'master':_0x4f5c40,'new_product':_0x18ca24,'stock_data':_0x28901b});}catch(_0x4f4567){console['log'](_0x4f4567);}}),router[a0_0xfbb5dd(0x242)](a0_0xfbb5dd(0x20e),auth,async(_0x5e6aa9,_0x3fe9c1)=>{var _0x1ec642=a0_0xfbb5dd;try{const {invoice:_0x8c1188,date:_0xaf04e3,warehouse_name:_0x4210ad,product_name:_0x16da7d,stock:_0x51fd7a,quantity:_0x607cc2,note:_0x5e56a4,room:_0x15dfcb,primary_code:_0x1f6230,secondary_code:_0x32772a,prod_code:_0x4d5367,level:_0x2331de,isle:_0x212c76,pallet:_0x5d663f,batch_code:_0x3879fb,SCRN:_0x84dde2,expiry_date:_0x4ba727}=_0x5e6aa9['body'];if(typeof _0x16da7d==_0x1ec642(0x2d5))var _0x10636c=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x1f0)]],_0x252b44=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x2cb)]],_0x431983=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x25e)]],_0x1b7168=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x269)]],_0x275ab6=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x2d4)]],_0x1e3bcf=[_0x5e6aa9[_0x1ec642(0x2bd)]['prod_code']],_0x236109=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x266)]],_0x21f0d8=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x212)]],_0x3ae0b4=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x29e)]],_0x3b0d08=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x208)]],_0x3bc1fd=[_0x5e6aa9['body']['expiry_date']],_0x2bd0b8=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x2a2)]],_0x42bd3a=[_0x5e6aa9[_0x1ec642(0x2bd)]['production_date']],_0x352cb1=[_0x5e6aa9['body'][_0x1ec642(0x1ee)]],_0x5db777=[_0x5e6aa9['body']['delivery_date']],_0x5b41bd=[_0x5e6aa9['body']['delivery_code']],_0x190da3=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x202)]],_0x1569fc=[_0x5e6aa9[_0x1ec642(0x2bd)]['quantity']],_0x14e324=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x200)]],_0x184b89=[_0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x1fc)]];else var _0x10636c=[..._0x5e6aa9['body'][_0x1ec642(0x1f0)]],_0x252b44=[..._0x5e6aa9['body'][_0x1ec642(0x2cb)]],_0x431983=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x25e)]],_0x1b7168=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x269)]],_0x275ab6=[..._0x5e6aa9['body'][_0x1ec642(0x2d4)]],_0x1e3bcf=[..._0x5e6aa9['body'][_0x1ec642(0x264)]],_0x236109=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x266)]],_0x21f0d8=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x212)]],_0x3ae0b4=[..._0x5e6aa9['body'][_0x1ec642(0x29e)]],_0x3b0d08=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x208)]],_0x3bc1fd=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x294)]],_0x2bd0b8=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x2a2)]],_0x42bd3a=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x2ce)]],_0x352cb1=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x1ee)]],_0x5db777=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x271)]],_0x5b41bd=[..._0x5e6aa9['body'][_0x1ec642(0x2c8)]],_0x190da3=[..._0x5e6aa9[_0x1ec642(0x2bd)][_0x1ec642(0x202)]],_0x1569fc=[..._0x5e6aa9['body'][_0x1ec642(0x2c5)]],_0x14e324=[..._0x5e6aa9['body']['RoomAssigned']],_0x184b89=[..._0x5e6aa9[_0x1ec642(0x2bd)]['prod_invoice']];const _0x44b1fd=_0x10636c['map'](_0x4269a8=>{return _0x4269a8={'product_name':_0x4269a8};});_0x252b44[_0x1ec642(0x284)]((_0x3df7a7,_0x54154f)=>{var _0x3379d8=_0x1ec642;_0x44b1fd[_0x54154f][_0x3379d8(0x2cb)]=_0x3df7a7;}),_0x431983[_0x1ec642(0x284)]((_0x27fb7a,_0x2f4e22)=>{var _0xd6ea07=_0x1ec642;_0x44b1fd[_0x2f4e22][_0xd6ea07(0x2c5)]=_0x27fb7a;}),_0x1b7168[_0x1ec642(0x284)]((_0x35e77d,_0x18927c)=>{var _0x31111e=_0x1ec642;_0x44b1fd[_0x18927c][_0x31111e(0x269)]=_0x35e77d;}),_0x275ab6['forEach']((_0xa2dc63,_0x38bca7)=>{var _0x2fde04=_0x1ec642;_0x44b1fd[_0x38bca7][_0x2fde04(0x2d4)]=_0xa2dc63;}),_0x1e3bcf[_0x1ec642(0x284)]((_0x5217aa,_0x3b3ce7)=>{var _0x1047bd=_0x1ec642;_0x44b1fd[_0x3b3ce7][_0x1047bd(0x1e7)]=_0x5217aa;}),_0x236109[_0x1ec642(0x284)]((_0x4c2767,_0x38f348)=>{var _0x53997b=_0x1ec642;_0x14e324[_0x53997b(0x284)]((_0x856034,_0x3d67f1)=>{var _0x596b75=_0x53997b;if(_0x856034==_0x596b75(0x24a)&&_0x38f348==_0x3d67f1){var _0x56ae3f=_0x4c2767[_0x596b75(0x1f9)](0x3);_0x44b1fd[_0x38f348][_0x596b75(0x240)]=_0x4c2767[0x0],_0x44b1fd[_0x38f348][_0x596b75(0x2c3)]=_0x4c2767[0x1],_0x44b1fd[_0x38f348][_0x596b75(0x226)]=0x0,_0x44b1fd[_0x38f348][_0x596b75(0x20f)]=0x0,_0x44b1fd[_0x38f348][_0x596b75(0x270)]=_0x596b75(0x20d),_0x44b1fd[_0x38f348][_0x596b75(0x2b4)]=_0x56ae3f;}else{if(_0x856034=='Shelves'&&_0x38f348==_0x3d67f1){var _0x56ae3f=_0x4c2767[_0x596b75(0x1f9)](0x3);_0x44b1fd[_0x38f348][_0x596b75(0x240)]=_0x4c2767[0x0],_0x44b1fd[_0x38f348][_0x596b75(0x2c3)]=_0x4c2767[0x1],_0x44b1fd[_0x38f348]['bay']=0x0,_0x44b1fd[_0x38f348][_0x596b75(0x20f)]=0x0,_0x44b1fd[_0x38f348][_0x596b75(0x270)]='Floor',_0x44b1fd[_0x38f348][_0x596b75(0x2b4)]=_0x4c2767[0x5];}else{if(_0x38f348==_0x3d67f1){var _0x5be06f;if(_0x4c2767[0x4]=='L')_0x5be06f=_0x596b75(0x1fd);else _0x4c2767[0x4]=='F'&&(_0x5be06f=_0x596b75(0x20d));_0x44b1fd[_0x38f348][_0x596b75(0x240)]=_0x4c2767[0x0],_0x44b1fd[_0x38f348][_0x596b75(0x2c3)]=_0x4c2767[0x1],_0x44b1fd[_0x38f348][_0x596b75(0x226)]=_0x4c2767[0x2],_0x44b1fd[_0x38f348][_0x596b75(0x20f)]=_0x4c2767[0x3],_0x44b1fd[_0x38f348][_0x596b75(0x270)]=_0x5be06f,_0x44b1fd[_0x38f348]['floorlevel']=_0x4c2767[0x5];}}}});}),_0x21f0d8[_0x1ec642(0x284)]((_0x53617d,_0x2bab1f)=>{var _0x4a76d3=_0x1ec642;_0x44b1fd[_0x2bab1f][_0x4a76d3(0x277)]=_0x53617d;}),_0x3ae0b4['forEach']((_0x1288dd,_0xe57c33)=>{_0x44b1fd[_0xe57c33]['secondary_unit']=_0x1288dd;}),_0x3b0d08[_0x1ec642(0x284)]((_0x38af9b,_0x15f783)=>{var _0x5972a1=_0x1ec642;_0x44b1fd[_0x15f783][_0x5972a1(0x208)]=_0x38af9b;}),_0x3bc1fd[_0x1ec642(0x284)]((_0x234a66,_0x85ca5d)=>{var _0x4fd963=_0x1ec642;_0x44b1fd[_0x85ca5d][_0x4fd963(0x294)]=_0x234a66;}),_0x2bd0b8['forEach']((_0xc61a48,_0x33f46d)=>{_0x44b1fd[_0x33f46d]['maxperunit']=_0xc61a48;}),_0x42bd3a[_0x1ec642(0x284)]((_0x551a25,_0x48b2c7)=>{var _0x5f34c2=_0x1ec642;_0x44b1fd[_0x48b2c7][_0x5f34c2(0x2ce)]=_0x551a25;}),_0x352cb1['forEach']((_0x5920a9,_0x2715fc)=>{var _0x18a0dd=_0x1ec642;_0x44b1fd[_0x2715fc][_0x18a0dd(0x1ee)]=_0x5920a9;}),_0x5db777[_0x1ec642(0x284)]((_0x576161,_0x3b25c1)=>{_0x44b1fd[_0x3b25c1]['delivery_date']=_0x576161;}),_0x5b41bd[_0x1ec642(0x284)]((_0x36ec95,_0xaa80ee)=>{_0x44b1fd[_0xaa80ee]['delivery_code']=_0x36ec95;}),_0x190da3[_0x1ec642(0x284)]((_0x501b8f,_0x46d6f9)=>{var _0x40046f=_0x1ec642;_0x44b1fd[_0x46d6f9][_0x40046f(0x202)]=_0x501b8f;}),_0x1569fc[_0x1ec642(0x284)]((_0xf9af4f,_0x36dc88)=>{var _0x1fb774=_0x1ec642;_0x44b1fd[_0x36dc88][_0x1fb774(0x23e)]=_0xf9af4f;}),_0x14e324['forEach']((_0x4922c0,_0x1fa6ea)=>{var _0x5c1abe=_0x1ec642;_0x44b1fd[_0x1fa6ea][_0x5c1abe(0x2ea)]=_0x4922c0;}),_0x184b89['forEach']((_0x3eb37b,_0x48ca77)=>{var _0x58ffa4=_0x1ec642;_0x44b1fd[_0x48ca77][_0x58ffa4(0x22a)]=_0x3eb37b;});var _0x328a6c=0x0;_0x44b1fd['forEach'](_0x324eff=>{var _0x3e940f=_0x1ec642;(_0x324eff[_0x3e940f(0x2cb)]<_0x324eff[_0x3e940f(0x23e)]||_0x324eff[_0x3e940f(0x23e)]==0x0)&&(console['log'](_0x3e940f(0x2a1),_0x324eff),_0x328a6c++);});const _0x3fb727=_0x44b1fd['filter'](_0x5887df=>_0x5887df[_0x1ec642(0x2c5)]!=='0'&&_0x5887df[_0x1ec642(0x2c5)]!==''),_0x101fad=new sales({'invoice':_0x8c1188,'customer':_0x5e6aa9['body'][_0x1ec642(0x25a)],'date':_0xaf04e3,'warehouse_name':_0x4210ad,'sale_product':_0x3fb727,'note':_0x5e56a4,'room':_0x15dfcb,'primary_code':_0x1f6230,'secondary_code':_0x32772a,'prod_code':_0x4d5367,'SCRN':_0x84dde2}),_0x178937=await _0x101fad[_0x1ec642(0x1fb)]();_0x5e6aa9[_0x1ec642(0x1ed)]('success',_0x1ec642(0x24e)),_0x3fe9c1[_0x1ec642(0x20b)]('/all_sales/preview/'+_0x178937['_id']);}catch(_0x4d60ea){console[_0x1ec642(0x27c)](_0x4d60ea);}}),router[a0_0xfbb5dd(0x243)]('/preview/:id',auth,async(_0x43c27b,_0x3b456d)=>{var _0x1e3fe1=a0_0xfbb5dd;try{const {username:_0x7527cf,email:_0x127ec3,role:_0x468b5c}=_0x43c27b[_0x1e3fe1(0x2e6)],_0x224a92=_0x43c27b[_0x1e3fe1(0x2e6)],_0x309aa6=await profile[_0x1e3fe1(0x241)]({'email':_0x224a92[_0x1e3fe1(0x252)]}),_0x418254=await master_shop['find'](),_0x91883c=_0x43c27b['params']['id'],_0x54ea67=await sales[_0x1e3fe1(0x29d)](_0x91883c),_0x3f3080=await warehouse[_0x1e3fe1(0x222)]([{'$match':{'name':_0x54ea67[_0x1e3fe1(0x289)]}},{'$unwind':_0x1e3fe1(0x204)},{'$group':{'_id':_0x1e3fe1(0x26b),'name':{'$first':_0x1e3fe1(0x2e7)},'product_stock':{'$first':_0x1e3fe1(0x1eb)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1e3fe1(0x2cd)},'type':{'$first':_0x1e3fe1(0x2a8)},'floorlevel':{'$first':_0x1e3fe1(0x2c2)},'primary_code':{'$first':_0x1e3fe1(0x207)},'secondary_code':{'$first':_0x1e3fe1(0x225)},'product_code':{'$first':_0x1e3fe1(0x220)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1e3fe1(0x2d2)},'expiry_date':{'$first':_0x1e3fe1(0x25d)},'production_date':{'$first':_0x1e3fe1(0x1e9)}}}]),_0xdb8bd5=await customer[_0x1e3fe1(0x1e5)]({});let _0x14bed5;if(_0x224a92[_0x1e3fe1(0x228)]==_0x1e3fe1(0x22f)){const _0xeea73b=await staff[_0x1e3fe1(0x241)]({'email':_0x224a92[_0x1e3fe1(0x252)]});_0x14bed5=await warehouse[_0x1e3fe1(0x222)]([{'$match':{'status':'Enabled','name':_0xeea73b[_0x1e3fe1(0x280)]}},{'$group':{'_id':_0x1e3fe1(0x21e),'name':{'$first':_0x1e3fe1(0x21e)}}}]);}else _0x14bed5=await warehouse[_0x1e3fe1(0x222)]([{'$match':{'status':_0x1e3fe1(0x2c7)}},{'$group':{'_id':_0x1e3fe1(0x21e),'name':{'$first':_0x1e3fe1(0x21e)}}}]);const _0x124fd1=await product[_0x1e3fe1(0x1e5)]({}),_0x505188=await suppliers['find']({});if(_0x418254[0x0]['language']==_0x1e3fe1(0x2df)){var _0xf895e8=users[_0x1e3fe1(0x216)];console[_0x1e3fe1(0x27c)](_0xf895e8);}else{if(_0x418254[0x0]['language']==_0x1e3fe1(0x2b9))var _0xf895e8=users['Hindi'];else{if(_0x418254[0x0][_0x1e3fe1(0x1f8)]==_0x1e3fe1(0x2bf))var _0xf895e8=users[_0x1e3fe1(0x2bf)];else{if(_0x418254[0x0][_0x1e3fe1(0x1f8)]==_0x1e3fe1(0x217))var _0xf895e8=users[_0x1e3fe1(0x217)];else{if(_0x418254[0x0][_0x1e3fe1(0x1f8)]==_0x1e3fe1(0x21d))var _0xf895e8=users[_0x1e3fe1(0x21d)];else{if(_0x418254[0x0][_0x1e3fe1(0x1f8)]==_0x1e3fe1(0x239))var _0xf895e8=users[_0x1e3fe1(0x22b)];else{if(_0x418254[0x0][_0x1e3fe1(0x1f8)]==_0x1e3fe1(0x262))var _0xf895e8=users[_0x1e3fe1(0x262)];else{if(_0x418254[0x0][_0x1e3fe1(0x1f8)]==_0x1e3fe1(0x221))var _0xf895e8=users[_0x1e3fe1(0x28c)];}}}}}}}_0x3b456d[_0x1e3fe1(0x1f7)](_0x1e3fe1(0x1f6),{'success':_0x43c27b['flash']('success'),'errors':_0x43c27b[_0x1e3fe1(0x1ed)](_0x1e3fe1(0x250)),'role':_0x224a92,'profile':_0x309aa6,'customer':_0xdb8bd5,'warehouse':_0x14bed5,'product':_0x3f3080,'user':_0x54ea67,'master_shop':_0x418254,'unit':_0x124fd1,'language':_0xf895e8,'suppliers':_0x505188});}catch(_0x109a16){console[_0x1e3fe1(0x27c)](_0x109a16);}}),router['post']('/preview/:id',auth,async(_0x5a1fd4,_0xc87844)=>{var _0x5ea2d7=a0_0xfbb5dd;try{const _0x2648c3=_0x5a1fd4[_0x5ea2d7(0x2da)]['id'],{invoice:_0x4d32ae,warehouse_name:_0x618465,room:_0x87d0d3}=_0x5a1fd4[_0x5ea2d7(0x2bd)],_0x1ae220=await sales[_0x5ea2d7(0x241)]({'invoice':_0x4d32ae}),_0x387b74=_0x1ae220[_0x5ea2d7(0x275)][_0x5ea2d7(0x26c)](async _0x373de7=>{var _0x4557b9=_0x5ea2d7,_0x5aba64=await warehouse[_0x4557b9(0x241)]({'name':_0x618465,'room':_0x373de7[_0x4557b9(0x2ea)],'warehouse_category':'Raw\x20Materials'});const _0x281892=_0x5aba64[_0x4557b9(0x2bb)][_0x4557b9(0x26c)](_0x581e09=>{var _0x1d5efe=_0x4557b9;_0x581e09['product_name']==_0x373de7[_0x1d5efe(0x1f0)]&&_0x581e09[_0x1d5efe(0x2b4)]==_0x373de7[_0x1d5efe(0x2b4)]&&_0x581e09[_0x1d5efe(0x270)]==_0x373de7['type']&&_0x581e09[_0x1d5efe(0x20f)]==_0x373de7[_0x1d5efe(0x20f)]&&_0x581e09[_0x1d5efe(0x226)]==_0x373de7[_0x1d5efe(0x226)]&&_0x581e09[_0x1d5efe(0x2c3)]==_0x373de7[_0x1d5efe(0x2c3)]&&_0x581e09['storage']==_0x373de7[_0x1d5efe(0x240)]&&_0x581e09[_0x1d5efe(0x294)]==_0x373de7[_0x1d5efe(0x294)]&&_0x581e09[_0x1d5efe(0x208)]==_0x373de7['batch_code']&&_0x581e09['invoice']==_0x373de7[_0x1d5efe(0x22a)]&&(_0x581e09['product_stock']=_0x581e09[_0x1d5efe(0x24d)]-_0x373de7['quantity']);});return _0x5aba64;});Promise[_0x5ea2d7(0x2eb)](_0x387b74)['then'](async _0x4c5236=>{var _0x555379=_0x5ea2d7;try{for(const _0x31b7b5 of _0x4c5236){await _0x31b7b5[_0x555379(0x1fb)]();}_0x1ae220[_0x555379(0x214)]=_0x555379(0x27e);const _0x1f9937=await _0x1ae220[_0x555379(0x1fb)](),_0x479b11=await master_shop[_0x555379(0x1e5)](),_0xc819d6=await email_settings[_0x555379(0x241)](),_0x5a9fc8=await supervisor_settings['find']();var _0x4fca05=_0x1ae220[_0x555379(0x275)],_0x14c982='',_0x14c18a;for(_0x14c18a in _0x4fca05){_0x14c982+=_0x555379(0x1ea)+_0x555379(0x231)+_0x4fca05[_0x14c18a]['product_name']+_0x555379(0x255)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4fca05[_0x14c18a][_0x555379(0x1e7)]+_0x555379(0x255)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4fca05[_0x14c18a]['quantity']+_0x555379(0x255)+_0x555379(0x231)+_0x4fca05[_0x14c18a][_0x555379(0x277)]+'</td>'+_0x555379(0x231)+_0x4fca05[_0x14c18a][_0x555379(0x29e)]+'</td>'+_0x555379(0x231)+_0x1ae220['warehouse_name']+'</td>'+_0x555379(0x231)+_0x4fca05[_0x14c18a]['room_name']+_0x555379(0x255)+_0x555379(0x231)+_0x4fca05[_0x14c18a][_0x555379(0x240)]+_0x4fca05[_0x14c18a][_0x555379(0x2c3)]+_0x4fca05[_0x14c18a]['bay']+_0x4fca05[_0x14c18a][_0x555379(0x20f)]+_0x4fca05[_0x14c18a][_0x555379(0x270)][0x0]+_0x4fca05[_0x14c18a][_0x555379(0x2b4)]+_0x555379(0x255),_0x555379(0x24c);}let _0x50cf4b=nodemailer[_0x555379(0x21c)]({'host':_0xc819d6['host'],'port':Number(_0xc819d6['port']),'secure':![],'auth':{'user':_0xc819d6[_0x555379(0x252)],'pass':_0xc819d6['password']}}),_0xd21338={'from':_0xc819d6['email'],'to':_0x5a9fc8[0x0][_0x555379(0x219)],'subject':_0x555379(0x2c4),'attachments':[{'filename':'Logo.png','path':__dirname+_0x555379(0x2dd)+_0x555379(0x22e)+_0x479b11[0x0][_0x555379(0x27d)],'cid':'logo'}],'html':_0x555379(0x290)+_0x555379(0x2b2)+_0x555379(0x215)+'<div>'+_0x555379(0x25f)+_0x555379(0x2a0)+_0x555379(0x244)+'</div>'+'<div>'+_0x555379(0x1f3)+_0x479b11[0x0][_0x555379(0x237)]+'\x20</h2>'+_0x555379(0x235)+'</div>'+_0x555379(0x2e8)+'<div>'+_0x555379(0x20a)+'\x20Order\x20Number\x20:\x20'+_0x1ae220[_0x555379(0x22a)]+'\x20'+_0x555379(0x29a)+_0x555379(0x26a)+_0x1ae220[_0x555379(0x248)]+'\x20'+_0x555379(0x259)+_0x555379(0x258)+_0x555379(0x235)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x555379(0x26d)+_0x555379(0x1ea)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x555379(0x2b8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x555379(0x28e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x555379(0x2a6)+_0x555379(0x236)+_0x555379(0x28d)+_0x555379(0x24c)+_0x555379(0x224)+_0x555379(0x201)+'\x20'+_0x14c982+'\x20'+_0x555379(0x27f)+_0x555379(0x1f1)+_0x555379(0x2a0)+_0x555379(0x2cf)+_0x555379(0x287)+_0x479b11[0x0][_0x555379(0x237)]+_0x555379(0x258)+'</div>'+_0x555379(0x235)+'</body></html>'};_0x50cf4b[_0x555379(0x260)](_0xd21338,function(_0x5bb79b,_0x5419e2){var _0xe45b9c=_0x555379;_0x5bb79b?(console[_0xe45b9c(0x27c)](_0x5bb79b),console[_0xe45b9c(0x27c)](_0xe45b9c(0x27a))):console[_0xe45b9c(0x27c)](_0xe45b9c(0x267));}),_0x5a1fd4['flash'](_0x555379(0x293),_0x555379(0x245)),_0xc87844[_0x555379(0x20b)](_0x555379(0x23c)+_0x2648c3);}catch(_0x58335e){console[_0x555379(0x265)](_0x58335e),_0xc87844['status'](0x1f4)[_0x555379(0x2b5)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x5ea2d7(0x273)](_0x275530=>{var _0x1673d8=_0x5ea2d7;console['error'](_0x275530),_0xc87844[_0x1673d8(0x23d)](0x1f4)['json']({'error':_0x1673d8(0x295)});});}catch(_0x6da897){console[_0x5ea2d7(0x27c)](_0x6da897);}}),router[a0_0xfbb5dd(0x243)](a0_0xfbb5dd(0x2ac),auth,async(_0x342014,_0x2452d3)=>{var _0x49a90e=a0_0xfbb5dd;try{const {username:_0x9e5c8c,email:_0x4a4e3a,role:_0x563e96}=_0x342014[_0x49a90e(0x2e6)],_0x3c38a1=_0x342014['user'],_0x469d9a=await profile[_0x49a90e(0x241)]({'email':_0x3c38a1[_0x49a90e(0x252)]}),_0x2c12a1=await master_shop['find'](),_0x5c0f6c=_0x342014['params']['id'],_0x2306bd=await sales[_0x49a90e(0x29d)](_0x5c0f6c);var _0x1823e4=['Ambient',_0x49a90e(0x1ef)];const _0x4d50fa=await warehouse[_0x49a90e(0x222)]([{'$match':{'name':_0x2306bd[_0x49a90e(0x289)],'warehouse_category':_0x49a90e(0x256)}},{'$unwind':_0x49a90e(0x204)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x49a90e(0x2e7)},'product_stock':{'$first':_0x49a90e(0x1eb)},'bay':{'$first':_0x49a90e(0x229)},'bin':{'$first':_0x49a90e(0x2cd)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x49a90e(0x2c2)},'primary_code':{'$first':_0x49a90e(0x207)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x49a90e(0x220)},'storage':{'$first':_0x49a90e(0x297)},'rack':{'$first':'$product_details.rack'}}}]),_0x3c7036=await customer[_0x49a90e(0x1e5)]({});let _0x4b4570;if(_0x3c38a1['role']==_0x49a90e(0x22f)){const _0x43540a=await staff['findOne']({'email':_0x3c38a1[_0x49a90e(0x252)]});_0x4b4570=await warehouse[_0x49a90e(0x222)]([{'$match':{'status':_0x49a90e(0x2c7),'name':_0x43540a[_0x49a90e(0x280)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x49a90e(0x21e),'name':{'$first':'$name'}}}]);}else _0x4b4570=await warehouse[_0x49a90e(0x222)]([{'$match':{'status':'Enabled','warehouse_category':_0x49a90e(0x256)}},{'$group':{'_id':_0x49a90e(0x21e),'name':{'$first':_0x49a90e(0x21e)}}}]);const _0x217739=await product[_0x49a90e(0x1e5)]({});if(_0x2c12a1[0x0][_0x49a90e(0x1f8)]==_0x49a90e(0x2df)){var _0x118ef2=users['English'];console[_0x49a90e(0x27c)](_0x118ef2);}else{if(_0x2c12a1[0x0][_0x49a90e(0x1f8)]==_0x49a90e(0x2b9))var _0x118ef2=users['Hindi'];else{if(_0x2c12a1[0x0]['language']==_0x49a90e(0x2bf))var _0x118ef2=users[_0x49a90e(0x2bf)];else{if(_0x2c12a1[0x0][_0x49a90e(0x1f8)]==_0x49a90e(0x217))var _0x118ef2=users['Spanish'];else{if(_0x2c12a1[0x0]['language']==_0x49a90e(0x21d))var _0x118ef2=users[_0x49a90e(0x21d)];else{if(_0x2c12a1[0x0][_0x49a90e(0x1f8)]==_0x49a90e(0x239))var _0x118ef2=users[_0x49a90e(0x22b)];else{if(_0x2c12a1[0x0][_0x49a90e(0x1f8)]==_0x49a90e(0x262))var _0x118ef2=users[_0x49a90e(0x262)];else{if(_0x2c12a1[0x0]['language']==_0x49a90e(0x221))var _0x118ef2=users[_0x49a90e(0x28c)];}}}}}}}_0x2452d3[_0x49a90e(0x1f7)](_0x49a90e(0x2e9),{'success':_0x342014[_0x49a90e(0x1ed)]('success'),'errors':_0x342014[_0x49a90e(0x1ed)](_0x49a90e(0x250)),'role':_0x3c38a1,'profile':_0x469d9a,'customer':_0x3c7036,'warehouse':_0x4b4570,'product':_0x4d50fa,'user':_0x2306bd,'master_shop':_0x2c12a1,'unit':_0x217739,'language':_0x118ef2});}catch(_0xf80a75){console[_0x49a90e(0x27c)](_0xf80a75);}}),router[a0_0xfbb5dd(0x242)](a0_0xfbb5dd(0x2ac),auth,async(_0x3ae8ac,_0x47ffcc)=>{var _0x44dac1=a0_0xfbb5dd;try{const _0x46e989=_0x3ae8ac[_0x44dac1(0x2da)]['id'],_0x194bd1=await sales[_0x44dac1(0x241)]({'_id':_0x3ae8ac['params']['id']}),_0x44a9e0=await warehouse[_0x44dac1(0x241)]({'name':_0x194bd1[_0x44dac1(0x289)],'room':_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x261)]}),{invoice:_0x17ac6c,date:_0x5114da,warehouse_name:_0x1ceb64,product_name:_0x37d8a8,stock:_0x53107a,quantity:_0xe94111,note:_0x13393e,room:_0x23c05b,customer:_0x137bd5,SCRN:_0xec4af9}=_0x3ae8ac[_0x44dac1(0x2bd)];if(typeof _0x37d8a8==_0x44dac1(0x2d5))var _0xd81317=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x1f0)]],_0x149d57=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x2cb)]],_0xace853=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x25e)]],_0x22fdf3=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x269)]],_0x37b3ec=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x2d4)]],_0x1de465=[_0x3ae8ac[_0x44dac1(0x2bd)]['prod_code']],_0x351632=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x266)]],_0x68f189=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x212)]],_0x33bb2f=[_0x3ae8ac['body'][_0x44dac1(0x29e)]],_0x30385b=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x208)]],_0x11c54a=[_0x3ae8ac[_0x44dac1(0x2bd)]['expiry_date']],_0x168b1c=[_0x3ae8ac[_0x44dac1(0x2bd)]['max_per_unit']],_0x1fc030=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x2ce)]],_0x4ff8df=[_0x3ae8ac[_0x44dac1(0x2bd)]['requested_qty']],_0x429cd9=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x271)]],_0x360e94=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x2c8)]],_0x5cdee8=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x202)]],_0x1eb282=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x2c5)]],_0x28c9a8=[_0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x200)]];else var _0xd81317=[..._0x3ae8ac[_0x44dac1(0x2bd)]['product_name']],_0x149d57=[..._0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x2cb)]],_0xace853=[..._0x3ae8ac[_0x44dac1(0x2bd)]['carton']],_0x22fdf3=[..._0x3ae8ac['body']['primary_code']],_0x37b3ec=[..._0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x2d4)]],_0x1de465=[..._0x3ae8ac['body']['prod_code']],_0x351632=[..._0x3ae8ac['body'][_0x44dac1(0x266)]],_0x68f189=[..._0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x212)]],_0x33bb2f=[..._0x3ae8ac['body'][_0x44dac1(0x29e)]],_0x30385b=[..._0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x208)]],_0x11c54a=[..._0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x294)]],_0x168b1c=[..._0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x2a2)]],_0x1fc030=[..._0x3ae8ac['body'][_0x44dac1(0x2ce)]],_0x4ff8df=[..._0x3ae8ac['body'][_0x44dac1(0x1ee)]],_0x429cd9=[..._0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x271)]],_0x360e94=[..._0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x2c8)]],_0x5cdee8=[..._0x3ae8ac['body'][_0x44dac1(0x202)]],_0x1eb282=[..._0x3ae8ac[_0x44dac1(0x2bd)]['quantity']],_0x28c9a8=[..._0x3ae8ac[_0x44dac1(0x2bd)][_0x44dac1(0x200)]];const _0x413c6a=_0xd81317[_0x44dac1(0x26c)](_0x337cde=>{return _0x337cde={'product_name':_0x337cde};});_0x149d57['forEach']((_0x1a7498,_0x5393ac)=>{var _0x44dd4c=_0x44dac1;_0x413c6a[_0x5393ac][_0x44dd4c(0x2cb)]=_0x1a7498;}),_0xace853[_0x44dac1(0x284)]((_0x14ea3c,_0x46d13b)=>{var _0x9964a0=_0x44dac1;_0x413c6a[_0x46d13b][_0x9964a0(0x2c5)]=_0x14ea3c;}),_0x22fdf3[_0x44dac1(0x284)]((_0x1aed39,_0x206023)=>{_0x413c6a[_0x206023]['primary_code']=_0x1aed39;}),_0x37b3ec[_0x44dac1(0x284)]((_0x1730e1,_0x2e7613)=>{var _0x4ddbfd=_0x44dac1;_0x413c6a[_0x2e7613][_0x4ddbfd(0x2d4)]=_0x1730e1;}),_0x1de465['forEach']((_0x53df8d,_0x2379fc)=>{var _0x479746=_0x44dac1;_0x413c6a[_0x2379fc][_0x479746(0x1e7)]=_0x53df8d;}),_0x351632['forEach']((_0x8f61f1,_0x2b1736)=>{var _0x45a0da=_0x44dac1;_0x28c9a8[_0x45a0da(0x284)]((_0x898436,_0x3d0648)=>{var _0x42059b=_0x45a0da;if(_0x898436==_0x42059b(0x24a)&&_0x2b1736==_0x3d0648){var _0x290d77=_0x8f61f1['slice'](0x3);_0x413c6a[_0x2b1736]['storage']=_0x8f61f1[0x0],_0x413c6a[_0x2b1736]['rack']=_0x8f61f1[0x1],_0x413c6a[_0x2b1736][_0x42059b(0x226)]=0x0,_0x413c6a[_0x2b1736][_0x42059b(0x20f)]=0x0,_0x413c6a[_0x2b1736][_0x42059b(0x270)]=_0x42059b(0x20d),_0x413c6a[_0x2b1736][_0x42059b(0x2b4)]=_0x290d77;}else{if(_0x898436==_0x42059b(0x291)&&_0x2b1736==_0x3d0648){var _0x290d77=_0x8f61f1['slice'](0x3);_0x413c6a[_0x2b1736][_0x42059b(0x240)]=_0x8f61f1[0x0],_0x413c6a[_0x2b1736][_0x42059b(0x2c3)]=_0x8f61f1[0x1],_0x413c6a[_0x2b1736][_0x42059b(0x226)]=0x0,_0x413c6a[_0x2b1736][_0x42059b(0x20f)]=0x0,_0x413c6a[_0x2b1736][_0x42059b(0x270)]=_0x42059b(0x20d),_0x413c6a[_0x2b1736][_0x42059b(0x2b4)]=_0x8f61f1[0x5];}else{if(_0x2b1736==_0x3d0648){var _0x56ef67;if(_0x8f61f1[0x4]=='L')_0x56ef67='Level';else _0x8f61f1[0x4]=='F'&&(_0x56ef67=_0x42059b(0x20d));_0x413c6a[_0x2b1736][_0x42059b(0x240)]=_0x8f61f1[0x0],_0x413c6a[_0x2b1736][_0x42059b(0x2c3)]=_0x8f61f1[0x1],_0x413c6a[_0x2b1736][_0x42059b(0x226)]=_0x8f61f1[0x2],_0x413c6a[_0x2b1736][_0x42059b(0x20f)]=_0x8f61f1[0x3],_0x413c6a[_0x2b1736][_0x42059b(0x270)]=_0x56ef67,_0x413c6a[_0x2b1736][_0x42059b(0x2b4)]=_0x8f61f1[0x5];}}}});}),_0x68f189[_0x44dac1(0x284)]((_0x40a9ec,_0x243376)=>{_0x413c6a[_0x243376]['unit']=_0x40a9ec;}),_0x33bb2f[_0x44dac1(0x284)]((_0x222189,_0x4fd2fe)=>{var _0x8098a7=_0x44dac1;_0x413c6a[_0x4fd2fe][_0x8098a7(0x29e)]=_0x222189;}),_0x30385b['forEach']((_0x2eabb5,_0x19bd7c)=>{var _0x5188b7=_0x44dac1;_0x413c6a[_0x19bd7c][_0x5188b7(0x208)]=_0x2eabb5;}),_0x11c54a[_0x44dac1(0x284)]((_0x536e82,_0x5b75e3)=>{_0x413c6a[_0x5b75e3]['expiry_date']=_0x536e82;}),_0x168b1c[_0x44dac1(0x284)]((_0x2d37e6,_0x7f8be6)=>{_0x413c6a[_0x7f8be6]['maxperunit']=_0x2d37e6;}),_0x1fc030[_0x44dac1(0x284)]((_0x20518b,_0x41a054)=>{var _0x134c48=_0x44dac1;_0x413c6a[_0x41a054][_0x134c48(0x2ce)]=_0x20518b;}),_0x4ff8df[_0x44dac1(0x284)]((_0x28e9cc,_0x1b6418)=>{var _0x5c9f25=_0x44dac1;_0x413c6a[_0x1b6418][_0x5c9f25(0x1ee)]=_0x28e9cc;}),_0x429cd9[_0x44dac1(0x284)]((_0x5a9fe5,_0x2048d0)=>{_0x413c6a[_0x2048d0]['delivery_date']=_0x5a9fe5;}),_0x360e94[_0x44dac1(0x284)]((_0x2b395e,_0x293341)=>{var _0x59da01=_0x44dac1;_0x413c6a[_0x293341][_0x59da01(0x2c8)]=_0x2b395e;}),_0x5cdee8['forEach']((_0x328558,_0x1a95c8)=>{var _0x30026d=_0x44dac1;_0x413c6a[_0x1a95c8][_0x30026d(0x202)]=_0x328558;}),_0x1eb282[_0x44dac1(0x284)]((_0x15d231,_0x22f803)=>{var _0x53b82a=_0x44dac1;_0x413c6a[_0x22f803][_0x53b82a(0x23e)]=_0x15d231;}),_0x28c9a8[_0x44dac1(0x284)]((_0x33420c,_0xf434f6)=>{var _0xffd42=_0x44dac1;_0x413c6a[_0xf434f6][_0xffd42(0x2ea)]=_0x33420c;});var _0x49b1be=0x0;_0x413c6a['forEach'](_0x2bdb01=>{var _0x4ecdda=_0x44dac1;console[_0x4ecdda(0x27c)](_0x4ecdda(0x2a1),_0x2bdb01),(parseInt(_0x2bdb01[_0x4ecdda(0x2cb)])<parseInt(_0x2bdb01[_0x4ecdda(0x2c5)])||parseInt(_0x2bdb01[_0x4ecdda(0x2c5)])==0x0)&&_0x49b1be++;});if(_0x49b1be!=0x0)return _0x3ae8ac[_0x44dac1(0x1ed)](_0x44dac1(0x250),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x47ffcc[_0x44dac1(0x20b)]('back');const _0x4a96a7=_0x413c6a[_0x44dac1(0x25b)](_0x4150a3=>_0x4150a3[_0x44dac1(0x2c5)]!=='0'&&_0x4150a3[_0x44dac1(0x2c5)]!=='');_0x194bd1[_0x44dac1(0x22a)]=_0x17ac6c,_0x194bd1['customer']=_0x137bd5,_0x194bd1['date']=_0x5114da,_0x194bd1[_0x44dac1(0x289)]=_0x1ceb64,_0x194bd1[_0x44dac1(0x275)]=_0x4a96a7,_0x194bd1['note']=_0x13393e,_0x194bd1[_0x44dac1(0x2d8)]=_0xec4af9,_0x194bd1[_0x44dac1(0x214)]=_0x44dac1(0x29f),_0x194bd1[_0x44dac1(0x211)]=_0x44dac1(0x29f);const _0x4dd454=await _0x194bd1['save']();_0x3ae8ac[_0x44dac1(0x1ed)](_0x44dac1(0x293),_0x44dac1(0x245)),_0x47ffcc['redirect'](_0x44dac1(0x2d9));}catch(_0x217cb6){console[_0x44dac1(0x27c)](_0x217cb6);}}),router[a0_0xfbb5dd(0x242)](a0_0xfbb5dd(0x292),auth,async(_0x58b875,_0x4867b3)=>{var _0x1191fc=a0_0xfbb5dd;try{const _0x2b9396=_0x58b875[_0x1191fc(0x2da)]['id'],{invoice:_0x434d1c,customer:_0x1e4681,receivable_amount:_0x45ae46,received_amount:_0x293a71}=_0x58b875[_0x1191fc(0x2bd)],_0x297fbb=await sales[_0x1191fc(0x29d)](_0x2b9396);console[_0x1191fc(0x27c)](_0x297fbb);var _0x35186=_0x45ae46-_0x293a71;console[_0x1191fc(0x27c)](_0x293a71),_0x297fbb[_0x1191fc(0x2ab)]=parseFloat(_0x293a71)+parseFloat(_0x297fbb[_0x1191fc(0x2ab)]),_0x297fbb['due_amount']=_0x35186,console[_0x1191fc(0x27c)](_0x297fbb);const _0x5f540d=await _0x297fbb[_0x1191fc(0x1fb)](),_0x427ff4=await c_payment_data[_0x1191fc(0x241)]({'invoice':_0x434d1c});_0x427ff4[_0x1191fc(0x210)]=_0x35186,await _0x427ff4[_0x1191fc(0x1fb)]();let _0x3db7a4=new Date(),_0x2e7d98=('0'+_0x3db7a4[_0x1191fc(0x1e8)]())[_0x1191fc(0x1f9)](-0x2),_0x48610e=('0'+(_0x3db7a4['getMonth']()+0x1))[_0x1191fc(0x1f9)](-0x2),_0x8a02b5=_0x3db7a4['getFullYear'](),_0x31faca=_0x8a02b5+'-'+_0x48610e+'-'+_0x2e7d98;const _0x1ee5ab=new customer_payment({'invoice':_0x434d1c,'date':_0x8a02b5+'-'+_0x48610e+'-'+_0x2e7d98,'customer':_0x1e4681,'reason':_0x1191fc(0x1fe),'amount':_0x293a71}),_0xfa7570=await _0x1ee5ab[_0x1191fc(0x1fb)]();_0x58b875[_0x1191fc(0x1ed)](_0x1191fc(0x293),_0x1191fc(0x2a9)),_0x4867b3['redirect']('/all_sales/view');}catch(_0x127c4d){console[_0x1191fc(0x27c)](_0x127c4d);}}),router[a0_0xfbb5dd(0x243)](a0_0xfbb5dd(0x299),auth,async(_0x66d34f,_0x73cfd9)=>{var _0x1ff1ee=a0_0xfbb5dd;try{const {username:_0x14d8a6,email:_0x4de48a,role:_0x5bc5a2}=_0x66d34f[_0x1ff1ee(0x2e6)],_0x5e7285=_0x66d34f['user'],_0x57760e=await profile['findOne']({'email':_0x5e7285['email']}),_0x1e2218=await master_shop[_0x1ff1ee(0x1e5)]();console['log'](_0x1ff1ee(0x272),_0x1e2218);const _0x17c51d=_0x66d34f[_0x1ff1ee(0x2da)]['id'],_0x17ece9=await sales[_0x1ff1ee(0x29d)](_0x17c51d);console[_0x1ff1ee(0x27c)](_0x17ece9);const _0x20dbd4=await customer[_0x1ff1ee(0x241)]({'name':_0x17ece9['customer']});console[_0x1ff1ee(0x27c)](_0x20dbd4);if(_0x1e2218[0x0][_0x1ff1ee(0x1f8)]==_0x1ff1ee(0x2df)){var _0x525591=users[_0x1ff1ee(0x216)];console['log'](_0x525591);}else{if(_0x1e2218[0x0]['language']==_0x1ff1ee(0x2b9))var _0x525591=users['Hindi'];else{if(_0x1e2218[0x0][_0x1ff1ee(0x1f8)]==_0x1ff1ee(0x2bf))var _0x525591=users[_0x1ff1ee(0x2bf)];else{if(_0x1e2218[0x0]['language']==_0x1ff1ee(0x217))var _0x525591=users[_0x1ff1ee(0x217)];else{if(_0x1e2218[0x0][_0x1ff1ee(0x1f8)]==_0x1ff1ee(0x21d))var _0x525591=users[_0x1ff1ee(0x21d)];else{if(_0x1e2218[0x0][_0x1ff1ee(0x1f8)]==_0x1ff1ee(0x239))var _0x525591=users[_0x1ff1ee(0x22b)];else{if(_0x1e2218[0x0][_0x1ff1ee(0x1f8)]==_0x1ff1ee(0x262))var _0x525591=users[_0x1ff1ee(0x262)];else{if(_0x1e2218[0x0][_0x1ff1ee(0x1f8)]==_0x1ff1ee(0x221))var _0x525591=users[_0x1ff1ee(0x28c)];}}}}}}}_0x73cfd9[_0x1ff1ee(0x1f7)](_0x1ff1ee(0x278),{'success':_0x66d34f[_0x1ff1ee(0x1ed)](_0x1ff1ee(0x293)),'errors':_0x66d34f[_0x1ff1ee(0x1ed)](_0x1ff1ee(0x250)),'role':_0x5e7285,'profile':_0x57760e,'master_shop':_0x1e2218,'customers':_0x20dbd4,'sales':_0x17ece9,'language':_0x525591});}catch(_0x790041){console[_0x1ff1ee(0x27c)](_0x790041);}}),router[a0_0xfbb5dd(0x243)](a0_0xfbb5dd(0x2c0),auth,async(_0x1493a4,_0x28dbc9)=>{var _0x23e86c=a0_0xfbb5dd;try{const {username:_0x4d19c6,email:_0x264274,role:_0x16ac7a}=_0x1493a4[_0x23e86c(0x2e6)],_0x358355=_0x1493a4[_0x23e86c(0x2e6)],_0x11791e=await profile['findOne']({'email':_0x358355[_0x23e86c(0x252)]}),_0x105319=await master_shop[_0x23e86c(0x1e5)]();console['log']('master',_0x105319);const _0x32ca57=_0x1493a4[_0x23e86c(0x2da)]['id'];console[_0x23e86c(0x27c)](_0x32ca57);const _0x1b7428=await sales[_0x23e86c(0x29d)](_0x32ca57);console[_0x23e86c(0x27c)](_0x23e86c(0x209),_0x1b7428);const _0xd24ec3=await warehouse[_0x23e86c(0x222)]([{'$match':{'name':_0x23e86c(0x227),'room':_0x23e86c(0x2c1)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x23e86c(0x26b),'name':{'$first':_0x23e86c(0x2e7)},'product_stock':{'$first':_0x23e86c(0x1eb)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x23e86c(0x22c)},'pallet':{'$first':_0x23e86c(0x283)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x23e86c(0x225)},'product_code':{'$first':_0x23e86c(0x220)}}}]);console[_0x23e86c(0x27c)](_0x23e86c(0x253),_0xd24ec3);const _0x56c72c=await product[_0x23e86c(0x1e5)]({});warehouse_data=await warehouse[_0x23e86c(0x222)]([{'$match':{'status':_0x23e86c(0x2c7),'name':_0x23e86c(0x227),'warehouse_category':_0x23e86c(0x256)}},{'$group':{'_id':_0x23e86c(0x21e),'name':{'$first':_0x23e86c(0x21e)}}},{'$sort':{'name':0x1}}]);var _0x4d272a=[_0x23e86c(0x2c1)];if(_0x105319[0x0]['language']==_0x23e86c(0x2df)){var _0xd61c0d=users[_0x23e86c(0x216)];console[_0x23e86c(0x27c)](_0xd61c0d);}else{if(_0x105319[0x0][_0x23e86c(0x1f8)]==_0x23e86c(0x2b9))var _0xd61c0d=users[_0x23e86c(0x2b9)];else{if(_0x105319[0x0][_0x23e86c(0x1f8)]==_0x23e86c(0x2bf))var _0xd61c0d=users[_0x23e86c(0x2bf)];else{if(_0x105319[0x0][_0x23e86c(0x1f8)]==_0x23e86c(0x217))var _0xd61c0d=users[_0x23e86c(0x217)];else{if(_0x105319[0x0]['language']=='French')var _0xd61c0d=users[_0x23e86c(0x21d)];else{if(_0x105319[0x0][_0x23e86c(0x1f8)]==_0x23e86c(0x239))var _0xd61c0d=users['Portuguese'];else{if(_0x105319[0x0]['language']==_0x23e86c(0x262))var _0xd61c0d=users['Chinese'];else{if(_0x105319[0x0][_0x23e86c(0x1f8)]=='Arabic\x20(ae)')var _0xd61c0d=users[_0x23e86c(0x28c)];}}}}}}}_0x28dbc9[_0x23e86c(0x1f7)](_0x23e86c(0x22d),{'success':_0x1493a4[_0x23e86c(0x1ed)](_0x23e86c(0x293)),'errors':_0x1493a4['flash']('errors'),'role':_0x358355,'profile':_0x11791e,'user':_0x1b7428,'stock':_0xd24ec3,'master_shop':_0x105319,'unit':_0x56c72c,'language':_0xd61c0d,'warehouses':warehouse_data,'rooms':_0x4d272a});}catch(_0x38fc71){console[_0x23e86c(0x27c)](_0x38fc71),_0x28dbc9['status'](0xc8)[_0x23e86c(0x2b5)]({'message':_0x38fc71[_0x23e86c(0x29c)]});}}),router[a0_0xfbb5dd(0x242)](a0_0xfbb5dd(0x2c0),auth,async(_0x3892a7,_0x4090a0)=>{var _0x43b501=a0_0xfbb5dd;try{const {invoice:_0x14bc76,date:_0xbed854,warehouse_name:_0x3f4f11,product_name:_0xd9a476,primary_code:_0x3e5a37,secondary_code:_0x1649c4,product_code:_0x95753d,sales_quantity:_0x22d8c6,stocks:_0x2de46c,return_qty:_0x5e19e2,Room_name:_0x2c458b,to_warehouse_name:_0x599f4e,to_Roomname:_0x317337,to_Room_name:_0x44decd,note:_0x5bd527,level:_0xe58792,isle:_0x214f85,pallet:_0x1a4c77}=_0x3892a7[_0x43b501(0x2bd)];if(typeof _0xd9a476=='string')var _0x371585=[_0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x1f0)]],_0x44119e=[_0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x269)]],_0x520249=[_0x3892a7['body'][_0x43b501(0x2d4)]],_0x25d466=[_0x3892a7['body'][_0x43b501(0x1e7)]],_0x3dcc03=[_0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x285)]],_0x5e986d=[_0x3892a7['body'][_0x43b501(0x230)]],_0x295a7e=[_0x3892a7['body'][_0x43b501(0x2cc)]],_0x17a62b=[_0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x226)]],_0x3b5fd4=[_0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x20f)]],_0x505171=[_0x3892a7['body'][_0x43b501(0x281)]],_0x4569c8=[_0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x2b4)]];else var _0x371585=[..._0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x1f0)]],_0x44119e=[..._0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x269)]],_0x520249=[..._0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x2d4)]],_0x25d466=[..._0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x1e7)]],_0x3dcc03=[..._0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x285)]],_0x5e986d=[..._0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x230)]],_0x295a7e=[..._0x3892a7['body'][_0x43b501(0x2cc)]],_0x17a62b=[..._0x3892a7['body'][_0x43b501(0x226)]],_0x3b5fd4=[..._0x3892a7['body'][_0x43b501(0x20f)]],_0x505171=[..._0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x281)]],_0x4569c8=[..._0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x2b4)]];const _0x17e75d=_0x371585[_0x43b501(0x26c)](_0x497b3e=>{return _0x497b3e={'product_name':_0x497b3e};});_0x44119e[_0x43b501(0x284)]((_0x16a132,_0x2cc291)=>{var _0x50c465=_0x43b501;_0x17e75d[_0x2cc291][_0x50c465(0x269)]=_0x16a132;}),_0x520249[_0x43b501(0x284)]((_0x1048fd,_0x34c137)=>{var _0x417b3c=_0x43b501;_0x17e75d[_0x34c137][_0x417b3c(0x2d4)]=_0x1048fd;}),_0x25d466['forEach']((_0xe7ab4c,_0x3a5e4c)=>{var _0x44f472=_0x43b501;_0x17e75d[_0x3a5e4c][_0x44f472(0x1e7)]=_0xe7ab4c;}),_0x3dcc03['forEach']((_0x5d86fd,_0x57fec4)=>{var _0x5290d1=_0x43b501;_0x17e75d[_0x57fec4][_0x5290d1(0x251)]=_0x5d86fd;}),_0x5e986d[_0x43b501(0x284)]((_0x52a2ff,_0x5f2d31)=>{var _0x497625=_0x43b501;_0x17e75d[_0x5f2d31][_0x497625(0x2cb)]=_0x52a2ff;}),_0x295a7e[_0x43b501(0x284)]((_0x91941f,_0xdc5db2)=>{var _0x4532f1=_0x43b501;_0x17e75d[_0xdc5db2][_0x4532f1(0x2cc)]=_0x91941f;}),_0x17a62b[_0x43b501(0x284)]((_0x3e1277,_0x1047e9)=>{_0x17e75d[_0x1047e9]['bay']=_0x3e1277;}),_0x3b5fd4[_0x43b501(0x284)]((_0x2592bd,_0x1d1ab3)=>{var _0x2b6ae0=_0x43b501;_0x17e75d[_0x1d1ab3][_0x2b6ae0(0x20f)]=_0x2592bd;}),_0x505171[_0x43b501(0x284)]((_0x5b8675,_0x3de4c8)=>{var _0x1bc44d=_0x43b501;_0x17e75d[_0x3de4c8][_0x1bc44d(0x270)]=_0x5b8675;}),_0x4569c8[_0x43b501(0x284)]((_0x44464b,_0x5726d1)=>{var _0x177324=_0x43b501;_0x17e75d[_0x5726d1][_0x177324(0x2b4)]=_0x44464b;});var _0x4adebc=0x0;_0x17e75d[_0x43b501(0x284)](_0x45c55c=>{var _0x2fb191=_0x43b501;console[_0x2fb191(0x27c)](_0x2fb191(0x2a1),_0x45c55c),(parseInt(_0x45c55c[_0x2fb191(0x251)])<parseInt(_0x45c55c['return_qty'])||parseInt(_0x45c55c[_0x2fb191(0x2cb)])<parseInt(_0x45c55c[_0x2fb191(0x2cc)])&&parseInt(_0x45c55c[_0x2fb191(0x251)])>parseInt(_0x45c55c[_0x2fb191(0x2cc)])||parseInt(_0x45c55c[_0x2fb191(0x2cc)])==0x0)&&_0x4adebc++;});if(_0x4adebc!=0x0)return _0x3892a7[_0x43b501(0x1ed)](_0x43b501(0x250),_0x43b501(0x238)),_0x4090a0[_0x43b501(0x20b)](_0x43b501(0x2ba));const _0x53ebef=await sales[_0x43b501(0x241)]({'invoice':_0x14bc76});console[_0x43b501(0x27c)](_0x53ebef),_0x53ebef[_0x43b501(0x2e0)]='True';const _0x1feab4=await _0x53ebef[_0x43b501(0x1fb)](),_0x1cb717=new sales_return({'invoice':_0x14bc76,'customer':_0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x25a)],'date':_0xbed854,'warehouse_name':_0x3f4f11,'room':_0x2c458b,'ToWarehouse':_0x599f4e,'ToRoom':_0x44decd,'return_sale':_0x17e75d,'note':_0x5bd527}),_0x6c2cce=await _0x1cb717[_0x43b501(0x1fb)]();console[_0x43b501(0x27c)](_0x1cb717);const _0x420604=await sales_return[_0x43b501(0x241)]({'invoice':_0x14bc76}),_0x30940d=await warehouse['findOne']({'name':_0x599f4e,'room':_0x44decd});_0x420604[_0x43b501(0x22d)][_0x43b501(0x284)](_0x2bd463=>{var _0x4ceeb2=_0x43b501,_0x5e1be6=0x0;const _0x4e924a=_0x30940d[_0x4ceeb2(0x2bb)][_0x4ceeb2(0x26c)](_0x304f93=>{var _0x3954dd=_0x4ceeb2;_0x304f93[_0x3954dd(0x1f0)]==_0x2bd463[_0x3954dd(0x1f0)]&&_0x304f93[_0x3954dd(0x2b4)]==_0x2bd463[_0x3954dd(0x2b4)]&&_0x304f93[_0x3954dd(0x270)]==_0x2bd463[_0x3954dd(0x270)]&&_0x304f93['bin']==_0x2bd463[_0x3954dd(0x20f)]&&_0x304f93['bay']==_0x2bd463['bay']&&(_0x304f93[_0x3954dd(0x24d)]=parseInt(_0x304f93['product_stock'])+parseInt(_0x2bd463[_0x3954dd(0x2cc)]),_0x5e1be6++);});_0x5e1be6=='0'&&(_0x30940d[_0x4ceeb2(0x2bb)]=_0x30940d[_0x4ceeb2(0x2bb)]['concat']({'product_name':_0x2bd463[_0x4ceeb2(0x1f0)],'product_stock':_0x2bd463[_0x4ceeb2(0x2cc)],'primary_code':_0x2bd463[_0x4ceeb2(0x269)],'secondary_code':_0x2bd463[_0x4ceeb2(0x2d4)],'product_code':_0x2bd463[_0x4ceeb2(0x1e7)],'bay':_0x2bd463['bay'],'bin':_0x2bd463[_0x4ceeb2(0x20f)],'type':_0x2bd463[_0x4ceeb2(0x270)],'floorlevel':_0x2bd463[_0x4ceeb2(0x2b4)]})),console[_0x4ceeb2(0x27c)]('final',_0x30940d);}),await _0x30940d[_0x43b501(0x1fb)](),console['log'](_0x3892a7[_0x43b501(0x2bd)]);const _0x501efa=new c_payment_data({'invoice':_0x14bc76,'customer':_0x3892a7[_0x43b501(0x2bd)][_0x43b501(0x25a)],'reason':_0x43b501(0x2c9)});await _0x501efa[_0x43b501(0x1fb)]();const _0x16dc5e=await master_shop[_0x43b501(0x1e5)]();console['log'](_0x43b501(0x1f4),_0x16dc5e[0x0][_0x43b501(0x27d)]);const _0x259977=await email_settings[_0x43b501(0x241)](),_0x3aa624=await customer[_0x43b501(0x241)]({'name':_0x3892a7['body']['customer']});console[_0x43b501(0x27c)](_0x43b501(0x28a),_0x3aa624);_0x16dc5e[0x0]['currency_placement']==0x1?(right_currency=_0x16dc5e[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x16dc5e[0x0][_0x43b501(0x28b)]);var _0x1b48f2=_0x371585,_0xf1dd6c=_0x295a7e,_0x5b2596='',_0x56806a;for(_0x56806a in _0x1b48f2){_0x5b2596+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b48f2[_0x56806a]+_0x43b501(0x255)+_0x43b501(0x231)+_0xf1dd6c[_0x56806a]+_0x43b501(0x255)+_0x43b501(0x24c);}console[_0x43b501(0x27c)]('product_list',_0x5b2596);let _0x57a23e=nodemailer[_0x43b501(0x21c)]({'service':_0x43b501(0x1ec),'auth':{'user':_0x259977[_0x43b501(0x252)],'pass':_0x259977[_0x43b501(0x2ec)]}}),_0x2bb236={'from':_0x259977[_0x43b501(0x252)],'to':_0x3aa624[_0x43b501(0x252)],'subject':_0x43b501(0x1ff),'attachments':[{'filename':_0x43b501(0x296),'path':__dirname+_0x43b501(0x2dd)+'/upload/'+_0x16dc5e[0x0][_0x43b501(0x27d)],'cid':_0x43b501(0x2a5)}],'html':_0x43b501(0x290)+_0x43b501(0x2b2)+_0x43b501(0x215)+_0x43b501(0x2a0)+_0x43b501(0x25f)+'<div>'+_0x43b501(0x244)+_0x43b501(0x235)+'<div>'+_0x43b501(0x1f3)+_0x16dc5e[0x0][_0x43b501(0x237)]+_0x43b501(0x263)+'</div>'+_0x43b501(0x235)+_0x43b501(0x2e8)+_0x43b501(0x2a0)+_0x43b501(0x20a)+'\x20Order\x20Number\x20:\x20'+_0x14bc76+'\x20'+_0x43b501(0x29a)+_0x43b501(0x26a)+_0xbed854+'\x20'+'</span>'+_0x43b501(0x258)+'</div>'+_0x43b501(0x233)+_0x43b501(0x26d)+_0x43b501(0x1ea)+_0x43b501(0x23a)+_0x43b501(0x2aa)+_0x43b501(0x268)+_0x43b501(0x2ca)+'</tr>'+_0x43b501(0x224)+_0x43b501(0x201)+'\x20'+_0x5b2596+'\x20'+_0x43b501(0x27f)+_0x43b501(0x1f1)+_0x43b501(0x2a0)+_0x43b501(0x2cf)+_0x43b501(0x287)+_0x16dc5e[0x0][_0x43b501(0x237)]+_0x43b501(0x258)+'</div>'+_0x43b501(0x235)+_0x43b501(0x23f)};_0x57a23e[_0x43b501(0x260)](_0x2bb236,function(_0x4f2d00,_0x49354b){var _0x14b882=_0x43b501;_0x4f2d00?(console[_0x14b882(0x27c)](_0x4f2d00),console[_0x14b882(0x27c)](_0x14b882(0x27a))):console['log']('Email\x20sent\x20successfully');}),_0x3892a7[_0x43b501(0x1ed)]('success',_0x43b501(0x20c)),_0x4090a0['redirect'](_0x43b501(0x2d9));}catch(_0xa2029e){console['log'](_0xa2029e),_0x4090a0[_0x43b501(0x23d)](0xc8)[_0x43b501(0x2b5)]({'message1':_0xa2029e[_0x43b501(0x29c)]});}}),router[a0_0xfbb5dd(0x243)](a0_0xfbb5dd(0x2d0),auth,async(_0x9c3415,_0x3422a6)=>{var _0x557a0c=a0_0xfbb5dd;try{const {username:_0x28bbe4,email:_0x7bdf92,role:_0x352b8e}=_0x9c3415[_0x557a0c(0x2e6)],_0x2598a1=_0x9c3415[_0x557a0c(0x2e6)],_0x389eab=await profile[_0x557a0c(0x241)]({'email':_0x2598a1['email']}),_0x199030=await master_shop[_0x557a0c(0x1e5)]();console['log'](_0x557a0c(0x2d6),_0x199030);const _0x4c4771=_0x9c3415['params']['id'],_0x4e6cf4=await sales[_0x557a0c(0x29d)](_0x4c4771);console[_0x557a0c(0x27c)](_0x557a0c(0x2c6),_0x4e6cf4);if(_0x199030[0x0][_0x557a0c(0x1f8)]==_0x557a0c(0x2df))var _0x3b85b4=users[_0x557a0c(0x216)];else{if(_0x199030[0x0]['language']==_0x557a0c(0x2b9))var _0x3b85b4=users[_0x557a0c(0x2b9)];else{if(_0x199030[0x0][_0x557a0c(0x1f8)]==_0x557a0c(0x2bf))var _0x3b85b4=users[_0x557a0c(0x2bf)];else{if(_0x199030[0x0][_0x557a0c(0x1f8)]==_0x557a0c(0x217))var _0x3b85b4=users[_0x557a0c(0x217)];else{if(_0x199030[0x0][_0x557a0c(0x1f8)]==_0x557a0c(0x21d))var _0x3b85b4=users[_0x557a0c(0x21d)];else{if(_0x199030[0x0]['language']==_0x557a0c(0x239))var _0x3b85b4=users[_0x557a0c(0x22b)];else{if(_0x199030[0x0][_0x557a0c(0x1f8)]=='Chinese')var _0x3b85b4=users[_0x557a0c(0x262)];else{if(_0x199030[0x0][_0x557a0c(0x1f8)]==_0x557a0c(0x221))var _0x3b85b4=users[_0x557a0c(0x28c)];}}}}}}}_0x3422a6[_0x557a0c(0x1f7)]('all_sales_barcode',{'success':_0x9c3415[_0x557a0c(0x1ed)](_0x557a0c(0x293)),'errors':_0x9c3415[_0x557a0c(0x1ed)]('errors'),'role':_0x2598a1,'profile':_0x389eab,'alldata':_0x4e6cf4,'master_shop':_0x199030,'language':_0x3b85b4});}catch(_0x58c58f){console['log'](_0x58c58f);}}),router[a0_0xfbb5dd(0x242)]('/barcode_scanner',async(_0x1f959d,_0x39399b)=>{var _0x24b4fa=a0_0xfbb5dd;const {product_code:_0x9a55c,warehouse_name:_0x66cff8,rooms_data:_0x5425b4,Roomslist:_0x176325}=_0x1f959d[_0x24b4fa(0x2bd)],_0x14f9df=_0x176325[_0x24b4fa(0x2a7)](','),_0x56cfa3=[];async function _0x53b9b8(_0x5de1e5){var _0x1da904=_0x24b4fa;const _0x4f1a26=await warehouse['aggregate']([{'$match':{'name':_0x66cff8,'room':_0x5de1e5}},{'$unwind':_0x1da904(0x204)},{'$match':{'product_details.primary_code':_0x9a55c}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1da904(0x2e7)},'product_stock':{'$first':_0x1da904(0x1eb)},'primary_code':{'$first':_0x1da904(0x207)},'secondary_code':{'$first':_0x1da904(0x225)},'product_code':{'$first':_0x1da904(0x220)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x1da904(0x2cd)},'type':{'$first':_0x1da904(0x2a8)},'pallet':{'$first':_0x1da904(0x2c2)},'unit':{'$first':_0x1da904(0x254)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1da904(0x297)},'rack':{'$first':_0x1da904(0x2d2)},'expiry_date':{'$first':_0x1da904(0x25d)},'production_date':{'$first':_0x1da904(0x1e9)},'maxPerUnit':{'$first':_0x1da904(0x2e4)},'batch_code':{'$first':_0x1da904(0x2ad)},'product_cat':{'$first':_0x1da904(0x247)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x1da904(0x1e6)},'invoice':{'$first':_0x1da904(0x28f)},'actual_qty':{'$first':_0x1da904(0x23b)}}}]),_0x36e48d=await warehouse[_0x1da904(0x222)]([{'$match':{'name':_0x66cff8,'room':_0x5de1e5}},{'$unwind':_0x1da904(0x204)},{'$match':{'product_details.secondary_code':_0x9a55c}},{'$group':{'_id':_0x1da904(0x26b),'name':{'$first':_0x1da904(0x2e7)},'product_stock':{'$first':_0x1da904(0x1eb)},'primary_code':{'$first':_0x1da904(0x207)},'secondary_code':{'$first':_0x1da904(0x225)},'product_code':{'$first':_0x1da904(0x220)},'level':{'$first':_0x1da904(0x229)},'isle':{'$first':_0x1da904(0x2cd)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1da904(0x254)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1da904(0x297)},'rack':{'$first':_0x1da904(0x2d2)},'expiry_date':{'$first':_0x1da904(0x25d)},'production_date':{'$first':_0x1da904(0x1e9)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x1da904(0x2ad)},'product_cat':{'$first':_0x1da904(0x247)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1da904(0x1e6)},'invoice':{'$first':_0x1da904(0x28f)}}}]);if(_0x4f1a26[_0x1da904(0x282)]>0x0)_0x56cfa3[_0x1da904(0x2a4)](_0x4f1a26);else _0x36e48d[_0x1da904(0x282)]>0x0&&_0x56cfa3['push'](_0x36e48d);}const _0x443339=_0x14f9df[_0x24b4fa(0x26c)](_0x38e345=>_0x53b9b8(_0x38e345));await Promise[_0x24b4fa(0x2eb)](_0x443339),_0x39399b['json'](_0x56cfa3);}),module[a0_0xfbb5dd(0x24f)]=router;function a0_0x2039(){var _0x52c328=['room','Chinese','\x20</h2>','prod_code','error','level','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','primary_code','\x20Order\x20Date\x20:\x20','$product_details._id','map','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','75qFfBHJ','$sale_product.type','type','delivery_date','master','catch','express','sale_product','customers_docs','unit','sales_invoice','$sale_product.quantity','Error\x20Occurs','product_data','log','image','True','</tbody>','warehouse','types','length','$product_details.pallet','forEach','sales_quantity','653590NOqtdC','<h5>','padStart','warehouse_name','customer_data','currency','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.invoice','<!DOCTYPE\x20html>','Shelves','/give_payment/:id','success','expiry_date','An\x20error\x20occurred.','Logo.png','$product_details.storage','random','/invoice/:id','<span\x20style=\x22float:\x20right;\x22>','name','message','findById','secondary_unit','False','<div>','foreach\x20newproduct','max_per_unit','customers','push','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','split','$product_details.type','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','received_amount','/view/:id','$product_details.batch_code','Ambient','22tuDDUl','34252dxOsRF','$_id','<html><head><title></title>','/view/add_sales/:id','floorlevel','json','/view/add_sale/product','$product.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Hindi','back','product_details','then','body','/view','German','/view/return_sales/:id','Return\x20Rooms','$product_details.floorlevel','rack','Sales\x20Mail','quantity','barcode\x20user_id','Enabled','delivery_code','Sale\x20Return','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','stock','return_qty','$product_details.bin','production_date','<strong>\x20Regards\x20</strong>','/barcode/:id','$customer','$product_details.rack','454160bqcjEs','secondary_code','string','barcode\x20Product\x20master','55ZudhQs','SCRN','/all_sales/view','params','89130dqRGjI','616041DyaDUf','/../public','63KKpKtP','English\x20(US)','return_data','$sale_product.floorlevel','35396ZzFhNa','$note','$product_details.maxPerUnit','$sale_product.bin','user','$product_details.product_name','<hr\x20class=\x22my-3\x22>','edit_sales','room_name','all','password','find','$room','product_code','getDate','$product_details.production_date','<tr>','$product_details.product_stock','gmail','flash','requested_qty','Enclosed','product_name','</table>','$finalize','<h2>\x20','add\x20post','$invoice','edit_sales_view','render','language','slice','$isAllowEdit','save','prod_invoice','Level','Received\x20Payment\x20For\x20Sale','Sale\x20Return\x20Mail','RoomAssigned','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_cat','OUT-','$product_details','$date','nodemailer','$product_details.primary_code','batch_code','user_id','<h5\x20style=\x22text-align:\x20left;\x22>','redirect','sales\x20item\x20return\x20successfull','Floor','/view/add_sales','bin','amount','isAllowEdit','primary_unit','$sale_product','finalize','</head><body>','English','Spanish','$return_data','RMSEmail','16656948yRffeL','../middleware/auth','createTransport','French','$name','product','$product_details.product_code','Arabic\x20(ae)','aggregate','40owJDaw','</thead>','$product_details.secondary_code','bay','Return\x20Goods','role','$product_details.bay','invoice','Portuguese','$product_details.isle','return_sale','/upload/','staff','stocks','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','../models/all_models','<table\x20style=\x22width:\x20100%\x20!important;\x22>','purchases_data','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','site_title','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.actual_qty','/all_sales/preview/','status','quantity_notConverted','</body></html>','storage','findOne','post','get','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Sales\x20Update\x20successfully','toString','$product_details.product_cat','date','$customers_docs','Receiving\x20Area','sales\x20all_data','</tr>','product_stock','Sales\x20Add\x20successfully','exports','errors','sale_qty','email','stock_data','$product_details.unit','</td>','Raw\x20Materials','$warehouse_name','</h5>','</span>','customer','filter','$sale_product.bay','$product_details.expiry_date','carton','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','sendMail'];a0_0x2039=function(){return _0x52c328;};return a0_0x2039();}