var a0_0x13d0cc=a0_0x65b3;(function(_0x5005da,_0x4fae8a){var _0x2eb099=a0_0x65b3,_0x30647f=_0x5005da();while(!![]){try{var _0x139e70=parseInt(_0x2eb099(0x201))/0x1+-parseInt(_0x2eb099(0x1a6))/0x2*(parseInt(_0x2eb099(0x1d4))/0x3)+-parseInt(_0x2eb099(0x167))/0x4*(parseInt(_0x2eb099(0x1db))/0x5)+-parseInt(_0x2eb099(0x150))/0x6+-parseInt(_0x2eb099(0x16d))/0x7+parseInt(_0x2eb099(0x19b))/0x8+parseInt(_0x2eb099(0x178))/0x9*(parseInt(_0x2eb099(0x1f7))/0xa);if(_0x139e70===_0x4fae8a)break;else _0x30647f['push'](_0x30647f['shift']());}catch(_0xe25201){_0x30647f['push'](_0x30647f['shift']());}}}(a0_0x15ad,0xbb715));const express=require(a0_0x13d0cc(0x214)),app=express(),router=express[a0_0x13d0cc(0x1d0)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x13d0cc(0x1df)),users=require(a0_0x13d0cc(0x1f3));function a0_0x65b3(_0xaa8021,_0x25c401){var _0x15adfc=a0_0x15ad();return a0_0x65b3=function(_0x65b376,_0x3f578b){_0x65b376=_0x65b376-0x14d;var _0x14efd7=_0x15adfc[_0x65b376];return _0x14efd7;},a0_0x65b3(_0xaa8021,_0x25c401);}router[a0_0x13d0cc(0x222)](a0_0x13d0cc(0x1c1),auth,async(_0x289e55,_0x380e5a)=>{var _0xebe10e=a0_0x13d0cc;try{const {username:_0x15310c,email:_0x572cfd,role:_0x29ef56}=_0x289e55[_0xebe10e(0x223)],_0x3cdfc9=_0x289e55['user'],_0x3ed59e=await profile['findOne']({'email':_0x3cdfc9[_0xebe10e(0x1bb)]}),_0x24ecfd=await master_shop['find']();let _0x240357;if(_0x3cdfc9[_0xebe10e(0x249)]=='staff'){const _0x1c5c8b=await staff['findOne']({'email':_0x3cdfc9['email']});_0x240357=await sales[_0xebe10e(0x236)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0xebe10e(0x14e),'as':_0xebe10e(0x1b9)}},{'$unwind':'$customers_docs'},{'$unwind':_0xebe10e(0x1e7)},{'$group':{'_id':_0xebe10e(0x1a3),'invoice':{'$first':'$invoice'},'customers':{'$first':_0xebe10e(0x17f)},'date':{'$first':_0xebe10e(0x1ad)},'warehouse_name':{'$first':_0xebe10e(0x22e)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0xebe10e(0x22a)},'total_saleproduct_quantity':{'$sum':_0xebe10e(0x1ae)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0xebe10e(0x1b4)},'pallet':{'$addToSet':_0xebe10e(0x16e)},'finalize':{'$first':_0xebe10e(0x1d8)},'isAllowEdit':{'$first':_0xebe10e(0x258)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x240357=await sales[_0xebe10e(0x236)]([{'$lookup':{'from':_0xebe10e(0x1c4),'localField':_0xebe10e(0x245),'foreignField':'name','as':_0xebe10e(0x1b9)}},{'$unwind':_0xebe10e(0x22a)},{'$unwind':_0xebe10e(0x1e7)},{'$group':{'_id':_0xebe10e(0x1a3),'invoice':{'$first':_0xebe10e(0x1d6)},'customers':{'$first':_0xebe10e(0x17f)},'date':{'$first':_0xebe10e(0x1ad)},'warehouse_name':{'$first':_0xebe10e(0x22e)},'sale_product':{'$push':_0xebe10e(0x1e7)},'note':{'$first':_0xebe10e(0x1ac)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0xebe10e(0x22a)},'total_saleproduct_quantity':{'$sum':_0xebe10e(0x1ae)},'level':{'$addToSet':_0xebe10e(0x20c)},'isle':{'$addToSet':_0xebe10e(0x1f6)},'type':{'$addToSet':_0xebe10e(0x1b4)},'pallet':{'$addToSet':_0xebe10e(0x16e)},'finalize':{'$first':_0xebe10e(0x1d8)},'isAllowEdit':{'$first':_0xebe10e(0x258)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0xebe10e(0x17a)](_0xebe10e(0x254),_0x240357);if(_0x24ecfd[0x0][_0xebe10e(0x159)]==_0xebe10e(0x213)){var _0x611b6=users[_0xebe10e(0x20a)];console['log'](_0x611b6);}else{if(_0x24ecfd[0x0][_0xebe10e(0x159)]==_0xebe10e(0x189))var _0x611b6=users[_0xebe10e(0x189)];else{if(_0x24ecfd[0x0][_0xebe10e(0x159)]==_0xebe10e(0x1b5))var _0x611b6=users[_0xebe10e(0x1b5)];else{if(_0x24ecfd[0x0][_0xebe10e(0x159)]==_0xebe10e(0x193))var _0x611b6=users[_0xebe10e(0x193)];else{if(_0x24ecfd[0x0][_0xebe10e(0x159)]==_0xebe10e(0x185))var _0x611b6=users[_0xebe10e(0x185)];else{if(_0x24ecfd[0x0][_0xebe10e(0x159)]==_0xebe10e(0x247))var _0x611b6=users['Portuguese'];else{if(_0x24ecfd[0x0]['language']==_0xebe10e(0x24b))var _0x611b6=users[_0xebe10e(0x24b)];else{if(_0x24ecfd[0x0][_0xebe10e(0x159)]==_0xebe10e(0x23e))var _0x611b6=users[_0xebe10e(0x177)];}}}}}}}_0x380e5a[_0xebe10e(0x221)](_0xebe10e(0x1a0),{'success':_0x289e55[_0xebe10e(0x1b7)](_0xebe10e(0x24a)),'errors':_0x289e55['flash']('errors'),'sales':_0x240357,'profile':_0x3ed59e,'role':_0x3cdfc9,'master_shop':_0x24ecfd,'language':_0x611b6});}catch(_0x2d4d96){console[_0xebe10e(0x17a)](_0x2d4d96);}});async function getRandom8DigitNumber(){var _0x4c251c=a0_0x13d0cc;const _0x225818=0x989680,_0x5e84c4=0x5f5e0ff,_0x40aacf=Math[_0x4c251c(0x1d1)](Math[_0x4c251c(0x1b1)]()*(_0x5e84c4-_0x225818+0x1))+_0x225818;var _0x46fcae;const _0x507ee5=await sales[_0x4c251c(0x17c)]({'invoice':'OUT-'+_0x40aacf});return _0x507ee5&&_0x507ee5['length']>0x0?_0x46fcae='OUT-'+_0x40aacf:_0x46fcae=_0x4c251c(0x18c)+_0x40aacf,_0x46fcae;}router[a0_0x13d0cc(0x222)](a0_0x13d0cc(0x217),auth,async(_0x1219d6,_0x192e55)=>{var _0x796b2b=a0_0x13d0cc;try{const {username:_0x4a9f09,email:_0x2a2403,role:_0x4c2868}=_0x1219d6[_0x796b2b(0x223)],_0x1c5779=_0x1219d6['user'],_0x3b25cf=await profile[_0x796b2b(0x17c)]({'email':_0x1c5779[_0x796b2b(0x1bb)]}),_0x127002=await master_shop['find'](),_0x581efc=await customer[_0x796b2b(0x1ee)]({});let _0x4dce46;if(_0x1c5779[_0x796b2b(0x249)]==_0x796b2b(0x1ca)){const _0x413226=await staff[_0x796b2b(0x17c)]({'email':_0x1c5779['email']});_0x4dce46=await warehouse[_0x796b2b(0x236)]([{'$match':{'status':_0x796b2b(0x199),'name':_0x413226[_0x796b2b(0x152)],'warehouse_category':_0x796b2b(0x240),'name':{'$ne':_0x796b2b(0x198)}}},{'$group':{'_id':'$name','name':{'$first':_0x796b2b(0x1ed)}}},{'$sort':{'name':0x1}}]);}else _0x4dce46=await warehouse['aggregate']([{'$match':{'status':_0x796b2b(0x199),'warehouse_category':_0x796b2b(0x240),'name':{'$ne':_0x796b2b(0x198)}}},{'$group':{'_id':_0x796b2b(0x1ed),'name':{'$first':_0x796b2b(0x1ed)}}},{'$sort':{'name':0x1}}]);const _0x1b08bc=await product[_0x796b2b(0x1ee)]({});var _0x2d4766=['Ambient',_0x796b2b(0x1cb)];const _0x2b38d7=await sales[_0x796b2b(0x1ee)]({}),_0x2e2123=_0x2b38d7[_0x796b2b(0x1d5)]+0x1,_0x2b4476=_0x796b2b(0x18c)+_0x2e2123[_0x796b2b(0x241)]()['padStart'](0x5,'0');if(_0x127002[0x0]['language']==_0x796b2b(0x213)){var _0x4f650c=users[_0x796b2b(0x20a)];console[_0x796b2b(0x17a)](_0x4f650c);}else{if(_0x127002[0x0][_0x796b2b(0x159)]==_0x796b2b(0x189))var _0x4f650c=users[_0x796b2b(0x189)];else{if(_0x127002[0x0]['language']=='German')var _0x4f650c=users[_0x796b2b(0x1b5)];else{if(_0x127002[0x0][_0x796b2b(0x159)]==_0x796b2b(0x193))var _0x4f650c=users[_0x796b2b(0x193)];else{if(_0x127002[0x0]['language']=='French')var _0x4f650c=users['French'];else{if(_0x127002[0x0][_0x796b2b(0x159)]==_0x796b2b(0x247))var _0x4f650c=users[_0x796b2b(0x1a4)];else{if(_0x127002[0x0][_0x796b2b(0x159)]==_0x796b2b(0x24b))var _0x4f650c=users[_0x796b2b(0x24b)];else{if(_0x127002[0x0]['language']=='Arabic\x20(ae)')var _0x4f650c=users['Arabic'];}}}}}}}const _0x2cf7b1=getRandom8DigitNumber();_0x2cf7b1['then'](_0x483e2c=>{var _0x587370=_0x796b2b;_0x192e55[_0x587370(0x221)](_0x587370(0x24f),{'success':_0x1219d6[_0x587370(0x1b7)]('success'),'errors':_0x1219d6[_0x587370(0x1b7)](_0x587370(0x23d)),'role':_0x1c5779,'profile':_0x3b25cf,'customer':_0x581efc,'warehouse':_0x4dce46,'product':_0x1b08bc,'invoice':_0x483e2c,'master_shop':_0x127002,'language':_0x4f650c,'rooms_data':_0x2d4766});})[_0x796b2b(0x255)](_0x1a141a=>{var _0x39c713=_0x796b2b;_0x1219d6[_0x39c713(0x1b7)]('errors',_0x39c713(0x1e1)),_0x192e55[_0x39c713(0x220)](_0x39c713(0x15b));});}catch(_0x374211){console[_0x796b2b(0x17a)](_0x374211);}}),router[a0_0x13d0cc(0x222)](a0_0x13d0cc(0x1f8),auth,async(_0x2ceb0b,_0x4aef60)=>{var _0x1a2e29=a0_0x13d0cc;try{const _0x578667=_0x2ceb0b[_0x1a2e29(0x156)]['id'];console[_0x1a2e29(0x17a)](_0x578667);const _0x452714=await product[_0x1a2e29(0x1ee)](),_0x228026=await purchases[_0x1a2e29(0x236)]([{'$match':{'warehouse_name':_0x578667}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x1a2e29(0x17a)]('purchases_data',_0x228026),_0x4aef60[_0x1a2e29(0x1e0)](0xc8)[_0x1a2e29(0x1f0)]({'purchases_data':_0x228026,'product_data':_0x452714});}catch(_0x38633e){console[_0x1a2e29(0x17a)](_0x38633e);}}),router[a0_0x13d0cc(0x1fe)](a0_0x13d0cc(0x166),auth,async(_0x1119bc,_0x40ddc8)=>{var _0x4490c3=a0_0x13d0cc;try{const {warehouse_data:_0x2fabf1,product_data:_0x1a3c0b}=_0x1119bc[_0x4490c3(0x1b6)];console[_0x4490c3(0x17a)](_0x1119bc[_0x4490c3(0x1b6)]['product_data']);;const _0x1f0ba1=await master_shop[_0x4490c3(0x1ee)]();console['log'](_0x4490c3(0x1fd),_0x1f0ba1);const _0x19bdbc=await product['findOne']({'name':_0x1a3c0b});console[_0x4490c3(0x17a)](_0x4490c3(0x1c2),_0x19bdbc);const _0x40a5b8=await warehouse[_0x4490c3(0x236)]([{'$match':{'name':_0x2fabf1}},{'$unwind':_0x4490c3(0x1e3)},{'$match':{'product_details.product_name':_0x1a3c0b}},{'$group':{'_id':_0x4490c3(0x1a1),'product_stock':{'$first':_0x4490c3(0x154)}}}]);console['log'](_0x4490c3(0x237),_0x40a5b8),_0x40ddc8[_0x4490c3(0x1e0)](0xc8)['json']({'master':_0x1f0ba1,'new_product':_0x19bdbc,'stock_data':_0x40a5b8});}catch(_0x228208){console['log'](_0x228208);}}),router[a0_0x13d0cc(0x1fe)](a0_0x13d0cc(0x217),auth,async(_0x1ad471,_0x5233e5)=>{var _0x51d67b=a0_0x13d0cc;try{const {invoice:_0x55e2a0,date:_0xbca512,warehouse_name:_0x11b441,product_name:_0x72f8fe,stock:_0x161d62,quantity:_0x9ef446,note:_0x545d0a,room:_0x1c8974,primary_code:_0x480750,secondary_code:_0x45f51d,prod_code:_0x52a182,level:_0x1aea29,isle:_0x39a74b,pallet:_0x1d7987,batch_code:_0x4bfc00,SCRN:_0x14da04,expiry_date:_0x4f7d30}=_0x1ad471['body'];if(typeof _0x72f8fe==_0x51d67b(0x1b0))var _0x3bf632=[_0x1ad471[_0x51d67b(0x1b6)]['product_name']],_0x284171=[_0x1ad471[_0x51d67b(0x1b6)]['stock']],_0x224d4b=[_0x1ad471[_0x51d67b(0x1b6)]['carton']],_0x59711e=[_0x1ad471['body']['primary_code']],_0x5e7b9f=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x175)]],_0x17d076=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x1ea)]],_0x51de1b=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x1b3)]],_0x274498=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x186)]],_0x1b135c=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x248)]],_0x2ff9d5=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x14f)]],_0x216ac0=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x1e2)]],_0x5da942=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x1eb)]],_0x2f7bf9=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x20b)]],_0x51f3c5=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x225)]],_0x37a27e=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x210)]],_0x5b4982=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x20e)]],_0x5a89c8=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x1be)]],_0x1b8759=[_0x1ad471[_0x51d67b(0x1b6)]['quantity']],_0x79a7f9=[_0x1ad471['body'][_0x51d67b(0x158)]],_0x2b5bcc=[_0x1ad471['body']['prod_invoice']],_0x2f25d5=[_0x1ad471[_0x51d67b(0x1b6)]['actual_qty']],_0x134a71=[_0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x188)]];else var _0x3bf632=[..._0x1ad471[_0x51d67b(0x1b6)]['product_name']],_0x284171=[..._0x1ad471['body']['stock']],_0x224d4b=[..._0x1ad471[_0x51d67b(0x1b6)]['carton']],_0x59711e=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x207)]],_0x5e7b9f=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x175)]],_0x17d076=[..._0x1ad471[_0x51d67b(0x1b6)]['prod_code']],_0x51de1b=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x1b3)]],_0x274498=[..._0x1ad471[_0x51d67b(0x1b6)]['primary_unit']],_0x1b135c=[..._0x1ad471[_0x51d67b(0x1b6)]['secondary_unit']],_0x2ff9d5=[..._0x1ad471['body'][_0x51d67b(0x14f)]],_0x216ac0=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x1e2)]],_0x5da942=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x1eb)]],_0x2f7bf9=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x20b)]],_0x51f3c5=[..._0x1ad471[_0x51d67b(0x1b6)]['requested_qty']],_0x37a27e=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x210)]],_0x5b4982=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x20e)]],_0x5a89c8=[..._0x1ad471[_0x51d67b(0x1b6)]['prod_cat']],_0x1b8759=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x208)]],_0x79a7f9=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x158)]],_0x2b5bcc=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x191)]],_0x2f25d5=[..._0x1ad471[_0x51d67b(0x1b6)]['actual_qty']],_0x134a71=[..._0x1ad471[_0x51d67b(0x1b6)][_0x51d67b(0x188)]];const _0x1ab13c=_0x3bf632['map'](_0x1b6680=>{return _0x1b6680={'product_name':_0x1b6680};});_0x284171['forEach']((_0x470b99,_0x36e547)=>{var _0x460eca=_0x51d67b;_0x1ab13c[_0x36e547][_0x460eca(0x1ef)]=Math[_0x460eca(0x21f)](_0x470b99);}),_0x2f25d5[_0x51d67b(0x196)]((_0x1fb704,_0x50b8d4)=>{var _0x1bf81a=_0x51d67b;_0x1ab13c[_0x50b8d4][_0x1bf81a(0x202)]=Math[_0x1bf81a(0x21f)](_0x1fb704);}),_0x134a71[_0x51d67b(0x196)]((_0x31ca65,_0x8bd5c2)=>{var _0x5208d4=_0x51d67b;_0x1ab13c[_0x8bd5c2][_0x5208d4(0x188)]=_0x31ca65;}),_0x224d4b[_0x51d67b(0x196)]((_0x3efe91,_0x4e153c)=>{_0x1ab13c[_0x4e153c]['quantity']=_0x3efe91;}),_0x59711e['forEach']((_0x12b51f,_0x4974b1)=>{var _0x7598f5=_0x51d67b;_0x1ab13c[_0x4974b1][_0x7598f5(0x207)]=_0x12b51f;}),_0x5e7b9f[_0x51d67b(0x196)]((_0x4c77b9,_0xaf3fdc)=>{var _0x564e00=_0x51d67b;_0x1ab13c[_0xaf3fdc][_0x564e00(0x175)]=_0x4c77b9;}),_0x17d076[_0x51d67b(0x196)]((_0x59046d,_0x205bd7)=>{var _0x5c0e27=_0x51d67b;_0x1ab13c[_0x205bd7][_0x5c0e27(0x23a)]=_0x59046d;}),_0x51de1b['forEach']((_0x83ce3a,_0x1bc91d)=>{var _0x34fd80=_0x51d67b;_0x79a7f9[_0x34fd80(0x196)]((_0x1297d3,_0x1bde94)=>{var _0x33ec63=_0x34fd80;if(_0x1297d3=='Receiving\x20Area'&&_0x1bc91d==_0x1bde94){var _0x416d7b=_0x83ce3a[_0x33ec63(0x1bc)](0x3);_0x1ab13c[_0x1bc91d][_0x33ec63(0x1e6)]=_0x83ce3a[0x0],_0x1ab13c[_0x1bc91d]['rack']=_0x83ce3a[0x1],_0x1ab13c[_0x1bc91d][_0x33ec63(0x1ce)]=0x0,_0x1ab13c[_0x1bc91d]['bin']=0x0,_0x1ab13c[_0x1bc91d]['type']=_0x33ec63(0x1c5),_0x1ab13c[_0x1bc91d]['floorlevel']=_0x416d7b;}else{if(_0x1297d3==_0x33ec63(0x212)&&_0x1bc91d==_0x1bde94){var _0x416d7b=_0x83ce3a[_0x33ec63(0x1bc)](0x3);_0x1ab13c[_0x1bc91d][_0x33ec63(0x1e6)]=_0x83ce3a[0x0],_0x1ab13c[_0x1bc91d][_0x33ec63(0x157)]=_0x83ce3a[0x1],_0x1ab13c[_0x1bc91d][_0x33ec63(0x1ce)]=0x0,_0x1ab13c[_0x1bc91d][_0x33ec63(0x204)]=0x0,_0x1ab13c[_0x1bc91d][_0x33ec63(0x18d)]=_0x33ec63(0x1c5),_0x1ab13c[_0x1bc91d][_0x33ec63(0x1b2)]=_0x83ce3a[0x5];}else{if(_0x1bc91d==_0x1bde94){var _0x5eef43;if(_0x83ce3a[0x4]=='L')_0x5eef43=_0x33ec63(0x242);else _0x83ce3a[0x4]=='F'&&(_0x5eef43='Floor');_0x1ab13c[_0x1bc91d][_0x33ec63(0x1e6)]=_0x83ce3a[0x0],_0x1ab13c[_0x1bc91d][_0x33ec63(0x157)]=_0x83ce3a[0x1],_0x1ab13c[_0x1bc91d][_0x33ec63(0x1ce)]=_0x83ce3a[0x2],_0x1ab13c[_0x1bc91d]['bin']=_0x83ce3a[0x3],_0x1ab13c[_0x1bc91d][_0x33ec63(0x18d)]=_0x5eef43,_0x1ab13c[_0x1bc91d]['floorlevel']=_0x83ce3a[0x5];}}}});}),_0x274498[_0x51d67b(0x196)]((_0x2f6136,_0x5ee490)=>{var _0x3c8335=_0x51d67b;_0x1ab13c[_0x5ee490][_0x3c8335(0x1a8)]=_0x2f6136;}),_0x1b135c[_0x51d67b(0x196)]((_0x375b78,_0x1b9e86)=>{_0x1ab13c[_0x1b9e86]['secondary_unit']=_0x375b78;}),_0x2ff9d5[_0x51d67b(0x196)]((_0x4c571f,_0x21493e)=>{var _0x309d9e=_0x51d67b;_0x1ab13c[_0x21493e][_0x309d9e(0x14f)]=_0x4c571f;}),_0x216ac0[_0x51d67b(0x196)]((_0x20be97,_0x453f45)=>{var _0x3ba7cb=_0x51d67b;_0x1ab13c[_0x453f45][_0x3ba7cb(0x1e2)]=_0x20be97;}),_0x5da942[_0x51d67b(0x196)]((_0x303953,_0x2400ba)=>{var _0x8932c3=_0x51d67b;_0x1ab13c[_0x2400ba][_0x8932c3(0x17d)]=_0x303953;}),_0x2f7bf9['forEach']((_0x1acdb7,_0x7ef01d)=>{var _0x369437=_0x51d67b;_0x1ab13c[_0x7ef01d][_0x369437(0x20b)]=_0x1acdb7;}),_0x51f3c5[_0x51d67b(0x196)]((_0x5881ff,_0x19b7db)=>{_0x1ab13c[_0x19b7db]['requested_qty']=_0x5881ff;}),_0x37a27e['forEach']((_0x5bb1a5,_0x4ea534)=>{var _0xc3d529=_0x51d67b;_0x1ab13c[_0x4ea534][_0xc3d529(0x210)]=_0x5bb1a5;}),_0x5b4982['forEach']((_0x2059ab,_0x1443f4)=>{var _0x3e5976=_0x51d67b;_0x1ab13c[_0x1443f4][_0x3e5976(0x20e)]=_0x2059ab;}),_0x5a89c8[_0x51d67b(0x196)]((_0x5d1c03,_0x5dfd8d)=>{var _0x49e25e=_0x51d67b;_0x1ab13c[_0x5dfd8d][_0x49e25e(0x1be)]=_0x5d1c03;}),_0x1b8759['forEach']((_0x2d85c5,_0x2eb2c1)=>{var _0x258350=_0x51d67b;_0x1ab13c[_0x2eb2c1][_0x258350(0x1f1)]=_0x2d85c5;}),_0x79a7f9[_0x51d67b(0x196)]((_0x22a6f9,_0x2e2fbd)=>{_0x1ab13c[_0x2e2fbd]['room_name']=_0x22a6f9;}),_0x2b5bcc[_0x51d67b(0x196)]((_0x121b95,_0x309f9b)=>{_0x1ab13c[_0x309f9b]['invoice']=_0x121b95;});var _0x4c03a0=0x0;_0x1ab13c[_0x51d67b(0x196)](_0xc700c9=>{var _0x1693ad=_0x51d67b;(_0xc700c9['stock']<_0xc700c9[_0x1693ad(0x1f1)]||_0xc700c9[_0x1693ad(0x1f1)]==0x0)&&(console[_0x1693ad(0x17a)](_0x1693ad(0x194),_0xc700c9),_0x4c03a0++);});const _0x421b26=_0x1ab13c[_0x51d67b(0x1a7)](_0x339186=>_0x339186[_0x51d67b(0x208)]!=='0'&&_0x339186[_0x51d67b(0x208)]!==''),_0x20ff0c=new sales({'invoice':_0x55e2a0,'customer':_0x1ad471['body'][_0x51d67b(0x245)],'date':_0xbca512,'warehouse_name':_0x11b441,'sale_product':_0x421b26,'note':_0x545d0a,'room':_0x1c8974,'primary_code':_0x480750,'secondary_code':_0x45f51d,'prod_code':_0x52a182,'SCRN':_0x14da04}),_0x4da14c=await _0x20ff0c[_0x51d67b(0x1f2)]();_0x1ad471[_0x51d67b(0x1b7)](_0x51d67b(0x24a),_0x51d67b(0x251)),_0x5233e5[_0x51d67b(0x220)](_0x51d67b(0x246)+_0x4da14c[_0x51d67b(0x18a)]);}catch(_0x14724b){console[_0x51d67b(0x17a)](_0x14724b);}}),router['get'](a0_0x13d0cc(0x183),auth,async(_0x233116,_0x20462a)=>{var _0x50c3dd=a0_0x13d0cc;try{const {username:_0x417f39,email:_0x5eaf42,role:_0x131cb8}=_0x233116[_0x50c3dd(0x223)],_0xb199ac=_0x233116[_0x50c3dd(0x223)],_0x42fd3d=await profile[_0x50c3dd(0x17c)]({'email':_0xb199ac[_0x50c3dd(0x1bb)]}),_0x1b9ecd=await master_shop[_0x50c3dd(0x1ee)](),_0x6eb222=_0x233116[_0x50c3dd(0x156)]['id'],_0x417180=await sales['findById'](_0x6eb222),_0xda79b3=await warehouse['aggregate']([{'$match':{'name':_0x417180['warehouse_name']}},{'$unwind':_0x50c3dd(0x1e3)},{'$group':{'_id':_0x50c3dd(0x1da),'name':{'$first':_0x50c3dd(0x1a1)},'product_stock':{'$first':_0x50c3dd(0x154)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x50c3dd(0x170)},'type':{'$first':_0x50c3dd(0x1c8)},'floorlevel':{'$first':_0x50c3dd(0x160)},'primary_code':{'$first':_0x50c3dd(0x21e)},'secondary_code':{'$first':_0x50c3dd(0x243)},'product_code':{'$first':_0x50c3dd(0x218)},'storage':{'$first':_0x50c3dd(0x171)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x50c3dd(0x176)}}}]),_0x3726f5=await customer[_0x50c3dd(0x1ee)]({});let _0x96f2bd;if(_0xb199ac['role']==_0x50c3dd(0x1ca)){const _0x73c85b=await staff[_0x50c3dd(0x17c)]({'email':_0xb199ac[_0x50c3dd(0x1bb)]});_0x96f2bd=await warehouse['aggregate']([{'$match':{'status':_0x50c3dd(0x199),'name':_0x73c85b['warehouse']}},{'$group':{'_id':_0x50c3dd(0x1ed),'name':{'$first':_0x50c3dd(0x1ed)}}}]);}else _0x96f2bd=await warehouse['aggregate']([{'$match':{'status':_0x50c3dd(0x199)}},{'$group':{'_id':_0x50c3dd(0x1ed),'name':{'$first':_0x50c3dd(0x1ed)}}}]);const _0x1db4eb=await product['find']({}),_0x21db2b=await suppliers[_0x50c3dd(0x1ee)]({});if(_0x1b9ecd[0x0][_0x50c3dd(0x159)]==_0x50c3dd(0x213)){var _0x1858ca=users[_0x50c3dd(0x20a)];console[_0x50c3dd(0x17a)](_0x1858ca);}else{if(_0x1b9ecd[0x0][_0x50c3dd(0x159)]==_0x50c3dd(0x189))var _0x1858ca=users['Hindi'];else{if(_0x1b9ecd[0x0][_0x50c3dd(0x159)]==_0x50c3dd(0x1b5))var _0x1858ca=users[_0x50c3dd(0x1b5)];else{if(_0x1b9ecd[0x0][_0x50c3dd(0x159)]==_0x50c3dd(0x193))var _0x1858ca=users['Spanish'];else{if(_0x1b9ecd[0x0][_0x50c3dd(0x159)]=='French')var _0x1858ca=users['French'];else{if(_0x1b9ecd[0x0][_0x50c3dd(0x159)]==_0x50c3dd(0x247))var _0x1858ca=users[_0x50c3dd(0x1a4)];else{if(_0x1b9ecd[0x0][_0x50c3dd(0x159)]=='Chinese')var _0x1858ca=users[_0x50c3dd(0x24b)];else{if(_0x1b9ecd[0x0][_0x50c3dd(0x159)]==_0x50c3dd(0x23e))var _0x1858ca=users[_0x50c3dd(0x177)];}}}}}}}_0x20462a[_0x50c3dd(0x221)](_0x50c3dd(0x1d2),{'success':_0x233116[_0x50c3dd(0x1b7)](_0x50c3dd(0x24a)),'errors':_0x233116[_0x50c3dd(0x1b7)](_0x50c3dd(0x23d)),'role':_0xb199ac,'profile':_0x42fd3d,'customer':_0x3726f5,'warehouse':_0x96f2bd,'product':_0xda79b3,'user':_0x417180,'master_shop':_0x1b9ecd,'unit':_0x1db4eb,'language':_0x1858ca,'suppliers':_0x21db2b});}catch(_0x4815aa){console[_0x50c3dd(0x17a)](_0x4815aa);}}),router[a0_0x13d0cc(0x1fe)](a0_0x13d0cc(0x183),auth,async(_0xd0ec5c,_0x17f7eb)=>{var _0x3300b3=a0_0x13d0cc;try{const _0x3f7937=_0xd0ec5c[_0x3300b3(0x156)]['id'],{invoice:_0x516e0c,warehouse_name:_0x56930b,room:_0x2737cb}=_0xd0ec5c['body'],_0x403a04=await sales[_0x3300b3(0x17c)]({'invoice':_0x516e0c}),_0x304382=_0x403a04['sale_product'][_0x3300b3(0x1fa)](async _0x1e75fb=>{var _0x3bdebe=_0x3300b3,_0x165e4a=await warehouse['findOne']({'name':_0x56930b,'room':_0x1e75fb[_0x3bdebe(0x21d)],'warehouse_category':_0x3bdebe(0x240)});const _0xe74cd9=_0x165e4a[_0x3bdebe(0x17e)][_0x3bdebe(0x1fa)](_0x484241=>{var _0x4dca20=_0x3bdebe;_0x484241[_0x4dca20(0x182)]==_0x1e75fb[_0x4dca20(0x182)]&&_0x484241['floorlevel']==_0x1e75fb[_0x4dca20(0x1b2)]&&_0x484241[_0x4dca20(0x18d)]==_0x1e75fb[_0x4dca20(0x18d)]&&_0x484241[_0x4dca20(0x204)]==_0x1e75fb[_0x4dca20(0x204)]&&_0x484241[_0x4dca20(0x1ce)]==_0x1e75fb[_0x4dca20(0x1ce)]&&_0x484241['rack']==_0x1e75fb['rack']&&_0x484241[_0x4dca20(0x1e6)]==_0x1e75fb['storage']&&_0x484241[_0x4dca20(0x1e2)]==_0x1e75fb[_0x4dca20(0x1e2)]&&_0x484241[_0x4dca20(0x14f)]==_0x1e75fb[_0x4dca20(0x14f)]&&_0x484241[_0x4dca20(0x1aa)]==_0x1e75fb['invoice']&&(_0x484241['product_stock']=Math[_0x4dca20(0x21f)](_0x484241[_0x4dca20(0x1dc)])-Math['abs'](_0x1e75fb[_0x4dca20(0x208)]));});return _0x165e4a;});Promise[_0x3300b3(0x18f)](_0x304382)[_0x3300b3(0x224)](async _0xe68450=>{var _0x1e2748=_0x3300b3;try{for(const _0x11b0ff of _0xe68450){await _0x11b0ff[_0x1e2748(0x1f2)]();}_0x403a04[_0x1e2748(0x190)]=_0x1e2748(0x252);const _0xa13da6=await _0x403a04[_0x1e2748(0x1f2)](),_0x4cdbb7=await master_shop[_0x1e2748(0x1ee)](),_0x53f4bc=await email_settings[_0x1e2748(0x17c)](),_0x3c5230=await supervisor_settings[_0x1e2748(0x1ee)]();var _0x3f0f15=_0x403a04['sale_product'],_0x202243='',_0x4ef1f9;for(_0x4ef1f9 in _0x3f0f15){_0x202243+=_0x1e2748(0x235)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3f0f15[_0x4ef1f9][_0x1e2748(0x182)]+_0x1e2748(0x256)+_0x1e2748(0x22b)+_0x3f0f15[_0x4ef1f9][_0x1e2748(0x23a)]+_0x1e2748(0x256)+_0x1e2748(0x22b)+_0x3f0f15[_0x4ef1f9]['quantity']+_0x1e2748(0x256)+_0x1e2748(0x22b)+_0x3f0f15[_0x4ef1f9][_0x1e2748(0x1a8)]+'</td>'+_0x1e2748(0x22b)+_0x3f0f15[_0x4ef1f9]['secondary_unit']+_0x1e2748(0x256)+_0x1e2748(0x22b)+_0x403a04[_0x1e2748(0x16b)]+_0x1e2748(0x256)+_0x1e2748(0x22b)+_0x3f0f15[_0x4ef1f9][_0x1e2748(0x21d)]+_0x1e2748(0x256)+_0x1e2748(0x22b)+_0x3f0f15[_0x4ef1f9]['storage']+_0x3f0f15[_0x4ef1f9]['rack']+_0x3f0f15[_0x4ef1f9][_0x1e2748(0x1ce)]+_0x3f0f15[_0x4ef1f9][_0x1e2748(0x204)]+_0x3f0f15[_0x4ef1f9][_0x1e2748(0x18d)][0x0]+_0x3f0f15[_0x4ef1f9][_0x1e2748(0x1b2)]+_0x1e2748(0x256),_0x1e2748(0x23f);}let _0x543dc2=nodemailer['createTransport']({'host':_0x53f4bc[_0x1e2748(0x1c6)],'port':Number(_0x53f4bc['port']),'secure':![],'auth':{'user':_0x53f4bc[_0x1e2748(0x1bb)],'pass':_0x53f4bc['password']}}),_0x505967={'from':_0x53f4bc['email'],'to':_0x3c5230[0x0]['RMSEmail'],'subject':'Sales\x20Mail','attachments':[{'filename':_0x1e2748(0x1f5),'path':__dirname+'/../public'+_0x1e2748(0x1d9)+_0x4cdbb7[0x0][_0x1e2748(0x21b)],'cid':_0x1e2748(0x1cd)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x1e2748(0x257)+_0x1e2748(0x228)+_0x1e2748(0x1e4)+_0x1e2748(0x228)+_0x1e2748(0x215)+_0x1e2748(0x195)+'<div>'+'<h2>\x20'+_0x4cdbb7[0x0][_0x1e2748(0x15f)]+_0x1e2748(0x169)+_0x1e2748(0x195)+_0x1e2748(0x195)+_0x1e2748(0x23c)+_0x1e2748(0x228)+_0x1e2748(0x1f4)+_0x1e2748(0x1f9)+_0x403a04[_0x1e2748(0x1aa)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x403a04[_0x1e2748(0x232)]+'\x20'+_0x1e2748(0x181)+_0x1e2748(0x151)+_0x1e2748(0x195)+_0x1e2748(0x15d)+_0x1e2748(0x1a5)+_0x1e2748(0x235)+_0x1e2748(0x1e9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x1e2748(0x172)+_0x1e2748(0x227)+_0x1e2748(0x20d)+_0x1e2748(0x24c)+_0x1e2748(0x226)+_0x1e2748(0x1dd)+'</tr>'+_0x1e2748(0x153)+_0x1e2748(0x23b)+'\x20'+_0x202243+'\x20'+'</tbody>'+_0x1e2748(0x184)+_0x1e2748(0x228)+_0x1e2748(0x19a)+'<h5>'+_0x4cdbb7[0x0]['site_title']+_0x1e2748(0x151)+_0x1e2748(0x195)+'</div>'+_0x1e2748(0x15c)};_0x543dc2[_0x1e2748(0x1bf)](_0x505967,function(_0x3cf062,_0x5c7ce7){var _0x567ced=_0x1e2748;_0x3cf062?(console[_0x567ced(0x17a)](_0x3cf062),console[_0x567ced(0x17a)]('Error\x20Occurs')):console[_0x567ced(0x17a)]('Email\x20sent\x20successfully');}),_0xd0ec5c[_0x1e2748(0x1b7)](_0x1e2748(0x24a),'Sales\x20Update\x20successfully'),_0x17f7eb[_0x1e2748(0x220)]('/all_sales/preview/'+_0x3f7937);}catch(_0x5d1d98){console[_0x1e2748(0x14d)](_0x5d1d98),_0x17f7eb[_0x1e2748(0x1e0)](0x1f4)[_0x1e2748(0x1f0)]({'error':_0x1e2748(0x1fb)});}})[_0x3300b3(0x255)](_0x547b06=>{var _0x2a1e34=_0x3300b3;console[_0x2a1e34(0x14d)](_0x547b06),_0x17f7eb[_0x2a1e34(0x1e0)](0x1f4)[_0x2a1e34(0x1f0)]({'error':'An\x20error\x20occurred.'});});}catch(_0x3a5c2a){console[_0x3300b3(0x17a)](_0x3a5c2a);}}),router[a0_0x13d0cc(0x222)](a0_0x13d0cc(0x209),auth,async(_0x3b4a80,_0x55546b)=>{var _0x15a2f2=a0_0x13d0cc;try{const {username:_0x2e0a41,email:_0x2e18c2,role:_0x513b0d}=_0x3b4a80[_0x15a2f2(0x223)],_0x55138b=_0x3b4a80[_0x15a2f2(0x223)],_0x28d476=await profile[_0x15a2f2(0x17c)]({'email':_0x55138b[_0x15a2f2(0x1bb)]}),_0x1680c2=await master_shop['find'](),_0x116d20=_0x3b4a80['params']['id'],_0x4998b5=await sales['findById'](_0x116d20);var _0x2fef3f=['Ambient',_0x15a2f2(0x1cb)];const _0x40f725=await warehouse[_0x15a2f2(0x236)]([{'$match':{'name':_0x4998b5['warehouse_name'],'warehouse_category':_0x15a2f2(0x240)}},{'$unwind':_0x15a2f2(0x1e3)},{'$group':{'_id':_0x15a2f2(0x1da),'name':{'$first':_0x15a2f2(0x1a1)},'product_stock':{'$first':_0x15a2f2(0x154)},'bay':{'$first':_0x15a2f2(0x173)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x15a2f2(0x1c8)},'floorlevel':{'$first':_0x15a2f2(0x160)},'primary_code':{'$first':_0x15a2f2(0x21e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x15a2f2(0x218)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x15a2f2(0x21a)}}}]),_0x54a60e=await customer[_0x15a2f2(0x1ee)]({});let _0x1ec023;if(_0x55138b['role']=='staff'){const _0x4708a9=await staff['findOne']({'email':_0x55138b[_0x15a2f2(0x1bb)]});_0x1ec023=await warehouse[_0x15a2f2(0x236)]([{'$match':{'status':'Enabled','name':_0x4708a9[_0x15a2f2(0x152)],'warehouse_category':_0x15a2f2(0x240)}},{'$group':{'_id':_0x15a2f2(0x1ed),'name':{'$first':'$name'}}}]);}else _0x1ec023=await warehouse[_0x15a2f2(0x236)]([{'$match':{'status':'Enabled','warehouse_category':_0x15a2f2(0x240)}},{'$group':{'_id':'$name','name':{'$first':_0x15a2f2(0x1ed)}}}]);const _0x45539c=await product['find']({});if(_0x1680c2[0x0][_0x15a2f2(0x159)]==_0x15a2f2(0x213)){var _0x359532=users[_0x15a2f2(0x20a)];console[_0x15a2f2(0x17a)](_0x359532);}else{if(_0x1680c2[0x0][_0x15a2f2(0x159)]=='Hindi')var _0x359532=users[_0x15a2f2(0x189)];else{if(_0x1680c2[0x0][_0x15a2f2(0x159)]==_0x15a2f2(0x1b5))var _0x359532=users[_0x15a2f2(0x1b5)];else{if(_0x1680c2[0x0][_0x15a2f2(0x159)]=='Spanish')var _0x359532=users['Spanish'];else{if(_0x1680c2[0x0]['language']==_0x15a2f2(0x185))var _0x359532=users[_0x15a2f2(0x185)];else{if(_0x1680c2[0x0][_0x15a2f2(0x159)]==_0x15a2f2(0x247))var _0x359532=users[_0x15a2f2(0x1a4)];else{if(_0x1680c2[0x0][_0x15a2f2(0x159)]=='Chinese')var _0x359532=users[_0x15a2f2(0x24b)];else{if(_0x1680c2[0x0]['language']==_0x15a2f2(0x23e))var _0x359532=users[_0x15a2f2(0x177)];}}}}}}}_0x55546b[_0x15a2f2(0x221)](_0x15a2f2(0x18b),{'success':_0x3b4a80['flash'](_0x15a2f2(0x24a)),'errors':_0x3b4a80['flash'](_0x15a2f2(0x23d)),'role':_0x55138b,'profile':_0x28d476,'customer':_0x54a60e,'warehouse':_0x1ec023,'product':_0x40f725,'user':_0x4998b5,'master_shop':_0x1680c2,'unit':_0x45539c,'language':_0x359532});}catch(_0x4cd71d){console[_0x15a2f2(0x17a)](_0x4cd71d);}}),router[a0_0x13d0cc(0x1fe)](a0_0x13d0cc(0x209),auth,async(_0x95596d,_0x2dcdc9)=>{var _0xbb39d1=a0_0x13d0cc;try{const _0x229dab=_0x95596d[_0xbb39d1(0x156)]['id'],_0x2a90e5=await sales[_0xbb39d1(0x17c)]({'_id':_0x95596d['params']['id']}),_0x2364f1=await warehouse[_0xbb39d1(0x17c)]({'name':_0x2a90e5['warehouse_name'],'room':_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x16c)]}),{invoice:_0x1cf5e4,date:_0x493285,warehouse_name:_0x45d7fe,product_name:_0x471cd6,stock:_0x2d7f0b,quantity:_0x1fec40,note:_0x398dd9,room:_0x5cdfce,customer:_0x59a282,SCRN:_0x934213}=_0x95596d[_0xbb39d1(0x1b6)];if(typeof _0x471cd6==_0xbb39d1(0x1b0))var _0x4a455f=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x182)]],_0x24471a=[_0x95596d['body'][_0xbb39d1(0x1ef)]],_0xbf8cae=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x22f)]],_0x15472e=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x207)]],_0x502491=[_0x95596d['body'][_0xbb39d1(0x175)]],_0x1ae97b=[_0x95596d['body'][_0xbb39d1(0x1ea)]],_0x56a0bb=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x1b3)]],_0x59a002=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x186)]],_0x53ae79=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x248)]],_0x261eab=[_0x95596d['body'][_0xbb39d1(0x14f)]],_0x58ebcf=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x1e2)]],_0xd812a9=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x1eb)]],_0x3f6ff6=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x20b)]],_0x28eb46=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x225)]],_0xf4d436=[_0x95596d[_0xbb39d1(0x1b6)]['delivery_date']],_0x2cb3fa=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x20e)]],_0x55f41f=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x1be)]],_0x324d04=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x208)]],_0x333768=[_0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x158)]];else var _0x4a455f=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x182)]],_0x24471a=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x1ef)]],_0xbf8cae=[..._0x95596d['body'][_0xbb39d1(0x22f)]],_0x15472e=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x207)]],_0x502491=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x175)]],_0x1ae97b=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x1ea)]],_0x56a0bb=[..._0x95596d['body'][_0xbb39d1(0x1b3)]],_0x59a002=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x186)]],_0x53ae79=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x248)]],_0x261eab=[..._0x95596d['body'][_0xbb39d1(0x14f)]],_0x58ebcf=[..._0x95596d[_0xbb39d1(0x1b6)]['expiry_date']],_0xd812a9=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x1eb)]],_0x3f6ff6=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x20b)]],_0x28eb46=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x225)]],_0xf4d436=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x210)]],_0x2cb3fa=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x20e)]],_0x55f41f=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x1be)]],_0x324d04=[..._0x95596d[_0xbb39d1(0x1b6)][_0xbb39d1(0x208)]],_0x333768=[..._0x95596d['body'][_0xbb39d1(0x158)]];const _0x51b3e3=_0x4a455f['map'](_0x542a58=>{return _0x542a58={'product_name':_0x542a58};});_0x24471a['forEach']((_0x32769b,_0x3e3582)=>{var _0x136183=_0xbb39d1;_0x51b3e3[_0x3e3582][_0x136183(0x1ef)]=Math['abs'](_0x32769b);}),_0xbf8cae[_0xbb39d1(0x196)]((_0x45838d,_0x52082e)=>{_0x51b3e3[_0x52082e]['quantity']=_0x45838d;}),_0x15472e[_0xbb39d1(0x196)]((_0x1377a3,_0x444f21)=>{var _0xa1aaab=_0xbb39d1;_0x51b3e3[_0x444f21][_0xa1aaab(0x207)]=_0x1377a3;}),_0x502491[_0xbb39d1(0x196)]((_0x13c745,_0x57bfa7)=>{var _0x4a8ba9=_0xbb39d1;_0x51b3e3[_0x57bfa7][_0x4a8ba9(0x175)]=_0x13c745;}),_0x1ae97b[_0xbb39d1(0x196)]((_0x3f289b,_0x2c0366)=>{var _0xa45787=_0xbb39d1;_0x51b3e3[_0x2c0366][_0xa45787(0x23a)]=_0x3f289b;}),_0x56a0bb['forEach']((_0x364fe4,_0x44425e)=>{var _0x1e3d58=_0xbb39d1;_0x333768[_0x1e3d58(0x196)]((_0x35fd62,_0xb38511)=>{var _0x5a06a4=_0x1e3d58;if(_0x35fd62==_0x5a06a4(0x162)&&_0x44425e==_0xb38511){var _0x499cba=_0x364fe4[_0x5a06a4(0x1bc)](0x3);_0x51b3e3[_0x44425e]['storage']=_0x364fe4[0x0],_0x51b3e3[_0x44425e][_0x5a06a4(0x157)]=_0x364fe4[0x1],_0x51b3e3[_0x44425e][_0x5a06a4(0x1ce)]=0x0,_0x51b3e3[_0x44425e][_0x5a06a4(0x204)]=0x0,_0x51b3e3[_0x44425e][_0x5a06a4(0x18d)]=_0x5a06a4(0x1c5),_0x51b3e3[_0x44425e][_0x5a06a4(0x1b2)]=_0x499cba;}else{if(_0x35fd62==_0x5a06a4(0x212)&&_0x44425e==_0xb38511){var _0x499cba=_0x364fe4['slice'](0x3);_0x51b3e3[_0x44425e]['storage']=_0x364fe4[0x0],_0x51b3e3[_0x44425e]['rack']=_0x364fe4[0x1],_0x51b3e3[_0x44425e]['bay']=0x0,_0x51b3e3[_0x44425e][_0x5a06a4(0x204)]=0x0,_0x51b3e3[_0x44425e]['type']=_0x5a06a4(0x1c5),_0x51b3e3[_0x44425e][_0x5a06a4(0x1b2)]=_0x364fe4[0x5];}else{if(_0x44425e==_0xb38511){var _0xec1b25;if(_0x364fe4[0x4]=='L')_0xec1b25='Level';else _0x364fe4[0x4]=='F'&&(_0xec1b25='Floor');_0x51b3e3[_0x44425e][_0x5a06a4(0x1e6)]=_0x364fe4[0x0],_0x51b3e3[_0x44425e]['rack']=_0x364fe4[0x1],_0x51b3e3[_0x44425e]['bay']=_0x364fe4[0x2],_0x51b3e3[_0x44425e][_0x5a06a4(0x204)]=_0x364fe4[0x3],_0x51b3e3[_0x44425e][_0x5a06a4(0x18d)]=_0xec1b25,_0x51b3e3[_0x44425e]['floorlevel']=_0x364fe4[0x5];}}}});}),_0x59a002['forEach']((_0x3a4a4b,_0x39cba4)=>{var _0x12dfe1=_0xbb39d1;_0x51b3e3[_0x39cba4][_0x12dfe1(0x1a8)]=_0x3a4a4b;}),_0x53ae79[_0xbb39d1(0x196)]((_0x1d60ff,_0x15e53b)=>{var _0x242c91=_0xbb39d1;_0x51b3e3[_0x15e53b][_0x242c91(0x248)]=_0x1d60ff;}),_0x261eab[_0xbb39d1(0x196)]((_0x2495a0,_0xb29659)=>{var _0x36ff05=_0xbb39d1;_0x51b3e3[_0xb29659][_0x36ff05(0x14f)]=_0x2495a0;}),_0x58ebcf[_0xbb39d1(0x196)]((_0x49b60b,_0x49e3dd)=>{var _0x4861de=_0xbb39d1;_0x51b3e3[_0x49e3dd][_0x4861de(0x1e2)]=_0x49b60b;}),_0xd812a9['forEach']((_0x5574dc,_0x5e7145)=>{var _0x4e150c=_0xbb39d1;_0x51b3e3[_0x5e7145][_0x4e150c(0x17d)]=_0x5574dc;}),_0x3f6ff6['forEach']((_0x237938,_0x2613b4)=>{var _0x55c2f3=_0xbb39d1;_0x51b3e3[_0x2613b4][_0x55c2f3(0x20b)]=_0x237938;}),_0x28eb46[_0xbb39d1(0x196)]((_0x7bc2bd,_0x14041b)=>{var _0x789952=_0xbb39d1;_0x51b3e3[_0x14041b][_0x789952(0x225)]=Math[_0x789952(0x21f)](_0x7bc2bd);}),_0xf4d436[_0xbb39d1(0x196)]((_0x3c0bff,_0xceb19e)=>{var _0x483f21=_0xbb39d1;_0x51b3e3[_0xceb19e][_0x483f21(0x210)]=_0x3c0bff;}),_0x2cb3fa['forEach']((_0x903505,_0x1ea367)=>{var _0x1ca0a5=_0xbb39d1;_0x51b3e3[_0x1ea367][_0x1ca0a5(0x20e)]=_0x903505;}),_0x55f41f[_0xbb39d1(0x196)]((_0x3980e4,_0x57c011)=>{var _0x361e99=_0xbb39d1;_0x51b3e3[_0x57c011][_0x361e99(0x1be)]=_0x3980e4;}),_0x324d04[_0xbb39d1(0x196)]((_0x5a8cc2,_0x56495c)=>{var _0x1afb89=_0xbb39d1;_0x51b3e3[_0x56495c][_0x1afb89(0x1f1)]=_0x5a8cc2;}),_0x333768[_0xbb39d1(0x196)]((_0x2aadb5,_0x23b0f2)=>{var _0xe4d267=_0xbb39d1;_0x51b3e3[_0x23b0f2][_0xe4d267(0x21d)]=_0x2aadb5;});var _0x1d44ee=0x0;_0x51b3e3[_0xbb39d1(0x196)](_0x4f0167=>{var _0x4e52f9=_0xbb39d1;console['log']('foreach\x20newproduct',_0x4f0167),(parseInt(_0x4f0167[_0x4e52f9(0x1ef)])<parseInt(_0x4f0167[_0x4e52f9(0x208)])||parseInt(_0x4f0167[_0x4e52f9(0x208)])==0x0)&&_0x1d44ee++;});if(_0x1d44ee!=0x0)return _0x95596d['flash'](_0xbb39d1(0x23d),_0xbb39d1(0x1a2)),_0x2dcdc9['redirect']('back');const _0x196057=_0x51b3e3[_0xbb39d1(0x1a7)](_0x4c49e8=>_0x4c49e8[_0xbb39d1(0x208)]!=='0'&&_0x4c49e8[_0xbb39d1(0x208)]!=='');_0x2a90e5[_0xbb39d1(0x1aa)]=_0x1cf5e4,_0x2a90e5[_0xbb39d1(0x245)]=_0x59a282,_0x2a90e5[_0xbb39d1(0x232)]=_0x493285,_0x2a90e5[_0xbb39d1(0x16b)]=_0x45d7fe,_0x2a90e5[_0xbb39d1(0x233)]=_0x196057,_0x2a90e5[_0xbb39d1(0x200)]=_0x398dd9,_0x2a90e5[_0xbb39d1(0x19e)]=_0x934213,_0x2a90e5[_0xbb39d1(0x190)]=_0xbb39d1(0x19c),_0x2a90e5[_0xbb39d1(0x161)]=_0xbb39d1(0x19c);const _0x4c82a7=await _0x2a90e5[_0xbb39d1(0x1f2)]();_0x95596d['flash'](_0xbb39d1(0x24a),_0xbb39d1(0x1e8)),_0x2dcdc9[_0xbb39d1(0x220)](_0xbb39d1(0x15b));}catch(_0x243dea){console[_0xbb39d1(0x17a)](_0x243dea);}}),router[a0_0x13d0cc(0x1fe)]('/give_payment/:id',auth,async(_0x3f9cdf,_0x275ef8)=>{var _0x486956=a0_0x13d0cc;try{const _0x9bafd4=_0x3f9cdf['params']['id'],{invoice:_0x1ff7d3,customer:_0x3a2876,receivable_amount:_0x2b7001,received_amount:_0x2d0748}=_0x3f9cdf[_0x486956(0x1b6)],_0x4e1341=await sales[_0x486956(0x234)](_0x9bafd4);console[_0x486956(0x17a)](_0x4e1341);var _0x2dfdb2=_0x2b7001-_0x2d0748;console[_0x486956(0x17a)](_0x2d0748),_0x4e1341[_0x486956(0x18e)]=parseFloat(_0x2d0748)+parseFloat(_0x4e1341['received_amount']),_0x4e1341[_0x486956(0x165)]=_0x2dfdb2,console[_0x486956(0x17a)](_0x4e1341);const _0x4d4cf9=await _0x4e1341[_0x486956(0x1f2)](),_0x557bc3=await c_payment_data[_0x486956(0x17c)]({'invoice':_0x1ff7d3});_0x557bc3[_0x486956(0x1e5)]=_0x2dfdb2,await _0x557bc3[_0x486956(0x1f2)]();let _0x4c4829=new Date(),_0x105f53=('0'+_0x4c4829[_0x486956(0x180)]())[_0x486956(0x1bc)](-0x2),_0x533ce9=('0'+(_0x4c4829[_0x486956(0x1bd)]()+0x1))[_0x486956(0x1bc)](-0x2),_0x141835=_0x4c4829['getFullYear'](),_0x471502=_0x141835+'-'+_0x533ce9+'-'+_0x105f53;const _0x207059=new customer_payment({'invoice':_0x1ff7d3,'date':_0x141835+'-'+_0x533ce9+'-'+_0x105f53,'customer':_0x3a2876,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x2d0748}),_0x2198c3=await _0x207059[_0x486956(0x1f2)]();_0x3f9cdf[_0x486956(0x1b7)](_0x486956(0x24a),_0x486956(0x1ba)),_0x275ef8[_0x486956(0x220)](_0x486956(0x15b));}catch(_0x14536f){console[_0x486956(0x17a)](_0x14536f);}}),router[a0_0x13d0cc(0x222)]('/invoice/:id',auth,async(_0x515bbb,_0x360ed1)=>{var _0x46da68=a0_0x13d0cc;try{const {username:_0x335e3a,email:_0x51fac3,role:_0x4e8edc}=_0x515bbb[_0x46da68(0x223)],_0x3610ec=_0x515bbb['user'],_0x1b2039=await profile['findOne']({'email':_0x3610ec[_0x46da68(0x1bb)]}),_0x4f63e4=await master_shop['find']();console['log'](_0x46da68(0x1fd),_0x4f63e4);const _0x2d1f5c=_0x515bbb[_0x46da68(0x156)]['id'],_0x1313de=await sales['findById'](_0x2d1f5c);console[_0x46da68(0x17a)](_0x1313de);const _0x551927=await customer['findOne']({'name':_0x1313de['customer']});console[_0x46da68(0x17a)](_0x551927);if(_0x4f63e4[0x0]['language']==_0x46da68(0x213)){var _0x483e3c=users[_0x46da68(0x20a)];console[_0x46da68(0x17a)](_0x483e3c);}else{if(_0x4f63e4[0x0][_0x46da68(0x159)]==_0x46da68(0x189))var _0x483e3c=users[_0x46da68(0x189)];else{if(_0x4f63e4[0x0][_0x46da68(0x159)]=='German')var _0x483e3c=users[_0x46da68(0x1b5)];else{if(_0x4f63e4[0x0][_0x46da68(0x159)]==_0x46da68(0x193))var _0x483e3c=users[_0x46da68(0x193)];else{if(_0x4f63e4[0x0][_0x46da68(0x159)]==_0x46da68(0x185))var _0x483e3c=users[_0x46da68(0x185)];else{if(_0x4f63e4[0x0]['language']==_0x46da68(0x247))var _0x483e3c=users['Portuguese'];else{if(_0x4f63e4[0x0][_0x46da68(0x159)]==_0x46da68(0x24b))var _0x483e3c=users[_0x46da68(0x24b)];else{if(_0x4f63e4[0x0][_0x46da68(0x159)]=='Arabic\x20(ae)')var _0x483e3c=users['Arabic'];}}}}}}}_0x360ed1[_0x46da68(0x221)](_0x46da68(0x15a),{'success':_0x515bbb[_0x46da68(0x1b7)](_0x46da68(0x24a)),'errors':_0x515bbb[_0x46da68(0x1b7)](_0x46da68(0x23d)),'role':_0x3610ec,'profile':_0x1b2039,'master_shop':_0x4f63e4,'customers':_0x551927,'sales':_0x1313de,'language':_0x483e3c});}catch(_0x570297){console[_0x46da68(0x17a)](_0x570297);}}),router['get'](a0_0x13d0cc(0x164),auth,async(_0x219e6e,_0x47b2c3)=>{var _0x3be204=a0_0x13d0cc;try{const {username:_0x55d78a,email:_0x310b5c,role:_0x49d9d3}=_0x219e6e[_0x3be204(0x223)],_0x4f4d7a=_0x219e6e['user'],_0x8a7523=await profile[_0x3be204(0x17c)]({'email':_0x4f4d7a[_0x3be204(0x1bb)]}),_0xca2d97=await master_shop[_0x3be204(0x1ee)]();console[_0x3be204(0x17a)]('master',_0xca2d97);const _0x36f530=_0x219e6e[_0x3be204(0x156)]['id'];console[_0x3be204(0x17a)](_0x36f530);const _0x3d8a3a=await sales[_0x3be204(0x234)](_0x36f530);console[_0x3be204(0x17a)](_0x3be204(0x197),_0x3d8a3a);const _0x1a0fff=await warehouse[_0x3be204(0x236)]([{'$match':{'name':_0x3be204(0x198),'room':_0x3be204(0x1c0)}},{'$unwind':_0x3be204(0x1e3)},{'$group':{'_id':_0x3be204(0x1da),'name':{'$first':_0x3be204(0x1a1)},'product_stock':{'$first':_0x3be204(0x154)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x3be204(0x205)},'pallet':{'$first':_0x3be204(0x206)},'primary_code':{'$first':_0x3be204(0x21e)},'secondary_code':{'$first':_0x3be204(0x243)},'product_code':{'$first':_0x3be204(0x218)}}}]);console[_0x3be204(0x17a)]('stock_data',_0x1a0fff);const _0x58be9e=await product[_0x3be204(0x1ee)]({});warehouse_data=await warehouse[_0x3be204(0x236)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x3be204(0x240)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x597f4e=[_0x3be204(0x1c0)];if(_0xca2d97[0x0][_0x3be204(0x159)]==_0x3be204(0x213)){var _0x3ff06f=users['English'];console[_0x3be204(0x17a)](_0x3ff06f);}else{if(_0xca2d97[0x0][_0x3be204(0x159)]==_0x3be204(0x189))var _0x3ff06f=users[_0x3be204(0x189)];else{if(_0xca2d97[0x0][_0x3be204(0x159)]==_0x3be204(0x1b5))var _0x3ff06f=users[_0x3be204(0x1b5)];else{if(_0xca2d97[0x0][_0x3be204(0x159)]==_0x3be204(0x193))var _0x3ff06f=users[_0x3be204(0x193)];else{if(_0xca2d97[0x0][_0x3be204(0x159)]=='French')var _0x3ff06f=users[_0x3be204(0x185)];else{if(_0xca2d97[0x0][_0x3be204(0x159)]==_0x3be204(0x247))var _0x3ff06f=users[_0x3be204(0x1a4)];else{if(_0xca2d97[0x0][_0x3be204(0x159)]==_0x3be204(0x24b))var _0x3ff06f=users[_0x3be204(0x24b)];else{if(_0xca2d97[0x0]['language']==_0x3be204(0x23e))var _0x3ff06f=users[_0x3be204(0x177)];}}}}}}}_0x47b2c3['render']('return_sale',{'success':_0x219e6e['flash']('success'),'errors':_0x219e6e[_0x3be204(0x1b7)](_0x3be204(0x23d)),'role':_0x4f4d7a,'profile':_0x8a7523,'user':_0x3d8a3a,'stock':_0x1a0fff,'master_shop':_0xca2d97,'unit':_0x58be9e,'language':_0x3ff06f,'warehouses':warehouse_data,'rooms':_0x597f4e});}catch(_0x55a6b7){console[_0x3be204(0x17a)](_0x55a6b7),_0x47b2c3[_0x3be204(0x1e0)](0xc8)[_0x3be204(0x1f0)]({'message':_0x55a6b7['message']});}}),router[a0_0x13d0cc(0x1fe)](a0_0x13d0cc(0x164),auth,async(_0x4a3b2b,_0x18bbd7)=>{var _0x54450c=a0_0x13d0cc;try{const {invoice:_0x75b81,date:_0x10235c,warehouse_name:_0x180bd3,product_name:_0x236988,primary_code:_0x8e4491,secondary_code:_0x5e2a9c,product_code:_0x546387,sales_quantity:_0x34a8d3,stocks:_0x1a46cd,return_qty:_0x3cb03c,Room_name:_0x16ac5e,to_warehouse_name:_0x59df46,to_Roomname:_0x114932,to_Room_name:_0x4b7fc9,note:_0x20475b,level:_0x5a92f0,isle:_0x2f43ff,pallet:_0x587141}=_0x4a3b2b['body'];if(typeof _0x236988==_0x54450c(0x1b0))var _0x446691=[_0x4a3b2b['body'][_0x54450c(0x182)]],_0x488d92=[_0x4a3b2b[_0x54450c(0x1b6)]['primary_code']],_0x36065b=[_0x4a3b2b[_0x54450c(0x1b6)]['secondary_code']],_0x333cdc=[_0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x23a)]],_0x34c1c9=[_0x4a3b2b[_0x54450c(0x1b6)]['sales_quantity']],_0x5f140b=[_0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x1c3)]],_0x574a44=[_0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x230)]],_0x41afc5=[_0x4a3b2b['body'][_0x54450c(0x1ce)]],_0x2803d1=[_0x4a3b2b['body']['bin']],_0x239696=[_0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x1af)]],_0x301ab6=[_0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x1b2)]];else var _0x446691=[..._0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x182)]],_0x488d92=[..._0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x207)]],_0x36065b=[..._0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x175)]],_0x333cdc=[..._0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x23a)]],_0x34c1c9=[..._0x4a3b2b['body'][_0x54450c(0x1fc)]],_0x5f140b=[..._0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x1c3)]],_0x574a44=[..._0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x230)]],_0x41afc5=[..._0x4a3b2b['body'][_0x54450c(0x1ce)]],_0x2803d1=[..._0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x204)]],_0x239696=[..._0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x1af)]],_0x301ab6=[..._0x4a3b2b['body'][_0x54450c(0x1b2)]];const _0x3ed092=_0x446691[_0x54450c(0x1fa)](_0x523e83=>{return _0x523e83={'product_name':_0x523e83};});_0x488d92[_0x54450c(0x196)]((_0x333f6e,_0x269ed0)=>{var _0x44ece9=_0x54450c;_0x3ed092[_0x269ed0][_0x44ece9(0x207)]=_0x333f6e;}),_0x36065b[_0x54450c(0x196)]((_0x5d3f6b,_0x2bea6c)=>{var _0x50a334=_0x54450c;_0x3ed092[_0x2bea6c][_0x50a334(0x175)]=_0x5d3f6b;}),_0x333cdc[_0x54450c(0x196)]((_0x4f17bf,_0x5e9c03)=>{var _0x4ea143=_0x54450c;_0x3ed092[_0x5e9c03][_0x4ea143(0x23a)]=_0x4f17bf;}),_0x34c1c9[_0x54450c(0x196)]((_0x3be285,_0x256b77)=>{var _0x5d8b62=_0x54450c;_0x3ed092[_0x256b77][_0x5d8b62(0x250)]=_0x3be285;}),_0x5f140b[_0x54450c(0x196)]((_0x15d393,_0x4520d0)=>{var _0x4a919d=_0x54450c;_0x3ed092[_0x4520d0][_0x4a919d(0x1ef)]=_0x15d393;}),_0x574a44[_0x54450c(0x196)]((_0x3c10b6,_0x4b35ff)=>{var _0x5b39b7=_0x54450c;_0x3ed092[_0x4b35ff][_0x5b39b7(0x230)]=_0x3c10b6;}),_0x41afc5[_0x54450c(0x196)]((_0x62dc1e,_0x3f39d5)=>{var _0x1471c8=_0x54450c;_0x3ed092[_0x3f39d5][_0x1471c8(0x1ce)]=_0x62dc1e;}),_0x2803d1[_0x54450c(0x196)]((_0xb6cbc0,_0x46cffc)=>{var _0x40ced7=_0x54450c;_0x3ed092[_0x46cffc][_0x40ced7(0x204)]=_0xb6cbc0;}),_0x239696[_0x54450c(0x196)]((_0x126566,_0x1c48b7)=>{var _0x3c29b8=_0x54450c;_0x3ed092[_0x1c48b7][_0x3c29b8(0x18d)]=_0x126566;}),_0x301ab6[_0x54450c(0x196)]((_0x1a558f,_0x1a40c1)=>{var _0x50fcae=_0x54450c;_0x3ed092[_0x1a40c1][_0x50fcae(0x1b2)]=_0x1a558f;});var _0x121445=0x0;_0x3ed092['forEach'](_0x572d02=>{var _0x252e50=_0x54450c;console[_0x252e50(0x17a)](_0x252e50(0x194),_0x572d02),(parseInt(_0x572d02['sale_qty'])<parseInt(_0x572d02[_0x252e50(0x230)])||parseInt(_0x572d02[_0x252e50(0x1ef)])<parseInt(_0x572d02[_0x252e50(0x230)])&&parseInt(_0x572d02[_0x252e50(0x250)])>parseInt(_0x572d02[_0x252e50(0x230)])||parseInt(_0x572d02[_0x252e50(0x230)])==0x0)&&_0x121445++;});if(_0x121445!=0x0)return _0x4a3b2b[_0x54450c(0x1b7)]('errors','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x18bbd7[_0x54450c(0x220)](_0x54450c(0x229));const _0x378655=await sales[_0x54450c(0x17c)]({'invoice':_0x75b81});console['log'](_0x378655),_0x378655[_0x54450c(0x211)]=_0x54450c(0x252);const _0x55dd66=await _0x378655[_0x54450c(0x1f2)](),_0x3429c5=new sales_return({'invoice':_0x75b81,'customer':_0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x245)],'date':_0x10235c,'warehouse_name':_0x180bd3,'room':_0x16ac5e,'ToWarehouse':_0x59df46,'ToRoom':_0x4b7fc9,'return_sale':_0x3ed092,'note':_0x20475b}),_0x4fbfdc=await _0x3429c5[_0x54450c(0x1f2)]();console[_0x54450c(0x17a)](_0x3429c5);const _0x4c84e6=await sales_return[_0x54450c(0x17c)]({'invoice':_0x75b81}),_0x56c424=await warehouse[_0x54450c(0x17c)]({'name':_0x59df46,'room':_0x4b7fc9});_0x4c84e6[_0x54450c(0x17b)][_0x54450c(0x196)](_0x2da4f2=>{var _0x173c81=_0x54450c,_0x4436c7=0x0;const _0x4ce091=_0x56c424[_0x173c81(0x17e)][_0x173c81(0x1fa)](_0x223bfb=>{var _0x109c04=_0x173c81;_0x223bfb[_0x109c04(0x182)]==_0x2da4f2[_0x109c04(0x182)]&&_0x223bfb[_0x109c04(0x1b2)]==_0x2da4f2['floorlevel']&&_0x223bfb['type']==_0x2da4f2[_0x109c04(0x18d)]&&_0x223bfb[_0x109c04(0x204)]==_0x2da4f2[_0x109c04(0x204)]&&_0x223bfb[_0x109c04(0x1ce)]==_0x2da4f2[_0x109c04(0x1ce)]&&(_0x223bfb['product_stock']=parseInt(_0x223bfb['product_stock'])+parseInt(_0x2da4f2[_0x109c04(0x230)]),_0x4436c7++);});_0x4436c7=='0'&&(_0x56c424[_0x173c81(0x17e)]=_0x56c424[_0x173c81(0x17e)]['concat']({'product_name':_0x2da4f2['product_name'],'product_stock':_0x2da4f2['return_qty'],'primary_code':_0x2da4f2['primary_code'],'secondary_code':_0x2da4f2[_0x173c81(0x175)],'product_code':_0x2da4f2[_0x173c81(0x23a)],'bay':_0x2da4f2[_0x173c81(0x1ce)],'bin':_0x2da4f2[_0x173c81(0x204)],'type':_0x2da4f2['type'],'floorlevel':_0x2da4f2['floorlevel']})),console[_0x173c81(0x17a)](_0x173c81(0x20f),_0x56c424);}),await _0x56c424['save'](),console[_0x54450c(0x17a)](_0x4a3b2b['body']);const _0x404a7a=new c_payment_data({'invoice':_0x75b81,'customer':_0x4a3b2b[_0x54450c(0x1b6)][_0x54450c(0x245)],'reason':_0x54450c(0x1ab)});await _0x404a7a[_0x54450c(0x1f2)]();const _0xb2e8ac=await master_shop[_0x54450c(0x1ee)]();console[_0x54450c(0x17a)](_0x54450c(0x253),_0xb2e8ac[0x0][_0x54450c(0x21b)]);const _0x3949da=await email_settings[_0x54450c(0x17c)](),_0x5f595f=await customer[_0x54450c(0x17c)]({'name':_0x4a3b2b[_0x54450c(0x1b6)]['customer']});console[_0x54450c(0x17a)]('customer_data',_0x5f595f);_0xb2e8ac[0x0]['currency_placement']==0x1?(right_currency=_0xb2e8ac[0x0][_0x54450c(0x15e)],left_currency=''):(right_currency='',left_currency=_0xb2e8ac[0x0][_0x54450c(0x15e)]);var _0x322c20=_0x446691,_0x37aad9=_0x574a44,_0x223117='',_0x5449a7;for(_0x5449a7 in _0x322c20){_0x223117+=_0x54450c(0x235)+_0x54450c(0x22b)+_0x322c20[_0x5449a7]+_0x54450c(0x256)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x37aad9[_0x5449a7]+_0x54450c(0x256)+_0x54450c(0x23f);}console[_0x54450c(0x17a)](_0x54450c(0x24e),_0x223117);let _0x561ee9=nodemailer[_0x54450c(0x1ec)]({'service':_0x54450c(0x168),'auth':{'user':_0x3949da[_0x54450c(0x1bb)],'pass':_0x3949da['password']}}),_0x1e7c0c={'from':_0x3949da[_0x54450c(0x1bb)],'to':_0x5f595f[_0x54450c(0x1bb)],'subject':_0x54450c(0x21c),'attachments':[{'filename':_0x54450c(0x1f5),'path':__dirname+_0x54450c(0x219)+_0x54450c(0x1d9)+_0xb2e8ac[0x0][_0x54450c(0x21b)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x54450c(0x163)+_0x54450c(0x257)+_0x54450c(0x228)+_0x54450c(0x1e4)+'<div>'+_0x54450c(0x215)+_0x54450c(0x195)+_0x54450c(0x228)+_0x54450c(0x1cc)+_0xb2e8ac[0x0][_0x54450c(0x15f)]+_0x54450c(0x169)+_0x54450c(0x195)+_0x54450c(0x195)+_0x54450c(0x23c)+'<div>'+_0x54450c(0x1f4)+'\x20Order\x20Number\x20:\x20'+_0x75b81+'\x20'+_0x54450c(0x187)+_0x54450c(0x239)+_0x10235c+'\x20'+_0x54450c(0x181)+_0x54450c(0x151)+_0x54450c(0x195)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x54450c(0x1a5)+_0x54450c(0x235)+_0x54450c(0x1e9)+_0x54450c(0x1d7)+_0x54450c(0x19d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x54450c(0x23f)+'</thead>'+_0x54450c(0x23b)+'\x20'+_0x223117+'\x20'+_0x54450c(0x1ff)+'</table>'+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x54450c(0x1a9)+_0xb2e8ac[0x0][_0x54450c(0x15f)]+'</h5>'+_0x54450c(0x195)+_0x54450c(0x195)+_0x54450c(0x15c)};_0x561ee9[_0x54450c(0x1bf)](_0x1e7c0c,function(_0x27c5ac,_0xc70190){var _0x83d045=_0x54450c;_0x27c5ac?(console['log'](_0x27c5ac),console['log'](_0x83d045(0x22d))):console[_0x83d045(0x17a)](_0x83d045(0x1d3));}),_0x4a3b2b[_0x54450c(0x1b7)](_0x54450c(0x24a),_0x54450c(0x179)),_0x18bbd7[_0x54450c(0x220)]('/all_sales/view');}catch(_0xaad324){console[_0x54450c(0x17a)](_0xaad324),_0x18bbd7[_0x54450c(0x1e0)](0xc8)[_0x54450c(0x1f0)]({'message1':_0xaad324[_0x54450c(0x231)]});}}),router[a0_0x13d0cc(0x222)](a0_0x13d0cc(0x155),auth,async(_0x218c73,_0x5b76b1)=>{var _0x5af61c=a0_0x13d0cc;try{const {username:_0x2f1e05,email:_0x811ee7,role:_0x39c472}=_0x218c73[_0x5af61c(0x223)],_0x3801ab=_0x218c73[_0x5af61c(0x223)],_0x3fbc81=await profile[_0x5af61c(0x17c)]({'email':_0x3801ab[_0x5af61c(0x1bb)]}),_0x5a9364=await master_shop['find']();console[_0x5af61c(0x17a)](_0x5af61c(0x16a),_0x5a9364);const _0x188254=_0x218c73['params']['id'],_0x604e21=await sales[_0x5af61c(0x234)](_0x188254);console[_0x5af61c(0x17a)](_0x5af61c(0x216),_0x604e21);if(_0x5a9364[0x0][_0x5af61c(0x159)]=='English\x20(US)')var _0x410ffe=users[_0x5af61c(0x20a)];else{if(_0x5a9364[0x0][_0x5af61c(0x159)]==_0x5af61c(0x189))var _0x410ffe=users['Hindi'];else{if(_0x5a9364[0x0]['language']=='German')var _0x410ffe=users[_0x5af61c(0x1b5)];else{if(_0x5a9364[0x0][_0x5af61c(0x159)]==_0x5af61c(0x193))var _0x410ffe=users[_0x5af61c(0x193)];else{if(_0x5a9364[0x0][_0x5af61c(0x159)]==_0x5af61c(0x185))var _0x410ffe=users[_0x5af61c(0x185)];else{if(_0x5a9364[0x0][_0x5af61c(0x159)]==_0x5af61c(0x247))var _0x410ffe=users['Portuguese'];else{if(_0x5a9364[0x0]['language']==_0x5af61c(0x24b))var _0x410ffe=users['Chinese'];else{if(_0x5a9364[0x0]['language']=='Arabic\x20(ae)')var _0x410ffe=users[_0x5af61c(0x177)];}}}}}}}_0x5b76b1[_0x5af61c(0x221)](_0x5af61c(0x1b8),{'success':_0x218c73[_0x5af61c(0x1b7)](_0x5af61c(0x24a)),'errors':_0x218c73[_0x5af61c(0x1b7)](_0x5af61c(0x23d)),'role':_0x3801ab,'profile':_0x3fbc81,'alldata':_0x604e21,'master_shop':_0x5a9364,'language':_0x410ffe});}catch(_0x1c8fac){console[_0x5af61c(0x17a)](_0x1c8fac);}}),router[a0_0x13d0cc(0x1fe)](a0_0x13d0cc(0x16f),async(_0x2546ed,_0x18909f)=>{var _0x42b9ab=a0_0x13d0cc;const {product_code:_0x16e8c4,warehouse_name:_0x468a7b,rooms_data:_0x49e626,Roomslist:_0x5989e0}=_0x2546ed[_0x42b9ab(0x1b6)],_0xfd977f=_0x5989e0[_0x42b9ab(0x238)](','),_0x97e2f=[];async function _0x5a8575(_0xe89980){var _0x48e4b8=_0x42b9ab;const _0x1fb893=await warehouse['aggregate']([{'$match':{'name':_0x468a7b,'room':_0xe89980}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x16e8c4}},{'$group':{'_id':_0x48e4b8(0x1da),'name':{'$first':_0x48e4b8(0x1a1)},'product_stock':{'$first':_0x48e4b8(0x154)},'primary_code':{'$first':_0x48e4b8(0x21e)},'secondary_code':{'$first':_0x48e4b8(0x243)},'product_code':{'$first':_0x48e4b8(0x218)},'level':{'$first':_0x48e4b8(0x173)},'isle':{'$first':_0x48e4b8(0x170)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x48e4b8(0x160)},'unit':{'$first':_0x48e4b8(0x22c)},'secondary_unit':{'$first':_0x48e4b8(0x1de)},'storage':{'$first':_0x48e4b8(0x171)},'rack':{'$first':_0x48e4b8(0x21a)},'expiry_date':{'$first':_0x48e4b8(0x174)},'production_date':{'$first':_0x48e4b8(0x176)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x48e4b8(0x1c7)},'product_cat':{'$first':_0x48e4b8(0x203)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x48e4b8(0x1c9)},'invoice':{'$first':_0x48e4b8(0x244)},'actual_qty':{'$first':_0x48e4b8(0x192)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x45a81b=await warehouse[_0x48e4b8(0x236)]([{'$match':{'name':_0x468a7b,'room':_0xe89980}},{'$unwind':_0x48e4b8(0x1e3)},{'$match':{'product_details.secondary_code':_0x16e8c4}},{'$group':{'_id':_0x48e4b8(0x1da),'name':{'$first':_0x48e4b8(0x1a1)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x48e4b8(0x21e)},'secondary_code':{'$first':_0x48e4b8(0x243)},'product_code':{'$first':_0x48e4b8(0x218)},'level':{'$first':_0x48e4b8(0x173)},'isle':{'$first':_0x48e4b8(0x170)},'type':{'$first':_0x48e4b8(0x1c8)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x48e4b8(0x171)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x48e4b8(0x176)},'maxPerUnit':{'$first':_0x48e4b8(0x19f)},'batch_code':{'$first':_0x48e4b8(0x1c7)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x1fb893[_0x48e4b8(0x1d5)]>0x0)_0x97e2f['push'](_0x1fb893);else _0x45a81b[_0x48e4b8(0x1d5)]>0x0&&_0x97e2f[_0x48e4b8(0x1cf)](_0x45a81b);}const _0x370b79=_0xfd977f[_0x42b9ab(0x1fa)](_0xd2e15e=>_0x5a8575(_0xd2e15e));await Promise['all'](_0x370b79),_0x18909f[_0x42b9ab(0x1f0)](_0x97e2f);}),module[a0_0x13d0cc(0x24d)]=router;function a0_0x15ad(){var _0x33fa3e=['floor','edit_sales_view','Email\x20sent\x20successfully','272469yeLudq','length','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$finalize','/upload/','$product_details._id','265bQAVgI','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.secondary_unit','nodemailer','status','There\x27s\x20a\x20error\x20in\x20this\x20transaction','expiry_date','$product_details','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','amount','storage','$sale_product','Sales\x20Update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_code','max_per_unit','createTransport','$name','find','stock','json','quantity_notConverted','save','../public/language/languages.json','<h5\x20style=\x22text-align:\x20left;\x22>','Logo.png','$sale_product.bin','226570uRdjBZ','/view/add_sales/:id','\x20Order\x20Number\x20:\x20','map','An\x20error\x20occurred\x20while\x20saving\x20data.','sales_quantity','master','post','</tbody>','note','1391740sWmdtR','actual_qty','$product_details.product_cat','bin','$product_details.isle','$product_details.pallet','primary_code','quantity','/view/:id','English','production_date','$sale_product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','delivery_code','final','delivery_date','return_data','Shelves','English\x20(US)','express','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','barcode\x20user_id','/view/add_sales','$product_details.product_code','/../public','$product_details.rack','image','Sale\x20Return\x20Mail','room_name','$product_details.primary_code','abs','redirect','render','get','user','then','requested_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<div>','back','$customers_docs','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.unit','Error\x20Occurs','$warehouse_name','carton','return_qty','message','date','sale_product','findById','<tr>','aggregate','stock_data','split','\x20Order\x20Date\x20:\x20','product_code','<tbody\x20style=\x22text-align:\x20center;\x22>','<hr\x20class=\x22my-3\x22>','errors','Arabic\x20(ae)','</tr>','Raw\x20Materials','toString','Level','$product_details.secondary_code','$product_details.invoice','customer','/all_sales/preview/','Portuguese\x20(BR)','secondary_unit','role','success','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','exports','product_list','add_sales','sale_qty','Sales\x20Add\x20successfully','True','add\x20post','sales\x20all_data','catch','</td>','</head><body>','$isAllowEdit','error','name','batch_code','5935884WKXFEQ','</h5>','warehouse','</thead>','$product_details.product_stock','/barcode/:id','params','rack','RoomAssigned','language','sales_invoice','/all_sales/view','</body></html>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','currency','site_title','$product_details.floorlevel','isAllowEdit','Receiving\x20Area','<html><head><title></title>','/view/return_sales/:id','due_amount','/view/add_sale/product','80140GxVrws','gmail','\x20</h2>','barcode\x20Product\x20master','warehouse_name','room','1264291pmZCXG','$sale_product.floorlevel','/barcode_scanner','$product_details.bin','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.bay','$product_details.expiry_date','secondary_code','$product_details.production_date','Arabic','387tFYjdq','sales\x20item\x20return\x20successfull','log','return_sale','findOne','maxperunit','product_details','$customer','getDate','</span>','product_name','/preview/:id','</table>','French','primary_unit','<span\x20style=\x22float:\x20right;\x22>','actual_uom','Hindi','_id','edit_sales','OUT-','type','received_amount','all','finalize','prod_invoice','$product_details.actual_qty','Spanish','foreach\x20newproduct','</div>','forEach','user_id','Return\x20Goods','Enabled','<strong>\x20Regards\x20</strong>','9427952oVgUsy','False','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','SCRN','$product_details.maxPerUnit','all_sales','$product_details.product_name','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$_id','Portuguese','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','12hGmHfr','filter','unit','<h5>','invoice','Sale\x20Return','$note','$date','$sale_product.quantity','types','string','random','floorlevel','level','$sale_product.type','German','body','flash','all_sales_barcode','customers_docs','payment\x20successfull','email','slice','getMonth','prod_cat','sendMail','Return\x20Rooms','/view','product','stocks','customers','Floor','host','$product_details.batch_code','$product_details.type','$room','staff','Enclosed','<h2>\x20','logo','bay','push','Router'];a0_0x15ad=function(){return _0x33fa3e;};return a0_0x15ad();}