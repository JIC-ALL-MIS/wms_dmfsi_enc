var a0_0x1b291d=a0_0x147e;function a0_0x147e(_0x4b0c7c,_0x5baa67){var _0x44eda1=a0_0x44ed();return a0_0x147e=function(_0x147ee0,_0xfe8efb){_0x147ee0=_0x147ee0-0x8d;var _0x17584a=_0x44eda1[_0x147ee0];return _0x17584a;},a0_0x147e(_0x4b0c7c,_0x5baa67);}(function(_0x3730b6,_0x2edef3){var _0x53067f=a0_0x147e,_0x332461=_0x3730b6();while(!![]){try{var _0x6ab788=parseInt(_0x53067f(0xee))/0x1+parseInt(_0x53067f(0xb2))/0x2+parseInt(_0x53067f(0x195))/0x3+parseInt(_0x53067f(0x112))/0x4*(parseInt(_0x53067f(0xdd))/0x5)+-parseInt(_0x53067f(0xe3))/0x6+parseInt(_0x53067f(0x196))/0x7*(parseInt(_0x53067f(0xea))/0x8)+-parseInt(_0x53067f(0x14e))/0x9;if(_0x6ab788===_0x2edef3)break;else _0x332461['push'](_0x332461['shift']());}catch(_0x2a9b00){_0x332461['push'](_0x332461['shift']());}}}(a0_0x44ed,0xd14f7));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1b291d(0x133)),auth=require(a0_0x1b291d(0x9a)),nodemailer=require(a0_0x1b291d(0xc7)),users=require(a0_0x1b291d(0x11a));router[a0_0x1b291d(0x17a)](a0_0x1b291d(0xe5),auth,async(_0x48b95f,_0x114656)=>{var _0x458797=a0_0x1b291d;try{const {username:_0x36e167,email:_0x33ce43,role:_0x54dee4}=_0x48b95f[_0x458797(0xf8)],_0x576807=_0x48b95f[_0x458797(0xf8)],_0x5af9f4=await profile[_0x458797(0x152)]({'email':_0x576807[_0x458797(0x101)]}),_0x1ed143=await master_shop[_0x458797(0x95)]();let _0x535944;if(_0x576807[_0x458797(0xef)]==_0x458797(0x150)){const _0x151a25=await staff[_0x458797(0x152)]({'email':_0x576807['email']});_0x535944=await sales['aggregate']([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x458797(0xf1),'as':_0x458797(0xa9)}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x458797(0x159)},'customers':{'$first':_0x458797(0x142)},'date':{'$first':_0x458797(0xb6)},'warehouse_name':{'$first':_0x458797(0x108)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x458797(0x125)},'customers_docs':{'$first':_0x458797(0xb5)},'total_saleproduct_quantity':{'$sum':_0x458797(0x11c)},'level':{'$addToSet':_0x458797(0x12e)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x458797(0xb0)},'finalize':{'$first':_0x458797(0x8e)},'isAllowEdit':{'$first':_0x458797(0xb4)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x535944=await sales[_0x458797(0x16e)]([{'$lookup':{'from':_0x458797(0xd2),'localField':_0x458797(0x194),'foreignField':'name','as':_0x458797(0xa9)}},{'$unwind':_0x458797(0xb5)},{'$unwind':_0x458797(0x126)},{'$group':{'_id':_0x458797(0x13a),'invoice':{'$first':_0x458797(0x159)},'customers':{'$first':_0x458797(0x142)},'date':{'$first':_0x458797(0xb6)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x458797(0x125)},'customers_docs':{'$first':_0x458797(0xb5)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x458797(0x12e)},'isle':{'$addToSet':_0x458797(0x177)},'type':{'$addToSet':_0x458797(0x115)},'pallet':{'$addToSet':_0x458797(0xb0)},'finalize':{'$first':_0x458797(0x8e)},'isAllowEdit':{'$first':_0x458797(0xb4)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x458797(0x156)](_0x458797(0x148),_0x535944);if(_0x1ed143[0x0]['language']=='English\x20(US)'){var _0x301247=users[_0x458797(0xdc)];console['log'](_0x301247);}else{if(_0x1ed143[0x0][_0x458797(0xf7)]==_0x458797(0xf6))var _0x301247=users[_0x458797(0xf6)];else{if(_0x1ed143[0x0][_0x458797(0xf7)]==_0x458797(0xbb))var _0x301247=users['German'];else{if(_0x1ed143[0x0][_0x458797(0xf7)]==_0x458797(0x119))var _0x301247=users[_0x458797(0x119)];else{if(_0x1ed143[0x0][_0x458797(0xf7)]==_0x458797(0xe2))var _0x301247=users[_0x458797(0xe2)];else{if(_0x1ed143[0x0][_0x458797(0xf7)]=='Portuguese\x20(BR)')var _0x301247=users['Portuguese'];else{if(_0x1ed143[0x0][_0x458797(0xf7)]==_0x458797(0xe0))var _0x301247=users[_0x458797(0xe0)];else{if(_0x1ed143[0x0][_0x458797(0xf7)]==_0x458797(0x18c))var _0x301247=users[_0x458797(0xf4)];}}}}}}}_0x114656[_0x458797(0x14b)](_0x458797(0xe4),{'success':_0x48b95f[_0x458797(0xe7)]('success'),'errors':_0x48b95f['flash'](_0x458797(0xb7)),'sales':_0x535944,'profile':_0x5af9f4,'role':_0x576807,'master_shop':_0x1ed143,'language':_0x301247});}catch(_0x1c713c){console[_0x458797(0x156)](_0x1c713c);}});function a0_0x44ed(){var _0x2ae3b8=['Ambient','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','getMonth','email','then','/all_sales/preview/','<html><head><title></title>','</tbody>','$product_details.storage','prod_cat','$warehouse_name','requested_qty','maxperunit','Shelves','abs','bay','$room','delivery_date','/view/add_sales','message','12SlBEuz','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/view/return_sales/:id','$sale_product.type','OUT-','Level','<hr\x20class=\x22my-3\x22>','Spanish','../public/language/languages.json','secondary_code','$sale_product.quantity','</body></html>','$product_details.secondary_unit','$product_details.product_cat','sale_qty','/all_sales/view','Enclosed','$product_details.rack','product_stock','$return_data','$sale_product','getFullYear','Sale\x20Return\x20Mail','</thead>','$name','date','carton','password','$sale_product.bay','</td>','return_sale','</div>','foreach\x20newproduct','../models/all_models','Sales\x20Add\x20successfully','\x20</h2>','Portuguese','$product_details.secondary_code','Error\x20Occurs','forEach','$_id','$product_details.floorlevel','add_sales','product','Enabled','currency','map','params','$customer','type','storage','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','sendMail','/preview/:id','sales\x20all_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.maxPerUnit','render','logo','<span\x20style=\x22float:\x20right;\x22>','22097097SMsOGv','unit','staff','image','findOne','push','/invoice/:id','Sale\x20Return','log','payment\x20successfull','Return\x20Goods','$invoice','</head><body>','$product.product_name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','delivery_code','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','sale_product','received_amount','primary_unit','</tr>','<tr>','stock_data','</h5>','site_title','</table>','padStart','Raw\x20Materials','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','all','product_name','aggregate','room_name','floorlevel','product_data','level','port','product_details','RoomAssigned','$product','$sale_product.bin','/barcode_scanner','$product_details.expiry_date','get','master','rack','batch_code','$product_details.product_name','gmail','sales\x20item\x20return\x20successfull','post','Return\x20Rooms','status','$product_details.type','json','findById','edit_sales','quantity','$product_details.actual_qty','<strong>\x20Regards\x20</strong>','createTransport','Arabic\x20(ae)','slice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','bin','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','return_qty','customer','2732703nRAfJs','10570fLQtUw','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$finalize','primary_code','quantity_notConverted','concat','<h5>','error','$product_details.level','find','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','length','SCRN','../middleware/auth','sales_quantity','exports','return_data','$product_details.product_code','max_per_unit','isAllowEdit','<div>','Received\x20Payment\x20For\x20Sale','$product_details.invoice','actual_qty','$product_details.unit','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.bin','customers_docs','prod_invoice','$product_details.bay','add\x20post','Floor','body','edit_sales_view','$sale_product.floorlevel','False','1000506mibUdO','filter','$isAllowEdit','$customers_docs','$date','errors','True','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','<h5\x20style=\x22text-align:\x20left;\x22>','German','_id','<h2>\x20','types','back','redirect','An\x20error\x20occurred\x20while\x20saving\x20data.','customer_data','stocks','floor','final','host','nodemailer','$product_details.pallet','/view/:id','product_code','save','$product_details','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','success','<!DOCTYPE\x20html>','$product_details._id','catch','customers','invoice','prod_code','random','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','string','Portuguese\x20(BR)','warehouse','$product_details.primary_code','</span>','English','2632290DaGrtF','\x20Order\x20Date\x20:\x20','purchases_data','Chinese','Email\x20sent\x20successfully','French','5867088RpHHtx','all_sales','/view','RMSEmail','flash','$product_details.isle','finalize','2296LVYVqF','split','Sales\x20Update\x20successfully','barcode\x20user_id','866518qRoAex','role','Receiving\x20Area','name','English\x20(US)','secondary_unit','Arabic','$product_details.production_date','Hindi','language','user','$product_details.actual_uom','stock','warehouse_name','actual_uom'];a0_0x44ed=function(){return _0x2ae3b8;};return a0_0x44ed();}async function getRandom8DigitNumber(){var _0x23ae99=a0_0x1b291d;const _0x4f53f9=0x989680,_0x132775=0x5f5e0ff,_0xaea569=Math[_0x23ae99(0xc4)](Math[_0x23ae99(0xd5)]()*(_0x132775-_0x4f53f9+0x1))+_0x4f53f9;var _0x34716b;const _0x2ad9ab=await sales[_0x23ae99(0x152)]({'invoice':_0x23ae99(0x116)+_0xaea569});return _0x2ad9ab&&_0x2ad9ab['length']>0x0?_0x34716b=_0x23ae99(0x116)+_0xaea569:_0x34716b='OUT-'+_0xaea569,_0x34716b;}router[a0_0x1b291d(0x17a)]('/view/add_sales',auth,async(_0xf18f61,_0x1914de)=>{var _0x57c19d=a0_0x1b291d;try{const {username:_0x4deb25,email:_0x238767,role:_0x4f0168}=_0xf18f61[_0x57c19d(0xf8)],_0x57e026=_0xf18f61[_0x57c19d(0xf8)],_0x5371ec=await profile[_0x57c19d(0x152)]({'email':_0x57e026[_0x57c19d(0x101)]}),_0x365182=await master_shop[_0x57c19d(0x95)](),_0x4381be=await customer['find']({});let _0x18a37b;if(_0x57e026[_0x57c19d(0xef)]==_0x57c19d(0x150)){const _0x2f01eb=await staff[_0x57c19d(0x152)]({'email':_0x57e026[_0x57c19d(0x101)]});_0x18a37b=await warehouse['aggregate']([{'$match':{'status':_0x57c19d(0x13e),'name':_0x2f01eb['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x57c19d(0x158)}}},{'$group':{'_id':_0x57c19d(0x12a),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x18a37b=await warehouse[_0x57c19d(0x16e)]([{'$match':{'status':_0x57c19d(0x13e),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x57c19d(0x158)}}},{'$group':{'_id':'$name','name':{'$first':_0x57c19d(0x12a)}}},{'$sort':{'name':0x1}}]);const _0x13b0d8=await product['find']({});var _0xdf1cef=[_0x57c19d(0xfd),_0x57c19d(0x122)];const _0x4e2a79=await sales[_0x57c19d(0x95)]({}),_0x1cd37a=_0x4e2a79[_0x57c19d(0x98)]+0x1,_0x20ffc3='OUT-'+_0x1cd37a['toString']()[_0x57c19d(0x169)](0x5,'0');if(_0x365182[0x0][_0x57c19d(0xf7)]=='English\x20(US)'){var _0xe056b5=users[_0x57c19d(0xdc)];console[_0x57c19d(0x156)](_0xe056b5);}else{if(_0x365182[0x0]['language']=='Hindi')var _0xe056b5=users[_0x57c19d(0xf6)];else{if(_0x365182[0x0][_0x57c19d(0xf7)]==_0x57c19d(0xbb))var _0xe056b5=users[_0x57c19d(0xbb)];else{if(_0x365182[0x0]['language']==_0x57c19d(0x119))var _0xe056b5=users[_0x57c19d(0x119)];else{if(_0x365182[0x0][_0x57c19d(0xf7)]=='French')var _0xe056b5=users[_0x57c19d(0xe2)];else{if(_0x365182[0x0][_0x57c19d(0xf7)]==_0x57c19d(0xd8))var _0xe056b5=users[_0x57c19d(0x136)];else{if(_0x365182[0x0][_0x57c19d(0xf7)]==_0x57c19d(0xe0))var _0xe056b5=users[_0x57c19d(0xe0)];else{if(_0x365182[0x0][_0x57c19d(0xf7)]==_0x57c19d(0x18c))var _0xe056b5=users['Arabic'];}}}}}}}const _0x152ca7=getRandom8DigitNumber();_0x152ca7[_0x57c19d(0x102)](_0x226fe0=>{var _0x53f9d8=_0x57c19d;_0x1914de[_0x53f9d8(0x14b)](_0x53f9d8(0x13c),{'success':_0xf18f61['flash'](_0x53f9d8(0xce)),'errors':_0xf18f61[_0x53f9d8(0xe7)]('errors'),'role':_0x57e026,'profile':_0x5371ec,'customer':_0x4381be,'warehouse':_0x18a37b,'product':_0x13b0d8,'invoice':_0x226fe0,'master_shop':_0x365182,'language':_0xe056b5,'rooms_data':_0xdf1cef});})[_0x57c19d(0xd1)](_0x458bdf=>{var _0x5b3dbb=_0x57c19d;_0xf18f61[_0x5b3dbb(0xe7)](_0x5b3dbb(0xb7),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1914de[_0x5b3dbb(0xc0)](_0x5b3dbb(0x121));});}catch(_0x97e3c7){console[_0x57c19d(0x156)](_0x97e3c7);}}),router[a0_0x1b291d(0x17a)]('/view/add_sales/:id',auth,async(_0xbf4ee8,_0x3f80f4)=>{var _0x1a1fde=a0_0x1b291d;try{const _0x22e5de=_0xbf4ee8[_0x1a1fde(0x141)]['id'];console['log'](_0x22e5de);const _0x97caff=await product[_0x1a1fde(0x95)](),_0x54c3bd=await purchases[_0x1a1fde(0x16e)]([{'$match':{'warehouse_name':_0x22e5de}},{'$unwind':_0x1a1fde(0x176)},{'$group':{'_id':_0x1a1fde(0x15b)}}]);console[_0x1a1fde(0x156)](_0x1a1fde(0xdf),_0x54c3bd),_0x3f80f4[_0x1a1fde(0x183)](0xc8)['json']({'purchases_data':_0x54c3bd,'product_data':_0x97caff});}catch(_0x23cb88){console['log'](_0x23cb88);}}),router['post']('/view/add_sale/product',auth,async(_0x56b6a1,_0x58ebcc)=>{var _0xb71836=a0_0x1b291d;try{const {warehouse_data:_0x16b427,product_data:_0x1b9593}=_0x56b6a1[_0xb71836(0xae)];console[_0xb71836(0x156)](_0x56b6a1[_0xb71836(0xae)][_0xb71836(0x171)]);;const _0x57312f=await master_shop[_0xb71836(0x95)]();console[_0xb71836(0x156)](_0xb71836(0x17b),_0x57312f);const _0x55ccb8=await product['findOne']({'name':_0x1b9593});console['log'](_0xb71836(0x13d),_0x55ccb8);const _0x1cf3b9=await warehouse['aggregate']([{'$match':{'name':_0x16b427}},{'$unwind':_0xb71836(0xcc)},{'$match':{'product_details.product_name':_0x1b9593}},{'$group':{'_id':_0xb71836(0x17e),'product_stock':{'$first':_0xb71836(0x15e)}}}]);console['log'](_0xb71836(0x165),_0x1cf3b9),_0x58ebcc[_0xb71836(0x183)](0xc8)['json']({'master':_0x57312f,'new_product':_0x55ccb8,'stock_data':_0x1cf3b9});}catch(_0x57e64c){console[_0xb71836(0x156)](_0x57e64c);}}),router[a0_0x1b291d(0x181)](a0_0x1b291d(0x110),auth,async(_0x14e4d3,_0x1046ff)=>{var _0x2a6b26=a0_0x1b291d;try{const {invoice:_0x3990c8,date:_0x3f45e9,warehouse_name:_0x9678e,product_name:_0x3bd4b4,stock:_0x509b81,quantity:_0x36702d,note:_0x4cbe11,room:_0xfbf4a5,primary_code:_0x1e6d1b,secondary_code:_0x128130,prod_code:_0x4dd2ea,level:_0x53e80d,isle:_0x428d96,pallet:_0x296137,batch_code:_0x170e10,SCRN:_0x413a93,expiry_date:_0x2e7480}=_0x14e4d3[_0x2a6b26(0xae)];if(typeof _0x3bd4b4==_0x2a6b26(0xd7))var _0x55b0a5=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x16d)]],_0xecb6e4=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0xfa)]],_0xbbabab=[_0x14e4d3['body']['carton']],_0x485c66=[_0x14e4d3['body'][_0x2a6b26(0x8f)]],_0x61b3ce=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x11b)]],_0x1530fe=[_0x14e4d3['body']['prod_code']],_0x5a8ebf=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x172)]],_0x458af1=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x162)]],_0x253aa5=[_0x14e4d3[_0x2a6b26(0xae)]['secondary_unit']],_0x419e39=[_0x14e4d3['body'][_0x2a6b26(0x17d)]],_0x1cc99c=[_0x14e4d3[_0x2a6b26(0xae)]['expiry_date']],_0x418d30=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x9f)]],_0xd6acf=[_0x14e4d3[_0x2a6b26(0xae)]['production_date']],_0x5e49f1=[_0x14e4d3['body'][_0x2a6b26(0x109)]],_0x48c65b=[_0x14e4d3[_0x2a6b26(0xae)]['delivery_date']],_0x2196da=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x15d)]],_0x35620a=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x107)]],_0x7fb74d=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x188)]],_0x5b445a=[_0x14e4d3['body']['RoomAssigned']],_0x853894=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0xaa)]],_0x23dff0=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0xa4)]],_0x48c798=[_0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0xfc)]];else var _0x55b0a5=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x16d)]],_0xecb6e4=[..._0x14e4d3[_0x2a6b26(0xae)]['stock']],_0xbbabab=[..._0x14e4d3['body'][_0x2a6b26(0x12c)]],_0x485c66=[..._0x14e4d3[_0x2a6b26(0xae)]['primary_code']],_0x61b3ce=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x11b)]],_0x1530fe=[..._0x14e4d3['body']['prod_code']],_0x5a8ebf=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x172)]],_0x458af1=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x162)]],_0x253aa5=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0xf3)]],_0x419e39=[..._0x14e4d3['body'][_0x2a6b26(0x17d)]],_0x1cc99c=[..._0x14e4d3[_0x2a6b26(0xae)]['expiry_date']],_0x418d30=[..._0x14e4d3['body'][_0x2a6b26(0x9f)]],_0xd6acf=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x96)]],_0x5e49f1=[..._0x14e4d3[_0x2a6b26(0xae)]['requested_qty']],_0x48c65b=[..._0x14e4d3['body'][_0x2a6b26(0x10f)]],_0x2196da=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x15d)]],_0x35620a=[..._0x14e4d3['body'][_0x2a6b26(0x107)]],_0x7fb74d=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x188)]],_0x5b445a=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0x175)]],_0x853894=[..._0x14e4d3[_0x2a6b26(0xae)]['prod_invoice']],_0x23dff0=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0xa4)]],_0x48c798=[..._0x14e4d3[_0x2a6b26(0xae)][_0x2a6b26(0xfc)]];const _0x4ce271=_0x55b0a5[_0x2a6b26(0x140)](_0x262382=>{return _0x262382={'product_name':_0x262382};});_0xecb6e4[_0x2a6b26(0x139)]((_0x17ac6e,_0x434a6a)=>{var _0x2f9892=_0x2a6b26;_0x4ce271[_0x434a6a][_0x2f9892(0xfa)]=Math[_0x2f9892(0x10c)](_0x17ac6e);}),_0x23dff0['forEach']((_0x5106dd,_0x410f81)=>{var _0x315040=_0x2a6b26;_0x4ce271[_0x410f81][_0x315040(0xa4)]=Math[_0x315040(0x10c)](_0x5106dd);}),_0x48c798[_0x2a6b26(0x139)]((_0x2549c6,_0x1ffac3)=>{var _0x2b050c=_0x2a6b26;_0x4ce271[_0x1ffac3][_0x2b050c(0xfc)]=_0x2549c6;}),_0xbbabab[_0x2a6b26(0x139)]((_0x47a936,_0x3ec466)=>{_0x4ce271[_0x3ec466]['quantity']=_0x47a936;}),_0x485c66['forEach']((_0x1ca82c,_0x16b1e3)=>{var _0x4697a6=_0x2a6b26;_0x4ce271[_0x16b1e3][_0x4697a6(0x8f)]=_0x1ca82c;}),_0x61b3ce[_0x2a6b26(0x139)]((_0x5bb7ef,_0x28812b)=>{var _0x5dc593=_0x2a6b26;_0x4ce271[_0x28812b][_0x5dc593(0x11b)]=_0x5bb7ef;}),_0x1530fe[_0x2a6b26(0x139)]((_0x5b9c9f,_0x57b430)=>{var _0x303203=_0x2a6b26;_0x4ce271[_0x57b430][_0x303203(0xca)]=_0x5b9c9f;}),_0x5a8ebf[_0x2a6b26(0x139)]((_0x36e965,_0x2176b8)=>{_0x5b445a['forEach']((_0x4f00b5,_0x8c1292)=>{var _0x4f4a35=a0_0x147e;if(_0x4f00b5==_0x4f4a35(0xf0)&&_0x2176b8==_0x8c1292){var _0x20da03=_0x36e965[_0x4f4a35(0x18d)](0x3);_0x4ce271[_0x2176b8][_0x4f4a35(0x144)]=_0x36e965[0x0],_0x4ce271[_0x2176b8][_0x4f4a35(0x17c)]=_0x36e965[0x1],_0x4ce271[_0x2176b8]['bay']=0x0,_0x4ce271[_0x2176b8]['bin']=0x0,_0x4ce271[_0x2176b8][_0x4f4a35(0x143)]='Floor',_0x4ce271[_0x2176b8]['floorlevel']=_0x20da03;}else{if(_0x4f00b5=='Shelves'&&_0x2176b8==_0x8c1292){var _0x20da03=_0x36e965[_0x4f4a35(0x18d)](0x3);_0x4ce271[_0x2176b8][_0x4f4a35(0x144)]=_0x36e965[0x0],_0x4ce271[_0x2176b8][_0x4f4a35(0x17c)]=_0x36e965[0x1],_0x4ce271[_0x2176b8]['bay']=0x0,_0x4ce271[_0x2176b8][_0x4f4a35(0x190)]=0x0,_0x4ce271[_0x2176b8][_0x4f4a35(0x143)]=_0x4f4a35(0xad),_0x4ce271[_0x2176b8][_0x4f4a35(0x170)]=_0x36e965[0x5];}else{if(_0x2176b8==_0x8c1292){var _0x44947d;if(_0x36e965[0x4]=='L')_0x44947d=_0x4f4a35(0x117);else _0x36e965[0x4]=='F'&&(_0x44947d=_0x4f4a35(0xad));_0x4ce271[_0x2176b8][_0x4f4a35(0x144)]=_0x36e965[0x0],_0x4ce271[_0x2176b8][_0x4f4a35(0x17c)]=_0x36e965[0x1],_0x4ce271[_0x2176b8][_0x4f4a35(0x10d)]=_0x36e965[0x2],_0x4ce271[_0x2176b8][_0x4f4a35(0x190)]=_0x36e965[0x3],_0x4ce271[_0x2176b8][_0x4f4a35(0x143)]=_0x44947d,_0x4ce271[_0x2176b8]['floorlevel']=_0x36e965[0x5];}}}});}),_0x458af1[_0x2a6b26(0x139)]((_0x11b288,_0x2abf05)=>{var _0x3acb45=_0x2a6b26;_0x4ce271[_0x2abf05][_0x3acb45(0x14f)]=_0x11b288;}),_0x253aa5[_0x2a6b26(0x139)]((_0x43c21b,_0x5c0d50)=>{_0x4ce271[_0x5c0d50]['secondary_unit']=_0x43c21b;}),_0x419e39[_0x2a6b26(0x139)]((_0x4778f9,_0xf5a7e1)=>{var _0x2f029a=_0x2a6b26;_0x4ce271[_0xf5a7e1][_0x2f029a(0x17d)]=_0x4778f9;}),_0x1cc99c['forEach']((_0x471488,_0x3f06dd)=>{_0x4ce271[_0x3f06dd]['expiry_date']=_0x471488;}),_0x418d30[_0x2a6b26(0x139)]((_0x5c6e8e,_0x1e2e05)=>{var _0x1cbb7a=_0x2a6b26;_0x4ce271[_0x1e2e05][_0x1cbb7a(0x10a)]=_0x5c6e8e;}),_0xd6acf[_0x2a6b26(0x139)]((_0x217cf1,_0x1fa8a2)=>{var _0x1cd2ce=_0x2a6b26;_0x4ce271[_0x1fa8a2][_0x1cd2ce(0x96)]=_0x217cf1;}),_0x5e49f1[_0x2a6b26(0x139)]((_0x5bb2fd,_0x438b1b)=>{var _0x387946=_0x2a6b26;_0x4ce271[_0x438b1b][_0x387946(0x109)]=_0x5bb2fd;}),_0x48c65b[_0x2a6b26(0x139)]((_0x42f313,_0x349283)=>{var _0x5e33ae=_0x2a6b26;_0x4ce271[_0x349283][_0x5e33ae(0x10f)]=_0x42f313;}),_0x2196da[_0x2a6b26(0x139)]((_0x3df7ac,_0x25f425)=>{_0x4ce271[_0x25f425]['delivery_code']=_0x3df7ac;}),_0x35620a['forEach']((_0x794792,_0x438ced)=>{var _0x17e2e9=_0x2a6b26;_0x4ce271[_0x438ced][_0x17e2e9(0x107)]=_0x794792;}),_0x7fb74d[_0x2a6b26(0x139)]((_0x3f4a9e,_0x275563)=>{_0x4ce271[_0x275563]['quantity_notConverted']=_0x3f4a9e;}),_0x5b445a[_0x2a6b26(0x139)]((_0x180f10,_0x440075)=>{var _0x57a1e2=_0x2a6b26;_0x4ce271[_0x440075][_0x57a1e2(0x16f)]=_0x180f10;}),_0x853894[_0x2a6b26(0x139)]((_0x3ffc5c,_0x208de5)=>{var _0x472394=_0x2a6b26;_0x4ce271[_0x208de5][_0x472394(0xd3)]=_0x3ffc5c;});var _0x5208fc=0x0;_0x4ce271[_0x2a6b26(0x139)](_0xdeafd5=>{var _0x374173=_0x2a6b26;(_0xdeafd5[_0x374173(0xfa)]<_0xdeafd5[_0x374173(0x90)]||_0xdeafd5[_0x374173(0x90)]==0x0)&&(console['log'](_0x374173(0x132),_0xdeafd5),_0x5208fc++);});const _0x264dbd=_0x4ce271[_0x2a6b26(0xb3)](_0x45b342=>_0x45b342[_0x2a6b26(0x188)]!=='0'&&_0x45b342[_0x2a6b26(0x188)]!==''),_0x4f5599=new sales({'invoice':_0x3990c8,'customer':_0x14e4d3['body']['customer'],'date':_0x3f45e9,'warehouse_name':_0x9678e,'sale_product':_0x264dbd,'note':_0x4cbe11,'room':_0xfbf4a5,'primary_code':_0x1e6d1b,'secondary_code':_0x128130,'prod_code':_0x4dd2ea,'SCRN':_0x413a93}),_0x54e291=await _0x4f5599[_0x2a6b26(0xcb)]();_0x14e4d3['flash'](_0x2a6b26(0xce),_0x2a6b26(0x134)),_0x1046ff[_0x2a6b26(0xc0)]('/all_sales/preview/'+_0x54e291[_0x2a6b26(0xbc)]);}catch(_0x5e6271){console['log'](_0x5e6271);}}),router[a0_0x1b291d(0x17a)](a0_0x1b291d(0x147),auth,async(_0x56342d,_0x2418c3)=>{var _0x28bb04=a0_0x1b291d;try{const {username:_0x3f595e,email:_0x4859f6,role:_0x481e8c}=_0x56342d[_0x28bb04(0xf8)],_0x9b5701=_0x56342d[_0x28bb04(0xf8)],_0x4ed70a=await profile[_0x28bb04(0x152)]({'email':_0x9b5701[_0x28bb04(0x101)]}),_0x18711a=await master_shop[_0x28bb04(0x95)](),_0x4ab6f5=_0x56342d[_0x28bb04(0x141)]['id'],_0x46e881=await sales[_0x28bb04(0x186)](_0x4ab6f5),_0x209987=await warehouse[_0x28bb04(0x16e)]([{'$match':{'name':_0x46e881[_0x28bb04(0xfb)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x28bb04(0xd0),'name':{'$first':_0x28bb04(0x17e)},'product_stock':{'$first':_0x28bb04(0x15e)},'bay':{'$first':_0x28bb04(0xab)},'bin':{'$first':_0x28bb04(0xa8)},'type':{'$first':_0x28bb04(0x184)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x28bb04(0x137)},'product_code':{'$first':_0x28bb04(0x9e)},'storage':{'$first':_0x28bb04(0x106)},'rack':{'$first':_0x28bb04(0x123)},'expiry_date':{'$first':_0x28bb04(0x179)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x28bb04(0xa3)}}}]),_0x3f53c9=await customer[_0x28bb04(0x95)]({});let _0x3d0409;if(_0x9b5701['role']=='staff'){const _0x28ff67=await staff[_0x28bb04(0x152)]({'email':_0x9b5701[_0x28bb04(0x101)]});_0x3d0409=await warehouse[_0x28bb04(0x16e)]([{'$match':{'status':_0x28bb04(0x13e),'name':_0x28ff67[_0x28bb04(0xd9)]}},{'$group':{'_id':_0x28bb04(0x12a),'name':{'$first':'$name'}}}]);}else _0x3d0409=await warehouse[_0x28bb04(0x16e)]([{'$match':{'status':_0x28bb04(0x13e)}},{'$group':{'_id':_0x28bb04(0x12a),'name':{'$first':_0x28bb04(0x12a)}}}]);const _0xf24bc8=await product[_0x28bb04(0x95)]({}),_0x2304ad=await suppliers['find']({});if(_0x18711a[0x0][_0x28bb04(0xf7)]==_0x28bb04(0xf2)){var _0xda5871=users['English'];console[_0x28bb04(0x156)](_0xda5871);}else{if(_0x18711a[0x0][_0x28bb04(0xf7)]==_0x28bb04(0xf6))var _0xda5871=users[_0x28bb04(0xf6)];else{if(_0x18711a[0x0][_0x28bb04(0xf7)]=='German')var _0xda5871=users[_0x28bb04(0xbb)];else{if(_0x18711a[0x0][_0x28bb04(0xf7)]==_0x28bb04(0x119))var _0xda5871=users[_0x28bb04(0x119)];else{if(_0x18711a[0x0][_0x28bb04(0xf7)]==_0x28bb04(0xe2))var _0xda5871=users['French'];else{if(_0x18711a[0x0][_0x28bb04(0xf7)]==_0x28bb04(0xd8))var _0xda5871=users[_0x28bb04(0x136)];else{if(_0x18711a[0x0][_0x28bb04(0xf7)]==_0x28bb04(0xe0))var _0xda5871=users[_0x28bb04(0xe0)];else{if(_0x18711a[0x0][_0x28bb04(0xf7)]==_0x28bb04(0x18c))var _0xda5871=users[_0x28bb04(0xf4)];}}}}}}}_0x2418c3[_0x28bb04(0x14b)](_0x28bb04(0xaf),{'success':_0x56342d[_0x28bb04(0xe7)]('success'),'errors':_0x56342d[_0x28bb04(0xe7)](_0x28bb04(0xb7)),'role':_0x9b5701,'profile':_0x4ed70a,'customer':_0x3f53c9,'warehouse':_0x3d0409,'product':_0x209987,'user':_0x46e881,'master_shop':_0x18711a,'unit':_0xf24bc8,'language':_0xda5871,'suppliers':_0x2304ad});}catch(_0x73b75e){console[_0x28bb04(0x156)](_0x73b75e);}}),router[a0_0x1b291d(0x181)](a0_0x1b291d(0x147),auth,async(_0x417dd2,_0x3ab6b6)=>{var _0x4bc4f6=a0_0x1b291d;try{const _0x45289c=_0x417dd2[_0x4bc4f6(0x141)]['id'],{invoice:_0x33219f,warehouse_name:_0x5eab61,room:_0x22ae08}=_0x417dd2[_0x4bc4f6(0xae)],_0x1c9622=await sales[_0x4bc4f6(0x152)]({'invoice':_0x33219f}),_0x4c6faa=_0x1c9622[_0x4bc4f6(0x160)][_0x4bc4f6(0x140)](async _0x579a56=>{var _0x388cf3=_0x4bc4f6,_0x3a7f99=await warehouse[_0x388cf3(0x152)]({'name':_0x5eab61,'room':_0x579a56['room_name'],'warehouse_category':_0x388cf3(0x16a)});const _0x1a3794=_0x3a7f99[_0x388cf3(0x174)][_0x388cf3(0x140)](_0x35004f=>{var _0x3973df=_0x388cf3;_0x35004f[_0x3973df(0x16d)]==_0x579a56[_0x3973df(0x16d)]&&_0x35004f['floorlevel']==_0x579a56[_0x3973df(0x170)]&&_0x35004f[_0x3973df(0x143)]==_0x579a56[_0x3973df(0x143)]&&_0x35004f['bin']==_0x579a56[_0x3973df(0x190)]&&_0x35004f[_0x3973df(0x10d)]==_0x579a56[_0x3973df(0x10d)]&&_0x35004f[_0x3973df(0x17c)]==_0x579a56[_0x3973df(0x17c)]&&_0x35004f[_0x3973df(0x144)]==_0x579a56[_0x3973df(0x144)]&&_0x35004f[_0x3973df(0xfe)]==_0x579a56['expiry_date']&&_0x35004f['batch_code']==_0x579a56[_0x3973df(0x17d)]&&_0x35004f[_0x3973df(0xd3)]==_0x579a56[_0x3973df(0xd3)]&&(_0x35004f[_0x3973df(0x124)]=Math[_0x3973df(0x10c)](_0x35004f['product_stock'])-Math[_0x3973df(0x10c)](_0x579a56[_0x3973df(0x188)]));});return _0x3a7f99;});Promise[_0x4bc4f6(0x16c)](_0x4c6faa)[_0x4bc4f6(0x102)](async _0x4dc4c9=>{var _0x4d04b3=_0x4bc4f6;try{for(const _0xb28ef0 of _0x4dc4c9){await _0xb28ef0[_0x4d04b3(0xcb)]();}_0x1c9622['finalize']='True';const _0x2ddad7=await _0x1c9622['save'](),_0x175ac1=await master_shop['find'](),_0xa5eb7=await email_settings[_0x4d04b3(0x152)](),_0x1cd712=await supervisor_settings[_0x4d04b3(0x95)]();var _0x9115e1=_0x1c9622[_0x4d04b3(0x160)],_0xdcf40a='',_0x4e9637;for(_0x4e9637 in _0x9115e1){_0xdcf40a+=_0x4d04b3(0x164)+_0x4d04b3(0xcd)+_0x9115e1[_0x4e9637][_0x4d04b3(0x16d)]+'</td>'+_0x4d04b3(0xcd)+_0x9115e1[_0x4e9637][_0x4d04b3(0xca)]+_0x4d04b3(0x12f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x9115e1[_0x4e9637][_0x4d04b3(0x188)]+_0x4d04b3(0x12f)+_0x4d04b3(0xcd)+_0x9115e1[_0x4e9637][_0x4d04b3(0x14f)]+_0x4d04b3(0x12f)+_0x4d04b3(0xcd)+_0x9115e1[_0x4e9637][_0x4d04b3(0xf3)]+_0x4d04b3(0x12f)+_0x4d04b3(0xcd)+_0x1c9622[_0x4d04b3(0xfb)]+_0x4d04b3(0x12f)+_0x4d04b3(0xcd)+_0x9115e1[_0x4e9637][_0x4d04b3(0x16f)]+_0x4d04b3(0x12f)+_0x4d04b3(0xcd)+_0x9115e1[_0x4e9637][_0x4d04b3(0x144)]+_0x9115e1[_0x4e9637][_0x4d04b3(0x17c)]+_0x9115e1[_0x4e9637][_0x4d04b3(0x10d)]+_0x9115e1[_0x4e9637][_0x4d04b3(0x190)]+_0x9115e1[_0x4e9637][_0x4d04b3(0x143)][0x0]+_0x9115e1[_0x4e9637]['floorlevel']+'</td>',_0x4d04b3(0x163);}let _0x4a9e94=nodemailer[_0x4d04b3(0x18b)]({'host':_0xa5eb7[_0x4d04b3(0xc6)],'port':Number(_0xa5eb7[_0x4d04b3(0x173)]),'secure':![],'auth':{'user':_0xa5eb7[_0x4d04b3(0x101)],'pass':_0xa5eb7['password']}}),_0x4fd74b={'from':_0xa5eb7['email'],'to':_0x1cd712[0x0][_0x4d04b3(0xe6)],'subject':'Sales\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x175ac1[0x0][_0x4d04b3(0x151)],'cid':_0x4d04b3(0x14c)}],'html':_0x4d04b3(0xcf)+_0x4d04b3(0x104)+_0x4d04b3(0x15a)+_0x4d04b3(0xa1)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4d04b3(0xa1)+_0x4d04b3(0x145)+_0x4d04b3(0x131)+_0x4d04b3(0xa1)+_0x4d04b3(0xbd)+_0x175ac1[0x0][_0x4d04b3(0x167)]+_0x4d04b3(0x135)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x4d04b3(0xa1)+_0x4d04b3(0xba)+_0x4d04b3(0xa6)+_0x1c9622[_0x4d04b3(0xd3)]+'\x20'+_0x4d04b3(0x14d)+_0x4d04b3(0xde)+_0x1c9622[_0x4d04b3(0x12b)]+'\x20'+_0x4d04b3(0xdb)+_0x4d04b3(0x166)+'</div>'+_0x4d04b3(0x15c)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4d04b3(0x164)+_0x4d04b3(0x16b)+_0x4d04b3(0xff)+_0x4d04b3(0x18f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x4d04b3(0x18e)+_0x4d04b3(0x149)+_0x4d04b3(0x15f)+_0x4d04b3(0xd6)+_0x4d04b3(0x163)+_0x4d04b3(0x129)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xdcf40a+'\x20'+_0x4d04b3(0x105)+_0x4d04b3(0x168)+_0x4d04b3(0xa1)+_0x4d04b3(0x18a)+_0x4d04b3(0x92)+_0x175ac1[0x0][_0x4d04b3(0x167)]+_0x4d04b3(0x166)+_0x4d04b3(0x131)+_0x4d04b3(0x131)+_0x4d04b3(0x11d)};_0x4a9e94['sendMail'](_0x4fd74b,function(_0x33981c,_0x2e16b9){var _0x4e0ddd=_0x4d04b3;_0x33981c?(console['log'](_0x33981c),console[_0x4e0ddd(0x156)](_0x4e0ddd(0x138))):console[_0x4e0ddd(0x156)]('Email\x20sent\x20successfully');}),_0x417dd2[_0x4d04b3(0xe7)](_0x4d04b3(0xce),_0x4d04b3(0xec)),_0x3ab6b6[_0x4d04b3(0xc0)](_0x4d04b3(0x103)+_0x45289c);}catch(_0x239a9d){console[_0x4d04b3(0x93)](_0x239a9d),_0x3ab6b6['status'](0x1f4)[_0x4d04b3(0x185)]({'error':_0x4d04b3(0xc1)});}})['catch'](_0x44d3ef=>{var _0x50e151=_0x4bc4f6;console['error'](_0x44d3ef),_0x3ab6b6['status'](0x1f4)[_0x50e151(0x185)]({'error':'An\x20error\x20occurred.'});});}catch(_0x21d311){console[_0x4bc4f6(0x156)](_0x21d311);}}),router[a0_0x1b291d(0x17a)](a0_0x1b291d(0xc9),auth,async(_0x59d37a,_0xeab8dd)=>{var _0x4f5b51=a0_0x1b291d;try{const {username:_0x141594,email:_0x290a90,role:_0x4829ad}=_0x59d37a[_0x4f5b51(0xf8)],_0x5722bb=_0x59d37a[_0x4f5b51(0xf8)],_0x2d372e=await profile[_0x4f5b51(0x152)]({'email':_0x5722bb['email']}),_0x469e43=await master_shop[_0x4f5b51(0x95)](),_0x2fcdbd=_0x59d37a[_0x4f5b51(0x141)]['id'],_0x12a338=await sales[_0x4f5b51(0x186)](_0x2fcdbd);var _0x525689=['Ambient',_0x4f5b51(0x122)];const _0xa88727=await warehouse[_0x4f5b51(0x16e)]([{'$match':{'name':_0x12a338[_0x4f5b51(0xfb)],'warehouse_category':_0x4f5b51(0x16a)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4f5b51(0xd0),'name':{'$first':_0x4f5b51(0x17e)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4f5b51(0xab)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x4f5b51(0x13b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4f5b51(0x9e)},'storage':{'$first':_0x4f5b51(0x106)},'rack':{'$first':_0x4f5b51(0x123)}}}]),_0x49c380=await customer[_0x4f5b51(0x95)]({});let _0x504087;if(_0x5722bb['role']==_0x4f5b51(0x150)){const _0x454b8a=await staff['findOne']({'email':_0x5722bb['email']});_0x504087=await warehouse['aggregate']([{'$match':{'status':_0x4f5b51(0x13e),'name':_0x454b8a[_0x4f5b51(0xd9)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x4f5b51(0x12a)}}}]);}else _0x504087=await warehouse[_0x4f5b51(0x16e)]([{'$match':{'status':_0x4f5b51(0x13e),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4f5b51(0x12a),'name':{'$first':_0x4f5b51(0x12a)}}}]);const _0xe59502=await product['find']({});if(_0x469e43[0x0]['language']==_0x4f5b51(0xf2)){var _0x59e5cd=users[_0x4f5b51(0xdc)];console['log'](_0x59e5cd);}else{if(_0x469e43[0x0][_0x4f5b51(0xf7)]==_0x4f5b51(0xf6))var _0x59e5cd=users[_0x4f5b51(0xf6)];else{if(_0x469e43[0x0]['language']==_0x4f5b51(0xbb))var _0x59e5cd=users['German'];else{if(_0x469e43[0x0]['language']=='Spanish')var _0x59e5cd=users['Spanish'];else{if(_0x469e43[0x0][_0x4f5b51(0xf7)]==_0x4f5b51(0xe2))var _0x59e5cd=users[_0x4f5b51(0xe2)];else{if(_0x469e43[0x0][_0x4f5b51(0xf7)]==_0x4f5b51(0xd8))var _0x59e5cd=users[_0x4f5b51(0x136)];else{if(_0x469e43[0x0][_0x4f5b51(0xf7)]==_0x4f5b51(0xe0))var _0x59e5cd=users['Chinese'];else{if(_0x469e43[0x0]['language']==_0x4f5b51(0x18c))var _0x59e5cd=users[_0x4f5b51(0xf4)];}}}}}}}_0xeab8dd[_0x4f5b51(0x14b)](_0x4f5b51(0x187),{'success':_0x59d37a['flash'](_0x4f5b51(0xce)),'errors':_0x59d37a[_0x4f5b51(0xe7)](_0x4f5b51(0xb7)),'role':_0x5722bb,'profile':_0x2d372e,'customer':_0x49c380,'warehouse':_0x504087,'product':_0xa88727,'user':_0x12a338,'master_shop':_0x469e43,'unit':_0xe59502,'language':_0x59e5cd});}catch(_0x4b8e71){console[_0x4f5b51(0x156)](_0x4b8e71);}}),router[a0_0x1b291d(0x181)](a0_0x1b291d(0xc9),auth,async(_0x536fc2,_0x34294d)=>{var _0x31be6d=a0_0x1b291d;try{const _0x702639=_0x536fc2['params']['id'],_0x224ba8=await sales[_0x31be6d(0x152)]({'_id':_0x536fc2[_0x31be6d(0x141)]['id']}),_0x26c319=await warehouse[_0x31be6d(0x152)]({'name':_0x224ba8['warehouse_name'],'room':_0x536fc2[_0x31be6d(0xae)]['room']}),{invoice:_0x33a5b7,date:_0x88603c,warehouse_name:_0x3f1fbe,product_name:_0x21760f,stock:_0x5c005c,quantity:_0x26da72,note:_0x3c4e3c,room:_0x32d816,customer:_0x4074e3,SCRN:_0x125e54}=_0x536fc2[_0x31be6d(0xae)];if(typeof _0x21760f==_0x31be6d(0xd7))var _0x572772=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x16d)]],_0x57aec3=[_0x536fc2[_0x31be6d(0xae)]['stock']],_0x72267d=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x12c)]],_0x5c1e0e=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x8f)]],_0xa32077=[_0x536fc2[_0x31be6d(0xae)]['secondary_code']],_0x5d7807=[_0x536fc2[_0x31be6d(0xae)]['prod_code']],_0x1c409c=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x172)]],_0x190e17=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x162)]],_0x424553=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0xf3)]],_0x5b0b15=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x17d)]],_0x2636d3=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0xfe)]],_0x817da8=[_0x536fc2[_0x31be6d(0xae)]['max_per_unit']],_0x310508=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x96)]],_0x5ae62e=[_0x536fc2['body']['requested_qty']],_0x2bcde7=[_0x536fc2[_0x31be6d(0xae)]['delivery_date']],_0x42d7c1=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x15d)]],_0x1851e4=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x107)]],_0x2fbbca=[_0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x188)]],_0x48c39a=[_0x536fc2['body'][_0x31be6d(0x175)]];else var _0x572772=[..._0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x16d)]],_0x57aec3=[..._0x536fc2[_0x31be6d(0xae)]['stock']],_0x72267d=[..._0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x12c)]],_0x5c1e0e=[..._0x536fc2['body'][_0x31be6d(0x8f)]],_0xa32077=[..._0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x11b)]],_0x5d7807=[..._0x536fc2['body'][_0x31be6d(0xd4)]],_0x1c409c=[..._0x536fc2['body']['level']],_0x190e17=[..._0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x162)]],_0x424553=[..._0x536fc2['body'][_0x31be6d(0xf3)]],_0x5b0b15=[..._0x536fc2['body']['batch_code']],_0x2636d3=[..._0x536fc2['body'][_0x31be6d(0xfe)]],_0x817da8=[..._0x536fc2[_0x31be6d(0xae)][_0x31be6d(0x9f)]],_0x310508=[..._0x536fc2['body']['production_date']],_0x5ae62e=[..._0x536fc2[_0x31be6d(0xae)]['requested_qty']],_0x2bcde7=[..._0x536fc2['body'][_0x31be6d(0x10f)]],_0x42d7c1=[..._0x536fc2['body'][_0x31be6d(0x15d)]],_0x1851e4=[..._0x536fc2[_0x31be6d(0xae)]['prod_cat']],_0x2fbbca=[..._0x536fc2['body'][_0x31be6d(0x188)]],_0x48c39a=[..._0x536fc2[_0x31be6d(0xae)]['RoomAssigned']];const _0x476ab6=_0x572772[_0x31be6d(0x140)](_0x159312=>{return _0x159312={'product_name':_0x159312};});_0x57aec3[_0x31be6d(0x139)]((_0x53feba,_0x11ae2b)=>{var _0x42db94=_0x31be6d;_0x476ab6[_0x11ae2b][_0x42db94(0xfa)]=Math['abs'](_0x53feba);}),_0x72267d[_0x31be6d(0x139)]((_0x6cab54,_0x44e3b5)=>{var _0x1e1be4=_0x31be6d;_0x476ab6[_0x44e3b5][_0x1e1be4(0x188)]=_0x6cab54;}),_0x5c1e0e[_0x31be6d(0x139)]((_0x5a8393,_0x5f4379)=>{var _0x92004e=_0x31be6d;_0x476ab6[_0x5f4379][_0x92004e(0x8f)]=_0x5a8393;}),_0xa32077[_0x31be6d(0x139)]((_0xb79f14,_0x26ef1b)=>{var _0x5d8c25=_0x31be6d;_0x476ab6[_0x26ef1b][_0x5d8c25(0x11b)]=_0xb79f14;}),_0x5d7807['forEach']((_0x4f284e,_0x3ae598)=>{var _0x4b27da=_0x31be6d;_0x476ab6[_0x3ae598][_0x4b27da(0xca)]=_0x4f284e;}),_0x1c409c[_0x31be6d(0x139)]((_0x35182f,_0xa57068)=>{var _0x37aac=_0x31be6d;_0x48c39a[_0x37aac(0x139)]((_0x27e85f,_0xdac3e1)=>{var _0x258f65=_0x37aac;if(_0x27e85f==_0x258f65(0xf0)&&_0xa57068==_0xdac3e1){var _0xb799ab=_0x35182f[_0x258f65(0x18d)](0x3);_0x476ab6[_0xa57068][_0x258f65(0x144)]=_0x35182f[0x0],_0x476ab6[_0xa57068][_0x258f65(0x17c)]=_0x35182f[0x1],_0x476ab6[_0xa57068][_0x258f65(0x10d)]=0x0,_0x476ab6[_0xa57068][_0x258f65(0x190)]=0x0,_0x476ab6[_0xa57068][_0x258f65(0x143)]='Floor',_0x476ab6[_0xa57068][_0x258f65(0x170)]=_0xb799ab;}else{if(_0x27e85f==_0x258f65(0x10b)&&_0xa57068==_0xdac3e1){var _0xb799ab=_0x35182f['slice'](0x3);_0x476ab6[_0xa57068]['storage']=_0x35182f[0x0],_0x476ab6[_0xa57068]['rack']=_0x35182f[0x1],_0x476ab6[_0xa57068][_0x258f65(0x10d)]=0x0,_0x476ab6[_0xa57068][_0x258f65(0x190)]=0x0,_0x476ab6[_0xa57068][_0x258f65(0x143)]=_0x258f65(0xad),_0x476ab6[_0xa57068]['floorlevel']=_0x35182f[0x5];}else{if(_0xa57068==_0xdac3e1){var _0x31c2d6;if(_0x35182f[0x4]=='L')_0x31c2d6=_0x258f65(0x117);else _0x35182f[0x4]=='F'&&(_0x31c2d6='Floor');_0x476ab6[_0xa57068][_0x258f65(0x144)]=_0x35182f[0x0],_0x476ab6[_0xa57068]['rack']=_0x35182f[0x1],_0x476ab6[_0xa57068][_0x258f65(0x10d)]=_0x35182f[0x2],_0x476ab6[_0xa57068][_0x258f65(0x190)]=_0x35182f[0x3],_0x476ab6[_0xa57068][_0x258f65(0x143)]=_0x31c2d6,_0x476ab6[_0xa57068][_0x258f65(0x170)]=_0x35182f[0x5];}}}});}),_0x190e17[_0x31be6d(0x139)]((_0x2c5e11,_0x155958)=>{var _0x3877c4=_0x31be6d;_0x476ab6[_0x155958][_0x3877c4(0x14f)]=_0x2c5e11;}),_0x424553[_0x31be6d(0x139)]((_0xa65190,_0x1c4060)=>{var _0x5d10da=_0x31be6d;_0x476ab6[_0x1c4060][_0x5d10da(0xf3)]=_0xa65190;}),_0x5b0b15[_0x31be6d(0x139)]((_0x14d380,_0x366f5a)=>{var _0x279555=_0x31be6d;_0x476ab6[_0x366f5a][_0x279555(0x17d)]=_0x14d380;}),_0x2636d3[_0x31be6d(0x139)]((_0x2afb67,_0x4c33d7)=>{var _0x55fd35=_0x31be6d;_0x476ab6[_0x4c33d7][_0x55fd35(0xfe)]=_0x2afb67;}),_0x817da8[_0x31be6d(0x139)]((_0x30f445,_0x807af5)=>{var _0x564024=_0x31be6d;_0x476ab6[_0x807af5][_0x564024(0x10a)]=_0x30f445;}),_0x310508[_0x31be6d(0x139)]((_0x589356,_0x18cfea)=>{_0x476ab6[_0x18cfea]['production_date']=_0x589356;}),_0x5ae62e[_0x31be6d(0x139)]((_0x375891,_0x47a903)=>{_0x476ab6[_0x47a903]['requested_qty']=Math['abs'](_0x375891);}),_0x2bcde7['forEach']((_0x41e5bb,_0x1a8f53)=>{var _0x3311e4=_0x31be6d;_0x476ab6[_0x1a8f53][_0x3311e4(0x10f)]=_0x41e5bb;}),_0x42d7c1[_0x31be6d(0x139)]((_0x266169,_0x54f44c)=>{_0x476ab6[_0x54f44c]['delivery_code']=_0x266169;}),_0x1851e4[_0x31be6d(0x139)]((_0x300940,_0x57222c)=>{var _0x382eaf=_0x31be6d;_0x476ab6[_0x57222c][_0x382eaf(0x107)]=_0x300940;}),_0x2fbbca[_0x31be6d(0x139)]((_0x4f508b,_0x2e8f1d)=>{var _0x4bca74=_0x31be6d;_0x476ab6[_0x2e8f1d][_0x4bca74(0x90)]=_0x4f508b;}),_0x48c39a[_0x31be6d(0x139)]((_0x20d11f,_0xd20cff)=>{_0x476ab6[_0xd20cff]['room_name']=_0x20d11f;});var _0x401d49=0x0;_0x476ab6[_0x31be6d(0x139)](_0x440cba=>{var _0x1f1922=_0x31be6d;console[_0x1f1922(0x156)](_0x1f1922(0x132),_0x440cba),(parseInt(_0x440cba[_0x1f1922(0xfa)])<parseInt(_0x440cba[_0x1f1922(0x188)])||parseInt(_0x440cba[_0x1f1922(0x188)])==0x0)&&_0x401d49++;});if(_0x401d49!=0x0)return _0x536fc2[_0x31be6d(0xe7)](_0x31be6d(0xb7),_0x31be6d(0x8d)),_0x34294d['redirect'](_0x31be6d(0xbf));const _0x216697=_0x476ab6['filter'](_0x3d44b1=>_0x3d44b1['quantity']!=='0'&&_0x3d44b1[_0x31be6d(0x188)]!=='');_0x224ba8[_0x31be6d(0xd3)]=_0x33a5b7,_0x224ba8['customer']=_0x4074e3,_0x224ba8[_0x31be6d(0x12b)]=_0x88603c,_0x224ba8[_0x31be6d(0xfb)]=_0x3f1fbe,_0x224ba8[_0x31be6d(0x160)]=_0x216697,_0x224ba8['note']=_0x3c4e3c,_0x224ba8[_0x31be6d(0x99)]=_0x125e54,_0x224ba8[_0x31be6d(0xe9)]=_0x31be6d(0xb1),_0x224ba8[_0x31be6d(0xa0)]=_0x31be6d(0xb1);const _0x425aeb=await _0x224ba8[_0x31be6d(0xcb)]();_0x536fc2['flash'](_0x31be6d(0xce),_0x31be6d(0xec)),_0x34294d[_0x31be6d(0xc0)](_0x31be6d(0x121));}catch(_0x53fcf6){console[_0x31be6d(0x156)](_0x53fcf6);}}),router[a0_0x1b291d(0x181)]('/give_payment/:id',auth,async(_0x2c129a,_0x562a27)=>{var _0x2b06d9=a0_0x1b291d;try{const _0x11a6aa=_0x2c129a[_0x2b06d9(0x141)]['id'],{invoice:_0x2bc32c,customer:_0x2ffdab,receivable_amount:_0x265971,received_amount:_0x5ee6a8}=_0x2c129a[_0x2b06d9(0xae)],_0x436765=await sales[_0x2b06d9(0x186)](_0x11a6aa);console[_0x2b06d9(0x156)](_0x436765);var _0x5d14d6=_0x265971-_0x5ee6a8;console[_0x2b06d9(0x156)](_0x5ee6a8),_0x436765['received_amount']=parseFloat(_0x5ee6a8)+parseFloat(_0x436765[_0x2b06d9(0x161)]),_0x436765['due_amount']=_0x5d14d6,console['log'](_0x436765);const _0x55d11f=await _0x436765[_0x2b06d9(0xcb)](),_0x286292=await c_payment_data[_0x2b06d9(0x152)]({'invoice':_0x2bc32c});_0x286292['amount']=_0x5d14d6,await _0x286292['save']();let _0x351940=new Date(),_0x4b9a15=('0'+_0x351940['getDate']())[_0x2b06d9(0x18d)](-0x2),_0x22206c=('0'+(_0x351940[_0x2b06d9(0x100)]()+0x1))['slice'](-0x2),_0x339073=_0x351940[_0x2b06d9(0x127)](),_0x38da5a=_0x339073+'-'+_0x22206c+'-'+_0x4b9a15;const _0x491849=new customer_payment({'invoice':_0x2bc32c,'date':_0x339073+'-'+_0x22206c+'-'+_0x4b9a15,'customer':_0x2ffdab,'reason':_0x2b06d9(0xa2),'amount':_0x5ee6a8}),_0x123af0=await _0x491849[_0x2b06d9(0xcb)]();_0x2c129a['flash'](_0x2b06d9(0xce),_0x2b06d9(0x157)),_0x562a27['redirect']('/all_sales/view');}catch(_0xa6c6ca){console['log'](_0xa6c6ca);}}),router['get'](a0_0x1b291d(0x154),auth,async(_0x5e0cce,_0x2e6c1a)=>{var _0x4fd626=a0_0x1b291d;try{const {username:_0x1a5f8e,email:_0x39d4f7,role:_0x337dcd}=_0x5e0cce[_0x4fd626(0xf8)],_0x575676=_0x5e0cce['user'],_0x189d8e=await profile[_0x4fd626(0x152)]({'email':_0x575676[_0x4fd626(0x101)]}),_0x391f91=await master_shop[_0x4fd626(0x95)]();console[_0x4fd626(0x156)](_0x4fd626(0x17b),_0x391f91);const _0x67839a=_0x5e0cce[_0x4fd626(0x141)]['id'],_0x1bd0c0=await sales[_0x4fd626(0x186)](_0x67839a);console[_0x4fd626(0x156)](_0x1bd0c0);const _0x31123c=await customer[_0x4fd626(0x152)]({'name':_0x1bd0c0[_0x4fd626(0x194)]});console[_0x4fd626(0x156)](_0x31123c);if(_0x391f91[0x0][_0x4fd626(0xf7)]==_0x4fd626(0xf2)){var _0x21c078=users[_0x4fd626(0xdc)];console['log'](_0x21c078);}else{if(_0x391f91[0x0][_0x4fd626(0xf7)]==_0x4fd626(0xf6))var _0x21c078=users[_0x4fd626(0xf6)];else{if(_0x391f91[0x0][_0x4fd626(0xf7)]=='German')var _0x21c078=users[_0x4fd626(0xbb)];else{if(_0x391f91[0x0]['language']==_0x4fd626(0x119))var _0x21c078=users[_0x4fd626(0x119)];else{if(_0x391f91[0x0][_0x4fd626(0xf7)]==_0x4fd626(0xe2))var _0x21c078=users[_0x4fd626(0xe2)];else{if(_0x391f91[0x0][_0x4fd626(0xf7)]=='Portuguese\x20(BR)')var _0x21c078=users[_0x4fd626(0x136)];else{if(_0x391f91[0x0][_0x4fd626(0xf7)]==_0x4fd626(0xe0))var _0x21c078=users[_0x4fd626(0xe0)];else{if(_0x391f91[0x0]['language']==_0x4fd626(0x18c))var _0x21c078=users[_0x4fd626(0xf4)];}}}}}}}_0x2e6c1a[_0x4fd626(0x14b)]('sales_invoice',{'success':_0x5e0cce[_0x4fd626(0xe7)](_0x4fd626(0xce)),'errors':_0x5e0cce[_0x4fd626(0xe7)](_0x4fd626(0xb7)),'role':_0x575676,'profile':_0x189d8e,'master_shop':_0x391f91,'customers':_0x31123c,'sales':_0x1bd0c0,'language':_0x21c078});}catch(_0x33efaf){console[_0x4fd626(0x156)](_0x33efaf);}}),router['get'](a0_0x1b291d(0x114),auth,async(_0x16dc56,_0x40f4ed)=>{var _0x139719=a0_0x1b291d;try{const {username:_0x2eb109,email:_0x3ddae5,role:_0x5dac8c}=_0x16dc56[_0x139719(0xf8)],_0x3b7d18=_0x16dc56['user'],_0x3fa0a2=await profile['findOne']({'email':_0x3b7d18[_0x139719(0x101)]}),_0x26d450=await master_shop[_0x139719(0x95)]();console[_0x139719(0x156)](_0x139719(0x17b),_0x26d450);const _0x514891=_0x16dc56[_0x139719(0x141)]['id'];console[_0x139719(0x156)](_0x514891);const _0x2aa38f=await sales[_0x139719(0x186)](_0x514891);console[_0x139719(0x156)]('user_id',_0x2aa38f);const _0x154e09=await warehouse[_0x139719(0x16e)]([{'$match':{'name':_0x139719(0x158),'room':'Return\x20Rooms'}},{'$unwind':_0x139719(0xcc)},{'$group':{'_id':_0x139719(0xd0),'name':{'$first':_0x139719(0x17e)},'product_stock':{'$first':_0x139719(0x15e)},'level':{'$first':_0x139719(0x94)},'isle':{'$first':_0x139719(0xe8)},'pallet':{'$first':_0x139719(0xc8)},'primary_code':{'$first':_0x139719(0xda)},'secondary_code':{'$first':_0x139719(0x137)},'product_code':{'$first':_0x139719(0x9e)}}}]);console['log'](_0x139719(0x165),_0x154e09);const _0x5420fb=await product[_0x139719(0x95)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x139719(0x13e),'name':_0x139719(0x158),'warehouse_category':_0x139719(0x16a)}},{'$group':{'_id':_0x139719(0x12a),'name':{'$first':_0x139719(0x12a)}}},{'$sort':{'name':0x1}}]);var _0x4f26a6=[_0x139719(0x182)];if(_0x26d450[0x0][_0x139719(0xf7)]=='English\x20(US)'){var _0x1012e0=users[_0x139719(0xdc)];console['log'](_0x1012e0);}else{if(_0x26d450[0x0][_0x139719(0xf7)]==_0x139719(0xf6))var _0x1012e0=users['Hindi'];else{if(_0x26d450[0x0][_0x139719(0xf7)]=='German')var _0x1012e0=users['German'];else{if(_0x26d450[0x0][_0x139719(0xf7)]==_0x139719(0x119))var _0x1012e0=users['Spanish'];else{if(_0x26d450[0x0]['language']==_0x139719(0xe2))var _0x1012e0=users[_0x139719(0xe2)];else{if(_0x26d450[0x0][_0x139719(0xf7)]==_0x139719(0xd8))var _0x1012e0=users[_0x139719(0x136)];else{if(_0x26d450[0x0][_0x139719(0xf7)]=='Chinese')var _0x1012e0=users['Chinese'];else{if(_0x26d450[0x0][_0x139719(0xf7)]==_0x139719(0x18c))var _0x1012e0=users[_0x139719(0xf4)];}}}}}}}_0x40f4ed['render'](_0x139719(0x130),{'success':_0x16dc56['flash'](_0x139719(0xce)),'errors':_0x16dc56[_0x139719(0xe7)](_0x139719(0xb7)),'role':_0x3b7d18,'profile':_0x3fa0a2,'user':_0x2aa38f,'stock':_0x154e09,'master_shop':_0x26d450,'unit':_0x5420fb,'language':_0x1012e0,'warehouses':warehouse_data,'rooms':_0x4f26a6});}catch(_0x19697f){console[_0x139719(0x156)](_0x19697f),_0x40f4ed['status'](0xc8)['json']({'message':_0x19697f[_0x139719(0x111)]});}}),router['post']('/view/return_sales/:id',auth,async(_0x389b42,_0x399f40)=>{var _0x14f2c0=a0_0x1b291d;try{const {invoice:_0x565df6,date:_0x169893,warehouse_name:_0x16738f,product_name:_0x5c4a6f,primary_code:_0x3b1847,secondary_code:_0x39c0f9,product_code:_0x225fd3,sales_quantity:_0x3b8d02,stocks:_0x36bd8c,return_qty:_0x4311b6,Room_name:_0x312aa6,to_warehouse_name:_0x4d1b8d,to_Roomname:_0x1902fa,to_Room_name:_0x3e8c84,note:_0x349baa,level:_0x1be3ea,isle:_0x12d122,pallet:_0x95272b}=_0x389b42[_0x14f2c0(0xae)];if(typeof _0x5c4a6f==_0x14f2c0(0xd7))var _0x51f610=[_0x389b42[_0x14f2c0(0xae)]['product_name']],_0x2cd1c7=[_0x389b42['body']['primary_code']],_0x209925=[_0x389b42[_0x14f2c0(0xae)][_0x14f2c0(0x11b)]],_0x5ca44f=[_0x389b42[_0x14f2c0(0xae)][_0x14f2c0(0xca)]],_0x1f3718=[_0x389b42[_0x14f2c0(0xae)][_0x14f2c0(0x9b)]],_0x53be78=[_0x389b42['body'][_0x14f2c0(0xc3)]],_0x3e7a4f=[_0x389b42[_0x14f2c0(0xae)]['return_qty']],_0x460f73=[_0x389b42['body'][_0x14f2c0(0x10d)]],_0x502160=[_0x389b42['body'][_0x14f2c0(0x190)]],_0x24b4e7=[_0x389b42[_0x14f2c0(0xae)][_0x14f2c0(0xbe)]],_0x42f2a6=[_0x389b42[_0x14f2c0(0xae)][_0x14f2c0(0x170)]];else var _0x51f610=[..._0x389b42['body'][_0x14f2c0(0x16d)]],_0x2cd1c7=[..._0x389b42['body'][_0x14f2c0(0x8f)]],_0x209925=[..._0x389b42[_0x14f2c0(0xae)][_0x14f2c0(0x11b)]],_0x5ca44f=[..._0x389b42['body'][_0x14f2c0(0xca)]],_0x1f3718=[..._0x389b42['body'][_0x14f2c0(0x9b)]],_0x53be78=[..._0x389b42[_0x14f2c0(0xae)]['stocks']],_0x3e7a4f=[..._0x389b42[_0x14f2c0(0xae)][_0x14f2c0(0x193)]],_0x460f73=[..._0x389b42['body'][_0x14f2c0(0x10d)]],_0x502160=[..._0x389b42[_0x14f2c0(0xae)]['bin']],_0x24b4e7=[..._0x389b42['body'][_0x14f2c0(0xbe)]],_0x42f2a6=[..._0x389b42[_0x14f2c0(0xae)][_0x14f2c0(0x170)]];const _0x39e0ad=_0x51f610[_0x14f2c0(0x140)](_0x237e6e=>{return _0x237e6e={'product_name':_0x237e6e};});_0x2cd1c7[_0x14f2c0(0x139)]((_0x269f50,_0x2046ad)=>{var _0xc5bf4e=_0x14f2c0;_0x39e0ad[_0x2046ad][_0xc5bf4e(0x8f)]=_0x269f50;}),_0x209925[_0x14f2c0(0x139)]((_0x6396f3,_0xfd53cc)=>{var _0x800aa6=_0x14f2c0;_0x39e0ad[_0xfd53cc][_0x800aa6(0x11b)]=_0x6396f3;}),_0x5ca44f[_0x14f2c0(0x139)]((_0x4b1aa8,_0x21c85a)=>{var _0x2d9005=_0x14f2c0;_0x39e0ad[_0x21c85a][_0x2d9005(0xca)]=_0x4b1aa8;}),_0x1f3718['forEach']((_0x1941e7,_0x46ad0a)=>{_0x39e0ad[_0x46ad0a]['sale_qty']=_0x1941e7;}),_0x53be78[_0x14f2c0(0x139)]((_0x1199e2,_0x5e3ed6)=>{var _0x14c2bd=_0x14f2c0;_0x39e0ad[_0x5e3ed6][_0x14c2bd(0xfa)]=_0x1199e2;}),_0x3e7a4f[_0x14f2c0(0x139)]((_0x5d7136,_0x3175fd)=>{var _0x2d8618=_0x14f2c0;_0x39e0ad[_0x3175fd][_0x2d8618(0x193)]=_0x5d7136;}),_0x460f73['forEach']((_0x3ca675,_0x157851)=>{var _0x6b65c5=_0x14f2c0;_0x39e0ad[_0x157851][_0x6b65c5(0x10d)]=_0x3ca675;}),_0x502160['forEach']((_0x162a8c,_0x4e0b77)=>{_0x39e0ad[_0x4e0b77]['bin']=_0x162a8c;}),_0x24b4e7[_0x14f2c0(0x139)]((_0x4c793f,_0xf398a7)=>{var _0x1901c6=_0x14f2c0;_0x39e0ad[_0xf398a7][_0x1901c6(0x143)]=_0x4c793f;}),_0x42f2a6[_0x14f2c0(0x139)]((_0x570553,_0x52477d)=>{var _0x2f21a3=_0x14f2c0;_0x39e0ad[_0x52477d][_0x2f21a3(0x170)]=_0x570553;});var _0x5ca96c=0x0;_0x39e0ad[_0x14f2c0(0x139)](_0x329a56=>{var _0x2b7b3a=_0x14f2c0;console['log'](_0x2b7b3a(0x132),_0x329a56),(parseInt(_0x329a56[_0x2b7b3a(0x120)])<parseInt(_0x329a56['return_qty'])||parseInt(_0x329a56[_0x2b7b3a(0xfa)])<parseInt(_0x329a56['return_qty'])&&parseInt(_0x329a56['sale_qty'])>parseInt(_0x329a56[_0x2b7b3a(0x193)])||parseInt(_0x329a56[_0x2b7b3a(0x193)])==0x0)&&_0x5ca96c++;});if(_0x5ca96c!=0x0)return _0x389b42[_0x14f2c0(0xe7)]('errors',_0x14f2c0(0xb9)),_0x399f40[_0x14f2c0(0xc0)]('back');const _0x1999c6=await sales[_0x14f2c0(0x152)]({'invoice':_0x565df6});console[_0x14f2c0(0x156)](_0x1999c6),_0x1999c6[_0x14f2c0(0x9d)]=_0x14f2c0(0xb8);const _0x599dda=await _0x1999c6[_0x14f2c0(0xcb)](),_0x178095=new sales_return({'invoice':_0x565df6,'customer':_0x389b42[_0x14f2c0(0xae)][_0x14f2c0(0x194)],'date':_0x169893,'warehouse_name':_0x16738f,'room':_0x312aa6,'ToWarehouse':_0x4d1b8d,'ToRoom':_0x3e8c84,'return_sale':_0x39e0ad,'note':_0x349baa}),_0xba9ec3=await _0x178095[_0x14f2c0(0xcb)]();console[_0x14f2c0(0x156)](_0x178095);const _0x5354fb=await sales_return[_0x14f2c0(0x152)]({'invoice':_0x565df6}),_0x413ca0=await warehouse[_0x14f2c0(0x152)]({'name':_0x4d1b8d,'room':_0x3e8c84});_0x5354fb[_0x14f2c0(0x130)][_0x14f2c0(0x139)](_0x2f4316=>{var _0x59ec42=_0x14f2c0,_0x57b94c=0x0;const _0xf93c=_0x413ca0[_0x59ec42(0x174)][_0x59ec42(0x140)](_0x5e0cc5=>{var _0x273b6a=_0x59ec42;_0x5e0cc5['product_name']==_0x2f4316[_0x273b6a(0x16d)]&&_0x5e0cc5[_0x273b6a(0x170)]==_0x2f4316[_0x273b6a(0x170)]&&_0x5e0cc5[_0x273b6a(0x143)]==_0x2f4316['type']&&_0x5e0cc5['bin']==_0x2f4316[_0x273b6a(0x190)]&&_0x5e0cc5[_0x273b6a(0x10d)]==_0x2f4316[_0x273b6a(0x10d)]&&(_0x5e0cc5[_0x273b6a(0x124)]=parseInt(_0x5e0cc5[_0x273b6a(0x124)])+parseInt(_0x2f4316[_0x273b6a(0x193)]),_0x57b94c++);});_0x57b94c=='0'&&(_0x413ca0[_0x59ec42(0x174)]=_0x413ca0[_0x59ec42(0x174)][_0x59ec42(0x91)]({'product_name':_0x2f4316[_0x59ec42(0x16d)],'product_stock':_0x2f4316[_0x59ec42(0x193)],'primary_code':_0x2f4316[_0x59ec42(0x8f)],'secondary_code':_0x2f4316['secondary_code'],'product_code':_0x2f4316['product_code'],'bay':_0x2f4316[_0x59ec42(0x10d)],'bin':_0x2f4316[_0x59ec42(0x190)],'type':_0x2f4316['type'],'floorlevel':_0x2f4316[_0x59ec42(0x170)]})),console[_0x59ec42(0x156)](_0x59ec42(0xc5),_0x413ca0);}),await _0x413ca0[_0x14f2c0(0xcb)](),console[_0x14f2c0(0x156)](_0x389b42[_0x14f2c0(0xae)]);const _0x2051f8=new c_payment_data({'invoice':_0x565df6,'customer':_0x389b42[_0x14f2c0(0xae)]['customer'],'reason':_0x14f2c0(0x155)});await _0x2051f8[_0x14f2c0(0xcb)]();const _0x23d4c0=await master_shop['find']();console['log'](_0x14f2c0(0xac),_0x23d4c0[0x0]['image']);const _0x3a72f4=await email_settings[_0x14f2c0(0x152)](),_0x338825=await customer[_0x14f2c0(0x152)]({'name':_0x389b42['body'][_0x14f2c0(0x194)]});console[_0x14f2c0(0x156)](_0x14f2c0(0xc2),_0x338825);_0x23d4c0[0x0]['currency_placement']==0x1?(right_currency=_0x23d4c0[0x0][_0x14f2c0(0x13f)],left_currency=''):(right_currency='',left_currency=_0x23d4c0[0x0][_0x14f2c0(0x13f)]);var _0xe699cf=_0x51f610,_0x4f7eb5=_0x3e7a4f,_0x4fde0a='',_0x35fd0f;for(_0x35fd0f in _0xe699cf){_0x4fde0a+=_0x14f2c0(0x164)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xe699cf[_0x35fd0f]+_0x14f2c0(0x12f)+_0x14f2c0(0xcd)+_0x4f7eb5[_0x35fd0f]+_0x14f2c0(0x12f)+_0x14f2c0(0x163);}console[_0x14f2c0(0x156)]('product_list',_0x4fde0a);let _0x8bbee7=nodemailer[_0x14f2c0(0x18b)]({'service':_0x14f2c0(0x17f),'auth':{'user':_0x3a72f4[_0x14f2c0(0x101)],'pass':_0x3a72f4[_0x14f2c0(0x12d)]}}),_0x716f34={'from':_0x3a72f4[_0x14f2c0(0x101)],'to':_0x338825[_0x14f2c0(0x101)],'subject':_0x14f2c0(0x128),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x23d4c0[0x0][_0x14f2c0(0x151)],'cid':_0x14f2c0(0x14c)}],'html':_0x14f2c0(0xcf)+_0x14f2c0(0x104)+_0x14f2c0(0x15a)+_0x14f2c0(0xa1)+_0x14f2c0(0x113)+_0x14f2c0(0xa1)+_0x14f2c0(0x145)+'</div>'+_0x14f2c0(0xa1)+_0x14f2c0(0xbd)+_0x23d4c0[0x0][_0x14f2c0(0x167)]+_0x14f2c0(0x135)+'</div>'+_0x14f2c0(0x131)+_0x14f2c0(0x118)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x14f2c0(0xa6)+_0x565df6+'\x20'+_0x14f2c0(0x14d)+_0x14f2c0(0xde)+_0x169893+'\x20'+_0x14f2c0(0xdb)+_0x14f2c0(0x166)+_0x14f2c0(0x131)+_0x14f2c0(0x15c)+_0x14f2c0(0x191)+_0x14f2c0(0x164)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x14f2c0(0xa7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x14f2c0(0x97)+_0x14f2c0(0x163)+_0x14f2c0(0x129)+_0x14f2c0(0x192)+'\x20'+_0x4fde0a+'\x20'+'</tbody>'+_0x14f2c0(0x168)+_0x14f2c0(0xa1)+'<strong>\x20Regards\x20</strong>'+_0x14f2c0(0x92)+_0x23d4c0[0x0]['site_title']+_0x14f2c0(0x166)+_0x14f2c0(0x131)+'</div>'+_0x14f2c0(0x11d)};_0x8bbee7[_0x14f2c0(0x146)](_0x716f34,function(_0x51a1f5,_0x54ce0f){var _0x179f2b=_0x14f2c0;_0x51a1f5?(console['log'](_0x51a1f5),console[_0x179f2b(0x156)](_0x179f2b(0x138))):console[_0x179f2b(0x156)](_0x179f2b(0xe1));}),_0x389b42[_0x14f2c0(0xe7)](_0x14f2c0(0xce),_0x14f2c0(0x180)),_0x399f40[_0x14f2c0(0xc0)](_0x14f2c0(0x121));}catch(_0x1565b3){console['log'](_0x1565b3),_0x399f40[_0x14f2c0(0x183)](0xc8)[_0x14f2c0(0x185)]({'message1':_0x1565b3[_0x14f2c0(0x111)]});}}),router['get']('/barcode/:id',auth,async(_0x348311,_0x3d153d)=>{var _0x102574=a0_0x1b291d;try{const {username:_0x409d25,email:_0xe4f7a0,role:_0x5df309}=_0x348311[_0x102574(0xf8)],_0x3a5e6b=_0x348311['user'],_0x4d3731=await profile['findOne']({'email':_0x3a5e6b[_0x102574(0x101)]}),_0x5b4ac1=await master_shop['find']();console['log']('barcode\x20Product\x20master',_0x5b4ac1);const _0x2dd7eb=_0x348311[_0x102574(0x141)]['id'],_0x525032=await sales[_0x102574(0x186)](_0x2dd7eb);console['log'](_0x102574(0xed),_0x525032);if(_0x5b4ac1[0x0][_0x102574(0xf7)]==_0x102574(0xf2))var _0x4c39d4=users[_0x102574(0xdc)];else{if(_0x5b4ac1[0x0][_0x102574(0xf7)]=='Hindi')var _0x4c39d4=users[_0x102574(0xf6)];else{if(_0x5b4ac1[0x0][_0x102574(0xf7)]==_0x102574(0xbb))var _0x4c39d4=users[_0x102574(0xbb)];else{if(_0x5b4ac1[0x0][_0x102574(0xf7)]=='Spanish')var _0x4c39d4=users['Spanish'];else{if(_0x5b4ac1[0x0]['language']==_0x102574(0xe2))var _0x4c39d4=users[_0x102574(0xe2)];else{if(_0x5b4ac1[0x0][_0x102574(0xf7)]==_0x102574(0xd8))var _0x4c39d4=users[_0x102574(0x136)];else{if(_0x5b4ac1[0x0][_0x102574(0xf7)]=='Chinese')var _0x4c39d4=users[_0x102574(0xe0)];else{if(_0x5b4ac1[0x0][_0x102574(0xf7)]==_0x102574(0x18c))var _0x4c39d4=users['Arabic'];}}}}}}}_0x3d153d[_0x102574(0x14b)]('all_sales_barcode',{'success':_0x348311[_0x102574(0xe7)](_0x102574(0xce)),'errors':_0x348311[_0x102574(0xe7)](_0x102574(0xb7)),'role':_0x3a5e6b,'profile':_0x4d3731,'alldata':_0x525032,'master_shop':_0x5b4ac1,'language':_0x4c39d4});}catch(_0x5d3cfa){console[_0x102574(0x156)](_0x5d3cfa);}}),router[a0_0x1b291d(0x181)](a0_0x1b291d(0x178),async(_0x392082,_0x299773)=>{var _0x4f3911=a0_0x1b291d;const {product_code:_0x4d6202,warehouse_name:_0x52ac3d,rooms_data:_0x6709a5,Roomslist:_0x4437cd}=_0x392082[_0x4f3911(0xae)],_0x395062=_0x4437cd[_0x4f3911(0xeb)](','),_0x4fe45f=[];async function _0x107cac(_0x30bf2a){var _0x102190=_0x4f3911;const _0x365c5e=await warehouse[_0x102190(0x16e)]([{'$match':{'name':_0x52ac3d,'room':_0x30bf2a}},{'$unwind':_0x102190(0xcc)},{'$match':{'product_details.primary_code':_0x4d6202}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x102190(0x17e)},'product_stock':{'$first':_0x102190(0x15e)},'primary_code':{'$first':_0x102190(0xda)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x102190(0x9e)},'level':{'$first':_0x102190(0xab)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x102190(0x184)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x102190(0xa5)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x102190(0x106)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x102190(0x179)},'production_date':{'$first':_0x102190(0xf5)},'maxPerUnit':{'$first':_0x102190(0x14a)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x102190(0x11f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x102190(0x10e)},'invoice':{'$first':_0x102190(0xa3)},'actual_qty':{'$first':_0x102190(0x189)},'actual_uom':{'$first':_0x102190(0xf9)}}}]),_0x218130=await warehouse['aggregate']([{'$match':{'name':_0x52ac3d,'room':_0x30bf2a}},{'$unwind':_0x102190(0xcc)},{'$match':{'product_details.secondary_code':_0x4d6202}},{'$group':{'_id':_0x102190(0xd0),'name':{'$first':_0x102190(0x17e)},'product_stock':{'$first':_0x102190(0x15e)},'primary_code':{'$first':_0x102190(0xda)},'secondary_code':{'$first':_0x102190(0x137)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x102190(0xab)},'isle':{'$first':_0x102190(0xa8)},'type':{'$first':_0x102190(0x184)},'pallet':{'$first':_0x102190(0x13b)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x102190(0x11e)},'storage':{'$first':_0x102190(0x106)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x102190(0x179)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x102190(0x14a)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x102190(0x10e)},'invoice':{'$first':_0x102190(0xa3)}}}]);if(_0x365c5e[_0x102190(0x98)]>0x0)_0x4fe45f[_0x102190(0x153)](_0x365c5e);else _0x218130[_0x102190(0x98)]>0x0&&_0x4fe45f[_0x102190(0x153)](_0x218130);}const _0xaf770=_0x395062['map'](_0x14e47f=>_0x107cac(_0x14e47f));await Promise[_0x4f3911(0x16c)](_0xaf770),_0x299773[_0x4f3911(0x185)](_0x4fe45f);}),module[a0_0x1b291d(0x9c)]=router;