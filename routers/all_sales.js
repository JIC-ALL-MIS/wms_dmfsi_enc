var a0_0x1f2c59=a0_0x2566;function a0_0x2566(_0x42c0af,_0x34a354){var _0x3d265b=a0_0x3d26();return a0_0x2566=function(_0x256618,_0x78a860){_0x256618=_0x256618-0xf9;var _0x2fc6c6=_0x3d265b[_0x256618];return _0x2fc6c6;},a0_0x2566(_0x42c0af,_0x34a354);}function a0_0x3d26(){var _0x986779=['getDate','Shelves','product_details','sales_quantity','prod_invoice','$_id','$note','payment\x20successfull','$product_details._id','../middleware/auth','sale_product','level','Sales\x20Update\x20successfully','error','status','$product_details.rack','$product_details','product_name','stocks','Level','</td>','False','role','RMSEmail','$product_details.floorlevel','$sale_product.quantity','language','$warehouse_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/invoice/:id','floorlevel','Portuguese','Receiving\x20Area','delivery_date','edit_sales','amount','final','$product_details.primary_code','\x20Order\x20Number\x20:\x20','gmail','$product_details.pallet','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/all_sales/view','<html><head><title></title>','finalize','$invoice','createTransport','return_data','<h5>','all_sales','Router','stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','product_data','rack','image','/barcode_scanner','max','6900900ijLYLj','types','password','45822SyuxRv','warehouse_name','actual_uom','aggregate','type','3173200jVhRDy','../public/language/languages.json','$product_details.storage','</div>','toString','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','all_sales_barcode','/view/add_sales','$product_details.product_cat','/barcode/:id','184617jHxgRZ','add\x20post','catch','save','add_sales','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$return_data','$sale_product','product_stock','product_list','currency','RoomAssigned','product','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.production_date','/view/return_sales/:id','$product_details.bay','site_title','\x20Order\x20Date\x20:\x20','766388CfRuQq','True','/upload/','findById','redirect','Arabic','<span\x20style=\x22float:\x20right;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','abs','customers_docs','<strong>\x20Regards\x20</strong>','isAllowEdit','SCRN','secondary_code','email','slice','map','Sales\x20Mail','carton','</head><body>','delivery_code','render','batch_code','id_transaction_from','Hindi','$product_details.secondary_unit','German','$product_details.invoice','staff','json','960TdFPtY','return_qty','purchases_data','warehouse','prod_cat','$product','currency_placement','</h5>','$product_details.isle','string','$finalize','max_per_unit','express','date','invoice','2pFCGqd','message','getFullYear','$product_details.unit','<h2>\x20','nodemailer','bay','Email\x20sent\x20successfully','requested_qty','Arabic\x20(ae)','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.expiry_date','flash','OUT-','$customer','</tr>','1001857esrvZI','</table>','</body></html>','$sale_product.bin','_id','Portuguese\x20(BR)','</tbody>','/view/:id','$room','user','unit','$date','Enabled','$product_details.product_code','filter','../models/all_models','Enclosed','$name','$product_details.batch_code','params','$product_details.secondary_code','$product_details.bin','Return\x20Rooms','user_id','/view/add_sale/product','$product_details.product_name','$sale_product.floorlevel','English\x20(US)','maxperunit','return_sale','7969986QWcPFF','foreach\x20newproduct','$product.product_name','stock_data','/preview/:id','all','random','$product_details.level','French','padStart','$product_details.type','There\x27s\x20a\x20error\x20in\x20this\x20transaction','English','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_stock','body','name','exports','</span>','primary_unit','edit_sales_view','Floor','host','<table\x20style=\x22width:\x20100%\x20!important;\x22>','note','then','storage','customer','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','room_name','Raw\x20Materials','<div>','received_amount','12CNTQEW','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','get','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','sendMail','/../public','forEach','product_code','Logo.png','sale_qty','$isAllowEdit','Ambient','master','expiry_date','/all_sales/preview/','quantity_notConverted','<h5\x20style=\x22text-align:\x20left;\x22>','bin','post','customers','log','errors','Return\x20Goods','</thead>','$customers_docs','$sale_product.type','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$sale_product.bay','length','quantity','barcode\x20user_id','<hr\x20class=\x22my-3\x22>','<!DOCTYPE\x20html>','back','Error\x20Occurs','production_date','secondary_unit','Spanish','findOne','id_transact','Sales\x20Add\x20successfully','find','logo','<tbody\x20style=\x22text-align:\x20center;\x22>','<tr>','actual_qty'];a0_0x3d26=function(){return _0x986779;};return a0_0x3d26();}(function(_0x1112c0,_0x8e0420){var _0x54aa15=a0_0x2566,_0x55e0ca=_0x1112c0();while(!![]){try{var _0x2b95c3=-parseInt(_0x54aa15(0x1dc))/0x1*(-parseInt(_0x54aa15(0x1cc))/0x2)+parseInt(_0x54aa15(0x18c))/0x3*(parseInt(_0x54aa15(0x10f))/0x4)+parseInt(_0x54aa15(0x1bd))/0x5*(parseInt(_0x54aa15(0x17c))/0x6)+parseInt(_0x54aa15(0x19f))/0x7+-parseInt(_0x54aa15(0x181))/0x8+-parseInt(_0x54aa15(0x1fa))/0x9+-parseInt(_0x54aa15(0x179))/0xa;if(_0x2b95c3===_0x8e0420)break;else _0x55e0ca['push'](_0x55e0ca['shift']());}catch(_0x172733){_0x55e0ca['push'](_0x55e0ca['shift']());}}}(a0_0x3d26,0xc0dd0));const express=require(a0_0x1f2c59(0x1c9)),app=express(),router=express[a0_0x1f2c59(0x171)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1f2c59(0x1eb)),auth=require(a0_0x1f2c59(0x148)),nodemailer=require(a0_0x1f2c59(0x1d1)),users=require(a0_0x1f2c59(0x182));router[a0_0x1f2c59(0x112)]('/view',auth,async(_0x200649,_0x3b2fc0)=>{var _0x3a1484=a0_0x1f2c59;try{const {username:_0x544d03,email:_0x167356,role:_0x2e749a}=_0x200649['user'],_0x1a4942=_0x200649[_0x3a1484(0x1e5)],_0x48bbbe=await profile[_0x3a1484(0x137)]({'email':_0x1a4942[_0x3a1484(0x1ad)]}),_0x3baa90=await master_shop['find']();let _0x1de4e9;if(_0x1a4942[_0x3a1484(0x155)]=='staff'){const _0x3b5f6c=await staff['findOne']({'email':_0x1a4942['email']});_0x1de4e9=await sales[_0x3a1484(0x17f)]([{'$lookup':{'from':_0x3a1484(0x124),'localField':_0x3a1484(0x108),'foreignField':_0x3a1484(0xfd),'as':_0x3a1484(0x1a8)}},{'$unwind':_0x3a1484(0x129)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x3a1484(0x144),'invoice':{'$first':_0x3a1484(0x16c)},'customers':{'$first':_0x3a1484(0x1da)},'date':{'$first':_0x3a1484(0x1e7)},'warehouse_name':{'$first':_0x3a1484(0x15a)},'sale_product':{'$push':_0x3a1484(0x193)},'note':{'$first':_0x3a1484(0x145)},'return_data':{'$first':_0x3a1484(0x192)},'customers_docs':{'$first':_0x3a1484(0x129)},'total_saleproduct_quantity':{'$sum':_0x3a1484(0x158)},'level':{'$addToSet':_0x3a1484(0x12c)},'isle':{'$addToSet':_0x3a1484(0x1df)},'type':{'$addToSet':_0x3a1484(0x12a)},'pallet':{'$addToSet':_0x3a1484(0x1f6)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x3a1484(0x11b)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x1de4e9=await sales[_0x3a1484(0x17f)]([{'$lookup':{'from':'customers','localField':_0x3a1484(0x108),'foreignField':_0x3a1484(0xfd),'as':'customers_docs'}},{'$unwind':_0x3a1484(0x129)},{'$unwind':_0x3a1484(0x193)},{'$group':{'_id':_0x3a1484(0x144),'invoice':{'$first':_0x3a1484(0x16c)},'customers':{'$first':_0x3a1484(0x1da)},'date':{'$first':_0x3a1484(0x1e7)},'warehouse_name':{'$first':_0x3a1484(0x15a)},'sale_product':{'$push':_0x3a1484(0x193)},'note':{'$first':'$note'},'return_data':{'$first':_0x3a1484(0x192)},'customers_docs':{'$first':_0x3a1484(0x129)},'total_saleproduct_quantity':{'$sum':_0x3a1484(0x158)},'level':{'$addToSet':_0x3a1484(0x12c)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x3a1484(0x12a)},'pallet':{'$addToSet':_0x3a1484(0x1f6)},'finalize':{'$first':_0x3a1484(0x1c7)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3a1484(0x125)]('sales\x20all_data',_0x1de4e9);if(_0x3baa90[0x0][_0x3a1484(0x159)]==_0x3a1484(0x1f7)){var _0x1879f7=users[_0x3a1484(0xf9)];console['log'](_0x1879f7);}else{if(_0x3baa90[0x0][_0x3a1484(0x159)]=='Hindi')var _0x1879f7=users[_0x3a1484(0x1b7)];else{if(_0x3baa90[0x0]['language']==_0x3a1484(0x1b9))var _0x1879f7=users[_0x3a1484(0x1b9)];else{if(_0x3baa90[0x0][_0x3a1484(0x159)]==_0x3a1484(0x136))var _0x1879f7=users[_0x3a1484(0x136)];else{if(_0x3baa90[0x0][_0x3a1484(0x159)]==_0x3a1484(0x202))var _0x1879f7=users['French'];else{if(_0x3baa90[0x0][_0x3a1484(0x159)]==_0x3a1484(0x1e1))var _0x1879f7=users['Portuguese'];else{if(_0x3baa90[0x0][_0x3a1484(0x159)]==_0x3a1484(0x186))var _0x1879f7=users['Chinese'];else{if(_0x3baa90[0x0]['language']=='Arabic\x20(ae)')var _0x1879f7=users[_0x3a1484(0x1a4)];}}}}}}}_0x3b2fc0[_0x3a1484(0x1b4)](_0x3a1484(0x170),{'success':_0x200649[_0x3a1484(0x1d8)](_0x3a1484(0x110)),'errors':_0x200649[_0x3a1484(0x1d8)]('errors'),'sales':_0x1de4e9,'profile':_0x48bbbe,'role':_0x1a4942,'master_shop':_0x3baa90,'language':_0x1879f7});}catch(_0xd7002){console['log'](_0xd7002);}});async function getRandom8DigitNumber(){var _0x23b08e=a0_0x1f2c59;const _0x39f7c=0x989680,_0x47c680=0x5f5e0ff,_0x460c1f=Math['floor'](Math[_0x23b08e(0x200)]()*(_0x47c680-_0x39f7c+0x1))+_0x39f7c;var _0x236fa9;const _0x118eec=await sales[_0x23b08e(0x137)]({'invoice':_0x23b08e(0x1d9)+_0x460c1f});return _0x118eec&&_0x118eec[_0x23b08e(0x12d)]>0x0?_0x236fa9='OUT-'+_0x460c1f:_0x236fa9=_0x23b08e(0x1d9)+_0x460c1f,_0x236fa9;}router[a0_0x1f2c59(0x112)](a0_0x1f2c59(0x189),auth,async(_0x1743b6,_0x189bfe)=>{var _0x2d92e7=a0_0x1f2c59;try{const {username:_0x2d3307,email:_0x5997ca,role:_0x589f14}=_0x1743b6['user'],_0x5475f8=_0x1743b6[_0x2d92e7(0x1e5)],_0x79972c=await profile[_0x2d92e7(0x137)]({'email':_0x5475f8[_0x2d92e7(0x1ad)]}),_0x539edb=await master_shop['find'](),_0x55f02e=await customer[_0x2d92e7(0x13a)]({});let _0x563cba;if(_0x5475f8[_0x2d92e7(0x155)]==_0x2d92e7(0x1bb)){const _0x54047f=await staff['findOne']({'email':_0x5475f8['email']});_0x563cba=await warehouse[_0x2d92e7(0x17f)]([{'$match':{'status':'Enabled','name':_0x54047f[_0x2d92e7(0x1c0)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x2d92e7(0x127)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x563cba=await warehouse[_0x2d92e7(0x17f)]([{'$match':{'status':_0x2d92e7(0x1e8),'warehouse_category':_0x2d92e7(0x10c),'name':{'$ne':_0x2d92e7(0x127)}}},{'$group':{'_id':_0x2d92e7(0x1ed),'name':{'$first':_0x2d92e7(0x1ed)}}},{'$sort':{'name':0x1}}]);const _0x4eb89f=await product[_0x2d92e7(0x13a)]({});var _0x52ac72=['Ambient','Enclosed'];const _0x5906da=await sales['find']({}),_0x293434=_0x5906da[_0x2d92e7(0x12d)]+0x1,_0x5618c6=_0x2d92e7(0x1d9)+_0x293434[_0x2d92e7(0x185)]()[_0x2d92e7(0x203)](0x5,'0');if(_0x539edb[0x0]['language']=='English\x20(US)'){var _0x371f98=users[_0x2d92e7(0xf9)];console[_0x2d92e7(0x125)](_0x371f98);}else{if(_0x539edb[0x0][_0x2d92e7(0x159)]==_0x2d92e7(0x1b7))var _0x371f98=users[_0x2d92e7(0x1b7)];else{if(_0x539edb[0x0][_0x2d92e7(0x159)]==_0x2d92e7(0x1b9))var _0x371f98=users[_0x2d92e7(0x1b9)];else{if(_0x539edb[0x0][_0x2d92e7(0x159)]==_0x2d92e7(0x136))var _0x371f98=users[_0x2d92e7(0x136)];else{if(_0x539edb[0x0]['language']==_0x2d92e7(0x202))var _0x371f98=users[_0x2d92e7(0x202)];else{if(_0x539edb[0x0]['language']==_0x2d92e7(0x1e1))var _0x371f98=users[_0x2d92e7(0x15e)];else{if(_0x539edb[0x0][_0x2d92e7(0x159)]==_0x2d92e7(0x186))var _0x371f98=users[_0x2d92e7(0x186)];else{if(_0x539edb[0x0]['language']==_0x2d92e7(0x1d5))var _0x371f98=users[_0x2d92e7(0x1a4)];}}}}}}}const _0x3907ce=getRandom8DigitNumber();_0x3907ce[_0x2d92e7(0x106)](_0x42fc5d=>{var _0x5a14aa=_0x2d92e7;_0x189bfe[_0x5a14aa(0x1b4)](_0x5a14aa(0x190),{'success':_0x1743b6[_0x5a14aa(0x1d8)](_0x5a14aa(0x110)),'errors':_0x1743b6[_0x5a14aa(0x1d8)](_0x5a14aa(0x126)),'role':_0x5475f8,'profile':_0x79972c,'customer':_0x55f02e,'warehouse':_0x563cba,'product':_0x4eb89f,'invoice':_0x42fc5d,'master_shop':_0x539edb,'language':_0x371f98,'rooms_data':_0x52ac72});})[_0x2d92e7(0x18e)](_0x33308e=>{var _0x1a88bb=_0x2d92e7;_0x1743b6[_0x1a88bb(0x1d8)](_0x1a88bb(0x126),_0x1a88bb(0x205)),_0x189bfe[_0x1a88bb(0x1a3)](_0x1a88bb(0x169));});}catch(_0xd825eb){console[_0x2d92e7(0x125)](_0xd825eb);}}),router['get']('/view/add_sales/:id',auth,async(_0x38ba34,_0x5b4017)=>{var _0x2cedd9=a0_0x1f2c59;try{const _0x3d8550=_0x38ba34[_0x2cedd9(0x1ef)]['id'];console[_0x2cedd9(0x125)](_0x3d8550);const _0x156d25=await product['find'](),_0x18b7e5=await purchases[_0x2cedd9(0x17f)]([{'$match':{'warehouse_name':_0x3d8550}},{'$unwind':_0x2cedd9(0x1c2)},{'$group':{'_id':_0x2cedd9(0x1fc)}}]);console[_0x2cedd9(0x125)](_0x2cedd9(0x1bf),_0x18b7e5),_0x5b4017[_0x2cedd9(0x14d)](0xc8)[_0x2cedd9(0x1bc)]({'purchases_data':_0x18b7e5,'product_data':_0x156d25});}catch(_0x573bb7){console[_0x2cedd9(0x125)](_0x573bb7);}}),router['post'](a0_0x1f2c59(0x1f4),auth,async(_0x28a58a,_0x2d885f)=>{var _0x1225c1=a0_0x1f2c59;try{const {warehouse_data:_0x3e9f28,product_data:_0xafd5e1}=_0x28a58a['body'];console[_0x1225c1(0x125)](_0x28a58a['body'][_0x1225c1(0x174)]);;const _0x24c299=await master_shop[_0x1225c1(0x13a)]();console[_0x1225c1(0x125)](_0x1225c1(0x11d),_0x24c299);const _0x18b36e=await product[_0x1225c1(0x137)]({'name':_0xafd5e1});console[_0x1225c1(0x125)](_0x1225c1(0x198),_0x18b36e);const _0x4f8016=await warehouse[_0x1225c1(0x17f)]([{'$match':{'name':_0x3e9f28}},{'$unwind':_0x1225c1(0x14f)},{'$match':{'product_details.product_name':_0xafd5e1}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x1225c1(0xfb)}}}]);console[_0x1225c1(0x125)](_0x1225c1(0x1fd),_0x4f8016),_0x2d885f[_0x1225c1(0x14d)](0xc8)[_0x1225c1(0x1bc)]({'master':_0x24c299,'new_product':_0x18b36e,'stock_data':_0x4f8016});}catch(_0x5505ba){console[_0x1225c1(0x125)](_0x5505ba);}}),router[a0_0x1f2c59(0x123)](a0_0x1f2c59(0x189),auth,async(_0x1384ac,_0xb9291d)=>{var _0x5a0fdc=a0_0x1f2c59;try{const {invoice:_0x3b2a09,date:_0xff82ea,warehouse_name:_0x68ad40,product_name:_0x269417,stock:_0x1ffda5,quantity:_0x275bdb,note:_0x47186c,room:_0x2374aa,primary_code:_0x1dd207,secondary_code:_0x2de14c,prod_code:_0x3a4492,level:_0x35d9c9,isle:_0x25b1f3,pallet:_0x12efb0,batch_code:_0x3c4401,SCRN:_0x4b37cb,expiry_date:_0x4a75e5}=_0x1384ac[_0x5a0fdc(0xfc)];if(typeof _0x269417=='string')var _0x160456=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x150)]],_0x1f1c19=[_0x1384ac['body'][_0x5a0fdc(0x172)]],_0x519bdb=[_0x1384ac['body'][_0x5a0fdc(0x1b1)]],_0x10c3fd=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x109)]],_0x485314=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x1ac)]],_0x9501a6=[_0x1384ac['body'][_0x5a0fdc(0x113)]],_0x29acc7=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x14a)]],_0x5429cc=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x100)]],_0x4a0818=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x135)]],_0x5ae1b6=[_0x1384ac[_0x5a0fdc(0xfc)]['batch_code']],_0x250ce6=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x11e)]],_0xe01424=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x1c8)]],_0x603090=[_0x1384ac[_0x5a0fdc(0xfc)]['production_date']],_0x120e63=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x1d4)]],_0x5b0bd9=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x160)]],_0x50e93f=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x1b3)]],_0x2eb5dc=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x1c1)]],_0x33677b=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x12e)]],_0x5ef3fc=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x197)]],_0x2cf921=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x143)]],_0x306707=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x13e)]],_0x2581b7=[_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x17e)]],_0x33321f=[_0x1384ac[_0x5a0fdc(0xfc)]['id_transact']];else var _0x160456=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x150)]],_0x1f1c19=[..._0x1384ac['body'][_0x5a0fdc(0x172)]],_0x519bdb=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x1b1)]],_0x10c3fd=[..._0x1384ac[_0x5a0fdc(0xfc)]['primary_code']],_0x485314=[..._0x1384ac['body'][_0x5a0fdc(0x1ac)]],_0x9501a6=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x113)]],_0x29acc7=[..._0x1384ac['body'][_0x5a0fdc(0x14a)]],_0x5429cc=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x100)]],_0x4a0818=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x135)]],_0x5ae1b6=[..._0x1384ac['body']['batch_code']],_0x250ce6=[..._0x1384ac['body'][_0x5a0fdc(0x11e)]],_0xe01424=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x1c8)]],_0x603090=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x134)]],_0x120e63=[..._0x1384ac[_0x5a0fdc(0xfc)]['requested_qty']],_0x5b0bd9=[..._0x1384ac[_0x5a0fdc(0xfc)]['delivery_date']],_0x50e93f=[..._0x1384ac[_0x5a0fdc(0xfc)]['delivery_code']],_0x2eb5dc=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x1c1)]],_0x33677b=[..._0x1384ac['body'][_0x5a0fdc(0x12e)]],_0x5ef3fc=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x197)]],_0x2cf921=[..._0x1384ac['body'][_0x5a0fdc(0x143)]],_0x306707=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x13e)]],_0x2581b7=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x17e)]],_0x33321f=[..._0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x138)]];const _0x444fd8=_0x160456[_0x5a0fdc(0x1af)](_0x439050=>{return _0x439050={'product_name':_0x439050};});_0x1f1c19[_0x5a0fdc(0x117)]((_0xe1ef58,_0x36e107)=>{var _0xff90a5=_0x5a0fdc;_0x444fd8[_0x36e107][_0xff90a5(0x172)]=Math[_0xff90a5(0x1a7)](_0xe1ef58);}),_0x306707[_0x5a0fdc(0x117)]((_0x20faf3,_0x3359d5)=>{var _0x21bff4=_0x5a0fdc;_0x444fd8[_0x3359d5][_0x21bff4(0x13e)]=Math[_0x21bff4(0x1a7)](_0x20faf3);}),_0x2581b7[_0x5a0fdc(0x117)]((_0x1d90d3,_0x2a2cfd)=>{var _0x2512e9=_0x5a0fdc;_0x444fd8[_0x2a2cfd][_0x2512e9(0x17e)]=_0x1d90d3;}),_0x33321f['forEach']((_0x175203,_0x26106a)=>{var _0x253453=_0x5a0fdc;_0x444fd8[_0x26106a][_0x253453(0x1b6)]=_0x175203;}),_0x519bdb[_0x5a0fdc(0x117)]((_0x10d485,_0x2006c2)=>{var _0x1efe17=_0x5a0fdc;_0x444fd8[_0x2006c2][_0x1efe17(0x12e)]=_0x10d485;}),_0x10c3fd[_0x5a0fdc(0x117)]((_0x482961,_0x343b1f)=>{var _0x4f59ce=_0x5a0fdc;_0x444fd8[_0x343b1f][_0x4f59ce(0x109)]=_0x482961;}),_0x485314[_0x5a0fdc(0x117)]((_0x52fcb5,_0x20dbd)=>{var _0x5cffae=_0x5a0fdc;_0x444fd8[_0x20dbd][_0x5cffae(0x1ac)]=_0x52fcb5;}),_0x9501a6[_0x5a0fdc(0x117)]((_0x301bb1,_0x4bba95)=>{_0x444fd8[_0x4bba95]['product_code']=_0x301bb1;}),_0x29acc7[_0x5a0fdc(0x117)]((_0x3eb002,_0x582ddf)=>{var _0x4d4648=_0x5a0fdc;_0x5ef3fc[_0x4d4648(0x117)]((_0x40ac02,_0x521212)=>{var _0x4ad44e=_0x4d4648;if(_0x40ac02==_0x4ad44e(0x15f)&&_0x582ddf==_0x521212){var _0x16fc72=_0x3eb002['slice'](0x3);_0x444fd8[_0x582ddf][_0x4ad44e(0x107)]=_0x3eb002[0x0],_0x444fd8[_0x582ddf][_0x4ad44e(0x175)]=_0x3eb002[0x1],_0x444fd8[_0x582ddf]['bay']=0x0,_0x444fd8[_0x582ddf]['bin']=0x0,_0x444fd8[_0x582ddf][_0x4ad44e(0x180)]=_0x4ad44e(0x102),_0x444fd8[_0x582ddf][_0x4ad44e(0x15d)]=_0x16fc72;}else{if(_0x40ac02==_0x4ad44e(0x140)&&_0x582ddf==_0x521212){var _0x16fc72=_0x3eb002['slice'](0x3);_0x444fd8[_0x582ddf][_0x4ad44e(0x107)]=_0x3eb002[0x0],_0x444fd8[_0x582ddf][_0x4ad44e(0x175)]=_0x3eb002[0x1],_0x444fd8[_0x582ddf][_0x4ad44e(0x1d2)]=0x0,_0x444fd8[_0x582ddf][_0x4ad44e(0x122)]=0x0,_0x444fd8[_0x582ddf][_0x4ad44e(0x180)]=_0x4ad44e(0x102),_0x444fd8[_0x582ddf][_0x4ad44e(0x15d)]=_0x3eb002[0x5];}else{if(_0x582ddf==_0x521212){var _0x4eb122;if(_0x3eb002[0x4]=='L')_0x4eb122=_0x4ad44e(0x152);else _0x3eb002[0x4]=='F'&&(_0x4eb122=_0x4ad44e(0x102));_0x444fd8[_0x582ddf][_0x4ad44e(0x107)]=_0x3eb002[0x0],_0x444fd8[_0x582ddf][_0x4ad44e(0x175)]=_0x3eb002[0x1],_0x444fd8[_0x582ddf][_0x4ad44e(0x1d2)]=_0x3eb002[0x2],_0x444fd8[_0x582ddf][_0x4ad44e(0x122)]=_0x3eb002[0x3],_0x444fd8[_0x582ddf][_0x4ad44e(0x180)]=_0x4eb122,_0x444fd8[_0x582ddf]['floorlevel']=_0x3eb002[0x5];}}}});}),_0x5429cc[_0x5a0fdc(0x117)]((_0xbfe7d7,_0xc4ed68)=>{var _0x19886b=_0x5a0fdc;_0x444fd8[_0xc4ed68][_0x19886b(0x1e6)]=_0xbfe7d7;}),_0x4a0818['forEach']((_0x12b9d0,_0x3993c9)=>{var _0x16d865=_0x5a0fdc;_0x444fd8[_0x3993c9][_0x16d865(0x135)]=_0x12b9d0;}),_0x5ae1b6['forEach']((_0x496386,_0x3c3ce5)=>{var _0x43b3ad=_0x5a0fdc;_0x444fd8[_0x3c3ce5][_0x43b3ad(0x1b5)]=_0x496386;}),_0x250ce6['forEach']((_0x3df3cd,_0x5748e3)=>{_0x444fd8[_0x5748e3]['expiry_date']=_0x3df3cd;}),_0xe01424[_0x5a0fdc(0x117)]((_0x5c99e4,_0x4af3f4)=>{var _0x232fa8=_0x5a0fdc;_0x444fd8[_0x4af3f4][_0x232fa8(0x1f8)]=_0x5c99e4;}),_0x603090[_0x5a0fdc(0x117)]((_0x188e38,_0x429ab1)=>{var _0x1ee4ef=_0x5a0fdc;_0x444fd8[_0x429ab1][_0x1ee4ef(0x134)]=_0x188e38;}),_0x120e63[_0x5a0fdc(0x117)]((_0x4bdd08,_0x5caa99)=>{var _0x5f040a=_0x5a0fdc;_0x444fd8[_0x5caa99][_0x5f040a(0x1d4)]=_0x4bdd08;}),_0x5b0bd9[_0x5a0fdc(0x117)]((_0x4fa6b8,_0x54fef3)=>{var _0xc489df=_0x5a0fdc;_0x444fd8[_0x54fef3][_0xc489df(0x160)]=_0x4fa6b8;}),_0x50e93f[_0x5a0fdc(0x117)]((_0x975d93,_0x5189ce)=>{var _0x217fed=_0x5a0fdc;_0x444fd8[_0x5189ce][_0x217fed(0x1b3)]=_0x975d93;}),_0x2eb5dc[_0x5a0fdc(0x117)]((_0x54dd42,_0x486355)=>{var _0x52ad1c=_0x5a0fdc;_0x444fd8[_0x486355][_0x52ad1c(0x1c1)]=_0x54dd42;}),_0x33677b[_0x5a0fdc(0x117)]((_0x3208a7,_0x7a9f7a)=>{var _0xc9c0bc=_0x5a0fdc;_0x444fd8[_0x7a9f7a][_0xc9c0bc(0x120)]=_0x3208a7;}),_0x5ef3fc[_0x5a0fdc(0x117)]((_0x4d14bd,_0x5816be)=>{var _0x3bf955=_0x5a0fdc;_0x444fd8[_0x5816be][_0x3bf955(0x10b)]=_0x4d14bd;}),_0x2cf921['forEach']((_0x39c78e,_0x5d2a2d)=>{_0x444fd8[_0x5d2a2d]['invoice']=_0x39c78e;});var _0x518ab6=0x0;_0x444fd8[_0x5a0fdc(0x117)](_0x5cdf43=>{var _0x218a57=_0x5a0fdc;(_0x5cdf43[_0x218a57(0x172)]<_0x5cdf43[_0x218a57(0x120)]||_0x5cdf43[_0x218a57(0x120)]==0x0)&&(console[_0x218a57(0x125)](_0x218a57(0x1fb),_0x5cdf43),_0x518ab6++);});const _0x482be2=_0x444fd8[_0x5a0fdc(0x1ea)](_0x4c192f=>_0x4c192f[_0x5a0fdc(0x12e)]!=='0'&&_0x4c192f['quantity']!==''),_0x35d49f=new sales({'invoice':_0x3b2a09,'customer':_0x1384ac[_0x5a0fdc(0xfc)][_0x5a0fdc(0x108)],'date':_0xff82ea,'warehouse_name':_0x68ad40,'sale_product':_0x482be2,'note':_0x47186c,'room':_0x2374aa,'primary_code':_0x1dd207,'secondary_code':_0x2de14c,'prod_code':_0x3a4492,'SCRN':_0x4b37cb}),_0x43db56=await _0x35d49f[_0x5a0fdc(0x18f)]();_0x1384ac[_0x5a0fdc(0x1d8)](_0x5a0fdc(0x110),_0x5a0fdc(0x139)),_0xb9291d[_0x5a0fdc(0x1a3)]('/all_sales/preview/'+_0x43db56[_0x5a0fdc(0x1e0)]);}catch(_0x170f95){console[_0x5a0fdc(0x125)](_0x170f95);}}),router[a0_0x1f2c59(0x112)](a0_0x1f2c59(0x1fe),auth,async(_0x3b8374,_0x36aa60)=>{var _0x2eddce=a0_0x1f2c59;try{const {username:_0x107e70,email:_0x7ef792,role:_0x433e8c}=_0x3b8374[_0x2eddce(0x1e5)],_0x238711=_0x3b8374[_0x2eddce(0x1e5)],_0x4a14bc=await profile[_0x2eddce(0x137)]({'email':_0x238711['email']}),_0x47e46e=await master_shop['find'](),_0x3d3c9c=_0x3b8374[_0x2eddce(0x1ef)]['id'],_0x365a78=await sales['findById'](_0x3d3c9c),_0x183298=await warehouse[_0x2eddce(0x17f)]([{'$match':{'name':_0x365a78[_0x2eddce(0x17d)]}},{'$unwind':_0x2eddce(0x14f)},{'$group':{'_id':_0x2eddce(0x147),'name':{'$first':_0x2eddce(0x1f5)},'product_stock':{'$first':_0x2eddce(0xfb)},'bay':{'$first':_0x2eddce(0x19c)},'bin':{'$first':_0x2eddce(0x1f1)},'type':{'$first':_0x2eddce(0x204)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x2eddce(0x164)},'secondary_code':{'$first':_0x2eddce(0x1f0)},'product_code':{'$first':_0x2eddce(0x1e9)},'storage':{'$first':_0x2eddce(0x183)},'rack':{'$first':_0x2eddce(0x14e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2eddce(0x19a)},'invoice':{'$first':_0x2eddce(0x1ba)}}}]),_0xfa4c31=await customer[_0x2eddce(0x13a)]({});let _0x3b631a;if(_0x238711[_0x2eddce(0x155)]=='staff'){const _0xa7fdd=await staff[_0x2eddce(0x137)]({'email':_0x238711[_0x2eddce(0x1ad)]});_0x3b631a=await warehouse['aggregate']([{'$match':{'status':_0x2eddce(0x1e8),'name':_0xa7fdd[_0x2eddce(0x1c0)]}},{'$group':{'_id':_0x2eddce(0x1ed),'name':{'$first':_0x2eddce(0x1ed)}}}]);}else _0x3b631a=await warehouse['aggregate']([{'$match':{'status':_0x2eddce(0x1e8)}},{'$group':{'_id':'$name','name':{'$first':_0x2eddce(0x1ed)}}}]);const _0xb24752=await product[_0x2eddce(0x13a)]({}),_0xcd980c=await suppliers['find']({});if(_0x47e46e[0x0][_0x2eddce(0x159)]==_0x2eddce(0x1f7)){var _0x594cdf=users['English'];console[_0x2eddce(0x125)](_0x594cdf);}else{if(_0x47e46e[0x0][_0x2eddce(0x159)]=='Hindi')var _0x594cdf=users[_0x2eddce(0x1b7)];else{if(_0x47e46e[0x0][_0x2eddce(0x159)]=='German')var _0x594cdf=users['German'];else{if(_0x47e46e[0x0]['language']==_0x2eddce(0x136))var _0x594cdf=users[_0x2eddce(0x136)];else{if(_0x47e46e[0x0][_0x2eddce(0x159)]=='French')var _0x594cdf=users[_0x2eddce(0x202)];else{if(_0x47e46e[0x0][_0x2eddce(0x159)]=='Portuguese\x20(BR)')var _0x594cdf=users[_0x2eddce(0x15e)];else{if(_0x47e46e[0x0][_0x2eddce(0x159)]==_0x2eddce(0x186))var _0x594cdf=users[_0x2eddce(0x186)];else{if(_0x47e46e[0x0][_0x2eddce(0x159)]==_0x2eddce(0x1d5))var _0x594cdf=users['Arabic'];}}}}}}}_0x36aa60[_0x2eddce(0x1b4)](_0x2eddce(0x101),{'success':_0x3b8374[_0x2eddce(0x1d8)](_0x2eddce(0x110)),'errors':_0x3b8374['flash'](_0x2eddce(0x126)),'role':_0x238711,'profile':_0x4a14bc,'customer':_0xfa4c31,'warehouse':_0x3b631a,'product':_0x183298,'user':_0x365a78,'master_shop':_0x47e46e,'unit':_0xb24752,'language':_0x594cdf,'suppliers':_0xcd980c});}catch(_0x5d2a85){console[_0x2eddce(0x125)](_0x5d2a85);}}),router['post']('/preview/:id',auth,async(_0x4b5537,_0x107ff1)=>{var _0x395781=a0_0x1f2c59;try{const _0x59f84e=_0x4b5537[_0x395781(0x1ef)]['id'],{invoice:_0x5b80fa,warehouse_name:_0x27d7ac,room:_0xe1cfd6}=_0x4b5537[_0x395781(0xfc)],_0x28f54a=await sales[_0x395781(0x137)]({'invoice':_0x5b80fa}),_0x227b3d=_0x28f54a[_0x395781(0x149)]['map'](async _0x5bd607=>{var _0x283252=_0x395781,_0x2516d2=await warehouse[_0x283252(0x137)]({'name':_0x27d7ac,'room':_0x5bd607[_0x283252(0x10b)],'warehouse_category':'Raw\x20Materials'});const _0x20a2a0=_0x2516d2[_0x283252(0x141)][_0x283252(0x1af)](_0x21d382=>{var _0xb21280=_0x283252;_0x21d382[_0xb21280(0x150)]==_0x5bd607[_0xb21280(0x150)]&&_0x21d382[_0xb21280(0x15d)]==_0x5bd607[_0xb21280(0x15d)]&&_0x21d382[_0xb21280(0x180)]==_0x5bd607[_0xb21280(0x180)]&&_0x21d382[_0xb21280(0x122)]==_0x5bd607[_0xb21280(0x122)]&&_0x21d382[_0xb21280(0x1d2)]==_0x5bd607[_0xb21280(0x1d2)]&&_0x21d382[_0xb21280(0x175)]==_0x5bd607[_0xb21280(0x175)]&&_0x21d382[_0xb21280(0x107)]==_0x5bd607['storage']&&_0x21d382['expiry_date']==_0x5bd607[_0xb21280(0x11e)]&&_0x21d382['batch_code']==_0x5bd607[_0xb21280(0x1b5)]&&_0x21d382['invoice']==_0x5bd607[_0xb21280(0x1cb)]&&_0x21d382[_0xb21280(0x1e0)]==_0x5bd607[_0xb21280(0x1b6)]&&(_0x21d382[_0xb21280(0x194)]=Math[_0xb21280(0x178)](0x0,Math[_0xb21280(0x1a7)](_0x21d382['product_stock'])-Math[_0xb21280(0x1a7)](_0x5bd607[_0xb21280(0x12e)])));});return _0x2516d2;});Promise[_0x395781(0x1ff)](_0x227b3d)[_0x395781(0x106)](async _0x4f4e29=>{var _0x10b749=_0x395781;try{for(const _0x460442 of _0x4f4e29){await _0x460442[_0x10b749(0x18f)]();}_0x28f54a[_0x10b749(0x16b)]=_0x10b749(0x1a0);const _0x469f2f=await _0x28f54a[_0x10b749(0x18f)](),_0x424370=await master_shop[_0x10b749(0x13a)](),_0x250c5d=await email_settings[_0x10b749(0x137)](),_0x46fc7=await supervisor_settings[_0x10b749(0x13a)]();var _0x3733fd=_0x28f54a[_0x10b749(0x149)],_0x286a7c='',_0x469757;for(_0x469757 in _0x3733fd){_0x286a7c+=_0x10b749(0x13d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3733fd[_0x469757]['product_name']+_0x10b749(0x153)+_0x10b749(0x15b)+_0x3733fd[_0x469757][_0x10b749(0x118)]+'</td>'+_0x10b749(0x15b)+_0x3733fd[_0x469757][_0x10b749(0x12e)]+_0x10b749(0x153)+_0x10b749(0x15b)+_0x3733fd[_0x469757][_0x10b749(0x1e6)]+_0x10b749(0x153)+_0x10b749(0x15b)+_0x3733fd[_0x469757]['secondary_unit']+_0x10b749(0x153)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x28f54a[_0x10b749(0x17d)]+_0x10b749(0x153)+_0x10b749(0x15b)+_0x3733fd[_0x469757]['room_name']+_0x10b749(0x153)+_0x10b749(0x15b)+_0x3733fd[_0x469757]['storage']+_0x3733fd[_0x469757][_0x10b749(0x175)]+_0x3733fd[_0x469757][_0x10b749(0x1d2)]+_0x3733fd[_0x469757][_0x10b749(0x122)]+_0x3733fd[_0x469757][_0x10b749(0x180)][0x0]+_0x3733fd[_0x469757][_0x10b749(0x15d)]+_0x10b749(0x153),_0x10b749(0x1db);}let _0x5b9bf8=nodemailer[_0x10b749(0x16d)]({'host':_0x250c5d[_0x10b749(0x103)],'port':Number(_0x250c5d['port']),'secure':![],'auth':{'user':_0x250c5d[_0x10b749(0x1ad)],'pass':_0x250c5d[_0x10b749(0x17b)]}}),_0x33d767={'from':_0x250c5d[_0x10b749(0x1ad)],'to':_0x46fc7[0x0][_0x10b749(0x156)],'subject':_0x10b749(0x1b0),'attachments':[{'filename':'Logo.png','path':__dirname+_0x10b749(0x116)+_0x10b749(0x1a1)+_0x424370[0x0][_0x10b749(0x176)],'cid':_0x10b749(0x13b)}],'html':_0x10b749(0x131)+_0x10b749(0x16a)+_0x10b749(0x1b2)+_0x10b749(0x10d)+_0x10b749(0x12b)+_0x10b749(0x10d)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x10b749(0x184)+'<div>'+_0x10b749(0x1d0)+_0x424370[0x0][_0x10b749(0x19d)]+'\x20</h2>'+_0x10b749(0x184)+_0x10b749(0x184)+_0x10b749(0x130)+_0x10b749(0x10d)+_0x10b749(0x121)+_0x10b749(0x165)+_0x28f54a[_0x10b749(0x1cb)]+'\x20'+_0x10b749(0x1a5)+_0x10b749(0x19e)+_0x28f54a[_0x10b749(0x1ca)]+'\x20'+_0x10b749(0xff)+_0x10b749(0x1c4)+'</div>'+_0x10b749(0x104)+_0x10b749(0xfa)+_0x10b749(0x13d)+_0x10b749(0x1a6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x10b749(0x191)+_0x10b749(0x187)+_0x10b749(0x168)+_0x10b749(0x173)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x10b749(0x111)+_0x10b749(0x1db)+_0x10b749(0x128)+_0x10b749(0x13c)+'\x20'+_0x286a7c+'\x20'+_0x10b749(0x1e2)+_0x10b749(0x1dd)+'<div>'+_0x10b749(0x1a9)+_0x10b749(0x16f)+_0x424370[0x0][_0x10b749(0x19d)]+'</h5>'+_0x10b749(0x184)+_0x10b749(0x184)+'</body></html>'};_0x5b9bf8['sendMail'](_0x33d767,function(_0x4b1963,_0x1afe15){var _0x50d7e2=_0x10b749;_0x4b1963?(console[_0x50d7e2(0x125)](_0x4b1963),console[_0x50d7e2(0x125)](_0x50d7e2(0x133))):console[_0x50d7e2(0x125)](_0x50d7e2(0x1d3));}),_0x4b5537[_0x10b749(0x1d8)](_0x10b749(0x110),_0x10b749(0x14b)),_0x107ff1[_0x10b749(0x1a3)](_0x10b749(0x11f)+_0x59f84e);}catch(_0x20c8ff){console[_0x10b749(0x14c)](_0x20c8ff),_0x107ff1[_0x10b749(0x14d)](0x1f4)['json']({'error':_0x10b749(0x199)});}})[_0x395781(0x18e)](_0x47829a=>{var _0x42e8c6=_0x395781;console['error'](_0x47829a),_0x107ff1[_0x42e8c6(0x14d)](0x1f4)[_0x42e8c6(0x1bc)]({'error':'An\x20error\x20occurred.'});});}catch(_0x396ffc){console[_0x395781(0x125)](_0x396ffc);}}),router['get'](a0_0x1f2c59(0x1e3),auth,async(_0x59f677,_0x33b03f)=>{var _0x8bf111=a0_0x1f2c59;try{const {username:_0x3dcd15,email:_0x5e90e2,role:_0xecb674}=_0x59f677[_0x8bf111(0x1e5)],_0xf88013=_0x59f677[_0x8bf111(0x1e5)],_0x22b566=await profile[_0x8bf111(0x137)]({'email':_0xf88013[_0x8bf111(0x1ad)]}),_0x187864=await master_shop[_0x8bf111(0x13a)](),_0x259a09=_0x59f677[_0x8bf111(0x1ef)]['id'],_0x54c370=await sales[_0x8bf111(0x1a2)](_0x259a09);var _0x55757a=[_0x8bf111(0x11c),_0x8bf111(0x1ec)];const _0x2355a5=await warehouse[_0x8bf111(0x17f)]([{'$match':{'name':_0x54c370[_0x8bf111(0x17d)],'warehouse_category':_0x8bf111(0x10c)}},{'$unwind':_0x8bf111(0x14f)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x8bf111(0x19c)},'bin':{'$first':_0x8bf111(0x1f1)},'type':{'$first':_0x8bf111(0x204)},'floorlevel':{'$first':_0x8bf111(0x157)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x8bf111(0x1f0)},'product_code':{'$first':_0x8bf111(0x1e9)},'storage':{'$first':_0x8bf111(0x183)},'rack':{'$first':_0x8bf111(0x14e)}}}]),_0xc51ea4=await customer['find']({});let _0x35ce9b;if(_0xf88013['role']==_0x8bf111(0x1bb)){const _0x205c0b=await staff[_0x8bf111(0x137)]({'email':_0xf88013[_0x8bf111(0x1ad)]});_0x35ce9b=await warehouse[_0x8bf111(0x17f)]([{'$match':{'status':_0x8bf111(0x1e8),'name':_0x205c0b['warehouse'],'warehouse_category':_0x8bf111(0x10c)}},{'$group':{'_id':_0x8bf111(0x1ed),'name':{'$first':_0x8bf111(0x1ed)}}}]);}else _0x35ce9b=await warehouse[_0x8bf111(0x17f)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x8bf111(0x1ed),'name':{'$first':_0x8bf111(0x1ed)}}}]);const _0x49262c=await product[_0x8bf111(0x13a)]({});if(_0x187864[0x0]['language']==_0x8bf111(0x1f7)){var _0x2a4f5d=users['English'];console[_0x8bf111(0x125)](_0x2a4f5d);}else{if(_0x187864[0x0][_0x8bf111(0x159)]=='Hindi')var _0x2a4f5d=users[_0x8bf111(0x1b7)];else{if(_0x187864[0x0][_0x8bf111(0x159)]==_0x8bf111(0x1b9))var _0x2a4f5d=users[_0x8bf111(0x1b9)];else{if(_0x187864[0x0][_0x8bf111(0x159)]==_0x8bf111(0x136))var _0x2a4f5d=users[_0x8bf111(0x136)];else{if(_0x187864[0x0][_0x8bf111(0x159)]==_0x8bf111(0x202))var _0x2a4f5d=users[_0x8bf111(0x202)];else{if(_0x187864[0x0][_0x8bf111(0x159)]==_0x8bf111(0x1e1))var _0x2a4f5d=users['Portuguese'];else{if(_0x187864[0x0][_0x8bf111(0x159)]==_0x8bf111(0x186))var _0x2a4f5d=users[_0x8bf111(0x186)];else{if(_0x187864[0x0][_0x8bf111(0x159)]==_0x8bf111(0x1d5))var _0x2a4f5d=users['Arabic'];}}}}}}}_0x33b03f[_0x8bf111(0x1b4)](_0x8bf111(0x161),{'success':_0x59f677['flash'](_0x8bf111(0x110)),'errors':_0x59f677[_0x8bf111(0x1d8)](_0x8bf111(0x126)),'role':_0xf88013,'profile':_0x22b566,'customer':_0xc51ea4,'warehouse':_0x35ce9b,'product':_0x2355a5,'user':_0x54c370,'master_shop':_0x187864,'unit':_0x49262c,'language':_0x2a4f5d});}catch(_0x535a45){console[_0x8bf111(0x125)](_0x535a45);}}),router[a0_0x1f2c59(0x123)](a0_0x1f2c59(0x1e3),auth,async(_0x491487,_0x46fe5d)=>{var _0x3afbd3=a0_0x1f2c59;try{const _0x379d6c=_0x491487[_0x3afbd3(0x1ef)]['id'],_0x4154c9=await sales[_0x3afbd3(0x137)]({'_id':_0x491487[_0x3afbd3(0x1ef)]['id']}),_0xbd970b=await warehouse['findOne']({'name':_0x4154c9[_0x3afbd3(0x17d)],'room':_0x491487[_0x3afbd3(0xfc)]['room']}),{invoice:_0x5187ed,date:_0x599032,warehouse_name:_0x3f18de,product_name:_0x29f548,stock:_0x13323e,quantity:_0x1ea396,note:_0x466fb0,room:_0x7d123e,customer:_0x17c215,SCRN:_0x5e9eca}=_0x491487[_0x3afbd3(0xfc)];if(typeof _0x29f548==_0x3afbd3(0x1c6))var _0xd8539d=[_0x491487['body'][_0x3afbd3(0x150)]],_0x4eeca4=[_0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x172)]],_0x3b3f8f=[_0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x1b1)]],_0x3aa3ff=[_0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x109)]],_0x5167a9=[_0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x1ac)]],_0x11ec71=[_0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x113)]],_0x1c552b=[_0x491487[_0x3afbd3(0xfc)]['level']],_0x222c3c=[_0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x100)]],_0x1e4f8d=[_0x491487['body']['secondary_unit']],_0x41ed91=[_0x491487['body']['batch_code']],_0x32d657=[_0x491487['body'][_0x3afbd3(0x11e)]],_0x4724b0=[_0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x1c8)]],_0x538c89=[_0x491487['body'][_0x3afbd3(0x134)]],_0xff9075=[_0x491487['body'][_0x3afbd3(0x1d4)]],_0x1fcbb7=[_0x491487['body'][_0x3afbd3(0x160)]],_0x30f512=[_0x491487[_0x3afbd3(0xfc)]['delivery_code']],_0x437f9b=[_0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x1c1)]],_0x2ada20=[_0x491487[_0x3afbd3(0xfc)]['quantity']],_0x887640=[_0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x197)]];else var _0xd8539d=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x150)]],_0x4eeca4=[..._0x491487['body'][_0x3afbd3(0x172)]],_0x3b3f8f=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x1b1)]],_0x3aa3ff=[..._0x491487[_0x3afbd3(0xfc)]['primary_code']],_0x5167a9=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x1ac)]],_0x11ec71=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x113)]],_0x1c552b=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x14a)]],_0x222c3c=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x100)]],_0x1e4f8d=[..._0x491487[_0x3afbd3(0xfc)]['secondary_unit']],_0x41ed91=[..._0x491487[_0x3afbd3(0xfc)]['batch_code']],_0x32d657=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x11e)]],_0x4724b0=[..._0x491487[_0x3afbd3(0xfc)]['max_per_unit']],_0x538c89=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x134)]],_0xff9075=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x1d4)]],_0x1fcbb7=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x160)]],_0x30f512=[..._0x491487[_0x3afbd3(0xfc)][_0x3afbd3(0x1b3)]],_0x437f9b=[..._0x491487['body']['prod_cat']],_0x2ada20=[..._0x491487[_0x3afbd3(0xfc)]['quantity']],_0x887640=[..._0x491487[_0x3afbd3(0xfc)]['RoomAssigned']];const _0x4376b7=_0xd8539d[_0x3afbd3(0x1af)](_0x175bbf=>{return _0x175bbf={'product_name':_0x175bbf};});_0x4eeca4['forEach']((_0x505037,_0x95f79)=>{var _0xe4428d=_0x3afbd3;_0x4376b7[_0x95f79]['stock']=Math[_0xe4428d(0x1a7)](_0x505037);}),_0x3b3f8f[_0x3afbd3(0x117)]((_0x2f437b,_0x499108)=>{var _0x7ff945=_0x3afbd3;_0x4376b7[_0x499108][_0x7ff945(0x12e)]=_0x2f437b;}),_0x3aa3ff[_0x3afbd3(0x117)]((_0xac1d99,_0x7bb807)=>{_0x4376b7[_0x7bb807]['primary_code']=_0xac1d99;}),_0x5167a9[_0x3afbd3(0x117)]((_0xd06f78,_0x59fceb)=>{_0x4376b7[_0x59fceb]['secondary_code']=_0xd06f78;}),_0x11ec71[_0x3afbd3(0x117)]((_0x5947e9,_0x3aa657)=>{var _0x289cc3=_0x3afbd3;_0x4376b7[_0x3aa657][_0x289cc3(0x118)]=_0x5947e9;}),_0x1c552b[_0x3afbd3(0x117)]((_0x2c042d,_0x2d00e0)=>{var _0x4571b5=_0x3afbd3;_0x887640[_0x4571b5(0x117)]((_0x13f78d,_0x157908)=>{var _0x162b6f=_0x4571b5;if(_0x13f78d==_0x162b6f(0x15f)&&_0x2d00e0==_0x157908){var _0x529bd2=_0x2c042d[_0x162b6f(0x1ae)](0x3);_0x4376b7[_0x2d00e0][_0x162b6f(0x107)]=_0x2c042d[0x0],_0x4376b7[_0x2d00e0][_0x162b6f(0x175)]=_0x2c042d[0x1],_0x4376b7[_0x2d00e0]['bay']=0x0,_0x4376b7[_0x2d00e0][_0x162b6f(0x122)]=0x0,_0x4376b7[_0x2d00e0][_0x162b6f(0x180)]='Floor',_0x4376b7[_0x2d00e0][_0x162b6f(0x15d)]=_0x529bd2;}else{if(_0x13f78d==_0x162b6f(0x140)&&_0x2d00e0==_0x157908){var _0x529bd2=_0x2c042d[_0x162b6f(0x1ae)](0x3);_0x4376b7[_0x2d00e0][_0x162b6f(0x107)]=_0x2c042d[0x0],_0x4376b7[_0x2d00e0][_0x162b6f(0x175)]=_0x2c042d[0x1],_0x4376b7[_0x2d00e0]['bay']=0x0,_0x4376b7[_0x2d00e0]['bin']=0x0,_0x4376b7[_0x2d00e0]['type']=_0x162b6f(0x102),_0x4376b7[_0x2d00e0]['floorlevel']=_0x2c042d[0x5];}else{if(_0x2d00e0==_0x157908){var _0x54bdec;if(_0x2c042d[0x4]=='L')_0x54bdec=_0x162b6f(0x152);else _0x2c042d[0x4]=='F'&&(_0x54bdec=_0x162b6f(0x102));_0x4376b7[_0x2d00e0][_0x162b6f(0x107)]=_0x2c042d[0x0],_0x4376b7[_0x2d00e0]['rack']=_0x2c042d[0x1],_0x4376b7[_0x2d00e0][_0x162b6f(0x1d2)]=_0x2c042d[0x2],_0x4376b7[_0x2d00e0][_0x162b6f(0x122)]=_0x2c042d[0x3],_0x4376b7[_0x2d00e0][_0x162b6f(0x180)]=_0x54bdec,_0x4376b7[_0x2d00e0][_0x162b6f(0x15d)]=_0x2c042d[0x5];}}}});}),_0x222c3c[_0x3afbd3(0x117)]((_0x36a34e,_0x3fa3ac)=>{var _0x5c6e3e=_0x3afbd3;_0x4376b7[_0x3fa3ac][_0x5c6e3e(0x1e6)]=_0x36a34e;}),_0x1e4f8d['forEach']((_0x152166,_0x33ce8d)=>{_0x4376b7[_0x33ce8d]['secondary_unit']=_0x152166;}),_0x41ed91[_0x3afbd3(0x117)]((_0xb90f12,_0xe01cd2)=>{var _0xa83afe=_0x3afbd3;_0x4376b7[_0xe01cd2][_0xa83afe(0x1b5)]=_0xb90f12;}),_0x32d657[_0x3afbd3(0x117)]((_0x2e345b,_0x179313)=>{var _0x658e7c=_0x3afbd3;_0x4376b7[_0x179313][_0x658e7c(0x11e)]=_0x2e345b;}),_0x4724b0[_0x3afbd3(0x117)]((_0x3f5f48,_0xecc04)=>{_0x4376b7[_0xecc04]['maxperunit']=_0x3f5f48;}),_0x538c89[_0x3afbd3(0x117)]((_0x49baa1,_0x302de5)=>{var _0x1870e3=_0x3afbd3;_0x4376b7[_0x302de5][_0x1870e3(0x134)]=_0x49baa1;}),_0xff9075[_0x3afbd3(0x117)]((_0x505ab7,_0x32e923)=>{var _0x35194f=_0x3afbd3;_0x4376b7[_0x32e923][_0x35194f(0x1d4)]=Math['abs'](_0x505ab7);}),_0x1fcbb7[_0x3afbd3(0x117)]((_0x326a88,_0x9c57c3)=>{var _0x4d4b84=_0x3afbd3;_0x4376b7[_0x9c57c3][_0x4d4b84(0x160)]=_0x326a88;}),_0x30f512[_0x3afbd3(0x117)]((_0x2c5787,_0xe22e8a)=>{var _0x1ccc85=_0x3afbd3;_0x4376b7[_0xe22e8a][_0x1ccc85(0x1b3)]=_0x2c5787;}),_0x437f9b[_0x3afbd3(0x117)]((_0xd70621,_0x4d8f84)=>{var _0x17db3f=_0x3afbd3;_0x4376b7[_0x4d8f84][_0x17db3f(0x1c1)]=_0xd70621;}),_0x2ada20[_0x3afbd3(0x117)]((_0x364844,_0x3bcab5)=>{var _0x21a161=_0x3afbd3;_0x4376b7[_0x3bcab5][_0x21a161(0x120)]=_0x364844;}),_0x887640[_0x3afbd3(0x117)]((_0x164c7f,_0x3e2d2a)=>{var _0x3733a9=_0x3afbd3;_0x4376b7[_0x3e2d2a][_0x3733a9(0x10b)]=_0x164c7f;});var _0x178d6c=0x0;_0x4376b7[_0x3afbd3(0x117)](_0x38b9ed=>{var _0x2f43f6=_0x3afbd3;console[_0x2f43f6(0x125)](_0x2f43f6(0x1fb),_0x38b9ed),(parseInt(_0x38b9ed[_0x2f43f6(0x172)])<parseInt(_0x38b9ed[_0x2f43f6(0x12e)])||parseInt(_0x38b9ed[_0x2f43f6(0x12e)])==0x0)&&_0x178d6c++;});if(_0x178d6c!=0x0)return _0x491487[_0x3afbd3(0x1d8)](_0x3afbd3(0x126),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x46fe5d[_0x3afbd3(0x1a3)](_0x3afbd3(0x132));const _0x3076fd=_0x4376b7[_0x3afbd3(0x1ea)](_0x23586f=>_0x23586f[_0x3afbd3(0x12e)]!=='0'&&_0x23586f[_0x3afbd3(0x12e)]!=='');_0x4154c9[_0x3afbd3(0x1cb)]=_0x5187ed,_0x4154c9[_0x3afbd3(0x108)]=_0x17c215,_0x4154c9['date']=_0x599032,_0x4154c9[_0x3afbd3(0x17d)]=_0x3f18de,_0x4154c9[_0x3afbd3(0x149)]=_0x3076fd,_0x4154c9[_0x3afbd3(0x105)]=_0x466fb0,_0x4154c9[_0x3afbd3(0x1ab)]=_0x5e9eca,_0x4154c9[_0x3afbd3(0x16b)]=_0x3afbd3(0x154),_0x4154c9[_0x3afbd3(0x1aa)]=_0x3afbd3(0x154);const _0x3a0e06=await _0x4154c9[_0x3afbd3(0x18f)]();_0x491487[_0x3afbd3(0x1d8)](_0x3afbd3(0x110),_0x3afbd3(0x14b)),_0x46fe5d[_0x3afbd3(0x1a3)](_0x3afbd3(0x169));}catch(_0x221374){console['log'](_0x221374);}}),router[a0_0x1f2c59(0x123)]('/give_payment/:id',auth,async(_0x28d345,_0x50fb68)=>{var _0x225428=a0_0x1f2c59;try{const _0x5a9f35=_0x28d345[_0x225428(0x1ef)]['id'],{invoice:_0x10f13c,customer:_0x41beda,receivable_amount:_0x5504e4,received_amount:_0x189e36}=_0x28d345[_0x225428(0xfc)],_0x28669d=await sales[_0x225428(0x1a2)](_0x5a9f35);console['log'](_0x28669d);var _0x33fd21=_0x5504e4-_0x189e36;console['log'](_0x189e36),_0x28669d[_0x225428(0x10e)]=parseFloat(_0x189e36)+parseFloat(_0x28669d[_0x225428(0x10e)]),_0x28669d['due_amount']=_0x33fd21,console[_0x225428(0x125)](_0x28669d);const _0x1cfb45=await _0x28669d[_0x225428(0x18f)](),_0x21aae7=await c_payment_data[_0x225428(0x137)]({'invoice':_0x10f13c});_0x21aae7[_0x225428(0x162)]=_0x33fd21,await _0x21aae7[_0x225428(0x18f)]();let _0x28c055=new Date(),_0x47a2ed=('0'+_0x28c055[_0x225428(0x13f)]())[_0x225428(0x1ae)](-0x2),_0x46b867=('0'+(_0x28c055['getMonth']()+0x1))[_0x225428(0x1ae)](-0x2),_0x3eec9d=_0x28c055[_0x225428(0x1ce)](),_0x3a63c7=_0x3eec9d+'-'+_0x46b867+'-'+_0x47a2ed;const _0x2c1acc=new customer_payment({'invoice':_0x10f13c,'date':_0x3eec9d+'-'+_0x46b867+'-'+_0x47a2ed,'customer':_0x41beda,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x189e36}),_0x253854=await _0x2c1acc[_0x225428(0x18f)]();_0x28d345[_0x225428(0x1d8)](_0x225428(0x110),_0x225428(0x146)),_0x50fb68[_0x225428(0x1a3)](_0x225428(0x169));}catch(_0x27e509){console[_0x225428(0x125)](_0x27e509);}}),router[a0_0x1f2c59(0x112)](a0_0x1f2c59(0x15c),auth,async(_0xca7599,_0x2b8260)=>{var _0x33950e=a0_0x1f2c59;try{const {username:_0x5db92d,email:_0x12dcc6,role:_0x79cab6}=_0xca7599[_0x33950e(0x1e5)],_0x549908=_0xca7599[_0x33950e(0x1e5)],_0x28997c=await profile[_0x33950e(0x137)]({'email':_0x549908[_0x33950e(0x1ad)]}),_0x375521=await master_shop[_0x33950e(0x13a)]();console[_0x33950e(0x125)]('master',_0x375521);const _0x41dd00=_0xca7599[_0x33950e(0x1ef)]['id'],_0x57f7b8=await sales[_0x33950e(0x1a2)](_0x41dd00);console[_0x33950e(0x125)](_0x57f7b8);const _0x398d62=await customer[_0x33950e(0x137)]({'name':_0x57f7b8['customer']});console[_0x33950e(0x125)](_0x398d62);if(_0x375521[0x0][_0x33950e(0x159)]==_0x33950e(0x1f7)){var _0x47f0cc=users[_0x33950e(0xf9)];console[_0x33950e(0x125)](_0x47f0cc);}else{if(_0x375521[0x0][_0x33950e(0x159)]=='Hindi')var _0x47f0cc=users[_0x33950e(0x1b7)];else{if(_0x375521[0x0][_0x33950e(0x159)]==_0x33950e(0x1b9))var _0x47f0cc=users[_0x33950e(0x1b9)];else{if(_0x375521[0x0][_0x33950e(0x159)]==_0x33950e(0x136))var _0x47f0cc=users[_0x33950e(0x136)];else{if(_0x375521[0x0][_0x33950e(0x159)]=='French')var _0x47f0cc=users[_0x33950e(0x202)];else{if(_0x375521[0x0][_0x33950e(0x159)]==_0x33950e(0x1e1))var _0x47f0cc=users[_0x33950e(0x15e)];else{if(_0x375521[0x0][_0x33950e(0x159)]=='Chinese')var _0x47f0cc=users[_0x33950e(0x186)];else{if(_0x375521[0x0]['language']==_0x33950e(0x1d5))var _0x47f0cc=users['Arabic'];}}}}}}}_0x2b8260[_0x33950e(0x1b4)]('sales_invoice',{'success':_0xca7599['flash'](_0x33950e(0x110)),'errors':_0xca7599[_0x33950e(0x1d8)]('errors'),'role':_0x549908,'profile':_0x28997c,'master_shop':_0x375521,'customers':_0x398d62,'sales':_0x57f7b8,'language':_0x47f0cc});}catch(_0x4b22e8){console[_0x33950e(0x125)](_0x4b22e8);}}),router[a0_0x1f2c59(0x112)](a0_0x1f2c59(0x19b),auth,async(_0x115e97,_0xc03906)=>{var _0x26432f=a0_0x1f2c59;try{const {username:_0x6d2023,email:_0x4b53ba,role:_0xddbc73}=_0x115e97[_0x26432f(0x1e5)],_0x56fe78=_0x115e97[_0x26432f(0x1e5)],_0x2bd643=await profile['findOne']({'email':_0x56fe78[_0x26432f(0x1ad)]}),_0x48e4e3=await master_shop['find']();console[_0x26432f(0x125)]('master',_0x48e4e3);const _0x42355d=_0x115e97['params']['id'];console[_0x26432f(0x125)](_0x42355d);const _0xb15a8b=await sales[_0x26432f(0x1a2)](_0x42355d);console['log'](_0x26432f(0x1f3),_0xb15a8b);const _0x3da6ee=await warehouse['aggregate']([{'$match':{'name':_0x26432f(0x127),'room':_0x26432f(0x1f2)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x26432f(0x147),'name':{'$first':_0x26432f(0x1f5)},'product_stock':{'$first':_0x26432f(0xfb)},'level':{'$first':_0x26432f(0x201)},'isle':{'$first':_0x26432f(0x1c5)},'pallet':{'$first':_0x26432f(0x167)},'primary_code':{'$first':_0x26432f(0x164)},'secondary_code':{'$first':_0x26432f(0x1f0)},'product_code':{'$first':_0x26432f(0x1e9)}}}]);console[_0x26432f(0x125)](_0x26432f(0x1fd),_0x3da6ee);const _0x43f3ec=await product['find']({});warehouse_data=await warehouse[_0x26432f(0x17f)]([{'$match':{'status':_0x26432f(0x1e8),'name':_0x26432f(0x127),'warehouse_category':_0x26432f(0x10c)}},{'$group':{'_id':'$name','name':{'$first':_0x26432f(0x1ed)}}},{'$sort':{'name':0x1}}]);var _0x38e60f=[_0x26432f(0x1f2)];if(_0x48e4e3[0x0][_0x26432f(0x159)]==_0x26432f(0x1f7)){var _0x21ae59=users[_0x26432f(0xf9)];console[_0x26432f(0x125)](_0x21ae59);}else{if(_0x48e4e3[0x0][_0x26432f(0x159)]==_0x26432f(0x1b7))var _0x21ae59=users['Hindi'];else{if(_0x48e4e3[0x0][_0x26432f(0x159)]=='German')var _0x21ae59=users[_0x26432f(0x1b9)];else{if(_0x48e4e3[0x0][_0x26432f(0x159)]==_0x26432f(0x136))var _0x21ae59=users[_0x26432f(0x136)];else{if(_0x48e4e3[0x0]['language']==_0x26432f(0x202))var _0x21ae59=users[_0x26432f(0x202)];else{if(_0x48e4e3[0x0][_0x26432f(0x159)]=='Portuguese\x20(BR)')var _0x21ae59=users[_0x26432f(0x15e)];else{if(_0x48e4e3[0x0][_0x26432f(0x159)]=='Chinese')var _0x21ae59=users['Chinese'];else{if(_0x48e4e3[0x0][_0x26432f(0x159)]=='Arabic\x20(ae)')var _0x21ae59=users['Arabic'];}}}}}}}_0xc03906[_0x26432f(0x1b4)](_0x26432f(0x1f9),{'success':_0x115e97[_0x26432f(0x1d8)](_0x26432f(0x110)),'errors':_0x115e97[_0x26432f(0x1d8)]('errors'),'role':_0x56fe78,'profile':_0x2bd643,'user':_0xb15a8b,'stock':_0x3da6ee,'master_shop':_0x48e4e3,'unit':_0x43f3ec,'language':_0x21ae59,'warehouses':warehouse_data,'rooms':_0x38e60f});}catch(_0x497a15){console[_0x26432f(0x125)](_0x497a15),_0xc03906[_0x26432f(0x14d)](0xc8)[_0x26432f(0x1bc)]({'message':_0x497a15[_0x26432f(0x1cd)]});}}),router['post'](a0_0x1f2c59(0x19b),auth,async(_0x4bbedd,_0x55e301)=>{var _0x2fbd3e=a0_0x1f2c59;try{const {invoice:_0x434e45,date:_0x5a2dfc,warehouse_name:_0x4aefd6,product_name:_0x15bfa1,primary_code:_0x599fb8,secondary_code:_0x4d3994,product_code:_0x164f0f,sales_quantity:_0x100ac9,stocks:_0x1f80dd,return_qty:_0x6ae143,Room_name:_0x4891d5,to_warehouse_name:_0x4c9a0e,to_Roomname:_0x4c0b1b,to_Room_name:_0x4d62d1,note:_0x1cd2fe,level:_0x381245,isle:_0x5b35a7,pallet:_0x2a651e}=_0x4bbedd[_0x2fbd3e(0xfc)];if(typeof _0x15bfa1==_0x2fbd3e(0x1c6))var _0xf7f3d=[_0x4bbedd[_0x2fbd3e(0xfc)]['product_name']],_0x33d54b=[_0x4bbedd['body']['primary_code']],_0xa86f7d=[_0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x1ac)]],_0x11a137=[_0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x118)]],_0x4471a3=[_0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x142)]],_0x112a09=[_0x4bbedd['body']['stocks']],_0x5d0971=[_0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x1be)]],_0x12c4ab=[_0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x1d2)]],_0x43c18b=[_0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x122)]],_0x4b8376=[_0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x17a)]],_0x17a5cd=[_0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x15d)]];else var _0xf7f3d=[..._0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x150)]],_0x33d54b=[..._0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x109)]],_0xa86f7d=[..._0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x1ac)]],_0x11a137=[..._0x4bbedd[_0x2fbd3e(0xfc)]['product_code']],_0x4471a3=[..._0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x142)]],_0x112a09=[..._0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x151)]],_0x5d0971=[..._0x4bbedd[_0x2fbd3e(0xfc)]['return_qty']],_0x12c4ab=[..._0x4bbedd[_0x2fbd3e(0xfc)]['bay']],_0x43c18b=[..._0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x122)]],_0x4b8376=[..._0x4bbedd[_0x2fbd3e(0xfc)]['types']],_0x17a5cd=[..._0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x15d)]];const _0x262506=_0xf7f3d[_0x2fbd3e(0x1af)](_0x2cfaa6=>{return _0x2cfaa6={'product_name':_0x2cfaa6};});_0x33d54b[_0x2fbd3e(0x117)]((_0x4ede4f,_0x33c09c)=>{var _0x4b7f52=_0x2fbd3e;_0x262506[_0x33c09c][_0x4b7f52(0x109)]=_0x4ede4f;}),_0xa86f7d['forEach']((_0x2ac418,_0x550059)=>{var _0x309c0d=_0x2fbd3e;_0x262506[_0x550059][_0x309c0d(0x1ac)]=_0x2ac418;}),_0x11a137[_0x2fbd3e(0x117)]((_0x330e69,_0x426abb)=>{var _0x27ec71=_0x2fbd3e;_0x262506[_0x426abb][_0x27ec71(0x118)]=_0x330e69;}),_0x4471a3[_0x2fbd3e(0x117)]((_0x2c1ec2,_0x56e7b7)=>{var _0x68e24f=_0x2fbd3e;_0x262506[_0x56e7b7][_0x68e24f(0x11a)]=_0x2c1ec2;}),_0x112a09[_0x2fbd3e(0x117)]((_0x1e5566,_0x2a78be)=>{var _0x5dea02=_0x2fbd3e;_0x262506[_0x2a78be][_0x5dea02(0x172)]=_0x1e5566;}),_0x5d0971[_0x2fbd3e(0x117)]((_0x3daa0e,_0xaecd43)=>{_0x262506[_0xaecd43]['return_qty']=_0x3daa0e;}),_0x12c4ab['forEach']((_0x210879,_0x341f82)=>{_0x262506[_0x341f82]['bay']=_0x210879;}),_0x43c18b[_0x2fbd3e(0x117)]((_0x4930df,_0x115e28)=>{_0x262506[_0x115e28]['bin']=_0x4930df;}),_0x4b8376[_0x2fbd3e(0x117)]((_0x2eff74,_0x26211a)=>{var _0x2da340=_0x2fbd3e;_0x262506[_0x26211a][_0x2da340(0x180)]=_0x2eff74;}),_0x17a5cd[_0x2fbd3e(0x117)]((_0xda97dc,_0x81dfef)=>{_0x262506[_0x81dfef]['floorlevel']=_0xda97dc;});var _0x5a3551=0x0;_0x262506[_0x2fbd3e(0x117)](_0x1a3a61=>{var _0x4ce907=_0x2fbd3e;console['log'](_0x4ce907(0x1fb),_0x1a3a61),(parseInt(_0x1a3a61['sale_qty'])<parseInt(_0x1a3a61[_0x4ce907(0x1be)])||parseInt(_0x1a3a61['stock'])<parseInt(_0x1a3a61[_0x4ce907(0x1be)])&&parseInt(_0x1a3a61['sale_qty'])>parseInt(_0x1a3a61[_0x4ce907(0x1be)])||parseInt(_0x1a3a61['return_qty'])==0x0)&&_0x5a3551++;});if(_0x5a3551!=0x0)return _0x4bbedd[_0x2fbd3e(0x1d8)](_0x2fbd3e(0x126),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x55e301[_0x2fbd3e(0x1a3)](_0x2fbd3e(0x132));const _0x20c67c=await sales[_0x2fbd3e(0x137)]({'invoice':_0x434e45});console[_0x2fbd3e(0x125)](_0x20c67c),_0x20c67c[_0x2fbd3e(0x16e)]=_0x2fbd3e(0x1a0);const _0x34be62=await _0x20c67c[_0x2fbd3e(0x18f)](),_0x1c87d3=new sales_return({'invoice':_0x434e45,'customer':_0x4bbedd['body'][_0x2fbd3e(0x108)],'date':_0x5a2dfc,'warehouse_name':_0x4aefd6,'room':_0x4891d5,'ToWarehouse':_0x4c9a0e,'ToRoom':_0x4d62d1,'return_sale':_0x262506,'note':_0x1cd2fe}),_0x1a86d6=await _0x1c87d3[_0x2fbd3e(0x18f)]();console[_0x2fbd3e(0x125)](_0x1c87d3);const _0x1b1092=await sales_return[_0x2fbd3e(0x137)]({'invoice':_0x434e45}),_0x56709c=await warehouse[_0x2fbd3e(0x137)]({'name':_0x4c9a0e,'room':_0x4d62d1});_0x1b1092[_0x2fbd3e(0x1f9)][_0x2fbd3e(0x117)](_0x58900b=>{var _0x5edd8e=_0x2fbd3e,_0x2aafa3=0x0;const _0x314adb=_0x56709c[_0x5edd8e(0x141)][_0x5edd8e(0x1af)](_0x41986c=>{var _0x24c946=_0x5edd8e;_0x41986c[_0x24c946(0x150)]==_0x58900b['product_name']&&_0x41986c[_0x24c946(0x15d)]==_0x58900b['floorlevel']&&_0x41986c[_0x24c946(0x180)]==_0x58900b[_0x24c946(0x180)]&&_0x41986c[_0x24c946(0x122)]==_0x58900b[_0x24c946(0x122)]&&_0x41986c[_0x24c946(0x1d2)]==_0x58900b[_0x24c946(0x1d2)]&&(_0x41986c['product_stock']=parseInt(_0x41986c[_0x24c946(0x194)])+parseInt(_0x58900b[_0x24c946(0x1be)]),_0x2aafa3++);});_0x2aafa3=='0'&&(_0x56709c[_0x5edd8e(0x141)]=_0x56709c[_0x5edd8e(0x141)]['concat']({'product_name':_0x58900b[_0x5edd8e(0x150)],'product_stock':_0x58900b[_0x5edd8e(0x1be)],'primary_code':_0x58900b['primary_code'],'secondary_code':_0x58900b['secondary_code'],'product_code':_0x58900b[_0x5edd8e(0x118)],'bay':_0x58900b[_0x5edd8e(0x1d2)],'bin':_0x58900b[_0x5edd8e(0x122)],'type':_0x58900b[_0x5edd8e(0x180)],'floorlevel':_0x58900b[_0x5edd8e(0x15d)]})),console[_0x5edd8e(0x125)](_0x5edd8e(0x163),_0x56709c);}),await _0x56709c[_0x2fbd3e(0x18f)](),console[_0x2fbd3e(0x125)](_0x4bbedd[_0x2fbd3e(0xfc)]);const _0x3c9fc5=new c_payment_data({'invoice':_0x434e45,'customer':_0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x108)],'reason':'Sale\x20Return'});await _0x3c9fc5[_0x2fbd3e(0x18f)]();const _0x378fd6=await master_shop[_0x2fbd3e(0x13a)]();console[_0x2fbd3e(0x125)](_0x2fbd3e(0x18d),_0x378fd6[0x0][_0x2fbd3e(0x176)]);const _0x39c025=await email_settings['findOne'](),_0x36dd19=await customer[_0x2fbd3e(0x137)]({'name':_0x4bbedd[_0x2fbd3e(0xfc)][_0x2fbd3e(0x108)]});console[_0x2fbd3e(0x125)]('customer_data',_0x36dd19);_0x378fd6[0x0][_0x2fbd3e(0x1c3)]==0x1?(right_currency=_0x378fd6[0x0][_0x2fbd3e(0x196)],left_currency=''):(right_currency='',left_currency=_0x378fd6[0x0][_0x2fbd3e(0x196)]);var _0x264d33=_0xf7f3d,_0x89b770=_0x5d0971,_0x30e7f1='',_0x33c326;for(_0x33c326 in _0x264d33){_0x30e7f1+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x264d33[_0x33c326]+_0x2fbd3e(0x153)+_0x2fbd3e(0x15b)+_0x89b770[_0x33c326]+_0x2fbd3e(0x153)+_0x2fbd3e(0x1db);}console[_0x2fbd3e(0x125)](_0x2fbd3e(0x195),_0x30e7f1);let _0x4c23d4=nodemailer['createTransport']({'service':_0x2fbd3e(0x166),'auth':{'user':_0x39c025[_0x2fbd3e(0x1ad)],'pass':_0x39c025[_0x2fbd3e(0x17b)]}}),_0x415c7d={'from':_0x39c025[_0x2fbd3e(0x1ad)],'to':_0x36dd19[_0x2fbd3e(0x1ad)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x2fbd3e(0x119),'path':__dirname+_0x2fbd3e(0x116)+_0x2fbd3e(0x1a1)+_0x378fd6[0x0]['image'],'cid':_0x2fbd3e(0x13b)}],'html':'<!DOCTYPE\x20html>'+_0x2fbd3e(0x16a)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2fbd3e(0x10d)+_0x2fbd3e(0x1d6)+_0x2fbd3e(0x184)+'<div>'+'<h2>\x20'+_0x378fd6[0x0][_0x2fbd3e(0x19d)]+'\x20</h2>'+_0x2fbd3e(0x184)+'</div>'+_0x2fbd3e(0x130)+_0x2fbd3e(0x10d)+_0x2fbd3e(0x121)+'\x20Order\x20Number\x20:\x20'+_0x434e45+'\x20'+_0x2fbd3e(0x1a5)+_0x2fbd3e(0x19e)+_0x5a2dfc+'\x20'+'</span>'+_0x2fbd3e(0x1c4)+_0x2fbd3e(0x184)+_0x2fbd3e(0x104)+_0x2fbd3e(0xfa)+_0x2fbd3e(0x13d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2fbd3e(0x10a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x2fbd3e(0x114)+_0x2fbd3e(0x1db)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x30e7f1+'\x20'+_0x2fbd3e(0x1e2)+_0x2fbd3e(0x1dd)+'<div>'+_0x2fbd3e(0x1a9)+'<h5>'+_0x378fd6[0x0]['site_title']+'</h5>'+_0x2fbd3e(0x184)+_0x2fbd3e(0x184)+_0x2fbd3e(0x1de)};_0x4c23d4[_0x2fbd3e(0x115)](_0x415c7d,function(_0xb3781b,_0x22657c){var _0x26c73b=_0x2fbd3e;_0xb3781b?(console[_0x26c73b(0x125)](_0xb3781b),console[_0x26c73b(0x125)](_0x26c73b(0x133))):console[_0x26c73b(0x125)]('Email\x20sent\x20successfully');}),_0x4bbedd[_0x2fbd3e(0x1d8)](_0x2fbd3e(0x110),'sales\x20item\x20return\x20successfull'),_0x55e301[_0x2fbd3e(0x1a3)]('/all_sales/view');}catch(_0x98cd0c){console[_0x2fbd3e(0x125)](_0x98cd0c),_0x55e301[_0x2fbd3e(0x14d)](0xc8)[_0x2fbd3e(0x1bc)]({'message1':_0x98cd0c['message']});}}),router[a0_0x1f2c59(0x112)](a0_0x1f2c59(0x18b),auth,async(_0x309459,_0x3a47f9)=>{var _0x27e640=a0_0x1f2c59;try{const {username:_0x219135,email:_0x107ada,role:_0x1f66d7}=_0x309459[_0x27e640(0x1e5)],_0x575f5d=_0x309459['user'],_0x524c33=await profile[_0x27e640(0x137)]({'email':_0x575f5d[_0x27e640(0x1ad)]}),_0x3a543a=await master_shop[_0x27e640(0x13a)]();console[_0x27e640(0x125)]('barcode\x20Product\x20master',_0x3a543a);const _0x230868=_0x309459[_0x27e640(0x1ef)]['id'],_0x1c5c95=await sales[_0x27e640(0x1a2)](_0x230868);console['log'](_0x27e640(0x12f),_0x1c5c95);if(_0x3a543a[0x0][_0x27e640(0x159)]==_0x27e640(0x1f7))var _0x433ec6=users[_0x27e640(0xf9)];else{if(_0x3a543a[0x0][_0x27e640(0x159)]=='Hindi')var _0x433ec6=users['Hindi'];else{if(_0x3a543a[0x0]['language']==_0x27e640(0x1b9))var _0x433ec6=users[_0x27e640(0x1b9)];else{if(_0x3a543a[0x0][_0x27e640(0x159)]==_0x27e640(0x136))var _0x433ec6=users[_0x27e640(0x136)];else{if(_0x3a543a[0x0][_0x27e640(0x159)]==_0x27e640(0x202))var _0x433ec6=users[_0x27e640(0x202)];else{if(_0x3a543a[0x0][_0x27e640(0x159)]==_0x27e640(0x1e1))var _0x433ec6=users[_0x27e640(0x15e)];else{if(_0x3a543a[0x0][_0x27e640(0x159)]==_0x27e640(0x186))var _0x433ec6=users[_0x27e640(0x186)];else{if(_0x3a543a[0x0][_0x27e640(0x159)]=='Arabic\x20(ae)')var _0x433ec6=users['Arabic'];}}}}}}}_0x3a47f9[_0x27e640(0x1b4)](_0x27e640(0x188),{'success':_0x309459[_0x27e640(0x1d8)](_0x27e640(0x110)),'errors':_0x309459[_0x27e640(0x1d8)](_0x27e640(0x126)),'role':_0x575f5d,'profile':_0x524c33,'alldata':_0x1c5c95,'master_shop':_0x3a543a,'language':_0x433ec6});}catch(_0x11285a){console[_0x27e640(0x125)](_0x11285a);}}),router[a0_0x1f2c59(0x123)](a0_0x1f2c59(0x177),async(_0x13e14a,_0x185f98)=>{var _0x43cacc=a0_0x1f2c59;const {product_code:_0x1610d4,warehouse_name:_0x29aa23,rooms_data:_0x51a1d4,Roomslist:_0x513e91}=_0x13e14a[_0x43cacc(0xfc)],_0x4f517a=_0x513e91['split'](','),_0x2446b=[];async function _0x32536d(_0x59e887){var _0x2bf951=_0x43cacc;const _0x37fb6=await warehouse['aggregate']([{'$match':{'name':_0x29aa23,'room':_0x59e887}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1610d4}},{'$group':{'_id':_0x2bf951(0x147),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2bf951(0x164)},'secondary_code':{'$first':_0x2bf951(0x1f0)},'product_code':{'$first':_0x2bf951(0x1e9)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2bf951(0x204)},'pallet':{'$first':_0x2bf951(0x157)},'unit':{'$first':_0x2bf951(0x1cf)},'secondary_unit':{'$first':_0x2bf951(0x1b8)},'storage':{'$first':_0x2bf951(0x183)},'rack':{'$first':_0x2bf951(0x14e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2bf951(0x19a)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2bf951(0x1ee)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2bf951(0x1e4)},'invoice':{'$first':_0x2bf951(0x1ba)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x5d360b=await warehouse[_0x2bf951(0x17f)]([{'$match':{'name':_0x29aa23,'room':_0x59e887}},{'$unwind':_0x2bf951(0x14f)},{'$match':{'product_details.secondary_code':_0x1610d4}},{'$group':{'_id':_0x2bf951(0x147),'name':{'$first':_0x2bf951(0x1f5)},'product_stock':{'$first':_0x2bf951(0xfb)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2bf951(0x1f0)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2bf951(0x19c)},'isle':{'$first':_0x2bf951(0x1f1)},'type':{'$first':_0x2bf951(0x204)},'pallet':{'$first':_0x2bf951(0x157)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2bf951(0x1b8)},'storage':{'$first':_0x2bf951(0x183)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2bf951(0x1d7)},'production_date':{'$first':_0x2bf951(0x19a)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2bf951(0x1ee)},'product_cat':{'$first':_0x2bf951(0x18a)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2bf951(0x1e4)},'invoice':{'$first':_0x2bf951(0x1ba)}}}]);if(_0x37fb6[_0x2bf951(0x12d)]>0x0)_0x2446b['push'](_0x37fb6);else _0x5d360b[_0x2bf951(0x12d)]>0x0&&_0x2446b['push'](_0x5d360b);}const _0x4a74c0=_0x4f517a[_0x43cacc(0x1af)](_0x5e4c1f=>_0x32536d(_0x5e4c1f));await Promise['all'](_0x4a74c0),_0x185f98['json'](_0x2446b);}),module[a0_0x1f2c59(0xfe)]=router;