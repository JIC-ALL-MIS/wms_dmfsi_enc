var a0_0x1a2bca=a0_0x4501;function a0_0x1e86(){var _0x440b04=['468395gDFUTM','redirect','Sale\x20Return','master','rack','German','$sale_product.type','staff','floorlevel','barcode\x20Product\x20master','RMSEmail','$product_details.invoice','currency_placement','Level','stocks','Enclosed','/upload/','/view/add_sales','/view/return_sales/:id','$product','Raw\x20Materials','errors','product_stock','</table>','role','An\x20error\x20occurred\x20while\x20saving\x20data.','Logo.png','Spanish','$product_details.product_code','Arabic\x20(ae)','$isAllowEdit','prod_invoice','RoomAssigned','1122cnTxPZ','204852XPFbNE','delivery_code','$product_details.batch_code','$product_details.product_cat','$product_details.rack','<hr\x20class=\x22my-3\x22>','sale_qty','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.unit','Sales\x20Update\x20successfully','forEach','</td>','/preview/:id','</head><body>','French','return_data','<!DOCTYPE\x20html>','final','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Error\x20Occurs','amount','$return_data','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','getDate','/all_sales/view','There\x27s\x20a\x20error\x20in\x20this\x20transaction','production_date','received_amount','catch','Router','Sales\x20Add\x20successfully','requested_qty','save','password','Enabled','4933936XATUjb','warehouse','types','return_sale','$finalize','quantity_notConverted','error','name','<div>','Receiving\x20Area','$_id','$product_details.storage','Chinese','/barcode/:id','sales_invoice','primary_unit','currency','</div>','$sale_product.bin','invoice','findById','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','success','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','all_sales_barcode','sales\x20all_data','</body></html>','$product_details.secondary_unit','OUT-','../middleware/auth','/invoice/:id','../models/all_models','unit','express','True','</tr>','length','$product_details.bay','getMonth','logo','product_details','$product_details.primary_code','quantity','$name','post','padStart','English','$product_details.type','floor','json','$product_details.isle','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','random','find','primary_code','isAllowEdit','$product_details.expiry_date','string','customer_data','slice','room','stock','Floor','<tr>','all','return_qty','Portuguese\x20(BR)','<table\x20style=\x22width:\x20100%\x20!important;\x22>','1490XJZEJy','product_code','$date','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','/../public','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','get','$sale_product.bay','</h5>','stock_data','$product_details.production_date','findOne','$product_details.secondary_code','$product_details.floorlevel','$note','/give_payment/:id','back','Hindi','$sale_product.quantity','sendMail','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','customers','storage','level','concat','16101FHlXGM','due_amount','sales_quantity','email','gmail','filter','render','foreach\x20newproduct','then','flash','product_name','image','Portuguese','\x20Order\x20Number\x20:\x20','bay','\x20Order\x20Date\x20:\x20','English\x20(US)','/all_sales/preview/','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.product_stock','bin','$product_details._id','<tbody\x20style=\x22text-align:\x20center;\x22>','add\x20post','aggregate','sale_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','product_data','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.bin','Received\x20Payment\x20For\x20Sale','language','nodemailer','<h2>\x20','</thead>','Shelves','edit_sales','An\x20error\x20occurred.','$product_details.actual_qty','payment\x20successfull','$warehouse_name','type','$sale_product.floorlevel','</tbody>','_id','<strong>\x20Regards\x20</strong>','/view/add_sales/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','createTransport','user','max_per_unit','42iOubba','514992poGVTh','<span\x20style=\x22float:\x20right;\x22>','32721uUxorb','<html><head><title></title>','finalize','<h5>','Email\x20sent\x20successfully','carton','params','$customers_docs','status','exports','customer','</span>','prod_code','173738iVJVTo','prod_cat','/barcode_scanner','$product_details.level','expiry_date','/view/add_sale/product','delivery_date','$sale_product','log','../public/language/languages.json','message','144edmPiS','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','port','date','Return\x20Rooms','room_name','product_list','$product_details','$customer','$invoice','1OULqpG','purchases_data','/view/:id','False','$product_details.maxPerUnit','warehouse_name','Return\x20Goods','all_sales','$room','secondary_code','maxperunit','Sale\x20Return\x20Mail','getFullYear','$product_details.product_name','user_id','/view','Sales\x20Mail','secondary_unit','batch_code','body','split','site_title'];a0_0x1e86=function(){return _0x440b04;};return a0_0x1e86();}function a0_0x4501(_0x1f4c37,_0x45f08f){var _0x1e869b=a0_0x1e86();return a0_0x4501=function(_0x450194,_0x107ac0){_0x450194=_0x450194-0x1d1;var _0x46ce51=_0x1e869b[_0x450194];return _0x46ce51;},a0_0x4501(_0x1f4c37,_0x45f08f);}(function(_0x4b856f,_0xdc3fdc){var _0x11085e=a0_0x4501,_0x28bf3b=_0x4b856f();while(!![]){try{var _0x45c998=-parseInt(_0x11085e(0x295))/0x1*(parseInt(_0x11085e(0x280))/0x2)+parseInt(_0x11085e(0x273))/0x3*(parseInt(_0x11085e(0x28b))/0x4)+-parseInt(_0x11085e(0x2ab))/0x5*(parseInt(_0x11085e(0x270))/0x6)+-parseInt(_0x11085e(0x1dd))/0x7+-parseInt(_0x11085e(0x271))/0x8+-parseInt(_0x11085e(0x23c))/0x9*(parseInt(_0x11085e(0x222))/0xa)+-parseInt(_0x11085e(0x2cc))/0xb*(-parseInt(_0x11085e(0x2cd))/0xc);if(_0x45c998===_0xdc3fdc)break;else _0x28bf3b['push'](_0x28bf3b['shift']());}catch(_0x48996e){_0x28bf3b['push'](_0x28bf3b['shift']());}}}(a0_0x1e86,0x56ca1));const express=require(a0_0x1a2bca(0x1ff)),app=express(),router=express[a0_0x1a2bca(0x1d7)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1a2bca(0x1fd)),auth=require(a0_0x1a2bca(0x1fb)),nodemailer=require(a0_0x1a2bca(0x25d)),users=require(a0_0x1a2bca(0x289));router[a0_0x1a2bca(0x229)](a0_0x1a2bca(0x2a4),auth,async(_0xd9a949,_0x57d839)=>{var _0x5112b3=a0_0x1a2bca;try{const {username:_0x23791e,email:_0x4909ed,role:_0x2d1fd9}=_0xd9a949[_0x5112b3(0x26e)],_0x617090=_0xd9a949[_0x5112b3(0x26e)],_0x8ceffd=await profile['findOne']({'email':_0x617090[_0x5112b3(0x23f)]}),_0x3bd8df=await master_shop[_0x5112b3(0x213)]();let _0x399704;if(_0x617090['role']==_0x5112b3(0x2b2)){const _0xcb6574=await staff[_0x5112b3(0x22e)]({'email':_0x617090['email']});_0x399704=await sales['aggregate']([{'$lookup':{'from':_0x5112b3(0x238),'localField':_0x5112b3(0x27d),'foreignField':_0x5112b3(0x1e4),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x5112b3(0x287)},{'$group':{'_id':_0x5112b3(0x1e7),'invoice':{'$first':_0x5112b3(0x294)},'customers':{'$first':_0x5112b3(0x293)},'date':{'$first':_0x5112b3(0x224)},'warehouse_name':{'$first':_0x5112b3(0x265)},'sale_product':{'$push':_0x5112b3(0x287)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x5112b3(0x27a)},'total_saleproduct_quantity':{'$sum':_0x5112b3(0x235)},'level':{'$addToSet':_0x5112b3(0x22a)},'isle':{'$addToSet':_0x5112b3(0x1ef)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x5112b3(0x267)},'finalize':{'$first':_0x5112b3(0x1e1)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x399704=await sales[_0x5112b3(0x255)]([{'$lookup':{'from':_0x5112b3(0x238),'localField':_0x5112b3(0x27d),'foreignField':'name','as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x5112b3(0x287)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x5112b3(0x293)},'date':{'$first':_0x5112b3(0x224)},'warehouse_name':{'$first':_0x5112b3(0x265)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x5112b3(0x231)},'return_data':{'$first':_0x5112b3(0x2e2)},'customers_docs':{'$first':_0x5112b3(0x27a)},'total_saleproduct_quantity':{'$sum':_0x5112b3(0x235)},'level':{'$addToSet':_0x5112b3(0x22a)},'isle':{'$addToSet':_0x5112b3(0x1ef)},'type':{'$addToSet':_0x5112b3(0x2b1)},'pallet':{'$addToSet':_0x5112b3(0x267)},'finalize':{'$first':_0x5112b3(0x1e1)},'isAllowEdit':{'$first':_0x5112b3(0x2c9)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5112b3(0x288)](_0x5112b3(0x1f7),_0x399704);if(_0x3bd8df[0x0]['language']==_0x5112b3(0x24c)){var _0x32b196=users['English'];console['log'](_0x32b196);}else{if(_0x3bd8df[0x0][_0x5112b3(0x25c)]=='Hindi')var _0x32b196=users[_0x5112b3(0x234)];else{if(_0x3bd8df[0x0][_0x5112b3(0x25c)]==_0x5112b3(0x2b0))var _0x32b196=users[_0x5112b3(0x2b0)];else{if(_0x3bd8df[0x0][_0x5112b3(0x25c)]==_0x5112b3(0x2c6))var _0x32b196=users['Spanish'];else{if(_0x3bd8df[0x0][_0x5112b3(0x25c)]==_0x5112b3(0x2db))var _0x32b196=users['French'];else{if(_0x3bd8df[0x0][_0x5112b3(0x25c)]=='Portuguese\x20(BR)')var _0x32b196=users[_0x5112b3(0x248)];else{if(_0x3bd8df[0x0][_0x5112b3(0x25c)]==_0x5112b3(0x1e9))var _0x32b196=users[_0x5112b3(0x1e9)];else{if(_0x3bd8df[0x0][_0x5112b3(0x25c)]==_0x5112b3(0x2c8))var _0x32b196=users['Arabic'];}}}}}}}_0x57d839[_0x5112b3(0x242)](_0x5112b3(0x29c),{'success':_0xd9a949[_0x5112b3(0x245)]('success'),'errors':_0xd9a949[_0x5112b3(0x245)](_0x5112b3(0x2c0)),'sales':_0x399704,'profile':_0x8ceffd,'role':_0x617090,'master_shop':_0x3bd8df,'language':_0x32b196});}catch(_0x29308c){console[_0x5112b3(0x288)](_0x29308c);}});async function getRandom8DigitNumber(){var _0x4a482e=a0_0x1a2bca;const _0x2ed0f0=0x989680,_0x26a8ed=0x5f5e0ff,_0x4986e6=Math[_0x4a482e(0x20e)](Math[_0x4a482e(0x212)]()*(_0x26a8ed-_0x2ed0f0+0x1))+_0x2ed0f0;var _0x26e146;const _0x2d36be=await sales['findOne']({'invoice':'OUT-'+_0x4986e6});return _0x2d36be&&_0x2d36be[_0x4a482e(0x202)]>0x0?_0x26e146='OUT-'+_0x4986e6:_0x26e146='OUT-'+_0x4986e6,_0x26e146;}router['get'](a0_0x1a2bca(0x2bc),auth,async(_0x401df6,_0x3ff821)=>{var _0x13d9b1=a0_0x1a2bca;try{const {username:_0x5a80e4,email:_0x14072d,role:_0x4d6876}=_0x401df6[_0x13d9b1(0x26e)],_0x468352=_0x401df6[_0x13d9b1(0x26e)],_0x3311db=await profile[_0x13d9b1(0x22e)]({'email':_0x468352[_0x13d9b1(0x23f)]}),_0x3b37ce=await master_shop[_0x13d9b1(0x213)](),_0x3ac01a=await customer[_0x13d9b1(0x213)]({});let _0x1cd5fc;if(_0x468352[_0x13d9b1(0x2c3)]==_0x13d9b1(0x2b2)){const _0xfdeb6f=await staff[_0x13d9b1(0x22e)]({'email':_0x468352[_0x13d9b1(0x23f)]});_0x1cd5fc=await warehouse[_0x13d9b1(0x255)]([{'$match':{'status':'Enabled','name':_0xfdeb6f['warehouse'],'warehouse_category':_0x13d9b1(0x2bf),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x1cd5fc=await warehouse[_0x13d9b1(0x255)]([{'$match':{'status':_0x13d9b1(0x1dc),'warehouse_category':_0x13d9b1(0x2bf),'name':{'$ne':_0x13d9b1(0x29b)}}},{'$group':{'_id':'$name','name':{'$first':_0x13d9b1(0x209)}}},{'$sort':{'name':0x1}}]);const _0x44e64d=await product[_0x13d9b1(0x213)]({});var _0x43d8c7=[_0x13d9b1(0x24e),_0x13d9b1(0x2ba)];const _0x268750=await sales[_0x13d9b1(0x213)]({}),_0x36da5e=_0x268750['length']+0x1,_0x4c4f2d=_0x13d9b1(0x1fa)+_0x36da5e['toString']()[_0x13d9b1(0x20b)](0x5,'0');if(_0x3b37ce[0x0][_0x13d9b1(0x25c)]=='English\x20(US)'){var _0x34c671=users[_0x13d9b1(0x20c)];console['log'](_0x34c671);}else{if(_0x3b37ce[0x0]['language']==_0x13d9b1(0x234))var _0x34c671=users[_0x13d9b1(0x234)];else{if(_0x3b37ce[0x0][_0x13d9b1(0x25c)]==_0x13d9b1(0x2b0))var _0x34c671=users[_0x13d9b1(0x2b0)];else{if(_0x3b37ce[0x0][_0x13d9b1(0x25c)]=='Spanish')var _0x34c671=users[_0x13d9b1(0x2c6)];else{if(_0x3b37ce[0x0][_0x13d9b1(0x25c)]==_0x13d9b1(0x2db))var _0x34c671=users['French'];else{if(_0x3b37ce[0x0][_0x13d9b1(0x25c)]==_0x13d9b1(0x220))var _0x34c671=users[_0x13d9b1(0x248)];else{if(_0x3b37ce[0x0][_0x13d9b1(0x25c)]==_0x13d9b1(0x1e9))var _0x34c671=users[_0x13d9b1(0x1e9)];else{if(_0x3b37ce[0x0][_0x13d9b1(0x25c)]==_0x13d9b1(0x2c8))var _0x34c671=users[_0x13d9b1(0x1f4)];}}}}}}}const _0x3d36ec=getRandom8DigitNumber();_0x3d36ec[_0x13d9b1(0x244)](_0x2d64d8=>{var _0x137140=_0x13d9b1;_0x3ff821[_0x137140(0x242)]('add_sales',{'success':_0x401df6['flash'](_0x137140(0x1f3)),'errors':_0x401df6[_0x137140(0x245)](_0x137140(0x2c0)),'role':_0x468352,'profile':_0x3311db,'customer':_0x3ac01a,'warehouse':_0x1cd5fc,'product':_0x44e64d,'invoice':_0x2d64d8,'master_shop':_0x3b37ce,'language':_0x34c671,'rooms_data':_0x43d8c7});})['catch'](_0x39e2f5=>{var _0x1f091c=_0x13d9b1;_0x401df6[_0x1f091c(0x245)]('errors',_0x1f091c(0x1d3)),_0x3ff821[_0x1f091c(0x2ac)](_0x1f091c(0x1d2));});}catch(_0x15a2c3){console[_0x13d9b1(0x288)](_0x15a2c3);}}),router[a0_0x1a2bca(0x229)](a0_0x1a2bca(0x26b),auth,async(_0x1f3510,_0x2dd932)=>{var _0x28fe2e=a0_0x1a2bca;try{const _0x5ebbc3=_0x1f3510[_0x28fe2e(0x279)]['id'];console[_0x28fe2e(0x288)](_0x5ebbc3);const _0xad4b47=await product['find'](),_0x1fa327=await purchases[_0x28fe2e(0x255)]([{'$match':{'warehouse_name':_0x5ebbc3}},{'$unwind':_0x28fe2e(0x2be)},{'$group':{'_id':'$product.product_name'}}]);console[_0x28fe2e(0x288)](_0x28fe2e(0x296),_0x1fa327),_0x2dd932['status'](0xc8)['json']({'purchases_data':_0x1fa327,'product_data':_0xad4b47});}catch(_0xefe62f){console['log'](_0xefe62f);}}),router[a0_0x1a2bca(0x20a)](a0_0x1a2bca(0x285),auth,async(_0x44fc5a,_0xb314fb)=>{var _0x2faa5a=a0_0x1a2bca;try{const {warehouse_data:_0x15c121,product_data:_0x137932}=_0x44fc5a[_0x2faa5a(0x2a8)];console[_0x2faa5a(0x288)](_0x44fc5a[_0x2faa5a(0x2a8)][_0x2faa5a(0x258)]);;const _0x47cea9=await master_shop[_0x2faa5a(0x213)]();console[_0x2faa5a(0x288)](_0x2faa5a(0x2ae),_0x47cea9);const _0xcf3f43=await product[_0x2faa5a(0x22e)]({'name':_0x137932});console['log']('product',_0xcf3f43);const _0x2e3ab6=await warehouse['aggregate']([{'$match':{'name':_0x15c121}},{'$unwind':_0x2faa5a(0x292)},{'$match':{'product_details.product_name':_0x137932}},{'$group':{'_id':_0x2faa5a(0x2a2),'product_stock':{'$first':_0x2faa5a(0x250)}}}]);console[_0x2faa5a(0x288)]('stock_data',_0x2e3ab6),_0xb314fb[_0x2faa5a(0x27b)](0xc8)[_0x2faa5a(0x20f)]({'master':_0x47cea9,'new_product':_0xcf3f43,'stock_data':_0x2e3ab6});}catch(_0x456a89){console['log'](_0x456a89);}}),router[a0_0x1a2bca(0x20a)]('/view/add_sales',auth,async(_0xb964c0,_0x4d9451)=>{var _0x5533ad=a0_0x1a2bca;try{const {invoice:_0x4838e3,date:_0x22f032,warehouse_name:_0x57ea16,product_name:_0x103da0,stock:_0x57e251,quantity:_0x29f7be,note:_0x494fc1,room:_0x46c3b7,primary_code:_0x5cfbf9,secondary_code:_0x1d334e,prod_code:_0x261635,level:_0x366e29,isle:_0x1dbc0d,pallet:_0x60fe09,batch_code:_0x560de9,SCRN:_0x1f542e,expiry_date:_0x4a1c11}=_0xb964c0['body'];if(typeof _0x103da0==_0x5533ad(0x217))var _0x4633c4=[_0xb964c0[_0x5533ad(0x2a8)]['product_name']],_0x3f452b=[_0xb964c0[_0x5533ad(0x2a8)]['stock']],_0xbcb88d=[_0xb964c0['body'][_0x5533ad(0x278)]],_0xcd6130=[_0xb964c0[_0x5533ad(0x2a8)]['primary_code']],_0x1810e8=[_0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x29e)]],_0x542c32=[_0xb964c0[_0x5533ad(0x2a8)]['prod_code']],_0x17d53b=[_0xb964c0['body']['level']],_0x5eae6b=[_0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x1ec)]],_0x49f4ad=[_0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x2a6)]],_0x5b56ec=[_0xb964c0[_0x5533ad(0x2a8)]['batch_code']],_0x5d38c9=[_0xb964c0['body'][_0x5533ad(0x284)]],_0x51b8f9=[_0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x26f)]],_0x2751d1=[_0xb964c0['body'][_0x5533ad(0x1d4)]],_0x38dc23=[_0xb964c0[_0x5533ad(0x2a8)]['requested_qty']],_0x2aa21c=[_0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x286)]],_0x31fe3a=[_0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x2ce)]],_0xc7cc07=[_0xb964c0['body']['prod_cat']],_0x123f40=[_0xb964c0[_0x5533ad(0x2a8)]['quantity']],_0xe92ff5=[_0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x2cb)]],_0x13f809=[_0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x2ca)]];else var _0x4633c4=[..._0xb964c0['body'][_0x5533ad(0x246)]],_0x3f452b=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x21b)]],_0xbcb88d=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x278)]],_0xcd6130=[..._0xb964c0['body']['primary_code']],_0x1810e8=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x29e)]],_0x542c32=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x27f)]],_0x17d53b=[..._0xb964c0[_0x5533ad(0x2a8)]['level']],_0x5eae6b=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x1ec)]],_0x49f4ad=[..._0xb964c0['body']['secondary_unit']],_0x5b56ec=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x2a7)]],_0x5d38c9=[..._0xb964c0['body'][_0x5533ad(0x284)]],_0x51b8f9=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x26f)]],_0x2751d1=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x1d4)]],_0x38dc23=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x1d9)]],_0x2aa21c=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x286)]],_0x31fe3a=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x2ce)]],_0xc7cc07=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x281)]],_0x123f40=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x208)]],_0xe92ff5=[..._0xb964c0[_0x5533ad(0x2a8)][_0x5533ad(0x2cb)]],_0x13f809=[..._0xb964c0[_0x5533ad(0x2a8)]['prod_invoice']];const _0x2e2cf1=_0x4633c4[_0x5533ad(0x225)](_0x17c05e=>{return _0x17c05e={'product_name':_0x17c05e};});_0x3f452b[_0x5533ad(0x2d7)]((_0xa3f727,_0x61085e)=>{_0x2e2cf1[_0x61085e]['stock']=_0xa3f727;}),_0xbcb88d['forEach']((_0x14590a,_0xe5b097)=>{var _0x38358c=_0x5533ad;_0x2e2cf1[_0xe5b097][_0x38358c(0x208)]=_0x14590a;}),_0xcd6130['forEach']((_0x545a25,_0x123334)=>{var _0x41f6ab=_0x5533ad;_0x2e2cf1[_0x123334][_0x41f6ab(0x214)]=_0x545a25;}),_0x1810e8[_0x5533ad(0x2d7)]((_0x46e4f1,_0x5d8302)=>{var _0x16fe03=_0x5533ad;_0x2e2cf1[_0x5d8302][_0x16fe03(0x29e)]=_0x46e4f1;}),_0x542c32[_0x5533ad(0x2d7)]((_0xdba5d3,_0x3b9666)=>{var _0x1326bb=_0x5533ad;_0x2e2cf1[_0x3b9666][_0x1326bb(0x223)]=_0xdba5d3;}),_0x17d53b[_0x5533ad(0x2d7)]((_0x2d2ee7,_0x4b2b65)=>{var _0x4ca4c8=_0x5533ad;_0xe92ff5[_0x4ca4c8(0x2d7)]((_0x52ec0d,_0x2fe83e)=>{var _0x2d6855=_0x4ca4c8;if(_0x52ec0d==_0x2d6855(0x1e6)&&_0x4b2b65==_0x2fe83e){var _0x45e0cb=_0x2d2ee7[_0x2d6855(0x219)](0x3);_0x2e2cf1[_0x4b2b65]['storage']=_0x2d2ee7[0x0],_0x2e2cf1[_0x4b2b65]['rack']=_0x2d2ee7[0x1],_0x2e2cf1[_0x4b2b65][_0x2d6855(0x24a)]=0x0,_0x2e2cf1[_0x4b2b65][_0x2d6855(0x251)]=0x0,_0x2e2cf1[_0x4b2b65]['type']=_0x2d6855(0x21c),_0x2e2cf1[_0x4b2b65][_0x2d6855(0x2b3)]=_0x45e0cb;}else{if(_0x52ec0d==_0x2d6855(0x260)&&_0x4b2b65==_0x2fe83e){var _0x45e0cb=_0x2d2ee7['slice'](0x3);_0x2e2cf1[_0x4b2b65][_0x2d6855(0x239)]=_0x2d2ee7[0x0],_0x2e2cf1[_0x4b2b65]['rack']=_0x2d2ee7[0x1],_0x2e2cf1[_0x4b2b65][_0x2d6855(0x24a)]=0x0,_0x2e2cf1[_0x4b2b65][_0x2d6855(0x251)]=0x0,_0x2e2cf1[_0x4b2b65][_0x2d6855(0x266)]=_0x2d6855(0x21c),_0x2e2cf1[_0x4b2b65][_0x2d6855(0x2b3)]=_0x2d2ee7[0x5];}else{if(_0x4b2b65==_0x2fe83e){var _0xdec26d;if(_0x2d2ee7[0x4]=='L')_0xdec26d=_0x2d6855(0x2b8);else _0x2d2ee7[0x4]=='F'&&(_0xdec26d=_0x2d6855(0x21c));_0x2e2cf1[_0x4b2b65][_0x2d6855(0x239)]=_0x2d2ee7[0x0],_0x2e2cf1[_0x4b2b65]['rack']=_0x2d2ee7[0x1],_0x2e2cf1[_0x4b2b65]['bay']=_0x2d2ee7[0x2],_0x2e2cf1[_0x4b2b65][_0x2d6855(0x251)]=_0x2d2ee7[0x3],_0x2e2cf1[_0x4b2b65]['type']=_0xdec26d,_0x2e2cf1[_0x4b2b65][_0x2d6855(0x2b3)]=_0x2d2ee7[0x5];}}}});}),_0x5eae6b[_0x5533ad(0x2d7)]((_0x42124f,_0x3e9e68)=>{_0x2e2cf1[_0x3e9e68]['unit']=_0x42124f;}),_0x49f4ad[_0x5533ad(0x2d7)]((_0x2af5d2,_0x309cd5)=>{_0x2e2cf1[_0x309cd5]['secondary_unit']=_0x2af5d2;}),_0x5b56ec[_0x5533ad(0x2d7)]((_0x4b7c80,_0x5c740e)=>{_0x2e2cf1[_0x5c740e]['batch_code']=_0x4b7c80;}),_0x5d38c9['forEach']((_0x368103,_0x53491b)=>{_0x2e2cf1[_0x53491b]['expiry_date']=_0x368103;}),_0x51b8f9['forEach']((_0x20b941,_0x1d3cd7)=>{var _0x263490=_0x5533ad;_0x2e2cf1[_0x1d3cd7][_0x263490(0x29f)]=_0x20b941;}),_0x2751d1[_0x5533ad(0x2d7)]((_0x970a37,_0x1d14b8)=>{_0x2e2cf1[_0x1d14b8]['production_date']=_0x970a37;}),_0x38dc23['forEach']((_0x2323ba,_0x177216)=>{var _0x3f1b3d=_0x5533ad;_0x2e2cf1[_0x177216][_0x3f1b3d(0x1d9)]=_0x2323ba;}),_0x2aa21c[_0x5533ad(0x2d7)]((_0xf7e295,_0x13ff09)=>{var _0x1f6d53=_0x5533ad;_0x2e2cf1[_0x13ff09][_0x1f6d53(0x286)]=_0xf7e295;}),_0x31fe3a[_0x5533ad(0x2d7)]((_0x257d2d,_0x263831)=>{var _0x25d8e2=_0x5533ad;_0x2e2cf1[_0x263831][_0x25d8e2(0x2ce)]=_0x257d2d;}),_0xc7cc07[_0x5533ad(0x2d7)]((_0x35fcf9,_0xb1fd79)=>{var _0x200c46=_0x5533ad;_0x2e2cf1[_0xb1fd79][_0x200c46(0x281)]=_0x35fcf9;}),_0x123f40[_0x5533ad(0x2d7)]((_0x4612a1,_0x16b7ad)=>{var _0x44d7ca=_0x5533ad;_0x2e2cf1[_0x16b7ad][_0x44d7ca(0x1e2)]=_0x4612a1;}),_0xe92ff5[_0x5533ad(0x2d7)]((_0x46c280,_0xe1542)=>{var _0x5807e8=_0x5533ad;_0x2e2cf1[_0xe1542][_0x5807e8(0x290)]=_0x46c280;}),_0x13f809['forEach']((_0x39fa09,_0x6c81b5)=>{var _0x48f1ac=_0x5533ad;_0x2e2cf1[_0x6c81b5][_0x48f1ac(0x1f0)]=_0x39fa09;});var _0x2121fb=0x0;_0x2e2cf1['forEach'](_0x358d99=>{var _0x233055=_0x5533ad;(_0x358d99[_0x233055(0x21b)]<_0x358d99['quantity_notConverted']||_0x358d99[_0x233055(0x1e2)]==0x0)&&(console['log'](_0x233055(0x243),_0x358d99),_0x2121fb++);});const _0x3dfa08=_0x2e2cf1[_0x5533ad(0x241)](_0xa9e8f6=>_0xa9e8f6[_0x5533ad(0x208)]!=='0'&&_0xa9e8f6[_0x5533ad(0x208)]!==''),_0x3294db=new sales({'invoice':_0x4838e3,'customer':_0xb964c0['body'][_0x5533ad(0x27d)],'date':_0x22f032,'warehouse_name':_0x57ea16,'sale_product':_0x3dfa08,'note':_0x494fc1,'room':_0x46c3b7,'primary_code':_0x5cfbf9,'secondary_code':_0x1d334e,'prod_code':_0x261635,'SCRN':_0x1f542e}),_0x4af3b3=await _0x3294db[_0x5533ad(0x1da)]();_0xb964c0[_0x5533ad(0x245)](_0x5533ad(0x1f3),_0x5533ad(0x1d8)),_0x4d9451['redirect'](_0x5533ad(0x24d)+_0x4af3b3[_0x5533ad(0x269)]);}catch(_0xbfac3e){console[_0x5533ad(0x288)](_0xbfac3e);}}),router[a0_0x1a2bca(0x229)]('/preview/:id',auth,async(_0x4de058,_0x2d4a12)=>{var _0x40cae1=a0_0x1a2bca;try{const {username:_0x177299,email:_0x11eb60,role:_0x2ea85f}=_0x4de058['user'],_0x1a0ded=_0x4de058['user'],_0x134065=await profile[_0x40cae1(0x22e)]({'email':_0x1a0ded['email']}),_0xc3bc0a=await master_shop[_0x40cae1(0x213)](),_0x34686b=_0x4de058['params']['id'],_0x4fa576=await sales['findById'](_0x34686b),_0x2f27b8=await warehouse[_0x40cae1(0x255)]([{'$match':{'name':_0x4fa576[_0x40cae1(0x29a)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x40cae1(0x252),'name':{'$first':_0x40cae1(0x2a2)},'product_stock':{'$first':_0x40cae1(0x250)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x40cae1(0x25a)},'type':{'$first':_0x40cae1(0x20d)},'floorlevel':{'$first':_0x40cae1(0x230)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x40cae1(0x2d1)},'expiry_date':{'$first':_0x40cae1(0x216)},'production_date':{'$first':_0x40cae1(0x22d)}}}]),_0x35bbc8=await customer[_0x40cae1(0x213)]({});let _0x1230b5;if(_0x1a0ded[_0x40cae1(0x2c3)]==_0x40cae1(0x2b2)){const _0x40ae46=await staff[_0x40cae1(0x22e)]({'email':_0x1a0ded[_0x40cae1(0x23f)]});_0x1230b5=await warehouse[_0x40cae1(0x255)]([{'$match':{'status':_0x40cae1(0x1dc),'name':_0x40ae46[_0x40cae1(0x1de)]}},{'$group':{'_id':_0x40cae1(0x209),'name':{'$first':_0x40cae1(0x209)}}}]);}else _0x1230b5=await warehouse[_0x40cae1(0x255)]([{'$match':{'status':_0x40cae1(0x1dc)}},{'$group':{'_id':_0x40cae1(0x209),'name':{'$first':_0x40cae1(0x209)}}}]);const _0x36500e=await product['find']({}),_0x5d2dcb=await suppliers[_0x40cae1(0x213)]({});if(_0xc3bc0a[0x0][_0x40cae1(0x25c)]==_0x40cae1(0x24c)){var _0x282917=users['English'];console['log'](_0x282917);}else{if(_0xc3bc0a[0x0][_0x40cae1(0x25c)]==_0x40cae1(0x234))var _0x282917=users[_0x40cae1(0x234)];else{if(_0xc3bc0a[0x0][_0x40cae1(0x25c)]==_0x40cae1(0x2b0))var _0x282917=users[_0x40cae1(0x2b0)];else{if(_0xc3bc0a[0x0][_0x40cae1(0x25c)]==_0x40cae1(0x2c6))var _0x282917=users[_0x40cae1(0x2c6)];else{if(_0xc3bc0a[0x0]['language']==_0x40cae1(0x2db))var _0x282917=users['French'];else{if(_0xc3bc0a[0x0][_0x40cae1(0x25c)]=='Portuguese\x20(BR)')var _0x282917=users[_0x40cae1(0x248)];else{if(_0xc3bc0a[0x0][_0x40cae1(0x25c)]=='Chinese')var _0x282917=users[_0x40cae1(0x1e9)];else{if(_0xc3bc0a[0x0][_0x40cae1(0x25c)]==_0x40cae1(0x2c8))var _0x282917=users['Arabic'];}}}}}}}_0x2d4a12[_0x40cae1(0x242)]('edit_sales_view',{'success':_0x4de058[_0x40cae1(0x245)](_0x40cae1(0x1f3)),'errors':_0x4de058[_0x40cae1(0x245)](_0x40cae1(0x2c0)),'role':_0x1a0ded,'profile':_0x134065,'customer':_0x35bbc8,'warehouse':_0x1230b5,'product':_0x2f27b8,'user':_0x4fa576,'master_shop':_0xc3bc0a,'unit':_0x36500e,'language':_0x282917,'suppliers':_0x5d2dcb});}catch(_0x350ce1){console[_0x40cae1(0x288)](_0x350ce1);}}),router['post'](a0_0x1a2bca(0x2d9),auth,async(_0x39c28a,_0x571e2a)=>{var _0x9bdad4=a0_0x1a2bca;try{const _0x329d76=_0x39c28a[_0x9bdad4(0x279)]['id'],{invoice:_0x4bd1ab,warehouse_name:_0x42a308,room:_0x41d5e4}=_0x39c28a[_0x9bdad4(0x2a8)],_0x51f781=await sales[_0x9bdad4(0x22e)]({'invoice':_0x4bd1ab}),_0xf43b7e=_0x51f781[_0x9bdad4(0x256)][_0x9bdad4(0x225)](async _0x45cb93=>{var _0x81ee89=_0x9bdad4,_0x281bb8=await warehouse[_0x81ee89(0x22e)]({'name':_0x42a308,'room':_0x45cb93[_0x81ee89(0x290)],'warehouse_category':'Raw\x20Materials'});const _0x4b6425=_0x281bb8[_0x81ee89(0x206)][_0x81ee89(0x225)](_0x5a2ec0=>{var _0x264e6b=_0x81ee89;_0x5a2ec0[_0x264e6b(0x246)]==_0x45cb93[_0x264e6b(0x246)]&&_0x5a2ec0['floorlevel']==_0x45cb93[_0x264e6b(0x2b3)]&&_0x5a2ec0[_0x264e6b(0x266)]==_0x45cb93['type']&&_0x5a2ec0[_0x264e6b(0x251)]==_0x45cb93[_0x264e6b(0x251)]&&_0x5a2ec0['bay']==_0x45cb93[_0x264e6b(0x24a)]&&_0x5a2ec0[_0x264e6b(0x2af)]==_0x45cb93[_0x264e6b(0x2af)]&&_0x5a2ec0[_0x264e6b(0x239)]==_0x45cb93['storage']&&_0x5a2ec0[_0x264e6b(0x284)]==_0x45cb93['expiry_date']&&_0x5a2ec0[_0x264e6b(0x2a7)]==_0x45cb93['batch_code']&&_0x5a2ec0[_0x264e6b(0x1f0)]==_0x45cb93[_0x264e6b(0x1f0)]&&(_0x5a2ec0[_0x264e6b(0x2c1)]=_0x5a2ec0['product_stock']-_0x45cb93['quantity']);});return _0x281bb8;});Promise[_0x9bdad4(0x21e)](_0xf43b7e)['then'](async _0x89acf9=>{var _0x4b2345=_0x9bdad4;try{for(const _0x48f1df of _0x89acf9){await _0x48f1df[_0x4b2345(0x1da)]();}_0x51f781[_0x4b2345(0x275)]=_0x4b2345(0x200);const _0x19901a=await _0x51f781[_0x4b2345(0x1da)](),_0x2113ce=await master_shop[_0x4b2345(0x213)](),_0x1aadf3=await email_settings['findOne'](),_0x58c89f=await supervisor_settings[_0x4b2345(0x213)]();var _0x433914=_0x51f781[_0x4b2345(0x256)],_0x41cbb9='',_0x68d6b5;for(_0x68d6b5 in _0x433914){_0x41cbb9+=_0x4b2345(0x21d)+_0x4b2345(0x228)+_0x433914[_0x68d6b5]['product_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x433914[_0x68d6b5][_0x4b2345(0x223)]+_0x4b2345(0x2d8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x433914[_0x68d6b5][_0x4b2345(0x208)]+_0x4b2345(0x2d8)+_0x4b2345(0x228)+_0x433914[_0x68d6b5][_0x4b2345(0x1fe)]+'</td>'+_0x4b2345(0x228)+_0x433914[_0x68d6b5][_0x4b2345(0x2a6)]+'</td>'+_0x4b2345(0x228)+_0x51f781[_0x4b2345(0x29a)]+_0x4b2345(0x2d8)+_0x4b2345(0x228)+_0x433914[_0x68d6b5][_0x4b2345(0x290)]+_0x4b2345(0x2d8)+_0x4b2345(0x228)+_0x433914[_0x68d6b5][_0x4b2345(0x239)]+_0x433914[_0x68d6b5][_0x4b2345(0x2af)]+_0x433914[_0x68d6b5]['bay']+_0x433914[_0x68d6b5]['bin']+_0x433914[_0x68d6b5][_0x4b2345(0x266)][0x0]+_0x433914[_0x68d6b5][_0x4b2345(0x2b3)]+_0x4b2345(0x2d8),_0x4b2345(0x201);}let _0x390ba2=nodemailer[_0x4b2345(0x26d)]({'host':_0x1aadf3['host'],'port':Number(_0x1aadf3[_0x4b2345(0x28d)]),'secure':![],'auth':{'user':_0x1aadf3[_0x4b2345(0x23f)],'pass':_0x1aadf3[_0x4b2345(0x1db)]}}),_0x556d99={'from':_0x1aadf3[_0x4b2345(0x23f)],'to':_0x58c89f[0x0][_0x4b2345(0x2b5)],'subject':_0x4b2345(0x2a5),'attachments':[{'filename':_0x4b2345(0x2c5),'path':__dirname+_0x4b2345(0x227)+_0x4b2345(0x2bb)+_0x2113ce[0x0][_0x4b2345(0x247)],'cid':_0x4b2345(0x205)}],'html':_0x4b2345(0x2dd)+_0x4b2345(0x274)+'</head><body>'+_0x4b2345(0x1e5)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4b2345(0x1e5)+_0x4b2345(0x211)+_0x4b2345(0x1ee)+'<div>'+_0x4b2345(0x25e)+_0x2113ce[0x0][_0x4b2345(0x2aa)]+_0x4b2345(0x2e3)+_0x4b2345(0x1ee)+_0x4b2345(0x1ee)+_0x4b2345(0x2d2)+_0x4b2345(0x1e5)+_0x4b2345(0x259)+_0x4b2345(0x249)+_0x51f781[_0x4b2345(0x1f0)]+'\x20'+_0x4b2345(0x272)+_0x4b2345(0x24b)+_0x51f781[_0x4b2345(0x28e)]+'\x20'+_0x4b2345(0x27e)+_0x4b2345(0x22b)+_0x4b2345(0x1ee)+_0x4b2345(0x221)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4b2345(0x21d)+_0x4b2345(0x2df)+_0x4b2345(0x257)+_0x4b2345(0x28c)+_0x4b2345(0x24f)+_0x4b2345(0x2e4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x4b2345(0x1f5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x4b2345(0x201)+_0x4b2345(0x25f)+_0x4b2345(0x253)+'\x20'+_0x41cbb9+'\x20'+_0x4b2345(0x268)+_0x4b2345(0x2c2)+'<div>'+_0x4b2345(0x26a)+_0x4b2345(0x276)+_0x2113ce[0x0][_0x4b2345(0x2aa)]+_0x4b2345(0x22b)+_0x4b2345(0x1ee)+_0x4b2345(0x1ee)+_0x4b2345(0x1f8)};_0x390ba2[_0x4b2345(0x236)](_0x556d99,function(_0x16e432,_0x33162d){var _0x432c21=_0x4b2345;_0x16e432?(console['log'](_0x16e432),console[_0x432c21(0x288)](_0x432c21(0x2e0))):console['log']('Email\x20sent\x20successfully');}),_0x39c28a[_0x4b2345(0x245)](_0x4b2345(0x1f3),_0x4b2345(0x2d6)),_0x571e2a[_0x4b2345(0x2ac)](_0x4b2345(0x24d)+_0x329d76);}catch(_0x552424){console[_0x4b2345(0x1e3)](_0x552424),_0x571e2a[_0x4b2345(0x27b)](0x1f4)[_0x4b2345(0x20f)]({'error':_0x4b2345(0x2c4)});}})[_0x9bdad4(0x1d6)](_0x51b800=>{var _0x294b2b=_0x9bdad4;console['error'](_0x51b800),_0x571e2a[_0x294b2b(0x27b)](0x1f4)[_0x294b2b(0x20f)]({'error':_0x294b2b(0x262)});});}catch(_0x13d43f){console['log'](_0x13d43f);}}),router['get']('/view/:id',auth,async(_0xe9aa1e,_0x44364f)=>{var _0x37c1ee=a0_0x1a2bca;try{const {username:_0x1eea91,email:_0x4b4b48,role:_0xf0226d}=_0xe9aa1e['user'],_0x585c1e=_0xe9aa1e[_0x37c1ee(0x26e)],_0x3a6e49=await profile[_0x37c1ee(0x22e)]({'email':_0x585c1e[_0x37c1ee(0x23f)]}),_0x439e8a=await master_shop[_0x37c1ee(0x213)](),_0x567952=_0xe9aa1e[_0x37c1ee(0x279)]['id'],_0x350f37=await sales['findById'](_0x567952);var _0x3e1d66=[_0x37c1ee(0x24e),_0x37c1ee(0x2ba)];const _0x4c8807=await warehouse[_0x37c1ee(0x255)]([{'$match':{'name':_0x350f37[_0x37c1ee(0x29a)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x37c1ee(0x292)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x37c1ee(0x250)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x37c1ee(0x25a)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x37c1ee(0x230)},'primary_code':{'$first':_0x37c1ee(0x207)},'secondary_code':{'$first':_0x37c1ee(0x22f)},'product_code':{'$first':_0x37c1ee(0x2c7)},'storage':{'$first':_0x37c1ee(0x1e8)},'rack':{'$first':'$product_details.rack'}}}]),_0x5410b6=await customer[_0x37c1ee(0x213)]({});let _0x3ad1f2;if(_0x585c1e['role']==_0x37c1ee(0x2b2)){const _0x2a5466=await staff[_0x37c1ee(0x22e)]({'email':_0x585c1e[_0x37c1ee(0x23f)]});_0x3ad1f2=await warehouse[_0x37c1ee(0x255)]([{'$match':{'status':_0x37c1ee(0x1dc),'name':_0x2a5466[_0x37c1ee(0x1de)],'warehouse_category':_0x37c1ee(0x2bf)}},{'$group':{'_id':_0x37c1ee(0x209),'name':{'$first':_0x37c1ee(0x209)}}}]);}else _0x3ad1f2=await warehouse[_0x37c1ee(0x255)]([{'$match':{'status':_0x37c1ee(0x1dc),'warehouse_category':_0x37c1ee(0x2bf)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x3f9c5a=await product[_0x37c1ee(0x213)]({});if(_0x439e8a[0x0]['language']==_0x37c1ee(0x24c)){var _0x4cc039=users['English'];console['log'](_0x4cc039);}else{if(_0x439e8a[0x0][_0x37c1ee(0x25c)]==_0x37c1ee(0x234))var _0x4cc039=users[_0x37c1ee(0x234)];else{if(_0x439e8a[0x0][_0x37c1ee(0x25c)]==_0x37c1ee(0x2b0))var _0x4cc039=users[_0x37c1ee(0x2b0)];else{if(_0x439e8a[0x0][_0x37c1ee(0x25c)]==_0x37c1ee(0x2c6))var _0x4cc039=users[_0x37c1ee(0x2c6)];else{if(_0x439e8a[0x0][_0x37c1ee(0x25c)]==_0x37c1ee(0x2db))var _0x4cc039=users['French'];else{if(_0x439e8a[0x0]['language']=='Portuguese\x20(BR)')var _0x4cc039=users[_0x37c1ee(0x248)];else{if(_0x439e8a[0x0][_0x37c1ee(0x25c)]==_0x37c1ee(0x1e9))var _0x4cc039=users[_0x37c1ee(0x1e9)];else{if(_0x439e8a[0x0][_0x37c1ee(0x25c)]==_0x37c1ee(0x2c8))var _0x4cc039=users[_0x37c1ee(0x1f4)];}}}}}}}_0x44364f[_0x37c1ee(0x242)](_0x37c1ee(0x261),{'success':_0xe9aa1e[_0x37c1ee(0x245)](_0x37c1ee(0x1f3)),'errors':_0xe9aa1e[_0x37c1ee(0x245)](_0x37c1ee(0x2c0)),'role':_0x585c1e,'profile':_0x3a6e49,'customer':_0x5410b6,'warehouse':_0x3ad1f2,'product':_0x4c8807,'user':_0x350f37,'master_shop':_0x439e8a,'unit':_0x3f9c5a,'language':_0x4cc039});}catch(_0x47e526){console[_0x37c1ee(0x288)](_0x47e526);}}),router[a0_0x1a2bca(0x20a)](a0_0x1a2bca(0x297),auth,async(_0x13c88b,_0x2829fe)=>{var _0x10dfe5=a0_0x1a2bca;try{const _0x527a15=_0x13c88b[_0x10dfe5(0x279)]['id'],_0x440d0b=await sales[_0x10dfe5(0x22e)]({'_id':_0x13c88b['params']['id']}),_0xab7bd7=await warehouse[_0x10dfe5(0x22e)]({'name':_0x440d0b[_0x10dfe5(0x29a)],'room':_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x21a)]}),{invoice:_0x92d1a7,date:_0x1ca695,warehouse_name:_0x4a3787,product_name:_0x5bb807,stock:_0x34b686,quantity:_0x10572a,note:_0x2d78f4,room:_0x4075ae,customer:_0x24929f,SCRN:_0x2942c7}=_0x13c88b[_0x10dfe5(0x2a8)];if(typeof _0x5bb807==_0x10dfe5(0x217))var _0xc619e0=[_0x13c88b[_0x10dfe5(0x2a8)]['product_name']],_0x5af89f=[_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x21b)]],_0x1612f4=[_0x13c88b[_0x10dfe5(0x2a8)]['carton']],_0x3cbadc=[_0x13c88b['body'][_0x10dfe5(0x214)]],_0x20c590=[_0x13c88b[_0x10dfe5(0x2a8)]['secondary_code']],_0xe04718=[_0x13c88b['body'][_0x10dfe5(0x27f)]],_0x10f2a7=[_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x23a)]],_0x51d812=[_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x1ec)]],_0x597ec8=[_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x2a6)]],_0x60450c=[_0x13c88b[_0x10dfe5(0x2a8)]['batch_code']],_0x3cd299=[_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x284)]],_0x15cdcc=[_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x26f)]],_0x4b5d1b=[_0x13c88b[_0x10dfe5(0x2a8)]['production_date']],_0x42b84a=[_0x13c88b[_0x10dfe5(0x2a8)]['requested_qty']],_0x2d444c=[_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x286)]],_0x50c7d4=[_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x2ce)]],_0x35da0a=[_0x13c88b[_0x10dfe5(0x2a8)]['prod_cat']],_0x46db8d=[_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x208)]],_0x2f7894=[_0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x2cb)]];else var _0xc619e0=[..._0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x246)]],_0x5af89f=[..._0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x21b)]],_0x1612f4=[..._0x13c88b[_0x10dfe5(0x2a8)]['carton']],_0x3cbadc=[..._0x13c88b['body'][_0x10dfe5(0x214)]],_0x20c590=[..._0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x29e)]],_0xe04718=[..._0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x27f)]],_0x10f2a7=[..._0x13c88b[_0x10dfe5(0x2a8)]['level']],_0x51d812=[..._0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x1ec)]],_0x597ec8=[..._0x13c88b['body']['secondary_unit']],_0x60450c=[..._0x13c88b[_0x10dfe5(0x2a8)]['batch_code']],_0x3cd299=[..._0x13c88b['body']['expiry_date']],_0x15cdcc=[..._0x13c88b[_0x10dfe5(0x2a8)]['max_per_unit']],_0x4b5d1b=[..._0x13c88b['body'][_0x10dfe5(0x1d4)]],_0x42b84a=[..._0x13c88b['body'][_0x10dfe5(0x1d9)]],_0x2d444c=[..._0x13c88b['body']['delivery_date']],_0x50c7d4=[..._0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x2ce)]],_0x35da0a=[..._0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x281)]],_0x46db8d=[..._0x13c88b[_0x10dfe5(0x2a8)][_0x10dfe5(0x208)]],_0x2f7894=[..._0x13c88b['body'][_0x10dfe5(0x2cb)]];const _0x9a00ab=_0xc619e0[_0x10dfe5(0x225)](_0x313834=>{return _0x313834={'product_name':_0x313834};});_0x5af89f[_0x10dfe5(0x2d7)]((_0x472b37,_0x164554)=>{var _0x443252=_0x10dfe5;_0x9a00ab[_0x164554][_0x443252(0x21b)]=_0x472b37;}),_0x1612f4[_0x10dfe5(0x2d7)]((_0x53b28f,_0x2a7e11)=>{var _0x362ab2=_0x10dfe5;_0x9a00ab[_0x2a7e11][_0x362ab2(0x208)]=_0x53b28f;}),_0x3cbadc['forEach']((_0x5cebff,_0x564ee2)=>{var _0x325633=_0x10dfe5;_0x9a00ab[_0x564ee2][_0x325633(0x214)]=_0x5cebff;}),_0x20c590[_0x10dfe5(0x2d7)]((_0x7086aa,_0x48a10e)=>{var _0x520dc2=_0x10dfe5;_0x9a00ab[_0x48a10e][_0x520dc2(0x29e)]=_0x7086aa;}),_0xe04718[_0x10dfe5(0x2d7)]((_0x3675ec,_0xcef473)=>{var _0x5f0d85=_0x10dfe5;_0x9a00ab[_0xcef473][_0x5f0d85(0x223)]=_0x3675ec;}),_0x10f2a7[_0x10dfe5(0x2d7)]((_0x82ca2f,_0x57b758)=>{var _0x55ee51=_0x10dfe5;_0x2f7894[_0x55ee51(0x2d7)]((_0x4db3ad,_0x41255b)=>{var _0x34df6b=_0x55ee51;if(_0x4db3ad==_0x34df6b(0x1e6)&&_0x57b758==_0x41255b){var _0x5bc343=_0x82ca2f[_0x34df6b(0x219)](0x3);_0x9a00ab[_0x57b758][_0x34df6b(0x239)]=_0x82ca2f[0x0],_0x9a00ab[_0x57b758]['rack']=_0x82ca2f[0x1],_0x9a00ab[_0x57b758][_0x34df6b(0x24a)]=0x0,_0x9a00ab[_0x57b758][_0x34df6b(0x251)]=0x0,_0x9a00ab[_0x57b758]['type']=_0x34df6b(0x21c),_0x9a00ab[_0x57b758][_0x34df6b(0x2b3)]=_0x5bc343;}else{if(_0x4db3ad==_0x34df6b(0x260)&&_0x57b758==_0x41255b){var _0x5bc343=_0x82ca2f[_0x34df6b(0x219)](0x3);_0x9a00ab[_0x57b758][_0x34df6b(0x239)]=_0x82ca2f[0x0],_0x9a00ab[_0x57b758][_0x34df6b(0x2af)]=_0x82ca2f[0x1],_0x9a00ab[_0x57b758]['bay']=0x0,_0x9a00ab[_0x57b758][_0x34df6b(0x251)]=0x0,_0x9a00ab[_0x57b758]['type']=_0x34df6b(0x21c),_0x9a00ab[_0x57b758][_0x34df6b(0x2b3)]=_0x82ca2f[0x5];}else{if(_0x57b758==_0x41255b){var _0x1827f0;if(_0x82ca2f[0x4]=='L')_0x1827f0=_0x34df6b(0x2b8);else _0x82ca2f[0x4]=='F'&&(_0x1827f0=_0x34df6b(0x21c));_0x9a00ab[_0x57b758][_0x34df6b(0x239)]=_0x82ca2f[0x0],_0x9a00ab[_0x57b758][_0x34df6b(0x2af)]=_0x82ca2f[0x1],_0x9a00ab[_0x57b758][_0x34df6b(0x24a)]=_0x82ca2f[0x2],_0x9a00ab[_0x57b758][_0x34df6b(0x251)]=_0x82ca2f[0x3],_0x9a00ab[_0x57b758]['type']=_0x1827f0,_0x9a00ab[_0x57b758][_0x34df6b(0x2b3)]=_0x82ca2f[0x5];}}}});}),_0x51d812[_0x10dfe5(0x2d7)]((_0x597cf0,_0x17f150)=>{var _0x474375=_0x10dfe5;_0x9a00ab[_0x17f150][_0x474375(0x1fe)]=_0x597cf0;}),_0x597ec8[_0x10dfe5(0x2d7)]((_0x29c6e7,_0x45abd0)=>{var _0x181d2b=_0x10dfe5;_0x9a00ab[_0x45abd0][_0x181d2b(0x2a6)]=_0x29c6e7;}),_0x60450c[_0x10dfe5(0x2d7)]((_0x122766,_0x3fa50d)=>{var _0x156a7c=_0x10dfe5;_0x9a00ab[_0x3fa50d][_0x156a7c(0x2a7)]=_0x122766;}),_0x3cd299['forEach']((_0x41673f,_0x5e0f48)=>{var _0x157569=_0x10dfe5;_0x9a00ab[_0x5e0f48][_0x157569(0x284)]=_0x41673f;}),_0x15cdcc[_0x10dfe5(0x2d7)]((_0x587a86,_0x341960)=>{_0x9a00ab[_0x341960]['maxperunit']=_0x587a86;}),_0x4b5d1b[_0x10dfe5(0x2d7)]((_0x21845f,_0x5509f7)=>{var _0x432d03=_0x10dfe5;_0x9a00ab[_0x5509f7][_0x432d03(0x1d4)]=_0x21845f;}),_0x42b84a[_0x10dfe5(0x2d7)]((_0xbcd0ba,_0x15e3a7)=>{_0x9a00ab[_0x15e3a7]['requested_qty']=_0xbcd0ba;}),_0x2d444c['forEach']((_0x2b890b,_0xabe74e)=>{var _0xe985e3=_0x10dfe5;_0x9a00ab[_0xabe74e][_0xe985e3(0x286)]=_0x2b890b;}),_0x50c7d4[_0x10dfe5(0x2d7)]((_0x3151a3,_0x4a8485)=>{var _0x58af4d=_0x10dfe5;_0x9a00ab[_0x4a8485][_0x58af4d(0x2ce)]=_0x3151a3;}),_0x35da0a[_0x10dfe5(0x2d7)]((_0x52dc81,_0x11fffa)=>{var _0x3514a8=_0x10dfe5;_0x9a00ab[_0x11fffa][_0x3514a8(0x281)]=_0x52dc81;}),_0x46db8d['forEach']((_0x1fc1a4,_0x110fef)=>{var _0x47c796=_0x10dfe5;_0x9a00ab[_0x110fef][_0x47c796(0x1e2)]=_0x1fc1a4;}),_0x2f7894['forEach']((_0x59fab9,_0x31394e)=>{var _0x2f3584=_0x10dfe5;_0x9a00ab[_0x31394e][_0x2f3584(0x290)]=_0x59fab9;});var _0x132cbc=0x0;_0x9a00ab['forEach'](_0x327acb=>{var _0x5313f0=_0x10dfe5;console[_0x5313f0(0x288)]('foreach\x20newproduct',_0x327acb),(parseInt(_0x327acb[_0x5313f0(0x21b)])<parseInt(_0x327acb[_0x5313f0(0x208)])||parseInt(_0x327acb[_0x5313f0(0x208)])==0x0)&&_0x132cbc++;});if(_0x132cbc!=0x0)return _0x13c88b[_0x10dfe5(0x245)](_0x10dfe5(0x2c0),_0x10dfe5(0x1f2)),_0x2829fe[_0x10dfe5(0x2ac)](_0x10dfe5(0x233));const _0x1f43b3=_0x9a00ab[_0x10dfe5(0x241)](_0x323a12=>_0x323a12['quantity']!=='0'&&_0x323a12['quantity']!=='');_0x440d0b['invoice']=_0x92d1a7,_0x440d0b[_0x10dfe5(0x27d)]=_0x24929f,_0x440d0b[_0x10dfe5(0x28e)]=_0x1ca695,_0x440d0b['warehouse_name']=_0x4a3787,_0x440d0b[_0x10dfe5(0x256)]=_0x1f43b3,_0x440d0b['note']=_0x2d78f4,_0x440d0b['SCRN']=_0x2942c7,_0x440d0b[_0x10dfe5(0x275)]='False',_0x440d0b[_0x10dfe5(0x215)]=_0x10dfe5(0x298);const _0x10b72a=await _0x440d0b[_0x10dfe5(0x1da)]();_0x13c88b['flash'](_0x10dfe5(0x1f3),_0x10dfe5(0x2d6)),_0x2829fe['redirect'](_0x10dfe5(0x1d2));}catch(_0x567ab7){console['log'](_0x567ab7);}}),router['post'](a0_0x1a2bca(0x232),auth,async(_0x522939,_0x3bb4bf)=>{var _0x53602f=a0_0x1a2bca;try{const _0x827a0b=_0x522939[_0x53602f(0x279)]['id'],{invoice:_0x44e33e,customer:_0x70663c,receivable_amount:_0xad4d28,received_amount:_0x53ef42}=_0x522939[_0x53602f(0x2a8)],_0x36654d=await sales[_0x53602f(0x1f1)](_0x827a0b);console[_0x53602f(0x288)](_0x36654d);var _0x3d3c68=_0xad4d28-_0x53ef42;console[_0x53602f(0x288)](_0x53ef42),_0x36654d[_0x53602f(0x1d5)]=parseFloat(_0x53ef42)+parseFloat(_0x36654d[_0x53602f(0x1d5)]),_0x36654d[_0x53602f(0x23d)]=_0x3d3c68,console['log'](_0x36654d);const _0x268dfa=await _0x36654d[_0x53602f(0x1da)](),_0x33ef63=await c_payment_data[_0x53602f(0x22e)]({'invoice':_0x44e33e});_0x33ef63[_0x53602f(0x2e1)]=_0x3d3c68,await _0x33ef63[_0x53602f(0x1da)]();let _0x15491a=new Date(),_0x26f0cf=('0'+_0x15491a[_0x53602f(0x1d1)]())[_0x53602f(0x219)](-0x2),_0x400569=('0'+(_0x15491a[_0x53602f(0x204)]()+0x1))[_0x53602f(0x219)](-0x2),_0x1c9d06=_0x15491a[_0x53602f(0x2a1)](),_0x586948=_0x1c9d06+'-'+_0x400569+'-'+_0x26f0cf;const _0x4621aa=new customer_payment({'invoice':_0x44e33e,'date':_0x1c9d06+'-'+_0x400569+'-'+_0x26f0cf,'customer':_0x70663c,'reason':_0x53602f(0x25b),'amount':_0x53ef42}),_0x33a8c7=await _0x4621aa[_0x53602f(0x1da)]();_0x522939[_0x53602f(0x245)]('success',_0x53602f(0x264)),_0x3bb4bf['redirect']('/all_sales/view');}catch(_0x259dec){console['log'](_0x259dec);}}),router['get'](a0_0x1a2bca(0x1fc),auth,async(_0x358ae2,_0x5bee15)=>{var _0x26d6c0=a0_0x1a2bca;try{const {username:_0x28ff70,email:_0x5b192f,role:_0x17b4de}=_0x358ae2[_0x26d6c0(0x26e)],_0x1a4e36=_0x358ae2[_0x26d6c0(0x26e)],_0x76c9a8=await profile[_0x26d6c0(0x22e)]({'email':_0x1a4e36[_0x26d6c0(0x23f)]}),_0x508b79=await master_shop[_0x26d6c0(0x213)]();console[_0x26d6c0(0x288)]('master',_0x508b79);const _0x4dfd37=_0x358ae2[_0x26d6c0(0x279)]['id'],_0x164840=await sales['findById'](_0x4dfd37);console[_0x26d6c0(0x288)](_0x164840);const _0x5857ae=await customer[_0x26d6c0(0x22e)]({'name':_0x164840[_0x26d6c0(0x27d)]});console['log'](_0x5857ae);if(_0x508b79[0x0]['language']==_0x26d6c0(0x24c)){var _0x13dda5=users['English'];console[_0x26d6c0(0x288)](_0x13dda5);}else{if(_0x508b79[0x0][_0x26d6c0(0x25c)]=='Hindi')var _0x13dda5=users[_0x26d6c0(0x234)];else{if(_0x508b79[0x0][_0x26d6c0(0x25c)]==_0x26d6c0(0x2b0))var _0x13dda5=users[_0x26d6c0(0x2b0)];else{if(_0x508b79[0x0]['language']==_0x26d6c0(0x2c6))var _0x13dda5=users[_0x26d6c0(0x2c6)];else{if(_0x508b79[0x0][_0x26d6c0(0x25c)]==_0x26d6c0(0x2db))var _0x13dda5=users['French'];else{if(_0x508b79[0x0][_0x26d6c0(0x25c)]==_0x26d6c0(0x220))var _0x13dda5=users[_0x26d6c0(0x248)];else{if(_0x508b79[0x0][_0x26d6c0(0x25c)]=='Chinese')var _0x13dda5=users[_0x26d6c0(0x1e9)];else{if(_0x508b79[0x0][_0x26d6c0(0x25c)]=='Arabic\x20(ae)')var _0x13dda5=users['Arabic'];}}}}}}}_0x5bee15[_0x26d6c0(0x242)](_0x26d6c0(0x1eb),{'success':_0x358ae2[_0x26d6c0(0x245)]('success'),'errors':_0x358ae2[_0x26d6c0(0x245)]('errors'),'role':_0x1a4e36,'profile':_0x76c9a8,'master_shop':_0x508b79,'customers':_0x5857ae,'sales':_0x164840,'language':_0x13dda5});}catch(_0x472931){console[_0x26d6c0(0x288)](_0x472931);}}),router[a0_0x1a2bca(0x229)]('/view/return_sales/:id',auth,async(_0x5a20ae,_0x463671)=>{var _0x1ef774=a0_0x1a2bca;try{const {username:_0x12e2ff,email:_0x4ce593,role:_0x4dbd46}=_0x5a20ae['user'],_0x44a6e0=_0x5a20ae[_0x1ef774(0x26e)],_0x1fb014=await profile[_0x1ef774(0x22e)]({'email':_0x44a6e0['email']}),_0x568a3f=await master_shop[_0x1ef774(0x213)]();console[_0x1ef774(0x288)]('master',_0x568a3f);const _0x1c3b99=_0x5a20ae[_0x1ef774(0x279)]['id'];console['log'](_0x1c3b99);const _0x4df29c=await sales[_0x1ef774(0x1f1)](_0x1c3b99);console[_0x1ef774(0x288)](_0x1ef774(0x2a3),_0x4df29c);const _0x3847e8=await warehouse[_0x1ef774(0x255)]([{'$match':{'name':_0x1ef774(0x29b),'room':'Return\x20Rooms'}},{'$unwind':_0x1ef774(0x292)},{'$group':{'_id':_0x1ef774(0x252),'name':{'$first':_0x1ef774(0x2a2)},'product_stock':{'$first':_0x1ef774(0x250)},'level':{'$first':_0x1ef774(0x283)},'isle':{'$first':_0x1ef774(0x210)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1ef774(0x22f)},'product_code':{'$first':_0x1ef774(0x2c7)}}}]);console[_0x1ef774(0x288)](_0x1ef774(0x22c),_0x3847e8);const _0x10cd12=await product[_0x1ef774(0x213)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x1ef774(0x1dc),'name':'Return\x20Goods','warehouse_category':_0x1ef774(0x2bf)}},{'$group':{'_id':_0x1ef774(0x209),'name':{'$first':_0x1ef774(0x209)}}},{'$sort':{'name':0x1}}]);var _0x3dc989=[_0x1ef774(0x28f)];if(_0x568a3f[0x0][_0x1ef774(0x25c)]==_0x1ef774(0x24c)){var _0x5253bd=users[_0x1ef774(0x20c)];console['log'](_0x5253bd);}else{if(_0x568a3f[0x0][_0x1ef774(0x25c)]==_0x1ef774(0x234))var _0x5253bd=users[_0x1ef774(0x234)];else{if(_0x568a3f[0x0][_0x1ef774(0x25c)]==_0x1ef774(0x2b0))var _0x5253bd=users[_0x1ef774(0x2b0)];else{if(_0x568a3f[0x0][_0x1ef774(0x25c)]==_0x1ef774(0x2c6))var _0x5253bd=users['Spanish'];else{if(_0x568a3f[0x0]['language']==_0x1ef774(0x2db))var _0x5253bd=users[_0x1ef774(0x2db)];else{if(_0x568a3f[0x0][_0x1ef774(0x25c)]==_0x1ef774(0x220))var _0x5253bd=users[_0x1ef774(0x248)];else{if(_0x568a3f[0x0][_0x1ef774(0x25c)]==_0x1ef774(0x1e9))var _0x5253bd=users[_0x1ef774(0x1e9)];else{if(_0x568a3f[0x0][_0x1ef774(0x25c)]==_0x1ef774(0x2c8))var _0x5253bd=users['Arabic'];}}}}}}}_0x463671[_0x1ef774(0x242)](_0x1ef774(0x1e0),{'success':_0x5a20ae[_0x1ef774(0x245)](_0x1ef774(0x1f3)),'errors':_0x5a20ae[_0x1ef774(0x245)](_0x1ef774(0x2c0)),'role':_0x44a6e0,'profile':_0x1fb014,'user':_0x4df29c,'stock':_0x3847e8,'master_shop':_0x568a3f,'unit':_0x10cd12,'language':_0x5253bd,'warehouses':warehouse_data,'rooms':_0x3dc989});}catch(_0x4a0500){console[_0x1ef774(0x288)](_0x4a0500),_0x463671[_0x1ef774(0x27b)](0xc8)['json']({'message':_0x4a0500[_0x1ef774(0x28a)]});}}),router[a0_0x1a2bca(0x20a)](a0_0x1a2bca(0x2bd),auth,async(_0x2c7a7e,_0x1e6d49)=>{var _0x29f6ec=a0_0x1a2bca;try{const {invoice:_0x52cda3,date:_0x5a5937,warehouse_name:_0x7f81f4,product_name:_0x3a28d8,primary_code:_0x390329,secondary_code:_0xe99f99,product_code:_0x32e8c1,sales_quantity:_0xd65c0c,stocks:_0x3c98a7,return_qty:_0x2de0a4,Room_name:_0x6078c,to_warehouse_name:_0x484097,to_Roomname:_0x34278c,to_Room_name:_0x7cb4fe,note:_0x431241,level:_0x3778f4,isle:_0x21282d,pallet:_0x4d0336}=_0x2c7a7e[_0x29f6ec(0x2a8)];if(typeof _0x3a28d8=='string')var _0x5db6c1=[_0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x246)]],_0x3af067=[_0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x214)]],_0x20607e=[_0x2c7a7e['body'][_0x29f6ec(0x29e)]],_0xdb48be=[_0x2c7a7e['body'][_0x29f6ec(0x223)]],_0x2554c2=[_0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x23e)]],_0xd679b4=[_0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x2b9)]],_0x315203=[_0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x21f)]],_0x53672c=[_0x2c7a7e[_0x29f6ec(0x2a8)]['bay']],_0x4a2833=[_0x2c7a7e['body'][_0x29f6ec(0x251)]],_0x3922c9=[_0x2c7a7e[_0x29f6ec(0x2a8)]['types']],_0x12cf18=[_0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x2b3)]];else var _0x5db6c1=[..._0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x246)]],_0x3af067=[..._0x2c7a7e[_0x29f6ec(0x2a8)]['primary_code']],_0x20607e=[..._0x2c7a7e[_0x29f6ec(0x2a8)]['secondary_code']],_0xdb48be=[..._0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x223)]],_0x2554c2=[..._0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x23e)]],_0xd679b4=[..._0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x2b9)]],_0x315203=[..._0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x21f)]],_0x53672c=[..._0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x24a)]],_0x4a2833=[..._0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x251)]],_0x3922c9=[..._0x2c7a7e['body'][_0x29f6ec(0x1df)]],_0x12cf18=[..._0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x2b3)]];const _0x691686=_0x5db6c1[_0x29f6ec(0x225)](_0x22bbfe=>{return _0x22bbfe={'product_name':_0x22bbfe};});_0x3af067[_0x29f6ec(0x2d7)]((_0x2b93de,_0x312f0b)=>{_0x691686[_0x312f0b]['primary_code']=_0x2b93de;}),_0x20607e[_0x29f6ec(0x2d7)]((_0x3de905,_0xcf94fb)=>{var _0x2c73fe=_0x29f6ec;_0x691686[_0xcf94fb][_0x2c73fe(0x29e)]=_0x3de905;}),_0xdb48be[_0x29f6ec(0x2d7)]((_0x53a8ab,_0x56264b)=>{var _0x5e2edf=_0x29f6ec;_0x691686[_0x56264b][_0x5e2edf(0x223)]=_0x53a8ab;}),_0x2554c2[_0x29f6ec(0x2d7)]((_0x5a7675,_0x50bdd7)=>{_0x691686[_0x50bdd7]['sale_qty']=_0x5a7675;}),_0xd679b4[_0x29f6ec(0x2d7)]((_0x5a2775,_0x370685)=>{var _0x1092fe=_0x29f6ec;_0x691686[_0x370685][_0x1092fe(0x21b)]=_0x5a2775;}),_0x315203[_0x29f6ec(0x2d7)]((_0x3684,_0x1e72f1)=>{var _0x20a78f=_0x29f6ec;_0x691686[_0x1e72f1][_0x20a78f(0x21f)]=_0x3684;}),_0x53672c[_0x29f6ec(0x2d7)]((_0xa115f2,_0x326894)=>{var _0x5706d6=_0x29f6ec;_0x691686[_0x326894][_0x5706d6(0x24a)]=_0xa115f2;}),_0x4a2833['forEach']((_0x182443,_0xb71e64)=>{var _0x12d945=_0x29f6ec;_0x691686[_0xb71e64][_0x12d945(0x251)]=_0x182443;}),_0x3922c9[_0x29f6ec(0x2d7)]((_0x2c9fd1,_0x358cce)=>{var _0x405dc8=_0x29f6ec;_0x691686[_0x358cce][_0x405dc8(0x266)]=_0x2c9fd1;}),_0x12cf18[_0x29f6ec(0x2d7)]((_0x277f59,_0x3fc42c)=>{var _0x2f4e3f=_0x29f6ec;_0x691686[_0x3fc42c][_0x2f4e3f(0x2b3)]=_0x277f59;});var _0x37b0b1=0x0;_0x691686[_0x29f6ec(0x2d7)](_0x4854de=>{var _0x6cef7b=_0x29f6ec;console[_0x6cef7b(0x288)]('foreach\x20newproduct',_0x4854de),(parseInt(_0x4854de[_0x6cef7b(0x2d3)])<parseInt(_0x4854de['return_qty'])||parseInt(_0x4854de['stock'])<parseInt(_0x4854de['return_qty'])&&parseInt(_0x4854de[_0x6cef7b(0x2d3)])>parseInt(_0x4854de['return_qty'])||parseInt(_0x4854de[_0x6cef7b(0x21f)])==0x0)&&_0x37b0b1++;});if(_0x37b0b1!=0x0)return _0x2c7a7e[_0x29f6ec(0x245)](_0x29f6ec(0x2c0),_0x29f6ec(0x237)),_0x1e6d49[_0x29f6ec(0x2ac)](_0x29f6ec(0x233));const _0x3b2860=await sales[_0x29f6ec(0x22e)]({'invoice':_0x52cda3});console['log'](_0x3b2860),_0x3b2860[_0x29f6ec(0x2dc)]='True';const _0xc38763=await _0x3b2860[_0x29f6ec(0x1da)](),_0x509f37=new sales_return({'invoice':_0x52cda3,'customer':_0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x27d)],'date':_0x5a5937,'warehouse_name':_0x7f81f4,'room':_0x6078c,'ToWarehouse':_0x484097,'ToRoom':_0x7cb4fe,'return_sale':_0x691686,'note':_0x431241}),_0x3af1d2=await _0x509f37['save']();console[_0x29f6ec(0x288)](_0x509f37);const _0x58512b=await sales_return[_0x29f6ec(0x22e)]({'invoice':_0x52cda3}),_0x222a0d=await warehouse[_0x29f6ec(0x22e)]({'name':_0x484097,'room':_0x7cb4fe});_0x58512b[_0x29f6ec(0x1e0)][_0x29f6ec(0x2d7)](_0x248720=>{var _0x4c1821=_0x29f6ec,_0x4b884b=0x0;const _0x1437c9=_0x222a0d['product_details'][_0x4c1821(0x225)](_0x36dc90=>{var _0xc838a=_0x4c1821;_0x36dc90['product_name']==_0x248720['product_name']&&_0x36dc90[_0xc838a(0x2b3)]==_0x248720[_0xc838a(0x2b3)]&&_0x36dc90['type']==_0x248720['type']&&_0x36dc90[_0xc838a(0x251)]==_0x248720[_0xc838a(0x251)]&&_0x36dc90[_0xc838a(0x24a)]==_0x248720[_0xc838a(0x24a)]&&(_0x36dc90['product_stock']=parseInt(_0x36dc90[_0xc838a(0x2c1)])+parseInt(_0x248720['return_qty']),_0x4b884b++);});_0x4b884b=='0'&&(_0x222a0d[_0x4c1821(0x206)]=_0x222a0d['product_details'][_0x4c1821(0x23b)]({'product_name':_0x248720[_0x4c1821(0x246)],'product_stock':_0x248720[_0x4c1821(0x21f)],'primary_code':_0x248720[_0x4c1821(0x214)],'secondary_code':_0x248720[_0x4c1821(0x29e)],'product_code':_0x248720['product_code'],'bay':_0x248720['bay'],'bin':_0x248720['bin'],'type':_0x248720[_0x4c1821(0x266)],'floorlevel':_0x248720['floorlevel']})),console[_0x4c1821(0x288)](_0x4c1821(0x2de),_0x222a0d);}),await _0x222a0d['save'](),console['log'](_0x2c7a7e['body']);const _0x3a56ce=new c_payment_data({'invoice':_0x52cda3,'customer':_0x2c7a7e['body'][_0x29f6ec(0x27d)],'reason':_0x29f6ec(0x2ad)});await _0x3a56ce['save']();const _0x2010f3=await master_shop[_0x29f6ec(0x213)]();console[_0x29f6ec(0x288)](_0x29f6ec(0x254),_0x2010f3[0x0][_0x29f6ec(0x247)]);const _0x363ae5=await email_settings[_0x29f6ec(0x22e)](),_0x17ea96=await customer[_0x29f6ec(0x22e)]({'name':_0x2c7a7e[_0x29f6ec(0x2a8)][_0x29f6ec(0x27d)]});console[_0x29f6ec(0x288)](_0x29f6ec(0x218),_0x17ea96);_0x2010f3[0x0][_0x29f6ec(0x2b7)]==0x1?(right_currency=_0x2010f3[0x0][_0x29f6ec(0x1ed)],left_currency=''):(right_currency='',left_currency=_0x2010f3[0x0][_0x29f6ec(0x1ed)]);var _0x3d5ad5=_0x5db6c1,_0x4246ed=_0x315203,_0x31b80f='',_0x44208c;for(_0x44208c in _0x3d5ad5){_0x31b80f+='<tr>'+_0x29f6ec(0x228)+_0x3d5ad5[_0x44208c]+_0x29f6ec(0x2d8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4246ed[_0x44208c]+_0x29f6ec(0x2d8)+_0x29f6ec(0x201);}console[_0x29f6ec(0x288)](_0x29f6ec(0x291),_0x31b80f);let _0x41aae2=nodemailer[_0x29f6ec(0x26d)]({'service':_0x29f6ec(0x240),'auth':{'user':_0x363ae5[_0x29f6ec(0x23f)],'pass':_0x363ae5[_0x29f6ec(0x1db)]}}),_0x14e524={'from':_0x363ae5[_0x29f6ec(0x23f)],'to':_0x17ea96[_0x29f6ec(0x23f)],'subject':_0x29f6ec(0x2a0),'attachments':[{'filename':_0x29f6ec(0x2c5),'path':__dirname+_0x29f6ec(0x227)+_0x29f6ec(0x2bb)+_0x2010f3[0x0][_0x29f6ec(0x247)],'cid':_0x29f6ec(0x205)}],'html':_0x29f6ec(0x2dd)+_0x29f6ec(0x274)+_0x29f6ec(0x2da)+_0x29f6ec(0x1e5)+_0x29f6ec(0x2d4)+_0x29f6ec(0x1e5)+_0x29f6ec(0x211)+_0x29f6ec(0x1ee)+_0x29f6ec(0x1e5)+_0x29f6ec(0x25e)+_0x2010f3[0x0]['site_title']+_0x29f6ec(0x2e3)+_0x29f6ec(0x1ee)+_0x29f6ec(0x1ee)+_0x29f6ec(0x2d2)+'<div>'+_0x29f6ec(0x259)+_0x29f6ec(0x249)+_0x52cda3+'\x20'+_0x29f6ec(0x272)+_0x29f6ec(0x24b)+_0x5a5937+'\x20'+'</span>'+_0x29f6ec(0x22b)+'</div>'+_0x29f6ec(0x221)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x29f6ec(0x21d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x29f6ec(0x26c)+_0x29f6ec(0x226)+_0x29f6ec(0x201)+_0x29f6ec(0x25f)+_0x29f6ec(0x253)+'\x20'+_0x31b80f+'\x20'+_0x29f6ec(0x268)+_0x29f6ec(0x2c2)+_0x29f6ec(0x1e5)+_0x29f6ec(0x26a)+'<h5>'+_0x2010f3[0x0][_0x29f6ec(0x2aa)]+'</h5>'+_0x29f6ec(0x1ee)+'</div>'+_0x29f6ec(0x1f8)};_0x41aae2[_0x29f6ec(0x236)](_0x14e524,function(_0x4bc14f,_0x1ab3b0){var _0x424ddc=_0x29f6ec;_0x4bc14f?(console['log'](_0x4bc14f),console[_0x424ddc(0x288)](_0x424ddc(0x2e0))):console[_0x424ddc(0x288)](_0x424ddc(0x277));}),_0x2c7a7e[_0x29f6ec(0x245)](_0x29f6ec(0x1f3),'sales\x20item\x20return\x20successfull'),_0x1e6d49[_0x29f6ec(0x2ac)]('/all_sales/view');}catch(_0x7bad39){console['log'](_0x7bad39),_0x1e6d49[_0x29f6ec(0x27b)](0xc8)[_0x29f6ec(0x20f)]({'message1':_0x7bad39['message']});}}),router[a0_0x1a2bca(0x229)](a0_0x1a2bca(0x1ea),auth,async(_0x4faca4,_0x5bdf45)=>{var _0x9ae6f7=a0_0x1a2bca;try{const {username:_0x8c06e9,email:_0xafc0fd,role:_0x24a6eb}=_0x4faca4[_0x9ae6f7(0x26e)],_0x2f49cd=_0x4faca4[_0x9ae6f7(0x26e)],_0x1e4430=await profile[_0x9ae6f7(0x22e)]({'email':_0x2f49cd[_0x9ae6f7(0x23f)]}),_0x43d72b=await master_shop[_0x9ae6f7(0x213)]();console[_0x9ae6f7(0x288)](_0x9ae6f7(0x2b4),_0x43d72b);const _0x1af06b=_0x4faca4[_0x9ae6f7(0x279)]['id'],_0x428b47=await sales[_0x9ae6f7(0x1f1)](_0x1af06b);console['log']('barcode\x20user_id',_0x428b47);if(_0x43d72b[0x0][_0x9ae6f7(0x25c)]=='English\x20(US)')var _0x23a102=users['English'];else{if(_0x43d72b[0x0]['language']==_0x9ae6f7(0x234))var _0x23a102=users['Hindi'];else{if(_0x43d72b[0x0]['language']==_0x9ae6f7(0x2b0))var _0x23a102=users['German'];else{if(_0x43d72b[0x0][_0x9ae6f7(0x25c)]==_0x9ae6f7(0x2c6))var _0x23a102=users[_0x9ae6f7(0x2c6)];else{if(_0x43d72b[0x0][_0x9ae6f7(0x25c)]==_0x9ae6f7(0x2db))var _0x23a102=users[_0x9ae6f7(0x2db)];else{if(_0x43d72b[0x0]['language']==_0x9ae6f7(0x220))var _0x23a102=users['Portuguese'];else{if(_0x43d72b[0x0][_0x9ae6f7(0x25c)]==_0x9ae6f7(0x1e9))var _0x23a102=users[_0x9ae6f7(0x1e9)];else{if(_0x43d72b[0x0][_0x9ae6f7(0x25c)]==_0x9ae6f7(0x2c8))var _0x23a102=users[_0x9ae6f7(0x1f4)];}}}}}}}_0x5bdf45[_0x9ae6f7(0x242)](_0x9ae6f7(0x1f6),{'success':_0x4faca4[_0x9ae6f7(0x245)](_0x9ae6f7(0x1f3)),'errors':_0x4faca4[_0x9ae6f7(0x245)](_0x9ae6f7(0x2c0)),'role':_0x2f49cd,'profile':_0x1e4430,'alldata':_0x428b47,'master_shop':_0x43d72b,'language':_0x23a102});}catch(_0x4fbc97){console[_0x9ae6f7(0x288)](_0x4fbc97);}}),router[a0_0x1a2bca(0x20a)](a0_0x1a2bca(0x282),async(_0x33b6a0,_0x4cc5b3)=>{var _0x1959fd=a0_0x1a2bca;const {product_code:_0x23db61,warehouse_name:_0x90c870,rooms_data:_0xd6e200,Roomslist:_0x35e9d0}=_0x33b6a0[_0x1959fd(0x2a8)],_0x2e0669=_0x35e9d0[_0x1959fd(0x2a9)](','),_0x28cd99=[];async function _0x25a62e(_0x91a154){var _0x321d9e=_0x1959fd;const _0x54237f=await warehouse[_0x321d9e(0x255)]([{'$match':{'name':_0x90c870,'room':_0x91a154}},{'$unwind':_0x321d9e(0x292)},{'$match':{'product_details.primary_code':_0x23db61}},{'$group':{'_id':_0x321d9e(0x252),'name':{'$first':_0x321d9e(0x2a2)},'product_stock':{'$first':_0x321d9e(0x250)},'primary_code':{'$first':_0x321d9e(0x207)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x321d9e(0x2c7)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x321d9e(0x20d)},'pallet':{'$first':_0x321d9e(0x230)},'unit':{'$first':_0x321d9e(0x2d5)},'secondary_unit':{'$first':_0x321d9e(0x1f9)},'storage':{'$first':_0x321d9e(0x1e8)},'rack':{'$first':_0x321d9e(0x2d1)},'expiry_date':{'$first':_0x321d9e(0x216)},'production_date':{'$first':_0x321d9e(0x22d)},'maxPerUnit':{'$first':_0x321d9e(0x299)},'batch_code':{'$first':_0x321d9e(0x2cf)},'product_cat':{'$first':_0x321d9e(0x2d0)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x321d9e(0x29d)},'invoice':{'$first':_0x321d9e(0x2b6)},'actual_qty':{'$first':_0x321d9e(0x263)}}}]),_0x4cf1e3=await warehouse[_0x321d9e(0x255)]([{'$match':{'name':_0x90c870,'room':_0x91a154}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x23db61}},{'$group':{'_id':_0x321d9e(0x252),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x321d9e(0x250)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x321d9e(0x22f)},'product_code':{'$first':_0x321d9e(0x2c7)},'level':{'$first':_0x321d9e(0x203)},'isle':{'$first':_0x321d9e(0x25a)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x321d9e(0x230)},'unit':{'$first':_0x321d9e(0x2d5)},'secondary_unit':{'$first':_0x321d9e(0x1f9)},'storage':{'$first':_0x321d9e(0x1e8)},'rack':{'$first':_0x321d9e(0x2d1)},'expiry_date':{'$first':_0x321d9e(0x216)},'production_date':{'$first':_0x321d9e(0x22d)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x321d9e(0x2cf)},'product_cat':{'$first':_0x321d9e(0x2d0)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x321d9e(0x2b6)}}}]);if(_0x54237f[_0x321d9e(0x202)]>0x0)_0x28cd99['push'](_0x54237f);else _0x4cf1e3['length']>0x0&&_0x28cd99['push'](_0x4cf1e3);}const _0x3e2d6e=_0x2e0669[_0x1959fd(0x225)](_0x9ebae4=>_0x25a62e(_0x9ebae4));await Promise[_0x1959fd(0x21e)](_0x3e2d6e),_0x4cc5b3['json'](_0x28cd99);}),module[a0_0x1a2bca(0x27c)]=router;