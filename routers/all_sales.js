var a0_0x3b246f=a0_0x198f;(function(_0x54cc17,_0x114dab){var _0x526135=a0_0x198f,_0x325ea9=_0x54cc17();while(!![]){try{var _0x4c2eb9=-parseInt(_0x526135(0x23c))/0x1*(parseInt(_0x526135(0x223))/0x2)+parseInt(_0x526135(0x1e7))/0x3+-parseInt(_0x526135(0x29d))/0x4+parseInt(_0x526135(0x23e))/0x5*(-parseInt(_0x526135(0x1ef))/0x6)+parseInt(_0x526135(0x1b9))/0x7*(-parseInt(_0x526135(0x22b))/0x8)+parseInt(_0x526135(0x279))/0x9*(parseInt(_0x526135(0x23b))/0xa)+parseInt(_0x526135(0x1d7))/0xb*(parseInt(_0x526135(0x1c0))/0xc);if(_0x4c2eb9===_0x114dab)break;else _0x325ea9['push'](_0x325ea9['shift']());}catch(_0x5b4f2a){_0x325ea9['push'](_0x325ea9['shift']());}}}(a0_0x4792,0x424d6));const express=require(a0_0x3b246f(0x1f8)),app=express(),router=express[a0_0x3b246f(0x2ae)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x3b246f(0x22d)),nodemailer=require(a0_0x3b246f(0x242)),users=require(a0_0x3b246f(0x1d1));router[a0_0x3b246f(0x210)](a0_0x3b246f(0x1f1),auth,async(_0x30f81d,_0x2403ac)=>{var _0x471651=a0_0x3b246f;try{const {username:_0x3efd36,email:_0xd5b79e,role:_0x4939f4}=_0x30f81d[_0x471651(0x218)],_0x15093c=_0x30f81d['user'],_0x25f09e=await profile['findOne']({'email':_0x15093c[_0x471651(0x1fd)]}),_0x3ad136=await master_shop[_0x471651(0x1ba)]();let _0x20680d;if(_0x15093c[_0x471651(0x25a)]==_0x471651(0x26b)){const _0x19c238=await staff['findOne']({'email':_0x15093c[_0x471651(0x1fd)]});_0x20680d=await sales[_0x471651(0x1fe)]([{'$lookup':{'from':_0x471651(0x1cd),'localField':'customer','foreignField':_0x471651(0x287),'as':_0x471651(0x213)}},{'$unwind':'$customers_docs'},{'$unwind':_0x471651(0x269)},{'$group':{'_id':_0x471651(0x298),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x471651(0x1bc)},'warehouse_name':{'$first':_0x471651(0x27f)},'sale_product':{'$push':_0x471651(0x269)},'note':{'$first':_0x471651(0x276)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x471651(0x293)},'total_saleproduct_quantity':{'$sum':_0x471651(0x27e)},'level':{'$addToSet':_0x471651(0x251)},'isle':{'$addToSet':_0x471651(0x1b3)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x471651(0x1cf)},'finalize':{'$first':_0x471651(0x1aa)},'isAllowEdit':{'$first':_0x471651(0x253)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x20680d=await sales[_0x471651(0x1fe)]([{'$lookup':{'from':_0x471651(0x1cd),'localField':_0x471651(0x1f2),'foreignField':_0x471651(0x287),'as':'customers_docs'}},{'$unwind':_0x471651(0x293)},{'$unwind':_0x471651(0x269)},{'$group':{'_id':_0x471651(0x298),'invoice':{'$first':_0x471651(0x19e)},'customers':{'$first':_0x471651(0x21e)},'date':{'$first':_0x471651(0x1bc)},'warehouse_name':{'$first':_0x471651(0x27f)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x471651(0x276)},'return_data':{'$first':_0x471651(0x27c)},'customers_docs':{'$first':_0x471651(0x293)},'total_saleproduct_quantity':{'$sum':_0x471651(0x27e)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x471651(0x1b3)},'type':{'$addToSet':_0x471651(0x23f)},'pallet':{'$addToSet':_0x471651(0x1cf)},'finalize':{'$first':_0x471651(0x1aa)},'isAllowEdit':{'$first':_0x471651(0x253)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x471651(0x1de)](_0x471651(0x2ac),_0x20680d);if(_0x3ad136[0x0]['language']=='English\x20(US)'){var _0x4b7808=users[_0x471651(0x246)];console['log'](_0x4b7808);}else{if(_0x3ad136[0x0][_0x471651(0x20a)]==_0x471651(0x1b5))var _0x4b7808=users[_0x471651(0x1b5)];else{if(_0x3ad136[0x0][_0x471651(0x20a)]=='German')var _0x4b7808=users[_0x471651(0x1ff)];else{if(_0x3ad136[0x0][_0x471651(0x20a)]==_0x471651(0x200))var _0x4b7808=users['Spanish'];else{if(_0x3ad136[0x0][_0x471651(0x20a)]==_0x471651(0x1d6))var _0x4b7808=users[_0x471651(0x1d6)];else{if(_0x3ad136[0x0][_0x471651(0x20a)]==_0x471651(0x1ae))var _0x4b7808=users[_0x471651(0x1cc)];else{if(_0x3ad136[0x0][_0x471651(0x20a)]==_0x471651(0x29f))var _0x4b7808=users['Chinese'];else{if(_0x3ad136[0x0][_0x471651(0x20a)]==_0x471651(0x231))var _0x4b7808=users[_0x471651(0x1b0)];}}}}}}}_0x2403ac[_0x471651(0x2a7)]('all_sales',{'success':_0x30f81d[_0x471651(0x24b)]('success'),'errors':_0x30f81d[_0x471651(0x24b)](_0x471651(0x286)),'sales':_0x20680d,'profile':_0x25f09e,'role':_0x15093c,'master_shop':_0x3ad136,'language':_0x4b7808});}catch(_0x34d1ab){console[_0x471651(0x1de)](_0x34d1ab);}});async function getRandom8DigitNumber(){var _0x29db52=a0_0x3b246f;const _0x4590de=0x989680,_0x34d0d4=0x5f5e0ff,_0x4f408f=Math[_0x29db52(0x2ad)](Math[_0x29db52(0x281)]()*(_0x34d0d4-_0x4590de+0x1))+_0x4590de;var _0x140749;const _0x58635d=await sales['findOne']({'invoice':_0x29db52(0x1bd)+_0x4f408f});return _0x58635d&&_0x58635d['length']>0x0?_0x140749=_0x29db52(0x1bd)+_0x4f408f:_0x140749=_0x29db52(0x1bd)+_0x4f408f,_0x140749;}router['get'](a0_0x3b246f(0x27d),auth,async(_0x4f388d,_0x19d5ba)=>{var _0xfba3c4=a0_0x3b246f;try{const {username:_0x46fd0f,email:_0x58f8cb,role:_0xd54b2b}=_0x4f388d[_0xfba3c4(0x218)],_0x39f5e9=_0x4f388d[_0xfba3c4(0x218)],_0x484ded=await profile[_0xfba3c4(0x208)]({'email':_0x39f5e9['email']}),_0xf48791=await master_shop['find'](),_0x1677c0=await customer[_0xfba3c4(0x1ba)]({});let _0x37cff1;if(_0x39f5e9[_0xfba3c4(0x25a)]==_0xfba3c4(0x26b)){const _0x2e1880=await staff[_0xfba3c4(0x208)]({'email':_0x39f5e9[_0xfba3c4(0x1fd)]});_0x37cff1=await warehouse[_0xfba3c4(0x1fe)]([{'$match':{'status':_0xfba3c4(0x1ee),'name':_0x2e1880[_0xfba3c4(0x235)],'warehouse_category':_0xfba3c4(0x26c),'name':{'$ne':_0xfba3c4(0x28f)}}},{'$group':{'_id':_0xfba3c4(0x25c),'name':{'$first':_0xfba3c4(0x25c)}}},{'$sort':{'name':0x1}}]);}else _0x37cff1=await warehouse[_0xfba3c4(0x1fe)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0xfba3c4(0x28f)}}},{'$group':{'_id':_0xfba3c4(0x25c),'name':{'$first':_0xfba3c4(0x25c)}}},{'$sort':{'name':0x1}}]);const _0x24868c=await product[_0xfba3c4(0x1ba)]({});var _0x6cedd6=[_0xfba3c4(0x1a3),_0xfba3c4(0x224)];const _0x39ffcb=await sales[_0xfba3c4(0x1ba)]({}),_0x4df910=_0x39ffcb['length']+0x1,_0x49c1ab=_0xfba3c4(0x1bd)+_0x4df910['toString']()[_0xfba3c4(0x297)](0x5,'0');if(_0xf48791[0x0][_0xfba3c4(0x20a)]==_0xfba3c4(0x248)){var _0x4af32a=users['English'];console[_0xfba3c4(0x1de)](_0x4af32a);}else{if(_0xf48791[0x0][_0xfba3c4(0x20a)]==_0xfba3c4(0x1b5))var _0x4af32a=users[_0xfba3c4(0x1b5)];else{if(_0xf48791[0x0][_0xfba3c4(0x20a)]==_0xfba3c4(0x1ff))var _0x4af32a=users[_0xfba3c4(0x1ff)];else{if(_0xf48791[0x0][_0xfba3c4(0x20a)]=='Spanish')var _0x4af32a=users[_0xfba3c4(0x200)];else{if(_0xf48791[0x0]['language']==_0xfba3c4(0x1d6))var _0x4af32a=users[_0xfba3c4(0x1d6)];else{if(_0xf48791[0x0][_0xfba3c4(0x20a)]==_0xfba3c4(0x1ae))var _0x4af32a=users[_0xfba3c4(0x1cc)];else{if(_0xf48791[0x0][_0xfba3c4(0x20a)]==_0xfba3c4(0x29f))var _0x4af32a=users['Chinese'];else{if(_0xf48791[0x0]['language']==_0xfba3c4(0x231))var _0x4af32a=users[_0xfba3c4(0x1b0)];}}}}}}}const _0x1313cd=getRandom8DigitNumber();_0x1313cd[_0xfba3c4(0x1bf)](_0x4f852e=>{var _0x18d8d9=_0xfba3c4;_0x19d5ba[_0x18d8d9(0x2a7)](_0x18d8d9(0x1a1),{'success':_0x4f388d['flash'](_0x18d8d9(0x25b)),'errors':_0x4f388d[_0x18d8d9(0x24b)](_0x18d8d9(0x286)),'role':_0x39f5e9,'profile':_0x484ded,'customer':_0x1677c0,'warehouse':_0x37cff1,'product':_0x24868c,'invoice':_0x4f852e,'master_shop':_0xf48791,'language':_0x4af32a,'rooms_data':_0x6cedd6});})[_0xfba3c4(0x1f9)](_0xab1949=>{var _0x1561ba=_0xfba3c4;_0x4f388d[_0x1561ba(0x24b)](_0x1561ba(0x286),_0x1561ba(0x244)),_0x19d5ba[_0x1561ba(0x282)](_0x1561ba(0x21a));});}catch(_0x110ea2){console[_0xfba3c4(0x1de)](_0x110ea2);}}),router['get'](a0_0x3b246f(0x236),auth,async(_0x754b4e,_0x337438)=>{var _0x5dc810=a0_0x3b246f;try{const _0x3090a9=_0x754b4e[_0x5dc810(0x1a7)]['id'];console['log'](_0x3090a9);const _0x26d8b5=await product['find'](),_0x4df196=await purchases['aggregate']([{'$match':{'warehouse_name':_0x3090a9}},{'$unwind':'$product'},{'$group':{'_id':_0x5dc810(0x267)}}]);console[_0x5dc810(0x1de)](_0x5dc810(0x277),_0x4df196),_0x337438[_0x5dc810(0x241)](0xc8)[_0x5dc810(0x24d)]({'purchases_data':_0x4df196,'product_data':_0x26d8b5});}catch(_0xeed69b){console[_0x5dc810(0x1de)](_0xeed69b);}}),router['post'](a0_0x3b246f(0x1da),auth,async(_0x418068,_0x5ebd8a)=>{var _0x3c0c68=a0_0x3b246f;try{const {warehouse_data:_0x1eb416,product_data:_0x26a318}=_0x418068['body'];console[_0x3c0c68(0x1de)](_0x418068[_0x3c0c68(0x1d2)][_0x3c0c68(0x2a5)]);;const _0x139cb5=await master_shop[_0x3c0c68(0x1ba)]();console[_0x3c0c68(0x1de)]('master',_0x139cb5);const _0x203cf0=await product['findOne']({'name':_0x26a318});console['log']('product',_0x203cf0);const _0x613aae=await warehouse[_0x3c0c68(0x1fe)]([{'$match':{'name':_0x1eb416}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x26a318}},{'$group':{'_id':_0x3c0c68(0x28a),'product_stock':{'$first':_0x3c0c68(0x254)}}}]);console[_0x3c0c68(0x1de)](_0x3c0c68(0x20f),_0x613aae),_0x5ebd8a[_0x3c0c68(0x241)](0xc8)['json']({'master':_0x139cb5,'new_product':_0x203cf0,'stock_data':_0x613aae});}catch(_0xd19498){console['log'](_0xd19498);}}),router[a0_0x3b246f(0x22c)](a0_0x3b246f(0x27d),auth,async(_0x37de5d,_0x30265d)=>{var _0x14511b=a0_0x3b246f;try{const {invoice:_0x3dd2f8,date:_0x497b7d,warehouse_name:_0x33c1a7,product_name:_0x4c3f79,stock:_0x1be24a,quantity:_0x19c4b0,note:_0x49cdb7,room:_0x1e202d,primary_code:_0x49fb36,secondary_code:_0x7f37fa,prod_code:_0x591e5d,level:_0x2e796f,isle:_0x21a3fd,pallet:_0x5736a0,batch_code:_0x50b50f,SCRN:_0x46c82f,expiry_date:_0x326c27}=_0x37de5d[_0x14511b(0x1d2)];if(typeof _0x4c3f79=='string')var _0x5335d8=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x290)]],_0x290f55=[_0x37de5d[_0x14511b(0x1d2)]['stock']],_0x1e10e8=[_0x37de5d[_0x14511b(0x1d2)]['carton']],_0x19becd=[_0x37de5d['body'][_0x14511b(0x1a8)]],_0x37335d=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x1ad)]],_0x136fb7=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x2a0)]],_0x2086a6=[_0x37de5d['body'][_0x14511b(0x1e8)]],_0x34f721=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x219)]],_0xeb337d=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x26a)]],_0x1a2d43=[_0x37de5d[_0x14511b(0x1d2)]['batch_code']],_0x703722=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x256)]],_0x55c2aa=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x265)]],_0x5d3485=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x22e)]],_0x571ad5=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x2a9)]],_0x3666fe=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x1d9)]],_0x3a57a0=[_0x37de5d[_0x14511b(0x1d2)]['delivery_code']],_0x37a608=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x272)]],_0x4cec95=[_0x37de5d['body'][_0x14511b(0x2a3)]],_0x2c4289=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x1dd)]],_0x5e1db5=[_0x37de5d['body'][_0x14511b(0x1c1)]],_0x1d20d1=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x296)]],_0x2254ae=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x26f)]],_0xe98d03=[_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x1b1)]];else var _0x5335d8=[..._0x37de5d['body'][_0x14511b(0x290)]],_0x290f55=[..._0x37de5d[_0x14511b(0x1d2)]['stock']],_0x1e10e8=[..._0x37de5d[_0x14511b(0x1d2)]['carton']],_0x19becd=[..._0x37de5d[_0x14511b(0x1d2)]['primary_code']],_0x37335d=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x1ad)]],_0x136fb7=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x2a0)]],_0x2086a6=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x1e8)]],_0x34f721=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x219)]],_0xeb337d=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x26a)]],_0x1a2d43=[..._0x37de5d['body']['batch_code']],_0x703722=[..._0x37de5d[_0x14511b(0x1d2)]['expiry_date']],_0x55c2aa=[..._0x37de5d['body'][_0x14511b(0x265)]],_0x5d3485=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x22e)]],_0x571ad5=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x2a9)]],_0x3666fe=[..._0x37de5d['body'][_0x14511b(0x1d9)]],_0x3a57a0=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x271)]],_0x37a608=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x272)]],_0x4cec95=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x2a3)]],_0x2c4289=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x1dd)]],_0x5e1db5=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x1c1)]],_0x1d20d1=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x296)]],_0x2254ae=[..._0x37de5d[_0x14511b(0x1d2)]['actual_uom']],_0xe98d03=[..._0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x1b1)]];const _0x99322b=_0x5335d8[_0x14511b(0x1db)](_0x5f1aaa=>{return _0x5f1aaa={'product_name':_0x5f1aaa};});_0x290f55[_0x14511b(0x201)]((_0x3155cc,_0x5af7c8)=>{var _0x375d51=_0x14511b;_0x99322b[_0x5af7c8]['stock']=Math[_0x375d51(0x29a)](_0x3155cc);}),_0x1d20d1[_0x14511b(0x201)]((_0x3b5de6,_0x40f8b3)=>{var _0x15dfee=_0x14511b;_0x99322b[_0x40f8b3]['actual_qty']=Math[_0x15dfee(0x29a)](_0x3b5de6);}),_0x2254ae['forEach']((_0x3d002c,_0x5c9cb3)=>{var _0xb2a2ac=_0x14511b;_0x99322b[_0x5c9cb3][_0xb2a2ac(0x26f)]=_0x3d002c;}),_0xe98d03[_0x14511b(0x201)]((_0x276d47,_0x2257e5)=>{var _0x27b6e9=_0x14511b;_0x99322b[_0x2257e5][_0x27b6e9(0x27a)]=_0x276d47;}),_0x1e10e8[_0x14511b(0x201)]((_0x323269,_0x4a0a2a)=>{var _0x9abd32=_0x14511b;_0x99322b[_0x4a0a2a][_0x9abd32(0x2a3)]=_0x323269;}),_0x19becd[_0x14511b(0x201)]((_0xe48ba6,_0x4be5cb)=>{_0x99322b[_0x4be5cb]['primary_code']=_0xe48ba6;}),_0x37335d[_0x14511b(0x201)]((_0x4cad3f,_0x30d048)=>{var _0x58d43f=_0x14511b;_0x99322b[_0x30d048][_0x58d43f(0x1ad)]=_0x4cad3f;}),_0x136fb7['forEach']((_0xe58c4d,_0x25c62b)=>{var _0x8e4b29=_0x14511b;_0x99322b[_0x25c62b][_0x8e4b29(0x225)]=_0xe58c4d;}),_0x2086a6[_0x14511b(0x201)]((_0x221bf1,_0x593c30)=>{var _0x2f909d=_0x14511b;_0x2c4289[_0x2f909d(0x201)]((_0x10411f,_0x16badd)=>{var _0x5008f1=_0x2f909d;if(_0x10411f==_0x5008f1(0x23d)&&_0x593c30==_0x16badd){var _0x5b0d57=_0x221bf1[_0x5008f1(0x249)](0x3);_0x99322b[_0x593c30]['storage']=_0x221bf1[0x0],_0x99322b[_0x593c30]['rack']=_0x221bf1[0x1],_0x99322b[_0x593c30]['bay']=0x0,_0x99322b[_0x593c30][_0x5008f1(0x1c3)]=0x0,_0x99322b[_0x593c30][_0x5008f1(0x1e5)]=_0x5008f1(0x1cb),_0x99322b[_0x593c30][_0x5008f1(0x1e2)]=_0x5b0d57;}else{if(_0x10411f==_0x5008f1(0x1a2)&&_0x593c30==_0x16badd){var _0x5b0d57=_0x221bf1[_0x5008f1(0x249)](0x3);_0x99322b[_0x593c30]['storage']=_0x221bf1[0x0],_0x99322b[_0x593c30][_0x5008f1(0x214)]=_0x221bf1[0x1],_0x99322b[_0x593c30]['bay']=0x0,_0x99322b[_0x593c30][_0x5008f1(0x1c3)]=0x0,_0x99322b[_0x593c30][_0x5008f1(0x1e5)]=_0x5008f1(0x1cb),_0x99322b[_0x593c30]['floorlevel']=_0x221bf1[0x5];}else{if(_0x593c30==_0x16badd){var _0x2168a4;if(_0x221bf1[0x4]=='L')_0x2168a4='Level';else _0x221bf1[0x4]=='F'&&(_0x2168a4=_0x5008f1(0x1cb));_0x99322b[_0x593c30][_0x5008f1(0x2a6)]=_0x221bf1[0x0],_0x99322b[_0x593c30][_0x5008f1(0x214)]=_0x221bf1[0x1],_0x99322b[_0x593c30][_0x5008f1(0x261)]=_0x221bf1[0x2],_0x99322b[_0x593c30]['bin']=_0x221bf1[0x3],_0x99322b[_0x593c30][_0x5008f1(0x1e5)]=_0x2168a4,_0x99322b[_0x593c30][_0x5008f1(0x1e2)]=_0x221bf1[0x5];}}}});}),_0x34f721[_0x14511b(0x201)]((_0x3bc07b,_0x1bc8bb)=>{var _0x175172=_0x14511b;_0x99322b[_0x1bc8bb][_0x175172(0x1fa)]=_0x3bc07b;}),_0xeb337d[_0x14511b(0x201)]((_0x513030,_0x38687f)=>{var _0x3f1143=_0x14511b;_0x99322b[_0x38687f][_0x3f1143(0x26a)]=_0x513030;}),_0x1a2d43['forEach']((_0x5f16be,_0x391897)=>{var _0x1dbec4=_0x14511b;_0x99322b[_0x391897][_0x1dbec4(0x1f4)]=_0x5f16be;}),_0x703722[_0x14511b(0x201)]((_0x11c6b8,_0x5e951a)=>{var _0x39bbff=_0x14511b;_0x99322b[_0x5e951a][_0x39bbff(0x256)]=_0x11c6b8;}),_0x55c2aa[_0x14511b(0x201)]((_0x4472ab,_0x32d31a)=>{var _0x1ee562=_0x14511b;_0x99322b[_0x32d31a][_0x1ee562(0x1b4)]=_0x4472ab;}),_0x5d3485['forEach']((_0x37390a,_0x594f09)=>{var _0x229d88=_0x14511b;_0x99322b[_0x594f09][_0x229d88(0x22e)]=_0x37390a;}),_0x571ad5[_0x14511b(0x201)]((_0x1a6db7,_0x50abb6)=>{_0x99322b[_0x50abb6]['requested_qty']=_0x1a6db7;}),_0x3666fe[_0x14511b(0x201)]((_0x54cf33,_0x3ce1e1)=>{var _0x4cc88d=_0x14511b;_0x99322b[_0x3ce1e1][_0x4cc88d(0x1d9)]=_0x54cf33;}),_0x3a57a0[_0x14511b(0x201)]((_0x44f1de,_0x36c251)=>{_0x99322b[_0x36c251]['delivery_code']=_0x44f1de;}),_0x37a608[_0x14511b(0x201)]((_0x442d2e,_0x37c049)=>{var _0x5e22de=_0x14511b;_0x99322b[_0x37c049][_0x5e22de(0x272)]=_0x442d2e;}),_0x4cec95[_0x14511b(0x201)]((_0x3411e9,_0x15d8f7)=>{var _0x5e325b=_0x14511b;_0x99322b[_0x15d8f7][_0x5e325b(0x295)]=_0x3411e9;}),_0x2c4289[_0x14511b(0x201)]((_0x2f5eb1,_0x50a983)=>{var _0xb8955c=_0x14511b;_0x99322b[_0x50a983][_0xb8955c(0x1b8)]=_0x2f5eb1;}),_0x5e1db5['forEach']((_0x9daffb,_0x154fc7)=>{var _0x26942f=_0x14511b;_0x99322b[_0x154fc7][_0x26942f(0x28d)]=_0x9daffb;});var _0x542f85=0x0;_0x99322b['forEach'](_0x8fc9bb=>{var _0x13cbd6=_0x14511b;(_0x8fc9bb[_0x13cbd6(0x1ca)]<_0x8fc9bb[_0x13cbd6(0x295)]||_0x8fc9bb[_0x13cbd6(0x295)]==0x0)&&(console[_0x13cbd6(0x1de)](_0x13cbd6(0x217),_0x8fc9bb),_0x542f85++);});const _0x102f35=_0x99322b['filter'](_0x5387f6=>_0x5387f6['quantity']!=='0'&&_0x5387f6[_0x14511b(0x2a3)]!==''),_0x3c6041=new sales({'invoice':_0x3dd2f8,'customer':_0x37de5d[_0x14511b(0x1d2)][_0x14511b(0x1f2)],'date':_0x497b7d,'warehouse_name':_0x33c1a7,'sale_product':_0x102f35,'note':_0x49cdb7,'room':_0x1e202d,'primary_code':_0x49fb36,'secondary_code':_0x7f37fa,'prod_code':_0x591e5d,'SCRN':_0x46c82f}),_0x5786fe=await _0x3c6041[_0x14511b(0x1d0)]();_0x37de5d[_0x14511b(0x24b)](_0x14511b(0x25b),_0x14511b(0x205)),_0x30265d[_0x14511b(0x282)](_0x14511b(0x26d)+_0x5786fe[_0x14511b(0x1b7)]);}catch(_0x34e1f7){console['log'](_0x34e1f7);}}),router[a0_0x3b246f(0x210)](a0_0x3b246f(0x2ab),auth,async(_0x484833,_0x215512)=>{var _0x147510=a0_0x3b246f;try{const {username:_0x344f38,email:_0x55adbc,role:_0x51b37d}=_0x484833[_0x147510(0x218)],_0x41c717=_0x484833['user'],_0x572d2d=await profile['findOne']({'email':_0x41c717[_0x147510(0x1fd)]}),_0x5c475b=await master_shop[_0x147510(0x1ba)](),_0x33c7a9=_0x484833[_0x147510(0x1a7)]['id'],_0x37de05=await sales[_0x147510(0x222)](_0x33c7a9),_0x586f81=await warehouse['aggregate']([{'$match':{'name':_0x37de05[_0x147510(0x245)]}},{'$unwind':_0x147510(0x20d)},{'$group':{'_id':_0x147510(0x266),'name':{'$first':_0x147510(0x28a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x147510(0x1ab)},'type':{'$first':_0x147510(0x21b)},'floorlevel':{'$first':_0x147510(0x1b2)},'primary_code':{'$first':_0x147510(0x1f7)},'secondary_code':{'$first':_0x147510(0x291)},'product_code':{'$first':_0x147510(0x1d5)},'storage':{'$first':_0x147510(0x1e0)},'rack':{'$first':_0x147510(0x1c9)},'expiry_date':{'$first':_0x147510(0x284)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x20f477=await customer[_0x147510(0x1ba)]({});let _0x5294da;if(_0x41c717[_0x147510(0x25a)]=='staff'){const _0x2e6afd=await staff[_0x147510(0x208)]({'email':_0x41c717[_0x147510(0x1fd)]});_0x5294da=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x2e6afd[_0x147510(0x235)]}},{'$group':{'_id':_0x147510(0x25c),'name':{'$first':_0x147510(0x25c)}}}]);}else _0x5294da=await warehouse[_0x147510(0x1fe)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x147510(0x25c),'name':{'$first':_0x147510(0x25c)}}}]);const _0x1e7e48=await product['find']({}),_0x5eb5f5=await suppliers['find']({});if(_0x5c475b[0x0][_0x147510(0x20a)]==_0x147510(0x248)){var _0x1ca687=users[_0x147510(0x246)];console[_0x147510(0x1de)](_0x1ca687);}else{if(_0x5c475b[0x0][_0x147510(0x20a)]=='Hindi')var _0x1ca687=users[_0x147510(0x1b5)];else{if(_0x5c475b[0x0]['language']==_0x147510(0x1ff))var _0x1ca687=users[_0x147510(0x1ff)];else{if(_0x5c475b[0x0][_0x147510(0x20a)]=='Spanish')var _0x1ca687=users[_0x147510(0x200)];else{if(_0x5c475b[0x0][_0x147510(0x20a)]==_0x147510(0x1d6))var _0x1ca687=users[_0x147510(0x1d6)];else{if(_0x5c475b[0x0]['language']==_0x147510(0x1ae))var _0x1ca687=users[_0x147510(0x1cc)];else{if(_0x5c475b[0x0][_0x147510(0x20a)]==_0x147510(0x29f))var _0x1ca687=users[_0x147510(0x29f)];else{if(_0x5c475b[0x0]['language']=='Arabic\x20(ae)')var _0x1ca687=users[_0x147510(0x1b0)];}}}}}}}_0x215512[_0x147510(0x2a7)](_0x147510(0x270),{'success':_0x484833[_0x147510(0x24b)]('success'),'errors':_0x484833[_0x147510(0x24b)](_0x147510(0x286)),'role':_0x41c717,'profile':_0x572d2d,'customer':_0x20f477,'warehouse':_0x5294da,'product':_0x586f81,'user':_0x37de05,'master_shop':_0x5c475b,'unit':_0x1e7e48,'language':_0x1ca687,'suppliers':_0x5eb5f5});}catch(_0x4dd9a6){console[_0x147510(0x1de)](_0x4dd9a6);}}),router[a0_0x3b246f(0x22c)]('/preview/:id',auth,async(_0x17da20,_0x520ee5)=>{var _0x11da99=a0_0x3b246f;try{const _0x8b93d0=_0x17da20[_0x11da99(0x1a7)]['id'],{invoice:_0x4f1662,warehouse_name:_0x40e521,room:_0x2a1ca0}=_0x17da20[_0x11da99(0x1d2)],_0x3daba8=await sales[_0x11da99(0x208)]({'invoice':_0x4f1662}),_0x458431=_0x3daba8['sale_product'][_0x11da99(0x1db)](async _0x153501=>{var _0x79970e=_0x11da99,_0x1ae2a1=await warehouse[_0x79970e(0x208)]({'name':_0x40e521,'room':_0x153501[_0x79970e(0x1b8)],'warehouse_category':_0x79970e(0x26c)});const _0x22dda7=_0x1ae2a1[_0x79970e(0x1a9)]['map'](_0x421b26=>{var _0x474034=_0x79970e;_0x421b26[_0x474034(0x290)]==_0x153501[_0x474034(0x290)]&&_0x421b26[_0x474034(0x1e2)]==_0x153501[_0x474034(0x1e2)]&&_0x421b26['type']==_0x153501[_0x474034(0x1e5)]&&_0x421b26[_0x474034(0x1c3)]==_0x153501['bin']&&_0x421b26[_0x474034(0x261)]==_0x153501[_0x474034(0x261)]&&_0x421b26['rack']==_0x153501[_0x474034(0x214)]&&_0x421b26[_0x474034(0x2a6)]==_0x153501[_0x474034(0x2a6)]&&_0x421b26[_0x474034(0x256)]==_0x153501[_0x474034(0x256)]&&_0x421b26['batch_code']==_0x153501['batch_code']&&_0x421b26[_0x474034(0x1b7)]==_0x153501[_0x474034(0x27a)]&&(_0x421b26[_0x474034(0x238)]=Math['max'](0x0,Math[_0x474034(0x29a)](_0x421b26[_0x474034(0x238)])-Math[_0x474034(0x29a)](_0x153501[_0x474034(0x2a3)])));});return _0x1ae2a1;});Promise[_0x11da99(0x1f3)](_0x458431)[_0x11da99(0x1bf)](async _0x41af4e=>{var _0x3f0d82=_0x11da99;try{for(const _0x4d0186 of _0x41af4e){await _0x4d0186['save']();}_0x3daba8['finalize']=_0x3f0d82(0x264);const _0x33d2c7=await _0x3daba8['save'](),_0x2244ac=await master_shop[_0x3f0d82(0x1ba)](),_0x55e39f=await email_settings[_0x3f0d82(0x208)](),_0x138d6a=await supervisor_settings[_0x3f0d82(0x1ba)]();var _0x997bc6=_0x3daba8[_0x3f0d82(0x216)],_0x541c32='',_0x14d680;for(_0x14d680 in _0x997bc6){_0x541c32+=_0x3f0d82(0x285)+_0x3f0d82(0x24e)+_0x997bc6[_0x14d680][_0x3f0d82(0x290)]+_0x3f0d82(0x260)+_0x3f0d82(0x24e)+_0x997bc6[_0x14d680][_0x3f0d82(0x225)]+_0x3f0d82(0x260)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x997bc6[_0x14d680][_0x3f0d82(0x2a3)]+_0x3f0d82(0x260)+_0x3f0d82(0x24e)+_0x997bc6[_0x14d680][_0x3f0d82(0x1fa)]+_0x3f0d82(0x260)+_0x3f0d82(0x24e)+_0x997bc6[_0x14d680][_0x3f0d82(0x26a)]+_0x3f0d82(0x260)+_0x3f0d82(0x24e)+_0x3daba8[_0x3f0d82(0x245)]+_0x3f0d82(0x260)+_0x3f0d82(0x24e)+_0x997bc6[_0x14d680]['room_name']+_0x3f0d82(0x260)+_0x3f0d82(0x24e)+_0x997bc6[_0x14d680][_0x3f0d82(0x2a6)]+_0x997bc6[_0x14d680][_0x3f0d82(0x214)]+_0x997bc6[_0x14d680][_0x3f0d82(0x261)]+_0x997bc6[_0x14d680]['bin']+_0x997bc6[_0x14d680]['type'][0x0]+_0x997bc6[_0x14d680]['floorlevel']+'</td>',_0x3f0d82(0x280);}let _0x20a1d2=nodemailer['createTransport']({'host':_0x55e39f[_0x3f0d82(0x2a8)],'port':Number(_0x55e39f[_0x3f0d82(0x207)]),'secure':![],'auth':{'user':_0x55e39f[_0x3f0d82(0x1fd)],'pass':_0x55e39f['password']}}),_0x364e98={'from':_0x55e39f[_0x3f0d82(0x1fd)],'to':_0x138d6a[0x0]['RMSEmail'],'subject':_0x3f0d82(0x1a0),'attachments':[{'filename':_0x3f0d82(0x25f),'path':__dirname+_0x3f0d82(0x1c4)+_0x3f0d82(0x1d8)+_0x2244ac[0x0][_0x3f0d82(0x1ac)],'cid':_0x3f0d82(0x29b)}],'html':_0x3f0d82(0x1e9)+_0x3f0d82(0x227)+'</head><body>'+_0x3f0d82(0x278)+_0x3f0d82(0x2aa)+_0x3f0d82(0x278)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x3f0d82(0x278)+_0x3f0d82(0x283)+_0x2244ac[0x0][_0x3f0d82(0x211)]+_0x3f0d82(0x1e6)+'</div>'+_0x3f0d82(0x275)+_0x3f0d82(0x289)+_0x3f0d82(0x278)+_0x3f0d82(0x21d)+'\x20Order\x20Number\x20:\x20'+_0x3daba8[_0x3f0d82(0x28d)]+'\x20'+_0x3f0d82(0x294)+'\x20Order\x20Date\x20:\x20'+_0x3daba8[_0x3f0d82(0x1a6)]+'\x20'+_0x3f0d82(0x1b6)+'</h5>'+_0x3f0d82(0x275)+_0x3f0d82(0x1dc)+_0x3f0d82(0x28c)+_0x3f0d82(0x285)+_0x3f0d82(0x215)+_0x3f0d82(0x1e4)+_0x3f0d82(0x29e)+_0x3f0d82(0x292)+_0x3f0d82(0x234)+_0x3f0d82(0x1c6)+_0x3f0d82(0x1bb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x3f0d82(0x240)+_0x3f0d82(0x1ea)+'\x20'+_0x541c32+'\x20'+'</tbody>'+_0x3f0d82(0x28b)+'<div>'+_0x3f0d82(0x263)+_0x3f0d82(0x19f)+_0x2244ac[0x0]['site_title']+'</h5>'+_0x3f0d82(0x275)+_0x3f0d82(0x275)+_0x3f0d82(0x1f5)};_0x20a1d2['sendMail'](_0x364e98,function(_0x5e1140,_0x449b1f){var _0x2d002b=_0x3f0d82;_0x5e1140?(console[_0x2d002b(0x1de)](_0x5e1140),console[_0x2d002b(0x1de)]('Error\x20Occurs')):console[_0x2d002b(0x1de)]('Email\x20sent\x20successfully');}),_0x17da20[_0x3f0d82(0x24b)](_0x3f0d82(0x25b),_0x3f0d82(0x262)),_0x520ee5['redirect'](_0x3f0d82(0x26d)+_0x8b93d0);}catch(_0x400ccb){console[_0x3f0d82(0x21c)](_0x400ccb),_0x520ee5[_0x3f0d82(0x241)](0x1f4)[_0x3f0d82(0x24d)]({'error':_0x3f0d82(0x1e1)});}})[_0x11da99(0x1f9)](_0x1a8d10=>{var _0x552260=_0x11da99;console[_0x552260(0x21c)](_0x1a8d10),_0x520ee5[_0x552260(0x241)](0x1f4)[_0x552260(0x24d)]({'error':'An\x20error\x20occurred.'});});}catch(_0x368fa7){console[_0x11da99(0x1de)](_0x368fa7);}}),router[a0_0x3b246f(0x210)](a0_0x3b246f(0x1eb),auth,async(_0x25ab17,_0x35e56f)=>{var _0x2cb00d=a0_0x3b246f;try{const {username:_0x2c7a3e,email:_0x15e291,role:_0x30de74}=_0x25ab17[_0x2cb00d(0x218)],_0x2d2d54=_0x25ab17[_0x2cb00d(0x218)],_0x4932d3=await profile[_0x2cb00d(0x208)]({'email':_0x2d2d54[_0x2cb00d(0x1fd)]}),_0x31d882=await master_shop[_0x2cb00d(0x1ba)](),_0x285d94=_0x25ab17[_0x2cb00d(0x1a7)]['id'],_0x2d5d08=await sales['findById'](_0x285d94);var _0x5132c9=[_0x2cb00d(0x1a3),'Enclosed'];const _0x41ea49=await warehouse[_0x2cb00d(0x1fe)]([{'$match':{'name':_0x2d5d08[_0x2cb00d(0x245)],'warehouse_category':_0x2cb00d(0x26c)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2cb00d(0x254)},'bay':{'$first':_0x2cb00d(0x247)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x2cb00d(0x21b)},'floorlevel':{'$first':_0x2cb00d(0x1b2)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2cb00d(0x291)},'product_code':{'$first':_0x2cb00d(0x1d5)},'storage':{'$first':_0x2cb00d(0x1e0)},'rack':{'$first':_0x2cb00d(0x1c9)}}}]),_0xf22283=await customer['find']({});let _0x3d403d;if(_0x2d2d54[_0x2cb00d(0x25a)]==_0x2cb00d(0x26b)){const _0x7a9e87=await staff[_0x2cb00d(0x208)]({'email':_0x2d2d54['email']});_0x3d403d=await warehouse[_0x2cb00d(0x1fe)]([{'$match':{'status':_0x2cb00d(0x1ee),'name':_0x7a9e87[_0x2cb00d(0x235)],'warehouse_category':_0x2cb00d(0x26c)}},{'$group':{'_id':_0x2cb00d(0x25c),'name':{'$first':_0x2cb00d(0x25c)}}}]);}else _0x3d403d=await warehouse[_0x2cb00d(0x1fe)]([{'$match':{'status':_0x2cb00d(0x1ee),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x2cb00d(0x25c)}}}]);const _0x54ae4f=await product['find']({});if(_0x31d882[0x0][_0x2cb00d(0x20a)]==_0x2cb00d(0x248)){var _0x382357=users[_0x2cb00d(0x246)];console['log'](_0x382357);}else{if(_0x31d882[0x0][_0x2cb00d(0x20a)]=='Hindi')var _0x382357=users[_0x2cb00d(0x1b5)];else{if(_0x31d882[0x0][_0x2cb00d(0x20a)]==_0x2cb00d(0x1ff))var _0x382357=users['German'];else{if(_0x31d882[0x0][_0x2cb00d(0x20a)]=='Spanish')var _0x382357=users['Spanish'];else{if(_0x31d882[0x0][_0x2cb00d(0x20a)]=='French')var _0x382357=users[_0x2cb00d(0x1d6)];else{if(_0x31d882[0x0]['language']==_0x2cb00d(0x1ae))var _0x382357=users['Portuguese'];else{if(_0x31d882[0x0][_0x2cb00d(0x20a)]==_0x2cb00d(0x29f))var _0x382357=users[_0x2cb00d(0x29f)];else{if(_0x31d882[0x0]['language']==_0x2cb00d(0x231))var _0x382357=users['Arabic'];}}}}}}}_0x35e56f[_0x2cb00d(0x2a7)](_0x2cb00d(0x25d),{'success':_0x25ab17[_0x2cb00d(0x24b)](_0x2cb00d(0x25b)),'errors':_0x25ab17[_0x2cb00d(0x24b)](_0x2cb00d(0x286)),'role':_0x2d2d54,'profile':_0x4932d3,'customer':_0xf22283,'warehouse':_0x3d403d,'product':_0x41ea49,'user':_0x2d5d08,'master_shop':_0x31d882,'unit':_0x54ae4f,'language':_0x382357});}catch(_0x10e03b){console['log'](_0x10e03b);}}),router[a0_0x3b246f(0x22c)](a0_0x3b246f(0x1eb),auth,async(_0x2a5793,_0x62d24a)=>{var _0x3bcbc0=a0_0x3b246f;try{const _0x5a1b38=_0x2a5793['params']['id'],_0x218e7c=await sales['findOne']({'_id':_0x2a5793[_0x3bcbc0(0x1a7)]['id']}),_0x111b12=await warehouse[_0x3bcbc0(0x208)]({'name':_0x218e7c[_0x3bcbc0(0x245)],'room':_0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x232)]}),{invoice:_0x2c4024,date:_0x4345f9,warehouse_name:_0x4a4930,product_name:_0x4cb77c,stock:_0x3048a4,quantity:_0x4a1298,note:_0x36138d,room:_0x28fdb5,customer:_0x228ded,SCRN:_0x425a80}=_0x2a5793[_0x3bcbc0(0x1d2)];if(typeof _0x4cb77c==_0x3bcbc0(0x1c5))var _0x92cffb=[_0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x290)]],_0x26a3db=[_0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x1ca)]],_0x2be4f8=[_0x2a5793[_0x3bcbc0(0x1d2)]['carton']],_0x266d89=[_0x2a5793[_0x3bcbc0(0x1d2)]['primary_code']],_0x208182=[_0x2a5793['body'][_0x3bcbc0(0x1ad)]],_0x3ae0b4=[_0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x2a0)]],_0x1870be=[_0x2a5793['body'][_0x3bcbc0(0x1e8)]],_0x9d7d2e=[_0x2a5793['body'][_0x3bcbc0(0x219)]],_0x1eff2b=[_0x2a5793['body'][_0x3bcbc0(0x26a)]],_0x2c31d3=[_0x2a5793['body'][_0x3bcbc0(0x1f4)]],_0x510668=[_0x2a5793[_0x3bcbc0(0x1d2)]['expiry_date']],_0xf63134=[_0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x265)]],_0x357c9b=[_0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x22e)]],_0x25e9be=[_0x2a5793['body'][_0x3bcbc0(0x2a9)]],_0x5297d7=[_0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x1d9)]],_0x3adf3a=[_0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x271)]],_0x3e512b=[_0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x272)]],_0x4f1d97=[_0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x2a3)]],_0x5be147=[_0x2a5793[_0x3bcbc0(0x1d2)]['RoomAssigned']];else var _0x92cffb=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x290)]],_0x26a3db=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x1ca)]],_0x2be4f8=[..._0x2a5793['body']['carton']],_0x266d89=[..._0x2a5793[_0x3bcbc0(0x1d2)]['primary_code']],_0x208182=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x1ad)]],_0x3ae0b4=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x2a0)]],_0x1870be=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x1e8)]],_0x9d7d2e=[..._0x2a5793[_0x3bcbc0(0x1d2)]['primary_unit']],_0x1eff2b=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x26a)]],_0x2c31d3=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x1f4)]],_0x510668=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x256)]],_0xf63134=[..._0x2a5793['body']['max_per_unit']],_0x357c9b=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x22e)]],_0x25e9be=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x2a9)]],_0x5297d7=[..._0x2a5793['body'][_0x3bcbc0(0x1d9)]],_0x3adf3a=[..._0x2a5793[_0x3bcbc0(0x1d2)]['delivery_code']],_0x3e512b=[..._0x2a5793[_0x3bcbc0(0x1d2)][_0x3bcbc0(0x272)]],_0x4f1d97=[..._0x2a5793[_0x3bcbc0(0x1d2)]['quantity']],_0x5be147=[..._0x2a5793['body'][_0x3bcbc0(0x1dd)]];const _0x51b58b=_0x92cffb[_0x3bcbc0(0x1db)](_0x7be9b9=>{return _0x7be9b9={'product_name':_0x7be9b9};});_0x26a3db[_0x3bcbc0(0x201)]((_0x2270ad,_0x4a808a)=>{_0x51b58b[_0x4a808a]['stock']=Math['abs'](_0x2270ad);}),_0x2be4f8[_0x3bcbc0(0x201)]((_0x12b3b7,_0x4004d0)=>{var _0x474e58=_0x3bcbc0;_0x51b58b[_0x4004d0][_0x474e58(0x2a3)]=_0x12b3b7;}),_0x266d89['forEach']((_0x2cdb39,_0x1d3243)=>{var _0x53e662=_0x3bcbc0;_0x51b58b[_0x1d3243][_0x53e662(0x1a8)]=_0x2cdb39;}),_0x208182[_0x3bcbc0(0x201)]((_0x27c754,_0xc1da12)=>{var _0x41061e=_0x3bcbc0;_0x51b58b[_0xc1da12][_0x41061e(0x1ad)]=_0x27c754;}),_0x3ae0b4[_0x3bcbc0(0x201)]((_0x362200,_0x33518f)=>{var _0x1796c0=_0x3bcbc0;_0x51b58b[_0x33518f][_0x1796c0(0x225)]=_0x362200;}),_0x1870be[_0x3bcbc0(0x201)]((_0x20fff8,_0x59f292)=>{var _0xe42b91=_0x3bcbc0;_0x5be147[_0xe42b91(0x201)]((_0x382cc4,_0x398e90)=>{var _0x3b6e76=_0xe42b91;if(_0x382cc4==_0x3b6e76(0x23d)&&_0x59f292==_0x398e90){var _0x479ecc=_0x20fff8[_0x3b6e76(0x249)](0x3);_0x51b58b[_0x59f292]['storage']=_0x20fff8[0x0],_0x51b58b[_0x59f292][_0x3b6e76(0x214)]=_0x20fff8[0x1],_0x51b58b[_0x59f292][_0x3b6e76(0x261)]=0x0,_0x51b58b[_0x59f292]['bin']=0x0,_0x51b58b[_0x59f292][_0x3b6e76(0x1e5)]=_0x3b6e76(0x1cb),_0x51b58b[_0x59f292]['floorlevel']=_0x479ecc;}else{if(_0x382cc4==_0x3b6e76(0x1a2)&&_0x59f292==_0x398e90){var _0x479ecc=_0x20fff8['slice'](0x3);_0x51b58b[_0x59f292][_0x3b6e76(0x2a6)]=_0x20fff8[0x0],_0x51b58b[_0x59f292]['rack']=_0x20fff8[0x1],_0x51b58b[_0x59f292][_0x3b6e76(0x261)]=0x0,_0x51b58b[_0x59f292]['bin']=0x0,_0x51b58b[_0x59f292]['type']=_0x3b6e76(0x1cb),_0x51b58b[_0x59f292]['floorlevel']=_0x20fff8[0x5];}else{if(_0x59f292==_0x398e90){var _0xb7f979;if(_0x20fff8[0x4]=='L')_0xb7f979=_0x3b6e76(0x299);else _0x20fff8[0x4]=='F'&&(_0xb7f979=_0x3b6e76(0x1cb));_0x51b58b[_0x59f292][_0x3b6e76(0x2a6)]=_0x20fff8[0x0],_0x51b58b[_0x59f292]['rack']=_0x20fff8[0x1],_0x51b58b[_0x59f292]['bay']=_0x20fff8[0x2],_0x51b58b[_0x59f292][_0x3b6e76(0x1c3)]=_0x20fff8[0x3],_0x51b58b[_0x59f292][_0x3b6e76(0x1e5)]=_0xb7f979,_0x51b58b[_0x59f292][_0x3b6e76(0x1e2)]=_0x20fff8[0x5];}}}});}),_0x9d7d2e[_0x3bcbc0(0x201)]((_0x5e3d38,_0x39a362)=>{var _0xe7ebcf=_0x3bcbc0;_0x51b58b[_0x39a362][_0xe7ebcf(0x1fa)]=_0x5e3d38;}),_0x1eff2b[_0x3bcbc0(0x201)]((_0xd08549,_0x5332dc)=>{_0x51b58b[_0x5332dc]['secondary_unit']=_0xd08549;}),_0x2c31d3[_0x3bcbc0(0x201)]((_0x5e42a8,_0x589046)=>{var _0x112fb4=_0x3bcbc0;_0x51b58b[_0x589046][_0x112fb4(0x1f4)]=_0x5e42a8;}),_0x510668['forEach']((_0x115633,_0x1c65da)=>{var _0x20ffe3=_0x3bcbc0;_0x51b58b[_0x1c65da][_0x20ffe3(0x256)]=_0x115633;}),_0xf63134[_0x3bcbc0(0x201)]((_0x53a878,_0x93bf5c)=>{var _0x18105e=_0x3bcbc0;_0x51b58b[_0x93bf5c][_0x18105e(0x1b4)]=_0x53a878;}),_0x357c9b[_0x3bcbc0(0x201)]((_0x1d25c0,_0x20997b)=>{_0x51b58b[_0x20997b]['production_date']=_0x1d25c0;}),_0x25e9be['forEach']((_0x21a910,_0x4ee98e)=>{var _0xe18649=_0x3bcbc0;_0x51b58b[_0x4ee98e][_0xe18649(0x2a9)]=Math[_0xe18649(0x29a)](_0x21a910);}),_0x5297d7['forEach']((_0x5f521b,_0x33346b)=>{var _0x1e50d3=_0x3bcbc0;_0x51b58b[_0x33346b][_0x1e50d3(0x1d9)]=_0x5f521b;}),_0x3adf3a['forEach']((_0x2ab29a,_0x1498f1)=>{var _0x20de08=_0x3bcbc0;_0x51b58b[_0x1498f1][_0x20de08(0x271)]=_0x2ab29a;}),_0x3e512b['forEach']((_0x307638,_0x108c5c)=>{var _0x41cc09=_0x3bcbc0;_0x51b58b[_0x108c5c][_0x41cc09(0x272)]=_0x307638;}),_0x4f1d97[_0x3bcbc0(0x201)]((_0x2f1612,_0x200f34)=>{_0x51b58b[_0x200f34]['quantity_notConverted']=_0x2f1612;}),_0x5be147[_0x3bcbc0(0x201)]((_0x163763,_0x111b4c)=>{var _0x313573=_0x3bcbc0;_0x51b58b[_0x111b4c][_0x313573(0x1b8)]=_0x163763;});var _0x4f9edb=0x0;_0x51b58b[_0x3bcbc0(0x201)](_0x1b0076=>{var _0x1d9add=_0x3bcbc0;console[_0x1d9add(0x1de)](_0x1d9add(0x217),_0x1b0076),(parseInt(_0x1b0076[_0x1d9add(0x1ca)])<parseInt(_0x1b0076['quantity'])||parseInt(_0x1b0076[_0x1d9add(0x2a3)])==0x0)&&_0x4f9edb++;});if(_0x4f9edb!=0x0)return _0x2a5793[_0x3bcbc0(0x24b)](_0x3bcbc0(0x286),_0x3bcbc0(0x22f)),_0x62d24a['redirect'](_0x3bcbc0(0x209));const _0x112db0=_0x51b58b[_0x3bcbc0(0x1be)](_0x5472a5=>_0x5472a5[_0x3bcbc0(0x2a3)]!=='0'&&_0x5472a5[_0x3bcbc0(0x2a3)]!=='');_0x218e7c[_0x3bcbc0(0x28d)]=_0x2c4024,_0x218e7c[_0x3bcbc0(0x1f2)]=_0x228ded,_0x218e7c['date']=_0x4345f9,_0x218e7c[_0x3bcbc0(0x245)]=_0x4a4930,_0x218e7c[_0x3bcbc0(0x216)]=_0x112db0,_0x218e7c[_0x3bcbc0(0x28e)]=_0x36138d,_0x218e7c[_0x3bcbc0(0x1f0)]=_0x425a80,_0x218e7c['finalize']=_0x3bcbc0(0x203),_0x218e7c['isAllowEdit']='False';const _0x3bbd1e=await _0x218e7c[_0x3bcbc0(0x1d0)]();_0x2a5793[_0x3bcbc0(0x24b)](_0x3bcbc0(0x25b),_0x3bcbc0(0x262)),_0x62d24a[_0x3bcbc0(0x282)](_0x3bcbc0(0x21a));}catch(_0x391966){console[_0x3bcbc0(0x1de)](_0x391966);}}),router[a0_0x3b246f(0x22c)](a0_0x3b246f(0x229),auth,async(_0x410e6e,_0x5c3eac)=>{var _0x17cc3b=a0_0x3b246f;try{const _0x11620f=_0x410e6e[_0x17cc3b(0x1a7)]['id'],{invoice:_0x4725ee,customer:_0x3e45d5,receivable_amount:_0x27c05e,received_amount:_0x396d74}=_0x410e6e[_0x17cc3b(0x1d2)],_0x5394b1=await sales[_0x17cc3b(0x222)](_0x11620f);console[_0x17cc3b(0x1de)](_0x5394b1);var _0x43a2b2=_0x27c05e-_0x396d74;console[_0x17cc3b(0x1de)](_0x396d74),_0x5394b1[_0x17cc3b(0x204)]=parseFloat(_0x396d74)+parseFloat(_0x5394b1['received_amount']),_0x5394b1['due_amount']=_0x43a2b2,console[_0x17cc3b(0x1de)](_0x5394b1);const _0x47a0ef=await _0x5394b1[_0x17cc3b(0x1d0)](),_0x206cdd=await c_payment_data['findOne']({'invoice':_0x4725ee});_0x206cdd['amount']=_0x43a2b2,await _0x206cdd[_0x17cc3b(0x1d0)]();let _0x525549=new Date(),_0xa335b2=('0'+_0x525549[_0x17cc3b(0x226)]())[_0x17cc3b(0x249)](-0x2),_0x38f8e4=('0'+(_0x525549[_0x17cc3b(0x1d4)]()+0x1))[_0x17cc3b(0x249)](-0x2),_0x2554f2=_0x525549[_0x17cc3b(0x230)](),_0x13b69d=_0x2554f2+'-'+_0x38f8e4+'-'+_0xa335b2;const _0x170a89=new customer_payment({'invoice':_0x4725ee,'date':_0x2554f2+'-'+_0x38f8e4+'-'+_0xa335b2,'customer':_0x3e45d5,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x396d74}),_0x2a38e7=await _0x170a89[_0x17cc3b(0x1d0)]();_0x410e6e[_0x17cc3b(0x24b)]('success',_0x17cc3b(0x1fb)),_0x5c3eac[_0x17cc3b(0x282)](_0x17cc3b(0x21a));}catch(_0x5b75ac){console[_0x17cc3b(0x1de)](_0x5b75ac);}}),router[a0_0x3b246f(0x210)](a0_0x3b246f(0x26e),auth,async(_0x5ba000,_0x4ddf0f)=>{var _0x57d145=a0_0x3b246f;try{const {username:_0x334f74,email:_0x3f84cb,role:_0x453232}=_0x5ba000['user'],_0x5e3ee2=_0x5ba000[_0x57d145(0x218)],_0x451e57=await profile['findOne']({'email':_0x5e3ee2[_0x57d145(0x1fd)]}),_0x184ee1=await master_shop[_0x57d145(0x1ba)]();console['log'](_0x57d145(0x24a),_0x184ee1);const _0x20e40f=_0x5ba000[_0x57d145(0x1a7)]['id'],_0x1e976b=await sales[_0x57d145(0x222)](_0x20e40f);console['log'](_0x1e976b);const _0x2e7172=await customer[_0x57d145(0x208)]({'name':_0x1e976b[_0x57d145(0x1f2)]});console[_0x57d145(0x1de)](_0x2e7172);if(_0x184ee1[0x0][_0x57d145(0x20a)]==_0x57d145(0x248)){var _0x3667f4=users[_0x57d145(0x246)];console[_0x57d145(0x1de)](_0x3667f4);}else{if(_0x184ee1[0x0]['language']==_0x57d145(0x1b5))var _0x3667f4=users[_0x57d145(0x1b5)];else{if(_0x184ee1[0x0][_0x57d145(0x20a)]=='German')var _0x3667f4=users['German'];else{if(_0x184ee1[0x0][_0x57d145(0x20a)]==_0x57d145(0x200))var _0x3667f4=users[_0x57d145(0x200)];else{if(_0x184ee1[0x0][_0x57d145(0x20a)]=='French')var _0x3667f4=users[_0x57d145(0x1d6)];else{if(_0x184ee1[0x0][_0x57d145(0x20a)]=='Portuguese\x20(BR)')var _0x3667f4=users['Portuguese'];else{if(_0x184ee1[0x0][_0x57d145(0x20a)]==_0x57d145(0x29f))var _0x3667f4=users[_0x57d145(0x29f)];else{if(_0x184ee1[0x0][_0x57d145(0x20a)]==_0x57d145(0x231))var _0x3667f4=users['Arabic'];}}}}}}}_0x4ddf0f['render'](_0x57d145(0x24c),{'success':_0x5ba000[_0x57d145(0x24b)](_0x57d145(0x25b)),'errors':_0x5ba000[_0x57d145(0x24b)]('errors'),'role':_0x5e3ee2,'profile':_0x451e57,'master_shop':_0x184ee1,'customers':_0x2e7172,'sales':_0x1e976b,'language':_0x3667f4});}catch(_0x11d2f7){console[_0x57d145(0x1de)](_0x11d2f7);}}),router[a0_0x3b246f(0x210)](a0_0x3b246f(0x257),auth,async(_0x3cccfb,_0xb92653)=>{var _0x213857=a0_0x3b246f;try{const {username:_0x3dce13,email:_0x30ee56,role:_0x2556bf}=_0x3cccfb[_0x213857(0x218)],_0x5e5b54=_0x3cccfb['user'],_0x42b8c4=await profile[_0x213857(0x208)]({'email':_0x5e5b54[_0x213857(0x1fd)]}),_0x533926=await master_shop['find']();console['log'](_0x213857(0x24a),_0x533926);const _0x518758=_0x3cccfb[_0x213857(0x1a7)]['id'];console[_0x213857(0x1de)](_0x518758);const _0x303806=await sales[_0x213857(0x222)](_0x518758);console['log'](_0x213857(0x27b),_0x303806);const _0x2e0bc4=await warehouse[_0x213857(0x1fe)]([{'$match':{'name':_0x213857(0x28f),'room':_0x213857(0x228)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x213857(0x266),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x213857(0x243)},'isle':{'$first':_0x213857(0x221)},'pallet':{'$first':_0x213857(0x1c2)},'primary_code':{'$first':_0x213857(0x1f7)},'secondary_code':{'$first':_0x213857(0x291)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x213857(0x1de)]('stock_data',_0x2e0bc4);const _0x58eb00=await product[_0x213857(0x1ba)]({});warehouse_data=await warehouse[_0x213857(0x1fe)]([{'$match':{'status':_0x213857(0x1ee),'name':_0x213857(0x28f),'warehouse_category':_0x213857(0x26c)}},{'$group':{'_id':_0x213857(0x25c),'name':{'$first':_0x213857(0x25c)}}},{'$sort':{'name':0x1}}]);var _0x122796=[_0x213857(0x228)];if(_0x533926[0x0][_0x213857(0x20a)]==_0x213857(0x248)){var _0x42314f=users[_0x213857(0x246)];console[_0x213857(0x1de)](_0x42314f);}else{if(_0x533926[0x0][_0x213857(0x20a)]==_0x213857(0x1b5))var _0x42314f=users[_0x213857(0x1b5)];else{if(_0x533926[0x0][_0x213857(0x20a)]==_0x213857(0x1ff))var _0x42314f=users[_0x213857(0x1ff)];else{if(_0x533926[0x0][_0x213857(0x20a)]=='Spanish')var _0x42314f=users[_0x213857(0x200)];else{if(_0x533926[0x0][_0x213857(0x20a)]==_0x213857(0x1d6))var _0x42314f=users['French'];else{if(_0x533926[0x0][_0x213857(0x20a)]==_0x213857(0x1ae))var _0x42314f=users[_0x213857(0x1cc)];else{if(_0x533926[0x0][_0x213857(0x20a)]==_0x213857(0x29f))var _0x42314f=users[_0x213857(0x29f)];else{if(_0x533926[0x0]['language']==_0x213857(0x231))var _0x42314f=users[_0x213857(0x1b0)];}}}}}}}_0xb92653[_0x213857(0x2a7)](_0x213857(0x237),{'success':_0x3cccfb[_0x213857(0x24b)](_0x213857(0x25b)),'errors':_0x3cccfb[_0x213857(0x24b)]('errors'),'role':_0x5e5b54,'profile':_0x42b8c4,'user':_0x303806,'stock':_0x2e0bc4,'master_shop':_0x533926,'unit':_0x58eb00,'language':_0x42314f,'warehouses':warehouse_data,'rooms':_0x122796});}catch(_0x33ca06){console[_0x213857(0x1de)](_0x33ca06),_0xb92653[_0x213857(0x241)](0xc8)[_0x213857(0x24d)]({'message':_0x33ca06[_0x213857(0x20e)]});}}),router[a0_0x3b246f(0x22c)](a0_0x3b246f(0x257),auth,async(_0x4c0204,_0x254638)=>{var _0xd35dee=a0_0x3b246f;try{const {invoice:_0x475235,date:_0x28d44c,warehouse_name:_0x3d4506,product_name:_0x255185,primary_code:_0x173a8a,secondary_code:_0x247062,product_code:_0x357e4b,sales_quantity:_0x2ee412,stocks:_0x1a73f0,return_qty:_0x4ebac6,Room_name:_0x41d4d9,to_warehouse_name:_0x303101,to_Roomname:_0x287cee,to_Room_name:_0xb9469b,note:_0x35f2c3,level:_0x521f38,isle:_0x4117c2,pallet:_0xe5cea5}=_0x4c0204['body'];if(typeof _0x255185==_0xd35dee(0x1c5))var _0x532fe7=[_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x290)]],_0x52eaef=[_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1a8)]],_0x5aef5a=[_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1ad)]],_0x5d0628=[_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x225)]],_0x648a52=[_0x4c0204['body']['sales_quantity']],_0x4edba4=[_0x4c0204['body'][_0xd35dee(0x24f)]],_0x33778e=[_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1c8)]],_0x168842=[_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x261)]],_0x198d75=[_0x4c0204['body'][_0xd35dee(0x1c3)]],_0x5dfe6d=[_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1c7)]],_0x331975=[_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1e2)]];else var _0x532fe7=[..._0x4c0204['body'][_0xd35dee(0x290)]],_0x52eaef=[..._0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1a8)]],_0x5aef5a=[..._0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1ad)]],_0x5d0628=[..._0x4c0204['body'][_0xd35dee(0x225)]],_0x648a52=[..._0x4c0204[_0xd35dee(0x1d2)]['sales_quantity']],_0x4edba4=[..._0x4c0204['body'][_0xd35dee(0x24f)]],_0x33778e=[..._0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1c8)]],_0x168842=[..._0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x261)]],_0x198d75=[..._0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1c3)]],_0x5dfe6d=[..._0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1c7)]],_0x331975=[..._0x4c0204[_0xd35dee(0x1d2)]['floorlevel']];const _0x4cdedf=_0x532fe7[_0xd35dee(0x1db)](_0x4603aa=>{return _0x4603aa={'product_name':_0x4603aa};});_0x52eaef['forEach']((_0x3ee642,_0x434e53)=>{var _0x3864b1=_0xd35dee;_0x4cdedf[_0x434e53][_0x3864b1(0x1a8)]=_0x3ee642;}),_0x5aef5a[_0xd35dee(0x201)]((_0x26a4ac,_0x1bc043)=>{_0x4cdedf[_0x1bc043]['secondary_code']=_0x26a4ac;}),_0x5d0628['forEach']((_0x32204d,_0x52409a)=>{var _0x2eacf0=_0xd35dee;_0x4cdedf[_0x52409a][_0x2eacf0(0x225)]=_0x32204d;}),_0x648a52[_0xd35dee(0x201)]((_0x387d12,_0x1c7224)=>{var _0xb52053=_0xd35dee;_0x4cdedf[_0x1c7224][_0xb52053(0x29c)]=_0x387d12;}),_0x4edba4[_0xd35dee(0x201)]((_0x443fd6,_0x507495)=>{var _0x3097dd=_0xd35dee;_0x4cdedf[_0x507495][_0x3097dd(0x1ca)]=_0x443fd6;}),_0x33778e[_0xd35dee(0x201)]((_0x427a81,_0xb77db)=>{_0x4cdedf[_0xb77db]['return_qty']=_0x427a81;}),_0x168842['forEach']((_0x4020c6,_0x234334)=>{var _0x1dadf2=_0xd35dee;_0x4cdedf[_0x234334][_0x1dadf2(0x261)]=_0x4020c6;}),_0x198d75['forEach']((_0x55940d,_0x57ef75)=>{_0x4cdedf[_0x57ef75]['bin']=_0x55940d;}),_0x5dfe6d[_0xd35dee(0x201)]((_0x5e9b29,_0x3c6bf8)=>{var _0x41b6c0=_0xd35dee;_0x4cdedf[_0x3c6bf8][_0x41b6c0(0x1e5)]=_0x5e9b29;}),_0x331975[_0xd35dee(0x201)]((_0x2fe8c3,_0x4ac1dc)=>{_0x4cdedf[_0x4ac1dc]['floorlevel']=_0x2fe8c3;});var _0xcf1ec=0x0;_0x4cdedf['forEach'](_0x4f0fc9=>{var _0x3d6d6e=_0xd35dee;console[_0x3d6d6e(0x1de)](_0x3d6d6e(0x217),_0x4f0fc9),(parseInt(_0x4f0fc9[_0x3d6d6e(0x29c)])<parseInt(_0x4f0fc9[_0x3d6d6e(0x1c8)])||parseInt(_0x4f0fc9[_0x3d6d6e(0x1ca)])<parseInt(_0x4f0fc9[_0x3d6d6e(0x1c8)])&&parseInt(_0x4f0fc9[_0x3d6d6e(0x29c)])>parseInt(_0x4f0fc9[_0x3d6d6e(0x1c8)])||parseInt(_0x4f0fc9[_0x3d6d6e(0x1c8)])==0x0)&&_0xcf1ec++;});if(_0xcf1ec!=0x0)return _0x4c0204[_0xd35dee(0x24b)](_0xd35dee(0x286),_0xd35dee(0x233)),_0x254638[_0xd35dee(0x282)](_0xd35dee(0x209));const _0x14309b=await sales[_0xd35dee(0x208)]({'invoice':_0x475235});console['log'](_0x14309b),_0x14309b[_0xd35dee(0x268)]=_0xd35dee(0x264);const _0x2d8c35=await _0x14309b['save'](),_0x2e0ce6=new sales_return({'invoice':_0x475235,'customer':_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1f2)],'date':_0x28d44c,'warehouse_name':_0x3d4506,'room':_0x41d4d9,'ToWarehouse':_0x303101,'ToRoom':_0xb9469b,'return_sale':_0x4cdedf,'note':_0x35f2c3}),_0x16b104=await _0x2e0ce6[_0xd35dee(0x1d0)]();console[_0xd35dee(0x1de)](_0x2e0ce6);const _0x2afe2c=await sales_return['findOne']({'invoice':_0x475235}),_0x6aad4=await warehouse['findOne']({'name':_0x303101,'room':_0xb9469b});_0x2afe2c['return_sale'][_0xd35dee(0x201)](_0x3548d8=>{var _0x366623=_0xd35dee,_0x4d1f70=0x0;const _0x8afa12=_0x6aad4[_0x366623(0x1a9)][_0x366623(0x1db)](_0x5858c4=>{var _0xd2aaff=_0x366623;_0x5858c4[_0xd2aaff(0x290)]==_0x3548d8['product_name']&&_0x5858c4[_0xd2aaff(0x1e2)]==_0x3548d8[_0xd2aaff(0x1e2)]&&_0x5858c4['type']==_0x3548d8[_0xd2aaff(0x1e5)]&&_0x5858c4[_0xd2aaff(0x1c3)]==_0x3548d8[_0xd2aaff(0x1c3)]&&_0x5858c4[_0xd2aaff(0x261)]==_0x3548d8[_0xd2aaff(0x261)]&&(_0x5858c4[_0xd2aaff(0x238)]=parseInt(_0x5858c4[_0xd2aaff(0x238)])+parseInt(_0x3548d8['return_qty']),_0x4d1f70++);});_0x4d1f70=='0'&&(_0x6aad4[_0x366623(0x1a9)]=_0x6aad4['product_details'][_0x366623(0x255)]({'product_name':_0x3548d8[_0x366623(0x290)],'product_stock':_0x3548d8[_0x366623(0x1c8)],'primary_code':_0x3548d8['primary_code'],'secondary_code':_0x3548d8[_0x366623(0x1ad)],'product_code':_0x3548d8['product_code'],'bay':_0x3548d8['bay'],'bin':_0x3548d8[_0x366623(0x1c3)],'type':_0x3548d8[_0x366623(0x1e5)],'floorlevel':_0x3548d8[_0x366623(0x1e2)]})),console[_0x366623(0x1de)](_0x366623(0x2a4),_0x6aad4);}),await _0x6aad4[_0xd35dee(0x1d0)](),console[_0xd35dee(0x1de)](_0x4c0204[_0xd35dee(0x1d2)]);const _0x248051=new c_payment_data({'invoice':_0x475235,'customer':_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1f2)],'reason':'Sale\x20Return'});await _0x248051[_0xd35dee(0x1d0)]();const _0x1a2f27=await master_shop[_0xd35dee(0x1ba)]();console[_0xd35dee(0x1de)]('add\x20post',_0x1a2f27[0x0][_0xd35dee(0x1ac)]);const _0x55af20=await email_settings[_0xd35dee(0x208)](),_0x5f29e5=await customer[_0xd35dee(0x208)]({'name':_0x4c0204[_0xd35dee(0x1d2)][_0xd35dee(0x1f2)]});console['log']('customer_data',_0x5f29e5);_0x1a2f27[0x0]['currency_placement']==0x1?(right_currency=_0x1a2f27[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1a2f27[0x0]['currency']);var _0x240d8a=_0x532fe7,_0xc2fd88=_0x33778e,_0x180252='',_0x323eb5;for(_0x323eb5 in _0x240d8a){_0x180252+=_0xd35dee(0x285)+_0xd35dee(0x24e)+_0x240d8a[_0x323eb5]+_0xd35dee(0x260)+_0xd35dee(0x24e)+_0xc2fd88[_0x323eb5]+_0xd35dee(0x260)+_0xd35dee(0x280);}console[_0xd35dee(0x1de)]('product_list',_0x180252);let _0x5e3fe8=nodemailer[_0xd35dee(0x1e3)]({'service':_0xd35dee(0x2a2),'auth':{'user':_0x55af20[_0xd35dee(0x1fd)],'pass':_0x55af20['password']}}),_0x180b3d={'from':_0x55af20[_0xd35dee(0x1fd)],'to':_0x5f29e5['email'],'subject':_0xd35dee(0x1af),'attachments':[{'filename':_0xd35dee(0x25f),'path':__dirname+'/../public'+_0xd35dee(0x1d8)+_0x1a2f27[0x0][_0xd35dee(0x1ac)],'cid':_0xd35dee(0x29b)}],'html':_0xd35dee(0x1e9)+_0xd35dee(0x227)+_0xd35dee(0x22a)+'<div>'+_0xd35dee(0x2aa)+_0xd35dee(0x278)+_0xd35dee(0x274)+_0xd35dee(0x275)+_0xd35dee(0x278)+_0xd35dee(0x283)+_0x1a2f27[0x0]['site_title']+'\x20</h2>'+_0xd35dee(0x275)+_0xd35dee(0x275)+_0xd35dee(0x289)+_0xd35dee(0x278)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0xd35dee(0x212)+_0x475235+'\x20'+_0xd35dee(0x294)+_0xd35dee(0x273)+_0x28d44c+'\x20'+_0xd35dee(0x1b6)+_0xd35dee(0x220)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xd35dee(0x28c)+'<tr>'+_0xd35dee(0x215)+_0xd35dee(0x1df)+_0xd35dee(0x202)+_0xd35dee(0x1d3)+_0xd35dee(0x280)+_0xd35dee(0x240)+_0xd35dee(0x1ea)+'\x20'+_0x180252+'\x20'+_0xd35dee(0x1fc)+_0xd35dee(0x28b)+_0xd35dee(0x278)+_0xd35dee(0x263)+_0xd35dee(0x19f)+_0x1a2f27[0x0]['site_title']+_0xd35dee(0x220)+_0xd35dee(0x275)+'</div>'+_0xd35dee(0x1f5)};_0x5e3fe8['sendMail'](_0x180b3d,function(_0x40b48a,_0x496c98){var _0x3589a3=_0xd35dee;_0x40b48a?(console[_0x3589a3(0x1de)](_0x40b48a),console[_0x3589a3(0x1de)](_0x3589a3(0x20c))):console['log'](_0x3589a3(0x2a1));}),_0x4c0204[_0xd35dee(0x24b)]('success',_0xd35dee(0x239)),_0x254638[_0xd35dee(0x282)](_0xd35dee(0x21a));}catch(_0x482427){console[_0xd35dee(0x1de)](_0x482427),_0x254638['status'](0xc8)[_0xd35dee(0x24d)]({'message1':_0x482427[_0xd35dee(0x20e)]});}}),router['get'](a0_0x3b246f(0x1ed),auth,async(_0x440844,_0x2a51ae)=>{var _0x41de1f=a0_0x3b246f;try{const {username:_0x40ac41,email:_0x4c0beb,role:_0x898b4b}=_0x440844[_0x41de1f(0x218)],_0x260d46=_0x440844['user'],_0x585ff9=await profile[_0x41de1f(0x208)]({'email':_0x260d46[_0x41de1f(0x1fd)]}),_0xeeef24=await master_shop[_0x41de1f(0x1ba)]();console[_0x41de1f(0x1de)](_0x41de1f(0x1a4),_0xeeef24);const _0x45cdfe=_0x440844[_0x41de1f(0x1a7)]['id'],_0x142a16=await sales[_0x41de1f(0x222)](_0x45cdfe);console[_0x41de1f(0x1de)]('barcode\x20user_id',_0x142a16);if(_0xeeef24[0x0][_0x41de1f(0x20a)]==_0x41de1f(0x248))var _0x262a5f=users['English'];else{if(_0xeeef24[0x0][_0x41de1f(0x20a)]=='Hindi')var _0x262a5f=users[_0x41de1f(0x1b5)];else{if(_0xeeef24[0x0][_0x41de1f(0x20a)]==_0x41de1f(0x1ff))var _0x262a5f=users[_0x41de1f(0x1ff)];else{if(_0xeeef24[0x0][_0x41de1f(0x20a)]==_0x41de1f(0x200))var _0x262a5f=users['Spanish'];else{if(_0xeeef24[0x0][_0x41de1f(0x20a)]=='French')var _0x262a5f=users[_0x41de1f(0x1d6)];else{if(_0xeeef24[0x0][_0x41de1f(0x20a)]==_0x41de1f(0x1ae))var _0x262a5f=users[_0x41de1f(0x1cc)];else{if(_0xeeef24[0x0]['language']==_0x41de1f(0x29f))var _0x262a5f=users[_0x41de1f(0x29f)];else{if(_0xeeef24[0x0][_0x41de1f(0x20a)]==_0x41de1f(0x231))var _0x262a5f=users[_0x41de1f(0x1b0)];}}}}}}}_0x2a51ae[_0x41de1f(0x2a7)](_0x41de1f(0x21f),{'success':_0x440844[_0x41de1f(0x24b)](_0x41de1f(0x25b)),'errors':_0x440844[_0x41de1f(0x24b)](_0x41de1f(0x286)),'role':_0x260d46,'profile':_0x585ff9,'alldata':_0x142a16,'master_shop':_0xeeef24,'language':_0x262a5f});}catch(_0x1d640d){console['log'](_0x1d640d);}}),router['post'](a0_0x3b246f(0x258),async(_0x53ed82,_0x5a49df)=>{var _0x23bc9e=a0_0x3b246f;const {product_code:_0x3ccc90,warehouse_name:_0x43b4f4,rooms_data:_0x242324,Roomslist:_0x4bd954}=_0x53ed82['body'],_0x4b120d=_0x4bd954[_0x23bc9e(0x1f6)](','),_0x990aa1=[];async function _0x215791(_0x51f44a){var _0x4e149f=_0x23bc9e;const _0x3987d8=await warehouse['aggregate']([{'$match':{'name':_0x43b4f4,'room':_0x51f44a}},{'$unwind':_0x4e149f(0x20d)},{'$match':{'product_details.primary_code':_0x3ccc90}},{'$group':{'_id':_0x4e149f(0x266),'name':{'$first':_0x4e149f(0x28a)},'product_stock':{'$first':_0x4e149f(0x254)},'primary_code':{'$first':_0x4e149f(0x1f7)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4e149f(0x1d5)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x4e149f(0x1ab)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x4e149f(0x252)},'storage':{'$first':_0x4e149f(0x1e0)},'rack':{'$first':_0x4e149f(0x1c9)},'expiry_date':{'$first':_0x4e149f(0x284)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x4e149f(0x1ec)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x4e149f(0x206)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4e149f(0x1a5)},'invoice':{'$first':_0x4e149f(0x250)},'actual_qty':{'$first':_0x4e149f(0x259)},'actual_uom':{'$first':_0x4e149f(0x1ce)}}}]),_0x402fd0=await warehouse[_0x4e149f(0x1fe)]([{'$match':{'name':_0x43b4f4,'room':_0x51f44a}},{'$unwind':_0x4e149f(0x20d)},{'$match':{'product_details.secondary_code':_0x3ccc90}},{'$group':{'_id':_0x4e149f(0x266),'name':{'$first':_0x4e149f(0x28a)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4e149f(0x291)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x4e149f(0x247)},'isle':{'$first':_0x4e149f(0x1ab)},'type':{'$first':_0x4e149f(0x21b)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x4e149f(0x20b)},'secondary_unit':{'$first':_0x4e149f(0x252)},'storage':{'$first':_0x4e149f(0x1e0)},'rack':{'$first':_0x4e149f(0x1c9)},'expiry_date':{'$first':_0x4e149f(0x284)},'production_date':{'$first':_0x4e149f(0x25e)},'maxPerUnit':{'$first':_0x4e149f(0x1ec)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x4e149f(0x1a5)},'invoice':{'$first':_0x4e149f(0x250)}}}]);if(_0x3987d8['length']>0x0)_0x990aa1['push'](_0x3987d8);else _0x402fd0[_0x4e149f(0x23a)]>0x0&&_0x990aa1[_0x4e149f(0x288)](_0x402fd0);}const _0x4b39b6=_0x4b120d[_0x23bc9e(0x1db)](_0x2ee89a=>_0x215791(_0x2ee89a));await Promise[_0x23bc9e(0x1f3)](_0x4b39b6),_0x5a49df['json'](_0x990aa1);}),module['exports']=router;function a0_0x198f(_0x5cfede,_0x43d7ca){var _0x4792b2=a0_0x4792();return a0_0x198f=function(_0x198f84,_0x5006db){_0x198f84=_0x198f84-0x19e;var _0x5c3966=_0x4792b2[_0x198f84];return _0x5c3966;},a0_0x198f(_0x5cfede,_0x43d7ca);}function a0_0x4792(){var _0x240c27=['Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','warehouse','/view/add_sales/:id','return_sale','product_stock','sales\x20item\x20return\x20successfull','length','15480vvhRSi','73672QEJctg','Receiving\x20Area','8935qLlLPc','$sale_product.type','</thead>','status','nodemailer','$product_details.level','There\x27s\x20a\x20error\x20in\x20this\x20transaction','warehouse_name','English','$product_details.bay','English\x20(US)','slice','master','flash','sales_invoice','json','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','stocks','$product_details.invoice','$sale_product.bay','$product_details.secondary_unit','$isAllowEdit','$product_details.product_stock','concat','expiry_date','/view/return_sales/:id','/barcode_scanner','$product_details.actual_qty','role','success','$name','edit_sales','$product_details.production_date','Logo.png','</td>','bay','Sales\x20Update\x20successfully','<strong>\x20Regards\x20</strong>','True','max_per_unit','$product_details._id','$product.product_name','return_data','$sale_product','secondary_unit','staff','Raw\x20Materials','/all_sales/preview/','/invoice/:id','actual_uom','edit_sales_view','delivery_code','prod_cat','\x20Order\x20Date\x20:\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</div>','$note','purchases_data','<div>','288tMGEHI','id_transaction_from','user_id','$return_data','/view/add_sales','$sale_product.quantity','$warehouse_name','</tr>','random','redirect','<h2>\x20','$product_details.expiry_date','<tr>','errors','name','push','<hr\x20class=\x22my-3\x22>','$product_details.product_name','</table>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','invoice','note','Return\x20Goods','product_name','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$customers_docs','<span\x20style=\x22float:\x20right;\x22>','quantity_notConverted','actual_qty','padStart','$_id','Level','abs','logo','sale_qty','1280036AOfjlm','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Chinese','prod_code','Email\x20sent\x20successfully','gmail','quantity','final','product_data','storage','render','host','requested_qty','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/preview/:id','sales\x20all_data','floor','Router','$invoice','<h5>','Sales\x20Mail','add_sales','Shelves','Ambient','barcode\x20Product\x20master','$room','date','params','primary_code','product_details','$finalize','$product_details.bin','image','secondary_code','Portuguese\x20(BR)','Sale\x20Return\x20Mail','Arabic','id_transact','$product_details.floorlevel','$sale_product.bin','maxperunit','Hindi','</span>','_id','room_name','222446DYoylX','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$date','OUT-','filter','then','1010136dyaGQM','prod_invoice','$product_details.pallet','bin','/../public','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','types','return_qty','$product_details.rack','stock','Floor','Portuguese','customers','$product_details.actual_uom','$sale_product.floorlevel','save','../public/language/languages.json','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','getMonth','$product_details.product_code','French','77MiDBjs','/upload/','delivery_date','/view/add_sale/product','map','<table\x20style=\x22width:\x20100%\x20!important;\x22>','RoomAssigned','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.storage','An\x20error\x20occurred\x20while\x20saving\x20data.','floorlevel','createTransport','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','type','\x20</h2>','1308456voCRbm','level','<!DOCTYPE\x20html>','<tbody\x20style=\x22text-align:\x20center;\x22>','/view/:id','$product_details.maxPerUnit','/barcode/:id','Enabled','66OFbPeT','SCRN','/view','customer','all','batch_code','</body></html>','split','$product_details.primary_code','express','catch','unit','payment\x20successfull','</tbody>','email','aggregate','German','Spanish','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','False','received_amount','Sales\x20Add\x20successfully','$product_details.product_cat','port','findOne','back','language','$product_details.unit','Error\x20Occurs','$product_details','message','stock_data','get','site_title','\x20Order\x20Number\x20:\x20','customers_docs','rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','sale_product','foreach\x20newproduct','user','primary_unit','/all_sales/view','$product_details.type','error','<h5\x20style=\x22text-align:\x20left;\x22>','$customer','all_sales_barcode','</h5>','$product_details.isle','findById','10yiwlIA','Enclosed','product_code','getDate','<html><head><title></title>','Return\x20Rooms','/give_payment/:id','</head><body>','24vbhecV','post','../middleware/auth','production_date','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','getFullYear','Arabic\x20(ae)','room'];a0_0x4792=function(){return _0x240c27;};return a0_0x4792();}