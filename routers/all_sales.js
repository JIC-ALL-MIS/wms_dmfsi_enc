function a0_0x3227(){var _0x220a15=['$product_details.primary_code','body','render','Enclosed','stock','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','get','645680qzUUgR','$product_details.invoice','\x20</h2>','status','$product_details.bay','received_amount','$product_details.type','redirect','padStart','carton','map','Hindi','2139424hnKuAU','/barcode/:id','return_sale','Raw\x20Materials','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','sale_qty','purchases_data','$product_details.rack','$product_details.batch_code','flash','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.storage','params','actual_qty','note','quantity_notConverted','English','$product_details.isle','Portuguese\x20(BR)','json','/view','</div>','</body></html>','</span>','/../public','$product_details.secondary_unit','Portuguese','post','Error\x20Occurs','errors','room_name','due_amount','</h5>','$product_details.unit','/view/add_sales/:id','filter','return_data','<h2>\x20','name','date','email','foreach\x20newproduct','createTransport','$product_details.product_code','/upload/','Sales\x20Update\x20successfully','secondary_unit','master','final','max_per_unit','$name','</thead>','success','$warehouse_name','concat','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product_name','$sale_product.floorlevel','7pFLVQE','then','all','$sale_product.bin','host','English\x20(US)','slice','$return_data','stock_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<!DOCTYPE\x20html>','sale_product','\x20Order\x20Number\x20:\x20','product_list','German','role','product_data','length','room','sales\x20all_data','prod_code','string','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','actual_uom','sales_quantity','expiry_date','$product_details.product_name','image','</td>','$product_details','getMonth','<h5>','catch','$product_details.secondary_code','error','edit_sales_view','An\x20error\x20occurred\x20while\x20saving\x20data.','customer','$isAllowEdit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','SCRN','abs','405545uhBzEk','\x20Order\x20Date\x20:\x20','split','user','</table>','stocks','requested_qty','Chinese','exports','Received\x20Payment\x20For\x20Sale','password','customers','edit_sales','<tbody\x20style=\x22text-align:\x20center;\x22>','Email\x20sent\x20successfully','return_qty','Sales\x20Add\x20successfully','$_id','all_sales','delivery_date','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$sale_product.type','$customer','save','Enabled','rack','<tr>','primary_unit','finalize','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.actual_uom','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$note','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$customers_docs','isAllowEdit','../public/language/languages.json','batch_code','sendMail','/all_sales/preview/','$product','invoice','/give_payment/:id','$product_details.maxPerUnit','../models/all_models','/preview/:id','delivery_code','product_details','add_sales','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','An\x20error\x20occurred.','Arabic\x20(ae)','Spanish','Sale\x20Return\x20Mail','/view/add_sales','/all_sales/view','2453FjbHFl','find','$product_details.product_cat','product_code','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','message','$sale_product','1473hUDWhK','secondary_code','<span\x20style=\x22float:\x20right;\x22>','/view/return_sales/:id','734997XcyhVh','6mCgGSE','push','$invoice','$room','express','type','/barcode_scanner','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/:id','Logo.png','customers_docs','<html><head><title></title>','</head><body>','<div>','$product_details.expiry_date','</tbody>','<hr\x20class=\x22my-3\x22>','prod_cat','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','bin','types','$product_details._id','aggregate','log','Return\x20Goods','prod_invoice','product_stock','Floor','warehouse','quantity','sales_invoice','</tr>','French','floorlevel','unit','storage','54QcLcfx','production_date','warehouse_name','site_title','maxperunit','$sale_product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.actual_qty','Receiving\x20Area','findOne','False','back','language','Shelves','currency','forEach','OUT-','all_sales_barcode','bay','staff','findById','RoomAssigned','barcode\x20Product\x20master','floor','currency_placement','Level','110bhICJd','sales\x20item\x20return\x20successfull','$product_details.product_stock','Arabic','1058481RwBQvk','$product_details.level','logo','$product_details.production_date','product','$product_details.bin','../middleware/auth'];a0_0x3227=function(){return _0x220a15;};return a0_0x3227();}function a0_0x3a0b(_0x3f0c7f,_0x2d06c0){var _0x3227ac=a0_0x3227();return a0_0x3a0b=function(_0x3a0b18,_0x3c8cc5){_0x3a0b18=_0x3a0b18-0xe2;var _0x47a3d9=_0x3227ac[_0x3a0b18];return _0x47a3d9;},a0_0x3a0b(_0x3f0c7f,_0x2d06c0);}var a0_0x4c2303=a0_0x3a0b;(function(_0x3408c4,_0x25ab29){var _0x586164=a0_0x3a0b,_0x2bc1e2=_0x3408c4();while(!![]){try{var _0x431b1b=-parseInt(_0x586164(0x1d5))/0x1*(parseInt(_0x586164(0xf7))/0x2)+parseInt(_0x586164(0x1d9))/0x3+parseInt(_0x586164(0x123))/0x4+-parseInt(_0x586164(0x194))/0x5*(parseInt(_0x586164(0x1da))/0x6)+parseInt(_0x586164(0x169))/0x7*(-parseInt(_0x586164(0x12f))/0x8)+parseInt(_0x586164(0x115))/0x9+-parseInt(_0x586164(0x111))/0xa*(-parseInt(_0x586164(0x1cd))/0xb);if(_0x431b1b===_0x25ab29)break;else _0x2bc1e2['push'](_0x2bc1e2['shift']());}catch(_0x382a10){_0x2bc1e2['push'](_0x2bc1e2['shift']());}}}(a0_0x3227,0x21bbd));const express=require(a0_0x4c2303(0x1de)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x4c2303(0x1c1)),auth=require(a0_0x4c2303(0x11b)),nodemailer=require(a0_0x4c2303(0x1a8)),users=require(a0_0x4c2303(0x1b9));router[a0_0x4c2303(0x122)](a0_0x4c2303(0x143),auth,async(_0x5722eb,_0x1bb407)=>{var _0x4a1cd7=a0_0x4c2303;try{const {username:_0x5e29d7,email:_0x18d77d,role:_0x572bd7}=_0x5722eb[_0x4a1cd7(0x197)],_0x27371f=_0x5722eb[_0x4a1cd7(0x197)],_0x42bab0=await profile[_0x4a1cd7(0x100)]({'email':_0x27371f[_0x4a1cd7(0x157)]}),_0x4b3319=await master_shop[_0x4a1cd7(0x1ce)]();let _0x4691d1;if(_0x27371f['role']==_0x4a1cd7(0x10a)){const _0x5b7644=await staff[_0x4a1cd7(0x100)]({'email':_0x27371f[_0x4a1cd7(0x157)]});_0x4691d1=await sales['aggregate']([{'$lookup':{'from':'customers','localField':_0x4a1cd7(0x18f),'foreignField':_0x4a1cd7(0x155),'as':_0x4a1cd7(0x1e4)}},{'$unwind':_0x4a1cd7(0x1b7)},{'$unwind':_0x4a1cd7(0x1d4)},{'$group':{'_id':_0x4a1cd7(0x1a5),'invoice':{'$first':_0x4a1cd7(0x1dc)},'customers':{'$first':_0x4a1cd7(0x1ab)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x4a1cd7(0x164)},'sale_product':{'$push':_0x4a1cd7(0x1d4)},'note':{'$first':'$note'},'return_data':{'$first':_0x4a1cd7(0x170)},'customers_docs':{'$first':_0x4a1cd7(0x1b7)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x4a1cd7(0xfc)},'isle':{'$addToSet':_0x4a1cd7(0x16c)},'type':{'$addToSet':_0x4a1cd7(0x1aa)},'pallet':{'$addToSet':_0x4a1cd7(0x168)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x4a1cd7(0x190)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x4691d1=await sales[_0x4a1cd7(0xe9)]([{'$lookup':{'from':_0x4a1cd7(0x19f),'localField':_0x4a1cd7(0x18f),'foreignField':_0x4a1cd7(0x155),'as':'customers_docs'}},{'$unwind':_0x4a1cd7(0x1b7)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x4a1cd7(0x1a5),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x4a1cd7(0x1d4)},'note':{'$first':_0x4a1cd7(0x1b5)},'return_data':{'$first':_0x4a1cd7(0x170)},'customers_docs':{'$first':_0x4a1cd7(0x1b7)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x4a1cd7(0x16c)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x4a1cd7(0x168)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x4a1cd7(0x17c),_0x4691d1);if(_0x4b3319[0x0][_0x4a1cd7(0x103)]==_0x4a1cd7(0x16e)){var _0x4bbbe8=users['English'];console['log'](_0x4bbbe8);}else{if(_0x4b3319[0x0][_0x4a1cd7(0x103)]==_0x4a1cd7(0x12e))var _0x4bbbe8=users['Hindi'];else{if(_0x4b3319[0x0]['language']==_0x4a1cd7(0x177))var _0x4bbbe8=users[_0x4a1cd7(0x177)];else{if(_0x4b3319[0x0][_0x4a1cd7(0x103)]==_0x4a1cd7(0x1c9))var _0x4bbbe8=users[_0x4a1cd7(0x1c9)];else{if(_0x4b3319[0x0][_0x4a1cd7(0x103)]==_0x4a1cd7(0xf3))var _0x4bbbe8=users[_0x4a1cd7(0xf3)];else{if(_0x4b3319[0x0][_0x4a1cd7(0x103)]==_0x4a1cd7(0x141))var _0x4bbbe8=users[_0x4a1cd7(0x149)];else{if(_0x4b3319[0x0]['language']==_0x4a1cd7(0x19b))var _0x4bbbe8=users[_0x4a1cd7(0x19b)];else{if(_0x4b3319[0x0]['language']=='Arabic\x20(ae)')var _0x4bbbe8=users[_0x4a1cd7(0x114)];}}}}}}}_0x1bb407[_0x4a1cd7(0x11e)](_0x4a1cd7(0x1a6),{'success':_0x5722eb[_0x4a1cd7(0x138)](_0x4a1cd7(0x163)),'errors':_0x5722eb['flash'](_0x4a1cd7(0x14c)),'sales':_0x4691d1,'profile':_0x42bab0,'role':_0x27371f,'master_shop':_0x4b3319,'language':_0x4bbbe8});}catch(_0x1fbdcc){console[_0x4a1cd7(0xea)](_0x1fbdcc);}});async function getRandom8DigitNumber(){var _0xc1e73b=a0_0x4c2303;const _0x1654c3=0x989680,_0x145ec2=0x5f5e0ff,_0x46288f=Math[_0xc1e73b(0x10e)](Math['random']()*(_0x145ec2-_0x1654c3+0x1))+_0x1654c3;var _0x542ea3;const _0x2dd684=await sales[_0xc1e73b(0x100)]({'invoice':_0xc1e73b(0x107)+_0x46288f});return _0x2dd684&&_0x2dd684[_0xc1e73b(0x17a)]>0x0?_0x542ea3=_0xc1e73b(0x107)+_0x46288f:_0x542ea3='OUT-'+_0x46288f,_0x542ea3;}router[a0_0x4c2303(0x122)](a0_0x4c2303(0x1cb),auth,async(_0x2444e3,_0x55a469)=>{var _0x2e51c8=a0_0x4c2303;try{const {username:_0x799137,email:_0x199254,role:_0x3a4a90}=_0x2444e3[_0x2e51c8(0x197)],_0x83f1ba=_0x2444e3['user'],_0x286373=await profile[_0x2e51c8(0x100)]({'email':_0x83f1ba[_0x2e51c8(0x157)]}),_0x15649c=await master_shop[_0x2e51c8(0x1ce)](),_0xa20a10=await customer[_0x2e51c8(0x1ce)]({});let _0x293883;if(_0x83f1ba[_0x2e51c8(0x178)]=='staff'){const _0x4ec1aa=await staff['findOne']({'email':_0x83f1ba['email']});_0x293883=await warehouse[_0x2e51c8(0xe9)]([{'$match':{'status':_0x2e51c8(0x1ad),'name':_0x4ec1aa[_0x2e51c8(0xef)],'warehouse_category':_0x2e51c8(0x132),'name':{'$ne':_0x2e51c8(0xeb)}}},{'$group':{'_id':_0x2e51c8(0x161),'name':{'$first':_0x2e51c8(0x161)}}},{'$sort':{'name':0x1}}]);}else _0x293883=await warehouse[_0x2e51c8(0xe9)]([{'$match':{'status':'Enabled','warehouse_category':_0x2e51c8(0x132),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x2e51c8(0x161),'name':{'$first':_0x2e51c8(0x161)}}},{'$sort':{'name':0x1}}]);const _0x3a0557=await product['find']({});var _0x59d27a=['Ambient',_0x2e51c8(0x11f)];const _0x424653=await sales[_0x2e51c8(0x1ce)]({}),_0xaecf8a=_0x424653['length']+0x1,_0x1a29d0=_0x2e51c8(0x107)+_0xaecf8a['toString']()[_0x2e51c8(0x12b)](0x5,'0');if(_0x15649c[0x0][_0x2e51c8(0x103)]==_0x2e51c8(0x16e)){var _0x6b5bda=users[_0x2e51c8(0x13f)];console[_0x2e51c8(0xea)](_0x6b5bda);}else{if(_0x15649c[0x0]['language']==_0x2e51c8(0x12e))var _0x6b5bda=users[_0x2e51c8(0x12e)];else{if(_0x15649c[0x0][_0x2e51c8(0x103)]==_0x2e51c8(0x177))var _0x6b5bda=users['German'];else{if(_0x15649c[0x0]['language']=='Spanish')var _0x6b5bda=users[_0x2e51c8(0x1c9)];else{if(_0x15649c[0x0][_0x2e51c8(0x103)]==_0x2e51c8(0xf3))var _0x6b5bda=users['French'];else{if(_0x15649c[0x0][_0x2e51c8(0x103)]=='Portuguese\x20(BR)')var _0x6b5bda=users['Portuguese'];else{if(_0x15649c[0x0][_0x2e51c8(0x103)]==_0x2e51c8(0x19b))var _0x6b5bda=users[_0x2e51c8(0x19b)];else{if(_0x15649c[0x0][_0x2e51c8(0x103)]==_0x2e51c8(0x1c8))var _0x6b5bda=users['Arabic'];}}}}}}}const _0x206571=getRandom8DigitNumber();_0x206571['then'](_0x95bc26=>{var _0x5bf645=_0x2e51c8;_0x55a469[_0x5bf645(0x11e)](_0x5bf645(0x1c5),{'success':_0x2444e3[_0x5bf645(0x138)](_0x5bf645(0x163)),'errors':_0x2444e3[_0x5bf645(0x138)](_0x5bf645(0x14c)),'role':_0x83f1ba,'profile':_0x286373,'customer':_0xa20a10,'warehouse':_0x293883,'product':_0x3a0557,'invoice':_0x95bc26,'master_shop':_0x15649c,'language':_0x6b5bda,'rooms_data':_0x59d27a});})[_0x2e51c8(0x18a)](_0x4f9560=>{var _0x4c1dd0=_0x2e51c8;_0x2444e3['flash'](_0x4c1dd0(0x14c),_0x4c1dd0(0x139)),_0x55a469[_0x4c1dd0(0x12a)](_0x4c1dd0(0x1cc));});}catch(_0x176ffd){console[_0x2e51c8(0xea)](_0x176ffd);}}),router[a0_0x4c2303(0x122)](a0_0x4c2303(0x151),auth,async(_0x405e27,_0x277bb4)=>{var _0x426c72=a0_0x4c2303;try{const _0xef09ba=_0x405e27[_0x426c72(0x13b)]['id'];console['log'](_0xef09ba);const _0x3cf0ae=await product['find'](),_0x2589b9=await purchases[_0x426c72(0xe9)]([{'$match':{'warehouse_name':_0xef09ba}},{'$unwind':_0x426c72(0x1bd)},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x426c72(0x135),_0x2589b9),_0x277bb4['status'](0xc8)[_0x426c72(0x142)]({'purchases_data':_0x2589b9,'product_data':_0x3cf0ae});}catch(_0x22553e){console[_0x426c72(0xea)](_0x22553e);}}),router['post']('/view/add_sale/product',auth,async(_0xecd47f,_0x4552dc)=>{var _0x49283d=a0_0x4c2303;try{const {warehouse_data:_0x47ef09,product_data:_0x1cfd5d}=_0xecd47f['body'];console[_0x49283d(0xea)](_0xecd47f[_0x49283d(0x11d)][_0x49283d(0x179)]);;const _0xba7e81=await master_shop[_0x49283d(0x1ce)]();console[_0x49283d(0xea)]('master',_0xba7e81);const _0x22ccdb=await product['findOne']({'name':_0x1cfd5d});console[_0x49283d(0xea)](_0x49283d(0x119),_0x22ccdb);const _0x4e234c=await warehouse[_0x49283d(0xe9)]([{'$match':{'name':_0x47ef09}},{'$unwind':_0x49283d(0x187)},{'$match':{'product_details.product_name':_0x1cfd5d}},{'$group':{'_id':_0x49283d(0x184),'product_stock':{'$first':_0x49283d(0x113)}}}]);console[_0x49283d(0xea)]('stock_data',_0x4e234c),_0x4552dc['status'](0xc8)[_0x49283d(0x142)]({'master':_0xba7e81,'new_product':_0x22ccdb,'stock_data':_0x4e234c});}catch(_0x21b95a){console[_0x49283d(0xea)](_0x21b95a);}}),router['post'](a0_0x4c2303(0x1cb),auth,async(_0xda27ac,_0x4a0b7e)=>{var _0x14bb09=a0_0x4c2303;try{const {invoice:_0x4d9fad,date:_0x5e225b,warehouse_name:_0x394f19,product_name:_0x3cba88,stock:_0x12ac4b,quantity:_0x588e71,note:_0x1337f9,room:_0x526f8c,primary_code:_0x327d18,secondary_code:_0x15cd50,prod_code:_0x5153f9,level:_0x5db2e3,isle:_0x2cb59b,pallet:_0xd8d0b9,batch_code:_0x595c44,SCRN:_0x35bb06,expiry_date:_0x5d042c}=_0xda27ac[_0x14bb09(0x11d)];if(typeof _0x3cba88=='string')var _0xb5cab7=[_0xda27ac[_0x14bb09(0x11d)]['product_name']],_0x637e70=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x120)]],_0x377a9d=[_0xda27ac['body']['carton']],_0x3ad1d4=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x17f)]],_0x252be2=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x1d6)]],_0x2e0b3b=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x17d)]],_0x4136ac=[_0xda27ac['body']['level']],_0x13b4a5=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x1b0)]],_0x3b22cd=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x15d)]],_0x303d72=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x1ba)]],_0x5cd8ac=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x183)]],_0x2d0252=[_0xda27ac['body'][_0x14bb09(0x160)]],_0xb3a037=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0xf8)]],_0x28cd0c=[_0xda27ac[_0x14bb09(0x11d)]['requested_qty']],_0x3248ce=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x1a7)]],_0x34f41f=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x1c3)]],_0xe61ae7=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0xe3)]],_0x21ca39=[_0xda27ac['body']['quantity']],_0x13707a=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x10c)]],_0x422ab8=[_0xda27ac[_0x14bb09(0x11d)]['prod_invoice']],_0x2e43f9=[_0xda27ac[_0x14bb09(0x11d)]['actual_qty']],_0x37909f=[_0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x181)]];else var _0xb5cab7=[..._0xda27ac[_0x14bb09(0x11d)]['product_name']],_0x637e70=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x120)]],_0x377a9d=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x12c)]],_0x3ad1d4=[..._0xda27ac['body']['primary_code']],_0x252be2=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x1d6)]],_0x2e0b3b=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x17d)]],_0x4136ac=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0xe4)]],_0x13b4a5=[..._0xda27ac['body'][_0x14bb09(0x1b0)]],_0x3b22cd=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x15d)]],_0x303d72=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x1ba)]],_0x5cd8ac=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x183)]],_0x2d0252=[..._0xda27ac[_0x14bb09(0x11d)]['max_per_unit']],_0xb3a037=[..._0xda27ac['body']['production_date']],_0x28cd0c=[..._0xda27ac['body'][_0x14bb09(0x19a)]],_0x3248ce=[..._0xda27ac['body']['delivery_date']],_0x34f41f=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0x1c3)]],_0xe61ae7=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0xe3)]],_0x21ca39=[..._0xda27ac[_0x14bb09(0x11d)][_0x14bb09(0xf0)]],_0x13707a=[..._0xda27ac[_0x14bb09(0x11d)]['RoomAssigned']],_0x422ab8=[..._0xda27ac['body'][_0x14bb09(0xec)]],_0x2e43f9=[..._0xda27ac['body'][_0x14bb09(0x13c)]],_0x37909f=[..._0xda27ac[_0x14bb09(0x11d)]['actual_uom']];const _0x12fbd2=_0xb5cab7[_0x14bb09(0x12d)](_0x24b75b=>{return _0x24b75b={'product_name':_0x24b75b};});_0x637e70[_0x14bb09(0x106)]((_0x58765d,_0x86d77f)=>{var _0x979a2b=_0x14bb09;_0x12fbd2[_0x86d77f][_0x979a2b(0x120)]=Math['abs'](_0x58765d);}),_0x2e43f9[_0x14bb09(0x106)]((_0x1dd31c,_0x1a8e51)=>{_0x12fbd2[_0x1a8e51]['actual_qty']=Math['abs'](_0x1dd31c);}),_0x37909f[_0x14bb09(0x106)]((_0x5811ad,_0x10fc14)=>{var _0x49f788=_0x14bb09;_0x12fbd2[_0x10fc14][_0x49f788(0x181)]=_0x5811ad;}),_0x377a9d[_0x14bb09(0x106)]((_0x1d4ac7,_0x977fe6)=>{var _0x2518c1=_0x14bb09;_0x12fbd2[_0x977fe6][_0x2518c1(0xf0)]=_0x1d4ac7;}),_0x3ad1d4[_0x14bb09(0x106)]((_0x5a1351,_0x5aba00)=>{var _0x52f957=_0x14bb09;_0x12fbd2[_0x5aba00][_0x52f957(0x17f)]=_0x5a1351;}),_0x252be2[_0x14bb09(0x106)]((_0x412101,_0x3a6c57)=>{var _0x2b4d58=_0x14bb09;_0x12fbd2[_0x3a6c57][_0x2b4d58(0x1d6)]=_0x412101;}),_0x2e0b3b[_0x14bb09(0x106)]((_0x55ce70,_0x56f6e6)=>{var _0x2d1df2=_0x14bb09;_0x12fbd2[_0x56f6e6][_0x2d1df2(0x1d0)]=_0x55ce70;}),_0x4136ac[_0x14bb09(0x106)]((_0x4a7592,_0x2a90f2)=>{var _0x57d356=_0x14bb09;_0x13707a[_0x57d356(0x106)]((_0x43c536,_0x3a7ce6)=>{var _0x467c6c=_0x57d356;if(_0x43c536==_0x467c6c(0xff)&&_0x2a90f2==_0x3a7ce6){var _0x43a13c=_0x4a7592[_0x467c6c(0x16f)](0x3);_0x12fbd2[_0x2a90f2][_0x467c6c(0xf6)]=_0x4a7592[0x0],_0x12fbd2[_0x2a90f2]['rack']=_0x4a7592[0x1],_0x12fbd2[_0x2a90f2][_0x467c6c(0x109)]=0x0,_0x12fbd2[_0x2a90f2][_0x467c6c(0xe6)]=0x0,_0x12fbd2[_0x2a90f2][_0x467c6c(0x1df)]=_0x467c6c(0xee),_0x12fbd2[_0x2a90f2][_0x467c6c(0xf4)]=_0x43a13c;}else{if(_0x43c536=='Shelves'&&_0x2a90f2==_0x3a7ce6){var _0x43a13c=_0x4a7592['slice'](0x3);_0x12fbd2[_0x2a90f2][_0x467c6c(0xf6)]=_0x4a7592[0x0],_0x12fbd2[_0x2a90f2][_0x467c6c(0x1ae)]=_0x4a7592[0x1],_0x12fbd2[_0x2a90f2][_0x467c6c(0x109)]=0x0,_0x12fbd2[_0x2a90f2][_0x467c6c(0xe6)]=0x0,_0x12fbd2[_0x2a90f2][_0x467c6c(0x1df)]=_0x467c6c(0xee),_0x12fbd2[_0x2a90f2]['floorlevel']=_0x4a7592[0x5];}else{if(_0x2a90f2==_0x3a7ce6){var _0x45a3f7;if(_0x4a7592[0x4]=='L')_0x45a3f7=_0x467c6c(0x110);else _0x4a7592[0x4]=='F'&&(_0x45a3f7=_0x467c6c(0xee));_0x12fbd2[_0x2a90f2][_0x467c6c(0xf6)]=_0x4a7592[0x0],_0x12fbd2[_0x2a90f2][_0x467c6c(0x1ae)]=_0x4a7592[0x1],_0x12fbd2[_0x2a90f2]['bay']=_0x4a7592[0x2],_0x12fbd2[_0x2a90f2][_0x467c6c(0xe6)]=_0x4a7592[0x3],_0x12fbd2[_0x2a90f2][_0x467c6c(0x1df)]=_0x45a3f7,_0x12fbd2[_0x2a90f2]['floorlevel']=_0x4a7592[0x5];}}}});}),_0x13b4a5['forEach']((_0x290fc8,_0x28d391)=>{var _0x1071ec=_0x14bb09;_0x12fbd2[_0x28d391][_0x1071ec(0xf5)]=_0x290fc8;}),_0x3b22cd['forEach']((_0xbb5dbf,_0x1f83e2)=>{_0x12fbd2[_0x1f83e2]['secondary_unit']=_0xbb5dbf;}),_0x303d72[_0x14bb09(0x106)]((_0x236cf0,_0xfc389)=>{var _0x16a975=_0x14bb09;_0x12fbd2[_0xfc389][_0x16a975(0x1ba)]=_0x236cf0;}),_0x5cd8ac['forEach']((_0x2dc0b4,_0x2f31ce)=>{var _0x41da5a=_0x14bb09;_0x12fbd2[_0x2f31ce][_0x41da5a(0x183)]=_0x2dc0b4;}),_0x2d0252[_0x14bb09(0x106)]((_0x49a2ea,_0x362bcc)=>{_0x12fbd2[_0x362bcc]['maxperunit']=_0x49a2ea;}),_0xb3a037['forEach']((_0x2ab9de,_0x1d061d)=>{var _0xe534db=_0x14bb09;_0x12fbd2[_0x1d061d][_0xe534db(0xf8)]=_0x2ab9de;}),_0x28cd0c[_0x14bb09(0x106)]((_0x30d128,_0x559364)=>{var _0x826d65=_0x14bb09;_0x12fbd2[_0x559364][_0x826d65(0x19a)]=_0x30d128;}),_0x3248ce[_0x14bb09(0x106)]((_0x209fd7,_0x266af9)=>{var _0x40b870=_0x14bb09;_0x12fbd2[_0x266af9][_0x40b870(0x1a7)]=_0x209fd7;}),_0x34f41f[_0x14bb09(0x106)]((_0x17bf4c,_0x55ed3b)=>{_0x12fbd2[_0x55ed3b]['delivery_code']=_0x17bf4c;}),_0xe61ae7[_0x14bb09(0x106)]((_0x5670e1,_0xd839cd)=>{_0x12fbd2[_0xd839cd]['prod_cat']=_0x5670e1;}),_0x21ca39[_0x14bb09(0x106)]((_0x32c6ed,_0x4f076c)=>{var _0x1363af=_0x14bb09;_0x12fbd2[_0x4f076c][_0x1363af(0x13e)]=_0x32c6ed;}),_0x13707a[_0x14bb09(0x106)]((_0x31559d,_0x43cd16)=>{var _0x3b79e4=_0x14bb09;_0x12fbd2[_0x43cd16][_0x3b79e4(0x14d)]=_0x31559d;}),_0x422ab8[_0x14bb09(0x106)]((_0x171e20,_0x105da6)=>{var _0x49aa62=_0x14bb09;_0x12fbd2[_0x105da6][_0x49aa62(0x1be)]=_0x171e20;});var _0x26ddf1=0x0;_0x12fbd2[_0x14bb09(0x106)](_0x4e8c63=>{var _0x14f248=_0x14bb09;(_0x4e8c63[_0x14f248(0x120)]<_0x4e8c63[_0x14f248(0x13e)]||_0x4e8c63[_0x14f248(0x13e)]==0x0)&&(console[_0x14f248(0xea)](_0x14f248(0x158),_0x4e8c63),_0x26ddf1++);});const _0x1340a9=_0x12fbd2[_0x14bb09(0x152)](_0x2520f0=>_0x2520f0['quantity']!=='0'&&_0x2520f0[_0x14bb09(0xf0)]!==''),_0x1a190a=new sales({'invoice':_0x4d9fad,'customer':_0xda27ac['body'][_0x14bb09(0x18f)],'date':_0x5e225b,'warehouse_name':_0x394f19,'sale_product':_0x1340a9,'note':_0x1337f9,'room':_0x526f8c,'primary_code':_0x327d18,'secondary_code':_0x15cd50,'prod_code':_0x5153f9,'SCRN':_0x35bb06}),_0x283f42=await _0x1a190a[_0x14bb09(0x1ac)]();_0xda27ac['flash'](_0x14bb09(0x163),_0x14bb09(0x1a4)),_0x4a0b7e[_0x14bb09(0x12a)](_0x14bb09(0x1bc)+_0x283f42['_id']);}catch(_0x483a4a){console['log'](_0x483a4a);}}),router[a0_0x4c2303(0x122)](a0_0x4c2303(0x1c2),auth,async(_0x3a5a81,_0x441245)=>{var _0x508be8=a0_0x4c2303;try{const {username:_0x702ed3,email:_0x4414ea,role:_0x1f2509}=_0x3a5a81[_0x508be8(0x197)],_0xf55ce0=_0x3a5a81[_0x508be8(0x197)],_0x551129=await profile['findOne']({'email':_0xf55ce0[_0x508be8(0x157)]}),_0x1b73af=await master_shop['find'](),_0x456c4c=_0x3a5a81[_0x508be8(0x13b)]['id'],_0x327b5b=await sales[_0x508be8(0x10b)](_0x456c4c),_0x507377=await warehouse[_0x508be8(0xe9)]([{'$match':{'name':_0x327b5b[_0x508be8(0xf9)]}},{'$unwind':_0x508be8(0x187)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x508be8(0x113)},'bay':{'$first':_0x508be8(0x127)},'bin':{'$first':_0x508be8(0x11a)},'type':{'$first':_0x508be8(0x129)},'floorlevel':{'$first':_0x508be8(0x1d1)},'primary_code':{'$first':_0x508be8(0x11c)},'secondary_code':{'$first':_0x508be8(0x18b)},'product_code':{'$first':_0x508be8(0x15a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x508be8(0x136)},'expiry_date':{'$first':_0x508be8(0x1e8)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x508be8(0x124)}}}]),_0x5804b3=await customer['find']({});let _0x14c1fa;if(_0xf55ce0[_0x508be8(0x178)]==_0x508be8(0x10a)){const _0x10864c=await staff['findOne']({'email':_0xf55ce0[_0x508be8(0x157)]});_0x14c1fa=await warehouse[_0x508be8(0xe9)]([{'$match':{'status':_0x508be8(0x1ad),'name':_0x10864c[_0x508be8(0xef)]}},{'$group':{'_id':_0x508be8(0x161),'name':{'$first':_0x508be8(0x161)}}}]);}else _0x14c1fa=await warehouse[_0x508be8(0xe9)]([{'$match':{'status':_0x508be8(0x1ad)}},{'$group':{'_id':_0x508be8(0x161),'name':{'$first':_0x508be8(0x161)}}}]);const _0x12d010=await product[_0x508be8(0x1ce)]({}),_0x452cdd=await suppliers[_0x508be8(0x1ce)]({});if(_0x1b73af[0x0][_0x508be8(0x103)]==_0x508be8(0x16e)){var _0x43bdfa=users['English'];console[_0x508be8(0xea)](_0x43bdfa);}else{if(_0x1b73af[0x0][_0x508be8(0x103)]==_0x508be8(0x12e))var _0x43bdfa=users[_0x508be8(0x12e)];else{if(_0x1b73af[0x0][_0x508be8(0x103)]==_0x508be8(0x177))var _0x43bdfa=users[_0x508be8(0x177)];else{if(_0x1b73af[0x0][_0x508be8(0x103)]==_0x508be8(0x1c9))var _0x43bdfa=users['Spanish'];else{if(_0x1b73af[0x0]['language']==_0x508be8(0xf3))var _0x43bdfa=users['French'];else{if(_0x1b73af[0x0][_0x508be8(0x103)]==_0x508be8(0x141))var _0x43bdfa=users['Portuguese'];else{if(_0x1b73af[0x0][_0x508be8(0x103)]==_0x508be8(0x19b))var _0x43bdfa=users[_0x508be8(0x19b)];else{if(_0x1b73af[0x0]['language']=='Arabic\x20(ae)')var _0x43bdfa=users['Arabic'];}}}}}}}_0x441245[_0x508be8(0x11e)](_0x508be8(0x18d),{'success':_0x3a5a81['flash'](_0x508be8(0x163)),'errors':_0x3a5a81[_0x508be8(0x138)](_0x508be8(0x14c)),'role':_0xf55ce0,'profile':_0x551129,'customer':_0x5804b3,'warehouse':_0x14c1fa,'product':_0x507377,'user':_0x327b5b,'master_shop':_0x1b73af,'unit':_0x12d010,'language':_0x43bdfa,'suppliers':_0x452cdd});}catch(_0x1f9c48){console['log'](_0x1f9c48);}}),router['post'](a0_0x4c2303(0x1c2),auth,async(_0x114f6f,_0x83788f)=>{var _0x4f6412=a0_0x4c2303;try{const _0x4f5c5d=_0x114f6f[_0x4f6412(0x13b)]['id'],{invoice:_0x5e2615,warehouse_name:_0x43986e,room:_0x77c3d}=_0x114f6f['body'],_0x24366f=await sales[_0x4f6412(0x100)]({'invoice':_0x5e2615}),_0x1a294e=_0x24366f['sale_product'][_0x4f6412(0x12d)](async _0x153d7e=>{var _0x4794c1=_0x4f6412,_0x8257d8=await warehouse[_0x4794c1(0x100)]({'name':_0x43986e,'room':_0x153d7e['room_name'],'warehouse_category':_0x4794c1(0x132)});const _0x5dc64a=_0x8257d8[_0x4794c1(0x1c4)][_0x4794c1(0x12d)](_0x2c2916=>{var _0x38c38a=_0x4794c1;_0x2c2916[_0x38c38a(0x167)]==_0x153d7e[_0x38c38a(0x167)]&&_0x2c2916[_0x38c38a(0xf4)]==_0x153d7e[_0x38c38a(0xf4)]&&_0x2c2916[_0x38c38a(0x1df)]==_0x153d7e[_0x38c38a(0x1df)]&&_0x2c2916[_0x38c38a(0xe6)]==_0x153d7e['bin']&&_0x2c2916[_0x38c38a(0x109)]==_0x153d7e['bay']&&_0x2c2916[_0x38c38a(0x1ae)]==_0x153d7e[_0x38c38a(0x1ae)]&&_0x2c2916[_0x38c38a(0xf6)]==_0x153d7e[_0x38c38a(0xf6)]&&_0x2c2916[_0x38c38a(0x183)]==_0x153d7e[_0x38c38a(0x183)]&&_0x2c2916['batch_code']==_0x153d7e[_0x38c38a(0x1ba)]&&_0x2c2916['invoice']==_0x153d7e[_0x38c38a(0x1be)]&&(_0x2c2916[_0x38c38a(0xed)]=Math[_0x38c38a(0x193)](_0x2c2916[_0x38c38a(0xed)])-Math[_0x38c38a(0x193)](_0x153d7e['quantity']));});return _0x8257d8;});Promise['all'](_0x1a294e)[_0x4f6412(0x16a)](async _0x385305=>{var _0x4f236d=_0x4f6412;try{for(const _0xf01194 of _0x385305){await _0xf01194['save']();}_0x24366f[_0x4f236d(0x1b1)]='True';const _0x4402ee=await _0x24366f[_0x4f236d(0x1ac)](),_0x5f147d=await master_shop[_0x4f236d(0x1ce)](),_0x2aebbf=await email_settings[_0x4f236d(0x100)](),_0x54f909=await supervisor_settings['find']();var _0x388292=_0x24366f[_0x4f236d(0x174)],_0x349225='',_0x5a8b79;for(_0x5a8b79 in _0x388292){_0x349225+=_0x4f236d(0x1af)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x388292[_0x5a8b79]['product_name']+_0x4f236d(0x186)+_0x4f236d(0x121)+_0x388292[_0x5a8b79]['product_code']+_0x4f236d(0x186)+_0x4f236d(0x121)+_0x388292[_0x5a8b79][_0x4f236d(0xf0)]+'</td>'+_0x4f236d(0x121)+_0x388292[_0x5a8b79]['unit']+_0x4f236d(0x186)+_0x4f236d(0x121)+_0x388292[_0x5a8b79][_0x4f236d(0x15d)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x24366f[_0x4f236d(0xf9)]+_0x4f236d(0x186)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x388292[_0x5a8b79][_0x4f236d(0x14d)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x388292[_0x5a8b79]['storage']+_0x388292[_0x5a8b79][_0x4f236d(0x1ae)]+_0x388292[_0x5a8b79][_0x4f236d(0x109)]+_0x388292[_0x5a8b79][_0x4f236d(0xe6)]+_0x388292[_0x5a8b79][_0x4f236d(0x1df)][0x0]+_0x388292[_0x5a8b79][_0x4f236d(0xf4)]+_0x4f236d(0x186),'</tr>';}let _0x305370=nodemailer[_0x4f236d(0x159)]({'host':_0x2aebbf[_0x4f236d(0x16d)],'port':Number(_0x2aebbf['port']),'secure':![],'auth':{'user':_0x2aebbf[_0x4f236d(0x157)],'pass':_0x2aebbf[_0x4f236d(0x19e)]}}),_0x1a8d05={'from':_0x2aebbf[_0x4f236d(0x157)],'to':_0x54f909[0x0]['RMSEmail'],'subject':'Sales\x20Mail','attachments':[{'filename':_0x4f236d(0x1e3),'path':__dirname+_0x4f236d(0x147)+_0x4f236d(0x15b)+_0x5f147d[0x0][_0x4f236d(0x185)],'cid':_0x4f236d(0x117)}],'html':'<!DOCTYPE\x20html>'+_0x4f236d(0x1e5)+_0x4f236d(0x1e6)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4f236d(0x1e7)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4f236d(0x144)+_0x4f236d(0x1e7)+_0x4f236d(0x154)+_0x5f147d[0x0][_0x4f236d(0xfa)]+_0x4f236d(0x125)+'</div>'+_0x4f236d(0x144)+_0x4f236d(0xe2)+_0x4f236d(0x1e7)+_0x4f236d(0x1b2)+_0x4f236d(0x175)+_0x24366f[_0x4f236d(0x1be)]+'\x20'+_0x4f236d(0x1d7)+'\x20Order\x20Date\x20:\x20'+_0x24366f['date']+'\x20'+'</span>'+_0x4f236d(0x14f)+_0x4f236d(0x144)+_0x4f236d(0x166)+_0x4f236d(0x1b6)+_0x4f236d(0x1af)+_0x4f236d(0x1d2)+_0x4f236d(0xfd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x4f236d(0xe5)+_0x4f236d(0x172)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x4f236d(0x1a9)+'</tr>'+_0x4f236d(0x162)+_0x4f236d(0x1a1)+'\x20'+_0x349225+'\x20'+_0x4f236d(0x1e9)+_0x4f236d(0x198)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x4f236d(0x189)+_0x5f147d[0x0]['site_title']+'</h5>'+_0x4f236d(0x144)+_0x4f236d(0x144)+_0x4f236d(0x145)};_0x305370[_0x4f236d(0x1bb)](_0x1a8d05,function(_0x4ea36d,_0x1fe1e0){var _0xaac097=_0x4f236d;_0x4ea36d?(console[_0xaac097(0xea)](_0x4ea36d),console[_0xaac097(0xea)]('Error\x20Occurs')):console['log'](_0xaac097(0x1a2));}),_0x114f6f[_0x4f236d(0x138)](_0x4f236d(0x163),'Sales\x20Update\x20successfully'),_0x83788f[_0x4f236d(0x12a)](_0x4f236d(0x1bc)+_0x4f5c5d);}catch(_0x14d8bd){console[_0x4f236d(0x18c)](_0x14d8bd),_0x83788f[_0x4f236d(0x126)](0x1f4)[_0x4f236d(0x142)]({'error':_0x4f236d(0x18e)});}})[_0x4f6412(0x18a)](_0x39bdd5=>{var _0x339140=_0x4f6412;console['error'](_0x39bdd5),_0x83788f[_0x339140(0x126)](0x1f4)[_0x339140(0x142)]({'error':_0x339140(0x1c7)});});}catch(_0x4e80c0){console[_0x4f6412(0xea)](_0x4e80c0);}}),router[a0_0x4c2303(0x122)](a0_0x4c2303(0x1e2),auth,async(_0x3eb4a9,_0x57ff09)=>{var _0x1962d1=a0_0x4c2303;try{const {username:_0x3c773c,email:_0x1800b1,role:_0x3d8d5f}=_0x3eb4a9[_0x1962d1(0x197)],_0x2a60eb=_0x3eb4a9['user'],_0x232441=await profile[_0x1962d1(0x100)]({'email':_0x2a60eb[_0x1962d1(0x157)]}),_0x3c7904=await master_shop['find'](),_0x55ccdf=_0x3eb4a9[_0x1962d1(0x13b)]['id'],_0x3609ad=await sales[_0x1962d1(0x10b)](_0x55ccdf);var _0x3552d3=['Ambient','Enclosed'];const _0x1e4e67=await warehouse['aggregate']([{'$match':{'name':_0x3609ad[_0x1962d1(0xf9)],'warehouse_category':_0x1962d1(0x132)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1962d1(0x184)},'product_stock':{'$first':_0x1962d1(0x113)},'bay':{'$first':_0x1962d1(0x127)},'bin':{'$first':_0x1962d1(0x11a)},'type':{'$first':_0x1962d1(0x129)},'floorlevel':{'$first':_0x1962d1(0x1d1)},'primary_code':{'$first':_0x1962d1(0x11c)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1962d1(0x15a)},'storage':{'$first':_0x1962d1(0x13a)},'rack':{'$first':_0x1962d1(0x136)}}}]),_0x34a8dc=await customer[_0x1962d1(0x1ce)]({});let _0x108697;if(_0x2a60eb[_0x1962d1(0x178)]=='staff'){const _0x4796b1=await staff[_0x1962d1(0x100)]({'email':_0x2a60eb[_0x1962d1(0x157)]});_0x108697=await warehouse['aggregate']([{'$match':{'status':_0x1962d1(0x1ad),'name':_0x4796b1[_0x1962d1(0xef)],'warehouse_category':_0x1962d1(0x132)}},{'$group':{'_id':_0x1962d1(0x161),'name':{'$first':_0x1962d1(0x161)}}}]);}else _0x108697=await warehouse[_0x1962d1(0xe9)]([{'$match':{'status':_0x1962d1(0x1ad),'warehouse_category':_0x1962d1(0x132)}},{'$group':{'_id':_0x1962d1(0x161),'name':{'$first':'$name'}}}]);const _0x16e21e=await product[_0x1962d1(0x1ce)]({});if(_0x3c7904[0x0][_0x1962d1(0x103)]==_0x1962d1(0x16e)){var _0x136a24=users[_0x1962d1(0x13f)];console['log'](_0x136a24);}else{if(_0x3c7904[0x0][_0x1962d1(0x103)]==_0x1962d1(0x12e))var _0x136a24=users[_0x1962d1(0x12e)];else{if(_0x3c7904[0x0][_0x1962d1(0x103)]==_0x1962d1(0x177))var _0x136a24=users[_0x1962d1(0x177)];else{if(_0x3c7904[0x0][_0x1962d1(0x103)]==_0x1962d1(0x1c9))var _0x136a24=users['Spanish'];else{if(_0x3c7904[0x0][_0x1962d1(0x103)]==_0x1962d1(0xf3))var _0x136a24=users['French'];else{if(_0x3c7904[0x0][_0x1962d1(0x103)]==_0x1962d1(0x141))var _0x136a24=users[_0x1962d1(0x149)];else{if(_0x3c7904[0x0][_0x1962d1(0x103)]==_0x1962d1(0x19b))var _0x136a24=users[_0x1962d1(0x19b)];else{if(_0x3c7904[0x0]['language']==_0x1962d1(0x1c8))var _0x136a24=users['Arabic'];}}}}}}}_0x57ff09[_0x1962d1(0x11e)](_0x1962d1(0x1a0),{'success':_0x3eb4a9[_0x1962d1(0x138)](_0x1962d1(0x163)),'errors':_0x3eb4a9[_0x1962d1(0x138)]('errors'),'role':_0x2a60eb,'profile':_0x232441,'customer':_0x34a8dc,'warehouse':_0x108697,'product':_0x1e4e67,'user':_0x3609ad,'master_shop':_0x3c7904,'unit':_0x16e21e,'language':_0x136a24});}catch(_0x29e112){console['log'](_0x29e112);}}),router[a0_0x4c2303(0x14a)](a0_0x4c2303(0x1e2),auth,async(_0x3f00c3,_0x509837)=>{var _0x58111f=a0_0x4c2303;try{const _0x5e13aa=_0x3f00c3[_0x58111f(0x13b)]['id'],_0x22b918=await sales[_0x58111f(0x100)]({'_id':_0x3f00c3[_0x58111f(0x13b)]['id']}),_0xce029f=await warehouse[_0x58111f(0x100)]({'name':_0x22b918[_0x58111f(0xf9)],'room':_0x3f00c3['body'][_0x58111f(0x17b)]}),{invoice:_0x200c27,date:_0x5150b0,warehouse_name:_0x4f5eed,product_name:_0x258536,stock:_0x4df87d,quantity:_0x36b3ef,note:_0x28a1c2,room:_0x40b03c,customer:_0x1f74b2,SCRN:_0x3da84c}=_0x3f00c3['body'];if(typeof _0x258536==_0x58111f(0x17e))var _0x459fd3=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x167)]],_0x486ddb=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x120)]],_0x38c584=[_0x3f00c3[_0x58111f(0x11d)]['carton']],_0x52ff62=[_0x3f00c3['body'][_0x58111f(0x17f)]],_0x3fdccb=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x1d6)]],_0x16e312=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x17d)]],_0x384fb1=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0xe4)]],_0x4cf7b3=[_0x3f00c3['body'][_0x58111f(0x1b0)]],_0x3eb0ba=[_0x3f00c3[_0x58111f(0x11d)]['secondary_unit']],_0x200cba=[_0x3f00c3[_0x58111f(0x11d)]['batch_code']],_0x100a72=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x183)]],_0x128a5c=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x160)]],_0x57758e=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0xf8)]],_0x195796=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x19a)]],_0x363f7f=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x1a7)]],_0x485eec=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x1c3)]],_0x431f5f=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0xe3)]],_0x1b1309=[_0x3f00c3[_0x58111f(0x11d)][_0x58111f(0xf0)]],_0x1cb40d=[_0x3f00c3['body'][_0x58111f(0x10c)]];else var _0x459fd3=[..._0x3f00c3['body'][_0x58111f(0x167)]],_0x486ddb=[..._0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x120)]],_0x38c584=[..._0x3f00c3['body'][_0x58111f(0x12c)]],_0x52ff62=[..._0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x17f)]],_0x3fdccb=[..._0x3f00c3[_0x58111f(0x11d)]['secondary_code']],_0x16e312=[..._0x3f00c3['body']['prod_code']],_0x384fb1=[..._0x3f00c3[_0x58111f(0x11d)][_0x58111f(0xe4)]],_0x4cf7b3=[..._0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x1b0)]],_0x3eb0ba=[..._0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x15d)]],_0x200cba=[..._0x3f00c3['body'][_0x58111f(0x1ba)]],_0x100a72=[..._0x3f00c3[_0x58111f(0x11d)]['expiry_date']],_0x128a5c=[..._0x3f00c3['body']['max_per_unit']],_0x57758e=[..._0x3f00c3[_0x58111f(0x11d)][_0x58111f(0xf8)]],_0x195796=[..._0x3f00c3['body'][_0x58111f(0x19a)]],_0x363f7f=[..._0x3f00c3[_0x58111f(0x11d)][_0x58111f(0x1a7)]],_0x485eec=[..._0x3f00c3['body'][_0x58111f(0x1c3)]],_0x431f5f=[..._0x3f00c3[_0x58111f(0x11d)][_0x58111f(0xe3)]],_0x1b1309=[..._0x3f00c3[_0x58111f(0x11d)][_0x58111f(0xf0)]],_0x1cb40d=[..._0x3f00c3[_0x58111f(0x11d)]['RoomAssigned']];const _0x42fedd=_0x459fd3['map'](_0x19fc1e=>{return _0x19fc1e={'product_name':_0x19fc1e};});_0x486ddb[_0x58111f(0x106)]((_0x1e41c2,_0x4c885b)=>{var _0xa2a14a=_0x58111f;_0x42fedd[_0x4c885b][_0xa2a14a(0x120)]=Math[_0xa2a14a(0x193)](_0x1e41c2);}),_0x38c584[_0x58111f(0x106)]((_0x3e94df,_0x5e9564)=>{var _0x751bb2=_0x58111f;_0x42fedd[_0x5e9564][_0x751bb2(0xf0)]=_0x3e94df;}),_0x52ff62['forEach']((_0x1ed4fa,_0x37c48f)=>{_0x42fedd[_0x37c48f]['primary_code']=_0x1ed4fa;}),_0x3fdccb[_0x58111f(0x106)]((_0x1114c1,_0x4cde3a)=>{var _0x429132=_0x58111f;_0x42fedd[_0x4cde3a][_0x429132(0x1d6)]=_0x1114c1;}),_0x16e312[_0x58111f(0x106)]((_0x407b27,_0x2d03e0)=>{var _0x132353=_0x58111f;_0x42fedd[_0x2d03e0][_0x132353(0x1d0)]=_0x407b27;}),_0x384fb1['forEach']((_0x3e7c72,_0x1f764a)=>{var _0x2594cc=_0x58111f;_0x1cb40d[_0x2594cc(0x106)]((_0x19742b,_0x4d881d)=>{var _0x4647d3=_0x2594cc;if(_0x19742b==_0x4647d3(0xff)&&_0x1f764a==_0x4d881d){var _0x177ce0=_0x3e7c72[_0x4647d3(0x16f)](0x3);_0x42fedd[_0x1f764a][_0x4647d3(0xf6)]=_0x3e7c72[0x0],_0x42fedd[_0x1f764a]['rack']=_0x3e7c72[0x1],_0x42fedd[_0x1f764a]['bay']=0x0,_0x42fedd[_0x1f764a]['bin']=0x0,_0x42fedd[_0x1f764a][_0x4647d3(0x1df)]=_0x4647d3(0xee),_0x42fedd[_0x1f764a][_0x4647d3(0xf4)]=_0x177ce0;}else{if(_0x19742b==_0x4647d3(0x104)&&_0x1f764a==_0x4d881d){var _0x177ce0=_0x3e7c72['slice'](0x3);_0x42fedd[_0x1f764a][_0x4647d3(0xf6)]=_0x3e7c72[0x0],_0x42fedd[_0x1f764a]['rack']=_0x3e7c72[0x1],_0x42fedd[_0x1f764a][_0x4647d3(0x109)]=0x0,_0x42fedd[_0x1f764a][_0x4647d3(0xe6)]=0x0,_0x42fedd[_0x1f764a][_0x4647d3(0x1df)]='Floor',_0x42fedd[_0x1f764a]['floorlevel']=_0x3e7c72[0x5];}else{if(_0x1f764a==_0x4d881d){var _0x555b1c;if(_0x3e7c72[0x4]=='L')_0x555b1c='Level';else _0x3e7c72[0x4]=='F'&&(_0x555b1c=_0x4647d3(0xee));_0x42fedd[_0x1f764a]['storage']=_0x3e7c72[0x0],_0x42fedd[_0x1f764a][_0x4647d3(0x1ae)]=_0x3e7c72[0x1],_0x42fedd[_0x1f764a][_0x4647d3(0x109)]=_0x3e7c72[0x2],_0x42fedd[_0x1f764a][_0x4647d3(0xe6)]=_0x3e7c72[0x3],_0x42fedd[_0x1f764a]['type']=_0x555b1c,_0x42fedd[_0x1f764a][_0x4647d3(0xf4)]=_0x3e7c72[0x5];}}}});}),_0x4cf7b3[_0x58111f(0x106)]((_0x38ef83,_0x31f116)=>{_0x42fedd[_0x31f116]['unit']=_0x38ef83;}),_0x3eb0ba[_0x58111f(0x106)]((_0x4ab8ad,_0x15c24c)=>{var _0x477745=_0x58111f;_0x42fedd[_0x15c24c][_0x477745(0x15d)]=_0x4ab8ad;}),_0x200cba[_0x58111f(0x106)]((_0x4049eb,_0x2ed9fe)=>{var _0x1cba07=_0x58111f;_0x42fedd[_0x2ed9fe][_0x1cba07(0x1ba)]=_0x4049eb;}),_0x100a72[_0x58111f(0x106)]((_0x5c54f7,_0x587b3e)=>{var _0x3e5b59=_0x58111f;_0x42fedd[_0x587b3e][_0x3e5b59(0x183)]=_0x5c54f7;}),_0x128a5c[_0x58111f(0x106)]((_0x2c09ad,_0xacdf7c)=>{var _0x4698cd=_0x58111f;_0x42fedd[_0xacdf7c][_0x4698cd(0xfb)]=_0x2c09ad;}),_0x57758e[_0x58111f(0x106)]((_0x34918c,_0x408ea8)=>{var _0x38e730=_0x58111f;_0x42fedd[_0x408ea8][_0x38e730(0xf8)]=_0x34918c;}),_0x195796['forEach']((_0x27977c,_0x4a2dba)=>{var _0x95e8be=_0x58111f;_0x42fedd[_0x4a2dba][_0x95e8be(0x19a)]=Math[_0x95e8be(0x193)](_0x27977c);}),_0x363f7f['forEach']((_0x293887,_0x810bfa)=>{var _0x1d557f=_0x58111f;_0x42fedd[_0x810bfa][_0x1d557f(0x1a7)]=_0x293887;}),_0x485eec[_0x58111f(0x106)]((_0x51d43a,_0x1a8e74)=>{var _0x37d11e=_0x58111f;_0x42fedd[_0x1a8e74][_0x37d11e(0x1c3)]=_0x51d43a;}),_0x431f5f['forEach']((_0x519f98,_0x12486b)=>{_0x42fedd[_0x12486b]['prod_cat']=_0x519f98;}),_0x1b1309['forEach']((_0x4eee6b,_0xb27ad2)=>{var _0x500920=_0x58111f;_0x42fedd[_0xb27ad2][_0x500920(0x13e)]=_0x4eee6b;}),_0x1cb40d[_0x58111f(0x106)]((_0x83ea7c,_0x33028c)=>{var _0x1f077f=_0x58111f;_0x42fedd[_0x33028c][_0x1f077f(0x14d)]=_0x83ea7c;});var _0x1995b6=0x0;_0x42fedd[_0x58111f(0x106)](_0x383575=>{var _0x2f2ee5=_0x58111f;console[_0x2f2ee5(0xea)]('foreach\x20newproduct',_0x383575),(parseInt(_0x383575[_0x2f2ee5(0x120)])<parseInt(_0x383575[_0x2f2ee5(0xf0)])||parseInt(_0x383575[_0x2f2ee5(0xf0)])==0x0)&&_0x1995b6++;});if(_0x1995b6!=0x0)return _0x3f00c3[_0x58111f(0x138)](_0x58111f(0x14c),_0x58111f(0x1b4)),_0x509837[_0x58111f(0x12a)](_0x58111f(0x102));const _0x5246fe=_0x42fedd[_0x58111f(0x152)](_0x2e37d5=>_0x2e37d5[_0x58111f(0xf0)]!=='0'&&_0x2e37d5['quantity']!=='');_0x22b918[_0x58111f(0x1be)]=_0x200c27,_0x22b918[_0x58111f(0x18f)]=_0x1f74b2,_0x22b918[_0x58111f(0x156)]=_0x5150b0,_0x22b918['warehouse_name']=_0x4f5eed,_0x22b918[_0x58111f(0x174)]=_0x5246fe,_0x22b918[_0x58111f(0x13d)]=_0x28a1c2,_0x22b918[_0x58111f(0x192)]=_0x3da84c,_0x22b918['finalize']=_0x58111f(0x101),_0x22b918[_0x58111f(0x1b8)]=_0x58111f(0x101);const _0x22e041=await _0x22b918['save']();_0x3f00c3[_0x58111f(0x138)]('success',_0x58111f(0x15c)),_0x509837['redirect'](_0x58111f(0x1cc));}catch(_0x21ece6){console[_0x58111f(0xea)](_0x21ece6);}}),router[a0_0x4c2303(0x14a)](a0_0x4c2303(0x1bf),auth,async(_0x183658,_0x491061)=>{var _0xf320e5=a0_0x4c2303;try{const _0x4ef94d=_0x183658[_0xf320e5(0x13b)]['id'],{invoice:_0x4c480a,customer:_0x3639a6,receivable_amount:_0x39c648,received_amount:_0x1f30c5}=_0x183658[_0xf320e5(0x11d)],_0xd8a0b5=await sales[_0xf320e5(0x10b)](_0x4ef94d);console[_0xf320e5(0xea)](_0xd8a0b5);var _0x4c1215=_0x39c648-_0x1f30c5;console[_0xf320e5(0xea)](_0x1f30c5),_0xd8a0b5[_0xf320e5(0x128)]=parseFloat(_0x1f30c5)+parseFloat(_0xd8a0b5[_0xf320e5(0x128)]),_0xd8a0b5[_0xf320e5(0x14e)]=_0x4c1215,console[_0xf320e5(0xea)](_0xd8a0b5);const _0x29151e=await _0xd8a0b5['save'](),_0xc08557=await c_payment_data[_0xf320e5(0x100)]({'invoice':_0x4c480a});_0xc08557['amount']=_0x4c1215,await _0xc08557[_0xf320e5(0x1ac)]();let _0x2dbe2d=new Date(),_0x5af960=('0'+_0x2dbe2d['getDate']())[_0xf320e5(0x16f)](-0x2),_0x5eedda=('0'+(_0x2dbe2d[_0xf320e5(0x188)]()+0x1))[_0xf320e5(0x16f)](-0x2),_0x3da2e5=_0x2dbe2d['getFullYear'](),_0x5ea912=_0x3da2e5+'-'+_0x5eedda+'-'+_0x5af960;const _0x36b605=new customer_payment({'invoice':_0x4c480a,'date':_0x3da2e5+'-'+_0x5eedda+'-'+_0x5af960,'customer':_0x3639a6,'reason':_0xf320e5(0x19d),'amount':_0x1f30c5}),_0x2654cf=await _0x36b605[_0xf320e5(0x1ac)]();_0x183658[_0xf320e5(0x138)](_0xf320e5(0x163),'payment\x20successfull'),_0x491061['redirect']('/all_sales/view');}catch(_0x389b61){console[_0xf320e5(0xea)](_0x389b61);}}),router[a0_0x4c2303(0x122)]('/invoice/:id',auth,async(_0x43bb18,_0x1ca2a8)=>{var _0x131ae9=a0_0x4c2303;try{const {username:_0xca27be,email:_0x4fdd52,role:_0xd08390}=_0x43bb18[_0x131ae9(0x197)],_0x542414=_0x43bb18[_0x131ae9(0x197)],_0x486d7b=await profile['findOne']({'email':_0x542414[_0x131ae9(0x157)]}),_0x19367a=await master_shop[_0x131ae9(0x1ce)]();console[_0x131ae9(0xea)]('master',_0x19367a);const _0x113840=_0x43bb18['params']['id'],_0x159614=await sales[_0x131ae9(0x10b)](_0x113840);console[_0x131ae9(0xea)](_0x159614);const _0x3bdd93=await customer['findOne']({'name':_0x159614[_0x131ae9(0x18f)]});console['log'](_0x3bdd93);if(_0x19367a[0x0]['language']==_0x131ae9(0x16e)){var _0x4d2e0d=users[_0x131ae9(0x13f)];console[_0x131ae9(0xea)](_0x4d2e0d);}else{if(_0x19367a[0x0][_0x131ae9(0x103)]==_0x131ae9(0x12e))var _0x4d2e0d=users['Hindi'];else{if(_0x19367a[0x0]['language']==_0x131ae9(0x177))var _0x4d2e0d=users[_0x131ae9(0x177)];else{if(_0x19367a[0x0][_0x131ae9(0x103)]=='Spanish')var _0x4d2e0d=users['Spanish'];else{if(_0x19367a[0x0][_0x131ae9(0x103)]==_0x131ae9(0xf3))var _0x4d2e0d=users[_0x131ae9(0xf3)];else{if(_0x19367a[0x0][_0x131ae9(0x103)]=='Portuguese\x20(BR)')var _0x4d2e0d=users['Portuguese'];else{if(_0x19367a[0x0][_0x131ae9(0x103)]==_0x131ae9(0x19b))var _0x4d2e0d=users[_0x131ae9(0x19b)];else{if(_0x19367a[0x0]['language']=='Arabic\x20(ae)')var _0x4d2e0d=users['Arabic'];}}}}}}}_0x1ca2a8[_0x131ae9(0x11e)](_0x131ae9(0xf1),{'success':_0x43bb18['flash']('success'),'errors':_0x43bb18[_0x131ae9(0x138)](_0x131ae9(0x14c)),'role':_0x542414,'profile':_0x486d7b,'master_shop':_0x19367a,'customers':_0x3bdd93,'sales':_0x159614,'language':_0x4d2e0d});}catch(_0x1e4713){console[_0x131ae9(0xea)](_0x1e4713);}}),router[a0_0x4c2303(0x122)](a0_0x4c2303(0x1d8),auth,async(_0x171c1e,_0x3e16d2)=>{var _0x288e5f=a0_0x4c2303;try{const {username:_0x1b89c9,email:_0x574fc8,role:_0xce78ce}=_0x171c1e[_0x288e5f(0x197)],_0x3ce7d6=_0x171c1e[_0x288e5f(0x197)],_0x48a22d=await profile[_0x288e5f(0x100)]({'email':_0x3ce7d6[_0x288e5f(0x157)]}),_0xa06d63=await master_shop[_0x288e5f(0x1ce)]();console[_0x288e5f(0xea)](_0x288e5f(0x15e),_0xa06d63);const _0x63639a=_0x171c1e[_0x288e5f(0x13b)]['id'];console[_0x288e5f(0xea)](_0x63639a);const _0x32b4bc=await sales[_0x288e5f(0x10b)](_0x63639a);console['log']('user_id',_0x32b4bc);const _0x472d44=await warehouse[_0x288e5f(0xe9)]([{'$match':{'name':_0x288e5f(0xeb),'room':'Return\x20Rooms'}},{'$unwind':_0x288e5f(0x187)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x288e5f(0x184)},'product_stock':{'$first':_0x288e5f(0x113)},'level':{'$first':_0x288e5f(0x116)},'isle':{'$first':_0x288e5f(0x140)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x288e5f(0x11c)},'secondary_code':{'$first':_0x288e5f(0x18b)},'product_code':{'$first':_0x288e5f(0x15a)}}}]);console['log'](_0x288e5f(0x171),_0x472d44);const _0xeba898=await product[_0x288e5f(0x1ce)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x288e5f(0x1ad),'name':_0x288e5f(0xeb),'warehouse_category':_0x288e5f(0x132)}},{'$group':{'_id':_0x288e5f(0x161),'name':{'$first':_0x288e5f(0x161)}}},{'$sort':{'name':0x1}}]);var _0x310a7d=['Return\x20Rooms'];if(_0xa06d63[0x0]['language']=='English\x20(US)'){var _0x4a8692=users[_0x288e5f(0x13f)];console[_0x288e5f(0xea)](_0x4a8692);}else{if(_0xa06d63[0x0]['language']==_0x288e5f(0x12e))var _0x4a8692=users[_0x288e5f(0x12e)];else{if(_0xa06d63[0x0][_0x288e5f(0x103)]=='German')var _0x4a8692=users[_0x288e5f(0x177)];else{if(_0xa06d63[0x0][_0x288e5f(0x103)]==_0x288e5f(0x1c9))var _0x4a8692=users[_0x288e5f(0x1c9)];else{if(_0xa06d63[0x0]['language']=='French')var _0x4a8692=users[_0x288e5f(0xf3)];else{if(_0xa06d63[0x0]['language']==_0x288e5f(0x141))var _0x4a8692=users[_0x288e5f(0x149)];else{if(_0xa06d63[0x0][_0x288e5f(0x103)]==_0x288e5f(0x19b))var _0x4a8692=users[_0x288e5f(0x19b)];else{if(_0xa06d63[0x0]['language']==_0x288e5f(0x1c8))var _0x4a8692=users[_0x288e5f(0x114)];}}}}}}}_0x3e16d2['render']('return_sale',{'success':_0x171c1e[_0x288e5f(0x138)](_0x288e5f(0x163)),'errors':_0x171c1e['flash'](_0x288e5f(0x14c)),'role':_0x3ce7d6,'profile':_0x48a22d,'user':_0x32b4bc,'stock':_0x472d44,'master_shop':_0xa06d63,'unit':_0xeba898,'language':_0x4a8692,'warehouses':warehouse_data,'rooms':_0x310a7d});}catch(_0x7b9daf){console['log'](_0x7b9daf),_0x3e16d2[_0x288e5f(0x126)](0xc8)['json']({'message':_0x7b9daf[_0x288e5f(0x1d3)]});}}),router[a0_0x4c2303(0x14a)](a0_0x4c2303(0x1d8),auth,async(_0x24f3eb,_0x42d975)=>{var _0x3644ca=a0_0x4c2303;try{const {invoice:_0x51cf9b,date:_0x2d0b78,warehouse_name:_0x42be98,product_name:_0x7e76ec,primary_code:_0x494ce8,secondary_code:_0x337b08,product_code:_0x2b4e2e,sales_quantity:_0x2d40ff,stocks:_0x5e9290,return_qty:_0x437fb7,Room_name:_0x568c4f,to_warehouse_name:_0x5c9999,to_Roomname:_0x2f876d,to_Room_name:_0x1557b1,note:_0x4384cd,level:_0x47a96e,isle:_0x10482c,pallet:_0x3471b6}=_0x24f3eb[_0x3644ca(0x11d)];if(typeof _0x7e76ec==_0x3644ca(0x17e))var _0x4eff2d=[_0x24f3eb[_0x3644ca(0x11d)]['product_name']],_0x479bec=[_0x24f3eb['body'][_0x3644ca(0x17f)]],_0xc47ff2=[_0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0x1d6)]],_0x5338cb=[_0x24f3eb['body'][_0x3644ca(0x1d0)]],_0x38951d=[_0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0x182)]],_0x2c0cd2=[_0x24f3eb['body'][_0x3644ca(0x199)]],_0x3ec6ff=[_0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0x1a3)]],_0x17bc3e=[_0x24f3eb['body'][_0x3644ca(0x109)]],_0x3ed290=[_0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0xe6)]],_0x535631=[_0x24f3eb[_0x3644ca(0x11d)]['types']],_0x5d2903=[_0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0xf4)]];else var _0x4eff2d=[..._0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0x167)]],_0x479bec=[..._0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0x17f)]],_0xc47ff2=[..._0x24f3eb[_0x3644ca(0x11d)]['secondary_code']],_0x5338cb=[..._0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0x1d0)]],_0x38951d=[..._0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0x182)]],_0x2c0cd2=[..._0x24f3eb['body']['stocks']],_0x3ec6ff=[..._0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0x1a3)]],_0x17bc3e=[..._0x24f3eb['body'][_0x3644ca(0x109)]],_0x3ed290=[..._0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0xe6)]],_0x535631=[..._0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0xe7)]],_0x5d2903=[..._0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0xf4)]];const _0x494878=_0x4eff2d[_0x3644ca(0x12d)](_0xe3c3bb=>{return _0xe3c3bb={'product_name':_0xe3c3bb};});_0x479bec[_0x3644ca(0x106)]((_0x4bb91a,_0x3a34d0)=>{var _0x1708b9=_0x3644ca;_0x494878[_0x3a34d0][_0x1708b9(0x17f)]=_0x4bb91a;}),_0xc47ff2[_0x3644ca(0x106)]((_0x28b151,_0xe33bc7)=>{var _0x5acec3=_0x3644ca;_0x494878[_0xe33bc7][_0x5acec3(0x1d6)]=_0x28b151;}),_0x5338cb[_0x3644ca(0x106)]((_0x4295bc,_0x23beaf)=>{var _0x1f881c=_0x3644ca;_0x494878[_0x23beaf][_0x1f881c(0x1d0)]=_0x4295bc;}),_0x38951d[_0x3644ca(0x106)]((_0x44ad38,_0x4ef05f)=>{var _0x1ace67=_0x3644ca;_0x494878[_0x4ef05f][_0x1ace67(0x134)]=_0x44ad38;}),_0x2c0cd2[_0x3644ca(0x106)]((_0x32a4c7,_0x4c8ae9)=>{_0x494878[_0x4c8ae9]['stock']=_0x32a4c7;}),_0x3ec6ff[_0x3644ca(0x106)]((_0x4716ac,_0x20404b)=>{var _0x4098b9=_0x3644ca;_0x494878[_0x20404b][_0x4098b9(0x1a3)]=_0x4716ac;}),_0x17bc3e[_0x3644ca(0x106)]((_0x10f7f7,_0x563c3a)=>{var _0x44cf19=_0x3644ca;_0x494878[_0x563c3a][_0x44cf19(0x109)]=_0x10f7f7;}),_0x3ed290[_0x3644ca(0x106)]((_0xd5a2ff,_0x8598e0)=>{var _0x3ac380=_0x3644ca;_0x494878[_0x8598e0][_0x3ac380(0xe6)]=_0xd5a2ff;}),_0x535631[_0x3644ca(0x106)]((_0x1ed74e,_0x912990)=>{_0x494878[_0x912990]['type']=_0x1ed74e;}),_0x5d2903[_0x3644ca(0x106)]((_0x2683fc,_0x3d8183)=>{var _0x568a95=_0x3644ca;_0x494878[_0x3d8183][_0x568a95(0xf4)]=_0x2683fc;});var _0x3a2f63=0x0;_0x494878[_0x3644ca(0x106)](_0x16e29c=>{var _0x39fe37=_0x3644ca;console[_0x39fe37(0xea)](_0x39fe37(0x158),_0x16e29c),(parseInt(_0x16e29c[_0x39fe37(0x134)])<parseInt(_0x16e29c['return_qty'])||parseInt(_0x16e29c[_0x39fe37(0x120)])<parseInt(_0x16e29c[_0x39fe37(0x1a3)])&&parseInt(_0x16e29c['sale_qty'])>parseInt(_0x16e29c[_0x39fe37(0x1a3)])||parseInt(_0x16e29c[_0x39fe37(0x1a3)])==0x0)&&_0x3a2f63++;});if(_0x3a2f63!=0x0)return _0x24f3eb[_0x3644ca(0x138)](_0x3644ca(0x14c),_0x3644ca(0x133)),_0x42d975[_0x3644ca(0x12a)](_0x3644ca(0x102));const _0xa52074=await sales[_0x3644ca(0x100)]({'invoice':_0x51cf9b});console[_0x3644ca(0xea)](_0xa52074),_0xa52074[_0x3644ca(0x153)]='True';const _0x104fe8=await _0xa52074[_0x3644ca(0x1ac)](),_0x2ed60b=new sales_return({'invoice':_0x51cf9b,'customer':_0x24f3eb['body'][_0x3644ca(0x18f)],'date':_0x2d0b78,'warehouse_name':_0x42be98,'room':_0x568c4f,'ToWarehouse':_0x5c9999,'ToRoom':_0x1557b1,'return_sale':_0x494878,'note':_0x4384cd}),_0x16543b=await _0x2ed60b[_0x3644ca(0x1ac)]();console[_0x3644ca(0xea)](_0x2ed60b);const _0x2d2f1e=await sales_return[_0x3644ca(0x100)]({'invoice':_0x51cf9b}),_0x334922=await warehouse[_0x3644ca(0x100)]({'name':_0x5c9999,'room':_0x1557b1});_0x2d2f1e[_0x3644ca(0x131)][_0x3644ca(0x106)](_0x411fe8=>{var _0x2432ae=_0x3644ca,_0x573c72=0x0;const _0x2c1079=_0x334922['product_details'][_0x2432ae(0x12d)](_0x4ad310=>{var _0x118ad3=_0x2432ae;_0x4ad310[_0x118ad3(0x167)]==_0x411fe8[_0x118ad3(0x167)]&&_0x4ad310['floorlevel']==_0x411fe8[_0x118ad3(0xf4)]&&_0x4ad310[_0x118ad3(0x1df)]==_0x411fe8[_0x118ad3(0x1df)]&&_0x4ad310[_0x118ad3(0xe6)]==_0x411fe8['bin']&&_0x4ad310['bay']==_0x411fe8[_0x118ad3(0x109)]&&(_0x4ad310['product_stock']=parseInt(_0x4ad310[_0x118ad3(0xed)])+parseInt(_0x411fe8[_0x118ad3(0x1a3)]),_0x573c72++);});_0x573c72=='0'&&(_0x334922[_0x2432ae(0x1c4)]=_0x334922['product_details'][_0x2432ae(0x165)]({'product_name':_0x411fe8[_0x2432ae(0x167)],'product_stock':_0x411fe8[_0x2432ae(0x1a3)],'primary_code':_0x411fe8[_0x2432ae(0x17f)],'secondary_code':_0x411fe8[_0x2432ae(0x1d6)],'product_code':_0x411fe8['product_code'],'bay':_0x411fe8[_0x2432ae(0x109)],'bin':_0x411fe8[_0x2432ae(0xe6)],'type':_0x411fe8[_0x2432ae(0x1df)],'floorlevel':_0x411fe8[_0x2432ae(0xf4)]})),console['log'](_0x2432ae(0x15f),_0x334922);}),await _0x334922[_0x3644ca(0x1ac)](),console[_0x3644ca(0xea)](_0x24f3eb[_0x3644ca(0x11d)]);const _0x11d725=new c_payment_data({'invoice':_0x51cf9b,'customer':_0x24f3eb['body'][_0x3644ca(0x18f)],'reason':'Sale\x20Return'});await _0x11d725[_0x3644ca(0x1ac)]();const _0x50456b=await master_shop[_0x3644ca(0x1ce)]();console[_0x3644ca(0xea)]('add\x20post',_0x50456b[0x0][_0x3644ca(0x185)]);const _0x53ead7=await email_settings['findOne'](),_0x4b4360=await customer[_0x3644ca(0x100)]({'name':_0x24f3eb[_0x3644ca(0x11d)][_0x3644ca(0x18f)]});console['log']('customer_data',_0x4b4360);_0x50456b[0x0][_0x3644ca(0x10f)]==0x1?(right_currency=_0x50456b[0x0][_0x3644ca(0x105)],left_currency=''):(right_currency='',left_currency=_0x50456b[0x0]['currency']);var _0x12dc45=_0x4eff2d,_0x226a29=_0x3ec6ff,_0x7fc3b5='',_0x12e6fe;for(_0x12e6fe in _0x12dc45){_0x7fc3b5+=_0x3644ca(0x1af)+_0x3644ca(0x121)+_0x12dc45[_0x12e6fe]+_0x3644ca(0x186)+_0x3644ca(0x121)+_0x226a29[_0x12e6fe]+_0x3644ca(0x186)+'</tr>';}console[_0x3644ca(0xea)](_0x3644ca(0x176),_0x7fc3b5);let _0x443ecd=nodemailer[_0x3644ca(0x159)]({'service':'gmail','auth':{'user':_0x53ead7['email'],'pass':_0x53ead7[_0x3644ca(0x19e)]}}),_0x77a062={'from':_0x53ead7[_0x3644ca(0x157)],'to':_0x4b4360[_0x3644ca(0x157)],'subject':_0x3644ca(0x1ca),'attachments':[{'filename':_0x3644ca(0x1e3),'path':__dirname+_0x3644ca(0x147)+_0x3644ca(0x15b)+_0x50456b[0x0][_0x3644ca(0x185)],'cid':_0x3644ca(0x117)}],'html':_0x3644ca(0x173)+_0x3644ca(0x1e5)+'</head><body>'+_0x3644ca(0x1e7)+_0x3644ca(0x1c6)+_0x3644ca(0x1e7)+_0x3644ca(0x1e1)+_0x3644ca(0x144)+_0x3644ca(0x1e7)+'<h2>\x20'+_0x50456b[0x0][_0x3644ca(0xfa)]+_0x3644ca(0x125)+_0x3644ca(0x144)+'</div>'+_0x3644ca(0xe2)+_0x3644ca(0x1e7)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x3644ca(0x175)+_0x51cf9b+'\x20'+_0x3644ca(0x1d7)+_0x3644ca(0x195)+_0x2d0b78+'\x20'+_0x3644ca(0x146)+_0x3644ca(0x14f)+_0x3644ca(0x144)+_0x3644ca(0x166)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x3644ca(0x1d2)+_0x3644ca(0x180)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x3644ca(0x191)+_0x3644ca(0xf2)+_0x3644ca(0x162)+_0x3644ca(0x1a1)+'\x20'+_0x7fc3b5+'\x20'+_0x3644ca(0x1e9)+_0x3644ca(0x198)+_0x3644ca(0x1e7)+'<strong>\x20Regards\x20</strong>'+_0x3644ca(0x189)+_0x50456b[0x0]['site_title']+'</h5>'+_0x3644ca(0x144)+_0x3644ca(0x144)+_0x3644ca(0x145)};_0x443ecd['sendMail'](_0x77a062,function(_0x4e65ce,_0x256c44){var _0x28d29d=_0x3644ca;_0x4e65ce?(console[_0x28d29d(0xea)](_0x4e65ce),console[_0x28d29d(0xea)](_0x28d29d(0x14b))):console[_0x28d29d(0xea)]('Email\x20sent\x20successfully');}),_0x24f3eb['flash'](_0x3644ca(0x163),_0x3644ca(0x112)),_0x42d975[_0x3644ca(0x12a)](_0x3644ca(0x1cc));}catch(_0xf55dcb){console['log'](_0xf55dcb),_0x42d975[_0x3644ca(0x126)](0xc8)[_0x3644ca(0x142)]({'message1':_0xf55dcb[_0x3644ca(0x1d3)]});}}),router[a0_0x4c2303(0x122)](a0_0x4c2303(0x130),auth,async(_0x267814,_0x25fb4a)=>{var _0x20e7c4=a0_0x4c2303;try{const {username:_0x550a90,email:_0x48b4ff,role:_0x2ba128}=_0x267814[_0x20e7c4(0x197)],_0x561a18=_0x267814[_0x20e7c4(0x197)],_0x19c81c=await profile['findOne']({'email':_0x561a18[_0x20e7c4(0x157)]}),_0x3dfb33=await master_shop['find']();console[_0x20e7c4(0xea)](_0x20e7c4(0x10d),_0x3dfb33);const _0x5f16c1=_0x267814[_0x20e7c4(0x13b)]['id'],_0x571adc=await sales[_0x20e7c4(0x10b)](_0x5f16c1);console['log']('barcode\x20user_id',_0x571adc);if(_0x3dfb33[0x0][_0x20e7c4(0x103)]=='English\x20(US)')var _0x500e74=users[_0x20e7c4(0x13f)];else{if(_0x3dfb33[0x0]['language']==_0x20e7c4(0x12e))var _0x500e74=users['Hindi'];else{if(_0x3dfb33[0x0][_0x20e7c4(0x103)]==_0x20e7c4(0x177))var _0x500e74=users['German'];else{if(_0x3dfb33[0x0][_0x20e7c4(0x103)]==_0x20e7c4(0x1c9))var _0x500e74=users[_0x20e7c4(0x1c9)];else{if(_0x3dfb33[0x0]['language']==_0x20e7c4(0xf3))var _0x500e74=users['French'];else{if(_0x3dfb33[0x0]['language']=='Portuguese\x20(BR)')var _0x500e74=users['Portuguese'];else{if(_0x3dfb33[0x0][_0x20e7c4(0x103)]==_0x20e7c4(0x19b))var _0x500e74=users[_0x20e7c4(0x19b)];else{if(_0x3dfb33[0x0][_0x20e7c4(0x103)]==_0x20e7c4(0x1c8))var _0x500e74=users[_0x20e7c4(0x114)];}}}}}}}_0x25fb4a['render'](_0x20e7c4(0x108),{'success':_0x267814[_0x20e7c4(0x138)](_0x20e7c4(0x163)),'errors':_0x267814[_0x20e7c4(0x138)](_0x20e7c4(0x14c)),'role':_0x561a18,'profile':_0x19c81c,'alldata':_0x571adc,'master_shop':_0x3dfb33,'language':_0x500e74});}catch(_0x3b1f79){console['log'](_0x3b1f79);}}),router[a0_0x4c2303(0x14a)](a0_0x4c2303(0x1e0),async(_0x364c6c,_0xf56d00)=>{var _0x5a913f=a0_0x4c2303;const {product_code:_0x5be98f,warehouse_name:_0x1c9e6e,rooms_data:_0xd1a78c,Roomslist:_0x547ae9}=_0x364c6c[_0x5a913f(0x11d)],_0x3f9417=_0x547ae9[_0x5a913f(0x196)](','),_0x259a46=[];async function _0x549204(_0x192f0c){var _0x2cc4c1=_0x5a913f;const _0x546cfa=await warehouse[_0x2cc4c1(0xe9)]([{'$match':{'name':_0x1c9e6e,'room':_0x192f0c}},{'$unwind':_0x2cc4c1(0x187)},{'$match':{'product_details.primary_code':_0x5be98f}},{'$group':{'_id':_0x2cc4c1(0xe8),'name':{'$first':_0x2cc4c1(0x184)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2cc4c1(0x11c)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2cc4c1(0x15a)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2cc4c1(0x11a)},'type':{'$first':_0x2cc4c1(0x129)},'pallet':{'$first':_0x2cc4c1(0x1d1)},'unit':{'$first':_0x2cc4c1(0x150)},'secondary_unit':{'$first':_0x2cc4c1(0x148)},'storage':{'$first':_0x2cc4c1(0x13a)},'rack':{'$first':_0x2cc4c1(0x136)},'expiry_date':{'$first':_0x2cc4c1(0x1e8)},'production_date':{'$first':_0x2cc4c1(0x118)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2cc4c1(0x137)},'product_cat':{'$first':_0x2cc4c1(0x1cf)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2cc4c1(0x1dd)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x2cc4c1(0xfe)},'actual_uom':{'$first':_0x2cc4c1(0x1b3)}}}]),_0x38ab96=await warehouse['aggregate']([{'$match':{'name':_0x1c9e6e,'room':_0x192f0c}},{'$unwind':_0x2cc4c1(0x187)},{'$match':{'product_details.secondary_code':_0x5be98f}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2cc4c1(0x184)},'product_stock':{'$first':_0x2cc4c1(0x113)},'primary_code':{'$first':_0x2cc4c1(0x11c)},'secondary_code':{'$first':_0x2cc4c1(0x18b)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2cc4c1(0x127)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2cc4c1(0x129)},'pallet':{'$first':_0x2cc4c1(0x1d1)},'unit':{'$first':_0x2cc4c1(0x150)},'secondary_unit':{'$first':_0x2cc4c1(0x148)},'storage':{'$first':_0x2cc4c1(0x13a)},'rack':{'$first':_0x2cc4c1(0x136)},'expiry_date':{'$first':_0x2cc4c1(0x1e8)},'production_date':{'$first':_0x2cc4c1(0x118)},'maxPerUnit':{'$first':_0x2cc4c1(0x1c0)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2cc4c1(0x1dd)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x546cfa[_0x2cc4c1(0x17a)]>0x0)_0x259a46[_0x2cc4c1(0x1db)](_0x546cfa);else _0x38ab96[_0x2cc4c1(0x17a)]>0x0&&_0x259a46[_0x2cc4c1(0x1db)](_0x38ab96);}const _0x548488=_0x3f9417[_0x5a913f(0x12d)](_0xd06244=>_0x549204(_0xd06244));await Promise[_0x5a913f(0x16b)](_0x548488),_0xf56d00[_0x5a913f(0x142)](_0x259a46);}),module[a0_0x4c2303(0x19c)]=router;