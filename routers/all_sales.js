function a0_0xdac1(){var _0x49adce=['find','slice','id_transaction_from','sendMail','success','quantity','$product_details.bin','<tbody\x20style=\x22text-align:\x20center;\x22>','currency_placement','gmail','Level','$product','isAllowEdit','push','product_code','$product_details._id','/view','<h5\x20style=\x22text-align:\x20left;\x22>','split','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','English\x20(US)','batch_code','False','4biPTtY','\x20Order\x20Date\x20:\x20','then','barcode\x20user_id','930PNcmoG','$invoice','map','types','</div>','$sale_product.bin','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','staff','Sales\x20Update\x20successfully','room','29336MSbBos','382198ZrUYNv','Portuguese\x20(BR)','$product_details.primary_code','expiry_date','product_name','</td>','email','delivery_date','length','product_details','add\x20post','RoomAssigned','</tbody>','Arabic\x20(ae)','master','catch','$room','Hindi','requested_qty','secondary_code','$product_details.storage','../models/all_models','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.production_date','password','351XeFDuU','status','forEach','Spanish','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.maxPerUnit','Portuguese','errors','storage','</body></html>','actual_qty','stock_data','nodemailer','$date','maxperunit','Email\x20sent\x20successfully','createTransport','floorlevel','103860fXBcGY','\x20Order\x20Number\x20:\x20','flash','customer_data','Receiving\x20Area','primary_code','$product_details.expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','sale_product','../middleware/auth','/view/add_sale/product','<h2>\x20','floor','<table\x20style=\x22width:\x20100%\x20!important;\x22>','427MFlNmO','max_per_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','OUT-','max','Floor','get','save','$customers_docs','purchases_data','$_id','customers_docs','room_name','</table>','English','return_sale','logo','Raw\x20Materials','received_amount','sale_qty','/upload/','/view/:id','Received\x20Payment\x20For\x20Sale','$product_details.invoice','host','<div>','$product_details.type','<hr\x20class=\x22my-3\x22>','quantity_notConverted','/all_sales/view','image','True','all_sales','unit','carton','$product_details.level','<h5>','findOne','$warehouse_name','user','delivery_code','$sale_product.type','French','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Sales\x20Mail','SCRN','/../public','$finalize','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','rack','finalize','Sales\x20Add\x20successfully','$product_details.floorlevel','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</h5>','bin','11352072fYetdi','Ambient','bay','$sale_product.floorlevel','1302372PvSAEG','post','findById','express','json','filter','primary_unit','<span\x20style=\x22float:\x20right;\x22>','log','prod_invoice','\x20</h2>','prod_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$isAllowEdit','product_list','type','all_sales_barcode','edit_sales','level','$return_data','Logo.png','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','render','concat','body','aggregate','</thead>','Shelves','$product_details.delivery_date','due_amount','secondary_unit','../public/language/languages.json','10932eZuOkN','Chinese','foreach\x20newproduct','/view/return_sales/:id','</head><body>','$product_details.product_code','/all_sales/preview/','language','Return\x20Goods','$customer','role','3493160zkXxZA','params','customers','string','abs','message','$product_details.secondary_code','Error\x20Occurs','<tr>','stock','add_sales','<strong>\x20Regards\x20</strong>','date','getDate','$product_details.unit','amount','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.product_stock','</tr>','customer','redirect','payment\x20successfull','/give_payment/:id','Enclosed','Enabled','stocks','getMonth','/view/add_sales','site_title','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<html><head><title></title>','$product_details.product_cat','$product_details.rack','$sale_product.quantity','port','$product_details.bay','invoice','/view/add_sales/:id','</span>','$product_details','$product_details.actual_uom','$product_details.secondary_unit','$product_details.delivery_code','return_data','$product_details.isle','all','$product_details.product_name','$sale_product','Return\x20Rooms','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','actual_uom','warehouse','return_qty','prod_cat','$product.product_name','Arabic','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','/invoice/:id','name','German','RMSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','note','toString','error','$name','final','sales_invoice','sales_quantity','$product_details.batch_code','warehouse_name','product_data','2NsmTWG'];a0_0xdac1=function(){return _0x49adce;};return a0_0xdac1();}var a0_0x2175cb=a0_0x4637;(function(_0x3abd49,_0x5f54d5){var _0x4e2c02=a0_0x4637,_0x4105a5=_0x3abd49();while(!![]){try{var _0x4f7575=parseInt(_0x4e2c02(0x23b))/0x1*(parseInt(_0x4e2c02(0x213))/0x2)+-parseInt(_0x4e2c02(0x19e))/0x3*(parseInt(_0x4e2c02(0x22b))/0x4)+parseInt(_0x4e2c02(0x22f))/0x5*(-parseInt(_0x4e2c02(0x1bf))/0x6)+parseInt(_0x4e2c02(0x162))/0x7*(-parseInt(_0x4e2c02(0x23a))/0x8)+parseInt(_0x4e2c02(0x140))/0x9*(-parseInt(_0x4e2c02(0x152))/0xa)+parseInt(_0x4e2c02(0x1ca))/0xb+parseInt(_0x4e2c02(0x19a))/0xc;if(_0x4f7575===_0x5f54d5)break;else _0x4105a5['push'](_0x4105a5['shift']());}catch(_0x34ae28){_0x4105a5['push'](_0x4105a5['shift']());}}}(a0_0xdac1,0x3b927));const express=require(a0_0x2175cb(0x1a1)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x2175cb(0x13c)),auth=require(a0_0x2175cb(0x15d)),nodemailer=require(a0_0x2175cb(0x14c)),users=require(a0_0x2175cb(0x1be));router[a0_0x2175cb(0x168)](a0_0x2175cb(0x224),auth,async(_0x3b8687,_0x1a2884)=>{var _0x28d8ab=a0_0x2175cb;try{const {username:_0x229045,email:_0x398854,role:_0x3d6aff}=_0x3b8687[_0x28d8ab(0x189)],_0x2024dd=_0x3b8687[_0x28d8ab(0x189)],_0x5995b9=await profile[_0x28d8ab(0x187)]({'email':_0x2024dd[_0x28d8ab(0x12d)]}),_0x202d02=await master_shop[_0x28d8ab(0x214)]();let _0x5099b6;if(_0x2024dd['role']=='staff'){const _0x272ff3=await staff[_0x28d8ab(0x187)]({'email':_0x2024dd[_0x28d8ab(0x12d)]});_0x5099b6=await sales[_0x28d8ab(0x1b8)]([{'$lookup':{'from':_0x28d8ab(0x1cc),'localField':_0x28d8ab(0x1dd),'foreignField':_0x28d8ab(0x205),'as':'customers_docs'}},{'$unwind':_0x28d8ab(0x16a)},{'$unwind':_0x28d8ab(0x1fa)},{'$group':{'_id':_0x28d8ab(0x16c),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x28d8ab(0x14d)},'warehouse_name':{'$first':_0x28d8ab(0x188)},'sale_product':{'$push':_0x28d8ab(0x1fa)},'note':{'$first':_0x28d8ab(0x15a)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x28d8ab(0x16a)},'total_saleproduct_quantity':{'$sum':_0x28d8ab(0x1ec)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x28d8ab(0x234)},'type':{'$addToSet':_0x28d8ab(0x18b)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x28d8ab(0x191)},'isAllowEdit':{'$first':_0x28d8ab(0x1ab)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x5099b6=await sales['aggregate']([{'$lookup':{'from':_0x28d8ab(0x1cc),'localField':_0x28d8ab(0x1dd),'foreignField':'name','as':_0x28d8ab(0x16d)}},{'$unwind':'$customers_docs'},{'$unwind':_0x28d8ab(0x1fa)},{'$group':{'_id':_0x28d8ab(0x16c),'invoice':{'$first':_0x28d8ab(0x230)},'customers':{'$first':_0x28d8ab(0x1c8)},'date':{'$first':_0x28d8ab(0x14d)},'warehouse_name':{'$first':_0x28d8ab(0x188)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x28d8ab(0x1b1)},'customers_docs':{'$first':_0x28d8ab(0x16a)},'total_saleproduct_quantity':{'$sum':_0x28d8ab(0x1ec)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x28d8ab(0x234)},'type':{'$addToSet':_0x28d8ab(0x18b)},'pallet':{'$addToSet':_0x28d8ab(0x19d)},'finalize':{'$first':_0x28d8ab(0x191)},'isAllowEdit':{'$first':_0x28d8ab(0x1ab)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x28d8ab(0x1a6)]('sales\x20all_data',_0x5099b6);if(_0x202d02[0x0][_0x28d8ab(0x1c6)]=='English\x20(US)'){var _0x312fc7=users[_0x28d8ab(0x170)];console[_0x28d8ab(0x1a6)](_0x312fc7);}else{if(_0x202d02[0x0][_0x28d8ab(0x1c6)]=='Hindi')var _0x312fc7=users[_0x28d8ab(0x138)];else{if(_0x202d02[0x0]['language']==_0x28d8ab(0x206))var _0x312fc7=users[_0x28d8ab(0x206)];else{if(_0x202d02[0x0][_0x28d8ab(0x1c6)]==_0x28d8ab(0x143))var _0x312fc7=users[_0x28d8ab(0x143)];else{if(_0x202d02[0x0]['language']=='French')var _0x312fc7=users[_0x28d8ab(0x18c)];else{if(_0x202d02[0x0]['language']==_0x28d8ab(0x23c))var _0x312fc7=users[_0x28d8ab(0x146)];else{if(_0x202d02[0x0][_0x28d8ab(0x1c6)]==_0x28d8ab(0x1c0))var _0x312fc7=users[_0x28d8ab(0x1c0)];else{if(_0x202d02[0x0][_0x28d8ab(0x1c6)]==_0x28d8ab(0x134))var _0x312fc7=users[_0x28d8ab(0x202)];}}}}}}}_0x1a2884[_0x28d8ab(0x1b5)](_0x28d8ab(0x182),{'success':_0x3b8687[_0x28d8ab(0x154)](_0x28d8ab(0x218)),'errors':_0x3b8687[_0x28d8ab(0x154)](_0x28d8ab(0x147)),'sales':_0x5099b6,'profile':_0x5995b9,'role':_0x2024dd,'master_shop':_0x202d02,'language':_0x312fc7});}catch(_0x1155fa){console[_0x28d8ab(0x1a6)](_0x1155fa);}});function a0_0x4637(_0x2f0130,_0x3e42d4){var _0xdac1b5=a0_0xdac1();return a0_0x4637=function(_0x4637d3,_0x326a61){_0x4637d3=_0x4637d3-0x12d;var _0x3da0d6=_0xdac1b5[_0x4637d3];return _0x3da0d6;},a0_0x4637(_0x2f0130,_0x3e42d4);}async function getRandom8DigitNumber(){var _0x1e8910=a0_0x2175cb;const _0x18dc1a=0x989680,_0x10ddd5=0x5f5e0ff,_0xbd99bb=Math[_0x1e8910(0x160)](Math['random']()*(_0x10ddd5-_0x18dc1a+0x1))+_0x18dc1a;var _0x22e7ba;const _0xc3d722=await sales[_0x1e8910(0x187)]({'invoice':_0x1e8910(0x165)+_0xbd99bb});return _0xc3d722&&_0xc3d722[_0x1e8910(0x12f)]>0x0?_0x22e7ba=_0x1e8910(0x165)+_0xbd99bb:_0x22e7ba=_0x1e8910(0x165)+_0xbd99bb,_0x22e7ba;}router[a0_0x2175cb(0x168)](a0_0x2175cb(0x1e5),auth,async(_0x54c3df,_0x13c16b)=>{var _0x30f83e=a0_0x2175cb;try{const {username:_0xb43913,email:_0x1287f1,role:_0x36cf0a}=_0x54c3df[_0x30f83e(0x189)],_0x45f72d=_0x54c3df[_0x30f83e(0x189)],_0x1b2ac1=await profile[_0x30f83e(0x187)]({'email':_0x45f72d[_0x30f83e(0x12d)]}),_0x439740=await master_shop[_0x30f83e(0x214)](),_0x1fbeec=await customer[_0x30f83e(0x214)]({});let _0xdea475;if(_0x45f72d[_0x30f83e(0x1c9)]==_0x30f83e(0x237)){const _0x4aed07=await staff['findOne']({'email':_0x45f72d[_0x30f83e(0x12d)]});_0xdea475=await warehouse[_0x30f83e(0x1b8)]([{'$match':{'status':_0x30f83e(0x1e2),'name':_0x4aed07[_0x30f83e(0x1fe)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x30f83e(0x1c7)}}},{'$group':{'_id':_0x30f83e(0x20c),'name':{'$first':_0x30f83e(0x20c)}}},{'$sort':{'name':0x1}}]);}else _0xdea475=await warehouse[_0x30f83e(0x1b8)]([{'$match':{'status':_0x30f83e(0x1e2),'warehouse_category':_0x30f83e(0x173),'name':{'$ne':_0x30f83e(0x1c7)}}},{'$group':{'_id':'$name','name':{'$first':_0x30f83e(0x20c)}}},{'$sort':{'name':0x1}}]);const _0x40dbc3=await product['find']({});var _0x46fb73=[_0x30f83e(0x19b),_0x30f83e(0x1e1)];const _0x3b662a=await sales[_0x30f83e(0x214)]({}),_0x4d3480=_0x3b662a[_0x30f83e(0x12f)]+0x1,_0x13fe28=_0x30f83e(0x165)+_0x4d3480[_0x30f83e(0x20a)]()['padStart'](0x5,'0');if(_0x439740[0x0][_0x30f83e(0x1c6)]==_0x30f83e(0x228)){var _0x26300c=users[_0x30f83e(0x170)];console[_0x30f83e(0x1a6)](_0x26300c);}else{if(_0x439740[0x0][_0x30f83e(0x1c6)]==_0x30f83e(0x138))var _0x26300c=users[_0x30f83e(0x138)];else{if(_0x439740[0x0]['language']==_0x30f83e(0x206))var _0x26300c=users[_0x30f83e(0x206)];else{if(_0x439740[0x0][_0x30f83e(0x1c6)]=='Spanish')var _0x26300c=users[_0x30f83e(0x143)];else{if(_0x439740[0x0][_0x30f83e(0x1c6)]==_0x30f83e(0x18c))var _0x26300c=users[_0x30f83e(0x18c)];else{if(_0x439740[0x0][_0x30f83e(0x1c6)]==_0x30f83e(0x23c))var _0x26300c=users['Portuguese'];else{if(_0x439740[0x0][_0x30f83e(0x1c6)]==_0x30f83e(0x1c0))var _0x26300c=users[_0x30f83e(0x1c0)];else{if(_0x439740[0x0][_0x30f83e(0x1c6)]==_0x30f83e(0x134))var _0x26300c=users[_0x30f83e(0x202)];}}}}}}}const _0x4758e3=getRandom8DigitNumber();_0x4758e3[_0x30f83e(0x22d)](_0x5170e1=>{var _0x440a2a=_0x30f83e;_0x13c16b[_0x440a2a(0x1b5)](_0x440a2a(0x1d4),{'success':_0x54c3df[_0x440a2a(0x154)](_0x440a2a(0x218)),'errors':_0x54c3df['flash']('errors'),'role':_0x45f72d,'profile':_0x1b2ac1,'customer':_0x1fbeec,'warehouse':_0xdea475,'product':_0x40dbc3,'invoice':_0x5170e1,'master_shop':_0x439740,'language':_0x26300c,'rooms_data':_0x46fb73});})[_0x30f83e(0x136)](_0x90691a=>{var _0x284586=_0x30f83e;_0x54c3df[_0x284586(0x154)]('errors',_0x284586(0x1da)),_0x13c16b[_0x284586(0x1de)](_0x284586(0x17f));});}catch(_0xd82845){console[_0x30f83e(0x1a6)](_0xd82845);}}),router[a0_0x2175cb(0x168)](a0_0x2175cb(0x1f0),auth,async(_0x478035,_0x51cc01)=>{var _0x20711f=a0_0x2175cb;try{const _0x264710=_0x478035['params']['id'];console['log'](_0x264710);const _0x553696=await product[_0x20711f(0x214)](),_0x5eca38=await purchases[_0x20711f(0x1b8)]([{'$match':{'warehouse_name':_0x264710}},{'$unwind':_0x20711f(0x21f)},{'$group':{'_id':_0x20711f(0x201)}}]);console[_0x20711f(0x1a6)](_0x20711f(0x16b),_0x5eca38),_0x51cc01[_0x20711f(0x141)](0xc8)['json']({'purchases_data':_0x5eca38,'product_data':_0x553696});}catch(_0x258999){console[_0x20711f(0x1a6)](_0x258999);}}),router[a0_0x2175cb(0x19f)](a0_0x2175cb(0x15e),auth,async(_0x2075a9,_0x4a9465)=>{var _0x493646=a0_0x2175cb;try{const {warehouse_data:_0x1138c0,product_data:_0x481ad5}=_0x2075a9[_0x493646(0x1b7)];console['log'](_0x2075a9[_0x493646(0x1b7)][_0x493646(0x212)]);;const _0x17acea=await master_shop[_0x493646(0x214)]();console['log'](_0x493646(0x135),_0x17acea);const _0x197aa1=await product['findOne']({'name':_0x481ad5});console['log']('product',_0x197aa1);const _0x3ac341=await warehouse['aggregate']([{'$match':{'name':_0x1138c0}},{'$unwind':_0x493646(0x1f2)},{'$match':{'product_details.product_name':_0x481ad5}},{'$group':{'_id':_0x493646(0x1f9),'product_stock':{'$first':_0x493646(0x1db)}}}]);console[_0x493646(0x1a6)](_0x493646(0x14b),_0x3ac341),_0x4a9465[_0x493646(0x141)](0xc8)[_0x493646(0x1a2)]({'master':_0x17acea,'new_product':_0x197aa1,'stock_data':_0x3ac341});}catch(_0x8169cb){console[_0x493646(0x1a6)](_0x8169cb);}}),router[a0_0x2175cb(0x19f)]('/view/add_sales',auth,async(_0x4bbf8c,_0x3d882c)=>{var _0x32d4d4=a0_0x2175cb;try{const {invoice:_0x501aa6,date:_0x519f71,warehouse_name:_0x4d70ee,product_name:_0x369176,stock:_0x187fdc,quantity:_0x56a3ed,note:_0x47722f,room:_0x456366,primary_code:_0x4a48ac,secondary_code:_0x2b393e,prod_code:_0xff39dc,level:_0x4215ec,isle:_0x2112e9,pallet:_0x153f5f,batch_code:_0x2b125c,SCRN:_0x367a89,expiry_date:_0x58e1ad}=_0x4bbf8c[_0x32d4d4(0x1b7)];if(typeof _0x369176==_0x32d4d4(0x1cd))var _0x2798d5=[_0x4bbf8c['body']['product_name']],_0x3b5b6b=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x1d3)]],_0x3acc8c=[_0x4bbf8c['body'][_0x32d4d4(0x184)]],_0x335546=[_0x4bbf8c[_0x32d4d4(0x1b7)]['primary_code']],_0x584f07=[_0x4bbf8c['body'][_0x32d4d4(0x13a)]],_0x3878dc=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x1a9)]],_0x44e3d5=[_0x4bbf8c[_0x32d4d4(0x1b7)]['level']],_0x7762d3=[_0x4bbf8c['body']['primary_unit']],_0x3f6cac=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x1bd)]],_0x581e51=[_0x4bbf8c[_0x32d4d4(0x1b7)]['batch_code']],_0x4a5f05=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x23e)]],_0xbde293=[_0x4bbf8c[_0x32d4d4(0x1b7)]['max_per_unit']],_0x3b1628=[_0x4bbf8c[_0x32d4d4(0x1b7)]['production_date']],_0x1404bd=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x139)]],_0x46bf88=[_0x4bbf8c[_0x32d4d4(0x1b7)]['delivery_date']],_0x2a55d9=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x18a)]],_0x47c625=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x200)]],_0x2d2ab7=[_0x4bbf8c[_0x32d4d4(0x1b7)]['quantity']],_0x28d8c7=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x132)]],_0x11db7e=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x1a7)]],_0x4fa53c=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x14a)]],_0x614850=[_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x1fd)]],_0x23ba73=[_0x4bbf8c['body']['id_transact']];else var _0x2798d5=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x23f)]],_0x3b5b6b=[..._0x4bbf8c[_0x32d4d4(0x1b7)]['stock']],_0x3acc8c=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x184)]],_0x335546=[..._0x4bbf8c[_0x32d4d4(0x1b7)]['primary_code']],_0x584f07=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x13a)]],_0x3878dc=[..._0x4bbf8c['body']['prod_code']],_0x44e3d5=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x1b0)]],_0x7762d3=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x1a4)]],_0x3f6cac=[..._0x4bbf8c[_0x32d4d4(0x1b7)]['secondary_unit']],_0x581e51=[..._0x4bbf8c['body']['batch_code']],_0x4a5f05=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x23e)]],_0xbde293=[..._0x4bbf8c[_0x32d4d4(0x1b7)]['max_per_unit']],_0x3b1628=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x1b3)]],_0x1404bd=[..._0x4bbf8c['body']['requested_qty']],_0x46bf88=[..._0x4bbf8c[_0x32d4d4(0x1b7)]['delivery_date']],_0x2a55d9=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x18a)]],_0x47c625=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x200)]],_0x2d2ab7=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x219)]],_0x28d8c7=[..._0x4bbf8c['body']['RoomAssigned']],_0x11db7e=[..._0x4bbf8c[_0x32d4d4(0x1b7)]['prod_invoice']],_0x4fa53c=[..._0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x14a)]],_0x614850=[..._0x4bbf8c[_0x32d4d4(0x1b7)]['actual_uom']],_0x23ba73=[..._0x4bbf8c[_0x32d4d4(0x1b7)]['id_transact']];const _0x1b6d8e=_0x2798d5[_0x32d4d4(0x231)](_0x3a56c3=>{return _0x3a56c3={'product_name':_0x3a56c3};});_0x3b5b6b['forEach']((_0x458175,_0x5048dc)=>{var _0x78ed6=_0x32d4d4;_0x1b6d8e[_0x5048dc][_0x78ed6(0x1d3)]=Math[_0x78ed6(0x1ce)](_0x458175);}),_0x4fa53c['forEach']((_0x5274dc,_0xec8e1c)=>{var _0x39c021=_0x32d4d4;_0x1b6d8e[_0xec8e1c][_0x39c021(0x14a)]=Math[_0x39c021(0x1ce)](_0x5274dc);}),_0x614850[_0x32d4d4(0x142)]((_0xcda523,_0x3fcae2)=>{var _0x41ef77=_0x32d4d4;_0x1b6d8e[_0x3fcae2][_0x41ef77(0x1fd)]=_0xcda523;}),_0x23ba73[_0x32d4d4(0x142)]((_0x2505a1,_0x20266f)=>{var _0x6a729c=_0x32d4d4;_0x1b6d8e[_0x20266f][_0x6a729c(0x216)]=_0x2505a1;}),_0x3acc8c[_0x32d4d4(0x142)]((_0x52b581,_0x1fcafa)=>{var _0x458a2d=_0x32d4d4;_0x1b6d8e[_0x1fcafa][_0x458a2d(0x219)]=_0x52b581;}),_0x335546[_0x32d4d4(0x142)]((_0x420ea8,_0x44502d)=>{var _0x47a042=_0x32d4d4;_0x1b6d8e[_0x44502d][_0x47a042(0x157)]=_0x420ea8;}),_0x584f07[_0x32d4d4(0x142)]((_0xd0596,_0x32ae9c)=>{var _0x666ff7=_0x32d4d4;_0x1b6d8e[_0x32ae9c][_0x666ff7(0x13a)]=_0xd0596;}),_0x3878dc[_0x32d4d4(0x142)]((_0x1f15c5,_0x49510e)=>{var _0x342a58=_0x32d4d4;_0x1b6d8e[_0x49510e][_0x342a58(0x222)]=_0x1f15c5;}),_0x44e3d5['forEach']((_0x181eee,_0x46e621)=>{_0x28d8c7['forEach']((_0x4bbdee,_0x572ca1)=>{var _0xdbadf9=a0_0x4637;if(_0x4bbdee==_0xdbadf9(0x156)&&_0x46e621==_0x572ca1){var _0x22272e=_0x181eee[_0xdbadf9(0x215)](0x3);_0x1b6d8e[_0x46e621]['storage']=_0x181eee[0x0],_0x1b6d8e[_0x46e621][_0xdbadf9(0x193)]=_0x181eee[0x1],_0x1b6d8e[_0x46e621]['bay']=0x0,_0x1b6d8e[_0x46e621][_0xdbadf9(0x199)]=0x0,_0x1b6d8e[_0x46e621][_0xdbadf9(0x1ad)]='Floor',_0x1b6d8e[_0x46e621][_0xdbadf9(0x151)]=_0x22272e;}else{if(_0x4bbdee==_0xdbadf9(0x1ba)&&_0x46e621==_0x572ca1){var _0x22272e=_0x181eee[_0xdbadf9(0x215)](0x3);_0x1b6d8e[_0x46e621][_0xdbadf9(0x148)]=_0x181eee[0x0],_0x1b6d8e[_0x46e621]['rack']=_0x181eee[0x1],_0x1b6d8e[_0x46e621][_0xdbadf9(0x19c)]=0x0,_0x1b6d8e[_0x46e621][_0xdbadf9(0x199)]=0x0,_0x1b6d8e[_0x46e621][_0xdbadf9(0x1ad)]=_0xdbadf9(0x167),_0x1b6d8e[_0x46e621][_0xdbadf9(0x151)]=_0x181eee[0x5];}else{if(_0x46e621==_0x572ca1){var _0x3ebfa8;if(_0x181eee[0x4]=='L')_0x3ebfa8=_0xdbadf9(0x21e);else _0x181eee[0x4]=='F'&&(_0x3ebfa8='Floor');_0x1b6d8e[_0x46e621][_0xdbadf9(0x148)]=_0x181eee[0x0],_0x1b6d8e[_0x46e621][_0xdbadf9(0x193)]=_0x181eee[0x1],_0x1b6d8e[_0x46e621]['bay']=_0x181eee[0x2],_0x1b6d8e[_0x46e621][_0xdbadf9(0x199)]=_0x181eee[0x3],_0x1b6d8e[_0x46e621][_0xdbadf9(0x1ad)]=_0x3ebfa8,_0x1b6d8e[_0x46e621][_0xdbadf9(0x151)]=_0x181eee[0x5];}}}});}),_0x7762d3[_0x32d4d4(0x142)]((_0xbb7d00,_0x2b037e)=>{var _0x40b2ca=_0x32d4d4;_0x1b6d8e[_0x2b037e][_0x40b2ca(0x183)]=_0xbb7d00;}),_0x3f6cac[_0x32d4d4(0x142)]((_0x592554,_0x2546dc)=>{var _0x40569a=_0x32d4d4;_0x1b6d8e[_0x2546dc][_0x40569a(0x1bd)]=_0x592554;}),_0x581e51[_0x32d4d4(0x142)]((_0x4b114b,_0x3bbce2)=>{var _0x5bcd80=_0x32d4d4;_0x1b6d8e[_0x3bbce2][_0x5bcd80(0x229)]=_0x4b114b;}),_0x4a5f05['forEach']((_0x26f1af,_0xbc4fe)=>{var _0x4a7b69=_0x32d4d4;_0x1b6d8e[_0xbc4fe][_0x4a7b69(0x23e)]=_0x26f1af;}),_0xbde293[_0x32d4d4(0x142)]((_0x4c036f,_0x13f280)=>{var _0x1eb7ec=_0x32d4d4;_0x1b6d8e[_0x13f280][_0x1eb7ec(0x14e)]=_0x4c036f;}),_0x3b1628[_0x32d4d4(0x142)]((_0x41a4cc,_0x34ccb7)=>{var _0x5d5ed1=_0x32d4d4;_0x1b6d8e[_0x34ccb7][_0x5d5ed1(0x1b3)]=_0x41a4cc;}),_0x1404bd[_0x32d4d4(0x142)]((_0xd94e36,_0x1f8b24)=>{var _0x4569e0=_0x32d4d4;_0x1b6d8e[_0x1f8b24][_0x4569e0(0x139)]=_0xd94e36;}),_0x46bf88[_0x32d4d4(0x142)]((_0xcc17a0,_0x5538e6)=>{var _0x5a6116=_0x32d4d4;_0x1b6d8e[_0x5538e6][_0x5a6116(0x12e)]=_0xcc17a0;}),_0x2a55d9[_0x32d4d4(0x142)]((_0x49f0e4,_0x563007)=>{_0x1b6d8e[_0x563007]['delivery_code']=_0x49f0e4;}),_0x47c625[_0x32d4d4(0x142)]((_0x264a71,_0x2c401a)=>{var _0x47e82a=_0x32d4d4;_0x1b6d8e[_0x2c401a][_0x47e82a(0x200)]=_0x264a71;}),_0x2d2ab7[_0x32d4d4(0x142)]((_0x41d51d,_0x436a91)=>{var _0x1f3736=_0x32d4d4;_0x1b6d8e[_0x436a91][_0x1f3736(0x17e)]=_0x41d51d;}),_0x28d8c7[_0x32d4d4(0x142)]((_0x4e6478,_0x579fa4)=>{var _0x513271=_0x32d4d4;_0x1b6d8e[_0x579fa4][_0x513271(0x16e)]=_0x4e6478;}),_0x11db7e[_0x32d4d4(0x142)]((_0x535158,_0x517f34)=>{var _0x360653=_0x32d4d4;_0x1b6d8e[_0x517f34][_0x360653(0x1ef)]=_0x535158;});var _0x559cd9=0x0;_0x1b6d8e['forEach'](_0x3fac19=>{var _0x13b9f6=_0x32d4d4;(_0x3fac19['stock']<_0x3fac19[_0x13b9f6(0x17e)]||_0x3fac19[_0x13b9f6(0x17e)]==0x0)&&(console[_0x13b9f6(0x1a6)](_0x13b9f6(0x1c1),_0x3fac19),_0x559cd9++);});const _0x1f4583=_0x1b6d8e[_0x32d4d4(0x1a3)](_0xf53cbc=>_0xf53cbc[_0x32d4d4(0x219)]!=='0'&&_0xf53cbc['quantity']!==''),_0x220d38=new sales({'invoice':_0x501aa6,'customer':_0x4bbf8c[_0x32d4d4(0x1b7)][_0x32d4d4(0x1dd)],'date':_0x519f71,'warehouse_name':_0x4d70ee,'sale_product':_0x1f4583,'note':_0x47722f,'room':_0x456366,'primary_code':_0x4a48ac,'secondary_code':_0x2b393e,'prod_code':_0xff39dc,'SCRN':_0x367a89}),_0x1a6dc0=await _0x220d38['save']();_0x4bbf8c[_0x32d4d4(0x154)](_0x32d4d4(0x218),_0x32d4d4(0x195)),_0x3d882c[_0x32d4d4(0x1de)](_0x32d4d4(0x1c5)+_0x1a6dc0['_id']);}catch(_0x19add3){console['log'](_0x19add3);}}),router['get']('/preview/:id',auth,async(_0x337228,_0x16f9f8)=>{var _0x2f097a=a0_0x2175cb;try{const {username:_0xd89e53,email:_0x2b20b4,role:_0x12bf58}=_0x337228[_0x2f097a(0x189)],_0x78cc06=_0x337228[_0x2f097a(0x189)],_0x26436b=await profile[_0x2f097a(0x187)]({'email':_0x78cc06[_0x2f097a(0x12d)]}),_0x52eee5=await master_shop[_0x2f097a(0x214)](),_0x3ade25=_0x337228[_0x2f097a(0x1cb)]['id'],_0x4fc477=await sales[_0x2f097a(0x1a0)](_0x3ade25),_0x1c6e26=await warehouse[_0x2f097a(0x1b8)]([{'$match':{'name':_0x4fc477[_0x2f097a(0x211)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2f097a(0x223),'name':{'$first':_0x2f097a(0x1f9)},'product_stock':{'$first':_0x2f097a(0x1db)},'bay':{'$first':_0x2f097a(0x1ee)},'bin':{'$first':_0x2f097a(0x21a)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x2f097a(0x23d)},'secondary_code':{'$first':_0x2f097a(0x1d0)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2f097a(0x13b)},'rack':{'$first':_0x2f097a(0x1eb)},'expiry_date':{'$first':_0x2f097a(0x158)},'production_date':{'$first':_0x2f097a(0x13e)},'invoice':{'$first':_0x2f097a(0x179)}}}]),_0x5612a7=await customer['find']({});let _0x3470f7;if(_0x78cc06['role']==_0x2f097a(0x237)){const _0xc6458a=await staff['findOne']({'email':_0x78cc06['email']});_0x3470f7=await warehouse[_0x2f097a(0x1b8)]([{'$match':{'status':_0x2f097a(0x1e2),'name':_0xc6458a[_0x2f097a(0x1fe)]}},{'$group':{'_id':_0x2f097a(0x20c),'name':{'$first':_0x2f097a(0x20c)}}}]);}else _0x3470f7=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x2f097a(0x20c),'name':{'$first':_0x2f097a(0x20c)}}}]);const _0x3310f0=await product['find']({}),_0x2db64e=await suppliers['find']({});if(_0x52eee5[0x0]['language']==_0x2f097a(0x228)){var _0x506a93=users[_0x2f097a(0x170)];console[_0x2f097a(0x1a6)](_0x506a93);}else{if(_0x52eee5[0x0]['language']==_0x2f097a(0x138))var _0x506a93=users[_0x2f097a(0x138)];else{if(_0x52eee5[0x0][_0x2f097a(0x1c6)]==_0x2f097a(0x206))var _0x506a93=users['German'];else{if(_0x52eee5[0x0][_0x2f097a(0x1c6)]==_0x2f097a(0x143))var _0x506a93=users[_0x2f097a(0x143)];else{if(_0x52eee5[0x0][_0x2f097a(0x1c6)]==_0x2f097a(0x18c))var _0x506a93=users[_0x2f097a(0x18c)];else{if(_0x52eee5[0x0][_0x2f097a(0x1c6)]==_0x2f097a(0x23c))var _0x506a93=users['Portuguese'];else{if(_0x52eee5[0x0][_0x2f097a(0x1c6)]==_0x2f097a(0x1c0))var _0x506a93=users[_0x2f097a(0x1c0)];else{if(_0x52eee5[0x0][_0x2f097a(0x1c6)]==_0x2f097a(0x134))var _0x506a93=users['Arabic'];}}}}}}}_0x16f9f8[_0x2f097a(0x1b5)]('edit_sales_view',{'success':_0x337228[_0x2f097a(0x154)](_0x2f097a(0x218)),'errors':_0x337228[_0x2f097a(0x154)]('errors'),'role':_0x78cc06,'profile':_0x26436b,'customer':_0x5612a7,'warehouse':_0x3470f7,'product':_0x1c6e26,'user':_0x4fc477,'master_shop':_0x52eee5,'unit':_0x3310f0,'language':_0x506a93,'suppliers':_0x2db64e});}catch(_0x14e4fc){console[_0x2f097a(0x1a6)](_0x14e4fc);}}),router[a0_0x2175cb(0x19f)]('/preview/:id',auth,async(_0x343e59,_0x532cfa)=>{var _0x1ee711=a0_0x2175cb;try{const _0x216110=_0x343e59['params']['id'],{invoice:_0x5ab5c0,warehouse_name:_0x2a3741,room:_0x3ed310}=_0x343e59['body'],_0x10585d=await sales[_0x1ee711(0x187)]({'invoice':_0x5ab5c0}),_0x255d6d=_0x10585d['sale_product'][_0x1ee711(0x231)](async _0x13ce58=>{var _0x5d773e=_0x1ee711,_0xe742=await warehouse[_0x5d773e(0x187)]({'name':_0x2a3741,'room':_0x13ce58[_0x5d773e(0x16e)],'warehouse_category':_0x5d773e(0x173)});const _0x463749=_0xe742[_0x5d773e(0x130)]['map'](_0x2f82cc=>{var _0x588650=_0x5d773e;_0x2f82cc[_0x588650(0x23f)]==_0x13ce58[_0x588650(0x23f)]&&_0x2f82cc['floorlevel']==_0x13ce58[_0x588650(0x151)]&&_0x2f82cc['type']==_0x13ce58[_0x588650(0x1ad)]&&_0x2f82cc[_0x588650(0x199)]==_0x13ce58[_0x588650(0x199)]&&_0x2f82cc[_0x588650(0x19c)]==_0x13ce58[_0x588650(0x19c)]&&_0x2f82cc[_0x588650(0x193)]==_0x13ce58[_0x588650(0x193)]&&_0x2f82cc[_0x588650(0x148)]==_0x13ce58[_0x588650(0x148)]&&_0x2f82cc[_0x588650(0x23e)]==_0x13ce58[_0x588650(0x23e)]&&_0x2f82cc[_0x588650(0x229)]==_0x13ce58['batch_code']&&_0x2f82cc['_id']==_0x13ce58[_0x588650(0x216)]&&(_0x2f82cc[_0x588650(0x1e7)]=Math[_0x588650(0x166)](0x0,Math[_0x588650(0x1ce)](_0x2f82cc[_0x588650(0x1e7)])-Math['abs'](_0x13ce58['quantity'])));});return _0xe742;});Promise[_0x1ee711(0x1f8)](_0x255d6d)[_0x1ee711(0x22d)](async _0x30dbe9=>{var _0x2f29b8=_0x1ee711;try{for(const _0x3e4033 of _0x30dbe9){await _0x3e4033['save']();}_0x10585d[_0x2f29b8(0x194)]=_0x2f29b8(0x181);const _0x4aea46=await _0x10585d[_0x2f29b8(0x169)](),_0x20e547=await master_shop['find'](),_0x2d2c8d=await email_settings[_0x2f29b8(0x187)](),_0x397305=await supervisor_settings[_0x2f29b8(0x214)]();var _0x367aa6=_0x10585d[_0x2f29b8(0x15c)],_0x55d25a='',_0x421d31;for(_0x421d31 in _0x367aa6){_0x55d25a+=_0x2f29b8(0x1d2)+_0x2f29b8(0x197)+_0x367aa6[_0x421d31][_0x2f29b8(0x23f)]+_0x2f29b8(0x240)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x367aa6[_0x421d31][_0x2f29b8(0x222)]+_0x2f29b8(0x240)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x367aa6[_0x421d31][_0x2f29b8(0x219)]+_0x2f29b8(0x240)+_0x2f29b8(0x197)+_0x367aa6[_0x421d31]['unit']+_0x2f29b8(0x240)+_0x2f29b8(0x197)+_0x367aa6[_0x421d31][_0x2f29b8(0x1bd)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x10585d[_0x2f29b8(0x211)]+'</td>'+_0x2f29b8(0x197)+_0x367aa6[_0x421d31][_0x2f29b8(0x16e)]+_0x2f29b8(0x240)+_0x2f29b8(0x197)+_0x367aa6[_0x421d31]['storage']+_0x367aa6[_0x421d31][_0x2f29b8(0x193)]+_0x367aa6[_0x421d31][_0x2f29b8(0x19c)]+_0x367aa6[_0x421d31][_0x2f29b8(0x199)]+_0x367aa6[_0x421d31]['type'][0x0]+_0x367aa6[_0x421d31][_0x2f29b8(0x151)]+_0x2f29b8(0x240),_0x2f29b8(0x1dc);}let _0x36d9fc=nodemailer[_0x2f29b8(0x150)]({'host':_0x2d2c8d[_0x2f29b8(0x17a)],'port':Number(_0x2d2c8d[_0x2f29b8(0x1ed)]),'secure':![],'auth':{'user':_0x2d2c8d['email'],'pass':_0x2d2c8d[_0x2f29b8(0x13f)]}}),_0x3d65b6={'from':_0x2d2c8d[_0x2f29b8(0x12d)],'to':_0x397305[0x0][_0x2f29b8(0x207)],'subject':_0x2f29b8(0x18e),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2f29b8(0x190)+_0x2f29b8(0x176)+_0x20e547[0x0][_0x2f29b8(0x180)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x2f29b8(0x1e9)+_0x2f29b8(0x1c3)+_0x2f29b8(0x17b)+_0x2f29b8(0x1aa)+'<div>'+_0x2f29b8(0x144)+_0x2f29b8(0x233)+_0x2f29b8(0x17b)+_0x2f29b8(0x15f)+_0x20e547[0x0][_0x2f29b8(0x1e6)]+_0x2f29b8(0x1a8)+_0x2f29b8(0x233)+_0x2f29b8(0x233)+'<hr\x20class=\x22my-3\x22>'+_0x2f29b8(0x17b)+_0x2f29b8(0x225)+_0x2f29b8(0x153)+_0x10585d[_0x2f29b8(0x1ef)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x10585d[_0x2f29b8(0x1d6)]+'\x20'+'</span>'+_0x2f29b8(0x198)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2f29b8(0x192)+_0x2f29b8(0x1d2)+_0x2f29b8(0x1b4)+_0x2f29b8(0x164)+_0x2f29b8(0x1e8)+_0x2f29b8(0x208)+_0x2f29b8(0x15b)+_0x2f29b8(0x18d)+_0x2f29b8(0x236)+_0x2f29b8(0x227)+_0x2f29b8(0x1dc)+_0x2f29b8(0x1b9)+_0x2f29b8(0x21b)+'\x20'+_0x55d25a+'\x20'+'</tbody>'+'</table>'+_0x2f29b8(0x17b)+_0x2f29b8(0x1d5)+'<h5>'+_0x20e547[0x0]['site_title']+_0x2f29b8(0x198)+_0x2f29b8(0x233)+_0x2f29b8(0x233)+'</body></html>'};_0x36d9fc[_0x2f29b8(0x217)](_0x3d65b6,function(_0x3c44e8,_0x48bbd2){var _0x468b9d=_0x2f29b8;_0x3c44e8?(console[_0x468b9d(0x1a6)](_0x3c44e8),console['log'](_0x468b9d(0x1d1))):console[_0x468b9d(0x1a6)](_0x468b9d(0x14f));}),_0x343e59['flash'](_0x2f29b8(0x218),_0x2f29b8(0x238)),_0x532cfa['redirect'](_0x2f29b8(0x1c5)+_0x216110);}catch(_0xc390aa){console[_0x2f29b8(0x20b)](_0xc390aa),_0x532cfa['status'](0x1f4)[_0x2f29b8(0x1a2)]({'error':_0x2f29b8(0x13d)});}})[_0x1ee711(0x136)](_0x2c7662=>{var _0x54fd0c=_0x1ee711;console['error'](_0x2c7662),_0x532cfa[_0x54fd0c(0x141)](0x1f4)[_0x54fd0c(0x1a2)]({'error':'An\x20error\x20occurred.'});});}catch(_0x564839){console[_0x1ee711(0x1a6)](_0x564839);}}),router[a0_0x2175cb(0x168)](a0_0x2175cb(0x177),auth,async(_0x435c38,_0x2c34a8)=>{var _0x57f14a=a0_0x2175cb;try{const {username:_0x59488a,email:_0x4b9d17,role:_0x463c6f}=_0x435c38[_0x57f14a(0x189)],_0x4e769e=_0x435c38[_0x57f14a(0x189)],_0x503216=await profile[_0x57f14a(0x187)]({'email':_0x4e769e[_0x57f14a(0x12d)]}),_0x2ef721=await master_shop['find'](),_0x204568=_0x435c38[_0x57f14a(0x1cb)]['id'],_0x3b85cc=await sales['findById'](_0x204568);var _0x26aba9=[_0x57f14a(0x19b),'Enclosed'];const _0x37b7a0=await warehouse[_0x57f14a(0x1b8)]([{'$match':{'name':_0x3b85cc[_0x57f14a(0x211)],'warehouse_category':_0x57f14a(0x173)}},{'$unwind':_0x57f14a(0x1f2)},{'$group':{'_id':_0x57f14a(0x223),'name':{'$first':_0x57f14a(0x1f9)},'product_stock':{'$first':_0x57f14a(0x1db)},'bay':{'$first':_0x57f14a(0x1ee)},'bin':{'$first':_0x57f14a(0x21a)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x57f14a(0x196)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x57f14a(0x1d0)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x57f14a(0x1eb)}}}]),_0x231d9e=await customer['find']({});let _0x5f6e42;if(_0x4e769e[_0x57f14a(0x1c9)]=='staff'){const _0x1ed903=await staff['findOne']({'email':_0x4e769e['email']});_0x5f6e42=await warehouse[_0x57f14a(0x1b8)]([{'$match':{'status':_0x57f14a(0x1e2),'name':_0x1ed903[_0x57f14a(0x1fe)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x57f14a(0x20c)}}}]);}else _0x5f6e42=await warehouse['aggregate']([{'$match':{'status':_0x57f14a(0x1e2),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x57f14a(0x20c)}}}]);const _0x25460a=await product[_0x57f14a(0x214)]({});if(_0x2ef721[0x0][_0x57f14a(0x1c6)]==_0x57f14a(0x228)){var _0x4dee3c=users[_0x57f14a(0x170)];console[_0x57f14a(0x1a6)](_0x4dee3c);}else{if(_0x2ef721[0x0]['language']==_0x57f14a(0x138))var _0x4dee3c=users[_0x57f14a(0x138)];else{if(_0x2ef721[0x0][_0x57f14a(0x1c6)]==_0x57f14a(0x206))var _0x4dee3c=users[_0x57f14a(0x206)];else{if(_0x2ef721[0x0][_0x57f14a(0x1c6)]==_0x57f14a(0x143))var _0x4dee3c=users[_0x57f14a(0x143)];else{if(_0x2ef721[0x0]['language']==_0x57f14a(0x18c))var _0x4dee3c=users[_0x57f14a(0x18c)];else{if(_0x2ef721[0x0][_0x57f14a(0x1c6)]==_0x57f14a(0x23c))var _0x4dee3c=users['Portuguese'];else{if(_0x2ef721[0x0][_0x57f14a(0x1c6)]==_0x57f14a(0x1c0))var _0x4dee3c=users[_0x57f14a(0x1c0)];else{if(_0x2ef721[0x0][_0x57f14a(0x1c6)]==_0x57f14a(0x134))var _0x4dee3c=users[_0x57f14a(0x202)];}}}}}}}_0x2c34a8[_0x57f14a(0x1b5)](_0x57f14a(0x1af),{'success':_0x435c38[_0x57f14a(0x154)](_0x57f14a(0x218)),'errors':_0x435c38[_0x57f14a(0x154)](_0x57f14a(0x147)),'role':_0x4e769e,'profile':_0x503216,'customer':_0x231d9e,'warehouse':_0x5f6e42,'product':_0x37b7a0,'user':_0x3b85cc,'master_shop':_0x2ef721,'unit':_0x25460a,'language':_0x4dee3c});}catch(_0x27b5cb){console[_0x57f14a(0x1a6)](_0x27b5cb);}}),router[a0_0x2175cb(0x19f)](a0_0x2175cb(0x177),auth,async(_0x5692f5,_0x58af3b)=>{var _0x2aa243=a0_0x2175cb;try{const _0x55ac28=_0x5692f5[_0x2aa243(0x1cb)]['id'],_0x5f5c7c=await sales[_0x2aa243(0x187)]({'_id':_0x5692f5[_0x2aa243(0x1cb)]['id']}),_0x151ed5=await warehouse[_0x2aa243(0x187)]({'name':_0x5f5c7c['warehouse_name'],'room':_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x239)]}),{invoice:_0xdd30b6,date:_0x176545,warehouse_name:_0x3ab1b3,product_name:_0x2c5740,stock:_0x5248c4,quantity:_0x2fe6b0,note:_0x53e722,room:_0x5b2340,customer:_0x1597f1,SCRN:_0x1c7fcf}=_0x5692f5['body'];if(typeof _0x2c5740==_0x2aa243(0x1cd))var _0x32717a=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x23f)]],_0x56549e=[_0x5692f5['body'][_0x2aa243(0x1d3)]],_0x29801b=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x184)]],_0x800c95=[_0x5692f5['body'][_0x2aa243(0x157)]],_0x40f8fb=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x13a)]],_0x8d0f5f=[_0x5692f5['body'][_0x2aa243(0x1a9)]],_0x1d7545=[_0x5692f5['body'][_0x2aa243(0x1b0)]],_0x40549c=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x1a4)]],_0x3dbef3=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x1bd)]],_0x4d02f8=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x229)]],_0x17566d=[_0x5692f5['body']['expiry_date']],_0x55f82c=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x163)]],_0x3a97a4=[_0x5692f5[_0x2aa243(0x1b7)]['production_date']],_0x5645ab=[_0x5692f5['body'][_0x2aa243(0x139)]],_0x3b6f93=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x12e)]],_0x208849=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x18a)]],_0x47879b=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x200)]],_0x5d0456=[_0x5692f5[_0x2aa243(0x1b7)]['quantity']],_0x1ce93f=[_0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x132)]];else var _0x32717a=[..._0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x23f)]],_0x56549e=[..._0x5692f5[_0x2aa243(0x1b7)]['stock']],_0x29801b=[..._0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x184)]],_0x800c95=[..._0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x157)]],_0x40f8fb=[..._0x5692f5[_0x2aa243(0x1b7)]['secondary_code']],_0x8d0f5f=[..._0x5692f5['body'][_0x2aa243(0x1a9)]],_0x1d7545=[..._0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x1b0)]],_0x40549c=[..._0x5692f5[_0x2aa243(0x1b7)]['primary_unit']],_0x3dbef3=[..._0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x1bd)]],_0x4d02f8=[..._0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x229)]],_0x17566d=[..._0x5692f5['body'][_0x2aa243(0x23e)]],_0x55f82c=[..._0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x163)]],_0x3a97a4=[..._0x5692f5['body'][_0x2aa243(0x1b3)]],_0x5645ab=[..._0x5692f5[_0x2aa243(0x1b7)]['requested_qty']],_0x3b6f93=[..._0x5692f5['body']['delivery_date']],_0x208849=[..._0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x18a)]],_0x47879b=[..._0x5692f5[_0x2aa243(0x1b7)][_0x2aa243(0x200)]],_0x5d0456=[..._0x5692f5['body']['quantity']],_0x1ce93f=[..._0x5692f5[_0x2aa243(0x1b7)]['RoomAssigned']];const _0x173407=_0x32717a[_0x2aa243(0x231)](_0x5861e6=>{return _0x5861e6={'product_name':_0x5861e6};});_0x56549e[_0x2aa243(0x142)]((_0x353e72,_0x3b9ce7)=>{var _0x33786f=_0x2aa243;_0x173407[_0x3b9ce7][_0x33786f(0x1d3)]=Math[_0x33786f(0x1ce)](_0x353e72);}),_0x29801b['forEach']((_0x14652f,_0x2eb97f)=>{var _0x2ac680=_0x2aa243;_0x173407[_0x2eb97f][_0x2ac680(0x219)]=_0x14652f;}),_0x800c95[_0x2aa243(0x142)]((_0x2a31e3,_0x5ed349)=>{var _0x38ce44=_0x2aa243;_0x173407[_0x5ed349][_0x38ce44(0x157)]=_0x2a31e3;}),_0x40f8fb['forEach']((_0x485f78,_0xa4466b)=>{var _0x5dddd8=_0x2aa243;_0x173407[_0xa4466b][_0x5dddd8(0x13a)]=_0x485f78;}),_0x8d0f5f['forEach']((_0x2a448e,_0x229c7c)=>{var _0x42b090=_0x2aa243;_0x173407[_0x229c7c][_0x42b090(0x222)]=_0x2a448e;}),_0x1d7545['forEach']((_0x1af6dc,_0xeffe79)=>{var _0x4ee665=_0x2aa243;_0x1ce93f[_0x4ee665(0x142)]((_0x204182,_0x13bda2)=>{var _0x5444d1=_0x4ee665;if(_0x204182==_0x5444d1(0x156)&&_0xeffe79==_0x13bda2){var _0x9a40f9=_0x1af6dc[_0x5444d1(0x215)](0x3);_0x173407[_0xeffe79][_0x5444d1(0x148)]=_0x1af6dc[0x0],_0x173407[_0xeffe79][_0x5444d1(0x193)]=_0x1af6dc[0x1],_0x173407[_0xeffe79][_0x5444d1(0x19c)]=0x0,_0x173407[_0xeffe79][_0x5444d1(0x199)]=0x0,_0x173407[_0xeffe79][_0x5444d1(0x1ad)]=_0x5444d1(0x167),_0x173407[_0xeffe79]['floorlevel']=_0x9a40f9;}else{if(_0x204182==_0x5444d1(0x1ba)&&_0xeffe79==_0x13bda2){var _0x9a40f9=_0x1af6dc[_0x5444d1(0x215)](0x3);_0x173407[_0xeffe79][_0x5444d1(0x148)]=_0x1af6dc[0x0],_0x173407[_0xeffe79][_0x5444d1(0x193)]=_0x1af6dc[0x1],_0x173407[_0xeffe79][_0x5444d1(0x19c)]=0x0,_0x173407[_0xeffe79][_0x5444d1(0x199)]=0x0,_0x173407[_0xeffe79]['type']=_0x5444d1(0x167),_0x173407[_0xeffe79][_0x5444d1(0x151)]=_0x1af6dc[0x5];}else{if(_0xeffe79==_0x13bda2){var _0xe76079;if(_0x1af6dc[0x4]=='L')_0xe76079=_0x5444d1(0x21e);else _0x1af6dc[0x4]=='F'&&(_0xe76079=_0x5444d1(0x167));_0x173407[_0xeffe79][_0x5444d1(0x148)]=_0x1af6dc[0x0],_0x173407[_0xeffe79][_0x5444d1(0x193)]=_0x1af6dc[0x1],_0x173407[_0xeffe79]['bay']=_0x1af6dc[0x2],_0x173407[_0xeffe79][_0x5444d1(0x199)]=_0x1af6dc[0x3],_0x173407[_0xeffe79]['type']=_0xe76079,_0x173407[_0xeffe79][_0x5444d1(0x151)]=_0x1af6dc[0x5];}}}});}),_0x40549c[_0x2aa243(0x142)]((_0x1b9415,_0x208a69)=>{_0x173407[_0x208a69]['unit']=_0x1b9415;}),_0x3dbef3['forEach']((_0x5e60a7,_0x5a7e56)=>{var _0x56ba97=_0x2aa243;_0x173407[_0x5a7e56][_0x56ba97(0x1bd)]=_0x5e60a7;}),_0x4d02f8[_0x2aa243(0x142)]((_0x5f3ee1,_0x529dc9)=>{var _0x16a87a=_0x2aa243;_0x173407[_0x529dc9][_0x16a87a(0x229)]=_0x5f3ee1;}),_0x17566d[_0x2aa243(0x142)]((_0x425cce,_0x298bd9)=>{var _0x255a15=_0x2aa243;_0x173407[_0x298bd9][_0x255a15(0x23e)]=_0x425cce;}),_0x55f82c[_0x2aa243(0x142)]((_0x586b03,_0x1c728b)=>{var _0x54ec47=_0x2aa243;_0x173407[_0x1c728b][_0x54ec47(0x14e)]=_0x586b03;}),_0x3a97a4[_0x2aa243(0x142)]((_0x26b6e9,_0x18797b)=>{_0x173407[_0x18797b]['production_date']=_0x26b6e9;}),_0x5645ab[_0x2aa243(0x142)]((_0x5a9aff,_0x98a3c0)=>{var _0x5c6341=_0x2aa243;_0x173407[_0x98a3c0][_0x5c6341(0x139)]=Math[_0x5c6341(0x1ce)](_0x5a9aff);}),_0x3b6f93['forEach']((_0x210e0c,_0x24ab48)=>{_0x173407[_0x24ab48]['delivery_date']=_0x210e0c;}),_0x208849['forEach']((_0x5a9dee,_0x59b3ce)=>{var _0x4157d9=_0x2aa243;_0x173407[_0x59b3ce][_0x4157d9(0x18a)]=_0x5a9dee;}),_0x47879b['forEach']((_0x3c7dd5,_0x571437)=>{var _0x3dacd1=_0x2aa243;_0x173407[_0x571437][_0x3dacd1(0x200)]=_0x3c7dd5;}),_0x5d0456[_0x2aa243(0x142)]((_0x3e528c,_0x435120)=>{var _0x2faf6d=_0x2aa243;_0x173407[_0x435120][_0x2faf6d(0x17e)]=_0x3e528c;}),_0x1ce93f[_0x2aa243(0x142)]((_0x166c3e,_0x1e0ec5)=>{var _0xdd44f6=_0x2aa243;_0x173407[_0x1e0ec5][_0xdd44f6(0x16e)]=_0x166c3e;});var _0x28d113=0x0;_0x173407[_0x2aa243(0x142)](_0x4e3649=>{var _0x3bb353=_0x2aa243;console[_0x3bb353(0x1a6)](_0x3bb353(0x1c1),_0x4e3649),(parseInt(_0x4e3649['stock'])<parseInt(_0x4e3649[_0x3bb353(0x219)])||parseInt(_0x4e3649[_0x3bb353(0x219)])==0x0)&&_0x28d113++;});if(_0x28d113!=0x0)return _0x5692f5[_0x2aa243(0x154)](_0x2aa243(0x147),_0x2aa243(0x203)),_0x58af3b[_0x2aa243(0x1de)]('back');const _0x211704=_0x173407['filter'](_0x3364fa=>_0x3364fa[_0x2aa243(0x219)]!=='0'&&_0x3364fa[_0x2aa243(0x219)]!=='');_0x5f5c7c[_0x2aa243(0x1ef)]=_0xdd30b6,_0x5f5c7c[_0x2aa243(0x1dd)]=_0x1597f1,_0x5f5c7c[_0x2aa243(0x1d6)]=_0x176545,_0x5f5c7c[_0x2aa243(0x211)]=_0x3ab1b3,_0x5f5c7c[_0x2aa243(0x15c)]=_0x211704,_0x5f5c7c[_0x2aa243(0x209)]=_0x53e722,_0x5f5c7c[_0x2aa243(0x18f)]=_0x1c7fcf,_0x5f5c7c[_0x2aa243(0x194)]=_0x2aa243(0x22a),_0x5f5c7c[_0x2aa243(0x220)]=_0x2aa243(0x22a);const _0x468c75=await _0x5f5c7c[_0x2aa243(0x169)]();_0x5692f5['flash']('success','Sales\x20Update\x20successfully'),_0x58af3b[_0x2aa243(0x1de)](_0x2aa243(0x17f));}catch(_0x3571a1){console[_0x2aa243(0x1a6)](_0x3571a1);}}),router[a0_0x2175cb(0x19f)](a0_0x2175cb(0x1e0),auth,async(_0x3bddf7,_0x26e170)=>{var _0x349497=a0_0x2175cb;try{const _0x333666=_0x3bddf7[_0x349497(0x1cb)]['id'],{invoice:_0x50aabc,customer:_0x34b334,receivable_amount:_0x3f7658,received_amount:_0x1865cc}=_0x3bddf7[_0x349497(0x1b7)],_0xa698ec=await sales[_0x349497(0x1a0)](_0x333666);console[_0x349497(0x1a6)](_0xa698ec);var _0xce3bcb=_0x3f7658-_0x1865cc;console[_0x349497(0x1a6)](_0x1865cc),_0xa698ec[_0x349497(0x174)]=parseFloat(_0x1865cc)+parseFloat(_0xa698ec['received_amount']),_0xa698ec[_0x349497(0x1bc)]=_0xce3bcb,console['log'](_0xa698ec);const _0x3fb6c1=await _0xa698ec['save'](),_0x1e7c19=await c_payment_data['findOne']({'invoice':_0x50aabc});_0x1e7c19[_0x349497(0x1d9)]=_0xce3bcb,await _0x1e7c19[_0x349497(0x169)]();let _0x2aa2ba=new Date(),_0x1f3cab=('0'+_0x2aa2ba[_0x349497(0x1d7)]())['slice'](-0x2),_0x4b4563=('0'+(_0x2aa2ba[_0x349497(0x1e4)]()+0x1))[_0x349497(0x215)](-0x2),_0x5812b2=_0x2aa2ba['getFullYear'](),_0x413d16=_0x5812b2+'-'+_0x4b4563+'-'+_0x1f3cab;const _0x4d1124=new customer_payment({'invoice':_0x50aabc,'date':_0x5812b2+'-'+_0x4b4563+'-'+_0x1f3cab,'customer':_0x34b334,'reason':_0x349497(0x178),'amount':_0x1865cc}),_0x1ef5e3=await _0x4d1124[_0x349497(0x169)]();_0x3bddf7['flash'](_0x349497(0x218),_0x349497(0x1df)),_0x26e170['redirect'](_0x349497(0x17f));}catch(_0x107492){console[_0x349497(0x1a6)](_0x107492);}}),router['get'](a0_0x2175cb(0x204),auth,async(_0x54afda,_0x193d4c)=>{var _0x2c06fd=a0_0x2175cb;try{const {username:_0xa23a81,email:_0x12e259,role:_0x5d1409}=_0x54afda[_0x2c06fd(0x189)],_0x90f7fc=_0x54afda[_0x2c06fd(0x189)],_0x4aa47e=await profile['findOne']({'email':_0x90f7fc[_0x2c06fd(0x12d)]}),_0x96de85=await master_shop[_0x2c06fd(0x214)]();console[_0x2c06fd(0x1a6)](_0x2c06fd(0x135),_0x96de85);const _0x37d7d3=_0x54afda[_0x2c06fd(0x1cb)]['id'],_0x175eb2=await sales[_0x2c06fd(0x1a0)](_0x37d7d3);console[_0x2c06fd(0x1a6)](_0x175eb2);const _0x4677e9=await customer['findOne']({'name':_0x175eb2['customer']});console['log'](_0x4677e9);if(_0x96de85[0x0][_0x2c06fd(0x1c6)]=='English\x20(US)'){var _0x1a613f=users['English'];console[_0x2c06fd(0x1a6)](_0x1a613f);}else{if(_0x96de85[0x0][_0x2c06fd(0x1c6)]==_0x2c06fd(0x138))var _0x1a613f=users[_0x2c06fd(0x138)];else{if(_0x96de85[0x0][_0x2c06fd(0x1c6)]==_0x2c06fd(0x206))var _0x1a613f=users[_0x2c06fd(0x206)];else{if(_0x96de85[0x0][_0x2c06fd(0x1c6)]==_0x2c06fd(0x143))var _0x1a613f=users['Spanish'];else{if(_0x96de85[0x0][_0x2c06fd(0x1c6)]=='French')var _0x1a613f=users['French'];else{if(_0x96de85[0x0][_0x2c06fd(0x1c6)]==_0x2c06fd(0x23c))var _0x1a613f=users['Portuguese'];else{if(_0x96de85[0x0][_0x2c06fd(0x1c6)]==_0x2c06fd(0x1c0))var _0x1a613f=users[_0x2c06fd(0x1c0)];else{if(_0x96de85[0x0]['language']==_0x2c06fd(0x134))var _0x1a613f=users[_0x2c06fd(0x202)];}}}}}}}_0x193d4c['render'](_0x2c06fd(0x20e),{'success':_0x54afda[_0x2c06fd(0x154)](_0x2c06fd(0x218)),'errors':_0x54afda[_0x2c06fd(0x154)](_0x2c06fd(0x147)),'role':_0x90f7fc,'profile':_0x4aa47e,'master_shop':_0x96de85,'customers':_0x4677e9,'sales':_0x175eb2,'language':_0x1a613f});}catch(_0x13df71){console['log'](_0x13df71);}}),router[a0_0x2175cb(0x168)](a0_0x2175cb(0x1c2),auth,async(_0x4dd2ce,_0x437bea)=>{var _0x14abc6=a0_0x2175cb;try{const {username:_0x312110,email:_0x2c3458,role:_0x4978f5}=_0x4dd2ce[_0x14abc6(0x189)],_0x1ee10c=_0x4dd2ce[_0x14abc6(0x189)],_0x5eeb02=await profile[_0x14abc6(0x187)]({'email':_0x1ee10c[_0x14abc6(0x12d)]}),_0x1d627a=await master_shop[_0x14abc6(0x214)]();console[_0x14abc6(0x1a6)](_0x14abc6(0x135),_0x1d627a);const _0x1a17b5=_0x4dd2ce['params']['id'];console[_0x14abc6(0x1a6)](_0x1a17b5);const _0x45c937=await sales[_0x14abc6(0x1a0)](_0x1a17b5);console[_0x14abc6(0x1a6)]('user_id',_0x45c937);const _0x1f9b25=await warehouse[_0x14abc6(0x1b8)]([{'$match':{'name':_0x14abc6(0x1c7),'room':_0x14abc6(0x1fb)}},{'$unwind':_0x14abc6(0x1f2)},{'$group':{'_id':_0x14abc6(0x223),'name':{'$first':_0x14abc6(0x1f9)},'product_stock':{'$first':_0x14abc6(0x1db)},'level':{'$first':_0x14abc6(0x185)},'isle':{'$first':_0x14abc6(0x1f7)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x14abc6(0x23d)},'secondary_code':{'$first':_0x14abc6(0x1d0)},'product_code':{'$first':_0x14abc6(0x1c4)}}}]);console[_0x14abc6(0x1a6)](_0x14abc6(0x14b),_0x1f9b25);const _0x2b222e=await product['find']({});warehouse_data=await warehouse[_0x14abc6(0x1b8)]([{'$match':{'status':_0x14abc6(0x1e2),'name':_0x14abc6(0x1c7),'warehouse_category':_0x14abc6(0x173)}},{'$group':{'_id':_0x14abc6(0x20c),'name':{'$first':_0x14abc6(0x20c)}}},{'$sort':{'name':0x1}}]);var _0x2a905c=['Return\x20Rooms'];if(_0x1d627a[0x0][_0x14abc6(0x1c6)]==_0x14abc6(0x228)){var _0x3f190b=users[_0x14abc6(0x170)];console[_0x14abc6(0x1a6)](_0x3f190b);}else{if(_0x1d627a[0x0][_0x14abc6(0x1c6)]==_0x14abc6(0x138))var _0x3f190b=users[_0x14abc6(0x138)];else{if(_0x1d627a[0x0]['language']=='German')var _0x3f190b=users[_0x14abc6(0x206)];else{if(_0x1d627a[0x0][_0x14abc6(0x1c6)]==_0x14abc6(0x143))var _0x3f190b=users[_0x14abc6(0x143)];else{if(_0x1d627a[0x0][_0x14abc6(0x1c6)]==_0x14abc6(0x18c))var _0x3f190b=users[_0x14abc6(0x18c)];else{if(_0x1d627a[0x0][_0x14abc6(0x1c6)]==_0x14abc6(0x23c))var _0x3f190b=users[_0x14abc6(0x146)];else{if(_0x1d627a[0x0][_0x14abc6(0x1c6)]==_0x14abc6(0x1c0))var _0x3f190b=users[_0x14abc6(0x1c0)];else{if(_0x1d627a[0x0][_0x14abc6(0x1c6)]==_0x14abc6(0x134))var _0x3f190b=users[_0x14abc6(0x202)];}}}}}}}_0x437bea[_0x14abc6(0x1b5)](_0x14abc6(0x171),{'success':_0x4dd2ce[_0x14abc6(0x154)](_0x14abc6(0x218)),'errors':_0x4dd2ce[_0x14abc6(0x154)](_0x14abc6(0x147)),'role':_0x1ee10c,'profile':_0x5eeb02,'user':_0x45c937,'stock':_0x1f9b25,'master_shop':_0x1d627a,'unit':_0x2b222e,'language':_0x3f190b,'warehouses':warehouse_data,'rooms':_0x2a905c});}catch(_0x2621c3){console[_0x14abc6(0x1a6)](_0x2621c3),_0x437bea['status'](0xc8)[_0x14abc6(0x1a2)]({'message':_0x2621c3[_0x14abc6(0x1cf)]});}}),router[a0_0x2175cb(0x19f)]('/view/return_sales/:id',auth,async(_0x5cd1ee,_0x111108)=>{var _0x401296=a0_0x2175cb;try{const {invoice:_0x452a7e,date:_0x44a05a,warehouse_name:_0x235ac0,product_name:_0x2e4235,primary_code:_0x57beaa,secondary_code:_0x13b343,product_code:_0x7e6227,sales_quantity:_0xfa5d30,stocks:_0x33f2fa,return_qty:_0x1861b4,Room_name:_0x3e0f58,to_warehouse_name:_0x27ed64,to_Roomname:_0x25131d,to_Room_name:_0x1705e4,note:_0x1c2453,level:_0x12b1e5,isle:_0x22dfbe,pallet:_0x5b9643}=_0x5cd1ee['body'];if(typeof _0x2e4235==_0x401296(0x1cd))var _0x519aa3=[_0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x23f)]],_0x589707=[_0x5cd1ee['body'][_0x401296(0x157)]],_0x471c48=[_0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x13a)]],_0x4c5d95=[_0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x222)]],_0x3b561d=[_0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x20f)]],_0x58b0fb=[_0x5cd1ee['body']['stocks']],_0xa08af=[_0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x1ff)]],_0x5eb0d3=[_0x5cd1ee['body'][_0x401296(0x19c)]],_0x628650=[_0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x199)]],_0xefed8a=[_0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x232)]],_0x60b9cb=[_0x5cd1ee[_0x401296(0x1b7)]['floorlevel']];else var _0x519aa3=[..._0x5cd1ee['body'][_0x401296(0x23f)]],_0x589707=[..._0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x157)]],_0x471c48=[..._0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x13a)]],_0x4c5d95=[..._0x5cd1ee['body'][_0x401296(0x222)]],_0x3b561d=[..._0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x20f)]],_0x58b0fb=[..._0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x1e3)]],_0xa08af=[..._0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x1ff)]],_0x5eb0d3=[..._0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x19c)]],_0x628650=[..._0x5cd1ee['body'][_0x401296(0x199)]],_0xefed8a=[..._0x5cd1ee[_0x401296(0x1b7)]['types']],_0x60b9cb=[..._0x5cd1ee['body']['floorlevel']];const _0x4fa364=_0x519aa3[_0x401296(0x231)](_0xc8ddb8=>{return _0xc8ddb8={'product_name':_0xc8ddb8};});_0x589707['forEach']((_0x59d005,_0x4cb2a4)=>{var _0x4b8b19=_0x401296;_0x4fa364[_0x4cb2a4][_0x4b8b19(0x157)]=_0x59d005;}),_0x471c48[_0x401296(0x142)]((_0x42fde4,_0x3641eb)=>{var _0x4d31b1=_0x401296;_0x4fa364[_0x3641eb][_0x4d31b1(0x13a)]=_0x42fde4;}),_0x4c5d95['forEach']((_0x221f72,_0xe723b4)=>{var _0x5b6c4e=_0x401296;_0x4fa364[_0xe723b4][_0x5b6c4e(0x222)]=_0x221f72;}),_0x3b561d['forEach']((_0x35d024,_0x57f346)=>{_0x4fa364[_0x57f346]['sale_qty']=_0x35d024;}),_0x58b0fb[_0x401296(0x142)]((_0x1b859d,_0x1d129a)=>{var _0x29e6fb=_0x401296;_0x4fa364[_0x1d129a][_0x29e6fb(0x1d3)]=_0x1b859d;}),_0xa08af[_0x401296(0x142)]((_0x397a81,_0x543673)=>{var _0x3f8b6a=_0x401296;_0x4fa364[_0x543673][_0x3f8b6a(0x1ff)]=_0x397a81;}),_0x5eb0d3[_0x401296(0x142)]((_0x177c92,_0x2ca8cc)=>{var _0x589065=_0x401296;_0x4fa364[_0x2ca8cc][_0x589065(0x19c)]=_0x177c92;}),_0x628650[_0x401296(0x142)]((_0x1fb14c,_0x186f55)=>{_0x4fa364[_0x186f55]['bin']=_0x1fb14c;}),_0xefed8a[_0x401296(0x142)]((_0x10fc5e,_0x2561ec)=>{_0x4fa364[_0x2561ec]['type']=_0x10fc5e;}),_0x60b9cb[_0x401296(0x142)]((_0x5491ba,_0x5a8a49)=>{var _0x38e64f=_0x401296;_0x4fa364[_0x5a8a49][_0x38e64f(0x151)]=_0x5491ba;});var _0x11d62b=0x0;_0x4fa364[_0x401296(0x142)](_0x25f746=>{var _0x2d1e03=_0x401296;console['log']('foreach\x20newproduct',_0x25f746),(parseInt(_0x25f746[_0x2d1e03(0x175)])<parseInt(_0x25f746['return_qty'])||parseInt(_0x25f746[_0x2d1e03(0x1d3)])<parseInt(_0x25f746[_0x2d1e03(0x1ff)])&&parseInt(_0x25f746[_0x2d1e03(0x175)])>parseInt(_0x25f746['return_qty'])||parseInt(_0x25f746[_0x2d1e03(0x1ff)])==0x0)&&_0x11d62b++;});if(_0x11d62b!=0x0)return _0x5cd1ee[_0x401296(0x154)](_0x401296(0x147),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x111108[_0x401296(0x1de)]('back');const _0x430ec7=await sales[_0x401296(0x187)]({'invoice':_0x452a7e});console['log'](_0x430ec7),_0x430ec7[_0x401296(0x1f6)]=_0x401296(0x181);const _0x3d6b28=await _0x430ec7['save'](),_0x5e8626=new sales_return({'invoice':_0x452a7e,'customer':_0x5cd1ee['body'][_0x401296(0x1dd)],'date':_0x44a05a,'warehouse_name':_0x235ac0,'room':_0x3e0f58,'ToWarehouse':_0x27ed64,'ToRoom':_0x1705e4,'return_sale':_0x4fa364,'note':_0x1c2453}),_0x2fbda5=await _0x5e8626[_0x401296(0x169)]();console[_0x401296(0x1a6)](_0x5e8626);const _0x196e31=await sales_return[_0x401296(0x187)]({'invoice':_0x452a7e}),_0x18146d=await warehouse[_0x401296(0x187)]({'name':_0x27ed64,'room':_0x1705e4});_0x196e31[_0x401296(0x171)][_0x401296(0x142)](_0x3e3de5=>{var _0x3689f7=_0x401296,_0x572e17=0x0;const _0x3680c5=_0x18146d[_0x3689f7(0x130)][_0x3689f7(0x231)](_0x328d79=>{var _0x3ac9eb=_0x3689f7;_0x328d79['product_name']==_0x3e3de5[_0x3ac9eb(0x23f)]&&_0x328d79['floorlevel']==_0x3e3de5[_0x3ac9eb(0x151)]&&_0x328d79[_0x3ac9eb(0x1ad)]==_0x3e3de5['type']&&_0x328d79[_0x3ac9eb(0x199)]==_0x3e3de5['bin']&&_0x328d79[_0x3ac9eb(0x19c)]==_0x3e3de5[_0x3ac9eb(0x19c)]&&(_0x328d79['product_stock']=parseInt(_0x328d79['product_stock'])+parseInt(_0x3e3de5[_0x3ac9eb(0x1ff)]),_0x572e17++);});_0x572e17=='0'&&(_0x18146d['product_details']=_0x18146d[_0x3689f7(0x130)][_0x3689f7(0x1b6)]({'product_name':_0x3e3de5['product_name'],'product_stock':_0x3e3de5[_0x3689f7(0x1ff)],'primary_code':_0x3e3de5[_0x3689f7(0x157)],'secondary_code':_0x3e3de5['secondary_code'],'product_code':_0x3e3de5[_0x3689f7(0x222)],'bay':_0x3e3de5[_0x3689f7(0x19c)],'bin':_0x3e3de5[_0x3689f7(0x199)],'type':_0x3e3de5[_0x3689f7(0x1ad)],'floorlevel':_0x3e3de5[_0x3689f7(0x151)]})),console[_0x3689f7(0x1a6)](_0x3689f7(0x20d),_0x18146d);}),await _0x18146d['save'](),console[_0x401296(0x1a6)](_0x5cd1ee[_0x401296(0x1b7)]);const _0xf263d8=new c_payment_data({'invoice':_0x452a7e,'customer':_0x5cd1ee[_0x401296(0x1b7)]['customer'],'reason':'Sale\x20Return'});await _0xf263d8[_0x401296(0x169)]();const _0x4f5266=await master_shop[_0x401296(0x214)]();console['log'](_0x401296(0x131),_0x4f5266[0x0][_0x401296(0x180)]);const _0x33e128=await email_settings['findOne'](),_0x233121=await customer[_0x401296(0x187)]({'name':_0x5cd1ee[_0x401296(0x1b7)][_0x401296(0x1dd)]});console['log'](_0x401296(0x155),_0x233121);_0x4f5266[0x0][_0x401296(0x21c)]==0x1?(right_currency=_0x4f5266[0x0][_0x401296(0x235)],left_currency=''):(right_currency='',left_currency=_0x4f5266[0x0][_0x401296(0x235)]);var _0x3e0571=_0x519aa3,_0x5cf6b8=_0xa08af,_0x40fbec='',_0x25c8a0;for(_0x25c8a0 in _0x3e0571){_0x40fbec+=_0x401296(0x1d2)+_0x401296(0x197)+_0x3e0571[_0x25c8a0]+_0x401296(0x240)+_0x401296(0x197)+_0x5cf6b8[_0x25c8a0]+_0x401296(0x240)+_0x401296(0x1dc);}console['log'](_0x401296(0x1ac),_0x40fbec);let _0x4ab5c8=nodemailer[_0x401296(0x150)]({'service':_0x401296(0x21d),'auth':{'user':_0x33e128[_0x401296(0x12d)],'pass':_0x33e128['password']}}),_0x376d98={'from':_0x33e128[_0x401296(0x12d)],'to':_0x233121[_0x401296(0x12d)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x401296(0x1b2),'path':__dirname+_0x401296(0x190)+_0x401296(0x176)+_0x4f5266[0x0][_0x401296(0x180)],'cid':_0x401296(0x172)}],'html':'<!DOCTYPE\x20html>'+_0x401296(0x1e9)+_0x401296(0x1c3)+_0x401296(0x17b)+_0x401296(0x1aa)+'<div>'+_0x401296(0x144)+_0x401296(0x233)+_0x401296(0x17b)+_0x401296(0x15f)+_0x4f5266[0x0]['site_title']+_0x401296(0x1a8)+_0x401296(0x233)+_0x401296(0x233)+_0x401296(0x17d)+'<div>'+_0x401296(0x225)+_0x401296(0x153)+_0x452a7e+'\x20'+_0x401296(0x1a5)+_0x401296(0x22c)+_0x44a05a+'\x20'+_0x401296(0x1f1)+_0x401296(0x198)+_0x401296(0x233)+_0x401296(0x161)+_0x401296(0x192)+'<tr>'+_0x401296(0x1b4)+_0x401296(0x1fc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x401296(0x159)+_0x401296(0x1dc)+'</thead>'+_0x401296(0x21b)+'\x20'+_0x40fbec+'\x20'+_0x401296(0x133)+_0x401296(0x16f)+'<div>'+_0x401296(0x1d5)+_0x401296(0x186)+_0x4f5266[0x0][_0x401296(0x1e6)]+_0x401296(0x198)+_0x401296(0x233)+_0x401296(0x233)+_0x401296(0x149)};_0x4ab5c8[_0x401296(0x217)](_0x376d98,function(_0x23dd0b,_0x4accec){var _0x1169d6=_0x401296;_0x23dd0b?(console[_0x1169d6(0x1a6)](_0x23dd0b),console[_0x1169d6(0x1a6)](_0x1169d6(0x1d1))):console['log'](_0x1169d6(0x14f));}),_0x5cd1ee[_0x401296(0x154)]('success','sales\x20item\x20return\x20successfull'),_0x111108[_0x401296(0x1de)](_0x401296(0x17f));}catch(_0x3113bc){console['log'](_0x3113bc),_0x111108[_0x401296(0x141)](0xc8)[_0x401296(0x1a2)]({'message1':_0x3113bc[_0x401296(0x1cf)]});}}),router[a0_0x2175cb(0x168)]('/barcode/:id',auth,async(_0x354ee0,_0xc0968c)=>{var _0x17dc04=a0_0x2175cb;try{const {username:_0x138723,email:_0x30f409,role:_0x5946a9}=_0x354ee0[_0x17dc04(0x189)],_0x39dcde=_0x354ee0[_0x17dc04(0x189)],_0x216747=await profile[_0x17dc04(0x187)]({'email':_0x39dcde[_0x17dc04(0x12d)]}),_0x1d2028=await master_shop[_0x17dc04(0x214)]();console['log']('barcode\x20Product\x20master',_0x1d2028);const _0x38ae5a=_0x354ee0[_0x17dc04(0x1cb)]['id'],_0x24fce8=await sales[_0x17dc04(0x1a0)](_0x38ae5a);console[_0x17dc04(0x1a6)](_0x17dc04(0x22e),_0x24fce8);if(_0x1d2028[0x0]['language']==_0x17dc04(0x228))var _0x2dfbf4=users[_0x17dc04(0x170)];else{if(_0x1d2028[0x0][_0x17dc04(0x1c6)]==_0x17dc04(0x138))var _0x2dfbf4=users[_0x17dc04(0x138)];else{if(_0x1d2028[0x0][_0x17dc04(0x1c6)]=='German')var _0x2dfbf4=users[_0x17dc04(0x206)];else{if(_0x1d2028[0x0][_0x17dc04(0x1c6)]==_0x17dc04(0x143))var _0x2dfbf4=users[_0x17dc04(0x143)];else{if(_0x1d2028[0x0][_0x17dc04(0x1c6)]==_0x17dc04(0x18c))var _0x2dfbf4=users[_0x17dc04(0x18c)];else{if(_0x1d2028[0x0][_0x17dc04(0x1c6)]==_0x17dc04(0x23c))var _0x2dfbf4=users[_0x17dc04(0x146)];else{if(_0x1d2028[0x0][_0x17dc04(0x1c6)]=='Chinese')var _0x2dfbf4=users[_0x17dc04(0x1c0)];else{if(_0x1d2028[0x0]['language']==_0x17dc04(0x134))var _0x2dfbf4=users['Arabic'];}}}}}}}_0xc0968c[_0x17dc04(0x1b5)](_0x17dc04(0x1ae),{'success':_0x354ee0[_0x17dc04(0x154)]('success'),'errors':_0x354ee0[_0x17dc04(0x154)](_0x17dc04(0x147)),'role':_0x39dcde,'profile':_0x216747,'alldata':_0x24fce8,'master_shop':_0x1d2028,'language':_0x2dfbf4});}catch(_0x6989b1){console['log'](_0x6989b1);}}),router[a0_0x2175cb(0x19f)]('/barcode_scanner',async(_0x45eaef,_0x37630d)=>{var _0x426ac0=a0_0x2175cb;const {product_code:_0x3d1ccd,warehouse_name:_0x55a21a,rooms_data:_0x1ee354,Roomslist:_0x2ce426}=_0x45eaef[_0x426ac0(0x1b7)],_0x5e50f5=_0x2ce426[_0x426ac0(0x226)](','),_0x3ef5e4=[];async function _0x3cf50c(_0x35ccfb){var _0x17b947=_0x426ac0;const _0x4fade6=await warehouse['aggregate']([{'$match':{'name':_0x55a21a,'room':_0x35ccfb}},{'$unwind':_0x17b947(0x1f2)},{'$match':{'product_details.primary_code':_0x3d1ccd}},{'$group':{'_id':_0x17b947(0x223),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x17b947(0x1db)},'primary_code':{'$first':_0x17b947(0x23d)},'secondary_code':{'$first':_0x17b947(0x1d0)},'product_code':{'$first':_0x17b947(0x1c4)},'level':{'$first':_0x17b947(0x1ee)},'isle':{'$first':_0x17b947(0x21a)},'type':{'$first':_0x17b947(0x17c)},'pallet':{'$first':_0x17b947(0x196)},'unit':{'$first':_0x17b947(0x1d8)},'secondary_unit':{'$first':_0x17b947(0x1f4)},'storage':{'$first':_0x17b947(0x13b)},'rack':{'$first':_0x17b947(0x1eb)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x17b947(0x13e)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x17b947(0x210)},'product_cat':{'$first':_0x17b947(0x1ea)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x17b947(0x137)},'invoice':{'$first':_0x17b947(0x179)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x17b947(0x1f3)},'delivery_date':{'$first':_0x17b947(0x1bb)},'delivery_code':{'$first':_0x17b947(0x1f5)}}}]),_0x3071c7=await warehouse[_0x17b947(0x1b8)]([{'$match':{'name':_0x55a21a,'room':_0x35ccfb}},{'$unwind':_0x17b947(0x1f2)},{'$match':{'product_details.secondary_code':_0x3d1ccd}},{'$group':{'_id':_0x17b947(0x223),'name':{'$first':_0x17b947(0x1f9)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x17b947(0x23d)},'secondary_code':{'$first':_0x17b947(0x1d0)},'product_code':{'$first':_0x17b947(0x1c4)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x17b947(0x21a)},'type':{'$first':_0x17b947(0x17c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x17b947(0x1d8)},'secondary_unit':{'$first':_0x17b947(0x1f4)},'storage':{'$first':_0x17b947(0x13b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x17b947(0x158)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x17b947(0x145)},'batch_code':{'$first':_0x17b947(0x210)},'product_cat':{'$first':_0x17b947(0x1ea)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x17b947(0x137)},'invoice':{'$first':'$product_details.invoice'},'delivery_date':{'$first':_0x17b947(0x1bb)},'delivery_code':{'$first':_0x17b947(0x1f5)}}}]);if(_0x4fade6[_0x17b947(0x12f)]>0x0)_0x3ef5e4[_0x17b947(0x221)](_0x4fade6);else _0x3071c7[_0x17b947(0x12f)]>0x0&&_0x3ef5e4[_0x17b947(0x221)](_0x3071c7);}const _0x11ac18=_0x5e50f5[_0x426ac0(0x231)](_0x5c2a4e=>_0x3cf50c(_0x5c2a4e));await Promise[_0x426ac0(0x1f8)](_0x11ac18),_0x37630d[_0x426ac0(0x1a2)](_0x3ef5e4);}),module['exports']=router;