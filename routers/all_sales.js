var a0_0x59460e=a0_0x40cf;(function(_0x4b4d07,_0xdac2b7){var _0x3fe022=a0_0x40cf,_0x5e3761=_0x4b4d07();while(!![]){try{var _0x2bce19=-parseInt(_0x3fe022(0xf7))/0x1*(parseInt(_0x3fe022(0x140))/0x2)+-parseInt(_0x3fe022(0x106))/0x3*(parseInt(_0x3fe022(0xf4))/0x4)+parseInt(_0x3fe022(0x129))/0x5+-parseInt(_0x3fe022(0xe5))/0x6*(-parseInt(_0x3fe022(0x13a))/0x7)+parseInt(_0x3fe022(0xfc))/0x8+parseInt(_0x3fe022(0x1c1))/0x9+-parseInt(_0x3fe022(0xf2))/0xa*(parseInt(_0x3fe022(0xff))/0xb);if(_0x2bce19===_0xdac2b7)break;else _0x5e3761['push'](_0x5e3761['shift']());}catch(_0xfdd099){_0x5e3761['push'](_0x5e3761['shift']());}}}(a0_0x45e5,0x5b25a));const express=require(a0_0x59460e(0x17f)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x59460e(0x1c7)),auth=require(a0_0x59460e(0x162)),nodemailer=require('nodemailer'),users=require(a0_0x59460e(0x1b8));router[a0_0x59460e(0xf1)](a0_0x59460e(0xcd),auth,async(_0x2f3532,_0x235a25)=>{var _0x2432f1=a0_0x59460e;try{const {username:_0x4197c4,email:_0x21036a,role:_0x43f8a6}=_0x2f3532[_0x2432f1(0x1b1)],_0x40385a=_0x2f3532[_0x2432f1(0x1b1)],_0x839d3e=await profile[_0x2432f1(0x1af)]({'email':_0x40385a[_0x2432f1(0xf9)]}),_0x2d0c7d=await master_shop[_0x2432f1(0x159)]();let _0x24fa14;if(_0x40385a[_0x2432f1(0x196)]==_0x2432f1(0x19c)){const _0x3fa83d=await staff[_0x2432f1(0x1af)]({'email':_0x40385a[_0x2432f1(0xf9)]});_0x24fa14=await sales[_0x2432f1(0x1a0)]([{'$lookup':{'from':_0x2432f1(0x18a),'localField':_0x2432f1(0x181),'foreignField':_0x2432f1(0x139),'as':_0x2432f1(0xfa)}},{'$unwind':_0x2432f1(0x10d)},{'$unwind':_0x2432f1(0xe0)},{'$group':{'_id':_0x2432f1(0x1ae),'invoice':{'$first':_0x2432f1(0x104)},'customers':{'$first':_0x2432f1(0x1b9)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2432f1(0x150)},'sale_product':{'$push':_0x2432f1(0xe0)},'note':{'$first':_0x2432f1(0x125)},'return_data':{'$first':_0x2432f1(0x107)},'customers_docs':{'$first':_0x2432f1(0x10d)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x2432f1(0x10c)},'isle':{'$addToSet':_0x2432f1(0x124)},'type':{'$addToSet':_0x2432f1(0x179)},'pallet':{'$addToSet':_0x2432f1(0x168)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x2432f1(0x102)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x24fa14=await sales[_0x2432f1(0x1a0)]([{'$lookup':{'from':_0x2432f1(0x18a),'localField':_0x2432f1(0x181),'foreignField':_0x2432f1(0x139),'as':'customers_docs'}},{'$unwind':_0x2432f1(0x10d)},{'$unwind':_0x2432f1(0xe0)},{'$group':{'_id':_0x2432f1(0x1ae),'invoice':{'$first':_0x2432f1(0x104)},'customers':{'$first':_0x2432f1(0x1b9)},'date':{'$first':_0x2432f1(0x155)},'warehouse_name':{'$first':_0x2432f1(0x150)},'sale_product':{'$push':_0x2432f1(0xe0)},'note':{'$first':'$note'},'return_data':{'$first':_0x2432f1(0x107)},'customers_docs':{'$first':_0x2432f1(0x10d)},'total_saleproduct_quantity':{'$sum':_0x2432f1(0x1ba)},'level':{'$addToSet':_0x2432f1(0x10c)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x2432f1(0x179)},'pallet':{'$addToSet':_0x2432f1(0x168)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x2432f1(0x133),_0x24fa14);if(_0x2d0c7d[0x0][_0x2432f1(0x1c6)]=='English\x20(US)'){var _0x1f72a5=users[_0x2432f1(0x1be)];console[_0x2432f1(0x170)](_0x1f72a5);}else{if(_0x2d0c7d[0x0][_0x2432f1(0x1c6)]==_0x2432f1(0xd4))var _0x1f72a5=users[_0x2432f1(0xd4)];else{if(_0x2d0c7d[0x0][_0x2432f1(0x1c6)]==_0x2432f1(0x169))var _0x1f72a5=users[_0x2432f1(0x169)];else{if(_0x2d0c7d[0x0]['language']=='Spanish')var _0x1f72a5=users['Spanish'];else{if(_0x2d0c7d[0x0]['language']==_0x2432f1(0x171))var _0x1f72a5=users[_0x2432f1(0x171)];else{if(_0x2d0c7d[0x0][_0x2432f1(0x1c6)]=='Portuguese\x20(BR)')var _0x1f72a5=users['Portuguese'];else{if(_0x2d0c7d[0x0][_0x2432f1(0x1c6)]==_0x2432f1(0x15f))var _0x1f72a5=users['Chinese'];else{if(_0x2d0c7d[0x0][_0x2432f1(0x1c6)]==_0x2432f1(0x1aa))var _0x1f72a5=users[_0x2432f1(0xe1)];}}}}}}}_0x235a25[_0x2432f1(0x1c2)]('all_sales',{'success':_0x2f3532[_0x2432f1(0x12c)](_0x2432f1(0x112)),'errors':_0x2f3532[_0x2432f1(0x12c)](_0x2432f1(0x100)),'sales':_0x24fa14,'profile':_0x839d3e,'role':_0x40385a,'master_shop':_0x2d0c7d,'language':_0x1f72a5});}catch(_0x4def81){console[_0x2432f1(0x170)](_0x4def81);}});function a0_0x40cf(_0x6d1916,_0x14ea07){var _0x45e56a=a0_0x45e5();return a0_0x40cf=function(_0x40cfb4,_0x1463af){_0x40cfb4=_0x40cfb4-0xc8;var _0x526d61=_0x45e56a[_0x40cfb4];return _0x526d61;},a0_0x40cf(_0x6d1916,_0x14ea07);}async function getRandom8DigitNumber(){var _0x22fff7=a0_0x59460e;const _0x265cc9=0x989680,_0x2ca550=0x5f5e0ff,_0x5e20d1=Math['floor'](Math['random']()*(_0x2ca550-_0x265cc9+0x1))+_0x265cc9;var _0x42615e;const _0x594517=await sales[_0x22fff7(0x1af)]({'invoice':_0x22fff7(0x164)+_0x5e20d1});return _0x594517&&_0x594517['length']>0x0?_0x42615e=_0x22fff7(0x164)+_0x5e20d1:_0x42615e=_0x22fff7(0x164)+_0x5e20d1,_0x42615e;}function a0_0x45e5(){var _0xa09dec=['<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.production_date','$product','$product_details.product_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','../public/language/languages.json','$customer','$sale_product.quantity','\x20Order\x20Date\x20:\x20','Received\x20Payment\x20For\x20Sale','json','English','date','catch','6157071pyPrIe','render','barcode\x20user_id','sale_product','$product_details.batch_code','language','../models/all_models','Sales\x20Update\x20successfully','params','$product_details.bay','Level','$product_details.invoice','status','redirect','finalize','warehouse','<h5>','<html><head><title></title>','$product_details.rack','save','/view','max_per_unit','sales_invoice','batch_code','secondary_code','forEach','password','Hindi','$product_details.maxPerUnit','prod_code','</tr>','$product_details._id','length','warehouse_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.primary_code','product_name','$product_details.storage','return_data','$sale_product','Arabic','quantity','final','</div>','6DvoSIP','delivery_code','Portuguese\x20(BR)','expiry_date','exports','Enclosed','requested_qty','/view/:id','$name','quantity_notConverted','<div>','<!DOCTYPE\x20html>','get','451160ceKdDE','$product_details.type','272348rKPvXP','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','logo','1tDfDpg','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','email','customers_docs','sales\x20item\x20return\x20successfull','2393744gGwNgT','toString','primary_code','209fScofe','errors','Return\x20Goods','$isAllowEdit','stock','$invoice','/give_payment/:id','30YbtnJS','$return_data','amount','/view/add_sales','room','</h5>','$sale_product.bay','$customers_docs','getDate','<span\x20style=\x22float:\x20right;\x22>','filter','$product_details.secondary_unit','success','/view/return_sales/:id','/upload/','rack','production_date','Portuguese','$product_details.bin','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</td>','payment\x20successfull','/../public','return_qty','/all_sales/preview/','$product.product_name','host','English\x20(US)','</body></html>','<h5\x20style=\x22text-align:\x20left;\x22>','$sale_product.bin','$note','Ambient','</thead>','$product_details.secondary_code','2982950SrFEyq','$product_details.expiry_date','maxperunit','flash','prod_cat','site_title','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','storage','</span>','RMSEmail','sales\x20all_data','body','</table>','all','Raw\x20Materials','product_stock','name','4695082auqhPy','$product_details.level','$product_details.pallet','barcode\x20Product\x20master','RoomAssigned','Sales\x20Add\x20successfully','678482aJqzWi','level','sales_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','type','types','received_amount','Enabled','secondary_unit','/preview/:id','findById','padStart','/barcode_scanner','return_sale','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','sale_qty','$product_details.product_name','post','$date','$product_details.isle','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Error\x20Occurs','find','Shelves','$product_details.unit','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<tr>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Chinese','\x20Order\x20Number\x20:\x20','then','../middleware/auth','master','OUT-','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$sale_product.floorlevel','German','slice','product_list','$product_details.floorlevel','product','back','</head><body>','log','French','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Spanish','</tbody>','<strong>\x20Regards\x20</strong>','error','bin','image','$sale_product.type','/invoice/:id','primary_unit','prod_invoice','createTransport','False','express','product_details','customer','/view/add_sale/product','note','Floor','<h2>\x20','add\x20post','sendMail','\x20</h2>','unit','customers','string','/all_sales/view','Receiving\x20Area','gmail','stock_data','_id','invoice','/barcode/:id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Email\x20sent\x20successfully','floorlevel','role','Sale\x20Return\x20Mail','delivery_date','$product_details.product_stock','getFullYear','push','staff','An\x20error\x20occurred.','foreach\x20newproduct','carton','aggregate','bay','$product_details','message','product_code','map','getMonth','True','currency','Return\x20Rooms','Arabic\x20(ae)','Logo.png','split','room_name','$_id','findOne','<hr\x20class=\x22my-3\x22>','user'];a0_0x45e5=function(){return _0xa09dec;};return a0_0x45e5();}router[a0_0x59460e(0xf1)](a0_0x59460e(0x109),auth,async(_0x296ff7,_0x2900ba)=>{var _0x422696=a0_0x59460e;try{const {username:_0x590832,email:_0x88a46c,role:_0x2eec4c}=_0x296ff7['user'],_0x412574=_0x296ff7[_0x422696(0x1b1)],_0x5c79c4=await profile[_0x422696(0x1af)]({'email':_0x412574['email']}),_0x54ae4d=await master_shop['find'](),_0x5a2828=await customer[_0x422696(0x159)]({});let _0x295113;if(_0x412574['role']==_0x422696(0x19c)){const _0x4d5c7e=await staff[_0x422696(0x1af)]({'email':_0x412574['email']});_0x295113=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x4d5c7e[_0x422696(0xc8)],'warehouse_category':_0x422696(0x137),'name':{'$ne':_0x422696(0x101)}}},{'$group':{'_id':_0x422696(0xed),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x295113=await warehouse[_0x422696(0x1a0)]([{'$match':{'status':_0x422696(0x149),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x422696(0x101)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x2b48d3=await product[_0x422696(0x159)]({});var _0x55b08c=[_0x422696(0x126),_0x422696(0xea)];const _0x21e3c5=await sales[_0x422696(0x159)]({}),_0x1aba92=_0x21e3c5[_0x422696(0xd9)]+0x1,_0x5888fc='OUT-'+_0x1aba92[_0x422696(0xfd)]()[_0x422696(0x14d)](0x5,'0');if(_0x54ae4d[0x0][_0x422696(0x1c6)]==_0x422696(0x121)){var _0x29d618=users['English'];console['log'](_0x29d618);}else{if(_0x54ae4d[0x0]['language']==_0x422696(0xd4))var _0x29d618=users[_0x422696(0xd4)];else{if(_0x54ae4d[0x0][_0x422696(0x1c6)]==_0x422696(0x169))var _0x29d618=users['German'];else{if(_0x54ae4d[0x0][_0x422696(0x1c6)]==_0x422696(0x173))var _0x29d618=users[_0x422696(0x173)];else{if(_0x54ae4d[0x0][_0x422696(0x1c6)]==_0x422696(0x171))var _0x29d618=users[_0x422696(0x171)];else{if(_0x54ae4d[0x0][_0x422696(0x1c6)]==_0x422696(0xe7))var _0x29d618=users[_0x422696(0x117)];else{if(_0x54ae4d[0x0][_0x422696(0x1c6)]==_0x422696(0x15f))var _0x29d618=users['Chinese'];else{if(_0x54ae4d[0x0]['language']==_0x422696(0x1aa))var _0x29d618=users[_0x422696(0xe1)];}}}}}}}const _0x359c4e=getRandom8DigitNumber();_0x359c4e[_0x422696(0x161)](_0x4bc176=>{var _0x41f7a2=_0x422696;_0x2900ba[_0x41f7a2(0x1c2)]('add_sales',{'success':_0x296ff7['flash'](_0x41f7a2(0x112)),'errors':_0x296ff7[_0x41f7a2(0x12c)](_0x41f7a2(0x100)),'role':_0x412574,'profile':_0x5c79c4,'customer':_0x5a2828,'warehouse':_0x295113,'product':_0x2b48d3,'invoice':_0x4bc176,'master_shop':_0x54ae4d,'language':_0x29d618,'rooms_data':_0x55b08c});})[_0x422696(0x1c0)](_0x556027=>{var _0x12d202=_0x422696;_0x296ff7[_0x12d202(0x12c)](_0x12d202(0x100),_0x12d202(0xdb)),_0x2900ba[_0x12d202(0x1ce)](_0x12d202(0x18c));});}catch(_0x393ca4){console[_0x422696(0x170)](_0x393ca4);}}),router[a0_0x59460e(0xf1)]('/view/add_sales/:id',auth,async(_0x1e03fd,_0x151010)=>{var _0x4090bc=a0_0x59460e;try{const _0x1a1e6f=_0x1e03fd[_0x4090bc(0x1c9)]['id'];console[_0x4090bc(0x170)](_0x1a1e6f);const _0x39909b=await product[_0x4090bc(0x159)](),_0x685954=await purchases[_0x4090bc(0x1a0)]([{'$match':{'warehouse_name':_0x1a1e6f}},{'$unwind':_0x4090bc(0x1b4)},{'$group':{'_id':_0x4090bc(0x11f)}}]);console[_0x4090bc(0x170)]('purchases_data',_0x685954),_0x151010[_0x4090bc(0x1cd)](0xc8)['json']({'purchases_data':_0x685954,'product_data':_0x39909b});}catch(_0x356d24){console[_0x4090bc(0x170)](_0x356d24);}}),router[a0_0x59460e(0x154)](a0_0x59460e(0x182),auth,async(_0x57042f,_0x49a08b)=>{var _0x265e9d=a0_0x59460e;try{const {warehouse_data:_0x4f8f94,product_data:_0x81447f}=_0x57042f[_0x265e9d(0x134)];console[_0x265e9d(0x170)](_0x57042f[_0x265e9d(0x134)]['product_data']);;const _0x21f8e7=await master_shop[_0x265e9d(0x159)]();console['log']('master',_0x21f8e7);const _0x217a1b=await product[_0x265e9d(0x1af)]({'name':_0x81447f});console[_0x265e9d(0x170)](_0x265e9d(0x16d),_0x217a1b);const _0x23d837=await warehouse[_0x265e9d(0x1a0)]([{'$match':{'name':_0x4f8f94}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x81447f}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x265e9d(0x199)}}}]);console[_0x265e9d(0x170)](_0x265e9d(0x18f),_0x23d837),_0x49a08b[_0x265e9d(0x1cd)](0xc8)[_0x265e9d(0x1bd)]({'master':_0x21f8e7,'new_product':_0x217a1b,'stock_data':_0x23d837});}catch(_0x3df64f){console[_0x265e9d(0x170)](_0x3df64f);}}),router[a0_0x59460e(0x154)]('/view/add_sales',auth,async(_0x2a5013,_0x1fb469)=>{var _0x262bc6=a0_0x59460e;try{const {invoice:_0xd7563b,date:_0x59ed08,warehouse_name:_0x42b705,product_name:_0x44e6dc,stock:_0x1e532f,quantity:_0x1429ba,note:_0x59672e,room:_0x453f95,primary_code:_0xb06fe5,secondary_code:_0x159d47,prod_code:_0x1b8b94,level:_0x228ede,isle:_0x47d35d,pallet:_0x4982a0,batch_code:_0x5d3ae1,SCRN:_0x42f2e4,expiry_date:_0x1521dd}=_0x2a5013[_0x262bc6(0x134)];if(typeof _0x44e6dc==_0x262bc6(0x18b))var _0x4fa4c2=[_0x2a5013[_0x262bc6(0x134)][_0x262bc6(0xdd)]],_0x4f6127=[_0x2a5013[_0x262bc6(0x134)][_0x262bc6(0x103)]],_0x28f8a1=[_0x2a5013['body']['carton']],_0xa5a1f8=[_0x2a5013['body']['primary_code']],_0x539eb4=[_0x2a5013[_0x262bc6(0x134)]['secondary_code']],_0x33d08a=[_0x2a5013[_0x262bc6(0x134)]['prod_code']],_0x23fcbb=[_0x2a5013[_0x262bc6(0x134)]['level']],_0x3f29a7=[_0x2a5013[_0x262bc6(0x134)][_0x262bc6(0x17b)]],_0x5db95f=[_0x2a5013[_0x262bc6(0x134)]['secondary_unit']],_0x3ceab2=[_0x2a5013[_0x262bc6(0x134)][_0x262bc6(0xd0)]],_0x559777=[_0x2a5013[_0x262bc6(0x134)][_0x262bc6(0xe8)]],_0x220c89=[_0x2a5013['body'][_0x262bc6(0xce)]],_0x336cee=[_0x2a5013['body'][_0x262bc6(0x116)]],_0x1b0a95=[_0x2a5013['body']['requested_qty']],_0x389130=[_0x2a5013[_0x262bc6(0x134)]['delivery_date']],_0x4eba21=[_0x2a5013[_0x262bc6(0x134)][_0x262bc6(0xe6)]],_0x2ee20a=[_0x2a5013[_0x262bc6(0x134)][_0x262bc6(0x12d)]],_0x4258a2=[_0x2a5013['body'][_0x262bc6(0xe2)]],_0x40881f=[_0x2a5013['body']['RoomAssigned']],_0x2d4b80=[_0x2a5013[_0x262bc6(0x134)][_0x262bc6(0x17c)]];else var _0x4fa4c2=[..._0x2a5013[_0x262bc6(0x134)]['product_name']],_0x4f6127=[..._0x2a5013['body']['stock']],_0x28f8a1=[..._0x2a5013['body'][_0x262bc6(0x19f)]],_0xa5a1f8=[..._0x2a5013[_0x262bc6(0x134)][_0x262bc6(0xfe)]],_0x539eb4=[..._0x2a5013[_0x262bc6(0x134)][_0x262bc6(0xd1)]],_0x33d08a=[..._0x2a5013[_0x262bc6(0x134)]['prod_code']],_0x23fcbb=[..._0x2a5013[_0x262bc6(0x134)][_0x262bc6(0x141)]],_0x3f29a7=[..._0x2a5013['body'][_0x262bc6(0x17b)]],_0x5db95f=[..._0x2a5013[_0x262bc6(0x134)][_0x262bc6(0x14a)]],_0x3ceab2=[..._0x2a5013[_0x262bc6(0x134)]['batch_code']],_0x559777=[..._0x2a5013[_0x262bc6(0x134)][_0x262bc6(0xe8)]],_0x220c89=[..._0x2a5013[_0x262bc6(0x134)]['max_per_unit']],_0x336cee=[..._0x2a5013['body']['production_date']],_0x1b0a95=[..._0x2a5013[_0x262bc6(0x134)][_0x262bc6(0xeb)]],_0x389130=[..._0x2a5013[_0x262bc6(0x134)][_0x262bc6(0x198)]],_0x4eba21=[..._0x2a5013[_0x262bc6(0x134)][_0x262bc6(0xe6)]],_0x2ee20a=[..._0x2a5013[_0x262bc6(0x134)][_0x262bc6(0x12d)]],_0x4258a2=[..._0x2a5013['body'][_0x262bc6(0xe2)]],_0x40881f=[..._0x2a5013['body'][_0x262bc6(0x13e)]],_0x2d4b80=[..._0x2a5013['body'][_0x262bc6(0x17c)]];const _0x2ed8bc=_0x4fa4c2[_0x262bc6(0x1a5)](_0x3d3fdf=>{return _0x3d3fdf={'product_name':_0x3d3fdf};});_0x4f6127['forEach']((_0x373485,_0x1f1e38)=>{var _0x33d09b=_0x262bc6;_0x2ed8bc[_0x1f1e38][_0x33d09b(0x103)]=_0x373485;}),_0x28f8a1[_0x262bc6(0xd2)]((_0x22fec0,_0x77b1a8)=>{var _0x4b556a=_0x262bc6;_0x2ed8bc[_0x77b1a8][_0x4b556a(0xe2)]=_0x22fec0;}),_0xa5a1f8[_0x262bc6(0xd2)]((_0x51f8a4,_0x2c7009)=>{var _0x732d15=_0x262bc6;_0x2ed8bc[_0x2c7009][_0x732d15(0xfe)]=_0x51f8a4;}),_0x539eb4[_0x262bc6(0xd2)]((_0x5f1198,_0x129247)=>{var _0x508ad1=_0x262bc6;_0x2ed8bc[_0x129247][_0x508ad1(0xd1)]=_0x5f1198;}),_0x33d08a[_0x262bc6(0xd2)]((_0x41a7f7,_0x1a2cfa)=>{var _0x404049=_0x262bc6;_0x2ed8bc[_0x1a2cfa][_0x404049(0x1a4)]=_0x41a7f7;}),_0x23fcbb[_0x262bc6(0xd2)]((_0x1e44bf,_0xcdfb3a)=>{var _0x49c166=_0x262bc6;_0x40881f[_0x49c166(0xd2)]((_0x184fff,_0x42435d)=>{var _0x122a0b=_0x49c166;if(_0x184fff==_0x122a0b(0x18d)&&_0xcdfb3a==_0x42435d){var _0x26c26d=_0x1e44bf['slice'](0x3);_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x130)]=_0x1e44bf[0x0],_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x115)]=_0x1e44bf[0x1],_0x2ed8bc[_0xcdfb3a]['bay']=0x0,_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x177)]=0x0,_0x2ed8bc[_0xcdfb3a]['type']='Floor',_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x195)]=_0x26c26d;}else{if(_0x184fff==_0x122a0b(0x15a)&&_0xcdfb3a==_0x42435d){var _0x26c26d=_0x1e44bf['slice'](0x3);_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x130)]=_0x1e44bf[0x0],_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x115)]=_0x1e44bf[0x1],_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x1a1)]=0x0,_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x177)]=0x0,_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x146)]=_0x122a0b(0x184),_0x2ed8bc[_0xcdfb3a]['floorlevel']=_0x1e44bf[0x5];}else{if(_0xcdfb3a==_0x42435d){var _0x33e42f;if(_0x1e44bf[0x4]=='L')_0x33e42f='Level';else _0x1e44bf[0x4]=='F'&&(_0x33e42f=_0x122a0b(0x184));_0x2ed8bc[_0xcdfb3a]['storage']=_0x1e44bf[0x0],_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x115)]=_0x1e44bf[0x1],_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x1a1)]=_0x1e44bf[0x2],_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x177)]=_0x1e44bf[0x3],_0x2ed8bc[_0xcdfb3a][_0x122a0b(0x146)]=_0x33e42f,_0x2ed8bc[_0xcdfb3a]['floorlevel']=_0x1e44bf[0x5];}}}});}),_0x3f29a7['forEach']((_0x259367,_0x36d08d)=>{_0x2ed8bc[_0x36d08d]['unit']=_0x259367;}),_0x5db95f[_0x262bc6(0xd2)]((_0x119029,_0x32a5b1)=>{_0x2ed8bc[_0x32a5b1]['secondary_unit']=_0x119029;}),_0x3ceab2[_0x262bc6(0xd2)]((_0x5cf7ff,_0x5a862f)=>{var _0xd130b3=_0x262bc6;_0x2ed8bc[_0x5a862f][_0xd130b3(0xd0)]=_0x5cf7ff;}),_0x559777[_0x262bc6(0xd2)]((_0x20acdd,_0x7d5f6c)=>{var _0x26ecfa=_0x262bc6;_0x2ed8bc[_0x7d5f6c][_0x26ecfa(0xe8)]=_0x20acdd;}),_0x220c89['forEach']((_0xb030dc,_0x336638)=>{var _0x1dd28a=_0x262bc6;_0x2ed8bc[_0x336638][_0x1dd28a(0x12b)]=_0xb030dc;}),_0x336cee[_0x262bc6(0xd2)]((_0x20f8f0,_0x2b840d)=>{_0x2ed8bc[_0x2b840d]['production_date']=_0x20f8f0;}),_0x1b0a95[_0x262bc6(0xd2)]((_0x1535be,_0x14f652)=>{var _0x26e828=_0x262bc6;_0x2ed8bc[_0x14f652][_0x26e828(0xeb)]=_0x1535be;}),_0x389130[_0x262bc6(0xd2)]((_0x3a0aea,_0x4c98d2)=>{_0x2ed8bc[_0x4c98d2]['delivery_date']=_0x3a0aea;}),_0x4eba21[_0x262bc6(0xd2)]((_0x54c694,_0x13ddd4)=>{_0x2ed8bc[_0x13ddd4]['delivery_code']=_0x54c694;}),_0x2ee20a[_0x262bc6(0xd2)]((_0x366d93,_0x416129)=>{var _0x4a639e=_0x262bc6;_0x2ed8bc[_0x416129][_0x4a639e(0x12d)]=_0x366d93;}),_0x4258a2['forEach']((_0x502617,_0x25e0cd)=>{var _0x281d36=_0x262bc6;_0x2ed8bc[_0x25e0cd][_0x281d36(0xee)]=_0x502617;}),_0x40881f[_0x262bc6(0xd2)]((_0x40e0e7,_0x36f59c)=>{_0x2ed8bc[_0x36f59c]['room_name']=_0x40e0e7;}),_0x2d4b80[_0x262bc6(0xd2)]((_0x81b5ff,_0x3278c0)=>{_0x2ed8bc[_0x3278c0]['invoice']=_0x81b5ff;});var _0x2450df=0x0;_0x2ed8bc[_0x262bc6(0xd2)](_0x8b4ab0=>{var _0x44694f=_0x262bc6;(_0x8b4ab0[_0x44694f(0x103)]<_0x8b4ab0[_0x44694f(0xee)]||_0x8b4ab0[_0x44694f(0xee)]==0x0)&&(console[_0x44694f(0x170)](_0x44694f(0x19e),_0x8b4ab0),_0x2450df++);});const _0x1967f6=_0x2ed8bc['filter'](_0x3e7997=>_0x3e7997['quantity']!=='0'&&_0x3e7997[_0x262bc6(0xe2)]!==''),_0x55a5dd=new sales({'invoice':_0xd7563b,'customer':_0x2a5013[_0x262bc6(0x134)]['customer'],'date':_0x59ed08,'warehouse_name':_0x42b705,'sale_product':_0x1967f6,'note':_0x59672e,'room':_0x453f95,'primary_code':_0xb06fe5,'secondary_code':_0x159d47,'prod_code':_0x1b8b94,'SCRN':_0x42f2e4}),_0x32451f=await _0x55a5dd[_0x262bc6(0xcc)]();_0x2a5013[_0x262bc6(0x12c)](_0x262bc6(0x112),_0x262bc6(0x13f)),_0x1fb469[_0x262bc6(0x1ce)](_0x262bc6(0x11e)+_0x32451f[_0x262bc6(0x190)]);}catch(_0x1f0926){console['log'](_0x1f0926);}}),router[a0_0x59460e(0xf1)](a0_0x59460e(0x14b),auth,async(_0x4b4a39,_0x19f00a)=>{var _0x35f6ee=a0_0x59460e;try{const {username:_0x928c17,email:_0x37b1f7,role:_0x5e819a}=_0x4b4a39[_0x35f6ee(0x1b1)],_0x29b40c=_0x4b4a39[_0x35f6ee(0x1b1)],_0x108439=await profile[_0x35f6ee(0x1af)]({'email':_0x29b40c[_0x35f6ee(0xf9)]}),_0x5b49dd=await master_shop[_0x35f6ee(0x159)](),_0x4153df=_0x4b4a39['params']['id'],_0x4f18ec=await sales[_0x35f6ee(0x14c)](_0x4153df),_0x2372d1=await warehouse[_0x35f6ee(0x1a0)]([{'$match':{'name':_0x4f18ec[_0x35f6ee(0xda)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x35f6ee(0xd8),'name':{'$first':_0x35f6ee(0x153)},'product_stock':{'$first':_0x35f6ee(0x199)},'bay':{'$first':_0x35f6ee(0x1ca)},'bin':{'$first':_0x35f6ee(0x118)},'type':{'$first':_0x35f6ee(0xf3)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x35f6ee(0xdc)},'secondary_code':{'$first':_0x35f6ee(0x128)},'product_code':{'$first':_0x35f6ee(0x165)},'storage':{'$first':_0x35f6ee(0xde)},'rack':{'$first':_0x35f6ee(0xcb)},'expiry_date':{'$first':_0x35f6ee(0x12a)},'production_date':{'$first':_0x35f6ee(0x1b3)}}}]),_0x564179=await customer[_0x35f6ee(0x159)]({});let _0x5cfba0;if(_0x29b40c[_0x35f6ee(0x196)]==_0x35f6ee(0x19c)){const _0x42ed64=await staff[_0x35f6ee(0x1af)]({'email':_0x29b40c[_0x35f6ee(0xf9)]});_0x5cfba0=await warehouse['aggregate']([{'$match':{'status':_0x35f6ee(0x149),'name':_0x42ed64[_0x35f6ee(0xc8)]}},{'$group':{'_id':_0x35f6ee(0xed),'name':{'$first':'$name'}}}]);}else _0x5cfba0=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x35f6ee(0xed),'name':{'$first':_0x35f6ee(0xed)}}}]);const _0x3d048a=await product[_0x35f6ee(0x159)]({}),_0x4ef994=await suppliers[_0x35f6ee(0x159)]({});if(_0x5b49dd[0x0][_0x35f6ee(0x1c6)]=='English\x20(US)'){var _0x19c3ad=users['English'];console['log'](_0x19c3ad);}else{if(_0x5b49dd[0x0][_0x35f6ee(0x1c6)]=='Hindi')var _0x19c3ad=users['Hindi'];else{if(_0x5b49dd[0x0][_0x35f6ee(0x1c6)]==_0x35f6ee(0x169))var _0x19c3ad=users[_0x35f6ee(0x169)];else{if(_0x5b49dd[0x0][_0x35f6ee(0x1c6)]=='Spanish')var _0x19c3ad=users[_0x35f6ee(0x173)];else{if(_0x5b49dd[0x0][_0x35f6ee(0x1c6)]==_0x35f6ee(0x171))var _0x19c3ad=users[_0x35f6ee(0x171)];else{if(_0x5b49dd[0x0][_0x35f6ee(0x1c6)]==_0x35f6ee(0xe7))var _0x19c3ad=users[_0x35f6ee(0x117)];else{if(_0x5b49dd[0x0]['language']=='Chinese')var _0x19c3ad=users[_0x35f6ee(0x15f)];else{if(_0x5b49dd[0x0][_0x35f6ee(0x1c6)]==_0x35f6ee(0x1aa))var _0x19c3ad=users['Arabic'];}}}}}}}_0x19f00a[_0x35f6ee(0x1c2)]('edit_sales_view',{'success':_0x4b4a39['flash'](_0x35f6ee(0x112)),'errors':_0x4b4a39[_0x35f6ee(0x12c)]('errors'),'role':_0x29b40c,'profile':_0x108439,'customer':_0x564179,'warehouse':_0x5cfba0,'product':_0x2372d1,'user':_0x4f18ec,'master_shop':_0x5b49dd,'unit':_0x3d048a,'language':_0x19c3ad,'suppliers':_0x4ef994});}catch(_0x5d02ed){console[_0x35f6ee(0x170)](_0x5d02ed);}}),router['post'](a0_0x59460e(0x14b),auth,async(_0x11e932,_0x5f1cde)=>{var _0x4c2343=a0_0x59460e;try{const _0x5ac9a8=_0x11e932['params']['id'],{invoice:_0x5b0876,warehouse_name:_0x27f37e,room:_0x3449bb}=_0x11e932[_0x4c2343(0x134)],_0x4e8c71=await sales[_0x4c2343(0x1af)]({'invoice':_0x5b0876}),_0x56a332=_0x4e8c71[_0x4c2343(0x1c4)][_0x4c2343(0x1a5)](async _0x2df54c=>{var _0x292cbc=_0x4c2343,_0x561876=await warehouse[_0x292cbc(0x1af)]({'name':_0x27f37e,'room':_0x2df54c[_0x292cbc(0x1ad)],'warehouse_category':_0x292cbc(0x137)});const _0xdf0e2f=_0x561876['product_details']['map'](_0x15affa=>{var _0xf899fe=_0x292cbc;_0x15affa[_0xf899fe(0xdd)]==_0x2df54c[_0xf899fe(0xdd)]&&_0x15affa[_0xf899fe(0x195)]==_0x2df54c[_0xf899fe(0x195)]&&_0x15affa['type']==_0x2df54c[_0xf899fe(0x146)]&&_0x15affa['bin']==_0x2df54c[_0xf899fe(0x177)]&&_0x15affa[_0xf899fe(0x1a1)]==_0x2df54c[_0xf899fe(0x1a1)]&&_0x15affa[_0xf899fe(0x115)]==_0x2df54c[_0xf899fe(0x115)]&&_0x15affa[_0xf899fe(0x130)]==_0x2df54c[_0xf899fe(0x130)]&&_0x15affa[_0xf899fe(0xe8)]==_0x2df54c[_0xf899fe(0xe8)]&&_0x15affa[_0xf899fe(0xd0)]==_0x2df54c['batch_code']&&_0x15affa[_0xf899fe(0x191)]==_0x2df54c['invoice']&&(_0x15affa[_0xf899fe(0x138)]=_0x15affa[_0xf899fe(0x138)]-_0x2df54c[_0xf899fe(0xe2)]);});return _0x561876;});Promise[_0x4c2343(0x136)](_0x56a332)['then'](async _0x87a094=>{var _0x3a3cee=_0x4c2343;try{for(const _0x267496 of _0x87a094){await _0x267496['save']();}_0x4e8c71[_0x3a3cee(0x1cf)]=_0x3a3cee(0x1a7);const _0x279472=await _0x4e8c71[_0x3a3cee(0xcc)](),_0x2b11e0=await master_shop[_0x3a3cee(0x159)](),_0x4de07c=await email_settings['findOne'](),_0x20b3bd=await supervisor_settings[_0x3a3cee(0x159)]();var _0x5e0ccb=_0x4e8c71[_0x3a3cee(0x1c4)],_0x35e294='',_0x10038b;for(_0x10038b in _0x5e0ccb){_0x35e294+='<tr>'+_0x3a3cee(0x157)+_0x5e0ccb[_0x10038b][_0x3a3cee(0xdd)]+_0x3a3cee(0x11a)+_0x3a3cee(0x157)+_0x5e0ccb[_0x10038b][_0x3a3cee(0x1a4)]+_0x3a3cee(0x11a)+_0x3a3cee(0x157)+_0x5e0ccb[_0x10038b]['quantity']+'</td>'+_0x3a3cee(0x157)+_0x5e0ccb[_0x10038b][_0x3a3cee(0x189)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5e0ccb[_0x10038b]['secondary_unit']+_0x3a3cee(0x11a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4e8c71[_0x3a3cee(0xda)]+_0x3a3cee(0x11a)+_0x3a3cee(0x157)+_0x5e0ccb[_0x10038b]['room_name']+_0x3a3cee(0x11a)+_0x3a3cee(0x157)+_0x5e0ccb[_0x10038b][_0x3a3cee(0x130)]+_0x5e0ccb[_0x10038b][_0x3a3cee(0x115)]+_0x5e0ccb[_0x10038b][_0x3a3cee(0x1a1)]+_0x5e0ccb[_0x10038b][_0x3a3cee(0x177)]+_0x5e0ccb[_0x10038b][_0x3a3cee(0x146)][0x0]+_0x5e0ccb[_0x10038b][_0x3a3cee(0x195)]+'</td>',_0x3a3cee(0xd7);}let _0x77ec6=nodemailer[_0x3a3cee(0x17d)]({'host':_0x4de07c[_0x3a3cee(0x120)],'port':Number(_0x4de07c['port']),'secure':![],'auth':{'user':_0x4de07c[_0x3a3cee(0xf9)],'pass':_0x4de07c[_0x3a3cee(0xd3)]}}),_0x2cc455={'from':_0x4de07c[_0x3a3cee(0xf9)],'to':_0x20b3bd[0x0][_0x3a3cee(0x132)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x3a3cee(0x1ab),'path':__dirname+_0x3a3cee(0x11c)+_0x3a3cee(0x114)+_0x2b11e0[0x0][_0x3a3cee(0x178)],'cid':_0x3a3cee(0xf6)}],'html':_0x3a3cee(0xf0)+_0x3a3cee(0xca)+_0x3a3cee(0x16f)+_0x3a3cee(0xef)+_0x3a3cee(0x15c)+_0x3a3cee(0xef)+_0x3a3cee(0x15e)+_0x3a3cee(0xe4)+'<div>'+_0x3a3cee(0x185)+_0x2b11e0[0x0]['site_title']+_0x3a3cee(0x188)+'</div>'+_0x3a3cee(0xe4)+'<hr\x20class=\x22my-3\x22>'+_0x3a3cee(0xef)+_0x3a3cee(0x123)+_0x3a3cee(0x160)+_0x4e8c71[_0x3a3cee(0x191)]+'\x20'+_0x3a3cee(0x10f)+_0x3a3cee(0x1bb)+_0x4e8c71[_0x3a3cee(0x1bf)]+'\x20'+_0x3a3cee(0x131)+'</h5>'+'</div>'+_0x3a3cee(0x119)+_0x3a3cee(0x193)+_0x3a3cee(0x15d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x3a3cee(0xf8)+_0x3a3cee(0xf5)+_0x3a3cee(0x1b7)+_0x3a3cee(0x166)+_0x3a3cee(0x151)+_0x3a3cee(0x143)+_0x3a3cee(0xd7)+_0x3a3cee(0x127)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x35e294+'\x20'+_0x3a3cee(0x174)+_0x3a3cee(0x135)+'<div>'+_0x3a3cee(0x175)+'<h5>'+_0x2b11e0[0x0][_0x3a3cee(0x12e)]+'</h5>'+_0x3a3cee(0xe4)+'</div>'+_0x3a3cee(0x122)};_0x77ec6[_0x3a3cee(0x187)](_0x2cc455,function(_0x9fa5f4,_0x4a90d1){var _0x572a7a=_0x3a3cee;_0x9fa5f4?(console[_0x572a7a(0x170)](_0x9fa5f4),console[_0x572a7a(0x170)](_0x572a7a(0x158))):console['log']('Email\x20sent\x20successfully');}),_0x11e932[_0x3a3cee(0x12c)]('success',_0x3a3cee(0x1c8)),_0x5f1cde[_0x3a3cee(0x1ce)](_0x3a3cee(0x11e)+_0x5ac9a8);}catch(_0x43bfb7){console['error'](_0x43bfb7),_0x5f1cde['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x4c2343(0x1c0)](_0x4258b1=>{var _0x73cce6=_0x4c2343;console[_0x73cce6(0x176)](_0x4258b1),_0x5f1cde[_0x73cce6(0x1cd)](0x1f4)[_0x73cce6(0x1bd)]({'error':_0x73cce6(0x19d)});});}catch(_0x3f66d3){console[_0x4c2343(0x170)](_0x3f66d3);}}),router[a0_0x59460e(0xf1)](a0_0x59460e(0xec),auth,async(_0x3cbc63,_0x5b5e09)=>{var _0x24fb62=a0_0x59460e;try{const {username:_0x516ccf,email:_0x1f50e9,role:_0x1b2066}=_0x3cbc63[_0x24fb62(0x1b1)],_0xe8a3ea=_0x3cbc63[_0x24fb62(0x1b1)],_0x48df96=await profile[_0x24fb62(0x1af)]({'email':_0xe8a3ea[_0x24fb62(0xf9)]}),_0x44a27e=await master_shop[_0x24fb62(0x159)](),_0x1b5110=_0x3cbc63[_0x24fb62(0x1c9)]['id'],_0x84a58c=await sales[_0x24fb62(0x14c)](_0x1b5110);var _0x3e9ba5=[_0x24fb62(0x126),'Enclosed'];const _0x3cd75a=await warehouse[_0x24fb62(0x1a0)]([{'$match':{'name':_0x84a58c[_0x24fb62(0xda)],'warehouse_category':_0x24fb62(0x137)}},{'$unwind':_0x24fb62(0x1a2)},{'$group':{'_id':_0x24fb62(0xd8),'name':{'$first':_0x24fb62(0x153)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x24fb62(0x118)},'type':{'$first':_0x24fb62(0xf3)},'floorlevel':{'$first':_0x24fb62(0x16c)},'primary_code':{'$first':_0x24fb62(0xdc)},'secondary_code':{'$first':_0x24fb62(0x128)},'product_code':{'$first':_0x24fb62(0x165)},'storage':{'$first':_0x24fb62(0xde)},'rack':{'$first':_0x24fb62(0xcb)}}}]),_0x567382=await customer[_0x24fb62(0x159)]({});let _0x562c22;if(_0xe8a3ea[_0x24fb62(0x196)]=='staff'){const _0x5cef2b=await staff[_0x24fb62(0x1af)]({'email':_0xe8a3ea[_0x24fb62(0xf9)]});_0x562c22=await warehouse[_0x24fb62(0x1a0)]([{'$match':{'status':_0x24fb62(0x149),'name':_0x5cef2b[_0x24fb62(0xc8)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x24fb62(0xed),'name':{'$first':'$name'}}}]);}else _0x562c22=await warehouse[_0x24fb62(0x1a0)]([{'$match':{'status':_0x24fb62(0x149),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x24fb62(0xed),'name':{'$first':'$name'}}}]);const _0x2bc3a4=await product['find']({});if(_0x44a27e[0x0][_0x24fb62(0x1c6)]=='English\x20(US)'){var _0x644ac2=users[_0x24fb62(0x1be)];console[_0x24fb62(0x170)](_0x644ac2);}else{if(_0x44a27e[0x0][_0x24fb62(0x1c6)]==_0x24fb62(0xd4))var _0x644ac2=users[_0x24fb62(0xd4)];else{if(_0x44a27e[0x0][_0x24fb62(0x1c6)]==_0x24fb62(0x169))var _0x644ac2=users[_0x24fb62(0x169)];else{if(_0x44a27e[0x0][_0x24fb62(0x1c6)]=='Spanish')var _0x644ac2=users[_0x24fb62(0x173)];else{if(_0x44a27e[0x0][_0x24fb62(0x1c6)]==_0x24fb62(0x171))var _0x644ac2=users[_0x24fb62(0x171)];else{if(_0x44a27e[0x0][_0x24fb62(0x1c6)]==_0x24fb62(0xe7))var _0x644ac2=users['Portuguese'];else{if(_0x44a27e[0x0][_0x24fb62(0x1c6)]==_0x24fb62(0x15f))var _0x644ac2=users[_0x24fb62(0x15f)];else{if(_0x44a27e[0x0]['language']=='Arabic\x20(ae)')var _0x644ac2=users[_0x24fb62(0xe1)];}}}}}}}_0x5b5e09['render']('edit_sales',{'success':_0x3cbc63[_0x24fb62(0x12c)](_0x24fb62(0x112)),'errors':_0x3cbc63['flash'](_0x24fb62(0x100)),'role':_0xe8a3ea,'profile':_0x48df96,'customer':_0x567382,'warehouse':_0x562c22,'product':_0x3cd75a,'user':_0x84a58c,'master_shop':_0x44a27e,'unit':_0x2bc3a4,'language':_0x644ac2});}catch(_0x50b3fb){console[_0x24fb62(0x170)](_0x50b3fb);}}),router[a0_0x59460e(0x154)]('/view/:id',auth,async(_0x3ec6db,_0x577e5d)=>{var _0x1b3792=a0_0x59460e;try{const _0x3d9af7=_0x3ec6db[_0x1b3792(0x1c9)]['id'],_0x3e63de=await sales[_0x1b3792(0x1af)]({'_id':_0x3ec6db[_0x1b3792(0x1c9)]['id']}),_0x618767=await warehouse['findOne']({'name':_0x3e63de[_0x1b3792(0xda)],'room':_0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x10a)]}),{invoice:_0x4b93a1,date:_0x29d5f,warehouse_name:_0x72880a,product_name:_0x29f5b3,stock:_0x13b9df,quantity:_0x456883,note:_0x25623c,room:_0x210149,customer:_0x1c0cbe,SCRN:_0xf0220e}=_0x3ec6db['body'];if(typeof _0x29f5b3==_0x1b3792(0x18b))var _0x87d595=[_0x3ec6db['body'][_0x1b3792(0xdd)]],_0x357916=[_0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x103)]],_0x37e24a=[_0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x19f)]],_0xdbcabc=[_0x3ec6db['body']['primary_code']],_0x51d89a=[_0x3ec6db[_0x1b3792(0x134)]['secondary_code']],_0x28adf5=[_0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0xd6)]],_0x3e2a0d=[_0x3ec6db[_0x1b3792(0x134)]['level']],_0x3cda6e=[_0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x17b)]],_0x4d1134=[_0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x14a)]],_0x40a1b2=[_0x3ec6db[_0x1b3792(0x134)]['batch_code']],_0x365a42=[_0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0xe8)]],_0x57a865=[_0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0xce)]],_0x27e8dc=[_0x3ec6db['body'][_0x1b3792(0x116)]],_0x16928a=[_0x3ec6db[_0x1b3792(0x134)]['requested_qty']],_0xfe8af7=[_0x3ec6db['body'][_0x1b3792(0x198)]],_0x25372a=[_0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0xe6)]],_0x2064f4=[_0x3ec6db['body'][_0x1b3792(0x12d)]],_0x6c3a2c=[_0x3ec6db[_0x1b3792(0x134)]['quantity']],_0x363892=[_0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x13e)]];else var _0x87d595=[..._0x3ec6db[_0x1b3792(0x134)]['product_name']],_0x357916=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x103)]],_0x37e24a=[..._0x3ec6db['body'][_0x1b3792(0x19f)]],_0xdbcabc=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0xfe)]],_0x51d89a=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0xd1)]],_0x28adf5=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0xd6)]],_0x3e2a0d=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x141)]],_0x3cda6e=[..._0x3ec6db['body'][_0x1b3792(0x17b)]],_0x4d1134=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x14a)]],_0x40a1b2=[..._0x3ec6db[_0x1b3792(0x134)]['batch_code']],_0x365a42=[..._0x3ec6db[_0x1b3792(0x134)]['expiry_date']],_0x57a865=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0xce)]],_0x27e8dc=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x116)]],_0x16928a=[..._0x3ec6db['body'][_0x1b3792(0xeb)]],_0xfe8af7=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x198)]],_0x25372a=[..._0x3ec6db['body']['delivery_code']],_0x2064f4=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x12d)]],_0x6c3a2c=[..._0x3ec6db['body'][_0x1b3792(0xe2)]],_0x363892=[..._0x3ec6db[_0x1b3792(0x134)][_0x1b3792(0x13e)]];const _0x3f6753=_0x87d595[_0x1b3792(0x1a5)](_0x3d3853=>{return _0x3d3853={'product_name':_0x3d3853};});_0x357916['forEach']((_0x2fc620,_0x5e9d53)=>{var _0x12e825=_0x1b3792;_0x3f6753[_0x5e9d53][_0x12e825(0x103)]=_0x2fc620;}),_0x37e24a[_0x1b3792(0xd2)]((_0x1f25d3,_0x405f0b)=>{_0x3f6753[_0x405f0b]['quantity']=_0x1f25d3;}),_0xdbcabc[_0x1b3792(0xd2)]((_0x26a87d,_0x19f282)=>{var _0x70ea98=_0x1b3792;_0x3f6753[_0x19f282][_0x70ea98(0xfe)]=_0x26a87d;}),_0x51d89a[_0x1b3792(0xd2)]((_0x169b1d,_0x94a893)=>{var _0x41078b=_0x1b3792;_0x3f6753[_0x94a893][_0x41078b(0xd1)]=_0x169b1d;}),_0x28adf5[_0x1b3792(0xd2)]((_0x4c5cb2,_0x52f34f)=>{_0x3f6753[_0x52f34f]['product_code']=_0x4c5cb2;}),_0x3e2a0d[_0x1b3792(0xd2)]((_0x28ba34,_0x5e9adc)=>{var _0x54c9fb=_0x1b3792;_0x363892[_0x54c9fb(0xd2)]((_0x595851,_0x1e3afe)=>{var _0x1320c0=_0x54c9fb;if(_0x595851==_0x1320c0(0x18d)&&_0x5e9adc==_0x1e3afe){var _0x2e2ec6=_0x28ba34['slice'](0x3);_0x3f6753[_0x5e9adc][_0x1320c0(0x130)]=_0x28ba34[0x0],_0x3f6753[_0x5e9adc][_0x1320c0(0x115)]=_0x28ba34[0x1],_0x3f6753[_0x5e9adc][_0x1320c0(0x1a1)]=0x0,_0x3f6753[_0x5e9adc]['bin']=0x0,_0x3f6753[_0x5e9adc][_0x1320c0(0x146)]=_0x1320c0(0x184),_0x3f6753[_0x5e9adc][_0x1320c0(0x195)]=_0x2e2ec6;}else{if(_0x595851==_0x1320c0(0x15a)&&_0x5e9adc==_0x1e3afe){var _0x2e2ec6=_0x28ba34[_0x1320c0(0x16a)](0x3);_0x3f6753[_0x5e9adc][_0x1320c0(0x130)]=_0x28ba34[0x0],_0x3f6753[_0x5e9adc][_0x1320c0(0x115)]=_0x28ba34[0x1],_0x3f6753[_0x5e9adc][_0x1320c0(0x1a1)]=0x0,_0x3f6753[_0x5e9adc]['bin']=0x0,_0x3f6753[_0x5e9adc]['type']=_0x1320c0(0x184),_0x3f6753[_0x5e9adc][_0x1320c0(0x195)]=_0x28ba34[0x5];}else{if(_0x5e9adc==_0x1e3afe){var _0xdde23f;if(_0x28ba34[0x4]=='L')_0xdde23f=_0x1320c0(0x1cb);else _0x28ba34[0x4]=='F'&&(_0xdde23f=_0x1320c0(0x184));_0x3f6753[_0x5e9adc][_0x1320c0(0x130)]=_0x28ba34[0x0],_0x3f6753[_0x5e9adc][_0x1320c0(0x115)]=_0x28ba34[0x1],_0x3f6753[_0x5e9adc][_0x1320c0(0x1a1)]=_0x28ba34[0x2],_0x3f6753[_0x5e9adc]['bin']=_0x28ba34[0x3],_0x3f6753[_0x5e9adc][_0x1320c0(0x146)]=_0xdde23f,_0x3f6753[_0x5e9adc]['floorlevel']=_0x28ba34[0x5];}}}});}),_0x3cda6e[_0x1b3792(0xd2)]((_0x1af864,_0x587d43)=>{_0x3f6753[_0x587d43]['unit']=_0x1af864;}),_0x4d1134[_0x1b3792(0xd2)]((_0x517551,_0x2d86a9)=>{var _0x1d3a26=_0x1b3792;_0x3f6753[_0x2d86a9][_0x1d3a26(0x14a)]=_0x517551;}),_0x40a1b2['forEach']((_0x429740,_0x2225a7)=>{var _0xd9ca18=_0x1b3792;_0x3f6753[_0x2225a7][_0xd9ca18(0xd0)]=_0x429740;}),_0x365a42[_0x1b3792(0xd2)]((_0x2bf8aa,_0x2f5483)=>{var _0x36854a=_0x1b3792;_0x3f6753[_0x2f5483][_0x36854a(0xe8)]=_0x2bf8aa;}),_0x57a865[_0x1b3792(0xd2)]((_0x554908,_0x3e131d)=>{var _0x5eaff3=_0x1b3792;_0x3f6753[_0x3e131d][_0x5eaff3(0x12b)]=_0x554908;}),_0x27e8dc[_0x1b3792(0xd2)]((_0x585aa4,_0x1255c2)=>{_0x3f6753[_0x1255c2]['production_date']=_0x585aa4;}),_0x16928a[_0x1b3792(0xd2)]((_0x16a0b3,_0x522aa7)=>{var _0x523074=_0x1b3792;_0x3f6753[_0x522aa7][_0x523074(0xeb)]=_0x16a0b3;}),_0xfe8af7[_0x1b3792(0xd2)]((_0x525f12,_0x4e9f89)=>{var _0x3cd45b=_0x1b3792;_0x3f6753[_0x4e9f89][_0x3cd45b(0x198)]=_0x525f12;}),_0x25372a[_0x1b3792(0xd2)]((_0x260ba4,_0x3d9cb3)=>{var _0x5ab3f7=_0x1b3792;_0x3f6753[_0x3d9cb3][_0x5ab3f7(0xe6)]=_0x260ba4;}),_0x2064f4[_0x1b3792(0xd2)]((_0x709b63,_0x12fefc)=>{var _0x14e68b=_0x1b3792;_0x3f6753[_0x12fefc][_0x14e68b(0x12d)]=_0x709b63;}),_0x6c3a2c[_0x1b3792(0xd2)]((_0x1b17d0,_0x407c64)=>{var _0x42d3fb=_0x1b3792;_0x3f6753[_0x407c64][_0x42d3fb(0xee)]=_0x1b17d0;}),_0x363892[_0x1b3792(0xd2)]((_0x13ac3a,_0x2ac88c)=>{var _0xca99c1=_0x1b3792;_0x3f6753[_0x2ac88c][_0xca99c1(0x1ad)]=_0x13ac3a;});var _0x2b6b6a=0x0;_0x3f6753[_0x1b3792(0xd2)](_0x9cd6ef=>{var _0x337ce4=_0x1b3792;console['log']('foreach\x20newproduct',_0x9cd6ef),(parseInt(_0x9cd6ef['stock'])<parseInt(_0x9cd6ef['quantity'])||parseInt(_0x9cd6ef[_0x337ce4(0xe2)])==0x0)&&_0x2b6b6a++;});if(_0x2b6b6a!=0x0)return _0x3ec6db[_0x1b3792(0x12c)](_0x1b3792(0x100),_0x1b3792(0x145)),_0x577e5d[_0x1b3792(0x1ce)](_0x1b3792(0x16e));const _0x4bcf2b=_0x3f6753[_0x1b3792(0x110)](_0x4cab8f=>_0x4cab8f[_0x1b3792(0xe2)]!=='0'&&_0x4cab8f[_0x1b3792(0xe2)]!=='');_0x3e63de['invoice']=_0x4b93a1,_0x3e63de[_0x1b3792(0x181)]=_0x1c0cbe,_0x3e63de[_0x1b3792(0x1bf)]=_0x29d5f,_0x3e63de[_0x1b3792(0xda)]=_0x72880a,_0x3e63de[_0x1b3792(0x1c4)]=_0x4bcf2b,_0x3e63de[_0x1b3792(0x183)]=_0x25623c,_0x3e63de['SCRN']=_0xf0220e,_0x3e63de['finalize']=_0x1b3792(0x17e),_0x3e63de['isAllowEdit']=_0x1b3792(0x17e);const _0x16a184=await _0x3e63de[_0x1b3792(0xcc)]();_0x3ec6db[_0x1b3792(0x12c)](_0x1b3792(0x112),'Sales\x20Update\x20successfully'),_0x577e5d[_0x1b3792(0x1ce)]('/all_sales/view');}catch(_0x14fd17){console[_0x1b3792(0x170)](_0x14fd17);}}),router['post'](a0_0x59460e(0x105),auth,async(_0x45392e,_0x3592f1)=>{var _0x4b5911=a0_0x59460e;try{const _0x4b0a46=_0x45392e[_0x4b5911(0x1c9)]['id'],{invoice:_0x1ccb1f,customer:_0x1bf85d,receivable_amount:_0x37e4f6,received_amount:_0x179ac9}=_0x45392e[_0x4b5911(0x134)],_0x2c780d=await sales['findById'](_0x4b0a46);console[_0x4b5911(0x170)](_0x2c780d);var _0x33b3b8=_0x37e4f6-_0x179ac9;console[_0x4b5911(0x170)](_0x179ac9),_0x2c780d[_0x4b5911(0x148)]=parseFloat(_0x179ac9)+parseFloat(_0x2c780d['received_amount']),_0x2c780d['due_amount']=_0x33b3b8,console[_0x4b5911(0x170)](_0x2c780d);const _0x2e6a93=await _0x2c780d[_0x4b5911(0xcc)](),_0x25bf74=await c_payment_data[_0x4b5911(0x1af)]({'invoice':_0x1ccb1f});_0x25bf74[_0x4b5911(0x108)]=_0x33b3b8,await _0x25bf74[_0x4b5911(0xcc)]();let _0x417cfd=new Date(),_0x53f492=('0'+_0x417cfd[_0x4b5911(0x10e)]())[_0x4b5911(0x16a)](-0x2),_0x3324ed=('0'+(_0x417cfd[_0x4b5911(0x1a6)]()+0x1))['slice'](-0x2),_0x2cd6ec=_0x417cfd[_0x4b5911(0x19a)](),_0x1bacf5=_0x2cd6ec+'-'+_0x3324ed+'-'+_0x53f492;const _0x17e3a1=new customer_payment({'invoice':_0x1ccb1f,'date':_0x2cd6ec+'-'+_0x3324ed+'-'+_0x53f492,'customer':_0x1bf85d,'reason':_0x4b5911(0x1bc),'amount':_0x179ac9}),_0x2ae9b7=await _0x17e3a1[_0x4b5911(0xcc)]();_0x45392e['flash']('success',_0x4b5911(0x11b)),_0x3592f1[_0x4b5911(0x1ce)]('/all_sales/view');}catch(_0x517e44){console[_0x4b5911(0x170)](_0x517e44);}}),router['get'](a0_0x59460e(0x17a),auth,async(_0xcaa213,_0xa631f3)=>{var _0x5cc640=a0_0x59460e;try{const {username:_0x2db457,email:_0x3c8add,role:_0x1b729b}=_0xcaa213[_0x5cc640(0x1b1)],_0x429f63=_0xcaa213[_0x5cc640(0x1b1)],_0xaa3fe3=await profile[_0x5cc640(0x1af)]({'email':_0x429f63[_0x5cc640(0xf9)]}),_0x1e7a84=await master_shop[_0x5cc640(0x159)]();console['log']('master',_0x1e7a84);const _0x3f3b57=_0xcaa213[_0x5cc640(0x1c9)]['id'],_0x5c2281=await sales['findById'](_0x3f3b57);console[_0x5cc640(0x170)](_0x5c2281);const _0x486cfc=await customer['findOne']({'name':_0x5c2281['customer']});console[_0x5cc640(0x170)](_0x486cfc);if(_0x1e7a84[0x0][_0x5cc640(0x1c6)]==_0x5cc640(0x121)){var _0x2271cb=users[_0x5cc640(0x1be)];console['log'](_0x2271cb);}else{if(_0x1e7a84[0x0]['language']=='Hindi')var _0x2271cb=users[_0x5cc640(0xd4)];else{if(_0x1e7a84[0x0]['language']=='German')var _0x2271cb=users[_0x5cc640(0x169)];else{if(_0x1e7a84[0x0]['language']==_0x5cc640(0x173))var _0x2271cb=users[_0x5cc640(0x173)];else{if(_0x1e7a84[0x0]['language']==_0x5cc640(0x171))var _0x2271cb=users['French'];else{if(_0x1e7a84[0x0][_0x5cc640(0x1c6)]==_0x5cc640(0xe7))var _0x2271cb=users[_0x5cc640(0x117)];else{if(_0x1e7a84[0x0]['language']==_0x5cc640(0x15f))var _0x2271cb=users[_0x5cc640(0x15f)];else{if(_0x1e7a84[0x0][_0x5cc640(0x1c6)]==_0x5cc640(0x1aa))var _0x2271cb=users[_0x5cc640(0xe1)];}}}}}}}_0xa631f3[_0x5cc640(0x1c2)](_0x5cc640(0xcf),{'success':_0xcaa213[_0x5cc640(0x12c)](_0x5cc640(0x112)),'errors':_0xcaa213['flash']('errors'),'role':_0x429f63,'profile':_0xaa3fe3,'master_shop':_0x1e7a84,'customers':_0x486cfc,'sales':_0x5c2281,'language':_0x2271cb});}catch(_0x49b783){console[_0x5cc640(0x170)](_0x49b783);}}),router[a0_0x59460e(0xf1)](a0_0x59460e(0x113),auth,async(_0x2ffea1,_0x15ea4b)=>{var _0x4c4b3e=a0_0x59460e;try{const {username:_0x2ae6c8,email:_0x55fd64,role:_0x2146b3}=_0x2ffea1[_0x4c4b3e(0x1b1)],_0x5bf5b4=_0x2ffea1['user'],_0x5748e7=await profile['findOne']({'email':_0x5bf5b4[_0x4c4b3e(0xf9)]}),_0x26fb9a=await master_shop[_0x4c4b3e(0x159)]();console[_0x4c4b3e(0x170)](_0x4c4b3e(0x163),_0x26fb9a);const _0x1dac9a=_0x2ffea1[_0x4c4b3e(0x1c9)]['id'];console['log'](_0x1dac9a);const _0x4c188e=await sales['findById'](_0x1dac9a);console['log']('user_id',_0x4c188e);const _0x2ff3f6=await warehouse['aggregate']([{'$match':{'name':_0x4c4b3e(0x101),'room':'Return\x20Rooms'}},{'$unwind':_0x4c4b3e(0x1a2)},{'$group':{'_id':_0x4c4b3e(0xd8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x4c4b3e(0x13b)},'isle':{'$first':_0x4c4b3e(0x156)},'pallet':{'$first':_0x4c4b3e(0x13c)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4c4b3e(0x128)},'product_code':{'$first':_0x4c4b3e(0x165)}}}]);console[_0x4c4b3e(0x170)]('stock_data',_0x2ff3f6);const _0x2a5e93=await product['find']({});warehouse_data=await warehouse[_0x4c4b3e(0x1a0)]([{'$match':{'status':_0x4c4b3e(0x149),'name':_0x4c4b3e(0x101),'warehouse_category':_0x4c4b3e(0x137)}},{'$group':{'_id':_0x4c4b3e(0xed),'name':{'$first':_0x4c4b3e(0xed)}}},{'$sort':{'name':0x1}}]);var _0x378c3a=[_0x4c4b3e(0x1a9)];if(_0x26fb9a[0x0]['language']==_0x4c4b3e(0x121)){var _0x3096cc=users[_0x4c4b3e(0x1be)];console[_0x4c4b3e(0x170)](_0x3096cc);}else{if(_0x26fb9a[0x0][_0x4c4b3e(0x1c6)]==_0x4c4b3e(0xd4))var _0x3096cc=users['Hindi'];else{if(_0x26fb9a[0x0][_0x4c4b3e(0x1c6)]=='German')var _0x3096cc=users[_0x4c4b3e(0x169)];else{if(_0x26fb9a[0x0]['language']==_0x4c4b3e(0x173))var _0x3096cc=users['Spanish'];else{if(_0x26fb9a[0x0]['language']==_0x4c4b3e(0x171))var _0x3096cc=users[_0x4c4b3e(0x171)];else{if(_0x26fb9a[0x0][_0x4c4b3e(0x1c6)]=='Portuguese\x20(BR)')var _0x3096cc=users[_0x4c4b3e(0x117)];else{if(_0x26fb9a[0x0][_0x4c4b3e(0x1c6)]=='Chinese')var _0x3096cc=users[_0x4c4b3e(0x15f)];else{if(_0x26fb9a[0x0]['language']==_0x4c4b3e(0x1aa))var _0x3096cc=users['Arabic'];}}}}}}}_0x15ea4b[_0x4c4b3e(0x1c2)](_0x4c4b3e(0x14f),{'success':_0x2ffea1[_0x4c4b3e(0x12c)](_0x4c4b3e(0x112)),'errors':_0x2ffea1[_0x4c4b3e(0x12c)](_0x4c4b3e(0x100)),'role':_0x5bf5b4,'profile':_0x5748e7,'user':_0x4c188e,'stock':_0x2ff3f6,'master_shop':_0x26fb9a,'unit':_0x2a5e93,'language':_0x3096cc,'warehouses':warehouse_data,'rooms':_0x378c3a});}catch(_0xe6d8c3){console[_0x4c4b3e(0x170)](_0xe6d8c3),_0x15ea4b[_0x4c4b3e(0x1cd)](0xc8)[_0x4c4b3e(0x1bd)]({'message':_0xe6d8c3[_0x4c4b3e(0x1a3)]});}}),router['post'](a0_0x59460e(0x113),auth,async(_0x3f7f52,_0x340417)=>{var _0x1a0253=a0_0x59460e;try{const {invoice:_0x58da06,date:_0x4df3d0,warehouse_name:_0x30947d,product_name:_0x3e3954,primary_code:_0x3a4518,secondary_code:_0x10fbe7,product_code:_0x1fc179,sales_quantity:_0x4317e4,stocks:_0x3a8ea7,return_qty:_0x58cb0d,Room_name:_0x3e7308,to_warehouse_name:_0x1c8d8f,to_Roomname:_0x6fe7a4,to_Room_name:_0x55d9e6,note:_0x553968,level:_0x503ace,isle:_0x200ee9,pallet:_0x3b5062}=_0x3f7f52[_0x1a0253(0x134)];if(typeof _0x3e3954==_0x1a0253(0x18b))var _0x34b872=[_0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0xdd)]],_0x121c1d=[_0x3f7f52['body'][_0x1a0253(0xfe)]],_0xa8e7c5=[_0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0xd1)]],_0x367fc2=[_0x3f7f52[_0x1a0253(0x134)]['product_code']],_0x3d467f=[_0x3f7f52['body'][_0x1a0253(0x142)]],_0x3fb56f=[_0x3f7f52[_0x1a0253(0x134)]['stocks']],_0x5ac299=[_0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x11d)]],_0x218179=[_0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x1a1)]],_0x821c82=[_0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x177)]],_0x5cc6bd=[_0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x147)]],_0x362ab1=[_0x3f7f52[_0x1a0253(0x134)]['floorlevel']];else var _0x34b872=[..._0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0xdd)]],_0x121c1d=[..._0x3f7f52[_0x1a0253(0x134)]['primary_code']],_0xa8e7c5=[..._0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0xd1)]],_0x367fc2=[..._0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x1a4)]],_0x3d467f=[..._0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x142)]],_0x3fb56f=[..._0x3f7f52[_0x1a0253(0x134)]['stocks']],_0x5ac299=[..._0x3f7f52['body']['return_qty']],_0x218179=[..._0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x1a1)]],_0x821c82=[..._0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x177)]],_0x5cc6bd=[..._0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x147)]],_0x362ab1=[..._0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x195)]];const _0x15fa26=_0x34b872[_0x1a0253(0x1a5)](_0x407422=>{return _0x407422={'product_name':_0x407422};});_0x121c1d[_0x1a0253(0xd2)]((_0x2f1d71,_0xaa5e14)=>{var _0xe8d995=_0x1a0253;_0x15fa26[_0xaa5e14][_0xe8d995(0xfe)]=_0x2f1d71;}),_0xa8e7c5[_0x1a0253(0xd2)]((_0x4234d4,_0x8359c4)=>{var _0x15465e=_0x1a0253;_0x15fa26[_0x8359c4][_0x15465e(0xd1)]=_0x4234d4;}),_0x367fc2['forEach']((_0x592719,_0x37d6fe)=>{var _0x56ce6c=_0x1a0253;_0x15fa26[_0x37d6fe][_0x56ce6c(0x1a4)]=_0x592719;}),_0x3d467f[_0x1a0253(0xd2)]((_0x30c9f5,_0x21551c)=>{var _0x4217dd=_0x1a0253;_0x15fa26[_0x21551c][_0x4217dd(0x152)]=_0x30c9f5;}),_0x3fb56f['forEach']((_0x3cbc3b,_0xc3eed0)=>{var _0x5be6ad=_0x1a0253;_0x15fa26[_0xc3eed0][_0x5be6ad(0x103)]=_0x3cbc3b;}),_0x5ac299[_0x1a0253(0xd2)]((_0x1f22c6,_0xbde1bf)=>{_0x15fa26[_0xbde1bf]['return_qty']=_0x1f22c6;}),_0x218179[_0x1a0253(0xd2)]((_0x2a204f,_0x129949)=>{var _0x4d6192=_0x1a0253;_0x15fa26[_0x129949][_0x4d6192(0x1a1)]=_0x2a204f;}),_0x821c82[_0x1a0253(0xd2)]((_0x5738e8,_0x3b11c1)=>{_0x15fa26[_0x3b11c1]['bin']=_0x5738e8;}),_0x5cc6bd[_0x1a0253(0xd2)]((_0x236452,_0x1ac6cc)=>{var _0x5054c1=_0x1a0253;_0x15fa26[_0x1ac6cc][_0x5054c1(0x146)]=_0x236452;}),_0x362ab1[_0x1a0253(0xd2)]((_0x5c7e7a,_0x422211)=>{var _0x24d5b9=_0x1a0253;_0x15fa26[_0x422211][_0x24d5b9(0x195)]=_0x5c7e7a;});var _0x3f4d44=0x0;_0x15fa26['forEach'](_0x3c6e24=>{var _0x257171=_0x1a0253;console[_0x257171(0x170)]('foreach\x20newproduct',_0x3c6e24),(parseInt(_0x3c6e24[_0x257171(0x152)])<parseInt(_0x3c6e24['return_qty'])||parseInt(_0x3c6e24['stock'])<parseInt(_0x3c6e24[_0x257171(0x11d)])&&parseInt(_0x3c6e24[_0x257171(0x152)])>parseInt(_0x3c6e24['return_qty'])||parseInt(_0x3c6e24[_0x257171(0x11d)])==0x0)&&_0x3f4d44++;});if(_0x3f4d44!=0x0)return _0x3f7f52['flash'](_0x1a0253(0x100),_0x1a0253(0x12f)),_0x340417[_0x1a0253(0x1ce)](_0x1a0253(0x16e));const _0xbdab46=await sales['findOne']({'invoice':_0x58da06});console[_0x1a0253(0x170)](_0xbdab46),_0xbdab46[_0x1a0253(0xdf)]='True';const _0x25c7d2=await _0xbdab46['save'](),_0x210d3b=new sales_return({'invoice':_0x58da06,'customer':_0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x181)],'date':_0x4df3d0,'warehouse_name':_0x30947d,'room':_0x3e7308,'ToWarehouse':_0x1c8d8f,'ToRoom':_0x55d9e6,'return_sale':_0x15fa26,'note':_0x553968}),_0x541383=await _0x210d3b[_0x1a0253(0xcc)]();console[_0x1a0253(0x170)](_0x210d3b);const _0x32040a=await sales_return[_0x1a0253(0x1af)]({'invoice':_0x58da06}),_0x411645=await warehouse[_0x1a0253(0x1af)]({'name':_0x1c8d8f,'room':_0x55d9e6});_0x32040a[_0x1a0253(0x14f)][_0x1a0253(0xd2)](_0x3dad1f=>{var _0x2d15aa=_0x1a0253,_0x1031db=0x0;const _0x27f3a9=_0x411645[_0x2d15aa(0x180)][_0x2d15aa(0x1a5)](_0x3f7ab1=>{var _0x2b4d51=_0x2d15aa;_0x3f7ab1[_0x2b4d51(0xdd)]==_0x3dad1f[_0x2b4d51(0xdd)]&&_0x3f7ab1[_0x2b4d51(0x195)]==_0x3dad1f[_0x2b4d51(0x195)]&&_0x3f7ab1[_0x2b4d51(0x146)]==_0x3dad1f[_0x2b4d51(0x146)]&&_0x3f7ab1[_0x2b4d51(0x177)]==_0x3dad1f['bin']&&_0x3f7ab1[_0x2b4d51(0x1a1)]==_0x3dad1f[_0x2b4d51(0x1a1)]&&(_0x3f7ab1[_0x2b4d51(0x138)]=parseInt(_0x3f7ab1[_0x2b4d51(0x138)])+parseInt(_0x3dad1f[_0x2b4d51(0x11d)]),_0x1031db++);});_0x1031db=='0'&&(_0x411645['product_details']=_0x411645[_0x2d15aa(0x180)]['concat']({'product_name':_0x3dad1f[_0x2d15aa(0xdd)],'product_stock':_0x3dad1f[_0x2d15aa(0x11d)],'primary_code':_0x3dad1f['primary_code'],'secondary_code':_0x3dad1f['secondary_code'],'product_code':_0x3dad1f[_0x2d15aa(0x1a4)],'bay':_0x3dad1f[_0x2d15aa(0x1a1)],'bin':_0x3dad1f[_0x2d15aa(0x177)],'type':_0x3dad1f[_0x2d15aa(0x146)],'floorlevel':_0x3dad1f['floorlevel']})),console[_0x2d15aa(0x170)](_0x2d15aa(0xe3),_0x411645);}),await _0x411645[_0x1a0253(0xcc)](),console['log'](_0x3f7f52['body']);const _0xebb7b5=new c_payment_data({'invoice':_0x58da06,'customer':_0x3f7f52[_0x1a0253(0x134)]['customer'],'reason':'Sale\x20Return'});await _0xebb7b5['save']();const _0x5333b8=await master_shop[_0x1a0253(0x159)]();console[_0x1a0253(0x170)](_0x1a0253(0x186),_0x5333b8[0x0]['image']);const _0x111273=await email_settings[_0x1a0253(0x1af)](),_0x1200e5=await customer[_0x1a0253(0x1af)]({'name':_0x3f7f52[_0x1a0253(0x134)][_0x1a0253(0x181)]});console[_0x1a0253(0x170)]('customer_data',_0x1200e5);_0x5333b8[0x0]['currency_placement']==0x1?(right_currency=_0x5333b8[0x0][_0x1a0253(0x1a8)],left_currency=''):(right_currency='',left_currency=_0x5333b8[0x0][_0x1a0253(0x1a8)]);var _0x2aa780=_0x34b872,_0x235cd4=_0x5ac299,_0x543f86='',_0x459dd1;for(_0x459dd1 in _0x2aa780){_0x543f86+=_0x1a0253(0x15d)+_0x1a0253(0x157)+_0x2aa780[_0x459dd1]+'</td>'+_0x1a0253(0x157)+_0x235cd4[_0x459dd1]+'</td>'+_0x1a0253(0xd7);}console['log'](_0x1a0253(0x16b),_0x543f86);let _0xf2d98e=nodemailer[_0x1a0253(0x17d)]({'service':_0x1a0253(0x18e),'auth':{'user':_0x111273[_0x1a0253(0xf9)],'pass':_0x111273[_0x1a0253(0xd3)]}}),_0x3fb315={'from':_0x111273[_0x1a0253(0xf9)],'to':_0x1200e5[_0x1a0253(0xf9)],'subject':_0x1a0253(0x197),'attachments':[{'filename':_0x1a0253(0x1ab),'path':__dirname+_0x1a0253(0x11c)+_0x1a0253(0x114)+_0x5333b8[0x0][_0x1a0253(0x178)],'cid':'logo'}],'html':_0x1a0253(0xf0)+_0x1a0253(0xca)+_0x1a0253(0x16f)+_0x1a0253(0xef)+_0x1a0253(0x15c)+_0x1a0253(0xef)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x1a0253(0xef)+_0x1a0253(0x185)+_0x5333b8[0x0][_0x1a0253(0x12e)]+_0x1a0253(0x188)+'</div>'+'</div>'+_0x1a0253(0x1b0)+'<div>'+_0x1a0253(0x123)+_0x1a0253(0x160)+_0x58da06+'\x20'+_0x1a0253(0x10f)+_0x1a0253(0x1bb)+_0x4df3d0+'\x20'+'</span>'+_0x1a0253(0x10b)+'</div>'+_0x1a0253(0x119)+_0x1a0253(0x193)+_0x1a0253(0x15d)+_0x1a0253(0x167)+_0x1a0253(0x1b6)+_0x1a0253(0x172)+_0x1a0253(0x144)+_0x1a0253(0xd7)+_0x1a0253(0x127)+_0x1a0253(0x1b2)+'\x20'+_0x543f86+'\x20'+_0x1a0253(0x174)+_0x1a0253(0x135)+'<div>'+_0x1a0253(0x175)+_0x1a0253(0xc9)+_0x5333b8[0x0][_0x1a0253(0x12e)]+'</h5>'+'</div>'+_0x1a0253(0xe4)+_0x1a0253(0x122)};_0xf2d98e[_0x1a0253(0x187)](_0x3fb315,function(_0x2da9fc,_0x2976b1){var _0x1f9afe=_0x1a0253;_0x2da9fc?(console['log'](_0x2da9fc),console[_0x1f9afe(0x170)](_0x1f9afe(0x158))):console[_0x1f9afe(0x170)](_0x1f9afe(0x194));}),_0x3f7f52[_0x1a0253(0x12c)]('success',_0x1a0253(0xfb)),_0x340417[_0x1a0253(0x1ce)](_0x1a0253(0x18c));}catch(_0x949c99){console[_0x1a0253(0x170)](_0x949c99),_0x340417['status'](0xc8)[_0x1a0253(0x1bd)]({'message1':_0x949c99[_0x1a0253(0x1a3)]});}}),router[a0_0x59460e(0xf1)](a0_0x59460e(0x192),auth,async(_0x1531fc,_0x15ef58)=>{var _0x7a1c33=a0_0x59460e;try{const {username:_0x32efdc,email:_0x223c05,role:_0x20a69e}=_0x1531fc['user'],_0xa787ab=_0x1531fc['user'],_0x5c67ad=await profile['findOne']({'email':_0xa787ab[_0x7a1c33(0xf9)]}),_0x267c27=await master_shop[_0x7a1c33(0x159)]();console[_0x7a1c33(0x170)](_0x7a1c33(0x13d),_0x267c27);const _0x514272=_0x1531fc[_0x7a1c33(0x1c9)]['id'],_0x13ae3f=await sales[_0x7a1c33(0x14c)](_0x514272);console[_0x7a1c33(0x170)](_0x7a1c33(0x1c3),_0x13ae3f);if(_0x267c27[0x0][_0x7a1c33(0x1c6)]==_0x7a1c33(0x121))var _0x284c7a=users[_0x7a1c33(0x1be)];else{if(_0x267c27[0x0]['language']==_0x7a1c33(0xd4))var _0x284c7a=users[_0x7a1c33(0xd4)];else{if(_0x267c27[0x0][_0x7a1c33(0x1c6)]=='German')var _0x284c7a=users[_0x7a1c33(0x169)];else{if(_0x267c27[0x0][_0x7a1c33(0x1c6)]==_0x7a1c33(0x173))var _0x284c7a=users['Spanish'];else{if(_0x267c27[0x0]['language']==_0x7a1c33(0x171))var _0x284c7a=users[_0x7a1c33(0x171)];else{if(_0x267c27[0x0][_0x7a1c33(0x1c6)]==_0x7a1c33(0xe7))var _0x284c7a=users[_0x7a1c33(0x117)];else{if(_0x267c27[0x0][_0x7a1c33(0x1c6)]==_0x7a1c33(0x15f))var _0x284c7a=users[_0x7a1c33(0x15f)];else{if(_0x267c27[0x0]['language']=='Arabic\x20(ae)')var _0x284c7a=users['Arabic'];}}}}}}}_0x15ef58[_0x7a1c33(0x1c2)]('all_sales_barcode',{'success':_0x1531fc['flash']('success'),'errors':_0x1531fc['flash'](_0x7a1c33(0x100)),'role':_0xa787ab,'profile':_0x5c67ad,'alldata':_0x13ae3f,'master_shop':_0x267c27,'language':_0x284c7a});}catch(_0x24b9f0){console[_0x7a1c33(0x170)](_0x24b9f0);}}),router[a0_0x59460e(0x154)](a0_0x59460e(0x14e),async(_0x761dd,_0x42d9ad)=>{var _0x5cd90=a0_0x59460e;const {product_code:_0x13ebbd,warehouse_name:_0x4a3f75,rooms_data:_0x3a8993,Roomslist:_0x533d7a}=_0x761dd['body'],_0x4e1a00=_0x533d7a[_0x5cd90(0x1ac)](','),_0x3ef003=[];async function _0x33df37(_0x5d5b5a){var _0x1a3023=_0x5cd90;const _0x37e00a=await warehouse[_0x1a3023(0x1a0)]([{'$match':{'name':_0x4a3f75,'room':_0x5d5b5a}},{'$unwind':_0x1a3023(0x1a2)},{'$match':{'product_details.primary_code':_0x13ebbd}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1a3023(0x199)},'primary_code':{'$first':_0x1a3023(0xdc)},'secondary_code':{'$first':_0x1a3023(0x128)},'product_code':{'$first':_0x1a3023(0x165)},'level':{'$first':_0x1a3023(0x1ca)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x1a3023(0xf3)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1a3023(0x15b)},'secondary_unit':{'$first':_0x1a3023(0x111)},'storage':{'$first':_0x1a3023(0xde)},'rack':{'$first':_0x1a3023(0xcb)},'expiry_date':{'$first':_0x1a3023(0x12a)},'production_date':{'$first':_0x1a3023(0x1b3)},'maxPerUnit':{'$first':_0x1a3023(0xd5)},'batch_code':{'$first':_0x1a3023(0x1c5)},'product_cat':{'$first':_0x1a3023(0x1b5)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1a3023(0x1cc)},'actual_qty':{'$first':'$product_details.actual_qty'}}}]),_0x37d3ef=await warehouse[_0x1a3023(0x1a0)]([{'$match':{'name':_0x4a3f75,'room':_0x5d5b5a}},{'$unwind':_0x1a3023(0x1a2)},{'$match':{'product_details.secondary_code':_0x13ebbd}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1a3023(0x153)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1a3023(0xdc)},'secondary_code':{'$first':_0x1a3023(0x128)},'product_code':{'$first':_0x1a3023(0x165)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x1a3023(0xf3)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1a3023(0x111)},'storage':{'$first':_0x1a3023(0xde)},'rack':{'$first':_0x1a3023(0xcb)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x1a3023(0xd5)},'batch_code':{'$first':_0x1a3023(0x1c5)},'product_cat':{'$first':_0x1a3023(0x1b5)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1a3023(0x1cc)}}}]);if(_0x37e00a[_0x1a3023(0xd9)]>0x0)_0x3ef003[_0x1a3023(0x19b)](_0x37e00a);else _0x37d3ef[_0x1a3023(0xd9)]>0x0&&_0x3ef003[_0x1a3023(0x19b)](_0x37d3ef);}const _0x263423=_0x4e1a00[_0x5cd90(0x1a5)](_0x2a950e=>_0x33df37(_0x2a950e));await Promise['all'](_0x263423),_0x42d9ad[_0x5cd90(0x1bd)](_0x3ef003);}),module[a0_0x59460e(0xe9)]=router;