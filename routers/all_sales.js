var a0_0x95b963=a0_0x509e;function a0_0x1345(){var _0x1f533c=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$date','Error\x20Occurs','stock_data','<strong>\x20Regards\x20</strong>','$product_details.secondary_code','stocks','createTransport','product_stock','add_sales','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','nodemailer','master','<span\x20style=\x22float:\x20right;\x22>','/barcode/:id','unit','post','English','max','Enclosed','$isAllowEdit','$product_details.batch_code','logo','$product_details.bay','$product_details.primary_code','Sales\x20Update\x20successfully','Logo.png','Receiving\x20Area','type','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','An\x20error\x20occurred\x20while\x20saving\x20data.','barcode\x20Product\x20master','$product_details.product_stock','/view/add_sales','</tr>','604632LWfRPP','primary_unit','catch','storage','</tbody>','product_list','site_title','$product.product_name','quantity','<tr>','prod_code','production_date','findById','$product_details.pallet','_id','<tbody\x20style=\x22text-align:\x20center;\x22>','sale_product','$product_details.rack','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','batch_code','Floor','Ambient','render','warehouse','<h5>','../public/language/languages.json','status','password','Sales\x20Add\x20successfully','isAllowEdit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','39001370mKOrCq','<h2>\x20','body','secondary_code','save','Shelves','expiry_date','$product_details.level','An\x20error\x20occurred.','aggregate','bin','$note','user_id','invoice','return_sale','German','<hr\x20class=\x22my-3\x22>','14266080cVkczf','SCRN','prod_cat','</head><body>','getDate','/upload/','prod_invoice','carton','</thead>','3133252krxQSs','$product_details._id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Received\x20Payment\x20For\x20Sale','</div>','all','find','$_id','date','Spanish','quantity_notConverted','sales_invoice','/view/return_sales/:id','then','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','id_transaction_from','$product_details.maxPerUnit','English\x20(US)','$sale_product.quantity','port','$product_details.invoice','barcode\x20user_id','/view/:id','customers_docs','currency','primary_code','room','215750kVlYqE','forEach','</h5>','id_transact','$product_details.product_code','floorlevel','<div>','/all_sales/view','577017GBeWsb','payment\x20successfull','\x20</h2>','length','product_details','Arabic','French','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','6SKfuwE','final','rack','/view','customers','Sales\x20Mail','5KMvfil','finalize','message','OUT-','Chinese','$room','$sale_product.bay','$product_details.secondary_unit','room_name','secondary_unit','<!DOCTYPE\x20html>','</body></html>','bay','floor','random','$product_details.expiry_date','padStart','email','sendMail','level','Router','image','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','gmail','RoomAssigned','delivery_code','product_name','role','$product_details.floorlevel','redirect','push','staff','False','$product_details.actual_qty','$return_data','Portuguese\x20(BR)','customer','$customers_docs','sale_qty','$sale_product.type','errors','$invoice','max_per_unit','<h5\x20style=\x22text-align:\x20left;\x22>','$name','$customer','findOne','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','success','warehouse_name','sales_quantity','Arabic\x20(ae)','log','../models/all_models','params','getFullYear','abs','$product_details.bin','slice','host','product_data','getMonth','concat','flash','$product_details.product_name','Enabled','express','$product_details.storage','/all_sales/preview/','return_data','requested_qty','$warehouse_name','$product_details.type','</span>','8292753RJsbHV','add\x20post','stock','Raw\x20Materials','user','product_code','language','error','Return\x20Rooms','Return\x20Goods','/view/add_sales/:id','$product','../middleware/auth','$product_details.product_cat','maxperunit','/view/add_sale/product','exports','get','$product_details.actual_uom','$product_details','delivery_date','\x20Order\x20Date\x20:\x20','/preview/:id','True','Portuguese','$finalize','return_qty','back','$sale_product.floorlevel','types','json','$product_details.production_date','14vfGwdf','Hindi','string','sales\x20all_data','actual_qty','/give_payment/:id','/../public','all_sales_barcode','$product_details.unit','edit_sales','/invoice/:id','actual_uom','$sale_product'];a0_0x1345=function(){return _0x1f533c;};return a0_0x1345();}(function(_0x5f16d7,_0x44de36){var _0x60a39f=a0_0x509e,_0x3c2b52=_0x5f16d7();while(!![]){try{var _0x5921cf=-parseInt(_0x60a39f(0x228))/0x1+-parseInt(_0x60a39f(0x1a2))/0x2*(-parseInt(_0x60a39f(0x230))/0x3)+parseInt(_0x60a39f(0x20c))/0x4*(parseInt(_0x60a39f(0x136))/0x5)+-parseInt(_0x60a39f(0x130))/0x6*(-parseInt(_0x60a39f(0x182))/0x7)+parseInt(_0x60a39f(0x1d3))/0x8+parseInt(_0x60a39f(0x203))/0x9+-parseInt(_0x60a39f(0x1f2))/0xa;if(_0x5921cf===_0x44de36)break;else _0x3c2b52['push'](_0x3c2b52['shift']());}catch(_0x4cee56){_0x3c2b52['push'](_0x3c2b52['shift']());}}}(a0_0x1345,0xd1c29));const express=require(a0_0x95b963(0x17a)),app=express(),router=express[a0_0x95b963(0x14a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x95b963(0x16d)),auth=require(a0_0x95b963(0x18e)),nodemailer=require(a0_0x95b963(0x1bb)),users=require(a0_0x95b963(0x1ec));router[a0_0x95b963(0x193)](a0_0x95b963(0x133),auth,async(_0x2e271a,_0x3328cc)=>{var _0x4b1688=a0_0x95b963;try{const {username:_0x3f5f54,email:_0x359208,role:_0xdbad00}=_0x2e271a[_0x4b1688(0x186)],_0x5002b4=_0x2e271a[_0x4b1688(0x186)],_0x2376be=await profile[_0x4b1688(0x165)]({'email':_0x5002b4[_0x4b1688(0x147)]}),_0x33a1d2=await master_shop[_0x4b1688(0x212)]();let _0x2a635d;if(_0x5002b4[_0x4b1688(0x152)]==_0x4b1688(0x156)){const _0x1a100e=await staff['findOne']({'email':_0x5002b4[_0x4b1688(0x147)]});_0x2a635d=await sales[_0x4b1688(0x1fb)]([{'$lookup':{'from':_0x4b1688(0x134),'localField':_0x4b1688(0x15b),'foreignField':'name','as':_0x4b1688(0x224)}},{'$unwind':_0x4b1688(0x15c)},{'$unwind':_0x4b1688(0x1ae)},{'$group':{'_id':_0x4b1688(0x213),'invoice':{'$first':_0x4b1688(0x160)},'customers':{'$first':_0x4b1688(0x164)},'date':{'$first':_0x4b1688(0x1b1)},'warehouse_name':{'$first':_0x4b1688(0x17f)},'sale_product':{'$push':_0x4b1688(0x1ae)},'note':{'$first':_0x4b1688(0x1fd)},'return_data':{'$first':_0x4b1688(0x159)},'customers_docs':{'$first':_0x4b1688(0x15c)},'total_saleproduct_quantity':{'$sum':_0x4b1688(0x21f)},'level':{'$addToSet':_0x4b1688(0x13c)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x4b1688(0x15e)},'pallet':{'$addToSet':_0x4b1688(0x19e)},'finalize':{'$first':_0x4b1688(0x19b)},'isAllowEdit':{'$first':_0x4b1688(0x1c4)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x2a635d=await sales[_0x4b1688(0x1fb)]([{'$lookup':{'from':_0x4b1688(0x134),'localField':_0x4b1688(0x15b),'foreignField':'name','as':_0x4b1688(0x224)}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':_0x4b1688(0x213),'invoice':{'$first':_0x4b1688(0x160)},'customers':{'$first':_0x4b1688(0x164)},'date':{'$first':_0x4b1688(0x1b1)},'warehouse_name':{'$first':_0x4b1688(0x17f)},'sale_product':{'$push':_0x4b1688(0x1ae)},'note':{'$first':_0x4b1688(0x1fd)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x4b1688(0x15c)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x4b1688(0x13c)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x4b1688(0x15e)},'pallet':{'$addToSet':_0x4b1688(0x19e)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x4b1688(0x1c4)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x4b1688(0x1a5),_0x2a635d);if(_0x33a1d2[0x0]['language']=='English\x20(US)'){var _0x1faac1=users[_0x4b1688(0x1c1)];console['log'](_0x1faac1);}else{if(_0x33a1d2[0x0]['language']==_0x4b1688(0x1a3))var _0x1faac1=users[_0x4b1688(0x1a3)];else{if(_0x33a1d2[0x0][_0x4b1688(0x188)]==_0x4b1688(0x201))var _0x1faac1=users[_0x4b1688(0x201)];else{if(_0x33a1d2[0x0]['language']==_0x4b1688(0x215))var _0x1faac1=users[_0x4b1688(0x215)];else{if(_0x33a1d2[0x0][_0x4b1688(0x188)]==_0x4b1688(0x236))var _0x1faac1=users[_0x4b1688(0x236)];else{if(_0x33a1d2[0x0]['language']==_0x4b1688(0x15a))var _0x1faac1=users[_0x4b1688(0x19a)];else{if(_0x33a1d2[0x0][_0x4b1688(0x188)]==_0x4b1688(0x13a))var _0x1faac1=users[_0x4b1688(0x13a)];else{if(_0x33a1d2[0x0][_0x4b1688(0x188)]=='Arabic\x20(ae)')var _0x1faac1=users[_0x4b1688(0x235)];}}}}}}}_0x3328cc[_0x4b1688(0x1e9)]('all_sales',{'success':_0x2e271a[_0x4b1688(0x177)]('success'),'errors':_0x2e271a['flash'](_0x4b1688(0x15f)),'sales':_0x2a635d,'profile':_0x2376be,'role':_0x5002b4,'master_shop':_0x33a1d2,'language':_0x1faac1});}catch(_0x557a84){console['log'](_0x557a84);}});function a0_0x509e(_0x4457de,_0x48e13f){var _0x13454c=a0_0x1345();return a0_0x509e=function(_0x509e4a,_0x429bfe){_0x509e4a=_0x509e4a-0x130;var _0x39f701=_0x13454c[_0x509e4a];return _0x39f701;},a0_0x509e(_0x4457de,_0x48e13f);}async function getRandom8DigitNumber(){var _0x1588c0=a0_0x95b963;const _0x31da1c=0x989680,_0x2beeae=0x5f5e0ff,_0x4789c9=Math[_0x1588c0(0x143)](Math[_0x1588c0(0x144)]()*(_0x2beeae-_0x31da1c+0x1))+_0x31da1c;var _0xa8c4f1;const _0x20a3c4=await sales['findOne']({'invoice':_0x1588c0(0x139)+_0x4789c9});return _0x20a3c4&&_0x20a3c4[_0x1588c0(0x233)]>0x0?_0xa8c4f1='OUT-'+_0x4789c9:_0xa8c4f1=_0x1588c0(0x139)+_0x4789c9,_0xa8c4f1;}router[a0_0x95b963(0x193)]('/view/add_sales',auth,async(_0x432e50,_0x231db5)=>{var _0x96ef4e=a0_0x95b963;try{const {username:_0x9409f3,email:_0x39c232,role:_0x1b5df6}=_0x432e50[_0x96ef4e(0x186)],_0x2ab4bf=_0x432e50[_0x96ef4e(0x186)],_0x524fe2=await profile[_0x96ef4e(0x165)]({'email':_0x2ab4bf['email']}),_0x4ab033=await master_shop[_0x96ef4e(0x212)](),_0x173a5c=await customer['find']({});let _0x3f0690;if(_0x2ab4bf[_0x96ef4e(0x152)]==_0x96ef4e(0x156)){const _0x366fca=await staff[_0x96ef4e(0x165)]({'email':_0x2ab4bf[_0x96ef4e(0x147)]});_0x3f0690=await warehouse[_0x96ef4e(0x1fb)]([{'$match':{'status':_0x96ef4e(0x179),'name':_0x366fca[_0x96ef4e(0x1ea)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x96ef4e(0x18b)}}},{'$group':{'_id':_0x96ef4e(0x163),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x3f0690=await warehouse[_0x96ef4e(0x1fb)]([{'$match':{'status':'Enabled','warehouse_category':_0x96ef4e(0x185),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x96ef4e(0x163),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x556e53=await product[_0x96ef4e(0x212)]({});var _0x494e71=[_0x96ef4e(0x1e8),_0x96ef4e(0x1c3)];const _0x360fbd=await sales[_0x96ef4e(0x212)]({}),_0x2d9f7c=_0x360fbd[_0x96ef4e(0x233)]+0x1,_0x593264=_0x96ef4e(0x139)+_0x2d9f7c['toString']()[_0x96ef4e(0x146)](0x5,'0');if(_0x4ab033[0x0]['language']=='English\x20(US)'){var _0x5cfcb7=users[_0x96ef4e(0x1c1)];console[_0x96ef4e(0x16c)](_0x5cfcb7);}else{if(_0x4ab033[0x0]['language']==_0x96ef4e(0x1a3))var _0x5cfcb7=users[_0x96ef4e(0x1a3)];else{if(_0x4ab033[0x0]['language']==_0x96ef4e(0x201))var _0x5cfcb7=users[_0x96ef4e(0x201)];else{if(_0x4ab033[0x0]['language']==_0x96ef4e(0x215))var _0x5cfcb7=users[_0x96ef4e(0x215)];else{if(_0x4ab033[0x0]['language']=='French')var _0x5cfcb7=users[_0x96ef4e(0x236)];else{if(_0x4ab033[0x0][_0x96ef4e(0x188)]=='Portuguese\x20(BR)')var _0x5cfcb7=users[_0x96ef4e(0x19a)];else{if(_0x4ab033[0x0][_0x96ef4e(0x188)]==_0x96ef4e(0x13a))var _0x5cfcb7=users['Chinese'];else{if(_0x4ab033[0x0][_0x96ef4e(0x188)]==_0x96ef4e(0x16b))var _0x5cfcb7=users[_0x96ef4e(0x235)];}}}}}}}const _0x1e5bdc=getRandom8DigitNumber();_0x1e5bdc['then'](_0x46fbf1=>{var _0x1c1855=_0x96ef4e;_0x231db5['render'](_0x1c1855(0x1b9),{'success':_0x432e50[_0x1c1855(0x177)](_0x1c1855(0x168)),'errors':_0x432e50[_0x1c1855(0x177)](_0x1c1855(0x15f)),'role':_0x2ab4bf,'profile':_0x524fe2,'customer':_0x173a5c,'warehouse':_0x3f0690,'product':_0x556e53,'invoice':_0x46fbf1,'master_shop':_0x4ab033,'language':_0x5cfcb7,'rooms_data':_0x494e71});})[_0x96ef4e(0x1d5)](_0x2c70cf=>{var _0x5e2660=_0x96ef4e;_0x432e50[_0x5e2660(0x177)](_0x5e2660(0x15f),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x231db5[_0x5e2660(0x154)]('/all_sales/view');});}catch(_0x162759){console['log'](_0x162759);}}),router[a0_0x95b963(0x193)](a0_0x95b963(0x18c),auth,async(_0x3c6f29,_0xcd5e7a)=>{var _0x10aea5=a0_0x95b963;try{const _0x3f790c=_0x3c6f29[_0x10aea5(0x16e)]['id'];console['log'](_0x3f790c);const _0x4a9423=await product[_0x10aea5(0x212)](),_0x5a7f54=await purchases[_0x10aea5(0x1fb)]([{'$match':{'warehouse_name':_0x3f790c}},{'$unwind':_0x10aea5(0x18d)},{'$group':{'_id':_0x10aea5(0x1da)}}]);console[_0x10aea5(0x16c)]('purchases_data',_0x5a7f54),_0xcd5e7a[_0x10aea5(0x1ed)](0xc8)[_0x10aea5(0x1a0)]({'purchases_data':_0x5a7f54,'product_data':_0x4a9423});}catch(_0x3cc87a){console['log'](_0x3cc87a);}}),router[a0_0x95b963(0x1c0)](a0_0x95b963(0x191),auth,async(_0x5a5dd3,_0x3435ec)=>{var _0x560432=a0_0x95b963;try{const {warehouse_data:_0x460761,product_data:_0x5a5789}=_0x5a5dd3['body'];console[_0x560432(0x16c)](_0x5a5dd3[_0x560432(0x1f4)][_0x560432(0x174)]);;const _0x359fee=await master_shop[_0x560432(0x212)]();console[_0x560432(0x16c)]('master',_0x359fee);const _0x2b8efa=await product[_0x560432(0x165)]({'name':_0x5a5789});console[_0x560432(0x16c)]('product',_0x2b8efa);const _0x2cf001=await warehouse['aggregate']([{'$match':{'name':_0x460761}},{'$unwind':_0x560432(0x195)},{'$match':{'product_details.product_name':_0x5a5789}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x560432(0x1d0)}}}]);console[_0x560432(0x16c)]('stock_data',_0x2cf001),_0x3435ec[_0x560432(0x1ed)](0xc8)['json']({'master':_0x359fee,'new_product':_0x2b8efa,'stock_data':_0x2cf001});}catch(_0x26cce8){console['log'](_0x26cce8);}}),router[a0_0x95b963(0x1c0)](a0_0x95b963(0x1d1),auth,async(_0x2a9400,_0x37707e)=>{var _0x77af9=a0_0x95b963;try{const {invoice:_0x304be2,date:_0x222247,warehouse_name:_0x5d4440,product_name:_0x5486c5,stock:_0x1d0cf8,quantity:_0x58a38b,note:_0x379a6a,room:_0x5c32dc,primary_code:_0x9d50b,secondary_code:_0x225292,prod_code:_0x46993f,level:_0x5de3ac,isle:_0x26ccfa,pallet:_0x9fd342,batch_code:_0x45f716,SCRN:_0x316031,expiry_date:_0x4bc1e7}=_0x2a9400['body'];if(typeof _0x5486c5=='string')var _0x5eab57=[_0x2a9400['body'][_0x77af9(0x151)]],_0x174816=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x184)]],_0x4c730b=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x20a)]],_0x5f2bf3=[_0x2a9400['body'][_0x77af9(0x226)]],_0x37755d=[_0x2a9400['body'][_0x77af9(0x1f5)]],_0x13792c=[_0x2a9400[_0x77af9(0x1f4)]['prod_code']],_0x5c91f8=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x149)]],_0x5a1288=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1d4)]],_0x4062c8=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x13f)]],_0x3eb773=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1e6)]],_0x3f0e72=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1f8)]],_0x2f65eb=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x161)]],_0x30d3fd=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1de)]],_0x1f17c5=[_0x2a9400[_0x77af9(0x1f4)]['requested_qty']],_0x27491=[_0x2a9400['body'][_0x77af9(0x196)]],_0x15e908=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x150)]],_0x54c8f8=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x205)]],_0x415415=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1db)]],_0x167a5a=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x14f)]],_0x31b7fd=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x209)]],_0x3c7f41=[_0x2a9400['body'][_0x77af9(0x1a6)]],_0x177f13=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1ad)]],_0x1047a2=[_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x22b)]];else var _0x5eab57=[..._0x2a9400['body'][_0x77af9(0x151)]],_0x174816=[..._0x2a9400['body'][_0x77af9(0x184)]],_0x4c730b=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x20a)]],_0x5f2bf3=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x226)]],_0x37755d=[..._0x2a9400[_0x77af9(0x1f4)]['secondary_code']],_0x13792c=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1dd)]],_0x5c91f8=[..._0x2a9400['body']['level']],_0x5a1288=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1d4)]],_0x4062c8=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x13f)]],_0x3eb773=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1e6)]],_0x3f0e72=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1f8)]],_0x2f65eb=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x161)]],_0x30d3fd=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1de)]],_0x1f17c5=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x17e)]],_0x27491=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x196)]],_0x15e908=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x150)]],_0x54c8f8=[..._0x2a9400[_0x77af9(0x1f4)]['prod_cat']],_0x415415=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1db)]],_0x167a5a=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x14f)]],_0x31b7fd=[..._0x2a9400['body'][_0x77af9(0x209)]],_0x3c7f41=[..._0x2a9400['body']['actual_qty']],_0x177f13=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x1ad)]],_0x1047a2=[..._0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x22b)]];const _0x4b68e7=_0x5eab57[_0x77af9(0x166)](_0x2d10d6=>{return _0x2d10d6={'product_name':_0x2d10d6};});_0x174816[_0x77af9(0x229)]((_0x5369ed,_0x14c7d4)=>{var _0x39ac87=_0x77af9;_0x4b68e7[_0x14c7d4][_0x39ac87(0x184)]=Math[_0x39ac87(0x170)](_0x5369ed);}),_0x3c7f41[_0x77af9(0x229)]((_0x196d8d,_0x352cdb)=>{var _0x47d54d=_0x77af9;_0x4b68e7[_0x352cdb][_0x47d54d(0x1a6)]=Math[_0x47d54d(0x170)](_0x196d8d);}),_0x177f13['forEach']((_0x2cffee,_0x19fedc)=>{var _0xa752a0=_0x77af9;_0x4b68e7[_0x19fedc][_0xa752a0(0x1ad)]=_0x2cffee;}),_0x1047a2[_0x77af9(0x229)]((_0x14217d,_0x24e066)=>{_0x4b68e7[_0x24e066]['id_transaction_from']=_0x14217d;}),_0x4c730b[_0x77af9(0x229)]((_0x504a9d,_0x157d80)=>{var _0x2ca951=_0x77af9;_0x4b68e7[_0x157d80][_0x2ca951(0x1db)]=_0x504a9d;}),_0x5f2bf3['forEach']((_0x368487,_0x5b2f7e)=>{var _0x1ea3cb=_0x77af9;_0x4b68e7[_0x5b2f7e][_0x1ea3cb(0x226)]=_0x368487;}),_0x37755d['forEach']((_0x4adf81,_0x26051f)=>{var _0x247b55=_0x77af9;_0x4b68e7[_0x26051f][_0x247b55(0x1f5)]=_0x4adf81;}),_0x13792c[_0x77af9(0x229)]((_0x8d660a,_0x4a8895)=>{var _0x4c51a1=_0x77af9;_0x4b68e7[_0x4a8895][_0x4c51a1(0x187)]=_0x8d660a;}),_0x5c91f8[_0x77af9(0x229)]((_0x2cc5ec,_0xae5298)=>{_0x167a5a['forEach']((_0x26b2c2,_0x118908)=>{var _0x4f0e96=a0_0x509e;if(_0x26b2c2==_0x4f0e96(0x1cb)&&_0xae5298==_0x118908){var _0x2c51c7=_0x2cc5ec['slice'](0x3);_0x4b68e7[_0xae5298][_0x4f0e96(0x1d6)]=_0x2cc5ec[0x0],_0x4b68e7[_0xae5298][_0x4f0e96(0x132)]=_0x2cc5ec[0x1],_0x4b68e7[_0xae5298][_0x4f0e96(0x142)]=0x0,_0x4b68e7[_0xae5298][_0x4f0e96(0x1fc)]=0x0,_0x4b68e7[_0xae5298]['type']='Floor',_0x4b68e7[_0xae5298][_0x4f0e96(0x22d)]=_0x2c51c7;}else{if(_0x26b2c2==_0x4f0e96(0x1f7)&&_0xae5298==_0x118908){var _0x2c51c7=_0x2cc5ec['slice'](0x3);_0x4b68e7[_0xae5298]['storage']=_0x2cc5ec[0x0],_0x4b68e7[_0xae5298][_0x4f0e96(0x132)]=_0x2cc5ec[0x1],_0x4b68e7[_0xae5298][_0x4f0e96(0x142)]=0x0,_0x4b68e7[_0xae5298][_0x4f0e96(0x1fc)]=0x0,_0x4b68e7[_0xae5298][_0x4f0e96(0x1cc)]='Floor',_0x4b68e7[_0xae5298]['floorlevel']=_0x2cc5ec[0x5];}else{if(_0xae5298==_0x118908){var _0x17e905;if(_0x2cc5ec[0x4]=='L')_0x17e905='Level';else _0x2cc5ec[0x4]=='F'&&(_0x17e905=_0x4f0e96(0x1e7));_0x4b68e7[_0xae5298][_0x4f0e96(0x1d6)]=_0x2cc5ec[0x0],_0x4b68e7[_0xae5298][_0x4f0e96(0x132)]=_0x2cc5ec[0x1],_0x4b68e7[_0xae5298]['bay']=_0x2cc5ec[0x2],_0x4b68e7[_0xae5298][_0x4f0e96(0x1fc)]=_0x2cc5ec[0x3],_0x4b68e7[_0xae5298]['type']=_0x17e905,_0x4b68e7[_0xae5298][_0x4f0e96(0x22d)]=_0x2cc5ec[0x5];}}}});}),_0x5a1288['forEach']((_0x278838,_0x17a0bf)=>{var _0x5d255f=_0x77af9;_0x4b68e7[_0x17a0bf][_0x5d255f(0x1bf)]=_0x278838;}),_0x4062c8['forEach']((_0x2351df,_0x16928a)=>{var _0x3c2b08=_0x77af9;_0x4b68e7[_0x16928a][_0x3c2b08(0x13f)]=_0x2351df;}),_0x3eb773['forEach']((_0x30deac,_0xfa0d4f)=>{_0x4b68e7[_0xfa0d4f]['batch_code']=_0x30deac;}),_0x3f0e72[_0x77af9(0x229)]((_0x4473fe,_0x551e53)=>{var _0x2d7eb4=_0x77af9;_0x4b68e7[_0x551e53][_0x2d7eb4(0x1f8)]=_0x4473fe;}),_0x2f65eb[_0x77af9(0x229)]((_0x234ca4,_0x5bc1d4)=>{var _0x13fa0f=_0x77af9;_0x4b68e7[_0x5bc1d4][_0x13fa0f(0x190)]=_0x234ca4;}),_0x30d3fd['forEach']((_0x482e8e,_0x30fd5d)=>{var _0x539c30=_0x77af9;_0x4b68e7[_0x30fd5d][_0x539c30(0x1de)]=_0x482e8e;}),_0x1f17c5[_0x77af9(0x229)]((_0x18625d,_0x361a31)=>{_0x4b68e7[_0x361a31]['requested_qty']=_0x18625d;}),_0x27491[_0x77af9(0x229)]((_0x13e661,_0x1dd354)=>{var _0x2f351c=_0x77af9;_0x4b68e7[_0x1dd354][_0x2f351c(0x196)]=_0x13e661;}),_0x15e908[_0x77af9(0x229)]((_0x375452,_0xaba5c1)=>{var _0x2857f1=_0x77af9;_0x4b68e7[_0xaba5c1][_0x2857f1(0x150)]=_0x375452;}),_0x54c8f8[_0x77af9(0x229)]((_0x445f79,_0x2ed98e)=>{var _0x721248=_0x77af9;_0x4b68e7[_0x2ed98e][_0x721248(0x205)]=_0x445f79;}),_0x415415[_0x77af9(0x229)]((_0x187de3,_0x3e5bb2)=>{var _0xcf40ae=_0x77af9;_0x4b68e7[_0x3e5bb2][_0xcf40ae(0x216)]=_0x187de3;}),_0x167a5a[_0x77af9(0x229)]((_0x68a878,_0x57646f)=>{_0x4b68e7[_0x57646f]['room_name']=_0x68a878;}),_0x31b7fd['forEach']((_0x593072,_0x1357a0)=>{_0x4b68e7[_0x1357a0]['invoice']=_0x593072;});var _0x36159a=0x0;_0x4b68e7[_0x77af9(0x229)](_0x4ab0f1=>{var _0x29814d=_0x77af9;(_0x4ab0f1[_0x29814d(0x184)]<_0x4ab0f1[_0x29814d(0x216)]||_0x4ab0f1['quantity_notConverted']==0x0)&&(console['log']('foreach\x20newproduct',_0x4ab0f1),_0x36159a++);});const _0x41cf6e=_0x4b68e7[_0x77af9(0x21a)](_0x4932f9=>_0x4932f9[_0x77af9(0x1db)]!=='0'&&_0x4932f9[_0x77af9(0x1db)]!==''),_0x42d2c2=new sales({'invoice':_0x304be2,'customer':_0x2a9400[_0x77af9(0x1f4)][_0x77af9(0x15b)],'date':_0x222247,'warehouse_name':_0x5d4440,'sale_product':_0x41cf6e,'note':_0x379a6a,'room':_0x5c32dc,'primary_code':_0x9d50b,'secondary_code':_0x225292,'prod_code':_0x46993f,'SCRN':_0x316031}),_0x3370be=await _0x42d2c2[_0x77af9(0x1f6)]();_0x2a9400['flash'](_0x77af9(0x168),_0x77af9(0x1ef)),_0x37707e[_0x77af9(0x154)](_0x77af9(0x17c)+_0x3370be[_0x77af9(0x1e1)]);}catch(_0x206d3b){console[_0x77af9(0x16c)](_0x206d3b);}}),router[a0_0x95b963(0x193)](a0_0x95b963(0x198),auth,async(_0x524b45,_0x3077c2)=>{var _0x26074b=a0_0x95b963;try{const {username:_0x45cb6f,email:_0x5eff42,role:_0x2e111a}=_0x524b45[_0x26074b(0x186)],_0x7b24cb=_0x524b45[_0x26074b(0x186)],_0x13d0bd=await profile[_0x26074b(0x165)]({'email':_0x7b24cb[_0x26074b(0x147)]}),_0x4f1812=await master_shop[_0x26074b(0x212)](),_0xc167ed=_0x524b45[_0x26074b(0x16e)]['id'],_0x3e9091=await sales[_0x26074b(0x1df)](_0xc167ed),_0x474f3b=await warehouse[_0x26074b(0x1fb)]([{'$match':{'name':_0x3e9091[_0x26074b(0x169)]}},{'$unwind':_0x26074b(0x195)},{'$group':{'_id':_0x26074b(0x20d),'name':{'$first':_0x26074b(0x178)},'product_stock':{'$first':_0x26074b(0x1d0)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x26074b(0x171)},'type':{'$first':_0x26074b(0x180)},'floorlevel':{'$first':_0x26074b(0x153)},'primary_code':{'$first':_0x26074b(0x1c8)},'secondary_code':{'$first':_0x26074b(0x1b5)},'product_code':{'$first':_0x26074b(0x22c)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x26074b(0x1e4)},'expiry_date':{'$first':_0x26074b(0x145)},'production_date':{'$first':_0x26074b(0x1a1)},'invoice':{'$first':_0x26074b(0x221)}}}]),_0x235717=await customer[_0x26074b(0x212)]({});let _0x2e576b;if(_0x7b24cb[_0x26074b(0x152)]==_0x26074b(0x156)){const _0x182b97=await staff[_0x26074b(0x165)]({'email':_0x7b24cb['email']});_0x2e576b=await warehouse[_0x26074b(0x1fb)]([{'$match':{'status':_0x26074b(0x179),'name':_0x182b97['warehouse']}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x2e576b=await warehouse[_0x26074b(0x1fb)]([{'$match':{'status':_0x26074b(0x179)}},{'$group':{'_id':_0x26074b(0x163),'name':{'$first':_0x26074b(0x163)}}}]);const _0x580249=await product[_0x26074b(0x212)]({}),_0x27ca5d=await suppliers['find']({});if(_0x4f1812[0x0][_0x26074b(0x188)]==_0x26074b(0x21e)){var _0x400ae4=users[_0x26074b(0x1c1)];console[_0x26074b(0x16c)](_0x400ae4);}else{if(_0x4f1812[0x0][_0x26074b(0x188)]==_0x26074b(0x1a3))var _0x400ae4=users['Hindi'];else{if(_0x4f1812[0x0][_0x26074b(0x188)]=='German')var _0x400ae4=users[_0x26074b(0x201)];else{if(_0x4f1812[0x0][_0x26074b(0x188)]==_0x26074b(0x215))var _0x400ae4=users[_0x26074b(0x215)];else{if(_0x4f1812[0x0][_0x26074b(0x188)]==_0x26074b(0x236))var _0x400ae4=users['French'];else{if(_0x4f1812[0x0][_0x26074b(0x188)]==_0x26074b(0x15a))var _0x400ae4=users[_0x26074b(0x19a)];else{if(_0x4f1812[0x0][_0x26074b(0x188)]==_0x26074b(0x13a))var _0x400ae4=users[_0x26074b(0x13a)];else{if(_0x4f1812[0x0]['language']==_0x26074b(0x16b))var _0x400ae4=users[_0x26074b(0x235)];}}}}}}}_0x3077c2[_0x26074b(0x1e9)]('edit_sales_view',{'success':_0x524b45[_0x26074b(0x177)](_0x26074b(0x168)),'errors':_0x524b45[_0x26074b(0x177)](_0x26074b(0x15f)),'role':_0x7b24cb,'profile':_0x13d0bd,'customer':_0x235717,'warehouse':_0x2e576b,'product':_0x474f3b,'user':_0x3e9091,'master_shop':_0x4f1812,'unit':_0x580249,'language':_0x400ae4,'suppliers':_0x27ca5d});}catch(_0x798ced){console['log'](_0x798ced);}}),router[a0_0x95b963(0x1c0)](a0_0x95b963(0x198),auth,async(_0x39ff42,_0x3aea7c)=>{var _0x1f10a1=a0_0x95b963;try{const _0x4659c2=_0x39ff42[_0x1f10a1(0x16e)]['id'],{invoice:_0x9f8cc6,warehouse_name:_0x185196,room:_0xd8e4b}=_0x39ff42[_0x1f10a1(0x1f4)],_0x302012=await sales[_0x1f10a1(0x165)]({'invoice':_0x9f8cc6}),_0x4d9bfc=_0x302012[_0x1f10a1(0x1e3)][_0x1f10a1(0x166)](async _0x1b93e4=>{var _0x275a54=_0x1f10a1,_0x421e7e=await warehouse[_0x275a54(0x165)]({'name':_0x185196,'room':_0x1b93e4[_0x275a54(0x13e)],'warehouse_category':_0x275a54(0x185)});const _0x21b3ed=_0x421e7e['product_details'][_0x275a54(0x166)](_0x177062=>{var _0x35f86d=_0x275a54;_0x177062[_0x35f86d(0x151)]==_0x1b93e4[_0x35f86d(0x151)]&&_0x177062[_0x35f86d(0x22d)]==_0x1b93e4[_0x35f86d(0x22d)]&&_0x177062[_0x35f86d(0x1cc)]==_0x1b93e4[_0x35f86d(0x1cc)]&&_0x177062[_0x35f86d(0x1fc)]==_0x1b93e4[_0x35f86d(0x1fc)]&&_0x177062[_0x35f86d(0x142)]==_0x1b93e4['bay']&&_0x177062[_0x35f86d(0x132)]==_0x1b93e4[_0x35f86d(0x132)]&&_0x177062[_0x35f86d(0x1d6)]==_0x1b93e4[_0x35f86d(0x1d6)]&&_0x177062['expiry_date']==_0x1b93e4['expiry_date']&&_0x177062[_0x35f86d(0x1e6)]==_0x1b93e4[_0x35f86d(0x1e6)]&&_0x177062[_0x35f86d(0x1ff)]==_0x1b93e4[_0x35f86d(0x1ff)]&&_0x177062['_id']==_0x1b93e4[_0x35f86d(0x21c)]&&(_0x177062[_0x35f86d(0x1b8)]=Math[_0x35f86d(0x1c2)](0x0,Math['abs'](_0x177062[_0x35f86d(0x1b8)])-Math['abs'](_0x1b93e4[_0x35f86d(0x1db)])));});return _0x421e7e;});Promise[_0x1f10a1(0x211)](_0x4d9bfc)[_0x1f10a1(0x219)](async _0x33ae33=>{var _0x1eddb6=_0x1f10a1;try{for(const _0x5021ed of _0x33ae33){await _0x5021ed[_0x1eddb6(0x1f6)]();}_0x302012[_0x1eddb6(0x137)]=_0x1eddb6(0x199);const _0x4841a8=await _0x302012[_0x1eddb6(0x1f6)](),_0x1fc416=await master_shop[_0x1eddb6(0x212)](),_0x33f4f7=await email_settings[_0x1eddb6(0x165)](),_0x23a818=await supervisor_settings['find']();var _0x1363fb=_0x302012['sale_product'],_0x418615='',_0x1c9fe6;for(_0x1c9fe6 in _0x1363fb){_0x418615+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1363fb[_0x1c9fe6][_0x1eddb6(0x151)]+_0x1eddb6(0x14c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1363fb[_0x1c9fe6][_0x1eddb6(0x187)]+_0x1eddb6(0x14c)+_0x1eddb6(0x1e5)+_0x1363fb[_0x1c9fe6][_0x1eddb6(0x1db)]+_0x1eddb6(0x14c)+_0x1eddb6(0x1e5)+_0x1363fb[_0x1c9fe6][_0x1eddb6(0x1bf)]+_0x1eddb6(0x14c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1363fb[_0x1c9fe6]['secondary_unit']+_0x1eddb6(0x14c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x302012[_0x1eddb6(0x169)]+_0x1eddb6(0x14c)+_0x1eddb6(0x1e5)+_0x1363fb[_0x1c9fe6][_0x1eddb6(0x13e)]+_0x1eddb6(0x14c)+_0x1eddb6(0x1e5)+_0x1363fb[_0x1c9fe6]['storage']+_0x1363fb[_0x1c9fe6]['rack']+_0x1363fb[_0x1c9fe6][_0x1eddb6(0x142)]+_0x1363fb[_0x1c9fe6]['bin']+_0x1363fb[_0x1c9fe6][_0x1eddb6(0x1cc)][0x0]+_0x1363fb[_0x1c9fe6]['floorlevel']+_0x1eddb6(0x14c),_0x1eddb6(0x1d2);}let _0x4357a5=nodemailer[_0x1eddb6(0x1b7)]({'host':_0x33f4f7[_0x1eddb6(0x173)],'port':Number(_0x33f4f7[_0x1eddb6(0x220)]),'secure':![],'auth':{'user':_0x33f4f7[_0x1eddb6(0x147)],'pass':_0x33f4f7[_0x1eddb6(0x1ee)]}}),_0x24f5ca={'from':_0x33f4f7['email'],'to':_0x23a818[0x0]['RMSEmail'],'subject':_0x1eddb6(0x135),'attachments':[{'filename':_0x1eddb6(0x1ca),'path':__dirname+_0x1eddb6(0x1a8)+_0x1eddb6(0x208)+_0x1fc416[0x0][_0x1eddb6(0x14b)],'cid':_0x1eddb6(0x1c6)}],'html':_0x1eddb6(0x140)+'<html><head><title></title>'+_0x1eddb6(0x206)+'<div>'+_0x1eddb6(0x20e)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1eddb6(0x210)+_0x1eddb6(0x22e)+_0x1eddb6(0x1f3)+_0x1fc416[0x0][_0x1eddb6(0x1d9)]+_0x1eddb6(0x232)+_0x1eddb6(0x210)+'</div>'+_0x1eddb6(0x202)+_0x1eddb6(0x22e)+_0x1eddb6(0x162)+'\x20Order\x20Number\x20:\x20'+_0x302012[_0x1eddb6(0x1ff)]+'\x20'+_0x1eddb6(0x1bd)+'\x20Order\x20Date\x20:\x20'+_0x302012[_0x1eddb6(0x214)]+'\x20'+_0x1eddb6(0x181)+_0x1eddb6(0x22a)+_0x1eddb6(0x210)+_0x1eddb6(0x1f1)+_0x1eddb6(0x1cd)+_0x1eddb6(0x1dc)+_0x1eddb6(0x14d)+_0x1eddb6(0x1af)+_0x1eddb6(0x1b0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x1eddb6(0x167)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x1eddb6(0x1d2)+_0x1eddb6(0x20b)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x418615+'\x20'+_0x1eddb6(0x1d7)+'</table>'+_0x1eddb6(0x22e)+_0x1eddb6(0x1b4)+_0x1eddb6(0x1eb)+_0x1fc416[0x0][_0x1eddb6(0x1d9)]+'</h5>'+_0x1eddb6(0x210)+'</div>'+_0x1eddb6(0x141)};_0x4357a5[_0x1eddb6(0x148)](_0x24f5ca,function(_0x3acc7a,_0x3e8e86){var _0x576c9e=_0x1eddb6;_0x3acc7a?(console[_0x576c9e(0x16c)](_0x3acc7a),console['log'](_0x576c9e(0x1b2))):console[_0x576c9e(0x16c)]('Email\x20sent\x20successfully');}),_0x39ff42[_0x1eddb6(0x177)](_0x1eddb6(0x168),'Sales\x20Update\x20successfully'),_0x3aea7c[_0x1eddb6(0x154)](_0x1eddb6(0x17c)+_0x4659c2);}catch(_0x535dcc){console[_0x1eddb6(0x189)](_0x535dcc),_0x3aea7c['status'](0x1f4)['json']({'error':_0x1eddb6(0x1ce)});}})['catch'](_0x3c7a46=>{var _0x1ffdfc=_0x1f10a1;console['error'](_0x3c7a46),_0x3aea7c[_0x1ffdfc(0x1ed)](0x1f4)[_0x1ffdfc(0x1a0)]({'error':_0x1ffdfc(0x1fa)});});}catch(_0x20754d){console[_0x1f10a1(0x16c)](_0x20754d);}}),router[a0_0x95b963(0x193)]('/view/:id',auth,async(_0x24ca7b,_0x4d14c5)=>{var _0x569ee1=a0_0x95b963;try{const {username:_0x26cf62,email:_0x16fff1,role:_0x518495}=_0x24ca7b['user'],_0x227e67=_0x24ca7b[_0x569ee1(0x186)],_0x34a5e4=await profile['findOne']({'email':_0x227e67[_0x569ee1(0x147)]}),_0x4b076e=await master_shop[_0x569ee1(0x212)](),_0x446e46=_0x24ca7b[_0x569ee1(0x16e)]['id'],_0x1384ba=await sales['findById'](_0x446e46);var _0x998e80=['Ambient',_0x569ee1(0x1c3)];const _0x3a84d3=await warehouse[_0x569ee1(0x1fb)]([{'$match':{'name':_0x1384ba[_0x569ee1(0x169)],'warehouse_category':_0x569ee1(0x185)}},{'$unwind':_0x569ee1(0x195)},{'$group':{'_id':_0x569ee1(0x20d),'name':{'$first':_0x569ee1(0x178)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x569ee1(0x1c7)},'bin':{'$first':_0x569ee1(0x171)},'type':{'$first':_0x569ee1(0x180)},'floorlevel':{'$first':_0x569ee1(0x153)},'primary_code':{'$first':_0x569ee1(0x1c8)},'secondary_code':{'$first':_0x569ee1(0x1b5)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x569ee1(0x17b)},'rack':{'$first':_0x569ee1(0x1e4)}}}]),_0x140873=await customer[_0x569ee1(0x212)]({});let _0x2ed6a5;if(_0x227e67[_0x569ee1(0x152)]==_0x569ee1(0x156)){const _0x1825e6=await staff[_0x569ee1(0x165)]({'email':_0x227e67[_0x569ee1(0x147)]});_0x2ed6a5=await warehouse[_0x569ee1(0x1fb)]([{'$match':{'status':'Enabled','name':_0x1825e6['warehouse'],'warehouse_category':_0x569ee1(0x185)}},{'$group':{'_id':_0x569ee1(0x163),'name':{'$first':'$name'}}}]);}else _0x2ed6a5=await warehouse[_0x569ee1(0x1fb)]([{'$match':{'status':_0x569ee1(0x179),'warehouse_category':_0x569ee1(0x185)}},{'$group':{'_id':_0x569ee1(0x163),'name':{'$first':_0x569ee1(0x163)}}}]);const _0x37c474=await product[_0x569ee1(0x212)]({});if(_0x4b076e[0x0][_0x569ee1(0x188)]==_0x569ee1(0x21e)){var _0x400972=users['English'];console[_0x569ee1(0x16c)](_0x400972);}else{if(_0x4b076e[0x0][_0x569ee1(0x188)]==_0x569ee1(0x1a3))var _0x400972=users[_0x569ee1(0x1a3)];else{if(_0x4b076e[0x0][_0x569ee1(0x188)]==_0x569ee1(0x201))var _0x400972=users[_0x569ee1(0x201)];else{if(_0x4b076e[0x0]['language']=='Spanish')var _0x400972=users[_0x569ee1(0x215)];else{if(_0x4b076e[0x0]['language']==_0x569ee1(0x236))var _0x400972=users[_0x569ee1(0x236)];else{if(_0x4b076e[0x0][_0x569ee1(0x188)]==_0x569ee1(0x15a))var _0x400972=users[_0x569ee1(0x19a)];else{if(_0x4b076e[0x0]['language']==_0x569ee1(0x13a))var _0x400972=users['Chinese'];else{if(_0x4b076e[0x0]['language']==_0x569ee1(0x16b))var _0x400972=users[_0x569ee1(0x235)];}}}}}}}_0x4d14c5['render'](_0x569ee1(0x1ab),{'success':_0x24ca7b['flash'](_0x569ee1(0x168)),'errors':_0x24ca7b[_0x569ee1(0x177)](_0x569ee1(0x15f)),'role':_0x227e67,'profile':_0x34a5e4,'customer':_0x140873,'warehouse':_0x2ed6a5,'product':_0x3a84d3,'user':_0x1384ba,'master_shop':_0x4b076e,'unit':_0x37c474,'language':_0x400972});}catch(_0xd2de2c){console[_0x569ee1(0x16c)](_0xd2de2c);}}),router[a0_0x95b963(0x1c0)](a0_0x95b963(0x223),auth,async(_0x13eb72,_0x570c17)=>{var _0x4e206d=a0_0x95b963;try{const _0xb8e1b9=_0x13eb72[_0x4e206d(0x16e)]['id'],_0x3dcb24=await sales[_0x4e206d(0x165)]({'_id':_0x13eb72[_0x4e206d(0x16e)]['id']}),_0x5e7b9a=await warehouse[_0x4e206d(0x165)]({'name':_0x3dcb24[_0x4e206d(0x169)],'room':_0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x227)]}),{invoice:_0x2645a1,date:_0x4f6e16,warehouse_name:_0x2fce94,product_name:_0x4d853e,stock:_0x134565,quantity:_0x335195,note:_0x143a63,room:_0xe3c87b,customer:_0x3ccd28,SCRN:_0x8549a5}=_0x13eb72[_0x4e206d(0x1f4)];if(typeof _0x4d853e==_0x4e206d(0x1a4))var _0x1a0d24=[_0x13eb72[_0x4e206d(0x1f4)]['product_name']],_0x44d4ff=[_0x13eb72['body'][_0x4e206d(0x184)]],_0x1ba2d8=[_0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x20a)]],_0x70156b=[_0x13eb72[_0x4e206d(0x1f4)]['primary_code']],_0x36cbb9=[_0x13eb72['body'][_0x4e206d(0x1f5)]],_0xbfc2b=[_0x13eb72[_0x4e206d(0x1f4)]['prod_code']],_0x5a44ca=[_0x13eb72[_0x4e206d(0x1f4)]['level']],_0x181dfd=[_0x13eb72[_0x4e206d(0x1f4)]['primary_unit']],_0x3cba4b=[_0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x13f)]],_0xb4ef94=[_0x13eb72[_0x4e206d(0x1f4)]['batch_code']],_0x3c21f1=[_0x13eb72[_0x4e206d(0x1f4)]['expiry_date']],_0x39907e=[_0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x161)]],_0x5547d2=[_0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x1de)]],_0x38c114=[_0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x17e)]],_0x4e7ac6=[_0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x196)]],_0x19ced9=[_0x13eb72[_0x4e206d(0x1f4)]['delivery_code']],_0x1a5f77=[_0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x205)]],_0x285daa=[_0x13eb72['body']['quantity']],_0x1b74be=[_0x13eb72[_0x4e206d(0x1f4)]['RoomAssigned']];else var _0x1a0d24=[..._0x13eb72['body'][_0x4e206d(0x151)]],_0x44d4ff=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x184)]],_0x1ba2d8=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x20a)]],_0x70156b=[..._0x13eb72['body'][_0x4e206d(0x226)]],_0x36cbb9=[..._0x13eb72['body'][_0x4e206d(0x1f5)]],_0xbfc2b=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x1dd)]],_0x5a44ca=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x149)]],_0x181dfd=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x1d4)]],_0x3cba4b=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x13f)]],_0xb4ef94=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x1e6)]],_0x3c21f1=[..._0x13eb72['body'][_0x4e206d(0x1f8)]],_0x39907e=[..._0x13eb72['body'][_0x4e206d(0x161)]],_0x5547d2=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x1de)]],_0x38c114=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x17e)]],_0x4e7ac6=[..._0x13eb72['body'][_0x4e206d(0x196)]],_0x19ced9=[..._0x13eb72['body'][_0x4e206d(0x150)]],_0x1a5f77=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x205)]],_0x285daa=[..._0x13eb72['body'][_0x4e206d(0x1db)]],_0x1b74be=[..._0x13eb72[_0x4e206d(0x1f4)][_0x4e206d(0x14f)]];const _0x402bb5=_0x1a0d24['map'](_0x44fcdf=>{return _0x44fcdf={'product_name':_0x44fcdf};});_0x44d4ff[_0x4e206d(0x229)]((_0x586b0e,_0x5c2025)=>{var _0x4c5b66=_0x4e206d;_0x402bb5[_0x5c2025][_0x4c5b66(0x184)]=Math[_0x4c5b66(0x170)](_0x586b0e);}),_0x1ba2d8[_0x4e206d(0x229)]((_0x1ab2c3,_0x4b7d4c)=>{var _0x19fbde=_0x4e206d;_0x402bb5[_0x4b7d4c][_0x19fbde(0x1db)]=_0x1ab2c3;}),_0x70156b[_0x4e206d(0x229)]((_0x478377,_0x4e9d6b)=>{var _0x18d6d7=_0x4e206d;_0x402bb5[_0x4e9d6b][_0x18d6d7(0x226)]=_0x478377;}),_0x36cbb9[_0x4e206d(0x229)]((_0x46681b,_0x355816)=>{var _0x19c70c=_0x4e206d;_0x402bb5[_0x355816][_0x19c70c(0x1f5)]=_0x46681b;}),_0xbfc2b[_0x4e206d(0x229)]((_0x4b8cf8,_0x2c200a)=>{_0x402bb5[_0x2c200a]['product_code']=_0x4b8cf8;}),_0x5a44ca[_0x4e206d(0x229)]((_0x5eef25,_0x13ef32)=>{var _0x31204f=_0x4e206d;_0x1b74be[_0x31204f(0x229)]((_0x2acd97,_0x2c0b2e)=>{var _0x25055f=_0x31204f;if(_0x2acd97==_0x25055f(0x1cb)&&_0x13ef32==_0x2c0b2e){var _0x345806=_0x5eef25[_0x25055f(0x172)](0x3);_0x402bb5[_0x13ef32][_0x25055f(0x1d6)]=_0x5eef25[0x0],_0x402bb5[_0x13ef32][_0x25055f(0x132)]=_0x5eef25[0x1],_0x402bb5[_0x13ef32][_0x25055f(0x142)]=0x0,_0x402bb5[_0x13ef32][_0x25055f(0x1fc)]=0x0,_0x402bb5[_0x13ef32][_0x25055f(0x1cc)]=_0x25055f(0x1e7),_0x402bb5[_0x13ef32][_0x25055f(0x22d)]=_0x345806;}else{if(_0x2acd97==_0x25055f(0x1f7)&&_0x13ef32==_0x2c0b2e){var _0x345806=_0x5eef25[_0x25055f(0x172)](0x3);_0x402bb5[_0x13ef32][_0x25055f(0x1d6)]=_0x5eef25[0x0],_0x402bb5[_0x13ef32][_0x25055f(0x132)]=_0x5eef25[0x1],_0x402bb5[_0x13ef32][_0x25055f(0x142)]=0x0,_0x402bb5[_0x13ef32]['bin']=0x0,_0x402bb5[_0x13ef32]['type']='Floor',_0x402bb5[_0x13ef32]['floorlevel']=_0x5eef25[0x5];}else{if(_0x13ef32==_0x2c0b2e){var _0x181f8c;if(_0x5eef25[0x4]=='L')_0x181f8c='Level';else _0x5eef25[0x4]=='F'&&(_0x181f8c=_0x25055f(0x1e7));_0x402bb5[_0x13ef32][_0x25055f(0x1d6)]=_0x5eef25[0x0],_0x402bb5[_0x13ef32][_0x25055f(0x132)]=_0x5eef25[0x1],_0x402bb5[_0x13ef32][_0x25055f(0x142)]=_0x5eef25[0x2],_0x402bb5[_0x13ef32][_0x25055f(0x1fc)]=_0x5eef25[0x3],_0x402bb5[_0x13ef32][_0x25055f(0x1cc)]=_0x181f8c,_0x402bb5[_0x13ef32][_0x25055f(0x22d)]=_0x5eef25[0x5];}}}});}),_0x181dfd[_0x4e206d(0x229)]((_0x1ddb9a,_0x1f4fce)=>{var _0x98697b=_0x4e206d;_0x402bb5[_0x1f4fce][_0x98697b(0x1bf)]=_0x1ddb9a;}),_0x3cba4b[_0x4e206d(0x229)]((_0x4697b6,_0x328c53)=>{var _0x18ffa1=_0x4e206d;_0x402bb5[_0x328c53][_0x18ffa1(0x13f)]=_0x4697b6;}),_0xb4ef94[_0x4e206d(0x229)]((_0x50904b,_0xf80bb8)=>{var _0x18258f=_0x4e206d;_0x402bb5[_0xf80bb8][_0x18258f(0x1e6)]=_0x50904b;}),_0x3c21f1['forEach']((_0x18d29b,_0x43fd8f)=>{var _0x505834=_0x4e206d;_0x402bb5[_0x43fd8f][_0x505834(0x1f8)]=_0x18d29b;}),_0x39907e[_0x4e206d(0x229)]((_0x4828d5,_0x69d189)=>{var _0x168925=_0x4e206d;_0x402bb5[_0x69d189][_0x168925(0x190)]=_0x4828d5;}),_0x5547d2[_0x4e206d(0x229)]((_0x1246c7,_0x3c3c66)=>{var _0x2ad6ca=_0x4e206d;_0x402bb5[_0x3c3c66][_0x2ad6ca(0x1de)]=_0x1246c7;}),_0x38c114[_0x4e206d(0x229)]((_0x5b75e1,_0x47161f)=>{var _0x4e5d6a=_0x4e206d;_0x402bb5[_0x47161f][_0x4e5d6a(0x17e)]=Math[_0x4e5d6a(0x170)](_0x5b75e1);}),_0x4e7ac6['forEach']((_0x15bd88,_0x4a6eb)=>{var _0x1a7420=_0x4e206d;_0x402bb5[_0x4a6eb][_0x1a7420(0x196)]=_0x15bd88;}),_0x19ced9[_0x4e206d(0x229)]((_0x564044,_0x5740ba)=>{_0x402bb5[_0x5740ba]['delivery_code']=_0x564044;}),_0x1a5f77['forEach']((_0x75b36f,_0x1e2589)=>{var _0x1875e4=_0x4e206d;_0x402bb5[_0x1e2589][_0x1875e4(0x205)]=_0x75b36f;}),_0x285daa[_0x4e206d(0x229)]((_0x241006,_0x3e73a5)=>{var _0x2a39b2=_0x4e206d;_0x402bb5[_0x3e73a5][_0x2a39b2(0x216)]=_0x241006;}),_0x1b74be[_0x4e206d(0x229)]((_0x18bfae,_0x3468ff)=>{var _0x3d8564=_0x4e206d;_0x402bb5[_0x3468ff][_0x3d8564(0x13e)]=_0x18bfae;});var _0x257c9a=0x0;_0x402bb5[_0x4e206d(0x229)](_0x155439=>{var _0x282b8e=_0x4e206d;console[_0x282b8e(0x16c)]('foreach\x20newproduct',_0x155439),(parseInt(_0x155439[_0x282b8e(0x184)])<parseInt(_0x155439[_0x282b8e(0x1db)])||parseInt(_0x155439['quantity'])==0x0)&&_0x257c9a++;});if(_0x257c9a!=0x0)return _0x13eb72['flash'](_0x4e206d(0x15f),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x570c17[_0x4e206d(0x154)](_0x4e206d(0x19d));const _0x333001=_0x402bb5[_0x4e206d(0x21a)](_0x3a0cbf=>_0x3a0cbf[_0x4e206d(0x1db)]!=='0'&&_0x3a0cbf[_0x4e206d(0x1db)]!=='');_0x3dcb24[_0x4e206d(0x1ff)]=_0x2645a1,_0x3dcb24['customer']=_0x3ccd28,_0x3dcb24[_0x4e206d(0x214)]=_0x4f6e16,_0x3dcb24[_0x4e206d(0x169)]=_0x2fce94,_0x3dcb24[_0x4e206d(0x1e3)]=_0x333001,_0x3dcb24['note']=_0x143a63,_0x3dcb24[_0x4e206d(0x204)]=_0x8549a5,_0x3dcb24[_0x4e206d(0x137)]=_0x4e206d(0x157),_0x3dcb24[_0x4e206d(0x1f0)]='False';const _0x567fbf=await _0x3dcb24['save']();_0x13eb72[_0x4e206d(0x177)]('success',_0x4e206d(0x1c9)),_0x570c17[_0x4e206d(0x154)](_0x4e206d(0x22f));}catch(_0x3f650){console['log'](_0x3f650);}}),router[a0_0x95b963(0x1c0)](a0_0x95b963(0x1a7),auth,async(_0x3784c9,_0x3f7f96)=>{var _0x2507bc=a0_0x95b963;try{const _0xa64ca7=_0x3784c9[_0x2507bc(0x16e)]['id'],{invoice:_0x522b62,customer:_0x27ae8e,receivable_amount:_0x390f56,received_amount:_0x58d40e}=_0x3784c9['body'],_0x292bac=await sales[_0x2507bc(0x1df)](_0xa64ca7);console[_0x2507bc(0x16c)](_0x292bac);var _0x1308bc=_0x390f56-_0x58d40e;console[_0x2507bc(0x16c)](_0x58d40e),_0x292bac['received_amount']=parseFloat(_0x58d40e)+parseFloat(_0x292bac['received_amount']),_0x292bac['due_amount']=_0x1308bc,console[_0x2507bc(0x16c)](_0x292bac);const _0x3c148a=await _0x292bac[_0x2507bc(0x1f6)](),_0x5c56dc=await c_payment_data['findOne']({'invoice':_0x522b62});_0x5c56dc['amount']=_0x1308bc,await _0x5c56dc[_0x2507bc(0x1f6)]();let _0x4ebfd5=new Date(),_0x893886=('0'+_0x4ebfd5[_0x2507bc(0x207)]())['slice'](-0x2),_0x3981af=('0'+(_0x4ebfd5[_0x2507bc(0x175)]()+0x1))[_0x2507bc(0x172)](-0x2),_0x4d7b7a=_0x4ebfd5[_0x2507bc(0x16f)](),_0x602658=_0x4d7b7a+'-'+_0x3981af+'-'+_0x893886;const _0x3a583d=new customer_payment({'invoice':_0x522b62,'date':_0x4d7b7a+'-'+_0x3981af+'-'+_0x893886,'customer':_0x27ae8e,'reason':_0x2507bc(0x20f),'amount':_0x58d40e}),_0x4bd185=await _0x3a583d[_0x2507bc(0x1f6)]();_0x3784c9[_0x2507bc(0x177)](_0x2507bc(0x168),_0x2507bc(0x231)),_0x3f7f96[_0x2507bc(0x154)](_0x2507bc(0x22f));}catch(_0x222270){console['log'](_0x222270);}}),router[a0_0x95b963(0x193)](a0_0x95b963(0x1ac),auth,async(_0xda797b,_0x3cd54d)=>{var _0x350c0b=a0_0x95b963;try{const {username:_0x334299,email:_0x4aab59,role:_0x3d1c28}=_0xda797b['user'],_0x2d545f=_0xda797b[_0x350c0b(0x186)],_0x1a4983=await profile[_0x350c0b(0x165)]({'email':_0x2d545f[_0x350c0b(0x147)]}),_0x13cbb6=await master_shop[_0x350c0b(0x212)]();console['log'](_0x350c0b(0x1bc),_0x13cbb6);const _0x334195=_0xda797b[_0x350c0b(0x16e)]['id'],_0x39a149=await sales[_0x350c0b(0x1df)](_0x334195);console[_0x350c0b(0x16c)](_0x39a149);const _0x3aa6f3=await customer[_0x350c0b(0x165)]({'name':_0x39a149[_0x350c0b(0x15b)]});console['log'](_0x3aa6f3);if(_0x13cbb6[0x0]['language']==_0x350c0b(0x21e)){var _0xe21119=users[_0x350c0b(0x1c1)];console[_0x350c0b(0x16c)](_0xe21119);}else{if(_0x13cbb6[0x0]['language']==_0x350c0b(0x1a3))var _0xe21119=users[_0x350c0b(0x1a3)];else{if(_0x13cbb6[0x0][_0x350c0b(0x188)]==_0x350c0b(0x201))var _0xe21119=users[_0x350c0b(0x201)];else{if(_0x13cbb6[0x0][_0x350c0b(0x188)]==_0x350c0b(0x215))var _0xe21119=users['Spanish'];else{if(_0x13cbb6[0x0][_0x350c0b(0x188)]==_0x350c0b(0x236))var _0xe21119=users[_0x350c0b(0x236)];else{if(_0x13cbb6[0x0][_0x350c0b(0x188)]==_0x350c0b(0x15a))var _0xe21119=users[_0x350c0b(0x19a)];else{if(_0x13cbb6[0x0][_0x350c0b(0x188)]=='Chinese')var _0xe21119=users[_0x350c0b(0x13a)];else{if(_0x13cbb6[0x0][_0x350c0b(0x188)]==_0x350c0b(0x16b))var _0xe21119=users['Arabic'];}}}}}}}_0x3cd54d[_0x350c0b(0x1e9)](_0x350c0b(0x217),{'success':_0xda797b[_0x350c0b(0x177)](_0x350c0b(0x168)),'errors':_0xda797b['flash']('errors'),'role':_0x2d545f,'profile':_0x1a4983,'master_shop':_0x13cbb6,'customers':_0x3aa6f3,'sales':_0x39a149,'language':_0xe21119});}catch(_0x49d846){console[_0x350c0b(0x16c)](_0x49d846);}}),router[a0_0x95b963(0x193)](a0_0x95b963(0x218),auth,async(_0x8cb70f,_0x38b272)=>{var _0x14fe6b=a0_0x95b963;try{const {username:_0x18424d,email:_0x1120df,role:_0x541841}=_0x8cb70f[_0x14fe6b(0x186)],_0x4c44a8=_0x8cb70f[_0x14fe6b(0x186)],_0x3eac32=await profile[_0x14fe6b(0x165)]({'email':_0x4c44a8[_0x14fe6b(0x147)]}),_0x59ea44=await master_shop[_0x14fe6b(0x212)]();console[_0x14fe6b(0x16c)]('master',_0x59ea44);const _0x487109=_0x8cb70f[_0x14fe6b(0x16e)]['id'];console['log'](_0x487109);const _0x5ca3a6=await sales[_0x14fe6b(0x1df)](_0x487109);console[_0x14fe6b(0x16c)](_0x14fe6b(0x1fe),_0x5ca3a6);const _0x2acf51=await warehouse[_0x14fe6b(0x1fb)]([{'$match':{'name':'Return\x20Goods','room':'Return\x20Rooms'}},{'$unwind':_0x14fe6b(0x195)},{'$group':{'_id':_0x14fe6b(0x20d),'name':{'$first':_0x14fe6b(0x178)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x14fe6b(0x1f9)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x14fe6b(0x1e0)},'primary_code':{'$first':_0x14fe6b(0x1c8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x14fe6b(0x22c)}}}]);console['log'](_0x14fe6b(0x1b3),_0x2acf51);const _0x346d64=await product[_0x14fe6b(0x212)]({});warehouse_data=await warehouse[_0x14fe6b(0x1fb)]([{'$match':{'status':_0x14fe6b(0x179),'name':'Return\x20Goods','warehouse_category':_0x14fe6b(0x185)}},{'$group':{'_id':_0x14fe6b(0x163),'name':{'$first':_0x14fe6b(0x163)}}},{'$sort':{'name':0x1}}]);var _0x126d77=[_0x14fe6b(0x18a)];if(_0x59ea44[0x0]['language']=='English\x20(US)'){var _0x3d9926=users[_0x14fe6b(0x1c1)];console[_0x14fe6b(0x16c)](_0x3d9926);}else{if(_0x59ea44[0x0][_0x14fe6b(0x188)]==_0x14fe6b(0x1a3))var _0x3d9926=users[_0x14fe6b(0x1a3)];else{if(_0x59ea44[0x0][_0x14fe6b(0x188)]==_0x14fe6b(0x201))var _0x3d9926=users[_0x14fe6b(0x201)];else{if(_0x59ea44[0x0][_0x14fe6b(0x188)]==_0x14fe6b(0x215))var _0x3d9926=users[_0x14fe6b(0x215)];else{if(_0x59ea44[0x0][_0x14fe6b(0x188)]==_0x14fe6b(0x236))var _0x3d9926=users['French'];else{if(_0x59ea44[0x0][_0x14fe6b(0x188)]==_0x14fe6b(0x15a))var _0x3d9926=users[_0x14fe6b(0x19a)];else{if(_0x59ea44[0x0][_0x14fe6b(0x188)]=='Chinese')var _0x3d9926=users[_0x14fe6b(0x13a)];else{if(_0x59ea44[0x0][_0x14fe6b(0x188)]=='Arabic\x20(ae)')var _0x3d9926=users[_0x14fe6b(0x235)];}}}}}}}_0x38b272['render'](_0x14fe6b(0x200),{'success':_0x8cb70f[_0x14fe6b(0x177)]('success'),'errors':_0x8cb70f[_0x14fe6b(0x177)](_0x14fe6b(0x15f)),'role':_0x4c44a8,'profile':_0x3eac32,'user':_0x5ca3a6,'stock':_0x2acf51,'master_shop':_0x59ea44,'unit':_0x346d64,'language':_0x3d9926,'warehouses':warehouse_data,'rooms':_0x126d77});}catch(_0x36e0c5){console[_0x14fe6b(0x16c)](_0x36e0c5),_0x38b272['status'](0xc8)[_0x14fe6b(0x1a0)]({'message':_0x36e0c5[_0x14fe6b(0x138)]});}}),router['post'](a0_0x95b963(0x218),auth,async(_0x1ac0e5,_0x516a91)=>{var _0x3870b1=a0_0x95b963;try{const {invoice:_0x3624fa,date:_0x386b23,warehouse_name:_0x3748ae,product_name:_0x2201bc,primary_code:_0x50ff59,secondary_code:_0x468f73,product_code:_0x13f5bc,sales_quantity:_0x5c457e,stocks:_0x47d511,return_qty:_0x472692,Room_name:_0xf1ec81,to_warehouse_name:_0x5ea926,to_Roomname:_0x3de366,to_Room_name:_0x4c9e8a,note:_0x3e0c71,level:_0x42cfd1,isle:_0x453ed8,pallet:_0x3a341c}=_0x1ac0e5[_0x3870b1(0x1f4)];if(typeof _0x2201bc==_0x3870b1(0x1a4))var _0x3d60ac=[_0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x151)]],_0x2fef43=[_0x1ac0e5['body'][_0x3870b1(0x226)]],_0x4aca10=[_0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x1f5)]],_0x1c3340=[_0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x187)]],_0xbcca7e=[_0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x16a)]],_0xab2b92=[_0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x1b6)]],_0x55ee18=[_0x1ac0e5[_0x3870b1(0x1f4)]['return_qty']],_0x515f39=[_0x1ac0e5['body']['bay']],_0x2050d2=[_0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x1fc)]],_0x5bfd9f=[_0x1ac0e5['body'][_0x3870b1(0x19f)]],_0x3bb6ad=[_0x1ac0e5[_0x3870b1(0x1f4)]['floorlevel']];else var _0x3d60ac=[..._0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x151)]],_0x2fef43=[..._0x1ac0e5[_0x3870b1(0x1f4)]['primary_code']],_0x4aca10=[..._0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x1f5)]],_0x1c3340=[..._0x1ac0e5['body']['product_code']],_0xbcca7e=[..._0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x16a)]],_0xab2b92=[..._0x1ac0e5[_0x3870b1(0x1f4)]['stocks']],_0x55ee18=[..._0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x19c)]],_0x515f39=[..._0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x142)]],_0x2050d2=[..._0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x1fc)]],_0x5bfd9f=[..._0x1ac0e5['body'][_0x3870b1(0x19f)]],_0x3bb6ad=[..._0x1ac0e5['body'][_0x3870b1(0x22d)]];const _0x55b113=_0x3d60ac[_0x3870b1(0x166)](_0x633061=>{return _0x633061={'product_name':_0x633061};});_0x2fef43[_0x3870b1(0x229)]((_0x46bc43,_0x5bea4a)=>{var _0x21d754=_0x3870b1;_0x55b113[_0x5bea4a][_0x21d754(0x226)]=_0x46bc43;}),_0x4aca10[_0x3870b1(0x229)]((_0x1fa13e,_0x562724)=>{_0x55b113[_0x562724]['secondary_code']=_0x1fa13e;}),_0x1c3340[_0x3870b1(0x229)]((_0x2ef96b,_0x41185d)=>{var _0x537771=_0x3870b1;_0x55b113[_0x41185d][_0x537771(0x187)]=_0x2ef96b;}),_0xbcca7e[_0x3870b1(0x229)]((_0x532a5e,_0x57ac60)=>{var _0x330ce5=_0x3870b1;_0x55b113[_0x57ac60][_0x330ce5(0x15d)]=_0x532a5e;}),_0xab2b92['forEach']((_0x4c8a0d,_0x7eeddd)=>{_0x55b113[_0x7eeddd]['stock']=_0x4c8a0d;}),_0x55ee18[_0x3870b1(0x229)]((_0x11be26,_0x24fa37)=>{_0x55b113[_0x24fa37]['return_qty']=_0x11be26;}),_0x515f39[_0x3870b1(0x229)]((_0xfa046f,_0x169084)=>{var _0x1e19e0=_0x3870b1;_0x55b113[_0x169084][_0x1e19e0(0x142)]=_0xfa046f;}),_0x2050d2[_0x3870b1(0x229)]((_0x1fe7b2,_0x1a1850)=>{var _0x363974=_0x3870b1;_0x55b113[_0x1a1850][_0x363974(0x1fc)]=_0x1fe7b2;}),_0x5bfd9f[_0x3870b1(0x229)]((_0xffdb22,_0x5caf8b)=>{var _0x3cdaba=_0x3870b1;_0x55b113[_0x5caf8b][_0x3cdaba(0x1cc)]=_0xffdb22;}),_0x3bb6ad['forEach']((_0xa2c99f,_0x4eecec)=>{var _0x4b766e=_0x3870b1;_0x55b113[_0x4eecec][_0x4b766e(0x22d)]=_0xa2c99f;});var _0x3f2b2a=0x0;_0x55b113[_0x3870b1(0x229)](_0x947153=>{var _0x1e5858=_0x3870b1;console[_0x1e5858(0x16c)]('foreach\x20newproduct',_0x947153),(parseInt(_0x947153[_0x1e5858(0x15d)])<parseInt(_0x947153[_0x1e5858(0x19c)])||parseInt(_0x947153['stock'])<parseInt(_0x947153[_0x1e5858(0x19c)])&&parseInt(_0x947153[_0x1e5858(0x15d)])>parseInt(_0x947153[_0x1e5858(0x19c)])||parseInt(_0x947153[_0x1e5858(0x19c)])==0x0)&&_0x3f2b2a++;});if(_0x3f2b2a!=0x0)return _0x1ac0e5['flash'](_0x3870b1(0x15f),_0x3870b1(0x1ba)),_0x516a91['redirect'](_0x3870b1(0x19d));const _0x1ab1bb=await sales[_0x3870b1(0x165)]({'invoice':_0x3624fa});console[_0x3870b1(0x16c)](_0x1ab1bb),_0x1ab1bb[_0x3870b1(0x17d)]=_0x3870b1(0x199);const _0xcb071d=await _0x1ab1bb[_0x3870b1(0x1f6)](),_0x55233f=new sales_return({'invoice':_0x3624fa,'customer':_0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x15b)],'date':_0x386b23,'warehouse_name':_0x3748ae,'room':_0xf1ec81,'ToWarehouse':_0x5ea926,'ToRoom':_0x4c9e8a,'return_sale':_0x55b113,'note':_0x3e0c71}),_0x5e5a0d=await _0x55233f[_0x3870b1(0x1f6)]();console[_0x3870b1(0x16c)](_0x55233f);const _0x5ca93f=await sales_return[_0x3870b1(0x165)]({'invoice':_0x3624fa}),_0x34143a=await warehouse[_0x3870b1(0x165)]({'name':_0x5ea926,'room':_0x4c9e8a});_0x5ca93f[_0x3870b1(0x200)][_0x3870b1(0x229)](_0x1fe45d=>{var _0x250d8f=_0x3870b1,_0x715d5e=0x0;const _0x479d43=_0x34143a[_0x250d8f(0x234)]['map'](_0x157920=>{var _0x133259=_0x250d8f;_0x157920['product_name']==_0x1fe45d['product_name']&&_0x157920[_0x133259(0x22d)]==_0x1fe45d[_0x133259(0x22d)]&&_0x157920[_0x133259(0x1cc)]==_0x1fe45d['type']&&_0x157920[_0x133259(0x1fc)]==_0x1fe45d['bin']&&_0x157920[_0x133259(0x142)]==_0x1fe45d[_0x133259(0x142)]&&(_0x157920[_0x133259(0x1b8)]=parseInt(_0x157920[_0x133259(0x1b8)])+parseInt(_0x1fe45d['return_qty']),_0x715d5e++);});_0x715d5e=='0'&&(_0x34143a[_0x250d8f(0x234)]=_0x34143a[_0x250d8f(0x234)][_0x250d8f(0x176)]({'product_name':_0x1fe45d['product_name'],'product_stock':_0x1fe45d[_0x250d8f(0x19c)],'primary_code':_0x1fe45d['primary_code'],'secondary_code':_0x1fe45d[_0x250d8f(0x1f5)],'product_code':_0x1fe45d[_0x250d8f(0x187)],'bay':_0x1fe45d['bay'],'bin':_0x1fe45d[_0x250d8f(0x1fc)],'type':_0x1fe45d['type'],'floorlevel':_0x1fe45d[_0x250d8f(0x22d)]})),console[_0x250d8f(0x16c)](_0x250d8f(0x131),_0x34143a);}),await _0x34143a[_0x3870b1(0x1f6)](),console['log'](_0x1ac0e5[_0x3870b1(0x1f4)]);const _0x429498=new c_payment_data({'invoice':_0x3624fa,'customer':_0x1ac0e5['body'][_0x3870b1(0x15b)],'reason':'Sale\x20Return'});await _0x429498[_0x3870b1(0x1f6)]();const _0x1e1929=await master_shop['find']();console[_0x3870b1(0x16c)](_0x3870b1(0x183),_0x1e1929[0x0][_0x3870b1(0x14b)]);const _0x573975=await email_settings[_0x3870b1(0x165)](),_0x38901d=await customer[_0x3870b1(0x165)]({'name':_0x1ac0e5[_0x3870b1(0x1f4)][_0x3870b1(0x15b)]});console['log']('customer_data',_0x38901d);_0x1e1929[0x0]['currency_placement']==0x1?(right_currency=_0x1e1929[0x0][_0x3870b1(0x225)],left_currency=''):(right_currency='',left_currency=_0x1e1929[0x0]['currency']);var _0x32ce62=_0x3d60ac,_0x22c4fe=_0x55ee18,_0x527849='',_0x1451c5;for(_0x1451c5 in _0x32ce62){_0x527849+=_0x3870b1(0x1dc)+_0x3870b1(0x1e5)+_0x32ce62[_0x1451c5]+_0x3870b1(0x14c)+_0x3870b1(0x1e5)+_0x22c4fe[_0x1451c5]+_0x3870b1(0x14c)+_0x3870b1(0x1d2);}console[_0x3870b1(0x16c)](_0x3870b1(0x1d8),_0x527849);let _0xc43230=nodemailer[_0x3870b1(0x1b7)]({'service':_0x3870b1(0x14e),'auth':{'user':_0x573975[_0x3870b1(0x147)],'pass':_0x573975[_0x3870b1(0x1ee)]}}),_0x267961={'from':_0x573975['email'],'to':_0x38901d[_0x3870b1(0x147)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x3870b1(0x1a8)+_0x3870b1(0x208)+_0x1e1929[0x0]['image'],'cid':_0x3870b1(0x1c6)}],'html':_0x3870b1(0x140)+'<html><head><title></title>'+_0x3870b1(0x206)+_0x3870b1(0x22e)+_0x3870b1(0x20e)+'<div>'+_0x3870b1(0x237)+_0x3870b1(0x210)+_0x3870b1(0x22e)+_0x3870b1(0x1f3)+_0x1e1929[0x0]['site_title']+_0x3870b1(0x232)+_0x3870b1(0x210)+_0x3870b1(0x210)+_0x3870b1(0x202)+_0x3870b1(0x22e)+_0x3870b1(0x162)+'\x20Order\x20Number\x20:\x20'+_0x3624fa+'\x20'+_0x3870b1(0x1bd)+_0x3870b1(0x197)+_0x386b23+'\x20'+_0x3870b1(0x181)+'</h5>'+_0x3870b1(0x210)+_0x3870b1(0x1f1)+_0x3870b1(0x1cd)+'<tr>'+_0x3870b1(0x14d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x3870b1(0x21b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x3870b1(0x1d2)+_0x3870b1(0x20b)+_0x3870b1(0x1e2)+'\x20'+_0x527849+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x3870b1(0x1b4)+_0x3870b1(0x1eb)+_0x1e1929[0x0][_0x3870b1(0x1d9)]+_0x3870b1(0x22a)+'</div>'+_0x3870b1(0x210)+_0x3870b1(0x141)};_0xc43230[_0x3870b1(0x148)](_0x267961,function(_0x4dd424,_0x2d6d78){var _0x5856e2=_0x3870b1;_0x4dd424?(console[_0x5856e2(0x16c)](_0x4dd424),console[_0x5856e2(0x16c)]('Error\x20Occurs')):console[_0x5856e2(0x16c)]('Email\x20sent\x20successfully');}),_0x1ac0e5['flash'](_0x3870b1(0x168),'sales\x20item\x20return\x20successfull'),_0x516a91[_0x3870b1(0x154)](_0x3870b1(0x22f));}catch(_0x104bb3){console[_0x3870b1(0x16c)](_0x104bb3),_0x516a91[_0x3870b1(0x1ed)](0xc8)[_0x3870b1(0x1a0)]({'message1':_0x104bb3['message']});}}),router[a0_0x95b963(0x193)](a0_0x95b963(0x1be),auth,async(_0x5c336e,_0x7db7a7)=>{var _0x19bdeb=a0_0x95b963;try{const {username:_0x46f900,email:_0x20d3a0,role:_0x1a9d60}=_0x5c336e['user'],_0x9c83aa=_0x5c336e['user'],_0x5872c8=await profile['findOne']({'email':_0x9c83aa[_0x19bdeb(0x147)]}),_0x3b4e5a=await master_shop['find']();console[_0x19bdeb(0x16c)](_0x19bdeb(0x1cf),_0x3b4e5a);const _0x201f5e=_0x5c336e['params']['id'],_0x390cc7=await sales[_0x19bdeb(0x1df)](_0x201f5e);console[_0x19bdeb(0x16c)](_0x19bdeb(0x222),_0x390cc7);if(_0x3b4e5a[0x0]['language']=='English\x20(US)')var _0x2a5726=users[_0x19bdeb(0x1c1)];else{if(_0x3b4e5a[0x0][_0x19bdeb(0x188)]=='Hindi')var _0x2a5726=users[_0x19bdeb(0x1a3)];else{if(_0x3b4e5a[0x0][_0x19bdeb(0x188)]==_0x19bdeb(0x201))var _0x2a5726=users['German'];else{if(_0x3b4e5a[0x0][_0x19bdeb(0x188)]==_0x19bdeb(0x215))var _0x2a5726=users[_0x19bdeb(0x215)];else{if(_0x3b4e5a[0x0][_0x19bdeb(0x188)]==_0x19bdeb(0x236))var _0x2a5726=users[_0x19bdeb(0x236)];else{if(_0x3b4e5a[0x0][_0x19bdeb(0x188)]==_0x19bdeb(0x15a))var _0x2a5726=users[_0x19bdeb(0x19a)];else{if(_0x3b4e5a[0x0][_0x19bdeb(0x188)]=='Chinese')var _0x2a5726=users[_0x19bdeb(0x13a)];else{if(_0x3b4e5a[0x0][_0x19bdeb(0x188)]=='Arabic\x20(ae)')var _0x2a5726=users['Arabic'];}}}}}}}_0x7db7a7[_0x19bdeb(0x1e9)](_0x19bdeb(0x1a9),{'success':_0x5c336e[_0x19bdeb(0x177)](_0x19bdeb(0x168)),'errors':_0x5c336e['flash'](_0x19bdeb(0x15f)),'role':_0x9c83aa,'profile':_0x5872c8,'alldata':_0x390cc7,'master_shop':_0x3b4e5a,'language':_0x2a5726});}catch(_0x22fdb){console[_0x19bdeb(0x16c)](_0x22fdb);}}),router[a0_0x95b963(0x1c0)]('/barcode_scanner',async(_0x5b94c5,_0x40d184)=>{var _0x670121=a0_0x95b963;const {product_code:_0x47dfd7,warehouse_name:_0x4346ef,rooms_data:_0x2ab15,Roomslist:_0x225af2}=_0x5b94c5[_0x670121(0x1f4)],_0x1e97cb=_0x225af2['split'](','),_0x2cd39c=[];async function _0x300b97(_0x3a2566){var _0x408a31=_0x670121;const _0x59a27f=await warehouse[_0x408a31(0x1fb)]([{'$match':{'name':_0x4346ef,'room':_0x3a2566}},{'$unwind':_0x408a31(0x195)},{'$match':{'product_details.primary_code':_0x47dfd7}},{'$group':{'_id':_0x408a31(0x20d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x408a31(0x1d0)},'primary_code':{'$first':_0x408a31(0x1c8)},'secondary_code':{'$first':_0x408a31(0x1b5)},'product_code':{'$first':_0x408a31(0x22c)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x408a31(0x171)},'type':{'$first':_0x408a31(0x180)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x408a31(0x1aa)},'secondary_unit':{'$first':_0x408a31(0x13d)},'storage':{'$first':_0x408a31(0x17b)},'rack':{'$first':_0x408a31(0x1e4)},'expiry_date':{'$first':_0x408a31(0x145)},'production_date':{'$first':_0x408a31(0x1a1)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x408a31(0x1c5)},'product_cat':{'$first':_0x408a31(0x18f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x408a31(0x13b)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x408a31(0x158)},'actual_uom':{'$first':_0x408a31(0x194)}}}]),_0x5f7ec2=await warehouse[_0x408a31(0x1fb)]([{'$match':{'name':_0x4346ef,'room':_0x3a2566}},{'$unwind':_0x408a31(0x195)},{'$match':{'product_details.secondary_code':_0x47dfd7}},{'$group':{'_id':_0x408a31(0x20d),'name':{'$first':_0x408a31(0x178)},'product_stock':{'$first':_0x408a31(0x1d0)},'primary_code':{'$first':_0x408a31(0x1c8)},'secondary_code':{'$first':_0x408a31(0x1b5)},'product_code':{'$first':_0x408a31(0x22c)},'level':{'$first':_0x408a31(0x1c7)},'isle':{'$first':_0x408a31(0x171)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x408a31(0x1aa)},'secondary_unit':{'$first':_0x408a31(0x13d)},'storage':{'$first':_0x408a31(0x17b)},'rack':{'$first':_0x408a31(0x1e4)},'expiry_date':{'$first':_0x408a31(0x145)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x408a31(0x21d)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x408a31(0x13b)},'invoice':{'$first':_0x408a31(0x221)}}}]);if(_0x59a27f[_0x408a31(0x233)]>0x0)_0x2cd39c['push'](_0x59a27f);else _0x5f7ec2[_0x408a31(0x233)]>0x0&&_0x2cd39c[_0x408a31(0x155)](_0x5f7ec2);}const _0x11cde9=_0x1e97cb[_0x670121(0x166)](_0x2d7f0d=>_0x300b97(_0x2d7f0d));await Promise['all'](_0x11cde9),_0x40d184[_0x670121(0x1a0)](_0x2cd39c);}),module[a0_0x95b963(0x192)]=router;