var a0_0x1955c6=a0_0x25b3;(function(_0xa7b558,_0x17be43){var _0x292b30=a0_0x25b3,_0x47ccb5=_0xa7b558();while(!![]){try{var _0x198990=-parseInt(_0x292b30(0x9b))/0x1+-parseInt(_0x292b30(0x113))/0x2+parseInt(_0x292b30(0x13b))/0x3*(-parseInt(_0x292b30(0xb0))/0x4)+-parseInt(_0x292b30(0xd4))/0x5*(parseInt(_0x292b30(0x9f))/0x6)+parseInt(_0x292b30(0x182))/0x7*(-parseInt(_0x292b30(0x186))/0x8)+-parseInt(_0x292b30(0xc8))/0x9+-parseInt(_0x292b30(0x11e))/0xa*(-parseInt(_0x292b30(0x18e))/0xb);if(_0x198990===_0x17be43)break;else _0x47ccb5['push'](_0x47ccb5['shift']());}catch(_0x4985e5){_0x47ccb5['push'](_0x47ccb5['shift']());}}}(a0_0x4aaf,0x1da35));function a0_0x25b3(_0x2ffffe,_0x9b20ac){var _0x4aaf19=a0_0x4aaf();return a0_0x25b3=function(_0x25b357,_0x45acbd){_0x25b357=_0x25b357-0x8b;var _0x2b2ed9=_0x4aaf19[_0x25b357];return _0x2b2ed9;},a0_0x25b3(_0x2ffffe,_0x9b20ac);}function a0_0x4aaf(){var _0x56150c=['delivery_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$sale_product.floorlevel','gmail','RoomAssigned','$product_details.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</span>','errors','stock','finalize','host','actual_qty','max_per_unit','</div>','add\x20post','quantity','$customer','Return\x20Rooms','258512EPBtZh','save','$product_details.level','\x20Order\x20Number\x20:\x20','English\x20(US)','</h5>','site_title','Enabled','/invoice/:id','unit','product_name','70YZCUxD','status','add_sales','$product_details.product_stock','forEach','../public/language/languages.json','level','Receiving\x20Area','<html><head><title></title>','concat','due_amount','get','\x20</h2>','all','/view/add_sales/:id','Arabic','catch','findOne','Raw\x20Materials','$product_details.floorlevel','role','False','product_data','$sale_product.bay','</td>','language','string','/view/add_sale/product','/view/return_sales/:id','10584ocqqoe','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</body></html>','render','\x20Order\x20Date\x20:\x20','logo','getFullYear','amount','createTransport','filter','aggregate','Error\x20Occurs','secondary_unit','push','French','storage','$product_details.actual_uom','/all_sales/preview/','<hr\x20class=\x22my-3\x22>','$product.product_name','currency_placement','/view','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','sales\x20item\x20return\x20successfull','</thead>','/upload/','$product_details.expiry_date','success','primary_unit','Sales\x20Mail','/view/add_sales','error','params','Level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','find','$product_details.production_date','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.rack','random','$product_details.secondary_unit','$product_details.unit','product_stock','$product_details.actual_qty','barcode\x20user_id','post','German','bay','Hindi','<h5>','date','master','carton','../middleware/auth','all_sales','$product_details._id','<div>','Arabic\x20(ae)','sale_qty','$isAllowEdit','flash','<h2>\x20','Shelves','type','$room','body','maxperunit','$return_data','RMSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/barcode/:id','21qIlygI','$product_details.secondary_code','$product_details.primary_code','getMonth','538616ywUeSZ','/preview/:id','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','name','prod_code','toString','staff','1342154NXFeSd','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','production_date','$sale_product.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.product_code','sendMail','/give_payment/:id','Chinese','Sales\x20Update\x20successfully','/../public','$product_details','SCRN','foreach\x20newproduct','An\x20error\x20occurred\x20while\x20saving\x20data.','/view/:id','invoice','product_details','$name','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','types','11157SXoBOr','primary_code','secondary_code','$product_details.invoice','311562EGJZhe','customer_data','warehouse','$warehouse_name','Return\x20Goods','slice','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Sale\x20Return','sales\x20all_data','$invoice','rack','customers_docs','getDate','$customers_docs','received_amount','sale_product','148dHGHJd','</table>','log','<span\x20style=\x22float:\x20right;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','back','$product_details.type','$product_details.bin','redirect','/all_sales/view','batch_code','length','Portuguese\x20(BR)','Sales\x20Add\x20successfully','delivery_code','return_qty','prod_cat','actual_uom','</head><body>','stocks','note','Portuguese','json','<strong>\x20Regards\x20</strong>','1870596pveuEA','$sale_product.quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','../models/all_models','$_id','Enclosed','room_name','<tr>','bin','prod_invoice','edit_sales_view','customer','5YGmkLw','$product_details.storage','$product_details.product_cat','warehouse_name','message','$product_details.batch_code','<!DOCTYPE\x20html>','$note','sales_quantity','expiry_date','currency','True','isAllowEdit','findById','product_code','Floor','OUT-','<tbody\x20style=\x22text-align:\x20center;\x22>','return_data','</tr>','floorlevel','user','stock_data','quantity_notConverted','password','$product_details.isle','Router','all_sales_barcode','requested_qty','Ambient','$product_details.maxPerUnit','map','final','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','then','$date','email','nodemailer','exports','$finalize','English','$sale_product','sales_invoice'];a0_0x4aaf=function(){return _0x56150c;};return a0_0x4aaf();}const express=require('express'),app=express(),router=express[a0_0x1955c6(0xee)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1955c6(0xcb)),auth=require(a0_0x1955c6(0x170)),nodemailer=require(a0_0x1955c6(0xfa)),users=require(a0_0x1955c6(0x123));router[a0_0x1955c6(0x129)](a0_0x1955c6(0x150),auth,async(_0x2b0886,_0x1ac621)=>{var _0x3cd0d2=a0_0x1955c6;try{const {username:_0x4b5e22,email:_0x5e8c10,role:_0x5a1f5a}=_0x2b0886[_0x3cd0d2(0xe9)],_0x4ab6b3=_0x2b0886[_0x3cd0d2(0xe9)],_0xcdfe38=await profile[_0x3cd0d2(0x12f)]({'email':_0x4ab6b3[_0x3cd0d2(0xf9)]}),_0x5346e3=await master_shop['find']();let _0x3bbb3b;if(_0x4ab6b3[_0x3cd0d2(0x132)]=='staff'){const _0x5eeebe=await staff['findOne']({'email':_0x4ab6b3[_0x3cd0d2(0xf9)]});_0x3bbb3b=await sales[_0x3cd0d2(0x145)]([{'$lookup':{'from':'customers','localField':_0x3cd0d2(0xd3),'foreignField':_0x3cd0d2(0x18a),'as':_0x3cd0d2(0xab)}},{'$unwind':_0x3cd0d2(0xad)},{'$unwind':_0x3cd0d2(0xfe)},{'$group':{'_id':_0x3cd0d2(0xcc),'invoice':{'$first':_0x3cd0d2(0xa9)},'customers':{'$first':'$customer'},'date':{'$first':_0x3cd0d2(0xf8)},'warehouse_name':{'$first':_0x3cd0d2(0xa2)},'sale_product':{'$push':_0x3cd0d2(0xfe)},'note':{'$first':_0x3cd0d2(0xdb)},'return_data':{'$first':_0x3cd0d2(0x17e)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x3cd0d2(0x135)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x3cd0d2(0x191)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3cd0d2(0xfc)},'isAllowEdit':{'$first':_0x3cd0d2(0x176)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x3bbb3b=await sales[_0x3cd0d2(0x145)]([{'$lookup':{'from':'customers','localField':_0x3cd0d2(0xd3),'foreignField':'name','as':_0x3cd0d2(0xab)}},{'$unwind':_0x3cd0d2(0xad)},{'$unwind':_0x3cd0d2(0xfe)},{'$group':{'_id':_0x3cd0d2(0xcc),'invoice':{'$first':_0x3cd0d2(0xa9)},'customers':{'$first':_0x3cd0d2(0x111)},'date':{'$first':_0x3cd0d2(0xf8)},'warehouse_name':{'$first':_0x3cd0d2(0xa2)},'sale_product':{'$push':_0x3cd0d2(0xfe)},'note':{'$first':_0x3cd0d2(0xdb)},'return_data':{'$first':_0x3cd0d2(0x17e)},'customers_docs':{'$first':_0x3cd0d2(0xad)},'total_saleproduct_quantity':{'$sum':_0x3cd0d2(0xc9)},'level':{'$addToSet':_0x3cd0d2(0x135)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x3cd0d2(0x191)},'pallet':{'$addToSet':_0x3cd0d2(0x102)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x3cd0d2(0x176)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3cd0d2(0xb2)](_0x3cd0d2(0xa8),_0x3bbb3b);if(_0x5346e3[0x0]['language']==_0x3cd0d2(0x117)){var _0x38041f=users[_0x3cd0d2(0xfd)];console['log'](_0x38041f);}else{if(_0x5346e3[0x0]['language']==_0x3cd0d2(0x16b))var _0x38041f=users['Hindi'];else{if(_0x5346e3[0x0]['language']==_0x3cd0d2(0x169))var _0x38041f=users[_0x3cd0d2(0x169)];else{if(_0x5346e3[0x0][_0x3cd0d2(0x137)]==_0x3cd0d2(0xa5))var _0x38041f=users[_0x3cd0d2(0xa5)];else{if(_0x5346e3[0x0][_0x3cd0d2(0x137)]==_0x3cd0d2(0x149))var _0x38041f=users[_0x3cd0d2(0x149)];else{if(_0x5346e3[0x0][_0x3cd0d2(0x137)]==_0x3cd0d2(0xbc))var _0x38041f=users[_0x3cd0d2(0xc5)];else{if(_0x5346e3[0x0][_0x3cd0d2(0x137)]==_0x3cd0d2(0x8e))var _0x38041f=users[_0x3cd0d2(0x8e)];else{if(_0x5346e3[0x0][_0x3cd0d2(0x137)]==_0x3cd0d2(0x174))var _0x38041f=users[_0x3cd0d2(0x12d)];}}}}}}}_0x1ac621[_0x3cd0d2(0x13e)](_0x3cd0d2(0x171),{'success':_0x2b0886[_0x3cd0d2(0x177)](_0x3cd0d2(0x156)),'errors':_0x2b0886[_0x3cd0d2(0x177)](_0x3cd0d2(0x108)),'sales':_0x3bbb3b,'profile':_0xcdfe38,'role':_0x4ab6b3,'master_shop':_0x5346e3,'language':_0x38041f});}catch(_0x56b5f4){console[_0x3cd0d2(0xb2)](_0x56b5f4);}});async function getRandom8DigitNumber(){var _0x57e9fe=a0_0x1955c6;const _0x4fdc16=0x989680,_0x4946f4=0x5f5e0ff,_0x434d6b=Math['floor'](Math[_0x57e9fe(0x162)]()*(_0x4946f4-_0x4fdc16+0x1))+_0x4fdc16;var _0x3da508;const _0x4851c2=await sales['findOne']({'invoice':_0x57e9fe(0xe4)+_0x434d6b});return _0x4851c2&&_0x4851c2[_0x57e9fe(0xbb)]>0x0?_0x3da508=_0x57e9fe(0xe4)+_0x434d6b:_0x3da508=_0x57e9fe(0xe4)+_0x434d6b,_0x3da508;}router['get'](a0_0x1955c6(0x159),auth,async(_0x12ac1f,_0x3ceca7)=>{var _0x2911bd=a0_0x1955c6;try{const {username:_0x1d1ef5,email:_0x20253f,role:_0x5a5da0}=_0x12ac1f[_0x2911bd(0xe9)],_0x1009a3=_0x12ac1f[_0x2911bd(0xe9)],_0x3ed244=await profile['findOne']({'email':_0x1009a3[_0x2911bd(0xf9)]}),_0x26968d=await master_shop['find'](),_0x2f23a2=await customer[_0x2911bd(0x15e)]({});let _0x179886;if(_0x1009a3[_0x2911bd(0x132)]==_0x2911bd(0x18d)){const _0x32c5ca=await staff[_0x2911bd(0x12f)]({'email':_0x1009a3[_0x2911bd(0xf9)]});_0x179886=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x32c5ca['warehouse'],'warehouse_category':_0x2911bd(0x130),'name':{'$ne':_0x2911bd(0xa3)}}},{'$group':{'_id':_0x2911bd(0x98),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x179886=await warehouse[_0x2911bd(0x145)]([{'$match':{'status':_0x2911bd(0x11a),'warehouse_category':_0x2911bd(0x130),'name':{'$ne':_0x2911bd(0xa3)}}},{'$group':{'_id':_0x2911bd(0x98),'name':{'$first':_0x2911bd(0x98)}}},{'$sort':{'name':0x1}}]);const _0x12b886=await product[_0x2911bd(0x15e)]({});var _0xad9236=['Ambient','Enclosed'];const _0x35c8ed=await sales[_0x2911bd(0x15e)]({}),_0x504fa3=_0x35c8ed['length']+0x1,_0x596d95=_0x2911bd(0xe4)+_0x504fa3[_0x2911bd(0x18c)]()['padStart'](0x5,'0');if(_0x26968d[0x0]['language']==_0x2911bd(0x117)){var _0x557308=users['English'];console['log'](_0x557308);}else{if(_0x26968d[0x0]['language']=='Hindi')var _0x557308=users['Hindi'];else{if(_0x26968d[0x0][_0x2911bd(0x137)]==_0x2911bd(0x169))var _0x557308=users['German'];else{if(_0x26968d[0x0][_0x2911bd(0x137)]==_0x2911bd(0xa5))var _0x557308=users[_0x2911bd(0xa5)];else{if(_0x26968d[0x0][_0x2911bd(0x137)]=='French')var _0x557308=users[_0x2911bd(0x149)];else{if(_0x26968d[0x0][_0x2911bd(0x137)]==_0x2911bd(0xbc))var _0x557308=users[_0x2911bd(0xc5)];else{if(_0x26968d[0x0][_0x2911bd(0x137)]=='Chinese')var _0x557308=users[_0x2911bd(0x8e)];else{if(_0x26968d[0x0][_0x2911bd(0x137)]==_0x2911bd(0x174))var _0x557308=users[_0x2911bd(0x12d)];}}}}}}}const _0x54babb=getRandom8DigitNumber();_0x54babb[_0x2911bd(0xf7)](_0x1ebba8=>{var _0x1a3dbd=_0x2911bd;_0x3ceca7[_0x1a3dbd(0x13e)](_0x1a3dbd(0x120),{'success':_0x12ac1f['flash'](_0x1a3dbd(0x156)),'errors':_0x12ac1f[_0x1a3dbd(0x177)]('errors'),'role':_0x1009a3,'profile':_0x3ed244,'customer':_0x2f23a2,'warehouse':_0x179886,'product':_0x12b886,'invoice':_0x1ebba8,'master_shop':_0x26968d,'language':_0x557308,'rooms_data':_0xad9236});})[_0x2911bd(0x12e)](_0x2a99b0=>{var _0x17eb36=_0x2911bd;_0x12ac1f[_0x17eb36(0x177)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3ceca7[_0x17eb36(0xb8)]('/all_sales/view');});}catch(_0x295c2f){console[_0x2911bd(0xb2)](_0x295c2f);}}),router[a0_0x1955c6(0x129)](a0_0x1955c6(0x12c),auth,async(_0x3fe411,_0x5c3c28)=>{var _0x581ee5=a0_0x1955c6;try{const _0x3015b3=_0x3fe411[_0x581ee5(0x15b)]['id'];console[_0x581ee5(0xb2)](_0x3015b3);const _0x1e4c29=await product[_0x581ee5(0x15e)](),_0x3fa14e=await purchases[_0x581ee5(0x145)]([{'$match':{'warehouse_name':_0x3015b3}},{'$unwind':'$product'},{'$group':{'_id':_0x581ee5(0x14e)}}]);console[_0x581ee5(0xb2)]('purchases_data',_0x3fa14e),_0x5c3c28[_0x581ee5(0x11f)](0xc8)['json']({'purchases_data':_0x3fa14e,'product_data':_0x1e4c29});}catch(_0x378940){console[_0x581ee5(0xb2)](_0x378940);}}),router[a0_0x1955c6(0x168)](a0_0x1955c6(0x139),auth,async(_0x381dec,_0x31132c)=>{var _0x5cccf2=a0_0x1955c6;try{const {warehouse_data:_0x5e0ab0,product_data:_0x26d06b}=_0x381dec['body'];console['log'](_0x381dec[_0x5cccf2(0x17c)][_0x5cccf2(0x134)]);;const _0x5d3e14=await master_shop[_0x5cccf2(0x15e)]();console['log'](_0x5cccf2(0x16e),_0x5d3e14);const _0x5ca915=await product['findOne']({'name':_0x26d06b});console[_0x5cccf2(0xb2)]('product',_0x5ca915);const _0x403f1f=await warehouse[_0x5cccf2(0x145)]([{'$match':{'name':_0x5e0ab0}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x26d06b}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x5cccf2(0x121)}}}]);console[_0x5cccf2(0xb2)]('stock_data',_0x403f1f),_0x31132c[_0x5cccf2(0x11f)](0xc8)[_0x5cccf2(0xc6)]({'master':_0x5d3e14,'new_product':_0x5ca915,'stock_data':_0x403f1f});}catch(_0x3b8ea5){console[_0x5cccf2(0xb2)](_0x3b8ea5);}}),router[a0_0x1955c6(0x168)](a0_0x1955c6(0x159),auth,async(_0x4a5983,_0x207eaa)=>{var _0x1c4ef5=a0_0x1955c6;try{const {invoice:_0x3f051f,date:_0x28ff1e,warehouse_name:_0x7cf805,product_name:_0x138e46,stock:_0xd6c10b,quantity:_0x412af2,note:_0x51a67a,room:_0x211284,primary_code:_0x4e10c3,secondary_code:_0x54075b,prod_code:_0x27745a,level:_0x37d33f,isle:_0x42a81a,pallet:_0x1135e2,batch_code:_0x42bdf5,SCRN:_0x3598dd,expiry_date:_0x3044b6}=_0x4a5983[_0x1c4ef5(0x17c)];if(typeof _0x138e46==_0x1c4ef5(0x138))var _0xa42bc2=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x11d)]],_0x229c65=[_0x4a5983[_0x1c4ef5(0x17c)]['stock']],_0x36470c=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x16f)]],_0x1e8c4a=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x9c)]],_0x1b3bcb=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x9d)]],_0x3c5ced=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x18b)]],_0x4e8a3c=[_0x4a5983[_0x1c4ef5(0x17c)]['level']],_0x75d2d6=[_0x4a5983['body'][_0x1c4ef5(0x157)]],_0x52b676=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x147)]],_0x27851d=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0xba)]],_0x32039d=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0xdd)]],_0x431f42=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x10d)]],_0x59a1c3=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x190)]],_0x65efe2=[_0x4a5983['body'][_0x1c4ef5(0xf0)]],_0x168ed6=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x100)]],_0x394e4e=[_0x4a5983['body'][_0x1c4ef5(0xbe)]],_0x385e68=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0xc0)]],_0x1e2b5d=[_0x4a5983[_0x1c4ef5(0x17c)]['quantity']],_0x3c06cf=[_0x4a5983[_0x1c4ef5(0x17c)]['RoomAssigned']],_0x194f9c=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0xd1)]],_0x1e5c48=[_0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x10c)]],_0x54bb5d=[_0x4a5983[_0x1c4ef5(0x17c)]['actual_uom']];else var _0xa42bc2=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x11d)]],_0x229c65=[..._0x4a5983[_0x1c4ef5(0x17c)]['stock']],_0x36470c=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x16f)]],_0x1e8c4a=[..._0x4a5983['body'][_0x1c4ef5(0x9c)]],_0x1b3bcb=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x9d)]],_0x3c5ced=[..._0x4a5983['body']['prod_code']],_0x4e8a3c=[..._0x4a5983['body'][_0x1c4ef5(0x124)]],_0x75d2d6=[..._0x4a5983['body'][_0x1c4ef5(0x157)]],_0x52b676=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x147)]],_0x27851d=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0xba)]],_0x32039d=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0xdd)]],_0x431f42=[..._0x4a5983['body'][_0x1c4ef5(0x10d)]],_0x59a1c3=[..._0x4a5983[_0x1c4ef5(0x17c)]['production_date']],_0x65efe2=[..._0x4a5983['body']['requested_qty']],_0x168ed6=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x100)]],_0x394e4e=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0xbe)]],_0x385e68=[..._0x4a5983['body'][_0x1c4ef5(0xc0)]],_0x1e2b5d=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x110)]],_0x3c06cf=[..._0x4a5983['body'][_0x1c4ef5(0x104)]],_0x194f9c=[..._0x4a5983['body'][_0x1c4ef5(0xd1)]],_0x1e5c48=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0x10c)]],_0x54bb5d=[..._0x4a5983[_0x1c4ef5(0x17c)][_0x1c4ef5(0xc1)]];const _0x2a160b=_0xa42bc2['map'](_0x45d88b=>{return _0x45d88b={'product_name':_0x45d88b};});_0x229c65['forEach']((_0x108a21,_0x13d1c0)=>{_0x2a160b[_0x13d1c0]['stock']=_0x108a21;}),_0x1e5c48[_0x1c4ef5(0x122)]((_0x1de7e2,_0x4f3e15)=>{var _0x535eb1=_0x1c4ef5;_0x2a160b[_0x4f3e15][_0x535eb1(0x10c)]=_0x1de7e2;}),_0x54bb5d['forEach']((_0x209119,_0x3204d0)=>{var _0x5101d0=_0x1c4ef5;_0x2a160b[_0x3204d0][_0x5101d0(0xc1)]=_0x209119;}),_0x36470c[_0x1c4ef5(0x122)]((_0xf208da,_0x58f932)=>{var _0x59409e=_0x1c4ef5;_0x2a160b[_0x58f932][_0x59409e(0x110)]=_0xf208da;}),_0x1e8c4a[_0x1c4ef5(0x122)]((_0x1a2f73,_0x58121d)=>{var _0x50e535=_0x1c4ef5;_0x2a160b[_0x58121d][_0x50e535(0x9c)]=_0x1a2f73;}),_0x1b3bcb[_0x1c4ef5(0x122)]((_0x26b3e4,_0x1b46eb)=>{var _0x1e1c4a=_0x1c4ef5;_0x2a160b[_0x1b46eb][_0x1e1c4a(0x9d)]=_0x26b3e4;}),_0x3c5ced[_0x1c4ef5(0x122)]((_0x543fb0,_0x1c63d1)=>{var _0xc67b04=_0x1c4ef5;_0x2a160b[_0x1c63d1][_0xc67b04(0xe2)]=_0x543fb0;}),_0x4e8a3c[_0x1c4ef5(0x122)]((_0x52a167,_0x40a526)=>{var _0x6c4a3c=_0x1c4ef5;_0x3c06cf[_0x6c4a3c(0x122)]((_0x9be02a,_0xa95f80)=>{var _0x587ec0=_0x6c4a3c;if(_0x9be02a==_0x587ec0(0x125)&&_0x40a526==_0xa95f80){var _0x576a38=_0x52a167[_0x587ec0(0xa4)](0x3);_0x2a160b[_0x40a526][_0x587ec0(0x14a)]=_0x52a167[0x0],_0x2a160b[_0x40a526]['rack']=_0x52a167[0x1],_0x2a160b[_0x40a526][_0x587ec0(0x16a)]=0x0,_0x2a160b[_0x40a526][_0x587ec0(0xd0)]=0x0,_0x2a160b[_0x40a526][_0x587ec0(0x17a)]=_0x587ec0(0xe3),_0x2a160b[_0x40a526]['floorlevel']=_0x576a38;}else{if(_0x9be02a==_0x587ec0(0x179)&&_0x40a526==_0xa95f80){var _0x576a38=_0x52a167['slice'](0x3);_0x2a160b[_0x40a526][_0x587ec0(0x14a)]=_0x52a167[0x0],_0x2a160b[_0x40a526]['rack']=_0x52a167[0x1],_0x2a160b[_0x40a526][_0x587ec0(0x16a)]=0x0,_0x2a160b[_0x40a526][_0x587ec0(0xd0)]=0x0,_0x2a160b[_0x40a526][_0x587ec0(0x17a)]=_0x587ec0(0xe3),_0x2a160b[_0x40a526]['floorlevel']=_0x52a167[0x5];}else{if(_0x40a526==_0xa95f80){var _0x4339a5;if(_0x52a167[0x4]=='L')_0x4339a5='Level';else _0x52a167[0x4]=='F'&&(_0x4339a5=_0x587ec0(0xe3));_0x2a160b[_0x40a526][_0x587ec0(0x14a)]=_0x52a167[0x0],_0x2a160b[_0x40a526]['rack']=_0x52a167[0x1],_0x2a160b[_0x40a526]['bay']=_0x52a167[0x2],_0x2a160b[_0x40a526][_0x587ec0(0xd0)]=_0x52a167[0x3],_0x2a160b[_0x40a526][_0x587ec0(0x17a)]=_0x4339a5,_0x2a160b[_0x40a526]['floorlevel']=_0x52a167[0x5];}}}});}),_0x75d2d6[_0x1c4ef5(0x122)]((_0x515dfd,_0x10bec8)=>{var _0x5e658f=_0x1c4ef5;_0x2a160b[_0x10bec8][_0x5e658f(0x11c)]=_0x515dfd;}),_0x52b676[_0x1c4ef5(0x122)]((_0x1a81e4,_0x1524e5)=>{var _0xac01f0=_0x1c4ef5;_0x2a160b[_0x1524e5][_0xac01f0(0x147)]=_0x1a81e4;}),_0x27851d[_0x1c4ef5(0x122)]((_0x19efdf,_0xae5e62)=>{_0x2a160b[_0xae5e62]['batch_code']=_0x19efdf;}),_0x32039d['forEach']((_0x28c8e0,_0x5a163a)=>{var _0xe8dd81=_0x1c4ef5;_0x2a160b[_0x5a163a][_0xe8dd81(0xdd)]=_0x28c8e0;}),_0x431f42[_0x1c4ef5(0x122)]((_0x112121,_0x4d89e8)=>{_0x2a160b[_0x4d89e8]['maxperunit']=_0x112121;}),_0x59a1c3[_0x1c4ef5(0x122)]((_0x50ceb5,_0x1319b4)=>{var _0x47557a=_0x1c4ef5;_0x2a160b[_0x1319b4][_0x47557a(0x190)]=_0x50ceb5;}),_0x65efe2[_0x1c4ef5(0x122)]((_0x1e99b3,_0x37495c)=>{_0x2a160b[_0x37495c]['requested_qty']=_0x1e99b3;}),_0x168ed6['forEach']((_0x22ab6e,_0x597cb7)=>{var _0x3e87a3=_0x1c4ef5;_0x2a160b[_0x597cb7][_0x3e87a3(0x100)]=_0x22ab6e;}),_0x394e4e[_0x1c4ef5(0x122)]((_0x208b11,_0x612a3)=>{var _0x52765b=_0x1c4ef5;_0x2a160b[_0x612a3][_0x52765b(0xbe)]=_0x208b11;}),_0x385e68[_0x1c4ef5(0x122)]((_0x94c09b,_0x3335b8)=>{var _0x37a82b=_0x1c4ef5;_0x2a160b[_0x3335b8][_0x37a82b(0xc0)]=_0x94c09b;}),_0x1e2b5d[_0x1c4ef5(0x122)]((_0xf54fbe,_0x1828e7)=>{var _0x22843c=_0x1c4ef5;_0x2a160b[_0x1828e7][_0x22843c(0xeb)]=_0xf54fbe;}),_0x3c06cf[_0x1c4ef5(0x122)]((_0x3a8629,_0x5f9d2c)=>{var _0x42fbb8=_0x1c4ef5;_0x2a160b[_0x5f9d2c][_0x42fbb8(0xce)]=_0x3a8629;}),_0x194f9c[_0x1c4ef5(0x122)]((_0x10284a,_0xc0badb)=>{var _0x7a14a1=_0x1c4ef5;_0x2a160b[_0xc0badb][_0x7a14a1(0x96)]=_0x10284a;});var _0x3b887f=0x0;_0x2a160b['forEach'](_0x1a58e1=>{var _0x253e68=_0x1c4ef5;(_0x1a58e1[_0x253e68(0x109)]<_0x1a58e1[_0x253e68(0xeb)]||_0x1a58e1[_0x253e68(0xeb)]==0x0)&&(console[_0x253e68(0xb2)](_0x253e68(0x93),_0x1a58e1),_0x3b887f++);});const _0xc6c13b=_0x2a160b[_0x1c4ef5(0x144)](_0x44f8ad=>_0x44f8ad['quantity']!=='0'&&_0x44f8ad[_0x1c4ef5(0x110)]!==''),_0xbb8f7b=new sales({'invoice':_0x3f051f,'customer':_0x4a5983['body'][_0x1c4ef5(0xd3)],'date':_0x28ff1e,'warehouse_name':_0x7cf805,'sale_product':_0xc6c13b,'note':_0x51a67a,'room':_0x211284,'primary_code':_0x4e10c3,'secondary_code':_0x54075b,'prod_code':_0x27745a,'SCRN':_0x3598dd}),_0x2a5904=await _0xbb8f7b[_0x1c4ef5(0x114)]();_0x4a5983[_0x1c4ef5(0x177)](_0x1c4ef5(0x156),_0x1c4ef5(0xbd)),_0x207eaa['redirect']('/all_sales/preview/'+_0x2a5904[_0x1c4ef5(0x188)]);}catch(_0x3af046){console[_0x1c4ef5(0xb2)](_0x3af046);}}),router[a0_0x1955c6(0x129)](a0_0x1955c6(0x187),auth,async(_0x2c2cd5,_0x5942af)=>{var _0x178dbd=a0_0x1955c6;try{const {username:_0x3be920,email:_0x3df294,role:_0x497f48}=_0x2c2cd5[_0x178dbd(0xe9)],_0x6934be=_0x2c2cd5[_0x178dbd(0xe9)],_0x5832d2=await profile[_0x178dbd(0x12f)]({'email':_0x6934be[_0x178dbd(0xf9)]}),_0x4e6a4e=await master_shop['find'](),_0x19f890=_0x2c2cd5[_0x178dbd(0x15b)]['id'],_0x3aff22=await sales[_0x178dbd(0xe1)](_0x19f890),_0x43625e=await warehouse['aggregate']([{'$match':{'name':_0x3aff22[_0x178dbd(0xd7)]}},{'$unwind':_0x178dbd(0x91)},{'$group':{'_id':_0x178dbd(0x172),'name':{'$first':_0x178dbd(0xf5)},'product_stock':{'$first':_0x178dbd(0x121)},'bay':{'$first':_0x178dbd(0x105)},'bin':{'$first':_0x178dbd(0xb7)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x178dbd(0x184)},'secondary_code':{'$first':_0x178dbd(0x183)},'product_code':{'$first':_0x178dbd(0x8b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x178dbd(0x161)},'expiry_date':{'$first':_0x178dbd(0x155)},'production_date':{'$first':_0x178dbd(0x15f)}}}]),_0x403557=await customer[_0x178dbd(0x15e)]({});let _0x30a931;if(_0x6934be[_0x178dbd(0x132)]=='staff'){const _0x4716c4=await staff[_0x178dbd(0x12f)]({'email':_0x6934be[_0x178dbd(0xf9)]});_0x30a931=await warehouse[_0x178dbd(0x145)]([{'$match':{'status':_0x178dbd(0x11a),'name':_0x4716c4['warehouse']}},{'$group':{'_id':_0x178dbd(0x98),'name':{'$first':_0x178dbd(0x98)}}}]);}else _0x30a931=await warehouse[_0x178dbd(0x145)]([{'$match':{'status':_0x178dbd(0x11a)}},{'$group':{'_id':_0x178dbd(0x98),'name':{'$first':_0x178dbd(0x98)}}}]);const _0x37f4bf=await product[_0x178dbd(0x15e)]({}),_0x585b88=await suppliers[_0x178dbd(0x15e)]({});if(_0x4e6a4e[0x0]['language']==_0x178dbd(0x117)){var _0x55a0d7=users[_0x178dbd(0xfd)];console['log'](_0x55a0d7);}else{if(_0x4e6a4e[0x0][_0x178dbd(0x137)]=='Hindi')var _0x55a0d7=users['Hindi'];else{if(_0x4e6a4e[0x0]['language']==_0x178dbd(0x169))var _0x55a0d7=users[_0x178dbd(0x169)];else{if(_0x4e6a4e[0x0]['language']==_0x178dbd(0xa5))var _0x55a0d7=users[_0x178dbd(0xa5)];else{if(_0x4e6a4e[0x0][_0x178dbd(0x137)]==_0x178dbd(0x149))var _0x55a0d7=users[_0x178dbd(0x149)];else{if(_0x4e6a4e[0x0][_0x178dbd(0x137)]==_0x178dbd(0xbc))var _0x55a0d7=users[_0x178dbd(0xc5)];else{if(_0x4e6a4e[0x0][_0x178dbd(0x137)]=='Chinese')var _0x55a0d7=users[_0x178dbd(0x8e)];else{if(_0x4e6a4e[0x0][_0x178dbd(0x137)]=='Arabic\x20(ae)')var _0x55a0d7=users[_0x178dbd(0x12d)];}}}}}}}_0x5942af[_0x178dbd(0x13e)](_0x178dbd(0xd2),{'success':_0x2c2cd5[_0x178dbd(0x177)](_0x178dbd(0x156)),'errors':_0x2c2cd5[_0x178dbd(0x177)](_0x178dbd(0x108)),'role':_0x6934be,'profile':_0x5832d2,'customer':_0x403557,'warehouse':_0x30a931,'product':_0x43625e,'user':_0x3aff22,'master_shop':_0x4e6a4e,'unit':_0x37f4bf,'language':_0x55a0d7,'suppliers':_0x585b88});}catch(_0x46f067){console[_0x178dbd(0xb2)](_0x46f067);}}),router[a0_0x1955c6(0x168)]('/preview/:id',auth,async(_0x582992,_0x2b0777)=>{var _0xdd1711=a0_0x1955c6;try{const _0x4a1726=_0x582992[_0xdd1711(0x15b)]['id'],{invoice:_0x222ce0,warehouse_name:_0x3112d7,room:_0x4b1248}=_0x582992[_0xdd1711(0x17c)],_0x13d421=await sales[_0xdd1711(0x12f)]({'invoice':_0x222ce0}),_0x1e3530=_0x13d421[_0xdd1711(0xaf)]['map'](async _0x52e60c=>{var _0x49c803=_0xdd1711,_0x2488e7=await warehouse[_0x49c803(0x12f)]({'name':_0x3112d7,'room':_0x52e60c['room_name'],'warehouse_category':'Raw\x20Materials'});const _0x5adecd=_0x2488e7[_0x49c803(0x97)][_0x49c803(0xf3)](_0x473b14=>{var _0x3b3d66=_0x49c803;_0x473b14[_0x3b3d66(0x11d)]==_0x52e60c[_0x3b3d66(0x11d)]&&_0x473b14['floorlevel']==_0x52e60c[_0x3b3d66(0xe8)]&&_0x473b14[_0x3b3d66(0x17a)]==_0x52e60c[_0x3b3d66(0x17a)]&&_0x473b14['bin']==_0x52e60c[_0x3b3d66(0xd0)]&&_0x473b14['bay']==_0x52e60c[_0x3b3d66(0x16a)]&&_0x473b14[_0x3b3d66(0xaa)]==_0x52e60c[_0x3b3d66(0xaa)]&&_0x473b14['storage']==_0x52e60c[_0x3b3d66(0x14a)]&&_0x473b14[_0x3b3d66(0xdd)]==_0x52e60c[_0x3b3d66(0xdd)]&&_0x473b14[_0x3b3d66(0xba)]==_0x52e60c[_0x3b3d66(0xba)]&&_0x473b14['invoice']==_0x52e60c[_0x3b3d66(0x96)]&&(_0x473b14[_0x3b3d66(0x165)]=_0x473b14[_0x3b3d66(0x165)]-_0x52e60c['quantity']);});return _0x2488e7;});Promise[_0xdd1711(0x12b)](_0x1e3530)[_0xdd1711(0xf7)](async _0x109dbb=>{var _0x397108=_0xdd1711;try{for(const _0xfb100b of _0x109dbb){await _0xfb100b[_0x397108(0x114)]();}_0x13d421[_0x397108(0x10a)]=_0x397108(0xdf);const _0x354b87=await _0x13d421[_0x397108(0x114)](),_0x5d81b5=await master_shop['find'](),_0x5be45a=await email_settings['findOne'](),_0x47e8f6=await supervisor_settings[_0x397108(0x15e)]();var _0x2cee59=_0x13d421['sale_product'],_0x16ecd6='',_0xda2d3c;for(_0xda2d3c in _0x2cee59){_0x16ecd6+='<tr>'+_0x397108(0x18f)+_0x2cee59[_0xda2d3c][_0x397108(0x11d)]+_0x397108(0x136)+_0x397108(0x18f)+_0x2cee59[_0xda2d3c][_0x397108(0xe2)]+_0x397108(0x136)+_0x397108(0x18f)+_0x2cee59[_0xda2d3c][_0x397108(0x110)]+_0x397108(0x136)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2cee59[_0xda2d3c]['unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2cee59[_0xda2d3c][_0x397108(0x147)]+'</td>'+_0x397108(0x18f)+_0x13d421[_0x397108(0xd7)]+_0x397108(0x136)+_0x397108(0x18f)+_0x2cee59[_0xda2d3c][_0x397108(0xce)]+'</td>'+_0x397108(0x18f)+_0x2cee59[_0xda2d3c][_0x397108(0x14a)]+_0x2cee59[_0xda2d3c]['rack']+_0x2cee59[_0xda2d3c]['bay']+_0x2cee59[_0xda2d3c][_0x397108(0xd0)]+_0x2cee59[_0xda2d3c][_0x397108(0x17a)][0x0]+_0x2cee59[_0xda2d3c][_0x397108(0xe8)]+_0x397108(0x136),'</tr>';}let _0x562577=nodemailer['createTransport']({'host':_0x5be45a[_0x397108(0x10b)],'port':Number(_0x5be45a['port']),'secure':![],'auth':{'user':_0x5be45a['email'],'pass':_0x5be45a[_0x397108(0xec)]}}),_0x4b3412={'from':_0x5be45a['email'],'to':_0x47e8f6[0x0][_0x397108(0x17f)],'subject':_0x397108(0x158),'attachments':[{'filename':'Logo.png','path':__dirname+_0x397108(0x90)+_0x397108(0x154)+_0x5d81b5[0x0]['image'],'cid':_0x397108(0x140)}],'html':_0x397108(0xda)+_0x397108(0x126)+_0x397108(0xc2)+_0x397108(0x173)+_0x397108(0x151)+_0x397108(0x173)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x397108(0x173)+_0x397108(0x178)+_0x5d81b5[0x0][_0x397108(0x119)]+_0x397108(0x12a)+_0x397108(0x10e)+_0x397108(0x10e)+_0x397108(0x14d)+_0x397108(0x173)+_0x397108(0xb4)+_0x397108(0x116)+_0x13d421[_0x397108(0x96)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x397108(0x13f)+_0x13d421['date']+'\x20'+_0x397108(0x107)+_0x397108(0x118)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x397108(0x189)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x397108(0x101)+_0x397108(0x180)+_0x397108(0xf6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x397108(0xca)+_0x397108(0xa6)+'</tr>'+_0x397108(0x153)+_0x397108(0xe5)+'\x20'+_0x16ecd6+'\x20'+'</tbody>'+_0x397108(0xb1)+_0x397108(0x173)+_0x397108(0xc7)+_0x397108(0x16c)+_0x5d81b5[0x0][_0x397108(0x119)]+_0x397108(0x118)+'</div>'+_0x397108(0x10e)+_0x397108(0x13d)};_0x562577['sendMail'](_0x4b3412,function(_0x10441d,_0x571b64){var _0x13627f=_0x397108;_0x10441d?(console[_0x13627f(0xb2)](_0x10441d),console[_0x13627f(0xb2)](_0x13627f(0x146))):console[_0x13627f(0xb2)]('Email\x20sent\x20successfully');}),_0x582992[_0x397108(0x177)]('success',_0x397108(0x8f)),_0x2b0777[_0x397108(0xb8)](_0x397108(0x14c)+_0x4a1726);}catch(_0x383816){console[_0x397108(0x15a)](_0x383816),_0x2b0777[_0x397108(0x11f)](0x1f4)[_0x397108(0xc6)]({'error':_0x397108(0x94)});}})[_0xdd1711(0x12e)](_0x1d77e3=>{var _0x51ed11=_0xdd1711;console[_0x51ed11(0x15a)](_0x1d77e3),_0x2b0777['status'](0x1f4)[_0x51ed11(0xc6)]({'error':'An\x20error\x20occurred.'});});}catch(_0x494c42){console[_0xdd1711(0xb2)](_0x494c42);}}),router[a0_0x1955c6(0x129)](a0_0x1955c6(0x95),auth,async(_0x14b2f9,_0x5330dc)=>{var _0x4ebf4f=a0_0x1955c6;try{const {username:_0x59f886,email:_0x5c15d0,role:_0x14feb8}=_0x14b2f9['user'],_0x416d33=_0x14b2f9['user'],_0x3b3160=await profile['findOne']({'email':_0x416d33['email']}),_0x1e3897=await master_shop[_0x4ebf4f(0x15e)](),_0x543fad=_0x14b2f9['params']['id'],_0x3ef43d=await sales[_0x4ebf4f(0xe1)](_0x543fad);var _0x341f0a=[_0x4ebf4f(0xf1),_0x4ebf4f(0xcd)];const _0x585b44=await warehouse[_0x4ebf4f(0x145)]([{'$match':{'name':_0x3ef43d[_0x4ebf4f(0xd7)],'warehouse_category':_0x4ebf4f(0x130)}},{'$unwind':_0x4ebf4f(0x91)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4ebf4f(0xf5)},'product_stock':{'$first':_0x4ebf4f(0x121)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4ebf4f(0xb6)},'floorlevel':{'$first':_0x4ebf4f(0x131)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4ebf4f(0x183)},'product_code':{'$first':_0x4ebf4f(0x8b)},'storage':{'$first':_0x4ebf4f(0xd5)},'rack':{'$first':_0x4ebf4f(0x161)}}}]),_0x3f9f1f=await customer['find']({});let _0x1bf88e;if(_0x416d33[_0x4ebf4f(0x132)]=='staff'){const _0x4ddbb5=await staff[_0x4ebf4f(0x12f)]({'email':_0x416d33[_0x4ebf4f(0xf9)]});_0x1bf88e=await warehouse[_0x4ebf4f(0x145)]([{'$match':{'status':_0x4ebf4f(0x11a),'name':_0x4ddbb5[_0x4ebf4f(0xa1)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x4ebf4f(0x98)}}}]);}else _0x1bf88e=await warehouse[_0x4ebf4f(0x145)]([{'$match':{'status':_0x4ebf4f(0x11a),'warehouse_category':_0x4ebf4f(0x130)}},{'$group':{'_id':'$name','name':{'$first':_0x4ebf4f(0x98)}}}]);const _0x52d0de=await product[_0x4ebf4f(0x15e)]({});if(_0x1e3897[0x0][_0x4ebf4f(0x137)]==_0x4ebf4f(0x117)){var _0x5e7af9=users['English'];console[_0x4ebf4f(0xb2)](_0x5e7af9);}else{if(_0x1e3897[0x0][_0x4ebf4f(0x137)]==_0x4ebf4f(0x16b))var _0x5e7af9=users[_0x4ebf4f(0x16b)];else{if(_0x1e3897[0x0]['language']==_0x4ebf4f(0x169))var _0x5e7af9=users[_0x4ebf4f(0x169)];else{if(_0x1e3897[0x0][_0x4ebf4f(0x137)]=='Spanish')var _0x5e7af9=users['Spanish'];else{if(_0x1e3897[0x0]['language']==_0x4ebf4f(0x149))var _0x5e7af9=users['French'];else{if(_0x1e3897[0x0]['language']=='Portuguese\x20(BR)')var _0x5e7af9=users['Portuguese'];else{if(_0x1e3897[0x0]['language']=='Chinese')var _0x5e7af9=users['Chinese'];else{if(_0x1e3897[0x0][_0x4ebf4f(0x137)]==_0x4ebf4f(0x174))var _0x5e7af9=users[_0x4ebf4f(0x12d)];}}}}}}}_0x5330dc[_0x4ebf4f(0x13e)]('edit_sales',{'success':_0x14b2f9[_0x4ebf4f(0x177)]('success'),'errors':_0x14b2f9['flash'](_0x4ebf4f(0x108)),'role':_0x416d33,'profile':_0x3b3160,'customer':_0x3f9f1f,'warehouse':_0x1bf88e,'product':_0x585b44,'user':_0x3ef43d,'master_shop':_0x1e3897,'unit':_0x52d0de,'language':_0x5e7af9});}catch(_0x2061eb){console[_0x4ebf4f(0xb2)](_0x2061eb);}}),router[a0_0x1955c6(0x168)](a0_0x1955c6(0x95),auth,async(_0x5730b9,_0x4305ce)=>{var _0x41bfec=a0_0x1955c6;try{const _0x32b8b9=_0x5730b9[_0x41bfec(0x15b)]['id'],_0xb563bd=await sales[_0x41bfec(0x12f)]({'_id':_0x5730b9[_0x41bfec(0x15b)]['id']}),_0x44379a=await warehouse[_0x41bfec(0x12f)]({'name':_0xb563bd['warehouse_name'],'room':_0x5730b9[_0x41bfec(0x17c)]['room']}),{invoice:_0x3cc055,date:_0x407104,warehouse_name:_0x2a70a5,product_name:_0x24a4b8,stock:_0x3a228c,quantity:_0x554432,note:_0x2172b2,room:_0x2d6ac3,customer:_0x1fe93e,SCRN:_0x5bf171}=_0x5730b9[_0x41bfec(0x17c)];if(typeof _0x24a4b8==_0x41bfec(0x138))var _0x5a6532=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x11d)]],_0x79b8e0=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x109)]],_0x4c5c1d=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x16f)]],_0x4f8aea=[_0x5730b9[_0x41bfec(0x17c)]['primary_code']],_0x4ae6dd=[_0x5730b9['body'][_0x41bfec(0x9d)]],_0x1eeb49=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x18b)]],_0x2a37b0=[_0x5730b9[_0x41bfec(0x17c)]['level']],_0x36ec2e=[_0x5730b9['body'][_0x41bfec(0x157)]],_0x335436=[_0x5730b9[_0x41bfec(0x17c)]['secondary_unit']],_0x4ec878=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0xba)]],_0x5df658=[_0x5730b9['body']['expiry_date']],_0x3234d5=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x10d)]],_0x15afc8=[_0x5730b9[_0x41bfec(0x17c)]['production_date']],_0x30ac8b=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0xf0)]],_0x1e8725=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x100)]],_0x494e26=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0xbe)]],_0xc401f7=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0xc0)]],_0x5e912f=[_0x5730b9[_0x41bfec(0x17c)]['quantity']],_0x32f0e1=[_0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x104)]];else var _0x5a6532=[..._0x5730b9[_0x41bfec(0x17c)]['product_name']],_0x79b8e0=[..._0x5730b9['body'][_0x41bfec(0x109)]],_0x4c5c1d=[..._0x5730b9[_0x41bfec(0x17c)]['carton']],_0x4f8aea=[..._0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x9c)]],_0x4ae6dd=[..._0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x9d)]],_0x1eeb49=[..._0x5730b9[_0x41bfec(0x17c)]['prod_code']],_0x2a37b0=[..._0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x124)]],_0x36ec2e=[..._0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x157)]],_0x335436=[..._0x5730b9['body'][_0x41bfec(0x147)]],_0x4ec878=[..._0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0xba)]],_0x5df658=[..._0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0xdd)]],_0x3234d5=[..._0x5730b9['body'][_0x41bfec(0x10d)]],_0x15afc8=[..._0x5730b9['body'][_0x41bfec(0x190)]],_0x30ac8b=[..._0x5730b9[_0x41bfec(0x17c)]['requested_qty']],_0x1e8725=[..._0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x100)]],_0x494e26=[..._0x5730b9[_0x41bfec(0x17c)]['delivery_code']],_0xc401f7=[..._0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0xc0)]],_0x5e912f=[..._0x5730b9[_0x41bfec(0x17c)][_0x41bfec(0x110)]],_0x32f0e1=[..._0x5730b9[_0x41bfec(0x17c)]['RoomAssigned']];const _0x82d39d=_0x5a6532[_0x41bfec(0xf3)](_0x37702e=>{return _0x37702e={'product_name':_0x37702e};});_0x79b8e0[_0x41bfec(0x122)]((_0x3c40d8,_0x13bf98)=>{var _0x40bc0f=_0x41bfec;_0x82d39d[_0x13bf98][_0x40bc0f(0x109)]=_0x3c40d8;}),_0x4c5c1d[_0x41bfec(0x122)]((_0xdae9fd,_0x265e97)=>{var _0x49f7c1=_0x41bfec;_0x82d39d[_0x265e97][_0x49f7c1(0x110)]=_0xdae9fd;}),_0x4f8aea[_0x41bfec(0x122)]((_0x58e899,_0x1fe2c1)=>{_0x82d39d[_0x1fe2c1]['primary_code']=_0x58e899;}),_0x4ae6dd[_0x41bfec(0x122)]((_0x247e97,_0xc36eb0)=>{var _0x242ecb=_0x41bfec;_0x82d39d[_0xc36eb0][_0x242ecb(0x9d)]=_0x247e97;}),_0x1eeb49[_0x41bfec(0x122)]((_0x16ba0f,_0x561181)=>{_0x82d39d[_0x561181]['product_code']=_0x16ba0f;}),_0x2a37b0[_0x41bfec(0x122)]((_0x5f2894,_0x2e8580)=>{var _0x1110cd=_0x41bfec;_0x32f0e1[_0x1110cd(0x122)]((_0x5ce8c9,_0x5c4f2c)=>{var _0xd41cd7=_0x1110cd;if(_0x5ce8c9=='Receiving\x20Area'&&_0x2e8580==_0x5c4f2c){var _0x1226d8=_0x5f2894[_0xd41cd7(0xa4)](0x3);_0x82d39d[_0x2e8580][_0xd41cd7(0x14a)]=_0x5f2894[0x0],_0x82d39d[_0x2e8580][_0xd41cd7(0xaa)]=_0x5f2894[0x1],_0x82d39d[_0x2e8580]['bay']=0x0,_0x82d39d[_0x2e8580][_0xd41cd7(0xd0)]=0x0,_0x82d39d[_0x2e8580][_0xd41cd7(0x17a)]=_0xd41cd7(0xe3),_0x82d39d[_0x2e8580][_0xd41cd7(0xe8)]=_0x1226d8;}else{if(_0x5ce8c9=='Shelves'&&_0x2e8580==_0x5c4f2c){var _0x1226d8=_0x5f2894[_0xd41cd7(0xa4)](0x3);_0x82d39d[_0x2e8580][_0xd41cd7(0x14a)]=_0x5f2894[0x0],_0x82d39d[_0x2e8580][_0xd41cd7(0xaa)]=_0x5f2894[0x1],_0x82d39d[_0x2e8580][_0xd41cd7(0x16a)]=0x0,_0x82d39d[_0x2e8580][_0xd41cd7(0xd0)]=0x0,_0x82d39d[_0x2e8580][_0xd41cd7(0x17a)]=_0xd41cd7(0xe3),_0x82d39d[_0x2e8580][_0xd41cd7(0xe8)]=_0x5f2894[0x5];}else{if(_0x2e8580==_0x5c4f2c){var _0x281be1;if(_0x5f2894[0x4]=='L')_0x281be1=_0xd41cd7(0x15c);else _0x5f2894[0x4]=='F'&&(_0x281be1=_0xd41cd7(0xe3));_0x82d39d[_0x2e8580]['storage']=_0x5f2894[0x0],_0x82d39d[_0x2e8580][_0xd41cd7(0xaa)]=_0x5f2894[0x1],_0x82d39d[_0x2e8580][_0xd41cd7(0x16a)]=_0x5f2894[0x2],_0x82d39d[_0x2e8580][_0xd41cd7(0xd0)]=_0x5f2894[0x3],_0x82d39d[_0x2e8580][_0xd41cd7(0x17a)]=_0x281be1,_0x82d39d[_0x2e8580][_0xd41cd7(0xe8)]=_0x5f2894[0x5];}}}});}),_0x36ec2e[_0x41bfec(0x122)]((_0x49d0c9,_0x3c144d)=>{var _0x28f4be=_0x41bfec;_0x82d39d[_0x3c144d][_0x28f4be(0x11c)]=_0x49d0c9;}),_0x335436[_0x41bfec(0x122)]((_0x547761,_0x102ae9)=>{var _0x39df5b=_0x41bfec;_0x82d39d[_0x102ae9][_0x39df5b(0x147)]=_0x547761;}),_0x4ec878[_0x41bfec(0x122)]((_0x242fd6,_0x24ffd3)=>{_0x82d39d[_0x24ffd3]['batch_code']=_0x242fd6;}),_0x5df658[_0x41bfec(0x122)]((_0x1f1f2c,_0x52112c)=>{var _0x5ad71f=_0x41bfec;_0x82d39d[_0x52112c][_0x5ad71f(0xdd)]=_0x1f1f2c;}),_0x3234d5[_0x41bfec(0x122)]((_0x2b90a6,_0x1b7071)=>{var _0xacd4d5=_0x41bfec;_0x82d39d[_0x1b7071][_0xacd4d5(0x17d)]=_0x2b90a6;}),_0x15afc8['forEach']((_0x2d95a3,_0x5f1487)=>{var _0x2c46ae=_0x41bfec;_0x82d39d[_0x5f1487][_0x2c46ae(0x190)]=_0x2d95a3;}),_0x30ac8b[_0x41bfec(0x122)]((_0x5a3461,_0x4e868b)=>{_0x82d39d[_0x4e868b]['requested_qty']=_0x5a3461;}),_0x1e8725[_0x41bfec(0x122)]((_0x55b71f,_0x27cfa6)=>{var _0x40eb96=_0x41bfec;_0x82d39d[_0x27cfa6][_0x40eb96(0x100)]=_0x55b71f;}),_0x494e26[_0x41bfec(0x122)]((_0x940755,_0x4d8ecf)=>{_0x82d39d[_0x4d8ecf]['delivery_code']=_0x940755;}),_0xc401f7['forEach']((_0x46cd0c,_0x3311c3)=>{var _0x2490c7=_0x41bfec;_0x82d39d[_0x3311c3][_0x2490c7(0xc0)]=_0x46cd0c;}),_0x5e912f[_0x41bfec(0x122)]((_0x4ab21c,_0x380e76)=>{var _0x363dc0=_0x41bfec;_0x82d39d[_0x380e76][_0x363dc0(0xeb)]=_0x4ab21c;}),_0x32f0e1[_0x41bfec(0x122)]((_0x37e29f,_0x46469d)=>{_0x82d39d[_0x46469d]['room_name']=_0x37e29f;});var _0x44520e=0x0;_0x82d39d[_0x41bfec(0x122)](_0x1dd250=>{var _0x1126f9=_0x41bfec;console[_0x1126f9(0xb2)](_0x1126f9(0x93),_0x1dd250),(parseInt(_0x1dd250[_0x1126f9(0x109)])<parseInt(_0x1dd250[_0x1126f9(0x110)])||parseInt(_0x1dd250[_0x1126f9(0x110)])==0x0)&&_0x44520e++;});if(_0x44520e!=0x0)return _0x5730b9[_0x41bfec(0x177)]('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x4305ce[_0x41bfec(0xb8)](_0x41bfec(0xb5));const _0x27aab7=_0x82d39d[_0x41bfec(0x144)](_0x146a1b=>_0x146a1b[_0x41bfec(0x110)]!=='0'&&_0x146a1b[_0x41bfec(0x110)]!=='');_0xb563bd[_0x41bfec(0x96)]=_0x3cc055,_0xb563bd[_0x41bfec(0xd3)]=_0x1fe93e,_0xb563bd[_0x41bfec(0x16d)]=_0x407104,_0xb563bd['warehouse_name']=_0x2a70a5,_0xb563bd[_0x41bfec(0xaf)]=_0x27aab7,_0xb563bd[_0x41bfec(0xc4)]=_0x2172b2,_0xb563bd[_0x41bfec(0x92)]=_0x5bf171,_0xb563bd[_0x41bfec(0x10a)]=_0x41bfec(0x133),_0xb563bd[_0x41bfec(0xe0)]=_0x41bfec(0x133);const _0x442ad=await _0xb563bd[_0x41bfec(0x114)]();_0x5730b9[_0x41bfec(0x177)](_0x41bfec(0x156),_0x41bfec(0x8f)),_0x4305ce['redirect'](_0x41bfec(0xb9));}catch(_0x92accc){console[_0x41bfec(0xb2)](_0x92accc);}}),router[a0_0x1955c6(0x168)](a0_0x1955c6(0x8d),auth,async(_0x2b0b19,_0x50e6fe)=>{var _0x10893e=a0_0x1955c6;try{const _0x5dedd8=_0x2b0b19[_0x10893e(0x15b)]['id'],{invoice:_0x29c5dd,customer:_0x5b0d02,receivable_amount:_0x55ec01,received_amount:_0x40f9fd}=_0x2b0b19[_0x10893e(0x17c)],_0x30ca8c=await sales[_0x10893e(0xe1)](_0x5dedd8);console[_0x10893e(0xb2)](_0x30ca8c);var _0x4255d6=_0x55ec01-_0x40f9fd;console[_0x10893e(0xb2)](_0x40f9fd),_0x30ca8c[_0x10893e(0xae)]=parseFloat(_0x40f9fd)+parseFloat(_0x30ca8c['received_amount']),_0x30ca8c[_0x10893e(0x128)]=_0x4255d6,console[_0x10893e(0xb2)](_0x30ca8c);const _0x512674=await _0x30ca8c[_0x10893e(0x114)](),_0x75b7cd=await c_payment_data[_0x10893e(0x12f)]({'invoice':_0x29c5dd});_0x75b7cd[_0x10893e(0x142)]=_0x4255d6,await _0x75b7cd[_0x10893e(0x114)]();let _0x3086fa=new Date(),_0x25afec=('0'+_0x3086fa[_0x10893e(0xac)]())[_0x10893e(0xa4)](-0x2),_0x491360=('0'+(_0x3086fa[_0x10893e(0x185)]()+0x1))['slice'](-0x2),_0x40b3ce=_0x3086fa[_0x10893e(0x141)](),_0x51fb5b=_0x40b3ce+'-'+_0x491360+'-'+_0x25afec;const _0x228767=new customer_payment({'invoice':_0x29c5dd,'date':_0x40b3ce+'-'+_0x491360+'-'+_0x25afec,'customer':_0x5b0d02,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x40f9fd}),_0x1fbbbf=await _0x228767[_0x10893e(0x114)]();_0x2b0b19[_0x10893e(0x177)](_0x10893e(0x156),'payment\x20successfull'),_0x50e6fe[_0x10893e(0xb8)](_0x10893e(0xb9));}catch(_0x26bcfb){console[_0x10893e(0xb2)](_0x26bcfb);}}),router[a0_0x1955c6(0x129)](a0_0x1955c6(0x11b),auth,async(_0x1e45ab,_0x428390)=>{var _0x3c4b29=a0_0x1955c6;try{const {username:_0x4feab8,email:_0x139a6a,role:_0x2923f5}=_0x1e45ab[_0x3c4b29(0xe9)],_0x1863ee=_0x1e45ab[_0x3c4b29(0xe9)],_0x3ba4e5=await profile['findOne']({'email':_0x1863ee[_0x3c4b29(0xf9)]}),_0x241e01=await master_shop[_0x3c4b29(0x15e)]();console['log'](_0x3c4b29(0x16e),_0x241e01);const _0x26b1c4=_0x1e45ab[_0x3c4b29(0x15b)]['id'],_0x5ed796=await sales[_0x3c4b29(0xe1)](_0x26b1c4);console[_0x3c4b29(0xb2)](_0x5ed796);const _0x489c17=await customer[_0x3c4b29(0x12f)]({'name':_0x5ed796[_0x3c4b29(0xd3)]});console['log'](_0x489c17);if(_0x241e01[0x0][_0x3c4b29(0x137)]==_0x3c4b29(0x117)){var _0x299d4e=users[_0x3c4b29(0xfd)];console[_0x3c4b29(0xb2)](_0x299d4e);}else{if(_0x241e01[0x0][_0x3c4b29(0x137)]==_0x3c4b29(0x16b))var _0x299d4e=users[_0x3c4b29(0x16b)];else{if(_0x241e01[0x0][_0x3c4b29(0x137)]==_0x3c4b29(0x169))var _0x299d4e=users[_0x3c4b29(0x169)];else{if(_0x241e01[0x0][_0x3c4b29(0x137)]=='Spanish')var _0x299d4e=users['Spanish'];else{if(_0x241e01[0x0][_0x3c4b29(0x137)]==_0x3c4b29(0x149))var _0x299d4e=users['French'];else{if(_0x241e01[0x0][_0x3c4b29(0x137)]==_0x3c4b29(0xbc))var _0x299d4e=users[_0x3c4b29(0xc5)];else{if(_0x241e01[0x0]['language']==_0x3c4b29(0x8e))var _0x299d4e=users[_0x3c4b29(0x8e)];else{if(_0x241e01[0x0][_0x3c4b29(0x137)]==_0x3c4b29(0x174))var _0x299d4e=users[_0x3c4b29(0x12d)];}}}}}}}_0x428390[_0x3c4b29(0x13e)](_0x3c4b29(0xff),{'success':_0x1e45ab['flash'](_0x3c4b29(0x156)),'errors':_0x1e45ab[_0x3c4b29(0x177)](_0x3c4b29(0x108)),'role':_0x1863ee,'profile':_0x3ba4e5,'master_shop':_0x241e01,'customers':_0x489c17,'sales':_0x5ed796,'language':_0x299d4e});}catch(_0x146b7b){console['log'](_0x146b7b);}}),router[a0_0x1955c6(0x129)](a0_0x1955c6(0x13a),auth,async(_0x1044c7,_0x2bce53)=>{var _0x3f6a36=a0_0x1955c6;try{const {username:_0x2ee8bb,email:_0x5098a3,role:_0x43364c}=_0x1044c7[_0x3f6a36(0xe9)],_0x2e708e=_0x1044c7['user'],_0x49bbc1=await profile[_0x3f6a36(0x12f)]({'email':_0x2e708e['email']}),_0x54600e=await master_shop['find']();console['log']('master',_0x54600e);const _0x4089e6=_0x1044c7['params']['id'];console['log'](_0x4089e6);const _0x2efe74=await sales['findById'](_0x4089e6);console[_0x3f6a36(0xb2)]('user_id',_0x2efe74);const _0x259273=await warehouse[_0x3f6a36(0x145)]([{'$match':{'name':_0x3f6a36(0xa3),'room':'Return\x20Rooms'}},{'$unwind':_0x3f6a36(0x91)},{'$group':{'_id':_0x3f6a36(0x172),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3f6a36(0x121)},'level':{'$first':_0x3f6a36(0x115)},'isle':{'$first':_0x3f6a36(0xed)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x3f6a36(0x184)},'secondary_code':{'$first':_0x3f6a36(0x183)},'product_code':{'$first':_0x3f6a36(0x8b)}}}]);console['log'](_0x3f6a36(0xea),_0x259273);const _0x33cc39=await product['find']({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x3f6a36(0x11a),'name':_0x3f6a36(0xa3),'warehouse_category':_0x3f6a36(0x130)}},{'$group':{'_id':_0x3f6a36(0x98),'name':{'$first':_0x3f6a36(0x98)}}},{'$sort':{'name':0x1}}]);var _0x4a6ca9=[_0x3f6a36(0x112)];if(_0x54600e[0x0]['language']=='English\x20(US)'){var _0x1220df=users['English'];console[_0x3f6a36(0xb2)](_0x1220df);}else{if(_0x54600e[0x0][_0x3f6a36(0x137)]==_0x3f6a36(0x16b))var _0x1220df=users[_0x3f6a36(0x16b)];else{if(_0x54600e[0x0][_0x3f6a36(0x137)]==_0x3f6a36(0x169))var _0x1220df=users['German'];else{if(_0x54600e[0x0][_0x3f6a36(0x137)]==_0x3f6a36(0xa5))var _0x1220df=users[_0x3f6a36(0xa5)];else{if(_0x54600e[0x0][_0x3f6a36(0x137)]==_0x3f6a36(0x149))var _0x1220df=users['French'];else{if(_0x54600e[0x0][_0x3f6a36(0x137)]==_0x3f6a36(0xbc))var _0x1220df=users[_0x3f6a36(0xc5)];else{if(_0x54600e[0x0][_0x3f6a36(0x137)]==_0x3f6a36(0x8e))var _0x1220df=users[_0x3f6a36(0x8e)];else{if(_0x54600e[0x0][_0x3f6a36(0x137)]==_0x3f6a36(0x174))var _0x1220df=users[_0x3f6a36(0x12d)];}}}}}}}_0x2bce53['render']('return_sale',{'success':_0x1044c7[_0x3f6a36(0x177)](_0x3f6a36(0x156)),'errors':_0x1044c7[_0x3f6a36(0x177)](_0x3f6a36(0x108)),'role':_0x2e708e,'profile':_0x49bbc1,'user':_0x2efe74,'stock':_0x259273,'master_shop':_0x54600e,'unit':_0x33cc39,'language':_0x1220df,'warehouses':warehouse_data,'rooms':_0x4a6ca9});}catch(_0x1b63c3){console[_0x3f6a36(0xb2)](_0x1b63c3),_0x2bce53[_0x3f6a36(0x11f)](0xc8)['json']({'message':_0x1b63c3['message']});}}),router[a0_0x1955c6(0x168)](a0_0x1955c6(0x13a),auth,async(_0x238fd3,_0x3cd059)=>{var _0x469576=a0_0x1955c6;try{const {invoice:_0x5d571c,date:_0x6831d7,warehouse_name:_0x480253,product_name:_0x255366,primary_code:_0x1e3e5a,secondary_code:_0xb8c03,product_code:_0x51cc48,sales_quantity:_0x1d5686,stocks:_0x267dae,return_qty:_0x35991a,Room_name:_0x1150c6,to_warehouse_name:_0x2fd6a3,to_Roomname:_0x3a05e2,to_Room_name:_0x293811,note:_0x248123,level:_0x44dc87,isle:_0x440c62,pallet:_0x50f7ea}=_0x238fd3[_0x469576(0x17c)];if(typeof _0x255366==_0x469576(0x138))var _0x1e9b72=[_0x238fd3[_0x469576(0x17c)][_0x469576(0x11d)]],_0x82f4ed=[_0x238fd3[_0x469576(0x17c)]['primary_code']],_0x42856c=[_0x238fd3['body'][_0x469576(0x9d)]],_0x37b1f4=[_0x238fd3['body'][_0x469576(0xe2)]],_0x3145b8=[_0x238fd3[_0x469576(0x17c)][_0x469576(0xdc)]],_0x51c8f1=[_0x238fd3['body'][_0x469576(0xc3)]],_0x4c8998=[_0x238fd3[_0x469576(0x17c)][_0x469576(0xbf)]],_0xa816e7=[_0x238fd3[_0x469576(0x17c)]['bay']],_0x525093=[_0x238fd3['body'][_0x469576(0xd0)]],_0x199aef=[_0x238fd3[_0x469576(0x17c)][_0x469576(0x9a)]],_0x22f6b1=[_0x238fd3['body'][_0x469576(0xe8)]];else var _0x1e9b72=[..._0x238fd3['body']['product_name']],_0x82f4ed=[..._0x238fd3['body'][_0x469576(0x9c)]],_0x42856c=[..._0x238fd3['body'][_0x469576(0x9d)]],_0x37b1f4=[..._0x238fd3['body'][_0x469576(0xe2)]],_0x3145b8=[..._0x238fd3[_0x469576(0x17c)][_0x469576(0xdc)]],_0x51c8f1=[..._0x238fd3[_0x469576(0x17c)]['stocks']],_0x4c8998=[..._0x238fd3[_0x469576(0x17c)][_0x469576(0xbf)]],_0xa816e7=[..._0x238fd3[_0x469576(0x17c)][_0x469576(0x16a)]],_0x525093=[..._0x238fd3[_0x469576(0x17c)][_0x469576(0xd0)]],_0x199aef=[..._0x238fd3[_0x469576(0x17c)][_0x469576(0x9a)]],_0x22f6b1=[..._0x238fd3[_0x469576(0x17c)][_0x469576(0xe8)]];const _0x2acfe3=_0x1e9b72['map'](_0x40cfd6=>{return _0x40cfd6={'product_name':_0x40cfd6};});_0x82f4ed[_0x469576(0x122)]((_0x911ee,_0x1519dc)=>{var _0x23739a=_0x469576;_0x2acfe3[_0x1519dc][_0x23739a(0x9c)]=_0x911ee;}),_0x42856c[_0x469576(0x122)]((_0x5024ec,_0x64ea65)=>{var _0x316c27=_0x469576;_0x2acfe3[_0x64ea65][_0x316c27(0x9d)]=_0x5024ec;}),_0x37b1f4['forEach']((_0x355f37,_0x5ceeee)=>{var _0x3c250f=_0x469576;_0x2acfe3[_0x5ceeee][_0x3c250f(0xe2)]=_0x355f37;}),_0x3145b8[_0x469576(0x122)]((_0x488104,_0x506117)=>{var _0xc08252=_0x469576;_0x2acfe3[_0x506117][_0xc08252(0x175)]=_0x488104;}),_0x51c8f1[_0x469576(0x122)]((_0x1894f5,_0x3c2b1d)=>{var _0x5ee49=_0x469576;_0x2acfe3[_0x3c2b1d][_0x5ee49(0x109)]=_0x1894f5;}),_0x4c8998[_0x469576(0x122)]((_0x557d96,_0x3bfb61)=>{_0x2acfe3[_0x3bfb61]['return_qty']=_0x557d96;}),_0xa816e7[_0x469576(0x122)]((_0x94bec,_0x310bc1)=>{var _0x5dea3d=_0x469576;_0x2acfe3[_0x310bc1][_0x5dea3d(0x16a)]=_0x94bec;}),_0x525093[_0x469576(0x122)]((_0x4fe6dc,_0x41a4dd)=>{var _0x96df38=_0x469576;_0x2acfe3[_0x41a4dd][_0x96df38(0xd0)]=_0x4fe6dc;}),_0x199aef['forEach']((_0x46e664,_0x3def5f)=>{var _0x2586a2=_0x469576;_0x2acfe3[_0x3def5f][_0x2586a2(0x17a)]=_0x46e664;}),_0x22f6b1[_0x469576(0x122)]((_0x31f547,_0x18eee2)=>{var _0x4490d5=_0x469576;_0x2acfe3[_0x18eee2][_0x4490d5(0xe8)]=_0x31f547;});var _0x284c84=0x0;_0x2acfe3[_0x469576(0x122)](_0x55d68b=>{var _0x1d5784=_0x469576;console[_0x1d5784(0xb2)]('foreach\x20newproduct',_0x55d68b),(parseInt(_0x55d68b[_0x1d5784(0x175)])<parseInt(_0x55d68b['return_qty'])||parseInt(_0x55d68b['stock'])<parseInt(_0x55d68b[_0x1d5784(0xbf)])&&parseInt(_0x55d68b['sale_qty'])>parseInt(_0x55d68b[_0x1d5784(0xbf)])||parseInt(_0x55d68b['return_qty'])==0x0)&&_0x284c84++;});if(_0x284c84!=0x0)return _0x238fd3['flash'](_0x469576(0x108),_0x469576(0x99)),_0x3cd059[_0x469576(0xb8)](_0x469576(0xb5));const _0x57decd=await sales['findOne']({'invoice':_0x5d571c});console[_0x469576(0xb2)](_0x57decd),_0x57decd[_0x469576(0xe6)]=_0x469576(0xdf);const _0x1a26c5=await _0x57decd[_0x469576(0x114)](),_0x2e6bdc=new sales_return({'invoice':_0x5d571c,'customer':_0x238fd3[_0x469576(0x17c)][_0x469576(0xd3)],'date':_0x6831d7,'warehouse_name':_0x480253,'room':_0x1150c6,'ToWarehouse':_0x2fd6a3,'ToRoom':_0x293811,'return_sale':_0x2acfe3,'note':_0x248123}),_0x1da836=await _0x2e6bdc['save']();console[_0x469576(0xb2)](_0x2e6bdc);const _0x157a0b=await sales_return[_0x469576(0x12f)]({'invoice':_0x5d571c}),_0x119392=await warehouse['findOne']({'name':_0x2fd6a3,'room':_0x293811});_0x157a0b['return_sale']['forEach'](_0x134f65=>{var _0x14e4bc=_0x469576,_0x434ac4=0x0;const _0x334ef6=_0x119392['product_details']['map'](_0x38503b=>{var _0x41b1ca=a0_0x25b3;_0x38503b[_0x41b1ca(0x11d)]==_0x134f65[_0x41b1ca(0x11d)]&&_0x38503b['floorlevel']==_0x134f65[_0x41b1ca(0xe8)]&&_0x38503b[_0x41b1ca(0x17a)]==_0x134f65[_0x41b1ca(0x17a)]&&_0x38503b['bin']==_0x134f65[_0x41b1ca(0xd0)]&&_0x38503b['bay']==_0x134f65['bay']&&(_0x38503b[_0x41b1ca(0x165)]=parseInt(_0x38503b[_0x41b1ca(0x165)])+parseInt(_0x134f65[_0x41b1ca(0xbf)]),_0x434ac4++);});_0x434ac4=='0'&&(_0x119392['product_details']=_0x119392['product_details'][_0x14e4bc(0x127)]({'product_name':_0x134f65['product_name'],'product_stock':_0x134f65[_0x14e4bc(0xbf)],'primary_code':_0x134f65['primary_code'],'secondary_code':_0x134f65['secondary_code'],'product_code':_0x134f65['product_code'],'bay':_0x134f65['bay'],'bin':_0x134f65[_0x14e4bc(0xd0)],'type':_0x134f65[_0x14e4bc(0x17a)],'floorlevel':_0x134f65['floorlevel']})),console['log'](_0x14e4bc(0xf4),_0x119392);}),await _0x119392[_0x469576(0x114)](),console[_0x469576(0xb2)](_0x238fd3[_0x469576(0x17c)]);const _0x41ba58=new c_payment_data({'invoice':_0x5d571c,'customer':_0x238fd3[_0x469576(0x17c)][_0x469576(0xd3)],'reason':_0x469576(0xa7)});await _0x41ba58['save']();const _0x306bd2=await master_shop['find']();console['log'](_0x469576(0x10f),_0x306bd2[0x0]['image']);const _0x58318=await email_settings[_0x469576(0x12f)](),_0x89a746=await customer[_0x469576(0x12f)]({'name':_0x238fd3[_0x469576(0x17c)][_0x469576(0xd3)]});console[_0x469576(0xb2)](_0x469576(0xa0),_0x89a746);_0x306bd2[0x0][_0x469576(0x14f)]==0x1?(right_currency=_0x306bd2[0x0][_0x469576(0xde)],left_currency=''):(right_currency='',left_currency=_0x306bd2[0x0][_0x469576(0xde)]);var _0x2803fc=_0x1e9b72,_0x54ea62=_0x4c8998,_0x586420='',_0x4bc8a3;for(_0x4bc8a3 in _0x2803fc){_0x586420+=_0x469576(0xcf)+_0x469576(0x18f)+_0x2803fc[_0x4bc8a3]+_0x469576(0x136)+_0x469576(0x18f)+_0x54ea62[_0x4bc8a3]+_0x469576(0x136)+'</tr>';}console[_0x469576(0xb2)]('product_list',_0x586420);let _0x301965=nodemailer[_0x469576(0x143)]({'service':_0x469576(0x103),'auth':{'user':_0x58318[_0x469576(0xf9)],'pass':_0x58318[_0x469576(0xec)]}}),_0x473342={'from':_0x58318[_0x469576(0xf9)],'to':_0x89a746['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x469576(0x90)+'/upload/'+_0x306bd2[0x0]['image'],'cid':_0x469576(0x140)}],'html':'<!DOCTYPE\x20html>'+_0x469576(0x126)+'</head><body>'+_0x469576(0x173)+_0x469576(0x151)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x469576(0x10e)+_0x469576(0x173)+_0x469576(0x178)+_0x306bd2[0x0]['site_title']+'\x20</h2>'+_0x469576(0x10e)+_0x469576(0x10e)+'<hr\x20class=\x22my-3\x22>'+_0x469576(0x173)+_0x469576(0xb4)+'\x20Order\x20Number\x20:\x20'+_0x5d571c+'\x20'+_0x469576(0xb3)+_0x469576(0x13f)+_0x6831d7+'\x20'+_0x469576(0x107)+_0x469576(0x118)+_0x469576(0x10e)+_0x469576(0x160)+_0x469576(0x13c)+'<tr>'+_0x469576(0x189)+_0x469576(0x106)+_0x469576(0x15d)+_0x469576(0x192)+_0x469576(0xe7)+'</thead>'+_0x469576(0xe5)+'\x20'+_0x586420+'\x20'+'</tbody>'+_0x469576(0xb1)+_0x469576(0x173)+_0x469576(0xc7)+_0x469576(0x16c)+_0x306bd2[0x0][_0x469576(0x119)]+'</h5>'+'</div>'+_0x469576(0x10e)+'</body></html>'};_0x301965[_0x469576(0x8c)](_0x473342,function(_0x42d6e5,_0x30387c){var _0x205af8=_0x469576;_0x42d6e5?(console['log'](_0x42d6e5),console[_0x205af8(0xb2)](_0x205af8(0x146))):console[_0x205af8(0xb2)]('Email\x20sent\x20successfully');}),_0x238fd3[_0x469576(0x177)](_0x469576(0x156),_0x469576(0x152)),_0x3cd059[_0x469576(0xb8)](_0x469576(0xb9));}catch(_0x14410f){console[_0x469576(0xb2)](_0x14410f),_0x3cd059['status'](0xc8)[_0x469576(0xc6)]({'message1':_0x14410f[_0x469576(0xd8)]});}}),router[a0_0x1955c6(0x129)](a0_0x1955c6(0x181),auth,async(_0x53e71d,_0x407ec3)=>{var _0x5eec12=a0_0x1955c6;try{const {username:_0xdbe36e,email:_0x2b30bc,role:_0x117672}=_0x53e71d[_0x5eec12(0xe9)],_0x1d4ee8=_0x53e71d['user'],_0x251041=await profile[_0x5eec12(0x12f)]({'email':_0x1d4ee8[_0x5eec12(0xf9)]}),_0x1c0848=await master_shop[_0x5eec12(0x15e)]();console[_0x5eec12(0xb2)]('barcode\x20Product\x20master',_0x1c0848);const _0x3ae273=_0x53e71d[_0x5eec12(0x15b)]['id'],_0x23f9b1=await sales[_0x5eec12(0xe1)](_0x3ae273);console[_0x5eec12(0xb2)](_0x5eec12(0x167),_0x23f9b1);if(_0x1c0848[0x0][_0x5eec12(0x137)]==_0x5eec12(0x117))var _0x1d05e2=users[_0x5eec12(0xfd)];else{if(_0x1c0848[0x0][_0x5eec12(0x137)]==_0x5eec12(0x16b))var _0x1d05e2=users[_0x5eec12(0x16b)];else{if(_0x1c0848[0x0][_0x5eec12(0x137)]==_0x5eec12(0x169))var _0x1d05e2=users['German'];else{if(_0x1c0848[0x0][_0x5eec12(0x137)]=='Spanish')var _0x1d05e2=users['Spanish'];else{if(_0x1c0848[0x0][_0x5eec12(0x137)]==_0x5eec12(0x149))var _0x1d05e2=users[_0x5eec12(0x149)];else{if(_0x1c0848[0x0][_0x5eec12(0x137)]==_0x5eec12(0xbc))var _0x1d05e2=users[_0x5eec12(0xc5)];else{if(_0x1c0848[0x0][_0x5eec12(0x137)]==_0x5eec12(0x8e))var _0x1d05e2=users[_0x5eec12(0x8e)];else{if(_0x1c0848[0x0][_0x5eec12(0x137)]==_0x5eec12(0x174))var _0x1d05e2=users[_0x5eec12(0x12d)];}}}}}}}_0x407ec3['render'](_0x5eec12(0xef),{'success':_0x53e71d[_0x5eec12(0x177)](_0x5eec12(0x156)),'errors':_0x53e71d['flash'](_0x5eec12(0x108)),'role':_0x1d4ee8,'profile':_0x251041,'alldata':_0x23f9b1,'master_shop':_0x1c0848,'language':_0x1d05e2});}catch(_0x314602){console[_0x5eec12(0xb2)](_0x314602);}}),router[a0_0x1955c6(0x168)]('/barcode_scanner',async(_0x76ed6,_0x36c833)=>{var _0x16e7ee=a0_0x1955c6;const {product_code:_0x127f1b,warehouse_name:_0x3fc334,rooms_data:_0x4534dd,Roomslist:_0x2495d1}=_0x76ed6[_0x16e7ee(0x17c)],_0x7aff02=_0x2495d1['split'](','),_0x3a156a=[];async function _0x4f53da(_0x449331){var _0x38fdaa=_0x16e7ee;const _0x228bab=await warehouse['aggregate']([{'$match':{'name':_0x3fc334,'room':_0x449331}},{'$unwind':_0x38fdaa(0x91)},{'$match':{'product_details.primary_code':_0x127f1b}},{'$group':{'_id':_0x38fdaa(0x172),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x38fdaa(0x183)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x38fdaa(0x105)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x38fdaa(0x131)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x38fdaa(0x163)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x38fdaa(0x161)},'expiry_date':{'$first':_0x38fdaa(0x155)},'production_date':{'$first':_0x38fdaa(0x15f)},'maxPerUnit':{'$first':_0x38fdaa(0xf2)},'batch_code':{'$first':_0x38fdaa(0xd9)},'product_cat':{'$first':_0x38fdaa(0xd6)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x38fdaa(0x17b)},'invoice':{'$first':_0x38fdaa(0x9e)},'actual_qty':{'$first':_0x38fdaa(0x166)},'actual_uom':{'$first':_0x38fdaa(0x14b)}}}]),_0x3a0558=await warehouse[_0x38fdaa(0x145)]([{'$match':{'name':_0x3fc334,'room':_0x449331}},{'$unwind':_0x38fdaa(0x91)},{'$match':{'product_details.secondary_code':_0x127f1b}},{'$group':{'_id':_0x38fdaa(0x172),'name':{'$first':_0x38fdaa(0xf5)},'product_stock':{'$first':_0x38fdaa(0x121)},'primary_code':{'$first':_0x38fdaa(0x184)},'secondary_code':{'$first':_0x38fdaa(0x183)},'product_code':{'$first':_0x38fdaa(0x8b)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x38fdaa(0xb7)},'type':{'$first':_0x38fdaa(0xb6)},'pallet':{'$first':_0x38fdaa(0x131)},'unit':{'$first':_0x38fdaa(0x164)},'secondary_unit':{'$first':_0x38fdaa(0x163)},'storage':{'$first':_0x38fdaa(0xd5)},'rack':{'$first':_0x38fdaa(0x161)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x38fdaa(0x15f)},'maxPerUnit':{'$first':_0x38fdaa(0xf2)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x38fdaa(0xd6)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x38fdaa(0x17b)},'invoice':{'$first':_0x38fdaa(0x9e)}}}]);if(_0x228bab[_0x38fdaa(0xbb)]>0x0)_0x3a156a[_0x38fdaa(0x148)](_0x228bab);else _0x3a0558[_0x38fdaa(0xbb)]>0x0&&_0x3a156a[_0x38fdaa(0x148)](_0x3a0558);}const _0x3b6507=_0x7aff02[_0x16e7ee(0xf3)](_0x1c7a07=>_0x4f53da(_0x1c7a07));await Promise[_0x16e7ee(0x12b)](_0x3b6507),_0x36c833['json'](_0x3a156a);}),module[a0_0x1955c6(0xfb)]=router;