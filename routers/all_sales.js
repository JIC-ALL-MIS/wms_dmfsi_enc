var a0_0x13ce81=a0_0x2313;(function(_0x52bb76,_0x369341){var _0x377703=a0_0x2313,_0x38b468=_0x52bb76();while(!![]){try{var _0xc47003=parseInt(_0x377703(0x1e7))/0x1*(parseInt(_0x377703(0x17c))/0x2)+parseInt(_0x377703(0x1a1))/0x3+-parseInt(_0x377703(0x1b2))/0x4*(-parseInt(_0x377703(0x1b3))/0x5)+-parseInt(_0x377703(0x17a))/0x6*(parseInt(_0x377703(0x134))/0x7)+parseInt(_0x377703(0x191))/0x8*(-parseInt(_0x377703(0x1ba))/0x9)+parseInt(_0x377703(0x1eb))/0xa*(-parseInt(_0x377703(0x159))/0xb)+parseInt(_0x377703(0x15a))/0xc;if(_0xc47003===_0x369341)break;else _0x38b468['push'](_0x38b468['shift']());}catch(_0x1cbe73){_0x38b468['push'](_0x38b468['shift']());}}}(a0_0x4870,0x852fc));const express=require(a0_0x13ce81(0x1db)),app=express(),router=express[a0_0x13ce81(0x147)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x13ce81(0x135)),auth=require(a0_0x13ce81(0x173)),nodemailer=require(a0_0x13ce81(0x155)),users=require(a0_0x13ce81(0x1fd));router[a0_0x13ce81(0x1dc)](a0_0x13ce81(0x20a),auth,async(_0x3239d1,_0x2b702f)=>{var _0x45a6b0=a0_0x13ce81;try{const {username:_0x4d93ee,email:_0x1d7bc8,role:_0x5edf75}=_0x3239d1['user'],_0x4c485f=_0x3239d1['user'],_0x4858d8=await profile[_0x45a6b0(0x1d7)]({'email':_0x4c485f[_0x45a6b0(0x1f9)]}),_0x2cbac7=await master_shop[_0x45a6b0(0x186)]();let _0x3d39ab;if(_0x4c485f[_0x45a6b0(0x215)]==_0x45a6b0(0x1e5)){const _0x30d7e3=await staff[_0x45a6b0(0x1d7)]({'email':_0x4c485f[_0x45a6b0(0x1f9)]});_0x3d39ab=await sales[_0x45a6b0(0x1e1)]([{'$lookup':{'from':_0x45a6b0(0x1f5),'localField':_0x45a6b0(0x16c),'foreignField':_0x45a6b0(0x1d9),'as':_0x45a6b0(0x14e)}},{'$unwind':_0x45a6b0(0x156)},{'$unwind':_0x45a6b0(0x201)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x45a6b0(0x221)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x45a6b0(0x17b)},'sale_product':{'$push':_0x45a6b0(0x201)},'note':{'$first':_0x45a6b0(0x129)},'return_data':{'$first':_0x45a6b0(0x195)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x45a6b0(0x1bf)},'level':{'$addToSet':_0x45a6b0(0x228)},'isle':{'$addToSet':_0x45a6b0(0x20e)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x45a6b0(0x125)},'finalize':{'$first':_0x45a6b0(0x1c1)},'isAllowEdit':{'$first':_0x45a6b0(0x15d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x3d39ab=await sales[_0x45a6b0(0x1e1)]([{'$lookup':{'from':_0x45a6b0(0x1f5),'localField':'customer','foreignField':_0x45a6b0(0x1d9),'as':_0x45a6b0(0x14e)}},{'$unwind':_0x45a6b0(0x156)},{'$unwind':_0x45a6b0(0x201)},{'$group':{'_id':_0x45a6b0(0x146),'invoice':{'$first':_0x45a6b0(0x1c0)},'customers':{'$first':_0x45a6b0(0x221)},'date':{'$first':_0x45a6b0(0x15b)},'warehouse_name':{'$first':_0x45a6b0(0x17b)},'sale_product':{'$push':_0x45a6b0(0x201)},'note':{'$first':_0x45a6b0(0x129)},'return_data':{'$first':_0x45a6b0(0x195)},'customers_docs':{'$first':_0x45a6b0(0x156)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x45a6b0(0x20e)},'type':{'$addToSet':_0x45a6b0(0x161)},'pallet':{'$addToSet':_0x45a6b0(0x125)},'finalize':{'$first':_0x45a6b0(0x1c1)},'isAllowEdit':{'$first':_0x45a6b0(0x15d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x45a6b0(0x1cb)](_0x45a6b0(0x1cf),_0x3d39ab);if(_0x2cbac7[0x0][_0x45a6b0(0x18b)]=='English\x20(US)'){var _0x3baf6d=users['English'];console[_0x45a6b0(0x1cb)](_0x3baf6d);}else{if(_0x2cbac7[0x0][_0x45a6b0(0x18b)]==_0x45a6b0(0x21b))var _0x3baf6d=users['Hindi'];else{if(_0x2cbac7[0x0][_0x45a6b0(0x18b)]==_0x45a6b0(0x18c))var _0x3baf6d=users[_0x45a6b0(0x18c)];else{if(_0x2cbac7[0x0][_0x45a6b0(0x18b)]==_0x45a6b0(0x1fb))var _0x3baf6d=users[_0x45a6b0(0x1fb)];else{if(_0x2cbac7[0x0][_0x45a6b0(0x18b)]==_0x45a6b0(0x17d))var _0x3baf6d=users[_0x45a6b0(0x17d)];else{if(_0x2cbac7[0x0][_0x45a6b0(0x18b)]==_0x45a6b0(0x1a5))var _0x3baf6d=users['Portuguese'];else{if(_0x2cbac7[0x0][_0x45a6b0(0x18b)]==_0x45a6b0(0x20c))var _0x3baf6d=users[_0x45a6b0(0x20c)];else{if(_0x2cbac7[0x0][_0x45a6b0(0x18b)]==_0x45a6b0(0x230))var _0x3baf6d=users[_0x45a6b0(0x1da)];}}}}}}}_0x2b702f[_0x45a6b0(0x142)](_0x45a6b0(0x185),{'success':_0x3239d1['flash'](_0x45a6b0(0x206)),'errors':_0x3239d1['flash']('errors'),'sales':_0x3d39ab,'profile':_0x4858d8,'role':_0x4c485f,'master_shop':_0x2cbac7,'language':_0x3baf6d});}catch(_0x38fc20){console[_0x45a6b0(0x1cb)](_0x38fc20);}});async function getRandom8DigitNumber(){var _0x26fb94=a0_0x13ce81;const _0xe0596d=0x989680,_0x54aca7=0x5f5e0ff,_0x2e0707=Math[_0x26fb94(0x152)](Math[_0x26fb94(0x13c)]()*(_0x54aca7-_0xe0596d+0x1))+_0xe0596d;var _0x2c307b;const _0x53b4a8=await sales[_0x26fb94(0x1d7)]({'invoice':'OUT-'+_0x2e0707});return _0x53b4a8&&_0x53b4a8[_0x26fb94(0x169)]>0x0?_0x2c307b=_0x26fb94(0x1d2)+_0x2e0707:_0x2c307b='OUT-'+_0x2e0707,_0x2c307b;}function a0_0x2313(_0x58713d,_0x3786f0){var _0x4870f4=a0_0x4870();return a0_0x2313=function(_0x23134f,_0x4273ea){_0x23134f=_0x23134f-0x11b;var _0x310f39=_0x4870f4[_0x23134f];return _0x310f39;},a0_0x2313(_0x58713d,_0x3786f0);}function a0_0x4870(){var _0x19f6e3=['<html><head><title></title>','Sales\x20Add\x20successfully','back','product_details','1814697gRJnnj','sales\x20item\x20return\x20successfull','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','secondary_unit','Portuguese\x20(BR)','$product_details.actual_uom','Email\x20sent\x20successfully','<span\x20style=\x22float:\x20right;\x22>','$product','return_sale','stocks','secondary_code','quantity_notConverted','finalize','bin','True','site_title','32JvDjHg','68235AgGSQs','product_data','received_amount','string','prod_invoice','catch','<!DOCTYPE\x20html>','18UibMDT','$product_details.unit','user','$product_details.level','id_transact','$sale_product.quantity','$invoice','$finalize','$product_details.bay','<h2>\x20','isAllowEdit','$product_details.pallet','rack','room','master','_id','$name','log','An\x20error\x20occurred.','floorlevel','delivery_code','sales\x20all_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_cat','OUT-','/view/:id','types','amount','bay','findOne','expiry_date','name','Arabic','express','get','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</tr>','SCRN','json','aggregate','/give_payment/:id','abs','payment\x20successfull','staff','user_id','2972uDZVHR','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','stock','$room','3210btFJTO','error','add\x20post','/view/add_sales','getDate','/../public','delivery_date','sendMail','primary_unit','toString','customers','push','<div>','post','email','note','Spanish','$product_details.expiry_date','../public/language/languages.json','\x20Order\x20Number\x20:\x20','return_qty','<tbody\x20style=\x22text-align:\x20center;\x22>','$sale_product','Return\x20Rooms','exports','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','errors','success','then','\x20Order\x20Date\x20:\x20','$product_details.secondary_code','/view','product_name','Chinese','carton','$sale_product.bin','$product_details.rack','createTransport','quantity','body','\x20</h2>','save','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.product_name','$product.product_name','$product_details._id','level','Hindi','concat','batch_code','port','Sales\x20Update\x20successfully','False','$customer','/view/add_sales/:id','Received\x20Payment\x20For\x20Sale','params','</body></html>','</td>','/preview/:id','$sale_product.bay','Error\x20Occurs','$product_details.product_code','/all_sales/view','product_stock','final','$product_details.production_date','warehouse','Arabic\x20(ae)','map','currency','Level','Return\x20Goods','$product_details.actual_qty','$product_details.maxPerUnit','forEach','product','type','$product_details.primary_code','Sales\x20Mail','date','$sale_product.floorlevel','$product_details.batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/view/return_sales/:id','$note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','English','barcode\x20user_id','An\x20error\x20occurred\x20while\x20saving\x20data.','unit','gmail','product_code','actual_qty','770mxCikq','../models/all_models','$product_details','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Ambient','findById','</h5>','random','/view/add_sale/product','</table>','requested_qty','getMonth','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','render','all','max_per_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$_id','Router','/upload/','actual_uom','Raw\x20Materials','Portuguese','</div>','primary_code','customers_docs','purchases_data','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','id_transaction_from','floor','slice','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','nodemailer','$customers_docs','product_list','Logo.png','34474rcTGnU','5252100BkMIsv','$date','$product_details.product_cat','$isAllowEdit','Receiving\x20Area','$product_details.storage','Floor','$sale_product.type','/invoice/:id','password','redirect','padStart','invoice','host','room_name','length','maxperunit','storage','customer','<h5\x20style=\x22text-align:\x20left;\x22>','RMSEmail','Shelves','English\x20(US)','</thead>','foreach\x20newproduct','../middleware/auth','status','message','sales_quantity','$product_details.invoice','$product_details.product_stock','production_date','10842PTqToZ','$warehouse_name','718ouRTOS','French','edit_sales_view','max','stock_data','<h5>','$product_details.type','flash','filter','all_sales','find','return_data','logo','image','warehouse_name','language','German','sale_product','<hr\x20class=\x22my-3\x22>','sale_qty','add_sales','1873528RYTpYu','prod_code','</span>','customer_data','$return_data','/all_sales/preview/','</head><body>','Enabled','<tr>','all_sales_barcode','<table\x20style=\x22width:\x20100%\x20!important;\x22>','RoomAssigned'];a0_0x4870=function(){return _0x19f6e3;};return a0_0x4870();}router[a0_0x13ce81(0x1dc)](a0_0x13ce81(0x1ee),auth,async(_0x592158,_0x2f1b3a)=>{var _0x4a856b=a0_0x13ce81;try{const {username:_0x560a58,email:_0x391de9,role:_0x14b8de}=_0x592158['user'],_0xf26fd3=_0x592158[_0x4a856b(0x1bc)],_0x2e2231=await profile[_0x4a856b(0x1d7)]({'email':_0xf26fd3[_0x4a856b(0x1f9)]}),_0x47a0c4=await master_shop[_0x4a856b(0x186)](),_0x55e7b1=await customer['find']({});let _0x194051;if(_0xf26fd3[_0x4a856b(0x215)]==_0x4a856b(0x1e5)){const _0x16c522=await staff[_0x4a856b(0x1d7)]({'email':_0xf26fd3[_0x4a856b(0x1f9)]});_0x194051=await warehouse['aggregate']([{'$match':{'status':_0x4a856b(0x198),'name':_0x16c522[_0x4a856b(0x22f)],'warehouse_category':_0x4a856b(0x14a),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x4a856b(0x1ca),'name':{'$first':_0x4a856b(0x1ca)}}},{'$sort':{'name':0x1}}]);}else _0x194051=await warehouse[_0x4a856b(0x1e1)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0x4a856b(0x11c)}}},{'$group':{'_id':_0x4a856b(0x1ca),'name':{'$first':_0x4a856b(0x1ca)}}},{'$sort':{'name':0x1}}]);const _0x168627=await product['find']({});var _0x3ce2d0=[_0x4a856b(0x139),'Enclosed'];const _0x34c992=await sales[_0x4a856b(0x186)]({}),_0x3814ce=_0x34c992['length']+0x1,_0x30801c=_0x4a856b(0x1d2)+_0x3814ce[_0x4a856b(0x1f4)]()[_0x4a856b(0x165)](0x5,'0');if(_0x47a0c4[0x0][_0x4a856b(0x18b)]==_0x4a856b(0x170)){var _0x444b2d=users[_0x4a856b(0x12d)];console[_0x4a856b(0x1cb)](_0x444b2d);}else{if(_0x47a0c4[0x0][_0x4a856b(0x18b)]==_0x4a856b(0x21b))var _0x444b2d=users[_0x4a856b(0x21b)];else{if(_0x47a0c4[0x0][_0x4a856b(0x18b)]==_0x4a856b(0x18c))var _0x444b2d=users['German'];else{if(_0x47a0c4[0x0]['language']==_0x4a856b(0x1fb))var _0x444b2d=users[_0x4a856b(0x1fb)];else{if(_0x47a0c4[0x0]['language']==_0x4a856b(0x17d))var _0x444b2d=users[_0x4a856b(0x17d)];else{if(_0x47a0c4[0x0][_0x4a856b(0x18b)]==_0x4a856b(0x1a5))var _0x444b2d=users[_0x4a856b(0x14b)];else{if(_0x47a0c4[0x0]['language']==_0x4a856b(0x20c))var _0x444b2d=users['Chinese'];else{if(_0x47a0c4[0x0][_0x4a856b(0x18b)]==_0x4a856b(0x230))var _0x444b2d=users[_0x4a856b(0x1da)];}}}}}}}const _0x4da895=getRandom8DigitNumber();_0x4da895[_0x4a856b(0x207)](_0x280328=>{var _0xd8144e=_0x4a856b;_0x2f1b3a[_0xd8144e(0x142)](_0xd8144e(0x190),{'success':_0x592158[_0xd8144e(0x183)](_0xd8144e(0x206)),'errors':_0x592158[_0xd8144e(0x183)](_0xd8144e(0x205)),'role':_0xf26fd3,'profile':_0x2e2231,'customer':_0x55e7b1,'warehouse':_0x194051,'product':_0x168627,'invoice':_0x280328,'master_shop':_0x47a0c4,'language':_0x444b2d,'rooms_data':_0x3ce2d0});})[_0x4a856b(0x1b8)](_0x53eeb7=>{var _0x32776c=_0x4a856b;_0x592158[_0x32776c(0x183)](_0x32776c(0x205),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x2f1b3a[_0x32776c(0x164)](_0x32776c(0x22b));});}catch(_0x1189db){console[_0x4a856b(0x1cb)](_0x1189db);}}),router[a0_0x13ce81(0x1dc)](a0_0x13ce81(0x222),auth,async(_0xff5a93,_0x38b5f7)=>{var _0x2787ec=a0_0x13ce81;try{const _0x2b883b=_0xff5a93['params']['id'];console[_0x2787ec(0x1cb)](_0x2b883b);const _0x149e5=await product[_0x2787ec(0x186)](),_0x298ee9=await purchases[_0x2787ec(0x1e1)]([{'$match':{'warehouse_name':_0x2b883b}},{'$unwind':_0x2787ec(0x1a9)},{'$group':{'_id':_0x2787ec(0x218)}}]);console[_0x2787ec(0x1cb)](_0x2787ec(0x14f),_0x298ee9),_0x38b5f7[_0x2787ec(0x174)](0xc8)[_0x2787ec(0x1e0)]({'purchases_data':_0x298ee9,'product_data':_0x149e5});}catch(_0x8862a4){console[_0x2787ec(0x1cb)](_0x8862a4);}}),router[a0_0x13ce81(0x1f8)](a0_0x13ce81(0x13d),auth,async(_0x433c58,_0x4be07d)=>{var _0x546d10=a0_0x13ce81;try{const {warehouse_data:_0x136efe,product_data:_0x236b9a}=_0x433c58[_0x546d10(0x212)];console[_0x546d10(0x1cb)](_0x433c58['body'][_0x546d10(0x1b4)]);;const _0x4ed987=await master_shop[_0x546d10(0x186)]();console[_0x546d10(0x1cb)]('master',_0x4ed987);const _0x25f51e=await product[_0x546d10(0x1d7)]({'name':_0x236b9a});console[_0x546d10(0x1cb)](_0x546d10(0x120),_0x25f51e);const _0x3a78ec=await warehouse[_0x546d10(0x1e1)]([{'$match':{'name':_0x136efe}},{'$unwind':_0x546d10(0x136)},{'$match':{'product_details.product_name':_0x236b9a}},{'$group':{'_id':_0x546d10(0x217),'product_stock':{'$first':_0x546d10(0x178)}}}]);console[_0x546d10(0x1cb)]('stock_data',_0x3a78ec),_0x4be07d[_0x546d10(0x174)](0xc8)[_0x546d10(0x1e0)]({'master':_0x4ed987,'new_product':_0x25f51e,'stock_data':_0x3a78ec});}catch(_0x3f764c){console['log'](_0x3f764c);}}),router[a0_0x13ce81(0x1f8)](a0_0x13ce81(0x1ee),auth,async(_0x2dd7ec,_0xe2781d)=>{var _0x1e9427=a0_0x13ce81;try{const {invoice:_0x16a480,date:_0x313202,warehouse_name:_0x314772,product_name:_0x971540,stock:_0x9a59d0,quantity:_0x328916,note:_0x5535f8,room:_0x3dd494,primary_code:_0xed3eb4,secondary_code:_0x2f020d,prod_code:_0x4cc76d,level:_0x29d48d,isle:_0x5a470e,pallet:_0x3aaa70,batch_code:_0x30de9f,SCRN:_0x5b84d7,expiry_date:_0x316bcd}=_0x2dd7ec[_0x1e9427(0x212)];if(typeof _0x971540==_0x1e9427(0x1b6))var _0x38e888=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x20b)]],_0x44d396=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1e9)]],_0x529dde=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x20d)]],_0x255077=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x14d)]],_0x42df4f=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1ac)]],_0x5dc293=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x192)]],_0x6bd89=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x21a)]],_0x28296a=[_0x2dd7ec[_0x1e9427(0x212)]['primary_unit']],_0x40901e=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1a4)]],_0x55ffe2=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x21d)]],_0x4cad16=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1d8)]],_0x495220=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x144)]],_0x3853eb=[_0x2dd7ec['body']['production_date']],_0x3495c3=[_0x2dd7ec[_0x1e9427(0x212)]['requested_qty']],_0x2e8306=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1f1)]],_0x1cb777=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1ce)]],_0x6582f8=[_0x2dd7ec[_0x1e9427(0x212)]['prod_cat']],_0x123845=[_0x2dd7ec[_0x1e9427(0x212)]['quantity']],_0x1c3575=[_0x2dd7ec[_0x1e9427(0x212)]['RoomAssigned']],_0x5772ee=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1b7)]],_0x1ac5dc=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x133)]],_0x236c67=[_0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x149)]],_0x80ffa0=[_0x2dd7ec['body']['id_transact']];else var _0x38e888=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x20b)]],_0x44d396=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1e9)]],_0x529dde=[..._0x2dd7ec[_0x1e9427(0x212)]['carton']],_0x255077=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x14d)]],_0x42df4f=[..._0x2dd7ec[_0x1e9427(0x212)]['secondary_code']],_0x5dc293=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x192)]],_0x6bd89=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x21a)]],_0x28296a=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1f3)]],_0x40901e=[..._0x2dd7ec['body'][_0x1e9427(0x1a4)]],_0x55ffe2=[..._0x2dd7ec[_0x1e9427(0x212)]['batch_code']],_0x4cad16=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1d8)]],_0x495220=[..._0x2dd7ec['body'][_0x1e9427(0x144)]],_0x3853eb=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x179)]],_0x3495c3=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x13f)]],_0x2e8306=[..._0x2dd7ec[_0x1e9427(0x212)]['delivery_date']],_0x1cb777=[..._0x2dd7ec[_0x1e9427(0x212)]['delivery_code']],_0x6582f8=[..._0x2dd7ec['body'][_0x1e9427(0x1d1)]],_0x123845=[..._0x2dd7ec[_0x1e9427(0x212)]['quantity']],_0x1c3575=[..._0x2dd7ec['body'][_0x1e9427(0x19c)]],_0x5772ee=[..._0x2dd7ec[_0x1e9427(0x212)]['prod_invoice']],_0x1ac5dc=[..._0x2dd7ec['body'][_0x1e9427(0x133)]],_0x236c67=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x149)]],_0x80ffa0=[..._0x2dd7ec[_0x1e9427(0x212)][_0x1e9427(0x1be)]];const _0x5da73e=_0x38e888['map'](_0x2cdbc1=>{return _0x2cdbc1={'product_name':_0x2cdbc1};});_0x44d396[_0x1e9427(0x11f)]((_0x3147ab,_0x308de9)=>{var _0x2c5b4d=_0x1e9427;_0x5da73e[_0x308de9][_0x2c5b4d(0x1e9)]=Math[_0x2c5b4d(0x1e3)](_0x3147ab);}),_0x1ac5dc[_0x1e9427(0x11f)]((_0x1769a9,_0x253260)=>{_0x5da73e[_0x253260]['actual_qty']=Math['abs'](_0x1769a9);}),_0x236c67[_0x1e9427(0x11f)]((_0x4ac07c,_0x24f0b6)=>{var _0x27e289=_0x1e9427;_0x5da73e[_0x24f0b6][_0x27e289(0x149)]=_0x4ac07c;}),_0x80ffa0['forEach']((_0x58a354,_0x3be7bd)=>{var _0x13d211=_0x1e9427;_0x5da73e[_0x3be7bd][_0x13d211(0x151)]=_0x58a354;}),_0x529dde[_0x1e9427(0x11f)]((_0x350558,_0x830c62)=>{var _0x526ff1=_0x1e9427;_0x5da73e[_0x830c62][_0x526ff1(0x211)]=_0x350558;}),_0x255077[_0x1e9427(0x11f)]((_0x52eeb8,_0x290e28)=>{_0x5da73e[_0x290e28]['primary_code']=_0x52eeb8;}),_0x42df4f[_0x1e9427(0x11f)]((_0x55825f,_0xdd703)=>{var _0x10c4bd=_0x1e9427;_0x5da73e[_0xdd703][_0x10c4bd(0x1ac)]=_0x55825f;}),_0x5dc293[_0x1e9427(0x11f)]((_0x120f59,_0x2275e8)=>{var _0x381bf2=_0x1e9427;_0x5da73e[_0x2275e8][_0x381bf2(0x132)]=_0x120f59;}),_0x6bd89['forEach']((_0x95c706,_0x50efec)=>{var _0x238064=_0x1e9427;_0x1c3575[_0x238064(0x11f)]((_0x1df272,_0x9503c6)=>{var _0x4fdd31=_0x238064;if(_0x1df272==_0x4fdd31(0x15e)&&_0x50efec==_0x9503c6){var _0x2ec89c=_0x95c706[_0x4fdd31(0x153)](0x3);_0x5da73e[_0x50efec][_0x4fdd31(0x16b)]=_0x95c706[0x0],_0x5da73e[_0x50efec][_0x4fdd31(0x1c6)]=_0x95c706[0x1],_0x5da73e[_0x50efec][_0x4fdd31(0x1d6)]=0x0,_0x5da73e[_0x50efec][_0x4fdd31(0x1af)]=0x0,_0x5da73e[_0x50efec][_0x4fdd31(0x121)]='Floor',_0x5da73e[_0x50efec][_0x4fdd31(0x1cd)]=_0x2ec89c;}else{if(_0x1df272==_0x4fdd31(0x16f)&&_0x50efec==_0x9503c6){var _0x2ec89c=_0x95c706['slice'](0x3);_0x5da73e[_0x50efec][_0x4fdd31(0x16b)]=_0x95c706[0x0],_0x5da73e[_0x50efec][_0x4fdd31(0x1c6)]=_0x95c706[0x1],_0x5da73e[_0x50efec][_0x4fdd31(0x1d6)]=0x0,_0x5da73e[_0x50efec][_0x4fdd31(0x1af)]=0x0,_0x5da73e[_0x50efec][_0x4fdd31(0x121)]=_0x4fdd31(0x160),_0x5da73e[_0x50efec][_0x4fdd31(0x1cd)]=_0x95c706[0x5];}else{if(_0x50efec==_0x9503c6){var _0x4f6614;if(_0x95c706[0x4]=='L')_0x4f6614=_0x4fdd31(0x11b);else _0x95c706[0x4]=='F'&&(_0x4f6614=_0x4fdd31(0x160));_0x5da73e[_0x50efec][_0x4fdd31(0x16b)]=_0x95c706[0x0],_0x5da73e[_0x50efec][_0x4fdd31(0x1c6)]=_0x95c706[0x1],_0x5da73e[_0x50efec][_0x4fdd31(0x1d6)]=_0x95c706[0x2],_0x5da73e[_0x50efec][_0x4fdd31(0x1af)]=_0x95c706[0x3],_0x5da73e[_0x50efec]['type']=_0x4f6614,_0x5da73e[_0x50efec][_0x4fdd31(0x1cd)]=_0x95c706[0x5];}}}});}),_0x28296a[_0x1e9427(0x11f)]((_0x2edfa8,_0x4da875)=>{var _0x1c7fe1=_0x1e9427;_0x5da73e[_0x4da875][_0x1c7fe1(0x130)]=_0x2edfa8;}),_0x40901e[_0x1e9427(0x11f)]((_0x262edb,_0x538f13)=>{var _0x1d6e13=_0x1e9427;_0x5da73e[_0x538f13][_0x1d6e13(0x1a4)]=_0x262edb;}),_0x55ffe2[_0x1e9427(0x11f)]((_0xeef984,_0x4b1551)=>{_0x5da73e[_0x4b1551]['batch_code']=_0xeef984;}),_0x4cad16[_0x1e9427(0x11f)]((_0x360b9d,_0x630f38)=>{var _0x16bf59=_0x1e9427;_0x5da73e[_0x630f38][_0x16bf59(0x1d8)]=_0x360b9d;}),_0x495220[_0x1e9427(0x11f)]((_0x3ab3f1,_0x39402b)=>{var _0x11ca7e=_0x1e9427;_0x5da73e[_0x39402b][_0x11ca7e(0x16a)]=_0x3ab3f1;}),_0x3853eb[_0x1e9427(0x11f)]((_0x400ae3,_0x371947)=>{var _0x13f7fc=_0x1e9427;_0x5da73e[_0x371947][_0x13f7fc(0x179)]=_0x400ae3;}),_0x3495c3['forEach']((_0x4415b5,_0x3159a7)=>{var _0x3384b3=_0x1e9427;_0x5da73e[_0x3159a7][_0x3384b3(0x13f)]=_0x4415b5;}),_0x2e8306['forEach']((_0x2bfe0a,_0x1b19fb)=>{var _0x1905cd=_0x1e9427;_0x5da73e[_0x1b19fb][_0x1905cd(0x1f1)]=_0x2bfe0a;}),_0x1cb777[_0x1e9427(0x11f)]((_0x484cef,_0x57d4a7)=>{var _0x50123e=_0x1e9427;_0x5da73e[_0x57d4a7][_0x50123e(0x1ce)]=_0x484cef;}),_0x6582f8['forEach']((_0x61d2cb,_0x1957ed)=>{var _0x9cdfb5=_0x1e9427;_0x5da73e[_0x1957ed][_0x9cdfb5(0x1d1)]=_0x61d2cb;}),_0x123845[_0x1e9427(0x11f)]((_0x79262,_0x48ddb7)=>{var _0x5e9db6=_0x1e9427;_0x5da73e[_0x48ddb7][_0x5e9db6(0x1ad)]=_0x79262;}),_0x1c3575[_0x1e9427(0x11f)]((_0x429d27,_0x462841)=>{var _0x30b40e=_0x1e9427;_0x5da73e[_0x462841][_0x30b40e(0x168)]=_0x429d27;}),_0x5772ee[_0x1e9427(0x11f)]((_0x366a53,_0x5c3511)=>{var _0x135cb0=_0x1e9427;_0x5da73e[_0x5c3511][_0x135cb0(0x166)]=_0x366a53;});var _0x4c6449=0x0;_0x5da73e['forEach'](_0x2f72f9=>{var _0x45a59a=_0x1e9427;(_0x2f72f9['stock']<_0x2f72f9[_0x45a59a(0x1ad)]||_0x2f72f9['quantity_notConverted']==0x0)&&(console[_0x45a59a(0x1cb)](_0x45a59a(0x172),_0x2f72f9),_0x4c6449++);});const _0x16c317=_0x5da73e[_0x1e9427(0x184)](_0x3c831c=>_0x3c831c['quantity']!=='0'&&_0x3c831c[_0x1e9427(0x211)]!==''),_0x44653b=new sales({'invoice':_0x16a480,'customer':_0x2dd7ec['body'][_0x1e9427(0x16c)],'date':_0x313202,'warehouse_name':_0x314772,'sale_product':_0x16c317,'note':_0x5535f8,'room':_0x3dd494,'primary_code':_0xed3eb4,'secondary_code':_0x2f020d,'prod_code':_0x4cc76d,'SCRN':_0x5b84d7}),_0xeabc27=await _0x44653b[_0x1e9427(0x214)]();_0x2dd7ec[_0x1e9427(0x183)](_0x1e9427(0x206),_0x1e9427(0x19e)),_0xe2781d[_0x1e9427(0x164)](_0x1e9427(0x196)+_0xeabc27[_0x1e9427(0x1c9)]);}catch(_0x3cdf83){console[_0x1e9427(0x1cb)](_0x3cdf83);}}),router[a0_0x13ce81(0x1dc)](a0_0x13ce81(0x227),auth,async(_0x1f9543,_0x3afadc)=>{var _0x260ed4=a0_0x13ce81;try{const {username:_0x4083a6,email:_0xe28df1,role:_0x8fd13b}=_0x1f9543[_0x260ed4(0x1bc)],_0xc987f7=_0x1f9543[_0x260ed4(0x1bc)],_0x39870e=await profile[_0x260ed4(0x1d7)]({'email':_0xc987f7[_0x260ed4(0x1f9)]}),_0x3afee1=await master_shop['find'](),_0x5c1acc=_0x1f9543[_0x260ed4(0x224)]['id'],_0x472253=await sales['findById'](_0x5c1acc),_0x202700=await warehouse[_0x260ed4(0x1e1)]([{'$match':{'name':_0x472253[_0x260ed4(0x18a)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x260ed4(0x217)},'product_stock':{'$first':_0x260ed4(0x178)},'bay':{'$first':_0x260ed4(0x1c2)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x260ed4(0x182)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x260ed4(0x122)},'secondary_code':{'$first':_0x260ed4(0x209)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x260ed4(0x15f)},'rack':{'$first':_0x260ed4(0x20f)},'expiry_date':{'$first':_0x260ed4(0x1fc)},'production_date':{'$first':_0x260ed4(0x22e)},'invoice':{'$first':_0x260ed4(0x177)}}}]),_0x5dd0e2=await customer['find']({});let _0x460a22;if(_0xc987f7[_0x260ed4(0x215)]==_0x260ed4(0x1e5)){const _0x16bf98=await staff[_0x260ed4(0x1d7)]({'email':_0xc987f7[_0x260ed4(0x1f9)]});_0x460a22=await warehouse['aggregate']([{'$match':{'status':_0x260ed4(0x198),'name':_0x16bf98['warehouse']}},{'$group':{'_id':_0x260ed4(0x1ca),'name':{'$first':_0x260ed4(0x1ca)}}}]);}else _0x460a22=await warehouse[_0x260ed4(0x1e1)]([{'$match':{'status':_0x260ed4(0x198)}},{'$group':{'_id':'$name','name':{'$first':_0x260ed4(0x1ca)}}}]);const _0x56ca48=await product[_0x260ed4(0x186)]({}),_0x331762=await suppliers[_0x260ed4(0x186)]({});if(_0x3afee1[0x0][_0x260ed4(0x18b)]=='English\x20(US)'){var _0xcb4610=users['English'];console[_0x260ed4(0x1cb)](_0xcb4610);}else{if(_0x3afee1[0x0]['language']==_0x260ed4(0x21b))var _0xcb4610=users[_0x260ed4(0x21b)];else{if(_0x3afee1[0x0][_0x260ed4(0x18b)]==_0x260ed4(0x18c))var _0xcb4610=users[_0x260ed4(0x18c)];else{if(_0x3afee1[0x0][_0x260ed4(0x18b)]=='Spanish')var _0xcb4610=users[_0x260ed4(0x1fb)];else{if(_0x3afee1[0x0]['language']==_0x260ed4(0x17d))var _0xcb4610=users[_0x260ed4(0x17d)];else{if(_0x3afee1[0x0][_0x260ed4(0x18b)]==_0x260ed4(0x1a5))var _0xcb4610=users[_0x260ed4(0x14b)];else{if(_0x3afee1[0x0][_0x260ed4(0x18b)]==_0x260ed4(0x20c))var _0xcb4610=users[_0x260ed4(0x20c)];else{if(_0x3afee1[0x0]['language']==_0x260ed4(0x230))var _0xcb4610=users[_0x260ed4(0x1da)];}}}}}}}_0x3afadc[_0x260ed4(0x142)](_0x260ed4(0x17e),{'success':_0x1f9543[_0x260ed4(0x183)]('success'),'errors':_0x1f9543[_0x260ed4(0x183)](_0x260ed4(0x205)),'role':_0xc987f7,'profile':_0x39870e,'customer':_0x5dd0e2,'warehouse':_0x460a22,'product':_0x202700,'user':_0x472253,'master_shop':_0x3afee1,'unit':_0x56ca48,'language':_0xcb4610,'suppliers':_0x331762});}catch(_0x1f60d5){console[_0x260ed4(0x1cb)](_0x1f60d5);}}),router[a0_0x13ce81(0x1f8)](a0_0x13ce81(0x227),auth,async(_0x5ee043,_0x325a77)=>{var _0x116aee=a0_0x13ce81;try{const _0x40ba97=_0x5ee043['params']['id'],{invoice:_0x294d7f,warehouse_name:_0x5b087a,room:_0x165ed0}=_0x5ee043[_0x116aee(0x212)],_0x354bf0=await sales[_0x116aee(0x1d7)]({'invoice':_0x294d7f}),_0x5050d4=_0x354bf0[_0x116aee(0x18d)]['map'](async _0x36f2cc=>{var _0x5deaac=_0x116aee,_0x265683=await warehouse[_0x5deaac(0x1d7)]({'name':_0x5b087a,'room':_0x36f2cc['room_name'],'warehouse_category':_0x5deaac(0x14a)});const _0x1d70e2=_0x265683[_0x5deaac(0x1a0)][_0x5deaac(0x231)](_0x3b79a6=>{var _0xc295e8=_0x5deaac;_0x3b79a6[_0xc295e8(0x20b)]==_0x36f2cc[_0xc295e8(0x20b)]&&_0x3b79a6[_0xc295e8(0x1cd)]==_0x36f2cc[_0xc295e8(0x1cd)]&&_0x3b79a6[_0xc295e8(0x121)]==_0x36f2cc[_0xc295e8(0x121)]&&_0x3b79a6[_0xc295e8(0x1af)]==_0x36f2cc['bin']&&_0x3b79a6['bay']==_0x36f2cc[_0xc295e8(0x1d6)]&&_0x3b79a6[_0xc295e8(0x1c6)]==_0x36f2cc[_0xc295e8(0x1c6)]&&_0x3b79a6[_0xc295e8(0x16b)]==_0x36f2cc[_0xc295e8(0x16b)]&&_0x3b79a6[_0xc295e8(0x1d8)]==_0x36f2cc[_0xc295e8(0x1d8)]&&_0x3b79a6['batch_code']==_0x36f2cc[_0xc295e8(0x21d)]&&_0x3b79a6['_id']==_0x36f2cc[_0xc295e8(0x151)]&&(_0x3b79a6[_0xc295e8(0x22c)]=Math[_0xc295e8(0x17f)](0x0,Math[_0xc295e8(0x1e3)](_0x3b79a6[_0xc295e8(0x22c)])-Math[_0xc295e8(0x1e3)](_0x36f2cc[_0xc295e8(0x211)])));});return _0x265683;});Promise[_0x116aee(0x143)](_0x5050d4)[_0x116aee(0x207)](async _0x454521=>{var _0x464ce7=_0x116aee;try{for(const _0x2ec637 of _0x454521){await _0x2ec637[_0x464ce7(0x214)]();}_0x354bf0[_0x464ce7(0x1ae)]='True';const _0x576e3c=await _0x354bf0[_0x464ce7(0x214)](),_0x53dc55=await master_shop['find'](),_0x27caed=await email_settings[_0x464ce7(0x1d7)](),_0x4a4c2f=await supervisor_settings['find']();var _0x4f25f2=_0x354bf0[_0x464ce7(0x18d)],_0x7fc9fb='',_0x5cbf3b;for(_0x5cbf3b in _0x4f25f2){_0x7fc9fb+='<tr>'+_0x464ce7(0x141)+_0x4f25f2[_0x5cbf3b][_0x464ce7(0x20b)]+_0x464ce7(0x226)+_0x464ce7(0x141)+_0x4f25f2[_0x5cbf3b]['product_code']+'</td>'+_0x464ce7(0x141)+_0x4f25f2[_0x5cbf3b][_0x464ce7(0x211)]+'</td>'+_0x464ce7(0x141)+_0x4f25f2[_0x5cbf3b][_0x464ce7(0x130)]+_0x464ce7(0x226)+_0x464ce7(0x141)+_0x4f25f2[_0x5cbf3b][_0x464ce7(0x1a4)]+_0x464ce7(0x226)+_0x464ce7(0x141)+_0x354bf0[_0x464ce7(0x18a)]+_0x464ce7(0x226)+_0x464ce7(0x141)+_0x4f25f2[_0x5cbf3b]['room_name']+_0x464ce7(0x226)+_0x464ce7(0x141)+_0x4f25f2[_0x5cbf3b][_0x464ce7(0x16b)]+_0x4f25f2[_0x5cbf3b][_0x464ce7(0x1c6)]+_0x4f25f2[_0x5cbf3b]['bay']+_0x4f25f2[_0x5cbf3b][_0x464ce7(0x1af)]+_0x4f25f2[_0x5cbf3b]['type'][0x0]+_0x4f25f2[_0x5cbf3b][_0x464ce7(0x1cd)]+_0x464ce7(0x226),'</tr>';}let _0x32bf55=nodemailer['createTransport']({'host':_0x27caed[_0x464ce7(0x167)],'port':Number(_0x27caed[_0x464ce7(0x21e)]),'secure':![],'auth':{'user':_0x27caed['email'],'pass':_0x27caed[_0x464ce7(0x163)]}}),_0x2ab8b5={'from':_0x27caed['email'],'to':_0x4a4c2f[0x0][_0x464ce7(0x16e)],'subject':_0x464ce7(0x123),'attachments':[{'filename':_0x464ce7(0x158),'path':__dirname+_0x464ce7(0x1f0)+_0x464ce7(0x148)+_0x53dc55[0x0][_0x464ce7(0x189)],'cid':'logo'}],'html':_0x464ce7(0x1b9)+'<html><head><title></title>'+_0x464ce7(0x197)+'<div>'+_0x464ce7(0x154)+_0x464ce7(0x1f7)+_0x464ce7(0x1a3)+_0x464ce7(0x14c)+_0x464ce7(0x1f7)+'<h2>\x20'+_0x53dc55[0x0][_0x464ce7(0x1b1)]+_0x464ce7(0x213)+'</div>'+_0x464ce7(0x14c)+_0x464ce7(0x18e)+'<div>'+_0x464ce7(0x16d)+_0x464ce7(0x1fe)+_0x354bf0[_0x464ce7(0x166)]+'\x20'+_0x464ce7(0x1a8)+_0x464ce7(0x208)+_0x354bf0[_0x464ce7(0x124)]+'\x20'+_0x464ce7(0x193)+_0x464ce7(0x13b)+'</div>'+_0x464ce7(0x19b)+_0x464ce7(0x150)+'<tr>'+_0x464ce7(0x1d0)+_0x464ce7(0x1dd)+_0x464ce7(0x127)+_0x464ce7(0x12b)+_0x464ce7(0x1e8)+_0x464ce7(0x12c)+_0x464ce7(0x216)+_0x464ce7(0x145)+'</tr>'+_0x464ce7(0x171)+_0x464ce7(0x200)+'\x20'+_0x7fc9fb+'\x20'+'</tbody>'+_0x464ce7(0x13e)+_0x464ce7(0x1f7)+'<strong>\x20Regards\x20</strong>'+_0x464ce7(0x181)+_0x53dc55[0x0][_0x464ce7(0x1b1)]+_0x464ce7(0x13b)+_0x464ce7(0x14c)+_0x464ce7(0x14c)+_0x464ce7(0x225)};_0x32bf55[_0x464ce7(0x1f2)](_0x2ab8b5,function(_0x3af7e1,_0xaf43df){var _0x18b336=_0x464ce7;_0x3af7e1?(console['log'](_0x3af7e1),console['log'](_0x18b336(0x229))):console[_0x18b336(0x1cb)](_0x18b336(0x1a7));}),_0x5ee043[_0x464ce7(0x183)]('success','Sales\x20Update\x20successfully'),_0x325a77[_0x464ce7(0x164)](_0x464ce7(0x196)+_0x40ba97);}catch(_0x5cbb42){console['error'](_0x5cbb42),_0x325a77[_0x464ce7(0x174)](0x1f4)[_0x464ce7(0x1e0)]({'error':_0x464ce7(0x12f)});}})['catch'](_0x14d493=>{var _0x307951=_0x116aee;console[_0x307951(0x1ec)](_0x14d493),_0x325a77[_0x307951(0x174)](0x1f4)[_0x307951(0x1e0)]({'error':_0x307951(0x1cc)});});}catch(_0x599611){console[_0x116aee(0x1cb)](_0x599611);}}),router[a0_0x13ce81(0x1dc)](a0_0x13ce81(0x1d3),auth,async(_0x1e3065,_0x4d3a86)=>{var _0x54cc99=a0_0x13ce81;try{const {username:_0x9757a7,email:_0x1d1b3a,role:_0x165a53}=_0x1e3065[_0x54cc99(0x1bc)],_0x35cf87=_0x1e3065[_0x54cc99(0x1bc)],_0x5f522c=await profile[_0x54cc99(0x1d7)]({'email':_0x35cf87[_0x54cc99(0x1f9)]}),_0x2ca370=await master_shop[_0x54cc99(0x186)](),_0x3b8216=_0x1e3065['params']['id'],_0x582644=await sales[_0x54cc99(0x13a)](_0x3b8216);var _0x4b1f85=[_0x54cc99(0x139),'Enclosed'];const _0x421d3a=await warehouse[_0x54cc99(0x1e1)]([{'$match':{'name':_0x582644[_0x54cc99(0x18a)],'warehouse_category':_0x54cc99(0x14a)}},{'$unwind':_0x54cc99(0x136)},{'$group':{'_id':_0x54cc99(0x219),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x54cc99(0x178)},'bay':{'$first':_0x54cc99(0x1c2)},'bin':{'$first':_0x54cc99(0x137)},'type':{'$first':_0x54cc99(0x182)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x54cc99(0x122)},'secondary_code':{'$first':_0x54cc99(0x209)},'product_code':{'$first':_0x54cc99(0x22a)},'storage':{'$first':_0x54cc99(0x15f)},'rack':{'$first':'$product_details.rack'}}}]),_0x550ee2=await customer[_0x54cc99(0x186)]({});let _0x5aed22;if(_0x35cf87['role']==_0x54cc99(0x1e5)){const _0x26f04a=await staff[_0x54cc99(0x1d7)]({'email':_0x35cf87[_0x54cc99(0x1f9)]});_0x5aed22=await warehouse[_0x54cc99(0x1e1)]([{'$match':{'status':_0x54cc99(0x198),'name':_0x26f04a[_0x54cc99(0x22f)],'warehouse_category':_0x54cc99(0x14a)}},{'$group':{'_id':_0x54cc99(0x1ca),'name':{'$first':_0x54cc99(0x1ca)}}}]);}else _0x5aed22=await warehouse[_0x54cc99(0x1e1)]([{'$match':{'status':'Enabled','warehouse_category':_0x54cc99(0x14a)}},{'$group':{'_id':_0x54cc99(0x1ca),'name':{'$first':_0x54cc99(0x1ca)}}}]);const _0x377b7f=await product['find']({});if(_0x2ca370[0x0][_0x54cc99(0x18b)]==_0x54cc99(0x170)){var _0x1c73b5=users[_0x54cc99(0x12d)];console[_0x54cc99(0x1cb)](_0x1c73b5);}else{if(_0x2ca370[0x0][_0x54cc99(0x18b)]==_0x54cc99(0x21b))var _0x1c73b5=users[_0x54cc99(0x21b)];else{if(_0x2ca370[0x0]['language']=='German')var _0x1c73b5=users[_0x54cc99(0x18c)];else{if(_0x2ca370[0x0]['language']==_0x54cc99(0x1fb))var _0x1c73b5=users[_0x54cc99(0x1fb)];else{if(_0x2ca370[0x0][_0x54cc99(0x18b)]=='French')var _0x1c73b5=users['French'];else{if(_0x2ca370[0x0][_0x54cc99(0x18b)]==_0x54cc99(0x1a5))var _0x1c73b5=users[_0x54cc99(0x14b)];else{if(_0x2ca370[0x0]['language']==_0x54cc99(0x20c))var _0x1c73b5=users[_0x54cc99(0x20c)];else{if(_0x2ca370[0x0][_0x54cc99(0x18b)]==_0x54cc99(0x230))var _0x1c73b5=users[_0x54cc99(0x1da)];}}}}}}}_0x4d3a86[_0x54cc99(0x142)]('edit_sales',{'success':_0x1e3065[_0x54cc99(0x183)](_0x54cc99(0x206)),'errors':_0x1e3065[_0x54cc99(0x183)](_0x54cc99(0x205)),'role':_0x35cf87,'profile':_0x5f522c,'customer':_0x550ee2,'warehouse':_0x5aed22,'product':_0x421d3a,'user':_0x582644,'master_shop':_0x2ca370,'unit':_0x377b7f,'language':_0x1c73b5});}catch(_0x221863){console[_0x54cc99(0x1cb)](_0x221863);}}),router[a0_0x13ce81(0x1f8)]('/view/:id',auth,async(_0x30f3f5,_0x4bf001)=>{var _0x2f35b6=a0_0x13ce81;try{const _0x33dc85=_0x30f3f5[_0x2f35b6(0x224)]['id'],_0x961819=await sales[_0x2f35b6(0x1d7)]({'_id':_0x30f3f5[_0x2f35b6(0x224)]['id']}),_0x515446=await warehouse[_0x2f35b6(0x1d7)]({'name':_0x961819[_0x2f35b6(0x18a)],'room':_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x1c7)]}),{invoice:_0x209b31,date:_0xb8675f,warehouse_name:_0x1686a6,product_name:_0x2b5dcf,stock:_0x53cb67,quantity:_0x16eeed,note:_0x217a9b,room:_0x56a6cc,customer:_0x512368,SCRN:_0x539b6e}=_0x30f3f5[_0x2f35b6(0x212)];if(typeof _0x2b5dcf==_0x2f35b6(0x1b6))var _0x1630f5=[_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x20b)]],_0x418cc9=[_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x1e9)]],_0x4270bd=[_0x30f3f5['body'][_0x2f35b6(0x20d)]],_0xd61641=[_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x14d)]],_0x11bf99=[_0x30f3f5['body']['secondary_code']],_0x1f32c0=[_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x192)]],_0x5c1297=[_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x21a)]],_0x38e553=[_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x1f3)]],_0x2dc637=[_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x1a4)]],_0x319905=[_0x30f3f5['body'][_0x2f35b6(0x21d)]],_0x3b91c1=[_0x30f3f5['body'][_0x2f35b6(0x1d8)]],_0x4d9f35=[_0x30f3f5[_0x2f35b6(0x212)]['max_per_unit']],_0x455821=[_0x30f3f5[_0x2f35b6(0x212)]['production_date']],_0x14d160=[_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x13f)]],_0x3cc8e5=[_0x30f3f5['body'][_0x2f35b6(0x1f1)]],_0x30e53a=[_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x1ce)]],_0x146b47=[_0x30f3f5['body'][_0x2f35b6(0x1d1)]],_0x1cef20=[_0x30f3f5[_0x2f35b6(0x212)]['quantity']],_0x5b8641=[_0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x19c)]];else var _0x1630f5=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x20b)]],_0x418cc9=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x1e9)]],_0x4270bd=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x20d)]],_0xd61641=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x14d)]],_0x11bf99=[..._0x30f3f5['body'][_0x2f35b6(0x1ac)]],_0x1f32c0=[..._0x30f3f5['body'][_0x2f35b6(0x192)]],_0x5c1297=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x21a)]],_0x38e553=[..._0x30f3f5[_0x2f35b6(0x212)]['primary_unit']],_0x2dc637=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x1a4)]],_0x319905=[..._0x30f3f5['body']['batch_code']],_0x3b91c1=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x1d8)]],_0x4d9f35=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x144)]],_0x455821=[..._0x30f3f5[_0x2f35b6(0x212)]['production_date']],_0x14d160=[..._0x30f3f5['body'][_0x2f35b6(0x13f)]],_0x3cc8e5=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x1f1)]],_0x30e53a=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x1ce)]],_0x146b47=[..._0x30f3f5[_0x2f35b6(0x212)]['prod_cat']],_0x1cef20=[..._0x30f3f5['body'][_0x2f35b6(0x211)]],_0x5b8641=[..._0x30f3f5[_0x2f35b6(0x212)][_0x2f35b6(0x19c)]];const _0x36b3fb=_0x1630f5[_0x2f35b6(0x231)](_0x44864d=>{return _0x44864d={'product_name':_0x44864d};});_0x418cc9[_0x2f35b6(0x11f)]((_0x2ac99f,_0x29c248)=>{var _0xe9572=_0x2f35b6;_0x36b3fb[_0x29c248][_0xe9572(0x1e9)]=Math['abs'](_0x2ac99f);}),_0x4270bd['forEach']((_0x47c76c,_0x14282b)=>{var _0x4390eb=_0x2f35b6;_0x36b3fb[_0x14282b][_0x4390eb(0x211)]=_0x47c76c;}),_0xd61641[_0x2f35b6(0x11f)]((_0x29110f,_0x80191c)=>{var _0x393e80=_0x2f35b6;_0x36b3fb[_0x80191c][_0x393e80(0x14d)]=_0x29110f;}),_0x11bf99[_0x2f35b6(0x11f)]((_0x2e41bd,_0x33e6af)=>{_0x36b3fb[_0x33e6af]['secondary_code']=_0x2e41bd;}),_0x1f32c0[_0x2f35b6(0x11f)]((_0x1aea72,_0x37b95a)=>{var _0x426054=_0x2f35b6;_0x36b3fb[_0x37b95a][_0x426054(0x132)]=_0x1aea72;}),_0x5c1297[_0x2f35b6(0x11f)]((_0x3f85a0,_0x2ce49f)=>{var _0x5c9953=_0x2f35b6;_0x5b8641[_0x5c9953(0x11f)]((_0x4f82ef,_0x4aee97)=>{var _0x3da121=_0x5c9953;if(_0x4f82ef==_0x3da121(0x15e)&&_0x2ce49f==_0x4aee97){var _0xfbea5e=_0x3f85a0['slice'](0x3);_0x36b3fb[_0x2ce49f]['storage']=_0x3f85a0[0x0],_0x36b3fb[_0x2ce49f]['rack']=_0x3f85a0[0x1],_0x36b3fb[_0x2ce49f]['bay']=0x0,_0x36b3fb[_0x2ce49f]['bin']=0x0,_0x36b3fb[_0x2ce49f][_0x3da121(0x121)]='Floor',_0x36b3fb[_0x2ce49f]['floorlevel']=_0xfbea5e;}else{if(_0x4f82ef==_0x3da121(0x16f)&&_0x2ce49f==_0x4aee97){var _0xfbea5e=_0x3f85a0[_0x3da121(0x153)](0x3);_0x36b3fb[_0x2ce49f]['storage']=_0x3f85a0[0x0],_0x36b3fb[_0x2ce49f][_0x3da121(0x1c6)]=_0x3f85a0[0x1],_0x36b3fb[_0x2ce49f][_0x3da121(0x1d6)]=0x0,_0x36b3fb[_0x2ce49f][_0x3da121(0x1af)]=0x0,_0x36b3fb[_0x2ce49f]['type']=_0x3da121(0x160),_0x36b3fb[_0x2ce49f][_0x3da121(0x1cd)]=_0x3f85a0[0x5];}else{if(_0x2ce49f==_0x4aee97){var _0x3d20d7;if(_0x3f85a0[0x4]=='L')_0x3d20d7=_0x3da121(0x11b);else _0x3f85a0[0x4]=='F'&&(_0x3d20d7=_0x3da121(0x160));_0x36b3fb[_0x2ce49f][_0x3da121(0x16b)]=_0x3f85a0[0x0],_0x36b3fb[_0x2ce49f][_0x3da121(0x1c6)]=_0x3f85a0[0x1],_0x36b3fb[_0x2ce49f][_0x3da121(0x1d6)]=_0x3f85a0[0x2],_0x36b3fb[_0x2ce49f][_0x3da121(0x1af)]=_0x3f85a0[0x3],_0x36b3fb[_0x2ce49f][_0x3da121(0x121)]=_0x3d20d7,_0x36b3fb[_0x2ce49f][_0x3da121(0x1cd)]=_0x3f85a0[0x5];}}}});}),_0x38e553['forEach']((_0x2913f0,_0x6293a5)=>{_0x36b3fb[_0x6293a5]['unit']=_0x2913f0;}),_0x2dc637[_0x2f35b6(0x11f)]((_0x449b13,_0xb11386)=>{var _0x12d2b1=_0x2f35b6;_0x36b3fb[_0xb11386][_0x12d2b1(0x1a4)]=_0x449b13;}),_0x319905[_0x2f35b6(0x11f)]((_0x2748a5,_0x3f5876)=>{var _0x230480=_0x2f35b6;_0x36b3fb[_0x3f5876][_0x230480(0x21d)]=_0x2748a5;}),_0x3b91c1[_0x2f35b6(0x11f)]((_0x4cdea9,_0x412791)=>{var _0x30d90=_0x2f35b6;_0x36b3fb[_0x412791][_0x30d90(0x1d8)]=_0x4cdea9;}),_0x4d9f35[_0x2f35b6(0x11f)]((_0x1d9065,_0x3108c9)=>{var _0x35de84=_0x2f35b6;_0x36b3fb[_0x3108c9][_0x35de84(0x16a)]=_0x1d9065;}),_0x455821[_0x2f35b6(0x11f)]((_0x18a0d7,_0x2d7a58)=>{var _0x3e20cd=_0x2f35b6;_0x36b3fb[_0x2d7a58][_0x3e20cd(0x179)]=_0x18a0d7;}),_0x14d160[_0x2f35b6(0x11f)]((_0x2ddb7a,_0x17d74c)=>{var _0x5e6159=_0x2f35b6;_0x36b3fb[_0x17d74c]['requested_qty']=Math[_0x5e6159(0x1e3)](_0x2ddb7a);}),_0x3cc8e5[_0x2f35b6(0x11f)]((_0xc400e4,_0x432d47)=>{_0x36b3fb[_0x432d47]['delivery_date']=_0xc400e4;}),_0x30e53a[_0x2f35b6(0x11f)]((_0x3c8e71,_0x77b2f1)=>{var _0x1629a6=_0x2f35b6;_0x36b3fb[_0x77b2f1][_0x1629a6(0x1ce)]=_0x3c8e71;}),_0x146b47[_0x2f35b6(0x11f)]((_0x1a759c,_0x13cd88)=>{var _0x1a7aa0=_0x2f35b6;_0x36b3fb[_0x13cd88][_0x1a7aa0(0x1d1)]=_0x1a759c;}),_0x1cef20[_0x2f35b6(0x11f)]((_0x4255d3,_0x2af57d)=>{var _0x1b15b1=_0x2f35b6;_0x36b3fb[_0x2af57d][_0x1b15b1(0x1ad)]=_0x4255d3;}),_0x5b8641[_0x2f35b6(0x11f)]((_0x58a80f,_0x2c17bc)=>{var _0x2ba37f=_0x2f35b6;_0x36b3fb[_0x2c17bc][_0x2ba37f(0x168)]=_0x58a80f;});var _0x3ff68f=0x0;_0x36b3fb[_0x2f35b6(0x11f)](_0x3dc882=>{var _0x49eab2=_0x2f35b6;console[_0x49eab2(0x1cb)]('foreach\x20newproduct',_0x3dc882),(parseInt(_0x3dc882[_0x49eab2(0x1e9)])<parseInt(_0x3dc882['quantity'])||parseInt(_0x3dc882['quantity'])==0x0)&&_0x3ff68f++;});if(_0x3ff68f!=0x0)return _0x30f3f5[_0x2f35b6(0x183)](_0x2f35b6(0x205),_0x2f35b6(0x204)),_0x4bf001[_0x2f35b6(0x164)](_0x2f35b6(0x19f));const _0x1d0c0b=_0x36b3fb['filter'](_0x4ebaf3=>_0x4ebaf3[_0x2f35b6(0x211)]!=='0'&&_0x4ebaf3[_0x2f35b6(0x211)]!=='');_0x961819['invoice']=_0x209b31,_0x961819[_0x2f35b6(0x16c)]=_0x512368,_0x961819[_0x2f35b6(0x124)]=_0xb8675f,_0x961819[_0x2f35b6(0x18a)]=_0x1686a6,_0x961819['sale_product']=_0x1d0c0b,_0x961819[_0x2f35b6(0x1fa)]=_0x217a9b,_0x961819[_0x2f35b6(0x1df)]=_0x539b6e,_0x961819[_0x2f35b6(0x1ae)]=_0x2f35b6(0x220),_0x961819[_0x2f35b6(0x1c4)]=_0x2f35b6(0x220);const _0x4cf79a=await _0x961819[_0x2f35b6(0x214)]();_0x30f3f5[_0x2f35b6(0x183)]('success',_0x2f35b6(0x21f)),_0x4bf001['redirect']('/all_sales/view');}catch(_0x305ffa){console['log'](_0x305ffa);}}),router[a0_0x13ce81(0x1f8)](a0_0x13ce81(0x1e2),auth,async(_0x950a0f,_0x567863)=>{var _0x3acf74=a0_0x13ce81;try{const _0x10cf04=_0x950a0f[_0x3acf74(0x224)]['id'],{invoice:_0x155e55,customer:_0x46b547,receivable_amount:_0x176014,received_amount:_0x15cfbc}=_0x950a0f[_0x3acf74(0x212)],_0x103708=await sales[_0x3acf74(0x13a)](_0x10cf04);console[_0x3acf74(0x1cb)](_0x103708);var _0x5bc327=_0x176014-_0x15cfbc;console[_0x3acf74(0x1cb)](_0x15cfbc),_0x103708[_0x3acf74(0x1b5)]=parseFloat(_0x15cfbc)+parseFloat(_0x103708[_0x3acf74(0x1b5)]),_0x103708['due_amount']=_0x5bc327,console[_0x3acf74(0x1cb)](_0x103708);const _0x2cb604=await _0x103708[_0x3acf74(0x214)](),_0x4b090a=await c_payment_data[_0x3acf74(0x1d7)]({'invoice':_0x155e55});_0x4b090a[_0x3acf74(0x1d5)]=_0x5bc327,await _0x4b090a[_0x3acf74(0x214)]();let _0x287228=new Date(),_0x490e15=('0'+_0x287228[_0x3acf74(0x1ef)]())[_0x3acf74(0x153)](-0x2),_0x5df37f=('0'+(_0x287228[_0x3acf74(0x140)]()+0x1))['slice'](-0x2),_0xa1664f=_0x287228['getFullYear'](),_0x4dd9a9=_0xa1664f+'-'+_0x5df37f+'-'+_0x490e15;const _0x2a39f9=new customer_payment({'invoice':_0x155e55,'date':_0xa1664f+'-'+_0x5df37f+'-'+_0x490e15,'customer':_0x46b547,'reason':_0x3acf74(0x223),'amount':_0x15cfbc}),_0x137fc3=await _0x2a39f9[_0x3acf74(0x214)]();_0x950a0f[_0x3acf74(0x183)](_0x3acf74(0x206),_0x3acf74(0x1e4)),_0x567863[_0x3acf74(0x164)](_0x3acf74(0x22b));}catch(_0x4443c5){console[_0x3acf74(0x1cb)](_0x4443c5);}}),router['get'](a0_0x13ce81(0x162),auth,async(_0x1a68cb,_0x57ce03)=>{var _0x10490e=a0_0x13ce81;try{const {username:_0x1f0564,email:_0xe6177,role:_0x139203}=_0x1a68cb[_0x10490e(0x1bc)],_0x2e8661=_0x1a68cb[_0x10490e(0x1bc)],_0x29cf1b=await profile[_0x10490e(0x1d7)]({'email':_0x2e8661[_0x10490e(0x1f9)]}),_0x330379=await master_shop['find']();console[_0x10490e(0x1cb)](_0x10490e(0x1c8),_0x330379);const _0x3f5276=_0x1a68cb[_0x10490e(0x224)]['id'],_0x586c64=await sales['findById'](_0x3f5276);console[_0x10490e(0x1cb)](_0x586c64);const _0x12fdec=await customer[_0x10490e(0x1d7)]({'name':_0x586c64[_0x10490e(0x16c)]});console[_0x10490e(0x1cb)](_0x12fdec);if(_0x330379[0x0]['language']=='English\x20(US)'){var _0x1800cb=users[_0x10490e(0x12d)];console[_0x10490e(0x1cb)](_0x1800cb);}else{if(_0x330379[0x0]['language']==_0x10490e(0x21b))var _0x1800cb=users[_0x10490e(0x21b)];else{if(_0x330379[0x0][_0x10490e(0x18b)]==_0x10490e(0x18c))var _0x1800cb=users[_0x10490e(0x18c)];else{if(_0x330379[0x0]['language']==_0x10490e(0x1fb))var _0x1800cb=users[_0x10490e(0x1fb)];else{if(_0x330379[0x0][_0x10490e(0x18b)]==_0x10490e(0x17d))var _0x1800cb=users[_0x10490e(0x17d)];else{if(_0x330379[0x0]['language']==_0x10490e(0x1a5))var _0x1800cb=users[_0x10490e(0x14b)];else{if(_0x330379[0x0][_0x10490e(0x18b)]=='Chinese')var _0x1800cb=users[_0x10490e(0x20c)];else{if(_0x330379[0x0][_0x10490e(0x18b)]==_0x10490e(0x230))var _0x1800cb=users[_0x10490e(0x1da)];}}}}}}}_0x57ce03['render']('sales_invoice',{'success':_0x1a68cb[_0x10490e(0x183)](_0x10490e(0x206)),'errors':_0x1a68cb[_0x10490e(0x183)](_0x10490e(0x205)),'role':_0x2e8661,'profile':_0x29cf1b,'master_shop':_0x330379,'customers':_0x12fdec,'sales':_0x586c64,'language':_0x1800cb});}catch(_0x1afe8a){console[_0x10490e(0x1cb)](_0x1afe8a);}}),router[a0_0x13ce81(0x1dc)](a0_0x13ce81(0x128),auth,async(_0x446e88,_0x5b71f3)=>{var _0x1dcfde=a0_0x13ce81;try{const {username:_0x494e9e,email:_0x41e22a,role:_0x1d5abf}=_0x446e88['user'],_0x59b2a7=_0x446e88[_0x1dcfde(0x1bc)],_0x58a69a=await profile['findOne']({'email':_0x59b2a7[_0x1dcfde(0x1f9)]}),_0x4de6b8=await master_shop[_0x1dcfde(0x186)]();console[_0x1dcfde(0x1cb)]('master',_0x4de6b8);const _0x297ab4=_0x446e88[_0x1dcfde(0x224)]['id'];console['log'](_0x297ab4);const _0x1d17da=await sales[_0x1dcfde(0x13a)](_0x297ab4);console[_0x1dcfde(0x1cb)](_0x1dcfde(0x1e6),_0x1d17da);const _0x4f26cc=await warehouse[_0x1dcfde(0x1e1)]([{'$match':{'name':'Return\x20Goods','room':_0x1dcfde(0x202)}},{'$unwind':_0x1dcfde(0x136)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1dcfde(0x217)},'product_stock':{'$first':_0x1dcfde(0x178)},'level':{'$first':_0x1dcfde(0x1bd)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x1dcfde(0x1c5)},'primary_code':{'$first':_0x1dcfde(0x122)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1dcfde(0x22a)}}}]);console[_0x1dcfde(0x1cb)](_0x1dcfde(0x180),_0x4f26cc);const _0x289ed1=await product[_0x1dcfde(0x186)]({});warehouse_data=await warehouse[_0x1dcfde(0x1e1)]([{'$match':{'status':'Enabled','name':_0x1dcfde(0x11c),'warehouse_category':_0x1dcfde(0x14a)}},{'$group':{'_id':_0x1dcfde(0x1ca),'name':{'$first':_0x1dcfde(0x1ca)}}},{'$sort':{'name':0x1}}]);var _0x5570dd=[_0x1dcfde(0x202)];if(_0x4de6b8[0x0][_0x1dcfde(0x18b)]==_0x1dcfde(0x170)){var _0x5179d0=users[_0x1dcfde(0x12d)];console[_0x1dcfde(0x1cb)](_0x5179d0);}else{if(_0x4de6b8[0x0][_0x1dcfde(0x18b)]==_0x1dcfde(0x21b))var _0x5179d0=users[_0x1dcfde(0x21b)];else{if(_0x4de6b8[0x0]['language']=='German')var _0x5179d0=users['German'];else{if(_0x4de6b8[0x0]['language']==_0x1dcfde(0x1fb))var _0x5179d0=users[_0x1dcfde(0x1fb)];else{if(_0x4de6b8[0x0][_0x1dcfde(0x18b)]=='French')var _0x5179d0=users[_0x1dcfde(0x17d)];else{if(_0x4de6b8[0x0][_0x1dcfde(0x18b)]==_0x1dcfde(0x1a5))var _0x5179d0=users[_0x1dcfde(0x14b)];else{if(_0x4de6b8[0x0][_0x1dcfde(0x18b)]==_0x1dcfde(0x20c))var _0x5179d0=users[_0x1dcfde(0x20c)];else{if(_0x4de6b8[0x0][_0x1dcfde(0x18b)]==_0x1dcfde(0x230))var _0x5179d0=users[_0x1dcfde(0x1da)];}}}}}}}_0x5b71f3['render'](_0x1dcfde(0x1aa),{'success':_0x446e88[_0x1dcfde(0x183)](_0x1dcfde(0x206)),'errors':_0x446e88[_0x1dcfde(0x183)](_0x1dcfde(0x205)),'role':_0x59b2a7,'profile':_0x58a69a,'user':_0x1d17da,'stock':_0x4f26cc,'master_shop':_0x4de6b8,'unit':_0x289ed1,'language':_0x5179d0,'warehouses':warehouse_data,'rooms':_0x5570dd});}catch(_0xd05a02){console[_0x1dcfde(0x1cb)](_0xd05a02),_0x5b71f3[_0x1dcfde(0x174)](0xc8)[_0x1dcfde(0x1e0)]({'message':_0xd05a02[_0x1dcfde(0x175)]});}}),router[a0_0x13ce81(0x1f8)](a0_0x13ce81(0x128),auth,async(_0x37169e,_0x59e070)=>{var _0x22e368=a0_0x13ce81;try{const {invoice:_0x3c2685,date:_0x115cdf,warehouse_name:_0x254cfc,product_name:_0x84ffaa,primary_code:_0xaf28ae,secondary_code:_0x477307,product_code:_0x347df4,sales_quantity:_0x2144e3,stocks:_0x4b476a,return_qty:_0x23e426,Room_name:_0x132dd3,to_warehouse_name:_0x5740e9,to_Roomname:_0x5d36f0,to_Room_name:_0x4c4ce9,note:_0x19d63f,level:_0x1b1f2e,isle:_0x46fa6b,pallet:_0x3b42bd}=_0x37169e[_0x22e368(0x212)];if(typeof _0x84ffaa==_0x22e368(0x1b6))var _0x52b007=[_0x37169e[_0x22e368(0x212)][_0x22e368(0x20b)]],_0xaf3ab1=[_0x37169e['body'][_0x22e368(0x14d)]],_0x521ca6=[_0x37169e[_0x22e368(0x212)][_0x22e368(0x1ac)]],_0x1060a6=[_0x37169e['body'][_0x22e368(0x132)]],_0x2f3420=[_0x37169e[_0x22e368(0x212)][_0x22e368(0x176)]],_0x502f23=[_0x37169e[_0x22e368(0x212)][_0x22e368(0x1ab)]],_0xabbe03=[_0x37169e[_0x22e368(0x212)][_0x22e368(0x1ff)]],_0x54dfa6=[_0x37169e['body'][_0x22e368(0x1d6)]],_0x8e366f=[_0x37169e['body'][_0x22e368(0x1af)]],_0x5521dc=[_0x37169e[_0x22e368(0x212)][_0x22e368(0x1d4)]],_0x50dd6b=[_0x37169e[_0x22e368(0x212)][_0x22e368(0x1cd)]];else var _0x52b007=[..._0x37169e[_0x22e368(0x212)][_0x22e368(0x20b)]],_0xaf3ab1=[..._0x37169e[_0x22e368(0x212)][_0x22e368(0x14d)]],_0x521ca6=[..._0x37169e[_0x22e368(0x212)][_0x22e368(0x1ac)]],_0x1060a6=[..._0x37169e['body'][_0x22e368(0x132)]],_0x2f3420=[..._0x37169e[_0x22e368(0x212)][_0x22e368(0x176)]],_0x502f23=[..._0x37169e[_0x22e368(0x212)]['stocks']],_0xabbe03=[..._0x37169e[_0x22e368(0x212)]['return_qty']],_0x54dfa6=[..._0x37169e[_0x22e368(0x212)][_0x22e368(0x1d6)]],_0x8e366f=[..._0x37169e[_0x22e368(0x212)][_0x22e368(0x1af)]],_0x5521dc=[..._0x37169e[_0x22e368(0x212)][_0x22e368(0x1d4)]],_0x50dd6b=[..._0x37169e[_0x22e368(0x212)][_0x22e368(0x1cd)]];const _0x49ec4=_0x52b007[_0x22e368(0x231)](_0x181146=>{return _0x181146={'product_name':_0x181146};});_0xaf3ab1[_0x22e368(0x11f)]((_0x521dfd,_0x539ca8)=>{var _0x53be4a=_0x22e368;_0x49ec4[_0x539ca8][_0x53be4a(0x14d)]=_0x521dfd;}),_0x521ca6[_0x22e368(0x11f)]((_0x55db92,_0x4150de)=>{_0x49ec4[_0x4150de]['secondary_code']=_0x55db92;}),_0x1060a6[_0x22e368(0x11f)]((_0x4e430b,_0x1383cb)=>{var _0x5e3203=_0x22e368;_0x49ec4[_0x1383cb][_0x5e3203(0x132)]=_0x4e430b;}),_0x2f3420[_0x22e368(0x11f)]((_0x10bd4b,_0x5d1ac6)=>{var _0x3b59d9=_0x22e368;_0x49ec4[_0x5d1ac6][_0x3b59d9(0x18f)]=_0x10bd4b;}),_0x502f23[_0x22e368(0x11f)]((_0x806a20,_0x4f3e0d)=>{var _0x5bcf14=_0x22e368;_0x49ec4[_0x4f3e0d][_0x5bcf14(0x1e9)]=_0x806a20;}),_0xabbe03[_0x22e368(0x11f)]((_0x236b77,_0x434bb0)=>{var _0x34ffe4=_0x22e368;_0x49ec4[_0x434bb0][_0x34ffe4(0x1ff)]=_0x236b77;}),_0x54dfa6[_0x22e368(0x11f)]((_0x446fca,_0x139dff)=>{var _0x5ccc58=_0x22e368;_0x49ec4[_0x139dff][_0x5ccc58(0x1d6)]=_0x446fca;}),_0x8e366f[_0x22e368(0x11f)]((_0x466fa8,_0x2138e1)=>{var _0x408b86=_0x22e368;_0x49ec4[_0x2138e1][_0x408b86(0x1af)]=_0x466fa8;}),_0x5521dc['forEach']((_0x495430,_0xb382b6)=>{var _0x5ee030=_0x22e368;_0x49ec4[_0xb382b6][_0x5ee030(0x121)]=_0x495430;}),_0x50dd6b[_0x22e368(0x11f)]((_0xcba663,_0x1d839f)=>{var _0x3427a7=_0x22e368;_0x49ec4[_0x1d839f][_0x3427a7(0x1cd)]=_0xcba663;});var _0x394207=0x0;_0x49ec4[_0x22e368(0x11f)](_0x5c3283=>{var _0x4764ed=_0x22e368;console['log'](_0x4764ed(0x172),_0x5c3283),(parseInt(_0x5c3283[_0x4764ed(0x18f)])<parseInt(_0x5c3283[_0x4764ed(0x1ff)])||parseInt(_0x5c3283[_0x4764ed(0x1e9)])<parseInt(_0x5c3283['return_qty'])&&parseInt(_0x5c3283[_0x4764ed(0x18f)])>parseInt(_0x5c3283[_0x4764ed(0x1ff)])||parseInt(_0x5c3283[_0x4764ed(0x1ff)])==0x0)&&_0x394207++;});if(_0x394207!=0x0)return _0x37169e[_0x22e368(0x183)](_0x22e368(0x205),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x59e070['redirect'](_0x22e368(0x19f));const _0xc4ade0=await sales[_0x22e368(0x1d7)]({'invoice':_0x3c2685});console['log'](_0xc4ade0),_0xc4ade0[_0x22e368(0x187)]=_0x22e368(0x1b0);const _0x2fb0d9=await _0xc4ade0[_0x22e368(0x214)](),_0x80e1f=new sales_return({'invoice':_0x3c2685,'customer':_0x37169e['body'][_0x22e368(0x16c)],'date':_0x115cdf,'warehouse_name':_0x254cfc,'room':_0x132dd3,'ToWarehouse':_0x5740e9,'ToRoom':_0x4c4ce9,'return_sale':_0x49ec4,'note':_0x19d63f}),_0x52f935=await _0x80e1f[_0x22e368(0x214)]();console[_0x22e368(0x1cb)](_0x80e1f);const _0x52e8e5=await sales_return[_0x22e368(0x1d7)]({'invoice':_0x3c2685}),_0x5d2dd3=await warehouse[_0x22e368(0x1d7)]({'name':_0x5740e9,'room':_0x4c4ce9});_0x52e8e5['return_sale'][_0x22e368(0x11f)](_0x5b6177=>{var _0x26f050=_0x22e368,_0x40b7e6=0x0;const _0x360e3c=_0x5d2dd3['product_details'][_0x26f050(0x231)](_0x18334e=>{var _0x5134c8=_0x26f050;_0x18334e[_0x5134c8(0x20b)]==_0x5b6177['product_name']&&_0x18334e[_0x5134c8(0x1cd)]==_0x5b6177['floorlevel']&&_0x18334e[_0x5134c8(0x121)]==_0x5b6177['type']&&_0x18334e['bin']==_0x5b6177[_0x5134c8(0x1af)]&&_0x18334e[_0x5134c8(0x1d6)]==_0x5b6177[_0x5134c8(0x1d6)]&&(_0x18334e[_0x5134c8(0x22c)]=parseInt(_0x18334e[_0x5134c8(0x22c)])+parseInt(_0x5b6177[_0x5134c8(0x1ff)]),_0x40b7e6++);});_0x40b7e6=='0'&&(_0x5d2dd3[_0x26f050(0x1a0)]=_0x5d2dd3['product_details'][_0x26f050(0x21c)]({'product_name':_0x5b6177[_0x26f050(0x20b)],'product_stock':_0x5b6177[_0x26f050(0x1ff)],'primary_code':_0x5b6177[_0x26f050(0x14d)],'secondary_code':_0x5b6177[_0x26f050(0x1ac)],'product_code':_0x5b6177['product_code'],'bay':_0x5b6177['bay'],'bin':_0x5b6177['bin'],'type':_0x5b6177['type'],'floorlevel':_0x5b6177['floorlevel']})),console[_0x26f050(0x1cb)](_0x26f050(0x22d),_0x5d2dd3);}),await _0x5d2dd3['save'](),console[_0x22e368(0x1cb)](_0x37169e[_0x22e368(0x212)]);const _0x6896ae=new c_payment_data({'invoice':_0x3c2685,'customer':_0x37169e[_0x22e368(0x212)][_0x22e368(0x16c)],'reason':'Sale\x20Return'});await _0x6896ae[_0x22e368(0x214)]();const _0x5e63cf=await master_shop[_0x22e368(0x186)]();console['log'](_0x22e368(0x1ed),_0x5e63cf[0x0]['image']);const _0x55913c=await email_settings[_0x22e368(0x1d7)](),_0xf12f3d=await customer[_0x22e368(0x1d7)]({'name':_0x37169e[_0x22e368(0x212)][_0x22e368(0x16c)]});console['log'](_0x22e368(0x194),_0xf12f3d);_0x5e63cf[0x0]['currency_placement']==0x1?(right_currency=_0x5e63cf[0x0][_0x22e368(0x232)],left_currency=''):(right_currency='',left_currency=_0x5e63cf[0x0]['currency']);var _0x99a9ca=_0x52b007,_0x526304=_0xabbe03,_0x316de6='',_0x2cf39b;for(_0x2cf39b in _0x99a9ca){_0x316de6+=_0x22e368(0x199)+_0x22e368(0x141)+_0x99a9ca[_0x2cf39b]+_0x22e368(0x226)+_0x22e368(0x141)+_0x526304[_0x2cf39b]+_0x22e368(0x226)+_0x22e368(0x1de);}console['log'](_0x22e368(0x157),_0x316de6);let _0x2d16b5=nodemailer[_0x22e368(0x210)]({'service':_0x22e368(0x131),'auth':{'user':_0x55913c[_0x22e368(0x1f9)],'pass':_0x55913c['password']}}),_0x438860={'from':_0x55913c[_0x22e368(0x1f9)],'to':_0xf12f3d[_0x22e368(0x1f9)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x22e368(0x158),'path':__dirname+'/../public'+_0x22e368(0x148)+_0x5e63cf[0x0][_0x22e368(0x189)],'cid':_0x22e368(0x188)}],'html':'<!DOCTYPE\x20html>'+_0x22e368(0x19d)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x22e368(0x1a3)+_0x22e368(0x14c)+_0x22e368(0x1f7)+_0x22e368(0x1c3)+_0x5e63cf[0x0][_0x22e368(0x1b1)]+_0x22e368(0x213)+_0x22e368(0x14c)+'</div>'+_0x22e368(0x18e)+_0x22e368(0x1f7)+_0x22e368(0x16d)+_0x22e368(0x1fe)+_0x3c2685+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x22e368(0x208)+_0x115cdf+'\x20'+'</span>'+_0x22e368(0x13b)+'</div>'+_0x22e368(0x19b)+_0x22e368(0x150)+_0x22e368(0x199)+_0x22e368(0x1d0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x22e368(0x138)+_0x22e368(0x12a)+_0x22e368(0x1de)+_0x22e368(0x171)+_0x22e368(0x200)+'\x20'+_0x316de6+'\x20'+'</tbody>'+_0x22e368(0x13e)+_0x22e368(0x1f7)+'<strong>\x20Regards\x20</strong>'+_0x22e368(0x181)+_0x5e63cf[0x0][_0x22e368(0x1b1)]+_0x22e368(0x13b)+_0x22e368(0x14c)+'</div>'+'</body></html>'};_0x2d16b5[_0x22e368(0x1f2)](_0x438860,function(_0x3bc8b7,_0x384a0f){var _0x4c82b3=_0x22e368;_0x3bc8b7?(console['log'](_0x3bc8b7),console[_0x4c82b3(0x1cb)](_0x4c82b3(0x229))):console[_0x4c82b3(0x1cb)](_0x4c82b3(0x1a7));}),_0x37169e[_0x22e368(0x183)](_0x22e368(0x206),_0x22e368(0x1a2)),_0x59e070[_0x22e368(0x164)](_0x22e368(0x22b));}catch(_0x10ecbc){console['log'](_0x10ecbc),_0x59e070[_0x22e368(0x174)](0xc8)[_0x22e368(0x1e0)]({'message1':_0x10ecbc[_0x22e368(0x175)]});}}),router[a0_0x13ce81(0x1dc)]('/barcode/:id',auth,async(_0x25c672,_0x1fa0ea)=>{var _0x450def=a0_0x13ce81;try{const {username:_0x5b1cbf,email:_0x4ec5b0,role:_0x2d4dd7}=_0x25c672[_0x450def(0x1bc)],_0x47608d=_0x25c672['user'],_0x2aa01c=await profile[_0x450def(0x1d7)]({'email':_0x47608d[_0x450def(0x1f9)]}),_0x312db1=await master_shop[_0x450def(0x186)]();console[_0x450def(0x1cb)]('barcode\x20Product\x20master',_0x312db1);const _0x5bb8d7=_0x25c672[_0x450def(0x224)]['id'],_0xb10ce0=await sales[_0x450def(0x13a)](_0x5bb8d7);console[_0x450def(0x1cb)](_0x450def(0x12e),_0xb10ce0);if(_0x312db1[0x0][_0x450def(0x18b)]==_0x450def(0x170))var _0x4e6dd3=users[_0x450def(0x12d)];else{if(_0x312db1[0x0][_0x450def(0x18b)]=='Hindi')var _0x4e6dd3=users[_0x450def(0x21b)];else{if(_0x312db1[0x0][_0x450def(0x18b)]==_0x450def(0x18c))var _0x4e6dd3=users[_0x450def(0x18c)];else{if(_0x312db1[0x0][_0x450def(0x18b)]==_0x450def(0x1fb))var _0x4e6dd3=users[_0x450def(0x1fb)];else{if(_0x312db1[0x0][_0x450def(0x18b)]==_0x450def(0x17d))var _0x4e6dd3=users[_0x450def(0x17d)];else{if(_0x312db1[0x0][_0x450def(0x18b)]==_0x450def(0x1a5))var _0x4e6dd3=users['Portuguese'];else{if(_0x312db1[0x0]['language']=='Chinese')var _0x4e6dd3=users[_0x450def(0x20c)];else{if(_0x312db1[0x0]['language']==_0x450def(0x230))var _0x4e6dd3=users[_0x450def(0x1da)];}}}}}}}_0x1fa0ea[_0x450def(0x142)](_0x450def(0x19a),{'success':_0x25c672[_0x450def(0x183)](_0x450def(0x206)),'errors':_0x25c672['flash'](_0x450def(0x205)),'role':_0x47608d,'profile':_0x2aa01c,'alldata':_0xb10ce0,'master_shop':_0x312db1,'language':_0x4e6dd3});}catch(_0x167093){console[_0x450def(0x1cb)](_0x167093);}}),router[a0_0x13ce81(0x1f8)]('/barcode_scanner',async(_0x9befe4,_0x595dc9)=>{var _0x51b464=a0_0x13ce81;const {product_code:_0x109188,warehouse_name:_0x198514,rooms_data:_0x19807f,Roomslist:_0x4db6b9}=_0x9befe4['body'],_0x5df94b=_0x4db6b9['split'](','),_0x4a6c58=[];async function _0x2b6030(_0x271ebb){var _0x411be3=a0_0x2313;const _0xdb396c=await warehouse[_0x411be3(0x1e1)]([{'$match':{'name':_0x198514,'room':_0x271ebb}},{'$unwind':_0x411be3(0x136)},{'$match':{'product_details.primary_code':_0x109188}},{'$group':{'_id':_0x411be3(0x219),'name':{'$first':_0x411be3(0x217)},'product_stock':{'$first':_0x411be3(0x178)},'primary_code':{'$first':_0x411be3(0x122)},'secondary_code':{'$first':_0x411be3(0x209)},'product_code':{'$first':_0x411be3(0x22a)},'level':{'$first':_0x411be3(0x1c2)},'isle':{'$first':_0x411be3(0x137)},'type':{'$first':_0x411be3(0x182)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x411be3(0x1bb)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x411be3(0x15f)},'rack':{'$first':_0x411be3(0x20f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x411be3(0x22e)},'maxPerUnit':{'$first':_0x411be3(0x11e)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x411be3(0x15c)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x411be3(0x1ea)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x411be3(0x11d)},'actual_uom':{'$first':_0x411be3(0x1a6)}}}]),_0x3e92ff=await warehouse[_0x411be3(0x1e1)]([{'$match':{'name':_0x198514,'room':_0x271ebb}},{'$unwind':_0x411be3(0x136)},{'$match':{'product_details.secondary_code':_0x109188}},{'$group':{'_id':_0x411be3(0x219),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x411be3(0x209)},'product_code':{'$first':_0x411be3(0x22a)},'level':{'$first':_0x411be3(0x1c2)},'isle':{'$first':_0x411be3(0x137)},'type':{'$first':_0x411be3(0x182)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x411be3(0x15f)},'rack':{'$first':_0x411be3(0x20f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x411be3(0x22e)},'maxPerUnit':{'$first':_0x411be3(0x11e)},'batch_code':{'$first':_0x411be3(0x126)},'product_cat':{'$first':_0x411be3(0x15c)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x411be3(0x1ea)},'invoice':{'$first':_0x411be3(0x177)}}}]);if(_0xdb396c[_0x411be3(0x169)]>0x0)_0x4a6c58[_0x411be3(0x1f6)](_0xdb396c);else _0x3e92ff[_0x411be3(0x169)]>0x0&&_0x4a6c58[_0x411be3(0x1f6)](_0x3e92ff);}const _0xbff005=_0x5df94b[_0x51b464(0x231)](_0x3ab365=>_0x2b6030(_0x3ab365));await Promise[_0x51b464(0x143)](_0xbff005),_0x595dc9[_0x51b464(0x1e0)](_0x4a6c58);}),module[a0_0x13ce81(0x203)]=router;