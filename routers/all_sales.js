var a0_0x52c9ed=a0_0x303c;(function(_0x530622,_0x4951cc){var _0x31e4aa=a0_0x303c,_0x520971=_0x530622();while(!![]){try{var _0x585b16=-parseInt(_0x31e4aa(0x1d3))/0x1*(parseInt(_0x31e4aa(0x1b7))/0x2)+parseInt(_0x31e4aa(0x1ad))/0x3*(-parseInt(_0x31e4aa(0x199))/0x4)+parseInt(_0x31e4aa(0x13f))/0x5+-parseInt(_0x31e4aa(0x135))/0x6*(parseInt(_0x31e4aa(0x19d))/0x7)+-parseInt(_0x31e4aa(0x20a))/0x8+parseInt(_0x31e4aa(0x212))/0x9+parseInt(_0x31e4aa(0x162))/0xa*(parseInt(_0x31e4aa(0x1a7))/0xb);if(_0x585b16===_0x4951cc)break;else _0x520971['push'](_0x520971['shift']());}catch(_0x444bbb){_0x520971['push'](_0x520971['shift']());}}}(a0_0x53ac,0x50cf9));const express=require(a0_0x52c9ed(0x19f)),app=express(),router=express[a0_0x52c9ed(0x1c5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x52c9ed(0x195)),nodemailer=require('nodemailer'),users=require(a0_0x52c9ed(0x1b3));router[a0_0x52c9ed(0x1ba)](a0_0x52c9ed(0x13d),auth,async(_0x4264cf,_0x41ef04)=>{var _0x581631=a0_0x52c9ed;try{const {username:_0x14444c,email:_0x282a47,role:_0x301ce0}=_0x4264cf[_0x581631(0x142)],_0x564d1e=_0x4264cf[_0x581631(0x142)],_0x327089=await profile[_0x581631(0x129)]({'email':_0x564d1e[_0x581631(0x121)]}),_0x15a4bb=await master_shop[_0x581631(0x1e9)]();let _0x55d2f4;if(_0x564d1e['role']==_0x581631(0x16a)){const _0x3e9627=await staff[_0x581631(0x129)]({'email':_0x564d1e[_0x581631(0x121)]});_0x55d2f4=await sales[_0x581631(0x156)]([{'$lookup':{'from':_0x581631(0x1d9),'localField':_0x581631(0x10c),'foreignField':'name','as':_0x581631(0x11b)}},{'$unwind':_0x581631(0x1c9)},{'$unwind':_0x581631(0x14d)},{'$group':{'_id':'$_id','invoice':{'$first':_0x581631(0x1f0)},'customers':{'$first':_0x581631(0x205)},'date':{'$first':_0x581631(0x18e)},'warehouse_name':{'$first':_0x581631(0x1d1)},'sale_product':{'$push':_0x581631(0x14d)},'note':{'$first':_0x581631(0x174)},'return_data':{'$first':_0x581631(0x1e8)},'customers_docs':{'$first':_0x581631(0x1c9)},'total_saleproduct_quantity':{'$sum':_0x581631(0x210)},'level':{'$addToSet':_0x581631(0x10e)},'isle':{'$addToSet':_0x581631(0x140)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x581631(0x125)},'finalize':{'$first':_0x581631(0x183)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x55d2f4=await sales[_0x581631(0x156)]([{'$lookup':{'from':_0x581631(0x1d9),'localField':'customer','foreignField':_0x581631(0x218),'as':_0x581631(0x11b)}},{'$unwind':_0x581631(0x1c9)},{'$unwind':_0x581631(0x14d)},{'$group':{'_id':_0x581631(0x1ed),'invoice':{'$first':_0x581631(0x1f0)},'customers':{'$first':_0x581631(0x205)},'date':{'$first':_0x581631(0x18e)},'warehouse_name':{'$first':_0x581631(0x1d1)},'sale_product':{'$push':_0x581631(0x14d)},'note':{'$first':_0x581631(0x174)},'return_data':{'$first':_0x581631(0x1e8)},'customers_docs':{'$first':_0x581631(0x1c9)},'total_saleproduct_quantity':{'$sum':_0x581631(0x210)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x581631(0x140)},'type':{'$addToSet':_0x581631(0x1ae)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x581631(0x14f)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x581631(0x128)](_0x581631(0x152),_0x55d2f4);if(_0x15a4bb[0x0][_0x581631(0x16f)]=='English\x20(US)'){var _0x1ffd38=users[_0x581631(0x158)];console[_0x581631(0x128)](_0x1ffd38);}else{if(_0x15a4bb[0x0]['language']==_0x581631(0x1f1))var _0x1ffd38=users['Hindi'];else{if(_0x15a4bb[0x0][_0x581631(0x16f)]==_0x581631(0x20e))var _0x1ffd38=users[_0x581631(0x20e)];else{if(_0x15a4bb[0x0][_0x581631(0x16f)]==_0x581631(0x186))var _0x1ffd38=users['Spanish'];else{if(_0x15a4bb[0x0][_0x581631(0x16f)]==_0x581631(0x1bc))var _0x1ffd38=users[_0x581631(0x1bc)];else{if(_0x15a4bb[0x0][_0x581631(0x16f)]=='Portuguese\x20(BR)')var _0x1ffd38=users['Portuguese'];else{if(_0x15a4bb[0x0][_0x581631(0x16f)]=='Chinese')var _0x1ffd38=users[_0x581631(0x11f)];else{if(_0x15a4bb[0x0][_0x581631(0x16f)]==_0x581631(0x1a9))var _0x1ffd38=users[_0x581631(0x13e)];}}}}}}}_0x41ef04[_0x581631(0x1a0)](_0x581631(0x1b1),{'success':_0x4264cf[_0x581631(0x1c8)]('success'),'errors':_0x4264cf[_0x581631(0x1c8)](_0x581631(0x1fa)),'sales':_0x55d2f4,'profile':_0x327089,'role':_0x564d1e,'master_shop':_0x15a4bb,'language':_0x1ffd38});}catch(_0x320d98){console[_0x581631(0x128)](_0x320d98);}});async function getRandom8DigitNumber(){var _0x12a244=a0_0x52c9ed;const _0x25321e=0x989680,_0x488ed8=0x5f5e0ff,_0x3e80fa=Math['floor'](Math[_0x12a244(0x1be)]()*(_0x488ed8-_0x25321e+0x1))+_0x25321e;var _0x12ed2e;const _0x22cb73=await sales[_0x12a244(0x129)]({'invoice':_0x12a244(0x166)+_0x3e80fa});return _0x22cb73&&_0x22cb73[_0x12a244(0x16c)]>0x0?_0x12ed2e='OUT-'+_0x3e80fa:_0x12ed2e='OUT-'+_0x3e80fa,_0x12ed2e;}function a0_0x303c(_0x1ca457,_0x5133f0){var _0x53ac00=a0_0x53ac();return a0_0x303c=function(_0x303c1f,_0x2831fa){_0x303c1f=_0x303c1f-0x10c;var _0x33b65d=_0x53ac00[_0x303c1f];return _0x33b65d;},a0_0x303c(_0x1ca457,_0x5133f0);}function a0_0x53ac(){var _0x3877ff=['$product_details.actual_uom','$product_details.secondary_code','log','findOne','quantity','/view/add_sale/product','map','$product_details.delivery_code','catch','$product_details.product_name','$room','primary_code','maxperunit','slice','site_title','787326fsgNZU','RoomAssigned','$product_details.invoice','$product','Ambient','\x20</h2>','final','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/view','Arabic','563530JApgFr','$sale_product.bin','role','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','floorlevel','English\x20(US)','/view/add_sales','Sales\x20Update\x20successfully','_id','params','return_data','product_list','$product_details.actual_qty','$sale_product','concat','$isAllowEdit','</div>','sales\x20item\x20return\x20successfull','sales\x20all_data','sale_product','room_name','delivery_date','aggregate','$product_details.batch_code','English','/preview/:id','all_sales_barcode','createTransport','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','delivery_code','level','$product_details.primary_code','port','2040JqQsNN','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','stock_data','stock','OUT-','/../public','toString','$product.product_name','staff','prod_code','length','prod_cat','warehouse_name','language','max','$product_details.secondary_unit','Portuguese','product','$note','secondary_code','<h5>','received_amount','<tbody\x20style=\x22text-align:\x20center;\x22>','edit_sales_view','expiry_date','note','product_stock','<!DOCTYPE\x20html>','$product_details.product_cat','batch_code','$name','return_sale','Received\x20Payment\x20For\x20Sale','$finalize','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','barcode\x20user_id','Spanish','logo','/view/add_sales/:id','Portuguese\x20(BR)','$product_details.maxPerUnit','actual_uom','foreach\x20newproduct','room','$date','/upload/','carton','add_sales','</thead>','$product_details.pallet','Receiving\x20Area','../middleware/auth','rack','/all_sales/view','currency_placement','148076WnWJPL','Level','abs','primary_unit','7pluBdl','product_code','express','render','$product_details.rack','add\x20post','push','currency','$product_details.bay','Shelves','35035LDbBQf','$product_details._id','Arabic\x20(ae)','/all_sales/preview/','</table>','Raw\x20Materials','15YBChdH','$sale_product.type','getDate','payment\x20successfull','all_sales','forEach','../public/language/languages.json','$product_details','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','sales_quantity','26eiqgPM','actual_qty','<h5\x20style=\x22text-align:\x20left;\x22>','get','</td>','French','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','random','save','$product_details.bin','Return\x20Rooms','max_per_unit','product_name','$product_details.product_stock','Router','split','barcode\x20Product\x20master','flash','$customers_docs','all','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','due_amount','True','Enabled','master','$warehouse_name','$product_details.floorlevel','17099alSaOT','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Floor','bay','string','quantity_notConverted','customers','Logo.png','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','redirect','product_data','success','/give_payment/:id','type','\x20Order\x20Date\x20:\x20','<strong>\x20Regards\x20</strong>','storage','filter','<div>','production_date','bin','$return_data','find','gmail','json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$_id','return_qty','status','$invoice','Hindi','secondary_unit','types','Sale\x20Return','<hr\x20class=\x22my-3\x22>','warehouse','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.delivery_date','stocks','errors','$product_details.type','getMonth','password','$product_details.unit','/barcode_scanner','image','user_id','$product_details.product_code','Email\x20sent\x20successfully','then','$customer','</tr>','message','requested_qty','Return\x20Goods','2866768iUMZIv','</tbody>','An\x20error\x20occurred.','False','German','\x20Order\x20Number\x20:\x20','$sale_product.quantity','<span\x20style=\x22float:\x20right;\x22>','4189536uxHuAw','edit_sales','</body></html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Enclosed','sale_qty','name','product_details','sendMail','$product_details.production_date','/view/:id','findById','customer','<html><head><title></title>','$sale_product.bay','SCRN','$product_details.isle','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Sales\x20Add\x20successfully','body','id_transact','post','</head><body>','$product_details.storage','$product_details.expiry_date','</span>','invoice','customers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','unit','purchases_data','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','email','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','date','$sale_product.floorlevel'];a0_0x53ac=function(){return _0x3877ff;};return a0_0x53ac();}router[a0_0x52c9ed(0x1ba)](a0_0x52c9ed(0x146),auth,async(_0x1dacb4,_0x4be1c3)=>{var _0xfc2b3=a0_0x52c9ed;try{const {username:_0x19657c,email:_0xca2d4f,role:_0x36f28b}=_0x1dacb4['user'],_0x584ae6=_0x1dacb4[_0xfc2b3(0x142)],_0x1fe0c0=await profile[_0xfc2b3(0x129)]({'email':_0x584ae6[_0xfc2b3(0x121)]}),_0x3dc492=await master_shop['find'](),_0x12cd2d=await customer[_0xfc2b3(0x1e9)]({});let _0x51af16;if(_0x584ae6[_0xfc2b3(0x141)]=='staff'){const _0x288b55=await staff[_0xfc2b3(0x129)]({'email':_0x584ae6[_0xfc2b3(0x121)]});_0x51af16=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x288b55[_0xfc2b3(0x1f6)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xfc2b3(0x209)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x51af16=await warehouse['aggregate']([{'$match':{'status':_0xfc2b3(0x1cf),'warehouse_category':_0xfc2b3(0x1ac),'name':{'$ne':_0xfc2b3(0x209)}}},{'$group':{'_id':_0xfc2b3(0x180),'name':{'$first':_0xfc2b3(0x180)}}},{'$sort':{'name':0x1}}]);const _0x4c3274=await product[_0xfc2b3(0x1e9)]({});var _0x3f8c9c=['Ambient',_0xfc2b3(0x216)];const _0x25faf8=await sales[_0xfc2b3(0x1e9)]({}),_0x268ff2=_0x25faf8[_0xfc2b3(0x16c)]+0x1,_0x425641=_0xfc2b3(0x166)+_0x268ff2[_0xfc2b3(0x168)]()['padStart'](0x5,'0');if(_0x3dc492[0x0]['language']=='English\x20(US)'){var _0x41affc=users[_0xfc2b3(0x158)];console['log'](_0x41affc);}else{if(_0x3dc492[0x0][_0xfc2b3(0x16f)]==_0xfc2b3(0x1f1))var _0x41affc=users[_0xfc2b3(0x1f1)];else{if(_0x3dc492[0x0][_0xfc2b3(0x16f)]==_0xfc2b3(0x20e))var _0x41affc=users[_0xfc2b3(0x20e)];else{if(_0x3dc492[0x0]['language']==_0xfc2b3(0x186))var _0x41affc=users[_0xfc2b3(0x186)];else{if(_0x3dc492[0x0][_0xfc2b3(0x16f)]=='French')var _0x41affc=users[_0xfc2b3(0x1bc)];else{if(_0x3dc492[0x0][_0xfc2b3(0x16f)]==_0xfc2b3(0x189))var _0x41affc=users[_0xfc2b3(0x172)];else{if(_0x3dc492[0x0]['language']==_0xfc2b3(0x11f))var _0x41affc=users[_0xfc2b3(0x11f)];else{if(_0x3dc492[0x0][_0xfc2b3(0x16f)]==_0xfc2b3(0x1a9))var _0x41affc=users[_0xfc2b3(0x13e)];}}}}}}}const _0x536dd7=getRandom8DigitNumber();_0x536dd7[_0xfc2b3(0x204)](_0x81698=>{var _0x3edb72=_0xfc2b3;_0x4be1c3[_0x3edb72(0x1a0)](_0x3edb72(0x191),{'success':_0x1dacb4['flash'](_0x3edb72(0x1de)),'errors':_0x1dacb4[_0x3edb72(0x1c8)]('errors'),'role':_0x584ae6,'profile':_0x1fe0c0,'customer':_0x12cd2d,'warehouse':_0x51af16,'product':_0x4c3274,'invoice':_0x81698,'master_shop':_0x3dc492,'language':_0x41affc,'rooms_data':_0x3f8c9c});})[_0xfc2b3(0x12e)](_0x143c97=>{var _0x450a17=_0xfc2b3;_0x1dacb4['flash'](_0x450a17(0x1fa),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x4be1c3[_0x450a17(0x1dc)](_0x450a17(0x197));});}catch(_0x2b1070){console[_0xfc2b3(0x128)](_0x2b1070);}}),router[a0_0x52c9ed(0x1ba)](a0_0x52c9ed(0x188),auth,async(_0x52ba0a,_0x4f2a3f)=>{var _0x65f363=a0_0x52c9ed;try{const _0x563249=_0x52ba0a[_0x65f363(0x149)]['id'];console['log'](_0x563249);const _0x3189a9=await product[_0x65f363(0x1e9)](),_0x2eff9a=await purchases['aggregate']([{'$match':{'warehouse_name':_0x563249}},{'$unwind':_0x65f363(0x138)},{'$group':{'_id':_0x65f363(0x169)}}]);console[_0x65f363(0x128)](_0x65f363(0x11e),_0x2eff9a),_0x4f2a3f[_0x65f363(0x1ef)](0xc8)['json']({'purchases_data':_0x2eff9a,'product_data':_0x3189a9});}catch(_0x3073d2){console[_0x65f363(0x128)](_0x3073d2);}}),router[a0_0x52c9ed(0x115)](a0_0x52c9ed(0x12b),auth,async(_0x4cf9b3,_0x3c50bf)=>{var _0x1e4cfb=a0_0x52c9ed;try{const {warehouse_data:_0x573a36,product_data:_0x3dcad4}=_0x4cf9b3[_0x1e4cfb(0x113)];console[_0x1e4cfb(0x128)](_0x4cf9b3[_0x1e4cfb(0x113)][_0x1e4cfb(0x1dd)]);;const _0x5811c9=await master_shop['find']();console[_0x1e4cfb(0x128)](_0x1e4cfb(0x1d0),_0x5811c9);const _0x392614=await product[_0x1e4cfb(0x129)]({'name':_0x3dcad4});console[_0x1e4cfb(0x128)](_0x1e4cfb(0x173),_0x392614);const _0x3027cd=await warehouse[_0x1e4cfb(0x156)]([{'$match':{'name':_0x573a36}},{'$unwind':_0x1e4cfb(0x1b4)},{'$match':{'product_details.product_name':_0x3dcad4}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x1e4cfb(0x1c4)}}}]);console[_0x1e4cfb(0x128)]('stock_data',_0x3027cd),_0x3c50bf[_0x1e4cfb(0x1ef)](0xc8)[_0x1e4cfb(0x1eb)]({'master':_0x5811c9,'new_product':_0x392614,'stock_data':_0x3027cd});}catch(_0x4d3c65){console[_0x1e4cfb(0x128)](_0x4d3c65);}}),router[a0_0x52c9ed(0x115)]('/view/add_sales',auth,async(_0x30fc78,_0x2a8741)=>{var _0x3f1077=a0_0x52c9ed;try{const {invoice:_0x32ce3f,date:_0xb9d062,warehouse_name:_0x3a4a9a,product_name:_0x5b5f22,stock:_0x285a02,quantity:_0x3908a5,note:_0x57753a,room:_0x483a80,primary_code:_0x33c751,secondary_code:_0x4b0e48,prod_code:_0x255bf0,level:_0x487420,isle:_0x5cbf53,pallet:_0x42e78a,batch_code:_0x2d86cd,SCRN:_0x7ad996,expiry_date:_0x40dabc}=_0x30fc78[_0x3f1077(0x113)];if(typeof _0x5b5f22==_0x3f1077(0x1d7))var _0x4a93d5=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x1c3)]],_0x2f359a=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x165)]],_0x1e6bda=[_0x30fc78[_0x3f1077(0x113)]['carton']],_0x90edf=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x131)]],_0x381274=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x175)]],_0x7649bb=[_0x30fc78['body'][_0x3f1077(0x16b)]],_0x51d15f=[_0x30fc78['body'][_0x3f1077(0x15f)]],_0x3e916b=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x19c)]],_0x2c7357=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x1f2)]],_0xbaec27=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x17f)]],_0x544f3f=[_0x30fc78['body'][_0x3f1077(0x17a)]],_0x120487=[_0x30fc78['body']['max_per_unit']],_0x48ba10=[_0x30fc78[_0x3f1077(0x113)]['production_date']],_0xf674a1=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x208)]],_0x364aac=[_0x30fc78[_0x3f1077(0x113)]['delivery_date']],_0x577fd8=[_0x30fc78[_0x3f1077(0x113)]['delivery_code']],_0x707ce2=[_0x30fc78['body'][_0x3f1077(0x16d)]],_0x4f4ee9=[_0x30fc78[_0x3f1077(0x113)]['quantity']],_0x35b6a0=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x136)]],_0x52bf16=[_0x30fc78[_0x3f1077(0x113)]['prod_invoice']],_0x4c0824=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x1b8)]],_0x521a8c=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x18b)]],_0x517c23=[_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x114)]];else var _0x4a93d5=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x1c3)]],_0x2f359a=[..._0x30fc78[_0x3f1077(0x113)]['stock']],_0x1e6bda=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x190)]],_0x90edf=[..._0x30fc78[_0x3f1077(0x113)]['primary_code']],_0x381274=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x175)]],_0x7649bb=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x16b)]],_0x51d15f=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x15f)]],_0x3e916b=[..._0x30fc78[_0x3f1077(0x113)]['primary_unit']],_0x2c7357=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x1f2)]],_0xbaec27=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x17f)]],_0x544f3f=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x17a)]],_0x120487=[..._0x30fc78['body'][_0x3f1077(0x1c2)]],_0x48ba10=[..._0x30fc78['body'][_0x3f1077(0x1e6)]],_0xf674a1=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x208)]],_0x364aac=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x155)]],_0x577fd8=[..._0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x15e)]],_0x707ce2=[..._0x30fc78[_0x3f1077(0x113)]['prod_cat']],_0x4f4ee9=[..._0x30fc78['body'][_0x3f1077(0x12a)]],_0x35b6a0=[..._0x30fc78['body'][_0x3f1077(0x136)]],_0x52bf16=[..._0x30fc78[_0x3f1077(0x113)]['prod_invoice']],_0x4c0824=[..._0x30fc78['body'][_0x3f1077(0x1b8)]],_0x521a8c=[..._0x30fc78['body'][_0x3f1077(0x18b)]],_0x517c23=[..._0x30fc78[_0x3f1077(0x113)]['id_transact']];const _0x3b0af0=_0x4a93d5['map'](_0xdd6be3=>{return _0xdd6be3={'product_name':_0xdd6be3};});_0x2f359a[_0x3f1077(0x1b2)]((_0xd0eeff,_0x4fe8aa)=>{var _0x4487ad=_0x3f1077;_0x3b0af0[_0x4fe8aa][_0x4487ad(0x165)]=Math['abs'](_0xd0eeff);}),_0x4c0824[_0x3f1077(0x1b2)]((_0x34b45e,_0x4cf12b)=>{var _0x3a43ab=_0x3f1077;_0x3b0af0[_0x4cf12b][_0x3a43ab(0x1b8)]=Math[_0x3a43ab(0x19b)](_0x34b45e);}),_0x521a8c[_0x3f1077(0x1b2)]((_0x1c13e7,_0x472f42)=>{var _0x10cb6a=_0x3f1077;_0x3b0af0[_0x472f42][_0x10cb6a(0x18b)]=_0x1c13e7;}),_0x517c23[_0x3f1077(0x1b2)]((_0x28b21c,_0x3c9c4c)=>{_0x3b0af0[_0x3c9c4c]['id_transaction_from']=_0x28b21c;}),_0x1e6bda[_0x3f1077(0x1b2)]((_0x261db0,_0x258627)=>{var _0x1717ad=_0x3f1077;_0x3b0af0[_0x258627][_0x1717ad(0x12a)]=_0x261db0;}),_0x90edf['forEach']((_0x11026e,_0x374cc0)=>{var _0x2d5792=_0x3f1077;_0x3b0af0[_0x374cc0][_0x2d5792(0x131)]=_0x11026e;}),_0x381274[_0x3f1077(0x1b2)]((_0x477cfa,_0x4a11ff)=>{var _0x4b2424=_0x3f1077;_0x3b0af0[_0x4a11ff][_0x4b2424(0x175)]=_0x477cfa;}),_0x7649bb[_0x3f1077(0x1b2)]((_0x265003,_0x221644)=>{_0x3b0af0[_0x221644]['product_code']=_0x265003;}),_0x51d15f[_0x3f1077(0x1b2)]((_0x294a4a,_0x3aeff4)=>{_0x35b6a0['forEach']((_0x17dc55,_0x1112e8)=>{var _0x384fb9=a0_0x303c;if(_0x17dc55==_0x384fb9(0x194)&&_0x3aeff4==_0x1112e8){var _0x4e10b6=_0x294a4a[_0x384fb9(0x133)](0x3);_0x3b0af0[_0x3aeff4][_0x384fb9(0x1e3)]=_0x294a4a[0x0],_0x3b0af0[_0x3aeff4][_0x384fb9(0x196)]=_0x294a4a[0x1],_0x3b0af0[_0x3aeff4][_0x384fb9(0x1d6)]=0x0,_0x3b0af0[_0x3aeff4]['bin']=0x0,_0x3b0af0[_0x3aeff4][_0x384fb9(0x1e0)]='Floor',_0x3b0af0[_0x3aeff4][_0x384fb9(0x144)]=_0x4e10b6;}else{if(_0x17dc55=='Shelves'&&_0x3aeff4==_0x1112e8){var _0x4e10b6=_0x294a4a[_0x384fb9(0x133)](0x3);_0x3b0af0[_0x3aeff4]['storage']=_0x294a4a[0x0],_0x3b0af0[_0x3aeff4][_0x384fb9(0x196)]=_0x294a4a[0x1],_0x3b0af0[_0x3aeff4]['bay']=0x0,_0x3b0af0[_0x3aeff4][_0x384fb9(0x1e7)]=0x0,_0x3b0af0[_0x3aeff4][_0x384fb9(0x1e0)]=_0x384fb9(0x1d5),_0x3b0af0[_0x3aeff4]['floorlevel']=_0x294a4a[0x5];}else{if(_0x3aeff4==_0x1112e8){var _0x2e79e9;if(_0x294a4a[0x4]=='L')_0x2e79e9='Level';else _0x294a4a[0x4]=='F'&&(_0x2e79e9=_0x384fb9(0x1d5));_0x3b0af0[_0x3aeff4][_0x384fb9(0x1e3)]=_0x294a4a[0x0],_0x3b0af0[_0x3aeff4][_0x384fb9(0x196)]=_0x294a4a[0x1],_0x3b0af0[_0x3aeff4][_0x384fb9(0x1d6)]=_0x294a4a[0x2],_0x3b0af0[_0x3aeff4][_0x384fb9(0x1e7)]=_0x294a4a[0x3],_0x3b0af0[_0x3aeff4][_0x384fb9(0x1e0)]=_0x2e79e9,_0x3b0af0[_0x3aeff4][_0x384fb9(0x144)]=_0x294a4a[0x5];}}}});}),_0x3e916b[_0x3f1077(0x1b2)]((_0xf36c7a,_0x1341de)=>{var _0x511ee7=_0x3f1077;_0x3b0af0[_0x1341de][_0x511ee7(0x11d)]=_0xf36c7a;}),_0x2c7357['forEach']((_0x3d54cf,_0x2a6275)=>{var _0x3c31e1=_0x3f1077;_0x3b0af0[_0x2a6275][_0x3c31e1(0x1f2)]=_0x3d54cf;}),_0xbaec27['forEach']((_0x145b36,_0x5a7081)=>{var _0x310747=_0x3f1077;_0x3b0af0[_0x5a7081][_0x310747(0x17f)]=_0x145b36;}),_0x544f3f[_0x3f1077(0x1b2)]((_0xb4c80b,_0x21fc65)=>{_0x3b0af0[_0x21fc65]['expiry_date']=_0xb4c80b;}),_0x120487[_0x3f1077(0x1b2)]((_0x206371,_0x5381e2)=>{_0x3b0af0[_0x5381e2]['maxperunit']=_0x206371;}),_0x48ba10['forEach']((_0x3e871d,_0x25c442)=>{var _0x5bd759=_0x3f1077;_0x3b0af0[_0x25c442][_0x5bd759(0x1e6)]=_0x3e871d;}),_0xf674a1['forEach']((_0xfa10e1,_0x2984d8)=>{_0x3b0af0[_0x2984d8]['requested_qty']=_0xfa10e1;}),_0x364aac[_0x3f1077(0x1b2)]((_0x421aee,_0xa58a67)=>{var _0x3310c9=_0x3f1077;_0x3b0af0[_0xa58a67][_0x3310c9(0x155)]=_0x421aee;}),_0x577fd8[_0x3f1077(0x1b2)]((_0x402be1,_0xe95e6e)=>{var _0x3e4ba8=_0x3f1077;_0x3b0af0[_0xe95e6e][_0x3e4ba8(0x15e)]=_0x402be1;}),_0x707ce2[_0x3f1077(0x1b2)]((_0x441250,_0x4942fb)=>{var _0x90cdca=_0x3f1077;_0x3b0af0[_0x4942fb][_0x90cdca(0x16d)]=_0x441250;}),_0x4f4ee9[_0x3f1077(0x1b2)]((_0x1f56ca,_0x3ae1df)=>{var _0xcdacc1=_0x3f1077;_0x3b0af0[_0x3ae1df][_0xcdacc1(0x1d8)]=_0x1f56ca;}),_0x35b6a0[_0x3f1077(0x1b2)]((_0x19b339,_0x5100db)=>{var _0xa2a990=_0x3f1077;_0x3b0af0[_0x5100db][_0xa2a990(0x154)]=_0x19b339;}),_0x52bf16[_0x3f1077(0x1b2)]((_0x4f0c9c,_0x36c987)=>{var _0x13df78=_0x3f1077;_0x3b0af0[_0x36c987][_0x13df78(0x11a)]=_0x4f0c9c;});var _0x35fdd7=0x0;_0x3b0af0[_0x3f1077(0x1b2)](_0x5e5d18=>{var _0x54dedf=_0x3f1077;(_0x5e5d18[_0x54dedf(0x165)]<_0x5e5d18[_0x54dedf(0x1d8)]||_0x5e5d18[_0x54dedf(0x1d8)]==0x0)&&(console[_0x54dedf(0x128)](_0x54dedf(0x18c),_0x5e5d18),_0x35fdd7++);});const _0x571545=_0x3b0af0['filter'](_0x305e36=>_0x305e36[_0x3f1077(0x12a)]!=='0'&&_0x305e36[_0x3f1077(0x12a)]!==''),_0x5e21b9=new sales({'invoice':_0x32ce3f,'customer':_0x30fc78[_0x3f1077(0x113)][_0x3f1077(0x10c)],'date':_0xb9d062,'warehouse_name':_0x3a4a9a,'sale_product':_0x571545,'note':_0x57753a,'room':_0x483a80,'primary_code':_0x33c751,'secondary_code':_0x4b0e48,'prod_code':_0x255bf0,'SCRN':_0x7ad996}),_0x50de1b=await _0x5e21b9['save']();_0x30fc78[_0x3f1077(0x1c8)](_0x3f1077(0x1de),_0x3f1077(0x112)),_0x2a8741[_0x3f1077(0x1dc)](_0x3f1077(0x1aa)+_0x50de1b[_0x3f1077(0x148)]);}catch(_0x24899b){console['log'](_0x24899b);}}),router['get'](a0_0x52c9ed(0x159),auth,async(_0x5f4578,_0x3afb48)=>{var _0x435e70=a0_0x52c9ed;try{const {username:_0x4ec4d6,email:_0x5c0a13,role:_0x2dc3e2}=_0x5f4578[_0x435e70(0x142)],_0x29c3af=_0x5f4578[_0x435e70(0x142)],_0x1a72a5=await profile[_0x435e70(0x129)]({'email':_0x29c3af[_0x435e70(0x121)]}),_0x49fd28=await master_shop[_0x435e70(0x1e9)](),_0x430671=_0x5f4578[_0x435e70(0x149)]['id'],_0x1eb5a5=await sales['findById'](_0x430671),_0x55de90=await warehouse[_0x435e70(0x156)]([{'$match':{'name':_0x1eb5a5['warehouse_name']}},{'$unwind':_0x435e70(0x1b4)},{'$group':{'_id':_0x435e70(0x1a8),'name':{'$first':_0x435e70(0x12f)},'product_stock':{'$first':_0x435e70(0x1c4)},'bay':{'$first':_0x435e70(0x1a5)},'bin':{'$first':_0x435e70(0x1c0)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x435e70(0x1d2)},'primary_code':{'$first':_0x435e70(0x160)},'secondary_code':{'$first':_0x435e70(0x127)},'product_code':{'$first':_0x435e70(0x202)},'storage':{'$first':_0x435e70(0x117)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x435e70(0x118)},'production_date':{'$first':_0x435e70(0x21b)},'invoice':{'$first':_0x435e70(0x137)}}}]),_0x684484=await customer[_0x435e70(0x1e9)]({});let _0x441b59;if(_0x29c3af[_0x435e70(0x141)]==_0x435e70(0x16a)){const _0x2ad1a4=await staff[_0x435e70(0x129)]({'email':_0x29c3af[_0x435e70(0x121)]});_0x441b59=await warehouse[_0x435e70(0x156)]([{'$match':{'status':_0x435e70(0x1cf),'name':_0x2ad1a4['warehouse']}},{'$group':{'_id':_0x435e70(0x180),'name':{'$first':'$name'}}}]);}else _0x441b59=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x435e70(0x180),'name':{'$first':_0x435e70(0x180)}}}]);const _0x5d1fc7=await product['find']({}),_0x8ff3da=await suppliers['find']({});if(_0x49fd28[0x0][_0x435e70(0x16f)]==_0x435e70(0x145)){var _0x1ced96=users[_0x435e70(0x158)];console[_0x435e70(0x128)](_0x1ced96);}else{if(_0x49fd28[0x0][_0x435e70(0x16f)]==_0x435e70(0x1f1))var _0x1ced96=users[_0x435e70(0x1f1)];else{if(_0x49fd28[0x0]['language']==_0x435e70(0x20e))var _0x1ced96=users['German'];else{if(_0x49fd28[0x0][_0x435e70(0x16f)]=='Spanish')var _0x1ced96=users[_0x435e70(0x186)];else{if(_0x49fd28[0x0][_0x435e70(0x16f)]==_0x435e70(0x1bc))var _0x1ced96=users[_0x435e70(0x1bc)];else{if(_0x49fd28[0x0]['language']==_0x435e70(0x189))var _0x1ced96=users[_0x435e70(0x172)];else{if(_0x49fd28[0x0][_0x435e70(0x16f)]=='Chinese')var _0x1ced96=users[_0x435e70(0x11f)];else{if(_0x49fd28[0x0][_0x435e70(0x16f)]==_0x435e70(0x1a9))var _0x1ced96=users[_0x435e70(0x13e)];}}}}}}}_0x3afb48['render'](_0x435e70(0x179),{'success':_0x5f4578[_0x435e70(0x1c8)](_0x435e70(0x1de)),'errors':_0x5f4578[_0x435e70(0x1c8)](_0x435e70(0x1fa)),'role':_0x29c3af,'profile':_0x1a72a5,'customer':_0x684484,'warehouse':_0x441b59,'product':_0x55de90,'user':_0x1eb5a5,'master_shop':_0x49fd28,'unit':_0x5d1fc7,'language':_0x1ced96,'suppliers':_0x8ff3da});}catch(_0x43485f){console['log'](_0x43485f);}}),router[a0_0x52c9ed(0x115)](a0_0x52c9ed(0x159),auth,async(_0x3de60e,_0x152990)=>{var _0x34a765=a0_0x52c9ed;try{const _0x248736=_0x3de60e[_0x34a765(0x149)]['id'],{invoice:_0x2bf800,warehouse_name:_0x54a757,room:_0x74cb2b}=_0x3de60e[_0x34a765(0x113)],_0x3cf020=await sales[_0x34a765(0x129)]({'invoice':_0x2bf800}),_0x445c69=_0x3cf020[_0x34a765(0x153)][_0x34a765(0x12c)](async _0x5c8306=>{var _0x388b73=_0x34a765,_0x56b5db=await warehouse[_0x388b73(0x129)]({'name':_0x54a757,'room':_0x5c8306['room_name'],'warehouse_category':_0x388b73(0x1ac)});const _0x1c0bb4=_0x56b5db[_0x388b73(0x219)][_0x388b73(0x12c)](_0x296e12=>{var _0x51d56b=_0x388b73;_0x296e12[_0x51d56b(0x1c3)]==_0x5c8306['product_name']&&_0x296e12[_0x51d56b(0x144)]==_0x5c8306[_0x51d56b(0x144)]&&_0x296e12[_0x51d56b(0x1e0)]==_0x5c8306['type']&&_0x296e12['bin']==_0x5c8306[_0x51d56b(0x1e7)]&&_0x296e12[_0x51d56b(0x1d6)]==_0x5c8306[_0x51d56b(0x1d6)]&&_0x296e12[_0x51d56b(0x196)]==_0x5c8306[_0x51d56b(0x196)]&&_0x296e12[_0x51d56b(0x1e3)]==_0x5c8306[_0x51d56b(0x1e3)]&&_0x296e12[_0x51d56b(0x17a)]==_0x5c8306[_0x51d56b(0x17a)]&&_0x296e12[_0x51d56b(0x17f)]==_0x5c8306['batch_code']&&_0x296e12[_0x51d56b(0x148)]==_0x5c8306['id_transaction_from']&&(_0x296e12[_0x51d56b(0x17c)]=Math[_0x51d56b(0x170)](0x0,Math['abs'](_0x296e12[_0x51d56b(0x17c)])-Math[_0x51d56b(0x19b)](_0x5c8306[_0x51d56b(0x12a)])));});return _0x56b5db;});Promise[_0x34a765(0x1ca)](_0x445c69)[_0x34a765(0x204)](async _0x220fe2=>{var _0x2b9557=_0x34a765;try{for(const _0x1992d3 of _0x220fe2){await _0x1992d3[_0x2b9557(0x1bf)]();}_0x3cf020['finalize']=_0x2b9557(0x1ce);const _0x3d3f2e=await _0x3cf020[_0x2b9557(0x1bf)](),_0x4452fb=await master_shop[_0x2b9557(0x1e9)](),_0x17ddd8=await email_settings['findOne'](),_0x45ea74=await supervisor_settings[_0x2b9557(0x1e9)]();var _0x512686=_0x3cf020['sale_product'],_0x48d440='',_0xb0d3d6;for(_0xb0d3d6 in _0x512686){_0x48d440+=_0x2b9557(0x122)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x512686[_0xb0d3d6][_0x2b9557(0x1c3)]+_0x2b9557(0x1bb)+_0x2b9557(0x1b5)+_0x512686[_0xb0d3d6][_0x2b9557(0x19e)]+_0x2b9557(0x1bb)+_0x2b9557(0x1b5)+_0x512686[_0xb0d3d6][_0x2b9557(0x12a)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x512686[_0xb0d3d6][_0x2b9557(0x11d)]+_0x2b9557(0x1bb)+_0x2b9557(0x1b5)+_0x512686[_0xb0d3d6][_0x2b9557(0x1f2)]+_0x2b9557(0x1bb)+_0x2b9557(0x1b5)+_0x3cf020[_0x2b9557(0x16e)]+_0x2b9557(0x1bb)+_0x2b9557(0x1b5)+_0x512686[_0xb0d3d6][_0x2b9557(0x154)]+_0x2b9557(0x1bb)+_0x2b9557(0x1b5)+_0x512686[_0xb0d3d6]['storage']+_0x512686[_0xb0d3d6][_0x2b9557(0x196)]+_0x512686[_0xb0d3d6]['bay']+_0x512686[_0xb0d3d6][_0x2b9557(0x1e7)]+_0x512686[_0xb0d3d6][_0x2b9557(0x1e0)][0x0]+_0x512686[_0xb0d3d6][_0x2b9557(0x144)]+'</td>',_0x2b9557(0x206);}let _0x354146=nodemailer['createTransport']({'host':_0x17ddd8['host'],'port':Number(_0x17ddd8[_0x2b9557(0x161)]),'secure':![],'auth':{'user':_0x17ddd8[_0x2b9557(0x121)],'pass':_0x17ddd8[_0x2b9557(0x1fd)]}}),_0x253a80={'from':_0x17ddd8[_0x2b9557(0x121)],'to':_0x45ea74[0x0]['RMSEmail'],'subject':'Sales\x20Mail','attachments':[{'filename':_0x2b9557(0x1da),'path':__dirname+'/../public'+_0x2b9557(0x18f)+_0x4452fb[0x0][_0x2b9557(0x200)],'cid':_0x2b9557(0x187)}],'html':_0x2b9557(0x17d)+'<html><head><title></title>'+'</head><body>'+'<div>'+_0x2b9557(0x111)+_0x2b9557(0x1e5)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+'<h2>\x20'+_0x4452fb[0x0]['site_title']+_0x2b9557(0x13a)+'</div>'+_0x2b9557(0x150)+_0x2b9557(0x1f5)+'<div>'+_0x2b9557(0x1b9)+'\x20Order\x20Number\x20:\x20'+_0x3cf020['invoice']+'\x20'+_0x2b9557(0x211)+_0x2b9557(0x1e1)+_0x3cf020[_0x2b9557(0x124)]+'\x20'+_0x2b9557(0x119)+'</h5>'+_0x2b9557(0x150)+_0x2b9557(0x1f7)+_0x2b9557(0x1db)+_0x2b9557(0x122)+_0x2b9557(0x184)+_0x2b9557(0x215)+_0x2b9557(0x1d4)+_0x2b9557(0x1ec)+_0x2b9557(0x123)+_0x2b9557(0x143)+_0x2b9557(0x11c)+_0x2b9557(0x13c)+_0x2b9557(0x206)+'</thead>'+_0x2b9557(0x178)+'\x20'+_0x48d440+'\x20'+'</tbody>'+_0x2b9557(0x1ab)+_0x2b9557(0x1e5)+_0x2b9557(0x1e2)+_0x2b9557(0x176)+_0x4452fb[0x0][_0x2b9557(0x134)]+_0x2b9557(0x15c)+'</div>'+_0x2b9557(0x150)+_0x2b9557(0x214)};_0x354146[_0x2b9557(0x21a)](_0x253a80,function(_0x3c4f29,_0x5a7ee3){var _0x3c5586=_0x2b9557;_0x3c4f29?(console[_0x3c5586(0x128)](_0x3c4f29),console[_0x3c5586(0x128)]('Error\x20Occurs')):console[_0x3c5586(0x128)](_0x3c5586(0x203));}),_0x3de60e[_0x2b9557(0x1c8)](_0x2b9557(0x1de),_0x2b9557(0x147)),_0x152990[_0x2b9557(0x1dc)]('/all_sales/preview/'+_0x248736);}catch(_0x3105a7){console['error'](_0x3105a7),_0x152990[_0x2b9557(0x1ef)](0x1f4)[_0x2b9557(0x1eb)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x34a765(0x12e)](_0x1ef140=>{var _0x3b81f9=_0x34a765;console['error'](_0x1ef140),_0x152990[_0x3b81f9(0x1ef)](0x1f4)[_0x3b81f9(0x1eb)]({'error':_0x3b81f9(0x20c)});});}catch(_0x26bdc2){console['log'](_0x26bdc2);}}),router['get'](a0_0x52c9ed(0x21c),auth,async(_0x247bde,_0x132b28)=>{var _0x322913=a0_0x52c9ed;try{const {username:_0x2cab5f,email:_0x436f19,role:_0x22292c}=_0x247bde[_0x322913(0x142)],_0x2511b6=_0x247bde['user'],_0x1deac5=await profile[_0x322913(0x129)]({'email':_0x2511b6[_0x322913(0x121)]}),_0x4029ee=await master_shop[_0x322913(0x1e9)](),_0x4e0bf7=_0x247bde[_0x322913(0x149)]['id'],_0x1f82e1=await sales['findById'](_0x4e0bf7);var _0x50cce5=[_0x322913(0x139),_0x322913(0x216)];const _0x1bafbd=await warehouse[_0x322913(0x156)]([{'$match':{'name':_0x1f82e1[_0x322913(0x16e)],'warehouse_category':_0x322913(0x1ac)}},{'$unwind':_0x322913(0x1b4)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x322913(0x12f)},'product_stock':{'$first':_0x322913(0x1c4)},'bay':{'$first':_0x322913(0x1a5)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x322913(0x1fb)},'floorlevel':{'$first':_0x322913(0x1d2)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x322913(0x127)},'product_code':{'$first':_0x322913(0x202)},'storage':{'$first':_0x322913(0x117)},'rack':{'$first':_0x322913(0x1a1)}}}]),_0x177baf=await customer['find']({});let _0x5b5445;if(_0x2511b6[_0x322913(0x141)]==_0x322913(0x16a)){const _0x39ae28=await staff[_0x322913(0x129)]({'email':_0x2511b6[_0x322913(0x121)]});_0x5b5445=await warehouse[_0x322913(0x156)]([{'$match':{'status':'Enabled','name':_0x39ae28['warehouse'],'warehouse_category':_0x322913(0x1ac)}},{'$group':{'_id':'$name','name':{'$first':_0x322913(0x180)}}}]);}else _0x5b5445=await warehouse[_0x322913(0x156)]([{'$match':{'status':_0x322913(0x1cf),'warehouse_category':_0x322913(0x1ac)}},{'$group':{'_id':_0x322913(0x180),'name':{'$first':_0x322913(0x180)}}}]);const _0x4d0b9b=await product[_0x322913(0x1e9)]({});if(_0x4029ee[0x0]['language']=='English\x20(US)'){var _0x187eb7=users[_0x322913(0x158)];console[_0x322913(0x128)](_0x187eb7);}else{if(_0x4029ee[0x0][_0x322913(0x16f)]==_0x322913(0x1f1))var _0x187eb7=users[_0x322913(0x1f1)];else{if(_0x4029ee[0x0][_0x322913(0x16f)]=='German')var _0x187eb7=users[_0x322913(0x20e)];else{if(_0x4029ee[0x0][_0x322913(0x16f)]==_0x322913(0x186))var _0x187eb7=users['Spanish'];else{if(_0x4029ee[0x0][_0x322913(0x16f)]==_0x322913(0x1bc))var _0x187eb7=users[_0x322913(0x1bc)];else{if(_0x4029ee[0x0][_0x322913(0x16f)]==_0x322913(0x189))var _0x187eb7=users['Portuguese'];else{if(_0x4029ee[0x0][_0x322913(0x16f)]==_0x322913(0x11f))var _0x187eb7=users[_0x322913(0x11f)];else{if(_0x4029ee[0x0][_0x322913(0x16f)]=='Arabic\x20(ae)')var _0x187eb7=users['Arabic'];}}}}}}}_0x132b28['render'](_0x322913(0x213),{'success':_0x247bde[_0x322913(0x1c8)](_0x322913(0x1de)),'errors':_0x247bde[_0x322913(0x1c8)]('errors'),'role':_0x2511b6,'profile':_0x1deac5,'customer':_0x177baf,'warehouse':_0x5b5445,'product':_0x1bafbd,'user':_0x1f82e1,'master_shop':_0x4029ee,'unit':_0x4d0b9b,'language':_0x187eb7});}catch(_0x500428){console[_0x322913(0x128)](_0x500428);}}),router[a0_0x52c9ed(0x115)](a0_0x52c9ed(0x21c),auth,async(_0x5590cf,_0xa18dfc)=>{var _0x1a584c=a0_0x52c9ed;try{const _0x1b8120=_0x5590cf[_0x1a584c(0x149)]['id'],_0x52a669=await sales[_0x1a584c(0x129)]({'_id':_0x5590cf['params']['id']}),_0x4104bd=await warehouse[_0x1a584c(0x129)]({'name':_0x52a669[_0x1a584c(0x16e)],'room':_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x18d)]}),{invoice:_0x569db5,date:_0x26c86b,warehouse_name:_0xeb5064,product_name:_0x2a10b2,stock:_0x5e625b,quantity:_0x69fa86,note:_0x29beca,room:_0x1b61fd,customer:_0x31d1dc,SCRN:_0x2f8982}=_0x5590cf[_0x1a584c(0x113)];if(typeof _0x2a10b2==_0x1a584c(0x1d7))var _0x55e06b=[_0x5590cf[_0x1a584c(0x113)]['product_name']],_0x87b6a9=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x165)]],_0x38941e=[_0x5590cf['body'][_0x1a584c(0x190)]],_0x445ba8=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x131)]],_0x484598=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x175)]],_0x1d7395=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x16b)]],_0x20053f=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x15f)]],_0x1bddef=[_0x5590cf['body'][_0x1a584c(0x19c)]],_0xb89fd9=[_0x5590cf['body'][_0x1a584c(0x1f2)]],_0x43c4ec=[_0x5590cf[_0x1a584c(0x113)]['batch_code']],_0xbb4668=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x17a)]],_0x5a2330=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x1c2)]],_0xdc23a6=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x1e6)]],_0x1a039e=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x208)]],_0x186f5d=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x155)]],_0x20ea5a=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x15e)]],_0x26a04e=[_0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x16d)]],_0x463fd3=[_0x5590cf['body']['quantity']],_0x357fb5=[_0x5590cf['body'][_0x1a584c(0x136)]];else var _0x55e06b=[..._0x5590cf['body']['product_name']],_0x87b6a9=[..._0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x165)]],_0x38941e=[..._0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x190)]],_0x445ba8=[..._0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x131)]],_0x484598=[..._0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x175)]],_0x1d7395=[..._0x5590cf[_0x1a584c(0x113)]['prod_code']],_0x20053f=[..._0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x15f)]],_0x1bddef=[..._0x5590cf[_0x1a584c(0x113)]['primary_unit']],_0xb89fd9=[..._0x5590cf['body'][_0x1a584c(0x1f2)]],_0x43c4ec=[..._0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x17f)]],_0xbb4668=[..._0x5590cf[_0x1a584c(0x113)]['expiry_date']],_0x5a2330=[..._0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x1c2)]],_0xdc23a6=[..._0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x1e6)]],_0x1a039e=[..._0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x208)]],_0x186f5d=[..._0x5590cf['body'][_0x1a584c(0x155)]],_0x20ea5a=[..._0x5590cf['body']['delivery_code']],_0x26a04e=[..._0x5590cf[_0x1a584c(0x113)][_0x1a584c(0x16d)]],_0x463fd3=[..._0x5590cf[_0x1a584c(0x113)]['quantity']],_0x357fb5=[..._0x5590cf['body'][_0x1a584c(0x136)]];const _0x1a4c6b=_0x55e06b[_0x1a584c(0x12c)](_0x282af5=>{return _0x282af5={'product_name':_0x282af5};});_0x87b6a9['forEach']((_0x85979c,_0x17ba98)=>{_0x1a4c6b[_0x17ba98]['stock']=Math['abs'](_0x85979c);}),_0x38941e[_0x1a584c(0x1b2)]((_0x351ad8,_0x22fa5e)=>{var _0x22983a=_0x1a584c;_0x1a4c6b[_0x22fa5e][_0x22983a(0x12a)]=_0x351ad8;}),_0x445ba8[_0x1a584c(0x1b2)]((_0x4c926d,_0x52dcc7)=>{_0x1a4c6b[_0x52dcc7]['primary_code']=_0x4c926d;}),_0x484598[_0x1a584c(0x1b2)]((_0x2a87ba,_0xa0fed7)=>{var _0x427447=_0x1a584c;_0x1a4c6b[_0xa0fed7][_0x427447(0x175)]=_0x2a87ba;}),_0x1d7395[_0x1a584c(0x1b2)]((_0x24da11,_0xb31e81)=>{var _0x545f4d=_0x1a584c;_0x1a4c6b[_0xb31e81][_0x545f4d(0x19e)]=_0x24da11;}),_0x20053f['forEach']((_0xeefd36,_0x2b038c)=>{var _0x2a84eb=_0x1a584c;_0x357fb5[_0x2a84eb(0x1b2)]((_0x471010,_0x52884b)=>{var _0x9b952e=_0x2a84eb;if(_0x471010==_0x9b952e(0x194)&&_0x2b038c==_0x52884b){var _0x571682=_0xeefd36[_0x9b952e(0x133)](0x3);_0x1a4c6b[_0x2b038c][_0x9b952e(0x1e3)]=_0xeefd36[0x0],_0x1a4c6b[_0x2b038c][_0x9b952e(0x196)]=_0xeefd36[0x1],_0x1a4c6b[_0x2b038c][_0x9b952e(0x1d6)]=0x0,_0x1a4c6b[_0x2b038c][_0x9b952e(0x1e7)]=0x0,_0x1a4c6b[_0x2b038c]['type']=_0x9b952e(0x1d5),_0x1a4c6b[_0x2b038c][_0x9b952e(0x144)]=_0x571682;}else{if(_0x471010==_0x9b952e(0x1a6)&&_0x2b038c==_0x52884b){var _0x571682=_0xeefd36[_0x9b952e(0x133)](0x3);_0x1a4c6b[_0x2b038c]['storage']=_0xeefd36[0x0],_0x1a4c6b[_0x2b038c][_0x9b952e(0x196)]=_0xeefd36[0x1],_0x1a4c6b[_0x2b038c]['bay']=0x0,_0x1a4c6b[_0x2b038c][_0x9b952e(0x1e7)]=0x0,_0x1a4c6b[_0x2b038c][_0x9b952e(0x1e0)]=_0x9b952e(0x1d5),_0x1a4c6b[_0x2b038c][_0x9b952e(0x144)]=_0xeefd36[0x5];}else{if(_0x2b038c==_0x52884b){var _0x50e8b0;if(_0xeefd36[0x4]=='L')_0x50e8b0=_0x9b952e(0x19a);else _0xeefd36[0x4]=='F'&&(_0x50e8b0=_0x9b952e(0x1d5));_0x1a4c6b[_0x2b038c]['storage']=_0xeefd36[0x0],_0x1a4c6b[_0x2b038c][_0x9b952e(0x196)]=_0xeefd36[0x1],_0x1a4c6b[_0x2b038c]['bay']=_0xeefd36[0x2],_0x1a4c6b[_0x2b038c][_0x9b952e(0x1e7)]=_0xeefd36[0x3],_0x1a4c6b[_0x2b038c][_0x9b952e(0x1e0)]=_0x50e8b0,_0x1a4c6b[_0x2b038c][_0x9b952e(0x144)]=_0xeefd36[0x5];}}}});}),_0x1bddef[_0x1a584c(0x1b2)]((_0x1d5d12,_0x49ea2f)=>{var _0x493111=_0x1a584c;_0x1a4c6b[_0x49ea2f][_0x493111(0x11d)]=_0x1d5d12;}),_0xb89fd9[_0x1a584c(0x1b2)]((_0x5bfd80,_0xd41fa3)=>{var _0x56db18=_0x1a584c;_0x1a4c6b[_0xd41fa3][_0x56db18(0x1f2)]=_0x5bfd80;}),_0x43c4ec['forEach']((_0x139ecd,_0x202464)=>{var _0xbfba6=_0x1a584c;_0x1a4c6b[_0x202464][_0xbfba6(0x17f)]=_0x139ecd;}),_0xbb4668['forEach']((_0x2979b7,_0x221f31)=>{var _0xfc3d39=_0x1a584c;_0x1a4c6b[_0x221f31][_0xfc3d39(0x17a)]=_0x2979b7;}),_0x5a2330[_0x1a584c(0x1b2)]((_0x59e330,_0x60f6f2)=>{var _0x37741=_0x1a584c;_0x1a4c6b[_0x60f6f2][_0x37741(0x132)]=_0x59e330;}),_0xdc23a6[_0x1a584c(0x1b2)]((_0x4501c0,_0x9e3530)=>{var _0x18364b=_0x1a584c;_0x1a4c6b[_0x9e3530][_0x18364b(0x1e6)]=_0x4501c0;}),_0x1a039e['forEach']((_0xf787f3,_0x2a1a53)=>{var _0x138ec7=_0x1a584c;_0x1a4c6b[_0x2a1a53][_0x138ec7(0x208)]=Math[_0x138ec7(0x19b)](_0xf787f3);}),_0x186f5d[_0x1a584c(0x1b2)]((_0x40a851,_0x1cef27)=>{_0x1a4c6b[_0x1cef27]['delivery_date']=_0x40a851;}),_0x20ea5a[_0x1a584c(0x1b2)]((_0x812a68,_0xfc060b)=>{_0x1a4c6b[_0xfc060b]['delivery_code']=_0x812a68;}),_0x26a04e[_0x1a584c(0x1b2)]((_0x287afe,_0x22a79a)=>{var _0x3d19fe=_0x1a584c;_0x1a4c6b[_0x22a79a][_0x3d19fe(0x16d)]=_0x287afe;}),_0x463fd3['forEach']((_0x3e1e28,_0x260970)=>{var _0x53cf97=_0x1a584c;_0x1a4c6b[_0x260970][_0x53cf97(0x1d8)]=_0x3e1e28;}),_0x357fb5[_0x1a584c(0x1b2)]((_0x4d30ed,_0x2fc940)=>{var _0x4d48b4=_0x1a584c;_0x1a4c6b[_0x2fc940][_0x4d48b4(0x154)]=_0x4d30ed;});var _0x207d81=0x0;_0x1a4c6b[_0x1a584c(0x1b2)](_0x5a4298=>{var _0x3afd43=_0x1a584c;console[_0x3afd43(0x128)](_0x3afd43(0x18c),_0x5a4298),(parseInt(_0x5a4298[_0x3afd43(0x165)])<parseInt(_0x5a4298[_0x3afd43(0x12a)])||parseInt(_0x5a4298['quantity'])==0x0)&&_0x207d81++;});if(_0x207d81!=0x0)return _0x5590cf[_0x1a584c(0x1c8)](_0x1a584c(0x1fa),_0x1a584c(0x163)),_0xa18dfc[_0x1a584c(0x1dc)]('back');const _0xf423eb=_0x1a4c6b[_0x1a584c(0x1e4)](_0x14f6bf=>_0x14f6bf[_0x1a584c(0x12a)]!=='0'&&_0x14f6bf['quantity']!=='');_0x52a669['invoice']=_0x569db5,_0x52a669[_0x1a584c(0x10c)]=_0x31d1dc,_0x52a669[_0x1a584c(0x124)]=_0x26c86b,_0x52a669['warehouse_name']=_0xeb5064,_0x52a669[_0x1a584c(0x153)]=_0xf423eb,_0x52a669[_0x1a584c(0x17b)]=_0x29beca,_0x52a669[_0x1a584c(0x10f)]=_0x2f8982,_0x52a669['finalize']=_0x1a584c(0x20d),_0x52a669['isAllowEdit']=_0x1a584c(0x20d);const _0x236aff=await _0x52a669[_0x1a584c(0x1bf)]();_0x5590cf[_0x1a584c(0x1c8)](_0x1a584c(0x1de),_0x1a584c(0x147)),_0xa18dfc[_0x1a584c(0x1dc)](_0x1a584c(0x197));}catch(_0x3e11e2){console[_0x1a584c(0x128)](_0x3e11e2);}}),router['post'](a0_0x52c9ed(0x1df),auth,async(_0x551ac8,_0x404678)=>{var _0xb9cc2a=a0_0x52c9ed;try{const _0x5be142=_0x551ac8[_0xb9cc2a(0x149)]['id'],{invoice:_0x172faf,customer:_0x4533a4,receivable_amount:_0x4719c7,received_amount:_0x5df841}=_0x551ac8[_0xb9cc2a(0x113)],_0xa172c6=await sales[_0xb9cc2a(0x21d)](_0x5be142);console['log'](_0xa172c6);var _0x3d81cd=_0x4719c7-_0x5df841;console[_0xb9cc2a(0x128)](_0x5df841),_0xa172c6[_0xb9cc2a(0x177)]=parseFloat(_0x5df841)+parseFloat(_0xa172c6[_0xb9cc2a(0x177)]),_0xa172c6[_0xb9cc2a(0x1cd)]=_0x3d81cd,console[_0xb9cc2a(0x128)](_0xa172c6);const _0x2b4036=await _0xa172c6[_0xb9cc2a(0x1bf)](),_0x3b9cf6=await c_payment_data[_0xb9cc2a(0x129)]({'invoice':_0x172faf});_0x3b9cf6['amount']=_0x3d81cd,await _0x3b9cf6[_0xb9cc2a(0x1bf)]();let _0x58d1ff=new Date(),_0x1cd419=('0'+_0x58d1ff[_0xb9cc2a(0x1af)]())[_0xb9cc2a(0x133)](-0x2),_0x3de1f7=('0'+(_0x58d1ff[_0xb9cc2a(0x1fc)]()+0x1))[_0xb9cc2a(0x133)](-0x2),_0x13ed38=_0x58d1ff[_0xb9cc2a(0x1cb)](),_0x566eb1=_0x13ed38+'-'+_0x3de1f7+'-'+_0x1cd419;const _0x16e232=new customer_payment({'invoice':_0x172faf,'date':_0x13ed38+'-'+_0x3de1f7+'-'+_0x1cd419,'customer':_0x4533a4,'reason':_0xb9cc2a(0x182),'amount':_0x5df841}),_0xc545e=await _0x16e232[_0xb9cc2a(0x1bf)]();_0x551ac8['flash'](_0xb9cc2a(0x1de),_0xb9cc2a(0x1b0)),_0x404678[_0xb9cc2a(0x1dc)](_0xb9cc2a(0x197));}catch(_0x43fd7f){console[_0xb9cc2a(0x128)](_0x43fd7f);}}),router[a0_0x52c9ed(0x1ba)]('/invoice/:id',auth,async(_0x55e714,_0x3c3a16)=>{var _0x62c61e=a0_0x52c9ed;try{const {username:_0x4d2333,email:_0x491b17,role:_0x3ac395}=_0x55e714[_0x62c61e(0x142)],_0x131a46=_0x55e714['user'],_0x324fef=await profile[_0x62c61e(0x129)]({'email':_0x131a46[_0x62c61e(0x121)]}),_0x181673=await master_shop['find']();console[_0x62c61e(0x128)](_0x62c61e(0x1d0),_0x181673);const _0x3a7ea1=_0x55e714[_0x62c61e(0x149)]['id'],_0x4371ea=await sales[_0x62c61e(0x21d)](_0x3a7ea1);console[_0x62c61e(0x128)](_0x4371ea);const _0x1b522a=await customer[_0x62c61e(0x129)]({'name':_0x4371ea['customer']});console[_0x62c61e(0x128)](_0x1b522a);if(_0x181673[0x0][_0x62c61e(0x16f)]=='English\x20(US)'){var _0x19e144=users[_0x62c61e(0x158)];console['log'](_0x19e144);}else{if(_0x181673[0x0]['language']==_0x62c61e(0x1f1))var _0x19e144=users['Hindi'];else{if(_0x181673[0x0]['language']==_0x62c61e(0x20e))var _0x19e144=users[_0x62c61e(0x20e)];else{if(_0x181673[0x0][_0x62c61e(0x16f)]==_0x62c61e(0x186))var _0x19e144=users[_0x62c61e(0x186)];else{if(_0x181673[0x0][_0x62c61e(0x16f)]==_0x62c61e(0x1bc))var _0x19e144=users['French'];else{if(_0x181673[0x0][_0x62c61e(0x16f)]==_0x62c61e(0x189))var _0x19e144=users['Portuguese'];else{if(_0x181673[0x0][_0x62c61e(0x16f)]==_0x62c61e(0x11f))var _0x19e144=users[_0x62c61e(0x11f)];else{if(_0x181673[0x0][_0x62c61e(0x16f)]=='Arabic\x20(ae)')var _0x19e144=users[_0x62c61e(0x13e)];}}}}}}}_0x3c3a16['render']('sales_invoice',{'success':_0x55e714['flash'](_0x62c61e(0x1de)),'errors':_0x55e714[_0x62c61e(0x1c8)](_0x62c61e(0x1fa)),'role':_0x131a46,'profile':_0x324fef,'master_shop':_0x181673,'customers':_0x1b522a,'sales':_0x4371ea,'language':_0x19e144});}catch(_0x444dba){console[_0x62c61e(0x128)](_0x444dba);}}),router[a0_0x52c9ed(0x1ba)]('/view/return_sales/:id',auth,async(_0x32a32f,_0x5491b1)=>{var _0x1baa86=a0_0x52c9ed;try{const {username:_0x3866c0,email:_0x733a4c,role:_0x2e1ac3}=_0x32a32f['user'],_0x30ada6=_0x32a32f[_0x1baa86(0x142)],_0x1378c7=await profile[_0x1baa86(0x129)]({'email':_0x30ada6[_0x1baa86(0x121)]}),_0x17c7f8=await master_shop['find']();console['log'](_0x1baa86(0x1d0),_0x17c7f8);const _0x1835a0=_0x32a32f[_0x1baa86(0x149)]['id'];console['log'](_0x1835a0);const _0x378f27=await sales[_0x1baa86(0x21d)](_0x1835a0);console['log'](_0x1baa86(0x201),_0x378f27);const _0x94cc09=await warehouse[_0x1baa86(0x156)]([{'$match':{'name':'Return\x20Goods','room':_0x1baa86(0x1c1)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1baa86(0x1a8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1baa86(0x1c4)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x1baa86(0x110)},'pallet':{'$first':_0x1baa86(0x193)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1baa86(0x127)},'product_code':{'$first':_0x1baa86(0x202)}}}]);console[_0x1baa86(0x128)](_0x1baa86(0x164),_0x94cc09);const _0xe15ede=await product[_0x1baa86(0x1e9)]({});warehouse_data=await warehouse[_0x1baa86(0x156)]([{'$match':{'status':'Enabled','name':_0x1baa86(0x209),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x1baa86(0x180)}}},{'$sort':{'name':0x1}}]);var _0x59a772=[_0x1baa86(0x1c1)];if(_0x17c7f8[0x0]['language']==_0x1baa86(0x145)){var _0xa52a8d=users[_0x1baa86(0x158)];console[_0x1baa86(0x128)](_0xa52a8d);}else{if(_0x17c7f8[0x0][_0x1baa86(0x16f)]=='Hindi')var _0xa52a8d=users[_0x1baa86(0x1f1)];else{if(_0x17c7f8[0x0][_0x1baa86(0x16f)]==_0x1baa86(0x20e))var _0xa52a8d=users['German'];else{if(_0x17c7f8[0x0][_0x1baa86(0x16f)]==_0x1baa86(0x186))var _0xa52a8d=users['Spanish'];else{if(_0x17c7f8[0x0][_0x1baa86(0x16f)]==_0x1baa86(0x1bc))var _0xa52a8d=users[_0x1baa86(0x1bc)];else{if(_0x17c7f8[0x0]['language']==_0x1baa86(0x189))var _0xa52a8d=users['Portuguese'];else{if(_0x17c7f8[0x0][_0x1baa86(0x16f)]=='Chinese')var _0xa52a8d=users[_0x1baa86(0x11f)];else{if(_0x17c7f8[0x0][_0x1baa86(0x16f)]==_0x1baa86(0x1a9))var _0xa52a8d=users['Arabic'];}}}}}}}_0x5491b1[_0x1baa86(0x1a0)](_0x1baa86(0x181),{'success':_0x32a32f['flash'](_0x1baa86(0x1de)),'errors':_0x32a32f[_0x1baa86(0x1c8)]('errors'),'role':_0x30ada6,'profile':_0x1378c7,'user':_0x378f27,'stock':_0x94cc09,'master_shop':_0x17c7f8,'unit':_0xe15ede,'language':_0xa52a8d,'warehouses':warehouse_data,'rooms':_0x59a772});}catch(_0x4d3dff){console[_0x1baa86(0x128)](_0x4d3dff),_0x5491b1[_0x1baa86(0x1ef)](0xc8)[_0x1baa86(0x1eb)]({'message':_0x4d3dff['message']});}}),router[a0_0x52c9ed(0x115)]('/view/return_sales/:id',auth,async(_0x4cad49,_0x11eedc)=>{var _0x23aedc=a0_0x52c9ed;try{const {invoice:_0x14a4af,date:_0x369332,warehouse_name:_0x23ff89,product_name:_0x4f770c,primary_code:_0x1d7d52,secondary_code:_0x37d165,product_code:_0x58942e,sales_quantity:_0x152726,stocks:_0x31d557,return_qty:_0x98c5f4,Room_name:_0x219e5f,to_warehouse_name:_0x534e0f,to_Roomname:_0x1b9cf6,to_Room_name:_0x3effe4,note:_0x3f4701,level:_0x3782b6,isle:_0x573e81,pallet:_0x5b95a3}=_0x4cad49[_0x23aedc(0x113)];if(typeof _0x4f770c==_0x23aedc(0x1d7))var _0x4ffc9f=[_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x1c3)]],_0x5354f8=[_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x131)]],_0x4d5f8d=[_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x175)]],_0x283abd=[_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x19e)]],_0x5acd58=[_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x1b6)]],_0x37d8f7=[_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x1f9)]],_0x2b4800=[_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x1ee)]],_0xf42648=[_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x1d6)]],_0x49bd37=[_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x1e7)]],_0x1bf862=[_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x1f3)]],_0x5c9199=[_0x4cad49[_0x23aedc(0x113)]['floorlevel']];else var _0x4ffc9f=[..._0x4cad49['body'][_0x23aedc(0x1c3)]],_0x5354f8=[..._0x4cad49[_0x23aedc(0x113)]['primary_code']],_0x4d5f8d=[..._0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x175)]],_0x283abd=[..._0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x19e)]],_0x5acd58=[..._0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x1b6)]],_0x37d8f7=[..._0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x1f9)]],_0x2b4800=[..._0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x1ee)]],_0xf42648=[..._0x4cad49['body'][_0x23aedc(0x1d6)]],_0x49bd37=[..._0x4cad49['body'][_0x23aedc(0x1e7)]],_0x1bf862=[..._0x4cad49[_0x23aedc(0x113)]['types']],_0x5c9199=[..._0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x144)]];const _0x3c966b=_0x4ffc9f[_0x23aedc(0x12c)](_0x322e36=>{return _0x322e36={'product_name':_0x322e36};});_0x5354f8[_0x23aedc(0x1b2)]((_0x3e2d6e,_0x2dea1f)=>{var _0x21ed7f=_0x23aedc;_0x3c966b[_0x2dea1f][_0x21ed7f(0x131)]=_0x3e2d6e;}),_0x4d5f8d['forEach']((_0x18c9b8,_0x2a1510)=>{var _0x2c65ee=_0x23aedc;_0x3c966b[_0x2a1510][_0x2c65ee(0x175)]=_0x18c9b8;}),_0x283abd[_0x23aedc(0x1b2)]((_0x19eebc,_0x4e787e)=>{var _0x5e82d8=_0x23aedc;_0x3c966b[_0x4e787e][_0x5e82d8(0x19e)]=_0x19eebc;}),_0x5acd58[_0x23aedc(0x1b2)]((_0x3655ba,_0x2221f9)=>{var _0x3873fc=_0x23aedc;_0x3c966b[_0x2221f9][_0x3873fc(0x217)]=_0x3655ba;}),_0x37d8f7[_0x23aedc(0x1b2)]((_0x30a727,_0x36126d)=>{_0x3c966b[_0x36126d]['stock']=_0x30a727;}),_0x2b4800[_0x23aedc(0x1b2)]((_0x1dfe6b,_0x25e36b)=>{_0x3c966b[_0x25e36b]['return_qty']=_0x1dfe6b;}),_0xf42648[_0x23aedc(0x1b2)]((_0x1404e2,_0x230ec1)=>{var _0x18b955=_0x23aedc;_0x3c966b[_0x230ec1][_0x18b955(0x1d6)]=_0x1404e2;}),_0x49bd37[_0x23aedc(0x1b2)]((_0x4ca505,_0x3f773c)=>{_0x3c966b[_0x3f773c]['bin']=_0x4ca505;}),_0x1bf862[_0x23aedc(0x1b2)]((_0x162dae,_0x3f00c8)=>{var _0x1b5eb9=_0x23aedc;_0x3c966b[_0x3f00c8][_0x1b5eb9(0x1e0)]=_0x162dae;}),_0x5c9199[_0x23aedc(0x1b2)]((_0x645dec,_0x4dd876)=>{_0x3c966b[_0x4dd876]['floorlevel']=_0x645dec;});var _0xc4dcad=0x0;_0x3c966b[_0x23aedc(0x1b2)](_0x1709a4=>{var _0xb0e08b=_0x23aedc;console[_0xb0e08b(0x128)](_0xb0e08b(0x18c),_0x1709a4),(parseInt(_0x1709a4[_0xb0e08b(0x217)])<parseInt(_0x1709a4['return_qty'])||parseInt(_0x1709a4[_0xb0e08b(0x165)])<parseInt(_0x1709a4[_0xb0e08b(0x1ee)])&&parseInt(_0x1709a4[_0xb0e08b(0x217)])>parseInt(_0x1709a4[_0xb0e08b(0x1ee)])||parseInt(_0x1709a4[_0xb0e08b(0x1ee)])==0x0)&&_0xc4dcad++;});if(_0xc4dcad!=0x0)return _0x4cad49['flash'](_0x23aedc(0x1fa),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x11eedc[_0x23aedc(0x1dc)]('back');const _0x55e2d1=await sales[_0x23aedc(0x129)]({'invoice':_0x14a4af});console[_0x23aedc(0x128)](_0x55e2d1),_0x55e2d1[_0x23aedc(0x14a)]='True';const _0x43fe29=await _0x55e2d1[_0x23aedc(0x1bf)](),_0x1654a9=new sales_return({'invoice':_0x14a4af,'customer':_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x10c)],'date':_0x369332,'warehouse_name':_0x23ff89,'room':_0x219e5f,'ToWarehouse':_0x534e0f,'ToRoom':_0x3effe4,'return_sale':_0x3c966b,'note':_0x3f4701}),_0x43b486=await _0x1654a9[_0x23aedc(0x1bf)]();console[_0x23aedc(0x128)](_0x1654a9);const _0x3c72ed=await sales_return['findOne']({'invoice':_0x14a4af}),_0x42e471=await warehouse[_0x23aedc(0x129)]({'name':_0x534e0f,'room':_0x3effe4});_0x3c72ed['return_sale'][_0x23aedc(0x1b2)](_0x16608a=>{var _0x7de05a=_0x23aedc,_0x1c7c15=0x0;const _0x13bcea=_0x42e471[_0x7de05a(0x219)][_0x7de05a(0x12c)](_0x262939=>{var _0x1e7f01=_0x7de05a;_0x262939['product_name']==_0x16608a[_0x1e7f01(0x1c3)]&&_0x262939[_0x1e7f01(0x144)]==_0x16608a[_0x1e7f01(0x144)]&&_0x262939[_0x1e7f01(0x1e0)]==_0x16608a['type']&&_0x262939[_0x1e7f01(0x1e7)]==_0x16608a[_0x1e7f01(0x1e7)]&&_0x262939[_0x1e7f01(0x1d6)]==_0x16608a[_0x1e7f01(0x1d6)]&&(_0x262939[_0x1e7f01(0x17c)]=parseInt(_0x262939[_0x1e7f01(0x17c)])+parseInt(_0x16608a['return_qty']),_0x1c7c15++);});_0x1c7c15=='0'&&(_0x42e471['product_details']=_0x42e471['product_details'][_0x7de05a(0x14e)]({'product_name':_0x16608a[_0x7de05a(0x1c3)],'product_stock':_0x16608a[_0x7de05a(0x1ee)],'primary_code':_0x16608a[_0x7de05a(0x131)],'secondary_code':_0x16608a['secondary_code'],'product_code':_0x16608a[_0x7de05a(0x19e)],'bay':_0x16608a[_0x7de05a(0x1d6)],'bin':_0x16608a[_0x7de05a(0x1e7)],'type':_0x16608a[_0x7de05a(0x1e0)],'floorlevel':_0x16608a[_0x7de05a(0x144)]})),console[_0x7de05a(0x128)](_0x7de05a(0x13b),_0x42e471);}),await _0x42e471[_0x23aedc(0x1bf)](),console[_0x23aedc(0x128)](_0x4cad49[_0x23aedc(0x113)]);const _0x18f8ac=new c_payment_data({'invoice':_0x14a4af,'customer':_0x4cad49[_0x23aedc(0x113)][_0x23aedc(0x10c)],'reason':_0x23aedc(0x1f4)});await _0x18f8ac[_0x23aedc(0x1bf)]();const _0x49fdfa=await master_shop[_0x23aedc(0x1e9)]();console['log'](_0x23aedc(0x1a2),_0x49fdfa[0x0][_0x23aedc(0x200)]);const _0x24dac9=await email_settings[_0x23aedc(0x129)](),_0x108593=await customer[_0x23aedc(0x129)]({'name':_0x4cad49['body'][_0x23aedc(0x10c)]});console['log']('customer_data',_0x108593);_0x49fdfa[0x0][_0x23aedc(0x198)]==0x1?(right_currency=_0x49fdfa[0x0][_0x23aedc(0x1a4)],left_currency=''):(right_currency='',left_currency=_0x49fdfa[0x0]['currency']);var _0x164602=_0x4ffc9f,_0x236fcb=_0x2b4800,_0x3897ec='',_0xc21467;for(_0xc21467 in _0x164602){_0x3897ec+=_0x23aedc(0x122)+_0x23aedc(0x1b5)+_0x164602[_0xc21467]+_0x23aedc(0x1bb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x236fcb[_0xc21467]+'</td>'+_0x23aedc(0x206);}console['log'](_0x23aedc(0x14b),_0x3897ec);let _0x3d8d21=nodemailer[_0x23aedc(0x15b)]({'service':_0x23aedc(0x1ea),'auth':{'user':_0x24dac9['email'],'pass':_0x24dac9[_0x23aedc(0x1fd)]}}),_0x337fb5={'from':_0x24dac9[_0x23aedc(0x121)],'to':_0x108593['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x23aedc(0x1da),'path':__dirname+_0x23aedc(0x167)+_0x23aedc(0x18f)+_0x49fdfa[0x0]['image'],'cid':'logo'}],'html':_0x23aedc(0x17d)+_0x23aedc(0x10d)+_0x23aedc(0x116)+_0x23aedc(0x1e5)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x23aedc(0x1e5)+_0x23aedc(0x1bd)+_0x23aedc(0x150)+_0x23aedc(0x1e5)+'<h2>\x20'+_0x49fdfa[0x0][_0x23aedc(0x134)]+_0x23aedc(0x13a)+'</div>'+_0x23aedc(0x150)+_0x23aedc(0x1f5)+'<div>'+_0x23aedc(0x1b9)+_0x23aedc(0x20f)+_0x14a4af+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x369332+'\x20'+'</span>'+_0x23aedc(0x15c)+'</div>'+_0x23aedc(0x1f7)+_0x23aedc(0x1db)+_0x23aedc(0x122)+_0x23aedc(0x184)+_0x23aedc(0x1cc)+_0x23aedc(0x15d)+_0x23aedc(0x120)+_0x23aedc(0x206)+_0x23aedc(0x192)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3897ec+'\x20'+_0x23aedc(0x20b)+'</table>'+_0x23aedc(0x1e5)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x49fdfa[0x0][_0x23aedc(0x134)]+_0x23aedc(0x15c)+_0x23aedc(0x150)+_0x23aedc(0x150)+'</body></html>'};_0x3d8d21[_0x23aedc(0x21a)](_0x337fb5,function(_0x5bdb46,_0x5c08b7){var _0x2c5eea=_0x23aedc;_0x5bdb46?(console['log'](_0x5bdb46),console[_0x2c5eea(0x128)]('Error\x20Occurs')):console[_0x2c5eea(0x128)]('Email\x20sent\x20successfully');}),_0x4cad49[_0x23aedc(0x1c8)](_0x23aedc(0x1de),_0x23aedc(0x151)),_0x11eedc[_0x23aedc(0x1dc)](_0x23aedc(0x197));}catch(_0x5526d7){console[_0x23aedc(0x128)](_0x5526d7),_0x11eedc['status'](0xc8)['json']({'message1':_0x5526d7[_0x23aedc(0x207)]});}}),router['get']('/barcode/:id',auth,async(_0x3211ab,_0xd91daf)=>{var _0x1b7dfc=a0_0x52c9ed;try{const {username:_0x3c2bc2,email:_0x5324a8,role:_0x53c63a}=_0x3211ab[_0x1b7dfc(0x142)],_0x31c107=_0x3211ab['user'],_0x4ec711=await profile[_0x1b7dfc(0x129)]({'email':_0x31c107['email']}),_0x2f576d=await master_shop[_0x1b7dfc(0x1e9)]();console[_0x1b7dfc(0x128)](_0x1b7dfc(0x1c7),_0x2f576d);const _0x241bf6=_0x3211ab[_0x1b7dfc(0x149)]['id'],_0x21a3d7=await sales['findById'](_0x241bf6);console[_0x1b7dfc(0x128)](_0x1b7dfc(0x185),_0x21a3d7);if(_0x2f576d[0x0][_0x1b7dfc(0x16f)]==_0x1b7dfc(0x145))var _0x1a871f=users['English'];else{if(_0x2f576d[0x0][_0x1b7dfc(0x16f)]==_0x1b7dfc(0x1f1))var _0x1a871f=users['Hindi'];else{if(_0x2f576d[0x0][_0x1b7dfc(0x16f)]==_0x1b7dfc(0x20e))var _0x1a871f=users[_0x1b7dfc(0x20e)];else{if(_0x2f576d[0x0]['language']=='Spanish')var _0x1a871f=users[_0x1b7dfc(0x186)];else{if(_0x2f576d[0x0][_0x1b7dfc(0x16f)]=='French')var _0x1a871f=users[_0x1b7dfc(0x1bc)];else{if(_0x2f576d[0x0]['language']==_0x1b7dfc(0x189))var _0x1a871f=users[_0x1b7dfc(0x172)];else{if(_0x2f576d[0x0][_0x1b7dfc(0x16f)]==_0x1b7dfc(0x11f))var _0x1a871f=users[_0x1b7dfc(0x11f)];else{if(_0x2f576d[0x0][_0x1b7dfc(0x16f)]==_0x1b7dfc(0x1a9))var _0x1a871f=users['Arabic'];}}}}}}}_0xd91daf[_0x1b7dfc(0x1a0)](_0x1b7dfc(0x15a),{'success':_0x3211ab[_0x1b7dfc(0x1c8)]('success'),'errors':_0x3211ab[_0x1b7dfc(0x1c8)](_0x1b7dfc(0x1fa)),'role':_0x31c107,'profile':_0x4ec711,'alldata':_0x21a3d7,'master_shop':_0x2f576d,'language':_0x1a871f});}catch(_0x1dd067){console['log'](_0x1dd067);}}),router['post'](a0_0x52c9ed(0x1ff),async(_0x28bbd8,_0x5a05aa)=>{var _0x2b4e4a=a0_0x52c9ed;const {product_code:_0x1b287d,warehouse_name:_0x54ce76,rooms_data:_0x1c6ec0,Roomslist:_0x2ae9f5}=_0x28bbd8[_0x2b4e4a(0x113)],_0x218d05=_0x2ae9f5[_0x2b4e4a(0x1c6)](','),_0x6c1c0e=[];async function _0x26bad5(_0x48cb06){var _0x478748=_0x2b4e4a;const _0x412c6c=await warehouse[_0x478748(0x156)]([{'$match':{'name':_0x54ce76,'room':_0x48cb06}},{'$unwind':_0x478748(0x1b4)},{'$match':{'product_details.primary_code':_0x1b287d}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x478748(0x12f)},'product_stock':{'$first':_0x478748(0x1c4)},'primary_code':{'$first':_0x478748(0x160)},'secondary_code':{'$first':_0x478748(0x127)},'product_code':{'$first':_0x478748(0x202)},'level':{'$first':_0x478748(0x1a5)},'isle':{'$first':_0x478748(0x1c0)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x478748(0x1d2)},'unit':{'$first':_0x478748(0x1fe)},'secondary_unit':{'$first':_0x478748(0x171)},'storage':{'$first':_0x478748(0x117)},'rack':{'$first':_0x478748(0x1a1)},'expiry_date':{'$first':_0x478748(0x118)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x478748(0x18a)},'batch_code':{'$first':_0x478748(0x157)},'product_cat':{'$first':_0x478748(0x17e)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x478748(0x137)},'actual_qty':{'$first':_0x478748(0x14c)},'actual_uom':{'$first':_0x478748(0x126)},'delivery_date':{'$first':_0x478748(0x1f8)},'delivery_code':{'$first':_0x478748(0x12d)}}}]),_0x2ff1d8=await warehouse[_0x478748(0x156)]([{'$match':{'name':_0x54ce76,'room':_0x48cb06}},{'$unwind':_0x478748(0x1b4)},{'$match':{'product_details.secondary_code':_0x1b287d}},{'$group':{'_id':_0x478748(0x1a8),'name':{'$first':_0x478748(0x12f)},'product_stock':{'$first':_0x478748(0x1c4)},'primary_code':{'$first':_0x478748(0x160)},'secondary_code':{'$first':_0x478748(0x127)},'product_code':{'$first':_0x478748(0x202)},'level':{'$first':_0x478748(0x1a5)},'isle':{'$first':_0x478748(0x1c0)},'type':{'$first':_0x478748(0x1fb)},'pallet':{'$first':_0x478748(0x1d2)},'unit':{'$first':_0x478748(0x1fe)},'secondary_unit':{'$first':_0x478748(0x171)},'storage':{'$first':_0x478748(0x117)},'rack':{'$first':_0x478748(0x1a1)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x478748(0x21b)},'maxPerUnit':{'$first':_0x478748(0x18a)},'batch_code':{'$first':_0x478748(0x157)},'product_cat':{'$first':_0x478748(0x17e)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x478748(0x130)},'invoice':{'$first':_0x478748(0x137)},'delivery_date':{'$first':_0x478748(0x1f8)},'delivery_code':{'$first':_0x478748(0x12d)}}}]);if(_0x412c6c[_0x478748(0x16c)]>0x0)_0x6c1c0e[_0x478748(0x1a3)](_0x412c6c);else _0x2ff1d8[_0x478748(0x16c)]>0x0&&_0x6c1c0e['push'](_0x2ff1d8);}const _0x316a0d=_0x218d05[_0x2b4e4a(0x12c)](_0x3d7218=>_0x26bad5(_0x3d7218));await Promise[_0x2b4e4a(0x1ca)](_0x316a0d),_0x5a05aa[_0x2b4e4a(0x1eb)](_0x6c1c0e);}),module['exports']=router;