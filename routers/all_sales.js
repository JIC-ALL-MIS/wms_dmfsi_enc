var a0_0x15c2a4=a0_0x5cc7;(function(_0x595152,_0x5f5c5a){var _0x426ae0=a0_0x5cc7,_0x2cc4d3=_0x595152();while(!![]){try{var _0x1d86b5=parseInt(_0x426ae0(0x182))/0x1+-parseInt(_0x426ae0(0xc4))/0x2*(-parseInt(_0x426ae0(0x154))/0x3)+parseInt(_0x426ae0(0x110))/0x4*(parseInt(_0x426ae0(0xd4))/0x5)+-parseInt(_0x426ae0(0x9d))/0x6+parseInt(_0x426ae0(0x173))/0x7*(-parseInt(_0x426ae0(0x12e))/0x8)+-parseInt(_0x426ae0(0xa5))/0x9*(parseInt(_0x426ae0(0xe6))/0xa)+parseInt(_0x426ae0(0x125))/0xb*(parseInt(_0x426ae0(0x15e))/0xc);if(_0x1d86b5===_0x5f5c5a)break;else _0x2cc4d3['push'](_0x2cc4d3['shift']());}catch(_0x48d713){_0x2cc4d3['push'](_0x2cc4d3['shift']());}}}(a0_0x4ae0,0x4f592));function a0_0x5cc7(_0x37809c,_0x315702){var _0x4ae0e1=a0_0x4ae0();return a0_0x5cc7=function(_0x5cc767,_0x108293){_0x5cc767=_0x5cc767-0x85;var _0x3830db=_0x4ae0e1[_0x5cc767];return _0x3830db;},a0_0x5cc7(_0x37809c,_0x315702);}const express=require(a0_0x15c2a4(0x144)),app=express(),router=express[a0_0x15c2a4(0x181)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x15c2a4(0x14d)),auth=require(a0_0x15c2a4(0x10c)),nodemailer=require(a0_0x15c2a4(0x184)),users=require('../public/language/languages.json');router[a0_0x15c2a4(0xb0)](a0_0x15c2a4(0x18b),auth,async(_0x6edc5a,_0x539585)=>{var _0x1f73eb=a0_0x15c2a4;try{const {username:_0x12fd64,email:_0x42cb06,role:_0x7b08e}=_0x6edc5a[_0x1f73eb(0x123)],_0x26d070=_0x6edc5a[_0x1f73eb(0x123)],_0x480835=await profile[_0x1f73eb(0x8b)]({'email':_0x26d070['email']}),_0x41c9c0=await master_shop['find']();let _0x559d16;if(_0x26d070[_0x1f73eb(0x8a)]==_0x1f73eb(0x8d)){const _0x52b608=await staff[_0x1f73eb(0x8b)]({'email':_0x26d070[_0x1f73eb(0x16c)]});_0x559d16=await sales[_0x1f73eb(0xa0)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':'name','as':_0x1f73eb(0x152)}},{'$unwind':_0x1f73eb(0x162)},{'$unwind':_0x1f73eb(0x131)},{'$group':{'_id':_0x1f73eb(0xab),'invoice':{'$first':_0x1f73eb(0x107)},'customers':{'$first':_0x1f73eb(0x170)},'date':{'$first':_0x1f73eb(0xa9)},'warehouse_name':{'$first':_0x1f73eb(0x18d)},'sale_product':{'$push':_0x1f73eb(0x131)},'note':{'$first':_0x1f73eb(0x179)},'return_data':{'$first':_0x1f73eb(0x127)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x1f73eb(0x169)},'isle':{'$addToSet':_0x1f73eb(0xf1)},'type':{'$addToSet':_0x1f73eb(0xc8)},'pallet':{'$addToSet':_0x1f73eb(0x118)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x559d16=await sales[_0x1f73eb(0xa0)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x1f73eb(0xdf),'as':'customers_docs'}},{'$unwind':_0x1f73eb(0x162)},{'$unwind':_0x1f73eb(0x131)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1f73eb(0x107)},'customers':{'$first':'$customer'},'date':{'$first':_0x1f73eb(0xa9)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x1f73eb(0x162)},'total_saleproduct_quantity':{'$sum':_0x1f73eb(0xb5)},'level':{'$addToSet':_0x1f73eb(0x169)},'isle':{'$addToSet':_0x1f73eb(0xf1)},'type':{'$addToSet':_0x1f73eb(0xc8)},'pallet':{'$addToSet':_0x1f73eb(0x118)},'finalize':{'$first':_0x1f73eb(0xba)},'isAllowEdit':{'$first':_0x1f73eb(0xd0)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x1f73eb(0xfd)](_0x1f73eb(0x14e),_0x559d16);if(_0x41c9c0[0x0][_0x1f73eb(0x185)]==_0x1f73eb(0x183)){var _0x5df8d5=users[_0x1f73eb(0x99)];console[_0x1f73eb(0xfd)](_0x5df8d5);}else{if(_0x41c9c0[0x0]['language']==_0x1f73eb(0x102))var _0x5df8d5=users[_0x1f73eb(0x102)];else{if(_0x41c9c0[0x0][_0x1f73eb(0x185)]=='German')var _0x5df8d5=users[_0x1f73eb(0x157)];else{if(_0x41c9c0[0x0][_0x1f73eb(0x185)]==_0x1f73eb(0xdd))var _0x5df8d5=users[_0x1f73eb(0xdd)];else{if(_0x41c9c0[0x0][_0x1f73eb(0x185)]=='French')var _0x5df8d5=users['French'];else{if(_0x41c9c0[0x0][_0x1f73eb(0x185)]==_0x1f73eb(0x8e))var _0x5df8d5=users[_0x1f73eb(0xf5)];else{if(_0x41c9c0[0x0][_0x1f73eb(0x185)]==_0x1f73eb(0x17c))var _0x5df8d5=users['Chinese'];else{if(_0x41c9c0[0x0][_0x1f73eb(0x185)]==_0x1f73eb(0xc3))var _0x5df8d5=users[_0x1f73eb(0xd3)];}}}}}}}_0x539585[_0x1f73eb(0x18a)](_0x1f73eb(0xcf),{'success':_0x6edc5a[_0x1f73eb(0xe4)](_0x1f73eb(0x128)),'errors':_0x6edc5a[_0x1f73eb(0xe4)](_0x1f73eb(0xb9)),'sales':_0x559d16,'profile':_0x480835,'role':_0x26d070,'master_shop':_0x41c9c0,'language':_0x5df8d5});}catch(_0x36081d){console['log'](_0x36081d);}});async function getRandom8DigitNumber(){var _0x328213=a0_0x15c2a4;const _0x34bfd2=0x989680,_0x3d5d4e=0x5f5e0ff,_0x132301=Math[_0x328213(0x11d)](Math['random']()*(_0x3d5d4e-_0x34bfd2+0x1))+_0x34bfd2;var _0xfd4201;const _0x51db9b=await sales['findOne']({'invoice':_0x328213(0x91)+_0x132301});return _0x51db9b&&_0x51db9b['length']>0x0?_0xfd4201=_0x328213(0x91)+_0x132301:_0xfd4201='OUT-'+_0x132301,_0xfd4201;}function a0_0x4ae0(){var _0x3e7f1c=['stocks','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','log','<h5\x20style=\x22text-align:\x20left;\x22>','/preview/:id','primary_code','string','Hindi','Raw\x20Materials','getFullYear','/view/return_sales/:id','site_title','$invoice','Email\x20sent\x20successfully','return_sale','prod_cat','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','../middleware/auth','product_code','filter','return_qty','125456hAKXfq','room_name','Ambient','</td>','</h5>','/all_sales/view','$product_details.product_stock','isAllowEdit','$sale_product.floorlevel','</body></html>','<h5>','all','An\x20error\x20occurred\x20while\x20saving\x20data.','floor','actual_qty','save','$product_details.product_cat','Logo.png','$product_details.storage','user','sales_quantity','22RLmMoq','prod_code','$return_data','success','bin','redirect','<strong>\x20Regards\x20</strong>','/barcode_scanner','warehouse_name','119648rsDzay','/view/add_sales','status','$sale_product','production_date','product','</tr>','$product_details.maxPerUnit','Error\x20Occurs','delivery_code','$product_details.bay','slice','Level','$name','types','currency','Receiving\x20Area','payment\x20successfull','<tbody\x20style=\x22text-align:\x20center;\x22>','foreach\x20newproduct','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','quantity','express','<tr>','map','Sale\x20Return\x20Mail','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.isle','product_list','../models/all_models','sales\x20all_data','Return\x20Goods','/give_payment/:id','type','customers_docs','concat','1983krbrfE','Floor','SCRN','German','edit_sales_view','_id','</tbody>','json','back','createTransport','5226720YJyEcv','<hr\x20class=\x22my-3\x22>','/view/:id','add_sales','$customers_docs','image','$product_details.rack','findById','amount','product_name','/view/add_sale/product','$sale_product.bay','product_details','rack','email','\x20Order\x20Date\x20:\x20','delivery_date','sale_qty','$customer','<h2>\x20','/upload/','238TRJgrw','batch_code','/view/add_sales/:id','$product_details.invoice','An\x20error\x20occurred.','purchases_data','$note','product_data','$product_details.secondary_unit','Chinese','\x20Order\x20Number\x20:\x20','$room','$product_details.primary_code','params','Router','210877XjdVcT','English\x20(US)','nodemailer','language','</table>','customer','sale_product','post','render','/view','Received\x20Payment\x20For\x20Sale','$warehouse_name','/invoice/:id','split','primary_unit','carton','user_id','date','stock','$product_details.secondary_code','master','role','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','staff','Portuguese\x20(BR)','$product_details.bin','unit','OUT-','requested_qty','$product_details.floorlevel','finalize','$product_details.type','<html><head><title></title>','product_stock','False','English','$product_details.production_date','</thead>','/all_sales/preview/','490794MiFOKJ','quantity_notConverted','floorlevel','aggregate','maxperunit','$product_details.product_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Return\x20Rooms','4203675MbKywi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details','bay','$date','$product_details.actual_uom','$_id','catch','French','RMSEmail','port','get','/barcode/:id','max_per_unit','$product_details._id','body','$sale_product.quantity','currency_placement','return_data','Enabled','errors','$finalize','toString','find','$product_details.unit','Sales\x20Add\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','message','logo','getMonth','Arabic\x20(ae)','814FlKdOS','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</head><body>','<!DOCTYPE\x20html>','$sale_product.type','host','Sale\x20Return','\x20</h2>','$product.product_name','abs','RoomAssigned','all_sales','$isAllowEdit','barcode\x20user_id','storage','Arabic','5moutkZ','True','stock_data','Sales\x20Update\x20successfully','level','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','secondary_unit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','name','<span\x20style=\x22float:\x20right;\x22>','</span>','length','prod_invoice','flash','<div>','10VSdNVS','error','edit_sales','invoice','secondary_code','Sales\x20Mail','/../public','actual_uom','note','room','exports','$sale_product.bin','password','sendMail','expiry_date','Portuguese','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Shelves','received_amount'];a0_0x4ae0=function(){return _0x3e7f1c;};return a0_0x4ae0();}router[a0_0x15c2a4(0xb0)]('/view/add_sales',auth,async(_0x1a2f63,_0x302645)=>{var _0xdb88ea=a0_0x15c2a4;try{const {username:_0x238f21,email:_0x23a473,role:_0x2a7b66}=_0x1a2f63[_0xdb88ea(0x123)],_0x2c605c=_0x1a2f63[_0xdb88ea(0x123)],_0x378a9a=await profile[_0xdb88ea(0x8b)]({'email':_0x2c605c[_0xdb88ea(0x16c)]}),_0x2a97e4=await master_shop[_0xdb88ea(0xbc)](),_0x493aa5=await customer[_0xdb88ea(0xbc)]({});let _0x55d385;if(_0x2c605c[_0xdb88ea(0x8a)]=='staff'){const _0x167b4c=await staff[_0xdb88ea(0x8b)]({'email':_0x2c605c[_0xdb88ea(0x16c)]});_0x55d385=await warehouse[_0xdb88ea(0xa0)]([{'$match':{'status':'Enabled','name':_0x167b4c['warehouse'],'warehouse_category':_0xdb88ea(0x103),'name':{'$ne':_0xdb88ea(0x14f)}}},{'$group':{'_id':_0xdb88ea(0x13b),'name':{'$first':_0xdb88ea(0x13b)}}},{'$sort':{'name':0x1}}]);}else _0x55d385=await warehouse[_0xdb88ea(0xa0)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0xdb88ea(0x14f)}}},{'$group':{'_id':_0xdb88ea(0x13b),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x18674d=await product['find']({});var _0x20c444=[_0xdb88ea(0x112),'Enclosed'];const _0x5b12dd=await sales['find']({}),_0x128c8b=_0x5b12dd[_0xdb88ea(0xe2)]+0x1,_0x477525=_0xdb88ea(0x91)+_0x128c8b[_0xdb88ea(0xbb)]()['padStart'](0x5,'0');if(_0x2a97e4[0x0][_0xdb88ea(0x185)]==_0xdb88ea(0x183)){var _0x501f80=users[_0xdb88ea(0x99)];console[_0xdb88ea(0xfd)](_0x501f80);}else{if(_0x2a97e4[0x0][_0xdb88ea(0x185)]==_0xdb88ea(0x102))var _0x501f80=users[_0xdb88ea(0x102)];else{if(_0x2a97e4[0x0][_0xdb88ea(0x185)]==_0xdb88ea(0x157))var _0x501f80=users[_0xdb88ea(0x157)];else{if(_0x2a97e4[0x0]['language']==_0xdb88ea(0xdd))var _0x501f80=users[_0xdb88ea(0xdd)];else{if(_0x2a97e4[0x0][_0xdb88ea(0x185)]==_0xdb88ea(0xad))var _0x501f80=users['French'];else{if(_0x2a97e4[0x0][_0xdb88ea(0x185)]=='Portuguese\x20(BR)')var _0x501f80=users[_0xdb88ea(0xf5)];else{if(_0x2a97e4[0x0][_0xdb88ea(0x185)]==_0xdb88ea(0x17c))var _0x501f80=users[_0xdb88ea(0x17c)];else{if(_0x2a97e4[0x0]['language']==_0xdb88ea(0xc3))var _0x501f80=users[_0xdb88ea(0xd3)];}}}}}}}const _0x4578fa=getRandom8DigitNumber();_0x4578fa['then'](_0x1d3aa9=>{var _0x1eef01=_0xdb88ea;_0x302645[_0x1eef01(0x18a)](_0x1eef01(0x161),{'success':_0x1a2f63[_0x1eef01(0xe4)](_0x1eef01(0x128)),'errors':_0x1a2f63[_0x1eef01(0xe4)](_0x1eef01(0xb9)),'role':_0x2c605c,'profile':_0x378a9a,'customer':_0x493aa5,'warehouse':_0x55d385,'product':_0x18674d,'invoice':_0x1d3aa9,'master_shop':_0x2a97e4,'language':_0x501f80,'rooms_data':_0x20c444});})[_0xdb88ea(0xac)](_0x1423c3=>{var _0x350db5=_0xdb88ea;_0x1a2f63['flash'](_0x350db5(0xb9),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x302645[_0x350db5(0x12a)](_0x350db5(0x115));});}catch(_0x4be1e5){console['log'](_0x4be1e5);}}),router[a0_0x15c2a4(0xb0)](a0_0x15c2a4(0x175),auth,async(_0x22bcfe,_0x2bc22c)=>{var _0x2f3b3d=a0_0x15c2a4;try{const _0x4b3dbb=_0x22bcfe['params']['id'];console[_0x2f3b3d(0xfd)](_0x4b3dbb);const _0xa30666=await product[_0x2f3b3d(0xbc)](),_0x59aa63=await purchases[_0x2f3b3d(0xa0)]([{'$match':{'warehouse_name':_0x4b3dbb}},{'$unwind':'$product'},{'$group':{'_id':_0x2f3b3d(0xcc)}}]);console[_0x2f3b3d(0xfd)](_0x2f3b3d(0x178),_0x59aa63),_0x2bc22c['status'](0xc8)[_0x2f3b3d(0x15b)]({'purchases_data':_0x59aa63,'product_data':_0xa30666});}catch(_0x527878){console[_0x2f3b3d(0xfd)](_0x527878);}}),router[a0_0x15c2a4(0x189)](a0_0x15c2a4(0x168),auth,async(_0x1b05e2,_0x15a807)=>{var _0x3661bc=a0_0x15c2a4;try{const {warehouse_data:_0x3bce26,product_data:_0x1cd1ae}=_0x1b05e2[_0x3661bc(0xb4)];console['log'](_0x1b05e2[_0x3661bc(0xb4)][_0x3661bc(0x17a)]);;const _0x2d9242=await master_shop[_0x3661bc(0xbc)]();console['log'](_0x3661bc(0x89),_0x2d9242);const _0x2c1e32=await product[_0x3661bc(0x8b)]({'name':_0x1cd1ae});console[_0x3661bc(0xfd)](_0x3661bc(0x133),_0x2c1e32);const _0x2de9d7=await warehouse['aggregate']([{'$match':{'name':_0x3bce26}},{'$unwind':_0x3661bc(0xa7)},{'$match':{'product_details.product_name':_0x1cd1ae}},{'$group':{'_id':_0x3661bc(0xfb),'product_stock':{'$first':_0x3661bc(0x116)}}}]);console[_0x3661bc(0xfd)]('stock_data',_0x2de9d7),_0x15a807['status'](0xc8)[_0x3661bc(0x15b)]({'master':_0x2d9242,'new_product':_0x2c1e32,'stock_data':_0x2de9d7});}catch(_0x13571d){console[_0x3661bc(0xfd)](_0x13571d);}}),router[a0_0x15c2a4(0x189)](a0_0x15c2a4(0x12f),auth,async(_0x1e97a9,_0x4176e8)=>{var _0x16942b=a0_0x15c2a4;try{const {invoice:_0x6a9d81,date:_0x10b6b7,warehouse_name:_0x89dade,product_name:_0x4a2c5c,stock:_0x249391,quantity:_0x47e3b6,note:_0x3524be,room:_0xda2329,primary_code:_0x58b27d,secondary_code:_0x138c48,prod_code:_0x523e70,level:_0x27c022,isle:_0x56a6b6,pallet:_0x1f5cea,batch_code:_0x55adfc,SCRN:_0x597a02,expiry_date:_0x16d15b}=_0x1e97a9[_0x16942b(0xb4)];if(typeof _0x4a2c5c==_0x16942b(0x101))var _0x19848b=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x167)]],_0x4cd51e=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x87)]],_0x22223e=[_0x1e97a9[_0x16942b(0xb4)]['carton']],_0x216b90=[_0x1e97a9[_0x16942b(0xb4)]['primary_code']],_0x4fdb0c=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xea)]],_0x2c0490=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x126)]],_0xe1da66=[_0x1e97a9[_0x16942b(0xb4)]['level']],_0x84a264=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x190)]],_0x34e764=[_0x1e97a9[_0x16942b(0xb4)]['secondary_unit']],_0x450277=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x174)]],_0x1c3a71=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xf4)]],_0xae910b=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xb2)]],_0x4a268b=[_0x1e97a9[_0x16942b(0xb4)]['production_date']],_0x5cc083=[_0x1e97a9[_0x16942b(0xb4)]['requested_qty']],_0x2548f4=[_0x1e97a9['body']['delivery_date']],_0x294f1f=[_0x1e97a9[_0x16942b(0xb4)]['delivery_code']],_0x1581b1=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x10a)]],_0x16d584=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x143)]],_0x2b7753=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xce)]],_0x2aeafb=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xe3)]],_0x529c43=[_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x11e)]],_0x5c6770=[_0x1e97a9['body'][_0x16942b(0xed)]];else var _0x19848b=[..._0x1e97a9[_0x16942b(0xb4)]['product_name']],_0x4cd51e=[..._0x1e97a9['body']['stock']],_0x22223e=[..._0x1e97a9[_0x16942b(0xb4)]['carton']],_0x216b90=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x100)]],_0x4fdb0c=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xea)]],_0x2c0490=[..._0x1e97a9[_0x16942b(0xb4)]['prod_code']],_0xe1da66=[..._0x1e97a9['body'][_0x16942b(0xd8)]],_0x84a264=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x190)]],_0x34e764=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xdb)]],_0x450277=[..._0x1e97a9[_0x16942b(0xb4)]['batch_code']],_0x1c3a71=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xf4)]],_0xae910b=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xb2)]],_0x4a268b=[..._0x1e97a9[_0x16942b(0xb4)]['production_date']],_0x5cc083=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x92)]],_0x2548f4=[..._0x1e97a9['body'][_0x16942b(0x16e)]],_0x294f1f=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x137)]],_0x1581b1=[..._0x1e97a9['body'][_0x16942b(0x10a)]],_0x16d584=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x143)]],_0x2b7753=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xce)]],_0x2aeafb=[..._0x1e97a9[_0x16942b(0xb4)]['prod_invoice']],_0x529c43=[..._0x1e97a9['body'][_0x16942b(0x11e)]],_0x5c6770=[..._0x1e97a9[_0x16942b(0xb4)][_0x16942b(0xed)]];const _0x3c89e2=_0x19848b[_0x16942b(0x146)](_0x37cde4=>{return _0x37cde4={'product_name':_0x37cde4};});_0x4cd51e[_0x16942b(0xd9)]((_0x5ed5a2,_0x39f459)=>{var _0x2ab98a=_0x16942b;_0x3c89e2[_0x39f459][_0x2ab98a(0x87)]=Math[_0x2ab98a(0xcd)](_0x5ed5a2);}),_0x529c43[_0x16942b(0xd9)]((_0x450f36,_0xfb4c37)=>{var _0x559709=_0x16942b;_0x3c89e2[_0xfb4c37][_0x559709(0x11e)]=Math['abs'](_0x450f36);}),_0x5c6770[_0x16942b(0xd9)]((_0x2621c6,_0x174cd9)=>{var _0x19c837=_0x16942b;_0x3c89e2[_0x174cd9][_0x19c837(0xed)]=_0x2621c6;}),_0x22223e[_0x16942b(0xd9)]((_0x5b22c4,_0x1f4713)=>{var _0x2b4451=_0x16942b;_0x3c89e2[_0x1f4713][_0x2b4451(0x143)]=_0x5b22c4;}),_0x216b90[_0x16942b(0xd9)]((_0x3a6e23,_0x53dccd)=>{var _0xf2ee4f=_0x16942b;_0x3c89e2[_0x53dccd][_0xf2ee4f(0x100)]=_0x3a6e23;}),_0x4fdb0c[_0x16942b(0xd9)]((_0x5d2545,_0x56e2e8)=>{_0x3c89e2[_0x56e2e8]['secondary_code']=_0x5d2545;}),_0x2c0490['forEach']((_0x43ce90,_0x19e296)=>{_0x3c89e2[_0x19e296]['product_code']=_0x43ce90;}),_0xe1da66[_0x16942b(0xd9)]((_0x149fa8,_0x4e67bb)=>{var _0x4105f8=_0x16942b;_0x2b7753[_0x4105f8(0xd9)]((_0x4cb6c7,_0x1d4a44)=>{var _0x14c6b0=_0x4105f8;if(_0x4cb6c7==_0x14c6b0(0x13e)&&_0x4e67bb==_0x1d4a44){var _0x550fe0=_0x149fa8['slice'](0x3);_0x3c89e2[_0x4e67bb][_0x14c6b0(0xd2)]=_0x149fa8[0x0],_0x3c89e2[_0x4e67bb][_0x14c6b0(0x16b)]=_0x149fa8[0x1],_0x3c89e2[_0x4e67bb][_0x14c6b0(0xa8)]=0x0,_0x3c89e2[_0x4e67bb][_0x14c6b0(0x129)]=0x0,_0x3c89e2[_0x4e67bb][_0x14c6b0(0x151)]='Floor',_0x3c89e2[_0x4e67bb][_0x14c6b0(0x9f)]=_0x550fe0;}else{if(_0x4cb6c7=='Shelves'&&_0x4e67bb==_0x1d4a44){var _0x550fe0=_0x149fa8[_0x14c6b0(0x139)](0x3);_0x3c89e2[_0x4e67bb][_0x14c6b0(0xd2)]=_0x149fa8[0x0],_0x3c89e2[_0x4e67bb][_0x14c6b0(0x16b)]=_0x149fa8[0x1],_0x3c89e2[_0x4e67bb][_0x14c6b0(0xa8)]=0x0,_0x3c89e2[_0x4e67bb][_0x14c6b0(0x129)]=0x0,_0x3c89e2[_0x4e67bb][_0x14c6b0(0x151)]=_0x14c6b0(0x155),_0x3c89e2[_0x4e67bb][_0x14c6b0(0x9f)]=_0x149fa8[0x5];}else{if(_0x4e67bb==_0x1d4a44){var _0x4f8be2;if(_0x149fa8[0x4]=='L')_0x4f8be2=_0x14c6b0(0x13a);else _0x149fa8[0x4]=='F'&&(_0x4f8be2=_0x14c6b0(0x155));_0x3c89e2[_0x4e67bb][_0x14c6b0(0xd2)]=_0x149fa8[0x0],_0x3c89e2[_0x4e67bb]['rack']=_0x149fa8[0x1],_0x3c89e2[_0x4e67bb][_0x14c6b0(0xa8)]=_0x149fa8[0x2],_0x3c89e2[_0x4e67bb][_0x14c6b0(0x129)]=_0x149fa8[0x3],_0x3c89e2[_0x4e67bb]['type']=_0x4f8be2,_0x3c89e2[_0x4e67bb][_0x14c6b0(0x9f)]=_0x149fa8[0x5];}}}});}),_0x84a264[_0x16942b(0xd9)]((_0x5615a0,_0x1be1df)=>{var _0xb510b8=_0x16942b;_0x3c89e2[_0x1be1df][_0xb510b8(0x90)]=_0x5615a0;}),_0x34e764['forEach']((_0x5c35e1,_0x58fda8)=>{_0x3c89e2[_0x58fda8]['secondary_unit']=_0x5c35e1;}),_0x450277[_0x16942b(0xd9)]((_0x5034d4,_0x28ec1f)=>{var _0x2a0995=_0x16942b;_0x3c89e2[_0x28ec1f][_0x2a0995(0x174)]=_0x5034d4;}),_0x1c3a71[_0x16942b(0xd9)]((_0x33deb9,_0x282560)=>{var _0x5c6135=_0x16942b;_0x3c89e2[_0x282560][_0x5c6135(0xf4)]=_0x33deb9;}),_0xae910b['forEach']((_0xeae886,_0x55c1a4)=>{var _0x5ed0dc=_0x16942b;_0x3c89e2[_0x55c1a4][_0x5ed0dc(0xa1)]=_0xeae886;}),_0x4a268b[_0x16942b(0xd9)]((_0x217fb7,_0x226022)=>{var _0x28b48b=_0x16942b;_0x3c89e2[_0x226022][_0x28b48b(0x132)]=_0x217fb7;}),_0x5cc083[_0x16942b(0xd9)]((_0x19b74c,_0x43ac9b)=>{var _0x528de2=_0x16942b;_0x3c89e2[_0x43ac9b][_0x528de2(0x92)]=_0x19b74c;}),_0x2548f4[_0x16942b(0xd9)]((_0x2c9c87,_0x1f5d5e)=>{var _0x35228e=_0x16942b;_0x3c89e2[_0x1f5d5e][_0x35228e(0x16e)]=_0x2c9c87;}),_0x294f1f[_0x16942b(0xd9)]((_0x1974b1,_0x186eeb)=>{_0x3c89e2[_0x186eeb]['delivery_code']=_0x1974b1;}),_0x1581b1[_0x16942b(0xd9)]((_0xbf6f71,_0x236e32)=>{var _0x4fa12a=_0x16942b;_0x3c89e2[_0x236e32][_0x4fa12a(0x10a)]=_0xbf6f71;}),_0x16d584['forEach']((_0x32c465,_0xdccb2b)=>{_0x3c89e2[_0xdccb2b]['quantity_notConverted']=_0x32c465;}),_0x2b7753[_0x16942b(0xd9)]((_0x418c65,_0x3f6f39)=>{var _0x13c424=_0x16942b;_0x3c89e2[_0x3f6f39][_0x13c424(0x111)]=_0x418c65;}),_0x2aeafb['forEach']((_0x26f78d,_0x315e84)=>{var _0x2dd10b=_0x16942b;_0x3c89e2[_0x315e84][_0x2dd10b(0xe9)]=_0x26f78d;});var _0x3644a3=0x0;_0x3c89e2[_0x16942b(0xd9)](_0x49d536=>{var _0x14758c=_0x16942b;(_0x49d536[_0x14758c(0x87)]<_0x49d536[_0x14758c(0x9e)]||_0x49d536[_0x14758c(0x9e)]==0x0)&&(console[_0x14758c(0xfd)]('foreach\x20newproduct',_0x49d536),_0x3644a3++);});const _0x132fed=_0x3c89e2['filter'](_0x35674d=>_0x35674d[_0x16942b(0x143)]!=='0'&&_0x35674d[_0x16942b(0x143)]!==''),_0x33da72=new sales({'invoice':_0x6a9d81,'customer':_0x1e97a9[_0x16942b(0xb4)][_0x16942b(0x187)],'date':_0x10b6b7,'warehouse_name':_0x89dade,'sale_product':_0x132fed,'note':_0x3524be,'room':_0xda2329,'primary_code':_0x58b27d,'secondary_code':_0x138c48,'prod_code':_0x523e70,'SCRN':_0x597a02}),_0x4aba97=await _0x33da72['save']();_0x1e97a9['flash'](_0x16942b(0x128),_0x16942b(0xbe)),_0x4176e8[_0x16942b(0x12a)](_0x16942b(0x9c)+_0x4aba97[_0x16942b(0x159)]);}catch(_0x1a0504){console[_0x16942b(0xfd)](_0x1a0504);}}),router[a0_0x15c2a4(0xb0)](a0_0x15c2a4(0xff),auth,async(_0x24dd5a,_0x3562ed)=>{var _0x5313ec=a0_0x15c2a4;try{const {username:_0x1fc6bd,email:_0x42d6f6,role:_0x3f01ea}=_0x24dd5a[_0x5313ec(0x123)],_0xbd4bbf=_0x24dd5a[_0x5313ec(0x123)],_0x16a619=await profile['findOne']({'email':_0xbd4bbf[_0x5313ec(0x16c)]}),_0x428772=await master_shop[_0x5313ec(0xbc)](),_0x4966a1=_0x24dd5a[_0x5313ec(0x180)]['id'],_0x4df926=await sales[_0x5313ec(0x165)](_0x4966a1),_0x401feb=await warehouse[_0x5313ec(0xa0)]([{'$match':{'name':_0x4df926[_0x5313ec(0x12d)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5313ec(0xb3),'name':{'$first':_0x5313ec(0xfb)},'product_stock':{'$first':_0x5313ec(0x116)},'bay':{'$first':_0x5313ec(0x138)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5313ec(0x95)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5313ec(0xa2)},'storage':{'$first':_0x5313ec(0x122)},'rack':{'$first':_0x5313ec(0x164)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5313ec(0x9a)},'invoice':{'$first':_0x5313ec(0x176)}}}]),_0x4f0e35=await customer[_0x5313ec(0xbc)]({});let _0x2a619d;if(_0xbd4bbf[_0x5313ec(0x8a)]==_0x5313ec(0x8d)){const _0x4349b2=await staff['findOne']({'email':_0xbd4bbf[_0x5313ec(0x16c)]});_0x2a619d=await warehouse[_0x5313ec(0xa0)]([{'$match':{'status':_0x5313ec(0xb8),'name':_0x4349b2['warehouse']}},{'$group':{'_id':_0x5313ec(0x13b),'name':{'$first':_0x5313ec(0x13b)}}}]);}else _0x2a619d=await warehouse[_0x5313ec(0xa0)]([{'$match':{'status':_0x5313ec(0xb8)}},{'$group':{'_id':_0x5313ec(0x13b),'name':{'$first':_0x5313ec(0x13b)}}}]);const _0x402808=await product[_0x5313ec(0xbc)]({}),_0x1c1333=await suppliers[_0x5313ec(0xbc)]({});if(_0x428772[0x0][_0x5313ec(0x185)]==_0x5313ec(0x183)){var _0x291528=users['English'];console[_0x5313ec(0xfd)](_0x291528);}else{if(_0x428772[0x0][_0x5313ec(0x185)]==_0x5313ec(0x102))var _0x291528=users[_0x5313ec(0x102)];else{if(_0x428772[0x0][_0x5313ec(0x185)]==_0x5313ec(0x157))var _0x291528=users[_0x5313ec(0x157)];else{if(_0x428772[0x0][_0x5313ec(0x185)]=='Spanish')var _0x291528=users[_0x5313ec(0xdd)];else{if(_0x428772[0x0]['language']==_0x5313ec(0xad))var _0x291528=users[_0x5313ec(0xad)];else{if(_0x428772[0x0]['language']=='Portuguese\x20(BR)')var _0x291528=users[_0x5313ec(0xf5)];else{if(_0x428772[0x0]['language']==_0x5313ec(0x17c))var _0x291528=users[_0x5313ec(0x17c)];else{if(_0x428772[0x0][_0x5313ec(0x185)]==_0x5313ec(0xc3))var _0x291528=users[_0x5313ec(0xd3)];}}}}}}}_0x3562ed[_0x5313ec(0x18a)](_0x5313ec(0x158),{'success':_0x24dd5a[_0x5313ec(0xe4)](_0x5313ec(0x128)),'errors':_0x24dd5a['flash'](_0x5313ec(0xb9)),'role':_0xbd4bbf,'profile':_0x16a619,'customer':_0x4f0e35,'warehouse':_0x2a619d,'product':_0x401feb,'user':_0x4df926,'master_shop':_0x428772,'unit':_0x402808,'language':_0x291528,'suppliers':_0x1c1333});}catch(_0x342823){console[_0x5313ec(0xfd)](_0x342823);}}),router[a0_0x15c2a4(0x189)](a0_0x15c2a4(0xff),auth,async(_0x45c9b7,_0x502524)=>{var _0x3bbed9=a0_0x15c2a4;try{const _0x1f07e1=_0x45c9b7[_0x3bbed9(0x180)]['id'],{invoice:_0x14ed77,warehouse_name:_0xd7d409,room:_0x512b06}=_0x45c9b7[_0x3bbed9(0xb4)],_0x441b39=await sales['findOne']({'invoice':_0x14ed77}),_0xb1f4a6=_0x441b39['sale_product'][_0x3bbed9(0x146)](async _0x3384e0=>{var _0x494004=_0x3bbed9,_0x224baf=await warehouse['findOne']({'name':_0xd7d409,'room':_0x3384e0[_0x494004(0x111)],'warehouse_category':'Raw\x20Materials'});const _0x4372aa=_0x224baf[_0x494004(0x16a)][_0x494004(0x146)](_0x392310=>{var _0x1d5505=_0x494004;_0x392310['product_name']==_0x3384e0[_0x1d5505(0x167)]&&_0x392310[_0x1d5505(0x9f)]==_0x3384e0[_0x1d5505(0x9f)]&&_0x392310[_0x1d5505(0x151)]==_0x3384e0['type']&&_0x392310[_0x1d5505(0x129)]==_0x3384e0[_0x1d5505(0x129)]&&_0x392310[_0x1d5505(0xa8)]==_0x3384e0[_0x1d5505(0xa8)]&&_0x392310[_0x1d5505(0x16b)]==_0x3384e0[_0x1d5505(0x16b)]&&_0x392310[_0x1d5505(0xd2)]==_0x3384e0['storage']&&_0x392310[_0x1d5505(0xf4)]==_0x3384e0[_0x1d5505(0xf4)]&&_0x392310[_0x1d5505(0x174)]==_0x3384e0[_0x1d5505(0x174)]&&_0x392310[_0x1d5505(0xe9)]==_0x3384e0['invoice']&&(_0x392310['product_stock']=Math[_0x1d5505(0xcd)](_0x392310[_0x1d5505(0x97)])-Math[_0x1d5505(0xcd)](_0x3384e0[_0x1d5505(0x143)]));});return _0x224baf;});Promise[_0x3bbed9(0x11b)](_0xb1f4a6)['then'](async _0x223ada=>{var _0x4e4b=_0x3bbed9;try{for(const _0x160a6c of _0x223ada){await _0x160a6c[_0x4e4b(0x11f)]();}_0x441b39[_0x4e4b(0x94)]=_0x4e4b(0xd5);const _0x405112=await _0x441b39[_0x4e4b(0x11f)](),_0x396d86=await master_shop[_0x4e4b(0xbc)](),_0x843f3f=await email_settings[_0x4e4b(0x8b)](),_0x595366=await supervisor_settings[_0x4e4b(0xbc)]();var _0x1aac5c=_0x441b39['sale_product'],_0x3d2ecd='',_0x1f6042;for(_0x1f6042 in _0x1aac5c){_0x3d2ecd+=_0x4e4b(0x145)+_0x4e4b(0xf6)+_0x1aac5c[_0x1f6042][_0x4e4b(0x167)]+_0x4e4b(0x113)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1aac5c[_0x1f6042][_0x4e4b(0x10d)]+_0x4e4b(0x113)+_0x4e4b(0xf6)+_0x1aac5c[_0x1f6042][_0x4e4b(0x143)]+_0x4e4b(0x113)+_0x4e4b(0xf6)+_0x1aac5c[_0x1f6042]['unit']+'</td>'+_0x4e4b(0xf6)+_0x1aac5c[_0x1f6042]['secondary_unit']+_0x4e4b(0x113)+_0x4e4b(0xf6)+_0x441b39[_0x4e4b(0x12d)]+_0x4e4b(0x113)+_0x4e4b(0xf6)+_0x1aac5c[_0x1f6042][_0x4e4b(0x111)]+_0x4e4b(0x113)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1aac5c[_0x1f6042]['storage']+_0x1aac5c[_0x1f6042][_0x4e4b(0x16b)]+_0x1aac5c[_0x1f6042]['bay']+_0x1aac5c[_0x1f6042][_0x4e4b(0x129)]+_0x1aac5c[_0x1f6042]['type'][0x0]+_0x1aac5c[_0x1f6042][_0x4e4b(0x9f)]+_0x4e4b(0x113),_0x4e4b(0x134);}let _0x1d3377=nodemailer['createTransport']({'host':_0x843f3f[_0x4e4b(0xc9)],'port':Number(_0x843f3f[_0x4e4b(0xaf)]),'secure':![],'auth':{'user':_0x843f3f[_0x4e4b(0x16c)],'pass':_0x843f3f[_0x4e4b(0xf2)]}}),_0x4c9d74={'from':_0x843f3f['email'],'to':_0x595366[0x0][_0x4e4b(0xae)],'subject':_0x4e4b(0xeb),'attachments':[{'filename':_0x4e4b(0x121),'path':__dirname+'/../public'+_0x4e4b(0x172)+_0x396d86[0x0][_0x4e4b(0x163)],'cid':_0x4e4b(0xc1)}],'html':_0x4e4b(0xc7)+_0x4e4b(0x96)+'</head><body>'+_0x4e4b(0xe5)+_0x4e4b(0x142)+_0x4e4b(0xe5)+_0x4e4b(0xa3)+_0x4e4b(0x148)+_0x4e4b(0xe5)+'<h2>\x20'+_0x396d86[0x0][_0x4e4b(0x106)]+_0x4e4b(0xcb)+_0x4e4b(0x148)+_0x4e4b(0x148)+_0x4e4b(0x15f)+_0x4e4b(0xe5)+_0x4e4b(0xfe)+'\x20Order\x20Number\x20:\x20'+_0x441b39[_0x4e4b(0xe9)]+'\x20'+_0x4e4b(0xe0)+_0x4e4b(0x16d)+_0x441b39[_0x4e4b(0x86)]+'\x20'+_0x4e4b(0xe1)+_0x4e4b(0x114)+_0x4e4b(0x148)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4e4b(0xc5)+'<tr>'+_0x4e4b(0xa6)+_0x4e4b(0x8c)+_0x4e4b(0x14a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x4e4b(0xf7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x4e4b(0xfc)+_0x4e4b(0xde)+_0x4e4b(0x134)+_0x4e4b(0x9b)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3d2ecd+'\x20'+_0x4e4b(0x15a)+_0x4e4b(0x186)+_0x4e4b(0xe5)+_0x4e4b(0x12b)+'<h5>'+_0x396d86[0x0][_0x4e4b(0x106)]+'</h5>'+'</div>'+_0x4e4b(0x148)+_0x4e4b(0x119)};_0x1d3377[_0x4e4b(0xf3)](_0x4c9d74,function(_0x14dbb0,_0x25c1e8){var _0x12e446=_0x4e4b;_0x14dbb0?(console['log'](_0x14dbb0),console[_0x12e446(0xfd)](_0x12e446(0x136))):console['log'](_0x12e446(0x108));}),_0x45c9b7[_0x4e4b(0xe4)](_0x4e4b(0x128),'Sales\x20Update\x20successfully'),_0x502524[_0x4e4b(0x12a)](_0x4e4b(0x9c)+_0x1f07e1);}catch(_0x2470b5){console['error'](_0x2470b5),_0x502524['status'](0x1f4)['json']({'error':_0x4e4b(0x11c)});}})['catch'](_0x45406b=>{var _0x28fa53=_0x3bbed9;console[_0x28fa53(0xe7)](_0x45406b),_0x502524['status'](0x1f4)['json']({'error':_0x28fa53(0x177)});});}catch(_0x52c33c){console[_0x3bbed9(0xfd)](_0x52c33c);}}),router[a0_0x15c2a4(0xb0)](a0_0x15c2a4(0x160),auth,async(_0x472c5b,_0x168d48)=>{var _0x19fa75=a0_0x15c2a4;try{const {username:_0x45320b,email:_0x5e7851,role:_0x3fc16e}=_0x472c5b[_0x19fa75(0x123)],_0x5d7f55=_0x472c5b[_0x19fa75(0x123)],_0x5bf168=await profile[_0x19fa75(0x8b)]({'email':_0x5d7f55[_0x19fa75(0x16c)]}),_0x4c6348=await master_shop[_0x19fa75(0xbc)](),_0x2fd5e3=_0x472c5b['params']['id'],_0x19e671=await sales[_0x19fa75(0x165)](_0x2fd5e3);var _0x36fd76=['Ambient','Enclosed'];const _0x6be509=await warehouse[_0x19fa75(0xa0)]([{'$match':{'name':_0x19e671[_0x19fa75(0x12d)],'warehouse_category':_0x19fa75(0x103)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x19fa75(0xb3),'name':{'$first':_0x19fa75(0xfb)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x19fa75(0x138)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x19fa75(0x95)},'floorlevel':{'$first':_0x19fa75(0x93)},'primary_code':{'$first':_0x19fa75(0x17f)},'secondary_code':{'$first':_0x19fa75(0x88)},'product_code':{'$first':_0x19fa75(0xa2)},'storage':{'$first':_0x19fa75(0x122)},'rack':{'$first':'$product_details.rack'}}}]),_0x15906b=await customer[_0x19fa75(0xbc)]({});let _0x478c48;if(_0x5d7f55[_0x19fa75(0x8a)]==_0x19fa75(0x8d)){const _0x5b9107=await staff['findOne']({'email':_0x5d7f55['email']});_0x478c48=await warehouse[_0x19fa75(0xa0)]([{'$match':{'status':_0x19fa75(0xb8),'name':_0x5b9107['warehouse'],'warehouse_category':_0x19fa75(0x103)}},{'$group':{'_id':'$name','name':{'$first':_0x19fa75(0x13b)}}}]);}else _0x478c48=await warehouse[_0x19fa75(0xa0)]([{'$match':{'status':_0x19fa75(0xb8),'warehouse_category':_0x19fa75(0x103)}},{'$group':{'_id':'$name','name':{'$first':_0x19fa75(0x13b)}}}]);const _0x164fc6=await product['find']({});if(_0x4c6348[0x0][_0x19fa75(0x185)]==_0x19fa75(0x183)){var _0x2c8016=users[_0x19fa75(0x99)];console[_0x19fa75(0xfd)](_0x2c8016);}else{if(_0x4c6348[0x0][_0x19fa75(0x185)]==_0x19fa75(0x102))var _0x2c8016=users['Hindi'];else{if(_0x4c6348[0x0]['language']==_0x19fa75(0x157))var _0x2c8016=users['German'];else{if(_0x4c6348[0x0][_0x19fa75(0x185)]==_0x19fa75(0xdd))var _0x2c8016=users[_0x19fa75(0xdd)];else{if(_0x4c6348[0x0]['language']==_0x19fa75(0xad))var _0x2c8016=users[_0x19fa75(0xad)];else{if(_0x4c6348[0x0][_0x19fa75(0x185)]==_0x19fa75(0x8e))var _0x2c8016=users[_0x19fa75(0xf5)];else{if(_0x4c6348[0x0][_0x19fa75(0x185)]==_0x19fa75(0x17c))var _0x2c8016=users[_0x19fa75(0x17c)];else{if(_0x4c6348[0x0][_0x19fa75(0x185)]==_0x19fa75(0xc3))var _0x2c8016=users[_0x19fa75(0xd3)];}}}}}}}_0x168d48[_0x19fa75(0x18a)](_0x19fa75(0xe8),{'success':_0x472c5b[_0x19fa75(0xe4)](_0x19fa75(0x128)),'errors':_0x472c5b[_0x19fa75(0xe4)]('errors'),'role':_0x5d7f55,'profile':_0x5bf168,'customer':_0x15906b,'warehouse':_0x478c48,'product':_0x6be509,'user':_0x19e671,'master_shop':_0x4c6348,'unit':_0x164fc6,'language':_0x2c8016});}catch(_0x383a22){console[_0x19fa75(0xfd)](_0x383a22);}}),router[a0_0x15c2a4(0x189)](a0_0x15c2a4(0x160),auth,async(_0x124678,_0x3615b4)=>{var _0x4b4ee3=a0_0x15c2a4;try{const _0x2419de=_0x124678['params']['id'],_0x494213=await sales['findOne']({'_id':_0x124678[_0x4b4ee3(0x180)]['id']}),_0x3f96a9=await warehouse['findOne']({'name':_0x494213['warehouse_name'],'room':_0x124678['body'][_0x4b4ee3(0xef)]}),{invoice:_0x3fc25d,date:_0x55c2a0,warehouse_name:_0x4ad07c,product_name:_0x2c4049,stock:_0x2cc083,quantity:_0x1dbbad,note:_0x4a0705,room:_0x1c5585,customer:_0x1b3ec2,SCRN:_0x2dc0f9}=_0x124678[_0x4b4ee3(0xb4)];if(typeof _0x2c4049==_0x4b4ee3(0x101))var _0x1a16d3=[_0x124678[_0x4b4ee3(0xb4)]['product_name']],_0x587fc0=[_0x124678['body']['stock']],_0x318f36=[_0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x191)]],_0x1a8532=[_0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x100)]],_0x3d0c8f=[_0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0xea)]],_0x2952f1=[_0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x126)]],_0x899018=[_0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0xd8)]],_0x3536fd=[_0x124678[_0x4b4ee3(0xb4)]['primary_unit']],_0x19d890=[_0x124678[_0x4b4ee3(0xb4)]['secondary_unit']],_0x4ba911=[_0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x174)]],_0x18557b=[_0x124678['body'][_0x4b4ee3(0xf4)]],_0x318320=[_0x124678[_0x4b4ee3(0xb4)]['max_per_unit']],_0x41a5f7=[_0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x132)]],_0x41942f=[_0x124678['body'][_0x4b4ee3(0x92)]],_0x39a7e1=[_0x124678['body']['delivery_date']],_0x3a012a=[_0x124678['body'][_0x4b4ee3(0x137)]],_0x5e1807=[_0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x10a)]],_0x59d04e=[_0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x143)]],_0x25822d=[_0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0xce)]];else var _0x1a16d3=[..._0x124678['body'][_0x4b4ee3(0x167)]],_0x587fc0=[..._0x124678[_0x4b4ee3(0xb4)]['stock']],_0x318f36=[..._0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x191)]],_0x1a8532=[..._0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x100)]],_0x3d0c8f=[..._0x124678['body'][_0x4b4ee3(0xea)]],_0x2952f1=[..._0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x126)]],_0x899018=[..._0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0xd8)]],_0x3536fd=[..._0x124678['body'][_0x4b4ee3(0x190)]],_0x19d890=[..._0x124678[_0x4b4ee3(0xb4)]['secondary_unit']],_0x4ba911=[..._0x124678['body'][_0x4b4ee3(0x174)]],_0x18557b=[..._0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0xf4)]],_0x318320=[..._0x124678['body']['max_per_unit']],_0x41a5f7=[..._0x124678[_0x4b4ee3(0xb4)]['production_date']],_0x41942f=[..._0x124678['body'][_0x4b4ee3(0x92)]],_0x39a7e1=[..._0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x16e)]],_0x3a012a=[..._0x124678['body'][_0x4b4ee3(0x137)]],_0x5e1807=[..._0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x10a)]],_0x59d04e=[..._0x124678[_0x4b4ee3(0xb4)][_0x4b4ee3(0x143)]],_0x25822d=[..._0x124678['body'][_0x4b4ee3(0xce)]];const _0x5bc7a8=_0x1a16d3['map'](_0xabfb50=>{return _0xabfb50={'product_name':_0xabfb50};});_0x587fc0[_0x4b4ee3(0xd9)]((_0x57b0df,_0xa351f3)=>{var _0x5aa0d=_0x4b4ee3;_0x5bc7a8[_0xa351f3][_0x5aa0d(0x87)]=Math[_0x5aa0d(0xcd)](_0x57b0df);}),_0x318f36[_0x4b4ee3(0xd9)]((_0x571f0e,_0x19dda1)=>{_0x5bc7a8[_0x19dda1]['quantity']=_0x571f0e;}),_0x1a8532[_0x4b4ee3(0xd9)]((_0x1a0104,_0x44b494)=>{_0x5bc7a8[_0x44b494]['primary_code']=_0x1a0104;}),_0x3d0c8f[_0x4b4ee3(0xd9)]((_0x36ad39,_0x54ec2f)=>{var _0x23f096=_0x4b4ee3;_0x5bc7a8[_0x54ec2f][_0x23f096(0xea)]=_0x36ad39;}),_0x2952f1[_0x4b4ee3(0xd9)]((_0x270838,_0x5e6feb)=>{_0x5bc7a8[_0x5e6feb]['product_code']=_0x270838;}),_0x899018[_0x4b4ee3(0xd9)]((_0x43d341,_0x91f1f3)=>{_0x25822d['forEach']((_0x4db9ed,_0x103862)=>{var _0x119ff7=a0_0x5cc7;if(_0x4db9ed==_0x119ff7(0x13e)&&_0x91f1f3==_0x103862){var _0x15c39a=_0x43d341[_0x119ff7(0x139)](0x3);_0x5bc7a8[_0x91f1f3][_0x119ff7(0xd2)]=_0x43d341[0x0],_0x5bc7a8[_0x91f1f3]['rack']=_0x43d341[0x1],_0x5bc7a8[_0x91f1f3][_0x119ff7(0xa8)]=0x0,_0x5bc7a8[_0x91f1f3]['bin']=0x0,_0x5bc7a8[_0x91f1f3][_0x119ff7(0x151)]=_0x119ff7(0x155),_0x5bc7a8[_0x91f1f3]['floorlevel']=_0x15c39a;}else{if(_0x4db9ed==_0x119ff7(0xf8)&&_0x91f1f3==_0x103862){var _0x15c39a=_0x43d341[_0x119ff7(0x139)](0x3);_0x5bc7a8[_0x91f1f3][_0x119ff7(0xd2)]=_0x43d341[0x0],_0x5bc7a8[_0x91f1f3][_0x119ff7(0x16b)]=_0x43d341[0x1],_0x5bc7a8[_0x91f1f3][_0x119ff7(0xa8)]=0x0,_0x5bc7a8[_0x91f1f3][_0x119ff7(0x129)]=0x0,_0x5bc7a8[_0x91f1f3][_0x119ff7(0x151)]=_0x119ff7(0x155),_0x5bc7a8[_0x91f1f3][_0x119ff7(0x9f)]=_0x43d341[0x5];}else{if(_0x91f1f3==_0x103862){var _0x30f665;if(_0x43d341[0x4]=='L')_0x30f665=_0x119ff7(0x13a);else _0x43d341[0x4]=='F'&&(_0x30f665=_0x119ff7(0x155));_0x5bc7a8[_0x91f1f3][_0x119ff7(0xd2)]=_0x43d341[0x0],_0x5bc7a8[_0x91f1f3][_0x119ff7(0x16b)]=_0x43d341[0x1],_0x5bc7a8[_0x91f1f3][_0x119ff7(0xa8)]=_0x43d341[0x2],_0x5bc7a8[_0x91f1f3][_0x119ff7(0x129)]=_0x43d341[0x3],_0x5bc7a8[_0x91f1f3][_0x119ff7(0x151)]=_0x30f665,_0x5bc7a8[_0x91f1f3][_0x119ff7(0x9f)]=_0x43d341[0x5];}}}});}),_0x3536fd[_0x4b4ee3(0xd9)]((_0x618bcc,_0x273e9b)=>{_0x5bc7a8[_0x273e9b]['unit']=_0x618bcc;}),_0x19d890[_0x4b4ee3(0xd9)]((_0x3ecb1f,_0x2ba0f0)=>{var _0x220adb=_0x4b4ee3;_0x5bc7a8[_0x2ba0f0][_0x220adb(0xdb)]=_0x3ecb1f;}),_0x4ba911[_0x4b4ee3(0xd9)]((_0x3bf6a9,_0x3b0720)=>{var _0x94d344=_0x4b4ee3;_0x5bc7a8[_0x3b0720][_0x94d344(0x174)]=_0x3bf6a9;}),_0x18557b[_0x4b4ee3(0xd9)]((_0x1871cd,_0x111413)=>{var _0x2669a2=_0x4b4ee3;_0x5bc7a8[_0x111413][_0x2669a2(0xf4)]=_0x1871cd;}),_0x318320[_0x4b4ee3(0xd9)]((_0x2af14c,_0x2ae237)=>{var _0x5de09b=_0x4b4ee3;_0x5bc7a8[_0x2ae237][_0x5de09b(0xa1)]=_0x2af14c;}),_0x41a5f7[_0x4b4ee3(0xd9)]((_0x5e6afe,_0x3f5417)=>{var _0x29bd35=_0x4b4ee3;_0x5bc7a8[_0x3f5417][_0x29bd35(0x132)]=_0x5e6afe;}),_0x41942f[_0x4b4ee3(0xd9)]((_0x15b5fd,_0x42be89)=>{var _0x2a3f04=_0x4b4ee3;_0x5bc7a8[_0x42be89][_0x2a3f04(0x92)]=Math[_0x2a3f04(0xcd)](_0x15b5fd);}),_0x39a7e1['forEach']((_0x576f83,_0x18a2c6)=>{_0x5bc7a8[_0x18a2c6]['delivery_date']=_0x576f83;}),_0x3a012a[_0x4b4ee3(0xd9)]((_0x6d820d,_0x313a85)=>{var _0x1294a6=_0x4b4ee3;_0x5bc7a8[_0x313a85][_0x1294a6(0x137)]=_0x6d820d;}),_0x5e1807[_0x4b4ee3(0xd9)]((_0x184494,_0x514a52)=>{var _0xbd7494=_0x4b4ee3;_0x5bc7a8[_0x514a52][_0xbd7494(0x10a)]=_0x184494;}),_0x59d04e[_0x4b4ee3(0xd9)]((_0x212d73,_0x3fc43f)=>{var _0x5cf45b=_0x4b4ee3;_0x5bc7a8[_0x3fc43f][_0x5cf45b(0x9e)]=_0x212d73;}),_0x25822d[_0x4b4ee3(0xd9)]((_0x1d47c4,_0x1ded26)=>{_0x5bc7a8[_0x1ded26]['room_name']=_0x1d47c4;});var _0x4b01b9=0x0;_0x5bc7a8[_0x4b4ee3(0xd9)](_0x14d3f0=>{var _0x2e81fc=_0x4b4ee3;console[_0x2e81fc(0xfd)]('foreach\x20newproduct',_0x14d3f0),(parseInt(_0x14d3f0[_0x2e81fc(0x87)])<parseInt(_0x14d3f0[_0x2e81fc(0x143)])||parseInt(_0x14d3f0['quantity'])==0x0)&&_0x4b01b9++;});if(_0x4b01b9!=0x0)return _0x124678[_0x4b4ee3(0xe4)](_0x4b4ee3(0xb9),_0x4b4ee3(0x10b)),_0x3615b4[_0x4b4ee3(0x12a)](_0x4b4ee3(0x15c));const _0x12fe99=_0x5bc7a8[_0x4b4ee3(0x10e)](_0x2ef6d7=>_0x2ef6d7[_0x4b4ee3(0x143)]!=='0'&&_0x2ef6d7[_0x4b4ee3(0x143)]!=='');_0x494213[_0x4b4ee3(0xe9)]=_0x3fc25d,_0x494213[_0x4b4ee3(0x187)]=_0x1b3ec2,_0x494213[_0x4b4ee3(0x86)]=_0x55c2a0,_0x494213[_0x4b4ee3(0x12d)]=_0x4ad07c,_0x494213[_0x4b4ee3(0x188)]=_0x12fe99,_0x494213[_0x4b4ee3(0xee)]=_0x4a0705,_0x494213[_0x4b4ee3(0x156)]=_0x2dc0f9,_0x494213[_0x4b4ee3(0x94)]=_0x4b4ee3(0x98),_0x494213[_0x4b4ee3(0x117)]=_0x4b4ee3(0x98);const _0x54f8f1=await _0x494213[_0x4b4ee3(0x11f)]();_0x124678[_0x4b4ee3(0xe4)]('success',_0x4b4ee3(0xd7)),_0x3615b4[_0x4b4ee3(0x12a)]('/all_sales/view');}catch(_0x5d91ed){console['log'](_0x5d91ed);}}),router[a0_0x15c2a4(0x189)](a0_0x15c2a4(0x150),auth,async(_0x405521,_0x2bcf17)=>{var _0x287cba=a0_0x15c2a4;try{const _0x278ca7=_0x405521[_0x287cba(0x180)]['id'],{invoice:_0x3febca,customer:_0x49473f,receivable_amount:_0x1063ed,received_amount:_0x3765e6}=_0x405521[_0x287cba(0xb4)],_0x36bd41=await sales[_0x287cba(0x165)](_0x278ca7);console[_0x287cba(0xfd)](_0x36bd41);var _0x353b88=_0x1063ed-_0x3765e6;console[_0x287cba(0xfd)](_0x3765e6),_0x36bd41['received_amount']=parseFloat(_0x3765e6)+parseFloat(_0x36bd41[_0x287cba(0xf9)]),_0x36bd41['due_amount']=_0x353b88,console['log'](_0x36bd41);const _0x41e85d=await _0x36bd41[_0x287cba(0x11f)](),_0x55ec12=await c_payment_data[_0x287cba(0x8b)]({'invoice':_0x3febca});_0x55ec12[_0x287cba(0x166)]=_0x353b88,await _0x55ec12[_0x287cba(0x11f)]();let _0x8b5c61=new Date(),_0x4de8df=('0'+_0x8b5c61['getDate']())[_0x287cba(0x139)](-0x2),_0x438c95=('0'+(_0x8b5c61[_0x287cba(0xc2)]()+0x1))[_0x287cba(0x139)](-0x2),_0x2636ea=_0x8b5c61[_0x287cba(0x104)](),_0x4693c1=_0x2636ea+'-'+_0x438c95+'-'+_0x4de8df;const _0x5058c4=new customer_payment({'invoice':_0x3febca,'date':_0x2636ea+'-'+_0x438c95+'-'+_0x4de8df,'customer':_0x49473f,'reason':_0x287cba(0x18c),'amount':_0x3765e6}),_0x18c3d5=await _0x5058c4['save']();_0x405521[_0x287cba(0xe4)](_0x287cba(0x128),_0x287cba(0x13f)),_0x2bcf17[_0x287cba(0x12a)](_0x287cba(0x115));}catch(_0x4eee6e){console[_0x287cba(0xfd)](_0x4eee6e);}}),router[a0_0x15c2a4(0xb0)](a0_0x15c2a4(0x18e),auth,async(_0x2d3a2a,_0x44dc01)=>{var _0x4517ba=a0_0x15c2a4;try{const {username:_0x2afe78,email:_0x1d08a9,role:_0x4c2eb1}=_0x2d3a2a['user'],_0x1afb79=_0x2d3a2a['user'],_0x4d4c5f=await profile['findOne']({'email':_0x1afb79['email']}),_0x49a829=await master_shop['find']();console[_0x4517ba(0xfd)](_0x4517ba(0x89),_0x49a829);const _0x5f3235=_0x2d3a2a[_0x4517ba(0x180)]['id'],_0xbab822=await sales[_0x4517ba(0x165)](_0x5f3235);console[_0x4517ba(0xfd)](_0xbab822);const _0x2cd2ff=await customer[_0x4517ba(0x8b)]({'name':_0xbab822[_0x4517ba(0x187)]});console['log'](_0x2cd2ff);if(_0x49a829[0x0][_0x4517ba(0x185)]==_0x4517ba(0x183)){var _0x59b9cd=users['English'];console['log'](_0x59b9cd);}else{if(_0x49a829[0x0][_0x4517ba(0x185)]=='Hindi')var _0x59b9cd=users[_0x4517ba(0x102)];else{if(_0x49a829[0x0][_0x4517ba(0x185)]==_0x4517ba(0x157))var _0x59b9cd=users[_0x4517ba(0x157)];else{if(_0x49a829[0x0][_0x4517ba(0x185)]=='Spanish')var _0x59b9cd=users['Spanish'];else{if(_0x49a829[0x0][_0x4517ba(0x185)]=='French')var _0x59b9cd=users[_0x4517ba(0xad)];else{if(_0x49a829[0x0]['language']==_0x4517ba(0x8e))var _0x59b9cd=users[_0x4517ba(0xf5)];else{if(_0x49a829[0x0][_0x4517ba(0x185)]==_0x4517ba(0x17c))var _0x59b9cd=users[_0x4517ba(0x17c)];else{if(_0x49a829[0x0][_0x4517ba(0x185)]==_0x4517ba(0xc3))var _0x59b9cd=users[_0x4517ba(0xd3)];}}}}}}}_0x44dc01[_0x4517ba(0x18a)]('sales_invoice',{'success':_0x2d3a2a[_0x4517ba(0xe4)]('success'),'errors':_0x2d3a2a[_0x4517ba(0xe4)](_0x4517ba(0xb9)),'role':_0x1afb79,'profile':_0x4d4c5f,'master_shop':_0x49a829,'customers':_0x2cd2ff,'sales':_0xbab822,'language':_0x59b9cd});}catch(_0x5d0f6e){console['log'](_0x5d0f6e);}}),router['get']('/view/return_sales/:id',auth,async(_0x1603b5,_0x3d3a21)=>{var _0x5a0b94=a0_0x15c2a4;try{const {username:_0x4493f0,email:_0x47cc48,role:_0x204e60}=_0x1603b5['user'],_0x5b47d1=_0x1603b5[_0x5a0b94(0x123)],_0x49d83d=await profile[_0x5a0b94(0x8b)]({'email':_0x5b47d1['email']}),_0x34ccd8=await master_shop[_0x5a0b94(0xbc)]();console[_0x5a0b94(0xfd)](_0x5a0b94(0x89),_0x34ccd8);const _0x10fb3b=_0x1603b5[_0x5a0b94(0x180)]['id'];console[_0x5a0b94(0xfd)](_0x10fb3b);const _0x3c0289=await sales[_0x5a0b94(0x165)](_0x10fb3b);console['log'](_0x5a0b94(0x85),_0x3c0289);const _0x5a002e=await warehouse[_0x5a0b94(0xa0)]([{'$match':{'name':'Return\x20Goods','room':_0x5a0b94(0xa4)}},{'$unwind':_0x5a0b94(0xa7)},{'$group':{'_id':_0x5a0b94(0xb3),'name':{'$first':_0x5a0b94(0xfb)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x5a0b94(0x14b)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x5a0b94(0x17f)},'secondary_code':{'$first':_0x5a0b94(0x88)},'product_code':{'$first':_0x5a0b94(0xa2)}}}]);console[_0x5a0b94(0xfd)](_0x5a0b94(0xd6),_0x5a002e);const _0x3b0639=await product['find']({});warehouse_data=await warehouse[_0x5a0b94(0xa0)]([{'$match':{'status':_0x5a0b94(0xb8),'name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x5a0b94(0x13b),'name':{'$first':_0x5a0b94(0x13b)}}},{'$sort':{'name':0x1}}]);var _0x567980=[_0x5a0b94(0xa4)];if(_0x34ccd8[0x0][_0x5a0b94(0x185)]==_0x5a0b94(0x183)){var _0x6905fc=users['English'];console[_0x5a0b94(0xfd)](_0x6905fc);}else{if(_0x34ccd8[0x0][_0x5a0b94(0x185)]=='Hindi')var _0x6905fc=users[_0x5a0b94(0x102)];else{if(_0x34ccd8[0x0][_0x5a0b94(0x185)]==_0x5a0b94(0x157))var _0x6905fc=users[_0x5a0b94(0x157)];else{if(_0x34ccd8[0x0][_0x5a0b94(0x185)]==_0x5a0b94(0xdd))var _0x6905fc=users[_0x5a0b94(0xdd)];else{if(_0x34ccd8[0x0][_0x5a0b94(0x185)]==_0x5a0b94(0xad))var _0x6905fc=users[_0x5a0b94(0xad)];else{if(_0x34ccd8[0x0][_0x5a0b94(0x185)]=='Portuguese\x20(BR)')var _0x6905fc=users[_0x5a0b94(0xf5)];else{if(_0x34ccd8[0x0][_0x5a0b94(0x185)]==_0x5a0b94(0x17c))var _0x6905fc=users['Chinese'];else{if(_0x34ccd8[0x0][_0x5a0b94(0x185)]==_0x5a0b94(0xc3))var _0x6905fc=users['Arabic'];}}}}}}}_0x3d3a21[_0x5a0b94(0x18a)](_0x5a0b94(0x109),{'success':_0x1603b5[_0x5a0b94(0xe4)](_0x5a0b94(0x128)),'errors':_0x1603b5[_0x5a0b94(0xe4)](_0x5a0b94(0xb9)),'role':_0x5b47d1,'profile':_0x49d83d,'user':_0x3c0289,'stock':_0x5a002e,'master_shop':_0x34ccd8,'unit':_0x3b0639,'language':_0x6905fc,'warehouses':warehouse_data,'rooms':_0x567980});}catch(_0x451adc){console[_0x5a0b94(0xfd)](_0x451adc),_0x3d3a21[_0x5a0b94(0x130)](0xc8)[_0x5a0b94(0x15b)]({'message':_0x451adc['message']});}}),router['post'](a0_0x15c2a4(0x105),auth,async(_0x18139a,_0x48cd75)=>{var _0x3b1579=a0_0x15c2a4;try{const {invoice:_0x157d20,date:_0x33f81c,warehouse_name:_0x2429ea,product_name:_0x5732b7,primary_code:_0x281966,secondary_code:_0x1ff7e0,product_code:_0x4d0319,sales_quantity:_0xda0031,stocks:_0x1aac6a,return_qty:_0x40d0a4,Room_name:_0x46fe8a,to_warehouse_name:_0xb3d89,to_Roomname:_0x304611,to_Room_name:_0x896909,note:_0x549194,level:_0x3c4ef5,isle:_0x378036,pallet:_0x5f2236}=_0x18139a[_0x3b1579(0xb4)];if(typeof _0x5732b7==_0x3b1579(0x101))var _0x2af360=[_0x18139a[_0x3b1579(0xb4)][_0x3b1579(0x167)]],_0x193325=[_0x18139a[_0x3b1579(0xb4)][_0x3b1579(0x100)]],_0x2e1271=[_0x18139a[_0x3b1579(0xb4)][_0x3b1579(0xea)]],_0x28b678=[_0x18139a['body'][_0x3b1579(0x10d)]],_0x1e459d=[_0x18139a[_0x3b1579(0xb4)][_0x3b1579(0x124)]],_0x1aedc4=[_0x18139a[_0x3b1579(0xb4)][_0x3b1579(0xfa)]],_0x480266=[_0x18139a['body'][_0x3b1579(0x10f)]],_0x170785=[_0x18139a[_0x3b1579(0xb4)][_0x3b1579(0xa8)]],_0x4aafc6=[_0x18139a[_0x3b1579(0xb4)][_0x3b1579(0x129)]],_0xf1129b=[_0x18139a[_0x3b1579(0xb4)][_0x3b1579(0x13c)]],_0x1b5765=[_0x18139a[_0x3b1579(0xb4)][_0x3b1579(0x9f)]];else var _0x2af360=[..._0x18139a['body'][_0x3b1579(0x167)]],_0x193325=[..._0x18139a[_0x3b1579(0xb4)][_0x3b1579(0x100)]],_0x2e1271=[..._0x18139a[_0x3b1579(0xb4)][_0x3b1579(0xea)]],_0x28b678=[..._0x18139a[_0x3b1579(0xb4)]['product_code']],_0x1e459d=[..._0x18139a[_0x3b1579(0xb4)][_0x3b1579(0x124)]],_0x1aedc4=[..._0x18139a['body'][_0x3b1579(0xfa)]],_0x480266=[..._0x18139a[_0x3b1579(0xb4)][_0x3b1579(0x10f)]],_0x170785=[..._0x18139a[_0x3b1579(0xb4)][_0x3b1579(0xa8)]],_0x4aafc6=[..._0x18139a[_0x3b1579(0xb4)]['bin']],_0xf1129b=[..._0x18139a['body']['types']],_0x1b5765=[..._0x18139a['body'][_0x3b1579(0x9f)]];const _0x544799=_0x2af360[_0x3b1579(0x146)](_0x39d1af=>{return _0x39d1af={'product_name':_0x39d1af};});_0x193325[_0x3b1579(0xd9)]((_0x1e9440,_0x5a778a)=>{var _0x1950bb=_0x3b1579;_0x544799[_0x5a778a][_0x1950bb(0x100)]=_0x1e9440;}),_0x2e1271[_0x3b1579(0xd9)]((_0xd3b45a,_0x56e923)=>{var _0x305a4a=_0x3b1579;_0x544799[_0x56e923][_0x305a4a(0xea)]=_0xd3b45a;}),_0x28b678[_0x3b1579(0xd9)]((_0x32050b,_0x1eeac6)=>{var _0x3bb01e=_0x3b1579;_0x544799[_0x1eeac6][_0x3bb01e(0x10d)]=_0x32050b;}),_0x1e459d[_0x3b1579(0xd9)]((_0x100b3e,_0xde3fc1)=>{var _0x3811b2=_0x3b1579;_0x544799[_0xde3fc1][_0x3811b2(0x16f)]=_0x100b3e;}),_0x1aedc4[_0x3b1579(0xd9)]((_0x5eaeab,_0x4ef327)=>{_0x544799[_0x4ef327]['stock']=_0x5eaeab;}),_0x480266[_0x3b1579(0xd9)]((_0x2418db,_0x7df674)=>{var _0x5710cc=_0x3b1579;_0x544799[_0x7df674][_0x5710cc(0x10f)]=_0x2418db;}),_0x170785['forEach']((_0x5748e2,_0x3682ee)=>{_0x544799[_0x3682ee]['bay']=_0x5748e2;}),_0x4aafc6[_0x3b1579(0xd9)]((_0x31a651,_0x1981a7)=>{var _0x62a58f=_0x3b1579;_0x544799[_0x1981a7][_0x62a58f(0x129)]=_0x31a651;}),_0xf1129b[_0x3b1579(0xd9)]((_0x1e8d7c,_0x545d7b)=>{var _0x234c62=_0x3b1579;_0x544799[_0x545d7b][_0x234c62(0x151)]=_0x1e8d7c;}),_0x1b5765[_0x3b1579(0xd9)]((_0x2ac761,_0x151a61)=>{var _0x441968=_0x3b1579;_0x544799[_0x151a61][_0x441968(0x9f)]=_0x2ac761;});var _0x57d1bf=0x0;_0x544799[_0x3b1579(0xd9)](_0x51d4df=>{var _0x32a585=_0x3b1579;console['log'](_0x32a585(0x141),_0x51d4df),(parseInt(_0x51d4df['sale_qty'])<parseInt(_0x51d4df['return_qty'])||parseInt(_0x51d4df['stock'])<parseInt(_0x51d4df['return_qty'])&&parseInt(_0x51d4df[_0x32a585(0x16f)])>parseInt(_0x51d4df[_0x32a585(0x10f)])||parseInt(_0x51d4df[_0x32a585(0x10f)])==0x0)&&_0x57d1bf++;});if(_0x57d1bf!=0x0)return _0x18139a[_0x3b1579(0xe4)](_0x3b1579(0xb9),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x48cd75[_0x3b1579(0x12a)](_0x3b1579(0x15c));const _0x312141=await sales[_0x3b1579(0x8b)]({'invoice':_0x157d20});console[_0x3b1579(0xfd)](_0x312141),_0x312141[_0x3b1579(0xb7)]='True';const _0x2f3678=await _0x312141[_0x3b1579(0x11f)](),_0x2073cf=new sales_return({'invoice':_0x157d20,'customer':_0x18139a[_0x3b1579(0xb4)][_0x3b1579(0x187)],'date':_0x33f81c,'warehouse_name':_0x2429ea,'room':_0x46fe8a,'ToWarehouse':_0xb3d89,'ToRoom':_0x896909,'return_sale':_0x544799,'note':_0x549194}),_0x52f78d=await _0x2073cf[_0x3b1579(0x11f)]();console[_0x3b1579(0xfd)](_0x2073cf);const _0x4dd2ac=await sales_return[_0x3b1579(0x8b)]({'invoice':_0x157d20}),_0x4426a0=await warehouse[_0x3b1579(0x8b)]({'name':_0xb3d89,'room':_0x896909});_0x4dd2ac[_0x3b1579(0x109)][_0x3b1579(0xd9)](_0x48124a=>{var _0x2bf6ef=_0x3b1579,_0x547553=0x0;const _0x244918=_0x4426a0[_0x2bf6ef(0x16a)][_0x2bf6ef(0x146)](_0x236941=>{var _0x232a23=_0x2bf6ef;_0x236941['product_name']==_0x48124a['product_name']&&_0x236941[_0x232a23(0x9f)]==_0x48124a[_0x232a23(0x9f)]&&_0x236941[_0x232a23(0x151)]==_0x48124a[_0x232a23(0x151)]&&_0x236941['bin']==_0x48124a[_0x232a23(0x129)]&&_0x236941[_0x232a23(0xa8)]==_0x48124a[_0x232a23(0xa8)]&&(_0x236941['product_stock']=parseInt(_0x236941['product_stock'])+parseInt(_0x48124a['return_qty']),_0x547553++);});_0x547553=='0'&&(_0x4426a0['product_details']=_0x4426a0[_0x2bf6ef(0x16a)][_0x2bf6ef(0x153)]({'product_name':_0x48124a[_0x2bf6ef(0x167)],'product_stock':_0x48124a['return_qty'],'primary_code':_0x48124a[_0x2bf6ef(0x100)],'secondary_code':_0x48124a['secondary_code'],'product_code':_0x48124a[_0x2bf6ef(0x10d)],'bay':_0x48124a['bay'],'bin':_0x48124a[_0x2bf6ef(0x129)],'type':_0x48124a['type'],'floorlevel':_0x48124a['floorlevel']})),console[_0x2bf6ef(0xfd)]('final',_0x4426a0);}),await _0x4426a0[_0x3b1579(0x11f)](),console['log'](_0x18139a['body']);const _0x58005b=new c_payment_data({'invoice':_0x157d20,'customer':_0x18139a['body'][_0x3b1579(0x187)],'reason':_0x3b1579(0xca)});await _0x58005b[_0x3b1579(0x11f)]();const _0x5315cc=await master_shop[_0x3b1579(0xbc)]();console[_0x3b1579(0xfd)]('add\x20post',_0x5315cc[0x0][_0x3b1579(0x163)]);const _0x1fe770=await email_settings[_0x3b1579(0x8b)](),_0x50e792=await customer[_0x3b1579(0x8b)]({'name':_0x18139a['body'][_0x3b1579(0x187)]});console[_0x3b1579(0xfd)]('customer_data',_0x50e792);_0x5315cc[0x0][_0x3b1579(0xb6)]==0x1?(right_currency=_0x5315cc[0x0][_0x3b1579(0x13d)],left_currency=''):(right_currency='',left_currency=_0x5315cc[0x0][_0x3b1579(0x13d)]);var _0x12fd7d=_0x2af360,_0x200f8f=_0x480266,_0x2b3892='',_0x2d5d84;for(_0x2d5d84 in _0x12fd7d){_0x2b3892+=_0x3b1579(0x145)+_0x3b1579(0xf6)+_0x12fd7d[_0x2d5d84]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x200f8f[_0x2d5d84]+_0x3b1579(0x113)+_0x3b1579(0x134);}console[_0x3b1579(0xfd)](_0x3b1579(0x14c),_0x2b3892);let _0x259c97=nodemailer[_0x3b1579(0x15d)]({'service':'gmail','auth':{'user':_0x1fe770['email'],'pass':_0x1fe770[_0x3b1579(0xf2)]}}),_0x415cbf={'from':_0x1fe770[_0x3b1579(0x16c)],'to':_0x50e792[_0x3b1579(0x16c)],'subject':_0x3b1579(0x147),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3b1579(0xec)+_0x3b1579(0x172)+_0x5315cc[0x0][_0x3b1579(0x163)],'cid':'logo'}],'html':_0x3b1579(0xc7)+_0x3b1579(0x96)+_0x3b1579(0xc6)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x3b1579(0xa3)+_0x3b1579(0x148)+_0x3b1579(0xe5)+_0x3b1579(0x171)+_0x5315cc[0x0]['site_title']+'\x20</h2>'+_0x3b1579(0x148)+_0x3b1579(0x148)+_0x3b1579(0x15f)+_0x3b1579(0xe5)+_0x3b1579(0xfe)+_0x3b1579(0x17d)+_0x157d20+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x33f81c+'\x20'+_0x3b1579(0xe1)+_0x3b1579(0x114)+_0x3b1579(0x148)+_0x3b1579(0xdc)+_0x3b1579(0xc5)+_0x3b1579(0x145)+_0x3b1579(0xa6)+_0x3b1579(0xbf)+_0x3b1579(0xda)+_0x3b1579(0x149)+_0x3b1579(0x134)+'</thead>'+_0x3b1579(0x140)+'\x20'+_0x2b3892+'\x20'+_0x3b1579(0x15a)+_0x3b1579(0x186)+_0x3b1579(0xe5)+_0x3b1579(0x12b)+_0x3b1579(0x11a)+_0x5315cc[0x0]['site_title']+_0x3b1579(0x114)+_0x3b1579(0x148)+_0x3b1579(0x148)+_0x3b1579(0x119)};_0x259c97[_0x3b1579(0xf3)](_0x415cbf,function(_0xbc0602,_0xa753e9){var _0x4e44f6=_0x3b1579;_0xbc0602?(console['log'](_0xbc0602),console['log'](_0x4e44f6(0x136))):console[_0x4e44f6(0xfd)](_0x4e44f6(0x108));}),_0x18139a[_0x3b1579(0xe4)](_0x3b1579(0x128),'sales\x20item\x20return\x20successfull'),_0x48cd75[_0x3b1579(0x12a)](_0x3b1579(0x115));}catch(_0x10275d){console['log'](_0x10275d),_0x48cd75[_0x3b1579(0x130)](0xc8)[_0x3b1579(0x15b)]({'message1':_0x10275d[_0x3b1579(0xc0)]});}}),router[a0_0x15c2a4(0xb0)](a0_0x15c2a4(0xb1),auth,async(_0x15cf6b,_0x3d9b3e)=>{var _0x3eff4a=a0_0x15c2a4;try{const {username:_0x32bedd,email:_0x80130d,role:_0x4102b3}=_0x15cf6b[_0x3eff4a(0x123)],_0x5ebbbc=_0x15cf6b[_0x3eff4a(0x123)],_0x3220d3=await profile[_0x3eff4a(0x8b)]({'email':_0x5ebbbc[_0x3eff4a(0x16c)]}),_0x5c555c=await master_shop['find']();console[_0x3eff4a(0xfd)]('barcode\x20Product\x20master',_0x5c555c);const _0x1f39f7=_0x15cf6b[_0x3eff4a(0x180)]['id'],_0x57c341=await sales['findById'](_0x1f39f7);console[_0x3eff4a(0xfd)](_0x3eff4a(0xd1),_0x57c341);if(_0x5c555c[0x0][_0x3eff4a(0x185)]==_0x3eff4a(0x183))var _0x22848c=users['English'];else{if(_0x5c555c[0x0][_0x3eff4a(0x185)]==_0x3eff4a(0x102))var _0x22848c=users[_0x3eff4a(0x102)];else{if(_0x5c555c[0x0][_0x3eff4a(0x185)]=='German')var _0x22848c=users[_0x3eff4a(0x157)];else{if(_0x5c555c[0x0]['language']==_0x3eff4a(0xdd))var _0x22848c=users[_0x3eff4a(0xdd)];else{if(_0x5c555c[0x0][_0x3eff4a(0x185)]==_0x3eff4a(0xad))var _0x22848c=users[_0x3eff4a(0xad)];else{if(_0x5c555c[0x0][_0x3eff4a(0x185)]==_0x3eff4a(0x8e))var _0x22848c=users[_0x3eff4a(0xf5)];else{if(_0x5c555c[0x0][_0x3eff4a(0x185)]==_0x3eff4a(0x17c))var _0x22848c=users[_0x3eff4a(0x17c)];else{if(_0x5c555c[0x0][_0x3eff4a(0x185)]==_0x3eff4a(0xc3))var _0x22848c=users[_0x3eff4a(0xd3)];}}}}}}}_0x3d9b3e[_0x3eff4a(0x18a)]('all_sales_barcode',{'success':_0x15cf6b[_0x3eff4a(0xe4)]('success'),'errors':_0x15cf6b['flash'](_0x3eff4a(0xb9)),'role':_0x5ebbbc,'profile':_0x3220d3,'alldata':_0x57c341,'master_shop':_0x5c555c,'language':_0x22848c});}catch(_0x199b10){console[_0x3eff4a(0xfd)](_0x199b10);}}),router['post'](a0_0x15c2a4(0x12c),async(_0x5b80e2,_0x18b5b4)=>{var _0x36ead7=a0_0x15c2a4;const {product_code:_0x463cc3,warehouse_name:_0x39e369,rooms_data:_0x3c2420,Roomslist:_0xd14649}=_0x5b80e2[_0x36ead7(0xb4)],_0x5b58ff=_0xd14649[_0x36ead7(0x18f)](','),_0x5b188c=[];async function _0x5c0fc0(_0x1ae50a){var _0x578641=_0x36ead7;const _0xa2a6af=await warehouse['aggregate']([{'$match':{'name':_0x39e369,'room':_0x1ae50a}},{'$unwind':_0x578641(0xa7)},{'$match':{'product_details.primary_code':_0x463cc3}},{'$group':{'_id':_0x578641(0xb3),'name':{'$first':_0x578641(0xfb)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x578641(0x17f)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x578641(0x8f)},'type':{'$first':_0x578641(0x95)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x578641(0xbd)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x578641(0x122)},'rack':{'$first':_0x578641(0x164)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x578641(0x9a)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x578641(0x17e)},'invoice':{'$first':_0x578641(0x176)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x578641(0xaa)}}}]),_0x2e5f0c=await warehouse[_0x578641(0xa0)]([{'$match':{'name':_0x39e369,'room':_0x1ae50a}},{'$unwind':_0x578641(0xa7)},{'$match':{'product_details.secondary_code':_0x463cc3}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x578641(0xfb)},'product_stock':{'$first':_0x578641(0x116)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x578641(0x88)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x578641(0x138)},'isle':{'$first':_0x578641(0x8f)},'type':{'$first':_0x578641(0x95)},'pallet':{'$first':_0x578641(0x93)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x578641(0x17b)},'storage':{'$first':_0x578641(0x122)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x578641(0x9a)},'maxPerUnit':{'$first':_0x578641(0x135)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x578641(0x120)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x578641(0x176)}}}]);if(_0xa2a6af['length']>0x0)_0x5b188c['push'](_0xa2a6af);else _0x2e5f0c[_0x578641(0xe2)]>0x0&&_0x5b188c['push'](_0x2e5f0c);}const _0x3f4417=_0x5b58ff[_0x36ead7(0x146)](_0x660869=>_0x5c0fc0(_0x660869));await Promise['all'](_0x3f4417),_0x18b5b4[_0x36ead7(0x15b)](_0x5b188c);}),module[a0_0x15c2a4(0xf0)]=router;