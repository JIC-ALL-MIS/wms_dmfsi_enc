function a0_0x26b9(){var _0x250d81=['$sale_product.type','Sale\x20Return','$product_details.expiry_date','storage','Arabic\x20(ae)','primary_code','success','$product_details.level','An\x20error\x20occurred.','delivery_date','all','user','delivery_code','findById','Receiving\x20Area','\x20</h2>','carton','return_qty','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','purchases_data','sendMail','<span\x20style=\x22float:\x20right;\x22>','sale_qty','$product_details.type','level','/preview/:id','</tr>','7331JeYCms','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','role','edit_sales_view','log','id_transact','return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','catch','</td>','warehouse_name','bay','<div>','all_sales','slice','batch_code','edit_sales','getMonth','$isAllowEdit','</h5>','product_stock','customers','message','json','amount','due_amount','/give_payment/:id','createTransport','stock_data','secondary_unit','5ZtJkiu','push','staff','/all_sales/view','Level','barcode\x20Product\x20master','Sales\x20Update\x20successfully','final','$warehouse_name','maxperunit','date','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.delivery_code','customer','$sale_product.quantity','abs','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','get','5133978fYLkhH','actual_uom','$room','<h5>','max_per_unit','all_sales_barcode','OUT-','save','Ambient','/view/:id','email','$date','\x20Order\x20Date\x20:\x20','toString','requested_qty','gmail','/all_sales/preview/','language','barcode\x20user_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','</div>','primary_unit','$customer','$sale_product','$name','$product','</span>','findOne','</body></html>','Router','render','Error\x20Occurs','/barcode_scanner','filter','/view/return_sales/:id','stock','then','<strong>\x20Regards\x20</strong>','$product_details.primary_code','/upload/','status','logo','../public/language/languages.json','Floor','find','product_data','$product_details.actual_uom','invoice','$sale_product.floorlevel','$product_details.product_code','return_sale','$product_details.product_name','site_title','add\x20post','</head><body>','<html><head><title></title>','$product_details.unit','finalize','462rKnQXc','36orOIuD','body','$product_details.production_date','back','$note','Hindi','_id','unit','add_sales','concat','customers_docs','product_code','rack','length','user_id','$product_details.secondary_code','<tbody\x20style=\x22text-align:\x20center;\x22>','secondary_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','customer_data','5408bsFTNm','flash','False','<table\x20style=\x22width:\x20100%\x20!important;\x22>','foreach\x20newproduct','Received\x20Payment\x20For\x20Sale','/view','$product_details.pallet','/../public','6579230PmYQvD','99464HIUQal','<h2>\x20','types','name','English','currency','$product_details.bay','/invoice/:id','13643REJPZJ','$sale_product.bin','note','<tr>','/barcode/:id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','split','error','</tbody>','map','$_id','received_amount','</table>','product_name','180096XhXSNN','Spanish','host','SCRN','room_name','\x20Order\x20Number\x20:\x20','$product_details.product_stock','floorlevel','Shelves','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Sales\x20Mail','9WkYoWN','3565185fTzzqg','warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','random','/view/add_sales/:id','<hr\x20class=\x22my-3\x22>','production_date','Portuguese','Portuguese\x20(BR)','$return_data','RoomAssigned','Return\x20Goods','errors','Chinese','$sale_product.bay','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_cat','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','floor','Enclosed','$product_details.actual_qty','sales_quantity','port','$product_details.batch_code','string','$product_details','post','sale_product','prod_code','../models/all_models','$product_details.bin','$product_details.invoice','$product_details._id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Enabled','Raw\x20Materials','expiry_date','$product_details.maxPerUnit','True','id_transaction_from','quantity_notConverted','quantity','$customers_docs','padStart','stocks','English\x20(US)','German','max','$product_details.secondary_unit','actual_qty','Return\x20Rooms','master','$product_details.isle','product_list','sales\x20item\x20return\x20successfull','prod_invoice','type','$product_details.rack','</thead>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','params','bin','redirect','RMSEmail','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','image','prod_cat','aggregate','forEach','Arabic','$product_details.storage','$finalize','French','room'];a0_0x26b9=function(){return _0x250d81;};return a0_0x26b9();}var a0_0x20b97e=a0_0x556d;(function(_0x53c0b3,_0x53c532){var _0x10fa0b=a0_0x556d,_0x4a4231=_0x53c0b3();while(!![]){try{var _0xf83686=parseInt(_0x10fa0b(0x1dd))/0x1*(parseInt(_0x10fa0b(0x24b))/0x2)+parseInt(_0x10fa0b(0x176))/0x3+-parseInt(_0x10fa0b(0x154))/0x4+-parseInt(_0x10fa0b(0x1fd))/0x5*(-parseInt(_0x10fa0b(0x210))/0x6)+parseInt(_0x10fa0b(0x15c))/0x7*(-parseInt(_0x10fa0b(0x14a))/0x8)+-parseInt(_0x10fa0b(0x175))/0x9*(-parseInt(_0x10fa0b(0x153))/0xa)+-parseInt(_0x10fa0b(0x24a))/0xb*(parseInt(_0x10fa0b(0x16a))/0xc);if(_0xf83686===_0x53c532)break;else _0x4a4231['push'](_0x4a4231['shift']());}catch(_0x43d5cf){_0x4a4231['push'](_0x4a4231['shift']());}}}(a0_0x26b9,0xd241d));const express=require('express'),app=express(),router=express[a0_0x20b97e(0x22d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x20b97e(0x194)),auth=require('../middleware/auth'),nodemailer=require('nodemailer'),users=require(a0_0x20b97e(0x23a));router[a0_0x20b97e(0x20f)](a0_0x20b97e(0x150),auth,async(_0x4a364d,_0x2ffd4d)=>{var _0x3b105a=a0_0x20b97e;try{const {username:_0x5238eb,email:_0x4dc362,role:_0x55cecd}=_0x4a364d[_0x3b105a(0x1cc)],_0x3605b3=_0x4a364d[_0x3b105a(0x1cc)],_0x127e74=await profile[_0x3b105a(0x22b)]({'email':_0x3605b3[_0x3b105a(0x21a)]}),_0x20f050=await master_shop['find']();let _0x76b0a5;if(_0x3605b3[_0x3b105a(0x1e0)]=='staff'){const _0x4afb84=await staff[_0x3b105a(0x22b)]({'email':_0x3605b3[_0x3b105a(0x21a)]});_0x76b0a5=await sales['aggregate']([{'$lookup':{'from':_0x3b105a(0x1f4),'localField':_0x3b105a(0x20a),'foreignField':'name','as':_0x3b105a(0x140)}},{'$unwind':_0x3b105a(0x1a1)},{'$unwind':_0x3b105a(0x227)},{'$group':{'_id':_0x3b105a(0x166),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3b105a(0x226)},'date':{'$first':_0x3b105a(0x21b)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3b105a(0x227)},'note':{'$first':_0x3b105a(0x13a)},'return_data':{'$first':_0x3b105a(0x17f)},'customers_docs':{'$first':_0x3b105a(0x1a1)},'total_saleproduct_quantity':{'$sum':_0x3b105a(0x20b)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x3b105a(0x15d)},'type':{'$addToSet':_0x3b105a(0x1c1)},'pallet':{'$addToSet':_0x3b105a(0x240)},'finalize':{'$first':_0x3b105a(0x1be)},'isAllowEdit':{'$first':_0x3b105a(0x1f1)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x76b0a5=await sales['aggregate']([{'$lookup':{'from':_0x3b105a(0x1f4),'localField':_0x3b105a(0x20a),'foreignField':_0x3b105a(0x157),'as':_0x3b105a(0x140)}},{'$unwind':_0x3b105a(0x1a1)},{'$unwind':_0x3b105a(0x227)},{'$group':{'_id':_0x3b105a(0x166),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3b105a(0x226)},'date':{'$first':_0x3b105a(0x21b)},'warehouse_name':{'$first':_0x3b105a(0x205)},'sale_product':{'$push':_0x3b105a(0x227)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x3b105a(0x1a1)},'total_saleproduct_quantity':{'$sum':_0x3b105a(0x20b)},'level':{'$addToSet':_0x3b105a(0x184)},'isle':{'$addToSet':_0x3b105a(0x15d)},'type':{'$addToSet':_0x3b105a(0x1c1)},'pallet':{'$addToSet':_0x3b105a(0x240)},'finalize':{'$first':_0x3b105a(0x1be)},'isAllowEdit':{'$first':_0x3b105a(0x1f1)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3b105a(0x1e2)]('sales\x20all_data',_0x76b0a5);if(_0x20f050[0x0][_0x3b105a(0x221)]=='English\x20(US)'){var _0x164eab=users[_0x3b105a(0x158)];console['log'](_0x164eab);}else{if(_0x20f050[0x0][_0x3b105a(0x221)]==_0x3b105a(0x13b))var _0x164eab=users[_0x3b105a(0x13b)];else{if(_0x20f050[0x0][_0x3b105a(0x221)]==_0x3b105a(0x1a5))var _0x164eab=users[_0x3b105a(0x1a5)];else{if(_0x20f050[0x0]['language']=='Spanish')var _0x164eab=users[_0x3b105a(0x16b)];else{if(_0x20f050[0x0]['language']==_0x3b105a(0x1bf))var _0x164eab=users['French'];else{if(_0x20f050[0x0]['language']=='Portuguese\x20(BR)')var _0x164eab=users[_0x3b105a(0x17d)];else{if(_0x20f050[0x0][_0x3b105a(0x221)]=='Chinese')var _0x164eab=users[_0x3b105a(0x183)];else{if(_0x20f050[0x0][_0x3b105a(0x221)]==_0x3b105a(0x1c5))var _0x164eab=users['Arabic'];}}}}}}}_0x2ffd4d[_0x3b105a(0x22e)](_0x3b105a(0x1ec),{'success':_0x4a364d[_0x3b105a(0x14b)](_0x3b105a(0x1c7)),'errors':_0x4a364d[_0x3b105a(0x14b)](_0x3b105a(0x182)),'sales':_0x76b0a5,'profile':_0x127e74,'role':_0x3605b3,'master_shop':_0x20f050,'language':_0x164eab});}catch(_0x3d8c1c){console[_0x3b105a(0x1e2)](_0x3d8c1c);}});function a0_0x556d(_0x2ec0a9,_0x2000c6){var _0x26b94f=a0_0x26b9();return a0_0x556d=function(_0x556d6b,_0x18d5b0){_0x556d6b=_0x556d6b-0x13a;var _0x4141ee=_0x26b94f[_0x556d6b];return _0x4141ee;},a0_0x556d(_0x2ec0a9,_0x2000c6);}async function getRandom8DigitNumber(){var _0x3a9faa=a0_0x20b97e;const _0x3f379a=0x989680,_0x929a41=0x5f5e0ff,_0x5f297f=Math[_0x3a9faa(0x189)](Math[_0x3a9faa(0x179)]()*(_0x929a41-_0x3f379a+0x1))+_0x3f379a;var _0x44eb37;const _0x1ee105=await sales[_0x3a9faa(0x22b)]({'invoice':_0x3a9faa(0x216)+_0x5f297f});return _0x1ee105&&_0x1ee105[_0x3a9faa(0x143)]>0x0?_0x44eb37=_0x3a9faa(0x216)+_0x5f297f:_0x44eb37='OUT-'+_0x5f297f,_0x44eb37;}router['get']('/view/add_sales',auth,async(_0x36722f,_0x413001)=>{var _0x564a25=a0_0x20b97e;try{const {username:_0xc09e2c,email:_0x4dbf76,role:_0x927ad}=_0x36722f[_0x564a25(0x1cc)],_0x5912fb=_0x36722f[_0x564a25(0x1cc)],_0x530e2d=await profile[_0x564a25(0x22b)]({'email':_0x5912fb[_0x564a25(0x21a)]}),_0x4c0e1d=await master_shop['find'](),_0x16a04f=await customer['find']({});let _0x1d5457;if(_0x5912fb[_0x564a25(0x1e0)]==_0x564a25(0x1ff)){const _0x5489be=await staff['findOne']({'email':_0x5912fb['email']});_0x1d5457=await warehouse[_0x564a25(0x1ba)]([{'$match':{'status':_0x564a25(0x199),'name':_0x5489be[_0x564a25(0x177)],'warehouse_category':_0x564a25(0x19a),'name':{'$ne':_0x564a25(0x181)}}},{'$group':{'_id':_0x564a25(0x228),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x1d5457=await warehouse[_0x564a25(0x1ba)]([{'$match':{'status':_0x564a25(0x199),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x564a25(0x181)}}},{'$group':{'_id':_0x564a25(0x228),'name':{'$first':_0x564a25(0x228)}}},{'$sort':{'name':0x1}}]);const _0x48b8ee=await product[_0x564a25(0x23c)]({});var _0x29f3e8=[_0x564a25(0x218),_0x564a25(0x18a)];const _0x1cb2a9=await sales[_0x564a25(0x23c)]({}),_0x3a2fcf=_0x1cb2a9[_0x564a25(0x143)]+0x1,_0x6ac67a='OUT-'+_0x3a2fcf[_0x564a25(0x21d)]()[_0x564a25(0x1a2)](0x5,'0');if(_0x4c0e1d[0x0]['language']=='English\x20(US)'){var _0x256ef9=users[_0x564a25(0x158)];console[_0x564a25(0x1e2)](_0x256ef9);}else{if(_0x4c0e1d[0x0][_0x564a25(0x221)]==_0x564a25(0x13b))var _0x256ef9=users[_0x564a25(0x13b)];else{if(_0x4c0e1d[0x0]['language']==_0x564a25(0x1a5))var _0x256ef9=users['German'];else{if(_0x4c0e1d[0x0][_0x564a25(0x221)]==_0x564a25(0x16b))var _0x256ef9=users['Spanish'];else{if(_0x4c0e1d[0x0]['language']==_0x564a25(0x1bf))var _0x256ef9=users[_0x564a25(0x1bf)];else{if(_0x4c0e1d[0x0]['language']==_0x564a25(0x17e))var _0x256ef9=users[_0x564a25(0x17d)];else{if(_0x4c0e1d[0x0][_0x564a25(0x221)]==_0x564a25(0x183))var _0x256ef9=users[_0x564a25(0x183)];else{if(_0x4c0e1d[0x0]['language']==_0x564a25(0x1c5))var _0x256ef9=users[_0x564a25(0x1bc)];}}}}}}}const _0x161a3b=getRandom8DigitNumber();_0x161a3b[_0x564a25(0x234)](_0x325476=>{var _0xb482cd=_0x564a25;_0x413001[_0xb482cd(0x22e)](_0xb482cd(0x13e),{'success':_0x36722f[_0xb482cd(0x14b)](_0xb482cd(0x1c7)),'errors':_0x36722f[_0xb482cd(0x14b)](_0xb482cd(0x182)),'role':_0x5912fb,'profile':_0x530e2d,'customer':_0x16a04f,'warehouse':_0x1d5457,'product':_0x48b8ee,'invoice':_0x325476,'master_shop':_0x4c0e1d,'language':_0x256ef9,'rooms_data':_0x29f3e8});})['catch'](_0x3ed6b0=>{var _0xcb908f=_0x564a25;_0x36722f[_0xcb908f(0x14b)](_0xcb908f(0x182),_0xcb908f(0x148)),_0x413001['redirect'](_0xcb908f(0x200));});}catch(_0x8bd1b6){console[_0x564a25(0x1e2)](_0x8bd1b6);}}),router[a0_0x20b97e(0x20f)](a0_0x20b97e(0x17a),auth,async(_0x7335a4,_0xcba58b)=>{var _0x2af759=a0_0x20b97e;try{const _0x1a7f98=_0x7335a4['params']['id'];console[_0x2af759(0x1e2)](_0x1a7f98);const _0xa3e905=await product[_0x2af759(0x23c)](),_0x3e332b=await purchases[_0x2af759(0x1ba)]([{'$match':{'warehouse_name':_0x1a7f98}},{'$unwind':_0x2af759(0x229)},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x2af759(0x1d5),_0x3e332b),_0xcba58b['status'](0xc8)[_0x2af759(0x1f6)]({'purchases_data':_0x3e332b,'product_data':_0xa3e905});}catch(_0x22c606){console[_0x2af759(0x1e2)](_0x22c606);}}),router['post']('/view/add_sale/product',auth,async(_0x170360,_0x44342c)=>{var _0x534dd0=a0_0x20b97e;try{const {warehouse_data:_0x5eea27,product_data:_0x298c16}=_0x170360[_0x534dd0(0x24c)];console['log'](_0x170360[_0x534dd0(0x24c)][_0x534dd0(0x23d)]);;const _0x319ab2=await master_shop[_0x534dd0(0x23c)]();console[_0x534dd0(0x1e2)](_0x534dd0(0x1aa),_0x319ab2);const _0x1c6d1b=await product[_0x534dd0(0x22b)]({'name':_0x298c16});console[_0x534dd0(0x1e2)]('product',_0x1c6d1b);const _0x3c8ffb=await warehouse[_0x534dd0(0x1ba)]([{'$match':{'name':_0x5eea27}},{'$unwind':_0x534dd0(0x190)},{'$match':{'product_details.product_name':_0x298c16}},{'$group':{'_id':_0x534dd0(0x243),'product_stock':{'$first':_0x534dd0(0x170)}}}]);console[_0x534dd0(0x1e2)](_0x534dd0(0x1fb),_0x3c8ffb),_0x44342c[_0x534dd0(0x238)](0xc8)['json']({'master':_0x319ab2,'new_product':_0x1c6d1b,'stock_data':_0x3c8ffb});}catch(_0x663ad9){console[_0x534dd0(0x1e2)](_0x663ad9);}}),router['post']('/view/add_sales',auth,async(_0x4cc491,_0x1e11c7)=>{var _0x2f689b=a0_0x20b97e;try{const {invoice:_0x41c408,date:_0x38c205,warehouse_name:_0x43d3bf,product_name:_0x1b8b72,stock:_0x8f6273,quantity:_0x1de4d2,note:_0x12905a,room:_0x207d6a,primary_code:_0xc67453,secondary_code:_0x1353ae,prod_code:_0x5822e1,level:_0x7251a2,isle:_0x2cc8fd,pallet:_0x363a1d,batch_code:_0x110b80,SCRN:_0x437f3a,expiry_date:_0x4d0906}=_0x4cc491[_0x2f689b(0x24c)];if(typeof _0x1b8b72=='string')var _0x2a2359=[_0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x169)]],_0x2a53f2=[_0x4cc491['body']['stock']],_0x5d3c09=[_0x4cc491[_0x2f689b(0x24c)]['carton']],_0x2c6308=[_0x4cc491['body'][_0x2f689b(0x1c6)]],_0x1e406=[_0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x147)]],_0x2e8844=[_0x4cc491[_0x2f689b(0x24c)]['prod_code']],_0x19dba5=[_0x4cc491['body']['level']],_0x564619=[_0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x225)]],_0x165df8=[_0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1fc)]],_0x3e2f5a=[_0x4cc491['body']['batch_code']],_0x54d201=[_0x4cc491['body'][_0x2f689b(0x19b)]],_0x448c97=[_0x4cc491['body'][_0x2f689b(0x214)]],_0x546952=[_0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x17c)]],_0x3458e0=[_0x4cc491[_0x2f689b(0x24c)]['requested_qty']],_0x4209ce=[_0x4cc491[_0x2f689b(0x24c)]['delivery_date']],_0x330746=[_0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1cd)]],_0xde3700=[_0x4cc491['body'][_0x2f689b(0x1b9)]],_0x33295b=[_0x4cc491[_0x2f689b(0x24c)]['quantity']],_0x45eba2=[_0x4cc491[_0x2f689b(0x24c)]['RoomAssigned']],_0x116f66=[_0x4cc491[_0x2f689b(0x24c)]['prod_invoice']],_0x484c22=[_0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1a8)]],_0x255379=[_0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x211)]],_0x567ab3=[_0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1e3)]];else var _0x2a2359=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x169)]],_0x2a53f2=[..._0x4cc491['body']['stock']],_0x5d3c09=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1d1)]],_0x2c6308=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1c6)]],_0x1e406=[..._0x4cc491['body']['secondary_code']],_0x2e8844=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x193)]],_0x19dba5=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1da)]],_0x564619=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x225)]],_0x165df8=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1fc)]],_0x3e2f5a=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1ee)]],_0x54d201=[..._0x4cc491[_0x2f689b(0x24c)]['expiry_date']],_0x448c97=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x214)]],_0x546952=[..._0x4cc491['body'][_0x2f689b(0x17c)]],_0x3458e0=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x21e)]],_0x4209ce=[..._0x4cc491[_0x2f689b(0x24c)]['delivery_date']],_0x330746=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1cd)]],_0xde3700=[..._0x4cc491['body'][_0x2f689b(0x1b9)]],_0x33295b=[..._0x4cc491['body']['quantity']],_0x45eba2=[..._0x4cc491[_0x2f689b(0x24c)]['RoomAssigned']],_0x116f66=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1ae)]],_0x484c22=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1a8)]],_0x255379=[..._0x4cc491[_0x2f689b(0x24c)]['actual_uom']],_0x567ab3=[..._0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x1e3)]];const _0x3a440f=_0x2a2359['map'](_0x26929b=>{return _0x26929b={'product_name':_0x26929b};});_0x2a53f2[_0x2f689b(0x1bb)]((_0x10f350,_0x2e4931)=>{var _0x35f610=_0x2f689b;_0x3a440f[_0x2e4931][_0x35f610(0x233)]=Math['abs'](_0x10f350);}),_0x484c22[_0x2f689b(0x1bb)]((_0x469be5,_0x5aab57)=>{var _0x36d645=_0x2f689b;_0x3a440f[_0x5aab57][_0x36d645(0x1a8)]=Math[_0x36d645(0x20c)](_0x469be5);}),_0x255379[_0x2f689b(0x1bb)]((_0x4beaa3,_0x7f8810)=>{_0x3a440f[_0x7f8810]['actual_uom']=_0x4beaa3;}),_0x567ab3['forEach']((_0x223bab,_0x385207)=>{var _0xa72445=_0x2f689b;_0x3a440f[_0x385207][_0xa72445(0x19e)]=_0x223bab;}),_0x5d3c09[_0x2f689b(0x1bb)]((_0x48e4b8,_0x1e7535)=>{var _0x5d49eb=_0x2f689b;_0x3a440f[_0x1e7535][_0x5d49eb(0x1a0)]=_0x48e4b8;}),_0x2c6308[_0x2f689b(0x1bb)]((_0x1678ed,_0x13ad77)=>{var _0x56b707=_0x2f689b;_0x3a440f[_0x13ad77][_0x56b707(0x1c6)]=_0x1678ed;}),_0x1e406[_0x2f689b(0x1bb)]((_0x387eb7,_0x24f216)=>{_0x3a440f[_0x24f216]['secondary_code']=_0x387eb7;}),_0x2e8844[_0x2f689b(0x1bb)]((_0x51d874,_0x7788c4)=>{var _0x2a9855=_0x2f689b;_0x3a440f[_0x7788c4][_0x2a9855(0x141)]=_0x51d874;}),_0x19dba5[_0x2f689b(0x1bb)]((_0x4f37fa,_0x567e69)=>{var _0x19fcee=_0x2f689b;_0x45eba2[_0x19fcee(0x1bb)]((_0x318063,_0x566cc0)=>{var _0x5e94aa=_0x19fcee;if(_0x318063==_0x5e94aa(0x1cf)&&_0x567e69==_0x566cc0){var _0x704924=_0x4f37fa[_0x5e94aa(0x1ed)](0x3);_0x3a440f[_0x567e69][_0x5e94aa(0x1c4)]=_0x4f37fa[0x0],_0x3a440f[_0x567e69][_0x5e94aa(0x142)]=_0x4f37fa[0x1],_0x3a440f[_0x567e69][_0x5e94aa(0x1ea)]=0x0,_0x3a440f[_0x567e69]['bin']=0x0,_0x3a440f[_0x567e69][_0x5e94aa(0x1af)]=_0x5e94aa(0x23b),_0x3a440f[_0x567e69][_0x5e94aa(0x171)]=_0x704924;}else{if(_0x318063=='Shelves'&&_0x567e69==_0x566cc0){var _0x704924=_0x4f37fa[_0x5e94aa(0x1ed)](0x3);_0x3a440f[_0x567e69][_0x5e94aa(0x1c4)]=_0x4f37fa[0x0],_0x3a440f[_0x567e69][_0x5e94aa(0x142)]=_0x4f37fa[0x1],_0x3a440f[_0x567e69][_0x5e94aa(0x1ea)]=0x0,_0x3a440f[_0x567e69]['bin']=0x0,_0x3a440f[_0x567e69][_0x5e94aa(0x1af)]=_0x5e94aa(0x23b),_0x3a440f[_0x567e69][_0x5e94aa(0x171)]=_0x4f37fa[0x5];}else{if(_0x567e69==_0x566cc0){var _0x5d53c1;if(_0x4f37fa[0x4]=='L')_0x5d53c1=_0x5e94aa(0x201);else _0x4f37fa[0x4]=='F'&&(_0x5d53c1='Floor');_0x3a440f[_0x567e69][_0x5e94aa(0x1c4)]=_0x4f37fa[0x0],_0x3a440f[_0x567e69][_0x5e94aa(0x142)]=_0x4f37fa[0x1],_0x3a440f[_0x567e69][_0x5e94aa(0x1ea)]=_0x4f37fa[0x2],_0x3a440f[_0x567e69][_0x5e94aa(0x1b4)]=_0x4f37fa[0x3],_0x3a440f[_0x567e69]['type']=_0x5d53c1,_0x3a440f[_0x567e69][_0x5e94aa(0x171)]=_0x4f37fa[0x5];}}}});}),_0x564619[_0x2f689b(0x1bb)]((_0x243d15,_0xb0258d)=>{var _0x290385=_0x2f689b;_0x3a440f[_0xb0258d][_0x290385(0x13d)]=_0x243d15;}),_0x165df8['forEach']((_0x4408bd,_0x13ed72)=>{var _0x31c5f4=_0x2f689b;_0x3a440f[_0x13ed72][_0x31c5f4(0x1fc)]=_0x4408bd;}),_0x3e2f5a['forEach']((_0x1f3e6f,_0x464450)=>{var _0x421f89=_0x2f689b;_0x3a440f[_0x464450][_0x421f89(0x1ee)]=_0x1f3e6f;}),_0x54d201[_0x2f689b(0x1bb)]((_0x32c9f5,_0x26ea87)=>{var _0x3543a8=_0x2f689b;_0x3a440f[_0x26ea87][_0x3543a8(0x19b)]=_0x32c9f5;}),_0x448c97['forEach']((_0x43ccdc,_0x540cd8)=>{var _0x377b26=_0x2f689b;_0x3a440f[_0x540cd8][_0x377b26(0x206)]=_0x43ccdc;}),_0x546952[_0x2f689b(0x1bb)]((_0x171c2e,_0x1de4ba)=>{var _0x445458=_0x2f689b;_0x3a440f[_0x1de4ba][_0x445458(0x17c)]=_0x171c2e;}),_0x3458e0[_0x2f689b(0x1bb)]((_0x11c9bb,_0x2d4a41)=>{var _0x3c0169=_0x2f689b;_0x3a440f[_0x2d4a41][_0x3c0169(0x21e)]=_0x11c9bb;}),_0x4209ce[_0x2f689b(0x1bb)]((_0xd343a,_0xd1514)=>{var _0x1bc302=_0x2f689b;_0x3a440f[_0xd1514][_0x1bc302(0x1ca)]=_0xd343a;}),_0x330746[_0x2f689b(0x1bb)]((_0x89ea1c,_0x14cbdf)=>{_0x3a440f[_0x14cbdf]['delivery_code']=_0x89ea1c;}),_0xde3700[_0x2f689b(0x1bb)]((_0x3349d4,_0x55e443)=>{var _0x24e429=_0x2f689b;_0x3a440f[_0x55e443][_0x24e429(0x1b9)]=_0x3349d4;}),_0x33295b[_0x2f689b(0x1bb)]((_0x40f8fd,_0x4b1b27)=>{var _0x172ad3=_0x2f689b;_0x3a440f[_0x4b1b27][_0x172ad3(0x19f)]=_0x40f8fd;}),_0x45eba2['forEach']((_0x3776cf,_0x2050f2)=>{var _0x5f41bd=_0x2f689b;_0x3a440f[_0x2050f2][_0x5f41bd(0x16e)]=_0x3776cf;}),_0x116f66[_0x2f689b(0x1bb)]((_0xdfc388,_0x3e87ea)=>{var _0x4d88c3=_0x2f689b;_0x3a440f[_0x3e87ea][_0x4d88c3(0x23f)]=_0xdfc388;});var _0x2ca966=0x0;_0x3a440f['forEach'](_0x41803a=>{var _0x5bfcf2=_0x2f689b;(_0x41803a[_0x5bfcf2(0x233)]<_0x41803a[_0x5bfcf2(0x19f)]||_0x41803a[_0x5bfcf2(0x19f)]==0x0)&&(console[_0x5bfcf2(0x1e2)](_0x5bfcf2(0x14e),_0x41803a),_0x2ca966++);});const _0x497712=_0x3a440f[_0x2f689b(0x231)](_0x150c4f=>_0x150c4f[_0x2f689b(0x1a0)]!=='0'&&_0x150c4f[_0x2f689b(0x1a0)]!==''),_0x2a3538=new sales({'invoice':_0x41c408,'customer':_0x4cc491[_0x2f689b(0x24c)][_0x2f689b(0x20a)],'date':_0x38c205,'warehouse_name':_0x43d3bf,'sale_product':_0x497712,'note':_0x12905a,'room':_0x207d6a,'primary_code':_0xc67453,'secondary_code':_0x1353ae,'prod_code':_0x5822e1,'SCRN':_0x437f3a}),_0x41c449=await _0x2a3538[_0x2f689b(0x217)]();_0x4cc491['flash'](_0x2f689b(0x1c7),'Sales\x20Add\x20successfully'),_0x1e11c7[_0x2f689b(0x1b5)](_0x2f689b(0x220)+_0x41c449['_id']);}catch(_0x526256){console[_0x2f689b(0x1e2)](_0x526256);}}),router[a0_0x20b97e(0x20f)](a0_0x20b97e(0x1db),auth,async(_0x1c059a,_0x5a6b9c)=>{var _0x534950=a0_0x20b97e;try{const {username:_0x724fdf,email:_0x1fb68b,role:_0x353acf}=_0x1c059a[_0x534950(0x1cc)],_0x341823=_0x1c059a['user'],_0x3d656c=await profile[_0x534950(0x22b)]({'email':_0x341823[_0x534950(0x21a)]}),_0x4c574b=await master_shop[_0x534950(0x23c)](),_0xc09b5c=_0x1c059a['params']['id'],_0x5c9f35=await sales[_0x534950(0x1ce)](_0xc09b5c),_0x59981e=await warehouse[_0x534950(0x1ba)]([{'$match':{'name':_0x5c9f35[_0x534950(0x1e9)]}},{'$unwind':_0x534950(0x190)},{'$group':{'_id':_0x534950(0x197),'name':{'$first':_0x534950(0x243)},'product_stock':{'$first':_0x534950(0x170)},'bay':{'$first':_0x534950(0x15a)},'bin':{'$first':_0x534950(0x195)},'type':{'$first':_0x534950(0x1d9)},'floorlevel':{'$first':_0x534950(0x187)},'primary_code':{'$first':_0x534950(0x236)},'secondary_code':{'$first':_0x534950(0x145)},'product_code':{'$first':_0x534950(0x241)},'storage':{'$first':_0x534950(0x1bd)},'rack':{'$first':_0x534950(0x1b0)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x534950(0x196)}}}]),_0x2158d0=await customer['find']({});let _0x132917;if(_0x341823[_0x534950(0x1e0)]==_0x534950(0x1ff)){const _0x31d5fa=await staff[_0x534950(0x22b)]({'email':_0x341823[_0x534950(0x21a)]});_0x132917=await warehouse[_0x534950(0x1ba)]([{'$match':{'status':_0x534950(0x199),'name':_0x31d5fa['warehouse']}},{'$group':{'_id':_0x534950(0x228),'name':{'$first':_0x534950(0x228)}}}]);}else _0x132917=await warehouse[_0x534950(0x1ba)]([{'$match':{'status':_0x534950(0x199)}},{'$group':{'_id':_0x534950(0x228),'name':{'$first':_0x534950(0x228)}}}]);const _0x46ae3c=await product[_0x534950(0x23c)]({}),_0x1327a7=await suppliers['find']({});if(_0x4c574b[0x0][_0x534950(0x221)]==_0x534950(0x1a4)){var _0x1e50bc=users[_0x534950(0x158)];console[_0x534950(0x1e2)](_0x1e50bc);}else{if(_0x4c574b[0x0][_0x534950(0x221)]==_0x534950(0x13b))var _0x1e50bc=users[_0x534950(0x13b)];else{if(_0x4c574b[0x0][_0x534950(0x221)]=='German')var _0x1e50bc=users[_0x534950(0x1a5)];else{if(_0x4c574b[0x0][_0x534950(0x221)]=='Spanish')var _0x1e50bc=users[_0x534950(0x16b)];else{if(_0x4c574b[0x0]['language']==_0x534950(0x1bf))var _0x1e50bc=users[_0x534950(0x1bf)];else{if(_0x4c574b[0x0]['language']==_0x534950(0x17e))var _0x1e50bc=users[_0x534950(0x17d)];else{if(_0x4c574b[0x0][_0x534950(0x221)]==_0x534950(0x183))var _0x1e50bc=users['Chinese'];else{if(_0x4c574b[0x0][_0x534950(0x221)]==_0x534950(0x1c5))var _0x1e50bc=users[_0x534950(0x1bc)];}}}}}}}_0x5a6b9c[_0x534950(0x22e)](_0x534950(0x1e1),{'success':_0x1c059a['flash'](_0x534950(0x1c7)),'errors':_0x1c059a[_0x534950(0x14b)]('errors'),'role':_0x341823,'profile':_0x3d656c,'customer':_0x2158d0,'warehouse':_0x132917,'product':_0x59981e,'user':_0x5c9f35,'master_shop':_0x4c574b,'unit':_0x46ae3c,'language':_0x1e50bc,'suppliers':_0x1327a7});}catch(_0x305339){console[_0x534950(0x1e2)](_0x305339);}}),router[a0_0x20b97e(0x191)](a0_0x20b97e(0x1db),auth,async(_0x49fb9a,_0x5e54e8)=>{var _0x217ca1=a0_0x20b97e;try{const _0xa71ef9=_0x49fb9a[_0x217ca1(0x1b3)]['id'],{invoice:_0x271d66,warehouse_name:_0x16ffe7,room:_0x3b03e5}=_0x49fb9a[_0x217ca1(0x24c)],_0x4f8fbe=await sales[_0x217ca1(0x22b)]({'invoice':_0x271d66}),_0x39d9d7=_0x4f8fbe[_0x217ca1(0x192)]['map'](async _0xa5db7b=>{var _0x16eb75=_0x217ca1,_0x3ce55f=await warehouse['findOne']({'name':_0x16ffe7,'room':_0xa5db7b[_0x16eb75(0x16e)],'warehouse_category':_0x16eb75(0x19a)});const _0x3728c1=_0x3ce55f['product_details'][_0x16eb75(0x165)](_0x35289c=>{var _0x5bc35e=_0x16eb75;_0x35289c['product_name']==_0xa5db7b[_0x5bc35e(0x169)]&&_0x35289c[_0x5bc35e(0x171)]==_0xa5db7b[_0x5bc35e(0x171)]&&_0x35289c[_0x5bc35e(0x1af)]==_0xa5db7b[_0x5bc35e(0x1af)]&&_0x35289c[_0x5bc35e(0x1b4)]==_0xa5db7b[_0x5bc35e(0x1b4)]&&_0x35289c[_0x5bc35e(0x1ea)]==_0xa5db7b['bay']&&_0x35289c[_0x5bc35e(0x142)]==_0xa5db7b[_0x5bc35e(0x142)]&&_0x35289c[_0x5bc35e(0x1c4)]==_0xa5db7b[_0x5bc35e(0x1c4)]&&_0x35289c[_0x5bc35e(0x19b)]==_0xa5db7b['expiry_date']&&_0x35289c[_0x5bc35e(0x1ee)]==_0xa5db7b['batch_code']&&_0x35289c[_0x5bc35e(0x13c)]==_0xa5db7b[_0x5bc35e(0x19e)]&&(_0x35289c[_0x5bc35e(0x1f3)]=Math[_0x5bc35e(0x1a6)](0x0,Math[_0x5bc35e(0x20c)](_0x35289c[_0x5bc35e(0x1f3)])-Math[_0x5bc35e(0x20c)](_0xa5db7b['quantity'])));});return _0x3ce55f;});Promise[_0x217ca1(0x1cb)](_0x39d9d7)[_0x217ca1(0x234)](async _0x307b75=>{var _0x3e9285=_0x217ca1;try{for(const _0x3a2412 of _0x307b75){await _0x3a2412[_0x3e9285(0x217)]();}_0x4f8fbe['finalize']=_0x3e9285(0x19d);const _0x3d3442=await _0x4f8fbe[_0x3e9285(0x217)](),_0x289709=await master_shop[_0x3e9285(0x23c)](),_0x54b236=await email_settings[_0x3e9285(0x22b)](),_0x4b0bd6=await supervisor_settings['find']();var _0x3ef2bb=_0x4f8fbe[_0x3e9285(0x192)],_0x5c895c='',_0x2db8ef;for(_0x2db8ef in _0x3ef2bb){_0x5c895c+='<tr>'+_0x3e9285(0x185)+_0x3ef2bb[_0x2db8ef]['product_name']+'</td>'+_0x3e9285(0x185)+_0x3ef2bb[_0x2db8ef]['product_code']+_0x3e9285(0x1e8)+_0x3e9285(0x185)+_0x3ef2bb[_0x2db8ef][_0x3e9285(0x1a0)]+_0x3e9285(0x1e8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3ef2bb[_0x2db8ef][_0x3e9285(0x13d)]+_0x3e9285(0x1e8)+_0x3e9285(0x185)+_0x3ef2bb[_0x2db8ef][_0x3e9285(0x1fc)]+_0x3e9285(0x1e8)+_0x3e9285(0x185)+_0x4f8fbe['warehouse_name']+_0x3e9285(0x1e8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3ef2bb[_0x2db8ef][_0x3e9285(0x16e)]+_0x3e9285(0x1e8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3ef2bb[_0x2db8ef][_0x3e9285(0x1c4)]+_0x3ef2bb[_0x2db8ef]['rack']+_0x3ef2bb[_0x2db8ef][_0x3e9285(0x1ea)]+_0x3ef2bb[_0x2db8ef][_0x3e9285(0x1b4)]+_0x3ef2bb[_0x2db8ef][_0x3e9285(0x1af)][0x0]+_0x3ef2bb[_0x2db8ef][_0x3e9285(0x171)]+_0x3e9285(0x1e8),_0x3e9285(0x1dc);}let _0xe9a660=nodemailer[_0x3e9285(0x1fa)]({'host':_0x54b236[_0x3e9285(0x16c)],'port':Number(_0x54b236[_0x3e9285(0x18d)]),'secure':![],'auth':{'user':_0x54b236['email'],'pass':_0x54b236[_0x3e9285(0x20d)]}}),_0x6578eb={'from':_0x54b236['email'],'to':_0x4b0bd6[0x0][_0x3e9285(0x1b6)],'subject':_0x3e9285(0x174),'attachments':[{'filename':_0x3e9285(0x1d3),'path':__dirname+_0x3e9285(0x152)+'/upload/'+_0x289709[0x0][_0x3e9285(0x1b8)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x3e9285(0x247)+_0x3e9285(0x246)+_0x3e9285(0x1eb)+_0x3e9285(0x1e6)+_0x3e9285(0x1eb)+_0x3e9285(0x1b2)+_0x3e9285(0x224)+'<div>'+'<h2>\x20'+_0x289709[0x0]['site_title']+'\x20</h2>'+_0x3e9285(0x224)+'</div>'+_0x3e9285(0x17b)+_0x3e9285(0x1eb)+_0x3e9285(0x208)+_0x3e9285(0x16f)+_0x4f8fbe[_0x3e9285(0x23f)]+'\x20'+_0x3e9285(0x1d7)+_0x3e9285(0x21c)+_0x4f8fbe['date']+'\x20'+'</span>'+_0x3e9285(0x1f2)+_0x3e9285(0x224)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3e9285(0x161)+_0x3e9285(0x15f)+_0x3e9285(0x188)+_0x3e9285(0x1df)+_0x3e9285(0x178)+_0x3e9285(0x1e5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x3e9285(0x223)+_0x3e9285(0x1d4)+_0x3e9285(0x20e)+_0x3e9285(0x1dc)+_0x3e9285(0x1b1)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5c895c+'\x20'+_0x3e9285(0x164)+_0x3e9285(0x168)+_0x3e9285(0x1eb)+'<strong>\x20Regards\x20</strong>'+_0x3e9285(0x213)+_0x289709[0x0]['site_title']+'</h5>'+_0x3e9285(0x224)+_0x3e9285(0x224)+_0x3e9285(0x22c)};_0xe9a660[_0x3e9285(0x1d6)](_0x6578eb,function(_0x17ab95,_0x324409){var _0x7a014e=_0x3e9285;_0x17ab95?(console[_0x7a014e(0x1e2)](_0x17ab95),console['log'](_0x7a014e(0x22f))):console[_0x7a014e(0x1e2)]('Email\x20sent\x20successfully');}),_0x49fb9a['flash'](_0x3e9285(0x1c7),'Sales\x20Update\x20successfully'),_0x5e54e8[_0x3e9285(0x1b5)](_0x3e9285(0x220)+_0xa71ef9);}catch(_0x3c4f61){console[_0x3e9285(0x163)](_0x3c4f61),_0x5e54e8['status'](0x1f4)[_0x3e9285(0x1f6)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x217ca1(0x1e7)](_0x40536a=>{var _0x5e103c=_0x217ca1;console[_0x5e103c(0x163)](_0x40536a),_0x5e54e8[_0x5e103c(0x238)](0x1f4)[_0x5e103c(0x1f6)]({'error':_0x5e103c(0x1c9)});});}catch(_0x5a493c){console[_0x217ca1(0x1e2)](_0x5a493c);}}),router[a0_0x20b97e(0x20f)]('/view/:id',auth,async(_0x3d7439,_0x138c40)=>{var _0x5dbbf5=a0_0x20b97e;try{const {username:_0x3e8802,email:_0x26e286,role:_0x301085}=_0x3d7439[_0x5dbbf5(0x1cc)],_0x22143a=_0x3d7439[_0x5dbbf5(0x1cc)],_0x363d3c=await profile[_0x5dbbf5(0x22b)]({'email':_0x22143a[_0x5dbbf5(0x21a)]}),_0x11ade5=await master_shop['find'](),_0x4ba5ba=_0x3d7439[_0x5dbbf5(0x1b3)]['id'],_0x1794b4=await sales[_0x5dbbf5(0x1ce)](_0x4ba5ba);var _0x247ab0=[_0x5dbbf5(0x218),_0x5dbbf5(0x18a)];const _0x2a2017=await warehouse[_0x5dbbf5(0x1ba)]([{'$match':{'name':_0x1794b4['warehouse_name'],'warehouse_category':_0x5dbbf5(0x19a)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5dbbf5(0x243)},'product_stock':{'$first':_0x5dbbf5(0x170)},'bay':{'$first':_0x5dbbf5(0x15a)},'bin':{'$first':_0x5dbbf5(0x195)},'type':{'$first':_0x5dbbf5(0x1d9)},'floorlevel':{'$first':_0x5dbbf5(0x187)},'primary_code':{'$first':_0x5dbbf5(0x236)},'secondary_code':{'$first':_0x5dbbf5(0x145)},'product_code':{'$first':_0x5dbbf5(0x241)},'storage':{'$first':_0x5dbbf5(0x1bd)},'rack':{'$first':_0x5dbbf5(0x1b0)}}}]),_0x4ec668=await customer[_0x5dbbf5(0x23c)]({});let _0x17c335;if(_0x22143a['role']==_0x5dbbf5(0x1ff)){const _0x2df61f=await staff[_0x5dbbf5(0x22b)]({'email':_0x22143a[_0x5dbbf5(0x21a)]});_0x17c335=await warehouse[_0x5dbbf5(0x1ba)]([{'$match':{'status':'Enabled','name':_0x2df61f[_0x5dbbf5(0x177)],'warehouse_category':_0x5dbbf5(0x19a)}},{'$group':{'_id':_0x5dbbf5(0x228),'name':{'$first':_0x5dbbf5(0x228)}}}]);}else _0x17c335=await warehouse[_0x5dbbf5(0x1ba)]([{'$match':{'status':_0x5dbbf5(0x199),'warehouse_category':_0x5dbbf5(0x19a)}},{'$group':{'_id':'$name','name':{'$first':_0x5dbbf5(0x228)}}}]);const _0x4a4aa6=await product[_0x5dbbf5(0x23c)]({});if(_0x11ade5[0x0][_0x5dbbf5(0x221)]=='English\x20(US)'){var _0x4c8cb1=users[_0x5dbbf5(0x158)];console[_0x5dbbf5(0x1e2)](_0x4c8cb1);}else{if(_0x11ade5[0x0]['language']==_0x5dbbf5(0x13b))var _0x4c8cb1=users[_0x5dbbf5(0x13b)];else{if(_0x11ade5[0x0]['language']==_0x5dbbf5(0x1a5))var _0x4c8cb1=users[_0x5dbbf5(0x1a5)];else{if(_0x11ade5[0x0][_0x5dbbf5(0x221)]==_0x5dbbf5(0x16b))var _0x4c8cb1=users[_0x5dbbf5(0x16b)];else{if(_0x11ade5[0x0][_0x5dbbf5(0x221)]==_0x5dbbf5(0x1bf))var _0x4c8cb1=users['French'];else{if(_0x11ade5[0x0][_0x5dbbf5(0x221)]==_0x5dbbf5(0x17e))var _0x4c8cb1=users[_0x5dbbf5(0x17d)];else{if(_0x11ade5[0x0][_0x5dbbf5(0x221)]==_0x5dbbf5(0x183))var _0x4c8cb1=users['Chinese'];else{if(_0x11ade5[0x0]['language']=='Arabic\x20(ae)')var _0x4c8cb1=users[_0x5dbbf5(0x1bc)];}}}}}}}_0x138c40[_0x5dbbf5(0x22e)](_0x5dbbf5(0x1ef),{'success':_0x3d7439[_0x5dbbf5(0x14b)](_0x5dbbf5(0x1c7)),'errors':_0x3d7439[_0x5dbbf5(0x14b)](_0x5dbbf5(0x182)),'role':_0x22143a,'profile':_0x363d3c,'customer':_0x4ec668,'warehouse':_0x17c335,'product':_0x2a2017,'user':_0x1794b4,'master_shop':_0x11ade5,'unit':_0x4a4aa6,'language':_0x4c8cb1});}catch(_0x1fa152){console[_0x5dbbf5(0x1e2)](_0x1fa152);}}),router[a0_0x20b97e(0x191)](a0_0x20b97e(0x219),auth,async(_0x3db848,_0x16680a)=>{var _0x34488e=a0_0x20b97e;try{const _0x48c3a8=_0x3db848[_0x34488e(0x1b3)]['id'],_0x47fa77=await sales[_0x34488e(0x22b)]({'_id':_0x3db848[_0x34488e(0x1b3)]['id']}),_0x5b56ff=await warehouse[_0x34488e(0x22b)]({'name':_0x47fa77[_0x34488e(0x1e9)],'room':_0x3db848['body'][_0x34488e(0x1c0)]}),{invoice:_0x262702,date:_0x53b47e,warehouse_name:_0x198c58,product_name:_0x1871c7,stock:_0x10e89e,quantity:_0x58624c,note:_0x4c5e59,room:_0x703c23,customer:_0x2e0ea7,SCRN:_0x34440a}=_0x3db848[_0x34488e(0x24c)];if(typeof _0x1871c7==_0x34488e(0x18f))var _0x15d8c8=[_0x3db848[_0x34488e(0x24c)][_0x34488e(0x169)]],_0x2709ef=[_0x3db848['body'][_0x34488e(0x233)]],_0x4c96e1=[_0x3db848[_0x34488e(0x24c)]['carton']],_0x4c1f38=[_0x3db848['body'][_0x34488e(0x1c6)]],_0x152f4b=[_0x3db848[_0x34488e(0x24c)][_0x34488e(0x147)]],_0x367134=[_0x3db848[_0x34488e(0x24c)]['prod_code']],_0xa945c9=[_0x3db848['body'][_0x34488e(0x1da)]],_0x4650a0=[_0x3db848['body'][_0x34488e(0x225)]],_0x26bacf=[_0x3db848[_0x34488e(0x24c)][_0x34488e(0x1fc)]],_0x2c7ed0=[_0x3db848[_0x34488e(0x24c)][_0x34488e(0x1ee)]],_0x137904=[_0x3db848[_0x34488e(0x24c)][_0x34488e(0x19b)]],_0x5bfc7b=[_0x3db848['body'][_0x34488e(0x214)]],_0x51e7b6=[_0x3db848[_0x34488e(0x24c)][_0x34488e(0x17c)]],_0x37a95a=[_0x3db848[_0x34488e(0x24c)][_0x34488e(0x21e)]],_0x16e75b=[_0x3db848[_0x34488e(0x24c)][_0x34488e(0x1ca)]],_0x66c054=[_0x3db848['body']['delivery_code']],_0x39f99e=[_0x3db848['body']['prod_cat']],_0x5cf2fb=[_0x3db848['body'][_0x34488e(0x1a0)]],_0x23efd7=[_0x3db848[_0x34488e(0x24c)][_0x34488e(0x180)]];else var _0x15d8c8=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x169)]],_0x2709ef=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x233)]],_0x4c96e1=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x1d1)]],_0x4c1f38=[..._0x3db848[_0x34488e(0x24c)]['primary_code']],_0x152f4b=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x147)]],_0x367134=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x193)]],_0xa945c9=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x1da)]],_0x4650a0=[..._0x3db848['body'][_0x34488e(0x225)]],_0x26bacf=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x1fc)]],_0x2c7ed0=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x1ee)]],_0x137904=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x19b)]],_0x5bfc7b=[..._0x3db848[_0x34488e(0x24c)]['max_per_unit']],_0x51e7b6=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x17c)]],_0x37a95a=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x21e)]],_0x16e75b=[..._0x3db848['body']['delivery_date']],_0x66c054=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x1cd)]],_0x39f99e=[..._0x3db848[_0x34488e(0x24c)][_0x34488e(0x1b9)]],_0x5cf2fb=[..._0x3db848[_0x34488e(0x24c)]['quantity']],_0x23efd7=[..._0x3db848[_0x34488e(0x24c)]['RoomAssigned']];const _0x4d74cb=_0x15d8c8[_0x34488e(0x165)](_0x3f6838=>{return _0x3f6838={'product_name':_0x3f6838};});_0x2709ef[_0x34488e(0x1bb)]((_0x4c356c,_0x23b143)=>{var _0x46586e=_0x34488e;_0x4d74cb[_0x23b143]['stock']=Math[_0x46586e(0x20c)](_0x4c356c);}),_0x4c96e1[_0x34488e(0x1bb)]((_0x27ed2a,_0x3ee7e2)=>{var _0x30c505=_0x34488e;_0x4d74cb[_0x3ee7e2][_0x30c505(0x1a0)]=_0x27ed2a;}),_0x4c1f38[_0x34488e(0x1bb)]((_0x4ad3c3,_0x35c64b)=>{var _0x2f2d60=_0x34488e;_0x4d74cb[_0x35c64b][_0x2f2d60(0x1c6)]=_0x4ad3c3;}),_0x152f4b[_0x34488e(0x1bb)]((_0x1b2656,_0x1bd4fe)=>{_0x4d74cb[_0x1bd4fe]['secondary_code']=_0x1b2656;}),_0x367134[_0x34488e(0x1bb)]((_0x15f71f,_0x8f48fc)=>{var _0x519be2=_0x34488e;_0x4d74cb[_0x8f48fc][_0x519be2(0x141)]=_0x15f71f;}),_0xa945c9[_0x34488e(0x1bb)]((_0x97318,_0x517aa5)=>{var _0x4d07cb=_0x34488e;_0x23efd7[_0x4d07cb(0x1bb)]((_0x457a17,_0x3ab2dd)=>{var _0x797bc8=_0x4d07cb;if(_0x457a17==_0x797bc8(0x1cf)&&_0x517aa5==_0x3ab2dd){var _0x55a935=_0x97318[_0x797bc8(0x1ed)](0x3);_0x4d74cb[_0x517aa5][_0x797bc8(0x1c4)]=_0x97318[0x0],_0x4d74cb[_0x517aa5]['rack']=_0x97318[0x1],_0x4d74cb[_0x517aa5]['bay']=0x0,_0x4d74cb[_0x517aa5][_0x797bc8(0x1b4)]=0x0,_0x4d74cb[_0x517aa5][_0x797bc8(0x1af)]=_0x797bc8(0x23b),_0x4d74cb[_0x517aa5][_0x797bc8(0x171)]=_0x55a935;}else{if(_0x457a17==_0x797bc8(0x172)&&_0x517aa5==_0x3ab2dd){var _0x55a935=_0x97318[_0x797bc8(0x1ed)](0x3);_0x4d74cb[_0x517aa5]['storage']=_0x97318[0x0],_0x4d74cb[_0x517aa5][_0x797bc8(0x142)]=_0x97318[0x1],_0x4d74cb[_0x517aa5][_0x797bc8(0x1ea)]=0x0,_0x4d74cb[_0x517aa5][_0x797bc8(0x1b4)]=0x0,_0x4d74cb[_0x517aa5]['type']='Floor',_0x4d74cb[_0x517aa5][_0x797bc8(0x171)]=_0x97318[0x5];}else{if(_0x517aa5==_0x3ab2dd){var _0x295d64;if(_0x97318[0x4]=='L')_0x295d64='Level';else _0x97318[0x4]=='F'&&(_0x295d64='Floor');_0x4d74cb[_0x517aa5][_0x797bc8(0x1c4)]=_0x97318[0x0],_0x4d74cb[_0x517aa5][_0x797bc8(0x142)]=_0x97318[0x1],_0x4d74cb[_0x517aa5][_0x797bc8(0x1ea)]=_0x97318[0x2],_0x4d74cb[_0x517aa5][_0x797bc8(0x1b4)]=_0x97318[0x3],_0x4d74cb[_0x517aa5][_0x797bc8(0x1af)]=_0x295d64,_0x4d74cb[_0x517aa5][_0x797bc8(0x171)]=_0x97318[0x5];}}}});}),_0x4650a0['forEach']((_0x2a0b3f,_0x3e32ee)=>{var _0x4d6a1f=_0x34488e;_0x4d74cb[_0x3e32ee][_0x4d6a1f(0x13d)]=_0x2a0b3f;}),_0x26bacf['forEach']((_0x3ca9c8,_0xd529b7)=>{_0x4d74cb[_0xd529b7]['secondary_unit']=_0x3ca9c8;}),_0x2c7ed0[_0x34488e(0x1bb)]((_0x478f41,_0x4f5816)=>{var _0x5abe3b=_0x34488e;_0x4d74cb[_0x4f5816][_0x5abe3b(0x1ee)]=_0x478f41;}),_0x137904[_0x34488e(0x1bb)]((_0x239658,_0x779019)=>{var _0x3757bc=_0x34488e;_0x4d74cb[_0x779019][_0x3757bc(0x19b)]=_0x239658;}),_0x5bfc7b['forEach']((_0x357944,_0x383507)=>{var _0x3ac1c5=_0x34488e;_0x4d74cb[_0x383507][_0x3ac1c5(0x206)]=_0x357944;}),_0x51e7b6[_0x34488e(0x1bb)]((_0x4dfe77,_0x29dc21)=>{var _0x3af990=_0x34488e;_0x4d74cb[_0x29dc21][_0x3af990(0x17c)]=_0x4dfe77;}),_0x37a95a['forEach']((_0x1f918c,_0x15c90e)=>{var _0x40213d=_0x34488e;_0x4d74cb[_0x15c90e][_0x40213d(0x21e)]=Math[_0x40213d(0x20c)](_0x1f918c);}),_0x16e75b['forEach']((_0x1c7244,_0x39e9d9)=>{var _0x39f33b=_0x34488e;_0x4d74cb[_0x39e9d9][_0x39f33b(0x1ca)]=_0x1c7244;}),_0x66c054['forEach']((_0x207744,_0xf392ac)=>{var _0x379b54=_0x34488e;_0x4d74cb[_0xf392ac][_0x379b54(0x1cd)]=_0x207744;}),_0x39f99e[_0x34488e(0x1bb)]((_0x597ca8,_0x429949)=>{var _0xa1d948=_0x34488e;_0x4d74cb[_0x429949][_0xa1d948(0x1b9)]=_0x597ca8;}),_0x5cf2fb['forEach']((_0x13228f,_0x2e0f3b)=>{var _0x229c02=_0x34488e;_0x4d74cb[_0x2e0f3b][_0x229c02(0x19f)]=_0x13228f;}),_0x23efd7[_0x34488e(0x1bb)]((_0x140ecc,_0x22ae03)=>{var _0x26b996=_0x34488e;_0x4d74cb[_0x22ae03][_0x26b996(0x16e)]=_0x140ecc;});var _0x2a8af3=0x0;_0x4d74cb[_0x34488e(0x1bb)](_0x41edbe=>{var _0x515f1e=_0x34488e;console[_0x515f1e(0x1e2)](_0x515f1e(0x14e),_0x41edbe),(parseInt(_0x41edbe[_0x515f1e(0x233)])<parseInt(_0x41edbe['quantity'])||parseInt(_0x41edbe[_0x515f1e(0x1a0)])==0x0)&&_0x2a8af3++;});if(_0x2a8af3!=0x0)return _0x3db848[_0x34488e(0x14b)]('errors',_0x34488e(0x1b7)),_0x16680a[_0x34488e(0x1b5)](_0x34488e(0x24e));const _0x23b808=_0x4d74cb[_0x34488e(0x231)](_0x389b73=>_0x389b73['quantity']!=='0'&&_0x389b73[_0x34488e(0x1a0)]!=='');_0x47fa77[_0x34488e(0x23f)]=_0x262702,_0x47fa77[_0x34488e(0x20a)]=_0x2e0ea7,_0x47fa77[_0x34488e(0x207)]=_0x53b47e,_0x47fa77[_0x34488e(0x1e9)]=_0x198c58,_0x47fa77[_0x34488e(0x192)]=_0x23b808,_0x47fa77[_0x34488e(0x15e)]=_0x4c5e59,_0x47fa77[_0x34488e(0x16d)]=_0x34440a,_0x47fa77[_0x34488e(0x249)]=_0x34488e(0x14c),_0x47fa77['isAllowEdit']=_0x34488e(0x14c);const _0x46ae86=await _0x47fa77[_0x34488e(0x217)]();_0x3db848[_0x34488e(0x14b)]('success',_0x34488e(0x203)),_0x16680a[_0x34488e(0x1b5)]('/all_sales/view');}catch(_0x2d5051){console[_0x34488e(0x1e2)](_0x2d5051);}}),router[a0_0x20b97e(0x191)](a0_0x20b97e(0x1f9),auth,async(_0x4aced0,_0x267a51)=>{var _0x19dff0=a0_0x20b97e;try{const _0x592c75=_0x4aced0[_0x19dff0(0x1b3)]['id'],{invoice:_0xda053,customer:_0x15592b,receivable_amount:_0x13c369,received_amount:_0x4bc93c}=_0x4aced0[_0x19dff0(0x24c)],_0x127b6a=await sales[_0x19dff0(0x1ce)](_0x592c75);console[_0x19dff0(0x1e2)](_0x127b6a);var _0x5d0628=_0x13c369-_0x4bc93c;console['log'](_0x4bc93c),_0x127b6a[_0x19dff0(0x167)]=parseFloat(_0x4bc93c)+parseFloat(_0x127b6a[_0x19dff0(0x167)]),_0x127b6a[_0x19dff0(0x1f8)]=_0x5d0628,console[_0x19dff0(0x1e2)](_0x127b6a);const _0x4602dc=await _0x127b6a[_0x19dff0(0x217)](),_0x2141cc=await c_payment_data[_0x19dff0(0x22b)]({'invoice':_0xda053});_0x2141cc[_0x19dff0(0x1f7)]=_0x5d0628,await _0x2141cc[_0x19dff0(0x217)]();let _0x251c78=new Date(),_0x44ebfc=('0'+_0x251c78['getDate']())[_0x19dff0(0x1ed)](-0x2),_0x6062af=('0'+(_0x251c78[_0x19dff0(0x1f0)]()+0x1))[_0x19dff0(0x1ed)](-0x2),_0x3524be=_0x251c78['getFullYear'](),_0x106a1e=_0x3524be+'-'+_0x6062af+'-'+_0x44ebfc;const _0x2fdd00=new customer_payment({'invoice':_0xda053,'date':_0x3524be+'-'+_0x6062af+'-'+_0x44ebfc,'customer':_0x15592b,'reason':_0x19dff0(0x14f),'amount':_0x4bc93c}),_0xc32b8a=await _0x2fdd00[_0x19dff0(0x217)]();_0x4aced0[_0x19dff0(0x14b)](_0x19dff0(0x1c7),'payment\x20successfull'),_0x267a51[_0x19dff0(0x1b5)](_0x19dff0(0x200));}catch(_0x2ec74e){console[_0x19dff0(0x1e2)](_0x2ec74e);}}),router[a0_0x20b97e(0x20f)](a0_0x20b97e(0x15b),auth,async(_0x3817ea,_0x5271d4)=>{var _0x2e78e3=a0_0x20b97e;try{const {username:_0x12dc57,email:_0x232b37,role:_0x48a786}=_0x3817ea[_0x2e78e3(0x1cc)],_0x5c316c=_0x3817ea[_0x2e78e3(0x1cc)],_0x1eaf8d=await profile[_0x2e78e3(0x22b)]({'email':_0x5c316c[_0x2e78e3(0x21a)]}),_0x54bc2d=await master_shop[_0x2e78e3(0x23c)]();console[_0x2e78e3(0x1e2)]('master',_0x54bc2d);const _0x2831f3=_0x3817ea[_0x2e78e3(0x1b3)]['id'],_0x2f2292=await sales[_0x2e78e3(0x1ce)](_0x2831f3);console[_0x2e78e3(0x1e2)](_0x2f2292);const _0x4ea9f3=await customer[_0x2e78e3(0x22b)]({'name':_0x2f2292[_0x2e78e3(0x20a)]});console[_0x2e78e3(0x1e2)](_0x4ea9f3);if(_0x54bc2d[0x0][_0x2e78e3(0x221)]==_0x2e78e3(0x1a4)){var _0x1dc9dd=users[_0x2e78e3(0x158)];console['log'](_0x1dc9dd);}else{if(_0x54bc2d[0x0]['language']==_0x2e78e3(0x13b))var _0x1dc9dd=users['Hindi'];else{if(_0x54bc2d[0x0][_0x2e78e3(0x221)]=='German')var _0x1dc9dd=users[_0x2e78e3(0x1a5)];else{if(_0x54bc2d[0x0]['language']==_0x2e78e3(0x16b))var _0x1dc9dd=users['Spanish'];else{if(_0x54bc2d[0x0][_0x2e78e3(0x221)]=='French')var _0x1dc9dd=users['French'];else{if(_0x54bc2d[0x0][_0x2e78e3(0x221)]==_0x2e78e3(0x17e))var _0x1dc9dd=users['Portuguese'];else{if(_0x54bc2d[0x0][_0x2e78e3(0x221)]==_0x2e78e3(0x183))var _0x1dc9dd=users[_0x2e78e3(0x183)];else{if(_0x54bc2d[0x0][_0x2e78e3(0x221)]==_0x2e78e3(0x1c5))var _0x1dc9dd=users[_0x2e78e3(0x1bc)];}}}}}}}_0x5271d4[_0x2e78e3(0x22e)]('sales_invoice',{'success':_0x3817ea[_0x2e78e3(0x14b)](_0x2e78e3(0x1c7)),'errors':_0x3817ea[_0x2e78e3(0x14b)]('errors'),'role':_0x5c316c,'profile':_0x1eaf8d,'master_shop':_0x54bc2d,'customers':_0x4ea9f3,'sales':_0x2f2292,'language':_0x1dc9dd});}catch(_0x2b47a3){console[_0x2e78e3(0x1e2)](_0x2b47a3);}}),router[a0_0x20b97e(0x20f)](a0_0x20b97e(0x232),auth,async(_0x16092f,_0x15576d)=>{var _0x131bed=a0_0x20b97e;try{const {username:_0x9e36b2,email:_0x100eb0,role:_0xca3cde}=_0x16092f['user'],_0x241890=_0x16092f[_0x131bed(0x1cc)],_0xe0302f=await profile[_0x131bed(0x22b)]({'email':_0x241890[_0x131bed(0x21a)]}),_0x216c52=await master_shop['find']();console[_0x131bed(0x1e2)]('master',_0x216c52);const _0x5c3f0d=_0x16092f[_0x131bed(0x1b3)]['id'];console['log'](_0x5c3f0d);const _0x2c0b63=await sales[_0x131bed(0x1ce)](_0x5c3f0d);console['log'](_0x131bed(0x144),_0x2c0b63);const _0x197d4b=await warehouse[_0x131bed(0x1ba)]([{'$match':{'name':_0x131bed(0x181),'room':_0x131bed(0x1a9)}},{'$unwind':_0x131bed(0x190)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x131bed(0x243)},'product_stock':{'$first':_0x131bed(0x170)},'level':{'$first':_0x131bed(0x1c8)},'isle':{'$first':_0x131bed(0x1ab)},'pallet':{'$first':_0x131bed(0x151)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x131bed(0x145)},'product_code':{'$first':_0x131bed(0x241)}}}]);console['log'](_0x131bed(0x1fb),_0x197d4b);const _0x3e69b8=await product['find']({});warehouse_data=await warehouse[_0x131bed(0x1ba)]([{'$match':{'status':'Enabled','name':_0x131bed(0x181),'warehouse_category':_0x131bed(0x19a)}},{'$group':{'_id':_0x131bed(0x228),'name':{'$first':_0x131bed(0x228)}}},{'$sort':{'name':0x1}}]);var _0x44e9e9=[_0x131bed(0x1a9)];if(_0x216c52[0x0]['language']==_0x131bed(0x1a4)){var _0x2cd84d=users[_0x131bed(0x158)];console[_0x131bed(0x1e2)](_0x2cd84d);}else{if(_0x216c52[0x0][_0x131bed(0x221)]=='Hindi')var _0x2cd84d=users[_0x131bed(0x13b)];else{if(_0x216c52[0x0]['language']=='German')var _0x2cd84d=users[_0x131bed(0x1a5)];else{if(_0x216c52[0x0][_0x131bed(0x221)]=='Spanish')var _0x2cd84d=users[_0x131bed(0x16b)];else{if(_0x216c52[0x0][_0x131bed(0x221)]==_0x131bed(0x1bf))var _0x2cd84d=users[_0x131bed(0x1bf)];else{if(_0x216c52[0x0][_0x131bed(0x221)]==_0x131bed(0x17e))var _0x2cd84d=users[_0x131bed(0x17d)];else{if(_0x216c52[0x0][_0x131bed(0x221)]==_0x131bed(0x183))var _0x2cd84d=users['Chinese'];else{if(_0x216c52[0x0]['language']==_0x131bed(0x1c5))var _0x2cd84d=users[_0x131bed(0x1bc)];}}}}}}}_0x15576d[_0x131bed(0x22e)]('return_sale',{'success':_0x16092f[_0x131bed(0x14b)](_0x131bed(0x1c7)),'errors':_0x16092f[_0x131bed(0x14b)](_0x131bed(0x182)),'role':_0x241890,'profile':_0xe0302f,'user':_0x2c0b63,'stock':_0x197d4b,'master_shop':_0x216c52,'unit':_0x3e69b8,'language':_0x2cd84d,'warehouses':warehouse_data,'rooms':_0x44e9e9});}catch(_0x1073d1){console[_0x131bed(0x1e2)](_0x1073d1),_0x15576d[_0x131bed(0x238)](0xc8)[_0x131bed(0x1f6)]({'message':_0x1073d1[_0x131bed(0x1f5)]});}}),router[a0_0x20b97e(0x191)](a0_0x20b97e(0x232),auth,async(_0x311fd1,_0x5ccaab)=>{var _0x56b5cf=a0_0x20b97e;try{const {invoice:_0xdc17eb,date:_0x36e5da,warehouse_name:_0x4e4fad,product_name:_0x54979b,primary_code:_0x2d2153,secondary_code:_0x25dc69,product_code:_0x249a98,sales_quantity:_0xd21ee7,stocks:_0x1aeebe,return_qty:_0x1c9843,Room_name:_0xd9cd,to_warehouse_name:_0x44c6ae,to_Roomname:_0x3cebff,to_Room_name:_0xa8c5a,note:_0x209897,level:_0x559619,isle:_0xd07004,pallet:_0x2af7e0}=_0x311fd1[_0x56b5cf(0x24c)];if(typeof _0x54979b==_0x56b5cf(0x18f))var _0x32556e=[_0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x169)]],_0x2a9477=[_0x311fd1['body']['primary_code']],_0x1e696c=[_0x311fd1[_0x56b5cf(0x24c)]['secondary_code']],_0x3bda3a=[_0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x141)]],_0x30d6a0=[_0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x18c)]],_0x1533f4=[_0x311fd1['body']['stocks']],_0x4df6f1=[_0x311fd1[_0x56b5cf(0x24c)]['return_qty']],_0x4599ca=[_0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x1ea)]],_0x3e6ede=[_0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x1b4)]],_0x5bc37c=[_0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x156)]],_0x147c5d=[_0x311fd1[_0x56b5cf(0x24c)]['floorlevel']];else var _0x32556e=[..._0x311fd1['body'][_0x56b5cf(0x169)]],_0x2a9477=[..._0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x1c6)]],_0x1e696c=[..._0x311fd1['body'][_0x56b5cf(0x147)]],_0x3bda3a=[..._0x311fd1['body'][_0x56b5cf(0x141)]],_0x30d6a0=[..._0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x18c)]],_0x1533f4=[..._0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x1a3)]],_0x4df6f1=[..._0x311fd1[_0x56b5cf(0x24c)]['return_qty']],_0x4599ca=[..._0x311fd1['body'][_0x56b5cf(0x1ea)]],_0x3e6ede=[..._0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x1b4)]],_0x5bc37c=[..._0x311fd1[_0x56b5cf(0x24c)]['types']],_0x147c5d=[..._0x311fd1['body'][_0x56b5cf(0x171)]];const _0xa83cc0=_0x32556e[_0x56b5cf(0x165)](_0x238734=>{return _0x238734={'product_name':_0x238734};});_0x2a9477[_0x56b5cf(0x1bb)]((_0x64574d,_0x432416)=>{var _0x162b08=_0x56b5cf;_0xa83cc0[_0x432416][_0x162b08(0x1c6)]=_0x64574d;}),_0x1e696c[_0x56b5cf(0x1bb)]((_0x4ff090,_0xf12719)=>{var _0x4fb34c=_0x56b5cf;_0xa83cc0[_0xf12719][_0x4fb34c(0x147)]=_0x4ff090;}),_0x3bda3a[_0x56b5cf(0x1bb)]((_0x4cf040,_0x1645e7)=>{var _0x437631=_0x56b5cf;_0xa83cc0[_0x1645e7][_0x437631(0x141)]=_0x4cf040;}),_0x30d6a0[_0x56b5cf(0x1bb)]((_0x16d072,_0x5b7ff1)=>{var _0x14231e=_0x56b5cf;_0xa83cc0[_0x5b7ff1][_0x14231e(0x1d8)]=_0x16d072;}),_0x1533f4[_0x56b5cf(0x1bb)]((_0x3c7123,_0x5f487e)=>{var _0x202f3e=_0x56b5cf;_0xa83cc0[_0x5f487e][_0x202f3e(0x233)]=_0x3c7123;}),_0x4df6f1['forEach']((_0x267696,_0xd551d1)=>{var _0x5a2905=_0x56b5cf;_0xa83cc0[_0xd551d1][_0x5a2905(0x1d2)]=_0x267696;}),_0x4599ca[_0x56b5cf(0x1bb)]((_0x177822,_0x586822)=>{var _0xb5e1eb=_0x56b5cf;_0xa83cc0[_0x586822][_0xb5e1eb(0x1ea)]=_0x177822;}),_0x3e6ede[_0x56b5cf(0x1bb)]((_0xe25ff1,_0x5026ce)=>{var _0x2480a9=_0x56b5cf;_0xa83cc0[_0x5026ce][_0x2480a9(0x1b4)]=_0xe25ff1;}),_0x5bc37c[_0x56b5cf(0x1bb)]((_0x46a673,_0x4bc08a)=>{var _0x40198d=_0x56b5cf;_0xa83cc0[_0x4bc08a][_0x40198d(0x1af)]=_0x46a673;}),_0x147c5d['forEach']((_0x17b31f,_0x5ecf0c)=>{var _0x315a91=_0x56b5cf;_0xa83cc0[_0x5ecf0c][_0x315a91(0x171)]=_0x17b31f;});var _0x5d226e=0x0;_0xa83cc0[_0x56b5cf(0x1bb)](_0x3707a4=>{var _0x3e0e28=_0x56b5cf;console[_0x3e0e28(0x1e2)](_0x3e0e28(0x14e),_0x3707a4),(parseInt(_0x3707a4['sale_qty'])<parseInt(_0x3707a4[_0x3e0e28(0x1d2)])||parseInt(_0x3707a4[_0x3e0e28(0x233)])<parseInt(_0x3707a4[_0x3e0e28(0x1d2)])&&parseInt(_0x3707a4['sale_qty'])>parseInt(_0x3707a4['return_qty'])||parseInt(_0x3707a4[_0x3e0e28(0x1d2)])==0x0)&&_0x5d226e++;});if(_0x5d226e!=0x0)return _0x311fd1[_0x56b5cf(0x14b)](_0x56b5cf(0x182),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x5ccaab[_0x56b5cf(0x1b5)]('back');const _0x4cbe83=await sales[_0x56b5cf(0x22b)]({'invoice':_0xdc17eb});console[_0x56b5cf(0x1e2)](_0x4cbe83),_0x4cbe83[_0x56b5cf(0x1e4)]=_0x56b5cf(0x19d);const _0x2c6e0c=await _0x4cbe83['save'](),_0x282aea=new sales_return({'invoice':_0xdc17eb,'customer':_0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x20a)],'date':_0x36e5da,'warehouse_name':_0x4e4fad,'room':_0xd9cd,'ToWarehouse':_0x44c6ae,'ToRoom':_0xa8c5a,'return_sale':_0xa83cc0,'note':_0x209897}),_0x37de9c=await _0x282aea[_0x56b5cf(0x217)]();console['log'](_0x282aea);const _0x2ae018=await sales_return['findOne']({'invoice':_0xdc17eb}),_0x568f5a=await warehouse[_0x56b5cf(0x22b)]({'name':_0x44c6ae,'room':_0xa8c5a});_0x2ae018[_0x56b5cf(0x242)]['forEach'](_0x4a23ed=>{var _0x507299=_0x56b5cf,_0x238b81=0x0;const _0x2db187=_0x568f5a[_0x507299(0x1de)][_0x507299(0x165)](_0x506119=>{var _0x39c9e4=_0x507299;_0x506119['product_name']==_0x4a23ed['product_name']&&_0x506119[_0x39c9e4(0x171)]==_0x4a23ed[_0x39c9e4(0x171)]&&_0x506119[_0x39c9e4(0x1af)]==_0x4a23ed[_0x39c9e4(0x1af)]&&_0x506119[_0x39c9e4(0x1b4)]==_0x4a23ed[_0x39c9e4(0x1b4)]&&_0x506119[_0x39c9e4(0x1ea)]==_0x4a23ed[_0x39c9e4(0x1ea)]&&(_0x506119['product_stock']=parseInt(_0x506119['product_stock'])+parseInt(_0x4a23ed[_0x39c9e4(0x1d2)]),_0x238b81++);});_0x238b81=='0'&&(_0x568f5a[_0x507299(0x1de)]=_0x568f5a['product_details'][_0x507299(0x13f)]({'product_name':_0x4a23ed[_0x507299(0x169)],'product_stock':_0x4a23ed['return_qty'],'primary_code':_0x4a23ed[_0x507299(0x1c6)],'secondary_code':_0x4a23ed['secondary_code'],'product_code':_0x4a23ed[_0x507299(0x141)],'bay':_0x4a23ed[_0x507299(0x1ea)],'bin':_0x4a23ed[_0x507299(0x1b4)],'type':_0x4a23ed[_0x507299(0x1af)],'floorlevel':_0x4a23ed[_0x507299(0x171)]})),console[_0x507299(0x1e2)](_0x507299(0x204),_0x568f5a);}),await _0x568f5a['save'](),console[_0x56b5cf(0x1e2)](_0x311fd1[_0x56b5cf(0x24c)]);const _0x3f7538=new c_payment_data({'invoice':_0xdc17eb,'customer':_0x311fd1[_0x56b5cf(0x24c)][_0x56b5cf(0x20a)],'reason':_0x56b5cf(0x1c2)});await _0x3f7538[_0x56b5cf(0x217)]();const _0x19365c=await master_shop[_0x56b5cf(0x23c)]();console['log'](_0x56b5cf(0x245),_0x19365c[0x0][_0x56b5cf(0x1b8)]);const _0x1d5670=await email_settings[_0x56b5cf(0x22b)](),_0x216be6=await customer[_0x56b5cf(0x22b)]({'name':_0x311fd1[_0x56b5cf(0x24c)]['customer']});console['log'](_0x56b5cf(0x149),_0x216be6);_0x19365c[0x0]['currency_placement']==0x1?(right_currency=_0x19365c[0x0][_0x56b5cf(0x159)],left_currency=''):(right_currency='',left_currency=_0x19365c[0x0][_0x56b5cf(0x159)]);var _0x308cdd=_0x32556e,_0x48c42a=_0x4df6f1,_0x4882ce='',_0xef5f7a;for(_0xef5f7a in _0x308cdd){_0x4882ce+=_0x56b5cf(0x15f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x308cdd[_0xef5f7a]+_0x56b5cf(0x1e8)+_0x56b5cf(0x185)+_0x48c42a[_0xef5f7a]+'</td>'+_0x56b5cf(0x1dc);}console[_0x56b5cf(0x1e2)](_0x56b5cf(0x1ac),_0x4882ce);let _0x2005e7=nodemailer[_0x56b5cf(0x1fa)]({'service':_0x56b5cf(0x21f),'auth':{'user':_0x1d5670[_0x56b5cf(0x21a)],'pass':_0x1d5670[_0x56b5cf(0x20d)]}}),_0xd716f8={'from':_0x1d5670[_0x56b5cf(0x21a)],'to':_0x216be6[_0x56b5cf(0x21a)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x56b5cf(0x1d3),'path':__dirname+'/../public'+_0x56b5cf(0x237)+_0x19365c[0x0]['image'],'cid':_0x56b5cf(0x239)}],'html':'<!DOCTYPE\x20html>'+_0x56b5cf(0x247)+'</head><body>'+_0x56b5cf(0x1eb)+_0x56b5cf(0x1e6)+'<div>'+_0x56b5cf(0x1b2)+'</div>'+_0x56b5cf(0x1eb)+_0x56b5cf(0x155)+_0x19365c[0x0][_0x56b5cf(0x244)]+_0x56b5cf(0x1d0)+'</div>'+_0x56b5cf(0x224)+_0x56b5cf(0x17b)+_0x56b5cf(0x1eb)+_0x56b5cf(0x208)+_0x56b5cf(0x16f)+_0xdc17eb+'\x20'+_0x56b5cf(0x1d7)+'\x20Order\x20Date\x20:\x20'+_0x36e5da+'\x20'+_0x56b5cf(0x22a)+_0x56b5cf(0x1f2)+_0x56b5cf(0x224)+_0x56b5cf(0x14d)+_0x56b5cf(0x161)+_0x56b5cf(0x15f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x56b5cf(0x198)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x56b5cf(0x173)+_0x56b5cf(0x1dc)+_0x56b5cf(0x1b1)+_0x56b5cf(0x146)+'\x20'+_0x4882ce+'\x20'+_0x56b5cf(0x164)+_0x56b5cf(0x168)+'<div>'+_0x56b5cf(0x235)+_0x56b5cf(0x213)+_0x19365c[0x0][_0x56b5cf(0x244)]+'</h5>'+_0x56b5cf(0x224)+'</div>'+_0x56b5cf(0x22c)};_0x2005e7['sendMail'](_0xd716f8,function(_0x6c6a33,_0x569ed7){var _0x5d01f8=_0x56b5cf;_0x6c6a33?(console[_0x5d01f8(0x1e2)](_0x6c6a33),console['log'](_0x5d01f8(0x22f))):console[_0x5d01f8(0x1e2)]('Email\x20sent\x20successfully');}),_0x311fd1[_0x56b5cf(0x14b)](_0x56b5cf(0x1c7),_0x56b5cf(0x1ad)),_0x5ccaab[_0x56b5cf(0x1b5)]('/all_sales/view');}catch(_0x2f8ca1){console['log'](_0x2f8ca1),_0x5ccaab['status'](0xc8)['json']({'message1':_0x2f8ca1[_0x56b5cf(0x1f5)]});}}),router[a0_0x20b97e(0x20f)](a0_0x20b97e(0x160),auth,async(_0x50dfe3,_0x5beea4)=>{var _0x292cb1=a0_0x20b97e;try{const {username:_0x4d6702,email:_0x2a5555,role:_0x2e4488}=_0x50dfe3[_0x292cb1(0x1cc)],_0x339822=_0x50dfe3['user'],_0x358b84=await profile['findOne']({'email':_0x339822[_0x292cb1(0x21a)]}),_0x167a62=await master_shop[_0x292cb1(0x23c)]();console[_0x292cb1(0x1e2)](_0x292cb1(0x202),_0x167a62);const _0xdab673=_0x50dfe3[_0x292cb1(0x1b3)]['id'],_0x57a028=await sales[_0x292cb1(0x1ce)](_0xdab673);console['log'](_0x292cb1(0x222),_0x57a028);if(_0x167a62[0x0]['language']==_0x292cb1(0x1a4))var _0x3ae259=users[_0x292cb1(0x158)];else{if(_0x167a62[0x0][_0x292cb1(0x221)]==_0x292cb1(0x13b))var _0x3ae259=users[_0x292cb1(0x13b)];else{if(_0x167a62[0x0][_0x292cb1(0x221)]=='German')var _0x3ae259=users['German'];else{if(_0x167a62[0x0]['language']=='Spanish')var _0x3ae259=users[_0x292cb1(0x16b)];else{if(_0x167a62[0x0][_0x292cb1(0x221)]==_0x292cb1(0x1bf))var _0x3ae259=users[_0x292cb1(0x1bf)];else{if(_0x167a62[0x0][_0x292cb1(0x221)]==_0x292cb1(0x17e))var _0x3ae259=users['Portuguese'];else{if(_0x167a62[0x0][_0x292cb1(0x221)]==_0x292cb1(0x183))var _0x3ae259=users[_0x292cb1(0x183)];else{if(_0x167a62[0x0]['language']==_0x292cb1(0x1c5))var _0x3ae259=users['Arabic'];}}}}}}}_0x5beea4[_0x292cb1(0x22e)](_0x292cb1(0x215),{'success':_0x50dfe3[_0x292cb1(0x14b)]('success'),'errors':_0x50dfe3[_0x292cb1(0x14b)]('errors'),'role':_0x339822,'profile':_0x358b84,'alldata':_0x57a028,'master_shop':_0x167a62,'language':_0x3ae259});}catch(_0x24fbfd){console[_0x292cb1(0x1e2)](_0x24fbfd);}}),router[a0_0x20b97e(0x191)](a0_0x20b97e(0x230),async(_0x16cdfc,_0x2da30b)=>{var _0x11f5c8=a0_0x20b97e;const {product_code:_0x360458,warehouse_name:_0x16d8db,rooms_data:_0x3d2cc2,Roomslist:_0xbb0064}=_0x16cdfc['body'],_0x3ea91c=_0xbb0064[_0x11f5c8(0x162)](','),_0x12b49b=[];async function _0x1a9377(_0x46f40f){var _0x4b7ddd=_0x11f5c8;const _0x54308b=await warehouse[_0x4b7ddd(0x1ba)]([{'$match':{'name':_0x16d8db,'room':_0x46f40f}},{'$unwind':_0x4b7ddd(0x190)},{'$match':{'product_details.primary_code':_0x360458}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4b7ddd(0x243)},'product_stock':{'$first':_0x4b7ddd(0x170)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x4b7ddd(0x195)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x4b7ddd(0x187)},'unit':{'$first':_0x4b7ddd(0x248)},'secondary_unit':{'$first':_0x4b7ddd(0x1a7)},'storage':{'$first':_0x4b7ddd(0x1bd)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x4b7ddd(0x1c3)},'production_date':{'$first':_0x4b7ddd(0x24d)},'maxPerUnit':{'$first':_0x4b7ddd(0x19c)},'batch_code':{'$first':_0x4b7ddd(0x18e)},'product_cat':{'$first':_0x4b7ddd(0x186)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4b7ddd(0x212)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x4b7ddd(0x18b)},'actual_uom':{'$first':_0x4b7ddd(0x23e)},'delivery_date':{'$first':'$product_details.delivery_date'},'delivery_code':{'$first':_0x4b7ddd(0x209)}}}]),_0xe19ef7=await warehouse[_0x4b7ddd(0x1ba)]([{'$match':{'name':_0x16d8db,'room':_0x46f40f}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x360458}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4b7ddd(0x243)},'product_stock':{'$first':_0x4b7ddd(0x170)},'primary_code':{'$first':_0x4b7ddd(0x236)},'secondary_code':{'$first':_0x4b7ddd(0x145)},'product_code':{'$first':_0x4b7ddd(0x241)},'level':{'$first':_0x4b7ddd(0x15a)},'isle':{'$first':_0x4b7ddd(0x195)},'type':{'$first':_0x4b7ddd(0x1d9)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x4b7ddd(0x248)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x4b7ddd(0x1bd)},'rack':{'$first':_0x4b7ddd(0x1b0)},'expiry_date':{'$first':_0x4b7ddd(0x1c3)},'production_date':{'$first':_0x4b7ddd(0x24d)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x4b7ddd(0x18e)},'product_cat':{'$first':_0x4b7ddd(0x186)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x4b7ddd(0x212)},'invoice':{'$first':'$product_details.invoice'},'delivery_date':{'$first':'$product_details.delivery_date'},'delivery_code':{'$first':_0x4b7ddd(0x209)}}}]);if(_0x54308b[_0x4b7ddd(0x143)]>0x0)_0x12b49b[_0x4b7ddd(0x1fe)](_0x54308b);else _0xe19ef7['length']>0x0&&_0x12b49b[_0x4b7ddd(0x1fe)](_0xe19ef7);}const _0x37689f=_0x3ea91c['map'](_0x1c08a5=>_0x1a9377(_0x1c08a5));await Promise['all'](_0x37689f),_0x2da30b['json'](_0x12b49b);}),module['exports']=router;