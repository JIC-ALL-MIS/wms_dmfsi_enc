var a0_0x173813=a0_0x305e;function a0_0xcbee(){var _0x52b520=['image','all_sales','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_stock','<hr\x20class=\x22my-3\x22>','65742INwghx','</div>','/upload/','rack','get','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.secondary_unit','catch','expiry_date','$name','bay','level','$product_details.product_stock','OUT-','$product_details._id','flash','/all_sales/preview/','params','$product_details.actual_uom','actual_qty','prod_code','floor','There\x27s\x20a\x20error\x20in\x20this\x20transaction','stocks','warehouse','product_details','sale_product','delivery_code','return_data','$product_details.product_name','stock','secondary_unit','$product_details.unit','Receiving\x20Area','Ambient','map','primary_code','role','max','Spanish','/view','$product_details.expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','finalize','$product_details.batch_code','forEach','staff','back','redirect','True','154638Qblltd','$product_details.storage','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','status','getDate','Enclosed','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.bay','stock_data','$product_details.invoice','edit_sales','room_name','Portuguese','primary_unit','purchases_data','$return_data','Sale\x20Return','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','createTransport','Floor','production_date','RMSEmail','<tbody\x20style=\x22text-align:\x20center;\x22>','4TgwjFu','render','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$invoice','received_amount','$product_details','edit_sales_view','$product_details.level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','</thead>','Arabic','Return\x20Rooms','$product','$sale_product.bay','carton','all','string','quantity','aggregate','Error\x20Occurs','$isAllowEdit','1wXfznv','An\x20error\x20occurred.','</h5>','email','error','</head><body>','master','customers_docs','</tbody>','$product_details.rack','split','quantity_notConverted','../middleware/auth','203410iSdJUn','warehouse_name','$product_details.product_code','$sale_product.quantity','sale_qty','Level','<span\x20style=\x22float:\x20right;\x22>','<h2>\x20','English\x20(US)','secondary_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.production_date','product','</tr>','batch_code','/all_sales/view','An\x20error\x20occurred\x20while\x20saving\x20data.','Arabic\x20(ae)','$_id','slice','invoice','express','Router','sendMail','return_sale','$warehouse_name','$sale_product','logo','getFullYear','actual_uom','$finalize','$product_details.product_cat','post','../public/language/languages.json','<strong>\x20Regards\x20</strong>','sales\x20item\x20return\x20successfull','bin','$product_details.floorlevel','$product_details.pallet','payment\x20successfull','343168xIGZvs','final','prod_invoice','barcode\x20Product\x20master','$sale_product.floorlevel','_id','/../public','</td>','user','barcode\x20user_id','getMonth','<h5\x20style=\x22text-align:\x20left;\x22>','/barcode/:id','user_id','<tr>','Email\x20sent\x20successfully','Enabled','$product_details.type','RoomAssigned','Sales\x20Update\x20successfully','add\x20post','add_sales','push','German','<table\x20style=\x22width:\x20100%\x20!important;\x22>','\x20</h2>','Hindi','isAllowEdit','find','$product_details.bin','False','<div>','$sale_product.bin','346803XIYxEv','currency','return_qty','Raw\x20Materials','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','foreach\x20newproduct','$customers_docs','filter','Sale\x20Return\x20Mail','name','json','\x20Order\x20Date\x20:\x20','customers','id_transaction_from','maxperunit','Logo.png','/preview/:id','<h5>','Chinese','findById','port','Sales\x20Mail','product_name','$customer','9hmCUAz','French','product_code','padStart','all_sales_barcode','/give_payment/:id','/view/add_sales','date','unit','/view/:id','message','English','max_per_unit','requested_qty','</body></html>','exports','id_transact','sales_quantity','body','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','save','\x20Order\x20Number\x20:\x20','/barcode_scanner','<!DOCTYPE\x20html>','length','$product_details.actual_qty','storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','</span>','types','$product_details.maxPerUnit','delivery_date','nodemailer','then','$sale_product.type','findOne','site_title','Portuguese\x20(BR)','floorlevel','type','</table>','Return\x20Goods','717160GKhckn','prod_cat','$room','customer','/view/return_sales/:id','456610AqWVak','abs','success','note','product_data','$product_details.primary_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','random','$note','$product_details.secondary_code','sales\x20all_data','password','$date'];a0_0xcbee=function(){return _0x52b520;};return a0_0xcbee();}(function(_0xcc143f,_0x153cae){var _0x5c9b41=a0_0x305e,_0x31b9f9=_0xcc143f();while(!![]){try{var _0x45fda7=parseInt(_0x5c9b41(0x296))/0x1*(-parseInt(_0x5c9b41(0x26a))/0x2)+parseInt(_0x5c9b41(0x1dc))/0x3*(parseInt(_0x5c9b41(0x281))/0x4)+parseInt(_0x5c9b41(0x193))/0x5+-parseInt(_0x5c9b41(0x238))/0x6+-parseInt(_0x5c9b41(0x225))/0x7+-parseInt(_0x5c9b41(0x1bb))/0x8*(-parseInt(_0x5c9b41(0x1f5))/0x9)+parseInt(_0x5c9b41(0x220))/0xa;if(_0x45fda7===_0x153cae)break;else _0x31b9f9['push'](_0x31b9f9['shift']());}catch(_0x55970b){_0x31b9f9['push'](_0x31b9f9['shift']());}}}(a0_0xcbee,0x1ca8d));const express=require(a0_0x173813(0x1a8)),app=express(),router=express[a0_0x173813(0x1a9)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x173813(0x2a2)),nodemailer=require(a0_0x173813(0x216)),users=require(a0_0x173813(0x1b4));router['get'](a0_0x173813(0x260),auth,async(_0x39afe3,_0x126fba)=>{var _0x2031fb=a0_0x173813;try{const {username:_0x5f2b08,email:_0x5e3dc6,role:_0x32f6ad}=_0x39afe3[_0x2031fb(0x1c3)],_0x44528e=_0x39afe3[_0x2031fb(0x1c3)],_0x370c0c=await profile[_0x2031fb(0x219)]({'email':_0x44528e[_0x2031fb(0x299)]}),_0x33cb52=await master_shop[_0x2031fb(0x1d7)]();let _0x118589;if(_0x44528e[_0x2031fb(0x25d)]==_0x2031fb(0x266)){const _0x2941ba=await staff['findOne']({'email':_0x44528e[_0x2031fb(0x299)]});_0x118589=await sales['aggregate']([{'$lookup':{'from':_0x2031fb(0x1e9),'localField':_0x2031fb(0x223),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0x2031fb(0x1e3)},{'$unwind':_0x2031fb(0x1ad)},{'$group':{'_id':_0x2031fb(0x1a5),'invoice':{'$first':_0x2031fb(0x284)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2031fb(0x1ac)},'sale_product':{'$push':_0x2031fb(0x1ad)},'note':{'$first':_0x2031fb(0x22d)},'return_data':{'$first':_0x2031fb(0x279)},'customers_docs':{'$first':_0x2031fb(0x1e3)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x2031fb(0x28e)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x2031fb(0x218)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x2031fb(0x1b1)},'isAllowEdit':{'$first':_0x2031fb(0x295)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x118589=await sales[_0x2031fb(0x293)]([{'$lookup':{'from':_0x2031fb(0x1e9),'localField':_0x2031fb(0x223),'foreignField':_0x2031fb(0x1e6),'as':_0x2031fb(0x29d)}},{'$unwind':_0x2031fb(0x1e3)},{'$unwind':_0x2031fb(0x1ad)},{'$group':{'_id':_0x2031fb(0x1a5),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x2031fb(0x1f4)},'date':{'$first':_0x2031fb(0x231)},'warehouse_name':{'$first':_0x2031fb(0x1ac)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x2031fb(0x22d)},'return_data':{'$first':_0x2031fb(0x279)},'customers_docs':{'$first':_0x2031fb(0x1e3)},'total_saleproduct_quantity':{'$sum':_0x2031fb(0x196)},'level':{'$addToSet':_0x2031fb(0x28e)},'isle':{'$addToSet':_0x2031fb(0x1db)},'type':{'$addToSet':_0x2031fb(0x218)},'pallet':{'$addToSet':_0x2031fb(0x1bf)},'finalize':{'$first':_0x2031fb(0x1b1)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x2031fb(0x234)](_0x2031fb(0x22f),_0x118589);if(_0x33cb52[0x0]['language']==_0x2031fb(0x19b)){var _0x201754=users[_0x2031fb(0x200)];console['log'](_0x201754);}else{if(_0x33cb52[0x0][_0x2031fb(0x208)]=='Hindi')var _0x201754=users['Hindi'];else{if(_0x33cb52[0x0][_0x2031fb(0x208)]=='German')var _0x201754=users['German'];else{if(_0x33cb52[0x0][_0x2031fb(0x208)]=='Spanish')var _0x201754=users[_0x2031fb(0x25f)];else{if(_0x33cb52[0x0]['language']==_0x2031fb(0x1f6))var _0x201754=users['French'];else{if(_0x33cb52[0x0][_0x2031fb(0x208)]==_0x2031fb(0x21b))var _0x201754=users[_0x2031fb(0x276)];else{if(_0x33cb52[0x0][_0x2031fb(0x208)]==_0x2031fb(0x1ef))var _0x201754=users[_0x2031fb(0x1ef)];else{if(_0x33cb52[0x0]['language']==_0x2031fb(0x1a4))var _0x201754=users['Arabic'];}}}}}}}_0x126fba[_0x2031fb(0x282)](_0x2031fb(0x233),{'success':_0x39afe3[_0x2031fb(0x247)]('success'),'errors':_0x39afe3[_0x2031fb(0x247)](_0x2031fb(0x1e0)),'sales':_0x118589,'profile':_0x370c0c,'role':_0x44528e,'master_shop':_0x33cb52,'language':_0x201754});}catch(_0x593cd3){console[_0x2031fb(0x234)](_0x593cd3);}});function a0_0x305e(_0x297f45,_0x2b58fc){var _0xcbee85=a0_0xcbee();return a0_0x305e=function(_0x305e34,_0x46fa6a){_0x305e34=_0x305e34-0x193;var _0x36b7d1=_0xcbee85[_0x305e34];return _0x36b7d1;},a0_0x305e(_0x297f45,_0x2b58fc);}async function getRandom8DigitNumber(){var _0x1c0597=a0_0x173813;const _0x372a14=0x989680,_0x3c1df7=0x5f5e0ff,_0x15f0e8=Math[_0x1c0597(0x24d)](Math[_0x1c0597(0x22c)]()*(_0x3c1df7-_0x372a14+0x1))+_0x372a14;var _0x209c11;const _0x13cb09=await sales['findOne']({'invoice':_0x1c0597(0x245)+_0x15f0e8});return _0x13cb09&&_0x13cb09['length']>0x0?_0x209c11=_0x1c0597(0x245)+_0x15f0e8:_0x209c11=_0x1c0597(0x245)+_0x15f0e8,_0x209c11;}router[a0_0x173813(0x23c)]('/view/add_sales',auth,async(_0x28f0f6,_0xffe0)=>{var _0xa883aa=a0_0x173813;try{const {username:_0x24a3b0,email:_0x161290,role:_0x349746}=_0x28f0f6['user'],_0x452b08=_0x28f0f6['user'],_0x141839=await profile[_0xa883aa(0x219)]({'email':_0x452b08[_0xa883aa(0x299)]}),_0x10c7c1=await master_shop['find'](),_0x38a3aa=await customer[_0xa883aa(0x1d7)]({});let _0x23b2c7;if(_0x452b08[_0xa883aa(0x25d)]==_0xa883aa(0x266)){const _0x3e5156=await staff[_0xa883aa(0x219)]({'email':_0x452b08['email']});_0x23b2c7=await warehouse[_0xa883aa(0x293)]([{'$match':{'status':_0xa883aa(0x1cb),'name':_0x3e5156[_0xa883aa(0x250)],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0xa883aa(0x241),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x23b2c7=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0xa883aa(0x21f)}}},{'$group':{'_id':_0xa883aa(0x241),'name':{'$first':_0xa883aa(0x241)}}},{'$sort':{'name':0x1}}]);const _0xc8ea7f=await product['find']({});var _0x1667b7=[_0xa883aa(0x25a),_0xa883aa(0x26f)];const _0x16390d=await sales[_0xa883aa(0x1d7)]({}),_0x58e90e=_0x16390d[_0xa883aa(0x20e)]+0x1,_0x1dcef0=_0xa883aa(0x245)+_0x58e90e['toString']()[_0xa883aa(0x1f8)](0x5,'0');if(_0x10c7c1[0x0][_0xa883aa(0x208)]==_0xa883aa(0x19b)){var _0x366180=users[_0xa883aa(0x200)];console[_0xa883aa(0x234)](_0x366180);}else{if(_0x10c7c1[0x0][_0xa883aa(0x208)]=='Hindi')var _0x366180=users[_0xa883aa(0x1d5)];else{if(_0x10c7c1[0x0][_0xa883aa(0x208)]=='German')var _0x366180=users['German'];else{if(_0x10c7c1[0x0][_0xa883aa(0x208)]==_0xa883aa(0x25f))var _0x366180=users[_0xa883aa(0x25f)];else{if(_0x10c7c1[0x0]['language']==_0xa883aa(0x1f6))var _0x366180=users[_0xa883aa(0x1f6)];else{if(_0x10c7c1[0x0][_0xa883aa(0x208)]==_0xa883aa(0x21b))var _0x366180=users[_0xa883aa(0x276)];else{if(_0x10c7c1[0x0][_0xa883aa(0x208)]==_0xa883aa(0x1ef))var _0x366180=users['Chinese'];else{if(_0x10c7c1[0x0][_0xa883aa(0x208)]=='Arabic\x20(ae)')var _0x366180=users[_0xa883aa(0x28b)];}}}}}}}const _0x5c1923=getRandom8DigitNumber();_0x5c1923[_0xa883aa(0x217)](_0x42490f=>{var _0x3b1ef4=_0xa883aa;_0xffe0[_0x3b1ef4(0x282)](_0x3b1ef4(0x1d0),{'success':_0x28f0f6[_0x3b1ef4(0x247)](_0x3b1ef4(0x227)),'errors':_0x28f0f6[_0x3b1ef4(0x247)](_0x3b1ef4(0x1e0)),'role':_0x452b08,'profile':_0x141839,'customer':_0x38a3aa,'warehouse':_0x23b2c7,'product':_0xc8ea7f,'invoice':_0x42490f,'master_shop':_0x10c7c1,'language':_0x366180,'rooms_data':_0x1667b7});})[_0xa883aa(0x23f)](_0x3eab04=>{var _0xf79b9a=_0xa883aa;_0x28f0f6['flash'](_0xf79b9a(0x1e0),_0xf79b9a(0x24e)),_0xffe0[_0xf79b9a(0x268)](_0xf79b9a(0x1a2));});}catch(_0xac7d92){console[_0xa883aa(0x234)](_0xac7d92);}}),router[a0_0x173813(0x23c)]('/view/add_sales/:id',auth,async(_0xf4207,_0x5d6035)=>{var _0x5ac5c4=a0_0x173813;try{const _0x5aa35b=_0xf4207[_0x5ac5c4(0x249)]['id'];console[_0x5ac5c4(0x234)](_0x5aa35b);const _0x5a19a8=await product['find'](),_0x273516=await purchases[_0x5ac5c4(0x293)]([{'$match':{'warehouse_name':_0x5aa35b}},{'$unwind':_0x5ac5c4(0x28d)},{'$group':{'_id':'$product.product_name'}}]);console[_0x5ac5c4(0x234)](_0x5ac5c4(0x278),_0x273516),_0x5d6035[_0x5ac5c4(0x26d)](0xc8)['json']({'purchases_data':_0x273516,'product_data':_0x5a19a8});}catch(_0x2acbb8){console[_0x5ac5c4(0x234)](_0x2acbb8);}}),router[a0_0x173813(0x1b3)]('/view/add_sale/product',auth,async(_0x202aa0,_0x189e99)=>{var _0xe37f8c=a0_0x173813;try{const {warehouse_data:_0x3d27d7,product_data:_0x5ecc8d}=_0x202aa0[_0xe37f8c(0x207)];console['log'](_0x202aa0[_0xe37f8c(0x207)][_0xe37f8c(0x229)]);;const _0x5e5e39=await master_shop[_0xe37f8c(0x1d7)]();console[_0xe37f8c(0x234)](_0xe37f8c(0x29c),_0x5e5e39);const _0x24909e=await product[_0xe37f8c(0x219)]({'name':_0x5ecc8d});console[_0xe37f8c(0x234)](_0xe37f8c(0x19f),_0x24909e);const _0x444b3e=await warehouse[_0xe37f8c(0x293)]([{'$match':{'name':_0x3d27d7}},{'$unwind':_0xe37f8c(0x286)},{'$match':{'product_details.product_name':_0x5ecc8d}},{'$group':{'_id':_0xe37f8c(0x255),'product_stock':{'$first':_0xe37f8c(0x244)}}}]);console[_0xe37f8c(0x234)](_0xe37f8c(0x272),_0x444b3e),_0x189e99[_0xe37f8c(0x26d)](0xc8)['json']({'master':_0x5e5e39,'new_product':_0x24909e,'stock_data':_0x444b3e});}catch(_0x5705a4){console['log'](_0x5705a4);}}),router[a0_0x173813(0x1b3)](a0_0x173813(0x1fb),auth,async(_0xbb495e,_0x2a6d76)=>{var _0x3ce564=a0_0x173813;try{const {invoice:_0x17a09b,date:_0x2c02fe,warehouse_name:_0x2d4460,product_name:_0x30fb29,stock:_0x3fdd19,quantity:_0x2a57ab,note:_0x351fb2,room:_0x5f3c2e,primary_code:_0x417fee,secondary_code:_0x418457,prod_code:_0x213d94,level:_0x235ac4,isle:_0x14b880,pallet:_0x43a087,batch_code:_0x12e0c2,SCRN:_0x3b2dbd,expiry_date:_0x1bded4}=_0xbb495e['body'];if(typeof _0x30fb29=='string')var _0x9fa308=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x1f3)]],_0x38e36a=[_0xbb495e['body'][_0x3ce564(0x256)]],_0x25cf0d=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x28f)]],_0x1c621b=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x25c)]],_0x3cf65f=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x19c)]],_0x2d9f6a=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x24c)]],_0xb14878=[_0xbb495e[_0x3ce564(0x207)]['level']],_0x42c474=[_0xbb495e[_0x3ce564(0x207)]['primary_unit']],_0x55affa=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x257)]],_0xd9f09f=[_0xbb495e['body'][_0x3ce564(0x1a1)]],_0x5bae85=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x240)]],_0x44540e=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x201)]],_0x5857c7=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x27e)]],_0x58c814=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x202)]],_0x419a67=[_0xbb495e['body'][_0x3ce564(0x215)]],_0xdd78d3=[_0xbb495e[_0x3ce564(0x207)]['delivery_code']],_0x5d240f=[_0xbb495e['body']['prod_cat']],_0x40a434=[_0xbb495e[_0x3ce564(0x207)]['quantity']],_0x21dba0=[_0xbb495e['body']['RoomAssigned']],_0x939c55=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x1bd)]],_0x469179=[_0xbb495e[_0x3ce564(0x207)]['actual_qty']],_0x5660d3=[_0xbb495e[_0x3ce564(0x207)]['actual_uom']],_0x249021=[_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x205)]];else var _0x9fa308=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x1f3)]],_0x38e36a=[..._0xbb495e['body'][_0x3ce564(0x256)]],_0x25cf0d=[..._0xbb495e[_0x3ce564(0x207)]['carton']],_0x1c621b=[..._0xbb495e[_0x3ce564(0x207)]['primary_code']],_0x3cf65f=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x19c)]],_0x2d9f6a=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x24c)]],_0xb14878=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x243)]],_0x42c474=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x277)]],_0x55affa=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x257)]],_0xd9f09f=[..._0xbb495e['body']['batch_code']],_0x5bae85=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x240)]],_0x44540e=[..._0xbb495e[_0x3ce564(0x207)]['max_per_unit']],_0x5857c7=[..._0xbb495e['body'][_0x3ce564(0x27e)]],_0x58c814=[..._0xbb495e['body'][_0x3ce564(0x202)]],_0x419a67=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x215)]],_0xdd78d3=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x253)]],_0x5d240f=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x221)]],_0x40a434=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x292)]],_0x21dba0=[..._0xbb495e['body'][_0x3ce564(0x1cd)]],_0x939c55=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x1bd)]],_0x469179=[..._0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x24b)]],_0x5660d3=[..._0xbb495e[_0x3ce564(0x207)]['actual_uom']],_0x249021=[..._0xbb495e[_0x3ce564(0x207)]['id_transact']];const _0x41d990=_0x9fa308[_0x3ce564(0x25b)](_0x220ea4=>{return _0x220ea4={'product_name':_0x220ea4};});_0x38e36a[_0x3ce564(0x265)]((_0x5d2716,_0x3b31e6)=>{var _0x2b7e42=_0x3ce564;_0x41d990[_0x3b31e6][_0x2b7e42(0x256)]=Math[_0x2b7e42(0x226)](_0x5d2716);}),_0x469179['forEach']((_0x3a3e97,_0x46e4db)=>{_0x41d990[_0x46e4db]['actual_qty']=Math['abs'](_0x3a3e97);}),_0x5660d3['forEach']((_0xb37731,_0x7a7bb8)=>{var _0x68c951=_0x3ce564;_0x41d990[_0x7a7bb8][_0x68c951(0x1b0)]=_0xb37731;}),_0x249021['forEach']((_0xc31ba4,_0x329595)=>{var _0x227b9f=_0x3ce564;_0x41d990[_0x329595][_0x227b9f(0x1ea)]=_0xc31ba4;}),_0x25cf0d[_0x3ce564(0x265)]((_0x36bbec,_0x57e7f1)=>{var _0x4a460b=_0x3ce564;_0x41d990[_0x57e7f1][_0x4a460b(0x292)]=_0x36bbec;}),_0x1c621b[_0x3ce564(0x265)]((_0x260dd5,_0x299b57)=>{var _0xf37958=_0x3ce564;_0x41d990[_0x299b57][_0xf37958(0x25c)]=_0x260dd5;}),_0x3cf65f[_0x3ce564(0x265)]((_0x2cbdc8,_0x4805cf)=>{var _0x3654ea=_0x3ce564;_0x41d990[_0x4805cf][_0x3654ea(0x19c)]=_0x2cbdc8;}),_0x2d9f6a['forEach']((_0x20b8a5,_0x9aeaa9)=>{var _0x16d387=_0x3ce564;_0x41d990[_0x9aeaa9][_0x16d387(0x1f7)]=_0x20b8a5;}),_0xb14878[_0x3ce564(0x265)]((_0x3e7386,_0x57ec43)=>{var _0x11897c=_0x3ce564;_0x21dba0[_0x11897c(0x265)]((_0x312f6f,_0x417fc6)=>{var _0x57caa3=_0x11897c;if(_0x312f6f==_0x57caa3(0x259)&&_0x57ec43==_0x417fc6){var _0x3b6051=_0x3e7386[_0x57caa3(0x1a6)](0x3);_0x41d990[_0x57ec43][_0x57caa3(0x210)]=_0x3e7386[0x0],_0x41d990[_0x57ec43][_0x57caa3(0x23b)]=_0x3e7386[0x1],_0x41d990[_0x57ec43]['bay']=0x0,_0x41d990[_0x57ec43][_0x57caa3(0x1b7)]=0x0,_0x41d990[_0x57ec43]['type']=_0x57caa3(0x27d),_0x41d990[_0x57ec43]['floorlevel']=_0x3b6051;}else{if(_0x312f6f=='Shelves'&&_0x57ec43==_0x417fc6){var _0x3b6051=_0x3e7386[_0x57caa3(0x1a6)](0x3);_0x41d990[_0x57ec43]['storage']=_0x3e7386[0x0],_0x41d990[_0x57ec43]['rack']=_0x3e7386[0x1],_0x41d990[_0x57ec43][_0x57caa3(0x242)]=0x0,_0x41d990[_0x57ec43][_0x57caa3(0x1b7)]=0x0,_0x41d990[_0x57ec43][_0x57caa3(0x21d)]=_0x57caa3(0x27d),_0x41d990[_0x57ec43]['floorlevel']=_0x3e7386[0x5];}else{if(_0x57ec43==_0x417fc6){var _0x538eb2;if(_0x3e7386[0x4]=='L')_0x538eb2=_0x57caa3(0x198);else _0x3e7386[0x4]=='F'&&(_0x538eb2='Floor');_0x41d990[_0x57ec43][_0x57caa3(0x210)]=_0x3e7386[0x0],_0x41d990[_0x57ec43]['rack']=_0x3e7386[0x1],_0x41d990[_0x57ec43][_0x57caa3(0x242)]=_0x3e7386[0x2],_0x41d990[_0x57ec43][_0x57caa3(0x1b7)]=_0x3e7386[0x3],_0x41d990[_0x57ec43][_0x57caa3(0x21d)]=_0x538eb2,_0x41d990[_0x57ec43]['floorlevel']=_0x3e7386[0x5];}}}});}),_0x42c474['forEach']((_0x495aad,_0x3ad93b)=>{_0x41d990[_0x3ad93b]['unit']=_0x495aad;}),_0x55affa['forEach']((_0x1d48f3,_0x1c145e)=>{var _0x3e45f2=_0x3ce564;_0x41d990[_0x1c145e][_0x3e45f2(0x257)]=_0x1d48f3;}),_0xd9f09f[_0x3ce564(0x265)]((_0x226008,_0x665e4a)=>{var _0x2f1495=_0x3ce564;_0x41d990[_0x665e4a][_0x2f1495(0x1a1)]=_0x226008;}),_0x5bae85[_0x3ce564(0x265)]((_0x47e5be,_0x466ae2)=>{_0x41d990[_0x466ae2]['expiry_date']=_0x47e5be;}),_0x44540e['forEach']((_0x37287c,_0x35b396)=>{var _0xa3d690=_0x3ce564;_0x41d990[_0x35b396][_0xa3d690(0x1eb)]=_0x37287c;}),_0x5857c7['forEach']((_0x53ab8e,_0x1ebaf0)=>{var _0xfcb865=_0x3ce564;_0x41d990[_0x1ebaf0][_0xfcb865(0x27e)]=_0x53ab8e;}),_0x58c814[_0x3ce564(0x265)]((_0x3925f4,_0x189caf)=>{var _0x43f267=_0x3ce564;_0x41d990[_0x189caf][_0x43f267(0x202)]=_0x3925f4;}),_0x419a67['forEach']((_0x393ef9,_0x33543e)=>{var _0x448057=_0x3ce564;_0x41d990[_0x33543e][_0x448057(0x215)]=_0x393ef9;}),_0xdd78d3[_0x3ce564(0x265)]((_0xfed350,_0x4e7ce0)=>{var _0x554d6c=_0x3ce564;_0x41d990[_0x4e7ce0][_0x554d6c(0x253)]=_0xfed350;}),_0x5d240f[_0x3ce564(0x265)]((_0xb1105c,_0x17fbb6)=>{var _0x570f81=_0x3ce564;_0x41d990[_0x17fbb6][_0x570f81(0x221)]=_0xb1105c;}),_0x40a434[_0x3ce564(0x265)]((_0x1153c7,_0x1ff7b6)=>{var _0x4a8daa=_0x3ce564;_0x41d990[_0x1ff7b6][_0x4a8daa(0x2a1)]=_0x1153c7;}),_0x21dba0[_0x3ce564(0x265)]((_0x468b17,_0x4a8726)=>{var _0x4f9a0e=_0x3ce564;_0x41d990[_0x4a8726][_0x4f9a0e(0x275)]=_0x468b17;}),_0x939c55[_0x3ce564(0x265)]((_0x37f54e,_0x5730c5)=>{var _0x6a0cd8=_0x3ce564;_0x41d990[_0x5730c5][_0x6a0cd8(0x1a7)]=_0x37f54e;});var _0x5b85bc=0x0;_0x41d990[_0x3ce564(0x265)](_0x53094f=>{var _0x4be6c1=_0x3ce564;(_0x53094f[_0x4be6c1(0x256)]<_0x53094f['quantity_notConverted']||_0x53094f[_0x4be6c1(0x2a1)]==0x0)&&(console[_0x4be6c1(0x234)](_0x4be6c1(0x1e2),_0x53094f),_0x5b85bc++);});const _0xfdbd4a=_0x41d990[_0x3ce564(0x1e4)](_0x1652a5=>_0x1652a5['quantity']!=='0'&&_0x1652a5[_0x3ce564(0x292)]!==''),_0x329452=new sales({'invoice':_0x17a09b,'customer':_0xbb495e[_0x3ce564(0x207)][_0x3ce564(0x223)],'date':_0x2c02fe,'warehouse_name':_0x2d4460,'sale_product':_0xfdbd4a,'note':_0x351fb2,'room':_0x5f3c2e,'primary_code':_0x417fee,'secondary_code':_0x418457,'prod_code':_0x213d94,'SCRN':_0x3b2dbd}),_0x4035c8=await _0x329452[_0x3ce564(0x20a)]();_0xbb495e[_0x3ce564(0x247)](_0x3ce564(0x227),'Sales\x20Add\x20successfully'),_0x2a6d76[_0x3ce564(0x268)](_0x3ce564(0x248)+_0x4035c8[_0x3ce564(0x1c0)]);}catch(_0xe82a75){console[_0x3ce564(0x234)](_0xe82a75);}}),router[a0_0x173813(0x23c)](a0_0x173813(0x1ed),auth,async(_0x4d619c,_0x38c6fa)=>{var _0x3312d3=a0_0x173813;try{const {username:_0x331009,email:_0x4d8f61,role:_0x351e33}=_0x4d619c[_0x3312d3(0x1c3)],_0x5a7a94=_0x4d619c[_0x3312d3(0x1c3)],_0x11a3a3=await profile[_0x3312d3(0x219)]({'email':_0x5a7a94[_0x3312d3(0x299)]}),_0x20327d=await master_shop[_0x3312d3(0x1d7)](),_0x271aa1=_0x4d619c[_0x3312d3(0x249)]['id'],_0x3332e6=await sales['findById'](_0x271aa1),_0x22fb00=await warehouse[_0x3312d3(0x293)]([{'$match':{'name':_0x3332e6[_0x3312d3(0x194)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3312d3(0x255)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x3312d3(0x1d8)},'type':{'$first':_0x3312d3(0x1cc)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3312d3(0x22a)},'secondary_code':{'$first':_0x3312d3(0x22e)},'product_code':{'$first':_0x3312d3(0x195)},'storage':{'$first':_0x3312d3(0x26b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3312d3(0x261)},'production_date':{'$first':_0x3312d3(0x19e)},'invoice':{'$first':_0x3312d3(0x273)}}}]),_0x104729=await customer['find']({});let _0xc2565c;if(_0x5a7a94[_0x3312d3(0x25d)]==_0x3312d3(0x266)){const _0x264c91=await staff['findOne']({'email':_0x5a7a94[_0x3312d3(0x299)]});_0xc2565c=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x264c91[_0x3312d3(0x250)]}},{'$group':{'_id':_0x3312d3(0x241),'name':{'$first':_0x3312d3(0x241)}}}]);}else _0xc2565c=await warehouse[_0x3312d3(0x293)]([{'$match':{'status':_0x3312d3(0x1cb)}},{'$group':{'_id':_0x3312d3(0x241),'name':{'$first':_0x3312d3(0x241)}}}]);const _0x17c088=await product[_0x3312d3(0x1d7)]({}),_0x4083df=await suppliers[_0x3312d3(0x1d7)]({});if(_0x20327d[0x0][_0x3312d3(0x208)]==_0x3312d3(0x19b)){var _0x4d791c=users[_0x3312d3(0x200)];console[_0x3312d3(0x234)](_0x4d791c);}else{if(_0x20327d[0x0][_0x3312d3(0x208)]=='Hindi')var _0x4d791c=users[_0x3312d3(0x1d5)];else{if(_0x20327d[0x0]['language']==_0x3312d3(0x1d2))var _0x4d791c=users['German'];else{if(_0x20327d[0x0]['language']==_0x3312d3(0x25f))var _0x4d791c=users[_0x3312d3(0x25f)];else{if(_0x20327d[0x0]['language']=='French')var _0x4d791c=users[_0x3312d3(0x1f6)];else{if(_0x20327d[0x0][_0x3312d3(0x208)]==_0x3312d3(0x21b))var _0x4d791c=users[_0x3312d3(0x276)];else{if(_0x20327d[0x0][_0x3312d3(0x208)]==_0x3312d3(0x1ef))var _0x4d791c=users[_0x3312d3(0x1ef)];else{if(_0x20327d[0x0][_0x3312d3(0x208)]=='Arabic\x20(ae)')var _0x4d791c=users[_0x3312d3(0x28b)];}}}}}}}_0x38c6fa[_0x3312d3(0x282)](_0x3312d3(0x287),{'success':_0x4d619c[_0x3312d3(0x247)](_0x3312d3(0x227)),'errors':_0x4d619c['flash'](_0x3312d3(0x1e0)),'role':_0x5a7a94,'profile':_0x11a3a3,'customer':_0x104729,'warehouse':_0xc2565c,'product':_0x22fb00,'user':_0x3332e6,'master_shop':_0x20327d,'unit':_0x17c088,'language':_0x4d791c,'suppliers':_0x4083df});}catch(_0x50a231){console['log'](_0x50a231);}}),router[a0_0x173813(0x1b3)](a0_0x173813(0x1ed),auth,async(_0x3f6341,_0x30f8f0)=>{var _0x1d075c=a0_0x173813;try{const _0x528986=_0x3f6341['params']['id'],{invoice:_0x5a3790,warehouse_name:_0x5e3743,room:_0xe3fe55}=_0x3f6341[_0x1d075c(0x207)],_0x55aff6=await sales[_0x1d075c(0x219)]({'invoice':_0x5a3790}),_0x50b879=_0x55aff6[_0x1d075c(0x252)][_0x1d075c(0x25b)](async _0xb57d57=>{var _0x38b2d1=_0x1d075c,_0x41fafb=await warehouse[_0x38b2d1(0x219)]({'name':_0x5e3743,'room':_0xb57d57[_0x38b2d1(0x275)],'warehouse_category':_0x38b2d1(0x1df)});const _0xa9049e=_0x41fafb[_0x38b2d1(0x251)]['map'](_0xfd8441=>{var _0x9b44d=_0x38b2d1;_0xfd8441['product_name']==_0xb57d57['product_name']&&_0xfd8441[_0x9b44d(0x21c)]==_0xb57d57[_0x9b44d(0x21c)]&&_0xfd8441[_0x9b44d(0x21d)]==_0xb57d57[_0x9b44d(0x21d)]&&_0xfd8441[_0x9b44d(0x1b7)]==_0xb57d57[_0x9b44d(0x1b7)]&&_0xfd8441[_0x9b44d(0x242)]==_0xb57d57[_0x9b44d(0x242)]&&_0xfd8441[_0x9b44d(0x23b)]==_0xb57d57['rack']&&_0xfd8441[_0x9b44d(0x210)]==_0xb57d57[_0x9b44d(0x210)]&&_0xfd8441[_0x9b44d(0x240)]==_0xb57d57['expiry_date']&&_0xfd8441[_0x9b44d(0x1a1)]==_0xb57d57[_0x9b44d(0x1a1)]&&_0xfd8441[_0x9b44d(0x1a7)]==_0xb57d57[_0x9b44d(0x1a7)]&&_0xfd8441[_0x9b44d(0x1c0)]==_0xb57d57['id_transaction_from']&&(_0xfd8441[_0x9b44d(0x236)]=Math[_0x9b44d(0x25e)](0x0,Math[_0x9b44d(0x226)](_0xfd8441[_0x9b44d(0x236)])-Math[_0x9b44d(0x226)](_0xb57d57[_0x9b44d(0x292)])));});return _0x41fafb;});Promise[_0x1d075c(0x290)](_0x50b879)[_0x1d075c(0x217)](async _0x1561f4=>{var _0x5e023a=_0x1d075c;try{for(const _0x2bb923 of _0x1561f4){await _0x2bb923[_0x5e023a(0x20a)]();}_0x55aff6[_0x5e023a(0x263)]=_0x5e023a(0x269);const _0x5a1805=await _0x55aff6[_0x5e023a(0x20a)](),_0x23f669=await master_shop[_0x5e023a(0x1d7)](),_0x2f692f=await email_settings[_0x5e023a(0x219)](),_0x505a1e=await supervisor_settings['find']();var _0x387fbb=_0x55aff6[_0x5e023a(0x252)],_0x8036c3='',_0x1e2887;for(_0x1e2887 in _0x387fbb){_0x8036c3+=_0x5e023a(0x1c9)+_0x5e023a(0x19d)+_0x387fbb[_0x1e2887][_0x5e023a(0x1f3)]+'</td>'+_0x5e023a(0x19d)+_0x387fbb[_0x1e2887][_0x5e023a(0x1f7)]+_0x5e023a(0x1c2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x387fbb[_0x1e2887][_0x5e023a(0x292)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x387fbb[_0x1e2887]['unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x387fbb[_0x1e2887][_0x5e023a(0x257)]+_0x5e023a(0x1c2)+_0x5e023a(0x19d)+_0x55aff6[_0x5e023a(0x194)]+'</td>'+_0x5e023a(0x19d)+_0x387fbb[_0x1e2887][_0x5e023a(0x275)]+_0x5e023a(0x1c2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x387fbb[_0x1e2887]['storage']+_0x387fbb[_0x1e2887][_0x5e023a(0x23b)]+_0x387fbb[_0x1e2887][_0x5e023a(0x242)]+_0x387fbb[_0x1e2887][_0x5e023a(0x1b7)]+_0x387fbb[_0x1e2887][_0x5e023a(0x21d)][0x0]+_0x387fbb[_0x1e2887]['floorlevel']+_0x5e023a(0x1c2),'</tr>';}let _0x2e7cf0=nodemailer['createTransport']({'host':_0x2f692f['host'],'port':Number(_0x2f692f[_0x5e023a(0x1f1)]),'secure':![],'auth':{'user':_0x2f692f[_0x5e023a(0x299)],'pass':_0x2f692f['password']}}),_0x1b8d93={'from':_0x2f692f['email'],'to':_0x505a1e[0x0][_0x5e023a(0x27f)],'subject':_0x5e023a(0x1f2),'attachments':[{'filename':_0x5e023a(0x1ec),'path':__dirname+_0x5e023a(0x1c1)+'/upload/'+_0x23f669[0x0][_0x5e023a(0x232)],'cid':_0x5e023a(0x1ae)}],'html':_0x5e023a(0x20d)+'<html><head><title></title>'+'</head><body>'+_0x5e023a(0x1da)+_0x5e023a(0x22b)+_0x5e023a(0x1da)+_0x5e023a(0x270)+_0x5e023a(0x239)+_0x5e023a(0x1da)+_0x5e023a(0x19a)+_0x23f669[0x0]['site_title']+_0x5e023a(0x1d4)+_0x5e023a(0x239)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x5e023a(0x1da)+_0x5e023a(0x1c6)+_0x5e023a(0x20b)+_0x55aff6[_0x5e023a(0x1a7)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x5e023a(0x1e8)+_0x55aff6[_0x5e023a(0x1fc)]+'\x20'+_0x5e023a(0x212)+_0x5e023a(0x298)+_0x5e023a(0x239)+_0x5e023a(0x1d3)+_0x5e023a(0x26c)+_0x5e023a(0x1c9)+_0x5e023a(0x235)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x5e023a(0x27b)+_0x5e023a(0x262)+_0x5e023a(0x23d)+_0x5e023a(0x1e1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x5e023a(0x283)+_0x5e023a(0x1a0)+_0x5e023a(0x28a)+_0x5e023a(0x280)+'\x20'+_0x8036c3+'\x20'+_0x5e023a(0x29e)+_0x5e023a(0x21e)+_0x5e023a(0x1da)+_0x5e023a(0x1b5)+_0x5e023a(0x1ee)+_0x23f669[0x0][_0x5e023a(0x21a)]+'</h5>'+_0x5e023a(0x239)+'</div>'+_0x5e023a(0x203)};_0x2e7cf0[_0x5e023a(0x1aa)](_0x1b8d93,function(_0x18e52e,_0x469eb1){var _0x3cced2=_0x5e023a;_0x18e52e?(console[_0x3cced2(0x234)](_0x18e52e),console[_0x3cced2(0x234)](_0x3cced2(0x294))):console[_0x3cced2(0x234)](_0x3cced2(0x1ca));}),_0x3f6341[_0x5e023a(0x247)](_0x5e023a(0x227),'Sales\x20Update\x20successfully'),_0x30f8f0[_0x5e023a(0x268)](_0x5e023a(0x248)+_0x528986);}catch(_0x52b1dd){console[_0x5e023a(0x29a)](_0x52b1dd),_0x30f8f0[_0x5e023a(0x26d)](0x1f4)[_0x5e023a(0x1e7)]({'error':_0x5e023a(0x1a3)});}})['catch'](_0x5afe2c=>{var _0x5c8c7d=_0x1d075c;console['error'](_0x5afe2c),_0x30f8f0[_0x5c8c7d(0x26d)](0x1f4)[_0x5c8c7d(0x1e7)]({'error':_0x5c8c7d(0x297)});});}catch(_0x2d6f99){console['log'](_0x2d6f99);}}),router[a0_0x173813(0x23c)]('/view/:id',auth,async(_0x427bb7,_0x3ca475)=>{var _0x31defc=a0_0x173813;try{const {username:_0x59fa65,email:_0x37f836,role:_0x3257ca}=_0x427bb7[_0x31defc(0x1c3)],_0x168194=_0x427bb7[_0x31defc(0x1c3)],_0x309b48=await profile['findOne']({'email':_0x168194['email']}),_0x349133=await master_shop[_0x31defc(0x1d7)](),_0x4561b8=_0x427bb7[_0x31defc(0x249)]['id'],_0x4db27d=await sales[_0x31defc(0x1f0)](_0x4561b8);var _0xa53e0d=[_0x31defc(0x25a),'Enclosed'];const _0x30e56f=await warehouse[_0x31defc(0x293)]([{'$match':{'name':_0x4db27d[_0x31defc(0x194)],'warehouse_category':_0x31defc(0x1df)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x31defc(0x255)},'product_stock':{'$first':_0x31defc(0x244)},'bay':{'$first':_0x31defc(0x271)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x31defc(0x1cc)},'floorlevel':{'$first':_0x31defc(0x1b8)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x31defc(0x22e)},'product_code':{'$first':_0x31defc(0x195)},'storage':{'$first':_0x31defc(0x26b)},'rack':{'$first':'$product_details.rack'}}}]),_0x382b1f=await customer[_0x31defc(0x1d7)]({});let _0x3d4eb5;if(_0x168194[_0x31defc(0x25d)]=='staff'){const _0x3ef3e4=await staff['findOne']({'email':_0x168194[_0x31defc(0x299)]});_0x3d4eb5=await warehouse[_0x31defc(0x293)]([{'$match':{'status':_0x31defc(0x1cb),'name':_0x3ef3e4[_0x31defc(0x250)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x31defc(0x241)}}}]);}else _0x3d4eb5=await warehouse[_0x31defc(0x293)]([{'$match':{'status':_0x31defc(0x1cb),'warehouse_category':_0x31defc(0x1df)}},{'$group':{'_id':'$name','name':{'$first':_0x31defc(0x241)}}}]);const _0xb0107c=await product[_0x31defc(0x1d7)]({});if(_0x349133[0x0][_0x31defc(0x208)]==_0x31defc(0x19b)){var _0x2777af=users[_0x31defc(0x200)];console[_0x31defc(0x234)](_0x2777af);}else{if(_0x349133[0x0][_0x31defc(0x208)]==_0x31defc(0x1d5))var _0x2777af=users['Hindi'];else{if(_0x349133[0x0][_0x31defc(0x208)]==_0x31defc(0x1d2))var _0x2777af=users[_0x31defc(0x1d2)];else{if(_0x349133[0x0][_0x31defc(0x208)]==_0x31defc(0x25f))var _0x2777af=users[_0x31defc(0x25f)];else{if(_0x349133[0x0][_0x31defc(0x208)]==_0x31defc(0x1f6))var _0x2777af=users[_0x31defc(0x1f6)];else{if(_0x349133[0x0][_0x31defc(0x208)]==_0x31defc(0x21b))var _0x2777af=users[_0x31defc(0x276)];else{if(_0x349133[0x0]['language']=='Chinese')var _0x2777af=users['Chinese'];else{if(_0x349133[0x0][_0x31defc(0x208)]==_0x31defc(0x1a4))var _0x2777af=users[_0x31defc(0x28b)];}}}}}}}_0x3ca475[_0x31defc(0x282)](_0x31defc(0x274),{'success':_0x427bb7[_0x31defc(0x247)]('success'),'errors':_0x427bb7[_0x31defc(0x247)](_0x31defc(0x1e0)),'role':_0x168194,'profile':_0x309b48,'customer':_0x382b1f,'warehouse':_0x3d4eb5,'product':_0x30e56f,'user':_0x4db27d,'master_shop':_0x349133,'unit':_0xb0107c,'language':_0x2777af});}catch(_0x18cba0){console[_0x31defc(0x234)](_0x18cba0);}}),router['post'](a0_0x173813(0x1fe),auth,async(_0x2a1e9f,_0x58d51b)=>{var _0x446aca=a0_0x173813;try{const _0x5aa397=_0x2a1e9f[_0x446aca(0x249)]['id'],_0x47d7c3=await sales[_0x446aca(0x219)]({'_id':_0x2a1e9f[_0x446aca(0x249)]['id']}),_0x45e997=await warehouse[_0x446aca(0x219)]({'name':_0x47d7c3[_0x446aca(0x194)],'room':_0x2a1e9f[_0x446aca(0x207)]['room']}),{invoice:_0x1fb70f,date:_0xa786f,warehouse_name:_0x24a6a9,product_name:_0x4474bc,stock:_0x21df21,quantity:_0xdd11f1,note:_0x3baf5d,room:_0x50a667,customer:_0x4361a1,SCRN:_0x33480a}=_0x2a1e9f[_0x446aca(0x207)];if(typeof _0x4474bc==_0x446aca(0x291))var _0x1bc3ba=[_0x2a1e9f[_0x446aca(0x207)]['product_name']],_0x459821=[_0x2a1e9f[_0x446aca(0x207)]['stock']],_0x358f19=[_0x2a1e9f['body']['carton']],_0x483708=[_0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x25c)]],_0x253b7a=[_0x2a1e9f[_0x446aca(0x207)]['secondary_code']],_0x164eb2=[_0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x24c)]],_0x44f5b5=[_0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x243)]],_0x399a46=[_0x2a1e9f[_0x446aca(0x207)]['primary_unit']],_0x5c3054=[_0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x257)]],_0x4e5302=[_0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x1a1)]],_0x4867fc=[_0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x240)]],_0x1ec101=[_0x2a1e9f[_0x446aca(0x207)]['max_per_unit']],_0x2af7d7=[_0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x27e)]],_0x5dc536=[_0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x202)]],_0x3a5d8d=[_0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x215)]],_0x165354=[_0x2a1e9f[_0x446aca(0x207)]['delivery_code']],_0x530e4c=[_0x2a1e9f[_0x446aca(0x207)]['prod_cat']],_0x54761a=[_0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x292)]],_0x4475a3=[_0x2a1e9f[_0x446aca(0x207)]['RoomAssigned']];else var _0x1bc3ba=[..._0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x1f3)]],_0x459821=[..._0x2a1e9f[_0x446aca(0x207)]['stock']],_0x358f19=[..._0x2a1e9f['body'][_0x446aca(0x28f)]],_0x483708=[..._0x2a1e9f['body']['primary_code']],_0x253b7a=[..._0x2a1e9f[_0x446aca(0x207)]['secondary_code']],_0x164eb2=[..._0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x24c)]],_0x44f5b5=[..._0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x243)]],_0x399a46=[..._0x2a1e9f['body'][_0x446aca(0x277)]],_0x5c3054=[..._0x2a1e9f['body'][_0x446aca(0x257)]],_0x4e5302=[..._0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x1a1)]],_0x4867fc=[..._0x2a1e9f[_0x446aca(0x207)]['expiry_date']],_0x1ec101=[..._0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x201)]],_0x2af7d7=[..._0x2a1e9f['body'][_0x446aca(0x27e)]],_0x5dc536=[..._0x2a1e9f[_0x446aca(0x207)]['requested_qty']],_0x3a5d8d=[..._0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x215)]],_0x165354=[..._0x2a1e9f[_0x446aca(0x207)]['delivery_code']],_0x530e4c=[..._0x2a1e9f[_0x446aca(0x207)]['prod_cat']],_0x54761a=[..._0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x292)]],_0x4475a3=[..._0x2a1e9f[_0x446aca(0x207)][_0x446aca(0x1cd)]];const _0x5324a9=_0x1bc3ba['map'](_0x33c7c0=>{return _0x33c7c0={'product_name':_0x33c7c0};});_0x459821[_0x446aca(0x265)]((_0x44e6d8,_0x32cbfb)=>{var _0x681607=_0x446aca;_0x5324a9[_0x32cbfb][_0x681607(0x256)]=Math[_0x681607(0x226)](_0x44e6d8);}),_0x358f19[_0x446aca(0x265)]((_0x261b13,_0x589934)=>{var _0x3f05f2=_0x446aca;_0x5324a9[_0x589934][_0x3f05f2(0x292)]=_0x261b13;}),_0x483708[_0x446aca(0x265)]((_0x15da42,_0x507b4a)=>{var _0x501915=_0x446aca;_0x5324a9[_0x507b4a][_0x501915(0x25c)]=_0x15da42;}),_0x253b7a[_0x446aca(0x265)]((_0x557214,_0x493cf6)=>{var _0x23210f=_0x446aca;_0x5324a9[_0x493cf6][_0x23210f(0x19c)]=_0x557214;}),_0x164eb2[_0x446aca(0x265)]((_0x57221c,_0x341659)=>{var _0x386d25=_0x446aca;_0x5324a9[_0x341659][_0x386d25(0x1f7)]=_0x57221c;}),_0x44f5b5['forEach']((_0x2e9021,_0x3e6da3)=>{var _0x1b16d1=_0x446aca;_0x4475a3[_0x1b16d1(0x265)]((_0x55b334,_0x3ceb61)=>{var _0xa61008=_0x1b16d1;if(_0x55b334==_0xa61008(0x259)&&_0x3e6da3==_0x3ceb61){var _0x55e17c=_0x2e9021['slice'](0x3);_0x5324a9[_0x3e6da3][_0xa61008(0x210)]=_0x2e9021[0x0],_0x5324a9[_0x3e6da3][_0xa61008(0x23b)]=_0x2e9021[0x1],_0x5324a9[_0x3e6da3][_0xa61008(0x242)]=0x0,_0x5324a9[_0x3e6da3]['bin']=0x0,_0x5324a9[_0x3e6da3]['type']='Floor',_0x5324a9[_0x3e6da3][_0xa61008(0x21c)]=_0x55e17c;}else{if(_0x55b334=='Shelves'&&_0x3e6da3==_0x3ceb61){var _0x55e17c=_0x2e9021[_0xa61008(0x1a6)](0x3);_0x5324a9[_0x3e6da3]['storage']=_0x2e9021[0x0],_0x5324a9[_0x3e6da3]['rack']=_0x2e9021[0x1],_0x5324a9[_0x3e6da3][_0xa61008(0x242)]=0x0,_0x5324a9[_0x3e6da3][_0xa61008(0x1b7)]=0x0,_0x5324a9[_0x3e6da3][_0xa61008(0x21d)]=_0xa61008(0x27d),_0x5324a9[_0x3e6da3][_0xa61008(0x21c)]=_0x2e9021[0x5];}else{if(_0x3e6da3==_0x3ceb61){var _0x4ee41c;if(_0x2e9021[0x4]=='L')_0x4ee41c=_0xa61008(0x198);else _0x2e9021[0x4]=='F'&&(_0x4ee41c='Floor');_0x5324a9[_0x3e6da3][_0xa61008(0x210)]=_0x2e9021[0x0],_0x5324a9[_0x3e6da3][_0xa61008(0x23b)]=_0x2e9021[0x1],_0x5324a9[_0x3e6da3][_0xa61008(0x242)]=_0x2e9021[0x2],_0x5324a9[_0x3e6da3][_0xa61008(0x1b7)]=_0x2e9021[0x3],_0x5324a9[_0x3e6da3]['type']=_0x4ee41c,_0x5324a9[_0x3e6da3][_0xa61008(0x21c)]=_0x2e9021[0x5];}}}});}),_0x399a46['forEach']((_0x39bdd1,_0x41f691)=>{var _0x5734c3=_0x446aca;_0x5324a9[_0x41f691][_0x5734c3(0x1fd)]=_0x39bdd1;}),_0x5c3054[_0x446aca(0x265)]((_0xadf881,_0x52379d)=>{var _0x5aa436=_0x446aca;_0x5324a9[_0x52379d][_0x5aa436(0x257)]=_0xadf881;}),_0x4e5302[_0x446aca(0x265)]((_0x5c2299,_0xcd82e6)=>{_0x5324a9[_0xcd82e6]['batch_code']=_0x5c2299;}),_0x4867fc['forEach']((_0x1bc2ec,_0x4bbf15)=>{_0x5324a9[_0x4bbf15]['expiry_date']=_0x1bc2ec;}),_0x1ec101[_0x446aca(0x265)]((_0x926a1b,_0x2a843c)=>{var _0x351bbd=_0x446aca;_0x5324a9[_0x2a843c][_0x351bbd(0x1eb)]=_0x926a1b;}),_0x2af7d7[_0x446aca(0x265)]((_0x5313ba,_0x568d50)=>{var _0x4f8a9e=_0x446aca;_0x5324a9[_0x568d50][_0x4f8a9e(0x27e)]=_0x5313ba;}),_0x5dc536['forEach']((_0xac17bc,_0x5c1ad6)=>{var _0x97bd79=_0x446aca;_0x5324a9[_0x5c1ad6][_0x97bd79(0x202)]=Math[_0x97bd79(0x226)](_0xac17bc);}),_0x3a5d8d['forEach']((_0x4475ce,_0x205c23)=>{var _0x37bd08=_0x446aca;_0x5324a9[_0x205c23][_0x37bd08(0x215)]=_0x4475ce;}),_0x165354[_0x446aca(0x265)]((_0xea3002,_0x501fc2)=>{_0x5324a9[_0x501fc2]['delivery_code']=_0xea3002;}),_0x530e4c[_0x446aca(0x265)]((_0x30915a,_0x41a290)=>{_0x5324a9[_0x41a290]['prod_cat']=_0x30915a;}),_0x54761a[_0x446aca(0x265)]((_0x59acad,_0x3189d8)=>{var _0x117583=_0x446aca;_0x5324a9[_0x3189d8][_0x117583(0x2a1)]=_0x59acad;}),_0x4475a3[_0x446aca(0x265)]((_0x1651ab,_0x5d737b)=>{_0x5324a9[_0x5d737b]['room_name']=_0x1651ab;});var _0x32355e=0x0;_0x5324a9[_0x446aca(0x265)](_0x47ae2c=>{var _0x57cf95=_0x446aca;console['log'](_0x57cf95(0x1e2),_0x47ae2c),(parseInt(_0x47ae2c['stock'])<parseInt(_0x47ae2c['quantity'])||parseInt(_0x47ae2c[_0x57cf95(0x292)])==0x0)&&_0x32355e++;});if(_0x32355e!=0x0)return _0x2a1e9f[_0x446aca(0x247)](_0x446aca(0x1e0),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x58d51b['redirect']('back');const _0x3160f8=_0x5324a9[_0x446aca(0x1e4)](_0x2fdaa8=>_0x2fdaa8[_0x446aca(0x292)]!=='0'&&_0x2fdaa8[_0x446aca(0x292)]!=='');_0x47d7c3['invoice']=_0x1fb70f,_0x47d7c3['customer']=_0x4361a1,_0x47d7c3['date']=_0xa786f,_0x47d7c3[_0x446aca(0x194)]=_0x24a6a9,_0x47d7c3[_0x446aca(0x252)]=_0x3160f8,_0x47d7c3[_0x446aca(0x228)]=_0x3baf5d,_0x47d7c3['SCRN']=_0x33480a,_0x47d7c3[_0x446aca(0x263)]=_0x446aca(0x1d9),_0x47d7c3[_0x446aca(0x1d6)]=_0x446aca(0x1d9);const _0x127ba1=await _0x47d7c3[_0x446aca(0x20a)]();_0x2a1e9f[_0x446aca(0x247)](_0x446aca(0x227),_0x446aca(0x1ce)),_0x58d51b[_0x446aca(0x268)](_0x446aca(0x1a2));}catch(_0x160abc){console[_0x446aca(0x234)](_0x160abc);}}),router[a0_0x173813(0x1b3)](a0_0x173813(0x1fa),auth,async(_0x2b2ec8,_0x219f5a)=>{var _0x24250c=a0_0x173813;try{const _0x11dc5b=_0x2b2ec8[_0x24250c(0x249)]['id'],{invoice:_0x15ed0e,customer:_0xf6c6d7,receivable_amount:_0x44b705,received_amount:_0x429e6e}=_0x2b2ec8[_0x24250c(0x207)],_0x527dd7=await sales[_0x24250c(0x1f0)](_0x11dc5b);console[_0x24250c(0x234)](_0x527dd7);var _0x8d39a1=_0x44b705-_0x429e6e;console[_0x24250c(0x234)](_0x429e6e),_0x527dd7[_0x24250c(0x285)]=parseFloat(_0x429e6e)+parseFloat(_0x527dd7[_0x24250c(0x285)]),_0x527dd7['due_amount']=_0x8d39a1,console[_0x24250c(0x234)](_0x527dd7);const _0x11da41=await _0x527dd7[_0x24250c(0x20a)](),_0xec2b44=await c_payment_data[_0x24250c(0x219)]({'invoice':_0x15ed0e});_0xec2b44['amount']=_0x8d39a1,await _0xec2b44[_0x24250c(0x20a)]();let _0x3fe217=new Date(),_0x599153=('0'+_0x3fe217[_0x24250c(0x26e)]())[_0x24250c(0x1a6)](-0x2),_0x50d314=('0'+(_0x3fe217[_0x24250c(0x1c5)]()+0x1))[_0x24250c(0x1a6)](-0x2),_0xfa5e16=_0x3fe217[_0x24250c(0x1af)](),_0x35bf96=_0xfa5e16+'-'+_0x50d314+'-'+_0x599153;const _0x47a520=new customer_payment({'invoice':_0x15ed0e,'date':_0xfa5e16+'-'+_0x50d314+'-'+_0x599153,'customer':_0xf6c6d7,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x429e6e}),_0x27affb=await _0x47a520[_0x24250c(0x20a)]();_0x2b2ec8['flash'](_0x24250c(0x227),_0x24250c(0x1ba)),_0x219f5a[_0x24250c(0x268)]('/all_sales/view');}catch(_0x327ebe){console[_0x24250c(0x234)](_0x327ebe);}}),router[a0_0x173813(0x23c)]('/invoice/:id',auth,async(_0x3e58ce,_0x4d4a14)=>{var _0x367c26=a0_0x173813;try{const {username:_0x2fcb7b,email:_0x47b833,role:_0x27c638}=_0x3e58ce[_0x367c26(0x1c3)],_0x4fb38a=_0x3e58ce[_0x367c26(0x1c3)],_0x3d2e81=await profile[_0x367c26(0x219)]({'email':_0x4fb38a[_0x367c26(0x299)]}),_0x59b8b6=await master_shop[_0x367c26(0x1d7)]();console[_0x367c26(0x234)](_0x367c26(0x29c),_0x59b8b6);const _0x729bbd=_0x3e58ce['params']['id'],_0x58db7d=await sales[_0x367c26(0x1f0)](_0x729bbd);console[_0x367c26(0x234)](_0x58db7d);const _0x1d5e58=await customer['findOne']({'name':_0x58db7d['customer']});console[_0x367c26(0x234)](_0x1d5e58);if(_0x59b8b6[0x0][_0x367c26(0x208)]==_0x367c26(0x19b)){var _0x3e8887=users[_0x367c26(0x200)];console[_0x367c26(0x234)](_0x3e8887);}else{if(_0x59b8b6[0x0]['language']=='Hindi')var _0x3e8887=users[_0x367c26(0x1d5)];else{if(_0x59b8b6[0x0]['language']=='German')var _0x3e8887=users[_0x367c26(0x1d2)];else{if(_0x59b8b6[0x0][_0x367c26(0x208)]==_0x367c26(0x25f))var _0x3e8887=users['Spanish'];else{if(_0x59b8b6[0x0][_0x367c26(0x208)]==_0x367c26(0x1f6))var _0x3e8887=users[_0x367c26(0x1f6)];else{if(_0x59b8b6[0x0][_0x367c26(0x208)]==_0x367c26(0x21b))var _0x3e8887=users[_0x367c26(0x276)];else{if(_0x59b8b6[0x0][_0x367c26(0x208)]==_0x367c26(0x1ef))var _0x3e8887=users[_0x367c26(0x1ef)];else{if(_0x59b8b6[0x0]['language']==_0x367c26(0x1a4))var _0x3e8887=users[_0x367c26(0x28b)];}}}}}}}_0x4d4a14[_0x367c26(0x282)]('sales_invoice',{'success':_0x3e58ce[_0x367c26(0x247)](_0x367c26(0x227)),'errors':_0x3e58ce[_0x367c26(0x247)]('errors'),'role':_0x4fb38a,'profile':_0x3d2e81,'master_shop':_0x59b8b6,'customers':_0x1d5e58,'sales':_0x58db7d,'language':_0x3e8887});}catch(_0x2dd28f){console[_0x367c26(0x234)](_0x2dd28f);}}),router[a0_0x173813(0x23c)]('/view/return_sales/:id',auth,async(_0x2e8bee,_0x363fd1)=>{var _0x4d12a3=a0_0x173813;try{const {username:_0x4fe6a3,email:_0x530478,role:_0x590224}=_0x2e8bee[_0x4d12a3(0x1c3)],_0x294459=_0x2e8bee[_0x4d12a3(0x1c3)],_0x3cfbc0=await profile['findOne']({'email':_0x294459['email']}),_0x1cd879=await master_shop[_0x4d12a3(0x1d7)]();console[_0x4d12a3(0x234)]('master',_0x1cd879);const _0x2032d7=_0x2e8bee[_0x4d12a3(0x249)]['id'];console[_0x4d12a3(0x234)](_0x2032d7);const _0x4f1793=await sales[_0x4d12a3(0x1f0)](_0x2032d7);console[_0x4d12a3(0x234)](_0x4d12a3(0x1c8),_0x4f1793);const _0x3dd44b=await warehouse[_0x4d12a3(0x293)]([{'$match':{'name':'Return\x20Goods','room':_0x4d12a3(0x28c)}},{'$unwind':_0x4d12a3(0x286)},{'$group':{'_id':_0x4d12a3(0x246),'name':{'$first':_0x4d12a3(0x255)},'product_stock':{'$first':_0x4d12a3(0x244)},'level':{'$first':_0x4d12a3(0x288)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x4d12a3(0x1b9)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4d12a3(0x22e)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x4d12a3(0x234)](_0x4d12a3(0x272),_0x3dd44b);const _0x42176e=await product[_0x4d12a3(0x1d7)]({});warehouse_data=await warehouse[_0x4d12a3(0x293)]([{'$match':{'status':'Enabled','name':_0x4d12a3(0x21f),'warehouse_category':_0x4d12a3(0x1df)}},{'$group':{'_id':'$name','name':{'$first':_0x4d12a3(0x241)}}},{'$sort':{'name':0x1}}]);var _0x3b03d7=['Return\x20Rooms'];if(_0x1cd879[0x0]['language']=='English\x20(US)'){var _0x29a7b2=users[_0x4d12a3(0x200)];console['log'](_0x29a7b2);}else{if(_0x1cd879[0x0]['language']==_0x4d12a3(0x1d5))var _0x29a7b2=users['Hindi'];else{if(_0x1cd879[0x0]['language']==_0x4d12a3(0x1d2))var _0x29a7b2=users[_0x4d12a3(0x1d2)];else{if(_0x1cd879[0x0][_0x4d12a3(0x208)]==_0x4d12a3(0x25f))var _0x29a7b2=users[_0x4d12a3(0x25f)];else{if(_0x1cd879[0x0][_0x4d12a3(0x208)]==_0x4d12a3(0x1f6))var _0x29a7b2=users[_0x4d12a3(0x1f6)];else{if(_0x1cd879[0x0][_0x4d12a3(0x208)]=='Portuguese\x20(BR)')var _0x29a7b2=users[_0x4d12a3(0x276)];else{if(_0x1cd879[0x0][_0x4d12a3(0x208)]=='Chinese')var _0x29a7b2=users[_0x4d12a3(0x1ef)];else{if(_0x1cd879[0x0][_0x4d12a3(0x208)]==_0x4d12a3(0x1a4))var _0x29a7b2=users[_0x4d12a3(0x28b)];}}}}}}}_0x363fd1[_0x4d12a3(0x282)](_0x4d12a3(0x1ab),{'success':_0x2e8bee[_0x4d12a3(0x247)](_0x4d12a3(0x227)),'errors':_0x2e8bee[_0x4d12a3(0x247)](_0x4d12a3(0x1e0)),'role':_0x294459,'profile':_0x3cfbc0,'user':_0x4f1793,'stock':_0x3dd44b,'master_shop':_0x1cd879,'unit':_0x42176e,'language':_0x29a7b2,'warehouses':warehouse_data,'rooms':_0x3b03d7});}catch(_0x5301fc){console[_0x4d12a3(0x234)](_0x5301fc),_0x363fd1[_0x4d12a3(0x26d)](0xc8)['json']({'message':_0x5301fc[_0x4d12a3(0x1ff)]});}}),router[a0_0x173813(0x1b3)](a0_0x173813(0x224),auth,async(_0x5eb242,_0x440495)=>{var _0x1488b6=a0_0x173813;try{const {invoice:_0x5da1ae,date:_0x1cf133,warehouse_name:_0x31da32,product_name:_0x2ddc0f,primary_code:_0x105d51,secondary_code:_0x213520,product_code:_0x40be7b,sales_quantity:_0x3a4f69,stocks:_0x6c909,return_qty:_0x24f5a9,Room_name:_0x115142,to_warehouse_name:_0x28eb40,to_Roomname:_0x1da24e,to_Room_name:_0x40ef09,note:_0x489afd,level:_0x32274b,isle:_0x4cd3a9,pallet:_0x38351f}=_0x5eb242['body'];if(typeof _0x2ddc0f=='string')var _0x4f2be3=[_0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x1f3)]],_0x255b94=[_0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x25c)]],_0x197e79=[_0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x19c)]],_0x1a28f2=[_0x5eb242['body'][_0x1488b6(0x1f7)]],_0x3c4d22=[_0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x206)]],_0x20c314=[_0x5eb242['body'][_0x1488b6(0x24f)]],_0x4ffdca=[_0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x1de)]],_0x5c400d=[_0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x242)]],_0x2225e5=[_0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x1b7)]],_0x4ff0bc=[_0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x213)]],_0x3389f9=[_0x5eb242[_0x1488b6(0x207)]['floorlevel']];else var _0x4f2be3=[..._0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x1f3)]],_0x255b94=[..._0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x25c)]],_0x197e79=[..._0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x19c)]],_0x1a28f2=[..._0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x1f7)]],_0x3c4d22=[..._0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x206)]],_0x20c314=[..._0x5eb242[_0x1488b6(0x207)]['stocks']],_0x4ffdca=[..._0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x1de)]],_0x5c400d=[..._0x5eb242[_0x1488b6(0x207)]['bay']],_0x2225e5=[..._0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x1b7)]],_0x4ff0bc=[..._0x5eb242[_0x1488b6(0x207)]['types']],_0x3389f9=[..._0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x21c)]];const _0x45b529=_0x4f2be3[_0x1488b6(0x25b)](_0x5ebaf3=>{return _0x5ebaf3={'product_name':_0x5ebaf3};});_0x255b94[_0x1488b6(0x265)]((_0x539aa3,_0x20279f)=>{_0x45b529[_0x20279f]['primary_code']=_0x539aa3;}),_0x197e79[_0x1488b6(0x265)]((_0x22a002,_0x5317f1)=>{_0x45b529[_0x5317f1]['secondary_code']=_0x22a002;}),_0x1a28f2[_0x1488b6(0x265)]((_0x3184ae,_0x1705ce)=>{_0x45b529[_0x1705ce]['product_code']=_0x3184ae;}),_0x3c4d22['forEach']((_0x204b06,_0x183cf0)=>{var _0x5485f7=_0x1488b6;_0x45b529[_0x183cf0][_0x5485f7(0x197)]=_0x204b06;}),_0x20c314[_0x1488b6(0x265)]((_0x49835e,_0x4c0b59)=>{var _0x40924c=_0x1488b6;_0x45b529[_0x4c0b59][_0x40924c(0x256)]=_0x49835e;}),_0x4ffdca['forEach']((_0x2bbd38,_0x5bb8fe)=>{_0x45b529[_0x5bb8fe]['return_qty']=_0x2bbd38;}),_0x5c400d['forEach']((_0x3de4a0,_0x190764)=>{var _0x33c608=_0x1488b6;_0x45b529[_0x190764][_0x33c608(0x242)]=_0x3de4a0;}),_0x2225e5['forEach']((_0x3d8c6c,_0x4a128a)=>{var _0x5ec74b=_0x1488b6;_0x45b529[_0x4a128a][_0x5ec74b(0x1b7)]=_0x3d8c6c;}),_0x4ff0bc[_0x1488b6(0x265)]((_0x17a6e6,_0x1b057c)=>{var _0x3cc18b=_0x1488b6;_0x45b529[_0x1b057c][_0x3cc18b(0x21d)]=_0x17a6e6;}),_0x3389f9[_0x1488b6(0x265)]((_0x2c94e8,_0x2c98ad)=>{var _0x2671d1=_0x1488b6;_0x45b529[_0x2c98ad][_0x2671d1(0x21c)]=_0x2c94e8;});var _0x593c74=0x0;_0x45b529['forEach'](_0x288023=>{var _0x374d7e=_0x1488b6;console[_0x374d7e(0x234)](_0x374d7e(0x1e2),_0x288023),(parseInt(_0x288023[_0x374d7e(0x197)])<parseInt(_0x288023['return_qty'])||parseInt(_0x288023[_0x374d7e(0x256)])<parseInt(_0x288023[_0x374d7e(0x1de)])&&parseInt(_0x288023[_0x374d7e(0x197)])>parseInt(_0x288023[_0x374d7e(0x1de)])||parseInt(_0x288023[_0x374d7e(0x1de)])==0x0)&&_0x593c74++;});if(_0x593c74!=0x0)return _0x5eb242[_0x1488b6(0x247)]('errors','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x440495[_0x1488b6(0x268)](_0x1488b6(0x267));const _0x33696a=await sales[_0x1488b6(0x219)]({'invoice':_0x5da1ae});console['log'](_0x33696a),_0x33696a[_0x1488b6(0x254)]=_0x1488b6(0x269);const _0x106d9b=await _0x33696a[_0x1488b6(0x20a)](),_0x16b8ea=new sales_return({'invoice':_0x5da1ae,'customer':_0x5eb242[_0x1488b6(0x207)]['customer'],'date':_0x1cf133,'warehouse_name':_0x31da32,'room':_0x115142,'ToWarehouse':_0x28eb40,'ToRoom':_0x40ef09,'return_sale':_0x45b529,'note':_0x489afd}),_0x5acef3=await _0x16b8ea[_0x1488b6(0x20a)]();console['log'](_0x16b8ea);const _0xc5dbf5=await sales_return[_0x1488b6(0x219)]({'invoice':_0x5da1ae}),_0x558cad=await warehouse[_0x1488b6(0x219)]({'name':_0x28eb40,'room':_0x40ef09});_0xc5dbf5['return_sale'][_0x1488b6(0x265)](_0x2c15e8=>{var _0x64c6b3=_0x1488b6,_0x23c8a5=0x0;const _0x44fb86=_0x558cad['product_details'][_0x64c6b3(0x25b)](_0x435e43=>{var _0x50bf05=_0x64c6b3;_0x435e43[_0x50bf05(0x1f3)]==_0x2c15e8[_0x50bf05(0x1f3)]&&_0x435e43[_0x50bf05(0x21c)]==_0x2c15e8[_0x50bf05(0x21c)]&&_0x435e43[_0x50bf05(0x21d)]==_0x2c15e8[_0x50bf05(0x21d)]&&_0x435e43['bin']==_0x2c15e8[_0x50bf05(0x1b7)]&&_0x435e43['bay']==_0x2c15e8[_0x50bf05(0x242)]&&(_0x435e43['product_stock']=parseInt(_0x435e43[_0x50bf05(0x236)])+parseInt(_0x2c15e8[_0x50bf05(0x1de)]),_0x23c8a5++);});_0x23c8a5=='0'&&(_0x558cad['product_details']=_0x558cad[_0x64c6b3(0x251)]['concat']({'product_name':_0x2c15e8[_0x64c6b3(0x1f3)],'product_stock':_0x2c15e8[_0x64c6b3(0x1de)],'primary_code':_0x2c15e8[_0x64c6b3(0x25c)],'secondary_code':_0x2c15e8['secondary_code'],'product_code':_0x2c15e8['product_code'],'bay':_0x2c15e8[_0x64c6b3(0x242)],'bin':_0x2c15e8[_0x64c6b3(0x1b7)],'type':_0x2c15e8[_0x64c6b3(0x21d)],'floorlevel':_0x2c15e8[_0x64c6b3(0x21c)]})),console[_0x64c6b3(0x234)](_0x64c6b3(0x1bc),_0x558cad);}),await _0x558cad[_0x1488b6(0x20a)](),console[_0x1488b6(0x234)](_0x5eb242[_0x1488b6(0x207)]);const _0x29598b=new c_payment_data({'invoice':_0x5da1ae,'customer':_0x5eb242[_0x1488b6(0x207)][_0x1488b6(0x223)],'reason':_0x1488b6(0x27a)});await _0x29598b[_0x1488b6(0x20a)]();const _0x292191=await master_shop[_0x1488b6(0x1d7)]();console[_0x1488b6(0x234)](_0x1488b6(0x1cf),_0x292191[0x0]['image']);const _0x21fdb4=await email_settings['findOne'](),_0xbfed60=await customer[_0x1488b6(0x219)]({'name':_0x5eb242[_0x1488b6(0x207)]['customer']});console['log']('customer_data',_0xbfed60);_0x292191[0x0]['currency_placement']==0x1?(right_currency=_0x292191[0x0][_0x1488b6(0x1dd)],left_currency=''):(right_currency='',left_currency=_0x292191[0x0]['currency']);var _0x4c6bee=_0x4f2be3,_0x4c56a1=_0x4ffdca,_0x14276d='',_0x48e9ea;for(_0x48e9ea in _0x4c6bee){_0x14276d+=_0x1488b6(0x1c9)+_0x1488b6(0x19d)+_0x4c6bee[_0x48e9ea]+_0x1488b6(0x1c2)+_0x1488b6(0x19d)+_0x4c56a1[_0x48e9ea]+'</td>'+_0x1488b6(0x1a0);}console[_0x1488b6(0x234)]('product_list',_0x14276d);let _0x40cfb7=nodemailer[_0x1488b6(0x27c)]({'service':'gmail','auth':{'user':_0x21fdb4[_0x1488b6(0x299)],'pass':_0x21fdb4[_0x1488b6(0x230)]}}),_0x3977b7={'from':_0x21fdb4[_0x1488b6(0x299)],'to':_0xbfed60[_0x1488b6(0x299)],'subject':_0x1488b6(0x1e5),'attachments':[{'filename':_0x1488b6(0x1ec),'path':__dirname+_0x1488b6(0x1c1)+_0x1488b6(0x23a)+_0x292191[0x0]['image'],'cid':_0x1488b6(0x1ae)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x1488b6(0x29b)+_0x1488b6(0x1da)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1488b6(0x1da)+_0x1488b6(0x270)+_0x1488b6(0x239)+_0x1488b6(0x1da)+_0x1488b6(0x19a)+_0x292191[0x0][_0x1488b6(0x21a)]+_0x1488b6(0x1d4)+_0x1488b6(0x239)+_0x1488b6(0x239)+_0x1488b6(0x237)+'<div>'+_0x1488b6(0x1c6)+'\x20Order\x20Number\x20:\x20'+_0x5da1ae+'\x20'+_0x1488b6(0x199)+'\x20Order\x20Date\x20:\x20'+_0x1cf133+'\x20'+_0x1488b6(0x212)+_0x1488b6(0x298)+_0x1488b6(0x239)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1488b6(0x1c9)+_0x1488b6(0x235)+_0x1488b6(0x209)+_0x1488b6(0x289)+_0x1488b6(0x211)+_0x1488b6(0x1a0)+'</thead>'+_0x1488b6(0x280)+'\x20'+_0x14276d+'\x20'+_0x1488b6(0x29e)+'</table>'+_0x1488b6(0x1da)+_0x1488b6(0x1b5)+_0x1488b6(0x1ee)+_0x292191[0x0][_0x1488b6(0x21a)]+_0x1488b6(0x298)+_0x1488b6(0x239)+'</div>'+_0x1488b6(0x203)};_0x40cfb7['sendMail'](_0x3977b7,function(_0x2b8d64,_0x15043e){var _0x3a4b87=_0x1488b6;_0x2b8d64?(console['log'](_0x2b8d64),console['log'](_0x3a4b87(0x294))):console[_0x3a4b87(0x234)]('Email\x20sent\x20successfully');}),_0x5eb242['flash'](_0x1488b6(0x227),_0x1488b6(0x1b6)),_0x440495[_0x1488b6(0x268)]('/all_sales/view');}catch(_0x2fb0f0){console[_0x1488b6(0x234)](_0x2fb0f0),_0x440495['status'](0xc8)[_0x1488b6(0x1e7)]({'message1':_0x2fb0f0['message']});}}),router[a0_0x173813(0x23c)](a0_0x173813(0x1c7),auth,async(_0x26f1dd,_0x5d59a6)=>{var _0x3a3507=a0_0x173813;try{const {username:_0x11c4c5,email:_0x485fb9,role:_0x302de1}=_0x26f1dd[_0x3a3507(0x1c3)],_0x351da5=_0x26f1dd[_0x3a3507(0x1c3)],_0x1d5de1=await profile[_0x3a3507(0x219)]({'email':_0x351da5['email']}),_0x104fee=await master_shop[_0x3a3507(0x1d7)]();console['log'](_0x3a3507(0x1be),_0x104fee);const _0x361df8=_0x26f1dd[_0x3a3507(0x249)]['id'],_0x1f0ffd=await sales['findById'](_0x361df8);console['log'](_0x3a3507(0x1c4),_0x1f0ffd);if(_0x104fee[0x0][_0x3a3507(0x208)]==_0x3a3507(0x19b))var _0x11b660=users['English'];else{if(_0x104fee[0x0][_0x3a3507(0x208)]==_0x3a3507(0x1d5))var _0x11b660=users[_0x3a3507(0x1d5)];else{if(_0x104fee[0x0][_0x3a3507(0x208)]==_0x3a3507(0x1d2))var _0x11b660=users[_0x3a3507(0x1d2)];else{if(_0x104fee[0x0]['language']==_0x3a3507(0x25f))var _0x11b660=users['Spanish'];else{if(_0x104fee[0x0]['language']==_0x3a3507(0x1f6))var _0x11b660=users['French'];else{if(_0x104fee[0x0][_0x3a3507(0x208)]==_0x3a3507(0x21b))var _0x11b660=users[_0x3a3507(0x276)];else{if(_0x104fee[0x0]['language']=='Chinese')var _0x11b660=users[_0x3a3507(0x1ef)];else{if(_0x104fee[0x0]['language']==_0x3a3507(0x1a4))var _0x11b660=users[_0x3a3507(0x28b)];}}}}}}}_0x5d59a6[_0x3a3507(0x282)](_0x3a3507(0x1f9),{'success':_0x26f1dd[_0x3a3507(0x247)](_0x3a3507(0x227)),'errors':_0x26f1dd[_0x3a3507(0x247)]('errors'),'role':_0x351da5,'profile':_0x1d5de1,'alldata':_0x1f0ffd,'master_shop':_0x104fee,'language':_0x11b660});}catch(_0x519f06){console[_0x3a3507(0x234)](_0x519f06);}}),router[a0_0x173813(0x1b3)](a0_0x173813(0x20c),async(_0x5df161,_0x334d92)=>{var _0x1bd04b=a0_0x173813;const {product_code:_0x5c1136,warehouse_name:_0x1faf22,rooms_data:_0x2acf40,Roomslist:_0x26edf6}=_0x5df161[_0x1bd04b(0x207)],_0x2bc55d=_0x26edf6[_0x1bd04b(0x2a0)](','),_0x30de40=[];async function _0x5b10f3(_0x5e420f){var _0x2d1cca=_0x1bd04b;const _0x21a59c=await warehouse[_0x2d1cca(0x293)]([{'$match':{'name':_0x1faf22,'room':_0x5e420f}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x5c1136}},{'$group':{'_id':_0x2d1cca(0x246),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2d1cca(0x244)},'primary_code':{'$first':_0x2d1cca(0x22a)},'secondary_code':{'$first':_0x2d1cca(0x22e)},'product_code':{'$first':_0x2d1cca(0x195)},'level':{'$first':_0x2d1cca(0x271)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2d1cca(0x1b8)},'unit':{'$first':_0x2d1cca(0x258)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2d1cca(0x29f)},'expiry_date':{'$first':_0x2d1cca(0x261)},'production_date':{'$first':_0x2d1cca(0x19e)},'maxPerUnit':{'$first':_0x2d1cca(0x214)},'batch_code':{'$first':_0x2d1cca(0x264)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2d1cca(0x222)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x2d1cca(0x20f)},'actual_uom':{'$first':_0x2d1cca(0x24a)}}}]),_0x6f90d4=await warehouse[_0x2d1cca(0x293)]([{'$match':{'name':_0x1faf22,'room':_0x5e420f}},{'$unwind':_0x2d1cca(0x286)},{'$match':{'product_details.secondary_code':_0x5c1136}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2d1cca(0x244)},'primary_code':{'$first':_0x2d1cca(0x22a)},'secondary_code':{'$first':_0x2d1cca(0x22e)},'product_code':{'$first':_0x2d1cca(0x195)},'level':{'$first':_0x2d1cca(0x271)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2d1cca(0x23e)},'storage':{'$first':_0x2d1cca(0x26b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2d1cca(0x261)},'production_date':{'$first':_0x2d1cca(0x19e)},'maxPerUnit':{'$first':_0x2d1cca(0x214)},'batch_code':{'$first':_0x2d1cca(0x264)},'product_cat':{'$first':_0x2d1cca(0x1b2)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2d1cca(0x222)},'invoice':{'$first':_0x2d1cca(0x273)}}}]);if(_0x21a59c[_0x2d1cca(0x20e)]>0x0)_0x30de40[_0x2d1cca(0x1d1)](_0x21a59c);else _0x6f90d4[_0x2d1cca(0x20e)]>0x0&&_0x30de40[_0x2d1cca(0x1d1)](_0x6f90d4);}const _0x37263d=_0x2bc55d[_0x1bd04b(0x25b)](_0x3af6f8=>_0x5b10f3(_0x3af6f8));await Promise[_0x1bd04b(0x290)](_0x37263d),_0x334d92[_0x1bd04b(0x1e7)](_0x30de40);}),module[a0_0x173813(0x204)]=router;