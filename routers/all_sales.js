function a0_0x4ed9(){var _0x721719=['batch_code','currency_placement','product_name','getFullYear','date','$product.product_name','Sales\x20Add\x20successfully','errors','5fzVuIi','findOne','$room','delivery_date','English\x20(US)','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','warehouse','map','$product_details','primary_unit','then','Shelves','barcode\x20user_id','/view','return_sale','$product_details.primary_code','language','flash','findById','message','due_amount','status','invoice','sales\x20item\x20return\x20successfull','Raw\x20Materials','customer','role','createTransport','sales_quantity','English','redirect','prod_invoice','Router','Arabic','sale_qty','type','\x20Order\x20Number\x20:\x20','<hr\x20class=\x22my-3\x22>','Received\x20Payment\x20For\x20Sale','$product_details.floorlevel','</tbody>','toString','production_date','id_transaction_from','</div>','French','expiry_date','save','<table\x20style=\x22width:\x20100%\x20!important;\x22>','stock_data','</thead>','logo','<div>','sale_product','image','<h2>\x20','Enabled','$product_details.actual_uom','German','quantity','$product_details.rack','$return_data','$product_details.actual_qty','warehouse_name','quantity_notConverted','$invoice','_id','<strong>\x20Regards\x20</strong>','\x20</h2>','/view/add_sales','/view/:id','</span>','$product_details.expiry_date','return_qty','$warehouse_name','/invoice/:id','product_code','barcode\x20Product\x20master','/view/return_sales/:id','$product','types','/barcode/:id','secondary_unit','level','express','id_transact','abs','<h5>','True','</head><body>','primary_code','<span\x20style=\x22float:\x20right;\x22>','$isAllowEdit','floorlevel','Sales\x20Update\x20successfully','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','maxperunit','unit','114XPBpof','product_list','received_amount','$sale_product.quantity','$product_details.secondary_unit','453047iLtcGe','8690800taPEBh','Hindi','$product_details.type','$product_details._id','$product_details.product_stock','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</td>','$product_details.pallet','get','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','1448230VbRQtL','edit_sales_view','/barcode_scanner','10fqwNOS','room','$product_details.bin','Floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$sale_product','$finalize','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/view/add_sales/:id','find','forEach','name','customer_data','Level','/../public','$sale_product.floorlevel','requested_qty','Chinese','/all_sales/preview/','user_id','site_title','actual_uom','<h5\x20style=\x22text-align:\x20left;\x22>','<html><head><title></title>','$product_details.secondary_code','add_sales','624rbFCfX','filter','master','$product_details.product_code','back','$product_details.batch_code','Enclosed','stock','789932ShHmqn','Sales\x20Mail','$customer','rack','$product_details.maxPerUnit','$name','$note','$product_details.production_date','actual_qty','secondary_code','delivery_code','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','staff','/preview/:id','length','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Sale\x20Return\x20Mail','render','product_details','padStart','log','payment\x20successfull','customers_docs','floor','Spanish','$product_details.unit','slice','$_id','An\x20error\x20occurred\x20while\x20saving\x20data.','$sale_product.bay','sales\x20all_data','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$sale_product.type','RoomAssigned','all','customers','random','$product_details.level','stocks','Receiving\x20Area','body','5846409bAfKwD','$sale_product.bin','carton','isAllowEdit','params','/give_payment/:id','Return\x20Goods','catch','max','<!DOCTYPE\x20html>','prod_cat','False','all_sales_barcode','email','edit_sales','json','923068CAZiRL','push','51567vGFYrH','</h5>','OUT-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','host','add\x20post','Portuguese','sendMail','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.isle','storage','foreach\x20newproduct','getDate','max_per_unit','currency','$product_details.invoice','exports','finalize','Arabic\x20(ae)','user','Portuguese\x20(BR)','$product_details.product_cat','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','bin','all_sales','$product_details.bay','<tr>','</tr>','sales_invoice','room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','bay','/all_sales/view','string','aggregate','product_stock','\x20Order\x20Date\x20:\x20','</table>','44ZuQnFm','/upload/','SCRN','Return\x20Rooms','nodemailer','../public/language/languages.json','Email\x20sent\x20successfully','$product_details.storage','$customers_docs','$date','Sale\x20Return','return_data','post','$product_details.product_name','prod_code','error','amount'];a0_0x4ed9=function(){return _0x721719;};return a0_0x4ed9();}var a0_0x47fe1e=a0_0x399e;function a0_0x399e(_0xca9751,_0x5dd737){var _0x4ed922=a0_0x4ed9();return a0_0x399e=function(_0x399e70,_0x3cdf4f){_0x399e70=_0x399e70-0x1d6;var _0x259c86=_0x4ed922[_0x399e70];return _0x259c86;},a0_0x399e(_0xca9751,_0x5dd737);}(function(_0xac5770,_0x4db1af){var _0x27808c=a0_0x399e,_0x493069=_0xac5770();while(!![]){try{var _0x1f338d=parseInt(_0x27808c(0x248))/0x1+-parseInt(_0x27808c(0x2cf))/0x2*(-parseInt(_0x27808c(0x2a9))/0x3)+-parseInt(_0x27808c(0x2a7))/0x4*(parseInt(_0x27808c(0x2e8))/0x5)+-parseInt(_0x27808c(0x237))/0x6*(-parseInt(_0x27808c(0x23c))/0x7)+parseInt(_0x27808c(0x23d))/0x8+parseInt(_0x27808c(0x297))/0x9*(parseInt(_0x27808c(0x24b))/0xa)+parseInt(_0x27808c(0x26d))/0xb*(-parseInt(_0x27808c(0x265))/0xc);if(_0x1f338d===_0x4db1af)break;else _0x493069['push'](_0x493069['shift']());}catch(_0x5d22ac){_0x493069['push'](_0x493069['shift']());}}}(a0_0x4ed9,0xc9ea7));const express=require(a0_0x47fe1e(0x229)),app=express(),router=express[a0_0x47fe1e(0x1f5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x47fe1e(0x2d3)),users=require(a0_0x47fe1e(0x2d4));router[a0_0x47fe1e(0x245)](a0_0x47fe1e(0x1e2),auth,async(_0x268115,_0x4b6c38)=>{var _0x8165eb=a0_0x47fe1e;try{const {username:_0x3fb304,email:_0x33020f,role:_0x1b24c0}=_0x268115[_0x8165eb(0x2bc)],_0x2af959=_0x268115[_0x8165eb(0x2bc)],_0x294be6=await profile[_0x8165eb(0x1d6)]({'email':_0x2af959[_0x8165eb(0x2a4)]}),_0x3e00d5=await master_shop[_0x8165eb(0x254)]();let _0x4c94b0;if(_0x2af959[_0x8165eb(0x1ef)]==_0x8165eb(0x279)){const _0x51fd2f=await staff[_0x8165eb(0x1d6)]({'email':_0x2af959['email']});_0x4c94b0=await sales[_0x8165eb(0x2cb)]([{'$lookup':{'from':_0x8165eb(0x291),'localField':_0x8165eb(0x1ee),'foreignField':_0x8165eb(0x256),'as':_0x8165eb(0x283)}},{'$unwind':'$customers_docs'},{'$unwind':_0x8165eb(0x250)},{'$group':{'_id':_0x8165eb(0x288),'invoice':{'$first':_0x8165eb(0x216)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x8165eb(0x250)},'note':{'$first':_0x8165eb(0x273)},'return_data':{'$first':_0x8165eb(0x212)},'customers_docs':{'$first':_0x8165eb(0x2d7)},'total_saleproduct_quantity':{'$sum':_0x8165eb(0x23a)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x8165eb(0x28e)},'pallet':{'$addToSet':_0x8165eb(0x25a)},'finalize':{'$first':_0x8165eb(0x251)},'isAllowEdit':{'$first':_0x8165eb(0x231)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x4c94b0=await sales[_0x8165eb(0x2cb)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x8165eb(0x256),'as':'customers_docs'}},{'$unwind':_0x8165eb(0x2d7)},{'$unwind':_0x8165eb(0x250)},{'$group':{'_id':_0x8165eb(0x288),'invoice':{'$first':_0x8165eb(0x216)},'customers':{'$first':_0x8165eb(0x26f)},'date':{'$first':_0x8165eb(0x2d8)},'warehouse_name':{'$first':_0x8165eb(0x21f)},'sale_product':{'$push':_0x8165eb(0x250)},'note':{'$first':_0x8165eb(0x273)},'return_data':{'$first':_0x8165eb(0x212)},'customers_docs':{'$first':_0x8165eb(0x2d7)},'total_saleproduct_quantity':{'$sum':_0x8165eb(0x23a)},'level':{'$addToSet':_0x8165eb(0x28a)},'isle':{'$addToSet':_0x8165eb(0x298)},'type':{'$addToSet':_0x8165eb(0x28e)},'pallet':{'$addToSet':_0x8165eb(0x25a)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x8165eb(0x281)](_0x8165eb(0x28b),_0x4c94b0);if(_0x3e00d5[0x0]['language']==_0x8165eb(0x1d9)){var _0x10e487=users[_0x8165eb(0x1f2)];console[_0x8165eb(0x281)](_0x10e487);}else{if(_0x3e00d5[0x0][_0x8165eb(0x1e5)]=='Hindi')var _0x10e487=users[_0x8165eb(0x23e)];else{if(_0x3e00d5[0x0][_0x8165eb(0x1e5)]==_0x8165eb(0x20f))var _0x10e487=users['German'];else{if(_0x3e00d5[0x0][_0x8165eb(0x1e5)]=='Spanish')var _0x10e487=users[_0x8165eb(0x285)];else{if(_0x3e00d5[0x0][_0x8165eb(0x1e5)]==_0x8165eb(0x202))var _0x10e487=users['French'];else{if(_0x3e00d5[0x0][_0x8165eb(0x1e5)]=='Portuguese\x20(BR)')var _0x10e487=users['Portuguese'];else{if(_0x3e00d5[0x0][_0x8165eb(0x1e5)]==_0x8165eb(0x25c))var _0x10e487=users['Chinese'];else{if(_0x3e00d5[0x0][_0x8165eb(0x1e5)]=='Arabic\x20(ae)')var _0x10e487=users[_0x8165eb(0x1f6)];}}}}}}}_0x4b6c38[_0x8165eb(0x27e)](_0x8165eb(0x2c1),{'success':_0x268115['flash']('success'),'errors':_0x268115[_0x8165eb(0x1e6)]('errors'),'sales':_0x4c94b0,'profile':_0x294be6,'role':_0x2af959,'master_shop':_0x3e00d5,'language':_0x10e487});}catch(_0x491583){console['log'](_0x491583);}});async function getRandom8DigitNumber(){var _0x367269=a0_0x47fe1e;const _0x21aa6c=0x989680,_0x54480e=0x5f5e0ff,_0x53d6e9=Math[_0x367269(0x284)](Math[_0x367269(0x292)]()*(_0x54480e-_0x21aa6c+0x1))+_0x21aa6c;var _0x31bd7f;const _0x4ce38b=await sales['findOne']({'invoice':_0x367269(0x2ab)+_0x53d6e9});return _0x4ce38b&&_0x4ce38b['length']>0x0?_0x31bd7f=_0x367269(0x2ab)+_0x53d6e9:_0x31bd7f='OUT-'+_0x53d6e9,_0x31bd7f;}router[a0_0x47fe1e(0x245)](a0_0x47fe1e(0x21a),auth,async(_0x163a58,_0x403c1c)=>{var _0x3d8075=a0_0x47fe1e;try{const {username:_0x106abe,email:_0x350211,role:_0xe25c75}=_0x163a58['user'],_0x5d55c4=_0x163a58[_0x3d8075(0x2bc)],_0x4866b2=await profile[_0x3d8075(0x1d6)]({'email':_0x5d55c4[_0x3d8075(0x2a4)]}),_0x455ff0=await master_shop[_0x3d8075(0x254)](),_0x5eafdf=await customer['find']({});let _0x3aa532;if(_0x5d55c4[_0x3d8075(0x1ef)]==_0x3d8075(0x279)){const _0x2c6cc8=await staff['findOne']({'email':_0x5d55c4['email']});_0x3aa532=await warehouse[_0x3d8075(0x2cb)]([{'$match':{'status':_0x3d8075(0x20d),'name':_0x2c6cc8[_0x3d8075(0x1db)],'warehouse_category':_0x3d8075(0x1ed),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x3d8075(0x272),'name':{'$first':_0x3d8075(0x272)}}},{'$sort':{'name':0x1}}]);}else _0x3aa532=await warehouse[_0x3d8075(0x2cb)]([{'$match':{'status':_0x3d8075(0x20d),'warehouse_category':_0x3d8075(0x1ed),'name':{'$ne':_0x3d8075(0x29d)}}},{'$group':{'_id':'$name','name':{'$first':_0x3d8075(0x272)}}},{'$sort':{'name':0x1}}]);const _0x521100=await product['find']({});var _0x1f7642=['Ambient',_0x3d8075(0x26b)];const _0x486d68=await sales[_0x3d8075(0x254)]({}),_0x27a724=_0x486d68['length']+0x1,_0x4c19ee='OUT-'+_0x27a724[_0x3d8075(0x1fe)]()[_0x3d8075(0x280)](0x5,'0');if(_0x455ff0[0x0]['language']==_0x3d8075(0x1d9)){var _0xc6e05a=users[_0x3d8075(0x1f2)];console[_0x3d8075(0x281)](_0xc6e05a);}else{if(_0x455ff0[0x0][_0x3d8075(0x1e5)]==_0x3d8075(0x23e))var _0xc6e05a=users['Hindi'];else{if(_0x455ff0[0x0][_0x3d8075(0x1e5)]==_0x3d8075(0x20f))var _0xc6e05a=users[_0x3d8075(0x20f)];else{if(_0x455ff0[0x0][_0x3d8075(0x1e5)]=='Spanish')var _0xc6e05a=users['Spanish'];else{if(_0x455ff0[0x0][_0x3d8075(0x1e5)]==_0x3d8075(0x202))var _0xc6e05a=users['French'];else{if(_0x455ff0[0x0]['language']==_0x3d8075(0x2bd))var _0xc6e05a=users[_0x3d8075(0x2af)];else{if(_0x455ff0[0x0]['language']==_0x3d8075(0x25c))var _0xc6e05a=users[_0x3d8075(0x25c)];else{if(_0x455ff0[0x0][_0x3d8075(0x1e5)]=='Arabic\x20(ae)')var _0xc6e05a=users[_0x3d8075(0x1f6)];}}}}}}}const _0x2d4d33=getRandom8DigitNumber();_0x2d4d33[_0x3d8075(0x1df)](_0x2f21ea=>{var _0x10c443=_0x3d8075;_0x403c1c['render'](_0x10c443(0x264),{'success':_0x163a58['flash'](_0x10c443(0x28c)),'errors':_0x163a58[_0x10c443(0x1e6)](_0x10c443(0x2e7)),'role':_0x5d55c4,'profile':_0x4866b2,'customer':_0x5eafdf,'warehouse':_0x3aa532,'product':_0x521100,'invoice':_0x2f21ea,'master_shop':_0x455ff0,'language':_0xc6e05a,'rooms_data':_0x1f7642});})[_0x3d8075(0x29e)](_0x5c104e=>{var _0x251a49=_0x3d8075;_0x163a58[_0x251a49(0x1e6)](_0x251a49(0x2e7),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x403c1c[_0x251a49(0x1f3)](_0x251a49(0x2c9));});}catch(_0x3c108b){console['log'](_0x3c108b);}}),router['get'](a0_0x47fe1e(0x253),auth,async(_0x55e885,_0x2deafd)=>{var _0x4a8e98=a0_0x47fe1e;try{const _0xe4a6b6=_0x55e885[_0x4a8e98(0x29b)]['id'];console[_0x4a8e98(0x281)](_0xe4a6b6);const _0xd0c6b5=await product[_0x4a8e98(0x254)](),_0x599f43=await purchases['aggregate']([{'$match':{'warehouse_name':_0xe4a6b6}},{'$unwind':_0x4a8e98(0x224)},{'$group':{'_id':_0x4a8e98(0x2e5)}}]);console['log']('purchases_data',_0x599f43),_0x2deafd['status'](0xc8)[_0x4a8e98(0x2a6)]({'purchases_data':_0x599f43,'product_data':_0xd0c6b5});}catch(_0x2f97fa){console[_0x4a8e98(0x281)](_0x2f97fa);}}),router['post']('/view/add_sale/product',auth,async(_0x5eb7d0,_0x16fa90)=>{var _0x1a07b0=a0_0x47fe1e;try{const {warehouse_data:_0x32eec8,product_data:_0x490526}=_0x5eb7d0['body'];console['log'](_0x5eb7d0[_0x1a07b0(0x296)]['product_data']);;const _0x568e13=await master_shop[_0x1a07b0(0x254)]();console[_0x1a07b0(0x281)](_0x1a07b0(0x267),_0x568e13);const _0x1feea5=await product['findOne']({'name':_0x490526});console[_0x1a07b0(0x281)]('product',_0x1feea5);const _0x5d4137=await warehouse[_0x1a07b0(0x2cb)]([{'$match':{'name':_0x32eec8}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x490526}},{'$group':{'_id':_0x1a07b0(0x2dc),'product_stock':{'$first':_0x1a07b0(0x241)}}}]);console['log'](_0x1a07b0(0x206),_0x5d4137),_0x16fa90[_0x1a07b0(0x1ea)](0xc8)[_0x1a07b0(0x2a6)]({'master':_0x568e13,'new_product':_0x1feea5,'stock_data':_0x5d4137});}catch(_0x190997){console[_0x1a07b0(0x281)](_0x190997);}}),router[a0_0x47fe1e(0x2db)](a0_0x47fe1e(0x21a),auth,async(_0x1b5181,_0x2d845a)=>{var _0x367fcc=a0_0x47fe1e;try{const {invoice:_0x4b5dfd,date:_0x451388,warehouse_name:_0x1734f3,product_name:_0x9cbc56,stock:_0x300ff1,quantity:_0x5e7c0f,note:_0x72beba,room:_0x10a010,primary_code:_0x1169e9,secondary_code:_0x2beef2,prod_code:_0x26bce1,level:_0x52613d,isle:_0x325dd7,pallet:_0x37dbbb,batch_code:_0x39e54e,SCRN:_0xb5a9f7,expiry_date:_0x2d440d}=_0x1b5181[_0x367fcc(0x296)];if(typeof _0x9cbc56=='string')var _0x6bfbf5=[_0x1b5181[_0x367fcc(0x296)]['product_name']],_0xd25f2d=[_0x1b5181['body'][_0x367fcc(0x26c)]],_0x187875=[_0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x299)]],_0x564c82=[_0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x22f)]],_0x1de2d4=[_0x1b5181[_0x367fcc(0x296)]['secondary_code']],_0x212d49=[_0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x2dd)]],_0x5a9dd5=[_0x1b5181[_0x367fcc(0x296)]['level']],_0x4503ec=[_0x1b5181[_0x367fcc(0x296)]['primary_unit']],_0x51f2cf=[_0x1b5181[_0x367fcc(0x296)]['secondary_unit']],_0xe7128b=[_0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x2e0)]],_0x3bb4b6=[_0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x203)]],_0x2e0d9c=[_0x1b5181['body']['max_per_unit']],_0x59dad0=[_0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x1ff)]],_0x4d0201=[_0x1b5181['body'][_0x367fcc(0x25b)]],_0x2bb0a0=[_0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x1d8)]],_0x504335=[_0x1b5181['body'][_0x367fcc(0x277)]],_0x968827=[_0x1b5181['body'][_0x367fcc(0x2a1)]],_0x4d51d4=[_0x1b5181[_0x367fcc(0x296)]['quantity']],_0x82c61b=[_0x1b5181[_0x367fcc(0x296)]['RoomAssigned']],_0x312152=[_0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x1f4)]],_0x3dbc5c=[_0x1b5181['body'][_0x367fcc(0x275)]],_0x4a7acc=[_0x1b5181['body'][_0x367fcc(0x260)]],_0x2284dd=[_0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x22a)]];else var _0x6bfbf5=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x2e2)]],_0xd25f2d=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x26c)]],_0x187875=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x299)]],_0x564c82=[..._0x1b5181[_0x367fcc(0x296)]['primary_code']],_0x1de2d4=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x276)]],_0x212d49=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x2dd)]],_0x5a9dd5=[..._0x1b5181['body']['level']],_0x4503ec=[..._0x1b5181[_0x367fcc(0x296)]['primary_unit']],_0x51f2cf=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x227)]],_0xe7128b=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x2e0)]],_0x3bb4b6=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x203)]],_0x2e0d9c=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x2b6)]],_0x59dad0=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x1ff)]],_0x4d0201=[..._0x1b5181['body'][_0x367fcc(0x25b)]],_0x2bb0a0=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x1d8)]],_0x504335=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x277)]],_0x968827=[..._0x1b5181[_0x367fcc(0x296)]['prod_cat']],_0x4d51d4=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x210)]],_0x82c61b=[..._0x1b5181['body']['RoomAssigned']],_0x312152=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x1f4)]],_0x3dbc5c=[..._0x1b5181['body'][_0x367fcc(0x275)]],_0x4a7acc=[..._0x1b5181['body'][_0x367fcc(0x260)]],_0x2284dd=[..._0x1b5181[_0x367fcc(0x296)][_0x367fcc(0x22a)]];const _0xce1128=_0x6bfbf5[_0x367fcc(0x1dc)](_0x1f48d3=>{return _0x1f48d3={'product_name':_0x1f48d3};});_0xd25f2d['forEach']((_0x3dcc5a,_0x117da3)=>{var _0x22a4db=_0x367fcc;_0xce1128[_0x117da3][_0x22a4db(0x26c)]=Math[_0x22a4db(0x22b)](_0x3dcc5a);}),_0x3dbc5c['forEach']((_0x2128d8,_0x579b3)=>{var _0x3d02fd=_0x367fcc;_0xce1128[_0x579b3][_0x3d02fd(0x275)]=Math['abs'](_0x2128d8);}),_0x4a7acc[_0x367fcc(0x255)]((_0x2cd463,_0x3a767a)=>{var _0x3851b9=_0x367fcc;_0xce1128[_0x3a767a][_0x3851b9(0x260)]=_0x2cd463;}),_0x2284dd[_0x367fcc(0x255)]((_0x44fe54,_0x417503)=>{var _0xf48acc=_0x367fcc;_0xce1128[_0x417503][_0xf48acc(0x200)]=_0x44fe54;}),_0x187875[_0x367fcc(0x255)]((_0x2ac647,_0x559af1)=>{var _0x3eb49e=_0x367fcc;_0xce1128[_0x559af1][_0x3eb49e(0x210)]=_0x2ac647;}),_0x564c82[_0x367fcc(0x255)]((_0x4b26f9,_0x4313cc)=>{var _0x4a7f50=_0x367fcc;_0xce1128[_0x4313cc][_0x4a7f50(0x22f)]=_0x4b26f9;}),_0x1de2d4['forEach']((_0x4baf11,_0x16f053)=>{var _0x1c626a=_0x367fcc;_0xce1128[_0x16f053][_0x1c626a(0x276)]=_0x4baf11;}),_0x212d49[_0x367fcc(0x255)]((_0x52cf04,_0x1761d7)=>{var _0x441dfc=_0x367fcc;_0xce1128[_0x1761d7][_0x441dfc(0x221)]=_0x52cf04;}),_0x5a9dd5['forEach']((_0x1d3f53,_0x1b3902)=>{_0x82c61b['forEach']((_0x5a594f,_0x504ad5)=>{var _0x2081e3=a0_0x399e;if(_0x5a594f==_0x2081e3(0x295)&&_0x1b3902==_0x504ad5){var _0x122c88=_0x1d3f53[_0x2081e3(0x287)](0x3);_0xce1128[_0x1b3902]['storage']=_0x1d3f53[0x0],_0xce1128[_0x1b3902][_0x2081e3(0x270)]=_0x1d3f53[0x1],_0xce1128[_0x1b3902][_0x2081e3(0x2c8)]=0x0,_0xce1128[_0x1b3902][_0x2081e3(0x2c0)]=0x0,_0xce1128[_0x1b3902][_0x2081e3(0x1f8)]='Floor',_0xce1128[_0x1b3902][_0x2081e3(0x232)]=_0x122c88;}else{if(_0x5a594f==_0x2081e3(0x1e0)&&_0x1b3902==_0x504ad5){var _0x122c88=_0x1d3f53[_0x2081e3(0x287)](0x3);_0xce1128[_0x1b3902]['storage']=_0x1d3f53[0x0],_0xce1128[_0x1b3902][_0x2081e3(0x270)]=_0x1d3f53[0x1],_0xce1128[_0x1b3902][_0x2081e3(0x2c8)]=0x0,_0xce1128[_0x1b3902][_0x2081e3(0x2c0)]=0x0,_0xce1128[_0x1b3902][_0x2081e3(0x1f8)]=_0x2081e3(0x24e),_0xce1128[_0x1b3902][_0x2081e3(0x232)]=_0x1d3f53[0x5];}else{if(_0x1b3902==_0x504ad5){var _0x42ef2d;if(_0x1d3f53[0x4]=='L')_0x42ef2d=_0x2081e3(0x258);else _0x1d3f53[0x4]=='F'&&(_0x42ef2d='Floor');_0xce1128[_0x1b3902][_0x2081e3(0x2b3)]=_0x1d3f53[0x0],_0xce1128[_0x1b3902][_0x2081e3(0x270)]=_0x1d3f53[0x1],_0xce1128[_0x1b3902]['bay']=_0x1d3f53[0x2],_0xce1128[_0x1b3902]['bin']=_0x1d3f53[0x3],_0xce1128[_0x1b3902]['type']=_0x42ef2d,_0xce1128[_0x1b3902][_0x2081e3(0x232)]=_0x1d3f53[0x5];}}}});}),_0x4503ec[_0x367fcc(0x255)]((_0x2ee302,_0x5eba9d)=>{var _0x32c641=_0x367fcc;_0xce1128[_0x5eba9d][_0x32c641(0x236)]=_0x2ee302;}),_0x51f2cf['forEach']((_0x5cc50a,_0x315d34)=>{var _0x5c6149=_0x367fcc;_0xce1128[_0x315d34][_0x5c6149(0x227)]=_0x5cc50a;}),_0xe7128b[_0x367fcc(0x255)]((_0x2bdc3a,_0x2fba0f)=>{_0xce1128[_0x2fba0f]['batch_code']=_0x2bdc3a;}),_0x3bb4b6[_0x367fcc(0x255)]((_0x1ac4ee,_0x53ecbb)=>{_0xce1128[_0x53ecbb]['expiry_date']=_0x1ac4ee;}),_0x2e0d9c[_0x367fcc(0x255)]((_0x3f885d,_0x338a4a)=>{_0xce1128[_0x338a4a]['maxperunit']=_0x3f885d;}),_0x59dad0['forEach']((_0x36146b,_0x570469)=>{var _0x9ad470=_0x367fcc;_0xce1128[_0x570469][_0x9ad470(0x1ff)]=_0x36146b;}),_0x4d0201[_0x367fcc(0x255)]((_0x2be3c4,_0x37a7b2)=>{var _0x272a4a=_0x367fcc;_0xce1128[_0x37a7b2][_0x272a4a(0x25b)]=_0x2be3c4;}),_0x2bb0a0[_0x367fcc(0x255)]((_0x54e6e9,_0x458b79)=>{var _0x18f9de=_0x367fcc;_0xce1128[_0x458b79][_0x18f9de(0x1d8)]=_0x54e6e9;}),_0x504335[_0x367fcc(0x255)]((_0x408abf,_0x215b03)=>{_0xce1128[_0x215b03]['delivery_code']=_0x408abf;}),_0x968827[_0x367fcc(0x255)]((_0x20734c,_0x50974e)=>{_0xce1128[_0x50974e]['prod_cat']=_0x20734c;}),_0x4d51d4[_0x367fcc(0x255)]((_0x3a697a,_0x266b2a)=>{_0xce1128[_0x266b2a]['quantity_notConverted']=_0x3a697a;}),_0x82c61b[_0x367fcc(0x255)]((_0x1ae8ee,_0x148805)=>{var _0x3d5bc0=_0x367fcc;_0xce1128[_0x148805][_0x3d5bc0(0x2c6)]=_0x1ae8ee;}),_0x312152[_0x367fcc(0x255)]((_0x372a7b,_0x8231f)=>{var _0x1a18f3=_0x367fcc;_0xce1128[_0x8231f][_0x1a18f3(0x1eb)]=_0x372a7b;});var _0x17d949=0x0;_0xce1128[_0x367fcc(0x255)](_0xe602db=>{var _0x367446=_0x367fcc;(_0xe602db['stock']<_0xe602db['quantity_notConverted']||_0xe602db[_0x367446(0x215)]==0x0)&&(console['log'](_0x367446(0x2b4),_0xe602db),_0x17d949++);});const _0x39084e=_0xce1128[_0x367fcc(0x266)](_0x478d6d=>_0x478d6d['quantity']!=='0'&&_0x478d6d[_0x367fcc(0x210)]!==''),_0x2249d6=new sales({'invoice':_0x4b5dfd,'customer':_0x1b5181['body'][_0x367fcc(0x1ee)],'date':_0x451388,'warehouse_name':_0x1734f3,'sale_product':_0x39084e,'note':_0x72beba,'room':_0x10a010,'primary_code':_0x1169e9,'secondary_code':_0x2beef2,'prod_code':_0x26bce1,'SCRN':_0xb5a9f7}),_0x40ded8=await _0x2249d6[_0x367fcc(0x204)]();_0x1b5181[_0x367fcc(0x1e6)](_0x367fcc(0x28c),_0x367fcc(0x2e6)),_0x2d845a['redirect'](_0x367fcc(0x25d)+_0x40ded8[_0x367fcc(0x217)]);}catch(_0x54fab9){console[_0x367fcc(0x281)](_0x54fab9);}}),router[a0_0x47fe1e(0x245)](a0_0x47fe1e(0x27a),auth,async(_0x11ab96,_0x247160)=>{var _0x9ecb95=a0_0x47fe1e;try{const {username:_0x35b1df,email:_0x3a6a1e,role:_0xee5fc2}=_0x11ab96[_0x9ecb95(0x2bc)],_0x30103c=_0x11ab96[_0x9ecb95(0x2bc)],_0x28bc48=await profile[_0x9ecb95(0x1d6)]({'email':_0x30103c[_0x9ecb95(0x2a4)]}),_0x2ea2ff=await master_shop[_0x9ecb95(0x254)](),_0x658134=_0x11ab96['params']['id'],_0x49f7ef=await sales[_0x9ecb95(0x1e7)](_0x658134),_0x19bddc=await warehouse['aggregate']([{'$match':{'name':_0x49f7ef[_0x9ecb95(0x214)]}},{'$unwind':_0x9ecb95(0x1dd)},{'$group':{'_id':_0x9ecb95(0x240),'name':{'$first':_0x9ecb95(0x2dc)},'product_stock':{'$first':_0x9ecb95(0x241)},'bay':{'$first':_0x9ecb95(0x2c2)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x9ecb95(0x23f)},'floorlevel':{'$first':_0x9ecb95(0x1fc)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x9ecb95(0x263)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x9ecb95(0x2d6)},'rack':{'$first':_0x9ecb95(0x211)},'expiry_date':{'$first':_0x9ecb95(0x21d)},'production_date':{'$first':_0x9ecb95(0x274)},'invoice':{'$first':_0x9ecb95(0x2b8)}}}]),_0x34eded=await customer[_0x9ecb95(0x254)]({});let _0x1c152c;if(_0x30103c[_0x9ecb95(0x1ef)]==_0x9ecb95(0x279)){const _0x5197e1=await staff[_0x9ecb95(0x1d6)]({'email':_0x30103c[_0x9ecb95(0x2a4)]});_0x1c152c=await warehouse[_0x9ecb95(0x2cb)]([{'$match':{'status':'Enabled','name':_0x5197e1[_0x9ecb95(0x1db)]}},{'$group':{'_id':'$name','name':{'$first':_0x9ecb95(0x272)}}}]);}else _0x1c152c=await warehouse['aggregate']([{'$match':{'status':_0x9ecb95(0x20d)}},{'$group':{'_id':_0x9ecb95(0x272),'name':{'$first':'$name'}}}]);const _0x51c4bb=await product[_0x9ecb95(0x254)]({}),_0x145b0b=await suppliers[_0x9ecb95(0x254)]({});if(_0x2ea2ff[0x0][_0x9ecb95(0x1e5)]==_0x9ecb95(0x1d9)){var _0x2f08ff=users[_0x9ecb95(0x1f2)];console[_0x9ecb95(0x281)](_0x2f08ff);}else{if(_0x2ea2ff[0x0][_0x9ecb95(0x1e5)]==_0x9ecb95(0x23e))var _0x2f08ff=users[_0x9ecb95(0x23e)];else{if(_0x2ea2ff[0x0]['language']=='German')var _0x2f08ff=users[_0x9ecb95(0x20f)];else{if(_0x2ea2ff[0x0][_0x9ecb95(0x1e5)]==_0x9ecb95(0x285))var _0x2f08ff=users[_0x9ecb95(0x285)];else{if(_0x2ea2ff[0x0][_0x9ecb95(0x1e5)]==_0x9ecb95(0x202))var _0x2f08ff=users['French'];else{if(_0x2ea2ff[0x0][_0x9ecb95(0x1e5)]==_0x9ecb95(0x2bd))var _0x2f08ff=users[_0x9ecb95(0x2af)];else{if(_0x2ea2ff[0x0][_0x9ecb95(0x1e5)]==_0x9ecb95(0x25c))var _0x2f08ff=users[_0x9ecb95(0x25c)];else{if(_0x2ea2ff[0x0]['language']==_0x9ecb95(0x2bb))var _0x2f08ff=users[_0x9ecb95(0x1f6)];}}}}}}}_0x247160[_0x9ecb95(0x27e)](_0x9ecb95(0x249),{'success':_0x11ab96[_0x9ecb95(0x1e6)](_0x9ecb95(0x28c)),'errors':_0x11ab96[_0x9ecb95(0x1e6)](_0x9ecb95(0x2e7)),'role':_0x30103c,'profile':_0x28bc48,'customer':_0x34eded,'warehouse':_0x1c152c,'product':_0x19bddc,'user':_0x49f7ef,'master_shop':_0x2ea2ff,'unit':_0x51c4bb,'language':_0x2f08ff,'suppliers':_0x145b0b});}catch(_0x29730f){console[_0x9ecb95(0x281)](_0x29730f);}}),router[a0_0x47fe1e(0x2db)]('/preview/:id',auth,async(_0x26aa78,_0x4431ba)=>{var _0x377763=a0_0x47fe1e;try{const _0xde66ff=_0x26aa78['params']['id'],{invoice:_0x3b6a97,warehouse_name:_0x30654b,room:_0x2596e1}=_0x26aa78[_0x377763(0x296)],_0x5bbc77=await sales[_0x377763(0x1d6)]({'invoice':_0x3b6a97}),_0xd4a24e=_0x5bbc77['sale_product'][_0x377763(0x1dc)](async _0xfeea22=>{var _0x286f19=_0x377763,_0x33ddd2=await warehouse[_0x286f19(0x1d6)]({'name':_0x30654b,'room':_0xfeea22[_0x286f19(0x2c6)],'warehouse_category':_0x286f19(0x1ed)});const _0x37b7c0=_0x33ddd2[_0x286f19(0x27f)][_0x286f19(0x1dc)](_0x321a45=>{var _0x154c78=_0x286f19;_0x321a45[_0x154c78(0x2e2)]==_0xfeea22[_0x154c78(0x2e2)]&&_0x321a45[_0x154c78(0x232)]==_0xfeea22[_0x154c78(0x232)]&&_0x321a45['type']==_0xfeea22[_0x154c78(0x1f8)]&&_0x321a45[_0x154c78(0x2c0)]==_0xfeea22['bin']&&_0x321a45['bay']==_0xfeea22[_0x154c78(0x2c8)]&&_0x321a45['rack']==_0xfeea22[_0x154c78(0x270)]&&_0x321a45[_0x154c78(0x2b3)]==_0xfeea22[_0x154c78(0x2b3)]&&_0x321a45[_0x154c78(0x203)]==_0xfeea22['expiry_date']&&_0x321a45[_0x154c78(0x2e0)]==_0xfeea22[_0x154c78(0x2e0)]&&_0x321a45[_0x154c78(0x1eb)]==_0xfeea22[_0x154c78(0x1eb)]&&_0x321a45[_0x154c78(0x217)]==_0xfeea22[_0x154c78(0x200)]&&(_0x321a45[_0x154c78(0x2cc)]=Math[_0x154c78(0x29f)](0x0,Math[_0x154c78(0x22b)](_0x321a45[_0x154c78(0x2cc)])-Math['abs'](_0xfeea22['quantity'])));});return _0x33ddd2;});Promise[_0x377763(0x290)](_0xd4a24e)['then'](async _0x36aee8=>{var _0xe9100a=_0x377763;try{for(const _0x2387c5 of _0x36aee8){await _0x2387c5[_0xe9100a(0x204)]();}_0x5bbc77[_0xe9100a(0x2ba)]=_0xe9100a(0x22d);const _0xb732dc=await _0x5bbc77['save'](),_0x30ff81=await master_shop[_0xe9100a(0x254)](),_0x176b0c=await email_settings[_0xe9100a(0x1d6)](),_0x4e456e=await supervisor_settings[_0xe9100a(0x254)]();var _0x178416=_0x5bbc77['sale_product'],_0x282a71='',_0x839921;for(_0x839921 in _0x178416){_0x282a71+=_0xe9100a(0x2c3)+_0xe9100a(0x1da)+_0x178416[_0x839921]['product_name']+'</td>'+_0xe9100a(0x1da)+_0x178416[_0x839921][_0xe9100a(0x221)]+_0xe9100a(0x243)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x178416[_0x839921][_0xe9100a(0x210)]+'</td>'+_0xe9100a(0x1da)+_0x178416[_0x839921][_0xe9100a(0x236)]+_0xe9100a(0x243)+_0xe9100a(0x1da)+_0x178416[_0x839921]['secondary_unit']+'</td>'+_0xe9100a(0x1da)+_0x5bbc77['warehouse_name']+'</td>'+_0xe9100a(0x1da)+_0x178416[_0x839921][_0xe9100a(0x2c6)]+_0xe9100a(0x243)+_0xe9100a(0x1da)+_0x178416[_0x839921][_0xe9100a(0x2b3)]+_0x178416[_0x839921][_0xe9100a(0x270)]+_0x178416[_0x839921]['bay']+_0x178416[_0x839921][_0xe9100a(0x2c0)]+_0x178416[_0x839921][_0xe9100a(0x1f8)][0x0]+_0x178416[_0x839921][_0xe9100a(0x232)]+_0xe9100a(0x243),_0xe9100a(0x2c4);}let _0x30b5a7=nodemailer['createTransport']({'host':_0x176b0c[_0xe9100a(0x2ad)],'port':Number(_0x176b0c['port']),'secure':![],'auth':{'user':_0x176b0c[_0xe9100a(0x2a4)],'pass':_0x176b0c[_0xe9100a(0x246)]}}),_0x53b1d2={'from':_0x176b0c[_0xe9100a(0x2a4)],'to':_0x4e456e[0x0]['RMSEmail'],'subject':_0xe9100a(0x26e),'attachments':[{'filename':'Logo.png','path':__dirname+_0xe9100a(0x259)+_0xe9100a(0x2d0)+_0x30ff81[0x0][_0xe9100a(0x20b)],'cid':'logo'}],'html':_0xe9100a(0x2a0)+'<html><head><title></title>'+_0xe9100a(0x22e)+_0xe9100a(0x209)+_0xe9100a(0x2bf)+'<div>'+_0xe9100a(0x242)+_0xe9100a(0x201)+_0xe9100a(0x209)+_0xe9100a(0x20c)+_0x30ff81[0x0][_0xe9100a(0x25f)]+_0xe9100a(0x219)+_0xe9100a(0x201)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0xe9100a(0x209)+_0xe9100a(0x261)+'\x20Order\x20Number\x20:\x20'+_0x5bbc77[_0xe9100a(0x1eb)]+'\x20'+_0xe9100a(0x230)+_0xe9100a(0x2cd)+_0x5bbc77[_0xe9100a(0x2e4)]+'\x20'+_0xe9100a(0x21c)+'</h5>'+_0xe9100a(0x201)+_0xe9100a(0x205)+_0xe9100a(0x27c)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xe9100a(0x24f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0xe9100a(0x252)+_0xe9100a(0x247)+_0xe9100a(0x2c4)+_0xe9100a(0x207)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x282a71+'\x20'+'</tbody>'+_0xe9100a(0x2ce)+_0xe9100a(0x209)+_0xe9100a(0x218)+_0xe9100a(0x22c)+_0x30ff81[0x0][_0xe9100a(0x25f)]+_0xe9100a(0x2aa)+'</div>'+_0xe9100a(0x201)+'</body></html>'};_0x30b5a7[_0xe9100a(0x2b0)](_0x53b1d2,function(_0x3545c0,_0xe3eeb6){var _0x4bf4ee=_0xe9100a;_0x3545c0?(console[_0x4bf4ee(0x281)](_0x3545c0),console[_0x4bf4ee(0x281)]('Error\x20Occurs')):console[_0x4bf4ee(0x281)](_0x4bf4ee(0x2d5));}),_0x26aa78['flash'](_0xe9100a(0x28c),'Sales\x20Update\x20successfully'),_0x4431ba['redirect']('/all_sales/preview/'+_0xde66ff);}catch(_0x41bb39){console[_0xe9100a(0x2de)](_0x41bb39),_0x4431ba[_0xe9100a(0x1ea)](0x1f4)[_0xe9100a(0x2a6)]({'error':_0xe9100a(0x289)});}})[_0x377763(0x29e)](_0x5a0341=>{var _0xd9eb40=_0x377763;console['error'](_0x5a0341),_0x4431ba[_0xd9eb40(0x1ea)](0x1f4)[_0xd9eb40(0x2a6)]({'error':'An\x20error\x20occurred.'});});}catch(_0x49229a){console[_0x377763(0x281)](_0x49229a);}}),router[a0_0x47fe1e(0x245)](a0_0x47fe1e(0x21b),auth,async(_0x1f7064,_0x186da8)=>{var _0x2823f4=a0_0x47fe1e;try{const {username:_0x59ffb8,email:_0x59cb7e,role:_0x287e51}=_0x1f7064[_0x2823f4(0x2bc)],_0x1103d5=_0x1f7064[_0x2823f4(0x2bc)],_0x38d032=await profile['findOne']({'email':_0x1103d5['email']}),_0x14c144=await master_shop[_0x2823f4(0x254)](),_0x133f4d=_0x1f7064[_0x2823f4(0x29b)]['id'],_0x36bfa8=await sales[_0x2823f4(0x1e7)](_0x133f4d);var _0x3c406d=['Ambient',_0x2823f4(0x26b)];const _0x56818e=await warehouse['aggregate']([{'$match':{'name':_0x36bfa8[_0x2823f4(0x214)],'warehouse_category':_0x2823f4(0x1ed)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2823f4(0x241)},'bay':{'$first':_0x2823f4(0x2c2)},'bin':{'$first':_0x2823f4(0x24d)},'type':{'$first':_0x2823f4(0x23f)},'floorlevel':{'$first':_0x2823f4(0x1fc)},'primary_code':{'$first':_0x2823f4(0x1e4)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2823f4(0x268)},'storage':{'$first':_0x2823f4(0x2d6)},'rack':{'$first':_0x2823f4(0x211)}}}]),_0x3410ea=await customer[_0x2823f4(0x254)]({});let _0x16c04c;if(_0x1103d5[_0x2823f4(0x1ef)]==_0x2823f4(0x279)){const _0x1d4eb7=await staff[_0x2823f4(0x1d6)]({'email':_0x1103d5['email']});_0x16c04c=await warehouse[_0x2823f4(0x2cb)]([{'$match':{'status':_0x2823f4(0x20d),'name':_0x1d4eb7[_0x2823f4(0x1db)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2823f4(0x272),'name':{'$first':_0x2823f4(0x272)}}}]);}else _0x16c04c=await warehouse[_0x2823f4(0x2cb)]([{'$match':{'status':_0x2823f4(0x20d),'warehouse_category':_0x2823f4(0x1ed)}},{'$group':{'_id':_0x2823f4(0x272),'name':{'$first':_0x2823f4(0x272)}}}]);const _0x56760d=await product[_0x2823f4(0x254)]({});if(_0x14c144[0x0]['language']==_0x2823f4(0x1d9)){var _0x56c358=users[_0x2823f4(0x1f2)];console['log'](_0x56c358);}else{if(_0x14c144[0x0][_0x2823f4(0x1e5)]==_0x2823f4(0x23e))var _0x56c358=users[_0x2823f4(0x23e)];else{if(_0x14c144[0x0][_0x2823f4(0x1e5)]=='German')var _0x56c358=users[_0x2823f4(0x20f)];else{if(_0x14c144[0x0][_0x2823f4(0x1e5)]==_0x2823f4(0x285))var _0x56c358=users[_0x2823f4(0x285)];else{if(_0x14c144[0x0]['language']==_0x2823f4(0x202))var _0x56c358=users[_0x2823f4(0x202)];else{if(_0x14c144[0x0][_0x2823f4(0x1e5)]==_0x2823f4(0x2bd))var _0x56c358=users['Portuguese'];else{if(_0x14c144[0x0]['language']==_0x2823f4(0x25c))var _0x56c358=users[_0x2823f4(0x25c)];else{if(_0x14c144[0x0]['language']==_0x2823f4(0x2bb))var _0x56c358=users['Arabic'];}}}}}}}_0x186da8[_0x2823f4(0x27e)](_0x2823f4(0x2a5),{'success':_0x1f7064['flash'](_0x2823f4(0x28c)),'errors':_0x1f7064['flash']('errors'),'role':_0x1103d5,'profile':_0x38d032,'customer':_0x3410ea,'warehouse':_0x16c04c,'product':_0x56818e,'user':_0x36bfa8,'master_shop':_0x14c144,'unit':_0x56760d,'language':_0x56c358});}catch(_0x1504b2){console['log'](_0x1504b2);}}),router[a0_0x47fe1e(0x2db)](a0_0x47fe1e(0x21b),auth,async(_0x49e7c7,_0x2a6847)=>{var _0x583e1e=a0_0x47fe1e;try{const _0x426220=_0x49e7c7[_0x583e1e(0x29b)]['id'],_0x41669f=await sales[_0x583e1e(0x1d6)]({'_id':_0x49e7c7[_0x583e1e(0x29b)]['id']}),_0x4bdf77=await warehouse[_0x583e1e(0x1d6)]({'name':_0x41669f[_0x583e1e(0x214)],'room':_0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x24c)]}),{invoice:_0x441342,date:_0x460876,warehouse_name:_0x3be10f,product_name:_0x1940b6,stock:_0x1de10d,quantity:_0x15051a,note:_0x25bb7f,room:_0x1f26a3,customer:_0x4e45a2,SCRN:_0xc812d8}=_0x49e7c7[_0x583e1e(0x296)];if(typeof _0x1940b6=='string')var _0x18a294=[_0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x2e2)]],_0x18b737=[_0x49e7c7[_0x583e1e(0x296)]['stock']],_0xc415c1=[_0x49e7c7['body'][_0x583e1e(0x299)]],_0x54781a=[_0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x22f)]],_0x29d299=[_0x49e7c7[_0x583e1e(0x296)]['secondary_code']],_0x2e894a=[_0x49e7c7[_0x583e1e(0x296)]['prod_code']],_0x481e76=[_0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x228)]],_0x5084ad=[_0x49e7c7[_0x583e1e(0x296)]['primary_unit']],_0x372e92=[_0x49e7c7['body'][_0x583e1e(0x227)]],_0x28df01=[_0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x2e0)]],_0x5c57db=[_0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x203)]],_0xb39a53=[_0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x2b6)]],_0x22fbde=[_0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x1ff)]],_0x3484da=[_0x49e7c7[_0x583e1e(0x296)]['requested_qty']],_0x359be2=[_0x49e7c7[_0x583e1e(0x296)]['delivery_date']],_0x3838a0=[_0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x277)]],_0x475858=[_0x49e7c7['body'][_0x583e1e(0x2a1)]],_0x432c9d=[_0x49e7c7[_0x583e1e(0x296)]['quantity']],_0x6724b=[_0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x28f)]];else var _0x18a294=[..._0x49e7c7['body'][_0x583e1e(0x2e2)]],_0x18b737=[..._0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x26c)]],_0xc415c1=[..._0x49e7c7[_0x583e1e(0x296)]['carton']],_0x54781a=[..._0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x22f)]],_0x29d299=[..._0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x276)]],_0x2e894a=[..._0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x2dd)]],_0x481e76=[..._0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x228)]],_0x5084ad=[..._0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x1de)]],_0x372e92=[..._0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x227)]],_0x28df01=[..._0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x2e0)]],_0x5c57db=[..._0x49e7c7['body'][_0x583e1e(0x203)]],_0xb39a53=[..._0x49e7c7['body']['max_per_unit']],_0x22fbde=[..._0x49e7c7[_0x583e1e(0x296)][_0x583e1e(0x1ff)]],_0x3484da=[..._0x49e7c7[_0x583e1e(0x296)]['requested_qty']],_0x359be2=[..._0x49e7c7[_0x583e1e(0x296)]['delivery_date']],_0x3838a0=[..._0x49e7c7['body'][_0x583e1e(0x277)]],_0x475858=[..._0x49e7c7['body']['prod_cat']],_0x432c9d=[..._0x49e7c7[_0x583e1e(0x296)]['quantity']],_0x6724b=[..._0x49e7c7['body'][_0x583e1e(0x28f)]];const _0x5d1aee=_0x18a294['map'](_0x1bf1eb=>{return _0x1bf1eb={'product_name':_0x1bf1eb};});_0x18b737[_0x583e1e(0x255)]((_0x164bda,_0x399f68)=>{var _0x4bd00e=_0x583e1e;_0x5d1aee[_0x399f68][_0x4bd00e(0x26c)]=Math[_0x4bd00e(0x22b)](_0x164bda);}),_0xc415c1[_0x583e1e(0x255)]((_0x10ebbe,_0x29bf2d)=>{_0x5d1aee[_0x29bf2d]['quantity']=_0x10ebbe;}),_0x54781a[_0x583e1e(0x255)]((_0x1e15d2,_0x3cbf47)=>{var _0x135de8=_0x583e1e;_0x5d1aee[_0x3cbf47][_0x135de8(0x22f)]=_0x1e15d2;}),_0x29d299['forEach']((_0x13effd,_0x53fa78)=>{var _0x5ebf4e=_0x583e1e;_0x5d1aee[_0x53fa78][_0x5ebf4e(0x276)]=_0x13effd;}),_0x2e894a[_0x583e1e(0x255)]((_0x2d2102,_0x3e2322)=>{var _0x131d33=_0x583e1e;_0x5d1aee[_0x3e2322][_0x131d33(0x221)]=_0x2d2102;}),_0x481e76['forEach']((_0x1a313a,_0x21af85)=>{var _0x56ff81=_0x583e1e;_0x6724b[_0x56ff81(0x255)]((_0x3390da,_0x54c695)=>{var _0x3315a0=_0x56ff81;if(_0x3390da=='Receiving\x20Area'&&_0x21af85==_0x54c695){var _0x54eb60=_0x1a313a[_0x3315a0(0x287)](0x3);_0x5d1aee[_0x21af85][_0x3315a0(0x2b3)]=_0x1a313a[0x0],_0x5d1aee[_0x21af85][_0x3315a0(0x270)]=_0x1a313a[0x1],_0x5d1aee[_0x21af85][_0x3315a0(0x2c8)]=0x0,_0x5d1aee[_0x21af85][_0x3315a0(0x2c0)]=0x0,_0x5d1aee[_0x21af85][_0x3315a0(0x1f8)]=_0x3315a0(0x24e),_0x5d1aee[_0x21af85][_0x3315a0(0x232)]=_0x54eb60;}else{if(_0x3390da==_0x3315a0(0x1e0)&&_0x21af85==_0x54c695){var _0x54eb60=_0x1a313a[_0x3315a0(0x287)](0x3);_0x5d1aee[_0x21af85][_0x3315a0(0x2b3)]=_0x1a313a[0x0],_0x5d1aee[_0x21af85][_0x3315a0(0x270)]=_0x1a313a[0x1],_0x5d1aee[_0x21af85][_0x3315a0(0x2c8)]=0x0,_0x5d1aee[_0x21af85][_0x3315a0(0x2c0)]=0x0,_0x5d1aee[_0x21af85][_0x3315a0(0x1f8)]=_0x3315a0(0x24e),_0x5d1aee[_0x21af85][_0x3315a0(0x232)]=_0x1a313a[0x5];}else{if(_0x21af85==_0x54c695){var _0x3f938c;if(_0x1a313a[0x4]=='L')_0x3f938c=_0x3315a0(0x258);else _0x1a313a[0x4]=='F'&&(_0x3f938c=_0x3315a0(0x24e));_0x5d1aee[_0x21af85]['storage']=_0x1a313a[0x0],_0x5d1aee[_0x21af85]['rack']=_0x1a313a[0x1],_0x5d1aee[_0x21af85][_0x3315a0(0x2c8)]=_0x1a313a[0x2],_0x5d1aee[_0x21af85]['bin']=_0x1a313a[0x3],_0x5d1aee[_0x21af85][_0x3315a0(0x1f8)]=_0x3f938c,_0x5d1aee[_0x21af85]['floorlevel']=_0x1a313a[0x5];}}}});}),_0x5084ad[_0x583e1e(0x255)]((_0x3958e4,_0x9f443)=>{var _0x5c151f=_0x583e1e;_0x5d1aee[_0x9f443][_0x5c151f(0x236)]=_0x3958e4;}),_0x372e92[_0x583e1e(0x255)]((_0x5a7f9f,_0x57337c)=>{var _0x23b8cb=_0x583e1e;_0x5d1aee[_0x57337c][_0x23b8cb(0x227)]=_0x5a7f9f;}),_0x28df01['forEach']((_0x95b2f4,_0x123334)=>{var _0x4b7fe6=_0x583e1e;_0x5d1aee[_0x123334][_0x4b7fe6(0x2e0)]=_0x95b2f4;}),_0x5c57db[_0x583e1e(0x255)]((_0x3b6da5,_0x501d5d)=>{_0x5d1aee[_0x501d5d]['expiry_date']=_0x3b6da5;}),_0xb39a53[_0x583e1e(0x255)]((_0x5bd981,_0x5f5653)=>{var _0xdcf744=_0x583e1e;_0x5d1aee[_0x5f5653][_0xdcf744(0x235)]=_0x5bd981;}),_0x22fbde[_0x583e1e(0x255)]((_0xf1828f,_0xc7bee0)=>{var _0x2d3288=_0x583e1e;_0x5d1aee[_0xc7bee0][_0x2d3288(0x1ff)]=_0xf1828f;}),_0x3484da[_0x583e1e(0x255)]((_0x3d378b,_0x163f4f)=>{var _0x19cd5c=_0x583e1e;_0x5d1aee[_0x163f4f][_0x19cd5c(0x25b)]=Math[_0x19cd5c(0x22b)](_0x3d378b);}),_0x359be2[_0x583e1e(0x255)]((_0x151966,_0x394b1d)=>{var _0x41e9b3=_0x583e1e;_0x5d1aee[_0x394b1d][_0x41e9b3(0x1d8)]=_0x151966;}),_0x3838a0[_0x583e1e(0x255)]((_0x4c814f,_0x180bd9)=>{var _0x512587=_0x583e1e;_0x5d1aee[_0x180bd9][_0x512587(0x277)]=_0x4c814f;}),_0x475858[_0x583e1e(0x255)]((_0x175985,_0x2d1524)=>{_0x5d1aee[_0x2d1524]['prod_cat']=_0x175985;}),_0x432c9d[_0x583e1e(0x255)]((_0x2e58b2,_0x4cb2a4)=>{_0x5d1aee[_0x4cb2a4]['quantity_notConverted']=_0x2e58b2;}),_0x6724b['forEach']((_0x2d2cf8,_0x5ca0b7)=>{var _0xb6d34d=_0x583e1e;_0x5d1aee[_0x5ca0b7][_0xb6d34d(0x2c6)]=_0x2d2cf8;});var _0x4b151c=0x0;_0x5d1aee[_0x583e1e(0x255)](_0x5eba42=>{var _0x37d6c8=_0x583e1e;console[_0x37d6c8(0x281)](_0x37d6c8(0x2b4),_0x5eba42),(parseInt(_0x5eba42['stock'])<parseInt(_0x5eba42[_0x37d6c8(0x210)])||parseInt(_0x5eba42['quantity'])==0x0)&&_0x4b151c++;});if(_0x4b151c!=0x0)return _0x49e7c7[_0x583e1e(0x1e6)]('errors',_0x583e1e(0x278)),_0x2a6847[_0x583e1e(0x1f3)](_0x583e1e(0x269));const _0x35eed7=_0x5d1aee[_0x583e1e(0x266)](_0x582f87=>_0x582f87['quantity']!=='0'&&_0x582f87['quantity']!=='');_0x41669f['invoice']=_0x441342,_0x41669f[_0x583e1e(0x1ee)]=_0x4e45a2,_0x41669f['date']=_0x460876,_0x41669f[_0x583e1e(0x214)]=_0x3be10f,_0x41669f[_0x583e1e(0x20a)]=_0x35eed7,_0x41669f['note']=_0x25bb7f,_0x41669f[_0x583e1e(0x2d1)]=_0xc812d8,_0x41669f['finalize']=_0x583e1e(0x2a2),_0x41669f[_0x583e1e(0x29a)]=_0x583e1e(0x2a2);const _0x22cf8f=await _0x41669f[_0x583e1e(0x204)]();_0x49e7c7[_0x583e1e(0x1e6)](_0x583e1e(0x28c),_0x583e1e(0x233)),_0x2a6847['redirect']('/all_sales/view');}catch(_0x3b37e1){console[_0x583e1e(0x281)](_0x3b37e1);}}),router['post'](a0_0x47fe1e(0x29c),auth,async(_0x198ab7,_0xf9f342)=>{var _0x55bc4b=a0_0x47fe1e;try{const _0x3d9f81=_0x198ab7['params']['id'],{invoice:_0x201a50,customer:_0xbe681,receivable_amount:_0x483a46,received_amount:_0x958fd9}=_0x198ab7[_0x55bc4b(0x296)],_0x4a0283=await sales[_0x55bc4b(0x1e7)](_0x3d9f81);console[_0x55bc4b(0x281)](_0x4a0283);var _0x4cf0d7=_0x483a46-_0x958fd9;console[_0x55bc4b(0x281)](_0x958fd9),_0x4a0283[_0x55bc4b(0x239)]=parseFloat(_0x958fd9)+parseFloat(_0x4a0283[_0x55bc4b(0x239)]),_0x4a0283[_0x55bc4b(0x1e9)]=_0x4cf0d7,console[_0x55bc4b(0x281)](_0x4a0283);const _0x36298e=await _0x4a0283[_0x55bc4b(0x204)](),_0x41a84d=await c_payment_data[_0x55bc4b(0x1d6)]({'invoice':_0x201a50});_0x41a84d[_0x55bc4b(0x2df)]=_0x4cf0d7,await _0x41a84d[_0x55bc4b(0x204)]();let _0x129feb=new Date(),_0x39b959=('0'+_0x129feb[_0x55bc4b(0x2b5)]())[_0x55bc4b(0x287)](-0x2),_0x3f124c=('0'+(_0x129feb['getMonth']()+0x1))[_0x55bc4b(0x287)](-0x2),_0x262a2e=_0x129feb[_0x55bc4b(0x2e3)](),_0x1431ec=_0x262a2e+'-'+_0x3f124c+'-'+_0x39b959;const _0x10f7d6=new customer_payment({'invoice':_0x201a50,'date':_0x262a2e+'-'+_0x3f124c+'-'+_0x39b959,'customer':_0xbe681,'reason':_0x55bc4b(0x1fb),'amount':_0x958fd9}),_0x3138b5=await _0x10f7d6[_0x55bc4b(0x204)]();_0x198ab7[_0x55bc4b(0x1e6)](_0x55bc4b(0x28c),_0x55bc4b(0x282)),_0xf9f342[_0x55bc4b(0x1f3)](_0x55bc4b(0x2c9));}catch(_0x495523){console[_0x55bc4b(0x281)](_0x495523);}}),router[a0_0x47fe1e(0x245)](a0_0x47fe1e(0x220),auth,async(_0x5c7be6,_0xe9a2b6)=>{var _0x50c822=a0_0x47fe1e;try{const {username:_0x2e0a91,email:_0x3d467d,role:_0x4f7380}=_0x5c7be6['user'],_0x4d9b19=_0x5c7be6[_0x50c822(0x2bc)],_0xb70602=await profile[_0x50c822(0x1d6)]({'email':_0x4d9b19['email']}),_0x137dc4=await master_shop[_0x50c822(0x254)]();console[_0x50c822(0x281)](_0x50c822(0x267),_0x137dc4);const _0x5b8b24=_0x5c7be6[_0x50c822(0x29b)]['id'],_0x3eeda=await sales[_0x50c822(0x1e7)](_0x5b8b24);console[_0x50c822(0x281)](_0x3eeda);const _0x2946e0=await customer['findOne']({'name':_0x3eeda[_0x50c822(0x1ee)]});console[_0x50c822(0x281)](_0x2946e0);if(_0x137dc4[0x0][_0x50c822(0x1e5)]=='English\x20(US)'){var _0x484f3b=users['English'];console[_0x50c822(0x281)](_0x484f3b);}else{if(_0x137dc4[0x0][_0x50c822(0x1e5)]==_0x50c822(0x23e))var _0x484f3b=users[_0x50c822(0x23e)];else{if(_0x137dc4[0x0]['language']==_0x50c822(0x20f))var _0x484f3b=users[_0x50c822(0x20f)];else{if(_0x137dc4[0x0]['language']=='Spanish')var _0x484f3b=users[_0x50c822(0x285)];else{if(_0x137dc4[0x0][_0x50c822(0x1e5)]==_0x50c822(0x202))var _0x484f3b=users[_0x50c822(0x202)];else{if(_0x137dc4[0x0]['language']==_0x50c822(0x2bd))var _0x484f3b=users[_0x50c822(0x2af)];else{if(_0x137dc4[0x0]['language']==_0x50c822(0x25c))var _0x484f3b=users[_0x50c822(0x25c)];else{if(_0x137dc4[0x0][_0x50c822(0x1e5)]==_0x50c822(0x2bb))var _0x484f3b=users[_0x50c822(0x1f6)];}}}}}}}_0xe9a2b6['render'](_0x50c822(0x2c5),{'success':_0x5c7be6[_0x50c822(0x1e6)](_0x50c822(0x28c)),'errors':_0x5c7be6[_0x50c822(0x1e6)](_0x50c822(0x2e7)),'role':_0x4d9b19,'profile':_0xb70602,'master_shop':_0x137dc4,'customers':_0x2946e0,'sales':_0x3eeda,'language':_0x484f3b});}catch(_0x318ce0){console[_0x50c822(0x281)](_0x318ce0);}}),router[a0_0x47fe1e(0x245)](a0_0x47fe1e(0x223),auth,async(_0x1b0023,_0x5e33c9)=>{var _0x163d60=a0_0x47fe1e;try{const {username:_0x46ff1a,email:_0x29e886,role:_0x1732cb}=_0x1b0023[_0x163d60(0x2bc)],_0x2ea5dd=_0x1b0023[_0x163d60(0x2bc)],_0x266cef=await profile[_0x163d60(0x1d6)]({'email':_0x2ea5dd[_0x163d60(0x2a4)]}),_0x1cc376=await master_shop[_0x163d60(0x254)]();console[_0x163d60(0x281)](_0x163d60(0x267),_0x1cc376);const _0x3c7a92=_0x1b0023[_0x163d60(0x29b)]['id'];console[_0x163d60(0x281)](_0x3c7a92);const _0x3b4813=await sales['findById'](_0x3c7a92);console['log'](_0x163d60(0x25e),_0x3b4813);const _0x53650c=await warehouse[_0x163d60(0x2cb)]([{'$match':{'name':_0x163d60(0x29d),'room':_0x163d60(0x2d2)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x163d60(0x240),'name':{'$first':_0x163d60(0x2dc)},'product_stock':{'$first':_0x163d60(0x241)},'level':{'$first':_0x163d60(0x293)},'isle':{'$first':_0x163d60(0x2b2)},'pallet':{'$first':_0x163d60(0x244)},'primary_code':{'$first':_0x163d60(0x1e4)},'secondary_code':{'$first':_0x163d60(0x263)},'product_code':{'$first':_0x163d60(0x268)}}}]);console[_0x163d60(0x281)](_0x163d60(0x206),_0x53650c);const _0x5c31ca=await product['find']({});warehouse_data=await warehouse[_0x163d60(0x2cb)]([{'$match':{'status':_0x163d60(0x20d),'name':_0x163d60(0x29d),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x163d60(0x272),'name':{'$first':_0x163d60(0x272)}}},{'$sort':{'name':0x1}}]);var _0xe57f5a=[_0x163d60(0x2d2)];if(_0x1cc376[0x0][_0x163d60(0x1e5)]==_0x163d60(0x1d9)){var _0x3a6b14=users[_0x163d60(0x1f2)];console[_0x163d60(0x281)](_0x3a6b14);}else{if(_0x1cc376[0x0][_0x163d60(0x1e5)]==_0x163d60(0x23e))var _0x3a6b14=users[_0x163d60(0x23e)];else{if(_0x1cc376[0x0]['language']==_0x163d60(0x20f))var _0x3a6b14=users[_0x163d60(0x20f)];else{if(_0x1cc376[0x0]['language']==_0x163d60(0x285))var _0x3a6b14=users['Spanish'];else{if(_0x1cc376[0x0][_0x163d60(0x1e5)]=='French')var _0x3a6b14=users[_0x163d60(0x202)];else{if(_0x1cc376[0x0][_0x163d60(0x1e5)]==_0x163d60(0x2bd))var _0x3a6b14=users[_0x163d60(0x2af)];else{if(_0x1cc376[0x0][_0x163d60(0x1e5)]==_0x163d60(0x25c))var _0x3a6b14=users['Chinese'];else{if(_0x1cc376[0x0]['language']==_0x163d60(0x2bb))var _0x3a6b14=users['Arabic'];}}}}}}}_0x5e33c9[_0x163d60(0x27e)]('return_sale',{'success':_0x1b0023[_0x163d60(0x1e6)]('success'),'errors':_0x1b0023[_0x163d60(0x1e6)]('errors'),'role':_0x2ea5dd,'profile':_0x266cef,'user':_0x3b4813,'stock':_0x53650c,'master_shop':_0x1cc376,'unit':_0x5c31ca,'language':_0x3a6b14,'warehouses':warehouse_data,'rooms':_0xe57f5a});}catch(_0x36a74b){console[_0x163d60(0x281)](_0x36a74b),_0x5e33c9['status'](0xc8)[_0x163d60(0x2a6)]({'message':_0x36a74b[_0x163d60(0x1e8)]});}}),router[a0_0x47fe1e(0x2db)](a0_0x47fe1e(0x223),auth,async(_0x4a66e2,_0x142f59)=>{var _0x36548b=a0_0x47fe1e;try{const {invoice:_0x1414e1,date:_0x2a249a,warehouse_name:_0x3c2f45,product_name:_0x25d172,primary_code:_0x3658d9,secondary_code:_0x417382,product_code:_0x4bbf3c,sales_quantity:_0x2578d2,stocks:_0x76aeff,return_qty:_0x2d05af,Room_name:_0x30a3c3,to_warehouse_name:_0x63b5a5,to_Roomname:_0x6cdd02,to_Room_name:_0x273d66,note:_0x5dd479,level:_0x373de8,isle:_0x46fff5,pallet:_0x54dce3}=_0x4a66e2[_0x36548b(0x296)];if(typeof _0x25d172==_0x36548b(0x2ca))var _0xd9bf9e=[_0x4a66e2[_0x36548b(0x296)]['product_name']],_0x4e4224=[_0x4a66e2[_0x36548b(0x296)][_0x36548b(0x22f)]],_0x5c6549=[_0x4a66e2[_0x36548b(0x296)][_0x36548b(0x276)]],_0x5ede5a=[_0x4a66e2['body'][_0x36548b(0x221)]],_0x2a7bd1=[_0x4a66e2[_0x36548b(0x296)][_0x36548b(0x1f1)]],_0x100424=[_0x4a66e2[_0x36548b(0x296)]['stocks']],_0x24b4f2=[_0x4a66e2['body'][_0x36548b(0x21e)]],_0x5e4994=[_0x4a66e2[_0x36548b(0x296)]['bay']],_0x31f39e=[_0x4a66e2[_0x36548b(0x296)][_0x36548b(0x2c0)]],_0x283a6a=[_0x4a66e2[_0x36548b(0x296)][_0x36548b(0x225)]],_0x3de802=[_0x4a66e2[_0x36548b(0x296)]['floorlevel']];else var _0xd9bf9e=[..._0x4a66e2['body']['product_name']],_0x4e4224=[..._0x4a66e2[_0x36548b(0x296)][_0x36548b(0x22f)]],_0x5c6549=[..._0x4a66e2[_0x36548b(0x296)][_0x36548b(0x276)]],_0x5ede5a=[..._0x4a66e2[_0x36548b(0x296)][_0x36548b(0x221)]],_0x2a7bd1=[..._0x4a66e2[_0x36548b(0x296)]['sales_quantity']],_0x100424=[..._0x4a66e2[_0x36548b(0x296)][_0x36548b(0x294)]],_0x24b4f2=[..._0x4a66e2['body'][_0x36548b(0x21e)]],_0x5e4994=[..._0x4a66e2[_0x36548b(0x296)][_0x36548b(0x2c8)]],_0x31f39e=[..._0x4a66e2[_0x36548b(0x296)][_0x36548b(0x2c0)]],_0x283a6a=[..._0x4a66e2[_0x36548b(0x296)][_0x36548b(0x225)]],_0x3de802=[..._0x4a66e2[_0x36548b(0x296)][_0x36548b(0x232)]];const _0xf01173=_0xd9bf9e['map'](_0x290806=>{return _0x290806={'product_name':_0x290806};});_0x4e4224[_0x36548b(0x255)]((_0x3571c3,_0x38124f)=>{var _0x116ba2=_0x36548b;_0xf01173[_0x38124f][_0x116ba2(0x22f)]=_0x3571c3;}),_0x5c6549[_0x36548b(0x255)]((_0x32ddf8,_0x20e806)=>{var _0x315508=_0x36548b;_0xf01173[_0x20e806][_0x315508(0x276)]=_0x32ddf8;}),_0x5ede5a[_0x36548b(0x255)]((_0x4d489d,_0x55c385)=>{_0xf01173[_0x55c385]['product_code']=_0x4d489d;}),_0x2a7bd1[_0x36548b(0x255)]((_0x43bb91,_0x2a4081)=>{var _0x24567f=_0x36548b;_0xf01173[_0x2a4081][_0x24567f(0x1f7)]=_0x43bb91;}),_0x100424[_0x36548b(0x255)]((_0x54f93c,_0x1718dc)=>{_0xf01173[_0x1718dc]['stock']=_0x54f93c;}),_0x24b4f2['forEach']((_0x292a1d,_0x125a38)=>{var _0xc10be6=_0x36548b;_0xf01173[_0x125a38][_0xc10be6(0x21e)]=_0x292a1d;}),_0x5e4994[_0x36548b(0x255)]((_0x260302,_0x23f78e)=>{_0xf01173[_0x23f78e]['bay']=_0x260302;}),_0x31f39e[_0x36548b(0x255)]((_0x5ab221,_0x3dc694)=>{var _0x4d57b1=_0x36548b;_0xf01173[_0x3dc694][_0x4d57b1(0x2c0)]=_0x5ab221;}),_0x283a6a['forEach']((_0x493ba2,_0xbdedb1)=>{var _0x51e700=_0x36548b;_0xf01173[_0xbdedb1][_0x51e700(0x1f8)]=_0x493ba2;}),_0x3de802[_0x36548b(0x255)]((_0x10b402,_0x39f1d0)=>{var _0xf6af7b=_0x36548b;_0xf01173[_0x39f1d0][_0xf6af7b(0x232)]=_0x10b402;});var _0x187d1a=0x0;_0xf01173[_0x36548b(0x255)](_0x330940=>{var _0x274e0d=_0x36548b;console[_0x274e0d(0x281)]('foreach\x20newproduct',_0x330940),(parseInt(_0x330940['sale_qty'])<parseInt(_0x330940[_0x274e0d(0x21e)])||parseInt(_0x330940[_0x274e0d(0x26c)])<parseInt(_0x330940[_0x274e0d(0x21e)])&&parseInt(_0x330940[_0x274e0d(0x1f7)])>parseInt(_0x330940[_0x274e0d(0x21e)])||parseInt(_0x330940[_0x274e0d(0x21e)])==0x0)&&_0x187d1a++;});if(_0x187d1a!=0x0)return _0x4a66e2[_0x36548b(0x1e6)](_0x36548b(0x2e7),_0x36548b(0x234)),_0x142f59[_0x36548b(0x1f3)]('back');const _0xc6aba4=await sales[_0x36548b(0x1d6)]({'invoice':_0x1414e1});console['log'](_0xc6aba4),_0xc6aba4[_0x36548b(0x2da)]=_0x36548b(0x22d);const _0x3cbe93=await _0xc6aba4[_0x36548b(0x204)](),_0x25f9f5=new sales_return({'invoice':_0x1414e1,'customer':_0x4a66e2[_0x36548b(0x296)][_0x36548b(0x1ee)],'date':_0x2a249a,'warehouse_name':_0x3c2f45,'room':_0x30a3c3,'ToWarehouse':_0x63b5a5,'ToRoom':_0x273d66,'return_sale':_0xf01173,'note':_0x5dd479}),_0x470fa9=await _0x25f9f5['save']();console[_0x36548b(0x281)](_0x25f9f5);const _0xdc5dbd=await sales_return[_0x36548b(0x1d6)]({'invoice':_0x1414e1}),_0x328b9c=await warehouse['findOne']({'name':_0x63b5a5,'room':_0x273d66});_0xdc5dbd[_0x36548b(0x1e3)][_0x36548b(0x255)](_0x2767d1=>{var _0x523745=_0x36548b,_0x526c80=0x0;const _0x3c5738=_0x328b9c['product_details']['map'](_0x535f3e=>{var _0x521020=a0_0x399e;_0x535f3e[_0x521020(0x2e2)]==_0x2767d1[_0x521020(0x2e2)]&&_0x535f3e['floorlevel']==_0x2767d1['floorlevel']&&_0x535f3e[_0x521020(0x1f8)]==_0x2767d1['type']&&_0x535f3e[_0x521020(0x2c0)]==_0x2767d1[_0x521020(0x2c0)]&&_0x535f3e[_0x521020(0x2c8)]==_0x2767d1[_0x521020(0x2c8)]&&(_0x535f3e[_0x521020(0x2cc)]=parseInt(_0x535f3e[_0x521020(0x2cc)])+parseInt(_0x2767d1['return_qty']),_0x526c80++);});_0x526c80=='0'&&(_0x328b9c[_0x523745(0x27f)]=_0x328b9c[_0x523745(0x27f)]['concat']({'product_name':_0x2767d1['product_name'],'product_stock':_0x2767d1['return_qty'],'primary_code':_0x2767d1['primary_code'],'secondary_code':_0x2767d1[_0x523745(0x276)],'product_code':_0x2767d1[_0x523745(0x221)],'bay':_0x2767d1[_0x523745(0x2c8)],'bin':_0x2767d1[_0x523745(0x2c0)],'type':_0x2767d1[_0x523745(0x1f8)],'floorlevel':_0x2767d1[_0x523745(0x232)]})),console[_0x523745(0x281)]('final',_0x328b9c);}),await _0x328b9c[_0x36548b(0x204)](),console[_0x36548b(0x281)](_0x4a66e2[_0x36548b(0x296)]);const _0x1af87e=new c_payment_data({'invoice':_0x1414e1,'customer':_0x4a66e2['body'][_0x36548b(0x1ee)],'reason':_0x36548b(0x2d9)});await _0x1af87e[_0x36548b(0x204)]();const _0x2b8660=await master_shop[_0x36548b(0x254)]();console['log'](_0x36548b(0x2ae),_0x2b8660[0x0][_0x36548b(0x20b)]);const _0x33c6f5=await email_settings[_0x36548b(0x1d6)](),_0x213a10=await customer[_0x36548b(0x1d6)]({'name':_0x4a66e2['body'][_0x36548b(0x1ee)]});console[_0x36548b(0x281)](_0x36548b(0x257),_0x213a10);_0x2b8660[0x0][_0x36548b(0x2e1)]==0x1?(right_currency=_0x2b8660[0x0][_0x36548b(0x2b7)],left_currency=''):(right_currency='',left_currency=_0x2b8660[0x0]['currency']);var _0x5356e6=_0xd9bf9e,_0x278fbe=_0x24b4f2,_0x3aa47b='',_0x30ade2;for(_0x30ade2 in _0x5356e6){_0x3aa47b+=_0x36548b(0x2c3)+_0x36548b(0x1da)+_0x5356e6[_0x30ade2]+_0x36548b(0x243)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x278fbe[_0x30ade2]+_0x36548b(0x243)+_0x36548b(0x2c4);}console['log'](_0x36548b(0x238),_0x3aa47b);let _0x2a47c1=nodemailer[_0x36548b(0x1f0)]({'service':'gmail','auth':{'user':_0x33c6f5[_0x36548b(0x2a4)],'pass':_0x33c6f5['password']}}),_0x19caf9={'from':_0x33c6f5[_0x36548b(0x2a4)],'to':_0x213a10[_0x36548b(0x2a4)],'subject':_0x36548b(0x27d),'attachments':[{'filename':'Logo.png','path':__dirname+_0x36548b(0x259)+_0x36548b(0x2d0)+_0x2b8660[0x0][_0x36548b(0x20b)],'cid':_0x36548b(0x208)}],'html':'<!DOCTYPE\x20html>'+_0x36548b(0x262)+_0x36548b(0x22e)+_0x36548b(0x209)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x36548b(0x242)+'</div>'+_0x36548b(0x209)+_0x36548b(0x20c)+_0x2b8660[0x0][_0x36548b(0x25f)]+'\x20</h2>'+'</div>'+_0x36548b(0x201)+_0x36548b(0x1fa)+_0x36548b(0x209)+_0x36548b(0x261)+_0x36548b(0x1f9)+_0x1414e1+'\x20'+_0x36548b(0x230)+'\x20Order\x20Date\x20:\x20'+_0x2a249a+'\x20'+'</span>'+_0x36548b(0x2aa)+'</div>'+_0x36548b(0x205)+_0x36548b(0x27c)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x36548b(0x2c7)+_0x36548b(0x28d)+_0x36548b(0x2ac)+_0x36548b(0x2c4)+_0x36548b(0x207)+_0x36548b(0x2b1)+'\x20'+_0x3aa47b+'\x20'+_0x36548b(0x1fd)+_0x36548b(0x2ce)+_0x36548b(0x209)+_0x36548b(0x218)+_0x36548b(0x22c)+_0x2b8660[0x0][_0x36548b(0x25f)]+'</h5>'+'</div>'+_0x36548b(0x201)+'</body></html>'};_0x2a47c1[_0x36548b(0x2b0)](_0x19caf9,function(_0x357f4a,_0xa5c7b2){var _0xcbde15=_0x36548b;_0x357f4a?(console[_0xcbde15(0x281)](_0x357f4a),console[_0xcbde15(0x281)]('Error\x20Occurs')):console[_0xcbde15(0x281)](_0xcbde15(0x2d5));}),_0x4a66e2[_0x36548b(0x1e6)](_0x36548b(0x28c),_0x36548b(0x1ec)),_0x142f59[_0x36548b(0x1f3)](_0x36548b(0x2c9));}catch(_0x1a4328){console[_0x36548b(0x281)](_0x1a4328),_0x142f59[_0x36548b(0x1ea)](0xc8)[_0x36548b(0x2a6)]({'message1':_0x1a4328['message']});}}),router['get'](a0_0x47fe1e(0x226),auth,async(_0x5724f1,_0x23b0a1)=>{var _0x86d61c=a0_0x47fe1e;try{const {username:_0x3fe97f,email:_0x364f27,role:_0x3c6843}=_0x5724f1['user'],_0x2a6e00=_0x5724f1[_0x86d61c(0x2bc)],_0x59d21c=await profile[_0x86d61c(0x1d6)]({'email':_0x2a6e00[_0x86d61c(0x2a4)]}),_0x16caa7=await master_shop[_0x86d61c(0x254)]();console[_0x86d61c(0x281)](_0x86d61c(0x222),_0x16caa7);const _0xd13132=_0x5724f1[_0x86d61c(0x29b)]['id'],_0x1e7db7=await sales[_0x86d61c(0x1e7)](_0xd13132);console[_0x86d61c(0x281)](_0x86d61c(0x1e1),_0x1e7db7);if(_0x16caa7[0x0][_0x86d61c(0x1e5)]==_0x86d61c(0x1d9))var _0x3f895f=users[_0x86d61c(0x1f2)];else{if(_0x16caa7[0x0][_0x86d61c(0x1e5)]==_0x86d61c(0x23e))var _0x3f895f=users[_0x86d61c(0x23e)];else{if(_0x16caa7[0x0]['language']=='German')var _0x3f895f=users[_0x86d61c(0x20f)];else{if(_0x16caa7[0x0][_0x86d61c(0x1e5)]=='Spanish')var _0x3f895f=users[_0x86d61c(0x285)];else{if(_0x16caa7[0x0][_0x86d61c(0x1e5)]==_0x86d61c(0x202))var _0x3f895f=users[_0x86d61c(0x202)];else{if(_0x16caa7[0x0][_0x86d61c(0x1e5)]==_0x86d61c(0x2bd))var _0x3f895f=users[_0x86d61c(0x2af)];else{if(_0x16caa7[0x0][_0x86d61c(0x1e5)]==_0x86d61c(0x25c))var _0x3f895f=users['Chinese'];else{if(_0x16caa7[0x0][_0x86d61c(0x1e5)]==_0x86d61c(0x2bb))var _0x3f895f=users[_0x86d61c(0x1f6)];}}}}}}}_0x23b0a1[_0x86d61c(0x27e)](_0x86d61c(0x2a3),{'success':_0x5724f1['flash'](_0x86d61c(0x28c)),'errors':_0x5724f1['flash'](_0x86d61c(0x2e7)),'role':_0x2a6e00,'profile':_0x59d21c,'alldata':_0x1e7db7,'master_shop':_0x16caa7,'language':_0x3f895f});}catch(_0x353d39){console[_0x86d61c(0x281)](_0x353d39);}}),router[a0_0x47fe1e(0x2db)](a0_0x47fe1e(0x24a),async(_0x44f5a6,_0x47287d)=>{var _0x224356=a0_0x47fe1e;const {product_code:_0x1e1d19,warehouse_name:_0x51154e,rooms_data:_0x3e8b42,Roomslist:_0x555742}=_0x44f5a6['body'],_0x7a29a6=_0x555742['split'](','),_0x1a8c94=[];async function _0x499e00(_0x25c45b){var _0x4491af=a0_0x399e;const _0xdd7998=await warehouse['aggregate']([{'$match':{'name':_0x51154e,'room':_0x25c45b}},{'$unwind':_0x4491af(0x1dd)},{'$match':{'product_details.primary_code':_0x1e1d19}},{'$group':{'_id':_0x4491af(0x240),'name':{'$first':_0x4491af(0x2dc)},'product_stock':{'$first':_0x4491af(0x241)},'primary_code':{'$first':_0x4491af(0x1e4)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4491af(0x268)},'level':{'$first':_0x4491af(0x2c2)},'isle':{'$first':_0x4491af(0x24d)},'type':{'$first':_0x4491af(0x23f)},'pallet':{'$first':_0x4491af(0x1fc)},'unit':{'$first':_0x4491af(0x286)},'secondary_unit':{'$first':_0x4491af(0x23b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x4491af(0x21d)},'production_date':{'$first':_0x4491af(0x274)},'maxPerUnit':{'$first':_0x4491af(0x271)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x4491af(0x2be)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4491af(0x1d7)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x4491af(0x213)},'actual_uom':{'$first':_0x4491af(0x20e)}}}]),_0x36b338=await warehouse[_0x4491af(0x2cb)]([{'$match':{'name':_0x51154e,'room':_0x25c45b}},{'$unwind':_0x4491af(0x1dd)},{'$match':{'product_details.secondary_code':_0x1e1d19}},{'$group':{'_id':_0x4491af(0x240),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x4491af(0x1e4)},'secondary_code':{'$first':_0x4491af(0x263)},'product_code':{'$first':_0x4491af(0x268)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x4491af(0x24d)},'type':{'$first':_0x4491af(0x23f)},'pallet':{'$first':_0x4491af(0x1fc)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x4491af(0x23b)},'storage':{'$first':_0x4491af(0x2d6)},'rack':{'$first':_0x4491af(0x211)},'expiry_date':{'$first':_0x4491af(0x21d)},'production_date':{'$first':_0x4491af(0x274)},'maxPerUnit':{'$first':_0x4491af(0x271)},'batch_code':{'$first':_0x4491af(0x26a)},'product_cat':{'$first':_0x4491af(0x2be)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x4491af(0x1d7)},'invoice':{'$first':_0x4491af(0x2b8)}}}]);if(_0xdd7998[_0x4491af(0x27b)]>0x0)_0x1a8c94[_0x4491af(0x2a8)](_0xdd7998);else _0x36b338['length']>0x0&&_0x1a8c94[_0x4491af(0x2a8)](_0x36b338);}const _0x4bfa9a=_0x7a29a6['map'](_0x54a557=>_0x499e00(_0x54a557));await Promise[_0x224356(0x290)](_0x4bfa9a),_0x47287d[_0x224356(0x2a6)](_0x1a8c94);}),module[a0_0x47fe1e(0x2b9)]=router;